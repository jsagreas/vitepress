---
title: 2、容器运行管理
---
## 📚 目录

1. [Docker容器运行管理概述](#1-Docker容器运行管理概述)
2. [创建并运行容器 - docker run](#2-创建并运行容器-docker-run)
3. [容器启动控制](#3-容器启动控制)
4. [容器停止与终止](#4-容器停止与终止)
5. [容器暂停与恢复](#5-容器暂停与恢复)
6. [前台后台运行模式](#6-前台后台运行模式)
7. [容器运行参数配置](#7-容器运行参数配置)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🐳 Docker容器运行管理概述


### 1.1 什么是容器运行管理


**🔸 核心概念**
```
容器运行管理就是控制Docker容器的"生老病死"
- 创建：把镜像变成可运行的容器
- 启动：让停止的容器重新工作
- 停止：优雅地关闭正在运行的容器
- 终止：强制结束容器进程
- 暂停：临时冻结容器，但不释放资源
- 重启：先停止再启动
```

**💡 为什么需要这些操作**
想象容器就像一台虚拟电脑，你需要能够：
- **开机**：启动容器让应用运行
- **关机**：正常停止容器保存数据
- **强制关机**：紧急情况下立即终止
- **休眠**：暂时停用但保持状态
- **重启**：解决问题或应用更新

### 1.2 容器生命周期状态


```
容器状态转换图：

Created     →    Running    →    Exited
  ↑              ↑   ↓           ↑
  |            Paused          |
  |              ↓             |
  └──────── Restarting ←───────┘

状态说明：
• Created：已创建但未启动
• Running：正在运行中
• Paused：暂停状态（进程冻结）
• Exited：已停止（进程结束）
• Restarting：重启中的过渡状态
```

### 1.3 常用管理命令总览


| 命令 | **作用** | **使用场景** |
|------|---------|-------------|
| `docker run` | `创建并运行新容器` | `首次启动应用` |
| `docker start` | `启动已停止的容器` | `重新启动已有容器` |
| `docker stop` | `优雅停止容器` | `正常关闭应用` |
| `docker kill` | `强制终止容器` | `应急情况处理` |
| `docker restart` | `重启容器` | `应用更新或故障恢复` |
| `docker pause` | `暂停容器` | `临时停用服务` |
| `docker unpause` | `恢复暂停的容器` | `重新启用服务` |

---

## 2. 🚀 创建并运行容器 - docker run


### 2.1 docker run 基本原理


**🔸 docker run 做了什么**
```
docker run = docker create + docker start

详细步骤：
1. 检查本地是否有指定镜像
2. 如果没有，从镜像仓库下载
3. 基于镜像创建新的容器
4. 分配文件系统和网络接口
5. 启动容器中的主进程
6. 执行指定的命令
```

**💡 通俗理解**
就像用软件安装包安装程序：
- **镜像** = 安装包
- **docker run** = 安装并启动程序
- **容器** = 运行中的程序实例

### 2.2 基本语法和常用选项


**🔧 基本语法**
```bash
docker run [选项] 镜像名[:标签] [命令] [参数...]

# 最简单的例子
docker run hello-world

# 运行nginx服务器
docker run nginx

# 运行ubuntu并执行bash命令
docker run ubuntu bash
```

**📋 核心选项说明**

| 选项 | **含义** | **示例** |
|------|---------|----------|
| `-d` | `后台运行（分离模式）` | `docker run -d nginx` |
| `-it` | `交互式终端模式` | `docker run -it ubuntu bash` |
| `--name` | `给容器指定名称` | `docker run --name web nginx` |
| `-p` | `端口映射` | `docker run -p 8080:80 nginx` |
| `-v` | `数据卷挂载` | `docker run -v /data:/app/data nginx` |
| `--rm` | `容器退出后自动删除` | `docker run --rm ubuntu echo "hello"` |

### 2.3 实际应用示例


**🌐 启动Web服务器**
```bash
# 启动nginx服务器，映射端口
docker run -d --name my-nginx -p 8080:80 nginx

# 解释：
# -d: 后台运行
# --name my-nginx: 容器名为my-nginx
# -p 8080:80: 把容器80端口映射到主机8080端口
# nginx: 使用nginx镜像
```

**💻 启动数据库服务**
```bash
# 启动MySQL数据库
docker run -d --name mysql-db \
  -e MYSQL_ROOT_PASSWORD=123456 \
  -p 3306:3306 \
  -v mysql-data:/var/lib/mysql \
  mysql:8.0

# 解释：
# -e: 设置环境变量（数据库密码）
# -v mysql-data:/var/lib/mysql: 持久化数据库数据
```

**🔧 临时测试容器**
```bash
# 运行一次性测试容器
docker run --rm -it ubuntu:20.04 bash

# 解释：
# --rm: 退出后自动删除容器
# -it: 交互式终端
# ubuntu:20.04: 指定镜像版本
# bash: 启动后执行的命令
```

---

## 3. 🔄 容器启动控制


### 3.1 docker start - 启动已停止的容器


**🔸 基本概念**
```
docker start的作用：
- 重新启动已经创建但停止的容器
- 保持原有的配置和数据
- 不会创建新容器，只是重新启动

与docker run的区别：
• docker run: 创建新容器并启动
• docker start: 启动已存在的容器
```

**🔧 使用方法**
```bash
# 启动单个容器（按名称）
docker start my-nginx

# 启动单个容器（按ID）
docker start a1b2c3d4e5f6

# 启动多个容器
docker start container1 container2 container3

# 启动并附加到容器（看到输出）
docker start -a my-nginx

# 启动并进入交互模式
docker start -ai my-ubuntu
```

### 3.2 批量启动操作


**📊 批量管理技巧**
```bash
# 启动所有停止的容器
docker start $(docker ps -aq -f status=exited)

# 启动特定标签的容器
docker start $(docker ps -aq --filter "label=environment=production")

# 查看启动结果
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
```

### 3.3 自动重启策略


**🔄 重启策略配置**
```bash
# 创建容器时设置重启策略
docker run -d --name web --restart=always nginx

# 更新已存在容器的重启策略
docker update --restart=unless-stopped web
```

**📋 重启策略类型**

| 策略 | **说明** | **适用场景** |
|------|---------|-------------|
| `no` | `不自动重启（默认）` | `临时测试容器` |
| `on-failure` | `非正常退出时重启` | `可能出错的应用` |
| `always` | `总是重启` | `核心服务` |
| `unless-stopped` | `除非手动停止，否则总是重启` | `生产环境服务` |

---

## 4. ⏹️ 容器停止与终止


### 4.1 docker stop - 优雅停止


**🔸 优雅停止的含义**
```
docker stop的工作原理：
1. 向容器主进程发送SIGTERM信号
2. 等待进程自己完成清理工作
3. 如果超时（默认10秒），发送SIGKILL强制终止

这样可以：
• 保存正在处理的数据
• 关闭文件和网络连接
• 执行清理操作
```

**🔧 使用方法**
```bash
# 停止单个容器
docker stop my-nginx

# 停止多个容器
docker stop web db redis

# 设置停止超时时间（秒）
docker stop -t 30 my-app

# 停止所有运行的容器
docker stop $(docker ps -q)
```

### 4.2 docker kill - 强制终止


**⚡ 强制终止的场景**
```
什么时候使用docker kill：
• 容器无响应，stop命令无效
• 应用程序死循环或卡死
• 紧急情况需要立即停止
• 测试环境快速清理

注意事项：
⚠️ 可能丢失未保存的数据
⚠️ 可能导致文件损坏
⚠️ 不会执行清理操作
```

**🔧 使用方法**
```bash
# 强制终止单个容器
docker kill my-nginx

# 强制终止多个容器
docker kill web db redis

# 发送特定信号
docker kill --signal=SIGINT my-app

# 强制终止所有运行容器
docker kill $(docker ps -q)
```

### 4.3 stop vs kill 对比


**📊 两种停止方式对比**

| 特性 | **docker stop** | **docker kill** |
|------|----------------|-----------------|
| **信号** | `SIGTERM → SIGKILL` | `直接SIGKILL` |
| **等待时间** | `有超时机制` | `立即执行` |
| **数据安全** | `较安全` | `可能丢失数据` |
| **应用场景** | `正常停止` | `紧急情况` |
| **清理操作** | `允许清理` | `不允许清理` |

---

## 5. ⏸️ 容器暂停与恢复


### 5.1 docker pause - 暂停容器


**🔸 暂停的原理**
```
docker pause做了什么：
• 冻结容器内所有进程的执行
• 进程状态保存在内存中
• 不释放容器占用的资源
• 网络连接保持但暂停数据传输

就像给电脑按了"暂停"键：
- 程序还在内存里
- 只是暂时不运行
- 可以随时恢复
```

**🔧 使用方法**
```bash
# 暂停单个容器
docker pause my-nginx

# 暂停多个容器
docker pause web db redis

# 查看暂停状态
docker ps --filter "status=paused"
```

### 5.2 docker unpause - 恢复容器


**🔧 恢复操作**
```bash
# 恢复单个容器
docker unpause my-nginx

# 恢复多个容器
docker unpause web db redis

# 恢复所有暂停的容器
docker unpause $(docker ps -aq --filter "status=paused")
```

### 5.3 暂停的应用场景


**🎯 实际应用场景**

> 💡 **临时维护**：需要暂停服务但不想重启
> 
> 🔧 **资源调试**：暂停部分服务来调试其他服务
> 
> ⚡ **快速切换**：在不同配置间快速切换
> 
> 🚫 **紧急暂停**：发现问题时快速暂停服务

**⚠️ 注意事项**
```
暂停的限制：
• 只能暂停Running状态的容器
• 暂停期间容器仍占用内存
• 网络连接会超时断开
• 不适合长期暂停
```

---

## 6. 🎭 前台后台运行模式


### 6.1 前台运行模式（默认）


**🔸 前台模式特点**
```
前台运行的特征：
• 容器输出直接显示在终端
• Ctrl+C可以停止容器
• 终端关闭时容器也会停止
• 适合测试和调试

使用场景：
- 开发测试
- 查看日志输出
- 交互式操作
- 一次性任务
```

**💻 前台运行示例**
```bash
# 前台运行nginx（可以看到访问日志）
docker run nginx

# 前台运行并进入交互模式
docker run -it ubuntu bash

# 前台运行一次性任务
docker run --rm python:3.9 python -c "print('Hello Docker')"
```

### 6.2 后台运行模式（-d参数）


**🔸 后台模式特点**
```
后台运行的特征：
• 容器在后台运行，不占用终端
• 返回容器ID后立即回到命令行
• 终端关闭不影响容器运行
• 适合生产环境服务

使用场景：
- Web服务器
- 数据库服务
- 后台任务
- 长期运行的服务
```

**🖥️ 后台运行示例**
```bash
# 后台运行nginx
docker run -d --name web nginx

# 后台运行数据库
docker run -d --name mysql \
  -e MYSQL_ROOT_PASSWORD=password \
  mysql:8.0

# 查看后台运行的容器
docker ps
```

### 6.3 模式切换和日志查看


**📋 在不同模式间切换**
```bash
# 将后台容器切换到前台（附加）
docker attach my-nginx

# 脱离前台模式（不停止容器）
# 按 Ctrl+P, Ctrl+Q

# 查看后台容器日志
docker logs my-nginx

# 实时查看日志
docker logs -f my-nginx
```

**🔍 日志管理命令**
```bash
# 查看最新100行日志
docker logs --tail 100 my-nginx

# 查看特定时间段的日志
docker logs --since "2024-01-01T00:00:00" my-nginx

# 显示时间戳
docker logs -t my-nginx
```

---

## 7. ⚙️ 容器运行参数配置


### 7.1 资源限制参数


**🔧 内存限制**
```bash
# 限制容器最大内存使用量
docker run -d --memory="512m" nginx

# 同时限制内存和交换空间
docker run -d --memory="512m" --memory-swap="1g" nginx

# 设置内存软限制（警告阈值）
docker run -d --memory="512m" --memory-reservation="256m" nginx
```

**⚡ CPU限制**
```bash
# 限制CPU使用率（50%）
docker run -d --cpus="0.5" nginx

# 指定CPU核心
docker run -d --cpuset-cpus="0,1" nginx

# 设置CPU权重
docker run -d --cpu-shares=512 nginx
```

### 7.2 网络配置参数


**🌐 端口映射配置**
```bash
# 单端口映射
docker run -d -p 8080:80 nginx

# 多端口映射
docker run -d -p 8080:80 -p 8443:443 nginx

# 指定协议
docker run -d -p 8080:80/tcp -p 53:53/udp nginx

# 指定绑定IP
docker run -d -p 127.0.0.1:8080:80 nginx
```

**📡 网络模式配置**
```bash
# 使用主机网络
docker run -d --network="host" nginx

# 连接到自定义网络
docker run -d --network="my-network" nginx

# 禁用网络
docker run -d --network="none" nginx
```

### 7.3 存储挂载参数


**📁 数据卷挂载**
```bash
# 挂载主机目录
docker run -d -v /host/path:/container/path nginx

# 挂载数据卷
docker run -d -v my-volume:/app/data nginx

# 只读挂载
docker run -d -v /host/path:/container/path:ro nginx

# 临时文件系统
docker run -d --tmpfs /tmp nginx
```

### 7.4 环境变量配置


**🔐 环境变量设置**
```bash
# 设置单个环境变量
docker run -d -e "ENV_NAME=value" nginx

# 设置多个环境变量
docker run -d \
  -e "DB_HOST=localhost" \
  -e "DB_PORT=3306" \
  -e "DB_NAME=myapp" \
  nginx

# 从文件读取环境变量
docker run -d --env-file .env nginx
```

### 7.5 安全和权限配置


**🔒 用户权限设置**
```bash
# 指定运行用户
docker run -d --user 1000:1000 nginx

# 以root用户运行
docker run -d --user root nginx

# 设置工作目录
docker run -d --workdir /app nginx
```

**🛡️ 安全选项**
```bash
# 只读根文件系统
docker run -d --read-only nginx

# 添加Linux capabilities
docker run -d --cap-add=NET_ADMIN nginx

# 移除Linux capabilities
docker run -d --cap-drop=ALL --cap-add=NET_BIND_SERVICE nginx
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心命令


```
🔸 创建运行：docker run - 一步到位创建并启动容器
🔸 启动管理：docker start - 重新启动已有容器  
🔸 优雅停止：docker stop - 安全地停止容器服务
🔸 强制终止：docker kill - 紧急情况下的强制停止
🔸 重启服务：docker restart - 等于stop + start
🔸 暂停恢复：docker pause/unpause - 临时冻结容器
```

### 8.2 关键理解要点


**🔹 容器生命周期管理**
```
容器就像一个应用程序：
- run = 安装并启动程序
- start = 重新启动程序  
- stop = 正常关闭程序
- kill = 强制结束程序
- pause = 暂停程序运行
```

**🔹 前台后台运行选择**
```
选择原则：
- 前台模式：开发测试、查看日志、交互操作
- 后台模式：生产服务、Web应用、数据库服务
```

**🔹 参数配置的重要性**
```
合理的参数配置：
- 资源限制：防止容器消耗过多系统资源
- 网络配置：确保服务能够正确访问
- 存储挂载：保证数据的持久化
- 环境变量：传递配置信息
```

### 8.3 实践应用指导


**🎯 生产环境最佳实践**
- **总是使用后台模式**：`-d`参数让服务在后台稳定运行
- **设置重启策略**：`--restart=unless-stopped`确保服务高可用
- **资源限制**：防止单个容器占用过多资源
- **健康检查**：监控容器运行状态
- **日志管理**：定期查看和清理日志

**🔧 开发调试技巧**
- **使用前台模式**：方便查看实时输出和调试
- **临时容器**：`--rm`参数自动清理测试容器
- **交互模式**：`-it`参数进入容器内部操作
- **端口映射**：`-p`参数暴露服务端口

**⚠️ 常见注意事项**
```
操作规范：
- 优先使用docker stop而不是kill
- 生产环境必须设置资源限制
- 重要数据一定要挂载到外部存储
- 容器名称要有意义和规范性
- 定期清理不需要的容器
```

### 8.4 故障排查指导


**🔍 容器启动失败**
```bash
# 查看容器状态
docker ps -a

# 查看错误日志
docker logs container-name

# 检查容器配置
docker inspect container-name
```

**🔧 服务无法访问**
```bash
# 检查端口映射
docker port container-name

# 检查网络配置
docker network ls
docker network inspect network-name

# 测试网络连通性
docker exec -it container-name ping target-host
```

**核心记忆**：
- Docker容器管理就是控制应用的启停和状态
- run创建新容器，start启动已有容器
- stop优雅停止，kill强制终止，pause临时暂停
- 前台适合调试，后台适合服务，参数配置很重要