---
title: 1、镜像相关命令
---
## 📚 目录

1. [Docker镜像核心概念](#1-Docker镜像核心概念)
2. [镜像获取与管理命令](#2-镜像获取与管理命令)
3. [镜像构建与制作命令](#3-镜像构建与制作命令)
4. [镜像导入导出命令](#4-镜像导入导出命令)
5. [镜像信息查看命令](#5-镜像信息查看命令)
6. [实用操作技巧总结](#6-实用操作技巧总结)

---

## 1. 🐳 Docker镜像核心概念


### 1.1 什么是Docker镜像


**💡 通俗理解**：
Docker镜像就像是一个"软件安装包"，里面打包了运行某个应用程序需要的所有东西：
- 操作系统基础环境
- 应用程序本身
- 运行时依赖库
- 配置文件等

```
传统安装软件：
用户电脑 → 下载安装包 → 安装 → 运行

Docker方式：
用户电脑 → 拉取镜像 → 创建容器 → 运行
```

### 1.2 镜像的分层结构


**🔸 核心特点**：
Docker镜像采用**分层存储**的方式，每一层都是只读的文件系统。

```
镜像分层示例：
┌─────────────────────┐
│   应用程序层         │ ← 你的Python应用
├─────────────────────┤
│   Python环境层       │ ← Python运行时
├─────────────────────┤
│   操作系统基础层     │ ← Ubuntu基础系统
└─────────────────────┘

好处：
✅ 节省存储空间 - 相同层可以共享
✅ 加快传输速度 - 只需传输新增层
✅ 版本管理方便 - 每层都有独立版本
```

### 1.3 镜像命名规则


**🏷️ 标准格式**：
`[仓库地址/]命名空间/镜像名[:标签]`

```
完整示例：
registry.hub.docker.com/library/nginx:1.20

简化写法：
nginx:1.20          ← 等同于上面的完整写法
nginx:latest        ← 默认标签
nginx               ← 省略标签时默认为latest
```

---

## 2. 📦 镜像获取与管理命令


### 2.1 docker pull - 拉取镜像


**🔸 基本用法**：
从Docker仓库下载镜像到本地

```bash
# 基本语法
docker pull [OPTIONS] NAME[:TAG]

# 常用示例
docker pull nginx                    # 拉取最新版nginx
docker pull nginx:1.20             # 拉取指定版本
docker pull ubuntu:20.04           # 拉取Ubuntu 20.04
```

> 💡 **实用技巧**：
> - 不指定标签时默认拉取 `latest` 标签
> - 可以同时拉取多个镜像：`docker pull nginx ubuntu python`
> - 使用 `--all-tags` 拉取所有标签版本

**⚡ 常见拉取场景**：
```bash
# 开发环境搭建
docker pull mysql:8.0              # 数据库
docker pull redis:alpine           # 缓存服务  
docker pull nginx:alpine           # Web服务器

# 不同操作系统基础镜像
docker pull ubuntu:20.04           # Ubuntu系统
docker pull centos:7               # CentOS系统
docker pull alpine:latest          # 轻量级Alpine
```

### 2.2 docker images - 查看镜像列表


**🔸 核心功能**：
显示本地存储的所有Docker镜像

```bash
# 基本用法
docker images [OPTIONS] [REPOSITORY[:TAG]]

# 输出示例
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
nginx         latest    d1a364dc548d   2 weeks ago    133MB
ubuntu        20.04     ba6acccedd29   4 weeks ago    72.8MB
mysql         8.0       3218b38490ce   5 weeks ago    516MB
```

**📊 字段含义解释**：
- **REPOSITORY**: 镜像仓库名（如nginx、ubuntu）
- **TAG**: 镜像标签/版本号（如latest、20.04）  
- **IMAGE ID**: 镜像唯一标识符（前12位显示）
- **CREATED**: 镜像创建时间
- **SIZE**: 镜像占用磁盘空间大小

**🔍 实用过滤选项**：
```bash
# 显示所有镜像（包括中间层）
docker images -a

# 只显示镜像ID
docker images -q

# 格式化输出
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"

# 过滤特定镜像
docker images nginx*               # 以nginx开头的镜像
docker images --filter "dangling=true"  # 悬空镜像
```

### 2.3 docker rmi - 删除镜像


**🔸 基本功能**：
从本地删除不需要的Docker镜像，释放磁盘空间

```bash
# 基本语法
docker rmi [OPTIONS] IMAGE [IMAGE...]

# 常用示例
docker rmi nginx:1.19              # 删除指定版本
docker rmi d1a364dc548d            # 通过镜像ID删除
docker rmi nginx ubuntu mysql      # 批量删除多个镜像
```

> ⚠️ **重要提醒**：
> - 如果有容器正在使用该镜像，删除会失败
> - 使用 `-f` 强制删除（谨慎使用）
> - 删除前建议先停止相关容器

**🧹 批量清理技巧**：
```bash
# 删除所有悬空镜像（<none>标签）
docker rmi $(docker images -f "dangling=true" -q)

# 删除所有镜像（危险操作！）
docker rmi $(docker images -q)

# 删除指定时间前的镜像
docker images --filter "until=24h" -q | xargs docker rmi
```

### 2.4 docker tag - 镜像打标签


**🔸 用途说明**：
为现有镜像创建新的标签，通常用于版本管理或推送到不同仓库

```bash
# 基本语法
docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]

# 实际应用示例
docker tag nginx:latest myapp:v1.0         # 重命名镜像
docker tag nginx:latest localhost:5000/nginx:latest  # 为私有仓库打标签
docker tag myapp:latest myapp:prod         # 创建生产版本标签
```

**📋 常见使用场景**：

| 场景 | 命令示例 | 用途说明 |
|------|---------|---------|
| **版本管理** | `docker tag myapp:latest myapp:v2.1` | 为应用创建版本标签 |
| **环境区分** | `docker tag myapp:latest myapp:prod` | 区分生产/测试环境 |
| **仓库推送** | `docker tag nginx:latest hub.com/nginx:latest` | 推送到私有仓库前打标签 |

---

## 3. 🔨 镜像构建与制作命令


### 3.1 docker build - 构建镜像


**🔸 核心概念**：
根据Dockerfile文件构建自定义镜像，这是制作个性化镜像的主要方式

```bash
# 基本语法
docker build [OPTIONS] PATH | URL | -

# 常用示例
docker build -t myapp:v1.0 .              # 基本构建
docker build -t myapp:latest -f custom.dockerfile .  # 指定Dockerfile
docker build --no-cache -t myapp:v1.0 .   # 不使用缓存构建
```

**💡 参数详解**：
- `-t, --tag`: 为构建的镜像指定名称和标签
- `-f, --file`: 指定Dockerfile文件路径（默认为当前目录的Dockerfile）
- `--no-cache`: 不使用构建缓存，完全重新构建
- `.`: 构建上下文路径（当前目录）

**🏗️ 构建过程示例**：
```
构建流程图：
Dockerfile → Docker引擎 → 分层构建 → 生成镜像

Step 1/5 : FROM nginx:alpine
Step 2/5 : COPY . /usr/share/nginx/html
Step 3/5 : EXPOSE 80
Step 4/5 : CMD ["nginx", "-g", "daemon off;"]
Step 5/5 : Successfully built abc123456789
```

### 3.2 docker commit - 从容器创建镜像


**🔸 应用场景**：
将运行中容器的当前状态保存为新的镜像，适合临时修改保存

```bash
# 基本语法
docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]

# 实际使用示例
docker commit mycontainer myapp:v1.1      # 保存容器状态为镜像
docker commit -m "Added new features" mycontainer myapp:v1.1  # 添加提交信息
```

> 📖 **使用建议**：
> - `docker commit` 适合快速保存临时修改
> - 生产环境建议使用 `docker build` + Dockerfile
> - commit方式创建的镜像层次不够清晰

### 3.3 docker search - 搜索镜像


**🔸 功能介绍**：
在Docker Hub上搜索公开可用的镜像

```bash
# 基本搜索
docker search nginx

# 搜索结果示例
NAME                     DESCRIPTION                   STARS     OFFICIAL   AUTOMATED
nginx                    Official build of Nginx      15000     [OK]       
nginx/nginx-ingress      NGINX Ingress Controller...   1000                 [OK]
```

**🔍 搜索技巧**：
```bash
# 限制搜索结果数量
docker search --limit=5 python

# 过滤官方镜像
docker search --filter is-official=true mysql

# 过滤最低星级
docker search --filter stars=100 redis
```

---

## 4. 💾 镜像导入导出命令


### 4.1 docker save - 导出镜像


**🔸 应用场景**：
将镜像保存为tar文件，用于离线传输或备份

```bash
# 基本语法
docker save [OPTIONS] IMAGE [IMAGE...]

# 实用示例
docker save nginx:latest > nginx.tar              # 导出单个镜像
docker save -o myapp.tar myapp:v1.0              # 使用-o指定输出文件
docker save nginx:latest mysql:8.0 > multi.tar   # 导出多个镜像
```

**📦 导出文件特点**：
- 包含镜像的所有层信息
- 保留镜像标签和元数据
- 可以在没有网络的环境中使用
- 文件较大，包含完整镜像数据

### 4.2 docker load - 导入镜像


**🔸 基本功能**：
从tar文件加载镜像到Docker环境

```bash
# 基本语法
docker load [OPTIONS]

# 常用示例
docker load < nginx.tar                # 从文件导入镜像
docker load -i myapp.tar              # 使用-i指定输入文件
cat nginx.tar | docker load           # 通过管道导入
```

**⚡ 导入导出完整流程**：
```bash
# 场景：服务器A导出镜像，传输到服务器B
# 服务器A执行：
docker save myapp:v1.0 > myapp.tar

# 文件传输（scp、U盘等方式）
scp myapp.tar user@serverB:/tmp/

# 服务器B执行：
docker load < /tmp/myapp.tar
```

---

## 5. 🔍 镜像信息查看命令


### 5.1 docker inspect - 查看镜像详情


**🔸 核心功能**：
显示镜像的完整详细信息，包括配置、层信息、元数据等

```bash
# 基本用法
docker inspect nginx:latest

# 格式化输出特定字段
docker inspect --format='{{.Config.ExposedPorts}}' nginx:latest
docker inspect --format='{{.RepoTags}}' nginx:latest
```

**📊 主要信息内容**：
- **Id**: 镜像完整ID
- **RepoTags**: 仓库标签信息
- **Config**: 镜像配置（环境变量、端口等）
- **Architecture**: 系统架构
- **RootFS**: 文件系统层信息

### 5.2 docker history - 查看镜像历史


**🔸 实用价值**：
显示镜像的构建历史，了解每一层的创建过程和大小

```bash
# 基本用法
docker history nginx:latest

# 输出示例
IMAGE          CREATED        CREATED BY                                      SIZE
d1a364dc548d   2 weeks ago    /bin/sh -c #(nop)  CMD ["nginx" "-g" "daemon   0B
<missing>      2 weeks ago    /bin/sh -c #(nop)  STOPSIGNAL SIGQUIT          0B
<missing>      2 weeks ago    /bin/sh -c #(nop)  EXPOSE 80                   0B
```

**🔍 分析镜像层级**：
```bash
# 显示完整命令（不截断）
docker history --no-trunc nginx:latest

# 以可读格式显示大小
docker history --human nginx:latest
```

---

## 6. 🚀 实用操作技巧总结


### 6.1 镜像管理最佳实践


**📋 日常管理建议**：

```bash
# 1. 定期清理悬空镜像
docker image prune

# 2. 清理所有未使用的镜像
docker image prune -a

# 3. 查看镜像占用空间
docker system df

# 4. 批量操作示例
docker images -q | xargs docker inspect --format='{{.RepoTags}} {{.Size}}'
```

### 6.2 镜像命名规范


**🏷️ 推荐命名方式**：

| 环境类型 | 命名示例 | 说明 |
|---------|---------|------|
| **开发环境** | `myapp:dev-v1.0` | 开发版本标记 |
| **测试环境** | `myapp:test-v1.0` | 测试版本标记 |
| **生产环境** | `myapp:prod-v1.0` | 生产版本标记 |
| **特性分支** | `myapp:feature-auth-v1.0` | 功能特性标记 |

### 6.3 常用命令组合


**⚡ 实用命令脚本**：

```bash
# 镜像信息一览脚本
#!/bin/bash
echo "=== 本地镜像统计 ==="
docker images | wc -l
echo "=== 镜像占用空间 ==="
docker system df
echo "=== 悬空镜像数量 ==="
docker images -f "dangling=true" | wc -l

# 镜像备份脚本
#!/bin/bash
IMAGE_NAME=$1
BACKUP_DIR="/backup/docker-images"
mkdir -p $BACKUP_DIR
docker save $IMAGE_NAME > $BACKUP_DIR/${IMAGE_NAME//\//_}.tar
echo "镜像 $IMAGE_NAME 已备份到 $BACKUP_DIR"
```

### 6.4 核心要点总结


**💡 必须掌握的核心概念**：
- **镜像本质**：只读的文件系统模板，包含运行应用所需的一切
- **分层存储**：节省空间和传输时间的关键技术
- **标签管理**：合理的标签命名有助于版本控制

**🔥 高频使用命令**：
- `docker pull` - 获取镜像（使用频率★★★★★）
- `docker images` - 查看镜像（使用频率★★★★★）  
- `docker rmi` - 删除镜像（使用频率★★★★）
- `docker build` - 构建镜像（使用频率★★★★）

**⚠️ 注意事项**：
- 删除镜像前确保没有容器在使用
- 定期清理悬空镜像释放存储空间
- 生产环境使用确定的版本标签而非latest
- 构建镜像时注意.dockerignore文件的使用

**核心记忆口诀**：
```
拉取镜像用pull，查看列表用images
删除镜像用rmi，打标签用tag
构建镜像用build，提交修改用commit
导出save导入load，详情历史inspect查
```