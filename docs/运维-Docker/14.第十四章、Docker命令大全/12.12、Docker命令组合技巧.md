---
title: 12ã€Dockerå‘½ä»¤ç»„åˆæŠ€å·§
---
## ğŸ“š ç›®å½•

1. [Dockerå‘½ä»¤ç»„åˆåŸºç¡€æ¦‚å¿µ](#1-Dockerå‘½ä»¤ç»„åˆåŸºç¡€æ¦‚å¿µ)
2. [æ‰¹é‡æ“ä½œå‘½ä»¤ç»„åˆ](#2-æ‰¹é‡æ“ä½œå‘½ä»¤ç»„åˆ)
3. [ç®¡é“å‘½ä»¤ä½¿ç”¨æŠ€å·§](#3-ç®¡é“å‘½ä»¤ä½¿ç”¨æŠ€å·§)
4. [æ¡ä»¶è¿‡æ»¤å‘½ä»¤ç»„åˆ](#4-æ¡ä»¶è¿‡æ»¤å‘½ä»¤ç»„åˆ)
5. [è„šæœ¬è‡ªåŠ¨åŒ–å‘½ä»¤](#5-è„šæœ¬è‡ªåŠ¨åŒ–å‘½ä»¤)
6. [å¿«é€Ÿæ¸…ç†å‘½ä»¤ç»„åˆ](#6-å¿«é€Ÿæ¸…ç†å‘½ä»¤ç»„åˆ)
7. [ç›‘æ§è¯Šæ–­å‘½ä»¤ç»„åˆ](#7-ç›‘æ§è¯Šæ–­å‘½ä»¤ç»„åˆ)
8. [å¤‡ä»½æ¢å¤å‘½ä»¤ç»„åˆ](#8-å¤‡ä»½æ¢å¤å‘½ä»¤ç»„åˆ)
9. [ä¸€é”®éƒ¨ç½²å‘½ä»¤ç»„åˆ](#9-ä¸€é”®éƒ¨ç½²å‘½ä»¤ç»„åˆ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Dockerå‘½ä»¤ç»„åˆåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Dockerå‘½ä»¤ç»„åˆ


**ğŸ¯ åŸºæœ¬å®šä¹‰**
```
Dockerå‘½ä»¤ç»„åˆï¼šå°†å¤šä¸ªDockerå‘½ä»¤é€šè¿‡ç‰¹å®šæ–¹å¼è¿æ¥ï¼Œå®ç°å¤æ‚æ“ä½œçš„æŠ€å·§
ç›®çš„ï¼šæé«˜æ“ä½œæ•ˆç‡ï¼Œå‡å°‘é‡å¤è¾“å…¥ï¼Œå®ç°æ‰¹é‡ç®¡ç†
æ ¸å¿ƒæ€æƒ³ï¼šä¸€æ¡å‘½ä»¤å®ŒæˆåŸæœ¬éœ€è¦å¤šæ­¥æ“ä½œçš„ä»»åŠ¡
```

**ğŸ’¡ ç»„åˆæ–¹å¼è¯´æ˜**
```
å¸¸è§ç»„åˆæ–¹å¼ï¼š
â€¢ ç®¡é“æ“ä½œï¼ˆ|ï¼‰ï¼šå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥
â€¢ é€»è¾‘è¿æ¥ï¼ˆ&& ||ï¼‰ï¼šæ ¹æ®å‰ä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœå†³å®šæ˜¯å¦æ‰§è¡Œä¸‹ä¸€ä¸ª
â€¢ å˜é‡æ›¿æ¢ï¼ˆ$()ï¼‰ï¼šå°†å‘½ä»¤ç»“æœä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„å‚æ•°
â€¢ æ¡ä»¶åˆ¤æ–­ï¼šåŸºäºç‰¹å®šæ¡ä»¶æ‰§è¡Œç›¸åº”æ“ä½œ
```

### 1.2 å‘½ä»¤ç»„åˆçš„ä¼˜åŠ¿


**âš¡ å®é™…æ•ˆæœå¯¹æ¯”**
```
ä¼ ç»Ÿæ“ä½œæ–¹å¼ï¼š
1. docker ps -a                     # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
2. æ‰‹åŠ¨è®°å½•è¦åˆ é™¤çš„å®¹å™¨ID
3. docker rm container1 container2  # é€ä¸ªåˆ é™¤

ç»„åˆå‘½ä»¤æ–¹å¼ï¼š
docker rm $(docker ps -aq)          # ä¸€æ¡å‘½ä»¤åˆ é™¤æ‰€æœ‰å®¹å™¨

æ•ˆç‡æå‡ï¼šä»3æ­¥æ“ä½œå˜æˆ1æ­¥ï¼Œå‡å°‘70%çš„è¾“å…¥é‡
```

### 1.3 å‘½ä»¤ç»„åˆçš„åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**
```
ğŸ”¸ æ‰¹é‡ç®¡ç†ï¼šåŒæ—¶æ“ä½œå¤šä¸ªå®¹å™¨æˆ–é•œåƒ
ğŸ”¸ ç¯å¢ƒæ¸…ç†ï¼šå¿«é€Ÿæ¸…ç†ä¸éœ€è¦çš„èµ„æº
ğŸ”¸ è‡ªåŠ¨éƒ¨ç½²ï¼šä¸€é”®å®Œæˆå¤æ‚çš„éƒ¨ç½²æµç¨‹
ğŸ”¸ ç³»ç»Ÿç›‘æ§ï¼šç»„åˆå¤šä¸ªå‘½ä»¤è¿›è¡ŒçŠ¶æ€æ£€æŸ¥
ğŸ”¸ æ•°æ®å¤‡ä»½ï¼šè‡ªåŠ¨åŒ–å¤‡ä»½å’Œæ¢å¤æµç¨‹
ğŸ”¸ æ•…éšœè¯Šæ–­ï¼šå¿«é€Ÿæ”¶é›†ç³»ç»Ÿè¯Šæ–­ä¿¡æ¯
```

---

## 2. ğŸš€ æ‰¹é‡æ“ä½œå‘½ä»¤ç»„åˆ


### 2.1 æ‰¹é‡å®¹å™¨æ“ä½œ


**ğŸ“¦ æ‰¹é‡å¯åŠ¨å’Œåœæ­¢å®¹å™¨**

```bash
# å¯åŠ¨æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨
docker start $(docker ps -aq --filter "status=exited")

# åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨
docker stop $(docker ps -q)

# é‡å¯æ‰€æœ‰å®¹å™¨
docker restart $(docker ps -aq)
```

**ğŸ”„ æ‰¹é‡å®¹å™¨ç®¡ç†å®ä¾‹**
```
å®é™…åœºæ™¯ï¼šå¾®æœåŠ¡æ¶æ„ä¸­æœ‰10ä¸ªæœåŠ¡å®¹å™¨éœ€è¦é‡å¯

ä¼ ç»Ÿåšæ³•ï¼š
docker restart web-service
docker restart api-service  
docker restart db-service
... ï¼ˆéœ€è¦è¾“å…¥10æ¬¡ï¼‰

é«˜æ•ˆåšæ³•ï¼š
docker restart $(docker ps -q --filter "label=env=production")

è§£é‡Šï¼šé€šè¿‡æ ‡ç­¾è¿‡æ»¤ï¼Œä¸€æ¬¡æ€§é‡å¯æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒçš„å®¹å™¨
```

### 2.2 æ‰¹é‡é•œåƒæ“ä½œ


**ğŸ–¼ï¸ é•œåƒæ‰¹é‡ç®¡ç†**

```bash
# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ
docker rmi $(docker images -q --filter "dangling=true")

# åˆ é™¤æŒ‡å®šæ ‡ç­¾çš„æ‰€æœ‰é•œåƒç‰ˆæœ¬
docker rmi $(docker images nginx --format "table {{.Repository}}:{{.Tag}}" | tail -n +2)

# æ‹‰å–å¤šä¸ªé•œåƒçš„æœ€æ–°ç‰ˆæœ¬
for image in nginx mysql redis; do docker pull $image:latest; done
```

### 2.3 æ‰¹é‡ç½‘ç»œå’Œå­˜å‚¨å·æ“ä½œ


**ğŸŒ ç½‘ç»œå’Œå­˜å‚¨æ‰¹é‡ç®¡ç†**

```bash
# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ
docker network rm $(docker network ls -q --filter "driver=bridge")

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·
docker volume rm $(docker volume ls -q --filter "dangling=true")

# æ‰¹é‡åˆ›å»ºæ•°æ®å·
for vol in web-data api-data db-data; do docker volume create $vol; done
```

---

## 3. ğŸ”— ç®¡é“å‘½ä»¤ä½¿ç”¨æŠ€å·§


### 3.1 ç®¡é“åŸºç¡€æ“ä½œ


**ğŸ”§ ç®¡é“ç¬¦å·å«ä¹‰**
```
ç®¡é“ç¬¦å·ï¼ˆ|ï¼‰çš„ä½œç”¨ï¼š
â€¢ å°†å‰ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡ºä¼ é€’ç»™åä¸€ä¸ªå‘½ä»¤ä½œä¸ºæ ‡å‡†è¾“å…¥
â€¢ å®ç°å‘½ä»¤é—´çš„æ•°æ®æµè½¬
â€¢ å¯ä»¥è¿æ¥å¤šä¸ªå‘½ä»¤å½¢æˆå¤„ç†é“¾

åŸºæœ¬è¯­æ³•ï¼š
å‘½ä»¤1 | å‘½ä»¤2 | å‘½ä»¤3
```

### 3.2 å¸¸ç”¨ç®¡é“ç»„åˆ


**ğŸ“Š ä¿¡æ¯æå–å’Œæ ¼å¼åŒ–**

```bash
# æŸ¥çœ‹å®¹å™¨å ç”¨çš„ç«¯å£
docker ps --format "table {{.Names}}\t{{.Ports}}" | column -t

# ç»Ÿè®¡ä¸åŒçŠ¶æ€çš„å®¹å™¨æ•°é‡
docker ps -a --format "{{.Status}}" | cut -d' ' -f1 | sort | uniq -c

# æŸ¥æ‰¾å ç”¨å†…å­˜æœ€å¤šçš„å®¹å™¨
docker stats --no-stream --format "table {{.Container}}\t{{.MemUsage}}" | sort -k2 -hr | head -5
```

**ğŸ” æ—¥å¿—åˆ†æç»„åˆ**
```bash
# æŸ¥çœ‹åŒ…å«ERRORçš„æœ€æ–°æ—¥å¿—
docker logs container_name 2>&1 | grep ERROR | tail -10

# ç»Ÿè®¡æ—¥å¿—ä¸­å„ç±»é”™è¯¯çš„æ•°é‡
docker logs container_name 2>&1 | grep -E "(ERROR|WARN|FATAL)" | cut -d':' -f2 | sort | uniq -c

# å®æ—¶ç›‘æ§æ—¥å¿—ä¸­çš„ç‰¹å®šå…³é”®è¯
docker logs -f container_name | grep --line-buffered "payment"
```

### 3.3 é«˜çº§ç®¡é“åº”ç”¨


**âš¡ å¤æ‚æ•°æ®å¤„ç†é“¾**

```bash
# æ‰¾å‡ºå ç”¨ç£ç›˜ç©ºé—´æœ€å¤§çš„é•œåƒ
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" | \
sort -k3 -hr | head -10

# è·å–è¿è¡Œæ—¶é—´æœ€é•¿çš„å®¹å™¨
docker ps --format "table {{.Names}}\t{{.RunningFor}}" | \
sort -k2 -n | tail -5

# æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€å¹¶å‘é€å‘Šè­¦
docker ps --filter "health=unhealthy" --format "{{.Names}}" | \
xargs -I {} echo "å®¹å™¨ {} çŠ¶æ€å¼‚å¸¸ï¼Œéœ€è¦æ£€æŸ¥"
```

---

## 4. ğŸ¯ æ¡ä»¶è¿‡æ»¤å‘½ä»¤ç»„åˆ


### 4.1 åŸºç¡€è¿‡æ»¤æ¡ä»¶


**ğŸ” Dockerå†…ç½®è¿‡æ»¤å™¨**

| è¿‡æ»¤å™¨ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ç”¨æ³• |
|-----------|------|----------|
| **status** | `å®¹å™¨çŠ¶æ€è¿‡æ»¤` | `--filter "status=running"` |
| **label** | `æ ‡ç­¾è¿‡æ»¤` | `--filter "label=env=prod"` |
| **name** | `åç§°è¿‡æ»¤` | `--filter "name=web"` |
| **ancestor** | `é•œåƒè¿‡æ»¤` | `--filter "ancestor=nginx"` |
| **dangling** | `æ‚¬ç©ºèµ„æº` | `--filter "dangling=true"` |

### 4.2 ç»„åˆè¿‡æ»¤æŠ€å·§


**ğŸ¨ å¤šæ¡ä»¶ç»„åˆè¿‡æ»¤**

```bash
# æŸ¥æ‰¾ç”Ÿäº§ç¯å¢ƒä¸­å·²åœæ­¢çš„WebæœåŠ¡å®¹å™¨
docker ps -a --filter "status=exited" --filter "label=env=production" --filter "name=web"

# åˆ é™¤7å¤©å‰åˆ›å»ºçš„æœªä½¿ç”¨é•œåƒ
docker images --filter "dangling=true" --filter "before=$(date -d '7 days ago' '+%Y-%m-%d')" -q | xargs docker rmi

# é‡å¯æ‰€æœ‰å¥åº·æ£€æŸ¥å¤±è´¥çš„å®¹å™¨
docker ps --filter "health=unhealthy" -q | xargs docker restart
```

### 4.3 æ—¶é—´æ¡ä»¶è¿‡æ»¤


**â° åŸºäºæ—¶é—´çš„è¿‡æ»¤æ“ä½œ**

```bash
# åˆ é™¤ä¸€å‘¨å‰åˆ›å»ºçš„å®¹å™¨
docker ps -a --filter "status=exited" --format "{{.ID}} {{.CreatedAt}}" | \
awk -v date="$(date -d '1 week ago' '+%Y-%m-%d')" '$2 < date {print $1}' | \
xargs docker rm

# æŸ¥çœ‹æœ€è¿‘1å°æ—¶çš„å®¹å™¨æ—¥å¿—
docker ps -q | xargs -I {} sh -c 'echo "=== {} ==="; docker logs --since="1h" {}'
```

---

## 5. ğŸ¤– è„šæœ¬è‡ªåŠ¨åŒ–å‘½ä»¤


### 5.1 åŸºç¡€è‡ªåŠ¨åŒ–è„šæœ¬


**ğŸ“ Dockerè¿ç»´è„šæœ¬ç¤ºä¾‹**

```bash
#!/bin/bash
# Dockerå®¹å™¨å¥åº·æ£€æŸ¥è„šæœ¬

echo "ğŸ” å¼€å§‹Dockerç¯å¢ƒæ£€æŸ¥..."

# æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
if ! systemctl is-active --quiet docker; then
    echo "âŒ DockeræœåŠ¡æœªè¿è¡Œ"
    exit 1
fi

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
unhealthy=$(docker ps --filter "health=unhealthy" -q | wc -l)
if [ $unhealthy -gt 0 ]; then
    echo "âš ï¸  å‘ç° $unhealthy ä¸ªä¸å¥åº·çš„å®¹å™¨"
    docker ps --filter "health=unhealthy" --format "table {{.Names}}\t{{.Status}}"
fi

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
echo "ğŸ’¾ ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š"
docker system df

echo "âœ… æ£€æŸ¥å®Œæˆ"
```

### 5.2 éƒ¨ç½²è‡ªåŠ¨åŒ–è„šæœ¬


**ğŸš€ åº”ç”¨éƒ¨ç½²è„šæœ¬**

```bash
#!/bin/bash
# åº”ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬

APP_NAME="my-web-app"
IMAGE_TAG="latest"
CONTAINER_PORT="8080"
HOST_PORT="80"

echo "ğŸš€ å¼€å§‹éƒ¨ç½² $APP_NAME..."

# åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨
if docker ps -a --format "{{.Names}}" | grep -q "^${APP_NAME}$"; then
    echo "ğŸ”„ åœæ­¢æ—§å®¹å™¨..."
    docker stop $APP_NAME && docker rm $APP_NAME
fi

# æ‹‰å–æœ€æ–°é•œåƒ
echo "ğŸ“¥ æ‹‰å–æœ€æ–°é•œåƒ..."
docker pull $APP_NAME:$IMAGE_TAG

# å¯åŠ¨æ–°å®¹å™¨
echo "â–¶ï¸  å¯åŠ¨æ–°å®¹å™¨..."
docker run -d \
    --name $APP_NAME \
    --restart unless-stopped \
    -p $HOST_PORT:$CONTAINER_PORT \
    -e ENV=production \
    $APP_NAME:$IMAGE_TAG

# éªŒè¯éƒ¨ç½²
sleep 5
if docker ps --format "{{.Names}}" | grep -q "^${APP_NAME}$"; then
    echo "âœ… éƒ¨ç½²æˆåŠŸï¼åº”ç”¨è¿è¡Œåœ¨ç«¯å£ $HOST_PORT"
else
    echo "âŒ éƒ¨ç½²å¤±è´¥ï¼"
    exit 1
fi
```

### 5.3 ç›‘æ§è„šæœ¬


**ğŸ“Š ç³»ç»Ÿç›‘æ§è‡ªåŠ¨åŒ–**

```bash
#!/bin/bash
# Dockerèµ„æºç›‘æ§è„šæœ¬

while true; do
    clear
    echo "ğŸ“Š Dockerèµ„æºç›‘æ§ - $(date)"
    echo "================================"
    
    # æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
    echo "ğŸƒ è¿è¡Œä¸­çš„å®¹å™¨ï¼š"
    docker stats --no-stream --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.NetIO}}"
    
    echo -e "\nğŸ’¾ ç£ç›˜ç©ºé—´ä½¿ç”¨ï¼š"
    docker system df
    
    echo -e "\nğŸ” å¼‚å¸¸å®¹å™¨ï¼š"
    docker ps -a --filter "status=exited" --format "table {{.Names}}\t{{.Status}}\t{{.CreatedAt}}"
    
    sleep 10
done
```

---

## 6. ğŸ§¹ å¿«é€Ÿæ¸…ç†å‘½ä»¤ç»„åˆ


### 6.1 ç³»ç»Ÿæ¸…ç†å‘½ä»¤


**ğŸ—‘ï¸ ä¸€é”®æ¸…ç†ä¸éœ€è¦çš„èµ„æº**

```bash
# Dockerç³»ç»Ÿå…¨é¢æ¸…ç†ï¼ˆå±é™©æ“ä½œï¼Œè¯·è°¨æ…ä½¿ç”¨ï¼‰
docker system prune -af --volumes

# åˆ†æ­¥æ¸…ç†ï¼Œæ›´å®‰å…¨çš„æ–¹å¼
echo "æ¸…ç†åœæ­¢çš„å®¹å™¨..."
docker container prune -f

echo "æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ..."
docker image prune -af

echo "æ¸…ç†æœªä½¿ç”¨çš„ç½‘ç»œ..."
docker network prune -f

echo "æ¸…ç†æœªä½¿ç”¨çš„æ•°æ®å·..."
docker volume prune -f
```

### 6.2 é€‰æ‹©æ€§æ¸…ç†


**ğŸ¯ ç²¾ç¡®æ¸…ç†ç‰¹å®šèµ„æº**

```bash
# æ¸…ç†å¼€å‘ç¯å¢ƒç›¸å…³èµ„æº
docker rm $(docker ps -aq --filter "label=env=development")
docker rmi $(docker images --filter "label=env=development" -q)

# æ¸…ç†è¶…è¿‡30å¤©çš„å®¹å™¨å’Œé•œåƒ
docker container prune --filter "until=720h"
docker image prune -a --filter "until=720h"

# æ¸…ç†æŒ‡å®šå¤§å°ä»¥ä¸Šçš„é•œåƒ
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" | \
grep -E "[0-9]+GB" | awk '{print $1":"$2}' | xargs docker rmi
```

### 6.3 å®‰å…¨æ¸…ç†è„šæœ¬


**ğŸ›¡ï¸ å¸¦ç¡®è®¤çš„å®‰å…¨æ¸…ç†**

```bash
#!/bin/bash
# å®‰å…¨çš„Dockeræ¸…ç†è„šæœ¬

echo "ğŸ§¹ Dockerèµ„æºæ¸…ç†å·¥å…·"
echo "====================="

# æ˜¾ç¤ºå½“å‰èµ„æºå ç”¨
echo "ğŸ“Š å½“å‰èµ„æºä½¿ç”¨æƒ…å†µï¼š"
docker system df

echo -e "\nå°†è¦æ¸…ç†çš„èµ„æºï¼š"
echo "â€¢ åœæ­¢çš„å®¹å™¨: $(docker ps -aq --filter 'status=exited' | wc -l) ä¸ª"
echo "â€¢ æœªä½¿ç”¨çš„é•œåƒ: $(docker images -q --filter 'dangling=true' | wc -l) ä¸ª"
echo "â€¢ æœªä½¿ç”¨çš„ç½‘ç»œ: $(docker network ls --filter 'driver=bridge' -q | wc -l) ä¸ª"
echo "â€¢ æœªä½¿ç”¨çš„æ•°æ®å·: $(docker volume ls --filter 'dangling=true' -q | wc -l) ä¸ª"

read -p "æ˜¯å¦ç»§ç»­æ¸…ç†ï¼Ÿ(y/N): " confirm
if [[ $confirm == [yY] ]]; then
    echo "ğŸ—‘ï¸  å¼€å§‹æ¸…ç†..."
    docker system prune -f
    echo "âœ… æ¸…ç†å®Œæˆï¼"
else
    echo "âŒ å·²å–æ¶ˆæ¸…ç†æ“ä½œ"
fi
```

---

## 7. ğŸ“Š ç›‘æ§è¯Šæ–­å‘½ä»¤ç»„åˆ


### 7.1 æ€§èƒ½ç›‘æ§ç»„åˆ


**âš¡ å®æ—¶æ€§èƒ½ç›‘æ§**

```bash
# ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨æ’è¡Œ
watch -n 2 "docker stats --no-stream --format 'table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}' | sort -k3 -hr"

# ç›‘æ§å®¹å™¨ç½‘ç»œæµé‡
docker ps -q | xargs -I {} sh -c 'echo "=== {} ==="; docker exec {} cat /proc/net/dev | grep -E "(eth0|lo)"'

# æ£€æŸ¥å®¹å™¨è¿›ç¨‹çŠ¶æ€
docker ps -q | xargs -I {} sh -c 'echo "=== {} ==="; docker exec {} ps aux --sort=-%cpu | head -5'
```

### 7.2 æ—¥å¿—è¯Šæ–­ç»„åˆ


**ğŸ” æ—¥å¿—åˆ†æå’Œè¯Šæ–­**

```bash
# æ”¶é›†æ‰€æœ‰å®¹å™¨çš„é”™è¯¯æ—¥å¿—
for container in $(docker ps --format "{{.Names}}"); do
    echo "=== $container é”™è¯¯æ—¥å¿— ==="
    docker logs $container 2>&1 | grep -i error | tail -5
    echo ""
done

# æ£€æŸ¥å®¹å™¨å¯åŠ¨å¤±è´¥åŸå› 
docker ps -a --filter "status=exited" --filter "status=dead" \
--format "table {{.Names}}\t{{.Status}}\t{{.CreatedAt}}" | \
while read name status created; do
    if [[ $name != "NAMES" ]]; then
        echo "å®¹å™¨: $name, çŠ¶æ€: $status, åˆ›å»ºæ—¶é—´: $created"
        echo "é€€å‡ºåŸå› : $(docker logs $name 2>&1 | tail -3)"
        echo "---"
    fi
done
```

### 7.3 å¥åº·çŠ¶æ€æ£€æŸ¥


**ğŸ¥ å…¨é¢å¥åº·æ£€æŸ¥**

```bash
#!/bin/bash
# Dockerç¯å¢ƒå¥åº·æ£€æŸ¥è„šæœ¬

echo "ğŸ¥ Dockerç¯å¢ƒå¥åº·æ£€æŸ¥æŠ¥å‘Š"
echo "=========================="
echo "æ£€æŸ¥æ—¶é—´: $(date)"
echo ""

# 1. DockeræœåŠ¡çŠ¶æ€
echo "ğŸ“‹ DockeræœåŠ¡çŠ¶æ€:"
systemctl is-active docker && echo "âœ… DockeræœåŠ¡æ­£å¸¸" || echo "âŒ DockeræœåŠ¡å¼‚å¸¸"
echo ""

# 2. å®¹å™¨çŠ¶æ€ç»Ÿè®¡
echo "ğŸ“Š å®¹å™¨çŠ¶æ€ç»Ÿè®¡:"
docker ps -a --format "{{.Status}}" | cut -d' ' -f1 | sort | uniq -c
echo ""

# 3. èµ„æºä½¿ç”¨æƒ…å†µ
echo "ğŸ’¾ èµ„æºä½¿ç”¨æƒ…å†µ:"
docker system df
echo ""

# 4. å¼‚å¸¸å®¹å™¨åˆ—è¡¨
echo "âš ï¸  å¼‚å¸¸å®¹å™¨:"
docker ps -a --filter "status=exited" --filter "status=dead" \
--format "table {{.Names}}\t{{.Status}}\t{{.Image}}"
echo ""

# 5. ç½‘ç»œè¿é€šæ€§æ£€æŸ¥
echo "ğŸŒ ç½‘ç»œçŠ¶æ€:"
docker network ls --format "table {{.Name}}\t{{.Driver}}\t{{.Scope}}"
```

---

## 8. ğŸ’¾ å¤‡ä»½æ¢å¤å‘½ä»¤ç»„åˆ


### 8.1 å®¹å™¨æ•°æ®å¤‡ä»½


**ğŸ“¦ å®¹å™¨å’Œæ•°æ®å¤‡ä»½**

```bash
# å¤‡ä»½å®¹å™¨ä¸ºé•œåƒ
backup_container() {
    local container_name=$1
    local backup_name="${container_name}_backup_$(date +%Y%m%d_%H%M%S)"
    
    echo "ğŸ“¦ å¤‡ä»½å®¹å™¨ $container_name ä¸ºé•œåƒ $backup_name"
    docker commit $container_name $backup_name
    docker save $backup_name > "${backup_name}.tar"
    echo "âœ… å¤‡ä»½å®Œæˆ: ${backup_name}.tar"
}

# å¤‡ä»½æ•°æ®å·
backup_volume() {
    local volume_name=$1
    local backup_file="${volume_name}_$(date +%Y%m%d_%H%M%S).tar.gz"
    
    echo "ğŸ’¾ å¤‡ä»½æ•°æ®å· $volume_name"
    docker run --rm -v $volume_name:/data -v $(pwd):/backup alpine \
        tar czf /backup/$backup_file -C /data .
    echo "âœ… æ•°æ®å·å¤‡ä»½å®Œæˆ: $backup_file"
}
```

### 8.2 æ‰¹é‡å¤‡ä»½è„šæœ¬


**ğŸ—ƒï¸ å…¨é‡å¤‡ä»½è‡ªåŠ¨åŒ–**

```bash
#!/bin/bash
# Dockerç¯å¢ƒå…¨é‡å¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/docker/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

echo "ğŸ—ƒï¸  å¼€å§‹Dockerç¯å¢ƒå…¨é‡å¤‡ä»½..."
echo "å¤‡ä»½ç›®å½•: $BACKUP_DIR"

# 1. å¤‡ä»½æ‰€æœ‰é•œåƒåˆ—è¡¨
echo "ğŸ“‹ å¯¼å‡ºé•œåƒåˆ—è¡¨..."
docker images --format "{{.Repository}}:{{.Tag}}" > $BACKUP_DIR/images_list.txt

# 2. å¤‡ä»½é‡è¦é•œåƒ
echo "ğŸ–¼ï¸  å¤‡ä»½æ ¸å¿ƒé•œåƒ..."
while read image; do
    if [[ $image =~ ^(nginx|mysql|redis|my-app) ]]; then
        image_file=$(echo $image | tr '/:' '_')
        docker save $image > $BACKUP_DIR/${image_file}.tar
        echo "  âœ… å·²å¤‡ä»½: $image"
    fi
done < $BACKUP_DIR/images_list.txt

# 3. å¤‡ä»½å®¹å™¨é…ç½®
echo "âš™ï¸  å¯¼å‡ºå®¹å™¨é…ç½®..."
docker ps -a --format "{{.Names}}" | while read container; do
    docker inspect $container > $BACKUP_DIR/${container}_config.json
done

# 4. å¤‡ä»½æ•°æ®å·
echo "ğŸ’¾ å¤‡ä»½æ•°æ®å·..."
docker volume ls -q | while read volume; do
    docker run --rm -v $volume:/data -v $BACKUP_DIR:/backup alpine \
        tar czf /backup/${volume}.tar.gz -C /data .
    echo "  âœ… å·²å¤‡ä»½æ•°æ®å·: $volume"
done

echo "ğŸ‰ å¤‡ä»½å®Œæˆ! å¤‡ä»½ä½ç½®: $BACKUP_DIR"
```

### 8.3 æ¢å¤å‘½ä»¤ç»„åˆ


**ğŸ”„ æ•°æ®æ¢å¤æ“ä½œ**

```bash
#!/bin/bash
# Dockerç¯å¢ƒæ¢å¤è„šæœ¬

BACKUP_DIR=$1
if [ -z "$BACKUP_DIR" ]; then
    echo "âŒ è¯·æŒ‡å®šå¤‡ä»½ç›®å½•"
    echo "ç”¨æ³•: $0 /path/to/backup"
    exit 1
fi

echo "ğŸ”„ å¼€å§‹æ¢å¤Dockerç¯å¢ƒ..."
echo "å¤‡ä»½æº: $BACKUP_DIR"

# 1. æ¢å¤é•œåƒ
echo "ğŸ–¼ï¸  æ¢å¤é•œåƒ..."
find $BACKUP_DIR -name "*.tar" -not -name "*volume*" | while read tar_file; do
    echo "  ğŸ“¥ åŠ è½½é•œåƒ: $(basename $tar_file)"
    docker load < $tar_file
done

# 2. æ¢å¤æ•°æ®å·
echo "ğŸ’¾ æ¢å¤æ•°æ®å·..."
find $BACKUP_DIR -name "*volume*.tar.gz" | while read volume_backup; do
    volume_name=$(basename $volume_backup .tar.gz | sed 's/_volume//')
    docker volume create $volume_name
    docker run --rm -v $volume_name:/data -v $BACKUP_DIR:/backup alpine \
        tar xzf /backup/$(basename $volume_backup) -C /data
    echo "  âœ… å·²æ¢å¤æ•°æ®å·: $volume_name"
done

echo "ğŸ‰ æ¢å¤å®Œæˆ!"
```

---

## 9. ğŸš€ ä¸€é”®éƒ¨ç½²å‘½ä»¤ç»„åˆ


### 9.1 å•åº”ç”¨éƒ¨ç½²


**âš¡ å¿«é€Ÿåº”ç”¨éƒ¨ç½²**

```bash
# ä¸€é”®éƒ¨ç½²Webåº”ç”¨
deploy_web_app() {
    local app_name=$1
    local image=$2
    local port=$3
    
    echo "ğŸš€ éƒ¨ç½²åº”ç”¨: $app_name"
    
    # åœæ­¢æ—§ç‰ˆæœ¬
    docker stop $app_name 2>/dev/null || true
    docker rm $app_name 2>/dev/null || true
    
    # æ‹‰å–æœ€æ–°é•œåƒ
    docker pull $image
    
    # å¯åŠ¨æ–°å®¹å™¨
    docker run -d \
        --name $app_name \
        --restart unless-stopped \
        -p $port:80 \
        -e NODE_ENV=production \
        $image
    
    # å¥åº·æ£€æŸ¥
    sleep 5
    if curl -f http://localhost:$port/health 2>/dev/null; then
        echo "âœ… éƒ¨ç½²æˆåŠŸ! åº”ç”¨è¿è¡Œåœ¨ç«¯å£ $port"
    else
        echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åº”ç”¨çŠ¶æ€"
    fi
}

# ä½¿ç”¨ç¤ºä¾‹
deploy_web_app "my-web-app" "nginx:latest" "8080"
```

### 9.2 å¾®æœåŠ¡æ‰¹é‡éƒ¨ç½²


**ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„éƒ¨ç½²**

```bash
#!/bin/bash
# å¾®æœåŠ¡æ‰¹é‡éƒ¨ç½²è„šæœ¬

# æœåŠ¡é…ç½®
declare -A services=(
    ["web"]="my-web:latest:8080:80"
    ["api"]="my-api:latest:8081:3000" 
    ["db"]="postgres:13:5432:5432"
    ["redis"]="redis:alpine:6379:6379"
)

echo "ğŸ—ï¸  å¼€å§‹å¾®æœåŠ¡æ‰¹é‡éƒ¨ç½²..."

# åˆ›å»ºåº”ç”¨ç½‘ç»œ
docker network create app-network 2>/dev/null || true

# éƒ¨ç½²æœåŠ¡
for service in "${!services[@]}"; do
    IFS=':' read -ra config <<< "${services[$service]}"
    image=${config[0]}
    tag=${config[1]}  
    host_port=${config[2]}
    container_port=${config[3]}
    
    echo "ğŸ“¦ éƒ¨ç½²æœåŠ¡: $service"
    
    # åœæ­¢æ—§å®¹å™¨
    docker stop $service 2>/dev/null || true
    docker rm $service 2>/dev/null || true
    
    # å¯åŠ¨æ–°å®¹å™¨
    docker run -d \
        --name $service \
        --network app-network \
        --restart unless-stopped \
        -p $host_port:$container_port \
        $image:$tag
        
    echo "  âœ… $service éƒ¨ç½²å®Œæˆï¼Œç«¯å£: $host_port"
done

echo "ğŸ‰ æ‰€æœ‰å¾®æœåŠ¡éƒ¨ç½²å®Œæˆ!"

# æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€
echo "ğŸ“Š æœåŠ¡è¿è¡ŒçŠ¶æ€:"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
```

### 9.3 ç¯å¢ƒå¿«é€Ÿåˆ‡æ¢


**ğŸ”„ å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢**

```bash
#!/bin/bash
# ç¯å¢ƒå¿«é€Ÿåˆ‡æ¢è„šæœ¬

switch_environment() {
    local env=$1
    
    if [[ ! $env =~ ^(dev|staging|prod)$ ]]; then
        echo "âŒ ç¯å¢ƒå‚æ•°é”™è¯¯ï¼Œæ”¯æŒ: dev, staging, prod"
        return 1
    fi
    
    echo "ğŸ”„ åˆ‡æ¢åˆ° $env ç¯å¢ƒ..."
    
    # åœæ­¢æ‰€æœ‰å®¹å™¨
    docker stop $(docker ps -q) 2>/dev/null || true
    
    # å¯åŠ¨å¯¹åº”ç¯å¢ƒçš„å®¹å™¨
    case $env in
        "dev")
            docker-compose -f docker-compose.dev.yml up -d
            ;;
        "staging") 
            docker-compose -f docker-compose.staging.yml up -d
            ;;
        "prod")
            docker-compose -f docker-compose.prod.yml up -d
            ;;
    esac
    
    echo "âœ… å·²åˆ‡æ¢åˆ° $env ç¯å¢ƒ"
    
    # æ˜¾ç¤ºæœåŠ¡çŠ¶æ€
    sleep 3
    docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
}

# ä½¿ç”¨ç¤ºä¾‹
switch_environment "dev"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‘½ä»¤ç»„åˆæœ¬è´¨ï¼šé€šè¿‡ç®¡é“ã€é€»è¾‘è¿æ¥ç­‰æ–¹å¼å°†å¤šä¸ªDockerå‘½ä»¤è¿æ¥
ğŸ”¸ æ‰¹é‡æ“ä½œï¼šä½¿ç”¨$(docker ps -q)ç­‰æ–¹å¼è·å–IDåˆ—è¡¨è¿›è¡Œæ‰¹é‡å¤„ç†
ğŸ”¸ æ¡ä»¶è¿‡æ»¤ï¼šä½¿ç”¨--filterå‚æ•°ç²¾ç¡®ç­›é€‰ç›®æ ‡èµ„æº
ğŸ”¸ è„šæœ¬è‡ªåŠ¨åŒ–ï¼šå°†å¤æ‚æ“ä½œå°è£…æˆå¯é‡ç”¨çš„Shellè„šæœ¬
ğŸ”¸ å®‰å…¨å®è·µï¼šåœ¨æ‰§è¡Œå±é™©æ“ä½œå‰æ·»åŠ ç¡®è®¤å’Œå¤‡ä»½æœºåˆ¶
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å‘½ä»¤ç»„åˆçš„æ ¸å¿ƒæ€æƒ³**
```
å•ä¸€èŒè´£ï¼šæ¯ä¸ªå‘½ä»¤ä¸“æ³¨åšå¥½ä¸€ä»¶äº‹
ç®¡é“æµè½¬ï¼šå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºæˆä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥
ç»„åˆå¢æ•ˆï¼šå¤šä¸ªç®€å•å‘½ä»¤ç»„åˆå®ç°å¤æ‚åŠŸèƒ½
è‡ªåŠ¨åŒ–ï¼šå‡å°‘æ‰‹å·¥æ“ä½œï¼Œæé«˜æ•ˆç‡å’Œå‡†ç¡®æ€§
```

**ğŸ”¹ å®é™…åº”ç”¨çš„æœ€ä½³å®è·µ**
```
æµ‹è¯•å…ˆè¡Œï¼šåœ¨ç”Ÿäº§ç¯å¢ƒå‰å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
å¤‡ä»½ä¼˜å…ˆï¼šé‡è¦æ“ä½œå‰å…ˆè¿›è¡Œå¤‡ä»½
æ—¥å¿—è®°å½•ï¼šå…³é”®æ“ä½œè¦æœ‰æ—¥å¿—è®°å½•
é”™è¯¯å¤„ç†ï¼šè„šæœ¬ä¸­è¦åŒ…å«é”™è¯¯å¤„ç†é€»è¾‘
æƒé™æ§åˆ¶ï¼šé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œå±é™©çš„æ¸…ç†å‘½ä»¤
```

### 10.3 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨


| æ“ä½œç±»å‹ | **å¸¸ç”¨ç»„åˆå‘½ä»¤** | **è¯´æ˜** |
|---------|-----------------|----------|
| ğŸ—‘ï¸ **æ‰¹é‡æ¸…ç†** | `docker rm $(docker ps -aq)` | `åˆ é™¤æ‰€æœ‰å®¹å™¨` |
| ğŸ“Š **çŠ¶æ€ç›‘æ§** | `docker stats --no-stream` | `æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ` |
| ğŸ” **æ—¥å¿—æŸ¥çœ‹** | `docker logs -f container \| grep ERROR` | `å®æ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—` |
| ğŸ’¾ **å¤‡ä»½æ“ä½œ** | `docker commit container backup-image` | `å¤‡ä»½å®¹å™¨ä¸ºé•œåƒ` |
| ğŸš€ **å¿«é€Ÿéƒ¨ç½²** | `docker run -d --restart unless-stopped` | `éƒ¨ç½²ç”Ÿäº§å®¹å™¨` |

### 10.4 å®æˆ˜åº”ç”¨å»ºè®®


**ğŸ¯ æ—¥å¸¸è¿ç»´åœºæ™¯**
- **å¼€å‘è°ƒè¯•**ï¼šä½¿ç”¨ç»„åˆå‘½ä»¤å¿«é€ŸæŸ¥çœ‹æ—¥å¿—å’ŒçŠ¶æ€
- **ç¯å¢ƒæ¸…ç†**ï¼šå®šæœŸä½¿ç”¨æ¸…ç†è„šæœ¬é‡Šæ”¾ç£ç›˜ç©ºé—´  
- **åº”ç”¨éƒ¨ç½²**ï¼šé€šè¿‡éƒ¨ç½²è„šæœ¬å®ç°ä¸€é”®å‘å¸ƒ
- **æ•…éšœæ’æŸ¥**ï¼šç»„åˆå¤šä¸ªè¯Šæ–­å‘½ä»¤å¿«é€Ÿå®šä½é—®é¢˜
- **èµ„æºç›‘æ§**ï¼šå®šæ—¶æ‰§è¡Œç›‘æ§è„šæœ¬æ”¶é›†ç³»ç»Ÿä¿¡æ¯

**ğŸ”§ è¿›é˜¶æŠ€å·§**
- **å˜é‡ä½¿ç”¨**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡è®©è„šæœ¬æ›´åŠ çµæ´»
- **å‡½æ•°å°è£…**ï¼šå°†å¸¸ç”¨æ“ä½œå°è£…æˆå¯é‡ç”¨å‡½æ•°
- **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ é€‚å½“çš„é”™è¯¯æ£€æŸ¥å’Œå¼‚å¸¸å¤„ç†
- **æ—¥å¿—è¾“å‡º**ï¼šä¸ºè„šæœ¬æ·»åŠ æ¸…æ™°çš„æ‰§è¡Œæ—¥å¿—
- **å‚æ•°æ ¡éªŒ**ï¼šå¯¹è¾“å…¥å‚æ•°è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥

**æ ¸å¿ƒè®°å¿†**ï¼š
- Dockerå‘½ä»¤ç»„åˆçš„æœ¬è´¨æ˜¯æé«˜æ•ˆç‡ã€å‡å°‘é‡å¤æ“ä½œ
- ç®¡é“ç¬¦å·ï¼ˆ|ï¼‰æ˜¯è¿æ¥å‘½ä»¤çš„å…³é”®å·¥å…·
- $(command) è¯­æ³•ç”¨äºå°†å‘½ä»¤ç»“æœä½œä¸ºå‚æ•°ä¼ é€’
- æ‰¹é‡æ“ä½œè¦è°¨æ…ï¼Œç‰¹åˆ«æ˜¯åˆ é™¤ç±»æ“ä½œ
- è„šæœ¬åŒ–æ˜¯Dockerè¿ç»´è‡ªåŠ¨åŒ–çš„é‡è¦æ‰‹æ®µ