---
title: 8、Compose相关命令
---
## 📚 目录

1. [Docker Compose基础概念](#1-docker-compose基础概念)
2. [核心启停命令](#2-核心启停命令)
3. [服务管理命令](#3-服务管理命令)
4. [监控调试命令](#4-监控调试命令)
5. [构建部署命令](#5-构建部署命令)
6. [配置管理命令](#6-配置管理命令)
7. [实用技巧汇总](#7-实用技巧汇总)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🏗️ Docker Compose基础概念


### 1.1 什么是Docker Compose


**简单理解**：如果说Docker是管理单个容器的工具，那么Docker Compose就是管理多个容器的指挥官。

```
单容器场景：
只有一个Web应用 → 用docker run启动

多容器场景：
Web应用 + 数据库 + Redis + Nginx → 用docker-compose管理
```

**🔸 Docker Compose的价值**
- **一键启动**：一个命令启动整套应用服务
- **依赖管理**：自动处理容器间的启动顺序
- **网络连接**：容器间可以通过服务名直接通信
- **配置集中**：所有配置写在一个yaml文件里

### 1.2 核心文件：docker-compose.yml


**📋 基本结构示例**
```yaml
version: '3.8'
services:
  web:
    image: nginx
    ports:
      - "80:80"
  database:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: password
```

**🔍 文件结构解析**
```
docker-compose.yml 的构成：
├── version      ← Compose文件格式版本
├── services     ← 定义所有服务(容器)
│   ├── web      ← 服务名(可自定义)
│   └── database ← 另一个服务
└── networks     ← 网络配置(可选)
    └── volumes  ← 数据卷配置(可选)
```

### 1.3 Compose vs Docker命令对比


| 场景 | **Docker原生命令** | **Compose命令** |
|------|-------------------|----------------|
| 🚀 **启动服务** | `docker run nginx`<br/>`docker run mysql` | `docker-compose up` |
| 🛑 **停止服务** | `docker stop 容器ID`<br/>`docker stop 容器ID` | `docker-compose down` |
| 📊 **查看状态** | `docker ps` | `docker-compose ps` |
| 📝 **查看日志** | `docker logs 容器ID` | `docker-compose logs` |

---

## 2. 🚀 核心启停命令


### 2.1 docker-compose up - 启动服务


**🔸 基本用法**
```bash
docker-compose up
```
**含义**：启动docker-compose.yml中定义的所有服务，相当于"一键启动整个项目"。

**⚡ 常用参数组合**

**后台运行（最常用）**
```bash
docker-compose up -d
```
- `Detached模式`：服务在后台运行，不占用终端
- **使用场景**：生产环境或不需要看启动日志时

**指定服务启动**
```bash
docker-compose up web database
```
- **含义**：只启动web和database服务，其他服务不启动
- **使用场景**：调试特定服务时

**重新构建并启动**
```bash
docker-compose up --build
```
- **含义**：先构建镜像，再启动服务
- **使用场景**：代码有更新，需要重新打包镜像时

### 2.2 docker-compose down - 停止服务


**🔸 基本用法**
```bash
docker-compose down
```
**含义**：停止并删除所有容器，相当于"一键关停整个项目"。

**🛑 停止行为详解**
```
docker-compose down 会做什么：
1. 停止所有运行中的容器
2. 删除这些容器
3. 删除compose创建的网络
4. 保留数据卷(volume)
```

**保留数据vs清理数据**
```bash
# 普通停止 - 保留数据卷
docker-compose down

# 彻底清理 - 删除数据卷
docker-compose down -v
```

⚠️ **注意**：`-v`参数会删除数据库、文件等持久化数据，谨慎使用！

### 2.3 启停命令实战示例


**📝 典型的开发工作流**
```bash
# 1. 第一次启动项目
docker-compose up -d

# 2. 查看服务状态  
docker-compose ps

# 3. 修改代码后重启
docker-compose down
docker-compose up -d --build

# 4. 项目结束后清理
docker-compose down -v
```

---

## 3. 🔧 服务管理命令


### 3.1 docker-compose start/stop/restart - 精细控制


**🔸 启动已存在的服务**
```bash
docker-compose start [服务名]
```
**与up的区别**：`start`只启动已存在但停止的容器，`up`会创建新容器。

**🔸 停止服务但不删除**
```bash
docker-compose stop [服务名]
```
**与down的区别**：`stop`只停止容器，`down`会删除容器。

**🔸 重启服务**
```bash
docker-compose restart [服务名]
```
**使用场景**：服务出现问题需要快速重启时。

### 3.2 docker-compose pause/unpause - 暂停恢复


**🔸 暂停服务**
```bash
docker-compose pause web
```
**含义**：暂停容器中的所有进程，但容器仍然存在。

**🔸 恢复服务**  
```bash
docker-compose unpause web
```
**含义**：恢复被暂停的进程。

**📊 状态对比表**

| 操作 | **容器状态** | **进程状态** | **网络连接** | **使用场景** |
|------|-------------|-------------|-------------|-------------|
| `stop` | 停止 | 结束 | 断开 | 正常停止服务 |
| `pause` | 运行中 | 暂停 | 保持 | 临时暂停不影响其他服务 |

### 3.3 docker-compose scale - 扩缩容


**🔸 横向扩展服务**
```bash
docker-compose scale web=3
```
**含义**：将web服务扩展到3个实例，实现负载分担。

**📈 扩容示例**
```bash
# 查看当前服务数量
docker-compose ps

# 扩展web服务到5个实例
docker-compose scale web=5

# 再次查看，会发现有5个web容器在运行
docker-compose ps
```

**⚠️ 扩容注意事项**
- **端口冲突**：如果服务绑定了固定端口，扩容会失败
- **数据共享**：多个实例要注意数据一致性问题
- **负载均衡**：需要配合nginx等负载均衡器使用

### 3.4 docker-compose rm - 删除服务


**🔸 删除停止的容器**
```bash
docker-compose rm
```
**安全特点**：只删除已停止的容器，运行中的不会被删除。

**强制删除**
```bash
docker-compose rm -f
```
**危险操作**：强制删除所有容器，包括运行中的。

---

## 4. 📊 监控调试命令


### 4.1 docker-compose ps - 查看服务状态


**🔸 查看所有服务**
```bash
docker-compose ps
```

**📋 输出信息解读**
```
      Name                     Command               State           Ports         
--------------------------------------------------------------------------------
myapp_database_1   docker-entrypoint.sh mysqld   Up      3306/tcp, 33060/tcp   
myapp_web_1        nginx -g daemon off;           Up      0.0.0.0:80->80/tcp    
```

**状态说明**：
- `Up`：服务正常运行
- `Exit 0`：服务正常退出  
- `Exit 1`：服务异常退出
- `Restarting`：服务正在重启

### 4.2 docker-compose logs - 查看日志


**🔸 查看所有服务日志**
```bash
docker-compose logs
```

**🔸 查看特定服务日志**
```bash
docker-compose logs web
```

**📝 实用的日志参数**
```bash
# 实时跟踪日志 (类似tail -f)
docker-compose logs -f web

# 只显示最近50行日志
docker-compose logs --tail=50 web

# 显示日志时间戳
docker-compose logs -t web
```

**🔍 日志调试技巧**
```bash
# 查看所有服务最近的错误
docker-compose logs --tail=100 | grep -i error

# 实时监控多个服务
docker-compose logs -f web database redis
```

### 4.3 docker-compose exec - 进入容器执行命令


**🔸 进入容器交互**
```bash
docker-compose exec web bash
```
**含义**：进入web服务的容器，打开bash终端，可以执行各种命令。

**🔧 常用调试场景**
```bash
# 进入数据库容器
docker-compose exec database mysql -u root -p

# 查看nginx配置
docker-compose exec web cat /etc/nginx/nginx.conf

# 在web容器中执行单个命令
docker-compose exec web ls -la /var/www/html
```

**exec vs run 的区别**：
- `exec`：在**已运行**的容器中执行命令
- `run`：**创建新容器**执行命令

---

## 5. 🏭 构建部署命令


### 5.1 docker-compose build - 构建服务镜像


**🔸 构建所有服务**
```bash
docker-compose build
```
**使用场景**：项目中有Dockerfile，需要构建自定义镜像时。

**🔸 构建特定服务**
```bash
docker-compose build web
```

**🔧 构建参数**
```bash
# 不使用缓存重新构建
docker-compose build --no-cache

# 并行构建提高速度
docker-compose build --parallel
```

### 5.2 docker-compose pull - 拉取镜像


**🔸 拉取最新镜像**
```bash
docker-compose pull
```
**含义**：从镜像仓库拉取compose文件中定义的最新镜像。

**🔄 更新工作流**
```bash
# 1. 拉取最新镜像
docker-compose pull

# 2. 停止现有服务
docker-compose down

# 3. 使用新镜像启动
docker-compose up -d
```

---

## 6. ⚙️ 配置管理命令


### 6.1 docker-compose config - 验证配置


**🔸 验证配置文件**
```bash
docker-compose config
```
**作用**：检查docker-compose.yml语法是否正确，并显示最终的配置内容。

**🔍 配置检查实例**
```bash
# 验证配置并显示解析后的内容
docker-compose config

# 只验证不显示内容
docker-compose config --quiet
```

**常见配置错误**：
- **缩进错误**：YAML对缩进要求严格
- **版本不兼容**：version和features不匹配
- **服务名重复**：services下不能有同名服务

### 6.2 配置文件最佳实践


**🏷️ 环境变量使用**
```yaml
services:
  database:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD:-defaultpassword}
      MYSQL_DATABASE: ${DB_NAME}
```

**📁 多环境配置**
```bash
# 开发环境
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

# 生产环境  
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
```

---

## 7. 💡 实用技巧汇总


### 7.1 🟢入门级 实用命令组合


**快速重启服务**
```bash
docker-compose restart web
```

**查看服务资源使用**
```bash
docker-compose exec web top
docker-compose exec web df -h
```

**一键更新部署**
```bash
docker-compose pull && docker-compose up -d
```

### 7.2 🟡进阶级 效率提升技巧


**多项目管理**
```bash
# 使用项目名称前缀避免冲突
docker-compose -p myproject up -d

# 查看特定项目的容器
docker-compose -p myproject ps
```

**选择性服务管理**
```bash
# 只启动核心服务
docker-compose up -d web database

# 后续启动其他服务
docker-compose up -d redis nginx
```

### 7.3 🔴高级 生产环境技巧


**零停机更新**
```bash
# 1. 构建新镜像
docker-compose build

# 2. 滚动更新 (需要多实例)
docker-compose up -d --scale web=2
docker-compose stop web_1
docker-compose rm web_1
```

**资源限制**
```yaml
services:
  web:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
```

### 7.4 常用命令速查表


| 命令类别 | **命令** | **作用** | **使用频率** |
|----------|---------|----------|-------------|
| 🚀 **启停** | `up -d` | 后台启动所有服务 | ⭐⭐⭐⭐⭐ |
| | `down` | 停止并删除服务 | ⭐⭐⭐⭐⭐ |
| | `restart` | 重启服务 | ⭐⭐⭐⭐ |
| 📊 **监控** | `ps` | 查看服务状态 | ⭐⭐⭐⭐⭐ |
| | `logs -f` | 实时查看日志 | ⭐⭐⭐⭐ |
| | `exec` | 进入容器执行命令 | ⭐⭐⭐⭐ |
| 🔧 **构建** | `build` | 构建镜像 | ⭐⭐⭐ |
| | `pull` | 拉取最新镜像 | ⭐⭐⭐ |
| ⚙️ **配置** | `config` | 验证配置文件 | ⭐⭐ |

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本概念


```
🔸 Docker Compose本质：多容器应用的编排工具
🔸 配置文件：docker-compose.yml定义所有服务
🔸 服务概念：每个service就是一个容器实例
🔸 一键管理：用一个命令管理整套应用
🔸 网络互通：容器间可通过服务名直接通信
```

### 8.2 关键命令记忆法


**🔹 启停类命令**
```
up   = 启动(向上)，创建并启动服务
down = 停止(向下)，停止并删除服务
start/stop = 简单的启动/停止，不创建不删除
restart = 重新启动
```

**🔹 监控类命令**
```
ps = process status，查看进程状态
logs = 查看日志，加-f跟踪
exec = execute，在容器中执行命令
```

**🔹 构建类命令**
```
build = 构建镜像
pull = 拉取镜像
config = 检查配置
```

### 8.3 实际应用场景


**🎯 开发环境使用**
```bash
# 日常开发流程
docker-compose up -d          # 启动开发环境
docker-compose logs -f web    # 查看应用日志
docker-compose exec web bash  # 进入容器调试
docker-compose down           # 结束开发
```

**🎯 生产环境使用**
```bash
# 生产部署流程
docker-compose pull           # 更新镜像
docker-compose config         # 验证配置
docker-compose up -d          # 启动服务
docker-compose ps             # 检查状态
```

**🔧 故障排除流程**
```
1. docker-compose ps          ← 查看服务状态
2. docker-compose logs 服务名  ← 查看错误日志  
3. docker-compose exec 服务名 bash ← 进入容器排查
4. docker-compose restart 服务名   ← 尝试重启
5. docker-compose down && up -d   ← 完全重启
```

### 8.4 最佳实践要点


**💯 推荐做法**
- ✅ **总是使用** `-d` 参数后台运行
- ✅ **定期执行** `docker-compose pull` 更新镜像
- ✅ **使用** `config` 命令验证配置文件
- ✅ **合理使用** 环境变量管理配置
- ✅ **为不同环境** 准备不同的compose文件

**⚠️ 注意事项**
- **数据安全**：谨慎使用 `down -v` 避免数据丢失
- **端口冲突**：扩容时注意端口映射问题
- **资源限制**：生产环境要设置资源限制
- **日志管理**：大量日志会占用磁盘空间

**🔥 核心记忆**
- Docker Compose = 多容器管理神器
- up/down = 最常用的启停命令  
- ps/logs/exec = 监控调试三剑客
- 一个yaml文件管理整个应用栈
- 开发生产环境的必备工具