---
title: 5ã€é•œåƒå¯¼å…¥å¯¼å‡º
---
## ğŸ“š ç›®å½•

1. [é•œåƒå¯¼å…¥å¯¼å‡ºæ ¸å¿ƒæ¦‚å¿µ](#1-é•œåƒå¯¼å…¥å¯¼å‡ºæ ¸å¿ƒæ¦‚å¿µ)
2. [docker saveå¯¼å‡ºé•œåƒ](#2-docker-saveå¯¼å‡ºé•œåƒ)
3. [docker loadå¯¼å…¥é•œåƒ](#3-docker-loadå¯¼å…¥é•œåƒ)
4. [ç¦»çº¿é•œåƒä¼ è¾“å®æˆ˜](#4-ç¦»çº¿é•œåƒä¼ è¾“å®æˆ˜)
5. [æ‰¹é‡é•œåƒå¤„ç†æŠ€å·§](#5-æ‰¹é‡é•œåƒå¤„ç†æŠ€å·§)
6. [é•œåƒå¤‡ä»½ç­–ç•¥](#6-é•œåƒå¤‡ä»½ç­–ç•¥)
7. [è·¨ç¯å¢ƒé•œåƒè¿ç§»](#7-è·¨ç¯å¢ƒé•œåƒè¿ç§»)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é•œåƒå¯¼å…¥å¯¼å‡ºæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é•œåƒå¯¼å…¥å¯¼å‡º


**é•œåƒå¯¼å…¥å¯¼å‡º**æ˜¯Dockeræä¾›çš„ä¸€å¥—å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿå°†é•œåƒæ‰“åŒ…æˆæ–‡ä»¶ï¼Œç„¶ååœ¨ä¸åŒçš„ç¯å¢ƒä¹‹é—´ä¼ è¾“å’Œä½¿ç”¨ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæˆ‘ä»¬æŠŠè½¯ä»¶æ‰“åŒ…æˆå®‰è£…åŒ…ä¸€æ ·ï¼ŒDockerå¯ä»¥æŠŠé•œåƒ"æ‰“åŒ…"æˆä¸€ä¸ªæ–‡ä»¶ï¼Œæ‹¿åˆ°åˆ«çš„ç”µè„‘ä¸Š"è§£åŒ…"ä½¿ç”¨

**æ ¸å¿ƒä½œç”¨**ï¼š
- **ç¦»çº¿éƒ¨ç½²**ï¼šç½‘ç»œå—é™ç¯å¢ƒä¸‹çš„é•œåƒåˆ†å‘
- **å¤‡ä»½æ¢å¤**ï¼šé‡è¦é•œåƒçš„å¤‡ä»½å’Œæ¢å¤
- **ç¯å¢ƒè¿ç§»**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé—´çš„é•œåƒä¼ è¾“
- **ç‰ˆæœ¬ç®¡ç†**ï¼šç‰¹å®šç‰ˆæœ¬é•œåƒçš„å­˜æ¡£

### 1.2 å¯¼å…¥å¯¼å‡º vs å…¶ä»–æ–¹å¼å¯¹æ¯”


```
é•œåƒä¼ è¾“æ–¹å¼å¯¹æ¯”ï¼š

ğŸ“¦ å¯¼å…¥å¯¼å‡º (save/load)
   â”œâ”€â”€ ä¼˜åŠ¿ï¼šå®Œå…¨ç¦»çº¿ï¼ŒåŒ…å«å®Œæ•´å†å²
   â”œâ”€â”€ ç¼ºç‚¹ï¼šæ–‡ä»¶è¾ƒå¤§ï¼Œä¼ è¾“æ…¢
   â””â”€â”€ åœºæ™¯ï¼šç¦»çº¿ç¯å¢ƒã€å®Œæ•´å¤‡ä»½

ğŸŒ é•œåƒä»“åº“ (push/pull)  
   â”œâ”€â”€ ä¼˜åŠ¿ï¼šåœ¨çº¿åŒæ­¥ï¼Œå¢é‡ä¼ è¾“
   â”œâ”€â”€ ç¼ºç‚¹ï¼šéœ€è¦ç½‘ç»œï¼Œä¾èµ–ä»“åº“
   â””â”€â”€ åœºæ™¯ï¼šåœ¨çº¿ç¯å¢ƒã€å›¢é˜Ÿåä½œ

ğŸ“‹ å¯¼å‡ºå¯¼å…¥ (export/import)
   â”œâ”€â”€ ä¼˜åŠ¿ï¼šæ–‡ä»¶å°ï¼Œåªä¿å­˜æ–‡ä»¶ç³»ç»Ÿ
   â”œâ”€â”€ ç¼ºç‚¹ï¼šä¸¢å¤±å†å²ï¼Œéœ€é‡æ–°æ„å»º
   â””â”€â”€ åœºæ™¯ï¼šå®¹å™¨å¿«ç…§ã€è½»é‡ä¼ è¾“
```

### 1.3 åŸºæœ¬å·¥ä½œæµç¨‹


```
é•œåƒå¯¼å‡ºå¯¼å…¥æµç¨‹ï¼š

æºç¯å¢ƒ                     ç›®æ ‡ç¯å¢ƒ
   â”‚                          â”‚
   â”œâ”€ docker save â”€â”€â”€â”€â”      â”‚
   â”‚  (å¯¼å‡ºé•œåƒ)       â”‚      â”‚
   â”‚                  â”‚      â”‚
   â””â”€ ç”Ÿæˆtaræ–‡ä»¶ â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
                      â”‚      â”‚
                      â””â”€â”€â”€â”€â”€â”€â”¼â”€ docker load
                             â”‚  (å¯¼å…¥é•œåƒ)
                             â”‚
                             â””â”€ é•œåƒå¯ç”¨
```

---

## 2. ğŸ“¤ docker saveå¯¼å‡ºé•œåƒ


### 2.1 saveå‘½ä»¤åŸºç¡€è¯­æ³•


**åŸºæœ¬å‘½ä»¤æ ¼å¼**ï¼š
```bash
docker save [é€‰é¡¹] é•œåƒå[:æ ‡ç­¾] > æ–‡ä»¶å.tar
# æˆ–è€…
docker save -o æ–‡ä»¶å.tar é•œåƒå[:æ ‡ç­¾]
```

> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼š
> - **save**ï¼šä¿å­˜çš„æ„æ€ï¼ŒæŠŠé•œåƒ"ä¿å­˜"åˆ°æ–‡ä»¶ä¸­
> - **-o**ï¼šoutputè¾“å‡ºï¼ŒæŒ‡å®šè¾“å‡ºæ–‡ä»¶å
> - **taræ ¼å¼**ï¼šDockerä½¿ç”¨æ ‡å‡†çš„tarå½’æ¡£æ ¼å¼

### 2.2 å•ä¸ªé•œåƒå¯¼å‡ºå®ä¾‹


**å¯¼å‡ºnginxé•œåƒ**ï¼š
```bash
# æ–¹å¼1ï¼šä½¿ç”¨é‡å®šå‘
docker save nginx:latest > nginx-latest.tar

# æ–¹å¼2ï¼šä½¿ç”¨-oé€‰é¡¹ï¼ˆæ¨èï¼‰
docker save -o nginx-latest.tar nginx:latest

# å¯¼å‡ºæ—¶æŒ‡å®šå®Œæ•´ä¿¡æ¯
docker save -o nginx-backup-20250121.tar nginx:1.21.6
```

**æŸ¥çœ‹å¯¼å‡ºç»“æœ**ï¼š
```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°
ls -lh nginx-latest.tar
# è¾“å‡º: -rw-r--r-- 1 user user 142M Jan 21 10:30 nginx-latest.tar

# æŸ¥çœ‹æ–‡ä»¶ç±»å‹
file nginx-latest.tar
# è¾“å‡º: nginx-latest.tar: POSIX tar archive
```

### 2.3 å¤šä¸ªé•œåƒæ‰¹é‡å¯¼å‡º


**åŒæ—¶å¯¼å‡ºå¤šä¸ªé•œåƒ**ï¼š
```bash
# å¯¼å‡ºå¤šä¸ªæŒ‡å®šé•œåƒ
docker save -o web-images.tar nginx:latest redis:6.2 mysql:8.0

# å¯¼å‡ºåŒä¸€é•œåƒçš„å¤šä¸ªç‰ˆæœ¬
docker save -o nginx-versions.tar nginx:1.20 nginx:1.21 nginx:latest
```

**æŒ‰æ¡ä»¶æ‰¹é‡å¯¼å‡º**ï¼š
```bash
# å¯¼å‡ºæ‰€æœ‰nginxç›¸å…³é•œåƒ
docker save -o nginx-all.tar $(docker images nginx --format "{{.Repository}}:{{.Tag}}")

# å¯¼å‡ºæœ¬åœ°æ„å»ºçš„é•œåƒï¼ˆæ— ä»“åº“å‰ç¼€ï¼‰
docker save -o local-images.tar $(docker images --filter "dangling=false" --format "{{.Repository}}:{{.Tag}}" | grep -v "<none>")
```

### 2.4 saveå‘½ä»¤é€‰é¡¹è¯¦è§£


| é€‰é¡¹ | **ä½œç”¨è¯´æ˜** | **ä½¿ç”¨ç¤ºä¾‹** | **æ³¨æ„äº‹é¡¹** |
|------|-------------|-------------|-------------|
| `-o, --output` | `æŒ‡å®šè¾“å‡ºæ–‡ä»¶` | `docker save -o app.tar myapp` | `æ–‡ä»¶ä¼šè¢«è¦†ç›–` |
| `æ— é€‰é¡¹` | `æ ‡å‡†è¾“å‡ºé‡å®šå‘` | `docker save myapp > app.tar` | `å¯èƒ½æœ‰ç¼–ç é—®é¢˜` |

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - å¯¼å‡ºçš„taræ–‡ä»¶åŒ…å«**å®Œæ•´çš„é•œåƒå±‚**å’Œ**å…ƒæ•°æ®ä¿¡æ¯**
> - æ–‡ä»¶å¤§å°ç­‰äºæ‰€æœ‰å±‚çš„æ€»å¤§å°ï¼ˆ**æœªå‹ç¼©**ï¼‰
> - å¦‚æœç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨ï¼Œä¼šè¢«**ç›´æ¥è¦†ç›–**

### 2.5 å¯¼å‡ºè¿‡ç¨‹ç›‘æ§


**æŸ¥çœ‹å¯¼å‡ºè¿›åº¦**ï¼š
```bash
# åå°å¯¼å‡ºå¹¶æ˜¾ç¤ºè¿›åº¦
docker save nginx:latest | pv > nginx-latest.tar

# ä½¿ç”¨teeåŒæ—¶ä¿å­˜å’ŒæŸ¥çœ‹
docker save nginx:latest | tee nginx-latest.tar | wc -c
```

**å¤§é•œåƒå¯¼å‡ºä¼˜åŒ–**ï¼š
```bash
# å‹ç¼©å¯¼å‡ºï¼ˆå‡å°æ–‡ä»¶å¤§å°ï¼‰
docker save nginx:latest | gzip > nginx-latest.tar.gz

# ä½¿ç”¨pigzå¤šçº¿ç¨‹å‹ç¼©ï¼ˆæ›´å¿«ï¼‰
docker save nginx:latest | pigz > nginx-latest.tar.gz
```

---

## 3. ğŸ“¥ docker loadå¯¼å…¥é•œåƒ


### 3.1 loadå‘½ä»¤åŸºç¡€è¯­æ³•


**åŸºæœ¬å‘½ä»¤æ ¼å¼**ï¼š
```bash
docker load < æ–‡ä»¶å.tar
# æˆ–è€…
docker load -i æ–‡ä»¶å.tar
```

> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼š
> - **load**ï¼šåŠ è½½çš„æ„æ€ï¼ŒæŠŠæ–‡ä»¶"åŠ è½½"æˆé•œåƒ
> - **-i**ï¼šinputè¾“å…¥ï¼ŒæŒ‡å®šè¾“å…¥æ–‡ä»¶å
> - **è‡ªåŠ¨è¯†åˆ«**ï¼šä¼šè‡ªåŠ¨è¯†åˆ«taræ–‡ä»¶ä¸­çš„é•œåƒä¿¡æ¯

### 3.2 å•ä¸ªé•œåƒå¯¼å…¥å®ä¾‹


**å¯¼å…¥nginxé•œåƒ**ï¼š
```bash
# æ–¹å¼1ï¼šä½¿ç”¨é‡å®šå‘
docker load < nginx-latest.tar

# æ–¹å¼2ï¼šä½¿ç”¨-ié€‰é¡¹ï¼ˆæ¨èï¼‰
docker load -i nginx-latest.tar

# æŸ¥çœ‹å¯¼å…¥ç»“æœ
docker images | grep nginx
```

**å¯¼å…¥è¿‡ç¨‹è¾“å‡ºç¤ºä¾‹**ï¼š
```bash
$ docker load -i nginx-latest.tar
Loaded image: nginx:latest

# éªŒè¯å¯¼å…¥æˆåŠŸ
$ docker images nginx
REPOSITORY   TAG       IMAGE ID       CREATED      SIZE
nginx        latest    f652ca386ed1   2 days ago   141MB
```

### 3.3 å‹ç¼©æ–‡ä»¶å¯¼å…¥


**å¯¼å…¥å‹ç¼©çš„é•œåƒæ–‡ä»¶**ï¼š
```bash
# å¯¼å…¥gzipå‹ç¼©æ–‡ä»¶
gunzip -c nginx-latest.tar.gz | docker load

# æˆ–è€…ä½¿ç”¨ç®¡é“
zcat nginx-latest.tar.gz | docker load

# å¯¼å…¥æ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
docker load -i nginx-latest.tar.gz --quiet=false
```

### 3.4 æ‰¹é‡é•œåƒå¯¼å…¥


**å¯¼å…¥åŒ…å«å¤šä¸ªé•œåƒçš„æ–‡ä»¶**ï¼š
```bash
# å¯¼å…¥å¤šé•œåƒtaråŒ…
docker load -i web-images.tar

# è¾“å‡ºç¤ºä¾‹ï¼š
# Loaded image: nginx:latest
# Loaded image: redis:6.2
# Loaded image: mysql:8.0

# éªŒè¯æ‰€æœ‰é•œåƒéƒ½å¯¼å…¥æˆåŠŸ
docker images | grep -E "(nginx|redis|mysql)"
```

### 3.5 loadå‘½ä»¤ç‰¹ç‚¹è§£æ


**å¯¼å…¥è¡Œä¸ºç‰¹ç‚¹**ï¼š
- **ä¿æŒæ ‡ç­¾**ï¼šé•œåƒçš„repositoryå’Œtagå®Œå…¨ä¿æŒåŸæ ·
- **è¦†ç›–ç­–ç•¥**ï¼šå¦‚æœæœ¬åœ°å·²æœ‰åŒåé•œåƒï¼Œä¼šè¢«æ–°å¯¼å…¥çš„**è¦†ç›–**
- **å±‚å…±äº«**ï¼šç›¸åŒçš„å±‚ä¼šè¢«**è‡ªåŠ¨å»é‡**ï¼ŒèŠ‚çœç©ºé—´
- **å…ƒæ•°æ®æ¢å¤**ï¼šå®Œæ•´æ¢å¤é•œåƒçš„**å†å²ä¿¡æ¯**å’Œ**æ„å»ºä¿¡æ¯**

```
å¯¼å…¥å‰åå¯¹æ¯”ï¼š

å¯¼å…¥å‰æœ¬åœ°é•œåƒï¼š
nginx:latest  (ID: abc123)  142MB

å¯¼å…¥æ–‡ä»¶å†…å®¹ï¼š
nginx:latest  (ID: def456)  141MB

å¯¼å…¥åç»“æœï¼š
nginx:latest  (ID: def456)  141MB  â† æ–°é•œåƒæ›¿æ¢äº†æ—§é•œåƒ
```

---

## 4. ğŸš€ ç¦»çº¿é•œåƒä¼ è¾“å®æˆ˜


### 4.1 å®Œæ•´ç¦»çº¿éƒ¨ç½²æµç¨‹


**åœºæ™¯æè¿°**ï¼šå°†å¼€å‘ç¯å¢ƒçš„Webåº”ç”¨é•œåƒä¼ è¾“åˆ°æ— ç½‘ç»œçš„ç”Ÿäº§ç¯å¢ƒ

```
ç¦»çº¿ä¼ è¾“å®Œæ•´æµç¨‹ï¼š

å¼€å‘ç¯å¢ƒ (æœ‰ç½‘ç»œ)          ç”Ÿäº§ç¯å¢ƒ (æ— ç½‘ç»œ)
     â”‚                        â”‚
  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”                â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
  â”‚åº”ç”¨é•œåƒâ”‚                â”‚å¾…éƒ¨ç½²  â”‚
  â”‚nginx  â”‚                â”‚ç©ºç¯å¢ƒ  â”‚
  â”‚redis  â”‚                â”‚       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                        â–²
     â”œâ”€ docker save å¯¼å‡º       â”‚
     â”‚                        â”‚
     â–¼                        â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚taræ–‡ä»¶åŒ…  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ç‰©ç†ä¼ è¾“   â”‚
  â”‚web-app.tarâ”‚  Uç›˜/å…‰ç›˜ â”‚(Uç›˜/ç½‘ç»œ) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚docker loadâ”‚
                        â”‚å¯¼å…¥éƒ¨ç½²   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å®æˆ˜æ“ä½œæ­¥éª¤


**Step 1ï¼šå‡†å¤‡å’Œå¯¼å‡º**
```bash
# 1. æŸ¥çœ‹è¦ä¼ è¾“çš„é•œåƒ
docker images | grep -E "(myapp|nginx|redis)"

# 2. åˆ›å»ºå¯¼å‡ºç›®å½•
mkdir -p /tmp/docker-export

# 3. å¯¼å‡ºåº”ç”¨ç›¸å…³é•œåƒ
cd /tmp/docker-export
docker save -o myapp-v1.2.tar myapp:1.2
docker save -o nginx-stable.tar nginx:stable  
docker save -o redis-6.2.tar redis:6.2

# 4. æ‰“åŒ…ä¼ è¾“æ–‡ä»¶
tar -czf web-deployment.tar.gz *.tar
```

**Step 2ï¼šä¼ è¾“éªŒè¯**
```bash
# è®¡ç®—æ–‡ä»¶æ ¡éªŒå’Œï¼ˆç¡®ä¿ä¼ è¾“å®Œæ•´æ€§ï¼‰
sha256sum web-deployment.tar.gz > checksums.txt
cat checksums.txt

# æ–‡ä»¶å¤§å°æ£€æŸ¥
ls -lh web-deployment.tar.gz
# è¾“å‡ºï¼š-rw-r--r-- 1 user user 245M Jan 21 15:30 web-deployment.tar.gz
```

**Step 3ï¼šç›®æ ‡ç¯å¢ƒå¯¼å…¥**
```bash
# 1. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
sha256sum -c checksums.txt
# è¾“å‡ºï¼šweb-deployment.tar.gz: OK

# 2. è§£å‹ä¼ è¾“åŒ…
tar -xzf web-deployment.tar.gz

# 3. æ‰¹é‡å¯¼å…¥é•œåƒ
for tarfile in *.tar; do
    echo "å¯¼å…¥ $tarfile..."
    docker load -i "$tarfile"
done

# 4. éªŒè¯å¯¼å…¥ç»“æœ
docker images | grep -E "(myapp|nginx|redis)"
```

### 4.3 ä¼ è¾“ä¼˜åŒ–ç­–ç•¥


**æ–‡ä»¶å¤§å°ä¼˜åŒ–**ï¼š
```bash
# å‹ç¼©ç‡å¯¹æ¯”æµ‹è¯•
docker save myapp:latest > myapp-raw.tar          # åŸå§‹å¤§å°
docker save myapp:latest | gzip > myapp-gz.tar.gz  # gzipå‹ç¼©
docker save myapp:latest | xz > myapp-xz.tar.xz    # xzé«˜å‹ç¼©æ¯”

# å¤§å°å¯¹æ¯”
ls -lh myapp-*
# myapp-raw.tar     850M
# myapp-gz.tar.gz   320M  (å‹ç¼©æ¯” ~62%)  
# myapp-xz.tar.xz   280M  (å‹ç¼©æ¯” ~67%, ä½†å‹ç¼©æ…¢)
```

**ä¼ è¾“éªŒè¯æµç¨‹**ï¼š
```bash
# åˆ›å»ºå®Œæ•´çš„éªŒè¯è„šæœ¬
cat > verify-transfer.sh << 'EOF'
#!/bin/bash
echo "=== Dockeré•œåƒä¼ è¾“éªŒè¯ ==="
echo "1. æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§..."
sha256sum -c checksums.txt

echo "2. æ£€æŸ¥DockeræœåŠ¡..."
systemctl is-active docker

echo "3. å¯¼å…¥é•œåƒ..."
for tar_file in *.tar; do
    if [ -f "$tar_file" ]; then
        echo "å¯¼å…¥: $tar_file"
        docker load -i "$tar_file"
    fi
done

echo "4. éªŒè¯é•œåƒå¯ç”¨æ€§..."
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"
echo "=== éªŒè¯å®Œæˆ ==="
EOF

chmod +x verify-transfer.sh
```

---

## 5. ğŸ”„ æ‰¹é‡é•œåƒå¤„ç†æŠ€å·§


### 5.1 æ‰¹é‡å¯¼å‡ºç­–ç•¥


**æŒ‰é¡¹ç›®åˆ†ç»„å¯¼å‡º**ï¼š
```bash
# å¯¼å‡ºå‰ç«¯é¡¹ç›®ç›¸å…³é•œåƒ
docker save -o frontend-images.tar \
  nginx:alpine \
  node:16-alpine \
  $(docker images "myapp-*" --format "{{.Repository}}:{{.Tag}}")

# å¯¼å‡ºåç«¯æœåŠ¡é•œåƒ  
docker save -o backend-images.tar \
  openjdk:11-jre-slim \
  mysql:8.0 \
  redis:6.2-alpine
```

**æŒ‰ç¯å¢ƒæ ‡ç­¾å¯¼å‡º**ï¼š
```bash
# å‡è®¾é•œåƒæŒ‰ç¯å¢ƒæ‰“æ ‡ç­¾
docker save -o dev-env.tar $(docker images --format "{{.Repository}}:{{.Tag}}" | grep ":dev$")
docker save -o prod-env.tar $(docker images --format "{{.Repository}}:{{.Tag}}" | grep ":prod$")
```

### 5.2 æ™ºèƒ½åŒ–æ‰¹é‡å¤„ç†è„šæœ¬


**é•œåƒå¯¼å‡ºè„šæœ¬**ï¼š
```bash
#!/bin/bash
# docker-batch-export.sh

# é…ç½®å¯¼å‡ºè§„åˆ™
declare -A EXPORT_RULES=(
    ["web"]="nginx redis mysql"
    ["app"]="myapp:* node:16*"
    ["base"]="ubuntu:20.04 alpine:3.15"
)

# åˆ›å»ºå¯¼å‡ºç›®å½•
EXPORT_DIR="docker-export-$(date +%Y%m%d)"
mkdir -p "$EXPORT_DIR"

# æ‰¹é‡å¯¼å‡º
for group in "${!EXPORT_RULES[@]}"; do
    echo "å¯¼å‡º $group ç»„é•œåƒ..."
    images="${EXPORT_RULES[$group]}"
    
    # å±•å¼€é€šé…ç¬¦å¹¶å¯¼å‡º
    expanded_images=$(docker images --format "{{.Repository}}:{{.Tag}}" | grep -E "$(echo $images | sed 's/ /|/g')")
    
    if [ -n "$expanded_images" ]; then
        docker save -o "$EXPORT_DIR/${group}-images.tar" $expanded_images
        echo "âœ… $group ç»„å¯¼å‡ºå®Œæˆ: ${EXPORT_DIR}/${group}-images.tar"
    else
        echo "âš ï¸  $group ç»„æ²¡æœ‰æ‰¾åˆ°åŒ¹é…é•œåƒ"
    fi
done
```

### 5.3 æ‰¹é‡å¯¼å…¥ç­–ç•¥


**æ™ºèƒ½å¯¼å…¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# docker-batch-import.sh

IMPORT_DIR=${1:-"./"}

echo "=== æ‰¹é‡å¯¼å…¥Dockeré•œåƒ ==="
echo "å¯¼å…¥ç›®å½•: $IMPORT_DIR"

# ç»Ÿè®¡ä¿¡æ¯
total_files=0
success_count=0
fail_count=0

# éå†æ‰€æœ‰taræ–‡ä»¶
for tar_file in "$IMPORT_DIR"/*.tar; do
    if [ -f "$tar_file" ]; then
        total_files=$((total_files + 1))
        echo "æ­£åœ¨å¯¼å…¥: $(basename $tar_file)"
        
        if docker load -i "$tar_file" > /dev/null 2>&1; then
            success_count=$((success_count + 1))
            echo "âœ… æˆåŠŸ: $(basename $tar_file)"
        else
            fail_count=$((fail_count + 1))
            echo "âŒ å¤±è´¥: $(basename $tar_file)"
        fi
    fi
done

echo "=== å¯¼å…¥ç»Ÿè®¡ ==="
echo "æ€»æ–‡ä»¶æ•°: $total_files"
echo "æˆåŠŸ: $success_count"  
echo "å¤±è´¥: $fail_count"
echo "å½“å‰é•œåƒæ•°é‡: $(docker images -q | wc -l)"
```

---

## 6. ğŸ’¾ é•œåƒå¤‡ä»½ç­–ç•¥


### 6.1 å¤‡ä»½ç­–ç•¥åˆ¶å®š


**å¤‡ä»½ç­‰çº§åˆ†ç±»**ï¼š

```
é•œåƒå¤‡ä»½é‡è¦æ€§åˆ†çº§ï¼š

ğŸ”¥ æ ¸å¿ƒé•œåƒ (Critical)
   â”œâ”€â”€ ç”Ÿäº§åº”ç”¨é•œåƒ
   â”œâ”€â”€ æ•°æ®åº“é•œåƒ  
   â””â”€â”€ å¤‡ä»½é¢‘ç‡ï¼šæ¯æ—¥ + ç‰ˆæœ¬å‘å¸ƒæ—¶

âš¡ é‡è¦é•œåƒ (Important)  
   â”œâ”€â”€ åŸºç¡€è¿è¡Œæ—¶é•œåƒ
   â”œâ”€â”€ ä¸­é—´ä»¶é•œåƒ
   â””â”€â”€ å¤‡ä»½é¢‘ç‡ï¼šæ¯å‘¨ + é‡å¤§æ›´æ–°æ—¶

ğŸ“¦ ä¸€èˆ¬é•œåƒ (Normal)
   â”œâ”€â”€ å¼€å‘å·¥å…·é•œåƒ
   â”œâ”€â”€ ä¸´æ—¶é•œåƒ
   â””â”€â”€ å¤‡ä»½é¢‘ç‡ï¼šæ¯æœˆ + æ‰‹åŠ¨å¤‡ä»½
```

### 6.2 è‡ªåŠ¨åŒ–å¤‡ä»½å®ç°


**å®šæ—¶å¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash
# docker-backup.sh

# é…ç½®å˜é‡
BACKUP_DIR="/data/docker-backups"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR/$DATE"

# æ ¸å¿ƒé•œåƒåˆ—è¡¨ï¼ˆéœ€è¦æ¯æ—¥å¤‡ä»½ï¼‰
CRITICAL_IMAGES=(
    "myapp:latest"
    "myapp:stable"  
    "mysql:8.0"
    "redis:6.2"
)

echo "=== Dockeré•œåƒå¤‡ä»½å¼€å§‹ ==="
echo "å¤‡ä»½æ—¶é—´: $DATE"
echo "å¤‡ä»½ç›®å½•: $BACKUP_DIR/$DATE"

# å¤‡ä»½æ ¸å¿ƒé•œåƒ
for image in "${CRITICAL_IMAGES[@]}"; do
    if docker images "$image" --format "{{.Repository}}:{{.Tag}}" | grep -q "$image"; then
        backup_file="$BACKUP_DIR/$DATE/$(echo $image | tr '/:' '_').tar"
        echo "å¤‡ä»½é•œåƒ: $image -> $backup_file"
        docker save -o "$backup_file" "$image"
        
        # å‹ç¼©ä»¥èŠ‚çœç©ºé—´
        gzip "$backup_file"
    else
        echo "âš ï¸  é•œåƒä¸å­˜åœ¨: $image"
    fi
done

# æ¸…ç†è¿‡æœŸå¤‡ä»½
echo "æ¸…ç† $RETENTION_DAYS å¤©å‰çš„å¤‡ä»½..."
find "$BACKUP_DIR" -type d -mtime +$RETENTION_DAYS -exec rm -rf {} +

echo "âœ… å¤‡ä»½å®Œæˆ"
```

**Cronå®šæ—¶ä»»åŠ¡è®¾ç½®**ï¼š
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶å¤‡ä»½ä»»åŠ¡
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½
0 2 * * * /path/to/docker-backup.sh >> /var/log/docker-backup.log 2>&1

# æ¯å‘¨æ—¥å‡Œæ™¨1ç‚¹æ¸…ç†ä¸´æ—¶é•œåƒåå¤‡ä»½
0 1 * * 0 docker system prune -f && /path/to/docker-backup.sh
```

### 6.3 å¤‡ä»½æ¢å¤æµ‹è¯•


**å¤‡ä»½å®Œæ•´æ€§éªŒè¯**ï¼š
```bash
#!/bin/bash
# backup-verify.sh

BACKUP_DIR="/data/docker-backups"
TEST_DATE=$1

if [ -z "$TEST_DATE" ]; then
    echo "ç”¨æ³•: $0 <å¤‡ä»½æ—¥æœŸç›®å½•>"
    exit 1
fi

echo "=== éªŒè¯å¤‡ä»½: $TEST_DATE ==="

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
backup_path="$BACKUP_DIR/$TEST_DATE"
if [ ! -d "$backup_path" ]; then
    echo "âŒ å¤‡ä»½ç›®å½•ä¸å­˜åœ¨: $backup_path"
    exit 1
fi

# æµ‹è¯•æ¯ä¸ªå¤‡ä»½æ–‡ä»¶
for backup_file in "$backup_path"/*.tar.gz; do
    if [ -f "$backup_file" ]; then
        echo "æµ‹è¯•å¤‡ä»½æ–‡ä»¶: $(basename $backup_file)"
        
        # è§£å‹å¹¶æµ‹è¯•å¯¼å…¥
        temp_tar="/tmp/test_$(basename $backup_file .gz)"
        gunzip -c "$backup_file" > "$temp_tar"
        
        if docker load -i "$temp_tar" --quiet; then
            echo "âœ… å¤‡ä»½æ–‡ä»¶æ­£å¸¸: $(basename $backup_file)"
        else
            echo "âŒ å¤‡ä»½æ–‡ä»¶æŸå: $(basename $backup_file)"
        fi
        
        rm -f "$temp_tar"
    fi
done

echo "=== éªŒè¯å®Œæˆ ==="
```

---

## 7. ğŸ”„ è·¨ç¯å¢ƒé•œåƒè¿ç§»


### 7.1 è¿ç§»åœºæ™¯åˆ†æ


**å…¸å‹è¿ç§»åœºæ™¯**ï¼š

```
è¿ç§»åœºæ™¯å¯¹æ¯”ï¼š

å¼€å‘ â†’ æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ ç‰¹ç‚¹ï¼šé¢‘ç¹è¿ç§»ï¼Œç‰ˆæœ¬å¤šå˜
â”œâ”€â”€ ç­–ç•¥ï¼šè‡ªåŠ¨åŒ–æ„å»º + é•œåƒä»“åº“
â””â”€â”€ å¤‡ç”¨ï¼šç¦»çº¿ä¼ è¾“ï¼ˆç½‘ç»œé—®é¢˜æ—¶ï¼‰

æµ‹è¯• â†’ ç”Ÿäº§ç¯å¢ƒ  
â”œâ”€â”€ ç‰¹ç‚¹ï¼šä¸¥æ ¼éªŒè¯ï¼Œç‰ˆæœ¬å›ºå®š
â”œâ”€â”€ ç­–ç•¥ï¼šç¦»çº¿ä¼ è¾“ + å®Œæ•´éªŒè¯
â””â”€â”€ è¦æ±‚ï¼šå®Œæ•´å¤‡ä»½ + å›æ»šå‡†å¤‡

å†…ç½‘ â†” å¤–ç½‘ç¯å¢ƒ
â”œâ”€â”€ ç‰¹ç‚¹ï¼šç½‘ç»œéš”ç¦»ï¼Œå®‰å…¨è¦æ±‚é«˜
â”œâ”€â”€ ç­–ç•¥ï¼šç‰©ç†ä»‹è´¨ä¼ è¾“
â””â”€â”€ æµç¨‹ï¼šå¯¼å‡º â†’ å®¡æ‰¹ â†’ å¯¼å…¥
```

### 7.2 ç¯å¢ƒå·®å¼‚å¤„ç†


**æ¶æ„å…¼å®¹æ€§å¤„ç†**ï¼š
```bash
# æ£€æŸ¥é•œåƒæ¶æ„ä¿¡æ¯
docker inspect nginx:latest | grep -A 5 "Architecture"

# å¤šæ¶æ„é•œåƒå¯¼å‡ºï¼ˆä¿ç•™æ‰€æœ‰æ¶æ„ï¼‰
docker buildx imagetools inspect nginx:latest --format "{{json .Manifest}}"

# æŒ‡å®šæ¶æ„å¯¼å‡º
docker save --platform linux/amd64 -o nginx-amd64.tar nginx:latest
docker save --platform linux/arm64 -o nginx-arm64.tar nginx:latest
```

**ç¯å¢ƒå˜é‡é€‚é…è„šæœ¬**ï¼š
```bash
#!/bin/bash
# env-migration.sh

# å®šä¹‰ç¯å¢ƒæ˜ å°„å…³ç³»
declare -A ENV_MAPPING=(
    ["dev"]="test"
    ["test"]="prod"
    ["staging"]="prod"
)

SOURCE_ENV=$1
TARGET_ENV=${ENV_MAPPING[$SOURCE_ENV]}

if [ -z "$TARGET_ENV" ]; then
    echo "ä¸æ”¯æŒçš„è¿ç§»è·¯å¾„: $SOURCE_ENV"
    exit 1
fi

echo "=== ç¯å¢ƒè¿ç§»: $SOURCE_ENV â†’ $TARGET_ENV ==="

# å¯¼å‡ºæºç¯å¢ƒé•œåƒ
source_images=$(docker images --format "{{.Repository}}:{{.Tag}}" | grep ":$SOURCE_ENV$")

if [ -n "$source_images" ]; then
    # åˆ›å»ºè¿ç§»åŒ…
    migration_file="migration-${SOURCE_ENV}-to-${TARGET_ENV}-$(date +%Y%m%d).tar"
    docker save -o "$migration_file" $source_images
    
    echo "âœ… è¿ç§»åŒ…å·²åˆ›å»º: $migration_file"
    echo "åŒ…å«é•œåƒ:"
    echo "$source_images"
else
    echo "âš ï¸  æœªæ‰¾åˆ° $SOURCE_ENV ç¯å¢ƒçš„é•œåƒ"
fi
```

### 7.3 è¿ç§»éªŒè¯æµç¨‹


**å®Œæ•´è¿ç§»éªŒè¯æ¸…å•**ï¼š

> âœ… **è¿ç§»å‰æ£€æŸ¥**
> - æºç¯å¢ƒé•œåƒå®Œæ•´æ€§
> - ç›®æ ‡ç¯å¢ƒDockerç‰ˆæœ¬å…¼å®¹æ€§
> - å­˜å‚¨ç©ºé—´å……è¶³æ€§
> - ç½‘ç»œè¿é€šæ€§ï¼ˆå¦‚éœ€è¦ï¼‰

> âœ… **è¿ç§»è¿‡ç¨‹éªŒè¯**
> - æ–‡ä»¶ä¼ è¾“å®Œæ•´æ€§ï¼ˆæ ¡éªŒå’Œï¼‰
> - é•œåƒå¯¼å…¥æˆåŠŸç‡
> - é•œåƒæ ‡ç­¾æ­£ç¡®æ€§
> - ä¾èµ–é•œåƒå®Œæ•´æ€§

> âœ… **è¿ç§»åæµ‹è¯•**
> - å®¹å™¨å¯åŠ¨æµ‹è¯•
> - åº”ç”¨åŠŸèƒ½éªŒè¯
> - æ€§èƒ½å¯¹æ¯”æµ‹è¯•
> - å›æ»šæ–¹æ¡ˆå‡†å¤‡

**è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬**ï¼š
```bash
#!/bin/bash
# migration-verify.sh

echo "=== é•œåƒè¿ç§»éªŒè¯ ==="

# 1. åŸºç¡€ç¯å¢ƒæ£€æŸ¥
echo "1. æ£€æŸ¥Dockerç¯å¢ƒ..."
docker --version || exit 1
docker info > /dev/null 2>&1 || exit 1

# 2. ç£ç›˜ç©ºé—´æ£€æŸ¥
available_space=$(df /var/lib/docker | tail -1 | awk '{print $4}')
required_space=5000000  # 5GB in KB

if [ "$available_space" -lt "$required_space" ]; then
    echo "âŒ ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œéœ€è¦è‡³å°‘5GB"
    exit 1
fi

# 3. é•œåƒåŠŸèƒ½éªŒè¯
verify_image() {
    local image=$1
    echo "éªŒè¯é•œåƒ: $image"
    
    # å°è¯•è¿è¡Œå®¹å™¨
    if docker run --rm -d --name test_${RANDOM} "$image" sleep 10 > /dev/null 2>&1; then
        echo "âœ… é•œåƒè¿è¡Œæ­£å¸¸: $image"
        return 0
    else
        echo "âŒ é•œåƒè¿è¡Œå¤±è´¥: $image" 
        return 1
    fi
}

# éªŒè¯å…³é”®é•œåƒ
critical_images=("nginx:latest" "redis:6.2" "mysql:8.0")
for image in "${critical_images[@]}"; do
    if docker images -q "$image" > /dev/null; then
        verify_image "$image"
    fi
done

echo "âœ… è¿ç§»éªŒè¯å®Œæˆ"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ å¯¼å…¥å¯¼å‡ºæ ¸å¿ƒç†è§£ï¼š
â”œâ”€â”€ docker saveï¼šæŠŠé•œåƒ"æ‰“åŒ…"æˆæ–‡ä»¶
â”œâ”€â”€ docker loadï¼šæŠŠæ–‡ä»¶"è§£åŒ…"æˆé•œåƒ  
â”œâ”€â”€ taræ ¼å¼ï¼šDockerä½¿ç”¨çš„æ ‡å‡†å½’æ¡£æ ¼å¼
â”œâ”€â”€ å®Œæ•´ä¿å­˜ï¼šåŒ…å«æ‰€æœ‰å±‚å’Œå…ƒæ•°æ®ä¿¡æ¯
â””â”€â”€ ç¦»çº¿ä¼ è¾“ï¼šç½‘ç»œå—é™ç¯å¢ƒçš„é¦–é€‰æ–¹æ¡ˆ
```

### 8.2 å…³é”®æ“ä½œå‘½ä»¤


| **æ“ä½œ** | **å‘½ä»¤** | **è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **å¯¼å‡ºå•é•œåƒ** | `docker save -o file.tar image:tag` | `ä¿å­˜ä¸ºtaræ–‡ä»¶` | `å¤‡ä»½ã€ä¼ è¾“` |
| **å¯¼å‡ºå¤šé•œåƒ** | `docker save -o file.tar img1 img2` | `å¤šä¸ªé•œåƒæ‰“åŒ…` | `æ‰¹é‡è¿ç§»` |
| **å¯¼å…¥é•œåƒ** | `docker load -i file.tar` | `ä»taræ–‡ä»¶æ¢å¤` | `éƒ¨ç½²ã€æ¢å¤` |
| **å‹ç¼©å¯¼å‡º** | `docker save image \| gzip > file.tar.gz` | `å‡å°ä¼ è¾“æ–‡ä»¶` | `ç½‘ç»œä¼ è¾“` |

### 8.3 å®æˆ˜åº”ç”¨è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ç”¨å¯¼å…¥å¯¼å‡º**ï¼š
- âœ… **ç¦»çº¿ç¯å¢ƒ**ï¼šæ— ç½‘ç»œæˆ–ç½‘ç»œå—é™çš„éƒ¨ç½²
- âœ… **å®Œæ•´å¤‡ä»½**ï¼šéœ€è¦ä¿ç•™é•œåƒå®Œæ•´å†å²ä¿¡æ¯
- âœ… **ç‰ˆæœ¬å½’æ¡£**ï¼šç‰¹å®šç‰ˆæœ¬çš„é•¿æœŸå­˜å‚¨
- âœ… **è·¨ç½‘ç»œä¼ è¾“**ï¼šå†…å¤–ç½‘éš”ç¦»ç¯å¢ƒé—´ä¼ è¾“

**ğŸ”¹ å¯¼å‡ºæ–‡ä»¶çš„ç‰¹ç‚¹**ï¼š
- **æ–‡ä»¶è¾ƒå¤§**ï¼šåŒ…å«æ‰€æœ‰é•œåƒå±‚ï¼Œæœªå‹ç¼©
- **å®Œæ•´ä¿¡æ¯**ï¼šä¿ç•™æ„å»ºå†å²ã€æ ‡ç­¾ã€å…ƒæ•°æ®
- **æ ‡å‡†æ ¼å¼**ï¼šä½¿ç”¨tarå½’æ¡£ï¼Œå¯ä»¥ç”¨tarå‘½ä»¤æŸ¥çœ‹
- **ç‰ˆæœ¬æ— å…³**ï¼šä¸åŒDockerç‰ˆæœ¬é—´é€šç”¨

### 8.4 æœ€ä½³å®è·µå»ºè®®


> ğŸ’¡ **å¤‡ä»½ç­–ç•¥**ï¼š
> - å®šæœŸå¤‡ä»½æ ¸å¿ƒé•œåƒï¼ˆæ¯æ—¥/æ¯å‘¨ï¼‰
> - ä½¿ç”¨å‹ç¼©å‡å°‘å­˜å‚¨ç©ºé—´
> - å»ºç«‹å¤‡ä»½éªŒè¯å’Œæ¢å¤æµ‹è¯•æµç¨‹

> âš ï¸ **ä¼ è¾“æ³¨æ„**ï¼š
> - å¤§æ–‡ä»¶ä¼ è¾“å‰åæ ¡éªŒå®Œæ•´æ€§
> - è€ƒè™‘ç½‘ç»œå¸¦å®½ï¼Œé€‰æ‹©åˆé€‚ä¼ è¾“æ–¹å¼
> - åšå¥½ä¼ è¾“å¤±è´¥çš„é‡è¯•å‡†å¤‡

> ğŸ”§ **è‡ªåŠ¨åŒ–å»ºè®®**ï¼š
> - ç¼–å†™è„šæœ¬å®ç°æ‰¹é‡æ“ä½œ
> - ç»“åˆcronå®ç°å®šæ—¶å¤‡ä»½
> - å»ºç«‹å®Œæ•´çš„è¿ç§»éªŒè¯æµç¨‹

### 8.5 å¸¸è§é—®é¢˜è§£å†³


```
é—®é¢˜1ï¼šå¯¼å‡ºæ–‡ä»¶è¿‡å¤§
è§£å†³ï¼šä½¿ç”¨å‹ç¼© docker save image | gzip > file.tar.gz

é—®é¢˜2ï¼šå¯¼å…¥æ—¶æç¤ºæƒé™ä¸è¶³  
è§£å†³ï¼šç¡®ä¿ç”¨æˆ·åœ¨dockerç»„ä¸­ï¼Œæˆ–ä½¿ç”¨sudo

é—®é¢˜3ï¼šå¯¼å…¥åé•œåƒæ ‡ç­¾ä¸¢å¤±
è§£å†³ï¼šsaveæ—¶æŒ‡å®šå®Œæ•´æ ‡ç­¾å image:tag

é—®é¢˜4ï¼šè·¨æ¶æ„å¯¼å…¥å¤±è´¥
è§£å†³ï¼šæ£€æŸ¥é•œåƒæ¶æ„å…¼å®¹æ€§ï¼Œä½¿ç”¨å¤šæ¶æ„é•œåƒ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- **saveå¯¼å‡ºloadå¯¼å…¥**ï¼Œç¦»çº¿ä¼ è¾“ä¸å‘æ„
- **taræ ¼å¼æ ‡å‡†åŒ–**ï¼Œå‹ç¼©ä¼ è¾“æ›´é«˜æ•ˆ  
- **æ‰¹é‡å¤„ç†ç¼–è„šæœ¬**ï¼Œè‡ªåŠ¨å¤‡ä»½ä¿å®‰å…¨
- **è¿ç§»éªŒè¯è¦å®Œæ•´**ï¼Œç¯å¢ƒé€‚é…å¾ˆé‡è¦