---
title: 2ã€docker-compose.ymlè¯­æ³•
---
## ğŸ“š ç›®å½•

1. [Docker ComposeåŸºæœ¬æ¦‚å¿µ](#1-docker-composeåŸºæœ¬æ¦‚å¿µ)
2. [docker-compose.ymlæ–‡ä»¶ç»“æ„](#2-docker-composeymlæ–‡ä»¶ç»“æ„)
3. [versionç‰ˆæœ¬å£°æ˜è¯¦è§£](#3-versionç‰ˆæœ¬å£°æ˜è¯¦è§£)
4. [servicesæœåŠ¡å®šä¹‰](#4-servicesæœåŠ¡å®šä¹‰)
5. [networksç½‘ç»œé…ç½®](#5-networksç½‘ç»œé…ç½®)
6. [volumeså·é…ç½®](#6-volumeså·é…ç½®)
7. [environmentç¯å¢ƒå˜é‡](#7-environmentç¯å¢ƒå˜é‡)
8. [portsç«¯å£æ˜ å°„](#8-portsç«¯å£æ˜ å°„)
9. [depends_onä¾èµ–å…³ç³»](#9-depends_onä¾èµ–å…³ç³»)
10. [ç»¼åˆå®æˆ˜ç¤ºä¾‹](#10-ç»¼åˆå®æˆ˜ç¤ºä¾‹)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ Docker ComposeåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Docker Compose


**ç®€å•ç†è§£**ï¼šDocker Composeå°±åƒæ˜¯ä¸€ä¸ª"æŒ‡æŒ¥å®˜"ï¼Œç”¨æ¥ç®¡ç†å¤šä¸ªDockerå®¹å™¨

```
ä¼ ç»Ÿæ–¹å¼å¯åŠ¨å¤šå®¹å™¨åº”ç”¨ï¼š
$ docker run mysql          â† å¯åŠ¨æ•°æ®åº“
$ docker run redis          â† å¯åŠ¨ç¼“å­˜
$ docker run nginx          â† å¯åŠ¨WebæœåŠ¡å™¨
$ docker run myapp          â† å¯åŠ¨åº”ç”¨ç¨‹åº
é—®é¢˜ï¼šå‘½ä»¤ç¹çï¼Œå®¹å™¨é—´è¿æ¥å¤æ‚

Docker Composeæ–¹å¼ï¼š
$ docker-compose up          â† ä¸€æ¡å‘½ä»¤å¯åŠ¨æ‰€æœ‰æœåŠ¡
ä¼˜åŠ¿ï¼šç»Ÿä¸€ç®¡ç†ï¼Œè‡ªåŠ¨å¤„ç†å®¹å™¨é—´å…³ç³»
```

### 1.2 æ ¸å¿ƒä½œç”¨å’Œä»·å€¼


**ğŸ¯ ä¸»è¦è§£å†³çš„é—®é¢˜**ï¼š
- **å¤šå®¹å™¨ç®¡ç†éš¾é¢˜**ï¼šé¿å…æ‰‹åŠ¨å¯åŠ¨å¤šä¸ªç›¸å…³å®¹å™¨
- **æœåŠ¡ä¾èµ–å…³ç³»**ï¼šè‡ªåŠ¨å¤„ç†å®¹å™¨å¯åŠ¨é¡ºåºå’Œç½‘ç»œè¿æ¥
- **ç¯å¢ƒé…ç½®ç»Ÿä¸€**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¿æŒä¸€è‡´
- **ä¸€é”®éƒ¨ç½²éœ€æ±‚**ï¼šç®€åŒ–å¤æ‚åº”ç”¨çš„éƒ¨ç½²æµç¨‹

> ğŸ’¡ **ç”Ÿæ´»åŒ–ç±»æ¯”**  
> å¦‚æœå•ä¸ªDockerå®¹å™¨åƒä¸€ä¸ª"å‘˜å·¥"ï¼Œé‚£ä¹ˆDocker Composeå°±åƒ"éƒ¨é—¨ç»ç†"ï¼Œç»Ÿä¸€ç®¡ç†æ•´ä¸ªå›¢é˜Ÿï¼Œç¡®ä¿å¤§å®¶åä½œé¡ºç•…

### 1.3 å·¥ä½œåŸç†æ¦‚è§ˆ


```
Docker Composeå·¥ä½œæµç¨‹ï¼š
1. è¯»å– docker-compose.yml é…ç½®æ–‡ä»¶
2. è§£ææœåŠ¡å®šä¹‰å’Œä¾èµ–å…³ç³»
3. åˆ›å»ºä¸“ç”¨ç½‘ç»œä¾›å®¹å™¨é€šä¿¡
4. æŒ‰ä¾èµ–é¡ºåºå¯åŠ¨å„ä¸ªæœåŠ¡å®¹å™¨
5. ç›‘æ§æœåŠ¡çŠ¶æ€ï¼Œæä¾›ç»Ÿä¸€ç®¡ç†æ¥å£
```

---

## 2. ğŸ“‹ docker-compose.ymlæ–‡ä»¶ç»“æ„


### 2.1 YAMLæ–‡ä»¶åŸºç¡€è¯­æ³•


> ğŸ“Œ **YAMLè¯­æ³•è¦ç‚¹**  
> - ä½¿ç”¨ç©ºæ ¼ç¼©è¿›ï¼ˆä¸èƒ½ç”¨Tabï¼‰
> - å†’å·åé¢å¿…é¡»æœ‰ç©ºæ ¼  
> - å±‚çº§å…³ç³»ç”¨ç¼©è¿›è¡¨ç¤º
> - åˆ—è¡¨é¡¹ç”¨çŸ­æ¨ªçº¿å¼€å¤´

```yaml
# æ³¨é‡Šä»¥#å¼€å¤´
key: value                    # é”®å€¼å¯¹
parent:                      # çˆ¶çº§èŠ‚ç‚¹
  child1: value1             # å­çº§èŠ‚ç‚¹ï¼ˆ2ä¸ªç©ºæ ¼ç¼©è¿›ï¼‰
  child2: value2
list:                        # åˆ—è¡¨
  - item1                    # åˆ—è¡¨é¡¹
  - item2
```

### 2.2 æ ‡å‡†æ–‡ä»¶ç»“æ„æ¨¡æ¿


```yaml
version: '3.8'               # ç‰ˆæœ¬å£°æ˜

services:                    # æœåŠ¡å®šä¹‰åŒºåŸŸ
  service1:                  # ç¬¬ä¸€ä¸ªæœåŠ¡
    # æœåŠ¡é…ç½®...
  service2:                  # ç¬¬äºŒä¸ªæœåŠ¡
    # æœåŠ¡é…ç½®...

volumes:                     # æ•°æ®å·å®šä¹‰åŒºåŸŸ
  volume1:
    # å·é…ç½®...

networks:                    # ç½‘ç»œå®šä¹‰åŒºåŸŸ
  network1:
    # ç½‘ç»œé…ç½®...
```

**ğŸ”¸ å››å¤§æ ¸å¿ƒåŒºåŸŸè¯´æ˜**ï¼š
- `version`ï¼šæŒ‡å®šComposeæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬
- `services`ï¼šå®šä¹‰åº”ç”¨ç¨‹åºçš„å„ä¸ªæœåŠ¡ç»„ä»¶
- `volumes`ï¼šå®šä¹‰æŒä¹…åŒ–å­˜å‚¨å·
- `networks`ï¼šå®šä¹‰è‡ªå®šä¹‰ç½‘ç»œ

### 2.3 æœ€å°åŒ–ç¤ºä¾‹


```yaml
version: '3.8'

services:
  web:
    image: nginx
    ports:
      - "80:80"
```

**è¿™ä¸ªç®€å•ä¾‹å­åšäº†ä»€ä¹ˆ**ï¼š
1. ä½¿ç”¨Composeæ ¼å¼3.8ç‰ˆæœ¬
2. å®šä¹‰ä¸€ä¸ªåä¸º"web"çš„æœåŠ¡
3. ä½¿ç”¨nginxé•œåƒ
4. å°†å®¹å™¨80ç«¯å£æ˜ å°„åˆ°ä¸»æœº80ç«¯å£

---

## 3. ğŸ”¢ versionç‰ˆæœ¬å£°æ˜è¯¦è§£


### 3.1 ç‰ˆæœ¬çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬å£°æ˜**ï¼š
- **åŠŸèƒ½å…¼å®¹æ€§**ï¼šä¸åŒç‰ˆæœ¬æ”¯æŒçš„åŠŸèƒ½ç‰¹æ€§ä¸åŒ
- **è¯­æ³•å·®å¼‚**ï¼šå„ç‰ˆæœ¬çš„é…ç½®è¯­æ³•å¯èƒ½æœ‰å˜åŒ–
- **Dockerå¼•æ“è¦æ±‚**ï¼šéœ€è¦åŒ¹é…Docker Engineç‰ˆæœ¬

### 3.2 ä¸»è¦ç‰ˆæœ¬å¯¹æ¯”


| ç‰ˆæœ¬å· | **å‘å¸ƒæ—¶é—´** | **ä¸»è¦ç‰¹æ€§** | **æ¨èåœºæ™¯** |
|--------|-------------|--------------|--------------|
| `2.x` | 2016å¹´ | åŸºç¡€å¤šå®¹å™¨ç¼–æ’ | ç®€å•é¡¹ç›® |
| `3.0-3.4` | 2017å¹´ | æ”¯æŒDocker Swarm | é›†ç¾¤éƒ¨ç½² |
| `3.5-3.7` | 2018å¹´ | å¤–éƒ¨ç½‘ç»œã€é…ç½®ç®¡ç† | ä¼ä¸šåº”ç”¨ |
| `3.8` | 2019å¹´ | **æ¨èç‰ˆæœ¬** | ç°ä»£é¡¹ç›®é¦–é€‰ |

### 3.3 ç‰ˆæœ¬é€‰æ‹©å»ºè®®


```yaml
# âœ… æ¨èï¼šä½¿ç”¨3.8ç‰ˆæœ¬ï¼ˆåŠŸèƒ½å®Œå–„ä¸”ç¨³å®šï¼‰
version: '3.8'

# âœ… å¤‡é€‰ï¼šå¦‚æœéœ€è¦æœ€æ–°ç‰¹æ€§
version: '3.9'

# âŒ ä¸æ¨èï¼šè¿‡æ—§ç‰ˆæœ¬
version: '2.0'  # åŠŸèƒ½å—é™
```

> âš ï¸ **é‡è¦æé†’**  
> ç‰ˆæœ¬å£°æ˜å¿…é¡»æ˜¯æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼ˆé™¤æ³¨é‡Šå¤–ï¼‰ï¼Œä¸”å¿…é¡»ç”¨å¼•å·åŒ…å›´

---

## 4. ğŸ—ï¸ servicesæœåŠ¡å®šä¹‰


### 4.1 æœåŠ¡å®šä¹‰åŸºæœ¬ç»“æ„


**æœåŠ¡å°±æ˜¯åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªç»„ä»¶**ï¼Œæ¯”å¦‚æ•°æ®åº“ã€WebæœåŠ¡å™¨ã€åº”ç”¨ç¨‹åºç­‰ã€‚

```yaml
services:
  æœåŠ¡åç§°:
    image: é•œåƒåç§°              # ä½¿ç”¨çš„Dockeré•œåƒ
    build: æ„å»ºé…ç½®             # æˆ–è€…ä»æºç æ„å»º
    ports: ç«¯å£æ˜ å°„             # ç«¯å£æš´éœ²
    environment: ç¯å¢ƒå˜é‡        # ç¯å¢ƒé…ç½®
    volumes: æ•°æ®å·æŒ‚è½½         # æ•°æ®æŒä¹…åŒ–
    depends_on: ä¾èµ–æœåŠ¡        # å¯åŠ¨ä¾èµ–
```

### 4.2 é•œåƒå’Œæ„å»ºé…ç½®


**ğŸ”¸ ä½¿ç”¨ç°æœ‰é•œåƒ**ï¼š
```yaml
services:
  database:
    image: mysql:8.0           # ç›´æ¥ä½¿ç”¨Docker Hubé•œåƒ
    
  redis:
    image: redis:alpine        # ä½¿ç”¨è½»é‡ç‰ˆæœ¬
```

**ğŸ”¸ ä»ä»£ç æ„å»ºé•œåƒ**ï¼š
```yaml
services:
  webapp:
    build: .                   # ä»å½“å‰ç›®å½•æ„å»º
    
  api:
    build:
      context: ./api           # æ„å»ºä¸Šä¸‹æ–‡ç›®å½•
      dockerfile: Dockerfile.prod  # æŒ‡å®šDockerfile
```

### 4.3 æœåŠ¡å‘½åè§„èŒƒ


```yaml
# âœ… æ¨èå‘½åæ–¹å¼
services:
  web-server:                  # ä½¿ç”¨æè¿°æ€§åç§°
  user-database:               # åæ˜ æœåŠ¡ç”¨é€”
  redis-cache:                 # åŒ…å«æŠ€æœ¯æ ˆä¿¡æ¯
  
# âŒ ä¸æ¨èå‘½åæ–¹å¼
services:
  app1:                        # åç§°æ¨¡ç³Š
  service:                     # è¿‡äºé€šç”¨
```

---

## 5. ğŸŒ networksç½‘ç»œé…ç½®


### 5.1 ç½‘ç»œåŸºæœ¬æ¦‚å¿µ


**ç½‘ç»œè®©å®¹å™¨ä¹‹é—´èƒ½å¤Ÿäº’ç›¸é€šä¿¡**ï¼Œå°±åƒç»™æˆ¿é—´ä¹‹é—´æ¶è®¾ç”µè¯çº¿ã€‚

```
é»˜è®¤ç½‘ç»œè¡Œä¸ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebæœåŠ¡   â”‚â”€â”€â”€â”€â”‚  åº”ç”¨æœåŠ¡   â”‚â”€â”€â”€â”€â”‚  æ•°æ®åº“æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        åŒä¸€ä¸ªé¡¹ç›®çš„å®¹å™¨è‡ªåŠ¨åœ¨åŒä¸€ç½‘ç»œä¸­
```

### 5.2 ç½‘ç»œç±»å‹è¯¦è§£


**ğŸ”¸ æ¡¥æ¥ç½‘ç»œï¼ˆé»˜è®¤ï¼‰**ï¼š
```yaml
networks:
  app-network:
    driver: bridge             # å®¹å™¨é—´å¯ä»¥äº’ç›¸è®¿é—®
```

**ğŸ”¸ ä¸»æœºç½‘ç»œ**ï¼š
```yaml
networks:
  host-network:
    driver: host              # å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ
```

### 5.3 è‡ªå®šä¹‰ç½‘ç»œé…ç½®


```yaml
version: '3.8'

services:
  frontend:
    image: nginx
    networks:
      - web-tier               # åŠ å…¥webå±‚ç½‘ç»œ
      
  backend:
    image: node:14
    networks:
      - web-tier               # åŒæ—¶åŠ å…¥ä¸¤ä¸ªç½‘ç»œ
      - db-tier
      
  database:
    image: postgres
    networks:
      - db-tier               # åªåŠ å…¥æ•°æ®åº“å±‚ç½‘ç»œ

networks:
  web-tier:                   # å‰ç«¯ç½‘ç»œ
    driver: bridge
  db-tier:                    # æ•°æ®åº“ç½‘ç»œ
    driver: bridge
```

**è¿™æ ·é…ç½®çš„å¥½å¤„**ï¼š
- **ç½‘ç»œéš”ç¦»**ï¼šæ•°æ®åº“ä¸ç›´æ¥æš´éœ²ç»™å‰ç«¯
- **å®‰å…¨æ€§æå‡**ï¼šåˆ†å±‚ç½‘ç»œæ¶æ„
- **è®¿é—®æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶æœåŠ¡é—´é€šä¿¡

---

## 6. ğŸ’¾ volumeså·é…ç½®


### 6.1 æ•°æ®æŒä¹…åŒ–çš„å¿…è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å·**ï¼š
- **æ•°æ®ä¿å­˜**ï¼šå®¹å™¨åˆ é™¤åæ•°æ®ä¸ä¸¢å¤±
- **æ•°æ®å…±äº«**ï¼šå¤šä¸ªå®¹å™¨å…±äº«åŒä¸€ä»½æ•°æ®
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é¢‘ç¹çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

```
æ²¡æœ‰æ•°æ®å·çš„é—®é¢˜ï¼š
å®¹å™¨1[æ•°æ®] â†’ å®¹å™¨åˆ é™¤ â†’ æ•°æ®æ°¸è¿œä¸¢å¤± âŒ

ä½¿ç”¨æ•°æ®å·çš„å¥½å¤„ï¼š
å®¹å™¨1[æ•°æ®] â†’ æ•°æ®å· â†’ å®¹å™¨2ç»§ç»­ä½¿ç”¨ âœ…
```

### 6.2 å·çš„ç±»å‹å’Œç”¨æ³•


**ğŸ”¸ å‘½åå·ï¼ˆæ¨èï¼‰**ï¼š
```yaml
services:
  database:
    image: mysql
    volumes:
      - db-data:/var/lib/mysql  # å‘½åå·æŒ‚è½½

volumes:
  db-data:                      # å·å®šä¹‰
```

**ğŸ”¸ ç»‘å®šæŒ‚è½½**ï¼š
```yaml
services:
  web:
    image: nginx
    volumes:
      - ./html:/usr/share/nginx/html  # æœ¬åœ°ç›®å½•æŒ‚è½½
      - ./logs:/var/log/nginx         # æ—¥å¿—ç›®å½•æŒ‚è½½
```

**ğŸ”¸ ä¸´æ—¶å·**ï¼š
```yaml
services:
  app:
    image: myapp
    volumes:
      - /tmp                    # ä¸´æ—¶å­˜å‚¨ï¼Œå®¹å™¨é‡å¯åæ¸…ç©º
```

### 6.3 å®é™…åº”ç”¨åœºæ™¯


```yaml
version: '3.8'

services:
  # Webåº”ç”¨
  webapp:
    build: .
    volumes:
      - static-files:/app/static      # é™æ€æ–‡ä»¶å­˜å‚¨
      - ./uploads:/app/uploads        # ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
      
  # æ•°æ®åº“
  postgres:
    image: postgres:13
    volumes:
      - postgres-data:/var/lib/postgresql/data  # æ•°æ®åº“æ•°æ®
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql  # åˆå§‹åŒ–è„šæœ¬

volumes:
  static-files:                 # åº”ç”¨é™æ€èµ„æº
  postgres-data:               # æ•°æ®åº“æŒä¹…åŒ–å­˜å‚¨
```

---

## 7. ğŸ”§ environmentç¯å¢ƒå˜é‡


### 7.1 ç¯å¢ƒå˜é‡çš„ä½œç”¨


**ç¯å¢ƒå˜é‡å°±åƒå®¹å™¨çš„"è®¾ç½®é€‰é¡¹"**ï¼Œç”¨æ¥é…ç½®åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚

```
å®é™…åº”ç”¨ä¸¾ä¾‹ï¼š
æ•°æ®åº“å¯†ç  â†’ DATABASE_PASSWORD=secret123
æœåŠ¡ç«¯å£   â†’ PORT=3000  
è¿è¡Œæ¨¡å¼   â†’ NODE_ENV=production
```

### 7.2 è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ³•


**ğŸ”¸ ç›´æ¥åœ¨composeæ–‡ä»¶ä¸­å®šä¹‰**ï¼š
```yaml
services:
  webapp:
    image: node:14
    environment:
      - NODE_ENV=production     # ç”Ÿäº§ç¯å¢ƒæ¨¡å¼
      - PORT=3000              # æœåŠ¡ç«¯å£
      - DB_HOST=database       # æ•°æ®åº“ä¸»æœº
```

**ğŸ”¸ ä½¿ç”¨é”®å€¼å¯¹æ ¼å¼**ï¼š
```yaml
services:
  webapp:
    image: node:14
    environment:
      NODE_ENV: production
      PORT: 3000
      DB_HOST: database
```

**ğŸ”¸ ä».envæ–‡ä»¶è¯»å–**ï¼š
```yaml
# docker-compose.yml
services:
  webapp:
    image: node:14
    env_file: .env            # ä»å¤–éƒ¨æ–‡ä»¶è¯»å–
```

```bash
# .env æ–‡ä»¶å†…å®¹
NODE_ENV=production
DATABASE_URL=postgresql://user:pass@db:5432/myapp
SECRET_KEY=your-secret-key-here
```

### 7.3 ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ


> ğŸ”’ **å®‰å…¨å»ºè®®**  
> æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€å¯†é’¥ï¼‰åº”è¯¥æ”¾åœ¨.envæ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™åœ¨composeæ–‡ä»¶é‡Œ

```yaml
# âœ… æ¨èåšæ³•
services:
  database:
    image: postgres
    environment:
      POSTGRES_DB: ${DB_NAME}           # ä½¿ç”¨å˜é‡æ›¿æ¢
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}  # æ•æ„Ÿä¿¡æ¯ç”¨å˜é‡
    env_file: .env

# âŒ ä¸æ¨èåšæ³•  
services:
  database:
    image: postgres
    environment:
      POSTGRES_PASSWORD: secret123      # å¯†ç ç›´æ¥æš´éœ²
```

---

## 8. ğŸšª portsç«¯å£æ˜ å°„


### 8.1 ç«¯å£æ˜ å°„åŸºæœ¬æ¦‚å¿µ


**ç«¯å£æ˜ å°„å°±åƒç»™æˆ¿é—´å¼€é—¨**ï¼Œè®©å¤–éƒ¨èƒ½å¤Ÿè®¿é—®å®¹å™¨å†…çš„æœåŠ¡ã€‚

```
ç«¯å£æ˜ å°„åŸç†ï¼š
å¤–éƒ¨è®¿é—®:8080 â†’ æ˜ å°„åˆ° â†’ å®¹å™¨å†…éƒ¨:80

å®¿ä¸»æœº                     å®¹å™¨
    â†“                       â†“
localhost:8080  â”€â”€â”€â”€â”€â”€â”€â”€â†’  nginx:80
```

### 8.2 ç«¯å£é…ç½®è¯­æ³•


**ğŸ”¸ åŸºæœ¬è¯­æ³•æ ¼å¼**ï¼š
```yaml
services:
  web:
    image: nginx
    ports:
      - "å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£"
```

**ğŸ”¸ å¸¸è§é…ç½®ç¤ºä¾‹**ï¼š
```yaml
services:
  # WebæœåŠ¡å™¨
  nginx:
    image: nginx
    ports:
      - "80:80"               # HTTPç«¯å£
      - "443:443"             # HTTPSç«¯å£
      
  # åº”ç”¨æœåŠ¡
  webapp:
    image: myapp
    ports:
      - "3000:3000"           # Node.jsåº”ç”¨
      
  # æ•°æ®åº“ï¼ˆé€šå¸¸ä¸éœ€è¦æš´éœ²ï¼‰
  database:
    image: mysql
    # ä¸é…ç½®portsï¼Œåªå…è®¸å†…éƒ¨è®¿é—®
```

### 8.3 ç«¯å£é…ç½®è¿›é˜¶æŠ€å·§


**ğŸ”¸ æŒ‡å®šIPåœ°å€**ï¼š
```yaml
services:
  web:
    image: nginx
    ports:
      - "127.0.0.1:8080:80"   # åªå…è®¸æœ¬åœ°è®¿é—®
```

**ğŸ”¸ åŠ¨æ€ç«¯å£æ˜ å°„**ï¼š
```yaml
services:
  web:
    image: nginx
    ports:
      - "80"                  # è®©Dockerè‡ªåŠ¨åˆ†é…å®¿ä¸»æœºç«¯å£
```

**ğŸ”¸ UDPç«¯å£**ï¼š
```yaml
services:
  dns:
    image: dns-server
    ports:
      - "53:53/udp"           # UDPåè®®ç«¯å£
```

### 8.4 ç«¯å£å†²çªè§£å†³


```yaml
# é—®é¢˜ï¼šå¤šä¸ªé¡¹ç›®éƒ½æƒ³ä½¿ç”¨80ç«¯å£
# è§£å†³ï¼šä½¿ç”¨ä¸åŒçš„å®¿ä¸»æœºç«¯å£

# é¡¹ç›®A
services:
  web-a:
    ports:
      - "8080:80"             # é¡¹ç›®Aä½¿ç”¨8080ç«¯å£

# é¡¹ç›®B  
services:
  web-b:
    ports:
      - "8081:80"             # é¡¹ç›®Bä½¿ç”¨8081ç«¯å£
```

---

## 9. ğŸ”— depends_onä¾èµ–å…³ç³»


### 9.1 æœåŠ¡ä¾èµ–çš„å¿…è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ä¾èµ–å…³ç³»**ï¼š
- **å¯åŠ¨é¡ºåº**ï¼šæ•°æ®åº“è¦åœ¨åº”ç”¨ç¨‹åºä¹‹å‰å¯åŠ¨
- **æœåŠ¡å¯ç”¨æ€§**ï¼šé¿å…åº”ç”¨è¿æ¥å¤±è´¥
- **èµ„æºä¾èµ–**ï¼šæŸäº›æœåŠ¡éœ€è¦å…¶ä»–æœåŠ¡æä¾›çš„èµ„æº

```
å…¸å‹çš„Webåº”ç”¨å¯åŠ¨é¡ºåºï¼š
1. æ•°æ®åº“å¯åŠ¨ â†’ 2. ç¼“å­˜å¯åŠ¨ â†’ 3. åº”ç”¨ç¨‹åºå¯åŠ¨ â†’ 4. è´Ÿè½½å‡è¡¡å¯åŠ¨
```

### 9.2 åŸºæœ¬ä¾èµ–é…ç½®


```yaml
version: '3.8'

services:
  # æ•°æ®åº“ï¼ˆåŸºç¡€æœåŠ¡ï¼‰
  database:
    image: postgres:13
    
  # ç¼“å­˜æœåŠ¡
  redis:
    image: redis:alpine
    
  # åº”ç”¨ç¨‹åºï¼ˆä¾èµ–æ•°æ®åº“å’Œç¼“å­˜ï¼‰
  webapp:
    image: myapp
    depends_on:
      - database              # ç­‰å¾…æ•°æ®åº“å¯åŠ¨
      - redis                 # ç­‰å¾…Rediså¯åŠ¨
    
  # è´Ÿè½½å‡è¡¡ï¼ˆä¾èµ–åº”ç”¨ç¨‹åºï¼‰
  nginx:
    image: nginx
    depends_on:
      - webapp                # ç­‰å¾…åº”ç”¨ç¨‹åºå¯åŠ¨
    ports:
      - "80:80"
```

### 9.3 ä¾èµ–å…³ç³»çš„é™åˆ¶


> âš ï¸ **é‡è¦ç†è§£**  
> `depends_on`åªæ§åˆ¶å®¹å™¨å¯åŠ¨é¡ºåºï¼Œä¸ç­‰å¾…æœåŠ¡å®Œå…¨å°±ç»ª

```yaml
services:
  webapp:
    image: myapp
    depends_on:
      - database
    # é—®é¢˜ï¼šæ•°æ®åº“å®¹å™¨å¯åŠ¨äº†ï¼Œä½†MySQLæœåŠ¡å¯èƒ½è¿˜æ²¡å‡†å¤‡å¥½
```

### 9.4 å¥åº·æ£€æŸ¥å’Œæ¡ä»¶ä¾èµ–


**ğŸ”¸ ä½¿ç”¨å¥åº·æ£€æŸ¥**ï¼š
```yaml
services:
  database:
    image: postgres:13
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 30s
      timeout: 10s
      retries: 3
      
  webapp:
    image: myapp
    depends_on:
      database:
        condition: service_healthy    # ç­‰å¾…æ•°æ®åº“å¥åº·æ£€æŸ¥é€šè¿‡
```

**ğŸ”¸ åº”ç”¨å±‚é¢çš„é‡è¯•æœºåˆ¶**ï¼š
```javascript
// åœ¨åº”ç”¨ä»£ç ä¸­å®ç°é‡è¯•è¿æ¥
const connectWithRetry = () => {
  mongoose.connect(process.env.DATABASE_URL)
    .catch(err => {
      console.log('æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œ5ç§’åé‡è¯•...');
      setTimeout(connectWithRetry, 5000);
    });
};
```

---

## 10. ğŸ¯ ç»¼åˆå®æˆ˜ç¤ºä¾‹


### 10.1 å®Œæ•´çš„WordPressåº”ç”¨


```yaml
version: '3.8'

services:
  # æ•°æ®åº“æœåŠ¡
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wpuser
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - backend
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 30s
      timeout: 10s
      retries: 3

  # WordPressåº”ç”¨
  wordpress:
    image: wordpress:latest
    depends_on:
      mysql:
        condition: service_healthy
    environment:
      WORDPRESS_DB_HOST: mysql:3306
      WORDPRESS_DB_USER: wpuser
      WORDPRESS_DB_PASSWORD: ${MYSQL_PASSWORD}
      WORDPRESS_DB_NAME: wordpress
    volumes:
      - wordpress-data:/var/www/html
    networks:
      - frontend
      - backend
    ports:
      - "8080:80"

  # åå‘ä»£ç†
  nginx:
    image: nginx:alpine
    depends_on:
      - wordpress
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./ssl:/etc/ssl:ro
    networks:
      - frontend

# æ•°æ®å·å®šä¹‰
volumes:
  mysql-data:
    driver: local
  wordpress-data:
    driver: local

# ç½‘ç»œå®šä¹‰
networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
```

### 10.2 é…å¥—çš„.envæ–‡ä»¶


```bash
# .env æ–‡ä»¶
MYSQL_ROOT_PASSWORD=super_secure_root_password
MYSQL_PASSWORD=secure_wp_password
```

### 10.3 æ“ä½œå‘½ä»¤


```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f wordpress

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆæ…ç”¨ï¼ï¼‰
docker-compose down -v
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ docker-compose.ymlï¼šå¤šå®¹å™¨åº”ç”¨çš„é…ç½®æ–‡ä»¶
ğŸ”¸ versionï¼šç‰ˆæœ¬å£°æ˜ï¼Œæ¨èä½¿ç”¨3.8
ğŸ”¸ servicesï¼šæœåŠ¡å®šä¹‰ï¼Œåº”ç”¨çš„å„ä¸ªç»„ä»¶
ğŸ”¸ networksï¼šç½‘ç»œé…ç½®ï¼Œå®¹å™¨é—´é€šä¿¡
ğŸ”¸ volumesï¼šæ•°æ®å·ï¼ŒæŒä¹…åŒ–å­˜å‚¨
ğŸ”¸ environmentï¼šç¯å¢ƒå˜é‡ï¼Œåº”ç”¨é…ç½®
ğŸ”¸ portsï¼šç«¯å£æ˜ å°„ï¼Œå¤–éƒ¨è®¿é—®å…¥å£
ğŸ”¸ depends_onï¼šä¾èµ–å…³ç³»ï¼Œå¯åŠ¨é¡ºåºæ§åˆ¶
```

### 11.2 æœ€ä½³å®è·µæ€»ç»“


**ğŸ“‹ é…ç½®æ–‡ä»¶ç»„ç»‡**ï¼š
```yaml
# âœ… æ¨èçš„æ–‡ä»¶ç»“æ„
project/
â”œâ”€â”€ docker-compose.yml        # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ .env                      # ç¯å¢ƒå˜é‡
â”œâ”€â”€ nginx/                    # nginxé…ç½®
â”‚   â””â”€â”€ nginx.conf
â””â”€â”€ init/                     # åˆå§‹åŒ–è„šæœ¬
    â””â”€â”€ init.sql
```

**ğŸ” å®‰å…¨é…ç½®**ï¼š
- æ•æ„Ÿä¿¡æ¯æ”¾åœ¨`.env`æ–‡ä»¶
- ä¸è¦åœ¨composeæ–‡ä»¶ä¸­ç¡¬ç¼–ç å¯†ç 
- ä½¿ç”¨å¥åº·æ£€æŸ¥ç¡®ä¿æœåŠ¡å°±ç»ª
- åˆç†é…ç½®ç½‘ç»œéš”ç¦»

**âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼š
- ä½¿ç”¨å‘½åå·æå‡IOæ€§èƒ½
- åˆç†è®¾ç½®ä¾èµ–å…³ç³»å‡å°‘å¯åŠ¨æ—¶é—´
- ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ

### 11.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


| **é—®é¢˜** | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|----------|----------|--------------|
| å®¹å™¨æ— æ³•é€šä¿¡ | ç½‘ç»œé…ç½®é”™è¯¯ | æ£€æŸ¥networksé…ç½® |
| æ•°æ®ä¸¢å¤± | æœªé…ç½®æ•°æ®å· | æ·»åŠ volumesæ˜ å°„ |
| å¯åŠ¨å¤±è´¥ | ä¾èµ–å…³ç³»é—®é¢˜ | ä½¿ç”¨depends_on |
| ç«¯å£å†²çª | ç«¯å£è¢«å ç”¨ | ä¿®æ”¹ç«¯å£æ˜ å°„ |

### 11.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
ğŸŒ± åˆçº§é˜¶æ®µï¼š
- ç†è§£åŸºæœ¬æ¦‚å¿µå’Œè¯­æ³•
- èƒ½ç¼–å†™ç®€å•çš„composeæ–‡ä»¶
- æŒæ¡å¸¸ç”¨æ“ä½œå‘½ä»¤

ğŸŒ¿ ä¸­çº§é˜¶æ®µï¼š
- æŒæ¡ç½‘ç»œå’Œæ•°æ®å·é…ç½®
- ç†è§£æœåŠ¡ä¾èµ–å…³ç³»
- èƒ½è®¾è®¡å¤šå±‚æ¶æ„åº”ç”¨

ğŸŒ³ é«˜çº§é˜¶æ®µï¼š
- æŒæ¡å¥åº·æ£€æŸ¥å’Œæ‰©å®¹
- äº†è§£ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ
- èƒ½å¤„ç†å¤æ‚çš„éƒ¨ç½²åœºæ™¯
```

> ğŸ’¡ **æ ¸å¿ƒè®°å¿†**  
> Docker Compose = å¤šå®¹å™¨ç¼–æ’å·¥å…·  
> ä¸€ä¸ªYAMLæ–‡ä»¶æè¿°æ•´ä¸ªåº”ç”¨æ¶æ„  
> æ ¸å¿ƒæ˜¯servicesã€networksã€volumesä¸‰å¤§è¦ç´   
> depends_onæ§åˆ¶å¯åŠ¨é¡ºåºï¼Œenvironmenté…ç½®ç¯å¢ƒ