---
title: 5ã€Composeå®æˆ˜é¡¹ç›®
---
## ğŸ“š ç›®å½•

1. [Docker Composeå®æˆ˜é¡¹ç›®æ¦‚è¿°](#1-docker-composeå®æˆ˜é¡¹ç›®æ¦‚è¿°)
2. [WordPressåšå®¢ç³»ç»Ÿæ­å»º](#2-wordpressåšå®¢ç³»ç»Ÿæ­å»º)
3. [LAMP/LEMPç¯å¢ƒç¼–æ’](#3-lamp-lempç¯å¢ƒç¼–æ’)
4. [å¤šå®¹å™¨å¾®æœåŠ¡åº”ç”¨](#4-å¤šå®¹å™¨å¾®æœåŠ¡åº”ç”¨)
5. [å‰åç«¯åˆ†ç¦»éƒ¨ç½²å®è·µ](#5-å‰åç«¯åˆ†ç¦»éƒ¨ç½²å®è·µ)
6. [æ•°æ®åº“æœåŠ¡ç¼–æ’](#6-æ•°æ®åº“æœåŠ¡ç¼–æ’)
7. [å¼€å‘ç¯å¢ƒæ­å»ºå®æˆ˜](#7-å¼€å‘ç¯å¢ƒæ­å»ºå®æˆ˜)
8. [æ‰©ç¼©å®¹æ“ä½œå®è·µ](#8-æ‰©ç¼©å®¹æ“ä½œå®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ Docker Composeå®æˆ˜é¡¹ç›®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Docker Composeå®æˆ˜é¡¹ç›®


**ğŸ’¡ ç®€å•ç†è§£**
Docker Composeå®æˆ˜é¡¹ç›®å°±æ˜¯ç”¨çœŸå®çš„åº”ç”¨åœºæ™¯æ¥ç»ƒæ‰‹ï¼ŒæŠŠå¤šä¸ªå®¹å™¨ç»„åˆåœ¨ä¸€èµ·è¿è¡Œå®Œæ•´çš„åº”ç”¨ç³»ç»Ÿã€‚å°±åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œæ¯ä¸ªå®¹å™¨æ˜¯ä¸€å—ç§¯æœ¨ï¼ŒComposeå¸®ä½ æŠŠå®ƒä»¬æ‹¼æˆä¸€ä¸ªå®Œæ•´çš„æˆ¿å­ã€‚

**ğŸ¯ ä¸ºä»€ä¹ˆè¦åšå®æˆ˜é¡¹ç›®**
```
ç†è®ºå­¦ä¹ ï¼šçŸ¥é“Composeèƒ½åšä»€ä¹ˆ
å®æˆ˜é¡¹ç›®ï¼šçœŸæ­£ä¼šç”¨Composeè§£å†³é—®é¢˜

å¥½æ¯”ï¼š
- å­¦å¼€è½¦ç†è®º â‰  ä¼šå¼€è½¦ä¸Šè·¯
- å­¦Composeè¯­æ³• â‰  ä¼šæ­å»ºçœŸå®åº”ç”¨
```

### 1.2 å®æˆ˜é¡¹ç›®çš„æ ¸å¿ƒä»·å€¼


**ğŸ”¸ æŠ€èƒ½æå‡è·¯å¾„**
```
å•å®¹å™¨è¿è¡Œ
    â†“
å¤šå®¹å™¨æ‰‹åŠ¨ç®¡ç†
    â†“
Composeè‡ªåŠ¨ç¼–æ’  â† æˆ‘ä»¬ç°åœ¨çš„ä½ç½®
    â†“
ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```

**ğŸ“‹ å®æˆ˜é¡¹ç›®å¸¦æ¥çš„æ”¶è·**
- **å®é™…ç»éªŒ**ï¼šé‡åˆ°çœŸå®é—®é¢˜ï¼Œå­¦ä¼šè§£å†³æ–¹æ¡ˆ
- **æœ€ä½³å®è·µ**ï¼šå­¦ä¼šä¸šç•Œå¸¸ç”¨çš„é…ç½®æ¨¡å¼
- **è°ƒè¯•æŠ€èƒ½**ï¼šå½“å®¹å™¨å‡ºé—®é¢˜æ—¶çŸ¥é“æ€ä¹ˆæ’æŸ¥
- **æ¶æ„æ€ç»´**ï¼šç†è§£ä¸åŒæœåŠ¡å¦‚ä½•åä½œ

### 1.3 å®æˆ˜é¡¹ç›®åˆ†ç±»


**ğŸ·ï¸ æŒ‰å¤æ‚åº¦åˆ†ç±»**
```
å…¥é—¨çº§ï¼šWordPressåšå®¢ï¼ˆ2-3ä¸ªå®¹å™¨ï¼‰
è¿›é˜¶çº§ï¼šLAMPç¯å¢ƒï¼ˆ4-5ä¸ªå®¹å™¨ï¼‰
é«˜çº§ï¼šå¾®æœåŠ¡æ¶æ„ï¼ˆ8-10ä¸ªå®¹å™¨ï¼‰
```

**ğŸ·ï¸ æŒ‰åº”ç”¨ç±»å‹åˆ†ç±»**
```
â€¢ å†…å®¹ç®¡ç†ç³»ç»Ÿï¼šWordPressã€Drupal
â€¢ å¼€å‘ç¯å¢ƒï¼šLAMPã€LEMPã€Node.jsç¯å¢ƒ
â€¢ æ•°æ®åº“é›†ç¾¤ï¼šMySQLä¸»ä»ã€Redisé›†ç¾¤
â€¢ å¾®æœåŠ¡æ¶æ„ï¼šå‰ç«¯+åç«¯API+æ•°æ®åº“+ç¼“å­˜
```

---

## 2. ğŸ“ WordPressåšå®¢ç³»ç»Ÿæ­å»º


### 2.1 WordPressæ¶æ„ç†è§£


**ğŸ—ï¸ WordPressç³»ç»Ÿç»„æˆ**
```
WordPressæ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è®¿é—®   â”‚â”€â”€â”€â–¶â”‚  WebæœåŠ¡å™¨   â”‚â”€â”€â”€â–¶â”‚   æ•°æ®åº“    â”‚
â”‚ (æµè§ˆå™¨)    â”‚â—€â”€â”€â”€â”‚ (WordPress) â”‚â—€â”€â”€â”€â”‚  (MySQL)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  æŒä¹…åŒ–å­˜å‚¨  â”‚
                   â”‚ (æ–‡ä»¶ç³»ç»Ÿ)   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’­ ç”Ÿæ´»åŒ–ç±»æ¯”**
WordPresså°±åƒå¼€é¤å…ï¼š
- **WordPresså®¹å™¨**ï¼šå¨å¸ˆï¼ˆå¤„ç†è¯·æ±‚ï¼Œåˆ¶ä½œé¡µé¢ï¼‰
- **MySQLå®¹å™¨**ï¼šä»“åº“ï¼ˆå­˜å‚¨æ‰€æœ‰æ•°æ®ï¼‰
- **Volume**ï¼šå†°ç®±ï¼ˆæŒä¹…ä¿å­˜é£Ÿæï¼‰

### 2.2 WordPress Composeé…ç½®è¯¦è§£


**ğŸ“„ åŸºç¡€wordpressé…ç½®**
```yaml
version: '3.8'

services:
  # WordPressåº”ç”¨æœåŠ¡
  wordpress:
    image: wordpress:latest
    restart: always
    ports:
      - "8080:80"
    environment:
      # æ•°æ®åº“è¿æ¥é…ç½®
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: wordpress_user
      WORDPRESS_DB_PASSWORD: secure_password
      WORDPRESS_DB_NAME: wordpress_db
    volumes:
      # æŒä¹…åŒ–WordPressæ–‡ä»¶
      - wordpress_data:/var/www/html
    depends_on:
      - db
    networks:
      - wordpress_network

  # MySQLæ•°æ®åº“æœåŠ¡  
  db:
    image: mysql:8.0
    restart: always
    environment:
      # æ•°æ®åº“åˆå§‹åŒ–é…ç½®
      MYSQL_DATABASE: wordpress_db
      MYSQL_USER: wordpress_user
      MYSQL_PASSWORD: secure_password
      MYSQL_ROOT_PASSWORD: root_password
    volumes:
      # æŒä¹…åŒ–æ•°æ®åº“æ•°æ®
      - db_data:/var/lib/mysql
    networks:
      - wordpress_network

# æ•°æ®å·å®šä¹‰
volumes:
  wordpress_data:
  db_data:

# ç½‘ç»œå®šä¹‰
networks:
  wordpress_network:
    driver: bridge
```

### 2.3 é…ç½®è§£è¯»ä¸æœ€ä½³å®è·µ


**ğŸ” å…³é”®é…ç½®è§£æ**

**ç«¯å£æ˜ å°„ç†è§£**
```
ports: "8080:80"

è§£é‡Šï¼š
- 8080ï¼šä½ ç”µè„‘ä¸Šè®¿é—®çš„ç«¯å£
- 80ï¼šWordPresså®¹å™¨å†…çš„ç«¯å£
- æ„æ€ï¼šæµè§ˆå™¨è®¿é—® localhost:8080 å°±èƒ½çœ‹åˆ°WordPress
```

**ç¯å¢ƒå˜é‡ä½œç”¨**
```
WORDPRESS_DB_HOST: db:3306

ä¸ºä»€ä¹ˆæ˜¯ "db" è€Œä¸æ˜¯IPåœ°å€ï¼Ÿ
- å› ä¸ºåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œå®¹å™¨å¯ä»¥ç”¨æœåŠ¡åäº’ç›¸è®¿é—®
- "db" å°±æ˜¯MySQLå®¹å™¨çš„æœåŠ¡å
- Dockerä¼šè‡ªåŠ¨è§£ææˆå¯¹åº”çš„IPåœ°å€
```

**æ•°æ®æŒä¹…åŒ–**
```yaml
volumes:
  - wordpress_data:/var/www/html

è¿™æ ·åšçš„å¥½å¤„ï¼š
â€¢ å®¹å™¨åˆ é™¤åï¼Œç½‘ç«™å†…å®¹ä¸ä¸¢å¤±
â€¢ ä¸»é¢˜ã€æ’ä»¶ã€ä¸Šä¼ çš„å›¾ç‰‡éƒ½ä¿å­˜ä¸‹æ¥
â€¢ é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œä¸€åˆ‡æ¢å¤å¦‚åˆ
```

### 2.4 WordPresséƒ¨ç½²å®æ“


**ğŸš€ å¯åŠ¨æ­¥éª¤**
```bash
# 1. åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir wordpress-project && cd wordpress-project

# 2. åˆ›å»ºdocker-compose.ymlæ–‡ä»¶
# (å¤åˆ¶ä¸Šé¢çš„é…ç½®å†…å®¹)

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs wordpress
```

**âœ… éªŒè¯éƒ¨ç½²**
```
è®¿é—®æ­¥éª¤ï¼š
1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—® http://localhost:8080
3. çœ‹åˆ°WordPresså®‰è£…é¡µé¢ = æˆåŠŸï¼
4. æŒ‰ç…§å‘å¯¼å®ŒæˆWordPressåˆå§‹é…ç½®
```

**ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥**
```
é—®é¢˜ï¼šæ— æ³•è®¿é—®WordPress
æ’æŸ¥ï¼š
1. æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼šdocker-compose ps
2. æŸ¥çœ‹ç«¯å£å ç”¨ï¼šnetstat -an | grep 8080
3. æŸ¥çœ‹æ—¥å¿—ï¼šdocker-compose logs

é—®é¢˜ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
æ’æŸ¥ï¼š
1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤MySQLå®¹å™¨æ­£å¸¸è¿è¡Œ
3. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼šdocker-compose exec wordpress ping db
```

---

## 3. ğŸ”§ LAMP/LEMPç¯å¢ƒç¼–æ’


### 3.1 LAMP/LEMPæ¶æ„ç†è§£


**ğŸ“Š æ¶æ„å¯¹æ¯”**
```
LAMPæ¶æ„ï¼š                    LEMPæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apache  â”‚                  â”‚ Nginx   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PHP     â”‚                  â”‚ PHP     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQL   â”‚                  â”‚ MySQL   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŒºåˆ«ï¼š
â€¢ LAMP = Linux + Apache + MySQL + PHP
â€¢ LEMP = Linux + Nginx + MySQL + PHP
```

**ğŸ’¡ ä¸ºä»€ä¹ˆé€‰æ‹©LEMP**
```
Apache vs Nginxï¼š

Apacheï¼š
âœ… é…ç½®ç®€å•ï¼ŒåŠŸèƒ½å…¨é¢
âŒ å†…å­˜å ç”¨å¤§ï¼Œå¹¶å‘å¤„ç†èƒ½åŠ›ä¸€èˆ¬

Nginxï¼š
âœ… é«˜æ€§èƒ½ï¼Œä½å†…å­˜å ç”¨
âœ… åå‘ä»£ç†åŠŸèƒ½å¼ºå¤§
âŒ é…ç½®ç¨å¾®å¤æ‚ä¸€äº›

ç°ä»£æ¨èï¼šLEMPï¼ˆNginxæ€§èƒ½æ›´å¥½ï¼‰
```

### 3.2 LEMPç¯å¢ƒé…ç½®å®æˆ˜


**ğŸ“„ å®Œæ•´LEMPé…ç½®**
```yaml
version: '3.8'

services:
  # Nginx WebæœåŠ¡å™¨
  nginx:
    image: nginx:alpine
    container_name: lemp_nginx
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # ç½‘ç«™ä»£ç 
      - ./www:/var/www/html
      # Nginxé…ç½®
      - ./nginx/conf.d:/etc/nginx/conf.d
      # SSLè¯ä¹¦ï¼ˆå¦‚æœéœ€è¦ï¼‰
      - ./nginx/ssl:/etc/nginx/ssl
    depends_on:
      - php
    networks:
      - lemp_network

  # PHP-FPMå¤„ç†å™¨
  php:
    image: php:8.1-fpm-alpine
    container_name: lemp_php
    restart: always
    volumes:
      # å…±äº«ç½‘ç«™ä»£ç 
      - ./www:/var/www/html
      # PHPé…ç½®
      - ./php/php.ini:/usr/local/etc/php/php.ini
    networks:
      - lemp_network

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: lemp_mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: app_database
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app_password
    volumes:
      # æ•°æ®æŒä¹…åŒ–
      - mysql_data:/var/lib/mysql
      # åˆå§‹åŒ–è„šæœ¬
      - ./mysql/init:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"
    networks:
      - lemp_network

  # PHPMyAdminç®¡ç†å·¥å…·
  phpmyadmin:
    image: phpmyadmin:latest
    container_name: lemp_phpmyadmin
    restart: always
    ports:
      - "8080:80"
    environment:
      PMA_HOST: mysql
      MYSQL_ROOT_PASSWORD: root_password
    depends_on:
      - mysql
    networks:
      - lemp_network

volumes:
  mysql_data:

networks:
  lemp_network:
    driver: bridge
```

### 3.3 Nginxé…ç½®è¯¦è§£


**ğŸ“„ Nginxç«™ç‚¹é…ç½®**
```nginx
# ./nginx/conf.d/default.conf
server {
    listen 80;
    server_name localhost;
    root /var/www/html;
    index index.php index.html;

    # PHPæ–‡ä»¶å¤„ç†
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        # æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨phpå®¹å™¨å
        fastcgi_pass php:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    # é™æ€æ–‡ä»¶å¤„ç†
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # éšè—æ•æ„Ÿæ–‡ä»¶
    location ~ /\. {
        deny all;
    }
}
```

**ğŸ” é…ç½®è¦ç‚¹è§£æ**
```
fastcgi_pass php:9000;

ä¸ºä»€ä¹ˆæ˜¯ php:9000ï¼Ÿ
â€¢ phpï¼šå®¹å™¨æœåŠ¡å
â€¢ 9000ï¼šPHP-FPMç›‘å¬ç«¯å£
â€¢ Nginxé€šè¿‡è¿™ä¸ªåœ°å€æŠŠPHPè¯·æ±‚è½¬å‘ç»™PHPå®¹å™¨
```

### 3.4 LEMPç¯å¢ƒéƒ¨ç½²å®è·µ


**ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„**
```
lemp-project/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ www/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ info.php
â”‚   â””â”€â”€ test/
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ conf.d/
â”‚       â””â”€â”€ default.conf
â”œâ”€â”€ php/
â”‚   â””â”€â”€ php.ini
â””â”€â”€ mysql/
    â””â”€â”€ init/
        â””â”€â”€ init.sql
```

**ğŸ§ª æµ‹è¯•PHPç¯å¢ƒ**
```php
<?php
// ./www/info.php
echo "<h1>LEMPç¯å¢ƒæµ‹è¯•</h1>";
echo "<p>PHPç‰ˆæœ¬ï¼š" . phpversion() . "</p>";
echo "<p>æœåŠ¡å™¨ä¿¡æ¯ï¼š" . $_SERVER['SERVER_SOFTWARE'] . "</p>";

// æµ‹è¯•MySQLè¿æ¥
try {
    $pdo = new PDO('mysql:host=mysql;dbname=app_database', 'app_user', 'app_password');
    echo "<p style='color: green'>âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ</p>";
} catch(PDOException $e) {
    echo "<p style='color: red'>âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: " . $e->getMessage() . "</p>";
}
?>
```

**ğŸš€ éƒ¨ç½²å‘½ä»¤**
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
mkdir -p lemp-project/{www,nginx/conf.d,php,mysql/init}
cd lemp-project

# åˆ›å»ºæµ‹è¯•é¡µé¢
echo "<h1>æ¬¢è¿ä½¿ç”¨LEMPç¯å¢ƒ</h1>" > www/index.html

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# éªŒè¯æœåŠ¡
docker-compose ps
```

---

## 4. ğŸŒ å¤šå®¹å™¨å¾®æœåŠ¡åº”ç”¨


### 4.1 å¾®æœåŠ¡æ¶æ„ç†è§£


**ğŸ—ï¸ å•ä½“åº”ç”¨ vs å¾®æœåŠ¡æ¶æ„**
```
å•ä½“åº”ç”¨ï¼š                    å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚                 â”‚          â”‚ç”¨æˆ· â”‚ â”‚è®¢å• â”‚ â”‚æ”¯ä»˜ â”‚
â”‚   å…¨éƒ¨åŠŸèƒ½      â”‚          â”‚æœåŠ¡ â”‚ â”‚æœåŠ¡ â”‚ â”‚æœåŠ¡ â”‚
â”‚   åœ¨ä¸€èµ·        â”‚    VS    â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
â”‚                 â”‚               â”‚       â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ å…±äº«æ•°æ®åº“â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å¾®æœåŠ¡çš„å¥½å¤„**
```
â€¢ ç‹¬ç«‹å¼€å‘ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
â€¢ æŠ€æœ¯é€‰æ‹©ï¼šä¸åŒæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒæŠ€æœ¯
â€¢ æ‰©å±•çµæ´»ï¼šæ ¹æ®éœ€è¦æ‰©å±•ç‰¹å®šæœåŠ¡
â€¢ æ•…éšœéš”ç¦»ï¼šä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜ä¸å½±å“å…¶ä»–æœåŠ¡
```

### 4.2 ç”µå•†å¾®æœåŠ¡æ¶æ„å®æˆ˜


**ğŸ›ï¸ ç®€åŒ–ç”µå•†ç³»ç»Ÿæ¶æ„**
```yaml
version: '3.8'

services:
  # å‰ç«¯åº”ç”¨
  frontend:
    image: nginx:alpine
    container_name: shop_frontend
    ports:
      - "3000:80"
    volumes:
      - ./frontend/build:/usr/share/nginx/html
      - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - api-gateway
    networks:
      - shop_network

  # APIç½‘å…³
  api-gateway:
    image: nginx:alpine
    container_name: shop_gateway
    ports:
      - "8000:80"
    volumes:
      - ./gateway/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - user-service
      - product-service
      - order-service
    networks:
      - shop_network

  # ç”¨æˆ·æœåŠ¡
  user-service:
    image: node:16-alpine
    container_name: shop_user_service
    working_dir: /app
    volumes:
      - ./services/user:/app
    command: npm start
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
    networks:
      - shop_network

  # å•†å“æœåŠ¡
  product-service:
    image: node:16-alpine
    container_name: shop_product_service
    working_dir: /app
    volumes:
      - ./services/product:/app
    command: npm start
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
    depends_on:
      - mysql
    networks:
      - shop_network

  # è®¢å•æœåŠ¡
  order-service:
    image: node:16-alpine
    container_name: shop_order_service
    working_dir: /app
    volumes:
      - ./services/order:/app
    command: npm start
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
      - USER_SERVICE=http://user-service:3000
      - PRODUCT_SERVICE=http://product-service:3000
    depends_on:
      - mysql
      - user-service
      - product-service
    networks:
      - shop_network

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: shop_mysql
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: shop_db
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - shop_network

  # Redisç¼“å­˜
  redis:
    image: redis:alpine
    container_name: shop_redis
    networks:
      - shop_network

volumes:
  mysql_data:

networks:
  shop_network:
    driver: bridge
```

### 4.3 APIç½‘å…³é…ç½®


**ğŸšª ç½‘å…³è·¯ç”±é…ç½®**
```nginx
# ./gateway/nginx.conf
upstream user_service {
    server user-service:3000;
}

upstream product_service {
    server product-service:3000;
}

upstream order_service {
    server order-service:3000;
}

server {
    listen 80;
    
    # ç”¨æˆ·ç›¸å…³æ¥å£
    location /api/users/ {
        proxy_pass http://user_service/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # å•†å“ç›¸å…³æ¥å£
    location /api/products/ {
        proxy_pass http://product_service/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # è®¢å•ç›¸å…³æ¥å£
    location /api/orders/ {
        proxy_pass http://order_service/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 4.4 æœåŠ¡é—´é€šä¿¡å®è·µ


**ğŸ“¡ æœåŠ¡è°ƒç”¨ç¤ºä¾‹**
```javascript
// order-serviceè°ƒç”¨user-service
const axios = require('axios');

async function createOrder(userId, products) {
    try {
        // éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        const userResponse = await axios.get(
            `http://user-service:3000/users/${userId}`
        );
        
        if (!userResponse.data) {
            throw new Error('ç”¨æˆ·ä¸å­˜åœ¨');
        }
        
        // éªŒè¯å•†å“åº“å­˜
        for (let product of products) {
            const productResponse = await axios.get(
                `http://product-service:3000/products/${product.id}`
            );
            
            if (productResponse.data.stock < product.quantity) {
                throw new Error(`å•†å“ ${product.id} åº“å­˜ä¸è¶³`);
            }
        }
        
        // åˆ›å»ºè®¢å•é€»è¾‘
        // ...
        
    } catch (error) {
        console.error('åˆ›å»ºè®¢å•å¤±è´¥:', error.message);
        throw error;
    }
}
```

---

## 5. ğŸ”„ å‰åç«¯åˆ†ç¦»éƒ¨ç½²å®è·µ


### 5.1 å‰åç«¯åˆ†ç¦»æ¶æ„ç†è§£


**ğŸ—ï¸ ä¼ ç»Ÿæ¶æ„ vs å‰åç«¯åˆ†ç¦»**
```
ä¼ ç»Ÿæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ HTTPè¯·æ±‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯åº”ç”¨   â”‚ â† åŒ…å«å‰ç«¯é¡µé¢æ¸²æŸ“
â”‚  (PHP/Java) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å‰åç«¯åˆ†ç¦»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨    â”‚â—€â”€â”€â–¶â”‚   å‰ç«¯åº”ç”¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ (React/Vue) â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ APIè°ƒç”¨
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   åç«¯API   â”‚
                   â”‚   æœåŠ¡å™¨    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å‰åç«¯åˆ†ç¦»çš„ä¼˜åŠ¿**
```
â€¢ å¼€å‘æ•ˆç‡ï¼šå‰åç«¯å¯ä»¥å¹¶è¡Œå¼€å‘
â€¢ æŠ€æœ¯é€‰æ‹©ï¼šå‰åç«¯æŠ€æœ¯æ ˆç‹¬ç«‹
â€¢ ç”¨æˆ·ä½“éªŒï¼šå‰ç«¯å¯ä»¥åšæˆSPAï¼Œä½“éªŒæ›´å¥½
â€¢ éƒ¨ç½²çµæ´»ï¼šå‰åç«¯å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
```

### 5.2 React + Express åˆ†ç¦»éƒ¨ç½²


**ğŸ“„ å‰åç«¯åˆ†ç¦»é…ç½®**
```yaml
version: '3.8'

services:
  # Reactå‰ç«¯åº”ç”¨
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: app_frontend
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_BASE_URL=http://localhost:5000/api
    volumes:
      # å¼€å‘ç¯å¢ƒçƒ­é‡è½½
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
    depends_on:
      - backend
    networks:
      - app_network

  # Expressåç«¯API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: app_backend
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=development
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_NAME=app_db
      - DB_USER=app_user
      - DB_PASS=app_password
      - JWT_SECRET=your_jwt_secret
    volumes:
      # å¼€å‘ç¯å¢ƒçƒ­é‡è½½
      - ./backend/src:/app/src
    depends_on:
      - postgres
      - redis
    networks:
      - app_network

  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:13
    container_name: app_postgres
    environment:
      POSTGRES_DB: app_db
      POSTGRES_USER: app_user
      POSTGRES_PASSWORD: app_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    networks:
      - app_network

  # Redisç¼“å­˜
  redis:
    image: redis:alpine
    container_name: app_redis
    ports:
      - "6379:6379"
    networks:
      - app_network

  # Nginxåå‘ä»£ç†ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
  nginx:
    image: nginx:alpine
    container_name: app_nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      # é™æ€æ–‡ä»¶æœåŠ¡
      - frontend_build:/usr/share/nginx/html
    depends_on:
      - frontend
      - backend
    networks:
      - app_network
    profiles:
      - production

volumes:
  postgres_data:
  frontend_build:

networks:
  app_network:
    driver: bridge
```

### 5.3 Dockeræ–‡ä»¶é…ç½®


**ğŸ³ Reactå‰ç«¯Dockerfile**
```dockerfile
# ./frontend/Dockerfile
# å¤šé˜¶æ®µæ„å»ºï¼šå¼€å‘ + ç”Ÿäº§
FROM node:16-alpine as development

WORKDIR /app
COPY package*.json ./
RUN npm install

COPY . .
EXPOSE 3000
CMD ["npm", "start"]

# ç”Ÿäº§æ„å»ºé˜¶æ®µ
FROM node:16-alpine as build
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

# Nginxç”Ÿäº§ç¯å¢ƒ
FROM nginx:alpine as production
COPY --from=build /app/build /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**ğŸ³ Expressåç«¯Dockerfile**
```dockerfile
# ./backend/Dockerfile
FROM node:16-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001
USER nodejs

EXPOSE 5000

CMD ["node", "src/app.js"]
```

### 5.4 ç¯å¢ƒé…ç½®ä¸APIä»£ç†


**âš™ï¸ å¼€å‘ç¯å¢ƒé…ç½®**
```javascript
// ./frontend/src/config.js
const config = {
  development: {
    API_BASE_URL: process.env.REACT_APP_API_BASE_URL || 'http://localhost:5000/api'
  },
  production: {
    API_BASE_URL: '/api'  // é€šè¿‡Nginxä»£ç†
  }
};

export default config[process.env.NODE_ENV || 'development'];
```

**ğŸ”„ Nginxç”Ÿäº§ç¯å¢ƒä»£ç†é…ç½®**
```nginx
# ./nginx/nginx.conf
server {
    listen 80;
    server_name localhost;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }

    # APIè¯·æ±‚ä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://backend:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # CORSå¤„ç†
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
    }
}
```

---

## 6. ğŸ—„ï¸ æ•°æ®åº“æœåŠ¡ç¼–æ’


### 6.1 æ•°æ®åº“ç¼–æ’çš„é‡è¦æ€§


**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åº“ç¼–æ’**
æ•°æ®åº“ç¼–æ’å°±åƒç®¡ç†ä¸€ä¸ªå›¾ä¹¦é¦†ç³»ç»Ÿï¼š
- **å•ä¸ªæ•°æ®åº“**ï¼šåªæœ‰ä¸€ä¸ªå›¾ä¹¦é¦†ï¼Œäººå¤šäº†å°±æ‹¥æŒ¤
- **ä¸»ä»å¤åˆ¶**ï¼šä¸»å›¾ä¹¦é¦†+åˆ†é¦†ï¼Œåˆ†é¦†åŒæ­¥ä¸»é¦†çš„ä¹¦ç±
- **è¯»å†™åˆ†ç¦»**ï¼šå†™æ“ä½œåœ¨ä¸»é¦†ï¼Œè¯»æ“ä½œåˆ†æ•£åˆ°å„åˆ†é¦†
- **é›†ç¾¤éƒ¨ç½²**ï¼šå¤šä¸ªå›¾ä¹¦é¦†äº’ç›¸å¤‡ä»½ï¼Œä¸€ä¸ªå…³é—­å…¶ä»–ç»§ç»­æœåŠ¡

**ğŸ¯ æ•°æ®åº“ç¼–æ’è§£å†³çš„é—®é¢˜**
```
æ•°æ®å®‰å…¨ï¼šé¿å…æ•°æ®ä¸¢å¤±
æ€§èƒ½æå‡ï¼šåˆ†æ•£è¯»å†™å‹åŠ›
é«˜å¯ç”¨ï¼šæœåŠ¡ä¸ä¸­æ–­
æ‰©å±•æ€§ï¼šæ”¯æŒæ›´å¤šç”¨æˆ·è®¿é—®
```

### 6.2 MySQLä¸»ä»å¤åˆ¶é…ç½®


**ğŸ”„ MySQLä¸»ä»æ¶æ„**
```
ä¸»ä»å¤åˆ¶æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    binlog    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æ•°æ®åº“   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   ä»æ•°æ®åº“   â”‚
â”‚  (Master)   â”‚   å¤åˆ¶åŒæ­¥    â”‚   (Slave)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                           â”‚
       â–¼                           â–¼
   å†™æ“ä½œ                      è¯»æ“ä½œ
```

**ğŸ“„ MySQLä¸»ä»Composeé…ç½®**
```yaml
version: '3.8'

services:
  # MySQLä¸»æœåŠ¡å™¨
  mysql-master:
    image: mysql:8.0
    container_name: mysql_master
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: app_db
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app_password
    volumes:
      - mysql_master_data:/var/lib/mysql
      - ./mysql/master/my.cnf:/etc/mysql/conf.d/my.cnf
      - ./mysql/master/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3307:3306"
    networks:
      - mysql_network

  # MySQLä»æœåŠ¡å™¨
  mysql-slave:
    image: mysql:8.0
    container_name: mysql_slave
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: app_db
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app_password
    volumes:
      - mysql_slave_data:/var/lib/mysql
      - ./mysql/slave/my.cnf:/etc/mysql/conf.d/my.cnf
    ports:
      - "3308:3306"
    depends_on:
      - mysql-master
    networks:
      - mysql_network

  # åº”ç”¨æœåŠ¡ï¼ˆæ¼”ç¤ºè¯»å†™åˆ†ç¦»ï¼‰
  app:
    image: node:16-alpine
    container_name: mysql_app
    working_dir: /app
    volumes:
      - ./app:/app
    command: npm start
    environment:
      # å†™æ“ä½œè¿æ¥ä¸»åº“
      DB_MASTER_HOST: mysql-master
      DB_MASTER_PORT: 3306
      # è¯»æ“ä½œè¿æ¥ä»åº“
      DB_SLAVE_HOST: mysql-slave
      DB_SLAVE_PORT: 3306
      DB_USER: app_user
      DB_PASSWORD: app_password
      DB_NAME: app_db
    depends_on:
      - mysql-master
      - mysql-slave
    networks:
      - mysql_network

volumes:
  mysql_master_data:
  mysql_slave_data:

networks:
  mysql_network:
    driver: bridge
```

### 6.3 MySQLé…ç½®æ–‡ä»¶è¯¦è§£


**âš™ï¸ ä¸»æœåŠ¡å™¨é…ç½®**
```ini
# ./mysql/master/my.cnf
[mysqld]
# æœåŠ¡å™¨IDï¼ˆå¿…é¡»å”¯ä¸€ï¼‰
server-id = 1

# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—
log-bin = mysql-bin

# æŒ‡å®šéœ€è¦å¤åˆ¶çš„æ•°æ®åº“
binlog-do-db = app_db

# äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼
binlog-format = ROW

# è‡ªåŠ¨æ¸…ç†7å¤©å‰çš„æ—¥å¿—
expire_logs_days = 7

# å­—ç¬¦é›†
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
```

**âš™ï¸ ä»æœåŠ¡å™¨é…ç½®**
```ini
# ./mysql/slave/my.cnf
[mysqld]
# æœåŠ¡å™¨IDï¼ˆå¿…é¡»å”¯ä¸€ï¼‰
server-id = 2

# å¼€å¯ä¸­ç»§æ—¥å¿—
relay-log = mysql-relay-bin

# æŒ‡å®šéœ€è¦å¤åˆ¶çš„æ•°æ®åº“
replicate-do-db = app_db

# ä»æœåŠ¡å™¨åªè¯»
read-only = 1

# å­—ç¬¦é›†
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
```

### 6.4 ä¸»ä»å¤åˆ¶åˆå§‹åŒ–


**ğŸ”§ ä¸»æœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬**
```sql
-- ./mysql/master/init.sql
-- åˆ›å»ºå¤åˆ¶ç”¨æˆ·
CREATE USER 'replicator'@'%' IDENTIFIED BY 'replicator_password';
GRANT REPLICATION SLAVE ON *.* TO 'replicator'@'%';
FLUSH PRIVILEGES;

-- åˆ›å»ºåº”ç”¨æ•°æ®åº“å’Œè¡¨
USE app_db;
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO users (username, email) VALUES 
('admin', 'admin@example.com'),
('user1', 'user1@example.com');
```

**ğŸš€ å¯åŠ¨å’Œé…ç½®æ­¥éª¤**
```bash
# 1. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 2. è·å–ä¸»æœåŠ¡å™¨çŠ¶æ€
docker-compose exec mysql-master mysql -uroot -proot_password -e "SHOW MASTER STATUS;"

# è¾“å‡ºç¤ºä¾‹ï¼š
# +------------------+----------+--------------+------------------+
# | File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |
# +------------------+----------+--------------+------------------+
# | mysql-bin.000003 |      157 | app_db       |                  |
# +------------------+----------+--------------+------------------+

# 3. é…ç½®ä»æœåŠ¡å™¨ï¼ˆä½¿ç”¨ä¸Šé¢è·å–çš„Fileå’ŒPositionï¼‰
docker-compose exec mysql-slave mysql -uroot -proot_password -e "
CHANGE MASTER TO 
MASTER_HOST='mysql-master',
MASTER_USER='replicator',
MASTER_PASSWORD='replicator_password',
MASTER_LOG_FILE='mysql-bin.000003',
MASTER_LOG_POS=157;
START SLAVE;"

# 4. æ£€æŸ¥ä»æœåŠ¡å™¨çŠ¶æ€
docker-compose exec mysql-slave mysql -uroot -proot_password -e "SHOW SLAVE STATUS\G"
```

### 6.5 Redisé›†ç¾¤é…ç½®


**ğŸ“„ Redisé›†ç¾¤é…ç½®**
```yaml
version: '3.8'

services:
  # RedisèŠ‚ç‚¹1
  redis-1:
    image: redis:alpine
    container_name: redis_node_1
    ports:
      - "7001:7001"
    volumes:
      - ./redis/redis-1.conf:/usr/local/etc/redis/redis.conf
      - redis_1_data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis_network

  # RedisèŠ‚ç‚¹2
  redis-2:
    image: redis:alpine
    container_name: redis_node_2
    ports:
      - "7002:7002"
    volumes:
      - ./redis/redis-2.conf:/usr/local/etc/redis/redis.conf
      - redis_2_data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis_network

  # RedisèŠ‚ç‚¹3
  redis-3:
    image: redis:alpine
    container_name: redis_node_3
    ports:
      - "7003:7003"
    volumes:
      - ./redis/redis-3.conf:/usr/local/etc/redis/redis.conf
      - redis_3_data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis_network

volumes:
  redis_1_data:
  redis_2_data:
  redis_3_data:

networks:
  redis_network:
    driver: bridge
```

---

## 7. ğŸ’» å¼€å‘ç¯å¢ƒæ­å»ºå®æˆ˜


### 7.1 å¼€å‘ç¯å¢ƒçš„ç‰¹æ®Šéœ€æ±‚


**ğŸ” å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒå·®å¼‚**
```
å¼€å‘ç¯å¢ƒéœ€è¦ï¼š
âœ… çƒ­é‡è½½ï¼šä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
âœ… è°ƒè¯•å·¥å…·ï¼šæ–¹ä¾¿è°ƒè¯•å’Œæ’é”™
âœ… å¼€å‘æ•°æ®ï¼šå¯ä»¥éšæ„æµ‹è¯•çš„æ•°æ®
âœ… å¿«é€Ÿå¯åœï¼šå¼€å‘è¿‡ç¨‹ä¸­é¢‘ç¹é‡å¯

ç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼š
âœ… ç¨³å®šæ€§ï¼šæœåŠ¡ç¨³å®šè¿è¡Œ
âœ… æ€§èƒ½ä¼˜åŒ–ï¼šå¤„ç†å¤§é‡ç”¨æˆ·è®¿é—®
âœ… å®‰å…¨æ€§ï¼šæ•°æ®å®‰å…¨å’Œè®¿é—®æ§åˆ¶
âœ… ç›‘æ§å‘Šè­¦ï¼šåŠæ—¶å‘ç°é—®é¢˜
```

**ğŸ’¡ å¼€å‘ç¯å¢ƒæœ€ä½³å®è·µ**
```
â€¢ ä½¿ç”¨VolumeæŒ‚è½½æºä»£ç ï¼Œå®ç°çƒ­é‡è½½
â€¢ æš´éœ²è°ƒè¯•ç«¯å£ï¼Œæ–¹ä¾¿IDEè°ƒè¯•
â€¢ ä½¿ç”¨å¼€å‘ç‰ˆæœ¬é•œåƒï¼ŒåŒ…å«è°ƒè¯•å·¥å…·
â€¢ é…ç½®ç¯å¢ƒå˜é‡ï¼ŒåŒºåˆ†å¼€å‘å’Œç”Ÿäº§æ¨¡å¼
```

### 7.2 å…¨æ ˆå¼€å‘ç¯å¢ƒé…ç½®


**ğŸ“„ å®Œæ•´å¼€å‘ç¯å¢ƒé…ç½®**
```yaml
version: '3.8'

services:
  # å‰ç«¯å¼€å‘æœåŠ¡ (React)
  frontend-dev:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    container_name: dev_frontend
    ports:
      - "3000:3000"    # åº”ç”¨ç«¯å£
      - "3001:3001"    # çƒ­é‡è½½ç«¯å£
    environment:
      - CHOKIDAR_USEPOLLING=true  # æ–‡ä»¶ç›‘å¬
      - REACT_APP_API_URL=http://localhost:8000/api
      - REACT_APP_ENV=development
    volumes:
      # æºä»£ç çƒ­é‡è½½
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
      - ./frontend/package.json:/app/package.json
      # é¿å…node_modulesè¢«è¦†ç›–
      - /app/node_modules
    networks:
      - dev_network

  # åç«¯å¼€å‘æœåŠ¡ (Node.js)
  backend-dev:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: dev_backend
    ports:
      - "8000:8000"    # APIç«¯å£
      - "9229:9229"    # Node.jsè°ƒè¯•ç«¯å£
    environment:
      - NODE_ENV=development
      - DB_HOST=postgres-dev
      - REDIS_HOST=redis-dev
      - PORT=8000
    volumes:
      # æºä»£ç çƒ­é‡è½½
      - ./backend/src:/app/src
      - ./backend/package.json:/app/package.json
      # æ—¥å¿—ç›®å½•
      - ./logs:/app/logs
      # é¿å…node_modulesè¢«è¦†ç›–
      - /app/node_modules
    command: npm run dev  # ä½¿ç”¨nodemonå¯åŠ¨
    depends_on:
      - postgres-dev
      - redis-dev
    networks:
      - dev_network

  # å¼€å‘æ•°æ®åº“ (PostgreSQL)
  postgres-dev:
    image: postgres:13-alpine
    container_name: dev_postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: devdb
      POSTGRES_USER: devuser
      POSTGRES_PASSWORD: devpass
    volumes:
      # å¼€å‘æ•°æ®ä¸éœ€è¦æŒä¹…åŒ–ï¼Œé‡å¯æ—¶é‡ç½®
      - postgres_dev_data:/var/lib/postgresql/data
      # å¼€å‘åˆå§‹åŒ–è„šæœ¬
      - ./database/dev-init.sql:/docker-entrypoint-initdb.d/init.sql
      - ./database/dev-seed.sql:/docker-entrypoint-initdb.d/seed.sql
    networks:
      - dev_network

  # å¼€å‘ç¼“å­˜ (Redis)
  redis-dev:
    image: redis:alpine
    container_name: dev_redis
    ports:
      - "6379:6379"
    # å¼€å‘ç¯å¢ƒä¸éœ€è¦æŒä¹…åŒ–
    networks:
      - dev_network

  # é‚®ä»¶æµ‹è¯•æœåŠ¡ (MailHog)
  mailhog:
    image: mailhog/mailhog
    container_name: dev_mailhog
    ports:
      - "1025:1025"    # SMTPç«¯å£
      - "8025:8025"    # Webç•Œé¢ç«¯å£
    networks:
      - dev_network

  # æ•°æ®åº“ç®¡ç†å·¥å…·
  pgadmin:
    image: dpage/pgadmin4
    container_name: dev_pgadmin
    ports:
      - "8080:80"
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      PGADMIN_DEFAULT_PASSWORD: admin
    depends_on:
      - postgres-dev
    networks:
      - dev_network

volumes:
  postgres_dev_data:

networks:
  dev_network:
    driver: bridge
```

### 7.3 å¼€å‘ä¸“ç”¨Dockerfile


**ğŸ³ å‰ç«¯å¼€å‘Dockerfile**
```dockerfile
# ./frontend/Dockerfile.dev
FROM node:16-alpine

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬å¼€å‘ä¾èµ–ï¼‰
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
CMD ["npm", "start"]
```

**ğŸ³ åç«¯å¼€å‘Dockerfile**
```dockerfile
# ./backend/Dockerfile.dev
FROM node:16-alpine

# å®‰è£…nodemonç”¨äºçƒ­é‡è½½
RUN npm install -g nodemon

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…æ‰€æœ‰ä¾èµ–
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY . .

# æš´éœ²ç«¯å£ï¼ˆåº”ç”¨ç«¯å£ + è°ƒè¯•ç«¯å£ï¼‰
EXPOSE 8000 9229

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå¸¦è°ƒè¯•ï¼‰
CMD ["npm", "run", "dev"]
```

### 7.4 å¼€å‘ç¯å¢ƒè„šæœ¬é…ç½®


**âš™ï¸ package.jsonå¼€å‘è„šæœ¬**
```json
{
  "scripts": {
    "dev": "nodemon --inspect=0.0.0.0:9229 src/app.js",
    "dev:debug": "nodemon --inspect-brk=0.0.0.0:9229 src/app.js",
    "test": "jest --watch",
    "test:coverage": "jest --coverage"
  },
  "nodemonConfig": {
    "watch": ["src"],
    "ext": "js,json",
    "ignore": ["src/**/*.test.js"],
    "env": {
      "NODE_ENV": "development"
    }
  }
}
```

**ğŸš€ å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬**
```bash
#!/bin/bash
# ./scripts/dev-start.sh

echo "ğŸš€ å¯åŠ¨å¼€å‘ç¯å¢ƒ..."

# æ£€æŸ¥Dockeræ˜¯å¦è¿è¡Œ
if ! docker info >/dev/null 2>&1; then
    echo "âŒ Dockeræœªè¿è¡Œï¼Œè¯·å…ˆå¯åŠ¨Docker"
    exit 1
fi

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.dev.yml up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 10

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# æ˜¾ç¤ºè®¿é—®åœ°å€
echo ""
echo "âœ… å¼€å‘ç¯å¢ƒå¯åŠ¨æˆåŠŸï¼"
echo "ğŸŒ å‰ç«¯åº”ç”¨: http://localhost:3000"
echo "ğŸ”§ åç«¯API: http://localhost:8000"
echo "ğŸ“Š æ•°æ®åº“ç®¡ç†: http://localhost:8080"
echo "ğŸ“§ é‚®ä»¶æµ‹è¯•: http://localhost:8025"
echo ""
echo "ğŸ“ æŸ¥çœ‹æ—¥å¿—: docker-compose -f docker-compose.dev.yml logs -f"
echo "ğŸ›‘ åœæ­¢æœåŠ¡: docker-compose -f docker-compose.dev.yml down"
```

### 7.5 å¼€å‘ç¯å¢ƒä¼˜åŒ–æŠ€å·§


**âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
```yaml
# 1. ä½¿ç”¨.dockerignoreæå‡æ„å»ºé€Ÿåº¦
# .dockerignoreå†…å®¹ï¼š
node_modules
npm-debug.log
.git
.gitignore
README.md
Dockerfile
.dockerignore

# 2. å¤šé˜¶æ®µæ„å»ºç¼“å­˜ä¾èµ–
FROM node:16-alpine as deps
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM node:16-alpine as dev
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
```

**ğŸ”§ è°ƒè¯•é…ç½®æŠ€å·§**
```yaml
# VS Codeè°ƒè¯•é…ç½® (.vscode/launch.json)
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Docker Node.js",
            "type": "node",
            "request": "attach",
            "address": "localhost",
            "port": 9229,
            "localRoot": "${workspaceFolder}/backend/src",
            "remoteRoot": "/app/src",
            "restart": true
        }
    ]
}
```

---

## 8. ğŸ“ˆ æ‰©ç¼©å®¹æ“ä½œå®è·µ


### 8.1 æ‰©ç¼©å®¹æ¦‚å¿µç†è§£


**ğŸ’¡ ä»€ä¹ˆæ˜¯æ‰©ç¼©å®¹**
```
æ‰©å®¹ (Scale Up/Out)ï¼š
â€¢ å‚ç›´æ‰©å®¹ï¼šå¢åŠ å•ä¸ªå®¹å™¨çš„èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰
â€¢ æ°´å¹³æ‰©å®¹ï¼šå¢åŠ æ›´å¤šçš„å®¹å™¨å®ä¾‹

ç¼©å®¹ (Scale Down/In)ï¼š
â€¢ å‚ç›´ç¼©å®¹ï¼šå‡å°‘å•ä¸ªå®¹å™¨çš„èµ„æº
â€¢ æ°´å¹³ç¼©å®¹ï¼šå‡å°‘å®¹å™¨å®ä¾‹æ•°é‡

ç”Ÿæ´»ç±»æ¯”ï¼š
é¤å…å¿™çš„æ—¶å€™å¢åŠ æœåŠ¡å‘˜ = æ°´å¹³æ‰©å®¹
ç»™æœåŠ¡å‘˜æä¾›æ›´å¥½çš„è®¾å¤‡ = å‚ç›´æ‰©å®¹
```

**ğŸ¯ ä»€ä¹ˆæ—¶å€™éœ€è¦æ‰©ç¼©å®¹**
```
éœ€è¦æ‰©å®¹çš„æƒ…å†µï¼š
â€¢ CPUä½¿ç”¨ç‡æŒç»­è¶…è¿‡70%
â€¢ å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%
â€¢ å“åº”æ—¶é—´å˜é•¿
â€¢ ç”¨æˆ·è®¿é—®é‡çªå¢

éœ€è¦ç¼©å®¹çš„æƒ…å†µï¼š
â€¢ èµ„æºä½¿ç”¨ç‡é•¿æœŸåä½
â€¢ æ·±å¤œæˆ–èŠ‚å‡æ—¥è®¿é—®é‡ä¸‹é™
â€¢ æˆæœ¬æ§åˆ¶éœ€è¦
```

### 8.2 Docker Composeæ‰‹åŠ¨æ‰©ç¼©å®¹


**ğŸ“Š åŸºç¡€æ‰©ç¼©å®¹æ“ä½œ**
```bash
# æŸ¥çœ‹å½“å‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æ‰©å®¹ï¼šå¯åŠ¨3ä¸ªwebæœåŠ¡å®ä¾‹
docker-compose up --scale web=3 -d

# æ‰©å®¹ï¼šå¯åŠ¨5ä¸ªapiæœåŠ¡å®ä¾‹
docker-compose up --scale api=5 -d

# ç¼©å®¹ï¼šå‡å°‘åˆ°1ä¸ªwebæœåŠ¡å®ä¾‹
docker-compose up --scale web=1 -d

# æŸ¥çœ‹æ‰©å®¹åçš„çŠ¶æ€
docker-compose ps
```

**ğŸ“„ æ”¯æŒæ‰©ç¼©å®¹çš„Composeé…ç½®**
```yaml
version: '3.8'

services:
  # è´Ÿè½½å‡è¡¡å™¨
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - web
    networks:
      - app_network

  # Webåº”ç”¨ï¼ˆå¯æ‰©å®¹ï¼‰
  web:
    build: .
    # æ³¨æ„ï¼šä¸è¦æŒ‡å®šcontainer_nameï¼Œå¦åˆ™æ— æ³•æ‰©å®¹
    # container_name: web_app  # âŒ æ‰©å®¹æ—¶ä¼šå†²çª
    environment:
      - NODE_ENV=production
      - DB_HOST=postgres
    depends_on:
      - postgres
    networks:
      - app_network
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

  # æ•°æ®åº“ï¼ˆé€šå¸¸ä¸æ‰©å®¹ï¼‰
  postgres:
    image: postgres:13
    container_name: app_postgres
    environment:
      POSTGRES_DB: appdb
      POSTGRES_USER: appuser
      POSTGRES_PASSWORD: apppass
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - app_network

volumes:
  postgres_data:

networks:
  app_network:
    driver: bridge
```

### 8.3 è´Ÿè½½å‡è¡¡é…ç½®


**ğŸŒ Nginxè´Ÿè½½å‡è¡¡é…ç½®**
```nginx
# ./nginx/nginx.conf
upstream web_backend {
    # Docker Composeä¼šè‡ªåŠ¨å‘ç°æ‰€æœ‰webæœåŠ¡å®ä¾‹
    server web:3000;
    # å¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼ŒDockerä¼šè‡ªåŠ¨è´Ÿè½½å‡è¡¡
}

server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://web_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # å¥åº·æ£€æŸ¥
        proxy_next_upstream error timeout invalid_header http_500;
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }

    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

### 8.4 è‡ªåŠ¨æ‰©ç¼©å®¹å®ç°


**ğŸ“„ åŸºäºèµ„æºç›‘æ§çš„æ‰©ç¼©å®¹è„šæœ¬**
```bash
#!/bin/bash
# ./scripts/auto-scale.sh

SERVICE_NAME="web"
MIN_REPLICAS=1
MAX_REPLICAS=10
CPU_THRESHOLD=70
MEMORY_THRESHOLD=80

# è·å–å½“å‰å‰¯æœ¬æ•°
get_current_replicas() {
    docker-compose ps -q $SERVICE_NAME | wc -l
}

# è·å–å¹³å‡CPUä½¿ç”¨ç‡
get_avg_cpu() {
    docker stats --no-stream --format "{{.CPUPerc}}" $(docker-compose ps -q $SERVICE_NAME) | \
    sed 's/%//g' | \
    awk '{sum+=$1; count++} END {if(count>0) print sum/count; else print 0}'
}

# è·å–å¹³å‡å†…å­˜ä½¿ç”¨ç‡  
get_avg_memory() {
    docker stats --no-stream --format "{{.MemPerc}}" $(docker-compose ps -q $SERVICE_NAME) | \
    sed 's/%//g' | \
    awk '{sum+=$1; count++} END {if(count>0) print sum/count; else print 0}'
}

# æ‰©ç¼©å®¹é€»è¾‘
auto_scale() {
    current_replicas=$(get_current_replicas)
    avg_cpu=$(get_avg_cpu)
    avg_memory=$(get_avg_memory)
    
    echo "å½“å‰å‰¯æœ¬æ•°: $current_replicas"
    echo "å¹³å‡CPUä½¿ç”¨ç‡: ${avg_cpu}%"
    echo "å¹³å‡å†…å­˜ä½¿ç”¨ç‡: ${avg_memory}%"
    
    # åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
    if (( $(echo "$avg_cpu > $CPU_THRESHOLD" | bc -l) )) || \
       (( $(echo "$avg_memory > $MEMORY_THRESHOLD" | bc -l) )); then
        if [ $current_replicas -lt $MAX_REPLICAS ]; then
            new_replicas=$((current_replicas + 1))
            echo "ğŸš€ è§¦å‘æ‰©å®¹ï¼š$current_replicas -> $new_replicas"
            docker-compose up --scale $SERVICE_NAME=$new_replicas -d
        else
            echo "âš ï¸  å·²è¾¾åˆ°æœ€å¤§å‰¯æœ¬æ•°é™åˆ¶"
        fi
    # åˆ¤æ–­æ˜¯å¦éœ€è¦ç¼©å®¹    
    elif (( $(echo "$avg_cpu < 30" | bc -l) )) && \
         (( $(echo "$avg_memory < 40" | bc -l) )); then
        if [ $current_replicas -gt $MIN_REPLICAS ]; then
            new_replicas=$((current_replicas - 1))
            echo "ğŸ“‰ è§¦å‘ç¼©å®¹ï¼š$current_replicas -> $new_replicas"
            docker-compose up --scale $SERVICE_NAME=$new_replicas -d
        else
            echo "âš ï¸  å·²è¾¾åˆ°æœ€å°å‰¯æœ¬æ•°é™åˆ¶"
        fi
    else
        echo "âœ… èµ„æºä½¿ç”¨æ­£å¸¸ï¼Œæ— éœ€è°ƒæ•´"
    fi
}

# æŒç»­ç›‘æ§
while true; do
    echo "=== $(date) ==="
    auto_scale
    echo ""
    sleep 60  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
done
```

### 8.5 æ‰©ç¼©å®¹ç›‘æ§ä¸å‘Šè­¦


**ğŸ“Š ç›‘æ§é…ç½®**
```yaml
version: '3.8'

services:
  # åº”ç”¨æœåŠ¡
  web:
    build: .
    networks:
      - app_network
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

  # Prometheusç›‘æ§
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
    networks:
      - app_network

  # Grafanaå›¾è¡¨
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - app_network

  # cAdvisorå®¹å™¨ç›‘æ§
  cadvisor:
    image: gcr.io/cadvisor/cadvisor
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    networks:
      - app_network

volumes:
  grafana_data:

networks:
  app_network:
```

**âš™ï¸ Prometheusé…ç½®**
```yaml
# ./monitoring/prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'docker-containers'
    static_configs:
      - targets: ['cadvisor:8080']
  
  - job_name: 'application'
    static_configs:
      - targets: ['web:3000']
```

**ğŸš¨ æ‰©ç¼©å®¹å‘Šè­¦è§„åˆ™**
```yaml
# ./monitoring/alert-rules.yml
groups:
- name: scaling_alerts
  rules:
  - alert: HighCPUUsage
    expr: rate(container_cpu_usage_seconds_total[5m]) * 100 > 80
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "å®¹å™¨CPUä½¿ç”¨ç‡è¿‡é«˜"
      description: "å®¹å™¨CPUä½¿ç”¨ç‡è¶…è¿‡80%æŒç»­2åˆ†é’Ÿ"
      
  - alert: HighMemoryUsage
    expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 85
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "å®¹å™¨å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "å®¹å™¨å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%æŒç»­2åˆ†é’Ÿ"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ Docker Composeå®æˆ˜é¡¹ç›®æ ¸å¿ƒç†è§£**
```
ğŸ”¸ å®æˆ˜é¡¹ç›®çš„ä»·å€¼ï¼šä»ç†è®ºå­¦ä¹ åˆ°å®é™…åº”ç”¨çš„æ¡¥æ¢
ğŸ”¸ å¤šå®¹å™¨ç¼–æ’ï¼šç†è§£å®¹å™¨é—´çš„åä½œå’Œä¾èµ–å…³ç³»
ğŸ”¸ æœåŠ¡å‘ç°ï¼šå®¹å™¨å¦‚ä½•é€šè¿‡æœåŠ¡åäº’ç›¸è®¿é—®
ğŸ”¸ æ•°æ®æŒä¹…åŒ–ï¼šå¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢å¤±
ğŸ”¸ ç½‘ç»œéš”ç¦»ï¼šä¸åŒé¡¹ç›®çš„ç½‘ç»œå®‰å…¨éš”ç¦»
ğŸ”¸ æ‰©ç¼©å®¹æœºåˆ¶ï¼šå¦‚ä½•åº”å¯¹æµé‡å˜åŒ–
```

### 9.2 å…³é”®æŠ€èƒ½è¦ç‚¹


**ğŸ”¹ é¡¹ç›®æ­å»ºèƒ½åŠ›**
```
WordPressåšå®¢ï¼š
â€¢ ç†è§£Webåº”ç”¨+æ•°æ®åº“çš„ç»å…¸æ¶æ„
â€¢ æŒæ¡ç¯å¢ƒå˜é‡é…ç½®å’Œå®¹å™¨ä¾èµ–
â€¢ å­¦ä¼šæ•°æ®æŒä¹…åŒ–å’Œå¤‡ä»½æ¢å¤

LEMPç¯å¢ƒï¼š
â€¢ æŒæ¡Nginx+PHP+MySQLçš„åä½œåŸç†  
â€¢ å­¦ä¼šåå‘ä»£ç†å’ŒFastCGIé…ç½®
â€¢ ç†è§£é™æ€æ–‡ä»¶æœåŠ¡å’ŒåŠ¨æ€è„šæœ¬å¤„ç†

å¾®æœåŠ¡æ¶æ„ï¼š
â€¢ ç†è§£æœåŠ¡æ‹†åˆ†å’ŒAPIç½‘å…³æ¦‚å¿µ
â€¢ æŒæ¡æœåŠ¡é—´é€šä¿¡å’Œè´Ÿè½½å‡è¡¡
â€¢ å­¦ä¼šå®¹å™¨åŒ–å¾®æœåŠ¡çš„éƒ¨ç½²æ–¹å¼
```

**ğŸ”¹ è¿ç»´å®æ“èƒ½åŠ›**
```
å¼€å‘ç¯å¢ƒæ­å»ºï¼š
â€¢ çƒ­é‡è½½ï¼šä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
â€¢ è°ƒè¯•é…ç½®ï¼šIDEè¿œç¨‹è°ƒè¯•å®¹å™¨åº”ç”¨  
â€¢ æ•°æ®åˆå§‹åŒ–ï¼šå¼€å‘æµ‹è¯•æ•°æ®çš„è‡ªåŠ¨åŒ–

æ‰©ç¼©å®¹æ“ä½œï¼š
â€¢ æ‰‹åŠ¨æ‰©ç¼©å®¹ï¼šæ ¹æ®è´Ÿè½½è°ƒæ•´å®ä¾‹æ•°é‡
â€¢ è´Ÿè½½å‡è¡¡ï¼šå¤šå®ä¾‹çš„æµé‡åˆ†å‘
â€¢ ç›‘æ§å‘Šè­¦ï¼šåŸºäºæŒ‡æ ‡çš„è‡ªåŠ¨åŒ–è¿ç»´
```

### 9.3 æœ€ä½³å®è·µæ€»ç»“


**ğŸ’¡ é…ç½®æ–‡ä»¶æœ€ä½³å®è·µ**
```
ç½‘ç»œè®¾è®¡ï¼š
âœ… ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºç‹¬ç«‹ç½‘ç»œ
âœ… ä½¿ç”¨æœåŠ¡åè¿›è¡Œå®¹å™¨é—´é€šä¿¡
âœ… åˆç†é…ç½®ç«¯å£æ˜ å°„é¿å…å†²çª

æ•°æ®ç®¡ç†ï¼š
âœ… é‡è¦æ•°æ®å¿…é¡»ä½¿ç”¨VolumeæŒä¹…åŒ–
âœ… æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’
âœ… å®šæœŸå¤‡ä»½æ•°æ®å·å†…å®¹

æ€§èƒ½ä¼˜åŒ–ï¼š
âœ… åˆç†è®¾ç½®èµ„æºé™åˆ¶é˜²æ­¢å•å®¹å™¨å ç”¨è¿‡å¤šèµ„æº
âœ… ä½¿ç”¨å¥åº·æ£€æŸ¥ç¡®ä¿æœåŠ¡æ­£å¸¸
âœ… é€šè¿‡depends_onæ§åˆ¶å¯åŠ¨é¡ºåº
```

**ğŸ”§ å¼€å‘è°ƒè¯•æŠ€å·§**
```
é—®é¢˜æ’æŸ¥ï¼š
â€¢ docker-compose logs æŸ¥çœ‹æœåŠ¡æ—¥å¿—
â€¢ docker-compose ps æ£€æŸ¥æœåŠ¡çŠ¶æ€  
â€¢ docker-compose exec è¿›å…¥å®¹å™¨è°ƒè¯•
â€¢ docker network ls æ£€æŸ¥ç½‘ç»œé…ç½®

æ€§èƒ½ç›‘æ§ï¼š
â€¢ docker stats å®æ—¶ç›‘æ§èµ„æºä½¿ç”¨
â€¢ é›†æˆPrometheus+Grafanaç›‘æ§
â€¢ è®¾ç½®åˆé€‚çš„å‘Šè­¦é˜ˆå€¼
â€¢ å®šæœŸåˆ†ææ€§èƒ½ç“¶é¢ˆ
```

### 9.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ é¡¹ç›®åœºæ™¯æ˜ å°„**
```
ä¸ªäººé¡¹ç›®ï¼š
â€¢ æ­å»ºä¸ªäººåšå®¢ï¼šWordPresså®æˆ˜
â€¢ å¼€å‘ç¯å¢ƒï¼šæœ¬åœ°å¼€å‘æœåŠ¡æ ˆ
â€¢ å­¦ä¹ å®éªŒï¼šå„ç§æŠ€æœ¯æ ˆçš„å¿«é€Ÿä½“éªŒ

ä¼ä¸šåº”ç”¨ï¼š
â€¢ å¾®æœåŠ¡æ¶æ„ï¼šæœåŠ¡æ‹†åˆ†å’Œå®¹å™¨åŒ–  
â€¢ å¼€å‘ç¯å¢ƒæ ‡å‡†åŒ–ï¼šå›¢é˜Ÿå¼€å‘ç¯å¢ƒä¸€è‡´æ€§
â€¢ æµ‹è¯•ç¯å¢ƒï¼šå¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒ
â€¢ ç°åº¦å‘å¸ƒï¼šé€šè¿‡æ‰©ç¼©å®¹å®ç°ç°åº¦éƒ¨ç½²
```

**ğŸ’¼ èŒä¸šæŠ€èƒ½æå‡**
```
å¼€å‘æŠ€èƒ½ï¼š
â€¢ å…¨æ ˆå¼€å‘èƒ½åŠ›ï¼šå‰åç«¯+æ•°æ®åº“æ•´å¥—æŠ€èƒ½
â€¢ æœåŠ¡æ¶æ„è®¾è®¡ï¼šå¾®æœåŠ¡æ‹†åˆ†å’Œé€šä¿¡è®¾è®¡
â€¢ æ€§èƒ½ä¼˜åŒ–æ€ç»´ï¼šä»å®¹å™¨è§’åº¦ä¼˜åŒ–åº”ç”¨æ€§èƒ½

è¿ç»´æŠ€èƒ½ï¼š  
â€¢ å®¹å™¨åŒ–éƒ¨ç½²ï¼šç°ä»£åº”ç”¨éƒ¨ç½²çš„æ ‡å‡†æ–¹å¼
â€¢ æœåŠ¡ç›‘æ§ï¼šç”Ÿäº§ç¯å¢ƒç›‘æ§å’Œå‘Šè­¦
â€¢ æ•…éšœå¤„ç†ï¼šå®¹å™¨ç¯å¢ƒçš„é—®é¢˜æ’æŸ¥å’Œè§£å†³
```

### 9.5 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ æ·±å…¥å­¦ä¹ è·¯å¾„**
```
å®¹å™¨ç¼–æ’è¿›é˜¶ï¼š
â€¢ Kubernetesï¼šç”Ÿäº§çº§å®¹å™¨ç¼–æ’å¹³å°
â€¢ Docker Swarmï¼šDockeråŸç”Ÿé›†ç¾¤ç®¡ç†
â€¢ Helm Chartsï¼šKubernetesåº”ç”¨åŒ…ç®¡ç†

æœåŠ¡ç½‘æ ¼æŠ€æœ¯ï¼š
â€¢ Istioï¼šå¾®æœåŠ¡é€šä¿¡æ²»ç†
â€¢ Linkerdï¼šè½»é‡çº§æœåŠ¡ç½‘æ ¼
â€¢ Consul Connectï¼šæœåŠ¡å‘ç°å’Œé…ç½®

CI/CDé›†æˆï¼š
â€¢ Jenkins + Dockerï¼šæŒç»­é›†æˆéƒ¨ç½²
â€¢ GitLab CIï¼šä»£ç æäº¤è‡ªåŠ¨éƒ¨ç½²
â€¢ GitHub Actionsï¼šè‡ªåŠ¨åŒ–å·¥ä½œæµ

äº‘åŸç”ŸæŠ€æœ¯ï¼š
â€¢ Serverlessï¼šå‡½æ•°å³æœåŠ¡
â€¢ Service Meshï¼šæœåŠ¡é—´é€šä¿¡æ²»ç†
â€¢ Observabilityï¼šå¯è§‚æµ‹æ€§ä½“ç³»
```

**ğŸ“š æ¨èå­¦ä¹ èµ„æº**
```
å®˜æ–¹æ–‡æ¡£ï¼š
â€¢ Docker Composeå®˜æ–¹æ–‡æ¡£
â€¢ Docker Hubé•œåƒä»“åº“
â€¢ å„å¼€æºé¡¹ç›®çš„DockeråŒ–æœ€ä½³å®è·µ

å®æˆ˜é¡¹ç›®ï¼š
â€¢ æ­å»ºè‡ªå·±çš„åšå®¢ç³»ç»Ÿ
â€¢ å¼€å‘ä¸€ä¸ªç®€å•çš„å¾®æœåŠ¡åº”ç”¨
â€¢ å®ç°CI/CDè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

ç¤¾åŒºèµ„æºï¼š
â€¢ Dockerå®˜æ–¹ç¤ºä¾‹é¡¹ç›®
â€¢ GitHubä¸Šçš„Awesome Dockeré¡¹ç›®
â€¢ æŠ€æœ¯åšå®¢å’Œè§†é¢‘æ•™ç¨‹
```

### 9.6 å­¦ä¹ å»ºè®®ä¸æ€»ç»“


**ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®**
```
ç¬¬1é˜¶æ®µï¼šåŸºç¡€å®è·µ (1-2å‘¨)
âœ… å®ŒæˆWordPressåšå®¢æ­å»º
âœ… æ­å»ºLEMPå¼€å‘ç¯å¢ƒ
âœ… ç†Ÿç»ƒä½¿ç”¨docker-composeå‘½ä»¤

ç¬¬2é˜¶æ®µï¼šè¿›é˜¶åº”ç”¨ (2-3å‘¨)  
âœ… å®ç°å¾®æœåŠ¡æ¶æ„é¡¹ç›®
âœ… æŒæ¡å‰åç«¯åˆ†ç¦»éƒ¨ç½²
âœ… å­¦ä¼šæ•°æ®åº“é›†ç¾¤é…ç½®

ç¬¬3é˜¶æ®µï¼šç”Ÿäº§å®è·µ (3-4å‘¨)
âœ… ç›‘æ§å’Œæ—¥å¿—æ”¶é›†
âœ… è‡ªåŠ¨åŒ–æ‰©ç¼©å®¹
âœ… æ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœæ’æŸ¥

ç¬¬4é˜¶æ®µï¼šæŠ€æœ¯æ‹“å±• (æŒç»­)
âœ… å­¦ä¹ Kubernetes
âœ… äº‘åŸç”ŸæŠ€æœ¯æ ˆ
âœ… DevOpså·¥å…·é“¾é›†æˆ
```

**ğŸ¯ æ ¸å¿ƒèƒ½åŠ›æ£€éªŒ**
```
æŠ€èƒ½è‡ªæ£€æ¸…å•ï¼š
â–¡ èƒ½ç‹¬ç«‹æ­å»ºWordPressåšå®¢ç³»ç»Ÿ
â–¡ èƒ½é…ç½®LEMP/LAMPå¼€å‘ç¯å¢ƒ
â–¡ ç†è§£å¾®æœåŠ¡æ¶æ„å’ŒAPIç½‘å…³
â–¡ æŒæ¡å‰åç«¯åˆ†ç¦»éƒ¨ç½²æ–¹å¼
â–¡ èƒ½é…ç½®æ•°æ®åº“ä¸»ä»å¤åˆ¶
â–¡ èƒ½æ­å»ºå®Œæ•´çš„å¼€å‘ç¯å¢ƒ
â–¡ æŒæ¡æ‰‹åŠ¨å’Œè‡ªåŠ¨æ‰©ç¼©å®¹
â–¡ èƒ½æ’æŸ¥å¸¸è§çš„å®¹å™¨é—®é¢˜
â–¡ ç†è§£Dockerç½‘ç»œå’Œæ•°æ®å·
â–¡ èƒ½ç¼–å†™è´¨é‡è¾ƒé«˜çš„Composeæ–‡ä»¶
```

**ğŸ’¡ å…³é”®è®°å¿†è¦ç‚¹**
```
Docker Composeå®æˆ˜é¡¹ç›® = ç†è®º + å®è·µçš„å®Œç¾ç»“åˆ

æ ¸å¿ƒä»·å€¼ï¼š
â€¢ çœŸå®é¡¹ç›®ç»éªŒï¼šä¸æ˜¯çº¸ä¸Šè°ˆå…µ
â€¢ é—®é¢˜è§£å†³èƒ½åŠ›ï¼šé‡åˆ°é—®é¢˜çŸ¥é“æ€ä¹ˆå¤„ç†  
â€¢ æ¶æ„è®¾è®¡æ€ç»´ï¼šç†è§£æœåŠ¡å¦‚ä½•åä½œ
â€¢ è¿ç»´å®æ“æŠ€èƒ½ï¼šéƒ¨ç½²ã€ç›‘æ§ã€æ‰©å±•

æˆåŠŸæ ‡å‡†ï¼š
â€¢ èƒ½å¿«é€Ÿæ­å»ºå¸¸è§åº”ç”¨æ¶æ„
â€¢ èƒ½è§£å†³å®¹å™¨åŒ–è¿‡ç¨‹ä¸­çš„å„ç§é—®é¢˜
â€¢ å…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„åŸºæœ¬èƒ½åŠ›
â€¢ ä¸ºå­¦ä¹ Kubernetesç­‰é«˜çº§æŠ€æœ¯æ‰“å¥½åŸºç¡€
```

**ğŸ”‘ æœ€ç»ˆæ€»ç»“**
Docker Composeå®æˆ˜é¡¹ç›®æ˜¯ä»å®¹å™¨å…¥é—¨åˆ°å®é™…åº”ç”¨çš„å…³é”®ä¸€æ­¥ã€‚é€šè¿‡WordPressã€LEMPã€å¾®æœåŠ¡ç­‰å®é™…é¡¹ç›®ï¼Œä½ ä¸ä»…å­¦ä¼šäº†æŠ€æœ¯çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ›´é‡è¦çš„æ˜¯åŸ¹å…»äº†è§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ã€‚

è®°ä½ï¼š**å®æˆ˜é¡¹ç›®ä¸æ˜¯ç›®çš„ï¼Œè€Œæ˜¯æ‰‹æ®µ**ã€‚é€šè¿‡è¿™äº›é¡¹ç›®ï¼Œä½ è·å¾—çš„æ˜¯ï¼š
- **ç³»ç»Ÿæ€ç»´**ï¼šå¦‚ä½•è®¾è®¡å’Œéƒ¨ç½²å®Œæ•´çš„åº”ç”¨ç³»ç»Ÿ
- **é—®é¢˜è§£å†³**ï¼šå½“å‡ºç°é—®é¢˜æ—¶çŸ¥é“ä»å“ªé‡Œå…¥æ‰‹æ’æŸ¥
- **æœ€ä½³å®è·µ**ï¼šå­¦åˆ°ä¸šç•Œæˆç†Ÿçš„é…ç½®å’Œéƒ¨ç½²æ¨¡å¼
- **æŠ€æœ¯è‡ªä¿¡**ï¼šæœ‰ä¿¡å¿ƒé¢å¯¹æ›´å¤æ‚çš„å®¹å™¨åŒ–æŒ‘æˆ˜

ç°åœ¨ä½ å·²ç»å…·å¤‡äº†æ‰å®çš„Docker Composeå®æˆ˜èƒ½åŠ›ï¼Œå¯ä»¥å¼€å§‹å‘Kubernetesç­‰æ›´é«˜çº§çš„å®¹å™¨ç¼–æ’æŠ€æœ¯è¿›å‘äº†ï¼