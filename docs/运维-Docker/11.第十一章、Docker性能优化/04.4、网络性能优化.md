---
title: 4ã€ç½‘ç»œæ€§èƒ½ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [Dockerç½‘ç»œæ€§èƒ½åŸºç¡€](#1-Dockerç½‘ç»œæ€§èƒ½åŸºç¡€)
2. [ç½‘ç»œé©±åŠ¨æ€§èƒ½ä¼˜åŒ–](#2-ç½‘ç»œé©±åŠ¨æ€§èƒ½ä¼˜åŒ–)
3. [å¸¦å®½ä¸æµé‡æ§åˆ¶](#3-å¸¦å®½ä¸æµé‡æ§åˆ¶)
4. [ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥](#4-ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥)
5. [DNSè§£ææ€§èƒ½ä¼˜åŒ–](#5-DNSè§£ææ€§èƒ½ä¼˜åŒ–)
6. [è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨](#6-è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨)
7. [ç½‘ç»œæ‹“æ‰‘ä¼˜åŒ–è®¾è®¡](#7-ç½‘ç»œæ‹“æ‰‘ä¼˜åŒ–è®¾è®¡)
8. [æ€§èƒ½ç›‘æ§ä¸æ•…éšœæ’æŸ¥](#8-æ€§èƒ½ç›‘æ§ä¸æ•…éšœæ’æŸ¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Dockerç½‘ç»œæ€§èƒ½åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Dockerç½‘ç»œæ€§èƒ½ä¼˜åŒ–


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
Dockerç½‘ç»œæ€§èƒ½ä¼˜åŒ–å°±æ˜¯è®©å®¹å™¨ä¹‹é—´ã€å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œä¹‹é—´çš„æ•°æ®ä¼ è¾“æ›´å¿«ã€æ›´ç¨³å®šã€‚å°±åƒä¼˜åŒ–é«˜é€Ÿå…¬è·¯ä¸€æ ·ï¼Œæˆ‘ä»¬è¦è®©æ•°æ®è¿™äº›"è½¦è¾†"è·‘å¾—æ›´é¡ºç•…ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œä¼˜åŒ–**
```
é—®é¢˜åœºæ™¯ä¸¾ä¾‹ï¼š
ğŸ”¹ å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ç¼“æ…¢ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿
ğŸ”¹ æ•°æ®åº“è¿æ¥é¢‘ç¹è¶…æ—¶ï¼Œå½±å“ä¸šåŠ¡ç¨³å®šæ€§
ğŸ”¹ æ–‡ä»¶ä¼ è¾“é€Ÿåº¦æ…¢ï¼Œå¤‡ä»½ä»»åŠ¡æ‹–å»¶æ•´ä½“è¿›åº¦
ğŸ”¹ è´Ÿè½½å‡è¡¡ä¸å‡åŒ€ï¼Œéƒ¨åˆ†å®¹å™¨å‹åŠ›è¿‡å¤§
```

### 1.2 Dockerç½‘ç»œæ¶æ„ç†è§£


**ğŸ—ï¸ ç½‘ç»œå±‚æ¬¡ç»“æ„**
```
åº”ç”¨å±‚
    â†“
å®¹å™¨ç½‘ç»œæ¥å£ (veth pair)
    â†“  
Dockerç½‘ç»œé©±åŠ¨ (bridge/host/overlayç­‰)
    â†“
å®¿ä¸»æœºç½‘ç»œæ ˆ (iptables/è·¯ç”±è¡¨)
    â†“
ç‰©ç†ç½‘ç»œæ¥å£
```

**ğŸ” æ€§èƒ½å½±å“å› ç´ **
```
ç½‘ç»œé©±åŠ¨é€‰æ‹©ï¼šbridge vs host vs overlay
å®¹å™¨ç½‘ç»œé…ç½®ï¼šMTUå¤§å°ã€ç½‘ç»œå‘½åç©ºé—´
å®¿ä¸»æœºç½‘ç»œï¼šå¸¦å®½ã€å»¶è¿Ÿã€ä¸¢åŒ…ç‡
åº”ç”¨å±‚ä¼˜åŒ–ï¼šè¿æ¥å¤ç”¨ã€ç¼“å­˜ç­–ç•¥
```

### 1.3 æ€§èƒ½åŸºå‡†æµ‹è¯•


**ğŸ“Š æµ‹è¯•ç½‘ç»œæ€§èƒ½çš„åŸºæœ¬æ–¹æ³•**
```bash
# æµ‹è¯•å®¹å™¨é—´ç½‘ç»œå¸¦å®½
docker run --rm -it --name test1 alpine sleep 3600
docker run --rm -it --name test2 alpine sleep 3600

# åœ¨test1ä¸­å®‰è£…iperf3å¹¶å¯åŠ¨æœåŠ¡ç«¯
docker exec test1 apk add iperf3
docker exec -d test1 iperf3 -s

# åœ¨test2ä¸­æµ‹è¯•è¿æ¥é€Ÿåº¦
docker exec test2 apk add iperf3
docker exec test2 iperf3 -c test1_ip
```

---

## 2. âš¡ ç½‘ç»œé©±åŠ¨æ€§èƒ½ä¼˜åŒ–


### 2.1 ç½‘ç»œé©±åŠ¨ç±»å‹è¯¦è§£


**ğŸ”¸ Bridgeç½‘ç»œé©±åŠ¨**
Bridgeé©±åŠ¨å°±åƒä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œäº¤æ¢æœºï¼Œæ‰€æœ‰è¿æ¥åˆ°å®ƒçš„å®¹å™¨éƒ½èƒ½äº’ç›¸é€šä¿¡ã€‚

```
ä¼˜åŠ¿ï¼šå®¹å™¨é—´éš”ç¦»æ€§å¥½ï¼Œå®‰å…¨æ€§é«˜
åŠ£åŠ¿ï¼šå¤šä¸€å±‚ç½‘ç»œè½¬æ¢ï¼Œæ€§èƒ½æœ‰æŸè€—
é€‚ç”¨ï¼šå¼€å‘ç¯å¢ƒã€å°è§„æ¨¡éƒ¨ç½²

æ€§èƒ½ç‰¹ç‚¹ï¼š
âœ… å®‰å…¨éš”ç¦»
âŒ ç½‘ç»œæ€§èƒ½æŸè€—çº¦10-15%
âŒ ä¸é€‚åˆé«˜æ€§èƒ½åœºæ™¯
```

**ğŸ”¸ Hostç½‘ç»œé©±åŠ¨**
Hostç½‘ç»œè®©å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œï¼Œå°±åƒå®¹å™¨æ˜¯å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªæ™®é€šè¿›ç¨‹ã€‚

```
ä¼˜åŠ¿ï¼šç½‘ç»œæ€§èƒ½æœ€ä½³ï¼Œé›¶æ€§èƒ½æŸè€—
åŠ£åŠ¿ï¼šå®¹å™¨é—´ç½‘ç»œéš”ç¦»æ€§å·®ï¼Œç«¯å£å†²çªé£é™©
é€‚ç”¨ï¼šé«˜æ€§èƒ½ç½‘ç»œåº”ç”¨ã€ç›‘æ§ç³»ç»Ÿ

æ€§èƒ½ç‰¹ç‚¹ï¼š
âœ… ç½‘ç»œæ€§èƒ½æ¥è¿‘åŸç”Ÿ
âœ… å»¶è¿Ÿæœ€ä½
âŒ å®‰å…¨æ€§é™ä½
```

### 2.2 ç½‘ç»œé©±åŠ¨é€‰æ‹©ç­–ç•¥


**ğŸ¯ åœºæ™¯åŒ–é€‰æ‹©æŒ‡å—**
```
é«˜æ€§èƒ½æ•°æ®åº“ï¼š
â†’ ä½¿ç”¨hostç½‘ç»œ
â†’ é…ç½®ç¤ºä¾‹ï¼šdocker run --network host mysql

Webåº”ç”¨é›†ç¾¤ï¼š
â†’ ä½¿ç”¨overlayç½‘ç»œï¼ˆè·¨ä¸»æœºï¼‰
â†’ é…ç½®ç¤ºä¾‹ï¼šdocker network create -d overlay web-net

å¼€å‘æµ‹è¯•ç¯å¢ƒï¼š
â†’ ä½¿ç”¨bridgeç½‘ç»œ
â†’ é…ç½®ç¤ºä¾‹ï¼šdocker network create dev-net
```

### 2.3 è‡ªå®šä¹‰ç½‘ç»œä¼˜åŒ–é…ç½®


**ğŸ”§ åˆ›å»ºé«˜æ€§èƒ½ç½‘ç»œ**
```bash
# åˆ›å»ºä¼˜åŒ–çš„æ¡¥æ¥ç½‘ç»œ
docker network create \
  --driver bridge \
  --opt com.docker.network.bridge.name=opt-bridge \
  --opt com.docker.network.driver.mtu=1500 \
  --opt com.docker.network.bridge.enable_ip_masquerade=true \
  optimized-net

# éªŒè¯ç½‘ç»œé…ç½®
docker network inspect optimized-net
```

**âš™ï¸ MTUä¼˜åŒ–é…ç½®**
MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰å°±åƒå¿«é€’åŒ…è£¹çš„å¤§å°é™åˆ¶ï¼Œåˆé€‚çš„å¤§å°èƒ½æé«˜ä¼ è¾“æ•ˆç‡ã€‚

```bash
# æ£€æŸ¥å½“å‰MTUè®¾ç½®
ip link show docker0

# è®¾ç½®ä¼˜åŒ–çš„MTUï¼ˆé€šå¸¸1500ä¸ºæœ€ä½³ï¼‰
docker network create \
  --opt com.docker.network.driver.mtu=1500 \
  high-perf-net
```

---

## 3. ğŸ“Š å¸¦å®½ä¸æµé‡æ§åˆ¶


### 3.1 å®¹å™¨å¸¦å®½é™åˆ¶é…ç½®


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¸¦å®½é™åˆ¶**
å¸¦å®½é™åˆ¶å°±åƒç»™æ¯ä¸ªå®¹å™¨åˆ†é…å›ºå®šçš„"ç½‘ç»œè½¦é“"ï¼Œé˜²æ­¢æŸä¸ªå®¹å™¨å ç”¨å¤ªå¤šç½‘ç»œèµ„æºå½±å“å…¶ä»–å®¹å™¨ã€‚

**âš–ï¸ å¸¦å®½é™åˆ¶å®ç°**
```bash
# é™åˆ¶å®¹å™¨ä¸Šä¼ å¸¦å®½ä¸º1Mbps
docker run -d --name web-server \
  --device-write-bps /dev/eth0:1mb \
  nginx

# é™åˆ¶å®¹å™¨ä¸‹è½½å¸¦å®½ä¸º10Mbps  
docker run -d --name app-server \
  --device-read-bps /dev/eth0:10mb \
  myapp:latest
```

### 3.2 æµé‡æ•´å½¢ä¸ä¼˜å…ˆçº§


**ğŸ¯ æµé‡ä¼˜å…ˆçº§é…ç½®**
```bash
# ä½¿ç”¨tcå‘½ä»¤è¿›è¡Œé«˜çº§æµé‡æ§åˆ¶
# åœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œï¼Œå¯¹å®¹å™¨ç½‘ç»œæ¥å£è¿›è¡Œé…ç½®

# æŸ¥æ‰¾å®¹å™¨çš„ç½‘ç»œæ¥å£
docker exec container_name cat /sys/class/net/eth0/iflink
ip link | grep "^æ¥å£ç¼–å·:"

# è®¾ç½®æµé‡ä¼˜å…ˆçº§ï¼ˆéœ€è¦rootæƒé™ï¼‰
tc qdisc add dev vethæ¥å£ root handle 1: htb default 30
tc class add dev vethæ¥å£ parent 1: classid 1:1 htb rate 100mbit
tc class add dev vethæ¥å£ parent 1:1 classid 1:10 htb rate 80mbit ceil 100mbit
tc class add dev vethæ¥å£ parent 1:1 classid 1:20 htb rate 20mbit ceil 100mbit
```

### 3.3 ç½‘ç»œèµ„æºç›‘æ§


**ğŸ“ˆ å®æ—¶å¸¦å®½ç›‘æ§**
```bash
# ç›‘æ§å®¹å™¨ç½‘ç»œä½¿ç”¨æƒ…å†µ
docker stats --format "table {{.Container}}\t{{.NetIO}}" --no-stream

# è¯¦ç»†ç½‘ç»œç›‘æ§
docker exec container_name iftop -i eth0
```

---

## 4. â±ï¸ ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥


### 4.1 å»¶è¿Ÿäº§ç”ŸåŸå› åˆ†æ


**ğŸ” å»¶è¿Ÿæ¥æºè§£æ**
```
ç½‘ç»œå»¶è¿Ÿçš„ä¸»è¦æ¥æºï¼š

ç‰©ç†å±‚å»¶è¿Ÿï¼š
- ç½‘ç»œè®¾å¤‡å¤„ç†æ—¶é—´
- ä¼ è¾“è·ç¦»äº§ç”Ÿçš„ä¿¡å·å»¶è¿Ÿ

è™šæ‹ŸåŒ–å»¶è¿Ÿï¼š
- Dockerç½‘ç»œæ ˆå¤„ç†æ—¶é—´
- å®¹å™¨é—´é€šä¿¡çš„é¢å¤–è·³è½¬

åº”ç”¨å±‚å»¶è¿Ÿï¼š
- åº”ç”¨ç¨‹åºå¤„ç†æ—¶é—´
- è¿æ¥å»ºç«‹å’Œè®¤è¯æ—¶é—´
```

### 4.2 å®¹å™¨æ”¾ç½®ç­–ç•¥ä¼˜åŒ–


**ğŸ  äº²å’Œæ€§é…ç½®**
å°†ç›¸äº’é¢‘ç¹é€šä¿¡çš„å®¹å™¨æ”¾åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šï¼Œå°±åƒæŠŠç»å¸¸åˆä½œçš„åŒäº‹å®‰æ’åœ¨ç›¸é‚»çš„åŠå…¬æ¡Œã€‚

```bash
# ä½¿ç”¨ä¸»æœºäº²å’Œæ€§æ ‡ç­¾
docker node update --label-add zone=web-tier node1
docker node update --label-add zone=db-tier node2

# åˆ›å»ºæœåŠ¡æ—¶æŒ‡å®šèŠ‚ç‚¹çº¦æŸ
docker service create \
  --name web-app \
  --constraint 'node.labels.zone == web-tier' \
  nginx

docker service create \
  --name database \
  --constraint 'node.labels.zone == db-tier' \
  mysql
```

### 4.3 è¿æ¥æ± ä¼˜åŒ–


**ğŸŠ è¿æ¥å¤ç”¨ç­–ç•¥**
è¿æ¥æ± å°±åƒå…¬å…±äº¤é€šç³»ç»Ÿï¼Œå¤šä¸ªè¯·æ±‚å…±äº«åŒä¸€æ¡è¿æ¥ï¼Œå‡å°‘é‡å¤å»ºç«‹è¿æ¥çš„æ—¶é—´ã€‚

```bash
# æ•°æ®åº“è¿æ¥æ± é…ç½®ç¤ºä¾‹
docker run -d \
  -e DB_POOL_SIZE=20 \
  -e DB_POOL_MAX_OVERFLOW=10 \
  -e DB_POOL_TIMEOUT=30 \
  myapp:latest
```

---

## 5. ğŸŒ DNSè§£ææ€§èƒ½ä¼˜åŒ–


### 5.1 DNSè§£æé—®é¢˜åˆ†æ


**ğŸ”¸ DNSè§£æå»¶è¿Ÿçš„å½±å“**
DNSè§£æå°±åƒæŸ¥ç”µè¯ç°¿æ‰¾ç”µè¯å·ç ï¼Œå¦‚æœç”µè¯ç°¿æŸ¥æ‰¾å¤ªæ…¢ï¼Œæ•´ä¸ªé€šè¯è¿‡ç¨‹éƒ½ä¼šè¢«æ‹–æ…¢ã€‚

**âš ï¸ å¸¸è§DNSæ€§èƒ½é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
- å®¹å™¨å¯åŠ¨æ…¢ï¼ŒæœåŠ¡å‘ç°è€—æ—¶é•¿
- å¾®æœåŠ¡é—´è°ƒç”¨å¶å‘è¶…æ—¶
- å¤–éƒ¨APIè°ƒç”¨ä¸ç¨³å®š

æ ¹æœ¬åŸå› ï¼š
- é»˜è®¤DNSæœåŠ¡å™¨å“åº”æ…¢
- DNSç¼“å­˜é…ç½®ä¸å½“
- DNSæŸ¥è¯¢é“¾è·¯è¿‡é•¿
```

### 5.2 DNSæœåŠ¡å™¨ä¼˜åŒ–


**âš¡ è‡ªå®šä¹‰DNSé…ç½®**
```bash
# ä½¿ç”¨é«˜æ€§èƒ½DNSæœåŠ¡å™¨
docker run -d \
  --dns=8.8.8.8 \
  --dns=1.1.1.1 \
  --dns-search=company.local \
  myapp:latest

# åœ¨docker-composeä¸­é…ç½®DNS
version: '3.8'
services:
  app:
    image: myapp:latest
    dns:
      - 8.8.8.8
      - 1.1.1.1
    dns_search:
      - company.local
```

### 5.3 DNSç¼“å­˜ä¼˜åŒ–


**ğŸ’¾ æœ¬åœ°DNSç¼“å­˜**
```bash
# å¯åŠ¨æœ¬åœ°DNSç¼“å­˜æœåŠ¡
docker run -d \
  --name dns-cache \
  --restart unless-stopped \
  -p 53:53/udp \
  andyshinn/dnsmasq:2.85 \
  --cache-size=1000 \
  --neg-ttl=60 \
  --server=8.8.8.8

# é…ç½®å…¶ä»–å®¹å™¨ä½¿ç”¨æœ¬åœ°DNSç¼“å­˜
docker run -d \
  --dns=å®¿ä¸»æœºIP \
  myapp:latest
```

---

## 6. âš–ï¸ è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨


### 6.1 å®¹å™¨çº§è´Ÿè½½å‡è¡¡


**ğŸ”¸ ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡**
è´Ÿè½½å‡è¡¡å°±åƒäº¤é€šæŒ‡æŒ¥å‘˜ï¼Œå°†æ¥è®¿çš„ç”¨æˆ·è¯·æ±‚åˆç†åˆ†é…ç»™ä¸åŒçš„æœåŠ¡å™¨å®¹å™¨ï¼Œé¿å…æŸå°æœåŠ¡å™¨è¿‡å¿™è€Œå…¶ä»–æœåŠ¡å™¨ç©ºé—²ã€‚

**ğŸŒŠ Dockerå†…ç½®è´Ÿè½½å‡è¡¡**
```bash
# åˆ›å»ºæœåŠ¡å¹¶è®¾ç½®å‰¯æœ¬æ•°
docker service create \
  --name web-service \
  --replicas 3 \
  --publish 80:80 \
  nginx

# Dockerè‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡åˆ†å‘è¯·æ±‚åˆ°3ä¸ªå®¹å™¨
```

### 6.2 å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨é›†æˆ


**ğŸ”§ Nginxè´Ÿè½½å‡è¡¡é…ç½®**
```bash
# åˆ›å»ºNginxè´Ÿè½½å‡è¡¡å™¨å®¹å™¨
docker run -d \
  --name nginx-lb \
  -p 80:80 \
  -v $(pwd)/nginx.conf:/etc/nginx/nginx.conf:ro \
  nginx

# nginx.confé…ç½®ç¤ºä¾‹
upstream backend {
    server container1:8080 weight=3;
    server container2:8080 weight=2;  
    server container3:8080 weight=1;
    
    # å¥åº·æ£€æŸ¥
    keepalive 32;
}

server {
    listen 80;
    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
    }
}
```

### 6.3 å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤


**ğŸ’Š å¥åº·æ£€æŸ¥é…ç½®**
```bash
# é…ç½®å®¹å™¨å¥åº·æ£€æŸ¥
docker run -d \
  --name web-app \
  --health-cmd="curl -f http://localhost:8080/health || exit 1" \
  --health-interval=30s \
  --health-timeout=10s \
  --health-retries=3 \
  myapp:latest

# æŸ¥çœ‹å¥åº·çŠ¶æ€
docker ps --format "table {{.Names}}\t{{.Status}}"
```

---

## 7. ğŸ—ï¸ ç½‘ç»œæ‹“æ‰‘ä¼˜åŒ–è®¾è®¡


### 7.1 ç½‘ç»œåˆ†å±‚æ¶æ„


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†å±‚**
ç½‘ç»œåˆ†å±‚å°±åƒå»ºç­‘ç‰©çš„æ¥¼å±‚è§„åˆ’ï¼Œä¸åŒçš„æœåŠ¡æ”¾åœ¨ä¸åŒçš„ç½‘ç»œå±‚ï¼Œæ—¢ä¿è¯å®‰å…¨åˆæé«˜æ•ˆç‡ã€‚

**ğŸ¢ ä¸‰å±‚ç½‘ç»œæ¶æ„**
```
å‰ç«¯å±‚ (Web Tier)ï¼š
    â”œâ”€â”€ è´Ÿè½½å‡è¡¡å™¨
    â”œâ”€â”€ WebæœåŠ¡å™¨å®¹å™¨
    â””â”€â”€ é™æ€èµ„æºæœåŠ¡

åº”ç”¨å±‚ (App Tier)ï¼š
    â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å®¹å™¨
    â”œâ”€â”€ APIç½‘å…³
    â””â”€â”€ å¾®æœåŠ¡é›†ç¾¤

æ•°æ®å±‚ (Data Tier)ï¼š
    â”œâ”€â”€ æ•°æ®åº“å®¹å™¨
    â”œâ”€â”€ ç¼“å­˜æœåŠ¡
    â””â”€â”€ æ¶ˆæ¯é˜Ÿåˆ—
```

### 7.2 ç½‘ç»œéš”ç¦»ç­–ç•¥


**ğŸ›¡ï¸ å®‰å…¨ç½‘ç»œéš”ç¦»**
```bash
# åˆ›å»ºåˆ†å±‚ç½‘ç»œ
docker network create --driver bridge frontend-net
docker network create --driver bridge backend-net
docker network create --driver bridge database-net

# Webå±‚å®¹å™¨
docker run -d --name web1 --network frontend-net nginx
docker run -d --name web2 --network frontend-net nginx

# åº”ç”¨å±‚å®¹å™¨ï¼ˆè¿æ¥å‰ç«¯å’Œåç«¯ç½‘ç»œï¼‰
docker run -d --name app1 --network backend-net myapp:latest
docker network connect frontend-net app1

# æ•°æ®å±‚å®¹å™¨
docker run -d --name db1 --network database-net mysql
docker network connect backend-net db1
```

### 7.3 è·¨ä¸»æœºç½‘ç»œä¼˜åŒ–


**ğŸŒ Overlayç½‘ç»œé…ç½®**
Overlayç½‘ç»œå°±åƒåœ¨å¤šä¸ªåŸå¸‚ä¹‹é—´å»ºç«‹çš„é«˜é€Ÿä¸“çº¿ï¼Œè®©åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨ä¸Šçš„å®¹å™¨èƒ½å¤Ÿé«˜æ•ˆé€šä¿¡ã€‚

```bash
# åˆå§‹åŒ–Swarmé›†ç¾¤
docker swarm init --advertise-addr ä¸»æœºIP

# åœ¨å…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤
docker swarm join --token TOKEN ä¸»æœºIP:2377

# åˆ›å»ºoverlayç½‘ç»œ
docker network create \
  --driver overlay \
  --attachable \
  --opt encrypted=true \
  distributed-net
```

---

## 8. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸æ•…éšœæ’æŸ¥


### 8.1 ç½‘ç»œæ€§èƒ½ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**
```
å¸¦å®½åˆ©ç”¨ç‡ï¼š
- å…¥ç«™æµé‡é€Ÿåº¦ (Mbps)
- å‡ºç«™æµé‡é€Ÿåº¦ (Mbps)
- å³°å€¼ä½¿ç”¨æ—¶æ®µåˆ†æ

å»¶è¿ŸæŒ‡æ ‡ï¼š
- å¹³å‡å“åº”æ—¶é—´ (ms)
- 99ç™¾åˆ†ä½å»¶è¿Ÿ
- è¿æ¥å»ºç«‹æ—¶é—´

é”™è¯¯ç‡ç»Ÿè®¡ï¼š
- ä¸¢åŒ…ç‡ (%)
- è¿æ¥è¶…æ—¶æ¬¡æ•°
- DNSè§£æå¤±è´¥ç‡
```

### 8.2 ç›‘æ§å·¥å…·ä½¿ç”¨


**ğŸ”§ å®¹å™¨ç½‘ç»œç›‘æ§**
```bash
# å®æ—¶ç½‘ç»œæµé‡ç›‘æ§
docker run --rm -it \
  --net container:ç›®æ ‡å®¹å™¨å \
  --cap-add NET_ADMIN \
  nicolaka/netshoot iftop

# ç½‘ç»œå»¶è¿Ÿæµ‹è¯•
docker exec å®¹å™¨å ping -c 10 ç›®æ ‡åœ°å€

# ç«¯å£è¿é€šæ€§æµ‹è¯•
docker exec å®¹å™¨å nc -zv ç›®æ ‡ä¸»æœº ç«¯å£
```

### 8.3 å¸¸è§é—®é¢˜æ’æŸ¥


**ğŸ” ç½‘ç»œæ•…éšœè¯Šæ–­æµç¨‹**
```
æ­¥éª¤1ï¼šæ£€æŸ¥å®¹å™¨ç½‘ç»œé…ç½®
docker inspect å®¹å™¨å | grep -i network

æ­¥éª¤2ï¼šéªŒè¯ç½‘ç»œè¿é€šæ€§  
docker exec å®¹å™¨å ping ç›®æ ‡åœ°å€

æ­¥éª¤3ï¼šæ£€æŸ¥DNSè§£æ
docker exec å®¹å™¨å nslookup åŸŸå

æ­¥éª¤4ï¼šåˆ†æç½‘ç»œè·¯å¾„
docker exec å®¹å™¨å traceroute ç›®æ ‡åœ°å€

æ­¥éª¤5ï¼šæŸ¥çœ‹ç½‘ç»œç»Ÿè®¡
docker exec å®¹å™¨å netstat -i
```

**âš ï¸ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|----------|
| `å®¹å™¨é—´æ— æ³•é€šä¿¡` | `ç½‘ç»œéš”ç¦»é…ç½®é”™è¯¯` | `æ£€æŸ¥networké…ç½®ï¼Œç¡®ä¿åœ¨åŒä¸€ç½‘ç»œ` |
| `DNSè§£æå¤±è´¥` | `DNSæœåŠ¡å™¨ä¸å¯è¾¾` | `æ›´æ¢DNSæœåŠ¡å™¨ï¼Œé…ç½®æœ¬åœ°ç¼“å­˜` |
| `è¿æ¥è¶…æ—¶é¢‘ç¹` | `é˜²ç«å¢™è§„åˆ™é˜»æ‹¦` | `æ£€æŸ¥iptablesè§„åˆ™ï¼Œå¼€æ”¾å¿…è¦ç«¯å£` |
| `ç½‘ç»œæ€§èƒ½ä¸‹é™` | `MTUè®¾ç½®ä¸å½“` | `è°ƒæ•´MTUå¤§å°ï¼Œé€šå¸¸è®¾ç½®ä¸º1500` |

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç½‘ç»œé©±åŠ¨é€‰æ‹©ï¼šhostæ€§èƒ½æœ€ä½³ï¼Œbridgeæœ€å®‰å…¨ï¼Œoverlayæ”¯æŒè·¨ä¸»æœº
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–é‡ç‚¹ï¼šMTUé…ç½®ã€DNSä¼˜åŒ–ã€è¿æ¥å¤ç”¨ã€è´Ÿè½½å‡è¡¡
ğŸ”¸ ç›‘æ§å…³é”®æŒ‡æ ‡ï¼šå¸¦å®½åˆ©ç”¨ç‡ã€å»¶è¿Ÿæ—¶é—´ã€é”™è¯¯ç‡ç»Ÿè®¡
ğŸ”¸ æ•…éšœæ’æŸ¥æ€è·¯ï¼šè¿é€šæ€§â†’DNSâ†’è·¯ç”±â†’é˜²ç«å¢™â†’æ€§èƒ½ç“¶é¢ˆ
ğŸ”¸ ç½‘ç»œæ‹“æ‰‘è®¾è®¡ï¼šåˆ†å±‚æ¶æ„ã€å®‰å…¨éš”ç¦»ã€é«˜å¯ç”¨é…ç½®
```

### 9.2 æœ€ä½³å®è·µæŒ‡å¯¼


**ğŸ¯ æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆçº§**
```
é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³è§æ•ˆï¼‰ï¼š
1. é€‰æ‹©åˆé€‚çš„ç½‘ç»œé©±åŠ¨
2. é…ç½®é«˜æ€§èƒ½DNSæœåŠ¡å™¨  
3. è®¾ç½®åˆç†çš„MTUå€¼
4. å¯ç”¨å®¹å™¨å¥åº·æ£€æŸ¥

ä¸­ä¼˜å…ˆçº§ï¼ˆä¸­æœŸè§„åˆ’ï¼‰ï¼š
1. å®æ–½è´Ÿè½½å‡è¡¡ç­–ç•¥
2. ä¼˜åŒ–ç½‘ç»œæ‹“æ‰‘ç»“æ„
3. é…ç½®æµé‡é™åˆ¶å’Œä¼˜å…ˆçº§
4. å»ºç«‹ç›‘æ§å‘Šè­¦ä½“ç³»

ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰ï¼š
1. å®æ–½é«˜çº§æµé‡æ•´å½¢
2. éƒ¨ç½²åˆ†å¸ƒå¼ç½‘ç»œæ¶æ„
3. ä¼˜åŒ–è·¨æ•°æ®ä¸­å¿ƒé€šä¿¡
4. å®ç°æ™ºèƒ½åŒ–æ•…éšœå¤„ç†
```

### 9.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ’¼ ä¼ä¸šçº§éƒ¨ç½²å»ºè®®**
```
å°è§„æ¨¡éƒ¨ç½² (< 10ä¸ªå®¹å™¨)ï¼š
â†’ ä½¿ç”¨bridgeç½‘ç»œï¼Œé…ç½®æœ¬åœ°DNSç¼“å­˜
â†’ é‡ç‚¹å…³æ³¨ï¼šåŸºç¡€é…ç½®æ­£ç¡®æ€§

ä¸­ç­‰è§„æ¨¡éƒ¨ç½² (10-100ä¸ªå®¹å™¨)ï¼š
â†’ ä½¿ç”¨overlayç½‘ç»œï¼Œéƒ¨ç½²è´Ÿè½½å‡è¡¡å™¨
â†’ é‡ç‚¹å…³æ³¨ï¼šæ€§èƒ½ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤

å¤§è§„æ¨¡éƒ¨ç½² (> 100ä¸ªå®¹å™¨)ï¼š
â†’ å¤šå±‚ç½‘ç»œæ¶æ„ï¼Œä¸“ä¸šç›‘æ§ç³»ç»Ÿ
â†’ é‡ç‚¹å…³æ³¨ï¼šå¯æ‰©å±•æ€§å’Œç¨³å®šæ€§
```

**ğŸ”§ æ—¥å¸¸è¿ç»´è¦ç‚¹**
```
å®šæœŸæ£€æŸ¥é¡¹ç›®ï¼š
âœ… ç½‘ç»œæ€§èƒ½æŒ‡æ ‡æ˜¯å¦æ­£å¸¸
âœ… DNSè§£æé€Ÿåº¦æ˜¯å¦ç¨³å®š  
âœ… è´Ÿè½½å‡è¡¡æ˜¯å¦å‡åŒ€åˆ†é…
âœ… å®¹å™¨å¥åº·æ£€æŸ¥æ˜¯å¦é€šè¿‡

åº”æ€¥å¤„ç†å‡†å¤‡ï¼š
ğŸ“‹ ç½‘ç»œæ•…éšœæ’æŸ¥æ¸…å•
ğŸ“‹ æ€§èƒ½é—®é¢˜å®šä½æµç¨‹
ğŸ“‹ å…³é”®é…ç½®å¤‡ä»½æ–¹æ¡ˆ
ğŸ“‹ ç´§æ€¥æ¢å¤æ“ä½œæ‰‹å†Œ
```

**ğŸ§  è®°å¿†è¦ç‚¹**
- ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æ˜¯ç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œéœ€è¦ä»å¤šä¸ªè§’åº¦ç»¼åˆè€ƒè™‘
- ç›‘æ§å’Œæ’æŸ¥èƒ½åŠ›æ¯”ä¼˜åŒ–æŠ€å·§æ›´é‡è¦ï¼Œèƒ½å¿«é€Ÿå®šä½é—®é¢˜æ˜¯å…³é”®
- é€‰æ‹©åˆé€‚çš„ç½‘ç»œé©±åŠ¨å’Œæ‹“æ‰‘ç»“æ„ï¼Œæ¯”å¤æ‚çš„è°ƒä¼˜æ›´æœ‰æ•ˆæœ
- è‡ªåŠ¨åŒ–å’Œæ ‡å‡†åŒ–çš„è¿ç»´æµç¨‹ï¼Œèƒ½æ˜¾è‘—æå‡ç½‘ç»œçš„ç¨³å®šæ€§å’Œæ€§èƒ½