---
title: 4ã€Docker Composeé…ç½®æ–‡ä»¶
---
## ğŸ“š ç›®å½•

1. [Docker Composeæ˜¯ä»€ä¹ˆ](#1-Docker-Composeæ˜¯ä»€ä¹ˆ)
2. [é…ç½®æ–‡ä»¶åŸºç¡€ç»“æ„](#2-é…ç½®æ–‡ä»¶åŸºç¡€ç»“æ„)
3. [æœåŠ¡å®šä¹‰è¯¦è§£](#3-æœåŠ¡å®šä¹‰è¯¦è§£)
4. [ç½‘ç»œé…ç½®ç®¡ç†](#4-ç½‘ç»œé…ç½®ç®¡ç†)
5. [æ•°æ®å·é…ç½®](#5-æ•°æ®å·é…ç½®)
6. [ç¯å¢ƒä¸é…ç½®ç®¡ç†](#6-ç¯å¢ƒä¸é…ç½®ç®¡ç†)
7. [éƒ¨ç½²ä¸è¿ç»´é…ç½®](#7-éƒ¨ç½²ä¸è¿ç»´é…ç½®)
8. [å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º](#8-å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ Docker Composeæ˜¯ä»€ä¹ˆ


### 1.1 ç®€å•ç†è§£Docker Compose


**ğŸ”¸ ç”Ÿæ´»ç±»æ¯”**
```
Dockerå®¹å™¨ = ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æˆ¿é—´
Docker Compose = æ•´æ ‹æ¥¼çš„è£…ä¿®è®¾è®¡å›¾

å°±åƒè£…ä¿®æˆ¿å­éœ€è¦è®¾è®¡å›¾çº¸ï¼š
- æ¯ä¸ªæˆ¿é—´æ”¾ä»€ä¹ˆå®¶å…·ï¼ˆæœåŠ¡é…ç½®ï¼‰
- æˆ¿é—´ä¹‹é—´å¦‚ä½•è¿é€šï¼ˆç½‘ç»œé…ç½®ï¼‰
- æ°´ç”µæ€ä¹ˆæ¥ï¼ˆæ•°æ®å·é…ç½®ï¼‰
- æ•´ä½“é£æ ¼ç»Ÿä¸€ï¼ˆç¯å¢ƒå˜é‡ï¼‰
```

**ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**
- **Docker Compose**ï¼šä¸€ä¸ªç”¨æ¥å®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨çš„å·¥å…·
- **é…ç½®æ–‡ä»¶**ï¼šç”¨YAMLæ ¼å¼å†™çš„`docker-compose.yml`æ–‡ä»¶
- **ä¸€é”®ç®¡ç†**ï¼šé€šè¿‡ä¸€ä¸ªå‘½ä»¤å°±èƒ½å¯åŠ¨æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰æœåŠ¡

**ğŸ¯ è§£å†³ä»€ä¹ˆé—®é¢˜**
```
æ²¡æœ‰Composeä¹‹å‰ï¼š
docker run -d --name web nginx
docker run -d --name db mysql
docker run -d --name redis redis
ï¼ˆè¦è®°ä½å¾ˆå¤šå‘½ä»¤ï¼Œå®¹æ˜“å‡ºé”™ï¼‰

æœ‰äº†Composeä¹‹åï¼š
docker-compose up
ï¼ˆä¸€ä¸ªå‘½ä»¤æå®šæ‰€æœ‰æœåŠ¡ï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆè¦ç”¨Docker Compose


**ğŸ”¸ å®é™…åœºæ™¯ä¸¾ä¾‹**

æƒ³è±¡ä½ è¦æ­å»ºä¸€ä¸ªåšå®¢ç½‘ç«™ï¼š
- éœ€è¦WebæœåŠ¡å™¨ï¼ˆNginxï¼‰
- éœ€è¦åº”ç”¨ç¨‹åºï¼ˆNode.jsï¼‰  
- éœ€è¦æ•°æ®åº“ï¼ˆMySQLï¼‰
- éœ€è¦ç¼“å­˜ï¼ˆRedisï¼‰

```
ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹ï¼š
âŒ æ¯ä¸ªæœåŠ¡å•ç‹¬å¯åŠ¨ï¼Œå‘½ä»¤å¤æ‚
âŒ æœåŠ¡é—´è¿æ¥é…ç½®éº»çƒ¦
âŒ ç¯å¢ƒå˜é‡ç®¡ç†æ··ä¹±
âŒ æ‰©å®¹ç¼©å®¹æ“ä½œç¹ç

Composeçš„ä¼˜åŠ¿ï¼š
âœ… ä¸€ä¸ªæ–‡ä»¶å®šä¹‰æ‰€æœ‰æœåŠ¡
âœ… æœåŠ¡é—´è‡ªåŠ¨ç½‘ç»œè¿æ¥
âœ… ç¯å¢ƒå˜é‡ç»Ÿä¸€ç®¡ç†
âœ… ä¸€é”®å¯åœæ•´ä¸ªåº”ç”¨
```

---

## 2. ğŸ“‹ é…ç½®æ–‡ä»¶åŸºç¡€ç»“æ„


### 2.1 docker-compose.ymlåŸºæœ¬æ¡†æ¶


**ğŸ”¸ æ–‡ä»¶ç»“æ„å…¨æ™¯å›¾**
```
docker-compose.yml
â”œâ”€â”€ version: "3.8"          â† ç‰ˆæœ¬å£°æ˜
â”œâ”€â”€ services:               â† æœåŠ¡å®šä¹‰åŒº
â”‚   â”œâ”€â”€ web:               â† ç¬¬ä¸€ä¸ªæœåŠ¡
â”‚   â”œâ”€â”€ database:          â† ç¬¬äºŒä¸ªæœåŠ¡
â”‚   â””â”€â”€ cache:             â† ç¬¬ä¸‰ä¸ªæœåŠ¡
â”œâ”€â”€ networks:              â† ç½‘ç»œé…ç½®åŒº
â”œâ”€â”€ volumes:               â† æ•°æ®å·é…ç½®åŒº
â”œâ”€â”€ configs:               â† é…ç½®æ–‡ä»¶åŒº
â””â”€â”€ secrets:               â† å¯†é’¥é…ç½®åŒº
```

**ğŸ’¡ æœ€ç®€å•çš„ä¾‹å­**
```yaml
version: "3.8"

services:
  web:
    image: nginx
    ports:
      - "80:80"
```

> **ğŸ¯ æ–°æ‰‹ç†è§£**ï¼šè¿™å°±åƒå†™ä¸€å¼ è´­ç‰©æ¸…å•ï¼Œå‘Šè¯‰Dockerï¼š"æˆ‘è¦ä¸€ä¸ªnginxæœåŠ¡ï¼ŒæŠŠå®ƒçš„80ç«¯å£å¼€æ”¾ç»™å¤–é¢è®¿é—®"

### 2.2 versionç‰ˆæœ¬å£°æ˜è¯¦è§£


**ğŸ”¸ ç‰ˆæœ¬é€‰æ‹©æŒ‡å—**

| ç‰ˆæœ¬å· | **é€‚ç”¨åœºæ™¯** | **ä¸»è¦ç‰¹æ€§** | **æ¨èåº¦** |
|--------|------------|-------------|-----------|
| **"3.8"** | `ç°ä»£é¡¹ç›®æ¨è` | `æ”¯æŒæ‰€æœ‰æ–°ç‰¹æ€§ï¼Œå…¼å®¹æ€§å¥½` | `â­â­â­â­â­` |
| **"3.7"** | `ç¨³å®šç”Ÿäº§ç¯å¢ƒ` | `åŠŸèƒ½å®Œæ•´ï¼Œä¹…ç»è€ƒéªŒ` | `â­â­â­â­â˜†` |
| **"3.6"** | `æ—§ç‰ˆæœ¬å…¼å®¹` | `åŸºç¡€åŠŸèƒ½é½å…¨` | `â­â­â­â˜†â˜†` |

**ğŸ“Œ ç‰ˆæœ¬é€‰æ‹©åŸåˆ™**
```
æ–°é¡¹ç›®ï¼šé€‰æ‹© 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
æ—§é¡¹ç›®ç»´æŠ¤ï¼šä¿æŒç°æœ‰ç‰ˆæœ¬
ç”Ÿäº§ç¯å¢ƒï¼š3.7+ è¶³å¤Ÿç¨³å®š
å­¦ä¹ ç»ƒä¹ ï¼šç›´æ¥ç”¨ 3.8
```

---

## 3. ğŸ—ï¸ æœåŠ¡å®šä¹‰è¯¦è§£


### 3.1 imageé•œåƒæŒ‡å®š


**ğŸ”¸ ä»€ä¹ˆæ˜¯é•œåƒ**
```
é•œåƒ = è½¯ä»¶çš„å®‰è£…åŒ…
å®¹å™¨ = è¿è¡Œä¸­çš„è½¯ä»¶å®ä¾‹

å°±åƒæ‰‹æœºAppï¼š
é•œåƒ = åº”ç”¨å•†åº—é‡Œçš„å®‰è£…åŒ…
å®¹å™¨ = å®‰è£…åè¿è¡Œçš„App
```

**ğŸ’» é•œåƒæŒ‡å®šæ–¹å¼**
```yaml
services:
  # æ–¹å¼1ï¼šä½¿ç”¨å®˜æ–¹é•œåƒ
  web:
    image: nginx:latest
  
  # æ–¹å¼2ï¼šæŒ‡å®šå…·ä½“ç‰ˆæœ¬
  database:
    image: mysql:8.0
  
  # æ–¹å¼3ï¼šä½¿ç”¨ç§æœ‰ä»“åº“
  app:
    image: myregistry.com/myapp:v1.0
```

**ğŸ¯ ç‰ˆæœ¬é€‰æ‹©å»ºè®®**
- **latest**ï¼šæœ€æ–°ç‰ˆæœ¬ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰
- **å…·ä½“ç‰ˆæœ¬å·**ï¼šå¦‚`mysql:8.0`ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
- **ä¸æŒ‡å®šç‰ˆæœ¬**ï¼šé»˜è®¤ä½¿ç”¨latest

### 3.2 buildæ„å»ºé…ç½®


**ğŸ”¸ ä»€ä¹ˆæ—¶å€™ç”¨build**
```
ä½¿ç”¨ç°æˆé•œåƒï¼šimage: nginx
æ„å»ºè‡ªå®šä¹‰é•œåƒï¼šbuild: ./my-app

å°±åƒï¼š
ä¹°ç°æˆçš„å®¶å…· vs å®šåˆ¶å®¶å…·
image = å®œå®¶ä¹°ç°æˆçš„
build = è¯·æœ¨åŒ å®šåˆ¶
```

**ğŸ› ï¸ buildé…ç½®ç¤ºä¾‹**
```yaml
services:
  web:
    build:
      context: ./web          # Dockerfileæ‰€åœ¨ç›®å½•
      dockerfile: Dockerfile   # Dockerfileæ–‡ä»¶å
      args:                   # æ„å»ºå‚æ•°
        - NODE_ENV=production
```

### 3.3 container_nameå®¹å™¨åç§°


**ğŸ·ï¸ å‘½åçš„é‡è¦æ€§**
```yaml
services:
  # ä¸æŒ‡å®šåç§°ï¼šDockerè‡ªåŠ¨ç”Ÿæˆ
  web:
    image: nginx
    # å®¹å™¨åï¼šmyproject_web_1ï¼ˆéš¾è®°ï¼‰
  
  # æŒ‡å®šåç§°ï¼šä¾¿äºç®¡ç†
  database:
    image: mysql
    container_name: my-mysql-db
    # å®¹å™¨åï¼šmy-mysql-dbï¼ˆæ¸…æ™°æ˜äº†ï¼‰
```

**ğŸ“Œ å‘½åå»ºè®®**
- ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
- åŒ…å«é¡¹ç›®åæˆ–ç”¨é€”
- é¿å…ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿ç”¨"-"åˆ†éš”

### 3.4 portsç«¯å£æ˜ å°„è¯¦è§£


**ğŸ”¸ ç«¯å£æ˜ å°„åŸç†å›¾**
```
å¤–éƒ¨è®¿é—® â†’ Dockerä¸»æœº â†’ å®¹å™¨å†…éƒ¨
localhost:8080 â†’ ä¸»æœº8080ç«¯å£ â†’ å®¹å™¨80ç«¯å£
                     â†“
                 ç«¯å£æ˜ å°„
```

**ğŸŒ ç«¯å£é…ç½®æ–¹å¼**
```yaml
services:
  web:
    image: nginx
    ports:
      # æ ¼å¼ï¼šä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
      - "8080:80"        # å¤–éƒ¨8080è®¿é—®å®¹å™¨80
      - "443:443"        # HTTPSç«¯å£
      - "3000-3005:3000" # ç«¯å£èŒƒå›´æ˜ å°„
```

**âš ï¸ ç«¯å£é€‰æ‹©æ³¨æ„äº‹é¡¹**
- 80ç«¯å£ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™
- å¸¸ç”¨ç«¯å£ï¼šé¿å…å†²çªï¼ˆå¦‚3306ã€5432ï¼‰
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨æ ‡å‡†ç«¯å£

---

## 4. ğŸŒ ç½‘ç»œé…ç½®ç®¡ç†


### 4.1 networksç½‘ç»œåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ å®¹å™¨ç½‘ç»œç±»æ¯”**
```
å®¹å™¨ç½‘ç»œ = å°åŒºå†…éƒ¨ç½‘ç»œ

é»˜è®¤æƒ…å†µï¼š
æ‰€æœ‰å®¹å™¨åœ¨åŒä¸€ä¸ª"å°åŒº"é‡Œï¼Œå¯ä»¥äº’ç›¸è®¿é—®
å®¹å™¨å = é—¨ç‰Œå·ï¼ˆwebã€databaseã€cacheï¼‰

è‡ªå®šä¹‰ç½‘ç»œï¼š
åˆ›å»ºä¸åŒçš„"å°åŒº"ï¼Œæ§åˆ¶å“ªäº›å®¹å™¨èƒ½äº’ç›¸è®¿é—®
```

**ğŸ—ï¸ ç½‘ç»œç±»å‹å¯¹æ¯”**

| ç½‘ç»œç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å®‰å…¨æ€§** |
|---------|----------|-------------|-----------|
| **bridge** | `é»˜è®¤ç½‘ç»œç±»å‹` | `å•ä¸»æœºå¤šå®¹å™¨` | `â­â­â­â˜†â˜†` |
| **host** | `ä½¿ç”¨ä¸»æœºç½‘ç»œ` | `æ€§èƒ½è¦æ±‚æé«˜` | `â­â­â˜†â˜†â˜†` |
| **overlay** | `è·¨ä¸»æœºç½‘ç»œ` | `é›†ç¾¤éƒ¨ç½²` | `â­â­â­â­â˜†` |

### 4.2 ç½‘ç»œé…ç½®å®æˆ˜


**ğŸ”§ åŸºç¡€ç½‘ç»œé…ç½®**
```yaml
version: "3.8"

services:
  web:
    image: nginx
    networks:
      - frontend
  
  database:
    image: mysql
    networks:
      - backend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
```

**ğŸ“Š ç½‘ç»œéš”ç¦»ç¤ºæ„å›¾**
```
Frontend Network          Backend Network
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Server    â”‚       â”‚    Database     â”‚
â”‚   (nginx)       â”‚       â”‚    (mysql)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
              App Network
           (å¦‚æœéœ€è¦é€šä¿¡)
```

### 4.3 externalå¤–éƒ¨ç½‘ç»œå¼•ç”¨


**ğŸ”¸ ä»€ä¹ˆæ—¶å€™ç”¨external**
```
åœºæ™¯ï¼šå¤šä¸ªé¡¹ç›®å…±äº«åŒä¸€ä¸ªç½‘ç»œ

é¡¹ç›®Aï¼šåšå®¢ç³»ç»Ÿ
é¡¹ç›®Bï¼šç®¡ç†åå°
å…±äº«ç½‘ç»œï¼šè®©ä¸¤ä¸ªé¡¹ç›®çš„æ•°æ®åº“äº’é€š
```

```yaml
networks:
  shared-network:
    external: true  # ä½¿ç”¨å·²å­˜åœ¨çš„å¤–éƒ¨ç½‘ç»œ
    name: company-network
```

---

## 5. ğŸ’¾ æ•°æ®å·é…ç½®


### 5.1 volumesæ•°æ®æŒä¹…åŒ–æ¦‚å¿µ


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å·**
```
å®¹å™¨ç‰¹æ€§ï¼šåˆ é™¤å°±æ¶ˆå¤±
æ•°æ®éœ€æ±‚ï¼šä¿å­˜é‡è¦æ•°æ®

å°±åƒï¼š
å®¹å™¨ = é…’åº—æˆ¿é—´ï¼ˆä½å®¢èµ°äº†ï¼Œä¸ªäººç‰©å“å°±æ²¡äº†ï¼‰
æ•°æ®å· = é“¶è¡Œä¿é™©ç®±ï¼ˆæ°¸ä¹…ä¿å­˜é‡è¦ä¸œè¥¿ï¼‰
```

**ğŸ“¦ æ•°æ®å·ç±»å‹å¯¹æ¯”**

| ç±»å‹ | **è¯´æ˜** | **è·¯å¾„ç¤ºä¾‹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|-------------|
| **å…·åå·** | `Dockerç®¡ç†çš„å·` | `mysql-data:/var/lib/mysql` | `æ•°æ®åº“æ•°æ®` |
| **ç»‘å®šæŒ‚è½½** | `ä¸»æœºç›®å½•æ˜ å°„` | `./logs:/app/logs` | `æ—¥å¿—æ–‡ä»¶` |
| **tmpfs** | `å†…å­˜ä¸´æ—¶å­˜å‚¨` | `tmpfs:/tmp` | `ä¸´æ—¶æ–‡ä»¶` |

### 5.2 æ•°æ®å·é…ç½®å®æˆ˜


**ğŸ—„ï¸ æ•°æ®åº“æ•°æ®æŒä¹…åŒ–**
```yaml
version: "3.8"

services:
  database:
    image: mysql:8.0
    volumes:
      - mysql-data:/var/lib/mysql    # æ•°æ®åº“æ–‡ä»¶
      - ./config:/etc/mysql/conf.d   # é…ç½®æ–‡ä»¶
    environment:
      MYSQL_ROOT_PASSWORD: secret

volumes:
  mysql-data:    # å…·åå·å®šä¹‰
    driver: local
```

**ğŸ“ æ–‡ä»¶æŒ‚è½½ç¤ºæ„å›¾**
```
ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ          å®¹å™¨å†…éƒ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ./logs/         â”‚â†â†’ â”‚ /app/logs/      â”‚
â”‚ ./config/       â”‚â†â†’ â”‚ /etc/config/    â”‚
â”‚ mysql-dataå·    â”‚â†â†’ â”‚ /var/lib/mysql/ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†•                      â†•
    æŒä¹…åŒ–å­˜å‚¨              å®¹å™¨å†…è®¿é—®
```

### 5.3 æ•°æ®å·æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**
```yaml
# é‡è¦æ•°æ®ç”¨å…·åå·
volumes:
  - db-data:/var/lib/mysql

# é…ç½®æ–‡ä»¶ç”¨ç»‘å®šæŒ‚è½½
volumes:
  - ./nginx.conf:/etc/nginx/nginx.conf:ro  # ro=åªè¯»
```

**âŒ é¿å…çš„é—®é¢˜**
- ä¸è¦æŒ‚è½½æ•´ä¸ªæ ¹ç›®å½•
- é¿å…å¾ªç¯æŒ‚è½½
- æ³¨æ„æ–‡ä»¶æƒé™é—®é¢˜

---

## 6. âš™ï¸ ç¯å¢ƒä¸é…ç½®ç®¡ç†


### 6.1 environmentç¯å¢ƒå˜é‡è¯¦è§£


**ğŸ”¸ ç¯å¢ƒå˜é‡çš„ä½œç”¨**
```
ç¯å¢ƒå˜é‡ = ç¨‹åºè¿è¡Œæ—¶çš„é…ç½®å‚æ•°

å°±åƒç©ºè°ƒçš„é¥æ§å™¨ï¼š
æ¸©åº¦è®¾ç½® = ç¯å¢ƒå˜é‡
ç©ºè°ƒè¿è¡Œæ•ˆæœ = ç¨‹åºè¡Œä¸º

ä¸åŒç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰ç”¨ä¸åŒé…ç½®
```

**ğŸŒ ç¯å¢ƒå˜é‡é…ç½®æ–¹å¼**
```yaml
services:
  web:
    image: nginx
    environment:
      # æ–¹å¼1ï¼šç›´æ¥è®¾ç½®
      - NODE_ENV=production
      - DEBUG=false
      
      # æ–¹å¼2ï¼šé”®å€¼å¯¹æ ¼å¼
      NODE_ENV: production
      DATABASE_URL: mysql://user:pass@db:3306/mydb
      
      # æ–¹å¼3ï¼šä»ä¸»æœºè·å–
      - HOME
```

### 6.2 configsé…ç½®æ–‡ä»¶ç®¡ç†


**ğŸ“„ é…ç½®æ–‡ä»¶ç®¡ç†æ–¹æ¡ˆ**

| æ–¹æ¡ˆ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|------------|---------|---------|
| **ç»‘å®šæŒ‚è½½** | `å¼€å‘ç¯å¢ƒ` | `ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆ` | `è·¯å¾„ä¾èµ–å¼º` |
| **configs** | `ç”Ÿäº§ç¯å¢ƒ` | `ç‰ˆæœ¬ç®¡ç†å¥½` | `ä¿®æ”¹éœ€é‡å»º` |
| **ç¯å¢ƒå˜é‡** | `ç®€å•é…ç½®` | `çµæ´»æ–¹ä¾¿` | `ä¸é€‚åˆå¤æ‚é…ç½®` |

```yaml
version: "3.8"

services:
  web:
    image: nginx
    configs:
      - source: nginx-config
        target: /etc/nginx/nginx.conf

configs:
  nginx-config:
    file: ./nginx.conf  # é…ç½®æ–‡ä»¶è·¯å¾„
```

### 6.3 secretså¯†é’¥ç®¡ç†


**ğŸ” å¯†é’¥å®‰å…¨ç®¡ç†**
```
æ™®é€šé…ç½®ï¼šæ•°æ®åº“åœ°å€ã€ç«¯å£å·
æ•æ„Ÿä¿¡æ¯ï¼šå¯†ç ã€APIå¯†é’¥ã€è¯ä¹¦

secretsçš„ä¼˜åŠ¿ï¼š
âœ… åŠ å¯†å­˜å‚¨
âœ… è®¿é—®æ§åˆ¶  
âœ… å®¡è®¡æ—¥å¿—
```

```yaml
version: "3.8"

services:
  app:
    image: myapp
    secrets:
      - database-password
      - api-key

secrets:
  database-password:
    file: ./secrets/db_password.txt
  api-key:
    external: true
    name: myapp-api-key
```

---

## 7. ğŸš€ éƒ¨ç½²ä¸è¿ç»´é…ç½®


### 7.1 depends_onä¾èµ–å…³ç³»


**ğŸ”¸ æœåŠ¡å¯åŠ¨é¡ºåº**
```
çœŸå®åœºæ™¯ï¼š
Webåº”ç”¨ â†’ ä¾èµ– â†’ æ•°æ®åº“
å¦‚æœæ•°æ®åº“æ²¡å¯åŠ¨ï¼ŒWebåº”ç”¨ä¼šæŠ¥é”™

depends_onçš„ä½œç”¨ï¼š
ç¡®ä¿æ•°æ®åº“å…ˆå¯åŠ¨ï¼Œå†å¯åŠ¨Webåº”ç”¨
```

```yaml
services:
  web:
    image: nginx
    depends_on:
      - database
      - cache
  
  database:
    image: mysql
  
  cache:
    image: redis
```

**âš ï¸ ä¾èµ–å…³ç³»æ³¨æ„äº‹é¡¹**
- åªæ§åˆ¶å¯åŠ¨é¡ºåºï¼Œä¸ä¿è¯æœåŠ¡å®Œå…¨å°±ç»ª
- éœ€è¦åº”ç”¨ç¨‹åºè‡ªå·±å¤„ç†è¿æ¥é‡è¯•
- å¤æ‚ä¾èµ–ç”¨`condition`æ¡ä»¶

### 7.2 restarté‡å¯ç­–ç•¥


**ğŸ”„ é‡å¯ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ | **è¡Œä¸º** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|
| **no** | `ä»ä¸é‡å¯` | `ä¸€æ¬¡æ€§ä»»åŠ¡` |
| **always** | `æ€»æ˜¯é‡å¯` | `æ ¸å¿ƒæœåŠ¡` |
| **on-failure** | `å‡ºé”™æ‰é‡å¯` | `ä¸€èˆ¬æœåŠ¡` |
| **unless-stopped** | `é™¤éæ‰‹åŠ¨åœæ­¢` | `ç³»ç»ŸæœåŠ¡` |

```yaml
services:
  # å…³é”®æœåŠ¡ï¼šæ€»æ˜¯é‡å¯
  database:
    image: mysql
    restart: always
  
  # åº”ç”¨æœåŠ¡ï¼šå‡ºé”™é‡å¯
  web:
    image: nginx
    restart: on-failure
```

### 7.3 healthcheckå¥åº·æ£€æŸ¥


**ğŸ’— å¥åº·æ£€æŸ¥æœºåˆ¶**
```
å¥åº·æ£€æŸ¥ = å®šæœŸä½“æ£€

Dockerå®šæœŸæ£€æŸ¥å®¹å™¨ï¼š
- æœåŠ¡æ˜¯å¦æ­£å¸¸å“åº”
- æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
- åº”ç”¨è¿›ç¨‹æ˜¯å¦å­˜åœ¨
```

```yaml
services:
  web:
    image: nginx
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s      # æ£€æŸ¥é—´éš”
      timeout: 10s       # è¶…æ—¶æ—¶é—´
      retries: 3         # é‡è¯•æ¬¡æ•°
      start_period: 40s  # å¯åŠ¨ç­‰å¾…æ—¶é—´
```

### 7.4 deployéƒ¨ç½²é…ç½®


**ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é…ç½®**
```yaml
services:
  web:
    image: nginx
    deploy:
      replicas: 3                    # å‰¯æœ¬æ•°é‡
      placement:
        constraints:
          - node.role == manager     # èŠ‚ç‚¹é™åˆ¶
      resources:
        limits:
          cpus: '0.5'               # CPUé™åˆ¶
          memory: 512M              # å†…å­˜é™åˆ¶
        reservations:
          cpus: '0.25'              # CPUé¢„ç•™
          memory: 256M              # å†…å­˜é¢„ç•™
      update_config:
        parallelism: 1              # æ›´æ–°å¹¶å‘æ•°
        delay: 10s                  # æ›´æ–°å»¶è¿Ÿ
```

---

## 8. ğŸ¯ å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º


### 8.1 åšå®¢ç³»ç»Ÿå®Œæ•´é…ç½®


**ğŸŒ ç³»ç»Ÿæ¶æ„å›¾**
```
ç”¨æˆ·è®¿é—®
    â†“
 Nginx (åå‘ä»£ç†)
    â†“
WordPress (åº”ç”¨)
    â†“
 MySQL (æ•°æ®åº“)
    â†“
 Redis (ç¼“å­˜)
```

**ğŸ“ å®Œæ•´é…ç½®æ–‡ä»¶**
```yaml
version: "3.8"

services:
  # WebæœåŠ¡å™¨
  nginx:
    image: nginx:alpine
    container_name: blog-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
    depends_on:
      - wordpress
    restart: unless-stopped
    networks:
      - frontend

  # WordPressåº”ç”¨
  wordpress:
    image: wordpress:php7.4
    container_name: blog-wp
    environment:
      WORDPRESS_DB_HOST: mysql:3306
      WORDPRESS_DB_NAME: wordpress
      WORDPRESS_DB_USER: wpuser
      WORDPRESS_DB_PASSWORD_FILE: /run/secrets/wp_db_password
    volumes:
      - wp-content:/var/www/html/wp-content
    depends_on:
      - mysql
      - redis
    secrets:
      - wp_db_password
    restart: unless-stopped
    networks:
      - frontend
      - backend

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: blog-mysql
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wpuser
      MYSQL_PASSWORD_FILE: /run/secrets/wp_db_password
    volumes:
      - mysql-data:/var/lib/mysql
      - ./mysql/init:/docker-entrypoint-initdb.d:ro
    secrets:
      - mysql_root_password
      - wp_db_password
    restart: unless-stopped
    networks:
      - backend

  # Redisç¼“å­˜
  redis:
    image: redis:alpine
    container_name: blog-redis
    restart: unless-stopped
    networks:
      - backend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge

volumes:
  mysql-data:
    driver: local
  wp-content:
    driver: local

secrets:
  mysql_root_password:
    file: ./secrets/mysql_root_password.txt
  wp_db_password:
    file: ./secrets/wp_db_password.txt
```

### 8.2 å¼€å‘ç¯å¢ƒå¿«é€Ÿé…ç½®


**âš¡ å¿«é€Ÿå¼€å‘é…ç½®**
```yaml
version: "3.8"

services:
  app:
    build: .
    container_name: dev-app
    ports:
      - "3000:3000"
    volumes:
      - .:/app                    # ä»£ç çƒ­é‡è½½
      - /app/node_modules         # æ’é™¤node_modules
    environment:
      - NODE_ENV=development
      - DEBUG=*
    command: npm run dev
    depends_on:
      - database

  database:
    image: postgres:13
    container_name: dev-db
    environment:
      POSTGRES_DB: devdb
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: secret
    ports:
      - "5432:5432"             # æœ¬åœ°è¿æ¥è°ƒè¯•
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

### 8.3 å¸¸ç”¨å‘½ä»¤å¿«é€Ÿå‚è€ƒ


**ğŸ¯ æ—¥å¸¸æ“ä½œå‘½ä»¤**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart web

# åœæ­¢å¹¶åˆ é™¤
docker-compose down

# åˆ é™¤åŒ…æ‹¬æ•°æ®å·
docker-compose down -v
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Docker Composeï¼šå¤šå®¹å™¨åº”ç”¨çš„ç¼–æ’å·¥å…·
ğŸ”¸ docker-compose.ymlï¼šYAMLæ ¼å¼çš„é…ç½®æ–‡ä»¶
ğŸ”¸ servicesï¼šå®šä¹‰åº”ç”¨åŒ…å«å“ªäº›æœåŠ¡
ğŸ”¸ networksï¼šé…ç½®æœåŠ¡é—´çš„ç½‘ç»œé€šä¿¡
ğŸ”¸ volumesï¼šç®¡ç†æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨
ğŸ”¸ ç¯å¢ƒå˜é‡ï¼šé…ç½®åº”ç”¨è¿è¡Œå‚æ•°
ğŸ”¸ ä¾èµ–å…³ç³»ï¼šæ§åˆ¶æœåŠ¡å¯åŠ¨é¡ºåº
```

### 9.2 é…ç½®æ–‡ä»¶æ ¸å¿ƒç»“æ„


**ğŸ—ï¸ é…ç½®æ–‡ä»¶æ„æˆè¦ç´ **
```
version: ç‰ˆæœ¬å£°æ˜ï¼ˆæ¨è3.8+ï¼‰
services: æœåŠ¡å®šä¹‰ï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰
  â”œâ”€â”€ image/build: é•œåƒæ¥æº
  â”œâ”€â”€ ports: ç«¯å£æ˜ å°„
  â”œâ”€â”€ volumes: æ•°æ®æŒ‚è½½  
  â”œâ”€â”€ environment: ç¯å¢ƒå˜é‡
  â”œâ”€â”€ depends_on: ä¾èµ–å…³ç³»
  â””â”€â”€ restart: é‡å¯ç­–ç•¥
networks: ç½‘ç»œé…ç½®ï¼ˆæœåŠ¡é€šä¿¡ï¼‰
volumes: æ•°æ®å·å®šä¹‰ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰
configs: é…ç½®æ–‡ä»¶ç®¡ç†
secrets: æ•æ„Ÿä¿¡æ¯ç®¡ç†
```

### 9.3 æœ€ä½³å®è·µè¦ç‚¹


**âœ… æ¨èåšæ³•**
```
ğŸ”¸ ä½¿ç”¨å…·ä½“ç‰ˆæœ¬å·çš„é•œåƒï¼ˆé¿å…latestï¼‰
ğŸ”¸ æ•æ„Ÿä¿¡æ¯ç”¨secretsç®¡ç†
ğŸ”¸ é‡è¦æ•°æ®ç”¨å…·åå·æŒä¹…åŒ–
ğŸ”¸ åˆç†è§„åˆ’ç½‘ç»œéš”ç¦»
ğŸ”¸ é…ç½®å¥åº·æ£€æŸ¥å’Œé‡å¯ç­–ç•¥
ğŸ”¸ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨èµ„æºé™åˆ¶
```

**âŒ å¸¸è§é”™è¯¯**
```
ğŸ”¸ å¿˜è®°é…ç½®æ•°æ®æŒä¹…åŒ–
ğŸ”¸ ç«¯å£å†²çªæ²¡æœ‰æ£€æŸ¥
ğŸ”¸ ç½‘ç»œé…ç½®è¿‡äºå¤æ‚
ğŸ”¸ ç¯å¢ƒå˜é‡ç¡¬ç¼–ç å¯†ç 
ğŸ”¸ ä¾èµ–å…³ç³»é…ç½®ä¸å½“
ğŸ”¸ èµ„æºé™åˆ¶é…ç½®ç¼ºå¤±
```

### 9.4 ä¸åŒç¯å¢ƒçš„é…ç½®ç­–ç•¥


| ç¯å¢ƒ | **é‡ç‚¹å…³æ³¨** | **é…ç½®ç‰¹ç‚¹** |
|------|------------|-------------|
| **å¼€å‘** | `å¿«é€Ÿå¯åŠ¨ï¼Œä»£ç çƒ­é‡è½½` | `ç«¯å£æ˜ å°„å¤šï¼Œæ•°æ®å·æ˜ å°„æºç ` |
| **æµ‹è¯•** | `ç¯å¢ƒä¸€è‡´æ€§ï¼Œè‡ªåŠ¨åŒ–` | `å›ºå®šç‰ˆæœ¬ï¼Œå®Œæ•´æœåŠ¡æ ˆ` |
| **ç”Ÿäº§** | `ç¨³å®šæ€§ï¼Œå®‰å…¨æ€§ï¼Œæ€§èƒ½` | `èµ„æºé™åˆ¶ï¼Œå¥åº·æ£€æŸ¥ï¼Œå¯†é’¥ç®¡ç†` |

### 9.5 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ¯ å¾ªåºæ¸è¿›çš„å­¦ä¹ è·¯å¾„**
```
ç¬¬1æ­¥ï¼šç†è§£åŸºæœ¬æ¦‚å¿µå’Œä½œç”¨
ç¬¬2æ­¥ï¼šç¼–å†™ç®€å•çš„å•æœåŠ¡é…ç½®
ç¬¬3æ­¥ï¼šå®è·µå¤šæœåŠ¡åº”ç”¨ç¼–æ’
ç¬¬4æ­¥ï¼šæŒæ¡ç½‘ç»œå’Œæ•°æ®å·é…ç½®
ç¬¬5æ­¥ï¼šå­¦ä¹ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ
ç¬¬6æ­¥ï¼šè¿›é˜¶å­¦ä¹ é›†ç¾¤å’Œç¼–æ’
```

**ğŸ§  è®°å¿†å£è¯€**
```
ç‰ˆæœ¬æœåŠ¡ç½‘ç»œå·ï¼Œç¯å¢ƒä¾èµ–é‡å¯å…¨
é…ç½®å¯†é’¥åˆ†å¼€ç®¡ï¼Œç”Ÿäº§å¼€å‘è¦åŒºåˆ†
ä¸€é”®å¯åœçœŸæ–¹ä¾¿ï¼Œç¼–æ’å®¹å™¨ä¸å†éš¾
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Docker Composeè®©å¤šå®¹å™¨ç®¡ç†å˜ç®€å•
- ä¸€ä¸ªYAMLæ–‡ä»¶å®šä¹‰æ•´ä¸ªåº”ç”¨æ¶æ„  
- æŒæ¡servicesã€networksã€volumesä¸‰å¤§æ ¸å¿ƒ
- ç”Ÿäº§ç¯å¢ƒæ³¨é‡å®‰å…¨æ€§å’Œç¨³å®šæ€§é…ç½®
- é€šè¿‡å®è·µåŠ æ·±å¯¹å„ä¸ªé…ç½®é€‰é¡¹çš„ç†è§£