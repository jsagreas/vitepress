---
title: 1、核心操作语法
---
## 📚 目录

1. [GraphQL操作概述](#1-graphql操作概述)
2. [Query查询语法详解](#2-query查询语法详解)
3. [Mutation变更语法详解](#3-mutation变更语法详解)
4. [Subscription订阅语法详解](#4-subscription订阅语法详解)
5. [字段选择与嵌套操作](#5-字段选择与嵌套操作)
6. [Variables变量使用详解](#6-variables变量使用详解)
7. [Aliases别名与Fragment片段](#7-aliases别名与fragment片段)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 GraphQL操作概述


### 1.1 什么是GraphQL操作


**通俗理解**：GraphQL操作就是你和服务器对话的三种方式
```
就像和朋友聊天：
🔍 Query(查询)  → "请告诉我..."    → 获取信息，不改变数据
✏️ Mutation(变更) → "请帮我做..." → 修改数据，有副作用  
📡 Subscription(订阅) → "有变化时通知我" → 实时监听变化
```

### 1.2 三大操作类型对比


| 操作类型 | **作用** | **类比** | **是否改变数据** | **执行方式** |
|---------|---------|----------|----------------|-------------|
| 🔍 **Query** | `获取数据` | `查询图书馆书籍` | ❌ 只读 | `立即返回` |
| ✏️ **Mutation** | `修改数据` | `借书/还书` | ✅ 会改变 | `按顺序执行` |
| 📡 **Subscription** | `监听变化` | `图书到货通知` | ❌ 只监听 | `持续连接` |

### 1.3 操作的基本结构


**标准格式**：
```
操作类型 操作名称(变量) {
  字段名 {
    子字段名
  }
}
```

**实际例子**：
```graphql
query GetUser($id: ID!) {
  user(id: $id) {
    name
    email
  }
}
```

---

## 2. 🔍 Query查询语法详解


### 2.1 Query是什么


**简单理解**：Query就是"问问题"，只获取信息，不会改变任何东西

```
现实对比：
去银行查余额 → 只看不动钱 → GraphQL Query
去商店问价格 → 只问不买 → GraphQL Query
翻字典查单词 → 只查不改 → GraphQL Query
```

### 2.2 最简单的Query


**基础语法**：
```graphql
# 最简单的查询 - 获取用户信息
{
  user {
    name
    age
  }
}
```

> 💡 **新手提示**
> 
> 大括号`{}`包围你想要的数据，就像购物清单一样列出需要什么

### 2.3 带参数的Query


**语法格式**：
```graphql
# 查询特定用户
{
  user(id: "123") {
    name
    email
    posts {
      title
    }
  }
}
```

**参数说明**：
- `id: "123"` - 告诉服务器你要哪个用户的信息
- 就像说"请给我123号用户的姓名和邮箱"

### 2.4 复杂查询示例


```graphql
# 一次查询多个不同类型的数据
{
  # 获取用户信息
  user(id: "123") {
    name
    profile {
      bio
      avatar
    }
  }
  
  # 获取热门文章
  posts(limit: 5, sort: POPULAR) {
    title
    content
    author {
      name
    }
  }
}
```

**查询结果**：
```json
{
  "data": {
    "user": {
      "name": "张三",
      "profile": {
        "bio": "程序员",
        "avatar": "avatar.jpg"
      }
    },
    "posts": [
      {
        "title": "GraphQL入门",
        "content": "...",
        "author": {
          "name": "李四"
        }
      }
    ]
  }
}
```

---

## 3. ✏️ Mutation变更语法详解


### 3.1 Mutation是什么


**通俗解释**：Mutation就是"做事情"，会改变服务器上的数据

```
现实对比：
银行转账 → 改变账户余额 → GraphQL Mutation
发朋友圈 → 创建新内容 → GraphQL Mutation  
删除照片 → 移除数据 → GraphQL Mutation
修改昵称 → 更新信息 → GraphQL Mutation
```

### 3.2 基础Mutation语法


**创建数据**：
```graphql
mutation {
  createUser(input: {
    name: "张三"
    email: "zhang@example.com"
  }) {
    id
    name
    createdAt
  }
}
```

**语法解析**：
- `mutation` - 告诉服务器"我要做事情"
- `createUser` - 具体要做什么事
- `input: {...}` - 需要的信息
- `{ id name createdAt }` - 操作完成后返回什么信息

### 3.3 更新数据


```graphql
mutation {
  updateUser(id: "123", input: {
    name: "李四"
    bio: "前端工程师"
  }) {
    id
    name
    bio
    updatedAt
  }
}
```

> ⚠️ **重要特性**
> 
> Mutation会**按顺序执行**，如果有多个操作，不会同时进行

### 3.4 删除数据


```graphql
mutation {
  deletePost(id: "456") {
    success
    message
  }
}
```

**返回结果**：
```json
{
  "data": {
    "deletePost": {
      "success": true,
      "message": "文章删除成功"
    }
  }
}
```

---

## 4. 📡 Subscription订阅语法详解


### 4.1 Subscription是什么


**形象比喻**：Subscription像是"订阅报纸"，有新消息时自动推送给你

```
生活例子：
📱 微信消息通知 → 有人发消息立即提醒 → GraphQL Subscription
📺 股票价格监控 → 价格变化立即更新 → GraphQL Subscription
🔔 订单状态更新 → 发货时立即通知 → GraphQL Subscription
```

### 4.2 基础Subscription语法


**监听新评论**：
```graphql
subscription {
  newComment(postId: "123") {
    id
    content
    author {
      name
    }
    createdAt
  }
}
```

**工作原理**：
```
客户端发起订阅 → 保持连接 → 有新评论时 → 立即推送给客户端
```

### 4.3 实时聊天示例


```graphql
subscription {
  messageAdded(roomId: "chat-001") {
    id
    text
    user {
      name
      avatar
    }
    timestamp
  }
}
```

**使用场景**：
- 💬 **实时聊天** - 新消息立即显示
- 📊 **数据监控** - 实时图表更新  
- 🎮 **在线游戏** - 游戏状态同步
- 📈 **股票行情** - 价格实时更新

### 4.4 订阅的连接状态


```
连接建立: WebSocket连接 → 订阅激活
数据推送: 服务器 → 客户端(实时)
连接断开: 客户端关闭 → 订阅结束
```

---

## 5. 🎪 字段选择与嵌套操作


### 5.1 什么是字段选择


**通俗理解**：字段选择就像"点菜"，你只要你需要的，不要的不给你

```
传统API的问题：
REST API → 给你整桌菜(所有数据) → 浪费流量
GraphQL → 你点什么菜给什么菜(按需获取) → 高效精准
```

### 5.2 精确字段选择


**只要需要的字段**：
```graphql
# 只要用户的姓名和邮箱
{
  user(id: "123") {
    name
    email
    # 不要其他字段如：phone, address, bio等
  }
}
```

**对比结果**：
```
传统REST API返回：
{
  "id": "123",
  "name": "张三", ✅需要
  "email": "zhang@example.com", ✅需要  
  "phone": "13800138000", ❌不需要
  "address": "北京市...", ❌不需要
  "bio": "程序员", ❌不需要
  "avatar": "http://...", ❌不需要
}

GraphQL返回：
{
  "name": "张三", ✅只返回需要的
  "email": "zhang@example.com" ✅只返回需要的
}
```

### 5.3 嵌套查询详解


**什么是嵌套**：获取关联数据，像俄罗斯套娃一样

```graphql
{
  user(id: "123") {
    name                    # 用户姓名
    posts {                 # 用户的文章列表
      title                 # 文章标题
      comments {            # 文章的评论列表  
        content             # 评论内容
        author {            # 评论作者信息
          name              # 作者姓名
        }
      }
    }
  }
}
```

**数据关系图**：
```
用户(User)
    ↓
  文章(Posts)
    ↓  
  评论(Comments)
    ↓
评论作者(Author)
```

### 5.4 嵌套查询的优势


**传统方式需要多次请求**：
```javascript
// 需要4次API调用
1. GET /users/123           // 获取用户
2. GET /users/123/posts     // 获取用户文章
3. GET /posts/456/comments  // 获取文章评论  
4. GET /users/789           // 获取评论作者
```

**GraphQL一次搞定**：
```graphql
# 一次查询获取所有相关数据
{
  user(id: "123") {
    name
    posts {
      title
      comments {
        content
        author { name }
      }
    }
  }
}
```

---

## 6. 🔧 Variables变量使用详解


### 6.1 为什么需要变量


**问题场景**：每次查询不同用户，难道要写不同的查询语句吗？

```graphql
# 🙁 笨方法：每个用户写一个查询
{ user(id: "123") { name } }  # 查询用户123
{ user(id: "456") { name } }  # 查询用户456  
{ user(id: "789") { name } }  # 查询用户789
```

**解决方案**：使用变量，一个查询语句搞定所有情况

### 6.2 变量的基本语法


**格式**：`$变量名: 变量类型`

```graphql
# 查询语句定义
query GetUser($userId: ID!) {
  user(id: $userId) {
    name
    email
  }
}

# 变量值传入
{
  "userId": "123"
}
```

**语法解析**：
- `$userId` - 变量名，以$开头
- `ID!` - 变量类型，`!`表示必须传入
- 使用时直接写 `$userId`

### 6.3 变量类型说明


| 类型 | **含义** | **示例** | **说明** |
|------|---------|----------|---------|
| `String` | `文本` | `"张三"` | `普通字符串` |
| `Int` | `整数` | `18` | `年龄、数量等` |
| `Boolean` | `布尔值` | `true/false` | `是否、开关等` |
| `ID` | `唯一标识` | `"user123"` | `主键、标识符` |
| `Float` | `小数` | `3.14` | `价格、评分等` |

**必填与可选**：
```graphql
query Example(
  $required: String!    # 必须传入
  $optional: String     # 可以不传
) {
  # 查询内容
}
```

### 6.4 实际使用示例


**用户搜索功能**：
```graphql
query SearchUsers(
  $keyword: String!
  $limit: Int = 10      # 默认值为10
  $active: Boolean = true
) {
  users(
    search: $keyword
    limit: $limit  
    active: $active
  ) {
    id
    name
    email
  }
}
```

**传入变量**：
```json
{
  "keyword": "张三",
  "limit": 5,
  "active": true
}
```

### 6.5 变量的优势


```
✅ 重用性：一个查询适用多种情况
✅ 安全性：防止SQL注入等安全问题
✅ 清晰性：查询逻辑和数据分离
✅ 缓存友好：相同查询结构可以缓存
```

---

## 7. 🏷️ Aliases别名与Fragment片段


### 7.1 Aliases别名详解


**什么是别名**：给返回的字段起个新名字，避免冲突

**使用场景**：同时查询相同字段的不同数据
```graphql
# 😕 问题：想同时查询两个用户，字段名冲突
{
  user(id: "123") { name }  # 这里的name
  user(id: "456") { name }  # 和这里的name冲突了
}
```

**解决方案**：使用别名
```graphql
{
  firstUser: user(id: "123") {
    name
    email
  }
  
  secondUser: user(id: "456") {
    name
    email  
  }
}
```

**返回结果**：
```json
{
  "data": {
    "firstUser": {
      "name": "张三",
      "email": "zhang@example.com"
    },
    "secondUser": {
      "name": "李四", 
      "email": "li@example.com"
    }
  }
}
```

### 7.2 别名的实际应用


**数据对比场景**：
```graphql
{
  todayPosts: posts(date: "2024-01-01") {
    count
    titles
  }
  
  yesterdayPosts: posts(date: "2023-12-31") {
    count
    titles
  }
}
```

**字段重命名**：
```graphql
{
  user(id: "123") {
    username: name      # 把name字段重命名为username
    userEmail: email    # 把email字段重命名为userEmail
  }
}
```

### 7.3 Fragment片段详解


**什么是Fragment**：把重复使用的字段组合打包，像"模板"一样复用

**问题场景**：多个地方都需要相同的用户信息
```graphql
# 😕 重复代码
{
  post {
    author {
      id
      name  
      avatar
      bio
    }
  }
  
  comment {
    author {
      id      # 重复
      name    # 重复
      avatar  # 重复  
      bio     # 重复
    }
  }
}
```

### 7.4 定义和使用Fragment


**定义Fragment**：
```graphql
# 定义用户信息模板
fragment UserInfo on User {
  id
  name
  avatar
  bio
}
```

**使用Fragment**：
```graphql
{
  post {
    title
    author {
      ...UserInfo  # 展开UserInfo片段
    }
  }
  
  comment {
    content
    author {
      ...UserInfo  # 复用相同的片段
    }
  }
}
```

### 7.5 Fragment的高级用法


**嵌套Fragment**：
```graphql
fragment UserProfile on User {
  ...UserInfo
  posts {
    title
    createdAt
  }
}

fragment UserInfo on User {
  id
  name
  avatar
}
```

**内联Fragment**：
```graphql
{
  search(query: "GraphQL") {
    ... on Post {
      title
      content
    }
    ... on User {
      name
      email
    }
  }
}
```

### 7.6 Aliases与Fragment对比


| 特性 | **Aliases别名** | **Fragment片段** |
|------|---------------|-----------------|
| **作用** | `字段重命名` | `代码复用` |
| **解决问题** | `字段名冲突` | `重复代码` |
| **使用方式** | `newName: fieldName` | `...fragmentName` |
| **定义位置** | `查询内部` | `独立定义` |

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔍 Query(查询)：只读操作，获取数据，不改变任何内容
✏️ Mutation(变更)：写操作，创建/更新/删除数据，有副作用
📡 Subscription(订阅)：实时监听，数据变化时主动推送
🎯 字段选择：按需获取，避免数据冗余
🔧 Variables(变量)：参数化查询，提高复用性
🏷️ Aliases(别名)：字段重命名，解决冲突
📝 Fragment(片段)：代码复用，减少重复
```

### 8.2 关键理解要点


**🔹 GraphQL的核心优势**
```
传统REST API的问题：
• 数据冗余：返回不需要的字段
• 多次请求：获取关联数据需要多个API  
• 版本管理：API升级困难

GraphQL的解决方案：
• 按需获取：只返回需要的字段
• 一次查询：嵌套获取所有关联数据
• 强类型：自动文档和验证
```

**🔹 三大操作的本质区别**
```
Query → 问问题，不改变任何东西
Mutation → 做事情，会产生副作用
Subscription → 等通知，持续监听变化

记忆方法：
Query像查字典 → 只看不改
Mutation像写日记 → 记录新内容  
Subscription像订报纸 → 有新消息就送来
```

**🔹 变量与片段的价值**
```
Variables(变量)：
让查询变得灵活，同一个查询适用不同参数

Fragment(片段)：  
让代码变得整洁，重复的字段组合打包复用

Aliases(别名)：
解决字段冲突，让同时查询多个相似数据成为可能
```

### 8.3 实际应用指导


**🎯 什么时候用哪种操作**
```
✅ 用Query当你需要：
• 显示用户信息、文章列表
• 搜索功能、数据统计
• 任何只读的数据获取

✅ 用Mutation当你需要：  
• 用户注册、登录
• 发布文章、删除评论
• 任何会改变数据的操作

✅ 用Subscription当你需要：
• 实时聊天、消息通知
• 数据监控、状态同步  
• 任何需要实时更新的功能
```

**🔧 最佳实践建议**
```
字段选择：
• 只选择真正需要的字段
• 避免深度嵌套（3层以内最佳）

变量使用：
• 所有动态值都用变量
• 给变量起有意义的名字
• 合理设置默认值

片段管理：
• 把常用字段组合定义为片段
• 片段名字要清楚表达含义
• 避免过度嵌套片段
```

### 8.4 学习路径建议


**📚 学习顺序**
```
第1步：掌握Query基础语法 → 理解字段选择
第2步：学会使用Variables → 让查询更灵活  
第3步：掌握Mutation操作 → 实现数据修改
第4步：使用Aliases和Fragment → 提高代码质量
第5步：学习Subscription → 实现实时功能
```

**🎯 练习建议**
- 从简单的单字段查询开始
- 逐步增加嵌套和复杂度
- 多练习变量传参
- 尝试编写实际业务场景的查询

**核心记忆口诀**：
- *Query问问题，Mutation做事情，Subscription等通知*
- *字段按需选，变量让灵活，别名解冲突，片段能复用*
- *GraphQL三操作，一次请求全搞定，前端后端都省心*