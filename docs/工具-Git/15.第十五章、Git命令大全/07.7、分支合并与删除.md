---
title: 7、分支合并与删除
---
## 📚 目录

1. [分支合并基础概念](#1-分支合并基础概念)
2. [git merge 基础合并](#2-git-merge-基础合并)
3. [合并策略详解](#3-合并策略详解)
4. [分支删除操作](#4-分支删除操作)
5. [分支重命名与查看](#5-分支重命名与查看)
6. [合并冲突处理](#6-合并冲突处理)
7. [最佳实践与技巧](#7-最佳实践与技巧)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌱 分支合并基础概念


### 1.1 什么是分支合并


**通俗理解**：就像两条路最终汇聚到一起
- 你在一个分支上开发新功能
- 主分支继续有其他更新  
- 最终需要把你的功能"合并"到主分支
- 让大家都能用到你开发的新功能

```
开发前的状态：
主分支：  A---B---C (main)
           \
新功能：     D---E (feature)

合并后的状态：
主分支：  A---B---C---F (main) ← F是合并后的新提交
           \           /
新功能：     D---E------

这样main分支就有了feature分支的所有功能
```

### 1.2 为什么需要合并分支


**🎯 实际开发场景**：
- **多人协作**：小明开发登录功能，小红开发购物车，最后要合到一起
- **功能隔离**：每个功能独立开发，不互相干扰
- **版本管理**：主分支始终保持稳定，新功能测试好了再合并
- **代码审查**：合并前可以review代码质量

> 💡 **新手理解**：就像做菜，每个人负责一道菜，最后组成一桌完整的饭菜

### 1.3 合并的基本原理


```
Git合并的本质过程：

1. 找到共同祖先（分支分叉点）
   A---B---C (main)
        \
         D---E (feature)
   
   共同祖先是B

2. 对比三个版本的差异
   - 祖先版本：B
   - 主分支版本：C  
   - 功能分支版本：E

3. 智能合并差异
   - 如果没冲突：自动合并
   - 如果有冲突：需要手动解决
```

---

## 2. 🔄 git merge 基础合并


### 2.1 基本合并命令


**🔸 标准合并语法**
```bash
# 合并指定分支到当前分支
git merge <分支名>

# 实际使用示例
git merge feature-login    # 把feature-login合并到当前分支
git merge origin/main      # 把远程main分支合并到当前分支
```

**📋 完整操作流程**
```bash
# 1. 切换到目标分支（通常是main）
git checkout main

# 2. 拉取最新代码（避免冲突）
git pull origin main

# 3. 合并功能分支
git merge feature-login

# 4. 推送合并结果
git push origin main
```

### 2.2 合并过程详解


**🔍 合并时Git做了什么**：

```
合并前状态检查：
                A---B---C (main) ← 当前所在分支
                 \
                  D---E (feature-login)

执行 git merge feature-login 后：

情况1 - 快进合并（Fast-forward）：
如果main分支没有新提交，直接移动指针
                A---B---D---E (main)

情况2 - 三方合并（3-way merge）：
如果main分支有新提交，创建合并提交
                A---B---C---F (main)
                 \         /
                  D---E----
```

> ⚠️ **注意**：合并总是把其他分支合并到**当前分支**，所以要先切换到正确的分支

### 2.3 合并结果验证


```bash
# 查看合并后的提交历史
git log --oneline --graph

# 检查分支状态
git branch -v

# 验证文件是否正确合并
git status
```

**📊 合并成功的标志**：
- ✅ 没有冲突提示
- ✅ `git status` 显示干净状态
- ✅ 目标分支包含了源分支的所有提交
- ✅ 代码功能正常运行

---

## 3. ⚙️ 合并策略详解


### 3.1 默认合并 vs 禁用快进


**🔸 默认合并行为**
```bash
git merge feature-branch
```

Git会自动选择合并策略：
- **能快进时**：直接移动分支指针（简洁）
- **不能快进时**：创建合并提交（保留历史）

**🔸 禁用快进合并**
```bash
git merge --no-ff feature-branch
```

**强制创建合并提交**，即使可以快进：

```
使用 --no-ff 的效果：
                A---B---C---D (main)
                 \         /
                  E---F---

不使用 --no-ff 的效果：
                A---B---E---F (main)

对比说明：
- --no-ff：能清楚看出曾经有个分支被合并
- 默认：看起来像线性开发，丢失了分支信息
```

> 💡 **建议**：团队开发建议用`--no-ff`，能清楚看到功能开发的完整过程

### 3.2 压缩合并（Squash）


**🔸 什么是压缩合并**
```bash
git merge --squash feature-branch
```

**把多个提交压缩成一个**：

```
原始分支历史：
main:     A---B---C
           \
feature:    D---E---F---G

使用 --squash 后：
main:     A---B---C---H
           \
feature:    D---E---F---G (保持不变)

H提交包含了D、E、F、G的所有改动，但只有一个提交
```

**⚡ 压缩合并的特点**：
- ✅ **历史简洁**：多个小提交变成一个大提交
- ✅ **信息集中**：一个提交说明整个功能
- ❌ **丢失细节**：看不到功能开发的详细过程
- ❌ **需要手动提交**：执行后需要再次`git commit`

```bash
# 压缩合并的完整流程
git merge --squash feature-login
git commit -m "添加用户登录功能"
```

### 3.3 合并策略对比


| 合并方式 | 命令 | 特点 | 适用场景 |
|---------|------|------|----------|
| **默认合并** | `git merge` | 自动选择策略 | 日常开发 |
| **禁用快进** | `git merge --no-ff` | 保留分支历史 | 团队协作，功能开发 |
| **压缩合并** | `git merge --squash` | 简化提交历史 | 实验性分支，临时修复 |

---

## 4. 🗑️ 分支删除操作


### 4.1 安全删除分支


**🔸 删除已合并分支**
```bash
git branch -d feature-login
```

**Git会检查分支是否已合并**：
- ✅ **已合并**：安全删除
- ❌ **未合并**：拒绝删除，保护你的代码

```
删除提示信息解读：

成功删除：
Deleted branch feature-login (was 1a2b3c4).

拒绝删除：
error: The branch 'feature-login' is not fully merged.
If you are sure you want to delete it, run 'git branch -D feature-login'.
```

> 💡 **安全机制**：`-d`是安全删除，防止误删未保存的工作

### 4.2 强制删除分支


**🔸 强制删除命令**
```bash
git branch -D feature-login
```

**⚠️ 使用场景**：
- 实验性分支不需要了
- 功能开发失败，重新开始
- 分支代码有问题，放弃修改

```bash
# 删除前确认分支状态
git branch -v
git log --oneline feature-login

# 确认无误后强制删除
git branch -D feature-login
```

> 🚨 **警告**：强制删除会永久丢失分支上的所有提交，除非你记得提交ID

### 4.3 删除远程分支


**🔸 删除远程分支**
```bash
# 删除远程分支
git push origin --delete feature-login

# 或者使用简化语法
git push origin :feature-login
```

**📋 完整删除流程**：
```bash
# 1. 删除本地分支
git branch -d feature-login

# 2. 删除远程分支  
git push origin --delete feature-login

# 3. 清理远程分支引用
git remote prune origin
```

**🔍 验证删除结果**：
```bash
# 查看本地分支
git branch

# 查看远程分支
git branch -r

# 查看所有分支
git branch -a
```

---

## 5. 🏷️ 分支重命名与查看


### 5.1 分支重命名


**🔸 重命名当前分支**
```bash
git branch -m new-name
```

**🔸 重命名指定分支**
```bash
git branch -m old-name new-name
```

**📋 重命名远程分支流程**：
```bash
# 1. 重命名本地分支
git branch -m old-feature new-feature

# 2. 删除远程旧分支
git push origin --delete old-feature

# 3. 推送新分支名
git push origin new-feature

# 4. 设置上游分支
git push --set-upstream origin new-feature
```

### 5.2 查看分支合并状态


**🔸 查看已合并分支**
```bash
git branch --merged
```

输出示例：
```
  feature-login
* main
  hotfix-bug
```

**含义解释**：
- 列出的分支都已经合并到当前分支
- 可以安全删除（除了当前分支）
- `*`标记表示当前所在分支

**🔸 查看未合并分支**
```bash
git branch --no-merged
```

输出示例：
```
  feature-cart
  experimental
```

**含义解释**：
- 这些分支还有独有的提交
- 删除前需要谨慎考虑
- 可能包含重要的工作成果

### 5.3 批量清理分支


**📋 清理已合并分支脚本**：
```bash
# 删除所有已合并的本地分支（保护main和当前分支）
git branch --merged | grep -v "\*\|main\|master" | xargs -n 1 git branch -d

# 查看清理结果
git branch
```

**🔍 分支状态总览**：
```bash
# 查看分支详细信息
git branch -v

# 查看分支与远程的关系
git branch -vv

# 查看最近的分支活动
git for-each-ref --sort=-committerdate refs/heads/
```

---

## 6. ⚔️ 合并冲突处理


### 6.1 什么是合并冲突


**通俗解释**：两个人同时修改了同一个文件的同一行

```
冲突产生过程：

1. 小明和小红都从main分支创建功能分支
   main: A---B
          \   \
   ming:   C   \
   hong:       D

2. 都修改了同一个文件的同一行
   小明：把"Hello"改成"你好"  
   小红：把"Hello"改成"Hi"

3. 小明先合并成功
   main: A---B---E (包含小明的修改)
          \     /
   ming:   C----

4. 小红合并时发生冲突
   Git不知道该保留"你好"还是"Hi"
```

### 6.2 冲突标记解读


**冲突文件内容示例**：
```
正常内容
<<<<<<< HEAD
你好世界
=======
Hi World  
>>>>>>> feature-hong
其他正常内容
```

**标记含义解释**：
- `<<<<<<< HEAD`：当前分支（你要合并到的分支）的内容
- `=======`：分隔线，分开两个版本
- `>>>>>>> feature-hong`：要合并的分支的内容
- 冲突区域外的内容都是正常的，不用管

### 6.3 解决冲突的步骤


**📋 完整解决流程**：

```bash
# 1. 发现冲突
git merge feature-hong
# Auto-merging hello.txt
# CONFLICT (content): Merge conflict in hello.txt
# Automatic merge failed; fix conflicts and then commit the result.

# 2. 查看冲突文件
git status
# On branch main  
# You have unmerged paths.
# Unmerged paths:
#   (use "git add <file>..." to mark resolution)
#         both modified:   hello.txt

# 3. 手动编辑冲突文件
# 删除冲突标记，保留需要的内容
# 编辑后的文件：
# 正常内容
# 你好世界
# 其他正常内容

# 4. 标记冲突已解决
git add hello.txt

# 5. 完成合并
git commit -m "解决合并冲突：统一使用中文问候语"
```

**🎯 解决冲突的策略**：
- **保留一方**：选择其中一个版本
- **混合使用**：把两个版本的内容都保留
- **重新编写**：写一个全新的版本
- **咨询同事**：不确定时问问原作者

---

## 7. 🎯 最佳实践与技巧


### 7.1 合并前的准备工作


**📋 合并前检查清单**：

```bash
# 1. 确保工作区干净
git status
# 应该显示：nothing to commit, working tree clean

# 2. 切换到目标分支
git checkout main

# 3. 拉取最新代码
git pull origin main

# 4. 查看要合并的分支
git log --oneline feature-branch

# 5. 预览合并效果（不实际合并）
git merge --no-commit --no-ff feature-branch
git diff --cached
git merge --abort  # 取消预览
```

### 7.2 团队合并工作流


**🔸 Feature Branch工作流**：

```
推荐的团队合并流程：

1. 创建功能分支
   git checkout -b feature/user-login

2. 开发功能并提交
   # 开发代码...
   git add .
   git commit -m "实现用户登录功能"

3. 推送到远程
   git push origin feature/user-login

4. 创建Pull Request/Merge Request
   # 在GitHub/GitLab上创建PR

5. 代码审查通过后合并
   git checkout main
   git pull origin main  
   git merge --no-ff feature/user-login
   git push origin main

6. 清理分支
   git branch -d feature/user-login
   git push origin --delete feature/user-login
```

### 7.3 合并策略选择指南


| 场景 | 推荐策略 | 原因 |
|------|----------|------|
| **个人项目** | 默认合并 | 简单快捷 |
| **团队开发** | `--no-ff` | 保留分支历史 |
| **功能发布** | `--no-ff` | 便于版本管理 |
| **实验分支** | `--squash` | 简化历史 |
| **紧急修复** | 默认合并 | 快速修复 |

### 7.4 避免常见错误


**⚠️ 常见错误及解决方案**：

```bash
# 错误1：在错误的分支上合并
# 解决：总是先检查当前分支
git branch  # 查看当前分支
git checkout main  # 切换到正确分支

# 错误2：合并前没有拉取最新代码
# 解决：合并前总是先pull
git pull origin main

# 错误3：合并后忘记删除功能分支
# 解决：建立习惯，合并后立即清理
git branch -d feature-branch

# 错误4：强制删除未合并分支丢失代码
# 解决：删除前确认分支状态
git branch --no-merged  # 查看未合并分支
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本命令


```bash
# 基础合并操作
git merge <branch>           # 合并分支
git merge --no-ff <branch>   # 禁用快进合并
git merge --squash <branch>  # 压缩合并

# 分支删除操作  
git branch -d <branch>       # 安全删除分支
git branch -D <branch>       # 强制删除分支
git push origin --delete <branch>  # 删除远程分支

# 分支查看与管理
git branch --merged          # 查看已合并分支
git branch --no-merged       # 查看未合并分支
git branch -m <new-name>     # 重命名分支
```

### 8.2 关键理解要点


**🔹 合并的本质**：
- 合并是把一个分支的改动应用到另一个分支
- 总是合并到当前分支，所以要先切换分支
- Git会自动处理大部分合并，冲突时需要手动解决

**🔹 合并策略的选择**：
- **默认合并**：日常使用，让Git自动选择
- **--no-ff**：团队开发，保留完整的分支历史
- **--squash**：实验分支，简化提交历史

**🔹 分支删除的安全性**：
- `-d`是安全删除，会检查分支是否已合并
- `-D`是强制删除，会永久丢失未合并的代码
- 删除远程分支需要单独操作

### 8.3 实际应用建议


**📋 新手学习路线**：
1. **先学会基础合并**：`git merge`
2. **掌握冲突解决**：手动编辑冲突文件
3. **学会分支清理**：`git branch -d`
4. **了解合并策略**：`--no-ff`和`--squash`
5. **建立工作流程**：合并前检查，合并后清理

**🎯 团队协作要点**：
- 合并前先pull最新代码
- 使用`--no-ff`保留分支历史
- 及时删除已合并的分支
- 重要分支合并前要代码审查
- 建立统一的分支命名规范

**💡 记忆要点**：
- 合并前：检查分支、拉取代码
- 合并时：选择合适策略、解决冲突
- 合并后：推送代码、清理分支

**核心原则**：合并是为了整合代码，删除是为了保持整洁，重命名是为了规范管理