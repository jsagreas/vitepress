---
title: 26、忽略文件与属性
---
## 📚 目录

1. [什么是忽略文件机制](#1-什么是忽略文件机制)
2. [.gitignore核心用法](#2-gitignore核心用法)
3. [.gitattributes文件属性](#3-gitattributes文件属性)
4. [检查忽略规则](#4-检查忽略规则)
5. [高级忽略策略](#5-高级忽略策略)
6. [全局配置管理](#6-全局配置管理)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🚫 什么是忽略文件机制


### 1.1 为什么需要忽略文件


**现实场景理解**：
```
想象你在整理房间：
✅ 重要文件：证件、合同 → 需要备份保存
❌ 临时垃圾：废纸、包装盒 → 不需要保存

Git项目中也是如此：
✅ 源代码：.java、.py、.js → 需要版本控制
❌ 编译产物：.class、.pyc、node_modules → 不需要版本控制
```

**忽略文件的本质**：
- **核心作用**：告诉Git哪些文件不要追踪管理
- **解决问题**：避免无用文件污染仓库
- **提升效率**：减少仓库体积，加快操作速度

### 1.2 常见需要忽略的文件类型


**编译和构建产物**：
```
Java项目：
target/          ← Maven构建目录
*.class          ← 编译后的字节码
*.jar            ← 打包文件

Python项目：
__pycache__/     ← Python缓存目录  
*.pyc            ← 编译后的Python文件
*.pyo            ← 优化的Python文件

前端项目：
node_modules/    ← npm包依赖目录
dist/            ← 构建输出目录
*.min.js         ← 压缩后的JS文件
```

**系统和IDE文件**：
```
操作系统：
.DS_Store        ← macOS系统文件
Thumbs.db        ← Windows缩略图文件
Desktop.ini      ← Windows文件夹配置

IDE编辑器：
.vscode/         ← VS Code配置
.idea/           ← IntelliJ IDEA配置
*.swp            ← Vim临时文件
```

### 1.3 忽略机制的工作原理


**Git忽略的层次结构**：
```
项目根目录/.gitignore     ← 项目级忽略（最常用）
    ↓
子目录/.gitignore        ← 目录级忽略（就近原则）
    ↓
.git/info/exclude        ← 本地忽略（不共享）
    ↓ 
全局.gitignore           ← 全局忽略（所有项目）
```

> 💡 **理解要点**：Git会从上到下检查这些忽略规则，就近原则优先生效

---

## 2. 📄 .gitignore核心用法


### 2.1 创建和编写.gitignore文件


**文件位置和命名**：
```bash
# 在项目根目录创建（最常见）
touch .gitignore

# 也可以在子目录创建
mkdir src
touch src/.gitignore
```

> 📌 **新手提醒**：文件名就是`.gitignore`，前面的点不能省略，这在Unix系统中表示隐藏文件

### 2.2 基本语法规则


**忽略规则的写法**：
```bash
# 1. 忽略具体文件
config.txt
database.db

# 2. 忽略所有同类型文件（用*通配符）
*.log          # 忽略所有.log文件
*.tmp          # 忽略所有.tmp文件

# 3. 忽略整个目录（用/结尾）
temp/          # 忽略temp目录及其所有内容
logs/          # 忽略logs目录及其所有内容

# 4. 忽略特定路径的文件
/root.txt      # 只忽略根目录的root.txt
src/*.class    # 只忽略src目录下的.class文件
```

**特殊符号含义**：
```bash
*              # 匹配任意字符（除了/）
?              # 匹配单个字符
[abc]          # 匹配括号内任意一个字符
**             # 匹配任意层级目录

# 实际示例
*.log          # 所有.log文件
temp?.*        # temp1.txt, temp2.log等
[Tt]emp/       # Temp/或temp/目录
**/logs/       # 任意层级下的logs目录
```

### 2.3 实用的.gitignore模板


**Java项目模板**：
```bash
# 编译产物
target/
*.class
*.jar
*.war

# IDE文件
.idea/
*.iml
.vscode/

# 系统文件
.DS_Store
Thumbs.db

# 日志文件
*.log
logs/

# 配置文件（包含敏感信息）
application-prod.properties
```

**Node.js项目模板**：
```bash
# 依赖包
node_modules/
npm-debug.log*

# 构建产物
dist/
build/
*.min.js
*.min.css

# 环境配置
.env
.env.local

# 系统文件
.DS_Store
Thumbs.db
```

### 2.4 否定规则（强制包含）


**使用!符号强制包含**：
```bash
# 忽略所有.txt文件
*.txt

# 但是包含重要的说明文件
!README.txt
!LICENSE.txt

# 忽略整个config目录
config/

# 但是包含默认配置
!config/default.conf
```

> ⚠️ **注意事项**：否定规则只对之前的忽略规则有效，顺序很重要！

---

## 3. ⚙️ .gitattributes文件属性


### 3.1 什么是.gitattributes


**文件属性的作用**：
```
.gitignore   → 控制哪些文件被Git管理
.gitattributes → 控制Git如何处理被管理的文件

简单理解：
.gitignore    说："这些文件我不管"
.gitattributes 说："这些文件我要这样管"
```

**核心功能包括**：
- **换行符处理**：统一不同系统的换行符
- **文件合并策略**：指定特殊文件的合并方式
- **二进制文件标识**：标记哪些是二进制文件
- **过滤器配置**：文件内容的自动转换

### 3.2 换行符统一配置


**不同系统的换行符问题**：
```
Windows系统：  CRLF (回车+换行 \r\n)
Linux/Mac：   LF   (换行 \n)

问题：同一文件在不同系统显示不一致
解决：用.gitattributes统一处理
```

**换行符配置示例**：
```bash
# 所有文本文件统一使用LF换行符
* text=auto

# 特定文件类型强制LF
*.js text eol=lf
*.css text eol=lf
*.html text eol=lf

# Windows批处理文件保持CRLF  
*.bat text eol=crlf

# 二进制文件不做转换
*.png binary
*.jpg binary
*.pdf binary
```

### 3.3 文件类型标识配置


**语言检测配置**：
```bash
# 标识文档文件，GitHub统计时忽略
*.md linguist-documentation

# 标识生成的文件，GitHub统计时忽略
dist/* linguist-generated=true
build/* linguist-generated=true

# 标识厂商代码，GitHub统计时忽略  
vendor/* linguist-vendored
third-party/* linguist-vendored

# 强制识别为特定语言
*.jsp linguist-language=Java
```

### 3.4 合并策略配置


**特殊文件的合并处理**：
```bash
# 数据库文件不自动合并
*.db merge=binary

# 配置文件使用特殊合并策略
*.conf merge=ours

# 生成的文件总是使用新版本
CHANGELOG.md merge=ours
```

---

## 4. 🔍 检查忽略规则


### 4.1 git check-ignore命令详解


**基本语法和作用**：
```bash
# 检查单个文件是否被忽略
git check-ignore filename.txt

# 检查多个文件
git check-ignore file1.txt file2.log dir/file3.class

# 显示详细信息（哪个规则匹配）
git check-ignore -v filename.txt
```

**实际使用示例**：
```bash
# 创建测试文件
echo "test" > temp.log
echo "test" > important.txt

# 检查是否被忽略
$ git check-ignore temp.log
temp.log              # 输出文件名表示被忽略

$ git check-ignore important.txt
                      # 无输出表示未被忽略

# 查看详细规则信息
$ git check-ignore -v temp.log
.gitignore:3:*.log    temp.log
#         ↑ ↑    ↑
#      文件:行号:规则   匹配的文件
```

### 4.2 调试忽略规则的技巧


**常见问题排查**：
```bash
# 问题1：文件应该被忽略但没有被忽略
# 检查忽略规则
git check-ignore -v myfile.log

# 如果无输出，说明没有匹配的忽略规则
# 需要检查.gitignore文件是否正确

# 问题2：文件不应该被忽略但被忽略了
# 查看匹配的具体规则
git check-ignore -v myfile.txt
# 输出：.gitignore:5:*.txt    myfile.txt

# 解决：在.gitignore中添加否定规则
echo "!myfile.txt" >> .gitignore
```

**检查目录的忽略状态**：
```bash
# 检查目录下所有文件的忽略状态
git check-ignore src/*

# 递归检查子目录
find . -type f | git check-ignore --stdin
```

---

## 5. 🎯 高级忽略策略


### 5.1 已追踪文件的忽略处理


**常见场景**：文件已经被Git追踪，但现在想忽略它

```bash
# 场景：config.properties已经在仓库中，但包含敏感信息
# 需要停止追踪但保留本地文件

# 方法1：从索引中移除但保留工作目录文件
git rm --cached config.properties
echo "config.properties" >> .gitignore
git commit -m "Stop tracking config.properties"

# 方法2：使用update-index（临时忽略修改）
git update-index --skip-worktree config.properties
```

### 5.2 skip-worktree vs assume-unchanged


**两种忽略修改的方式对比**：

| 特性 | **skip-worktree** | **assume-unchanged** |
|------|------------------|---------------------|
| **用途** | `忽略本地配置修改` | `优化性能，假设文件不变` |
| **场景** | `本地环境配置不同` | `大文件性能优化` |
| **稳定性** | `较稳定，适合长期使用` | `可能被Git操作重置` |
| **推荐度** | `推荐用于配置文件` | `谨慎使用` |

**skip-worktree使用示例**：
```bash
# 标记文件跳过工作树检查
git update-index --skip-worktree config/database.conf

# 查看被跳过的文件
git ls-files -v | grep ^S

# 恢复文件的正常追踪
git update-index --no-skip-worktree config/database.conf
```

**assume-unchanged使用示例**：
```bash
# 假设文件未发生改变（性能优化）
git update-index --assume-unchanged large-file.dat

# 查看被假设未改变的文件  
git ls-files -v | grep ^h

# 恢复文件的正常检查
git update-index --no-assume-unchanged large-file.dat
```

### 5.3 条件忽略和模式匹配


**复杂的忽略模式**：
```bash
# 忽略特定深度的文件
/src/*/*.tmp         # 只忽略src下一级目录的.tmp文件
/src/**/*.tmp        # 忽略src下任意深度的.tmp文件

# 忽略除某些文件外的所有文件
logs/*               # 忽略logs目录下所有内容
!logs/.gitkeep       # 但保留.gitkeep文件
!logs/important.log  # 但保留重要日志

# 基于文件名模式忽略
test_*.py           # 忽略所有test_开头的Python文件
*_backup.*          # 忽略所有_backup结尾的文件
[Tt]emp/            # 忽略Temp或temp目录
```

---

## 6. 🌐 全局配置管理


### 6.1 全局.gitignore配置


**什么是全局忽略**：
```
项目级.gitignore  → 只影响当前项目
全局.gitignore   → 影响所有Git项目

适用场景：
- 系统级别的垃圾文件（.DS_Store）
- 个人编辑器配置文件（.vscode）
- 个人开发工具产生的文件
```

**配置全局忽略文件**：
```bash
# 1. 创建全局忽略文件
touch ~/.gitignore_global

# 2. 配置Git使用全局忽略文件
git config --global core.excludesfile ~/.gitignore_global

# 3. 编辑全局忽略文件
echo ".DS_Store" >> ~/.gitignore_global
echo "Thumbs.db" >> ~/.gitignore_global
echo ".vscode/" >> ~/.gitignore_global
```

**推荐的全局忽略内容**：
```bash
# 系统文件
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db
Desktop.ini

# 编辑器文件
.vscode/
.idea/
*.swp
*.swo
*~

# 临时文件
*.tmp
*.temp
*.bak
```

### 6.2 本地仓库忽略（.git/info/exclude）


**本地私有忽略**：
```bash
# 编辑本地忽略文件（不会被提交到仓库）
vim .git/info/exclude

# 适用场景：
# - 个人调试文件
# - 临时测试脚本  
# - 个人笔记文件
```

**使用场景示例**：
```bash
# .git/info/exclude 文件内容
my-debug.log        # 个人调试日志
test-script.sh      # 个人测试脚本
personal-notes.md   # 个人笔记，不想共享给团队
```

### 6.3 忽略文件的优先级


**Git忽略规则的优先级顺序**：
```
命令行参数 > .gitignore > .git/info/exclude > 全局.gitignore

具体含义：
1. 命令行 -f 强制添加 > 所有忽略规则
2. 项目.gitignore > 本地和全局忽略  
3. 本地.git/info/exclude > 全局忽略
4. 全局.gitignore > 默认行为
```

**实际示例理解**：
```bash
# 全局忽略了*.log
# 但项目.gitignore中有 !important.log
# 结果：important.log不会被忽略

# 项目忽略了temp/
# 但命令行执行 git add -f temp/file.txt  
# 结果：temp/file.txt会被强制添加
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 忽略机制：让Git不追踪指定的文件和目录
🔸 .gitignore：项目级忽略配置，会同步到仓库
🔸 .gitattributes：控制Git如何处理文件（换行符、合并等）
🔸 check-ignore：检查文件是否被忽略及匹配规则
🔸 skip-worktree：忽略已追踪文件的本地修改
🔸 全局忽略：所有项目共享的忽略规则
```

### 7.2 关键理解要点


**🔹 忽略文件的时机选择**
```
项目开始时：创建.gitignore，避免无用文件进入仓库
项目进行中：谨慎处理已追踪文件，使用skip-worktree
个人配置：使用全局忽略或本地exclude
```

**🔹 忽略规则的层次关系**
```
越具体的规则优先级越高：
文件名 > 目录规则 > 通配符规则
项目忽略 > 全局忽略
否定规则 > 普通忽略规则
```

**🔹 .gitattributes的核心价值**
```
解决跨平台问题：统一换行符格式
优化仓库管理：标识文件类型和处理策略
提升协作效率：统一团队的文件处理规范
```

### 7.3 实际应用指导


**🎯 新项目最佳实践**
```bash
# 1. 项目开始就创建.gitignore
touch .gitignore

# 2. 使用现成模板（推荐）
curl https://gitignore.io/api/java,maven,intellij > .gitignore

# 3. 创建.gitattributes统一换行符
echo "* text=auto" > .gitattributes

# 4. 配置全局忽略（一次性设置）
git config --global core.excludesfile ~/.gitignore_global
```

**🔧 常见问题解决方案**
```bash
# 文件已追踪但想忽略
git rm --cached filename
echo "filename" >> .gitignore

# 检查为什么文件被忽略
git check-ignore -v filename

# 暂时忽略配置文件修改
git update-index --skip-worktree config.properties

# 查看所有被特殊处理的文件
git ls-files -v | grep "^[hsmrck?]"
```

### 7.4 学习检验清单


**掌握程度自检**：
- [ ] 能正确编写.gitignore规则
- [ ] 理解忽略规则的优先级和作用范围
- [ ] 会使用check-ignore调试忽略问题
- [ ] 能处理已追踪文件的忽略需求
- [ ] 了解.gitattributes的基本配置
- [ ] 会配置全局忽略和本地忽略

**核心记忆口诀**：
```
忽略文件定规则，通配否定要明确
属性文件管格式，换行合并有策略  
check-ignore查问题，skip-worktree改配置
全局本地分层次，项目优先是原则
```

> 💡 **学习建议**：先掌握基本的.gitignore用法，然后逐步学习高级特性。在实际项目中多练习，遇到问题时用check-ignore命令调试，这样能快速提升理解和应用能力。