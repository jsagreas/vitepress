---
title: 1、储藏功能深度应用
---
## 📚 目录

1. [储藏功能概述](#1-储藏功能概述)
2. [基础储藏操作](#2-基础储藏操作)
3. [储藏栈管理](#3-储藏栈管理)
4. [高级储藏技巧](#4-高级储藏技巧)
5. [实际应用场景](#5-实际应用场景)
6. [最佳实践与注意事项](#6-最佳实践与注意事项)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 储藏功能概述


### 1.1 什么是Git储藏


**💡 简单理解**：
储藏（Stash）就像是你的**临时保险箱**。当你正在写代码写到一半，突然有紧急任务需要处理，但又不想提交半成品代码时，就可以把当前的工作"暂存"起来，等处理完紧急任务再"取出来"继续工作。

**🔸 核心作用**：
```
正在写功能A (未完成)
    ↓ 突然要修复紧急bug
储藏当前工作 
    ↓ 工作区变干净
修复紧急bug → 提交
    ↓ bug修复完成
恢复储藏的工作
    ↓ 继续开发功能A
完成功能A → 提交
```

### 1.2 储藏解决的实际问题


**🎬 真实场景**：
```
你正在开发新功能，代码写了一半：
- 修改了3个文件
- 新增了2个文件  
- 删除了1个文件

这时老板说：生产环境有bug，立即修复！

问题来了：
❌ 提交半成品代码？代码还没写完，不应该提交
❌ 直接切分支？工作区有未提交修改，Git不允许
✅ 使用储藏！把当前工作临时保存，处理完紧急任务再恢复
```

### 1.3 储藏 vs 提交的区别


| 特点 | **储藏 (Stash)** | **提交 (Commit)** |
|------|-----------------|------------------|
| **用途** | `临时保存未完成工作` | `永久记录完成的功能` |
| **代码状态** | `可以是半成品` | `应该是完整功能` |
| **历史记录** | `不进入Git历史` | `成为Git历史一部分` |
| **恢复方式** | `可以随时恢复和删除` | `通过版本回退查看` |
| **使用频率** | `临时使用` | `开发常规操作` |

---

## 2. 🛠️ 基础储藏操作


### 2.1 快速储藏当前工作


**🔸 最基本的储藏命令**
```bash
git stash
```

**📝 实际操作示例**：
```bash
# 当前状态：正在修改文件
$ git status
On branch feature-login
Changes not staged for commit:
  modified:   login.js
  modified:   style.css

# 储藏当前工作
$ git stash
Saved working directory and index state WIP on feature-login: a1b2c3d 上次提交信息

# 工作区变干净了
$ git status
On branch feature-login
nothing to commit, working tree clean
```

> 💡 **新手提示**：`git stash` 会把所有**已跟踪**的修改文件储藏起来，但新创建的文件（未跟踪）不会被储藏。

### 2.2 带消息的储藏


**🔸 为储藏添加说明**
```bash
git stash save "正在开发登录功能，完成了用户验证部分"
```

**为什么要加消息？**
- ✅ 一个月后还能记住储藏的是什么内容
- ✅ 多个储藏时能快速识别
- ✅ 团队协作时别人也能理解

**📋 消息命名建议**：
```bash
# 好的消息示例
git stash save "登录页面：完成表单验证，待添加提交功能"
git stash save "购物车功能：修复计算bug，还需测试边界情况"
git stash save "临时储藏：准备修复生产环境紧急bug"

# 不好的消息示例
git stash save "修改文件"           # 太模糊
git stash save "临时保存"           # 没有具体信息
git stash save "aaa"               # 完全无意义
```

### 2.3 查看储藏内容


**🔸 查看储藏列表**
```bash
git stash list
```

**输出示例**：
```bash
stash@{0}: On feature-login: 登录页面：完成表单验证，待添加提交功能
stash@{1}: On main: 修复首页样式问题
stash@{2}: WIP on develop: a1b2c3d 上次提交的信息
```

**📊 储藏编号说明**：
```
stash@{0} ← 最新的储藏（栈顶）
stash@{1} ← 第二新的储藏
stash@{2} ← 最老的储藏（栈底）
```

**🔸 查看储藏的具体修改**
```bash
# 查看最新储藏的修改内容
git stash show

# 查看指定储藏的修改内容
git stash show stash@{1}

# 查看详细的修改差异
git stash show -p stash@{0}
```

---

## 3. 📚 储藏栈管理


### 3.1 储藏栈的工作原理


**📦 储藏栈结构图**：
```
Git储藏栈 (后进先出 - LIFO)
┌─────────────────────────────┐
│ stash@{0}: 最新储藏          │ ← 栈顶
├─────────────────────────────┤
│ stash@{1}: 第二个储藏        │
├─────────────────────────────┤
│ stash@{2}: 第三个储藏        │
├─────────────────────────────┤
│ stash@{3}: 最老的储藏        │ ← 栈底
└─────────────────────────────┘

入栈：git stash (新储藏进入栈顶)
出栈：git stash pop (从栈顶取出)
```

### 3.2 恢复储藏的两种方式


#### 🔄 方式一：apply（应用但保留）


```bash
# 应用最新的储藏，但储藏还在
git stash apply

# 应用指定的储藏
git stash apply stash@{1}
```

**特点**：
- ✅ 储藏内容会恢复到工作区
- ✅ 储藏本身还保留在储藏栈中
- ✅ 可以多次应用同一个储藏

#### 🔄 方式二：pop（应用并删除）


```bash
# 应用最新储藏，并从储藏栈中删除
git stash pop

# 应用指定储藏，并删除
git stash pop stash@{1}
```

**特点**：
- ✅ 储藏内容会恢复到工作区
- ✅ 储藏会从储藏栈中删除
- ✅ 相当于 `apply + drop` 的组合操作

**🤔 选择哪种方式？**
- **使用 `apply`**：当你不确定储藏是否还需要用到
- **使用 `pop`**：当你确定这个储藏用完就不需要了（推荐）

### 3.3 删除储藏


**🔸 删除指定储藏**
```bash
# 删除最新的储藏
git stash drop

# 删除指定的储藏
git stash drop stash@{1}
```

**🔸 清空所有储藏**
```bash
git stash clear
```

> ⚠️ **重要提醒**：`git stash clear` 会删除所有储藏，无法恢复，使用前要确认！

---

## 4. 🚀 高级储藏技巧


### 4.1 基于储藏创建分支


**🌟 应用场景**：
当你发现储藏的修改和当前分支冲突，或者想要在新分支上继续开发储藏的内容时。

```bash
# 基于储藏创建新分支
git stash branch new-feature-branch stash@{0}
```

**📋 这个命令做了什么**：
```
1. 创建新分支 new-feature-branch
2. 切换到新分支
3. 应用指定的储藏
4. 如果应用成功，删除该储藏
```

**实际操作流程**：
```bash
# 当前在 main 分支，有储藏冲突
$ git stash list
stash@{0}: On main: 开发新功能到一半

# 创建新分支来处理储藏
$ git stash branch feature-new stash@{0}
Switched to a new branch 'feature-new'
On branch feature-new
Changes not staged for commit:
  modified:   newfeature.js
Dropped refs/stash@{0} (a1b2c3d...)

# 现在可以在新分支继续开发
```

### 4.2 部分储藏与选择性储藏


**🔸 只储藏已暂存的修改**
```bash
git stash --keep-index
```

**📝 使用场景**：
```bash
# 有两类修改：完成的功能 + 正在开发的功能
$ git add completed-feature.js    # 暂存完成的功能
$ git stash --keep-index          # 只储藏未暂存的修改

# 现在工作区只有完成的功能，可以提交
$ git commit -m "完成功能A"

# 恢复正在开发的功能继续工作
$ git stash pop
```

**🔸 储藏包括未跟踪文件**
```bash
git stash -u
# 或
git stash --include-untracked
```

**区别说明**：
```bash
# 普通储藏
git stash                 # 只储藏已跟踪的修改文件

# 包含未跟踪文件的储藏  
git stash -u             # 储藏修改文件 + 新创建的文件
```

**🔸 交互式储藏**
```bash
git stash --patch
```

这会让你逐个选择要储藏的修改块：
```bash
# 对每个修改，Git会询问
Stage this hunk [y,n,q,a,d,/,s,e,?]?
y - 储藏这个修改块
n - 不储藏这个修改块  
q - 退出
a - 储藏这个文件的所有修改块
d - 不储藏这个文件的任何修改块
```

---

## 5. 🎬 实际应用场景


### 5.1 场景一：紧急bug修复


**情况描述**：正在开发新功能，突然需要修复生产环境bug

```bash
# 当前状态：正在开发功能A
$ git status
On branch feature-A
Changes not staged for commit:
  modified:   featureA.js
  modified:   style.css

# 1. 储藏当前工作
$ git stash save "功能A开发中：完成了基础框架，待添加业务逻辑"

# 2. 切换到主分支修复bug
$ git checkout main
$ git pull origin main

# 3. 创建bug修复分支
$ git checkout -b bugfix-urgent

# 4. 修复bug并提交
$ vim bugfix.js
$ git add .
$ git commit -m "修复生产环境登录bug"

# 5. 推送并合并
$ git push origin bugfix-urgent
# (在平台上创建Pull Request并合并)

# 6. 回到功能开发
$ git checkout feature-A
$ git stash pop                # 恢复之前的工作
# 继续开发功能A...
```

### 5.2 场景二：分支切换前的保护


**情况描述**：想要切换分支查看别的代码，但当前有未提交修改

```bash
# 当前在feature分支有修改
$ git checkout main
error: Your local changes would be overwritten by checkout.
Please commit your changes or stash them before you switch branches.

# 解决方案：先储藏
$ git stash save "临时储藏：准备切换分支查看main代码"
$ git checkout main
# 查看main分支代码...

# 回到原分支继续工作
$ git checkout feature
$ git stash pop
```

### 5.3 场景三：实验性修改


**情况描述**：想要尝试一个想法，但不确定是否有用

```bash
# 储藏当前稳定状态
$ git stash save "稳定版本：准备实验新的实现方案"

# 进行实验性修改
$ vim experiment.js
# 修改代码，测试新想法...

# 如果实验失败，恢复原状态
$ git checkout .              # 丢弃当前修改
$ git stash pop               # 恢复稳定状态

# 如果实验成功，清理储藏
$ git add .
$ git commit -m "实现新的算法优化"
$ git stash drop stash@{0}    # 删除不需要的储藏
```

### 5.4 场景四：多个并行任务


**情况描述**：同时开发多个功能，需要频繁切换

```bash
# 开发功能A
$ vim featureA.js
$ git stash save "功能A：用户注册模块，完成验证逻辑"

# 切换开发功能B  
$ vim featureB.js
$ git stash save "功能B：支付模块，完成订单生成"

# 切换开发功能C
$ vim featureC.js
$ git stash save "功能C：消息推送，完成模板设计"

# 查看所有储藏
$ git stash list
stash@{0}: On main: 功能C：消息推送，完成模板设计
stash@{1}: On main: 功能B：支付模块，完成订单生成  
stash@{2}: On main: 功能A：用户注册模块，完成验证逻辑

# 继续开发功能A
$ git stash apply stash@{2}   # 恢复功能A的修改
```

---

## 6. ⚠️ 最佳实践与注意事项


### 6.1 储藏命名最佳实践


**✅ 好的命名方式**：
```bash
# 包含功能模块 + 完成状态 + 下一步计划
git stash save "用户管理：完成列表展示，待添加编辑功能"
git stash save "订单系统：修复计算bug，需要添加单元测试"
git stash save "临时储藏：准备切换分支修复生产bug"
```

**❌ 避免的命名方式**：
```bash
git stash save "修改"           # 太模糊
git stash save "临时保存"       # 没有具体信息
git stash save "test"          # 无意义
```

### 6.2 储藏管理技巧


**🔸 定期清理储藏**
```bash
# 每周检查储藏列表
git stash list

# 删除不需要的储藏
git stash drop stash@{2}

# 清理所有过期储藏（谨慎使用）
git stash clear
```

**🔸 储藏数量控制**
- 💡 **建议储藏数量**：不超过5-10个
- 💡 **清理频率**：每周检查一次
- 💡 **命名规范**：使用统一的命名格式

### 6.3 常见问题与解决方案


**❓ 问题1：储藏恢复时有冲突**
```bash
$ git stash pop
Auto-merging file.js
CONFLICT (content): Merge conflict in file.js
```

**解决方案**：
```bash
# 1. 手动解决冲突
vim file.js                    # 编辑文件解决冲突

# 2. 标记冲突已解决
git add file.js

# 3. 储藏不会自动删除，需要手动删除
git stash drop stash@{0}
```

**❓ 问题2：误删储藏如何恢复**
```bash
# 查看储藏的引用日志
git fsck --unreachable | grep commit

# 恢复删除的储藏（需要commit哈希值）
git stash apply <commit-hash>
```

**❓ 问题3：储藏包含敏感信息**
```bash
# 储藏一旦创建就包含完整的修改信息
# 如果包含密码等敏感信息，需要：
git stash drop stash@{0}       # 立即删除
git stash clear                # 或清空所有储藏
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本概念


```
🔸 储藏本质：临时保险箱，保存未完成工作
🔸 储藏栈：后进先出，newest在顶部
🔸 apply vs pop：apply保留储藏，pop删除储藏
🔸 储藏范围：默认只储藏已跟踪文件的修改
🔸 储藏命名：添加有意义的描述信息
```

### 7.2 关键命令速查表


| 命令 | **作用** | **使用场景** |
|------|---------|-------------|
| `git stash` | `快速储藏当前修改` | `紧急情况，无需消息` |
| `git stash save "msg"` | `带消息储藏` | `规范的储藏操作` |
| `git stash list` | `查看储藏列表` | `了解当前储藏状态` |
| `git stash show` | `查看储藏内容` | `确认储藏的修改` |
| `git stash pop` | `应用并删除储藏` | `恢复工作，清理储藏` |
| `git stash apply` | `应用但保留储藏` | `重复使用储藏` |
| `git stash drop` | `删除指定储藏` | `清理不需要的储藏` |
| `git stash clear` | `删除所有储藏` | `彻底清理（谨慎）` |

### 7.3 实际应用价值


**🎯 开发效率提升**：
- **任务切换**：随时保存当前工作，处理紧急任务
- **分支管理**：安全切换分支，不丢失修改
- **实验开发**：保存稳定状态，大胆尝试新想法
- **并行开发**：同时推进多个功能模块

**🔧 工作流程优化**：
- **代码质量**：避免提交半成品代码
- **版本控制**：保持提交历史整洁
- **团队协作**：不影响他人的开发进度
- **风险控制**：随时可以回到安全状态

### 7.4 新手学习建议


**📚 学习步骤**：
1. **掌握基础**：`stash`、`pop`、`list` 三个命令
2. **规范使用**：养成添加消息的习惯
3. **场景练习**：在实际开发中多使用储藏
4. **高级技巧**：学会选择性储藏和分支创建

**⚠️ 注意事项**：
- 储藏不是备份，重要修改要及时提交
- 储藏过多会混乱，要定期清理
- 新文件需要 `-u` 参数才能储藏
- 冲突解决后要手动删除储藏

**💡 实用建议**：
- 紧急情况先储藏，后处理
- 每个储藏都要有清晰的说明
- 不要依赖储藏长期保存代码
- 学会使用 `stash show` 确认内容

**核心记忆**：
- 储藏是临时保险箱，解决工作切换问题
- 操作简单但威力巨大，显著提升开发效率  
- 规范使用储藏，让Git工作流更加顺畅
- 储藏 + 分支 + 提交，构成完整的代码管理体系