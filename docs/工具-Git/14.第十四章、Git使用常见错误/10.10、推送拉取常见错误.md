---
title: 10、推送拉取常见错误
---
## 📚 目录

1. [推送被拒绝错误](#1-推送被拒绝错误)
2. [拉取冲突问题](#2-拉取冲突问题)
3. [强制推送风险](#3-强制推送风险)
4. [网络与性能问题](#4-网络与性能问题)
5. [分支操作错误](#5-分支操作错误)
6. [最佳实践总结](#6-最佳实践总结)

---

## 1. 🚫 推送被拒绝错误


### 1.1 什么是推送被拒绝


**🔸 错误现象**
```
! [rejected]        main -> main (non-fast-forward)
error: failed to push some refs to 'origin'
hint: Updates were rejected because the tip of your current branch is behind
```

**💡 通俗解释**
想象你和同事都在编辑同一份文档：
- 你拿到文档是第3版
- 同事在你之前已经提交了第4版、第5版
- 你基于第3版做的修改想直接变成第6版
- Git说："不行！你得先看看第4、5版发生了什么变化"

### 1.2 为什么会被拒绝


**🔹 根本原因**
```
远程仓库状态：  A---B---C---D---E (最新)
你的本地状态：  A---B---C---X---Y (落后了)

你想推送：     A---B---C---X---Y (强行覆盖D和E)
Git拒绝：      "这样会丢失D和E的改动！"
```

> **⚠️ 核心理解**  
> Git的"non-fast-forward"就是在保护代码安全，防止你的推送意外覆盖掉别人的工作成果

### 1.3 正确的解决方法


**📋 解决步骤：**

**第一步：先拉取最新代码**
```bash
git pull origin main
```

**第二步：处理可能的冲突**
- 如果没有冲突：自动合并成功，继续第三步
- 如果有冲突：解决冲突后提交合并

**第三步：重新推送**
```bash
git push origin main
```

**🔧 实践示例**
```bash
# 情况：推送失败

$ git push origin main
! [rejected] main -> main (non-fast-forward)

# 解决：先拉取

$ git pull origin main
Auto-merging file.txt
Merge made by the 'recursive' strategy.

# 再推送：成功

$ git push origin main
Counting objects: 5, done.
Writing objects: 100% (5/5), 485 bytes | 0 bytes/s, done.
```

### 1.4 预防措施


**⭐ 养成良好习惯**
1. **推送前先拉取**：`git pull` 然后 `git push`
2. **定期同步**：每天开始工作前先 `git pull`
3. **小步提交**：频繁提交小的改动，减少冲突概率

---

## 2. ⚔️ 拉取冲突问题


### 2.1 什么是拉取冲突


**🔸 冲突场景**
当你和同事修改了同一个文件的同一行代码时：

```
同事的修改：  console.log("Hello World");
你的修改：    console.log("你好世界");
Git困惑：     "到底该保留哪个？"
```

### 2.2 冲突文件的样子


**📝 冲突标记解读**
```javascript
function greet() {
<<<<<<< HEAD
    console.log("你好世界");
=======
    console.log("Hello World");
>>>>>>> origin/main
}
```

**💡 标记含义**
- `<<<<<<< HEAD`：你的本地修改开始
- `=======`：分隔线，上面是你的，下面是远程的
- `>>>>>>> origin/main`：远程修改结束

### 2.3 手动解决冲突


**🔧 解决步骤**

**第一步：编辑冲突文件**
```javascript
// 选择保留哪个版本，或者合并两者
function greet() {
    console.log("Hello World - 你好世界");  // 合并版本
}
```

**第二步：添加到暂存区**
```bash
git add 冲突文件名.js
```

**第三步：完成合并提交**
```bash
git commit -m "解决greeting函数的合并冲突"
```

### 2.4 避免自动合并的风险


**⚠️ 自动合并可能带来的问题**

有时候Git能自动合并，但结果可能不是你想要的：

```javascript
// 你的代码
function calculate(a, b) {
    return a + b;
}

// 同事的代码  
function calculate(a, b, c) {  // 加了参数c
    return a + b;
}

// 自动合并结果（可能有问题）
function calculate(a, b, c) {  // 有参数c但没使用
    return a + b;              // 逻辑可能不完整
}
```

> **🎯 最佳实践**  
> 每次拉取后都要测试一下代码，确保自动合并没有破坏功能

---

## 3. ⚡ 强制推送风险


### 3.1 什么是强制推送


**🔸 强制推送命令**
```bash
git push --force origin main        # 危险！
git push --force-with-lease origin main  # 相对安全
```

**💥 强制推送的后果**
```
远程仓库：  A---B---C---D---E
你强制推送： A---B---X---Y
结果：       A---B---X---Y (D和E永远丢失了！)
```

### 3.2 什么时候绝对不能强推


**❌ 危险场景**
- **主分支**：main、master、develop等共享分支
- **多人协作**：其他人也在使用的分支
- **已发布代码**：线上环境使用的版本

**🏠 生活类比**
强制推送就像把别人正在使用的房子推倒重建，会让其他人无家可归！

### 3.3 相对安全的强推方式


**🔒 使用 --force-with-lease**
```bash
# 检查远程是否有新的提交

git push --force-with-lease origin feature-branch
```

**💡 工作原理**
- 检查远程分支是否有你不知道的新提交
- 如果有，拒绝强推并提醒你
- 只在你确实是最新状态时才允许强推

### 3.4 强推后的补救措施


**🚨 如果意外强推了怎么办**

**第一步：立即通知团队**
```
紧急通知：我刚才意外强推了main分支，大家暂停推送！
```

**第二步：查找丢失的提交**
```bash
git reflog                    # 查看操作历史
git reset --hard HEAD@{2}    # 回到强推前的状态
```

**第三步：恢复正确状态**
```bash
git push --force-with-lease origin main  # 恢复被覆盖的提交
```

---

## 4. 🌐 网络与性能问题


### 4.1 推送大文件超时


**🔸 常见错误**
```
error: RPC failed; curl 18 transfer closed with outstanding read data remaining
fatal: The remote end hung up unexpectedly
```

**💡 问题原因**
- 网络不稳定
- 文件太大（超过100MB）
- Git服务器限制

**🔧 解决方案**

**方法一：增加超时时间**
```bash
git config --global http.postBuffer 524288000  # 500MB
git config --global http.lowSpeedLimit 0
git config --global http.lowSpeedTime 999999
```

**方法二：使用Git LFS处理大文件**
```bash
git lfs install
git lfs track "*.zip"    # 追踪大文件类型
git add .gitattributes
git commit -m "Add LFS tracking"
```

### 4.2 网络中断恢复


**📋 恢复步骤**

**第一步：检查推送状态**
```bash
git status                # 查看当前状态
git log --oneline -5      # 查看最近提交
```

**第二步：重新推送**
```bash
git push origin main      # 简单重试
```

**第三步：如果仍有问题**
```bash
git fetch origin          # 先获取最新状态
git status                # 检查是否需要合并
git push origin main      # 再次推送
```

### 4.3 推送到错误分支


**🎯 错误示例**
```bash
# 想推送到feature分支，却推送到了main

git push origin main      # 错误！应该是feature
```

**🔧 紧急处理**

**第一步：立即撤销（如果刚刚推送）**
```bash
git push origin :main                    # 删除远程分支（危险！）
git push origin previous-commit-hash:main  # 恢复到之前状态
```

**第二步：正确推送到目标分支**
```bash
git checkout feature
git push origin feature   # 推送到正确分支
```

> **⚠️ 重要提醒**  
> 删除远程分支会影响所有人，操作前一定要先通知团队！

---

## 5. 🔀 分支操作错误


### 5.1 pull --rebase失败


**🔸 什么是rebase**
简单理解：rebase就是"重新整理提交历史"，让历史看起来更清晰

```
使用merge：
A---B---C---D (main)
     \       \
      X---Y---M (feature merge)

使用rebase：
A---B---C---D---X'---Y' (feature rebase)
```

**💡 rebase的好处**
- 提交历史更线性、清晰
- 避免不必要的合并提交
- 更容易追踪代码变化

### 5.2 rebase冲突处理


**🔧 处理步骤**

**第一步：遇到冲突时**
```bash
git pull --rebase origin main
# 出现冲突信息

CONFLICT (content): Merge conflict in file.js
```

**第二步：解决冲突**
```bash
# 编辑冲突文件，解决冲突标记

git add file.js           # 标记冲突已解决
```

**第三步：继续rebase**
```bash
git rebase --continue     # 继续rebase过程
```

**紧急退出rebase**
```bash
git rebase --abort        # 放弃rebase，回到原始状态
```

### 5.3 混合使用pull策略


**📊 不同pull策略对比**

| 策略 | **命令** | **结果** | **使用场景** |
|------|----------|----------|-------------|
| 🔄 **默认merge** | `git pull` | `产生合并提交` | `团队协作，保留完整历史` |
| 📏 **rebase** | `git pull --rebase` | `线性历史` | `个人分支，追求整洁` |
| 🚫 **仅获取** | `git fetch` | `不自动合并` | `谨慎检查后手动合并` |

**🎯 推荐策略**
```bash
# 设置默认使用rebase

git config --global pull.rebase true

# 或者针对单个项目

git config pull.rebase true
```

---

## 6. 📋 最佳实践总结


### 6.1 推送前检查清单


**✅ 每次推送前的步骤**
1. **检查状态**：`git status` 确认要提交的文件
2. **拉取最新**：`git pull origin main` 获取最新代码
3. **解决冲突**：如有冲突，仔细解决并测试
4. **运行测试**：确保代码功能正常
5. **推送代码**：`git push origin branch-name`

### 6.2 团队协作规范


**🤝 团队约定**
```
📌 分支命名规范：
- feature/用户登录功能
- bugfix/修复登录问题  
- hotfix/紧急修复支付bug

📌 提交信息规范：
- feat: 新增用户注册功能
- fix: 修复密码验证bug
- docs: 更新API文档

📌 推送时机：
- 功能完成且测试通过后推送
- 每天下班前推送当天进度
- 重要修改及时推送备份
```

### 6.3 常用命令速查


**⚡ 快速参考**
```bash
# 查看状态

git status                    # 查看文件状态
git log --oneline -10         # 查看最近10次提交

# 推送拉取

git pull origin main          # 拉取并合并
git pull --rebase origin main # 拉取并rebase
git push origin branch-name   # 推送到指定分支

# 冲突处理

git add .                     # 标记冲突已解决
git commit -m "解决冲突"      # 提交合并
git rebase --continue         # 继续rebase
git rebase --abort            # 放弃rebase

# 紧急情况

git fetch origin              # 仅获取，不合并
git reset --hard HEAD~1       # 撤销上一次提交
git reflog                    # 查看操作历史
```

### 6.4 预防问题的好习惯


**🎯 养成习惯**

> **💡 记忆口诀**  
> "推前拉，拉后测，测完推，推完庆" 
> - 推送前先拉取最新代码
> - 拉取后测试功能是否正常  
> - 测试通过后再推送
> - 推送成功后可以安心了

**🔸 日常工作流**
1. **每天开始**：`git pull` 同步最新代码
2. **开发过程**：频繁 `git add` 和 `git commit`
3. **功能完成**：`git pull` → 解决冲突 → `git push`
4. **遇到问题**：先 `git status` 查看状态，再决定怎么处理

**🔹 关键理解**
- Git的错误信息其实很友好，仔细读提示就能知道怎么解决
- 大部分问题都是因为本地代码和远程代码不同步造成的
- 强制推送是核武器，能不用就不用
- 团队协作最重要的是沟通，遇到问题及时询问有经验的同事

**核心记忆**：
- 推送被拒绝？先拉取再推送
- 出现冲突？仔细看标记，手动解决
- 要强推？三思而后行，通知团队
- 网络问题？检查文件大小，调整配置
- 操作错误？Git有历史记录，可以恢复