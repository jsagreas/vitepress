---
title: 2ã€PromiseåŸºç¡€
---
## ğŸ“š ç›®å½•

1. [Promiseæ˜¯ä»€ä¹ˆ](#1-Promiseæ˜¯ä»€ä¹ˆ)
2. [Promiseçš„ä¸‰ç§çŠ¶æ€](#2-Promiseçš„ä¸‰ç§çŠ¶æ€)
3. [then()æˆåŠŸå¤„ç†](#3-thenæˆåŠŸå¤„ç†)
4. [catch()é”™è¯¯å¤„ç†](#4-catché”™è¯¯å¤„ç†)
5. [finally()æœ€ç»ˆå¤„ç†](#5-finallyæœ€ç»ˆå¤„ç†)
6. [Promise.all()å¹¶è¡Œå¤„ç†](#6-Promiseallå¹¶è¡Œå¤„ç†)
7. [è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜](#7-è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Promiseæ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£

**Promiseå°±åƒæ˜¯ä¸€ä¸ª"æ‰¿è¯º"æˆ–"æ¬ æ¡"**

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
ä½ ç‚¹äº†ä¸€ä»½å¤–å– â†’ å•†å®¶ç»™ä½ ä¸€ä¸ªè®¢å•å·ï¼ˆPromiseï¼‰
è¿™ä¸ªè®¢å•å·æœ‰ä¸‰ç§å¯èƒ½ï¼š
- è¿˜åœ¨åˆ¶ä½œä¸­ï¼ˆpending - ç­‰å¾…ä¸­ï¼‰
- å¤–å–é€åˆ°äº†ï¼ˆfulfilled - æˆåŠŸï¼‰
- åˆ¶ä½œå¤±è´¥äº†ï¼ˆrejected - å¤±è´¥ï¼‰
```

### 1.2 æŠ€æœ¯å®šä¹‰

```javascript
// Promiseæ˜¯å¤„ç†å¼‚æ­¥æ“ä½œçš„å¯¹è±¡
// å®ƒä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰åŠå…¶ç»“æœå€¼

const promise = new Promise((resolve, reject) => {
    // å¼‚æ­¥æ“ä½œ
    setTimeout(() => {
        const success = true;
        if (success) {
            resolve("æ“ä½œæˆåŠŸï¼");  // æˆåŠŸæ—¶è°ƒç”¨
        } else {
            reject("æ“ä½œå¤±è´¥ï¼");   // å¤±è´¥æ—¶è°ƒç”¨
        }
    }, 1000);
});
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦Promise

**è§£å†³å¼‚æ­¥ç¼–ç¨‹çš„ç—›ç‚¹**ï¼š
- âœ… **é¿å…å›è°ƒåœ°ç‹±** - è®©ä»£ç æ›´æ¸…æ™°
- âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†** - é›†ä¸­å¤„ç†å¼‚å¸¸
- âœ… **æ›´å¥½çš„å¯è¯»æ€§** - é“¾å¼è°ƒç”¨æ›´ç›´è§‚

---

## 2. ğŸ“Š Promiseçš„ä¸‰ç§çŠ¶æ€


### 2.1 çŠ¶æ€å›¾ç¤º

```
PromiseçŠ¶æ€æµè½¬ï¼š

pendingï¼ˆç­‰å¾…ä¸­ï¼‰
    â†“
   æ‰§è¡Œå¼‚æ­¥æ“ä½œ
    â†“
resolve() â†’ fulfilledï¼ˆå·²æˆåŠŸï¼‰
    æˆ–
reject()  â†’ rejectedï¼ˆå·²å¤±è´¥ï¼‰

æ³¨æ„ï¼šçŠ¶æ€ä¸€æ—¦æ”¹å˜å°±ä¸èƒ½å†å˜ï¼
```

### 2.2 çŠ¶æ€è¯¦è§£

| çŠ¶æ€ | **å«ä¹‰** | **ç‰¹ç‚¹** | **ä¸‹ä¸€æ­¥** |
|------|---------|---------|-----------|
| ğŸŸ¡ **pending** | `ç­‰å¾…ä¸­` | `åˆå§‹çŠ¶æ€ï¼Œæ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œ` | `å¯ä»¥å˜ä¸ºfulfilledæˆ–rejected` |
| ğŸŸ¢ **fulfilled** | `å·²æˆåŠŸ` | `æ“ä½œæˆåŠŸå®Œæˆï¼Œæœ‰ç»“æœå€¼` | `è§¦å‘.then()æ–¹æ³•` |
| ğŸ”´ **rejected** | `å·²å¤±è´¥` | `æ“ä½œå¤±è´¥ï¼Œæœ‰é”™è¯¯åŸå› ` | `è§¦å‘.catch()æ–¹æ³•` |

### 2.3 çŠ¶æ€ç¤ºä¾‹

```javascript
// æˆåŠŸçš„Promise
const successPromise = new Promise((resolve) => {
    resolve("æˆåŠŸçš„æ•°æ®");
});

// å¤±è´¥çš„Promise  
const failPromise = new Promise((resolve, reject) => {
    reject("å¤±è´¥çš„åŸå› ");
});

// æ£€æŸ¥çŠ¶æ€
console.log(successPromise); // Promise {<fulfilled>: "æˆåŠŸçš„æ•°æ®"}
console.log(failPromise);    // Promise {<rejected>: "å¤±è´¥çš„åŸå› "}
```

---

## 3. âœ… then()æˆåŠŸå¤„ç†


### 3.1 åŸºæœ¬ç”¨æ³•

**`then()`æ–¹æ³•ç”¨æ¥å¤„ç†PromiseæˆåŠŸçš„ç»“æœ**

```javascript
promise.then(æˆåŠŸæ—¶æ‰§è¡Œçš„å‡½æ•°);

// å®é™…ä¾‹å­
const getData = new Promise((resolve) => {
    setTimeout(() => {
        resolve("è·å–åˆ°çš„æ•°æ®");
    }, 1000);
});

getData.then((data) => {
    console.log(data); // "è·å–åˆ°çš„æ•°æ®"
});
```

### 3.2 é“¾å¼è°ƒç”¨

**then()å¯ä»¥è¿ç»­è°ƒç”¨ï¼Œå½¢æˆé“¾æ¡**

```javascript
// æ•°æ®å¤„ç†é“¾æ¡
fetch('/api/user')
    .then(response => response.json())    // è½¬æ¢ä¸ºJSON
    .then(user => user.name)              // æå–å§“å
    .then(name => `Hello, ${name}!`)      // æ ¼å¼åŒ–é—®å€™
    .then(greeting => {
        console.log(greeting); // "Hello, å¼ ä¸‰!"
    });
```

### 3.3 then()çš„ä¸¤ä¸ªå‚æ•°

```javascript
promise.then(
    (result) => {
        // æˆåŠŸæ—¶æ‰§è¡Œ
        console.log("æˆåŠŸ:", result);
    },
    (error) => {
        // å¤±è´¥æ—¶æ‰§è¡Œï¼ˆå¯é€‰ï¼‰
        console.log("å¤±è´¥:", error);
    }
);
```

---

## 4. âŒ catch()é”™è¯¯å¤„ç†


### 4.1 åŸºæœ¬ç”¨æ³•

**`catch()`ä¸“é—¨ç”¨æ¥å¤„ç†Promiseå¤±è´¥çš„æƒ…å†µ**

```javascript
promise.catch(å¤±è´¥æ—¶æ‰§è¡Œçš„å‡½æ•°);

// å®é™…ä¾‹å­
const riskyOperation = new Promise((resolve, reject) => {
    const random = Math.random();
    if (random > 0.5) {
        resolve("æ“ä½œæˆåŠŸ");
    } else {
        reject("æ“ä½œå¤±è´¥");
    }
});

riskyOperation
    .then(result => console.log(result))
    .catch(error => console.log("å‡ºé”™äº†:", error));
```

### 4.2 æ•è·é“¾æ¡ä¸­çš„é”™è¯¯

**catch()èƒ½æ•è·æ•´ä¸ªé“¾æ¡ä¸­ä»»ä½•ä¸€æ­¥çš„é”™è¯¯**

```javascript
fetch('/api/data')
    .then(response => response.json())
    .then(data => data.users)
    .then(users => users[0].name)  // å¦‚æœusersä¸ºç©ºï¼Œè¿™é‡Œä¼šå‡ºé”™
    .catch(error => {
        console.log("é“¾æ¡ä¸­å‡ºç°é”™è¯¯:", error);
        // ç»Ÿä¸€é”™è¯¯å¤„ç†
    });
```

### 4.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

```javascript
// âœ… æ¨èï¼šä½¿ç”¨catchç»Ÿä¸€å¤„ç†é”™è¯¯
getData()
    .then(processData)
    .then(showResult)
    .catch(handleError);

// âŒ ä¸æ¨èï¼šåœ¨æ¯ä¸ªthenä¸­å¤„ç†é”™è¯¯
getData()
    .then(processData, handleError)
    .then(showResult, handleError);
```

---

## 5. ğŸ finally()æœ€ç»ˆå¤„ç†


### 5.1 åŸºæœ¬æ¦‚å¿µ

**`finally()`æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šæ‰§è¡Œ**

```javascript
// å°±åƒtry...catch...finallyä¸€æ ·
promise
    .then(result => console.log("æˆåŠŸ"))
    .catch(error => console.log("å¤±è´¥"))
    .finally(() => console.log("æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œ"));
```

### 5.2 å…¸å‹åº”ç”¨åœºæ™¯

```javascript
// åŠ è½½æ•°æ®æ—¶æ˜¾ç¤ºloading
function loadUserData() {
    showLoading(true);  // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    
    return fetch('/api/user')
        .then(response => response.json())
        .then(user => {
            displayUser(user);
        })
        .catch(error => {
            showError(error);
        })
        .finally(() => {
            showLoading(false);  // æ— è®ºæˆåŠŸå¤±è´¥éƒ½éšè—åŠ è½½åŠ¨ç”»
        });
}
```

### 5.3 finallyçš„ç‰¹ç‚¹

```
ğŸ”¸ ä¸æ¥æ”¶ä»»ä½•å‚æ•°
ğŸ”¸ ä¸æ”¹å˜Promiseçš„å€¼
ğŸ”¸ ä¸»è¦ç”¨äºæ¸…ç†å·¥ä½œ
ğŸ”¸ ES2018æ–°å¢çš„ç‰¹æ€§
```

---

## 6. ğŸš€ Promise.all()å¹¶è¡Œå¤„ç†


### 6.1 åŸºæœ¬æ¦‚å¿µ

**`Promise.all()`è®©å¤šä¸ªå¼‚æ­¥æ“ä½œåŒæ—¶è¿›è¡Œ**

```
ä¸²è¡Œæ‰§è¡Œï¼ˆä¸€ä¸ªæ¥ä¸€ä¸ªï¼‰ï¼š
æ“ä½œA â€”â€”â†’ æ“ä½œB â€”â€”â†’ æ“ä½œC    æ€»æ—¶é—´ï¼š3ç§’

å¹¶è¡Œæ‰§è¡Œï¼ˆåŒæ—¶è¿›è¡Œï¼‰ï¼š
æ“ä½œA â€”â€”â†’ |
æ“ä½œB â€”â€”â†’ | ç»“æœ    æ€»æ—¶é—´ï¼š1ç§’ï¼ˆæœ€æ…¢çš„é‚£ä¸ªï¼‰
æ“ä½œC â€”â€”â†’ |
```

### 6.2 åŸºæœ¬ç”¨æ³•

```javascript
const promise1 = fetch('/api/user');
const promise2 = fetch('/api/posts');
const promise3 = fetch('/api/comments');

Promise.all([promise1, promise2, promise3])
    .then(responses => {
        // æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸæ—¶æ‰§è¡Œ
        const [user, posts, comments] = responses;
        console.log("æ‰€æœ‰æ•°æ®éƒ½è·å–å®Œæˆ");
    })
    .catch(error => {
        // ä»»ä½•ä¸€ä¸ªè¯·æ±‚å¤±è´¥æ—¶æ‰§è¡Œ
        console.log("æœ‰è¯·æ±‚å¤±è´¥äº†:", error);
    });
```

### 6.3 å®é™…åº”ç”¨ç¤ºä¾‹

```javascript
// åŒæ—¶è·å–å¤šä¸ªç”¨æˆ·ä¿¡æ¯
function getAllUsers() {
    const userIds = [1, 2, 3, 4, 5];
    
    const promises = userIds.map(id => 
        fetch(`/api/user/${id}`).then(res => res.json())
    );
    
    return Promise.all(promises)
        .then(users => {
            console.log("è·å–åˆ°æ‰€æœ‰ç”¨æˆ·:", users);
            return users;
        });
}
```

### 6.4 Promise.all()çš„ç‰¹ç‚¹

```
âœ… æ‰€æœ‰Promiseéƒ½æˆåŠŸ â†’ è¿”å›æ‰€æœ‰ç»“æœçš„æ•°ç»„
âŒ ä»»ä½•ä¸€ä¸ªPromiseå¤±è´¥ â†’ ç«‹å³å¤±è´¥
âš¡ å¹¶è¡Œæ‰§è¡Œï¼Œæé«˜æ•ˆç‡
ğŸ“‹ ç»“æœé¡ºåºä¸è¾“å…¥é¡ºåºä¸€è‡´
```

---

## 7. ğŸ”— è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜


### 7.1 å›è°ƒåœ°ç‹±æ˜¯ä»€ä¹ˆ

**å›è°ƒåœ°ç‹±ï¼šå¤šå±‚åµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œä»£ç éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤**

```javascript
// âŒ å›è°ƒåœ°ç‹±ç¤ºä¾‹
getData(function(a) {
    getMoreData(a, function(b) {
        getEvenMoreData(b, function(c) {
            getYetMoreData(c, function(d) {
                // è¿™é‡Œå·²ç»åµŒå¥—4å±‚äº†...
                console.log(d);
            });
        });
    });
});
```

### 7.2 Promiseè§£å†³æ–¹æ¡ˆ

**Promiseè®©å¼‚æ­¥ä»£ç å˜æˆé“¾å¼è°ƒç”¨ï¼Œæ‰å¹³åŒ–å¤„ç†**

```javascript
// âœ… Promiseé“¾å¼è°ƒç”¨
getData()
    .then(a => getMoreData(a))
    .then(b => getEvenMoreData(b))
    .then(c => getYetMoreData(c))
    .then(d => {
        console.log(d);
    })
    .catch(error => {
        console.log("ä»»ä½•ä¸€æ­¥å‡ºé”™éƒ½ä¼šåœ¨è¿™é‡Œå¤„ç†");
    });
```

### 7.3 å¯¹æ¯”æ•ˆæœ

```
å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼š
âŒ ä»£ç å‘å³æ— é™å»¶ä¼¸
âŒ é”™è¯¯å¤„ç†å¤æ‚
âŒ éš¾ä»¥è°ƒè¯•å’Œç»´æŠ¤
âŒ æ— æ³•ç”¨try/catch

Promiseçš„ä¼˜åŠ¿ï¼š
âœ… ä»£ç æ‰å¹³åŒ–ï¼Œæ˜“è¯»
âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
âœ… æ›´å¥½çš„è°ƒè¯•ä½“éªŒ  
âœ… å¯ä»¥é…åˆasync/await
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ
ğŸ”¸ ä¸‰ç§çŠ¶æ€ï¼špending â†’ fulfilled/rejected
ğŸ”¸ çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±ä¸èƒ½å†å˜
ğŸ”¸ then()å¤„ç†æˆåŠŸï¼Œcatch()å¤„ç†å¤±è´¥
ğŸ”¸ finally()æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œ
ğŸ”¸ Promise.all()å¹¶è¡Œå¤„ç†å¤šä¸ªå¼‚æ­¥æ“ä½œ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Promiseçš„æœ¬è´¨**
```
Promiseä¸æ˜¯è®©å¼‚æ­¥å˜åŒæ­¥
è€Œæ˜¯è®©å¼‚æ­¥æ“ä½œæ›´å¥½ç®¡ç†
æä¾›äº†ä¸€ç§æ ‡å‡†çš„å¼‚æ­¥å¤„ç†æ¨¡å¼
```

**ğŸ”¹ é“¾å¼è°ƒç”¨çš„ä»·å€¼**
```
é¿å…å›è°ƒåœ°ç‹± â†’ ä»£ç æ›´æ¸…æ™°
ç»Ÿä¸€é”™è¯¯å¤„ç† â†’ æ›´å®¹æ˜“ç»´æŠ¤
æ ‡å‡†åŒ–å¼‚æ­¥ â†’ æ›´å¥½çš„å¼€å‘ä½“éªŒ
```

**ğŸ”¹ çŠ¶æ€ç®¡ç†çš„é‡è¦æ€§**
```
çŠ¶æ€ä¸å¯é€† â†’ ä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§
æ˜ç¡®çš„çŠ¶æ€ â†’ è®©å¼‚æ­¥æµç¨‹æ›´å¯é¢„æµ‹
æ ‡å‡†åŒ–API â†’ æ‰€æœ‰Promiseéƒ½æœ‰ç›¸åŒæ¥å£
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼

- **ç½‘ç»œè¯·æ±‚**ï¼šfetch APIè¿”å›Promise
- **æ–‡ä»¶æ“ä½œ**ï¼šè¯»å–æ–‡ä»¶ç­‰å¼‚æ­¥æ“ä½œ
- **å®šæ—¶å™¨**ï¼šå¯ä»¥PromiseåŒ–setTimeout
- **ç”¨æˆ·äº¤äº’**ï¼šç­‰å¾…ç”¨æˆ·æ“ä½œå®Œæˆ
- **æ•°æ®å¤„ç†**ï¼šå¼‚æ­¥æ•°æ®è½¬æ¢å’Œå¤„ç†

### 8.4 å¸¸è§ä½¿ç”¨æ¨¡å¼

```javascript
// æ¨¡å¼1ï¼šåŸºç¡€Promiseä½¿ç”¨
someAsyncOperation()
    .then(result => processResult(result))
    .catch(error => handleError(error));

// æ¨¡å¼2ï¼šå¤šæ­¥éª¤å¤„ç†
fetchData()
    .then(data => validateData(data))
    .then(validData => saveData(validData))
    .then(() => showSuccess())
    .catch(error => showError(error));

// æ¨¡å¼3ï¼šå¹¶è¡Œå¤„ç†
Promise.all([request1(), request2(), request3()])
    .then(results => combineResults(results))
    .catch(error => handleError(error));
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Promiseæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„"æ‰¿è¯º"
- ä¸‰çŠ¶æ€ç®¡ç†è®©å¼‚æ­¥æ›´å¯æ§
- é“¾å¼è°ƒç”¨è§£å†³å›è°ƒåœ°ç‹±
- catchç»Ÿä¸€å¤„ç†é”™è¯¯æœ€ä¼˜é›…