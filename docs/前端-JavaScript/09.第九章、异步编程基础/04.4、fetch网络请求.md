---
title: 4ã€fetchç½‘ç»œè¯·æ±‚
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯fetch](#1-ä»€ä¹ˆæ˜¯fetch)
2. [åŸºç¡€GETè¯·æ±‚](#2-åŸºç¡€GETè¯·æ±‚)
3. [POSTè¯·æ±‚å‘é€æ•°æ®](#3-POSTè¯·æ±‚å‘é€æ•°æ®)
4. [å¤„ç†å“åº”æ•°æ®](#4-å¤„ç†å“åº”æ•°æ®)
5. [é”™è¯¯å¤„ç†ç­–ç•¥](#5-é”™è¯¯å¤„ç†ç­–ç•¥)
6. [å®ç”¨å¼€å‘æŠ€å·§](#6-å®ç”¨å¼€å‘æŠ€å·§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ä»€ä¹ˆæ˜¯fetch


### 1.1 fetchçš„æœ¬è´¨


**ç®€å•ç†è§£**ï¼šfetchå°±æ˜¯JavaScriptå‘æœåŠ¡å™¨è¦æ•°æ®æˆ–è€…å‘æ•°æ®çš„æ–¹æ³•

```
æƒ³è±¡ä¸€ä¸‹ï¼š
ä½ åœ¨æ‰‹æœºä¸Šåˆ·å¾®åš â†’ æ‰‹æœºå‘å¾®åšæœåŠ¡å™¨è¦æ–°æ¶ˆæ¯
ä½ å‘ä¸€æ¡æœ‹å‹åœˆ â†’ æ‰‹æœºæŠŠä½ çš„å†…å®¹å‘ç»™å¾®ä¿¡æœåŠ¡å™¨
ä½ æŸ¥å¤©æ°”é¢„æŠ¥ â†’ å¤©æ°”Appå‘å¤©æ°”æœåŠ¡å™¨è¦ä»Šå¤©çš„æ•°æ®

è¿™äº›éƒ½æ˜¯"ç½‘ç»œè¯·æ±‚"ï¼Œfetchå°±æ˜¯åšè¿™ä»¶äº‹çš„å·¥å…·
```

### 1.2 fetchçš„ä¼˜åŠ¿


**ğŸ”¸ ç›¸æ¯”ä¼ ç»ŸXMLHttpRequest**ï¼š
- **è¯­æ³•æ›´ç®€å•** - ä¸ç”¨å†™ä¸€å †å¤æ‚ä»£ç 
- **å¤©ç„¶æ”¯æŒPromise** - é…åˆasync/awaitä½¿ç”¨å¾ˆèˆ’æœ
- **æ›´ç°ä»£** - æ–°æµè§ˆå™¨éƒ½æ”¯æŒï¼Œæ˜¯ä¸»æµå†™æ³•

**ğŸ’¡ åŸºæœ¬è¯­æ³•**ï¼š
```javascript
fetch('ç½‘å€')
  .then(response => response.json())
  .then(data => console.log(data))
```

### 1.3 ä»€ä¹ˆæ—¶å€™ç”¨fetch


**âœ… å¸¸è§ä½¿ç”¨åœºæ™¯**ï¼š
```
ğŸ“± è·å–ç”¨æˆ·ä¿¡æ¯ï¼šä»æœåŠ¡å™¨æ‹¿ç”¨æˆ·èµ„æ–™
ğŸ“Š åŠ è½½åˆ—è¡¨æ•°æ®ï¼šè·å–å•†å“åˆ—è¡¨ã€æ–°é—»åˆ—è¡¨
ğŸ’¾ æäº¤è¡¨å•ï¼šæ³¨å†Œã€ç™»å½•ã€å‘è¯„è®º
ğŸ”„ å®æ—¶æ›´æ–°ï¼šèŠå¤©æ¶ˆæ¯ã€é€šçŸ¥æ¨é€
```

---

## 2. ğŸ“¥ åŸºç¡€GETè¯·æ±‚


### 2.1 GETè¯·æ±‚çš„å«ä¹‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯GET**ï¼š
- **GET = è·å–æ•°æ®** - å°±æ˜¯å‘æœåŠ¡å™¨è¦ä¸œè¥¿
- **åªæ‹¿ä¸ç»™** - ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çš„æ•°æ®
- **æœ€å¸¸ç”¨** - 90%çš„ç½‘ç»œè¯·æ±‚éƒ½æ˜¯GET

### 2.2 æœ€ç®€å•çš„GETè¯·æ±‚


```javascript
// æœ€åŸºç¡€å†™æ³•
fetch('https://api.example.com/users')
  .then(response => response.json())
  .then(data => {
    console.log(data); // æ‹¿åˆ°çš„ç”¨æˆ·åˆ—è¡¨
  });
```

### 2.3 é…åˆasync/awaitä½¿ç”¨


```javascript
// ç°ä»£æ¨èå†™æ³•
async function getUsers() {
  const response = await fetch('https://api.example.com/users');
  const data = await response.json();
  console.log(data);
  return data;
}

// è°ƒç”¨
getUsers();
```

### 2.4 å®é™…ä½¿ç”¨ç¤ºä¾‹


```javascript
// è·å–å¤©æ°”æ•°æ®
async function getWeather(city) {
  const url = `https://api.weather.com/weather?city=${city}`;
  const response = await fetch(url);
  const weatherData = await response.json();
  
  // æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
  document.getElementById('weather').textContent = 
    `${city}ä»Šå¤©${weatherData.temperature}Â°C`;
}

getWeather('åŒ—äº¬');
```

---

## 3. ğŸ“¤ POSTè¯·æ±‚å‘é€æ•°æ®


### 3.1 POSTè¯·æ±‚çš„å«ä¹‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯POST**ï¼š
- **POST = å‘é€æ•°æ®** - æŠŠæ•°æ®ä¼ ç»™æœåŠ¡å™¨
- **ä¼šæ”¹å˜æ•°æ®** - æ¯”å¦‚æ³¨å†Œç”¨æˆ·ã€å‘è¯„è®º
- **éœ€è¦é…ç½®** - è¦å‘Šè¯‰æœåŠ¡å™¨å‘çš„æ˜¯ä»€ä¹ˆæ ¼å¼çš„æ•°æ®

### 3.2 åŸºç¡€POSTè¯­æ³•


```javascript
fetch('ç½‘å€', {
  method: 'POST',        // å£°æ˜æ˜¯POSTè¯·æ±‚
  headers: {             // å‘Šè¯‰æœåŠ¡å™¨æ•°æ®æ ¼å¼
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ // è¦å‘é€çš„æ•°æ®
    name: 'å¼ ä¸‰',
    age: 25
  })
})
```

### 3.3 å‘é€JSONæ•°æ®


```javascript
// ç”¨æˆ·æ³¨å†Œç¤ºä¾‹
async function registerUser(userData) {
  const response = await fetch('https://api.example.com/register', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username: userData.username,
      email: userData.email,
      password: userData.password
    })
  });
  
  const result = await response.json();
  return result;
}

// ä½¿ç”¨
registerUser({
  username: 'zhangsan',
  email: 'zhangsan@qq.com', 
  password: '123456'
});
```

### 3.4 å‘é€è¡¨å•æ•°æ®


```javascript
// ä¸Šä¼ ç”¨æˆ·å¤´åƒ
async function uploadAvatar(formData) {
  const response = await fetch('https://api.example.com/upload', {
    method: 'POST',
    body: formData  // è¡¨å•æ•°æ®ä¸éœ€è¦è®¾ç½®Content-Type
  });
  
  const result = await response.json();
  return result;
}

// ä½¿ç”¨
const form = new FormData();
form.append('avatar', fileInput.files[0]);
uploadAvatar(form);
```

---

## 4. ğŸ“‹ å¤„ç†å“åº”æ•°æ®


### 4.1 å“åº”å¯¹è±¡çš„ç»“æ„


```
æœåŠ¡å™¨è¿”å›çš„responseå¯¹è±¡åŒ…å«ï¼š
â”œâ”€â”€ status: çŠ¶æ€ç  (200æˆåŠŸ, 404æœªæ‰¾åˆ°, 500æœåŠ¡å™¨é”™è¯¯)
â”œâ”€â”€ ok: æ˜¯å¦æˆåŠŸ (true/false)
â”œâ”€â”€ headers: å“åº”å¤´ä¿¡æ¯
â””â”€â”€ body: å®é™…æ•°æ®å†…å®¹
```

### 4.2 æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ


```javascript
async function getData() {
  const response = await fetch('https://api.example.com/data');
  
  // æ£€æŸ¥çŠ¶æ€ç 
  if (!response.ok) {
    throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`);
  }
  
  const data = await response.json();
  return data;
}
```

### 4.3 ä¸åŒæ•°æ®æ ¼å¼çš„å¤„ç†


```javascript
// å¤„ç†JSONæ•°æ® (æœ€å¸¸è§)
const jsonData = await response.json();

// å¤„ç†çº¯æ–‡æœ¬
const textData = await response.text();

// å¤„ç†äºŒè¿›åˆ¶æ•°æ® (å›¾ç‰‡ã€æ–‡ä»¶ç­‰)
const blobData = await response.blob();

// å¤„ç†è¡¨å•æ•°æ®
const formData = await response.formData();
```

### 4.4 å®é™…å¤„ç†ç¤ºä¾‹


```javascript
async function getUserInfo(userId) {
  const response = await fetch(`/api/users/${userId}`);
  
  if (response.ok) {
    const user = await response.json();
    // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
    document.getElementById('username').textContent = user.name;
    document.getElementById('email').textContent = user.email;
  } else {
    // å¤„ç†é”™è¯¯æƒ…å†µ
    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
  }
}
```

---

## 5. âš ï¸ é”™è¯¯å¤„ç†ç­–ç•¥


### 5.1 ç½‘ç»œé”™è¯¯vsæœåŠ¡å™¨é”™è¯¯


**ğŸ”¸ ä¸¤ç§ä¸åŒçš„é”™è¯¯**ï¼š
```
ç½‘ç»œé”™è¯¯ï¼šæ–­ç½‘ã€æœåŠ¡å™¨æŒ‚äº†ã€ç½‘å€å†™é”™
â†’ fetchä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸

æœåŠ¡å™¨é”™è¯¯ï¼š404æ‰¾ä¸åˆ°ã€500å†…éƒ¨é”™è¯¯ã€401æœªæˆæƒ  
â†’ fetchä¸ä¼šæŠ›å¼‚å¸¸ï¼Œä½†response.okä¸ºfalse
```

### 5.2 å®Œæ•´çš„é”™è¯¯å¤„ç†


```javascript
async function safeRequest(url) {
  try {
    const response = await fetch(url);
    
    // æ£€æŸ¥HTTPçŠ¶æ€ç 
    if (!response.ok) {
      throw new Error(`HTTPé”™è¯¯: ${response.status}`);
    }
    
    const data = await response.json();
    return { success: true, data };
    
  } catch (error) {
    console.error('è¯·æ±‚å¤±è´¥:', error.message);
    return { success: false, error: error.message };
  }
}

// ä½¿ç”¨
const result = await safeRequest('/api/data');
if (result.success) {
  console.log('æ•°æ®:', result.data);
} else {
  alert('åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
}
```

### 5.3 å…·ä½“é”™è¯¯å¤„ç†ç¤ºä¾‹


```javascript
async function login(username, password) {
  try {
    const response = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    
    if (response.status === 401) {
      alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
      return;
    }
    
    if (response.status === 429) {
      alert('ç™»å½•æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨åå†è¯•');
      return;
    }
    
    if (!response.ok) {
      alert('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
      return;
    }
    
    const result = await response.json();
    // ç™»å½•æˆåŠŸ
    localStorage.setItem('token', result.token);
    location.href = '/dashboard';
    
  } catch (error) {
    alert('ç½‘ç»œè¿æ¥å¤±è´¥');
  }
}
```

### 5.4 è¶…æ—¶å¤„ç†


```javascript
// è®¾ç½®è¯·æ±‚è¶…æ—¶
function fetchWithTimeout(url, timeout = 5000) {
  return Promise.race([
    fetch(url),
    new Promise((_, reject) => 
      setTimeout(() => reject(new Error('è¯·æ±‚è¶…æ—¶')), timeout)
    )
  ]);
}

// ä½¿ç”¨
try {
  const response = await fetchWithTimeout('/api/data', 3000);
  const data = await response.json();
} catch (error) {
  if (error.message === 'è¯·æ±‚è¶…æ—¶') {
    alert('ç½‘ç»œå¤ªæ…¢äº†ï¼Œè¯·é‡è¯•');
  }
}
```

---

## 6. ğŸ› ï¸ å®ç”¨å¼€å‘æŠ€å·§


### 6.1 è®¾ç½®è¯·æ±‚å¤´ (Headers)


```javascript
// å¸¦è®¤è¯çš„è¯·æ±‚
const token = localStorage.getItem('token');
const response = await fetch('/api/protected', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
});
```

### 6.2 è®¾ç½®è¯·æ±‚è¶…æ—¶


```javascript
// å¸¦è¶…æ—¶çš„fetchå°è£…
async function fetchWithTimeout(url, options = {}, timeout = 5000) {
  const controller = new AbortController();
  
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    throw error;
  }
}
```

### 6.3 è¯·æ±‚é‡è¯•æœºåˆ¶


```javascript
async function fetchWithRetry(url, options = {}, maxRetries = 3) {
  for (let i = 0; i <= maxRetries; i++) {
    try {
      const response = await fetch(url, options);
      if (response.ok) return response;
      
      // å¦‚æœæ˜¯æœ€åä¸€æ¬¡é‡è¯•ï¼ŒæŠ›å‡ºé”™è¯¯
      if (i === maxRetries) {
        throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`);
      }
    } catch (error) {
      if (i === maxRetries) throw error;
      
      // ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

### 6.4 å¸¸ç”¨å·¥å…·å‡½æ•°


```javascript
// é€šç”¨APIè¯·æ±‚å°è£…
class API {
  constructor(baseURL) {
    this.baseURL = baseURL;
  }
  
  async get(endpoint) {
    const response = await fetch(`${this.baseURL}${endpoint}`);
    return this.handleResponse(response);
  }
  
  async post(endpoint, data) {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    return this.handleResponse(response);
  }
  
  async handleResponse(response) {
    if (!response.ok) {
      throw new Error(`APIé”™è¯¯: ${response.status}`);
    }
    return response.json();
  }
}

// ä½¿ç”¨
const api = new API('https://api.example.com');
const users = await api.get('/users');
const newUser = await api.post('/users', { name: 'å¼ ä¸‰' });
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ fetchæœ¬è´¨ï¼šJavaScriptå‘é€ç½‘ç»œè¯·æ±‚çš„ç°ä»£æ–¹æ³•
ğŸ”¸ GETè¯·æ±‚ï¼šè·å–æ•°æ®ï¼Œä¸æ”¹å˜æœåŠ¡å™¨çŠ¶æ€
ğŸ”¸ POSTè¯·æ±‚ï¼šå‘é€æ•°æ®ï¼Œä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€  
ğŸ”¸ å“åº”å¤„ç†ï¼šæ£€æŸ¥statusï¼Œè§£æjson/textç­‰æ ¼å¼
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šç½‘ç»œé”™è¯¯vsæœåŠ¡å™¨é”™è¯¯ï¼Œè¦åˆ†åˆ«å¤„ç†
```

### 7.2 å…³é”®è¯­æ³•æ¨¡å¼


**ğŸ”¹ æ ‡å‡†GETè¯·æ±‚**ï¼š
```javascript
const response = await fetch(url);
const data = await response.json();
```

**ğŸ”¹ æ ‡å‡†POSTè¯·æ±‚**ï¼š
```javascript
const response = await fetch(url, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(data)
});
```

**ğŸ”¹ é”™è¯¯å¤„ç†æ¨¡å¼**ï¼š
```javascript
try {
  const response = await fetch(url);
  if (!response.ok) throw new Error('è¯·æ±‚å¤±è´¥');
  const data = await response.json();
} catch (error) {
  console.error('ç½‘ç»œé”™è¯¯:', error);
}
```

### 7.3 å®é™…å¼€å‘è¦ç‚¹


**ğŸ”¹ å¸¸è§ä½¿ç”¨åœºæ™¯**ï¼š
- **è·å–æ•°æ®** - ç”¨æˆ·ä¿¡æ¯ã€å•†å“åˆ—è¡¨ã€æ–°é—»å†…å®¹
- **æäº¤è¡¨å•** - æ³¨å†Œç™»å½•ã€å‘è¡¨è¯„è®ºã€ä¸Šä¼ æ–‡ä»¶
- **å®æ—¶äº¤äº’** - ç‚¹èµã€æ”¶è—ã€åˆ é™¤æ“ä½œ

**ğŸ”¹ æ³¨æ„äº‹é¡¹**ï¼š
- **æ€»æ˜¯æ£€æŸ¥response.ok** - ä¸è¦å¿½ç•¥é”™è¯¯çŠ¶æ€
- **åˆç†è®¾ç½®è¶…æ—¶** - é¿å…ç”¨æˆ·ç­‰å¤ªä¹…
- **åšå¥½é”™è¯¯æç¤º** - è®©ç”¨æˆ·çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
- **è€ƒè™‘ç½‘ç»œæ…¢çš„æƒ…å†µ** - æ˜¾ç¤ºåŠ è½½çŠ¶æ€

**ğŸ”¹ å¼€å‘å»ºè®®**ï¼š
- **å°è£…å¸¸ç”¨è¯·æ±‚** - é¿å…é‡å¤ä»£ç 
- **ç»Ÿä¸€é”™è¯¯å¤„ç†** - å‡å°‘é‡å¤çš„é”™è¯¯å¤„ç†é€»è¾‘
- **ä½¿ç”¨async/await** - æ¯”.then()æ›´æ¸…æ™°æ˜“è¯»

**æ ¸å¿ƒè®°å¿†**ï¼š
- fetchå‘è¯·æ±‚ï¼ŒGETæ‹¿æ•°æ®ï¼ŒPOSTå‘æ•°æ®
- æ€»æ˜¯æ£€æŸ¥response.okï¼Œå¦¥å–„å¤„ç†é”™è¯¯
- async/awaitè®©å¼‚æ­¥ä»£ç åƒåŒæ­¥ä¸€æ ·æ¸…æ™°