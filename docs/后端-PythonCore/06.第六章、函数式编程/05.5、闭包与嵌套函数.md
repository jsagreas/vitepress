---
title: 5ã€é—­åŒ…ä¸åµŒå¥—å‡½æ•°
---
## ğŸ“š ç›®å½•

1. [åµŒå¥—å‡½æ•°åŸºç¡€æ¦‚å¿µ](#1-åµŒå¥—å‡½æ•°åŸºç¡€æ¦‚å¿µ)
2. [é—­åŒ…æ¦‚å¿µä¸å·¥ä½œåŸç†](#2-é—­åŒ…æ¦‚å¿µä¸å·¥ä½œåŸç†)
3. [é—­åŒ…å˜é‡æ•è·æœºåˆ¶](#3-é—­åŒ…å˜é‡æ•è·æœºåˆ¶)
4. [é—­åŒ…å®é™…åº”ç”¨åœºæ™¯](#4-é—­åŒ…å®é™…åº”ç”¨åœºæ™¯)
5. [é—­åŒ…ä¸è£…é¥°å™¨çš„å…³ç³»](#5-é—­åŒ…ä¸è£…é¥°å™¨çš„å…³ç³»)
6. [é—­åŒ…å†…å­˜ç®¡ç†è€ƒè™‘](#6-é—­åŒ…å†…å­˜ç®¡ç†è€ƒè™‘)
7. [é—­åŒ…è°ƒè¯•æŠ€å·§](#7-é—­åŒ…è°ƒè¯•æŠ€å·§)
8. [é—­åŒ…æœ€ä½³å®è·µ](#8-é—­åŒ…æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ åµŒå¥—å‡½æ•°åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åµŒå¥—å‡½æ•°


**ç®€å•ç†è§£**ï¼šåµŒå¥—å‡½æ•°å°±æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢å†å®šä¹‰å¦ä¸€ä¸ªå‡½æ•°ï¼Œå°±åƒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ã€‚

```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š
å¤–å±‚å‡½æ•° = æˆ¿å­
å†…å±‚å‡½æ•° = æˆ¿é—´
æˆ¿é—´åœ¨æˆ¿å­é‡Œé¢ï¼Œæˆ¿é—´å¯ä»¥ä½¿ç”¨æˆ¿å­çš„è®¾æ–½
```

### 1.2 åµŒå¥—å‡½æ•°çš„åŸºæœ¬è¯­æ³•


```python
def outer_function():  # å¤–å±‚å‡½æ•°ï¼ˆå¤–å±‚æˆ¿å­ï¼‰
    print("æˆ‘æ˜¯å¤–å±‚å‡½æ•°")
    
    def inner_function():  # å†…å±‚å‡½æ•°ï¼ˆå†…å±‚æˆ¿é—´ï¼‰
        print("æˆ‘æ˜¯å†…å±‚å‡½æ•°")
    
    inner_function()  # è°ƒç”¨å†…å±‚å‡½æ•°
    
outer_function()  # è°ƒç”¨å¤–å±‚å‡½æ•°
```

**ğŸ”¸ æ‰§è¡Œç»“æœ**ï¼š
```
æˆ‘æ˜¯å¤–å±‚å‡½æ•°
æˆ‘æ˜¯å†…å±‚å‡½æ•°
```

### 1.3 åµŒå¥—å‡½æ•°çš„ç‰¹ç‚¹


| ç‰¹ç‚¹ | è¯´æ˜ | ç±»æ¯” |
|------|------|------|
| **ä½œç”¨åŸŸé™åˆ¶** | `å†…å±‚å‡½æ•°åªèƒ½åœ¨å¤–å±‚å‡½æ•°å†…éƒ¨è¢«è°ƒç”¨` | `æˆ¿é—´åªèƒ½åœ¨æˆ¿å­å†…éƒ¨è¿›å…¥` |
| **è®¿é—®æƒé™** | `å†…å±‚å‡½æ•°å¯ä»¥è®¿é—®å¤–å±‚å‡½æ•°çš„å˜é‡` | `æˆ¿é—´å¯ä»¥ä½¿ç”¨æˆ¿å­çš„æ°´ç”µ` |
| **ç”Ÿå‘½å‘¨æœŸ** | `å¤–å±‚å‡½æ•°æ‰§è¡Œå®Œï¼Œå†…å±‚å‡½æ•°ä¸€èˆ¬å°±æ¶ˆå¤±äº†` | `æˆ¿å­æ‹†äº†ï¼Œæˆ¿é—´ä¹Ÿæ²¡äº†` |

### 1.4 ä¸ºä»€ä¹ˆè¦ç”¨åµŒå¥—å‡½æ•°


ğŸ¯ **ä¸»è¦ç”¨é€”**ï¼š
- **ä»£ç ç»„ç»‡**ï¼šæŠŠç›¸å…³çš„å°åŠŸèƒ½æ”¾åœ¨ä¸€èµ·
- **é¿å…å‘½åå†²çª**ï¼šå†…å±‚å‡½æ•°åä¸ä¼šå’Œå¤–éƒ¨å†²çª
- **å®ç°é—­åŒ…**ï¼šä¸ºåé¢å­¦ä¹ é—­åŒ…åšå‡†å¤‡
- **åˆ›å»ºç§æœ‰å‡½æ•°**ï¼šå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®å†…å±‚å‡½æ•°

---

## 2. ğŸ” é—­åŒ…æ¦‚å¿µä¸å·¥ä½œåŸç†


### 2.1 ä»€ä¹ˆæ˜¯é—­åŒ…


**é€šä¿—ç†è§£**ï¼šé—­åŒ…å°±æ˜¯ä¸€ä¸ª"è®°å¿†åŠ›å¾ˆå¥½çš„å‡½æ•°"ï¼Œå®ƒèƒ½è®°ä½è‡ªå·±å‡ºç”Ÿæ—¶å‘¨å›´çš„ç¯å¢ƒï¼ˆå˜é‡ï¼‰ï¼Œå³ä½¿ç¦»å¼€äº†å‡ºç”Ÿåœ°ï¼Œä¾ç„¶èƒ½ä½¿ç”¨é‚£äº›å˜é‡ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
é—­åŒ… = ä¸€ä¸ªä»å°é•‡èµ°å‡ºå»çš„äºº
å°é•‡çš„å›å¿† = å¤–å±‚å‡½æ•°çš„å˜é‡
å³ä½¿è¿™ä¸ªäººåˆ°äº†å¤§åŸå¸‚ï¼Œä¾ç„¶è®°å¾—å°é•‡çš„ä¸€åˆ‡
```

### 2.2 é—­åŒ…çš„åŸºæœ¬ç»“æ„


```python
def create_multiplier(factor):  # å¤–å±‚å‡½æ•°
    """åˆ›å»ºä¸€ä¸ªä¹˜æ³•å™¨"""
    
    def multiply(number):  # å†…å±‚å‡½æ•°
        return number * factor  # ä½¿ç”¨å¤–å±‚å‡½æ•°çš„å‚æ•°
    
    return multiply  # è¿”å›å†…å±‚å‡½æ•°ï¼ˆä¸æ˜¯è°ƒç”¨ï¼ï¼‰

# åˆ›å»ºä¸åŒçš„ä¹˜æ³•å™¨
double = create_multiplier(2)  # åˆ›å»ºä¸€ä¸ªä¹˜ä»¥2çš„å‡½æ•°
triple = create_multiplier(3)  # åˆ›å»ºä¸€ä¸ªä¹˜ä»¥3çš„å‡½æ•°

# ä½¿ç”¨é—­åŒ…
print(double(5))  # è¾“å‡º: 10
print(triple(4))  # è¾“å‡º: 12
```

### 2.3 é—­åŒ…çš„å·¥ä½œæµç¨‹


```
é—­åŒ…å·¥ä½œæµç¨‹å›¾ï¼š
å¤–å±‚å‡½æ•°è¢«è°ƒç”¨ â†’ å†…å±‚å‡½æ•°è¢«åˆ›å»º â†’ å¤–å±‚å‡½æ•°æ‰§è¡Œå®Œæ¯• â†’ å†…å±‚å‡½æ•°è¢«è¿”å›
       â†“              â†“              â†“              â†“
  è®¾ç½®ç¯å¢ƒå˜é‡    ç»‘å®šç¯å¢ƒå˜é‡    ç¯å¢ƒå˜é‡è¢«ä¿å­˜   å¯åœ¨å¤–éƒ¨ä½¿ç”¨ç¯å¢ƒå˜é‡
```

**ğŸ”¸ å…³é”®ç†è§£**ï¼š
- å¤–å±‚å‡½æ•°çš„å‚æ•° `factor` è¢«å†…å±‚å‡½æ•° `multiply` "è®°ä½"äº†
- å³ä½¿ `create_multiplier` æ‰§è¡Œå®Œæ¯•ï¼Œ`factor` çš„å€¼ä¾ç„¶è¢«ä¿å­˜
- æ¯æ¬¡è°ƒç”¨ `create_multiplier` éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é—­åŒ…

### 2.4 é—­åŒ…çš„åˆ¤æ–­æ¡ä»¶


âœ… **æ»¡è¶³é—­åŒ…çš„ä¸‰ä¸ªæ¡ä»¶**ï¼š
1. **åµŒå¥—å‡½æ•°**ï¼šå‡½æ•°å†…éƒ¨å®šä¹‰äº†å¦ä¸€ä¸ªå‡½æ•°
2. **å¼•ç”¨å¤–å±‚å˜é‡**ï¼šå†…å±‚å‡½æ•°ä½¿ç”¨äº†å¤–å±‚å‡½æ•°çš„å˜é‡
3. **è¿”å›å†…å±‚å‡½æ•°**ï¼šå¤–å±‚å‡½æ•°è¿”å›äº†å†…å±‚å‡½æ•°å¯¹è±¡

---

## 3. ğŸ£ é—­åŒ…å˜é‡æ•è·æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯å˜é‡æ•è·


**ç®€å•ç†è§£**ï¼šå˜é‡æ•è·å°±æ˜¯å†…å±‚å‡½æ•°"æŠ“ä½"å¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œä¸è®©å®ƒä»¬æ¶ˆå¤±ã€‚

```python
def outer():
    message = "æˆ‘è¢«æ•è·äº†ï¼"  # è¿™ä¸ªå˜é‡ä¼šè¢«æ•è·
    
    def inner():
        print(message)  # å†…å±‚å‡½æ•°æŠ“ä½äº†message
    
    return inner

func = outer()  # outeræ‰§è¡Œå®Œäº†ï¼Œä½†messageè¿˜æ´»ç€
func()  # è¾“å‡º: æˆ‘è¢«æ•è·äº†ï¼
```

### 3.2 ä¸åŒç±»å‹å˜é‡çš„æ•è·


```python
def variable_capture_demo():
    # 1. æ™®é€šå˜é‡æ•è·
    name = "å¼ ä¸‰"
    age = 25
    
    # 2. åˆ—è¡¨å˜é‡æ•è·ï¼ˆå¯å˜å¯¹è±¡ï¼‰
    hobbies = ["è¯»ä¹¦", "æ¸¸æ³³"]
    
    def get_info():
        return f"å§“å: {name}, å¹´é¾„: {age}, çˆ±å¥½: {hobbies}"
    
    def add_hobby(hobby):
        hobbies.append(hobby)  # ä¿®æ”¹è¢«æ•è·çš„åˆ—è¡¨
    
    return get_info, add_hobby

# ä½¿ç”¨ç¤ºä¾‹
info_func, add_func = variable_capture_demo()
print(info_func())  # å§“å: å¼ ä¸‰, å¹´é¾„: 25, çˆ±å¥½: ['è¯»ä¹¦', 'æ¸¸æ³³']

add_func("ç”»ç”»")
print(info_func())  # å§“å: å¼ ä¸‰, å¹´é¾„: 25, çˆ±å¥½: ['è¯»ä¹¦', 'æ¸¸æ³³', 'ç”»ç”»']
```

### 3.3 å˜é‡æ•è·çš„æ—¶æœºé—®é¢˜


âš ï¸ **æ³¨æ„**ï¼šå˜é‡æ˜¯åœ¨é—­åŒ…åˆ›å»ºæ—¶æ•è·çš„ï¼Œä¸æ˜¯åœ¨è°ƒç”¨æ—¶ï¼

```python
def create_functions():
    functions = []
    
    # é”™è¯¯ç¤ºä¾‹ï¼šæ‰€æœ‰å‡½æ•°éƒ½ä¼šè¾“å‡º3
    for i in range(3):
        def func():
            return i  # æ•è·çš„æ˜¯å¾ªç¯ç»“æŸæ—¶çš„iå€¼ï¼ˆ2ï¼‰
        functions.append(func)
    
    return functions

# æµ‹è¯•é”™è¯¯ç¤ºä¾‹
funcs = create_functions()
for f in funcs:
    print(f())  # è¾“å‡º: 2 2 2 ï¼ˆä¸æ˜¯æœŸæœ›çš„ 0 1 2ï¼‰

# æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨å‚æ•°ä¼ é€’
def create_functions_correct():
    functions = []
    
    for i in range(3):
        def func(x=i):  # ç”¨é»˜è®¤å‚æ•°æ•è·å½“å‰çš„iå€¼
            return x
        functions.append(func)
    
    return functions

# æµ‹è¯•æ­£ç¡®ç¤ºä¾‹
funcs = create_functions_correct()
for f in funcs:
    print(f())  # è¾“å‡º: 0 1 2
```

### 3.4 nonlocalå…³é”®å­—


å½“éœ€è¦åœ¨é—­åŒ…ä¸­ä¿®æ”¹å¤–å±‚å‡½æ•°çš„å˜é‡æ—¶ï¼Œéœ€è¦ä½¿ç”¨ `nonlocal` å…³é”®å­—ï¼š

```python
def create_counter():
    count = 0  # å¤–å±‚å˜é‡
    
    def increment():
        nonlocal count  # å£°æ˜è¦ä¿®æ”¹å¤–å±‚å˜é‡
        count += 1
        return count
    
    def decrement():
        nonlocal count
        count -= 1
        return count
    
    def get_count():
        return count  # åªè¯»å–ï¼Œä¸éœ€è¦nonlocal
    
    return increment, decrement, get_count

# ä½¿ç”¨è®¡æ•°å™¨
inc, dec, get = create_counter()
print(inc())  # 1
print(inc())  # 2
print(dec())  # 1
print(get())  # 1
```

---

## 4. ğŸš€ é—­åŒ…å®é™…åº”ç”¨åœºæ™¯


### 4.1 åˆ›å»ºé…ç½®å‡½æ•°


```python
def create_logger(level):
    """æ ¹æ®æ—¥å¿—çº§åˆ«åˆ›å»ºä¸åŒçš„æ—¥å¿—å‡½æ•°"""
    
    def log(message):
        print(f"[{level}] {message}")
    
    return log

# åˆ›å»ºä¸åŒçº§åˆ«çš„æ—¥å¿—å™¨
info_log = create_logger("INFO")
error_log = create_logger("ERROR")
debug_log = create_logger("DEBUG")

# ä½¿ç”¨
info_log("ç”¨æˆ·ç™»å½•æˆåŠŸ")    # [INFO] ç”¨æˆ·ç™»å½•æˆåŠŸ
error_log("æ•°æ®åº“è¿æ¥å¤±è´¥") # [ERROR] æ•°æ®åº“è¿æ¥å¤±è´¥
debug_log("è°ƒè¯•ä¿¡æ¯")      # [DEBUG] è°ƒè¯•ä¿¡æ¯
```

### 4.2 å®ç°æ•°æ®éªŒè¯å™¨


```python
def create_validator(min_length, max_length):
    """åˆ›å»ºå­—ç¬¦ä¸²é•¿åº¦éªŒè¯å™¨"""
    
    def validate(text):
        if len(text) < min_length:
            return False, f"é•¿åº¦ä¸èƒ½å°‘äº{min_length}ä¸ªå­—ç¬¦"
        elif len(text) > max_length:
            return False, f"é•¿åº¦ä¸èƒ½è¶…è¿‡{max_length}ä¸ªå­—ç¬¦"
        else:
            return True, "éªŒè¯é€šè¿‡"
    
    return validate

# åˆ›å»ºä¸åŒçš„éªŒè¯å™¨
password_validator = create_validator(8, 20)  # å¯†ç éªŒè¯å™¨
username_validator = create_validator(3, 15)  # ç”¨æˆ·åéªŒè¯å™¨

# ä½¿ç”¨éªŒè¯å™¨
is_valid, message = password_validator("123")
print(f"å¯†ç éªŒè¯: {is_valid}, {message}")  # False, é•¿åº¦ä¸èƒ½å°‘äº8ä¸ªå­—ç¬¦

is_valid, message = username_validator("å¼ ä¸‰")
print(f"ç”¨æˆ·åéªŒè¯: {is_valid}, {message}")  # True, éªŒè¯é€šè¿‡
```

### 4.3 å®ç°ç¼“å­˜æœºåˆ¶


```python
def create_cache():
    """åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¼“å­˜"""
    cache = {}  # è¢«é—­åŒ…æ•è·çš„ç¼“å­˜å­—å…¸
    
    def get(key):
        return cache.get(key)
    
    def set(key, value):
        cache[key] = value
        print(f"ç¼“å­˜å·²ä¿å­˜: {key} = {value}")
    
    def clear():
        cache.clear()
        print("ç¼“å­˜å·²æ¸…ç©º")
    
    def show_cache():
        print(f"å½“å‰ç¼“å­˜: {cache}")
    
    return get, set, clear, show_cache

# ä½¿ç”¨ç¼“å­˜
get, set, clear, show = create_cache()

set("user1", "å¼ ä¸‰")     # ç¼“å­˜å·²ä¿å­˜: user1 = å¼ ä¸‰
set("user2", "æå››")     # ç¼“å­˜å·²ä¿å­˜: user2 = æå››
show()                  # å½“å‰ç¼“å­˜: {'user1': 'å¼ ä¸‰', 'user2': 'æå››'}
print(get("user1"))     # å¼ ä¸‰
```

### 4.4 å®ç°äº‹ä»¶å¤„ç†å™¨


```python
def create_event_handler():
    """åˆ›å»ºäº‹ä»¶å¤„ç†å™¨"""
    listeners = []  # å­˜å‚¨äº‹ä»¶ç›‘å¬å™¨
    
    def add_listener(callback):
        """æ·»åŠ äº‹ä»¶ç›‘å¬å™¨"""
        listeners.append(callback)
        print(f"å·²æ·»åŠ ç›‘å¬å™¨ï¼Œå½“å‰å…±{len(listeners)}ä¸ª")
    
    def trigger_event(data):
        """è§¦å‘äº‹ä»¶"""
        print(f"è§¦å‘äº‹ä»¶ï¼Œæ•°æ®: {data}")
        for callback in listeners:
            callback(data)
    
    def remove_all_listeners():
        """æ¸…é™¤æ‰€æœ‰ç›‘å¬å™¨"""
        listeners.clear()
        print("å·²æ¸…é™¤æ‰€æœ‰ç›‘å¬å™¨")
    
    return add_listener, trigger_event, remove_all_listeners

# ä½¿ç”¨äº‹ä»¶å¤„ç†å™¨
add, trigger, clear = create_event_handler()

# å®šä¹‰äº‹ä»¶å¤„ç†å‡½æ•°
def on_user_login(user_data):
    print(f"ç”¨æˆ· {user_data['name']} ç™»å½•äº†")

def on_user_activity(user_data):
    print(f"è®°å½•ç”¨æˆ· {user_data['name']} çš„æ´»åŠ¨")

# æ·»åŠ ç›‘å¬å™¨
add(on_user_login)    # å·²æ·»åŠ ç›‘å¬å™¨ï¼Œå½“å‰å…±1ä¸ª
add(on_user_activity) # å·²æ·»åŠ ç›‘å¬å™¨ï¼Œå½“å‰å…±2ä¸ª

# è§¦å‘äº‹ä»¶
trigger({"name": "å¼ ä¸‰", "time": "2025-09-21"})
# è¾“å‡º:
# è§¦å‘äº‹ä»¶ï¼Œæ•°æ®: {'name': 'å¼ ä¸‰', 'time': '2025-09-21'}
# ç”¨æˆ· å¼ ä¸‰ ç™»å½•äº†
# è®°å½•ç”¨æˆ· å¼ ä¸‰ çš„æ´»åŠ¨
```

---

## 5. ğŸ­ é—­åŒ…ä¸è£…é¥°å™¨çš„å…³ç³»


### 5.1 è£…é¥°å™¨å°±æ˜¯é—­åŒ…çš„ç‰¹æ®Šåº”ç”¨


**ç†è§£è¦ç‚¹**ï¼šè£…é¥°å™¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªè¿”å›å‡½æ•°çš„é—­åŒ…ï¼Œç”¨æ¥"è£…é¥°"ï¼ˆå¢å¼ºï¼‰å…¶ä»–å‡½æ•°çš„åŠŸèƒ½ã€‚

```python
def timer_decorator(func):
    """è®¡æ—¶è£…é¥°å™¨ - è¿™å°±æ˜¯ä¸€ä¸ªé—­åŒ…"""
    import time
    
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)  # è°ƒç”¨åŸå‡½æ•°
        end_time = time.time()
        print(f"{func.__name__} æ‰§è¡Œè€—æ—¶: {end_time - start_time:.4f}ç§’")
        return result
    
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨
@timer_decorator
def slow_function():
    import time
    time.sleep(1)
    return "æ‰§è¡Œå®Œæˆ"

result = slow_function()  # slow_function æ‰§è¡Œè€—æ—¶: 1.0012ç§’
```

### 5.2 å¸¦å‚æ•°çš„è£…é¥°å™¨


å¸¦å‚æ•°çš„è£…é¥°å™¨å®é™…ä¸Šæ˜¯"ä¸‰å±‚é—­åŒ…"ï¼š

```python
def repeat(times):
    """é‡å¤æ‰§è¡Œè£…é¥°å™¨ - ä¸‰å±‚é—­åŒ…"""
    def decorator(func):          # ç¬¬äºŒå±‚ï¼šè£…é¥°å™¨å‡½æ•°
        def wrapper(*args, **kwargs):  # ç¬¬ä¸‰å±‚ï¼šåŒ…è£…å‡½æ•°
            results = []
            for i in range(times):     # ä½¿ç”¨æœ€å¤–å±‚çš„å‚æ•°
                result = func(*args, **kwargs)
                results.append(result)
                print(f"ç¬¬{i+1}æ¬¡æ‰§è¡Œ: {result}")
            return results
        return wrapper
    return decorator

# ä½¿ç”¨å¸¦å‚æ•°çš„è£…é¥°å™¨
@repeat(3)  # é‡å¤æ‰§è¡Œ3æ¬¡
def greet(name):
    return f"ä½ å¥½, {name}!"

results = greet("å¼ ä¸‰")
# è¾“å‡º:
# ç¬¬1æ¬¡æ‰§è¡Œ: ä½ å¥½, å¼ ä¸‰!
# ç¬¬2æ¬¡æ‰§è¡Œ: ä½ å¥½, å¼ ä¸‰!
# ç¬¬3æ¬¡æ‰§è¡Œ: ä½ å¥½, å¼ ä¸‰!
```

### 5.3 é—­åŒ…å®ç°çš„ç®€å•è£…é¥°å™¨å·¥å‚


```python
def create_logger_decorator(log_level):
    """åˆ›å»ºæ—¥å¿—è£…é¥°å™¨çš„å·¥å‚å‡½æ•°"""
    
    def decorator(func):
        def wrapper(*args, **kwargs):
            print(f"[{log_level}] å¼€å§‹æ‰§è¡Œ {func.__name__}")
            try:
                result = func(*args, **kwargs)
                print(f"[{log_level}] {func.__name__} æ‰§è¡ŒæˆåŠŸ")
                return result
            except Exception as e:
                print(f"[{log_level}] {func.__name__} æ‰§è¡Œå¤±è´¥: {e}")
                raise
        return wrapper
    return decorator

# åˆ›å»ºä¸åŒçº§åˆ«çš„è£…é¥°å™¨
info_log = create_logger_decorator("INFO")
debug_log = create_logger_decorator("DEBUG")

@info_log
def divide(a, b):
    return a / b

@debug_log  
def multiply(a, b):
    return a * b

# æµ‹è¯•
print(divide(10, 2))  # [INFO] å¼€å§‹æ‰§è¡Œ divide ... [INFO] divide æ‰§è¡ŒæˆåŠŸ ... 5.0
print(multiply(3, 4)) # [DEBUG] å¼€å§‹æ‰§è¡Œ multiply ... [DEBUG] multiply æ‰§è¡ŒæˆåŠŸ ... 12
```

---

## 6. ğŸ’¾ é—­åŒ…å†…å­˜ç®¡ç†è€ƒè™‘


### 6.1 é—­åŒ…çš„å†…å­˜å¼€é”€


**å…³é”®ç†è§£**ï¼šé—­åŒ…ä¼šä¿æŒå¯¹å¤–å±‚å˜é‡çš„å¼•ç”¨ï¼Œè¿™å¯èƒ½å¯¼è‡´å†…å­˜æ— æ³•åŠæ—¶é‡Šæ”¾ã€‚

```python
def memory_demo():
    """æ¼”ç¤ºé—­åŒ…çš„å†…å­˜å ç”¨"""
    large_data = list(range(1000000))  # å¤§é‡æ•°æ®
    
    def get_first():
        return large_data[0]  # åªéœ€è¦ç¬¬ä¸€ä¸ªå…ƒç´ 
    
    def get_last():
        return large_data[-1]  # åªéœ€è¦æœ€åä¸€ä¸ªå…ƒç´ 
    
    # å³ä½¿åªç”¨ä¸€ä¸ªå…ƒç´ ï¼Œæ•´ä¸ªlarge_dataéƒ½è¢«ä¿æŒåœ¨å†…å­˜ä¸­
    return get_first, get_last

# ä¼˜åŒ–ç‰ˆæœ¬ï¼šåªä¿å­˜éœ€è¦çš„æ•°æ®
def memory_optimized():
    """å†…å­˜ä¼˜åŒ–ç‰ˆæœ¬"""
    large_data = list(range(1000000))
    first_element = large_data[0]  # æå–éœ€è¦çš„æ•°æ®
    last_element = large_data[-1]
    # large_dataåœ¨å‡½æ•°ç»“æŸæ—¶å¯ä»¥è¢«åƒåœ¾å›æ”¶
    
    def get_first():
        return first_element
    
    def get_last():
        return last_element
    
    return get_first, get_last
```

### 6.2 é¿å…å¾ªç¯å¼•ç”¨


```python
class DataProcessor:
    def __init__(self, name):
        self.name = name
    
    def create_callback(self):
        """å¯èƒ½å¯¼è‡´å¾ªç¯å¼•ç”¨çš„å†™æ³•"""
        def callback(data):
            # selfå¼•ç”¨äº†å¯¹è±¡ï¼Œå¯¹è±¡åˆå¼•ç”¨äº†callback
            return f"{self.name} å¤„ç†äº† {data}"
        
        self.callback = callback  # å¾ªç¯å¼•ç”¨ï¼
        return callback

# æ›´å¥½çš„å†™æ³•ï¼šé¿å…å°†é—­åŒ…å­˜å‚¨åœ¨å¯¹è±¡ä¸­
class DataProcessor:
    def __init__(self, name):
        self.name = name
    
    def create_callback(self):
        name = self.name  # å¤åˆ¶éœ€è¦çš„å±æ€§
        
        def callback(data):
            return f"{name} å¤„ç†äº† {data}"  # ä¸ç›´æ¥å¼•ç”¨self
        
        return callback  # ä¸å­˜å‚¨åœ¨å¯¹è±¡ä¸­
```

### 6.3 æ£€æŸ¥é—­åŒ…å¼•ç”¨çš„å˜é‡


å¯ä»¥ä½¿ç”¨å†…ç½®å±æ€§æŸ¥çœ‹é—­åŒ…æ•è·äº†å“ªäº›å˜é‡ï¼š

```python
def outer(x, y):
    z = x + y
    
    def inner(a):
        return a + x + z  # ä½¿ç”¨äº†xå’Œzï¼Œä½†æ²¡æœ‰ä½¿ç”¨y
    
    return inner

closure_func = outer(1, 2)

# æŸ¥çœ‹é—­åŒ…æ•è·çš„å˜é‡
print("é—­åŒ…å˜é‡å:", closure_func.__code__.co_freevars)  # ('x', 'z')
print("é—­åŒ…å˜é‡å€¼:", [cell.cell_contents for cell in closure_func.__closure__])  # [1, 3]
```

---

## 7. ğŸ› é—­åŒ…è°ƒè¯•æŠ€å·§


### 7.1 æ‰“å°é—­åŒ…çŠ¶æ€


```python
def create_debug_closure():
    state = {"count": 0, "name": "æµ‹è¯•"}
    
    def increment():
        state["count"] += 1
        print(f"è°ƒè¯•ä¿¡æ¯: count = {state['count']}, name = {state['name']}")
        return state["count"]
    
    def get_state():
        """è·å–é—­åŒ…å½“å‰çŠ¶æ€ï¼Œç”¨äºè°ƒè¯•"""
        return state.copy()
    
    def set_debug_mode(enabled):
        """æ§åˆ¶è°ƒè¯•è¾“å‡º"""
        state["debug"] = enabled
    
    return increment, get_state, set_debug_mode

# è°ƒè¯•ç¤ºä¾‹
inc, get_state, set_debug = create_debug_closure()
print("å½“å‰çŠ¶æ€:", get_state())  # {'count': 0, 'name': 'æµ‹è¯•'}
inc()  # è°ƒè¯•ä¿¡æ¯: count = 1, name = æµ‹è¯•
```

### 7.2 é—­åŒ…çŠ¶æ€æ£€æŸ¥å·¥å…·


```python
def inspect_closure(closure_func):
    """æ£€æŸ¥é—­åŒ…çš„è¯¦ç»†ä¿¡æ¯"""
    if not closure_func.__closure__:
        print("è¿™ä¸æ˜¯ä¸€ä¸ªé—­åŒ…å‡½æ•°")
        return
    
    print(f"å‡½æ•°å: {closure_func.__name__}")
    print(f"æ•è·çš„å˜é‡å: {closure_func.__code__.co_freevars}")
    
    for i, (name, cell) in enumerate(zip(
        closure_func.__code__.co_freevars, 
        closure_func.__closure__
    )):
        try:
            value = cell.cell_contents
            print(f"å˜é‡ {name}: {value} (ç±»å‹: {type(value).__name__})")
        except ValueError:
            print(f"å˜é‡ {name}: <æœªç»‘å®š>")

# ä½¿ç”¨ç¤ºä¾‹
def create_sample_closure():
    name = "æµ‹è¯•"
    count = 42
    items = [1, 2, 3]
    
    def inner():
        return f"{name}: {count}, é¡¹ç›®æ•°: {len(items)}"
    
    return inner

sample = create_sample_closure()
inspect_closure(sample)
# è¾“å‡º:
# å‡½æ•°å: inner
# æ•è·çš„å˜é‡å: ('count', 'items', 'name')
# å˜é‡ count: 42 (ç±»å‹: int)
# å˜é‡ items: [1, 2, 3] (ç±»å‹: list)
# å˜é‡ name: æµ‹è¯• (ç±»å‹: str)
```

### 7.3 è°ƒè¯•é—­åŒ…ä¸­çš„å˜é‡ä¿®æ”¹


```python
def create_tracked_closure():
    """åˆ›å»ºä¸€ä¸ªå¯ä»¥è·Ÿè¸ªå˜é‡å˜åŒ–çš„é—­åŒ…"""
    data = {"value": 0}
    history = []  # è®°å½•å˜åŒ–å†å²
    
    def modify_value(new_value):
        old_value = data["value"]
        data["value"] = new_value
        
        # è®°å½•å˜åŒ–
        change_record = {
            "old": old_value,
            "new": new_value,
            "timestamp": __import__("time").time()
        }
        history.append(change_record)
        print(f"å€¼å·²æ›´æ”¹: {old_value} â†’ {new_value}")
    
    def get_value():
        return data["value"]
    
    def get_history():
        """è·å–å˜åŒ–å†å²ï¼Œç”¨äºè°ƒè¯•"""
        return history.copy()
    
    return modify_value, get_value, get_history

# è°ƒè¯•ä½¿ç”¨
modify, get, history = create_tracked_closure()
modify(10)  # å€¼å·²æ›´æ”¹: 0 â†’ 10
modify(20)  # å€¼å·²æ›´æ”¹: 10 â†’ 20
print("å˜åŒ–å†å²:", history())
```

---

## 8. âœ… é—­åŒ…æœ€ä½³å®è·µ


### 8.1 å‘½åè§„èŒƒ


```python
# âœ… å¥½çš„å‘½å
def create_validator(pattern):
    """åˆ›å»ºéªŒè¯å™¨ - æ¸…æ™°è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°"""
    def validate(text):
        """éªŒè¯æ–‡æœ¬ - æ˜ç¡®è¯´æ˜å†…å±‚å‡½æ•°çš„ä½œç”¨"""
        import re
        return bool(re.match(pattern, text))
    return validate

# âŒ ä¸å¥½çš„å‘½å
def func1(x):
    def func2(y):
        return x + y
    return func2
```

### 8.2 æ–‡æ¡£å­—ç¬¦ä¸²


```python
def create_rate_limiter(max_calls, time_window):
    """
    åˆ›å»ºé™æµå™¨
    
    Args:
        max_calls (int): æ—¶é—´çª—å£å†…å…è®¸çš„æœ€å¤§è°ƒç”¨æ¬¡æ•°
        time_window (int): æ—¶é—´çª—å£é•¿åº¦ï¼ˆç§’ï¼‰
    
    Returns:
        function: é™æµå™¨å‡½æ•°ï¼Œè¿”å›Trueè¡¨ç¤ºå…è®¸è°ƒç”¨ï¼ŒFalseè¡¨ç¤ºè¢«é™æµ
    
    Example:
        limiter = create_rate_limiter(5, 60)  # æ¯åˆ†é’Ÿæœ€å¤š5æ¬¡è°ƒç”¨
        if limiter():
            print("è°ƒç”¨æˆåŠŸ")
        else:
            print("è°ƒç”¨è¢«é™æµ")
    """
    import time
    calls = []
    
    def limiter():
        """æ£€æŸ¥æ˜¯å¦å…è®¸è°ƒç”¨"""
        now = time.time()
        # æ¸…ç†è¿‡æœŸçš„è°ƒç”¨è®°å½•
        calls[:] = [call_time for call_time in calls if now - call_time < time_window]
        
        if len(calls) < max_calls:
            calls.append(now)
            return True
        return False
    
    return limiter
```

### 8.3 é”™è¯¯å¤„ç†


```python
def create_safe_calculator():
    """åˆ›å»ºå®‰å…¨çš„è®¡ç®—å™¨ï¼ŒåŒ…å«é”™è¯¯å¤„ç†"""
    
    def safe_divide(a, b):
        """å®‰å…¨é™¤æ³•"""
        try:
            if b == 0:
                return None, "é™¤æ•°ä¸èƒ½ä¸ºé›¶"
            result = a / b
            return result, None
        except TypeError:
            return None, "å‚æ•°å¿…é¡»æ˜¯æ•°å­—"
        except Exception as e:
            return None, f"è®¡ç®—é”™è¯¯: {str(e)}"
    
    def safe_sqrt(x):
        """å®‰å…¨å¼€æ–¹"""
        try:
            if x < 0:
                return None, "ä¸èƒ½å¯¹è´Ÿæ•°å¼€æ–¹"
            import math
            result = math.sqrt(x)
            return result, None
        except Exception as e:
            return None, f"è®¡ç®—é”™è¯¯: {str(e)}"
    
    return safe_divide, safe_sqrt

# ä½¿ç”¨ç¤ºä¾‹
divide, sqrt = create_safe_calculator()

result, error = divide(10, 0)
if error:
    print(f"é”™è¯¯: {error}")  # é”™è¯¯: é™¤æ•°ä¸èƒ½ä¸ºé›¶
else:
    print(f"ç»“æœ: {result}")
```

### 8.4 æ€§èƒ½è€ƒè™‘


```python
def create_optimized_cache(max_size=100):
    """åˆ›å»ºæœ‰å¤§å°é™åˆ¶çš„ä¼˜åŒ–ç¼“å­˜"""
    cache = {}
    access_order = []  # è®°å½•è®¿é—®é¡ºåºï¼Œç”¨äºLRU
    
    def get(key):
        if key in cache:
            # æ›´æ–°è®¿é—®é¡ºåº
            access_order.remove(key)
            access_order.append(key)
            return cache[key]
        return None
    
    def set(key, value):
        # å¦‚æœç¼“å­˜å·²æ»¡ï¼Œåˆ é™¤æœ€å°‘ä½¿ç”¨çš„é¡¹
        if len(cache) >= max_size and key not in cache:
            oldest_key = access_order.pop(0)
            del cache[oldest_key]
        
        cache[key] = value
        if key in access_order:
            access_order.remove(key)
        access_order.append(key)
    
    def get_stats():
        """è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯"""
        return {
            "size": len(cache),
            "max_size": max_size,
            "usage": f"{len(cache)/max_size*100:.1f}%"
        }
    
    return get, set, get_stats

# æ€§èƒ½æµ‹è¯•
get, set, stats = create_optimized_cache(3)
set("a", 1)
set("b", 2)
set("c", 3)
print(stats())  # {'size': 3, 'max_size': 3, 'usage': '100.0%'}
set("d", 4)     # ä¼šåˆ é™¤æœ€å°‘ä½¿ç”¨çš„"a"
print(stats())  # {'size': 3, 'max_size': 3, 'usage': '100.0%'}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åµŒå¥—å‡½æ•°ï¼šå‡½æ•°å†…å®šä¹‰å‡½æ•°ï¼Œå†…å±‚å¯è®¿é—®å¤–å±‚å˜é‡
ğŸ”¸ é—­åŒ…å®šä¹‰ï¼šå†…å±‚å‡½æ•° + å¤–å±‚å˜é‡ + è¿”å›å†…å±‚å‡½æ•°
ğŸ”¸ å˜é‡æ•è·ï¼šå†…å±‚å‡½æ•°"è®°ä½"å¤–å±‚å˜é‡ï¼Œå³ä½¿å¤–å±‚å‡½æ•°ç»“æŸ
ğŸ”¸ nonlocalï¼šåœ¨é—­åŒ…ä¸­ä¿®æ”¹å¤–å±‚å˜é‡éœ€è¦ä½¿ç”¨æ­¤å…³é”®å­—
ğŸ”¸ å®é™…åº”ç”¨ï¼šé…ç½®å‡½æ•°ã€éªŒè¯å™¨ã€ç¼“å­˜ã€è£…é¥°å™¨ç­‰
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é—­åŒ…çš„æœ¬è´¨**
```
è®°å¿†æœºåˆ¶ï¼š
- é—­åŒ… = å‡½æ•° + ç¯å¢ƒå˜é‡
- ç¯å¢ƒå˜é‡åœ¨é—­åŒ…åˆ›å»ºæ—¶ç¡®å®š
- å³ä½¿å¤–å±‚å‡½æ•°æ¶ˆå¤±ï¼Œç¯å¢ƒå˜é‡ä¾ç„¶å­˜åœ¨

ç±»æ¯”ç†è§£ï¼š
- é—­åŒ…åƒä¸€ä¸ª"éšèº«æºå¸¦è®°å¿†çš„äºº"
- æ— è®ºèµ°åˆ°å“ªé‡Œï¼Œéƒ½è®°å¾—åŸæ¥çš„ç¯å¢ƒ
- å¯ä»¥æ ¹æ®è®°å¿†åšå‡ºä¸åŒçš„ååº”
```

**ğŸ”¹ é—­åŒ… vs å…¨å±€å˜é‡**
```
é—­åŒ…ä¼˜åŠ¿ï¼š
âœ… æ•°æ®å°è£…ï¼šå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®
âœ… é¿å…æ±¡æŸ“ï¼šä¸ä¼šå½±å“å…¨å±€å‘½åç©ºé—´  
âœ… å¤šå®ä¾‹ï¼šå¯ä»¥åˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„é—­åŒ…
âœ… çµæ´»é…ç½®ï¼šæ¯ä¸ªé—­åŒ…å¯ä»¥æœ‰ä¸åŒçš„é…ç½®

å…¨å±€å˜é‡é—®é¢˜ï¼š
âŒ æ˜“è¢«ä¿®æ”¹ï¼šä»»ä½•åœ°æ–¹éƒ½èƒ½æ”¹å˜
âŒ å‘½åå†²çªï¼šå®¹æ˜“ä¸å…¶ä»–ä»£ç å†²çª
âŒ éš¾ä»¥ç»´æŠ¤ï¼šä¸æ¸…æ¥šè°åœ¨ä½¿ç”¨å’Œä¿®æ”¹
```

**ğŸ”¹ é—­åŒ…çš„ä½¿ç”¨æ—¶æœº**
```
é€‚åˆä½¿ç”¨ï¼š
âœ… éœ€è¦"è®°ä½"é…ç½®å‚æ•°
âœ… åˆ›å»ºä¸“ç”¨çš„å·¥å…·å‡½æ•°
âœ… å®ç°ç®€å•çš„çŠ¶æ€ç®¡ç†
âœ… é¿å…å…¨å±€å˜é‡æ±¡æŸ“

ä¸é€‚åˆä½¿ç”¨ï¼š
âŒ ç®€å•çš„ä¸€æ¬¡æ€§è®¡ç®—
âŒ éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†ï¼ˆç”¨ç±»æ›´å¥½ï¼‰
âŒ æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
âŒ åˆå­¦è€…å®¹æ˜“æ··ä¹±çš„å¤æ‚é€»è¾‘
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


- **é…ç½®ç®¡ç†**ï¼šä¸ºä¸åŒç¯å¢ƒåˆ›å»ºä¸“ç”¨çš„å¤„ç†å‡½æ•°
- **å·¥å…·å‡½æ•°**ï¼šæ ¹æ®å‚æ•°ç”Ÿæˆå®šåˆ¶åŒ–çš„å·¥å…·
- **çŠ¶æ€ä¿æŒ**ï¼šåœ¨å‡½æ•°è°ƒç”¨é—´ä¿æŒç®€å•çŠ¶æ€
- **è£…é¥°å™¨å®ç°**ï¼šé—­åŒ…æ˜¯è£…é¥°å™¨çš„åŸºç¡€åŸç†
- **äº‹ä»¶å¤„ç†**ï¼šåˆ›å»ºå¸¦æœ‰ä¸Šä¸‹æ–‡çš„äº‹ä»¶å›è°ƒ
- **ç¼“å­˜æœºåˆ¶**ï¼šå®ç°ç®€å•çš„æ•°æ®ç¼“å­˜åŠŸèƒ½

### 9.4 å­¦ä¹ æ£€éªŒ


ğŸ¯ **æŒæ¡æ ‡å‡†**ï¼š
- [ ] èƒ½ç”¨ç”Ÿæ´»ç±»æ¯”è§£é‡Šé—­åŒ…æ¦‚å¿µ
- [ ] èƒ½è¯†åˆ«ä»£ç ä¸­çš„é—­åŒ…ç»“æ„
- [ ] ç†è§£å˜é‡æ•è·çš„æ—¶æœºå’Œæ–¹å¼
- [ ] ä¼šä½¿ç”¨nonlocalä¿®æ”¹å¤–å±‚å˜é‡
- [ ] èƒ½åº”ç”¨é—­åŒ…è§£å†³å®é™…é—®é¢˜
- [ ] äº†è§£é—­åŒ…çš„å†…å­˜å’Œæ€§èƒ½å½±å“

ğŸ§  **è®°å¿†è¦ç‚¹**ï¼š
- **ç»“æ„**ï¼šå¤–å±‚å‡½æ•°åŒ…å†…å±‚ï¼Œå†…å±‚ç”¨å¤–å±‚å˜é‡ï¼Œå¤–å±‚è¿”å›å†…å±‚
- **æœ¬è´¨**ï¼šå‡½æ•° + ç¯å¢ƒ = é—­åŒ…ï¼Œç¯å¢ƒè¢«æ°¸ä¹…ä¿å­˜
- **åº”ç”¨**ï¼šé…ç½®ã€ç¼“å­˜ã€è£…é¥°å™¨ï¼ŒçŠ¶æ€ç®¡ç†å°å¸®æ‰‹
- **æ³¨æ„**ï¼šå†…å­˜å ç”¨ã€å¾ªç¯å¼•ç”¨ã€è°ƒè¯•å›°éš¾è¦å½“å¿ƒ

**æ ¸å¿ƒè®°å¿†**ï¼š
- é—­åŒ…æ˜¯å¸¦è®°å¿†çš„å‡½æ•°ï¼Œèµ°å“ªéƒ½è®°å¾—å®¶ä¹¡çš„å˜é‡
- ä¸‰è¦ç´ ç¼ºä¸€ä¸å¯ï¼šåµŒå¥—ã€å¼•ç”¨ã€è¿”å›
- å®ç”¨æ€§å¼ºä½†è¦é€‚åº¦ï¼Œç®€å•é—®é¢˜åˆ«å¤æ‚åŒ–