---
title: 10ã€å®¹å™¨åŸºç±»ä¸ç»§æ‰¿
---
## ğŸ“š ç›®å½•

1. [è‡ªå®šä¹‰å®¹å™¨æ¦‚è¿°](#1-è‡ªå®šä¹‰å®¹å™¨æ¦‚è¿°)
2. [UserDictè‡ªå®šä¹‰å­—å…¸åŸºç±»](#2-UserDictè‡ªå®šä¹‰å­—å…¸åŸºç±»)
3. [UserListè‡ªå®šä¹‰åˆ—è¡¨åŸºç±»](#3-UserListè‡ªå®šä¹‰åˆ—è¡¨åŸºç±»)
4. [UserStringè‡ªå®šä¹‰å­—ç¬¦ä¸²åŸºç±»](#4-UserStringè‡ªå®šä¹‰å­—ç¬¦ä¸²åŸºç±»)
5. [å®¹å™¨ç±»å‹è®¾è®¡åŸåˆ™](#5-å®¹å™¨ç±»å‹è®¾è®¡åŸåˆ™)
6. [å®¹å™¨æ–¹æ³•é‡å†™æŠ€å·§](#6-å®¹å™¨æ–¹æ³•é‡å†™æŠ€å·§)
7. [å®¹å™¨æ€§èƒ½ä¼˜åŒ–è€ƒè™‘](#7-å®¹å™¨æ€§èƒ½ä¼˜åŒ–è€ƒè™‘)
8. [å®¹å™¨åè®®å®ç°](#8-å®¹å™¨åè®®å®ç°)
9. [è‡ªå®šä¹‰å®¹å™¨æœ€ä½³å®è·µ](#9-è‡ªå®šä¹‰å®¹å™¨æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è‡ªå®šä¹‰å®¹å™¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰å®¹å™¨


**ğŸ”¸ é€šä¿—ç†è§£**
æƒ³è±¡ä½ è¦å®šåˆ¶ä¸€ä¸ªç‰¹æ®Šçš„æ”¶çº³ç›’ï¼š
- **æ™®é€šæ”¶çº³ç›’**ï¼šå°±æ˜¯Pythonå†…ç½®çš„listã€dictã€str
- **å®šåˆ¶æ”¶çº³ç›’**ï¼šæ ¹æ®ç‰¹æ®Šéœ€æ±‚æ”¹é€ çš„å®¹å™¨
- **æ”¹é€ å·¥å…·**ï¼šcollectionsæ¨¡å—æä¾›çš„UseråŸºç±»

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
æ™®é€šä¹¦åŒ… â†’ liståˆ—è¡¨
å®šåˆ¶ä¹¦åŒ… â†’ ç»§æ‰¿UserListï¼Œæ·»åŠ ç‰¹æ®ŠåŠŸèƒ½
æ¯”å¦‚ï¼šè‡ªåŠ¨åˆ†ç±»ä¹¦æœ¬ã€é™åˆ¶é‡é‡ã€é˜²æ°´ç­‰åŠŸèƒ½
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å®¹å™¨**
```
å®é™…éœ€æ±‚ï¼š
â€¢ éœ€è¦ç»™å­—å…¸æ·»åŠ é»˜è®¤å€¼å¤„ç†
â€¢ éœ€è¦è®©åˆ—è¡¨æ”¯æŒè‡ªåŠ¨æ’åº
â€¢ éœ€è¦ç»™å­—ç¬¦ä¸²æ·»åŠ ç‰¹æ®Šæ ¼å¼åŒ–
â€¢ éœ€è¦æ·»åŠ æ•°æ®éªŒè¯åŠŸèƒ½
â€¢ éœ€è¦è®°å½•æ“ä½œå†å²

ä¼ ç»Ÿæ–¹æ¡ˆé—®é¢˜ï¼š
â€¢ ç›´æ¥ç»§æ‰¿dict/list/stræ¯”è¾ƒå¤æ‚
â€¢ éœ€è¦å®ç°å¾ˆå¤šåº•å±‚é­”æ³•æ–¹æ³•
â€¢ å®¹æ˜“å‡ºé”™ï¼Œä¸å¥½ç»´æŠ¤

UseråŸºç±»ä¼˜åŠ¿ï¼š
â€¢ ç®€åŒ–ç»§æ‰¿è¿‡ç¨‹
â€¢ æä¾›æ ‡å‡†å®ç°
â€¢ ä¸“æ³¨ä¸šåŠ¡é€»è¾‘
```

### 1.2 collections.UseråŸºç±»å®¶æ—


**ğŸ“‹ ä¸‰å¤§åŸºç±»å¯¹æ¯”**

| åŸºç±» | **ç»§æ‰¿ç›®æ ‡** | **ä¸»è¦ç”¨é€”** | **æ ¸å¿ƒç‰¹ç‚¹** |
|------|-------------|-------------|-------------|
| ğŸ”¸ **UserDict** | `å­—å…¸dict` | `è‡ªå®šä¹‰å­—å…¸è¡Œä¸º` | `dataå±æ€§å­˜å‚¨å®é™…å­—å…¸` |
| ğŸ”¸ **UserList** | `åˆ—è¡¨list` | `è‡ªå®šä¹‰åˆ—è¡¨è¡Œä¸º` | `dataå±æ€§å­˜å‚¨å®é™…åˆ—è¡¨` |
| ğŸ”¸ **UserString** | `å­—ç¬¦ä¸²str` | `è‡ªå®šä¹‰å­—ç¬¦ä¸²è¡Œä¸º` | `dataå±æ€§å­˜å‚¨å®é™…å­—ç¬¦ä¸²` |

**ğŸ’¡ æ ¸å¿ƒè®¾è®¡æ€æƒ³**
```
è®¾è®¡æ¨¡å¼ï¼šè£…é¥°å™¨æ¨¡å¼ + å§”æ‰˜æ¨¡å¼
å·¥ä½œåŸç†ï¼š
1. UseråŸºç±»åŒ…è£…åŸå§‹ç±»å‹
2. å¯¹å¤–æä¾›å®Œæ•´æ¥å£
3. å†…éƒ¨å§”æ‰˜ç»™dataå±æ€§
4. å¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘
```

---

## 2. ğŸ“– UserDictè‡ªå®šä¹‰å­—å…¸åŸºç±»


### 2.1 UserDictåŸºæœ¬ä½¿ç”¨


**ğŸ”¸ æœ€ç®€å•çš„ä¾‹å­**

```python
from collections import UserDict

# åˆ›å»ºä¸€ä¸ªä¼šè‡ªåŠ¨è½¬æ¢é”®ä¸ºå¤§å†™çš„å­—å…¸
class UpperKeyDict(UserDict):
    def __setitem__(self, key, value):
        # é‡å†™è®¾ç½®é¡¹çš„æ–¹æ³•
        super().__setitem__(key.upper(), value)
    
    def __getitem__(self, key):
        # é‡å†™è·å–é¡¹çš„æ–¹æ³•
        return super().__getitem__(key.upper())

# ä½¿ç”¨ç¤ºä¾‹
my_dict = UpperKeyDict()
my_dict['name'] = 'Alice'      # å†…éƒ¨å­˜å‚¨ä¸º 'NAME': 'Alice'
my_dict['age'] = 25            # å†…éƒ¨å­˜å‚¨ä¸º 'AGE': 25

print(my_dict['name'])         # è¾“å‡º: Alice
print(my_dict.data)           # è¾“å‡º: {'NAME': 'Alice', 'AGE': 25}
```

**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒä¸€ä¸ªæ™ºèƒ½æ–‡ä»¶æŸœï¼š
â€¢ ä½ æ”¾å…¥æ–‡ä»¶æ—¶ï¼Œè‡ªåŠ¨æŠŠæ ‡ç­¾æ”¹æˆå¤§å†™
â€¢ ä½ æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œä¸ç®¡è¾“å…¥å¤§å°å†™éƒ½èƒ½æ‰¾åˆ°
â€¢ å†…éƒ¨ç»Ÿä¸€ç®¡ç†ï¼Œå¤–éƒ¨ä½¿ç”¨æ–¹ä¾¿
```

### 2.2 UserDicté«˜çº§åº”ç”¨


**ğŸ”¸ å¸¦é»˜è®¤å€¼çš„æ™ºèƒ½å­—å…¸**

```python
class SmartDict(UserDict):
    def __init__(self, default_factory=None, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.default_factory = default_factory
    
    def __getitem__(self, key):
        try:
            return super().__getitem__(key)
        except KeyError:
            if self.default_factory:
                # å¦‚æœé”®ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å€¼å·¥å‚å‡½æ•°
                value = self.default_factory()
                self[key] = value
                return value
            raise
    
    def __missing__(self, key):
        # å½“é”®ä¸å­˜åœ¨æ—¶è°ƒç”¨
        if self.default_factory:
            return self.default_factory()
        raise KeyError(key)

# ä½¿ç”¨ç¤ºä¾‹
counter = SmartDict(int)  # é»˜è®¤å€¼ä¸º0
counter['apple'] += 1     # è‡ªåŠ¨åˆ›å»ºå¹¶è®¾ä¸º1
counter['banana'] += 5    # è‡ªåŠ¨åˆ›å»ºå¹¶è®¾ä¸º5
print(counter.data)       # {'apple': 1, 'banana': 5}

student_grades = SmartDict(list)  # é»˜è®¤å€¼ä¸ºç©ºåˆ—è¡¨
student_grades['å¼ ä¸‰'].append(85)
student_grades['å¼ ä¸‰'].append(92)
print(student_grades.data)        # {'å¼ ä¸‰': [85, 92]}
```

**ğŸ”¸ è®°å½•æ“ä½œå†å²çš„å­—å…¸**

```python
class TrackedDict(UserDict):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.history = []  # è®°å½•æ‰€æœ‰æ“ä½œ
    
    def __setitem__(self, key, value):
        old_value = self.data.get(key, '<ä¸å­˜åœ¨>')
        super().__setitem__(key, value)
        self.history.append(f"è®¾ç½® {key}: {old_value} â†’ {value}")
    
    def __delitem__(self, key):
        old_value = self.data[key]
        super().__delitem__(key)
        self.history.append(f"åˆ é™¤ {key}: {old_value}")
    
    def show_history(self):
        print("æ“ä½œå†å²:")
        for i, action in enumerate(self.history, 1):
            print(f"{i}. {action}")

# ä½¿ç”¨ç¤ºä¾‹
tracked = TrackedDict()
tracked['name'] = 'Alice'
tracked['age'] = 25
tracked['name'] = 'Bob'
del tracked['age']

tracked.show_history()
# è¾“å‡º:
# æ“ä½œå†å²:
# 1. è®¾ç½® name: <ä¸å­˜åœ¨> â†’ Alice
# 2. è®¾ç½® age: <ä¸å­˜åœ¨> â†’ 25
# 3. è®¾ç½® name: Alice â†’ Bob
# 4. åˆ é™¤ age: 25
```

---

## 3. ğŸ“ UserListè‡ªå®šä¹‰åˆ—è¡¨åŸºç±»


### 3.1 UserListåŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ è‡ªåŠ¨æ’åºåˆ—è¡¨**

```python
from collections import UserList

class SortedList(UserList):
    def __init__(self, iterable=None):
        super().__init__(iterable)
        self.data.sort()  # åˆå§‹åŒ–æ—¶æ’åº
    
    def append(self, item):
        super().append(item)
        self.data.sort()  # æ·»åŠ åé‡æ–°æ’åº
    
    def extend(self, items):
        super().extend(items)
        self.data.sort()  # æ‰©å±•åé‡æ–°æ’åº
    
    def insert(self, index, item):
        # é‡å†™insertï¼Œå¿½ç•¥indexå‚æ•°ï¼Œç›´æ¥æ·»åŠ å¹¶æ’åº
        self.append(item)

# ä½¿ç”¨ç¤ºä¾‹
sorted_numbers = SortedList([3, 1, 4, 1, 5])
print(sorted_numbers.data)    # [1, 1, 3, 4, 5]

sorted_numbers.append(2)
print(sorted_numbers.data)    # [1, 1, 2, 3, 4, 5]

sorted_numbers.extend([9, 6])
print(sorted_numbers.data)    # [1, 1, 2, 3, 4, 5, 6, 9]
```

**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒä¸€ä¸ªè‡ªåŠ¨æ•´ç†çš„ä¹¦æ¶ï¼š
â€¢ æ— è®ºä½ æ€ä¹ˆæ”¾ä¹¦ï¼Œå®ƒéƒ½ä¼šè‡ªåŠ¨æŒ‰é¡ºåºæ’åˆ—
â€¢ æ–°åŠ ä¹¦æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰¾åˆ°åˆé€‚ä½ç½®
â€¢ ä½ ä¸ç”¨æ“å¿ƒæ’åºï¼Œä¸“æ³¨äºä½¿ç”¨
```

### 3.2 UserListé«˜çº§åŠŸèƒ½


**ğŸ”¸ å¸¦éªŒè¯çš„å®‰å…¨åˆ—è¡¨**

```python
class ValidatedList(UserList):
    def __init__(self, validator=None, *args, **kwargs):
        self.validator = validator or (lambda x: True)
        super().__init__()
        # éªŒè¯åˆå§‹æ•°æ®
        if args or kwargs:
            initial_data = list(*args, **kwargs)
            for item in initial_data:
                if self.validator(item):
                    self.data.append(item)
                else:
                    raise ValueError(f"æ— æ•ˆæ•°æ®: {item}")
    
    def append(self, item):
        if self.validator(item):
            super().append(item)
        else:
            raise ValueError(f"æ•°æ®éªŒè¯å¤±è´¥: {item}")
    
    def extend(self, items):
        # å…ˆéªŒè¯æ‰€æœ‰é¡¹
        for item in items:
            if not self.validator(item):
                raise ValueError(f"æ•°æ®éªŒè¯å¤±è´¥: {item}")
        super().extend(items)
    
    def __setitem__(self, index, value):
        if self.validator(value):
            super().__setitem__(index, value)
        else:
            raise ValueError(f"æ•°æ®éªŒè¯å¤±è´¥: {value}")

# ä½¿ç”¨ç¤ºä¾‹
# åªå…è®¸æ­£æ•°çš„åˆ—è¡¨
positive_numbers = ValidatedList(lambda x: isinstance(x, (int, float)) and x > 0)
positive_numbers.append(5)
positive_numbers.append(3.14)
print(positive_numbers.data)  # [5, 3.14]

# å°è¯•æ·»åŠ æ— æ•ˆæ•°æ®
try:
    positive_numbers.append(-1)  # ä¼šæŠ›å‡ºå¼‚å¸¸
except ValueError as e:
    print(f"é”™è¯¯: {e}")  # é”™è¯¯: æ•°æ®éªŒè¯å¤±è´¥: -1

# åªå…è®¸å­—ç¬¦ä¸²ä¸”é•¿åº¦ä¸è¶…è¿‡10çš„åˆ—è¡¨
short_strings = ValidatedList(lambda x: isinstance(x, str) and len(x) <= 10)
short_strings.extend(['hello', 'world', 'python'])
print(short_strings.data)  # ['hello', 'world', 'python']
```

**ğŸ”¸ ç»Ÿè®¡åŠŸèƒ½å¢å¼ºåˆ—è¡¨**

```python
class StatsUserList(UserList):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.operations_count = {
            'append': 0,
            'remove': 0,
            'pop': 0,
            'clear': 0
        }
    
    def append(self, item):
        super().append(item)
        self.operations_count['append'] += 1
    
    def remove(self, item):
        super().remove(item)
        self.operations_count['remove'] += 1
    
    def pop(self, index=-1):
        result = super().pop(index)
        self.operations_count['pop'] += 1
        return result
    
    def clear(self):
        super().clear()
        self.operations_count['clear'] += 1
    
    def get_stats(self):
        total_ops = sum(self.operations_count.values())
        return {
            'current_length': len(self.data),
            'total_operations': total_ops,
            'operations_detail': self.operations_count.copy()
        }

# ä½¿ç”¨ç¤ºä¾‹
stats_list = StatsUserList([1, 2, 3])
stats_list.append(4)
stats_list.append(5)
stats_list.remove(2)
stats_list.pop()

print(stats_list.get_stats())
# è¾“å‡ºç±»ä¼¼:
# {
#     'current_length': 3,
#     'total_operations': 4,
#     'operations_detail': {'append': 2, 'remove': 1, 'pop': 1, 'clear': 0}
# }
```

---

## 4. ğŸ“„ UserStringè‡ªå®šä¹‰å­—ç¬¦ä¸²åŸºç±»


### 4.1 UserStringåŸºç¡€åº”ç”¨


**ğŸ”¸ å¤§å°å†™ä¸æ•æ„Ÿçš„å­—ç¬¦ä¸²**

```python
from collections import UserString

class CaseInsensitiveString(UserString):
    def __contains__(self, item):
        # é‡å†™ in æ“ä½œç¬¦ï¼Œå¿½ç•¥å¤§å°å†™
        return item.lower() in self.data.lower()
    
    def find(self, substring):
        # é‡å†™æŸ¥æ‰¾æ–¹æ³•ï¼Œå¿½ç•¥å¤§å°å†™
        return self.data.lower().find(substring.lower())
    
    def replace(self, old, new):
        # é‡å†™æ›¿æ¢æ–¹æ³•ï¼Œå¿½ç•¥å¤§å°å†™
        result = self.data
        old_lower = old.lower()
        start = 0
        while True:
            pos = result.lower().find(old_lower, start)
            if pos == -1:
                break
            result = result[:pos] + new + result[pos + len(old):]
            start = pos + len(new)
        return CaseInsensitiveString(result)
    
    def __eq__(self, other):
        # é‡å†™ç›¸ç­‰æ¯”è¾ƒï¼Œå¿½ç•¥å¤§å°å†™
        if isinstance(other, str):
            return self.data.lower() == other.lower()
        return False

# ä½¿ç”¨ç¤ºä¾‹
text = CaseInsensitiveString("Hello World Python")

print("python" in text)        # True (å¿½ç•¥å¤§å°å†™)
print("WORLD" in text)         # True
print(text.find("HELLO"))      # 0 (æ‰¾åˆ°äº†)
print(text == "hello world python")  # True

# æ›¿æ¢æµ‹è¯•
new_text = text.replace("PYTHON", "Java")
print(new_text.data)           # "Hello World Java"
```

**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒä¸€ä¸ª"é©¬è™"çš„æœç´¢å¼•æ“ï¼š
â€¢ ä½ æœç´¢"PYTHON"ï¼Œå®ƒä¼šæ‰¾åˆ°"python"ã€"Python"ã€"PYTHON"
â€¢ ä¸ä¼šå› ä¸ºå¤§å°å†™ä¸åŒå°±æ‰¾ä¸åˆ°
â€¢ å¯¹ç”¨æˆ·æ›´å‹å¥½ï¼Œæ›´æ™ºèƒ½
```

### 4.2 UserStringé«˜çº§ç‰¹æ€§


**ğŸ”¸ è‡ªåŠ¨æ ¼å¼åŒ–çš„æ¨¡æ¿å­—ç¬¦ä¸²**

```python
class TemplateString(UserString):
    def __init__(self, template):
        super().__init__(template)
        self.variables = {}  # å­˜å‚¨å˜é‡å€¼
    
    def set_var(self, name, value):
        """è®¾ç½®æ¨¡æ¿å˜é‡"""
        self.variables[name] = value
        return self  # æ”¯æŒé“¾å¼è°ƒç”¨
    
    def set_vars(self, **kwargs):
        """æ‰¹é‡è®¾ç½®å˜é‡"""
        self.variables.update(kwargs)
        return self
    
    def render(self):
        """æ¸²æŸ“æ¨¡æ¿ï¼Œæ›¿æ¢å˜é‡"""
        result = self.data
        for name, value in self.variables.items():
            placeholder = f"{{{name}}}"
            result = result.replace(placeholder, str(value))
        return result
    
    def __str__(self):
        return self.render()

# ä½¿ç”¨ç¤ºä¾‹
template = TemplateString("æ‚¨å¥½ {name}ï¼Œæ¬¢è¿æ¥åˆ° {company}ï¼ä»Šå¤©æ˜¯ {date}")

# è®¾ç½®å˜é‡
template.set_var("name", "å¼ ä¸‰") \
        .set_var("company", "Pythonå­¦é™¢") \
        .set_var("date", "2024å¹´")

print(template)  # æ‚¨å¥½ å¼ ä¸‰ï¼Œæ¬¢è¿æ¥åˆ° Pythonå­¦é™¢ï¼ä»Šå¤©æ˜¯ 2024å¹´

# æ‰¹é‡è®¾ç½®
email_template = TemplateString("Dear {name}, your order #{order_id} total is ${amount}")
email_template.set_vars(name="Alice", order_id="12345", amount="99.99")
print(email_template)  # Dear Alice, your order #12345 total is $99.99
```

**ğŸ”¸ æ™ºèƒ½å­—ç¬¦ä¸²å¤„ç†å™¨**

```python
class SmartString(UserString):
    def __init__(self, data=""):
        super().__init__(data)
        self.transformations = []  # è®°å½•å˜æ¢å†å²
    
    def smart_title(self):
        """æ™ºèƒ½æ ‡é¢˜åŒ– - ä¸å½±å“å¸¸è§ç¼©å†™"""
        common_words = {'and', 'or', 'the', 'a', 'an', 'in', 'on', 'at', 'by', 'for'}
        abbreviations = {'API', 'URL', 'HTTP', 'JSON', 'XML', 'SQL'}
        
        words = self.data.split()
        result = []
        
        for i, word in enumerate(words):
            if word.upper() in abbreviations:
                result.append(word.upper())
            elif i == 0 or word.lower() not in common_words:
                result.append(word.capitalize())
            else:
                result.append(word.lower())
        
        new_data = ' '.join(result)
        self.transformations.append(f"smart_title: '{self.data}' â†’ '{new_data}'")
        return SmartString(new_data)
    
    def remove_extra_spaces(self):
        """ç§»é™¤å¤šä½™ç©ºæ ¼"""
        import re
        new_data = re.sub(r'\s+', ' ', self.data).strip()
        self.transformations.append(f"remove_extra_spaces: '{self.data}' â†’ '{new_data}'")
        return SmartString(new_data)
    
    def get_transformation_history(self):
        """è·å–å˜æ¢å†å²"""
        return self.transformations.copy()

# ä½¿ç”¨ç¤ºä¾‹
text = SmartString("  hello   world  and  API  programming  ")
result = text.remove_extra_spaces().smart_title()

print(f"åŸå§‹: '{text.data}'")
print(f"ç»“æœ: '{result.data}'")
print("\nå˜æ¢å†å²:")
for step in result.get_transformation_history():
    print(f"  {step}")

# è¾“å‡º:
# åŸå§‹: '  hello   world  and  API  programming  '
# ç»“æœ: 'Hello World and API Programming'
# 
# å˜æ¢å†å²:
#   remove_extra_spaces: '  hello   world  and  API  programming  ' â†’ 'hello world and API programming'
#   smart_title: 'hello world and API programming' â†’ 'Hello World and API Programming'
```

---

## 5. ğŸ¨ å®¹å™¨ç±»å‹è®¾è®¡åŸåˆ™


### 5.1 å•ä¸€èŒè´£åŸåˆ™


**ğŸ”¸ è®¾è®¡æ€æƒ³**
```
æ¯ä¸ªè‡ªå®šä¹‰å®¹å™¨åªè´Ÿè´£ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š
â€¢ UserDict â†’ ä¸“é—¨å¤„ç†å­—å…¸çš„ç‰¹æ®Šéœ€æ±‚
â€¢ UserList â†’ ä¸“é—¨å¤„ç†åˆ—è¡¨çš„ç‰¹æ®Šéœ€æ±‚  
â€¢ UserString â†’ ä¸“é—¨å¤„ç†å­—ç¬¦ä¸²çš„ç‰¹æ®Šéœ€æ±‚

ä¸è¦åˆ›å»º"ä¸‡èƒ½å®¹å™¨"ï¼
```

**âœ… å¥½çš„è®¾è®¡**

```python
# ä¸“é—¨å¤„ç†é…ç½®é¡¹çš„å­—å…¸
class ConfigDict(UserDict):
    def __setitem__(self, key, value):
        # åªè´Ÿè´£é…ç½®éªŒè¯è¿™ä¸€ä»¶äº‹
        if not isinstance(key, str):
            raise TypeError("é…ç½®é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²")
        super().__setitem__(key.lower(), str(value))

# ä¸“é—¨å¤„ç†æ•°å­—çš„åˆ—è¡¨
class NumberList(UserList):
    def append(self, item):
        # åªè´Ÿè´£æ•°å­—éªŒè¯è¿™ä¸€ä»¶äº‹
        if not isinstance(item, (int, float)):
            raise TypeError("åªèƒ½æ·»åŠ æ•°å­—")
        super().append(item)
```

**âŒ ä¸å¥½çš„è®¾è®¡**

```python
# è¯•å›¾åšå¤ªå¤šäº‹æƒ…çš„"ä¸‡èƒ½"å­—å…¸
class SuperDict(UserDict):
    def __setitem__(self, key, value):
        # èŒè´£è¿‡å¤šï¼šç±»å‹æ£€æŸ¥ã€æ ¼å¼åŒ–ã€æ—¥å¿—ã€ç¼“å­˜...
        self._log_operation(key, value)
        self._validate_type(key, value)
        self._format_data(key, value)
        self._update_cache(key, value)
        # ... å¤ªå¤æ‚äº†ï¼
```

### 5.2 æ¥å£ä¸€è‡´æ€§åŸåˆ™


**ğŸ”¸ æ ¸å¿ƒç†å¿µ**
```
è‡ªå®šä¹‰å®¹å™¨åº”è¯¥"è¡Œä¸ºåƒ"åŸå§‹å®¹å™¨ï¼š
â€¢ æ”¯æŒç›¸åŒçš„åŸºæœ¬æ“ä½œ
â€¢ ä¿æŒç›¸åŒçš„æ¥å£çº¦å®š
â€¢ ç”¨æˆ·æ— éœ€å­¦ä¹ æ–°çš„ä½¿ç”¨æ–¹æ³•
```

**ğŸ’¡ å®è·µæŒ‡å¯¼**

```python
class SmartDict(UserDict):
    # âœ… ä¿æŒå­—å…¸çš„åŸºæœ¬è¡Œä¸º
    def __getitem__(self, key):
        # æ·»åŠ åŠŸèƒ½ï¼Œä½†ä¸æ”¹å˜åŸºæœ¬è¯­ä¹‰
        result = super().__getitem__(key)
        return result
    
    def keys(self):
        # ä¿æŒè¿”å›å€¼ç±»å‹ä¸€è‡´
        return super().keys()
    
    def values(self):
        # ä¿æŒè¿”å›å€¼ç±»å‹ä¸€è‡´
        return super().values()
    
    # âœ… å¯ä»¥æ·»åŠ æ–°æ–¹æ³•
    def smart_get(self, key, default=None, transform=None):
        """æ·»åŠ æ–°åŠŸèƒ½ï¼Œä½†ä¸ç ´ååŸæœ‰æ¥å£"""
        try:
            value = self[key]
            return transform(value) if transform else value
        except KeyError:
            return default
```

### 5.3 æ€§èƒ½è€ƒè™‘åŸåˆ™


**ğŸ“Š æ€§èƒ½ä¼˜åŒ–æŒ‡å¯¼**

| æ“ä½œç±»å‹ | **ä¼˜åŒ–ç­–ç•¥** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|
| ğŸ”¸ **é¢‘ç¹è¯»å–** | `ç¼“å­˜ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—` | `æ³¨æ„ç¼“å­˜å¤±æ•ˆæ—¶æœº` |
| ğŸ”¸ **æ‰¹é‡æ“ä½œ** | `é‡å†™extendã€updateç­‰æ–¹æ³•` | `ä¸€æ¬¡æ€§å¤„ç†æ¯”é€ä¸ªå¤„ç†å¿«` |
| ğŸ”¸ **æ•°æ®éªŒè¯** | `åœ¨åˆé€‚çš„æ—¶æœºéªŒè¯` | `ä¸è¦æ¯æ¬¡è®¿é—®éƒ½éªŒè¯` |
| ğŸ”¸ **æ’åºæ“ä½œ** | `å»¶è¿Ÿæ’åºæˆ–å¢é‡æ’åº` | `é¿å…ä¸å¿…è¦çš„é‡æ’åº` |

**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹**

```python
class OptimizedSortedList(UserList):
    def __init__(self, iterable=None):
        super().__init__(iterable)
        self._is_sorted = False
        self._sort_needed = True
    
    def _ensure_sorted(self):
        """å»¶è¿Ÿæ’åº - åªåœ¨éœ€è¦æ—¶æ’åº"""
        if self._sort_needed:
            self.data.sort()
            self._sort_needed = False
            self._is_sorted = True
    
    def append(self, item):
        super().append(item)
        self._sort_needed = True  # æ ‡è®°éœ€è¦é‡æ’åº
    
    def extend(self, items):
        # âœ… æ‰¹é‡æ“ä½œä¼˜åŒ–
        super().extend(items)
        self._sort_needed = True  # åªæ ‡è®°ä¸€æ¬¡
    
    def __getitem__(self, index):
        self._ensure_sorted()  # è¯»å–æ—¶æ‰æ’åº
        return super().__getitem__(index)
    
    def __iter__(self):
        self._ensure_sorted()  # éå†æ—¶æ‰æ’åº
        return super().__iter__()
```

---

## 6. ğŸ”§ å®¹å™¨æ–¹æ³•é‡å†™æŠ€å·§


### 6.1 æ ¸å¿ƒé­”æ³•æ–¹æ³•


**ğŸ“‹ æœ€é‡è¦çš„é­”æ³•æ–¹æ³•**

```python
# å­—å…¸ç±»é‡å†™è¦ç‚¹
class MyDict(UserDict):
    def __setitem__(self, key, value):
        """è®¾ç½®é¡¹ç›® - dict[key] = value"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        super().__setitem__(key, value)
    
    def __getitem__(self, key):
        """è·å–é¡¹ç›® - dict[key]"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        return super().__getitem__(key)
    
    def __delitem__(self, key):
        """åˆ é™¤é¡¹ç›® - del dict[key]"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        super().__delitem__(key)
    
    def __contains__(self, key):
        """æ£€æŸ¥åŒ…å« - key in dict"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        return super().__contains__(key)

# åˆ—è¡¨ç±»é‡å†™è¦ç‚¹
class MyList(UserList):
    def append(self, item):
        """æ·»åŠ å…ƒç´  - list.append(item)"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        super().append(item)
    
    def __setitem__(self, index, value):
        """è®¾ç½®å…ƒç´  - list[index] = value"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        super().__setitem__(index, value)
    
    def __getitem__(self, index):
        """è·å–å…ƒç´  - list[index]"""
        # åœ¨è¿™é‡Œæ·»åŠ ä½ çš„é€»è¾‘
        return super().__getitem__(index)
```

### 6.2 æ–¹æ³•é‡å†™æœ€ä½³å®è·µ


**ğŸ”¸ å®‰å…¨çš„æ–¹æ³•é‡å†™æ¨¡å¼**

```python
class SafeDict(UserDict):
    def __setitem__(self, key, value):
        """å®‰å…¨çš„é‡å†™æ¨¡å¼"""
        try:
            # 1. å‰ç½®å¤„ç†
            validated_key = self._validate_key(key)
            validated_value = self._validate_value(value)
            
            # 2. è°ƒç”¨çˆ¶ç±»æ–¹æ³•
            super().__setitem__(validated_key, validated_value)
            
            # 3. åç½®å¤„ç†
            self._after_set(validated_key, validated_value)
            
        except Exception as e:
            # 4. å¼‚å¸¸å¤„ç†
            self._handle_error(f"è®¾ç½® {key}={value} å¤±è´¥", e)
            raise
    
    def _validate_key(self, key):
        """éªŒè¯é”®çš„æœ‰æ•ˆæ€§"""
        if not isinstance(key, str):
            raise TypeError("é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²")
        return key.strip().lower()
    
    def _validate_value(self, value):
        """éªŒè¯å€¼çš„æœ‰æ•ˆæ€§"""
        if value is None:
            raise ValueError("å€¼ä¸èƒ½ä¸ºNone")
        return value
    
    def _after_set(self, key, value):
        """è®¾ç½®åçš„å¤„ç†"""
        print(f"æˆåŠŸè®¾ç½®: {key} = {value}")
    
    def _handle_error(self, message, error):
        """ç»Ÿä¸€çš„é”™è¯¯å¤„ç†"""
        print(f"é”™è¯¯: {message} - {error}")
```

**ğŸ”¸ ä¿æŒå‘åå…¼å®¹**

```python
class CompatibleList(UserList):
    def append(self, item):
        """ä¿æŒåŸæœ‰è¡Œä¸ºï¼Œæ·»åŠ æ–°åŠŸèƒ½"""
        # âœ… ä¿æŒåŸæœ‰çš„appendè¡Œä¸º
        super().append(item)
        
        # âœ… æ·»åŠ æ–°åŠŸèƒ½ï¼šè®°å½•æ“ä½œ
        if not hasattr(self, '_history'):
            self._history = []
        self._history.append(f"added: {item}")
    
    def get_history(self):
        """æ–°åŠŸèƒ½ï¼šè·å–æ“ä½œå†å²"""
        return getattr(self, '_history', []).copy()
    
    # âœ… ä¸è¦æ”¹å˜åŸæœ‰æ–¹æ³•çš„è¿”å›å€¼ç±»å‹
    def pop(self, index=-1):
        """ä¿æŒpopçš„åŸæœ‰è¿”å›å€¼"""
        result = super().pop(index)  # ä»ç„¶è¿”å›è¢«ç§»é™¤çš„å…ƒç´ 
        
        # è®°å½•æ“ä½œï¼Œä½†ä¸æ”¹å˜è¿”å›å€¼
        if not hasattr(self, '_history'):
            self._history = []
        self._history.append(f"removed: {result}")
        
        return result  # âœ… ä¿æŒåŸæœ‰è¿”å›å€¼
```

---

## 7. âš¡ å®¹å™¨æ€§èƒ½ä¼˜åŒ–è€ƒè™‘


### 7.1 æ€§èƒ½æµ‹è¯•å¯¹æ¯”


**ğŸ”¸ æ€§èƒ½åŸºå‡†æµ‹è¯•**

```python
import time
from collections import UserDict

def performance_test():
    """æ€§èƒ½å¯¹æ¯”æµ‹è¯•"""
    # åŸç”Ÿå­—å…¸
    native_dict = {}
    
    # è‡ªå®šä¹‰å­—å…¸
    class SimpleUserDict(UserDict):
        pass
    user_dict = SimpleUserDict()
    
    # æµ‹è¯•æ•°æ®
    test_data = [(f"key_{i}", i) for i in range(10000)]
    
    # æµ‹è¯•åŸç”Ÿå­—å…¸æ€§èƒ½
    start_time = time.time()
    for key, value in test_data:
        native_dict[key] = value
    native_time = time.time() - start_time
    
    # æµ‹è¯•UserDictæ€§èƒ½
    start_time = time.time()
    for key, value in test_data:
        user_dict[key] = value
    user_time = time.time() - start_time
    
    print(f"åŸç”Ÿå­—å…¸è€—æ—¶: {native_time:.4f}ç§’")
    print(f"UserDictè€—æ—¶: {user_time:.4f}ç§’")
    print(f"æ€§èƒ½å·®å¼‚: {user_time/native_time:.2f}å€")

# performance_test()
# å…¸å‹è¾“å‡º:
# åŸç”Ÿå­—å…¸è€—æ—¶: 0.0021ç§’
# UserDictè€—æ—¶: 0.0031ç§’  
# æ€§èƒ½å·®å¼‚: 1.48å€
```

**ğŸ’¡ æ€§èƒ½ä¼˜åŒ–åŸåˆ™**
```
âœ… ä¼˜åŒ–å»ºè®®ï¼š
â€¢ ç¼“å­˜è®¡ç®—ç»“æœ
â€¢ å‡å°‘ä¸å¿…è¦çš„æ–¹æ³•è°ƒç”¨
â€¢ æ‰¹é‡æ“ä½œæ¯”å•ä¸ªæ“ä½œå¿«
â€¢ å»¶è¿Ÿè®¡ç®—ï¼ŒæŒ‰éœ€å¤„ç†

âŒ é¿å…çš„é™·é˜±ï¼š
â€¢ æ¯æ¬¡è®¿é—®éƒ½é‡æ–°è®¡ç®—
â€¢ è¿‡åº¦éªŒè¯æ•°æ®
â€¢ é¢‘ç¹çš„ç±»å‹è½¬æ¢
â€¢ æ— æ„ä¹‰çš„æ·±æ‹·è´
```

### 7.2 å†…å­˜ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ ä½¿ç”¨__slots__ä¼˜åŒ–å†…å­˜**

```python
class MemoryOptimizedDict(UserDict):
    __slots__ = ['_cache', '_stats']  # é™åˆ¶å±æ€§ï¼ŒèŠ‚çœå†…å­˜
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self._cache = {}
        self._stats = {'hits': 0, 'misses': 0}
    
    def __getitem__(self, key):
        # ä½¿ç”¨ç¼“å­˜æé«˜è®¿é—®é€Ÿåº¦
        if key in self._cache:
            self._stats['hits'] += 1
            return self._cache[key]
        
        value = super().__getitem__(key)
        self._cache[key] = value
        self._stats['misses'] += 1
        return value
    
    def __setitem__(self, key, value):
        super().__setitem__(key, value)
        self._cache[key] = value  # æ›´æ–°ç¼“å­˜
    
    def get_cache_stats(self):
        total = self._stats['hits'] + self._stats['misses']
        if total == 0:
            return {'hit_rate': 0}
        return {
            'hit_rate': self._stats['hits'] / total,
            'total_accesses': total
        }
```

**ğŸ”¸ å»¶è¿Ÿè®¡ç®—ä¼˜åŒ–**

```python
class LazyProcessingList(UserList):
    def __init__(self, iterable=None):
        super().__init__(iterable)
        self._processed = None
        self._needs_processing = True
    
    def append(self, item):
        super().append(item)
        self._needs_processing = True  # æ ‡è®°éœ€è¦é‡æ–°å¤„ç†
        self._processed = None  # æ¸…é™¤ç¼“å­˜
    
    def get_processed_data(self):
        """å»¶è¿Ÿè®¡ç®— - åªåœ¨éœ€è¦æ—¶å¤„ç†"""
        if self._needs_processing or self._processed is None:
            # æ¨¡æ‹Ÿè€—æ—¶çš„æ•°æ®å¤„ç†
            self._processed = [x * 2 for x in self.data if x > 0]
            self._needs_processing = False
        return self._processed.copy()
    
    @property
    def processed_count(self):
        """åªè¿”å›è®¡æ•°ï¼Œä¸éœ€è¦å®Œæ•´å¤„ç†"""
        if self._processed is None:
            return sum(1 for x in self.data if x > 0)
        return len(self._processed)
```

---

## 8. ğŸ”„ å®¹å™¨åè®®å®ç°


### 8.1 å®¹å™¨åè®®æ¦‚è¿°


**ğŸ”¸ ä»€ä¹ˆæ˜¯å®¹å™¨åè®®**
```
å®¹å™¨åè®®å°±æ˜¯ä¸€å¥—"è§„åˆ™"ï¼Œå®šä¹‰äº†ï¼š
â€¢ å®¹å™¨åº”è¯¥æ”¯æŒå“ªäº›æ“ä½œ
â€¢ è¿™äº›æ“ä½œåº”è¯¥å¦‚ä½•è¡¨ç°
â€¢ ä»€ä¹ˆæ—¶å€™åº”è¯¥æŠ›å‡ºä»€ä¹ˆå¼‚å¸¸

ç”Ÿæ´»ç±»æ¯”ï¼š
å°±åƒ"é¤å…æœåŠ¡æ ‡å‡†"ï¼š
â€¢ åº”è¯¥æœ‰èœå•ï¼ˆ__iter__ï¼‰
â€¢ åº”è¯¥èƒ½ç‚¹èœï¼ˆ__getitem__ï¼‰
â€¢ åº”è¯¥çŸ¥é“æœ‰ä»€ä¹ˆèœï¼ˆ__contains__ï¼‰
```

**ğŸ“‹ æ ¸å¿ƒåè®®æ–¹æ³•**

| åè®® | **é­”æ³•æ–¹æ³•** | **ä½œç”¨** | **ç¤ºä¾‹** |
|------|-------------|---------|---------|
| ğŸ”¸ **å®¹å™¨åè®®** | `__contains__` | `æ”¯æŒ in æ“ä½œ` | `'key' in container` |
| ğŸ”¸ **å¯è¿­ä»£åè®®** | `__iter__` | `æ”¯æŒ for å¾ªç¯` | `for item in container` |
| ğŸ”¸ **åºåˆ—åè®®** | `__getitem__, __len__` | `æ”¯æŒç´¢å¼•è®¿é—®` | `container[0]` |
| ğŸ”¸ **æ˜ å°„åè®®** | `__getitem__, __setitem__, __delitem__` | `æ”¯æŒé”®å€¼æ“ä½œ` | `container[key] = value` |

### 8.2 å®ç°å®Œæ•´å®¹å™¨åè®®


**ğŸ”¸ å®Œæ•´çš„å®¹å™¨å®ç°**

```python
class CompleteContainer(UserDict):
    """å®ç°å®Œæ•´å®¹å™¨åè®®çš„ç¤ºä¾‹"""
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self._access_count = {}  # è®°å½•è®¿é—®æ¬¡æ•°
    
    # å®¹å™¨åè®®
    def __contains__(self, key):
        """æ”¯æŒ 'key in container' è¯­æ³•"""
        print(f"æ£€æŸ¥æ˜¯å¦åŒ…å«: {key}")
        return super().__contains__(key)
    
    def __len__(self):
        """æ”¯æŒ len(container) è¯­æ³•"""
        return len(self.data)
    
    # è¿­ä»£åè®®
    def __iter__(self):
        """æ”¯æŒ for key in container è¯­æ³•"""
        print("å¼€å§‹è¿­ä»£")
        return iter(self.data)
    
    def keys(self):
        """è¿”å›æ‰€æœ‰é”®"""
        return self.data.keys()
    
    def values(self):
        """è¿”å›æ‰€æœ‰å€¼"""
        return self.data.values()
    
    def items(self):
        """è¿”å›æ‰€æœ‰é”®å€¼å¯¹"""
        return self.data.items()
    
    # æ˜ å°„åè®®
    def __getitem__(self, key):
        """æ”¯æŒ container[key] è¯­æ³•"""
        # è®°å½•è®¿é—®æ¬¡æ•°
        self._access_count[key] = self._access_count.get(key, 0) + 1
        return super().__getitem__(key)
    
    def __setitem__(self, key, value):
        """æ”¯æŒ container[key] = value è¯­æ³•"""
        print(f"è®¾ç½® {key} = {value}")
        super().__setitem__(key, value)
    
    def __delitem__(self, key):
        """æ”¯æŒ del container[key] è¯­æ³•"""
        print(f"åˆ é™¤ {key}")
        if key in self._access_count:
            del self._access_count[key]
        super().__delitem__(key)
    
    # æ‰©å±•åŠŸèƒ½
    def get_access_stats(self):
        """è·å–è®¿é—®ç»Ÿè®¡"""
        return self._access_count.copy()
    
    def most_accessed(self, n=5):
        """è·å–è®¿é—®æœ€å¤šçš„é”®"""
        sorted_items = sorted(
            self._access_count.items(), 
            key=lambda x: x[1], 
            reverse=True
        )
        return sorted_items[:n]

# ä½¿ç”¨ç¤ºä¾‹
container = CompleteContainer({'a': 1, 'b': 2, 'c': 3})

# æµ‹è¯•å„ç§åè®®
print('a' in container)         # æ£€æŸ¥æ˜¯å¦åŒ…å«: a  â†’ True
print(len(container))           # 3
print(container['a'])           # 1
container['d'] = 4              # è®¾ç½® d = 4
del container['b']              # åˆ é™¤ b

# è¿­ä»£æµ‹è¯•
for key in container:           # å¼€å§‹è¿­ä»£
    print(f"è®¿é—® {key}")         # è®¿é—® a, è®¿é—® c, è®¿é—® d

# è®¿é—®ç»Ÿè®¡
print(container.get_access_stats())     # {'a': 2}
print(container.most_accessed())        # [('a', 2)]
```

### 8.3 åè®®å…¼å®¹æ€§æ£€æŸ¥


**ğŸ”¸ æ£€æŸ¥å¯¹è±¡æ˜¯å¦å®ç°äº†ç‰¹å®šåè®®**

```python
from collections.abc import Container, Iterable, Mapping, Sequence

def check_protocols(obj):
    """æ£€æŸ¥å¯¹è±¡å®ç°äº†å“ªäº›åè®®"""
    protocols = {
        'Container': Container,      # æ”¯æŒ in æ“ä½œ
        'Iterable': Iterable,       # æ”¯æŒè¿­ä»£
        'Mapping': Mapping,         # æ”¯æŒæ˜ å°„æ“ä½œ
        'Sequence': Sequence        # æ”¯æŒåºåˆ—æ“ä½œ
    }
    
    results = {}
    for name, protocol in protocols.items():
        results[name] = isinstance(obj, protocol)
    
    return results

# æµ‹è¯•ç¤ºä¾‹
my_dict = CompleteContainer({'a': 1, 'b': 2})
my_list = UserList([1, 2, 3])
my_string = UserString("hello")

print("å­—å…¸åè®®æ”¯æŒ:")
for protocol, supported in check_protocols(my_dict).items():
    print(f"  {protocol}: {'âœ…' if supported else 'âŒ'}")

print("\nåˆ—è¡¨åè®®æ”¯æŒ:")
for protocol, supported in check_protocols(my_list).items():
    print(f"  {protocol}: {'âœ…' if supported else 'âŒ'}")

# è¾“å‡ºç¤ºä¾‹:
# å­—å…¸åè®®æ”¯æŒ:
#   Container: âœ…
#   Iterable: âœ…  
#   Mapping: âœ…
#   Sequence: âŒ
#
# åˆ—è¡¨åè®®æ”¯æŒ:
#   Container: âœ…
#   Iterable: âœ…
#   Mapping: âŒ
#   Sequence: âœ…
```

---

## 9. ğŸŒŸ è‡ªå®šä¹‰å®¹å™¨æœ€ä½³å®è·µ


### 9.1 è®¾è®¡æ¨¡å¼åº”ç”¨


**ğŸ”¸ è£…é¥°å™¨æ¨¡å¼ - åŠŸèƒ½å¢å¼º**

```python
class LoggingDecorator:
    """ä¸ºä»»ä½•å®¹å™¨æ·»åŠ æ—¥å¿—åŠŸèƒ½çš„è£…é¥°å™¨"""
    
    def __init__(self, container):
        self._container = container
        self._log = []
    
    def __getattr__(self, name):
        """å§”æ‰˜æ‰€æœ‰æ–¹æ³•ç»™è¢«è£…é¥°çš„å®¹å™¨"""
        attr = getattr(self._container, name)
        if callable(attr):
            def logged_method(*args, **kwargs):
                self._log.append(f"è°ƒç”¨ {name}({args}, {kwargs})")
                return attr(*args, **kwargs)
            return logged_method
        return attr
    
    def get_log(self):
        return self._log.copy()

# ä½¿ç”¨ç¤ºä¾‹
original_dict = UserDict({'a': 1, 'b': 2})
logged_dict = LoggingDecorator(original_dict)

logged_dict.update({'c': 3})
logged_dict.pop('a')

print("æ“ä½œæ—¥å¿—:")
for entry in logged_dict.get_log():
    print(f"  {entry}")
```

**ğŸ”¸ è§‚å¯Ÿè€…æ¨¡å¼ - å˜åŒ–é€šçŸ¥**

```python
class ObservableDict(UserDict):
    """æ”¯æŒè§‚å¯Ÿè€…æ¨¡å¼çš„å­—å…¸"""
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self._observers = []
    
    def add_observer(self, observer):
        """æ·»åŠ è§‚å¯Ÿè€…"""
        self._observers.append(observer)
    
    def remove_observer(self, observer):
        """ç§»é™¤è§‚å¯Ÿè€…"""
        if observer in self._observers:
            self._observers.remove(observer)
    
    def _notify_observers(self, event, key, value=None):
        """é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…"""
        for observer in self._observers:
            observer.on_dict_changed(event, key, value)
    
    def __setitem__(self, key, value):
        old_value = self.data.get(key)
        super().__setitem__(key, value)
        
        event = 'updated' if old_value is not None else 'added'
        self._notify_observers(event, key, value)
    
    def __delitem__(self, key):
        old_value = self.data[key]
        super().__delitem__(key)
        self._notify_observers('deleted', key, old_value)

class DictObserver:
    """å­—å…¸è§‚å¯Ÿè€…ç¤ºä¾‹"""
    
    def __init__(self, name):
        self.name = name
    
    def on_dict_changed(self, event, key, value):
        print(f"[{self.name}] å­—å…¸{event}: {key} = {value}")

# ä½¿ç”¨ç¤ºä¾‹
observed_dict = ObservableDict({'initial': 'value'})

# æ·»åŠ è§‚å¯Ÿè€…
logger = DictObserver("æ—¥å¿—è®°å½•å™¨")
monitor = DictObserver("ç›‘æ§ç³»ç»Ÿ")

observed_dict.add_observer(logger)
observed_dict.add_observer(monitor)

# è§¦å‘å˜åŒ–
observed_dict['new_key'] = 'new_value'    # ä¸¤ä¸ªè§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥
observed_dict['new_key'] = 'updated'      # æ›´æ–°é€šçŸ¥
del observed_dict['initial']              # åˆ é™¤é€šçŸ¥
```

### 9.2 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¸ ä¼˜é›…çš„å¼‚å¸¸å¤„ç†**

```python
class RobustContainer(UserDict):
    """å¥å£®çš„å®¹å™¨å®ç°ï¼Œä¼˜é›…å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ"""
    
    def __init__(self, *args, **kwargs):
        super().__init__()
        self._error_log = []
        
        # å®‰å…¨åˆå§‹åŒ–
        try:
            if args or kwargs:
                self.update(*args, **kwargs)
        except Exception as e:
            self._log_error("åˆå§‹åŒ–å¤±è´¥", e)
    
    def safe_get(self, key, default=None, on_error=None):
        """å®‰å…¨çš„è·å–æ–¹æ³•ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸"""
        try:
            return self[key]
        except KeyError:
            return default
        except Exception as e:
            self._log_error(f"è·å– {key} æ—¶å‡ºé”™", e)
            return on_error() if callable(on_error) else default
    
    def safe_set(self, key, value, on_error=None):
        """å®‰å…¨çš„è®¾ç½®æ–¹æ³•"""
        try:
            self[key] = value
            return True
        except Exception as e:
            self._log_error(f"è®¾ç½® {key}={value} æ—¶å‡ºé”™", e)
            if callable(on_error):
                on_error(e)
            return False
    
    def batch_update(self, items, stop_on_error=False):
        """æ‰¹é‡æ›´æ–°ï¼Œå¯é€‰æ‹©æ˜¯å¦åœ¨é”™è¯¯æ—¶åœæ­¢"""
        success_count = 0
        for key, value in items:
            try:
                self[key] = value
                success_count += 1
            except Exception as e:
                self._log_error(f"æ‰¹é‡æ›´æ–° {key}={value} å¤±è´¥", e)
                if stop_on_error:
                    break
        
        return {
            'success_count': success_count,
            'total_items': len(items),
            'has_errors': len(self._error_log) > 0
        }
    
    def _log_error(self, message, error):
        """è®°å½•é”™è¯¯æ—¥å¿—"""
        import datetime
        self._error_log.append({
            'timestamp': datetime.datetime.now(),
            'message': message,
            'error': str(error),
            'type': type(error).__name__
        })
    
    def get_error_summary(self):
        """è·å–é”™è¯¯æ‘˜è¦"""
        if not self._error_log:
            return "æ— é”™è¯¯è®°å½•"
        
        error_types = {}
        for log in self._error_log:
            error_type = log['type']
            error_types[error_type] = error_types.get(error_type, 0) + 1
        
        return {
            'total_errors': len(self._error_log),
            'error_types': error_types,
            'last_error': self._error_log[-1] if self._error_log else None
        }

# ä½¿ç”¨ç¤ºä¾‹
container = RobustContainer()

# æ­£å¸¸æ“ä½œ
container.safe_set('name', 'Alice')
print(container.safe_get('name'))          # Alice
print(container.safe_get('age', 'unknown')) # unknown

# æ‰¹é‡æ“ä½œ
items = [('a', 1), ('b', 2), ('c', 3)]
result = container.batch_update(items)
print(f"æ‰¹é‡æ›´æ–°ç»“æœ: {result}")

# é”™è¯¯æ‘˜è¦
print(f"é”™è¯¯æ‘˜è¦: {container.get_error_summary()}")
```

### 9.3 æµ‹è¯•ä¸è°ƒè¯•


**ğŸ”¸ å†…ç½®æµ‹è¯•æ”¯æŒ**

```python
class TestableContainer(UserDict):
    """æ”¯æŒå†…ç½®æµ‹è¯•çš„å®¹å™¨"""
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self._test_mode = False
        self._test_results = []
    
    def enable_test_mode(self):
        """å¯ç”¨æµ‹è¯•æ¨¡å¼"""
        self._test_mode = True
        self._test_results = []
    
    def disable_test_mode(self):
        """ç¦ç”¨æµ‹è¯•æ¨¡å¼"""
        self._test_mode = False
    
    def __setitem__(self, key, value):
        if self._test_mode:
            # è®°å½•æµ‹è¯•æ“ä½œ
            self._test_results.append(f"è®¾ç½®: {key} = {value}")
        super().__setitem__(key, value)
    
    def run_self_test(self):
        """è¿è¡Œè‡ªæˆ‘æµ‹è¯•"""
        print("å¼€å§‹è‡ªæˆ‘æµ‹è¯•...")
        self.enable_test_mode()
        
        test_cases = [
            ('test_key1', 'test_value1'),
            ('test_key2', 'test_value2'),
            ('test_key1', 'updated_value'),  # æ›´æ–°æµ‹è¯•
        ]
        
        for key, value in test_cases:
            self[key] = value
        
        # éªŒè¯ç»“æœ
        assert 'test_key1' in self
        assert self['test_key1'] == 'updated_value'
        assert 'test_key2' in self
        
        print("âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!")
        print("æµ‹è¯•æ“ä½œè®°å½•:")
        for result in self._test_results:
            print(f"  {result}")
        
        self.disable_test_mode()
        return True

# ä½¿ç”¨ç¤ºä¾‹
container = TestableContainer({'initial': 'data'})
container.run_self_test()
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ UseråŸºç±»æœ¬è´¨ï¼šç®€åŒ–è‡ªå®šä¹‰å®¹å™¨çš„åˆ›å»ºï¼Œæä¾›æ ‡å‡†å®ç°
ğŸ”¸ ä¸‰å¤§åŸºç±»ä½œç”¨ï¼šUserDictã€UserListã€UserStringåˆ†åˆ«å¯¹åº”å­—å…¸ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²
ğŸ”¸ dataå±æ€§é‡è¦æ€§ï¼šå®é™…æ•°æ®å­˜å‚¨åœ¨dataå±æ€§ä¸­ï¼Œæ˜¯å§”æ‰˜æ¨¡å¼çš„ä½“ç°
ğŸ”¸ æ–¹æ³•é‡å†™åŸåˆ™ï¼šä¿æŒæ¥å£ä¸€è‡´æ€§ï¼Œæ·»åŠ åŠŸèƒ½è€Œä¸ç ´ååŸæœ‰è¡Œä¸º
ğŸ”¸ åè®®å®ç°ä»·å€¼ï¼šè®©è‡ªå®šä¹‰å®¹å™¨"è¡Œä¸ºåƒ"åŸç”Ÿå®¹å™¨
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆä½¿ç”¨UseråŸºç±»è€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿åŸç”Ÿç±»å‹**
```
ç›´æ¥ç»§æ‰¿çš„é—®é¢˜ï¼š
â€¢ dictã€listã€stræ˜¯Cå®ç°çš„ï¼ŒæŸäº›æ–¹æ³•æ— æ³•é‡å†™
â€¢ å†…éƒ¨æ–¹æ³•å¯èƒ½ç»•è¿‡ä½ é‡å†™çš„æ–¹æ³•
â€¢ è¡Œä¸ºä¸ä¸€è‡´ï¼Œéš¾ä»¥é¢„æµ‹

UseråŸºç±»çš„ä¼˜åŠ¿ï¼š
â€¢ çº¯Pythonå®ç°ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥é‡å†™
â€¢ è¡Œä¸ºä¸€è‡´ï¼Œç¬¦åˆé¢„æœŸ
â€¢ æä¾›å®Œæ•´çš„å®¹å™¨åè®®å®ç°
```

**ğŸ”¹ ä½•æ—¶é€‰æ‹©å“ªç§åŸºç±»**
```
é€‰æ‹©UserDictï¼š
â€¢ éœ€è¦é”®å€¼å¯¹å­˜å‚¨
â€¢ éœ€è¦è‡ªå®šä¹‰é”®çš„å¤„ç†é€»è¾‘
â€¢ éœ€è¦æ·»åŠ å­—å…¸ç‰¹æœ‰åŠŸèƒ½

é€‰æ‹©UserListï¼š
â€¢ éœ€è¦æœ‰åºé›†åˆ
â€¢ éœ€è¦ç´¢å¼•è®¿é—®
â€¢ éœ€è¦è‡ªå®šä¹‰æ’åºæˆ–éªŒè¯

é€‰æ‹©UserStringï¼š
â€¢ éœ€è¦å­—ç¬¦ä¸²æ“ä½œ
â€¢ éœ€è¦è‡ªå®šä¹‰æ ¼å¼åŒ–
â€¢ éœ€è¦ç‰¹æ®Šçš„å­—ç¬¦ä¸²å¤„ç†é€»è¾‘
```

**ğŸ”¹ æ€§èƒ½è€ƒè™‘è¦ç‚¹**
```
UseråŸºç±»æ¯”åŸç”Ÿç±»å‹æ…¢ 20-50%ï¼š
â€¢ å¤šäº†ä¸€å±‚PythonåŒ…è£…
â€¢ æ–¹æ³•è°ƒç”¨å¼€é”€æ›´å¤§
â€¢ ä½†æ¢æ¥äº†æ›´å¤§çš„çµæ´»æ€§

æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š
â€¢ ç¼“å­˜è®¡ç®—ç»“æœ
â€¢ æ‰¹é‡æ“ä½œ
â€¢ å»¶è¿Ÿè®¡ç®—
â€¢ åˆç†ä½¿ç”¨__slots__
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¸¸è§åº”ç”¨åœºæ™¯**
- **é…ç½®ç®¡ç†**ï¼šè‡ªå®šä¹‰å­—å…¸å¤„ç†é…ç½®é¡¹éªŒè¯å’Œé»˜è®¤å€¼
- **æ•°æ®éªŒè¯**ï¼šè‡ªå®šä¹‰åˆ—è¡¨ç¡®ä¿æ•°æ®ç±»å‹å’ŒèŒƒå›´æ­£ç¡®  
- **æ¨¡æ¿å¤„ç†**ï¼šè‡ªå®šä¹‰å­—ç¬¦ä¸²æ”¯æŒå˜é‡æ›¿æ¢å’Œæ ¼å¼åŒ–
- **æ—¥å¿—è®°å½•**ï¼šä¸ºå®¹å™¨æ·»åŠ æ“ä½œå†å²è®°å½•åŠŸèƒ½
- **ç¼“å­˜ä¼˜åŒ–**ï¼šå®ç°æ™ºèƒ½ç¼“å­˜çš„å®¹å™¨ç±»

**ğŸ’¡ è®¾è®¡å»ºè®®**
```
âœ… æ¨èåšæ³•ï¼š
â€¢ å•ä¸€èŒè´£ï¼šæ¯ä¸ªå®¹å™¨åªè´Ÿè´£ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½
â€¢ ä¿æŒå…¼å®¹ï¼šä¸æ”¹å˜åŸæœ‰æ¥å£è¡Œä¸º
â€¢ ä¼˜é›…é™çº§ï¼šæä¾›å®‰å…¨çš„é”™è¯¯å¤„ç†
â€¢ å……åˆ†æµ‹è¯•ï¼šéªŒè¯å„ç§è¾¹ç•Œæƒ…å†µ

âŒ é¿å…é™·é˜±ï¼š
â€¢ è¿‡åº¦è®¾è®¡ï¼šä¸è¦è¯•å›¾åšæˆ"ä¸‡èƒ½å®¹å™¨"
â€¢ æ€§èƒ½å¿½è§†ï¼šæ³¨æ„UseråŸºç±»çš„æ€§èƒ½å¼€é”€
â€¢ åè®®é—æ¼ï¼šç¡®ä¿å®ç°å®Œæ•´çš„å®¹å™¨åè®®
â€¢ å‘åå…¼å®¹ï¼šä¸è¦ç ´åç”¨æˆ·å·²æœ‰çš„ä½¿ç”¨ä¹ æƒ¯
```

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ é¡ºåº**
```
ç¬¬ä¸€æ­¥ï¼šç†è§£åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•
ç¬¬äºŒæ­¥ï¼šæŒæ¡æ–¹æ³•é‡å†™æŠ€å·§å’Œæœ€ä½³å®è·µ
ç¬¬ä¸‰æ­¥ï¼šå­¦ä¹ æ€§èƒ½ä¼˜åŒ–å’Œåè®®å®ç°
ç¬¬å››æ­¥ï¼šå®é™…é¡¹ç›®ä¸­åº”ç”¨å’Œæ€»ç»“ç»éªŒ
```

**ğŸ”§ å®è·µç»ƒä¹ **
- å®ç°ä¸€ä¸ªè‡ªåŠ¨æ’åºçš„å­—å…¸
- åˆ›å»ºä¸€ä¸ªå¸¦éªŒè¯çš„åˆ—è¡¨ç±»
- è®¾è®¡ä¸€ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²å¤„ç†å™¨
- ä¸ºå®¹å™¨æ·»åŠ åºåˆ—åŒ–/ååºåˆ—åŒ–åŠŸèƒ½

**æ ¸å¿ƒè®°å¿†**ï¼š
- UseråŸºç±»ç®€åŒ–å®¹å™¨å®šåˆ¶ï¼Œä¸‰å¤§åŸºç±»å„æœ‰ä¸“é•¿
- é‡å†™æ–¹æ³•ä¿æŒå…¼å®¹ï¼Œæ·»åŠ åŠŸèƒ½ä¸ç ´ååŸæœ‰è¡Œä¸º  
- æ€§èƒ½è™½æœ‰æŸå¤±ä½†æ¢æ¥çµæ´»ï¼Œæ ¹æ®éœ€æ±‚æƒè¡¡é€‰æ‹©
- å®¹å™¨åè®®ç¡®ä¿å…¼å®¹ï¼Œä¼˜é›…è®¾è®¡é¢å‘æœªæ¥