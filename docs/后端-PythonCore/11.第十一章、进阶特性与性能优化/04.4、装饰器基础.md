---
title: 4ã€è£…é¥°å™¨åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [è£…é¥°å™¨åŸºç¡€æ¦‚å¿µ](#1-è£…é¥°å™¨åŸºç¡€æ¦‚å¿µ)
2. [å‡½æ•°ä½œä¸ºç¬¬ä¸€ç±»å¯¹è±¡](#2-å‡½æ•°ä½œä¸ºç¬¬ä¸€ç±»å¯¹è±¡)
3. [é—­åŒ…ä¸è£…é¥°å™¨å…³ç³»](#3-é—­åŒ…ä¸è£…é¥°å™¨å…³ç³»)
4. [è£…é¥°å™¨è¯­æ³•ç³–è¯¦è§£](#4-è£…é¥°å™¨è¯­æ³•ç³–è¯¦è§£)
5. [functools.wrapsä½¿ç”¨](#5-functools-wrapsä½¿ç”¨)
6. [è£…é¥°å™¨æ‰§è¡Œæ—¶æœº](#6-è£…é¥°å™¨æ‰§è¡Œæ—¶æœº)
7. [è£…é¥°å™¨è°ƒè¯•æŠ€å·§](#7-è£…é¥°å™¨è°ƒè¯•æŠ€å·§)
8. [è£…é¥°å™¨è®¾è®¡æ¨¡å¼](#8-è£…é¥°å™¨è®¾è®¡æ¨¡å¼)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è£…é¥°å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨


**ğŸ”¸ é€šä¿—ç†è§£**
è£…é¥°å™¨å°±åƒæ˜¯ç»™ä½ çš„å‡½æ•°"ç©¿è¡£æœ"æˆ–"æˆ´å¸½å­"ï¼Œåœ¨ä¸æ”¹å˜å‡½æ•°æœ¬èº«çš„æƒ…å†µä¸‹ï¼Œç»™å®ƒæ·»åŠ æ–°çš„åŠŸèƒ½ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
åŸå§‹åŠŸèƒ½ï¼šä¸€ä¸ªæ™®é€šæ¯å­ï¼ˆå–æ°´ï¼‰
è£…é¥°åï¼šä¿æ¸©æ¯ = æ¯å­ + ä¿æ¸©åŠŸèƒ½
       å¸¦ç›–æ¯å­ = æ¯å­ + é˜²å°˜åŠŸèƒ½
       
Pythonä¸­ï¼š
åŸå§‹å‡½æ•°ï¼šdef hello() -> æ‰“å°é—®å€™
è£…é¥°åï¼šè®¡æ—¶å‡½æ•° = hello + è®¡ç®—æ‰§è¡Œæ—¶é—´
       æ—¥å¿—å‡½æ•° = hello + è®°å½•è°ƒç”¨æ—¥å¿—
```

**ğŸ”¸ è£…é¥°å™¨çš„æœ¬è´¨**
> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**  
> è£…é¥°å™¨æ˜¯ä¸€ä¸ª**æ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°**ï¼Œå¹¶**è¿”å›æ–°å‡½æ•°**çš„é«˜é˜¶å‡½æ•°

```python
# æœ€ç®€å•çš„è£…é¥°å™¨ç¤ºä¾‹
def my_decorator(func):
    """è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°"""
    def wrapper():
        print("å‡½æ•°æ‰§è¡Œå‰åšç‚¹ä»€ä¹ˆ")
        func()  # è°ƒç”¨åŸå§‹å‡½æ•°
        print("å‡½æ•°æ‰§è¡Œååšç‚¹ä»€ä¹ˆ")
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨
@my_decorator
def say_hello():
    print("Hello, World!")

# è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°
say_hello()
```

**è¾“å‡ºç»“æœ**ï¼š
```
å‡½æ•°æ‰§è¡Œå‰åšç‚¹ä»€ä¹ˆ
Hello, World!
å‡½æ•°æ‰§è¡Œååšç‚¹ä»€ä¹ˆ
```

### 1.2 è£…é¥°å™¨è§£å†³ä»€ä¹ˆé—®é¢˜


**ğŸ“Š å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”**

| **æ²¡æœ‰è£…é¥°å™¨** | **ä½¿ç”¨è£…é¥°å™¨** | **ä¼˜åŠ¿** |
|-------------|-------------|---------|
| æ¯ä¸ªå‡½æ•°æ‰‹åŠ¨æ·»åŠ æ—¥å¿—ä»£ç  | ä¸€ä¸ªè£…é¥°å™¨åº”ç”¨åˆ°å¤šä¸ªå‡½æ•° | `ä»£ç å¤ç”¨` |
| ä¿®æ”¹åŠŸèƒ½éœ€è¦æ”¹æ¯ä¸ªå‡½æ•° | åªéœ€ä¿®æ”¹è£…é¥°å™¨ | `ç»´æŠ¤ç®€å•` |
| ä¸šåŠ¡é€»è¾‘å’Œè¾…åŠ©åŠŸèƒ½æ··åœ¨ä¸€èµ· | åŠŸèƒ½åˆ†ç¦»ï¼Œä»£ç æ¸…æ™° | `å…³æ³¨ç‚¹åˆ†ç¦»` |

**ğŸ¯ å¸¸è§åº”ç”¨åœºæ™¯**
- **â° æ€§èƒ½ç›‘æ§**ï¼šæµ‹é‡å‡½æ•°æ‰§è¡Œæ—¶é—´
- **ğŸ“ æ—¥å¿—è®°å½•**ï¼šè®°å½•å‡½æ•°è°ƒç”¨ä¿¡æ¯
- **ğŸ” æƒé™éªŒè¯**ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™
- **ğŸ’¾ ç¼“å­˜ç»“æœ**ï¼šé¿å…é‡å¤è®¡ç®—
- **ğŸ”„ é‡è¯•æœºåˆ¶**ï¼šå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•

---

## 2. ğŸ”§ å‡½æ•°ä½œä¸ºç¬¬ä¸€ç±»å¯¹è±¡


### 2.1 ä»€ä¹ˆå«"ç¬¬ä¸€ç±»å¯¹è±¡"


**ğŸ”¸ é€šä¿—è§£é‡Š**
åœ¨Pythonä¸­ï¼Œå‡½æ•°å°±åƒå˜é‡ä¸€æ ·ï¼Œå¯ä»¥ï¼š
- èµ‹å€¼ç»™å˜é‡
- ä½œä¸ºå‚æ•°ä¼ é€’
- ä½œä¸ºè¿”å›å€¼
- å­˜å‚¨åœ¨æ•°æ®ç»“æ„ä¸­

```python
# 1. å‡½æ•°å¯ä»¥èµ‹å€¼ç»™å˜é‡
def greet(name):
    return f"Hello, {name}!"

# æŠŠå‡½æ•°èµ‹å€¼ç»™å˜é‡
my_func = greet
print(my_func("Alice"))  # Hello, Alice!

# 2. å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’
def call_twice(func, arg):
    """è°ƒç”¨å‡½æ•°ä¸¤æ¬¡"""
    func(arg)
    func(arg)

call_twice(print, "Hi!")  # è¾“å‡ºä¸¤æ¬¡ Hi!

# 3. å‡½æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼
def get_greeter():
    """è¿”å›ä¸€ä¸ªé—®å€™å‡½æ•°"""
    def say_hi(name):
        return f"Hi, {name}!"
    return say_hi

greeter = get_greeter()
print(greeter("Bob"))  # Hi, Bob!
```

### 2.2 å‡½æ•°å¯¹è±¡çš„å±æ€§


**ğŸ“‹ å‡½æ•°è‡ªå¸¦çš„ä¿¡æ¯**
```python
def calculate_area(radius):
    """è®¡ç®—åœ†çš„é¢ç§¯"""
    return 3.14 * radius * radius

# æŸ¥çœ‹å‡½æ•°çš„å±æ€§
print(f"å‡½æ•°å: {calculate_area.__name__}")
print(f"æ–‡æ¡£å­—ç¬¦ä¸²: {calculate_area.__doc__}")
print(f"å‡½æ•°ç±»å‹: {type(calculate_area)}")
```

**è¾“å‡º**ï¼š
```
å‡½æ•°å: calculate_area
æ–‡æ¡£å­—ç¬¦ä¸²: è®¡ç®—åœ†çš„é¢ç§¯
å‡½æ•°ç±»å‹: <class 'function'>
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**  
> æ­£å› ä¸ºå‡½æ•°æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ“ä½œå®ƒä»¬ï¼Œè¿™æ˜¯è£…é¥°å™¨èƒ½å¤Ÿå·¥ä½œçš„åŸºç¡€

---

## 3. ğŸ”— é—­åŒ…ä¸è£…é¥°å™¨å…³ç³»


### 3.1 ä»€ä¹ˆæ˜¯é—­åŒ…


**ğŸ”¸ ç®€å•ç†è§£**
é—­åŒ…å°±æ˜¯**å†…å±‚å‡½æ•°**å¯ä»¥**è®°ä½å¹¶ä½¿ç”¨**å¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œå³ä½¿å¤–å±‚å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
å°±åƒä½ å°æ—¶å€™å¦ˆå¦ˆç»™ä½ çš„é›¶èŠ±é’±ï¼Œ
å³ä½¿å¦ˆå¦ˆä¸åœ¨èº«è¾¹ï¼Œä½ ä¾ç„¶å¯ä»¥ä½¿ç”¨è¿™äº›é’±ã€‚
é—­åŒ…ä¸­çš„å†…å±‚å‡½æ•°å°±åƒæ˜¯ä½ ï¼Œ
å¤–å±‚å‡½æ•°çš„å˜é‡å°±åƒæ˜¯é›¶èŠ±é’±ã€‚
```

**ğŸ”¸ é—­åŒ…ç¤ºä¾‹**
```python
def outer_function(message):
    """å¤–å±‚å‡½æ•°"""
    def inner_function():
        """å†…å±‚å‡½æ•° - è¿™å°±æ˜¯é—­åŒ…"""
        print(f"æˆ‘è®°ä½äº†: {message}")
    return inner_function

# åˆ›å»ºé—­åŒ…
my_closure = outer_function("Hello from closure!")
my_closure()  # è¾“å‡º: æˆ‘è®°ä½äº†: Hello from closure!
```

### 3.2 é—­åŒ…åœ¨è£…é¥°å™¨ä¸­çš„ä½œç”¨


**è£…é¥°å™¨çš„å·¥ä½œåŸç†å›¾ç¤º**ï¼š
```
è£…é¥°å™¨å‡½æ•° (outer)
    â†“ æ¥æ”¶åŸå‡½æ•°ä½œä¸ºå‚æ•°
å†…å±‚åŒ…è£…å‡½æ•° (wrapper) â† è¿™æ˜¯é—­åŒ…!
    â†“ è®°ä½äº†åŸå‡½æ•°
è¿”å›åŒ…è£…å‡½æ•°
```

**å®é™…ä¾‹å­**ï¼š
```python
def timer_decorator(func):
    """è®¡æ—¶è£…é¥°å™¨ - ä½¿ç”¨é—­åŒ…"""
    import time
    
    def wrapper(*args, **kwargs):
        """å†…å±‚å‡½æ•°è®°ä½äº†å¤–å±‚çš„ func å‚æ•°"""
        start_time = time.time()
        result = func(*args, **kwargs)  # ä½¿ç”¨é—­åŒ…ä¸­çš„ func
        end_time = time.time()
        print(f"{func.__name__} æ‰§è¡Œæ—¶é—´: {end_time - start_time:.4f}ç§’")
        return result
    
    return wrapper

@timer_decorator
def slow_function():
    """ä¸€ä¸ªæ¯”è¾ƒæ…¢çš„å‡½æ•°"""
    import time
    time.sleep(1)
    return "å®Œæˆäº†!"

result = slow_function()
```

> ğŸ¯ **æ ¸å¿ƒç†è§£**  
> è£…é¥°å™¨åˆ©ç”¨é—­åŒ…æ¥"è®°ä½"è¢«è£…é¥°çš„åŸå‡½æ•°ï¼Œè¿™æ ·wrapperå‡½æ•°å°±èƒ½åœ¨éœ€è¦æ—¶è°ƒç”¨åŸå‡½æ•°

---

## 4. ğŸ¬ è£…é¥°å™¨è¯­æ³•ç³–è¯¦è§£


### 4.1 @ ç¬¦å·çš„ä½œç”¨


**ğŸ”¸ è¯­æ³•ç³–å¯¹æ¯”**

```python
# ä¸ä½¿ç”¨ @ çš„å†™æ³• (ç¹ç)
def my_function():
    print("åŸå§‹å‡½æ•°")

my_function = decorator(my_function)

# ä½¿ç”¨ @ çš„å†™æ³• (ç®€æ´)
@decorator
def my_function():
    print("åŸå§‹å‡½æ•°")
```

**ğŸ”¸ @ ç¬¦å·ç­‰ä»·å˜æ¢**
```python
# è¿™ä¸¤ç§å†™æ³•å®Œå…¨ç­‰ä»·:

# å†™æ³•1: ä½¿ç”¨@è£…é¥°å™¨
@timer_decorator
@log_decorator
def process_data():
    pass

# å†™æ³•2: æ‰‹åŠ¨è£…é¥°
def process_data():
    pass
process_data = timer_decorator(log_decorator(process_data))
```

### 4.2 å¤šå±‚è£…é¥°å™¨çš„æ‰§è¡Œé¡ºåº


**æ‰§è¡Œé¡ºåºå›¾ç¤º**ï¼š
```
@decorator_a    â† æœ€åæ‰§è¡Œ
@decorator_b    â† ä¸­é—´æ‰§è¡Œ  
@decorator_c    â† æœ€å…ˆæ‰§è¡Œ
def my_func():
    pass

ç­‰ä»·äº: decorator_a(decorator_b(decorator_c(my_func)))
```

**å®é™…ç¤ºä¾‹**ï¼š
```python
def bold(func):
    def wrapper(*args, **kwargs):
        result = func(*args, **kwargs)
        return f"<b>{result}</b>"
    return wrapper

def italic(func):
    def wrapper(*args, **kwargs):
        result = func(*args, **kwargs)
        return f"<i>{result}</i>"
    return wrapper

@bold
@italic
def say_hello(name):
    return f"Hello, {name}!"

print(say_hello("World"))  # <b><i>Hello, World!</i></b>
```

---

## 5. ğŸ› ï¸ functools.wrapsä½¿ç”¨


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ functools.wraps


**ğŸ”¸ é—®é¢˜æ¼”ç¤º**
```python
def simple_decorator(func):
    def wrapper(*args, **kwargs):
        """è¿™æ˜¯åŒ…è£…å‡½æ•°"""
        return func(*args, **kwargs)
    return wrapper

@simple_decorator
def greet(name):
    """é—®å€™å‡½æ•°ï¼šå‘æŸäººæ‰“æ‹›å‘¼"""
    return f"Hello, {name}!"

# æŸ¥çœ‹å‡½æ•°ä¿¡æ¯
print(f"å‡½æ•°å: {greet.__name__}")      # wrapper (ä¸æ˜¯greet!)
print(f"æ–‡æ¡£: {greet.__doc__}")         # è¿™æ˜¯åŒ…è£…å‡½æ•° (ä¸æ˜¯åŸå§‹æ–‡æ¡£!)
```

**âš ï¸ é—®é¢˜**ï¼šè£…é¥°åçš„å‡½æ•°å¤±å»äº†åŸå§‹çš„å‡½æ•°åå’Œæ–‡æ¡£

### 5.2 ä½¿ç”¨ functools.wraps è§£å†³


```python
from functools import wraps

def better_decorator(func):
    @wraps(func)  # å…³é”®ï¼šä¿ç•™åŸå‡½æ•°çš„å…ƒä¿¡æ¯
    def wrapper(*args, **kwargs):
        """è¿™æ˜¯åŒ…è£…å‡½æ•°"""
        print(f"è°ƒç”¨ {func.__name__}")
        return func(*args, **kwargs)
    return wrapper

@better_decorator
def greet(name):
    """é—®å€™å‡½æ•°ï¼šå‘æŸäººæ‰“æ‹›å‘¼"""
    return f"Hello, {name}!"

# ç°åœ¨å‡½æ•°ä¿¡æ¯æ­£ç¡®äº†
print(f"å‡½æ•°å: {greet.__name__}")      # greet âœ“
print(f"æ–‡æ¡£: {greet.__doc__}")         # é—®å€™å‡½æ•°ï¼šå‘æŸäººæ‰“æ‹›å‘¼ âœ“
```

> ğŸ’¡ **æœ€ä½³å®è·µ**  
> ç¼–å†™è£…é¥°å™¨æ—¶ï¼Œ**æ€»æ˜¯ä½¿ç”¨ @wraps(func)**ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼

### 5.3 wraps çš„ä½œç”¨åŸç†


**ğŸ“Š å…ƒä¿¡æ¯å¤åˆ¶è¡¨**

| **å±æ€§** | **å«ä¹‰** | **wrapså‰** | **wrapså** |
|---------|---------|------------|------------|
| `__name__` | å‡½æ•°å | `wrapper` | `åŸå‡½æ•°å` |
| `__doc__` | æ–‡æ¡£å­—ç¬¦ä¸² | `wrapperçš„æ–‡æ¡£` | `åŸå‡½æ•°æ–‡æ¡£` |
| `__module__` | æ¨¡å—å | `è£…é¥°å™¨æ¨¡å—` | `åŸå‡½æ•°æ¨¡å—` |
| `__annotations__` | ç±»å‹æ³¨è§£ | `ç©º` | `åŸå‡½æ•°æ³¨è§£` |

---

## 6. â° è£…é¥°å™¨æ‰§è¡Œæ—¶æœº


### 6.1 è£…é¥°å™¨ä½•æ—¶æ‰§è¡Œ


**ğŸ”¸ å…³é”®ç†è§£**
```python
print("=== æ¨¡å—å¯¼å…¥æ—¶ ===")

def my_decorator(func):
    print(f"è£…é¥°å™¨æ­£åœ¨è£…é¥° {func.__name__}")  # å¯¼å…¥æ—¶æ‰§è¡Œ
    
    def wrapper():
        print(f"wrapperæ­£åœ¨æ‰§è¡Œ")  # è°ƒç”¨æ—¶æ‰§è¡Œ
        return func()
    return wrapper

@my_decorator
def say_hello():
    print("Hello!")

print("=== å‡½æ•°å®šä¹‰å®Œæˆ ===")
print("=== å¼€å§‹è°ƒç”¨å‡½æ•° ===")
say_hello()
```

**è¾“å‡ºç»“æœ**ï¼š
```
=== æ¨¡å—å¯¼å…¥æ—¶ ===
è£…é¥°å™¨æ­£åœ¨è£…é¥° say_hello  â† è£…é¥°å™¨ç«‹å³æ‰§è¡Œ
=== å‡½æ•°å®šä¹‰å®Œæˆ ===
=== å¼€å§‹è°ƒç”¨å‡½æ•° ===
wrapperæ­£åœ¨æ‰§è¡Œ          â† wrapperåœ¨è°ƒç”¨æ—¶æ‰§è¡Œ
Hello!
```

### 6.2 æ‰§è¡Œæ—¶æœºçš„å®é™…å½±å“


**æ—¶æœºå›¾ç¤º**ï¼š
```
Pythonè§£é‡Šå™¨æ‰§è¡Œæµç¨‹:
æ–‡ä»¶å¯¼å…¥ â†’ é‡åˆ°@decorator â†’ ç«‹å³æ‰§è¡Œè£…é¥°å™¨ â†’ æ›¿æ¢åŸå‡½æ•°
                                â†“
                        æ­¤æ—¶è¿˜æ²¡æœ‰è°ƒç”¨å‡½æ•°!
```

**å®é™…æ¡ˆä¾‹**ï¼š
```python
import time

def timestamp_decorator(func):
    """åœ¨è£…é¥°æ—¶è®°å½•æ—¶é—´æˆ³"""
    decoration_time = time.time()
    print(f"å‡½æ•° {func.__name__} åœ¨ {decoration_time} è¢«è£…é¥°")
    
    def wrapper():
        call_time = time.time()
        print(f"å‡½æ•°åœ¨ {call_time} è¢«è°ƒç”¨")
        print(f"è£…é¥°å‘ç”Ÿåœ¨ {call_time - decoration_time:.2f} ç§’å‰")
        return func()
    return wrapper

@timestamp_decorator
def my_function():
    return "æ‰§è¡Œå®Œæˆ"

# ç­‰å¾…2ç§’åè°ƒç”¨
time.sleep(2)
my_function()
```

---

## 7. ğŸ› è£…é¥°å™¨è°ƒè¯•æŠ€å·§


### 7.1 è°ƒè¯•è£…é¥°å™¨çš„å¸¸è§é—®é¢˜


**ğŸ”¸ é—®é¢˜1ï¼šè£…é¥°å™¨ä¸ç”Ÿæ•ˆ**
```python
# é”™è¯¯å†™æ³• - å¿˜è®°è¿”å›wrapper
def broken_decorator(func):
    def wrapper():
        print("æ‰§è¡Œå‰")
        func()
        print("æ‰§è¡Œå")
    # å¿˜è®° return wrapper!

# æ­£ç¡®å†™æ³•
def working_decorator(func):
    def wrapper():
        print("æ‰§è¡Œå‰")
        func()
        print("æ‰§è¡Œå")
    return wrapper  # å¿…é¡»è¿”å›!
```

**ğŸ”¸ é—®é¢˜2ï¼šå‚æ•°ä¼ é€’é”™è¯¯**
```python
# åªèƒ½è£…é¥°æ— å‚æ•°å‡½æ•° - å±€é™æ€§å¤§
def limited_decorator(func):
    def wrapper():  # æ²¡æœ‰*args, **kwargs
        return func()  # æ— æ³•ä¼ é€’å‚æ•°
    return wrapper

# é€šç”¨è£…é¥°å™¨ - æ¨èå†™æ³•
def universal_decorator(func):
    @wraps(func)
    def wrapper(*args, **kwargs):  # æ¥å—ä»»æ„å‚æ•°
        print(f"è°ƒç”¨ {func.__name__} å‚æ•°: args={args}, kwargs={kwargs}")
        return func(*args, **kwargs)  # ä¼ é€’æ‰€æœ‰å‚æ•°
    return wrapper
```

### 7.2 è°ƒè¯•æŠ€å·§å’Œå·¥å…·


**ğŸ”§ è°ƒè¯•æŠ€å·§æ¸…å•**

> ğŸ” **è°ƒè¯•æ£€æŸ¥ç‚¹**  
> 1. ç¡®è®¤è£…é¥°å™¨æœ‰ `return wrapper`
> 2. wrapperå‡½æ•°ä½¿ç”¨ `*args, **kwargs`
> 3. ä½¿ç”¨ `@wraps(func)` ä¿ç•™å…ƒä¿¡æ¯
> 4. æ£€æŸ¥è¿”å›å€¼æ˜¯å¦æ­£ç¡®ä¼ é€’

**è°ƒè¯•å·¥å…·ç¤ºä¾‹**ï¼š
```python
from functools import wraps

def debug_decorator(func):
    """ç”¨äºè°ƒè¯•çš„è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        print(f"ğŸ” è°ƒè¯•ä¿¡æ¯:")
        print(f"  å‡½æ•°å: {func.__name__}")
        print(f"  ä½ç½®å‚æ•°: {args}")
        print(f"  å…³é”®å­—å‚æ•°: {kwargs}")
        
        try:
            result = func(*args, **kwargs)
            print(f"  è¿”å›å€¼: {result}")
            return result
        except Exception as e:
            print(f"  âŒ å¼‚å¸¸: {e}")
            raise
    return wrapper

@debug_decorator
def divide(a, b):
    """é™¤æ³•å‡½æ•°"""
    return a / b

# æµ‹è¯•
divide(10, 2)  # æ­£å¸¸æƒ…å†µ
divide(10, 0)  # å¼‚å¸¸æƒ…å†µ
```

---

## 8. ğŸ¨ è£…é¥°å™¨è®¾è®¡æ¨¡å¼


### 8.1 å¸¦å‚æ•°çš„è£…é¥°å™¨


**ğŸ”¸ è®¾è®¡æ€è·¯**
```
æ™®é€šè£…é¥°å™¨: @decorator
å¸¦å‚æ•°è£…é¥°å™¨: @decorator(args)
              â†“
éœ€è¦ä¸‰å±‚å‡½æ•°: å‚æ•°å¤„ç†å±‚ â†’ è£…é¥°å™¨å±‚ â†’ åŒ…è£…å±‚
```

**å®ç°ç¤ºä¾‹**ï¼š
```python
def repeat(times):
    """é‡å¤æ‰§è¡Œè£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for i in range(times):
                print(f"ç¬¬ {i+1} æ¬¡æ‰§è¡Œ:")
                result = func(*args, **kwargs)
            return result
        return wrapper
    return decorator

# ä½¿ç”¨å¸¦å‚æ•°çš„è£…é¥°å™¨
@repeat(times=3)
def say_hello(name):
    print(f"Hello, {name}!")

say_hello("Alice")
```

### 8.2 ç±»è£…é¥°å™¨


**ğŸ”¸ ä½¿ç”¨ç±»å®ç°è£…é¥°å™¨**
```python
class CallCounter:
    """è°ƒç”¨è®¡æ•°è£…é¥°å™¨"""
    
    def __init__(self, func):
        self.func = func
        self.count = 0
        # ä¿ç•™åŸå‡½æ•°ä¿¡æ¯
        self.__name__ = func.__name__
        self.__doc__ = func.__doc__
    
    def __call__(self, *args, **kwargs):
        self.count += 1
        print(f"{self.func.__name__} è¢«è°ƒç”¨äº† {self.count} æ¬¡")
        return self.func(*args, **kwargs)

@CallCounter
def greet(name):
    """é—®å€™å‡½æ•°"""
    return f"Hello, {name}!"

# æµ‹è¯•
greet("Alice")  # greet è¢«è°ƒç”¨äº† 1 æ¬¡
greet("Bob")    # greet è¢«è°ƒç”¨äº† 2 æ¬¡
print(f"æ€»è°ƒç”¨æ¬¡æ•°: {greet.count}")
```

### 8.3 å®ç”¨è£…é¥°å™¨æ¨¡å¼


**ğŸ“Š å¸¸ç”¨è£…é¥°å™¨æ¨¡å¼æ±‡æ€»**

| **æ¨¡å¼** | **ç”¨é€”** | **ç‰¹ç‚¹** |
|---------|---------|---------|
| **ç¼“å­˜è£…é¥°å™¨** | ç¼“å­˜å‡½æ•°ç»“æœ | ç©ºé—´æ¢æ—¶é—´ |
| **é‡è¯•è£…é¥°å™¨** | å¤±è´¥è‡ªåŠ¨é‡è¯• | æé«˜ç¨³å®šæ€§ |
| **é™æµè£…é¥°å™¨** | æ§åˆ¶è°ƒç”¨é¢‘ç‡ | é˜²æ­¢è¿‡è½½ |
| **æƒé™è£…é¥°å™¨** | æƒé™æ£€æŸ¥ | å®‰å…¨æ§åˆ¶ |

**ç¼“å­˜è£…é¥°å™¨ç¤ºä¾‹**ï¼š
```python
def simple_cache(func):
    """ç®€å•ç¼“å­˜è£…é¥°å™¨"""
    cache = {}
    
    @wraps(func)
    def wrapper(*args, **kwargs):
        # åˆ›å»ºç¼“å­˜é”®
        key = str(args) + str(sorted(kwargs.items()))
        
        if key in cache:
            print(f"ğŸ’¾ ç¼“å­˜å‘½ä¸­: {func.__name__}")
            return cache[key]
        
        print(f"ğŸ”„ è®¡ç®—ä¸­: {func.__name__}")
        result = func(*args, **kwargs)
        cache[key] = result
        return result
    
    # æ·»åŠ ç¼“å­˜æ¸…ç†æ–¹æ³•
    wrapper.clear_cache = lambda: cache.clear()
    return wrapper

@simple_cache
def fibonacci(n):
    """æ–æ³¢é‚£å¥‘æ•°åˆ—"""
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# æµ‹è¯•ç¼“å­˜æ•ˆæœ
print(fibonacci(10))  # ç¬¬ä¸€æ¬¡è®¡ç®—
print(fibonacci(10))  # ç¬¬äºŒæ¬¡ä½¿ç”¨ç¼“å­˜
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è£…é¥°å™¨æœ¬è´¨ï¼šæ¥æ”¶å‡½æ•°ï¼Œè¿”å›æ–°å‡½æ•°çš„é«˜é˜¶å‡½æ•°
ğŸ”¸ å‡½æ•°å¯¹è±¡ï¼šPythonä¸­å‡½æ•°æ˜¯ç¬¬ä¸€ç±»å¯¹è±¡ï¼Œå¯ä»¥ä¼ é€’å’Œæ“ä½œ
ğŸ”¸ é—­åŒ…æœºåˆ¶ï¼šå†…å±‚å‡½æ•°è®°ä½å¤–å±‚å‡½æ•°çš„å˜é‡
ğŸ”¸ è¯­æ³•ç³–@ï¼šç®€åŒ–è£…é¥°å™¨çš„ä½¿ç”¨è¯­æ³•
ğŸ”¸ functools.wrapsï¼šä¿ç•™åŸå‡½æ•°çš„å…ƒä¿¡æ¯
ğŸ”¸ æ‰§è¡Œæ—¶æœºï¼šè£…é¥°åœ¨å¯¼å…¥æ—¶ï¼Œwrapperåœ¨è°ƒç”¨æ—¶
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è£…é¥°å™¨çš„å·¥ä½œæµç¨‹**
```
1. å®šä¹‰è£…é¥°å™¨å‡½æ•° (æ¥æ”¶funcå‚æ•°)
2. å†…éƒ¨å®šä¹‰wrapperå‡½æ•° (é—­åŒ…)
3. wrapperä¸­è°ƒç”¨åŸå‡½æ•°
4. è¿”å›wrapperå‡½æ•°
5. ç”¨@è¯­æ³•ç³–åº”ç”¨è£…é¥°å™¨
```

**ğŸ”¹ å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•**
```
âŒ å¿˜è®°return wrapper â†’ è£…é¥°å™¨ä¸ç”Ÿæ•ˆ
âŒ wrapperä¸ç”¨*args,**kwargs â†’ å‚æ•°ä¼ é€’å¤±è´¥  
âŒ ä¸ç”¨@wraps â†’ å¤±å»åŸå‡½æ•°ä¿¡æ¯
âŒ æ··æ·†æ‰§è¡Œæ—¶æœº â†’ è°ƒè¯•å›°éš¾

âœ… æ€»æ˜¯return wrapper
âœ… ä½¿ç”¨é€šç”¨å‚æ•°æ¥æ”¶
âœ… æ·»åŠ @wraps(func)
âœ… ç†è§£è£…é¥°æ—¶æœºå’Œè°ƒç”¨æ—¶æœº
```

**ğŸ”¹ è£…é¥°å™¨è®¾è®¡åŸåˆ™**
```
å•ä¸€èŒè´£ï¼šæ¯ä¸ªè£…é¥°å™¨åªåšä¸€ä»¶äº‹
å¯ç»„åˆæ€§ï¼šå¤šä¸ªè£…é¥°å™¨å¯ä»¥å åŠ ä½¿ç”¨
é€æ˜æ€§ï¼šå¯¹åŸå‡½æ•°è°ƒç”¨æ–¹å¼æ— å½±å“
å¯è°ƒè¯•æ€§ï¼šä¿ç•™åŸå‡½æ•°ä¿¡æ¯ï¼Œä¾¿äºè°ƒè¯•
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é€‰æ‹©è£…é¥°å™¨çš„åœºæ™¯**
- âœ… éœ€è¦ç»™å¤šä¸ªå‡½æ•°æ·»åŠ ç›¸åŒåŠŸèƒ½
- âœ… æƒ³è¦åˆ†ç¦»ä¸»è¦é€»è¾‘å’Œè¾…åŠ©åŠŸèƒ½  
- âœ… éœ€è¦åœ¨å‡½æ•°æ‰§è¡Œå‰ååšå¤„ç†
- âœ… è¦ä¿æŒä»£ç ç®€æ´å’Œå¯ç»´æŠ¤æ€§

**ğŸ”§ è£…é¥°å™¨æœ€ä½³å®è·µ**
```python
from functools import wraps

def template_decorator(func):
    """è£…é¥°å™¨æ¨¡æ¿"""
    @wraps(func)  # æ€»æ˜¯æ·»åŠ è¿™è¡Œ
    def wrapper(*args, **kwargs):  # ä½¿ç”¨é€šç”¨å‚æ•°
        # æ‰§è¡Œå‰çš„å¤„ç†
        print(f"è°ƒç”¨ {func.__name__}")
        
        try:
            result = func(*args, **kwargs)
            # æ‰§è¡Œåçš„å¤„ç†
            return result
        except Exception as e:
            # å¼‚å¸¸å¤„ç†
            print(f"æ‰§è¡Œå‡ºé”™: {e}")
            raise
    
    return wrapper  # ä¸è¦å¿˜è®°è¿”å›!
```

**ğŸ¨ è¿›é˜¶å­¦ä¹ æ–¹å‘**
- **propertyè£…é¥°å™¨**ï¼šåˆ›å»ºå±æ€§çš„getter/setter
- **lru_cacheè£…é¥°å™¨**ï¼šå†…ç½®çš„ç¼“å­˜è£…é¥°å™¨
- **è£…é¥°å™¨å·¥å‚**ï¼šæ›´å¤æ‚çš„å‚æ•°åŒ–è£…é¥°å™¨
- **æè¿°ç¬¦åè®®**ï¼šæ›´åº•å±‚çš„è£…é¥°æœºåˆ¶

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è£…é¥°å™¨åŒ…è£…çœŸå‡½æ•°ï¼Œé—­åŒ…è®°ä½å¤–å±‚å˜é‡
è¯­æ³•ç³–@æ¥ç®€åŒ–ï¼Œwrapsä¿ç•™åŸä¿¡æ¯
æ‰§è¡Œæ—¶æœºè¦åˆ†æ¸…ï¼Œå¯¼å…¥è£…é¥°è°ƒç”¨åŒ…è£…
è°ƒè¯•æŠ€å·§å¤šå®è·µï¼Œè®¾è®¡æ¨¡å¼çµæ´»ç”¨
```