---
title: 8ã€æ€§èƒ½æµ‹é‡å·¥å…·
---
## ğŸ“š ç›®å½•

1. [æ€§èƒ½æµ‹é‡åŸºç¡€æ¦‚å¿µ](#1-æ€§èƒ½æµ‹é‡åŸºç¡€æ¦‚å¿µ)
2. [timeitæ¨¡å—ï¼šç²¾ç¡®è®¡æ—¶å·¥å…·](#2-timeitæ¨¡å—ç²¾ç¡®è®¡æ—¶å·¥å…·)
3. [timeæ¨¡å—ï¼šåŸºç¡€è®¡æ—¶æ–¹æ³•](#3-timeæ¨¡å—åŸºç¡€è®¡æ—¶æ–¹æ³•)
4. [cProfileï¼šå…¨é¢æ€§èƒ½åˆ†æ](#4-cProfileå…¨é¢æ€§èƒ½åˆ†æ)
5. [profileæ¨¡å—ï¼šæ ‡å‡†æ€§èƒ½åˆ†æ](#5-profileæ¨¡å—æ ‡å‡†æ€§èƒ½åˆ†æ)
6. [pstatsï¼šç»Ÿè®¡åˆ†æå·¥å…·](#6-pstatsç»Ÿè®¡åˆ†æå·¥å…·)
7. [line_profilerï¼šé€è¡Œæ€§èƒ½åˆ†æ](#7-line_profileré€è¡Œæ€§èƒ½åˆ†æ)
8. [memory_profilerï¼šå†…å­˜ä½¿ç”¨ç›‘æ§](#8-memory_profilerå†…å­˜ä½¿ç”¨ç›‘æ§)
9. [æ€§èƒ½åŸºå‡†æµ‹è¯•æ–¹æ³•](#9-æ€§èƒ½åŸºå‡†æµ‹è¯•æ–¹æ³•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ€§èƒ½æµ‹é‡åŸºç¡€æ¦‚å¿µ


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦æ€§èƒ½æµ‹é‡


**ç®€å•ç†è§£**ï¼šå°±åƒä½“æ£€å¯ä»¥å‘ç°èº«ä½“é—®é¢˜ä¸€æ ·ï¼Œæ€§èƒ½æµ‹é‡èƒ½å¸®æˆ‘ä»¬æ‰¾åˆ°ä»£ç çš„"å¥åº·é—®é¢˜"

```
æ—¥å¸¸ç¼–ç¨‹ä¸­çš„å›°æƒ‘ï¼š
â“ æˆ‘çš„ç¨‹åºä¸ºä»€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿ
â“ å“ªä¸ªå‡½æ•°æœ€è€—æ—¶ï¼Ÿ
â“ å†…å­˜ç”¨äº†å¤šå°‘ï¼Ÿ
â“ ä»£ç çš„å“ªä¸€è¡Œæœ‰é—®é¢˜ï¼Ÿ

æ€§èƒ½æµ‹é‡å¸®ä½ å›ç­”ï¼š
âœ… å‡†ç¡®çŸ¥é“ç¨‹åºè¿è¡Œæ—¶é—´
âœ… æ‰¾å‡ºæœ€è€—æ—¶çš„å‡½æ•°
âœ… ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
âœ… å®šä½å…·ä½“çš„æ€§èƒ½ç“¶é¢ˆ
```

### 1.2 æ€§èƒ½æµ‹é‡çš„æ ¸å¿ƒæŒ‡æ ‡


| æŒ‡æ ‡ç±»å‹ | **å«ä¹‰** | **é‡è¦æ€§** | **æµ‹é‡å·¥å…·** |
|---------|----------|-----------|-------------|
| â±ï¸ **æ‰§è¡Œæ—¶é—´** | `ä»£ç è¿è¡ŒèŠ±è´¹çš„æ—¶é—´` | `ğŸ”¥ æœ€åŸºç¡€` | `timeit, time` |
| ğŸ”¢ **å‡½æ•°è°ƒç”¨æ¬¡æ•°** | `æ¯ä¸ªå‡½æ•°è¢«è°ƒç”¨å¤šå°‘æ¬¡` | `âš¡ å¾ˆé‡è¦` | `cProfile, profile` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `ç¨‹åºå ç”¨å¤šå°‘å†…å­˜` | `ğŸ’¡ å…³é”®` | `memory_profiler` |
| ğŸ“Š **é€è¡Œåˆ†æ** | `æ¯ä¸€è¡Œä»£ç çš„è€—æ—¶` | `ğŸ¯ ç²¾ç¡®` | `line_profiler` |

### 1.3 é€‰æ‹©åˆé€‚çš„å·¥å…·


**ğŸ§  è®°å¿†æŠ€å·§**ï¼š
- **å¿«é€Ÿè®¡æ—¶** â†’ timeitï¼ˆåƒç§’è¡¨ï¼‰
- **å…¨é¢ä½“æ£€** â†’ cProfileï¼ˆåƒå…¨èº«æ£€æŸ¥ï¼‰
- **é€è¡Œè¯Šæ–­** â†’ line_profilerï¼ˆåƒæ˜¾å¾®é•œï¼‰
- **å†…å­˜ç›‘æ§** â†’ memory_profilerï¼ˆåƒå†…å­˜ä»ªè¡¨ç›˜ï¼‰

---

## 2. â±ï¸ timeitæ¨¡å—ï¼šç²¾ç¡®è®¡æ—¶å·¥å…·


### 2.1 ä»€ä¹ˆæ˜¯timeit


**é€šä¿—è§£é‡Š**ï¼štimeitå°±åƒä¸€ä¸ªéå¸¸ç²¾å‡†çš„ç§’è¡¨ï¼Œä¸“é—¨ç”¨æ¥æµ‹é‡å°æ®µä»£ç çš„è¿è¡Œæ—¶é—´

**ä¸ºä»€ä¹ˆç”¨timeitè€Œä¸æ˜¯time**ï¼š
```
æ™®é€šç§’è¡¨ï¼ˆtimeï¼‰çš„é—®é¢˜ï¼š
â€¢ æµ‹ä¸€æ¬¡ä¸å‡†ç¡®ï¼ˆå¯èƒ½æœ‰è¯¯å·®ï¼‰
â€¢ ç³»ç»Ÿå…¶ä»–ç¨‹åºä¼šå¹²æ‰°
â€¢ ç²¾åº¦ä¸å¤Ÿé«˜

ä¸“ä¸šç§’è¡¨ï¼ˆtimeitï¼‰çš„ä¼˜åŠ¿ï¼š
â€¢ è‡ªåŠ¨æµ‹é‡å¤šæ¬¡å–å¹³å‡å€¼
â€¢ æš‚æ—¶å…³é—­åƒåœ¾å›æ”¶å™¨
â€¢ æä¾›æœ€é«˜ç²¾åº¦çš„æµ‹é‡
```

### 2.2 åŸºç¡€ä½¿ç”¨æ–¹æ³•


**å‘½ä»¤è¡Œä½¿ç”¨**ï¼š
```bash
# æµ‹è¯•ä¸€ä¸ªç®€å•è¡¨è¾¾å¼
python -m timeit "2 + 2"

# æµ‹è¯•åˆ—è¡¨æ“ä½œ
python -m timeit "list(range(100))"

# æµ‹è¯•å­—ç¬¦ä¸²æ“ä½œ
python -m timeit "''.join(map(str, range(100)))"
```

**Pythonä»£ç ä¸­ä½¿ç”¨**ï¼š
```python
import timeit

# æ–¹æ³•1ï¼šæµ‹è¯•ç®€å•è¡¨è¾¾å¼
time_cost = timeit.timeit('2 + 2', number=1000000)
print(f"æ‰§è¡Œ100ä¸‡æ¬¡ç”¨æ—¶ï¼š{time_cost:.6f}ç§’")

# æ–¹æ³•2ï¼šæµ‹è¯•å‡½æ•°
def my_function():
    return sum(range(100))

time_cost = timeit.timeit(my_function, number=10000)
print(f"æ‰§è¡Œ1ä¸‡æ¬¡ç”¨æ—¶ï¼š{time_cost:.6f}ç§’")
```

### 2.3 é«˜çº§ä½¿ç”¨æŠ€å·§


**ğŸ”§ setupå‚æ•°ï¼šå‡†å¤‡å·¥ä½œ**
```python
# æµ‹è¯•ä¸åŒçš„åˆ—è¡¨åˆ›å»ºæ–¹æ³•
test_code = """
result = []
for i in range(1000):
    result.append(i * 2)
"""

# å¯¹æ¯”åˆ—è¡¨æ¨å¯¼å¼
test_code2 = "[i * 2 for i in range(1000)]"

time1 = timeit.timeit(test_code, number=1000)
time2 = timeit.timeit(test_code2, number=1000)

print(f"å¾ªç¯æ–¹å¼ï¼š{time1:.6f}ç§’")
print(f"æ¨å¯¼å¼ï¼š{time2:.6f}ç§’")
print(f"æ¨å¯¼å¼å¿«äº†ï¼š{time1/time2:.2f}å€")
```

**ğŸ’¡ å®ç”¨æŠ€å·§**ï¼š
```python
# æŠ€å·§1ï¼šä½¿ç”¨repeatè·å¾—æ›´ç¨³å®šçš„ç»“æœ
times = timeit.repeat('sum(range(100))', number=10000, repeat=5)
print(f"æœ€å¿«æ—¶é—´ï¼š{min(times):.6f}ç§’")
print(f"å¹³å‡æ—¶é—´ï¼š{sum(times)/len(times):.6f}ç§’")

# æŠ€å·§2ï¼šæµ‹è¯•å¸¦å‚æ•°çš„å‡½æ•°
def test_function(n):
    return sum(range(n))

time_cost = timeit.timeit(
    lambda: test_function(100), 
    number=10000
)
```

### 2.4 å¸¸è§ä½¿ç”¨åœºæ™¯


**åœºæ™¯1ï¼šæ¯”è¾ƒç®—æ³•æ•ˆç‡**
```python
# æ¯”è¾ƒä¸åŒæ’åºæ–¹æ³•
import random

data_setup = "import random; data = list(range(1000)); random.shuffle(data)"

# å†…ç½®æ’åº
time1 = timeit.timeit("sorted(data)", setup=data_setup, number=1000)

# åˆ—è¡¨sortæ–¹æ³•  
time2 = timeit.timeit("data.sort(); data = list(range(1000)); random.shuffle(data)", 
                     setup=data_setup, number=1000)

print(f"sorted()æ–¹æ³•ï¼š{time1:.6f}ç§’")
print(f"sort()æ–¹æ³•ï¼š{time2:.6f}ç§’")
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
> ğŸ“ **é‡è¦æé†’**ï¼štimeité€‚åˆæµ‹è¯•çŸ­å°çš„ä»£ç ç‰‡æ®µï¼Œä¸è¦ç”¨æ¥æµ‹è¯•æ•´ä¸ªç¨‹åº
> 
> ğŸ’¡ **å°è´´å£«**ï¼šnumberå‚æ•°è¦æ ¹æ®ä»£ç å¤æ‚åº¦è°ƒæ•´ï¼Œç®€å•ä»£ç å¯ä»¥è®¾å¤§ä¸€äº›

---

## 3. ğŸ• timeæ¨¡å—ï¼šåŸºç¡€è®¡æ—¶æ–¹æ³•


### 3.1 timeæ¨¡å—çš„ä½œç”¨


**ç®€å•ç†è§£**ï¼štimeæ¨¡å—å°±åƒæ‰‹æœºä¸Šçš„è®¡æ—¶å™¨ï¼Œå¯ä»¥è®°å½•ç¨‹åºå¼€å§‹å’Œç»“æŸçš„æ—¶é—´

**ä»€ä¹ˆæ—¶å€™ç”¨time**ï¼š
- âœ… æµ‹è¯•æ•´ä¸ªç¨‹åºæˆ–å¤§æ®µä»£ç çš„è¿è¡Œæ—¶é—´
- âœ… åœ¨å®é™…è¿è¡Œä¸­ç›‘æ§æ€§èƒ½
- âœ… è®°å½•ç¨‹åºå„ä¸ªé˜¶æ®µçš„è€—æ—¶

### 3.2 åŸºç¡€è®¡æ—¶æ–¹æ³•


**æœ€ç®€å•çš„è®¡æ—¶æ–¹å¼**ï¼š
```python
import time

# è®°å½•å¼€å§‹æ—¶é—´
start_time = time.time()

# ä½ çš„ä»£ç 
for i in range(1000000):
    result = i * i

# è®°å½•ç»“æŸæ—¶é—´
end_time = time.time()

# è®¡ç®—è€—æ—¶
total_time = end_time - start_time
print(f"ç¨‹åºè¿è¡Œæ—¶é—´ï¼š{total_time:.4f}ç§’")
```

**æ›´ç²¾ç¡®çš„è®¡æ—¶**ï¼š
```python
import time

# perf_counter()æ›´é€‚åˆæµ‹é‡çŸ­æ—¶é—´é—´éš”
start = time.perf_counter()

# æ¨¡æ‹Ÿä¸€äº›è®¡ç®—
sum(i*i for i in range(100000))

end = time.perf_counter()
print(f"è®¡ç®—è€—æ—¶ï¼š{end - start:.6f}ç§’")
```

### 3.3 å®ç”¨çš„è®¡æ—¶å·¥å…·ç±»


**åˆ›å»ºä¸€ä¸ªé€šç”¨è®¡æ—¶å™¨**ï¼š
```python
class Timer:
    def __init__(self):
        self.start_time = None
        self.end_time = None
    
    def start(self):
        """å¼€å§‹è®¡æ—¶"""
        self.start_time = time.perf_counter()
        print("â±ï¸ å¼€å§‹è®¡æ—¶...")
    
    def stop(self):
        """åœæ­¢è®¡æ—¶"""
        self.end_time = time.perf_counter()
        if self.start_time:
            elapsed = self.end_time - self.start_time
            print(f"â° æ€»è€—æ—¶ï¼š{elapsed:.4f}ç§’")
            return elapsed
        else:
            print("âŒ è¯·å…ˆè°ƒç”¨start()æ–¹æ³•")

# ä½¿ç”¨ç¤ºä¾‹
timer = Timer()
timer.start()

# ä½ çš„ä»£ç 
time.sleep(1)  # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ

timer.stop()
```

**ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç‰ˆæœ¬**ï¼š
```python
import time
from contextlib import contextmanager

@contextmanager
def timer_context():
    start = time.perf_counter()
    yield
    end = time.perf_counter()
    print(f"â±ï¸ ä»£ç å—æ‰§è¡Œæ—¶é—´ï¼š{end - start:.4f}ç§’")

# ä½¿ç”¨æ–¹æ³•
with timer_context():
    # éœ€è¦è®¡æ—¶çš„ä»£ç 
    result = sum(range(1000000))
    print(f"è®¡ç®—ç»“æœï¼š{result}")
```

### 3.4 time vs timeitçš„é€‰æ‹©


| ä½¿ç”¨åœºæ™¯ | **æ¨èå·¥å…·** | **åŸå› ** |
|---------|-------------|----------|
| ğŸ”¬ **æµ‹è¯•å°ä»£ç ç‰‡æ®µ** | `timeit` | `ç²¾åº¦é«˜ï¼Œè‡ªåŠ¨é‡å¤æµ‹è¯•` |
| ğŸ—ï¸ **æµ‹è¯•æ•´ä¸ªç¨‹åº** | `time` | `ç®€å•ç›´æ¥ï¼Œé€‚åˆå¤§æ®µä»£ç ` |
| ğŸ“Š **æ€§èƒ½å¯¹æ¯”æµ‹è¯•** | `timeit` | `ç»“æœæ›´å¯é ` |
| ğŸ” **å®é™…è¿è¡Œç›‘æ§** | `time` | `åœ¨çœŸå®ç¯å¢ƒä¸­ä½¿ç”¨` |

---

## 4. ğŸ” cProfileï¼šå…¨é¢æ€§èƒ½åˆ†æ


### 4.1 ä»€ä¹ˆæ˜¯cProfile


**å½¢è±¡æ¯”å–»**ï¼šå¦‚æœè¯´timeitæ˜¯ç§’è¡¨ï¼Œé‚£ä¹ˆcProfileå°±æ˜¯"å…¨èº«ä½“æ£€ä»ª"

**cProfileèƒ½å‘Šè¯‰ä½ **ï¼š
```
è¯¦ç»†çš„æ€§èƒ½æŠ¥å‘Šï¼š
ğŸ“ˆ æ¯ä¸ªå‡½æ•°è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡
â±ï¸ æ¯ä¸ªå‡½æ•°æ€»å…±èŠ±è´¹å¤šå°‘æ—¶é—´
ğŸ¯ å“ªä¸ªå‡½æ•°æœ€è€—æ—¶
ğŸ“Š å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»
```

### 4.2 åŸºç¡€ä½¿ç”¨æ–¹æ³•


**å‘½ä»¤è¡Œä½¿ç”¨**ï¼š
```bash
# åˆ†ææ•´ä¸ªPythonæ–‡ä»¶
python -m cProfile my_program.py

# å°†ç»“æœä¿å­˜åˆ°æ–‡ä»¶
python -m cProfile -o profile_result.prof my_program.py

# æŒ‰æ—¶é—´æ’åºæ˜¾ç¤ºå‰10ä¸ªæœ€æ…¢çš„å‡½æ•°
python -m cProfile -s time my_program.py | head -20
```

**ä»£ç ä¸­ä½¿ç”¨**ï¼š
```python
import cProfile

def slow_function():
    """æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶å‡½æ•°"""
    total = 0
    for i in range(1000000):
        total += i * i
    return total

def fast_function():
    """æ¨¡æ‹Ÿä¸€ä¸ªå¿«é€Ÿå‡½æ•°"""
    return sum(i * i for i in range(1000))

def main():
    result1 = slow_function()
    result2 = fast_function()
    return result1, result2

# ä½¿ç”¨cProfileåˆ†æ
cProfile.run('main()')
```

### 4.3 ç†è§£åˆ†æç»“æœ


**åˆ†ææŠ¥å‘Šè§£è¯»**ï¼š
```
         5 function calls in 0.234 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    0.234    0.234 <string>:1(<module>)
        1    0.000    0.000    0.234    0.234 main.py:15(main)
        1    0.230    0.230    0.230    0.230 main.py:3(slow_function)
        1    0.004    0.004    0.004    0.004 main.py:9(fast_function)
        1    0.000    0.000    0.000    0.000 {method 'disable'}
```

**ğŸ“Š å„åˆ—å«ä¹‰è§£é‡Š**ï¼š
- **ncalls**ï¼šå‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼ˆè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨äº†å‡ æ¬¡ï¼‰
- **tottime**ï¼šå‡½æ•°æœ¬èº«çš„è¿è¡Œæ—¶é—´ï¼ˆä¸åŒ…æ‹¬è°ƒç”¨å…¶ä»–å‡½æ•°çš„æ—¶é—´ï¼‰
- **percall**ï¼šå¹³å‡æ¯æ¬¡è°ƒç”¨çš„æ—¶é—´ï¼ˆtottime Ã· ncallsï¼‰
- **cumtime**ï¼šç´¯è®¡æ—¶é—´ï¼ˆåŒ…æ‹¬è°ƒç”¨å…¶ä»–å‡½æ•°çš„æ—¶é—´ï¼‰
- **filename:lineno(function)**ï¼šå‡½æ•°ä½ç½®å’Œåç§°

### 4.4 é«˜çº§åˆ†ææŠ€å·§


**ä¿å­˜å’ŒåŠ è½½åˆ†æç»“æœ**ï¼š
```python
import cProfile
import pstats

# è¿è¡Œåˆ†æå¹¶ä¿å­˜
cProfile.run('main()', 'profile_data.prof')

# åŠ è½½å’Œåˆ†æä¿å­˜çš„æ•°æ®
stats = pstats.Stats('profile_data.prof')

# æŒ‰ç´¯è®¡æ—¶é—´æ’åºï¼Œæ˜¾ç¤ºå‰10ä¸ª
stats.sort_stats('cumulative').print_stats(10)

# åªæ˜¾ç¤ºç‰¹å®šå‡½æ•°
stats.print_stats('slow_function')
```

**å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨**ï¼š
```python
# è£…é¥°å™¨æ–¹å¼ä½¿ç”¨cProfile
import cProfile
from functools import wraps

def profile_function(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        pr = cProfile.Profile()
        pr.enable()
        result = func(*args, **kwargs)
        pr.disable()
        
        # æ‰“å°æ€§èƒ½åˆ†æç»“æœ
        pr.print_stats(sort='time')
        return result
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨
@profile_function
def my_slow_function():
    return sum(i*i for i in range(1000000))

# è°ƒç”¨æ—¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ€§èƒ½åˆ†æ
result = my_slow_function()
```

**ğŸ¯ å®ç”¨æŠ€å·§**ï¼š
> ğŸ’¡ **åˆ†æé‡ç‚¹**ï¼šä¸»è¦å…³æ³¨cumtimeæœ€å¤§çš„å‡½æ•°ï¼Œè¿™äº›é€šå¸¸æ˜¯æ€§èƒ½ç“¶é¢ˆ
> 
> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šcProfileä¼šå¢åŠ ç¨‹åºè¿è¡Œæ—¶é—´ï¼Œåªåœ¨æ€§èƒ½è°ƒä¼˜æ—¶ä½¿ç”¨

---

## 5. ğŸ“Š profileæ¨¡å—ï¼šæ ‡å‡†æ€§èƒ½åˆ†æ


### 5.1 profile vs cProfile


**ç®€å•åŒºåˆ«**ï¼š
- **cProfile**ï¼šCè¯­è¨€å®ç°ï¼Œé€Ÿåº¦å¿«ï¼Œæ¨èä½¿ç”¨
- **profile**ï¼šçº¯Pythonå®ç°ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†æ›´å®¹æ˜“æ‰©å±•

**ğŸ’¡ è®°å¿†æ–¹æ³•**ï¼š
- æ—¥å¸¸ä½¿ç”¨ â†’ cProfileï¼ˆcä»£è¡¨å¿«é€Ÿï¼‰
- ç‰¹æ®Šéœ€æ±‚ â†’ profileï¼ˆéœ€è¦è‡ªå®šä¹‰åŠŸèƒ½æ—¶ï¼‰

### 5.2 profileçš„ç‰¹æ®Šç”¨æ³•


**è‡ªå®šä¹‰åˆ†æå™¨**ï¼š
```python
import profile
import sys

class CustomProfiler(profile.Profile):
    def __init__(self):
        super().__init__()
        self.call_count = {}
    
    def trace_dispatch_call(self, frame, t):
        # è‡ªå®šä¹‰è°ƒç”¨è·Ÿè¸ª
        func_name = frame.f_code.co_name
        self.call_count[func_name] = self.call_count.get(func_name, 0) + 1
        return super().trace_dispatch_call(frame, t)

# ä½¿ç”¨è‡ªå®šä¹‰åˆ†æå™¨
profiler = CustomProfiler()
profiler.run('main()')
```

**åŸºç¡€ä½¿ç”¨ï¼ˆä¸cProfileç±»ä¼¼ï¼‰**ï¼š
```python
import profile

def test_function():
    numbers = list(range(100000))
    return sum(x * x for x in numbers)

# åˆ†æå‡½æ•°æ€§èƒ½
profile.run('test_function()')
```

---

## 6. ğŸ“ˆ pstatsï¼šç»Ÿè®¡åˆ†æå·¥å…·


### 6.1 ä»€ä¹ˆæ˜¯pstats


**ç®€å•ç†è§£**ï¼špstatså°±åƒExcelä¸€æ ·ï¼Œå¯ä»¥å¯¹cProfileçš„ç»“æœè¿›è¡Œå„ç§ç»Ÿè®¡å’Œåˆ†æ

**ä¸»è¦åŠŸèƒ½**ï¼š
```
æ•°æ®å¤„ç†åŠŸèƒ½ï¼š
ğŸ“Š æ’åºï¼ˆæŒ‰æ—¶é—´ã€è°ƒç”¨æ¬¡æ•°ç­‰ï¼‰
ğŸ” è¿‡æ»¤ï¼ˆåªçœ‹ç‰¹å®šå‡½æ•°ï¼‰
ğŸ“ˆ ç»Ÿè®¡ï¼ˆè®¡ç®—ç™¾åˆ†æ¯”ã€å¹³å‡å€¼ç­‰ï¼‰
ğŸ’¾ ä¿å­˜ï¼ˆå¯¼å‡ºåˆ†æç»“æœï¼‰
```

### 6.2 åŸºç¡€ä½¿ç”¨æ–¹æ³•


```python
import cProfile
import pstats

# é¦–å…ˆç”Ÿæˆæ€§èƒ½æ•°æ®
def example_function():
    # æ¨¡æ‹Ÿä¸€äº›è®¡ç®—
    data = []
    for i in range(100000):
        data.append(i ** 2)
    return sum(data)

# è¿è¡Œåˆ†æ
cProfile.run('example_function()', 'performance.prof')

# ä½¿ç”¨pstatsåˆ†æç»“æœ
stats = pstats.Stats('performance.prof')

# æŒ‰ä¸åŒæ–¹å¼æ’åºå’Œæ˜¾ç¤º
print("=== æŒ‰æ€»æ—¶é—´æ’åº ===")
stats.sort_stats('tottime').print_stats(5)

print("\n=== æŒ‰ç´¯è®¡æ—¶é—´æ’åº ===")
stats.sort_stats('cumtime').print_stats(5)

print("\n=== æŒ‰è°ƒç”¨æ¬¡æ•°æ’åº ===")
stats.sort_stats('ncalls').print_stats(5)
```

### 6.3 é«˜çº§åˆ†æåŠŸèƒ½


**è¿‡æ»¤å’Œç­›é€‰**ï¼š
```python
# åªæ˜¾ç¤ºåŒ…å«ç‰¹å®šå…³é”®è¯çš„å‡½æ•°
stats.print_stats('example')

# æ˜¾ç¤ºè°ƒç”¨è¶…è¿‡1000æ¬¡çš„å‡½æ•°
stats.print_stats('.*', 1000)

# æ˜¾ç¤ºå‰20%æœ€è€—æ—¶çš„å‡½æ•°
stats.print_stats(.2)

# ç»„åˆæ¡ä»¶
stats.sort_stats('cumtime').print_stats('example.*', 10)
```

**è°ƒç”¨å…³ç³»åˆ†æ**ï¼š
```python
# æ˜¾ç¤ºè°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°
stats.print_callers('example_function')

# æ˜¾ç¤ºè¿™ä¸ªå‡½æ•°è°ƒç”¨äº†è°
stats.print_callees('example_function')
```

**ç»Ÿè®¡ä¿¡æ¯è·å–**ï¼š
```python
# è·å–ç»Ÿè®¡æ‘˜è¦
stats.print_stats()

# è·å–æ€»è¿è¡Œæ—¶é—´
total_time = stats.total_tt
print(f"ç¨‹åºæ€»è¿è¡Œæ—¶é—´ï¼š{total_time:.4f}ç§’")

# è·å–æ€»è°ƒç”¨æ¬¡æ•°
total_calls = stats.total_calls
print(f"å‡½æ•°æ€»è°ƒç”¨æ¬¡æ•°ï¼š{total_calls}")
```

### 6.4 å®ç”¨åˆ†ææ¨¡æ¿


**æ€§èƒ½åˆ†ææŠ¥å‘Šç”Ÿæˆå™¨**ï¼š
```python
import cProfile
import pstats
from io import StringIO

def generate_performance_report(func, *args, **kwargs):
    """ç”Ÿæˆè¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š"""
    
    # è¿è¡Œæ€§èƒ½åˆ†æ
    pr = cProfile.Profile()
    pr.enable()
    result = func(*args, **kwargs)
    pr.disable()
    
    # åˆ›å»ºç»Ÿè®¡å¯¹è±¡
    s = StringIO()
    stats = pstats.Stats(pr, stream=s)
    
    print("ğŸ” æ€§èƒ½åˆ†ææŠ¥å‘Š")
    print("=" * 50)
    
    # æœ€è€—æ—¶çš„5ä¸ªå‡½æ•°
    print("ğŸ“Š æœ€è€—æ—¶çš„5ä¸ªå‡½æ•°ï¼š")
    stats.sort_stats('tottime').print_stats(5)
    
    # è°ƒç”¨æ¬¡æ•°æœ€å¤šçš„5ä¸ªå‡½æ•°
    print("\nğŸ“ˆ è°ƒç”¨æ¬¡æ•°æœ€å¤šçš„5ä¸ªå‡½æ•°ï¼š")
    stats.sort_stats('ncalls').print_stats(5)
    
    return result

# ä½¿ç”¨ç¤ºä¾‹
def my_function():
    return [i**2 for i in range(50000)]

result = generate_performance_report(my_function)
```

---

## 7. ğŸ”¬ line_profilerï¼šé€è¡Œæ€§èƒ½åˆ†æ


### 7.1 ä»€ä¹ˆæ˜¯line_profiler


**å½¢è±¡æ¯”å–»**ï¼šå¦‚æœcProfileæ˜¯"å…¨èº«Xå…‰"ï¼Œé‚£ä¹ˆline_profilerå°±æ˜¯"é«˜å€æ˜¾å¾®é•œ"

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
```
ç²¾ç¡®åˆ°è¡Œçš„åˆ†æï¼š
ğŸ¯ æ¯ä¸€è¡Œä»£ç çš„æ‰§è¡Œæ—¶é—´
ğŸ“Š æ¯ä¸€è¡Œè¢«æ‰§è¡Œäº†å¤šå°‘æ¬¡
ğŸ” æ‰¾å‡ºæœ€æ…¢çš„é‚£å‡ è¡Œä»£ç 
ğŸ’¡ ç›´è§‚çœ‹åˆ°æ€§èƒ½ç“¶é¢ˆä½ç½®
```

### 7.2 å®‰è£…å’ŒåŸºç¡€ä½¿ç”¨


**å®‰è£…æ–¹æ³•**ï¼š
```bash
pip install line_profiler
```

**ä½¿ç”¨æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šåœ¨ä»£ç ä¸­æ·»åŠ @profileè£…é¥°å™¨**
```python
# test_script.py
@profile
def slow_function():
    total = 0
    for i in range(1000000):  # è¿™è¡Œå¯èƒ½å¾ˆæ…¢
        total += i * i        # è¿™è¡Œä¹Ÿå¯èƒ½å¾ˆæ…¢
    return total

@profile  
def main():
    result1 = slow_function()
    result2 = sum(range(1000))  # å¯¹æ¯”ï¼šè¿™è¡Œåº”è¯¥å¾ˆå¿«
    return result1, result2

if __name__ == '__main__':
    main()
```

**æ­¥éª¤2ï¼šè¿è¡Œåˆ†æ**
```bash
kernprof -l -v test_script.py
```

### 7.3 ç†è§£åˆ†æç»“æœ


**å…¸å‹è¾“å‡ºè§£è¯»**ï¼š
```
Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
     3                                           @profile
     4                                           def slow_function():
     5         1          1.0      1.0      0.0      total = 0
     6   1000001     523123.0      0.5     24.8      for i in range(1000000):
     7   1000000    1587234.0      1.6     75.2          total += i * i
     8         1          1.0      1.0      0.0      return total
```

**ğŸ“Š å„åˆ—å«ä¹‰**ï¼š
- **Line #**ï¼šè¡Œå·
- **Hits**ï¼šè¿™è¡Œè¢«æ‰§è¡Œäº†å¤šå°‘æ¬¡
- **Time**ï¼šè¿™è¡Œæ€»å…±èŠ±è´¹çš„æ—¶é—´ï¼ˆå•ä½ï¼štimer unitsï¼‰
- **Per Hit**ï¼šå¹³å‡æ¯æ¬¡æ‰§è¡Œè¿™è¡Œçš„æ—¶é—´
- **% Time**ï¼šè¿™è¡Œå æ€»æ—¶é—´çš„ç™¾åˆ†æ¯”
- **Line Contents**ï¼šå…·ä½“çš„ä»£ç å†…å®¹

### 7.4 å®ç”¨åˆ†ææŠ€å·§


**åœ¨Jupyterä¸­ä½¿ç”¨**ï¼š
```python
# åœ¨Jupyter notebookä¸­
%load_ext line_profiler

# åˆ†æç‰¹å®šå‡½æ•°
%lprun -f slow_function slow_function()
```

**åˆ†æå¤šä¸ªå‡½æ•°**ï¼š
```python
# åŒæ—¶åˆ†æå¤šä¸ªå‡½æ•°
%lprun -f func1 -f func2 main()
```

**å®é™…ä¼˜åŒ–æ¡ˆä¾‹**ï¼š
```python
# ä¼˜åŒ–å‰çš„ä»£ç 
@profile
def slow_version():
    result = []
    for i in range(100000):
        if i % 2 == 0:           # å‘ç°è¿™è¡Œå¾ˆæ…¢
            result.append(i**2)   # è¿™è¡Œä¹Ÿå¾ˆæ…¢
    return result

# ä¼˜åŒ–åçš„ä»£ç   
@profile
def fast_version():
    # ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼ï¼Œåº”è¯¥æ›´å¿«
    return [i**2 for i in range(100000) if i % 2 == 0]
```

**ğŸ’¡ ä¼˜åŒ–æŒ‡å¯¼**ï¼š
> ğŸ¯ **é‡ç‚¹å…³æ³¨**ï¼š% Timeæœ€å¤§çš„è¡Œï¼Œè¿™äº›æ˜¯çœŸæ­£çš„ç“¶é¢ˆ
> 
> ğŸ“ˆ **ä¼˜åŒ–ç­–ç•¥**ï¼š
> - å‡å°‘å¾ªç¯å†…çš„å¤æ‚è®¡ç®—
> - ä½¿ç”¨å†…ç½®å‡½æ•°æ›¿ä»£æ‰‹å†™å¾ªç¯
> - é¿å…é‡å¤çš„å‡½æ•°è°ƒç”¨

---

## 8. ğŸ’¾ memory_profilerï¼šå†…å­˜ä½¿ç”¨ç›‘æ§


### 8.1 ä»€ä¹ˆæ˜¯memory_profiler


**é€šä¿—è§£é‡Š**ï¼šmemory_profilerå°±åƒ"å†…å­˜ä»ªè¡¨ç›˜"ï¼Œå®æ—¶æ˜¾ç¤ºç¨‹åºç”¨äº†å¤šå°‘å†…å­˜

**è§£å†³çš„é—®é¢˜**ï¼š
```
å†…å­˜ç›¸å…³å›°æƒ‘ï¼š
â“ ç¨‹åºä¸ºä»€ä¹ˆè¶Šæ¥è¶Šæ…¢ï¼Ÿ
â“ å†…å­˜æ˜¯ä¸æ˜¯æ³„æ¼äº†ï¼Ÿ
â“ å“ªè¡Œä»£ç å ç”¨å†…å­˜æœ€å¤šï¼Ÿ
â“ æ•°æ®ç»“æ„é€‰æ‹©æ˜¯å¦åˆç†ï¼Ÿ
```

### 8.2 å®‰è£…å’ŒåŸºç¡€ä½¿ç”¨


**å®‰è£…æ–¹æ³•**ï¼š
```bash
pip install memory_profiler
pip install psutil  # å¯é€‰ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½
```

**åŸºç¡€ä½¿ç”¨**ï¼š
```python
# memory_test.py
from memory_profiler import profile

@profile
def memory_heavy_function():
    # åˆ›å»ºå¤§åˆ—è¡¨
    big_list = list(range(1000000))
    
    # åˆ›å»ºå­—å…¸
    big_dict = {i: i**2 for i in range(100000)}
    
    # åˆ é™¤åˆ—è¡¨ï¼ˆè§‚å¯Ÿå†…å­˜æ˜¯å¦é‡Šæ”¾ï¼‰
    del big_list
    
    return big_dict

if __name__ == '__main__':
    result = memory_heavy_function()
```

**è¿è¡Œåˆ†æ**ï¼š
```bash
python memory_test.py
```

### 8.3 ç†è§£å†…å­˜åˆ†æç»“æœ


**å…¸å‹è¾“å‡º**ï¼š
```
Line #    Mem usage    Increment  Occurrences   Line Contents
=============================================================
     3     15.2 MiB     15.2 MiB           1   @profile
     4                                         def memory_heavy_function():
     5     91.8 MiB     76.6 MiB           1       big_list = list(range(1000000))
     6    103.2 MiB     11.4 MiB           1       big_dict = {i: i**2 for i in range(100000)}
     7     27.6 MiB    -75.6 MiB           1       del big_list
     8     27.6 MiB      0.0 MiB           1       return big_dict
```

**ğŸ“Š å„åˆ—è§£é‡Š**ï¼š
- **Line #**ï¼šè¡Œå·
- **Mem usage**ï¼šæ‰§è¡Œè¿™è¡Œåçš„æ€»å†…å­˜ä½¿ç”¨é‡
- **Increment**ï¼šè¿™è¡Œä»£ç å¢åŠ çš„å†…å­˜ï¼ˆè´Ÿæ•°è¡¨ç¤ºé‡Šæ”¾ï¼‰
- **Occurrences**ï¼šè¿™è¡Œè¢«æ‰§è¡Œçš„æ¬¡æ•°
- **Line Contents**ï¼šä»£ç å†…å®¹

### 8.4 é«˜çº§åŠŸèƒ½


**ç›‘æ§æ•´ä¸ªç¨‹åºçš„å†…å­˜ä½¿ç”¨**ï¼š
```python
from memory_profiler import mprof

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œä½ çš„ç¨‹åº
# python your_program.py

# åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ç›‘æ§å†…å­˜
# mprof run your_program.py
# mprof plot  # ç”Ÿæˆå†…å­˜ä½¿ç”¨å›¾è¡¨
```

**åœ¨ä»£ç ä¸­è·å–å†…å­˜ä¿¡æ¯**ï¼š
```python
from memory_profiler import memory_usage
import time

def memory_intensive_task():
    # æ¨¡æ‹Ÿå†…å­˜å¯†é›†å‹ä»»åŠ¡
    data = []
    for i in range(1000000):
        data.append(i)
    time.sleep(1)
    return data

# ç›‘æ§å‡½æ•°çš„å†…å­˜ä½¿ç”¨
mem_usage = memory_usage((memory_intensive_task, ()))
print(f"æœ€å¤§å†…å­˜ä½¿ç”¨ï¼š{max(mem_usage):.2f} MB")
print(f"å¹³å‡å†…å­˜ä½¿ç”¨ï¼š{sum(mem_usage)/len(mem_usage):.2f} MB")
```

**å®æ—¶å†…å­˜ç›‘æ§**ï¼š
```python
import psutil
import time

def monitor_memory():
    """å®æ—¶ç›‘æ§å½“å‰è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨"""
    process = psutil.Process()
    
    for i in range(10):
        # è·å–å†…å­˜ä¿¡æ¯
        memory_info = process.memory_info()
        memory_percent = process.memory_percent()
        
        print(f"æ—¶åˆ»{i+1}: {memory_info.rss / 1024 / 1024:.2f} MB ({memory_percent:.1f}%)")
        time.sleep(1)

# åœ¨ç¨‹åºè¿è¡ŒæœŸé—´è°ƒç”¨
monitor_memory()
```

### 8.5 å†…å­˜ä¼˜åŒ–æŠ€å·§


**å¸¸è§å†…å­˜é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜ç±»å‹ | **ç°è±¡** | **è§£å†³æ–¹æ³•** |
|---------|----------|-------------|
| ğŸ”„ **å†…å­˜æ³„æ¼** | `å†…å­˜æŒç»­å¢é•¿ä¸é‡Šæ”¾` | `åŠæ—¶delæ— ç”¨å¯¹è±¡ï¼Œé¿å…å¾ªç¯å¼•ç”¨` |
| ğŸ“¦ **å¤§å¯¹è±¡åˆ›å»º** | `æŸè¡Œå†…å­˜çªç„¶æ¿€å¢` | `åˆ†æ‰¹å¤„ç†ï¼Œä½¿ç”¨ç”Ÿæˆå™¨` |
| ğŸ”— **å¾ªç¯å¼•ç”¨** | `delåå†…å­˜ä¸é‡Šæ”¾` | `ä½¿ç”¨weakrefï¼Œæ‰‹åŠ¨æ‰“ç ´å¾ªç¯` |
| ğŸ“Š **æ•°æ®ç»“æ„é€‰æ‹©** | `ç›¸åŒæ•°æ®å ç”¨å†…å­˜å·®å¼‚å¤§` | `é€‰æ‹©åˆé€‚çš„å®¹å™¨ç±»å‹` |

**å†…å­˜ä¼˜åŒ–ç¤ºä¾‹**ï¼š
```python
# å†…å­˜æ•ˆç‡å¯¹æ¯”
@profile
def memory_inefficient():
    # ä½æ•ˆï¼šä¸€æ¬¡æ€§åˆ›å»ºå¤§åˆ—è¡¨
    data = [i**2 for i in range(1000000)]
    return sum(data)

@profile  
def memory_efficient():
    # é«˜æ•ˆï¼šä½¿ç”¨ç”Ÿæˆå™¨
    return sum(i**2 for i in range(1000000))

# å¯¹æ¯”ä¸¤ç§æ–¹æ³•çš„å†…å­˜ä½¿ç”¨
```

---

## 9. ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•æ–¹æ³•


### 9.1 ä»€ä¹ˆæ˜¯åŸºå‡†æµ‹è¯•


**ç®€å•ç†è§£**ï¼šåŸºå‡†æµ‹è¯•å°±åƒ"æ ‡å‡†åŒ–è€ƒè¯•"ï¼Œç”¨ç»Ÿä¸€çš„æ–¹æ³•æ¯”è¾ƒä¸åŒæ–¹æ¡ˆçš„æ€§èƒ½

**åŸºå‡†æµ‹è¯•çš„ä»·å€¼**ï¼š
```
ç§‘å­¦çš„æ€§èƒ½å¯¹æ¯”ï¼š
âœ… å…¬å¹³æ¯”è¾ƒä¸åŒç®—æ³•
âœ… éªŒè¯ä¼˜åŒ–æ•ˆæœ
âœ… é€‰æ‹©æœ€ä½³æ–¹æ¡ˆ
âœ… ç›‘æ§æ€§èƒ½å˜åŒ–
```

### 9.2 è®¾è®¡è‰¯å¥½çš„åŸºå‡†æµ‹è¯•


**åŸºå‡†æµ‹è¯•åŸåˆ™**ï¼š
```
ğŸ¯ ç›®æ ‡æ˜ç¡®ï¼šçŸ¥é“è¦æµ‹è¯•ä»€ä¹ˆ
ğŸ“Š æ•°æ®å……åˆ†ï¼šæµ‹è¯•è¶³å¤Ÿå¤šçš„æƒ…å†µ
ğŸ”„ å¯é‡å¤ï¼šç»“æœåº”è¯¥ç¨³å®šå¯é‡å¤
âš–ï¸ å…¬å¹³å¯¹æ¯”ï¼šç›¸åŒçš„æµ‹è¯•æ¡ä»¶
ğŸ“ˆ ç°å®ç›¸å…³ï¼šæµ‹è¯•è´´è¿‘å®é™…ä½¿ç”¨åœºæ™¯
```

**åŸºå‡†æµ‹è¯•æ¨¡æ¿**ï¼š
```python
import timeit
import statistics
from typing import List, Callable

class BenchmarkTester:
    def __init__(self, test_name: str):
        self.test_name = test_name
        self.results = {}
    
    def add_test(self, name: str, func: Callable, *args, **kwargs):
        """æ·»åŠ ä¸€ä¸ªæµ‹è¯•å‡½æ•°"""
        def wrapper():
            return func(*args, **kwargs)
        
        # è¿è¡Œå¤šæ¬¡å–å¹³å‡å€¼
        times = timeit.repeat(wrapper, number=100, repeat=5)
        
        self.results[name] = {
            'min_time': min(times),
            'max_time': max(times),
            'mean_time': statistics.mean(times),
            'std_dev': statistics.stdev(times) if len(times) > 1 else 0
        }
    
    def print_results(self):
        """æ‰“å°æµ‹è¯•ç»“æœ"""
        print(f"\nğŸ“Š {self.test_name} åŸºå‡†æµ‹è¯•ç»“æœ")
        print("=" * 60)
        
        # æŒ‰å¹³å‡æ—¶é—´æ’åº
        sorted_results = sorted(
            self.results.items(), 
            key=lambda x: x[1]['mean_time']
        )
        
        fastest_time = sorted_results[0][1]['mean_time']
        
        for name, stats in sorted_results:
            mean = stats['mean_time']
            std = stats['std_dev']
            ratio = mean / fastest_time
            
            print(f"{name:20}: {mean:.6f}s Â± {std:.6f}s ({ratio:.2f}x)")

# ä½¿ç”¨ç¤ºä¾‹
def test_list_creation():
    tester = BenchmarkTester("åˆ—è¡¨åˆ›å»ºæ–¹æ³•å¯¹æ¯”")
    
    # æµ‹è¯•ä¸åŒçš„åˆ—è¡¨åˆ›å»ºæ–¹æ³•
    tester.add_test("forå¾ªç¯", create_list_loop, 10000)
    tester.add_test("åˆ—è¡¨æ¨å¯¼", create_list_comprehension, 10000)
    tester.add_test("mapå‡½æ•°", create_list_map, 10000)
    
    tester.print_results()

def create_list_loop(n):
    result = []
    for i in range(n):
        result.append(i * 2)
    return result

def create_list_comprehension(n):
    return [i * 2 for i in range(n)]

def create_list_map(n):
    return list(map(lambda x: x * 2, range(n)))
```

### 9.3 å¸¸è§åŸºå‡†æµ‹è¯•åœºæ™¯


**åœºæ™¯1ï¼šç®—æ³•æ€§èƒ½å¯¹æ¯”**
```python
def benchmark_sorting_algorithms():
    import random
    
    # å‡†å¤‡æµ‹è¯•æ•°æ®
    data_sizes = [1000, 5000, 10000]
    
    for size in data_sizes:
        print(f"\nğŸ“ˆ æ•°æ®è§„æ¨¡: {size}")
        
        # ç”Ÿæˆéšæœºæ•°æ®
        test_data = [random.randint(1, 1000) for _ in range(size)]
        
        tester = BenchmarkTester(f"æ’åºç®—æ³•å¯¹æ¯” (n={size})")
        
        # æµ‹è¯•ä¸åŒæ’åºæ–¹æ³•
        tester.add_test("å†…ç½®sorted", lambda: sorted(test_data.copy()))
        tester.add_test("list.sort", lambda: test_data.copy().sort())
        
        tester.print_results()
```

**åœºæ™¯2ï¼šæ•°æ®ç»“æ„é€‰æ‹©**
```python
def benchmark_data_structures():
    """æ¯”è¾ƒä¸åŒæ•°æ®ç»“æ„çš„æ€§èƒ½"""
    
    # æµ‹è¯•æŸ¥æ‰¾æ€§èƒ½
    tester = BenchmarkTester("æ•°æ®ç»“æ„æŸ¥æ‰¾æ€§èƒ½")
    
    # å‡†å¤‡æ•°æ®
    test_list = list(range(10000))
    test_set = set(test_list)
    test_dict = {i: i for i in test_list}
    
    target = 9999  # æŸ¥æ‰¾ç›®æ ‡
    
    tester.add_test("åˆ—è¡¨æŸ¥æ‰¾", lambda: target in test_list)
    tester.add_test("é›†åˆæŸ¥æ‰¾", lambda: target in test_set)
    tester.add_test("å­—å…¸æŸ¥æ‰¾", lambda: target in test_dict)
    
    tester.print_results()
```

### 9.4 è‡ªåŠ¨åŒ–æ€§èƒ½ç›‘æ§


**æ€§èƒ½å›å½’æµ‹è¯•**ï¼š
```python
import json
import os
from datetime import datetime

class PerformanceTracker:
    def __init__(self, results_file="performance_history.json"):
        self.results_file = results_file
        self.history = self._load_history()
    
    def _load_history(self):
        """åŠ è½½å†å²æ€§èƒ½æ•°æ®"""
        if os.path.exists(self.results_file):
            with open(self.results_file, 'r') as f:
                return json.load(f)
        return {}
    
    def save_result(self, test_name: str, execution_time: float):
        """ä¿å­˜æµ‹è¯•ç»“æœ"""
        timestamp = datetime.now().isoformat()
        
        if test_name not in self.history:
            self.history[test_name] = []
        
        self.history[test_name].append({
            'time': execution_time,
            'timestamp': timestamp
        })
        
        # ä¿å­˜åˆ°æ–‡ä»¶
        with open(self.results_file, 'w') as f:
            json.dump(self.history, f, indent=2)
    
    def check_regression(self, test_name: str, current_time: float, threshold: float = 1.1):
        """æ£€æŸ¥æ€§èƒ½å›å½’"""
        if test_name not in self.history or len(self.history[test_name]) < 5:
            return False, "å†å²æ•°æ®ä¸è¶³"
        
        # è®¡ç®—å†å²å¹³å‡æ—¶é—´
        recent_times = [r['time'] for r in self.history[test_name][-5:]]
        avg_time = sum(recent_times) / len(recent_times)
        
        if current_time > avg_time * threshold:
            return True, f"æ€§èƒ½ä¸‹é™ {(current_time/avg_time - 1)*100:.1f}%"
        
        return False, f"æ€§èƒ½æ­£å¸¸ (å½“å‰: {current_time:.4f}s, å¹³å‡: {avg_time:.4f}s)"

# ä½¿ç”¨ç¤ºä¾‹
tracker = PerformanceTracker()

def monitored_function():
    """éœ€è¦ç›‘æ§çš„å‡½æ•°"""
    return sum(i*i for i in range(100000))

# æµ‹è¯•å¹¶è®°å½•
start_time = time.perf_counter()
result = monitored_function()
execution_time = time.perf_counter() - start_time

# ä¿å­˜ç»“æœå¹¶æ£€æŸ¥å›å½’
tracker.save_result("monitored_function", execution_time)
is_regression, message = tracker.check_regression("monitored_function", execution_time)

print(f"â±ï¸ æ‰§è¡Œæ—¶é—´: {execution_time:.4f}s")
print(f"ğŸ“Š æ€§èƒ½çŠ¶æ€: {message}")
if is_regression:
    print("ğŸš¨ æ£€æµ‹åˆ°æ€§èƒ½å›å½’ï¼")
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å·¥å…·é€‰æ‹©æŒ‡å—


**ğŸ§  è®°å¿†æŠ€å·§ - æ€§èƒ½å·¥å…·"å…¨å®¶ç¦"**ï¼š
```
å¿«é€Ÿè®¡æ—¶     â†’  timeit      (åƒç§’è¡¨ï¼Œæµ‹å°ä»£ç ç‰‡æ®µ)
å…¨é¢ä½“æ£€     â†’  cProfile    (åƒXå…‰ï¼Œçœ‹æ•´ä¸ªç¨‹åº)
ç²¾ç¡®å®šä½     â†’  line_profiler (åƒæ˜¾å¾®é•œï¼Œçœ‹æ¯ä¸€è¡Œ)
å†…å­˜ç›‘æ§     â†’  memory_profiler (åƒä½“é‡ç§¤ï¼Œçœ‹å†…å­˜ä½¿ç”¨)
ç»Ÿè®¡åˆ†æ     â†’  pstats      (åƒExcelï¼Œåˆ†ææ•°æ®)
```

### 10.2 ä½¿ç”¨åœºæ™¯å†³ç­–è¡¨


| ä½ çš„éœ€æ±‚ | **æ¨èå·¥å…·** | **ä½¿ç”¨æ–¹æ³•** |
|---------|-------------|-------------|
| ğŸ” **æ¯”è¾ƒç®—æ³•å¿«æ…¢** | `timeit` | `timeit.timeit()` |
| ğŸ—ï¸ **æ‰¾å‡ºæœ€æ…¢çš„å‡½æ•°** | `cProfile` | `cProfile.run()` |
| ğŸ¯ **å®šä½æ…¢çš„ä»£ç è¡Œ** | `line_profiler` | `@profileè£…é¥°å™¨` |
| ğŸ’¾ **æ£€æŸ¥å†…å­˜æ³„æ¼** | `memory_profiler` | `@profileè£…é¥°å™¨` |
| ğŸ“Š **è¯¦ç»†åˆ†ææ•°æ®** | `pstats` | `å¤„ç†.profæ–‡ä»¶` |
| â±ï¸ **ç›‘æ§å®é™…è¿è¡Œ** | `time` | `time.perf_counter()` |

### 10.3 æ€§èƒ½ä¼˜åŒ–æµç¨‹


**ğŸ”„ æ ‡å‡†ä¼˜åŒ–æµç¨‹**ï¼š
```
ç¬¬1æ­¥ï¼šå‘ç°é—®é¢˜ ğŸ”
â†“ ä½¿ç”¨timeitæˆ–timeå‘ç°ç¨‹åºæ…¢

ç¬¬2æ­¥ï¼šå…¨é¢åˆ†æ ğŸ¥  
â†“ ç”¨cProfileæ‰¾å‡ºæœ€è€—æ—¶çš„å‡½æ•°

ç¬¬3æ­¥ï¼šç²¾ç¡®å®šä½ ğŸ¯
â†“ ç”¨line_profileræ‰¾å‡ºæ…¢çš„ä»£ç è¡Œ

ç¬¬4æ­¥ï¼šæ£€æŸ¥å†…å­˜ ğŸ’¾
â†“ ç”¨memory_profileræ’é™¤å†…å­˜é—®é¢˜

ç¬¬5æ­¥ï¼šéªŒè¯æ•ˆæœ âœ…
â†“ ç”¨åŸºå‡†æµ‹è¯•éªŒè¯ä¼˜åŒ–æ•ˆæœ
```

### 10.4 å¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**ğŸ”¥ é«˜é¢‘é—®é¢˜æ¸…å•**ï¼š

**é—®é¢˜1ï¼šå¾ªç¯å¤ªæ…¢**
```python
# âŒ æ…¢çš„å†™æ³•
result = []
for i in range(100000):
    result.append(i * 2)

# âœ… å¿«çš„å†™æ³•  
result = [i * 2 for i in range(100000)]
```

**é—®é¢˜2ï¼šé‡å¤è®¡ç®—**
```python
# âŒ æ…¢çš„å†™æ³•
for item in data:
    if len(expensive_function(item)) > 10:  # æ¯æ¬¡éƒ½è°ƒç”¨
        process(item)

# âœ… å¿«çš„å†™æ³•
for item in data:
    result = expensive_function(item)  # åªè°ƒç”¨ä¸€æ¬¡
    if len(result) > 10:
        process(item)
```

**é—®é¢˜3ï¼šå†…å­˜ä½¿ç”¨è¿‡å¤š**
```python
# âŒ å å†…å­˜çš„å†™æ³•
data = [process(i) for i in range(1000000)]  # ä¸€æ¬¡æ€§åˆ›å»ºå¤§åˆ—è¡¨

# âœ… çœå†…å­˜çš„å†™æ³•
data = (process(i) for i in range(1000000))  # ä½¿ç”¨ç”Ÿæˆå™¨
```

### 10.5 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ


**ğŸ’¡ ä¼˜åŒ–åŸåˆ™**ï¼š
```
ğŸ¯ å…ˆæµ‹é‡ï¼Œå†ä¼˜åŒ–ï¼šä¸è¦å‡­æ„Ÿè§‰ä¼˜åŒ–
ğŸ“Š å…³æ³¨å¤§å¤´ï¼šä¼˜åŒ–å æ—¶é—´æœ€å¤šçš„éƒ¨åˆ†  
âš–ï¸ å¹³è¡¡å–èˆï¼šå¯è¯»æ€§ vs æ€§èƒ½
ğŸ”„ æŒç»­ç›‘æ§ï¼šå»ºç«‹æ€§èƒ½ç›‘æ§æœºåˆ¶
ğŸ“ˆ æ¸è¿›æ”¹è¿›ï¼šå°æ­¥å¿«è·‘ï¼Œé€æ­¥ä¼˜åŒ–
```

**âš ï¸ å¸¸è§è¯¯åŒº**ï¼š
> âŒ **è¿‡æ—©ä¼˜åŒ–**ï¼šåŠŸèƒ½è¿˜æ²¡å†™å®Œå°±å¼€å§‹ä¼˜åŒ–
> 
> âŒ **æ„Ÿè§‰ä¼˜åŒ–**ï¼šå‡­ç›´è§‰è€Œä¸æ˜¯æ•°æ®ä¼˜åŒ–
> 
> âŒ **å±€éƒ¨ä¼˜åŒ–**ï¼šåªä¼˜åŒ–å°å‡½æ•°å¿½è§†å¤§ç®—æ³•
> 
> âŒ **åªçœ‹æ—¶é—´**ï¼šå¿½è§†å†…å­˜å’Œå¯ç»´æŠ¤æ€§

### 10.6 å­¦ä¹ å»ºè®®


**ğŸ“ æ–°æ‰‹å­¦ä¹ è·¯å¾„**ï¼š
1. **ä»timeitå¼€å§‹** - å­¦ä¼šåŸºç¡€è®¡æ—¶
2. **æŒæ¡cProfile** - ç†è§£æ€§èƒ½åˆ†æ
3. **å°è¯•line_profiler** - ç²¾ç¡®å®šä½é—®é¢˜  
4. **å­¦ä¹ memory_profiler** - å…³æ³¨å†…å­˜ä½¿ç”¨
5. **å»ºç«‹åŸºå‡†æµ‹è¯•** - ç§‘å­¦éªŒè¯ä¼˜åŒ–æ•ˆæœ

**ğŸ“š è¿›é˜¶å­¦ä¹ æ–¹å‘**ï¼š
- å­¦ä¹ ç®—æ³•å¤æ‚åº¦ç†è®º
- äº†è§£Pythonå†…éƒ¨å®ç°æœºåˆ¶
- æŒæ¡å¹¶å‘å’Œå¼‚æ­¥ç¼–ç¨‹
- ç ”ç©¶å…¶ä»–æ€§èƒ½åˆ†æå·¥å…·

**ğŸ”§ å®è·µå»ºè®®**ï¼š
```
æ—¥å¸¸å¼€å‘ä¸­ï¼š
âœ… å…³é”®åŠŸèƒ½è¦å†™æ€§èƒ½æµ‹è¯•
âœ… å®šæœŸè¿›è¡Œæ€§èƒ½åˆ†æ
âœ… å»ºç«‹æ€§èƒ½ç›‘æ§ä¹ æƒ¯
âœ… è®°å½•ä¼˜åŒ–ç»éªŒå’Œæ•™è®­
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ€§èƒ½ä¼˜åŒ–å¦‚åŒåŒ»ç”Ÿçœ‹ç—…ï¼šå…ˆæ£€æŸ¥ï¼Œå†è¯Šæ–­ï¼Œåæ²»ç–—
- å·¥å…·å„æœ‰ä¸“é•¿ï¼štimeitæµ‹é€Ÿåº¦ï¼ŒcProfileæ‰¾ç“¶é¢ˆï¼Œline_profilerå®šä½è¡Œï¼Œmemory_profileræŸ¥å†…å­˜
- ä¼˜åŒ–è¦æœ‰æ•°æ®æ”¯æ’‘ï¼Œä¸èƒ½å‡­æ„Ÿè§‰è¡Œäº‹
- æ€§èƒ½å’Œå¯è¯»æ€§éœ€è¦å¹³è¡¡ï¼Œä¸è¦ä¸ºäº†å¿«è€Œç‰ºç‰²ä»£ç è´¨é‡