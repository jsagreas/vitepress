---
title: 1ã€è¿­ä»£åè®®æ·±åº¦ç†è§£
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯è¿­ä»£åè®®](#1-ä»€ä¹ˆæ˜¯è¿­ä»£åè®®)
2. [å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„åŒºåˆ«](#2-å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„åŒºåˆ«)
3. [è¿­ä»£å™¨åè®®çš„æ ¸å¿ƒæœºåˆ¶](#3-è¿­ä»£å™¨åè®®çš„æ ¸å¿ƒæœºåˆ¶)
4. [è‡ªå®šä¹‰è¿­ä»£å™¨å®ç°](#4-è‡ªå®šä¹‰è¿­ä»£å™¨å®ç°)
5. [è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ](#5-è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ä»€ä¹ˆæ˜¯è¿­ä»£åè®®


### 1.1 è¿­ä»£åè®®çš„æœ¬è´¨å«ä¹‰


**ğŸ¯ ç®€å•ç†è§£**ï¼šè¿­ä»£åè®®å°±æ˜¯Pythonå®šä¹‰çš„ä¸€å¥—"è§„åˆ™"ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿé€ä¸ªè®¿é—®å®¹å™¨ä¸­çš„å…ƒç´ ã€‚

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
å°±åƒå›¾ä¹¦é¦†çš„å€Ÿä¹¦æµç¨‹ï¼š
1. ä½ æ‹¿åˆ°ä¸€ä¸ªä¹¦æ¶ç¼–å·ï¼ˆå¯è¿­ä»£å¯¹è±¡ï¼‰
2. ç®¡ç†å‘˜ç»™ä½ ä¸€ä¸ªä¹¦ç­¾ï¼ˆè¿­ä»£å™¨ï¼‰
3. æ¯æ¬¡ç¿»é¡µéƒ½çŸ¥é“ä¸‹ä¸€æœ¬ä¹¦åœ¨å“ªï¼ˆ__next__æ–¹æ³•ï¼‰
4. çœ‹å®Œæ‰€æœ‰ä¹¦æ—¶ä¼šå‘Šè¯‰ä½ "æ²¡æœ‰äº†"ï¼ˆStopIterationå¼‚å¸¸ï¼‰
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦è¿­ä»£åè®®**ï¼š
- **ç»Ÿä¸€æ ‡å‡†**ï¼šä¸ç®¡æ˜¯åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€å­—å…¸ï¼Œéƒ½ç”¨åŒæ ·çš„æ–¹å¼éå†
- **å†…å­˜é«˜æ•ˆ**ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜
- **å»¶è¿Ÿè®¡ç®—**ï¼šéœ€è¦çš„æ—¶å€™æ‰è®¡ç®—ä¸‹ä¸€ä¸ªå€¼

### 1.2 è¿­ä»£åè®®çš„ä¸¤ä¸ªæ ¸å¿ƒè§’è‰²


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    äº§ç”Ÿ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¯è¿­ä»£å¯¹è±¡     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚    è¿­ä»£å™¨       â”‚
â”‚  (Iterable)     â”‚            â”‚  (Iterator)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®ç°__iter__()  â”‚            â”‚ å®ç°__iter__()  â”‚
â”‚                 â”‚            â”‚ å®ç°__next__()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                              â†‘
   "æˆ‘èƒ½è¢«éå†"                    "æˆ‘çŸ¥é“ä¸‹ä¸€ä¸ªæ˜¯ä»€ä¹ˆ"
```

---

## 2. ğŸ” å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„åŒºåˆ«


### 2.1 å¯è¿­ä»£å¯¹è±¡ï¼ˆIterableï¼‰è¯¦è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡**ï¼š
ç®€å•è¯´ï¼Œå°±æ˜¯"èƒ½å¤Ÿè¢«éå†"çš„å¯¹è±¡ã€‚

```python
# è¿™äº›éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡
my_list = [1, 2, 3]        # åˆ—è¡¨
my_str = "hello"           # å­—ç¬¦ä¸²  
my_dict = {"a": 1, "b": 2} # å­—å…¸
my_set = {1, 2, 3}         # é›†åˆ

# åˆ¤æ–­æ˜¯å¦å¯è¿­ä»£
from collections.abc import Iterable

print(isinstance(my_list, Iterable))  # True
print(isinstance(123, Iterable))      # False
```

**ğŸ”¸ å¯è¿­ä»£å¯¹è±¡çš„ç‰¹å¾**ï¼š
- âœ… å¿…é¡»å®ç° `__iter__()` æ–¹æ³•
- âœ… `__iter__()` æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨
- âœ… å¯ä»¥å¤šæ¬¡åˆ›å»ºè¿­ä»£å™¨ï¼ˆå¯é‡å¤éå†ï¼‰

### 2.2 è¿­ä»£å™¨ï¼ˆIteratorï¼‰è¯¦è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¿­ä»£å™¨**ï¼š
è¿­ä»£å™¨å°±åƒä¸€ä¸ª"æ™ºèƒ½æŒ‡é’ˆ"ï¼Œå®ƒçŸ¥é“ï¼š
- å½“å‰ä½ç½®åœ¨å“ªé‡Œ
- ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆ
- ä»€ä¹ˆæ—¶å€™ç»“æŸ

```python
# ä»å¯è¿­ä»£å¯¹è±¡è·å–è¿­ä»£å™¨
my_list = [1, 2, 3]
iterator = iter(my_list)  # è·å–è¿­ä»£å™¨

print(next(iterator))  # 1
print(next(iterator))  # 2
print(next(iterator))  # 3
# print(next(iterator))  # æŠ›å‡º StopIteration å¼‚å¸¸
```

**ğŸ”¸ è¿­ä»£å™¨çš„ç‰¹å¾**ï¼š
- âœ… å¿…é¡»å®ç° `__iter__()` å’Œ `__next__()` æ–¹æ³•
- âœ… `__iter__()` è¿”å›è‡ªå·±
- âœ… `__next__()` è¿”å›ä¸‹ä¸€ä¸ªå€¼æˆ–æŠ›å‡º StopIteration
- âš ï¸ **åªèƒ½å•å‘å‰è¿›ï¼Œä¸èƒ½å›é€€**
- âš ï¸ **ä¸€æ¬¡æ€§æ¶ˆè€—ï¼Œç”¨å®Œå°±æ²¡äº†**

### 2.3 å…³é”®åŒºåˆ«å¯¹æ¯”


| ç‰¹æ€§ | **å¯è¿­ä»£å¯¹è±¡** | **è¿­ä»£å™¨** |
|------|---------------|-----------|
| **æ ¸å¿ƒä½œç”¨** | `"æˆ‘èƒ½è¢«éå†"` | `"æˆ‘çŸ¥é“ä¸‹ä¸€ä¸ªæ˜¯ä»€ä¹ˆ"` |
| **å¿…é¡»å®ç°** | `__iter__()` | `__iter__() + __next__()` |
| **é‡å¤ä½¿ç”¨** | âœ… å¯ä»¥å¤šæ¬¡éå† | âŒ ä¸€æ¬¡æ€§æ¶ˆè€— |
| **è®°å¿†çŠ¶æ€** | âŒ ä¸è®°ä½ä½ç½® | âœ… è®°ä½å½“å‰ä½ç½® |
| **ä¸¾ä¾‹** | `[1,2,3]`, `"abc"` | `iter([1,2,3])` |

```python
# æ¼”ç¤ºåŒºåˆ«
numbers = [1, 2, 3]  # å¯è¿­ä»£å¯¹è±¡

# å¯ä»¥å¤šæ¬¡éå†
for num in numbers:
    print(num)  # 1, 2, 3

for num in numbers:  # å†æ¬¡éå†ï¼Œå®Œå…¨æ²¡é—®é¢˜
    print(num)  # 1, 2, 3

# ä½†è¿­ä»£å™¨åªèƒ½ç”¨ä¸€æ¬¡
iterator = iter(numbers)
for num in iterator:
    print(num)  # 1, 2, 3

for num in iterator:  # è¿™æ¬¡ä»€ä¹ˆéƒ½ä¸ä¼šæ‰“å°
    print(num)  # ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå› ä¸ºè¿­ä»£å™¨å·²ç»è€—å°½äº†
```

---

## 3. âš™ï¸ è¿­ä»£å™¨åè®®çš„æ ¸å¿ƒæœºåˆ¶


### 3.1 __iter__ æ–¹æ³•æ·±å…¥ç†è§£


**ğŸ”¸ __iter__ çš„ä½œç”¨**ï¼š
è¿™ä¸ªæ–¹æ³•çš„å·¥ä½œå°±æ˜¯"è¿”å›ä¸€ä¸ªè¿­ä»£å™¨"ã€‚

```python
class SimpleRange:
    def __init__(self, max_num):
        self.max_num = max_num
    
    def __iter__(self):
        """è¿”å›è¿­ä»£å™¨ï¼Œé€šå¸¸è¿”å›è‡ªå·±æˆ–åˆ›å»ºæ–°çš„è¿­ä»£å™¨"""
        return SimpleRangeIterator(self.max_num)

class SimpleRangeIterator:
    def __init__(self, max_num):
        self.max_num = max_num
        self.current = 0
    
    def __iter__(self):
        """è¿­ä»£å™¨çš„__iter__è¿”å›è‡ªå·±"""
        return self
    
    def __next__(self):
        if self.current < self.max_num:
            self.current += 1
            return self.current - 1
        raise StopIteration
```

### 3.2 __next__ æ–¹æ³•æ·±å…¥ç†è§£


**ğŸ”¸ __next__ çš„èŒè´£**ï¼š
- è¿”å›åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼
- å½“æ²¡æœ‰æ›´å¤šå€¼æ—¶ï¼ŒæŠ›å‡º `StopIteration` å¼‚å¸¸

```python
# æ‰‹åŠ¨æ¼”ç¤º __next__ çš„å·¥ä½œè¿‡ç¨‹
my_range = SimpleRange(3)
iterator = iter(my_range)

try:
    print(next(iterator))  # 0
    print(next(iterator))  # 1  
    print(next(iterator))  # 2
    print(next(iterator))  # æŠ›å‡º StopIteration
except StopIteration:
    print("è¿­ä»£ç»“æŸäº†ï¼")
```

### 3.3 iter() å’Œ next() å†…ç½®å‡½æ•°


**ğŸ”¸ iter() å‡½æ•°çš„å¤šç§ç”¨æ³•**ï¼š

```python
# ç”¨æ³•1ï¼šä»å¯è¿­ä»£å¯¹è±¡åˆ›å»ºè¿­ä»£å™¨
numbers = [1, 2, 3]
iterator = iter(numbers)

# ç”¨æ³•2ï¼šä»å‡½æ•°åˆ›å»ºè¿­ä»£å™¨ï¼ˆç›´åˆ°é‡åˆ°ç»ˆæ­¢å€¼ï¼‰
import random
# ç”Ÿæˆéšæœºæ•°ï¼Œç›´åˆ°é‡åˆ°5å°±åœæ­¢
random_iter = iter(lambda: random.randint(1, 10), 5)
```

**ğŸ”¸ next() å‡½æ•°çš„ç”¨æ³•**ï¼š

```python
numbers = [1, 2, 3]
iterator = iter(numbers)

# åŸºæœ¬ç”¨æ³•
print(next(iterator))  # 1

# å¸¦é»˜è®¤å€¼çš„ç”¨æ³•ï¼ˆæ¨èï¼‰
print(next(iterator, "æ²¡æœ‰äº†"))  # 2
print(next(iterator, "æ²¡æœ‰äº†"))  # 3  
print(next(iterator, "æ²¡æœ‰äº†"))  # "æ²¡æœ‰äº†"ï¼ˆè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼‰
```

### 3.4 StopIteration å¼‚å¸¸æœºåˆ¶


**ğŸ”¸ StopIteration çš„ä½œç”¨**ï¼š
è¿™ä¸ªå¼‚å¸¸æ˜¯è¿­ä»£å™¨å‘Šè¯‰Python"æˆ‘æ²¡æœ‰æ›´å¤šå…ƒç´ äº†"çš„æ–¹å¼ã€‚

```python
def demo_stop_iteration():
    """æ¼”ç¤º StopIteration çš„ä½œç”¨"""
    numbers = [1, 2]
    iterator = iter(numbers)
    
    print("å¼€å§‹è¿­ä»£ï¼š")
    try:
        while True:  # æ— é™å¾ªç¯
            value = next(iterator)
            print(f"è·å–åˆ°ï¼š{value}")
    except StopIteration:
        print("è¿­ä»£ç»“æŸï¼")

demo_stop_iteration()
# è¾“å‡ºï¼š
# å¼€å§‹è¿­ä»£ï¼š
# è·å–åˆ°ï¼š1
# è·å–åˆ°ï¼š2  
# è¿­ä»£ç»“æŸï¼
```

> ğŸ’¡ **é‡è¦ç†è§£**ï¼šforå¾ªç¯å…¶å®å°±æ˜¯åœ¨å†…éƒ¨è‡ªåŠ¨å¤„ç†StopIterationå¼‚å¸¸ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨forå¾ªç¯éå†æ—¶ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰è¿­ä»£å™¨å®ç°


### 4.1 ç®€å•è‡ªå®šä¹‰è¿­ä»£å™¨


è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„å€’è®¡æ•°è¿­ä»£å™¨ï¼š

```python
class Countdown:
    """å€’è®¡æ•°è¿­ä»£å™¨ - ä»æŒ‡å®šæ•°å­—å€’æ•°åˆ°0"""
    
    def __init__(self, start):
        self.start = start
        self.current = start
    
    def __iter__(self):
        """è¿”å›è¿­ä»£å™¨å¯¹è±¡ï¼ˆè‡ªå·±ï¼‰"""
        return self
    
    def __next__(self):
        """è¿”å›ä¸‹ä¸€ä¸ªå€¼"""
        if self.current > 0:
            self.current -= 1
            return self.current + 1
        else:
            raise StopIteration
    
    def reset(self):
        """é‡ç½®è¿­ä»£å™¨ï¼ˆé¢å¤–åŠŸèƒ½ï¼‰"""
        self.current = self.start

# ä½¿ç”¨ç¤ºä¾‹
countdown = Countdown(3)

print("ç¬¬ä¸€æ¬¡å€’è®¡æ•°ï¼š")
for num in countdown:
    print(num)  # è¾“å‡ºï¼š3, 2, 1

print("å°è¯•å†æ¬¡éå†ï¼š")  
for num in countdown:
    print(num)  # ä»€ä¹ˆéƒ½ä¸è¾“å‡ºï¼Œå› ä¸ºè¿­ä»£å™¨å·²ç»è€—å°½

print("é‡ç½®åå†æ¬¡å€’è®¡æ•°ï¼š")
countdown.reset()
for num in countdown:
    print(num)  # è¾“å‡ºï¼š3, 2, 1
```

### 4.2 å¯é‡å¤ä½¿ç”¨çš„è¿­ä»£å™¨è®¾è®¡


ä¸ºäº†è®©æˆ‘ä»¬çš„å¯¹è±¡å¯ä»¥å¤šæ¬¡éå†ï¼Œæˆ‘ä»¬éœ€è¦åˆ†ç¦»"å¯è¿­ä»£å¯¹è±¡"å’Œ"è¿­ä»£å™¨"ï¼š

```python
class RepeatableCountdown:
    """å¯é‡å¤ä½¿ç”¨çš„å€’è®¡æ•°å¯¹è±¡"""
    
    def __init__(self, start):
        self.start = start
    
    def __iter__(self):
        """æ¯æ¬¡è°ƒç”¨éƒ½è¿”å›æ–°çš„è¿­ä»£å™¨"""
        return CountdownIterator(self.start)

class CountdownIterator:
    """ä¸“é—¨çš„è¿­ä»£å™¨ç±»"""
    
    def __init__(self, start):
        self.current = start
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current > 0:
            self.current -= 1
            return self.current + 1
        raise StopIteration

# ä½¿ç”¨ç¤ºä¾‹
countdown = RepeatableCountdown(3)

print("ç¬¬ä¸€æ¬¡éå†ï¼š")
for num in countdown:
    print(num)  # 3, 2, 1

print("ç¬¬äºŒæ¬¡éå†ï¼š") 
for num in countdown:
    print(num)  # 3, 2, 1ï¼ˆå®Œå…¨æ²¡é—®é¢˜ï¼ï¼‰
```

### 4.3 å®ç”¨çš„æ–‡ä»¶è¡Œè¿­ä»£å™¨


è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªå®ç”¨çš„ä¾‹å­ - æŒ‰è¡Œè¯»å–æ–‡ä»¶çš„è¿­ä»£å™¨ï¼š

```python
class FileLineIterator:
    """é€è¡Œè¯»å–æ–‡ä»¶çš„è¿­ä»£å™¨"""
    
    def __init__(self, filename):
        self.filename = filename
        self.file = None
    
    def __iter__(self):
        """æ‰“å¼€æ–‡ä»¶å¹¶è¿”å›è‡ªå·±"""
        self.file = open(self.filename, 'r', encoding='utf-8')
        return self
    
    def __next__(self):
        """è¯»å–ä¸‹ä¸€è¡Œ"""
        if self.file is None:
            raise StopIteration
        
        line = self.file.readline()
        if line:
            return line.strip()  # å»æ‰æ¢è¡Œç¬¦
        else:
            # æ–‡ä»¶è¯»å®Œäº†ï¼Œå…³é—­æ–‡ä»¶
            self.file.close()
            self.file = None
            raise StopIteration

# ä½¿ç”¨ç¤ºä¾‹ï¼ˆå‡è®¾æœ‰ä¸ªæ–‡ä»¶å« data.txtï¼‰
# for line in FileLineIterator('data.txt'):
#     print(f"è¯»å–åˆ°: {line}")
```

### 4.4 å¸¦çŠ¶æ€çš„æ™ºèƒ½è¿­ä»£å™¨


```python
class SmartRange:
    """å¸¦ç»Ÿè®¡åŠŸèƒ½çš„èŒƒå›´è¿­ä»£å™¨"""
    
    def __init__(self, start, end, step=1):
        self.start = start
        self.end = end
        self.step = step
        self.current = start
        self.count = 0  # ç»Ÿè®¡è®¿é—®æ¬¡æ•°
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current < self.end:
            value = self.current
            self.current += self.step
            self.count += 1
            return value
        else:
            raise StopIteration
    
    def get_stats(self):
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        return {
            'total_accessed': self.count,
            'current_position': self.current,
            'remaining': max(0, (self.end - self.current) // self.step)
        }

# ä½¿ç”¨ç¤ºä¾‹
smart_range = SmartRange(0, 10, 2)

print("éå†å¶æ•°ï¼š")
for num in smart_range:
    if num >= 6:  # æå‰é€€å‡º
        break
    print(num)

print("ç»Ÿè®¡ä¿¡æ¯ï¼š", smart_range.get_stats())
# è¾“å‡ºç±»ä¼¼ï¼š{'total_accessed': 3, 'current_position': 6, 'remaining': 2}
```

---

## 5. ğŸ¨ è¿­ä»£å™¨è®¾è®¡æ¨¡å¼ä¸æœ€ä½³å®è·µ


### 5.1 è¿­ä»£å™¨è®¾è®¡æ¨¡å¼åŸç†


**ğŸ”¸ è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³**ï¼š
è¿­ä»£å™¨æ¨¡å¼å…è®¸æˆ‘ä»¬éå†å®¹å™¨ä¸­çš„å…ƒç´ ï¼Œè€Œä¸éœ€è¦æš´éœ²å®¹å™¨çš„å†…éƒ¨ç»“æ„ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸å¥½ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç›´æ¥è®¿é—®å†…éƒ¨ç»“æ„    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚   å®¹å™¨å¯¹è±¡   â”‚
â”‚           â”‚                    â”‚ [0][1][2]... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šå®¢æˆ·ç«¯éœ€è¦çŸ¥é“å®¹å™¨çš„å†…éƒ¨å®ç°

è¿­ä»£å™¨æ¨¡å¼ï¼ˆå¥½ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ä½¿ç”¨è¿­ä»£å™¨æ¥å£    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è®¿é—®    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚   è¿­ä»£å™¨     â”‚ â”€â”€â”€â”€â†’   â”‚   å®¹å™¨å¯¹è±¡   â”‚
â”‚           â”‚                    â”‚           â”‚         â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜åŠ¿ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å®¹å™¨å†…éƒ¨å®ç°
```

### 5.2 è¿­ä»£å™¨æœ€ä½³å®è·µ


**âœ… å¥½çš„åšæ³•**ï¼š

```python
class GoodPracticeIterator:
    """å±•ç¤ºè¿­ä»£å™¨æœ€ä½³å®è·µ"""
    
    def __init__(self, data):
        self.data = data
        self.index = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        # 1. è¾¹ç•Œæ£€æŸ¥
        if self.index >= len(self.data):
            raise StopIteration
        
        # 2. è·å–å½“å‰å€¼
        value = self.data[self.index]
        
        # 3. æ›´æ–°çŠ¶æ€
        self.index += 1
        
        # 4. è¿”å›å€¼
        return value
    
    def __repr__(self):
        """æä¾›æœ‰ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤º"""
        return f"Iterator(current={self.index}, total={len(self.data)})"
```

**âŒ åº”è¯¥é¿å…çš„åšæ³•**ï¼š

```python
class BadPracticeIterator:
    """å±•ç¤ºé”™è¯¯çš„è¿­ä»£å™¨å®ç°"""
    
    def __init__(self, data):
        self.data = data
        self.index = 0
    
    def __iter__(self):
        # é”™è¯¯1ï¼šè¿”å›æ–°çš„è¿­ä»£å™¨è€Œä¸æ˜¯è‡ªå·±
        return BadPracticeIterator(self.data)
    
    def __next__(self):
        # é”™è¯¯2ï¼šæ²¡æœ‰è¾¹ç•Œæ£€æŸ¥
        value = self.data[self.index]  # å¯èƒ½æŠ›å‡º IndexError
        self.index += 1
        return value
        
        # é”™è¯¯3ï¼šå¿˜è®°æŠ›å‡º StopIteration
```

### 5.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ å†…å­˜æ•ˆç‡ä¼˜åŒ–**ï¼š

```python
class MemoryEfficientRange:
    """å†…å­˜é«˜æ•ˆçš„èŒƒå›´è¿­ä»£å™¨"""
    
    def __init__(self, end):
        self.end = end
        self.current = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current < self.end:
            # ä¸å­˜å‚¨æ‰€æœ‰å€¼ï¼Œåªè®¡ç®—å½“å‰å€¼
            value = self.current
            self.current += 1
            return value
        raise StopIteration

# å¯¹æ¯”ï¼šè¿™ä¸ªè¿­ä»£å™¨æ— è®ºèŒƒå›´å¤šå¤§ï¼Œå†…å­˜ä½¿ç”¨éƒ½æ˜¯å¸¸æ•°çº§åˆ«
# è€Œå¦‚æœç”¨ list(range(1000000))ï¼Œä¼šå ç”¨å¤§é‡å†…å­˜
```

**ğŸ”¸ æ‡’åŠ è½½æŠ€å·§**ï¼š

```python
class LazyFileProcessor:
    """æ‡’åŠ è½½æ–‡ä»¶å¤„ç†å™¨"""
    
    def __init__(self, filename):
        self.filename = filename
    
    def __iter__(self):
        # åªæœ‰çœŸæ­£å¼€å§‹è¿­ä»£æ—¶æ‰æ‰“å¼€æ–‡ä»¶
        with open(self.filename, 'r') as file:
            for line in file:
                # åªæœ‰å½“éœ€è¦æ—¶æ‰å¤„ç†æ¯ä¸€è¡Œ
                processed_line = line.strip().upper()
                yield processed_line  # ä½¿ç”¨ç”Ÿæˆå™¨ç®€åŒ–ä»£ç 
```

### 5.4 å¼‚å¸¸å¤„ç†å’Œèµ„æºç®¡ç†


```python
class SafeIterator:
    """å®‰å…¨çš„è¿­ä»£å™¨å®ç°ï¼ŒåŒ…å«å®Œå–„çš„å¼‚å¸¸å¤„ç†"""
    
    def __init__(self, data_source):
        self.data_source = data_source
        self.position = 0
        self.resource = None
    
    def __iter__(self):
        try:
            # åˆå§‹åŒ–èµ„æº
            self.resource = self._initialize_resource()
            return self
        except Exception as e:
            raise RuntimeError(f"Failed to initialize iterator: {e}")
    
    def __next__(self):
        try:
            if self.position >= len(self.data_source):
                # æ¸…ç†èµ„æº
                self._cleanup()
                raise StopIteration
            
            value = self.data_source[self.position]
            self.position += 1
            return value
            
        except (IndexError, KeyError) as e:
            self._cleanup()
            raise StopIteration from e
        except Exception as e:
            self._cleanup()
            raise RuntimeError(f"Error during iteration: {e}") from e
    
    def _initialize_resource(self):
        """åˆå§‹åŒ–éœ€è¦çš„èµ„æº"""
        # æ¯”å¦‚æ‰“å¼€æ–‡ä»¶ã€å»ºç«‹ç½‘ç»œè¿æ¥ç­‰
        pass
    
    def _cleanup(self):
        """æ¸…ç†èµ„æº"""
        if self.resource:
            # å…³é—­æ–‡ä»¶ã€æ–­å¼€è¿æ¥ç­‰
            self.resource = None
```

### 5.5 è¿­ä»£å™¨çš„ç»„åˆä½¿ç”¨


```python
from itertools import chain, islice

class IteratorComposition:
    """å±•ç¤ºè¿­ä»£å™¨çš„ç»„åˆä½¿ç”¨"""
    
    @staticmethod
    def demo_chaining():
        """é“¾æ¥å¤šä¸ªè¿­ä»£å™¨"""
        list1 = [1, 2, 3]
        list2 = [4, 5, 6]
        list3 = [7, 8, 9]
        
        # å°†å¤šä¸ªè¿­ä»£å™¨é“¾æ¥æˆä¸€ä¸ª
        combined = chain(list1, list2, list3)
        return list(combined)  # [1, 2, 3, 4, 5, 6, 7, 8, 9]
    
    @staticmethod
    def demo_slicing():
        """å¯¹è¿­ä»£å™¨è¿›è¡Œåˆ‡ç‰‡"""
        infinite_range = iter(range(1000000))  # å¾ˆå¤§çš„èŒƒå›´
        
        # åªå–å‰5ä¸ªå…ƒç´ 
        first_five = list(islice(infinite_range, 5))
        return first_five  # [0, 1, 2, 3, 4]
    
    @staticmethod
    def demo_filtering():
        """è¿‡æ»¤è¿­ä»£å™¨"""
        numbers = range(10)
        
        # åªä¿ç•™å¶æ•°
        even_numbers = filter(lambda x: x % 2 == 0, numbers)
        return list(even_numbers)  # [0, 2, 4, 6, 8]
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿­ä»£åè®®ï¼šPythonå®šä¹‰çš„éå†å®¹å™¨çš„æ ‡å‡†è§„åˆ™
ğŸ”¸ å¯è¿­ä»£å¯¹è±¡ï¼šå®ç°äº†__iter__()æ–¹æ³•ï¼Œèƒ½è¢«éå†çš„å¯¹è±¡
ğŸ”¸ è¿­ä»£å™¨ï¼šå®ç°äº†__iter__()å’Œ__next__()æ–¹æ³•ï¼ŒçŸ¥é“ä¸‹ä¸€ä¸ªå…ƒç´ çš„å¯¹è±¡
ğŸ”¸ StopIterationï¼šè¿­ä»£ç»“æŸæ—¶æŠ›å‡ºçš„ç‰¹æ®Šå¼‚å¸¸
ğŸ”¸ iter()å’Œnext()ï¼šPythonæä¾›çš„å†…ç½®å‡½æ•°ï¼Œç®€åŒ–è¿­ä»£æ“ä½œ
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¯è¿­ä»£å¯¹è±¡ vs è¿­ä»£å™¨çš„æœ¬è´¨åŒºåˆ«**ï¼š
```
å¯è¿­ä»£å¯¹è±¡ = "èƒ½è¢«éå†çš„å®¹å™¨"
è¿­ä»£å™¨ = "çŸ¥é“æ€ä¹ˆéå†çš„æ™ºèƒ½æŒ‡é’ˆ"

è®°å¿†å£è¯€ï¼š
- å¯è¿­ä»£å¯¹è±¡åƒä¹¦æ¶ï¼Œå¯ä»¥åå¤æŸ¥çœ‹
- è¿­ä»£å™¨åƒä¹¦ç­¾ï¼Œç”¨å®Œå°±è¦é‡æ–°åˆ›å»º
```

**ğŸ”¹ ä¸ºä»€ä¹ˆè¿­ä»£å™¨åªèƒ½ç”¨ä¸€æ¬¡**ï¼š
```
è¿­ä»£å™¨ç»´æŠ¤å†…éƒ¨çŠ¶æ€ï¼ˆå½“å‰ä½ç½®ï¼‰
ä¸€æ—¦åˆ°è¾¾ç»ˆç‚¹ï¼ŒçŠ¶æ€å°±æ— æ³•é‡ç½®
è¿™æ˜¯è®¾è®¡ä¸Šçš„é€‰æ‹©ï¼Œä¿è¯äº†ç®€å•æ€§å’Œæ•ˆç‡
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™è‡ªå®šä¹‰è¿­ä»£å™¨**ï¼š
```
âœ… éœ€è¦ç‰¹æ®Šçš„éå†é€»è¾‘
âœ… å¤„ç†å¤§é‡æ•°æ®ï¼Œéœ€è¦å†…å­˜æ•ˆç‡
âœ… éœ€è¦æ‡’åŠ è½½æˆ–å»¶è¿Ÿè®¡ç®—
âœ… è¦éšè—å¤æ‚çš„å†…éƒ¨æ•°æ®ç»“æ„
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ“ˆ æ€§èƒ½ä¼˜åŠ¿**ï¼š
- **å†…å­˜æ•ˆç‡**ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
- **è®¡ç®—æ•ˆç‡**ï¼šåªè®¡ç®—éœ€è¦çš„å€¼ï¼ˆæ‡’åŠ è½½ï¼‰
- **æ—¶é—´æ•ˆç‡**ï¼šå¯ä»¥æå‰ç»ˆæ­¢è¿­ä»£

**ğŸ› ï¸ è®¾è®¡ä¼˜åŠ¿**ï¼š
- **å°è£…æ€§**ï¼šéšè—å†…éƒ¨å®ç°ç»†èŠ‚
- **ä¸€è‡´æ€§**ï¼šç»Ÿä¸€çš„éå†æ¥å£
- **çµæ´»æ€§**ï¼šæ”¯æŒå„ç§å¤æ‚çš„éå†é€»è¾‘

**ğŸ’¼ å¸¸è§åº”ç”¨åœºæ™¯**ï¼š
- **æ–‡ä»¶å¤„ç†**ï¼šé€è¡Œè¯»å–å¤§æ–‡ä»¶
- **æ•°æ®æµå¤„ç†**ï¼šå¤„ç†ç½‘ç»œæ•°æ®æµ
- **ç®—æ³•å®ç°**ï¼šæ ‘çš„éå†ã€å›¾çš„æœç´¢
- **Webå¼€å‘**ï¼šåˆ†é¡µæ•°æ®çš„æ‡’åŠ è½½

### 6.4 æœ€ä½³å®è·µæ€»ç»“


**âœ… æ¨èåšæ³•**ï¼š
```python
# 1. åˆ†ç¦»å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨
class Container:
    def __iter__(self):
        return ContainerIterator(self)

# 2. å®Œå–„çš„å¼‚å¸¸å¤„ç†
def __next__(self):
    if condition:
        return value
    raise StopIteration

# 3. ä½¿ç”¨ç”Ÿæˆå™¨ç®€åŒ–ä»£ç ï¼ˆä¸‹ä¸€ç« å†…å®¹ï¼‰
def simple_iterator():
    yield from range(5)
```

**âŒ é¿å…çš„é”™è¯¯**ï¼š
```python
# 1. è¿­ä»£å™¨çš„__iter__è¿”å›æ–°å¯¹è±¡
def __iter__(self):
    return NewIterator()  # é”™è¯¯ï¼åº”è¯¥è¿”å›self

# 2. å¿˜è®°æŠ›å‡ºStopIteration
def __next__(self):
    return self.data[self.index]  # é”™è¯¯ï¼æ²¡æœ‰è¾¹ç•Œæ£€æŸ¥

# 3. åœ¨__next__ä¸­æ•è·StopIteration
def __next__(self):
    try:
        return next(self.inner_iterator)
    except StopIteration:
        return None  # é”™è¯¯ï¼åº”è¯¥è®©å¼‚å¸¸ä¼ æ’­
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è¿­ä»£åè®®åˆ†ä¸¤è§’ï¼Œå¯è¿­ä»£å’Œè¿­ä»£å™¨
- iteræ–¹æ³•è¿”è¿­ä»£ï¼Œnextæ–¹æ³•çŸ¥ä¸‹ä¸ª  
- StopIterationæ˜¯ä¿¡å·ï¼Œéå†ç»“æŸè¦è®°ç‰¢
- ä¸€æ¬¡æ€§ç”¨å®Œéœ€é‡å»ºï¼Œå†…å­˜é«˜æ•ˆæ˜¯ä¼˜ç‚¹