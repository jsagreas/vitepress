---
title: 15ã€ä»£ç æ‰§è¡Œå‡½æ•°
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ä»£ç æ‰§è¡Œå‡½æ•°](#1-ä»€ä¹ˆæ˜¯ä»£ç æ‰§è¡Œå‡½æ•°)
2. [eval()å‡½æ•°è¯¦è§£](#2-evalå‡½æ•°è¯¦è§£)
3. [exec()å‡½æ•°è¯¦è§£](#3-execå‡½æ•°è¯¦è§£)
4. [compile()å‡½æ•°è¯¦è§£](#4-compileå‡½æ•°è¯¦è§£)
5. [ä¸‰è€…å¯¹æ¯”åˆ†æ](#5-ä¸‰è€…å¯¹æ¯”åˆ†æ)
6. [å®‰å…¨æ€§è€ƒè™‘](#6-å®‰å…¨æ€§è€ƒè™‘)
7. [å®é™…åº”ç”¨åœºæ™¯](#7-å®é™…åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯ä»£ç æ‰§è¡Œå‡½æ•°


### 1.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ç®€å•æ¥è¯´**ï¼Œä»£ç æ‰§è¡Œå‡½æ•°å°±æ˜¯è®©Pythonèƒ½å¤Ÿæ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„ä»£ç çš„å·¥å…·å‡½æ•°ã€‚

```
æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„æƒ…å†µï¼š
ä½ æœ‰ä¸€ä¸ªå­—ç¬¦ä¸² "2 + 3"
æ™®é€šæƒ…å†µä¸‹ï¼ŒPythonåªä¼šæŠŠå®ƒå½“ä½œæ™®é€šæ–‡æœ¬
ä½†ç”¨äº†æ‰§è¡Œå‡½æ•°åï¼ŒPythonå°±èƒ½æŠŠå®ƒå½“ä½œæ•°å­¦è®¡ç®—æ¥æ‰§è¡Œï¼Œå¾—åˆ°ç»“æœ 5
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ“ å°†æ–‡æœ¬å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„Pythonä»£ç 
- âš¡ åŠ¨æ€æ‰§è¡Œç”¨æˆ·è¾“å…¥æˆ–ç¨‹åºç”Ÿæˆçš„ä»£ç 
- ğŸ”§ æä¾›ä»£ç çš„ç¼–è¯‘å’Œä¼˜åŒ–èƒ½åŠ›

### 1.2 ä¸‰å¤§æ ¸å¿ƒå‡½æ•°ç®€ä»‹


```
eval()  â†’  æ‰§è¡Œè¡¨è¾¾å¼ï¼Œè¿”å›ç»“æœå€¼
exec()  â†’  æ‰§è¡Œè¯­å¥å—ï¼Œä¸è¿”å›å€¼  
compile() â†’ ç¼–è¯‘ä»£ç ï¼Œç”Ÿæˆä»£ç å¯¹è±¡
```

**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
- `eval()` å°±åƒè®¡ç®—å™¨ï¼šè¾“å…¥ "2+3"ï¼Œç›´æ¥ç»™ä½ ç­”æ¡ˆ 5
- `exec()` å°±åƒæ‰§è¡Œå‘½ä»¤ï¼šè¾“å…¥ "print('hello')"ï¼Œç›´æ¥æ‰§è¡Œæ‰“å°åŠ¨ä½œ
- `compile()` å°±åƒç¿»è¯‘ï¼šæŠŠä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼Œä½†è¿˜æ²¡æœ‰æœ—è¯»

---

## 2. ğŸ§® eval()å‡½æ•°è¯¦è§£


### 2.1 åŸºæœ¬è¯­æ³•å’Œå«ä¹‰


**å‡½æ•°ç­¾å**ï¼š
```python
eval(expression, globals=None, locals=None)
```

**é€šä¿—è§£é‡Š**ï¼š
- `expression`ï¼šè¦è®¡ç®—çš„è¡¨è¾¾å¼ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰
- `globals`ï¼šå…¨å±€å˜é‡å­—å…¸ï¼ˆå¯é€‰ï¼‰
- `locals`ï¼šå±€éƒ¨å˜é‡å­—å…¸ï¼ˆå¯é€‰ï¼‰

### 2.2 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


**ğŸ”¸ æ•°å­¦è®¡ç®—**
```python
# åŸºæœ¬æ•°å­¦è¿ç®—
result = eval("2 + 3 * 4")
print(result)  # è¾“å‡ºï¼š14

# ä½¿ç”¨å˜é‡
x = 10
result = eval("x * 2 + 5")
print(result)  # è¾“å‡ºï¼š25
```

**ğŸ”¸ å­—ç¬¦ä¸²æ“ä½œ**
```python
# å­—ç¬¦ä¸²æ‹¼æ¥
name = "å¼ ä¸‰"
greeting = eval("'ä½ å¥½ï¼Œ' + name + 'ï¼'")
print(greeting)  # è¾“å‡ºï¼šä½ å¥½ï¼Œå¼ ä¸‰ï¼

# å­—ç¬¦ä¸²æ–¹æ³•è°ƒç”¨
text = "hello world"
result = eval("text.upper()")
print(result)  # è¾“å‡ºï¼šHELLO WORLD
```

**ğŸ”¸ åˆ—è¡¨å’Œå­—å…¸æ“ä½œ**
```python
# åˆ—è¡¨åˆ›å»º
numbers = eval("[1, 2, 3, 4, 5]")
print(numbers)  # è¾“å‡ºï¼š[1, 2, 3, 4, 5]

# å­—å…¸åˆ›å»º
person = eval("{'name': 'æå››', 'age': 25}")
print(person)  # è¾“å‡ºï¼š{'name': 'æå››', 'age': 25}
```

### 2.3 å˜é‡ä½œç”¨åŸŸæ§åˆ¶


**ğŸ”¸ å…¨å±€å’Œå±€éƒ¨å˜é‡**
```python
# ä¸æŒ‡å®šå˜é‡ä½œç”¨åŸŸï¼ˆä½¿ç”¨å½“å‰ç¯å¢ƒï¼‰
x = 100
result = eval("x + 50")
print(result)  # è¾“å‡ºï¼š150

# æŒ‡å®šå…¨å±€å˜é‡
global_vars = {'x': 200, 'y': 300}
result = eval("x + y", global_vars)
print(result)  # è¾“å‡ºï¼š500

# åŒæ—¶æŒ‡å®šå…¨å±€å’Œå±€éƒ¨å˜é‡
global_vars = {'x': 100}
local_vars = {'y': 50}
result = eval("x + y", global_vars, local_vars)
print(result)  # è¾“å‡ºï¼š150
```

### 2.4 å®é™…åº”ç”¨åœºæ™¯


**ğŸ”¸ ç®€å•è®¡ç®—å™¨**
```python
def simple_calculator():
    while True:
        try:
            expression = input("è¯·è¾“å…¥æ•°å­¦è¡¨è¾¾å¼ï¼ˆè¾“å…¥'quit'é€€å‡ºï¼‰ï¼š")
            if expression.lower() == 'quit':
                break
            result = eval(expression)
            print(f"ç»“æœï¼š{result}")
        except:
            print("è¾“å…¥æœ‰è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥")

# simple_calculator()
```

**ğŸ”¸ é…ç½®æ–‡ä»¶è§£æ**
```python
# å‡è®¾é…ç½®æ–‡ä»¶ä¸­æœ‰è¿™æ ·çš„å†…å®¹
config_text = "{'host': 'localhost', 'port': 8080, 'debug': True}"
config = eval(config_text)
print(f"æœåŠ¡å™¨åœ°å€ï¼š{config['host']}:{config['port']}")
```

### 2.5 eval()çš„é™åˆ¶


**âš ï¸ é‡è¦é™åˆ¶**ï¼š
- åªèƒ½æ‰§è¡Œ**è¡¨è¾¾å¼**ï¼Œä¸èƒ½æ‰§è¡Œ**è¯­å¥**
- è¡¨è¾¾å¼å¿…é¡»æœ‰**è¿”å›å€¼**

```python
# âœ… è¿™äº›å¯ä»¥ç”¨eval()
eval("2 + 3")           # æ•°å­¦è¡¨è¾¾å¼
eval("'hello'.upper()") # æ–¹æ³•è°ƒç”¨
eval("[1, 2, 3]")       # åˆ—è¡¨åˆ›å»º

# âŒ è¿™äº›ä¸èƒ½ç”¨eval()
# eval("print('hello')")  # printæ˜¯è¯­å¥ï¼Œä¸æ˜¯è¡¨è¾¾å¼
# eval("x = 5")           # èµ‹å€¼æ˜¯è¯­å¥ï¼Œä¸æ˜¯è¡¨è¾¾å¼  
# eval("if x > 0: pass")  # ifè¯­å¥ä¸æ˜¯è¡¨è¾¾å¼
```

---

## 3. ğŸš€ exec()å‡½æ•°è¯¦è§£


### 3.1 åŸºæœ¬è¯­æ³•å’Œå«ä¹‰


**å‡½æ•°ç­¾å**ï¼š
```python
exec(object, globals=None, locals=None)
```

**é€šä¿—è§£é‡Š**ï¼š
- `object`ï¼šè¦æ‰§è¡Œçš„ä»£ç ï¼ˆå­—ç¬¦ä¸²ã€ä»£ç å¯¹è±¡æˆ–æ–‡ä»¶å¯¹è±¡ï¼‰
- `globals`ï¼šå…¨å±€å˜é‡å­—å…¸ï¼ˆå¯é€‰ï¼‰
- `locals`ï¼šå±€éƒ¨å˜é‡å­—å…¸ï¼ˆå¯é€‰ï¼‰

### 3.2 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


**ğŸ”¸ æ‰§è¡Œç®€å•è¯­å¥**
```python
# æ‰§è¡Œæ‰“å°è¯­å¥
exec("print('Hello, World!')")
# è¾“å‡ºï¼šHello, World!

# æ‰§è¡Œå˜é‡èµ‹å€¼
exec("x = 10; y = 20; z = x + y")
print(z)  # è¾“å‡ºï¼š30
```

**ğŸ”¸ æ‰§è¡Œå¤æ‚ä»£ç å—**
```python
# æ‰§è¡Œå‡½æ•°å®šä¹‰
code = """
def greet(name):
    return f"ä½ å¥½ï¼Œ{name}ï¼"

message = greet("å°æ˜")
print(message)
"""
exec(code)
# è¾“å‡ºï¼šä½ å¥½ï¼Œå°æ˜ï¼
```

**ğŸ”¸ æ‰§è¡Œå¾ªç¯å’Œæ¡ä»¶è¯­å¥**
```python
# æ‰§è¡Œforå¾ªç¯
loop_code = """
numbers = [1, 2, 3, 4, 5]
total = 0
for num in numbers:
    total += num
print(f"æ€»å’Œæ˜¯ï¼š{total}")
"""
exec(loop_code)
# è¾“å‡ºï¼šæ€»å’Œæ˜¯ï¼š15

# æ‰§è¡Œæ¡ä»¶åˆ¤æ–­
condition_code = """
score = 85
if score >= 90:
    grade = "ä¼˜ç§€"
elif score >= 80:
    grade = "è‰¯å¥½"
else:
    grade = "ä¸€èˆ¬"
print(f"æˆç»©ç­‰çº§ï¼š{grade}")
"""
exec(condition_code)
# è¾“å‡ºï¼šæˆç»©ç­‰çº§ï¼šè‰¯å¥½
```

### 3.3 å˜é‡ä½œç”¨åŸŸç®¡ç†


**ğŸ”¸ ä½œç”¨åŸŸéš”ç¦»**
```python
# åœ¨ç‹¬ç«‹çš„å‘½åç©ºé—´ä¸­æ‰§è¡Œ
namespace = {}
exec("x = 100; y = 200", namespace)
print(namespace)  # è¾“å‡ºï¼š{'__builtins__': {...}, 'x': 100, 'y': 200}

# è®¿é—®æ‰§è¡Œç»“æœ
exec("result = x + y", namespace)
print(namespace['result'])  # è¾“å‡ºï¼š300
```

**ğŸ”¸ å®é™…åº”ç”¨ç¤ºä¾‹**
```python
# åŠ¨æ€åˆ›å»ºç±»
class_code = """
class Student:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    
    def introduce(self):
        return f"æˆ‘å«{self.name}ï¼Œä»Šå¹´{self.age}å²"

# åˆ›å»ºå®ä¾‹
student = Student("ç‹äº”", 18)
print(student.introduce())
"""
exec(class_code)
# è¾“å‡ºï¼šæˆ‘å«ç‹äº”ï¼Œä»Šå¹´18å²
```

### 3.4 exec()ä¸eval()çš„åŒºåˆ«


| ç‰¹æ€§ | **eval()** | **exec()** |
|------|------------|------------|
| **ç”¨é€”** | `æ‰§è¡Œè¡¨è¾¾å¼` | `æ‰§è¡Œè¯­å¥å—` |
| **è¿”å›å€¼** | `æœ‰è¿”å›å€¼` | `æ€»æ˜¯è¿”å›None` |
| **å¯æ‰§è¡Œå†…å®¹** | `å•ä¸ªè¡¨è¾¾å¼` | `ä»»æ„Pythonä»£ç ` |
| **ä½¿ç”¨åœºæ™¯** | `è®¡ç®—ã€æ±‚å€¼` | `åŠ¨æ€æ‰§è¡Œå¤æ‚é€»è¾‘` |

---

## 4. ğŸ”§ compile()å‡½æ•°è¯¦è§£


### 4.1 åŸºæœ¬æ¦‚å¿µç†è§£


**compile()æ˜¯ä»€ä¹ˆï¼Ÿ**
æƒ³è±¡ä¸€ä¸‹ç¿»è¯‘çš„è¿‡ç¨‹ï¼š
- ä½ æœ‰ä¸€æ®µä¸­æ–‡æ–‡ç« ï¼ˆPythonä»£ç å­—ç¬¦ä¸²ï¼‰
- ç¿»è¯‘å®˜æŠŠå®ƒç¿»è¯‘æˆè‹±æ–‡ï¼ˆç¼–è¯‘æˆå­—èŠ‚ç ï¼‰
- ä½†æ˜¯è¿˜æ²¡æœ‰æœ—è¯»å‡ºæ¥ï¼ˆè¿˜æ²¡æœ‰æ‰§è¡Œï¼‰

**å‡½æ•°ç­¾å**ï¼š
```python
compile(source, filename, mode, flags=0, dont_inherit=False, optimize=-1)
```

### 4.2 å…³é”®å‚æ•°è¯¦è§£


**ğŸ”¸ æ ¸å¿ƒå‚æ•°**
- `source`ï¼šè¦ç¼–è¯‘çš„ä»£ç ï¼ˆå­—ç¬¦ä¸²ï¼‰
- `filename`ï¼šä»£ç æ¥æºæ–‡ä»¶åï¼ˆé€šå¸¸ç”¨ `'<string>'`ï¼‰
- `mode`ï¼šç¼–è¯‘æ¨¡å¼

**ç¼–è¯‘æ¨¡å¼è¯´æ˜**ï¼š
```
'eval'  â†’  ç¼–è¯‘å•ä¸ªè¡¨è¾¾å¼ï¼ˆé…åˆevalä½¿ç”¨ï¼‰
'exec'  â†’  ç¼–è¯‘è¯­å¥å—ï¼ˆé…åˆexecä½¿ç”¨ï¼‰
'single' â†’ ç¼–è¯‘å•ä¸ªäº¤äº’å¼è¯­å¥
```

### 4.3 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


**ğŸ”¸ ç¼–è¯‘è¡¨è¾¾å¼**
```python
# ç¼–è¯‘æ•°å­¦è¡¨è¾¾å¼
expression = "2 + 3 * 4"
code_obj = compile(expression, '<string>', 'eval')
result = eval(code_obj)
print(result)  # è¾“å‡ºï¼š14

# ç¼–è¯‘åå¯ä»¥é‡å¤ä½¿ç”¨
for i in range(3):
    result = eval(code_obj)
    print(f"ç¬¬{i+1}æ¬¡è®¡ç®—ï¼š{result}")
```

**ğŸ”¸ ç¼–è¯‘è¯­å¥å—**
```python
# ç¼–è¯‘å¤æ‚ä»£ç 
source_code = """
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# è®¡ç®—å‰10ä¸ªæ–æ³¢é‚£å¥‘æ•°
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")
"""

code_obj = compile(source_code, '<string>', 'exec')
exec(code_obj)
```

### 4.4 æ€§èƒ½ä¼˜åŒ–åº”ç”¨


**ğŸ”¸ é‡å¤æ‰§è¡Œä¼˜åŒ–**
```python
import time

# æ–¹æ³•1ï¼šæ¯æ¬¡éƒ½ç¼–è¯‘æ‰§è¡Œï¼ˆè¾ƒæ…¢ï¼‰
def method1():
    start_time = time.time()
    for i in range(1000):
        eval("2 ** 10 + 5 * 3")
    end_time = time.time()
    print(f"æ–¹æ³•1è€—æ—¶ï¼š{end_time - start_time:.4f}ç§’")

# æ–¹æ³•2ï¼šç¼–è¯‘ä¸€æ¬¡ï¼Œé‡å¤æ‰§è¡Œï¼ˆè¾ƒå¿«ï¼‰
def method2():
    start_time = time.time()
    code_obj = compile("2 ** 10 + 5 * 3", '<string>', 'eval')
    for i in range(1000):
        eval(code_obj)
    end_time = time.time()
    print(f"æ–¹æ³•2è€—æ—¶ï¼š{end_time - start_time:.4f}ç§’")

# method1()
# method2()
```

### 4.5 è¯­æ³•æ£€æŸ¥åŠŸèƒ½


**ğŸ”¸ ä»£ç é¢„æ£€æŸ¥**
```python
def check_syntax(code):
    """æ£€æŸ¥ä»£ç è¯­æ³•æ˜¯å¦æ­£ç¡®"""
    try:
        compile(code, '<string>', 'exec')
        return True, "è¯­æ³•æ­£ç¡®"
    except SyntaxError as e:
        return False, f"è¯­æ³•é”™è¯¯ï¼š{e}"

# æµ‹è¯•ç¤ºä¾‹
test_codes = [
    "print('Hello, World!')",           # æ­£ç¡®è¯­æ³•
    "print('Hello, World!'",            # ç¼ºå°‘å³æ‹¬å·
    "if x > 0 print('positive')",       # ç¼ºå°‘å†’å·
    "def func(): return 42"             # æ­£ç¡®è¯­æ³•
]

for code in test_codes:
    is_valid, message = check_syntax(code)
    print(f"ä»£ç ï¼š{code}")
    print(f"ç»“æœï¼š{message}\n")
```

---

## 5. âš–ï¸ ä¸‰è€…å¯¹æ¯”åˆ†æ


### 5.1 åŠŸèƒ½å¯¹æ¯”è¡¨


| å‡½æ•° | **ä¸»è¦ç”¨é€”** | **è¾“å…¥ç±»å‹** | **è¿”å›å€¼** | **é€‚ç”¨åœºæ™¯** |
|------|-------------|-------------|------------|-------------|
| **eval()** | `æ‰§è¡Œè¡¨è¾¾å¼æ±‚å€¼` | `è¡¨è¾¾å¼å­—ç¬¦ä¸²` | `è¡¨è¾¾å¼çš„ç»“æœ` | `è®¡ç®—å™¨ã€é…ç½®è§£æ` |
| **exec()** | `æ‰§è¡Œä»£ç è¯­å¥` | `ä»£ç å­—ç¬¦ä¸²/å¯¹è±¡` | `None` | `åŠ¨æ€ä»£ç æ‰§è¡Œ` |
| **compile()** | `ç¼–è¯‘ä»£ç å¯¹è±¡` | `ä»£ç å­—ç¬¦ä¸²` | `ä»£ç å¯¹è±¡` | `æ€§èƒ½ä¼˜åŒ–ã€è¯­æ³•æ£€æŸ¥` |

### 5.2 ä½¿ç”¨åœºæ™¯å†³ç­–


```
é€‰æ‹©eval()çš„æƒ…å†µï¼š
âœ… éœ€è¦è®¡ç®—è¡¨è¾¾å¼çš„å€¼
âœ… å¤„ç†é…ç½®æ–‡ä»¶ä¸­çš„ç®€å•æ•°æ®
âœ… å®ç°ç®€å•çš„è®¡ç®—å™¨åŠŸèƒ½

é€‰æ‹©exec()çš„æƒ…å†µï¼š  
âœ… éœ€è¦æ‰§è¡Œå®Œæ•´çš„Pythonä»£ç 
âœ… åŠ¨æ€åˆ›å»ºå‡½æ•°æˆ–ç±»
âœ… æ‰§è¡Œå¤æ‚çš„é€»è¾‘æµç¨‹

é€‰æ‹©compile()çš„æƒ…å†µï¼š
âœ… ä»£ç éœ€è¦é‡å¤æ‰§è¡Œå¤šæ¬¡
âœ… éœ€è¦é¢„å…ˆæ£€æŸ¥ä»£ç è¯­æ³•
âœ… å¯¹æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚
```

### 5.3 ç»„åˆä½¿ç”¨ç¤ºä¾‹


**ğŸ”¸ å®Œæ•´çš„åŠ¨æ€ä»£ç æ‰§è¡Œç³»ç»Ÿ**
```python
class CodeExecutor:
    def __init__(self):
        self.compiled_cache = {}
    
    def execute_expression(self, expression):
        """æ‰§è¡Œè¡¨è¾¾å¼å¹¶è¿”å›ç»“æœ"""
        try:
            if expression not in self.compiled_cache:
                self.compiled_cache[expression] = compile(expression, '<string>', 'eval')
            return eval(self.compiled_cache[expression])
        except Exception as e:
            return f"æ‰§è¡Œé”™è¯¯ï¼š{e}"
    
    def execute_statement(self, statement):
        """æ‰§è¡Œè¯­å¥å—"""
        try:
            code_obj = compile(statement, '<string>', 'exec')
            namespace = {}
            exec(code_obj, namespace)
            return namespace
        except Exception as e:
            return f"æ‰§è¡Œé”™è¯¯ï¼š{e}"

# ä½¿ç”¨ç¤ºä¾‹
executor = CodeExecutor()

# æ‰§è¡Œè¡¨è¾¾å¼
print(executor.execute_expression("3 ** 2 + 4 * 5"))  # è¾“å‡ºï¼š29

# æ‰§è¡Œè¯­å¥å—
result = executor.execute_statement("""
x = 10
y = 20
z = x * y
result = f"è®¡ç®—ç»“æœï¼š{z}"
""")
print(result.get('result', 'æ— ç»“æœ'))  # è¾“å‡ºï¼šè®¡ç®—ç»“æœï¼š200
```

---

## 6. ğŸ”’ å®‰å…¨æ€§è€ƒè™‘


### 6.1 æ½œåœ¨å®‰å…¨é£é™©


**âš ï¸ ä¸»è¦é£é™©**ï¼š
- ğŸš¨ **ä»£ç æ³¨å…¥æ”»å‡»**ï¼šæ¶æ„ç”¨æˆ·è¾“å…¥å±é™©ä»£ç 
- ğŸš¨ **ç³»ç»Ÿæ–‡ä»¶è®¿é—®**ï¼šå¯èƒ½è¯»å†™æ•æ„Ÿæ–‡ä»¶
- ğŸš¨ **ç½‘ç»œè¯·æ±‚**ï¼šå¯èƒ½å‘é€æ¶æ„ç½‘ç»œè¯·æ±‚
- ğŸš¨ **ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ**ï¼šå¯èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

### 6.2 å±é™©ä»£ç ç¤ºä¾‹


```python
# âš ï¸ å±é™©ï¼ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿™æ ·åš
dangerous_inputs = [
    "__import__('os').system('rm -rf /')",      # åˆ é™¤ç³»ç»Ÿæ–‡ä»¶
    "open('/etc/passwd').read()",               # è¯»å–æ•æ„Ÿæ–‡ä»¶
    "__import__('subprocess').call(['ls', '/'])" # æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
]

# è¿™äº›ä»£ç å¦‚æœè¢«eval()æˆ–exec()æ‰§è¡Œï¼Œå¯èƒ½é€ æˆä¸¥é‡åæœï¼
```

### 6.3 å®‰å…¨é˜²æŠ¤æªæ–½


**ğŸ”¸ é™åˆ¶å¯ç”¨å‡½æ•°å’Œæ¨¡å—**
```python
def safe_eval(expression):
    """å®‰å…¨çš„evalå‡½æ•°"""
    # å®šä¹‰å®‰å…¨çš„å†…ç½®å‡½æ•°
    safe_builtins = {
        'abs': abs, 'max': max, 'min': min, 'round': round,
        'len': len, 'sum': sum, 'int': int, 'float': float,
        'str': str, 'bool': bool
    }
    
    # å®šä¹‰å®‰å…¨çš„å…¨å±€å˜é‡ï¼ˆç©ºå­—å…¸ï¼Œé™åˆ¶è®¿é—®ï¼‰
    safe_globals = {'__builtins__': safe_builtins}
    
    try:
        return eval(expression, safe_globals, {})
    except Exception as e:
        return f"æ‰§è¡Œé”™è¯¯ï¼š{e}"

# æµ‹è¯•å®‰å…¨eval
print(safe_eval("2 + 3 * 4"))           # âœ… æ­£å¸¸ï¼š14
print(safe_eval("max([1, 5, 3])"))      # âœ… æ­£å¸¸ï¼š5
print(safe_eval("open('test.txt')"))    # âŒ é”™è¯¯ï¼šname 'open' is not defined
```

**ğŸ”¸ è¾“å…¥éªŒè¯å’Œè¿‡æ»¤**
```python
import re

def validate_input(code):
    """éªŒè¯è¾“å…¥ä»£ç çš„å®‰å…¨æ€§"""
    # å±é™©å…³é”®è¯åˆ—è¡¨
    dangerous_keywords = [
        'import', 'open', 'file', 'input', 'raw_input',
        'exec', 'eval', 'compile', '__', 'exit', 'quit'
    ]
    
    # æ£€æŸ¥æ˜¯å¦åŒ…å«å±é™©å…³é”®è¯
    for keyword in dangerous_keywords:
        if keyword in code.lower():
            return False, f"åŒ…å«å±é™©å…³é”®è¯ï¼š{keyword}"
    
    # æ£€æŸ¥æ˜¯å¦åªåŒ…å«å®‰å…¨å­—ç¬¦
    if not re.match(r'^[a-zA-Z0-9+\-*/().,%\s=<>!&|]+$', code):
        return False, "åŒ…å«ä¸å®‰å…¨å­—ç¬¦"
    
    return True, "è¾“å…¥å®‰å…¨"

# æµ‹è¯•è¾“å…¥éªŒè¯
test_inputs = [
    "2 + 3 * 4",                    # å®‰å…¨
    "import os",                    # å±é™©
    "max([1, 2, 3])",              # å®‰å…¨
    "__import__('os')"              # å±é™©
]

for inp in test_inputs:
    is_safe, message = validate_input(inp)
    print(f"è¾“å…¥ï¼š{inp} â†’ {message}")
```

---

## 7. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 7.1 æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨


```python
class MathCalculator:
    """å®‰å…¨çš„æ•°å­¦è®¡ç®—å™¨"""
    
    def __init__(self):
        # å…è®¸çš„æ•°å­¦å‡½æ•°
        self.math_functions = {
            'abs': abs, 'max': max, 'min': min, 'round': round,
            'pow': pow, 'sum': sum, 'len': len
        }
        
        # æ•°å­¦å¸¸æ•°
        self.math_constants = {
            'pi': 3.14159265359, 'e': 2.71828182846
        }
    
    def calculate(self, expression):
        """è®¡ç®—æ•°å­¦è¡¨è¾¾å¼"""
        try:
            # æ„å»ºå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒ
            safe_dict = {}
            safe_dict.update(self.math_functions)
            safe_dict.update(self.math_constants)
            
            # ç¼–è¯‘å¹¶æ‰§è¡Œè¡¨è¾¾å¼
            code_obj = compile(expression, '<string>', 'eval')
            result = eval(code_obj, {'__builtins__': {}}, safe_dict)
            return result
        except Exception as e:
            return f"è®¡ç®—é”™è¯¯ï¼š{e}"

# ä½¿ç”¨ç¤ºä¾‹
calc = MathCalculator()
print(calc.calculate("2 ** 3 + 4 * 5"))        # è¾“å‡ºï¼š28
print(calc.calculate("max([1, 5, 3, 2])"))      # è¾“å‡ºï¼š5
print(calc.calculate("round(pi, 2)"))           # è¾“å‡ºï¼š3.14
```

### 7.2 é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½


```python
class ConfigLoader:
    """é…ç½®æ–‡ä»¶åŠ è½½å™¨"""
    
    def load_config(self, config_string):
        """ä»å­—ç¬¦ä¸²åŠ è½½é…ç½®"""
        try:
            # å®‰å…¨çš„é…ç½®æ‰§è¡Œç¯å¢ƒ
            config_namespace = {}
            exec(config_string, {'__builtins__': {}}, config_namespace)
            
            # è¿‡æ»¤æ‰å†…éƒ¨å˜é‡ï¼Œåªè¿”å›é…ç½®é¡¹
            config = {k: v for k, v in config_namespace.items() 
                     if not k.startswith('__')}
            return config
        except Exception as e:
            return {'error': f"é…ç½®åŠ è½½å¤±è´¥ï¼š{e}"}

# ä½¿ç”¨ç¤ºä¾‹
config_text = """
# æœåŠ¡å™¨é…ç½®
HOST = 'localhost'
PORT = 8080
DEBUG = True

# æ•°æ®åº“é…ç½®
DATABASE = {
    'name': 'myapp',
    'user': 'admin',
    'password': 'secret'
}

# åŠŸèƒ½å¼€å…³
FEATURES = ['login', 'register', 'profile']
"""

loader = ConfigLoader()
config = loader.load_config(config_text)
print("åŠ è½½çš„é…ç½®ï¼š")
for key, value in config.items():
    print(f"  {key}: {value}")
```

### 7.3 ç®€å•è„šæœ¬è§£é‡Šå™¨


```python
class SimpleInterpreter:
    """ç®€å•çš„Pythonä»£ç è§£é‡Šå™¨"""
    
    def __init__(self):
        self.variables = {}
        self.functions = {}
    
    def execute_line(self, line):
        """æ‰§è¡Œå•è¡Œä»£ç """
        line = line.strip()
        if not line or line.startswith('#'):
            return "# æ³¨é‡Šæˆ–ç©ºè¡Œ"
        
        try:
            # å°è¯•ä½œä¸ºè¡¨è¾¾å¼æ‰§è¡Œ
            if '=' not in line:
                result = eval(line, {'__builtins__': {}}, self.variables)
                return f"ç»“æœï¼š{result}"
            else:
                # ä½œä¸ºèµ‹å€¼è¯­å¥æ‰§è¡Œ
                exec(line, {'__builtins__': {}}, self.variables)
                return "æ‰§è¡ŒæˆåŠŸ"
        except Exception as e:
            return f"é”™è¯¯ï¼š{e}"
    
    def show_variables(self):
        """æ˜¾ç¤ºå½“å‰å˜é‡"""
        if self.variables:
            return "å½“å‰å˜é‡ï¼š" + str(self.variables)
        else:
            return "æš‚æ— å˜é‡"

# ä½¿ç”¨ç¤ºä¾‹
interpreter = SimpleInterpreter()

# æ‰§è¡Œä¸€äº›ä»£ç 
codes = [
    "x = 10",
    "y = 20", 
    "z = x + y",
    "z * 2",
    "name = 'Python'",
    "f'Hello, {name}!'"
]

for code in codes:
    result = interpreter.execute_line(code)
    print(f">>> {code}")
    print(f"    {result}")

print("\n" + interpreter.show_variables())
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ eval()ï¼šæ‰§è¡Œè¡¨è¾¾å¼ï¼Œè¿”å›è®¡ç®—ç»“æœ
ğŸ”¸ exec()ï¼šæ‰§è¡Œè¯­å¥å—ï¼Œç”¨äºå¤æ‚é€»è¾‘
ğŸ”¸ compile()ï¼šç¼–è¯‘ä»£ç ï¼Œæå‡é‡å¤æ‰§è¡Œæ€§èƒ½
ğŸ”¸ å®‰å…¨æ€§ï¼šå¿…é¡»è€ƒè™‘ä»£ç æ³¨å…¥ç­‰å®‰å…¨é£é™©
ğŸ”¸ ä½œç”¨åŸŸï¼šç†è§£å…¨å±€å’Œå±€éƒ¨å˜é‡çš„æ§åˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é€‰æ‹©åˆé€‚çš„å‡½æ•°**
```
éœ€è¦è®¡ç®—ç»“æœ â†’ ä½¿ç”¨eval()
éœ€è¦æ‰§è¡Œä»£ç  â†’ ä½¿ç”¨exec()  
éœ€è¦é‡å¤æ‰§è¡Œ â†’ å…ˆç”¨compile()å†é…åˆeval()æˆ–exec()
```

**ğŸ”¹ å®‰å…¨ç¬¬ä¸€åŸåˆ™**
```
æ°¸è¿œä¸è¦ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„ä»£ç 
ä½¿ç”¨å—é™çš„æ‰§è¡Œç¯å¢ƒ
éªŒè¯å’Œè¿‡æ»¤è¾“å…¥å†…å®¹
è€ƒè™‘ä½¿ç”¨æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–æ€è·¯**
```
é‡å¤æ‰§è¡Œçš„ä»£ç  â†’ ä½¿ç”¨compile()é¢„ç¼–è¯‘
ä¸€æ¬¡æ€§æ‰§è¡Œ â†’ ç›´æ¥ä½¿ç”¨eval()æˆ–exec()
å¤§é‡è®¡ç®— â†’ è€ƒè™‘ä½¿ç”¨ä¸“é—¨çš„æ•°å­¦åº“
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


- **åŠ¨æ€è®¡ç®—**ï¼šæ„å»ºè®¡ç®—å™¨ã€è¡¨è¾¾å¼æ±‚å€¼å™¨
- **é…ç½®ç®¡ç†**ï¼šåŠ¨æ€åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶
- **ä»£ç ç”Ÿæˆ**ï¼šæ ¹æ®æ¨¡æ¿åŠ¨æ€ç”Ÿæˆå’Œæ‰§è¡Œä»£ç 
- **è„šæœ¬è§£é‡Š**ï¼šæ„å»ºç®€å•çš„è„šæœ¬è§£é‡Šå™¨
- **æ•°æ®å¤„ç†**ï¼šåŠ¨æ€å¤„ç†å¤æ‚çš„æ•°æ®è½¬æ¢é€»è¾‘

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ¯ ç»ƒä¹ é‡ç‚¹**ï¼š
1. ä»ç®€å•çš„æ•°å­¦è¡¨è¾¾å¼å¼€å§‹ç»ƒä¹ eval()
2. å°è¯•ç”¨exec()æ‰§è¡Œç®€å•çš„è¯­å¥å—
3. ç†è§£compile()çš„æ€§èƒ½ä¼˜åŒ–ä½œç”¨
4. **é‡ç‚¹å­¦ä¹ å®‰å…¨é˜²æŠ¤æªæ–½**

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- åœ¨å­¦ä¹ é˜¶æ®µå¯ä»¥è‡ªç”±å®éªŒï¼Œä½†è¦ç†è§£å®‰å…¨é£é™©
- ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶å¿…é¡»åŠ å¼ºå®‰å…¨é˜²æŠ¤
- ä¼˜å…ˆè€ƒè™‘æ›´å®‰å…¨çš„æ›¿ä»£æ–¹æ¡ˆ
- å§‹ç»ˆéªŒè¯å’Œè¿‡æ»¤å¤–éƒ¨è¾“å…¥

**æ ¸å¿ƒè®°å¿†**ï¼š
- evalæ±‚å€¼ç®—è¡¨è¾¾ï¼Œexecæ‰§è¡Œè·‘è¯­å¥
- compileç¼–è¯‘ä¸ºä¼˜åŒ–ï¼Œå®‰å…¨é˜²æŠ¤è¦è®°ç‰¢
- åŠ¨æ€æ‰§è¡Œå¾ˆå¼ºå¤§ï¼Œè°¨æ…ä½¿ç”¨ä¿å®‰å…¨