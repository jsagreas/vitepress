---
title: 16ã€æ¨¡å—å¯¼å…¥å‡½æ•°
---
## ğŸ“š ç›®å½•

1. [æ¨¡å—å¯¼å…¥å‡½æ•°æ¦‚è¿°](#1-æ¨¡å—å¯¼å…¥å‡½æ•°æ¦‚è¿°)
2. [__import__()åŠ¨æ€å¯¼å…¥](#2-__import__åŠ¨æ€å¯¼å…¥)
3. [globals()å…¨å±€å˜é‡å­—å…¸](#3-globalså…¨å±€å˜é‡å­—å…¸)
4. [locals()å±€éƒ¨å˜é‡å­—å…¸](#4-localså±€éƒ¨å˜é‡å­—å…¸)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ¨¡å—å¯¼å…¥å‡½æ•°æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ¨¡å—å¯¼å…¥å‡½æ•°


**ç®€å•ç†è§£**ï¼šæ¨¡å—å¯¼å…¥å‡½æ•°å°±æ˜¯Pythonç”¨æ¥ç®¡ç†ä»£ç æ¨¡å—å’Œå˜é‡çš„å·¥å…·å‡½æ•°ã€‚

```
æƒ³è±¡ä¸€ä¸‹ï¼š
ä½ çš„Pythonç¨‹åº = ä¸€ä¸ªå¤§æˆ¿å­
æ¨¡å— = æˆ¿å­é‡Œçš„ä¸åŒæˆ¿é—´
å˜é‡ = æˆ¿é—´é‡Œçš„å®¶å…·

æ¨¡å—å¯¼å…¥å‡½æ•°å°±æ˜¯ï¼š
- é’¥åŒ™ï¼šèƒ½æ‰“å¼€ä¸åŒæˆ¿é—´ï¼ˆå¯¼å…¥æ¨¡å—ï¼‰
- æ¸…å•ï¼šèƒ½åˆ—å‡ºæˆ¿é—´é‡Œæœ‰ä»€ä¹ˆå®¶å…·ï¼ˆæŸ¥çœ‹å˜é‡ï¼‰
```

### 1.2 æ ¸å¿ƒä¸‰å¤§å‡½æ•°


| å‡½æ•°å | **ä½œç”¨** | **é€šä¿—ç†è§£** |
|--------|----------|-------------|
| `__import__()` | åŠ¨æ€å¯¼å…¥æ¨¡å— | ç”¨ä»£ç çš„æ–¹å¼"å¼€é—¨è¿›å…¥æˆ¿é—´" |
| `globals()` | è·å–å…¨å±€å˜é‡ | æŸ¥çœ‹"æ•´ä¸ªæˆ¿å­"çš„ç‰©å“æ¸…å• |
| `locals()` | è·å–å±€éƒ¨å˜é‡ | æŸ¥çœ‹"å½“å‰æˆ¿é—´"çš„ç‰©å“æ¸…å• |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›å‡½æ•°


**æ™®é€šå¯¼å…¥ vs åŠ¨æ€å¯¼å…¥**ï¼š
```python
# æ™®é€šå¯¼å…¥ï¼ˆé™æ€ï¼‰- åƒæå‰å®‰æ’å¥½è·¯çº¿
import math
import json

# åŠ¨æ€å¯¼å…¥ - åƒæ ¹æ®éœ€è¦ä¸´æ—¶å†³å®šå»å“ªä¸ªæˆ¿é—´
module_name = "math"  # æ ¹æ®ç”¨æˆ·è¾“å…¥å†³å®š
module = __import__(module_name)  # åŠ¨æ€å¯¼å…¥
```

**å…¨å±€ vs å±€éƒ¨å˜é‡ç®¡ç†**ï¼š
```
å…¨å±€å˜é‡ = æ•´ä¸ªæˆ¿å­å…±äº«çš„ç‰©å“ï¼ˆå®¢å…çš„ç”µè§†ï¼‰
å±€éƒ¨å˜é‡ = æŸä¸ªæˆ¿é—´ç§æœ‰çš„ç‰©å“ï¼ˆå§å®¤çš„åºŠï¼‰

æœ‰æ—¶éœ€è¦æŸ¥çœ‹æˆ–ç®¡ç†è¿™äº›"ç‰©å“æ¸…å•"
```

---

## 2. ğŸ”§ __import__()åŠ¨æ€å¯¼å…¥


### 2.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ä»€ä¹ˆæ˜¯åŠ¨æ€å¯¼å…¥**ï¼Ÿ
- **é™æ€å¯¼å…¥**ï¼šå†™ä»£ç æ—¶å°±ç¡®å®šè¦å¯¼å…¥ä»€ä¹ˆæ¨¡å—
- **åŠ¨æ€å¯¼å…¥**ï¼šç¨‹åºè¿è¡Œæ—¶æ‰å†³å®šå¯¼å…¥ä»€ä¹ˆæ¨¡å—

```python
# é™æ€å¯¼å…¥ - å›ºå®šä¸å˜
import math

# åŠ¨æ€å¯¼å…¥ - çµæ´»å˜åŒ–
module_name = input("è¯·è¾“å…¥æ¨¡å—åï¼š")  # ç”¨æˆ·è¾“å…¥"math"
module = __import__(module_name)      # åŠ¨æ€å¯¼å…¥mathæ¨¡å—
```

### 2.2 è¯­æ³•æ ¼å¼


**åŸºç¡€è¯­æ³•**ï¼š
```python
__import__(name, globals=None, locals=None, fromlist=(), level=0)
```

**å‚æ•°è¯´æ˜**ï¼š
- `name`ï¼šğŸ¯ æ¨¡å—åï¼ˆå­—ç¬¦ä¸²ï¼‰
- `globals`ï¼šğŸ“‹ å…¨å±€å˜é‡å­—å…¸ï¼ˆä¸€èˆ¬ç”¨é»˜è®¤å€¼ï¼‰
- `locals`ï¼šğŸ“‹ å±€éƒ¨å˜é‡å­—å…¸ï¼ˆä¸€èˆ¬ç”¨é»˜è®¤å€¼ï¼‰
- `fromlist`ï¼šğŸ“¦ æŒ‡å®šå¯¼å…¥çš„éƒ¨åˆ†ï¼ˆç±»ä¼¼from...importï¼‰
- `level`ï¼šğŸ”¢ ç›¸å¯¹å¯¼å…¥çº§åˆ«ï¼ˆ0è¡¨ç¤ºç»å¯¹å¯¼å…¥ï¼‰

### 2.3 å®é™…ä½¿ç”¨ç¤ºä¾‹


**ğŸŸ¢å…¥é—¨çº§ï¼šç®€å•åŠ¨æ€å¯¼å…¥**
```python
# æ ¹æ®ç”¨æˆ·éœ€æ±‚åŠ¨æ€å¯¼å…¥ä¸åŒæ¨¡å—
def smart_calculator():
    operation = input("é€‰æ‹©æ“ä½œ(math/random/datetime): ")
    
    try:
        # åŠ¨æ€å¯¼å…¥ç”¨æˆ·é€‰æ‹©çš„æ¨¡å—
        module = __import__(operation)
        print(f"æˆåŠŸå¯¼å…¥ {operation} æ¨¡å—")
        
        if operation == "math":
            print("Ï€çš„å€¼:", module.pi)
        elif operation == "random":
            print("éšæœºæ•°:", module.randint(1, 10))
        elif operation == "datetime":
            print("å½“å‰æ—¶é—´:", module.datetime.now())
            
    except ImportError:
        print("æ¨¡å—ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥è¾“å…¥")

smart_calculator()
```

**ğŸŸ¡è¿›é˜¶çº§ï¼šå¯¼å…¥åŒ…ä¸­çš„æ¨¡å—**
```python
# å¯¼å…¥åŒ…ä¸­çš„ç‰¹å®šæ¨¡å—
def import_from_package():
    # ç›¸å½“äºï¼šfrom os import path
    path_module = __import__('os.path', fromlist=['path'])
    print("å½“å‰ç›®å½•:", path_module.dirname(__file__))
    
    # ç›¸å½“äºï¼šfrom json import dumps, loads  
    json_funcs = __import__('json', fromlist=['dumps', 'loads'])
    data = {"name": "å¼ ä¸‰", "age": 25}
    json_str = json_funcs.dumps(data)
    print("JSONå­—ç¬¦ä¸²:", json_str)

import_from_package()
```

### 2.4 å¸¸è§åº”ç”¨åœºæ™¯


**æ’ä»¶ç³»ç»Ÿ**ï¼š
```python
# åŠ¨æ€åŠ è½½æ’ä»¶çš„ç®€å•ç¤ºä¾‹
def load_plugin(plugin_name):
    """åŠ¨æ€åŠ è½½æ’ä»¶åŠŸèƒ½"""
    try:
        # å‡è®¾æ’ä»¶æ”¾åœ¨pluginsæ–‡ä»¶å¤¹ä¸‹
        plugin = __import__(f'plugins.{plugin_name}', fromlist=[plugin_name])
        return plugin
    except ImportError:
        print(f"æ’ä»¶ {plugin_name} ä¸å­˜åœ¨")
        return None

# ä½¿ç”¨ç¤ºä¾‹
payment_plugin = load_plugin('payment')  # åŠ è½½æ”¯ä»˜æ’ä»¶
if payment_plugin:
    payment_plugin.process_payment(100)   # è°ƒç”¨æ’ä»¶åŠŸèƒ½
```

### 2.5 æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ


**âš ï¸ å®‰å…¨è€ƒè™‘**ï¼š
```python
# å±é™©åšæ³• - ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥
user_input = input("è¾“å…¥æ¨¡å—åï¼š")
module = __import__(user_input)  # å¯èƒ½å¯¼å…¥æ¶æ„æ¨¡å—

# å®‰å…¨åšæ³• - éªŒè¯æ¨¡å—å
ALLOWED_MODULES = ['math', 'random', 'datetime', 'json']

def safe_import(module_name):
    if module_name in ALLOWED_MODULES:
        return __import__(module_name)
    else:
        raise ValueError(f"ä¸å…è®¸å¯¼å…¥æ¨¡å—: {module_name}")
```

**ğŸ’¡ ç°ä»£æ›¿ä»£æ–¹æ¡ˆ**ï¼š
```python
# æ¨èä½¿ç”¨importlibï¼ˆPython 3.1+ï¼‰
import importlib

def modern_import(module_name):
    """ä½¿ç”¨ç°ä»£æ–¹å¼åŠ¨æ€å¯¼å…¥"""
    try:
        module = importlib.import_module(module_name)
        return module
    except ImportError:
        print(f"æ— æ³•å¯¼å…¥æ¨¡å—: {module_name}")
        return None

# æ›´æ¸…æ™°ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§
math_module = modern_import('math')
```

---

## 3. ğŸŒ globals()å…¨å±€å˜é‡å­—å…¸


### 3.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ä»€ä¹ˆæ˜¯å…¨å±€å˜é‡å­—å…¸**ï¼Ÿ
```
æƒ³è±¡Pythonç¨‹åºæ˜¯ä¸€æ ‹æˆ¿å­ï¼š
- å…¨å±€å˜é‡ = å®¢å…é‡Œçš„ç‰©å“ï¼ˆæ‰€æœ‰æˆ¿é—´éƒ½èƒ½è®¿é—®ï¼‰
- globals() = å®¢å…ç‰©å“çš„è¯¦ç»†æ¸…å•

è¿™ä¸ªæ¸…å•å‘Šè¯‰ä½ ï¼š
- æœ‰å“ªäº›ç‰©å“ï¼ˆå˜é‡åï¼‰
- æ¯ä¸ªç‰©å“æ˜¯ä»€ä¹ˆï¼ˆå˜é‡å€¼ï¼‰
```

### 3.2 åŸºç¡€ä½¿ç”¨


**æŸ¥çœ‹å…¨å±€å˜é‡**ï¼š
```python
# å®šä¹‰ä¸€äº›å…¨å±€å˜é‡
name = "å°æ˜"
age = 25
city = "åŒ—äº¬"

def show_globals():
    """æŸ¥çœ‹å½“å‰å…¨å±€å˜é‡"""
    global_vars = globals()
    
    print("ğŸ” å…¨å±€å˜é‡æ¸…å•:")
    for key, value in global_vars.items():
        # è¿‡æ»¤æ‰Pythonå†…ç½®çš„å˜é‡ï¼ˆä»¥__å¼€å¤´çš„ï¼‰
        if not key.startswith('__'):
            print(f"  {key}: {value} ({type(value).__name__})")

show_globals()
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ” å…¨å±€å˜é‡æ¸…å•:
  name: å°æ˜ (str)
  age: 25 (int) 
  city: åŒ—äº¬ (str)
  show_globals: <function show_globals at 0x...> (function)
```

### 3.3 åŠ¨æ€æ“ä½œå…¨å±€å˜é‡


**ğŸ”§ è¯»å–å’Œä¿®æ”¹å…¨å±€å˜é‡**ï¼š
```python
# åˆå§‹å˜é‡
score = 100
level = 1

def game_manager():
    """æ¸¸æˆç®¡ç†å™¨ - åŠ¨æ€ç®¡ç†æ¸¸æˆå˜é‡"""
    g = globals()  # è·å–å…¨å±€å˜é‡å­—å…¸
    
    # è¯»å–å˜é‡
    print(f"å½“å‰åˆ†æ•°: {g['score']}")
    print(f"å½“å‰ç­‰çº§: {g['level']}")
    
    # åŠ¨æ€ä¿®æ”¹å˜é‡
    g['score'] += 50        # åŠ åˆ†
    g['level'] = 2          # å‡çº§
    g['player_name'] = "ç©å®¶1"  # æ–°å¢å˜é‡
    
    print(f"æ–°åˆ†æ•°: {g['score']}")
    print(f"æ–°ç­‰çº§: {g['level']}")
    print(f"ç©å®¶å§“å: {g['player_name']}")

game_manager()
print(f"å‡½æ•°å¤–è®¿é—®: score={score}, level={level}")
```

### 3.4 å®é™…åº”ç”¨åœºæ™¯


**é…ç½®ç®¡ç†ç³»ç»Ÿ**ï¼š
```python
# åº”ç”¨é…ç½®
DEBUG = True
DATABASE_URL = "localhost:5432"
API_KEY = "secret123"

def get_config(key, default=None):
    """è·å–é…ç½®é¡¹"""
    return globals().get(key, default)

def set_config(key, value):
    """è®¾ç½®é…ç½®é¡¹"""
    globals()[key] = value
    print(f"é…ç½®å·²æ›´æ–°: {key} = {value}")

def show_all_config():
    """æ˜¾ç¤ºæ‰€æœ‰é…ç½®"""
    print("ğŸ“‹ å½“å‰é…ç½®:")
    g = globals()
    for key, value in g.items():
        if key.isupper():  # çº¦å®šé…ç½®é¡¹ç”¨å¤§å†™
            print(f"  {key}: {value}")

# ä½¿ç”¨ç¤ºä¾‹
print("DEBUGæ¨¡å¼:", get_config('DEBUG'))
set_config('MAX_CONNECTIONS', 100)
show_all_config()
```

### 3.5 ä¸exec()ç»“åˆä½¿ç”¨


**åŠ¨æ€æ‰§è¡Œä»£ç **ï¼š
```python
def code_executor():
    """å®‰å…¨çš„ä»£ç æ‰§è¡Œå™¨"""
    # åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„å…¨å±€ç¯å¢ƒ
    safe_globals = {
        '__builtins__': {},  # ç§»é™¤å±é™©çš„å†…ç½®å‡½æ•°
        'print': print,      # åªä¿ç•™å®‰å…¨çš„å‡½æ•°
        'len': len,
        'str': str,
        'int': int
    }
    
    user_code = input("è¾“å…¥Pythonä»£ç : ")
    
    try:
        # åœ¨å—é™ç¯å¢ƒä¸­æ‰§è¡Œä»£ç 
        exec(user_code, safe_globals)
        print("æ‰§è¡Œåçš„å˜é‡:", safe_globals)
    except Exception as e:
        print(f"æ‰§è¡Œé”™è¯¯: {e}")

# ç¤ºä¾‹è¾“å…¥: x = 10; y = 20; print(x + y)
code_executor()
```

---

## 4. ğŸ  locals()å±€éƒ¨å˜é‡å­—å…¸


### 4.1 åŸºæœ¬æ¦‚å¿µç†è§£


**å±€éƒ¨å˜é‡ vs å…¨å±€å˜é‡**ï¼š
```
å…¨å±€å˜é‡ = å®¢å…çš„ç”µè§†ï¼ˆæ•´ä¸ªæˆ¿å­éƒ½èƒ½çœ‹ï¼‰
å±€éƒ¨å˜é‡ = å§å®¤çš„åºŠï¼ˆåªæœ‰åœ¨å§å®¤æ‰èƒ½ç”¨ï¼‰

locals() = æŸ¥çœ‹å½“å‰æˆ¿é—´çš„ç‰©å“æ¸…å•
```

### 4.2 å‡½æ•°å†…çš„å±€éƒ¨å˜é‡


**åŸºç¡€ç¤ºä¾‹**ï¼š
```python
def student_info():
    """å­¦ç”Ÿä¿¡æ¯å¤„ç†å‡½æ•°"""
    # å±€éƒ¨å˜é‡
    name = "æå"
    age = 20
    subjects = ["æ•°å­¦", "è‹±è¯­", "Python"]
    
    print("ğŸ“ å‡½æ•°å†…å±€éƒ¨å˜é‡:")
    local_vars = locals()
    for key, value in local_vars.items():
        print(f"  {key}: {value}")
    
    return local_vars

result = student_info()
print("\nå‡½æ•°è¿”å›çš„å±€éƒ¨å˜é‡å­—å…¸:")
print(result)
```

### 4.3 locals() vs globals()å¯¹æ¯”


**åŒä¸€å‡½æ•°ä¸­çš„å¯¹æ¯”**ï¼š
```python
# å…¨å±€å˜é‡
global_name = "å…¨å±€å°æ˜"
global_age = 30

def compare_scopes():
    """å¯¹æ¯”å…¨å±€å’Œå±€éƒ¨ä½œç”¨åŸŸ"""
    # å±€éƒ¨å˜é‡ï¼ˆä¸å…¨å±€å˜é‡åŒåï¼‰
    local_name = "å±€éƒ¨å°çº¢"
    local_age = 25
    
    print("ğŸŒ å…¨å±€å˜é‡:")
    for key, value in globals().items():
        if not key.startswith('__') and 'global' in key:
            print(f"  {key}: {value}")
    
    print("\nğŸ  å±€éƒ¨å˜é‡:")
    for key, value in locals().items():
        if 'local' in key:
            print(f"  {key}: {value}")
    
    # æ˜¾ç¤ºå˜é‡æŸ¥æ‰¾é¡ºåº
    print(f"\nå˜é‡æŸ¥æ‰¾é¡ºåºæ¼”ç¤º:")
    print(f"å±€éƒ¨name: {local_name}")    # ä¼˜å…ˆä½¿ç”¨å±€éƒ¨å˜é‡
    print(f"å…¨å±€name: {global_name}")   # æ˜ç¡®æŒ‡å®šå…¨å±€å˜é‡

compare_scopes()
```

### 4.4 ä¿®æ”¹å±€éƒ¨å˜é‡çš„é™åˆ¶


**âš ï¸ é‡è¦æé†’**ï¼š
```python
def test_locals_modification():
    """æµ‹è¯•ä¿®æ”¹locals()çš„æ•ˆæœ"""
    x = 10
    y = 20
    
    print("ä¿®æ”¹å‰:", locals())
    
    # å°è¯•é€šè¿‡locals()ä¿®æ”¹å˜é‡
    locals()['x'] = 999
    locals()['z'] = 300  # å°è¯•æ–°å¢å˜é‡
    
    print("ä¿®æ”¹å:", locals())
    print(f"å®é™…xçš„å€¼: {x}")  # xä»ç„¶æ˜¯10ï¼Œä¿®æ”¹æ— æ•ˆï¼
    
    # æ­£ç¡®çš„ä¿®æ”¹æ–¹å¼
    x = 999  # ç›´æ¥èµ‹å€¼æ‰æœ‰æ•ˆ
    print(f"æ­£ç¡®ä¿®æ”¹åx: {x}")

test_locals_modification()
```

**è§£é‡Šè¯´æ˜**ï¼š
```
ä¸ºä»€ä¹ˆä¿®æ”¹locals()æ— æ•ˆï¼Ÿ

locals()è¿”å›çš„æ˜¯å±€éƒ¨å˜é‡çš„"å‰¯æœ¬"ï¼ˆå¿«ç…§ï¼‰
ä¿®æ”¹è¿™ä¸ªå‰¯æœ¬ä¸ä¼šå½±å“çœŸæ­£çš„å±€éƒ¨å˜é‡

è¿™å°±åƒï¼š
- ä½ æ‹äº†æˆ¿é—´çš„ç…§ç‰‡ï¼ˆlocals()ï¼‰
- åœ¨ç…§ç‰‡ä¸Šç”»ç”»ï¼ˆä¿®æ”¹å­—å…¸ï¼‰
- ä½†æˆ¿é—´é‡Œçš„ä¸œè¥¿æ²¡æœ‰å˜åŒ–ï¼ˆå±€éƒ¨å˜é‡ä¸å˜ï¼‰
```

### 4.5 å®é™…åº”ç”¨åœºæ™¯


**è°ƒè¯•å’Œæ—¥å¿—è®°å½•**ï¼š
```python
def order_processor(order_id, customer_name, items, total_amount):
    """è®¢å•å¤„ç†å‡½æ•°"""
    # å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸´æ—¶å˜é‡
    processing_fee = total_amount * 0.02
    final_amount = total_amount + processing_fee
    status = "å¤„ç†ä¸­"
    
    # è®°å½•å‡½æ•°è°ƒç”¨çš„æ‰€æœ‰å‚æ•°å’Œå±€éƒ¨å˜é‡
    def log_function_state():
        print("ğŸ“Š å‡½æ•°æ‰§è¡ŒçŠ¶æ€:")
        local_state = locals()
        for key, value in local_state.items():
            if not key.startswith('_'):  # è¿‡æ»¤å†…éƒ¨å˜é‡
                print(f"  {key}: {value}")
    
    log_function_state()
    
    # æ¨¡æ‹Ÿå¤„ç†é€»è¾‘
    if total_amount > 1000:
        status = "éœ€è¦å®¡æ ¸"
    else:
        status = "å·²ç¡®è®¤"
    
    return {
        "order_id": order_id,
        "final_amount": final_amount,
        "status": status
    }

# ä½¿ç”¨ç¤ºä¾‹
result = order_processor("ORD001", "å¼ ä¸‰", ["å•†å“A", "å•†å“B"], 1200)
print(f"\nå¤„ç†ç»“æœ: {result}")
```

**æ¨¡æ¿å­—ç¬¦ä¸²æ¸²æŸ“**ï¼š
```python
def render_template(template, **kwargs):
    """ç®€å•çš„æ¨¡æ¿æ¸²æŸ“å™¨"""
    # å°†ä¼ å…¥çš„å‚æ•°æ·»åŠ åˆ°å±€éƒ¨ä½œç”¨åŸŸ
    for key, value in kwargs.items():
        locals()[key] = value
    
    # ä½¿ç”¨locals()ä½œä¸ºæ¨¡æ¿å˜é‡æº
    try:
        return template.format(**locals())
    except KeyError as e:
        return f"æ¨¡æ¿é”™è¯¯: ç¼ºå°‘å˜é‡ {e}"

# ä½¿ç”¨ç¤ºä¾‹
template = "æ¬¢è¿ {name}ï¼Œæ‚¨çš„å¹´é¾„æ˜¯ {age}ï¼Œæ¥è‡ª {city}"
result = render_template(template, name="å°ç‹", age=28, city="ä¸Šæµ·")
print(result)
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 5.1 é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½


**æ™ºèƒ½é…ç½®ç³»ç»Ÿ**ï¼š
```python
def load_config_from_file(config_file):
    """ä»æ–‡ä»¶åŠ¨æ€åŠ è½½é…ç½®"""
    import json
    
    try:
        with open(config_file, 'r', encoding='utf-8') as f:
            config_data = json.load(f)
        
        # å°†é…ç½®é¡¹æ·»åŠ åˆ°å…¨å±€å˜é‡
        g = globals()
        for key, value in config_data.items():
            g[f"CONFIG_{key.upper()}"] = value
            print(f"âœ… åŠ è½½é…ç½®: {key} = {value}")
            
    except FileNotFoundError:
        print(f"âŒ é…ç½®æ–‡ä»¶ {config_file} ä¸å­˜åœ¨")

def get_current_config():
    """è·å–å½“å‰æ‰€æœ‰é…ç½®"""
    print("ğŸ“‹ å½“å‰é…ç½®åˆ—è¡¨:")
    for key, value in globals().items():
        if key.startswith('CONFIG_'):
            config_name = key.replace('CONFIG_', '').lower()
            print(f"  {config_name}: {value}")

# ç¤ºä¾‹é…ç½®æ–‡ä»¶å†…å®¹ (app_config.json):
# {"database_host": "localhost", "debug_mode": true, "max_users": 1000}

# load_config_from_file('app_config.json')
# get_current_config()
```

### 5.2 æ’ä»¶æ¶æ„å®ç°


**ç®€å•æ’ä»¶ç³»ç»Ÿ**ï¼š
```python
class PluginManager:
    """æ’ä»¶ç®¡ç†å™¨"""
    
    def __init__(self):
        self.plugins = {}
    
    def load_plugin(self, plugin_name):
        """åŠ¨æ€åŠ è½½æ’ä»¶"""
        try:
            # åŠ¨æ€å¯¼å…¥æ’ä»¶æ¨¡å—
            plugin_module = __import__(f'plugins.{plugin_name}', 
                                     fromlist=[plugin_name])
            
            # æ£€æŸ¥æ’ä»¶æ˜¯å¦æœ‰å¿…éœ€çš„æ¥å£
            if hasattr(plugin_module, 'plugin_info') and \
               hasattr(plugin_module, 'execute'):
                
                self.plugins[plugin_name] = plugin_module
                print(f"âœ… æ’ä»¶ {plugin_name} åŠ è½½æˆåŠŸ")
                return True
            else:
                print(f"âŒ æ’ä»¶ {plugin_name} ç¼ºå°‘å¿…éœ€æ¥å£")
                return False
                
        except ImportError:
            print(f"âŒ æ’ä»¶ {plugin_name} ä¸å­˜åœ¨")
            return False
    
    def execute_plugin(self, plugin_name, *args, **kwargs):
        """æ‰§è¡Œæ’ä»¶åŠŸèƒ½"""
        if plugin_name in self.plugins:
            return self.plugins[plugin_name].execute(*args, **kwargs)
        else:
            print(f"âŒ æ’ä»¶ {plugin_name} æœªåŠ è½½")
    
    def list_plugins(self):
        """åˆ—å‡ºå·²åŠ è½½çš„æ’ä»¶"""
        print("ğŸ“¦ å·²åŠ è½½æ’ä»¶:")
        for name, plugin in self.plugins.items():
            info = plugin.plugin_info()
            print(f"  {name}: {info.get('description', 'æ— æè¿°')}")

# ä½¿ç”¨ç¤ºä¾‹
manager = PluginManager()
manager.load_plugin('calculator')
manager.load_plugin('text_processor')
manager.list_plugins()
```

### 5.3 åŠ¨æ€å‡½æ•°è°ƒç”¨


**åŸºäºå­—ç¬¦ä¸²çš„å‡½æ•°è°ƒç”¨**ï¼š
```python
def dynamic_calculator():
    """åŠ¨æ€è®¡ç®—å™¨ - æ ¹æ®ç”¨æˆ·è¾“å…¥è°ƒç”¨ä¸åŒå‡½æ•°"""
    
    # å®šä¹‰å¯ç”¨çš„è®¡ç®—å‡½æ•°
    def add(a, b):
        return a + b
    
    def subtract(a, b):
        return a - b
    
    def multiply(a, b):
        return a * b
    
    def divide(a, b):
        return a / b if b != 0 else "é™¤æ•°ä¸èƒ½ä¸º0"
    
    # è·å–å½“å‰å±€éƒ¨ä½œç”¨åŸŸä¸­çš„å‡½æ•°
    available_functions = {}
    for name, obj in locals().items():
        if callable(obj) and not name.startswith('_'):
            available_functions[name] = obj
    
    print("ğŸ“Š å¯ç”¨æ“ä½œ:", list(available_functions.keys()))
    
    while True:
        try:
            operation = input("é€‰æ‹©æ“ä½œ (æˆ–è¾“å…¥'quit'é€€å‡º): ")
            if operation == 'quit':
                break
                
            if operation in available_functions:
                a = float(input("è¾“å…¥ç¬¬ä¸€ä¸ªæ•°: "))
                b = float(input("è¾“å…¥ç¬¬äºŒä¸ªæ•°: "))
                
                # åŠ¨æ€è°ƒç”¨å‡½æ•°
                result = available_functions[operation](a, b)
                print(f"ç»“æœ: {a} {operation} {b} = {result}")
            else:
                print("âŒ æ“ä½œä¸å­˜åœ¨")
                
        except ValueError:
            print("âŒ è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—")
        except Exception as e:
            print(f"âŒ é”™è¯¯: {e}")

# dynamic_calculator()
```

### 5.4 è°ƒè¯•å’Œæ€§èƒ½ç›‘æ§


**å‡½æ•°æ‰§è¡Œç›‘æ§å™¨**ï¼š
```python
import time
import functools

def monitor_function(func):
    """å‡½æ•°ç›‘æ§è£…é¥°å™¨"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        # è®°å½•å‡½æ•°è°ƒç”¨ä¿¡æ¯
        start_time = time.time()
        
        print(f"ğŸ” è°ƒç”¨å‡½æ•°: {func.__name__}")
        print(f"ğŸ“¥ å‚æ•°: args={args}, kwargs={kwargs}")
        
        # æ‰§è¡Œå‡½æ•°
        try:
            result = func(*args, **kwargs)
            execution_time = time.time() - start_time
            
            print(f"âœ… æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: {execution_time:.4f}ç§’")
            print(f"ğŸ“¤ è¿”å›å€¼: {result}")
            
            # å¦‚æœå‡½æ•°æœ‰å±€éƒ¨å˜é‡ï¼Œå¯ä»¥è¿›ä¸€æ­¥åˆ†æ
            # æ³¨æ„ï¼šè¿™åœ¨è£…é¥°å™¨ä¸­æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤ºæ¦‚å¿µ
            
            return result
            
        except Exception as e:
            execution_time = time.time() - start_time
            print(f"âŒ æ‰§è¡Œå¤±è´¥ï¼Œè€—æ—¶: {execution_time:.4f}ç§’")
            print(f"ğŸ’¥ é”™è¯¯: {e}")
            raise
    
    return wrapper

# ä½¿ç”¨ç¤ºä¾‹
@monitor_function
def complex_calculation(n):
    """å¤æ‚è®¡ç®—ç¤ºä¾‹"""
    total = 0
    for i in range(n):
        total += i ** 2
    return total

# result = complex_calculation(1000)
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ __import__(): ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€å¯¼å…¥æ¨¡å—çš„å·¥å…·
ğŸ”¸ globals(): è·å–å’Œç®¡ç†å…¨å±€å˜é‡çš„å­—å…¸å·¥å…·  
ğŸ”¸ locals(): è·å–å½“å‰å‡½æ•°å±€éƒ¨å˜é‡çš„å­—å…¸å·¥å…·
ğŸ”¸ ä½œç”¨åŸŸ: å˜é‡çš„å¯è§èŒƒå›´ï¼ˆå…¨å±€ vs å±€éƒ¨ï¼‰
ğŸ”¸ åŠ¨æ€æ€§: è¿è¡Œæ—¶å†³å®šè¡Œä¸ºï¼Œè€Œéç¼–å†™æ—¶å›ºå®š
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€å¯¼å…¥**ï¼š
```
é™æ€å¯¼å…¥ = æå‰å®‰æ’å¥½çš„è·¯çº¿ï¼ˆå›ºå®šï¼‰
åŠ¨æ€å¯¼å…¥ = æ ¹æ®éœ€è¦ä¸´æ—¶å†³å®šè·¯çº¿ï¼ˆçµæ´»ï¼‰

åº”ç”¨åœºæ™¯ï¼š
- æ’ä»¶ç³»ç»Ÿï¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚åŠ è½½ä¸åŒåŠŸèƒ½
- é…ç½®ç³»ç»Ÿï¼šæ ¹æ®ç¯å¢ƒåŠ è½½ä¸åŒæ¨¡å—  
- å·¥å…·åº“ï¼šæŒ‰éœ€å¯¼å…¥å‡å°‘å†…å­˜å ç”¨
```

**ğŸ”¹ å…¨å±€å˜é‡ vs å±€éƒ¨å˜é‡**ï¼š
```
å…¨å±€å˜é‡ = å®¢å…çš„ç‰©å“ï¼ˆæ•´ä¸ªç¨‹åºå…±äº«ï¼‰
å±€éƒ¨å˜é‡ = å§å®¤çš„ç‰©å“ï¼ˆå‡½æ•°å†…ç§æœ‰ï¼‰

è®°å¿†è¦ç‚¹ï¼š
- globals()å¯è¯»å¯å†™ï¼Œä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
- locals()åªå¯è¯»ï¼Œä¿®æ”¹æ— æ•ˆï¼ˆå‡½æ•°å†…ï¼‰
- å˜é‡æŸ¥æ‰¾é¡ºåºï¼šå±€éƒ¨ â†’ å…¨å±€ â†’ å†…ç½®
```

**ğŸ”¹ å®‰å…¨æ€§è€ƒè™‘**ï¼š
```
åŠ¨æ€å¯¼å…¥çš„é£é™©ï¼š
- å¯èƒ½å¯¼å…¥æ¶æ„ä»£ç 
- éš¾ä»¥è¿›è¡Œé™æ€åˆ†æ
- è°ƒè¯•å›°éš¾

é˜²æŠ¤æªæ–½ï¼š
- éªŒè¯æ¨¡å—åç™½åå•
- ä½¿ç”¨æ²™ç®±ç¯å¢ƒ
- å¼‚å¸¸å¤„ç†æœºåˆ¶
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é€‚ç”¨åœºæ™¯**ï¼š
- ğŸ”§ **æ’ä»¶æ¶æ„**ï¼šåŠ¨æ€åŠ è½½åŠŸèƒ½æ¨¡å—
- âš™ï¸ **é…ç½®ç®¡ç†**ï¼šè¿è¡Œæ—¶ä¿®æ”¹ç¨‹åºè¡Œä¸º  
- ğŸ› **è°ƒè¯•å·¥å…·**ï¼šæ£€æŸ¥å˜é‡çŠ¶æ€
- ğŸ“Š **æ€§èƒ½ç›‘æ§**ï¼šåŠ¨æ€æ”¶é›†è¿è¡Œæ•°æ®
- ğŸ¯ **æ¡†æ¶å¼€å‘**ï¼šæä¾›çµæ´»çš„æ‰©å±•æœºåˆ¶

**âŒ ä¸å»ºè®®ä½¿ç”¨çš„åœºæ™¯**ï¼š
- ğŸš« ç®€å•çš„æ¨¡å—å¯¼å…¥ï¼ˆç”¨æ™®é€šimportï¼‰
- ğŸš« é¢‘ç¹çš„å˜é‡æ“ä½œï¼ˆç›´æ¥èµ‹å€¼æ›´é«˜æ•ˆï¼‰
- ğŸš« å®‰å…¨æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿ
- ğŸš« åˆå­¦è€…é¡¹ç›®ï¼ˆå¢åŠ å¤æ‚æ€§ï¼‰

### 6.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ”§ ç¼–ç¨‹å®è·µ**ï¼š
```python
# âœ… æ¨èåšæ³•
def safe_import(module_name, allowed_modules):
    """å®‰å…¨çš„åŠ¨æ€å¯¼å…¥"""
    if module_name in allowed_modules:
        return __import__(module_name)
    raise ValueError(f"æ¨¡å— {module_name} ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­")

# âŒ é¿å…åšæ³•  
def unsafe_import(user_input):
    """å±é™©çš„åŠ¨æ€å¯¼å…¥"""
    return __import__(user_input)  # ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥
```

**ğŸ“‹ è°ƒè¯•æŠ€å·§**ï¼š
```python
def debug_function():
    """è°ƒè¯•æ—¶æŸ¥çœ‹æ‰€æœ‰å˜é‡"""
    x, y, z = 1, 2, 3
    
    print("ğŸ” å½“å‰å±€éƒ¨å˜é‡:")
    for name, value in locals().items():
        if not name.startswith('_'):
            print(f"  {name} = {value}")
```

**âš¡ æ€§èƒ½æç¤º**ï¼š
- `globals()`å’Œ`locals()`è¿”å›å­—å…¸ï¼Œé¢‘ç¹è°ƒç”¨æœ‰å¼€é”€
- åŠ¨æ€å¯¼å…¥æ¯”é™æ€å¯¼å…¥æ…¢ï¼Œé¿å…å¾ªç¯ä¸­ä½¿ç”¨
- ç¼“å­˜å¯¼å…¥çš„æ¨¡å—ï¼Œé¿å…é‡å¤å¯¼å…¥

### 6.5 ä¸å…¶ä»–çŸ¥è¯†ç‚¹çš„è”ç³»


```
æ¨¡å—å¯¼å…¥å‡½æ•° + å…¶ä»–Pythonç‰¹æ€§ï¼š

ğŸ“¦ ä¸æ¨¡å—ç³»ç»Ÿï¼š
- importè¯­å¥çš„åº•å±‚å®ç°
- åŒ…å’Œæ¨¡å—çš„åŠ¨æ€åŠ è½½

ğŸ”— ä¸åå°„æœºåˆ¶ï¼š
- hasattr(), getattr(), setattr()
- åŠ¨æ€è®¿é—®å¯¹è±¡å±æ€§

âš™ï¸ ä¸è£…é¥°å™¨ï¼š
- å‡½æ•°ç›‘æ§å’Œå¢å¼º
- åŠ¨æ€åŠŸèƒ½æ³¨å…¥

ğŸ—ï¸ ä¸è®¾è®¡æ¨¡å¼ï¼š
- å·¥å‚æ¨¡å¼ï¼šåŠ¨æ€åˆ›å»ºå¯¹è±¡
- ç­–ç•¥æ¨¡å¼ï¼šåŠ¨æ€é€‰æ‹©ç®—æ³•
- æ’ä»¶æ¨¡å¼ï¼šåŠ¨æ€æ‰©å±•åŠŸèƒ½
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¯¼å…¥æ¨¡å—ç”¨__import__ï¼ŒåŠ¨æ€åŠ è½½å¾ˆçµæ´»
å…¨å±€å˜é‡globalsç®¡ï¼Œå±€éƒ¨å˜é‡localsçœ‹  
å­—å…¸æ“ä½œè¦å°å¿ƒï¼Œå®‰å…¨ç¬¬ä¸€è®°å¿ƒé—´
æ’ä»¶é…ç½®è°ƒè¯•ç”¨ï¼Œåˆç†åœºæ™¯æ˜¯å…³é”®
```