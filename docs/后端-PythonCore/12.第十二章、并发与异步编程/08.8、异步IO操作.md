---
title: 8ã€å¼‚æ­¥IOæ“ä½œ
---
## ğŸ“š ç›®å½•

1. [å¼‚æ­¥I/OåŸºç¡€æ¦‚å¿µ](#1-å¼‚æ­¥ioåŸºç¡€æ¦‚å¿µ)
2. [å¼‚æ­¥æ–‡ä»¶æ“ä½œ](#2-å¼‚æ­¥æ–‡ä»¶æ“ä½œ)
3. [å¼‚æ­¥ç½‘ç»œç¼–ç¨‹](#3-å¼‚æ­¥ç½‘ç»œç¼–ç¨‹)
4. [aiohttpå¼‚æ­¥HTTPå®¢æˆ·ç«¯](#4-aiohttpå¼‚æ­¥httpå®¢æˆ·ç«¯)
5. [å¼‚æ­¥æ•°æ®åº“æ“ä½œ](#5-å¼‚æ­¥æ•°æ®åº“æ“ä½œ)
6. [å¼‚æ­¥æµå¤„ç†](#6-å¼‚æ­¥æµå¤„ç†)
7. [åè®®ä¸ä¼ è¾“](#7-åè®®ä¸ä¼ è¾“)
8. [å¼‚æ­¥æœåŠ¡å™¨å¼€å‘](#8-å¼‚æ­¥æœåŠ¡å™¨å¼€å‘)
9. [å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ](#9-å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å¼‚æ­¥I/OåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥I/O


**ğŸ”¸ é€šä¿—ç†è§£**
```
æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼š

åŒæ­¥æ–¹å¼ï¼ˆä¼ ç»Ÿï¼‰ï¼š
ä½  â†’ ç‚¹é¤ â†’ ç­‰å¨å¸ˆåšå®Œ â†’ æ‹¿åˆ°èœ â†’ æ‰èƒ½åšå…¶ä»–äº‹

å¼‚æ­¥æ–¹å¼ï¼ˆç°ä»£ï¼‰ï¼š
ä½  â†’ ç‚¹é¤ â†’ æ‹¿åˆ°å·ç ç‰Œ â†’ å¯ä»¥ç©æ‰‹æœºã€èŠå¤©
    â†³ èœåšå¥½äº†ä¼šå«å·ï¼Œä½ å†å»å–

å¼‚æ­¥I/Oå°±æ˜¯è¿™æ ·ï¼šç¨‹åºå‘èµ·æ“ä½œåä¸å‚»ç­‰ï¼Œå¯ä»¥åšå…¶ä»–äº‹æƒ…
```

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
```
I/Oï¼ˆInput/Outputï¼‰ï¼šè¾“å…¥è¾“å‡ºæ“ä½œ
- æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ã€æ•°æ®åº“æŸ¥è¯¢ç­‰

å¼‚æ­¥I/Oç‰¹ç‚¹ï¼š
âœ… éé˜»å¡ï¼šä¸ä¼šè®©ç¨‹åºå¡ä½ç­‰å¾…
âœ… å¹¶å‘ï¼šå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªI/Oæ“ä½œ
âœ… é«˜æ•ˆï¼šCPUä¸ä¼šç©ºé—²ç­‰å¾…
âœ… äº‹ä»¶é©±åŠ¨ï¼šæ“ä½œå®Œæˆæ—¶é€šè¿‡äº‹ä»¶é€šçŸ¥
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥I/O


**ğŸ”¸ ä¼ ç»ŸåŒæ­¥I/Oçš„é—®é¢˜**
```
åŒæ­¥ä»£ç ç¤ºä¾‹ï¼š
def download_file(url):
    response = requests.get(url)  # è¿™é‡Œä¼šç­‰å¾…ç½‘ç»œå“åº”
    return response.content       # å¯èƒ½ç­‰å‡ ç§’ç”šè‡³æ›´ä¹…

# ä¸‹è½½3ä¸ªæ–‡ä»¶
download_file("url1")  # ç­‰å¾…3ç§’
download_file("url2")  # å†ç­‰å¾…3ç§’  
download_file("url3")  # å†ç­‰å¾…3ç§’
# æ€»å…±éœ€è¦9ç§’ï¼

é—®é¢˜ï¼šç¨‹åºå¤§éƒ¨åˆ†æ—¶é—´åœ¨"ç­‰å¾…"ï¼ŒCPUæ²¡äº‹å¹²
```

**ğŸ”¸ å¼‚æ­¥I/Oçš„ä¼˜åŠ¿**
```
å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼š
async def download_file(url):
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            return await response.read()

# åŒæ—¶ä¸‹è½½3ä¸ªæ–‡ä»¶
await asyncio.gather(
    download_file("url1"),
    download_file("url2"), 
    download_file("url3")
)
# åªéœ€è¦3ç§’ï¼ï¼ˆæœ€æ…¢çš„é‚£ä¸ªæ–‡ä»¶çš„æ—¶é—´ï¼‰

ä¼˜åŠ¿ï¼šåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œå¤§å¤§æé«˜æ•ˆç‡
```

### 1.3 Pythonä¸­çš„å¼‚æ­¥I/Oç”Ÿæ€


**ğŸ”¸ æ ¸å¿ƒæ¨¡å—å’Œåº“**
```
å†…ç½®æ¨¡å—ï¼š
ğŸ“¦ asyncio     â† Pythonæ ‡å‡†å¼‚æ­¥ç¼–ç¨‹åº“
ğŸ“¦ aiofiles   â† å¼‚æ­¥æ–‡ä»¶æ“ä½œ
ğŸ“¦ aiohttp    â† å¼‚æ­¥HTTPå®¢æˆ·ç«¯/æœåŠ¡å™¨

æ•°æ®åº“å¼‚æ­¥åº“ï¼š
ğŸ“¦ aiopg      â† PostgreSQLå¼‚æ­¥é©±åŠ¨
ğŸ“¦ aiomysql   â† MySQLå¼‚æ­¥é©±åŠ¨  
ğŸ“¦ motor      â† MongoDBå¼‚æ­¥é©±åŠ¨

å·¥å…·åº“ï¼š
ğŸ“¦ uvloop     â† æ›´å¿«çš„äº‹ä»¶å¾ªç¯
ğŸ“¦ aiostream  â† å¼‚æ­¥æµå¤„ç†
```

---

## 2. ğŸ“ å¼‚æ­¥æ–‡ä»¶æ“ä½œ


### 2.1 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ–‡ä»¶æ“ä½œ


**ğŸ”¸ æ–‡ä»¶I/Oçš„é˜»å¡é—®é¢˜**
```
ä¼ ç»Ÿæ–‡ä»¶æ“ä½œçš„é—®é¢˜ï¼š

# è¯»å–å¤§æ–‡ä»¶æ—¶ç¨‹åºä¼š"å¡ä½"
with open('large_file.txt', 'r') as f:
    content = f.read()  # å¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œè¿™é‡Œä¼šç­‰å¾ˆä¹…
    print("æ–‡ä»¶è¯»å–å®Œæˆ")   # å…¶ä»–ä»£ç è¦ç­‰åˆ°è¿™é‡Œæ‰èƒ½æ‰§è¡Œ

ç°å®åœºæ™¯ï¼š
- è¯»å–å‡ GBçš„æ—¥å¿—æ–‡ä»¶
- å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„å¤§æ–‡ä»¶
- æ‰¹é‡å¤„ç†å¤šä¸ªæ–‡ä»¶
- WebæœåŠ¡å™¨å¤„ç†æ–‡ä»¶ä¸‹è½½

å¦‚æœç”¨åŒæ­¥æ–¹å¼ï¼Œæ•´ä¸ªç¨‹åºéƒ½ä¼šå¡ä½ï¼
```

### 2.2 aiofilesåŸºç¡€ä½¿ç”¨


**ğŸ”¸ å®‰è£…å’Œå¯¼å…¥**
```python
# å®‰è£…aiofiles
pip install aiofiles

# å¯¼å…¥
import aiofiles
import asyncio
```

**ğŸ”¸ åŸºæœ¬æ–‡ä»¶è¯»å†™æ“ä½œ**
```python
# å¼‚æ­¥è¯»å–æ–‡ä»¶
async def read_file_async(filename):
    """å¼‚æ­¥è¯»å–æ–‡ä»¶å†…å®¹"""
    async with aiofiles.open(filename, 'r', encoding='utf-8') as f:
        content = await f.read()
        return content

# å¼‚æ­¥å†™å…¥æ–‡ä»¶
async def write_file_async(filename, content):
    """å¼‚æ­¥å†™å…¥æ–‡ä»¶å†…å®¹"""
    async with aiofiles.open(filename, 'w', encoding='utf-8') as f:
        await f.write(content)
        print(f"æ–‡ä»¶ {filename} å†™å…¥å®Œæˆ")

# ä½¿ç”¨ç¤ºä¾‹
async def main():
    # è¯»å–æ–‡ä»¶
    content = await read_file_async('example.txt')
    print(f"è¯»å–åˆ°å†…å®¹: {content[:50]}...")
    
    # å†™å…¥æ–‡ä»¶
    await write_file_async('output.txt', "è¿™æ˜¯å¼‚æ­¥å†™å…¥çš„å†…å®¹")

# è¿è¡Œ
asyncio.run(main())
```

### 2.3 æ‰¹é‡æ–‡ä»¶å¤„ç†


**ğŸ”¸ åŒæ—¶å¤„ç†å¤šä¸ªæ–‡ä»¶**
```python
async def process_multiple_files():
    """åŒæ—¶å¤„ç†å¤šä¸ªæ–‡ä»¶çš„ç¤ºä¾‹"""
    
    # è¦å¤„ç†çš„æ–‡ä»¶åˆ—è¡¨
    files = ['file1.txt', 'file2.txt', 'file3.txt']
    
    # å®šä¹‰å¤„ç†å•ä¸ªæ–‡ä»¶çš„å‡½æ•°
    async def process_file(filename):
        try:
            async with aiofiles.open(filename, 'r') as f:
                content = await f.read()
                # æ¨¡æ‹Ÿä¸€äº›å¤„ç†æ“ä½œ
                processed = content.upper()
                
            # å†™å…¥å¤„ç†åçš„æ–‡ä»¶
            output_name = f"processed_{filename}"
            async with aiofiles.open(output_name, 'w') as f:
                await f.write(processed)
                
            print(f"âœ… {filename} å¤„ç†å®Œæˆ")
            return f"å¤„ç†äº† {len(content)} ä¸ªå­—ç¬¦"
            
        except FileNotFoundError:
            print(f"âŒ æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
            return None
    
    # åŒæ—¶å¤„ç†æ‰€æœ‰æ–‡ä»¶
    results = await asyncio.gather(
        *[process_file(file) for file in files],
        return_exceptions=True  # å³ä½¿æŸä¸ªæ–‡ä»¶å‡ºé”™ä¹Ÿç»§ç»­
    )
    
    print(f"å¤„ç†ç»“æœ: {results}")

# è¿è¡Œ
asyncio.run(process_multiple_files())
```

### 2.4 å¤§æ–‡ä»¶åˆ†å—å¤„ç†


**ğŸ”¸ é¿å…å†…å­˜æº¢å‡ºçš„åˆ†å—è¯»å–**
```python
async def read_large_file_chunks(filename, chunk_size=1024):
    """åˆ†å—è¯»å–å¤§æ–‡ä»¶ï¼Œé¿å…å†…å­˜æº¢å‡º"""
    
    total_size = 0
    async with aiofiles.open(filename, 'rb') as f:
        while True:
            # æ¯æ¬¡è¯»å–æŒ‡å®šå¤§å°çš„å—
            chunk = await f.read(chunk_size)
            if not chunk:  # æ–‡ä»¶è¯»å®Œäº†
                break
                
            total_size += len(chunk)
            # è¿™é‡Œå¯ä»¥å¤„ç†æ¯ä¸ªå—çš„æ•°æ®
            print(f"å·²å¤„ç† {total_size} å­—èŠ‚")
            
            # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´ï¼ˆå®é™…ä½¿ç”¨æ—¶åˆ é™¤ï¼‰
            await asyncio.sleep(0.1)
    
    print(f"æ–‡ä»¶è¯»å–å®Œæˆï¼Œæ€»å¤§å°: {total_size} å­—èŠ‚")

# ä½¿ç”¨ç¤ºä¾‹
async def main():
    await read_large_file_chunks('large_file.dat', chunk_size=4096)

asyncio.run(main())
```

---

## 3. ğŸŒ å¼‚æ­¥ç½‘ç»œç¼–ç¨‹


### 3.1 ç½‘ç»œç¼–ç¨‹åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç½‘ç»œç¼–ç¨‹**
```
ç½‘ç»œç¼–ç¨‹å°±æ˜¯è®©ç¨‹åºé€šè¿‡ç½‘ç»œä¸å…¶ä»–ç¨‹åºé€šä¿¡ï¼š

å®¢æˆ·ç«¯ â†â†’ æœåŠ¡å™¨
   |         |
æµè§ˆå™¨    WebæœåŠ¡å™¨
æ‰‹æœºApp   APIæœåŠ¡å™¨
æ¸¸æˆå®¢æˆ·ç«¯ æ¸¸æˆæœåŠ¡å™¨

å¸¸è§ç½‘ç»œæ“ä½œï¼š
- å‘é€HTTPè¯·æ±‚è·å–ç½‘é¡µ
- ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶
- å®æ—¶èŠå¤©
- æ•°æ®åŒæ­¥
```

**ğŸ”¸ ä¸ºä»€ä¹ˆç½‘ç»œæ“ä½œéœ€è¦å¼‚æ­¥**
```
ç½‘ç»œæ“ä½œçš„ç‰¹ç‚¹ï¼š
âŒ å»¶è¿Ÿé«˜ï¼šç½‘ç»œä¼ è¾“éœ€è¦æ—¶é—´
âŒ ä¸å¯é¢„æµ‹ï¼šç½‘ç»œçŠ¶å†µå˜åŒ–å¤§
âŒ å®¹æ˜“å¤±è´¥ï¼šç½‘ç»œå¯èƒ½ä¸­æ–­

å¦‚æœç”¨åŒæ­¥æ–¹å¼ï¼š
def get_web_page(url):
    response = requests.get(url)  # å¯èƒ½ç­‰å¾…å‡ ç§’
    return response.text

# è·å–100ä¸ªç½‘é¡µ
for url in urls:
    get_web_page(url)  # æ¯ä¸ªéƒ½è¦ç­‰å¾…ï¼Œæ€»æ—¶é—´=ç­‰å¾…æ—¶é—´Ã—100

ç”¨å¼‚æ­¥æ–¹å¼ï¼š
async def get_web_page(url):
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            return await response.text()

# åŒæ—¶è·å–100ä¸ªç½‘é¡µ
await asyncio.gather(*[get_web_page(url) for url in urls])
```

### 3.2 ä½¿ç”¨asyncioè¿›è¡ŒTCPç¼–ç¨‹


**ğŸ”¸ åˆ›å»ºç®€å•çš„TCPæœåŠ¡å™¨**
```python
import asyncio

async def handle_client(reader, writer):
    """å¤„ç†å®¢æˆ·ç«¯è¿æ¥çš„å‡½æ•°"""
    # è·å–å®¢æˆ·ç«¯åœ°å€
    addr = writer.get_extra_info('peername')
    print(f"å®¢æˆ·ç«¯ {addr} å·²è¿æ¥")
    
    try:
        while True:
            # è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®
            data = await reader.read(1024)
            if not data:
                break
                
            message = data.decode('utf-8')
            print(f"æ”¶åˆ°æ¶ˆæ¯: {message}")
            
            # å‘é€å›å¤
            reply = f"æœåŠ¡å™¨æ”¶åˆ°: {message}"
            writer.write(reply.encode('utf-8'))
            await writer.drain()  # ç¡®ä¿æ•°æ®å‘é€å‡ºå»
            
    except Exception as e:
        print(f"å¤„ç†å®¢æˆ·ç«¯æ—¶å‡ºé”™: {e}")
    finally:
        writer.close()
        await writer.wait_closed()
        print(f"å®¢æˆ·ç«¯ {addr} å·²æ–­å¼€")

async def start_server():
    """å¯åŠ¨TCPæœåŠ¡å™¨"""
    server = await asyncio.start_server(
        handle_client,    # å¤„ç†å®¢æˆ·ç«¯çš„å‡½æ•°
        'localhost',      # æœåŠ¡å™¨åœ°å€
        8888             # ç«¯å£å·
    )
    
    addr = server.sockets[0].getsockname()
    print(f"æœåŠ¡å™¨å¯åŠ¨åœ¨ {addr}")
    
    # æŒç»­è¿è¡ŒæœåŠ¡å™¨
    async with server:
        await server.serve_forever()

# è¿è¡ŒæœåŠ¡å™¨
if __name__ == "__main__":
    asyncio.run(start_server())
```

**ğŸ”¸ åˆ›å»ºTCPå®¢æˆ·ç«¯**
```python
import asyncio

async def tcp_client():
    """TCPå®¢æˆ·ç«¯ç¤ºä¾‹"""
    try:
        # è¿æ¥åˆ°æœåŠ¡å™¨
        reader, writer = await asyncio.open_connection(
            'localhost', 8888
        )
        print("å·²è¿æ¥åˆ°æœåŠ¡å™¨")
        
        # å‘é€å‡ æ¡æ¶ˆæ¯
        messages = ["Hello", "How are you?", "Goodbye"]
        
        for msg in messages:
            # å‘é€æ¶ˆæ¯
            writer.write(msg.encode('utf-8'))
            await writer.drain()
            
            # æ¥æ”¶å›å¤
            data = await reader.read(1024)
            reply = data.decode('utf-8')
            print(f"æœåŠ¡å™¨å›å¤: {reply}")
            
            await asyncio.sleep(1)  # ç­‰å¾…1ç§’
        
        # å…³é—­è¿æ¥
        writer.close()
        await writer.wait_closed()
        print("è¿æ¥å·²å…³é—­")
        
    except Exception as e:
        print(f"å®¢æˆ·ç«¯é”™è¯¯: {e}")

# è¿è¡Œå®¢æˆ·ç«¯
asyncio.run(tcp_client())
```

### 3.3 UDPå¼‚æ­¥ç¼–ç¨‹


**ğŸ”¸ UDPæœåŠ¡å™¨ç¤ºä¾‹**
```python
import asyncio

class UDPServerProtocol:
    """UDPæœåŠ¡å™¨åè®®ç±»"""
    
    def connection_made(self, transport):
        self.transport = transport
        print("UDPæœåŠ¡å™¨å·²å¯åŠ¨")
    
    def datagram_received(self, data, addr):
        """æ”¶åˆ°æ•°æ®åŒ…æ—¶è°ƒç”¨"""
        message = data.decode('utf-8')
        print(f"æ”¶åˆ°æ¥è‡ª {addr} çš„æ¶ˆæ¯: {message}")
        
        # å‘é€å›å¤
        reply = f"æœåŠ¡å™¨æ”¶åˆ°: {message}"
        self.transport.sendto(reply.encode('utf-8'), addr)

async def start_udp_server():
    """å¯åŠ¨UDPæœåŠ¡å™¨"""
    loop = asyncio.get_running_loop()
    
    # åˆ›å»ºUDPæœåŠ¡å™¨
    transport, protocol = await loop.create_datagram_endpoint(
        lambda: UDPServerProtocol(),
        local_addr=('localhost', 9999)
    )
    
    print("UDPæœåŠ¡å™¨è¿è¡Œåœ¨ localhost:9999")
    
    try:
        await asyncio.sleep(3600)  # è¿è¡Œ1å°æ—¶
    finally:
        transport.close()

# è¿è¡ŒUDPæœåŠ¡å™¨
asyncio.run(start_udp_server())
```

---

## 4. ğŸš€ aiohttpå¼‚æ­¥HTTPå®¢æˆ·ç«¯


### 4.1 aiohttpåŸºç¡€ä½¿ç”¨


**ğŸ”¸ å®‰è£…å’ŒåŸºæœ¬æ¦‚å¿µ**
```python
# å®‰è£…aiohttp
pip install aiohttp

# aiohttpæ˜¯ä»€ä¹ˆï¼Ÿ
# aiohttp = asyncio + HTTP
# ä¸“é—¨ç”¨äºå¼‚æ­¥HTTPè¯·æ±‚å’Œå“åº”çš„åº“
```

**ğŸ”¸ å‘é€GETè¯·æ±‚**
```python
import aiohttp
import asyncio

async def fetch_webpage(url):
    """è·å–ç½‘é¡µå†…å®¹"""
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            # æ£€æŸ¥å“åº”çŠ¶æ€
            print(f"çŠ¶æ€ç : {response.status}")
            
            # è·å–å“åº”å†…å®¹
            content = await response.text()
            return content

# ä½¿ç”¨ç¤ºä¾‹
async def main():
    url = "https://httpbin.org/get"
    content = await fetch_webpage(url)
    print(f"ç½‘é¡µå†…å®¹: {content[:200]}...")

asyncio.run(main())
```

### 4.2 å„ç§HTTPè¯·æ±‚æ–¹æ³•


**ğŸ”¸ POSTè¯·æ±‚å‘é€æ•°æ®**
```python
async def send_post_request():
    """å‘é€POSTè¯·æ±‚ç¤ºä¾‹"""
    url = "https://httpbin.org/post"
    
    # è¦å‘é€çš„æ•°æ®
    data = {
        'name': 'å¼ ä¸‰',
        'age': 25,
        'email': 'zhangsan@example.com'
    }
    
    async with aiohttp.ClientSession() as session:
        # å‘é€JSONæ•°æ®
        async with session.post(url, json=data) as response:
            result = await response.json()
            print(f"POSTå“åº”: {result}")
        
        # å‘é€è¡¨å•æ•°æ®
        form_data = aiohttp.FormData()
        form_data.add_field('username', 'user123')
        form_data.add_field('password', 'secret')
        
        async with session.post(url, data=form_data) as response:
            result = await response.json()
            print(f"è¡¨å•å“åº”: {result}")

asyncio.run(send_post_request())
```

**ğŸ”¸ æ·»åŠ è¯·æ±‚å¤´å’Œå‚æ•°**
```python
async def advanced_requests():
    """é«˜çº§è¯·æ±‚ç¤ºä¾‹"""
    
    # è‡ªå®šä¹‰è¯·æ±‚å¤´
    headers = {
        'User-Agent': 'MyApp/1.0',
        'Authorization': 'Bearer your-token-here',
        'Content-Type': 'application/json'
    }
    
    # URLå‚æ•°
    params = {
        'page': 1,
        'size': 20,
        'category': 'tech'
    }
    
    async with aiohttp.ClientSession(headers=headers) as session:
        url = "https://httpbin.org/get"
        
        async with session.get(url, params=params) as response:
            result = await response.json()
            print(f"è¯·æ±‚URL: {result['url']}")
            print(f"è¯·æ±‚å¤´: {result['headers']}")

asyncio.run(advanced_requests())
```

### 4.3 å¹¶å‘HTTPè¯·æ±‚


**ğŸ”¸ åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚**
```python
async def fetch_multiple_urls():
    """åŒæ—¶è·å–å¤šä¸ªURLçš„å†…å®¹"""
    
    urls = [
        "https://httpbin.org/delay/1",  # å»¶è¿Ÿ1ç§’
        "https://httpbin.org/delay/2",  # å»¶è¿Ÿ2ç§’
        "https://httpbin.org/delay/1",  # å»¶è¿Ÿ1ç§’
    ]
    
    async def fetch_single_url(session, url):
        """è·å–å•ä¸ªURL"""
        try:
            async with session.get(url) as response:
                data = await response.json()
                return f"âœ… {url} - çŠ¶æ€: {response.status}"
        except Exception as e:
            return f"âŒ {url} - é”™è¯¯: {e}"
    
    # ä½¿ç”¨ä¼šè¯ç®¡ç†å™¨
    async with aiohttp.ClientSession() as session:
        # è®°å½•å¼€å§‹æ—¶é—´
        import time
        start_time = time.time()
        
        # å¹¶å‘æ‰§è¡Œæ‰€æœ‰è¯·æ±‚
        results = await asyncio.gather(
            *[fetch_single_url(session, url) for url in urls],
            return_exceptions=True
        )
        
        end_time = time.time()
        
        # æ˜¾ç¤ºç»“æœ
        for result in results:
            print(result)
        
        print(f"æ€»è€—æ—¶: {end_time - start_time:.2f}ç§’")
        print("å¦‚æœç”¨åŒæ­¥æ–¹å¼éœ€è¦: 1+2+1 = 4ç§’")

asyncio.run(fetch_multiple_urls())
```

### 4.4 æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½


**ğŸ”¸ å¼‚æ­¥æ–‡ä»¶ä¸‹è½½**
```python
import aiofiles

async def download_file(url, filename):
    """å¼‚æ­¥ä¸‹è½½æ–‡ä»¶"""
    async with aiohttp.ClientSession() as session:
        print(f"å¼€å§‹ä¸‹è½½: {url}")
        
        async with session.get(url) as response:
            if response.status == 200:
                # å¼‚æ­¥å†™å…¥æ–‡ä»¶
                async with aiofiles.open(filename, 'wb') as f:
                    async for chunk in response.content.iter_chunked(1024):
                        await f.write(chunk)
                
                print(f"âœ… ä¸‹è½½å®Œæˆ: {filename}")
            else:
                print(f"âŒ ä¸‹è½½å¤±è´¥: {response.status}")

# åŒæ—¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶
async def download_multiple_files():
    downloads = [
        ("https://httpbin.org/json", "file1.json"),
        ("https://httpbin.org/xml", "file2.xml"),
        ("https://httpbin.org/html", "file3.html"),
    ]
    
    tasks = [download_file(url, filename) for url, filename in downloads]
    await asyncio.gather(*tasks)

asyncio.run(download_multiple_files())
```

**ğŸ”¸ å¼‚æ­¥æ–‡ä»¶ä¸Šä¼ **
```python
async def upload_file(url, file_path):
    """å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶"""
    async with aiohttp.ClientSession() as session:
        # åˆ›å»ºè¡¨å•æ•°æ®
        data = aiohttp.FormData()
        
        # å¼‚æ­¥è¯»å–æ–‡ä»¶å¹¶æ·»åŠ åˆ°è¡¨å•
        async with aiofiles.open(file_path, 'rb') as f:
            file_content = await f.read()
            data.add_field('file', 
                         file_content,
                         filename=file_path,
                         content_type='application/octet-stream')
        
        # ä¸Šä¼ æ–‡ä»¶
        async with session.post(url, data=data) as response:
            result = await response.json()
            print(f"ä¸Šä¼ ç»“æœ: {result}")

# ä½¿ç”¨ç¤ºä¾‹
async def main():
    await upload_file("https://httpbin.org/post", "example.txt")

asyncio.run(main())
```

---

## 5. ğŸ’¾ å¼‚æ­¥æ•°æ®åº“æ“ä½œ


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥æ•°æ®åº“æ“ä½œ


**ğŸ”¸ æ•°æ®åº“æ“ä½œçš„é˜»å¡é—®é¢˜**
```
ä¼ ç»ŸåŒæ­¥æ•°æ®åº“æ“ä½œï¼š

import sqlite3

def get_user_info(user_id):
    conn = sqlite3.connect('users.db')
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
    result = cursor.fetchone()  # è¿™é‡Œä¼šç­‰å¾…æ•°æ®åº“å“åº”
    conn.close()
    return result

# æŸ¥è¯¢100ä¸ªç”¨æˆ·
for user_id in range(1, 101):
    user_info = get_user_info(user_id)  # æ¯æ¬¡éƒ½è¦ç­‰å¾…
    process_user(user_info)

é—®é¢˜ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½è¦ç­‰å¾…ï¼Œæ•ˆç‡å¾ˆä½
```

### 5.2 ä½¿ç”¨aiosqliteæ“ä½œSQLite


**ğŸ”¸ åŸºç¡€å¼‚æ­¥æ•°æ®åº“æ“ä½œ**
```python
import aiosqlite
import asyncio

async def create_table():
    """åˆ›å»ºæ•°æ®è¡¨"""
    async with aiosqlite.connect('async_example.db') as db:
        await db.execute('''
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY,
                name TEXT NOT NULL,
                email TEXT NOT NULL,
                age INTEGER
            )
        ''')
        await db.commit()
        print("âœ… æ•°æ®è¡¨åˆ›å»ºå®Œæˆ")

async def insert_user(name, email, age):
    """æ’å…¥ç”¨æˆ·æ•°æ®"""
    async with aiosqlite.connect('async_example.db') as db:
        await db.execute(
            "INSERT INTO users (name, email, age) VALUES (?, ?, ?)",
            (name, email, age)
        )
        await db.commit()
        print(f"âœ… æ’å…¥ç”¨æˆ·: {name}")

async def get_user_by_id(user_id):
    """æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·"""
    async with aiosqlite.connect('async_example.db') as db:
        async with db.execute(
            "SELECT * FROM users WHERE id = ?", (user_id,)
        ) as cursor:
            result = await cursor.fetchone()
            return result

# æ‰¹é‡æ“ä½œç¤ºä¾‹
async def batch_operations():
    """æ‰¹é‡æ•°æ®åº“æ“ä½œ"""
    # åˆ›å»ºè¡¨
    await create_table()
    
    # æ‰¹é‡æ’å…¥ç”¨æˆ·
    users = [
        ("å¼ ä¸‰", "zhangsan@example.com", 25),
        ("æå››", "lisi@example.com", 30),
        ("ç‹äº”", "wangwu@example.com", 28),
    ]
    
    # å¹¶å‘æ’å…¥ï¼ˆæ³¨æ„ï¼šSQLiteå¯èƒ½ä¸æ”¯æŒçœŸæ­£çš„å¹¶å‘å†™å…¥ï¼‰
    tasks = [insert_user(name, email, age) for name, email, age in users]
    await asyncio.gather(*tasks)
    
    # å¹¶å‘æŸ¥è¯¢
    user_ids = [1, 2, 3]
    results = await asyncio.gather(
        *[get_user_by_id(uid) for uid in user_ids]
    )
    
    for result in results:
        print(f"æŸ¥è¯¢ç»“æœ: {result}")

asyncio.run(batch_operations())
```

### 5.3 ä½¿ç”¨aiomysqlæ“ä½œMySQL


**ğŸ”¸ å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨**
```python
# å®‰è£…aiomysql
pip install aiomysql

import aiomysql
import asyncio

async def mysql_example():
    """MySQLå¼‚æ­¥æ“ä½œç¤ºä¾‹"""
    
    # åˆ›å»ºè¿æ¥æ± ï¼ˆæ¨èæ–¹å¼ï¼‰
    pool = await aiomysql.create_pool(
        host='localhost',
        port=3306,
        user='your_username',
        password='your_password',
        db='your_database',
        minsize=1,
        maxsize=10,
        autocommit=True
    )
    
    try:
        # ä»è¿æ¥æ± è·å–è¿æ¥
        async with pool.acquire() as conn:
            async with conn.cursor() as cursor:
                # æ‰§è¡ŒæŸ¥è¯¢
                await cursor.execute("SELECT * FROM users LIMIT 10")
                results = await cursor.fetchall()
                
                for row in results:
                    print(f"ç”¨æˆ·: {row}")
                
                # æ‰§è¡Œæ’å…¥
                await cursor.execute(
                    "INSERT INTO users (name, email) VALUES (%s, %s)",
                    ("æ–°ç”¨æˆ·", "newuser@example.com")
                )
                print("âœ… æ•°æ®æ’å…¥æˆåŠŸ")
    
    finally:
        # å…³é—­è¿æ¥æ± 
        pool.close()
        await pool.wait_closed()

# æ³¨æ„ï¼šéœ€è¦å…ˆå®‰è£…å’Œé…ç½®MySQLæœåŠ¡å™¨
# asyncio.run(mysql_example())
```

### 5.4 å¼‚æ­¥ORM - Tortoise ORM


**ğŸ”¸ ä½¿ç”¨Tortoise ORMç®€åŒ–æ•°æ®åº“æ“ä½œ**
```python
# å®‰è£…Tortoise ORM
pip install tortoise-orm

from tortoise.models import Model
from tortoise import fields
from tortoise import Tortoise, run_async

# å®šä¹‰æ•°æ®æ¨¡å‹
class User(Model):
    id = fields.IntField(pk=True)
    name = fields.CharField(max_length=50)
    email = fields.CharField(max_length=100)
    created_at = fields.DatetimeField(auto_now_add=True)
    
    class Meta:
        table = "users"
    
    def __str__(self):
        return f"User(id={self.id}, name={self.name})"

async def init_database():
    """åˆå§‹åŒ–æ•°æ®åº“è¿æ¥"""
    await Tortoise.init(
        db_url='sqlite://example.db',
        modules={'models': ['__main__']}
    )
    await Tortoise.generate_schemas()

async def orm_examples():
    """ORMæ“ä½œç¤ºä¾‹"""
    await init_database()
    
    # åˆ›å»ºç”¨æˆ·
    user1 = await User.create(name="å¼ ä¸‰", email="zhangsan@example.com")
    user2 = await User.create(name="æå››", email="lisi@example.com")
    print(f"åˆ›å»ºç”¨æˆ·: {user1}, {user2}")
    
    # æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    all_users = await User.all()
    print(f"æ‰€æœ‰ç”¨æˆ·: {all_users}")
    
    # æ¡ä»¶æŸ¥è¯¢
    user = await User.filter(name="å¼ ä¸‰").first()
    print(f"æŸ¥æ‰¾å¼ ä¸‰: {user}")
    
    # æ›´æ–°ç”¨æˆ·
    await User.filter(name="å¼ ä¸‰").update(email="new_email@example.com")
    
    # åˆ é™¤ç”¨æˆ·
    await User.filter(name="æå››").delete()
    
    # å…³é—­æ•°æ®åº“è¿æ¥
    await Tortoise.close_connections()

# è¿è¡ŒORMç¤ºä¾‹
run_async(orm_examples())
```

---

## 6. ğŸŒŠ å¼‚æ­¥æµå¤„ç†


### 6.1 ä»€ä¹ˆæ˜¯æµå¤„ç†


**ğŸ”¸ æµçš„æ¦‚å¿µ**
```
æµï¼ˆStreamï¼‰å°±åƒæ°´æµä¸€æ ·ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸€æ¬¡æ€§å¤„ç†ï¼‰ï¼š
æ•°æ® â†’ [ç­‰å¾…å…¨éƒ¨åŠ è½½] â†’ å¤„ç† â†’ ç»“æœ

æµå¼å¤„ç†ï¼š
æ•°æ®æº â†’ æ•°æ®å—1 â†’ å¤„ç† â†’ è¾“å‡º1
       â†’ æ•°æ®å—2 â†’ å¤„ç† â†’ è¾“å‡º2
       â†’ æ•°æ®å—3 â†’ å¤„ç† â†’ è¾“å‡º3

ä¼˜åŠ¿ï¼š
âœ… å†…å­˜æ•ˆç‡é«˜ï¼šä¸éœ€è¦ä¸€æ¬¡åŠ è½½å…¨éƒ¨æ•°æ®
âœ… å®æ—¶æ€§å¥½ï¼šè¾¹æ¥æ”¶è¾¹å¤„ç†
âœ… å¯æ‰©å±•ï¼šé€‚åˆå¤„ç†å¤§é‡æ•°æ®
```

### 6.2 asyncioæµæ“ä½œ


**ğŸ”¸ åŸºç¡€æµè¯»å†™**
```python
import asyncio

async def stream_example():
    """æµæ“ä½œåŸºç¡€ç¤ºä¾‹"""
    
    # åˆ›å»ºå­è¿›ç¨‹å¹¶è·å–æµ
    process = await asyncio.create_subprocess_exec(
        'python', '-c', 'for i in range(10): print(f"è¡Œ {i}")',
        stdout=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE
    )
    
    # é€è¡Œè¯»å–è¾“å‡º
    while True:
        line = await process.stdout.readline()
        if not line:
            break
        
        decoded_line = line.decode('utf-8').strip()
        print(f"è¯»å–åˆ°: {decoded_line}")
    
    # ç­‰å¾…è¿›ç¨‹ç»“æŸ
    await process.wait()
    print("âœ… æµå¤„ç†å®Œæˆ")

asyncio.run(stream_example())
```

**ğŸ”¸ ç½‘ç»œæµå¤„ç†**
```python
async def network_stream_example():
    """ç½‘ç»œæµå¤„ç†ç¤ºä¾‹"""
    
    async def handle_stream(reader, writer):
        """å¤„ç†ç½‘ç»œæµ"""
        addr = writer.get_extra_info('peername')
        print(f"å®¢æˆ·ç«¯ {addr} è¿æ¥")
        
        try:
            while True:
                # æµå¼è¯»å–æ•°æ®
                data = await reader.read(100)  # æ¯æ¬¡è¯»å–100å­—èŠ‚
                if not data:
                    break
                
                message = data.decode('utf-8')
                print(f"æ¥æ”¶æµæ•°æ®: {message}")
                
                # æµå¼å“åº”
                response = f"å·²å¤„ç†: {len(message)} å­—èŠ‚\n"
                writer.write(response.encode('utf-8'))
                await writer.drain()
        
        except Exception as e:
            print(f"æµå¤„ç†é”™è¯¯: {e}")
        finally:
            writer.close()
            await writer.wait_closed()
    
    # å¯åŠ¨æµæœåŠ¡å™¨
    server = await asyncio.start_server(handle_stream, 'localhost', 8889)
    print("æµæœåŠ¡å™¨å¯åŠ¨åœ¨ localhost:8889")
    
    async with server:
        await server.serve_forever()

# asyncio.run(network_stream_example())
```

### 6.3 ä½¿ç”¨aiostreamè¿›è¡Œé«˜çº§æµå¤„ç†


**ğŸ”¸ å®‰è£…å’ŒåŸºç¡€ä½¿ç”¨**
```python
# å®‰è£…aiostream
pip install aiostream

from aiostream import stream
import asyncio

async def generate_numbers():
    """ç”Ÿæˆæ•°å­—æµ"""
    for i in range(10):
        print(f"ç”Ÿæˆ: {i}")
        yield i
        await asyncio.sleep(0.5)  # æ¨¡æ‹Ÿå»¶è¿Ÿ

async def stream_processing_example():
    """æµå¤„ç†ç¤ºä¾‹"""
    
    # åˆ›å»ºå¼‚æ­¥æµ
    numbers = stream.iterate(generate_numbers())
    
    # æµæ“ä½œï¼šè¿‡æ»¤ã€æ˜ å°„ã€å¤„ç†
    filtered = numbers | stream.filter(lambda x: x % 2 == 0)  # è¿‡æ»¤å¶æ•°
    mapped = filtered | stream.map(lambda x: x * 2)           # ä¹˜ä»¥2
    
    # å¤„ç†æµæ•°æ®
    async with mapped.stream() as streamer:
        async for value in streamer:
            print(f"å¤„ç†ç»“æœ: {value}")

asyncio.run(stream_processing_example())
```

---

## 7. ğŸ”Œ åè®®ä¸ä¼ è¾“


### 7.1 åè®®å’Œä¼ è¾“çš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯åè®®å’Œä¼ è¾“**
```
åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼š

ä¼ è¾“ï¼ˆTransportï¼‰ï¼š
- è´Ÿè´£å®é™…çš„æ•°æ®ä¼ è¾“
- ç®¡ç†è¿æ¥çš„å»ºç«‹ã€ç»´æŠ¤ã€å…³é—­
- å¤„ç†åº•å±‚çš„ç½‘ç»œç»†èŠ‚

åè®®ï¼ˆProtocolï¼‰ï¼š
- å®šä¹‰å¦‚ä½•å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®
- è§„å®šæ•°æ®çš„æ ¼å¼å’Œå¤„ç†é€»è¾‘
- å®ç°ä¸šåŠ¡é€»è¾‘

ç®€å•ç±»æ¯”ï¼š
ä¼ è¾“ = é‚®æ”¿ç³»ç»Ÿï¼ˆè´Ÿè´£é€ä¿¡ï¼‰
åè®® = ä¿¡ä»¶æ ¼å¼ï¼ˆä¿¡çš„å†…å®¹æ€ä¹ˆå†™ã€æ€ä¹ˆè¯»ï¼‰
```

### 7.2 è‡ªå®šä¹‰åè®®ç¤ºä¾‹


**ğŸ”¸ åˆ›å»ºç®€å•çš„åè®®ç±»**
```python
import asyncio

class EchoProtocol(asyncio.Protocol):
    """ç®€å•çš„å›æ˜¾åè®®"""
    
    def connection_made(self, transport):
        """è¿æ¥å»ºç«‹æ—¶è°ƒç”¨"""
        self.transport = transport
        self.addr = transport.get_extra_info('peername')
        print(f"å®¢æˆ·ç«¯ {self.addr} å·²è¿æ¥")
    
    def data_received(self, data):
        """æ”¶åˆ°æ•°æ®æ—¶è°ƒç”¨"""
        message = data.decode('utf-8')
        print(f"æ”¶åˆ°æ¶ˆæ¯: {message}")
        
        # å›æ˜¾æ¶ˆæ¯
        reply = f"å›æ˜¾: {message}"
        self.transport.write(reply.encode('utf-8'))
    
    def connection_lost(self, exc):
        """è¿æ¥æ–­å¼€æ—¶è°ƒç”¨"""
        if exc:
            print(f"è¿æ¥å¼‚å¸¸æ–­å¼€: {exc}")
        else:
            print(f"å®¢æˆ·ç«¯ {self.addr} æ­£å¸¸æ–­å¼€")

async def start_echo_server():
    """å¯åŠ¨å›æ˜¾æœåŠ¡å™¨"""
    loop = asyncio.get_running_loop()
    
    # åˆ›å»ºæœåŠ¡å™¨
    server = await loop.create_server(
        lambda: EchoProtocol(),  # åè®®å·¥å‚å‡½æ•°
        'localhost',
        8890
    )
    
    print("å›æ˜¾æœåŠ¡å™¨å¯åŠ¨åœ¨ localhost:8890")
    
    async with server:
        await server.serve_forever()

# asyncio.run(start_echo_server())
```

**ğŸ”¸ HTTPåè®®çš„ç®€å•å®ç°**
```python
class SimpleHTTPProtocol(asyncio.Protocol):
    """ç®€å•çš„HTTPåè®®å®ç°"""
    
    def connection_made(self, transport):
        self.transport = transport
        self.data = b''
    
    def data_received(self, data):
        self.data += data
        
        # æ£€æŸ¥æ˜¯å¦æ¥æ”¶å®Œæ•´ä¸ªHTTPè¯·æ±‚
        if b'\r\n\r\n' in self.data:
            self.handle_request()
    
    def handle_request(self):
        """å¤„ç†HTTPè¯·æ±‚"""
        request = self.data.decode('utf-8')
        lines = request.split('\r\n')
        
        if lines:
            method, path, version = lines[0].split()
            print(f"HTTPè¯·æ±‚: {method} {path}")
            
            # æ„é€ HTTPå“åº”
            html_content = f"""
            <html>
                <head><title>å¼‚æ­¥æœåŠ¡å™¨</title></head>
                <body>
                    <h1>Hello from å¼‚æ­¥æœåŠ¡å™¨!</h1>
                    <p>è¯·æ±‚è·¯å¾„: {path}</p>
                    <p>è¯·æ±‚æ–¹æ³•: {method}</p>
                </body>
            </html>
            """
            
            response = f"""HTTP/1.1 200 OK\r
Content-Type: text/html; charset=utf-8\r
Content-Length: {len(html_content.encode('utf-8'))}\r
\r
{html_content}"""
            
            self.transport.write(response.encode('utf-8'))
            self.transport.close()

async def start_http_server():
    """å¯åŠ¨ç®€å•HTTPæœåŠ¡å™¨"""
    loop = asyncio.get_running_loop()
    
    server = await loop.create_server(
        lambda: SimpleHTTPProtocol(),
        'localhost',
        8891
    )
    
    print("HTTPæœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:8891")
    
    async with server:
        await server.serve_forever()

# asyncio.run(start_http_server())
```

---

## 8. ğŸ–¥ï¸ å¼‚æ­¥æœåŠ¡å™¨å¼€å‘


### 8.1 ä½¿ç”¨aiohttpåˆ›å»ºWebæœåŠ¡å™¨


**ğŸ”¸ åŸºç¡€WebæœåŠ¡å™¨**
```python
from aiohttp import web
import json

async def hello_handler(request):
    """å¤„ç†Helloè¯·æ±‚"""
    name = request.query.get('name', 'World')
    return web.Response(text=f"Hello, {name}!")

async def json_handler(request):
    """è¿”å›JSONå“åº”"""
    data = {
        'message': 'è¿™æ˜¯å¼‚æ­¥æœåŠ¡å™¨',
        'timestamp': '2024-01-20',
        'status': 'success'
    }
    return web.json_response(data)

async def post_handler(request):
    """å¤„ç†POSTè¯·æ±‚"""
    try:
        # è§£æJSONæ•°æ®
        data = await request.json()
        
        # å¤„ç†æ•°æ®
        result = {
            'received': data,
            'processed': True,
            'length': len(str(data))
        }
        
        return web.json_response(result)
    
    except Exception as e:
        return web.json_response({'error': str(e)}, status=400)

def create_app():
    """åˆ›å»ºWebåº”ç”¨"""
    app = web.Application()
    
    # æ·»åŠ è·¯ç”±
    app.router.add_get('/', hello_handler)
    app.router.add_get('/hello', hello_handler)
    app.router.add_get('/api/data', json_handler)
    app.router.add_post('/api/submit', post_handler)
    
    return app

async def start_web_server():
    """å¯åŠ¨WebæœåŠ¡å™¨"""
    app = create_app()
    
    # å¯åŠ¨æœåŠ¡å™¨
    runner = web.AppRunner(app)
    await runner.setup()
    
    site = web.TCPSite(runner, 'localhost', 8080)
    await site.start()
    
    print("WebæœåŠ¡å™¨å¯åŠ¨åœ¨ http://localhost:8080")
    print("è®¿é—®:")
    print("  http://localhost:8080/hello?name=å¼ ä¸‰")
    print("  http://localhost:8080/api/data")
    
    # ä¿æŒæœåŠ¡å™¨è¿è¡Œ
    try:
        await asyncio.sleep(3600)  # è¿è¡Œ1å°æ—¶
    finally:
        await runner.cleanup()

asyncio.run(start_web_server())
```

### 8.2 WebSocketå¼‚æ­¥æœåŠ¡å™¨


**ğŸ”¸ åˆ›å»ºWebSocketæœåŠ¡å™¨**
```python
from aiohttp import web, WSMsgType
import weakref

# ä¿å­˜æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯
connected_clients = weakref.WeakSet()

async def websocket_handler(request):
    """WebSocketè¿æ¥å¤„ç†å™¨"""
    ws = web.WebSocketResponse()
    await ws.prepare(request)
    
    # æ·»åŠ åˆ°å®¢æˆ·ç«¯åˆ—è¡¨
    connected_clients.add(ws)
    print(f"å®¢æˆ·ç«¯å·²è¿æ¥ï¼Œå½“å‰è¿æ¥æ•°: {len(connected_clients)}")
    
    try:
        async for msg in ws:
            if msg.type == WSMsgType.TEXT:
                data = msg.json()
                print(f"æ”¶åˆ°æ¶ˆæ¯: {data}")
                
                # å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯
                response = {
                    'type': 'broadcast',
                    'message': data.get('message', ''),
                    'sender': data.get('sender', 'Anonymous'),
                    'timestamp': '2024-01-20 10:30:00'
                }
                
                # å‘é€ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯
                for client in connected_clients.copy():
                    try:
                        await client.send_str(json.dumps(response))
                    except Exception:
                        # å®¢æˆ·ç«¯å¯èƒ½å·²æ–­å¼€
                        pass
            
            elif msg.type == WSMsgType.ERROR:
                print(f"WebSocketé”™è¯¯: {ws.exception()}")
                break
    
    except Exception as e:
        print(f"WebSocketå¤„ç†å¼‚å¸¸: {e}")
    
    finally:
        print(f"å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œå½“å‰è¿æ¥æ•°: {len(connected_clients)}")
    
    return ws

def create_websocket_app():
    """åˆ›å»ºWebSocketåº”ç”¨"""
    app = web.Application()
    
    # WebSocketè·¯ç”±
    app.router.add_get('/ws', websocket_handler)
    
    # é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆå¯é€‰ï¼‰
    app.router.add_static('/', path='static', name='static')
    
    return app

# HTMLå®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆä¿å­˜ä¸ºstatic/index.htmlï¼‰
html_client = """
<!DOCTYPE html>
<html>
<head>
    <title>WebSocketæµ‹è¯•</title>
</head>
<body>
    <div>
        <input type="text" id="nameInput" placeholder="ä½ çš„åå­—" />
        <input type="text" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯" />
        <button onclick="sendMessage()">å‘é€</button>
    </div>
    <div id="messages"></div>
    
    <script>
        const ws = new WebSocket('ws://localhost:8080/ws');
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            const messages = document.getElementById('messages');
            messages.innerHTML += '<p>' + data.sender + ': ' + data.message + '</p>';
        };
        
        function sendMessage() {
            const name = document.getElementById('nameInput').value || 'Anonymous';
            const message = document.getElementById('messageInput').value;
            
            if (message) {
                ws.send(JSON.stringify({
                    sender: name,
                    message: message
                }));
                document.getElementById('messageInput').value = '';
            }
        }
    </script>
</body>
</html>
"""

async def start_websocket_server():
    """å¯åŠ¨WebSocketæœåŠ¡å™¨"""
    app = create_websocket_app()
    
    runner = web.AppRunner(app)
    await runner.setup()
    
    site = web.TCPSite(runner, 'localhost', 8080)
    await site.start()
    
    print("WebSocketæœåŠ¡å™¨å¯åŠ¨åœ¨ ws://localhost:8080/ws")
    
    try:
        await asyncio.sleep(3600)
    finally:
        await runner.cleanup()

# asyncio.run(start_websocket_server())
```

---

## 9. ğŸ¯ å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ


### 9.1 é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ç®¡ç†


**ğŸ”¸ æ­£ç¡®çš„å¼‚å¸¸å¤„ç†æ–¹å¼**
```python
import asyncio
import aiohttp
import logging

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

async def robust_http_request(url, max_retries=3):
    """å¥å£®çš„HTTPè¯·æ±‚å®ç°"""
    
    for attempt in range(max_retries):
        try:
            timeout = aiohttp.ClientTimeout(total=10)  # 10ç§’è¶…æ—¶
            
            async with aiohttp.ClientSession(timeout=timeout) as session:
                async with session.get(url) as response:
                    if response.status == 200:
                        content = await response.text()
                        logger.info(f"âœ… è¯·æ±‚æˆåŠŸ: {url}")
                        return content
                    else:
                        logger.warning(f"âš ï¸ HTTPé”™è¯¯ {response.status}: {url}")
                        
        except asyncio.TimeoutError:
            logger.warning(f"â° è¯·æ±‚è¶…æ—¶ (å°è¯• {attempt + 1}/{max_retries}): {url}")
        except aiohttp.ClientError as e:
            logger.warning(f"ğŸŒ ç½‘ç»œé”™è¯¯ (å°è¯• {attempt + 1}/{max_retries}): {e}")
        except Exception as e:
            logger.error(f"âŒ æœªçŸ¥é”™è¯¯ (å°è¯• {attempt + 1}/{max_retries}): {e}")
        
        if attempt < max_retries - 1:
            await asyncio.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
    
    logger.error(f"âŒ æ‰€æœ‰å°è¯•å¤±è´¥: {url}")
    return None

async def error_handling_example():
    """é”™è¯¯å¤„ç†ç¤ºä¾‹"""
    urls = [
        "https://httpbin.org/get",
        "https://httpbin.org/status/500",  # ä¼šè¿”å›500é”™è¯¯
        "https://invalid-url-that-does-not-exist.com",  # æ— æ•ˆURL
    ]
    
    tasks = [robust_http_request(url) for url in urls]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    
    for url, result in zip(urls, results):
        if isinstance(result, Exception):
            print(f"âŒ {url}: {result}")
        elif result:
            print(f"âœ… {url}: æˆåŠŸ ({len(result)} å­—ç¬¦)")
        else:
            print(f"âŒ {url}: å¤±è´¥")

asyncio.run(error_handling_example())
```

### 9.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ è¿æ¥æ± å’Œä¼šè¯ç®¡ç†**
```python
class HTTPClient:
    """ä¼˜åŒ–çš„HTTPå®¢æˆ·ç«¯ç±»"""
    
    def __init__(self, max_connections=100, timeout=30):
        self.timeout = aiohttp.ClientTimeout(total=timeout)
        self.connector = aiohttp.TCPConnector(
            limit=max_connections,        # æœ€å¤§è¿æ¥æ•°
            limit_per_host=20,           # æ¯ä¸ªä¸»æœºæœ€å¤§è¿æ¥æ•°
            enable_cleanup_closed=True    # å¯ç”¨è¿æ¥æ¸…ç†
        )
        self.session = None
    
    async def __aenter__(self):
        """å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å…¥å£"""
        self.session = aiohttp.ClientSession(
            connector=self.connector,
            timeout=self.timeout
        )
        return self
    
    async def __aexit__(self, exc_type, exc_val, exc_tb):
        """å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡ºå£"""
        if self.session:
            await self.session.close()
    
    async def get(self, url, **kwargs):
        """GETè¯·æ±‚"""
        async with self.session.get(url, **kwargs) as response:
            return await response.text()
    
    async def post(self, url, **kwargs):
        """POSTè¯·æ±‚"""
        async with self.session.post(url, **kwargs) as response:
            return await response.json()

# ä½¿ç”¨ç¤ºä¾‹
async def optimized_requests():
    """ä¼˜åŒ–çš„å¹¶å‘è¯·æ±‚ç¤ºä¾‹"""
    urls = [f"https://httpbin.org/delay/{i}" for i in range(1, 6)]
    
    async with HTTPClient() as client:
        # é™åˆ¶å¹¶å‘æ•°é‡
        semaphore = asyncio.Semaphore(3)  # æœ€å¤šåŒæ—¶3ä¸ªè¯·æ±‚
        
        async def fetch_with_limit(url):
            async with semaphore:
                try:
                    result = await client.get(url)
                    return f"âœ… {url}: æˆåŠŸ"
                except Exception as e:
                    return f"âŒ {url}: {e}"
        
        results = await asyncio.gather(
            *[fetch_with_limit(url) for url in urls]
        )
        
        for result in results:
            print(result)

asyncio.run(optimized_requests())
```

### 9.3 èµ„æºç®¡ç†å’Œæ¸…ç†


**ğŸ”¸ æ­£ç¡®çš„èµ„æºç®¡ç†**
```python
import contextlib
import signal
import sys

class AsyncResourceManager:
    """å¼‚æ­¥èµ„æºç®¡ç†å™¨"""
    
    def __init__(self):
        self.resources = []
        self.cleanup_tasks = []
    
    async def add_resource(self, resource, cleanup_func=None):
        """æ·»åŠ éœ€è¦ç®¡ç†çš„èµ„æº"""
        self.resources.append(resource)
        if cleanup_func:
            self.cleanup_tasks.append(cleanup_func)
    
    async def cleanup_all(self):
        """æ¸…ç†æ‰€æœ‰èµ„æº"""
        print("ğŸ§¹ å¼€å§‹æ¸…ç†èµ„æº...")
        
        for task in self.cleanup_tasks:
            try:
                if asyncio.iscoroutinefunction(task):
                    await task()
                else:
                    task()
                print(f"âœ… èµ„æºæ¸…ç†å®Œæˆ: {task.__name__}")
            except Exception as e:
                print(f"âŒ èµ„æºæ¸…ç†å¤±è´¥: {e}")
        
        print("ğŸ§¹ æ‰€æœ‰èµ„æºæ¸…ç†å®Œæˆ")

# å…¨å±€èµ„æºç®¡ç†å™¨
resource_manager = AsyncResourceManager()

async def setup_signal_handlers():
    """è®¾ç½®ä¿¡å·å¤„ç†å™¨"""
    def signal_handler(signum, frame):
        print(f"\nğŸ“¡ æ”¶åˆ°ä¿¡å· {signum}ï¼Œå‡†å¤‡ä¼˜é›…å…³é—­...")
        asyncio.create_task(resource_manager.cleanup_all())
        sys.exit(0)
    
    signal.signal(signal.SIGINT, signal_handler)   # Ctrl+C
    signal.signal(signal.SIGTERM, signal_handler)  # ç»ˆæ­¢ä¿¡å·

async def resource_management_example():
    """èµ„æºç®¡ç†ç¤ºä¾‹"""
    await setup_signal_handlers()
    
    # åˆ›å»ºéœ€è¦æ¸…ç†çš„èµ„æº
    async def setup_database():
        print("ğŸ—„ï¸ è®¾ç½®æ•°æ®åº“è¿æ¥")
        # æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥
        return "db_connection"
    
    async def cleanup_database():
        print("ğŸ—„ï¸ å…³é—­æ•°æ®åº“è¿æ¥")
        await asyncio.sleep(0.1)  # æ¨¡æ‹Ÿæ¸…ç†æ—¶é—´
    
    async def setup_server():
        print("ğŸ–¥ï¸ å¯åŠ¨æœåŠ¡å™¨")
        return "server_instance"
    
    async def cleanup_server():
        print("ğŸ–¥ï¸ å…³é—­æœåŠ¡å™¨")
        await asyncio.sleep(0.1)
    
    # è®¾ç½®èµ„æº
    db = await setup_database()
    await resource_manager.add_resource(db, cleanup_database)
    
    server = await setup_server()
    await resource_manager.add_resource(server, cleanup_server)
    
    try:
        print("ğŸš€ åº”ç”¨å¯åŠ¨å®Œæˆï¼ŒæŒ‰ Ctrl+C é€€å‡º")
        # æ¨¡æ‹Ÿåº”ç”¨è¿è¡Œ
        while True:
            await asyncio.sleep(1)
            print("ğŸ’“ åº”ç”¨è¿è¡Œä¸­...")
    
    except KeyboardInterrupt:
        print("\nâ¹ï¸ æ”¶åˆ°ä¸­æ–­ä¿¡å·")
    finally:
        await resource_manager.cleanup_all()

# asyncio.run(resource_management_example())
```

### 9.4 ç›‘æ§å’Œè°ƒè¯•æŠ€å·§


**ğŸ”¸ å¼‚æ­¥ç¨‹åºè°ƒè¯•å·¥å…·**
```python
import time
from functools import wraps

def async_timer(func):
    """å¼‚æ­¥å‡½æ•°æ‰§è¡Œæ—¶é—´è£…é¥°å™¨"""
    @wraps(func)
    async def wrapper(*args, **kwargs):
        start_time = time.time()
        try:
            result = await func(*args, **kwargs)
            return result
        finally:
            end_time = time.time()
            print(f"â±ï¸ {func.__name__} æ‰§è¡Œæ—¶é—´: {end_time - start_time:.2f}ç§’")
    return wrapper

def monitor_tasks():
    """ç›‘æ§å½“å‰è¿è¡Œçš„ä»»åŠ¡"""
    tasks = asyncio.all_tasks()
    print(f"ğŸ“Š å½“å‰è¿è¡Œä»»åŠ¡æ•°: {len(tasks)}")
    
    for i, task in enumerate(tasks, 1):
        print(f"  ä»»åŠ¡{i}: {task.get_name()} - {task.get_coro()}")

@async_timer
async def monitored_function():
    """è¢«ç›‘æ§çš„å¼‚æ­¥å‡½æ•°"""
    print("å¼€å§‹æ‰§è¡Œè€—æ—¶æ“ä½œ...")
    await asyncio.sleep(2)
    print("è€—æ—¶æ“ä½œå®Œæˆ")
    return "ç»“æœ"

async def monitoring_example():
    """ç›‘æ§ç¤ºä¾‹"""
    print("ğŸ” å¼‚æ­¥ç¨‹åºç›‘æ§ç¤ºä¾‹")
    
    # åˆ›å»ºä¸€äº›ä»»åŠ¡
    task1 = asyncio.create_task(monitored_function(), name="ä»»åŠ¡1")
    task2 = asyncio.create_task(asyncio.sleep(3), name="ä¼‘çœ ä»»åŠ¡")
    
    # ç›‘æ§ä»»åŠ¡çŠ¶æ€
    monitor_tasks()
    
    # ç­‰å¾…ä»»åŠ¡å®Œæˆ
    result = await task1
    print(f"ä»»åŠ¡1ç»“æœ: {result}")
    
    await task2
    print("æ‰€æœ‰ä»»åŠ¡å®Œæˆ")

asyncio.run(monitoring_example())
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å¼‚æ­¥I/Oæœ¬è´¨ï¼šéé˜»å¡çš„è¾“å…¥è¾“å‡ºæ“ä½œï¼Œè®©ç¨‹åºä¸ç”¨å‚»ç­‰
ğŸ”¸ äº‹ä»¶å¾ªç¯ï¼šasyncioçš„æ ¸å¿ƒï¼Œç®¡ç†å’Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡
ğŸ”¸ åç¨‹å‡½æ•°ï¼šç”¨async defå®šä¹‰ï¼Œç”¨awaitè°ƒç”¨çš„ç‰¹æ®Šå‡½æ•°
ğŸ”¸ å¹¶å‘æ‰§è¡Œï¼šç”¨asyncio.gather()åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡
ğŸ”¸ å¼‚æ­¥ä¸Šä¸‹æ–‡ï¼šç”¨async withç®¡ç†èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ
```

### 10.2 å„æ¨¡å—æ ¸å¿ƒè¦ç‚¹


**ğŸ”¹ å¼‚æ­¥æ–‡ä»¶æ“ä½œ**
```
å…³é”®åº“ï¼šaiofiles
æ ¸å¿ƒæ–¹æ³•ï¼šasync with aiofiles.open()
åº”ç”¨åœºæ™¯ï¼šå¤§æ–‡ä»¶å¤„ç†ã€æ‰¹é‡æ–‡ä»¶æ“ä½œ
æ³¨æ„äº‹é¡¹ï¼šåˆ†å—è¯»å–é¿å…å†…å­˜æº¢å‡º
```

**ğŸ”¹ å¼‚æ­¥ç½‘ç»œç¼–ç¨‹**
```
TCPç¼–ç¨‹ï¼šasyncio.start_server() / asyncio.open_connection()
UDPç¼–ç¨‹ï¼šcreate_datagram_endpoint()
HTTPå®¢æˆ·ç«¯ï¼šaiohttp.ClientSession()
ä¼˜åŠ¿ï¼šåŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¤§å¹…æå‡æ•ˆç‡
```

**ğŸ”¹ å¼‚æ­¥æ•°æ®åº“æ“ä½œ**
```
SQLiteï¼šaiosqlite
MySQLï¼šaiomysql + è¿æ¥æ± 
ORMï¼šTortoise ORMï¼ˆç±»ä¼¼Django ORMçš„å¼‚æ­¥ç‰ˆæœ¬ï¼‰
æœ€ä½³å®è·µï¼šä½¿ç”¨è¿æ¥æ± ï¼Œæ­£ç¡®å¤„ç†äº‹åŠ¡
```

**ğŸ”¹ å¼‚æ­¥æµå¤„ç†**
```
åŸºç¡€æµï¼šasyncioçš„StreamReader/StreamWriter
é«˜çº§æµï¼šaiostreamåº“
åº”ç”¨ï¼šå¤§æ•°æ®å¤„ç†ã€å®æ—¶æ•°æ®æµ
ä¼˜åŠ¿ï¼šå†…å­˜æ•ˆç‡é«˜ï¼Œå®æ—¶æ€§å¥½
```

**ğŸ”¹ æœåŠ¡å™¨å¼€å‘**
```
WebæœåŠ¡å™¨ï¼šaiohttp.web
WebSocketï¼šæ”¯æŒå®æ—¶åŒå‘é€šä¿¡
åè®®å¼€å‘ï¼šè‡ªå®šä¹‰Protocolç±»
ç‰¹ç‚¹ï¼šé«˜å¹¶å‘ã€ä½èµ„æºæ¶ˆè€—
```

### 10.3 å®æˆ˜åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¼‚æ­¥I/O**
```
âœ… é€‚ç”¨åœºæ™¯ï¼š
- ç½‘ç»œè¯·æ±‚å¯†é›†çš„åº”ç”¨
- éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥
- I/Oæ“ä½œé¢‘ç¹çš„ç¨‹åº
- å®æ—¶æ€§è¦æ±‚é«˜çš„åº”ç”¨

âŒ ä¸é€‚ç”¨åœºæ™¯ï¼š
- CPUå¯†é›†å‹è®¡ç®—ï¼ˆç”¨å¤šè¿›ç¨‹ï¼‰
- ç®€å•çš„è„šæœ¬ç¨‹åº
- å­¦ä¹ æˆæœ¬è€ƒè™‘ï¼ˆåŒæ­¥ç‰ˆæœ¬è¶³å¤Ÿï¼‰
```

**ğŸ”§ æœ€ä½³å®è·µæ€»ç»“**
```
èµ„æºç®¡ç†ï¼š
- ä½¿ç”¨async withç®¡ç†è¿æ¥å’Œæ–‡ä»¶
- æ­£ç¡®è®¾ç½®è¶…æ—¶æ—¶é—´
- å®ç°ä¼˜é›…çš„èµ„æºæ¸…ç†

é”™è¯¯å¤„ç†ï¼š
- ç”¨try-exceptåŒ…è£…å¼‚æ­¥æ“ä½œ
- å®ç°é‡è¯•æœºåˆ¶
- è®°å½•è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯

æ€§èƒ½ä¼˜åŒ–ï¼š
- ä½¿ç”¨è¿æ¥æ± å¤ç”¨è¿æ¥
- é™åˆ¶å¹¶å‘æ•°é‡é¿å…èµ„æºè€—å°½  
- é€‰æ‹©åˆé€‚çš„äº‹ä»¶å¾ªç¯å®ç°

ä»£ç ç»„ç»‡ï¼š
- å°†å¼‚æ­¥é€»è¾‘å°è£…åˆ°ç±»ä¸­
- ä½¿ç”¨ç±»å‹æ³¨è§£æé«˜ä»£ç å¯è¯»æ€§
- ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯å¼‚æ­¥é€»è¾‘
```

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å¾ªåºæ¸è¿›çš„å­¦ä¹ é¡ºåº**
```
ç¬¬ä¸€é˜¶æ®µ - åŸºç¡€æ¦‚å¿µï¼š
1. ç†è§£åŒæ­¥ vs å¼‚æ­¥çš„åŒºåˆ«
2. æŒæ¡ async/await è¯­æ³•
3. å­¦ä¼šä½¿ç”¨ asyncio.run() å’Œ asyncio.gather()

ç¬¬äºŒé˜¶æ®µ - å¸¸ç”¨æ“ä½œï¼š
1. å¼‚æ­¥æ–‡ä»¶æ“ä½œï¼ˆaiofilesï¼‰
2. å¼‚æ­¥HTTPè¯·æ±‚ï¼ˆaiohttpï¼‰
3. åŸºç¡€é”™è¯¯å¤„ç†å’Œè¶…æ—¶æ§åˆ¶

ç¬¬ä¸‰é˜¶æ®µ - è¿›é˜¶åº”ç”¨ï¼š
1. å¼‚æ­¥æ•°æ®åº“æ“ä½œ
2. è‡ªå®šä¹‰å¼‚æ­¥æœåŠ¡å™¨
3. å¤æ‚çš„å¹¶å‘æ§åˆ¶

ç¬¬å››é˜¶æ®µ - ç”Ÿäº§ç¯å¢ƒï¼š
1. æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
2. é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. éƒ¨ç½²å’Œè¿ç»´è€ƒè™‘
```

**ğŸ¯ å®è·µé¡¹ç›®å»ºè®®**
```
åˆçº§é¡¹ç›®ï¼š
- å¼‚æ­¥æ–‡ä»¶æ‰¹å¤„ç†å·¥å…·
- å¤šURLå¹¶å‘ä¸‹è½½å™¨
- ç®€å•çš„å¼‚æ­¥èŠå¤©æœåŠ¡å™¨

ä¸­çº§é¡¹ç›®ï¼š
- å¼‚æ­¥Webçˆ¬è™«
- REST APIæœåŠ¡å™¨
- å¼‚æ­¥æ•°æ®åŒæ­¥å·¥å…·

é«˜çº§é¡¹ç›®ï¼š
- é«˜å¹¶å‘æ¸¸æˆæœåŠ¡å™¨
- å®æ—¶æ•°æ®å¤„ç†å¹³å°
- å¾®æœåŠ¡æ¶æ„åº”ç”¨
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¼‚æ­¥ç¼–ç¨‹ä¸ç”¨ç­‰ï¼Œasync awaitæ˜¯å…³é”®
gatherè®©ä»»åŠ¡é½å¹¶å‘ï¼Œaiohttpç½‘ç»œå¿«å¦‚ç”µ
æ–‡ä»¶æ•°æ®åº“å’Œæµå¤„ç†ï¼Œaiofiles motorè¦è®°ç‰¢
é”™è¯¯å¤„ç†å’Œèµ„æºç®¡ç†ï¼Œä¼˜é›…ç¼–ç¨‹è´¨é‡é«˜
```

**âš ï¸ å¸¸è§é™·é˜±æé†’**
```
1. å¿˜è®°ä½¿ç”¨awaitï¼šasyncå‡½æ•°å¿…é¡»ç”¨awaitè°ƒç”¨
2. é˜»å¡æ“ä½œï¼šåœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨time.sleep()è€Œä¸æ˜¯asyncio.sleep()
3. èµ„æºæ³„æ¼ï¼šå¿˜è®°å…³é—­è¿æ¥ã€æ–‡ä»¶æˆ–ä¼šè¯
4. å¼‚å¸¸å¤„ç†ï¼šæ²¡æœ‰æ­£ç¡®å¤„ç†å¼‚æ­¥æ“ä½œä¸­çš„å¼‚å¸¸
5. è°ƒè¯•å›°éš¾ï¼šå¼‚æ­¥ç¨‹åºçš„è°ƒè¯•æ¯”åŒæ­¥ç¨‹åºå¤æ‚
```