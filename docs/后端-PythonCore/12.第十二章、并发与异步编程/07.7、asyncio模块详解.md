---
title: 7ã€asyncioæ¨¡å—è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µ](#1-å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µ)
2. [asyncioæ¨¡å—è¯¦è§£](#2-asyncioæ¨¡å—è¯¦è§£)
3. [äº‹ä»¶å¾ªç¯ç®¡ç†](#3-äº‹ä»¶å¾ªç¯ç®¡ç†)
4. [åç¨‹åˆ›å»ºä¸è¿è¡Œ](#4-åç¨‹åˆ›å»ºä¸è¿è¡Œ)
5. [Taskä»»åŠ¡ç®¡ç†](#5-Taskä»»åŠ¡ç®¡ç†)
6. [Futureå¯¹è±¡æœºåˆ¶](#6-Futureå¯¹è±¡æœºåˆ¶)
7. [å¼‚æ­¥å‡½æ•°è°ƒç”¨](#7-å¼‚æ­¥å‡½æ•°è°ƒç”¨)
8. [å¹¶å‘æ‰§è¡Œæ§åˆ¶](#8-å¹¶å‘æ‰§è¡Œæ§åˆ¶)
9. [å¼‚æ­¥å¼‚å¸¸å¤„ç†](#9-å¼‚æ­¥å¼‚å¸¸å¤„ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹


**ğŸ”¸ é€šä¿—ç†è§£**

æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼š

```
åŒæ­¥æ–¹å¼ï¼ˆä¼ ç»Ÿç¼–ç¨‹ï¼‰ï¼š
ä½ ç‚¹é¤ â†’ ç­‰å¨å¸ˆåšå®Œ â†’ æ‹¿åˆ°èœ â†’ åƒé¥­
æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ åªèƒ½å¹²ç­‰ç€ï¼Œä»€ä¹ˆéƒ½ä¸èƒ½åš

å¼‚æ­¥æ–¹å¼ï¼ˆå¼‚æ­¥ç¼–ç¨‹ï¼‰ï¼š
ä½ ç‚¹é¤ â†’ æ‹¿å·ç ç‰Œ â†’ å»åšå…¶ä»–äº‹ï¼ˆç©æ‰‹æœºã€èŠå¤©ï¼‰
å¨å¸ˆåšå¥½äº†å«å· â†’ ä½ å»å–é¤ â†’ åƒé¥­
```

**ğŸ¯ å¼‚æ­¥ç¼–ç¨‹çš„æœ¬è´¨**

å¼‚æ­¥ç¼–ç¨‹è®©ç¨‹åºåœ¨ç­‰å¾…æŸä¸ªè€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚æ–‡ä»¶è¯»å–ã€ç½‘ç»œè¯·æ±‚ï¼‰æ—¶ï¼Œä¸è¦å‚»ç­‰ç€ï¼Œè€Œæ˜¯å»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚å½“è€—æ—¶æ“ä½œå®Œæˆåï¼Œç¨‹åºå†å›æ¥å¤„ç†ç»“æœã€‚

> **ğŸ’¡ å…³é”®ç†è§£**ï¼šå¼‚æ­¥ç¼–ç¨‹ä¸æ˜¯è®©ç¨‹åºè·‘å¾—æ›´å¿«ï¼Œè€Œæ˜¯è®©ç¨‹åºåœ¨ç­‰å¾…æ—¶èƒ½åšæ›´å¤šäº‹æƒ…ï¼Œæé«˜æ•´ä½“æ•ˆç‡ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ç¼–ç¨‹


**âš¡ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

| **åœºæ™¯** | **åŒæ­¥é—®é¢˜** | **å¼‚æ­¥ä¼˜åŠ¿** |
|---------|-------------|-------------|
| **ç½‘ç»œè¯·æ±‚** | `å‘ä¸€ä¸ªè¯·æ±‚ç­‰10ç§’ï¼Œç¨‹åºå¡æ­»` | `å‘å¤šä¸ªè¯·æ±‚åŒæ—¶ç­‰å¾…ï¼Œæ•ˆç‡æå‡` |
| **æ–‡ä»¶æ“ä½œ** | `è¯»å¤§æ–‡ä»¶æ—¶ç¨‹åºæ— å“åº”` | `è¯»æ–‡ä»¶æ—¶å¯ä»¥å¤„ç†ç”¨æˆ·æ“ä½œ` |
| **æ•°æ®åº“æŸ¥è¯¢** | `æŸ¥è¯¢æœŸé—´ç•Œé¢å¡é¡¿` | `æŸ¥è¯¢åŒæ—¶ä¿æŒç•Œé¢å“åº”` |
| **WebæœåŠ¡å™¨** | `ä¸€ä¸ªç”¨æˆ·æ…¢ï¼Œå½±å“æ‰€æœ‰ç”¨æˆ·` | `å¤šç”¨æˆ·å¹¶å‘å¤„ç†ï¼Œäº’ä¸å½±å“` |

### 1.3 å¼‚æ­¥ç¼–ç¨‹çš„å¸¸è§è¯¯åŒº


```
âŒ è¯¯åŒº1ï¼šå¼‚æ­¥ç¼–ç¨‹è®©ä»£ç è¿è¡Œæ›´å¿«
âœ… æ­£ç¡®ï¼šå¼‚æ­¥ç¼–ç¨‹è®©ç­‰å¾…æ›´é«˜æ•ˆï¼Œæ•´ä½“ååé‡æ›´å¤§

âŒ è¯¯åŒº2ï¼šå¼‚æ­¥ç¼–ç¨‹é€‚ç”¨äºæ‰€æœ‰åœºæ™¯  
âœ… æ­£ç¡®ï¼šä¸»è¦é€‚ç”¨äºI/Oå¯†é›†å‹ä»»åŠ¡ï¼ˆç½‘ç»œã€æ–‡ä»¶ã€æ•°æ®åº“ï¼‰

âŒ è¯¯åŒº3ï¼šå¼‚æ­¥ç¼–ç¨‹å¾ˆå¤æ‚ï¼Œæ–°æ‰‹ä¸èƒ½å­¦
âœ… æ­£ç¡®ï¼šæ¦‚å¿µç†è§£åï¼Œä½¿ç”¨èµ·æ¥å¾ˆç›´è§‚
```

---

## 2. ğŸ asyncioæ¨¡å—è¯¦è§£


### 2.1 asyncioæ˜¯ä»€ä¹ˆ


**ğŸ”¸ ç®€å•å®šä¹‰**

`asyncio`æ˜¯Pythonå†…ç½®çš„å¼‚æ­¥ç¼–ç¨‹åº“ï¼Œæä¾›äº†ç¼–å†™å¼‚æ­¥ç¨‹åºçš„å·¥å…·å’Œæ¡†æ¶ã€‚å°±åƒæ˜¯Pythonç»™ä½ çš„ä¸€ä¸ª"å¼‚æ­¥å·¥å…·ç®±"ã€‚

```
asyncio = async + io
asyncï¼šå¼‚æ­¥çš„
ioï¼šè¾“å…¥è¾“å‡ºæ“ä½œ
```

**ğŸ”§ asyncioçš„æ ¸å¿ƒç»„ä»¶**

```
asyncioå·¥å…·ç®±åŒ…å«ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                asyncio                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   äº‹ä»¶å¾ªç¯   â”‚    åç¨‹     â”‚    ä»»åŠ¡     â”‚
â”‚ Event Loop  â”‚  Coroutine  â”‚    Task     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Future    â”‚   å¼‚æ­¥å‡½æ•°   â”‚   å¹¶å‘æ§åˆ¶   â”‚
â”‚   å¯¹è±¡      â”‚  async/await â”‚  gatherç­‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç¬¬ä¸€ä¸ªå¼‚æ­¥ç¨‹åº


**ğŸš€ æœ€ç®€å•çš„ä¾‹å­**

```python
import asyncio

async def say_hello():
    print("Hello")
    await asyncio.sleep(1)  # å¼‚æ­¥ç­‰å¾…1ç§’
    print("World")

# è¿è¡Œå¼‚æ­¥å‡½æ•°
asyncio.run(say_hello())
```

**ğŸ” ä»£ç è§£æ**

- `async def`ï¼šå®šä¹‰å¼‚æ­¥å‡½æ•°ï¼ˆåç¨‹å‡½æ•°ï¼‰
- `await`ï¼šç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼Œä½†ä¸é˜»å¡ç¨‹åº
- `asyncio.run()`ï¼šè¿è¡Œå¼‚æ­¥å‡½æ•°çš„å…¥å£
- `asyncio.sleep(1)`ï¼šå¼‚æ­¥ç‰ˆæœ¬çš„ç¡çœ ï¼Œä¸ä¼šé˜»å¡

### 2.3 åŒæ­¥vså¼‚æ­¥å¯¹æ¯”


**ğŸ“Š å®é™…å¯¹æ¯”ç¤ºä¾‹**

```python
import time
import asyncio

# åŒæ­¥ç‰ˆæœ¬ - ä¸²è¡Œæ‰§è¡Œ
def sync_version():
    print("åŒæ­¥ç‰ˆæœ¬å¼€å§‹")
    start = time.time()
    
    time.sleep(2)  # æ¨¡æ‹Ÿç¬¬ä¸€ä¸ªä»»åŠ¡
    print("ä»»åŠ¡1å®Œæˆ")
    
    time.sleep(2)  # æ¨¡æ‹Ÿç¬¬äºŒä¸ªä»»åŠ¡  
    print("ä»»åŠ¡2å®Œæˆ")
    
    print(f"æ€»è€—æ—¶: {time.time() - start:.1f}ç§’")

# å¼‚æ­¥ç‰ˆæœ¬ - å¹¶å‘æ‰§è¡Œ
async def async_version():
    print("å¼‚æ­¥ç‰ˆæœ¬å¼€å§‹")
    start = time.time()
    
    # åŒæ—¶å¯åŠ¨ä¸¤ä¸ªä»»åŠ¡
    task1 = asyncio.create_task(async_task("ä»»åŠ¡1", 2))
    task2 = asyncio.create_task(async_task("ä»»åŠ¡2", 2))
    
    await task1
    await task2
    
    print(f"æ€»è€—æ—¶: {time.time() - start:.1f}ç§’")

async def async_task(name, delay):
    await asyncio.sleep(delay)
    print(f"{name}å®Œæˆ")

# è¿è¡Œå¯¹æ¯”
sync_version()        # è¾“å‡ºï¼šæ€»è€—æ—¶: 4.0ç§’
asyncio.run(async_version())  # è¾“å‡ºï¼šæ€»è€—æ—¶: 2.0ç§’
```

---

## 3. ğŸ”„ äº‹ä»¶å¾ªç¯ç®¡ç†


### 3.1 ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯


**ğŸ¡ ç”Ÿæ´»ä¸­çš„äº‹ä»¶å¾ªç¯**

æƒ³è±¡ä¸€ä¸ªæ¸¸ä¹å›­çš„æ—‹è½¬æœ¨é©¬ï¼š

```
äº‹ä»¶å¾ªç¯å°±åƒæ—‹è½¬æœ¨é©¬çš„æ§åˆ¶ç³»ç»Ÿï¼š
1. ä¸æ–­æ—‹è½¬ï¼ˆå¾ªç¯è¿è¡Œï¼‰
2. æ¯è½¬ä¸€åœˆæ£€æŸ¥æœ‰æ²¡æœ‰æ–°ä¹˜å®¢ï¼ˆæ–°ä»»åŠ¡ï¼‰
3. è®©ä¹˜å®¢ä¸Šé©¬ï¼ˆæ‰§è¡Œä»»åŠ¡ï¼‰
4. ç»§ç»­æ—‹è½¬ï¼Œå¤„ç†ä¸‹ä¸€æ‰¹ä¹˜å®¢

äº‹ä»¶å¾ªç¯ = ä¸€ä¸ªæ°¸ä¸åœæ­‡çš„ä»»åŠ¡è°ƒåº¦å™¨
```

**âš™ï¸ äº‹ä»¶å¾ªç¯çš„å·¥ä½œåŸç†**

```
äº‹ä»¶å¾ªç¯å·¥ä½œæµç¨‹ï¼š

å¼€å§‹ â†’ æ£€æŸ¥å¾…æ‰§è¡Œä»»åŠ¡ â†’ æ‰§è¡Œå°±ç»ªä»»åŠ¡ â†’ ç­‰å¾…I/Oæ“ä½œ
 â†‘                                            â†“
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å›åˆ°å¼€å§‹ â†â”€â”€â”€â”€â”€â”€â”€ I/Oæ“ä½œå®Œæˆ â†â”€â”€â”€â”€â”€â”˜
```

### 3.2 äº‹ä»¶å¾ªç¯çš„åŸºæœ¬ä½¿ç”¨


**ğŸ”§ å¸¸ç”¨æ–¹æ³•**

```python
import asyncio

# æ–¹æ³•1ï¼šç®€å•è¿è¡Œï¼ˆæ¨èæ–°æ‰‹ä½¿ç”¨ï¼‰
async def main():
    print("Hello World")

asyncio.run(main())  # Python 3.7+æ¨èæ–¹å¼

# æ–¹æ³•2ï¼šæ‰‹åŠ¨ç®¡ç†äº‹ä»¶å¾ªç¯ï¼ˆäº†è§£å³å¯ï¼‰
loop = asyncio.get_event_loop()
loop.run_until_complete(main())
loop.close()
```

### 3.3 äº‹ä»¶å¾ªç¯çš„å®é™…åº”ç”¨


**ğŸŒ Webçˆ¬è™«ç¤ºä¾‹**

```python
import asyncio
import aiohttp  # éœ€è¦å®‰è£…ï¼špip install aiohttp

async def fetch_url(session, url):
    """å¼‚æ­¥è·å–å•ä¸ªURLçš„å†…å®¹"""
    async with session.get(url) as response:
        return await response.text()

async def main():
    urls = [
        'http://httpbin.org/delay/1',
        'http://httpbin.org/delay/2', 
        'http://httpbin.org/delay/1'
    ]
    
    async with aiohttp.ClientSession() as session:
        # å¹¶å‘è·å–æ‰€æœ‰URL
        tasks = [fetch_url(session, url) for url in urls]
        results = await asyncio.gather(*tasks)
        
    print(f"è·å–äº† {len(results)} ä¸ªé¡µé¢")

# è¿™æ¯”åŒæ­¥ç‰ˆæœ¬å¿«å¾ˆå¤šå€
asyncio.run(main())
```

---

## 4. ğŸ› ï¸ åç¨‹åˆ›å»ºä¸è¿è¡Œ


### 4.1 ä»€ä¹ˆæ˜¯åç¨‹


**ğŸ”¸ åç¨‹çš„é€šä¿—è§£é‡Š**

åç¨‹ï¼ˆCoroutineï¼‰å°±åƒæ˜¯"å¯ä»¥æš‚åœå’Œæ¢å¤çš„å‡½æ•°"ï¼š

```
æ™®é€šå‡½æ•°ï¼š
å¼€å§‹ â†’ æ‰§è¡Œåˆ°åº• â†’ ç»“æŸ
ä¸€å£æ°”è·‘å®Œï¼Œä¸­é€”ä¸èƒ½åœ

åç¨‹å‡½æ•°ï¼š  
å¼€å§‹ â†’ æ‰§è¡Œä¸€éƒ¨åˆ† â†’ æš‚åœï¼ˆé‡åˆ°awaitï¼‰
     â†’ å»åšåˆ«çš„äº‹ â†’ å›æ¥ç»§ç»­æ‰§è¡Œ â†’ ç»“æŸ
å¯ä»¥ä¸­é€”æš‚åœï¼Œè®©å‡ºæ§åˆ¶æƒ
```

### 4.2 åç¨‹çš„åˆ›å»ºæ–¹å¼


**ğŸ“ åŸºæœ¬è¯­æ³•**

```python
import asyncio

# 1. å®šä¹‰åç¨‹å‡½æ•°
async def my_coroutine():
    print("åç¨‹å¼€å§‹æ‰§è¡Œ")
    await asyncio.sleep(1)
    print("åç¨‹æ‰§è¡Œå®Œæ¯•")
    return "å®Œæˆ"

# 2. åˆ›å»ºåç¨‹å¯¹è±¡ï¼ˆè¿˜æ²¡è¿è¡Œï¼‰
coro = my_coroutine()
print(type(coro))  # <class 'coroutine'>

# 3. è¿è¡Œåç¨‹
result = asyncio.run(coro)
print(result)  # è¾“å‡ºï¼šå®Œæˆ
```

### 4.3 åç¨‹çš„è¿è¡Œæ–¹å¼


**âš¡ ä¸‰ç§ä¸»è¦è¿è¡Œæ–¹å¼**

```python
import asyncio

async def example_task(name, delay):
    print(f"{name} å¼€å§‹")
    await asyncio.sleep(delay)
    print(f"{name} å®Œæˆ")
    return f"{name} ç»“æœ"

# æ–¹å¼1ï¼šç›´æ¥è¿è¡Œå•ä¸ªåç¨‹
async def run_one():
    result = await example_task("ä»»åŠ¡1", 2)
    print(result)

# æ–¹å¼2ï¼šå¹¶å‘è¿è¡Œå¤šä¸ªåç¨‹
async def run_concurrent():
    task1 = asyncio.create_task(example_task("ä»»åŠ¡1", 2))
    task2 = asyncio.create_task(example_task("ä»»åŠ¡2", 1))
    
    result1 = await task1
    result2 = await task2
    print(result1, result2)

# æ–¹å¼3ï¼šä½¿ç”¨gatheræ‰¹é‡è¿è¡Œ
async def run_gather():
    results = await asyncio.gather(
        example_task("ä»»åŠ¡1", 2),
        example_task("ä»»åŠ¡2", 1),
        example_task("ä»»åŠ¡3", 1.5)
    )
    print(results)

# è¿è¡Œç¤ºä¾‹
asyncio.run(run_concurrent())
```

### 4.4 åç¨‹çš„å®é™…åº”ç”¨


**ğŸ“± æ¨¡æ‹Ÿå¤šç”¨æˆ·æ“ä½œ**

```python
import asyncio
import random

async def user_operation(user_id):
    """æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œï¼šç™»å½• â†’ æµè§ˆ â†’ ä¸‹å•"""
    # ç™»å½•
    print(f"ç”¨æˆ·{user_id} æ­£åœ¨ç™»å½•...")
    await asyncio.sleep(random.uniform(0.5, 1.5))
    print(f"ç”¨æˆ·{user_id} ç™»å½•æˆåŠŸ")
    
    # æµè§ˆå•†å“
    print(f"ç”¨æˆ·{user_id} æ­£åœ¨æµè§ˆå•†å“...")
    await asyncio.sleep(random.uniform(1, 3))
    print(f"ç”¨æˆ·{user_id} æµè§ˆå®Œæˆ")
    
    # ä¸‹å•
    print(f"ç”¨æˆ·{user_id} æ­£åœ¨ä¸‹å•...")
    await asyncio.sleep(random.uniform(0.5, 2))
    print(f"ç”¨æˆ·{user_id} ä¸‹å•æˆåŠŸ")
    
    return f"ç”¨æˆ·{user_id}æ“ä½œå®Œæˆ"

async def simulate_users():
    """æ¨¡æ‹Ÿå¤šä¸ªç”¨æˆ·åŒæ—¶æ“ä½œ"""
    tasks = []
    for i in range(1, 6):  # 5ä¸ªç”¨æˆ·
        task = asyncio.create_task(user_operation(i))
        tasks.append(task)
    
    results = await asyncio.gather(*tasks)
    print("æ‰€æœ‰ç”¨æˆ·æ“ä½œå®Œæˆ:", results)

asyncio.run(simulate_users())
```

---

## 5. ğŸ“‹ Taskä»»åŠ¡ç®¡ç†


### 5.1 ä»€ä¹ˆæ˜¯Task


**ğŸ”¸ Taskçš„é€šä¿—ç†è§£**

Taskå°±åƒæ˜¯ç»™åç¨‹åŒ…è£…äº†ä¸€å±‚"ç®¡ç†å¤–å£³"ï¼š

```
åç¨‹ = ä¸€ä¸ªè¦åšçš„äº‹æƒ…
Task = åç¨‹ + ç®¡ç†åŠŸèƒ½ï¼ˆå¯ä»¥å–æ¶ˆã€æŸ¥çœ‹çŠ¶æ€ã€è·å–ç»“æœï¼‰

å°±åƒï¼š
åç¨‹ = ä¸€å°ä¿¡  
Task = ä¿¡ + ä¿¡å°ï¼ˆæœ‰åœ°å€ã€é‚®æˆ³ã€å¯ä»¥è¿½è¸ªçŠ¶æ€ï¼‰
```

### 5.2 Taskçš„åˆ›å»ºå’Œä½¿ç”¨


**ğŸ”¨ åŸºæœ¬æ“ä½œ**

```python
import asyncio

async def count_down(name, seconds):
    """å€’è®¡æ—¶ä»»åŠ¡"""
    for i in range(seconds, 0, -1):
        print(f"{name}: {i}")
        await asyncio.sleep(1)
    print(f"{name}: å®Œæˆ!")
    return f"{name} å€’è®¡æ—¶ç»“æŸ"

async def main():
    # åˆ›å»ºTask
    task1 = asyncio.create_task(count_down("ä»»åŠ¡A", 3))
    task2 = asyncio.create_task(count_down("ä»»åŠ¡B", 5))
    
    # æ£€æŸ¥TaskçŠ¶æ€
    print(f"ä»»åŠ¡AçŠ¶æ€: {task1.done()}")  # Falseï¼ˆè¿˜åœ¨è¿è¡Œï¼‰
    
    # ç­‰å¾…Taskå®Œæˆ
    result1 = await task1
    print(f"ä»»åŠ¡Aç»“æœ: {result1}")
    
    # ç­‰å¾…ç¬¬äºŒä¸ªä»»åŠ¡
    result2 = await task2
    print(f"ä»»åŠ¡Bç»“æœ: {result2}")

asyncio.run(main())
```

### 5.3 Taskçš„é«˜çº§ç®¡ç†


**ğŸ® ä»»åŠ¡æ§åˆ¶åŠŸèƒ½**

```python
import asyncio

async def long_running_task(name):
    """é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡"""
    try:
        for i in range(10):
            print(f"{name} æ‰§è¡Œæ­¥éª¤ {i+1}")
            await asyncio.sleep(1)
        return f"{name} å…¨éƒ¨å®Œæˆ"
    except asyncio.CancelledError:
        print(f"{name} è¢«å–æ¶ˆäº†")
        return f"{name} å·²å–æ¶ˆ"

async def task_management():
    # åˆ›å»ºä»»åŠ¡
    task = asyncio.create_task(long_running_task("é‡è¦ä»»åŠ¡"))
    
    # è®©ä»»åŠ¡è¿è¡Œ3ç§’
    await asyncio.sleep(3)
    
    # æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆ
    if not task.done():
        print("ä»»åŠ¡è¿˜åœ¨è¿è¡Œï¼Œå‡†å¤‡å–æ¶ˆ...")
        task.cancel()  # å–æ¶ˆä»»åŠ¡
    
    try:
        result = await task
        print(f"ç»“æœ: {result}")
    except asyncio.CancelledError:
        print("ä»»åŠ¡ç¡®å®è¢«å–æ¶ˆäº†")

asyncio.run(task_management())
```

### 5.4 æ‰¹é‡Taskç®¡ç†


**ğŸ“¦ å¤„ç†å¤šä¸ªä»»åŠ¡**

```python
import asyncio
import time

async def download_file(file_id, size):
    """æ¨¡æ‹Ÿä¸‹è½½æ–‡ä»¶"""
    print(f"å¼€å§‹ä¸‹è½½æ–‡ä»¶ {file_id} ({size}MB)")
    download_time = size * 0.1  # å‡è®¾æ¯MBéœ€è¦0.1ç§’
    await asyncio.sleep(download_time)
    print(f"æ–‡ä»¶ {file_id} ä¸‹è½½å®Œæˆ")
    return f"file_{file_id}.zip"

async def download_manager():
    """ä¸‹è½½ç®¡ç†å™¨"""
    files = [
        (1, 10),  # æ–‡ä»¶ID, å¤§å°MB
        (2, 5),
        (3, 15),
        (4, 8),
        (5, 12)
    ]
    
    # åˆ›å»ºæ‰€æœ‰ä¸‹è½½ä»»åŠ¡
    tasks = [
        asyncio.create_task(download_file(file_id, size))
        for file_id, size in files
    ]
    
    print(f"å¼€å§‹ä¸‹è½½ {len(tasks)} ä¸ªæ–‡ä»¶...")
    start_time = time.time()
    
    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    completed_files = await asyncio.gather(*tasks)
    
    elapsed = time.time() - start_time
    print(f"æ‰€æœ‰æ–‡ä»¶ä¸‹è½½å®Œæˆï¼è€—æ—¶: {elapsed:.1f}ç§’")
    print(f"å·²ä¸‹è½½: {completed_files}")

asyncio.run(download_manager())
```

---

## 6. ğŸ”® Futureå¯¹è±¡æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯Future


**ğŸ”¸ Futureçš„ç”Ÿæ´»æ¯”å–»**

Futureå°±åƒæ˜¯"æœŸè´§åˆçº¦"æˆ–"å–é¤å·ç ç‰Œ"ï¼š

```
å»è‚¯å¾·åŸºç‚¹é¤çš„è¿‡ç¨‹ï¼š
1. ç‚¹é¤ä»˜æ¬¾ â†’ æ‹¿åˆ°å·ç ç‰Œï¼ˆFutureå¯¹è±¡ï¼‰
2. å·ç ç‰Œä»£è¡¨"æœªæ¥ä¼šå¾—åˆ°æ±‰å ¡"
3. å¯ä»¥æ‹¿ç€å·ç ç‰Œåšå…¶ä»–äº‹
4. å«å·æ—¶å»å–é¤ï¼ˆFutureå¾—åˆ°ç»“æœï¼‰

Future = ä»£è¡¨"å°†æ¥æŸä¸ªæ—¶å€™ä¼šæœ‰ç»“æœ"çš„å¯¹è±¡
```

### 6.2 Futureçš„åŸºæœ¬ä½¿ç”¨


**ğŸ”§ åˆ›å»ºå’Œæ“ä½œFuture**

```python
import asyncio

async def future_example():
    # åˆ›å»ºä¸€ä¸ªFutureå¯¹è±¡
    future = asyncio.Future()
    
    print(f"Futureå®Œæˆäº†å—ï¼Ÿ {future.done()}")
    print(f"Futureè¢«å–æ¶ˆäº†å—ï¼Ÿ {future.cancelled()}")
    
    # è®¾ç½®Futureçš„ç»“æœ
    future.set_result("æˆ‘çš„ç»“æœ")
    
    print(f"Futureå®Œæˆäº†å—ï¼Ÿ {future.done()}")
    result = await future
    print(f"Futureçš„ç»“æœ: {result}")

asyncio.run(future_example())
```

### 6.3 Futureçš„å®é™…åº”ç”¨


**ğŸ“¡ æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è·å–**

```python
import asyncio
import random

async def fetch_data_from_api(api_name):
    """æ¨¡æ‹Ÿä»APIè·å–æ•°æ®"""
    print(f"å¼€å§‹ä» {api_name} è·å–æ•°æ®...")
    
    # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
    delay = random.uniform(1, 3)
    await asyncio.sleep(delay)
    
    # æ¨¡æ‹Ÿå¶å°”å¤±è´¥
    if random.random() < 0.2:  # 20%æ¦‚ç‡å¤±è´¥
        raise Exception(f"{api_name} è¿”å›é”™è¯¯")
    
    data = f"{api_name}çš„æ•°æ®"
    print(f"ä» {api_name} è·å–æ•°æ®å®Œæˆ")
    return data

async def fetch_with_future():
    """ä½¿ç”¨Futureå¤„ç†å¤šä¸ªAPIè°ƒç”¨"""
    apis = ["ç”¨æˆ·API", "å•†å“API", "è®¢å•API"]
    
    # åˆ›å»ºFutureå¯¹è±¡æ¥æ”¶é›†ç»“æœ
    futures = []
    for api in apis:
        task = asyncio.create_task(fetch_data_from_api(api))
        futures.append(task)
    
    # ç­‰å¾…æ‰€æœ‰Futureå®Œæˆ
    results = []
    for future in futures:
        try:
            result = await future
            results.append(result)
        except Exception as e:
            print(f"è·å–æ•°æ®å¤±è´¥: {e}")
            results.append(None)
    
    print(f"æœ€ç»ˆç»“æœ: {results}")

asyncio.run(fetch_with_future())
```

---

## 7. ğŸ“ å¼‚æ­¥å‡½æ•°è°ƒç”¨


### 7.1 å¼‚æ­¥å‡½æ•°è°ƒç”¨çš„åŸºæœ¬è§„åˆ™


**ğŸ“‹ é‡è¦è§„åˆ™**

> **æ ¸å¿ƒåŸåˆ™**ï¼šåœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨è°ƒç”¨å¼‚æ­¥å‡½æ•°ï¼Œå¿…é¡»ä½¿ç”¨`await`å…³é”®å­—ã€‚

```python
import asyncio

# âœ… æ­£ç¡®çš„å¼‚æ­¥è°ƒç”¨
async def correct_async_call():
    print("å¼€å§‹å¼‚æ­¥æ“ä½œ")
    await asyncio.sleep(1)  # æ­£ç¡®ï¼šä½¿ç”¨await
    print("å¼‚æ­¥æ“ä½œå®Œæˆ")

# âŒ é”™è¯¯çš„å¼‚æ­¥è°ƒç”¨
async def wrong_async_call():
    print("å¼€å§‹å¼‚æ­¥æ“ä½œ")
    asyncio.sleep(1)  # é”™è¯¯ï¼šå¿˜è®°awaitï¼Œä¸ä¼šçœŸæ­£ç­‰å¾…
    print("è¿™ä¼šç«‹å³æ‰§è¡Œ")

async def main():
    await correct_async_call()  # è¿™æ ·æ‰å¯¹

asyncio.run(main())
```

### 7.2 å¼‚æ­¥å‡½æ•°çš„é“¾å¼è°ƒç”¨


**ğŸ”— å¤šå±‚å¼‚æ­¥è°ƒç”¨**

```python
import asyncio

async def step1():
    """ç¬¬ä¸€æ­¥ï¼šç”¨æˆ·ç™»å½•"""
    print("æ­¥éª¤1ï¼šéªŒè¯ç”¨æˆ·èº«ä»½...")
    await asyncio.sleep(1)
    print("ç”¨æˆ·ç™»å½•æˆåŠŸ")
    return "ç”¨æˆ·token"

async def step2(token):
    """ç¬¬äºŒæ­¥ï¼šè·å–ç”¨æˆ·æ•°æ®"""
    print(f"æ­¥éª¤2ï¼šä½¿ç”¨ {token} è·å–ç”¨æˆ·æ•°æ®...")
    await asyncio.sleep(1.5)
    print("ç”¨æˆ·æ•°æ®è·å–æˆåŠŸ")
    return {"name": "å¼ ä¸‰", "age": 25}

async def step3(user_data):
    """ç¬¬ä¸‰æ­¥ï¼šä¸ªæ€§åŒ–æ¨è"""
    print(f"æ­¥éª¤3ï¼šä¸º {user_data['name']} ç”Ÿæˆæ¨è...")
    await asyncio.sleep(1)
    print("æ¨èå†…å®¹ç”Ÿæˆå®Œæˆ")
    return ["å•†å“A", "å•†å“B", "å•†å“C"]

async def complete_workflow():
    """å®Œæ•´çš„ç”¨æˆ·æœåŠ¡æµç¨‹"""
    # é“¾å¼è°ƒç”¨å¼‚æ­¥å‡½æ•°
    token = await step1()
    user_data = await step2(token)
    recommendations = await step3(user_data)
    
    print(f"å®Œæ•´æµç¨‹ç»“æŸï¼Œæ¨èå•†å“ï¼š{recommendations}")

asyncio.run(complete_workflow())
```

### 7.3 å¼‚æ­¥å‡½æ•°çš„é”™è¯¯å¤„ç†


**âš ï¸ å¼‚æ­¥å¼‚å¸¸å¤„ç†**

```python
import asyncio
import random

async def unreliable_service(service_name):
    """ä¸ç¨³å®šçš„æœåŠ¡è°ƒç”¨"""
    print(f"è°ƒç”¨ {service_name} æœåŠ¡...")
    await asyncio.sleep(1)
    
    # éšæœºäº§ç”Ÿé”™è¯¯
    if random.random() < 0.3:  # 30%æ¦‚ç‡å‡ºé”™
        raise Exception(f"{service_name} æœåŠ¡æš‚æ—¶ä¸å¯ç”¨")
    
    return f"{service_name} æœåŠ¡å“åº”æˆåŠŸ"

async def call_with_retry(service_name, max_retries=3):
    """å¸¦é‡è¯•çš„å¼‚æ­¥è°ƒç”¨"""
    for attempt in range(max_retries):
        try:
            result = await unreliable_service(service_name)
            print(f"âœ… {result}")
            return result
        except Exception as e:
            print(f"âŒ ç¬¬ {attempt + 1} æ¬¡å°è¯•å¤±è´¥: {e}")
            if attempt < max_retries - 1:
                print(f"â³ ç­‰å¾… {attempt + 1} ç§’åé‡è¯•...")
                await asyncio.sleep(attempt + 1)
            else:
                print(f"ğŸ’¥ {service_name} æœåŠ¡è°ƒç”¨æœ€ç»ˆå¤±è´¥")
                raise

async def main():
    await call_with_retry("æ”¯ä»˜æœåŠ¡")

asyncio.run(main())
```

---

## 8. ğŸš¦ å¹¶å‘æ‰§è¡Œæ§åˆ¶


### 8.1 ä»€ä¹ˆæ˜¯å¹¶å‘æ§åˆ¶


**ğŸ”¸ å¹¶å‘æ§åˆ¶çš„å¿…è¦æ€§**

æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†ï¼š

```
æ²¡æœ‰å¹¶å‘æ§åˆ¶ï¼š
æ‰€æœ‰äººåŒæ—¶æ¶Œå…¥ â†’ å›¾ä¹¦é¦†æŒ¤çˆ† â†’ æœåŠ¡è´¨é‡ä¸‹é™

æœ‰å¹¶å‘æ§åˆ¶ï¼š
é™åˆ¶åŒæ—¶è¿›å…¥çš„äººæ•° â†’ ä¿æŒèˆ’é€‚ç¯å¢ƒ â†’ æé«˜æœåŠ¡è´¨é‡

åœ¨ç¼–ç¨‹ä¸­ï¼š
æ§åˆ¶åŒæ—¶è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡æ•°é‡ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½
```

### 8.2 ä½¿ç”¨asyncio.gather()


**ğŸ“¦ æ‰¹é‡å¹¶å‘æ‰§è¡Œ**

```python
import asyncio
import time

async def process_data(data_id):
    """å¤„ç†å•ä¸ªæ•°æ®é¡¹"""
    print(f"å¼€å§‹å¤„ç†æ•°æ® {data_id}")
    await asyncio.sleep(1)  # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
    print(f"æ•°æ® {data_id} å¤„ç†å®Œæˆ")
    return f"ç»“æœ_{data_id}"

async def batch_process():
    """æ‰¹é‡å¤„ç†æ•°æ®"""
    data_ids = [1, 2, 3, 4, 5]
    
    print("ğŸ”„ å¼€å§‹æ‰¹é‡å¤„ç†...")
    start_time = time.time()
    
    # gatherä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    results = await asyncio.gather(
        *[process_data(data_id) for data_id in data_ids]
    )
    
    elapsed = time.time() - start_time
    print(f"â±ï¸ æ‰¹é‡å¤„ç†å®Œæˆï¼Œè€—æ—¶: {elapsed:.1f}ç§’")
    print(f"ğŸ“Š ç»“æœ: {results}")

asyncio.run(batch_process())
```

### 8.3 ä½¿ç”¨asyncio.as_completed()


**âš¡ æŒ‰å®Œæˆé¡ºåºå¤„ç†ç»“æœ**

```python
import asyncio
import random

async def fetch_url(url, delay):
    """æ¨¡æ‹Ÿè·å–URLå†…å®¹"""
    print(f"ğŸ“¡ å¼€å§‹è·å– {url}")
    await asyncio.sleep(delay)
    print(f"âœ… {url} è·å–å®Œæˆ")
    return f"{url} çš„å†…å®¹"

async def process_as_completed():
    """æŒ‰å®Œæˆé¡ºåºå¤„ç†ç»“æœ"""
    urls_and_delays = [
        ("ç½‘ç«™A", 2),
        ("ç½‘ç«™B", 1),
        ("ç½‘ç«™C", 3),
        ("ç½‘ç«™D", 1.5)
    ]
    
    # åˆ›å»ºä»»åŠ¡
    tasks = [
        fetch_url(url, delay)
        for url, delay in urls_and_delays
    ]
    
    # æŒ‰å®Œæˆé¡ºåºå¤„ç†ç»“æœ
    print("ğŸš€ å¼€å§‹å¹¶å‘è·å–ï¼ŒæŒ‰å®Œæˆé¡ºåºæ˜¾ç¤ºç»“æœ...")
    for completed_task in asyncio.as_completed(tasks):
        result = await completed_task
        print(f"ğŸ¯ æ”¶åˆ°ç»“æœ: {result}")

asyncio.run(process_as_completed())
```

### 8.4 é™åˆ¶å¹¶å‘æ•°é‡


**ğŸ›ï¸ å¹¶å‘æ§åˆ¶å®æˆ˜**

```python
import asyncio

async def limited_concurrency_demo():
    """æ¼”ç¤ºé™åˆ¶å¹¶å‘æ•°é‡"""
    
    # åˆ›å»ºä¿¡å·é‡é™åˆ¶å¹¶å‘æ•°
    semaphore = asyncio.Semaphore(3)  # æœ€å¤šåŒæ—¶è¿è¡Œ3ä¸ªä»»åŠ¡
    
    async def controlled_task(task_id):
        async with semaphore:  # è·å–ä¿¡å·é‡
            print(f"ğŸŸ¢ ä»»åŠ¡ {task_id} å¼€å§‹æ‰§è¡Œ")
            await asyncio.sleep(2)  # æ¨¡æ‹Ÿå·¥ä½œ
            print(f"ğŸ”µ ä»»åŠ¡ {task_id} æ‰§è¡Œå®Œæˆ")
            return f"ä»»åŠ¡{task_id}çš„ç»“æœ"
    
    # åˆ›å»º10ä¸ªä»»åŠ¡
    tasks = [controlled_task(i) for i in range(1, 11)]
    
    print("ğŸš¦ æœ€å¤šåŒæ—¶è¿è¡Œ3ä¸ªä»»åŠ¡...")
    results = await asyncio.gather(*tasks)
    print(f"ğŸ“‹ æ‰€æœ‰ä»»åŠ¡å®Œæˆ: {len(results)} ä¸ªç»“æœ")

asyncio.run(limited_concurrency_demo())
```

---

## 9. â— å¼‚æ­¥å¼‚å¸¸å¤„ç†


### 9.1 å¼‚æ­¥å¼‚å¸¸çš„ç‰¹ç‚¹


**âš ï¸ å¼‚æ­¥å¼‚å¸¸vsæ™®é€šå¼‚å¸¸**

```python
import asyncio

# æ™®é€šåŒæ­¥å¼‚å¸¸
def sync_function():
    try:
        raise ValueError("åŒæ­¥å¼‚å¸¸")
    except ValueError as e:
        print(f"æ•è·åˆ°: {e}")

# å¼‚æ­¥å¼‚å¸¸å¤„ç†
async def async_function():
    try:
        await asyncio.sleep(0.1)
        raise ValueError("å¼‚æ­¥å¼‚å¸¸")
    except ValueError as e:
        print(f"æ•è·åˆ°: {e}")

# è¿è¡Œæ¼”ç¤º
sync_function()
asyncio.run(async_function())
```

### 9.2 å¤„ç†å•ä¸ªå¼‚æ­¥ä»»åŠ¡çš„å¼‚å¸¸


**ğŸ”§ åŸºæœ¬å¼‚å¸¸å¤„ç†**

```python
import asyncio
import random

async def risky_operation(operation_id):
    """å¯èƒ½å¤±è´¥çš„å¼‚æ­¥æ“ä½œ"""
    print(f"ğŸ² æ‰§è¡Œæ“ä½œ {operation_id}")
    await asyncio.sleep(1)
    
    if random.random() < 0.4:  # 40%æ¦‚ç‡å¤±è´¥
        raise Exception(f"æ“ä½œ {operation_id} å¤±è´¥äº†ï¼")
    
    print(f"âœ… æ“ä½œ {operation_id} æˆåŠŸ")
    return f"æ“ä½œ{operation_id}çš„ç»“æœ"

async def safe_operation(operation_id):
    """å®‰å…¨çš„å¼‚æ­¥æ“ä½œåŒ…è£…"""
    try:
        result = await risky_operation(operation_id)
        return result
    except Exception as e:
        print(f"âŒ å¼‚å¸¸å¤„ç†: {e}")
        return f"æ“ä½œ{operation_id}å¤±è´¥"

async def main():
    # è¿è¡Œå¤šä¸ªå®‰å…¨æ“ä½œ
    tasks = [safe_operation(i) for i in range(1, 6)]
    results = await asyncio.gather(*tasks)
    print(f"ğŸ“Š æœ€ç»ˆç»“æœ: {results}")

asyncio.run(main())
```

### 9.3 æ‰¹é‡ä»»åŠ¡çš„å¼‚å¸¸å¤„ç†


**ğŸ“¦ gather()çš„å¼‚å¸¸å¤„ç†ç­–ç•¥**

```python
import asyncio

async def task_with_exception(task_id, should_fail=False):
    """å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»»åŠ¡"""
    await asyncio.sleep(1)
    if should_fail:
        raise ValueError(f"ä»»åŠ¡ {task_id} æ•…æ„å¤±è´¥")
    return f"ä»»åŠ¡ {task_id} æˆåŠŸ"

async def handle_batch_exceptions():
    """å¤„ç†æ‰¹é‡ä»»åŠ¡å¼‚å¸¸çš„ä¸åŒç­–ç•¥"""
    
    # ç­–ç•¥1ï¼šreturn_exceptions=Trueï¼Œä¸ä¼šå› ä¸ºå¼‚å¸¸ä¸­æ–­
    print("ğŸ“‹ ç­–ç•¥1ï¼šæ”¶é›†æ‰€æœ‰ç»“æœï¼ˆåŒ…æ‹¬å¼‚å¸¸ï¼‰")
    tasks1 = [
        task_with_exception(1, False),
        task_with_exception(2, True),   # è¿™ä¸ªä¼šå¤±è´¥
        task_with_exception(3, False),
    ]
    
    results1 = await asyncio.gather(*tasks1, return_exceptions=True)
    for i, result in enumerate(results1, 1):
        if isinstance(result, Exception):
            print(f"  ä»»åŠ¡ {i}: âŒ å¼‚å¸¸ - {result}")
        else:
            print(f"  ä»»åŠ¡ {i}: âœ… æˆåŠŸ - {result}")
    
    print("\n" + "="*50 + "\n")
    
    # ç­–ç•¥2ï¼šå•ç‹¬å¤„ç†æ¯ä¸ªä»»åŠ¡
    print("ğŸ“‹ ç­–ç•¥2ï¼šå•ç‹¬å¤„ç†æ¯ä¸ªä»»åŠ¡")
    tasks2 = [
        task_with_exception(4, False),
        task_with_exception(5, True),   # è¿™ä¸ªä¼šå¤±è´¥
        task_with_exception(6, False),
    ]
    
    results2 = []
    for task in tasks2:
        try:
            result = await task
            results2.append(result)
            print(f"  âœ… {result}")
        except Exception as e:
            results2.append(f"å¤±è´¥: {e}")
            print(f"  âŒ å¼‚å¸¸: {e}")

asyncio.run(handle_batch_exceptions())
```

### 9.4 è¶…æ—¶å’Œå–æ¶ˆå¤„ç†


**â° å¤„ç†è¶…æ—¶æƒ…å†µ**

```python
import asyncio

async def slow_operation(name, duration):
    """æ…¢é€Ÿæ“ä½œ"""
    print(f"ğŸŒ {name} å¼€å§‹ï¼ˆé¢„è®¡ {duration} ç§’ï¼‰")
    try:
        await asyncio.sleep(duration)
        print(f"âœ… {name} å®Œæˆ")
        return f"{name} çš„ç»“æœ"
    except asyncio.CancelledError:
        print(f"âŒ {name} è¢«å–æ¶ˆ")
        raise

async def timeout_handling():
    """è¶…æ—¶å¤„ç†æ¼”ç¤º"""
    
    # è®¾ç½®3ç§’è¶…æ—¶
    try:
        result = await asyncio.wait_for(
            slow_operation("æ…¢ä»»åŠ¡", 5),  # éœ€è¦5ç§’ï¼Œä½†è¶…æ—¶3ç§’
            timeout=3.0
        )
        print(f"ç»“æœ: {result}")
    except asyncio.TimeoutError:
        print("â° æ“ä½œè¶…æ—¶ï¼")
    
    print("\n" + "-"*30 + "\n")
    
    # æ‰‹åŠ¨å–æ¶ˆä»»åŠ¡
    task = asyncio.create_task(slow_operation("å¯å–æ¶ˆä»»åŠ¡", 10))
    
    # ç­‰å¾…2ç§’åå–æ¶ˆ
    await asyncio.sleep(2)
    task.cancel()
    
    try:
        await task
    except asyncio.CancelledError:
        print("ğŸ›‘ ä»»åŠ¡è¢«æ‰‹åŠ¨å–æ¶ˆ")

asyncio.run(timeout_handling())
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¼‚æ­¥ç¼–ç¨‹æœ¬è´¨ï¼šè®©ç¨‹åºåœ¨ç­‰å¾…æ—¶èƒ½åšå…¶ä»–äº‹æƒ…ï¼Œæé«˜æ•ˆç‡
ğŸ”¸ asyncioå·¥å…·ç®±ï¼šäº‹ä»¶å¾ªç¯ã€åç¨‹ã€Taskã€Futureç­‰æ ¸å¿ƒç»„ä»¶
ğŸ”¸ åç¨‹åˆ›å»ºï¼šä½¿ç”¨ async def å®šä¹‰ï¼Œawait è°ƒç”¨å¼‚æ­¥æ“ä½œ
ğŸ”¸ Taskç®¡ç†ï¼šç”¨äºåŒ…è£…åç¨‹ï¼Œæä¾›çŠ¶æ€æŸ¥è¯¢å’Œæ§åˆ¶åŠŸèƒ½
ğŸ”¸ å¹¶å‘æ§åˆ¶ï¼šgatherã€as_completedã€ä¿¡å·é‡ç­‰æ§åˆ¶å¹¶å‘æ•°é‡
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼štry-exceptã€return_exceptionsã€è¶…æ—¶æ§åˆ¶
```

### 10.2 å…³é”®è¯­æ³•è®°å¿†


**ğŸ“ é‡è¦è¯­æ³•å¯¹ç…§è¡¨**

| **æ“ä½œ** | **è¯­æ³•** | **ä½œç”¨** | **ç¤ºä¾‹** |
|---------|---------|---------|---------|
| **å®šä¹‰åç¨‹** | `async def` | `åˆ›å»ºå¼‚æ­¥å‡½æ•°` | `async def my_func():` |
| **ç­‰å¾…æ“ä½œ** | `await` | `ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ` | `await asyncio.sleep(1)` |
| **è¿è¡Œåç¨‹** | `asyncio.run()` | `è¿è¡Œå¼‚æ­¥ç¨‹åºå…¥å£` | `asyncio.run(main())` |
| **åˆ›å»ºä»»åŠ¡** | `create_task()` | `å°†åç¨‹åŒ…è£…æˆTask` | `task = asyncio.create_task(coro)` |
| **å¹¶å‘æ‰§è¡Œ** | `gather()` | `åŒæ—¶è¿è¡Œå¤šä¸ªåç¨‹` | `await asyncio.gather(*tasks)` |
| **è¶…æ—¶æ§åˆ¶** | `wait_for()` | `è®¾ç½®æ“ä½œè¶…æ—¶æ—¶é—´` | `await asyncio.wait_for(coro, 3.0)` |

### 10.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ é€‚ç”¨åœºæ™¯åˆ¤æ–­**

```
âœ… é€‚åˆå¼‚æ­¥ç¼–ç¨‹çš„åœºæ™¯ï¼š
â€¢ ç½‘ç»œè¯·æ±‚ï¼ˆAPIè°ƒç”¨ã€çˆ¬è™«ï¼‰
â€¢ æ–‡ä»¶I/Oæ“ä½œï¼ˆè¯»å†™å¤§æ–‡ä»¶ï¼‰
â€¢ æ•°æ®åº“æŸ¥è¯¢ï¼ˆç‰¹åˆ«æ˜¯å¤šä¸ªæŸ¥è¯¢ï¼‰
â€¢ WebæœåŠ¡å™¨ï¼ˆå¤„ç†å¤šç”¨æˆ·è¯·æ±‚ï¼‰

âŒ ä¸é€‚åˆå¼‚æ­¥ç¼–ç¨‹çš„åœºæ™¯ï¼š
â€¢ CPUå¯†é›†å‹è®¡ç®—ï¼ˆæ•°å­¦è¿ç®—ã€å›¾åƒå¤„ç†ï¼‰
â€¢ ç®€å•çš„æœ¬åœ°æ“ä½œï¼ˆå˜é‡èµ‹å€¼ã€ç®€å•è®¡ç®—ï¼‰
â€¢ å•çº¿ç¨‹é¡ºåºé€»è¾‘ï¼ˆå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œçš„æ“ä½œï¼‰
```

### 10.4 å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ


**âš ï¸ æ–°æ‰‹å¸¸çŠ¯é”™è¯¯**

```python
# âŒ é”™è¯¯1ï¼šå¿˜è®°ä½¿ç”¨await
async def wrong():
    asyncio.sleep(1)  # æ²¡æœ‰çœŸæ­£ç­‰å¾…

# âœ… æ­£ç¡®ï¼š
async def correct():
    await asyncio.sleep(1)  # çœŸæ­£ç­‰å¾…

# âŒ é”™è¯¯2ï¼šåœ¨åŒæ­¥å‡½æ•°ä¸­ä½¿ç”¨await
def wrong_sync():
    await some_async_func()  # è¯­æ³•é”™è¯¯

# âœ… æ­£ç¡®ï¼š
async def correct_async():
    await some_async_func()

# âŒ é”™è¯¯3ï¼šä¸å¤„ç†å¼‚å¸¸
async def risky():
    await might_fail()  # å¯èƒ½æŠ›å¼‚å¸¸

# âœ… æ­£ç¡®ï¼š
async def safe():
    try:
        await might_fail()
    except Exception as e:
        print(f"å¤„ç†å¼‚å¸¸: {e}")
```

### 10.5 å­¦ä¹ å»ºè®®


**ğŸ“š å­¦ä¹ è·¯å¾„**

1. **ç†è§£æ¦‚å¿µ** - å…ˆææ¸…æ¥š"ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥"
2. **ç»ƒä¹ åŸºç¡€** - ä»ç®€å•çš„ async/await å¼€å§‹  
3. **æŒæ¡å·¥å…·** - å­¦ä¼šä½¿ç”¨ Taskã€gather ç­‰
4. **å¤„ç†å¼‚å¸¸** - å­¦ä¹ å¼‚æ­¥å¼‚å¸¸å¤„ç†
5. **å®æˆ˜åº”ç”¨** - åšä¸€ä¸ªç½‘ç»œçˆ¬è™«æˆ–APIæœåŠ¡

**ğŸ› ï¸ å®è·µå»ºè®®**

```
ğŸ’¡ å­¦ä¹ æŠ€å·§ï¼š
â€¢ ä»ç®€å•ç¤ºä¾‹å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚åº¦
â€¢ å¤šåšå¯¹æ¯”å®éªŒï¼ˆåŒæ­¥vså¼‚æ­¥çš„æ€§èƒ½å·®å¼‚ï¼‰
â€¢ ç»“åˆå®é™…é¡¹ç›®ç»ƒä¹ ï¼ˆå¦‚çˆ¬è™«ã€APIè°ƒç”¨ï¼‰
â€¢ é‡åˆ°é—®é¢˜å¤šæŸ¥çœ‹é”™è¯¯ä¿¡æ¯å’Œæ–‡æ¡£

ğŸ¯ ç»ƒä¹ é¡¹ç›®æ¨èï¼š
â€¢ æ‰¹é‡ä¸‹è½½å›¾ç‰‡
â€¢ å¤šAPIæ•°æ®èšåˆ
â€¢ ç®€å•çš„Webçˆ¬è™«
â€¢ å¼‚æ­¥WebæœåŠ¡å™¨
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¼‚æ­¥ç¼–ç¨‹ä¸é˜»å¡ï¼Œawaitè®©å‡ºå¥½åä½œ
Taskç®¡ç†çŠ¶æ€æ¸…ï¼Œgatherå¹¶å‘æ¥èšé½
å¼‚å¸¸å¤„ç†è¦å‘¨å…¨ï¼Œè¶…æ—¶å–æ¶ˆä¿å®‰å…¨
ç½‘ç»œIOæœ€é€‚åˆï¼ŒCPUå¯†é›†ä¸è¦æ
```