---
title: 8ã€é›†åˆä¸æ•°æ®ç»“æ„æ¨¡å—
---
## ğŸ“š ç›®å½•

1. [collectionsæ¨¡å—æ¦‚è¿°](#1-collectionsæ¨¡å—æ¦‚è¿°)
2. [Counterè®¡æ•°å™¨](#2-Counterè®¡æ•°å™¨)
3. [defaultdicté»˜è®¤å­—å…¸](#3-defaultdicté»˜è®¤å­—å…¸)
4. [OrderedDictæœ‰åºå­—å…¸](#4-OrderedDictæœ‰åºå­—å…¸)
5. [dequeåŒç«¯é˜Ÿåˆ—](#5-dequeåŒç«¯é˜Ÿåˆ—)
6. [namedtupleå‘½åå…ƒç»„](#6-namedtupleå‘½åå…ƒç»„)
7. [ChainMapå­—å…¸é“¾](#7-ChainMapå­—å…¸é“¾)
8. [è‡ªå®šä¹‰å®¹å™¨åŸºç±»](#8-è‡ªå®šä¹‰å®¹å™¨åŸºç±»)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¦ collectionsæ¨¡å—æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯collectionsæ¨¡å—


**ç®€å•ç†è§£**ï¼š`collections`å°±åƒæ˜¯Pythonå†…ç½®æ•°æ®ç»“æ„çš„"å‡çº§ç‰ˆå·¥å…·ç®±"

> **ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**  
> collectionsæ¨¡å—æä¾›äº†æ¯”å†…ç½®æ•°æ®ç±»å‹ï¼ˆlistã€dictã€tupleï¼‰æ›´å¼ºå¤§ã€æ›´ä¸“ä¸šçš„å®¹å™¨ç±»å‹

```
ç”Ÿæ´»ç±»æ¯”ï¼š
æ™®é€šå·¥å…·ç®±ï¼šé”¤å­ã€èºä¸åˆ€ã€æ‰³æ‰‹ï¼ˆå†…ç½®ç±»å‹ï¼šlistã€dictã€tupleï¼‰
ä¸“ä¸šå·¥å…·ç®±ï¼šç”µé’»ã€è§’ç£¨æœºã€æµ‹é‡ä»ªï¼ˆcollectionsï¼šCounterã€dequeã€OrderedDictï¼‰

éƒ½èƒ½å¹²æ´»ï¼Œä½†ä¸“ä¸šå·¥å…·åœ¨ç‰¹å®šåœºæ™¯ä¸‹æ›´é«˜æ•ˆï¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦collections


**æ ¸å¿ƒåŸå› **ï¼šå†…ç½®æ•°æ®ç»“æ„è™½ç„¶ä¸‡èƒ½ï¼Œä½†åœ¨ç‰¹å®šåœºæ™¯ä¸‹ä¸å¤Ÿé«˜æ•ˆæˆ–æ–¹ä¾¿

| åœºæ™¯éœ€æ±‚ | å†…ç½®ç±»å‹é—®é¢˜ | collectionsè§£å†³æ–¹æ¡ˆ |
|---------|------------|-------------------|
| **ç»Ÿè®¡å…ƒç´ ä¸ªæ•°** | `ç”¨dictæ‰‹åŠ¨è®¡æ•°ï¼Œä»£ç ç¹ç` | `Counterè‡ªåŠ¨è®¡æ•°` |
| **éœ€è¦é»˜è®¤å€¼çš„å­—å…¸** | `æ¯æ¬¡éƒ½è¦æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨` | `defaultdictè‡ªåŠ¨åˆ›å»ºé»˜è®¤å€¼` |
| **ä¿æŒæ’å…¥é¡ºåº** | `æ™®é€šdictåœ¨è€ç‰ˆæœ¬Pythonæ— åº` | `OrderedDictä¿è¯æœ‰åº` |
| **ä¸¤ç«¯éƒ½è¦æ“ä½œçš„åˆ—è¡¨** | `liståœ¨å¤´éƒ¨æ’å…¥å¾ˆæ…¢O(n)` | `dequeä¸¤ç«¯æ“ä½œéƒ½æ˜¯O(1)` |

---

## 2. ğŸ”¢ Counterè®¡æ•°å™¨


### 2.1 CounteråŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šCounterå°±æ˜¯ä¸€ä¸ª"è‡ªåŠ¨è®¡æ•°çš„å­—å…¸"

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**  
> æƒ³è±¡ä½ åœ¨ç»Ÿè®¡ç­çº§é‡Œæ¯ç§æ°´æœçš„æ•°é‡ï¼š
> - æ™®é€šæ–¹æ³•ï¼šæ‹¿ä¸ªæœ¬å­ï¼Œçœ‹åˆ°è‹¹æœå°±åœ¨"è‹¹æœ"åé¢ç”»ä¸€ç¬”
> - Counteræ–¹æ³•ï¼šæœ‰ä¸ªæ™ºèƒ½è®¡æ•°å™¨ï¼Œå‘Šè¯‰å®ƒ"è‹¹æœ"ï¼Œå®ƒè‡ªåŠ¨+1

```python
from collections import Counter

# ç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°
text = "hello world"
counter = Counter(text)
print(counter)  # Counter({'l': 3, 'o': 2, 'h': 1, 'e': 1, ' ': 1, 'w': 1, 'r': 1, 'd': 1})
```

### 2.2 Counterçš„æ ¸å¿ƒåŠŸèƒ½


**ğŸ”¸ åˆ›å»ºCounterçš„æ–¹å¼**

```python
# æ–¹å¼1ï¼šä»å­—ç¬¦ä¸²åˆ›å»º
counter1 = Counter("aabbcc")
print(counter1)  # Counter({'a': 2, 'b': 2, 'c': 2})

# æ–¹å¼2ï¼šä»åˆ—è¡¨åˆ›å»º
fruits = ['apple', 'banana', 'apple', 'orange', 'banana', 'apple']
counter2 = Counter(fruits)
print(counter2)  # Counter({'apple': 3, 'banana': 2, 'orange': 1})

# æ–¹å¼3ï¼šä»å­—å…¸åˆ›å»º
counter3 = Counter({'red': 4, 'blue': 2})
print(counter3)  # Counter({'red': 4, 'blue': 2})
```

**ğŸ”¸ Counterçš„å¸¸ç”¨æ–¹æ³•**

```python
fruits = ['apple', 'banana', 'apple', 'orange', 'banana', 'apple']
fruit_counter = Counter(fruits)

# 1. æœ€å¸¸è§çš„å…ƒç´ 
print(fruit_counter.most_common())      # [('apple', 3), ('banana', 2), ('orange', 1)]
print(fruit_counter.most_common(2))     # [('apple', 3), ('banana', 2)]

# 2. å…ƒç´ æ€»æ•°
print(sum(fruit_counter.values()))      # 6

# 3. æ›´æ–°è®¡æ•°
fruit_counter.update(['apple', 'grape'])
print(fruit_counter)  # Counter({'apple': 4, 'banana': 2, 'orange': 1, 'grape': 1})

# 4. å‡å°‘è®¡æ•°
fruit_counter.subtract(['apple', 'banana'])
print(fruit_counter)  # Counter({'apple': 3, 'banana': 1, 'orange': 1, 'grape': 1})
```

### 2.3 Counterå®é™…åº”ç”¨åœºæ™¯


**ğŸ“Š ç»Ÿè®¡æ–‡æœ¬è¯é¢‘**

```python
def analyze_text(text):
    # åˆ†è¯å¹¶ç»Ÿè®¡
    words = text.lower().split()
    word_count = Counter(words)
    
    print(f"æ€»è¯æ•°: {sum(word_count.values())}")
    print(f"ä¸é‡å¤è¯æ•°: {len(word_count)}")
    print(f"æœ€å¸¸ç”¨è¯: {word_count.most_common(3)}")

text = "python is great python is easy python is powerful"
analyze_text(text)
# æ€»è¯æ•°: 9
# ä¸é‡å¤è¯æ•°: 5  
# æœ€å¸¸ç”¨è¯: [('python', 3), ('is', 3), ('great', 1)]
```

---

## 3. ğŸ”§ defaultdicté»˜è®¤å­—å…¸


### 3.1 defaultdictåŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šdefaultdictæ˜¯"æ°¸è¿œä¸ä¼šæŠ¥KeyErrorçš„å­—å…¸"

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**  
> æ™®é€šå­—å…¸åƒä¼ ç»Ÿå›¾ä¹¦é¦†ï¼šæ‰¾ä¸åˆ°ä¹¦ä¼šå‘Šè¯‰ä½ "æ²¡æœ‰è¿™æœ¬ä¹¦"  
> defaultdictåƒæ™ºèƒ½å›¾ä¹¦é¦†ï¼šæ‰¾ä¸åˆ°ä¹¦ä¼šè‡ªåŠ¨å¸®ä½ åˆ›å»ºä¸€æœ¬ç©ºç™½çš„

```python
from collections import defaultdict

# æ™®é€šå­—å…¸çš„é—®é¢˜
normal_dict = {}
# normal_dict['new_key'] += 1  # KeyError!

# defaultdictçš„è§£å†³æ–¹æ¡ˆ
dd = defaultdict(int)  # é»˜è®¤å€¼æ˜¯0
dd['new_key'] += 1  # è‡ªåŠ¨åˆ›å»ºï¼Œä¸æŠ¥é”™
print(dd['new_key'])  # 1
```

### 3.2 defaultdictçš„ä½¿ç”¨æ–¹å¼


**ğŸ”¸ ä¸åŒç±»å‹çš„é»˜è®¤å€¼**

```python
# intç±»å‹ï¼šé»˜è®¤å€¼0ï¼Œé€‚åˆè®¡æ•°
count_dict = defaultdict(int)
count_dict['apples'] += 5
print(count_dict)  # defaultdict(<class 'int'>, {'apples': 5})

# listç±»å‹ï¼šé»˜è®¤å€¼[]ï¼Œé€‚åˆåˆ†ç»„
group_dict = defaultdict(list)
group_dict['fruits'].append('apple')
group_dict['fruits'].append('banana')
print(group_dict)  # defaultdict(<class 'list'>, {'fruits': ['apple', 'banana']})

# setç±»å‹ï¼šé»˜è®¤å€¼set()ï¼Œé€‚åˆå»é‡æ”¶é›†
set_dict = defaultdict(set)
set_dict['colors'].add('red')
set_dict['colors'].add('blue')
print(set_dict)  # defaultdict(<class 'set'>, {'colors': {'red', 'blue'}})
```

**ğŸ”¸ è‡ªå®šä¹‰é»˜è®¤å€¼å‡½æ•°**

```python
# ä½¿ç”¨lambdaåˆ›å»ºè‡ªå®šä¹‰é»˜è®¤å€¼
def default_value():
    return "æœªçŸ¥"

info_dict = defaultdict(default_value)
print(info_dict['name'])  # "æœªçŸ¥"

# æˆ–è€…æ›´ç®€æ´çš„å†™æ³•
info_dict2 = defaultdict(lambda: "æœªçŸ¥")
print(info_dict2['age'])  # "æœªçŸ¥"
```

### 3.3 defaultdictå®é™…åº”ç”¨


**ğŸ“‹ å­¦ç”Ÿæˆç»©ç®¡ç†ç³»ç»Ÿ**

```python
def grade_manager():
    # æŒ‰ç§‘ç›®åˆ†ç»„å­¦ç”Ÿæˆç»©
    grades = defaultdict(list)
    
    # æ·»åŠ æˆç»©æ•°æ®
    student_data = [
        ('å¼ ä¸‰', 'æ•°å­¦', 85),
        ('æå››', 'æ•°å­¦', 92),
        ('å¼ ä¸‰', 'è‹±è¯­', 78),
        ('ç‹äº”', 'æ•°å­¦', 88),
        ('æå››', 'è‹±è¯­', 95)
    ]
    
    for name, subject, score in student_data:
        grades[subject].append((name, score))
    
    # è®¡ç®—å„ç§‘å¹³å‡åˆ†
    for subject, scores in grades.items():
        avg = sum(score for _, score in scores) / len(scores)
        print(f"{subject}å¹³å‡åˆ†: {avg:.1f}")
        
grade_manager()
# æ•°å­¦å¹³å‡åˆ†: 88.3
# è‹±è¯­å¹³å‡åˆ†: 86.5
```

---

## 4. ğŸ“‘ OrderedDictæœ‰åºå­—å…¸


### 4.1 OrderedDictåŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šOrderedDictæ˜¯"è®°ä½æ’å…¥é¡ºåºçš„å­—å…¸"

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**  
> æ™®é€šå­—å…¸åƒä¹±æ”¾çš„ä¹¦æ¶ï¼šä¹¦éƒ½åœ¨ï¼Œä½†ä¸è®°å¾—æ”¾å…¥é¡ºåº  
> OrderedDictåƒç¼–å·ä¹¦æ¶ï¼šä¸ä»…æœ‰ä¹¦ï¼Œè¿˜è®°å¾—æ¯æœ¬ä¹¦æ˜¯ç¬¬å‡ ä¸ªæ”¾è¿›å»çš„

**å†å²èƒŒæ™¯**ï¼š
- Python 3.7ä¹‹å‰ï¼šæ™®é€šdictä¸ä¿è¯é¡ºåº
- Python 3.7ä¹‹åï¼šæ™®é€šdictä¹Ÿä¿è¯é¡ºåºäº†
- ä½†OrderedDictä»æœ‰ç‹¬ç‰¹ä¼˜åŠ¿

```python
from collections import OrderedDict

# åˆ›å»ºæœ‰åºå­—å…¸
od = OrderedDict()
od['first'] = 1
od['second'] = 2  
od['third'] = 3

print(od)  # OrderedDict([('first', 1), ('second', 2), ('third', 3)])
```

### 4.2 OrderedDictçš„ç‰¹æ®Šæ–¹æ³•


**ğŸ”¸ ç§»åŠ¨å…ƒç´ åˆ°æœ«å°¾æˆ–å¼€å¤´**

```python
od = OrderedDict([('a', 1), ('b', 2), ('c', 3)])
print("åŸå§‹:", od)

# ç§»åŠ¨åˆ°æœ«å°¾
od.move_to_end('a')
print("ç§»åŠ¨aåˆ°æœ«å°¾:", od)  # OrderedDict([('b', 2), ('c', 3), ('a', 1)])

# ç§»åŠ¨åˆ°å¼€å¤´
od.move_to_end('c', last=False)
print("ç§»åŠ¨cåˆ°å¼€å¤´:", od)  # OrderedDict([('c', 3), ('b', 2), ('a', 1)])
```

**ğŸ”¸ å¼¹å‡ºå…ƒç´ ï¼ˆLIFO/FIFOï¼‰**

```python
od = OrderedDict([('a', 1), ('b', 2), ('c', 3)])

# åè¿›å…ˆå‡ºï¼ˆé»˜è®¤ï¼‰
last_item = od.popitem()
print("å¼¹å‡ºæœ€å:", last_item)  # ('c', 3)

# å…ˆè¿›å…ˆå‡º
first_item = od.popitem(last=False)
print("å¼¹å‡ºæœ€å‰:", first_item)  # ('a', 1)
```

### 4.3 OrderedDictå®é™…åº”ç”¨


**ğŸ“Š é…ç½®æ–‡ä»¶ç®¡ç†å™¨**

```python
class ConfigManager:
    def __init__(self):
        self.config = OrderedDict()
    
    def add_config(self, key, value, description=""):
        self.config[key] = {'value': value, 'desc': description}
    
    def show_config(self):
        print("é…ç½®é¡¹ï¼ˆæŒ‰æ·»åŠ é¡ºåºï¼‰:")
        for i, (key, info) in enumerate(self.config.items(), 1):
            print(f"{i}. {key}: {info['value']} ({info['desc']})")
    
    def move_priority(self, key):
        """å°†é…ç½®é¡¹ç§»åˆ°æœ€å‰é¢ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰"""
        if key in self.config:
            self.config.move_to_end(key, last=False)

# ä½¿ç”¨ç¤ºä¾‹
config = ConfigManager()
config.add_config('database_url', 'localhost:5432', 'æ•°æ®åº“è¿æ¥')
config.add_config('cache_size', 1024, 'ç¼“å­˜å¤§å°')
config.add_config('log_level', 'INFO', 'æ—¥å¿—çº§åˆ«')

config.show_config()
print("\nå°†log_levelè®¾ä¸ºé«˜ä¼˜å…ˆçº§:")
config.move_priority('log_level')
config.show_config()
```

---

## 5. ğŸš„ dequeåŒç«¯é˜Ÿåˆ—


### 5.1 dequeåŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šdequeæ˜¯"ä¸¤å¤´éƒ½èƒ½å¿«é€Ÿæ“ä½œçš„åˆ—è¡¨"

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**  
> æ™®é€šliståƒå•å‘é€šé“ï¼šåªèƒ½ä»ä¸€ç«¯å¿«é€Ÿè¿›å‡º  
> dequeåƒåŒå‘é€šé“ï¼šä¸¤ç«¯éƒ½æœ‰é—¨ï¼Œè¿›å‡ºéƒ½å¾ˆå¿«

**æ€§èƒ½å¯¹æ¯”**ï¼š

| æ“ä½œ | list | deque | è¯´æ˜ |
|------|------|-------|------|
| **å¤´éƒ¨æ’å…¥** | `O(n)` | `O(1)` | `dequeå¿«nå€` |
| **å¤´éƒ¨åˆ é™¤** | `O(n)` | `O(1)` | `dequeå¿«nå€` |
| **å°¾éƒ¨æ’å…¥** | `O(1)` | `O(1)` | `ç›¸åŒ` |
| **å°¾éƒ¨åˆ é™¤** | `O(1)` | `O(1)` | `ç›¸åŒ` |
| **ç´¢å¼•è®¿é—®** | `O(1)` | `O(n)` | `listæ›´å¿«` |

```python
from collections import deque

# åˆ›å»ºåŒç«¯é˜Ÿåˆ—
dq = deque([1, 2, 3])

# ä¸¤ç«¯éƒ½èƒ½å¿«é€Ÿæ“ä½œ
dq.appendleft(0)    # å·¦ç«¯æ·»åŠ 
dq.append(4)        # å³ç«¯æ·»åŠ 
print(dq)           # deque([0, 1, 2, 3, 4])

dq.popleft()        # å·¦ç«¯åˆ é™¤
dq.pop()            # å³ç«¯åˆ é™¤  
print(dq)           # deque([1, 2, 3])
```

### 5.2 dequeçš„é«˜çº§åŠŸèƒ½


**ğŸ”¸ é™åˆ¶é•¿åº¦çš„é˜Ÿåˆ—**

```python
# åˆ›å»ºæœ€å¤§é•¿åº¦ä¸º3çš„é˜Ÿåˆ—
limited_queue = deque(maxlen=3)

# è¶…å‡ºé•¿åº¦æ—¶è‡ªåŠ¨ä¸¢å¼ƒæ—§å…ƒç´ 
for i in range(5):
    limited_queue.append(i)
    print(f"æ·»åŠ {i}: {limited_queue}")

# è¾“å‡º:
# æ·»åŠ 0: deque([0], maxlen=3)
# æ·»åŠ 1: deque([0, 1], maxlen=3)  
# æ·»åŠ 2: deque([0, 1, 2], maxlen=3)
# æ·»åŠ 3: deque([1, 2, 3], maxlen=3)  # è‡ªåŠ¨ä¸¢å¼ƒ0
# æ·»åŠ 4: deque([2, 3, 4], maxlen=3)  # è‡ªåŠ¨ä¸¢å¼ƒ1
```

**ğŸ”¸ æ—‹è½¬æ“ä½œ**

```python
dq = deque([1, 2, 3, 4, 5])

# å‘å³æ—‹è½¬2ä½
dq.rotate(2)
print(dq)  # deque([4, 5, 1, 2, 3])

# å‘å·¦æ—‹è½¬3ä½
dq.rotate(-3)
print(dq)  # deque([2, 3, 4, 5, 1])
```

### 5.3 dequeå®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ æ»‘åŠ¨çª—å£ç®—æ³•**

```python
def sliding_window_max(nums, k):
    """æ‰¾åˆ°æ¯ä¸ªæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"""
    if not nums or k == 0:
        return []
    
    # ä½¿ç”¨dequeå­˜å‚¨ç´¢å¼•
    window = deque()
    result = []
    
    for i in range(len(nums)):
        # ç§»é™¤çª—å£å¤–çš„å…ƒç´ 
        while window and window[0] <= i - k:
            window.popleft()
        
        # ç§»é™¤æ¯”å½“å‰å…ƒç´ å°çš„å…ƒç´ ï¼ˆå®ƒä»¬ä¸å¯èƒ½æ˜¯æœ€å¤§å€¼ï¼‰
        while window and nums[window[-1]] < nums[i]:
            window.pop()
        
        window.append(i)
        
        # çª—å£å½¢æˆåå¼€å§‹è®°å½•ç»“æœ
        if i >= k - 1:
            result.append(nums[window[0]])
    
    return result

# æµ‹è¯•
nums = [1, 3, -1, -3, 5, 3, 6, 7]
k = 3
print(sliding_window_max(nums, k))  # [3, 3, 5, 5, 6, 7]
```

**ğŸ“Š æœ€è¿‘è®¿é—®è®°å½•**

```python
class RecentVisitor:
    def __init__(self, max_size=10):
        self.visitors = deque(maxlen=max_size)
    
    def add_visitor(self, visitor_id):
        # å¦‚æœå·²å­˜åœ¨ï¼Œå…ˆç§»é™¤
        if visitor_id in self.visitors:
            self.visitors.remove(visitor_id)
        # æ·»åŠ åˆ°æœ€å‰é¢
        self.visitors.appendleft(visitor_id)
    
    def get_recent_visitors(self):
        return list(self.visitors)

# ä½¿ç”¨ç¤ºä¾‹
recent = RecentVisitor(5)
for user_id in [101, 102, 103, 101, 104, 105, 106]:
    recent.add_visitor(user_id)
    print(f"æœ€è¿‘è®¿é—®: {recent.get_recent_visitors()}")
```

---

## 6. ğŸ·ï¸ namedtupleå‘½åå…ƒç»„


### 6.1 namedtupleåŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šnamedtupleæ˜¯"æœ‰åå­—çš„tuple"ï¼Œåƒæ˜¯è½»é‡çº§çš„ç±»

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**  
> æ™®é€štupleåƒåŒ¿åç›’å­ï¼š[å¼ ä¸‰, 25, å·¥ç¨‹å¸ˆ] - è¦è®°ä½ä½ç½®å«ä¹‰  
> namedtupleåƒæ ‡ç­¾ç›’å­ï¼šPerson(name=å¼ ä¸‰, age=25, job=å·¥ç¨‹å¸ˆ) - ä¸€ç›®äº†ç„¶

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… åƒtupleä¸€æ ·ä¸å¯å˜
- âœ… åƒclassä¸€æ ·æœ‰å±æ€§å
- âœ… å†…å­˜å ç”¨æ¯”classå°
- âœ… æ€§èƒ½æ¯”dictå¿«

```python
from collections import namedtuple

# åˆ›å»ºä¸€ä¸ªPersonç±»å‹
Person = namedtuple('Person', ['name', 'age', 'job'])

# åˆ›å»ºå®ä¾‹
p1 = Person('å¼ ä¸‰', 25, 'å·¥ç¨‹å¸ˆ')
print(p1.name)  # å¼ ä¸‰
print(p1.age)   # 25
print(p1[0])    # å¼ ä¸‰ (ä»ç„¶æ”¯æŒç´¢å¼•)
```

### 6.2 namedtupleçš„åˆ›å»ºæ–¹å¼


```python
# æ–¹å¼1ï¼šåˆ—è¡¨å½¢å¼
Point = namedtuple('Point', ['x', 'y'])

# æ–¹å¼2ï¼šå­—ç¬¦ä¸²å½¢å¼
Point = namedtuple('Point', 'x y')

# æ–¹å¼3ï¼šå­—ç¬¦ä¸²å½¢å¼ï¼ˆé€—å·åˆ†éš”ï¼‰
Point = namedtuple('Point', 'x, y')

# åˆ›å»ºå®ä¾‹
p = Point(10, 20)
print(f"ç‚¹çš„åæ ‡: ({p.x}, {p.y})")
```

### 6.3 namedtupleçš„æ–¹æ³•


**ğŸ”¸ å®ä¾‹æ–¹æ³•**

```python
Person = namedtuple('Person', ['name', 'age', 'job'])
p = Person('Alice', 30, 'Designer')

# _asdict(): è½¬æ¢ä¸ºå­—å…¸
print(p._asdict())  # {'name': 'Alice', 'age': 30, 'job': 'Designer'}

# _replace(): åˆ›å»ºæ–°å®ä¾‹ï¼ˆéƒ¨åˆ†æ›¿æ¢ï¼‰
p2 = p._replace(age=31)
print(p2)  # Person(name='Alice', age=31, job='Designer')

# _fields: æŸ¥çœ‹å­—æ®µå
print(Person._fields)  # ('name', 'age', 'job')
```

**ğŸ”¸ ç±»æ–¹æ³•**

```python
# _make(): ä»å¯è¿­ä»£å¯¹è±¡åˆ›å»º
data = ['Bob', 25, 'Teacher']
p = Person._make(data)
print(p)  # Person(name='Bob', age=25, job='Teacher')

# å¸¦é»˜è®¤å€¼çš„namedtuple
PersonWithDefaults = namedtuple('Person', ['name', 'age', 'job'])
PersonWithDefaults.__new__.__defaults__ = (None, 0, 'Unknown')

p = PersonWithDefaults('Charlie')
print(p)  # Person(name='Charlie', age=0, job='Unknown')
```

### 6.4 namedtupleå®é™…åº”ç”¨


**ğŸ“Š æ•°æ®åˆ†æä¸­çš„è®°å½•**

```python
# è‚¡ç¥¨æ•°æ®è®°å½•
Stock = namedtuple('Stock', ['symbol', 'price', 'volume', 'date'])

def analyze_stocks(stock_data):
    stocks = [Stock._make(data) for data in stock_data]
    
    # æŒ‰ä»·æ ¼æ’åº
    by_price = sorted(stocks, key=lambda s: s.price, reverse=True)
    print("ä»·æ ¼æœ€é«˜çš„3åªè‚¡ç¥¨:")
    for stock in by_price[:3]:
        print(f"{stock.symbol}: ${stock.price}")
    
    # è®¡ç®—æ€»äº¤æ˜“é‡
    total_volume = sum(s.volume for s in stocks)
    print(f"\næ€»äº¤æ˜“é‡: {total_volume:,}")

# ç¤ºä¾‹æ•°æ®
stock_data = [
    ['AAPL', 150.25, 1000000, '2024-01-15'],
    ['GOOGL', 2800.50, 500000, '2024-01-15'],
    ['MSFT', 380.75, 750000, '2024-01-15'],
    ['TSLA', 220.30, 2000000, '2024-01-15']
]

analyze_stocks(stock_data)
```

**ğŸ® æ¸¸æˆå¼€å‘ä¸­çš„åæ ‡ç³»ç»Ÿ**

```python
# 2Dæ¸¸æˆåæ ‡
Point2D = namedtuple('Point2D', ['x', 'y'])
Vector2D = namedtuple('Vector2D', ['dx', 'dy'])

class GameObject:
    def __init__(self, name, position):
        self.name = name
        self.position = position
    
    def move(self, vector):
        new_x = self.position.x + vector.dx
        new_y = self.position.y + vector.dy
        self.position = Point2D(new_x, new_y)
    
    def distance_to(self, other_pos):
        dx = self.position.x - other_pos.x
        dy = self.position.y - other_pos.y
        return (dx**2 + dy**2)**0.5

# æ¸¸æˆç¤ºä¾‹
player = GameObject("ç©å®¶", Point2D(0, 0))
enemy = GameObject("æ•Œäºº", Point2D(10, 5))

# ç©å®¶ç§»åŠ¨
move_vector = Vector2D(3, 2)
player.move(move_vector)

print(f"ç©å®¶ä½ç½®: {player.position}")
print(f"ä¸æ•Œäººè·ç¦»: {player.distance_to(enemy.position):.2f}")
```

---

## 7. ğŸ”— ChainMapå­—å…¸é“¾


### 7.1 ChainMapåŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šChainMapæ˜¯"å¤šä¸ªå­—å…¸çš„ç»Ÿä¸€æŸ¥è¯¢å…¥å£"

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**  
> æƒ³è±¡ä½ è¦æŸ¥ä¸€ä¸ªè‹±æ–‡å•è¯ï¼š
> - å…ˆæŸ¥è‹±æ±‰è¯å…¸ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
> - æŸ¥ä¸åˆ°å†æŸ¥è‹±è‹±è¯å…¸ï¼ˆæ¬¡ä¼˜å…ˆçº§ï¼‰
> - è¿˜æŸ¥ä¸åˆ°å†æŸ¥ä¸“ä¸šè¯å…¸ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
> 
> ChainMapå°±æ˜¯è¿™æ ·ä¸€ä¸ª"æ™ºèƒ½æŸ¥è¯¢ç³»ç»Ÿ"

```python
from collections import ChainMap

# åˆ›å»ºå¤šä¸ªå­—å…¸
user_config = {'theme': 'dark', 'lang': 'zh'}
default_config = {'theme': 'light', 'lang': 'en', 'timeout': 30}
system_config = {'debug': False, 'timeout': 60}

# é“¾æ¥å­—å…¸ï¼ˆä¼˜å…ˆçº§ä»å·¦åˆ°å³é€’å‡ï¼‰
config = ChainMap(user_config, default_config, system_config)

print(config['theme'])    # 'dark' (æ¥è‡ªuser_config)
print(config['timeout']) # 30 (æ¥è‡ªdefault_configï¼Œä¼˜å…ˆäºsystem_config)
print(config['debug'])   # False (æ¥è‡ªsystem_config)
```

### 7.2 ChainMapçš„ç‰¹æ€§


**ğŸ”¸ ä¿®æ”¹æ“ä½œåªå½±å“ç¬¬ä¸€ä¸ªå­—å…¸**

```python
config = ChainMap({'a': 1}, {'b': 2}, {'c': 3})

# æ–°å¢é”®å€¼å¯¹
config['d'] = 4
print(config.maps[0])  # {'a': 1, 'd': 4} - åªåœ¨ç¬¬ä¸€ä¸ªå­—å…¸ä¸­æ·»åŠ 

# ä¿®æ”¹ç°æœ‰é”®
config['b'] = 20  # å³ä½¿båœ¨ç¬¬äºŒä¸ªå­—å…¸ä¸­ï¼Œä¹Ÿä¼šåœ¨ç¬¬ä¸€ä¸ªå­—å…¸ä¸­åˆ›å»º
print(config.maps[0])  # {'a': 1, 'd': 4, 'b': 20}
print(config.maps[1])  # {'b': 2} - åŸå­—å…¸ä¸å˜
```

**ğŸ”¸ åŠ¨æ€æ·»åŠ å’Œç§»é™¤å­—å…¸**

```python
config = ChainMap({'user': 'admin'})

# æ·»åŠ æ–°å­—å…¸åˆ°é“¾çš„å¼€å¤´ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
config = config.new_child({'user': 'guest', 'role': 'visitor'})
print(config['user'])  # 'guest'

# ç§»é™¤æœ€å‰é¢çš„å­—å…¸
config = config.parents
print(config['user'])  # 'admin'
```

### 7.3 ChainMapå®é™…åº”ç”¨


**âš™ï¸ é…ç½®ç®¡ç†ç³»ç»Ÿ**

```python
class ConfigSystem:
    def __init__(self):
        # ç³»ç»Ÿé»˜è®¤é…ç½®
        self.system_config = {
            'database_host': 'localhost',
            'database_port': 5432,
            'cache_size': 1000,
            'debug': False,
            'log_level': 'INFO'
        }
        
        # ç¯å¢ƒé…ç½®
        self.env_config = {}
        
        # ç”¨æˆ·é…ç½®
        self.user_config = {}
        
        # åˆ›å»ºé…ç½®é“¾ï¼ˆç”¨æˆ· > ç¯å¢ƒ > ç³»ç»Ÿï¼‰
        self.config = ChainMap(
            self.user_config,
            self.env_config, 
            self.system_config
        )
    
    def load_env_config(self, env_settings):
        """åŠ è½½ç¯å¢ƒé…ç½®"""
        self.env_config.update(env_settings)
    
    def set_user_config(self, key, value):
        """è®¾ç½®ç”¨æˆ·é…ç½®"""
        self.user_config[key] = value
    
    def get_config(self, key):
        """è·å–é…ç½®å€¼"""
        return self.config.get(key)
    
    def show_config_source(self, key):
        """æ˜¾ç¤ºé…ç½®æ¥æº"""
        for i, config_dict in enumerate(self.config.maps):
            if key in config_dict:
                sources = ['ç”¨æˆ·é…ç½®', 'ç¯å¢ƒé…ç½®', 'ç³»ç»Ÿé…ç½®']
                return f"{key} = {config_dict[key]} (æ¥æº: {sources[i]})"
        return f"{key} æœªæ‰¾åˆ°"

# ä½¿ç”¨ç¤ºä¾‹
config_sys = ConfigSystem()

# åŠ è½½ç¯å¢ƒé…ç½®
config_sys.load_env_config({
    'database_host': 'prod-server.com',
    'debug': True
})

# è®¾ç½®ç”¨æˆ·é…ç½®
config_sys.set_user_config('log_level', 'DEBUG')

# æŸ¥çœ‹é…ç½®
print(config_sys.get_config('database_host'))  # prod-server.com
print(config_sys.get_config('log_level'))      # DEBUG
print(config_sys.get_config('cache_size'))     # 1000

# æŸ¥çœ‹é…ç½®æ¥æº
print(config_sys.show_config_source('database_host'))  # æ¥æº: ç¯å¢ƒé…ç½®
print(config_sys.show_config_source('log_level'))      # æ¥æº: ç”¨æˆ·é…ç½®
print(config_sys.show_config_source('cache_size'))     # æ¥æº: ç³»ç»Ÿé…ç½®
```

---

## 8. ğŸ› ï¸ è‡ªå®šä¹‰å®¹å™¨åŸºç±»


### 8.1 å®¹å™¨åŸºç±»æ¦‚è¿°


**ç®€å•ç†è§£**ï¼šè¿™äº›åŸºç±»æ˜¯"å®¹å™¨å¼€å‘çš„è„šæ‰‹æ¶"

> **ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**  
> å½“å†…ç½®å®¹å™¨ä¸å¤Ÿç”¨æ—¶ï¼Œå¯ä»¥åŸºäºè¿™äº›åŸºç±»åˆ›å»ºè‡ªå·±çš„å®¹å™¨ç±»å‹

**ä¸‰ä¸ªä¸»è¦åŸºç±»**ï¼š
- **UserDict**ï¼šè‡ªå®šä¹‰å­—å…¸çš„åŸºç¡€
- **UserList**ï¼šè‡ªå®šä¹‰åˆ—è¡¨çš„åŸºç¡€  
- **UserString**ï¼šè‡ªå®šä¹‰å­—ç¬¦ä¸²çš„åŸºç¡€

### 8.2 UserDictè‡ªå®šä¹‰å­—å…¸


```python
from collections import UserDict

class CaseInsensitiveDict(UserDict):
    """ä¸åŒºåˆ†å¤§å°å†™çš„å­—å…¸"""
    
    def __setitem__(self, key, value):
        # ç»Ÿä¸€è½¬ä¸ºå°å†™å­˜å‚¨
        super().__setitem__(key.lower(), value)
    
    def __getitem__(self, key):
        # æŸ¥è¯¢æ—¶ä¹Ÿè½¬ä¸ºå°å†™
        return super().__getitem__(key.lower())
    
    def __contains__(self, key):
        # inæ“ä½œç¬¦æ”¯æŒ
        return super().__contains__(key.lower())

# ä½¿ç”¨ç¤ºä¾‹
config = CaseInsensitiveDict()
config['Database_Host'] = 'localhost'
config['DATABASE_PORT'] = 5432

print(config['database_host'])  # localhost
print(config['DATABASE_HOST']) # localhost
print('Database_Port' in config)  # True
```

### 8.3 UserListè‡ªå®šä¹‰åˆ—è¡¨


```python
from collections import UserList

class UniqueList(UserList):
    """è‡ªåŠ¨å»é‡çš„åˆ—è¡¨"""
    
    def append(self, item):
        if item not in self.data:
            super().append(item)
    
    def extend(self, items):
        for item in items:
            self.append(item)  # ä½¿ç”¨æˆ‘ä»¬çš„appendæ–¹æ³•
    
    def insert(self, index, item):
        if item not in self.data:
            super().insert(index, item)

# ä½¿ç”¨ç¤ºä¾‹
unique_fruits = UniqueList(['apple', 'banana'])
unique_fruits.append('apple')    # ä¸ä¼šé‡å¤æ·»åŠ 
unique_fruits.append('orange')   # æ–°å…ƒç´ ä¼šæ·»åŠ 
unique_fruits.extend(['banana', 'grape', 'apple'])

print(unique_fruits)  # ['apple', 'banana', 'orange', 'grape']
```

### 8.4 UserStringè‡ªå®šä¹‰å­—ç¬¦ä¸²


```python
from collections import UserString

class SensitiveString(UserString):
    """æ•æ„Ÿä¿¡æ¯å­—ç¬¦ä¸²ï¼ˆæ‰“å°æ—¶éšè—ï¼‰"""
    
    def __str__(self):
        if len(self.data) <= 4:
            return '*' * len(self.data)
        return self.data[:2] + '*' * (len(self.data) - 4) + self.data[-2:]
    
    def __repr__(self):
        return f"SensitiveString('{str(self)}')"
    
    def reveal(self):
        """æ˜¾ç¤ºçœŸå®å†…å®¹"""
        return self.data

# ä½¿ç”¨ç¤ºä¾‹
password = SensitiveString("my_secret_password123")
print(password)           # my*********************23
print(repr(password))     # SensitiveString('my*********************23')
print(password.reveal())  # my_secret_password123

# ä»ç„¶æ”¯æŒå­—ç¬¦ä¸²æ“ä½œ
print(len(password))      # 22
print(password.upper())   # MY*********************23
```

### 8.5 ç»¼åˆåº”ç”¨ç¤ºä¾‹


**ğŸ“Š æ™ºèƒ½æ•°æ®å®¹å™¨**

```python
class SmartDataContainer(UserDict):
    """æ™ºèƒ½æ•°æ®å®¹å™¨ï¼šæ”¯æŒç»Ÿè®¡ã€å†å²è®°å½•ã€è‡ªåŠ¨ç±»å‹è½¬æ¢"""
    
    def __init__(self):
        super().__init__()
        self.access_count = defaultdict(int)  # è®¿é—®ç»Ÿè®¡
        self.history = defaultdict(list)      # ä¿®æ”¹å†å²
    
    def __setitem__(self, key, value):
        # è®°å½•å†å²
        if key in self.data:
            self.history[key].append(self.data[key])
        
        # è‡ªåŠ¨ç±»å‹è½¬æ¢
        if isinstance(value, str) and value.isdigit():
            value = int(value)
        
        super().__setitem__(key, value)
    
    def __getitem__(self, key):
        # ç»Ÿè®¡è®¿é—®æ¬¡æ•°
        self.access_count[key] += 1
        return super().__getitem__(key)
    
    def get_stats(self):
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        return {
            'total_keys': len(self.data),
            'most_accessed': max(self.access_count.items(), 
                               key=lambda x: x[1], default=('None', 0)),
            'keys_with_history': len(self.history)
        }
    
    def get_history(self, key):
        """è·å–keyçš„ä¿®æ”¹å†å²"""
        return self.history.get(key, [])

# ä½¿ç”¨ç¤ºä¾‹
smart_data = SmartDataContainer()

# æ·»åŠ æ•°æ®
smart_data['name'] = 'Alice'
smart_data['age'] = '25'      # è‡ªåŠ¨è½¬æ¢ä¸ºint
smart_data['score'] = '98.5'  # ä¸æ˜¯æ•´æ•°ï¼Œä¿æŒstr

# ä¿®æ”¹æ•°æ®
smart_data['age'] = '26'      # è®°å½•å†å²

# è®¿é—®æ•°æ®
print(smart_data['name'])     # Alice
print(smart_data['age'])      # 26 (intç±»å‹)
print(smart_data['age'])      # å†æ¬¡è®¿é—®

# æŸ¥çœ‹ç»Ÿè®¡
print(smart_data.get_stats())
# {'total_keys': 3, 'most_accessed': ('age', 2), 'keys_with_history': 1}

# æŸ¥çœ‹å†å²
print(smart_data.get_history('age'))  # [25]
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 collectionsæ¨¡å—æ ¸å¿ƒä»·å€¼


> **ğŸ¯ ä¸€å¥è¯æ€»ç»“**  
> collectionsæ¨¡å—æä¾›äº†æ¯”å†…ç½®ç±»å‹æ›´ä¸“ä¸šã€æ›´é«˜æ•ˆçš„å®¹å™¨å·¥å…·

**ğŸ“Œ å¿…è®°è¦ç‚¹**

```
ğŸ”¸ Counterï¼šè‡ªåŠ¨è®¡æ•°å­—å…¸ï¼Œç»Ÿè®¡ç¥å™¨
ğŸ”¸ defaultdictï¼šæ°¸ä¸æŠ¥KeyErrorçš„å­—å…¸ï¼Œåˆ†ç»„åˆ©å™¨
ğŸ”¸ OrderedDictï¼šè®°ä½é¡ºåºçš„å­—å…¸ï¼Œåœ¨è€ç‰ˆæœ¬Pythonä¸­å¾ˆé‡è¦
ğŸ”¸ dequeï¼šåŒç«¯å¿«é€Ÿæ“ä½œçš„é˜Ÿåˆ—ï¼Œæ€§èƒ½ä¼˜åŒ–ç¥å™¨
ğŸ”¸ namedtupleï¼šæœ‰åå­—çš„tupleï¼Œè½»é‡çº§æ•°æ®ç»“æ„
ğŸ”¸ ChainMapï¼šå¤šå­—å…¸ç»Ÿä¸€æŸ¥è¯¢ï¼Œé…ç½®ç®¡ç†åˆ©å™¨
ğŸ”¸ UserXXXï¼šè‡ªå®šä¹‰å®¹å™¨çš„åŸºç±»ï¼Œæ‰©å±•æ€§å·¥å…·
```

### 9.2 ä½¿ç”¨åœºæ™¯é€ŸæŸ¥è¡¨


| éœ€æ±‚åœºæ™¯ | æ¨èå·¥å…· | ç†ç”± |
|---------|---------|------|
| **ç»Ÿè®¡å…ƒç´ é¢‘æ¬¡** | `Counter` | `è‡ªåŠ¨è®¡æ•°ï¼Œmost_common()å¾ˆæ–¹ä¾¿` |
| **åˆ†ç»„æ•°æ®** | `defaultdict(list)` | `ä¸ç”¨æ£€æŸ¥keyå­˜åœ¨ï¼Œç›´æ¥append` |
| **éœ€è¦ä¿è¯é¡ºåº** | `OrderedDict` | `æ˜¾å¼ä¿è¯é¡ºåºï¼Œæœ‰ç§»åŠ¨æ–¹æ³•` |
| **é¢‘ç¹å¤´å°¾æ“ä½œ** | `deque` | `ä¸¤ç«¯æ“ä½œéƒ½æ˜¯O(1)` |
| **è½»é‡çº§æ•°æ®ç»“æ„** | `namedtuple` | `æ¯”classçœå†…å­˜ï¼Œæ¯”tupleæ˜“è¯»` |
| **å¤šçº§é…ç½®** | `ChainMap` | `ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼Œé…ç½®ç»§æ‰¿` |
| **è‡ªå®šä¹‰å®¹å™¨** | `UserDict/List/String` | `ç»§æ‰¿å‹å¥½ï¼ŒåŠŸèƒ½å®Œæ•´` |

### 9.3 æ€§èƒ½è®°å¿†è¦ç‚¹


```
âš¡ æ€§èƒ½å…³é”®ç‚¹ï¼š
â€¢ dequeå¤´éƒ¨æ“ä½œ >> listå¤´éƒ¨æ“ä½œ
â€¢ namedtupleå†…å­˜å ç”¨ < classå†…å­˜å ç”¨  
â€¢ Counterç»Ÿè®¡ >> æ‰‹å†™dictè®¡æ•°
â€¢ defaultdictåˆ†ç»„ >> æ‰‹å†™ifåˆ¤æ–­

ğŸ§  è®°å¿†æŠ€å·§ï¼š
â€¢ Counteræ•°æ•°ç”¨ï¼Œdefaultdictåˆ†ç»„ç”¨
â€¢ dequeä¸¤å¤´å¿«ï¼Œnamedtupleæœ‰åå¥½
â€¢ ChainMapé“¾æŸ¥æ‰¾ï¼ŒUserXXXè‡ªå®šä¹‰
```

### 9.4 å®è·µå»ºè®®


**ğŸ”§ é€‰æ‹©æŒ‡å—**
1. **ç®€å•åœºæ™¯**ï¼šä¼˜å…ˆä½¿ç”¨å†…ç½®ç±»å‹ï¼ˆlistã€dictã€tupleï¼‰
2. **ç‰¹å®šéœ€æ±‚**ï¼šé€‰æ‹©å¯¹åº”çš„collectionså·¥å…·
3. **æ€§èƒ½å…³é”®**ï¼šdequeç”¨äºå¤´å°¾æ“ä½œï¼ŒCounterç”¨äºç»Ÿè®¡
4. **ä»£ç æ¸…æ™°**ï¼šnamedtupleä»£æ›¿å¤æ‚tupleï¼Œdefaultdictä»£æ›¿keyæ£€æŸ¥

**âš ï¸ æ³¨æ„äº‹é¡¹**
- OrderedDictåœ¨Python 3.7+çš„ä¼˜åŠ¿ä¸æ˜æ˜¾
- dequeä¸æ”¯æŒå¿«é€Ÿç´¢å¼•è®¿é—®
- namedtupleæ˜¯ä¸å¯å˜çš„
- ChainMapä¿®æ”¹åªå½±å“ç¬¬ä¸€ä¸ªå­—å…¸

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è®¡æ•°Counterå¾ˆæ–¹ä¾¿ï¼Œåˆ†ç»„defaultdictä¸ç”¨æ£€
é¡ºåºOrderedDictæ¥ä¿è¯ï¼Œä¸¤ç«¯æ“ä½œdequeæœ€å¿«
æœ‰ånamedtupleè½»åˆå¥½ï¼Œé“¾å¼æŸ¥æ‰¾ChainMapå·§
è‡ªå®šä¹‰å®¹å™¨UserXXXï¼Œä¸“ä¸šå·¥å…·æ•ˆç‡é«˜
```