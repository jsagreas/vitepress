---
title: 4ã€æ¨¡å—æŸ¥æ‰¾ä¸åŠ è½½
---
## ğŸ“š ç›®å½•

1. [æ¨¡å—ç³»ç»ŸåŸºç¡€æ¦‚å¿µ](#1-æ¨¡å—ç³»ç»ŸåŸºç¡€æ¦‚å¿µ)
2. [æ¨¡å—æŸ¥æ‰¾ç®—æ³•è¯¦è§£](#2-æ¨¡å—æŸ¥æ‰¾ç®—æ³•è¯¦è§£)
3. [importlibæ¨¡å—æ·±å…¥](#3-importlibæ¨¡å—æ·±å…¥)
4. [åŠ¨æ€å¯¼å…¥æŠ€æœ¯](#4-åŠ¨æ€å¯¼å…¥æŠ€æœ¯)
5. [æ¨¡å—åŠ è½½é’©å­æœºåˆ¶](#5-æ¨¡å—åŠ è½½é’©å­æœºåˆ¶)
6. [è‡ªå®šä¹‰å¯¼å…¥å™¨å®ç°](#6-è‡ªå®šä¹‰å¯¼å…¥å™¨å®ç°)
7. [æ¨¡å—å…ƒæ•°æ®ç®¡ç†](#7-æ¨¡å—å…ƒæ•°æ®ç®¡ç†)
8. [æ¨¡å—ä¾èµ–ç®¡ç†](#8-æ¨¡å—ä¾èµ–ç®¡ç†)
9. [å¯¼å…¥é™·é˜±é¿å…](#9-å¯¼å…¥é™·é˜±é¿å…)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ¨¡å—ç³»ç»ŸåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ¨¡å—ç³»ç»Ÿ


**ç®€å•ç†è§£**ï¼šæ¨¡å—ç³»ç»Ÿå°±åƒå›¾ä¹¦é¦†çš„ç®¡ç†ç³»ç»Ÿ
```
å›¾ä¹¦é¦†ç±»æ¯”ï¼š
ğŸ“š æ¨¡å— = ä¸€æœ¬ä¹¦
ğŸ“‚ åŒ… = ä¹¦æ¶ä¸Šçš„åˆ†ç±»
ğŸ” å¯¼å…¥ = æ‰¾ä¹¦å¹¶å€Ÿé˜…
ğŸ“‹ sys.modules = å·²å€Ÿä¹¦ç±ç™»è®°å†Œ
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**
- **æ¨¡å—(Module)**ï¼šä¸€ä¸ª`.py`æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œé‡Œé¢åŒ…å«å‡½æ•°ã€ç±»ã€å˜é‡
- **åŒ…(Package)**ï¼šåŒ…å«å¤šä¸ªæ¨¡å—çš„æ–‡ä»¶å¤¹ï¼Œå¿…é¡»æœ‰`__init__.py`æ–‡ä»¶
- **å¯¼å…¥(Import)**ï¼šæŠŠå…¶ä»–æ–‡ä»¶çš„ä»£ç å¼•å…¥åˆ°å½“å‰æ–‡ä»¶ä½¿ç”¨çš„è¿‡ç¨‹

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—ç³»ç»Ÿ


**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**
```
ä¸ç”¨æ¨¡å—ç³»ç»Ÿï¼š
å°±åƒæŠŠæ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€ä¸ªæˆ¿é—´é‡Œ
- æ‰¾ä¸œè¥¿å¾ˆéš¾
- å®¹æ˜“å¼„ä¸¢
- æ— æ³•é‡å¤ä½¿ç”¨

ä½¿ç”¨æ¨¡å—ç³»ç»Ÿï¼š
å°±åƒæŠŠä¸œè¥¿åˆ†ç±»æ•´ç†åˆ°ä¸åŒæˆ¿é—´
- äº•äº•æœ‰æ¡
- å®¹æ˜“æ‰¾åˆ°
- å¯ä»¥é‡å¤ä½¿ç”¨
```

**ğŸ¯ å®é™…å¥½å¤„**
- **ä»£ç é‡ç”¨**ï¼šå†™ä¸€æ¬¡ï¼Œåˆ°å¤„ä½¿ç”¨
- **å‘½åç©ºé—´**ï¼šé¿å…å˜é‡åå†²çª
- **ä»£ç ç»„ç»‡**ï¼šé€»è¾‘æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤
- **å›¢é˜Ÿåä½œ**ï¼šä¸åŒäººå†™ä¸åŒæ¨¡å—

### 1.3 æ¨¡å—çš„ç”Ÿå‘½å‘¨æœŸ


```
æ¨¡å—ç”Ÿå‘½å‘¨æœŸï¼š
æŸ¥æ‰¾ â†’ åŠ è½½ â†’ ç¼–è¯‘ â†’ æ‰§è¡Œ â†’ ç¼“å­˜
  â†“      â†“      â†“      â†“      â†“
æ‰¾åˆ°æ–‡ä»¶ è¯»å–å†…å®¹ ç¼–è¯‘å­—èŠ‚ç  è¿è¡Œä»£ç  å­˜å…¥å†…å­˜
```

---

## 2. ğŸ” æ¨¡å—æŸ¥æ‰¾ç®—æ³•è¯¦è§£


### 2.1 Pythonå¦‚ä½•æ‰¾åˆ°æ¨¡å—


**ğŸ”¸ æŸ¥æ‰¾é¡ºåºï¼ˆé‡è¦ï¼ï¼‰**
```
æŸ¥æ‰¾ä¼˜å…ˆçº§ï¼š
1. å†…ç½®æ¨¡å—ï¼ˆbuilt-inï¼‰
2. å½“å‰å·¥ä½œç›®å½•
3. PYTHONPATHç¯å¢ƒå˜é‡
4. æ ‡å‡†åº“ç›®å½•
5. site-packagesç›®å½•
```

**ğŸ’¡ é€šä¿—è§£é‡Š**
```
å°±åƒæ‰¾äººçš„é¡ºåºï¼š
1. å…ˆçœ‹èº«è¾¹æœ‰æ²¡æœ‰ï¼ˆå†…ç½®æ¨¡å—ï¼‰
2. å†çœ‹å½“å‰æˆ¿é—´ï¼ˆå½“å‰ç›®å½•ï¼‰
3. ç„¶åçœ‹å¸¸å»çš„åœ°æ–¹ï¼ˆPYTHONPATHï¼‰
4. æœ€åçœ‹å­¦æ ¡ã€å›¾ä¹¦é¦†ï¼ˆæ ‡å‡†åº“ï¼‰
5. å»å•†åº—ä¹°ï¼ˆç¬¬ä¸‰æ–¹åŒ…ï¼‰
```

### 2.2 sys.pathè¯¦è§£


**ğŸ”§ ä»€ä¹ˆæ˜¯sys.path**
```python
import sys
print("PythonæŸ¥æ‰¾æ¨¡å—çš„è·¯å¾„ï¼š")
for i, path in enumerate(sys.path):
    print(f"{i+1}. {path}")
```

**ğŸ“‹ sys.pathå†…å®¹è§£é‡Š**
```
sys.pathå°±åƒä¸€å¼ åœ°å›¾ï¼Œå‘Šè¯‰Pythonå»å“ªé‡Œæ‰¾æ¨¡å—ï¼š
- ç¬¬ä¸€ä¸ªé€šå¸¸æ˜¯å½“å‰ç›®å½•ï¼ˆ''æˆ–'.'ï¼‰
- ç„¶åæ˜¯PYTHONPATHè®¾ç½®çš„è·¯å¾„
- æ¥ç€æ˜¯æ ‡å‡†åº“è·¯å¾„
- æœ€åæ˜¯ç¬¬ä¸‰æ–¹åŒ…è·¯å¾„
```

### 2.3 æ¨¡å—æŸ¥æ‰¾ç¤ºä¾‹


**ğŸ¯ å®é™…æŸ¥æ‰¾è¿‡ç¨‹**
```python
# å½“ä½ å†™ import math æ—¶ï¼ŒPythonåšäº†ä»€ä¹ˆï¼Ÿ

# æ­¥éª¤1ï¼šæ£€æŸ¥æ˜¯å¦æ˜¯å†…ç½®æ¨¡å—
if 'math' in sys.builtin_module_names:
    return load_builtin('math')

# æ­¥éª¤2ï¼šåœ¨sys.pathä¸­é€ä¸ªç›®å½•æŸ¥æ‰¾
for directory in sys.path:
    # æŸ¥æ‰¾ math.py
    module_path = os.path.join(directory, 'math.py')
    if os.path.exists(module_path):
        return load_module(module_path)
    
    # æŸ¥æ‰¾ mathåŒ…ç›®å½•
    package_path = os.path.join(directory, 'math', '__init__.py')
    if os.path.exists(package_path):
        return load_package(package_path)

# æ‰¾ä¸åˆ°å°±æŠ¥é”™
raise ModuleNotFoundError("No module named 'math'")
```

### 2.4 æŸ¥æ‰¾è·¯å¾„çš„åŠ¨æ€ä¿®æ”¹


**ğŸ”§ è¿è¡Œæ—¶ä¿®æ”¹æŸ¥æ‰¾è·¯å¾„**
```python
import sys
import os

# æ·»åŠ æ–°çš„æœç´¢è·¯å¾„
new_path = "/my/custom/modules"
if new_path not in sys.path:
    sys.path.insert(0, new_path)  # æ’å…¥åˆ°æœ€å‰é¢ï¼Œä¼˜å…ˆçº§æœ€é«˜

# æˆ–è€…æ·»åŠ åˆ°æœ€å
sys.path.append("/another/path")

# åˆ é™¤æŸä¸ªè·¯å¾„
if "/unwanted/path" in sys.path:
    sys.path.remove("/unwanted/path")
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
ä¿®æ”¹sys.pathçš„å»ºè®®ï¼š
âœ… åœ¨ç¨‹åºå¼€å§‹æ—¶ä¿®æ”¹
âœ… ä½¿ç”¨ç»å¯¹è·¯å¾„
âœ… æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
âŒ ä¸è¦é¢‘ç¹ä¿®æ”¹
âŒ ä¸è¦åœ¨æ¨¡å—ä¸­ä¿®æ”¹
```

---

## 3. ğŸ›  importlibæ¨¡å—æ·±å…¥


### 3.1 importlibæ¨¡å—ç®€ä»‹


**ğŸ”¸ ä»€ä¹ˆæ˜¯importlib**
```
importlib = import libraryï¼ˆå¯¼å…¥åº“ï¼‰
ä½œç”¨ï¼šPythonå¯¼å…¥ç³»ç»Ÿçš„"å¹•åæ“æ§è€…"
ç±»æ¯”ï¼šå¦‚æœimportæ˜¯"é­”æ³•"ï¼Œimportlibå°±æ˜¯"é­”æ³•ä¹¦"
```

**ğŸ“š ä¸»è¦åŠŸèƒ½**
- **åŠ¨æ€å¯¼å…¥**ï¼šç¨‹åºè¿è¡Œæ—¶å†³å®šå¯¼å…¥ä»€ä¹ˆ
- **é‡æ–°åŠ è½½**ï¼šåˆ·æ–°å·²å¯¼å…¥çš„æ¨¡å—
- **è‡ªå®šä¹‰å¯¼å…¥**ï¼šåˆ›å»ºè‡ªå·±çš„å¯¼å…¥è§„åˆ™
- **å¯¼å…¥æ£€æŸ¥**ï¼šæŸ¥çœ‹æ¨¡å—ä¿¡æ¯

### 3.2 importlibæ ¸å¿ƒå‡½æ•°


**ğŸ”§ import_module() - åŠ¨æ€å¯¼å…¥**
```python
import importlib

# ç­‰ä»·äº import math
math_module = importlib.import_module('math')
print(math_module.pi)  # 3.141592653589793

# ç­‰ä»·äº from datetime import date
date_class = importlib.import_module('datetime.date')

# ç›¸å¯¹å¯¼å…¥ï¼ˆåœ¨åŒ…å†…ä½¿ç”¨ï¼‰
# ç­‰ä»·äº from . import sibling_module
sibling = importlib.import_module('.sibling', package='mypackage')
```

**ğŸ”„ reload() - é‡æ–°åŠ è½½æ¨¡å—**
```python
import importlib
import my_module

# ä¿®æ”¹äº†my_module.pyæ–‡ä»¶åï¼Œé‡æ–°åŠ è½½
importlib.reload(my_module)

# æ³¨æ„ï¼šåªé‡æ–°åŠ è½½æ¨¡å—æœ¬èº«ï¼Œä¸é‡æ–°åŠ è½½å®ƒå¯¼å…¥çš„å…¶ä»–æ¨¡å—
```

**ğŸ” utilæ¨¡å— - å®ç”¨å·¥å…·**
```python
import importlib.util
import sys

# æ£€æŸ¥æ¨¡å—æ˜¯å¦å­˜åœ¨
spec = importlib.util.find_spec('nonexistent_module')
if spec is None:
    print("æ¨¡å—ä¸å­˜åœ¨")

# ä»æ–‡ä»¶è·¯å¾„åŠ è½½æ¨¡å—
spec = importlib.util.spec_from_file_location("my_module", "/path/to/my_module.py")
my_module = importlib.util.module_from_spec(spec)
sys.modules["my_module"] = my_module  # å¯é€‰ï¼šæ·»åŠ åˆ°æ¨¡å—ç¼“å­˜
spec.loader.exec_module(my_module)
```

### 3.3 importlibå®é™…åº”ç”¨


**ğŸ¯ æ’ä»¶ç³»ç»Ÿç¤ºä¾‹**
```python
import importlib
import os

class PluginManager:
    def __init__(self, plugin_dir):
        self.plugin_dir = plugin_dir
        self.plugins = {}
    
    def load_plugins(self):
        """åŠ¨æ€åŠ è½½æ’ä»¶ç›®å½•ä¸­çš„æ‰€æœ‰æ¨¡å—"""
        for filename in os.listdir(self.plugin_dir):
            if filename.endswith('.py') and not filename.startswith('_'):
                module_name = filename[:-3]  # å»æ‰.pyåç¼€
                try:
                    # åŠ¨æ€å¯¼å…¥æ’ä»¶
                    module = importlib.import_module(f'plugins.{module_name}')
                    self.plugins[module_name] = module
                    print(f"å·²åŠ è½½æ’ä»¶: {module_name}")
                except ImportError as e:
                    print(f"åŠ è½½æ’ä»¶å¤±è´¥ {module_name}: {e}")
    
    def get_plugin(self, name):
        return self.plugins.get(name)

# ä½¿ç”¨ç¤ºä¾‹
plugin_manager = PluginManager('plugins')
plugin_manager.load_plugins()
```

---

## 4. âš¡ åŠ¨æ€å¯¼å…¥æŠ€æœ¯


### 4.1 ä»€ä¹ˆæ˜¯åŠ¨æ€å¯¼å…¥


**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**
```
é™æ€å¯¼å…¥ï¼š
å°±åƒäº‹å…ˆåˆ—å¥½è´­ç‰©æ¸…å•ï¼Œåˆ°å•†åº—æŒ‰æ¸…å•ä¹°ä¸œè¥¿
import math  # ç¨‹åºå¼€å§‹å°±çŸ¥é“è¦ç”¨math

åŠ¨æ€å¯¼å…¥ï¼š
å°±åƒåˆ°äº†å•†åº—æ‰å†³å®šä¹°ä»€ä¹ˆï¼Œæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©
module = importlib.import_module(user_choice)  # è¿è¡Œæ—¶å†³å®š
```

### 4.2 åŠ¨æ€å¯¼å…¥çš„åº”ç”¨åœºæ™¯


**ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯**

**åœºæ™¯1ï¼šæ ¹æ®é…ç½®åŠ è½½ä¸åŒæ¨¡å—**
```python
import importlib

# é…ç½®æ–‡ä»¶æŒ‡å®šä½¿ç”¨å“ªä¸ªæ•°æ®åº“é©±åŠ¨
config = {'database_driver': 'mysql'}  # æˆ–è€… 'postgresql', 'sqlite'

# åŠ¨æ€å¯¼å…¥å¯¹åº”çš„é©±åŠ¨
driver_name = config['database_driver']
db_module = importlib.import_module(f'drivers.{driver_name}')
connection = db_module.connect()
```

**åœºæ™¯2ï¼šæŒ‰éœ€åŠ è½½åŠŸèƒ½æ¨¡å—**
```python
def get_calculator(calc_type):
    """æ ¹æ®ç±»å‹è¿”å›ä¸åŒçš„è®¡ç®—å™¨"""
    calculators = {
        'basic': 'calculators.basic',
        'scientific': 'calculators.scientific',
        'financial': 'calculators.financial'
    }
    
    if calc_type in calculators:
        module_name = calculators[calc_type]
        module = importlib.import_module(module_name)
        return module.Calculator()
    else:
        raise ValueError(f"æœªçŸ¥çš„è®¡ç®—å™¨ç±»å‹: {calc_type}")

# ä½¿ç”¨
calc = get_calculator('scientific')
result = calc.sin(3.14159)
```

**åœºæ™¯3ï¼šæ’ä»¶æ¶æ„**
```python
import os
import importlib

def load_plugins(plugin_directory):
    """æ‰«æç›®å½•å¹¶åŠ è½½æ‰€æœ‰æ’ä»¶"""
    plugins = []
    
    for file in os.listdir(plugin_directory):
        if file.endswith('_plugin.py'):
            module_name = file[:-3]  # å»æ‰.py
            try:
                # åŠ¨æ€å¯¼å…¥æ’ä»¶
                plugin_module = importlib.import_module(f'plugins.{module_name}')
                
                # å‡è®¾æ¯ä¸ªæ’ä»¶éƒ½æœ‰ä¸€ä¸ªPluginç±»
                if hasattr(plugin_module, 'Plugin'):
                    plugin_instance = plugin_module.Plugin()
                    plugins.append(plugin_instance)
                    print(f"âœ… åŠ è½½æ’ä»¶: {module_name}")
                    
            except Exception as e:
                print(f"âŒ åŠ è½½æ’ä»¶å¤±è´¥ {module_name}: {e}")
    
    return plugins
```

### 4.3 åŠ¨æ€å¯¼å…¥çš„é«˜çº§æŠ€å·§


**ğŸ”§ å­—ç¬¦ä¸²åˆ°æ¨¡å—å±æ€§çš„è½¬æ¢**
```python
def get_function_by_path(function_path):
    """
    é€šè¿‡å­—ç¬¦ä¸²è·¯å¾„è·å–å‡½æ•°
    ä¾‹å¦‚: 'math.sqrt' -> mathæ¨¡å—çš„sqrtå‡½æ•°
    """
    module_name, function_name = function_path.rsplit('.', 1)
    module = importlib.import_module(module_name)
    return getattr(module, function_name)

# ä½¿ç”¨ç¤ºä¾‹
sqrt_func = get_function_by_path('math.sqrt')
result = sqrt_func(16)  # 4.0

# æ›´å¤æ‚çš„ä¾‹å­
json_loads = get_function_by_path('json.loads')
data = json_loads('{"name": "å¼ ä¸‰"}')
```

**ğŸ”„ å»¶è¿Ÿå¯¼å…¥ï¼ˆLazy Importï¼‰**
```python
class LazyModule:
    """å»¶è¿Ÿå¯¼å…¥æ¨¡å—ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶æ‰å¯¼å…¥"""
    
    def __init__(self, module_name):
        self.module_name = module_name
        self._module = None
    
    def __getattr__(self, name):
        if self._module is None:
            print(f"é¦–æ¬¡ä½¿ç”¨ï¼Œæ­£åœ¨å¯¼å…¥ {self.module_name}...")
            self._module = importlib.import_module(self.module_name)
        return getattr(self._module, name)

# ä½¿ç”¨ç¤ºä¾‹
numpy = LazyModule('numpy')  # è¿™æ—¶è¿˜æ²¡æœ‰çœŸæ­£å¯¼å…¥numpy

# åªæœ‰å½“çœŸæ­£ä½¿ç”¨æ—¶æ‰å¯¼å…¥
array = numpy.array([1, 2, 3])  # è¿™æ—¶æ‰å¯¼å…¥numpy
```

---

## 5. ğŸª æ¨¡å—åŠ è½½é’©å­æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯æ¨¡å—åŠ è½½é’©å­


**ğŸ’¡ é€šä¿—ç†è§£**
```
é’©å­ï¼ˆHookï¼‰å°±åƒ"æ‹¦æˆªå™¨"ï¼š
ğŸ£ é’©å­ = åœ¨æ²³é‡Œæ”¾ä¸ªç½‘
ğŸŸ æ¨¡å—åŠ è½½ = é±¼æ¸¸è¿‡æ¥
ğŸ“¦ è‡ªå®šä¹‰å¤„ç† = å†³å®šæ€ä¹ˆå¤„ç†è¿™æ¡é±¼

å½“Pythonè¦åŠ è½½æ¨¡å—æ—¶ï¼Œé’©å­å¯ä»¥ï¼š
- æ‹¦æˆªåŠ è½½è¿‡ç¨‹
- ä¿®æ”¹åŠ è½½è¡Œä¸º
- æ·»åŠ é¢å¤–å¤„ç†
```

### 5.2 sys.meta_pathè¯¦è§£


**ğŸ” å…ƒè·¯å¾„æŸ¥æ‰¾å™¨**
```python
import sys

print("å½“å‰çš„å…ƒè·¯å¾„æŸ¥æ‰¾å™¨ï¼š")
for i, finder in enumerate(sys.meta_path):
    print(f"{i+1}. {finder}")

# è¾“å‡ºç±»ä¼¼ï¼š
# 1. <class '_frozen_importlib.BuiltinImporter'>      # å†…ç½®æ¨¡å—
# 2. <class '_frozen_importlib.FrozenImporter'>       # å†»ç»“æ¨¡å—
# 3. <class '_frozen_importlib_external.PathFinder'>  # è·¯å¾„æŸ¥æ‰¾å™¨
```

**ğŸ”§ è‡ªå®šä¹‰å…ƒè·¯å¾„æŸ¥æ‰¾å™¨**
```python
import sys
import importlib.util

class CustomFinder:
    """è‡ªå®šä¹‰æ¨¡å—æŸ¥æ‰¾å™¨"""
    
    def find_spec(self, fullname, path, target=None):
        """æŸ¥æ‰¾æ¨¡å—è§„èŒƒ"""
        print(f"ğŸ” æ­£åœ¨æŸ¥æ‰¾æ¨¡å—: {fullname}")
        
        # åªå¤„ç†ç‰¹å®šå‰ç¼€çš„æ¨¡å—
        if fullname.startswith('custom_'):
            print(f"âœ… æ‰¾åˆ°è‡ªå®šä¹‰æ¨¡å—: {fullname}")
            # è¿™é‡Œå¯ä»¥è¿”å›è‡ªå®šä¹‰çš„ModuleSpec
            # ç®€å•ç¤ºä¾‹ï¼šè¿”å›Noneè®©å…¶ä»–æŸ¥æ‰¾å™¨å¤„ç†
            return None
        
        # ä¸å¤„ç†å…¶ä»–æ¨¡å—
        return None

# æ³¨å†Œè‡ªå®šä¹‰æŸ¥æ‰¾å™¨
custom_finder = CustomFinder()
sys.meta_path.insert(0, custom_finder)  # æ’å…¥åˆ°æœ€å‰é¢

# æµ‹è¯•
try:
    import custom_test_module  # ä¼šè§¦å‘æˆ‘ä»¬çš„æŸ¥æ‰¾å™¨
except ModuleNotFoundError:
    print("æ¨¡å—æœªæ‰¾åˆ°ï¼Œä½†æˆ‘ä»¬çœ‹åˆ°äº†æŸ¥æ‰¾è¿‡ç¨‹")
```

### 5.3 æ¨¡å—è§„èŒƒï¼ˆModuleSpecï¼‰


**ğŸ“‹ ä»€ä¹ˆæ˜¯ModuleSpec**
```
ModuleSpecå°±åƒæ¨¡å—çš„"èº«ä»½è¯"ï¼š
- name: æ¨¡å—åå­—
- loader: è°æ¥åŠ è½½è¿™ä¸ªæ¨¡å—
- origin: æ¨¡å—æ¥è‡ªå“ªé‡Œï¼ˆæ–‡ä»¶è·¯å¾„ç­‰ï¼‰
- submodule_search_locations: å¦‚æœæ˜¯åŒ…ï¼Œå­æ¨¡å—åœ¨å“ªé‡Œæ‰¾
```

**ğŸ”§ åˆ›å»ºè‡ªå®šä¹‰ModuleSpec**
```python
import importlib.util
import sys

def create_virtual_module(name, code):
    """åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ¨¡å—"""
    
    # åˆ›å»ºæ¨¡å—è§„èŒƒ
    spec = importlib.util.spec_from_loader(
        name, 
        loader=None,  # æˆ‘ä»¬è‡ªå·±å¤„ç†åŠ è½½
        origin="virtual"
    )
    
    # åˆ›å»ºæ¨¡å—å¯¹è±¡
    module = importlib.util.module_from_spec(spec)
    
    # æ‰§è¡Œä»£ç 
    exec(code, module.__dict__)
    
    # æ·»åŠ åˆ°sys.modules
    sys.modules[name] = module
    
    return module

# åˆ›å»ºè™šæ‹Ÿæ¨¡å—
virtual_code = """
def hello():
    return "è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ¨¡å—!"

PI = 3.14159
"""

virtual_module = create_virtual_module('my_virtual_module', virtual_code)

# ä½¿ç”¨è™šæ‹Ÿæ¨¡å—
import my_virtual_module
print(my_virtual_module.hello())  # è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ¨¡å—!
print(my_virtual_module.PI)       # 3.14159
```

---

## 6. ğŸ› è‡ªå®šä¹‰å¯¼å…¥å™¨å®ç°


### 6.1 å¯¼å…¥å™¨çš„ç»„æˆéƒ¨åˆ†


**ğŸ”¸ å¯¼å…¥å™¨ä¸‰ä»¶å¥—**
```
å¯¼å…¥å™¨ = æŸ¥æ‰¾å™¨ + åŠ è½½å™¨ + æ‰§è¡Œå™¨

ğŸ” æŸ¥æ‰¾å™¨(Finder): "è¿™ä¸ªæ¨¡å—åœ¨å“ªé‡Œï¼Ÿ"
ğŸ“¦ åŠ è½½å™¨(Loader): "æ€ä¹ˆè¯»å–æ¨¡å—å†…å®¹ï¼Ÿ"
âš¡ æ‰§è¡Œå™¨(Executor): "æ€ä¹ˆè¿è¡Œæ¨¡å—ä»£ç ï¼Ÿ"
```

### 6.2 ç®€å•çš„è‡ªå®šä¹‰åŠ è½½å™¨


**ğŸ›  ä»å­—ç¬¦ä¸²åŠ è½½æ¨¡å—**
```python
import importlib.util
import sys

class StringLoader:
    """ä»å­—ç¬¦ä¸²åŠ è½½æ¨¡å—çš„åŠ è½½å™¨"""
    
    def __init__(self, source_code):
        self.source_code = source_code
    
    def create_module(self, spec):
        """åˆ›å»ºæ¨¡å—å¯¹è±¡"""
        return None  # ä½¿ç”¨é»˜è®¤åˆ›å»ºæ–¹å¼
    
    def exec_module(self, module):
        """æ‰§è¡Œæ¨¡å—ä»£ç """
        exec(self.source_code, module.__dict__)

def load_module_from_string(module_name, source_code):
    """ä»å­—ç¬¦ä¸²åˆ›å»ºå¹¶åŠ è½½æ¨¡å—"""
    
    # åˆ›å»ºåŠ è½½å™¨
    loader = StringLoader(source_code)
    
    # åˆ›å»ºæ¨¡å—è§„èŒƒ
    spec = importlib.util.spec_from_loader(module_name, loader)
    
    # åˆ›å»ºæ¨¡å—
    module = importlib.util.module_from_spec(spec)
    
    # æ‰§è¡Œæ¨¡å—
    spec.loader.exec_module(module)
    
    # æ·»åŠ åˆ°æ¨¡å—ç¼“å­˜
    sys.modules[module_name] = module
    
    return module

# ä½¿ç”¨ç¤ºä¾‹
calculator_code = """
def add(a, b):
    return a + b

def multiply(a, b):
    return a * b

VERSION = "1.0.0"
"""

# ä»å­—ç¬¦ä¸²åˆ›å»ºæ¨¡å—
calc_module = load_module_from_string('string_calculator', calculator_code)

# ä½¿ç”¨æ¨¡å—
result = calc_module.add(3, 4)  # 7
print(f"è®¡ç®—ç»“æœ: {result}")
print(f"æ¨¡å—ç‰ˆæœ¬: {calc_module.VERSION}")
```

### 6.3 URLå¯¼å…¥å™¨ç¤ºä¾‹


**ğŸŒ ä»ç½‘ç»œåŠ è½½æ¨¡å—**
```python
import importlib.util
import sys
import urllib.request

class URLLoader:
    """ä»URLåŠ è½½æ¨¡å—"""
    
    def __init__(self, url):
        self.url = url
    
    def create_module(self, spec):
        return None
    
    def exec_module(self, module):
        # ä»URLä¸‹è½½ä»£ç 
        with urllib.request.urlopen(self.url) as response:
            source_code = response.read().decode('utf-8')
        
        # æ‰§è¡Œä»£ç 
        exec(source_code, module.__dict__)

class URLFinder:
    """URLæ¨¡å—æŸ¥æ‰¾å™¨"""
    
    def __init__(self):
        self.url_modules = {}
    
    def add_url_module(self, module_name, url):
        """æ³¨å†ŒURLæ¨¡å—"""
        self.url_modules[module_name] = url
    
    def find_spec(self, fullname, path, target=None):
        if fullname in self.url_modules:
            url = self.url_modules[fullname]
            loader = URLLoader(url)
            return importlib.util.spec_from_loader(fullname, loader)
        return None

# æ³¨å†ŒURLæŸ¥æ‰¾å™¨
url_finder = URLFinder()
sys.meta_path.insert(0, url_finder)

# æ³¨å†ŒURLæ¨¡å—ï¼ˆç¤ºä¾‹ï¼‰
# url_finder.add_url_module(
#     'remote_utils', 
#     'https://example.com/modules/utils.py'
# )

# ä½¿ç”¨ï¼ˆæ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶éœ€è¦ç¡®ä¿URLå¯è®¿é—®ä¸”å®‰å…¨ï¼‰
# import remote_utils
```

### 6.4 åŠ å¯†æ¨¡å—å¯¼å…¥å™¨


**ğŸ” åŠ è½½åŠ å¯†çš„Pythonæ¨¡å—**
```python
import importlib.util
import sys
import base64

class EncryptedLoader:
    """åŠ è½½åŠ å¯†æ¨¡å—çš„åŠ è½½å™¨"""
    
    def __init__(self, encrypted_data, key):
        self.encrypted_data = encrypted_data
        self.key = key
    
    def create_module(self, spec):
        return None
    
    def exec_module(self, module):
        # ç®€å•çš„è§£å¯†ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†æ–¹æ³•ï¼‰
        encrypted_bytes = base64.b64decode(self.encrypted_data)
        decrypted_code = ''.join(chr(b ^ self.key) for b in encrypted_bytes)
        
        # æ‰§è¡Œè§£å¯†åçš„ä»£ç 
        exec(decrypted_code, module.__dict__)

def encrypt_code(source_code, key):
    """ç®€å•çš„åŠ å¯†å‡½æ•°"""
    encrypted_bytes = bytes(ord(c) ^ key for c in source_code)
    return base64.b64encode(encrypted_bytes).decode()

# ç¤ºä¾‹ï¼šåˆ›å»ºåŠ å¯†æ¨¡å—
original_code = """
def secret_function():
    return "è¿™æ˜¯ä¸€ä¸ªåŠ å¯†çš„å‡½æ•°!"

SECRET_VALUE = 42
"""

# åŠ å¯†ä»£ç 
key = 123
encrypted_code = encrypt_code(original_code, key)

# ä»åŠ å¯†æ•°æ®åŠ è½½æ¨¡å—
loader = EncryptedLoader(encrypted_code, key)
spec = importlib.util.spec_from_loader('encrypted_module', loader)
module = importlib.util.module_from_spec(spec)
spec.loader.exec_module(module)

# æµ‹è¯•
print(module.secret_function())  # è¿™æ˜¯ä¸€ä¸ªåŠ å¯†çš„å‡½æ•°!
print(module.SECRET_VALUE)       # 42
```

---

## 7. ğŸ“Š æ¨¡å—å…ƒæ•°æ®ç®¡ç†


### 7.1 ä»€ä¹ˆæ˜¯æ¨¡å—å…ƒæ•°æ®


**ğŸ’¡ ç†è§£å…ƒæ•°æ®**
```
å…ƒæ•°æ® = å…³äºæ•°æ®çš„æ•°æ®

æ¨¡å—å…ƒæ•°æ®åŒ…æ‹¬ï¼š
- æ¨¡å—åç§°ã€ç‰ˆæœ¬ã€ä½œè€…
- æ¨¡å—è·¯å¾„ã€å¤§å°ã€åˆ›å»ºæ—¶é—´
- ä¾èµ–å…³ç³»ã€è®¸å¯è¯ä¿¡æ¯
- æ¨¡å—çŠ¶æ€ã€åŠ è½½å†å²

å°±åƒä¹¦çš„å°é¢ä¿¡æ¯ï¼šä¹¦åã€ä½œè€…ã€å‡ºç‰ˆç¤¾ã€é¡µæ•°ç­‰
```

### 7.2 è·å–æ¨¡å—ä¿¡æ¯


**ğŸ” inspectæ¨¡å— - æ¨¡å—æ£€æŸ¥å·¥å…·**
```python
import inspect
import math
import sys

def analyze_module(module):
    """åˆ†ææ¨¡å—çš„è¯¦ç»†ä¿¡æ¯"""
    print(f"\nğŸ“‹ æ¨¡å—åˆ†ææŠ¥å‘Š: {module.__name__}")
    print("=" * 50)
    
    # åŸºæœ¬ä¿¡æ¯
    print(f"ğŸ“‚ æ¨¡å—æ–‡ä»¶: {getattr(module, '__file__', 'å†…ç½®æ¨¡å—')}")
    print(f"ğŸ“ æ¨¡å—æ–‡æ¡£: {module.__doc__[:100] if module.__doc__ else 'æ— æ–‡æ¡£'}...")
    print(f"ğŸ“¦ æ‰€å±åŒ…: {getattr(module, '__package__', 'æ— ')}")
    
    # è·å–æ‰€æœ‰æˆå‘˜
    members = inspect.getmembers(module)
    
    # ç»Ÿè®¡ä¸åŒç±»å‹çš„æˆå‘˜
    functions = [name for name, obj in members if inspect.isfunction(obj)]
    classes = [name for name, obj in members if inspect.isclass(obj)]
    variables = [name for name, obj in members 
                if not name.startswith('_') 
                and not inspect.isfunction(obj) 
                and not inspect.isclass(obj)
                and not inspect.ismodule(obj)]
    
    print(f"\nğŸ“Š å†…å®¹ç»Ÿè®¡:")
    print(f"  ğŸ”§ å‡½æ•°: {len(functions)} ä¸ª")
    print(f"  ğŸ­ ç±»: {len(classes)} ä¸ª") 
    print(f"  ğŸ¯ å˜é‡: {len(variables)} ä¸ª")
    
    # æ˜¾ç¤ºä¸»è¦å‡½æ•°
    if functions:
        print(f"\nğŸ”§ ä¸»è¦å‡½æ•°:")
        for func_name in functions[:5]:  # åªæ˜¾ç¤ºå‰5ä¸ª
            func = getattr(module, func_name)
            sig = inspect.signature(func)
            print(f"  â€¢ {func_name}{sig}")
    
    # æ˜¾ç¤ºä¸»è¦ç±»
    if classes:
        print(f"\nğŸ­ ä¸»è¦ç±»:")
        for class_name in classes[:3]:  # åªæ˜¾ç¤ºå‰3ä¸ª
            cls = getattr(module, class_name)
            print(f"  â€¢ {class_name}: {cls.__doc__[:50] if cls.__doc__ else 'æ— æè¿°'}...")

# åˆ†æmathæ¨¡å—
analyze_module(math)
```

### 7.3 æ¨¡å—ç¼“å­˜ç®¡ç†


**ğŸ—‚ sys.modules - æ¨¡å—ç¼“å­˜**
```python
import sys

def show_module_cache_info():
    """æ˜¾ç¤ºæ¨¡å—ç¼“å­˜ä¿¡æ¯"""
    print(f"ğŸ“š å·²åŠ è½½æ¨¡å—æ€»æ•°: {len(sys.modules)}")
    print("\nğŸ” æ¨¡å—åˆ†ç±»ç»Ÿè®¡:")
    
    builtin_count = 0
    stdlib_count = 0
    third_party_count = 0
    local_count = 0
    
    for module_name, module in sys.modules.items():
        if module is None:
            continue
            
        file_path = getattr(module, '__file__', '')
        
        if not file_path:  # å†…ç½®æ¨¡å—
            builtin_count += 1
        elif 'site-packages' in file_path:  # ç¬¬ä¸‰æ–¹åŒ…
            third_party_count += 1
        elif 'lib/python' in file_path:  # æ ‡å‡†åº“
            stdlib_count += 1
        else:  # æœ¬åœ°æ¨¡å—
            local_count += 1
    
    print(f"  ğŸ”§ å†…ç½®æ¨¡å—: {builtin_count}")
    print(f"  ğŸ“š æ ‡å‡†åº“: {stdlib_count}")
    print(f"  ğŸ“¦ ç¬¬ä¸‰æ–¹åŒ…: {third_party_count}")
    print(f"  ğŸ  æœ¬åœ°æ¨¡å—: {local_count}")

def clean_module_cache(pattern):
    """æ¸…ç†åŒ¹é…æ¨¡å¼çš„æ¨¡å—ç¼“å­˜"""
    to_remove = []
    for module_name in sys.modules:
        if pattern in module_name:
            to_remove.append(module_name)
    
    for module_name in to_remove:
        print(f"ğŸ—‘ ç§»é™¤æ¨¡å—ç¼“å­˜: {module_name}")
        del sys.modules[module_name]

# æ˜¾ç¤ºç¼“å­˜ä¿¡æ¯
show_module_cache_info()

# ç¤ºä¾‹ï¼šæ¸…ç†æŸä¸ªåŒ…çš„ç¼“å­˜ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
# clean_module_cache('test_')
```

### 7.4 æ¨¡å—ç‰ˆæœ¬ç®¡ç†


**ğŸ“Š ç‰ˆæœ¬ä¿¡æ¯æ”¶é›†**
```python
import sys
import importlib.util

class ModuleVersionManager:
    """æ¨¡å—ç‰ˆæœ¬ç®¡ç†å™¨"""
    
    def __init__(self):
        self.module_versions = {}
    
    def register_module(self, module_name):
        """æ³¨å†Œæ¨¡å—å¹¶æ”¶é›†ç‰ˆæœ¬ä¿¡æ¯"""
        try:
            module = importlib.import_module(module_name)
            
            # å°è¯•è·å–ç‰ˆæœ¬ä¿¡æ¯
            version = None
            for attr in ['__version__', 'VERSION', 'version']:
                if hasattr(module, attr):
                    version = getattr(module, attr)
                    break
            
            # æ”¶é›†æ¨¡å—ä¿¡æ¯
            self.module_versions[module_name] = {
                'version': version,
                'file': getattr(module, '__file__', 'å†…ç½®'),
                'package': getattr(module, '__package__', None),
                'doc': module.__doc__[:100] if module.__doc__ else None
            }
            
        except ImportError as e:
            self.module_versions[module_name] = {
                'error': str(e)
            }
    
    def show_report(self):
        """æ˜¾ç¤ºç‰ˆæœ¬æŠ¥å‘Š"""
        print("ğŸ“‹ æ¨¡å—ç‰ˆæœ¬æŠ¥å‘Š")
        print("=" * 60)
        
        for module_name, info in self.module_versions.items():
            if 'error' in info:
                print(f"âŒ {module_name}: {info['error']}")
            else:
                version = info['version'] or 'æœªçŸ¥ç‰ˆæœ¬'
                print(f"âœ… {module_name}: {version}")
                if info['doc']:
                    print(f"   ğŸ“ {info['doc']}...")

# ä½¿ç”¨ç¤ºä¾‹
version_manager = ModuleVersionManager()

# æ³¨å†Œè¦æ£€æŸ¥çš„æ¨¡å—
modules_to_check = ['sys', 'os', 'json', 'requests', 'numpy']
for module in modules_to_check:
    version_manager.register_module(module)

version_manager.show_report()
```

---

## 8. ğŸ”— æ¨¡å—ä¾èµ–ç®¡ç†


### 8.1 ä¾èµ–å…³ç³»çš„ç†è§£


**ğŸ’¡ ä¾èµ–å…³ç³»ç±»æ¯”**
```
æ¨¡å—ä¾èµ–å°±åƒåšèœçš„ææ–™ï¼š

ä¸»èœï¼ˆä¸»æ¨¡å—ï¼‰: å®«ä¿é¸¡ä¸
  â”œâ”€â”€ é¸¡è‚‰ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰
  â”œâ”€â”€ èŠ±ç”Ÿï¼ˆç›´æ¥ä¾èµ–ï¼‰
  â””â”€â”€ è°ƒæ–™åŒ…ï¼ˆé—´æ¥ä¾èµ–ï¼‰
      â”œâ”€â”€ ç›
      â”œâ”€â”€ ç³–  
      â””â”€â”€ ç”ŸæŠ½

å¦‚æœç¼ºå°‘ä»»ä½•ä¸€ä¸ªææ–™ï¼Œéƒ½åšä¸å‡ºå®Œæ•´çš„èœ
```

### 8.2 ä¾èµ–æ£€æµ‹å·¥å…·


**ğŸ” ä¾èµ–å…³ç³»åˆ†æå™¨**
```python
import ast
import os
import sys
from collections import defaultdict

class DependencyAnalyzer:
    """Pythonæ¨¡å—ä¾èµ–åˆ†æå™¨"""
    
    def __init__(self):
        self.dependencies = defaultdict(set)
        self.import_errors = []
    
    def analyze_file(self, file_path):
        """åˆ†æå•ä¸ªPythonæ–‡ä»¶çš„ä¾èµ–"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # è§£æAST
            tree = ast.parse(content)
            
            # æŸ¥æ‰¾å¯¼å…¥è¯­å¥
            imports = set()
            for node in ast.walk(tree):
                if isinstance(node, ast.Import):
                    for alias in node.names:
                        imports.add(alias.name.split('.')[0])
                
                elif isinstance(node, ast.ImportFrom):
                    if node.module:
                        imports.add(node.module.split('.')[0])
            
            self.dependencies[file_path] = imports
            return imports
            
        except Exception as e:
            self.import_errors.append((file_path, str(e)))
            return set()
    
    def analyze_directory(self, directory):
        """åˆ†æç›®å½•ä¸­æ‰€æœ‰Pythonæ–‡ä»¶çš„ä¾èµ–"""
        for root, dirs, files in os.walk(directory):
            # å¿½ç•¥__pycache__ç›®å½•
            dirs[:] = [d for d in dirs if d != '__pycache__']
            
            for file in files:
                if file.endswith('.py'):
                    file_path = os.path.join(root, file)
                    self.analyze_file(file_path)
    
    def get_all_dependencies(self):
        """è·å–æ‰€æœ‰å”¯ä¸€çš„ä¾èµ–"""
        all_deps = set()
        for deps in self.dependencies.values():
            all_deps.update(deps)
        return all_deps
    
    def categorize_dependencies(self):
        """åˆ†ç±»ä¾èµ–ï¼šæ ‡å‡†åº“ã€ç¬¬ä¸‰æ–¹ã€æœ¬åœ°"""
        all_deps = self.get_all_dependencies()
        
        stdlib_modules = set(sys.stdlib_module_names)
        
        categories = {
            'builtin': set(),      # å†…ç½®æ¨¡å—
            'stdlib': set(),       # æ ‡å‡†åº“
            'third_party': set(),  # ç¬¬ä¸‰æ–¹åŒ…
            'local': set(),        # æœ¬åœ°æ¨¡å—
            'unknown': set()       # æœªçŸ¥æ¨¡å—
        }
        
        for dep in all_deps:
            if dep in sys.builtin_module_names:
                categories['builtin'].add(dep)
            elif dep in stdlib_modules:
                categories['stdlib'].add(dep)
            else:
                # å°è¯•å¯¼å…¥ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨
                try:
                    __import__(dep)
                    # æ£€æŸ¥æ˜¯å¦åœ¨site-packagesä¸­
                    module = sys.modules.get(dep)
                    if module and hasattr(module, '__file__'):
                        if 'site-packages' in module.__file__:
                            categories['third_party'].add(dep)
                        else:
                            categories['local'].add(dep)
                    else:
                        categories['unknown'].add(dep)
                except ImportError:
                    categories['unknown'].add(dep)
        
        return categories
    
    def generate_report(self):
        """ç”Ÿæˆä¾èµ–æŠ¥å‘Š"""
        print("ğŸ“Š æ¨¡å—ä¾èµ–åˆ†ææŠ¥å‘Š")
        print("=" * 50)
        
        print(f"\nğŸ“ åˆ†æçš„æ–‡ä»¶æ•°é‡: {len(self.dependencies)}")
        
        if self.import_errors:
            print(f"\nâŒ åˆ†æé”™è¯¯ ({len(self.import_errors)} ä¸ª):")
            for file_path, error in self.import_errors:
                print(f"  â€¢ {file_path}: {error}")
        
        categories = self.categorize_dependencies()
        
        print(f"\nğŸ“¦ ä¾èµ–åˆ†ç±»ç»Ÿè®¡:")
        print(f"  ğŸ”§ å†…ç½®æ¨¡å—: {len(categories['builtin'])} ä¸ª")
        print(f"  ğŸ“š æ ‡å‡†åº“: {len(categories['stdlib'])} ä¸ª")
        print(f"  ğŸŒ ç¬¬ä¸‰æ–¹åŒ…: {len(categories['third_party'])} ä¸ª")
        print(f"  ğŸ  æœ¬åœ°æ¨¡å—: {len(categories['local'])} ä¸ª")
        print(f"  â“ æœªçŸ¥æ¨¡å—: {len(categories['unknown'])} ä¸ª")
        
        # è¯¦ç»†åˆ—è¡¨
        for category, modules in categories.items():
            if modules:
                print(f"\n{category.upper()}:")
                for module in sorted(modules):
                    print(f"  â€¢ {module}")

# ä½¿ç”¨ç¤ºä¾‹
analyzer = DependencyAnalyzer()

# åˆ†æå½“å‰ç›®å½•
analyzer.analyze_directory('.')
analyzer.generate_report()
```

### 8.3 ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ


**ğŸ¯ requirements.txtç®¡ç†**
```python
import subprocess
import sys
import pkg_resources

class RequirementsManager:
    """requirements.txtç®¡ç†å™¨"""
    
    def __init__(self):
        self.installed_packages = {}
        self.load_installed_packages()
    
    def load_installed_packages(self):
        """åŠ è½½å·²å®‰è£…çš„åŒ…ä¿¡æ¯"""
        for package in pkg_resources.working_set:
            self.installed_packages[package.project_name] = package.version
    
    def generate_requirements(self, output_file='requirements.txt'):
        """ç”Ÿæˆrequirements.txtæ–‡ä»¶"""
        with open(output_file, 'w') as f:
            for package_name, version in sorted(self.installed_packages.items()):
                f.write(f"{package_name}=={version}\n")
        print(f"âœ… å·²ç”Ÿæˆ {output_file}")
    
    def check_requirements(self, requirements_file='requirements.txt'):
        """æ£€æŸ¥requirements.txtä¸­çš„åŒ…æ˜¯å¦å·²å®‰è£…"""
        missing = []
        version_mismatch = []
        
        try:
            with open(requirements_file, 'r') as f:
                for line in f:
                    line = line.strip()
                    if line and not line.startswith('#'):
                        if '==' in line:
                            package, version = line.split('==')
                            if package not in self.installed_packages:
                                missing.append(package)
                            elif self.installed_packages[package] != version:
                                version_mismatch.append(
                                    (package, version, self.installed_packages[package])
                                )
                        else:
                            package = line
                            if package not in self.installed_packages:
                                missing.append(package)
            
            # æŠ¥å‘Šç»“æœ
            if missing:
                print("âŒ ç¼ºå°‘çš„åŒ…:")
                for package in missing:
                    print(f"  â€¢ {package}")
            
            if version_mismatch:
                print("âš ï¸ ç‰ˆæœ¬ä¸åŒ¹é…:")
                for package, required, installed in version_mismatch:
                    print(f"  â€¢ {package}: è¦æ±‚{required}, å·²å®‰è£…{installed}")
            
            if not missing and not version_mismatch:
                print("âœ… æ‰€æœ‰ä¾èµ–éƒ½å·²æ­£ç¡®å®‰è£…")
                
        except FileNotFoundError:
            print(f"âŒ æ–‡ä»¶ {requirements_file} ä¸å­˜åœ¨")
    
    def install_requirements(self, requirements_file='requirements.txt'):
        """å®‰è£…requirements.txtä¸­çš„åŒ…"""
        try:
            result = subprocess.run([
                sys.executable, '-m', 'pip', 'install', '-r', requirements_file
            ], capture_output=True, text=True)
            
            if result.returncode == 0:
                print("âœ… ä¾èµ–å®‰è£…æˆåŠŸ")
            else:
                print(f"âŒ å®‰è£…å¤±è´¥: {result.stderr}")
                
        except Exception as e:
            print(f"âŒ å®‰è£…è¿‡ç¨‹å‡ºé”™: {e}")

# ä½¿ç”¨ç¤ºä¾‹
req_manager = RequirementsManager()

# ç”Ÿæˆrequirements.txt
req_manager.generate_requirements()

# æ£€æŸ¥ä¾èµ–
req_manager.check_requirements()
```

---

## 9. âš ï¸ å¯¼å…¥é™·é˜±é¿å…


### 9.1 å¾ªç¯å¯¼å…¥é—®é¢˜


**ğŸ’€ ä»€ä¹ˆæ˜¯å¾ªç¯å¯¼å…¥**
```
å¾ªç¯å¯¼å…¥å°±åƒä¸¤ä¸ªäººäº’ç›¸ç­‰å¯¹æ–¹å…ˆè¯´è¯ï¼š

æ–‡ä»¶A.py:
from B import function_b  # Aéœ€è¦B

æ–‡ä»¶B.py:  
from A import function_a  # Béœ€è¦A

ç»“æœï¼šè°éƒ½å¯¼å…¥ä¸äº†è°ï¼
```

**ğŸ”§ å¾ªç¯å¯¼å…¥è§£å†³æ–¹æ¡ˆ**
```python
# æ–¹æ¡ˆ1: å»¶è¿Ÿå¯¼å…¥ï¼ˆåœ¨å‡½æ•°å†…å¯¼å…¥ï¼‰
# fileA.py
def use_function_b():
    from fileB import function_b  # åœ¨ä½¿ç”¨æ—¶æ‰å¯¼å…¥
    return function_b()

# æ–¹æ¡ˆ2: é‡æ„ä»£ç ç»“æ„
# æŠŠå…±åŒä¾èµ–æå–åˆ°ç¬¬ä¸‰ä¸ªæ–‡ä»¶
# common.py
def shared_function():
    return "å…±åŒä½¿ç”¨çš„åŠŸèƒ½"

# fileA.py
from common import shared_function

# fileB.py  
from common import shared_function

# æ–¹æ¡ˆ3: ä½¿ç”¨å­—ç¬¦ä¸²å¯¼å…¥
# fileA.py
import importlib

def use_function_b():
    fileB = importlib.import_module('fileB')
    return fileB.function_b()
```

### 9.2 ç›¸å¯¹å¯¼å…¥ä¸ç»å¯¹å¯¼å…¥


**ğŸ¯ å¯¼å…¥æ–¹å¼å¯¹æ¯”**
```python
# é¡¹ç›®ç»“æ„ç¤ºä¾‹
myproject/
    __init__.py
    main.py
    utils/
        __init__.py
        helpers.py
        validators.py

# åœ¨ utils/helpers.py ä¸­å¯¼å…¥ validators.py

# âŒ å®¹æ˜“å‡ºé”™çš„æ–¹å¼
import validators  # å¯èƒ½æ‰¾ä¸åˆ°

# âœ… ç»å¯¹å¯¼å…¥ï¼ˆæ¨èï¼‰
from myproject.utils import validators

# âœ… ç›¸å¯¹å¯¼å…¥ï¼ˆåœ¨åŒ…å†…ä½¿ç”¨ï¼‰
from . import validators        # åŒçº§ç›®å½•
from ..main import some_function  # ä¸Šçº§ç›®å½•
```

**ğŸ“‹ å¯¼å…¥è§„åˆ™æœ€ä½³å®è·µ**
```python
# å¯¼å…¥é¡ºåºè§„èŒƒï¼ˆPEP 8ï¼‰

# 1. æ ‡å‡†åº“å¯¼å…¥
import os
import sys
from pathlib import Path

# 2. ç¬¬ä¸‰æ–¹åº“å¯¼å…¥
import requests
import numpy as np
from flask import Flask

# 3. æœ¬åœ°åº”ç”¨å¯¼å…¥
from myproject.utils import helpers
from . import config
```

### 9.3 å‘½åç©ºé—´æ±¡æŸ“


**ğŸ’£ å‘½åç©ºé—´æ±¡æŸ“ç¤ºä¾‹**
```python
# âŒ å±é™©çš„å¯¼å…¥æ–¹å¼
from math import *     # å¯¼å…¥æ‰€æœ‰å‡½æ•°ï¼Œå¯èƒ½è¦†ç›–ç°æœ‰åç§°
from os import *       # æ›´åŠ å±é™©

# å¯èƒ½çš„é—®é¢˜
def open(filename):    # æ„å¤–è¦†ç›–äº†å†…ç½®çš„openå‡½æ•°
    print(f"è‡ªå®šä¹‰çš„open: {filename}")

# âœ… å®‰å…¨çš„å¯¼å…¥æ–¹å¼
import math
import os
from math import sqrt, pi  # åªå¯¼å…¥éœ€è¦çš„

# æˆ–è€…ä½¿ç”¨åˆ«å
import numpy as np
import pandas as pd
from datetime import datetime as dt
```

### 9.4 å¯¼å…¥æ€§èƒ½ä¼˜åŒ–


**âš¡ å¯¼å…¥æ€§èƒ½é—®é¢˜**
```python
import time

def measure_import_time(module_name):
    """æµ‹é‡æ¨¡å—å¯¼å…¥æ—¶é—´"""
    start_time = time.time()
    try:
        globals()[module_name] = __import__(module_name)
        end_time = time.time()
        print(f"ğŸ“¦ {module_name}: {(end_time - start_time)*1000:.2f}ms")
    except ImportError:
        print(f"âŒ {module_name}: å¯¼å…¥å¤±è´¥")

# æµ‹è¯•å¸¸è§æ¨¡å—çš„å¯¼å…¥æ—¶é—´
modules = ['os', 'sys', 'json', 'urllib', 'collections']
print("ğŸ• æ¨¡å—å¯¼å…¥æ—¶é—´æµ‹è¯•:")
for module in modules:
    measure_import_time(module)
```

**ğŸš€ å¯¼å…¥ä¼˜åŒ–æŠ€å·§**
```python
# æŠ€å·§1: å»¶è¿Ÿå¯¼å…¥å¤§å‹æ¨¡å—
def use_heavy_module():
    import heavy_module  # åªåœ¨éœ€è¦æ—¶å¯¼å…¥
    return heavy_module.some_function()

# æŠ€å·§2: æ¡ä»¶å¯¼å…¥
try:
    import ujson as json  # æ›´å¿«çš„JSONåº“
except ImportError:
    import json          # å¤‡é€‰æ ‡å‡†åº“

# æŠ€å·§3: å¯¼å…¥ç¼“å­˜æ£€æŸ¥
import sys

def smart_import(module_name):
    """æ™ºèƒ½å¯¼å…¥ï¼šæ£€æŸ¥ç¼“å­˜"""
    if module_name in sys.modules:
        print(f"âœ… {module_name} å·²åœ¨ç¼“å­˜ä¸­")
        return sys.modules[module_name]
    else:
        print(f"ğŸ“¦ æ­£åœ¨å¯¼å…¥ {module_name}")
        return __import__(module_name)

# æŠ€å·§4: æ‰¹é‡å¯¼å…¥ç®¡ç†
class LazyImporter:
    """å»¶è¿Ÿå¯¼å…¥ç®¡ç†å™¨"""
    
    def __init__(self, **modules):
        self._modules = modules
        self._imported = {}
    
    def __getattr__(self, name):
        if name in self._modules and name not in self._imported:
            module_name = self._modules[name]
            self._imported[name] = __import__(module_name)
        return self._imported[name]

# ä½¿ç”¨å»¶è¿Ÿå¯¼å…¥ç®¡ç†å™¨
lazy_modules = LazyImporter(
    np='numpy',
    pd='pandas', 
    plt='matplotlib.pyplot'
)

# åªæœ‰çœŸæ­£ä½¿ç”¨æ—¶æ‰å¯¼å…¥
# array = lazy_modules.np.array([1, 2, 3])
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¨¡å—æŸ¥æ‰¾ï¼šsys.pathå†³å®šPythonå»å“ªé‡Œæ‰¾æ¨¡å—
ğŸ”¸ å¯¼å…¥æœºåˆ¶ï¼šæŸ¥æ‰¾â†’åŠ è½½â†’ç¼–è¯‘â†’æ‰§è¡Œâ†’ç¼“å­˜çš„å®Œæ•´æµç¨‹
ğŸ”¸ importlibï¼šPythonå¯¼å…¥ç³»ç»Ÿçš„"æ§åˆ¶ä¸­å¿ƒ"
ğŸ”¸ åŠ¨æ€å¯¼å…¥ï¼šç¨‹åºè¿è¡Œæ—¶å†³å®šå¯¼å…¥ä»€ä¹ˆæ¨¡å—
ğŸ”¸ é’©å­æœºåˆ¶ï¼šåœ¨å¯¼å…¥è¿‡ç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰å¤„ç†
ğŸ”¸ ä¾èµ–ç®¡ç†ï¼šç†è§£æ¨¡å—é—´çš„ä¾èµ–å…³ç³»å’Œç®¡ç†æ–¹æ³•
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¨¡å—æŸ¥æ‰¾çš„æœ¬è´¨**
```
æ¨¡å—æŸ¥æ‰¾å°±åƒGPSå¯¼èˆªï¼š
- sys.pathæ˜¯åœ°å›¾
- æŸ¥æ‰¾å™¨æ˜¯å¯¼èˆªç®—æ³•
- æ¨¡å—è§„èŒƒæ˜¯ç›®çš„åœ°ä¿¡æ¯
- åŠ è½½å™¨æ˜¯äº¤é€šå·¥å…·
```

**ğŸ”¹ åŠ¨æ€å¯¼å…¥çš„ä»·å€¼**
```
é™æ€å¯¼å…¥ï¼šç¼–è¯‘æ—¶ç¡®å®šï¼Œåƒé¢„è®¢é¤å…
åŠ¨æ€å¯¼å…¥ï¼šè¿è¡Œæ—¶å†³å®šï¼Œåƒä¸´æ—¶å†³å®šå»å“ªåƒ

åŠ¨æ€å¯¼å…¥çš„ç”¨é€”ï¼š
âœ… æ’ä»¶ç³»ç»Ÿ
âœ… æŒ‰éœ€åŠ è½½
âœ… é…ç½®é©±åŠ¨
âœ… æ¡ä»¶å¯¼å…¥
```

**ğŸ”¹ é¿å…å¯¼å…¥é™·é˜±**
```
å¸¸è§é™·é˜±åŠè§£å†³æ–¹æ¡ˆï¼š
ğŸ’€ å¾ªç¯å¯¼å…¥ â†’ å»¶è¿Ÿå¯¼å…¥ã€é‡æ„ç»“æ„
ğŸ’€ å‘½åå†²çª â†’ ä½¿ç”¨åˆ«åã€é¿å…from * import
ğŸ’€ æ€§èƒ½é—®é¢˜ â†’ å»¶è¿Ÿå¯¼å…¥ã€æ¡ä»¶å¯¼å…¥
ğŸ’€ è·¯å¾„é—®é¢˜ â†’ ä½¿ç”¨ç»å¯¹å¯¼å…¥ã€sys.pathç®¡ç†
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æ’ä»¶æ¶æ„å¼€å‘**
```python
# ç®€åŒ–çš„æ’ä»¶ç®¡ç†ç³»ç»Ÿ
import importlib
import os

def load_plugins(plugin_dir):
    plugins = []
    for file in os.listdir(plugin_dir):
        if file.endswith('_plugin.py'):
            module_name = file[:-3]
            plugin = importlib.import_module(f'plugins.{module_name}')
            plugins.append(plugin)
    return plugins
```

**ğŸ”§ é…ç½®é©±åŠ¨çš„æ¨¡å—åŠ è½½**
```python
# æ ¹æ®é…ç½®åŠ è½½ä¸åŒçš„å®ç°
config = {'database': 'mysql'}  # æˆ– 'postgresql', 'sqlite'

db_module = importlib.import_module(f"drivers.{config['database']}")
connection = db_module.connect()
```

**ğŸ” å¼€å‘å·¥å…·å¢å¼º**
```python
# æ¨¡å—çƒ­é‡è½½ï¼ˆå¼€å‘æ—¶å¾ˆæœ‰ç”¨ï¼‰
import importlib

def reload_module(module_name):
    if module_name in sys.modules:
        importlib.reload(sys.modules[module_name])
        print(f"ğŸ”„ å·²é‡è½½æ¨¡å—: {module_name}")
```

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ è¿›é˜¶è·¯çº¿**
```
åŸºç¡€é˜¶æ®µï¼š
â€¢ ç†è§£åŸºæœ¬å¯¼å…¥è¯­æ³•
â€¢ æŒæ¡æ¨¡å—å’ŒåŒ…çš„æ¦‚å¿µ
â€¢ å­¦ä¼šä½¿ç”¨sys.path

è¿›é˜¶é˜¶æ®µï¼š
â€¢ æ·±å…¥importlibæ¨¡å—
â€¢ å®ç°ç®€å•çš„åŠ¨æ€å¯¼å…¥
â€¢ ç†è§£æ¨¡å—æŸ¥æ‰¾æœºåˆ¶

é«˜çº§é˜¶æ®µï¼š
â€¢ è‡ªå®šä¹‰å¯¼å…¥å™¨å’ŒåŠ è½½å™¨
â€¢ æ„å»ºæ’ä»¶ç³»ç»Ÿ
â€¢ æ€§èƒ½ä¼˜åŒ–å’Œé—®é¢˜æ’æŸ¥

å®æˆ˜åº”ç”¨ï¼š
â€¢ å¼€å‘å¯æ‰©å±•çš„åº”ç”¨æ¶æ„
â€¢ å®ç°é…ç½®é©±åŠ¨çš„ç³»ç»Ÿ
â€¢ æ„å»ºå¼€å‘å·¥å…·å’Œæ¡†æ¶
```

### 10.5 æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ


**âš ï¸ é‡è¦æé†’**
```
å®‰å…¨è€ƒè™‘ï¼š
â€¢ åŠ¨æ€å¯¼å…¥è¦éªŒè¯æ¨¡å—æ¥æº
â€¢ ä¸è¦å¯¼å…¥ä¸å¯ä¿¡çš„ä»£ç 
â€¢ ä½¿ç”¨ç™½åå•é™åˆ¶å¯å¯¼å…¥çš„æ¨¡å—

æ€§èƒ½è€ƒè™‘ï¼š
â€¢ é¿å…åœ¨å¾ªç¯ä¸­å¯¼å…¥
â€¢ å¤§å‹æ¨¡å—ä½¿ç”¨å»¶è¿Ÿå¯¼å…¥
â€¢ åˆç†ä½¿ç”¨æ¨¡å—ç¼“å­˜

ç»´æŠ¤æ€§è€ƒè™‘ï¼š
â€¢ ä¿æŒå¯¼å…¥è¯­å¥ç®€æ´æ˜äº†
â€¢ ä½¿ç”¨ç»å¯¹å¯¼å…¥æé«˜å¯è¯»æ€§
â€¢ åŠæ—¶æ¸…ç†æ— ç”¨çš„å¯¼å…¥
```

**âœ… æœ€ä½³å®è·µæ€»ç»“**
```
1. ä¼˜å…ˆä½¿ç”¨æ ‡å‡†çš„importè¯­å¥
2. åŠ¨æ€å¯¼å…¥ç”¨äºç‰¹æ®Šåœºæ™¯
3. é¿å…å¤æ‚çš„å¯¼å…¥é€»è¾‘
4. ä¿æŒæ¨¡å—ä¾èµ–å…³ç³»æ¸…æ™°
5. å®šæœŸæ£€æŸ¥å’Œæ¸…ç†ä¾èµ–
6. ä½¿ç”¨å·¥å…·è‡ªåŠ¨åŒ–ä¾èµ–ç®¡ç†
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ¨¡å—å¯¼å…¥æœ‰é—¨é“ï¼ŒæŸ¥æ‰¾è·¯å¾„æ˜¯å…³é”®
åŠ¨æ€å¯¼å…¥è§£éš¾é¢˜ï¼Œé’©å­æœºåˆ¶æ›´çµæ´»
ä¾èµ–ç®¡ç†è¦æ¸…æ™°ï¼Œé™·é˜±è§„é¿ä¿å¹³å®‰
importlibæ˜¯æ ¸å¿ƒï¼ŒæŒæ¡åŸç†èµ°å¤©ä¸‹
```