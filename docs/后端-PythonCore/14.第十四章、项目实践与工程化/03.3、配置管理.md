---
title: 3ã€é…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [é…ç½®æ–‡ä»¶æ ¼å¼è¯¦è§£](#2-é…ç½®æ–‡ä»¶æ ¼å¼è¯¦è§£)
3. [ç¯å¢ƒå˜é‡é…ç½®](#3-ç¯å¢ƒå˜é‡é…ç½®)
4. [é…ç½®å±‚æ¬¡ç®¡ç†](#4-é…ç½®å±‚æ¬¡ç®¡ç†)
5. [æ•æ„Ÿä¿¡æ¯å¤„ç†](#5-æ•æ„Ÿä¿¡æ¯å¤„ç†)
6. [é…ç½®éªŒè¯](#6-é…ç½®éªŒè¯)
7. [åŠ¨æ€é…ç½®åŠ è½½](#7-åŠ¨æ€é…ç½®åŠ è½½)
8. [é…ç½®æœ€ä½³å®è·µ](#8-é…ç½®æœ€ä½³å®è·µ)
9. [é…ç½®å·¥å…·é€‰æ‹©](#9-é…ç½®å·¥å…·é€‰æ‹©)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ç®¡ç†


**é€šä¿—è§£é‡Š**ï¼šé…ç½®ç®¡ç†å°±åƒæ˜¯ç»™ä½ çš„ç¨‹åºå‡†å¤‡ä¸€ä»½"è¯´æ˜ä¹¦"ï¼Œå‘Šè¯‰å®ƒåœ¨ä¸åŒæƒ…å†µä¸‹åº”è¯¥æ€ä¹ˆå·¥ä½œã€‚

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
ğŸ  ç©ºè°ƒé¥æ§å™¨ â†’ æ¸©åº¦ã€é£é€Ÿã€æ¨¡å¼è®¾ç½®
ğŸ® æ¸¸æˆè®¾ç½® â†’ ç”»è´¨ã€éŸ³æ•ˆã€æ§åˆ¶é”®è®¾ç½®  
ğŸ“± æ‰‹æœºè®¾ç½® â†’ äº®åº¦ã€é“ƒå£°ã€ç½‘ç»œé…ç½®

ç¨‹åºä¸­çš„é…ç½®ï¼š
ğŸ’¾ æ•°æ®åº“è¿æ¥ä¿¡æ¯ â†’ åœ°å€ã€ç«¯å£ã€ç”¨æˆ·å
ğŸŒ APIæ¥å£åœ°å€ â†’ æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒ
ğŸ“Š æ—¥å¿—çº§åˆ« â†’ DEBUGã€INFOã€ERROR
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç®¡ç†


**æ ¸å¿ƒé—®é¢˜**ï¼šç¨‹åºéœ€è¦åœ¨ä¸åŒç¯å¢ƒä¸‹çµæ´»è¿è¡Œ

```
æ²¡æœ‰é…ç½®ç®¡ç†çš„ç—›è‹¦ï¼š
âŒ ä»£ç å†™æ­»å‚æ•°ï¼Œæ¢ç¯å¢ƒè¦æ”¹ä»£ç 
âŒ æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒæ··ä¹±
âŒ å¯†ç å†™åœ¨ä»£ç é‡Œï¼Œå®‰å…¨é£é™©å¤§
âŒ æ¯æ¬¡éƒ¨ç½²éƒ½è¦æ‰‹åŠ¨ä¿®æ”¹å‚æ•°

æœ‰äº†é…ç½®ç®¡ç†çš„å¥½å¤„ï¼š
âœ… åŒä¸€å¥—ä»£ç ï¼Œä¸åŒç¯å¢ƒä¸åŒé…ç½®
âœ… ä¸æ”¹ä»£ç å°±èƒ½è°ƒæ•´ç¨‹åºè¡Œä¸º
âœ… æ•æ„Ÿä¿¡æ¯å®‰å…¨å­˜å‚¨
âœ… å›¢é˜Ÿåä½œæ›´å®¹æ˜“
```

### 1.3 é…ç½®ç®¡ç†çš„åŸºæœ¬æ€è·¯


**æ ¸å¿ƒç†å¿µ**ï¼šæŠŠ"å˜åŒ–çš„éƒ¨åˆ†"ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥

```
ä¼ ç»Ÿå†™æ³•ï¼ˆä¸å¥½ï¼‰ï¼š
def connect_database():
    host = "localhost"  # å†™æ­»åœ¨ä»£ç é‡Œ
    port = 3306
    username = "root"
    password = "123456"  # å¯†ç æš´éœ²äº†ï¼

é…ç½®ç®¡ç†å†™æ³•ï¼ˆå¥½ï¼‰ï¼š
def connect_database():
    host = config.get('database.host')
    port = config.get('database.port') 
    username = config.get('database.username')
    password = config.get('database.password')
```

---

## 2. ğŸ“„ é…ç½®æ–‡ä»¶æ ¼å¼è¯¦è§£


### 2.1 JSONæ ¼å¼é…ç½®


**ç‰¹ç‚¹**ï¼šç»“æ„æ¸…æ™°ï¼ŒPythonåŸç”Ÿæ”¯æŒï¼Œä½†ä¸æ”¯æŒæ³¨é‡Š

```json
{
  "database": {
    "host": "localhost",
    "port": 3306,
    "username": "admin",
    "timeout": 30
  },
  "logging": {
    "level": "INFO",
    "file": "app.log"
  },
  "features": {
    "enable_cache": true,
    "max_connections": 100
  }
}
```

**Pythonè¯»å–JSONé…ç½®**ï¼š
```python
import json

# è¯»å–é…ç½®æ–‡ä»¶
def load_json_config(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        config = json.load(f)
    return config

# ä½¿ç”¨é…ç½®
config = load_json_config('config.json')
db_host = config['database']['host']
log_level = config['logging']['level']
```

**ä¼˜ç¼ºç‚¹åˆ†æ**ï¼š
```
âœ… ä¼˜ç‚¹ï¼š
â€¢ Pythonå†…ç½®æ”¯æŒï¼Œæ— éœ€é¢å¤–åº“
â€¢ ç»“æ„æ¸…æ™°ï¼Œæ”¯æŒåµŒå¥—
â€¢ æ•°æ®ç±»å‹æ˜ç¡®ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ï¼‰

âŒ ç¼ºç‚¹ï¼š
â€¢ ä¸æ”¯æŒæ³¨é‡Šï¼Œæ— æ³•æ·»åŠ è¯´æ˜
â€¢ è¯­æ³•ä¸¥æ ¼ï¼Œå°‘ä¸ªé€—å·å°±æŠ¥é”™
â€¢ ä¸æ”¯æŒå¤šè¡Œå­—ç¬¦ä¸²
```

### 2.2 YAMLæ ¼å¼é…ç½®


**ç‰¹ç‚¹**ï¼šäººç±»å‹å¥½ï¼Œæ”¯æŒæ³¨é‡Šï¼Œæ ¼å¼ç®€æ´

```yaml
# æ•°æ®åº“é…ç½®
database:
  host: localhost
  port: 3306
  username: admin
  timeout: 30
  
# æ—¥å¿—é…ç½®  
logging:
  level: INFO
  file: app.log
  
# åŠŸèƒ½å¼€å…³
features:
  enable_cache: true
  max_connections: 100
  
# æ”¯æŒåˆ—è¡¨
allowed_ips:
  - 192.168.1.100
  - 192.168.1.101
  - 192.168.1.102
```

**Pythonè¯»å–YAMLé…ç½®**ï¼š
```python
import yaml

def load_yaml_config(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        config = yaml.safe_load(f)
    return config

# ä½¿ç”¨é…ç½®
config = load_yaml_config('config.yaml')
db_host = config['database']['host']
allowed_ips = config['allowed_ips']
```

**YAMLçš„äººæ€§åŒ–ç‰¹ç‚¹**ï¼š
```
# æ”¯æŒå¤šè¡Œæ–‡æœ¬
description: |
  è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œçš„æè¿°æ–‡æœ¬ï¼Œ
  å¯ä»¥å†™å¾ˆé•¿çš„è¯´æ˜ï¼Œ
  ä¿æŒåŸæœ‰çš„æ¢è¡Œæ ¼å¼ã€‚

# æ”¯æŒå¼•ç”¨ï¼Œé¿å…é‡å¤
default_settings: &defaults
  timeout: 30
  retry: 3

production:
  <<: *defaults  # ç»§æ‰¿é»˜è®¤è®¾ç½®
  host: prod.example.com

development:
  <<: *defaults  # ç»§æ‰¿é»˜è®¤è®¾ç½®  
  host: dev.example.com
```

### 2.3 INIæ ¼å¼é…ç½®


**ç‰¹ç‚¹**ï¼šç®€å•æ˜“è¯»ï¼Œé€‚åˆç®€å•é…ç½®ï¼ŒWindowsç³»ç»Ÿå¸¸ç”¨

```ini
# æ•°æ®åº“é…ç½®
[database]
host = localhost
port = 3306
username = admin
password = secret
timeout = 30

# æ—¥å¿—é…ç½®
[logging]
level = INFO
file = app.log
format = %(asctime)s - %(name)s - %(levelname)s - %(message)s

# åŠŸèƒ½å¼€å…³
[features]
enable_cache = true
max_connections = 100
debug_mode = false
```

**Pythonè¯»å–INIé…ç½®**ï¼š
```python
import configparser

def load_ini_config(file_path):
    config = configparser.ConfigParser()
    config.read(file_path, encoding='utf-8')
    return config

# ä½¿ç”¨é…ç½®
config = load_ini_config('config.ini')
db_host = config['database']['host']
db_port = config.getint('database', 'port')  # è‡ªåŠ¨è½¬æ¢ç±»å‹
enable_cache = config.getboolean('features', 'enable_cache')
```

**INIæ ¼å¼çš„ç‰¹æ®Šå¤„ç†**ï¼š
```python
# INIæ–‡ä»¶é»˜è®¤éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦ç±»å‹è½¬æ¢
port = config.getint('database', 'port')      # è½¬æ•´æ•°
timeout = config.getfloat('database', 'timeout')  # è½¬æµ®ç‚¹æ•°
debug = config.getboolean('features', 'debug_mode')  # è½¬å¸ƒå°”å€¼

# å¤„ç†åˆ—è¡¨ï¼ˆINIä¸ç›´æ¥æ”¯æŒåˆ—è¡¨ï¼‰
allowed_ips_str = config['security']['allowed_ips']  # "192.168.1.1,192.168.1.2"
allowed_ips = [ip.strip() for ip in allowed_ips_str.split(',')]
```

### 2.4 é…ç½®æ ¼å¼é€‰æ‹©æŒ‡å—


| æ ¼å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|-------------|---------|---------|
| **JSON** | `APIé…ç½®ã€ç®€å•ç»“æ„` | `PythonåŸç”Ÿæ”¯æŒ` | `æ— æ³¨é‡Šã€è¯­æ³•ä¸¥æ ¼` |
| **YAML** | `å¤æ‚é…ç½®ã€å›¢é˜Ÿåä½œ` | `äººç±»å‹å¥½ã€æ”¯æŒæ³¨é‡Š` | `éœ€è¦é¢å¤–åº“ã€ç¼©è¿›æ•æ„Ÿ` |
| **INI** | `ç®€å•é…ç½®ã€ä¼ ç»Ÿåº”ç”¨` | `ç®€å•æ˜“è¯»ã€å¹¿æ³›æ”¯æŒ` | `åŠŸèƒ½æœ‰é™ã€éœ€ç±»å‹è½¬æ¢` |

---

## 3. ğŸŒ ç¯å¢ƒå˜é‡é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡


**é€šä¿—è§£é‡Š**ï¼šç¯å¢ƒå˜é‡å°±åƒæ˜¯æ“ä½œç³»ç»Ÿçš„"å…¨å±€è®¾ç½®"ï¼Œä»»ä½•ç¨‹åºéƒ½èƒ½è¯»å–åˆ°ã€‚

```
ç¯å¢ƒå˜é‡çš„ç”Ÿæ´»ç±»æ¯”ï¼š
ğŸ¢ å…¬å¸å…¬å‘Šæ  â†’ æ‰€æœ‰å‘˜å·¥éƒ½èƒ½çœ‹åˆ°çš„ä¿¡æ¯
ğŸ“º ç”µè§†é¢‘é“ â†’ å®¶é‡Œæ‰€æœ‰äººéƒ½çŸ¥é“ç°åœ¨æ’­ä»€ä¹ˆ
ğŸŒ¡ï¸ å®¤å†…æ¸©åº¦ â†’ æˆ¿é—´é‡Œçš„æ‰€æœ‰è®¾å¤‡éƒ½èƒ½æ„ŸçŸ¥åˆ°

ç¨‹åºä¸­çš„ç¯å¢ƒå˜é‡ï¼š
DATABASE_URL=mysql://user:pass@localhost/mydb
DEBUG=true
SECRET_KEY=your-secret-key-here
```

### 3.2 Pythonè¯»å–ç¯å¢ƒå˜é‡


```python
import os

# åŸºæœ¬è¯»å–æ–¹æ³•
database_url = os.environ.get('DATABASE_URL')
debug_mode = os.environ.get('DEBUG', 'false')  # æä¾›é»˜è®¤å€¼

# å¤„ç†ä¸åŒæ•°æ®ç±»å‹
def get_env_bool(key, default=False):
    """å°†ç¯å¢ƒå˜é‡è½¬æ¢ä¸ºå¸ƒå°”å€¼"""
    value = os.environ.get(key, str(default)).lower()
    return value in ('true', '1', 'yes', 'on')

def get_env_int(key, default=0):
    """å°†ç¯å¢ƒå˜é‡è½¬æ¢ä¸ºæ•´æ•°"""
    try:
        return int(os.environ.get(key, default))
    except ValueError:
        return default

# ä½¿ç”¨ç¤ºä¾‹
DEBUG = get_env_bool('DEBUG', False)
MAX_CONNECTIONS = get_env_int('MAX_CONNECTIONS', 100)
SECRET_KEY = os.environ.get('SECRET_KEY', 'default-secret')
```

### 3.3 è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ³•


**Linux/Macè®¾ç½®æ–¹å¼**ï¼š
```bash
# ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰
export DATABASE_URL="mysql://localhost/mydb"
export DEBUG=true

# æ°¸ä¹…è®¾ç½®ï¼ˆå†™å…¥.bashrcæˆ–.zshrcï¼‰
echo 'export DATABASE_URL="mysql://localhost/mydb"' >> ~/.bashrc

# è¿è¡Œæ—¶è®¾ç½®
DATABASE_URL="mysql://localhost/mydb" python app.py
```

**Windowsè®¾ç½®æ–¹å¼**ï¼š
```cmd
# ä¸´æ—¶è®¾ç½®
set DATABASE_URL=mysql://localhost/mydb
set DEBUG=true

# æ°¸ä¹…è®¾ç½®ï¼ˆé€šè¿‡ç³»ç»Ÿå±æ€§ï¼‰
setx DATABASE_URL "mysql://localhost/mydb"
```

### 3.4 .envæ–‡ä»¶ç®¡ç†


**ä»€ä¹ˆæ˜¯.envæ–‡ä»¶**ï¼šæŠŠç¯å¢ƒå˜é‡å†™åœ¨æ–‡ä»¶é‡Œï¼Œæ–¹ä¾¿ç®¡ç†

```bash
# .env æ–‡ä»¶å†…å®¹
DATABASE_URL=mysql://user:password@localhost/mydb
REDIS_URL=redis://localhost:6379
DEBUG=true
SECRET_KEY=your-very-secret-key
API_KEY=your-api-key
MAX_CONNECTIONS=100
```

**ä½¿ç”¨python-dotenvåº“**ï¼š
```python
from dotenv import load_dotenv
import os

# åŠ è½½.envæ–‡ä»¶
load_dotenv()

# ç°åœ¨å¯ä»¥åƒæ™®é€šç¯å¢ƒå˜é‡ä¸€æ ·è¯»å–
database_url = os.environ.get('DATABASE_URL')
debug = os.environ.get('DEBUG') == 'true'
secret_key = os.environ.get('SECRET_KEY')
```

**å®‰è£…python-dotenv**ï¼š
```bash
pip install python-dotenv
```

### 3.5 ç¯å¢ƒå˜é‡çš„æœ€ä½³å®è·µ


```python
# åˆ›å»ºé…ç½®ç±»ï¼Œç»Ÿä¸€ç®¡ç†ç¯å¢ƒå˜é‡
class Config:
    def __init__(self):
        # æ•°æ®åº“é…ç½®
        self.DATABASE_URL = os.environ.get('DATABASE_URL', 'sqlite:///app.db')
        
        # å®‰å…¨é…ç½®
        self.SECRET_KEY = os.environ.get('SECRET_KEY')
        if not self.SECRET_KEY:
            raise ValueError("SECRET_KEYç¯å¢ƒå˜é‡å¿…é¡»è®¾ç½®!")
        
        # åŠŸèƒ½å¼€å…³
        self.DEBUG = os.environ.get('DEBUG', 'false').lower() == 'true'
        
        # æ•°å€¼é…ç½®
        self.MAX_CONNECTIONS = int(os.environ.get('MAX_CONNECTIONS', '100'))
        
    def validate(self):
        """éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§"""
        if not self.SECRET_KEY:
            raise ValueError("SECRET_KEYä¸èƒ½ä¸ºç©º")
        if self.MAX_CONNECTIONS <= 0:
            raise ValueError("MAX_CONNECTIONSå¿…é¡»å¤§äº0")

# ä½¿ç”¨é…ç½®
config = Config()
config.validate()
```

---

## 4. ğŸ—ï¸ é…ç½®å±‚æ¬¡ç®¡ç†


### 4.1 ä»€ä¹ˆæ˜¯é…ç½®å±‚æ¬¡


**é€šä¿—è§£é‡Š**ï¼šé…ç½®å±‚æ¬¡å°±åƒç©¿è¡£æœä¸€æ ·ï¼Œé‡Œé¢ç©¿å†…è¡£ï¼Œå¤–é¢ç©¿å¤–å¥—ï¼Œä¸åŒå±‚æ¬¡æœ‰ä¸åŒä½œç”¨ã€‚

```
é…ç½®å±‚æ¬¡çš„ç”Ÿæ´»ç±»æ¯”ï¼š
ğŸ‘” ç©¿è¡£æ­é…ï¼šå†…è¡£(åŸºç¡€) â†’ è¡¬è¡«(é€šç”¨) â†’ å¤–å¥—(ç‰¹å®šåœºåˆ)
ğŸ° åšè›‹ç³•ï¼šé¢ç²‰åŸºç¡€ â†’ åŠ ç³–è°ƒå‘³ â†’ ç‰¹æ®Šè£…é¥°
ğŸ“± æ‰‹æœºè®¾ç½®ï¼šå‡ºå‚è®¾ç½® â†’ ç”¨æˆ·åå¥½ â†’ ä¸´æ—¶è°ƒæ•´

ç¨‹åºé…ç½®å±‚æ¬¡ï¼š
é»˜è®¤é…ç½® â†’ ç¯å¢ƒé…ç½® â†’ ç”¨æˆ·é…ç½® â†’ å‘½ä»¤è¡Œå‚æ•°
(ä¼˜å…ˆçº§ä»ä½åˆ°é«˜)
```

### 4.2 é…ç½®å±‚æ¬¡è®¾è®¡


```python
class ConfigManager:
    def __init__(self):
        self.config = {}
        
    def load_config(self):
        # ç¬¬1å±‚ï¼šé»˜è®¤é…ç½®ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
        self._load_defaults()
        
        # ç¬¬2å±‚ï¼šé…ç½®æ–‡ä»¶
        self._load_from_file()
        
        # ç¬¬3å±‚ï¼šç¯å¢ƒå˜é‡
        self._load_from_env()
        
        # ç¬¬4å±‚ï¼šå‘½ä»¤è¡Œå‚æ•°ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
        self._load_from_args()
        
    def _load_defaults(self):
        """åŠ è½½é»˜è®¤é…ç½®"""
        defaults = {
            'database': {
                'host': 'localhost',
                'port': 3306,
                'timeout': 30
            },
            'logging': {
                'level': 'INFO',
                'format': '%(asctime)s - %(levelname)s - %(message)s'
            },
            'features': {
                'debug': False,
                'cache_enabled': True
            }
        }
        self.config.update(defaults)
        
    def _load_from_file(self):
        """ä»é…ç½®æ–‡ä»¶åŠ è½½"""
        import yaml
        try:
            with open('config.yaml', 'r') as f:
                file_config = yaml.safe_load(f)
                self._merge_config(file_config)
        except FileNotFoundError:
            print("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")
            
    def _load_from_env(self):
        """ä»ç¯å¢ƒå˜é‡åŠ è½½"""
        env_mapping = {
            'DATABASE_HOST': 'database.host',
            'DATABASE_PORT': 'database.port', 
            'LOG_LEVEL': 'logging.level',
            'DEBUG': 'features.debug'
        }
        
        for env_key, config_path in env_mapping.items():
            env_value = os.environ.get(env_key)
            if env_value:
                self._set_nested_config(config_path, env_value)
                
    def _merge_config(self, new_config):
        """åˆå¹¶é…ç½®ï¼Œæ–°é…ç½®è¦†ç›–æ—§é…ç½®"""
        def merge_dict(target, source):
            for key, value in source.items():
                if key in target and isinstance(target[key], dict) and isinstance(value, dict):
                    merge_dict(target[key], value)
                else:
                    target[key] = value
        
        merge_dict(self.config, new_config)
```

### 4.3 é…ç½®ä¼˜å…ˆçº§ç¤ºä¾‹


```
é…ç½®åˆå¹¶è¿‡ç¨‹ç¤ºä¾‹ï¼š

1. é»˜è®¤é…ç½®ï¼š
   database:
     host: localhost
     port: 3306
     timeout: 30

2. é…ç½®æ–‡ä»¶è¦†ç›–ï¼š
   database:
     host: prod.example.com  # è¦†ç›–é»˜è®¤å€¼
     port: 3306              # ä¿æŒé»˜è®¤å€¼
     timeout: 30             # ä¿æŒé»˜è®¤å€¼

3. ç¯å¢ƒå˜é‡è¦†ç›–ï¼š
   DATABASE_PORT=5432       # å†æ¬¡è¦†ç›–
   
4. æœ€ç»ˆé…ç½®ï¼š
   database:
     host: prod.example.com  # æ¥è‡ªé…ç½®æ–‡ä»¶
     port: 5432              # æ¥è‡ªç¯å¢ƒå˜é‡
     timeout: 30             # æ¥è‡ªé»˜è®¤é…ç½®
```

### 4.4 ä¸åŒç¯å¢ƒçš„é…ç½®ç®¡ç†


```python
class EnvironmentConfig:
    def __init__(self, env_name=None):
        self.env_name = env_name or os.environ.get('APP_ENV', 'development')
        self.config = self._load_config()
        
    def _load_config(self):
        # åŸºç¡€é…ç½®
        base_config = self._load_base_config()
        
        # ç¯å¢ƒç‰¹å®šé…ç½®
        env_config = self._load_env_config(self.env_name)
        
        # åˆå¹¶é…ç½®
        return self._merge_configs(base_config, env_config)
        
    def _load_base_config(self):
        """åŠ è½½æ‰€æœ‰ç¯å¢ƒé€šç”¨çš„é…ç½®"""
        return {
            'app_name': 'MyApp',
            'version': '1.0.0',
            'timezone': 'UTC'
        }
        
    def _load_env_config(self, env_name):
        """åŠ è½½ç‰¹å®šç¯å¢ƒçš„é…ç½®"""
        configs = {
            'development': {
                'database': {
                    'host': 'localhost',
                    'debug': True
                },
                'logging': {'level': 'DEBUG'}
            },
            'testing': {
                'database': {
                    'host': 'test-db',
                    'debug': True
                },
                'logging': {'level': 'INFO'}
            },
            'production': {
                'database': {
                    'host': 'prod-db.example.com',
                    'debug': False
                },
                'logging': {'level': 'WARNING'}
            }
        }
        return configs.get(env_name, {})

# ä½¿ç”¨ç¤ºä¾‹
config = EnvironmentConfig('production')
db_host = config.config['database']['host']
```

---

## 5. ğŸ” æ•æ„Ÿä¿¡æ¯å¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿä¿¡æ¯


**é€šä¿—è§£é‡Š**ï¼šæ•æ„Ÿä¿¡æ¯å°±åƒä½ çš„é“¶è¡Œå¡å¯†ç ï¼Œç»å¯¹ä¸èƒ½éšä¾¿å‘Šè¯‰åˆ«äººæˆ–å†™åœ¨æ˜æ˜¾çš„åœ°æ–¹ã€‚

```
ç¨‹åºä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼š
ğŸ”‘ æ•°æ®åº“å¯†ç 
ğŸ—ï¸ APIå¯†é’¥ 
ğŸ« JWTå¯†é’¥
ğŸ’³ ç¬¬ä¸‰æ–¹æœåŠ¡ä»¤ç‰Œ
ğŸ“§ é‚®ç®±å¯†ç 
â˜ï¸ äº‘æœåŠ¡å‡­è¯

å±é™©åšæ³•ï¼š
âŒ å†™åœ¨ä»£ç é‡Œï¼špassword = "123456"
âŒ æäº¤åˆ°Gitï¼šconfig.pyåŒ…å«å¯†ç 
âŒ æ˜æ–‡å­˜å‚¨ï¼šå¯†ç æ²¡æœ‰åŠ å¯†
âŒ æ—¥å¿—è¾“å‡ºï¼šæŠŠå¯†ç æ‰“å°åˆ°æ—¥å¿—é‡Œ
```

### 5.2 å¯†é’¥ç®¡ç†ç­–ç•¥


**åŸºæœ¬åŸåˆ™**ï¼šåˆ†ç¦»å­˜å‚¨ï¼ŒåŠ å¯†ä¿æŠ¤ï¼Œæœ€å°æƒé™

```python
# âŒ é”™è¯¯åšæ³•ï¼šå¯†ç å†™åœ¨ä»£ç é‡Œ
def connect_database():
    password = "super_secret_password"  # å±é™©ï¼
    return connect(host="localhost", password=password)

# âœ… æ­£ç¡®åšæ³•ï¼šä»å®‰å…¨åœ°æ–¹è¯»å–
def connect_database():
    password = os.environ.get('DB_PASSWORD')
    if not password:
        raise ValueError("æ•°æ®åº“å¯†ç æœªè®¾ç½®")
    return connect(host="localhost", password=password)
```

### 5.3 ä½¿ç”¨keyringåº“ç®¡ç†å¯†é’¥


**keyring**ï¼šç³»ç»Ÿçº§å¯†é’¥å­˜å‚¨ï¼Œåƒæ“ä½œç³»ç»Ÿçš„å¯†ç ç®¡ç†å™¨

```python
import keyring
import getpass

# å­˜å‚¨å¯†é’¥ï¼ˆåªéœ€è¦åšä¸€æ¬¡ï¼‰
def store_password():
    service_name = "myapp_database"
    username = "admin"
    password = getpass.getpass("è¯·è¾“å…¥æ•°æ®åº“å¯†ç : ")
    keyring.set_password(service_name, username, password)
    print("å¯†ç å·²å®‰å…¨å­˜å‚¨")

# è¯»å–å¯†é’¥
def get_database_password():
    service_name = "myapp_database"
    username = "admin"
    password = keyring.get_password(service_name, username)
    if not password:
        raise ValueError("æœªæ‰¾åˆ°å­˜å‚¨çš„å¯†ç ")
    return password

# ä½¿ç”¨ç¤ºä¾‹
try:
    db_password = get_database_password()
    # è¿æ¥æ•°æ®åº“...
except ValueError:
    print("è¯·å…ˆè®¾ç½®æ•°æ®åº“å¯†ç ")
    store_password()
```

### 5.4 ç¯å¢ƒå˜é‡ + .envæ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯


```python
# .env æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ°Gitï¼ï¼‰
DATABASE_PASSWORD=your_secret_password
API_KEY=your_api_key_here
JWT_SECRET=your_jwt_secret

# .gitignore æ–‡ä»¶ï¼ˆç¡®ä¿.envä¸è¢«æäº¤ï¼‰
.env
*.env
.env.local
.env.production

# Pythonä»£ç 
from dotenv import load_dotenv
import os

load_dotenv()  # åŠ è½½.envæ–‡ä»¶

class SecureConfig:
    def __init__(self):
        # å¿…éœ€çš„æ•æ„Ÿä¿¡æ¯
        self.database_password = self._get_required_env('DATABASE_PASSWORD')
        self.api_key = self._get_required_env('API_KEY')
        self.jwt_secret = self._get_required_env('JWT_SECRET')
        
    def _get_required_env(self, key):
        """è·å–å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸"""
        value = os.environ.get(key)
        if not value:
            raise ValueError(f"ç¯å¢ƒå˜é‡ {key} æ˜¯å¿…éœ€çš„ï¼Œä½†æœªè®¾ç½®")
        return value
        
    def mask_sensitive_info(self, value):
        """é®ç›–æ•æ„Ÿä¿¡æ¯ç”¨äºæ—¥å¿—è¾“å‡º"""
        if len(value) <= 4:
            return "*" * len(value)
        return value[:2] + "*" * (len(value) - 4) + value[-2:]

# ä½¿ç”¨ç¤ºä¾‹
config = SecureConfig()
print(f"API Key: {config.mask_sensitive_info(config.api_key)}")  # è¾“å‡ºï¼šap***ey
```

### 5.5 é…ç½®åŠ å¯†å­˜å‚¨


```python
from cryptography.fernet import Fernet
import base64
import json

class EncryptedConfig:
    def __init__(self, key=None):
        if key:
            self.cipher = Fernet(key)
        else:
            # ä»ç¯å¢ƒå˜é‡è·å–åŠ å¯†å¯†é’¥
            key_str = os.environ.get('CONFIG_ENCRYPTION_KEY')
            if key_str:
                self.cipher = Fernet(key_str.encode())
            else:
                raise ValueError("éœ€è¦è®¾ç½®CONFIG_ENCRYPTION_KEYç¯å¢ƒå˜é‡")
    
    @staticmethod
    def generate_key():
        """ç”Ÿæˆæ–°çš„åŠ å¯†å¯†é’¥"""
        key = Fernet.generate_key()
        print(f"è¯·ä¿å­˜æ­¤å¯†é’¥åˆ°ç¯å¢ƒå˜é‡: {key.decode()}")
        return key
    
    def encrypt_config(self, config_dict, output_file):
        """åŠ å¯†é…ç½®å¹¶ä¿å­˜åˆ°æ–‡ä»¶"""
        json_data = json.dumps(config_dict)
        encrypted_data = self.cipher.encrypt(json_data.encode())
        
        with open(output_file, 'wb') as f:
            f.write(encrypted_data)
    
    def decrypt_config(self, config_file):
        """ä»åŠ å¯†æ–‡ä»¶è¯»å–é…ç½®"""
        with open(config_file, 'rb') as f:
            encrypted_data = f.read()
            
        decrypted_data = self.cipher.decrypt(encrypted_data)
        return json.loads(decrypted_data.decode())

# ä½¿ç”¨ç¤ºä¾‹
# 1. ç”Ÿæˆå¯†é’¥ï¼ˆåªéœ€è¦åšä¸€æ¬¡ï¼‰
# key = EncryptedConfig.generate_key()

# 2. åŠ å¯†æ•æ„Ÿé…ç½®
sensitive_config = {
    "database_password": "super_secret_password",
    "api_keys": {
        "stripe": "sk_live_...",
        "sendgrid": "SG...."
    }
}

config_manager = EncryptedConfig()
config_manager.encrypt_config(sensitive_config, 'secure_config.enc')

# 3. è¯»å–åŠ å¯†é…ç½®
decrypted_config = config_manager.decrypt_config('secure_config.enc')
```

---

## 6. âœ… é…ç½®éªŒè¯


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®éªŒè¯


**é€šä¿—è§£é‡Š**ï¼šé…ç½®éªŒè¯å°±åƒä½“æ£€ï¼Œåœ¨ç¨‹åºè¿è¡Œå‰æ£€æŸ¥é…ç½®æ˜¯å¦å¥åº·ï¼Œé¿å…è¿è¡Œæ—¶å‡ºé—®é¢˜ã€‚

```
æ²¡æœ‰é…ç½®éªŒè¯çš„é—®é¢˜ï¼š
âŒ ç«¯å£å·å†™æˆäº†å­—ç¬¦ä¸² "80" è€Œä¸æ˜¯æ•°å­— 80
âŒ æ•°æ®åº“URLæ ¼å¼é”™è¯¯ï¼Œè¿æ¥å¤±è´¥
âŒ å¿…éœ€çš„é…ç½®é¡¹ç¼ºå¤±ï¼Œç¨‹åºå´©æºƒ
âŒ é…ç½®å€¼è¶…å‡ºåˆç†èŒƒå›´ï¼Œæ¯”å¦‚è¶…æ—¶æ—¶é—´-1ç§’

æœ‰äº†é…ç½®éªŒè¯çš„å¥½å¤„ï¼š
âœ… ç¨‹åºå¯åŠ¨å‰å°±å‘ç°é…ç½®é—®é¢˜
âœ… æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
âœ… è‡ªåŠ¨è½¬æ¢æ•°æ®ç±»å‹
âœ… ä¿è¯é…ç½®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§
```

### 6.2 åŸºç¡€é…ç½®éªŒè¯


```python
class ConfigValidator:
    def __init__(self, config):
        self.config = config
        self.errors = []
        
    def validate_all(self):
        """éªŒè¯æ‰€æœ‰é…ç½®é¡¹"""
        self._validate_database()
        self._validate_logging()
        self._validate_security()
        
        if self.errors:
            error_msg = "\n".join(self.errors)
            raise ValueError(f"é…ç½®éªŒè¯å¤±è´¥:\n{error_msg}")
            
        return True
        
    def _validate_database(self):
        """éªŒè¯æ•°æ®åº“é…ç½®"""
        db_config = self.config.get('database', {})
        
        # æ£€æŸ¥å¿…éœ€å­—æ®µ
        required_fields = ['host', 'port', 'username']
        for field in required_fields:
            if field not in db_config:
                self.errors.append(f"æ•°æ®åº“é…ç½®ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")
                
        # éªŒè¯ç«¯å£å·
        port = db_config.get('port')
        if port is not None:
            if not isinstance(port, int) or port <= 0 or port > 65535:
                self.errors.append(f"æ•°æ®åº“ç«¯å£å·æ— æ•ˆ: {port}")
                
        # éªŒè¯è¶…æ—¶æ—¶é—´
        timeout = db_config.get('timeout', 30)
        if not isinstance(timeout, (int, float)) or timeout <= 0:
            self.errors.append(f"æ•°æ®åº“è¶…æ—¶æ—¶é—´æ— æ•ˆ: {timeout}")
            
    def _validate_logging(self):
        """éªŒè¯æ—¥å¿—é…ç½®"""
        log_config = self.config.get('logging', {})
        
        # éªŒè¯æ—¥å¿—çº§åˆ«
        valid_levels = ['DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL']
        level = log_config.get('level', 'INFO')
        if level not in valid_levels:
            self.errors.append(f"æ—¥å¿—çº§åˆ«æ— æ•ˆ: {level}, æœ‰æ•ˆå€¼: {valid_levels}")
            
    def _validate_security(self):
        """éªŒè¯å®‰å…¨é…ç½®"""
        security_config = self.config.get('security', {})
        
        # éªŒè¯å¯†é’¥é•¿åº¦
        secret_key = security_config.get('secret_key')
        if secret_key and len(secret_key) < 32:
            self.errors.append("å®‰å…¨å¯†é’¥é•¿åº¦è‡³å°‘éœ€è¦32ä¸ªå­—ç¬¦")

# ä½¿ç”¨ç¤ºä¾‹
config = {
    'database': {
        'host': 'localhost',
        'port': 3306,
        'username': 'admin',
        'timeout': 30
    },
    'logging': {
        'level': 'INFO'
    },
    'security': {
        'secret_key': 'your-very-long-secret-key-here'
    }
}

validator = ConfigValidator(config)
try:
    validator.validate_all()
    print("é…ç½®éªŒè¯é€šè¿‡")
except ValueError as e:
    print(f"é…ç½®éªŒè¯å¤±è´¥: {e}")
```

### 6.3 ä½¿ç”¨Pydanticè¿›è¡Œé«˜çº§éªŒè¯


**Pydantic**ï¼šä¸“ä¸šçš„æ•°æ®éªŒè¯åº“ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œé”™è¯¯ä¿¡æ¯æ¸…æ™°

```python
from pydantic import BaseModel, Field, validator
from typing import Optional
import re

class DatabaseConfig(BaseModel):
    host: str = Field(..., description="æ•°æ®åº“ä¸»æœºåœ°å€")
    port: int = Field(default=3306, ge=1, le=65535, description="æ•°æ®åº“ç«¯å£")
    username: str = Field(..., min_length=1, description="ç”¨æˆ·å")
    password: str = Field(..., min_length=6, description="å¯†ç ")
    timeout: float = Field(default=30.0, gt=0, description="è¿æ¥è¶…æ—¶æ—¶é—´")
    
    @validator('host')
    def validate_host(cls, v):
        # ç®€å•çš„ä¸»æœºåéªŒè¯
        if not re.match(r'^[a-zA-Z0-9.-]+$', v):
            raise ValueError('ä¸»æœºåæ ¼å¼æ— æ•ˆ')
        return v

class LoggingConfig(BaseModel):
    level: str = Field(default="INFO", description="æ—¥å¿—çº§åˆ«")
    file: Optional[str] = Field(None, description="æ—¥å¿—æ–‡ä»¶è·¯å¾„")
    max_size: int = Field(default=10*1024*1024, ge=1024, description="æ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°")
    
    @validator('level')
    def validate_level(cls, v):
        valid_levels = ['DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL']
        if v.upper() not in valid_levels:
            raise ValueError(f'æ—¥å¿—çº§åˆ«å¿…é¡»æ˜¯: {valid_levels}')
        return v.upper()

class AppConfig(BaseModel):
    app_name: str = Field(..., min_length=1, description="åº”ç”¨åç§°")
    debug: bool = Field(default=False, description="è°ƒè¯•æ¨¡å¼")
    secret_key: str = Field(..., min_length=32, description="å®‰å…¨å¯†é’¥")
    database: DatabaseConfig
    logging: LoggingConfig
    
    class Config:
        # é¢å¤–å­—æ®µå¤„ç†ç­–ç•¥
        extra = "forbid"  # ç¦æ­¢é¢å¤–å­—æ®µ

# ä½¿ç”¨ç¤ºä¾‹
config_data = {
    "app_name": "MyApp",
    "debug": True,
    "secret_key": "this-is-a-very-long-secret-key-for-security",
    "database": {
        "host": "localhost",
        "port": 3306,
        "username": "admin",
        "password": "password123",
        "timeout": 30.0
    },
    "logging": {
        "level": "debug",  # ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¤§å†™
        "file": "app.log",
        "max_size": 10485760
    }
}

try:
    config = AppConfig(**config_data)
    print("é…ç½®éªŒè¯æˆåŠŸ!")
    print(f"æ•°æ®åº“ç«¯å£: {config.database.port}")
    print(f"æ—¥å¿—çº§åˆ«: {config.logging.level}")
except Exception as e:
    print(f"é…ç½®éªŒè¯å¤±è´¥: {e}")
```

### 6.4 è‡ªå®šä¹‰éªŒè¯è§„åˆ™


```python
class AdvancedConfigValidator:
    def __init__(self, config):
        self.config = config
        
    def validate_url_format(self, url, field_name):
        """éªŒè¯URLæ ¼å¼"""
        url_pattern = re.compile(
            r'^https?://'  # http:// æˆ– https://
            r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|'  # åŸŸå
            r'localhost|'  # localhost
            r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})'  # IPåœ°å€
            r'(?::\d+)?'  # å¯é€‰ç«¯å£
            r'(?:/?|[/?]\S+)$', re.IGNORECASE)
        
        if not url_pattern.match(url):
            raise ValueError(f"{field_name} URLæ ¼å¼æ— æ•ˆ: {url}")
            
    def validate_file_path(self, path, field_name):
        """éªŒè¯æ–‡ä»¶è·¯å¾„"""
        import os
        
        # æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
        directory = os.path.dirname(path)
        if directory and not os.path.exists(directory):
            raise ValueError(f"{field_name} ç›®å½•ä¸å­˜åœ¨: {directory}")
            
        # æ£€æŸ¥æ˜¯å¦æœ‰å†™æƒé™
        try:
            test_file = path + '.test'
            with open(test_file, 'w') as f:
                f.write('test')
            os.remove(test_file)
        except PermissionError:
            raise ValueError(f"{field_name} æ²¡æœ‰å†™æƒé™: {path}")
            
    def validate_dependency_config(self):
        """éªŒè¯é…ç½®é—´çš„ä¾èµ–å…³ç³»"""
        # ä¾‹å¦‚ï¼šå¦‚æœå¯ç”¨äº†HTTPSï¼Œå¿…é¡»æä¾›è¯ä¹¦æ–‡ä»¶
        if self.config.get('server', {}).get('ssl_enabled'):
            ssl_cert = self.config.get('server', {}).get('ssl_cert_file')
            if not ssl_cert:
                raise ValueError("å¯ç”¨SSLæ—¶å¿…é¡»æä¾›è¯ä¹¦æ–‡ä»¶è·¯å¾„")
```

---

## 7. ğŸ”„ åŠ¨æ€é…ç½®åŠ è½½


### 7.1 ä»€ä¹ˆæ˜¯åŠ¨æ€é…ç½®åŠ è½½


**é€šä¿—è§£é‡Š**ï¼šåŠ¨æ€é…ç½®åŠ è½½å°±åƒç”µè§†é¥æ§å™¨ï¼Œä¸ç”¨é‡å¯ç”µè§†å°±èƒ½æ¢é¢‘é“ï¼Œç¨‹åºä¹Ÿèƒ½åœ¨è¿è¡Œæ—¶æ”¹å˜é…ç½®ã€‚

```
é™æ€é…ç½®çš„å±€é™ï¼š
âŒ æ”¹é…ç½®è¦é‡å¯ç¨‹åº
âŒ æ— æ³•å¿«é€Ÿå“åº”å˜åŒ–
âŒ ç»´æŠ¤çª—å£é•¿ï¼Œå½±å“æœåŠ¡

åŠ¨æ€é…ç½®çš„ä¼˜åŠ¿ï¼š
âœ… è¿è¡Œæ—¶ä¿®æ”¹é…ç½®
âœ… å¿«é€Ÿå“åº”ä¸šåŠ¡å˜åŒ–
âœ… å‡å°‘ç³»ç»Ÿåœæœºæ—¶é—´
âœ… æ”¯æŒA/Bæµ‹è¯•å’Œç°åº¦å‘å¸ƒ
```

### 7.2 æ–‡ä»¶ç›‘æ§å®ç°åŠ¨æ€åŠ è½½


```python
import time
import os
import threading
import yaml
from pathlib import Path

class FileWatcher:
    def __init__(self, file_path, callback):
        self.file_path = Path(file_path)
        self.callback = callback
        self.last_modified = 0
        self.running = False
        self.thread = None
        
    def start(self):
        """å¼€å§‹ç›‘æ§æ–‡ä»¶å˜åŒ–"""
        self.running = True
        self.thread = threading.Thread(target=self._watch_file)
        self.thread.daemon = True
        self.thread.start()
        print(f"å¼€å§‹ç›‘æ§é…ç½®æ–‡ä»¶: {self.file_path}")
        
    def stop(self):
        """åœæ­¢ç›‘æ§"""
        self.running = False
        if self.thread:
            self.thread.join()
            
    def _watch_file(self):
        """ç›‘æ§æ–‡ä»¶å˜åŒ–çš„åå°çº¿ç¨‹"""
        while self.running:
            try:
                if self.file_path.exists():
                    current_modified = self.file_path.stat().st_mtime
                    if current_modified != self.last_modified:
                        print(f"æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å˜åŒ–: {self.file_path}")
                        self.last_modified = current_modified
                        self.callback()
                        
                time.sleep(1)  # æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
            except Exception as e:
                print(f"ç›‘æ§æ–‡ä»¶æ—¶å‡ºé”™: {e}")
                time.sleep(5)  # å‡ºé”™æ—¶ç­‰å¾…æ›´é•¿æ—¶é—´

class DynamicConfig:
    def __init__(self, config_file):
        self.config_file = config_file
        self.config = {}
        self.callbacks = []
        
        # åˆå§‹åŠ è½½é…ç½®
        self.reload_config()
        
        # å¯åŠ¨æ–‡ä»¶ç›‘æ§
        self.watcher = FileWatcher(config_file, self.reload_config)
        self.watcher.start()
        
    def reload_config(self):
        """é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶"""
        try:
            with open(self.config_file, 'r', encoding='utf-8') as f:
                new_config = yaml.safe_load(f)
                
            old_config = self.config.copy()
            self.config = new_config
            
            print("é…ç½®é‡æ–°åŠ è½½æˆåŠŸ")
            
            # é€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨
            for callback in self.callbacks:
                try:
                    callback(old_config, new_config)
                except Exception as e:
                    print(f"é…ç½®å˜æ›´å›è°ƒå‡ºé”™: {e}")
                    
        except Exception as e:
            print(f"é‡æ–°åŠ è½½é…ç½®å¤±è´¥: {e}")
            
    def get(self, key, default=None):
        """è·å–é…ç½®å€¼ï¼Œæ”¯æŒç‚¹å·åˆ†éš”çš„åµŒå¥—é”®"""
        keys = key.split('.')
        value = self.config
        
        for k in keys:
            if isinstance(value, dict) and k in value:
                value = value[k]
            else:
                return default
                
        return value
        
    def on_config_change(self, callback):
        """æ³¨å†Œé…ç½®å˜æ›´å›è°ƒå‡½æ•°"""
        self.callbacks.append(callback)
        
    def stop(self):
        """åœæ­¢åŠ¨æ€é…ç½®ç›‘æ§"""
        self.watcher.stop()

# ä½¿ç”¨ç¤ºä¾‹
def on_database_config_change(old_config, new_config):
    """æ•°æ®åº“é…ç½®å˜æ›´å¤„ç†"""
    old_host = old_config.get('database', {}).get('host')
    new_host = new_config.get('database', {}).get('host')
    
    if old_host != new_host:
        print(f"æ•°æ®åº“ä¸»æœºå˜æ›´: {old_host} â†’ {new_host}")
        # è¿™é‡Œå¯ä»¥é‡æ–°åˆå§‹åŒ–æ•°æ®åº“è¿æ¥

# åˆ›å»ºåŠ¨æ€é…ç½®ç®¡ç†å™¨
config = DynamicConfig('config.yaml')
config.on_config_change(on_database_config_change)

# ä½¿ç”¨é…ç½®
db_host = config.get('database.host', 'localhost')
log_level = config.get('logging.level', 'INFO')

print(f"å½“å‰æ•°æ®åº“ä¸»æœº: {db_host}")
print("ç°åœ¨å¯ä»¥ä¿®æ”¹config.yamlæ–‡ä»¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®")
```

### 7.3 åŸºäºRedisçš„é…ç½®ä¸­å¿ƒ


```python
import redis
import json
import threading
import time

class RedisConfigCenter:
    def __init__(self, redis_host='localhost', redis_port=6379, redis_db=0):
        self.redis_client = redis.Redis(
            host=redis_host, 
            port=redis_port, 
            db=redis_db,
            decode_responses=True
        )
        self.config = {}
        self.callbacks = []
        self.pubsub = None
        self.listener_thread = None
        
    def start(self, config_key='app:config'):
        """å¯åŠ¨é…ç½®ä¸­å¿ƒ"""
        self.config_key = config_key
        
        # åˆå§‹åŠ è½½é…ç½®
        self.load_config()
        
        # å¯åŠ¨é…ç½®å˜æ›´ç›‘å¬
        self.start_listener()
        
    def load_config(self):
        """ä»RedisåŠ è½½é…ç½®"""
        try:
            config_str = self.redis_client.get(self.config_key)
            if config_str:
                self.config = json.loads(config_str)
                print("ä»RedisåŠ è½½é…ç½®æˆåŠŸ")
            else:
                print("Redisä¸­æ²¡æœ‰æ‰¾åˆ°é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")
        except Exception as e:
            print(f"ä»RedisåŠ è½½é…ç½®å¤±è´¥: {e}")
            
    def update_config(self, new_config):
        """æ›´æ–°Redisä¸­çš„é…ç½®"""
        try:
            config_str = json.dumps(new_config, ensure_ascii=False, indent=2)
            self.redis_client.set(self.config_key, config_str)
            
            # å‘å¸ƒé…ç½®å˜æ›´é€šçŸ¥
            self.redis_client.publish(f"{self.config_key}:change", "updated")
            print("é…ç½®æ›´æ–°æˆåŠŸ")
            
        except Exception as e:
            print(f"æ›´æ–°é…ç½®å¤±è´¥: {e}")
            
    def start_listener(self):
        """å¯åŠ¨é…ç½®å˜æ›´ç›‘å¬"""
        self.pubsub = self.redis_client.pubsub()
        self.pubsub.subscribe(f"{self.config_key}:change")
        
        self.listener_thread = threading.Thread(target=self._listen_for_changes)
        self.listener_thread.daemon = True
        self.listener_thread.start()
        
    def _listen_for_changes(self):
        """ç›‘å¬é…ç½®å˜æ›´çš„åå°çº¿ç¨‹"""
        for message in self.pubsub.listen():
            if message['type'] == 'message':
                print("æ”¶åˆ°é…ç½®å˜æ›´é€šçŸ¥ï¼Œé‡æ–°åŠ è½½é…ç½®")
                old_config = self.config.copy()
                self.load_config()
                
                # é€šçŸ¥å›è°ƒå‡½æ•°
                for callback in self.callbacks:
                    try:
                        callback(old_config, self.config)
                    except Exception as e:
                        print(f"é…ç½®å˜æ›´å›è°ƒå‡ºé”™: {e}")
                        
    def get(self, key, default=None):
        """è·å–é…ç½®å€¼"""
        keys = key.split('.')
        value = self.config
        
        for k in keys:
            if isinstance(value, dict) and k in value:
                value = value[k]
            else:
                return default
                
        return value
        
    def on_config_change(self, callback):
        """æ³¨å†Œé…ç½®å˜æ›´å›è°ƒ"""
        self.callbacks.append(callback)
        
    def stop(self):
        """åœæ­¢é…ç½®ä¸­å¿ƒ"""
        if self.pubsub:
            self.pubsub.close()

# ä½¿ç”¨ç¤ºä¾‹
config_center = RedisConfigCenter()
config_center.start()

# æ³¨å†Œé…ç½®å˜æ›´å›è°ƒ
def on_config_change(old_config, new_config):
    print("é…ç½®å·²æ›´æ–°")
    print(f"æ–°çš„æ•°æ®åº“ä¸»æœº: {new_config.get('database', {}).get('host')}")

config_center.on_config_change(on_config_change)

# è·å–é…ç½®
db_host = config_center.get('database.host', 'localhost')
print(f"å½“å‰æ•°æ®åº“ä¸»æœº: {db_host}")

# åœ¨å¦ä¸€ä¸ªè¿›ç¨‹æˆ–ç®¡ç†ç•Œé¢ä¸­æ›´æ–°é…ç½®
# new_config = {
#     "database": {"host": "new-db.example.com", "port": 3306},
#     "logging": {"level": "DEBUG"}
# }
# config_center.update_config(new_config)
```

---

## 8. ğŸ† é…ç½®æœ€ä½³å®è·µ


### 8.1 é…ç½®è®¾è®¡åŸåˆ™


**æ ¸å¿ƒåŸåˆ™**ï¼šç®€å•ã€å®‰å…¨ã€çµæ´»ã€å¯ç»´æŠ¤

```
ğŸ”¸ ç®€å•æ€§åŸåˆ™ï¼š
â€¢ é…ç½®ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£
â€¢ é¿å…è¿‡åº¦åµŒå¥—å’Œå¤æ‚é€»è¾‘
â€¢ æä¾›åˆç†çš„é»˜è®¤å€¼

ğŸ”¸ å®‰å…¨æ€§åŸåˆ™ï¼š
â€¢ æ•æ„Ÿä¿¡æ¯ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
â€¢ ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†å·¥å…·
â€¢ é…ç½®æ–‡ä»¶ä¸åŒ…å«å¯†ç 

ğŸ”¸ çµæ´»æ€§åŸåˆ™ï¼š
â€¢ æ”¯æŒå¤šç¯å¢ƒé…ç½®
â€¢ è¿è¡Œæ—¶å¯åŠ¨æ€è°ƒæ•´
â€¢ é…ç½®å±‚æ¬¡åŒ–ç®¡ç†

ğŸ”¸ å¯ç»´æŠ¤æ€§åŸåˆ™ï¼š
â€¢ é…ç½®æœ‰æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£
â€¢ ç‰ˆæœ¬æ§åˆ¶å’Œå˜æ›´è®°å½•
â€¢ é…ç½®éªŒè¯å’Œé”™è¯¯æç¤º
```

### 8.2 é¡¹ç›®é…ç½®ç»“æ„ç¤ºä¾‹


```
é¡¹ç›®é…ç½®ç›®å½•ç»“æ„ï¼š
myproject/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py          # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ development.py   # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ testing.py       # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ production.py    # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ local.py.example # æœ¬åœ°é…ç½®æ¨¡æ¿
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ app.yaml         # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ database.yaml    # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ logging.yaml     # æ—¥å¿—é…ç½®
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore          # å¿½ç•¥æ•æ„Ÿæ–‡ä»¶
â””â”€â”€ manage.py           # ç®¡ç†è„šæœ¬
```

### 8.3 é…ç½®ç®¡ç†ç±»çš„å®Œæ•´å®ç°


```python
import os
import yaml
import json
from pathlib import Path
from typing import Any, Dict, Optional

class ConfigManager:
    """ç»Ÿä¸€çš„é…ç½®ç®¡ç†å™¨"""
    
    def __init__(self, app_name: str = "myapp"):
        self.app_name = app_name
        self.env = os.environ.get('APP_ENV', 'development')
        self.config = {}
        self._load_all_configs()
        
    def _load_all_configs(self):
        """æŒ‰ä¼˜å…ˆçº§åŠ è½½æ‰€æœ‰é…ç½®"""
        # 1. åŠ è½½é»˜è®¤é…ç½®
        self._load_default_config()
        
        # 2. åŠ è½½åŸºç¡€é…ç½®æ–‡ä»¶
        self._load_config_file('config/base.yaml')
        
        # 3. åŠ è½½ç¯å¢ƒç‰¹å®šé…ç½®
        self._load_config_file(f'config/{self.env}.yaml')
        
        # 4. åŠ è½½æœ¬åœ°é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        self._load_config_file('config/local.yaml')
        
        # 5. ä»ç¯å¢ƒå˜é‡è¦†ç›–
        self._load_from_environment()
        
        # 6. éªŒè¯é…ç½®
        self._validate_config()
        
    def _load_default_config(self):
        """åŠ è½½é»˜è®¤é…ç½®"""
        defaults = {
            'app': {
                'name': self.app_name,
                'version': '1.0.0',
                'debug': False
            },
            'database': {
                'host': 'localhost',
                'port': 5432,
                'timeout': 30
            },
            'logging': {
                'level': 'INFO',
                'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
            }
        }
        self.config.update(defaults)
        
    def _load_config_file(self, file_path: str):
        """åŠ è½½é…ç½®æ–‡ä»¶"""
        path = Path(file_path)
        if not path.exists():
            return
            
        try:
            with open(path, 'r', encoding='utf-8') as f:
                if path.suffix in ['.yaml', '.yml']:
                    file_config = yaml.safe_load(f)
                elif path.suffix == '.json':
                    file_config = json.load(f)
                else:
                    return
                    
            if file_config:
                self._deep_merge(self.config, file_config)
                print(f"å·²åŠ è½½é…ç½®æ–‡ä»¶: {file_path}")
                
        except Exception as e:
            print(f"åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥ {file_path}: {e}")
            
    def _load_from_environment(self):
        """ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®"""
        env_mappings = {
            # æ•°æ®åº“é…ç½®
            'DATABASE_HOST': 'database.host',
            'DATABASE_PORT': 'database.port',
            'DATABASE_NAME': 'database.name',
            'DATABASE_USER': 'database.user',
            'DATABASE_PASSWORD': 'database.password',
            
            # åº”ç”¨é…ç½®
            'APP_DEBUG': 'app.debug',
            'APP_SECRET_KEY': 'app.secret_key',
            
            # æ—¥å¿—é…ç½®
            'LOG_LEVEL': 'logging.level',
        }
        
        for env_key, config_path in env_mappings.items():
            env_value = os.environ.get(env_key)
            if env_value is not None:
                self._set_nested_value(config_path, env_value)
                
    def _deep_merge(self, target: dict, source: dict):
        """æ·±åº¦åˆå¹¶å­—å…¸"""
        for key, value in source.items():
            if key in target and isinstance(target[key], dict) and isinstance(value, dict):
                self._deep_merge(target[key], value)
            else:
                target[key] = value
                
    def _set_nested_value(self, path: str, value: Any):
        """è®¾ç½®åµŒå¥—çš„é…ç½®å€¼"""
        keys = path.split('.')
        target = self.config
        
        for key in keys[:-1]:
            if key not in target:
                target[key] = {}
            target = target[key]
            
        # å°è¯•è½¬æ¢æ•°æ®ç±»å‹
        final_key = keys[-1]
        if isinstance(value, str):
            # å¸ƒå°”å€¼è½¬æ¢
            if value.lower() in ('true', 'false'):
                value = value.lower() == 'true'
            # æ•°å­—è½¬æ¢
            elif value.isdigit():
                value = int(value)
            # æµ®ç‚¹æ•°è½¬æ¢
            elif value.replace('.', '').isdigit():
                value = float(value)
                
        target[final_key] = value
        
    def _validate_config(self):
        """éªŒè¯é…ç½®çš„å®Œæ•´æ€§"""
        required_configs = [
            'app.name',
            'database.host',
            'database.port'
        ]
        
        missing_configs = []
        for config_path in required_configs:
            if self.get(config_path) is None:
                missing_configs.append(config_path)
                
        if missing_configs:
            raise ValueError(f"ç¼ºå°‘å¿…éœ€çš„é…ç½®é¡¹: {missing_configs}")
            
    def get(self, path: str, default: Any = None) -> Any:
        """è·å–é…ç½®å€¼"""
        keys = path.split('.')
        value = self.config
        
        for key in keys:
            if isinstance(value, dict) and key in value:
                value = value[key]
            else:
                return default
                
        return value
        
    def set(self, path: str, value: Any):
        """è®¾ç½®é…ç½®å€¼"""
        self._set_nested_value(path, value)
        
    def get_database_config(self) -> Dict[str, Any]:
        """è·å–æ•°æ®åº“é…ç½®"""
        return self.get('database', {})
        
    def get_logging_config(self) -> Dict[str, Any]:
        """è·å–æ—¥å¿—é…ç½®"""
        return self.get('logging', {})
        
    def is_debug(self) -> bool:
        """åˆ¤æ–­æ˜¯å¦ä¸ºè°ƒè¯•æ¨¡å¼"""
        return self.get('app.debug', False)
        
    def export_config(self, file_path: str):
        """å¯¼å‡ºå½“å‰é…ç½®åˆ°æ–‡ä»¶"""
        path = Path(file_path)
        
        with open(path, 'w', encoding='utf-8') as f:
            if path.suffix in ['.yaml', '.yml']:
                yaml.dump(self.config, f, default_flow_style=False, allow_unicode=True)
            elif path.suffix == '.json':
                json.dump(self.config, f, indent=2, ensure_ascii=False)
                
        print(f"é…ç½®å·²å¯¼å‡ºåˆ°: {file_path}")

# å…¨å±€é…ç½®å®ä¾‹
config = ConfigManager()

# ä½¿ç”¨ç¤ºä¾‹
print(f"åº”ç”¨åç§°: {config.get('app.name')}")
print(f"æ•°æ®åº“ä¸»æœº: {config.get('database.host')}")
print(f"æ˜¯å¦è°ƒè¯•æ¨¡å¼: {config.is_debug()}")

# è·å–æ•°æ®åº“è¿æ¥é…ç½®
db_config = config.get_database_config()
print(f"æ•°æ®åº“é…ç½®: {db_config}")
```

### 8.4 é…ç½®æ–‡æ¡£å’Œæ¨¡æ¿


```yaml
# config/base.yaml - åŸºç¡€é…ç½®æ¨¡æ¿
app:
  name: "MyApp"
  version: "1.0.0"
  debug: false
  secret_key: "${APP_SECRET_KEY}"  # ä»ç¯å¢ƒå˜é‡è·å–

database:
  host: "${DATABASE_HOST:localhost}"  # é»˜è®¤å€¼ä¸ºlocalhost
  port: "${DATABASE_PORT:5432}"
  name: "${DATABASE_NAME:myapp}"
  user: "${DATABASE_USER:postgres}"
  password: "${DATABASE_PASSWORD}"
  pool_size: 10
  timeout: 30

logging:
  level: "${LOG_LEVEL:INFO}"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/app.log"
  max_size: "10MB"
  backup_count: 5

redis:
  host: "${REDIS_HOST:localhost}"
  port: "${REDIS_PORT:6379}"
  db: "${REDIS_DB:0}"
  password: "${REDIS_PASSWORD:}"

features:
  enable_cache: true
  enable_metrics: false
  enable_tracing: false
```

```bash
# .env.example - ç¯å¢ƒå˜é‡æ¨¡æ¿
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º .env å¹¶å¡«å…¥å®é™…å€¼

# åº”ç”¨é…ç½®
APP_ENV=development
APP_SECRET_KEY=your-secret-key-here
APP_DEBUG=true

# æ•°æ®åº“é…ç½®
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=myapp
DATABASE_USER=postgres
DATABASE_PASSWORD=your-password-here

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# æ—¥å¿—é…ç½®
LOG_LEVEL=DEBUG

# ç¬¬ä¸‰æ–¹æœåŠ¡
API_KEY=your-api-key
EMAIL_PASSWORD=your-email-password
```

---

## 9. ğŸ› ï¸ é…ç½®å·¥å…·é€‰æ‹©


### 9.1 é…ç½®ç®¡ç†å·¥å…·å¯¹æ¯”


| å·¥å…· | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **æ¨èåº¦** |
|------|-------------|---------|---------|-----------|
| **å†…ç½®æ–¹æ³•** | `å°å‹é¡¹ç›®` | `ç®€å•ï¼Œæ— ä¾èµ–` | `åŠŸèƒ½æœ‰é™` | â­â­â­ |
| **python-dotenv** | `ç¯å¢ƒå˜é‡ç®¡ç†` | `è½»é‡ï¼Œæ˜“ç”¨` | `åªå¤„ç†.envæ–‡ä»¶` | â­â­â­â­ |
| **PyYAML** | `å¤æ‚é…ç½®` | `åŠŸèƒ½å¼ºå¤§ï¼Œäººç±»å‹å¥½` | `éœ€è¦é¢å¤–åº“` | â­â­â­â­â­ |
| **Pydantic** | `é…ç½®éªŒè¯` | `ç±»å‹å®‰å…¨ï¼ŒéªŒè¯å®Œå–„` | `å­¦ä¹ æˆæœ¬é«˜` | â­â­â­â­â­ |
| **Dynaconf** | `å¤šç¯å¢ƒé…ç½®` | `åŠŸèƒ½å…¨é¢ï¼Œå¼€ç®±å³ç”¨` | `ç›¸å¯¹é‡å‹` | â­â­â­â­ |

### 9.2 æ¨èçš„å·¥å…·ç»„åˆ


**å°å‹é¡¹ç›®ï¼ˆ1-3äººå›¢é˜Ÿï¼‰**ï¼š
```python
# å·¥å…·ç»„åˆï¼špython-dotenv + PyYAML + åŸºç¡€éªŒè¯
from dotenv import load_dotenv
import yaml
import os

load_dotenv()

class SimpleConfig:
    def __init__(self):
        with open('config.yaml') as f:
            self.config = yaml.safe_load(f)
        
        # ä»ç¯å¢ƒå˜é‡è¦†ç›–
        self.config['database']['password'] = os.getenv('DB_PASSWORD')
        self.config['app']['secret_key'] = os.getenv('SECRET_KEY')
```

**ä¸­å‹é¡¹ç›®ï¼ˆ3-10äººå›¢é˜Ÿï¼‰**ï¼š
```python
# å·¥å…·ç»„åˆï¼šPydantic + python-dotenv + è‡ªå®šä¹‰é…ç½®ç®¡ç†å™¨
from pydantic import BaseSettings
from dotenv import load_dotenv

load_dotenv()

class Settings(BaseSettings):
    app_name: str = "MyApp"
    debug: bool = False
    database_url: str
    secret_key: str
    
    class Config:
        env_file = ".env"
        env_file_encoding = 'utf-8'

settings = Settings()
```

**å¤§å‹é¡¹ç›®ï¼ˆ10+äººå›¢é˜Ÿï¼‰**ï¼š
```python
# å·¥å…·ç»„åˆï¼šDynaconf + é…ç½®ä¸­å¿ƒ + åŠ¨æ€åŠ è½½
from dynaconf import Dynaconf

settings = Dynaconf(
    envvar_prefix="MYAPP",
    settings_files=['settings.yaml', '.secrets.yaml'],
    environments=True,
    load_dotenv=True,
    redis_enabled=True,
    redis={'host': 'localhost', 'port': 6379, 'db': 0}
)
```

### 9.3 Dynaconfè¯¦ç»†ä½¿ç”¨


**å®‰è£…å’ŒåŸºç¡€é…ç½®**ï¼š
```bash
pip install dynaconf
```

```python
# settings.py
from dynaconf import Dynaconf

settings = Dynaconf(
    # é…ç½®æ–‡ä»¶
    settings_files=['settings.yaml'],
    
    # ç¯å¢ƒå˜é‡å‰ç¼€
    envvar_prefix="MYAPP",
    
    # æ”¯æŒå¤šç¯å¢ƒ
    environments=True,
    
    # è‡ªåŠ¨åŠ è½½.envæ–‡ä»¶
    load_dotenv=True,
    
    # æ”¯æŒé…ç½®éªŒè¯
    validators=[
        # éªŒè¯å¿…éœ€çš„é…ç½®é¡¹
        Validator('DATABASE_HOST', must_exist=True),
        Validator('SECRET_KEY', must_exist=True, len_min=32),
        Validator('DEBUG', is_type_of=bool),
    ]
)
```

```yaml
# settings.yaml
default:
  app_name: "MyApp"
  debug: false
  
development:
  debug: true
  database:
    host: localhost
    port: 5432
    
production:
  debug: false
  database:
    host: prod-db.example.com
    port: 5432
    
testing:
  database:
    host: test-db
    port: 5432
```

**ä½¿ç”¨Dynaconfçš„é«˜çº§ç‰¹æ€§**ï¼š
```python
# åœ¨ä»£ç ä¸­ä½¿ç”¨
from settings import settings

# åŸºç¡€ä½¿ç”¨
app_name = settings.APP_NAME
debug_mode = settings.DEBUG

# åµŒå¥—é…ç½®
db_host = settings.DATABASE.HOST
db_port = settings.DATABASE.PORT

# åŠ¨æ€åˆ‡æ¢ç¯å¢ƒ
settings.configure(ENV_FOR_DYNACONF='production')

# è¿è¡Œæ—¶ä¿®æ”¹é…ç½®
settings.set('DEBUG', False)

# é…ç½®éªŒè¯
settings.validators.validate()

# å¯¼å‡ºé…ç½®
print(settings.as_dict())
```

### 9.4 é…ç½®å·¥å…·é€‰æ‹©å»ºè®®


**é€‰æ‹©æ ‡å‡†**ï¼š

```
é¡¹ç›®è§„æ¨¡è€ƒè™‘ï¼š
ğŸ”¸ ä¸ªäººé¡¹ç›® â†’ å†…ç½®æ–¹æ³• + .envæ–‡ä»¶
ğŸ”¸ å°å›¢é˜Ÿé¡¹ç›® â†’ python-dotenv + PyYAML
ğŸ”¸ ä¸­å‹é¡¹ç›® â†’ Pydantic + è‡ªå®šä¹‰ç®¡ç†å™¨
ğŸ”¸ å¤§å‹é¡¹ç›® â†’ Dynaconf + é…ç½®ä¸­å¿ƒ

æŠ€æœ¯è¦æ±‚è€ƒè™‘ï¼š
ğŸ”¸ éœ€è¦ç±»å‹éªŒè¯ â†’ Pydantic
ğŸ”¸ éœ€è¦å¤šç¯å¢ƒæ”¯æŒ â†’ Dynaconf
ğŸ”¸ éœ€è¦åŠ¨æ€é…ç½® â†’ Redis + è‡ªå®šä¹‰æ–¹æ¡ˆ
ğŸ”¸ è¿½æ±‚ç®€å• â†’ python-dotenv
ğŸ”¸ ä¼ä¸šçº§éœ€æ±‚ â†’ ä¸“ä¸šé…ç½®ä¸­å¿ƒ(Consulã€etcd)

å›¢é˜Ÿåä½œè€ƒè™‘ï¼š
ğŸ”¸ é…ç½®å…±äº« â†’ é…ç½®ä¸­å¿ƒæ–¹æ¡ˆ
ğŸ”¸ ç‰ˆæœ¬ç®¡ç† â†’ Git + é…ç½®æ–‡ä»¶
ğŸ”¸ æƒé™æ§åˆ¶ â†’ ä¸“ä¸šé…ç½®ç®¡ç†å¹³å°
ğŸ”¸ å®¡è®¡éœ€æ±‚ â†’ å¸¦æ—¥å¿—çš„é…ç½®ç³»ç»Ÿ
```

**å®é™…é¡¹ç›®å»ºè®®**ï¼š
```python
# æ¨èçš„æ¸è¿›å¼é…ç½®æ–¹æ¡ˆ

# é˜¶æ®µ1ï¼šé¡¹ç›®åˆæœŸ - ç®€å•æ–¹æ¡ˆ
# ä½¿ç”¨ python-dotenv + YAML
from dotenv import load_dotenv
import yaml
import os

load_dotenv()

with open('config.yaml') as f:
    config = yaml.safe_load(f)

# é˜¶æ®µ2ï¼šé¡¹ç›®æˆé•¿æœŸ - åŠ å…¥éªŒè¯
# ä½¿ç”¨ Pydantic å¢å¼ºç±»å‹å®‰å…¨
from pydantic import BaseSettings

class Settings(BaseSettings):
    database_url: str
    secret_key: str
    debug: bool = False
    
    class Config:
        env_file = ".env"

# é˜¶æ®µ3ï¼šé¡¹ç›®æˆç†ŸæœŸ - ä¸“ä¸šæ–¹æ¡ˆ  
# ä½¿ç”¨ Dynaconf æˆ–è‡ªå»ºé…ç½®ä¸­å¿ƒ
from dynaconf import Dynaconf

settings = Dynaconf(
    settings_files=['settings.yaml'],
    environments=True,
    load_dotenv=True
)
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 é…ç½®ç®¡ç†æ ¸å¿ƒæ¦‚å¿µå›é¡¾


**é…ç½®ç®¡ç†çš„æœ¬è´¨**ï¼š
```
ğŸ¯ æ ¸å¿ƒç›®æ ‡ï¼šè®©ç¨‹åºèƒ½å¤Ÿçµæ´»é€‚åº”ä¸åŒç¯å¢ƒå’Œéœ€æ±‚
ğŸ”§ å®ç°æ–¹å¼ï¼šå°†å˜åŒ–çš„å‚æ•°ä»ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥
ğŸ“‚ å­˜å‚¨å½¢å¼ï¼šé…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€é…ç½®ä¸­å¿ƒ
ğŸ”„ ç®¡ç†ç­–ç•¥ï¼šåˆ†å±‚æ¬¡ã€åˆ†ç¯å¢ƒã€åŠ¨æ€åŠ è½½
```

### 10.2 å¿…é¡»æŒæ¡çš„å…³é”®çŸ¥è¯†ç‚¹


**é…ç½®æ–‡ä»¶æ ¼å¼é€‰æ‹©**ï¼š
```
JSONï¼šç®€å•ç»“æ„ï¼ŒPythonåŸç”Ÿæ”¯æŒ
â€¢ é€‚åˆï¼šAPIé…ç½®ã€ç®€å•å‚æ•°
â€¢ æ³¨æ„ï¼šä¸æ”¯æŒæ³¨é‡Šï¼Œè¯­æ³•ä¸¥æ ¼

YAMLï¼šå¤æ‚é…ç½®ï¼Œäººç±»å‹å¥½
â€¢ é€‚åˆï¼šåº”ç”¨é…ç½®ã€å¤šç¯å¢ƒç®¡ç†  
â€¢ æ³¨æ„ï¼šç¼©è¿›æ•æ„Ÿï¼Œéœ€è¦PyYAMLåº“

INIï¼šä¼ ç»Ÿæ ¼å¼ï¼Œç®€å•æ˜“è¯»
â€¢ é€‚åˆï¼šç®€å•é…ç½®ã€ä¼ ç»Ÿåº”ç”¨
â€¢ æ³¨æ„ï¼šåŠŸèƒ½æœ‰é™ï¼Œéœ€è¦ç±»å‹è½¬æ¢
```

**ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ**ï¼š
```
âœ… æ­£ç¡®åšæ³•ï¼š
â€¢ æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’
â€¢ ä½¿ç”¨.envæ–‡ä»¶è¿›è¡Œæœ¬åœ°å¼€å‘
â€¢ ç¯å¢ƒå˜é‡å‘½åè¦æ¸…æ™°è§„èŒƒ
â€¢ æä¾›åˆç†çš„é»˜è®¤å€¼

âŒ é¿å…é—®é¢˜ï¼š
â€¢ ä¸è¦æŠŠ.envæ–‡ä»¶æäº¤åˆ°Git
â€¢ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
â€¢ ä¸è¦å¿½ç•¥ç¯å¢ƒå˜é‡çš„ç±»å‹è½¬æ¢
```

**é…ç½®å±‚æ¬¡ç®¡ç†**ï¼š
```
é…ç½®ä¼˜å…ˆçº§ï¼ˆä»ä½åˆ°é«˜ï¼‰ï¼š
é»˜è®¤é…ç½® < é…ç½®æ–‡ä»¶ < ç¯å¢ƒå˜é‡ < å‘½ä»¤è¡Œå‚æ•°

ç¯å¢ƒåˆ†ç±»ç®¡ç†ï¼š
base.yaml        # åŸºç¡€é…ç½®
development.yaml # å¼€å‘ç¯å¢ƒ
testing.yaml     # æµ‹è¯•ç¯å¢ƒ  
production.yaml  # ç”Ÿäº§ç¯å¢ƒ
local.yaml       # æœ¬åœ°é…ç½®ï¼ˆä¸æäº¤Gitï¼‰
```

### 10.3 æ•æ„Ÿä¿¡æ¯å¤„ç†è¦ç‚¹


**å®‰å…¨å­˜å‚¨ç­–ç•¥**ï¼š
```
ğŸ” å¯†é’¥ç®¡ç†å·¥å…·ï¼š
â€¢ keyringï¼šç³»ç»Ÿçº§å¯†é’¥å­˜å‚¨
â€¢ äº‘æœåŠ¡ï¼šAWS Secrets Managerã€Azure Key Vault
â€¢ é…ç½®ä¸­å¿ƒï¼šHashiCorp Vault

ğŸ›¡ï¸ å®‰å…¨åŸåˆ™ï¼š
â€¢ åˆ†ç¦»å­˜å‚¨ï¼šä»£ç å’Œå¯†é’¥åˆ†å¼€
â€¢ æœ€å°æƒé™ï¼šåªç»™å¿…è¦çš„è®¿é—®æƒé™
â€¢ å®šæœŸè½®æ¢ï¼šå®šæœŸæ›´æ¢å¯†é’¥
â€¢ å®¡è®¡æ—¥å¿—ï¼šè®°å½•å¯†é’¥è®¿é—®æ—¥å¿—
```

### 10.4 é…ç½®éªŒè¯é‡è¦æ€§


**ä¸ºä»€ä¹ˆè¦éªŒè¯é…ç½®**ï¼š
```
âš ï¸ æ²¡æœ‰éªŒè¯çš„é—®é¢˜ï¼š
â€¢ é…ç½®é”™è¯¯å¯¼è‡´ç¨‹åºå´©æºƒ
â€¢ ç±»å‹ä¸åŒ¹é…å¼•èµ·è¿è¡Œæ—¶é”™è¯¯
â€¢ ç¼ºå¤±å¿…è¦é…ç½®å½±å“åŠŸèƒ½

âœ… éªŒè¯çš„å¥½å¤„ï¼š
â€¢ å¯åŠ¨æ—¶å‘ç°é…ç½®é—®é¢˜
â€¢ æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
â€¢ è‡ªåŠ¨ç±»å‹è½¬æ¢å’ŒéªŒè¯
â€¢ ä¿è¯é…ç½®çš„å®Œæ•´æ€§
```

### 10.5 åŠ¨æ€é…ç½®åº”ç”¨åœºæ™¯


**é€‚åˆåŠ¨æ€é…ç½®çš„åœºæ™¯**ï¼š
```
ğŸ”„ åŠŸèƒ½å¼€å…³ï¼šå¿«é€Ÿå¼€å¯/å…³é—­åŠŸèƒ½
ğŸ“Š å‚æ•°è°ƒä¼˜ï¼šå®æ—¶è°ƒæ•´ç®—æ³•å‚æ•°
ğŸ¯ A/Bæµ‹è¯•ï¼šåŠ¨æ€åˆ‡æ¢æµ‹è¯•ç­–ç•¥
ğŸš¦ æµé‡æ§åˆ¶ï¼šåŠ¨æ€è°ƒæ•´é™æµå‚æ•°
ğŸ”§ æ—¥å¿—çº§åˆ«ï¼šè¿è¡Œæ—¶è°ƒæ•´æ—¥å¿—è¾“å‡º

å®ç°æ–¹æ¡ˆé€‰æ‹©ï¼š
â€¢ æ–‡ä»¶ç›‘æ§ï¼šé€‚åˆå•æœºåº”ç”¨
â€¢ Rediså‘å¸ƒè®¢é˜…ï¼šé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿ
â€¢ é…ç½®ä¸­å¿ƒï¼šé€‚åˆå¤§å‹ä¼ä¸šåº”ç”¨
```

### 10.6 é¡¹ç›®å®è·µå»ºè®®


**é…ç½®ç®¡ç†çš„æ¼”è¿›è·¯å¾„**ï¼š
```
ç¬¬ä¸€é˜¶æ®µï¼šèµ·æ­¥æœŸ
â”œâ”€â”€ ä½¿ç”¨.envæ–‡ä»¶ç®¡ç†ç¯å¢ƒå˜é‡
â”œâ”€â”€ ç®€å•çš„YAMLé…ç½®æ–‡ä»¶
â””â”€â”€ åŸºç¡€çš„é…ç½®éªŒè¯

ç¬¬äºŒé˜¶æ®µï¼šæˆé•¿æœŸ  
â”œâ”€â”€ å¤šç¯å¢ƒé…ç½®åˆ†ç¦»
â”œâ”€â”€ ä½¿ç”¨Pydanticè¿›è¡Œç±»å‹éªŒè¯
â”œâ”€â”€ æ·»åŠ é…ç½®çƒ­é‡è½½åŠŸèƒ½
â””â”€â”€ å»ºç«‹é…ç½®æ–‡æ¡£å’Œè§„èŒƒ

ç¬¬ä¸‰é˜¶æ®µï¼šæˆç†ŸæœŸ
â”œâ”€â”€ å¼•å…¥ä¸“ä¸šé…ç½®ç®¡ç†å·¥å…·
â”œâ”€â”€ å»ºè®¾é…ç½®ä¸­å¿ƒ
â”œâ”€â”€ å®ç°é…ç½®çš„ç‰ˆæœ¬ç®¡ç†
â””â”€â”€ æ·»åŠ é…ç½®å˜æ›´å®¡è®¡
```

### 10.7 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**é—®é¢˜1ï¼šé…ç½®æ–‡ä»¶å¤ªå¤šï¼Œç®¡ç†æ··ä¹±**
```
è§£å†³æ–¹æ¡ˆï¼š
â€¢ å»ºç«‹ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶å‘½åè§„èŒƒ
â€¢ ä½¿ç”¨é…ç½®ç®¡ç†å™¨ç»Ÿä¸€åŠ è½½
â€¢ åˆ›å»ºé…ç½®æ–‡æ¡£å’Œç¤ºä¾‹æ¨¡æ¿
```

**é—®é¢˜2ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©**
```
è§£å†³æ–¹æ¡ˆï¼š
â€¢ ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
â€¢ å»ºç«‹.gitignoreè§„åˆ™
â€¢ ä½¿ç”¨ä¸“ä¸šçš„å¯†é’¥ç®¡ç†å·¥å…·
â€¢ å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡
```

**é—®é¢˜3ï¼šå¤šç¯å¢ƒé…ç½®åŒæ­¥å›°éš¾**
```
è§£å†³æ–¹æ¡ˆï¼š
â€¢ ä½¿ç”¨é…ç½®æ¨¡æ¿å’Œç»§æ‰¿æœºåˆ¶
â€¢ å»ºç«‹é…ç½®å˜æ›´çš„æ ‡å‡†æµç¨‹
â€¢ ä½¿ç”¨é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†
â€¢ è‡ªåŠ¨åŒ–é…ç½®éƒ¨ç½²å’ŒéªŒè¯
```

### 10.8 å­¦ä¹ å»ºè®®å’Œè¿›é˜¶æ–¹å‘


**å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
```
ğŸ¯ åŸºç¡€é˜¶æ®µï¼š
1. æŒæ¡JSONã€YAMLã€INIæ ¼å¼çš„è¯»å†™
2. å­¦ä¼šä½¿ç”¨python-dotenvç®¡ç†ç¯å¢ƒå˜é‡
3. ç†è§£é…ç½®åˆ†å±‚å’Œä¼˜å…ˆçº§æ¦‚å¿µ

ğŸš€ è¿›é˜¶é˜¶æ®µï¼š
1. å­¦ä¹ Pydanticè¿›è¡Œé…ç½®éªŒè¯
2. å®ç°åŠ¨æ€é…ç½®åŠ è½½æœºåˆ¶
3. æŒæ¡æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨å¤„ç†

ğŸ† é«˜çº§é˜¶æ®µï¼š
1. è®¾è®¡åˆ†å¸ƒå¼é…ç½®ç®¡ç†æ–¹æ¡ˆ
2. å­¦ä¹ ä¸“ä¸šé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨
3. å»ºç«‹é…ç½®ç®¡ç†çš„æœ€ä½³å®è·µ
```

**å®è·µé¡¹ç›®å»ºè®®**ï¼š
```
ğŸ’¡ ç»ƒä¹ é¡¹ç›®ï¼š
â€¢ åˆ›å»ºä¸€ä¸ªå¤šç¯å¢ƒçš„Webåº”ç”¨é…ç½®
â€¢ å®ç°é…ç½®çƒ­é‡è½½çš„å°å·¥å…·
â€¢ æ­å»ºç®€å•çš„é…ç½®ç®¡ç†ä¸­å¿ƒ
â€¢ è®¾è®¡é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†æœºåˆ¶
```

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
é…ç½®ç®¡ç†å¾ˆé‡è¦ï¼Œåˆ†ç¦»ä»£ç æ˜¯ç‹é“
æ–‡ä»¶æ ¼å¼è¦é€‰å¥½ï¼ŒJSONã€YAMLå„æœ‰å·§
ç¯å¢ƒå˜é‡ä¿å®‰å…¨ï¼Œæ•æ„Ÿä¿¡æ¯ä¸æš´éœ²
åˆ†å±‚ç®¡ç†æœ‰å±‚æ¬¡ï¼ŒéªŒè¯é…ç½®ä¿æ­£ç¡®
åŠ¨æ€åŠ è½½å¾ˆçµæ´»ï¼Œå·¥å…·é€‰æ‹©çœ‹éœ€è¦
```

**æ€»ç»“**ï¼šé…ç½®ç®¡ç†æ˜¯Pythoné¡¹ç›®å·¥ç¨‹åŒ–çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä»ç®€å•çš„é…ç½®æ–‡ä»¶åˆ°å¤æ‚çš„é…ç½®ä¸­å¿ƒï¼Œå…³é”®æ˜¯è¦æ ¹æ®é¡¹ç›®è§„æ¨¡å’Œå›¢é˜Ÿéœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚è®°ä½é…ç½®ç®¡ç†çš„æ ¸å¿ƒåŸåˆ™ï¼šç®€å•ã€å®‰å…¨ã€çµæ´»ã€å¯ç»´æŠ¤ï¼Œé€æ­¥æ¼”è¿›ï¼Œä¸è¦ä¸€å¼€å§‹å°±è¿½æ±‚å®Œç¾çš„æ–¹æ¡ˆã€‚