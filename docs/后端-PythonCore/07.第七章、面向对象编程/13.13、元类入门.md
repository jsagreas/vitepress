---
title: 13ã€å…ƒç±»å…¥é—¨
---
## ğŸ“š ç›®å½•

1. [å…ƒç±»æ¦‚å¿µä¸åŸç†](#1-å…ƒç±»æ¦‚å¿µä¸åŸç†)
2. [type()åŠ¨æ€åˆ›å»ºç±»](#2-typeåŠ¨æ€åˆ›å»ºç±»)
3. [__metaclass__å±æ€§](#3-__metaclass__å±æ€§)
4. [å…ƒç±»è°ƒç”¨è¿‡ç¨‹](#4-å…ƒç±»è°ƒç”¨è¿‡ç¨‹)
5. [å…ƒç±»åº”ç”¨åœºæ™¯](#5-å…ƒç±»åº”ç”¨åœºæ™¯)
6. [å…ƒç±»è®¾è®¡æ¨¡å¼](#6-å…ƒç±»è®¾è®¡æ¨¡å¼)
7. [å…ƒç±»è°ƒè¯•æŠ€å·§](#7-å…ƒç±»è°ƒè¯•æŠ€å·§)
8. [å…ƒç±»æœ€ä½³å®è·µ](#8-å…ƒç±»æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å…ƒç±»æ¦‚å¿µä¸åŸç†


### 1.1 ä»€ä¹ˆæ˜¯å…ƒç±»


**ç®€å•ç†è§£**ï¼šå…ƒç±»å°±æ˜¯"åˆ›å»ºç±»çš„ç±»"ï¼Œå°±åƒç±»æ˜¯åˆ›å»ºå¯¹è±¡çš„æ¨¡æ¿ä¸€æ ·ï¼Œå…ƒç±»æ˜¯åˆ›å»ºç±»çš„æ¨¡æ¿ã€‚

```
ç°å®ä¸–ç•Œç±»æ¯”ï¼š
å·¥å‚æ¨¡å…· â†’ äº§å“      ç±» â†’ å¯¹è±¡å®ä¾‹
æ¨¡å…·å·¥å‚ â†’ å·¥å‚æ¨¡å…·  å…ƒç±» â†’ ç±»

æ¢ä¸ªè§’åº¦ç†è§£ï¼š
å¯¹è±¡ = ç±»()        # ç±»åˆ›å»ºå¯¹è±¡
ç±» = å…ƒç±»()        # å…ƒç±»åˆ›å»ºç±»
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
- **å¯¹è±¡**ï¼šå…·ä½“çš„æ•°æ®å®ä¾‹
- **ç±»**ï¼šåˆ›å»ºå¯¹è±¡çš„æ¨¡æ¿å’Œè“å›¾
- **å…ƒç±»**ï¼šåˆ›å»ºç±»çš„æ¨¡æ¿å’Œè“å›¾

### 1.2 Pythonä¸­"ä¸€åˆ‡çš†å¯¹è±¡"çš„æ·±å±‚å«ä¹‰


**ğŸ“‹ å±‚æ¬¡å…³ç³»**
```
äºº = Person()         # äººæ˜¯Personç±»çš„å®ä¾‹
Person = type()       # Personç±»ä¹Ÿæ˜¯typeçš„å®ä¾‹  
type = type()         # typeæ˜¯å®ƒè‡ªå·±çš„å®ä¾‹
```

**ğŸ” éªŒè¯è¿™ä¸ªå…³ç³»**
```python
class Person:
    pass

# æŸ¥çœ‹å¯¹è±¡çš„ç±»å‹
person = Person()
print(type(person))        # <class '__main__.Person'>
print(type(Person))        # <class 'type'>
print(type(type))          # <class 'type'>

# Personç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼
print(isinstance(Person, object))  # True
print(isinstance(Person, type))    # True
```

### 1.3 å…ƒç±»çš„å·¥ä½œåŸç†


**ğŸ”§ åˆ›å»ºè¿‡ç¨‹ç¤ºæ„**
```
å®šä¹‰ç±»çš„ä»£ç ï¼š                å…ƒç±»å¤„ç†è¿‡ç¨‹ï¼š
class MyClass:               
    name = "test"     â†’      å…ƒç±»æ¥æ”¶ç±»å®šä¹‰ä¿¡æ¯
    def hello(self):         å…ƒç±»æŒ‰ç…§è§„åˆ™åˆ›å»ºç±»å¯¹è±¡
        return "hi"          è¿”å›åˆ›å»ºå¥½çš„ç±»
```

**ğŸ’¡ å…³é”®ç†è§£**
- å½“ä½ å†™`class MyClass:`æ—¶ï¼ŒPythonå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨å…ƒç±»æ¥åˆ›å»ºè¿™ä¸ªç±»
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒPythonä½¿ç”¨å†…ç½®çš„`type`ä½œä¸ºå…ƒç±»
- ä½ å¯ä»¥è‡ªå®šä¹‰å…ƒç±»æ¥æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹

---

## 2. ğŸ—ï¸ type()åŠ¨æ€åˆ›å»ºç±»


### 2.1 type()çš„åŒé‡èº«ä»½


**ğŸ”¸ èº«ä»½1ï¼šæŸ¥çœ‹å¯¹è±¡ç±»å‹**
```python
# æˆ‘ä»¬ç†Ÿæ‚‰çš„ç”¨æ³•
print(type(42))        # <class 'int'>
print(type("hello"))   # <class 'str'>
print(type([1,2,3]))   # <class 'list'>
```

**ğŸ”¸ èº«ä»½2ï¼šåŠ¨æ€åˆ›å»ºç±»**
```python
# typeçš„åˆ›å»ºç±»è¯­æ³•
# type(ç±»å, çˆ¶ç±»å…ƒç»„, å±æ€§å­—å…¸)
MyClass = type('MyClass', (), {})
print(MyClass)         # <class '__main__.MyClass'>
print(type(MyClass))   # <class 'type'>
```

### 2.2 ç”¨type()åˆ›å»ºç®€å•ç±»


**ğŸ“ åŸºç¡€ç¤ºä¾‹**
```python
# ä¼ ç»Ÿæ–¹å¼å®šä¹‰ç±»
class Person:
    species = "human"
    
    def say_hello(self):
        return "Hello!"

# ç”¨type()åŠ¨æ€åˆ›å»ºç›¸åŒçš„ç±»
def say_hello(self):
    return "Hello!"

# type(ç±»å, çˆ¶ç±»å…ƒç»„, å±æ€§å­—å…¸)
PersonDynamic = type(
    'PersonDynamic',           # ç±»å
    (),                        # çˆ¶ç±»å…ƒç»„ï¼ˆç©ºè¡¨ç¤ºç»§æ‰¿objectï¼‰
    {
        'species': 'human',    # ç±»å±æ€§
        'say_hello': say_hello # æ–¹æ³•
    }
)

# ä½¿ç”¨åŠ¨æ€åˆ›å»ºçš„ç±»
person = PersonDynamic()
print(person.species)      # human
print(person.say_hello())  # Hello!
```

### 2.3 type()åˆ›å»ºå¸¦ç»§æ‰¿çš„ç±»


**ğŸ”— ç»§æ‰¿å…³ç³»ç¤ºä¾‹**
```python
# çˆ¶ç±»
class Animal:
    def breathe(self):
        return "breathing"

# ç”¨type()åˆ›å»ºå­ç±»
def bark(self):
    return "woof!"

Dog = type(
    'Dog',
    (Animal,),              # ç»§æ‰¿Animalç±»
    {
        'species': 'canine',
        'bark': bark
    }
)

# æµ‹è¯•ç»§æ‰¿å…³ç³»
dog = Dog()
print(dog.breathe())       # breathing (ç»§æ‰¿è‡ªAnimal)
print(dog.bark())          # woof! (è‡ªå·±çš„æ–¹æ³•)
print(dog.species)         # canine (è‡ªå·±çš„å±æ€§)
```

### 2.4 åŠ¨æ€åˆ›å»ºç±»çš„å®é™…åº”ç”¨


**ğŸ¯ æ ¹æ®é…ç½®åˆ›å»ºç±»**
```python
def create_model_class(class_name, fields):
    """æ ¹æ®å­—æ®µé…ç½®åŠ¨æ€åˆ›å»ºæ¨¡å‹ç±»"""
    
    def __init__(self, **kwargs):
        for field in fields:
            setattr(self, field, kwargs.get(field))
    
    def __str__(self):
        field_strs = [f"{field}={getattr(self, field, None)}" 
                     for field in fields]
        return f"{class_name}({', '.join(field_strs)})"
    
    # åŠ¨æ€åˆ›å»ºç±»
    return type(class_name, (), {
        'fields': fields,
        '__init__': __init__,
        '__str__': __str__
    })

# ä½¿ç”¨é…ç½®åˆ›å»ºä¸åŒçš„ç±»
User = create_model_class('User', ['name', 'email', 'age'])
Product = create_model_class('Product', ['title', 'price', 'category'])

# æµ‹è¯•åŠ¨æ€åˆ›å»ºçš„ç±»
user = User(name="å¼ ä¸‰", email="zhang@example.com", age=25)
print(user)  # User(name=å¼ ä¸‰, email=zhang@example.com, age=25)
```

---

## 3. ğŸ”§ __metaclass__å±æ€§


### 3.1 ä»€ä¹ˆæ˜¯__metaclass__å±æ€§


**ğŸ“‹ åŸºæœ¬æ¦‚å¿µ**
- `__metaclass__`æ˜¯ç”¨æ¥æŒ‡å®šåˆ›å»ºç±»æ—¶ä½¿ç”¨å“ªä¸ªå…ƒç±»çš„å±æ€§
- Python 2ä¸­åœ¨ç±»å†…éƒ¨å®šä¹‰ï¼ŒPython 3ä¸­ä½œä¸ºå‚æ•°ä¼ é€’
- å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨`type`ä½œä¸ºå…ƒç±»

**ğŸ”„ Pythonç‰ˆæœ¬å·®å¼‚**
```python
# Python 2 å†™æ³•ï¼ˆäº†è§£å³å¯ï¼‰
class MyClass:
    __metaclass__ = MyMetaClass

# Python 3 å†™æ³•ï¼ˆæ¨èï¼‰
class MyClass(metaclass=MyMetaClass):
    pass
```

### 3.2 è‡ªå®šä¹‰å…ƒç±»çš„åŸºæœ¬ç»“æ„


**ğŸ—ï¸ å…ƒç±»å®šä¹‰æ¨¡æ¿**
```python
class MyMetaClass(type):
    """è‡ªå®šä¹‰å…ƒç±»"""
    
    def __new__(cls, name, bases, attrs):
        """åˆ›å»ºç±»çš„æ—¶å€™è°ƒç”¨"""
        print(f"æ­£åœ¨åˆ›å»ºç±»: {name}")
        
        # å¯ä»¥ä¿®æ”¹ç±»çš„å±æ€§
        attrs['created_by'] = 'MyMetaClass'
        
        # è°ƒç”¨çˆ¶ç±»æ–¹æ³•åˆ›å»ºç±»
        return super().__new__(cls, name, bases, attrs)
    
    def __init__(cls, name, bases, attrs):
        """ç±»åˆ›å»ºå®Œæˆåè°ƒç”¨"""
        print(f"ç±» {name} åˆ›å»ºå®Œæˆ")
        super().__init__(name, bases, attrs)

# ä½¿ç”¨è‡ªå®šä¹‰å…ƒç±»
class TestClass(metaclass=MyMetaClass):
    value = 42

# è¾“å‡ºï¼š
# æ­£åœ¨åˆ›å»ºç±»: TestClass
# ç±» TestClass åˆ›å»ºå®Œæˆ

print(TestClass.created_by)  # MyMetaClass
```

### 3.3 å…ƒç±»æ–¹æ³•è¯¦è§£


**ğŸ” __new__ vs __init__**

| æ–¹æ³• | **è°ƒç”¨æ—¶æœº** | **ä½œç”¨** | **è¿”å›å€¼** |
|------|-------------|----------|-----------|
| `__new__` | ç±»åˆ›å»ºæ—¶ | æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹ | ç±»å¯¹è±¡ |
| `__init__` | ç±»åˆ›å»ºå | åˆå§‹åŒ–ç±»å¯¹è±¡ | None |

**ğŸ’¡ è¯¦ç»†ç¤ºä¾‹**
```python
class VerboseMetaClass(type):
    def __new__(cls, name, bases, attrs):
        print(f"__new__ è¢«è°ƒç”¨")
        print(f"  ç±»å: {name}")
        print(f"  çˆ¶ç±»: {bases}")
        print(f"  å±æ€§: {list(attrs.keys())}")
        
        # åœ¨è¿™é‡Œå¯ä»¥ä¿®æ”¹ç±»çš„å®šä¹‰
        if 'magic_method' not in attrs:
            attrs['magic_method'] = lambda self: f"æˆ‘æ˜¯{name}çš„å®ä¾‹"
        
        # åˆ›å»ºå¹¶è¿”å›ç±»å¯¹è±¡
        new_class = super().__new__(cls, name, bases, attrs)
        print(f"  åˆ›å»ºçš„ç±»: {new_class}")
        return new_class
    
    def __init__(cls, name, bases, attrs):
        print(f"__init__ è¢«è°ƒç”¨ï¼Œç±» {name} åˆå§‹åŒ–å®Œæˆ")
        super().__init__(name, bases, attrs)

class MyClass(metaclass=VerboseMetaClass):
    attr1 = "value1"
    
    def method1(self):
        return "method1"

# æµ‹è¯•è‡ªåŠ¨æ·»åŠ çš„æ–¹æ³•
obj = MyClass()
print(obj.magic_method())  # æˆ‘æ˜¯MyClassçš„å®ä¾‹
```

---

## 4. âš¡ å…ƒç±»è°ƒç”¨è¿‡ç¨‹


### 4.1 å®Œæ•´çš„ç±»åˆ›å»ºæµç¨‹


**ğŸ”„ ç±»åˆ›å»ºçš„è¯¦ç»†æ­¥éª¤**
```
æ­¥éª¤1: Pythonè§£æclassè¯­å¥
     â†“
æ­¥éª¤2: æ”¶é›†ç±»åã€çˆ¶ç±»ã€å±æ€§å­—å…¸
     â†“  
æ­¥éª¤3: æŸ¥æ‰¾åˆé€‚çš„å…ƒç±»
     â†“
æ­¥éª¤4: è°ƒç”¨å…ƒç±»çš„__new__æ–¹æ³•
     â†“
æ­¥éª¤5: è°ƒç”¨å…ƒç±»çš„__init__æ–¹æ³•
     â†“
æ­¥éª¤6: è¿”å›åˆ›å»ºå¥½çš„ç±»å¯¹è±¡
```

### 4.2 å…ƒç±»æŸ¥æ‰¾é¡ºåº


**ğŸ” Pythonå¦‚ä½•ç¡®å®šä½¿ç”¨å“ªä¸ªå…ƒç±»**
```
1. æ£€æŸ¥classè¯­å¥ä¸­æ˜¯å¦æŒ‡å®šäº†metaclasså‚æ•°
   class MyClass(metaclass=SomeMetaClass): pass
   
2. æ£€æŸ¥çˆ¶ç±»æ˜¯å¦æœ‰å…ƒç±»
   å¦‚æœç»§æ‰¿çš„çˆ¶ç±»æœ‰è‡ªå®šä¹‰å…ƒç±»ï¼Œåˆ™ä½¿ç”¨çˆ¶ç±»çš„å…ƒç±»
   
3. æ£€æŸ¥æ¨¡å—çº§åˆ«çš„__metaclass__å˜é‡ï¼ˆPython 2ï¼‰
   
4. æœ€åä½¿ç”¨é»˜è®¤çš„typeä½œä¸ºå…ƒç±»
```

**ğŸ“ å…ƒç±»æŸ¥æ‰¾ç¤ºä¾‹**
```python
class MetaA(type):
    def __new__(cls, name, bases, attrs):
        attrs['from_meta'] = 'MetaA'
        return super().__new__(cls, name, bases, attrs)

class MetaB(type):
    def __new__(cls, name, bases, attrs):
        attrs['from_meta'] = 'MetaB'
        return super().__new__(cls, name, bases, attrs)

# çˆ¶ç±»ä½¿ç”¨MetaA
class Parent(metaclass=MetaA):
    pass

# å­ç±»ä¼šç»§æ‰¿çˆ¶ç±»çš„å…ƒç±»
class Child(Parent):
    pass

# å­ç±»æ˜¾å¼æŒ‡å®šå…ƒç±»ä¼šè¦†ç›–ç»§æ‰¿çš„å…ƒç±»
class GrandChild(Parent, metaclass=MetaB):
    pass

print(Parent.from_meta)     # MetaA
print(Child.from_meta)      # MetaA (ç»§æ‰¿)
print(GrandChild.from_meta) # MetaB (æ˜¾å¼æŒ‡å®š)
```

### 4.3 å®ä¾‹åˆ›å»ºä¸ç±»åˆ›å»ºçš„åŒºåˆ«


**ğŸ”„ å¯¹æ¯”æµç¨‹å›¾**
```
å®ä¾‹åˆ›å»ºæµç¨‹:              ç±»åˆ›å»ºæµç¨‹:
MyClass()                 class MyClass(metaclass=Meta):
    â†“                         â†“
MyClass.__new__()             Meta.__new__()
    â†“                         â†“  
MyClass.__init__()            Meta.__init__()
    â†“                         â†“
è¿”å›å®ä¾‹å¯¹è±¡                   è¿”å›ç±»å¯¹è±¡
```

**ğŸ’¡ è®°å¿†æŠ€å·§**
- å®ä¾‹åˆ›å»ºï¼šç±»è´Ÿè´£åˆ›å»ºå®ä¾‹
- ç±»åˆ›å»ºï¼šå…ƒç±»è´Ÿè´£åˆ›å»ºç±»
- éƒ½éµå¾ªç›¸åŒçš„`__new__` + `__init__`æ¨¡å¼

---

## 5. ğŸ¯ å…ƒç±»åº”ç”¨åœºæ™¯


### 5.1 è‡ªåŠ¨æ³¨å†Œæœºåˆ¶


**ğŸ”§ æ’ä»¶ç³»ç»Ÿç¤ºä¾‹**
```python
class PluginRegistry(type):
    """æ’ä»¶æ³¨å†Œå…ƒç±»"""
    plugins = {}
    
    def __new__(cls, name, bases, attrs):
        new_class = super().__new__(cls, name, bases, attrs)
        
        # è‡ªåŠ¨æ³¨å†Œæ’ä»¶
        if name != 'BasePlugin':  # è·³è¿‡åŸºç±»
            cls.plugins[name] = new_class
            print(f"æ’ä»¶ {name} å·²æ³¨å†Œ")
        
        return new_class

class BasePlugin(metaclass=PluginRegistry):
    """æ’ä»¶åŸºç±»"""
    def execute(self):
        raise NotImplementedError

class EmailPlugin(BasePlugin):
    def execute(self):
        return "å‘é€é‚®ä»¶"

class SMSPlugin(BasePlugin):
    def execute(self):
        return "å‘é€çŸ­ä¿¡"

# æŸ¥çœ‹å·²æ³¨å†Œçš„æ’ä»¶
print("å·²æ³¨å†Œæ’ä»¶:", list(PluginRegistry.plugins.keys()))
# è¾“å‡º: å·²æ³¨å†Œæ’ä»¶: ['EmailPlugin', 'SMSPlugin']

# åŠ¨æ€è°ƒç”¨æ’ä»¶
for plugin_name, plugin_class in PluginRegistry.plugins.items():
    plugin = plugin_class()
    print(f"{plugin_name}: {plugin.execute()}")
```

### 5.2 å±æ€§éªŒè¯å’Œè½¬æ¢


**âœ… è‡ªåŠ¨å±æ€§æ£€æŸ¥**
```python
class ValidatedMeta(type):
    """å±æ€§éªŒè¯å…ƒç±»"""
    
    def __new__(cls, name, bases, attrs):
        # ä¸ºæ‰€æœ‰å±æ€§æ·»åŠ ç±»å‹æ£€æŸ¥
        validated_attrs = {}
        
        for key, value in attrs.items():
            if not key.startswith('_') and hasattr(value, '__annotations__'):
                # å¦‚æœæœ‰ç±»å‹æ³¨è§£ï¼Œæ·»åŠ éªŒè¯
                validated_attrs[key] = cls._create_validated_property(key, value)
            else:
                validated_attrs[key] = value
        
        return super().__new__(cls, name, bases, validated_attrs)
    
    @staticmethod
    def _create_validated_property(name, func):
        def wrapper(self, *args, **kwargs):
            # è¿™é‡Œå¯ä»¥æ·»åŠ éªŒè¯é€»è¾‘
            return func(self, *args, **kwargs)
        return wrapper

class Person(metaclass=ValidatedMeta):
    def __init__(self, name: str, age: int):
        self.name = name
        self.age = age
    
    def set_age(self, age: int):
        if age < 0:
            raise ValueError("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
        self.age = age
```

### 5.3 ORMæ˜ å°„ç³»ç»Ÿ


**ğŸ—„ï¸ ç®€åŒ–çš„ORMç¤ºä¾‹**
```python
class ModelMeta(type):
    """ORMæ¨¡å‹å…ƒç±»"""
    
    def __new__(cls, name, bases, attrs):
        # æ”¶é›†å­—æ®µå®šä¹‰
        fields = {}
        for key, value in attrs.items():
            if isinstance(value, Field):
                fields[key] = value
                value.name = key
        
        # å­˜å‚¨å­—æ®µä¿¡æ¯
        attrs['_fields'] = fields
        attrs['_table_name'] = name.lower()
        
        return super().__new__(cls, name, bases, attrs)

class Field:
    """å­—æ®µåŸºç±»"""
    def __init__(self, field_type, default=None):
        self.field_type = field_type
        self.default = default
        self.name = None

class Model(metaclass=ModelMeta):
    """æ¨¡å‹åŸºç±»"""
    
    def __init__(self, **kwargs):
        for field_name, field in self._fields.items():
            value = kwargs.get(field_name, field.default)
            setattr(self, field_name, value)
    
    def save(self):
        print(f"ä¿å­˜åˆ°è¡¨: {self._table_name}")
        for field_name in self._fields:
            value = getattr(self, field_name)
            print(f"  {field_name}: {value}")

# ä½¿ç”¨ORMå®šä¹‰æ¨¡å‹
class User(Model):
    name = Field(str, "")
    age = Field(int, 0)
    email = Field(str, "")

# ä½¿ç”¨æ¨¡å‹
user = User(name="å¼ ä¸‰", age=25, email="zhang@example.com")
user.save()
# è¾“å‡º:
# ä¿å­˜åˆ°è¡¨: user
#   name: å¼ ä¸‰
#   age: 25
#   email: zhang@example.com
```

---

## 6. ğŸ›ï¸ å…ƒç±»è®¾è®¡æ¨¡å¼


### 6.1 å•ä¾‹æ¨¡å¼


**ğŸ”’ å…ƒç±»å®ç°å•ä¾‹**
```python
class SingletonMeta(type):
    """å•ä¾‹å…ƒç±»"""
    _instances = {}
    
    def __call__(cls, *args, **kwargs):
        if cls not in cls._instances:
            cls._instances[cls] = super().__call__(*args, **kwargs)
        return cls._instances[cls]

class DatabaseConnection(metaclass=SingletonMeta):
    def __init__(self):
        self.connected = True
        print("åˆ›å»ºæ•°æ®åº“è¿æ¥")
    
    def query(self, sql):
        return f"æ‰§è¡ŒæŸ¥è¯¢: {sql}"

# æµ‹è¯•å•ä¾‹æ¨¡å¼
db1 = DatabaseConnection()  # åˆ›å»ºæ•°æ®åº“è¿æ¥
db2 = DatabaseConnection()  # ä¸ä¼šé‡æ–°åˆ›å»º

print(db1 is db2)  # Trueï¼Œæ˜¯åŒä¸€ä¸ªå¯¹è±¡
```

### 6.2 æŠ½è±¡åŸºç±»æ¨¡å¼


**ğŸ¨ å¼ºåˆ¶å®ç°æ¥å£**
```python
class AbstractMeta(type):
    """æŠ½è±¡ç±»å…ƒç±»"""
    
    def __new__(cls, name, bases, attrs):
        # æ”¶é›†æŠ½è±¡æ–¹æ³•
        abstract_methods = set()
        
        for base in bases:
            if hasattr(base, '__abstract_methods__'):
                abstract_methods.update(base.__abstract_methods__)
        
        for key, value in attrs.items():
            if getattr(value, '__is_abstract__', False):
                abstract_methods.add(key)
            elif key in abstract_methods:
                abstract_methods.remove(key)
        
        attrs['__abstract_methods__'] = abstract_methods
        new_class = super().__new__(cls, name, bases, attrs)
        
        return new_class
    
    def __call__(cls, *args, **kwargs):
        if cls.__abstract_methods__:
            raise TypeError(f"ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±» {cls.__name__}ï¼Œ"
                          f"æœªå®ç°æ–¹æ³•: {cls.__abstract_methods__}")
        return super().__call__(*args, **kwargs)

def abstract_method(func):
    """æŠ½è±¡æ–¹æ³•è£…é¥°å™¨"""
    func.__is_abstract__ = True
    return func

class Shape(metaclass=AbstractMeta):
    @abstract_method
    def area(self):
        pass
    
    @abstract_method
    def perimeter(self):
        pass

class Circle(Shape):
    def __init__(self, radius):
        self.radius = radius
    
    def area(self):
        return 3.14 * self.radius ** 2
    
    def perimeter(self):
        return 2 * 3.14 * self.radius

# æµ‹è¯•æŠ½è±¡ç±»
# shape = Shape()  # é”™è¯¯ï¼šä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±»
circle = Circle(5)   # æ­£ç¡®ï¼šå®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•
print(f"åœ†çš„é¢ç§¯: {circle.area()}")
```

### 6.3 å·¥å‚æ¨¡å¼


**ğŸ­ åŠ¨æ€ç±»åˆ›å»ºå·¥å‚**
```python
class FactoryMeta(type):
    """å·¥å‚å…ƒç±»"""
    _product_types = {}
    
    def __new__(cls, name, bases, attrs):
        new_class = super().__new__(cls, name, bases, attrs)
        
        # æ³¨å†Œäº§å“ç±»å‹
        if hasattr(new_class, 'product_type'):
            cls._product_types[new_class.product_type] = new_class
        
        return new_class
    
    @classmethod
    def create_product(cls, product_type, *args, **kwargs):
        """å·¥å‚æ–¹æ³•"""
        if product_type in cls._product_types:
            product_class = cls._product_types[product_type]
            return product_class(*args, **kwargs)
        else:
            raise ValueError(f"æœªçŸ¥äº§å“ç±»å‹: {product_type}")

class Product(metaclass=FactoryMeta):
    def __init__(self, name):
        self.name = name

class Book(Product):
    product_type = "book"
    
    def __init__(self, name, author):
        super().__init__(name)
        self.author = author
    
    def read(self):
        return f"æ­£åœ¨é˜…è¯»ã€Š{self.name}ã€‹ï¼Œä½œè€…ï¼š{self.author}"

class Electronics(Product):
    product_type = "electronics"
    
    def __init__(self, name, brand):
        super().__init__(name)
        self.brand = brand
    
    def use(self):
        return f"æ­£åœ¨ä½¿ç”¨{self.brand}çš„{self.name}"

# ä½¿ç”¨å·¥å‚åˆ›å»ºäº§å“
book = FactoryMeta.create_product("book", "Pythonå…¥é—¨", "å¼ ä¸‰")
phone = FactoryMeta.create_product("electronics", "iPhone", "Apple")

print(book.read())    # æ­£åœ¨é˜…è¯»ã€ŠPythonå…¥é—¨ã€‹ï¼Œä½œè€…ï¼šå¼ ä¸‰
print(phone.use())    # æ­£åœ¨ä½¿ç”¨Appleçš„iPhone
```

---

## 7. ğŸ” å…ƒç±»è°ƒè¯•æŠ€å·§


### 7.1 å…ƒç±»æ‰§è¡Œè·Ÿè¸ª


**ğŸ“Š è¯¦ç»†è·Ÿè¸ªå…ƒç±»æ‰§è¡Œè¿‡ç¨‹**
```python
class TraceMeta(type):
    """è·Ÿè¸ªå…ƒç±»æ‰§è¡Œçš„è°ƒè¯•å…ƒç±»"""
    
    def __new__(cls, name, bases, attrs):
        print(f"\nğŸ”§ TraceMeta.__new__ è¢«è°ƒç”¨")
        print(f"   å…ƒç±»: {cls}")
        print(f"   ç±»å: {name}")
        print(f"   çˆ¶ç±»: {bases}")
        print(f"   å±æ€§æ•°é‡: {len(attrs)}")
        
        # æ˜¾ç¤ºé‡è¦å±æ€§
        important_attrs = {k: v for k, v in attrs.items() 
                          if not k.startswith('__')}
        if important_attrs:
            print(f"   ä¸»è¦å±æ€§: {list(important_attrs.keys())}")
        
        new_class = super().__new__(cls, name, bases, attrs)
        print(f"   âœ… ç±» {name} åˆ›å»ºå®Œæˆ: {new_class}")
        return new_class
    
    def __init__(cls, name, bases, attrs):
        print(f"\nğŸ TraceMeta.__init__ è¢«è°ƒç”¨")
        print(f"   æ­£åœ¨åˆå§‹åŒ–ç±»: {name}")
        super().__init__(name, bases, attrs)
        print(f"   âœ… ç±» {name} åˆå§‹åŒ–å®Œæˆ")
    
    def __call__(cls, *args, **kwargs):
        print(f"\nğŸ“ TraceMeta.__call__ è¢«è°ƒç”¨")
        print(f"   æ­£åœ¨åˆ›å»º {cls.__name__} çš„å®ä¾‹")
        print(f"   å‚æ•°: args={args}, kwargs={kwargs}")
        
        instance = super().__call__(*args, **kwargs)
        print(f"   âœ… å®ä¾‹åˆ›å»ºå®Œæˆ: {instance}")
        return instance

class MyClass(metaclass=TraceMeta):
    class_var = "æˆ‘æ˜¯ç±»å˜é‡"
    
    def __init__(self, value):
        self.value = value
        print(f"   MyClass.__init__ è®¾ç½® value = {value}")

# è§‚å¯Ÿæ•´ä¸ªè¿‡ç¨‹
print("=== å¼€å§‹åˆ›å»ºå®ä¾‹ ===")
obj = MyClass("æµ‹è¯•å€¼")
print("=== å®ä¾‹åˆ›å»ºå®Œæˆ ===")
```

### 7.2 å…ƒç±»ä¿¡æ¯æŸ¥çœ‹å·¥å…·


**ğŸ” å…ƒç±»ä¿¡æ¯æ£€æŸ¥å‡½æ•°**
```python
def inspect_metaclass(cls):
    """æ£€æŸ¥ç±»çš„å…ƒç±»ä¿¡æ¯"""
    print(f"\nğŸ“‹ ç±» {cls.__name__} çš„å…ƒç±»ä¿¡æ¯:")
    print(f"   ç±»å‹: {type(cls)}")
    print(f"   å…ƒç±»: {cls.__class__}")
    print(f"   MRO: {[c.__name__ for c in cls.__mro__]}")
    
    # æ£€æŸ¥æ˜¯å¦æ˜¯é»˜è®¤å…ƒç±»
    if type(cls) is type:
        print("   ğŸ’¡ ä½¿ç”¨é»˜è®¤å…ƒç±» type")
    else:
        print(f"   ğŸ”§ ä½¿ç”¨è‡ªå®šä¹‰å…ƒç±»: {type(cls).__name__}")
    
    # æ˜¾ç¤ºç±»å±æ€§
    attrs = [attr for attr in dir(cls) if not attr.startswith('_')]
    if attrs:
        print(f"   å±æ€§: {attrs}")
    
    # æ£€æŸ¥çˆ¶ç±»çš„å…ƒç±»
    for base in cls.__bases__:
        if type(base) is not type:
            print(f"   ç»§æ‰¿è‡ª {base.__name__} (å…ƒç±»: {type(base).__name__})")

# æµ‹è¯•ä¸åŒçš„ç±»
class NormalClass:
    attr1 = "normal"

class MetaClass(type):
    pass

class CustomClass(metaclass=MetaClass):
    attr1 = "custom"

# æ£€æŸ¥ä¸åŒç±»çš„å…ƒç±»ä¿¡æ¯
inspect_metaclass(NormalClass)
inspect_metaclass(CustomClass)
```

### 7.3 å¸¸è§é”™è¯¯è¯Šæ–­


**âŒ å…ƒç±»å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ**

| é”™è¯¯ç±»å‹ | **ç—‡çŠ¶** | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|----------|----------|-------------|
| **é€’å½’é”™è¯¯** | `RecursionError` | å…ƒç±»è°ƒç”¨è‡ªèº« | æ£€æŸ¥`__new__`ä¸­çš„`super()`è°ƒç”¨ |
| **ç±»å‹é”™è¯¯** | `TypeError: __new__() missing required positional argument` | å‚æ•°ä¼ é€’é”™è¯¯ | ç¡®ä¿æ­£ç¡®ä¼ é€’`cls, name, bases, attrs` |
| **å±æ€§é”™è¯¯** | `AttributeError` | é”™è¯¯ä¿®æ”¹ç±»å±æ€§ | åœ¨`__new__`ä¸­è°¨æ…ä¿®æ”¹`attrs`å­—å…¸ |
| **ç»§æ‰¿å†²çª** | `TypeError: metaclass conflict` | å¤šé‡ç»§æ‰¿å…ƒç±»å†²çª | åˆ›å»ºå…¼å®¹çš„å…ƒç±»æˆ–é‡æ–°è®¾è®¡ç»§æ‰¿ç»“æ„ |

**ğŸ”§ é”™è¯¯ç¤ºä¾‹ä¸ä¿®æ­£**
```python
# âŒ é”™è¯¯çš„å…ƒç±»å®šä¹‰
class BadMeta(type):
    def __new__(cls, name, bases, attrs):
        # å¿˜è®°è°ƒç”¨super()ï¼Œå¯¼è‡´ç±»åˆ›å»ºå¤±è´¥
        attrs['bad_attr'] = 'bad'
        return cls(name, bases, attrs)  # é”™è¯¯ï¼šä¼šå¯¼è‡´é€’å½’

# âœ… æ­£ç¡®çš„å…ƒç±»å®šä¹‰  
class GoodMeta(type):
    def __new__(cls, name, bases, attrs):
        attrs['good_attr'] = 'good'
        return super().__new__(cls, name, bases, attrs)  # æ­£ç¡®

# âŒ å…ƒç±»å†²çªç¤ºä¾‹
class MetaA(type): pass
class MetaB(type): pass

class ParentA(metaclass=MetaA): pass
class ParentB(metaclass=MetaB): pass

# class Child(ParentA, ParentB): pass  # é”™è¯¯ï¼šå…ƒç±»å†²çª

# âœ… è§£å†³å…ƒç±»å†²çª
class CombinedMeta(MetaA, MetaB): pass
class Child(ParentA, ParentB, metaclass=CombinedMeta): pass
```

---

## 8. ğŸ“š å…ƒç±»æœ€ä½³å®è·µ


### 8.1 ä½•æ—¶ä½¿ç”¨å…ƒç±»


**âœ… é€‚åˆä½¿ç”¨å…ƒç±»çš„åœºæ™¯**
- **æ¡†æ¶å¼€å‘**ï¼šéœ€è¦è‡ªåŠ¨åŒ–ç±»çš„åˆ›å»ºå’Œé…ç½®
- **APIè®¾è®¡**ï¼šéœ€è¦ç»Ÿä¸€çš„ç±»è¡Œä¸ºå’Œæ¥å£
- **ä»£ç ç”Ÿæˆ**ï¼šéœ€è¦æ ¹æ®é…ç½®åŠ¨æ€åˆ›å»ºç±»
- **è°ƒè¯•å·¥å…·**ï¼šéœ€è¦ç›‘æ§ç±»çš„åˆ›å»ºå’Œä½¿ç”¨

**âŒ ä¸é€‚åˆä½¿ç”¨å…ƒç±»çš„åœºæ™¯**
- **ç®€å•é€»è¾‘**ï¼šè£…é¥°å™¨æˆ–æ™®é€šç»§æ‰¿å°±èƒ½è§£å†³
- **æ€§èƒ½æ•æ„Ÿ**ï¼šå…ƒç±»ä¼šå¢åŠ é¢å¤–çš„åˆ›å»ºå¼€é”€
- **å›¢é˜Ÿåä½œ**ï¼šå›¢é˜Ÿæˆå‘˜å¯¹å…ƒç±»ä¸ç†Ÿæ‚‰

### 8.2 å…ƒç±»è®¾è®¡åŸåˆ™


**ğŸ¯ æ ¸å¿ƒåŸåˆ™**

| åŸåˆ™ | **è¯´æ˜** | **ç¤ºä¾‹** |
|------|----------|----------|
| **æœ€å°åŒ–åŸåˆ™** | åªåœ¨å¿…è¦æ—¶ä½¿ç”¨å…ƒç±» | ä¼˜å…ˆè€ƒè™‘è£…é¥°å™¨ã€ç»§æ‰¿ç­‰æ–¹æ¡ˆ |
| **æ˜ç¡®æ€§åŸåˆ™** | å…ƒç±»è¡Œä¸ºè¦æ¸…æ™°æ˜ç¡® | é¿å…éšå¼çš„å¤æ‚é€»è¾‘ |
| **æ–‡æ¡£åŒ–åŸåˆ™** | å……åˆ†æ³¨é‡Šå…ƒç±»åŠŸèƒ½ | è¯¦ç»†è¯´æ˜å…ƒç±»çš„ä½œç”¨å’Œç”¨æ³• |
| **æµ‹è¯•åŸåˆ™** | å……åˆ†æµ‹è¯•å…ƒç±»è¡Œä¸º | æµ‹è¯•ç±»åˆ›å»ºã€ç»§æ‰¿ã€å®ä¾‹åŒ–ç­‰åœºæ™¯ |

**ğŸ“ è‰¯å¥½çš„å…ƒç±»è®¾è®¡ç¤ºä¾‹**
```python
class ConfigurableMeta(type):
    """
    å¯é…ç½®çš„å…ƒç±»
    
    åŠŸèƒ½ï¼š
    1. è‡ªåŠ¨æ·»åŠ é…ç½®éªŒè¯
    2. æ³¨å†Œç±»åˆ°å…¨å±€é…ç½®ä¸­å¿ƒ
    3. æä¾›ç»Ÿä¸€çš„é…ç½®æ¥å£
    
    ä½¿ç”¨æ–¹å¼ï¼š
    class MyService(metaclass=ConfigurableMeta):
        config_schema = {
            'host': str,
            'port': int
        }
    """
    
    registry = {}
    
    def __new__(cls, name, bases, attrs):
        # éªŒè¯é…ç½®æ¨¡å¼
        if 'config_schema' in attrs:
            cls._validate_schema(attrs['config_schema'])
        
        # æ·»åŠ é…ç½®æ–¹æ³•
        attrs['configure'] = cls._create_configure_method(
            attrs.get('config_schema', {})
        )
        
        new_class = super().__new__(cls, name, bases, attrs)
        
        # æ³¨å†Œç±»
        cls.registry[name] = new_class
        
        return new_class
    
    @staticmethod
    def _validate_schema(schema):
        """éªŒè¯é…ç½®æ¨¡å¼"""
        if not isinstance(schema, dict):
            raise ValueError("é…ç½®æ¨¡å¼å¿…é¡»æ˜¯å­—å…¸")
        
        for key, value_type in schema.items():
            if not isinstance(value_type, type):
                raise ValueError(f"é…ç½®é¡¹ {key} çš„ç±»å‹å¿…é¡»æ˜¯ type")
    
    @staticmethod
    def _create_configure_method(schema):
        """åˆ›å»ºé…ç½®æ–¹æ³•"""
        def configure(self, **config):
            for key, value in config.items():
                if key in schema:
                    expected_type = schema[key]
                    if not isinstance(value, expected_type):
                        raise TypeError(f"{key} å¿…é¡»æ˜¯ {expected_type.__name__} ç±»å‹")
                    setattr(self, key, value)
                else:
                    raise ValueError(f"æœªçŸ¥é…ç½®é¡¹: {key}")
        return configure

# ä½¿ç”¨ç¤ºä¾‹
class DatabaseService(metaclass=ConfigurableMeta):
    config_schema = {
        'host': str,
        'port': int,
        'database': str
    }
    
    def connect(self):
        return f"è¿æ¥åˆ° {self.host}:{self.port}/{self.database}"

# æµ‹è¯•é…ç½®åŠŸèƒ½
db = DatabaseService()
db.configure(host="localhost", port=5432, database="mydb")
print(db.connect())  # è¿æ¥åˆ° localhost:5432/mydb
```

### 8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ å…ƒç±»æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
```python
class OptimizedMeta(type):
    """ä¼˜åŒ–çš„å…ƒç±»ç¤ºä¾‹"""
    
    # ä½¿ç”¨ç±»å˜é‡ç¼“å­˜ç»“æœ
    _method_cache = {}
    
    def __new__(cls, name, bases, attrs):
        # ç¼“å­˜é‡å¤è®¡ç®—çš„ç»“æœ
        cache_key = (name, tuple(bases), tuple(sorted(attrs.items())))
        
        if cache_key in cls._method_cache:
            print(f"ä»ç¼“å­˜è·å– {name}")
            return cls._method_cache[cache_key]
        
        # åªåœ¨å¿…è¦æ—¶è¿›è¡Œå¤æ‚æ“ä½œ
        if cls._needs_processing(attrs):
            attrs = cls._process_attributes(attrs)
        
        new_class = super().__new__(cls, name, bases, attrs)
        cls._method_cache[cache_key] = new_class
        
        return new_class
    
    @classmethod
    def _needs_processing(cls, attrs):
        """æ£€æŸ¥æ˜¯å¦éœ€è¦å¤„ç†"""
        return any(key.startswith('auto_') for key in attrs)
    
    @classmethod
    def _process_attributes(cls, attrs):
        """åªåœ¨éœ€è¦æ—¶å¤„ç†å±æ€§"""
        processed_attrs = attrs.copy()
        
        for key, value in attrs.items():
            if key.startswith('auto_'):
                # æ‰§è¡Œè‡ªåŠ¨å¤„ç†é€»è¾‘
                processed_attrs[key[5:]] = cls._auto_process(value)
        
        return processed_attrs
    
    @staticmethod
    def _auto_process(value):
        """è‡ªåŠ¨å¤„ç†é€»è¾‘"""
        return f"auto_processed_{value}"
```

### 8.4 è°ƒè¯•å’Œç»´æŠ¤å»ºè®®


**ğŸ”§ è°ƒè¯•æŠ€å·§æ€»ç»“**
```python
def debug_metaclass(func):
    """å…ƒç±»æ–¹æ³•è°ƒè¯•è£…é¥°å™¨"""
    def wrapper(*args, **kwargs):
        method_name = func.__name__
        print(f"ğŸ” è°ƒç”¨ {method_name}")
        print(f"   å‚æ•°: {args[1:]} {kwargs}")  # è·³è¿‡self/cls
        
        try:
            result = func(*args, **kwargs)
            print(f"   âœ… {method_name} æˆåŠŸ")
            return result
        except Exception as e:
            print(f"   âŒ {method_name} å¤±è´¥: {e}")
            raise
    
    return wrapper

class DebuggableMeta(type):
    @debug_metaclass
    def __new__(cls, name, bases, attrs):
        return super().__new__(cls, name, bases, attrs)
    
    @debug_metaclass
    def __init__(cls, name, bases, attrs):
        super().__init__(name, bases, attrs)
```

**ğŸ“‹ ç»´æŠ¤æ£€æŸ¥æ¸…å•**
- [ ] å…ƒç±»åŠŸèƒ½æ˜¯å¦å¿…è¦ï¼Ÿ
- [ ] æ˜¯å¦æœ‰æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Ÿ
- [ ] ä»£ç æ˜¯å¦æœ‰å……åˆ†çš„æ–‡æ¡£ï¼Ÿ
- [ ] æ˜¯å¦æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼Ÿ
- [ ] å›¢é˜Ÿæˆå‘˜æ˜¯å¦ç†è§£å…ƒç±»é€»è¾‘ï¼Ÿ
- [ ] æ€§èƒ½å½±å“æ˜¯å¦å¯æ¥å—ï¼Ÿ

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å…ƒç±»æœ¬è´¨ï¼šåˆ›å»ºç±»çš„ç±»ï¼Œç±»ä¼¼äºç±»æ˜¯åˆ›å»ºå¯¹è±¡çš„æ¨¡æ¿
ğŸ”¸ typeåŒé‡èº«ä»½ï¼šæ—¢æ˜¯æŸ¥çœ‹ç±»å‹çš„å‡½æ•°ï¼Œä¹Ÿæ˜¯é»˜è®¤çš„å…ƒç±»  
ğŸ”¸ å…ƒç±»æœºåˆ¶ï¼šé€šè¿‡__new__å’Œ__init__æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹
ğŸ”¸ æŸ¥æ‰¾é¡ºåºï¼šmetaclasså‚æ•° > çˆ¶ç±»å…ƒç±» > é»˜è®¤type
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šæ¡†æ¶å¼€å‘ã€ORMã€æ’ä»¶ç³»ç»Ÿã€è®¾è®¡æ¨¡å¼å®ç°
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šæœ€å°åŒ–ä½¿ç”¨ã€æ˜ç¡®åŠŸèƒ½ã€å……åˆ†æ–‡æ¡£ã€å®Œæ•´æµ‹è¯•
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å…ƒç±»ä¸æ™®é€šç±»çš„å±‚æ¬¡å…³ç³»**
```
å±‚æ¬¡ç†è§£ï¼š
å®ä¾‹ â† ç±» â† å…ƒç±»
äºº â† Personç±» â† type
```

**ğŸ”¹ ä½•æ—¶è€ƒè™‘ä½¿ç”¨å…ƒç±»**
```
ä½¿ç”¨åœºæ™¯åˆ¤æ–­ï¼š
âœ… éœ€è¦åœ¨ç±»åˆ›å»ºæ—¶è‡ªåŠ¨æ‰§è¡Œé€»è¾‘
âœ… éœ€è¦æ‰¹é‡ä¿®æ”¹ç±»çš„è¡Œä¸º
âœ… éœ€è¦å®ç°å¤æ‚çš„è®¾è®¡æ¨¡å¼
âŒ ç®€å•çš„åŠŸèƒ½è£…é¥°å™¨å°±èƒ½æå®š
âŒ å›¢é˜Ÿæˆå‘˜å¯¹å…ƒç±»ä¸ç†Ÿæ‚‰
```

**ğŸ”¹ type()çš„ä¸‰ç§ç”¨æ³•**
```
1. æŸ¥çœ‹ç±»å‹ï¼štype(obj)
2. åˆ¤æ–­ç±»å‹ï¼šisinstance(obj, type)  
3. åˆ›å»ºç±»ï¼štype(name, bases, attrs)
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æ¡†æ¶å¼€å‘åº”ç”¨**
- **Webæ¡†æ¶**ï¼šè‡ªåŠ¨è·¯ç”±æ³¨å†Œã€ä¸­é—´ä»¶é…ç½®
- **ORMç³»ç»Ÿ**ï¼šæ¨¡å‹ç±»è‡ªåŠ¨æ˜ å°„ã€å­—æ®µéªŒè¯
- **æ’ä»¶ç³»ç»Ÿ**ï¼šè‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæ’ä»¶ç±»
- **APIæ¡†æ¶**ï¼šè‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£å’ŒéªŒè¯

**ğŸ”§ æ—¥å¸¸å¼€å‘åº”ç”¨**
- **å•ä¾‹æ¨¡å¼**ï¼šç¡®ä¿ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹
- **å·¥å‚æ¨¡å¼**ï¼šæ ¹æ®é…ç½®åŠ¨æ€åˆ›å»ºç±»
- **æŠ½è±¡ç±»**ï¼šå¼ºåˆ¶å­ç±»å®ç°ç‰¹å®šæ–¹æ³•
- **å±æ€§éªŒè¯**ï¼šè‡ªåŠ¨æ£€æŸ¥ç±»å±æ€§çš„æœ‰æ•ˆæ€§

### 9.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“ˆ å­¦ä¹ å»ºè®®**
```
åˆå­¦é˜¶æ®µï¼š
1. ç†è§£"ç±»ä¹Ÿæ˜¯å¯¹è±¡"çš„æ¦‚å¿µ
2. æŒæ¡type()çš„åŸºæœ¬ç”¨æ³•
3. å­¦ä¼šä½¿ç”¨metaclasså‚æ•°

è¿›é˜¶é˜¶æ®µï¼š  
1. æ·±å…¥ç†è§£__new__å’Œ__init__çš„åŒºåˆ«
2. å­¦ä¹ å¸¸è§çš„å…ƒç±»è®¾è®¡æ¨¡å¼
3. å®è·µç®€å•çš„å…ƒç±»åº”ç”¨

é«˜çº§é˜¶æ®µï¼š
1. è®¾è®¡å¤æ‚çš„å…ƒç±»ç³»ç»Ÿ
2. ä¼˜åŒ–å…ƒç±»æ€§èƒ½
3. è°ƒè¯•å’Œç»´æŠ¤å…ƒç±»ä»£ç 
```

**âš ï¸ å¸¸è§è¯¯åŒº**
- **è¿‡åº¦ä½¿ç”¨**ï¼šä¸æ˜¯æ‰€æœ‰é—®é¢˜éƒ½éœ€è¦å…ƒç±»è§£å†³
- **å¤æ‚åŒ–**ï¼šå…ƒç±»åº”è¯¥ç®€åŒ–é—®é¢˜è€Œä¸æ˜¯å¢åŠ å¤æ‚æ€§
- **ç¼ºä¹æ–‡æ¡£**ï¼šå…ƒç±»ä»£ç å¿…é¡»æœ‰æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜
- **å¿½ç•¥æ›¿ä»£**ï¼šè£…é¥°å™¨ã€ç»§æ‰¿ç­‰æ–¹æ¡ˆå¾€å¾€æ›´ç®€å•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç±»åˆ›å»ºå¯¹è±¡ï¼Œå…ƒç±»åˆ›å»ºç±»
typeæ—¢æŸ¥ç±»å‹ï¼Œä¹Ÿåšå…ƒç±»
__new__åˆ›å»ºï¼Œ__init__åˆå§‹
æ¡†æ¶å¼€å‘ç”¨å¾—å¤šï¼Œæ—¥å¸¸å¼€å‘è¦è°¨æ…
```