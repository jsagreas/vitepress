---
title: 8ã€å¤šæ€ä¸æŠ½è±¡
---
## ğŸ“š ç›®å½•

1. [å¤šæ€æ¦‚å¿µä¸åŸºæœ¬ç†è§£](#1-å¤šæ€æ¦‚å¿µä¸åŸºæœ¬ç†è§£)
2. [é¸­å­ç±»å‹è¯¦è§£](#2-é¸­å­ç±»å‹è¯¦è§£)
3. [æ¥å£çº¦å®šæœºåˆ¶](#3-æ¥å£çº¦å®šæœºåˆ¶)
4. [æŠ½è±¡åŸºç±»ABCè¯¦è§£](#4-æŠ½è±¡åŸºç±»ABCè¯¦è§£)
5. [è™šæ‹Ÿå­ç±»æœºåˆ¶](#5-è™šæ‹Ÿå­ç±»æœºåˆ¶)
6. [åè®®Protocolè¯¦è§£](#6-åè®®Protocolè¯¦è§£)
7. [ç±»å‹æ£€æŸ¥ä¸å¤šæ€ç»“åˆ](#7-ç±»å‹æ£€æŸ¥ä¸å¤šæ€ç»“åˆ)
8. [å¤šæ€è®¾è®¡æ¨¡å¼å®è·µ](#8-å¤šæ€è®¾è®¡æ¨¡å¼å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ­ å¤šæ€æ¦‚å¿µä¸åŸºæœ¬ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯å¤šæ€ï¼Ÿ


**ğŸ”¸ ç”Ÿæ´»ä¸­çš„å¤šæ€æ¦‚å¿µ**
```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
- ç”µè§†é¥æ§å™¨ï¼šä¸ç®¡æ˜¯å“ªä¸ªå“ç‰Œçš„ç”µè§†ï¼ŒæŒ‰"å¼€æœº"é”®éƒ½èƒ½æ‰“å¼€ç”µè§†
- æ±½è½¦æ–¹å‘ç›˜ï¼šä¸ç®¡æ˜¯ä»€ä¹ˆç‰Œå­çš„è½¦ï¼Œè½¬æ–¹å‘ç›˜éƒ½èƒ½è½¬å¼¯
- æ‰‹æœºå……ç”µï¼šä¸åŒå“ç‰Œæ‰‹æœºï¼Œæ’USBæ¥å£éƒ½èƒ½å……ç”µ
```

**ğŸ¯ ç¼–ç¨‹ä¸­çš„å¤šæ€**
å¤šæ€å°±æ˜¯"**åŒä¸€ä¸ªæ“ä½œä½œç”¨äºä¸åŒå¯¹è±¡æ—¶ï¼Œå¯ä»¥æœ‰ä¸åŒçš„è§£é‡Šå’Œä¸åŒçš„æ‰§è¡Œç»“æœ**"ã€‚

ç®€å•è¯´ï¼š**ä¸åŒçš„å¯¹è±¡ï¼Œè°ƒç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œä¼šæœ‰ä¸åŒçš„è¡Œä¸ºè¡¨ç°**ã€‚

### 1.2 Pythonä¸­çš„å¤šæ€ç‰¹ç‚¹


**â­ Pythonçš„å¤©ç„¶å¤šæ€æ€§**
```python
# ğŸŒŸ åŸºç¡€ç¤ºä¾‹ï¼šä¸åŒå¯¹è±¡çš„ç›¸åŒæ–¹æ³•
class Dog:
    def make_sound(self):
        return "æ±ªæ±ªæ±ª"

class Cat:
    def make_sound(self):
        return "å–µå–µå–µ"

class Duck:
    def make_sound(self):
        return "å˜å˜å˜"

# å¤šæ€çš„ä½“ç°
def animal_sound(animal):
    """ä¸ç®¡ä¼ å…¥ä»€ä¹ˆåŠ¨ç‰©ï¼Œéƒ½è°ƒç”¨make_soundæ–¹æ³•"""
    return animal.make_sound()

# ä½¿ç”¨ç¤ºä¾‹
dog = Dog()
cat = Cat()
duck = Duck()

print(animal_sound(dog))   # è¾“å‡ºï¼šæ±ªæ±ªæ±ª
print(animal_sound(cat))   # è¾“å‡ºï¼šå–µå–µå–µ  
print(animal_sound(duck))  # è¾“å‡ºï¼šå˜å˜å˜
```

**ğŸ’¡ å…³é”®ç†è§£**
- **animal_soundå‡½æ•°**ä¸å…³å¿ƒä¼ å…¥çš„æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡
- åªè¦å¯¹è±¡æœ‰**make_soundæ–¹æ³•**ï¼Œå°±èƒ½æ­£å¸¸å·¥ä½œ
- è¿™å°±æ˜¯Pythonçš„å¤šæ€ï¼š**æŒ‰è¡Œä¸ºè€Œä¸æ˜¯æŒ‰ç±»å‹**

### 1.3 å¤šæ€çš„æ ¸å¿ƒä»·å€¼


**ğŸš€ å¤šæ€çš„å¥½å¤„**

| ä¼˜åŠ¿ | è¯´æ˜ | å®é™…æ„ä¹‰ |
|------|------|----------|
| **ä»£ç å¤ç”¨** | ä¸€ä¸ªå‡½æ•°å¯ä»¥å¤„ç†å¤šç§ç±»å‹ | å‡å°‘é‡å¤ä»£ç  |
| **æ‰©å±•æ€§å¼º** | æ–°å¢ç±»å‹æ— éœ€ä¿®æ”¹åŸæœ‰ä»£ç  | æ˜“äºç»´æŠ¤å’Œæ‰©å±• |
| **è®¾è®¡çµæ´»** | é™ä½ç»„ä»¶é—´çš„è€¦åˆåº¦ | æ›´å¥½çš„è½¯ä»¶æ¶æ„ |
| **æ˜“äºæµ‹è¯•** | å¯ä»¥ç”¨æ¨¡æ‹Ÿå¯¹è±¡æ›¿ä»£çœŸå®å¯¹è±¡ | æé«˜æµ‹è¯•æ•ˆç‡ |

**ğŸ“Š ä¼ ç»Ÿæ–¹å¼ vs å¤šæ€æ–¹å¼**
```
âŒ ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸ä½¿ç”¨å¤šæ€ï¼‰ï¼š
def handle_payment(payment_type, amount):
    if payment_type == "credit_card":
        # ä¿¡ç”¨å¡æ”¯ä»˜é€»è¾‘
        pass
    elif payment_type == "paypal":
        # PayPalæ”¯ä»˜é€»è¾‘
        pass
    elif payment_type == "alipay":
        # æ”¯ä»˜å®æ”¯ä»˜é€»è¾‘
        pass
    # æ–°å¢æ”¯ä»˜æ–¹å¼éœ€è¦ä¿®æ”¹è¿™ä¸ªå‡½æ•°

âœ… å¤šæ€æ–¹å¼ï¼š
def handle_payment(payment_processor, amount):
    return payment_processor.process(amount)
    # æ–°å¢æ”¯ä»˜æ–¹å¼æ— éœ€ä¿®æ”¹è¿™ä¸ªå‡½æ•°
```

---

## 2. ğŸ¦† é¸­å­ç±»å‹è¯¦è§£


### 2.1 é¸­å­ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ


**ğŸ¦† é¸­å­ç±»å‹çš„å“²å­¦**
> "å¦‚æœå®ƒèµ°èµ·æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒå°±æ˜¯é¸­å­"

**ğŸ¯ ç¼–ç¨‹å«ä¹‰**
åœ¨Pythonä¸­ï¼Œ**ä¸éœ€è¦æ˜ç¡®å£°æ˜ç±»å‹å…³ç³»**ï¼Œåªè¦å¯¹è±¡æœ‰éœ€è¦çš„æ–¹æ³•æˆ–å±æ€§ï¼Œå°±å¯ä»¥è¢«å½“ä½œæŸç§ç±»å‹ä½¿ç”¨ã€‚

### 2.2 é¸­å­ç±»å‹å®æˆ˜ç¤ºä¾‹


**ğŸ“ æ–‡ä»¶å¤„ç†çš„é¸­å­ç±»å‹**
```python
# ğŸŒŸ ä¸åŒçš„"æ–‡ä»¶"å¯¹è±¡
class TextFile:
    def __init__(self, content):
        self.content = content
    
    def read(self):
        return self.content
    
    def write(self, data):
        self.content += data

class DatabaseRecord:
    def __init__(self, data):
        self.data = data
    
    def read(self):
        return f"ä»æ•°æ®åº“è¯»å–: {self.data}"
    
    def write(self, data):
        self.data = data

class NetworkStream:
    def __init__(self, url):
        self.url = url
        self.buffer = ""
    
    def read(self):
        return f"ä»{self.url}è¯»å–æ•°æ®: {self.buffer}"
    
    def write(self, data):
        self.buffer = data

# ğŸ¦† é¸­å­ç±»å‹çš„å¤„ç†å‡½æ•°
def process_file_like_object(file_obj, new_data):
    """
    å¤„ç†ä»»ä½•"åƒæ–‡ä»¶"çš„å¯¹è±¡
    åªè¦æœ‰read()å’Œwrite()æ–¹æ³•å°±è¡Œ
    """
    print(f"åŸå†…å®¹: {file_obj.read()}")
    file_obj.write(new_data)
    print(f"æ–°å†…å®¹: {file_obj.read()}")

# ä½¿ç”¨ç¤ºä¾‹
text_file = TextFile("åŸå§‹æ–‡æœ¬")
db_record = DatabaseRecord("åŸå§‹æ•°æ®")
network = NetworkStream("http://api.example.com")

# éƒ½å¯ä»¥ç”¨åŒä¸€ä¸ªå‡½æ•°å¤„ç†
process_file_like_object(text_file, "æ–°æ–‡æœ¬")
process_file_like_object(db_record, "æ–°æ•°æ®")  
process_file_like_object(network, "æ–°çš„ç½‘ç»œæ•°æ®")
```

**ğŸ”‘ å…³é”®ç‚¹ç†è§£**
- **TextFileã€DatabaseRecordã€NetworkStream**ä¸‰ä¸ªç±»æ²¡æœ‰ç»§æ‰¿å…³ç³»
- ä½†å®ƒä»¬éƒ½æœ‰**read()å’Œwrite()æ–¹æ³•**
- **process_file_like_objectå‡½æ•°**å¯ä»¥å¤„ç†æ‰€æœ‰è¿™äº›å¯¹è±¡
- è¿™å°±æ˜¯é¸­å­ç±»å‹ï¼š**æŒ‰è¡Œä¸ºè¯†åˆ«ï¼Œä¸æŒ‰è¡€ç¼˜å…³ç³»**

### 2.3 é¸­å­ç±»å‹çš„å®é™…åº”ç”¨


**ğŸ› ï¸ è¿­ä»£å™¨åè®®ç¤ºä¾‹**
```python
# ğŸŒŸ è‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡
class NumberRange:
    def __init__(self, start, end):
        self.start = start
        self.end = end
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.start >= self.end:
            raise StopIteration
        current = self.start
        self.start += 1
        return current

# ä½¿ç”¨æ–¹å¼å’Œå†…ç½®çš„rangeå®Œå…¨ä¸€æ ·
numbers = NumberRange(1, 5)

# ğŸ¦† é¸­å­ç±»å‹ï¼šè¡¨ç°å¾—åƒå¯è¿­ä»£å¯¹è±¡
for num in numbers:
    print(num)  # è¾“å‡º: 1 2 3 4

# ä¹Ÿå¯ä»¥è½¬æ¢ä¸ºåˆ—è¡¨
new_range = NumberRange(10, 13)
print(list(new_range))  # è¾“å‡º: [10, 11, 12]
```

**ğŸ’­ ä¸ºä»€ä¹ˆèƒ½å·¥ä½œï¼Ÿ**
- Pythonçš„**forå¾ªç¯**ä¸å…³å¿ƒä½ æ˜¯ä»€ä¹ˆç±»å‹
- åªè¦ä½ æœ‰**__iter__å’Œ__next__æ–¹æ³•**
- å°±ä¼šè¢«å½“ä½œå¯è¿­ä»£å¯¹è±¡å¤„ç†

---

## 3. ğŸ¤ æ¥å£çº¦å®šæœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯æ¥å£çº¦å®šï¼Ÿ


**ğŸ“‹ æ¥å£çº¦å®šçš„æ¦‚å¿µ**
æ¥å£çº¦å®šå°±æ˜¯**ä¸€ç»„æ–¹æ³•çš„"åˆåŒ"**ï¼Œè§„å®šäº†æŸç§ç±»å‹çš„å¯¹è±¡åº”è¯¥å…·å¤‡å“ªäº›æ–¹æ³•ã€‚

**ğŸ¯ ç”Ÿæ´»ç±»æ¯”**
```
é©¾é©¶å‘˜æ¥å£çº¦å®šï¼š
- å¿…é¡»ä¼šï¼šæ²¹é—¨ã€åˆ¹è½¦ã€æ–¹å‘ç›˜ã€æ¢æŒ¡
- ä¸ç®¡ä½ å¼€ä»€ä¹ˆè½¦ï¼Œè¿™äº›åŸºæœ¬æ“ä½œå¿…é¡»ä¼š

ç¨‹åºå‘˜æ¥å£çº¦å®šï¼š
- å¿…é¡»ä¼šï¼šç¼–ç ã€è°ƒè¯•ã€æµ‹è¯•ã€æ–‡æ¡£
- ä¸ç®¡ä½ ç”¨ä»€ä¹ˆè¯­è¨€ï¼Œè¿™äº›åŸºæœ¬æŠ€èƒ½å¿…é¡»æœ‰
```

### 3.2 Pythonä¸­çš„æ¥å£çº¦å®šå®ç°


**ğŸ”¸ åŸºç¡€æ¥å£çº¦å®šç¤ºä¾‹**
```python
# ğŸŒŸ æ”¯ä»˜å¤„ç†æ¥å£çº¦å®š
class PaymentProcessor:
    """æ”¯ä»˜å¤„ç†å™¨çš„æ¥å£çº¦å®š"""
    
    def validate_payment(self, amount, payment_info):
        """éªŒè¯æ”¯ä»˜ä¿¡æ¯"""
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°validate_paymentæ–¹æ³•")
    
    def process_payment(self, amount, payment_info):
        """å¤„ç†æ”¯ä»˜"""
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°process_paymentæ–¹æ³•")
    
    def send_confirmation(self, transaction_id):
        """å‘é€ç¡®è®¤ä¿¡æ¯"""
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç°send_confirmationæ–¹æ³•")

# ğŸ¦ ä¿¡ç”¨å¡æ”¯ä»˜å®ç°
class CreditCardProcessor(PaymentProcessor):
    def validate_payment(self, amount, payment_info):
        card_number = payment_info.get('card_number', '')
        return len(card_number) == 16 and card_number.isdigit()
    
    def process_payment(self, amount, payment_info):
        if self.validate_payment(amount, payment_info):
            return f"ä¿¡ç”¨å¡æ”¯ä»˜{amount}å…ƒæˆåŠŸ"
        return "ä¿¡ç”¨å¡ä¿¡æ¯æ— æ•ˆ"
    
    def send_confirmation(self, transaction_id):
        return f"ä¿¡ç”¨å¡æ”¯ä»˜ç¡®è®¤é‚®ä»¶å·²å‘é€ï¼Œäº¤æ˜“å·ï¼š{transaction_id}"

# ğŸ’° æ”¯ä»˜å®æ”¯ä»˜å®ç°
class AlipayProcessor(PaymentProcessor):
    def validate_payment(self, amount, payment_info):
        account = payment_info.get('account', '')
        return '@' in account or len(account) == 11
    
    def process_payment(self, amount, payment_info):
        if self.validate_payment(amount, payment_info):
            return f"æ”¯ä»˜å®æ”¯ä»˜{amount}å…ƒæˆåŠŸ"
        return "æ”¯ä»˜å®è´¦å·æ— æ•ˆ"
    
    def send_confirmation(self, transaction_id):
        return f"æ”¯ä»˜å®æ”¯ä»˜çŸ­ä¿¡ç¡®è®¤å·²å‘é€ï¼Œäº¤æ˜“å·ï¼š{transaction_id}"

# ğŸ›’ ç»Ÿä¸€çš„æ”¯ä»˜å¤„ç†
def handle_order_payment(processor: PaymentProcessor, amount, payment_info):
    """å¤„ç†è®¢å•æ”¯ä»˜ - ä¸å…³å¿ƒå…·ä½“çš„æ”¯ä»˜æ–¹å¼"""
    result = processor.process_payment(amount, payment_info)
    if "æˆåŠŸ" in result:
        confirmation = processor.send_confirmation("TXN123456")
        return f"{result}\n{confirmation}"
    return result

# ä½¿ç”¨ç¤ºä¾‹
credit_card = CreditCardProcessor()
alipay = AlipayProcessor()

# ä¿¡ç”¨å¡æ”¯ä»˜
credit_result = handle_order_payment(
    credit_card, 
    100, 
    {'card_number': '1234567890123456'}
)
print(credit_result)

# æ”¯ä»˜å®æ”¯ä»˜
alipay_result = handle_order_payment(
    alipay, 
    200, 
    {'account': 'user@example.com'}
)
print(alipay_result)
```

**ğŸ“ å­¦ä¹ è¦ç‚¹**
- **PaymentProcessor**å®šä¹‰äº†æ”¯ä»˜å¤„ç†çš„"åˆåŒ"
- æ‰€æœ‰å…·ä½“å®ç°éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªåˆåŒ
- **handle_order_payment**å‡½æ•°å¯ä»¥å¤„ç†ä»»ä½•éµå®ˆåˆåŒçš„æ”¯ä»˜æ–¹å¼

### 3.3 æ¥å£çº¦å®šçš„æœ€ä½³å®è·µ


**âœ… å¥½çš„æ¥å£çº¦å®šè®¾è®¡**
```python
class Drawable:
    """å¯ç»˜åˆ¶å¯¹è±¡çš„æ¥å£çº¦å®š"""
    
    def draw(self, canvas):
        """åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶è‡ªå·±"""
        raise NotImplementedError
    
    def get_bounds(self):
        """è·å–å¯¹è±¡çš„è¾¹ç•Œä¿¡æ¯"""
        raise NotImplementedError

class Circle(Drawable):
    def __init__(self, x, y, radius):
        self.x, self.y, self.radius = x, y, radius
    
    def draw(self, canvas):
        return f"åœ¨{canvas}ä¸Šç»˜åˆ¶åœ†å½¢ï¼šä¸­å¿ƒ({self.x},{self.y}) åŠå¾„{self.radius}"
    
    def get_bounds(self):
        return {
            'left': self.x - self.radius,
            'right': self.x + self.radius,
            'top': self.y - self.radius,
            'bottom': self.y + self.radius
        }

# ğŸ¨ é€šç”¨ç»˜åˆ¶å‡½æ•°
def render_shapes(shapes, canvas="ç”»å¸ƒ"):
    """æ¸²æŸ“æ‰€æœ‰å›¾å½¢"""
    for shape in shapes:
        print(shape.draw(canvas))
        bounds = shape.get_bounds()
        print(f"  è¾¹ç•Œ: {bounds}")
```

**ğŸ“ è®¾è®¡åŸåˆ™æ€»ç»“**

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **æ–¹æ³•å‘½åæ¸…æ™°** | æ–¹æ³•åè¦è¡¨è¾¾æ˜ç¡®çš„æ„å›¾ | `draw()` è€Œä¸æ˜¯ `do_something()` |
| **å‚æ•°åˆç†** | å‚æ•°æ•°é‡é€‚ä¸­ï¼Œç±»å‹æ˜ç¡® | `draw(canvas)` è€Œä¸æ˜¯ `draw(a, b, c)` |
| **è¿”å›å€¼ä¸€è‡´** | åŒç±»æ–¹æ³•è¿”å›ç±»å‹åº”ä¸€è‡´ | éƒ½è¿”å›å­—ç¬¦ä¸²æˆ–éƒ½è¿”å›å­—å…¸ |
| **å¼‚å¸¸å¤„ç†** | æ˜ç¡®ä»€ä¹ˆæƒ…å†µä¼šæŠ›å‡ºå¼‚å¸¸ | éªŒè¯å¤±è´¥æ—¶æŠ›å‡ºç‰¹å®šå¼‚å¸¸ |

---

## 4. ğŸ—ï¸ æŠ½è±¡åŸºç±»ABCè¯¦è§£


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦æŠ½è±¡åŸºç±»ï¼Ÿ


**ğŸ¤” é—®é¢˜èƒŒæ™¯**
è™½ç„¶Pythonæœ‰é¸­å­ç±»å‹ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ›´**ä¸¥æ ¼çš„æ¥å£æ§åˆ¶**ï¼š

```python
# ğŸ˜ çº¯é çº¦å®šå®¹æ˜“å‡ºé”™
class Bird:
    def fly(self):
        raise NotImplementedError

class Eagle(Bird):
    pass  # å¿˜è®°å®ç°flyæ–¹æ³•äº†ï¼

# åˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šæŠ¥é”™
eagle = Eagle()  # æ²¡é—®é¢˜

# è°ƒç”¨æ–¹æ³•æ—¶æ‰ä¼šå‡ºé”™
eagle.fly()  # è¿è¡Œæ—¶æ‰å‘ç°é”™è¯¯ï¼
```

**âœ… æŠ½è±¡åŸºç±»çš„è§£å†³æ–¹æ¡ˆ**
æŠ½è±¡åŸºç±»èƒ½è®©æˆ‘ä»¬**åœ¨åˆ›å»ºå¯¹è±¡æ—¶**å°±å‘ç°é—®é¢˜ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶æ‰æŠ¥é”™ã€‚

### 4.2 ABCåŸºç¡€ä½¿ç”¨


**ğŸ”¸ åŸºæœ¬çš„æŠ½è±¡åŸºç±»**
```python
from abc import ABC, abstractmethod

# ğŸŒŸ å®šä¹‰æŠ½è±¡åŸºç±»
class Animal(ABC):
    """åŠ¨ç‰©æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def make_sound(self):
        """æŠ½è±¡æ–¹æ³•ï¼šå‘å‡ºå£°éŸ³"""
        pass
    
    @abstractmethod
    def move(self):
        """æŠ½è±¡æ–¹æ³•ï¼šç§»åŠ¨"""
        pass
    
    # æ™®é€šæ–¹æ³•ï¼ˆå­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰
    def sleep(self):
        return f"{self.__class__.__name__}æ­£åœ¨ç¡è§‰"

# ğŸ• æ­£ç¡®çš„å®ç°
class Dog(Animal):
    def make_sound(self):
        return "æ±ªæ±ªæ±ª"
    
    def move(self):
        return "å››æ¡è…¿è·‘"

# ğŸ¦ é”™è¯¯çš„å®ç°ï¼ˆç¼ºå°‘æ–¹æ³•ï¼‰
class IncompleteBird(Animal):
    def make_sound(self):
        return "å•¾å•¾å•¾"
    # å¿˜è®°å®ç°moveæ–¹æ³•äº†ï¼

# æµ‹è¯•
try:
    dog = Dog()  # âœ… æˆåŠŸåˆ›å»º
    print(dog.make_sound())
    print(dog.sleep())
    
    bird = Incompletebird()  # âŒ ç«‹å³æŠ¥é”™ï¼
except TypeError as e:
    print(f"é”™è¯¯: {e}")
```

**ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿**
- **ç¼–è¯‘æœŸæ£€æŸ¥**ï¼šåˆ›å»ºå¯¹è±¡æ—¶å°±èƒ½å‘ç°é—®é¢˜
- **å¼ºåˆ¶å®ç°**ï¼šå­ç±»å¿…é¡»å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•
- **æ–‡æ¡£ä½œç”¨**ï¼šæ˜ç¡®å®šä¹‰äº†ç±»çš„æ¥å£

### 4.3 æŠ½è±¡åŸºç±»çš„é«˜çº§ç”¨æ³•


**ğŸ”§ å¸¦æœ‰å…·ä½“å®ç°çš„æŠ½è±¡åŸºç±»**
```python
from abc import ABC, abstractmethod

class DataProcessor(ABC):
    """æ•°æ®å¤„ç†å™¨æŠ½è±¡åŸºç±»"""
    
    def __init__(self, name):
        self.name = name
        self.processed_count = 0
    
    @abstractmethod
    def process_item(self, item):
        """å¤„ç†å•ä¸ªæ•°æ®é¡¹ï¼ˆå¿…é¡»å®ç°ï¼‰"""
        pass
    
    @abstractmethod
    def validate_item(self, item):
        """éªŒè¯æ•°æ®é¡¹ï¼ˆå¿…é¡»å®ç°ï¼‰"""
        pass
    
    # æ¨¡æ¿æ–¹æ³•ï¼ˆæä¾›é€šç”¨é€»è¾‘ï¼‰
    def process_batch(self, items):
        """æ‰¹é‡å¤„ç†ï¼ˆå­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰"""
        results = []
        for item in items:
            if self.validate_item(item):
                result = self.process_item(item)
                results.append(result)
                self.processed_count += 1
            else:
                print(f"è·³è¿‡æ— æ•ˆæ•°æ®: {item}")
        return results
    
    def get_stats(self):
        """è·å–å¤„ç†ç»Ÿè®¡ï¼ˆå­ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼‰"""
        return f"{self.name}å·²å¤„ç†{self.processed_count}ä¸ªæ•°æ®é¡¹"

# ğŸ“Š CSVæ•°æ®å¤„ç†å™¨
class CSVProcessor(DataProcessor):
    def validate_item(self, item):
        return isinstance(item, str) and ',' in item
    
    def process_item(self, item):
        # ç®€å•çš„CSVè§£æ
        fields = item.split(',')
        return {'å­—æ®µæ•°é‡': len(fields), 'åŸå§‹æ•°æ®': item}

# ğŸ”¢ æ•°å­—æ•°æ®å¤„ç†å™¨  
class NumberProcessor(DataProcessor):
    def validate_item(self, item):
        try:
            float(item)
            return True
        except ValueError:
            return False
    
    def process_item(self, item):
        num = float(item)
        return {'åŸå€¼': item, 'å¹³æ–¹': num ** 2, 'ç«‹æ–¹': num ** 3}

# ä½¿ç”¨ç¤ºä¾‹
csv_processor = CSVProcessor("CSVå¤„ç†å™¨")
csv_data = ["name,age,city", "Alice,25,Beijing", "invalid_data", "Bob,30,Shanghai"]
csv_results = csv_processor.process_batch(csv_data)

number_processor = NumberProcessor("æ•°å­—å¤„ç†å™¨")
number_data = ["1", "2.5", "abc", "4", "5.7"]
number_results = number_processor.process_batch(number_data)

print("CSVå¤„ç†ç»“æœ:")
for result in csv_results:
    print(f"  {result}")
print(csv_processor.get_stats())

print("\næ•°å­—å¤„ç†ç»“æœ:")
for result in number_results:
    print(f"  {result}")
print(number_processor.get_stats())
```

**ğŸ“š æ¨¡æ¿æ–¹æ³•æ¨¡å¼**
- **process_batch**æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œå®šä¹‰äº†å¤„ç†çš„æµç¨‹
- **process_item**å’Œ**validate_item**æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å…·ä½“å®ç°
- è¿™æ ·æ—¢ä¿è¯äº†ç»Ÿä¸€çš„å¤„ç†æµç¨‹ï¼Œåˆå…è®¸ä¸åŒçš„å…·ä½“å®ç°

### 4.4 æŠ½è±¡å±æ€§å’Œç±»æ–¹æ³•


**ğŸ”¸ æŠ½è±¡å±æ€§ç¤ºä¾‹**
```python
from abc import ABC, abstractmethod

class Shape(ABC):
    """å›¾å½¢æŠ½è±¡åŸºç±»"""
    
    @property
    @abstractmethod
    def area(self):
        """é¢ç§¯å±æ€§ï¼ˆå¿…é¡»å®ç°ï¼‰"""
        pass
    
    @property  
    @abstractmethod
    def perimeter(self):
        """å‘¨é•¿å±æ€§ï¼ˆå¿…é¡»å®ç°ï¼‰"""
        pass
    
    @abstractmethod
    def draw(self):
        """ç»˜åˆ¶æ–¹æ³•ï¼ˆå¿…é¡»å®ç°ï¼‰"""
        pass
    
    # é€šç”¨æ–¹æ³•
    def describe(self):
        return f"è¿™æ˜¯ä¸€ä¸ªé¢ç§¯ä¸º{self.area}ï¼Œå‘¨é•¿ä¸º{self.perimeter}çš„å›¾å½¢"

class Rectangle(Shape):
    def __init__(self, width, height):
        self.width = width
        self.height = height
    
    @property
    def area(self):
        return self.width * self.height
    
    @property
    def perimeter(self):
        return 2 * (self.width + self.height)
    
    def draw(self):
        return f"ç»˜åˆ¶{self.width}x{self.height}çš„çŸ©å½¢"

# ä½¿ç”¨ç¤ºä¾‹
rect = Rectangle(5, 3)
print(rect.describe())  # è¾“å‡ºï¼šè¿™æ˜¯ä¸€ä¸ªé¢ç§¯ä¸º15ï¼Œå‘¨é•¿ä¸º16çš„å›¾å½¢
print(rect.draw())      # è¾“å‡ºï¼šç»˜åˆ¶5x3çš„çŸ©å½¢
```

---

## 5. ğŸª è™šæ‹Ÿå­ç±»æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯è™šæ‹Ÿå­ç±»ï¼Ÿ


**ğŸ­ è™šæ‹Ÿå­ç±»çš„æ¦‚å¿µ**
è™šæ‹Ÿå­ç±»å…è®¸æˆ‘ä»¬**ä¸ä¿®æ”¹ç°æœ‰ç±»çš„æƒ…å†µä¸‹**ï¼Œè®©å®ƒ"è¡¨ç°å¾—åƒ"æŸä¸ªæŠ½è±¡åŸºç±»çš„å­ç±»ã€‚

**ğŸ¯ åº”ç”¨åœºæ™¯**
å½“ä½ æœ‰ä¸€ä¸ª**ç¬¬ä¸‰æ–¹åº“çš„ç±»**ï¼Œå®ƒå·²ç»å…·å¤‡äº†æŸä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†ä¸æ˜¯ä»é‚£ä¸ªæ¥å£ç»§æ‰¿çš„ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨è™šæ‹Ÿå­ç±»ã€‚

### 5.2 è™šæ‹Ÿå­ç±»å®æˆ˜ç¤ºä¾‹


**ğŸ”¸ åŸºç¡€è™šæ‹Ÿå­ç±»ä½¿ç”¨**
```python
from abc import ABC, abstractmethod

# ğŸŒŸ å®šä¹‰æŠ½è±¡åŸºç±»
class Serializable(ABC):
    """å¯åºåˆ—åŒ–æ¥å£"""
    
    @abstractmethod
    def serialize(self):
        """åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²"""
        pass
    
    @abstractmethod
    def deserialize(self, data):
        """ä»å­—ç¬¦ä¸²ååºåˆ—åŒ–"""
        pass

# ğŸ“š ç°æœ‰çš„ç¬¬ä¸‰æ–¹ç±»ï¼ˆæˆ‘ä»¬ä¸èƒ½ä¿®æ”¹ï¼‰
class ExistingUser:
    """å‡è®¾è¿™æ˜¯ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç”¨æˆ·ç±»"""
    def __init__(self, name, email):
        self.name = name
        self.email = email
    
    def serialize(self):
        return f"{self.name}|{self.email}"
    
    def deserialize(self, data):
        name, email = data.split('|')
        self.name = name
        self.email = email
        return self

# ğŸ­ æ³¨å†Œä¸ºè™šæ‹Ÿå­ç±»
Serializable.register(ExistingUser)

# ğŸ§ª æµ‹è¯•è™šæ‹Ÿå­ç±»
def save_object(obj: Serializable):
    """ä¿å­˜å¯åºåˆ—åŒ–å¯¹è±¡"""
    if isinstance(obj, Serializable):
        data = obj.serialize()
        print(f"ä¿å­˜æ•°æ®: {data}")
        return data
    else:
        raise TypeError("å¯¹è±¡å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„")

# ä½¿ç”¨ç¤ºä¾‹
user = ExistingUser("å¼ ä¸‰", "zhangsan@example.com")

# âœ… ExistingUserç°åœ¨è¢«è®¤ä¸ºæ˜¯Serializableçš„å­ç±»
print(isinstance(user, Serializable))  # è¾“å‡º: True
print(issubclass(ExistingUser, Serializable))  # è¾“å‡º: True

# âœ… å¯ä»¥æ­£å¸¸ä½¿ç”¨
save_object(user)  # è¾“å‡º: ä¿å­˜æ•°æ®: å¼ ä¸‰|zhangsan@example.com
```

**ğŸ’¡ å…³é”®ç†è§£**
- **ExistingUser**æ²¡æœ‰ç»§æ‰¿**Serializable**
- ä½†é€šè¿‡**register()**ï¼Œå®ƒè¢«"è®¤ä¸º"æ˜¯**Serializable**çš„å­ç±»
- **isinstance**å’Œ**issubclass**éƒ½è¿”å›**True**

### 5.3 è£…é¥°å™¨æ–¹å¼çš„è™šæ‹Ÿå­ç±»


**ğŸ¨ ä½¿ç”¨è£…é¥°å™¨æ³¨å†Œ**
```python
from abc import ABC, abstractmethod

class Drawable(ABC):
    """å¯ç»˜åˆ¶æ¥å£"""
    
    @abstractmethod
    def draw(self, canvas):
        pass
    
    @abstractmethod
    def get_size(self):
        pass

# ğŸ¯ ä½¿ç”¨è£…é¥°å™¨æ³¨å†Œè™šæ‹Ÿå­ç±»
@Drawable.register
class ThirdPartyImage:
    """ç¬¬ä¸‰æ–¹å›¾ç‰‡ç±»"""
    def __init__(self, path, width, height):
        self.path = path
        self.width = width
        self.height = height
    
    def draw(self, canvas):
        return f"åœ¨{canvas}ä¸Šç»˜åˆ¶å›¾ç‰‡: {self.path}"
    
    def get_size(self):
        return (self.width, self.height)

@Drawable.register
class ThirdPartyText:
    """ç¬¬ä¸‰æ–¹æ–‡æœ¬ç±»"""
    def __init__(self, content, font_size):
        self.content = content
        self.font_size = font_size
    
    def draw(self, canvas):
        return f"åœ¨{canvas}ä¸Šç»˜åˆ¶æ–‡æœ¬: {self.content}"
    
    def get_size(self):
        # ç®€å•ä¼°ç®—æ–‡æœ¬å¤§å°
        return (len(self.content) * self.font_size, self.font_size)

# ğŸ–¼ï¸ é€šç”¨ç»˜åˆ¶åŠŸèƒ½
def render_all(objects, canvas="ç”»å¸ƒ"):
    """æ¸²æŸ“æ‰€æœ‰å¯ç»˜åˆ¶å¯¹è±¡"""
    for obj in objects:
        if isinstance(obj, Drawable):
            print(obj.draw(canvas))
            size = obj.get_size()
            print(f"  å°ºå¯¸: {size[0]}x{size[1]}")
        else:
            print(f"è·³è¿‡ä¸å¯ç»˜åˆ¶å¯¹è±¡: {obj}")

# ä½¿ç”¨ç¤ºä¾‹
image = ThirdPartyImage("logo.png", 100, 50)
text = ThirdPartyText("Hello World", 16)
invalid_obj = "è¿™ä¸æ˜¯å¯ç»˜åˆ¶å¯¹è±¡"

render_all([image, text, invalid_obj])
```

### 5.4 è™šæ‹Ÿå­ç±»çš„æœ€ä½³å®è·µ


**âœ… ä½•æ—¶ä½¿ç”¨è™šæ‹Ÿå­ç±»**

| åœºæ™¯ | æ˜¯å¦é€‚ç”¨ | è¯´æ˜ |
|------|----------|------|
| **ç¬¬ä¸‰æ–¹åº“ç±»** | âœ… é€‚ç”¨ | æ— æ³•ä¿®æ”¹æºç æ—¶çš„å¥½é€‰æ‹© |
| **å†…ç½®ç±»å‹** | âœ… é€‚ç”¨ | è®©å†…ç½®ç±»å‹ç¬¦åˆè‡ªå®šä¹‰æ¥å£ |
| **è‡ªå·±çš„ç±»** | âŒ ä¸å»ºè®® | ç›´æ¥ç»§æ‰¿æ›´æ¸…æ™° |
| **éœ€è¦å¤šé‡ç»§æ‰¿** | âœ… é€‚ç”¨ | é¿å…å¤æ‚çš„ç»§æ‰¿å…³ç³» |

**ğŸ”¸ å†…ç½®ç±»å‹çš„è™šæ‹Ÿå­ç±»ç¤ºä¾‹**
```python
from abc import ABC, abstractmethod

class Container(ABC):
    """å®¹å™¨æ¥å£"""
    
    @abstractmethod
    def add_item(self, item):
        pass
    
    @abstractmethod
    def remove_item(self, item):
        pass
    
    @abstractmethod
    def get_count(self):
        pass

# ğŸ¯ è®©å†…ç½®çš„listæˆä¸ºContainerçš„è™šæ‹Ÿå­ç±»
Container.register(list)

# ä¸ºlistæ·»åŠ æ¥å£æ–¹æ³•ï¼ˆé€šè¿‡çŒ´å­è¡¥ä¸ï¼‰
list.add_item = lambda self, item: self.append(item)
list.remove_item = lambda self, item: self.remove(item) if item in self else None
list.get_count = lambda self: len(self)

# æµ‹è¯•
def manage_container(container: Container):
    """ç®¡ç†å®¹å™¨"""
    print(f"å®¹å™¨ç±»å‹: {type(container).__name__}")
    container.add_item("æ–°é¡¹ç›®")
    print(f"æ·»åŠ åæ•°é‡: {container.get_count()}")

my_list = [1, 2, 3]
manage_container(my_list)  # æ­£å¸¸å·¥ä½œ
print(my_list)  # è¾“å‡º: [1, 2, 3, 'æ–°é¡¹ç›®']
```

---

## 6. ğŸ“ åè®®Protocolè¯¦è§£


### 6.1 Protocolæ˜¯ä»€ä¹ˆï¼Ÿ


**ğŸ¯ Protocolçš„æ¦‚å¿µ**
Protocolæ˜¯Python 3.8å¼•å…¥çš„**ç»“æ„åŒ–å­ç±»å‹**ï¼ˆStructural Subtypingï¼‰æœºåˆ¶ï¼Œä¹Ÿå«**é™æ€é¸­å­ç±»å‹**ã€‚

**ğŸ”¸ ä¸ABCçš„åŒºåˆ«**
```
ABC (æŠ½è±¡åŸºç±»):
- éœ€è¦æ˜¾å¼ç»§æ‰¿æˆ–æ³¨å†Œ
- è¿è¡Œæ—¶æ£€æŸ¥
- "åä¹‰å­ç±»å‹" (Nominal Subtyping)

Protocol:
- ä¸éœ€è¦æ˜¾å¼ç»§æ‰¿
- é™æ€ç±»å‹æ£€æŸ¥
- "ç»“æ„åŒ–å­ç±»å‹" (Structural Subtyping)
```

### 6.2 ProtocolåŸºç¡€ä½¿ç”¨


**ğŸŒŸ åŸºç¡€Protocolç¤ºä¾‹**
```python
from typing import Protocol

# ğŸ¯ å®šä¹‰åè®®
class Drawable(Protocol):
    """å¯ç»˜åˆ¶åè®®"""
    def draw(self, canvas: str) -> str:
        """ç»˜åˆ¶æ–¹æ³•"""
        ...
    
    def get_area(self) -> float:
        """è·å–é¢ç§¯"""
        ...

# ğŸŸ¦ çŸ©å½¢ç±»ï¼ˆä¸éœ€è¦ç»§æ‰¿Drawableï¼‰
class Rectangle:
    def __init__(self, width: float, height: float):
        self.width = width
        self.height = height
    
    def draw(self, canvas: str) -> str:
        return f"åœ¨{canvas}ä¸Šç»˜åˆ¶çŸ©å½¢: {self.width}x{self.height}"
    
    def get_area(self) -> float:
        return self.width * self.height

# â­• åœ†å½¢ç±»ï¼ˆä¹Ÿä¸éœ€è¦ç»§æ‰¿Drawableï¼‰
class Circle:
    def __init__(self, radius: float):
        self.radius = radius
    
    def draw(self, canvas: str) -> str:
        return f"åœ¨{canvas}ä¸Šç»˜åˆ¶åœ†å½¢: åŠå¾„{self.radius}"
    
    def get_area(self) -> float:
        return 3.14159 * self.radius ** 2

# ğŸ¨ ä½¿ç”¨åè®®çš„å‡½æ•°
def render_shape(shape: Drawable, canvas: str = "ç”»å¸ƒ") -> None:
    """æ¸²æŸ“å›¾å½¢"""
    print(shape.draw(canvas))
    print(f"é¢ç§¯: {shape.get_area()}")

# ä½¿ç”¨ç¤ºä¾‹
rect = Rectangle(5, 3)
circle = Circle(2)

render_shape(rect)    # âœ… æ­£å¸¸å·¥ä½œ
render_shape(circle)  # âœ… æ­£å¸¸å·¥ä½œ
```

**ğŸ’¡ Protocolçš„ä¼˜åŠ¿**
- **æ— éœ€ç»§æ‰¿**ï¼šç±»åªè¦æœ‰å¯¹åº”æ–¹æ³•å°±ç¬¦åˆåè®®
- **ç±»å‹å®‰å…¨**ï¼šmypyç­‰å·¥å…·å¯ä»¥é™æ€æ£€æŸ¥
- **çµæ´»æ€§**ï¼šæ›´ç¬¦åˆPythonçš„é¸­å­ç±»å‹å“²å­¦

### 6.3 è¿è¡Œæ—¶åè®®æ£€æŸ¥


**ğŸ”¸ runtime_checkableè£…é¥°å™¨**
```python
from typing import Protocol, runtime_checkable

@runtime_checkable
class Serializable(Protocol):
    """å¯åºåˆ—åŒ–åè®®"""
    def serialize(self) -> str:
        """åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²"""
        ...
    
    def deserialize(self, data: str) -> None:
        """ä»å­—ç¬¦ä¸²ååºåˆ—åŒ–"""
        ...

# ğŸ“± ç”¨æˆ·ç±»
class User:
    def __init__(self, name: str, age: int):
        self.name = name
        self.age = age
    
    def serialize(self) -> str:
        return f"{self.name},{self.age}"
    
    def deserialize(self, data: str) -> None:
        parts = data.split(',')
        self.name = parts[0]
        self.age = int(parts[1])

# ğŸ“¦ äº§å“ç±»
class Product:
    def __init__(self, name: str, price: float):
        self.name = name
        self.price = price
    
    def serialize(self) -> str:
        return f"{self.name}:{self.price}"
    
    def deserialize(self, data: str) -> None:
        parts = data.split(':')
        self.name = parts[0]
        self.price = float(parts[1])

# ğŸ§ª è¿è¡Œæ—¶æ£€æŸ¥
def save_to_file(obj, filename: str):
    """ä¿å­˜å¯¹è±¡åˆ°æ–‡ä»¶"""
    if isinstance(obj, Serializable):
        data = obj.serialize()
        print(f"ä¿å­˜åˆ°{filename}: {data}")
    else:
        print(f"å¯¹è±¡{type(obj).__name__}ä¸æ”¯æŒåºåˆ—åŒ–")

# ä½¿ç”¨ç¤ºä¾‹
user = User("Alice", 25)
product = Product("æ‰‹æœº", 2999.99)
invalid = [1, 2, 3]  # åˆ—è¡¨ä¸æ”¯æŒæˆ‘ä»¬çš„åºåˆ—åŒ–åè®®

save_to_file(user, "user.txt")      # âœ… æ­£å¸¸ä¿å­˜
save_to_file(product, "product.txt") # âœ… æ­£å¸¸ä¿å­˜
save_to_file(invalid, "invalid.txt") # âŒ æç¤ºä¸æ”¯æŒ
```

### 6.4 åè®®çš„ç»§æ‰¿å’Œç»„åˆ


**ğŸ”§ åè®®ç»§æ‰¿ç¤ºä¾‹**
```python
from typing import Protocol

# ğŸ”¸ åŸºç¡€åè®®
class Readable(Protocol):
    def read(self) -> str:
        ...

class Writable(Protocol):
    def write(self, data: str) -> None:
        ...

# ğŸ”¸ ç»„åˆåè®®
class ReadWritable(Readable, Writable, Protocol):
    """å¯è¯»å†™åè®®"""
    pass

# ğŸ”¸ æ‰©å±•åè®®
class Seekable(ReadWritable, Protocol):
    """å¯å¯»å€çš„è¯»å†™åè®®"""
    def seek(self, position: int) -> None:
        ...

# ğŸ“„ æ–‡ä»¶ç±»å®ç°
class SimpleFile:
    def __init__(self, content: str = ""):
        self.content = content
        self.position = 0
    
    def read(self) -> str:
        return self.content[self.position:]
    
    def write(self, data: str) -> None:
        self.content += data
    
    def seek(self, position: int) -> None:
        self.position = max(0, min(position, len(self.content)))

# ğŸ§ª ä½¿ç”¨ä¸åŒçº§åˆ«çš„åè®®
def simple_read(readable: Readable) -> str:
    """åªéœ€è¦è¯»åŠŸèƒ½"""
    return readable.read()

def backup_data(rw: ReadWritable) -> None:
    """éœ€è¦è¯»å†™åŠŸèƒ½"""
    data = rw.read()
    rw.write(f"\nå¤‡ä»½æ—¶é—´: {data}")

def advanced_operation(seekable: Seekable) -> None:
    """éœ€è¦å¯»å€åŠŸèƒ½"""
    seekable.seek(0)
    content = seekable.read()
    seekable.write(f"é•¿åº¦: {len(content)}")

# ä½¿ç”¨ç¤ºä¾‹
file = SimpleFile("åŸå§‹å†…å®¹")

simple_read(file)      # âœ… åªç”¨è¯»åŠŸèƒ½
backup_data(file)      # âœ… ç”¨è¯»å†™åŠŸèƒ½  
advanced_operation(file) # âœ… ç”¨å…¨éƒ¨åŠŸèƒ½
```

---

## 7. ğŸ” ç±»å‹æ£€æŸ¥ä¸å¤šæ€ç»“åˆ


### 7.1 é™æ€ç±»å‹æ£€æŸ¥çš„ä»·å€¼


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹æ£€æŸ¥ï¼Ÿ**
è™½ç„¶Pythonæ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œä½†åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œ**é™æ€ç±»å‹æ£€æŸ¥**èƒ½å¸®æˆ‘ä»¬ï¼š

```
âœ… ä¼˜åŠ¿:
- æå‰å‘ç°ç±»å‹é”™è¯¯
- æé«˜ä»£ç å¯è¯»æ€§
- æ›´å¥½çš„IDEæ”¯æŒ
- å‡å°‘è¿è¡Œæ—¶é”™è¯¯

ğŸ¤” æŒ‘æˆ˜:
- ä¿æŒPythonçš„çµæ´»æ€§
- ä¸å¤šæ€æœºåˆ¶åè°ƒ
- ä¸å¢åŠ è¿‡å¤šå¤æ‚æ€§
```

### 7.2 å¤šæ€ä¸ç±»å‹æ³¨è§£


**ğŸ”¸ åŸºç¡€ç±»å‹æ³¨è§£**
```python
from typing import Union, List, Protocol
from abc import ABC, abstractmethod

# ğŸ¯ å®šä¹‰å±‚æ¬¡ç»“æ„
class Animal(ABC):
    @abstractmethod
    def make_sound(self) -> str:
        pass

class Dog(Animal):
    def make_sound(self) -> str:
        return "æ±ªæ±ªæ±ª"

class Cat(Animal):
    def make_sound(self) -> str:
        return "å–µå–µå–µ"

# ğŸ”¸ å¤šæ€å‡½æ•°çš„ç±»å‹æ³¨è§£
def animal_concert(animals: List[Animal]) -> List[str]:
    """åŠ¨ç‰©éŸ³ä¹ä¼š - æ¥å—Animalçš„å­ç±»åˆ—è¡¨"""
    sounds = []
    for animal in animals:
        sounds.append(animal.make_sound())
    return sounds

# ğŸ§ª ç±»å‹å®‰å…¨çš„ä½¿ç”¨
pets: List[Animal] = [Dog(), Cat(), Dog()]
concert_sounds: List[str] = animal_concert(pets)
print(concert_sounds)  # ['æ±ªæ±ªæ±ª', 'å–µå–µå–µ', 'æ±ªæ±ªæ±ª']
```

**ğŸ”¸ Unionç±»å‹å¤„ç†å¤šæ€**
```python
from typing import Union

# ğŸ® ä¸åŒçš„æ¸¸æˆè§’è‰²
class Warrior:
    def __init__(self, name: str):
        self.name = name
        self.hp = 100
        self.attack_power = 20
    
    def attack(self) -> str:
        return f"{self.name}æŒ¥å‰‘æ”»å‡»ï¼Œé€ æˆ{self.attack_power}ç‚¹ä¼¤å®³"

class Mage:
    def __init__(self, name: str):
        self.name = name
        self.hp = 80
        self.magic_power = 30
    
    def attack(self) -> str:
        return f"{self.name}æ–½æ”¾é­”æ³•ï¼Œé€ æˆ{self.magic_power}ç‚¹ä¼¤å®³"

class Archer:
    def __init__(self, name: str):
        self.name = name
        self.hp = 90
        self.arrow_power = 25
    
    def attack(self) -> str:
        return f"{self.name}å°„ç®­æ”»å‡»ï¼Œé€ æˆ{self.arrow_power}ç‚¹ä¼¤å®³"

# ğŸ¯ è”åˆç±»å‹å®šä¹‰
GameCharacter = Union[Warrior, Mage, Archer]

def character_battle(char1: GameCharacter, char2: GameCharacter) -> str:
    """è§’è‰²å¯¹æˆ˜"""
    result = []
    result.append(f"æˆ˜æ–—å¼€å§‹: {char1.name} VS {char2.name}")
    result.append(char1.attack())
    result.append(char2.attack())
    
    # ç±»å‹æ£€æŸ¥å’Œç‰¹æ®Šå¤„ç†
    if isinstance(char1, Mage) and isinstance(char2, Warrior):
        result.append("é­”æ³•å¸ˆå¯¹æˆ˜å£«æœ‰ä¼˜åŠ¿ï¼")
    elif isinstance(char1, Warrior) and isinstance(char2, Archer):
        result.append("æˆ˜å£«å¯¹å¼“ç®­æ‰‹æœ‰ä¼˜åŠ¿ï¼")
    
    return "\n".join(result)

# ä½¿ç”¨ç¤ºä¾‹
warrior = Warrior("äºšç‘Ÿ")
mage = Mage("æ¢…æ—")
archer = Archer("ç½—å®¾")

print(character_battle(warrior, mage))
print("\n" + "="*30 + "\n")
print(character_battle(archer, warrior))
```

### 7.3 æ³›å‹ä¸å¤šæ€


**ğŸ”§ æ³›å‹åœ¨å¤šæ€ä¸­çš„åº”ç”¨**
```python
from typing import TypeVar, Generic, List, Protocol

# ğŸ¯ å®šä¹‰æ³›å‹ç±»å‹
T = TypeVar('T')

class Comparable(Protocol):
    """å¯æ¯”è¾ƒåè®®"""
    def __lt__(self, other) -> bool:
        ...

class Container(Generic[T]):
    """æ³›å‹å®¹å™¨"""
    def __init__(self):
        self._items: List[T] = []
    
    def add(self, item: T) -> None:
        self._items.append(item)
    
    def get_all(self) -> List[T]:
        return self._items.copy()
    
    def get_count(self) -> int:
        return len(self._items)

class SortedContainer(Container[T]):
    """æ’åºå®¹å™¨"""
    def add(self, item: T) -> None:
        super().add(item)
        if hasattr(item, '__lt__'):
            self._items.sort()
    
    def get_min(self) -> T:
        if not self._items:
            raise ValueError("å®¹å™¨ä¸ºç©º")
        return self._items[0]
    
    def get_max(self) -> T:
        if not self._items:
            raise ValueError("å®¹å™¨ä¸ºç©º")
        return self._items[-1]

# ğŸ”¢ æ•°å­—å®¹å™¨ä½¿ç”¨
number_container: SortedContainer[int] = SortedContainer()
number_container.add(3)
number_container.add(1)
number_container.add(4)
number_container.add(2)

print("æ•°å­—å®¹å™¨:")
print(f"æ‰€æœ‰æ•°å­—: {number_container.get_all()}")
print(f"æœ€å°å€¼: {number_container.get_min()}")
print(f"æœ€å¤§å€¼: {number_container.get_max()}")

# ğŸ“ å­—ç¬¦ä¸²å®¹å™¨ä½¿ç”¨
string_container: SortedContainer[str] = SortedContainer()
string_container.add("banana")
string_container.add("apple") 
string_container.add("cherry")

print("\nå­—ç¬¦ä¸²å®¹å™¨:")
print(f"æ‰€æœ‰å­—ç¬¦ä¸²: {string_container.get_all()}")
print(f"æœ€å°å€¼: {string_container.get_min()}")
print(f"æœ€å¤§å€¼: {string_container.get_max()}")
```

### 7.4 ç±»å‹æ£€æŸ¥æœ€ä½³å®è·µ


**âœ… å¤šæ€ç±»å‹æ³¨è§£æœ€ä½³å®è·µ**

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç¤ºä¾‹ |
|------|----------|------|
| **ç»§æ‰¿å±‚æ¬¡** | ä½¿ç”¨åŸºç±»ç±»å‹ | `def process(animal: Animal)` |
| **å¤šç§å¯èƒ½** | ä½¿ç”¨Unionç±»å‹ | `Union[str, int, float]` |
| **ç»“æ„ç›¸ä¼¼** | ä½¿ç”¨Protocol | `def save(obj: Serializable)` |
| **æ³›å‹å®¹å™¨** | ä½¿ç”¨TypeVar | `Container[T]` |
| **å¯é€‰ç±»å‹** | ä½¿ç”¨Optional | `Optional[str]` |

**ğŸ”¸ å®é™…é¡¹ç›®ç¤ºä¾‹**
```python
from typing import Protocol, Optional, Union, List
from abc import ABC, abstractmethod

# ğŸ¯ å®šä¹‰æ¸…æ™°çš„æ¥å£
class Validator(Protocol):
    def validate(self, value: str) -> bool:
        ...
    
    def get_error_message(self) -> str:
        ...

class EmailValidator:
    def validate(self, value: str) -> bool:
        return "@" in value and "." in value
    
    def get_error_message(self) -> str:
        return "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"

class PhoneValidator:
    def validate(self, value: str) -> bool:
        return value.isdigit() and len(value) == 11
    
    def get_error_message(self) -> str:
        return "æ‰‹æœºå·å¿…é¡»æ˜¯11ä½æ•°å­—"

# ğŸ”§ è¡¨å•å¤„ç†å™¨
class FormField:
    def __init__(self, name: str, value: str = "", 
                 validators: Optional[List[Validator]] = None):
        self.name = name
        self.value = value
        self.validators = validators or []
        self.errors: List[str] = []
    
    def validate(self) -> bool:
        """éªŒè¯å­—æ®µå€¼"""
        self.errors.clear()
        for validator in self.validators:
            if not validator.validate(self.value):
                self.errors.append(validator.get_error_message())
        return len(self.errors) == 0
    
    def is_valid(self) -> bool:
        return len(self.errors) == 0

# ğŸ“‹ è¡¨å•ç±»
class Form:
    def __init__(self):
        self.fields: List[FormField] = []
    
    def add_field(self, field: FormField) -> None:
        self.fields.append(field)
    
    def validate_all(self) -> bool:
        """éªŒè¯æ‰€æœ‰å­—æ®µ"""
        all_valid = True
        for field in self.fields:
            if not field.validate():
                all_valid = False
        return all_valid
    
    def get_errors(self) -> dict:
        """è·å–æ‰€æœ‰é”™è¯¯"""
        errors = {}
        for field in self.fields:
            if field.errors:
                errors[field.name] = field.errors
        return errors

# ä½¿ç”¨ç¤ºä¾‹
form = Form()

# æ·»åŠ é‚®ç®±å­—æ®µ
email_field = FormField("email", "invalid_email", [EmailValidator()])
form.add_field(email_field)

# æ·»åŠ æ‰‹æœºå­—æ®µ
phone_field = FormField("phone", "12345", [PhoneValidator()])
form.add_field(phone_field)

# éªŒè¯è¡¨å•
if form.validate_all():
    print("è¡¨å•éªŒè¯é€šè¿‡")
else:
    print("è¡¨å•éªŒè¯å¤±è´¥:")
    for field_name, field_errors in form.get_errors().items():
        print(f"  {field_name}: {', '.join(field_errors)}")
```

---

## 8. ğŸ¨ å¤šæ€è®¾è®¡æ¨¡å¼å®è·µ


### 8.1 ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰


**ğŸ¯ ç­–ç•¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³**
å°†ä¸åŒçš„ç®—æ³•å°è£…æˆç‹¬ç«‹çš„ç­–ç•¥ç±»ï¼Œè®©å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä½¿ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ç«¯ã€‚

**ğŸ”¸ ç”µå•†æŠ˜æ‰£ç­–ç•¥ç¤ºä¾‹**
```python
from abc import ABC, abstractmethod
from typing import List

# ğŸ¯ æŠ½è±¡ç­–ç•¥æ¥å£
class DiscountStrategy(ABC):
    """æŠ˜æ‰£ç­–ç•¥æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def calculate_discount(self, order_amount: float, customer_level: str) -> float:
        """è®¡ç®—æŠ˜æ‰£é‡‘é¢"""
        pass
    
    @abstractmethod
    def get_description(self) -> str:
        """è·å–ç­–ç•¥æè¿°"""
        pass

# ğŸŠ æ™®é€šæŠ˜æ‰£ç­–ç•¥
class RegularDiscount(DiscountStrategy):
    def calculate_discount(self, order_amount: float, customer_level: str) -> float:
        if order_amount >= 100:
            return order_amount * 0.05  # 5%æŠ˜æ‰£
        return 0
    
    def get_description(self) -> str:
        return "æ»¡100å…ƒäº«å—5%æŠ˜æ‰£"

# ğŸ ä¼šå‘˜æŠ˜æ‰£ç­–ç•¥  
class VIPDiscount(DiscountStrategy):
    def calculate_discount(self, order_amount: float, customer_level: str) -> float:
        base_discount = order_amount * 0.1  # åŸºç¡€10%æŠ˜æ‰£
        if customer_level == "é‡‘ç‰Œä¼šå‘˜":
            return base_discount + order_amount * 0.05  # é¢å¤–5%
        elif customer_level == "é’»çŸ³ä¼šå‘˜":
            return base_discount + order_amount * 0.1   # é¢å¤–10%
        return base_discount
    
    def get_description(self) -> str:
        return "VIPä¼šå‘˜10%èµ·æŠ˜æ‰£ï¼Œé‡‘ç‰Œ+5%ï¼Œé’»çŸ³+10%"

# ğŸ‰ èŠ‚æ—¥ä¿ƒé”€ç­–ç•¥
class HolidayDiscount(DiscountStrategy):
    def __init__(self, holiday_rate: float):
        self.holiday_rate = holiday_rate
    
    def calculate_discount(self, order_amount: float, customer_level: str) -> float:
        return order_amount * self.holiday_rate
    
    def get_description(self) -> str:
        return f"èŠ‚æ—¥ç‰¹æƒ {self.holiday_rate*100}%æŠ˜æ‰£"

# ğŸ›’ è®¢å•å¤„ç†ç±»
class Order:
    def __init__(self, items: List[str], amount: float, customer_level: str = "æ™®é€š"):
        self.items = items
        self.amount = amount
        self.customer_level = customer_level
        self.discount_strategy: DiscountStrategy = RegularDiscount()
    
    def set_discount_strategy(self, strategy: DiscountStrategy) -> None:
        """è®¾ç½®æŠ˜æ‰£ç­–ç•¥"""
        self.discount_strategy = strategy
    
    def calculate_final_amount(self) -> dict:
        """è®¡ç®—æœ€ç»ˆé‡‘é¢"""
        discount = self.discount_strategy.calculate_discount(
            self.amount, self.customer_level
        )
        final_amount = self.amount - discount
        
        return {
            'åŸä»·': self.amount,
            'æŠ˜æ‰£': discount,
            'å®ä»˜': final_amount,
            'ç­–ç•¥': self.discount_strategy.get_description()
        }

# ğŸ§ª ä½¿ç”¨ç¤ºä¾‹
# åˆ›å»ºè®¢å•
order = Order(["æ‰‹æœº", "è€³æœº"], 1500, "é‡‘ç‰Œä¼šå‘˜")

print("=== ä¸åŒæŠ˜æ‰£ç­–ç•¥å¯¹æ¯” ===")

# ç­–ç•¥1ï¼šæ™®é€šæŠ˜æ‰£
order.set_discount_strategy(RegularDiscount())
result1 = order.calculate_final_amount()
print(f"æ™®é€šæŠ˜æ‰£: {result1}")

# ç­–ç•¥2ï¼šVIPæŠ˜æ‰£
order.set_discount_strategy(VIPDiscount())
result2 = order.calculate_final_amount()
print(f"VIPæŠ˜æ‰£: {result2}")

# ç­–ç•¥3ï¼šèŠ‚æ—¥ä¿ƒé”€
order.set_discount_strategy(HolidayDiscount(0.2))  # 20%æŠ˜æ‰£
result3 = order.calculate_final_amount()
print(f"èŠ‚æ—¥ä¿ƒé”€: {result3}")
```

### 8.2 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰


**ğŸ”¸ æ¶ˆæ¯æ¨é€ç³»ç»Ÿç¤ºä¾‹**
```python
from abc import ABC, abstractmethod
from typing import List, Any

# ğŸ¯ è§‚å¯Ÿè€…æ¥å£
class Observer(ABC):
    """è§‚å¯Ÿè€…æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def update(self, subject: 'Subject', data: Any) -> None:
        """æ¥æ”¶é€šçŸ¥æ›´æ–°"""
        pass

# ğŸ“¢ è¢«è§‚å¯Ÿè€…æ¥å£
class Subject(ABC):
    """è¢«è§‚å¯Ÿè€…æŠ½è±¡åŸºç±»"""
    
    def __init__(self):
        self._observers: List[Observer] = []
    
    def attach(self, observer: Observer) -> None:
        """æ·»åŠ è§‚å¯Ÿè€…"""
        if observer not in self._observers:
            self._observers.append(observer)
    
    def detach(self, observer: Observer) -> None:
        """ç§»é™¤è§‚å¯Ÿè€…"""
        if observer in self._observers:
            self._observers.remove(observer)
    
    def notify(self, data: Any) -> None:
        """é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…"""
        for observer in self._observers:
            observer.update(self, data)

# ğŸ“° æ–°é—»å‘å¸ƒç³»ç»Ÿ
class NewsPublisher(Subject):
    """æ–°é—»å‘å¸ƒè€…"""
    
    def __init__(self, name: str):
        super().__init__()
        self.name = name
        self.latest_news = ""
    
    def publish_news(self, news: str) -> None:
        """å‘å¸ƒæ–°é—»"""
        self.latest_news = news
        print(f"[{self.name}] å‘å¸ƒæ–°é—»: {news}")
        self.notify(news)

# ğŸ“± æ‰‹æœºç”¨æˆ·
class MobileUser(Observer):
    def __init__(self, name: str):
        self.name = name
    
    def update(self, subject: Subject, data: Any) -> None:
        print(f"ğŸ“± {self.name}æ”¶åˆ°æ‰‹æœºæ¨é€: {data}")

# ğŸ“§ é‚®ä»¶ç”¨æˆ·
class EmailUser(Observer):
    def __init__(self, email: str):
        self.email = email
    
    def update(self, subject: Subject, data: Any) -> None:
        print(f"ğŸ“§ å‘{self.email}å‘é€é‚®ä»¶: {data}")

# ğŸ”” çŸ­ä¿¡ç”¨æˆ·
class SMSUser(Observer):
    def __init__(self, phone: str):
        self.phone = phone
    
    def update(self, subject: Subject, data: Any) -> None:
        print(f"ğŸ“² å‘{self.phone}å‘é€çŸ­ä¿¡: {data}")

# ğŸ§ª ä½¿ç”¨ç¤ºä¾‹
# åˆ›å»ºæ–°é—»å‘å¸ƒè€…
tech_news = NewsPublisher("ç§‘æŠ€æ—¥æŠ¥")

# åˆ›å»ºä¸åŒç±»å‹çš„è®¢é˜…è€…
mobile_user1 = MobileUser("å¼ ä¸‰")
mobile_user2 = MobileUser("æå››")
email_user = EmailUser("wang@example.com")
sms_user = SMSUser("13800138000")

# è®¢é˜…æ–°é—»
tech_news.attach(mobile_user1)
tech_news.attach(mobile_user2)
tech_news.attach(email_user)
tech_news.attach(sms_user)

print("=== å‘å¸ƒç¬¬ä¸€æ¡æ–°é—» ===")
tech_news.publish_news("Python 3.12æ­£å¼å‘å¸ƒ!")

print("\n=== å–æ¶ˆéƒ¨åˆ†è®¢é˜… ===")
tech_news.detach(mobile_user2)
tech_news.detach(sms_user)

print("\n=== å‘å¸ƒç¬¬äºŒæ¡æ–°é—» ===")
tech_news.publish_news("AIæŠ€æœ¯å–å¾—é‡å¤§çªç ´!")
```

### 8.3 å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰


**ğŸ”¸ å›¾å½¢åˆ›å»ºå·¥å‚ç¤ºä¾‹**
```python
from abc import ABC, abstractmethod
from typing import Dict, Type
import math

# ğŸ¯ å›¾å½¢æŠ½è±¡åŸºç±»
class Shape(ABC):
    """å›¾å½¢æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def draw(self) -> str:
        pass
    
    @abstractmethod
    def calculate_area(self) -> float:
        pass

# ğŸŸ¦ çŸ©å½¢ç±»
class Rectangle(Shape):
    def __init__(self, width: float, height: float):
        self.width = width
        self.height = height
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶çŸ©å½¢: {self.width} x {self.height}"
    
    def calculate_area(self) -> float:
        return self.width * self.height

# â­• åœ†å½¢ç±»
class Circle(Shape):
    def __init__(self, radius: float):
        self.radius = radius
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶åœ†å½¢: åŠå¾„ {self.radius}"
    
    def calculate_area(self) -> float:
        return math.pi * self.radius ** 2

# ğŸ”º ä¸‰è§’å½¢ç±»
class Triangle(Shape):
    def __init__(self, base: float, height: float):
        self.base = base
        self.height = height
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶ä¸‰è§’å½¢: åº•è¾¹ {self.base}, é«˜ {self.height}"
    
    def calculate_area(self) -> float:
        return 0.5 * self.base * self.height

# ğŸ­ å›¾å½¢å·¥å‚
class ShapeFactory:
    """å›¾å½¢å·¥å‚ç±»"""
    
    # æ³¨å†Œå¯åˆ›å»ºçš„å›¾å½¢ç±»å‹
    _shapes: Dict[str, Type[Shape]] = {
        'rectangle': Rectangle,
        'circle': Circle,
        'triangle': Triangle
    }
    
    @classmethod
    def create_shape(cls, shape_type: str, **kwargs) -> Shape:
        """åˆ›å»ºå›¾å½¢å¯¹è±¡"""
        shape_type = shape_type.lower()
        
        if shape_type not in cls._shapes:
            available = ', '.join(cls._shapes.keys())
            raise ValueError(f"ä¸æ”¯æŒçš„å›¾å½¢ç±»å‹: {shape_type}. æ”¯æŒçš„ç±»å‹: {available}")
        
        shape_class = cls._shapes[shape_type]
        
        try:
            return shape_class(**kwargs)
        except TypeError as e:
            raise ValueError(f"åˆ›å»º{shape_type}æ—¶å‚æ•°é”™è¯¯: {e}")
    
    @classmethod
    def register_shape(cls, name: str, shape_class: Type[Shape]) -> None:
        """æ³¨å†Œæ–°çš„å›¾å½¢ç±»å‹"""
        cls._shapes[name.lower()] = shape_class
    
    @classmethod
    def get_available_shapes(cls) -> List[str]:
        """è·å–æ‰€æœ‰å¯ç”¨çš„å›¾å½¢ç±»å‹"""
        return list(cls._shapes.keys())

# ğŸ¨ å›¾å½¢ç®¡ç†å™¨
class DrawingApp:
    """ç»˜å›¾åº”ç”¨"""
    
    def __init__(self):
        self.shapes: List[Shape] = []
    
    def add_shape(self, shape_type: str, **kwargs) -> None:
        """æ·»åŠ å›¾å½¢"""
        try:
            shape = ShapeFactory.create_shape(shape_type, **kwargs)
            self.shapes.append(shape)
            print(f"âœ… æˆåŠŸæ·»åŠ : {shape.draw()}")
        except ValueError as e:
            print(f"âŒ æ·»åŠ å¤±è´¥: {e}")
    
    def draw_all(self) -> None:
        """ç»˜åˆ¶æ‰€æœ‰å›¾å½¢"""
        if not self.shapes:
            print("ç”»å¸ƒä¸ºç©º")
            return
        
        print("\n=== ç»˜åˆ¶æ‰€æœ‰å›¾å½¢ ===")
        total_area = 0
        for i, shape in enumerate(self.shapes, 1):
            area = shape.calculate_area()
            print(f"{i}. {shape.draw()}, é¢ç§¯: {area:.2f}")
            total_area += area
        print(f"æ€»é¢ç§¯: {total_area:.2f}")

# ğŸ§ª ä½¿ç”¨ç¤ºä¾‹
app = DrawingApp()

print("=== æ”¯æŒçš„å›¾å½¢ç±»å‹ ===")
print(ShapeFactory.get_available_shapes())

print("\n=== åˆ›å»ºå›¾å½¢ ===")
app.add_shape('rectangle', width=5, height=3)
app.add_shape('circle', radius=2)
app.add_shape('triangle', base=4, height=6)

# å°è¯•åˆ›å»ºä¸æ”¯æŒçš„å›¾å½¢
app.add_shape('pentagon', sides=5)

# å°è¯•åˆ›å»ºå‚æ•°é”™è¯¯çš„å›¾å½¢
app.add_shape('rectangle', width=5)  # ç¼ºå°‘heightå‚æ•°

# ç»˜åˆ¶æ‰€æœ‰å›¾å½¢
app.draw_all()

# æ³¨å†Œæ–°çš„å›¾å½¢ç±»å‹
class Pentagon(Shape):
    def __init__(self, side_length: float):
        self.side_length = side_length
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶äº”è¾¹å½¢: è¾¹é•¿ {self.side_length}"
    
    def calculate_area(self) -> float:
        # æ­£äº”è¾¹å½¢é¢ç§¯å…¬å¼
        return (5 * self.side_length ** 2) / (4 * math.tan(math.pi / 5))

# æ³¨å†Œæ–°å›¾å½¢
ShapeFactory.register_shape('pentagon', Pentagon)

print("\n=== æ³¨å†Œæ–°å›¾å½¢ç±»å‹å ===")
app.add_shape('pentagon', side_length=3)
app.draw_all()
```

### 8.4 å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰


**ğŸ”¸ æ–‡æœ¬ç¼–è¾‘å™¨å‘½ä»¤ç³»ç»Ÿ**
```python
from abc import ABC, abstractmethod
from typing import List, Optional

# ğŸ¯ å‘½ä»¤æ¥å£
class Command(ABC):
    """å‘½ä»¤æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def execute(self) -> None:
        """æ‰§è¡Œå‘½ä»¤"""
        pass
    
    @abstractmethod
    def undo(self) -> None:
        """æ’¤é”€å‘½ä»¤"""
        pass
    
    @abstractmethod
    def get_description(self) -> str:
        """è·å–å‘½ä»¤æè¿°"""
        pass

# ğŸ“ æ–‡æœ¬ç¼–è¾‘å™¨
class TextEditor:
    """æ–‡æœ¬ç¼–è¾‘å™¨"""
    
    def __init__(self):
        self.content = ""
        self.cursor_position = 0
    
    def insert_text(self, text: str, position: Optional[int] = None) -> None:
        """æ’å…¥æ–‡æœ¬"""
        if position is None:
            position = self.cursor_position
        
        self.content = (self.content[:position] + 
                       text + 
                       self.content[position:])
        self.cursor_position = position + len(text)
    
    def delete_text(self, start: int, length: int) -> str:
        """åˆ é™¤æ–‡æœ¬ï¼Œè¿”å›è¢«åˆ é™¤çš„å†…å®¹"""
        deleted = self.content[start:start + length]
        self.content = self.content[:start] + self.content[start + length:]
        self.cursor_position = start
        return deleted
    
    def get_content(self) -> str:
        """è·å–å½“å‰å†…å®¹"""
        return self.content
    
    def set_cursor(self, position: int) -> None:
        """è®¾ç½®å…‰æ ‡ä½ç½®"""
        self.cursor_position = max(0, min(position, len(self.content)))

# â• æ’å…¥æ–‡æœ¬å‘½ä»¤
class InsertTextCommand(Command):
    def __init__(self, editor: TextEditor, text: str, position: Optional[int] = None):
        self.editor = editor
        self.text = text
        self.position = position if position is not None else editor.cursor_position
        self.executed = False
    
    def execute(self) -> None:
        self.editor.insert_text(self.text, self.position)
        self.executed = True
    
    def undo(self) -> None:
        if self.executed:
            self.editor.delete_text(self.position, len(self.text))
            self.editor.set_cursor(self.position)
    
    def get_description(self) -> str:
        return f"æ’å…¥æ–‡æœ¬ '{self.text}' åœ¨ä½ç½® {self.position}"

# ğŸ—‘ï¸ åˆ é™¤æ–‡æœ¬å‘½ä»¤
class DeleteTextCommand(Command):
    def __init__(self, editor: TextEditor, start: int, length: int):
        self.editor = editor
        self.start = start
        self.length = length
        self.deleted_text = ""
        self.executed = False
    
    def execute(self) -> None:
        self.deleted_text = self.editor.delete_text(self.start, self.length)
        self.executed = True
    
    def undo(self) -> None:
        if self.executed:
            self.editor.insert_text(self.deleted_text, self.start)
    
    def get_description(self) -> str:
        preview = self.deleted_text[:10] + "..." if len(self.deleted_text) > 10 else self.deleted_text
        return f"åˆ é™¤æ–‡æœ¬ '{preview}' ä»ä½ç½® {self.start}"

# ğŸ”„ æ›¿æ¢æ–‡æœ¬å‘½ä»¤
class ReplaceTextCommand(Command):
    def __init__(self, editor: TextEditor, start: int, length: int, new_text: str):
        self.editor = editor
        self.start = start
        self.length = length
        self.new_text = new_text
        self.old_text = ""
        self.executed = False
    
    def execute(self) -> None:
        self.old_text = self.editor.delete_text(self.start, self.length)
        self.editor.insert_text(self.new_text, self.start)
        self.executed = True
    
    def undo(self) -> None:
        if self.executed:
            self.editor.delete_text(self.start, len(self.new_text))
            self.editor.insert_text(self.old_text, self.start)
    
    def get_description(self) -> str:
        return f"æ›¿æ¢ '{self.old_text}' ä¸º '{self.new_text}'"

# ğŸ® å‘½ä»¤ç®¡ç†å™¨
class CommandManager:
    """å‘½ä»¤ç®¡ç†å™¨ - æ”¯æŒæ’¤é”€/é‡åš"""
    
    def __init__(self):
        self.history: List[Command] = []
        self.current_index = -1
    
    def execute_command(self, command: Command) -> None:
        """æ‰§è¡Œå‘½ä»¤"""
        command.execute()
        
        # æ¸…é™¤å½“å‰ä½ç½®ä¹‹åçš„å†å²è®°å½•
        self.history = self.history[:self.current_index + 1]
        
        # æ·»åŠ æ–°å‘½ä»¤
        self.history.append(command)
        self.current_index += 1
        
        print(f"âœ… æ‰§è¡Œ: {command.get_description()}")
    
    def undo(self) -> bool:
        """æ’¤é”€å‘½ä»¤"""
        if self.current_index >= 0:
            command = self.history[self.current_index]
            command.undo()
            self.current_index -= 1
            print(f"â†¶ æ’¤é”€: {command.get_description()}")
            return True
        else:
            print("âŒ æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ")
            return False
    
    def redo(self) -> bool:
        """é‡åšå‘½ä»¤"""
        if self.current_index < len(self.history) - 1:
            self.current_index += 1
            command = self.history[self.current_index]
            command.execute()
            print(f"â†· é‡åš: {command.get_description()}")
            return True
        else:
            print("âŒ æ²¡æœ‰å¯é‡åšçš„æ“ä½œ")
            return False
    
    def get_history(self) -> List[str]:
        """è·å–å‘½ä»¤å†å²"""
        history = []
        for i, command in enumerate(self.history):
            marker = " â† å½“å‰" if i == self.current_index else ""
            history.append(f"{i+1}. {command.get_description()}{marker}")
        return history

# ğŸ“± æ–‡æœ¬ç¼–è¾‘åº”ç”¨
class TextEditorApp:
    """æ–‡æœ¬ç¼–è¾‘åº”ç”¨"""
    
    def __init__(self):
        self.editor = TextEditor()
        self.command_manager = CommandManager()
    
    def insert(self, text: str, position: Optional[int] = None) -> None:
        """æ’å…¥æ–‡æœ¬"""
        command = InsertTextCommand(self.editor, text, position)
        self.command_manager.execute_command(command)
    
    def delete(self, start: int, length: int) -> None:
        """åˆ é™¤æ–‡æœ¬"""
        command = DeleteTextCommand(self.editor, start, length)
        self.command_manager.execute_command(command)
    
    def replace(self, start: int, length: int, new_text: str) -> None:
        """æ›¿æ¢æ–‡æœ¬"""
        command = ReplaceTextCommand(self.editor, start, length, new_text)
        self.command_manager.execute_command(command)
    
    def undo(self) -> None:
        """æ’¤é”€"""
        self.command_manager.undo()
    
    def redo(self) -> None:
        """é‡åš"""
        self.command_manager.redo()
    
    def show_content(self) -> None:
        """æ˜¾ç¤ºå½“å‰å†…å®¹"""
        content = self.editor.get_content()
        cursor = self.editor.cursor_position
        
        print(f"\nğŸ“ å½“å‰å†…å®¹: '{content}'")
        print(f"   å…‰æ ‡ä½ç½®: {cursor}")
        if content:
            display = content[:cursor] + "|" + content[cursor:]
            print(f"   æ˜¾ç¤ºæ•ˆæœ: '{display}'")
    
    def show_history(self) -> None:
        """æ˜¾ç¤ºæ“ä½œå†å²"""
        print("\nğŸ“š æ“ä½œå†å²:")
        history = self.command_manager.get_history()
        if history:
            for item in history:
                print(f"   {item}")
        else:
            print("   æš‚æ— æ“ä½œè®°å½•")

# ğŸ§ª ä½¿ç”¨ç¤ºä¾‹
print("=== æ–‡æœ¬ç¼–è¾‘å™¨å‘½ä»¤æ¨¡å¼æ¼”ç¤º ===")

app = TextEditorApp()

# ä¸€ç³»åˆ—ç¼–è¾‘æ“ä½œ
print("\n--- æ‰§è¡Œç¼–è¾‘æ“ä½œ ---")
app.insert("Hello")
app.show_content()

app.insert(" World", 5)
app.show_content()

app.insert("!", 11)
app.show_content()

app.replace(6, 5, "Python")
app.show_content()

app.show_history()

# æ’¤é”€æ“ä½œ
print("\n--- æ’¤é”€æ“ä½œ ---")
app.undo()
app.show_content()

app.undo()
app.show_content()

# é‡åšæ“ä½œ
print("\n--- é‡åšæ“ä½œ ---")
app.redo()
app.show_content()

# æ–°çš„ç¼–è¾‘æ“ä½œ
print("\n--- æ–°æ“ä½œï¼ˆä¼šæ¸…é™¤åç»­å†å²ï¼‰---")
app.insert(" Programming", 12)
app.show_content()

app.show_history()
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¤šæ€æœºåˆ¶å¯¹æ¯”


**ğŸ” å„ç§å¤šæ€æœºåˆ¶çš„ç‰¹ç‚¹å¯¹æ¯”**

| æœºåˆ¶ | **å®ç°æ–¹å¼** | **æ£€æŸ¥æ—¶æœº** | **çµæ´»æ€§** | **ç±»å‹å®‰å…¨** | **é€‚ç”¨åœºæ™¯** |
|------|------------|-------------|-----------|-------------|-------------|
| **ç»§æ‰¿å¤šæ€** | `æ˜¾å¼ç»§æ‰¿åŸºç±»` | `è¿è¡Œæ—¶` | `ä¸­ç­‰` | `ä¸­ç­‰` | `æ˜ç¡®çš„å±‚æ¬¡å…³ç³»` |
| **é¸­å­ç±»å‹** | `çº¦å®šæ–¹æ³•å` | `è¿è¡Œæ—¶` | `æé«˜` | `è¾ƒä½` | `å¿«é€ŸåŸå‹ï¼Œç®€å•æ¥å£` |
| **ABCæŠ½è±¡åŸºç±»** | `ç»§æ‰¿ABC+è£…é¥°å™¨` | `åˆ›å»ºæ—¶` | `ä¸­ç­‰` | `è¾ƒé«˜` | `ä¸¥æ ¼çš„æ¥å£å®šä¹‰` |
| **Protocolåè®®** | `ç»“æ„åŒ–åŒ¹é…` | `é™æ€æ£€æŸ¥` | `é«˜` | `æœ€é«˜` | `ç±»å‹å®‰å…¨çš„é¸­å­ç±»å‹` |
| **è™šæ‹Ÿå­ç±»** | `registeræ³¨å†Œ` | `è¿è¡Œæ—¶` | `é«˜` | `ä¸­ç­‰` | `ç¬¬ä¸‰æ–¹ç±»é›†æˆ` |

### 9.2 å¤šæ€è®¾è®¡åŸåˆ™


**ğŸ¯ SOLIDåŸåˆ™åœ¨å¤šæ€ä¸­çš„ä½“ç°**

```
ğŸ”¸ å•ä¸€èŒè´£åŸåˆ™ (SRP)
æ¯ä¸ªç±»åªæœ‰ä¸€ä¸ªå˜åŒ–çš„ç†ç”±
ç¤ºä¾‹ï¼šæ”¯ä»˜å¤„ç†å™¨åªè´Ÿè´£æ”¯ä»˜ï¼Œä¸ç®¡ç†ç”¨æˆ·ä¿¡æ¯

ğŸ”¸ å¼€é—­åŸåˆ™ (OCP)  
å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
ç¤ºä¾‹ï¼šæ·»åŠ æ–°çš„æ”¯ä»˜æ–¹å¼ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 

ğŸ”¸ é‡Œæ°æ›¿æ¢åŸåˆ™ (LSP)
å­ç±»å¯¹è±¡å¯ä»¥æ›¿æ¢çˆ¶ç±»å¯¹è±¡
ç¤ºä¾‹ï¼šæ‰€æœ‰åŠ¨ç‰©éƒ½èƒ½make_sound()

ğŸ”¸ æ¥å£éš”ç¦»åŸåˆ™ (ISP)
ä¸è¦å¼ºè¿«ç±»ä¾èµ–ä¸éœ€è¦çš„æ¥å£
ç¤ºä¾‹ï¼šåªè¯»æ–‡ä»¶ä¸éœ€è¦å®ç°write()æ–¹æ³•

ğŸ”¸ ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
ä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°
ç¤ºä¾‹ï¼šå‡½æ•°æ¥å—Animalç±»å‹è€Œä¸æ˜¯Dogç±»å‹
```

### 9.3 å¤šæ€æœ€ä½³å®è·µ


**âœ… è®¾è®¡å»ºè®®**

| åŸåˆ™ | è¯´æ˜ | å®è·µè¦ç‚¹ |
|------|------|----------|
| **æ¥å£ä¼˜å…ˆ** | å…ˆè®¾è®¡æ¥å£å†å®ç° | æ˜ç¡®å®šä¹‰éœ€è¦å“ªäº›æ–¹æ³• |
| **ç»„åˆä¼˜äºç»§æ‰¿** | å°½é‡ç”¨ç»„åˆè€Œéç»§æ‰¿ | é¿å…æ·±åº¦ç»§æ‰¿é“¾ |
| **æœ€å°æ¥å£** | æ¥å£æ–¹æ³•å°½é‡å°‘ | æ¯ä¸ªæ¥å£ä¸“æ³¨ä¸€ä¸ªèŒè´£ |
| **å‘½åæ¸…æ™°** | æ–¹æ³•åè¡¨è¾¾æ˜ç¡®æ„å›¾ | è®©ä»£ç è‡ªæ–‡æ¡£åŒ– |
| **å¼‚å¸¸å¤„ç†** | æ˜ç¡®å¼‚å¸¸æƒ…å†µ | ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥ |

**ğŸš€ æ€§èƒ½è€ƒè™‘**

```
è¿è¡Œæ—¶å¼€é”€ï¼š
ABC > è™šæ‹Ÿå­ç±» > ç»§æ‰¿ > é¸­å­ç±»å‹ > Protocol

å¼€å‘æ•ˆç‡ï¼š
é¸­å­ç±»å‹ > Protocol > ç»§æ‰¿ > è™šæ‹Ÿå­ç±» > ABC

ç±»å‹å®‰å…¨ï¼š
Protocol > ABC > ç»§æ‰¿ > è™šæ‹Ÿå­ç±» > é¸­å­ç±»å‹

é€‰æ‹©å»ºè®®ï¼š
- å°é¡¹ç›®ï¼šé¸­å­ç±»å‹ + ç®€å•ç»§æ‰¿
- ä¸­å‹é¡¹ç›®ï¼šProtocol + ABC
- å¤§å‹é¡¹ç›®ï¼šProtocol + å®Œæ•´ç±»å‹æ³¨è§£
```

### 9.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“ˆ å¾ªåºæ¸è¿›çš„å­¦ä¹ è·¯å¾„**

```
ğŸŒŸ é˜¶æ®µ1ï¼šåŸºç¡€ç†è§£ï¼ˆ1-2å‘¨ï¼‰
- æŒæ¡ç»§æ‰¿å’Œæ–¹æ³•é‡å†™
- ç†è§£å¤šæ€çš„åŸºæœ¬æ¦‚å¿µ
- ç»ƒä¹ ç®€å•çš„å¤šæ€ç¤ºä¾‹

ğŸ”¥ é˜¶æ®µ2ï¼šæ·±å…¥åº”ç”¨ï¼ˆ2-3å‘¨ï¼‰  
- å­¦ä¹ ABCæŠ½è±¡åŸºç±»
- ç†è§£é¸­å­ç±»å‹å“²å­¦
- å®è·µè®¾è®¡æ¨¡å¼

âš¡ é˜¶æ®µ3ï¼šé«˜çº§æŠ€å·§ï¼ˆ3-4å‘¨ï¼‰
- æŒæ¡Protocolåè®®
- å­¦ä¹ è™šæ‹Ÿå­ç±»æœºåˆ¶
- ç»“åˆç±»å‹æ£€æŸ¥

ğŸš€ é˜¶æ®µ4ï¼šé¡¹ç›®å®æˆ˜ï¼ˆæŒç»­ï¼‰
- åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨
- é‡æ„ç°æœ‰ä»£ç 
- ä¼˜åŒ–è®¾è®¡æ¨¡å¼
```

**ğŸ“ æ ¸å¿ƒè®°å¿†å£è¯€**
```
å¤šæ€æœºåˆ¶é€‰æ‹©æ­Œï¼š
æ¥å£æ˜ç¡®ç”¨ABCï¼Œ
é¸­å­ç±»å‹æ±‚çµæ´»ï¼Œ
Protocolæœ€å®‰å…¨ï¼Œ
è™šæ‹Ÿå­ç±»æ¥ç¬¬ä¸‰æ–¹ï¼Œ
ç»§æ‰¿ç®€å•æœ€åŸºç¡€ã€‚

è®¾è®¡åŸåˆ™è¦è®°ç‰¢ï¼š
å•ä¸€èŒè´£ä¸æ··æ‚ï¼Œ
å¼€é—­åŸåˆ™æ˜“æ‰©å±•ï¼Œ  
é‡Œæ°æ›¿æ¢å¯äº’æ¢ï¼Œ
æ¥å£éš”ç¦»èŒè´£æ¸…ï¼Œ
ä¾èµ–å€’ç½®æŠ½è±¡åŒ–ã€‚
```

**ğŸ”– å®è·µæ£€æŸ¥æ¸…å•**

```
â˜ èƒ½è§£é‡Šå¤šæ€çš„æ ¸å¿ƒæ¦‚å¿µ
â˜ ä¼šä½¿ç”¨ç»§æ‰¿å®ç°å¤šæ€
â˜ ç†è§£é¸­å­ç±»å‹çš„å“²å­¦
â˜ èƒ½åˆ›å»ºå’Œä½¿ç”¨æŠ½è±¡åŸºç±»
â˜ æŒæ¡Protocolçš„ä½¿ç”¨æ–¹æ³•
â˜ äº†è§£è™šæ‹Ÿå­ç±»çš„åº”ç”¨åœºæ™¯
â˜ èƒ½ç»“åˆç±»å‹æ³¨è§£ä½¿ç”¨å¤šæ€
â˜ ä¼šåº”ç”¨å¸¸è§çš„å¤šæ€è®¾è®¡æ¨¡å¼
â˜ èƒ½åœ¨é¡¹ç›®ä¸­é€‰æ‹©åˆé€‚çš„å¤šæ€æœºåˆ¶
â˜ ç†è§£å¤šæ€çš„æ€§èƒ½å’Œè®¾è®¡æƒè¡¡
```

**ğŸ’¡ æœ€ç»ˆå»ºè®®**
å¤šæ€ä¸æ˜¯ä¸ºäº†ç‚«æŠ€ï¼Œè€Œæ˜¯ä¸ºäº†è®©ä»£ç æ›´**çµæ´»ã€å¯æ‰©å±•ã€æ˜“ç»´æŠ¤**ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¦æ ¹æ®é¡¹ç›®è§„æ¨¡ã€å›¢é˜Ÿæ°´å¹³ã€æ€§èƒ½è¦æ±‚æ¥é€‰æ‹©åˆé€‚çš„å¤šæ€æœºåˆ¶ã€‚è®°ä½ï¼š**ç®€å•æœ‰æ•ˆ > å¤æ‚ç‚«é…·**ã€‚