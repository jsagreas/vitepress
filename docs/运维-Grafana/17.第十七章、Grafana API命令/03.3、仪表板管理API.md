---
title: 3、仪表板管理API
---
## 📚 目录

1. [仪表板API基础概念](#1-仪表板API基础概念)
2. [仪表板搜索与查询](#2-仪表板搜索与查询)
3. [仪表板CRUD操作](#3-仪表板CRUD操作)
4. [仪表板导入导出](#4-仪表板导入导出)
5. [版本与权限管理](#5-版本与权限管理)
6. [高级功能操作](#6-高级功能操作)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 📊 仪表板API基础概念


### 1.1 什么是仪表板管理API


**简单理解**：就像你用手机管理相册一样，Grafana的仪表板API让你用代码来管理所有的监控面板

```
现实类比：
手机相册管理 → Grafana仪表板管理
- 查看相册     → 获取仪表板
- 新建相册     → 创建仪表板  
- 分享相册     → 分享仪表板
- 删除相册     → 删除仪表板
```

**核心作用**：
- 🔍 **批量管理**：一次操作多个仪表板，比手动快很多
- 🔄 **自动化**：写脚本自动创建、更新仪表板
- 📋 **备份还原**：导出仪表板配置，换环境时直接导入
- 🔗 **集成开发**：在自己的系统中集成Grafana功能

### 1.2 API基础路径结构


**主要API路径**：
```
基础路径：http://your-grafana:3000/api/

核心接口：
├── /dashboards/     # 仪表板核心操作
├── /search/         # 搜索仪表板
├── /folders/        # 文件夹管理
└── /snapshots/      # 快照功能
```

**认证方式**：
```bash
# 方式1：API Token（推荐）
curl -H "Authorization: Bearer your-api-token"

# 方式2：基础认证
curl -u "admin:password"
```

> 💡 **新手提示**：API Token就像你的身份证，让Grafana知道你有权限操作

### 1.3 仪表板JSON格式理解


**JSON结构概览**：
```
仪表板JSON = 配置文件 + 面板定义 + 显示设置

基本结构：
{
  "dashboard": {     ← 仪表板主体
    "title": "监控面板",
    "panels": [...], ← 所有图表面板
    "time": {...},   ← 时间范围设置
    "tags": [...]    ← 标签分类
  },
  "folderId": 0,     ← 所属文件夹
  "overwrite": false ← 是否覆盖existing
}
```

---

## 2. 🔍 仪表板搜索与查询


### 2.1 基础搜索功能


**搜索API路径**：`/api/search`

**简单搜索示例**：
```bash
# 获取所有仪表板
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/search"

# 按名称搜索
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/search?query=CPU监控"
```

**搜索参数说明**：
| 参数 | 含义 | 示例 | 说明 |
|------|------|------|------|
| `query` | 搜索关键词 | `?query=CPU` | 在标题中搜索"CPU" |
| `tag` | 按标签过滤 | `?tag=production` | 只显示生产环境标签 |
| `type` | 内容类型 | `?type=dash-db` | 只搜索仪表板 |
| `folderIds` | 文件夹ID | `?folderIds=1,2` | 指定文件夹范围 |

### 2.2 高级搜索技巧


**组合搜索条件**：
```bash
# 搜索生产环境的CPU相关仪表板
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/search?query=CPU&tag=production&type=dash-db"
```

**搜索结果解读**：
```json
[
  {
    "id": 1,
    "uid": "cpu-monitoring",    ← 唯一标识符
    "title": "CPU监控面板",
    "uri": "db/cpu-monitoring", ← 访问路径
    "tags": ["production", "server"],
    "isStarred": false,         ← 是否收藏
    "folderId": 2               ← 所属文件夹
  }
]
```

> ⚠️ **注意**：`id`会变化，`uid`是永久标识符，建议用`uid`来引用仪表板

### 2.3 按文件夹组织搜索


**文件夹搜索流程**：
```
第1步：获取所有文件夹
GET /api/folders

第2步：选择目标文件夹ID
folderIds=1,2,3

第3步：在指定文件夹中搜索
GET /api/search?folderIds=1,2,3
```

---

## 3. ⚙️ 仪表板CRUD操作


### 3.1 获取仪表板详情 (GET)


**获取完整仪表板**：
```bash
# 通过UID获取（推荐）
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/uid/your-dashboard-uid"

# 通过数据库ID获取
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/id/123"
```

**返回数据结构**：
```json
{
  "meta": {
    "isStarred": false,
    "canSave": true,           ← 是否有保存权限
    "canEdit": true,           ← 是否有编辑权限
    "created": "2024-01-01T00:00:00Z",
    "updated": "2024-01-15T10:30:00Z"
  },
  "dashboard": {
    "id": 123,
    "uid": "my-dashboard",
    "title": "我的监控面板",
    "panels": [...],           ← 面板配置数组
    "time": {
      "from": "now-1h",
      "to": "now"
    }
  }
}
```

### 3.2 创建新仪表板 (POST)


**创建API路径**：`/api/dashboards/db`

**最简创建示例**：
```bash
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "dashboard": {
      "title": "我的第一个API仪表板",
      "panels": [],
      "time": {
        "from": "now-1h",
        "to": "now"
      }
    },
    "folderId": 0,
    "overwrite": false
  }' \
  "http://localhost:3000/api/dashboards/db"
```

**创建参数详解**：
- `dashboard`：仪表板主要配置
- `folderId`：0表示根目录，其他数字表示特定文件夹
- `overwrite`：false表示不覆盖existing，true表示强制覆盖

> 💡 **新手提醒**：第一次创建建议用空面板数组`"panels": []`，后续再添加图表

### 3.3 更新仪表板 (PUT)


**更新操作说明**：
- 使用相同的POST接口：`/api/dashboards/db`
- 设置`overwrite: true`
- 必须包含原仪表板的`version`字段

```bash
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "dashboard": {
      "id": 123,                 ← 必须包含ID
      "uid": "my-dashboard",     ← 必须包含UID
      "version": 2,              ← 必须包含版本号
      "title": "更新后的标题",
      "panels": [...]
    },
    "overwrite": true            ← 允许覆盖
  }' \
  "http://localhost:3000/api/dashboards/db"
```

### 3.4 删除仪表板 (DELETE)


**删除操作**：
```bash
# 通过UID删除（推荐）
curl -X DELETE \
  -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/uid/your-dashboard-uid"

# 通过ID删除
curl -X DELETE \
  -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/db/your-dashboard-slug"
```

> ⚠️ **警告**：删除操作不可恢复！建议删除前先导出备份

---

## 4. 📤 仪表板导入导出


### 4.1 导出仪表板


**导出概念**：就像把Word文档另存为，把仪表板配置保存成JSON文件

**导出方法对比**：
```
方法1：通过API获取
GET /api/dashboards/uid/xxx → 完整JSON配置

方法2：通过界面导出  
仪表板设置 → Export → Save to file

方法3：批量导出脚本
写脚本循环获取多个仪表板
```

**导出脚本示例**：
```bash
#!/bin/bash
# 批量导出仪表板

GRAFANA_URL="http://localhost:3000"
API_TOKEN="your-api-token"

# 获取所有仪表板列表
dashboards=$(curl -s -H "Authorization: Bearer $API_TOKEN" \
  "$GRAFANA_URL/api/search?type=dash-db")

# 逐个导出
echo "$dashboards" | jq -r '.[].uid' | while read uid; do
  echo "导出仪表板: $uid"
  curl -s -H "Authorization: Bearer $API_TOKEN" \
    "$GRAFANA_URL/api/dashboards/uid/$uid" > "${uid}.json"
done
```

### 4.2 导入仪表板


**导入场景**：
- 🔄 **环境迁移**：从测试环境导入到生产环境
- 📋 **模板复用**：导入社区共享的仪表板模板
- 🔙 **备份恢复**：从备份文件恢复仪表板

**标准导入流程**：
```
第1步：准备JSON文件
第2步：清理ID和UID（避免冲突）  
第3步：设置目标文件夹
第4步：执行导入API调用
```

**导入API调用**：
```bash
# 从文件导入
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d @dashboard-backup.json \
  "http://localhost:3000/api/dashboards/db"
```

**导入时的JSON清理**：
```json
{
  "dashboard": {
    // "id": 123,        ← 删除这行，让系统自动分配
    // "uid": "old-uid", ← 删除这行，或者改成新的UID
    "title": "导入的仪表板",
    "version": 0,        ← 重置为0
    "panels": [...]
  },
  "folderId": 2,         ← 指定新的文件夹
  "overwrite": false
}
```

### 4.3 批量导入技巧


**批量导入脚本**：
```bash
#!/bin/bash
# 批量导入仪表板

GRAFANA_URL="http://localhost:3000"
API_TOKEN="your-api-token"
FOLDER_ID=2

for file in *.json; do
  echo "导入文件: $file"
  
  # 清理JSON（移除id和uid）
  jq 'del(.dashboard.id, .dashboard.uid) | .dashboard.version = 0 | .folderId = '$FOLDER_ID' | .overwrite = false' \
    "$file" > temp.json
  
  # 执行导入
  curl -X POST \
    -H "Authorization: Bearer $API_TOKEN" \
    -H "Content-Type: application/json" \
    -d @temp.json \
    "$GRAFANA_URL/api/dashboards/db"
  
  rm temp.json
done
```

---

## 5. 🔐 版本与权限管理


### 5.1 版本管理机制


**版本控制概念**：
```
类比Git版本控制：
Git Commit → Grafana仪表板版本
每次保存 → 版本号+1
可以回退 → 恢复到历史版本
```

**版本历史API**：
```bash
# 获取仪表板版本历史
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/uid/your-uid/versions"
```

**版本信息结构**：
```json
[
  {
    "id": 1,
    "dashboardId": 123,
    "version": 3,
    "created": "2024-01-15T10:30:00Z",
    "createdBy": "admin",
    "message": "添加新的CPU监控面板"  ← 版本说明
  }
]
```

**恢复到指定版本**：
```bash
# 获取指定版本的完整配置
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/uid/your-uid/versions/2"

# 然后用POST接口重新保存
```

### 5.2 权限设置API


**权限级别说明**：
```
权限等级：
1 = View（查看）    ← 只能看，不能改
2 = Edit（编辑）    ← 可以修改面板
4 = Admin（管理员）  ← 完全控制权限
```

**获取权限设置**：
```bash
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/dashboards/uid/your-uid/permissions"
```

**设置权限示例**：
```bash
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [
      {
        "role": "Viewer",      ← 角色：Viewer, Editor, Admin
        "permission": 1        ← 权限级别：1=查看
      },
      {
        "userId": 2,           ← 特定用户ID
        "permission": 2        ← 权限级别：2=编辑
      }
    ]
  }' \
  "http://localhost:3000/api/dashboards/uid/your-uid/permissions"
```

### 5.3 文件夹权限管理


**文件夹API路径**：`/api/folders`

**创建文件夹**：
```bash
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "生产环境监控",
    "uid": "prod-monitoring"
  }' \
  "http://localhost:3000/api/folders"
```

**文件夹权限继承**：
```
权限继承规则：
父文件夹权限 → 自动应用到子仪表板
覆盖规则：仪表板自身权限 > 文件夹权限
```

---

## 6. 🚀 高级功能操作


### 6.1 分享链接管理


**分享链接概念**：生成一个公开URL，无需登录即可查看仪表板

**创建分享链接**：
```bash
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "dashboardId": 123,
    "panelId": 1,           ← 可选，分享特定面板
    "timeRange": {
      "from": "now-1h",
      "to": "now"
    },
    "expires": "2024-12-31T23:59:59Z"  ← 过期时间
  }' \
  "http://localhost:3000/api/short-urls"
```

**分享链接管理**：
```bash
# 获取所有分享链接
curl -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/short-urls"

# 删除分享链接
curl -X DELETE \
  -H "Authorization: Bearer your-token" \
  "http://localhost:3000/api/short-urls/abc123"
```

### 6.2 快照功能


**快照作用**：把当前仪表板的显示状态保存下来，包括数据

**创建快照**：
```bash
curl -X POST \
  -H "Authorization: Bearer your-token" \
  -H "Content-Type: application/json" \
  -d '{
    "dashboard": {
      "panels": [...],      ← 完整的面板配置
      "time": {
        "from": "now-1h",
        "to": "now"
      }
    },
    "name": "CPU异常快照",
    "expires": 3600         ← 1小时后过期（秒）
  }' \
  "http://localhost:3000/api/snapshots"
```

**快照与普通仪表板区别**：
```
普通仪表板：实时查询数据，数据会变化
快照：保存当时的数据状态，数据不会变化

使用场景：
- 故障报告：保存故障时的监控状态
- 定期报告：每日/每周监控数据归档
- 分享证据：向其他人展示特定时间点的数据
```

### 6.3 仪表板克隆


**克隆操作流程**：
```
第1步：获取原仪表板配置
GET /api/dashboards/uid/original-uid

第2步：修改配置
- 清除ID和UID
- 修改标题
- 重置版本号

第3步：创建新仪表板  
POST /api/dashboards/db
```

**克隆脚本示例**：
```bash
#!/bin/bash
# 克隆仪表板

SOURCE_UID="original-dashboard"
NEW_TITLE="克隆的仪表板"
TARGET_FOLDER=2

# 获取原始配置
original=$(curl -s -H "Authorization: Bearer $API_TOKEN" \
  "$GRAFANA_URL/api/dashboards/uid/$SOURCE_UID")

# 修改配置并创建新仪表板
echo "$original" | jq "
  del(.dashboard.id, .dashboard.uid) |
  .dashboard.title = \"$NEW_TITLE\" |
  .dashboard.version = 0 |
  .folderId = $TARGET_FOLDER |
  .overwrite = false
" | curl -X POST \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Content-Type: application/json" \
  -d @- \
  "$GRAFANA_URL/api/dashboards/db"
```

### 6.4 批量操作接口


**批量标签管理**：
```bash
# 给多个仪表板添加标签
dashboard_uids=("uid1" "uid2" "uid3")

for uid in "${dashboard_uids[@]}"; do
  # 获取当前配置
  config=$(curl -s -H "Authorization: Bearer $API_TOKEN" \
    "$GRAFANA_URL/api/dashboards/uid/$uid")
  
  # 添加标签并更新
  echo "$config" | jq '.dashboard.tags += ["production"]' | \
    curl -X POST \
    -H "Authorization: Bearer $API_TOKEN" \
    -H "Content-Type: application/json" \
    -d @- \
    "$GRAFANA_URL/api/dashboards/db"
done
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的API路径


```
🔸 基础搜索：GET /api/search
🔸 获取详情：GET /api/dashboards/uid/{uid}
🔸 创建更新：POST /api/dashboards/db
🔸 删除操作：DELETE /api/dashboards/uid/{uid}
🔸 版本历史：GET /api/dashboards/uid/{uid}/versions
🔸 权限管理：GET/POST /api/dashboards/uid/{uid}/permissions
```

### 7.2 关键理解要点


**🔹 UID vs ID的区别**
```
ID（数字）：
- 数据库自增ID，会变化
- 导入时会重新分配
- 不建议在API中使用

UID（字符串）：
- 全局唯一标识符，不会变化  
- 导入导出时保持一致
- API操作推荐使用
```

**🔹 overwrite参数的作用**
```
overwrite: false → 创建新仪表板
overwrite: true  → 更新existing仪表板

使用场景：
- 初次创建：使用false
- 更新配置：使用true
- 导入备份：通常使用false
```

**🔹 版本管理的重要性**
```
版本号作用：
- 防止并发编辑冲突
- 支持历史版本回退
- 更新时必须提供正确版本号

更新失败常见原因：
❌ 版本号不匹配
❌ 没有编辑权限
❌ JSON格式错误
```

### 7.3 实际应用场景


**📊 环境迁移场景**
```
开发 → 测试 → 生产

步骤：
1. 开发环境导出仪表板
2. 清理JSON中的ID/UID
3. 导入到测试环境验证
4. 最终导入到生产环境
```

**🔄 自动化运维场景**
```
定时任务：
- 每日备份所有仪表板
- 自动创建周报/月报仪表板
- 批量更新标签和权限
- 监控仪表板变化并告警
```

**👥 团队协作场景**
```
权限分配：
- 开发团队：Edit权限
- 运维团队：Admin权限  
- 业务团队：View权限
- 外部用户：分享链接
```

### 7.4 最佳实践建议


**✅ 推荐做法**
- 使用UID而不是ID进行API操作
- 导入前备份existing仪表板
- 设置合理的文件夹结构和权限
- 定期导出重要仪表板作为备份
- 使用有意义的标题和标签

**❌ 避免的错误**
- 直接使用生产环境测试API
- 忘记在导入时清理ID/UID
- 不检查权限就执行删除操作
- 批量操作时不做错误处理
- 不备份就进行大量修改

**🛠️ 调试技巧**
- 先用curl测试单个API调用
- 使用jq工具格式化JSON输出
- 检查HTTP状态码和错误消息
- 在测试环境验证脚本逻辑
- 记录操作日志便于问题排查

**核心记忆**
- 仪表板API让监控管理自动化成为可能
- UID是仪表板的身份证，API操作的首选标识
- 导入导出是环境迁移和备份的核心功能
- 权限管理确保团队协作的安全性
- 版本控制让仪表板变更可追踪可回退