---
title: 2ã€sql-æŸ¥è¯¢è¯­æ³•
---
## ðŸ“š ç›®å½•

1. [SQLæŸ¥è¯¢è¯­æ³•åŸºç¡€](#1-SQLæŸ¥è¯¢è¯­æ³•åŸºç¡€)
2. [æ—¶é—´å­—æ®µå¤„ç†è¯¦è§£](#2-æ—¶é—´å­—æ®µå¤„ç†è¯¦è§£)
3. [GROUP BYèšåˆæŸ¥è¯¢](#3-GROUP-BYèšåˆæŸ¥è¯¢)
4. [WHEREæ¡ä»¶è¿‡æ»¤æŠ€å·§](#4-WHEREæ¡ä»¶è¿‡æ»¤æŠ€å·§)
5. [å¸¸ç”¨å‡½æ•°ä½¿ç”¨æŒ‡å—](#5-å¸¸ç”¨å‡½æ•°ä½¿ç”¨æŒ‡å—)
6. [å˜é‡ç»‘å®šä¸ŽåŠ¨æ€æŸ¥è¯¢](#6-å˜é‡ç»‘å®šä¸ŽåŠ¨æ€æŸ¥è¯¢)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ” SQLæŸ¥è¯¢è¯­æ³•åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Grafanaä¸­çš„SQLæŸ¥è¯¢


**ðŸŽ¯ é€šä¿—ç†è§£**
æŠŠGrafanaæƒ³è±¡æˆä¸€ä¸ª"æ•°æ®ç¿»è¯‘å®˜"ï¼Œå®ƒå¸®ä½ æŠŠå¤æ‚çš„æ•°æ®åº“æ•°æ®å˜æˆæ¼‚äº®çš„å›¾è¡¨ã€‚è€ŒSQLæŸ¥è¯¢å°±æ˜¯ä½ è·Ÿè¿™ä¸ªç¿»è¯‘å®˜è¯´è¯çš„"è¯­è¨€"ã€‚

```
ç®€å•ç±»æ¯”ï¼š
ä½ ï¼š"æˆ‘æƒ³çœ‹çœ‹æœ€è¿‘ä¸€å°æ—¶æœåŠ¡å™¨çš„CPUä½¿ç”¨çŽ‡"
SQLç¿»è¯‘ï¼š"SELECT time, cpu_usage FROM metrics WHERE time > now() - 1h"
Grafanaï¼š"å¥½çš„ï¼Œç»™ä½ ç”»ä¸ªå›¾è¡¨ï¼"
```

**ðŸ“‹ åŸºæœ¬è¯­æ³•ç»“æž„**
```sql
-- æœ€ç®€å•çš„æŸ¥è¯¢æ ¼å¼
SELECT åˆ—å
FROM è¡¨å
WHERE æ¡ä»¶
ORDER BY æŽ’åºå­—æ®µ
```

### 1.2 Grafana SQLçš„ç‰¹æ®Šä¹‹å¤„


**ðŸ”¸ ä¸Žæ™®é€šSQLçš„åŒºåˆ«**
- **æ—¶é—´å¯¼å‘**ï¼šä¸“é—¨å¤„ç†æ—¶é—´åºåˆ—æ•°æ®
- **è‡ªåŠ¨åˆ·æ–°**ï¼šæŸ¥è¯¢ä¼šå®šæœŸè‡ªåŠ¨æ‰§è¡Œ
- **å˜é‡æ”¯æŒ**ï¼šå¯ä»¥ä½¿ç”¨åŠ¨æ€å˜é‡
- **å›¾è¡¨å‹å¥½**ï¼šæŸ¥è¯¢ç»“æžœç›´æŽ¥ç”¨äºŽç»˜å›¾

```
æ™®é€šSQLï¼šæŸ¥ä¸€æ¬¡å°±å®Œäº†
Grafana SQLï¼šæ¯éš”å‡ ç§’æŸ¥ä¸€æ¬¡ï¼Œå®žæ—¶æ›´æ–°å›¾è¡¨
```

### 1.3 åŸºç¡€æŸ¥è¯¢ç¤ºä¾‹


**ðŸ“Š æœ€ç®€å•çš„ç›‘æŽ§æŸ¥è¯¢**
```sql
-- æŸ¥è¯¢CPUä½¿ç”¨çŽ‡
SELECT 
  time,
  cpu_usage
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
```

**ðŸ’¡ æŸ¥è¯¢è§£é‡Š**
- `time`ï¼šæ—¶é—´åˆ—ï¼Œç”¨äºŽXè½´
- `cpu_usage`ï¼šæ•°å€¼åˆ—ï¼Œç”¨äºŽYè½´
- `$__timeFrom()` å’Œ `$__timeTo()`ï¼šGrafanaå†…ç½®çš„æ—¶é—´å˜é‡

---

## 2. â° æ—¶é—´å­—æ®µå¤„ç†è¯¦è§£


### 2.1 æ—¶é—´å­—æ®µçš„é‡è¦æ€§


**ðŸ”¸ ä¸ºä»€ä¹ˆæ—¶é—´å­—æ®µè¿™ä¹ˆé‡è¦ï¼Ÿ**
ç›‘æŽ§æ•°æ®æœ€æ ¸å¿ƒçš„å°±æ˜¯"ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„"ã€‚æ²¡æœ‰æ—¶é—´ï¼Œç›‘æŽ§å°±æ²¡æœ‰æ„ä¹‰ã€‚

```
æƒ³è±¡ä¸€ä¸‹ï¼š
- æ²¡æœ‰æ—¶é—´ï¼š"CPUä½¿ç”¨çŽ‡æ˜¯80%"  â† ä»€ä¹ˆæ—¶å€™çš„ï¼Ÿä¸çŸ¥é“ï¼
- æœ‰æ—¶é—´ï¼š"2024å¹´1æœˆ1æ—¥ 10:30ï¼ŒCPUä½¿ç”¨çŽ‡æ˜¯80%"  â† è¿™æ‰æœ‰ç”¨ï¼
```

### 2.2 æ—¶é—´å­—æ®µçš„å¸¸è§æ ¼å¼


| æ—¶é—´æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜Ž |
|---------|------|------|
| **UNIXæ—¶é—´æˆ³** | `1704085800` | ç§’çº§æ—¶é—´æˆ³ |
| **æ¯«ç§’æ—¶é—´æˆ³** | `1704085800000` | æ¯«ç§’çº§æ—¶é—´æˆ³ |
| **ISOå­—ç¬¦ä¸²** | `2024-01-01T10:30:00Z` | æ ‡å‡†æ—¶é—´æ ¼å¼ |
| **æ•°æ®åº“æ—¶é—´** | `DATETIME`, `TIMESTAMP` | æ•°æ®åº“åŽŸç”Ÿæ ¼å¼ |

### 2.3 æ—¶é—´å­—æ®µå¤„ç†æŠ€å·§


**ðŸ• æ—¶é—´èŒƒå›´æŸ¥è¯¢**
```sql
-- ä½¿ç”¨Grafanaå†…ç½®æ—¶é—´å˜é‡ï¼ˆæŽ¨èï¼‰
SELECT time, value 
FROM metrics 
WHERE time BETWEEN $__timeFrom() AND $__timeTo()

-- æ‰‹åŠ¨æŒ‡å®šæ—¶é—´èŒƒå›´
SELECT time, value 
FROM metrics 
WHERE time >= '2024-01-01 00:00:00' 
  AND time <= '2024-01-01 23:59:59'
```

**âš¡ æ—¶é—´æ ¼å¼è½¬æ¢**
```sql
-- æ—¶é—´æˆ³è½¬æ¢ä¸ºå¯è¯»æ ¼å¼
SELECT 
  FROM_UNIXTIME(timestamp) as time,
  cpu_usage
FROM server_metrics

-- å­—ç¬¦ä¸²æ—¶é—´è½¬æ¢
SELECT 
  STR_TO_DATE(time_str, '%Y-%m-%d %H:%i:%s') as time,
  memory_usage
FROM app_logs
```

### 2.4 æ—¶é—´åŒºé—´æŸ¥è¯¢å®žä¾‹


**ðŸ“ˆ å¸¸ç”¨æ—¶é—´æŸ¥è¯¢æ¨¡å¼**
```sql
-- æœ€è¿‘1å°æ—¶çš„æ•°æ®
SELECT time, value 
FROM metrics 
WHERE time > NOW() - INTERVAL 1 HOUR

-- ä»Šå¤©çš„æ•°æ®
SELECT time, value 
FROM metrics 
WHERE DATE(time) = CURDATE()

-- æŒ‰å°æ—¶åˆ†ç»„çš„æ•°æ®
SELECT 
  DATE_FORMAT(time, '%Y-%m-%d %H:00:00') as hour,
  AVG(cpu_usage) as avg_cpu
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
GROUP BY hour
```

---

## 3. ðŸ“Š GROUP BYèšåˆæŸ¥è¯¢


### 3.1 ä»€ä¹ˆæ˜¯GROUP BYèšåˆ


**ðŸŽ¯ é€šä¿—è§£é‡Š**
GROUP BYå°±åƒæ˜¯ç»™æ•°æ®"åˆ†ç»„å½’ç±»"ã€‚æ¯”å¦‚æŠŠå­¦ç”ŸæŒ‰ç­çº§åˆ†ç»„ï¼Œç„¶åŽè®¡ç®—æ¯ä¸ªç­çº§çš„å¹³å‡åˆ†ã€‚

```
åŽŸå§‹æ•°æ®ï¼š
æ—¶é—´        æœåŠ¡å™¨    CPUä½¿ç”¨çŽ‡
10:00     server1      60%
10:00     server2      70%
10:01     server1      65%
10:01     server2      75%

GROUP BYæ—¶é—´åŽï¼š
æ—¶é—´      å¹³å‡CPUä½¿ç”¨çŽ‡
10:00         65%
10:01         70%
```

### 3.2 å¸¸ç”¨èšåˆå‡½æ•°


| å‡½æ•° | ä½œç”¨ | ç›‘æŽ§åœºæ™¯ |
|------|------|---------|
| **AVG()** | è®¡ç®—å¹³å‡å€¼ | å¹³å‡å“åº”æ—¶é—´ã€å¹³å‡CPUä½¿ç”¨çŽ‡ |
| **SUM()** | è®¡ç®—æ€»å’Œ | æ€»è¯·æ±‚æ•°ã€æ€»é”™è¯¯æ•° |
| **COUNT()** | è®¡ç®—æ•°é‡ | æ—¥å¿—æ¡æ•°ã€äº‹ä»¶æ•°é‡ |
| **MAX()** | æœ€å¤§å€¼ | å³°å€¼CPUã€æœ€é«˜å†…å­˜ |
| **MIN()** | æœ€å°å€¼ | æœ€ä½Žå“åº”æ—¶é—´ã€æœ€å°å¯ç”¨å†…å­˜ |

### 3.3 æ—¶é—´ç»´åº¦èšåˆ


**â±ï¸ æŒ‰æ—¶é—´é—´éš”èšåˆ**
```sql
-- æ¯5åˆ†é’Ÿçš„å¹³å‡CPUä½¿ç”¨çŽ‡
SELECT 
  DATE_FORMAT(
    FROM_UNIXTIME(FLOOR(UNIX_TIMESTAMP(time)/300)*300), 
    '%Y-%m-%d %H:%i:%s'
  ) as time_bucket,
  AVG(cpu_usage) as avg_cpu
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
GROUP BY time_bucket
ORDER BY time_bucket
```

**ðŸ“Š æ›´ç®€å•çš„æ—¶é—´èšåˆï¼ˆMySQL 8.0+ï¼‰**
```sql
-- ä½¿ç”¨çª—å£å‡½æ•°æŒ‰å°æ—¶èšåˆ
SELECT 
  DATE_FORMAT(time, '%Y-%m-%d %H:00:00') as hour,
  AVG(cpu_usage) as avg_cpu,
  MAX(cpu_usage) as max_cpu,
  COUNT(*) as data_points
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
GROUP BY hour
ORDER BY hour
```

### 3.4 å¤šç»´åº¦èšåˆ


**ðŸ·ï¸ æŒ‰æœåŠ¡å™¨å’Œæ—¶é—´èšåˆ**
```sql
-- æ¯å°æœåŠ¡å™¨æ¯å°æ—¶çš„ç»Ÿè®¡
SELECT 
  server_name,
  DATE_FORMAT(time, '%Y-%m-%d %H:00:00') as hour,
  AVG(cpu_usage) as avg_cpu,
  AVG(memory_usage) as avg_memory
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
GROUP BY server_name, hour
ORDER BY server_name, hour
```

---

## 4. ðŸ”Ž WHEREæ¡ä»¶è¿‡æ»¤æŠ€å·§


### 4.1 åŸºç¡€æ¡ä»¶è¿‡æ»¤


**ðŸŽ¯ ç†è§£WHEREå­å¥**
WHEREå°±åƒæ˜¯ç»™æ•°æ®è®¾ç½®"å‡†å…¥é—¨æ§›"ï¼Œåªæœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®æ‰èƒ½é€šè¿‡ã€‚

```
æ¯”å¦‚ç­›é€‰CPUä½¿ç”¨çŽ‡é«˜çš„æœåŠ¡å™¨ï¼š
WHERE cpu_usage > 80  â† åªè¦CPUè¶…è¿‡80%çš„è®°å½•
```

### 4.2 æ•°å€¼æ¡ä»¶è¿‡æ»¤


**ðŸ“Š å¸¸ç”¨æ•°å€¼æ¯”è¾ƒ**
```sql
-- é«˜CPUä½¿ç”¨çŽ‡å‘Šè­¦
SELECT time, server_name, cpu_usage
FROM server_metrics
WHERE cpu_usage > 80
  AND time >= $__timeFrom() AND time <= $__timeTo()

-- å†…å­˜ä½¿ç”¨çŽ‡åœ¨åˆç†èŒƒå›´å†…çš„æœåŠ¡å™¨
SELECT time, server_name, memory_usage
FROM server_metrics
WHERE memory_usage BETWEEN 30 AND 80
  AND time >= $__timeFrom() AND time <= $__timeTo()

-- æŽ’é™¤å¼‚å¸¸å€¼
SELECT time, response_time
FROM api_metrics
WHERE response_time > 0 AND response_time < 5000  -- æŽ’é™¤0å’Œè¶…å¤§å€¼
  AND time >= $__timeFrom() AND time <= $__timeTo()
```

### 4.3 å­—ç¬¦ä¸²æ¡ä»¶è¿‡æ»¤


**ðŸ”¤ æ–‡æœ¬åŒ¹é…æŠ€å·§**
```sql
-- ç‰¹å®šæœåŠ¡å™¨ç›‘æŽ§
SELECT time, cpu_usage
FROM server_metrics
WHERE server_name IN ('web-01', 'web-02', 'web-03')
  AND time >= $__timeFrom() AND time <= $__timeTo()

-- ç”Ÿäº§çŽ¯å¢ƒè¿‡æ»¤
SELECT time, error_count
FROM app_logs
WHERE environment = 'production'
  AND log_level IN ('ERROR', 'FATAL')
  AND time >= $__timeFrom() AND time <= $__timeTo()

-- æ¨¡ç³ŠåŒ¹é…
SELECT time, message
FROM error_logs
WHERE message LIKE '%timeout%'
  OR message LIKE '%connection%'
  AND time >= $__timeFrom() AND time <= $__timeTo()
```

### 4.4 å¤åˆæ¡ä»¶ç»„åˆ


**ðŸ”— é€»è¾‘è¿ç®—ç¬¦ä½¿ç”¨**
```sql
-- å¤æ‚æ¡ä»¶ç»„åˆ
SELECT 
  time, 
  server_name, 
  cpu_usage, 
  memory_usage
FROM server_metrics
WHERE (
    cpu_usage > 80 OR memory_usage > 90  -- é«˜è´Ÿè½½
  ) 
  AND server_name NOT LIKE '%test%'      -- æŽ’é™¤æµ‹è¯•æœåŠ¡å™¨
  AND environment = 'production'         -- åªçœ‹ç”Ÿäº§çŽ¯å¢ƒ
  AND time >= $__timeFrom() AND time <= $__timeTo()
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
- æ¡ä»¶è¶Šå¤šï¼ŒæŸ¥è¯¢è¶Šæ…¢
- æ—¶é—´æ¡ä»¶ä¸€å®šè¦åŠ ä¸Šï¼Œé¿å…æŸ¥è¯¢å…¨è¡¨
- ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºè¿‡æ»¤æ¡ä»¶

---

## 5. ðŸ§® å¸¸ç”¨å‡½æ•°ä½¿ç”¨æŒ‡å—


### 5.1 æ•°å­¦å‡½æ•°


**ðŸ“ˆ è®¡ç®—å¢žé•¿çŽ‡å’Œå˜åŒ–**
```sql
-- è®¡ç®—CPUä½¿ç”¨çŽ‡å˜åŒ–
SELECT 
  time,
  cpu_usage,
  cpu_usage - LAG(cpu_usage) OVER (ORDER BY time) as cpu_change
FROM server_metrics
WHERE server_name = 'web-01'
  AND time >= $__timeFrom() AND time <= $__timeTo()
ORDER BY time

-- è®¡ç®—ç™¾åˆ†æ¯”
SELECT 
  time,
  ROUND((used_memory / total_memory) * 100, 2) as memory_percent
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
```

### 5.2 æ—¶é—´å‡½æ•°


**â° æ—¶é—´å¤„ç†å¸¸ç”¨å‡½æ•°**
```sql
-- æŒ‰å°æ—¶åˆ†ç»„
SELECT 
  HOUR(time) as hour,
  AVG(cpu_usage) as avg_cpu
FROM server_metrics
WHERE DATE(time) = CURDATE()
GROUP BY hour

-- æ—¶é—´å·®è®¡ç®—
SELECT 
  time,
  TIMESTAMPDIFF(SECOND, LAG(time) OVER (ORDER BY time), time) as interval_seconds
FROM api_requests
WHERE time >= $__timeFrom() AND time <= $__timeTo()
```

### 5.3 å­—ç¬¦ä¸²å‡½æ•°


**ðŸ”¤ æ–‡æœ¬å¤„ç†å‡½æ•°**
```sql
-- æå–æœåŠ¡å™¨ç¼–å·
SELECT 
  time,
  SUBSTRING(server_name, -2) as server_id,  -- å–æœ€åŽ2ä½
  cpu_usage
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()

-- åˆ†å‰²æ—¥å¿—æ¶ˆæ¯
SELECT 
  time,
  SUBSTRING_INDEX(log_message, ':', 1) as log_type,
  SUBSTRING_INDEX(log_message, ':', -1) as log_content
FROM application_logs
WHERE time >= $__timeFrom() AND time <= $__timeTo()
```

### 5.4 æ¡ä»¶å‡½æ•°


**ðŸŽ›ï¸ æ¡ä»¶åˆ¤æ–­å‡½æ•°**
```sql
-- çŠ¶æ€åˆ†ç±»
SELECT 
  time,
  cpu_usage,
  CASE 
    WHEN cpu_usage < 50 THEN 'Normal'
    WHEN cpu_usage < 80 THEN 'Warning'
    ELSE 'Critical'
  END as status
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()

-- ç©ºå€¼å¤„ç†
SELECT 
  time,
  COALESCE(cpu_usage, 0) as cpu_usage,  -- ç©ºå€¼æ›¿æ¢ä¸º0
  IFNULL(memory_usage, 0) as memory_usage
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
```

---

## 6. ðŸ”— å˜é‡ç»‘å®šä¸ŽåŠ¨æ€æŸ¥è¯¢


### 6.1 ä»€ä¹ˆæ˜¯Grafanaå˜é‡


**ðŸŽ¯ é€šä¿—ç†è§£**
å˜é‡å°±åƒæ˜¯æŸ¥è¯¢è¯­å¥ä¸­çš„"å ä½ç¬¦"ï¼Œä½ å¯ä»¥éšæ—¶æ”¹å˜å®ƒçš„å€¼ï¼Œè®©åŒä¸€ä¸ªæŸ¥è¯¢æ˜¾ç¤ºä¸åŒçš„æ•°æ®ã€‚

```
æ¯”å¦‚ï¼š
æ²¡æœ‰å˜é‡ï¼šSELECT * FROM metrics WHERE server_name = 'web-01'
æœ‰å˜é‡ï¼š  SELECT * FROM metrics WHERE server_name = '$server'

ä½ å¯ä»¥æŠŠ$serveræ”¹æˆweb-01ã€web-02ã€web-03...
ä¸€ä¸ªå›¾è¡¨å¯ä»¥çœ‹ä¸åŒæœåŠ¡å™¨çš„æ•°æ®ï¼
```

### 6.2 å†…ç½®æ—¶é—´å˜é‡


**â° Grafanaè‡ªå¸¦çš„æ—¶é—´å˜é‡**

| å˜é‡ | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `$__timeFrom()` | å¼€å§‹æ—¶é—´ | `2024-01-01 10:00:00` |
| `$__timeTo()` | ç»“æŸæ—¶é—´ | `2024-01-01 11:00:00` |
| `$__interval` | è‡ªåŠ¨è®¡ç®—çš„æ—¶é—´é—´éš” | `5m`, `1h` |

```sql
-- ä½¿ç”¨å†…ç½®æ—¶é—´å˜é‡ï¼ˆæŽ¨èå†™æ³•ï¼‰
SELECT 
  time,
  AVG(cpu_usage) as avg_cpu
FROM server_metrics
WHERE time >= $__timeFrom() AND time <= $__timeTo()
GROUP BY time
ORDER BY time
```

### 6.3 è‡ªå®šä¹‰å˜é‡ä½¿ç”¨


**ðŸ·ï¸ åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰å˜é‡**
```sql
-- æœåŠ¡å™¨é€‰æ‹©å˜é‡æŸ¥è¯¢
SELECT DISTINCT server_name as __text, server_name as __value
FROM server_metrics
ORDER BY server_name

-- åœ¨ç›‘æŽ§æŸ¥è¯¢ä¸­ä½¿ç”¨æœåŠ¡å™¨å˜é‡
SELECT 
  time,
  cpu_usage,
  memory_usage
FROM server_metrics
WHERE server_name = '$server'
  AND time >= $__timeFrom() AND time <= $__timeTo()
```

### 6.4 å¤šå€¼å˜é‡å¤„ç†


**ðŸ“‹ é€‰æ‹©å¤šä¸ªå€¼çš„å˜é‡**
```sql
-- æ”¯æŒå¤šæœåŠ¡å™¨é€‰æ‹©
SELECT 
  time,
  server_name,
  cpu_usage
FROM server_metrics
WHERE server_name IN ($server)  -- $serverå¯ä»¥é€‰æ‹©å¤šä¸ªå€¼
  AND time >= $__timeFrom() AND time <= $__timeTo()
ORDER BY time, server_name
```

### 6.5 åŠ¨æ€æŸ¥è¯¢ä¼˜åŒ–


**âš¡ æé«˜æŸ¥è¯¢æ€§èƒ½çš„æŠ€å·§**
```sql
-- ä½¿ç”¨å˜é‡æŽ§åˆ¶æ•°æ®ç²¾åº¦
SELECT 
  FROM_UNIXTIME(FLOOR(UNIX_TIMESTAMP(time)/$__interval_ms*1000)*$__interval_ms/1000) as time,
  AVG(cpu_usage) as avg_cpu
FROM server_metrics
WHERE server_name = '$server'
  AND time >= $__timeFrom() AND time <= $__timeTo()
GROUP BY time
ORDER BY time
```

**ðŸ’¡ å˜é‡ä½¿ç”¨æœ€ä½³å®žè·µ**
- æ—¶é—´å˜é‡å¿…é¡»ä½¿ç”¨ï¼Œé¿å…å…¨è¡¨æ‰«æ
- è‡ªå®šä¹‰å˜é‡è¦è®¾ç½®é»˜è®¤å€¼
- å¤šå€¼å˜é‡è¦è€ƒè™‘æŸ¥è¯¢æ€§èƒ½
- å˜é‡åè¦æ¸…æ™°æ˜“æ‡‚

---

## 7. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ SQLæŸ¥è¯¢è¯­æ³•ï¼šGrafanaä¸­ç”¨äºŽèŽ·å–ç›‘æŽ§æ•°æ®çš„è¯­è¨€
ðŸ”¸ æ—¶é—´å­—æ®µå¤„ç†ï¼šç›‘æŽ§æ•°æ®çš„æ ¸å¿ƒï¼Œå¿…é¡»æ­£ç¡®å¤„ç†æ—¶é—´èŒƒå›´
ðŸ”¸ GROUP BYèšåˆï¼šå°†æ•°æ®æŒ‰æ—¶é—´æˆ–ç»´åº¦åˆ†ç»„ç»Ÿè®¡
ðŸ”¸ WHEREæ¡ä»¶è¿‡æ»¤ï¼šç­›é€‰éœ€è¦çš„æ•°æ®ï¼Œæé«˜æŸ¥è¯¢æ•ˆçŽ‡
ðŸ”¸ å¸¸ç”¨å‡½æ•°ï¼šæ•°å­¦å‡½æ•°ã€æ—¶é—´å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°çš„å®žé™…åº”ç”¨
ðŸ”¸ å˜é‡ç»‘å®šï¼šåŠ¨æ€æŸ¥è¯¢çš„åŸºç¡€ï¼Œè®©ç›‘æŽ§æ›´çµæ´»
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ æ—¶é—´å¤„ç†çš„é‡è¦æ€§**
```
è®°å¿†è¦ç‚¹ï¼š
- æ‰€æœ‰ç›‘æŽ§æŸ¥è¯¢éƒ½å¿…é¡»åŒ…å«æ—¶é—´èŒƒå›´æ¡ä»¶
- ä½¿ç”¨$__timeFrom()å’Œ$__timeTo()å˜é‡
- æ—¶é—´èšåˆå†³å®šå›¾è¡¨çš„ç²¾åº¦å’Œæ€§èƒ½
```

**ðŸ”¹ èšåˆæŸ¥è¯¢çš„ä½œç”¨**
```
å®žé™…æ„ä¹‰ï¼š
- å°†å¤§é‡æ•°æ®æ±‡æ€»æˆæœ‰æ„ä¹‰çš„è¶‹åŠ¿
- æŒ‰æ—¶é—´é—´éš”èšåˆæ˜¾ç¤ºæ•°æ®å˜åŒ–
- æŒ‰ç»´åº¦èšåˆæ¯”è¾ƒä¸åŒå¯¹è±¡
```

**ðŸ”¹ å˜é‡çš„çµæ´»æ€§**
```
ä½¿ç”¨ä»·å€¼ï¼š
- ä¸€ä¸ªæŸ¥è¯¢é€‚ç”¨å¤šç§åœºæ™¯
- ç”¨æˆ·å¯ä»¥äº¤äº’å¼é€‰æ‹©æŸ¥çœ‹çš„æ•°æ®
- å‡å°‘é‡å¤ç¼–å†™ç›¸ä¼¼æŸ¥è¯¢
```

### 7.3 å®žé™…åº”ç”¨åœºæ™¯


**ðŸ“Š ç›‘æŽ§åœºæ™¯ä¸ŽSQLæŸ¥è¯¢å¯¹åº”**

| ç›‘æŽ§éœ€æ±‚ | SQLæŸ¥è¯¢è¦ç‚¹ | å…³é”®æŠ€æœ¯ |
|---------|-------------|---------|
| **å®žæ—¶æ€§èƒ½ç›‘æŽ§** | æ—¶é—´èŒƒå›´æŸ¥è¯¢ + èšåˆ | `$__timeFrom()`, `GROUP BY` |
| **åŽ†å²è¶‹åŠ¿åˆ†æž** | é•¿æ—¶é—´èŒƒå›´ + æ—¶é—´èšåˆ | `DATE_FORMAT()`, `AVG()` |
| **å‘Šè­¦æŸ¥è¯¢** | æ¡ä»¶è¿‡æ»¤ + é˜ˆå€¼æ¯”è¾ƒ | `WHERE`, `HAVING` |
| **å¤šç»´åº¦å¯¹æ¯”** | åˆ†ç»„èšåˆ + å¤šå­—æ®µ | `GROUP BY`, å¤šç»´å˜é‡ |

### 7.4 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


**âš¡ æŸ¥è¯¢ä¼˜åŒ–å»ºè®®**
```
å¿…åšä¼˜åŒ–ï¼š
- æ€»æ˜¯ä½¿ç”¨æ—¶é—´èŒƒå›´é™åˆ¶
- åœ¨æ—¶é—´å­—æ®µä¸Šå»ºç«‹ç´¢å¼•
- é¿å…SELECT *ï¼ŒåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
- åˆç†ä½¿ç”¨èšåˆå‡å°‘æ•°æ®é‡

æ€§èƒ½ç›‘æŽ§ï¼š
- æŸ¥è¯¢æ—¶é—´è¶…è¿‡5ç§’éœ€è¦ä¼˜åŒ–
- å¤§é‡æ•°æ®ç‚¹ä¼šå½±å“å›¾è¡¨æ¸²æŸ“
- ä½¿ç”¨$__intervalè‡ªåŠ¨è°ƒèŠ‚ç²¾åº¦
```

### 7.5 å¸¸è§é—®é¢˜è§£å†³


**ðŸ”§ è°ƒè¯•æŠ€å·§**
```
æŸ¥è¯¢æ²¡æœ‰æ•°æ®ï¼š
âœ“ æ£€æŸ¥æ—¶é—´èŒƒå›´æ˜¯å¦æ­£ç¡®
âœ“ ç¡®è®¤WHEREæ¡ä»¶ä¸ä¼šè¿‡æ»¤æŽ‰æ‰€æœ‰æ•°æ®
âœ“ éªŒè¯è¡¨åå’Œå­—æ®µåæ˜¯å¦æ­£ç¡®

æŸ¥è¯¢å¾ˆæ…¢ï¼š
âœ“ æ·»åŠ æ—¶é—´èŒƒå›´é™åˆ¶
âœ“ æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•å­—æ®µ
âœ“ å‡å°‘ä¸å¿…è¦çš„JOINæ“ä½œ

å›¾è¡¨æ˜¾ç¤ºå¼‚å¸¸ï¼š
âœ“ ç¡®è®¤æ—¶é—´å­—æ®µæ ¼å¼æ­£ç¡®
âœ“ æ£€æŸ¥æ•°å€¼å­—æ®µçš„æ•°æ®ç±»åž‹
âœ“ éªŒè¯èšåˆå‡½æ•°çš„ä½¿ç”¨
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ—¶é—´èŒƒå›´å¿…é¡»åŠ ï¼Œå˜é‡ä½¿ç”¨æ›´çµæ´»
èšåˆåˆ†ç»„çœ‹è¶‹åŠ¿ï¼Œæ¡ä»¶è¿‡æ»¤ææ•ˆçŽ‡
å‡½æ•°ä½¿ç”¨è¦æ°å½“ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯å…³é”®
```

### 7.6 è¿›é˜¶å­¦ä¹ è·¯å¾„


- [x] æŽŒæ¡åŸºæœ¬SQLè¯­æ³•
- [x] ç†è§£æ—¶é—´å­—æ®µå¤„ç†
- [x] å­¦ä¼šèšåˆå’Œè¿‡æ»¤
- [ ] æ·±å…¥å­¦ä¹ çª—å£å‡½æ•°
- [ ] æŽŒæ¡å¤æ‚JOINæŸ¥è¯¢
- [ ] å­¦ä¹ æŸ¥è¯¢æ€§èƒ½è°ƒä¼˜