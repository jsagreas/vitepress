---
title: 2ã€è®¤è¯-é›†æˆ
---
## ğŸ“š ç›®å½•

1. [è®¤è¯ç³»ç»ŸåŸºç¡€æ¦‚å¿µ](#1-è®¤è¯ç³»ç»ŸåŸºç¡€æ¦‚å¿µ)
2. [æœ¬åœ°ç”¨æˆ·è®¤è¯ç®¡ç†](#2-æœ¬åœ°ç”¨æˆ·è®¤è¯ç®¡ç†)
3. [LDAPé›†æˆé…ç½®](#3-LDAPé›†æˆé…ç½®)
4. [OAuth2è®¤è¯æ¥å…¥](#4-OAuth2è®¤è¯æ¥å…¥)
5. [SAMLå•ç‚¹ç™»å½•](#5-SAMLå•ç‚¹ç™»å½•)
6. [APIå¯†é’¥ç®¡ç†](#6-APIå¯†é’¥ç®¡ç†)
7. [å®‰å…¨é…ç½®æœ€ä½³å®è·µ](#7-å®‰å…¨é…ç½®æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è®¤è¯ç³»ç»ŸåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è®¤è¯ä¸æˆæƒ


**ğŸ”¸ è®¤è¯ï¼ˆAuthenticationï¼‰- éªŒè¯èº«ä»½**
```
ç®€å•ç†è§£ï¼šç¡®è®¤"ä½ æ˜¯è°"
å°±åƒï¼šé—¨ç¦å¡åˆ·å¡è¿›å…¥åŠå…¬æ¥¼
ç›®çš„ï¼šéªŒè¯ç”¨æˆ·èº«ä»½çš„çœŸå®æ€§
```

**ğŸ”¸ æˆæƒï¼ˆAuthorizationï¼‰- åˆ†é…æƒé™**
```
ç®€å•ç†è§£ï¼šç¡®è®¤"ä½ èƒ½åšä»€ä¹ˆ"
å°±åƒï¼šå‘˜å·¥å¡å†³å®šä½ èƒ½è¿›å“ªäº›æˆ¿é—´
ç›®çš„ï¼šæ§åˆ¶ç”¨æˆ·å¯ä»¥è®¿é—®çš„èµ„æº
```

### 1.2 Grafanaè®¤è¯æ¶æ„å›¾


```
ç”¨æˆ·ç™»å½•è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grafanaå‰ç«¯     â”‚ â† ç”¨æˆ·ç•Œé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è®¤è¯ä¸­é—´ä»¶      â”‚ â† éªŒè¯ç”¨æˆ·èº«ä»½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æƒé™æ§åˆ¶å±‚      â”‚ â† æ£€æŸ¥è®¿é—®æƒé™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®è®¿é—®å±‚      â”‚ â† è·å–ç›‘æ§æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å¤–éƒ¨è®¤è¯ç³»ç»Ÿï¼ˆLDAP/OAuth2/SAMLï¼‰
```

### 1.3 è®¤è¯æ–¹å¼å¯¹æ¯”


| è®¤è¯æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **å¤æ‚åº¦** | **å®‰å…¨æ€§** | **ç»´æŠ¤æˆæœ¬** |
|---------|-------------|-----------|-----------|-------------|
| ğŸ  **æœ¬åœ°è®¤è¯** | `å°å›¢é˜Ÿä½¿ç”¨` | `ä½` | `ä¸­ç­‰` | `ä½` |
| ğŸ¢ **LDAPé›†æˆ** | `ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ` | `ä¸­ç­‰` | `é«˜` | `ä¸­ç­‰` |
| ğŸŒ **OAuth2** | `ç¬¬ä¸‰æ–¹å¹³å°æ¥å…¥` | `é«˜` | `é«˜` | `ä¸­ç­‰` |
| ğŸ”’ **SAML** | `å¤§å‹ä¼ä¸šSSO` | `é«˜` | `å¾ˆé«˜` | `é«˜` |

---

## 2. ğŸ‘¤ æœ¬åœ°ç”¨æˆ·è®¤è¯ç®¡ç†


### 2.1 æœ¬åœ°ç”¨æˆ·çš„æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æœ¬åœ°ç”¨æˆ·ï¼Ÿ**
```
æœ¬åœ°ç”¨æˆ·ï¼šç›´æ¥åœ¨Grafanaä¸­åˆ›å»ºå’Œç®¡ç†çš„ç”¨æˆ·è´¦å·
ç‰¹ç‚¹ï¼š
â€¢ ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨Grafanaæ•°æ®åº“ä¸­
â€¢ ç‹¬ç«‹äºå¤–éƒ¨è®¤è¯ç³»ç»Ÿ
â€¢ é€‚åˆå°å›¢é˜Ÿæˆ–æµ‹è¯•ç¯å¢ƒ
```

**æœ¬åœ°è®¤è¯å·¥ä½œæµç¨‹ï¼š**
```
ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç 
    â†“
GrafanaéªŒè¯æ•°æ®åº“ä¸­çš„ç”¨æˆ·ä¿¡æ¯
    â†“
éªŒè¯æˆåŠŸ â†’ ç”Ÿæˆä¼šè¯ä»¤ç‰Œ
    â†“
ç”¨æˆ·è·å¾—ç³»ç»Ÿè®¿é—®æƒé™
```

### 2.2 åˆ›å»ºå’Œç®¡ç†æœ¬åœ°ç”¨æˆ·


**ğŸ”§ é€šè¿‡Webç•Œé¢ç®¡ç†**

**æ­¥éª¤1ï¼šè®¿é—®ç”¨æˆ·ç®¡ç†**
```
å¯¼èˆªè·¯å¾„ï¼š
Configurationï¼ˆé…ç½®ï¼‰ â†’ Usersï¼ˆç”¨æˆ·ï¼‰ â†’ New Userï¼ˆæ–°å»ºç”¨æˆ·ï¼‰
```

**æ­¥éª¤2ï¼šå¡«å†™ç”¨æˆ·ä¿¡æ¯**
```yaml
# ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
å§“å: å¼ ä¸‰
é‚®ç®±: zhangsan@company.com  
ç”¨æˆ·å: zhangsan
å¯†ç : [è®¾ç½®å¼ºå¯†ç ]

# æƒé™è®¾ç½®
ç»„ç»‡è§’è‰²: Editorï¼ˆç¼–è¾‘è€…ï¼‰
å›¢é˜Ÿ: å¼€å‘å›¢é˜Ÿ
```

**ğŸ”§ é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†**

é…ç½®æ–‡ä»¶ä½ç½®ï¼š`/etc/grafana/grafana.ini`
```ini
[users]
# å…è®¸ç”¨æˆ·æ³¨å†Œ
allow_sign_up = false

# é»˜è®¤ç»„ç»‡è§’è‰²
auto_assign_org_role = Viewer

# å¯†ç å¤æ‚åº¦è¦æ±‚
password_hint = "å¯†ç è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—"
```

### 2.3 ç”¨æˆ·è§’è‰²æƒé™è¯´æ˜


**ğŸ¯ è§’è‰²æƒé™å¯¹æ¯”è¡¨**

| è§’è‰² | **æŸ¥çœ‹ä»ªè¡¨æ¿** | **ç¼–è¾‘ä»ªè¡¨æ¿** | **ç®¡ç†æ•°æ®æº** | **ç®¡ç†ç”¨æˆ·** | **ç³»ç»Ÿé…ç½®** |
|------|-------------|-------------|-------------|-------------|-------------|
| ğŸ‘ï¸ **Viewer** | `âœ… å¯ä»¥` | `âŒ ä¸å¯ä»¥` | `âŒ ä¸å¯ä»¥` | `âŒ ä¸å¯ä»¥` | `âŒ ä¸å¯ä»¥` |
| âœï¸ **Editor** | `âœ… å¯ä»¥` | `âœ… å¯ä»¥` | `âŒ ä¸å¯ä»¥` | `âŒ ä¸å¯ä»¥` | `âŒ ä¸å¯ä»¥` |
| ğŸ‘‘ **Admin** | `âœ… å¯ä»¥` | `âœ… å¯ä»¥` | `âœ… å¯ä»¥` | `âœ… å¯ä»¥` | `âœ… å¯ä»¥` |

**è§’è‰²é€‰æ‹©å»ºè®®ï¼š**
```
ğŸ‘ï¸ Viewerï¼ˆæŸ¥çœ‹è€…ï¼‰ï¼š
é€‚åˆï¼šä¸šåŠ¡äººå‘˜ã€å®¢æˆ·ã€ä¸´æ—¶è®¿å®¢
æƒé™ï¼šåªèƒ½æŸ¥çœ‹ç°æœ‰ä»ªè¡¨æ¿

âœï¸ Editorï¼ˆç¼–è¾‘è€…ï¼‰ï¼š
é€‚åˆï¼šå¼€å‘äººå‘˜ã€è¿ç»´äººå‘˜
æƒé™ï¼šå¯ä»¥åˆ›å»ºå’Œç¼–è¾‘ä»ªè¡¨æ¿

ğŸ‘‘ Adminï¼ˆç®¡ç†å‘˜ï¼‰ï¼š
é€‚åˆï¼šç³»ç»Ÿç®¡ç†å‘˜ã€æŠ€æœ¯è´Ÿè´£äºº
æƒé™ï¼šæ‹¥æœ‰æ‰€æœ‰ç®¡ç†æƒé™
```

---

## 3. ğŸ¢ LDAPé›†æˆé…ç½®


### 3.1 LDAPæ˜¯ä»€ä¹ˆ


**LDAPåŸºæœ¬æ¦‚å¿µï¼š**
```
LDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰
ç®€å•ç†è§£ï¼šä¼ä¸šçš„"ç”µè¯ç°¿"ç³»ç»Ÿ
ä½œç”¨ï¼šç»Ÿä¸€ç®¡ç†ä¼ä¸šå†…æ‰€æœ‰ç”¨æˆ·çš„è´¦å·ä¿¡æ¯

å°±åƒï¼š
å…¬å¸é€šè®¯å½• â†’ å‘˜å·¥ä¿¡æ¯éƒ½åœ¨é‡Œé¢
LDAP â†’ å‘˜å·¥è´¦å·ä¿¡æ¯éƒ½åœ¨é‡Œé¢
```

**LDAPè®¤è¯æµç¨‹ï¼š**
```
ç”¨æˆ·ç™»å½•Grafana
    â†“
GrafanaæŸ¥è¯¢LDAPæœåŠ¡å™¨
    â†“
LDAPéªŒè¯ç”¨æˆ·è´¦å·å¯†ç 
    â†“
è¿”å›ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
    â†“
Grafanaåˆ›å»ºä¼šè¯
```

### 3.2 LDAPé›†æˆé…ç½®


**é…ç½®æ–‡ä»¶ï¼š** `/etc/grafana/ldap.toml`

```toml
# LDAPæœåŠ¡å™¨é…ç½®
[[servers]]
host = "ldap.company.com"      # LDAPæœåŠ¡å™¨åœ°å€
port = 389                     # ç«¯å£å·ï¼ˆé€šå¸¸389æˆ–636ï¼‰
use_ssl = false               # æ˜¯å¦ä½¿ç”¨SSLåŠ å¯†
start_tls = false             # æ˜¯å¦ä½¿ç”¨TLSåŠ å¯†

# ç»‘å®šDNï¼ˆç®¡ç†å‘˜è´¦å·ï¼‰
bind_dn = "cn=admin,dc=company,dc=com"
bind_password = "admin_password"

# ç”¨æˆ·æœç´¢é…ç½®
search_filter = "(uid=%s)"     # ç”¨æˆ·æœç´¢è¿‡æ»¤å™¨
search_base_dns = ["dc=company,dc=com"]  # æœç´¢åŸºç¡€DN

# ç”¨æˆ·å±æ€§æ˜ å°„
[servers.attributes]
name = "givenName"            # å§“åå­—æ®µ
surname = "sn"                # å§“æ°å­—æ®µ  
username = "uid"              # ç”¨æˆ·åå­—æ®µ
member_of = "memberOf"        # ç»„æˆå‘˜å­—æ®µ
email = "mail"                # é‚®ç®±å­—æ®µ
```

**Grafanaä¸»é…ç½®æ–‡ä»¶ï¼š** `/etc/grafana/grafana.ini`
```ini
[auth.ldap]
enabled = true                # å¯ç”¨LDAPè®¤è¯
config_file = /etc/grafana/ldap.toml
allow_sign_up = true          # å…è®¸LDAPç”¨æˆ·è‡ªåŠ¨æ³¨å†Œ
```

### 3.3 LDAPç»„æ˜ å°„é…ç½®


**ç»„æƒé™æ˜ å°„ç¤ºä¾‹ï¼š**
```toml
# ç®¡ç†å‘˜ç»„
[[servers.group_mappings]]
group_dn = "cn=grafana-admins,ou=groups,dc=company,dc=com"
org_role = "Admin"            # æ˜ å°„ä¸ºç®¡ç†å‘˜è§’è‰²

# ç¼–è¾‘è€…ç»„  
[[servers.group_mappings]]
group_dn = "cn=developers,ou=groups,dc=company,dc=com"
org_role = "Editor"           # æ˜ å°„ä¸ºç¼–è¾‘è€…è§’è‰²

# æŸ¥çœ‹è€…ç»„
[[servers.group_mappings]]
group_dn = "cn=business-users,ou=groups,dc=company,dc=com" 
org_role = "Viewer"           # æ˜ å°„ä¸ºæŸ¥çœ‹è€…è§’è‰²
```

**ç»„ç»‡æ˜ å°„ï¼ˆå¤šç»„ç»‡ç¯å¢ƒï¼‰ï¼š**
```toml
[[servers.group_mappings]]
group_dn = "cn=org1-users,ou=groups,dc=company,dc=com"
org_role = "Editor"
org_id = 1                    # æŒ‡å®šç»„ç»‡ID

[[servers.group_mappings]] 
group_dn = "cn=org2-users,ou=groups,dc=company,dc=com"
org_role = "Viewer"
org_id = 2                    # æŒ‡å®šç»„ç»‡ID
```

### 3.4 LDAPæµ‹è¯•å’Œæ’é”™


**æµ‹è¯•LDAPé…ç½®ï¼š**
```bash
# ä½¿ç”¨grafana-cliæµ‹è¯•LDAPè¿æ¥
grafana-cli admin reset-admin-password admin

# æŸ¥çœ‹LDAPæ—¥å¿—
tail -f /var/log/grafana/grafana.log | grep -i ldap
```

**å¸¸è§é—®é¢˜è§£å†³ï¼š**

> **âŒ è¿æ¥å¤±è´¥**
> 
> **åŸå› ï¼š** ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨åœ°å€é”™è¯¯
> **è§£å†³ï¼š** æ£€æŸ¥é˜²ç«å¢™è®¾ç½®å’ŒLDAPæœåŠ¡å™¨åœ°å€

> **âŒ è®¤è¯å¤±è´¥**
> 
> **åŸå› ï¼š** bind_dnæˆ–å¯†ç é”™è¯¯
> **è§£å†³ï¼š** éªŒè¯ç®¡ç†å‘˜è´¦å·å¯†ç çš„æ­£ç¡®æ€§

> **âŒ ç”¨æˆ·æ‰¾ä¸åˆ°**
> 
> **åŸå› ï¼š** search_filteré…ç½®é”™è¯¯
> **è§£å†³ï¼š** æ£€æŸ¥LDAPç›®å½•ç»“æ„å’Œè¿‡æ»¤å™¨è¯­æ³•

---

## 4. ğŸŒ OAuth2è®¤è¯æ¥å…¥


### 4.1 OAuth2åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯OAuth2ï¼Ÿ**
```
OAuth2ï¼šä¸€ç§æˆæƒæ¡†æ¶
ç®€å•ç†è§£ï¼šè®©ç¬¬ä¸‰æ–¹åº”ç”¨ä»£è¡¨ç”¨æˆ·è®¿é—®èµ„æº
å°±åƒï¼šç”¨å¾®ä¿¡ç™»å½•å…¶ä»–åº”ç”¨ï¼Œä¸ç”¨å•ç‹¬æ³¨å†Œè´¦å·

è®¤è¯æµç¨‹ï¼š
ç”¨æˆ·ç‚¹å‡»"ç”¨GitHubç™»å½•" â†’ è·³è½¬åˆ°GitHub â†’ ç”¨æˆ·æˆæƒ â†’ è¿”å›Grafana â†’ ç™»å½•æˆåŠŸ
```

**OAuth2è§’è‰²è¯´æ˜ï¼š**
```
ğŸ  èµ„æºæ‹¥æœ‰è€…ï¼ˆUserï¼‰: ç”¨æˆ·æœ¬äºº
ğŸ“± å®¢æˆ·ç«¯ï¼ˆClientï¼‰: Grafanaåº”ç”¨
ğŸ” æˆæƒæœåŠ¡å™¨ï¼ˆAuthorization Serverï¼‰: GitHub/Googleç­‰
ğŸ“Š èµ„æºæœåŠ¡å™¨ï¼ˆResource Serverï¼‰: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æœåŠ¡å™¨
```

### 4.2 GitHub OAuth2é›†æˆ


**æ­¥éª¤1ï¼šåœ¨GitHubåˆ›å»ºOAuthåº”ç”¨**
```
1. è®¿é—® GitHub â†’ Settings â†’ Developer settings â†’ OAuth Apps
2. ç‚¹å‡» "New OAuth App"
3. å¡«å†™åº”ç”¨ä¿¡æ¯ï¼š
   Application name: Grafana
   Homepage URL: https://grafana.company.com
   Authorization callback URL: https://grafana.company.com/login/github
```

**æ­¥éª¤2ï¼šé…ç½®Grafana**
```ini
# /etc/grafana/grafana.ini
[auth.github]
enabled = true
allow_sign_up = true
client_id = YOUR_GITHUB_CLIENT_ID
client_secret = YOUR_GITHUB_CLIENT_SECRET
scopes = user:email,read:org
auth_url = https://github.com/login/oauth/authorize
token_url = https://github.com/login/oauth/access_token
api_url = https://api.github.com/user
allowed_organizations = your-org-name    # é™åˆ¶ç»„ç»‡æˆå‘˜
```

### 4.3 Google OAuth2é›†æˆ


**é…ç½®ç¤ºä¾‹ï¼š**
```ini
[auth.google]
enabled = true
allow_sign_up = true
client_id = YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com
client_secret = YOUR_GOOGLE_CLIENT_SECRET
scopes = https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email
auth_url = https://accounts.google.com/o/oauth2/auth
token_url = https://oauth2.googleapis.com/token
api_url = https://www.googleapis.com/oauth2/v1/userinfo
allowed_domains = company.com            # é™åˆ¶åŸŸå
```

### 4.4 è‡ªå®šä¹‰OAuth2æä¾›å•†


**é€šç”¨OAuth2é…ç½®ï¼š**
```ini
[auth.generic_oauth]
enabled = true
name = å…¬å¸SSO
allow_sign_up = true
client_id = YOUR_CLIENT_ID
client_secret = YOUR_CLIENT_SECRET
scopes = openid profile email
auth_url = https://sso.company.com/auth
token_url = https://sso.company.com/token
api_url = https://sso.company.com/userinfo
```

---

## 5. ğŸ”’ SAMLå•ç‚¹ç™»å½•


### 5.1 SAMLåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯SAMLï¼Ÿ**
```
SAMLï¼ˆå®‰å…¨æ–­è¨€æ ‡è®°è¯­è¨€ï¼‰
ç®€å•ç†è§£ï¼šä¼ä¸šçº§çš„"é€šè¡Œè¯"ç³»ç»Ÿ
ä½œç”¨ï¼šä¸€æ¬¡ç™»å½•ï¼Œåˆ°å¤„é€šè¡Œ

å°±åƒï¼š
æœºåœºå®‰æ£€ â†’ é€šè¿‡åå¯ä»¥è¿›å…¥æ‰€æœ‰ç™»æœºå£
SAML â†’ ç™»å½•åå¯ä»¥è®¿é—®æ‰€æœ‰ä¼ä¸šåº”ç”¨
```

**SAMLè®¤è¯æµç¨‹ï¼š**
```
ç”¨æˆ·è®¿é—®Grafana
    â†“
Grafanaé‡å®šå‘åˆ°SAMLèº«ä»½æä¾›å•†
    â†“
ç”¨æˆ·åœ¨èº«ä»½æä¾›å•†å¤„ç™»å½•
    â†“
èº«ä»½æä¾›å•†å‘é€SAMLæ–­è¨€ç»™Grafana
    â†“
GrafanaéªŒè¯æ–­è¨€å¹¶åˆ›å»ºä¼šè¯
```

### 5.2 SAMLé…ç½®


**ä¼ä¸šç‰ˆGrafanaé…ç½®ç¤ºä¾‹ï¼š**
```ini
[auth.saml]
enabled = true
certificate_path = /etc/grafana/saml.crt
private_key_path = /etc/grafana/saml.key
idp_metadata_url = https://sso.company.com/metadata
max_issue_delay = 90s
metadata_valid_duration = 48h
assertion_attribute_name = "Name"
assertion_attribute_login = "Login"  
assertion_attribute_email = "Email"
assertion_attribute_groups = "Groups"
```

### 5.3 Azure AD SAMLé›†æˆ


**Azure ADé…ç½®è¦ç‚¹ï¼š**
```yaml
# Azure ADä¸­çš„é…ç½®
åº”ç”¨åç§°: Grafana
æ ‡è¯†ç¬¦URL: https://grafana.company.com
å›å¤URL: https://grafana.company.com/saml/acs
ç™»å½•URL: https://grafana.company.com/login/saml

# å±æ€§æ˜ å°„
Name: user.displayname
Login: user.userprincipalname  
Email: user.mail
Groups: user.assignedroles
```

---

## 6. ğŸ”‘ APIå¯†é’¥ç®¡ç†


### 6.1 APIå¯†é’¥çš„ä½œç”¨


**ä»€ä¹ˆæ˜¯APIå¯†é’¥ï¼Ÿ**
```
APIå¯†é’¥ï¼šç¨‹åºè®¿é—®Grafanaçš„"é€šè¡Œè¯"
ç”¨é€”ï¼š
â€¢ è‡ªåŠ¨åŒ–è„šæœ¬è®¿é—®Grafana
â€¢ ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ
â€¢ ç›‘æ§æ•°æ®çš„ç¨‹åºåŒ–è·å–

å°±åƒï¼š
é—¨ç¦å¡ â†’ äººå‘˜è¿›å‡º
APIå¯†é’¥ â†’ ç¨‹åºè®¿é—®
```

### 6.2 åˆ›å»ºå’Œç®¡ç†APIå¯†é’¥


**é€šè¿‡Webç•Œé¢åˆ›å»ºï¼š**
```
æ­¥éª¤ï¼š
1. ç™»å½•Grafana â†’ Configuration â†’ API Keys
2. ç‚¹å‡» "New API Key"
3. å¡«å†™ä¿¡æ¯ï¼š
   Key name: è‡ªåŠ¨åŒ–è„šæœ¬å¯†é’¥
   Role: Editor
   Time to live: 1å¹´
4. ç‚¹å‡» "Add" ç”Ÿæˆå¯†é’¥
```

**APIå¯†é’¥æƒé™çº§åˆ«ï¼š**
```
ğŸ‘ï¸ Vieweræƒé™ï¼š
â€¢ åªèƒ½è¯»å–ä»ªè¡¨æ¿å’Œæ•°æ®
â€¢ é€‚åˆï¼šç›‘æ§æŠ¥è¡¨ç”Ÿæˆ

âœï¸ Editoræƒé™ï¼š  
â€¢ å¯ä»¥åˆ›å»ºå’Œä¿®æ”¹ä»ªè¡¨æ¿
â€¢ é€‚åˆï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

ğŸ‘‘ Adminæƒé™ï¼š
â€¢ æ‹¥æœ‰å®Œæ•´ç®¡ç†æƒé™
â€¢ é€‚åˆï¼šç³»ç»Ÿç®¡ç†è„šæœ¬
```

### 6.3 APIå¯†é’¥ä½¿ç”¨ç¤ºä¾‹


**curlå‘½ä»¤ä½¿ç”¨APIå¯†é’¥ï¼š**
```bash
# è·å–æ‰€æœ‰ä»ªè¡¨æ¿
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://grafana.company.com/api/search

# è·å–ç‰¹å®šä»ªè¡¨æ¿
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://grafana.company.com/api/dashboards/uid/DASHBOARD_UID
```

**Pythonè„šæœ¬ä½¿ç”¨ï¼š**
```python
import requests

# APIå¯†é’¥é…ç½®
API_KEY = "your_api_key_here"
GRAFANA_URL = "https://grafana.company.com"

# è¯·æ±‚å¤´è®¾ç½®
headers = {
    "Authorization": f"Bearer {API_KEY}",
    "Content-Type": "application/json"
}

# è·å–ä»ªè¡¨æ¿åˆ—è¡¨
response = requests.get(f"{GRAFANA_URL}/api/search", headers=headers)
dashboards = response.json()
```

### 6.4 APIå¯†é’¥å®‰å…¨ç®¡ç†


**å®‰å…¨æœ€ä½³å®è·µï¼š**

> **ğŸ”’ å¯†é’¥å­˜å‚¨å®‰å…¨**
> - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥
> - ä¸è¦å°†å¯†é’¥å†™å…¥ä»£ç ä¸­
> - ä½¿ç”¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ

> **â° å®šæœŸè½®æ¢å¯†é’¥**
> - è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
> - å®šæœŸæ›´æ–°APIå¯†é’¥
> - åŠæ—¶åˆ é™¤æ— ç”¨å¯†é’¥

> **ğŸ¯ æœ€å°æƒé™åŸåˆ™**
> - æ ¹æ®å®é™…éœ€è¦åˆ†é…æƒé™
> - é¿å…ä½¿ç”¨Adminæƒé™å¯†é’¥
> - ä¸ºä¸åŒç”¨é€”åˆ›å»ºä¸åŒå¯†é’¥

---

## 7. ğŸ›¡ï¸ å®‰å…¨é…ç½®æœ€ä½³å®è·µ


### 7.1 å¯†ç å®‰å…¨ç­–ç•¥


**å¯†ç å¤æ‚åº¦é…ç½®ï¼š**
```ini
[security]
# å¯†ç æœ€å°é•¿åº¦
min_password_length = 8

# ç¦ç”¨å¸¸è§å¯†ç 
disable_gravatar = true

# ä¼šè¯å®‰å…¨
cookie_secure = true
cookie_samesite = strict
strict_transport_security = true
```

**å¼ºå¯†ç è¦æ±‚ï¼š**
```
å¯†ç å¤æ‚åº¦è¦æ±‚ï¼š
âœ… è‡³å°‘8ä¸ªå­—ç¬¦
âœ… åŒ…å«å¤§å†™å­—æ¯
âœ… åŒ…å«å°å†™å­—æ¯  
âœ… åŒ…å«æ•°å­—
âœ… åŒ…å«ç‰¹æ®Šå­—ç¬¦
âŒ é¿å…å¸¸è§å¯†ç ï¼ˆ123456ã€passwordç­‰ï¼‰
```

### 7.2 ä¼šè¯ç®¡ç†


**ä¼šè¯å®‰å…¨é…ç½®ï¼š**
```ini
[session]
# ä¼šè¯æä¾›å•†
provider = mysql

# ä¼šè¯è¶…æ—¶ï¼ˆç§’ï¼‰
session_life_time = 86400

# ä¼šè¯å­˜å‚¨é…ç½®
provider_config = user:password@tcp(localhost:3306)/grafana_session

# Cookieé…ç½®
cookie_name = grafana_sess
cookie_secure = true
```

**å¤šè®¾å¤‡ç™»å½•ç®¡ç†ï¼š**
```
ä¼šè¯ç®¡ç†ç­–ç•¥ï¼š
â€¢ å•è®¾å¤‡ç™»å½•ï¼šæ–°ç™»å½•ä¼šè¸¢å‡ºæ—§ä¼šè¯
â€¢ å¤šè®¾å¤‡ç™»å½•ï¼šå…è®¸å¤šä¸ªè®¾å¤‡åŒæ—¶åœ¨çº¿
â€¢ å®šæ—¶æ¸…ç†ï¼šæ¸…ç†è¿‡æœŸä¼šè¯
```

### 7.3 è®¿é—®æ§åˆ¶


**IPç™½åå•é…ç½®ï¼š**
```ini
[security]
# å…è®¸çš„IPåœ°å€èŒƒå›´
allow_embedding = true
allowed_ips = 192.168.1.0/24,10.0.0.0/8

# ç¦ç”¨åŒ¿åè®¿é—®
disable_initial_admin_creation = true
```

**HTTPSå¼ºåˆ¶é…ç½®ï¼š**
```ini
[server]
# å¼ºåˆ¶ä½¿ç”¨HTTPS
protocol = https
enforce_domain = true
cert_file = /etc/ssl/grafana.crt
cert_key = /etc/ssl/grafana.key
```

### 7.4 å®¡è®¡æ—¥å¿—


**å¯ç”¨å®¡è®¡æ—¥å¿—ï¼š**
```ini
[log]
# æ—¥å¿—çº§åˆ«
level = info

# å®¡è®¡æ—¥å¿—
[auditing]
enabled = true
loggers = "console,file"

# è®°å½•çš„æ“ä½œç±»å‹
log_dashboard_content = true
log_requests = true
```

**æ—¥å¿—ç›‘æ§è¦ç‚¹ï¼š**
```
å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
ğŸ” ç™»å½•å¤±è´¥æ¬¡æ•°
ğŸ” æƒé™æå‡æ“ä½œ
ğŸ” æ•æ„Ÿé…ç½®ä¿®æ”¹
ğŸ” å¼‚å¸¸è®¿é—®æ¨¡å¼
ğŸ” APIè°ƒç”¨é¢‘ç‡
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è®¤è¯æ–¹å¼é€‰æ‹©æŒ‡å—


**ğŸ¯ åœºæ™¯åŒ¹é…è¡¨**

| ä½¿ç”¨åœºæ™¯ | **æ¨èæ–¹æ¡ˆ** | **ç†ç”±** |
|---------|-------------|---------|
| ğŸ  **å°å›¢é˜Ÿï¼ˆ<10äººï¼‰** | `æœ¬åœ°è®¤è¯` | `ç®€å•æ˜“ç®¡ç†` |
| ğŸ¢ **ä¼ä¸šå†…éƒ¨** | `LDAPé›†æˆ` | `ç»Ÿä¸€è´¦å·ç®¡ç†` |
| ğŸŒ **å¼€æ”¾å›¢é˜Ÿ** | `OAuth2` | `ä¾¿æ·ç¬¬ä¸‰æ–¹ç™»å½•` |
| ğŸ›ï¸ **å¤§å‹ä¼ä¸š** | `SAML SSO` | `ä¼ä¸šçº§å®‰å…¨æ ‡å‡†` |

### 8.2 å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•


**âœ… å¿…å¤‡å®‰å…¨æªæ–½ï¼š**
```
ğŸ” è®¤è¯å®‰å…¨ï¼š
- [ ] å¼ºå¯†ç ç­–ç•¥å·²å¯ç”¨
- [ ] å¤šå› ç´ è®¤è¯å·²é…ç½®
- [ ] å®šæœŸå¯†ç æ›´æ–°æœºåˆ¶
- [ ] è´¦å·é”å®šç­–ç•¥

ğŸ”’ è®¿é—®æ§åˆ¶ï¼š
- [ ] æœ€å°æƒé™åŸåˆ™
- [ ] IPç™½åå•é™åˆ¶
- [ ] ä¼šè¯è¶…æ—¶è®¾ç½®
- [ ] HTTPSå¼ºåˆ¶å¯ç”¨

ğŸ“Š ç›‘æ§å®¡è®¡ï¼š
- [ ] ç™»å½•æ—¥å¿—è®°å½•
- [ ] æ“ä½œå®¡è®¡å¼€å¯
- [ ] å¼‚å¸¸å‘Šè­¦é…ç½®
- [ ] å®šæœŸå®‰å…¨æ£€æŸ¥
```

### 8.3 æ•…éšœæ’æŸ¥æ€è·¯


**ğŸ”§ å¸¸è§é—®é¢˜è¯Šæ–­ï¼š**

```
ç™»å½•é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š
1ï¸âƒ£ æ£€æŸ¥è®¤è¯é…ç½®æ˜¯å¦æ­£ç¡®
2ï¸âƒ£ æŸ¥çœ‹Grafanaæ—¥å¿—æ–‡ä»¶
3ï¸âƒ£ æµ‹è¯•å¤–éƒ¨è®¤è¯æœåŠ¡è¿é€šæ€§
4ï¸âƒ£ éªŒè¯ç”¨æˆ·æƒé™é…ç½®
5ï¸âƒ£ æ£€æŸ¥ç½‘ç»œå’Œé˜²ç«å¢™è®¾ç½®
```

**ğŸ“‹ é…ç½®éªŒè¯å‘½ä»¤ï¼š**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
grafana-cli admin config-check

# æµ‹è¯•LDAPè¿æ¥  
grafana-cli admin ldap-test

# æŸ¥çœ‹è®¤è¯æ—¥å¿—
tail -f /var/log/grafana/grafana.log | grep -i auth
```

### 8.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ éƒ¨ç½²å»ºè®®ï¼š**

> **ğŸ”„ æ¸è¿›å¼éƒ¨ç½²**
> 1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®
> 2. å°èŒƒå›´è¯•ç‚¹éƒ¨ç½²
> 3. é€æ­¥æ‰©å±•åˆ°å…¨ä½“ç”¨æˆ·
> 4. å»ºç«‹å›æ»šæœºåˆ¶

> **ğŸ“š æ–‡æ¡£åŒ–ç®¡ç†**
> - è¯¦ç»†è®°å½•é…ç½®æ­¥éª¤
> - å»ºç«‹æ“ä½œæ‰‹å†Œ
> - åˆ¶å®šåº”æ€¥é¢„æ¡ˆ
> - å®šæœŸæ›´æ–°æ–‡æ¡£

> **ğŸ‘¥ å›¢é˜Ÿåä½œ**
> - æ˜ç¡®æƒé™åˆ†å·¥
> - å»ºç«‹å®¡æ‰¹æµç¨‹
> - å®šæœŸå®‰å…¨åŸ¹è®­
> - æŒç»­æ”¹è¿›æœºåˆ¶

**ğŸ’¡ æ ¸å¿ƒè®°å¿†ï¼š**
- è®¤è¯è§£å†³"ä½ æ˜¯è°"ï¼Œæˆæƒè§£å†³"ä½ èƒ½åšä»€ä¹ˆ"
- é€‰æ‹©è®¤è¯æ–¹æ¡ˆè¦è€ƒè™‘å›¢é˜Ÿè§„æ¨¡å’Œå®‰å…¨è¦æ±‚
- APIå¯†é’¥è¦å¦¥å–„ä¿ç®¡ï¼Œå®šæœŸè½®æ¢
- å®‰å…¨é…ç½®è¦æŒç»­ç›‘æ§å’Œä¼˜åŒ–