---
title: 3、单位-格式化
---
## 📚 目录

1. [单位格式化基础概念](#1-单位格式化基础概念)
2. [数值单位系统详解](#2-数值单位系统详解)
3. [时间单位格式化](#3-时间单位格式化)
4. [字节存储单位处理](#4-字节存储单位处理)
5. [百分比与比率格式](#5-百分比与比率格式)
6. [货币格式配置](#6-货币格式配置)
7. [自定义单位创建](#7-自定义单位创建)
8. [实际应用场景](#8-实际应用场景)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🎯 单位格式化基础概念


### 1.1 什么是单位格式化


**简单理解**：把原始数字变成人类容易理解的带单位格式

```
原始数据看起来：
CPU使用率: 0.85        → 不直观
内存使用: 8589934592   → 看不懂
响应时间: 0.125        → 不清楚单位

格式化后变成：
CPU使用率: 85%         → 一目了然！
内存使用: 8.0 GB       → 清晰明了！
响应时间: 125 ms       → 直观易懂！
```

> 💡 **核心作用**：让监控数据从"机器语言"变成"人类语言"

### 1.2 为什么需要单位格式化


**实际场景对比**：
```
场景1：服务器内存监控
原始数据：16106127360
格式化后：15.0 GB

场景2：网络带宽监控  
原始数据：104857600
格式化后：100 Mbps

场景3：磁盘使用率
原始数据：0.8542
格式化后：85.42%
```

**解决的问题**：
- **🔸 可读性差**：原始数字太长或太小，难以理解
- **🔸 单位混乱**：不知道是字节还是MB，是秒还是毫秒
- **🔸 对比困难**：无法快速判断数值大小关系
- **🔸 报警误判**：没有合适单位容易设错阈值

### 1.3 Grafana单位系统架构


```
Grafana单位格式化体系
┌─────────────────────────────────────┐
│            原始数据输入              │
├─────────────────────────────────────┤
│          单位检测与识别              │
├─────────────────────────────────────┤
│          格式化规则应用              │ 
├─────────────────────────────────────┤
│          数值转换计算               │
├─────────────────────────────────────┤ 
│          单位符号添加               │
├─────────────────────────────────────┤
│          最终显示输出               │
└─────────────────────────────────────┘
```

---

## 2. 📊 数值单位系统详解


### 2.1 基础数值单位


**常见数值单位分类**：

| 单位类型 | **Grafana代码** | **显示效果** | **适用场景** |
|---------|---------------|-------------|-------------|
| **无单位** | `none` | `1234` | 纯数字计数 |
| **短格式** | `short` | `1.2K` | 用户数、请求数 |
| **科学计数** | `scientific` | `1.23e+3` | 科学计算 |
| **工程计数** | `engineering` | `1.234K` | 工程数据 |

**数值单位配置示例**：
```json
{
  "unit": "short",
  "decimals": 2,
  "min": 0,
  "max": null
}
```

### 2.2 度量衡单位系统


**长度单位**：
```
米制单位：
- mm (毫米)    → 1000 显示为 1.0K mm  
- cm (厘米)    → 100 显示为 100 cm
- m (米)       → 1000 显示为 1.0 km
- km (千米)    → 5000 显示为 5.0 km

英制单位：
- inch (英寸)  → 12 显示为 1.0 ft
- ft (英尺)    → 3 显示为 1.0 yd  
- yard (码)    → 1760 显示为 1.0 mile
- mile (英里)  → 距离显示
```

**重量单位**：
```
公制重量：
- mg (毫克)    → 1000 mg = 1.0 g
- g (克)       → 1000 g = 1.0 kg  
- kg (千克)    → 1000 kg = 1.0 t
- t (吨)       → 大重量显示

英制重量：
- oz (盎司)    → 16 oz = 1.0 lb
- lb (磅)      → 2000 lb = 1.0 ton
```

> 📌 **实用提示**：选择单位时考虑用户习惯，中国用户更熟悉公制

### 2.3 能量与功率单位


**能量单位应用**：
```
基础能量单位：
┌──────────────┬─────────────┬───────────────┐
│   原始数值    │   单位设置   │   显示效果     │
├──────────────┼─────────────┼───────────────┤
│   1000       │   joule     │   1.0 kJ      │
│   3600000    │   joule     │   3.6 MJ      │  
│   1000       │   watt      │   1.0 kW      │
│   1000000    │   watt      │   1.0 MW      │
└──────────────┴─────────────┴───────────────┘

实际应用场景：
- 服务器功耗监控 → 使用 watt
- 数据中心能耗 → 使用 kilowatt  
- UPS电池容量 → 使用 watthour
```

---

## 3. ⏰ 时间单位格式化


### 3.1 时间单位基础


**时间单位层级**：
```
时间单位从小到大：
纳秒(ns) → 微秒(µs) → 毫秒(ms) → 秒(s) → 分钟(m) → 小时(h) → 天(d)

自动转换示例：
125000000 ns  →  125.0 ms
2500 ms       →  2.5 s  
75 s          →  1.25 m
90 m          →  1.5 h
36 h          →  1.5 d
```

### 3.2 响应时间监控应用


**API响应时间配置**：
```
监控指标：http_request_duration_seconds
原始数据：0.125 (秒)

单位配置：
- 单位类型：time 
- 具体单位：ms (毫秒)
- 小数位：2

显示效果：125.00 ms
```

> 💡 **最佳实践**：API响应时间用毫秒(ms)，数据库查询用秒(s)

### 3.3 时间间隔与持续时间


**不同时间格式对比**：

| 数据类型 | **原始值** | **单位设置** | **显示效果** | **使用场景** |
|---------|----------|-------------|-------------|-------------|
| **响应延迟** | `0.025` | `s` | `25.0 ms` | API监控 |
| **任务执行** | `180` | `s` | `3.0 m` | 批处理任务 |
| **系统运行** | `86400` | `s` | `1.0 d` | 系统运行时间 |
| **会话时长** | `7200` | `s` | `2.0 h` | 用户会话 |

**时钟时间格式**：
```
绝对时间显示：
- dateTimeAsIso     → 2025-09-21T14:30:00Z
- dateTimeAsUS      → 09/21/2025 2:30:00 PM  
- dateTimeAsLocal   → 2025-09-21 14:30:00

相对时间显示：
- dateTimeFromNow   → 2 hours ago
- duration          → 2h 30m 15s
```

---

## 4. 💾 字节存储单位处理


### 4.1 存储单位体系


**二进制 vs 十进制单位**：
```
二进制单位 (IEC标准)：
1024 bytes = 1 KiB (Kibibyte)
1024 KiB   = 1 MiB (Mebibyte)  
1024 MiB   = 1 GiB (Gibibyte)
1024 GiB   = 1 TiB (Tebibyte)

十进制单位 (SI标准)：
1000 bytes = 1 KB (Kilobyte)
1000 KB    = 1 MB (Megabyte)
1000 MB    = 1 GB (Gigabyte) 
1000 GB    = 1 TB (Terabyte)
```

> ⚠️ **重要区别**：硬盘厂商用十进制，操作系统用二进制，会有差异！

### 4.2 内存使用监控


**内存监控配置实例**：
```
指标：node_memory_MemAvailable_bytes
原始数据：8589934592 bytes

配置选项：
┌─────────────────┬─────────────────┬─────────────────┐
│   单位设置       │   显示效果       │   使用建议       │
├─────────────────┼─────────────────┼─────────────────┤
│   bytes         │   8.59G         │   ✅ 推荐      │
│   decbytes      │   8.59GB        │   硬盘容量      │
│   kbytes        │   8388608K      │   不推荐        │
└─────────────────┴─────────────────┴─────────────────┘
```

### 4.3 网络流量单位


**网络带宽监控**：
```
网络流量单位选择：

下载速度监控：
原始数据：125000000 bytes/sec
单位配置：binBps (二进制字节每秒)
显示效果：119.2 MiB/s

网络带宽：  
原始数据：1000000000 bits/sec
单位配置：bps (比特每秒)
显示效果：1.0 Gbps
```

**流量单位对比表**：

| 单位类型 | **Grafana代码** | **含义** | **适用场景** |
|---------|---------------|---------|-------------|
| **字节速率** | `Bps` | 字节/秒 | 文件传输 |
| **二进制字节** | `binBps` | 1024进制 | 系统监控 |
| **比特速率** | `bps` | 比特/秒 | 网络带宽 |
| **数据包率** | `pps` | 包/秒 | 网络性能 |

---

## 5. 📈 百分比与比率格式


### 5.1 百分比显示


**百分比格式化原理**：
```
数据转换过程：
原始小数 → 乘以100 → 添加%符号

示例转换：
0.85    → 85%     (CPU使用率)
0.234   → 23.4%   (内存使用率)  
1.25    → 125%    (负载超额)
0.0056  → 0.56%   (错误率)
```

**CPU使用率监控**：
```json
{
  "fieldConfig": {
    "defaults": {
      "unit": "percent",
      "min": 0,
      "max": 100,
      "decimals": 1
    }
  }
}
```

### 5.2 比率单位应用


**不同比率格式对比**：

| 比率类型 | **原始数据** | **单位设置** | **显示效果** | **应用场景** |
|---------|-------------|-------------|-------------|-------------|
| **百分比** | `0.75` | `percent` | `75%` | CPU、内存使用率 |
| **小数比率** | `0.75` | `percentunit` | `75%` | 成功率统计 |
| **比例** | `1.5` | `none` | `1.5` | 负载比率 |
| **倍数** | `2.0` | `none` | `2.0x` | 性能倍数 |

### 5.3 错误率与成功率


**错误率监控实例**：
```
HTTP错误率计算：
错误请求数 / 总请求数 = 错误率

Prometheus查询：
rate(http_requests_total{status=~"5.."}[5m]) / 
rate(http_requests_total[5m])

结果：0.001234
单位：percent  
显示：0.12%
```

> 📊 **监控建议**：错误率用百分比，响应时间用毫秒，吞吐量用每秒

---

## 6. 💰 货币格式配置


### 6.1 货币单位基础


**主要货币单位**：
```
常用货币代码：
USD - 美元    → $1,234.56
EUR - 欧元    → €1,234.56  
CNY - 人民币  → ¥1,234.56
GBP - 英镑    → £1,234.56
JPY - 日元    → ¥1,234 (无小数点)
```

### 6.2 成本监控应用


**云服务成本监控**：
```
AWS账单监控：
原始数据：1234.5678 (美元)
单位配置：currencyUSD
显示效果：$1,234.57

阿里云费用：
原始数据：8888.88 (人民币)  
单位配置：currencyCNY
显示效果：¥8,888.88
```

**货币格式配置**：
```json
{
  "unit": "currencyUSD",
  "decimals": 2,
  "min": 0,
  "thresholds": {
    "mode": "absolute",
    "steps": [
      {"color": "green", "value": 0},
      {"color": "yellow", "value": 1000}, 
      {"color": "red", "value": 5000}
    ]
  }
}
```

---

## 7. 🛠️ 自定义单位创建


### 7.1 自定义单位场景


**业务专用单位示例**：
```
电商业务：
- 订单数：单位设置为 "orders"
- 商品件数：单位设置为 "pieces"  
- 用户活跃度：单位设置为 "score"

游戏业务：
- 在线玩家：单位设置为 "players"
- 游戏局数：单位设置为 "games"
- 经验值：单位设置为 "exp"
```

### 7.2 创建自定义单位步骤


**步骤流程**：
```
第1步：进入面板编辑
    ↓
第2步：选择Field选项卡  
    ↓
第3步：找到Unit设置
    ↓
第4步：选择"Custom"
    ↓  
第5步：输入自定义单位名称
    ↓
第6步：设置显示格式
    ↓
第7步：保存配置
```

### 7.3 自定义单位最佳实践


**命名规范建议**：
```
✅ 好的单位名称：
- "requests/sec"  → 清晰表达含义
- "orders"        → 简洁易懂  
- "active_users"  → 描述准确

❌ 避免的命名：
- "r/s"          → 缩写不清楚
- "num"          → 过于模糊
- "data"         → 没有具体含义
```

**自定义单位配置示例**：
```json
{
  "unit": "custom:requests/sec",
  "displayName": "请求速率", 
  "decimals": 1,
  "suffix": " req/s"
}
```

---

## 8. 🎯 实际应用场景


### 8.1 系统监控仪表盘


**完整监控面板单位配置**：
```
CPU使用率面板：
┌─────────────────────────────────────┐
│ CPU Usage                    85.2%  │
│ ▓▓▓▓▓▓▓▓▓░ 85.2%                   │
│ 单位：percent | 范围：0-100         │
└─────────────────────────────────────┘

内存使用面板：
┌─────────────────────────────────────┐
│ Memory Usage              12.5/16GB │
│ ▓▓▓▓▓▓▓▓░░ 78.1%                   │
│ 单位：bytes | 显示：分数形式         │
└─────────────────────────────────────┘

网络流量面板：
┌─────────────────────────────────────┐
│ Network I/O                         │
│ 入站: 125.6 MB/s ↓                  │
│ 出站: 89.3 MB/s ↑                   │
│ 单位：binBps | 方向：双向            │
└─────────────────────────────────────┘
```

### 8.2 应用性能监控


**APM监控单位设置**：

| 监控指标 | **原始数据** | **单位设置** | **显示效果** | **告警阈值** |
|---------|-------------|-------------|-------------|-------------|
| **响应时间** | `0.125` | `s` | `125 ms` | `> 500ms` |
| **QPS** | `1500` | `reqps` | `1.5K req/s` | `< 100 req/s` |
| **错误率** | `0.001` | `percent` | `0.1%` | `> 1%` |
| **并发数** | `250` | `none` | `250` | `> 1000` |

### 8.3 业务监控场景


**电商业务监控**：
```
订单监控面板：
实时订单数：1,234 orders
订单金额：¥156,789.00  
转化率：3.45%
客单价：¥127.50

配置要点：
- 订单数：使用short单位自动转换K/M
- 金额：使用currencyCNY显示人民币
- 转化率：使用percent显示百分比  
- 客单价：使用货币格式保留2位小数
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 单位格式化：让原始数字变成人类可读的格式
🔸 单位体系：数值、时间、字节、百分比、货币五大类
🔸 自动转换：Grafana根据数值大小自动选择合适单位
🔸 显示精度：通过decimals控制小数位数
🔸 自定义单位：为特殊业务场景创建专用单位
```

### 9.2 实用配置原则


**🔹 单位选择原则**：
```
看数据类型：
- 时间类数据 → 选择时间单位(s/ms/m/h)
- 存储类数据 → 选择字节单位(bytes/KB/MB/GB)  
- 比率类数据 → 选择百分比单位(percent)
- 计数类数据 → 选择数值单位(short/none)

看用户习惯：
- 中国用户 → 优先公制单位、人民币
- 技术监控 → 二进制字节单位  
- 业务监控 → 十进制单位更直观
```

**🔹 显示优化技巧**：
```
合理设置小数位：
- 百分比：1-2位小数(85.2%)
- 金额：2位小数(¥123.45)  
- 响应时间：0-1位小数(125ms)
- 大数值：0位小数(1.2K)

设置合理范围：
- 百分比：0-100或0-200
- 响应时间：0开始，不设上限
- 错误率：0-10%范围足够
```

### 9.3 常见问题解决


**🔧 问题排查清单**：
```
显示异常检查：
□ 单位类型是否匹配数据
□ 小数位设置是否合理  
□ 数据范围是否正确
□ 是否需要自定义单位

性能优化：
□ 避免过多小数位计算
□ 大数据量用短格式(short)
□ 实时监控用缓存单位
□ 历史数据用压缩显示
```

**🎯 最佳实践总结**：
- **一致性**：同类型面板使用相同单位
- **直观性**：选择用户最熟悉的单位格式  
- **精确性**：关键指标保留足够精度
- **简洁性**：避免过长的单位名称
- **适应性**：根据数值范围自动调整

**核心记忆口诀**：
```
单位格式化，数据变直观
时间字节率，百分比货币
自动选合适，自定义灵活
一致简洁准，用户体验佳
```

> 💡 **学习建议**：多实践不同单位配置，观察显示效果差异，形成最适合自己业务的单位配置规范