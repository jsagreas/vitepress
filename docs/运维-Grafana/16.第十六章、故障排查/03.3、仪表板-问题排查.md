---
title: 3、仪表板-问题排查
---
## 📚 目录

1. [问题排查概述](#1-问题排查概述)
2. [数据不显示问题](#2-数据不显示问题)
3. [加载缓慢问题](#3-加载缓慢问题)
4. [变量错误排查](#4-变量错误排查)
5. [查询语法错误](#5-查询语法错误)
6. [面板配置问题](#6-面板配置问题)
7. [性能问题排查](#7-性能问题排查)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔍 问题排查概述


### 1.1 为什么要学习故障排查


想象一下这样的场景：你精心制作了一个监控仪表板，本来应该显示服务器的CPU使用率曲线，结果打开一看是空白的；或者明明数据源有数据，但图表就是不显示；又或者仪表板加载特别慢，领导等得不耐烦了...

**🎯 这就是为什么我们需要掌握故障排查技能！**

```
监控系统就像汽车仪表盘：
🚗 正常情况：各种指示灯、数字清晰显示
❌ 故障情况：指示灯不亮、数字不准、反应慢

我们的工作就是成为"汽车修理师"
快速找到问题，恢复正常显示
```

### 1.2 常见问题分类


| 问题类型 | 📊 常见程度 | 🕐 解决难度 | 💡 典型症状 |
|---------|-----------|-----------|-----------|
| **数据不显示** | `⭐⭐⭐⭐⭐` | `⭐⭐⭐` | `空白图表、No data` |
| **加载缓慢** | `⭐⭐⭐⭐` | `⭐⭐⭐⭐` | `转圈圈、超时` |
| **变量错误** | `⭐⭐⭐` | `⭐⭐` | `下拉框空白、筛选失效` |
| **查询语法错误** | `⭐⭐⭐⭐` | `⭐⭐` | `红色错误提示` |
| **面板配置错误** | `⭐⭐⭐` | `⭐⭐` | `图表类型不对、样式异常` |
| **性能问题** | `⭐⭐` | `⭐⭐⭐⭐⭐` | `整体卡顿、内存占用高` |

### 1.3 排查思路框架


```
🔍 Grafana问题排查金字塔

                  📊 用户体验层
                 ┌─────────────┐
                 │  看到什么？  │ ← 现象观察
                 └─────────────┘
                        │
                 ┌─────────────┐
                 │  哪里出错？  │ ← 定位问题
                 └─────────────┘
                        │
            ┌──────────────────────────┐
            │        为什么错？         │ ← 分析原因  
            └──────────────────────────┘
                        │
       ┌────────────────────────────────────┐
       │             怎么修？               │ ← 解决方案
       └────────────────────────────────────┘
```

**🧠 记忆口诀：** *"看现象，找位置，析原因，定方案"*

---

## 2. 📈 数据不显示问题


### 2.1 问题现象识别


**典型症状对照表：**

| 症状描述 | 🖼️ 界面表现 | 🎯 可能原因 |
|---------|-----------|-----------|
| 完全空白 | `灰色背景，什么都没有` | `数据源连接问题` |
| "No data" | `显示"No data"文字` | `查询结果为空` |
| Loading... | `一直转圈加载` | `查询超时或语法错误` |
| 红色感叹号 | `面板显示错误图标` | `查询语法错误` |

### 2.2 排查步骤详解


**步骤 1️⃣：检查数据源连接**

```
数据源连接检查清单：
┌─ 💾 数据源设置
├─ 🌐 网络连接
├─ 🔑 认证信息  
├─ 📡 端口开放
└─ 🔄 服务状态
```

**具体操作方法：**
- 进入 **Configuration** → **Data Sources**
- 找到对应数据源，点击进入设置页面
- 点击 <kbd>Test</kbd> 按钮测试连接
- 观察返回结果：
  - `✅ Data source is working` ← 连接正常
  - `❌ HTTP Error 500` ← 服务器错误
  - `❌ Connection refused` ← 网络问题

**步骤 2️⃣：验证查询语句**

> 💡 **新手提示**
> 
> 查询语句就像问数据库的问题，如果问题表达不清楚，数据库就不知道要给你什么答案

**检查重点：**
- **时间范围**：确保查询的时间段内有数据
- **指标名称**：检查指标名是否拼写正确  
- **标签过滤**：确认过滤条件没有把所有数据都排除了

**步骤 3️⃣：查看查询结果**

点击面板标题 → **Edit** → **Query** 标签页，在底部可以看到：

```
Query inspector 查询检查器显示：
┌────────────────────────────────┐
│ 📊 数据预览                     │
│ ┌─────┬─────┬─────┬─────┐      │
│ │Time │Value│Label│...  │      │  
│ ├─────┼─────┼─────┼─────┤      │
│ │14:30│ 85.2│cpu01│...  │      │
│ └─────┴─────┴─────┴─────┘      │
└────────────────────────────────┘
```

如果这里没有数据，说明查询本身有问题；如果有数据但面板不显示，说明是面板配置问题。

### 2.3 常见解决方案


**🔧 方案一：修复数据源连接**

| 错误类型 | 💊 解决方法 | ⏱️ 预计耗时 |
|---------|-----------|-----------|
| URL错误 | `检查数据源URL格式` | `2分钟` |
| 端口错误 | `确认端口号正确` | `1分钟` |
| 认证失败 | `更新用户名密码` | `3分钟` |
| 网络不通 | `检查防火墙设置` | `10分钟` |

**🔧 方案二：修正查询语句**

常见的查询错误修正：

```
❌ 错误写法：
up{job="prometheus"}[5m]

✅ 正确写法：  
up{job="prometheus"}

说明：瞬时查询不需要时间范围选择器
```

```
❌ 错误写法：
cpu_usage{instance="server01"}

✅ 正确写法：
cpu_usage{instance="server-01"}  

说明：检查实例名称的准确拼写
```

---

## 3. ⏳ 加载缓慢问题


### 3.1 问题现象分析


**加载缓慢的几种表现：**

```
加载速度对比表：
正常加载: [████████████████████] 100% (2秒内)
稍慢加载: [██████████░░░░░░░░░░] 50%  (5-10秒)  
很慢加载: [████░░░░░░░░░░░░░░░░] 20%  (30秒+)
卡死状态: [█░░░░░░░░░░░░░░░░░░░] 5%   (转圈不停)
```

### 3.2 性能诊断工具


**🔍 方法一：使用浏览器开发者工具**

按 <kbd>F12</kbd> 打开开发者工具，查看：

- **Network标签**：查看HTTP请求耗时
- **Performance标签**：分析页面渲染性能
- **Console标签**：查看是否有JavaScript错误

**🔍 方法二：Grafana内置性能监控**

进入面板编辑模式，查看 **Query inspector**：

```
查询性能指标解读：
┌─────────────────────────┐
│ 📊 Query Performance    │
├─────────────────────────┤  
│ Request time: 1.2s      │ ← 请求耗时
│ Response size: 245KB    │ ← 响应大小
│ Series returned: 1250   │ ← 返回序列数
│ Samples: 125,000        │ ← 样本点数
└─────────────────────────┘
```

**性能指标含义：**
- **Request time > 5s** → 查询过于复杂
- **Series returned > 1000** → 返回数据过多
- **Samples > 100,000** → 时间跨度太大

### 3.3 优化策略


**🚀 策略一：优化查询语句**

> ⚠️ **重要提醒**
> 
> 查询优化就像开车选路线，绕远路虽然也能到达目的地，但会浪费很多时间

```
❌ 低效查询示例：
rate(http_requests_total[5m]) * 60

✅ 高效查询示例：  
increase(http_requests_total[5m])

说明：直接使用increase()函数更高效
```

**🚀 策略二：合理设置时间范围**

| 时间跨度 | 📊 数据点数 | ⚡ 加载速度 | 💡 建议用途 |
|---------|-----------|-----------|-----------|
| 1小时 | `~3,600` | `很快` | `实时监控` |
| 1天 | `~86,400` | `较快` | `日常分析` |
| 1周 | `~604,800` | `较慢` | `趋势分析` |
| 1月 | `~2,592,000` | `很慢` | `长期规划` |

**🚀 策略三：使用数据聚合**

```
时序数据聚合示意：
原始数据 (每秒1个点):
●●●●●●●●●●●●●●●●●●●●●●●●●●●●●●

聚合后 (每分钟1个点):  
    ●     ●     ●     ●     ●

数据量减少: 60:1 = 98.3%减少
```

---

## 4. 🔧 变量错误排查


### 4.1 变量系统基础理解


**什么是Grafana变量？**

把变量想象成遥控器的频道按钮：

```
🎛️ 电视遥控器类比：
按1号键 → 切换到CCTV1
按2号键 → 切换到CCTV2  
按3号键 → 切换到CCTV3

📊 Grafana变量：
选择server01 → 显示server01的监控数据
选择server02 → 显示server02的监控数据
选择server03 → 显示server03的监控数据
```

### 4.2 常见变量问题


**问题清单与解决方案：**

| 🐛 问题现象 | 🔍 可能原因 | 🔧 解决方法 |
|------------|-----------|-----------|
| 下拉框为空 | `查询语句错误` | `检查Variable查询` |
| 选项显示乱码 | `编码问题` | `检查数据源编码设置` |
| 变量不生效 | `引用语法错误` | `检查$variable语法` |
| 多选失效 | `查询不支持多值` | `使用正则表达式` |

### 4.3 变量调试技巧


**🔍 调试步骤：**

**步骤 1️⃣：** 检查变量定义
- 进入 **Dashboard Settings** → **Variables**
- 查看变量的Query设置
- 点击 **Preview of values** 预览结果

**步骤 2️⃣：** 测试变量查询
在Query editor中单独测试变量的查询语句：

```
变量查询示例：
label_values(up, instance)

解释：获取up指标的所有instance标签值
```

**步骤 3️⃣：** 验证变量引用
确保在面板查询中正确引用变量：

```
❌ 错误引用：
cpu_usage{instance="$instance"}

✅ 正确引用：
cpu_usage{instance=~"$instance"}

说明：多选变量需要使用=~操作符
```

---

## 5. ⚠️ 查询语法错误


### 5.1 语法错误识别


**错误提示解读表：**

| 🚨 错误信息 | 📝 含义解释 | 🎯 常见原因 |
|------------|-----------|-----------|
| `parse error` | `语法解析错误` | `拼写错误、括号不匹配` |
| `bad_data` | `数据格式错误` | `查询返回的数据格式不正确` |
| `timeout` | `查询超时` | `查询过于复杂或数据量过大` |
| `no such metric` | `指标不存在` | `指标名称错误` |

### 5.2 常见语法问题修正


**🔧 修正案例集：**

**案例一：函数参数错误**
```
❌ 错误：rate(cpu_usage)
❓ 问题：rate函数缺少时间范围参数

✅ 修正：rate(cpu_usage[5m])  
💡 说明：rate函数必须指定时间窗口
```

**案例二：标签匹配语法**
```
❌ 错误：cpu_usage{instance="server-01","server-02"}
❓ 问题：多个值的语法不正确

✅ 修正：cpu_usage{instance=~"server-01|server-02"}
💡 说明：多值匹配需要使用正则表达式
```

**案例三：聚合函数使用**
```
❌ 错误：sum(cpu_usage) by instance
❓ 问题：by子句语法不正确

✅ 修正：sum(cpu_usage) by (instance)
💡 说明：by子句的标签需要用括号包围
```

### 5.3 语法学习建议


> 🧠 **学习心得**
> 
> 学习PromQL就像学习外语，多练习、多观察，慢慢就能掌握语法规律

**📚 推荐学习路径：**

```
学习进度条：
新手阶段: [████░░░░░░░░░░░░░░░░] 20%
├─ 基础查询语法
├─ 常用函数
└─ 标签过滤

进阶阶段: [████████░░░░░░░░░░░░] 40%  
├─ 聚合操作
├─ 数学运算
└─ 时间函数

高级阶段: [████████████████████] 100%
├─ 复杂查询组合
├─ 性能优化
└─ 高级函数应用
```

---

## 6. 🎨 面板配置问题


### 6.1 面板类型选择指南


**面板类型适用场景：**

```
📊 数据可视化选择指南

单值数据 → Stat面板
  ├─ 当前CPU使用率: 85%
  ├─ 在线用户数: 1,250
  └─ 磁盘剩余空间: 45GB

时序数据 → Time series面板  
  ├─ CPU使用率趋势图
  ├─ 内存使用量变化
  └─ 网络流量波动

分类数据 → Bar chart面板
  ├─ 各服务器负载对比
  ├─ 不同应用的请求量
  └─ 错误类型分布

地理数据 → Geomap面板
  ├─ 全球用户分布
  ├─ 服务器地理位置
  └─ CDN节点状态
```

### 6.2 常见配置错误


**❌ 错误配置 vs ✅ 正确配置对比：**

| 配置项 | ❌ 错误做法 | ✅ 正确做法 | 💡 说明 |
|-------|-----------|-----------|-------|
| 单位设置 | `不设置单位` | `设置为bytes/percent等` | `方便读取数值` |
| Y轴范围 | `使用默认自动` | `根据数据特点设置` | `避免误导性显示` |
| 颜色方案 | `随机选择颜色` | `使用语义化颜色` | `红色=危险，绿色=正常` |
| 图例显示 | `显示所有图例` | `隐藏不必要图例` | `保持界面整洁` |

### 6.3 面板美化技巧


**🎨 视觉优化清单：**

- **颜色搭配**：使用企业VI色彩或标准配色方案
- **字体大小**：标题14px+，内容12px+，确保可读性
- **间距布局**：面板间保持适当间距，避免拥挤
- **对齐方式**：统一左对齐或居中对齐

```
面板布局黄金比例：
┌─────────────────────────────────┐
│ 📊 主要监控指标 (60%区域)        │
├─────────────────┬───────────────┤
│ 📈 趋势图表     │ 📋 关键数值   │
│ (30%区域)       │ (10%区域)     │
└─────────────────┴───────────────┘
```

---

## 7. 🚀 性能问题排查


### 7.1 性能问题分类


**性能问题症状分析：**

```
🐌 性能问题严重程度分级

🟢 轻微问题 (影响<10%用户):
├─ 个别面板加载稍慢
├─ 偶尔的小卡顿
└─ 非核心功能响应慢

🟡 中等问题 (影响10-30%用户):  
├─ 整个仪表板加载慢
├─ 查询经常超时
└─ 内存使用率偏高

🔴 严重问题 (影响30%+用户):
├─ 系统经常无响应
├─ 大量查询失败
└─ 服务器资源耗尽
```

### 7.2 系统资源监控


**关键性能指标：**

| 📊 指标类型 | 🎯 正常范围 | ⚠️ 警告阈值 | 🚨 危险阈值 |
|------------|-----------|-----------|-----------|
| CPU使用率 | `< 70%` | `70-85%` | `> 85%` |
| 内存使用率 | `< 80%` | `80-90%` | `> 90%` |
| 磁盘使用率 | `< 85%` | `85-95%` | `> 95%` |
| 网络延迟 | `< 100ms` | `100-500ms` | `> 500ms` |

### 7.3 优化策略矩阵


**🎯 针对性优化方案：**

```
优化策略决策树：

问题是查询慢？
├─ 是 → 优化查询语句
│     ├─ 减少查询范围
│     ├─ 使用更高效函数
│     └─ 添加适当过滤条件
│
└─ 否 → 问题是界面卡顿？
      ├─ 是 → 优化面板配置
      │     ├─ 减少面板数量
      │     ├─ 降低刷新频率
      │     └─ 使用缓存机制
      │
      └─ 否 → 系统资源问题
            ├─ 扩容硬件资源
            ├─ 优化系统配置
            └─ 分布式部署
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的排查技能


```
🎯 故障排查核心技能树

基础技能 (必须掌握):
├─ 🔍 问题现象识别能力
├─ 📊 数据源连接检查
├─ 📝 基础查询语法调试
└─ 🎨 面板配置修正

进阶技能 (建议掌握):
├─ ⚡ 性能优化策略
├─ 🔧 复杂变量配置
├─ 📈 高级查询语法
└─ 🚀 系统调优方法

专家技能 (深入研究):
├─ 🏗️ 架构级别优化
├─ 🔄 自动化故障恢复
├─ 📊 自定义插件开发
└─ 🌐 分布式部署管理
```

### 8.2 排查问题黄金法则


> 🧠 **记忆口诀**
> 
> *"先看现象定位置，再查原因找规律，最后验证保质量"*

**📋 标准排查流程：**

```
⏰ 5分钟快速排查法：

分钟1: 🔍 观察问题现象
├─ 截图保存错误信息
├─ 记录出现时间
└─ 确认影响范围

分钟2-3: 🎯 定位问题位置  
├─ 检查数据源状态
├─ 验证查询语句
└─ 确认面板配置

分钟4: 🔧 尝试基础修复
├─ 重新测试连接
├─ 修正明显错误
└─ 重启相关服务

分钟5: ✅ 验证修复效果
├─ 确认问题解决
├─ 记录解决方案
└─ 文档化经验
```

### 8.3 预防性维护建议


**🛡️ 预防胜于治疗：**

- **📅 定期检查**：每周检查数据源连接状态
- **📝 文档记录**：建立常见问题解决方案库  
- **👥 团队培训**：让团队成员都掌握基础排查技能
- **🔄 版本管理**：对仪表板配置进行版本控制
- **📊 监控监控**：对Grafana本身进行性能监控

### 8.4 实战应用价值


- **🚀 提升工作效率**：快速解决问题，减少停机时间
- **💡 增强技术能力**：深入理解监控系统工作原理
- **🤝 改善团队协作**：成为团队中的"救火英雄"
- **📈 业务价值创造**：保障监控系统稳定运行

**最终目标：** 让监控系统成为业务的可靠守护者，而不是额外的麻烦制造者！

---

> 💡 **新手学习建议**
> 
> 故障排查能力需要在实践中积累，建议：
> 1. 💻 **动手实践**：主动制造一些"故障"来练习排查
> 2. 📚 **记录总结**：建立个人的问题解决手册
> 3. 🤝 **交流学习**：与同事分享排查经验
> 4. 🔄 **持续改进**：不断优化排查流程和方法

记住：**每一次成功的故障排查，都是向监控专家迈进的一大步！** 🎯