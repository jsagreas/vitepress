---
title: 2ã€æœåŠ¡ç«¯å¼€å‘å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [æœåŠ¡ç«¯å¼€å‘æ¦‚è¿°](#1-æœåŠ¡ç«¯å¼€å‘æ¦‚è¿°)
2. [æœåŠ¡ç«¯ç±»ç»“æ„è¯¦è§£](#2-æœåŠ¡ç«¯ç±»ç»“æ„è¯¦è§£)
3. [ä¸šåŠ¡é€»è¾‘å®ç°](#3-ä¸šåŠ¡é€»è¾‘å®ç°)
4. [æœåŠ¡å™¨åˆ›å»ºä¸é…ç½®](#4-æœåŠ¡å™¨åˆ›å»ºä¸é…ç½®)
5. [æœåŠ¡æ³¨å†Œä¸ç»‘å®š](#5-æœåŠ¡æ³¨å†Œä¸ç»‘å®š)
6. [ç«¯å£ç›‘å¬ä¸å¯åŠ¨](#6-ç«¯å£ç›‘å¬ä¸å¯åŠ¨)
7. [å¤šè¯­è¨€å®ç°å¯¹æ¯”](#7-å¤šè¯­è¨€å®ç°å¯¹æ¯”)
8. [ä¼˜é›…å…³é—­ä¸é”™è¯¯å¤„ç†](#8-ä¼˜é›…å…³é—­ä¸é”™è¯¯å¤„ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æœåŠ¡ç«¯å¼€å‘æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯gRPCæœåŠ¡ç«¯


**ç®€å•ç†è§£**ï¼šgRPCæœåŠ¡ç«¯å°±åƒä¸€ä¸ª**é¤å…çš„å¨æˆ¿**
- å®¢æˆ·ç«¯ï¼ˆé¡¾å®¢ï¼‰å‘é€è¯·æ±‚ï¼ˆç‚¹èœå•ï¼‰
- æœåŠ¡ç«¯ï¼ˆå¨æˆ¿ï¼‰å¤„ç†è¯·æ±‚ï¼ˆåšèœï¼‰
- è¿”å›å“åº”ï¼ˆç«¯èœç»™é¡¾å®¢ï¼‰

```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š
å®¢æˆ·ç«¯ ----[è¯·æ±‚]----> æœåŠ¡ç«¯
   â†‘                    â†“
   |                å¤„ç†ä¸šåŠ¡é€»è¾‘
   |                    â†“
   â†----[å“åº”ç»“æœ]----â† è¿”å›æ•°æ®
```

### 1.2 æœåŠ¡ç«¯å¼€å‘çš„æ ¸å¿ƒæ­¥éª¤


**ğŸ”¸ å¼€å‘æµç¨‹å›¾**ï¼š
```
1. å®šä¹‰æœåŠ¡æ¥å£        â† .protoæ–‡ä»¶å®šä¹‰
   â†“
2. ç”ŸæˆæœåŠ¡ç«¯ä»£ç       â† protocç¼–è¯‘ç”Ÿæˆ
   â†“  
3. å®ç°ä¸šåŠ¡é€»è¾‘        â† ç¼–å†™å…·ä½“çš„æœåŠ¡æ–¹æ³•
   â†“
4. åˆ›å»ºgRPCæœåŠ¡å™¨     â† åˆå§‹åŒ–æœåŠ¡å™¨å®ä¾‹
   â†“
5. æ³¨å†ŒæœåŠ¡           â† æŠŠæœåŠ¡ç»‘å®šåˆ°æœåŠ¡å™¨
   â†“
6. å¯åŠ¨ç›‘å¬           â† å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚
```

### 1.3 ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡


**è®¾è®¡åŸç†**ï¼š
- **æ¥å£ä¸å®ç°åˆ†ç¦»**ï¼šå…ˆå®šä¹‰"åšä»€ä¹ˆ"ï¼Œå†å®ç°"æ€ä¹ˆåš"
- **ä»£ç è‡ªåŠ¨ç”Ÿæˆ**ï¼šå‡å°‘é‡å¤åŠ³åŠ¨ï¼Œä¸“æ³¨ä¸šåŠ¡é€»è¾‘
- **ç»Ÿä¸€æ ‡å‡†**ï¼šä¸åŒè¯­è¨€éƒ½æŒ‰ç›¸åŒæ–¹å¼ç»„ç»‡ä»£ç 

---

## 2. ğŸ—ï¸ æœåŠ¡ç«¯ç±»ç»“æ„è¯¦è§£


### 2.1 ç”Ÿæˆçš„æœåŠ¡ç«¯ä»£ç ç»“æ„


å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·æœåŠ¡çš„protoå®šä¹‰ï¼š

```protobuf
service UserService {
    rpc GetUser(GetUserRequest) returns (GetUserResponse);
    rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
}
```

**ç”Ÿæˆçš„Goä»£ç ç»“æ„**ï¼š
```
ç”¨æˆ·æœåŠ¡ç›¸å…³ä»£ç ï¼š
â”œâ”€â”€ UserServiceServer æ¥å£      â† éœ€è¦æˆ‘ä»¬å®ç°çš„æ¥å£
â”œâ”€â”€ UnimplementedUserServiceServer â† é»˜è®¤å®ç°çš„ç»“æ„ä½“
â””â”€â”€ RegisterUserServiceServer   â† æ³¨å†ŒæœåŠ¡çš„å‡½æ•°
```

### 2.2 UserServiceServeræ¥å£


**ğŸ”¸ æ¥å£ä½œç”¨**ï¼šå®šä¹‰æœåŠ¡ç«¯å¿…é¡»å®ç°çš„æ–¹æ³•

```go
// è¿™æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ¥å£ï¼Œæˆ‘ä»¬å¿…é¡»å®ç°å®ƒ
type UserServiceServer interface {
    // è·å–ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•
    GetUser(context.Context, *GetUserRequest) (*GetUserResponse, error)
    // åˆ›å»ºç”¨æˆ·çš„æ–¹æ³•  
    CreateUser(context.Context, *CreateUserRequest) (*CreateUserResponse, error)
}
```

**é€šä¿—è§£é‡Š**ï¼š
- è¿™ä¸ªæ¥å£å°±åƒ**å·¥ä½œå²—ä½çš„èŒè´£æè¿°**
- å‘Šè¯‰ä½ è¿™ä¸ªå²—ä½éœ€è¦åšå“ªäº›å·¥ä½œï¼ˆæ–¹æ³•ï¼‰
- ä½†å…·ä½“æ€ä¹ˆåšï¼Œç”±ä½ è‡ªå·±å®ç°

### 2.3 UnimplementedServerç»“æ„ä½“


**ğŸ”¸ é»˜è®¤å®ç°çš„ä½œç”¨**ï¼š

```go
// è‡ªåŠ¨ç”Ÿæˆçš„é»˜è®¤å®ç°
type UnimplementedUserServiceServer struct{}

// é»˜è®¤çš„GetUserå®ç°ï¼ˆè¿”å›æœªå®ç°é”™è¯¯ï¼‰
func (*UnimplementedUserServiceServer) GetUser(context.Context, *GetUserRequest) (*GetUserResponse, error) {
    return nil, status.Errorf(codes.Unimplemented, "method GetUser not implemented")
}
```

**ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ª**ï¼š
- **å‘å‰å…¼å®¹**ï¼šå½“protoæ–‡ä»¶æ–°å¢æ–¹æ³•æ—¶ï¼Œæ—§ä»£ç ä¸ä¼šç¼–è¯‘å‡ºé”™
- **éƒ¨åˆ†å®ç°**ï¼šå¯ä»¥åªå®ç°éœ€è¦çš„æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•æœ‰é»˜è®¤è¡Œä¸º
- **å¼€å‘ä¾¿åˆ©**ï¼šä¸ç”¨ä¸€æ¬¡æ€§å®ç°æ‰€æœ‰æ–¹æ³•

**ç±»æ¯”ç†è§£**ï¼š
```
å°±åƒå…¬å¸æ‹›è˜ï¼š
- èŒä½è¦æ±‚ï¼šä¼š10é¡¹æŠ€èƒ½ï¼ˆæ¥å£å®šä¹‰çš„æ–¹æ³•ï¼‰
- é»˜è®¤å‘˜å·¥ï¼šåªä¼šè¯´"æˆ‘ä¸ä¼š"ï¼ˆUnimplementedServerï¼‰
- ä½ ï¼šåœ¨é»˜è®¤å‘˜å·¥åŸºç¡€ä¸Šï¼Œå­¦ä¼šå…¶ä¸­å‡ é¡¹æŠ€èƒ½ï¼ˆåµŒå…¥+é‡å†™æ–¹æ³•ï¼‰
```

---

## 3. ğŸ’¡ ä¸šåŠ¡é€»è¾‘å®ç°


### 3.1 åµŒå…¥æ¨¡å¼çš„ä½¿ç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯åµŒå…¥æ¨¡å¼**ï¼š

```go
// æˆ‘ä»¬çš„æœåŠ¡å®ç°
type MyUserService struct {
    // åµŒå…¥é»˜è®¤å®ç°ï¼Œè·å¾—æ‰€æœ‰æ–¹æ³•çš„é»˜è®¤è¡Œä¸º
    pb.UnimplementedUserServiceServer
    
    // å¯ä»¥æ·»åŠ è‡ªå·±çš„å­—æ®µ
    db *sql.DB
    logger *log.Logger
}
```

**åµŒå…¥çš„å¥½å¤„**ï¼š
- âœ… è‡ªåŠ¨è·å¾—æ‰€æœ‰æ¥å£æ–¹æ³•çš„é»˜è®¤å®ç°
- âœ… åªéœ€è¦é‡å†™æƒ³è¦å®ç°çš„æ–¹æ³•
- âœ… protoæ–‡ä»¶å˜åŒ–æ—¶ä»£ç æ›´ç¨³å®š

### 3.2 å®ç°å…·ä½“çš„æœåŠ¡æ–¹æ³•


**ğŸ”¸ å®ç°GetUseræ–¹æ³•**ï¼š

```go
// é‡å†™GetUseræ–¹æ³•ï¼Œå®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘
func (s *MyUserService) GetUser(ctx context.Context, req *pb.GetUserRequest) (*pb.GetUserResponse, error) {
    // 1. å‚æ•°éªŒè¯
    if req.UserId <= 0 {
        return nil, status.Error(codes.InvalidArgument, "ç”¨æˆ·IDå¿…é¡»å¤§äº0")
    }
    
    // 2. ä¸šåŠ¡é€»è¾‘ï¼ˆä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ï¼‰
    user, err := s.getUserFromDB(req.UserId)
    if err != nil {
        return nil, status.Error(codes.Internal, "æŸ¥è¯¢ç”¨æˆ·å¤±è´¥")
    }
    
    if user == nil {
        return nil, status.Error(codes.NotFound, "ç”¨æˆ·ä¸å­˜åœ¨")
    }
    
    // 3. æ„é€ å“åº”
    return &pb.GetUserResponse{
        User: &pb.User{
            Id:   user.ID,
            Name: user.Name,
            Email: user.Email,
        },
    }, nil
}
```

**æ–¹æ³•ç­¾åè§£é‡Š**ï¼š
```go
func (s *MyUserService) GetUser(
    ctx context.Context,        // ä¸Šä¸‹æ–‡ï¼Œç”¨äºè¶…æ—¶æ§åˆ¶ã€å–æ¶ˆæ“ä½œ
    req *pb.GetUserRequest,     // è¯·æ±‚å‚æ•°
) (*pb.GetUserResponse, error) // è¿”å›å“åº”å’Œé”™è¯¯
```

### 3.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¸ gRPCé”™è¯¯ç çš„ä½¿ç”¨**ï¼š

```go
import "google.golang.org/grpc/status"
import "google.golang.org/grpc/codes"

// å¸¸ç”¨é”™è¯¯ç±»å‹
func handleDifferentErrors() {
    // å‚æ•°é”™è¯¯
    status.Error(codes.InvalidArgument, "å‚æ•°ä¸åˆæ³•")
    
    // èµ„æºä¸å­˜åœ¨
    status.Error(codes.NotFound, "ç”¨æˆ·ä¸å­˜åœ¨")
    
    // æƒé™ä¸è¶³
    status.Error(codes.PermissionDenied, "æ²¡æœ‰è®¿é—®æƒé™")
    
    // æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
    status.Error(codes.Internal, "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯")
}
```

**é”™è¯¯ç é€‰æ‹©æŒ‡å—**ï¼š
| åœºæ™¯ | é”™è¯¯ç  | è¯´æ˜ |
|------|--------|------|
| å‚æ•°éªŒè¯å¤±è´¥ | `InvalidArgument` | å®¢æˆ·ç«¯ä¼ å…¥çš„å‚æ•°ä¸æ­£ç¡® |
| æ•°æ®ä¸å­˜åœ¨ | `NotFound` | è¯·æ±‚çš„èµ„æºæ‰¾ä¸åˆ° |
| æƒé™ä¸è¶³ | `PermissionDenied` | æ²¡æœ‰æ‰§è¡Œæ­¤æ“ä½œçš„æƒé™ |
| æœåŠ¡ä¸å¯ç”¨ | `Unavailable` | æœåŠ¡ä¸´æ—¶ä¸å¯ç”¨ |
| æœåŠ¡å™¨é”™è¯¯ | `Internal` | æœåŠ¡å™¨å†…éƒ¨å¤„ç†å‡ºé”™ |

---

## 4. ğŸš€ æœåŠ¡å™¨åˆ›å»ºä¸é…ç½®


### 4.1 åˆ›å»ºgRPCæœåŠ¡å™¨


**ğŸ”¸ åŸºæœ¬æœåŠ¡å™¨åˆ›å»º**ï¼š

```go
import "google.golang.org/grpc"

func createServer() {
    // 1. åˆ›å»ºgRPCæœåŠ¡å™¨å®ä¾‹
    server := grpc.NewServer()
    
    // å°±è¿™ä¹ˆç®€å•ï¼serverç°åœ¨å·²ç»å¯ä»¥ç”¨äº†
}
```

**é€šä¿—ç†è§£**ï¼š
- `grpc.NewServer()`å°±åƒ**å¼€äº†ä¸€å®¶é¤å…**
- é¤å…å»ºå¥½äº†ï¼Œä½†è¿˜æ²¡æœ‰å¨å¸ˆï¼ˆæœåŠ¡ï¼‰
- éœ€è¦æ‹›è˜å¨å¸ˆï¼ˆæ³¨å†ŒæœåŠ¡ï¼‰æ‰èƒ½è¥ä¸š

### 4.2 æœåŠ¡å™¨é€‰é¡¹é…ç½®


**ğŸ”¸ å¸¸ç”¨é…ç½®é€‰é¡¹**ï¼š

```go
func createServerWithOptions() *grpc.Server {
    // é…ç½®å„ç§é€‰é¡¹
    opts := []grpc.ServerOption{
        // è®¾ç½®æœ€å¤§æ¥æ”¶æ¶ˆæ¯å¤§å°ï¼ˆ4MBï¼‰
        grpc.MaxRecvMsgSize(4 * 1024 * 1024),
        
        // è®¾ç½®æœ€å¤§å‘é€æ¶ˆæ¯å¤§å°ï¼ˆ4MBï¼‰  
        grpc.MaxSendMsgSize(4 * 1024 * 1024),
        
        // è®¾ç½®è¿æ¥è¶…æ—¶
        grpc.ConnectionTimeout(time.Second * 5),
    }
    
    // åˆ›å»ºå¸¦é…ç½®çš„æœåŠ¡å™¨
    return grpc.NewServer(opts...)
}
```

**é…ç½®è¯´æ˜**ï¼š
- **æ¶ˆæ¯å¤§å°é™åˆ¶**ï¼šé˜²æ­¢å®¢æˆ·ç«¯å‘é€è¿‡å¤§çš„æ•°æ®å ç”¨å†…å­˜
- **è¿æ¥è¶…æ—¶**ï¼šé¿å…é•¿æ—¶é—´ç­‰å¾…æ— å“åº”çš„è¿æ¥
- **æ‹¦æˆªå™¨**ï¼šå¯ä»¥æ·»åŠ æ—¥å¿—ã€è®¤è¯ã€ç›‘æ§ç­‰åŠŸèƒ½

---

## 5. ğŸ”— æœåŠ¡æ³¨å†Œä¸ç»‘å®š


### 5.1 æœåŠ¡æ³¨å†Œçš„è¿‡ç¨‹


**ğŸ”¸ æ³¨å†ŒæœåŠ¡åˆ°æœåŠ¡å™¨**ï¼š

```go
func registerService() {
    // 1. åˆ›å»ºæœåŠ¡å™¨
    server := grpc.NewServer()
    
    // 2. åˆ›å»ºæˆ‘ä»¬çš„æœåŠ¡å®ä¾‹
    userService := &MyUserService{
        db: connectDatabase(),
        logger: log.New(os.Stdout, "UserService: ", log.LstdFlags),
    }
    
    // 3. æ³¨å†ŒæœåŠ¡ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰
    pb.RegisterUserServiceServer(server, userService)
}
```

**æ³¨å†Œè¿‡ç¨‹å›¾è§£**ï¼š
```
æœåŠ¡å™¨ï¼ˆé¤å…ï¼‰     +     æœåŠ¡å®ä¾‹ï¼ˆå¨å¸ˆï¼‰     =     å¯ä»¥è¥ä¸šçš„é¤å…
    server        +     userService        =     å®Œæ•´çš„gRPCæœåŠ¡
      â†“                      â†“                        â†“
   ç©ºçš„å®¹å™¨              å…·ä½“çš„å®ç°              å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨
```

### 5.2 RegisterServerå‡½æ•°çš„ä½œç”¨


**ğŸ”¸ Registerå‡½æ•°åšäº†ä»€ä¹ˆ**ï¼š

```go
// è¿™æ˜¯protocç”Ÿæˆçš„æ³¨å†Œå‡½æ•°ï¼ˆç®€åŒ–ç‰ˆç†è§£ï¼‰
func RegisterUserServiceServer(s *grpc.Server, srv UserServiceServer) {
    // 1. æ£€æŸ¥srvæ˜¯å¦å®ç°äº†UserServiceServeræ¥å£
    // 2. å°†æœåŠ¡æ–¹æ³•æ³¨å†Œåˆ°æœåŠ¡å™¨çš„è·¯ç”±è¡¨ä¸­
    // 3. å»ºç«‹æ–¹æ³•ååˆ°å…·ä½“å®ç°çš„æ˜ å°„å…³ç³»
    
    // ç±»ä¼¼äºï¼š
    // s.addRoute("/UserService/GetUser", srv.GetUser)
    // s.addRoute("/UserService/CreateUser", srv.CreateUser)
}
```

**é€šä¿—ç±»æ¯”**ï¼š
```
å°±åƒé¤å…çš„èœå•è®¾ç½®ï¼š
- æœåŠ¡å™¨ = é¤å…ç³»ç»Ÿ
- æ³¨å†ŒæœåŠ¡ = æŠŠèœå“åŠ å…¥èœå•
- å®¢æˆ·ç«¯ç‚¹èœ = æ ¹æ®èœå•æ‰¾åˆ°å¯¹åº”çš„å¨å¸ˆåˆ¶ä½œ
```

### 5.3 å¤šä¸ªæœåŠ¡çš„æ³¨å†Œ


**ğŸ”¸ æ³¨å†Œå¤šä¸ªæœåŠ¡**ï¼š

```go
func registerMultipleServices() {
    server := grpc.NewServer()
    
    // æ³¨å†Œç”¨æˆ·æœåŠ¡
    userService := &MyUserService{}
    pb.RegisterUserServiceServer(server, userService)
    
    // æ³¨å†Œè®¢å•æœåŠ¡
    orderService := &MyOrderService{}
    pb.RegisterOrderServiceServer(server, orderService)
    
    // ä¸€ä¸ªæœåŠ¡å™¨å¯ä»¥æ‰˜ç®¡å¤šä¸ªæœåŠ¡
}
```

---

## 6. ğŸ§ ç«¯å£ç›‘å¬ä¸å¯åŠ¨


### 6.1 ç½‘ç»œç›‘å¬çš„å»ºç«‹


**ğŸ”¸ ç›‘å¬ç«¯å£**ï¼š

```go
import "net"

func startListening() {
    // 1. é€‰æ‹©ç›‘å¬çš„åœ°å€å’Œç«¯å£
    address := ":8080"  // ç›‘å¬æ‰€æœ‰ç½‘å¡çš„8080ç«¯å£
    
    // 2. åˆ›å»ºTCPç›‘å¬å™¨
    listener, err := net.Listen("tcp", address)
    if err != nil {
        log.Fatalf("ç›‘å¬ç«¯å£å¤±è´¥: %v", err)
    }
    
    fmt.Printf("æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ %s\n", address)
}
```

**ç›‘å¬åœ°å€æ ¼å¼è¯´æ˜**ï¼š
```go
// ä¸åŒçš„ç›‘å¬æ–¹å¼
":8080"           // ç›‘å¬æ‰€æœ‰ç½‘å¡çš„8080ç«¯å£
"localhost:8080"  // åªç›‘å¬æœ¬åœ°ç¯å›æ¥å£
"0.0.0.0:8080"   // æ˜ç¡®æŒ‡å®šç›‘å¬æ‰€æœ‰ç½‘å¡
"192.168.1.100:8080" // ç›‘å¬æŒ‡å®šIPçš„ç«¯å£
```

### 6.2 æœåŠ¡å¯åŠ¨


**ğŸ”¸ å¯åŠ¨æœåŠ¡å™¨**ï¼š

```go
func startServer() {
    // åˆ›å»ºå¹¶é…ç½®æœåŠ¡å™¨
    server := grpc.NewServer()
    userService := &MyUserService{}
    pb.RegisterUserServiceServer(server, userService)
    
    // å»ºç«‹ç›‘å¬
    listener, err := net.Listen("tcp", ":8080")
    if err != nil {
        log.Fatalf("ç›‘å¬å¤±è´¥: %v", err)
    }
    
    // å¯åŠ¨æœåŠ¡ï¼ˆé˜»å¡è°ƒç”¨ï¼‰
    fmt.Println("gRPCæœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç›‘å¬ç«¯å£ :8080")
    if err := server.Serve(listener); err != nil {
        log.Fatalf("æœåŠ¡å¯åŠ¨å¤±è´¥: %v", err)
    }
}
```

**Serveæ–¹æ³•çš„ç‰¹ç‚¹**ï¼š
- **é˜»å¡è°ƒç”¨**ï¼šä¼šä¸€ç›´è¿è¡Œï¼Œä¸ä¼šè¿”å›ï¼ˆé™¤éå‡ºé”™ï¼‰
- **æ¥å—è¿æ¥**ï¼šå¼€å§‹æ¥å—å®¢æˆ·ç«¯è¿æ¥å¹¶å¤„ç†è¯·æ±‚
- **å¹¶å‘å¤„ç†**ï¼šæ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åœ¨å•ç‹¬çš„goroutineä¸­å¤„ç†

### 6.3 å®Œæ•´çš„å¯åŠ¨æµç¨‹


**ğŸ”¸ æ ‡å‡†å¯åŠ¨ä»£ç æ¨¡æ¿**ï¼š

```go
package main

import (
    "log"
    "net"
    
    "google.golang.org/grpc"
    pb "your-project/proto" // æ›¿æ¢ä¸ºä½ çš„protoåŒ…è·¯å¾„
)

func main() {
    // 1. åˆ›å»ºgRPCæœåŠ¡å™¨
    server := grpc.NewServer()
    
    // 2. åˆ›å»ºå¹¶æ³¨å†ŒæœåŠ¡
    userService := &MyUserService{
        // åˆå§‹åŒ–æœåŠ¡éœ€è¦çš„ä¾èµ–
    }
    pb.RegisterUserServiceServer(server, userService)
    
    // 3. å»ºç«‹ç½‘ç»œç›‘å¬
    listener, err := net.Listen("tcp", ":8080")
    if err != nil {
        log.Fatalf("ç›‘å¬ç«¯å£å¤±è´¥: %v", err)
    }
    
    // 4. å¯åŠ¨æœåŠ¡
    log.Println("gRPCæœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ :8080")
    if err := server.Serve(listener); err != nil {
        log.Fatalf("æœåŠ¡å¯åŠ¨å¤±è´¥: %v", err)
    }
}
```

---

## 7. ğŸŒ å¤šè¯­è¨€å®ç°å¯¹æ¯”


### 7.1 Javaå®ç°å¯¹æ¯”


**ğŸ”¸ Javaç‰ˆæœ¬çš„æœåŠ¡ç«¯ä»£ç **ï¼š

```java
// Javaçš„æœåŠ¡å®ç°
public class UserServiceImpl extends UserServiceGrpc.UserServiceImplBase {
    
    @Override
    public void getUser(GetUserRequest request, 
                       StreamObserver<GetUserResponse> responseObserver) {
        try {
            // ä¸šåŠ¡é€»è¾‘å¤„ç†
            User user = findUserById(request.getUserId());
            
            GetUserResponse response = GetUserResponse.newBuilder()
                .setUser(user)
                .build();
                
            responseObserver.onNext(response);
            responseObserver.onCompleted();
        } catch (Exception e) {
            responseObserver.onError(e);
        }
    }
}

// Javaçš„æœåŠ¡å™¨å¯åŠ¨
public class GrpcServer {
    public static void main(String[] args) throws IOException, InterruptedException {
        // åˆ›å»ºæœåŠ¡å™¨
        Server server = ServerBuilder.forPort(8080)
            .addService(new UserServiceImpl())  // æ³¨å†ŒæœåŠ¡
            .build();
            
        // å¯åŠ¨æœåŠ¡å™¨
        server.start();
        System.out.println("gRPCæœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ 8080");
        
        // ç­‰å¾…æœåŠ¡å™¨å…³é—­
        server.awaitTermination();
    }
}
```

### 7.2 Pythonå®ç°å¯¹æ¯”


**ğŸ”¸ Pythonç‰ˆæœ¬çš„æœåŠ¡ç«¯ä»£ç **ï¼š

```python
import grpc
from concurrent import futures
import user_service_pb2_grpc
import user_service_pb2

class UserServiceImpl(user_service_pb2_grpc.UserServiceServicer):
    def GetUser(self, request, context):
        # ä¸šåŠ¡é€»è¾‘å¤„ç†
        try:
            user = self.find_user_by_id(request.user_id)
            return user_service_pb2.GetUserResponse(user=user)
        except Exception as e:
            context.set_code(grpc.StatusCode.INTERNAL)
            context.set_details(str(e))
            return user_service_pb2.GetUserResponse()

def serve():
    # åˆ›å»ºæœåŠ¡å™¨
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))
    
    # æ³¨å†ŒæœåŠ¡
    user_service_pb2_grpc.add_UserServiceServicer_to_server(
        UserServiceImpl(), server)
    
    # ç›‘å¬ç«¯å£
    server.add_insecure_port('[::]:8080')
    
    # å¯åŠ¨æœåŠ¡å™¨
    server.start()
    print("gRPCæœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ 8080")
    server.wait_for_termination()

if __name__ == '__main__':
    serve()
```

### 7.3 ä¸åŒè¯­è¨€çš„å…±åŒç‚¹


**ğŸ”¸ æ‰€æœ‰è¯­è¨€çš„ç›¸åŒæ­¥éª¤**ï¼š

```
1. å®ç°æœåŠ¡æ¥å£     â† æ‰€æœ‰è¯­è¨€éƒ½è¦å®ç°protobufç”Ÿæˆçš„æ¥å£
   â†“
2. åˆ›å»ºæœåŠ¡å™¨å®ä¾‹   â† æ¯ç§è¯­è¨€éƒ½æœ‰å¯¹åº”çš„æœåŠ¡å™¨åˆ›å»ºæ–¹æ³•
   â†“
3. æ³¨å†ŒæœåŠ¡        â† å°†æœåŠ¡å®ç°ç»‘å®šåˆ°æœåŠ¡å™¨
   â†“
4. ç›‘å¬ç«¯å£        â† å¼€å§‹ç›‘å¬ç½‘ç»œè¿æ¥
   â†“
5. å¯åŠ¨æœåŠ¡        â† å¼€å§‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚
```

**è¯­è¨€å·®å¼‚æ€»ç»“**ï¼š
| è¯­è¨€ | æœåŠ¡å™¨åˆ›å»º | æœåŠ¡æ³¨å†Œ | å¯åŠ¨æ–¹å¼ |
|------|------------|----------|----------|
| **Go** | `grpc.NewServer()` | `RegisterXXXServer()` | `server.Serve()` |
| **Java** | `ServerBuilder.forPort()` | `.addService()` | `server.start()` |
| **Python** | `grpc.server()` | `add_XXXServicer_to_server()` | `server.start()` |

---

## 8. ğŸ›¡ï¸ ä¼˜é›…å…³é—­ä¸é”™è¯¯å¤„ç†


### 8.1 ä¼˜é›…å…³é—­çš„å®ç°


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¼˜é›…å…³é—­**ï¼š
- æ¥æ”¶åˆ°å…³é—­ä¿¡å·æ—¶ï¼Œä¸ç«‹å³é€€å‡º
- ç­‰å¾…æ­£åœ¨å¤„ç†çš„è¯·æ±‚å®Œæˆ
- æ‹’ç»æ–°çš„è¯·æ±‚
- æ¸…ç†èµ„æºåæ‰é€€å‡º

**å®ç°ä¼˜é›…å…³é—­**ï¼š

```go
package main

import (
    "context"
    "log"
    "net"
    "os"
    "os/signal"
    "syscall"
    "time"
    
    "google.golang.org/grpc"
)

func main() {
    // åˆ›å»ºæœåŠ¡å™¨
    server := grpc.NewServer()
    
    // æ³¨å†ŒæœåŠ¡
    userService := &MyUserService{}
    pb.RegisterUserServiceServer(server, userService)
    
    // ç›‘å¬ç«¯å£
    listener, err := net.Listen("tcp", ":8080")
    if err != nil {
        log.Fatalf("ç›‘å¬å¤±è´¥: %v", err)
    }
    
    // å¯åŠ¨æœåŠ¡å™¨ï¼ˆåœ¨goroutineä¸­ï¼‰
    go func() {
        log.Println("gRPCæœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ :8080")
        if err := server.Serve(listener); err != nil {
            log.Printf("æœåŠ¡å™¨é”™è¯¯: %v", err)
        }
    }()
    
    // ç­‰å¾…å…³é—­ä¿¡å·
    waitForShutdown(server)
}

func waitForShutdown(server *grpc.Server) {
    // åˆ›å»ºä¿¡å·é€šé“
    quit := make(chan os.Signal, 1)
    
    // ç›‘å¬ç»ˆæ­¢ä¿¡å·
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    
    // ç­‰å¾…ä¿¡å·
    <-quit
    log.Println("æ”¶åˆ°å…³é—­ä¿¡å·ï¼Œå¼€å§‹ä¼˜é›…å…³é—­...")
    
    // è®¾ç½®è¶…æ—¶ä¸Šä¸‹æ–‡
    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()
    
    // ä¼˜é›…å…³é—­æœåŠ¡å™¨
    done := make(chan struct{})
    go func() {
        server.GracefulStop() // ç­‰å¾…æ­£åœ¨å¤„ç†çš„è¯·æ±‚å®Œæˆ
        close(done)
    }()
    
    // ç­‰å¾…ä¼˜é›…å…³é—­å®Œæˆæˆ–è¶…æ—¶
    select {
    case <-done:
        log.Println("æœåŠ¡å™¨å·²ä¼˜é›…å…³é—­")
    case <-ctx.Done():
        log.Println("å…³é—­è¶…æ—¶ï¼Œå¼ºåˆ¶å…³é—­æœåŠ¡å™¨")
        server.Stop() // å¼ºåˆ¶å…³é—­
    }
}
```

### 8.2 é”™è¯¯å¤„ç†ä¸æ—¥å¿—è®°å½•


**ğŸ”¸ æœåŠ¡çº§åˆ«çš„é”™è¯¯å¤„ç†**ï¼š

```go
func (s *MyUserService) GetUser(ctx context.Context, req *pb.GetUserRequest) (*pb.GetUserResponse, error) {
    // è®°å½•è¯·æ±‚æ—¥å¿—
    s.logger.Printf("æ”¶åˆ°GetUserè¯·æ±‚: userId=%d", req.UserId)
    
    // å‚æ•°éªŒè¯
    if err := s.validateGetUserRequest(req); err != nil {
        s.logger.Printf("å‚æ•°éªŒè¯å¤±è´¥: %v", err)
        return nil, status.Error(codes.InvalidArgument, err.Error())
    }
    
    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    user, err := s.getUserFromDB(ctx, req.UserId)
    if err != nil {
        // è®°å½•é”™è¯¯æ—¥å¿—
        s.logger.Printf("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥: userId=%d, error=%v", req.UserId, err)
        
        // æ ¹æ®é”™è¯¯ç±»å‹è¿”å›ä¸åŒçš„gRPCé”™è¯¯
        if isNotFoundError(err) {
            return nil, status.Error(codes.NotFound, "ç”¨æˆ·ä¸å­˜åœ¨")
        }
        return nil, status.Error(codes.Internal, "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯")
    }
    
    // è®°å½•æˆåŠŸæ—¥å¿—
    s.logger.Printf("æˆåŠŸè·å–ç”¨æˆ·: userId=%d, userName=%s", user.Id, user.Name)
    
    return &pb.GetUserResponse{User: user}, nil
}

// å‚æ•°éªŒè¯
func (s *MyUserService) validateGetUserRequest(req *pb.GetUserRequest) error {
    if req.UserId <= 0 {
        return fmt.Errorf("ç”¨æˆ·IDå¿…é¡»å¤§äº0ï¼Œå½“å‰å€¼: %d", req.UserId)
    }
    return nil
}
```

### 8.3 ç›‘æ§ä¸å¥åº·æ£€æŸ¥


**ğŸ”¸ æ·»åŠ å¥åº·æ£€æŸ¥æœåŠ¡**ï¼š

```go
import "google.golang.org/grpc/health"
import "google.golang.org/grpc/health/grpc_health_v1"

func createServerWithHealthCheck() *grpc.Server {
    server := grpc.NewServer()
    
    // æ³¨å†Œä¸šåŠ¡æœåŠ¡
    userService := &MyUserService{}
    pb.RegisterUserServiceServer(server, userService)
    
    // æ³¨å†Œå¥åº·æ£€æŸ¥æœåŠ¡
    healthServer := health.NewServer()
    grpc_health_v1.RegisterHealthServer(server, healthServer)
    
    // è®¾ç½®æœåŠ¡å¥åº·çŠ¶æ€
    healthServer.SetServingStatus("UserService", grpc_health_v1.HealthCheckResponse_SERVING)
    
    return server
}
```

**å¥åº·æ£€æŸ¥çš„ä½œç”¨**ï¼š
- **æœåŠ¡å‘ç°**ï¼šè®©è´Ÿè½½å‡è¡¡å™¨çŸ¥é“æœåŠ¡æ˜¯å¦å¯ç”¨
- **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§ç³»ç»Ÿå¯ä»¥å®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
- **è‡ªåŠ¨æ¢å¤**ï¼šä¸å¥åº·çš„æœåŠ¡å®ä¾‹ä¼šè¢«ä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æœåŠ¡ç«¯å¼€å‘æµç¨‹ï¼šå®šä¹‰æ¥å£ â†’ å®ç°ä¸šåŠ¡é€»è¾‘ â†’ åˆ›å»ºæœåŠ¡å™¨ â†’ æ³¨å†ŒæœåŠ¡ â†’ å¯åŠ¨ç›‘å¬
ğŸ”¸ åµŒå…¥æ¨¡å¼ï¼šé€šè¿‡åµŒå…¥UnimplementedServerè·å¾—é»˜è®¤å®ç°ï¼Œåªé‡å†™éœ€è¦çš„æ–¹æ³•
ğŸ”¸ æœåŠ¡æ³¨å†Œï¼šä½¿ç”¨RegisterXXXServerå‡½æ•°å°†æœåŠ¡å®ç°ç»‘å®šåˆ°gRPCæœåŠ¡å™¨
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šä½¿ç”¨gRPCçŠ¶æ€ç è¿”å›æ ‡å‡†åŒ–çš„é”™è¯¯ä¿¡æ¯
ğŸ”¸ ä¼˜é›…å…³é—­ï¼šç›‘å¬ç³»ç»Ÿä¿¡å·ï¼Œç­‰å¾…è¯·æ±‚å®Œæˆåå†å…³é—­æœåŠ¡
```

### 9.2 å¼€å‘æœ€ä½³å®è·µ


**ğŸ”¹ ä»£ç ç»„ç»‡**ï¼š
```go
// æ¨èçš„æœåŠ¡ç»“æ„
type MyUserService struct {
    pb.UnimplementedUserServiceServer  // åµŒå…¥é»˜è®¤å®ç°
    
    // ä¾èµ–æ³¨å…¥
    db     database.DB
    logger *log.Logger
    config *Config
}

// æ„é€ å‡½æ•°
func NewUserService(db database.DB, logger *log.Logger, config *Config) *MyUserService {
    return &MyUserService{
        db:     db,
        logger: logger,
        config: config,
    }
}
```

**ğŸ”¹ é”™è¯¯å¤„ç†ç­–ç•¥**ï¼š
- âœ… **ä½¿ç”¨æ ‡å‡†é”™è¯¯ç **ï¼šè®©å®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®å¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯
- âœ… **è®°å½•è¯¦ç»†æ—¥å¿—**ï¼šä¾¿äºé—®é¢˜æ’æŸ¥å’Œç³»ç»Ÿç›‘æ§
- âœ… **ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯**ï¼šé”™è¯¯æ¶ˆæ¯ä¸è¦åŒ…å«å†…éƒ¨å®ç°ç»†èŠ‚

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- âš¡ **åˆç†è®¾ç½®è¶…æ—¶**ï¼šé¿å…é•¿æ—¶é—´å ç”¨è¿æ¥
- âš¡ **ä½¿ç”¨è¿æ¥æ± **ï¼šé‡ç”¨æ•°æ®åº“è¿æ¥ç­‰èµ„æº
- âš¡ **å¼‚æ­¥å¤„ç†**ï¼šå¯¹äºè€—æ—¶æ“ä½œè€ƒè™‘å¼‚æ­¥å¤„ç†

### 9.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ æœåŠ¡å¯åŠ¨å¤±è´¥**ï¼š
```
å¸¸è§åŸå› ï¼š
- ç«¯å£è¢«å ç”¨ â†’ æ£€æŸ¥ç«¯å£çŠ¶æ€ï¼Œæ›´æ¢ç«¯å£
- æƒé™ä¸è¶³ â†’ ä½¿ç”¨éç‰¹æƒç«¯å£ï¼ˆ>1024ï¼‰
- ç½‘ç»œé…ç½®é—®é¢˜ â†’ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
```

**â“ å®¢æˆ·ç«¯è¿æ¥ä¸ä¸Š**ï¼š
```
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. ç¡®è®¤ç›‘å¬åœ°å€å’Œç«¯å£
3. æµ‹è¯•ç½‘ç»œè¿é€šæ€§
4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
```

**â“ æ€§èƒ½é—®é¢˜**ï¼š
```
ä¼˜åŒ–æ–¹å‘ï¼š
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°
- ä½¿ç”¨åˆé€‚çš„åºåˆ—åŒ–æ–¹å¼
- æ·»åŠ ç¼“å­˜å±‚
```

### 9.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ¯ åˆå­¦è€…è·¯å¾„**ï¼š
1. **ç†è§£åŸºæœ¬æ¦‚å¿µ** â†’ ä»€ä¹ˆæ˜¯gRPCæœåŠ¡ç«¯ï¼ŒåŸºæœ¬å·¥ä½œæµç¨‹
2. **ç¼–å†™ç®€å•æœåŠ¡** â†’ å®ç°ä¸€ä¸ªæœ€åŸºæœ¬çš„æœåŠ¡æ–¹æ³•
3. **å­¦ä¹ é”™è¯¯å¤„ç†** â†’ æ­£ç¡®ä½¿ç”¨gRPCé”™è¯¯ç 
4. **æŒæ¡å¯åŠ¨æµç¨‹** â†’ å®Œæ•´çš„æœåŠ¡å™¨å¯åŠ¨å’Œå…³é—­

**ğŸš€ è¿›é˜¶å­¦ä¹ **ï¼š
1. **æ€§èƒ½ä¼˜åŒ–** â†’ ç›‘æ§ã€æ—¥å¿—ã€ç¼“å­˜
2. **é«˜å¯ç”¨éƒ¨ç½²** â†’ è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°
3. **å®‰å…¨è€ƒè™‘** â†’ è®¤è¯ã€æˆæƒã€TLS
4. **å¾®æœåŠ¡é›†æˆ** â†’ ä¸å…¶ä»–æœåŠ¡çš„åä½œ

**æ ¸å¿ƒè®°å¿†**ï¼š
- gRPCæœåŠ¡ç«¯å°±æ˜¯å®ç°protobufå®šä¹‰çš„æ¥å£
- åµŒå…¥UnimplementedServeræ˜¯æœ€ä½³å®è·µ
- æ³¨å†ŒæœåŠ¡å°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨"æˆ‘èƒ½å¤„ç†è¿™äº›è¯·æ±‚"
- ä¼˜é›…å…³é—­è®©æœåŠ¡æ›´ç¨³å®šå¯é 