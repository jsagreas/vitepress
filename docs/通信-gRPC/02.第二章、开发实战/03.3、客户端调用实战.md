---
title: 3ã€å®¢æˆ·ç«¯è°ƒç”¨å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å®¢æˆ·ç«¯è¿æ¥åŸºç¡€](#1-å®¢æˆ·ç«¯è¿æ¥åŸºç¡€)
2. [Stubå­˜æ ¹è¯¦è§£](#2-Stubå­˜æ ¹è¯¦è§£)
3. [è°ƒç”¨æ–¹å¼é€‰æ‹©](#3-è°ƒç”¨æ–¹å¼é€‰æ‹©)
4. [å‚æ•°ä¸è¿”å›å€¼å¤„ç†](#4-å‚æ•°ä¸è¿”å›å€¼å¤„ç†)
5. [è¿æ¥ç®¡ç†ä¸æœ€ä½³å®è·µ](#5-è¿æ¥ç®¡ç†ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ å®¢æˆ·ç«¯è¿æ¥åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Channelé€šé“


**ğŸ”¸ é€šä¿—ç†è§£**
```
æƒ³è±¡æ‰“ç”µè¯ï¼š
ğŸ“ ç”µè¯çº¿ = Channelé€šé“
ğŸ  ä½ å®¶   = å®¢æˆ·ç«¯
ğŸ¢ å…¬å¸   = æœåŠ¡ç«¯

Channelå°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„"ç”µè¯çº¿"
é€šè¿‡è¿™æ¡çº¿ï¼Œå®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³•
```

**ğŸ’¡ Channelçš„æœ¬è´¨**
- Channelæ˜¯å®¢æˆ·ç«¯è¿æ¥åˆ°gRPCæœåŠ¡å™¨çš„æ¡¥æ¢
- ä¸€ä¸ªChannelå¯ä»¥å¤ç”¨ï¼Œæ”¯æŒå¤šæ¬¡è°ƒç”¨
- ç®¡ç†åº•å±‚çš„HTTP/2è¿æ¥ã€è®¤è¯ã€è´Ÿè½½å‡è¡¡ç­‰

### 1.2 åˆ›å»ºChannelçš„æ–¹å¼


**ğŸ”¸ Javaä¸­çš„ManagedChannel**
```java
// æœ€ç®€å•çš„è¿æ¥æ–¹å¼
ManagedChannel channel = ManagedChannelBuilder
    .forAddress("localhost", 9090)  // æœåŠ¡å™¨åœ°å€å’Œç«¯å£
    .usePlaintext()                 // ä¸ä½¿ç”¨SSLåŠ å¯†
    .build();

// å¸¦è¶…æ—¶å’Œé‡è¯•çš„è¿æ¥
ManagedChannel channel = ManagedChannelBuilder
    .forAddress("localhost", 9090)
    .usePlaintext()
    .keepAliveTime(30, TimeUnit.SECONDS)     // å¿ƒè·³é—´éš”
    .keepAliveTimeout(5, TimeUnit.SECONDS)   // å¿ƒè·³è¶…æ—¶
    .maxInboundMessageSize(1024 * 1024)      // æœ€å¤§æ¶ˆæ¯å¤§å°1MB
    .build();
```

**ğŸ”¸ Goä¸­çš„grpc.Dial()**
```go
// ç®€å•è¿æ¥
conn, err := grpc.Dial("localhost:9090", grpc.WithInsecure())
if err != nil {
    log.Fatalf("è¿æ¥å¤±è´¥: %v", err)
}

// å¸¦é€‰é¡¹çš„è¿æ¥
conn, err := grpc.Dial("localhost:9090",
    grpc.WithInsecure(),                    // ä¸ä½¿ç”¨TLS
    grpc.WithTimeout(5*time.Second),        // è¿æ¥è¶…æ—¶
    grpc.WithBlock(),                       // é˜»å¡ç›´åˆ°è¿æ¥æˆåŠŸ
)
```

> ğŸ’¡ **ç®€å•ç†è§£**  
> `ManagedChannel`å’Œ`grpc.Dial()`éƒ½æ˜¯"æ‹¨å·å™¨"ï¼Œç”¨æ¥å»ºç«‹åˆ°æœåŠ¡å™¨çš„è¿æ¥é€šé“

---

## 2. ğŸ¤– Stubå­˜æ ¹è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯Stub


**ğŸŒ° ç”Ÿæ´»ç±»æ¯”**
```
æƒ³è±¡é¥æ§å™¨ï¼š
ğŸ“º ç”µè§†æœº = è¿œç¨‹æœåŠ¡
ğŸ® é¥æ§å™¨ = Stubå­˜æ ¹
ğŸ‘¨ ä½      = å®¢æˆ·ç«¯ä»£ç 

ä½ ä¸éœ€è¦ç›´æ¥æ“ä½œç”µè§†æœºå†…éƒ¨ç”µè·¯
åªéœ€è¦æŒ‰é¥æ§å™¨æŒ‰é’®ï¼Œç”µè§†æœºå°±ä¼šå“åº”
Stubå°±æ˜¯è¿™ä¸ª"é¥æ§å™¨"
```

**ğŸ’¡ Stubçš„æœ¬è´¨**
- Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†å¯¹è±¡ï¼Œä»£è¡¨è¿œç¨‹æœåŠ¡
- å®ƒæŠŠæœ¬åœ°æ–¹æ³•è°ƒç”¨è½¬æ¢æˆç½‘ç»œè¯·æ±‚
- è®©ä½ åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡

### 2.2 Stubçš„ç±»å‹è¯¦è§£


**ğŸ”¸ BlockingStub - é˜»å¡è°ƒç”¨**
```java
// åˆ›å»ºé˜»å¡Stub
GreeterGrpc.GreeterBlockingStub blockingStub = 
    GreeterGrpc.newBlockingStub(channel);

// é˜»å¡è°ƒç”¨ - ç­‰å¾…ç»“æœè¿”å›
HelloReply response = blockingStub.sayHello(
    HelloRequest.newBuilder().setName("å¼ ä¸‰").build()
);
System.out.println("æœåŠ¡å™¨å›å¤: " + response.getMessage());
// è¿™é‡Œä»£ç ä¼šç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å™¨è¿”å›ç»“æœæ‰ç»§ç»­æ‰§è¡Œ
```

**ğŸ”¸ FutureStub - å¼‚æ­¥è°ƒç”¨**
```java
// åˆ›å»ºå¼‚æ­¥Stub
GreeterGrpc.GreeterFutureStub futureStub = 
    GreeterGrpc.newFutureStub(channel);

// å¼‚æ­¥è°ƒç”¨ - ç«‹å³è¿”å›Future
ListenableFuture<HelloReply> future = futureStub.sayHello(
    HelloRequest.newBuilder().setName("æå››").build()
);

// ä»£ç ç«‹å³ç»§ç»­æ‰§è¡Œï¼Œä¸ç­‰å¾…
System.out.println("è¯·æ±‚å·²å‘é€ï¼Œç»§ç»­å…¶ä»–å·¥ä½œ...");

// éœ€è¦ç»“æœæ—¶å†è·å–
HelloReply response = future.get(); // è¿™é‡Œæ‰çœŸæ­£ç­‰å¾…
System.out.println("æœåŠ¡å™¨å›å¤: " + response.getMessage());
```

**ğŸ”¸ Goä¸­çš„å®¢æˆ·ç«¯**
```go
// åˆ›å»ºå®¢æˆ·ç«¯
client := pb.NewGreeterClient(conn)

// åŒæ­¥è°ƒç”¨ï¼ˆGoé»˜è®¤å°±æ˜¯åŒæ­¥çš„ï¼‰
response, err := client.SayHello(context.Background(), 
    &pb.HelloRequest{Name: "ç‹äº”"})
if err != nil {
    log.Fatalf("è°ƒç”¨å¤±è´¥: %v", err)
}
fmt.Printf("æœåŠ¡å™¨å›å¤: %s\n", response.GetMessage())
```

### 2.3 æ„å»ºStubçš„æœ€ä½³æ–¹å¼


```java
public class GreeterClient {
    private final ManagedChannel channel;
    private final GreeterGrpc.GreeterBlockingStub blockingStub;
    private final GreeterGrpc.GreeterFutureStub futureStub;
    
    public GreeterClient(String host, int port) {
        // åˆ›å»ºé€šé“
        this.channel = ManagedChannelBuilder
            .forAddress(host, port)
            .usePlaintext()
            .build();
            
        // åˆ›å»ºä¸åŒç±»å‹çš„Stub
        this.blockingStub = GreeterGrpc.newBlockingStub(channel);
        this.futureStub = GreeterGrpc.newFutureStub(channel);
    }
    
    // åŒæ­¥è°ƒç”¨æ–¹æ³•
    public String greetSync(String name) {
        HelloReply response = blockingStub.sayHello(
            HelloRequest.newBuilder().setName(name).build()
        );
        return response.getMessage();
    }
    
    // å¼‚æ­¥è°ƒç”¨æ–¹æ³•
    public Future<String> greetAsync(String name) {
        ListenableFuture<HelloReply> future = futureStub.sayHello(
            HelloRequest.newBuilder().setName(name).build()
        );
        
        // è½¬æ¢ä¸ºæ›´ç®€å•çš„Future
        return Futures.transform(future, 
            HelloReply::getMessage, 
            MoreExecutors.directExecutor()
        );
    }
}
```

---

## 3. âš¡ è°ƒç”¨æ–¹å¼é€‰æ‹©


### 3.1 é˜»å¡è°ƒç”¨ vs å¼‚æ­¥è°ƒç”¨


**ğŸ”¸ é˜»å¡è°ƒç”¨çš„ç‰¹ç‚¹**
```
ğŸ“ æ‰“ç”µè¯é—®é—®é¢˜ï¼š
ä½ ï¼šè¯·é—®ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ
å¯¹æ–¹ï¼šç­‰ç­‰ï¼Œæˆ‘æŸ¥ä¸€ä¸‹... (ä½ åœ¨è¿™é‡Œç­‰å¾…)
å¯¹æ–¹ï¼šä»Šå¤©æ™´å¤©ï¼Œ25åº¦
ä½ ï¼šå¥½çš„ï¼Œè°¢è°¢ (ç°åœ¨æ‰èƒ½ç»§ç»­è¯´è¯)

é˜»å¡è°ƒç”¨å°±æ˜¯è¿™æ ·ï¼šå‘é€è¯·æ±‚åå¿…é¡»ç­‰å¾…ç»“æœ
```

```java
// é˜»å¡è°ƒç”¨ç¤ºä¾‹
public void blockingExample() {
    System.out.println("å¼€å§‹è°ƒç”¨æœåŠ¡");
    
    // è¿™é‡Œä¼šç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å™¨è¿”å›
    String result = blockingStub.sayHello(request).getMessage();
    
    System.out.println("æ”¶åˆ°ç»“æœ: " + result);
    System.out.println("ç»§ç»­åç»­å·¥ä½œ");
}
```

**ğŸ”¸ å¼‚æ­¥è°ƒç”¨çš„ç‰¹ç‚¹**
```
ğŸ“§ å‘é‚®ä»¶é—®é—®é¢˜ï¼š
ä½ ï¼šå‘é‚®ä»¶é—®å¤©æ°”æƒ…å†µ
ä½ ï¼šç»§ç»­åšå…¶ä»–å·¥ä½œ (ä¸ç”¨ç­‰å¾…å›å¤)
ä½ ï¼šçœ‹ç”µå½±ã€åƒé¥­ã€èŠå¤©...
é‚®ç®±ï¼šå®ï¼æœ‰æ–°é‚®ä»¶ (ä»€ä¹ˆæ—¶å€™æ”¶åˆ°éƒ½è¡Œ)
ä½ ï¼šæŸ¥çœ‹é‚®ä»¶ï¼šä»Šå¤©æ™´å¤©ï¼Œ25åº¦

å¼‚æ­¥è°ƒç”¨å°±æ˜¯è¿™æ ·ï¼šå‘é€è¯·æ±‚åç«‹å³ç»§ç»­å…¶ä»–å·¥ä½œ
```

```java
// å¼‚æ­¥è°ƒç”¨ç¤ºä¾‹
public void asyncExample() {
    System.out.println("å¼€å§‹è°ƒç”¨æœåŠ¡");
    
    // ç«‹å³è¿”å›Futureï¼Œä¸ç­‰å¾…
    ListenableFuture<HelloReply> future = futureStub.sayHello(request);
    
    System.out.println("ç»§ç»­å…¶ä»–å·¥ä½œ...");
    // å¯ä»¥åšå…¶ä»–äº‹æƒ…
    doOtherWork();
    
    // éœ€è¦ç»“æœæ—¶å†è·å–
    try {
        String result = future.get().getMessage();
        System.out.println("æ”¶åˆ°ç»“æœ: " + result);
    } catch (Exception e) {
        System.out.println("è°ƒç”¨å¤±è´¥: " + e.getMessage());
    }
}
```

### 3.2 ä»€ä¹ˆæ—¶å€™ç”¨å“ªç§æ–¹å¼


| åœºæ™¯ | **æ¨èæ–¹å¼** | **åŸå› ** | **ç¤ºä¾‹** |
|------|------------|---------|---------|
| ğŸ”¸ **ç®€å•æŸ¥è¯¢** | `é˜»å¡è°ƒç”¨` | `é€»è¾‘ç®€å•ï¼Œç­‰å¾…æ—¶é—´çŸ­` | `æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯` |
| ğŸ”¸ **æ‰¹é‡å¤„ç†** | `å¼‚æ­¥è°ƒç”¨` | `å¯ä»¥å¹¶è¡Œå¤„ç†å¤šä¸ªè¯·æ±‚` | `æ‰¹é‡å‘é€æ¶ˆæ¯` |
| ğŸ”¸ **è€—æ—¶æ“ä½œ** | `å¼‚æ­¥è°ƒç”¨` | `é¿å…ç•Œé¢å¡æ­»` | `æ–‡ä»¶ä¸Šä¼ ä¸‹è½½` |
| ğŸ”¸ **å®æ—¶å“åº”** | `é˜»å¡è°ƒç”¨` | `éœ€è¦ç«‹å³å¾—åˆ°ç»“æœ` | `ç™»å½•éªŒè¯` |

```java
// åœºæ™¯1ï¼šç®€å•æŸ¥è¯¢ - ç”¨é˜»å¡è°ƒç”¨
public User getUserInfo(String userId) {
    GetUserRequest request = GetUserRequest.newBuilder()
        .setUserId(userId)
        .build();
    
    // ç›´æ¥ç­‰å¾…ç»“æœï¼Œç®€å•ç›´æ¥
    return userService.getUser(request);
}

// åœºæ™¯2ï¼šæ‰¹é‡å¤„ç† - ç”¨å¼‚æ­¥è°ƒç”¨
public void sendBatchNotifications(List<String> userIds) {
    List<Future<SendResult>> futures = new ArrayList<>();
    
    // å¼‚æ­¥å‘é€æ‰€æœ‰é€šçŸ¥
    for (String userId : userIds) {
        Future<SendResult> future = futureStub.sendNotification(
            buildNotificationRequest(userId)
        );
        futures.add(future);
    }
    
    // ç­‰å¾…æ‰€æœ‰å®Œæˆ
    for (Future<SendResult> future : futures) {
        try {
            SendResult result = future.get();
            System.out.println("å‘é€æˆåŠŸ: " + result.getMessageId());
        } catch (Exception e) {
            System.out.println("å‘é€å¤±è´¥: " + e.getMessage());
        }
    }
}
```

---

## 4. ğŸ“‹ å‚æ•°ä¸è¿”å›å€¼å¤„ç†


### 4.1 å‚æ•°ä¼ é€’çš„æœ€ä½³å®è·µ


**ğŸ”¸ æ„å»ºè¯·æ±‚å‚æ•°**
```java
// âŒ ä¸æ¨èï¼šç›´æ¥è®¾ç½®æ‰€æœ‰å­—æ®µ
HelloRequest request = HelloRequest.newBuilder()
    .setName("å¼ ä¸‰")
    .setAge(25)
    .setEmail("zhangsan@example.com")
    .setPhone("13812345678")
    .build();

// âœ… æ¨èï¼šä½¿ç”¨Builderæ¨¡å¼ï¼Œåˆ†æ­¥æ„å»º
public HelloRequest buildUserRequest(String name, int age, String email) {
    HelloRequest.Builder builder = HelloRequest.newBuilder()
        .setName(name)
        .setAge(age);
    
    // åªåœ¨æœ‰å€¼æ—¶æ‰è®¾ç½®å¯é€‰å­—æ®µ
    if (email != null && !email.isEmpty()) {
        builder.setEmail(email);
    }
    
    return builder.build();
}
```

**ğŸ”¸ Goä¸­çš„å‚æ•°å¤„ç†**
```go
// ç®€å•ç›´æ¥çš„å‚æ•°æ„å»º
request := &pb.HelloRequest{
    Name: "å¼ ä¸‰",
    Age:  25,
}

// å¸¦ä¸Šä¸‹æ–‡çš„è°ƒç”¨
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
defer cancel()

response, err := client.SayHello(ctx, request)
```

### 4.2 è¿”å›å€¼å¤„ç†æŠ€å·§


**ğŸ”¸ å®‰å…¨çš„è¿”å›å€¼å¤„ç†**
```java
public String safeGetUserName(String userId) {
    try {
        GetUserRequest request = GetUserRequest.newBuilder()
            .setUserId(userId)
            .build();
            
        GetUserResponse response = userStub.getUser(request);
        
        // æ£€æŸ¥è¿”å›å€¼æ˜¯å¦æœ‰æ•ˆ
        if (response != null && response.hasUser()) {
            return response.getUser().getName();
        } else {
            return "æœªçŸ¥ç”¨æˆ·";
        }
        
    } catch (StatusRuntimeException e) {
        // gRPCç‰¹å®šå¼‚å¸¸å¤„ç†
        System.err.println("è°ƒç”¨å¤±è´¥: " + e.getStatus());
        return "è·å–å¤±è´¥";
    } catch (Exception e) {
        // å…¶ä»–å¼‚å¸¸å¤„ç†
        System.err.println("æœªçŸ¥é”™è¯¯: " + e.getMessage());
        return "ç³»ç»Ÿé”™è¯¯";
    }
}
```

**ğŸ”¸ æ‰¹é‡ç»“æœå¤„ç†**
```java
public Map<String, String> batchGetUserNames(List<String> userIds) {
    Map<String, String> results = new HashMap<>();
    
    for (String userId : userIds) {
        try {
            String userName = safeGetUserName(userId);
            results.put(userId, userName);
        } catch (Exception e) {
            // å•ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–
            results.put(userId, "è·å–å¤±è´¥");
        }
    }
    
    return results;
}
```

---

## 5. ğŸ”§ è¿æ¥ç®¡ç†ä¸æœ€ä½³å®è·µ


### 5.1 è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†


**ğŸ”¸ æ­£ç¡®çš„è¿æ¥å…³é—­**
```java
public class GrpcClientManager {
    private ManagedChannel channel;
    private GreeterGrpc.GreeterBlockingStub stub;
    
    public void connect(String host, int port) {
        this.channel = ManagedChannelBuilder
            .forAddress(host, port)
            .usePlaintext()
            .build();
        this.stub = GreeterGrpc.newBlockingStub(channel);
    }
    
    // ä¼˜é›…å…³é—­è¿æ¥
    public void shutdown() {
        if (channel != null && !channel.isShutdown()) {
            try {
                // åœæ­¢æ¥å—æ–°è¯·æ±‚
                channel.shutdown();
                
                // ç­‰å¾…ç°æœ‰è¯·æ±‚å®Œæˆï¼Œæœ€å¤šç­‰å¾…5ç§’
                if (!channel.awaitTermination(5, TimeUnit.SECONDS)) {
                    // å¼ºåˆ¶å…³é—­
                    channel.shutdownNow();
                    
                    // å†ç­‰å¾…5ç§’
                    if (!channel.awaitTermination(5, TimeUnit.SECONDS)) {
                        System.err.println("é€šé“æ— æ³•æ­£å¸¸å…³é—­");
                    }
                }
            } catch (InterruptedException e) {
                // å¼ºåˆ¶å…³é—­
                channel.shutdownNow();
                Thread.currentThread().interrupt();
            }
        }
    }
}
```

**ğŸ”¸ Goä¸­çš„è¿æ¥ç®¡ç†**
```go
func main() {
    // å»ºç«‹è¿æ¥
    conn, err := grpc.Dial("localhost:9090", grpc.WithInsecure())
    if err != nil {
        log.Fatalf("è¿æ¥å¤±è´¥: %v", err)
    }
    
    // ç¡®ä¿è¿æ¥ä¼šè¢«å…³é—­
    defer func() {
        if err := conn.Close(); err != nil {
            log.Printf("å…³é—­è¿æ¥å¤±è´¥: %v", err)
        }
    }()
    
    // åˆ›å»ºå®¢æˆ·ç«¯
    client := pb.NewGreeterClient(conn)
    
    // ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨
    response, err := client.SayHello(context.Background(), 
        &pb.HelloRequest{Name: "æµ‹è¯•"})
    if err != nil {
        log.Fatalf("è°ƒç”¨å¤±è´¥: %v", err)
    }
    
    fmt.Printf("ç»“æœ: %s\n", response.GetMessage())
}
```

### 5.2 è¿æ¥å¤ç”¨ç­–ç•¥


**ğŸ”¸ å•ä¾‹æ¨¡å¼ç®¡ç†è¿æ¥**
```java
public class GrpcConnectionPool {
    private static final Map<String, ManagedChannel> channels = new ConcurrentHashMap<>();
    
    // è·å–æˆ–åˆ›å»ºè¿æ¥
    public static ManagedChannel getChannel(String host, int port) {
        String key = host + ":" + port;
        
        return channels.computeIfAbsent(key, k -> {
            System.out.println("åˆ›å»ºæ–°è¿æ¥: " + k);
            return ManagedChannelBuilder
                .forAddress(host, port)
                .usePlaintext()
                .keepAliveTime(30, TimeUnit.SECONDS)      // ä¿æŒè¿æ¥æ´»è·ƒ
                .keepAliveWithoutCalls(true)              // å³ä½¿æ²¡æœ‰è°ƒç”¨ä¹Ÿä¿æŒå¿ƒè·³
                .maxInboundMessageSize(1024 * 1024)       // 1MBæ¶ˆæ¯é™åˆ¶
                .build();
        });
    }
    
    // å…³é—­æ‰€æœ‰è¿æ¥
    public static void shutdownAll() {
        for (ManagedChannel channel : channels.values()) {
            if (!channel.isShutdown()) {
                channel.shutdown();
            }
        }
        channels.clear();
    }
}
```

### 5.3 è¶…æ—¶å’Œé‡è¯•è®¾ç½®


**ğŸ”¸ è¶…æ—¶æ§åˆ¶**
```java
// æ–¹æ³•çº§åˆ«çš„è¶…æ—¶è®¾ç½®
public String callWithTimeout(String name, long timeoutSeconds) {
    try {
        HelloReply response = blockingStub
            .withDeadlineAfter(timeoutSeconds, TimeUnit.SECONDS)  // è®¾ç½®è¶…æ—¶
            .sayHello(HelloRequest.newBuilder().setName(name).build());
        
        return response.getMessage();
        
    } catch (StatusRuntimeException e) {
        if (e.getStatus().getCode() == Status.Code.DEADLINE_EXCEEDED) {
            return "è°ƒç”¨è¶…æ—¶";
        } else {
            return "è°ƒç”¨å¤±è´¥: " + e.getStatus().getDescription();
        }
    }
}
```

**ğŸ”¸ ç®€å•é‡è¯•é€»è¾‘**
```java
public String callWithRetry(String name, int maxRetries) {
    for (int i = 0; i < maxRetries; i++) {
        try {
            HelloReply response = blockingStub.sayHello(
                HelloRequest.newBuilder().setName(name).build()
            );
            return response.getMessage();
            
        } catch (StatusRuntimeException e) {
            System.out.println("ç¬¬" + (i+1) + "æ¬¡è°ƒç”¨å¤±è´¥: " + e.getStatus());
            
            // å¦‚æœæ˜¯æœ€åä¸€æ¬¡å°è¯•ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸
            if (i == maxRetries - 1) {
                throw e;
            }
            
            // ç­‰å¾…ä¸€æ®µæ—¶é—´å†é‡è¯•
            try {
                Thread.sleep(1000 * (i + 1)); // é€’å¢ç­‰å¾…æ—¶é—´
            } catch (InterruptedException ie) {
                Thread.currentThread().interrupt();
                throw new RuntimeException("é‡è¯•è¢«ä¸­æ–­", ie);
            }
        }
    }
    
    return "é‡è¯•å¤±è´¥";
}
```

### 5.4 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¸ åˆ†ç±»å¤„ç†gRPCå¼‚å¸¸**
```java
public class GrpcExceptionHandler {
    
    public static String handleGrpcException(StatusRuntimeException e) {
        Status.Code code = e.getStatus().getCode();
        
        switch (code) {
            case UNAVAILABLE:
                return "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•";
                
            case DEADLINE_EXCEEDED:
                return "è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥";
                
            case NOT_FOUND:
                return "è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨";
                
            case PERMISSION_DENIED:
                return "æƒé™ä¸è¶³ï¼Œè¯·æ£€æŸ¥è®¤è¯ä¿¡æ¯";
                
            case INVALID_ARGUMENT:
                return "è¯·æ±‚å‚æ•°æœ‰è¯¯: " + e.getStatus().getDescription();
                
            case INTERNAL:
                return "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜";
                
            default:
                return "æœªçŸ¥é”™è¯¯: " + e.getStatus().getDescription();
        }
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public String safeCall(String name) {
        try {
            HelloReply response = blockingStub.sayHello(
                HelloRequest.newBuilder().setName(name).build()
            );
            return response.getMessage();
            
        } catch (StatusRuntimeException e) {
            return handleGrpcException(e);
        }
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Channelé€šé“ï¼šå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯çš„"ç”µè¯çº¿"
ğŸ”¸ Stubå­˜æ ¹ï¼šè°ƒç”¨è¿œç¨‹æœåŠ¡çš„"é¥æ§å™¨"
ğŸ”¸ é˜»å¡è°ƒç”¨ï¼šå‘é€è¯·æ±‚åç­‰å¾…ç»“æœï¼Œåƒæ‰“ç”µè¯
ğŸ”¸ å¼‚æ­¥è°ƒç”¨ï¼šå‘é€è¯·æ±‚åç»§ç»­å·¥ä½œï¼Œåƒå‘é‚®ä»¶
ğŸ”¸ è¿æ¥ç®¡ç†ï¼šæ­£ç¡®åˆ›å»ºã€å¤ç”¨ã€å…³é—­è¿æ¥
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šåˆ†ç±»å¤„ç†ä¸åŒçš„é”™è¯¯æƒ…å†µ
```

### 6.2 å…³é”®é€‰æ‹©è¦ç‚¹


**ğŸ”¹ Stubç±»å‹é€‰æ‹©**
```
ç®€å•å¿«é€Ÿçš„æ“ä½œ â†’ BlockingStub (é˜»å¡è°ƒç”¨)
è€—æ—¶è¾ƒé•¿çš„æ“ä½œ â†’ FutureStub (å¼‚æ­¥è°ƒç”¨)
éœ€è¦é«˜å¹¶å‘å¤„ç† â†’ FutureStub (å¼‚æ­¥è°ƒç”¨)
```

**ğŸ”¹ è¿æ¥ç®¡ç†ç­–ç•¥**
```
çŸ­æœŸä½¿ç”¨ â†’ ç”¨å®Œå³å…³é—­
é•¿æœŸä½¿ç”¨ â†’ è¿æ¥å¤ç”¨
é«˜é¢‘è°ƒç”¨ â†’ è¿æ¥æ± ç®¡ç†
```

### 6.3 å®ç”¨è®°å¿†è¦ç‚¹


**ğŸ§  è®°å¿†å£è¯€**
```
Channelæ˜¯æ¡¥æ¢ï¼ŒStubæ˜¯é¥æ§
é˜»å¡åƒç”µè¯ï¼Œå¼‚æ­¥åƒé‚®ä»¶
è¿æ¥è¦å¤ç”¨ï¼Œå¼‚å¸¸è¦åˆ†ç±»
è¶…æ—¶åŠ é‡è¯•ï¼Œä¼˜é›…æ¥å…³é—­
```

**ğŸ”¹ æœ€ä½³å®è·µæ¸…å•**
- [x] **è¿æ¥å¤ç”¨**: é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯è¿æ¥
- [x] **è¶…æ—¶è®¾ç½®**: é˜²æ­¢æ— é™ç­‰å¾…
- [x] **å¼‚å¸¸å¤„ç†**: åˆ†ç±»å¤„ç†ä¸åŒé”™è¯¯
- [x] **ä¼˜é›…å…³é—­**: æ­£ç¡®é‡Šæ”¾èµ„æº
- [x] **å‚æ•°éªŒè¯**: è°ƒç”¨å‰æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§
- [x] **é‡è¯•æœºåˆ¶**: å¤„ç†ä¸´æ—¶æ€§å¤±è´¥

### 6.4 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ å¼€å‘é˜¶æ®µ**
- å…ˆç”¨`BlockingStub`éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§
- ç¡®è®¤æ— è¯¯åæ ¹æ®éœ€è¦æ”¹ä¸º`FutureStub`
- æ·»åŠ é€‚å½“çš„è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

**ğŸš€ ç”Ÿäº§ç¯å¢ƒ**
- å¯ç”¨è¿æ¥æ± å’Œå¿ƒè·³æ£€æµ‹
- å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œç›‘æ§
- åˆç†çš„è¶…æ—¶å’Œé‡è¯•ç­–ç•¥

**æ ¸å¿ƒç†è§£**ï¼š
- gRPCå®¢æˆ·ç«¯è°ƒç”¨å°±åƒä½¿ç”¨é¥æ§å™¨æ“ä½œç”µè§†
- Channelæ˜¯è¿æ¥ï¼ŒStubæ˜¯æ“ä½œæ¥å£
- é€‰æ‹©é˜»å¡è¿˜æ˜¯å¼‚æ­¥å–å†³äºå…·ä½“ä½¿ç”¨åœºæ™¯
- å¥½çš„è¿æ¥ç®¡ç†æ˜¯é«˜æ€§èƒ½çš„åŸºç¡€