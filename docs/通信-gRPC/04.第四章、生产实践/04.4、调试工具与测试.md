---
title: 4ã€è°ƒè¯•å·¥å…·ä¸æµ‹è¯•
---
## ğŸ“š ç›®å½•

1. [å‘½ä»¤è¡Œè°ƒè¯•ç¥å™¨ï¼šgrpcurl](#1-å‘½ä»¤è¡Œè°ƒè¯•ç¥å™¨ï¼šgrpcurl)
2. [äº¤äº’å¼è°ƒè¯•å·¥å…·ï¼šEvans](#2-äº¤äº’å¼è°ƒè¯•å·¥å…·ï¼ševans)
3. [å›¾å½¢ç•Œé¢æµ‹è¯•å·¥å…·](#3-å›¾å½¢ç•Œé¢æµ‹è¯•å·¥å…·)
4. [Protoç¼–è¯‘ä¸åå°„æœåŠ¡](#4-protoç¼–è¯‘ä¸åå°„æœåŠ¡)
5. [å¥åº·æ£€æŸ¥æœºåˆ¶](#5-å¥åº·æ£€æŸ¥æœºåˆ¶)
6. [è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥](#6-è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ å‘½ä»¤è¡Œè°ƒè¯•ç¥å™¨ï¼šgrpcurl


### 1.1 grpcurlæ˜¯ä»€ä¹ˆï¼Ÿ


**ç®€å•ç†è§£**ï¼šgrpcurlå°±åƒæ˜¯gRPCç‰ˆæœ¬çš„curlå·¥å…·ï¼Œä¸“é—¨ç”¨æ¥æµ‹è¯•gRPCæœåŠ¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚

```
ä¼ ç»ŸHTTPæµ‹è¯•ï¼š
curl -X POST https://api.example.com/users

gRPCæµ‹è¯•ï¼š
grpcurl -plaintext localhost:8080 UserService/GetUser
```

**ä¸ºä»€ä¹ˆéœ€è¦grpcurlï¼Ÿ**
- ğŸ¯ **å¿«é€ŸéªŒè¯**ï¼šä¸ç”¨å†™å®¢æˆ·ç«¯ä»£ç å°±èƒ½æµ‹è¯•æœåŠ¡
- ğŸ” **é—®é¢˜æ’æŸ¥**ï¼šç›´æ¥æµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œ
- ğŸ“ **æ¥å£è°ƒè¯•**ï¼šéªŒè¯å‚æ•°å’Œè¿”å›å€¼æ˜¯å¦æ­£ç¡®

### 1.2 å®‰è£…grpcurl


```bash
# macOS
brew install grpcurl

# Linux
go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest

# Windows
# ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶æˆ–ä½¿ç”¨go install
```

### 1.3 grpcurlåŸºæœ¬ä½¿ç”¨


**ğŸ“‹ æœ€ç®€å•çš„è°ƒç”¨ç¤ºä¾‹**

```bash
# è°ƒç”¨æ— å‚æ•°æ–¹æ³•
grpcurl -plaintext localhost:8080 UserService/GetAllUsers

# è°ƒç”¨å¸¦å‚æ•°æ–¹æ³•
grpcurl -plaintext \
  -d '{"user_id": "123"}' \
  localhost:8080 UserService/GetUser
```

**ğŸ”¸ å‚æ•°è¯´æ˜**ï¼š
- `-plaintext`ï¼šä½¿ç”¨HTTPè€Œä¸æ˜¯HTTPSè¿æ¥
- `-d`ï¼šæŒ‡å®šè¯·æ±‚æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
- `localhost:8080`ï¼šæœåŠ¡å™¨åœ°å€å’Œç«¯å£
- `UserService/GetUser`ï¼šæœåŠ¡åå’Œæ–¹æ³•å

### 1.4 æŸ¥çœ‹æœåŠ¡ä¿¡æ¯


```bash
# åˆ—å‡ºæ‰€æœ‰æœåŠ¡
grpcurl -plaintext localhost:8080 list

# æŸ¥çœ‹å…·ä½“æœåŠ¡çš„æ–¹æ³•
grpcurl -plaintext localhost:8080 list UserService

# æŸ¥çœ‹æ–¹æ³•çš„è¯¦ç»†å®šä¹‰
grpcurl -plaintext localhost:8080 describe UserService.GetUser
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
UserService.GetUser is a method:
rpc GetUser ( .GetUserRequest ) returns ( .User );
```

### 1.5 å¤æ‚å‚æ•°è°ƒç”¨


```bash
# å¤æ‚å¯¹è±¡å‚æ•°
grpcurl -plaintext \
  -d '{
    "user": {
      "name": "å¼ ä¸‰",
      "email": "zhangsan@example.com",
      "age": 25
    }
  }' \
  localhost:8080 UserService/CreateUser

# æ•°ç»„å‚æ•°
grpcurl -plaintext \
  -d '{"user_ids": ["123", "456", "789"]}' \
  localhost:8080 UserService/GetUsers
```

---

## 2. ğŸ® äº¤äº’å¼è°ƒè¯•å·¥å…·ï¼šEvans


### 2.1 Evansæ˜¯ä»€ä¹ˆï¼Ÿ


**é€šä¿—è§£é‡Š**ï¼šEvansæ˜¯ä¸€ä¸ªäº¤äº’å¼çš„gRPCå®¢æˆ·ç«¯ï¼Œå°±åƒä¸€ä¸ªgRPCæœåŠ¡çš„"èŠå¤©å·¥å…·"ï¼Œå¯ä»¥å’ŒæœåŠ¡è¿›è¡Œå¯¹è¯å¼çš„äº¤äº’ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼šæ¯æ¬¡æµ‹è¯•éƒ½è¦æ•²ä¸€é•¿ä¸²å‘½ä»¤
Evansæ–¹å¼ï¼šè¿›å…¥äº¤äº’æ¨¡å¼ï¼ŒåƒèŠå¤©ä¸€æ ·æµ‹è¯•æœåŠ¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Evans Interactive Mode          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ > show service                  â”‚
â”‚ > call GetUser                  â”‚
â”‚ > user_id (TYPE_STRING) => 123  â”‚
â”‚ > è°ƒç”¨æˆåŠŸï¼è¿”å›ç”¨æˆ·ä¿¡æ¯         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®‰è£…Evans


```bash
# macOS
brew install evans

# Linux/Windows
go install github.com/ktr0731/evans@latest
```

### 2.3 EvansåŸºæœ¬ä½¿ç”¨


**ğŸš€ å¯åŠ¨Evans**

```bash
# è¿æ¥åˆ°gRPCæœåŠ¡
evans --host localhost --port 8080 --reflection

# å¦‚æœæœåŠ¡å¯ç”¨äº†åå°„ï¼ŒEvansä¼šè‡ªåŠ¨åŠ è½½æœåŠ¡å®šä¹‰
```

**ğŸ’¬ äº¤äº’å¼æ“ä½œ**

```bash
# è¿›å…¥Evansåçš„æ“ä½œ
evans> show service
+-------------+----------+-------------------+
| SERVICE     | RPC      | REQUEST TYPE      |
+-------------+----------+-------------------+
| UserService | GetUser  | GetUserRequest    |
| UserService | GetUsers | GetUsersRequest   |
+-------------+----------+-------------------+

# é€‰æ‹©æœåŠ¡
evans> service UserService

# è°ƒç”¨æ–¹æ³•
evans> call GetUser
user_id (TYPE_STRING) => 123
{
  "userId": "123",
  "name": "å¼ ä¸‰",
  "email": "zhangsan@example.com"
}
```

### 2.4 Evansçš„ä¼˜åŠ¿


**ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹©Evansï¼Ÿ**

```
å‘½ä»¤è¡Œå·¥å…·å¯¹æ¯”ï¼š

grpcurlï¼š
âœ… å¿«é€Ÿæµ‹è¯•
âŒ æ¯æ¬¡éƒ½è¦å†™å®Œæ•´å‘½ä»¤
âŒ å¤æ‚å‚æ•°ä¸å¥½è¾“å…¥

Evansï¼š
âœ… äº¤äº’å¼ä½“éªŒ
âœ… è‡ªåŠ¨è¡¥å…¨
âœ… å‚æ•°é€ä¸ªè¾“å…¥
âœ… å†å²è®°å½•
```

**ğŸ” å®é™…ä½¿ç”¨åœºæ™¯**

```bash
# æµ‹è¯•å¤æ‚çš„åµŒå¥—å¯¹è±¡
evans> call CreateUser
name (TYPE_STRING) => å¼ ä¸‰
email (TYPE_STRING) => zhangsan@example.com
profile (TYPE_MESSAGE) => {
  age (TYPE_INT32) => 25
  city (TYPE_STRING) => åŒ—äº¬
}
```

---

## 3. ğŸ–¥ï¸ å›¾å½¢ç•Œé¢æµ‹è¯•å·¥å…·


### 3.1 å·¥å…·å¯¹æ¯”æ¦‚è§ˆ


| å·¥å…· | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ æˆæœ¬** |
|------|---------|-------------|-------------|
| **BloomRPC** | `è½»é‡çº§ï¼Œä¸“ä¸ºgRPCè®¾è®¡` | `å¼€å‘è°ƒè¯•` | `ä½` |
| **Postman** | `åŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒå¤šåè®®` | `å›¢é˜Ÿåä½œï¼Œæ¥å£ç®¡ç†` | `ä¸­` |
| **Evans** | `å‘½ä»¤è¡Œ+GUIåŒæ¨¡å¼` | `å¼€å‘è€…å·¥å…·` | `ä½` |

### 3.2 BloomRPCè¯¦ç»†ä½¿ç”¨


**ğŸŒ¸ ä»€ä¹ˆæ˜¯BloomRPCï¼Ÿ**

BloomRPCæ˜¯ä¸“é—¨ä¸ºgRPCè®¾è®¡çš„å›¾å½¢ç•Œé¢æµ‹è¯•å·¥å…·ï¼Œå°±åƒPostmanä¹‹äºHTTP APIã€‚

**ğŸ“¥ å®‰è£…BloomRPC**

```bash
# ä¸‹è½½åœ°å€ï¼šhttps://github.com/uw-labs/bloomrpc/releases
# æ”¯æŒ Windowsã€macOSã€Linux
```

**ğŸ”§ BloomRPCä½¿ç”¨æ­¥éª¤**

```
æ­¥éª¤1ï¼šå¯¼å…¥Protoæ–‡ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç‚¹å‡»"Import Protos"          â”‚
â”‚ 2. é€‰æ‹©ä½ çš„.protoæ–‡ä»¶           â”‚
â”‚ 3. BloomRPCè‡ªåŠ¨è§£ææœåŠ¡å®šä¹‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šé…ç½®æœåŠ¡å™¨åœ°å€
Server URL: localhost:8080
âœ… Use TLS: å…³é—­ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

æ­¥éª¤3ï¼šé€‰æ‹©æ–¹æ³•å¹¶å‘é€è¯·æ±‚
Service: UserService
Method: GetUser
Request: {"user_id": "123"}
```

**ğŸ“Š BloomRPCç•Œé¢å¸ƒå±€**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡åˆ—è¡¨    â”‚           è¯·æ±‚åŒºåŸŸ               â”‚
â”‚             â”‚                                â”‚
â”‚ UserService â”‚  Method: GetUser               â”‚
â”‚ â”œâ”€GetUser   â”‚  Request:                      â”‚
â”‚ â”œâ”€GetUsers  â”‚  {                             â”‚
â”‚ â””â”€CreateUserâ”‚    "user_id": "123"            â”‚
â”‚             â”‚  }                             â”‚
â”‚             â”‚                                â”‚
â”‚             â”‚  [Send Request]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å†å²è®°å½•    â”‚           å“åº”åŒºåŸŸ               â”‚
â”‚             â”‚                                â”‚
â”‚ æœ€è¿‘è°ƒç”¨:    â”‚  Status: OK                    â”‚
â”‚ GetUser     â”‚  Response:                     â”‚
â”‚ CreateUser  â”‚  {                             â”‚
â”‚             â”‚    "user_id": "123",           â”‚
â”‚             â”‚    "name": "å¼ ä¸‰",              â”‚
â”‚             â”‚    "email": "zhangsan@..."     â”‚
â”‚             â”‚  }                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Postman gRPCæ¨¡å¼


**ğŸš€ Postmanæ–°åŠŸèƒ½**

Postmanç°åœ¨æ”¯æŒgRPCè°ƒç”¨ï¼Œå¯¹äºå·²ç»ä½¿ç”¨Postmançš„å›¢é˜Ÿå¾ˆæ–¹ä¾¿ã€‚

```bash
ä½¿ç”¨æ­¥éª¤ï¼š
1. æ–°å»ºè¯·æ±‚ï¼Œé€‰æ‹©"gRPC"ç±»å‹
2. è¾“å…¥æœåŠ¡å™¨åœ°å€ï¼šlocalhost:8080
3. å¯¼å…¥protoæ–‡ä»¶æˆ–ä½¿ç”¨æœåŠ¡åå°„
4. é€‰æ‹©æœåŠ¡å’Œæ–¹æ³•
5. å¡«å†™è¯·æ±‚å‚æ•°
6. å‘é€è¯·æ±‚
```

**ğŸ’¡ Postmançš„ä¼˜åŠ¿**

- ğŸ”„ **å›¢é˜Ÿåä½œ**ï¼šå¯ä»¥åˆ†äº«è¯·æ±‚é›†åˆ
- ğŸ“ **æ–‡æ¡£ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
- ğŸ§ª **æµ‹è¯•è„šæœ¬**ï¼šæ”¯æŒè‡ªåŠ¨åŒ–æµ‹è¯•
- ğŸ’¾ **ç¯å¢ƒç®¡ç†**ï¼šä¸åŒç¯å¢ƒçš„é…ç½®ç®¡ç†

---

## 4. âš™ï¸ Protoç¼–è¯‘ä¸åå°„æœåŠ¡


### 4.1 protocç¼–è¯‘å‘½ä»¤è¯¦è§£


**ğŸ”§ ä»€ä¹ˆæ˜¯protocï¼Ÿ**

protocæ˜¯Protocol Buffersçš„ç¼–è¯‘å™¨ï¼ŒæŠŠ`.proto`æ–‡ä»¶ç¼–è¯‘æˆå„ç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚

**ğŸ“‹ å¸¸ç”¨ç¼–è¯‘å‘½ä»¤**

```bash
# åŸºæœ¬ç¼–è¯‘å‘½ä»¤
protoc --go_out=. --go-grpc_out=. user.proto

# è¯¦ç»†å‚æ•°è¯´æ˜
protoc \
  --proto_path=.           # protoæ–‡ä»¶æœç´¢è·¯å¾„
  --go_out=./pb           # Goä»£ç è¾“å‡ºç›®å½•
  --go-grpc_out=./pb      # gRPC Goä»£ç è¾“å‡ºç›®å½•
  user.proto              # è¦ç¼–è¯‘çš„protoæ–‡ä»¶
```

**ğŸ”¸ å‚æ•°å«ä¹‰**ï¼š
- `--proto_path`ï¼šæŒ‡å®šprotoæ–‡ä»¶çš„æœç´¢è·¯å¾„
- `--go_out`ï¼šç”ŸæˆGoçš„æ•°æ®ç»“æ„ä»£ç 
- `--go-grpc_out`ï¼šç”ŸæˆGoçš„gRPCæœåŠ¡ä»£ç 

**ğŸ“‚ è¾“å‡ºæ–‡ä»¶è¯´æ˜**

```
ç¼–è¯‘å‰ï¼š
user.proto

ç¼–è¯‘åï¼š
â”œâ”€â”€ user.pb.go          # æ•°æ®ç»“æ„å®šä¹‰
â””â”€â”€ user_grpc.pb.go     # gRPCæœåŠ¡å®šä¹‰

æ–‡ä»¶ä½œç”¨ï¼š
user.pb.go       â†’ æ¶ˆæ¯ç±»å‹ã€åºåˆ—åŒ–æ–¹æ³•
user_grpc.pb.go  â†’ æœåŠ¡æ¥å£ã€å®¢æˆ·ç«¯ä»£ç 
```

### 4.2 åå°„æœåŠ¡å¯ç”¨


**ğŸ” ä»€ä¹ˆæ˜¯gRPCåå°„ï¼Ÿ**

åå°„æœåŠ¡è®©å®¢æˆ·ç«¯å·¥å…·èƒ½å¤ŸåŠ¨æ€è·å–æœåŠ¡çš„å®šä¹‰ä¿¡æ¯ï¼Œä¸éœ€è¦æå‰çŸ¥é“protoæ–‡ä»¶ã€‚

**âš¡ å¯ç”¨åå°„æœåŠ¡**

```go
package main

import (
    "net"
    "google.golang.org/grpc"
    "google.golang.org/grpc/reflection"
)

func main() {
    server := grpc.NewServer()
    
    // æ³¨å†Œä½ çš„æœåŠ¡
    RegisterUserServiceServer(server, &userServer{})
    
    // ğŸ”¥ å¯ç”¨åå°„æœåŠ¡ - å°±è¿™ä¸€è¡Œï¼
    reflection.Register(server)
    
    lis, _ := net.Listen("tcp", ":8080")
    server.Serve(lis)
}
```

**ğŸ¯ åå°„çš„å¥½å¤„**

```
æ²¡æœ‰åå°„ï¼š
1. å®¢æˆ·ç«¯éœ€è¦protoæ–‡ä»¶
2. å·¥å…·æ— æ³•è‡ªåŠ¨å‘ç°æœåŠ¡
3. è°ƒè¯•éº»çƒ¦

æœ‰äº†åå°„ï¼š
1. å·¥å…·è‡ªåŠ¨è·å–æœåŠ¡ä¿¡æ¯
2. grpcurl/Evanså¯ä»¥ç›´æ¥ä½¿ç”¨
3. åŠ¨æ€è°ƒè¯•å¾ˆæ–¹ä¾¿
```

**âš ï¸ ç”Ÿäº§ç¯å¢ƒæ³¨æ„**

```go
// å¼€å‘ç¯å¢ƒï¼šå¯ç”¨åå°„
if os.Getenv("ENV") == "development" {
    reflection.Register(server)
}

// ç”Ÿäº§ç¯å¢ƒé€šå¸¸ä¸å¯ç”¨åå°„ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
```

---

## 5. ğŸ¥ å¥åº·æ£€æŸ¥æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯gRPCå¥åº·æ£€æŸ¥ï¼Ÿ


**é€šä¿—è§£é‡Š**ï¼šå¥åº·æ£€æŸ¥å°±åƒç»™æœåŠ¡å®šæœŸ"ä½“æ£€"ï¼Œç¡®ä¿æœåŠ¡è¿˜æ´»ç€å¹¶ä¸”èƒ½æ­£å¸¸å·¥ä½œã€‚

```
æœåŠ¡å¥åº·çŠ¶æ€ï¼š
ğŸ˜Š SERVING     - æœåŠ¡æ­£å¸¸ï¼Œå¯ä»¥å¤„ç†è¯·æ±‚
ğŸ˜· NOT_SERVING - æœåŠ¡æœ‰é—®é¢˜ï¼Œæš‚æ—¶ä¸èƒ½å¤„ç†
â“ UNKNOWN     - ä¸çŸ¥é“çŠ¶æ€ï¼ˆåˆšå¯åŠ¨æˆ–æ£€æŸ¥å¤±è´¥ï¼‰

å¥åº·æ£€æŸ¥æµç¨‹ï¼š
è´Ÿè½½å‡è¡¡å™¨ â”€â”€å¥åº·æ£€æŸ¥â”€â”€> gRPCæœåŠ¡
     â”‚                      â”‚
     â””â”€ æ ¹æ®ç»“æœå†³å®šæ˜¯å¦è½¬å‘è¯·æ±‚
```

### 5.2 ä½¿ç”¨grpc_health_v1åè®®


**ğŸ“‹ æ ‡å‡†å¥åº·æ£€æŸ¥å®ç°**

```go
import (
    "google.golang.org/grpc/health"
    "google.golang.org/grpc/health/grpc_health_v1"
)

func main() {
    server := grpc.NewServer()
    
    // åˆ›å»ºå¥åº·æ£€æŸ¥æœåŠ¡
    healthServer := health.NewServer()
    
    // æ³¨å†Œå¥åº·æ£€æŸ¥æœåŠ¡
    grpc_health_v1.RegisterHealthServer(server, healthServer)
    
    // æ³¨å†Œä½ çš„ä¸šåŠ¡æœåŠ¡
    RegisterUserServiceServer(server, &userServer{})
    
    // è®¾ç½®æœåŠ¡çŠ¶æ€ä¸ºæ­£å¸¸
    healthServer.SetServingStatus("UserService", grpc_health_v1.HealthCheckResponse_SERVING)
    
    server.Serve(lis)
}
```

**ğŸ”§ åŠ¨æ€æ›´æ–°å¥åº·çŠ¶æ€**

```go
// å½“æœåŠ¡å‡ºç°é—®é¢˜æ—¶
healthServer.SetServingStatus("UserService", grpc_health_v1.HealthCheckResponse_NOT_SERVING)

// æœåŠ¡æ¢å¤å
healthServer.SetServingStatus("UserService", grpc_health_v1.HealthCheckResponse_SERVING)

// è®¾ç½®æ•´ä½“æœåŠ¡çŠ¶æ€
healthServer.SetServingStatus("", grpc_health_v1.HealthCheckResponse_SERVING)
```

### 5.3 å®¢æˆ·ç«¯å¥åº·æ£€æŸ¥


**ğŸ“ å¦‚ä½•æ£€æŸ¥æœåŠ¡å¥åº·**

```bash
# ä½¿ç”¨grpcurlæ£€æŸ¥å¥åº·çŠ¶æ€
grpcurl -plaintext \
  -d '{"service": "UserService"}' \
  localhost:8080 grpc.health.v1.Health/Check

# è¿”å›ç»“æœ
{
  "status": "SERVING"
}
```

**ğŸ”„ æŒç»­å¥åº·ç›‘æ§**

```go
// å®¢æˆ·ç«¯ä»£ç 
healthClient := grpc_health_v1.NewHealthClient(conn)

// ä¸€æ¬¡æ€§æ£€æŸ¥
resp, err := healthClient.Check(ctx, &grpc_health_v1.HealthCheckRequest{
    Service: "UserService",
})

// æŒç»­ç›‘æ§ï¼ˆæµå¼ï¼‰
stream, err := healthClient.Watch(ctx, &grpc_health_v1.HealthCheckRequest{
    Service: "UserService",
})

for {
    resp, err := stream.Recv()
    if err != nil {
        break
    }
    fmt.Printf("æœåŠ¡çŠ¶æ€: %v\n", resp.Status)
}
```

---

## 6. ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥


### 6.1 æµ‹è¯•é‡‘å­—å¡”åœ¨gRPCä¸­çš„åº”ç”¨


```
        /\
       /  \      E2Eæµ‹è¯•
      /____\     (å°‘é‡ï¼Œè¦†ç›–å…³é”®æµç¨‹)
     /      \
    /        \   é›†æˆæµ‹è¯•
   /__________\  (é€‚é‡ï¼Œæµ‹è¯•æœåŠ¡äº¤äº’)
  /            \
 /              \ å•å…ƒæµ‹è¯•
/________________\ (å¤§é‡ï¼Œæµ‹è¯•ä¸šåŠ¡é€»è¾‘)

gRPCæµ‹è¯•ç­–ç•¥ï¼š
å•å…ƒæµ‹è¯•: æµ‹è¯•ä¸šåŠ¡é€»è¾‘å‡½æ•°
é›†æˆæµ‹è¯•: æµ‹è¯•gRPCæœåŠ¡è°ƒç”¨
E2Eæµ‹è¯•: æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
```

### 6.2 å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ


**ğŸ¯ ä¸šåŠ¡é€»è¾‘æµ‹è¯•**

```go
// æµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ¶‰åŠgRPC
func TestCreateUser(t *testing.T) {
    userService := &UserService{}
    
    user := &User{
        Name:  "å¼ ä¸‰",
        Email: "zhangsan@example.com",
    }
    
    result, err := userService.CreateUserLogic(user)
    assert.NoError(t, err)
    assert.NotEmpty(t, result.UserId)
}
```

### 6.3 gRPCæœåŠ¡é›†æˆæµ‹è¯•


**ğŸ”§ æµ‹è¯•æœåŠ¡ç«¯**

```go
func TestUserServiceGRPC(t *testing.T) {
    // å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨
    server := grpc.NewServer()
    userService := &UserServiceImpl{}
    RegisterUserServiceServer(server, userService)
    
    lis, err := net.Listen("tcp", ":0") // éšæœºç«¯å£
    require.NoError(t, err)
    
    go server.Serve(lis)
    defer server.Stop()
    
    // åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥
    conn, err := grpc.Dial(lis.Addr().String(), grpc.WithInsecure())
    require.NoError(t, err)
    defer conn.Close()
    
    client := NewUserServiceClient(conn)
    
    // æµ‹è¯•æ–¹æ³•è°ƒç”¨
    resp, err := client.GetUser(context.Background(), &GetUserRequest{
        UserId: "123",
    })
    
    assert.NoError(t, err)
    assert.Equal(t, "123", resp.UserId)
}
```

### 6.4 æ€§èƒ½æµ‹è¯•


**âš¡ å‹åŠ›æµ‹è¯•å·¥å…·**

```bash
# ä½¿ç”¨ghzè¿›è¡ŒgRPCå‹åŠ›æµ‹è¯•
ghz --insecure \
    --proto user.proto \
    --call UserService.GetUser \
    -d '{"user_id":"123"}' \
    -c 50 \
    -n 1000 \
    localhost:8080

# å‚æ•°è¯´æ˜ï¼š
# -c 50: å¹¶å‘è¿æ¥æ•°
# -n 1000: æ€»è¯·æ±‚æ•°
```

**ğŸ“Š æ€§èƒ½åˆ†æå·¥å…·é›†æˆ**

```go
import _ "net/http/pprof"

func main() {
    // å¯åŠ¨pprofæœåŠ¡å™¨
    go func() {
        log.Println(http.ListenAndServe("localhost:6060", nil))
    }()
    
    // ä½ çš„gRPCæœåŠ¡ä»£ç 
    server := grpc.NewServer()
    // ...
}

// ä½¿ç”¨æ–¹æ³•ï¼š
// go tool pprof http://localhost:6060/debug/pprof/profile
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„è°ƒè¯•å·¥å…·


```
ğŸ”§ å‘½ä»¤è¡Œå·¥å…·ï¼š
â”œâ”€ grpcurl: å¿«é€Ÿæµ‹è¯•ï¼Œç±»ä¼¼curl
â”œâ”€ Evans: äº¤äº’å¼è°ƒè¯•ï¼Œä½“éªŒå‹å¥½
â””â”€ protoc: protoæ–‡ä»¶ç¼–è¯‘å·¥å…·

ğŸ–¥ï¸ å›¾å½¢ç•Œé¢ï¼š
â”œâ”€ BloomRPC: ä¸“ä¸šgRPCæµ‹è¯•å·¥å…·
â”œâ”€ Postman: å…¨èƒ½æ¥å£æµ‹è¯•å·¥å…·
â””â”€ æµè§ˆå™¨æ’ä»¶: è½»é‡çº§é€‰æ‹©
```

### 7.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¸ å¼€å‘ç¯å¢ƒå¿…å¤‡è®¾ç½®**

```go
// 1. å¯ç”¨åå°„æœåŠ¡
reflection.Register(server)

// 2. é…ç½®å¥åº·æ£€æŸ¥
healthServer := health.NewServer()
grpc_health_v1.RegisterHealthServer(server, healthServer)

// 3. å¯ç”¨è¯¦ç»†æ—¥å¿—
grpclog.SetLoggerV2(grpclog.NewLoggerV2(os.Stdout, os.Stdout, os.Stdout))
```

### 7.3 æµ‹è¯•ç­–ç•¥æ€»ç»“


```
æµ‹è¯•å±‚æ¬¡è§„åˆ’ï¼š
ğŸ“Š å•å…ƒæµ‹è¯• (70%): ä¸šåŠ¡é€»è¾‘éªŒè¯
ğŸ”— é›†æˆæµ‹è¯• (20%): æœåŠ¡äº¤äº’éªŒè¯  
ğŸŒ ç«¯åˆ°ç«¯æµ‹è¯• (10%): å®Œæ•´æµç¨‹éªŒè¯

å·¥å…·é€‰æ‹©ï¼š
ğŸš€ å¿«é€ŸéªŒè¯: grpcurl
ğŸ® äº¤äº’è°ƒè¯•: Evans
ğŸ–¼ï¸ å›¾å½¢ç•Œé¢: BloomRPC
âš¡ æ€§èƒ½æµ‹è¯•: ghz
ğŸ” ä»£ç åˆ†æ: pprof
```

### 7.4 ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹


```
ğŸ”’ å®‰å…¨è€ƒè™‘ï¼š
âŒ ç”Ÿäº§ç¯å¢ƒå…³é—­åå°„æœåŠ¡
âœ… å¯ç”¨TLSåŠ å¯†
âœ… é…ç½®è®¿é—®æ§åˆ¶

ğŸ“Š ç›‘æ§å‘Šè­¦ï¼š
âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
âœ… æ€§èƒ½æŒ‡æ ‡æ”¶é›†
âœ… é”™è¯¯æ—¥å¿—è®°å½•
âœ… è°ƒç”¨é“¾è·Ÿè¸ª
```

### 7.5 å®è·µå»ºè®®


**ğŸ¯ å¼€å‘é˜¶æ®µ**
- ä¼˜å…ˆä½¿ç”¨Evansè¿›è¡Œäº¤äº’å¼è°ƒè¯•
- é…ç½®BloomRPCä½œä¸ºå›¾å½¢ç•Œé¢å·¥å…·
- å¯ç”¨åå°„å’Œå¥åº·æ£€æŸ¥

**ğŸ§ª æµ‹è¯•é˜¶æ®µ**  
- ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•
- ä½¿ç”¨ghzè¿›è¡Œæ€§èƒ½æµ‹è¯•
- é›†æˆCI/CDè‡ªåŠ¨åŒ–æµ‹è¯•

**ğŸš€ éƒ¨ç½²é˜¶æ®µ**
- å…³é—­åå°„æœåŠ¡
- é…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- è®¾ç½®ç›‘æ§å’Œå‘Šè­¦

**æ ¸å¿ƒè®°å¿†**ï¼š
- grpcurlå¿«é€Ÿæµ‹è¯•ï¼ŒEvansäº¤äº’è°ƒè¯•
- BloomRPCå›¾å½¢ç•Œé¢ï¼ŒPostmanå›¢é˜Ÿåä½œ
- åå°„æœåŠ¡å¼€å‘ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒè¦å…³é—­
- å¥åº·æ£€æŸ¥å¾ˆé‡è¦ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ä¸èƒ½å°‘