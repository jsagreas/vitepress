---
title: 3ã€æœåŠ¡å®šä¹‰ä¸å››ç§é€šä¿¡æ–¹å¼
---
## ğŸ“š ç›®å½•

1. [gRPCæœåŠ¡å®šä¹‰åŸºç¡€](#1-grpcæœåŠ¡å®šä¹‰åŸºç¡€)
2. [å››ç§é€šä¿¡æ–¹å¼è¯¦è§£](#2-å››ç§é€šä¿¡æ–¹å¼è¯¦è§£)
3. [é€šä¿¡æ–¹å¼é€‰æ‹©æŒ‡å—](#3-é€šä¿¡æ–¹å¼é€‰æ‹©æŒ‡å—)
4. [æ¶ˆæ¯è®¾è®¡åŸåˆ™](#4-æ¶ˆæ¯è®¾è®¡åŸåˆ™)
5. [å®è·µç¼–ç åœºæ™¯](#5-å®è·µç¼–ç åœºæ™¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ gRPCæœåŠ¡å®šä¹‰åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡å®šä¹‰


**ğŸ”¸ é€šä¿—ç†è§£**
```
æŠŠgRPCæœåŠ¡æƒ³è±¡æˆä¸€ä¸ªé¤å…ï¼š
- service = é¤å…åç§°
- rpcæ–¹æ³• = é¤å…æä¾›çš„èœå“
- è¯·æ±‚ç±»å‹ = ç‚¹èœå•
- å“åº”ç±»å‹ = ä¸Šèœçš„ç›˜å­

é¡¾å®¢ï¼ˆå®¢æˆ·ç«¯ï¼‰æ‹¿ç€èœå•ï¼ˆè¯·æ±‚ï¼‰ç‚¹èœï¼Œ
æœåŠ¡å‘˜ï¼ˆæœåŠ¡ç«¯ï¼‰æŒ‰èœå•åšèœå¹¶ä¸Šèœï¼ˆå“åº”ï¼‰
```

### 1.2 serviceå…³é”®å­—ï¼šå®šä¹‰ä½ çš„"æœåŠ¡é¤å…"


**ğŸ’¡ åŸºæœ¬è¯­æ³•**
```protobuf
// å®šä¹‰ä¸€ä¸ªç”¨æˆ·æœåŠ¡
service UserService {
    // åœ¨è¿™é‡Œå®šä¹‰æœåŠ¡æä¾›çš„æ‰€æœ‰æ–¹æ³•
}
```

**ğŸ¯ å®é™…ç¤ºä¾‹**
```protobuf
// æƒ³è±¡è¿™æ˜¯ä¸€ä¸ªåœ¨çº¿å•†åº—çš„æœåŠ¡
service ShopService {
    // è·å–å•†å“ä¿¡æ¯
    rpc GetProduct(ProductRequest) returns (ProductResponse);
    
    // ä¸‹è®¢å•
    rpc CreateOrder(OrderRequest) returns (OrderResponse);
    
    // æŸ¥çœ‹è®¢å•çŠ¶æ€
    rpc GetOrderStatus(OrderStatusRequest) returns (OrderStatusResponse);
}
```

### 1.3 rpcæ–¹æ³•å®šä¹‰ï¼šå…·ä½“çš„"èœå“"


**ğŸ“‹ æ ‡å‡†æ ¼å¼**
```
rpc æ–¹æ³•å(è¯·æ±‚ç±»å‹) returns (å“åº”ç±»å‹);
```

**ğŸ”¸ ç†è§£è¦ç‚¹**
- **æ–¹æ³•å**ï¼šå‘Šè¯‰åˆ«äººè¿™ä¸ªåŠŸèƒ½å«ä»€ä¹ˆï¼ˆå¦‚GetUserã€CreateOrderï¼‰
- **è¯·æ±‚ç±»å‹**ï¼šå®¢æˆ·ç«¯éœ€è¦å‘é€ä»€ä¹ˆæ•°æ®
- **å“åº”ç±»å‹**ï¼šæœåŠ¡ç«¯ä¼šè¿”å›ä»€ä¹ˆæ•°æ®
- **æ‹¬å·å’Œåˆ†å·**ï¼šå›ºå®šè¯­æ³•ï¼Œä¸èƒ½çœç•¥

**ğŸ’¡ å‘½åå»ºè®®**
```protobuf
// âœ… å¥½çš„å‘½åï¼šåŠ¨è¯å¼€å¤´ï¼Œè¯­ä¹‰æ¸…æ™°
rpc GetUser(GetUserRequest) returns (GetUserResponse);
rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
rpc UpdateProfile(UpdateProfileRequest) returns (UpdateProfileResponse);

// âŒ ä¸å¥½çš„å‘½åï¼šå«ç³Šä¸æ¸…
rpc User(UserMsg) returns (UserMsg);
rpc DoSomething(Request) returns (Response);
```

---

## 2. ğŸ”„ å››ç§é€šä¿¡æ–¹å¼è¯¦è§£


> ğŸ’¡ **è®°å¿†æŠ€å·§**
> 
> æƒ³è±¡æ‰“ç”µè¯çš„å››ç§æ–¹å¼ï¼š
> - **Unary**ï¼šæ™®é€šé€šè¯ï¼ˆä¸€é—®ä¸€ç­”ï¼‰
> - **Server Streaming**ï¼šå¬å¹¿æ’­ï¼ˆå¯¹æ–¹ä¸€ç›´è¯´ï¼‰
> - **Client Streaming**ï¼šå½•è¯­éŸ³ï¼ˆä½ ä¸€ç›´è¯´ï¼‰
> - **Bidirectional**ï¼šèŠå¤©ï¼ˆåŒæ–¹éƒ½åœ¨è¯´è¯ï¼‰

### 2.1 Unary RPCï¼šä¸€é—®ä¸€ç­”ï¼ˆæœ€å¸¸ç”¨ï¼‰


**ğŸ¯ ä»€ä¹ˆæ˜¯Unary RPC**
```
å°±åƒå¹³æ—¶é—®é—®é¢˜ï¼š
ä½ é—®ï¼š"ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
æœ‹å‹ç­”ï¼š"ä»Šå¤©æ™´å¤©ï¼Œ25åº¦ã€‚"
ä¸€ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªå›ç­”ï¼Œç»“æŸã€‚
```

**ğŸ“ Protoå®šä¹‰**
```protobuf
service WeatherService {
    // æ™®é€šçš„ä¸€é—®ä¸€ç­”ï¼Œä¸éœ€è¦streamå…³é”®å­—
    rpc GetWeather(WeatherRequest) returns (WeatherResponse);
}

message WeatherRequest {
    string city = 1;  // æŸ¥è¯¢å“ªä¸ªåŸå¸‚
}

message WeatherResponse {
    string weather = 1;    // å¤©æ°”æƒ…å†µ
    int32 temperature = 2; // æ¸©åº¦
}
```

**ğŸ”§ ä½¿ç”¨åœºæ™¯**
```
âœ… è·å–ç”¨æˆ·ä¿¡æ¯
âœ… ç™»å½•éªŒè¯
âœ… æŸ¥è¯¢å•†å“è¯¦æƒ…
âœ… æ•°æ®åº“å¢åˆ æ”¹æŸ¥
âœ… 90%çš„å¸¸è§ä¸šåŠ¡åœºæ™¯
```

**ğŸ“Š é€šä¿¡æµç¨‹å›¾**
```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
   |                        |
   |----å‘é€è¯·æ±‚(åŸå¸‚å)---->|
   |                        |å¤„ç†è¯·æ±‚
   |                        |æŸ¥è¯¢å¤©æ°”
   |<---è¿”å›ç»“æœ(å¤©æ°”ä¿¡æ¯)---|
   |                        |
  å®Œæˆ                     å®Œæˆ
```

### 2.2 Server Streamingï¼šæœåŠ¡ç«¯æµå¼å“åº”


**ğŸ¯ ä»€ä¹ˆæ˜¯Server Streaming**
```
å°±åƒå¬æ–°é—»å¹¿æ’­ï¼š
ä½ è¯´ï¼š"æˆ‘è¦å¬ä»Šå¤©çš„æ–°é—»"
å¹¿æ’­å‘˜è¿ç»­æ’­æŠ¥ï¼š"ç¬¬ä¸€æ¡æ–°é—»...ç¬¬äºŒæ¡æ–°é—»...ç¬¬ä¸‰æ¡..."
ä½ å‘ä¸€æ¬¡è¯·æ±‚ï¼Œå¯¹æ–¹è¿ç»­å‘é€å¤šæ¬¡å›å¤ã€‚
```

**ğŸ“ Protoå®šä¹‰**
```protobuf
service NewsService {
    // æ³¨æ„ï¼šreturnsåé¢æœ‰streamå…³é”®å­—
    rpc GetNewsStream(NewsRequest) returns (stream NewsResponse);
}

message NewsRequest {
    string category = 1;  // æ–°é—»åˆ†ç±»
}

message NewsResponse {
    string title = 1;     // æ–°é—»æ ‡é¢˜
    string content = 2;   // æ–°é—»å†…å®¹
    int64 timestamp = 3;  // å‘å¸ƒæ—¶é—´
}
```

**ğŸ”§ ä½¿ç”¨åœºæ™¯**
```
âœ… å®æ—¶æ•°æ®æ¨é€ï¼ˆè‚¡ç¥¨ä»·æ ¼ã€ç›‘æ§æ•°æ®ï¼‰
âœ… å¤§æ–‡ä»¶ä¸‹è½½ï¼ˆåˆ†å—ä¼ è¾“ï¼‰
âœ… æ—¥å¿—å®æ—¶è¾“å‡º
âœ… èŠå¤©å®¤æ¶ˆæ¯æ¨é€
âœ… æ•°æ®åº“æŸ¥è¯¢å¤§é‡ç»“æœ
```

**ğŸ“Š é€šä¿¡æµç¨‹å›¾**
```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
   |                        |
   |----å‘é€è¯·æ±‚(æ–°é—»ç±»å‹)-->|
   |                        |å¼€å§‹æŸ¥æ‰¾æ–°é—»
   |<---ç¬¬1æ¡æ–°é—»----------|
   |<---ç¬¬2æ¡æ–°é—»----------|
   |<---ç¬¬3æ¡æ–°é—»----------|
   |<---...æ›´å¤šæ–°é—»--------|
   |<---ç»“æŸä¿¡å·----------|
   |                        |
  å®Œæˆ                     å®Œæˆ
```

### 2.3 Client Streamingï¼šå®¢æˆ·ç«¯æµå¼è¯·æ±‚


**ğŸ¯ ä»€ä¹ˆæ˜¯Client Streaming**
```
å°±åƒå½•éŸ³ç»™æœ‹å‹ï¼š
ä½ è¿ç»­è¯´ï¼š"ç¬¬ä¸€æ®µè¯...ç¬¬äºŒæ®µè¯...ç¬¬ä¸‰æ®µè¯...å½•å®Œäº†"
æœ‹å‹å¬å®Œåå›å¤ï¼š"æˆ‘å¬å®Œäº†ï¼Œæ€»å…±3åˆ†é’Ÿ"
ä½ è¿ç»­å‘é€å¤šæ¬¡ï¼Œå¯¹æ–¹æœ€åå›å¤ä¸€æ¬¡ã€‚
```

**ğŸ“ Protoå®šä¹‰**
```protobuf
service FileService {
    // æ³¨æ„ï¼šå‚æ•°å‰é¢æœ‰streamå…³é”®å­—
    rpc UploadFile(stream FileChunk) returns (UploadResponse);
}

message FileChunk {
    bytes data = 1;      // æ–‡ä»¶æ•°æ®å—
    int32 chunk_id = 2;  // å—ç¼–å·
}

message UploadResponse {
    bool success = 1;    // æ˜¯å¦æˆåŠŸ
    string file_id = 2;  // æ–‡ä»¶ID
    int64 total_size = 3; // æ€»å¤§å°
}
```

**ğŸ”§ ä½¿ç”¨åœºæ™¯**
```
âœ… æ–‡ä»¶ä¸Šä¼ ï¼ˆå¤§æ–‡ä»¶åˆ†å—ï¼‰
âœ… æ‰¹é‡æ•°æ®å¯¼å…¥
âœ… å®æ—¶æ•°æ®é‡‡é›†
âœ… è¯­éŸ³è¯†åˆ«ï¼ˆè¯­éŸ³æµè½¬æ–‡å­—ï¼‰
âœ… è§†é¢‘æµä¸Šä¼ 
```

**ğŸ“Š é€šä¿¡æµç¨‹å›¾**
```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
   |                        |
   |----ç¬¬1å—æ–‡ä»¶æ•°æ®------>|
   |----ç¬¬2å—æ–‡ä»¶æ•°æ®------>|æ¥æ”¶å¹¶ç¼“å­˜
   |----ç¬¬3å—æ–‡ä»¶æ•°æ®------>|
   |----...æ›´å¤šæ•°æ®------->|
   |----ç»“æŸä¿¡å·--------->|å¤„ç†å®Œæ•´æ–‡ä»¶
   |                        |
   |<---ä¸Šä¼ ç»“æœ(æˆåŠŸ/å¤±è´¥)--|
   |                        |
  å®Œæˆ                     å®Œæˆ
```

### 2.4 Bidirectional Streamingï¼šåŒå‘æµ


**ğŸ¯ ä»€ä¹ˆæ˜¯åŒå‘æµ**
```
å°±åƒä¸¤ä¸ªäººæ‰“ç”µè¯èŠå¤©ï¼š
ä½ ï¼š"ä½ å¥½"ï¼Œå¯¹æ–¹ï¼š"ä½ å¥½"
ä½ ï¼š"æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ"ï¼Œå¯¹æ–¹ï¼š"è¿˜ä¸é”™ï¼Œä½ å‘¢ï¼Ÿ"
ä½ ï¼š"æˆ‘ä¹ŸæŒºå¥½"ï¼Œå¯¹æ–¹ï¼š"é‚£å°±å¥½"
åŒæ–¹å¯ä»¥éšæ—¶è¯´è¯ï¼Œéšæ—¶å›åº”ã€‚
```

**ğŸ“ Protoå®šä¹‰**
```protobuf
service ChatService {
    // æ³¨æ„ï¼šå‚æ•°å’Œè¿”å›å€¼éƒ½æœ‰streamå…³é”®å­—
    rpc Chat(stream ChatMessage) returns (stream ChatMessage);
}

message ChatMessage {
    string user_id = 1;   // ç”¨æˆ·ID
    string content = 2;   // æ¶ˆæ¯å†…å®¹
    int64 timestamp = 3;  // å‘é€æ—¶é—´
}
```

**ğŸ”§ ä½¿ç”¨åœºæ™¯**
```
âœ… åœ¨çº¿èŠå¤©å®¤
âœ… å®æ—¶æ¸¸æˆå¯¹æˆ˜
âœ… è§†é¢‘é€šè¯
âœ… ååŒç¼–è¾‘æ–‡æ¡£
âœ… å®æ—¶æ•°æ®åŒæ­¥
```

**ğŸ“Š é€šä¿¡æµç¨‹å›¾**
```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
   |                        |
   |----æ¶ˆæ¯1------------->|
   |<---æ¶ˆæ¯A---------------|
   |----æ¶ˆæ¯2------------->|
   |----æ¶ˆæ¯3------------->|
   |<---æ¶ˆæ¯B---------------|
   |<---æ¶ˆæ¯C---------------|
   |----...-------------->|
   |<---...---------------|
  æŒç»­è¿æ¥                æŒç»­è¿æ¥
```

---

## 3. ğŸ¯ é€šä¿¡æ–¹å¼é€‰æ‹©æŒ‡å—


### 3.1 é€‰æ‹©å†³ç­–æ ‘


```
å¼€å§‹é€‰æ‹©é€šä¿¡æ–¹å¼
         |
    éœ€è¦å®æ—¶æ¨é€ï¼Ÿ
    /           \
   æ˜¯             å¦
   |              |
éœ€è¦åŒå‘é€šä¿¡ï¼Ÿ   æ•°æ®é‡å¤§ï¼Ÿ
  /      \       /      \
 æ˜¯       å¦     æ˜¯       å¦
 |        |      |        |
åŒå‘æµ   æœåŠ¡ç«¯æµ  å®¢æˆ·ç«¯æµ  Unary
```

### 3.2 è¯¦ç»†å¯¹æ¯”è¡¨æ ¼


| ğŸ”„ é€šä¿¡æ–¹å¼ | **æœ€ä½³åœºæ™¯** | **æ•°æ®æµå‘** | **è¿æ¥ç‰¹ç‚¹** | **å¤æ‚åº¦** |
|------------|-------------|-------------|-------------|------------|
| ğŸ”¸ **Unary** | `æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯` `ç™»å½•éªŒè¯` | `1â†’1` | `çŸ­è¿æ¥` | `â­` |
| ğŸ“¡ **Server Streaming** | `è‚¡ç¥¨æ¨é€` `æ—¥å¿—è¾“å‡º` | `1â†’N` | `é•¿è¿æ¥` | `â­â­` |
| ğŸ“¤ **Client Streaming** | `æ–‡ä»¶ä¸Šä¼ ` `æ•°æ®å¯¼å…¥` | `Nâ†’1` | `é•¿è¿æ¥` | `â­â­â­` |
| ğŸ”„ **Bidirectional** | `èŠå¤©å®¤` `æ¸¸æˆå¯¹æˆ˜` | `Nâ†’N` | `é•¿è¿æ¥` | `â­â­â­â­` |

### 3.3 æ€§èƒ½ç‰¹ç‚¹å¯¹æ¯”


**ğŸ“Š èµ„æºæ¶ˆè€—å¯¹æ¯”**
```
å†…å­˜ä½¿ç”¨: Unary < Server Streaming â‰ˆ Client Streaming < Bidirectional
è¿æ¥æ•°é‡: Unary(å¤šä¸ªçŸ­è¿æ¥) > Streaming(å°‘é‡é•¿è¿æ¥)
ç½‘ç»œå»¶è¿Ÿ: Unary(å»ºè¿å¼€é”€) > Streaming(å¤ç”¨è¿æ¥)
```

**âš¡ å“åº”é€Ÿåº¦**
```
ç«‹å³å“åº”: Unary âœ…âœ…âœ…
å®æ—¶æ¨é€: Server Streaming âœ…âœ…âœ…
æ‰¹é‡å¤„ç†: Client Streaming âœ…âœ…
äº¤äº’æ€§: Bidirectional âœ…âœ…âœ…
```

---

## 4. ğŸ“‹ æ¶ˆæ¯è®¾è®¡åŸåˆ™


### 4.1 è¯·æ±‚å“åº”åˆ†ç¦»åŸåˆ™


**ğŸ¯ ä¸ºä»€ä¹ˆè¦åˆ†ç¦»**
```
å°±åƒé¤å…ç‚¹èœï¼š
âŒ ä¸å¥½çš„åšæ³•ï¼šç”¨åŒä¸€å¼ çº¸æ—¢å†™èœå•åˆå†™è´¦å•
âœ… å¥½çš„åšæ³•ï¼šç‚¹èœå•ç‹¬ç«‹ï¼Œè´¦å•ç‹¬ç«‹

è¿™æ ·åšçš„å¥½å¤„ï¼š
- å„è‡ªå¯ä»¥ç‹¬ç«‹ä¿®æ”¹
- é€»è¾‘æ›´æ¸…æ™°
- ä¾¿äºç†è§£å’Œç»´æŠ¤
```

**ğŸ’¡ å…·ä½“å®ç°**
```protobuf
// âœ… å¥½çš„è®¾è®¡ï¼šè¯·æ±‚å’Œå“åº”åˆ†å¼€å®šä¹‰
message GetUserRequest {
    int64 user_id = 1;
}

message GetUserResponse {
    int64 user_id = 1;
    string name = 2;
    string email = 3;
    bool is_active = 4;
}

// âŒ ä¸å¥½çš„è®¾è®¡ï¼šæ··ç”¨åŒä¸€ä¸ªæ¶ˆæ¯
message UserInfo {
    int64 user_id = 1;    // è¯·æ±‚æ—¶åªéœ€è¦è¿™ä¸ª
    string name = 2;      // å“åº”æ—¶æ‰æœ‰è¿™ä¸ª
    string email = 3;     // å“åº”æ—¶æ‰æœ‰è¿™ä¸ª
    bool is_active = 4;   // å“åº”æ—¶æ‰æœ‰è¿™ä¸ª
}
```

### 4.2 å‘åå…¼å®¹åŸåˆ™


**ğŸ¯ ä»€ä¹ˆæ˜¯å‘åå…¼å®¹**
```
å‘åå…¼å®¹å°±åƒæ‰‹æœºç³»ç»Ÿå‡çº§ï¼š
- æ—§ç‰ˆæœ¬APPåœ¨æ–°ç³»ç»Ÿä¸Šä»èƒ½è¿è¡Œ
- æ–°ç‰ˆæœ¬åŠŸèƒ½ä¸ä¼šç ´åæ—§åŠŸèƒ½
- è€ç”¨æˆ·ä¸ç”¨å¼ºåˆ¶å‡çº§å°±èƒ½ç»§ç»­ä½¿ç”¨
```

**âœ… å…¼å®¹æ€§æœ€ä½³å®è·µ**
```protobuf
// ç‰ˆæœ¬1ï¼šæœ€åˆçš„ç”¨æˆ·ä¿¡æ¯
message UserInfo {
    int64 user_id = 1;
    string name = 2;
}

// ç‰ˆæœ¬2ï¼šå¢åŠ æ–°å­—æ®µï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
message UserInfo {
    int64 user_id = 1;
    string name = 2;
    string email = 3;        // æ–°å¢å­—æ®µï¼Œæ—§å®¢æˆ·ç«¯ä¼šå¿½ç•¥
    bool is_premium = 4;     // æ–°å¢å­—æ®µï¼Œæ—§å®¢æˆ·ç«¯ä¼šå¿½ç•¥
}

// âŒ é”™è¯¯åšæ³•ï¼šä¿®æ”¹å·²æœ‰å­—æ®µ
message UserInfo {
    string user_id = 1;      // æŠŠint64æ”¹æˆstringï¼Œç ´åå…¼å®¹æ€§ï¼
    string full_name = 2;    // æ”¹å˜å­—æ®µå«ä¹‰ï¼Œç ´åå…¼å®¹æ€§ï¼
}
```

**ğŸ”§ å…¼å®¹æ€§è§„åˆ™**
```
âœ… å¯ä»¥åšçš„ï¼š
- æ·»åŠ æ–°çš„å­—æ®µ
- æ ‡è®°å­—æ®µä¸ºdeprecatedï¼ˆä¸æ¨èä½¿ç”¨ï¼‰
- æ·»åŠ æ–°çš„serviceæˆ–rpcæ–¹æ³•

âŒ ä¸èƒ½åšçš„ï¼š
- åˆ é™¤å·²æœ‰å­—æ®µ
- ä¿®æ”¹å­—æ®µç±»å‹
- ä¿®æ”¹å­—æ®µç¼–å·
- é‡å‘½åå­—æ®µï¼ˆé™¤éåŒæ—¶ä¿ç•™æ—§å­—æ®µï¼‰
```

### 4.3 å­—æ®µå‘½åè§„èŒƒ


**ğŸ¯ æ¸…æ™°å‘½ååŸåˆ™**
```protobuf
// âœ… å¥½çš„å‘½åï¼šä¸€çœ‹å°±æ‡‚
message CreateOrderRequest {
    int64 user_id = 1;           // ç”¨æˆ·ID
    repeated OrderItem items = 2; // è®¢å•é¡¹åˆ—è¡¨
    string delivery_address = 3;  // é…é€åœ°å€
    PaymentMethod payment = 4;    // æ”¯ä»˜æ–¹å¼
}

// âŒ ä¸å¥½çš„å‘½åï¼šå«ç³Šä¸æ¸…
message CreateOrderRequest {
    int64 id = 1;        // ä»€ä¹ˆIDï¼Ÿ
    repeated Item list = 2;  // ä»€ä¹ˆåˆ—è¡¨ï¼Ÿ
    string addr = 3;     // ç¼©å†™ä¸æ¸…æ¥š
    int32 method = 4;    // ä»€ä¹ˆæ–¹æ³•ï¼Ÿ
}
```

---

## 5. ğŸ’» å®è·µç¼–ç åœºæ™¯


### 5.1 åœºæ™¯ä¸€ï¼šåœ¨çº¿å•†åŸç³»ç»Ÿ


**ğŸ›ï¸ ä¸šåŠ¡éœ€æ±‚**
```
å»ºè®¾ä¸€ä¸ªåœ¨çº¿å•†åŸï¼Œéœ€è¦ä»¥ä¸‹åŠŸèƒ½ï¼š
1. ç”¨æˆ·æŸ¥çœ‹å•†å“è¯¦æƒ…ï¼ˆä¸€æ¬¡æŸ¥è¯¢ï¼‰
2. å®æ—¶æ¨é€ä¿ƒé”€ä¿¡æ¯ï¼ˆæœåŠ¡ç«¯æ¨é€ï¼‰
3. æ‰¹é‡ä¸Šä¼ å•†å“å›¾ç‰‡ï¼ˆå®¢æˆ·ç«¯ä¸Šä¼ ï¼‰
4. å®¢æœåœ¨çº¿èŠå¤©ï¼ˆåŒå‘é€šä¿¡ï¼‰
```

**ğŸ“ å®Œæ•´Protoå®šä¹‰**
```protobuf
syntax = "proto3";

package mall;

// å•†åŸæœåŠ¡å®šä¹‰
service MallService {
    // 1. æŸ¥çœ‹å•†å“è¯¦æƒ… - Unary RPC
    rpc GetProduct(GetProductRequest) returns (GetProductResponse);
    
    // 2. å®æ—¶ä¿ƒé”€æ¨é€ - Server Streaming
    rpc GetPromotions(PromotionRequest) returns (stream PromotionResponse);
    
    // 3. æ‰¹é‡ä¸Šä¼ å›¾ç‰‡ - Client Streaming
    rpc UploadImages(stream ImageChunk) returns (UploadResponse);
    
    // 4. å®¢æœèŠå¤© - Bidirectional Streaming
    rpc CustomerChat(stream ChatMessage) returns (stream ChatMessage);
}

// å•†å“æŸ¥è¯¢ç›¸å…³
message GetProductRequest {
    int64 product_id = 1;
}

message GetProductResponse {
    int64 product_id = 1;
    string name = 2;
    double price = 3;
    string description = 4;
    bool in_stock = 5;
}

// ä¿ƒé”€æ¨é€ç›¸å…³
message PromotionRequest {
    int64 user_id = 1;
    string category = 2;  // æ„Ÿå…´è¶£çš„å•†å“ç±»åˆ«
}

message PromotionResponse {
    string title = 1;
    string content = 2;
    double discount = 3;
    int64 expire_time = 4;
}

// å›¾ç‰‡ä¸Šä¼ ç›¸å…³
message ImageChunk {
    bytes data = 1;
    string filename = 2;
    int32 chunk_index = 3;
    bool is_last = 4;
}

message UploadResponse {
    bool success = 1;
    repeated string image_urls = 2;
    string error_message = 3;
}

// èŠå¤©ç›¸å…³
message ChatMessage {
    string from_user = 1;
    string to_user = 2;
    string content = 3;
    int64 timestamp = 4;
    MessageType type = 5;
}

enum MessageType {
    TEXT = 0;
    IMAGE = 1;
    FILE = 2;
}
```

### 5.2 åœºæ™¯äºŒï¼šç‰©è”ç½‘ç›‘æ§ç³»ç»Ÿ


**ğŸŒ¡ï¸ ä¸šåŠ¡éœ€æ±‚**
```
å»ºè®¾ä¸€ä¸ªç‰©è”ç½‘æ¸©åº¦ç›‘æ§ç³»ç»Ÿï¼š
1. æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯ï¼ˆåŸºæœ¬æŸ¥è¯¢ï¼‰
2. å®æ—¶æ¸©åº¦æ•°æ®æ¨é€ï¼ˆç›‘æ§å‘Šè­¦ï¼‰
3. æ‰¹é‡ä¸ŠæŠ¥ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆè®¾å¤‡ä¸ŠæŠ¥ï¼‰
4. è¿œç¨‹è®¾å¤‡æ§åˆ¶ï¼ˆåŒå‘æ§åˆ¶ï¼‰
```

**ğŸ“ Protoå®šä¹‰ç¤ºä¾‹**
```protobuf
service IoTService {
    // è®¾å¤‡ä¿¡æ¯æŸ¥è¯¢
    rpc GetDeviceInfo(DeviceRequest) returns (DeviceResponse);
    
    // å®æ—¶æ¸©åº¦ç›‘æ§
    rpc MonitorTemperature(MonitorRequest) returns (stream TemperatureData);
    
    // æ‰¹é‡æ•°æ®ä¸ŠæŠ¥
    rpc ReportSensorData(stream SensorData) returns (ReportResponse);
    
    // è®¾å¤‡è¿œç¨‹æ§åˆ¶
    rpc RemoteControl(stream ControlCommand) returns (stream ControlStatus);
}
```

### 5.3 å„åœºæ™¯çš„ç¼–ç è¦ç‚¹


**ğŸ”§ Unary RPCç¼–ç è¦ç‚¹**
```protobuf
// ç®€å•ç›´æ¥ï¼Œé‡ç‚¹å…³æ³¨è¯·æ±‚å“åº”çš„æ•°æ®å®Œæ•´æ€§
rpc GetUser(GetUserRequest) returns (GetUserResponse);

// è¦ç‚¹ï¼š
// 1. è¯·æ±‚å‚æ•°è¦è¶³å¤Ÿæ˜ç¡®
// 2. å“åº”æ•°æ®è¦å®Œæ•´
// 3. é”™è¯¯å¤„ç†è¦è€ƒè™‘å‘¨å…¨
```

**ğŸ“¡ Server Streamingç¼–ç è¦ç‚¹**
```protobuf
// æ³¨æ„streamå…³é”®å­—ä½ç½®
rpc WatchStock(StockRequest) returns (stream StockPrice);

// è¦ç‚¹ï¼š
// 1. æœåŠ¡ç«¯è¦æ§åˆ¶æ¨é€é¢‘ç‡
// 2. å®¢æˆ·ç«¯è¦å¤„ç†è¿æ¥æ–­å¼€
// 3. è€ƒè™‘æ•°æ®é‡è¿‡å¤§çš„æƒ…å†µ
```

**ğŸ“¤ Client Streamingç¼–ç è¦ç‚¹**
```protobuf
// streamåœ¨å‚æ•°ä½ç½®
rpc UploadFile(stream FileChunk) returns (UploadResult);

// è¦ç‚¹ï¼š
// 1. åˆ†å—å¤§å°è¦åˆç†
// 2. è¦æœ‰åˆ†å—é¡ºåºæ ‡è¯†
// 3. æœ€åè¦æœ‰ç»“æŸæ ‡å¿—
```

**ğŸ”„ Bidirectionalç¼–ç è¦ç‚¹**
```protobuf
// å‚æ•°å’Œè¿”å›éƒ½æœ‰stream
rpc Chat(stream ChatMessage) returns (stream ChatMessage);

// è¦ç‚¹ï¼š
// 1. æ¶ˆæ¯è·¯ç”±è¦æ¸…æ™°
// 2. è¿æ¥ç®¡ç†è¦å¯é 
// 3. å¹¶å‘å¤„ç†è¦å®‰å…¨
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æœåŠ¡å®šä¹‰ï¼šserviceå…³é”®å­—å®šä¹‰æœåŠ¡è¾¹ç•Œ
ğŸ”¸ æ–¹æ³•å®šä¹‰ï¼šrpcå…³é”®å­—å®šä¹‰å…·ä½“åŠŸèƒ½
ğŸ”¸ å››ç§é€šä¿¡æ–¹å¼ï¼šæ ¹æ®æ•°æ®æµå‘å’Œäº¤äº’æ¨¡å¼é€‰æ‹©
ğŸ”¸ streamå…³é”®å­—ï¼šå†³å®šæ˜¯å¦ä¸ºæµå¼é€šä¿¡
ğŸ”¸ æ¶ˆæ¯è®¾è®¡ï¼šè¯·æ±‚å“åº”åˆ†ç¦»ï¼Œä¿æŒå‘åå…¼å®¹
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å››ç§é€šä¿¡æ–¹å¼çš„æœ¬è´¨åŒºåˆ«**
```
åŒºåˆ«ä¸åœ¨äºæŠ€æœ¯å¤æ‚åº¦ï¼Œè€Œåœ¨äºä¸šåŠ¡åœºæ™¯ï¼š

Unaryï¼š     é—®ç­”å¼ï¼Œé€‚åˆæŸ¥è¯¢ç±»ä¸šåŠ¡
Serveræµï¼š   å¹¿æ’­å¼ï¼Œé€‚åˆæ¨é€ç±»ä¸šåŠ¡  
Clientæµï¼š   æ±‡æŠ¥å¼ï¼Œé€‚åˆä¸Šä¼ ç±»ä¸šåŠ¡
åŒå‘æµï¼š     å¯¹è¯å¼ï¼Œé€‚åˆäº¤äº’ç±»ä¸šåŠ¡
```

**ğŸ”¹ streamå…³é”®å­—çš„ä½¿ç”¨è§„å¾‹**
```
è®°å¿†æ–¹æ³•ï¼š
- ä¸å†™stream = æ™®é€šçš„ä¸€é—®ä¸€ç­”
- åœ¨returnså‰å†™stream = æœåŠ¡ç«¯è¿ç»­å‘é€
- åœ¨å‚æ•°å‰å†™stream = å®¢æˆ·ç«¯è¿ç»­å‘é€
- ä¸¤è¾¹éƒ½å†™stream = åŒæ–¹éƒ½è¿ç»­å‘é€
```

**ğŸ”¹ æ¶ˆæ¯è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³**
```
è®¾è®¡åŸåˆ™ï¼š
- èŒè´£å•ä¸€ï¼šä¸€ä¸ªæ¶ˆæ¯åªåšä¸€ä»¶äº‹
- æ¸…æ™°å‘½åï¼šè®©äººä¸€çœ‹å°±æ‡‚
- å‘åå…¼å®¹ï¼šæ–°ç‰ˆæœ¬ä¸ç ´åè€ç‰ˆæœ¬
- æ‰©å±•å‹å¥½ï¼šé¢„ç•™æœªæ¥æ‰©å±•çš„å¯èƒ½
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é€‰æ‹©é€šä¿¡æ–¹å¼çš„å†³ç­–æµç¨‹**
```
æ­¥éª¤ 1ï¸âƒ£ï¼šæ˜ç¡®ä¸šåŠ¡éœ€æ±‚
- æ˜¯æŸ¥è¯¢æ•°æ®ï¼Ÿé€‰æ‹©Unary
- æ˜¯æ¨é€æ•°æ®ï¼Ÿé€‰æ‹©Server Streaming
- æ˜¯ä¸Šä¼ æ•°æ®ï¼Ÿé€‰æ‹©Client Streaming  
- æ˜¯å®æ—¶äº¤äº’ï¼Ÿé€‰æ‹©Bidirectional

æ­¥éª¤ 2ï¸âƒ£ï¼šè€ƒè™‘æŠ€æœ¯çº¦æŸ
- ç½‘ç»œç¨³å®šæ€§ã€æ•°æ®é‡å¤§å°ã€å®æ—¶æ€§è¦æ±‚

æ­¥éª¤ 3ï¸âƒ£ï¼šè¯„ä¼°ç»´æŠ¤æˆæœ¬
- å¤æ‚åº¦ã€å¼€å‘éš¾åº¦ã€è°ƒè¯•éš¾åº¦
```

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
å¼€å‘å»ºè®®ï¼š
âœ… ä»Unaryå¼€å§‹ï¼š90%çš„ä¸šåŠ¡ç”¨Unaryå°±å¤Ÿäº†
âœ… æŒ‰éœ€å‡çº§ï¼šç¡®å®éœ€è¦æ—¶å†ç”¨æµå¼é€šä¿¡
âœ… ä¿æŒç®€å•ï¼šä¸è¦ä¸ºäº†æŠ€æœ¯è€ŒæŠ€æœ¯
âœ… å……åˆ†æµ‹è¯•ï¼šæµå¼é€šä¿¡çš„è¾¹ç•Œæƒ…å†µæ›´å¤š

è®¾è®¡å»ºè®®ï¼š
âœ… ç»Ÿä¸€å‘½åï¼šåˆ¶å®šå›¢é˜Ÿçš„å‘½åè§„èŒƒ
âœ… æ–‡æ¡£å®Œå–„ï¼šæ¯ä¸ªserviceå’Œrpcéƒ½è¦æœ‰è¯´æ˜
âœ… ç‰ˆæœ¬ç®¡ç†ï¼šå»ºç«‹ç‰ˆæœ¬å‡çº§ç­–ç•¥
âœ… é”™è¯¯å¤„ç†ï¼šå®šä¹‰æ¸…æ™°çš„é”™è¯¯ç ä½“ç³»
```

### 6.4 é¿å…å¸¸è§è¯¯åŒº


```
âŒ è¯¯åŒº1ï¼šè®¤ä¸ºæµå¼é€šä¿¡æ¯”Unaryæ›´é«˜çº§
æ­£ç¡®ç†è§£ï¼šé€‰æ‹©åˆé€‚çš„å°±æ˜¯æœ€å¥½çš„

âŒ è¯¯åŒº2ï¼šæ‰€æœ‰åœºæ™¯éƒ½ç”¨åŒå‘æµ
æ­£ç¡®ç†è§£ï¼šå¤æ‚åº¦é«˜ï¼Œåªåœ¨çœŸéœ€è¦æ—¶ä½¿ç”¨

âŒ è¯¯åŒº3ï¼šå¿½ç•¥å‘åå…¼å®¹æ€§
æ­£ç¡®ç†è§£ï¼šå…¼å®¹æ€§æ˜¯é•¿æœŸç»´æŠ¤çš„å…³é”®

âŒ è¯¯åŒº4ï¼šæ¶ˆæ¯è®¾è®¡è¿‡äºå¤æ‚
æ­£ç¡®ç†è§£ï¼šç®€å•æ¸…æ™°æ¯”åŠŸèƒ½å…¨é¢æ›´é‡è¦
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- *"ä¸€é—®ä¸€ç­”ç”¨Unaryï¼Œå•å‘æ¨é€Serveræµ"*
- *"å®¢æˆ·ä¸Šä¼ Clientæµï¼ŒåŒå‘äº¤äº’åŒå‘æµ"*
- *"æ¶ˆæ¯åˆ†ç¦»èŒè´£æ¸…ï¼Œå‘åå…¼å®¹ä¿å¹³ç¨³"*
- *"streamå…³é”®å­—ï¼Œå†³å®šæ•°æ®æµå‘è·¯"*