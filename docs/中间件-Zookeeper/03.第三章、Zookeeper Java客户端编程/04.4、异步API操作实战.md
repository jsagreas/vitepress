---
title: 4ã€å¼‚æ­¥APIæ“ä½œå®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å¼‚æ­¥APIæ ¸å¿ƒæ¦‚å¿µ](#1-å¼‚æ­¥APIæ ¸å¿ƒæ¦‚å¿µ)
2. [AsyncCallbackå›è°ƒæ¥å£ä½“ç³»](#2-AsyncCallbackå›è°ƒæ¥å£ä½“ç³»)
3. [VoidCallbackæ— è¿”å›å€¼å›è°ƒ](#3-VoidCallbackæ— è¿”å›å€¼å›è°ƒ)
4. [DataCallbackæ•°æ®è¯»å–å›è°ƒ](#4-DataCallbackæ•°æ®è¯»å–å›è°ƒ)
5. [ChildrenCallbackå­èŠ‚ç‚¹å›è°ƒ](#5-ChildrenCallbackå­èŠ‚ç‚¹å›è°ƒ)
6. [StatCallbackçŠ¶æ€æŸ¥è¯¢å›è°ƒ](#6-StatCallbackçŠ¶æ€æŸ¥è¯¢å›è°ƒ)
7. [å¼‚æ­¥æ“ä½œæœ€ä½³å®è·µ](#7-å¼‚æ­¥æ“ä½œæœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å¼‚æ­¥APIæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥API


**ğŸ”¸ å¼‚æ­¥æ“ä½œçš„æœ¬è´¨**
```
åŒæ­¥æ“ä½œï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚ â†’ ç­‰å¾…å“åº” â†’ å¤„ç†ç»“æœ
         ï¼ˆçº¿ç¨‹è¢«é˜»å¡ï¼Œæ— æ³•åšå…¶ä»–äº‹æƒ…ï¼‰

å¼‚æ­¥æ“ä½œï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚ â†’ ç«‹å³è¿”å› â†’ ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡
         ï¼ˆå½“æœåŠ¡å™¨å“åº”æ—¶ï¼Œé€šè¿‡å›è°ƒå‡½æ•°å¤„ç†ç»“æœï¼‰
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥API**

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œé€šä¿¡æ˜¯ä¸å¯é¿å…çš„ï¼Œè€Œç½‘ç»œå»¶è¿Ÿæ˜¯å®¢æˆ·ç«¯æ€§èƒ½çš„ä¸»è¦ç“¶é¢ˆï¼š

```
ç½‘ç»œåœºæ™¯åˆ†æï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç½‘ç»œå»¶è¿Ÿ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â†â†’ 50-200ms â†â†’ â”‚ Zookeeper   â”‚
â”‚             â”‚                â”‚   é›†ç¾¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŒæ­¥æ–¹å¼é—®é¢˜ï¼š
- æ¯æ¬¡æ“ä½œéƒ½è¦ç­‰å¾…ç½‘ç»œå¾€è¿”
- çº¿ç¨‹è¢«é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–ä»»åŠ¡
- ååé‡ä½ï¼Œèµ„æºåˆ©ç”¨ç‡å·®

å¼‚æ­¥æ–¹å¼ä¼˜åŠ¿ï¼š
- å‘é€è¯·æ±‚åç«‹å³è¿”å›ï¼Œçº¿ç¨‹ä¸é˜»å¡
- å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚
- æå‡æ•´ä½“ååé‡å’Œå“åº”é€Ÿåº¦
```

### 1.2 Zookeeperå¼‚æ­¥æ¨¡å‹åŸç†


**ğŸ”§ å¼‚æ­¥è°ƒç”¨æµç¨‹**
```
å®¢æˆ·ç«¯å¼‚æ­¥è°ƒç”¨æµç¨‹ï¼š

1. å‘èµ·å¼‚æ­¥è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨çº¿ç¨‹    â”‚ â”€â”€â‘  è°ƒç”¨å¼‚æ­¥æ–¹æ³•
â”‚             â”‚    (ä¼ å…¥å›è°ƒå¯¹è±¡)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â‘¡ è¯·æ±‚åŠ å…¥å‘é€é˜Ÿåˆ—
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç½‘ç»œIOçº¿ç¨‹  â”‚ â”€â”€â‘¢ å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
â”‚             â”‚    â‘£ æ¥æ”¶æœåŠ¡å™¨å“åº”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â‘¤ æ‰§è¡Œå›è°ƒæ–¹æ³•
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›è°ƒå¤„ç†    â”‚ â”€â”€â‘¥ å¤„ç†å“åº”ç»“æœ
â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ å…³é”®ç†è§£è¦ç‚¹**
- **éé˜»å¡**ï¼šè°ƒç”¨å¼‚æ­¥æ–¹æ³•åç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…ç»“æœ
- **å›è°ƒæœºåˆ¶**ï¼šé€šè¿‡å›è°ƒæ¥å£å¤„ç†å¼‚æ­¥ç»“æœ
- **çº¿ç¨‹åˆ†ç¦»**ï¼šIOæ“ä½œå’Œä¸šåŠ¡é€»è¾‘åœ¨ä¸åŒçº¿ç¨‹æ‰§è¡Œ
- **çŠ¶æ€è·Ÿè¸ª**ï¼šæ¯ä¸ªå¼‚æ­¥æ“ä½œéƒ½æœ‰å”¯ä¸€çš„ä¸Šä¸‹æ–‡æ ‡è¯†

---

## 2. ğŸ”„ AsyncCallbackå›è°ƒæ¥å£ä½“ç³»


### 2.1 AsyncCallbackæ¥å£æ—æ¦‚è§ˆ


**ğŸ“‹ å›è°ƒæ¥å£ä½“ç³»ç»“æ„**
```
AsyncCallback (æ ¹æ¥å£)
â”œâ”€â”€ VoidCallback              â† æ— è¿”å›å€¼æ“ä½œ (create, delete, setDataç­‰)
â”œâ”€â”€ DataCallback              â† æ•°æ®è¯»å–æ“ä½œ (getData)
â”œâ”€â”€ ChildrenCallback          â† å­èŠ‚ç‚¹æ“ä½œ (getChildren)
â”œâ”€â”€ StatCallback              â† çŠ¶æ€æŸ¥è¯¢æ“ä½œ (exists, sync)
â”œâ”€â”€ ACLCallback               â† ACLæƒé™æ“ä½œ (getACL, setACL)
â”œâ”€â”€ Children2Callback         â† å¸¦çŠ¶æ€çš„å­èŠ‚ç‚¹æ“ä½œ
â””â”€â”€ MultiCallback             â† æ‰¹é‡æ“ä½œå›è°ƒ
```

### 2.2 å›è°ƒæ¥å£çš„é€šç”¨æ¨¡å¼


æ‰€æœ‰å¼‚æ­¥å›è°ƒæ¥å£éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š

```java
// é€šç”¨å›è°ƒæ¥å£æ¨¡å¼
public interface SomeCallback extends AsyncCallback {
    /**
     * å¼‚æ­¥æ“ä½œå®Œæˆæ—¶è¢«è°ƒç”¨
     * @param rc è¿”å›ç  (0è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–è¡¨ç¤ºé”™è¯¯)
     * @param path æ“ä½œçš„èŠ‚ç‚¹è·¯å¾„
     * @param ctx ç”¨æˆ·ä¼ å…¥çš„ä¸Šä¸‹æ–‡å¯¹è±¡
     * @param å…¶ä»–å‚æ•°... æ ¹æ®å…·ä½“æ“ä½œç±»å‹è€Œå®š
     */
    void processResult(int rc, String path, Object ctx, /* å…¶ä»–å‚æ•° */);
}
```

**ğŸ”¸ å‚æ•°å«ä¹‰è§£é‡Š**
- **`rc (Return Code)`**ï¼šæ“ä½œç»“æœä»£ç ï¼Œ0è¡¨ç¤ºæˆåŠŸï¼Œé0è¡¨ç¤ºå„ç§é”™è¯¯
- **`path`**ï¼šæ“ä½œçš„ZNodeè·¯å¾„
- **`ctx (Context)`**ï¼šè°ƒç”¨æ—¶ä¼ å…¥çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œç”¨äºåœ¨å›è°ƒä¸­è¯†åˆ«è¯·æ±‚
- **å…¶ä»–å‚æ•°**ï¼šæ ¹æ®ä¸åŒå›è°ƒç±»å‹åŒ…å«ä¸åŒçš„è¿”å›æ•°æ®

### 2.3 è¿”å›ç (Return Code)è¯¦è§£


**ğŸ“Š å¸¸è§è¿”å›ç å¯¹ç…§è¡¨**

| è¿”å›ç  | **å¸¸é‡å** | **å«ä¹‰** | **è¯´æ˜** |
|--------|-----------|----------|----------|
| `0` | `Code.OK` | `æˆåŠŸ` | `æ“ä½œæ­£å¸¸å®Œæˆ` |
| `-4` | `Code.CONNECTIONLOSS` | `è¿æ¥ä¸¢å¤±` | `å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥ä¸­æ–­` |
| `-101` | `Code.NODEEXISTS` | `èŠ‚ç‚¹å·²å­˜åœ¨` | `åˆ›å»ºèŠ‚ç‚¹æ—¶ç›®æ ‡å·²å­˜åœ¨` |
| `-102` | `Code.NONODE` | `èŠ‚ç‚¹ä¸å­˜åœ¨` | `æ“ä½œçš„èŠ‚ç‚¹ä¸å­˜åœ¨` |
| `-103` | `Code.NOTEMPTY` | `èŠ‚ç‚¹éç©º` | `åˆ é™¤éç©ºèŠ‚ç‚¹` |
| `-108` | `Code.NOCHILDRENFOREPHEMERALS` | `ä¸´æ—¶èŠ‚ç‚¹ä¸èƒ½æœ‰å­èŠ‚ç‚¹` | `åœ¨ä¸´æ—¶èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹` |

---

## 3. ğŸš« VoidCallbackæ— è¿”å›å€¼å›è°ƒ


### 3.1 VoidCallbackæ¥å£è¯¦è§£


**VoidCallback**ç”¨äºé‚£äº›**ä¸éœ€è¦è¿”å›æ•°æ®**çš„æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºèŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€è®¾ç½®æ•°æ®ç­‰ã€‚

```java
public interface VoidCallback extends AsyncCallback {
    /**
     * å¤„ç†æ— è¿”å›å€¼æ“ä½œçš„ç»“æœ
     * @param rc è¿”å›ç 
     * @param path æ“ä½œè·¯å¾„
     * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡
     */
    void processResult(int rc, String path, Object ctx);
}
```

### 3.2 å¼‚æ­¥åˆ›å»ºèŠ‚ç‚¹å®æˆ˜


**ğŸ’» å¼‚æ­¥åˆ›å»ºèŠ‚ç‚¹ç¤ºä¾‹**

```java
public class AsyncCreateExample {
    private ZooKeeper zk;
    
    // å¼‚æ­¥åˆ›å»ºèŠ‚ç‚¹
    public void createNodeAsync(String path, String data) {
        byte[] dataBytes = data.getBytes();
        
        // åˆ›å»ºå›è°ƒå®ç°
        VoidCallback createCallback = new VoidCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx) {
                if (rc == Code.OK.intValue()) {
                    System.out.println("âœ… èŠ‚ç‚¹åˆ›å»ºæˆåŠŸ: " + path);
                    System.out.println("ğŸ“ ä¸Šä¸‹æ–‡ä¿¡æ¯: " + ctx);
                } else {
                    System.err.println("âŒ èŠ‚ç‚¹åˆ›å»ºå¤±è´¥: " + 
                        Code.get(rc) + ", è·¯å¾„: " + path);
                }
            }
        };
        
        // å‘èµ·å¼‚æ­¥åˆ›å»ºè¯·æ±‚
        String context = "åˆ›å»ºç”¨æˆ·é…ç½®èŠ‚ç‚¹-" + System.currentTimeMillis();
        zk.create(path, dataBytes, 
                 ZooDefs.Ids.OPEN_ACL_UNSAFE,
                 CreateMode.PERSISTENT,
                 createCallback, 
                 context);  // ä¼ å…¥ä¸Šä¸‹æ–‡
        
        System.out.println("ğŸš€ å¼‚æ­¥åˆ›å»ºè¯·æ±‚å·²å‘é€ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡...");
        // è¿™é‡Œå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œä¸ä¼šè¢«é˜»å¡
    }
}
```

### 3.3 å¼‚æ­¥åˆ é™¤èŠ‚ç‚¹å®æˆ˜


**ğŸ—‘ï¸ å¼‚æ­¥åˆ é™¤çš„å®‰å…¨å¤„ç†**

```java
// å®‰å…¨çš„å¼‚æ­¥åˆ é™¤å®ç°
public void deleteNodeAsync(String path, int expectedVersion) {
    VoidCallback deleteCallback = new VoidCallback() {
        @Override
        public void processResult(int rc, String path, Object ctx) {
            switch (rc) {
                case 0: // Code.OK
                    System.out.println("ğŸ—‘ï¸ èŠ‚ç‚¹åˆ é™¤æˆåŠŸ: " + path);
                    break;
                case -102: // Code.NONODE
                    System.out.println("âš ï¸ èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œå¯èƒ½å·²è¢«åˆ é™¤: " + path);
                    break;
                case -103: // Code.NOTEMPTY
                    System.err.println("âŒ èŠ‚ç‚¹æœ‰å­èŠ‚ç‚¹ï¼Œæ— æ³•åˆ é™¤: " + path);
                    // å¯ä»¥é€‰æ‹©é€’å½’åˆ é™¤æˆ–æç¤ºç”¨æˆ·
                    break;
                case -101: // Code.BADVERSION
                    System.err.println("âŒ ç‰ˆæœ¬ä¸åŒ¹é…ï¼ŒèŠ‚ç‚¹å¯èƒ½è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹");
                    break;
                default:
                    System.err.println("âŒ åˆ é™¤å¤±è´¥: " + Code.get(rc));
            }
        }
    };
    
    // å‘èµ·å¼‚æ­¥åˆ é™¤
    zk.delete(path, expectedVersion, deleteCallback, "åˆ é™¤æ“ä½œ");
}
```

---

## 4. ğŸ“– DataCallbackæ•°æ®è¯»å–å›è°ƒ


### 4.1 DataCallbackæ¥å£è¯¦è§£


**DataCallback**ä¸“é—¨ç”¨äº**è¯»å–èŠ‚ç‚¹æ•°æ®**çš„å¼‚æ­¥æ“ä½œï¼Œå®ƒä¼šè¿”å›èŠ‚ç‚¹çš„æ•°æ®å†…å®¹å’ŒçŠ¶æ€ä¿¡æ¯ã€‚

```java
public interface DataCallback extends AsyncCallback {
    /**
     * å¤„ç†æ•°æ®è¯»å–æ“ä½œçš„ç»“æœ
     * @param rc è¿”å›ç 
     * @param path èŠ‚ç‚¹è·¯å¾„
     * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡
     * @param data èŠ‚ç‚¹æ•°æ®å†…å®¹ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰
     * @param stat èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯
     */
    void processResult(int rc, String path, Object ctx, byte[] data, Stat stat);
}
```

### 4.2 å¼‚æ­¥è¯»å–æ•°æ®å®æˆ˜


**ğŸ“š å®Œæ•´çš„æ•°æ®è¯»å–ç¤ºä¾‹**

```java
public class AsyncDataReader {
    private ZooKeeper zk;
    
    // å¼‚æ­¥è¯»å–èŠ‚ç‚¹æ•°æ®
    public void readDataAsync(String path) {
        DataCallback dataCallback = new DataCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, 
                                    byte[] data, Stat stat) {
                if (rc == Code.OK.intValue()) {
                    // æˆåŠŸè¯»å–æ•°æ®
                    String content = new String(data);
                    System.out.println("ğŸ“– è¯»å–æ•°æ®æˆåŠŸ:");
                    System.out.println("  è·¯å¾„: " + path);
                    System.out.println("  å†…å®¹: " + content);
                    System.out.println("  æ•°æ®ç‰ˆæœ¬: " + stat.getVersion());
                    System.out.println("  åˆ›å»ºæ—¶é—´: " + new Date(stat.getCtime()));
                    System.out.println("  ä¿®æ”¹æ—¶é—´: " + new Date(stat.getMtime()));
                    System.out.println("  æ•°æ®é•¿åº¦: " + stat.getDataLength());
                    
                    // æ ¹æ®ä¸šåŠ¡éœ€è¦å¤„ç†æ•°æ®
                    processBusinessData(content, stat);
                    
                } else if (rc == Code.NONODE.intValue()) {
                    System.out.println("âš ï¸ èŠ‚ç‚¹ä¸å­˜åœ¨: " + path);
                    // å¯èƒ½éœ€è¦åˆ›å»ºèŠ‚ç‚¹æˆ–ç­‰å¾…èŠ‚ç‚¹åˆ›å»º
                    handleNodeNotExists(path);
                    
                } else {
                    System.err.println("âŒ è¯»å–æ•°æ®å¤±è´¥: " + Code.get(rc));
                }
            }
            
            // ä¸šåŠ¡æ•°æ®å¤„ç†
            private void processBusinessData(String content, Stat stat) {
                try {
                    // å‡è®¾å­˜å‚¨çš„æ˜¯JSONé…ç½®
                    System.out.println("ğŸ”§ å¤„ç†é…ç½®æ•°æ®: " + content);
                    // è¿™é‡Œå¯ä»¥è§£æJSONã€æ›´æ–°æœ¬åœ°ç¼“å­˜ç­‰
                } catch (Exception e) {
                    System.err.println("ğŸ’¥ æ•°æ®å¤„ç†å¼‚å¸¸: " + e.getMessage());
                }
            }
            
            // å¤„ç†èŠ‚ç‚¹ä¸å­˜åœ¨çš„æƒ…å†µ
            private void handleNodeNotExists(String path) {
                System.out.println("ğŸ”„ å°†åœ¨3ç§’åé‡è¯•è¯»å–...");
                // å¯ä»¥é€‰æ‹©é‡è¯•ã€åˆ›å»ºé»˜è®¤èŠ‚ç‚¹æˆ–é€šçŸ¥ä¸šåŠ¡å±‚
            }
        };
        
        // å‘èµ·å¼‚æ­¥è¯»å–è¯·æ±‚
        String context = "è¯»å–é…ç½®-" + path;
        zk.getData(path, false, dataCallback, context);
        
        System.out.println("ğŸš€ å¼‚æ­¥è¯»å–è¯·æ±‚å·²å‘é€: " + path);
    }
    
    // å¸¦ç›‘å¬å™¨çš„å¼‚æ­¥è¯»å–
    public void readDataWithWatch(String path) {
        // åˆ›å»ºæ•°æ®å˜åŒ–ç›‘å¬å™¨
        Watcher dataWatcher = new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getType() == Event.EventType.NodeDataChanged) {
                    System.out.println("ğŸ”” æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼Œé‡æ–°è¯»å–: " + path);
                    readDataWithWatch(path); // é€’å½’ç›‘å¬
                }
            }
        };
        
        DataCallback watchCallback = new DataCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, 
                                    byte[] data, Stat stat) {
                if (rc == Code.OK.intValue()) {
                    String content = new String(data);
                    System.out.println("ğŸ‘ï¸ å¸¦ç›‘å¬çš„æ•°æ®è¯»å–æˆåŠŸ:");
                    System.out.println("  å†…å®¹: " + content);
                    System.out.println("  ç‰ˆæœ¬: " + stat.getVersion());
                } else {
                    System.err.println("âŒ å¸¦ç›‘å¬è¯»å–å¤±è´¥: " + Code.get(rc));
                }
            }
        };
        
        // å¼‚æ­¥è¯»å–å¹¶è®¾ç½®ç›‘å¬
        zk.getData(path, dataWatcher, watchCallback, "ç›‘å¬è¯»å–");
    }
}
```

---

## 5. ğŸ‘¶ ChildrenCallbackå­èŠ‚ç‚¹å›è°ƒ


### 5.1 ChildrenCallbackæ¥å£è¯¦è§£


**ChildrenCallback**ç”¨äº**è·å–å­èŠ‚ç‚¹åˆ—è¡¨**çš„å¼‚æ­¥æ“ä½œï¼Œè¿”å›æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åç§°ã€‚

```java
public interface ChildrenCallback extends AsyncCallback {
    /**
     * å¤„ç†è·å–å­èŠ‚ç‚¹æ“ä½œçš„ç»“æœ
     * @param rc è¿”å›ç 
     * @param path çˆ¶èŠ‚ç‚¹è·¯å¾„
     * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡
     * @param children å­èŠ‚ç‚¹åç§°åˆ—è¡¨
     */
    void processResult(int rc, String path, Object ctx, List<String> children);
}
```

### 5.2 å¼‚æ­¥è·å–å­èŠ‚ç‚¹å®æˆ˜


**ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å­èŠ‚ç‚¹ç®¡ç†ç¤ºä¾‹**

```java
public class AsyncChildrenManager {
    private ZooKeeper zk;
    
    // å¼‚æ­¥è·å–æ‰€æœ‰å­èŠ‚ç‚¹
    public void getChildrenAsync(String parentPath) {
        ChildrenCallback childrenCallback = new ChildrenCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, 
                                    List<String> children) {
                if (rc == Code.OK.intValue()) {
                    System.out.println("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ è·å–å­èŠ‚ç‚¹æˆåŠŸ:");
                    System.out.println("  çˆ¶èŠ‚ç‚¹: " + path);
                    System.out.println("  å­èŠ‚ç‚¹æ•°é‡: " + children.size());
                    
                    if (children.isEmpty()) {
                        System.out.println("  ğŸ“­ æ²¡æœ‰å­èŠ‚ç‚¹");
                    } else {
                        System.out.println("  å­èŠ‚ç‚¹åˆ—è¡¨:");
                        for (int i = 0; i < children.size(); i++) {
                            String child = children.get(i);
                            System.out.println("    " + (i+1) + ". " + child);
                            
                            // å¯ä»¥è¿›ä¸€æ­¥å¤„ç†æ¯ä¸ªå­èŠ‚ç‚¹
                            processChildNode(path + "/" + child);
                        }
                    }
                    
                    // ä¸šåŠ¡å¤„ç†
                    handleChildrenList(path, children);
                    
                } else if (rc == Code.NONODE.intValue()) {
                    System.out.println("âš ï¸ çˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨: " + path);
                    
                } else {
                    System.err.println("âŒ è·å–å­èŠ‚ç‚¹å¤±è´¥: " + Code.get(rc));
                }
            }
            
            // å¤„ç†å•ä¸ªå­èŠ‚ç‚¹
            private void processChildNode(String childPath) {
                // å¯ä»¥ç»§ç»­å¼‚æ­¥è¯»å–å­èŠ‚ç‚¹çš„æ•°æ®
                System.out.println("ğŸ” å‘ç°å­èŠ‚ç‚¹: " + childPath);
            }
            
            // ä¸šåŠ¡å±‚å¤„ç†å­èŠ‚ç‚¹åˆ—è¡¨
            private void handleChildrenList(String parent, List<String> children) {
                // ä¾‹å¦‚ï¼šæœåŠ¡å‘ç°åœºæ™¯ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªæœåŠ¡å®ä¾‹
                if (parent.equals("/services/userService")) {
                    System.out.println("ğŸŒ ç”¨æˆ·æœåŠ¡å®ä¾‹åˆ—è¡¨æ›´æ–°ï¼Œå½“å‰å®ä¾‹æ•°: " + children.size());
                    updateServiceInstanceList(children);
                }
            }
            
            private void updateServiceInstanceList(List<String> instances) {
                // æ›´æ–°æœ¬åœ°æœåŠ¡å®ä¾‹ç¼“å­˜
                System.out.println("ğŸ”„ æ›´æ–°æœåŠ¡å®ä¾‹ç¼“å­˜...");
            }
        };
        
        // å‘èµ·å¼‚æ­¥è·å–å­èŠ‚ç‚¹è¯·æ±‚
        String context = "è·å–å­èŠ‚ç‚¹-" + parentPath;
        zk.getChildren(parentPath, false, childrenCallback, context);
        
        System.out.println("ğŸš€ å¼‚æ­¥è·å–å­èŠ‚ç‚¹è¯·æ±‚å·²å‘é€: " + parentPath);
    }
    
    // å¸¦ç›‘å¬çš„å¼‚æ­¥å­èŠ‚ç‚¹è·å–
    public void getChildrenWithWatch(String parentPath) {
        // å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬å™¨
        Watcher childrenWatcher = new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getType() == Event.EventType.NodeChildrenChanged) {
                    System.out.println("ğŸ”” æ£€æµ‹åˆ°å­èŠ‚ç‚¹å˜åŒ–: " + event.getPath());
                    getChildrenWithWatch(event.getPath()); // é‡æ–°ç›‘å¬
                }
            }
        };
        
        ChildrenCallback watchCallback = new ChildrenCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, 
                                    List<String> children) {
                if (rc == Code.OK.intValue()) {
                    System.out.println("ğŸ‘ï¸ å¸¦ç›‘å¬çš„å­èŠ‚ç‚¹è·å–æˆåŠŸ:");
                    System.out.println("  è·¯å¾„: " + path + ", å­èŠ‚ç‚¹æ•°: " + children.size());
                    
                    // æ‰“å°å­èŠ‚ç‚¹å˜åŒ–
                    children.forEach(child -> 
                        System.out.println("    ğŸ“„ " + child)
                    );
                } else {
                    System.err.println("âŒ å¸¦ç›‘å¬è·å–å­èŠ‚ç‚¹å¤±è´¥: " + Code.get(rc));
                }
            }
        };
        
        // å¼‚æ­¥è·å–å¹¶è®¾ç½®ç›‘å¬
        zk.getChildren(parentPath, childrenWatcher, watchCallback, "ç›‘å¬å­èŠ‚ç‚¹");
    }
}
```

---

## 6. ğŸ“Š StatCallbackçŠ¶æ€æŸ¥è¯¢å›è°ƒ


### 6.1 StatCallbackæ¥å£è¯¦è§£


**StatCallback**ç”¨äº**æŸ¥è¯¢èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯**çš„å¼‚æ­¥æ“ä½œï¼Œä¸»è¦ç”¨äºæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ä»¥åŠè·å–èŠ‚ç‚¹çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚

```java
public interface StatCallback extends AsyncCallback {
    /**
     * å¤„ç†çŠ¶æ€æŸ¥è¯¢æ“ä½œçš„ç»“æœ
     * @param rc è¿”å›ç 
     * @param path èŠ‚ç‚¹è·¯å¾„
     * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡
     * @param stat èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼ˆnullè¡¨ç¤ºèŠ‚ç‚¹ä¸å­˜åœ¨ï¼‰
     */
    void processResult(int rc, String path, Object ctx, Stat stat);
}
```

### 6.2 å¼‚æ­¥çŠ¶æ€æŸ¥è¯¢å®æˆ˜


**ğŸ” èŠ‚ç‚¹å­˜åœ¨æ€§æ£€æŸ¥ç¤ºä¾‹**

```java
public class AsyncStatChecker {
    private ZooKeeper zk;
    
    // å¼‚æ­¥æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
    public void checkNodeExists(String path) {
        StatCallback statCallback = new StatCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, Stat stat) {
                if (rc == Code.OK.intValue() && stat != null) {
                    // èŠ‚ç‚¹å­˜åœ¨ï¼Œæ˜¾ç¤ºè¯¦ç»†çŠ¶æ€ä¿¡æ¯
                    System.out.println("âœ… èŠ‚ç‚¹å­˜åœ¨: " + path);
                    displayNodeStats(stat);
                    
                    // æ ¹æ®çŠ¶æ€ä¿¡æ¯åšä¸šåŠ¡åˆ¤æ–­
                    makeBusinessDecision(path, stat);
                    
                } else if (rc == Code.NONODE.intValue()) {
                    System.out.println("âŒ èŠ‚ç‚¹ä¸å­˜åœ¨: " + path);
                    handleNodeNotExists(path);
                    
                } else {
                    System.err.println("ğŸ’¥ çŠ¶æ€æŸ¥è¯¢å¤±è´¥: " + Code.get(rc) + 
                                     ", è·¯å¾„: " + path);
                }
            }
            
            // æ˜¾ç¤ºèŠ‚ç‚¹çŠ¶æ€è¯¦æƒ…
            private void displayNodeStats(Stat stat) {
                System.out.println("ğŸ“Š èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯:");
                System.out.println("  åˆ›å»ºæ—¶é—´: " + formatTime(stat.getCtime()));
                System.out.println("  ä¿®æ”¹æ—¶é—´: " + formatTime(stat.getMtime()));
                System.out.println("  æ•°æ®ç‰ˆæœ¬: " + stat.getVersion());
                System.out.println("  å­èŠ‚ç‚¹ç‰ˆæœ¬: " + stat.getCversion());
                System.out.println("  ACLç‰ˆæœ¬: " + stat.getAversion());
                System.out.println("  æ•°æ®é•¿åº¦: " + stat.getDataLength() + " å­—èŠ‚");
                System.out.println("  å­èŠ‚ç‚¹æ•°é‡: " + stat.getNumChildren());
                System.out.println("  ä¸´æ—¶èŠ‚ç‚¹ID: " + 
                    (stat.getEphemeralOwner() == 0 ? "æŒä¹…èŠ‚ç‚¹" : stat.getEphemeralOwner()));
            }
            
            // æ ¹æ®çŠ¶æ€åšä¸šåŠ¡å†³ç­–
            private void makeBusinessDecision(String path, Stat stat) {
                // ç¤ºä¾‹ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦è¿‡æœŸ
                long lastModified = stat.getMtime();
                long currentTime = System.currentTimeMillis();
                long ageHours = (currentTime - lastModified) / (1000 * 60 * 60);
                
                if (ageHours > 24) {
                    System.out.println("âš ï¸ é…ç½®æ–‡ä»¶è¶…è¿‡24å°æ—¶æœªæ›´æ–°ï¼Œå¯èƒ½éœ€è¦åˆ·æ–°");
                }
                
                // æ£€æŸ¥æ•°æ®å¤§å°
                if (stat.getDataLength() > 1024 * 1024) { // 1MB
                    System.out.println("âš ï¸ èŠ‚ç‚¹æ•°æ®è¿‡å¤§: " + stat.getDataLength() + " å­—èŠ‚");
                }
            }
            
            // å¤„ç†èŠ‚ç‚¹ä¸å­˜åœ¨çš„æƒ…å†µ
            private void handleNodeNotExists(String path) {
                System.out.println("ğŸ”¨ èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œè€ƒè™‘åˆ›å»ºé»˜è®¤èŠ‚ç‚¹");
                // å¯ä»¥é€‰æ‹©åˆ›å»ºèŠ‚ç‚¹ã€ç­‰å¾…åˆ›å»ºæˆ–é€šçŸ¥ä¸šåŠ¡å±‚
            }
            
            // æ—¶é—´æ ¼å¼åŒ–è¾…åŠ©æ–¹æ³•
            private String formatTime(long timestamp) {
                return new SimpleDateFormat("yyyy-MM-dd HH:mm:ss")
                    .format(new Date(timestamp));
            }
        };
        
        // å‘èµ·å¼‚æ­¥çŠ¶æ€æŸ¥è¯¢
        String context = "æ£€æŸ¥èŠ‚ç‚¹å­˜åœ¨æ€§-" + path;
        zk.exists(path, false, statCallback, context);
        
        System.out.println("ğŸ” å¼‚æ­¥çŠ¶æ€æŸ¥è¯¢å·²å‘é€: " + path);
    }
    
    // å¸¦ç›‘å¬çš„å¼‚æ­¥çŠ¶æ€æŸ¥è¯¢
    public void checkExistsWithWatch(String path) {
        // èŠ‚ç‚¹åˆ›å»º/åˆ é™¤ç›‘å¬å™¨
        Watcher existsWatcher = new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                System.out.println("ğŸ”” èŠ‚ç‚¹çŠ¶æ€å˜åŒ–: " + event.getType() + 
                                 " @ " + event.getPath());
                
                switch (event.getType()) {
                    case NodeCreated:
                        System.out.println("ğŸ†• èŠ‚ç‚¹è¢«åˆ›å»º");
                        break;
                    case NodeDeleted:
                        System.out.println("ğŸ—‘ï¸ èŠ‚ç‚¹è¢«åˆ é™¤");
                        break;
                    case NodeDataChanged:
                        System.out.println("ğŸ“ èŠ‚ç‚¹æ•°æ®è¢«ä¿®æ”¹");
                        break;
                }
                
                // ç»§ç»­ç›‘å¬
                checkExistsWithWatch(event.getPath());
            }
        };
        
        StatCallback watchCallback = new StatCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, Stat stat) {
                if (rc == Code.OK.intValue()) {
                    System.out.println("ğŸ‘ï¸ å¸¦ç›‘å¬çš„çŠ¶æ€æŸ¥è¯¢æˆåŠŸï¼ŒèŠ‚ç‚¹å­˜åœ¨: " + path);
                } else if (rc == Code.NONODE.intValue()) {
                    System.out.println("ğŸ‘ï¸ å¸¦ç›‘å¬çš„çŠ¶æ€æŸ¥è¯¢æˆåŠŸï¼ŒèŠ‚ç‚¹ä¸å­˜åœ¨: " + path);
                } else {
                    System.err.println("âŒ å¸¦ç›‘å¬çŠ¶æ€æŸ¥è¯¢å¤±è´¥: " + Code.get(rc));
                }
            }
        };
        
        // å¼‚æ­¥æŸ¥è¯¢å¹¶è®¾ç½®ç›‘å¬
        zk.exists(path, existsWatcher, watchCallback, "ç›‘å¬çŠ¶æ€å˜åŒ–");
    }
}
```

---

## 7. ğŸ¯ å¼‚æ­¥æ“ä½œæœ€ä½³å®è·µ


### 7.1 é”™è¯¯å¤„ç†ç­–ç•¥


**ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶**

```java
public class AsyncErrorHandler {
    
    // é€šç”¨é”™è¯¯å¤„ç†å™¨
    public static void handleAsyncError(int rc, String operation, String path) {
        switch (rc) {
            case 0: // Code.OK
                // æˆåŠŸï¼Œæ— éœ€å¤„ç†
                break;
                
            case -4: // Code.CONNECTIONLOSS
                System.err.println("ğŸ”Œ è¿æ¥ä¸¢å¤±ï¼Œå°†é‡è¯•æ“ä½œ: " + operation);
                // å®ç°é‡è¯•é€»è¾‘
                scheduleRetry(operation, path);
                break;
                
            case -7: // Code.SESSIONEXPIRED
                System.err.println("â° ä¼šè¯è¿‡æœŸï¼Œéœ€è¦é‡æ–°è¿æ¥");
                // é‡æ–°å»ºç«‹è¿æ¥
                reconnectToZookeeper();
                break;
                
            case -101: // Code.NODEEXISTS
                System.err.println("âš ï¸ èŠ‚ç‚¹å·²å­˜åœ¨: " + path);
                // æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦æ›´æ–°
                break;
                
            case -102: // Code.NONODE
                System.err.println("âŒ èŠ‚ç‚¹ä¸å­˜åœ¨: " + path);
                // å¯èƒ½éœ€è¦åˆ›å»ºçˆ¶èŠ‚ç‚¹
                break;
                
            default:
                System.err.println("ğŸ’¥ æ“ä½œå¤±è´¥: " + Code.get(rc) + 
                                 ", æ“ä½œ: " + operation + ", è·¯å¾„: " + path);
        }
    }
    
    private static void scheduleRetry(String operation, String path) {
        // å®ç°é‡è¯•æœºåˆ¶ï¼ˆä½¿ç”¨å»¶æ—¶é˜Ÿåˆ—æˆ–å®šæ—¶å™¨ï¼‰
        System.out.println("ğŸ”„ å°†åœ¨3ç§’åé‡è¯•: " + operation);
    }
    
    private static void reconnectToZookeeper() {
        // é‡æ–°è¿æ¥é€»è¾‘
        System.out.println("ğŸ”Œ æ­£åœ¨é‡æ–°è¿æ¥Zookeeper...");
    }
}
```

### 7.2 ä¸Šä¸‹æ–‡ç®¡ç†æŠ€å·§


**ğŸ“ æ™ºèƒ½ä¸Šä¸‹æ–‡è®¾è®¡**

```java
// è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç±»
public class AsyncContext {
    private String operation;
    private long timestamp;
    private int retryCount;
    private Map<String, Object> metadata;
    
    public AsyncContext(String operation) {
        this.operation = operation;
        this.timestamp = System.currentTimeMillis();
        this.retryCount = 0;
        this.metadata = new HashMap<>();
    }
    
    // æ·»åŠ å…ƒæ•°æ®
    public AsyncContext addMetadata(String key, Object value) {
        metadata.put(key, value);
        return this;
    }
    
    // è·å–æ“ä½œè€—æ—¶
    public long getElapsedTime() {
        return System.currentTimeMillis() - timestamp;
    }
    
    // å¢åŠ é‡è¯•æ¬¡æ•°
    public void incrementRetry() {
        retryCount++;
    }
    
    // getterå’Œsetteræ–¹æ³•...
}

// ä½¿ç”¨ç¤ºä¾‹
public void smartAsyncCreate(String path, String data) {
    AsyncContext context = new AsyncContext("create_node")
        .addMetadata("path", path)
        .addMetadata("data_size", data.length());
    
    VoidCallback callback = new VoidCallback() {
        @Override
        public void processResult(int rc, String path, Object ctx) {
            AsyncContext asyncCtx = (AsyncContext) ctx;
            
            System.out.println("â±ï¸ æ“ä½œè€—æ—¶: " + asyncCtx.getElapsedTime() + "ms");
            System.out.println("ğŸ”„ é‡è¯•æ¬¡æ•°: " + asyncCtx.getRetryCount());
            
            if (rc != Code.OK.intValue() && asyncCtx.getRetryCount() < 3) {
                // é‡è¯•é€»è¾‘
                asyncCtx.incrementRetry();
                System.out.println("ğŸ”„ ç¬¬" + asyncCtx.getRetryCount() + "æ¬¡é‡è¯•...");
                retryOperation(asyncCtx);
            }
        }
    };
    
    zk.create(path, data.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, 
             CreateMode.PERSISTENT, callback, context);
}
```

### 7.3 å¹¶å‘æ§åˆ¶å’Œæ€§èƒ½ä¼˜åŒ–


**âš¡ å¼‚æ­¥å¹¶å‘æœ€ä½³å®è·µ**

```java
public class AsyncConcurrencyManager {
    private final Semaphore concurrencyLimit = new Semaphore(10); // é™åˆ¶å¹¶å‘æ•°
    private final AtomicInteger activeRequests = new AtomicInteger(0);
    
    // å—æ§çš„å¹¶å‘å¼‚æ­¥æ“ä½œ
    public void controlledAsyncOperation(String path, String data) {
        try {
            // è·å–å¹¶å‘è®¸å¯
            concurrencyLimit.acquire();
            int currentActive = activeRequests.incrementAndGet();
            
            System.out.println("ğŸš¦ å½“å‰æ´»è·ƒè¯·æ±‚æ•°: " + currentActive);
            
            VoidCallback callback = new VoidCallback() {
                @Override
                public void processResult(int rc, String path, Object ctx) {
                    try {
                        // å¤„ç†ç»“æœ
                        if (rc == Code.OK.intValue()) {
                            System.out.println("âœ… æ“ä½œæˆåŠŸ: " + path);
                        } else {
                            System.err.println("âŒ æ“ä½œå¤±è´¥: " + Code.get(rc));
                        }
                    } finally {
                        // é‡Šæ”¾å¹¶å‘è®¸å¯
                        concurrencyLimit.release();
                        int remaining = activeRequests.decrementAndGet();
                        System.out.println("ğŸ“‰ å‰©ä½™æ´»è·ƒè¯·æ±‚: " + remaining);
                    }
                }
            };
            
            // å‘èµ·å¼‚æ­¥è¯·æ±‚
            zk.create(path, data.getBytes(), 
                     ZooDefs.Ids.OPEN_ACL_UNSAFE,
                     CreateMode.PERSISTENT, 
                     callback, path);
                     
        } catch (InterruptedException e) {
            System.err.println("â¸ï¸ å¹¶å‘æ§åˆ¶ä¸­æ–­: " + e.getMessage());
            Thread.currentThread().interrupt();
        }
    }
    
    // æ‰¹é‡å¼‚æ­¥æ“ä½œ
    public void batchAsyncOperations(List<String> paths) {
        CountDownLatch latch = new CountDownLatch(paths.size());
        AtomicInteger successCount = new AtomicInteger(0);
        AtomicInteger failureCount = new AtomicInteger(0);
        
        for (String path : paths) {
            VoidCallback batchCallback = new VoidCallback() {
                @Override
                public void processResult(int rc, String path, Object ctx) {
                    try {
                        if (rc == Code.OK.intValue()) {
                            successCount.incrementAndGet();
                            System.out.println("âœ… æ‰¹é‡æ“ä½œæˆåŠŸ: " + path);
                        } else {
                            failureCount.incrementAndGet();
                            System.err.println("âŒ æ‰¹é‡æ“ä½œå¤±è´¥: " + path + 
                                             ", é”™è¯¯: " + Code.get(rc));
                        }
                    } finally {
                        latch.countDown();
                    }
                }
            };
            
            // å¼‚æ­¥åˆ›å»ºèŠ‚ç‚¹
            zk.create(path, "batch_data".getBytes(),
                     ZooDefs.Ids.OPEN_ACL_UNSAFE,
                     CreateMode.PERSISTENT,
                     batchCallback, path);
        }
        
        // ç­‰å¾…æ‰€æœ‰æ“ä½œå®Œæˆ
        try {
            boolean completed = latch.await(30, TimeUnit.SECONDS);
            if (completed) {
                System.out.println("ğŸ‰ æ‰¹é‡æ“ä½œå®Œæˆ:");
                System.out.println("  âœ… æˆåŠŸ: " + successCount.get());
                System.out.println("  âŒ å¤±è´¥: " + failureCount.get());
            } else {
                System.err.println("â° æ‰¹é‡æ“ä½œè¶…æ—¶");
            }
        } catch (InterruptedException e) {
            System.err.println("â¸ï¸ æ‰¹é‡æ“ä½œè¢«ä¸­æ–­");
            Thread.currentThread().interrupt();
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å¼‚æ­¥APIæœ¬è´¨ï¼šéé˜»å¡è°ƒç”¨ï¼Œé€šè¿‡å›è°ƒå¤„ç†ç»“æœ
ğŸ”¸ å›è°ƒæ¥å£ä½“ç³»ï¼šVoidCallbackã€DataCallbackã€ChildrenCallbackã€StatCallback
ğŸ”¸ è¿”å›ç æœºåˆ¶ï¼šé€šè¿‡rcå‚æ•°åˆ¤æ–­æ“ä½œæˆåŠŸæˆ–å¤±è´¥ç±»å‹
ğŸ”¸ ä¸Šä¸‹æ–‡ä¼ é€’ï¼šä½¿ç”¨ctxå‚æ•°åœ¨å¼‚æ­¥è°ƒç”¨é—´ä¼ é€’çŠ¶æ€ä¿¡æ¯
ğŸ”¸ çº¿ç¨‹æ¨¡å‹ï¼šIOçº¿ç¨‹è´Ÿè´£ç½‘ç»œé€šä¿¡ï¼Œå›è°ƒåœ¨ä¸“é—¨çº¿ç¨‹æ‰§è¡Œ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å¼‚æ­¥API**
```
æ€§èƒ½ä¼˜åŠ¿ï¼š
- é¿å…çº¿ç¨‹é˜»å¡ï¼Œæé«˜ååé‡
- å¯åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œå‡å°‘æ€»ä½“å»¶è¿Ÿ
- æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡

é€‚ç”¨åœºæ™¯ï¼š
- é«˜å¹¶å‘åº”ç”¨
- éœ€è¦æ‰¹é‡æ“ä½œ
- å¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„åœºæ™¯
```

**ğŸ”¹ å›è°ƒæ¥å£çš„é€‰æ‹©åŸåˆ™**
```
VoidCallbackï¼šåˆ›å»ºã€åˆ é™¤ã€æ›´æ–°æ“ä½œ
DataCallbackï¼šè¯»å–èŠ‚ç‚¹æ•°æ®
ChildrenCallbackï¼šè·å–å­èŠ‚ç‚¹åˆ—è¡¨
StatCallbackï¼šæ£€æŸ¥èŠ‚ç‚¹å­˜åœ¨æ€§å’ŒçŠ¶æ€
```

**ğŸ”¹ é”™è¯¯å¤„ç†çš„é‡è¦æ€§**
```
ç½‘ç»œå¼‚å¸¸ï¼šè¿æ¥ä¸¢å¤±ã€ä¼šè¯è¿‡æœŸ
ä¸šåŠ¡å¼‚å¸¸ï¼šèŠ‚ç‚¹ä¸å­˜åœ¨ã€æƒé™ä¸è¶³
ç³»ç»Ÿå¼‚å¸¸ï¼šå†…å­˜ä¸è¶³ã€è¶…æ—¶ç­‰
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æœ€ä½³å®è·µè¦ç‚¹**
- **å¹¶å‘æ§åˆ¶**ï¼šä½¿ç”¨ä¿¡å·é‡é™åˆ¶åŒæ—¶è¿›è¡Œçš„å¼‚æ­¥æ“ä½œæ•°é‡
- **é”™è¯¯é‡è¯•**ï¼šé’ˆå¯¹å¯æ¢å¤é”™è¯¯å®ç°æ™ºèƒ½é‡è¯•æœºåˆ¶
- **ä¸Šä¸‹æ–‡è®¾è®¡**ï¼šåˆç†è®¾è®¡ä¸Šä¸‹æ–‡å¯¹è±¡æºå¸¦å¿…è¦ä¿¡æ¯
- **ç›‘æ§ç»Ÿè®¡**ï¼šè®°å½•æ“ä½œè€—æ—¶ã€æˆåŠŸç‡ç­‰å…³é”®æŒ‡æ ‡
- **èµ„æºæ¸…ç†**ï¼šç¡®ä¿å›è°ƒä¸­æ­£ç¡®é‡Šæ”¾èµ„æºå’Œæ›´æ–°çŠ¶æ€

**ğŸš« å¸¸è§é™·é˜±**
- **å›è°ƒåœ°ç‹±**ï¼šé¿å…å›è°ƒåµŒå¥—è¿‡æ·±ï¼Œè€ƒè™‘ä½¿ç”¨Promiseæˆ–CompletableFuture
- **å†…å­˜æ³„æ¼**ï¼šå›è°ƒä¸­çš„å¼•ç”¨è¦åŠæ—¶æ¸…ç†
- **å¼‚å¸¸å¤„ç†**ï¼šå›è°ƒä¸­çš„å¼‚å¸¸ä¸ä¼šä¼ æ’­ï¼Œéœ€è¦æ˜¾å¼å¤„ç†
- **çº¿ç¨‹å®‰å…¨**ï¼šå›è°ƒå¯èƒ½åœ¨ä¸åŒçº¿ç¨‹æ‰§è¡Œï¼Œæ³¨æ„çº¿ç¨‹å®‰å…¨

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¼‚æ­¥APIæ˜¯é«˜æ€§èƒ½Zookeeperåº”ç”¨çš„åŸºç¡€
- æ¯ç§å›è°ƒæ¥å£éƒ½æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯
- é”™è¯¯å¤„ç†å’Œå¹¶å‘æ§åˆ¶æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„å…³é”®
- åˆç†çš„ä¸Šä¸‹æ–‡è®¾è®¡èƒ½å¤§å¤§ç®€åŒ–å¼‚æ­¥é€»è¾‘