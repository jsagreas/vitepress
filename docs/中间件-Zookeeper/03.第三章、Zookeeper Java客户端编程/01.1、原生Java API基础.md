---
title: 1ã€åŸç”ŸJava APIåŸºç¡€
---
## ğŸ“š ç›®å½•

1. [Zookeeper Javaå®¢æˆ·ç«¯æ¦‚è¿°](#1-Zookeeper-Javaå®¢æˆ·ç«¯æ¦‚è¿°)
2. [ZooKeeperæ ¸å¿ƒç±»è¯¦è§£](#2-ZooKeeperæ ¸å¿ƒç±»è¯¦è§£)
3. [è¿æ¥å­—ç¬¦ä¸²ä¸ä¼šè¯è¶…æ—¶](#3-è¿æ¥å­—ç¬¦ä¸²ä¸ä¼šè¯è¶…æ—¶)
4. [Watcherç›‘å¬æœºåˆ¶](#4-Watcherç›‘å¬æœºåˆ¶)
5. [è¿æ¥çŠ¶æ€ç®¡ç†](#5-è¿æ¥çŠ¶æ€ç®¡ç†)
6. [å¼‚æ­¥å›è°ƒæœºåˆ¶](#6-å¼‚æ­¥å›è°ƒæœºåˆ¶)
7. [å®é™…åº”ç”¨ç¤ºä¾‹](#7-å®é™…åº”ç”¨ç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Zookeeper Javaå®¢æˆ·ç«¯æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Zookeeper Javaå®¢æˆ·ç«¯


**ç®€å•ç†è§£**ï¼šå°±åƒä½ è¦ä½¿ç”¨é“¶è¡ŒæœåŠ¡éœ€è¦ä¸€å¼ é“¶è¡Œå¡ä¸€æ ·ï¼Œè¦ä½¿ç”¨ZookeeperæœåŠ¡å°±éœ€è¦ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚

```
ç°å®ç±»æ¯”ï¼š
ä½ (Javaåº”ç”¨) â†’ é“¶è¡Œå¡(Javaå®¢æˆ·ç«¯) â†’ é“¶è¡Œ(ZookeeperæœåŠ¡å™¨)

æŠ€æœ¯å¯¹åº”ï¼š
Javaç¨‹åº â†’ ZooKeeperç±»å®ä¾‹ â†’ Zookeeperé›†ç¾¤
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **è¿æ¥æ¡¥æ¢**ï¼šè¿æ¥ä½ çš„Javaç¨‹åºå’ŒZookeeperæœåŠ¡å™¨
- **æ“ä½œå·¥å…·**ï¼šæä¾›åˆ›å»ºã€åˆ é™¤ã€æŸ¥è¯¢èŠ‚ç‚¹çš„æ–¹æ³•
- **çŠ¶æ€ç®¡ç†**ï¼šç»´æŠ¤è¿æ¥çŠ¶æ€å’Œä¼šè¯ä¿¡æ¯
- **äº‹ä»¶é€šçŸ¥**ï¼šå½“èŠ‚ç‚¹æ•°æ®å˜åŒ–æ—¶é€šçŸ¥ä½ çš„ç¨‹åº

### 1.2 å®¢æˆ·ç«¯çš„å·¥ä½œåŸç†


```
å®¢æˆ·ç«¯å·¥ä½œæµç¨‹ï¼š
Javaåº”ç”¨å¯åŠ¨ â†’ åˆ›å»ºZooKeeperå®ä¾‹ â†’ å»ºç«‹TCPè¿æ¥ â†’ å‘é€è¯·æ±‚ â†’ æ¥æ”¶å“åº”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     TCPè¿æ¥      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Javaåº”ç”¨ç¨‹åº â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ ZookeeperæœåŠ¡å™¨  â”‚
â”‚  ZooKeeper  â”‚     å¿ƒè·³ä¿æŒ     â”‚    é›†ç¾¤        â”‚
â”‚   å®¢æˆ·ç«¯    â”‚     æ•°æ®åŒæ­¥     â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“¦ ZooKeeperæ ¸å¿ƒç±»è¯¦è§£


### 2.1 ZooKeeperç±»çš„æœ¬è´¨


**ä»€ä¹ˆæ˜¯ZooKeeperç±»**ï¼š
- è¿™æ˜¯Zookeeperæä¾›çš„**ä¸»è¦æ“ä½œç±»**
- å°±åƒé¥æ§å™¨ä¸€æ ·ï¼Œé€šè¿‡å®ƒæ¥æ§åˆ¶ZookeeperæœåŠ¡å™¨
- **ä¸€ä¸ªå®ä¾‹ä»£è¡¨ä¸€ä¸ªè¿æ¥**ï¼Œå°±åƒä¸€æ ¹ç½‘çº¿è¿æ¥ä½ çš„ç”µè„‘å’Œè·¯ç”±å™¨

### 2.2 åˆ›å»ºZooKeeperå®ä¾‹


**åŸºæœ¬è¯­æ³•**ï¼š
```java
ZooKeeper zk = new ZooKeeper(connectString, sessionTimeout, watcher);
```

**å‚æ•°è¯¦è§£**ï¼š

| å‚æ•°å | ä½œç”¨ | ç±»æ¯”ç†è§£ |
|--------|------|---------|
| `connectString` | æœåŠ¡å™¨åœ°å€ | å°±åƒç”µè¯å·ç ï¼Œå‘Šè¯‰ç¨‹åºæ‰¾å“ªå°æœåŠ¡å™¨ |
| `sessionTimeout` | ä¼šè¯è¶…æ—¶æ—¶é—´ | å°±åƒé€šè¯æ—¶é•¿é™åˆ¶ï¼Œè¶…æ—¶å°±æ–­çº¿ |
| `watcher` | äº‹ä»¶ç›‘å¬å™¨ | å°±åƒé—¨é“ƒï¼Œæœ‰å˜åŒ–å°±é€šçŸ¥ä½  |

### 2.3 ç®€å•åˆ›å»ºç¤ºä¾‹


```java
import org.apache.zookeeper.ZooKeeper;
import org.apache.zookeeper.Watcher;

public class ZKClient {
    public static void main(String[] args) throws Exception {
        // åˆ›å»ºZookeeperå®¢æˆ·ç«¯å®ä¾‹
        ZooKeeper zk = new ZooKeeper(
            "localhost:2181",           // æœåŠ¡å™¨åœ°å€
            5000,                      // 5ç§’è¶…æ—¶
            null                       // æš‚ä¸è®¾ç½®ç›‘å¬å™¨
        );
        
        // ç­‰å¾…è¿æ¥å»ºç«‹
        Thread.sleep(2000);
        
        // å…³é—­è¿æ¥
        zk.close();
    }
}
```

---

## 3. ğŸ”— è¿æ¥å­—ç¬¦ä¸²ä¸ä¼šè¯è¶…æ—¶


### 3.1 è¿æ¥å­—ç¬¦ä¸²è¯¦è§£


**è¿æ¥å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆ**ï¼šå°±åƒç½‘å€ä¸€æ ·ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å»å“ªé‡Œæ‰¾ZookeeperæœåŠ¡å™¨

**æ ¼å¼è§„åˆ™**ï¼š
```
å•ä¸ªæœåŠ¡å™¨ï¼šä¸»æœºå:ç«¯å£å·
å¤šä¸ªæœåŠ¡å™¨ï¼šä¸»æœºå1:ç«¯å£1,ä¸»æœºå2:ç«¯å£2,ä¸»æœºå3:ç«¯å£3
```

**å®é™…ç¤ºä¾‹**ï¼š
```java
// å•æœºæ¨¡å¼
String connectString = "localhost:2181";

// é›†ç¾¤æ¨¡å¼
String connectString = "zk1.example.com:2181,zk2.example.com:2181,zk3.example.com:2181";

// æœ¬åœ°é›†ç¾¤æµ‹è¯•
String connectString = "127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183";
```

**è¿æ¥è¿‡ç¨‹å›¾ç¤º**ï¼š
```
å®¢æˆ·ç«¯å°è¯•è¿æ¥æµç¨‹ï¼š
å°è¯•zk1:2181 â†’ æˆåŠŸ â†’ å»ºç«‹è¿æ¥
       â†“
    å¤±è´¥/è¶…æ—¶
       â†“
å°è¯•zk2:2181 â†’ æˆåŠŸ â†’ å»ºç«‹è¿æ¥
       â†“
    å¤±è´¥/è¶…æ—¶
       â†“
å°è¯•zk3:2181 â†’ æˆåŠŸ â†’ å»ºç«‹è¿æ¥
```

### 3.2 ä¼šè¯è¶…æ—¶æœºåˆ¶


**sessionTimeoutæ˜¯ä»€ä¹ˆ**ï¼š
- **ä¼šè¯çš„"ç”Ÿå‘½å‘¨æœŸ"**ï¼Œå°±åƒç§Ÿæˆ¿åˆåŒçš„æœŸé™
- å®¢æˆ·ç«¯å¿…é¡»åœ¨è¿™ä¸ªæ—¶é—´å†…å‘é€å¿ƒè·³ï¼Œè¯æ˜"æˆ‘è¿˜æ´»ç€"
- **è¶…æ—¶åæœåŠ¡å™¨ä¼šæ¸…ç†ç›¸å…³èµ„æº**

**è¶…æ—¶æ—¶é—´è®¾ç½®å»ºè®®**ï¼š
```java
// å¼€å‘æµ‹è¯•ç¯å¢ƒ
int sessionTimeout = 5000;  // 5ç§’ï¼Œå¿«é€Ÿå‘ç°é—®é¢˜

// ç”Ÿäº§ç¯å¢ƒ
int sessionTimeout = 30000; // 30ç§’ï¼Œé¿å…ç½‘ç»œæŠ–åŠ¨

// ç½‘ç»œè¾ƒå·®ç¯å¢ƒ
int sessionTimeout = 60000; // 60ç§’ï¼Œæ›´é«˜å®¹é”™
```

**ä¼šè¯ç”Ÿå‘½å‘¨æœŸ**ï¼š
```
ä¼šè¯çŠ¶æ€å˜åŒ–ï¼š
NOT_CONNECTED â†’ CONNECTING â†’ CONNECTED â†’ CLOSED
      â†‘              â†“             â†“
   åˆ›å»ºå®ä¾‹        å»ºç«‹è¿æ¥       æ­£å¸¸ä½¿ç”¨
                              â†“
                          ä¼šè¯è¿‡æœŸ/ä¸»åŠ¨å…³é—­
```

---

## 4. ğŸ‘‚ Watcherç›‘å¬æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯Watcher


**é€šä¿—ç†è§£**ï¼šWatcherå°±åƒ"ç›‘æ§æ‘„åƒå¤´"ï¼Œå½“ç›‘æ§çš„åœ°æ–¹æœ‰å˜åŒ–æ—¶ï¼Œç«‹å³é€šçŸ¥ä½ ã€‚

**å·¥ä½œåŸç†**ï¼š
```
ç›‘å¬è®¾ç½®è¿‡ç¨‹ï¼š
è®¾ç½®ç›‘å¬ â†’ èŠ‚ç‚¹å˜åŒ– â†’ è§¦å‘äº‹ä»¶ â†’ æ‰§è¡Œå›è°ƒæ–¹æ³•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    èŠ‚ç‚¹å˜åŒ–    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Zookeeper   â”‚
â”‚   Watcher   â”‚    äº‹ä»¶é€šçŸ¥    â”‚   æœåŠ¡å™¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Watcheræ¥å£è¯¦è§£


**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
public interface Watcher {
    void process(WatchedEvent event);  // äº‹ä»¶å¤„ç†æ–¹æ³•
}
```

**ç®€å•å®ç°ç¤ºä¾‹**ï¼š
```java
import org.apache.zookeeper.Watcher;
import org.apache.zookeeper.WatchedEvent;

public class MyWatcher implements Watcher {
    @Override
    public void process(WatchedEvent event) {
        System.out.println("æ”¶åˆ°äº‹ä»¶ï¼š" + event.getType());
        System.out.println("èŠ‚ç‚¹è·¯å¾„ï¼š" + event.getPath());
        System.out.println("è¿æ¥çŠ¶æ€ï¼š" + event.getState());
    }
}
```

### 4.3 Watcheräº‹ä»¶ç±»å‹


**ä¸»è¦äº‹ä»¶ç±»å‹**ï¼š

| äº‹ä»¶ç±»å‹ | è§¦å‘æ¡ä»¶ | å®é™…å«ä¹‰ |
|---------|---------|----------|
| `NodeCreated` | èŠ‚ç‚¹è¢«åˆ›å»º | æœ‰äººæ–°å»ºäº†æ–‡ä»¶å¤¹ |
| `NodeDeleted` | èŠ‚ç‚¹è¢«åˆ é™¤ | æœ‰äººåˆ é™¤äº†æ–‡ä»¶å¤¹ |
| `NodeDataChanged` | èŠ‚ç‚¹æ•°æ®æ”¹å˜ | æœ‰äººä¿®æ”¹äº†æ–‡ä»¶å†…å®¹ |
| `NodeChildrenChanged` | å­èŠ‚ç‚¹åˆ—è¡¨æ”¹å˜ | æ–‡ä»¶å¤¹é‡Œå¢å‡äº†æ–‡ä»¶ |

### 4.4 Watcherä½¿ç”¨æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦ç‰¹æ€§**ï¼š
- **ä¸€æ¬¡æ€§è§¦å‘**ï¼šæ¯ä¸ªWatcheråªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œç”¨å®Œå°±æ¶ˆå¤±
- **å¼‚æ­¥é€šçŸ¥**ï¼šäº‹ä»¶é€šçŸ¥æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»ç¨‹åº
- **é¡ºåºä¿è¯**ï¼šåŒä¸€ä¸ªå®¢æˆ·ç«¯çš„äº‹ä»¶æŒ‰é¡ºåºå¤„ç†

**æŒç»­ç›‘å¬ç¤ºä¾‹**ï¼š
```java
public class ContinuousWatcher implements Watcher {
    private ZooKeeper zk;
    private String path;
    
    public ContinuousWatcher(ZooKeeper zk, String path) {
        this.zk = zk;
        this.path = path;
    }
    
    @Override
    public void process(WatchedEvent event) {
        System.out.println("ç›‘å¬åˆ°å˜åŒ–ï¼š" + event.getType());
        
        try {
            // é‡æ–°è®¾ç½®ç›‘å¬ï¼ˆå®ç°æŒç»­ç›‘å¬ï¼‰
            zk.exists(path, this);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

---

## 5. ğŸ”„ è¿æ¥çŠ¶æ€ç®¡ç†


### 5.1 è¿æ¥çŠ¶æ€ç±»å‹


**KeeperStateçŠ¶æ€è¯¦è§£**ï¼š

```
è¿æ¥çŠ¶æ€å›¾ç¤ºï¼š
NOT_CONNECTED â”€â”€åˆ›å»ºå®ä¾‹â”€â”€â†’ CONNECTING
      â†‘                        â†“
   è¿æ¥æ–­å¼€                   è¿æ¥æˆåŠŸ
      â†‘                        â†“
    CLOSED â†â”€â”€ä¸»åŠ¨å…³é—­â”€â”€â”€â”€ CONNECTED
                              â†“
                          ä¼šè¯è¿‡æœŸ
                              â†“
                           EXPIRED
```

**å„çŠ¶æ€å«ä¹‰**ï¼š

| çŠ¶æ€ | å«ä¹‰ | å¯¹åº”åœºæ™¯ |
|------|------|----------|
| `NOT_CONNECTED` | æœªè¿æ¥ | åˆšåˆ›å»ºå®ä¾‹ï¼Œè¿˜æ²¡å¼€å§‹è¿æ¥ |
| `CONNECTING` | è¿æ¥ä¸­ | æ­£åœ¨å»ºç«‹è¿æ¥ï¼Œåƒæ‹¨å·ä¸­ |
| `CONNECTED` | å·²è¿æ¥ | è¿æ¥æˆåŠŸï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ |
| `EXPIRED` | ä¼šè¯è¿‡æœŸ | é•¿æ—¶é—´æ²¡å¿ƒè·³ï¼Œè¢«æœåŠ¡å™¨è¸¢æ‰ |
| `CLOSED` | å·²å…³é—­ | ä¸»åŠ¨å…³é—­æˆ–å¼‚å¸¸æ–­å¼€ |

### 5.2 çŠ¶æ€ç›‘å¬å®ç°


```java
public class ConnectionWatcher implements Watcher {
    @Override
    public void process(WatchedEvent event) {
        Watcher.Event.KeeperState state = event.getState();
        
        switch (state) {
            case NOT_CONNECTED:
                System.out.println("å®¢æˆ·ç«¯æœªè¿æ¥");
                break;
            case CONNECTING:
                System.out.println("æ­£åœ¨è¿æ¥ä¸­...");
                break;
            case CONNECTED:
                System.out.println("è¿æ¥æˆåŠŸï¼");
                break;
            case EXPIRED:
                System.out.println("ä¼šè¯è¿‡æœŸï¼Œéœ€è¦é‡æ–°è¿æ¥");
                break;
            case CLOSED:
                System.out.println("è¿æ¥å·²å…³é—­");
                break;
        }
    }
}
```

### 5.3 è¿æ¥çŠ¶æ€å¤„ç†æœ€ä½³å®è·µ


**å¤„ç†è¿æ¥å¼‚å¸¸**ï¼š
```java
public class RobustZKClient {
    private ZooKeeper zk;
    private final Object connectionLock = new Object();
    private boolean connected = false;
    
    public void connect(String connectString) throws Exception {
        zk = new ZooKeeper(connectString, 5000, new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getState() == Event.KeeperState.SyncConnected) {
                    synchronized (connectionLock) {
                        connected = true;
                        connectionLock.notifyAll();  // é€šçŸ¥è¿æ¥æˆåŠŸ
                    }
                }
            }
        });
        
        // ç­‰å¾…è¿æ¥å»ºç«‹
        synchronized (connectionLock) {
            while (!connected) {
                connectionLock.wait();
            }
        }
        System.out.println("Zookeeperè¿æ¥å»ºç«‹æˆåŠŸï¼");
    }
}
```

---

## 6. ğŸ”„ å¼‚æ­¥å›è°ƒæœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥å›è°ƒ


**é€šä¿—ç†è§£**ï¼šå°±åƒç‚¹å¤–å–ä¸€æ ·ï¼Œä½ ä¸‹å•åä¸ç”¨ä¸€ç›´ç­‰ç€ï¼Œå»åšåˆ«çš„äº‹æƒ…ï¼Œå¤–å–åˆ°äº†åº—å®¶ä¼šæ‰“ç”µè¯é€šçŸ¥ä½ ã€‚

```
åŒæ­¥è°ƒç”¨ vs å¼‚æ­¥å›è°ƒï¼š

åŒæ­¥è°ƒç”¨ï¼š
è¯·æ±‚ â†’ ç­‰å¾… â†’ å¾—åˆ°ç»“æœ â†’ ç»§ç»­æ‰§è¡Œ
     (é˜»å¡ç­‰å¾…)

å¼‚æ­¥å›è°ƒï¼š
è¯·æ±‚ â†’ ç«‹å³è¿”å› â†’ ç»§ç»­å…¶ä»–å·¥ä½œ
  â†“
å›è°ƒæ–¹æ³• â† ç»“æœå‡†å¤‡å¥½
```

### 6.2 å¼‚æ­¥APIç¤ºä¾‹


**å¼‚æ­¥è·å–æ•°æ®**ï¼š
```java
import org.apache.zookeeper.AsyncCallback;

public class AsyncExample {
    public void getData(ZooKeeper zk, String path) {
        // å¼‚æ­¥è·å–æ•°æ®
        zk.getData(path, false, new AsyncCallback.DataCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, 
                                    byte[] data, Stat stat) {
                if (rc == 0) {  // æˆåŠŸ
                    System.out.println("æ•°æ®ï¼š" + new String(data));
                } else {
                    System.out.println("è·å–å¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + rc);
                }
            }
        }, null);  // ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯ä¼ é€’é¢å¤–ä¿¡æ¯
        
        System.out.println("å¼‚æ­¥è¯·æ±‚å·²å‘é€ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡...");
    }
}
```

### 6.3 å¼‚æ­¥å›è°ƒçš„ä¼˜åŠ¿


**æ€§èƒ½ä¼˜åŠ¿å¯¹æ¯”**ï¼š

| æ–¹å¼ | æ‰§è¡Œæ—¶é—´ | èµ„æºå ç”¨ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|----------|
| **åŒæ­¥è°ƒç”¨** | é˜»å¡ç­‰å¾… | çº¿ç¨‹è¢«å ç”¨ | ç®€å•æ“ä½œï¼Œå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜ |
| **å¼‚æ­¥å›è°ƒ** | ç«‹å³è¿”å› | çº¿ç¨‹å¯å¤ç”¨ | é«˜å¹¶å‘ï¼Œæ‰¹é‡æ“ä½œ |

### 6.4 å›è°ƒå‡½æ•°ç±»å‹


**å¸¸ç”¨å›è°ƒæ¥å£**ï¼š
```java
// æ•°æ®æ“ä½œå›è°ƒ
AsyncCallback.DataCallback      // è·å–æ•°æ®
AsyncCallback.StringCallback    // åˆ›å»ºèŠ‚ç‚¹
AsyncCallback.StatCallback      // è®¾ç½®æ•°æ®
AsyncCallback.VoidCallback      // åˆ é™¤èŠ‚ç‚¹

// å­èŠ‚ç‚¹å›è°ƒ
AsyncCallback.ChildrenCallback  // è·å–å­èŠ‚ç‚¹åˆ—è¡¨
AsyncCallback.Children2Callback // è·å–å­èŠ‚ç‚¹å’ŒçŠ¶æ€
```

**å®ç”¨å›è°ƒç¤ºä¾‹**ï¼š
```java
public class CallbackExample {
    
    // åˆ›å»ºèŠ‚ç‚¹å›è°ƒ
    public void createNode(ZooKeeper zk, String path, byte[] data) {
        zk.create(path, data, ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                 CreateMode.PERSISTENT, 
                 new AsyncCallback.StringCallback() {
            @Override
            public void processResult(int rc, String path, Object ctx, String name) {
                if (rc == 0) {
                    System.out.println("èŠ‚ç‚¹åˆ›å»ºæˆåŠŸï¼š" + name);
                } else {
                    System.out.println("åˆ›å»ºå¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + rc);
                }
            }
        }, null);
    }
}
```

---

## 7. ğŸ’» å®é™…åº”ç”¨ç¤ºä¾‹


### 7.1 å®Œæ•´å®¢æˆ·ç«¯ç¤ºä¾‹


```java
import org.apache.zookeeper.*;
import org.apache.zookeeper.data.Stat;
import java.util.concurrent.CountDownLatch;

public class ZookeeperClient {
    private ZooKeeper zk;
    private final CountDownLatch connectedSignal = new CountDownLatch(1);
    
    // è¿æ¥Zookeeper
    public void connect(String hosts) throws Exception {
        zk = new ZooKeeper(hosts, 5000, new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getState() == Event.KeeperState.SyncConnected) {
                    connectedSignal.countDown();  // é€šçŸ¥è¿æ¥å®Œæˆ
                }
            }
        });
        
        connectedSignal.await();  // ç­‰å¾…è¿æ¥å®Œæˆ
        System.out.println("è¿æ¥ZookeeperæˆåŠŸï¼");
    }
    
    // åˆ›å»ºèŠ‚ç‚¹
    public void createNode(String path, String data) throws Exception {
        String result = zk.create(path, data.getBytes(), 
                                 ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                                 CreateMode.PERSISTENT);
        System.out.println("åˆ›å»ºèŠ‚ç‚¹ï¼š" + result);
    }
    
    // è·å–æ•°æ®
    public String getData(String path) throws Exception {
        byte[] data = zk.getData(path, false, null);
        return new String(data);
    }
    
    // å…³é—­è¿æ¥
    public void close() throws Exception {
        if (zk != null) {
            zk.close();
        }
    }
    
    public static void main(String[] args) throws Exception {
        ZookeeperClient client = new ZookeeperClient();
        
        // è¿æ¥
        client.connect("localhost:2181");
        
        // åˆ›å»ºèŠ‚ç‚¹
        client.createNode("/test", "Hello Zookeeper");
        
        // è·å–æ•°æ®
        String data = client.getData("/test");
        System.out.println("èŠ‚ç‚¹æ•°æ®ï¼š" + data);
        
        // å…³é—­è¿æ¥
        client.close();
    }
}
```

### 7.2 ç›‘å¬èŠ‚ç‚¹å˜åŒ–ç¤ºä¾‹


```java
public class NodeWatchExample {
    
    public static void watchNode(ZooKeeper zk, String path) throws Exception {
        // è®¾ç½®ç›‘å¬
        Stat exists = zk.exists(path, new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                System.out.println("èŠ‚ç‚¹å˜åŒ–ï¼š" + event.getType());
                System.out.println("å˜åŒ–è·¯å¾„ï¼š" + event.getPath());
                
                try {
                    // é‡æ–°è®¾ç½®ç›‘å¬ï¼ˆå› ä¸ºWatcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼‰
                    zk.exists(path, this);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
        
        if (exists != null) {
            System.out.println("èŠ‚ç‚¹å­˜åœ¨ï¼Œå¼€å§‹ç›‘å¬å˜åŒ–");
        } else {
            System.out.println("èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œç­‰å¾…åˆ›å»º");
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ZooKeeperç±»ï¼šæ“ä½œZookeeperçš„ä¸»è¦å·¥å…·ç±»
ğŸ”¸ è¿æ¥å­—ç¬¦ä¸²ï¼šå‘Šè¯‰å®¢æˆ·ç«¯æœåŠ¡å™¨åœ¨å“ªé‡Œ
ğŸ”¸ ä¼šè¯è¶…æ—¶ï¼šå®¢æˆ·ç«¯"å¿ƒè·³"æœºåˆ¶çš„æ—¶é—´é™åˆ¶
ğŸ”¸ Watcheræ¥å£ï¼šç›‘å¬èŠ‚ç‚¹å˜åŒ–çš„"ç›‘æ§æ‘„åƒå¤´"
ğŸ”¸ è¿æ¥çŠ¶æ€ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥æƒ…å†µ
ğŸ”¸ å¼‚æ­¥å›è°ƒï¼šéé˜»å¡æ“ä½œæ–¹å¼ï¼Œæé«˜ç¨‹åºæ•ˆç‡
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®¢æˆ·ç«¯æœ¬è´¨ç†è§£**
```
å®¢æˆ·ç«¯å°±æ˜¯ï¼š
- è¿æ¥å·¥å…·ï¼šè¿æ¥Javaç¨‹åºå’ŒZookeeperæœåŠ¡å™¨
- æ“ä½œæ¥å£ï¼šæä¾›å„ç§æ“ä½œæ–¹æ³•
- çŠ¶æ€ç®¡ç†å™¨ï¼šç»´æŠ¤è¿æ¥å’Œä¼šè¯çŠ¶æ€
- äº‹ä»¶å¤„ç†å™¨ï¼šå¤„ç†æœåŠ¡å™¨ç«¯çš„å˜åŒ–é€šçŸ¥
```

**ğŸ”¹ è¿æ¥ç®¡ç†è¦ç‚¹**
```
è¿æ¥å­—ç¬¦ä¸²ï¼šå¯ä»¥é…ç½®å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨é€‰æ‹©
ä¼šè¯è¶…æ—¶ï¼šç±»ä¼¼ç§Ÿçº¦ï¼Œéœ€è¦å®šæœŸç»­çº¦ï¼ˆå¿ƒè·³ï¼‰
è¿æ¥çŠ¶æ€ï¼šè¦ç›‘å¬çŠ¶æ€å˜åŒ–ï¼Œå¤„ç†å¼‚å¸¸æƒ…å†µ
```

**ğŸ”¹ ç›‘å¬æœºåˆ¶æ ¸å¿ƒ**
```
Watcherç‰¹ç‚¹ï¼š
- ä¸€æ¬¡æ€§ï¼šè§¦å‘ä¸€æ¬¡å°±å¤±æ•ˆï¼Œéœ€è¦é‡æ–°è®¾ç½®
- å¼‚æ­¥æ€§ï¼šäº‹ä»¶é€šçŸ¥ä¸ä¼šé˜»å¡ä¸»ç¨‹åº
- æœ‰åºæ€§ï¼šåŒä¸€å®¢æˆ·ç«¯çš„äº‹ä»¶æŒ‰é¡ºåºå¤„ç†
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **é…ç½®ç®¡ç†**ï¼šç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–
- âœ… **æœåŠ¡æ³¨å†Œ**ï¼šæ³¨å†Œå’Œå‘ç°æœåŠ¡
- âœ… **åˆ†å¸ƒå¼é”**ï¼šå®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é”æœºåˆ¶
- âœ… **é›†ç¾¤ç®¡ç†**ï¼šç›‘æ§é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€

**æœ€ä½³å®è·µ**ï¼š
```
è¿æ¥ç®¡ç†ï¼š
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†å¤šä¸ªè¿æ¥
- å¤„ç†è¿æ¥æ–­å¼€å’Œé‡è¿é€»è¾‘
- åˆç†è®¾ç½®ä¼šè¯è¶…æ—¶æ—¶é—´

ç›‘å¬è®¾ç½®ï¼š
- åŠæ—¶é‡æ–°è®¾ç½®Watcherï¼ˆå› ä¸ºæ˜¯ä¸€æ¬¡æ€§çš„ï¼‰
- åœ¨Watcherä¸­å¤„ç†å¼‚å¸¸ï¼Œé¿å…ç¨‹åºå´©æºƒ
- ä½¿ç”¨å¼‚æ­¥å›è°ƒæé«˜æ€§èƒ½

é”™è¯¯å¤„ç†ï¼š
- æ£€æŸ¥æ“ä½œè¿”å›ç 
- å¤„ç†ç½‘ç»œå¼‚å¸¸å’Œä¼šè¯è¿‡æœŸ
- å®ç°é‡è¯•æœºåˆ¶
```

**å¸¸è§é—®é¢˜è§£å†³**ï¼š
```
è¿æ¥é—®é¢˜ï¼š
Qï¼šè¿æ¥è¶…æ—¶æ€ä¹ˆåŠï¼Ÿ
Aï¼šæ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼Œé€‚å½“å¢åŠ è¶…æ—¶æ—¶é—´

ç›‘å¬é—®é¢˜ï¼š
Qï¼šä¸ºä»€ä¹ˆç›‘å¬åªè§¦å‘ä¸€æ¬¡ï¼Ÿ
Aï¼šWatcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼Œéœ€è¦åœ¨å›è°ƒä¸­é‡æ–°è®¾ç½®

æ€§èƒ½é—®é¢˜ï¼š
Qï¼šå¤§é‡æ“ä½œå¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ
Aï¼šä½¿ç”¨å¼‚æ­¥å›è°ƒï¼Œé¿å…é˜»å¡ç­‰å¾…
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ZooKeeperç±»æ˜¯å®¢æˆ·ç«¯æ“ä½œçš„æ ¸å¿ƒå·¥å…·
- è¿æ¥å­—ç¬¦ä¸²æŒ‡æ˜æœåŠ¡å™¨ä½ç½®ï¼Œæ”¯æŒé›†ç¾¤é…ç½®
- ä¼šè¯è¶…æ—¶æ˜¯å¿ƒè·³æœºåˆ¶ï¼Œé˜²æ­¢åƒµå°¸è¿æ¥
- Watcheræ˜¯ä¸€æ¬¡æ€§ç›‘å¬å™¨ï¼Œéœ€è¦é‡æ–°è®¾ç½®æ‰èƒ½æŒç»­ç›‘å¬
- å¼‚æ­¥å›è°ƒæé«˜æ€§èƒ½ï¼Œé¿å…é˜»å¡ç­‰å¾…