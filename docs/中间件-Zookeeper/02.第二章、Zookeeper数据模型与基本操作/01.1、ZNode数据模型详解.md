---
title: 1ã€ZNodeæ•°æ®æ¨¡å‹è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [ZNodeæ•°æ®æ¨¡å‹æ¦‚è¿°](#1-znodeæ•°æ®æ¨¡å‹æ¦‚è¿°)
2. [æ ‘å½¢å‘½åç©ºé—´ç»“æ„](#2-æ ‘å½¢å‘½åç©ºé—´ç»“æ„)
3. [èŠ‚ç‚¹è·¯å¾„è§„èŒƒ](#3-èŠ‚ç‚¹è·¯å¾„è§„èŒƒ)
4. [ZNodeèŠ‚ç‚¹ç±»å‹](#4-znodeèŠ‚ç‚¹ç±»å‹)
5. [æ•°æ®å­˜å‚¨æœºåˆ¶](#5-æ•°æ®å­˜å‚¨æœºåˆ¶)
6. [å…ƒæ•°æ®ä¿¡æ¯è¯¦è§£](#6-å…ƒæ•°æ®ä¿¡æ¯è¯¦è§£)
7. [ZNodeæ“ä½œç¤ºä¾‹](#7-znodeæ“ä½œç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ³ ZNodeæ•°æ®æ¨¡å‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ZNode


**ç®€å•ç†è§£**ï¼šZNodeå°±åƒæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œç›®å½•ï¼Œæ˜¯Zookeeperä¸­å­˜å‚¨æ•°æ®çš„åŸºæœ¬å•ä½ã€‚

> ğŸ’¡ **é€šä¿—æ¯”å–»**ï¼š
> å¦‚æœæŠŠZookeeperæƒ³è±¡æˆä¸€æ£µå¤§æ ‘ï¼Œé‚£ä¹ˆZNodeå°±æ˜¯æ ‘ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ ‘æå’Œå¶å­ï¼‰

**ZNodeçš„æœ¬è´¨**ï¼š
- **æ•°æ®å®¹å™¨**ï¼šæ¯ä¸ªZNodeéƒ½å¯ä»¥å­˜å‚¨æ•°æ®
- **è·¯å¾„æ ‡è¯†**ï¼šé€šè¿‡å”¯ä¸€è·¯å¾„æ¥å®šä½
- **å±‚æ¬¡ç»“æ„**ï¼šç»„æˆæ ‘å½¢çš„å‘½åç©ºé—´

### 1.2 ZNodeä¸ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„åŒºåˆ«


```
ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼š                    Zookeeper ZNodeï¼š
/home/user/file.txt              /app/config/database
   â†‘                                â†‘
   æ–‡ä»¶åªèƒ½å­˜å‚¨æ•°æ®                  èŠ‚ç‚¹æ—¢èƒ½å­˜å‚¨æ•°æ®åˆèƒ½æœ‰å­èŠ‚ç‚¹
   ç›®å½•åªèƒ½åŒ…å«å­æ–‡ä»¶/ç›®å½•           æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ZNode
```

**æ ¸å¿ƒå·®å¼‚**ï¼š
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šæ–‡ä»¶å’Œç›®å½•æ˜¯ä¸åŒçš„æ¦‚å¿µ
- **ZNode**ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ—¢å­˜æ•°æ®åˆæœ‰å­èŠ‚ç‚¹

---

## 2. ğŸŒ² æ ‘å½¢å‘½åç©ºé—´ç»“æ„


### 2.1 å‘½åç©ºé—´çš„æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å‘½åç©ºé—´**ï¼šå°±æ˜¯ä¸€å¥—ç»™ä¸œè¥¿èµ·åå­—çš„è§„åˆ™å’ŒèŒƒå›´ã€‚

> ğŸ“– **å®é™…ä¾‹å­**ï¼š
> - ä½ å®¶çš„é—¨ç‰Œå·ï¼šåŒ—äº¬å¸‚æœé˜³åŒºxxè¡—é“xxå·
> - ZNodeè·¯å¾„ï¼š/application/config/database

**æ ‘å½¢ç»“æ„çš„ç‰¹ç‚¹**ï¼š
```
           /ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰
          /    \
       app1    app2
       /  \     /  \
   config data config logs
   /    \
database cache
```

### 2.2 æ ‘å½¢ç»“æ„çš„ä¼˜åŠ¿


**ğŸ”¸ å±‚æ¬¡æ¸…æ™°**
- æŒ‰ç…§ä¸šåŠ¡é€»è¾‘åˆ†å±‚ç»„ç»‡
- ä¾¿äºç®¡ç†å’ŒæŸ¥æ‰¾

**ğŸ”¸ è·¯å¾„å”¯ä¸€**
- æ¯ä¸ªZNodeéƒ½æœ‰å”¯ä¸€çš„ç»å¯¹è·¯å¾„
- é¿å…å‘½åå†²çª

**ğŸ”¸ æƒé™ç»§æ‰¿**
- å¯ä»¥æŒ‰ç…§æ ‘å½¢ç»“æ„è®¾ç½®è®¿é—®æƒé™
- å­èŠ‚ç‚¹å¯ä»¥ç»§æ‰¿çˆ¶èŠ‚ç‚¹æƒé™

### 2.3 å®é™…åº”ç”¨åœºæ™¯


```
å¾®æœåŠ¡é…ç½®ç®¡ç†ï¼š
/services
  /user-service
    /config
      /database    â† æ•°æ®åº“é…ç½®
      /redis       â† ç¼“å­˜é…ç½®
    /instances     â† æœåŠ¡å®ä¾‹åˆ—è¡¨
  /order-service
    /config
    /instances

åˆ†å¸ƒå¼é”ï¼š
/locks
  /order-lock-001
  /user-lock-002
  /payment-lock-003
```

---

## 3. ğŸ“ èŠ‚ç‚¹è·¯å¾„è§„èŒƒ


### 3.1 è·¯å¾„çš„åŸºæœ¬è§„åˆ™


**è·¯å¾„æ ¼å¼**ï¼šå¿…é¡»ä»¥ `/` å¼€å¤´ï¼Œä½¿ç”¨ `/` åˆ†éš”å„çº§èŠ‚ç‚¹

> âš ï¸ **é‡è¦è§„åˆ™**ï¼š
> - è·¯å¾„åŒºåˆ†å¤§å°å†™ï¼š`/App` å’Œ `/app` æ˜¯ä¸åŒçš„èŠ‚ç‚¹
> - ä¸èƒ½ä»¥ `/` ç»“å°¾ï¼š`/app/config/` æ˜¯é”™è¯¯çš„
> - ä¸èƒ½æœ‰è¿ç»­çš„ `/`ï¼š`/app//config` æ˜¯é”™è¯¯çš„

### 3.2 è·¯å¾„å‘½åè§„èŒƒ


**âœ… åˆæ³•è·¯å¾„ç¤ºä¾‹**ï¼š
```
/                    â† æ ¹èŠ‚ç‚¹
/app                 â† å•çº§è·¯å¾„
/app/config          â† å¤šçº§è·¯å¾„
/services/user-service/config/db
```

**âŒ éæ³•è·¯å¾„ç¤ºä¾‹**ï¼š
```
app                  â† æ²¡æœ‰ä»¥ / å¼€å¤´
/app/config/         â† ä»¥ / ç»“å°¾
/app//config         â† åŒ…å«è¿ç»­çš„ /
/app/con fig         â† åŒ…å«ç©ºæ ¼ï¼ˆä¸æ¨èï¼‰
```

### 3.3 è·¯å¾„é•¿åº¦é™åˆ¶


| é™åˆ¶é¡¹ç›® | é™åˆ¶å€¼ | è¯´æ˜ |
|---------|--------|------|
| **èŠ‚ç‚¹åé•¿åº¦** | `1024å­—èŠ‚` | å•ä¸ªèŠ‚ç‚¹åçš„æœ€å¤§é•¿åº¦ |
| **è·¯å¾„æ€»é•¿åº¦** | `æ— æ˜ç¡®é™åˆ¶` | ä½†å»ºè®®æ§åˆ¶åœ¨åˆç†èŒƒå›´å†… |
| **è·¯å¾„æ·±åº¦** | `æ— æ˜ç¡®é™åˆ¶` | å»ºè®®ä¸è¶…è¿‡10çº§ |

### 3.4 è·¯å¾„å‘½åæœ€ä½³å®è·µ


**ğŸ¯ å‘½åå»ºè®®**ï¼š

```
æ¨èå‘½åé£æ ¼ï¼š
/application/user-service/config/database    â† ä½¿ç”¨è¿å­—ç¬¦
/app/userService/config/database             â† ä½¿ç”¨é©¼å³°å‘½å

é¿å…çš„å‘½åï¼š
/Application/User_Service/Config/DataBase    â† æ··åˆå¤§å°å†™
/app/ç”¨æˆ·æœåŠ¡/é…ç½®/æ•°æ®åº“                      â† ä¸­æ–‡è·¯å¾„
```

---

## 4. ğŸ·ï¸ ZNodeèŠ‚ç‚¹ç±»å‹


### 4.1 èŠ‚ç‚¹ç±»å‹æ¦‚è¿°


ZNodeæœ‰å››ç§åŸºæœ¬ç±»å‹ï¼Œä¸»è¦åŒºåˆ«åœ¨äº**ç”Ÿå­˜å‘¨æœŸ**å’Œ**å‘½åæ–¹å¼**ã€‚

```
ZNodeç±»å‹åˆ†ç±»ï¼š
â”œâ”€â”€ æŒä¹…èŠ‚ç‚¹ (PERSISTENT)
â”œâ”€â”€ ä¸´æ—¶èŠ‚ç‚¹ (EPHEMERAL) 
â”œâ”€â”€ æŒä¹…é¡ºåºèŠ‚ç‚¹ (PERSISTENT_SEQUENTIAL)
â””â”€â”€ ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ (EPHEMERAL_SEQUENTIAL)
```

### 4.2 æŒä¹…èŠ‚ç‚¹ (PERSISTENT)


**ç‰¹ç‚¹**ï¼šåˆ›å»ºåä¼šä¸€ç›´å­˜åœ¨ï¼Œé™¤éä¸»åŠ¨åˆ é™¤

> ğŸ’¡ **æ¯”å–»**ï¼šå°±åƒåœ¨ç¡¬ç›˜ä¸Šä¿å­˜çš„æ–‡ä»¶ï¼Œæ–­ç”µé‡å¯åä¾ç„¶å­˜åœ¨

**ä½¿ç”¨åœºæ™¯**ï¼š
- **é…ç½®ä¿¡æ¯**ï¼šåº”ç”¨çš„é…ç½®æ•°æ®
- **å…ƒæ•°æ®**ï¼šç³»ç»Ÿçš„åŸºç¡€ä¿¡æ¯
- **é™æ€æ•°æ®**ï¼šä¸ç»å¸¸å˜åŠ¨çš„æ•°æ®

**åˆ›å»ºç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºæŒä¹…èŠ‚ç‚¹
create /app/config "database_config_data"
```

### 4.3 ä¸´æ—¶èŠ‚ç‚¹ (EPHEMERAL)


**ç‰¹ç‚¹**ï¼šå®¢æˆ·ç«¯ä¼šè¯ç»“æŸæ—¶è‡ªåŠ¨åˆ é™¤

> ğŸ’¡ **æ¯”å–»**ï¼šå°±åƒèŠå¤©å®¤çš„åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œç”¨æˆ·ç¦»å¼€åè‡ªåŠ¨æ¶ˆå¤±

**é‡è¦é™åˆ¶**ï¼š
- **ä¸èƒ½æœ‰å­èŠ‚ç‚¹**ï¼šä¸´æ—¶èŠ‚ç‚¹åªèƒ½æ˜¯å¶å­èŠ‚ç‚¹
- **ä¼šè¯ç»‘å®š**ï¼šä¸åˆ›å»ºå®ƒçš„å®¢æˆ·ç«¯ä¼šè¯ç»‘å®š

**ä½¿ç”¨åœºæ™¯**ï¼š
- **æœåŠ¡æ³¨å†Œ**ï¼šå¾®æœåŠ¡å®ä¾‹çš„æ³¨å†Œä¿¡æ¯
- **åˆ†å¸ƒå¼é”**ï¼šä¸´æ—¶çš„é”ä¿¡æ¯
- **åœ¨çº¿çŠ¶æ€**ï¼šå®¢æˆ·ç«¯çš„åœ¨çº¿çŠ¶æ€

**åˆ›å»ºç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹
create -e /services/user-service/instance-001 "192.168.1.100:8080"
```

### 4.4 é¡ºåºèŠ‚ç‚¹ (SEQUENTIAL)


**ç‰¹ç‚¹**ï¼šZookeeperä¼šåœ¨èŠ‚ç‚¹ååé¢è‡ªåŠ¨æ·»åŠ ä¸€ä¸ªé€’å¢çš„æ•°å­—åºå·

> ğŸ’¡ **æ¯”å–»**ï¼šå°±åƒæ’é˜Ÿå–å·ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†é…å·ç 

**åºå·ç‰¹ç‚¹**ï¼š
- **10ä½æ•°å­—**ï¼šæ ¼å¼ä¸º `0000000001`ã€`0000000002`
- **å…¨å±€é€’å¢**ï¼šåœ¨åŒä¸€çˆ¶èŠ‚ç‚¹ä¸‹å…¨å±€é€’å¢
- **ä¸ä¼šé‡å¤**ï¼šå³ä½¿åˆ é™¤èŠ‚ç‚¹ï¼Œåºå·ä¹Ÿä¸ä¼šé‡ç”¨

### 4.5 æŒä¹…é¡ºåºèŠ‚ç‚¹ (PERSISTENT_SEQUENTIAL)


**ç‰¹ç‚¹**ï¼šæŒä¹…å­˜å‚¨ + è‡ªåŠ¨ç¼–å·

**ä½¿ç”¨åœºæ™¯**ï¼š
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šæŒ‰é¡ºåºå¤„ç†çš„ä»»åŠ¡
- **IDç”Ÿæˆ**ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å”¯ä¸€ID
- **æ—¥å¿—è®°å½•**ï¼šæŒ‰æ—¶é—´é¡ºåºçš„æ—¥å¿—

**åˆ›å»ºç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºæŒä¹…é¡ºåºèŠ‚ç‚¹
create -s /tasks/task "task_data"
# å®é™…åˆ›å»ºçš„èŠ‚ç‚¹ï¼š/tasks/task0000000001

create -s /tasks/task "task_data"  
# å®é™…åˆ›å»ºçš„èŠ‚ç‚¹ï¼š/tasks/task0000000002
```

### 4.6 ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ (EPHEMERAL_SEQUENTIAL)


**ç‰¹ç‚¹**ï¼šä¸´æ—¶å­˜å‚¨ + è‡ªåŠ¨ç¼–å·

**ä½¿ç”¨åœºæ™¯**ï¼š
- **åˆ†å¸ƒå¼é”**ï¼šæŒ‰é¡ºåºè·å–é”
- **é€‰ä¸¾ç®—æ³•**ï¼šæŒ‰ç¼–å·ç¡®å®šä¼˜å…ˆçº§
- **è´Ÿè½½å‡è¡¡**ï¼šæŒ‰é¡ºåºåˆ†é…è¯·æ±‚

**åˆ›å»ºç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹
create -e -s /locks/lock "client_info"
# å®é™…åˆ›å»ºçš„èŠ‚ç‚¹ï¼š/locks/lock0000000001
```

### 4.7 èŠ‚ç‚¹ç±»å‹é€‰æ‹©æŒ‡å—


| ä½¿ç”¨åœºæ™¯ | æ¨èç±»å‹ | åŸå›  |
|---------|---------|------|
| **åº”ç”¨é…ç½®** | `æŒä¹…èŠ‚ç‚¹` | éœ€è¦æŒä¹…ä¿å­˜ï¼Œä¸ç»å¸¸å˜åŠ¨ |
| **æœåŠ¡æ³¨å†Œ** | `ä¸´æ—¶èŠ‚ç‚¹` | æœåŠ¡ä¸‹çº¿æ—¶è‡ªåŠ¨æ¸…ç† |
| **ä»»åŠ¡é˜Ÿåˆ—** | `æŒä¹…é¡ºåºèŠ‚ç‚¹` | éœ€è¦æŒ‰é¡ºåºå¤„ç†ä¸”æŒä¹…ä¿å­˜ |
| **åˆ†å¸ƒå¼é”** | `ä¸´æ—¶é¡ºåºèŠ‚ç‚¹` | é¿å…æ­»é”ï¼ŒæŒ‰é¡ºåºè·å– |

---

## 5. ğŸ’¾ æ•°æ®å­˜å‚¨æœºåˆ¶


### 5.1 æ•°æ®å­˜å‚¨çš„åŸºæœ¬æ¦‚å¿µ


**ZNodeçš„æ•°æ®ç‰¹ç‚¹**ï¼š
- **å­—èŠ‚æ•°ç»„**ï¼šæ•°æ®ä»¥å­—èŠ‚æ•°ç»„å½¢å¼å­˜å‚¨
- **å¤§å°é™åˆ¶**ï¼šé»˜è®¤æœ€å¤§1MB
- **æ— æ ¼å¼è¦æ±‚**ï¼šå¯ä»¥å­˜å‚¨ä»»æ„æ ¼å¼çš„æ•°æ®

> ğŸ“– **ç®€å•ç†è§£**ï¼š
> ZNodeå°±åƒä¸€ä¸ªå°ç›’å­ï¼Œå¯ä»¥è£…ä»»ä½•ä¸œè¥¿ï¼Œä½†ç›’å­å¤§å°æœ‰é™åˆ¶

### 5.2 æ•°æ®å¤§å°é™åˆ¶


```
é»˜è®¤é™åˆ¶ï¼š1MB (1048576 bytes)

é…ç½®å‚æ•°ï¼šjute.maxbuffer
# åœ¨zoo.cfgä¸­è®¾ç½®
jute.maxbuffer=2097152  # è®¾ç½®ä¸º2MB
```

> âš ï¸ **é‡è¦æé†’**ï¼š
> - ZNodeä¸é€‚åˆå­˜å‚¨å¤§æ•°æ®
> - å»ºè®®å•ä¸ªèŠ‚ç‚¹æ•°æ®å°äº1KB
> - å¤§æ•°æ®åº”è¯¥å­˜å‚¨åœ¨ä¸“é—¨çš„å­˜å‚¨ç³»ç»Ÿä¸­

### 5.3 æ•°æ®æ ¼å¼ç¤ºä¾‹


**å­—ç¬¦ä¸²æ•°æ®**ï¼š
```java
// å­˜å‚¨å­—ç¬¦ä¸²
zk.create("/app/config/name", "MyApplication".getBytes(), ...);
```

**JSONæ ¼å¼**ï¼š
```java
// å­˜å‚¨JSONé…ç½®
String jsonConfig = "{\"host\":\"localhost\",\"port\":3306}";
zk.create("/app/config/db", jsonConfig.getBytes(), ...);
```

**åºåˆ—åŒ–å¯¹è±¡**ï¼š
```java
// å­˜å‚¨åºåˆ—åŒ–åçš„Javaå¯¹è±¡
Config config = new Config("localhost", 3306);
byte[] data = serialize(config);  // åºåˆ—åŒ–
zk.create("/app/config/obj", data, ...);
```

### 5.4 æ•°æ®è¯»å†™æ€§èƒ½


**è¯»å†™ç‰¹ç‚¹**ï¼š
- **è¯»æ“ä½œ**ï¼šéå¸¸å¿«ï¼Œç›´æ¥ä»å†…å­˜è¯»å–
- **å†™æ“ä½œ**ï¼šéœ€è¦åŒæ­¥åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œç›¸å¯¹è¾ƒæ…¢
- **é€‚ç”¨åœºæ™¯**ï¼šè¯»å¤šå†™å°‘çš„æ•°æ®

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
æ“ä½œç±»å‹     å“åº”æ—¶é—´      é€‚ç”¨åœºæ™¯
è¯»å–æ•°æ®     < 1ms        é…ç½®æŸ¥è¯¢ã€çŠ¶æ€æ£€æŸ¥
å†™å…¥æ•°æ®     10-100ms     é…ç½®æ›´æ–°ã€çŠ¶æ€å˜æ›´
```

---

## 6. ğŸ“Š å…ƒæ•°æ®ä¿¡æ¯è¯¦è§£


### 6.1 ä»€ä¹ˆæ˜¯å…ƒæ•°æ®


**å…ƒæ•°æ®å®šä¹‰**ï¼šæè¿°æ•°æ®çš„æ•°æ®ï¼ŒåŒ…å«ZNodeçš„å„ç§ç»Ÿè®¡ä¿¡æ¯

> ğŸ’¡ **æ¯”å–»**ï¼š
> å°±åƒæ–‡ä»¶çš„å±æ€§ä¿¡æ¯ï¼ˆåˆ›å»ºæ—¶é—´ã€å¤§å°ã€æƒé™ç­‰ï¼‰ï¼Œå…ƒæ•°æ®å‘Šè¯‰æˆ‘ä»¬ZNodeçš„è¯¦ç»†çŠ¶æ€

### 6.2 å…ƒæ•°æ®ç»“æ„è¯¦è§£


ZNodeçš„å…ƒæ•°æ®åŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

```java
public class Stat {
    long czxid;          // åˆ›å»ºäº‹åŠ¡ID  
    long mzxid;          // æœ€åä¿®æ”¹äº‹åŠ¡ID
    long pzxid;          // æœ€åä¿®æ”¹å­èŠ‚ç‚¹çš„äº‹åŠ¡ID
    long ctime;          // åˆ›å»ºæ—¶é—´æˆ³
    long mtime;          // æœ€åä¿®æ”¹æ—¶é—´æˆ³  
    int version;         // æ•°æ®ç‰ˆæœ¬å·
    int cversion;        // å­èŠ‚ç‚¹ç‰ˆæœ¬å·
    int aversion;        // ACLç‰ˆæœ¬å·
    long ephemeralOwner; // ä¸´æ—¶èŠ‚ç‚¹çš„ä¼šè¯ID
    int dataLength;      // æ•°æ®é•¿åº¦
    int numChildren;     // å­èŠ‚ç‚¹æ•°é‡
}
```

### 6.3 æ ¸å¿ƒå…ƒæ•°æ®å­—æ®µè¯¦è§£


**ğŸ”¸ äº‹åŠ¡IDç›¸å…³ (zxid)**

| å­—æ®µ | å«ä¹‰ | è¯´æ˜ |
|------|------|------|
| `czxid` | **åˆ›å»ºäº‹åŠ¡ID** | èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶çš„äº‹åŠ¡ID |
| `mzxid` | **ä¿®æ”¹äº‹åŠ¡ID** | èŠ‚ç‚¹æ•°æ®æœ€åè¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡ID |
| `pzxid` | **å­èŠ‚ç‚¹ä¿®æ”¹äº‹åŠ¡ID** | å­èŠ‚ç‚¹æœ€åè¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡ID |

> ğŸ“– **äº‹åŠ¡ID (zxid) è§£é‡Š**ï¼š
> - å…¨å±€å”¯ä¸€çš„é€’å¢ID
> - æ ¼å¼ï¼šé«˜32ä½æ˜¯epochï¼Œä½32ä½æ˜¯è®¡æ•°å™¨
> - å¯ä»¥ç”¨æ¥åˆ¤æ–­æ“ä½œçš„å…ˆåé¡ºåº

**ğŸ”¸ æ—¶é—´æˆ³ç›¸å…³**

```bash
ctime: 1634567890123    # åˆ›å»ºæ—¶é—´ (æ¯«ç§’æ—¶é—´æˆ³)
mtime: 1634567895456    # æœ€åä¿®æ”¹æ—¶é—´
```

**ğŸ”¸ ç‰ˆæœ¬ä¿¡æ¯ç›¸å…³**

```
version:  æ•°æ®å†…å®¹çš„ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹æ•°æ®é€’å¢
cversion: å­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¢åˆ å­èŠ‚ç‚¹é€’å¢  
aversion: ACLæƒé™çš„ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹æƒé™é€’å¢
```

> ğŸ’¡ **ç‰ˆæœ¬å·çš„ä½œç”¨**ï¼š
> - å®ç°ä¹è§‚é”æœºåˆ¶
> - é˜²æ­¢å¹¶å‘ä¿®æ”¹å†²çª
> - åˆ¤æ–­æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–

### 6.4 è·å–å…ƒæ•°æ®ç¤ºä¾‹


**å‘½ä»¤è¡Œæ–¹å¼**ï¼š
```bash
# æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
stat /app/config

# è¾“å‡ºç¤ºä¾‹ï¼š
# cZxid = 0x100000002
# ctime = Wed Oct 20 10:30:15 CST 2021
# mZxid = 0x100000005  
# mtime = Wed Oct 20 10:35:20 CST 2021
# pZxid = 0x100000002
# cversion = 0
# dataVersion = 2
# aclVersion = 0
# ephemeralOwner = 0x0
# dataLength = 25
# numChildren = 0
```

**Java APIæ–¹å¼**ï¼š
```java
Stat stat = zk.exists("/app/config", false);
if (stat != null) {
    System.out.println("æ•°æ®ç‰ˆæœ¬: " + stat.getVersion());
    System.out.println("æ•°æ®é•¿åº¦: " + stat.getDataLength());
    System.out.println("å­èŠ‚ç‚¹æ•°: " + stat.getNumChildren());
    System.out.println("åˆ›å»ºæ—¶é—´: " + new Date(stat.getCtime()));
}
```

---

## 7. ğŸ› ï¸ ZNodeæ“ä½œç¤ºä¾‹


### 7.1 åŸºæœ¬æ“ä½œå‘½ä»¤


**åˆ›å»ºèŠ‚ç‚¹**ï¼š
```bash
# åˆ›å»ºæŒä¹…èŠ‚ç‚¹
create /app/config "config_data"

# åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹  
create -e /services/user-service "192.168.1.100:8080"

# åˆ›å»ºé¡ºåºèŠ‚ç‚¹
create -s /tasks/task "task_data"

# åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹
create -e -s /locks/lock "client_001"
```

**æŸ¥çœ‹èŠ‚ç‚¹**ï¼š
```bash
# æŸ¥çœ‹èŠ‚ç‚¹æ•°æ®
get /app/config

# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
stat /app/config

# åˆ—å‡ºå­èŠ‚ç‚¹
ls /app
```

**ä¿®æ”¹èŠ‚ç‚¹**ï¼š
```bash
# ä¿®æ”¹èŠ‚ç‚¹æ•°æ®
set /app/config "new_config_data"

# åŸºäºç‰ˆæœ¬å·ä¿®æ”¹ï¼ˆä¹è§‚é”ï¼‰
set /app/config "new_data" 2
```

**åˆ é™¤èŠ‚ç‚¹**ï¼š
```bash
# åˆ é™¤èŠ‚ç‚¹ï¼ˆå¿…é¡»æ²¡æœ‰å­èŠ‚ç‚¹ï¼‰
delete /app/config

# é€’å½’åˆ é™¤èŠ‚ç‚¹åŠæ‰€æœ‰å­èŠ‚ç‚¹
deleteall /app
```

### 7.2 Java APIæ“ä½œç¤ºä¾‹


**åˆ›å»ºè¿æ¥**ï¼š
```java
ZooKeeper zk = new ZooKeeper("localhost:2181", 3000, 
    new Watcher() {
        public void process(WatchedEvent event) {
            System.out.println("äº‹ä»¶: " + event.getType());
        }
    });
```

**èŠ‚ç‚¹æ“ä½œ**ï¼š
```java
// åˆ›å»ºæŒä¹…èŠ‚ç‚¹
String path = zk.create("/app/config", 
    "config_data".getBytes(),
    ZooDefs.Ids.OPEN_ACL_UNSAFE,
    CreateMode.PERSISTENT);

// è¯»å–èŠ‚ç‚¹æ•°æ®
byte[] data = zk.getData("/app/config", false, null);
String content = new String(data);

// æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
Stat stat = zk.exists("/app/config", false);
if (stat != null) {
    System.out.println("èŠ‚ç‚¹å­˜åœ¨ï¼Œæ•°æ®ç‰ˆæœ¬: " + stat.getVersion());
}

// è·å–å­èŠ‚ç‚¹åˆ—è¡¨
List<String> children = zk.getChildren("/app", false);
```

### 7.3 å®é™…åº”ç”¨æ¡ˆä¾‹


**é…ç½®ä¸­å¿ƒå®ç°**ï¼š
```java
public class ConfigCenter {
    private ZooKeeper zk;
    
    // ä¿å­˜é…ç½®
    public void saveConfig(String key, String value) {
        String path = "/config/" + key;
        try {
            if (zk.exists(path, false) == null) {
                zk.create(path, value.getBytes(), 
                    ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                    CreateMode.PERSISTENT);
            } else {
                zk.setData(path, value.getBytes(), -1);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    // è·å–é…ç½®
    public String getConfig(String key) {
        String path = "/config/" + key;
        try {
            byte[] data = zk.getData(path, false, null);
            return new String(data);
        } catch (Exception e) {
            return null;
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ZNodeæœ¬è´¨ï¼šZookeeperä¸­çš„æ•°æ®å­˜å‚¨å•å…ƒï¼Œç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„èŠ‚ç‚¹
ğŸ”¸ æ ‘å½¢ç»“æ„ï¼šæ‰€æœ‰ZNodeç»„æˆå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´
ğŸ”¸ è·¯å¾„è§„èŒƒï¼šä»¥/å¼€å¤´ï¼Œä½¿ç”¨/åˆ†éš”ï¼ŒåŒºåˆ†å¤§å°å†™
ğŸ”¸ å››ç§ç±»å‹ï¼šæŒä¹…ã€ä¸´æ—¶ã€æŒä¹…é¡ºåºã€ä¸´æ—¶é¡ºåºèŠ‚ç‚¹
ğŸ”¸ æ•°æ®å­˜å‚¨ï¼šå­—èŠ‚æ•°ç»„å½¢å¼ï¼Œé»˜è®¤æœ€å¤§1MB
ğŸ”¸ å…ƒæ•°æ®ä¿¡æ¯ï¼šåŒ…å«ç‰ˆæœ¬ã€æ—¶é—´æˆ³ã€äº‹åŠ¡IDç­‰ç»Ÿè®¡ä¿¡æ¯
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ZNodeä¸æ–‡ä»¶ç³»ç»Ÿçš„åŒºåˆ«**
```
ç›¸åŒç‚¹ï¼š
- éƒ½æœ‰æ ‘å½¢å±‚æ¬¡ç»“æ„
- éƒ½é€šè¿‡è·¯å¾„è®¿é—®
- éƒ½å¯ä»¥å­˜å‚¨æ•°æ®

ä¸åŒç‚¹ï¼š  
- ZNodeæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å­˜æ•°æ®å’Œæœ‰å­èŠ‚ç‚¹
- æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶å’Œç›®å½•åŠŸèƒ½ä¸åŒ
- ZNodeæœ‰ä¸´æ—¶èŠ‚ç‚¹æ¦‚å¿µï¼Œæ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰
```

**ğŸ”¹ èŠ‚ç‚¹ç±»å‹çš„é€‰æ‹©åŸåˆ™**
```
æ•°æ®æŒä¹…æ€§éœ€æ±‚ï¼š
- éœ€è¦æŒä¹…ä¿å­˜ â†’ æŒä¹…èŠ‚ç‚¹
- ä¸´æ—¶ä½¿ç”¨ â†’ ä¸´æ—¶èŠ‚ç‚¹

æ˜¯å¦éœ€è¦æ’åºï¼š
- éœ€è¦æŒ‰é¡ºåºå¤„ç† â†’ é¡ºåºèŠ‚ç‚¹  
- ä¸éœ€è¦æ’åº â†’ æ™®é€šèŠ‚ç‚¹

å…¸å‹ç»„åˆï¼š
- é…ç½®æ•°æ® â†’ æŒä¹…èŠ‚ç‚¹
- æœåŠ¡æ³¨å†Œ â†’ ä¸´æ—¶èŠ‚ç‚¹
- åˆ†å¸ƒå¼é” â†’ ä¸´æ—¶é¡ºåºèŠ‚ç‚¹
- ä»»åŠ¡é˜Ÿåˆ— â†’ æŒä¹…é¡ºåºèŠ‚ç‚¹
```

**ğŸ”¹ æ•°æ®å­˜å‚¨çš„æ³¨æ„äº‹é¡¹**
```
å¤§å°é™åˆ¶ï¼š
- é»˜è®¤æœ€å¤§1MBï¼Œå»ºè®®å°äº1KB
- ä¸é€‚åˆå­˜å‚¨å¤§æ–‡ä»¶

æ•°æ®æ ¼å¼ï¼š
- ä»¥å­—èŠ‚æ•°ç»„å­˜å‚¨
- å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€JSONã€åºåˆ—åŒ–å¯¹è±¡
- åº”ç”¨å±‚è´Ÿè´£æ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–

æ€§èƒ½ç‰¹ç‚¹ï¼š
- è¯»æ“ä½œå¿«ï¼ˆå†…å­˜è¯»å–ï¼‰
- å†™æ“ä½œæ…¢ï¼ˆéœ€è¦åŒæ­¥ï¼‰
- é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æ ¸å¿ƒåº”ç”¨åœºæ™¯**
- **é…ç½®ç®¡ç†**ï¼šé›†ä¸­å­˜å‚¨åº”ç”¨é…ç½®ä¿¡æ¯
- **æœåŠ¡å‘ç°**ï¼šåŠ¨æ€æ³¨å†Œå’Œå‘ç°æœåŠ¡å®ä¾‹
- **åˆ†å¸ƒå¼é”**ï¼šå®ç°è·¨è¿›ç¨‹çš„äº’æ–¥è®¿é—®
- **é›†ç¾¤åè°ƒ**ï¼šèŠ‚ç‚¹çŠ¶æ€ç®¡ç†å’Œæ•…éšœæ£€æµ‹

**ğŸ”§ æœ€ä½³å®è·µå»ºè®®**
- **è·¯å¾„è§„åˆ’**ï¼šåˆç†è§„åˆ’å‘½åç©ºé—´ï¼Œä¾¿äºç®¡ç†
- **èŠ‚ç‚¹ç±»å‹**ï¼šæ ¹æ®æ•°æ®ç‰¹æ€§é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹ç±»å‹
- **æ•°æ®å¤§å°**ï¼šæ§åˆ¶æ•°æ®å¤§å°ï¼Œæé«˜æ€§èƒ½
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šåˆ©ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”æœºåˆ¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- ZNodeæ˜¯æ•°æ®å®¹å™¨ï¼Œç»„æˆæ ‘å½¢å‘½åç©ºé—´
- å››ç§ç±»å‹å„æœ‰ç”¨é€”ï¼ŒæŒ‰éœ€é€‰æ‹©æœ€åˆé€‚
- è·¯å¾„å”¯ä¸€æ ‡è¯†ï¼Œå…ƒæ•°æ®è®°å½•çŠ¶æ€
- è½»é‡å­˜å‚¨ä¸ºä¸»ï¼Œå¤§æ•°æ®éœ€å¦å¯»ä»–æ³•