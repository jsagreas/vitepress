---
title: 3、ZNode基本操作命令
---
## 📚 目录

1. [ZNode操作概述](#1-ZNode操作概述)
2. [create创建节点](#2-create创建节点)
3. [ls列出子节点](#3-ls列出子节点)
4. [get获取数据](#4-get获取数据)
5. [set设置数据](#5-set设置数据)
6. [delete删除节点](#6-delete删除节点)
7. [stat查看状态](#7-stat查看状态)
8. [操作实战演练](#8-操作实战演练)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔧 ZNode操作概述


### 1.1 什么是ZNode操作

**简单理解**：ZNode操作就是对Zookeeper数据树进行增删改查的基本命令，就像我们操作文件系统一样简单。

**核心作用**：
```
📁 create  → 创建新的数据节点（相当于新建文件/文件夹）
📋 ls      → 查看某个节点下有哪些子节点（相当于ls命令）
🔍 get     → 获取节点存储的数据内容（相当于cat命令）
✏️ set     → 修改节点的数据内容（相当于修改文件内容）
🗑️ delete  → 删除指定节点（相当于删除文件）
📊 stat    → 查看节点的详细状态信息（相当于文件属性）
```

### 1.2 操作前的准备工作

**连接Zookeeper**：
```bash
# 启动Zookeeper客户端（假设服务在本地2181端口）
zkCli.sh -server localhost:2181
```

**初始状态**：
```
连接成功后会看到：
[zk: localhost:2181(CONNECTED) 0]

这表示已经连接到Zookeeper，可以开始操作了
```

---

## 2. 📁 create创建节点


### 2.1 create命令基本用法

**命令格式**：
```bash
create [-s] [-e] path data [acl]
```

**参数说明**：
- `path`：节点路径（必须是绝对路径，以/开头）
- `data`：节点要存储的数据内容
- `-s`：创建顺序节点（sequential）
- `-e`：创建临时节点（ephemeral）
- `acl`：访问控制列表（可选）

### 2.2 创建持久节点

**基本创建**：
```bash
# 创建一个存储配置信息的节点
[zk: localhost:2181(CONNECTED) 1] create /config "database-config"
Created /config

# 创建多层路径节点
[zk: localhost:2181(CONNECTED) 2] create /app/service1 "service1-info"
Created /app/service1
```

**实际含义**：
- `/config` 节点存储了字符串 `"database-config"`
- 就像在根目录下创建了一个名为config的文件，内容是database-config

### 2.3 创建临时节点

**临时节点特点**：客户端断开连接后自动删除

```bash
# 创建临时节点（注意-e参数）
[zk: localhost:2181(CONNECTED) 3] create -e /temp "temporary-data"
Created /temp

# 当客户端断开连接时，/temp节点会自动消失
```

**使用场景**：
- **服务注册**：服务启动时创建临时节点，服务停止时节点自动删除
- **分布式锁**：获取锁时创建临时节点，释放锁时节点消失

### 2.4 创建顺序节点

**顺序节点特点**：Zookeeper会在节点名称后自动添加递增的序号

```bash
# 创建持久顺序节点
[zk: localhost:2181(CONNECTED) 4] create -s /queue/task- "task1"
Created /queue/task-0000000001

[zk: localhost:2181(CONNECTED) 5] create -s /queue/task- "task2"
Created /queue/task-0000000002

# 创建临时顺序节点
[zk: localhost:2181(CONNECTED) 6] create -s -e /lock/client- "client1"
Created /lock/client-0000000001
```

**使用场景**：
- **分布式队列**：任务按序号排列执行
- **选主算法**：序号最小的节点成为Leader

---

## 3. 📋 ls列出子节点


### 3.1 ls命令基本用法

**命令格式**：
```bash
ls path [watch]
```

**基本使用**：
```bash
# 查看根目录下的子节点
[zk: localhost:2181(CONNECTED) 7] ls /
[config, app, queue, zookeeper]

# 查看app目录下的子节点  
[zk: localhost:2181(CONNECTED) 8] ls /app
[service1]

# 查看空目录
[zk: localhost:2181(CONNECTED) 9] ls /config
[]
```

### 3.2 理解输出结果

**输出解释**：
```
ls / 的输出：[config, app, queue, zookeeper]

含义：根目录下有4个子节点
- config：我们创建的配置节点
- app：我们创建的应用节点
- queue：我们创建的队列节点  
- zookeeper：系统自带的管理节点
```

### 3.3 ls2命令（扩展版本）

**ls2功能**：同时显示子节点和当前节点的状态信息

```bash
[zk: localhost:2181(CONNECTED) 10] ls2 /app
[service1]
cZxid = 0x2
ctime = Wed Sep 24 10:30:15 CST 2025
mZxid = 0x2
mtime = Wed Sep 24 10:30:15 CST 2025
pZxid = 0x3
cversion = 1
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 0
numChildren = 1
```

---

## 4. 🔍 get获取数据


### 4.1 get命令基本用法

**命令格式**：
```bash
get path [watch]
```

**基本获取**：
```bash
# 获取config节点的数据
[zk: localhost:2181(CONNECTED) 11] get /config
database-config
cZxid = 0x2
ctime = Wed Sep 24 10:25:10 CST 2025
mZxid = 0x2
mtime = Wed Sep 24 10:25:10 CST 2025
pZxid = 0x2
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 15
numChildren = 0
```

### 4.2 输出结果解释

**数据部分**：
- `database-config`：这是节点存储的实际数据内容

**状态信息**：
- `cZxid`：节点创建时的事务ID
- `ctime`：节点创建时间
- `mZxid`：节点最后修改时的事务ID
- `mtime`：节点最后修改时间
- `dataVersion`：数据版本号（每次修改+1）
- `dataLength`：数据长度（字节数）
- `numChildren`：子节点数量

### 4.3 只获取数据内容

如果只想看数据内容，不想看状态信息：

```bash
# 可以结合其他命令或脚本处理
# 通常在程序中使用API获取时只返回数据内容
```

---

## 5. ✏️ set设置数据


### 5.1 set命令基本用法

**命令格式**：
```bash
set path data [version]
```

**基本修改**：
```bash
# 修改config节点的数据
[zk: localhost:2181(CONNECTED) 12] set /config "new-database-config"
cZxid = 0x2
ctime = Wed Sep 24 10:25:10 CST 2025
mZxid = 0x5
mtime = Wed Sep 24 10:45:20 CST 2025
pZxid = 0x2
cversion = 0
dataVersion = 1
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 19
numChildren = 0
```

**验证修改**：
```bash
[zk: localhost:2181(CONNECTED) 13] get /config
new-database-config
...
dataVersion = 1
```

### 5.2 版本控制修改

**为什么需要版本控制**：防止并发修改时数据覆盖

```bash
# 基于特定版本修改（乐观锁机制）
[zk: localhost:2181(CONNECTED) 14] set /config "final-config" 1
cZxid = 0x2
ctime = Wed Sep 24 10:25:10 CST 2025
mZxid = 0x6
mtime = Wed Sep 24 10:50:30 CST 2025
...
dataVersion = 2
```

**版本不匹配的情况**：
```bash
# 如果版本号不匹配会报错
[zk: localhost:2181(CONNECTED) 15] set /config "error-config" 1
KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /config
```

---

## 6. 🗑️ delete删除节点


### 6.1 delete命令基本用法

**命令格式**：
```bash
delete path [version]
```

**基本删除**：
```bash
# 删除临时节点
[zk: localhost:2181(CONNECTED) 16] delete /temp
Node does not exist: /temp
# 临时节点可能已经因为连接断开而自动删除了

# 删除持久节点
[zk: localhost:2181(CONNECTED) 17] delete /config
[zk: localhost:2181(CONNECTED) 18] ls /
[app, queue, zookeeper]
```

### 6.2 删除限制

**不能删除有子节点的节点**：
```bash
[zk: localhost:2181(CONNECTED) 19] delete /app
Node not empty: /app

# 必须先删除子节点
[zk: localhost:2181(CONNECTED) 20] delete /app/service1
[zk: localhost:2181(CONNECTED) 21] delete /app
```

### 6.3 递归删除

**rmr命令**（在某些版本中可用）：
```bash
# 递归删除整个子树
rmr /queue
# 会删除/queue及其下面的所有子节点
```

---

## 7. 📊 stat查看状态


### 7.1 stat命令基本用法

**命令格式**：
```bash
stat path [watch]
```

**查看状态**：
```bash
[zk: localhost:2181(CONNECTED) 22] create /test "test-data"
[zk: localhost:2181(CONNECTED) 23] stat /test
cZxid = 0x8
ctime = Wed Sep 24 11:00:00 CST 2025
mZxid = 0x8
mtime = Wed Sep 24 11:00:00 CST 2025
pZxid = 0x8
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 9
numChildren = 0
```

### 7.2 状态信息详解


| 字段 | **含义** | **说明** |
|------|----------|----------|
| `cZxid` | **创建事务ID** | 节点被创建时的全局事务ID |
| `ctime` | **创建时间** | 节点创建的时间戳 |
| `mZxid` | **修改事务ID** | 节点最后一次被修改时的事务ID |
| `mtime` | **修改时间** | 节点最后修改时间 |
| `pZxid` | **子节点修改ID** | 子节点列表最后一次被修改的事务ID |
| `cversion` | **子节点版本** | 子节点的版本号 |
| `dataVersion` | **数据版本** | 数据内容的版本号 |
| `ephemeralOwner` | **临时节点所有者** | 如果是临时节点，显示session ID |
| `dataLength` | **数据长度** | 存储的数据字节数 |
| `numChildren` | **子节点数量** | 直接子节点的个数 |

---

## 8. 🎯 操作实战演练


### 8.1 模拟服务注册场景

```bash
# 1. 创建服务注册根目录
create /services "service-registry"

# 2. 注册Web服务（临时节点，服务下线自动删除）
create -e /services/web-service "192.168.1.100:8080"

# 3. 注册数据库服务
create -e /services/db-service "192.168.1.200:3306"

# 4. 查看所有注册的服务
ls /services
[web-service, db-service]

# 5. 获取具体服务信息
get /services/web-service
192.168.1.100:8080
```

### 8.2 模拟分布式配置场景

```bash
# 1. 创建配置管理目录
create /config-center "distributed-config"

# 2. 创建应用配置
create /config-center/app1 '{"db_url":"localhost:3306","cache_size":1000}'

# 3. 修改配置
set /config-center/app1 '{"db_url":"192.168.1.100:3306","cache_size":2000}'

# 4. 查看配置版本
stat /config-center/app1
dataVersion = 1

# 5. 基于版本安全更新
set /config-center/app1 '{"db_url":"192.168.1.100:3306","cache_size":3000}' 1
```

### 8.3 模拟分布式队列场景

```bash
# 1. 创建队列目录
create /task-queue "distributed-queue"

# 2. 添加任务（顺序节点确保顺序）
create -s /task-queue/task- "process-order-001"
create -s /task-queue/task- "send-email-002"  
create -s /task-queue/task- "update-inventory-003"

# 3. 查看队列中的任务
ls /task-queue
[task-0000000001, task-0000000002, task-0000000003]

# 4. 处理任务（按序号处理，处理完删除）
get /task-queue/task-0000000001
delete /task-queue/task-0000000001
```

---

## 9. 📋 核心要点总结


### 9.1 六大核心命令对照表


| 命令 | **作用** | **常用参数** | **实际场景** |
|------|----------|-------------|-------------|
| `create` | **创建节点** | `-s` 顺序，`-e` 临时 | 服务注册、配置存储 |
| `ls` | **列出子节点** | 无 | 服务发现、目录查看 |
| `get` | **获取数据** | 无 | 读取配置、获取服务信息 |
| `set` | **设置数据** | `version` 版本控制 | 配置更新、状态修改 |
| `delete` | **删除节点** | `version` 版本控制 | 服务下线、清理数据 |
| `stat` | **查看状态** | 无 | 监控节点、版本检查 |

### 9.2 操作要点记忆


**🔸 节点路径**：
- 必须以 `/` 开头（绝对路径）
- 路径区分大小写
- 不能以 `/` 结尾（除了根节点）

**🔸 数据特点**：
- 每个节点都可以存储数据
- 数据大小建议不超过1MB
- 数据以字节数组形式存储

**🔸 版本控制**：
- `dataVersion`：数据修改时递增
- `cversion`：子节点变化时递增
- 版本号用于实现乐观锁机制

**🔸 节点类型**：
- **持久节点**：客户端断开后依然存在
- **临时节点**：客户端断开后自动删除
- **顺序节点**：名称后自动添加递增序号

### 9.3 实际应用建议


**💡 最佳实践**：
- 服务注册使用**临时节点**，确保服务下线后自动清理
- 分布式队列使用**持久顺序节点**，确保任务不丢失且有序
- 配置管理使用**持久节点**，数据持久化存储
- 分布式锁使用**临时顺序节点**，避免死锁且公平竞争

**🚨 注意事项**：
- 删除节点前确保没有子节点
- 使用版本号避免并发修改冲突  
- 临时节点不能有子节点
- 节点名称不能包含特殊字符

**核心记忆口诀**：
```
创建create存数据，列出ls看子节点
获取get读内容，设置set改数据  
删除delete清节点，状态stat查信息
临时断线就消失，顺序自动加编号
```