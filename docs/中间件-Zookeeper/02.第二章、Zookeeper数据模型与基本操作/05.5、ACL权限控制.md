---
title: 5ã€ACLæƒé™æ§åˆ¶
---
## ğŸ“š ç›®å½•

1. [ACLæƒé™æ§åˆ¶æ¦‚è¿°](#1-ACLæƒé™æ§åˆ¶æ¦‚è¿°)
2. [æƒé™æ¨¡å¼schemeè¯¦è§£](#2-æƒé™æ¨¡å¼schemeè¯¦è§£)
3. [èº«ä»½æ ‡è¯†idæœºåˆ¶](#3-èº«ä»½æ ‡è¯†idæœºåˆ¶)
4. [æƒé™ä½permissionè¯¦è§£](#4-æƒé™ä½permissionè¯¦è§£)
5. [worldæƒé™æ¨¡å¼](#5-worldæƒé™æ¨¡å¼)
6. [authæƒé™æ¨¡å¼](#6-authæƒé™æ¨¡å¼)
7. [digestæƒé™æ¨¡å¼](#7-digestæƒé™æ¨¡å¼)
8. [ACLå®é™…åº”ç”¨åœºæ™¯](#8-ACLå®é™…åº”ç”¨åœºæ™¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ ACLæƒé™æ§åˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ACLæƒé™æ§åˆ¶


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
ACLï¼šAccess Control Listï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰
ä½œç”¨ï¼šæ§åˆ¶è°èƒ½è®¿é—®ZooKeeperä¸­çš„å“ªäº›èŠ‚ç‚¹ï¼Œèƒ½æ‰§è¡Œä»€ä¹ˆæ“ä½œ
ç›®çš„ï¼šä¿æŠ¤æ•æ„Ÿæ•°æ®ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®å’Œè¯¯æ“ä½œ
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ACLï¼Ÿ**
æƒ³è±¡ä¸€ä¸ªå…¬å¸çš„æ–‡ä»¶æŸœç³»ç»Ÿï¼š
- ğŸ“ **æ™®é€šæ–‡ä»¶** - æ‰€æœ‰å‘˜å·¥éƒ½èƒ½çœ‹
- ğŸ”’ **è´¢åŠ¡æ–‡ä»¶** - åªæœ‰è´¢åŠ¡éƒ¨é—¨èƒ½çœ‹
- ğŸ” **äººäº‹æ¡£æ¡ˆ** - åªæœ‰HRå’Œè€æ¿èƒ½çœ‹

ZooKeeperçš„ACLå°±åƒè¿™ä¸ªæ–‡ä»¶æŸœçš„é’¥åŒ™ç®¡ç†ç³»ç»Ÿï¼Œå†³å®šè°èƒ½æ‰“å¼€å“ªä¸ªæŠ½å±‰ã€‚

### 1.2 ACLçš„ä¸‰è¦ç´ 


**ğŸ¯ ACL = Scheme + ID + Permission**

```
å®Œæ•´çš„æƒé™æ§åˆ¶æè¿°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  scheme:id:permission                   â”‚
â”‚  â†“      â†“   â†“                          â”‚
â”‚  æ–¹å¼   è°   èƒ½åšä»€ä¹ˆ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ä¾‹ï¼šdigest:admin:cdrwa
è§£è¯»ï¼šé€šè¿‡ç”¨æˆ·åå¯†ç æ–¹å¼ï¼Œç”¨æˆ·adminæ‹¥æœ‰åˆ›å»ºã€åˆ é™¤ã€è¯»å–ã€å†™å…¥ã€ç®¡ç†æƒé™
```

### 1.3 ACLå·¥ä½œåŸç†


**âš¡ æƒé™éªŒè¯æµç¨‹**
```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
æ£€æŸ¥èŠ‚ç‚¹ACLåˆ—è¡¨
    â†“
éªŒè¯å®¢æˆ·ç«¯èº«ä»½
    â†“
æ£€æŸ¥æ“ä½œæƒé™
    â†“
å…è®¸/æ‹’ç»æ“ä½œ
```

---

## 2. ğŸ”§ æƒé™æ¨¡å¼schemeè¯¦è§£


### 2.1 schemeæ˜¯ä»€ä¹ˆ


**ğŸ”¸ æœ¬è´¨ç†è§£**
schemeå°±æ˜¯**èº«ä»½éªŒè¯çš„æ–¹å¼**ï¼Œå°±åƒè¿›é—¨æ—¶çš„ä¸åŒéªŒè¯æ–¹æ³•ï¼š
- ğŸ†” **åˆ·èº«ä»½è¯** - å®åè®¤è¯
- ğŸ”‘ **åˆ·é—¨ç¦å¡** - å¡ç‰‡è®¤è¯  
- ğŸ‘‹ **äººè„¸è¯†åˆ«** - ç”Ÿç‰©è®¤è¯
- ğŸšª **æ— éœ€éªŒè¯** - å¼€æ”¾é€šé“

### 2.2 ZooKeeperæ”¯æŒçš„schemeç±»å‹


| schemeç±»å‹ | **éªŒè¯æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **å®‰å…¨çº§åˆ«** |
|-----------|------------|-------------|-------------|
| **world** | `æ— éœ€éªŒè¯` | `å…¬å¼€æ•°æ®` | `æœ€ä½` |
| **auth** | `å·²è®¤è¯ç”¨æˆ·` | `å†…éƒ¨ç³»ç»Ÿ` | `ä¸­ç­‰` |
| **digest** | `ç”¨æˆ·å+å¯†ç ` | `ç”¨æˆ·ç³»ç»Ÿ` | `è¾ƒé«˜` |
| **ip** | `IPåœ°å€é™åˆ¶` | `ç½‘ç»œéš”ç¦»` | `ä¸­ç­‰` |
| **x509** | `SSLè¯ä¹¦` | `ä¼ä¸šçº§åº”ç”¨` | `æœ€é«˜` |

### 2.3 schemeé€‰æ‹©æŒ‡å¯¼


**ğŸ¯ å¦‚ä½•é€‰æ‹©åˆé€‚çš„schemeï¼Ÿ**

```
ğŸ“Š åœºæ™¯åˆ†æï¼š

ğŸŒ é…ç½®ä¿¡æ¯ã€å…¬å‘Šç­‰ â†’ world
   ç‰¹ç‚¹ï¼šæ‰€æœ‰äººéƒ½èƒ½è®¿é—®

ğŸ” ç³»ç»Ÿå†…éƒ¨æ•°æ® â†’ auth  
   ç‰¹ç‚¹ï¼šç™»å½•ç”¨æˆ·æ‰èƒ½è®¿é—®

ğŸ‘¤ ç”¨æˆ·ä¸ªäººæ•°æ® â†’ digest
   ç‰¹ç‚¹ï¼šç‰¹å®šç”¨æˆ·åå¯†ç æ‰èƒ½è®¿é—®

ğŸŒ ç‰¹å®šæœåŠ¡å™¨è®¿é—® â†’ ip
   ç‰¹ç‚¹ï¼šåªå…è®¸ç‰¹å®šIPè®¿é—®

ğŸ¢ ä¼ä¸šçº§å®‰å…¨ â†’ x509
   ç‰¹ç‚¹ï¼šéœ€è¦æ•°å­—è¯ä¹¦éªŒè¯
```

---

## 3. ğŸ†” èº«ä»½æ ‡è¯†idæœºåˆ¶


### 3.1 idçš„ä½œç”¨


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
idå°±æ˜¯**å…·ä½“çš„èº«ä»½ä¿¡æ¯**ï¼Œé…åˆschemeæ¥ç¡®å®š"ä½ æ˜¯è°"ã€‚

```
ç±»æ¯”ç†è§£ï¼š
scheme = éªŒè¯æ–¹å¼ï¼ˆå¦‚ï¼šèº«ä»½è¯éªŒè¯ï¼‰
id = å…·ä½“èº«ä»½ï¼ˆå¦‚ï¼šèº«ä»½è¯å·ç ï¼‰

ç»„åˆæ•ˆæœï¼š
é€šè¿‡èº«ä»½è¯éªŒè¯æ–¹å¼ï¼ŒéªŒè¯èº«ä»½è¯å·ä¸º123456çš„äºº
```

### 3.2 ä¸åŒschemeä¸‹çš„idå«ä¹‰


**ğŸ” å„ç§idè¯¦è§£**

```java
// world scheme - idå›ºå®šä¸º"anyone"
world:anyone:r
// å«ä¹‰ï¼šä»»ä½•äººéƒ½æœ‰è¯»æƒé™

// auth scheme - idä¸ºè®¤è¯ç”¨æˆ·åˆ—è¡¨
auth:user1,user2:rw  
// å«ä¹‰ï¼šå·²è®¤è¯çš„user1å’Œuser2æœ‰è¯»å†™æƒé™

// digest scheme - idä¸º"username:password_hash"
digest:admin:X03MQ1GEUmg5zMON+RJgsNXw4Q0=:cdrwa
// å«ä¹‰ï¼šç”¨æˆ·åadminï¼Œå¯†ç å“ˆå¸ŒåŒ¹é…æ—¶æœ‰å…¨éƒ¨æƒé™

// ip scheme - idä¸ºIPåœ°å€æˆ–ç½‘æ®µ
ip:192.168.1.100:rw
ip:192.168.1.0/24:r
// å«ä¹‰ï¼šç‰¹å®šIPæˆ–ç½‘æ®µçš„è®¿é—®æƒé™
```

### 3.3 idçš„è®¾ç½®æŠ€å·§


**ğŸ’¡ å®ç”¨å»ºè®®**

> **âœ… æœ€ä½³å®è·µ**
> - digestæ¨¡å¼ï¼šä½¿ç”¨å¼ºå¯†ç ï¼Œå®šæœŸæ›´æ¢
> - ipæ¨¡å¼ï¼šç²¾ç¡®æ§åˆ¶IPèŒƒå›´ï¼Œé¿å…è¿‡å®½
> - authæ¨¡å¼ï¼šæ˜ç¡®ç”¨æˆ·åˆ—è¡¨ï¼ŒåŠæ—¶æ¸…ç†æ— æ•ˆç”¨æˆ·

> **âŒ å¸¸è§é”™è¯¯** 
> - ä½¿ç”¨å¼±å¯†ç æˆ–é»˜è®¤å¯†ç 
> - IPèŒƒå›´è®¾ç½®è¿‡å®½ï¼ˆå¦‚0.0.0.0/0ï¼‰
> - å¿˜è®°æ¸…ç†è¿‡æœŸçš„ç”¨æˆ·æƒé™

---

## 4. âš¡ æƒé™ä½permissionè¯¦è§£


### 4.1 æƒé™ä½çš„å«ä¹‰


**ğŸ”¸ äº”ç§åŸºæœ¬æƒé™**

ZooKeeperå®šä¹‰äº†5ç§æ“ä½œæƒé™ï¼Œç”¨å•å­—æ¯è¡¨ç¤ºï¼š

```
æƒé™ä½è¯¦è§£ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ¯ â”‚ è‹±æ–‡å…¨ç§°  â”‚ å…·ä½“å«ä¹‰           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  C   â”‚ Create  â”‚ åˆ›å»ºå­èŠ‚ç‚¹         â”‚
â”‚  D   â”‚ Delete  â”‚ åˆ é™¤å­èŠ‚ç‚¹         â”‚
â”‚  R   â”‚ Read    â”‚ è¯»å–èŠ‚ç‚¹æ•°æ®       â”‚
â”‚  W   â”‚ Write   â”‚ ä¿®æ”¹èŠ‚ç‚¹æ•°æ®       â”‚
â”‚  A   â”‚ Admin   â”‚ ç®¡ç†èŠ‚ç‚¹æƒé™       â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æƒé™çš„å…·ä½“æ“ä½œ


**ğŸ“‹ æƒé™æ“ä½œå¯¹åº”è¡¨**

```java
// C - CREATE æƒé™
create /app/config "some data"     // âœ… éœ€è¦çˆ¶èŠ‚ç‚¹çš„CREATEæƒé™
create /app/config/db "db config"  // âœ… éœ€è¦/app/configçš„CREATEæƒé™

// D - DELETE æƒé™  
delete /app/config/db              // âœ… éœ€è¦çˆ¶èŠ‚ç‚¹(/app/config)çš„DELETEæƒé™

// R - READ æƒé™
get /app/config                    // âœ… éœ€è¦è¯¥èŠ‚ç‚¹çš„READæƒé™
ls /app/config                     // âœ… éœ€è¦è¯¥èŠ‚ç‚¹çš„READæƒé™

// W - WRITE æƒé™
set /app/config "new data"         // âœ… éœ€è¦è¯¥èŠ‚ç‚¹çš„WRITEæƒé™

// A - ADMIN æƒé™
setAcl /app/config world:anyone:r  // âœ… éœ€è¦è¯¥èŠ‚ç‚¹çš„ADMINæƒé™
getAcl /app/config                 // âœ… éœ€è¦è¯¥èŠ‚ç‚¹çš„ADMINæƒé™
```

### 4.3 æƒé™ç»„åˆä½¿ç”¨


**ğŸ¯ å¸¸è§æƒé™ç»„åˆ**

| æƒé™ç»„åˆ | **ä½¿ç”¨åœºæ™¯** | **å…¸å‹åº”ç”¨** |
|---------|-------------|-------------|
| `r` | `åªè¯»è®¿é—®` | `é…ç½®æŸ¥çœ‹ã€ç›‘æ§æ•°æ®` |
| `rw` | `è¯»å†™æ•°æ®` | `åº”ç”¨é…ç½®ã€ç¼“å­˜æ•°æ®` |
| `cdrw` | `å®Œå…¨ç®¡ç†ï¼ˆé™¤æƒé™ï¼‰` | `ä¸šåŠ¡æ•°æ®ç®¡ç†` |
| `cdrwa` | `è¶…çº§ç®¡ç†å‘˜` | `ç³»ç»Ÿç®¡ç†ã€æƒé™ç®¡ç†` |

---

## 5. ğŸŒ worldæƒé™æ¨¡å¼


### 5.1 worldæ¨¡å¼çš„ç‰¹ç‚¹


**ğŸ”¸ æ ¸å¿ƒç†è§£**
worldæ¨¡å¼å°±æ˜¯**å…¬å¼€è®¿é—®**ï¼Œç›¸å½“äº"ä¸ä¸Šé”çš„æŸœå­"ï¼Œä»»ä½•äººéƒ½èƒ½æŒ‰ç…§æŒ‡å®šæƒé™è®¿é—®ã€‚

```
worldæƒé™ç‰¹å¾ï¼š
âœ… æ— éœ€èº«ä»½éªŒè¯
âœ… æ‰€æœ‰å®¢æˆ·ç«¯éƒ½èƒ½è®¿é—®
âœ… idå›ºå®šä¸º"anyone"
âš ï¸ å®‰å…¨æ€§æœ€ä½
```

### 5.2 worldæƒé™çš„è¯­æ³•


**ğŸ“ åŸºæœ¬è¯­æ³•æ ¼å¼**
```bash
# è¯­æ³•ï¼šworld:anyone:æƒé™ä½
setAcl /path world:anyone:æƒé™ä½

# å®ä¾‹
setAcl /public world:anyone:r        # ä»»ä½•äººåªè¯»
setAcl /config world:anyone:rw       # ä»»ä½•äººè¯»å†™
setAcl /temp world:anyone:cdrw       # ä»»ä½•äººå®Œå…¨æ“ä½œ
```

### 5.3 worldæƒé™å®æˆ˜ç¤ºä¾‹


**ğŸ’» å®Œæ•´æ“ä½œç¤ºä¾‹**

```bash
# 1. åˆ›å»ºå…¬å¼€èŠ‚ç‚¹
create /public-info "è¿™æ˜¯å…¬å¼€ä¿¡æ¯"

# 2. è®¾ç½®worldæƒé™ï¼ˆåªè¯»ï¼‰
setAcl /public-info world:anyone:r

# 3. éªŒè¯æƒé™
get /public-info                    # âœ… æˆåŠŸï¼šä»»ä½•äººéƒ½èƒ½è¯»å–
set /public-info "æ–°æ•°æ®"           # âŒ å¤±è´¥ï¼šæ²¡æœ‰å†™å…¥æƒé™

# 4. åˆ›å»ºå…¬å…±é…ç½®èŠ‚ç‚¹
create /app-config "app=myapp"
setAcl /app-config world:anyone:rw

# 5. éªŒè¯è¯»å†™æƒé™
get /app-config                     # âœ… æˆåŠŸï¼šèƒ½è¯»å–
set /app-config "app=newapp"        # âœ… æˆåŠŸï¼šèƒ½ä¿®æ”¹
create /app-config/db "db config"   # âŒ å¤±è´¥ï¼šæ²¡æœ‰åˆ›å»ºæƒé™
```

### 5.4 worldæƒé™çš„åº”ç”¨åœºæ™¯


**ğŸ¯ é€‚ç”¨åœºæ™¯**
```
âœ… é€‚åˆä½¿ç”¨worldæƒé™ï¼š
â€¢ ç³»ç»Ÿå…¬å‘Šä¿¡æ¯
â€¢ å…¬å…±é…ç½®å‚æ•°  
â€¢ ç›‘æ§çŠ¶æ€æ•°æ®
â€¢ ä¸´æ—¶å…±äº«æ•°æ®

âŒ ä¸é€‚åˆä½¿ç”¨worldæƒé™ï¼š
â€¢ ç”¨æˆ·æ•æ„Ÿä¿¡æ¯
â€¢ ç³»ç»Ÿå®‰å…¨é…ç½®
â€¢ ä¸šåŠ¡æ ¸å¿ƒæ•°æ®
â€¢ æƒé™ç®¡ç†ä¿¡æ¯
```

---

## 6. ğŸ” authæƒé™æ¨¡å¼


### 6.1 authæ¨¡å¼çš„å·¥ä½œåŸç†


**ğŸ”¸ æ ¸å¿ƒç†è§£**
authæ¨¡å¼æ˜¯**å·²è®¤è¯ç”¨æˆ·è®¿é—®**ï¼Œå°±åƒ"ä¼šå‘˜åˆ¶ä¿±ä¹éƒ¨"ï¼Œåªæœ‰ç™»å½•çš„ä¼šå‘˜æ‰èƒ½è¿›å…¥ã€‚

```
authæƒé™å·¥ä½œæµç¨‹ï¼š
ç”¨æˆ·è¿æ¥ZK â†’ æ·»åŠ è®¤è¯ä¿¡æ¯ â†’ è®¿é—®è®¾ç½®äº†authæƒé™çš„èŠ‚ç‚¹

å…³é”®ç‚¹ï¼š
â€¢ å®¢æˆ·ç«¯å¿…é¡»å…ˆé€šè¿‡addauthæ·»åŠ è®¤è¯
â€¢ åªæœ‰è®¤è¯è¿‡çš„ç”¨æˆ·æ‰èƒ½è®¿é—®
â€¢ ä¸åŒçš„è®¤è¯ä¿¡æ¯å¯ä»¥è®¾ç½®ä¸åŒæƒé™
```

### 6.2 authæƒé™çš„è®¾ç½®æ–¹å¼


**ğŸ“ åŸºæœ¬æ“ä½œæµç¨‹**

<details>
<summary><b>ğŸ”§ å®Œæ•´æ“ä½œæ­¥éª¤</b></summary>

```bash
# æ­¥éª¤1ï¼šå®¢æˆ·ç«¯æ·»åŠ è®¤è¯ä¿¡æ¯
addauth digest user1:password1

# æ­¥éª¤2ï¼šåˆ›å»ºèŠ‚ç‚¹å¹¶è®¾ç½®authæƒé™
create /secure-data "æ•æ„Ÿä¿¡æ¯"
setAcl /secure-data auth:user1:rw

# æ­¥éª¤3ï¼šéªŒè¯è®¿é—®æƒé™
get /secure-data                    # âœ… æˆåŠŸï¼šå·²è®¤è¯ç”¨æˆ·èƒ½è®¿é—®
```

</details>

### 6.3 authæƒé™å®æˆ˜ç¤ºä¾‹


**ğŸ’» å¤šç”¨æˆ·æƒé™ç®¡ç†**

```bash
# === ç®¡ç†å‘˜æ“ä½œ ===
# 1. ç®¡ç†å‘˜æ·»åŠ è®¤è¯
addauth digest admin:admin123

# 2. åˆ›å»ºç³»ç»Ÿé…ç½®èŠ‚ç‚¹
create /system-config "é‡è¦é…ç½®"
setAcl /system-config auth:admin:cdrwa

# === æ™®é€šç”¨æˆ·æ“ä½œ ===  
# 3. æ™®é€šç”¨æˆ·æ·»åŠ è®¤è¯
addauth digest user1:user123

# 4. åˆ›å»ºç”¨æˆ·æ•°æ®èŠ‚ç‚¹
create /user-data "ç”¨æˆ·æ•°æ®" 
setAcl /user-data auth:user1:rw

# === æƒé™éªŒè¯ ===
# adminç”¨æˆ·è®¿é—®ç³»ç»Ÿé…ç½®
get /system-config                  # âœ… æˆåŠŸ
set /system-config "æ–°é…ç½®"         # âœ… æˆåŠŸ

# user1è®¿é—®ç³»ç»Ÿé…ç½®  
get /system-config                  # âŒ å¤±è´¥ï¼šæƒé™ä¸è¶³
```

### 6.4 authæ¨¡å¼çš„ç‰¹ç‚¹


**ğŸ“Š ä¼˜ç¼ºç‚¹åˆ†æ**

> **âœ… authæ¨¡å¼ä¼˜ç‚¹**
> - æ”¯æŒå¤šç”¨æˆ·ç®¡ç†
> - è®¤è¯ä¿¡æ¯ç›¸å¯¹ç®€å•
> - é€‚åˆå†…éƒ¨ç³»ç»Ÿä½¿ç”¨

> **âš ï¸ authæ¨¡å¼é™åˆ¶**
> - éœ€è¦é¢„å…ˆæ·»åŠ è®¤è¯ä¿¡æ¯
> - å¯†ç ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­
> - é‡æ–°è¿æ¥éœ€è¦é‡æ–°è®¤è¯

---

## 7. ğŸ”‘ digestæƒé™æ¨¡å¼


### 7.1 digestæ¨¡å¼çš„å®‰å…¨æœºåˆ¶


**ğŸ”¸ æ ¸å¿ƒç†è§£**
digestæ¨¡å¼æ˜¯**ç”¨æˆ·å+å¯†ç å“ˆå¸ŒéªŒè¯**ï¼Œå°±åƒé“¶è¡Œçš„"å¯†ç +æŒ‡çº¹"åŒé‡éªŒè¯ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚

```
digestæƒé™å®‰å…¨ç‰¹æ€§ï¼š
ğŸ”’ å¯†ç ç»è¿‡SHA1å“ˆå¸ŒåŠ å¯†å­˜å‚¨
ğŸ”’ ä¼ è¾“è¿‡ç¨‹ä¸­ä¸æš´éœ²æ˜æ–‡å¯†ç 
ğŸ”’ æ”¯æŒç‹¬ç«‹çš„ç”¨æˆ·è´¦å·ä½“ç³»
ğŸ”’ æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥è®¾ç½®ä¸åŒçš„ç”¨æˆ·æƒé™
```

### 7.2 digestæƒé™çš„è®¾ç½®è¯­æ³•


**ğŸ“ è¯­æ³•æ ¼å¼è¯¦è§£**

```bash
# åŸºæœ¬è¯­æ³•
setAcl /path digest:username:password_hash:permissions

# å¯†ç å“ˆå¸Œç”Ÿæˆï¼ˆåœ¨Javaä¸­ï¼‰
String password = "mypassword";
String hash = DigestAuthenticationProvider.generateDigest("user:" + password);
// ç»“æœç±»ä¼¼ï¼šuser:X03MQ1GEUmg5zMON+RJgsNXw4Q0=
```

### 7.3 digestæƒé™å®æˆ˜æ“ä½œ


**ğŸ’» å®Œæ•´ç¤ºä¾‹æ¼”ç¤º**

```bash
# === å‡†å¤‡å·¥ä½œï¼šç”Ÿæˆå¯†ç å“ˆå¸Œ ===
# ä½¿ç”¨ZKè‡ªå¸¦å·¥å…·æˆ–Javaä»£ç ç”Ÿæˆ
# admin:123456 â†’ admin:0DPiKuNIrrVmD8IUCuw1hQxNqZc=

# === è®¾ç½®digestæƒé™ ===
# 1. åˆ›å»ºå—ä¿æŠ¤çš„èŠ‚ç‚¹
create /admin-panel "ç®¡ç†å‘˜é¢æ¿æ•°æ®"

# 2. è®¾ç½®digestæƒé™
setAcl /admin-panel digest:admin:0DPiKuNIrrVmD8IUCuw1hQxNqZc=:cdrwa

# 3. æ™®é€šç”¨æˆ·æ•°æ®
create /user-profile "ç”¨æˆ·èµ„æ–™"  
setAcl /user-profile digest:john:XYZ123Hash=:rw

# === å®¢æˆ·ç«¯è®¿é—® ===
# 4. ç®¡ç†å‘˜å®¢æˆ·ç«¯è®¤è¯
addauth digest admin:123456

# 5. è®¿é—®ç®¡ç†å‘˜æ•°æ®
get /admin-panel                    # âœ… æˆåŠŸï¼šå¯†ç æ­£ç¡®
set /admin-panel "æ–°çš„ç®¡ç†æ•°æ®"     # âœ… æˆåŠŸï¼šæœ‰å†™æƒé™

# 6. å°è¯•è®¿é—®å…¶ä»–ç”¨æˆ·æ•°æ®
get /user-profile                   # âŒ å¤±è´¥ï¼šä¸æ˜¯johnç”¨æˆ·
```

### 7.4 digestæ¨¡å¼çš„å¯†ç å“ˆå¸Œ


**ğŸ” å¯†ç å“ˆå¸Œæœºåˆ¶è¯¦è§£**

```java
// Javaä»£ç ç”Ÿæˆå¯†ç å“ˆå¸Œ
import org.apache.zookeeper.server.auth.DigestAuthenticationProvider;

public class ZKPasswordGenerator {
    public static void main(String[] args) throws Exception {
        String username = "admin";
        String password = "123456";
        
        // ç”Ÿæˆå“ˆå¸Œ
        String hash = DigestAuthenticationProvider
            .generateDigest(username + ":" + password);
        
        System.out.println("å®Œæ•´è®¤è¯å­—ç¬¦ä¸²ï¼š" + hash);
        // è¾“å‡ºï¼šadmin:0DPiKuNIrrVmD8IUCuw1hQxNqZc=
        
        // åœ¨ACLä¸­ä½¿ç”¨
        String acl = "digest:" + hash + ":cdrwa";
        System.out.println("ACLè®¾ç½®ï¼š" + acl);
    }
}
```

### 7.5 digestæƒé™çš„æœ€ä½³å®è·µ


**ğŸ’¡ å®‰å…¨ä½¿ç”¨æŒ‡å—**

> **ğŸ”’ å¯†ç å®‰å…¨**
> - ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
> - å®šæœŸæ›´æ¢å¯†ç 
> - ä¸åŒèŠ‚ç‚¹ä½¿ç”¨ä¸åŒå¯†ç 

> **ğŸ‘¥ ç”¨æˆ·ç®¡ç†**
> - ä¸ºä¸åŒè§’è‰²åˆ›å»ºä¸åŒç”¨æˆ·
> - éµå¾ªæœ€å°æƒé™åŸåˆ™
> - åŠæ—¶åˆ é™¤ä¸å†ä½¿ç”¨çš„ç”¨æˆ·æƒé™

**ğŸ“‹ æƒé™è§„åˆ’ç¤ºä¾‹**

| ç”¨æˆ·ç±»å‹ | **æƒé™èŒƒå›´** | **æ¨èæƒé™** | **åº”ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| `è¶…çº§ç®¡ç†å‘˜` | `æ‰€æœ‰èŠ‚ç‚¹` | `cdrwa` | `ç³»ç»Ÿç»´æŠ¤ã€æƒé™ç®¡ç†` |
| `åº”ç”¨ç®¡ç†å‘˜` | `åº”ç”¨èŠ‚ç‚¹` | `cdrw` | `åº”ç”¨é…ç½®ã€æ•°æ®ç®¡ç†` |
| `åªè¯»ç”¨æˆ·` | `ç‰¹å®šèŠ‚ç‚¹` | `r` | `ç›‘æ§ã€æŸ¥è¯¢` |
| `ä¸šåŠ¡ç”¨æˆ·` | `ä¸šåŠ¡èŠ‚ç‚¹` | `rw` | `ä¸šåŠ¡æ•°æ®è¯»å†™` |

---

## 8. ğŸ¯ ACLå®é™…åº”ç”¨åœºæ™¯


### 8.1 å¾®æœåŠ¡é…ç½®ç®¡ç†


**ğŸ“‹ åœºæ™¯æè¿°**
åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸åŒæœåŠ¡éœ€è¦ä¸åŒçº§åˆ«çš„é…ç½®è®¿é—®æƒé™ã€‚

```
é…ç½®æƒé™æ¶æ„ï¼š
/microservices/
â”œâ”€â”€ /common/              â† world:anyone:r (å…¬å…±é…ç½®)
â”‚   â”œâ”€â”€ /database-url
â”‚   â””â”€â”€ /cache-config
â”œâ”€â”€ /service-a/           â† digest:service-a:hash:rw  
â”‚   â”œâ”€â”€ /api-key
â”‚   â””â”€â”€ /business-config
â””â”€â”€ /admin/               â† digest:admin:hash:cdrwa
    â”œâ”€â”€ /system-config
    â””â”€â”€ /security-settings
```

**ğŸ’» å®ç°ç¤ºä¾‹**

```bash
# 1. å…¬å…±é…ç½®ï¼ˆæ‰€æœ‰æœåŠ¡å¯è¯»ï¼‰
create /microservices/common "å…¬å…±é…ç½®"
setAcl /microservices/common world:anyone:r
create /microservices/common/db-url "mysql://db:3306"

# 2. æœåŠ¡Aä¸“å±é…ç½®
create /microservices/service-a "æœåŠ¡Aé…ç½®"
setAcl /microservices/service-a digest:service-a:ABC123=:rw
create /microservices/service-a/api-key "secret-key-123"

# 3. ç®¡ç†å‘˜é…ç½®
create /microservices/admin "ç®¡ç†å‘˜é…ç½®"  
setAcl /microservices/admin digest:admin:XYZ789=:cdrwa
```

### 8.2 å¤šç§Ÿæˆ·ç³»ç»Ÿæƒé™éš”ç¦»


**ğŸ¢ ç§Ÿæˆ·éš”ç¦»æ–¹æ¡ˆ**

```
ç§Ÿæˆ·æƒé™ç»“æ„ï¼š
/tenants/
â”œâ”€â”€ /tenant-001/          â† digest:tenant001:hash:cdrw
â”‚   â”œâ”€â”€ /users
â”‚   â””â”€â”€ /data  
â”œâ”€â”€ /tenant-002/          â† digest:tenant002:hash:cdrw
â”‚   â”œâ”€â”€ /users
â”‚   â””â”€â”€ /data
â””â”€â”€ /shared/              â† auth:all-tenants:r
    â””â”€â”€ /common-config
```

### 8.3 å¼€å‘ç¯å¢ƒæƒé™åˆ†çº§


**ğŸ”§ ç¯å¢ƒéš”ç¦»ç¤ºä¾‹**

| ç¯å¢ƒ | **è®¿é—®ç”¨æˆ·** | **æƒé™è®¾ç½®** | **å®‰å…¨çº§åˆ«** |
|------|-------------|-------------|-------------|
| `å¼€å‘ç¯å¢ƒ` | `æ‰€æœ‰å¼€å‘è€…` | `world:anyone:cdrw` | `ä½` |
| `æµ‹è¯•ç¯å¢ƒ` | `æµ‹è¯•å›¢é˜Ÿ` | `auth:testers:cdrw` | `ä¸­` |
| `é¢„å‘ç¯å¢ƒ` | `æ ¸å¿ƒå›¢é˜Ÿ` | `digest:senior-dev:hash:rw` | `è¾ƒé«˜` |
| `ç”Ÿäº§ç¯å¢ƒ` | `è¿ç»´å›¢é˜Ÿ` | `digest:ops:hash:r` | `æœ€é«˜` |

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ACLä¸‰è¦ç´ ï¼šscheme(éªŒè¯æ–¹å¼) + id(èº«ä»½æ ‡è¯†) + permission(æƒé™ä½)
ğŸ”¸ æƒé™æ¨¡å¼ï¼šworld(å…¬å¼€) < auth(è®¤è¯) < digest(ç”¨æˆ·å¯†ç ) < x509(è¯ä¹¦)  
ğŸ”¸ æƒé™ä½å«ä¹‰ï¼šCåˆ›å»ºã€Dåˆ é™¤ã€Rè¯»å–ã€Wå†™å…¥ã€Aç®¡ç†
ğŸ”¸ ä½¿ç”¨åŸåˆ™ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œä¸åŒåœºæ™¯é€‰æ‹©åˆé€‚çš„scheme
ğŸ”¸ å®‰å…¨å®è·µï¼šå¼ºå¯†ç ã€å®šæœŸæ›´æ¢ã€æƒé™åˆ†çº§ç®¡ç†
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ schemeé€‰æ‹©ç­–ç•¥**
```
é€‰æ‹©ä¾æ®ï¼š
æ•°æ®æ•æ„Ÿç¨‹åº¦ + è®¿é—®ç”¨æˆ·èŒƒå›´ + å®‰å…¨è¦æ±‚çº§åˆ«

worldï¼šå…¬å¼€æ•°æ®ï¼Œæ— å®‰å…¨è¦æ±‚
authï¼šå†…éƒ¨æ•°æ®ï¼Œéœ€è¦è®¤è¯ä½†ä¸åŒºåˆ†ç”¨æˆ·
digestï¼šç§å¯†æ•°æ®ï¼Œä¸¥æ ¼ç”¨æˆ·åŒºåˆ†
```

**ğŸ”¹ æƒé™è®¾è®¡æ€è·¯**
```
æƒé™è§„åˆ’æ­¥éª¤ï¼š
1. åˆ†ææ•°æ®åˆ†ç±»ï¼ˆå…¬å¼€/å†…éƒ¨/ç§å¯†/æœºå¯†ï¼‰
2. ç¡®å®šç”¨æˆ·è§’è‰²ï¼ˆåŒ¿å/è®¤è¯/ä¸šåŠ¡/ç®¡ç†ï¼‰
3. é€‰æ‹©åˆé€‚schemeï¼ˆworld/auth/digestï¼‰  
4. åˆ†é…æœ€å°å¿…è¦æƒé™ï¼ˆr/rw/cdrw/cdrwaï¼‰
5. å®šæœŸå®¡è®¡å’Œè°ƒæ•´
```

**ğŸ”¹ å¸¸è§é”™è¯¯é¿å…**
```
âŒ è¿‡åº¦ä½¿ç”¨worldæƒé™
âŒ æ‰€æœ‰ç”¨æˆ·ç»™cdrwaæƒé™  
âŒ ä½¿ç”¨å¼±å¯†ç æˆ–é»˜è®¤å¯†ç 
âŒ å¿˜è®°å®šæœŸæ¸…ç†è¿‡æœŸæƒé™
âŒ æƒé™è®¾ç½®è¿‡äºå¤æ‚éš¾ä»¥ç»´æŠ¤
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **é…ç½®ä¸­å¿ƒ**ï¼šä¸åŒç¯å¢ƒä¸åŒæƒé™ï¼Œä¿æŠ¤ç”Ÿäº§é…ç½®
- **æœåŠ¡å‘ç°**ï¼šæœåŠ¡æ³¨å†Œä¿¡æ¯ä¿æŠ¤ï¼Œé˜²æ­¢æ¶æ„æ³¨å†Œ  
- **åˆ†å¸ƒå¼é”**ï¼šé”èµ„æºè®¿é—®æ§åˆ¶ï¼Œé¿å…è¯¯æ“ä½œ
- **å…ƒæ•°æ®ç®¡ç†**ï¼šç³»ç»Ÿå…ƒæ•°æ®ä¿æŠ¤ï¼Œåˆ†çº§è®¿é—®æ§åˆ¶

**ğŸ”§ è¿ç»´å®è·µ**
- **æƒé™å®¡è®¡**ï¼šå®šæœŸæ£€æŸ¥æƒé™è®¾ç½®ï¼Œæ¸…ç†æ— æ•ˆæƒé™
- **åº”æ€¥é¢„æ¡ˆ**ï¼šæƒé™é—®é¢˜çš„å¿«é€Ÿæ¢å¤æ–¹æ¡ˆ
- **ç›‘æ§å‘Šè­¦**ï¼šæƒé™å¼‚å¸¸è®¿é—®çš„ç›‘æ§å’Œå‘Šè­¦
- **æ–‡æ¡£ç®¡ç†**ï¼šæƒé™è®¾ç½®çš„å®Œæ•´æ–‡æ¡£è®°å½•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ACLä¸‰è¦ç´ è¦è®°æ¸…ï¼šschemeã€idã€æƒé™ä½
- worldå¼€æ”¾authè®¤è¯ï¼Œdigestå¯†ç æœ€å®‰å…¨
- æƒé™æœ€å°åŒ–åŸåˆ™ï¼Œå®šæœŸå®¡è®¡ä¿å®‰å…¨
- ä¸šåŠ¡æ•°æ®è¦ä¿æŠ¤ï¼Œåˆç†è§„åˆ’ä¸å‡ºé”™