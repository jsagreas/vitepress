---
title: 8ã€äº‹åŠ¡æ“ä½œä¸åŸå­æ€§
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ZooKeeperäº‹åŠ¡](#1-ä»€ä¹ˆæ˜¯ZooKeeperäº‹åŠ¡)
2. [Multiäº‹åŠ¡æ“ä½œè¯¦è§£](#2-Multiäº‹åŠ¡æ“ä½œè¯¦è§£)
3. [åŸå­æ€§ä¿è¯æœºåˆ¶](#3-åŸå­æ€§ä¿è¯æœºåˆ¶)
4. [äº‹åŠ¡æäº¤ä¸å›æ»š](#4-äº‹åŠ¡æäº¤ä¸å›æ»š)
5. [æ“ä½œåºåˆ—ç®¡ç†](#5-æ“ä½œåºåˆ—ç®¡ç†)
6. [ä¸€è‡´æ€§ä¿è¯å®ç°](#6-ä¸€è‡´æ€§ä¿è¯å®ç°)
7. [å®é™…åº”ç”¨åœºæ™¯](#7-å®é™…åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯ZooKeeperäº‹åŠ¡


### 1.1 äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ**
ç®€å•ç†è§£ï¼Œäº‹åŠ¡å°±åƒé“¶è¡Œè½¬è´¦ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½å‡ºç°ä¸€åŠæˆåŠŸä¸€åŠå¤±è´¥çš„æƒ…å†µã€‚

```
é“¶è¡Œè½¬è´¦ä¾‹å­ï¼š
å¼ ä¸‰è´¦æˆ· -100å…ƒ
æå››è´¦æˆ· +100å…ƒ

è¿™ä¸¤ä¸ªæ“ä½œå¿…é¡»åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥ï¼Œä¸èƒ½å‡ºç°ï¼š
âŒ å¼ ä¸‰æ‰£äº†é’±ï¼Œæå››æ²¡æ”¶åˆ°
âŒ æå››æ”¶åˆ°é’±ï¼Œå¼ ä¸‰æ²¡æ‰£é’±
```

### 1.2 ZooKeeperä¸­çš„äº‹åŠ¡æ¦‚å¿µ


**ZooKeeperäº‹åŠ¡ç‰¹ç‚¹ï¼š**
- ğŸ”¸ **åŸå­æ€§**ï¼šå¤šä¸ªæ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
- ğŸ”¸ **ä¸€è‡´æ€§**ï¼šäº‹åŠ¡æ‰§è¡Œåï¼Œæ•°æ®ä¿æŒä¸€è‡´çŠ¶æ€
- ğŸ”¸ **éš”ç¦»æ€§**ï¼šä¸åŒäº‹åŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹
- ğŸ”¸ **æŒä¹…æ€§**ï¼šäº‹åŠ¡æäº¤åï¼Œç»“æœæ°¸ä¹…ä¿å­˜

::: tip ğŸ’¡ é€šä¿—ç†è§£
æƒ³è±¡ä½ è¦æ¬å®¶ï¼Œéœ€è¦åŒæ—¶åšä¸‰ä»¶äº‹ï¼š
1. æŠŠæ—§æˆ¿å­çš„ä¸œè¥¿æ¬èµ°
2. æŠŠä¸œè¥¿æ”¾åˆ°æ–°æˆ¿å­
3. æ›´æ–°åœ°å€ä¿¡æ¯

è¿™ä¸‰ä»¶äº‹å¿…é¡»å…¨éƒ¨å®Œæˆï¼Œå¦åˆ™å°±ä¼šå‡ºé—®é¢˜ã€‚ZooKeeperçš„äº‹åŠ¡å°±æ˜¯ä¿è¯è¿™ç§"å…¨åšå®Œ"æˆ–"å…¨ä¸åš"çš„æœºåˆ¶ã€‚
:::

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡æ“ä½œ


**è§£å†³çš„é—®é¢˜ï¼š**

```
åœºæ™¯ç¤ºä¾‹ï¼šåˆ†å¸ƒå¼é”çš„é‡Šæ”¾
æ“ä½œ1ï¼šåˆ é™¤é”èŠ‚ç‚¹ /locks/resource1
æ“ä½œ2ï¼šåˆ›å»ºå†å²è®°å½• /history/lock_released
æ“ä½œ3ï¼šæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ /stats/lock_count

å¦‚æœæ²¡æœ‰äº‹åŠ¡ä¿æŠ¤ï¼š
å¯èƒ½åˆ é™¤äº†é”ï¼Œä½†æ²¡åˆ›å»ºå†å²è®°å½• â†’ æ•°æ®ä¸ä¸€è‡´
å¯èƒ½åˆ›å»ºäº†å†å²è®°å½•ï¼Œä½†åˆ é™¤é”å¤±è´¥ â†’ æ­»é”
```

---

## 2. ğŸ› ï¸ Multiäº‹åŠ¡æ“ä½œè¯¦è§£


### 2.1 Multiæ“ä½œæ˜¯ä»€ä¹ˆ


**Multiæ“ä½œå®šä¹‰ï¼š**
Multiæ˜¯ZooKeeperæä¾›çš„æ‰¹é‡æ“ä½œæ¥å£ï¼Œå¯ä»¥å°†å¤šä¸ªå•ç‹¬çš„æ“ä½œæ‰“åŒ…æˆä¸€ä¸ªåŸå­æ€§çš„äº‹åŠ¡ã€‚

```java
// Multiäº‹åŠ¡æ“ä½œç¤ºä¾‹
List<Op> ops = Arrays.asList(
    Op.create("/path1", "data1".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    Op.setData("/path2", "data2".getBytes(), -1),
    Op.delete("/path3", -1)
);

List<OpResult> results = zooKeeper.multi(ops);
```

### 2.2 æ”¯æŒçš„æ“ä½œç±»å‹


**å¯ä»¥åŒ…å«çš„æ“ä½œï¼š** <Badge text="æ ¸å¿ƒ" type="tip"/>

| æ“ä½œç±»å‹ | **è¯´æ˜** | **APIæ–¹æ³•** | **ç”¨é€”ç¤ºä¾‹** |
|---------|---------|------------|-------------|
| ğŸ”¸ **åˆ›å»º** | `åˆ›å»ºæ–°èŠ‚ç‚¹` | `Op.create()` | `åˆ›å»ºé”èŠ‚ç‚¹ã€é…ç½®èŠ‚ç‚¹` |
| ğŸ”¸ **æ›´æ–°** | `ä¿®æ”¹èŠ‚ç‚¹æ•°æ®` | `Op.setData()` | `æ›´æ–°é…ç½®ä¿¡æ¯ã€çŠ¶æ€æ•°æ®` |
| ğŸ”¸ **åˆ é™¤** | `åˆ é™¤èŠ‚ç‚¹` | `Op.delete()` | `é‡Šæ”¾é”ã€æ¸…ç†ä¸´æ—¶æ•°æ®` |
| ğŸ”¸ **æ£€æŸ¥** | `éªŒè¯èŠ‚ç‚¹çŠ¶æ€` | `Op.check()` | `ç¡®ä¿å‰ç½®æ¡ä»¶æ»¡è¶³` |

### 2.3 å®é™…ä»£ç ç¤ºä¾‹


<details>
<summary>ğŸ‘† ç‚¹å‡»å±•å¼€å®Œæ•´çš„Multiäº‹åŠ¡ç¤ºä¾‹ä»£ç </summary>

```java
public class ZooKeeperTransaction {
    private ZooKeeper zk;
    
    // åŸå­æ€§çš„ç”¨æˆ·æ³¨å†Œæ“ä½œ
    public boolean registerUser(String userId, String userData) {
        try {
            List<Op> ops = Arrays.asList(
                // 1. åˆ›å»ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯èŠ‚ç‚¹
                Op.create("/users/" + userId, 
                         userData.getBytes(), 
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                         CreateMode.PERSISTENT),
                
                // 2. åˆ›å»ºç”¨æˆ·é…ç½®èŠ‚ç‚¹
                Op.create("/users/" + userId + "/config", 
                         "{}".getBytes(), 
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                         CreateMode.PERSISTENT),
                
                // 3. æ›´æ–°ç”¨æˆ·è®¡æ•°
                Op.setData("/stats/user_count", 
                          getNewUserCount().getBytes(), -1)
            );
            
            List<OpResult> results = zk.multi(ops);
            System.out.println("âœ… ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼š" + userId);
            return true;
            
        } catch (KeeperException.NodeExistsException e) {
            System.out.println("âŒ ç”¨æˆ·å·²å­˜åœ¨ï¼š" + userId);
            return false;
        } catch (Exception e) {
            System.out.println("âŒ ç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

</details>

### 2.4 Multiæ“ä½œçš„æ‰§è¡Œæµç¨‹


```
å®¢æˆ·ç«¯å‡†å¤‡é˜¶æ®µï¼š
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åˆ›å»ºOpåˆ—è¡¨   â”‚ â† å®šä¹‰è¦æ‰§è¡Œçš„æ“ä½œ
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è°ƒç”¨multi()  â”‚ â† æäº¤äº‹åŠ¡è¯·æ±‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
ZooKeeperæœåŠ¡ç«¯å¤„ç†ï¼š
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ éªŒè¯æ‰€æœ‰æ“ä½œ  â”‚ â† æ£€æŸ¥æƒé™ã€è·¯å¾„ç­‰
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åŸå­æ€§æ‰§è¡Œ   â”‚ â† å…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å›æ»š
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è¿”å›ç»“æœ    â”‚ â† è¿”å›æ¯ä¸ªæ“ä½œçš„ç»“æœ
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. âš–ï¸ åŸå­æ€§ä¿è¯æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯åŸå­æ€§


**åŸå­æ€§çš„å«ä¹‰ï¼š** ğŸŸ¢å…¥é—¨
åŸå­æ€§å°±åƒä¸€ä¸ªä¸å¯åˆ†å‰²çš„åŸå­ä¸€æ ·ï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°éƒ¨åˆ†æ‰§è¡Œçš„æƒ…å†µã€‚

```
åŸå­æ€§ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        äº‹åŠ¡å¼€å§‹              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œ1ï¼šåˆ›å»º /app/config      â”‚ âœ…
â”‚ æ“ä½œ2ï¼šåˆ é™¤ /temp/old_data   â”‚ âœ…
â”‚ æ“ä½œ3ï¼šæ›´æ–° /stats/count     â”‚ âœ…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        äº‹åŠ¡æäº¤              â”‚ â† å…¨éƒ¨æˆåŠŸ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¦‚æœæ“ä½œ3å¤±è´¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        äº‹åŠ¡å¼€å§‹              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œ1ï¼šåˆ›å»º /app/config      â”‚ âŒ å›æ»š
â”‚ æ“ä½œ2ï¼šåˆ é™¤ /temp/old_data   â”‚ âŒ å›æ»š
â”‚ æ“ä½œ3ï¼šæ›´æ–° /stats/count     â”‚ âŒ å¤±è´¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        äº‹åŠ¡å›æ»š              â”‚ â† å…¨éƒ¨æ’¤é”€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ZooKeeperå¦‚ä½•å®ç°åŸå­æ€§


**å®ç°æœºåˆ¶ï¼š** <Badge text="é‡è¦" type="warning"/>

ğŸ”¸ **ä¸¤é˜¶æ®µæäº¤åè®®**
- ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µï¼Œæ£€æŸ¥æ‰€æœ‰æ“ä½œæ˜¯å¦å¯ä»¥æ‰§è¡Œ
- ç¬¬äºŒé˜¶æ®µï¼šæäº¤é˜¶æ®µï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æ”¾å¼ƒ

ğŸ”¸ **äº‹åŠ¡æ—¥å¿—**
- æ‰€æœ‰æ“ä½œå…ˆå†™å…¥äº‹åŠ¡æ—¥å¿—
- åªæœ‰æ—¥å¿—å†™å…¥æˆåŠŸåæ‰æ‰§è¡Œå®é™…æ“ä½œ
- å¤±è´¥æ—¶å¯ä»¥æ ¹æ®æ—¥å¿—è¿›è¡Œæ¢å¤

ğŸ”¸ **å†…å­˜çŠ¶æ€ç®¡ç†**
- åœ¨å†…å­˜ä¸­ç»´æŠ¤äº‹åŠ¡çŠ¶æ€
- äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­é”å®šç›¸å…³èµ„æº
- ç¡®ä¿ä¸ä¼šæœ‰å…¶ä»–æ“ä½œå¹²æ‰°

### 3.3 åŸå­æ€§çš„éªŒè¯


```java
// æµ‹è¯•åŸå­æ€§çš„ç¤ºä¾‹
public void testAtomicity() {
    try {
        List<Op> ops = Arrays.asList(
            Op.create("/test/node1", "data1".getBytes(), 
                     ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
            Op.create("/test/node2", "data2".getBytes(), 
                     ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
            Op.create("/nonexistent/node3", "data3".getBytes(), 
                     ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT) // è¿™ä¸ªä¼šå¤±è´¥
        );
        
        zk.multi(ops); // æ•´ä¸ªäº‹åŠ¡ä¼šå¤±è´¥
        
    } catch (Exception e) {
        // æ£€æŸ¥ç»“æœï¼š/test/node1 å’Œ /test/node2 éƒ½ä¸ä¼šè¢«åˆ›å»º
        System.out.println("âœ… åŸå­æ€§å¾—åˆ°ä¿è¯ï¼šæ²¡æœ‰éƒ¨åˆ†æˆåŠŸçš„æ“ä½œ");
    }
}
```

---

## 4. ğŸ”„ äº‹åŠ¡æäº¤ä¸å›æ»š


### 4.1 äº‹åŠ¡æäº¤è¿‡ç¨‹


**æäº¤çš„è¯¦ç»†æ­¥éª¤ï¼š** ğŸŸ¡è¿›é˜¶

```
æ­¥éª¤ 1ï¸âƒ£ é¢„æ£€æŸ¥é˜¶æ®µ
â”œâ”€â”€ æ£€æŸ¥æ‰€æœ‰æ“ä½œçš„åˆæ³•æ€§
â”œâ”€â”€ éªŒè¯èŠ‚ç‚¹è·¯å¾„æ˜¯å¦æœ‰æ•ˆ
â”œâ”€â”€ æ£€æŸ¥æƒé™æ˜¯å¦è¶³å¤Ÿ
â””â”€â”€ ç¡®è®¤å‰ç½®æ¡ä»¶æ˜¯å¦æ»¡è¶³

æ­¥éª¤ 2ï¸âƒ£ èµ„æºé”å®šé˜¶æ®µ
â”œâ”€â”€ é”å®šæ¶‰åŠçš„æ‰€æœ‰èŠ‚ç‚¹
â”œâ”€â”€ é˜²æ­¢å…¶ä»–æ“ä½œåŒæ—¶ä¿®æ”¹
â””â”€â”€ å‡†å¤‡æ‰§è¡Œç¯å¢ƒ

æ­¥éª¤ 3ï¸âƒ£ æ‰§è¡Œé˜¶æ®µ
â”œâ”€â”€ æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰æ“ä½œ
â”œâ”€â”€ æ›´æ–°å†…å­˜æ•°æ®ç»“æ„
â””â”€â”€ å†™å…¥äº‹åŠ¡æ—¥å¿—

æ­¥éª¤ 4ï¸âƒ£ æäº¤é˜¶æ®µ
â”œâ”€â”€ æŒä¹…åŒ–æ‰€æœ‰æ›´æ”¹
â”œâ”€â”€ é‡Šæ”¾èµ„æºé”
â”œâ”€â”€ é€šçŸ¥å®¢æˆ·ç«¯ç»“æœ
â””â”€â”€ æ¸…ç†äº‹åŠ¡çŠ¶æ€
```

### 4.2 äº‹åŠ¡å›æ»šæœºåˆ¶


**ä»€ä¹ˆæ—¶å€™ä¼šå›æ»šï¼Ÿ**
- â— ä»»ä½•ä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤±è´¥
- â— æƒé™æ£€æŸ¥ä¸é€šè¿‡
- â— ç½‘ç»œè¿æ¥ä¸­æ–­
- â— æœåŠ¡å™¨å¼‚å¸¸

**å›æ»šçš„å®ç°ï¼š**

```
å›æ»šè¿‡ç¨‹ç¤ºæ„ï¼š

äº‹åŠ¡å¼€å§‹æ—¶çš„çŠ¶æ€ï¼š
/app/config: "old_value"
/temp/data: å­˜åœ¨
/stats/count: "100"

æ‰§è¡Œçš„æ“ä½œåºåˆ—ï¼š
æ“ä½œ1: æ›´æ–° /app/config â†’ "new_value" âœ…
æ“ä½œ2: åˆ é™¤ /temp/data âœ…  
æ“ä½œ3: æ›´æ–° /stats/count â†’ "invalid_format" âŒ

å›æ»šåçš„çŠ¶æ€ï¼š
/app/config: "old_value" â† æ¢å¤åŸå€¼
/temp/data: å­˜åœ¨ â† æ¢å¤åˆ é™¤çš„èŠ‚ç‚¹
/stats/count: "100" â† ä¿æŒåŸå€¼
```

### 4.3 å›æ»šä»£ç ç¤ºä¾‹


```java
public class TransactionRollbackExample {
    
    public void demonstrateRollback() {
        try {
            // è®°å½•äº‹åŠ¡å‰çš„çŠ¶æ€
            String originalConfig = new String(zk.getData("/app/config", false, null));
            boolean tempDataExists = zk.exists("/temp/data", false) != null;
            
            List<Op> ops = Arrays.asList(
                Op.setData("/app/config", "new_config".getBytes(), -1),
                Op.delete("/temp/data", -1),
                Op.setData("/nonexistent/path", "data".getBytes(), -1) // è¿™ä¼šå¤±è´¥
            );
            
            zk.multi(ops);
            
        } catch (KeeperException e) {
            System.out.println("âŒ äº‹åŠ¡å¤±è´¥ï¼Œå¼€å§‹éªŒè¯å›æ»šæ•ˆæœ");
            
            // éªŒè¯å›æ»šæ•ˆæœ
            try {
                String currentConfig = new String(zk.getData("/app/config", false, null));
                boolean tempDataStillExists = zk.exists("/temp/data", false) != null;
                
                System.out.println("âœ… é…ç½®æ¢å¤åŸå€¼ï¼š" + currentConfig.equals(originalConfig));
                System.out.println("âœ… ä¸´æ—¶æ•°æ®æœªè¢«åˆ é™¤ï¼š" + tempDataStillExists);
                
            } catch (Exception ex) {
                System.out.println("éªŒè¯å›æ»šæ—¶å‡ºé”™ï¼š" + ex.getMessage());
            }
        }
    }
}
```

---

## 5. ğŸ“‹ æ“ä½œåºåˆ—ç®¡ç†


### 5.1 æ“ä½œåºåˆ—çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆæ“ä½œé¡ºåºå¾ˆé‡è¦ï¼Ÿ** ğŸ’æ ¸å¿ƒ
åœ¨äº‹åŠ¡ä¸­ï¼Œæ“ä½œçš„æ‰§è¡Œé¡ºåºç›´æ¥å½±å“åˆ°ç»“æœçš„æ­£ç¡®æ€§ã€‚å°±åƒåšèœä¸€æ ·ï¼Œå…ˆæ”¾ä»€ä¹ˆåæ”¾ä»€ä¹ˆï¼Œé¡ºåºé”™äº†èœå°±åšåäº†ã€‚

```
é”™è¯¯çš„æ“ä½œé¡ºåºç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œ1ï¼šåˆ é™¤çˆ¶èŠ‚ç‚¹ /app      â”‚ âŒ å…ˆæ‰§è¡Œ
â”‚ æ“ä½œ2ï¼šåˆ›å»ºå­èŠ‚ç‚¹ /app/config â”‚ âŒ åæ‰§è¡Œï¼Œä½†çˆ¶èŠ‚ç‚¹å·²ä¸å­˜åœ¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­£ç¡®çš„æ“ä½œé¡ºåºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œ1ï¼šåˆ›å»ºçˆ¶èŠ‚ç‚¹ /app      â”‚ âœ… å…ˆæ‰§è¡Œ
â”‚ æ“ä½œ2ï¼šåˆ›å»ºå­èŠ‚ç‚¹ /app/config â”‚ âœ… åæ‰§è¡Œï¼Œçˆ¶èŠ‚ç‚¹å­˜åœ¨
â”‚ æ“ä½œ3ï¼šåˆ é™¤æ—§é…ç½® /old/config â”‚ âœ… æœ€åæ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ä¾èµ–å…³ç³»ç®¡ç†


**æ“ä½œé—´çš„ä¾èµ–ç±»å‹ï¼š**

ğŸ”¸ **è·¯å¾„ä¾èµ–**ï¼šå­èŠ‚ç‚¹çš„åˆ›å»ºä¾èµ–çˆ¶èŠ‚ç‚¹çš„å­˜åœ¨
```java
// æ­£ç¡®çš„ä¾èµ–é¡ºåº
List<Op> ops = Arrays.asList(
    Op.create("/users", "".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    Op.create("/users/john", "userdata".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    Op.create("/users/john/profile", "profile".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT)
);
```

ğŸ”¸ **æ•°æ®ä¾èµ–**ï¼šæŸäº›æ“ä½œéœ€è¦åŸºäºå…¶ä»–æ“ä½œçš„ç»“æœ
```java
// è®¡æ•°å™¨çš„åŸå­æ€§æ›´æ–°
List<Op> ops = Arrays.asList(
    Op.create("/events/event_" + eventId, eventData.getBytes(), 
             ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
    Op.setData("/counters/event_count", 
              String.valueOf(currentCount + 1).getBytes(), -1)
);
```

### 5.3 åºåˆ—æ‰§è¡Œçš„ä¿è¯


**ZooKeeperå¦‚ä½•ä¿è¯é¡ºåºï¼Ÿ**

```
æ‰§è¡Œæœºåˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ“ä½œé˜Ÿåˆ—        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ“ä½œ1: åˆ›å»º  â”‚ â”‚ â† æŒ‰é¡ºåºæ’åˆ—
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ æ“ä½œ2: æ›´æ–°  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ æ“ä½œ3: åˆ é™¤  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡ºåºæ‰§è¡Œå¼•æ“    â”‚ â† ä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®é™…åº”ç”¨å»ºè®®ï¼š** âš¡ä¼˜åŒ–å»ºè®®
1. **åˆ›å»ºæ“ä½œåœ¨å‰**ï¼šå…ˆåˆ›å»ºå¿…éœ€çš„çˆ¶èŠ‚ç‚¹
2. **æ›´æ–°æ“ä½œåœ¨ä¸­**ï¼šä¿®æ”¹ç°æœ‰æ•°æ®
3. **åˆ é™¤æ“ä½œåœ¨å**ï¼šæ¸…ç†ä¸éœ€è¦çš„èŠ‚ç‚¹
4. **æ£€æŸ¥æ“ä½œç©¿æ’**ï¼šåœ¨å…³é”®ä½ç½®åŠ å…¥checkæ“ä½œ

---

## 6. ğŸ”’ ä¸€è‡´æ€§ä¿è¯å®ç°


### 6.1 ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§


**ä¸€è‡´æ€§çš„é€šä¿—è§£é‡Šï¼š**
ä¸€è‡´æ€§å°±åƒå›¾ä¹¦é¦†çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œæ— è®ºä»å“ªä¸ªè§’åº¦æŸ¥çœ‹ï¼ˆå€Ÿä¹¦è®°å½•ã€åº“å­˜ç»Ÿè®¡ã€ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œçœ‹åˆ°çš„æ•°æ®éƒ½åº”è¯¥æ˜¯äº’ç›¸å»åˆçš„ã€‚

```
æ•°æ®ä¸€è‡´æ€§ç¤ºä¾‹ï¼š

ç”¨æˆ·å€Ÿä¹¦æ“ä½œéœ€è¦åŒæ—¶æ›´æ–°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“– å›¾ä¹¦åº“å­˜ï¼šã€ŠJavaç¼–ç¨‹ã€‹-1   â”‚
â”‚ ğŸ“‹ å€Ÿä¹¦è®°å½•ï¼š+1æ¡æ–°è®°å½•       â”‚
â”‚ ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯ï¼šå€Ÿä¹¦æ•°é‡+1       â”‚
â”‚ ğŸ“Š ç³»ç»Ÿç»Ÿè®¡ï¼šæ€»å€Ÿä¹¦é‡+1       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿™å››ä¸ªæ•°æ®å¿…é¡»ä¿æŒä¸€è‡´ï¼Œä¸èƒ½å‡ºç°ï¼š
âŒ åº“å­˜å‡å°‘äº†ï¼Œä½†æ²¡æœ‰å€Ÿä¹¦è®°å½•
âŒ æœ‰å€Ÿä¹¦è®°å½•ï¼Œä½†ç”¨æˆ·ä¿¡æ¯æ²¡æ›´æ–°
```

### 6.2 ZooKeeperä¸€è‡´æ€§æœºåˆ¶


**ä¸€è‡´æ€§å®ç°çš„æ ¸å¿ƒæŠ€æœ¯ï¼š** <Badge text="é«˜çº§" type="danger"/>

ğŸ”¸ **å¼ºä¸€è‡´æ€§æ¨¡å‹**
- æ‰€æœ‰å®¢æˆ·ç«¯çœ‹åˆ°çš„æ•°æ®å˜æ›´é¡ºåºå®Œå…¨ä¸€è‡´
- åŸºäºZABåè®®ï¼ˆZooKeeper Atomic Broadcastï¼‰
- ç¡®ä¿äº‹åŠ¡çš„å…¨åºæ‰§è¡Œ

```
ä¸€è‡´æ€§ä¿è¯æµç¨‹ï¼š

LeaderèŠ‚ç‚¹                     FollowerèŠ‚ç‚¹
    â”‚                             â”‚
    â”œâ”€â”€ 1. æ¥æ”¶äº‹åŠ¡è¯·æ±‚              â”‚
    â”‚                             â”‚
    â”œâ”€â”€ 2. åˆ†é…å…¨å±€äº‹åŠ¡ID(ZXID)      â”‚
    â”‚                             â”‚
    â”œâ”€â”€ 3. å‘æ‰€æœ‰Followeræè®® â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                             â”‚
    â”‚ â†â”€â”€â”€â”€â”€â”€â”€ 4. è¿”å›ACKç¡®è®¤ â”€â”€â”€â”€â”€â”€â”¤
    â”‚                             â”‚
    â”œâ”€â”€ 5. æ”¶åˆ°è¿‡åŠæ•°ACKåæäº¤       â”‚
    â”‚                             â”‚
    â”œâ”€â”€ 6. é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹æäº¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                             â”‚
    â””â”€â”€ 7. åº”ç”¨åˆ°çŠ¶æ€æœº             â”œâ”€â”€ åº”ç”¨åˆ°çŠ¶æ€æœº
```

### 6.3 äº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§


**å¤šæ“ä½œä¸€è‡´æ€§ä¿è¯ï¼š**

```java
public class ConsistencyExample {
    
    // è½¬è´¦æ“ä½œï¼šä¿è¯è´¦æˆ·ä¸€è‡´æ€§
    public boolean transferMoney(String fromUser, String toUser, int amount) {
        try {
            // é¦–å…ˆæ£€æŸ¥å½“å‰çŠ¶æ€
            Op checkFrom = Op.check("/accounts/" + fromUser + "/balance", -1);
            Op checkTo = Op.check("/accounts/" + toUser, -1);
            
            // åŸå­æ€§è½¬è´¦æ“ä½œ
            List<Op> ops = Arrays.asList(
                checkFrom,  // ç¡®ä¿æºè´¦æˆ·å­˜åœ¨
                checkTo,    // ç¡®ä¿ç›®æ ‡è´¦æˆ·å­˜åœ¨
                
                Op.setData("/accounts/" + fromUser + "/balance", 
                          String.valueOf(getCurrentBalance(fromUser) - amount).getBytes(), -1),
                          
                Op.setData("/accounts/" + toUser + "/balance", 
                          String.valueOf(getCurrentBalance(toUser) + amount).getBytes(), -1),
                          
                Op.create("/transactions/" + System.currentTimeMillis(), 
                         buildTransactionRecord(fromUser, toUser, amount).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT)
            );
            
            List<OpResult> results = zk.multi(ops);
            System.out.println("âœ… è½¬è´¦æˆåŠŸï¼Œæ•°æ®ä¿æŒä¸€è‡´");
            return true;
            
        } catch (Exception e) {
            System.out.println("âŒ è½¬è´¦å¤±è´¥ï¼Œæ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿æŠ¤ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

### 6.4 ä¸€è‡´æ€§çš„éªŒè¯


**å¦‚ä½•éªŒè¯ä¸€è‡´æ€§ï¼Ÿ** â±ï¸ é¢„è®¡ç†è§£æ—¶é—´ï¼š5åˆ†é’Ÿ

```java
// ä¸€è‡´æ€§éªŒè¯å·¥å…·
public class ConsistencyValidator {
    
    public boolean validateSystemConsistency() {
        try {
            // æ£€æŸ¥ç”¨æˆ·æ€»æ•°
            int userCount = Integer.parseInt(
                new String(zk.getData("/stats/user_count", false, null)));
            
            // å®é™…ç»Ÿè®¡ç”¨æˆ·èŠ‚ç‚¹æ•°é‡
            List<String> users = zk.getChildren("/users", false);
            int actualUserCount = users.size();
            
            // æ£€æŸ¥åº“å­˜æ•°æ®
            int totalBooks = Integer.parseInt(
                new String(zk.getData("/stats/total_books", false, null)));
            
            int availableBooks = Integer.parseInt(
                new String(zk.getData("/stats/available_books", false, null)));
            
            int borrowedBooks = Integer.parseInt(
                new String(zk.getData("/stats/borrowed_books", false, null)));
            
            // éªŒè¯ä¸€è‡´æ€§
            boolean userConsistent = (userCount == actualUserCount);
            boolean bookConsistent = (totalBooks == availableBooks + borrowedBooks);
            
            System.out.println("ğŸ‘¥ ç”¨æˆ·æ•°æ®ä¸€è‡´æ€§ï¼š" + (userConsistent ? "âœ…" : "âŒ"));
            System.out.println("ğŸ“š å›¾ä¹¦æ•°æ®ä¸€è‡´æ€§ï¼š" + (bookConsistent ? "âœ…" : "âŒ"));
            
            return userConsistent && bookConsistent;
            
        } catch (Exception e) {
            System.out.println("éªŒè¯è¿‡ç¨‹å‡ºé”™ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

---

## 7. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 7.1 åˆ†å¸ƒå¼é”çš„å®ç°


**åœºæ™¯è¯´æ˜ï¼š**
åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªæœåŠ¡å®ä¾‹å¯ä»¥æ‰§è¡ŒæŸä¸ªå…³é”®æ“ä½œï¼Œè¿™æ—¶å°±éœ€è¦åˆ†å¸ƒå¼é”ã€‚

```java
public class DistributedLock {
    private ZooKeeper zk;
    private String lockPath;
    
    // åŸå­æ€§è·å–é”
    public boolean acquireLock(String resource, String clientId, int timeoutSeconds) {
        try {
            lockPath = "/locks/" + resource;
            
            List<Op> ops = Arrays.asList(
                // 1. åˆ›å»ºé”èŠ‚ç‚¹
                Op.create(lockPath + "/" + clientId, 
                         (clientId + ":" + System.currentTimeMillis()).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                         CreateMode.EPHEMERAL_SEQUENTIAL),
                         
                // 2. æ›´æ–°é”ç»Ÿè®¡ä¿¡æ¯
                Op.setData("/stats/lock_requests", 
                          String.valueOf(getLockRequestCount() + 1).getBytes(), -1),
                          
                // 3. è®°å½•è·é”å†å²
                Op.create("/history/lock_attempt_" + System.currentTimeMillis(),
                         ("client:" + clientId + ",resource:" + resource).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT)
            );
            
            List<OpResult> results = zk.multi(ops);
            
            // æ£€æŸ¥æ˜¯å¦è·å¾—äº†æœ€å°åºå·ï¼ˆå³è·å¾—äº†é”ï¼‰
            String createdPath = ((OpResult.CreateResult) results.get(0)).getPath();
            return isLowestSequence(createdPath);
            
        } catch (Exception e) {
            System.out.println("è·å–é”å¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
    
    // åŸå­æ€§é‡Šæ”¾é”
    public boolean releaseLock(String clientId) {
        try {
            List<Op> ops = Arrays.asList(
                // 1. åˆ é™¤é”èŠ‚ç‚¹
                Op.delete(lockPath + "/" + clientId + "*", -1),
                
                // 2. æ›´æ–°é‡Šæ”¾ç»Ÿè®¡
                Op.setData("/stats/lock_releases", 
                          String.valueOf(getLockReleaseCount() + 1).getBytes(), -1),
                          
                // 3. è®°å½•é‡Šæ”¾å†å²
                Op.create("/history/lock_release_" + System.currentTimeMillis(),
                         ("client:" + clientId).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT)
            );
            
            zk.multi(ops);
            System.out.println("ğŸ”“ é”é‡Šæ”¾æˆåŠŸ");
            return true;
            
        } catch (Exception e) {
            System.out.println("é‡Šæ”¾é”å¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

### 7.2 é…ç½®ç®¡ç†ç³»ç»Ÿ


**åº”ç”¨åœºæ™¯ï¼š**
å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œéœ€è¦ç»Ÿä¸€ç®¡ç†å’Œæ›´æ–°å¤šä¸ªæœåŠ¡çš„é…ç½®ä¿¡æ¯ã€‚

```java
public class ConfigurationManager {
    
    // åŸå­æ€§æ›´æ–°é…ç½®
    public boolean updateServiceConfig(String serviceName, Map<String, String> newConfig) {
        try {
            String configPath = "/configs/" + serviceName;
            String backupPath = "/configs/backup/" + serviceName + "_" + System.currentTimeMillis();
            
            List<Op> ops = Arrays.asList(
                // 1. å¤‡ä»½å½“å‰é…ç½®
                Op.create(backupPath,
                         getCurrentConfig(serviceName).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT),
                         
                // 2. æ›´æ–°æ–°é…ç½®
                Op.setData(configPath, 
                          serializeConfig(newConfig).getBytes(), -1),
                          
                // 3. æ›´æ–°ç‰ˆæœ¬å·
                Op.setData(configPath + "/version",
                          String.valueOf(getNextVersion(serviceName)).getBytes(), -1),
                          
                // 4. è®°å½•å˜æ›´å†å²
                Op.create("/audit/config_change_" + System.currentTimeMillis(),
                         buildChangeLog(serviceName, newConfig).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT)
            );
            
            zk.multi(ops);
            System.out.println("âš™ï¸ æœåŠ¡é…ç½®æ›´æ–°æˆåŠŸï¼š" + serviceName);
            return true;
            
        } catch (Exception e) {
            System.out.println("é…ç½®æ›´æ–°å¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

### 7.3 æœåŠ¡æ³¨å†Œå‘ç°


**åœºæ™¯æè¿°ï¼š**
å¾®æœåŠ¡å¯åŠ¨æ—¶éœ€è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼ŒåŒæ—¶æ›´æ–°ç›¸å…³çš„ç»Ÿè®¡å’Œç´¢å¼•ä¿¡æ¯ã€‚

<details>
<summary>ğŸ‘† å±•å¼€æœåŠ¡æ³¨å†Œçš„å®Œæ•´å®ç°</summary>

```java
public class ServiceRegistry {
    
    public boolean registerService(ServiceInfo serviceInfo) {
        try {
            String serviceName = serviceInfo.getName();
            String serviceId = serviceInfo.getId();
            String servicePath = "/services/" + serviceName + "/" + serviceId;
            
            List<Op> ops = Arrays.asList(
                // 1. æ³¨å†ŒæœåŠ¡å®ä¾‹
                Op.create(servicePath,
                         serviceInfo.toJson().getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                         CreateMode.EPHEMERAL), // ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿æ¥æ–­å¼€è‡ªåŠ¨åˆ é™¤
                         
                // 2. æ›´æ–°æœåŠ¡å®ä¾‹è®¡æ•°
                Op.setData("/stats/services/" + serviceName + "/count",
                          String.valueOf(getServiceInstanceCount(serviceName) + 1).getBytes(), -1),
                          
                // 3. æ·»åŠ åˆ°è´Ÿè½½å‡è¡¡åˆ—è¡¨
                Op.create("/loadbalancer/" + serviceName + "/" + serviceId,
                         serviceInfo.getEndpoint().getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL),
                         
                // 4. è®°å½•æ³¨å†Œäº‹ä»¶
                Op.create("/events/service_register_" + System.currentTimeMillis(),
                         buildRegistrationEvent(serviceInfo).getBytes(),
                         ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT)
            );
            
            List<OpResult> results = zk.multi(ops);
            
            // æ³¨å†ŒæˆåŠŸåçš„åç»­å¤„ç†
            notifyServiceDiscovery(serviceName);
            updateHealthCheck(serviceId);
            
            System.out.println("ğŸ¯ æœåŠ¡æ³¨å†ŒæˆåŠŸï¼š" + serviceName + "/" + serviceId);
            return true;
            
        } catch (KeeperException.NodeExistsException e) {
            System.out.println("âš ï¸ æœåŠ¡å®ä¾‹å·²å­˜åœ¨ï¼š" + serviceInfo.getId());
            return false;
        } catch (Exception e) {
            System.out.println("âŒ æœåŠ¡æ³¨å†Œå¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

</details>

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡æ¦‚å¿µï¼šå¤šä¸ªæ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥çš„æœºåˆ¶
ğŸ”¸ Multiæ“ä½œï¼šZooKeeperæä¾›çš„æ‰¹é‡åŸå­æ“ä½œæ¥å£
ğŸ”¸ åŸå­æ€§ä¿è¯ï¼šé€šè¿‡ä¸¤é˜¶æ®µæäº¤å’Œäº‹åŠ¡æ—¥å¿—å®ç°
ğŸ”¸ æ“ä½œåºåˆ—ï¼šäº‹åŠ¡ä¸­æ“ä½œçš„æ‰§è¡Œé¡ºåºå¾ˆå…³é”®
ğŸ”¸ ä¸€è‡´æ€§å®ç°ï¼šåŸºäºZABåè®®ä¿è¯æ•°æ®ä¸€è‡´æ€§
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‹åŠ¡çš„ä»·å€¼**
```
è§£å†³çš„é—®é¢˜ï¼š
â€¢ é¿å…æ•°æ®ä¸ä¸€è‡´
â€¢ é˜²æ­¢éƒ¨åˆ†æ“ä½œæˆåŠŸå¯¼è‡´çš„ç³»ç»Ÿå¼‚å¸¸
â€¢ æä¾›å¯é çš„æ‰¹é‡æ“ä½œèƒ½åŠ›
â€¢ ç®€åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤æ‚é€»è¾‘

é€‚ç”¨åœºæ™¯ï¼š
â€¢ åˆ†å¸ƒå¼é”çš„è·å–å’Œé‡Šæ”¾
â€¢ æœåŠ¡æ³¨å†Œå’Œå‘ç°
â€¢ é…ç½®ç®¡ç†å’Œæ›´æ–°
â€¢ æ•°æ®è¿ç§»å’Œæ¸…ç†
```

**ğŸ”¹ åŸå­æ€§çš„é‡è¦æ€§** ğŸ”¥é«˜é¢‘è€ƒç‚¹
```
åŸå­æ€§ = ä¸å¯åˆ†å‰²æ€§
â€¢ äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½
â€¢ è¦ä¹ˆå®Œæ•´æ‰§è¡Œï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œ
â€¢ ä¸å­˜åœ¨"éƒ¨åˆ†æˆåŠŸ"çš„ä¸­é—´çŠ¶æ€
â€¢ é€šè¿‡å›æ»šæœºåˆ¶ä¿è¯æ•°æ®å®Œæ•´æ€§
```

**ğŸ”¹ ä¸€è‡´æ€§ä¿è¯æœºåˆ¶**
```
æŠ€æœ¯å®ç°ï¼š
â€¢ ZABåè®®ç¡®ä¿å…¨å±€é¡ºåºä¸€è‡´
â€¢ äº‹åŠ¡æ—¥å¿—è®°å½•æ‰€æœ‰å˜æ›´
â€¢ ä¸¤é˜¶æ®µæäº¤ä¿è¯åŸå­æ€§
â€¢ å¼ºä¸€è‡´æ€§æ¨¡å‹é¿å…æ•°æ®å†²çª
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¯ æœ€ä½³å®è·µï¼š**
1. **æ“ä½œé¡ºåºè§„åˆ’**ï¼šå…ˆåˆ›å»ºååˆ é™¤ï¼Œé¿å…ä¾èµ–é—®é¢˜
2. **å¼‚å¸¸å¤„ç†**ï¼šæ€»æ˜¯å‡†å¤‡å¥½å¤„ç†äº‹åŠ¡å¤±è´¥çš„æƒ…å†µ
3. **æ€§èƒ½è€ƒè™‘**ï¼šäº‹åŠ¡æ“ä½œæ¯”å•ç‹¬æ“ä½œæ…¢ï¼Œä¸è¦æ»¥ç”¨
4. **ç›‘æ§æ—¥å¿—**ï¼šè®°å½•äº‹åŠ¡æ‰§è¡Œæƒ…å†µï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

**âš ï¸ å¸¸è§é”™è¯¯ï¼š**
- âŒ åœ¨äº‹åŠ¡ä¸­åŒ…å«å¤ªå¤šæ— å…³æ“ä½œ
- âŒ å¿½ç•¥æ“ä½œé—´çš„ä¾èµ–å…³ç³»
- âŒ æ²¡æœ‰properçš„å¼‚å¸¸å¤„ç†
- âŒ è¿‡åº¦ä½¿ç”¨äº‹åŠ¡å½±å“æ€§èƒ½

### 8.4 æ€§èƒ½è€ƒè™‘


| æ“ä½œç±»å‹ | **å“åº”æ—¶é—´** | **é€‚ç”¨åœºæ™¯** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| ğŸ”¸ **å•æ“ä½œ** | `1-3ms` | `ç®€å•çš„CRUDæ“ä½œ` | `å“åº”å¿«ï¼Œä½†ä¸ä¿è¯åŸå­æ€§` |
| ğŸ”¸ **Multiäº‹åŠ¡** | `5-15ms` | `éœ€è¦åŸå­æ€§çš„æ‰¹é‡æ“ä½œ` | `å“åº”ç¨æ…¢ï¼Œä½†ä¿è¯ä¸€è‡´æ€§` |
| ğŸ”¸ **å¤§äº‹åŠ¡** | `>20ms` | `å¤æ‚çš„ä¸šåŠ¡é€»è¾‘` | `å½±å“æ€§èƒ½ï¼Œè°¨æ…ä½¿ç”¨` |

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
- äº‹åŠ¡åŸå­ä¸å¯åˆ†ï¼Œè¦ä¹ˆå…¨æˆè¦ä¹ˆå…¨ä¸æˆ
- Multiæ“ä½œæ˜¯å…³é”®ï¼Œå¤šä¸ªåŠ¨ä½œæ‰“åŒ…åš
- é¡ºåºä¾èµ–è¦è€ƒè™‘ï¼Œå…ˆå»ºååˆ ä¸å‡ºé”™
- ä¸€è‡´ä¿è¯é åè®®ï¼ŒZABç¡®ä¿æ•°æ®åŒæ­¥
- å®é™…åº”ç”¨åœºæ™¯å¤šï¼Œé”å’Œé…ç½®æœ€å¸¸è§