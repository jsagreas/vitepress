---
title: 4ã€å®¹å™¨åŒ–éƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [å®¹å™¨åŒ–éƒ¨ç½²æ¦‚è¿°](#1-å®¹å™¨åŒ–éƒ¨ç½²æ¦‚è¿°)
2. [Dockerå®¹å™¨éƒ¨ç½²å®æˆ˜](#2-Dockerå®¹å™¨éƒ¨ç½²å®æˆ˜)
3. [é•œåƒç®¡ç†ä¸æ¨é€æ‹‰å–](#3-é•œåƒç®¡ç†ä¸æ¨é€æ‹‰å–)
4. [KubernetesåŸºç¡€éƒ¨ç½²](#4-KubernetesåŸºç¡€éƒ¨ç½²)
5. [Helmå›¾è¡¨ä½¿ç”¨è¯¦è§£](#5-Helmå›¾è¡¨ä½¿ç”¨è¯¦è§£)
6. [å®¹å™¨ç¼–æ’é…ç½®å®è·µ](#6-å®¹å™¨ç¼–æ’é…ç½®å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–éƒ¨ç½²


**ç®€å•ç†è§£**ï¼šå°±åƒæŠŠä½ çš„åº”ç”¨ç¨‹åºè¿åŒå®ƒéœ€è¦çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ‰“åŒ…åœ¨ä¸€ä¸ª"ç®±å­"é‡Œï¼Œè¿™ä¸ªç®±å­å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ‰“å¼€è¿è¡Œã€‚

```
ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ï¼š
å¼€å‘ç¯å¢ƒ âœ… â†’ æµ‹è¯•ç¯å¢ƒ âŒ â†’ ç”Ÿäº§ç¯å¢ƒ â“
"åœ¨æˆ‘ç”µè„‘ä¸Šèƒ½è·‘å•Šï¼"

å®¹å™¨åŒ–éƒ¨ç½²ï¼š
å¼€å‘ç¯å¢ƒ âœ… â†’ æµ‹è¯•ç¯å¢ƒ âœ… â†’ ç”Ÿäº§ç¯å¢ƒ âœ…  
"åˆ°å“ªé‡Œéƒ½èƒ½è·‘ï¼"
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**
- **å®¹å™¨**ï¼šè£…åº”ç”¨çš„"ç›’å­"ï¼ŒåŒ…å«åº”ç”¨+è¿è¡Œç¯å¢ƒ
- **é•œåƒ**ï¼šåˆ¶ä½œå®¹å™¨çš„"æ¨¡æ¿"ï¼Œå°±åƒé¥¼å¹²æ¨¡å…·
- **å®¹å™¨åŒ–**ï¼šæŠŠåº”ç”¨æ‰“åŒ…æˆå®¹å™¨çš„è¿‡ç¨‹
- **éƒ¨ç½²**ï¼šæŠŠæ‰“åŒ…å¥½çš„å®¹å™¨æ”¾åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œ

### 1.2 ä¸ºä»€ä¹ˆè¦å®¹å™¨åŒ–éƒ¨ç½²


**ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”**

| ä¼ ç»Ÿéƒ¨ç½²é—®é¢˜ | å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆ | **å®é™…å¥½å¤„** |
|------------|------------|-----------|
| `ç¯å¢ƒä¸ä¸€è‡´` | `ç»Ÿä¸€è¿è¡Œç¯å¢ƒ` | `å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§å®Œå…¨ä¸€æ ·` |
| `éƒ¨ç½²å¤æ‚` | `ä¸€é”®éƒ¨ç½²` | `docker run å°±èƒ½å¯åŠ¨` |
| `èµ„æºæµªè´¹` | `è½»é‡çº§éš”ç¦»` | `ä¸€å°æœåŠ¡å™¨è·‘å¤šä¸ªåº”ç”¨` |
| `æ‰©å±•å›°éš¾` | `å¿«é€Ÿæ‰©ç¼©å®¹` | `ç§’çº§å¯åŠ¨æ–°å®ä¾‹` |

### 1.3 GitLab CI/CDä¸­çš„å®¹å™¨åŒ–æµç¨‹


```
ä»£ç æäº¤ â†’ æ„å»ºé•œåƒ â†’ æ¨é€ä»“åº“ â†’ éƒ¨ç½²è¿è¡Œ

è¯¦ç»†æµç¨‹ï¼š
å¼€å‘è€…æäº¤ä»£ç 
     â†“
GitLab Runneræ„å»ºDockeré•œåƒ
     â†“  
æ¨é€åˆ°Container Registry  
     â†“
æ‹‰å–é•œåƒåˆ°ç›®æ ‡ç¯å¢ƒ
     â†“
å¯åŠ¨å®¹å™¨è¿è¡Œåº”ç”¨
```

---

## 2. ğŸ‹ Dockerå®¹å™¨éƒ¨ç½²å®æˆ˜


### 2.1 DockeråŸºç¡€æ¦‚å¿µé€šä¿—è§£é‡Š


**Dockeræ˜¯ä»€ä¹ˆ**ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼š
- **Docker** = è£…è´§çš„æ ‡å‡†é›†è£…ç®±ç³»ç»Ÿ
- **é•œåƒ** = é›†è£…ç®±çš„è®¾è®¡å›¾çº¸
- **å®¹å™¨** = æ ¹æ®å›¾çº¸åˆ¶ä½œçš„å®é™…é›†è£…ç®±
- **ä»“åº“** = å­˜æ”¾é›†è£…ç®±çš„ç å¤´

### 2.2 ç¼–å†™Dockerfile


**Dockerfile**å°±æ˜¯å‘Šè¯‰Dockerå¦‚ä½•æ‰“åŒ…ä½ åº”ç”¨çš„"è¯´æ˜ä¹¦"

```dockerfile
# åŸºç¡€é•œåƒï¼ˆå°±åƒé€‰æ‹©æˆ¿å­çš„åœ°åŸºï¼‰
FROM node:16-alpine

# è®¾ç½®å·¥ä½œç›®å½•ï¼ˆåœ¨å®¹å™¨é‡Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼‰
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼ˆå…ˆå¤åˆ¶package.jsonï¼Œåˆ©ç”¨ç¼“å­˜æœºåˆ¶ï¼‰
COPY package*.json ./

# å®‰è£…ä¾èµ–ï¼ˆå°±åƒè£…ä¿®æˆ¿å­éœ€è¦çš„ææ–™ï¼‰
RUN npm ci --only=production

# å¤åˆ¶åº”ç”¨ä»£ç ï¼ˆæŠŠä½ çš„ä»£ç æ¬è¿›å»ï¼‰
COPY . .

# æš´éœ²ç«¯å£ï¼ˆå‘Šè¯‰å¤–ç•Œä»å“ªä¸ªé—¨è¿›å…¥ï¼‰
EXPOSE 3000

# å¯åŠ¨å‘½ä»¤ï¼ˆå‘Šè¯‰å®¹å™¨å¯åŠ¨æ—¶è¦åšä»€ä¹ˆï¼‰
CMD ["npm", "start"]
```

**ğŸ”¸ æ¯ä¸€æ­¥çš„å«ä¹‰**ï¼š
- `FROM`ï¼šé€‰æ‹©åŸºç¡€ç¯å¢ƒï¼ˆå°±åƒé€‰æ‹©æ¯›å¯æˆ¿ï¼‰
- `WORKDIR`ï¼šè®¾ç½®å·¥ä½œæ–‡ä»¶å¤¹
- `COPY`ï¼šæŠŠæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨é‡Œ
- `RUN`ï¼šåœ¨æ„å»ºæ—¶æ‰§è¡Œå‘½ä»¤
- `EXPOSE`ï¼šå£°æ˜ç«¯å£ï¼ˆä¸æ˜¯çœŸæ­£å¼€æ”¾ï¼‰
- `CMD`ï¼šå®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤

### 2.3 GitLab CIä¸­çš„Dockeræ„å»º


```yaml
# .gitlab-ci.yml
stages:
  - build
  - deploy

variables:
  # é•œåƒåç§°ï¼ˆé¡¹ç›®å:ç‰ˆæœ¬å·ï¼‰
  IMAGE_NAME: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
  
build-docker:
  stage: build
  # ä½¿ç”¨Docker-in-DockeræœåŠ¡
  services:
    - docker:dind
  image: docker:latest
  before_script:
    # ç™»å½•åˆ°GitLabå®¹å™¨ä»“åº“
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    # æ„å»ºé•œåƒ
    - docker build -t $IMAGE_NAME .
    # æ¨é€åˆ°ä»“åº“
    - docker push $IMAGE_NAME
  only:
    - main
```

**ğŸ’¡ å…³é”®æ¦‚å¿µè§£é‡Š**ï¼š
- `docker:dind`ï¼šDocker-in-Dockerï¼Œè®©CIç¯å¢ƒé‡Œèƒ½ç”¨Docker
- `$CI_REGISTRY_IMAGE`ï¼šGitLabè‡ªåŠ¨æä¾›çš„ä»“åº“åœ°å€
- `$CI_COMMIT_SHA`ï¼šå½“å‰æäº¤çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨ä½œç‰ˆæœ¬å·

---

## 3. ğŸ“¦ é•œåƒç®¡ç†ä¸æ¨é€æ‹‰å–


### 3.1 GitLab Container Registry


**ä»€ä¹ˆæ˜¯Container Registry**ï¼Ÿ
å°±åƒæ˜¯ä¸“é—¨å­˜æ”¾Dockeré•œåƒçš„"ä»“åº“"ï¼Œç±»ä¼¼äºï¼š
- **GitHub** å­˜ä»£ç 
- **npm** å­˜JavaScriptåŒ…  
- **Container Registry** å­˜Dockeré•œåƒ

### 3.2 é•œåƒç‰ˆæœ¬ç®¡ç†ç­–ç•¥


**ğŸ·ï¸ å¸¸è§æ ‡ç­¾ç­–ç•¥**

```yaml
# å¤šæ ‡ç­¾æ¨é€ç­–ç•¥
script:
  # ä½¿ç”¨æäº¤SHAä½œä¸ºå”¯ä¸€æ ‡è¯†
  - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
  # æœ€æ–°ç‰ˆæœ¬æ ‡ç­¾
  - docker tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA $CI_REGISTRY_IMAGE:latest
  # åˆ†æ”¯æ ‡ç­¾
  - docker tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG
  
  # æ¨é€æ‰€æœ‰æ ‡ç­¾
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
  - docker push $CI_REGISTRY_IMAGE:latest
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG
```

**ğŸ“‹ æ ‡ç­¾å«ä¹‰è¯´æ˜**ï¼š
- `latest`ï¼šæœ€æ–°ç‰ˆæœ¬ï¼ˆâš ï¸ ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ç”¨ï¼‰
- `$CI_COMMIT_SHA`ï¼šç²¾ç¡®ç‰ˆæœ¬ï¼Œå¯è¿½æº¯
- `$CI_COMMIT_REF_SLUG`ï¼šåˆ†æ”¯åï¼Œä¾¿äºæµ‹è¯•

### 3.3 é•œåƒæ¸…ç†ä¸ä¼˜åŒ–


**ğŸ”§ è‡ªåŠ¨æ¸…ç†ç­–ç•¥**

```yaml
cleanup-old-images:
  stage: cleanup
  image: alpine:latest
  before_script:
    - apk add --no-cache curl jq
  script:
    # ä¿ç•™æœ€è¿‘10ä¸ªç‰ˆæœ¬ï¼Œåˆ é™¤å…¶ä»–
    - |
      TAGS=$(curl -s -H "PRIVATE-TOKEN: $CI_JOB_TOKEN" \
        "$CI_API_V4_URL/projects/$CI_PROJECT_ID/registry/repositories" | \
        jq -r '.[].id')
      # æ¸…ç†é€»è¾‘...
  when: manual
  only:
    - schedules
```

**ğŸ’¡ é•œåƒä¼˜åŒ–æŠ€å·§**ï¼š
- ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒï¼ˆå¦‚`alpine`ï¼‰
- å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å°
- `.dockerignore`æ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶

---

## 4. â˜¸ï¸ KubernetesåŸºç¡€éƒ¨ç½²


### 4.1 Kubernetesæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šKubernetesï¼ˆç®€ç§°K8sï¼‰å°±åƒä¸€ä¸ªè¶…çº§èªæ˜çš„"å®¹å™¨ç®¡å®¶"ï¼Œèƒ½å¤Ÿï¼š
- ğŸ  **ç®¡ç†ä½æˆ¿**ï¼šå†³å®šå®¹å™¨ä½åœ¨å“ªå°æœåŠ¡å™¨
- ğŸ”„ **è‡ªåŠ¨ä¿®å¤**ï¼šå®¹å™¨æŒ‚äº†è‡ªåŠ¨é‡å¯
- ğŸ“ˆ **å¼¹æ€§æ‰©å±•**ï¼šè®¿é—®é‡å¤§äº†è‡ªåŠ¨å¢åŠ å®¹å™¨
- ğŸŒ **è´Ÿè½½å‡è¡¡**ï¼šåˆç†åˆ†é…è®¿é—®æµé‡

### 4.2 K8sæ ¸å¿ƒæ¦‚å¿µ


```
K8sé›†ç¾¤æ¶æ„ï¼š
                   MasterèŠ‚ç‚¹ï¼ˆå¤§è„‘ï¼‰
                       |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    |                                     |
 WorkerèŠ‚ç‚¹1                          WorkerèŠ‚ç‚¹2
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Pod1    â”‚                         â”‚ Pod3    â”‚
 â”‚ Pod2    â”‚                         â”‚ Pod4    â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ æ ¸å¿ƒç»„ä»¶è§£é‡Š**ï¼š
- **Pod**ï¼šæœ€å°éƒ¨ç½²å•å…ƒï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨
- **Service**ï¼šä¸ºPodæä¾›ç¨³å®šçš„ç½‘ç»œè®¿é—®
- **Deployment**ï¼šç®¡ç†Podçš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤
- **Namespace**ï¼šèµ„æºéš”ç¦»ï¼Œå°±åƒä¸åŒçš„æˆ¿é—´

### 4.3 éƒ¨ç½²é…ç½®æ–‡ä»¶


**deployment.yaml**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app
  namespace: production
spec:
  # è¿è¡Œ3ä¸ªå‰¯æœ¬
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: app-container
        image: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
        ports:
        - containerPort: 3000
        # å¥åº·æ£€æŸ¥
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
        # èµ„æºé™åˆ¶
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "256Mi"
            cpu: "200m"
```

**service.yaml**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-app-service
spec:
  selector:
    app: my-app
  ports:
  - port: 80
    targetPort: 3000
  type: LoadBalancer
```

### 4.4 GitLab CIä¸­çš„K8séƒ¨ç½²


```yaml
deploy-k8s:
  stage: deploy
  image: bitnami/kubectl:latest
  before_script:
    # é…ç½®kubectlè¿æ¥K8sé›†ç¾¤
    - kubectl config use-context $KUBE_CONTEXT
  script:
    # æ›¿æ¢é•œåƒç‰ˆæœ¬
    - sed -i "s|IMAGE_TAG|$CI_COMMIT_SHA|g" k8s/deployment.yaml
    # åº”ç”¨é…ç½®
    - kubectl apply -f k8s/
    # ç­‰å¾…éƒ¨ç½²å®Œæˆ
    - kubectl rollout status deployment/my-app -n production
  environment:
    name: production
    url: https://my-app.example.com
  only:
    - main
```

---

## 5. âš“ Helmå›¾è¡¨ä½¿ç”¨è¯¦è§£


### 5.1 Helmæ˜¯ä»€ä¹ˆ


**Helm**å°±åƒæ˜¯Kubernetesçš„"è½¯ä»¶åŒ…ç®¡ç†å™¨"ï¼Œç±»ä¼¼äºï¼š
- **npm** å¯¹äºNode.js
- **pip** å¯¹äºPython
- **Helm** å¯¹äºKubernetes

**ğŸ¯ Helmè§£å†³çš„é—®é¢˜**ï¼š
```
æ²¡æœ‰Helmï¼š
éœ€è¦ç®¡ç†å¾ˆå¤šYAMLæ–‡ä»¶ï¼Œé…ç½®å¤æ‚ï¼Œç‰ˆæœ¬æ··ä¹±

æœ‰äº†Helmï¼š
ä¸€ä¸ªå‘½ä»¤å®‰è£…æ•´å¥—åº”ç”¨ï¼Œé…ç½®ç»Ÿä¸€ï¼Œç‰ˆæœ¬æ¸…æ™°
```

### 5.2 Helm Chartç»“æ„


```
my-app-chart/
â”œâ”€â”€ Chart.yaml          # Chartå…ƒä¿¡æ¯
â”œâ”€â”€ values.yaml         # é»˜è®¤é…ç½®å€¼
â”œâ”€â”€ charts/             # ä¾èµ–çš„charts
â””â”€â”€ templates/          # K8sèµ„æºæ¨¡æ¿
    â”œâ”€â”€ deployment.yaml
    â”œâ”€â”€ service.yaml
    â”œâ”€â”€ ingress.yaml
    â””â”€â”€ _helpers.tpl    # æ¨¡æ¿è¾…åŠ©å‡½æ•°
```

**Chart.yaml**
```yaml
apiVersion: v2
name: my-app
description: æˆ‘çš„åº”ç”¨Helm Chart
version: 1.0.0
appVersion: "1.0"
```

**values.yaml**
```yaml
# åº”ç”¨é…ç½®
app:
  name: my-app
  version: latest

# å‰¯æœ¬æ•°é‡
replicaCount: 3

# é•œåƒé…ç½®
image:
  repository: registry.gitlab.com/mygroup/my-app
  tag: latest
  pullPolicy: IfNotPresent

# æœåŠ¡é…ç½®
service:
  type: ClusterIP
  port: 80
  targetPort: 3000

# åŸŸåé…ç½®
ingress:
  enabled: true
  host: my-app.example.com
```

### 5.3 æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹


**templates/deployment.yaml**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Values.app.name }}
  labels:
    app: {{ .Values.app.name }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ .Values.app.name }}
  template:
    metadata:
      labels:
        app: {{ .Values.app.name }}
    spec:
      containers:
      - name: {{ .Values.app.name }}
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
        ports:
        - containerPort: {{ .Values.service.targetPort }}
```

**ğŸ’¡ æ¨¡æ¿è¯­æ³•è§£é‡Š**ï¼š
- `{{ .Values.xxx }}`ï¼šå¼•ç”¨values.yamlä¸­çš„å€¼
- `{{ .Chart.Name }}`ï¼šå¼•ç”¨Chartåç§°
- `{{ .Release.Name }}`ï¼šå¼•ç”¨å‘å¸ƒåç§°

### 5.4 GitLab CIä¸­ä½¿ç”¨Helm


```yaml
variables:
  HELM_CHART_PATH: "./helm-chart"
  
deploy-helm:
  stage: deploy
  image: alpine/helm:latest
  before_script:
    # æ·»åŠ Helmä»“åº“
    - helm repo add stable https://charts.helm.sh/stable
    - helm repo update
  script:
    # æ£€æŸ¥Chartè¯­æ³•
    - helm lint $HELM_CHART_PATH
    # éƒ¨ç½²æˆ–å‡çº§
    - |
      helm upgrade --install my-app $HELM_CHART_PATH \
        --namespace production \
        --create-namespace \
        --set image.tag=$CI_COMMIT_SHA \
        --set image.repository=$CI_REGISTRY_IMAGE \
        --wait --timeout=5m
  environment:
    name: production
  only:
    - main
```

**ğŸ”§ Helméƒ¨ç½²ä¼˜åŠ¿**ï¼š
- âœ… **ä¸€é”®å®‰è£…**ï¼š`helm install` éƒ¨ç½²æ•´å¥—åº”ç”¨
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼š`helm rollback` å¿«é€Ÿå›æ»š
- âœ… **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®
- âœ… **ä¾èµ–ç®¡ç†**ï¼šè‡ªåŠ¨å¤„ç†ç»„ä»¶ä¾èµ–

---

## 6. ğŸ¼ å®¹å™¨ç¼–æ’é…ç½®å®è·µ


### 6.1 Docker ComposeåŸºç¡€


**Docker Compose**æ˜¯ä»€ä¹ˆï¼Ÿæƒ³è±¡ä½ è¦æ­å»ºä¸€ä¸ªä¹é˜Ÿï¼š
- æ¯ä¸ª**å®¹å™¨**æ˜¯ä¸€ä¸ªä¹æ‰‹
- **Compose**æ˜¯æŒ‡æŒ¥å®¶ï¼Œåè°ƒæ‰€æœ‰ä¹æ‰‹
- **compose.yml**æ˜¯ä¹è°±ï¼Œå®šä¹‰è°æ¼”å¥ä»€ä¹ˆ

### 6.2 å¤šæœåŠ¡ç¼–æ’ç¤ºä¾‹


**docker-compose.yml**
```yaml
version: '3.8'

services:
  # Webåº”ç”¨
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=database
    depends_on:
      - database
      - redis
    networks:
      - app-network

  # æ•°æ®åº“
  database:
    image: postgres:13
    environment:
      POSTGRES_DB: myapp
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - app-network

  # ç¼“å­˜
  redis:
    image: redis:6-alpine
    ports:
      - "6379:6379"
    networks:
      - app-network

# æ•°æ®å·
volumes:
  db-data:

# ç½‘ç»œ
networks:
  app-network:
    driver: bridge
```

**ğŸ”¸ é…ç½®è§£é‡Š**ï¼š
- `depends_on`ï¼šå®šä¹‰å¯åŠ¨é¡ºåº
- `networks`ï¼šå®¹å™¨é—´ç½‘ç»œé€šä¿¡
- `volumes`ï¼šæ•°æ®æŒä¹…åŒ–å­˜å‚¨
- `environment`ï¼šç¯å¢ƒå˜é‡é…ç½®

### 6.3 ç”Ÿäº§ç¯å¢ƒç¼–æ’ç­–ç•¥


**ğŸš€ å¤šç¯å¢ƒé…ç½®ç®¡ç†**

```yaml
# docker-compose.base.ymlï¼ˆåŸºç¡€é…ç½®ï¼‰
version: '3.8'
services:
  web:
    build: .
    environment:
      - NODE_ENV=${NODE_ENV}

# docker-compose.prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒè¦†ç›–ï¼‰
version: '3.8'
services:
  web:
    restart: always
    deploy:
      replicas: 3
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
docker-compose -f docker-compose.base.yml -f docker-compose.prod.yml up -d
```

### 6.4 å¥åº·æ£€æŸ¥ä¸ç›‘æ§


```yaml
services:
  web:
    image: my-app:latest
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    
  # ç›‘æ§æœåŠ¡
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
```

**ğŸ“Š ç›‘æ§æŒ‡æ ‡æ”¶é›†**ï¼š
- **åº”ç”¨å¥åº·**ï¼šHTTPå“åº”çŠ¶æ€
- **èµ„æºä½¿ç”¨**ï¼šCPUã€å†…å­˜å ç”¨
- **ä¸šåŠ¡æŒ‡æ ‡**ï¼šè¯·æ±‚é‡ã€å“åº”æ—¶é—´

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¹å™¨åŒ–æ ¸å¿ƒï¼šæ‰“åŒ…åº”ç”¨+ç¯å¢ƒï¼Œä¿è¯ä¸€è‡´æ€§è¿è¡Œ
ğŸ”¸ DockeråŸºç¡€ï¼šé•œåƒæ˜¯æ¨¡æ¿ï¼Œå®¹å™¨æ˜¯å®ä¾‹ï¼Œä»“åº“æ˜¯å­˜å‚¨
ğŸ”¸ Kubernetesæœ¬è´¨ï¼šå®¹å™¨ç¼–æ’ç®¡å®¶ï¼Œè‡ªåŠ¨åŒ–ç®¡ç†å®¹å™¨
ğŸ”¸ Helmä½œç”¨ï¼šK8sçš„åŒ…ç®¡ç†å™¨ï¼Œç®€åŒ–å¤æ‚éƒ¨ç½²
ğŸ”¸ CI/CDé›†æˆï¼šä»£ç â†’æ„å»ºâ†’æ¨é€â†’éƒ¨ç½²çš„è‡ªåŠ¨åŒ–æµç¨‹
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦å®¹å™¨åŒ–**
```
é—®é¢˜è§£å†³ï¼š
ç¯å¢ƒä¸ä¸€è‡´ â†’ å®¹å™¨ç»Ÿä¸€ç¯å¢ƒ
éƒ¨ç½²å¤æ‚ â†’ ä¸€é”®éƒ¨ç½²
èµ„æºæµªè´¹ â†’ è½»é‡çº§éš”ç¦»
æ‰©å±•å›°éš¾ â†’ å¿«é€Ÿæ‰©ç¼©å®¹
```

**ğŸ”¹ éƒ¨ç½²ç­–ç•¥é€‰æ‹©**
```
Docker Composeï¼š
âœ… é€‚åˆï¼šå¼€å‘ç¯å¢ƒã€å•æœºéƒ¨ç½²
âŒ ä¸é€‚åˆï¼šå¤§è§„æ¨¡ã€é«˜å¯ç”¨

Kubernetesï¼š
âœ… é€‚åˆï¼šç”Ÿäº§ç¯å¢ƒã€å¾®æœåŠ¡ã€é«˜å¯ç”¨
âŒ ä¸é€‚åˆï¼šç®€å•åº”ç”¨ã€å­¦ä¹ æˆæœ¬æ•æ„Ÿ

Helmï¼š
âœ… é€‚åˆï¼šå¤æ‚K8såº”ç”¨ã€ç‰ˆæœ¬ç®¡ç†
âŒ ä¸é€‚åˆï¼šç®€å•éƒ¨ç½²ã€å¿«é€Ÿå¼€å‘
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“ æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•**
- [ ] **é•œåƒä¼˜åŒ–**ï¼šä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ
- [ ] **ç‰ˆæœ¬ç®¡ç†**ï¼šä½¿ç”¨å…·ä½“ç‰ˆæœ¬å·ï¼Œé¿å…`latest`
- [ ] **å¥åº·æ£€æŸ¥**ï¼šé…ç½®åº”ç”¨å¥åº·æ£€æŸ¥
- [ ] **èµ„æºé™åˆ¶**ï¼šè®¾ç½®CPUå’Œå†…å­˜é™åˆ¶
- [ ] **å®‰å…¨æ‰«æ**ï¼šå®šæœŸæ‰«æé•œåƒæ¼æ´
- [ ] **æ—¥å¿—æ”¶é›†**ï¼šé…ç½®é›†ä¸­åŒ–æ—¥å¿—ç®¡ç†
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®å…³é”®æŒ‡æ ‡ç›‘æ§

**ğŸš¨ å¸¸è§é—®é¢˜åŠè§£å†³**
```
é•œåƒæ‹‰å–å¤±è´¥ï¼š
â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè®¤è¯ä¿¡æ¯

å®¹å™¨å¯åŠ¨å¤±è´¥ï¼š
â†’ æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼šdocker logs <container_id>

K8séƒ¨ç½²å¤±è´¥ï¼š
â†’ æ£€æŸ¥kubectl describe pod <pod_name>

èµ„æºä¸è¶³ï¼š
â†’ è°ƒæ•´èµ„æºé™åˆ¶æˆ–æ‰©å®¹èŠ‚ç‚¹
```

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
åˆå­¦è€…è·¯å¾„ï¼š
1ï¸âƒ£ DockeråŸºç¡€ï¼šç†è§£é•œåƒã€å®¹å™¨æ¦‚å¿µ
2ï¸âƒ£ Dockerfileç¼–å†™ï¼šå­¦ä¼šæ„å»ºè‡ªå®šä¹‰é•œåƒ  
3ï¸âƒ£ Docker Composeï¼šå¤šå®¹å™¨åº”ç”¨ç¼–æ’
4ï¸âƒ£ GitLab CIé›†æˆï¼šè‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²
5ï¸âƒ£ Kuberneteså…¥é—¨ï¼šå®¹å™¨ç¼–æ’åŸºç¡€
6ï¸âƒ£ Helmä½¿ç”¨ï¼šç®€åŒ–K8séƒ¨ç½²

è¿›é˜¶å­¦ä¹ ï¼š
ğŸ”¸ æœåŠ¡ç½‘æ ¼ï¼ˆIstioï¼‰
ğŸ”¸ ç›‘æ§ä½“ç³»ï¼ˆPrometheus + Grafanaï¼‰
ğŸ”¸ æ—¥å¿—ç®¡ç†ï¼ˆELK Stackï¼‰
ğŸ”¸ å®‰å…¨åŠ å›ºï¼ˆPod Security Policyï¼‰
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å®¹å™¨åŒ–å°±æ˜¯"æ‰“åŒ…åº”ç”¨"ï¼Œä¿è¯åˆ°å“ªéƒ½èƒ½è·‘
- Dockeræ˜¯åŸºç¡€å·¥å…·ï¼ŒK8sæ˜¯ç®¡ç†å¹³å°ï¼ŒHelmæ˜¯ç®€åŒ–å·¥å…·
- GitLab CI/CDè‡ªåŠ¨åŒ–æ•´ä¸ªå®¹å™¨éƒ¨ç½²æµç¨‹
- é€‰æ‹©åˆé€‚çš„éƒ¨ç½²ç­–ç•¥æ¯”è¿½æ±‚æœ€æ–°æŠ€æœ¯æ›´é‡è¦