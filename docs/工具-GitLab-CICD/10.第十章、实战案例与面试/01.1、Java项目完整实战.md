---
title: 1ã€Javaé¡¹ç›®å®Œæ•´å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [é¡¹ç›®å®æˆ˜æ¦‚è¿°](#1-é¡¹ç›®å®æˆ˜æ¦‚è¿°)
2. [Spring Booté¡¹ç›®å‡†å¤‡](#2-spring-booté¡¹ç›®å‡†å¤‡)
3. [Mavenæ„å»ºé…ç½®](#3-mavenæ„å»ºé…ç½®)
4. [å•å…ƒæµ‹è¯•é›†æˆ](#4-å•å…ƒæµ‹è¯•é›†æˆ)
5. [Dockeréƒ¨ç½²å®ç°](#5-dockeréƒ¨ç½²å®ç°)
6. [ç”Ÿäº§ç¯å¢ƒå‘å¸ƒ](#6-ç”Ÿäº§ç¯å¢ƒå‘å¸ƒ)
7. [å®Œæ•´Pipelineç¤ºä¾‹](#7-å®Œæ•´pipelineç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é¡¹ç›®å®æˆ˜æ¦‚è¿°


### 1.1 å®æˆ˜é¡¹ç›®ä»‹ç»


**ğŸ”¸ é¡¹ç›®èƒŒæ™¯**
æˆ‘ä»¬è¦ä¸ºä¸€ä¸ªSpring Booté¡¹ç›®æ­å»ºå®Œæ•´çš„CI/CDæµæ°´çº¿ï¼Œå°±åƒç»™ä½ çš„Javaåº”ç”¨è£…ä¸Š"è‡ªåŠ¨åŒ–ç”Ÿäº§çº¿"ã€‚

```
ä¼ ç»Ÿå¼€å‘æµç¨‹ vs CI/CDæµç¨‹

ä¼ ç»Ÿæ–¹å¼ï¼š
å¼€å‘ â†’ æ‰‹åŠ¨æµ‹è¯• â†’ æ‰‹åŠ¨æ‰“åŒ… â†’ æ‰‹åŠ¨éƒ¨ç½² â†’ æ‰‹åŠ¨éªŒè¯
é—®é¢˜ï¼šè€—æ—¶ã€æ˜“é”™ã€éš¾è¿½è¸ª

CI/CDæ–¹å¼ï¼š
ä»£ç æäº¤ â†’ è‡ªåŠ¨æµ‹è¯• â†’ è‡ªåŠ¨æ„å»º â†’ è‡ªåŠ¨éƒ¨ç½² â†’ è‡ªåŠ¨éªŒè¯
ä¼˜åŠ¿ï¼šå¿«é€Ÿã€å¯é ã€å¯è¿½è¸ª
```

**ğŸ’¡ å®æˆ˜ç›®æ ‡**
é€šè¿‡è¿™ä¸ªå®æˆ˜ï¼Œä½ å°†æŒæ¡ï¼š
- å¦‚ä½•ä¸ºJavaé¡¹ç›®é…ç½®è‡ªåŠ¨åŒ–æ„å»º
- å¦‚ä½•é›†æˆæµ‹è¯•å’Œä»£ç è´¨é‡æ£€æŸ¥
- å¦‚ä½•å®ç°Dockerå®¹å™¨åŒ–éƒ¨ç½²
- å¦‚ä½•é…ç½®å¤šç¯å¢ƒå‘å¸ƒç­–ç•¥

### 1.2 æŠ€æœ¯æ ˆä»‹ç»


**ğŸ”§ ä¸»è¦æŠ€æœ¯ç»„åˆ**
```
åç«¯æ¡†æ¶ï¼šSpring Boot 2.7+
æ„å»ºå·¥å…·ï¼šMaven 3.8+
å®¹å™¨åŒ–ï¼šDocker + Docker Compose
CI/CDï¼šGitLab CI/CD
éƒ¨ç½²ç¯å¢ƒï¼šLinuxæœåŠ¡å™¨
```

**ğŸ“Š å­¦ä¹ éš¾åº¦è¯„ä¼°**
```
ğŸ“ å½“å‰ä½ç½®ï¼šGitLab CI/CD > å®æˆ˜æ¡ˆä¾‹ > Javaé¡¹ç›®
ğŸ”— å‰ç½®çŸ¥è¯†ï¼šSpring BootåŸºç¡€ã€Mavenä½¿ç”¨ã€DockeråŸºç¡€
â±ï¸ é¢„è®¡æ—¶é—´ï¼š3-4å°æ—¶
ğŸ¯ éš¾åº¦ç­‰çº§ï¼šâ˜…â˜…â˜…â˜†â˜† (ä¸­ç­‰)
```

---

## 2. ğŸš€ Spring Booté¡¹ç›®å‡†å¤‡


### 2.1 åˆ›å»ºç¤ºä¾‹é¡¹ç›®


**ğŸ”¸ é¡¹ç›®ç»“æ„è¯´æ˜**
æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„Spring Boot Webåº”ç”¨ï¼Œå°±åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œå…ˆæœ‰åŸºç¡€æ¡†æ¶ã€‚

```
demo-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/example/demo/
â”‚   â”‚   â”‚       â”œâ”€â”€ DemoApplication.java     # ä¸»ç¨‹åºå…¥å£
â”‚   â”‚   â”‚       â”œâ”€â”€ controller/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ HelloController.java # RESTæ§åˆ¶å™¨
â”‚   â”‚   â”‚       â””â”€â”€ service/
â”‚   â”‚   â”‚           â””â”€â”€ HelloService.java    # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ application.yml              # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/
â”‚           â””â”€â”€ com/example/demo/
â”‚               â””â”€â”€ HelloControllerTest.java # æµ‹è¯•ç±»
â”œâ”€â”€ Dockerfile                               # Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ pom.xml                                 # Mavené…ç½®
â””â”€â”€ .gitlab-ci.yml                         # CI/CDé…ç½®
```

### 2.2 æ ¸å¿ƒä»£ç æ–‡ä»¶


**ğŸ”¸ ä¸»ç¨‹åºç±»**
```java
// DemoApplication.java - Spring Bootå¯åŠ¨ç±»
@SpringBootApplication
public class DemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
}
```

**ğŸ”¸ æ§åˆ¶å™¨ç±»**
```java
// HelloController.java - RESTæ¥å£
@RestController
@RequestMapping("/api")
public class HelloController {
    
    @Autowired
    private HelloService helloService;
    
    @GetMapping("/hello")
    public Map<String, String> hello(@RequestParam(defaultValue = "World") String name) {
        String message = helloService.sayHello(name);
        return Map.of("message", message, "timestamp", LocalDateTime.now().toString());
    }
    
    @GetMapping("/health")
    public Map<String, String> health() {
        return Map.of("status", "UP", "service", "demo-app");
    }
}
```

**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
> **æƒ³è±¡ä¸€ä¸‹å¼€é¤å…**ï¼š
> - `DemoApplication` = é¤å…çš„æ€»å¼€å…³ï¼Œå¯åŠ¨æ•´ä¸ªé¤å…
> - `HelloController` = æœåŠ¡å‘˜ï¼Œæ¥å¾…å®¢äººçš„ç‚¹é¤è¯·æ±‚
> - `HelloService` = å¨å¸ˆï¼Œè´Ÿè´£å…·ä½“çš„ä¸šåŠ¡é€»è¾‘

### 2.3 é…ç½®æ–‡ä»¶è®¾ç½®


**ğŸ”¸ åº”ç”¨é…ç½®**
```yaml
# application.yml
server:
  port: 8080
  servlet:
    context-path: /demo

spring:
  application:
    name: demo-app
  profiles:
    active: dev

# å¼€å‘ç¯å¢ƒé…ç½®
---
spring:
  profiles: dev
logging:
  level:
    com.example.demo: DEBUG

# ç”Ÿäº§ç¯å¢ƒé…ç½®    
---
spring:
  profiles: prod
logging:
  level:
    root: WARN
    com.example.demo: INFO
```

**ğŸ“Œ é‡ç‚¹ç†è§£**
> **é…ç½®æ–‡ä»¶çš„ä½œç”¨**ï¼šå°±åƒç»™ä¸åŒåœºåˆå‡†å¤‡ä¸åŒçš„è¡£æœ
> - å¼€å‘ç¯å¢ƒï¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•
> - ç”Ÿäº§ç¯å¢ƒï¼šåªè¾“å‡ºå…³é”®ä¿¡æ¯ï¼Œä¿è¯æ€§èƒ½

---

## 3. ğŸ“¦ Mavenæ„å»ºé…ç½®


### 3.1 POMæ–‡ä»¶é…ç½®


**ğŸ”¸ åŸºç¡€ä¾èµ–é…ç½®**
```xml
<!-- pom.xml - é¡¹ç›®æ„å»ºé…ç½® -->
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.example</groupId>
    <artifactId>demo-app</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>
    
    <name>Demo Application</name>
    <description>GitLab CI/CD Demo Project</description>
    
    <properties>
        <java.version>11</java.version>
        <spring-boot.version>2.7.8</spring-boot.version>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
    </properties>
    
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
</project>
```

### 3.2 æ„å»ºæ’ä»¶é…ç½®


**ğŸ”¸ Mavenæ’ä»¶è®¾ç½®**
```xml
<build>
    <plugins>
        <!-- Spring Bootæ’ä»¶ - æ‰“åŒ…å¯æ‰§è¡ŒJAR -->
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <version>${spring-boot.version}</version>
            <executions>
                <execution>
                    <goals>
                        <goal>repackage</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
        
        <!-- æµ‹è¯•æ’ä»¶ - å•å…ƒæµ‹è¯•æ‰§è¡Œ -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>3.0.0-M9</version>
            <configuration>
                <includes>
                    <include>**/*Test.java</include>
                </includes>
            </configuration>
        </plugin>
        
        <!-- ä»£ç è¦†ç›–ç‡æ’ä»¶ -->
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.8</version>
            <executions>
                <execution>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
                <execution>
                    <id>report</id>
                    <phase>test</phase>
                    <goals>
                        <goal>report</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

**ğŸ§  è®°å¿†æŠ€å·§**
> **Mavenæ’ä»¶å°±åƒå·¥å…·ç®±**ï¼š
> - `spring-boot-maven-plugin` = æ‰“åŒ…å·¥å…·ï¼ŒæŠŠé¡¹ç›®æ‰“åŒ…æˆå¯è¿è¡Œçš„JAR
> - `maven-surefire-plugin` = æµ‹è¯•å·¥å…·ï¼Œè‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•
> - `jacoco-maven-plugin` = æ£€æŸ¥å·¥å…·ï¼Œçœ‹ä»£ç æµ‹è¯•è¦†ç›–ç‡

---

## 4. ğŸ§ª å•å…ƒæµ‹è¯•é›†æˆ


### 4.1 æµ‹è¯•ä»£ç ç¼–å†™


**ğŸ”¸ æ§åˆ¶å™¨æµ‹è¯•ç±»**
```java
// HelloControllerTest.java
@SpringBootTest
@AutoConfigureTestWebClient
class HelloControllerTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Test
    void testHelloEndpoint() {
        // æµ‹è¯•åŸºæœ¬çš„Helloæ¥å£
        String response = restTemplate.getForObject("/api/hello", String.class);
        assertThat(response).contains("Hello World");
    }
    
    @Test
    void testHelloWithName() {
        // æµ‹è¯•å¸¦å‚æ•°çš„Helloæ¥å£
        String response = restTemplate.getForObject("/api/hello?name=GitLab", String.class);
        assertThat(response).contains("Hello GitLab");
    }
    
    @Test
    void testHealthEndpoint() {
        // æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
        ResponseEntity<String> response = restTemplate.getForEntity("/api/health", String.class);
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody()).contains("UP");
    }
}
```

### 4.2 æµ‹è¯•é…ç½®ä¼˜åŒ–


**ğŸ”¸ æµ‹è¯•ç¯å¢ƒé…ç½®**
```yaml
# application-test.yml - æµ‹è¯•ä¸“ç”¨é…ç½®
spring:
  profiles:
    active: test

server:
  port: 0  # éšæœºç«¯å£ï¼Œé¿å…å†²çª

logging:
  level:
    com.example.demo: INFO
    org.springframework.test: INFO
```

**ğŸ“Š æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**
```
æµ‹è¯•è¦†ç›–ç‡æ ‡å‡†ï¼š
è¡Œè¦†ç›–ç‡: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% (ç›®æ ‡)
åˆ†æ”¯è¦†ç›–ç‡: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 70% (ç›®æ ‡)
æ–¹æ³•è¦†ç›–ç‡: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90% (ç›®æ ‡)
```

> **ğŸ’¡ æµ‹è¯•çš„é‡è¦æ€§**
> 
> å•å…ƒæµ‹è¯•å°±åƒç»™æ±½è½¦åšå®‰å…¨æ£€æŸ¥ï¼Œåœ¨ä¸Šè·¯å‰ç¡®ä¿å„ä¸ªéƒ¨ä»¶éƒ½æ­£å¸¸å·¥ä½œã€‚
> åœ¨CI/CDä¸­ï¼Œæµ‹è¯•å¤±è´¥ä¼šè‡ªåŠ¨é˜»æ­¢éƒ¨ç½²ï¼Œé¿å…æœ‰é—®é¢˜çš„ä»£ç å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒã€‚

---

## 5. ğŸ³ Dockeréƒ¨ç½²å®ç°


### 5.1 Dockerfileç¼–å†™


**ğŸ”¸ å¤šé˜¶æ®µæ„å»ºé…ç½®**
```dockerfile
# Dockerfile - Dockeré•œåƒæ„å»ºé…ç½®
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µ
FROM maven:3.8.6-openjdk-11-slim AS builder

WORKDIR /app

# å¤åˆ¶pom.xmlï¼Œåˆ©ç”¨Dockerå±‚ç¼“å­˜
COPY pom.xml .
RUN mvn dependency:go-offline -B

# å¤åˆ¶æºä»£ç å¹¶æ„å»º
COPY src ./src
RUN mvn clean package -DskipTests

# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µ
FROM openjdk:11-jre-slim

WORKDIR /app

# åˆ›å»ºérootç”¨æˆ·ï¼ˆå®‰å…¨å®è·µï¼‰
RUN groupadd -r appuser && useradd -r -g appuser appuser

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/target/demo-app-*.jar app.jar

# è®¾ç½®æ–‡ä»¶æƒé™
RUN chown appuser:appuser app.jar

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER appuser

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/demo/api/health || exit 1

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨åº”ç”¨
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 5.2 Docker Composeé…ç½®


**ğŸ”¸ å¤šç¯å¢ƒéƒ¨ç½²é…ç½®**
```yaml
# docker-compose.yml
version: '3.8'

services:
  demo-app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - JAVA_OPTS=-Xmx512m -Xms256m
    networks:
      - app-network
    restart: unless-stopped
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - demo-app
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
```

**ğŸ’­ Dockerç±»æ¯”ç†è§£**
> **Dockerå°±åƒé›†è£…ç®±è¿è¾“**ï¼š
> - `Dockerfile` = è£…ç®±æ¸…å•ï¼Œè§„å®šæ€ä¹ˆæ‰“åŒ…åº”ç”¨
> - `Dockeré•œåƒ` = æ ‡å‡†é›†è£…ç®±ï¼ŒåŒ…å«åº”ç”¨å’Œç¯å¢ƒ
> - `Dockerå®¹å™¨` = è¿è¡Œä¸­çš„é›†è£…ç®±ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½è¿è¡Œ

---

## 6. ğŸš€ ç”Ÿäº§ç¯å¢ƒå‘å¸ƒ


### 6.1 ç¯å¢ƒé…ç½®ç®¡ç†


**ğŸ”¸ å¤šç¯å¢ƒç­–ç•¥**
```
ç¯å¢ƒè§„åˆ’ï¼š
å¼€å‘ç¯å¢ƒ(dev)  â”€â”€â†’  æµ‹è¯•ç¯å¢ƒ(test)  â”€â”€â†’  ç”Ÿäº§ç¯å¢ƒ(prod)
    â†“                    â†“                    â†“
 åŠŸèƒ½å¼€å‘             é›†æˆæµ‹è¯•             æ­£å¼å‘å¸ƒ
 å¿«é€Ÿè¿­ä»£             ç¨³å®šæ€§éªŒè¯           é«˜å¯ç”¨éƒ¨ç½²
```

| ç¯å¢ƒç±»å‹ | **ç”¨é€”** | **ç‰¹ç‚¹** | **éƒ¨ç½²ç­–ç•¥** |
|---------|---------|---------|-------------|
| ğŸ”§ **å¼€å‘ç¯å¢ƒ** | `åŠŸèƒ½å¼€å‘æµ‹è¯•` | `å¿«é€Ÿè¿­ä»£` | `è‡ªåŠ¨éƒ¨ç½²` |
| ğŸ§ª **æµ‹è¯•ç¯å¢ƒ** | `é›†æˆæµ‹è¯•éªŒè¯` | `æ¥è¿‘ç”Ÿäº§` | `è‡ªåŠ¨éƒ¨ç½²` |
| ğŸ­ **ç”Ÿäº§ç¯å¢ƒ** | `ç”¨æˆ·è®¿é—®` | `é«˜å¯ç”¨ç¨³å®š` | `æ‰‹åŠ¨è§¦å‘` |

### 6.2 å‘å¸ƒç­–ç•¥é…ç½®


**ğŸ”¸ è“ç»¿éƒ¨ç½²å®ç°**
```yaml
# è“ç»¿éƒ¨ç½²é…ç½®ç¤ºä¾‹
production_deploy:
  stage: deploy
  script:
    - echo "å¼€å§‹è“ç»¿éƒ¨ç½²"
    # 1. éƒ¨ç½²åˆ°ç»¿è‰²ç¯å¢ƒ
    - docker-compose -f docker-compose.green.yml up -d
    # 2. å¥åº·æ£€æŸ¥
    - ./scripts/health-check.sh green
    # 3. åˆ‡æ¢æµé‡
    - ./scripts/switch-traffic.sh green
    # 4. åœæ­¢è“è‰²ç¯å¢ƒ
    - docker-compose -f docker-compose.blue.yml down
  environment:
    name: production
    url: https://demo-app.example.com
  when: manual  # æ‰‹åŠ¨è§¦å‘
  only:
    - main
```

**ğŸ“Œ å‘å¸ƒç­–ç•¥å¯¹æ¯”**
```
ğŸ”µğŸŸ¢ è“ç»¿éƒ¨ç½²ï¼š
ä¼˜ç‚¹ï¼šé›¶åœæœºã€å¿«é€Ÿå›æ»š
ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—å¤§

ğŸŒŠ æ»šåŠ¨æ›´æ–°ï¼š
ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜
ç¼ºç‚¹ï¼šéƒ¨ç½²æ—¶é—´é•¿

ğŸ¤ é‡‘ä¸é›€å‘å¸ƒï¼š
ä¼˜ç‚¹ï¼šé£é™©å¯æ§ã€æ¸è¿›éªŒè¯
ç¼ºç‚¹ï¼šé…ç½®å¤æ‚
```

---

## 7. ğŸ“‹ å®Œæ•´Pipelineç¤ºä¾‹


### 7.1 GitLab CIé…ç½®æ–‡ä»¶


**ğŸ”¸ å®Œæ•´çš„.gitlab-ci.yml**
```yaml
# .gitlab-ci.yml - å®Œæ•´çš„CI/CDé…ç½®
stages:
  - validate    # ä»£ç æ£€æŸ¥é˜¶æ®µ
  - test       # æµ‹è¯•é˜¶æ®µ
  - build      # æ„å»ºé˜¶æ®µ
  - deploy     # éƒ¨ç½²é˜¶æ®µ

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"
  MAVEN_CLI_OPTS: "--batch-mode --errors --fail-at-end --show-version"
  DOCKER_DRIVER: overlay2

# ç¼“å­˜é…ç½®
cache:
  paths:
    - .m2/repository/
    - target/

# é˜¶æ®µ1ï¼šä»£ç éªŒè¯
code_quality:
  stage: validate
  image: maven:3.8.6-openjdk-11-slim
  script:
    - echo "ğŸ” å¼€å§‹ä»£ç è´¨é‡æ£€æŸ¥"
    - mvn $MAVEN_CLI_OPTS compile
    - mvn $MAVEN_CLI_OPTS checkstyle:check
  artifacts:
    reports:
      junit: target/checkstyle-result.xml
  only:
    - merge_requests
    - main

# é˜¶æ®µ2ï¼šå•å…ƒæµ‹è¯•
unit_tests:
  stage: test
  image: maven:3.8.6-openjdk-11-slim
  script:
    - echo "ğŸ§ª å¼€å§‹å•å…ƒæµ‹è¯•"
    - mvn $MAVEN_CLI_OPTS test
    - mvn jacoco:report
  artifacts:
    reports:
      junit: target/surefire-reports/TEST-*.xml
      coverage_report:
        coverage_format: jacoco
        path: target/site/jacoco/jacoco.xml
    paths:
      - target/site/jacoco/
  coverage: '/Total.*?([0-9]{1,3})%/'

# é˜¶æ®µ3ï¼šæ„å»ºDockeré•œåƒ
build_image:
  stage: build
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - echo "ğŸ—ï¸ å¼€å§‹æ„å»ºDockeré•œåƒ"
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
    - docker build -t $CI_REGISTRY_IMAGE:latest .
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - docker push $CI_REGISTRY_IMAGE:latest
  only:
    - main

# é˜¶æ®µ4ï¼šéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
deploy_test:
  stage: deploy
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - echo "ğŸš€ éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"
    - docker-compose -f docker-compose.test.yml down
    - docker-compose -f docker-compose.test.yml up -d
    - echo "ç­‰å¾…åº”ç”¨å¯åŠ¨..."
    - sleep 30
    - ./scripts/health-check.sh test
  environment:
    name: test
    url: https://test.demo-app.example.com
  only:
    - main

# é˜¶æ®µ5ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
deploy_production:
  stage: deploy
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - echo "ğŸ­ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
    - ./scripts/deploy-production.sh
  environment:
    name: production
    url: https://demo-app.example.com
  when: manual  # æ‰‹åŠ¨è§¦å‘
  only:
    - main
```

### 7.2 Pipelineæ‰§è¡Œæµç¨‹


**ğŸ”„ å®Œæ•´æ‰§è¡Œæµç¨‹å›¾**
```
ä»£ç æäº¤
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä»£ç éªŒè¯    â”‚ â† ç¼–è¯‘æ£€æŸ¥ã€ä»£ç è§„èŒƒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å•å…ƒæµ‹è¯•    â”‚ â† è¿è¡Œæµ‹è¯•ã€ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ„å»ºé•œåƒ    â”‚ â† Dockeré•œåƒæ„å»ºå’Œæ¨é€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æµ‹è¯•éƒ¨ç½²    â”‚ â† è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿäº§éƒ¨ç½²    â”‚ â† æ‰‹åŠ¨è§¦å‘ç”Ÿäº§éƒ¨ç½²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**â±ï¸ æ—¶é—´é¢„ä¼°**
```
Pipelineæ‰§è¡Œæ—¶é—´åˆ†å¸ƒï¼š
ä»£ç éªŒè¯: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 2-3åˆ†é’Ÿ
å•å…ƒæµ‹è¯•: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 3-5åˆ†é’Ÿ
æ„å»ºé•œåƒ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 5-8åˆ†é’Ÿ
éƒ¨ç½²æµ‹è¯•: â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘ 2-3åˆ†é’Ÿ
ç”Ÿäº§éƒ¨ç½²: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 3-5åˆ†é’Ÿ

æ€»è®¡æ—¶é—´: 15-24åˆ†é’Ÿ
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Spring Booté¡¹ç›®ç»“æ„ï¼šç†è§£æ ‡å‡†çš„Mavené¡¹ç›®å¸ƒå±€
ğŸ”¸ Mavenæ„å»ºé…ç½®ï¼šæŒæ¡pom.xmlçš„æ ¸å¿ƒé…ç½®é¡¹
ğŸ”¸ å•å…ƒæµ‹è¯•é›†æˆï¼šå­¦ä¼šç¼–å†™å’Œé…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•
ğŸ”¸ Dockerå®¹å™¨åŒ–ï¼šç†è§£å¤šé˜¶æ®µæ„å»ºå’Œé•œåƒä¼˜åŒ–
ğŸ”¸ å¤šç¯å¢ƒéƒ¨ç½²ï¼šæŒæ¡å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒç®¡ç†
ğŸ”¸ Pipelineé…ç½®ï¼šç†Ÿæ‚‰GitLab CI/CDçš„å®Œæ•´æµç¨‹
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ç”¨CI/CD**
```
è§£å†³çš„é—®é¢˜ï¼š
- æ‰‹åŠ¨æ“ä½œå®¹æ˜“å‡ºé”™
- éƒ¨ç½²æµç¨‹ä¸ä¸€è‡´
- æµ‹è¯•è¦†ç›–ä¸å……åˆ†
- å‘å¸ƒå‘¨æœŸå¤ªé•¿

å¸¦æ¥çš„ä»·å€¼ï¼š
- æé«˜å¼€å‘æ•ˆç‡
- é™ä½éƒ¨ç½²é£é™©
- ä¿è¯ä»£ç è´¨é‡
- å®ç°å¿«é€Ÿäº¤ä»˜
```

**ğŸ”¹ DockeråŒ–çš„å¥½å¤„**
```
ç¯å¢ƒä¸€è‡´æ€§ï¼š
"åœ¨æˆ‘çš„æœºå™¨ä¸Šèƒ½è¿è¡Œ" â†’ "åœ¨ä»»ä½•åœ°æ–¹éƒ½èƒ½è¿è¡Œ"

éƒ¨ç½²ç®€åŒ–ï¼š
å¤æ‚çš„ç¯å¢ƒé…ç½® â†’ ä¸€ä¸ªé•œåƒæå®š

æ‰©å±•æ€§ï¼š
æ‰‹åŠ¨æ‰©å®¹ â†’ è‡ªåŠ¨åŒ–æ¨ªå‘æ‰©å±•
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **å°å‹é¡¹ç›®**ï¼šå¿«é€Ÿæ­å»ºCI/CDï¼Œæé«˜å¼€å‘æ•ˆç‡
- **å›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€æ„å»ºå’Œéƒ¨ç½²æµç¨‹ï¼Œå‡å°‘å†²çª
- **ä¼ä¸šåº”ç”¨**ï¼šå»ºç«‹è§„èŒƒåŒ–çš„å‘å¸ƒæµç¨‹ï¼Œä¿è¯è´¨é‡
- **å¾®æœåŠ¡æ¶æ„**ï¼šä¸ºæ¯ä¸ªæœåŠ¡ç‹¬ç«‹é…ç½®Pipeline

**ğŸ”§ æœ€ä½³å®è·µå»ºè®®**
```
ä»£ç ç®¡ç†ï¼š
- ä½¿ç”¨Gitåˆ†æ”¯ç­–ç•¥
- ç¼–å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯
- å®šæœŸè¿›è¡Œä»£ç å®¡æŸ¥

æµ‹è¯•ç­–ç•¥ï¼š
- ä¿æŒé«˜æµ‹è¯•è¦†ç›–ç‡
- ç¼–å†™æœ‰æ„ä¹‰çš„æµ‹è¯•ç”¨ä¾‹
- å¿«é€Ÿåé¦ˆæµ‹è¯•ç»“æœ

éƒ¨ç½²ä¼˜åŒ–ï¼š
- ä½¿ç”¨è“ç»¿éƒ¨ç½²é™ä½é£é™©
- é…ç½®å¥åº·æ£€æŸ¥æœºåˆ¶
- å»ºç«‹ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ
```

**ğŸ“‹ å­¦ä¹ æ£€æŸ¥æ¸…å•**
- [ ] èƒ½å¤Ÿç‹¬ç«‹é…ç½®Spring Booté¡¹ç›®çš„CI/CD
- [ ] ç†è§£Dockerå¤šé˜¶æ®µæ„å»ºçš„ä¼˜åŠ¿
- [ ] æŒæ¡GitLab Pipelineçš„å„ä¸ªé˜¶æ®µé…ç½®
- [ ] èƒ½å¤Ÿç¼–å†™æœ‰æ•ˆçš„å•å…ƒæµ‹è¯•
- [ ] äº†è§£å¤šç¯å¢ƒéƒ¨ç½²çš„æœ€ä½³å®è·µ
- [ ] èƒ½å¤Ÿæ’æŸ¥Pipelineæ‰§è¡Œä¸­çš„å¸¸è§é—®é¢˜

**ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘**
- å­¦ä¹ Kuberneteséƒ¨ç½²
- æŒæ¡ç›‘æ§å’Œæ—¥å¿—ç®¡ç†
- äº†è§£å®‰å…¨æ‰«æé›†æˆ
- æ¢ç´¢é«˜çº§éƒ¨ç½²ç­–ç•¥

**æ ¸å¿ƒè®°å¿†**ï¼š
- Javaé¡¹ç›®CI/CDæ˜¯ç°ä»£å¼€å‘çš„å¿…å¤‡æŠ€èƒ½
- è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²èƒ½æ˜¾è‘—æé«˜å¼€å‘æ•ˆç‡
- Dockerå®¹å™¨åŒ–æ˜¯å®ç°ç¯å¢ƒä¸€è‡´æ€§çš„å…³é”®
- Pipelineé…ç½®éœ€è¦å¾ªåºæ¸è¿›ï¼Œé€æ­¥å®Œå–„