---
title: 1、GitLab环境搭建
---
## 📚 目录

1. [GitLab CI/CD 基础认知](#1-gitlab-cicd-基础认知)
2. [GitLab账号与项目准备](#2-gitlab账号与项目准备)
3. [GitLab Runner 核心概念](#3-gitlab-runner-核心概念)
4. [Docker环境配置](#4-docker环境配置)
5. [Runner安装与注册](#5-runner安装与注册)
6. [环境验证与测试](#6-环境验证与测试)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 GitLab CI/CD 基础认知


### 1.1 什么是CI/CD？


> **💡 核心理解**  
> CI/CD就像工厂的自动化流水线，把原本需要人工操作的软件开发流程变成自动化的

**CI（持续集成）**就是：
- 开发者写完代码提交后，系统自动帮你**检查代码**、**运行测试**
- 就像有个勤劳的助手，每次你改代码都帮你检查有没有问题

**CD（持续部署）**就是：
- 代码检查通过后，系统自动帮你**发布到服务器**
- 就像快递自动分拣，把合格的包裹自动送到目的地

### 1.2 为什么需要GitLab CI/CD？


**🔸 传统开发的痛点：**
```
开发者写代码 → 手动测试 → 手动部署 → 出问题再手动修复
问题：容易出错、效率低下、重复劳动
```

**🔸 使用CI/CD后：**
```
开发者写代码 → 自动测试 → 自动部署 → 自动监控
优势：减少错误、提高效率、标准化流程
```

**实际好处：**
- **省时间**：不用手动部署，节省大量重复工作
- **少出错**：自动化流程，避免人为操作失误  
- **快反馈**：代码有问题立即知道，不用等到最后才发现
- **团队协作**：大家用同样的流程，减少配置差异

---

## 2. 🏗️ GitLab账号与项目准备


### 2.1 GitLab账号注册


**注册步骤：**

1. **访问GitLab官网**：https://gitlab.com
2. **点击注册**：选择"Register"或"注册"
3. **填写信息**：
   - 用户名：`your-username`（建议用英文）
   - 邮箱：`your-email@example.com`
   - 密码：**至少8位，包含字母数字**

> **⚠️ 注意事项**  
> 用户名一旦确定就很难修改，建议选择专业一点的名称

### 2.2 项目创建与初始化


**创建新项目：**

1. **点击"New Project"** → 选择"Create blank project"
2. **填写项目信息**：
   - 项目名称：`my-first-cicd`（举例）
   - 描述：`学习GitLab CI/CD的测试项目`
   - 可见性：选择`Private`（私有项目）

3. **初始化选项**：
   - ✅ 勾选"Initialize repository with a README"
   - ✅ 勾选"Add .gitignore template"

**🔸 项目结构示例：**
```
my-first-cicd/
├── README.md          # 项目说明文件
├── .gitignore        # Git忽略文件配置
└── .gitlab-ci.yml    # CI/CD配置文件（后续创建）
```

### 2.3 基础环境准备


**本地Git配置：**
```bash
# 配置用户信息（只需要做一次）
git config --global user.name "你的姓名"
git config --global user.email "你的邮箱"

# 克隆项目到本地
git clone https://gitlab.com/your-username/my-first-cicd.git
cd my-first-cicd
```

> **📝 实例说明**  
> 这就像在电脑上建了一个工作文件夹，以后所有的代码修改都在这个文件夹里进行

---

## 3. 🏃‍♂️ GitLab Runner 核心概念


### 3.1 什么是GitLab Runner？


> **💡 核心理解**  
> GitLab Runner就像一个"工人"，专门负责执行你写的CI/CD任务

**简单类比：**
- **GitLab**：老板，下达任务指令
- **Runner**：工人，具体执行任务
- **任务**：跑测试、打包代码、部署应用等

### 3.2 Runner的工作流程


```
GitLab检测到代码变化
        ↓
    查找可用的Runner
        ↓
    Runner接收任务
        ↓
    Runner执行CI/CD脚本
        ↓
    返回执行结果给GitLab
```

### 3.3 Runner的类型


| Runner类型 | **说明** | **适用场景** | **优缺点** |
|------------|----------|-------------|-----------|
| 🌐 **Shared Runner** | `GitLab官方提供的公共Runner` | `小项目、学习测试` | `免费但有限制` |
| 🏢 **Group Runner** | `企业或团队共享的Runner` | `团队项目` | `资源共享，需要管理` |
| 🖥️ **Specific Runner** | `专门为某个项目配置的Runner` | `生产环境、特殊需求` | `独享资源，需要自己维护` |

**🔸 新手建议：**
- 学习阶段：使用**Shared Runner**，简单易用
- 实际项目：建议配置**Specific Runner**，更稳定可控

---

## 4. 🐳 Docker环境配置


### 4.1 为什么需要Docker？


> **💡 核心理解**  
> Docker就像一个"标准化的集装箱"，保证代码在任何环境下都能正常运行

**传统问题：**
- "在我电脑上能跑啊！"（环境差异问题）
- 不同服务器配置不同，部署容易出错

**Docker的解决方案：**
- 把代码和运行环境打包在一起
- 保证在任何地方运行效果都一样

### 4.2 Docker安装


**🔸 Windows/Mac用户：**
1. 下载Docker Desktop：https://www.docker.com/products/docker-desktop
2. 安装并启动
3. 验证安装：打开命令行输入 `docker --version`

**🔸 Linux用户：**
```bash
# Ubuntu示例
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
```

### 4.3 Docker基础验证


**验证Docker是否正常工作：**
```bash
# 测试Docker是否能正常运行
docker run hello-world
```

**期望输出：**
```
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

> **🔧 实践技巧**  
> 如果看到这个信息，说明Docker已经正确安装并可以使用了

---

## 5. ⚙️ Runner安装与注册


### 5.1 安装GitLab Runner


**🔸 使用Docker安装（推荐）：**
```bash
# 拉取GitLab Runner镜像
docker pull gitlab/gitlab-runner:latest

# 创建Runner容器
docker run -d --name gitlab-runner --restart always \
  -v /srv/gitlab-runner/config:/etc/gitlab-runner \
  -v /var/run/docker.sock:/var/run/docker.sock \
  gitlab/gitlab-runner:latest
```

> **📋 操作步骤说明**  
> - 第一条命令：下载Runner程序
> - 第二条命令：启动Runner服务，让它一直在后台运行

### 5.2 获取注册信息


**在GitLab项目中获取Runner注册信息：**

1. **进入项目** → 点击左侧菜单"Settings" → 选择"CI/CD"
2. **展开"Runners"部分**
3. **记录两个重要信息**：
   - **URL**：类似 `https://gitlab.com/`
   - **Token**：类似 `GR1348941abc...`

> **⚠️ 重要提醒**  
> Token是敏感信息，不要泄露给其他人，就像银行卡密码一样

### 5.3 注册Runner


**执行注册命令：**
```bash
# 进入Runner容器
docker exec -it gitlab-runner gitlab-runner register

# 按提示填写信息（交互式）
# URL: 输入前面记录的URL
# Token: 输入前面记录的Token
# Description: 给Runner起个名字，比如"my-docker-runner"
# Tags: 输入标签，比如"docker,test"
# Executor: 选择"docker"
# Default Docker image: 输入"alpine:latest"
```

**🔸 注册过程示例：**
```
Please enter the gitlab-ci coordinator URL: https://gitlab.com/
Please enter the gitlab-ci token: GR1348941abc...
Please enter the gitlab-ci description: my-docker-runner
Please enter the gitlab-ci tags: docker,test
Please enter the executor: docker
Please enter the default Docker image: alpine:latest
```

### 5.4 验证Runner状态


**在GitLab界面检查：**
1. 回到项目的"Settings" → "CI/CD" → "Runners"
2. 应该能看到一个绿色的Runner，状态显示"available"

> **✅ 成功标志**  
> 看到绿色圆点和"available"状态，说明Runner已经成功注册并可以接收任务

---

## 6. 🧪 环境验证与测试


### 6.1 创建第一个CI/CD脚本


**在项目根目录创建`.gitlab-ci.yml`文件：**
```yaml
# 定义任务阶段
stages:
  - test
  - deploy

# 测试任务
hello_world_job:
  stage: test
  script:
    - echo "Hello, GitLab CI/CD!"
    - echo "当前时间: $(date)"
  tags:
    - docker

# 简单的"部署"任务
deploy_job:
  stage: deploy
  script:
    - echo "模拟部署完成"
    - echo "项目已部署到测试环境"
  tags:
    - docker
  only:
    - main
```

> **📝 脚本说明**  
> - `stages`：定义执行阶段，先测试后部署
> - `script`：具体要执行的命令
> - `tags`：指定使用哪个Runner
> - `only`：只在main分支执行

### 6.2 提交代码触发CI/CD


**提交并推送代码：**
```bash
# 添加文件到Git
git add .gitlab-ci.yml
git commit -m "添加CI/CD配置"

# 推送到GitLab
git push origin main
```

### 6.3 查看执行结果


**在GitLab界面查看：**
1. 进入项目，点击左侧"CI/CD" → "Pipelines"
2. 应该看到一个正在运行或已完成的Pipeline
3. 点击Pipeline可以查看详细的执行日志

**🔸 成功的标志：**
- Pipeline状态显示绿色的"passed"
- 能看到"Hello, GitLab CI/CD!"的输出
- 两个任务都显示成功完成

> **🎯 实践应用**  
> 如果看到这些结果，恭喜！你的GitLab CI/CD环境已经搭建成功

---

## 7. 📋 核心要点总结


### 7.1 环境搭建检查清单


```
✅ GitLab账号注册完成
✅ 项目创建并初始化
✅ Docker环境安装并验证
✅ GitLab Runner安装并注册
✅ CI/CD脚本创建并测试通过
```

### 7.2 关键概念理解


**🔸 必须理解的概念：**
- **CI/CD**：自动化的代码集成和部署流程
- **Runner**：执行CI/CD任务的"工人"
- **Pipeline**：一次完整的CI/CD执行流程
- **Job**：Pipeline中的具体任务
- **Docker**：提供标准化运行环境的容器技术

### 7.3 常见问题解决


**❓ 常见疑问：**

**Q：Runner注册失败怎么办？**  
**A：** 检查网络连接，确认URL和Token正确，重试注册命令

**Q：Pipeline执行失败？**  
**A：** 查看具体的错误日志，通常是Runner配置或脚本语法问题

**Q：为什么选择Docker作为Executor？**  
**A：** Docker提供了隔离的执行环境，避免不同项目之间的冲突

### 7.4 下一步学习方向


**🚀 后续学习路径：**
1. **学习编写更复杂的CI/CD脚本**
2. **了解不同类型的测试集成**
3. **掌握多环境部署策略**
4. **学习安全和权限管理**

> **🧠 记忆要点**  
> GitLab CI/CD = 自动化助手，Runner = 具体执行者，Docker = 标准化环境，Pipeline = 完整流程

**核心理念**：把重复的手工操作变成自动化流程，让开发更高效、部署更可靠。掌握了这套环境，你就具备了现代软件开发的基础技能！