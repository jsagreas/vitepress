---
title: 13ã€SSLè¯ä¹¦é…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [SSLè¯ä¹¦åŸºç¡€æ¦‚å¿µ](#1-SSLè¯ä¹¦åŸºç¡€æ¦‚å¿µ)
2. [GitLab SSLé…ç½®æ–¹å¼](#2-GitLab-SSLé…ç½®æ–¹å¼)
3. [è¯ä¹¦æ–‡ä»¶è·¯å¾„é…ç½®](#3-è¯ä¹¦æ–‡ä»¶è·¯å¾„é…ç½®)
4. [Let's Encryptè‡ªåŠ¨è¯ä¹¦](#4-Lets-Encryptè‡ªåŠ¨è¯ä¹¦)
5. [è‡ªç­¾åè¯ä¹¦é…ç½®](#5-è‡ªç­¾åè¯ä¹¦é…ç½®)
6. [è¯ä¹¦é“¾é…ç½®è®¾ç½®](#6-è¯ä¹¦é“¾é…ç½®è®¾ç½®)
7. [HTTPSå¼ºåˆ¶é‡å®šå‘](#7-HTTPSå¼ºåˆ¶é‡å®šå‘)
8. [SSLåè®®å’Œå®‰å…¨é…ç½®](#8-SSLåè®®å’Œå®‰å…¨é…ç½®)
9. [è¯ä¹¦æ›´æ–°ç»´æŠ¤ç­–ç•¥](#9-è¯ä¹¦æ›´æ–°ç»´æŠ¤ç­–ç•¥)
10. [å¸¸è§é—®é¢˜æ’æŸ¥](#10-å¸¸è§é—®é¢˜æ’æŸ¥)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SSLè¯ä¹¦åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSLè¯ä¹¦


**ç®€å•ç†è§£**ï¼šSSLè¯ä¹¦å°±åƒç½‘ç«™çš„"èº«ä»½è¯"ï¼Œè®©æµè§ˆå™¨çŸ¥é“è¿™ä¸ªç½‘ç«™æ˜¯å¯ä¿¡çš„ï¼ŒåŒæ—¶ä¸ºæ•°æ®ä¼ è¾“åŠ å¯†ã€‚

```
æ²¡æœ‰SSLçš„æƒ…å†µï¼š
æµè§ˆå™¨ â†--æ˜æ–‡æ•°æ®--> GitLabæœåŠ¡å™¨
â†“ é£é™©ï¼šæ•°æ®å¯èƒ½è¢«çªƒå¬ã€ç¯¡æ”¹

æœ‰SSLçš„æƒ…å†µï¼š
æµè§ˆå™¨ â†--åŠ å¯†æ•°æ®--> GitLabæœåŠ¡å™¨
â†“ å®‰å…¨ï¼šæ•°æ®åŠ å¯†ä¼ è¾“ï¼Œèº«ä»½éªŒè¯
```

**SSLè¯ä¹¦çš„ä½œç”¨**ï¼š
- ğŸ”’ **æ•°æ®åŠ å¯†**ï¼šä¿æŠ¤æ•°æ®ä¼ è¾“å®‰å…¨
- ğŸ†” **èº«ä»½éªŒè¯**ï¼šè¯æ˜æœåŠ¡å™¨èº«ä»½çœŸå®æ€§
- ğŸ›¡ï¸ **æ•°æ®å®Œæ•´æ€§**ï¼šé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹
- ğŸŒ **æµè§ˆå™¨ä¿¡ä»»**ï¼šæ˜¾ç¤ºç»¿è‰²é”æ ‡è¯†

### 1.2 SSLè¯ä¹¦çš„ç»„æˆéƒ¨åˆ†


**è¯ä¹¦æ–‡ä»¶æ„æˆ**ï¼š
```
SSLè¯ä¹¦åŒ…å«ï¼š
â”œâ”€â”€ å…¬é’¥è¯ä¹¦æ–‡ä»¶ (.crt/.pem)
â”‚   â”œâ”€â”€ ç½‘ç«™åŸŸåä¿¡æ¯
â”‚   â”œâ”€â”€ å…¬é’¥æ•°æ®
â”‚   â”œâ”€â”€ é¢å‘æœºæ„ä¿¡æ¯
â”‚   â””â”€â”€ æœ‰æ•ˆæœŸä¿¡æ¯
â”‚
â”œâ”€â”€ ç§é’¥æ–‡ä»¶ (.key)
â”‚   â””â”€â”€ ç”¨äºè§£å¯†çš„ç§é’¥æ•°æ®
â”‚
â””â”€â”€ è¯ä¹¦é“¾æ–‡ä»¶ (å¯é€‰)
    â”œâ”€â”€ ä¸­é—´è¯ä¹¦
    â””â”€â”€ æ ¹è¯ä¹¦
```

**å…³é”®æ¦‚å¿µè¯´æ˜**ï¼š
- **å…¬é’¥è¯ä¹¦**ï¼šå¯ä»¥å…¬å¼€çš„ï¼ŒåŒ…å«ç½‘ç«™ä¿¡æ¯å’Œå…¬é’¥
- **ç§é’¥**ï¼šå¿…é¡»ä¿å¯†çš„ï¼Œç”¨äºè§£å¯†å’Œç­¾å
- **è¯ä¹¦é“¾**ï¼šä»ç½‘ç«™è¯ä¹¦åˆ°æ ¹è¯ä¹¦çš„ä¿¡ä»»é“¾æ¡

### 1.3 è¯ä¹¦ç±»å‹åŒºåˆ«


| è¯ä¹¦ç±»å‹ | **è·å–æ–¹å¼** | **ä¿¡ä»»åº¦** | **é€‚ç”¨åœºæ™¯** | **æˆæœ¬** |
|---------|------------|----------|-------------|---------|
| ğŸ¢ **å•†ä¸šè¯ä¹¦** | è´­ä¹°CAæœºæ„è¯ä¹¦ | â­â­â­â­â­ | ç”Ÿäº§ç¯å¢ƒã€ä¼ä¸šçº§ | ğŸ’°ğŸ’°ğŸ’° |
| ğŸ†“ **Let's Encrypt** | å…è´¹è‡ªåŠ¨ç”³è¯· | â­â­â­â­ | ä¸­å°å‹é¡¹ç›®ã€ä¸ªäºº | å…è´¹ |
| ğŸ”§ **è‡ªç­¾åè¯ä¹¦** | è‡ªå·±ç”Ÿæˆ | â­â­ | å†…ç½‘ã€æµ‹è¯•ç¯å¢ƒ | å…è´¹ |

---

## 2. âš™ï¸ GitLab SSLé…ç½®æ–¹å¼


### 2.1 GitLabæ”¯æŒçš„SSLé…ç½®æ–¹æ³•


**ä¸»è¦é…ç½®æ–¹å¼**ï¼š
```
GitLab SSLé…ç½®é€‰æ‹©ï¼š

ğŸ”„ è‡ªåŠ¨é…ç½®ï¼ˆæ¨èæ–°æ‰‹ï¼‰
â”œâ”€â”€ Let's Encryptè‡ªåŠ¨è¯ä¹¦
â””â”€â”€ è‡ªåŠ¨ç»­æœŸã€è‡ªåŠ¨é…ç½®

ğŸ”§ æ‰‹åŠ¨é…ç½®
â”œâ”€â”€ å•†ä¸šè¯ä¹¦é…ç½®
â”œâ”€â”€ è‡ªç­¾åè¯ä¹¦é…ç½®
â””â”€â”€ è‡ªå®šä¹‰è¯ä¹¦é…ç½®
```

### 2.2 é…ç½®æ–‡ä»¶ä½ç½®


**é‡è¦æ–‡ä»¶è·¯å¾„**ï¼š
- **ä¸»é…ç½®æ–‡ä»¶**ï¼š`/etc/gitlab/gitlab.rb`
- **è¯ä¹¦å­˜æ”¾ç›®å½•**ï¼š`/etc/gitlab/ssl/`
- **é…ç½®ç”Ÿæ•ˆå‘½ä»¤**ï¼š`gitlab-ctl reconfigure`

### 2.3 åŸºç¡€é…ç½®ç»“æ„


**gitlab.rbä¸­çš„SSLé…ç½®ç»“æ„**ï¼š
```ruby
# åŸºç¡€åŸŸåè®¾ç½®
external_url 'https://gitlab.example.com'

# SSLç›¸å…³é…ç½®å—
nginx['ssl_certificate'] = "è¯ä¹¦æ–‡ä»¶è·¯å¾„"
nginx['ssl_certificate_key'] = "ç§é’¥æ–‡ä»¶è·¯å¾„"
nginx['ssl_protocols'] = "åè®®ç‰ˆæœ¬"
# ... å…¶ä»–SSLé…ç½®
```

---

## 3. ğŸ“ è¯ä¹¦æ–‡ä»¶è·¯å¾„é…ç½®


### 3.1 æ ‡å‡†è¯ä¹¦æ–‡ä»¶å­˜æ”¾


**æ¨èçš„æ–‡ä»¶ç»„ç»‡æ–¹å¼**ï¼š
```
/etc/gitlab/ssl/
â”œâ”€â”€ gitlab.example.com.crt    # ä¸»è¯ä¹¦æ–‡ä»¶
â”œâ”€â”€ gitlab.example.com.key    # ç§é’¥æ–‡ä»¶
â”œâ”€â”€ gitlab.example.com.pem    # è¯ä¹¦é“¾æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ dhparam.pem               # DHå‚æ•°æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
```

> **ğŸ’¡ å°æŠ€å·§**ï¼šæ–‡ä»¶åå»ºè®®ä½¿ç”¨åŸŸåï¼Œä¾¿äºç®¡ç†å¤šä¸ªè¯ä¹¦

### 3.2 è¯ä¹¦è·¯å¾„é…ç½®ç¤ºä¾‹


**åŸºæœ¬é…ç½®æ–¹æ³•**ï¼š
```ruby
# åœ¨ /etc/gitlab/gitlab.rb ä¸­é…ç½®
external_url 'https://gitlab.example.com'

# æŒ‡å®šè¯ä¹¦æ–‡ä»¶è·¯å¾„
nginx['ssl_certificate'] = "/etc/gitlab/ssl/gitlab.example.com.crt"
nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitlab.example.com.key"

# å¦‚æœæœ‰è¯ä¹¦é“¾æ–‡ä»¶
nginx['ssl_trusted_certificate'] = "/etc/gitlab/ssl/gitlab.example.com.pem"
```

### 3.3 æ–‡ä»¶æƒé™è®¾ç½®


**é‡è¦çš„å®‰å…¨è®¾ç½®**ï¼š
```bash
# è¯ä¹¦æ–‡ä»¶æƒé™ï¼ˆå¯è¯»ï¼‰
chmod 644 /etc/gitlab/ssl/gitlab.example.com.crt

# ç§é’¥æ–‡ä»¶æƒé™ï¼ˆä»…rootå¯è¯»ï¼‰
chmod 600 /etc/gitlab/ssl/gitlab.example.com.key

# ç¡®ä¿æ‰€æœ‰è€…æ­£ç¡®
chown root:root /etc/gitlab/ssl/*
```

> **âš ï¸ å®‰å…¨æé†’**ï¼šç§é’¥æ–‡ä»¶æƒé™å¿…é¡»ä¸¥æ ¼æ§åˆ¶ï¼Œåªæœ‰rootç”¨æˆ·å¯è¯»

### 3.4 é…ç½®éªŒè¯æ–¹æ³•


**æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®**ï¼š
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /etc/gitlab/ssl/

# 2. éªŒè¯è¯ä¹¦å†…å®¹
openssl x509 -in /etc/gitlab/ssl/gitlab.example.com.crt -text -noout

# 3. åº”ç”¨é…ç½®
gitlab-ctl reconfigure

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
gitlab-ctl status nginx
```

---

## 4. ğŸ¤– Let's Encryptè‡ªåŠ¨è¯ä¹¦


### 4.1 ä»€ä¹ˆæ˜¯Let's Encrypt


**ç®€å•ç†è§£**ï¼šLet's Encryptæ˜¯ä¸€ä¸ªå…è´¹çš„è¯ä¹¦é¢å‘æœºæ„ï¼Œå¯ä»¥è‡ªåŠ¨ä¸ºä½ çš„ç½‘ç«™ç”³è¯·å’Œç»­æœŸSSLè¯ä¹¦ã€‚

**ä¸»è¦ä¼˜åŠ¿**ï¼š
- ğŸ’° **å®Œå…¨å…è´¹**ï¼šä¸éœ€è¦ä»˜è´¹
- ğŸ”„ **è‡ªåŠ¨ç»­æœŸ**ï¼šä¸ç”¨æ‹…å¿ƒè¯ä¹¦è¿‡æœŸ
- ğŸš€ **é…ç½®ç®€å•**ï¼šGitLabå†…ç½®æ”¯æŒ
- ğŸŒ **å¹¿æ³›ä¿¡ä»»**ï¼šæ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½ä¿¡ä»»

### 4.2 å¯ç”¨Let's Encrypt


**ä¸€é”®å¯ç”¨æ–¹æ³•**ï¼š
```ruby
# åœ¨ /etc/gitlab/gitlab.rb ä¸­é…ç½®
external_url 'https://gitlab.example.com'

# å¯ç”¨Let's Encrypt
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@example.com']
```

**é…ç½®è¯´æ˜**ï¼š
- `external_url`ï¼šå¿…é¡»æ˜¯httpså¼€å¤´
- `contact_emails`ï¼šç”¨äºè¯ä¹¦åˆ°æœŸæé†’

### 4.3 Let's Encrypté«˜çº§é…ç½®


**è¯¦ç»†é…ç½®é€‰é¡¹**ï¼š
```ruby
# åŸºç¡€è®¾ç½®
letsencrypt['enable'] = true
letsencrypt['contact_emails'] = ['admin@example.com', 'security@example.com']

# è‡ªåŠ¨ç»­æœŸè®¾ç½®
letsencrypt['auto_renew'] = true
letsencrypt['auto_renew_hour'] = 2
letsencrypt['auto_renew_minute'] = 30
letsencrypt['auto_renew_day_of_month'] = "*/7"

# åŸŸåéªŒè¯æ–¹å¼
letsencrypt['group'] = 'root'
letsencrypt['key_size'] = 2048
```

**é…ç½®å‚æ•°è§£é‡Š**ï¼š
- `auto_renew`ï¼šæ˜¯å¦è‡ªåŠ¨ç»­æœŸï¼ˆå»ºè®®trueï¼‰
- `auto_renew_hour`ï¼šç»­æœŸæ£€æŸ¥æ—¶é—´ï¼ˆå»ºè®®å‡Œæ™¨ï¼‰
- `key_size`ï¼šå¯†é’¥é•¿åº¦ï¼ˆ2048æˆ–4096ï¼‰

### 4.4 æ‰‹åŠ¨ç»­æœŸæ“ä½œ


**å½“éœ€è¦æ‰‹åŠ¨å¤„ç†æ—¶**ï¼š
```bash
# æ‰‹åŠ¨ç»­æœŸè¯ä¹¦
gitlab-ctl renew-lets-encrypt-certs

# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
gitlab-ctl lets-encrypt-status

# æŸ¥çœ‹ç»­æœŸæ—¥å¿—
tail -f /var/log/gitlab/letsencrypt/letsencrypt.log
```

### 4.5 Let's Encryptæ•…éšœæ’æŸ¥


**å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•**ï¼š

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|---------|------------|-------------|
| ğŸš« ç”³è¯·å¤±è´¥ | åŸŸåDNSæœªç”Ÿæ•ˆ | æ£€æŸ¥åŸŸåè§£ææ˜¯å¦æ­£ç¡® |
| âŒ 80ç«¯å£æ— æ³•è®¿é—® | é˜²ç«å¢™æ‹¦æˆª | å¼€æ”¾80ç«¯å£ç”¨äºéªŒè¯ |
| â° ç»­æœŸå¤±è´¥ | æœåŠ¡å¼‚å¸¸ | æ£€æŸ¥gitlab-ctlçŠ¶æ€ |

---

## 5. ğŸ”§ è‡ªç­¾åè¯ä¹¦é…ç½®


### 5.1 ä»€ä¹ˆæ˜¯è‡ªç­¾åè¯ä¹¦


**ç®€å•ç†è§£**ï¼šè‡ªç­¾åè¯ä¹¦å°±æ˜¯"è‡ªå·±ç»™è‡ªå·±ç­¾å‘çš„èº«ä»½è¯"ï¼Œè™½ç„¶ä¸è¢«å…¬å…±CAæœºæ„è®¤å¯ï¼Œä½†åœ¨å†…ç½‘ç¯å¢ƒä¸‹å¾ˆå®ç”¨ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ğŸ  **å†…ç½‘ç¯å¢ƒ**ï¼šå…¬å¸å†…éƒ¨GitLabæœåŠ¡å™¨
- ğŸ§ª **æµ‹è¯•ç¯å¢ƒ**ï¼šå¼€å‘å’Œæµ‹è¯•é˜¶æ®µ
- ğŸ’° **æˆæœ¬è€ƒè™‘**ï¼šä¸æƒ³è´­ä¹°å•†ä¸šè¯ä¹¦
- ğŸ”’ **ç¦»çº¿ç¯å¢ƒ**ï¼šæ— æ³•è®¿é—®å¤–ç½‘çš„ç¯å¢ƒ

### 5.2 ç”Ÿæˆè‡ªç­¾åè¯ä¹¦


**ç”Ÿæˆè¯ä¹¦çš„æ­¥éª¤**ï¼š
```bash
# 1. åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½•
mkdir -p /etc/gitlab/ssl
cd /etc/gitlab/ssl

# 2. ç”Ÿæˆç§é’¥
openssl genrsa -out gitlab.example.com.key 2048

# 3. ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚
openssl req -new -key gitlab.example.com.key -out gitlab.example.com.csr

# 4. ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆæœ‰æ•ˆæœŸ365å¤©ï¼‰
openssl x509 -req -days 365 -in gitlab.example.com.csr \
  -signkey gitlab.example.com.key -out gitlab.example.com.crt

# 5. è®¾ç½®æ­£ç¡®æƒé™
chmod 600 gitlab.example.com.key
chmod 644 gitlab.example.com.crt
```

### 5.3 ä¸€é”®ç”Ÿæˆè„šæœ¬


**ä¾¿æ·çš„ç”Ÿæˆè„šæœ¬**ï¼š
```bash
#!/bin/bash
# è‡ªç­¾åè¯ä¹¦ä¸€é”®ç”Ÿæˆè„šæœ¬

DOMAIN="gitlab.example.com"
SSL_DIR="/etc/gitlab/ssl"

# åˆ›å»ºç›®å½•
mkdir -p $SSL_DIR
cd $SSL_DIR

# ç”Ÿæˆè¯ä¹¦ï¼ˆè‡ªåŠ¨å¡«å…¥ä¿¡æ¯ï¼‰
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout ${DOMAIN}.key \
  -out ${DOMAIN}.crt \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=Company/CN=${DOMAIN}"

# è®¾ç½®æƒé™
chmod 600 ${DOMAIN}.key
chmod 644 ${DOMAIN}.crt

echo "è‡ªç­¾åè¯ä¹¦ç”Ÿæˆå®Œæˆ: $SSL_DIR"
```

### 5.4 è‡ªç­¾åè¯ä¹¦é…ç½®


**GitLabé…ç½®æ–¹æ³•**ï¼š
```ruby
# /etc/gitlab/gitlab.rb
external_url 'https://gitlab.example.com'

nginx['ssl_certificate'] = "/etc/gitlab/ssl/gitlab.example.com.crt"
nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitlab.example.com.key"

# ç”±äºæ˜¯è‡ªç­¾åï¼Œéœ€è¦ç¦ç”¨è¯ä¹¦éªŒè¯çš„æŸäº›æ£€æŸ¥
nginx['ssl_verify_client'] = "off"
```

### 5.5 å®¢æˆ·ç«¯ä¿¡ä»»è®¾ç½®


**è®©æµè§ˆå™¨ä¿¡ä»»è‡ªç­¾åè¯ä¹¦**ï¼š

**æ–¹æ³•ä¸€ï¼šæ·»åŠ åˆ°æµè§ˆå™¨ä¿¡ä»»åˆ—è¡¨**
1. è®¿é—®GitLabåœ°å€ï¼Œæµè§ˆå™¨ä¼šè­¦å‘Š
2. ç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­è®¿é—®"
3. åœ¨åœ°å€æ ç‚¹å‡»é”å›¾æ ‡ â†’ "è¯ä¹¦ä¿¡æ¯" â†’ "å®‰è£…è¯ä¹¦"

**æ–¹æ³•äºŒï¼šæ·»åŠ åˆ°ç³»ç»Ÿä¿¡ä»»å­˜å‚¨**
```bash
# Linuxç³»ç»Ÿ
cp /etc/gitlab/ssl/gitlab.example.com.crt /usr/local/share/ca-certificates/
update-ca-certificates

# Windowsç³»ç»Ÿï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
certlm.msc â†’ å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„ â†’ å¯¼å…¥è¯ä¹¦
```

---

## 6. ğŸ”— è¯ä¹¦é“¾é…ç½®è®¾ç½®


### 6.1 ä»€ä¹ˆæ˜¯è¯ä¹¦é“¾


**ç®€å•ç†è§£**ï¼šè¯ä¹¦é“¾å°±åƒä¸€æ¡"ä¿¡ä»»é“¾æ¡"ï¼Œä»ä½ çš„ç½‘ç«™è¯ä¹¦ä¸€ç›´è¿½æº¯åˆ°æµè§ˆå™¨ä¿¡ä»»çš„æ ¹è¯ä¹¦ã€‚

```
è¯ä¹¦ä¿¡ä»»é“¾ç¤ºä¾‹ï¼š
â”œâ”€â”€ æ ¹è¯ä¹¦ (Root CA) â† æµè§ˆå™¨å†…ç½®ä¿¡ä»»
â”‚   â””â”€â”€ ä¸­é—´è¯ä¹¦ (Intermediate CA) â† CAæœºæ„ç­¾å‘
â”‚       â””â”€â”€ ç½‘ç«™è¯ä¹¦ (End-entity) â† ä½ çš„GitLabè¯ä¹¦
```

**ä¸ºä»€ä¹ˆéœ€è¦è¯ä¹¦é“¾**ï¼š
- ğŸ”— **å»ºç«‹ä¿¡ä»»**ï¼šè¿æ¥ä½ çš„è¯ä¹¦åˆ°å¯ä¿¡æ ¹è¯ä¹¦
- ğŸŒ **æµè§ˆå™¨å…¼å®¹**ï¼šç¡®ä¿æ‰€æœ‰æµè§ˆå™¨éƒ½èƒ½éªŒè¯
- ğŸ›¡ï¸ **å®‰å…¨æ€§**ï¼šå®Œæ•´çš„ä¿¡ä»»é“¾æ¡

### 6.2 è¯ä¹¦é“¾æ–‡ä»¶æ ¼å¼


**æ ‡å‡†è¯ä¹¦é“¾æ–‡ä»¶ç»“æ„**ï¼š
```
-----BEGIN CERTIFICATE-----
[ä½ çš„ç½‘ç«™è¯ä¹¦å†…å®¹]
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
[ä¸­é—´è¯ä¹¦å†…å®¹]
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
[æ ¹è¯ä¹¦å†…å®¹ - å¯é€‰]
-----END CERTIFICATE-----
```

### 6.3 é…ç½®è¯ä¹¦é“¾


**GitLabä¸­çš„è¯ä¹¦é“¾é…ç½®**ï¼š
```ruby
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨å•ç‹¬çš„è¯ä¹¦é“¾æ–‡ä»¶
nginx['ssl_certificate'] = "/etc/gitlab/ssl/gitlab.example.com.crt"
nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitlab.example.com.key"
nginx['ssl_trusted_certificate'] = "/etc/gitlab/ssl/gitlab.example.com.chain.pem"

# æ–¹æ³•äºŒï¼šå°†è¯ä¹¦é“¾åˆå¹¶åˆ°ä¸»è¯ä¹¦æ–‡ä»¶ä¸­
nginx['ssl_certificate'] = "/etc/gitlab/ssl/gitlab.example.com.fullchain.crt"
nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitlab.example.com.key"
```

### 6.4 è¯ä¹¦é“¾éªŒè¯


**æ£€æŸ¥è¯ä¹¦é“¾æ˜¯å¦æ­£ç¡®**ï¼š
```bash
# 1. åœ¨çº¿éªŒè¯å·¥å…·
# è®¿é—®ï¼šhttps://www.ssllabs.com/ssltest/

# 2. å‘½ä»¤è¡ŒéªŒè¯
openssl s_client -connect gitlab.example.com:443 -showcerts

# 3. æ£€æŸ¥è¯ä¹¦é“¾å®Œæ•´æ€§
openssl verify -CAfile /etc/ssl/certs/ca-certificates.crt \
  /etc/gitlab/ssl/gitlab.example.com.crt
```

### 6.5 å¸¸è§è¯ä¹¦é“¾é—®é¢˜


**é—®é¢˜æ’æŸ¥æŒ‡å—**ï¼š

| ç—‡çŠ¶ | **åŸå› ** | **è§£å†³æ–¹æ³•** |
|------|----------|-------------|
| ğŸ”´ æµè§ˆå™¨æ˜¾ç¤º"ä¸å®‰å…¨" | è¯ä¹¦é“¾ä¸å®Œæ•´ | æ·»åŠ ä¸­é—´è¯ä¹¦åˆ°é“¾æ–‡ä»¶ |
| âš ï¸ éƒ¨åˆ†æµè§ˆå™¨æŠ¥é”™ | ç¼ºå°‘ä¸­é—´è¯ä¹¦ | ä»CAè·å–å®Œæ•´è¯ä¹¦é“¾ |
| ğŸš« ç§»åŠ¨ç«¯æ— æ³•è®¿é—® | è¯ä¹¦é“¾é¡ºåºé”™è¯¯ | é‡æ–°æ’åˆ—è¯ä¹¦é¡ºåº |

---

## 7. ğŸ”„ HTTPSå¼ºåˆ¶é‡å®šå‘


### 7.1 ä»€ä¹ˆæ˜¯HTTPSé‡å®šå‘


**ç®€å•ç†è§£**ï¼šHTTPSé‡å®šå‘å°±æ˜¯å½“ç”¨æˆ·è®¿é—®HTTPç‰ˆæœ¬çš„ç½‘ç«™æ—¶ï¼Œè‡ªåŠ¨è·³è½¬åˆ°HTTPSç‰ˆæœ¬ï¼Œç¡®ä¿æ‰€æœ‰è®¿é—®éƒ½æ˜¯å®‰å…¨çš„ã€‚

```
ç”¨æˆ·è®¿é—®æµç¨‹ï¼š
http://gitlab.example.com
        â†“ (è‡ªåŠ¨é‡å®šå‘)
https://gitlab.example.com â† å®‰å…¨è¿æ¥
```

### 7.2 GitLabé‡å®šå‘é…ç½®


**åŸºç¡€é‡å®šå‘è®¾ç½®**ï¼š
```ruby
# /etc/gitlab/gitlab.rb
external_url 'https://gitlab.example.com'

# å¯ç”¨HTTPåˆ°HTTPSé‡å®šå‘
nginx['redirect_http_to_https'] = true

# è®¾ç½®é‡å®šå‘çŠ¶æ€ç ï¼ˆæ¨è301æ°¸ä¹…é‡å®šå‘ï¼‰
nginx['redirect_http_to_https_port_80'] = true
```

### 7.3 é«˜çº§é‡å®šå‘é…ç½®


**è‡ªå®šä¹‰é‡å®šå‘è¡Œä¸º**ï¼š
```ruby
# é‡å®šå‘é…ç½®é€‰é¡¹
nginx['redirect_http_to_https'] = true
nginx['redirect_http_to_https_port_80'] = true

# SSLç«¯å£è®¾ç½®
nginx['ssl_port'] = 443
nginx['listen_port'] = 80

# è‡ªå®šä¹‰é‡å®šå‘å“åº”
nginx['custom_nginx_config'] = "
  add_header Strict-Transport-Security 'max-age=31536000; includeSubDomains; preload';
"
```

### 7.4 HSTSå®‰å…¨å¤´é…ç½®


**ä»€ä¹ˆæ˜¯HSTS**ï¼šHTTPä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼Œå‘Šè¯‰æµè§ˆå™¨"è¿™ä¸ªç½‘ç«™åªèƒ½ç”¨HTTPSè®¿é—®"ã€‚

```ruby
# å¯ç”¨HSTS
nginx['hsts_max_age'] = 63072000  # 2å¹´
nginx['hsts_include_subdomains'] = true

# æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
nginx['custom_nginx_config'] = "
  add_header Strict-Transport-Security 'max-age=63072000; includeSubDomains; preload' always;
  add_header X-Frame-Options DENY always;
  add_header X-Content-Type-Options nosniff always;
"
```

**HSTSå‚æ•°è¯´æ˜**ï¼š
- `max-age`ï¼šæµè§ˆå™¨è®°ä½çš„æ—¶é—´ï¼ˆç§’ï¼‰
- `includeSubDomains`ï¼šæ˜¯å¦åŒ…å«å­åŸŸå
- `preload`ï¼šæ˜¯å¦åŠ å…¥HSTSé¢„åŠ è½½åˆ—è¡¨

### 7.5 é‡å®šå‘æµ‹è¯•éªŒè¯


**éªŒè¯é‡å®šå‘æ˜¯å¦å·¥ä½œ**ï¼š
```bash
# 1. æµ‹è¯•HTTPé‡å®šå‘
curl -I http://gitlab.example.com

# æœŸæœ›çœ‹åˆ°ï¼š
# HTTP/1.1 301 Moved Permanently
# Location: https://gitlab.example.com/

# 2. æµ‹è¯•HTTPSè®¿é—®
curl -I https://gitlab.example.com

# 3. æ£€æŸ¥HSTSå¤´
curl -I https://gitlab.example.com | grep -i strict
```

---

## 8. ğŸ”’ SSLåè®®å’Œå®‰å…¨é…ç½®


### 8.1 SSL/TLSåè®®ç‰ˆæœ¬


**åè®®ç‰ˆæœ¬çš„å®‰å…¨æ€§**ï¼š
```
åè®®å®‰å…¨ç­‰çº§ï¼š
âŒ SSL 2.0/3.0  â† å·²åºŸå¼ƒï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨æ¼æ´
âŒ TLS 1.0/1.1  â† è¿‡æ—¶åè®®ï¼Œä¸å»ºè®®ä½¿ç”¨
âœ… TLS 1.2      â† å®‰å…¨åè®®ï¼Œå¹¿æ³›æ”¯æŒ
ğŸš€ TLS 1.3      â† æœ€æ–°åè®®ï¼Œæœ€é«˜å®‰å…¨æ€§
```

### 8.2 åè®®ç‰ˆæœ¬é…ç½®


**æ¨èçš„åè®®é…ç½®**ï¼š
```ruby
# åªå…è®¸å®‰å…¨çš„TLSåè®®ç‰ˆæœ¬
nginx['ssl_protocols'] = "TLSv1.2 TLSv1.3"

# å¯†ç å¥—ä»¶é…ç½®ï¼ˆé«˜å®‰å…¨æ€§ï¼‰
nginx['ssl_ciphers'] = "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"

# ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨ç«¯å¯†ç å¥—ä»¶
nginx['ssl_prefer_server_ciphers'] = "on"
```

### 8.3 å¯†ç å¥—ä»¶å®‰å…¨é…ç½®


**å¯†ç å¥—ä»¶çš„é€‰æ‹©åŸåˆ™**ï¼š
- ğŸ” **ä¼˜å…ˆé€‰æ‹©ECDHE**ï¼šæä¾›å‰å‘å®‰å…¨æ€§
- ğŸš€ **ä½¿ç”¨GCMæ¨¡å¼**ï¼šæ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨æ€§
- ğŸ“ **å¯†é’¥é•¿åº¦è¶³å¤Ÿ**ï¼šè‡³å°‘256ä½

**ç°ä»£æµè§ˆå™¨å…¼å®¹é…ç½®**ï¼š
```ruby
# ç°ä»£æµè§ˆå™¨é…ç½®ï¼ˆé«˜å®‰å…¨æ€§ï¼‰
nginx['ssl_ciphers'] = "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"

# å…¼å®¹æ€§é…ç½®ï¼ˆæ”¯æŒè¾ƒè€æµè§ˆå™¨ï¼‰
nginx['ssl_ciphers'] = "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256"
```

### 8.4 DHå‚æ•°é…ç½®


**ä»€ä¹ˆæ˜¯DHå‚æ•°**ï¼šDiffie-Hellmanå‚æ•°ç”¨äºå¯†é’¥äº¤æ¢ï¼Œæé«˜å®‰å…¨æ€§ã€‚

```bash
# ç”ŸæˆDHå‚æ•°æ–‡ä»¶ï¼ˆéœ€è¦ä¸€äº›æ—¶é—´ï¼‰
openssl dhparam -out /etc/gitlab/ssl/dhparam.pem 2048

# åœ¨GitLabä¸­é…ç½®
nginx['ssl_dhparam'] = "/etc/gitlab/ssl/dhparam.pem"
```

### 8.5 SSLä¼šè¯é…ç½®


**ä¼šè¯ä¼˜åŒ–é…ç½®**ï¼š
```ruby
# SSLä¼šè¯ç¼“å­˜ï¼ˆæé«˜æ€§èƒ½ï¼‰
nginx['ssl_session_cache'] = "shared:SSL:10m"
nginx['ssl_session_timeout'] = "10m"

# ä¼šè¯ç¥¨æ®ï¼ˆSession Ticketsï¼‰
nginx['ssl_session_tickets'] = "off"  # å…³é—­ä»¥æé«˜å®‰å…¨æ€§
```

---

## 9. ğŸ”„ è¯ä¹¦æ›´æ–°ç»´æŠ¤ç­–ç•¥


### 9.1 è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†


**è¯ä¹¦ç®¡ç†çš„é‡è¦æ—¶é—´ç‚¹**ï¼š
```
è¯ä¹¦ç”Ÿå‘½å‘¨æœŸï¼š
ç”³è¯· â† 30å¤©å‰  â† 7å¤©å‰  â† è¿‡æœŸæ—¥  â† è¿‡æœŸå
  â†“      â†“        â†“        â†“        â†“
å®‰è£…   ç›‘æ§æé†’   ç´§æ€¥æ›´æ–°   æœåŠ¡ä¸­æ–­  å®¢æˆ·æŠ•è¯‰
```

### 9.2 è‡ªåŠ¨ç›‘æ§è¯ä¹¦åˆ°æœŸ


**ç›‘æ§è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# è¯ä¹¦åˆ°æœŸæ£€æŸ¥è„šæœ¬

DOMAIN="gitlab.example.com"
CERT_FILE="/etc/gitlab/ssl/${DOMAIN}.crt"
ALERT_DAYS=30

# è·å–è¯ä¹¦åˆ°æœŸæ—¶é—´
EXPIRE_DATE=$(openssl x509 -enddate -noout -in $CERT_FILE | cut -d= -f2)
EXPIRE_TIMESTAMP=$(date -d "$EXPIRE_DATE" +%s)
CURRENT_TIMESTAMP=$(date +%s)

# è®¡ç®—å‰©ä½™å¤©æ•°
DAYS_LEFT=$(( (EXPIRE_TIMESTAMP - CURRENT_TIMESTAMP) / 86400 ))

if [ $DAYS_LEFT -lt $ALERT_DAYS ]; then
    echo "è­¦å‘Šï¼šSSLè¯ä¹¦å°†åœ¨ $DAYS_LEFT å¤©åè¿‡æœŸï¼"
    # è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ä»¶é€šçŸ¥æˆ–å…¶ä»–å‘Šè­¦æœºåˆ¶
fi
```

### 9.3 Let's Encryptè‡ªåŠ¨ç»­æœŸ


**ç¡®ä¿è‡ªåŠ¨ç»­æœŸæ­£å¸¸å·¥ä½œ**ï¼š
```bash
# æŸ¥çœ‹è‡ªåŠ¨ç»­æœŸé…ç½®
crontab -l | grep letsencrypt

# æ‰‹åŠ¨æµ‹è¯•ç»­æœŸï¼ˆdry-runæ¨¡å¼ï¼‰
gitlab-ctl renew-lets-encrypt-certs --dry-run

# æŸ¥çœ‹ç»­æœŸæ—¥å¿—
tail -f /var/log/gitlab/letsencrypt/letsencrypt.log
```

### 9.4 å•†ä¸šè¯ä¹¦æ›´æ–°æµç¨‹


**æ ‡å‡†æ›´æ–°æµç¨‹**ï¼š
```
è¯ä¹¦æ›´æ–°æ­¥éª¤ï¼š
1. ğŸ“… ç›‘æ§åˆ°æœŸæ—¶é—´
2. ğŸ›’ æå‰30å¤©é‡‡è´­æ–°è¯ä¹¦
3. ğŸ“¥ ä¸‹è½½æ–°è¯ä¹¦æ–‡ä»¶
4. ğŸ”§ å¤‡ä»½å½“å‰è¯ä¹¦
5. ğŸ“ æ›¿æ¢è¯ä¹¦æ–‡ä»¶
6. âš™ï¸ é‡è½½GitLabé…ç½®
7. âœ… éªŒè¯æ–°è¯ä¹¦ç”Ÿæ•ˆ
8. ğŸ“ è®°å½•æ›´æ–°æ—¥å¿—
```

**æ›´æ–°æ“ä½œç¤ºä¾‹**ï¼š
```bash
# 1. å¤‡ä»½ç°æœ‰è¯ä¹¦
cp /etc/gitlab/ssl/gitlab.example.com.crt /etc/gitlab/ssl/backup/
cp /etc/gitlab/ssl/gitlab.example.com.key /etc/gitlab/ssl/backup/

# 2. æ›¿æ¢æ–°è¯ä¹¦
mv new-certificate.crt /etc/gitlab/ssl/gitlab.example.com.crt
mv new-private.key /etc/gitlab/ssl/gitlab.example.com.key

# 3. è®¾ç½®æƒé™
chmod 644 /etc/gitlab/ssl/gitlab.example.com.crt
chmod 600 /etc/gitlab/ssl/gitlab.example.com.key

# 4. é‡è½½é…ç½®
gitlab-ctl reconfigure

# 5. éªŒè¯è¯ä¹¦
openssl x509 -in /etc/gitlab/ssl/gitlab.example.com.crt -text -noout | grep "Not After"
```

### 9.5 è¯ä¹¦æ›´æ–°åéªŒè¯


**éªŒè¯æ–°è¯ä¹¦çš„æ£€æŸ¥é¡¹**ï¼š
- âœ… **è¯ä¹¦æœ‰æ•ˆæœŸ**ï¼šç¡®è®¤æ–°çš„åˆ°æœŸæ—¶é—´
- âœ… **åŸŸååŒ¹é…**ï¼šæ£€æŸ¥è¯ä¹¦åŸŸåæ˜¯å¦æ­£ç¡®
- âœ… **è¯ä¹¦é“¾å®Œæ•´**ï¼šéªŒè¯æ•´ä¸ªä¿¡ä»»é“¾
- âœ… **æµè§ˆå™¨è®¿é—®**ï¼šæµ‹è¯•å„ç§æµè§ˆå™¨è®¿é—®
- âœ… **ç§»åŠ¨ç«¯æµ‹è¯•**ï¼šç¡®ä¿ç§»åŠ¨è®¾å¤‡ä¹Ÿèƒ½æ­£å¸¸è®¿é—®

---

## 10. ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥


### 10.1 è¯ä¹¦ç›¸å…³é”™è¯¯


**å¸¸è§SSLé”™è¯¯åŠè§£å†³æ–¹æ³•**ï¼š

| é”™è¯¯ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|---------|------------|-------------|
| ğŸš« "è¯ä¹¦ä¸å—ä¿¡ä»»" | è‡ªç­¾åè¯ä¹¦æˆ–è¯ä¹¦é“¾ä¸å®Œæ•´ | æ·»åŠ åˆ°ä¿¡ä»»åˆ—è¡¨æˆ–è¡¥å…¨è¯ä¹¦é“¾ |
| âš ï¸ "åŸŸåä¸åŒ¹é…" | è¯ä¹¦åŸŸåä¸è®¿é—®åŸŸåä¸ç¬¦ | é‡æ–°ç”³è¯·æ­£ç¡®åŸŸåçš„è¯ä¹¦ |
| âŒ "è¯ä¹¦å·²è¿‡æœŸ" | è¯ä¹¦è¶…è¿‡æœ‰æ•ˆæœŸ | æ›´æ–°è¯ä¹¦å¹¶é‡è½½é…ç½® |
| ğŸ”´ SSLæ¡æ‰‹å¤±è´¥ | åè®®ç‰ˆæœ¬ä¸å…¼å®¹ | è°ƒæ•´SSLåè®®é…ç½® |

### 10.2 GitLab SSLé…ç½®é—®é¢˜


**é…ç½®é—®é¢˜è¯Šæ–­**ï¼š
```bash
# 1. æ£€æŸ¥GitLabé…ç½®è¯­æ³•
gitlab-ctl check-config

# 2. æŸ¥çœ‹nginxé…ç½®
cat /var/opt/gitlab/nginx/conf/gitlab-http.conf

# 3. æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æƒé™
ls -la /etc/gitlab/ssl/

# 4. æŸ¥çœ‹SSLç›¸å…³æ—¥å¿—
tail -f /var/log/gitlab/nginx/error.log
```

### 10.3 ç½‘ç»œè¿é€šæ€§é—®é¢˜


**ç½‘ç»œå±‚é¢çš„æ£€æŸ¥**ï¼š
```bash
# 1. æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -tlnp | grep :443

# 2. é˜²ç«å¢™æ£€æŸ¥
iptables -L | grep 443

# 3. å¤–éƒ¨è¿é€šæ€§æµ‹è¯•
telnet gitlab.example.com 443

# 4. SSLæ¡æ‰‹æµ‹è¯•
openssl s_client -connect gitlab.example.com:443
```

### 10.4 æ€§èƒ½ç›¸å…³é—®é¢˜


**SSLæ€§èƒ½ä¼˜åŒ–æ’æŸ¥**ï¼š
```bash
# 1. æŸ¥çœ‹SSLä¼šè¯ç¼“å­˜ä½¿ç”¨æƒ…å†µ
gitlab-ctl tail nginx | grep ssl

# 2. æ£€æŸ¥å¯†ç å¥—ä»¶é€‰æ‹©
openssl s_client -connect gitlab.example.com:443 -cipher 'HIGH:!aNULL'

# 3. æµ‹è¯•ä¸åŒTLSç‰ˆæœ¬çš„è¿æ¥æ—¶é—´
time openssl s_client -connect gitlab.example.com:443 -tls1_2 < /dev/null
```

### 10.5 åº”æ€¥å¤„ç†æ–¹æ¡ˆ


**SSLé—®é¢˜çš„åº”æ€¥æªæ–½**ï¼š

**æ–¹æ¡ˆä¸€ï¼šä¸´æ—¶ç¦ç”¨SSL**
```ruby
# ç´§æ€¥æƒ…å†µä¸‹ä¸´æ—¶ä½¿ç”¨HTTP
external_url 'http://gitlab.example.com'
# é‡è½½é…ç½®
gitlab-ctl reconfigure
```

**æ–¹æ¡ˆäºŒï¼šä½¿ç”¨è‡ªç­¾åè¯ä¹¦**
```bash
# å¿«é€Ÿç”Ÿæˆä¸´æ—¶è¯ä¹¦
openssl req -x509 -nodes -days 90 -newkey rsa:2048 \
  -keyout /etc/gitlab/ssl/temp.key \
  -out /etc/gitlab/ssl/temp.crt \
  -subj "/CN=gitlab.example.com"
```

**æ–¹æ¡ˆä¸‰ï¼šè¯ä¹¦å›æ»š**
```bash
# æ¢å¤å¤‡ä»½çš„è¯ä¹¦
cp /etc/gitlab/ssl/backup/gitlab.example.com.crt /etc/gitlab/ssl/
cp /etc/gitlab/ssl/backup/gitlab.example.com.key /etc/gitlab/ssl/
gitlab-ctl reconfigure
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ” SSLè¯ä¹¦æœ¬è´¨ï¼šç½‘ç«™çš„æ•°å­—èº«ä»½è¯ï¼Œæä¾›åŠ å¯†å’Œèº«ä»½éªŒè¯
ğŸ”§ é…ç½®æ–¹å¼ï¼šLet's Encryptè‡ªåŠ¨ã€å•†ä¸šè¯ä¹¦æ‰‹åŠ¨ã€è‡ªç­¾åæµ‹è¯•
ğŸ“ æ–‡ä»¶ç®¡ç†ï¼šè¯ä¹¦æ–‡ä»¶ã€ç§é’¥æ–‡ä»¶ã€è¯ä¹¦é“¾æ–‡ä»¶çš„æ­£ç¡®å­˜æ”¾
ğŸ”„ è‡ªåŠ¨ç»­æœŸï¼šLet's Encryptçš„è‡ªåŠ¨ç»­æœŸæœºåˆ¶
ğŸ›¡ï¸ å®‰å…¨é…ç½®ï¼šTLSåè®®ç‰ˆæœ¬ã€å¯†ç å¥—ä»¶ã€HSTSç­‰å®‰å…¨ç­–ç•¥
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¯ä¹¦ç±»å‹é€‰æ‹©åŸåˆ™**
```
ç”Ÿäº§ç¯å¢ƒï¼š
âœ… å•†ä¸šè¯ä¹¦ â†’ æœ€é«˜ä¿¡ä»»åº¦ï¼Œä¼ä¸šçº§æ”¯æŒ
âœ… Let's Encrypt â†’ å…è´¹è‡ªåŠ¨ï¼Œä¸­å°é¡¹ç›®é¦–é€‰

æµ‹è¯•ç¯å¢ƒï¼š
âœ… è‡ªç­¾åè¯ä¹¦ â†’ æˆæœ¬æœ€ä½ï¼Œå†…ç½‘ç¯å¢ƒé€‚ç”¨
```

**ğŸ”¹ å®‰å…¨é…ç½®æœ€ä½³å®è·µ**
```
åè®®é…ç½®ï¼šåªå¯ç”¨TLS 1.2å’Œ1.3
å¯†ç å¥—ä»¶ï¼šä¼˜å…ˆECDHEï¼Œä½¿ç”¨GCMæ¨¡å¼
æ–‡ä»¶æƒé™ï¼šç§é’¥600ï¼Œè¯ä¹¦644
é‡å®šå‘ï¼šå¼ºåˆ¶HTTPåˆ°HTTPS
ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥è¯ä¹¦åˆ°æœŸæ—¶é—´
```

**ğŸ”¹ æ•…éšœæ’æŸ¥æ€è·¯**
```
æ£€æŸ¥é¡ºåºï¼š
1. æ–‡ä»¶å­˜åœ¨æ€§å’Œæƒé™
2. é…ç½®è¯­æ³•æ­£ç¡®æ€§
3. ç½‘ç»œè¿é€šæ€§
4. è¯ä¹¦æœ‰æ•ˆæ€§
5. æµè§ˆå™¨å…¼å®¹æ€§
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒå»ºè®®**
- **ä¼ä¸šçº§éƒ¨ç½²**ï¼šä½¿ç”¨å•†ä¸šSSLè¯ä¹¦ï¼Œé…ç½®å®Œæ•´è¯ä¹¦é“¾
- **ä¸­å°å‹é¡¹ç›®**ï¼šLet's Encryptè‡ªåŠ¨è¯ä¹¦ï¼Œé…ç½®è‡ªåŠ¨ç»­æœŸ
- **å†…ç½‘ç¯å¢ƒ**ï¼šè‡ªç­¾åè¯ä¹¦ï¼Œæ·»åŠ åˆ°ä¼ä¸šä¿¡ä»»åˆ—è¡¨
- **é«˜å®‰å…¨è¦æ±‚**ï¼šä½¿ç”¨EVè¯ä¹¦ï¼Œå¯ç”¨HSTSå’Œå…¶ä»–å®‰å…¨å¤´

**ğŸ”§ è¿ç»´æœ€ä½³å®è·µ**
- **ç›‘æ§å‘Šè­¦**ï¼šæå‰30å¤©è¯ä¹¦åˆ°æœŸæé†’
- **å¤‡ä»½ç­–ç•¥**ï¼šä¿ç•™è¯ä¹¦å¤‡ä»½ï¼Œä¾¿äºå¿«é€Ÿæ¢å¤
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•è¯ä¹¦æ›´æ–°å†å²å’Œé…ç½®å˜æ›´
- **æµ‹è¯•éªŒè¯**ï¼šæ¯æ¬¡æ›´æ–°åè¿›è¡Œå…¨é¢åŠŸèƒ½æµ‹è¯•

**ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- **ä¼šè¯ç¼“å­˜**ï¼šå¯ç”¨SSLä¼šè¯ç¼“å­˜æé«˜æ€§èƒ½
- **OCSPè£…è®¢**ï¼šå‡å°‘å®¢æˆ·ç«¯éªŒè¯æ—¶é—´
- **HTTP/2**ï¼šé…åˆSSLä½¿ç”¨HTTP/2åè®®
- **CDNåŠ é€Ÿ**ï¼šä½¿ç”¨CDNåˆ†æ‹…SSLå¤„ç†è´Ÿè½½

### 11.4 å­¦ä¹ è¿›é˜¶æ–¹å‘


**ğŸš€ è¿›é˜¶çŸ¥è¯†ç‚¹**
- **è¯ä¹¦é€æ˜åº¦**ï¼šCTæ—¥å¿—å’Œç›‘æ§
- **CAAè®°å½•**ï¼šDNSå±‚é¢çš„è¯ä¹¦é¢å‘æˆæƒ
- **DANE/TLSA**ï¼šDNS basedèº«ä»½éªŒè¯
- **Certificate Pinning**ï¼šè¯ä¹¦å›ºå®šæŠ€æœ¯

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- SSLè¯ä¹¦ä¿å®‰å…¨ï¼Œä¸‰ç§æ–¹å¼æ¥å®ç°
- Let's Encryptå…è´¹ç”¨ï¼Œå•†ä¸šè¯ä¹¦æœ€å¯ä¿¡
- æ–‡ä»¶æƒé™è¦è®¾å¯¹ï¼Œç§é’¥å…­é›¶é›¶ä¿å¯†
- åè®®ç‰ˆæœ¬é€‰æ–°çš„ï¼Œå¯†ç å¥—ä»¶è¦å®‰å…¨
- å®šæœŸç›‘æ§é˜²è¿‡æœŸï¼Œå¤‡ä»½æ¢å¤è¦å‡†å¤‡