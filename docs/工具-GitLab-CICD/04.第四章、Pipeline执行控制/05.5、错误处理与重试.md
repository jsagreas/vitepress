---
title: 5ã€é”™è¯¯å¤„ç†ä¸é‡è¯•
---
## ğŸ“š ç›®å½•

1. [é”™è¯¯å¤„ç†åŸºç¡€æ¦‚å¿µ](#1-é”™è¯¯å¤„ç†åŸºç¡€æ¦‚å¿µ)
2. [allow_failureå¤±è´¥å…è®¸æœºåˆ¶](#2-allow_failureå¤±è´¥å…è®¸æœºåˆ¶)
3. [retryé‡è¯•æœºåˆ¶è¯¦è§£](#3-retryé‡è¯•æœºåˆ¶è¯¦è§£)
4. [whenæ¡ä»¶æ§åˆ¶](#4-whenæ¡ä»¶æ§åˆ¶)
5. [è¶…æ—¶è®¾ç½®timeout](#5-è¶…æ—¶è®¾ç½®timeout)
6. [èµ„æºé™åˆ¶é…ç½®](#6-èµ„æºé™åˆ¶é…ç½®)
7. [å®æˆ˜åº”ç”¨åœºæ™¯](#7-å®æˆ˜åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ é”™è¯¯å¤„ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯CI/CDä¸­çš„é”™è¯¯å¤„ç†


**ç®€å•ç†è§£**ï¼šæƒ³è±¡ä½ åœ¨åšä½œä¸šï¼Œæœ‰äº›é¢˜ç›®åšé”™äº†ä¸å½±å“æ•´ä½“æˆç»©ï¼Œæœ‰äº›é¢˜ç›®å¿…é¡»åšå¯¹ã€‚GitLab CI/CDçš„é”™è¯¯å¤„ç†å°±æ˜¯è¿™ä¸ªé“ç†ã€‚

```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š
åšèœ â†’ æ”¾ç›å°‘äº† â†’ å¯ä»¥è¡¥æ•‘ â†’ ç»§ç»­åšèœ
å¼€è½¦ â†’ åˆ¹è½¦åäº† â†’ å¿…é¡»åœè½¦ â†’ ä¸èƒ½ç»§ç»­

CI/CDç®¡é“ï¼š
æµ‹è¯• â†’ æŸä¸ªæµ‹è¯•å¤±è´¥ â†’ å…è®¸ç»§ç»­ï¼Ÿâ†’ å†³å®šæ˜¯å¦éƒ¨ç½²
æ„å»º â†’ ç¼–è¯‘é”™è¯¯ â†’ å¿…é¡»ä¿®å¤ â†’ åœæ­¢æ•´ä¸ªæµç¨‹
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é”™è¯¯å¤„ç†æœºåˆ¶


**æ ¸å¿ƒåŸå› **ï¼š
- **çµæ´»æ§åˆ¶** - ä¸æ˜¯æ‰€æœ‰é”™è¯¯éƒ½è¦åœæ­¢æ•´ä¸ªæµç¨‹
- **æé«˜æ•ˆç‡** - å…è®¸éƒ¨åˆ†å¤±è´¥ï¼Œç»§ç»­å…¶ä»–é‡è¦æ­¥éª¤
- **å¢å¼ºç¨³å®šæ€§** - ç½‘ç»œæŠ–åŠ¨ç­‰ä¸´æ—¶é—®é¢˜å¯ä»¥é‡è¯•
- **æˆæœ¬æ§åˆ¶** - é¿å…å› å°é—®é¢˜é‡è·‘æ•´ä¸ªè€—æ—¶æµç¨‹

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šæŠŠCI/CDæƒ³è±¡æˆæµæ°´çº¿ï¼Œé”™è¯¯å¤„ç†å°±æ˜¯å†³å®š"å“ªä¸ªç¯èŠ‚å‡ºé—®é¢˜æ—¶å¯ä»¥ç»§ç»­ï¼Œå“ªä¸ªå¿…é¡»åœä¸‹æ¥"

### 1.3 GitLab CI/CDé”™è¯¯å¤„ç†ç­–ç•¥


```
é”™è¯¯å¤„ç†å†³ç­–æ ‘ï¼š
                 Jobå¤±è´¥äº†
                    |
            æ˜¯å¦å…è®¸å¤±è´¥ï¼Ÿ
           /              \
         æ˜¯                 å¦
         |                 |
    ç»§ç»­ä¸‹ä¸€ä¸ªJob      åœæ­¢Pipeline
         |                 |
    æ ‡è®°ä¸ºè­¦å‘Š          æ ‡è®°ä¸ºå¤±è´¥
```

**äº”å¤§æ ¸å¿ƒæœºåˆ¶**ï¼š
- `allow_failure` - å†³å®šå¤±è´¥æ˜¯å¦å½±å“æ•´ä½“
- `retry` - è‡ªåŠ¨é‡è¯•å¤±è´¥çš„ä»»åŠ¡
- `when` - æ§åˆ¶ä»»åŠ¡æ‰§è¡Œæ¡ä»¶
- `timeout` - è®¾ç½®ä»»åŠ¡æœ€é•¿æ‰§è¡Œæ—¶é—´
- èµ„æºé™åˆ¶ - æ§åˆ¶ä»»åŠ¡ä½¿ç”¨çš„è®¡ç®—èµ„æº

---

## 2. âœ… allow_failureå¤±è´¥å…è®¸æœºåˆ¶


### 2.1 åŸºæœ¬æ¦‚å¿µè§£é‡Š


**ä»€ä¹ˆæ˜¯allow_failure**ï¼š
æƒ³è±¡ä½ åœ¨ç»„ç»‡ä¸€åœºæ¼”å‡ºï¼Œä¸»è¦æ¼”å‘˜å¿…é¡»åˆ°åœºï¼ˆä¸å…è®¸å¤±è´¥ï¼‰ï¼Œä½†èƒŒæ™¯éŸ³ä¹å‡ºç‚¹å°é—®é¢˜å¯ä»¥æ¥å—ï¼ˆå…è®¸å¤±è´¥ï¼‰ã€‚

```yaml
# åŸºç¡€è¯­æ³•
job_name:
  script: 
    - echo "æ‰§è¡Œä»»åŠ¡"
  allow_failure: true    # è¿™ä¸ªä»»åŠ¡å¤±è´¥äº†ï¼Œä¸å½±å“æ•´ä¸ªPipeline
```

### 2.2 å…·ä½“ä½¿ç”¨åœºæ™¯


**ğŸ’» å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```yaml
stages:
  - test
  - deploy

# ä¸»è¦æµ‹è¯• - å¿…é¡»é€šè¿‡
unit_test:
  stage: test
  script:
    - npm test
  allow_failure: false  # é»˜è®¤å€¼ï¼Œå¤±è´¥å°±åœæ­¢

# æ€§èƒ½æµ‹è¯• - å¯ä»¥å¤±è´¥
performance_test:
  stage: test
  script:
    - npm run performance-test
  allow_failure: true   # å¤±è´¥äº†ä¹Ÿç»§ç»­ï¼Œåªæ˜¯è­¦å‘Š

# éƒ¨ç½² - å¿…é¡»æˆåŠŸ
deploy:
  stage: deploy
  script:
    - npm run deploy
  # å‰é¢æ€§èƒ½æµ‹è¯•å¤±è´¥äº†ï¼Œè¿™é‡Œä¾ç„¶ä¼šæ‰§è¡Œ
```

### 2.3 allow_failureçš„ä¸¤ç§å€¼


| è®¾ç½®å€¼ | å«ä¹‰ | PipelineçŠ¶æ€ | åç»­Jobæ‰§è¡Œ |
|--------|------|-------------|------------|
| `false` | **ä¸å…è®¸å¤±è´¥**ï¼ˆé»˜è®¤ï¼‰ | âŒ å¤±è´¥åœæ­¢ | ğŸ›‘ åœæ­¢æ‰§è¡Œ |
| `true` | **å…è®¸å¤±è´¥** | âš ï¸ è­¦å‘Šç»§ç»­ | âœ… ç»§ç»­æ‰§è¡Œ |

> âš ï¸ **é‡è¦ç†è§£**ï¼š`allow_failure: true`ä¸æ˜¯"å¿½ç•¥é”™è¯¯"ï¼Œè€Œæ˜¯"è®°å½•é”™è¯¯ä½†ä¸é˜»æ­¢æµç¨‹"

### 2.4 å®æˆ˜åœºæ™¯åˆ†æ


**ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯**ï¼š

```
âœ… é€‚åˆè®¾ç½®allow_failure: trueçš„ä»»åŠ¡ï¼š
- ä»£ç è´¨é‡æ£€æŸ¥ï¼ˆä»£ç è§„èŒƒæ£€æŸ¥ï¼‰
- æ€§èƒ½æµ‹è¯•ï¼ˆå¶å°”çš„ç½‘ç»œæ³¢åŠ¨ï¼‰
- æ–‡æ¡£ç”Ÿæˆï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- é€šçŸ¥ä»»åŠ¡ï¼ˆå‘é€é‚®ä»¶/æ¶ˆæ¯ï¼‰

âŒ ä¸é€‚åˆè®¾ç½®allow_failure: trueçš„ä»»åŠ¡ï¼š
- å•å…ƒæµ‹è¯•ï¼ˆåŠŸèƒ½æ­£ç¡®æ€§ï¼‰
- å®‰å…¨æ‰«æï¼ˆå®‰å…¨æ¼æ´ï¼‰
- æ„å»ºç¼–è¯‘ï¼ˆä»£ç è¯­æ³•é”™è¯¯ï¼‰
- ç”Ÿäº§éƒ¨ç½²ï¼ˆä¸Šçº¿å¿…é¡»æˆåŠŸï¼‰
```

---

## 3. ğŸ”„ retryé‡è¯•æœºåˆ¶è¯¦è§£


### 3.1 é‡è¯•æœºåˆ¶åŸºæœ¬æ¦‚å¿µ


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
å°±åƒæ‰“ç”µè¯ï¼Œç¬¬ä¸€æ¬¡æ²¡æ‰“é€šå¯èƒ½æ˜¯ä¿¡å·é—®é¢˜ï¼Œè‡ªåŠ¨é‡æ‹¨å‡ æ¬¡ï¼Œå¦‚æœè¿˜æ˜¯ä¸é€šæ‰ç¡®å®šæ˜¯çœŸçš„æœ‰é—®é¢˜ã€‚

```
ç¬¬1æ¬¡å°è¯• â†’ å¤±è´¥ â†’ ç­‰ä¸€ä¸‹å†è¯•
ç¬¬2æ¬¡å°è¯• â†’ å¤±è´¥ â†’ å†ç­‰ä¸€ä¸‹å†è¯•  
ç¬¬3æ¬¡å°è¯• â†’ æˆåŠŸ â†’ ä»»åŠ¡å®Œæˆ âœ…
```

### 3.2 åŸºç¡€retryè¯­æ³•


```yaml
# ç®€å•é‡è¯•
job_name:
  script:
    - npm test
  retry: 2    # å¤±è´¥åæœ€å¤šé‡è¯•2æ¬¡ï¼ˆæ€»å…±æ‰§è¡Œ3æ¬¡ï¼‰

# è¯¦ç»†é‡è¯•é…ç½®
job_name:
  script:
    - npm test
  retry:
    max: 2                    # æœ€å¤šé‡è¯•2æ¬¡
    when:                     # ä»€ä¹ˆæƒ…å†µä¸‹é‡è¯•
      - runner_system_failure # Runnerç³»ç»Ÿæ•…éšœ
      - stuck_or_timeout_failure # å¡ä½æˆ–è¶…æ—¶
```

### 3.3 retryçš„whenæ¡ä»¶è¯¦è§£


| é‡è¯•æ¡ä»¶ | ä»€ä¹ˆæ—¶å€™è§¦å‘ | ç”Ÿæ´»åŒ–ç†è§£ |
|----------|-------------|------------|
| `always` | **ä»»ä½•å¤±è´¥éƒ½é‡è¯•** | ä¸ç®¡ä»€ä¹ˆåŸå› å¤±è´¥éƒ½å†è¯•è¯• |
| `unknown_failure` | **æœªçŸ¥é”™è¯¯** | è«åå…¶å¦™å¤±è´¥äº†ï¼Œå¯èƒ½æ˜¯ä¸´æ—¶é—®é¢˜ |
| `script_failure` | **è„šæœ¬æ‰§è¡Œå¤±è´¥** | ä½ çš„ä»£ç /å‘½ä»¤æœ‰é—®é¢˜ |
| `api_failure` | **GitLab APIæ•…éšœ** | GitLabæœåŠ¡å™¨å‡ºé—®é¢˜äº† |
| `stuck_or_timeout_failure` | **å¡ä½æˆ–è¶…æ—¶** | ä»»åŠ¡è¿è¡Œå¤ªä¹…æˆ–å¡æ­»äº† |
| `runner_system_failure` | **Runnerç³»ç»Ÿæ•…éšœ** | æ‰§è¡Œä»»åŠ¡çš„æœºå™¨å‡ºé—®é¢˜äº† |
| `data_integrity_failure` | **æ•°æ®å®Œæ•´æ€§é—®é¢˜** | ä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®æŸåäº† |

### 3.4 å®é™…é‡è¯•ç­–ç•¥


**ğŸ”§ æ™ºèƒ½é‡è¯•é…ç½®**ï¼š

```yaml
# ç½‘ç»œç›¸å…³ä»»åŠ¡ - é‡è¯•ç½‘ç»œé—®é¢˜
download_dependencies:
  script:
    - npm install
  retry:
    max: 3
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
      - unknown_failure

# æµ‹è¯•ä»»åŠ¡ - ä¸é‡è¯•è„šæœ¬é”™è¯¯
unit_test:
  script:
    - npm test
  retry:
    max: 1
    when:
      - runner_system_failure
      # æ³¨æ„ï¼šä¸åŒ…å«script_failureï¼Œå› ä¸ºæµ‹è¯•å¤±è´¥è¯´æ˜ä»£ç æœ‰é—®é¢˜

# éƒ¨ç½²ä»»åŠ¡ - è°¨æ…é‡è¯•
deploy:
  script:
    - kubectl apply -f deployment.yaml
  retry:
    max: 2
    when:
      - api_failure
      - runner_system_failure
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šç½‘ç»œæ“ä½œå¤šé‡è¯•ï¼Œé€»è¾‘é”™è¯¯å°‘é‡è¯•

---

## 4. ğŸ® whenæ¡ä»¶æ§åˆ¶


### 4.1 whenæ¡ä»¶åŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼š`when`å°±åƒæ˜¯ä»»åŠ¡æ‰§è¡Œçš„"å¼€å…³æ¡ä»¶"ï¼Œå†³å®šä»€ä¹ˆæƒ…å†µä¸‹è¿™ä¸ªä»»åŠ¡æ‰ä¼šè¿è¡Œã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
when: always     â†’ ä¸ç®¡æ€æ ·éƒ½è¦åšï¼ˆæ¯å¤©åˆ·ç‰™ï¼‰
when: on_success â†’ å‰é¢é¡ºåˆ©æ‰åšï¼ˆè€ƒè¯•é€šè¿‡æ‰èƒ½æ¯•ä¸šï¼‰
when: on_failure â†’ å‰é¢å‡ºé”™æ‰åšï¼ˆç”Ÿç—…äº†æ‰åƒè¯ï¼‰
when: manual     â†’ æ‰‹åŠ¨å†³å®šåšä¸åšï¼ˆå‘¨æœ«è¦ä¸è¦åŠ ç­ï¼‰
```

### 4.2 whenæ¡ä»¶è¯¦ç»†è¯´æ˜


| whenå€¼ | æ‰§è¡Œæ—¶æœº | åº”ç”¨åœºæ™¯ | ç”Ÿæ´»åŒ–ä¾‹å­ |
|--------|----------|----------|------------|
| `on_success` | **å‰é¢æˆåŠŸæ—¶æ‰§è¡Œ**ï¼ˆé»˜è®¤ï¼‰ | æ­£å¸¸éƒ¨ç½²æµç¨‹ | è€ƒè¯•é€šè¿‡â†’é¢å‘è¯ä¹¦ |
| `on_failure` | **å‰é¢å¤±è´¥æ—¶æ‰§è¡Œ** | å¤±è´¥å¤„ç†ã€é€šçŸ¥ | åšèœå¤±è´¥â†’å«å¤–å– |
| `always` | **æ€»æ˜¯æ‰§è¡Œ** | æ¸…ç†å·¥ä½œã€æ—¥å¿—æ”¶é›† | æ¯å¤©ç¡å‰â†’åˆ·ç‰™æ´—è„¸ |
| `manual` | **æ‰‹åŠ¨è§¦å‘** | ç”Ÿäº§éƒ¨ç½²ã€é‡è¦æ“ä½œ | é‡è¦å†³å®šâ†’éœ€è¦ç¡®è®¤ |
| `delayed` | **å»¶è¿Ÿæ‰§è¡Œ** | å®šæ—¶ä»»åŠ¡ | è®¾ç½®é—¹é’Ÿâ†’å®šæ—¶æé†’ |
| `never` | **ä»ä¸æ‰§è¡Œ** | ä¸´æ—¶ç¦ç”¨ä»»åŠ¡ | å·²åœç”¨åŠŸèƒ½â†’ä¸å†ä½¿ç”¨ |

### 4.3 å®é™…åº”ç”¨ç¤ºä¾‹


**ğŸ› ï¸ å®Œæ•´æµç¨‹ç¤ºä¾‹**ï¼š

```yaml
stages:
  - build
  - test  
  - cleanup
  - notify

# æ„å»ºé˜¶æ®µ - æ€»æ˜¯æ‰§è¡Œ
build_app:
  stage: build
  script:
    - npm run build
  when: always

# æµ‹è¯•é˜¶æ®µ - æ„å»ºæˆåŠŸæ‰æµ‹è¯•
test_app:
  stage: test
  script:
    - npm test
  when: on_success

# æ¸…ç†å·¥ä½œ - ä¸ç®¡æˆåŠŸå¤±è´¥éƒ½è¦æ¸…ç†
cleanup_workspace:
  stage: cleanup
  script:
    - rm -rf temp_files
    - docker system prune -f
  when: always

# å¤±è´¥é€šçŸ¥ - åªæœ‰å¤±è´¥æ—¶æ‰å‘é€
notify_failure:
  stage: notify
  script:
    - curl -X POST "webhook_url" -d "Pipeline failed"
  when: on_failure

# æˆåŠŸéƒ¨ç½² - æ‰‹åŠ¨è§¦å‘
deploy_production:
  stage: deploy
  script:
    - kubectl apply -f production.yaml
  when: manual
  only:
    - main
```

### 4.4 whenä¸allow_failureç»„åˆä½¿ç”¨


```yaml
# é«˜çº§ç»„åˆï¼šæµ‹è¯•å¤±è´¥æ—¶çš„å¤„ç†
integration_test:
  script:
    - npm run integration-test
  allow_failure: true    # å…è®¸å¤±è´¥
  
# ä¸“é—¨å¤„ç†æµ‹è¯•å¤±è´¥çš„ä»»åŠ¡
handle_test_failure:
  script:
    - echo "é›†æˆæµ‹è¯•å¤±è´¥ï¼Œç”ŸæˆæŠ¥å‘Š"
    - npm run generate-failure-report
  when: on_failure       # å‰é¢å¤±è´¥æ—¶æ‰§è¡Œ
  dependencies:
    - integration_test   # ä¾èµ–äºé›†æˆæµ‹è¯•
```

---

## 5. â° è¶…æ—¶è®¾ç½®timeout


### 5.1 è¶…æ—¶æœºåˆ¶åŸºæœ¬æ¦‚å¿µ


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
å°±åƒç»™ä»»åŠ¡è®¾å®šä¸€ä¸ª"æˆªæ­¢æ—¶é—´"ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡å®Œæˆï¼Œå°±å¼ºåˆ¶åœæ­¢ï¼Œé¿å…æ— é™ç­‰å¾…ã€‚

```
ç°å®ä¾‹å­ï¼š
ç­‰å…¬äº¤è½¦ â†’ è®¾å®šè¶…æ—¶15åˆ†é’Ÿ â†’ è¶…æ—¶å°±æ”¹ä¹˜åœ°é“
ä¸‹è½½æ–‡ä»¶ â†’ è®¾å®šè¶…æ—¶5åˆ†é’Ÿ â†’ è¶…æ—¶å°±å–æ¶ˆä¸‹è½½
```

### 5.2 timeoutè¯­æ³•å’Œä½¿ç”¨


```yaml
# åŸºæœ¬è¶…æ—¶è®¾ç½®
job_name:
  script:
    - long_running_command
  timeout: 30m    # 30åˆ†é’Ÿè¶…æ—¶

# ä¸åŒæ—¶é—´å•ä½
timeout_examples:
  script:
    - echo "æ¼”ç¤ºä¸åŒæ—¶é—´å•ä½"
  timeout: 1h 30m    # 1å°æ—¶30åˆ†é’Ÿ
  # æ”¯æŒçš„å•ä½ï¼šs(ç§’) m(åˆ†é’Ÿ) h(å°æ—¶)
```

### 5.3 å¸¸è§ä»»åŠ¡çš„è¶…æ—¶è®¾ç½®å»ºè®®


```
ä»»åŠ¡ç±»å‹ä¸æ¨èè¶…æ—¶æ—¶é—´ï¼š

ğŸ”¸ ä»£ç ç¼–è¯‘ï¼š
  - å°é¡¹ç›®ï¼š5-10åˆ†é’Ÿ
  - å¤§é¡¹ç›®ï¼š30-60åˆ†é’Ÿ
  
ğŸ”¸ å•å…ƒæµ‹è¯•ï¼š
  - å¿«é€Ÿæµ‹è¯•ï¼š2-5åˆ†é’Ÿ  
  - å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š10-30åˆ†é’Ÿ
  
ğŸ”¸ æ„å»ºé•œåƒï¼š
  - ç®€å•åº”ç”¨ï¼š5-15åˆ†é’Ÿ
  - å¤æ‚åº”ç”¨ï¼š30-60åˆ†é’Ÿ
  
ğŸ”¸ éƒ¨ç½²æ“ä½œï¼š
  - æ»šåŠ¨éƒ¨ç½²ï¼š10-20åˆ†é’Ÿ
  - è“ç»¿éƒ¨ç½²ï¼š20-40åˆ†é’Ÿ
  
ğŸ”¸ æ•°æ®åº“è¿ç§»ï¼š
  - å°æ•°æ®é‡ï¼š5-10åˆ†é’Ÿ
  - å¤§æ•°æ®é‡ï¼š1-3å°æ—¶
```

### 5.4 å®é™…é…ç½®ç¤ºä¾‹


```yaml
# å¿«é€Ÿä»»åŠ¡ - çŸ­è¶…æ—¶
unit_test:
  script:
    - npm test
  timeout: 10m

# ç¼–è¯‘ä»»åŠ¡ - ä¸­ç­‰è¶…æ—¶  
build:
  script:
    - npm run build
  timeout: 30m

# é›†æˆæµ‹è¯• - é•¿è¶…æ—¶
integration_test:
  script:
    - npm run e2e-test
  timeout: 1h

# æ•°æ®å¤‡ä»½ - å¾ˆé•¿è¶…æ—¶
backup_database:
  script:
    - pg_dump database > backup.sql
  timeout: 3h
  when: manual
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šè¶…æ—¶æ—¶é—´æ—¢ä¸èƒ½å¤ªçŸ­ï¼ˆä»»åŠ¡æ²¡å®Œæˆå°±è¢«æ€æ‰ï¼‰ï¼Œä¹Ÿä¸èƒ½å¤ªé•¿ï¼ˆå ç”¨èµ„æºå¤ªä¹…ï¼‰

---

## 6. ğŸ”§ èµ„æºé™åˆ¶é…ç½®


### 6.1 èµ„æºé™åˆ¶åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒç§Ÿæˆ¿å­è¦è€ƒè™‘é¢„ç®—ï¼Œè¿è¡ŒCI/CDä»»åŠ¡ä¹Ÿè¦è€ƒè™‘"è®¡ç®—èµ„æºé¢„ç®—"ï¼ŒåŒ…æ‹¬CPUã€å†…å­˜ã€å­˜å‚¨ç­‰ã€‚

```
ç°å®ç±»æ¯”ï¼š
å¼€é¤å… â†’ éœ€è¦è€ƒè™‘ï¼šåº—é¢å¤§å°ã€å¨å¸ˆæ•°é‡ã€é£Ÿææˆæœ¬
è¿è¡ŒJob â†’ éœ€è¦è€ƒè™‘ï¼šCPUæ ¸å¿ƒã€å†…å­˜å¤§å°ã€ç£ç›˜ç©ºé—´
```

### 6.2 GitLab Runnerèµ„æºé…ç½®


**ğŸ–¥ï¸ Runnerçº§åˆ«çš„èµ„æºé™åˆ¶**ï¼š

```toml
# config.toml - GitLab Runneré…ç½®æ–‡ä»¶
[[runners]]
  name = "my-runner"
  limit = 5                    # åŒæ—¶è¿è¡Œçš„Jobæ•°é‡é™åˆ¶
  
  [runners.docker]
    memory = "2g"              # æ¯ä¸ªå®¹å™¨å†…å­˜é™åˆ¶
    memory_swap = "2g"         # äº¤æ¢å†…å­˜
    cpus = "1.5"              # CPUæ ¸å¿ƒé™åˆ¶
    disk_space = "10g"         # ç£ç›˜ç©ºé—´é™åˆ¶
```

### 6.3 Jobçº§åˆ«çš„èµ„æºæ§åˆ¶


```yaml
# åœ¨.gitlab-ci.ymlä¸­è®¾ç½®èµ„æºéœ€æ±‚
resource_intensive_job:
  script:
    - npm run heavy-build
  tags:
    - high-memory        # ä½¿ç”¨æœ‰è¶³å¤Ÿå†…å­˜çš„Runner
  variables:
    DOCKER_MEMORY: "4g"  # å®¹å™¨å†…å­˜é™åˆ¶
```

### 6.4 èµ„æºä½¿ç”¨æœ€ä½³å®è·µ


**ğŸ“Š èµ„æºé…ç½®ç­–ç•¥**ï¼š

| ä»»åŠ¡ç±»å‹ | CPUéœ€æ±‚ | å†…å­˜éœ€æ±‚ | ç£ç›˜éœ€æ±‚ | å»ºè®®é…ç½® |
|----------|---------|----------|----------|----------|
| **è½»é‡æµ‹è¯•** | ä½ | ä½ | ä½ | 1æ ¸/1GB/5GB |
| **ä»£ç ç¼–è¯‘** | é«˜ | ä¸­ | ä¸­ | 2-4æ ¸/2-4GB/10GB |
| **é•œåƒæ„å»º** | é«˜ | é«˜ | é«˜ | 4æ ¸/4GB/20GB |
| **å¤§æ•°æ®å¤„ç†** | é«˜ | å¾ˆé«˜ | å¾ˆé«˜ | 8æ ¸/8GB/50GB |

**ğŸ’¡ ä¼˜åŒ–å»ºè®®**ï¼š

```yaml
# æ ¹æ®ä»»åŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„Runner
fast_test:
  script:
    - npm run unit-test
  tags:
    - small-runner      # ä½¿ç”¨å°è§„æ ¼Runner

heavy_build:
  script:
    - npm run build-all
  tags:
    - large-runner      # ä½¿ç”¨å¤§è§„æ ¼Runner
  timeout: 1h
```

---

## 7. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 7.1 å…¸å‹Webåº”ç”¨çš„å®Œæ•´Pipeline


```yaml
stages:
  - prepare
  - test
  - build
  - deploy
  - cleanup

# å‡†å¤‡ç¯å¢ƒ - å…è®¸é‡è¯•ç½‘ç»œé—®é¢˜
install_dependencies:
  stage: prepare
  script:
    - npm ci
  retry:
    max: 3
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
  timeout: 10m

# ä»£ç æ£€æŸ¥ - å…è®¸å¤±è´¥ä½†è®°å½•è­¦å‘Š
code_quality:
  stage: test
  script:
    - npm run lint
    - npm run security-scan
  allow_failure: true
  timeout: 5m

# å•å…ƒæµ‹è¯• - å¿…é¡»é€šè¿‡
unit_test:
  stage: test
  script:
    - npm test
  retry:
    max: 1
    when: [runner_system_failure]
  timeout: 15m

# æ„å»ºåº”ç”¨
build_app:
  stage: build
  script:
    - npm run build
    - docker build -t myapp .
  when: on_success
  timeout: 30m

# è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
deploy_staging:
  stage: deploy
  script:
    - kubectl apply -f staging.yaml
  when: on_success
  timeout: 10m
  only:
    - develop

# æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
deploy_production:
  stage: deploy
  script:
    - kubectl apply -f production.yaml
  when: manual
  timeout: 20m
  only:
    - main

# æ¸…ç†å·¥ä½œ - æ€»æ˜¯æ‰§è¡Œ
cleanup:
  stage: cleanup
  script:
    - docker system prune -f
    - rm -rf temp/
  when: always
  timeout: 5m
```

### 7.2 é”™è¯¯å¤„ç†çš„ç»„åˆç­–ç•¥


**ğŸ”„ æ¸è¿›å¼é”™è¯¯å¤„ç†**ï¼š

```
ç¬¬1å±‚ï¼šé‡è¯•æœºåˆ¶å¤„ç†ä¸´æ—¶é—®é¢˜
       â†“
ç¬¬2å±‚ï¼šallow_failureå¤„ç†éå…³é”®é”™è¯¯
       â†“  
ç¬¬3å±‚ï¼šwhenæ¡ä»¶æ§åˆ¶åç»­æµç¨‹
       â†“
ç¬¬4å±‚ï¼štimeouté˜²æ­¢èµ„æºæµªè´¹
```

### 7.3 ç›‘æ§å’Œå‘Šè­¦é›†æˆ


```yaml
# ç›‘æ§JobçŠ¶æ€
monitor_pipeline:
  script:
    - curl -X POST "monitoring_webhook" 
  when: always
  allow_failure: true

# å¤±è´¥æ—¶å‘é€å‘Šè­¦
send_alert:
  script:
    - python send_notification.py "Pipeline failed"
  when: on_failure
  timeout: 2m
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ allow_failureï¼šå†³å®šä»»åŠ¡å¤±è´¥æ˜¯å¦å½±å“æ•´ä¸ªPipeline
ğŸ”¸ retryï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œå¤„ç†ä¸´æ—¶æ€§é—®é¢˜
ğŸ”¸ whenï¼šæ§åˆ¶ä»»åŠ¡æ‰§è¡Œçš„æ¡ä»¶å’Œæ—¶æœº
ğŸ”¸ timeoutï¼šè®¾ç½®ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´é™åˆ¶
ğŸ”¸ èµ„æºé™åˆ¶ï¼šæ§åˆ¶ä»»åŠ¡ä½¿ç”¨çš„è®¡ç®—èµ„æº
```

### 8.2 å…³é”®é…ç½®åŸåˆ™


**ğŸ¯ é…ç½®ç­–ç•¥æ€»ç»“**ï¼š

```
é”™è¯¯å¤„ç†ç­–ç•¥é€‰æ‹©ï¼š

å…³é”®ä»»åŠ¡ï¼ˆæ„å»ºã€éƒ¨ç½²ï¼‰ï¼š
âœ… è®¾ç½®åˆç†çš„retry
âœ… ä¸ä½¿ç”¨allow_failure
âœ… è®¾ç½®é€‚å½“çš„timeout
âœ… ä½¿ç”¨å……è¶³çš„èµ„æº

è¾…åŠ©ä»»åŠ¡ï¼ˆä»£ç æ£€æŸ¥ã€é€šçŸ¥ï¼‰ï¼š
âœ… å¯ä»¥è®¾ç½®allow_failure: true
âœ… è®¾ç½®è¾ƒçŸ­çš„timeout  
âœ… å¯ä»¥ä½¿ç”¨è¾ƒå°‘çš„èµ„æº
âœ… å¤±è´¥æ—¶è®°å½•ä½†ä¸é˜»æ­¢æµç¨‹
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“**ï¼š

- **retryæœºåˆ¶**ï¼šç½‘ç»œæ“ä½œå¤šé‡è¯•ï¼Œé€»è¾‘é”™è¯¯å°‘é‡è¯•
- **allow_failure**ï¼šè¾…åŠ©åŠŸèƒ½å¯ä»¥å¤±è´¥ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸èƒ½å¤±è´¥
- **timeoutè®¾ç½®**ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦åˆç†è®¾ç½®ï¼Œæ—¢ä¸èƒ½å¤ªçŸ­ä¹Ÿä¸èƒ½å¤ªé•¿
- **èµ„æºé…ç½®**ï¼šæ ¹æ®ä»»åŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚è§„æ ¼çš„Runner
- **ç»„åˆä½¿ç”¨**ï¼šå¤šç§æœºåˆ¶ç»„åˆä½¿ç”¨ï¼Œæ„å»ºå¥å£®çš„Pipeline

**æ ¸å¿ƒè®°å¿†**ï¼š
- é”™è¯¯å¤„ç†è®©Pipelineæ›´å¥å£®ï¼Œä¸æ˜¯æ‰€æœ‰é”™è¯¯éƒ½è¦åœæ­¢
- é‡è¯•è§£å†³ä¸´æ—¶é—®é¢˜ï¼Œè¶…æ—¶é˜²æ­¢æ— é™ç­‰å¾…
- åˆç†é…ç½®èµ„æºï¼Œæ—¢è¦æ»¡è¶³éœ€æ±‚åˆè¦æ§åˆ¶æˆæœ¬
- å…³é”®æ­¥éª¤ä¸¥æ ¼æ§åˆ¶ï¼Œè¾…åŠ©åŠŸèƒ½å¯ä»¥å®½æ¾