---
title: 17ã€å¹¶è¡Œæ‰§è¡Œä¸ä¾èµ–ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å¹¶è¡Œæ‰§è¡Œ](#1-ä»€ä¹ˆæ˜¯å¹¶è¡Œæ‰§è¡Œ)
2. [Jobä¾èµ–å…³ç³»åŸºç¡€](#2-Jobä¾èµ–å…³ç³»åŸºç¡€)
3. [needså…³é”®å­—è¯¦è§£](#3-needså…³é”®å­—è¯¦è§£)
4. [DAGæœ‰å‘æ— ç¯å›¾](#4-DAGæœ‰å‘æ— ç¯å›¾)
5. [èµ„æºç«äº‰ä¸æ§åˆ¶](#5-èµ„æºç«äº‰ä¸æ§åˆ¶)
6. [æ‰§è¡Œé¡ºåºä¼˜åŒ–ç­–ç•¥](#6-æ‰§è¡Œé¡ºåºä¼˜åŒ–ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ ä»€ä¹ˆæ˜¯å¹¶è¡Œæ‰§è¡Œ


### 1.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ä»€ä¹ˆæ˜¯å¹¶è¡Œæ‰§è¡Œï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹åšèœçš„è¿‡ç¨‹ï¼š
- **ä¸²è¡Œæ–¹å¼**ï¼šæ´—èœ â†’ åˆ‡èœ â†’ ç‚’èœ â†’ ç…®æ±¤ â†’ ä¸Šèœï¼ˆä¸€æ­¥ä¸€æ­¥æ¥ï¼‰
- **å¹¶è¡Œæ–¹å¼**ï¼šåŒæ—¶æ´—èœå’Œçƒ§æ°´ï¼Œåˆ‡èœçš„åŒæ—¶é¢„çƒ­é”…å­ï¼ˆå¤šä»¶äº‹åŒæ—¶è¿›è¡Œï¼‰

åœ¨GitLab CI/CDä¸­ä¹Ÿæ˜¯ä¸€æ ·ï¼š
```
ä¼ ç»Ÿä¸²è¡Œæ‰§è¡Œï¼š
æ„å»º â†’ æµ‹è¯• â†’ éƒ¨ç½² â†’ é€šçŸ¥
(æ€»æ—¶é—´ = å„æ­¥éª¤æ—¶é—´ä¹‹å’Œ)

å¹¶è¡Œæ‰§è¡Œï¼š
â”Œâ”€ å•å…ƒæµ‹è¯• â”€â”
æ„å»º â”¤        â”œâ”€ éƒ¨ç½²
â””â”€ é›†æˆæµ‹è¯• â”€â”˜
(æ€»æ—¶é—´å¤§å¤§ç¼©çŸ­)
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¹¶è¡Œæ‰§è¡Œ


**ğŸ“Š æ—¶é—´å¯¹æ¯”åˆ†æï¼š**

| æ‰§è¡Œæ–¹å¼ | **æ„å»ºæ—¶é—´** | **æµ‹è¯•æ—¶é—´** | **éƒ¨ç½²æ—¶é—´** | **æ€»æ—¶é—´** |
|---------|------------|------------|------------|-----------|
| **ä¸²è¡Œæ‰§è¡Œ** | `5åˆ†é’Ÿ` | `10åˆ†é’Ÿ` | `3åˆ†é’Ÿ` | `18åˆ†é’Ÿ` |
| **å¹¶è¡Œæ‰§è¡Œ** | `5åˆ†é’Ÿ` | `10åˆ†é’Ÿ` | `3åˆ†é’Ÿ` | `çº¦8åˆ†é’Ÿ` |

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- âš¡ **æå‡æ•ˆç‡**ï¼šå……åˆ†åˆ©ç”¨å¤šä¸ªRunnerèµ„æº
- ğŸ”„ **å¿«é€Ÿåé¦ˆ**ï¼šæ›´æ—©å‘ç°é—®é¢˜
- ğŸ“ˆ **èµ„æºåˆ©ç”¨**ï¼šé¿å…Runneré—²ç½®
- ğŸ¯ **å¼€å‘ä½“éªŒ**ï¼šå‡å°‘ç­‰å¾…æ—¶é—´

### 1.3 å¹¶è¡Œæ‰§è¡Œçš„åŸºæœ¬åŸç†


```
GitLab Runneråˆ†é…ç¤ºæ„ï¼š

Runner-1: è´Ÿè´£æ„å»ºä»»åŠ¡
Runner-2: è´Ÿè´£å•å…ƒæµ‹è¯•  
Runner-3: è´Ÿè´£é›†æˆæµ‹è¯•
Runner-4: è´Ÿè´£ä»£ç æ£€æŸ¥

åŒæ—¶å·¥ä½œï¼Œè€Œä¸æ˜¯æ’é˜Ÿç­‰å¾…ï¼
```

---

## 2. ğŸ”— Jobä¾èµ–å…³ç³»åŸºç¡€


### 2.1 ä»€ä¹ˆæ˜¯Jobä¾èµ–


åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¾ˆå¤šäº‹æƒ…éƒ½æœ‰å…ˆåé¡ºåºï¼š
- å¿…é¡»å…ˆ**ç©¿è¢œå­**ï¼Œæ‰èƒ½**ç©¿é‹å­**
- å¿…é¡»å…ˆ**æ‰“åœ°åŸº**ï¼Œæ‰èƒ½**ç›–æˆ¿å­**

GitLab CI/CDä¸­çš„Jobä¹Ÿæ˜¯å¦‚æ­¤ï¼š
```
æ„å»ºä»£ç  â†’ è¿è¡Œæµ‹è¯• â†’ éƒ¨ç½²åº”ç”¨
   â†“          â†“          â†“
 å¿…é¡»æˆåŠŸ    ä¾èµ–æ„å»º    ä¾èµ–æµ‹è¯•
```

### 2.2 ä¼ ç»Ÿçš„stageä¾èµ–


**é»˜è®¤çš„stageæ‰§è¡Œé¡ºåºï¼š**
```yaml
stages:
  - build    # ç¬¬1é˜¶æ®µï¼šæ„å»º
  - test     # ç¬¬2é˜¶æ®µï¼šæµ‹è¯•
  - deploy   # ç¬¬3é˜¶æ®µï¼šéƒ¨ç½²

# é»˜è®¤è§„åˆ™ï¼šåªæœ‰å‰ä¸€ä¸ªstageå…¨éƒ¨å®Œæˆï¼Œæ‰èƒ½å¼€å§‹ä¸‹ä¸€ä¸ªstage
```

**æ‰§è¡Œæµç¨‹å›¾ï¼š**
```
é˜¶æ®µ1 (build):   [æ„å»ºJob] 
                    â†“
é˜¶æ®µ2 (test):    [å•å…ƒæµ‹è¯•] [é›†æˆæµ‹è¯•] [å®‰å…¨æ‰«æ]
                    â†“
é˜¶æ®µ3 (deploy):  [éƒ¨ç½²Job]
```

### 2.3 ä¼ ç»Ÿæ–¹å¼çš„å±€é™æ€§


**é—®é¢˜åœºæ™¯ï¼š**
```yaml
# ä¼ ç»Ÿé…ç½®
stages:
  - build
  - test
  - deploy

build_job:
  stage: build
  script: echo "æ„å»ºå®Œæˆï¼ˆ2åˆ†é’Ÿï¼‰"

unit_test:
  stage: test  
  script: echo "å•å…ƒæµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰"

integration_test:
  stage: test
  script: echo "é›†æˆæµ‹è¯•ï¼ˆ8åˆ†é’Ÿï¼‰"

deploy_job:
  stage: deploy
  script: echo "éƒ¨ç½²"
```

**æ—¶é—´æµªè´¹åˆ†æï¼š**
```
æ—¶é—´è½´ï¼š
0-2åˆ†é’Ÿï¼š   [æ„å»º]
2-10åˆ†é’Ÿï¼š  [å•å…ƒæµ‹è¯•] [é›†æˆæµ‹è¯•] â† å¹¶è¡Œè¿›è¡Œ
10-12åˆ†é’Ÿï¼š [éƒ¨ç½²]

é—®é¢˜ï¼šéƒ¨ç½²Jobå¿…é¡»ç­‰å¾…æœ€æ…¢çš„é›†æˆæµ‹è¯•å®Œæˆ
å®é™…ä¸Šï¼šéƒ¨ç½²åªéœ€è¦å•å…ƒæµ‹è¯•é€šè¿‡å³å¯
```

---

## 3. ğŸ¯ needså…³é”®å­—è¯¦è§£


### 3.1 needså…³é”®å­—çš„ä½œç”¨


`needs`å…³é”®å­—å°±åƒæ˜¯ç»™JobæŒ‡å®š"å‰ç½®æ¡ä»¶"ï¼š
- **ä¼ ç»Ÿæ–¹å¼**ï¼šå¿…é¡»ç­‰æ•´ä¸ªstageå®Œæˆ
- **needsæ–¹å¼**ï¼šåªéœ€è¦æŒ‡å®šçš„Jobå®Œæˆ

**ç”Ÿæ´»ç±»æ¯”ï¼š**
```
åšè›‹ç‚’é¥­ï¼š
ä¼ ç»Ÿï¼šä¹°èœ â†’ æ´—èœ â†’ åˆ‡èœ â†’ ç‚’è›‹ â†’ ç‚’é¥­
needsï¼šä¹°èœ â†’ ç‚’è›‹ï¼ˆåªè¦æœ‰è›‹å°±è¡Œï¼‰
       ä¹°èœ â†’ æ´—èœ â†’ åˆ‡èœ â†’ ç‚’é¥­
```

### 3.2 åŸºæœ¬è¯­æ³•å’Œç”¨æ³•


**åŸºç¡€è¯­æ³•ï¼š**
```yaml
job_name:
  needs: [dependency_job1, dependency_job2]
  script:
    - echo "æ‰§è¡Œä»»åŠ¡"
```

**å®é™…ç¤ºä¾‹ï¼š**
```yaml
stages:
  - build
  - test
  - deploy

# æ„å»ºJob
build_app:
  stage: build
  script:
    - echo "æ„å»ºåº”ç”¨"
    - echo "ç”Ÿæˆæ„å»ºäº§ç‰©"
  artifacts:
    paths:
      - build/

# å•å…ƒæµ‹è¯•ï¼ˆä¾èµ–æ„å»ºï¼‰
unit_test:
  stage: test
  needs: [build_app]
  script:
    - echo "è¿è¡Œå•å…ƒæµ‹è¯•"

# é›†æˆæµ‹è¯•ï¼ˆä¾èµ–æ„å»ºï¼‰
integration_test:
  stage: test
  needs: [build_app]
  script:
    - echo "è¿è¡Œé›†æˆæµ‹è¯•"

# éƒ¨ç½²ï¼ˆåªä¾èµ–å•å…ƒæµ‹è¯•ï¼‰
deploy_staging:
  stage: deploy
  needs: [unit_test]  # ä¸éœ€è¦ç­‰é›†æˆæµ‹è¯•ï¼
  script:
    - echo "éƒ¨ç½²åˆ°é¢„å‘å¸ƒç¯å¢ƒ"
```

### 3.3 needsçš„æ‰§è¡Œæ•ˆæœ


**æ‰§è¡Œæ—¶é—´çº¿å¯¹æ¯”ï¼š**
```
âŒ ä¼ ç»Ÿæ–¹å¼ï¼š
0-2åˆ†é’Ÿï¼š  [æ„å»º]
2-7åˆ†é’Ÿï¼š  [å•å…ƒæµ‹è¯•]
2-10åˆ†é’Ÿï¼š [é›†æˆæµ‹è¯•]
10-12åˆ†é’Ÿï¼š[éƒ¨ç½²] â† å¿…é¡»ç­‰åˆ°10åˆ†é’Ÿ

âœ… ä½¿ç”¨needsï¼š
0-2åˆ†é’Ÿï¼š  [æ„å»º]
2-7åˆ†é’Ÿï¼š  [å•å…ƒæµ‹è¯•]
2-10åˆ†é’Ÿï¼š [é›†æˆæµ‹è¯•]
7-9åˆ†é’Ÿï¼š  [éƒ¨ç½²] â† 7åˆ†é’Ÿå°±å¯ä»¥å¼€å§‹ï¼
```

**æ•ˆæœåˆ†æï¼š**
- ğŸš€ **éƒ¨ç½²æå‰3åˆ†é’Ÿ**å¼€å§‹
- âš¡ **æ€»æ‰§è¡Œæ—¶é—´**ä»12åˆ†é’Ÿç¼©çŸ­åˆ°10åˆ†é’Ÿ
- ğŸ”„ **èµ„æºåˆ©ç”¨ç‡**å¤§å¹…æå‡

### 3.4 needsçš„é«˜çº§ç”¨æ³•


**æ¡ä»¶ä¾èµ–ï¼š**
```yaml
# åªæœ‰å‰é¢çš„JobæˆåŠŸæ‰ç»§ç»­
deploy_prod:
  needs:
    - job: unit_test
      artifacts: true  # éœ€è¦è·å–artifacts
    - job: security_scan
      artifacts: false # ä¸éœ€è¦artifactsï¼Œåªè¦æˆåŠŸå³å¯

# å¯é€‰ä¾èµ–ï¼ˆå…è®¸å¤±è´¥ï¼‰
notify_slack:
  needs:
    - job: deploy_prod
      optional: true  # å³ä½¿deploy_prodå¤±è´¥ä¹Ÿä¼šæ‰§è¡Œ
```

**è·¨stageä¾èµ–ï¼š**
```yaml
# å¯ä»¥è·¨è¶Šstageç›´æ¥ä¾èµ–
urgent_hotfix:
  stage: deploy
  needs: [build_app]  # ç›´æ¥ä¾èµ–build stageçš„Job
  script:
    - echo "ç´§æ€¥ä¿®å¤ï¼Œè·³è¿‡æµ‹è¯•ç›´æ¥éƒ¨ç½²"
  when: manual  # æ‰‹åŠ¨è§¦å‘
```

---

## 4. ğŸ“Š DAGæœ‰å‘æ— ç¯å›¾


### 4.1 ä»€ä¹ˆæ˜¯DAG


**DAG**æ˜¯**D**irected **A**cyclic **G**raphçš„ç¼©å†™ï¼Œä¸­æ–‡å«"æœ‰å‘æ— ç¯å›¾"ã€‚

**ç”Ÿæ´»ç±»æ¯”ç†è§£ï¼š**
```
å®¶åº­åšé¥­çš„ä¾èµ–å…³ç³»ï¼š

ä¹°èœ â†’ æ´—èœ â†’ åˆ‡èœ â†’ ç‚’èœ
  â†“      â†“              â†“
  â””â†’ ä¹°è°ƒæ–™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è°ƒå‘³

è¿™å°±æ˜¯ä¸€ä¸ªDAGï¼š
- æœ‰å‘ï¼šç®­å¤´æŒ‡å‘æœ‰æ–¹å‘
- æ— ç¯ï¼šä¸ä¼šç»•å›åˆ°èµ·ç‚¹
- å›¾å½¢ï¼šå¤šä¸ªèŠ‚ç‚¹çš„å…³ç³»ç½‘
```

### 4.2 GitLabä¸­çš„DAGå±•ç¤º


å½“ä½ ä½¿ç”¨`needs`å…³é”®å­—æ—¶ï¼ŒGitLabä¼šè‡ªåŠ¨ç”ŸæˆDAGå›¾ï¼š

```
GitLab Pipeline DAGç¤ºä¾‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ build   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
  â”Œâ”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚test1â”‚  â”‚integration â”‚
  â””â”€â”€â”¬â”€â”€â”˜  â”‚   test     â”‚
     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”Œâ”€â”€â–¼â”€â”€â”
  â”‚deployâ”‚
  â””â”€â”€â”€â”€â”€â”˜
```

**åœ¨GitLabç•Œé¢æŸ¥çœ‹ï¼š**
1. è¿›å…¥Pipelineé¡µé¢
2. ç‚¹å‡»"éœ€è¦"æŒ‰é’®
3. æŸ¥çœ‹å¯è§†åŒ–çš„ä¾èµ–å…³ç³»å›¾

### 4.3 DAGçš„ä¼˜åŠ¿


**ğŸ¯ å¯è§†åŒ–ä¼˜åŠ¿ï¼š**
- æ¸…æ™°çœ‹åˆ°Jobä¹‹é—´çš„ä¾èµ–å…³ç³»
- å®¹æ˜“å‘ç°æ‰§è¡Œç“¶é¢ˆ
- ä¾¿äºä¼˜åŒ–Pipelineç»“æ„

**âš¡ æ‰§è¡Œä¼˜åŠ¿ï¼š**
- è‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œæ— ä¾èµ–çš„Job
- æœ€å¤§åŒ–åˆ©ç”¨Runnerèµ„æº
- å‡å°‘æ€»æ‰§è¡Œæ—¶é—´

### 4.4 DAGè®¾è®¡åŸåˆ™


**âœ… è‰¯å¥½çš„DAGè®¾è®¡ï¼š**
```yaml
# æ¸…æ™°çš„ä¾èµ–é“¾
build â†’ test â†’ deploy
build â†’ lint â†’ report
build â†’ security_scan â†’ audit
```

**âŒ é¿å…çš„åæ¨¡å¼ï¼š**
```yaml
# é¿å…è¿‡åº¦ä¾èµ–
build â†’ test1 â†’ test2 â†’ test3 â†’ deploy
# æ¯ä¸ªæµ‹è¯•éƒ½ä¾èµ–å‰ä¸€ä¸ªï¼Œæ— æ³•å¹¶è¡Œ

# é¿å…å¾ªç¯ä¾èµ–
job_a:
  needs: [job_b]
job_b:
  needs: [job_a]  # âŒ å¾ªç¯ä¾èµ–ï¼ŒPipelineä¼šå¤±è´¥
```

---

## 5. âš–ï¸ èµ„æºç«äº‰ä¸æ§åˆ¶


### 5.1 ä»€ä¹ˆæ˜¯èµ„æºç«äº‰


**èµ„æºç«äº‰ç±»æ¯”ï¼š**
```
ç°å®åœºæ™¯ï¼š10ä¸ªäººåŒæ—¶å»é“¶è¡ŒåŠä¸šåŠ¡ï¼Œä½†åªæœ‰3ä¸ªçª—å£
ç»“æœï¼š7ä¸ªäººè¦æ’é˜Ÿç­‰å¾…

CI/CDåœºæ™¯ï¼š10ä¸ªJobåŒæ—¶æ‰§è¡Œï¼Œä½†åªæœ‰3ä¸ªRunner
ç»“æœï¼š7ä¸ªJobè¦æ’é˜Ÿç­‰å¾…
```

### 5.2 å¸¸è§çš„èµ„æºç«äº‰åœºæ™¯


**ğŸ–¥ï¸ Runnerèµ„æºç«äº‰ï¼š**
```yaml
# 5ä¸ªæµ‹è¯•JobåŒæ—¶å¯åŠ¨ï¼Œä½†åªæœ‰2ä¸ªRunner
unit_test_1:
  needs: [build]
unit_test_2:
  needs: [build]
unit_test_3:
  needs: [build]
unit_test_4:
  needs: [build]
unit_test_5:
  needs: [build]

# ç»“æœï¼šåªæœ‰2ä¸ªèƒ½ç«‹å³æ‰§è¡Œï¼Œå…¶ä»–3ä¸ªæ’é˜Ÿ
```

**ğŸ—„ï¸ æ•°æ®åº“èµ„æºç«äº‰ï¼š**
```yaml
# å¤šä¸ªæµ‹è¯•åŒæ—¶è®¿é—®æµ‹è¯•æ•°æ®åº“
db_test_1:
  script: - "æµ‹è¯•ç”¨æˆ·æ¨¡å—"
db_test_2:
  script: - "æµ‹è¯•è®¢å•æ¨¡å—"
db_test_3:
  script: - "æµ‹è¯•æ”¯ä»˜æ¨¡å—"

# é—®é¢˜ï¼šå¯èƒ½äº’ç›¸å¹²æ‰°ï¼Œå¯¼è‡´æµ‹è¯•å¤±è´¥
```

### 5.3 å¹¶è¡Œåº¦æ§åˆ¶


**é™åˆ¶å¹¶è¡Œæ‰§è¡Œæ•°é‡ï¼š**
```yaml
# æ–¹æ³•1ï¼šä½¿ç”¨resource_group
deploy_staging:
  resource_group: staging_environment
  script:
    - echo "åŒæ—¶åªèƒ½æœ‰1ä¸ªéƒ¨ç½²Jobè¿è¡Œ"

deploy_testing:
  resource_group: staging_environment  # åŒä¸€ç»„ï¼Œä¸²è¡Œæ‰§è¡Œ
  script:
    - echo "å¿…é¡»ç­‰ä¸Šé¢çš„å®Œæˆ"

# æ–¹æ³•2ï¼šä½¿ç”¨tagsé™åˆ¶Runner
cpu_intensive_job:
  tags:
    - high-performance  # åªåœ¨é«˜æ€§èƒ½Runnerä¸Šæ‰§è¡Œ
  parallel: 3           # æœ€å¤š3ä¸ªå¹¶è¡Œå®ä¾‹
```

**Runnerèµ„æºç®¡ç†ï¼š**
```yaml
# ä¸ºä¸åŒç±»å‹çš„Jobåˆ†é…ä¸åŒRunner
fast_tests:
  tags: [small-runner]    # è½»é‡çº§æµ‹è¯•ç”¨å°Runner
  script: - pytest unit/

heavy_tests:
  tags: [large-runner]    # é‡å‹æµ‹è¯•ç”¨å¤§Runner
  script: - pytest integration/

deploy_job:
  tags: [deploy-runner]   # éƒ¨ç½²ç”¨ä¸“ç”¨Runner
  script: - ./deploy.sh
```

### 5.4 èµ„æºç«äº‰è§£å†³ç­–ç•¥


**ğŸ”„ ç­–ç•¥1ï¼šé”™å³°æ‰§è¡Œ**
```yaml
# è®©èµ„æºå¯†é›†å‹Jobé”™å¼€æ‰§è¡Œ
heavy_test_1:
  needs: [build]
  
heavy_test_2:
  needs: [heavy_test_1]  # ç­‰ç¬¬ä¸€ä¸ªå®Œæˆå†æ‰§è¡Œ
  
heavy_test_3:
  needs: [heavy_test_2]  # ç»§ç»­ä¸²è¡Œ
```

**ğŸŠ ç­–ç•¥2ï¼šèµ„æºæ± ç®¡ç†**
```yaml
# ä¸ºä¸åŒç±»å‹ä»»åŠ¡åˆ†é…ä¸“é—¨çš„Runneræ± 
variables:
  TEST_RUNNER_POOL: "test-runners"
  DEPLOY_RUNNER_POOL: "deploy-runners"
  
unit_tests:
  tags: [$TEST_RUNNER_POOL]
  
deploy:
  tags: [$DEPLOY_RUNNER_POOL]
```

**â±ï¸ ç­–ç•¥3ï¼šæ—¶é—´çª—å£æ§åˆ¶**
```yaml
# åœ¨ç‰¹å®šæ—¶é—´çª—å£æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡
performance_test:
  script: - run_performance_tests.sh
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"  # åªåœ¨å®šæ—¶ä»»åŠ¡ä¸­æ‰§è¡Œ
    - if: $CI_COMMIT_BRANCH == "main"
      when: manual  # åœ¨ä¸»åˆ†æ”¯éœ€è¦æ‰‹åŠ¨è§¦å‘
```

---

## 6. ğŸ¯ æ‰§è¡Œé¡ºåºä¼˜åŒ–ç­–ç•¥


### 6.1 ä¼˜åŒ–åŸåˆ™


**âš¡ å…³é”®è·¯å¾„ä¼˜åŒ–ï¼š**
æ‰¾å‡º**æœ€é•¿çš„æ‰§è¡Œè·¯å¾„**ï¼Œä¼˜å…ˆä¼˜åŒ–å®ƒï¼š
```
è·¯å¾„åˆ†æï¼š
è·¯å¾„Aï¼šæ„å»º(2åˆ†é’Ÿ) â†’ å•å…ƒæµ‹è¯•(3åˆ†é’Ÿ) â†’ éƒ¨ç½²(2åˆ†é’Ÿ) = 7åˆ†é’Ÿ
è·¯å¾„Bï¼šæ„å»º(2åˆ†é’Ÿ) â†’ é›†æˆæµ‹è¯•(8åˆ†é’Ÿ) â†’ å®¡è®¡(1åˆ†é’Ÿ) = 11åˆ†é’Ÿ

å…³é”®è·¯å¾„æ˜¯Bï¼Œé‡ç‚¹ä¼˜åŒ–é›†æˆæµ‹è¯•
```

### 6.2 å®ç”¨ä¼˜åŒ–æŠ€å·§


**ğŸ“ˆ æŠ€å·§1ï¼šå¿«é€Ÿå¤±è´¥åŸåˆ™**
```yaml
# æŠŠå®¹æ˜“å¤±è´¥çš„æµ‹è¯•æ”¾åœ¨å‰é¢
lint_check:
  stage: validate
  script: - run_linter
  # è¯­æ³•æ£€æŸ¥æœ€å¿«ï¼Œå¤±è´¥äº†åé¢å°±ä¸ç”¨è·‘äº†

unit_tests:
  stage: test
  needs: [lint_check]
  script: - pytest unit/
  # å•å…ƒæµ‹è¯•æ¯”é›†æˆæµ‹è¯•å¿«

integration_tests:
  stage: test
  needs: [unit_tests]  # å•å…ƒæµ‹è¯•é€šè¿‡æ‰è·‘é›†æˆæµ‹è¯•
  script: - pytest integration/
```

**ğŸ”§ æŠ€å·§2ï¼šåˆ†å±‚å¹¶è¡Œ**
```yaml
# ç¬¬1å±‚ï¼šåŸºç¡€æ£€æŸ¥ï¼ˆå¹¶è¡Œï¼‰
lint_check:
  stage: validate
  script: - run_linter

security_scan:
  stage: validate  
  script: - security_scanner

# ç¬¬2å±‚ï¼šæ„å»ºï¼ˆä¾èµ–ç¬¬1å±‚ï¼‰
build_app:
  stage: build
  needs: [lint_check, security_scan]
  script: - build_application

# ç¬¬3å±‚ï¼šæµ‹è¯•ï¼ˆå¹¶è¡Œï¼Œä¾èµ–æ„å»ºï¼‰
unit_test:
  stage: test
  needs: [build_app]
  script: - pytest unit/

integration_test:
  stage: test
  needs: [build_app]
  script: - pytest integration/

# ç¬¬4å±‚ï¼šéƒ¨ç½²ï¼ˆä¾èµ–å¿…è¦æµ‹è¯•ï¼‰
deploy:
  stage: deploy
  needs: [unit_test]  # åªéœ€è¦å•å…ƒæµ‹è¯•é€šè¿‡
  script: - deploy_app
```

### 6.3 å¤æ‚åœºæ™¯ä¼˜åŒ–ç¤ºä¾‹


**å®é™…é¡¹ç›®ä¼˜åŒ–æ¡ˆä¾‹ï¼š**
```yaml
stages:
  - validate
  - build
  - test
  - security
  - deploy

# éªŒè¯é˜¶æ®µï¼ˆå¹¶è¡Œï¼‰
code_quality:
  stage: validate
  script: - sonarqube_scan
  
dependency_check:
  stage: validate
  script: - check_dependencies

# æ„å»ºé˜¶æ®µ
build_frontend:
  stage: build
  needs: [code_quality]
  script: - npm run build
  artifacts:
    paths: [dist/]

build_backend:
  stage: build  
  needs: [dependency_check]
  script: - docker build
  artifacts:
    paths: [backend.tar]

# æµ‹è¯•é˜¶æ®µï¼ˆåˆ†ç»„å¹¶è¡Œï¼‰
frontend_tests:
  stage: test
  needs: [build_frontend]
  parallel: 3  # åˆ†3ç»„å¹¶è¡Œæ‰§è¡Œ
  script: - npm run test

backend_tests:
  stage: test
  needs: [build_backend]
  script: - pytest

# å®‰å…¨æ‰«æï¼ˆå¹¶è¡Œï¼‰
container_scan:
  stage: security
  needs: [build_backend]
  script: - scan_container

api_security_test:
  stage: security
  needs: [backend_tests]
  script: - security_api_test

# éƒ¨ç½²ï¼ˆæ ¹æ®ä¸åŒç¯å¢ƒéœ€æ±‚ï¼‰
deploy_staging:
  stage: deploy
  needs: [frontend_tests, backend_tests]
  script: - deploy_to_staging

deploy_production:
  stage: deploy
  needs: [deploy_staging, container_scan, api_security_test]
  script: - deploy_to_production
  when: manual  # ç”Ÿäº§éƒ¨ç½²éœ€è¦æ‰‹åŠ¨ç¡®è®¤
```

### 6.4 ç›‘æ§å’Œè°ƒä¼˜


**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡ï¼š**
```yaml
# æ·»åŠ æ—¶é—´ç›‘æ§
.timing_template: &timing
  before_script:
    - echo "Jobå¼€å§‹æ—¶é—´ï¼š$(date)"
  after_script:
    - echo "Jobç»“æŸæ—¶é—´ï¼š$(date)"

build_job:
  <<: *timing
  script: - build_app

# ç›‘æ§Runneråˆ©ç”¨ç‡
runner_status:
  stage: .post  # åœ¨æ‰€æœ‰Jobä¹‹åè¿è¡Œ
  script:
    - echo "æ£€æŸ¥Runnerä½¿ç”¨æƒ…å†µ"
    - gitlab-runner list
```

**ğŸ”§ æŒç»­ä¼˜åŒ–å»ºè®®ï¼š**
- ğŸ“ˆ **å®šæœŸåˆ†æ**Pipelineæ‰§è¡Œæ—¶é—´
- ğŸ¯ **è¯†åˆ«ç“¶é¢ˆ**Jobå’Œå…³é”®è·¯å¾„
- âš¡ **ä¼˜åŒ–æ…¢é€Ÿ**ä»»åŠ¡ï¼ˆç¼“å­˜ã€å¹¶è¡Œç­‰ï¼‰
- ğŸ“Š **ç›‘æ§èµ„æº**ä½¿ç”¨æƒ…å†µ
- ğŸ”„ **è¿­ä»£æ”¹è¿›**Pipelineè®¾è®¡

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ¦‚å¿µ


```
ğŸ”¸ å¹¶è¡Œæ‰§è¡Œï¼šå¤šä¸ªJobåŒæ—¶è¿è¡Œï¼Œæå‡æ•ˆç‡
ğŸ”¸ Jobä¾èµ–ï¼šä½¿ç”¨needsæŒ‡å®šç²¾ç¡®çš„ä¾èµ–å…³ç³»
ğŸ”¸ DAGå›¾ï¼šå¯è§†åŒ–Pipelineçš„æ‰§è¡Œæµç¨‹
ğŸ”¸ èµ„æºç«äº‰ï¼šåˆç†åˆ†é…å’Œæ§åˆ¶Runnerèµ„æº
ğŸ”¸ æ‰§è¡Œä¼˜åŒ–ï¼šé€šè¿‡ç­–ç•¥è®¾è®¡å‡å°‘æ€»æ‰§è¡Œæ—¶é—´
```

### 7.2 å…³é”®è¯­æ³•å¯¹æ¯”


| æ¦‚å¿µ | **ä¼ ç»Ÿæ–¹å¼** | **ä¼˜åŒ–æ–¹å¼** | **é€‚ç”¨åœºæ™¯** |
|------|------------|------------|-------------|
| **ä¾èµ–æ§åˆ¶** | `stageé¡ºåº` | `needså…³é”®å­—` | `ç²¾ç¡®æ§åˆ¶ä¾èµ–` |
| **å¹¶è¡Œæ‰§è¡Œ** | `åŒstageè‡ªåŠ¨å¹¶è¡Œ` | `needs+å¹¶è¡Œè®¾è®¡` | `æœ€å¤§åŒ–èµ„æºåˆ©ç”¨` |
| **èµ„æºæ§åˆ¶** | `æ— é™åˆ¶` | `resource_group` | `é¿å…èµ„æºå†²çª` |
| **å¤±è´¥å¤„ç†** | `æ•´stageå¤±è´¥` | `optionalä¾èµ–` | `å…è®¸éƒ¨åˆ†å¤±è´¥` |

### 7.3 æœ€ä½³å®è·µè¦ç‚¹


**ğŸ¯ è®¾è®¡åŸåˆ™ï¼š**
- **å¿«é€Ÿå¤±è´¥**ï¼šæŠŠå®¹æ˜“å¤±è´¥çš„Jobæ”¾å‰é¢
- **åˆ†å±‚å¹¶è¡Œ**ï¼šåˆç†è®¾è®¡ä¾èµ–å±‚æ¬¡
- **èµ„æºå¹³è¡¡**ï¼šé¿å…è¿‡åº¦å¹¶è¡Œå¯¼è‡´èµ„æºç«äº‰
- **å…³é”®è·¯å¾„**ï¼šä¼˜å…ˆä¼˜åŒ–æœ€é•¿æ‰§è¡Œè·¯å¾„

**âš¡ å®æ–½å»ºè®®ï¼š**
- ä»ç®€å•çš„needså¼€å§‹ï¼Œé€æ­¥å¤æ‚åŒ–
- ç›‘æ§Pipelineæ‰§è¡Œæ—¶é—´å’Œèµ„æºä½¿ç”¨
- å®šæœŸreviewå’Œä¼˜åŒ–DAGç»“æ„
- ä¸ºä¸åŒç±»å‹Jobåˆ†é…åˆé€‚çš„Runner

**ğŸ”§ å¸¸ç”¨æ¨¡å¼ï¼š**
```yaml
# æ ‡å‡†çš„ä¸‰å±‚å¹¶è¡Œæ¨¡å¼
æ„å»ºå±‚ â†’ æµ‹è¯•å±‚(å¹¶è¡Œ) â†’ éƒ¨ç½²å±‚
  â†“        â†“              â†“
å•ä¸€Job  å¤šä¸ªJobåŒæ—¶è¿è¡Œ   æ ¹æ®éœ€è¦ä¾èµ–
```

### 7.4 é¿å…çš„å¸¸è§é”™è¯¯


**âŒ è¿‡åº¦å¹¶è¡Œï¼š**
```yaml
# é”™è¯¯ï¼š10ä¸ªJobåŒæ—¶å¯åŠ¨ï¼Œä½†åªæœ‰2ä¸ªRunner
# ç»“æœï¼šèµ„æºç«äº‰ï¼Œåè€Œå˜æ…¢
```

**âŒ å¾ªç¯ä¾èµ–ï¼š**
```yaml
# é”™è¯¯ï¼šAä¾èµ–Bï¼ŒBä¾èµ–A
# ç»“æœï¼šPipelineæ— æ³•å¯åŠ¨
```

**âŒ å¿½ç•¥èµ„æºé™åˆ¶ï¼š**
```yaml
# é”™è¯¯ï¼šå¤šä¸ªæ•°æ®åº“æµ‹è¯•åŒæ—¶è¿è¡Œ
# ç»“æœï¼šæµ‹è¯•æ•°æ®å†²çªï¼Œç»“æœä¸å¯é 
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹ï¼š**
- å¹¶è¡Œæ‰§è¡Œæ˜¯ä¸ºäº†**æå‡æ•ˆç‡**ï¼Œä¸æ˜¯ä¸ºäº†å¹¶è¡Œè€Œå¹¶è¡Œ
- needså…³é”®å­—è®©ä½ **ç²¾ç¡®æ§åˆ¶**ä¾èµ–å…³ç³»
- DAGå›¾å¸®åŠ©ä½ **å¯è§†åŒ–**å’Œ**ä¼˜åŒ–**æ‰§è¡Œæµç¨‹
- èµ„æºç®¡ç†æ˜¯å¹¶è¡Œæ‰§è¡ŒæˆåŠŸçš„**å…³é”®å› ç´ **
- æŒç»­ç›‘æ§å’Œä¼˜åŒ–æ˜¯**é•¿æœŸæˆåŠŸ**çš„ä¿è¯