---
title: 15ã€å¤šé˜¶æ®µéƒ¨ç½²æµç¨‹
---
## ğŸ“š ç›®å½•

1. [å¤šé˜¶æ®µéƒ¨ç½²æ¦‚è¿°](#1-å¤šé˜¶æ®µéƒ¨ç½²æ¦‚è¿°)
2. [å¼€å‘æµ‹è¯•ç”Ÿäº§ç¯å¢ƒè¯¦è§£](#2-å¼€å‘æµ‹è¯•ç”Ÿäº§ç¯å¢ƒè¯¦è§£)
3. [é˜¶æ®µé—´ä¾èµ–å…³ç³»é…ç½®](#3-é˜¶æ®µé—´ä¾èµ–å…³ç³»é…ç½®)
4. [æ‰‹åŠ¨ç¡®è®¤ä¸è‡ªåŠ¨éƒ¨ç½²](#4-æ‰‹åŠ¨ç¡®è®¤ä¸è‡ªåŠ¨éƒ¨ç½²)
5. [éƒ¨ç½²å®¡æ‰¹æµç¨‹ç®¡ç†](#5-éƒ¨ç½²å®¡æ‰¹æµç¨‹ç®¡ç†)
6. [å¹¶è¡Œéƒ¨ç½²é…ç½®](#6-å¹¶è¡Œéƒ¨ç½²é…ç½®)
7. [è“ç»¿éƒ¨ç½²ç­–ç•¥](#7-è“ç»¿éƒ¨ç½²ç­–ç•¥)
8. [ç°åº¦å‘å¸ƒå®ç°](#8-ç°åº¦å‘å¸ƒå®ç°)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ å¤šé˜¶æ®µéƒ¨ç½²æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¤šé˜¶æ®µéƒ¨ç½²


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒæ–°è¯ç ”å‘ä¸€æ ·ï¼š
å®éªŒå®¤æµ‹è¯• â†’ åŠ¨ç‰©è¯•éªŒ â†’ å°è§„æ¨¡äººä½“è¯•éªŒ â†’ å¤§è§„æ¨¡ä¸´åºŠè¯•éªŒ â†’ æ­£å¼ä¸Šå¸‚

è½¯ä»¶éƒ¨ç½²ä¹Ÿæ˜¯ï¼š
å¼€å‘ç¯å¢ƒ â†’ æµ‹è¯•ç¯å¢ƒ â†’ é¢„ç”Ÿäº§ç¯å¢ƒ â†’ ç”Ÿäº§ç¯å¢ƒ
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
å¤šé˜¶æ®µéƒ¨ç½²æ˜¯æŒ‡å°†ä»£ç ä»å¼€å‘å®Œæˆåˆ°æ­£å¼ä¸Šçº¿ï¼Œç»è¿‡å¤šä¸ªä¸åŒç¯å¢ƒçš„é€æ­¥éªŒè¯è¿‡ç¨‹ã€‚æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç‰¹å®šçš„ç›®çš„å’ŒéªŒè¯æ ‡å‡†ã€‚

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å¤šé˜¶æ®µéƒ¨ç½²**
- **é™ä½é£é™©**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¹‹å‰å‘ç°é—®é¢˜
- **è´¨é‡ä¿è¯**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½æœ‰è´¨é‡æ£€æŸ¥
- **ç¨³å®šå‘å¸ƒ**ï¼šé¿å…ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„é£é™©
- **å›æ»šä¿éšœ**ï¼šå‡ºé—®é¢˜æ—¶å¯ä»¥å¿«é€Ÿå›é€€

### 1.2 å¤šé˜¶æ®µéƒ¨ç½²çš„æ ¸å¿ƒä»·å€¼


**ğŸ“Š é£é™©æ§åˆ¶å¯¹æ¯”**
```
ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ï¼š
ä»£ç æäº¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ç”Ÿäº§ç¯å¢ƒ
é£é™©ï¼šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ (æé«˜)

å¤šé˜¶æ®µéƒ¨ç½²ï¼š
ä»£ç æäº¤ â”€â”€â–¶ å¼€å‘ç¯å¢ƒ â”€â”€â–¶ æµ‹è¯•ç¯å¢ƒ â”€â”€â–¶ ç”Ÿäº§ç¯å¢ƒ
é£é™©ï¼šğŸŸ¡ğŸŸ¡ğŸŸ¢ğŸŸ¢ğŸŸ¢ (å¯æ§)
```

**âœ… ä¸»è¦æ”¶ç›Š**
- æå‰å‘ç°BUGï¼Œé¿å…ç”Ÿäº§äº‹æ•…
- ç¡®ä¿åŠŸèƒ½åœ¨ä¸åŒç¯å¢ƒä¸‹æ­£å¸¸è¿è¡Œ
- æä¾›å¤šæ¬¡éªŒè¯æœºä¼š
- æ”¯æŒå›¢é˜Ÿåä½œå’Œä»£ç å®¡æŸ¥

---

## 2. ğŸ—ï¸ å¼€å‘æµ‹è¯•ç”Ÿäº§ç¯å¢ƒè¯¦è§£


### 2.1 ç¯å¢ƒåˆ†ç±»ä¸ä½œç”¨


**ğŸ¢ ç¯å¢ƒå±‚çº§å›¾**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘ç¯å¢ƒ       â”‚ â† å¼€å‘äººå‘˜æ—¥å¸¸å·¥ä½œ
â”‚   Development   â”‚   å¿«é€Ÿè¿­ä»£ã€å®æ—¶è°ƒè¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµ‹è¯•ç¯å¢ƒ       â”‚ â† QAå›¢é˜Ÿä¸“ç”¨
â”‚   Testing       â”‚   åŠŸèƒ½æµ‹è¯•ã€é›†æˆæµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¢„ç”Ÿäº§ç¯å¢ƒ      â”‚ â† ç”Ÿäº§ç¯å¢ƒé•œåƒ
â”‚   Staging       â”‚   æœ€ç»ˆéªŒè¯ã€æ€§èƒ½æµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”Ÿäº§ç¯å¢ƒ       â”‚ â† ç”¨æˆ·çœŸå®ä½¿ç”¨
â”‚   Production    â”‚   ç¨³å®šå¯é ã€é«˜å¯ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å„ç¯å¢ƒè¯¦ç»†è¯´æ˜


#### ğŸ”§ å¼€å‘ç¯å¢ƒ (Development)


**ğŸ”¸ ä¸»è¦ç‰¹ç‚¹**
- **ç›®çš„**ï¼šå¼€å‘äººå‘˜æ—¥å¸¸ç¼–ç å’Œè°ƒè¯•
- **ç¨³å®šæ€§è¦æ±‚**ï¼šä½ï¼Œå…è®¸é¢‘ç¹å˜æ›´
- **æ•°æ®**ï¼šæ¨¡æ‹Ÿæ•°æ®æˆ–è„±æ•æ•°æ®
- **æ€§èƒ½è¦æ±‚**ï¼šä¸€èˆ¬ï¼Œä¸»è¦å…³æ³¨åŠŸèƒ½å®ç°

**âš™ï¸ å…¸å‹é…ç½®**
```yaml
# .gitlab-ci.yml å¼€å‘ç¯å¢ƒé…ç½®
deploy_dev:
  stage: deploy
  environment:
    name: development
    url: https://dev.example.com
  script:
    - echo "éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ"
    - docker build -t app:dev .
    - docker run -d -p 3000:3000 app:dev
  only:
    - develop
```

**ğŸ“‹ å¼€å‘ç¯å¢ƒæ£€æŸ¥æ¸…å•**
- [ ] ä»£ç ç¼–è¯‘æˆåŠŸ
- [ ] åŸºæœ¬åŠŸèƒ½å¯ç”¨
- [ ] å¼€å‘äººå‘˜è‡ªæµ‹é€šè¿‡
- [ ] æ— æ˜æ˜¾é”™è¯¯æ—¥å¿—

#### ğŸ§ª æµ‹è¯•ç¯å¢ƒ (Testing)


**ğŸ”¸ ä¸»è¦ç‰¹ç‚¹**
- **ç›®çš„**ï¼šQAå›¢é˜Ÿè¿›è¡Œå…¨é¢åŠŸèƒ½æµ‹è¯•
- **ç¨³å®šæ€§è¦æ±‚**ï¼šä¸­ç­‰ï¼Œéœ€è¦ç›¸å¯¹ç¨³å®šä¾¿äºæµ‹è¯•
- **æ•°æ®**ï¼šæ¥è¿‘çœŸå®çš„æµ‹è¯•æ•°æ®
- **æ€§èƒ½è¦æ±‚**ï¼šæ¥è¿‘ç”Ÿäº§ç¯å¢ƒé…ç½®

**ğŸ’¡ æµ‹è¯•ç¯å¢ƒçš„å…³é”®ä½œç”¨**
```
åŠŸèƒ½æµ‹è¯•ï¼šéªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ
é›†æˆæµ‹è¯•ï¼šéªŒè¯å„ä¸ªæ¨¡å—ä¹‹é—´çš„åä½œ
ç”¨æˆ·ä½“éªŒæµ‹è¯•ï¼šéªŒè¯ç•Œé¢å’Œäº¤äº’æµç¨‹
æ€§èƒ½åˆæµ‹ï¼šåŸºæœ¬çš„æ€§èƒ½æŒ‡æ ‡éªŒè¯
```

#### ğŸ­ é¢„ç”Ÿäº§ç¯å¢ƒ (Staging)


**ğŸ”¸ ä¸»è¦ç‰¹ç‚¹**
- **ç›®çš„**ï¼šæœ€åä¸€é“é˜²çº¿ï¼Œæ¨¡æ‹ŸçœŸå®ç”Ÿäº§ç¯å¢ƒ
- **ç¨³å®šæ€§è¦æ±‚**ï¼šé«˜ï¼Œå¿…é¡»ä¸ç”Ÿäº§ç¯å¢ƒé«˜åº¦ä¸€è‡´
- **æ•°æ®**ï¼šç”Ÿäº§æ•°æ®çš„å‰¯æœ¬æˆ–é«˜ä»¿çœŸæ•°æ®
- **æ€§èƒ½è¦æ±‚**ï¼šä¸ç”Ÿäº§ç¯å¢ƒç›¸åŒæˆ–ç›¸è¿‘

**âš ï¸ é‡è¦æé†’**
> é¢„ç”Ÿäº§ç¯å¢ƒæ˜¯å‘ç°ç”Ÿäº§ç¯å¢ƒç‰¹æœ‰é—®é¢˜çš„æœ€åæœºä¼šï¼Œé…ç½®å¿…é¡»ä¸ç”Ÿäº§ç¯å¢ƒä¿æŒé«˜åº¦ä¸€è‡´

#### ğŸŒ ç”Ÿäº§ç¯å¢ƒ (Production)


**ğŸ”¸ ä¸»è¦ç‰¹ç‚¹**
- **ç›®çš„**ï¼šç”¨æˆ·çœŸå®ä½¿ç”¨çš„ç¯å¢ƒ
- **ç¨³å®šæ€§è¦æ±‚**ï¼šæé«˜ï¼Œä¸å®¹è®¸å‡ºé”™
- **æ•°æ®**ï¼šçœŸå®ç”¨æˆ·æ•°æ®ï¼Œéœ€è¦ä¸¥æ ¼ä¿æŠ¤
- **æ€§èƒ½è¦æ±‚**ï¼šæœ€é«˜ï¼Œéœ€è¦æ”¯æ’‘å®é™…ä¸šåŠ¡è´Ÿè½½

**ğŸ”’ ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŸåˆ™**
- æœ€å°æƒé™è®¿é—®
- ä¸¥æ ¼çš„éƒ¨ç½²å®¡æ‰¹æµç¨‹
- å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦
- å¿«é€Ÿå›æ»šèƒ½åŠ›

### 2.3 ç¯å¢ƒé…ç½®æœ€ä½³å®è·µ


**ğŸ“ ç¯å¢ƒé…ç½®æ–‡ä»¶ç»„ç»‡**
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .gitlab-ci.yml
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ development.yml
â”‚   â”œâ”€â”€ testing.yml
â”‚   â”œâ”€â”€ staging.yml
â”‚   â””â”€â”€ production.yml
â””â”€â”€ scripts/
    â”œâ”€â”€ deploy-dev.sh
    â”œâ”€â”€ deploy-test.sh
    â”œâ”€â”€ deploy-staging.sh
    â””â”€â”€ deploy-prod.sh
```

**ğŸ¯ é…ç½®ç®¡ç†åŸåˆ™**
- **ç¯å¢ƒéš”ç¦»**ï¼šæ¯ä¸ªç¯å¢ƒç‹¬ç«‹é…ç½®ï¼Œäº’ä¸å½±å“
- **é…ç½®åˆ†ç¦»**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ‰€æœ‰é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬ç®¡ç†
- **æ–‡æ¡£ç»´æŠ¤**ï¼šæ¯ä¸ªç¯å¢ƒçš„é…ç½®éƒ½è¦æœ‰æ¸…æ™°æ–‡æ¡£

---

## 3. ğŸ”— é˜¶æ®µé—´ä¾èµ–å…³ç³»é…ç½®


### 3.1 ä¾èµ–å…³ç³»çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒè€ƒè¯•å‡çº§ï¼š
å°å­¦æ¯•ä¸š â†’ æ‰èƒ½ä¸Šåˆä¸­ â†’ æ‰èƒ½ä¸Šé«˜ä¸­ â†’ æ‰èƒ½ä¸Šå¤§å­¦

ä»£ç éƒ¨ç½²ä¹Ÿæ˜¯ï¼š
å¼€å‘ç¯å¢ƒé€šè¿‡ â†’ æ‰èƒ½åˆ°æµ‹è¯•ç¯å¢ƒ â†’ æ‰èƒ½åˆ°é¢„ç”Ÿäº§ â†’ æ‰èƒ½åˆ°ç”Ÿäº§
```

**ğŸ”¸ æ ¸å¿ƒåŸç†**
ä¾èµ–å…³ç³»ç¡®ä¿ä»£ç å¿…é¡»åœ¨å‰ä¸€ä¸ªé˜¶æ®µéªŒè¯é€šè¿‡åï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚è¿™æ˜¯è´¨é‡ä¿è¯çš„é‡è¦æœºåˆ¶ã€‚

### 3.2 GitLab CI/CDä¸­çš„ä¾èµ–é…ç½®


**ğŸ“‹ åŸºç¡€ä¾èµ–é…ç½®**
```yaml
stages:
  - build
  - test
  - deploy_dev
  - deploy_test
  - deploy_staging
  - deploy_prod

# æ„å»ºé˜¶æ®µ
build_job:
  stage: build
  script:
    - echo "æ„å»ºåº”ç”¨"
    - npm install
    - npm run build

# æµ‹è¯•é˜¶æ®µï¼ˆä¾èµ–æ„å»ºå®Œæˆï¼‰
test_job:
  stage: test
  script:
    - echo "è¿è¡Œæµ‹è¯•"
    - npm run test
  needs: [build_job]

# å¼€å‘ç¯å¢ƒéƒ¨ç½²
deploy_development:
  stage: deploy_dev
  script:
    - echo "éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ"
  needs: [test_job]
  only:
    - develop

# æµ‹è¯•ç¯å¢ƒéƒ¨ç½²ï¼ˆéœ€è¦å¼€å‘ç¯å¢ƒæˆåŠŸï¼‰
deploy_testing:
  stage: deploy_test
  script:
    - echo "éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"
  needs: [deploy_development]
  only:
    - main
```

### 3.3 é«˜çº§ä¾èµ–é…ç½®æŠ€å·§


**ğŸ”§ æ¡ä»¶ä¾èµ–é…ç½®**
```yaml
deploy_staging:
  stage: deploy_staging
  script:
    - echo "éƒ¨ç½²åˆ°é¢„ç”Ÿäº§ç¯å¢ƒ"
  needs:
    - job: deploy_testing
      artifacts: true  # éœ€è¦å‰ä¸€é˜¶æ®µçš„äº§å‡ºç‰©
  rules:
    - if: '$CI_COMMIT_TAG'  # åªæœ‰æ‰“æ ‡ç­¾æ—¶æ‰è§¦å‘
    - if: '$CI_PIPELINE_SOURCE == "schedule"'  # å®šæ—¶ä»»åŠ¡è§¦å‘
```

**âš¡ å¹¶è¡Œä¾èµ–å¤„ç†**
```yaml
# å¤šä¸ªæµ‹è¯•å¯ä»¥å¹¶è¡Œè¿è¡Œ
unit_test:
  stage: test
  script: [npm run test:unit]

integration_test:
  stage: test
  script: [npm run test:integration]

security_scan:
  stage: test
  script: [npm run security:scan]

# éƒ¨ç½²éœ€è¦æ‰€æœ‰æµ‹è¯•é€šè¿‡
deploy_staging:
  stage: deploy_staging
  script: [echo "éƒ¨ç½²åˆ°é¢„ç”Ÿäº§"]
  needs: 
    - unit_test
    - integration_test
    - security_scan
```

### 3.4 ä¾èµ–å¤±è´¥çš„å¤„ç†ç­–ç•¥


**ğŸš¨ å¤±è´¥å¤„ç†é…ç½®**
```yaml
deploy_with_retry:
  stage: deploy
  script:
    - echo "å°è¯•éƒ¨ç½²"
    - ./deploy.sh
  retry:
    max: 3  # æœ€å¤šé‡è¯•3æ¬¡
    when:
      - runner_system_failure
      - stuck_or_timeout_failure
  
deploy_with_fallback:
  stage: deploy
  script:
    - echo "éƒ¨ç½²å¤±è´¥ï¼Œæ‰§è¡Œå›æ»š"
    - ./rollback.sh
  when: on_failure  # åªåœ¨å‰é¢ä»»åŠ¡å¤±è´¥æ—¶æ‰§è¡Œ
```

**ğŸ“Š ä¾èµ–å…³ç³»å¯è§†åŒ–**
```
æ„å»ºé˜¶æ®µ
    â†“
â”Œâ”€ å•å…ƒæµ‹è¯• â”€â”
â”œâ”€ é›†æˆæµ‹è¯• â”€â”¤â”€â†’ å¼€å‘ç¯å¢ƒéƒ¨ç½²
â”œâ”€ å®‰å…¨æ‰«æ â”€â”˜       â†“
                æµ‹è¯•ç¯å¢ƒéƒ¨ç½²
                     â†“
               é¢„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
                     â†“
                ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```

---

## 4. âœ‹ æ‰‹åŠ¨ç¡®è®¤ä¸è‡ªåŠ¨éƒ¨ç½²


### 4.1 æ‰‹åŠ¨ç¡®è®¤çš„åº”ç”¨åœºæ™¯


**ğŸ¤” ä»€ä¹ˆæ—¶å€™éœ€è¦æ‰‹åŠ¨ç¡®è®¤**
- **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**ï¼šé£é™©æœ€é«˜ï¼Œéœ€è¦äººå·¥å†³ç­–
- **é‡è¦ç‰ˆæœ¬å‘å¸ƒ**ï¼šæ–°åŠŸèƒ½ä¸Šçº¿å‰çš„æœ€åç¡®è®¤
- **ç´§æ€¥ä¿®å¤**ï¼šç¡®ä¿ä¿®å¤æ–¹æ¡ˆæ­£ç¡®æ— è¯¯
- **æ•°æ®åº“å˜æ›´**ï¼šæ¶‰åŠæ•°æ®è¿ç§»çš„æ“ä½œ

**ğŸ’­ ä¸ºä»€ä¹ˆéœ€è¦æ‰‹åŠ¨ç¡®è®¤**
```
è‡ªåŠ¨åŒ–å¾ˆå¥½ï¼Œä½†æœ‰äº›æƒ…å†µéœ€è¦äººçš„åˆ¤æ–­ï¼š
â€¢ ä¸šåŠ¡æ—¶æœºï¼šæ˜¯å¦æ˜¯åˆé€‚çš„å‘å¸ƒæ—¶é—´
â€¢ å¤–éƒ¨ä¾èµ–ï¼šç›¸å…³ç³»ç»Ÿæ˜¯å¦å‡†å¤‡å°±ç»ª
â€¢ é£é™©è¯„ä¼°ï¼šå½“å‰æ˜¯å¦é€‚åˆè¿›è¡Œéƒ¨ç½²
â€¢ åº”æ€¥å‡†å¤‡ï¼šå›¢é˜Ÿæ˜¯å¦å…·å¤‡å¤„ç†é—®é¢˜çš„èƒ½åŠ›
```

### 4.2 GitLabä¸­çš„æ‰‹åŠ¨ç¡®è®¤é…ç½®


**ğŸ”§ åŸºç¡€æ‰‹åŠ¨ç¡®è®¤è®¾ç½®**
```yaml
deploy_production:
  stage: deploy
  environment:
    name: production
    url: https://production.example.com
  script:
    - echo "éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
    - ./deploy-prod.sh
  when: manual  # è®¾ç½®ä¸ºæ‰‹åŠ¨è§¦å‘
  only:
    - main
  allow_failure: false  # ä¸å…è®¸å¤±è´¥
```

**âš™ï¸ å¸¦æ¡ä»¶çš„æ‰‹åŠ¨ç¡®è®¤**
```yaml
deploy_staging:
  stage: deploy_staging
  script:
    - echo "éƒ¨ç½²åˆ°é¢„ç”Ÿäº§"
    - ./deploy-staging.sh
  when: manual
  rules:
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'  # åªæœ‰ç‰ˆæœ¬æ ‡ç­¾æ—¶æ˜¾ç¤º
      when: manual
    - when: never

# ç”Ÿäº§éƒ¨ç½²éœ€è¦é¢„ç”Ÿäº§æˆåŠŸ
deploy_production:
  stage: deploy_production
  script:
    - echo "éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
    - ./deploy-prod.sh
  when: manual
  needs: [deploy_staging]
  environment:
    name: production
```

### 4.3 è‡ªåŠ¨éƒ¨ç½²çš„é…ç½®ç­–ç•¥


**ğŸš€ è‡ªåŠ¨éƒ¨ç½²é€‚ç”¨åœºæ™¯**
- **å¼€å‘ç¯å¢ƒ**ï¼šä»£ç æäº¤å³éƒ¨ç½²ï¼Œå¿«é€ŸéªŒè¯
- **æµ‹è¯•ç¯å¢ƒ**ï¼šä¸»åˆ†æ”¯åˆå¹¶åè‡ªåŠ¨éƒ¨ç½²
- **å›æ»šæ“ä½œ**ï¼šæ£€æµ‹åˆ°é—®é¢˜æ—¶è‡ªåŠ¨å›æ»š

**âš¡ è‡ªåŠ¨éƒ¨ç½²é…ç½®ç¤ºä¾‹**
```yaml
# å¼€å‘ç¯å¢ƒè‡ªåŠ¨éƒ¨ç½²
auto_deploy_dev:
  stage: deploy
  environment:
    name: development
    url: https://dev.example.com
    auto_stop_in: 1 day  # 1å¤©åè‡ªåŠ¨åœæ­¢ç¯å¢ƒ
  script:
    - echo "è‡ªåŠ¨éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ"
    - ./deploy-dev.sh
  only:
    - develop
  # æ— éœ€ when: manualï¼Œé»˜è®¤è‡ªåŠ¨æ‰§è¡Œ

# åŸºäºåˆ†æ”¯çš„è‡ªåŠ¨éƒ¨ç½²
auto_deploy_feature:
  stage: deploy
  environment:
    name: review/$CI_COMMIT_REF_SLUG
    url: https://$CI_COMMIT_REF_SLUG.review.example.com
    on_stop: stop_review
  script:
    - echo "ä¸ºåŠŸèƒ½åˆ†æ”¯åˆ›å»ºé¢„è§ˆç¯å¢ƒ"
    - ./deploy-review.sh
  only:
    - branches
  except:
    - main
```

### 4.4 æ··åˆéƒ¨ç½²ç­–ç•¥


**ğŸ¯ æœ€ä½³å®è·µç»„åˆ**
```yaml
stages:
  - build
  - test
  - deploy_dev
  - deploy_test
  - deploy_staging
  - deploy_prod

# è‡ªåŠ¨éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
deploy_dev:
  stage: deploy_dev
  script: [./deploy-dev.sh]
  only: [develop]
  # è‡ªåŠ¨æ‰§è¡Œ

# è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
deploy_test:
  stage: deploy_test
  script: [./deploy-test.sh]
  only: [main]
  # è‡ªåŠ¨æ‰§è¡Œ

# æ‰‹åŠ¨éƒ¨ç½²åˆ°é¢„ç”Ÿäº§
deploy_staging:
  stage: deploy_staging
  script: [./deploy-staging.sh]
  when: manual
  only: [main]

# æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
deploy_prod:
  stage: deploy_prod
  script: [./deploy-prod.sh]
  when: manual
  needs: [deploy_staging]
  only: [main]
```

**ğŸ“‹ å†³ç­–æŒ‡å—**
| ç¯å¢ƒ | éƒ¨ç½²æ–¹å¼ | åŸå›  | è§¦å‘æ¡ä»¶ |
|------|----------|------|----------|
| å¼€å‘ç¯å¢ƒ | **è‡ªåŠ¨éƒ¨ç½²** | å¿«é€ŸéªŒè¯ï¼Œé£é™©ä½ | ä»£ç æäº¤åˆ°developåˆ†æ”¯ |
| æµ‹è¯•ç¯å¢ƒ | **è‡ªåŠ¨éƒ¨ç½²** | æé«˜æµ‹è¯•æ•ˆç‡ | ä»£ç åˆå¹¶åˆ°mainåˆ†æ”¯ |
| é¢„ç”Ÿäº§ç¯å¢ƒ | **æ‰‹åŠ¨ç¡®è®¤** | æœ€åéªŒè¯ï¼Œæ§åˆ¶å‘å¸ƒæ—¶æœº | æ‰‹åŠ¨è§¦å‘ |
| ç”Ÿäº§ç¯å¢ƒ | **æ‰‹åŠ¨ç¡®è®¤** | é£é™©æœ€é«˜ï¼Œéœ€è¦æ…é‡ | æ‰‹åŠ¨è§¦å‘ |

---

## 5. ğŸ“ éƒ¨ç½²å®¡æ‰¹æµç¨‹ç®¡ç†


### 5.1 å®¡æ‰¹æµç¨‹çš„é‡è¦æ€§


**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦å®¡æ‰¹æµç¨‹**
```
å°±åƒé“¶è¡Œè½¬è´¦éœ€è¦å¤šé‡ç¡®è®¤ï¼š
å°é¢è½¬è´¦ â†’ æ‰‹æœºéªŒè¯ç 
å¤§é¢è½¬è´¦ â†’ æ‰‹æœºéªŒè¯ç  + é“¶è¡Œå¡å¯†ç  + äººå·¥ç¡®è®¤

ä»£ç éƒ¨ç½²ä¹Ÿéœ€è¦ï¼š
å¼€å‘ç¯å¢ƒ â†’ å¼€å‘è€…ç¡®è®¤
ç”Ÿäº§ç¯å¢ƒ â†’ å¼€å‘è€… + æµ‹è¯• + è¿ç»´ + äº§å“ç»ç†ç¡®è®¤
```

**âœ… å®¡æ‰¹æµç¨‹çš„ä»·å€¼**
- **é£é™©æ§åˆ¶**ï¼šå¤šäººå®¡æŸ¥é™ä½éƒ¨ç½²é£é™©
- **è´£ä»»åˆ†æ‹…**ï¼šæ˜ç¡®å„è§’è‰²çš„è´£ä»»
- **è´¨é‡ä¿è¯**ï¼šç¡®ä¿ä»£ç è´¨é‡è¾¾æ ‡
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³ä¼ä¸šæ²»ç†è¦æ±‚

### 5.2 GitLabä¸­çš„å®¡æ‰¹é…ç½®


**ğŸ‘¥ åŸºç¡€å®¡æ‰¹è®¾ç½®**
```yaml
# GitLabé¡¹ç›®è®¾ç½®ä¸­çš„ä¿æŠ¤åˆ†æ”¯è§„åˆ™
# Settings â†’ Repository â†’ Protected Branches

# mainåˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼š
# - æ¨é€æƒé™ï¼šMaintainer
# - åˆå¹¶æƒé™ï¼šDeveloper + Maintainer
# - å¼ºåˆ¶ä»£ç å®¡æŸ¥ï¼šæ˜¯
# - å¿…éœ€å®¡æ‰¹äººæ•°ï¼šè‡³å°‘2äºº
```

**ğŸ”§ Pipelineå®¡æ‰¹é…ç½®**
```yaml
deploy_production:
  stage: deploy
  environment:
    name: production
    url: https://production.example.com
  script:
    - echo "ç­‰å¾…å®¡æ‰¹..."
    - echo "å®¡æ‰¹é€šè¿‡ï¼Œå¼€å§‹éƒ¨ç½²"
    - ./deploy-prod.sh
  when: manual
  allow_failure: false
  rules:
    - if: '$CI_COMMIT_TAG'
      when: manual
    - when: never
  # åœ¨GitLabç•Œé¢ä¸­ï¼Œéœ€è¦æœ‰æƒé™çš„ç”¨æˆ·æ‰‹åŠ¨è§¦å‘
```

### 5.3 å¤šçº§å®¡æ‰¹æµç¨‹è®¾è®¡


**ğŸ“Š å®¡æ‰¹å±‚çº§å›¾**
```
ä»£ç æäº¤
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¼€å‘è€…è‡ªæµ‹     â”‚ â† å¼€å‘è€…è‡ªå·±éªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä»£ç å®¡æŸ¥       â”‚ â† åŒäº‹æˆ–å›¢é˜Ÿleadå®¡æŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµ‹è¯•å›¢é˜ŸéªŒè¯   â”‚ â† QAå›¢é˜ŸåŠŸèƒ½éªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿ç»´å›¢é˜Ÿå®¡æ‰¹   â”‚ â† è¿ç»´è¯„ä¼°ç³»ç»Ÿå½±å“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   äº§å“ç»ç†ç¡®è®¤   â”‚ â† ä¸šåŠ¡å±‚é¢æœ€ç»ˆç¡®è®¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```

**âš™ï¸ å®é™…é…ç½®ç¤ºä¾‹**
```yaml
# æµ‹è¯•ç¯å¢ƒéƒ¨ç½² - éœ€è¦QAå®¡æ‰¹
deploy_testing:
  stage: deploy_test
  environment:
    name: testing
  script:
    - echo "éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"
    - ./deploy-test.sh
  when: manual
  rules:
    - if: '$CI_MERGE_REQUEST_IID'
      when: manual
  # åœ¨GitLabä¸­è®¾ç½®ï¼šåªæœ‰QAå›¢é˜Ÿæˆå‘˜å¯ä»¥è§¦å‘

# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² - éœ€è¦å¤šäººå®¡æ‰¹
deploy_production:
  stage: deploy_prod
  environment:
    name: production
    deployment_tier: production
  script:
    - echo "æ‰§è¡Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"
    - ./deploy-prod.sh
  when: manual
  needs: [deploy_testing]
  rules:
    - if: '$CI_COMMIT_TAG =~ /^v[0-9]+\.[0-9]+\.[0-9]+$/'
      when: manual
  # é€šè¿‡GitLabé¡¹ç›®è®¾ç½®é™åˆ¶ï¼šåªæœ‰Owner/Maintainerå¯ä»¥è§¦å‘
```

### 5.4 å®¡æ‰¹æµç¨‹æœ€ä½³å®è·µ


**ğŸ“‹ å®¡æ‰¹æ£€æŸ¥æ¸…å•**

**å¼€å‘ç¯å¢ƒéƒ¨ç½²å®¡æ‰¹ï¼š**
- [ ] ä»£ç ç¼–è¯‘æ— é”™è¯¯
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] ä»£ç ç¬¦åˆå›¢é˜Ÿè§„èŒƒ

**æµ‹è¯•ç¯å¢ƒéƒ¨ç½²å®¡æ‰¹ï¼š**
- [ ] åŠŸèƒ½æµ‹è¯•è®¡åˆ’å‡†å¤‡å°±ç»ª
- [ ] æµ‹è¯•æ•°æ®å‡†å¤‡å®Œæˆ
- [ ] ç›¸å…³ä¾èµ–æœåŠ¡æ­£å¸¸

**ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®¡æ‰¹ï¼š**
- [ ] æ‰€æœ‰æµ‹è¯•é˜¶æ®µéªŒè¯é€šè¿‡
- [ ] éƒ¨ç½²è®¡åˆ’è¯¦ç»†æ˜ç¡®
- [ ] å›æ»šæ–¹æ¡ˆå‡†å¤‡å°±ç»ª
- [ ] ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ
- [ ] ä¸šåŠ¡æ–¹ç¡®è®¤å‘å¸ƒæ—¶æœº
- [ ] è¿ç»´å›¢é˜Ÿèµ„æºå°±ç»ª

**ğŸ¯ å®¡æ‰¹ä¼˜åŒ–å»ºè®®**
```
è‡ªåŠ¨åŒ–é¢„æ£€æŸ¥ï¼š
- ä»£ç è´¨é‡é—¨ç¦
- å®‰å…¨æ¼æ´æ‰«æ
- æ€§èƒ½åŸºå‡†æµ‹è¯•
- ä¾èµ–é¡¹æ£€æŸ¥

å‡å°‘å®¡æ‰¹æ‘©æ“¦ï¼š
- æ ‡å‡†åŒ–å®¡æ‰¹æ¨¡æ¿
- æ˜ç¡®å®¡æ‰¹æ—¶æ•ˆè¦æ±‚
- æä¾›è¯¦ç»†çš„å˜æ›´è¯´æ˜
- å»ºç«‹ç´§æ€¥å‘å¸ƒé€šé“
```

**âš ï¸ é‡è¦æé†’**
> å®¡æ‰¹æµç¨‹è¦åœ¨å®‰å…¨æ€§å’Œæ•ˆç‡ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚è¿‡äºå¤æ‚çš„å®¡æ‰¹æµç¨‹ä¼šå½±å“å¼€å‘æ•ˆç‡ï¼Œè€Œè¿‡äºç®€å•åˆ™å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ã€‚

---

## 6. âš¡ å¹¶è¡Œéƒ¨ç½²é…ç½®


### 6.1 ä»€ä¹ˆæ˜¯å¹¶è¡Œéƒ¨ç½²


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒé¤å…å‡†å¤‡èœå“ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šç‚’èœ â†’ åšæ±¤ â†’ å‡†å¤‡ä¸»é£Ÿ â†’ æ‘†ç›˜ï¼ˆä¸²è¡Œï¼‰
å¹¶è¡Œæ–¹å¼ï¼šåŒæ—¶ç‚’èœã€åšæ±¤ã€å‡†å¤‡ä¸»é£Ÿï¼Œæœ€åä¸€èµ·æ‘†ç›˜

ä»£ç éƒ¨ç½²ä¹Ÿå¯ä»¥ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šç¯å¢ƒA â†’ ç¯å¢ƒB â†’ ç¯å¢ƒCï¼ˆä¸²è¡Œï¼‰
å¹¶è¡Œæ–¹å¼ï¼šåŒæ—¶éƒ¨ç½²ç¯å¢ƒAã€Bã€Cï¼ˆå¹¶è¡Œï¼‰
```

**ğŸ”¸ å¹¶è¡Œéƒ¨ç½²çš„æ ¸å¿ƒæ¦‚å¿µ**
å°†å¯ä»¥åŒæ—¶è¿›è¡Œçš„éƒ¨ç½²ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œå¤§å¹…å‡å°‘æ€»ä½“éƒ¨ç½²æ—¶é—´ã€‚

### 6.2 å¹¶è¡Œéƒ¨ç½²çš„åº”ç”¨åœºæ™¯


**ğŸ¯ é€‚åˆå¹¶è¡Œçš„åœºæ™¯**
- **å¤šä¸ªç‹¬ç«‹ç¯å¢ƒ**ï¼šå¼€å‘ç¯å¢ƒ1ã€å¼€å‘ç¯å¢ƒ2å¯ä»¥åŒæ—¶éƒ¨ç½²
- **ä¸åŒåœ°åŸŸéƒ¨ç½²**ï¼šç¾å›½ç«™ç‚¹ã€æ¬§æ´²ç«™ç‚¹ã€äºšæ´²ç«™ç‚¹
- **å¾®æœåŠ¡æ¶æ„**ï¼šç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ã€æ”¯ä»˜æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
- **å¤šå¹³å°å‘å¸ƒ**ï¼šWebç‰ˆæœ¬ã€ç§»åŠ¨ç«¯APIåŒæ—¶éƒ¨ç½²

**âŒ ä¸é€‚åˆå¹¶è¡Œçš„åœºæ™¯**
- **æœ‰ä¾èµ–å…³ç³»çš„ç¯å¢ƒ**ï¼šå¿…é¡»å…ˆéƒ¨ç½²æµ‹è¯•ç¯å¢ƒï¼Œå†éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
- **å…±äº«èµ„æºçš„æœåŠ¡**ï¼šä¾èµ–åŒä¸€ä¸ªæ•°æ®åº“çš„å¤šä¸ªæœåŠ¡
- **æœ‰é¡ºåºè¦æ±‚çš„æ›´æ–°**ï¼šæ•°æ®è¿ç§»å¿…é¡»åœ¨åº”ç”¨éƒ¨ç½²ä¹‹å‰å®Œæˆ

### 6.3 GitLab CI/CDå¹¶è¡Œé…ç½®


**âš¡ åŸºç¡€å¹¶è¡Œé…ç½®**
```yaml
stages:
  - build
  - test
  - deploy_parallel
  - deploy_production

# è¿™äº›ä»»åŠ¡å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
deploy_region_us:
  stage: deploy_parallel
  script:
    - echo "éƒ¨ç½²åˆ°ç¾å›½åŒºåŸŸ"
    - ./deploy-us.sh
  environment:
    name: production-us
    url: https://us.example.com

deploy_region_eu:
  stage: deploy_parallel
  script:
    - echo "éƒ¨ç½²åˆ°æ¬§æ´²åŒºåŸŸ"
    - ./deploy-eu.sh
  environment:
    name: production-eu
    url: https://eu.example.com

deploy_region_asia:
  stage: deploy_parallel
  script:
    - echo "éƒ¨ç½²åˆ°äºšæ´²åŒºåŸŸ"
    - ./deploy-asia.sh
  environment:
    name: production-asia
    url: https://asia.example.com

# ç­‰å¾…æ‰€æœ‰åŒºåŸŸéƒ¨ç½²å®Œæˆåï¼Œæ‰§è¡Œæœ€ç»ˆæ­¥éª¤
finalize_deployment:
  stage: deploy_production
  script:
    - echo "æ‰€æœ‰åŒºåŸŸéƒ¨ç½²å®Œæˆï¼Œæ‰§è¡Œæœ€ç»ˆé…ç½®"
    - ./finalize.sh
  needs:
    - deploy_region_us
    - deploy_region_eu
    - deploy_region_asia
```

**ğŸ”§ å¾®æœåŠ¡å¹¶è¡Œéƒ¨ç½²**
```yaml
# å¤šä¸ªå¾®æœåŠ¡å¯ä»¥å¹¶è¡Œéƒ¨ç½²
deploy_user_service:
  stage: deploy
  script:
    - echo "éƒ¨ç½²ç”¨æˆ·æœåŠ¡"
    - docker build -t user-service .
    - kubectl apply -f user-service.yaml
  only:
    changes:
      - user-service/**/*

deploy_order_service:
  stage: deploy
  script:
    - echo "éƒ¨ç½²è®¢å•æœåŠ¡"
    - docker build -t order-service .
    - kubectl apply -f order-service.yaml
  only:
    changes:
      - order-service/**/*

deploy_payment_service:
  stage: deploy
  script:
    - echo "éƒ¨ç½²æ”¯ä»˜æœåŠ¡"
    - docker build -t payment-service .
    - kubectl apply -f payment-service.yaml
  only:
    changes:
      - payment-service/**/*

# æ‰€æœ‰æœåŠ¡éƒ¨ç½²åçš„é›†æˆæµ‹è¯•
integration_test:
  stage: test_integration
  script:
    - echo "æ‰§è¡Œé›†æˆæµ‹è¯•"
    - ./run-integration-tests.sh
  needs:
    - deploy_user_service
    - deploy_order_service
    - deploy_payment_service
```

### 6.4 å¹¶è¡Œéƒ¨ç½²çš„ä¼˜åŒ–ç­–ç•¥


**ğŸ“Š æ€§èƒ½å¯¹æ¯”**
```
ä¸²è¡Œéƒ¨ç½²æ—¶é—´ï¼š
éƒ¨ç½²A(5åˆ†é’Ÿ) + éƒ¨ç½²B(3åˆ†é’Ÿ) + éƒ¨ç½²C(4åˆ†é’Ÿ) = 12åˆ†é’Ÿ

å¹¶è¡Œéƒ¨ç½²æ—¶é—´ï¼š
max(éƒ¨ç½²A(5åˆ†é’Ÿ), éƒ¨ç½²B(3åˆ†é’Ÿ), éƒ¨ç½²C(4åˆ†é’Ÿ)) = 5åˆ†é’Ÿ

æ—¶é—´èŠ‚çœï¼šçº¦58%ï¼
```

**âš™ï¸ é«˜çº§å¹¶è¡Œé…ç½®**
```yaml
# ä½¿ç”¨å¹¶è¡ŒçŸ©é˜µç­–ç•¥
deploy_matrix:
  stage: deploy
  parallel:
    matrix:
      - REGION: [us-east, us-west, eu-central, asia-pacific]
        ENVIRONMENT: [staging, production]
  script:
    - echo "éƒ¨ç½²åˆ° $REGION çš„ $ENVIRONMENT ç¯å¢ƒ"
    - ./deploy.sh --region=$REGION --env=$ENVIRONMENT
  environment:
    name: $ENVIRONMENT-$REGION
    url: https://$REGION.$ENVIRONMENT.example.com

# èµ„æºé™åˆ¶é…ç½®
deploy_with_limits:
  stage: deploy
  parallel: 3  # æœ€å¤šåŒæ—¶è¿è¡Œ3ä¸ªå¹¶è¡Œä»»åŠ¡
  script:
    - echo "å—é™å¹¶è¡Œéƒ¨ç½²"
    - ./deploy.sh
```

**ğŸ¯ å¹¶è¡Œéƒ¨ç½²æœ€ä½³å®è·µ**

**èµ„æºç®¡ç†ï¼š**
- æ§åˆ¶å¹¶è¡Œä»»åŠ¡æ•°é‡ï¼Œé¿å…èµ„æºè€—å°½
- ç›‘æ§Runnerè´Ÿè½½ï¼Œç¡®ä¿è¶³å¤Ÿèµ„æº
- ä¸ºå…³é”®ä»»åŠ¡é¢„ç•™èµ„æº

**é”™è¯¯å¤„ç†ï¼š**
```yaml
deploy_with_error_handling:
  stage: deploy
  parallel:
    matrix:
      - SERVICE: [user, order, payment, notification]
  script:
    - echo "éƒ¨ç½² $SERVICE æœåŠ¡"
    - ./deploy-service.sh $SERVICE
  retry:
    max: 2
    when: runner_system_failure
  allow_failure: 
    - SERVICE: notification  # å…è®¸é€šçŸ¥æœåŠ¡éƒ¨ç½²å¤±è´¥
```

**ä¾èµ–ç®¡ç†ï¼š**
```yaml
# æ•°æ®åº“è¿ç§»å¿…é¡»åœ¨æ‰€æœ‰æœåŠ¡éƒ¨ç½²å‰å®Œæˆ
database_migration:
  stage: pre_deploy
  script:
    - echo "æ‰§è¡Œæ•°æ®åº“è¿ç§»"
    - ./migrate-db.sh

# æœåŠ¡éƒ¨ç½²ä¾èµ–æ•°æ®åº“è¿ç§»
deploy_services:
  stage: deploy
  parallel:
    matrix:
      - SERVICE: [api, web, worker]
  script:
    - echo "éƒ¨ç½² $SERVICE"
    - ./deploy.sh $SERVICE
  needs: [database_migration]
```

---

## 7. ğŸ”µğŸŸ¢ è“ç»¿éƒ¨ç½²ç­–ç•¥


### 7.1 è“ç»¿éƒ¨ç½²åŸºæœ¬æ¦‚å¿µ


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒç”µè§†å°çš„ç°åœºç›´æ’­ï¼š
å½“å‰æ’­å‡ºï¼šè“è‰²æ¼”æ’­å®¤æ­£åœ¨ç›´æ’­
å‡†å¤‡åˆ‡æ¢ï¼šç»¿è‰²æ¼”æ’­å®¤å‡†å¤‡å¥½æ–°èŠ‚ç›®
ç¬é—´åˆ‡æ¢ï¼šå¯¼æ’­å°ä¸€æŒ‰é”®ï¼Œè§‚ä¼—çœ‹åˆ°çš„å°±æ˜¯ç»¿è‰²æ¼”æ’­å®¤
å¦‚æœ‰é—®é¢˜ï¼šç«‹å³åˆ‡å›è“è‰²æ¼”æ’­å®¤
```

**ğŸ”¸ è“ç»¿éƒ¨ç½²å®šä¹‰**
è“ç»¿éƒ¨ç½²æ˜¯ä¸€ç§å‡å°‘åœæœºæ—¶é—´å’Œé™ä½é£é™©çš„éƒ¨ç½²ç­–ç•¥ã€‚å®ƒé€šè¿‡ç»´æŠ¤ä¸¤ä¸ªç›¸åŒçš„ç”Ÿäº§ç¯å¢ƒï¼ˆè“ç¯å¢ƒå’Œç»¿ç¯å¢ƒï¼‰ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªç¯å¢ƒä¸­éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼Œæµ‹è¯•é€šè¿‡ååˆ‡æ¢æµé‡ã€‚

### 7.2 è“ç»¿éƒ¨ç½²çš„å·¥ä½œåŸç†


**ğŸ­ ç¯å¢ƒçŠ¶æ€å›¾**
```
åˆå§‹çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è“ç¯å¢ƒ     â”‚â—„â”€â”€â”€â”€â”‚   è´Ÿè½½å‡è¡¡   â”‚
â”‚ (å½“å‰ç‰ˆæœ¬)  â”‚ 100%â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»¿ç¯å¢ƒ     â”‚
â”‚ (ç©ºé—²)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è“ç¯å¢ƒ     â”‚â—„â”€â”€â”€â”€â”‚   è´Ÿè½½å‡è¡¡   â”‚
â”‚ (å½“å‰ç‰ˆæœ¬)  â”‚ 100%â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»¿ç¯å¢ƒ     â”‚
â”‚ (æ–°ç‰ˆæœ¬)    â”‚ â† éƒ¨ç½²å®Œæˆï¼Œæµ‹è¯•ä¸­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æµé‡åˆ‡æ¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è“ç¯å¢ƒ     â”‚     â”‚   è´Ÿè½½å‡è¡¡   â”‚
â”‚ (æ—§ç‰ˆæœ¬)    â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â–²
â”‚  ç»¿ç¯å¢ƒ     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (æ–°ç‰ˆæœ¬)    â”‚ 100%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 GitLab CI/CDä¸­çš„è“ç»¿éƒ¨ç½²


**ğŸ”§ åŸºç¡€è“ç»¿éƒ¨ç½²é…ç½®**
```yaml
variables:
  BLUE_ENV: "production-blue"
  GREEN_ENV: "production-green"

stages:
  - build
  - test
  - deploy_green
  - switch_traffic
  - cleanup

# æ„å»ºåº”ç”¨
build_app:
  stage: build
  script:
    - echo "æ„å»ºåº”ç”¨é•œåƒ"
    - docker build -t myapp:$CI_COMMIT_SHA .
    - docker push myapp:$CI_COMMIT_SHA

# éƒ¨ç½²åˆ°ç»¿ç¯å¢ƒ
deploy_to_green:
  stage: deploy_green
  environment:
    name: $GREEN_ENV
    url: https://green.production.example.com
  script:
    - echo "éƒ¨ç½²æ–°ç‰ˆæœ¬åˆ°ç»¿ç¯å¢ƒ"
    - kubectl set image deployment/myapp myapp=myapp:$CI_COMMIT_SHA -n green
    - kubectl rollout status deployment/myapp -n green
    - echo "ç»¿ç¯å¢ƒéƒ¨ç½²å®Œæˆï¼Œå¼€å§‹å¥åº·æ£€æŸ¥"
    - ./health-check.sh https://green.production.example.com
  when: manual

# åˆ‡æ¢æµé‡ï¼ˆè“ç»¿åˆ‡æ¢ï¼‰
switch_to_green:
  stage: switch_traffic
  script:
    - echo "å‡†å¤‡åˆ‡æ¢æµé‡åˆ°ç»¿ç¯å¢ƒ"
    - echo "æœ€åå¥åº·æ£€æŸ¥..."
    - ./health-check.sh https://green.production.example.com
    - echo "åˆ‡æ¢è´Ÿè½½å‡è¡¡å™¨æµé‡"
    - ./switch-traffic.sh green
    - echo "æµé‡å·²åˆ‡æ¢åˆ°ç»¿ç¯å¢ƒ"
  environment:
    name: production
    url: https://production.example.com
  when: manual
  needs: [deploy_to_green]

# æ¸…ç†æ—§çš„è“ç¯å¢ƒ
cleanup_blue:
  stage: cleanup
  script:
    - echo "ç»¿ç¯å¢ƒè¿è¡Œç¨³å®šï¼Œæ¸…ç†è“ç¯å¢ƒ"
    - kubectl delete deployment myapp -n blue
  when: manual
  needs: [switch_to_green]
```

### 7.4 è“ç»¿éƒ¨ç½²çš„å¥åº·æ£€æŸ¥


**ğŸ¥ å¥åº·æ£€æŸ¥è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# health-check.sh

ENDPOINT=$1
MAX_RETRIES=30
RETRY_INTERVAL=10

echo "å¼€å§‹å¥åº·æ£€æŸ¥: $ENDPOINT"

for i in $(seq 1 $MAX_RETRIES); do
    echo "ç¬¬ $i æ¬¡æ£€æŸ¥..."
    
    # æ£€æŸ¥HTTPçŠ¶æ€ç 
    STATUS=$(curl -s -o /dev/null -w "%{http_code}" $ENDPOINT/health)
    
    if [ "$STATUS" = "200" ]; then
        echo "âœ… å¥åº·æ£€æŸ¥é€šè¿‡"
        
        # é¢å¤–çš„åŠŸèƒ½æ£€æŸ¥
        RESPONSE=$(curl -s $ENDPOINT/api/status)
        if echo "$RESPONSE" | grep -q "healthy"; then
            echo "âœ… åº”ç”¨åŠŸèƒ½æ­£å¸¸"
            exit 0
        fi
    fi
    
    echo "âŒ æ£€æŸ¥å¤±è´¥ï¼Œç­‰å¾… $RETRY_INTERVAL ç§’åé‡è¯•"
    sleep $RETRY_INTERVAL
done

echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œéƒ¨ç½²ä¸­æ­¢"
exit 1
```

### 7.5 è“ç»¿éƒ¨ç½²çš„ä¼˜åŠ¿ä¸è€ƒè™‘


**âœ… ä¸»è¦ä¼˜åŠ¿**
- **é›¶åœæœºæ—¶é—´**ï¼šç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°éƒ¨ç½²è¿‡ç¨‹
- **å¿«é€Ÿå›æ»š**ï¼šå‘ç°é—®é¢˜å¯ç«‹å³åˆ‡å›æ—§ç‰ˆæœ¬
- **å……åˆ†æµ‹è¯•**ï¼šæ–°ç‰ˆæœ¬åœ¨çœŸå®ç¯å¢ƒä¸­å®Œæ•´æµ‹è¯•
- **é£é™©é™ä½**ï¼šé—®é¢˜å½±å“å¯ä»¥å¿«é€Ÿæ­¢æŸ

**âš ï¸ éœ€è¦è€ƒè™‘çš„é—®é¢˜**
- **èµ„æºæˆæœ¬**ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥—å®Œæ•´ç¯å¢ƒ
- **æ•°æ®ä¸€è‡´æ€§**ï¼šæ•°æ®åº“å˜æ›´éœ€è¦ç‰¹åˆ«å¤„ç†
- **çŠ¶æ€ç®¡ç†**ï¼šç”¨æˆ·ä¼šè¯å’Œç¼“å­˜çš„å¤„ç†
- **å¤æ‚æ€§**ï¼šæ¶æ„å’Œè¿ç»´å¤æ‚åº¦å¢åŠ 

**ğŸ¯ è“ç»¿éƒ¨ç½²æœ€ä½³å®è·µ**

**æ•°æ®åº“å¤„ç†ç­–ç•¥ï¼š**
```yaml
# æ•°æ®åº“è¿ç§»éœ€è¦å‘å‰å…¼å®¹
database_migration:
  stage: pre_deploy
  script:
    - echo "æ‰§è¡Œå‘å‰å…¼å®¹çš„æ•°æ®åº“è¿ç§»"
    - ./migrate-db.sh --compatible
  only:
    - main

# éƒ¨ç½²å®Œæˆåæ¸…ç†æ—§æ•°æ®ç»“æ„
cleanup_old_schema:
  stage: cleanup
  script:
    - echo "æ¸…ç†ä¸å†éœ€è¦çš„æ•°æ®åº“å­—æ®µ"
    - ./cleanup-schema.sh
  when: manual
  needs: [switch_to_green]
```

**ç›‘æ§å’Œå›æ»šï¼š**
```yaml
# éƒ¨ç½²åç›‘æ§
monitor_deployment:
  stage: monitor
  script:
    - echo "ç›‘æ§æ–°ç‰ˆæœ¬æ€§èƒ½æŒ‡æ ‡"
    - ./monitor.sh --duration=300  # ç›‘æ§5åˆ†é’Ÿ
  needs: [switch_to_green]

# è‡ªåŠ¨å›æ»šè§¦å‘å™¨
auto_rollback:
  stage: rollback
  script:
    - echo "æ£€æµ‹åˆ°å¼‚å¸¸ï¼Œæ‰§è¡Œè‡ªåŠ¨å›æ»š"
    - ./switch-traffic.sh blue
  when: on_failure
  needs: [monitor_deployment]
```

---

## 8. ğŸ“Š ç°åº¦å‘å¸ƒå®ç°


### 8.1 ç°åº¦å‘å¸ƒåŸºæœ¬æ¦‚å¿µ


**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
```
å°±åƒæ–°è¯çš„ä¸´åºŠè¯•éªŒï¼š
ç¬¬ä¸€é˜¶æ®µï¼šç»™10ä¸ªå¿—æ„¿è€…è¯•ç”¨ï¼ˆ1%ç”¨æˆ·ï¼‰
ç¬¬äºŒé˜¶æ®µï¼šç»™100ä¸ªæ‚£è€…ä½¿ç”¨ï¼ˆ10%ç”¨æˆ·ï¼‰
ç¬¬ä¸‰é˜¶æ®µï¼šç»™1000ä¸ªæ‚£è€…ä½¿ç”¨ï¼ˆ50%ç”¨æˆ·ï¼‰
æ­£å¼ä¸Šå¸‚ï¼šå…¨é¢æ¨å¹¿ï¼ˆ100%ç”¨æˆ·ï¼‰

è½¯ä»¶å‘å¸ƒä¹Ÿæ˜¯ï¼š
ç°åº¦1%ç”¨æˆ· â†’ è§‚å¯Ÿ â†’ ç°åº¦10%ç”¨æˆ· â†’ è§‚å¯Ÿ â†’ å…¨é‡å‘å¸ƒ
```

**ğŸ”¸ ç°åº¦å‘å¸ƒå®šä¹‰**
ç°åº¦å‘å¸ƒï¼ˆä¹Ÿå«é‡‘ä¸é›€å‘å¸ƒï¼‰æ˜¯ä¸€ç§æ¸è¿›å¼çš„éƒ¨ç½²ç­–ç•¥ï¼Œé€šè¿‡é€æ­¥å¢åŠ æ–°ç‰ˆæœ¬çš„ç”¨æˆ·æ¯”ä¾‹æ¥é™ä½é£é™©ï¼ŒåŒæ—¶æ”¶é›†çœŸå®ç”¨æˆ·åé¦ˆã€‚

### 8.2 ç°åº¦å‘å¸ƒçš„å®æ–½ç­–ç•¥


**ğŸ“ˆ ç°åº¦å‘å¸ƒæµç¨‹å›¾**
```
æ–°ç‰ˆæœ¬å‡†å¤‡å°±ç»ª
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1%æµé‡åˆ°æ–°ç‰ˆæœ¬  â”‚ â† è§‚å¯Ÿå…³é”®æŒ‡æ ‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (æŒ‡æ ‡æ­£å¸¸)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10%æµé‡åˆ°æ–°ç‰ˆæœ¬ â”‚ â† ç»§ç»­è§‚å¯Ÿ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (æŒ‡æ ‡æ­£å¸¸)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 50%æµé‡åˆ°æ–°ç‰ˆæœ¬ â”‚ â† å¤§è§„æ¨¡éªŒè¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (æŒ‡æ ‡æ­£å¸¸)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚100%æµé‡åˆ°æ–°ç‰ˆæœ¬ â”‚ â† å…¨é‡å‘å¸ƒå®Œæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä»»ä½•é˜¶æ®µå‡ºç°é—®é¢˜ â†’ ç«‹å³å›æ»šåˆ°æ—§ç‰ˆæœ¬
```

### 8.3 GitLab CI/CDä¸­çš„ç°åº¦å‘å¸ƒ


**ğŸ”§ åŸºç¡€ç°åº¦å‘å¸ƒé…ç½®**
```yaml
variables:
  CANARY_PERCENTAGE: "1"

stages:
  - build
  - test
  - deploy_canary
  - increase_canary
  - full_deployment

# éƒ¨ç½²é‡‘ä¸é›€ç‰ˆæœ¬ï¼ˆ1%æµé‡ï¼‰
deploy_canary_1:
  stage: deploy_canary
  environment:
    name: production-canary
    url: https://production.example.com
  script:
    - echo "éƒ¨ç½²é‡‘ä¸é›€ç‰ˆæœ¬ï¼Œ1%æµé‡"
    - kubectl set image deployment/myapp-canary myapp=myapp:$CI_COMMIT_SHA
    - ./update-ingress-weight.sh 1  # è®¾ç½®1%æµé‡åˆ°æ–°ç‰ˆæœ¬
  when: manual

# ç›‘æ§1%æµé‡æ•ˆæœ
monitor_canary_1:
  stage: deploy_canary
  script:
    - echo "ç›‘æ§é‡‘ä¸é›€ç‰ˆæœ¬æ€§èƒ½"
    - ./monitor-canary.sh --duration=600 --percentage=1
  needs: [deploy_canary_1]

# å¢åŠ åˆ°10%æµé‡
increase_to_10:
  stage: increase_canary
  script:
    - echo "å¢åŠ é‡‘ä¸é›€æµé‡åˆ°10%"
    - ./update-ingress-weight.sh 10
    - ./monitor-canary.sh --duration=600 --percentage=10
  when: manual
  needs: [monitor_canary_1]

# å¢åŠ åˆ°50%æµé‡
increase_to_50:
  stage: increase_canary
  script:
    - echo "å¢åŠ é‡‘ä¸é›€æµé‡åˆ°50%"
    - ./update-ingress-weight.sh 50
    - ./monitor-canary.sh --duration=600 --percentage=50
  when: manual
  needs: [increase_to_10]

# å…¨é‡å‘å¸ƒ
full_deployment:
  stage: full_deployment
  script:
    - echo "é‡‘ä¸é›€éªŒè¯é€šè¿‡ï¼Œæ‰§è¡Œå…¨é‡å‘å¸ƒ"
    - ./update-ingress-weight.sh 100
    - kubectl set image deployment/myapp myapp=myapp:$CI_COMMIT_SHA
    - kubectl delete deployment myapp-canary  # æ¸…ç†é‡‘ä¸é›€éƒ¨ç½²
  when: manual
  needs: [increase_to_50]
```

### 8.4 åŸºäºç”¨æˆ·ç‰¹å¾çš„ç°åº¦ç­–ç•¥


**ğŸ‘¥ ç”¨æˆ·åˆ†ç»„ç°åº¦**
```yaml
# åŸºäºç”¨æˆ·ç±»å‹çš„ç°åº¦å‘å¸ƒ
deploy_canary_vip:
  stage: deploy_canary
  script:
    - echo "ä¸ºVIPç”¨æˆ·éƒ¨ç½²æ–°ç‰ˆæœ¬"
    - ./deploy-canary.sh --user-type=vip
  environment:
    name: production-canary-vip

deploy_canary_region:
  stage: deploy_canary
  script:
    - echo "ä¸ºç‰¹å®šåœ°åŒºç”¨æˆ·éƒ¨ç½²æ–°ç‰ˆæœ¬"
    - ./deploy-canary.sh --region=us-west
  environment:
    name: production-canary-region

# åŸºäºè®¾å¤‡ç±»å‹çš„ç°åº¦
deploy_canary_mobile:
  stage: deploy_canary
  script:
    - echo "ä¸ºç§»åŠ¨ç«¯ç”¨æˆ·éƒ¨ç½²æ–°ç‰ˆæœ¬"
    - ./deploy-canary.sh --device=mobile
  environment:
    name: production-canary-mobile
```

**ğŸ¯ æµé‡åˆ†å‰²è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# update-ingress-weight.sh

CANARY_WEIGHT=$1
STABLE_WEIGHT=$((100 - CANARY_WEIGHT))

echo "è®¾ç½®æµé‡åˆ†é…: ç¨³å®šç‰ˆæœ¬ ${STABLE_WEIGHT}%, é‡‘ä¸é›€ç‰ˆæœ¬ ${CANARY_WEIGHT}%"

# æ›´æ–°Kubernetes Ingressæƒé‡
kubectl patch ingress myapp-ingress -p "{
  \"metadata\": {
    \"annotations\": {
      \"nginx.ingress.kubernetes.io/canary\": \"true\",
      \"nginx.ingress.kubernetes.io/canary-weight\": \"${CANARY_WEIGHT}\"
    }
  }
}"

echo "âœ… æµé‡åˆ†é…æ›´æ–°å®Œæˆ"

# éªŒè¯é…ç½®
kubectl get ingress myapp-ingress -o yaml | grep canary-weight
```

### 8.5 ç°åº¦å‘å¸ƒç›‘æ§ä¸å†³ç­–


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```yaml
# ç›‘æ§è„šæœ¬é…ç½®
monitor_canary:
  stage: monitor
  script:
    - echo "ç›‘æ§å…³é”®æŒ‡æ ‡"
    - |
      # é”™è¯¯ç‡æ£€æŸ¥
      ERROR_RATE=$(./get-metric.sh error_rate)
      if (( $(echo "$ERROR_RATE > 0.1" | bc -l) )); then
        echo "âŒ é”™è¯¯ç‡è¿‡é«˜: $ERROR_RATE%ï¼Œæ‰§è¡Œå›æ»š"
        ./rollback-canary.sh
        exit 1
      fi
      
      # å“åº”æ—¶é—´æ£€æŸ¥
      RESPONSE_TIME=$(./get-metric.sh avg_response_time)
      if (( $(echo "$RESPONSE_TIME > 500" | bc -l) )); then
        echo "âŒ å“åº”æ—¶é—´è¿‡é•¿: ${RESPONSE_TIME}msï¼Œæ‰§è¡Œå›æ»š"
        ./rollback-canary.sh
        exit 1
      fi
      
      # ç”¨æˆ·æŠ•è¯‰æ£€æŸ¥
      COMPLAINTS=$(./get-metric.sh user_complaints)
      if [ "$COMPLAINTS" -gt 5 ]; then
        echo "âŒ ç”¨æˆ·æŠ•è¯‰å¢åŠ : $COMPLAINTS æ¡ï¼Œéœ€è¦äººå·¥å†³ç­–"
        exit 1
      fi
      
      echo "âœ… æ‰€æœ‰æŒ‡æ ‡æ­£å¸¸"
```

**ğŸš¨ è‡ªåŠ¨å›æ»šæœºåˆ¶**
```yaml
# è‡ªåŠ¨å›æ»šä»»åŠ¡
auto_rollback:
  stage: rollback
  script:
    - echo "æ£€æµ‹åˆ°å¼‚å¸¸æŒ‡æ ‡ï¼Œæ‰§è¡Œè‡ªåŠ¨å›æ»š"
    - ./update-ingress-weight.sh 0  # å°†é‡‘ä¸é›€æµé‡è®¾ä¸º0
    - kubectl delete deployment myapp-canary
    - echo "å·²å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬"
  when: on_failure
  needs: [monitor_canary]

# æ‰‹åŠ¨å›æ»šä»»åŠ¡
manual_rollback:
  stage: rollback
  script:
    - echo "æ‰§è¡Œæ‰‹åŠ¨å›æ»š"
    - ./update-ingress-weight.sh 0
    - kubectl delete deployment myapp-canary
  when: manual
```

### 8.6 ç°åº¦å‘å¸ƒæœ€ä½³å®è·µ


**ğŸ“‹ ç°åº¦å‘å¸ƒå†³ç­–è¡¨**
| é˜¶æ®µ | æµé‡æ¯”ä¾‹ | ç›‘æ§æ—¶é•¿ | å…³é”®æŒ‡æ ‡ | å†³ç­–æ ‡å‡† |
|------|----------|----------|----------|----------|
| **åˆå§‹ç°åº¦** | 1-5% | 30-60åˆ†é’Ÿ | é”™è¯¯ç‡ã€å´©æºƒç‡ | é”™è¯¯ç‡<0.1% |
| **å°è§„æ¨¡éªŒè¯** | 10-20% | 2-4å°æ—¶ | å“åº”æ—¶é—´ã€ä¸šåŠ¡æŒ‡æ ‡ | æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™ |
| **å¤§è§„æ¨¡éªŒè¯** | 50% | 12-24å°æ—¶ | ç”¨æˆ·åé¦ˆã€ä¸šåŠ¡è½¬åŒ– | ç”¨æˆ·æ»¡æ„åº¦ç¨³å®š |
| **å…¨é‡å‘å¸ƒ** | 100% | æŒç»­ç›‘æ§ | å…¨é¢ä¸šåŠ¡æŒ‡æ ‡ | æ‰€æœ‰æŒ‡æ ‡æ­£å¸¸ |

**ğŸ¯ ç°åº¦ç­–ç•¥é€‰æ‹©**
```
åŠŸèƒ½å‹å‘å¸ƒï¼š
â€¢ 1% â†’ 10% â†’ 50% â†’ 100%
â€¢ é‡ç‚¹å…³æ³¨åŠŸèƒ½æ­£ç¡®æ€§

æ€§èƒ½ä¼˜åŒ–å‘å¸ƒï¼š
â€¢ 5% â†’ 25% â†’ 75% â†’ 100%
â€¢ é‡ç‚¹å…³æ³¨æ€§èƒ½æŒ‡æ ‡

æ ¸å¿ƒä¸šåŠ¡å‘å¸ƒï¼š
â€¢ 0.1% â†’ 1% â†’ 5% â†’ 20% â†’ 100%
â€¢ æå…¶è°¨æ…ï¼Œå¤šçº§éªŒè¯

ç´§æ€¥ä¿®å¤å‘å¸ƒï¼š
â€¢ 10% â†’ 100%ï¼ˆå¿«é€ŸéªŒè¯åå…¨é‡ï¼‰
â€¢ å¹³è¡¡é€Ÿåº¦ä¸å®‰å…¨
```

**ğŸ’¡ å®æ–½å»ºè®®**
- **ç”¨æˆ·æ„ŸçŸ¥æœ€å°åŒ–**ï¼šç¡®ä¿ç”¨æˆ·ä½“éªŒä¸€è‡´æ€§
- **æ•°æ®é©±åŠ¨å†³ç­–**ï¼šåŸºäºçœŸå®æ•°æ®è€Œéä¸»è§‚åˆ¤æ–­
- **å¿«é€Ÿå›æ»šèƒ½åŠ›**ï¼šä»»ä½•é˜¶æ®µéƒ½èƒ½å¿«é€Ÿå›æ»š
- **å……åˆ†ç›‘æ§**ï¼šè¦†ç›–æŠ€æœ¯æŒ‡æ ‡å’Œä¸šåŠ¡æŒ‡æ ‡
- **å›¢é˜Ÿåä½œ**ï¼šå¼€å‘ã€è¿ç»´ã€äº§å“å›¢é˜Ÿç´§å¯†é…åˆ

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤šé˜¶æ®µéƒ¨ç½²ï¼šé€šè¿‡å¤šä¸ªç¯å¢ƒé€æ­¥éªŒè¯ï¼Œé™ä½ç”Ÿäº§é£é™©
ğŸ”¸ ç¯å¢ƒç®¡ç†ï¼šå¼€å‘â†’æµ‹è¯•â†’é¢„ç”Ÿäº§â†’ç”Ÿäº§çš„æ ‡å‡†æµç¨‹
ğŸ”¸ ä¾èµ–å…³ç³»ï¼šç¡®ä¿ä»£ç è´¨é‡çš„é˜¶æ®µé—¨ç¦æœºåˆ¶
ğŸ”¸ æ‰‹åŠ¨ç¡®è®¤ï¼šå…³é”®èŠ‚ç‚¹çš„äººå·¥å†³ç­–å’Œé£é™©æ§åˆ¶
ğŸ”¸ å®¡æ‰¹æµç¨‹ï¼šå¤šè§’è‰²åä½œçš„è´¨é‡ä¿è¯æœºåˆ¶
ğŸ”¸ å¹¶è¡Œéƒ¨ç½²ï¼šæé«˜éƒ¨ç½²æ•ˆç‡çš„å¹¶è¡Œç­–ç•¥
ğŸ”¸ è“ç»¿éƒ¨ç½²ï¼šé›¶åœæœºçš„å¹³æ»‘åˆ‡æ¢æ–¹æ¡ˆ
ğŸ”¸ ç°åº¦å‘å¸ƒï¼šæ¸è¿›å¼çš„é£é™©æ§åˆ¶ç­–ç•¥
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦å¤šé˜¶æ®µéƒ¨ç½²**
```
é£é™©æ§åˆ¶ï¼š
â€¢ æ—©æœŸå‘ç°é—®é¢˜ï¼Œé¿å…ç”Ÿäº§äº‹æ•…
â€¢ å¤šé‡éªŒè¯ï¼Œç¡®ä¿ä»£ç è´¨é‡
â€¢ æ¸è¿›å¼å‘å¸ƒï¼Œé™ä½å½±å“èŒƒå›´

æ•ˆç‡æå‡ï¼š
â€¢ æ ‡å‡†åŒ–æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯
â€¢ è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæé«˜å‘å¸ƒé€Ÿåº¦
â€¢ å¹¶è¡Œç­–ç•¥ï¼Œç¼©çŸ­æ€»ä½“æ—¶é—´
```

**ğŸ”¹ ä¸åŒéƒ¨ç½²ç­–ç•¥çš„åº”ç”¨åœºæ™¯**
```
è“ç»¿éƒ¨ç½² â†’ é€‚åˆï¼šè¿½æ±‚é›¶åœæœºï¼Œæœ‰è¶³å¤Ÿèµ„æº
ç°åº¦å‘å¸ƒ â†’ é€‚åˆï¼šå¤§ç”¨æˆ·é‡ï¼Œéœ€è¦æ¸è¿›éªŒè¯
æ»šåŠ¨æ›´æ–° â†’ é€‚åˆï¼šèµ„æºæœ‰é™ï¼Œå¯æ¥å—çŸ­æš‚å½±å“
ä¸€æ¬¡æ€§éƒ¨ç½² â†’ é€‚åˆï¼šå†…éƒ¨ç³»ç»Ÿï¼Œå¯æ§åœæœºæ—¶é—´
```

**ğŸ”¹ éƒ¨ç½²ç­–ç•¥çš„é€‰æ‹©ä¾æ®**
```
ä¸šåŠ¡å½±å“ï¼š
â€¢ ç”¨æˆ·æ•°é‡å’Œé‡è¦æ€§
â€¢ åœæœºæ—¶é—´å®¹å¿åº¦
â€¢ æ•…éšœæ¢å¤è¦æ±‚

æŠ€æœ¯çº¦æŸï¼š
â€¢ èµ„æºé™åˆ¶ï¼ˆæœåŠ¡å™¨ã€ç½‘ç»œï¼‰
â€¢ æ¶æ„å¤æ‚åº¦
â€¢ å›¢é˜ŸæŠ€æœ¯èƒ½åŠ›

é£é™©æ‰¿å—ï¼š
â€¢ ç»„ç»‡é£é™©åå¥½
â€¢ åˆè§„è¦æ±‚
â€¢ ä¸šåŠ¡è¿ç»­æ€§éœ€è¦
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š éƒ¨ç½²ç­–ç•¥å†³ç­–çŸ©é˜µ**
| åœºæ™¯ | æ¨èç­–ç•¥ | å…³é”®è€ƒè™‘ | å®æ–½é‡ç‚¹ |
|------|----------|----------|----------|
| **å¤§å‹ç”µå•†å¹³å°** | ç°åº¦å‘å¸ƒ | ç”¨æˆ·ä½“éªŒã€ä¸šåŠ¡è¿ç»­æ€§ | ç²¾ç»†ç›‘æ§ã€å¿«é€Ÿå›æ»š |
| **ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ** | è“ç»¿éƒ¨ç½² | é›¶åœæœºã€èµ„æºå……è¶³ | ç¯å¢ƒä¸€è‡´æ€§ã€åˆ‡æ¢æµ‹è¯• |
| **åˆ›ä¸šå…¬å¸äº§å“** | æ»šåŠ¨æ›´æ–° | èµ„æºæœ‰é™ã€å¿«é€Ÿè¿­ä»£ | è‡ªåŠ¨åŒ–ç¨‹åº¦ã€ç›‘æ§å®Œå–„ |
| **å…³é”®åŸºç¡€è®¾æ–½** | å¤šé˜¶æ®µ+å®¡æ‰¹ | å®‰å…¨ç¬¬ä¸€ã€åˆè§„è¦æ±‚ | ä¸¥æ ¼æµç¨‹ã€å……åˆ†æµ‹è¯• |

**ğŸ¯ å®æ–½è·¯å¾„å»ºè®®**

**åˆçº§é˜¶æ®µï¼ˆå»ºç«‹åŸºç¡€ï¼‰ï¼š**
- æ­å»ºæ ‡å‡†çš„å¤šç¯å¢ƒæ¶æ„
- å®ç°åŸºæœ¬çš„CI/CDæµæ°´çº¿
- å»ºç«‹ä»£ç å®¡æŸ¥å’Œæµ‹è¯•æœºåˆ¶

**ä¸­çº§é˜¶æ®µï¼ˆä¼˜åŒ–æ•ˆç‡ï¼‰ï¼š**
- å¼•å…¥å¹¶è¡Œéƒ¨ç½²æé«˜é€Ÿåº¦
- å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²
- å»ºç«‹ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

**é«˜çº§é˜¶æ®µï¼ˆé£é™©æ§åˆ¶ï¼‰ï¼š**
- å®æ–½è“ç»¿æˆ–ç°åº¦éƒ¨ç½²
- å»ºç«‹å®Œå–„çš„å®¡æ‰¹æµç¨‹
- å®ç°æ™ºèƒ½å›æ»šå’Œæ•…éšœæ¢å¤

### 9.4 å·¥ç¨‹å®è·µè¦ç‚¹


**ğŸ”§ é…ç½®ç®¡ç†æœ€ä½³å®è·µ**
```
ç¯å¢ƒé…ç½®åˆ†ç¦»ï¼š
â€¢ ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†ä¸åŒç¯å¢ƒ
â€¢ æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
â€¢ ç‰ˆæœ¬æ§åˆ¶æ‰€æœ‰é…ç½®æ–‡ä»¶

éƒ¨ç½²è„šæœ¬æ ‡å‡†åŒ–ï¼š
â€¢ æ¯ä¸ªç¯å¢ƒä½¿ç”¨ç›¸åŒçš„éƒ¨ç½²é€»è¾‘
â€¢ å‚æ•°åŒ–å¤„ç†ç¯å¢ƒå·®å¼‚
â€¢ å……åˆ†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
```

**ğŸ“Š ç›‘æ§ä½“ç³»å»ºè®¾**
```
æŠ€æœ¯æŒ‡æ ‡ï¼š
â€¢ åº”ç”¨æ€§èƒ½ï¼šå“åº”æ—¶é—´ã€ååé‡ã€é”™è¯¯ç‡
â€¢ ç³»ç»Ÿèµ„æºï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â€¢ åŸºç¡€è®¾æ–½ï¼šæœåŠ¡å¥åº·åº¦ã€ä¾èµ–å¯ç”¨æ€§

ä¸šåŠ¡æŒ‡æ ‡ï¼š
â€¢ ç”¨æˆ·è¡Œä¸ºï¼šæ´»è·ƒåº¦ã€è½¬åŒ–ç‡ã€ç•™å­˜ç‡
â€¢ ä¸šåŠ¡æµç¨‹ï¼šè®¢å•é‡ã€æ”¯ä»˜æˆåŠŸç‡
â€¢ ç”¨æˆ·åé¦ˆï¼šæŠ•è¯‰ç‡ã€æ»¡æ„åº¦è¯„åˆ†
```

**ğŸš¨ åº”æ€¥å“åº”æœºåˆ¶**
```
æ•…éšœæ£€æµ‹ï¼š
â€¢ è‡ªåŠ¨åŒ–ç›‘æ§å‘Šè­¦
â€¢ å¼‚å¸¸é˜ˆå€¼è®¾å®š
â€¢ å¤šæ¸ é“é€šçŸ¥æœºåˆ¶

å¿«é€Ÿå“åº”ï¼š
â€¢ æ˜ç¡®çš„è´£ä»»åˆ†å·¥
â€¢ æ ‡å‡†åŒ–çš„åº”æ€¥æµç¨‹
â€¢ å¿«é€Ÿå›æ»šèƒ½åŠ›

äº‹åæ”¹è¿›ï¼š
â€¢ æ•…éšœå¤ç›˜åˆ†æ
â€¢ æµç¨‹ä¼˜åŒ–æ”¹è¿›
â€¢ çŸ¥è¯†ç§¯ç´¯åˆ†äº«
```

### 9.5 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**

**åŸºç¡€å·©å›ºï¼š**
- ç†Ÿç»ƒæŒæ¡GitLab CI/CDåŸºæœ¬è¯­æ³•
- ç†è§£Dockerå®¹å™¨åŒ–éƒ¨ç½²
- æŒæ¡KubernetesåŸºç¡€æ¦‚å¿µ

**å®è·µæå‡ï¼š**
- æ­å»ºå®Œæ•´çš„å¤šç¯å¢ƒéƒ¨ç½²æµæ°´çº¿
- å®ç°è‡³å°‘ä¸€ç§é«˜çº§éƒ¨ç½²ç­–ç•¥
- å»ºç«‹ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

**é«˜çº§åº”ç”¨ï¼š**
- ç ”ç©¶æœåŠ¡ç½‘æ ¼å’Œå¾®æœåŠ¡éƒ¨ç½²
- å­¦ä¹ åŸºç¡€è®¾æ–½å³ä»£ç (IaC)
- æ¢ç´¢AIè¾…åŠ©çš„æ™ºèƒ½éƒ¨ç½²

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¤šé˜¶æ®µéƒ¨ç½²æ˜¯ç°ä»£è½¯ä»¶å‘å¸ƒçš„æ ‡å‡†å®è·µ
- é€‰æ‹©åˆé€‚çš„éƒ¨ç½²ç­–ç•¥éœ€è¦å¹³è¡¡é£é™©ã€æ•ˆç‡å’Œèµ„æº
- å®Œå–„çš„ç›‘æ§å’Œå›æ»šæœºåˆ¶æ˜¯æˆåŠŸéƒ¨ç½²çš„å…³é”®ä¿éšœ
- å›¢é˜Ÿåä½œå’Œæµç¨‹è§„èŒƒåŒ–æ˜¯å®æ–½éƒ¨ç½²ç­–ç•¥çš„åŸºç¡€