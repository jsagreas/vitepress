---
title: 19ã€Includeå¤–éƒ¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [Includeå¤–éƒ¨é…ç½®æ¦‚è¿°](#1-Includeå¤–éƒ¨é…ç½®æ¦‚è¿°)
2. [Includeè¯­æ³•è¯¦è§£](#2-Includeè¯­æ³•è¯¦è§£)
3. [å¤–éƒ¨æ–‡ä»¶å¼•ç”¨æ–¹å¼](#3-å¤–éƒ¨æ–‡ä»¶å¼•ç”¨æ–¹å¼)
4. [æ¨¡æ¿é…ç½®å¤ç”¨å®è·µ](#4-æ¨¡æ¿é…ç½®å¤ç”¨å®è·µ)
5. [é¡¹ç›®é—´é…ç½®å…±äº«](#5-é¡¹ç›®é—´é…ç½®å…±äº«)
6. [æ¡ä»¶Includeè®¾ç½®](#6-æ¡ä»¶Includeè®¾ç½®)
7. [é…ç½®æ–‡ä»¶ç»„ç»‡ç­–ç•¥](#7-é…ç½®æ–‡ä»¶ç»„ç»‡ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— Includeå¤–éƒ¨é…ç½®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Includeå¤–éƒ¨é…ç½®


**ç®€å•ç†è§£**ï¼šå°±åƒå†™ä»£ç æ—¶å¯ä»¥å¯¼å…¥å…¶ä»–æ–‡ä»¶çš„å‡½æ•°ä¸€æ ·ï¼ŒGitLab CI/CDä¹Ÿå¯ä»¥å¯¼å…¥å…¶ä»–æ–‡ä»¶çš„é…ç½®ã€‚

```
ç±»æ¯”ç†è§£ï¼š
Pythonä»£ç ï¼šimport utils  â†â†’  GitLab CI/CDï¼šinclude: 'common.yml'
æŠŠå¸¸ç”¨åŠŸèƒ½               æŠŠå¸¸ç”¨çš„CI/CDé…ç½®
å†™åœ¨å•ç‹¬æ–‡ä»¶é‡Œ            å†™åœ¨å•ç‹¬æ–‡ä»¶é‡Œå¤ç”¨
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”„ **é…ç½®å¤ç”¨**ï¼šä¸€æ¬¡ç¼–å†™ï¼Œå¤šå¤„ä½¿ç”¨
- ğŸ“ **æ–‡ä»¶æ•´ç†**ï¼šæŠŠå¤æ‚é…ç½®æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶
- ğŸ¤ **å›¢é˜Ÿåä½œ**ï¼šå›¢é˜Ÿå…±äº«é€šç”¨é…ç½®æ¨¡æ¿
- ğŸ”§ **ç»´æŠ¤ç®€åŒ–**ï¼šä¿®æ”¹ä¸€å¤„ï¼Œå…¨é¡¹ç›®ç”Ÿæ•ˆ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦IncludeåŠŸèƒ½


**ä¼ ç»Ÿç—›ç‚¹**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
ğŸ”¸ å¤šä¸ªé¡¹ç›®éƒ½éœ€è¦ç›¸åŒçš„æ„å»ºæ­¥éª¤
ğŸ”¸ .gitlab-ci.ymlæ–‡ä»¶å˜å¾—å¾ˆé•¿å¾ˆå¤æ‚
ğŸ”¸ ä¿®æ”¹é€šç”¨é…ç½®éœ€è¦åœ¨æ¯ä¸ªé¡¹ç›®é‡Œéƒ½æ”¹ä¸€é
ğŸ”¸ æ–°é¡¹ç›®æ­å»ºCI/CDéœ€è¦ä»é›¶å¼€å§‹å†™é…ç½®

ç°å®å¯¹æ¯”ï¼š
æ²¡æœ‰Include = æ¯ä¸ªå¨å¸ˆéƒ½è¦è‡ªå·±å‡†å¤‡æ‰€æœ‰è°ƒæ–™
æœ‰äº†Include = å¨å¸ˆä»¬å…±äº«ä¸€ä¸ªè°ƒæ–™åº“
```

**Includeè§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… **ç»Ÿä¸€ç®¡ç†**ï¼šé€šç”¨é…ç½®æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹
- âœ… **å¿«é€Ÿå¤åˆ¶**ï¼šæ–°é¡¹ç›®ç›´æ¥å¼•ç”¨ç°æˆæ¨¡æ¿
- âœ… **æ‰¹é‡æ›´æ–°**ï¼šä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰€æœ‰å¼•ç”¨é¡¹ç›®è‡ªåŠ¨æ›´æ–°
- âœ… **åˆ†å·¥åä½œ**ï¼šè¿ç»´å›¢é˜Ÿç»´æŠ¤æ¨¡æ¿ï¼Œå¼€å‘å›¢é˜Ÿä¸“æ³¨ä¸šåŠ¡

### 1.3 Includeçš„åŸºæœ¬å·¥ä½œåŸç†


```
å·¥ä½œæµç¨‹å›¾ç¤ºï¼š

é¡¹ç›®A/.gitlab-ci.yml     â†’  å¼•ç”¨  â†’  templates/common.yml
é¡¹ç›®B/.gitlab-ci.yml     â†’  å¼•ç”¨  â†’  templates/docker.yml  
é¡¹ç›®C/.gitlab-ci.yml     â†’  å¼•ç”¨  â†’  templates/deploy.yml

               â†“ GitLabå¤„ç†è¿‡ç¨‹ â†“

æœ€ç»ˆç”Ÿæˆå®Œæ•´çš„CI/CDé…ç½® = é¡¹ç›®é…ç½® + å¼•ç”¨çš„å¤–éƒ¨é…ç½®
```

**å¤„ç†æœºåˆ¶**ï¼š
1. **è§£æé˜¶æ®µ**ï¼šGitLabè¯»å–é¡¹ç›®çš„ `.gitlab-ci.yml`
2. **Includeå¤„ç†**ï¼šå‘ç°includeè¯­å¥ï¼Œå»è·å–å¤–éƒ¨æ–‡ä»¶å†…å®¹
3. **åˆå¹¶é…ç½®**ï¼šæŠŠå¤–éƒ¨æ–‡ä»¶å†…å®¹åˆå¹¶åˆ°å½“å‰é…ç½®ä¸­
4. **æ‰§è¡Œæµæ°´çº¿**ï¼šåŸºäºåˆå¹¶åçš„å®Œæ•´é…ç½®è¿è¡Œ

---

## 2. ğŸ“ Includeè¯­æ³•è¯¦è§£


### 2.1 åŸºç¡€è¯­æ³•æ ¼å¼


**æœ€ç®€å•çš„ç”¨æ³•**ï¼š
```yaml
# .gitlab-ci.yml
include: 'ci-templates/common.yml'

stages:
  - build
  - test
```

**å®Œæ•´è¯­æ³•å½¢å¼**ï¼š
```yaml
include:
  - local: 'ci/common.yml'          # æœ¬é¡¹ç›®æ–‡ä»¶
  - project: 'group/templates'      # å…¶ä»–GitLabé¡¹ç›®
    file: 'common.yml'
  - remote: 'https://example.com/ci.yml'  # è¿œç¨‹URL
  - template: 'Security/SAST.gitlab-ci.yml'  # GitLabå®˜æ–¹æ¨¡æ¿
```

### 2.2 Includeä½ç½®å’Œä¼˜å…ˆçº§


**ğŸ“ Includeçš„ä½ç½®è§„åˆ™**ï¼š
```yaml
# âœ… æ­£ç¡®ï¼šincludeæ”¾åœ¨æ–‡ä»¶å¼€å¤´
include: 'common.yml'

stages:
  - build
  - test

build_job:
  stage: build
  script: echo "building"

# âŒ é”™è¯¯ï¼šincludeä¸èƒ½æ”¾åœ¨ä¸­é—´æˆ–æœ«å°¾
```

**âš–ï¸ é…ç½®ä¼˜å…ˆçº§é¡ºåº**ï¼š
```
ä¼˜å…ˆçº§ï¼šæœ¬åœ°é…ç½® > Includeé…ç½®

ç¤ºä¾‹è¯´æ˜ï¼š
# common.yml ä¸­å®šä¹‰
variables:
  NODE_VERSION: "14"

# .gitlab-ci.yml ä¸­å®šä¹‰  
include: 'common.yml'
variables:
  NODE_VERSION: "16"    # â† è¿™ä¸ªä¼šè¦†ç›–common.ymlä¸­çš„é…ç½®

æœ€ç»ˆç»“æœï¼šNODE_VERSION = "16"
```

### 2.3 å¤šä¸ªIncludeçš„å¤„ç†é¡ºåº


**ğŸ”¢ å¤„ç†é¡ºåºè§„åˆ™**ï¼š
```yaml
include:
  - 'template-1.yml'  # â† ç¬¬1ä¸ªå¤„ç†
  - 'template-2.yml'  # â† ç¬¬2ä¸ªå¤„ç†
  - 'template-3.yml'  # â† ç¬¬3ä¸ªå¤„ç†

# å¦‚æœæœ‰ç›¸åŒé…ç½®é¡¹ï¼Œåé¢çš„ä¼šè¦†ç›–å‰é¢çš„
```

**å®é™…ç¤ºä¾‹**ï¼š
```yaml
# template-1.yml
variables:
  BUILD_IMAGE: "node:14"

# template-2.yml  
variables:
  BUILD_IMAGE: "node:16"

# .gitlab-ci.yml
include:
  - 'template-1.yml'
  - 'template-2.yml'

# æœ€ç»ˆç»“æœï¼šBUILD_IMAGE = "node:16"ï¼ˆåé¢çš„è¦†ç›–å‰é¢çš„ï¼‰
```

---

## 3. ğŸ“‚ å¤–éƒ¨æ–‡ä»¶å¼•ç”¨æ–¹å¼


### 3.1 æœ¬åœ°æ–‡ä»¶å¼•ç”¨ï¼ˆLocalï¼‰


**ğŸ’¡ æ¦‚å¿µç†è§£**ï¼šå¼•ç”¨åŒä¸€ä¸ªé¡¹ç›®ä¸­çš„å…¶ä»–YAMLæ–‡ä»¶

**åŸºç¡€ç”¨æ³•**ï¼š
```yaml
# å¼•ç”¨ç›¸å¯¹è·¯å¾„æ–‡ä»¶
include:
  - local: 'ci/build.yml'
  - local: 'ci/test.yml'
  - local: 'ci/deploy.yml'
```

**æ–‡ä»¶ç»„ç»‡ç¤ºä¾‹**ï¼š
```
é¡¹ç›®ç›®å½•ç»“æ„ï¼š
myproject/
â”œâ”€â”€ .gitlab-ci.yml      â† ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ ci/
â”‚   â”œâ”€â”€ build.yml       â† æ„å»ºé…ç½®
â”‚   â”œâ”€â”€ test.yml        â† æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ deploy.yml      â† éƒ¨ç½²é…ç½®
â””â”€â”€ src/
    â””â”€â”€ app.js
```

**å®é™…é…ç½®å±•ç¤º**ï¼š
```yaml
# .gitlab-ci.ymlï¼ˆä¸»æ–‡ä»¶ï¼‰
include:
  - local: 'ci/build.yml'
  - local: 'ci/test.yml'
  - local: 'ci/deploy.yml'

stages:
  - build
  - test  
  - deploy

# ci/build.ymlï¼ˆæ„å»ºé…ç½®ï¼‰
build_app:
  stage: build
  script:
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist/

# ci/test.ymlï¼ˆæµ‹è¯•é…ç½®ï¼‰
test_app:
  stage: test
  script:
    - npm test
  coverage: '/Coverage: \d+\.\d+%/'
```

### 3.2 é¡¹ç›®æ–‡ä»¶å¼•ç”¨ï¼ˆProjectï¼‰


**ğŸ’¡ æ¦‚å¿µç†è§£**ï¼šå¼•ç”¨GitLabä¸Šå…¶ä»–é¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶

**è¯­æ³•æ ¼å¼**ï¼š
```yaml
include:
  - project: 'ç»„å/é¡¹ç›®å'
    file: 'æ–‡ä»¶è·¯å¾„'
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```yaml
# å¼•ç”¨è¿ç»´å›¢é˜Ÿç»´æŠ¤çš„é€šç”¨æ¨¡æ¿
include:
  - project: 'devops/ci-templates'
    file: 'docker-build.yml'
  - project: 'devops/ci-templates'
    file: 'security-scan.yml'
```

**å¤šæ–‡ä»¶å¼•ç”¨**ï¼š
```yaml
include:
  - project: 'devops/ci-templates'
    file: 
      - 'common/variables.yml'
      - 'common/docker.yml'
      - 'security/scan.yml'
```

### 3.3 è¿œç¨‹æ–‡ä»¶å¼•ç”¨ï¼ˆRemoteï¼‰


**ğŸ’¡ æ¦‚å¿µç†è§£**ï¼šå¼•ç”¨äº’è”ç½‘ä¸Šä»»æ„å¯è®¿é—®çš„YAMLæ–‡ä»¶

**åŸºç¡€ç”¨æ³•**ï¼š
```yaml
include:
  - remote: 'https://company.com/ci-templates/nodejs.yml'
  - remote: 'https://raw.githubusercontent.com/user/repo/main/ci.yml'
```

**âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹**ï¼š
```
å®‰å…¨è€ƒè™‘ï¼š
ğŸ”¸ ç¡®ä¿URLæ˜¯å¯ä¿¡çš„æº
ğŸ”¸ é¿å…å¼•ç”¨å¯èƒ½è¢«æ¶æ„ä¿®æ”¹çš„æ–‡ä»¶
ğŸ”¸ è€ƒè™‘ç½‘ç»œè®¿é—®çš„ç¨³å®šæ€§

å®è·µå»ºè®®ï¼š
ğŸ”¸ ä¼˜å…ˆä½¿ç”¨å…¬å¸å†…éƒ¨çš„é…ç½®æ–‡ä»¶
ğŸ”¸ å¯¹äºç¬¬ä¸‰æ–¹æ¨¡æ¿ï¼Œå…ˆä¸‹è½½åˆ°æœ¬åœ°å®¡æŸ¥
ğŸ”¸ å…³é”®é¡¹ç›®é¿å…ä¾èµ–å¤–éƒ¨ç½‘ç»œèµ„æº
```

### 3.4 å®˜æ–¹æ¨¡æ¿å¼•ç”¨ï¼ˆTemplateï¼‰


**ğŸ’¡ æ¦‚å¿µç†è§£**ï¼šä½¿ç”¨GitLabå®˜æ–¹æä¾›çš„ç°æˆæ¨¡æ¿

**å¸¸ç”¨å®˜æ–¹æ¨¡æ¿**ï¼š
```yaml
include:
  # å®‰å…¨æ‰«ææ¨¡æ¿
  - template: Security/SAST.gitlab-ci.yml
  - template: Security/Secret-Detection.gitlab-ci.yml
  
  # ä»£ç è´¨é‡æ£€æŸ¥
  - template: Code-Quality.gitlab-ci.yml
  
  # å®¹å™¨æ‰«æ
  - template: Security/Container-Scanning.gitlab-ci.yml
```

**æ¨¡æ¿åˆ†ç±»ä»‹ç»**ï¼š
```
ğŸ”’ Securityæ¨¡æ¿ï¼š
   - SAST.gitlab-ci.yml          â† é™æ€ä»£ç å®‰å…¨åˆ†æ
   - DAST.gitlab-ci.yml          â† åŠ¨æ€åº”ç”¨å®‰å…¨æµ‹è¯•
   - Container-Scanning.gitlab-ci.yml  â† å®¹å™¨é•œåƒå®‰å…¨æ‰«æ

ğŸ“Š è´¨é‡æ£€æŸ¥æ¨¡æ¿ï¼š
   - Code-Quality.gitlab-ci.yml  â† ä»£ç è´¨é‡åˆ†æ
   - Browser-Performance.gitlab-ci.yml  â† æµè§ˆå™¨æ€§èƒ½æµ‹è¯•

ğŸš€ éƒ¨ç½²æ¨¡æ¿ï¼š
   - Auto-DevOps.gitlab-ci.yml   â† è‡ªåŠ¨åŒ–DevOpsæµç¨‹
   - Deploy.gitlab-ci.yml        â† é€šç”¨éƒ¨ç½²æ¨¡æ¿
```

---

## 4. ğŸ”„ æ¨¡æ¿é…ç½®å¤ç”¨å®è·µ


### 4.1 åˆ›å»ºé€šç”¨æ„å»ºæ¨¡æ¿


**æ¨¡æ¿è®¾è®¡æ€è·¯**ï¼š
```
è®¾è®¡åŸåˆ™ï¼š
ğŸ¯ å•ä¸€èŒè´£ï¼šæ¯ä¸ªæ¨¡æ¿æ–‡ä»¶è´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½
ğŸ”§ å‚æ•°åŒ–ï¼šé€šè¿‡å˜é‡æ§åˆ¶ä¸åŒé¡¹ç›®çš„å·®å¼‚
ğŸ“ æ–‡æ¡£åŒ–ï¼šä¸ºæ¨¡æ¿æä¾›æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜
ğŸ§ª æµ‹è¯•éªŒè¯ï¼šç¡®ä¿æ¨¡æ¿åœ¨ä¸åŒé¡¹ç›®ä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œ
```

**Node.jsæ„å»ºæ¨¡æ¿ç¤ºä¾‹**ï¼š
```yaml
# templates/nodejs-build.yml
.nodejs_build_template: &nodejs_build
  image: node:${NODE_VERSION:-16}
  before_script:
    - npm ci --cache .npm --prefer-offline
  cache:
    key: "${CI_COMMIT_REF_SLUG}-npm"
    paths:
      - .npm/
      - node_modules/
  artifacts:
    expire_in: 1 hour
    paths:
      - dist/

# å…·ä½“çš„æ„å»ºä»»åŠ¡
build_frontend:
  <<: *nodejs_build
  stage: build
  script:
    - npm run build:prod
  variables:
    NODE_ENV: production

build_docs:
  <<: *nodejs_build
  stage: build
  script:
    - npm run build:docs
  artifacts:
    paths:
      - docs/
```

### 4.2 Dockeræ„å»ºæ¨¡æ¿


**é€šç”¨Dockeræ¨¡æ¿**ï¼š
```yaml
# templates/docker-build.yml
variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: "/certs"

.docker_build_template:
  image: docker:20.10.12
  services:
    - docker:20.10.12-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - |
      if [[ "$CI_COMMIT_BRANCH" == "$CI_DEFAULT_BRANCH" ]]; then
        tag="latest"
      else
        tag="$CI_COMMIT_REF_SLUG"
      fi
    - docker build -t $CI_REGISTRY_IMAGE:$tag .
    - docker push $CI_REGISTRY_IMAGE:$tag

# ä½¿ç”¨æ¨¡æ¿çš„ä»»åŠ¡
docker_build:
  extends: .docker_build_template
  stage: build
  rules:
    - if: $CI_COMMIT_BRANCH
```

### 4.3 æµ‹è¯•æ¨¡æ¿ç»„åˆ


**å¤šå±‚æ¬¡æµ‹è¯•æ¨¡æ¿**ï¼š
```yaml
# templates/testing.yml

# åŸºç¡€æµ‹è¯•æ¨¡æ¿
.test_base:
  image: node:16
  before_script:
    - npm ci
  cache:
    key: "${CI_COMMIT_REF_SLUG}-npm"
    paths:
      - node_modules/

# å•å…ƒæµ‹è¯•æ¨¡æ¿
.unit_test_template:
  extends: .test_base
  stage: test
  script:
    - npm run test:unit
  coverage: '/Coverage: \d+\.\d+%/'
  artifacts:
    reports:
      junit: junit.xml
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml

# é›†æˆæµ‹è¯•æ¨¡æ¿
.integration_test_template:
  extends: .test_base
  stage: test
  services:
    - postgres:13
    - redis:6
  variables:
    POSTGRES_DB: test_db
    POSTGRES_USER: test_user
    POSTGRES_PASSWORD: test_pass
  script:
    - npm run test:integration
```

---

## 5. ğŸ¤ é¡¹ç›®é—´é…ç½®å…±äº«


### 5.1 é…ç½®å…±äº«çš„ç»„ç»‡æ¶æ„


**ä¼ä¸šçº§é…ç½®ç®¡ç†ç»“æ„**ï¼š
```
é…ç½®ç®¡ç†æ¶æ„å›¾ï¼š

ç»„ç»‡æ¶æ„                    é…ç½®æ–‡ä»¶ç»“æ„
â”œâ”€â”€ devops/                â”œâ”€â”€ ci-templates/
â”‚   â””â”€â”€ ci-templates       â”‚   â”œâ”€â”€ base/
â”‚       â”œâ”€â”€ base/          â”‚   â”‚   â”œâ”€â”€ variables.yml     â† å…¨å±€å˜é‡
â”‚       â”œâ”€â”€ languages/     â”‚   â”‚   â”œâ”€â”€ docker.yml       â† Dockeré…ç½®
â”‚       â”œâ”€â”€ deploy/        â”‚   â”‚   â””â”€â”€ security.yml     â† å®‰å…¨æ‰«æ
â”‚       â””â”€â”€ security/      â”‚   â”œâ”€â”€ languages/
â”œâ”€â”€ frontend/              â”‚   â”‚   â”œâ”€â”€ nodejs.yml      â† Node.jsé¡¹ç›®
â”‚   â”œâ”€â”€ web-app           â”‚   â”‚   â”œâ”€â”€ python.yml      â† Pythoné¡¹ç›®
â”‚   â””â”€â”€ mobile-app        â”‚   â”‚   â””â”€â”€ java.yml        â† Javaé¡¹ç›®
â””â”€â”€ backend/               â”‚   â”œâ”€â”€ deploy/
    â”œâ”€â”€ api-service       â”‚   â”‚   â”œâ”€â”€ k8s.yml         â† K8séƒ¨ç½²
    â””â”€â”€ data-service      â”‚   â”‚   â””â”€â”€ aws.yml         â† AWSéƒ¨ç½²
                          â”‚   â””â”€â”€ security/
                          â”‚       â”œâ”€â”€ sast.yml        â† é™æ€åˆ†æ
                          â”‚       â””â”€â”€ dast.yml        â† åŠ¨æ€æµ‹è¯•
```

### 5.2 å›¢é˜Ÿåä½œé…ç½®ç®¡ç†


**é…ç½®æ¨¡æ¿é¡¹ç›®ç»“æ„**ï¼š
```yaml
# devops/ci-templates é¡¹ç›®ç»“æ„
ci-templates/
â”œâ”€â”€ README.md              â† ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ variables.yml      â† å…¨å±€å˜é‡å®šä¹‰
â”‚   â”œâ”€â”€ stages.yml         â† æ ‡å‡†æµæ°´çº¿é˜¶æ®µ
â”‚   â””â”€â”€ rules.yml          â† é€šç”¨æ‰§è¡Œè§„åˆ™
â”œâ”€â”€ languages/
â”‚   â”œâ”€â”€ nodejs.yml         â† Node.jsæ„å»ºæ¨¡æ¿
â”‚   â”œâ”€â”€ python.yml         â† Pythonæ„å»ºæ¨¡æ¿
â”‚   â””â”€â”€ java.yml           â† Javaæ„å»ºæ¨¡æ¿
â”œâ”€â”€ deploy/
â”‚   â”œâ”€â”€ kubernetes.yml     â† K8séƒ¨ç½²æ¨¡æ¿
â”‚   â””â”€â”€ docker.yml         â† Dockeréƒ¨ç½²æ¨¡æ¿
â””â”€â”€ examples/
    â”œâ”€â”€ simple-web.yml     â† ç®€å•Webé¡¹ç›®ç¤ºä¾‹
    â””â”€â”€ microservice.yml   â† å¾®æœåŠ¡é¡¹ç›®ç¤ºä¾‹
```

**å…¨å±€å˜é‡é…ç½®**ï¼š
```yaml
# base/variables.yml
variables:
  # æ„å»ºç›¸å…³
  BUILD_TIMEOUT: "30m"
  ARTIFACT_EXPIRE_TIME: "1 week"
  
  # Dockerç›¸å…³
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: "/certs"
  
  # éƒ¨ç½²ç¯å¢ƒ
  DEV_CLUSTER: "dev-k8s"
  STAGING_CLUSTER: "staging-k8s"
  PROD_CLUSTER: "prod-k8s"
  
  # å®‰å…¨æ‰«æ
  SECURITY_SCAN_ENABLED: "true"
  CODE_QUALITY_ENABLED: "true"
```

### 5.3 ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥


**æ¨¡æ¿ç‰ˆæœ¬ç®¡ç†**ï¼š
```yaml
# å¼•ç”¨ç‰¹å®šç‰ˆæœ¬çš„æ¨¡æ¿ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
include:
  - project: 'devops/ci-templates'
    file: 'nodejs.yml'
    ref: 'v1.2.0'           â† å›ºå®šç‰ˆæœ¬ï¼Œç¨³å®šå¯é 

# å¼•ç”¨æœ€æ–°ç‰ˆæœ¬ï¼ˆé€‚åˆå¼€å‘ç¯å¢ƒï¼‰  
include:
  - project: 'devops/ci-templates'
    file: 'nodejs.yml'
    ref: 'main'             â† ä¸»åˆ†æ”¯ï¼ŒåŠŸèƒ½æœ€æ–°
```

**ç‰ˆæœ¬ç­–ç•¥å»ºè®®**ï¼š
```
ğŸ“‹ ç‰ˆæœ¬ç®¡ç†ç­–ç•¥ï¼š

ğŸ·ï¸ è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼š
   - v1.0.0ï¼šä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬
   - ä¸»ç‰ˆæœ¬ï¼šä¸å…¼å®¹çš„é‡å¤§æ›´æ”¹
   - æ¬¡ç‰ˆæœ¬ï¼šå‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢
   - ä¿®è®¢ç‰ˆæœ¬ï¼šå‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®å¤

ğŸ”„ åˆ†æ”¯ç­–ç•¥ï¼š
   - mainï¼šç¨³å®šçš„å‘å¸ƒç‰ˆæœ¬
   - developï¼šå¼€å‘ä¸­çš„æ–°åŠŸèƒ½
   - feature/*ï¼šå…·ä½“åŠŸèƒ½å¼€å‘åˆ†æ”¯

âš ï¸ ä½¿ç”¨å»ºè®®ï¼š
   - ç”Ÿäº§é¡¹ç›®ï¼šå›ºå®šå¼•ç”¨ç¨³å®šç‰ˆæœ¬æ ‡ç­¾
   - æµ‹è¯•é¡¹ç›®ï¼šå¯ä»¥å¼•ç”¨developåˆ†æ”¯æµ‹è¯•æ–°åŠŸèƒ½
   - å®šæœŸå‡çº§ï¼šæ¯å­£åº¦è¯„ä¼°æ˜¯å¦å‡çº§æ¨¡æ¿ç‰ˆæœ¬
```

---

## 6. ğŸ›ï¸ æ¡ä»¶Includeè®¾ç½®


### 6.1 åŸºäºåˆ†æ”¯çš„æ¡ä»¶Include


**åˆ†æ”¯æ¡ä»¶åˆ¤æ–­**ï¼š
```yaml
# æ ¹æ®ä¸åŒåˆ†æ”¯å¼•ç”¨ä¸åŒé…ç½®
include:
  - local: 'ci/common.yml'
  - local: 'ci/development.yml'
    rules:
      - if: $CI_COMMIT_BRANCH == "develop"
  - local: 'ci/production.yml'  
    rules:
      - if: $CI_COMMIT_BRANCH == "main"
  - local: 'ci/feature.yml'
    rules:
      - if: $CI_COMMIT_BRANCH =~ /^feature\/.*/
```

**ç¯å¢ƒç‰¹å®šé…ç½®**ï¼š
```yaml
# development.yml - å¼€å‘ç¯å¢ƒé…ç½®
variables:
  DEPLOY_ENVIRONMENT: "development"
  DEBUG_MODE: "true"
  DB_HOST: "dev-db.company.com"

deploy_dev:
  stage: deploy
  script:
    - kubectl apply -f k8s/dev/
  environment:
    name: development
    url: https://dev.myapp.com

# production.yml - ç”Ÿäº§ç¯å¢ƒé…ç½®  
variables:
  DEPLOY_ENVIRONMENT: "production"
  DEBUG_MODE: "false"
  DB_HOST: "prod-db.company.com"

deploy_prod:
  stage: deploy
  script:
    - kubectl apply -f k8s/prod/
  environment:
    name: production
    url: https://myapp.com
  when: manual                    â† ç”Ÿäº§éƒ¨ç½²éœ€è¦æ‰‹åŠ¨ç¡®è®¤
```

### 6.2 åŸºäºå˜é‡çš„æ¡ä»¶Include


**å˜é‡é©±åŠ¨çš„é…ç½®é€‰æ‹©**ï¼š
```yaml
include:
  - local: 'ci/base.yml'
  # å®‰å…¨æ‰«æï¼ˆå¯é€‰ï¼‰
  - local: 'ci/security.yml'
    rules:
      - if: $SECURITY_SCAN_ENABLED == "true"
  # æ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰  
  - local: 'ci/performance.yml'
    rules:
      - if: $PERFORMANCE_TEST_ENABLED == "true"
  # éƒ¨ç½²é…ç½®ï¼ˆæ ¹æ®ç›®æ ‡ç¯å¢ƒï¼‰
  - local: 'ci/deploy-aws.yml'
    rules:
      - if: $DEPLOY_TARGET == "aws"
  - local: 'ci/deploy-gcp.yml'
    rules:
      - if: $DEPLOY_TARGET == "gcp"
```

### 6.3 å¤æ‚æ¡ä»¶ç»„åˆ


**å¤šæ¡ä»¶é€»è¾‘åˆ¤æ–­**ï¼š
```yaml
include:
  - local: 'ci/docker-build.yml'
    rules:
      # ä¸»åˆ†æ”¯æˆ–å‘å¸ƒåˆ†æ”¯æ‰æ„å»ºDockeré•œåƒ
      - if: $CI_COMMIT_BRANCH == "main"
      - if: $CI_COMMIT_BRANCH =~ /^release\/.*/
      
  - local: 'ci/e2e-test.yml'  
    rules:
      # éè‰ç¨¿MRä¸”ç›®æ ‡åˆ†æ”¯æ˜¯mainæ—¶æ‰è¿è¡ŒE2Eæµ‹è¯•
      - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "main" && $CI_MERGE_REQUEST_TITLE !~ /^Draft:/
      
  - local: 'ci/deploy.yml'
    rules:
      # åªæœ‰æ‰“æ ‡ç­¾æ—¶æ‰éƒ¨ç½²
      - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/
```

---

## 7. ğŸ“‹ é…ç½®æ–‡ä»¶ç»„ç»‡ç­–ç•¥


### 7.1 æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡


**æ¨¡å—åŒ–é…ç½®ç»“æ„**ï¼š
```
æ¨èçš„æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼š

é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .gitlab-ci.yml          â† ä¸»é…ç½®æ–‡ä»¶ï¼ˆç®€æ´æ˜äº†ï¼‰
â”œâ”€â”€ ci/
â”‚   â”œâ”€â”€ stages.yml          â† æµæ°´çº¿é˜¶æ®µå®šä¹‰
â”‚   â”œâ”€â”€ variables.yml       â† é¡¹ç›®å˜é‡
â”‚   â”œâ”€â”€ rules.yml           â† æ‰§è¡Œè§„åˆ™
â”‚   â”œâ”€â”€ jobs/
â”‚   â”‚   â”œâ”€â”€ build.yml       â† æ„å»ºç›¸å…³ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ test.yml        â† æµ‹è¯•ç›¸å…³ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ security.yml    â† å®‰å…¨æ‰«æä»»åŠ¡
â”‚   â”‚   â””â”€â”€ deploy.yml      â† éƒ¨ç½²ç›¸å…³ä»»åŠ¡
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ docker.yml      â† Dockerç›¸å…³æ¨¡æ¿
â”‚       â””â”€â”€ k8s.yml         â† Kubernetesç›¸å…³æ¨¡æ¿
```

**ä¸»é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š
```yaml
# .gitlab-ci.ymlï¼ˆä¿æŒç®€æ´ï¼‰
include:
  - local: 'ci/stages.yml'
  - local: 'ci/variables.yml'
  - local: 'ci/rules.yml'
  - local: 'ci/jobs/build.yml'
  - local: 'ci/jobs/test.yml'
  - local: 'ci/jobs/security.yml'
  - local: 'ci/jobs/deploy.yml'

# è¿™æ ·ä¸»æ–‡ä»¶å°±å¾ˆç®€æ´ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
```

### 7.2 æŒ‰ç¯å¢ƒåˆ†ç»„ç»„ç»‡


**ç¯å¢ƒå¯¼å‘çš„ç»„ç»‡æ–¹å¼**ï¼š
```
é€‚ç”¨åœºæ™¯ï¼šä¸åŒç¯å¢ƒå·®å¼‚è¾ƒå¤§çš„é¡¹ç›®

é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .gitlab-ci.yml
â”œâ”€â”€ ci/
â”‚   â”œâ”€â”€ common/             â† é€šç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ stages.yml
â”‚   â”‚   â”œâ”€â”€ variables.yml
â”‚   â”‚   â””â”€â”€ templates.yml
â”‚   â”œâ”€â”€ environments/       â† ç¯å¢ƒç‰¹å®šé…ç½®
â”‚   â”‚   â”œâ”€â”€ development.yml
â”‚   â”‚   â”œâ”€â”€ staging.yml
â”‚   â”‚   â””â”€â”€ production.yml
â”‚   â””â”€â”€ jobs/
â”‚       â”œâ”€â”€ build.yml
â”‚       â”œâ”€â”€ test.yml
â”‚       â””â”€â”€ deploy.yml
```

### 7.3 å¤§å‹é¡¹ç›®çš„é…ç½®ç®¡ç†


**ä¼ä¸šçº§é¡¹ç›®ç»„ç»‡ç­–ç•¥**ï¼š
```yaml
# å¤§å‹é¡¹ç›®çš„å±‚æ¬¡åŒ–Include
include:
  # ç¬¬1å±‚ï¼šåŸºç¡€é…ç½®
  - project: 'platform/ci-base'
    file: 'gitlab-ci-base.yml'
    ref: 'v2.1.0'
    
  # ç¬¬2å±‚ï¼šæŠ€æœ¯æ ˆé…ç½®  
  - project: 'platform/ci-templates'
    file: 'microservice/spring-boot.yml'
    ref: 'v1.5.0'
    
  # ç¬¬3å±‚ï¼šä¸šåŠ¡é…ç½®
  - local: 'ci/business-rules.yml'
  - local: 'ci/custom-jobs.yml'
  
  # ç¬¬4å±‚ï¼šç¯å¢ƒé…ç½®
  - local: 'ci/environments/${CI_ENVIRONMENT_NAME}.yml'
    rules:
      - if: $CI_ENVIRONMENT_NAME
```

**é…ç½®å±‚æ¬¡è¯´æ˜**ï¼š
```
ğŸ—ï¸ é…ç½®å±‚æ¬¡æ¶æ„ï¼š

Layer 1 - å¹³å°åŸºç¡€å±‚ï¼š
â”œâ”€â”€ å…¨å…¬å¸ç»Ÿä¸€çš„å®‰å…¨æ‰«æ
â”œâ”€â”€ æ ‡å‡†çš„æµæ°´çº¿é˜¶æ®µ
â””â”€â”€ é€šç”¨çš„éƒ¨ç½²è§„åˆ™

Layer 2 - æŠ€æœ¯æ ˆå±‚ï¼š
â”œâ”€â”€ Spring Booté¡¹ç›®æ¨¡æ¿
â”œâ”€â”€ Reactå‰ç«¯é¡¹ç›®æ¨¡æ¿  
â””â”€â”€ Pythonå¾®æœåŠ¡æ¨¡æ¿

Layer 3 - ä¸šåŠ¡é€»è¾‘å±‚ï¼š
â”œâ”€â”€ é¡¹ç›®ç‰¹å®šçš„æ„å»ºæ­¥éª¤
â”œâ”€â”€ ä¸šåŠ¡ç›¸å…³çš„æµ‹è¯•ä»»åŠ¡
â””â”€â”€ è‡ªå®šä¹‰çš„éƒ¨ç½²æµç¨‹

Layer 4 - ç¯å¢ƒé…ç½®å±‚ï¼š
â”œâ”€â”€ å¼€å‘ç¯å¢ƒå‚æ•°
â”œâ”€â”€ æµ‹è¯•ç¯å¢ƒå‚æ•°
â””â”€â”€ ç”Ÿäº§ç¯å¢ƒå‚æ•°
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Includeå¤–éƒ¨é…ç½®ï¼šGitLab CI/CDçš„é…ç½®å¤ç”¨æœºåˆ¶ï¼Œç±»ä¼¼ç¼–ç¨‹ä¸­çš„æ¨¡å—å¯¼å…¥
ğŸ”¸ å››ç§å¼•ç”¨æ–¹å¼ï¼šlocalï¼ˆæœ¬åœ°ï¼‰ã€projectï¼ˆé¡¹ç›®ï¼‰ã€remoteï¼ˆè¿œç¨‹ï¼‰ã€templateï¼ˆå®˜æ–¹ï¼‰
ğŸ”¸ é…ç½®åˆå¹¶è§„åˆ™ï¼šåå¼•ç”¨çš„é…ç½®ä¼šè¦†ç›–å…ˆå¼•ç”¨çš„ï¼Œæœ¬åœ°é…ç½®ä¼˜å…ˆçº§æœ€é«˜
ğŸ”¸ æ¡ä»¶Includeï¼šæ ¹æ®åˆ†æ”¯ã€å˜é‡ã€è§„åˆ™åŠ¨æ€é€‰æ‹©è¦å¼•ç”¨çš„é…ç½®æ–‡ä»¶
ğŸ”¸ ç»„ç»‡ç­–ç•¥ï¼šæŒ‰åŠŸèƒ½æ¨¡å—æˆ–ç¯å¢ƒåˆ†ç»„ç»„ç»‡é…ç½®æ–‡ä»¶ï¼Œä¿æŒç»“æ„æ¸…æ™°
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Includeçš„æ ¸å¿ƒä»·å€¼**
```
è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š
- é…ç½®é‡å¤ï¼šé¿å…åœ¨å¤šä¸ªé¡¹ç›®ä¸­é‡å¤å†™ç›¸åŒé…ç½®
- ç»´æŠ¤å›°éš¾ï¼šä¿®æ”¹é€šç”¨é…ç½®ä¸éœ€è¦é€ä¸ªé¡¹ç›®æ›´æ–°
- åä½œæ•ˆç‡ï¼šå›¢é˜Ÿå¯ä»¥å…±äº«æœ€ä½³å®è·µé…ç½®
- é¡¹ç›®å¯åŠ¨ï¼šæ–°é¡¹ç›®å¿«é€Ÿå¼•ç”¨æˆç†Ÿæ¨¡æ¿

å®é™…æ”¶ç›Šï¼š
- å¼€å‘æ•ˆç‡ï¼šå‡å°‘50-80%çš„CI/CDé…ç½®ç¼–å†™æ—¶é—´
- ç»´æŠ¤æˆæœ¬ï¼šé›†ä¸­ç»´æŠ¤ï¼Œé™ä½è¿ç»´è´Ÿæ‹…
- è´¨é‡ä¿è¯ï¼šä½¿ç”¨ç»è¿‡éªŒè¯çš„é…ç½®æ¨¡æ¿
- æ ‡å‡†åŒ–ï¼šç»Ÿä¸€å›¢é˜Ÿçš„CI/CDå®è·µ
```

**ğŸ”¹ é…ç½®ä¼˜å…ˆçº§ç†è§£**
```
ä¼˜å…ˆçº§é¡ºåºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. æœ¬åœ°.gitlab-ci.ymlä¸­çš„é…ç½®
2. æœ€åå¼•ç”¨çš„includeæ–‡ä»¶
3. ä¸­é—´å¼•ç”¨çš„includeæ–‡ä»¶  
4. æœ€å…ˆå¼•ç”¨çš„includeæ–‡ä»¶

å®é™…åº”ç”¨ï¼š
- ç”¨includeæä¾›é»˜è®¤é…ç½®
- ç”¨æœ¬åœ°é…ç½®è¦†ç›–ç‰¹æ®Šéœ€æ±‚
- é€šè¿‡includeé¡ºåºæ§åˆ¶é…ç½®å±‚æ¬¡
```

**ğŸ”¹ æœ€ä½³å®è·µåŸåˆ™**
```
è®¾è®¡åŸåˆ™ï¼š
ğŸ¯ å•ä¸€èŒè´£ï¼šæ¯ä¸ªé…ç½®æ–‡ä»¶è´Ÿè´£æ˜ç¡®çš„åŠŸèƒ½
ğŸ”§ å‚æ•°åŒ–ï¼šç”¨å˜é‡æ§åˆ¶é…ç½®çš„çµæ´»æ€§
ğŸ“ æ–‡æ¡£åŒ–ï¼šä¸ºé…ç½®æ¨¡æ¿æä¾›ä½¿ç”¨è¯´æ˜
ğŸ§ª ç‰ˆæœ¬æ§åˆ¶ï¼šä½¿ç”¨ç‰ˆæœ¬æ ‡ç­¾ç®¡ç†æ¨¡æ¿ç¨³å®šæ€§

ç»„ç»‡åŸåˆ™ï¼š
ğŸ“ æŒ‰åŠŸèƒ½åˆ†ç»„ï¼šbuildã€testã€deployåˆ†åˆ«ç‹¬ç«‹
ğŸŒ æŒ‰ç¯å¢ƒåˆ†å±‚ï¼šdevã€stagingã€prodé…ç½®åˆ†ç¦»
ğŸ”— å±‚æ¬¡åŒ–å¼•ç”¨ï¼šåŸºç¡€â†’æŠ€æœ¯æ ˆâ†’ä¸šåŠ¡â†’ç¯å¢ƒé€å±‚é…ç½®
ğŸ¤ å›¢é˜Ÿåä½œï¼šå…±äº«é…ç½®åº“ï¼ŒèŒè´£åˆ†å·¥æ˜ç¡®
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åº”ç”¨åœºæ™¯**
- **åˆåˆ›å›¢é˜Ÿ**ï¼šå¿«é€Ÿæ­å»ºCI/CDï¼Œå¼•ç”¨å®˜æ–¹æ¨¡æ¿å’Œå¼€æºé…ç½®
- **æˆé•¿æœŸä¼ä¸š**ï¼šå»ºç«‹é…ç½®æ¨¡æ¿åº“ï¼Œæé«˜å¼€å‘æ•ˆç‡
- **å¤§å‹ä¼ä¸š**ï¼šå¹³å°åŒ–CI/CDç®¡ç†ï¼Œæ”¯æŒæ•°ç™¾ä¸ªé¡¹ç›®æ ‡å‡†åŒ–
- **å¼€æºé¡¹ç›®**ï¼šå¼•ç”¨ç¤¾åŒºæœ€ä½³å®è·µï¼Œé™ä½è´¡çŒ®è€…é—¨æ§›

**ğŸ”§ æŠ€æœ¯åº”ç”¨å®è·µ**
- **å¾®æœåŠ¡æ¶æ„**ï¼šç»Ÿä¸€çš„æœåŠ¡æ„å»ºå’Œéƒ¨ç½²æ¨¡æ¿
- **å‰åç«¯åˆ†ç¦»**ï¼šå‰ç«¯å’Œåç«¯åˆ†åˆ«å¼•ç”¨å¯¹åº”æŠ€æœ¯æ ˆæ¨¡æ¿
- **å¤šç¯å¢ƒéƒ¨ç½²**ï¼šé€šè¿‡æ¡ä»¶includeå®ç°ç¯å¢ƒå·®å¼‚åŒ–é…ç½®
- **å®‰å…¨åˆè§„**ï¼šå¼ºåˆ¶å¼•ç”¨å®‰å…¨æ‰«ææ¨¡æ¿ï¼Œç¡®ä¿ä»£ç è´¨é‡

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Includeå¤ç”¨é…ç½®å‡é‡å¤ï¼Œå››ç§æ–¹å¼è¦è®°æ¸…
- Localæœ¬åœ°Projecté¡¹ç›®ï¼ŒRemoteè¿œç¨‹Templateæ¨¡æ¿
- ä¼˜å…ˆçº§åˆ«åè¦†å‰ï¼Œæœ¬åœ°é…ç½®æƒé‡é«˜
- æ¡ä»¶å¼•ç”¨æŒ‰éœ€é€‰ï¼Œæ¨¡å—ç»„ç»‡ç»“æ„å¥½