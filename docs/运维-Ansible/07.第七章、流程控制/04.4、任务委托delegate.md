---
title: 4ã€ä»»åŠ¡å§”æ‰˜delegate
---
## ğŸ“š ç›®å½•

1. [ä»»åŠ¡å§”æ‰˜åŸºæœ¬æ¦‚å¿µ](#1-ä»»åŠ¡å§”æ‰˜åŸºæœ¬æ¦‚å¿µ)
2. [delegate_toå§”æ‰˜è¯¦è§£](#2-delegate_toå§”æ‰˜è¯¦è§£)
3. [local_actionæœ¬åœ°æ‰§è¡Œ](#3-local_actionæœ¬åœ°æ‰§è¡Œ)
4. [run_onceå•æ¬¡æ‰§è¡Œ](#4-run_onceå•æ¬¡æ‰§è¡Œ)
5. [å§”æ‰˜å®æˆ˜åº”ç”¨åœºæ™¯](#5-å§”æ‰˜å®æˆ˜åº”ç”¨åœºæ™¯)
6. [å§”æ‰˜æœ€ä½³å®è·µ](#6-å§”æ‰˜æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»»åŠ¡å§”æ‰˜åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ä»»åŠ¡å§”æ‰˜


**ç®€å•ç†è§£**ï¼šä»»åŠ¡å§”æ‰˜å°±æ˜¯æŠŠåŸæœ¬è¦åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œçš„ä»»åŠ¡ï¼Œäº¤ç»™å…¶ä»–æœºå™¨æ¥æ‰§è¡Œã€‚

```
æ­£å¸¸æ‰§è¡Œï¼šAnsibleæ§åˆ¶æœº â†’ ç›®æ ‡æœåŠ¡å™¨A â†’ æ‰§è¡Œä»»åŠ¡
å§”æ‰˜æ‰§è¡Œï¼šAnsibleæ§åˆ¶æœº â†’ ç›®æ ‡æœåŠ¡å™¨A â†’ å§”æ‰˜ç»™æœåŠ¡å™¨B â†’ æœåŠ¡å™¨Bæ‰§è¡Œä»»åŠ¡
```

**ä¸ºä»€ä¹ˆéœ€è¦å§”æ‰˜**ï¼š
- ğŸ”¸ **æƒé™é™åˆ¶**ï¼šç›®æ ‡æœºå™¨æ²¡æœ‰æ‰§è¡ŒæŸäº›æ“ä½œçš„æƒé™
- ğŸ”¸ **èµ„æºé™åˆ¶**ï¼šç›®æ ‡æœºå™¨æ²¡æœ‰å¿…è¦çš„å·¥å…·æˆ–èµ„æº
- ğŸ”¸ **æ¶æ„éœ€è¦**ï¼šéœ€è¦åœ¨ç‰¹å®šæœºå™¨ä¸Šæ‰§è¡Œæ“ä½œ(å¦‚è´Ÿè½½å‡è¡¡å™¨)
- ğŸ”¸ **å®‰å…¨è€ƒè™‘**ï¼šé¿å…åœ¨ç”Ÿäº§æœºå™¨ä¸Šç›´æ¥æ‰§è¡Œå±é™©æ“ä½œ

### 1.2 å§”æ‰˜çš„æ ¸å¿ƒæ¦‚å¿µ


**å§”æ‰˜æ–¹å¼å¯¹æ¯”**ï¼š

| æ–¹å¼ | **æ‰§è¡Œä½ç½®** | **å˜é‡æ¥æº** | **é€‚ç”¨åœºæ™¯** |
|------|------------|------------|------------|
| `delegate_to` | æŒ‡å®šçš„æœºå™¨ | å½“å‰ç›®æ ‡æœºå™¨ | éœ€è¦è®¿é—®ç›®æ ‡æœºå™¨å˜é‡ |
| `local_action` | æ§åˆ¶æœºæœ¬åœ° | å½“å‰ç›®æ ‡æœºå™¨ | æœ¬åœ°å·¥å…·å¤„ç†è¿œç¨‹æ•°æ® |
| `run_once` | ç¬¬ä¸€å°æœºå™¨ | ç¬¬ä¸€å°æœºå™¨ | åªéœ€æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡ |

---

## 2. ğŸ”„ delegate_toå§”æ‰˜è¯¦è§£


### 2.1 delegate_toåŸºæœ¬è¯­æ³•


**åŸºæœ¬ç”¨æ³•**ï¼š
```yaml
- name: å§”æ‰˜ä»»åŠ¡ç¤ºä¾‹
  command: echo "æˆ‘åœ¨{{ inventory_hostname }}ä¸Šæ‰§è¡Œ"
  delegate_to: server2
```

**æ‰§è¡Œæµç¨‹è§£é‡Š**ï¼š
```
å‡è®¾å½“å‰æ“ä½œserver1ï¼š
1. Ansibleæ”¶é›†server1çš„ä¿¡æ¯å’Œå˜é‡
2. å°†ä»»åŠ¡å§”æ‰˜ç»™server2æ‰§è¡Œ
3. server2æ‰§è¡Œä»»åŠ¡ï¼Œä½†ä½¿ç”¨çš„æ˜¯server1çš„å˜é‡
4. ç»“æœè¿”å›ç»™Ansibleæ§åˆ¶æœº
```

### 2.2 å§”æ‰˜åˆ°æŒ‡å®šä¸»æœº


**å§”æ‰˜åˆ°å…·ä½“ä¸»æœº**ï¼š
```yaml
- hosts: webservers
  tasks:
    - name: åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šåˆ›å»ºç”¨æˆ·
      mysql_user:
        name: "web_{{ inventory_hostname }}"
        password: "{{ web_password }}"
        state: present
      delegate_to: db.example.com
```

**å§”æ‰˜åˆ°ä¸»æœºç»„**ï¼š
```yaml
- hosts: webservers
  tasks:
    - name: é€šçŸ¥æ‰€æœ‰ç®¡ç†å‘˜æœåŠ¡å™¨
      mail:
        subject: "æœåŠ¡å™¨{{ inventory_hostname }}éƒ¨ç½²å®Œæˆ"
        body: "éƒ¨ç½²è¯¦æƒ…..."
      delegate_to: "{{ item }}"
      loop: "{{ groups['admin_servers'] }}"
```

### 2.3 å§”æ‰˜å˜é‡çš„ä½¿ç”¨


**ç†è§£å˜é‡æ¥æº**ï¼š
```yaml
- hosts: webservers
  vars:
    web_port: 80
  tasks:
    # é”™è¯¯ç†è§£ï¼šä»¥ä¸ºä½¿ç”¨dbæœåŠ¡å™¨çš„å˜é‡
    - name: é”™è¯¯ç¤ºä¾‹ - å˜é‡æ¥æºæ··æ·†
      debug:
        msg: "ç«¯å£æ˜¯{{ web_port }}"  # å®é™…ç”¨çš„æ˜¯webserverçš„web_port
      delegate_to: database

    # æ­£ç¡®ä½¿ç”¨ï¼šæ˜ç¡®å˜é‡æ¥æº
    - name: æ­£ç¡®ç¤ºä¾‹ - æ˜ç¡®å˜é‡æ¥æº
      debug:
        msg: "å½“å‰webæœåŠ¡å™¨{{ inventory_hostname }}ä½¿ç”¨ç«¯å£{{ web_port }}"
      delegate_to: database
```

**è®¿é—®å§”æ‰˜ç›®æ ‡çš„å˜é‡**ï¼š
```yaml
- name: è®¿é—®å§”æ‰˜ç›®æ ‡ä¸»æœºçš„å˜é‡
  debug:
    msg: "å§”æ‰˜ç›®æ ‡{{ delegate_to }}çš„IPæ˜¯{{ hostvars[delegate_to]['ansible_default_ipv4']['address'] }}"
  delegate_to: database
  vars:
    delegate_to: database
```

---

## 3. ğŸ  local_actionæœ¬åœ°æ‰§è¡Œ


### 3.1 local_actionåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯local_action**ï¼š
- åœ¨Ansibleæ§åˆ¶æœº(æœ¬åœ°)æ‰§è¡Œä»»åŠ¡
- ç­‰åŒäº`delegate_to: localhost`
- å¸¸ç”¨äºæœ¬åœ°å·¥å…·å¤„ç†è¿œç¨‹æ•°æ®

### 3.2 local_actionä½¿ç”¨æ–¹æ³•


**åŸºæœ¬è¯­æ³•**ï¼š
```yaml
# æ–¹å¼1ï¼šä½¿ç”¨local_action
- name: æœ¬åœ°å¤‡ä»½é…ç½®æ–‡ä»¶
  local_action:
    module: copy
    src: "{{ ansible_hostname }}_config.txt"
    dest: "/tmp/backup/"

# æ–¹å¼2ï¼šç­‰æ•ˆçš„delegate_toå†™æ³•
- name: æœ¬åœ°å¤‡ä»½é…ç½®æ–‡ä»¶
  copy:
    src: "{{ ansible_hostname }}_config.txt"  
    dest: "/tmp/backup/"
  delegate_to: localhost
```

### 3.3 å…¸å‹åº”ç”¨åœºæ™¯


**æœ¬åœ°æ–‡ä»¶å¤„ç†**ï¼š
```yaml
- hosts: webservers
  tasks:
    # è·å–è¿œç¨‹æœåŠ¡å™¨ä¿¡æ¯
    - name: è·å–ç³»ç»Ÿä¿¡æ¯
      setup:
      register: system_info

    # åœ¨æœ¬åœ°ç”ŸæˆæŠ¥å‘Š
    - name: ç”Ÿæˆç³»ç»ŸæŠ¥å‘Š
      local_action:
        module: template
        src: system_report.j2
        dest: "/tmp/reports/{{ inventory_hostname }}_report.html"
      vars:
        server_info: "{{ system_info.ansible_facts }}"
```

**æœ¬åœ°APIè°ƒç”¨**ï¼š
```yaml
- name: è°ƒç”¨ç›‘æ§APIæ·»åŠ ä¸»æœº
  local_action:
    module: uri
    url: "http://monitor.example.com/api/hosts"
    method: POST
    body_format: json
    body:
      hostname: "{{ inventory_hostname }}"
      ip: "{{ ansible_default_ipv4.address }}"
      group: "{{ group_names[0] }}"
```

---

## 4. ğŸ¯ run_onceå•æ¬¡æ‰§è¡Œ


### 4.1 run_onceåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯run_once**ï¼š
- åœ¨æ•´ä¸ªplaybookè¿è¡Œä¸­åªæ‰§è¡Œä¸€æ¬¡
- é»˜è®¤åœ¨ç¬¬ä¸€ä¸ªåŒ¹é…çš„ä¸»æœºä¸Šæ‰§è¡Œ
- å¸¸ç”¨äºåˆå§‹åŒ–ã€æ¸…ç†ç­‰åªéœ€æ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡

### 4.2 run_onceåŸºæœ¬ç”¨æ³•


**åŸºæœ¬è¯­æ³•**ï¼š
```yaml
- hosts: webservers  # å‡è®¾æœ‰web1, web2, web3ä¸‰å°æœåŠ¡å™¨
  tasks:
    - name: åªæ‰§è¡Œä¸€æ¬¡çš„ä»»åŠ¡
      debug:
        msg: "è¿™ä¸ªä»»åŠ¡åªåœ¨{{ inventory_hostname }}ä¸Šæ‰§è¡Œä¸€æ¬¡"
      run_once: true
      # ç»“æœï¼šåªåœ¨web1ä¸Šæ‰§è¡Œ
```

**ä¸delegate_toç»“åˆä½¿ç”¨**ï¼š
```yaml
- hosts: webservers
  tasks:
    - name: åœ¨æŒ‡å®šæœåŠ¡å™¨ä¸Šåªæ‰§è¡Œä¸€æ¬¡
      command: /opt/scripts/init_cluster.sh
      run_once: true
      delegate_to: master.example.com
```

### 4.3 run_onceå®é™…åº”ç”¨


**æ•°æ®åº“åˆå§‹åŒ–**ï¼š
```yaml
- hosts: app_servers
  tasks:
    - name: åˆ›å»ºåº”ç”¨æ•°æ®åº“(åªéœ€æ‰§è¡Œä¸€æ¬¡)
      mysql_db:
        name: myapp_db
        state: present
      run_once: true
      delegate_to: "{{ groups['database'][0] }}"
```

**é›†ç¾¤åˆå§‹åŒ–**ï¼š
```yaml
- hosts: elasticsearch_cluster
  tasks:
    - name: åˆå§‹åŒ–ESé›†ç¾¤é…ç½®(åªæ‰§è¡Œä¸€æ¬¡)
      uri:
        url: "http://{{ groups['elasticsearch_cluster'][0] }}:9200/_cluster/settings"
        method: PUT
        body_format: json
        body:
          persistent:
            cluster.routing.allocation.enable: "all"
      run_once: true
```

---

## 5. ğŸš€ å§”æ‰˜å®æˆ˜åº”ç”¨åœºæ™¯


### 5.1 è´Ÿè½½å‡è¡¡å™¨æ“ä½œ


**åœºæ™¯è¯´æ˜**ï¼šåœ¨æ›´æ–°webæœåŠ¡å™¨æ—¶ï¼Œéœ€è¦å…ˆä»è´Ÿè½½å‡è¡¡å™¨ç§»é™¤ï¼Œæ›´æ–°å®Œæˆåå†åŠ å›ã€‚

```yaml
- hosts: webservers
  serial: 1  # ä¸€æ¬¡åªå¤„ç†ä¸€å°æœåŠ¡å™¨
  tasks:
    # 1. ä»è´Ÿè½½å‡è¡¡å™¨ç§»é™¤èŠ‚ç‚¹
    - name: ä»F5è´Ÿè½½å‡è¡¡å™¨ç§»é™¤èŠ‚ç‚¹
      bigip_node:
        server: "{{ f5_server }}"
        user: "{{ f5_user }}"
        password: "{{ f5_password }}"
        host: "{{ inventory_hostname }}"
        state: absent
      delegate_to: localhost

    # 2. ç­‰å¾…è¿æ¥æ–­å¼€
    - name: ç­‰å¾…ç°æœ‰è¿æ¥æ–­å¼€
      wait_for:
        timeout: 30

    # 3. æ›´æ–°åº”ç”¨
    - name: éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨
      copy:
        src: /tmp/newapp.war
        dest: /opt/tomcat/webapps/

    - name: é‡å¯æœåŠ¡
      systemd:
        name: tomcat
        state: restarted

    # 4. å¥åº·æ£€æŸ¥
    - name: æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
      uri:
        url: "http://{{ inventory_hostname }}:8080/health"
        status_code: 200
      register: health_check
      until: health_check.status == 200
      retries: 5
      delay: 10

    # 5. é‡æ–°åŠ å…¥è´Ÿè½½å‡è¡¡å™¨
    - name: å°†èŠ‚ç‚¹åŠ å›F5è´Ÿè½½å‡è¡¡å™¨
      bigip_node:
        server: "{{ f5_server }}"
        user: "{{ f5_user }}"
        password: "{{ f5_password }}"
        host: "{{ inventory_hostname }}"
        state: present
      delegate_to: localhost
```

### 5.2 æ•°æ®åº“æ“ä½œåœºæ™¯


**åœºæ™¯è¯´æ˜**ï¼šåœ¨åº”ç”¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ—¶ï¼Œéœ€è¦åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šåˆ›å»ºå¯¹åº”çš„ç”¨æˆ·å’Œæƒé™ã€‚

```yaml
- hosts: app_servers
  tasks:
    # è·å–åº”ç”¨æœåŠ¡å™¨IP
    - name: è·å–å½“å‰æœåŠ¡å™¨IP
      set_fact:
        server_ip: "{{ ansible_default_ipv4.address }}"

    # åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸Šåˆ›å»ºç”¨æˆ·
    - name: åˆ›å»ºåº”ç”¨æ•°æ®åº“ç”¨æˆ·
      mysql_user:
        name: "app_{{ inventory_hostname_short }}"
        password: "{{ app_db_password }}"
        host: "{{ server_ip }}"
        priv: "{{ app_database }}.*:SELECT,INSERT,UPDATE,DELETE"
        state: present
      delegate_to: "{{ groups['database'][0] }}"

    # æµ‹è¯•æ•°æ®åº“è¿æ¥
    - name: æµ‹è¯•æ•°æ®åº“è¿æ¥
      mysql_db:
        name: "{{ app_database }}"
        state: present
      delegate_to: "{{ groups['database'][0] }}"
      run_once: true
```

### 5.3 ç›‘æ§ç³»ç»Ÿé›†æˆ


**åœºæ™¯è¯´æ˜**ï¼šæœåŠ¡å™¨éƒ¨ç½²å®Œæˆåï¼Œè‡ªåŠ¨æ·»åŠ åˆ°ç›‘æ§ç³»ç»Ÿã€‚

```yaml
- hosts: new_servers
  tasks:
    # æ”¶é›†æœåŠ¡å™¨ä¿¡æ¯
    - name: æ”¶é›†ç³»ç»Ÿä¿¡æ¯
      setup:
      register: server_facts

    # è°ƒç”¨ç›‘æ§ç³»ç»ŸAPIæ·»åŠ ä¸»æœº
    - name: æ·»åŠ ä¸»æœºåˆ°Zabbixç›‘æ§
      uri:
        url: "{{ zabbix_api_url }}/api_jsonrpc.php"
        method: POST
        body_format: json
        headers:
          Content-Type: "application/json"
        body:
          jsonrpc: "2.0"
          method: "host.create"
          params:
            host: "{{ inventory_hostname }}"
            interfaces:
              - type: 1
                main: 1
                useip: 1
                ip: "{{ ansible_default_ipv4.address }}"
                dns: ""
                port: "10050"
            groups:
              - groupid: "{{ zabbix_group_id }}"
            templates:
              - templateid: "{{ zabbix_template_id }}"
          auth: "{{ zabbix_auth_token }}"
          id: 1
      delegate_to: localhost

    # ç”ŸæˆæœåŠ¡å™¨æ¸…å•
    - name: æ›´æ–°æœ¬åœ°æœåŠ¡å™¨æ¸…å•
      lineinfile:
        path: /tmp/server_inventory.txt
        line: "{{ inventory_hostname }},{{ ansible_default_ipv4.address }},{{ ansible_distribution }}"
        create: yes
      delegate_to: localhost
```

---

## 6. âš¡ å§”æ‰˜æœ€ä½³å®è·µ


### 6.1 æ€§èƒ½è€ƒè™‘


**å‡å°‘ä¸å¿…è¦çš„å§”æ‰˜**ï¼š
```yaml
# âŒ ä¸å¥½çš„åšæ³•ï¼šæ¯ä¸ªä¸»æœºéƒ½å§”æ‰˜æ‰§è¡Œç›¸åŒä»»åŠ¡
- hosts: webservers
  tasks:
    - name: åˆ›å»ºå…±äº«ç›®å½•(ä½æ•ˆ)
      file:
        path: /shared/app_data
        state: directory
      delegate_to: nfs_server

# âœ… å¥½çš„åšæ³•ï¼šåªæ‰§è¡Œä¸€æ¬¡
- hosts: webservers
  tasks:
    - name: åˆ›å»ºå…±äº«ç›®å½•(é«˜æ•ˆ)
      file:
        path: /shared/app_data
        state: directory
      delegate_to: nfs_server
      run_once: true
```

**æ‰¹é‡å§”æ‰˜ä¼˜åŒ–**ï¼š
```yaml
# âœ… æ”¶é›†æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ï¼Œä¸€æ¬¡æ€§å§”æ‰˜å¤„ç†
- hosts: webservers
  tasks:
    - name: æ”¶é›†æ‰€æœ‰webæœåŠ¡å™¨ä¿¡æ¯
      set_fact:
        web_servers_info: |
          {% for host in groups['webservers'] %}
          {{ host }}: {{ hostvars[host]['ansible_default_ipv4']['address'] }}
          {% endfor %}
      run_once: true

    - name: æ‰¹é‡æ›´æ–°è´Ÿè½½å‡è¡¡é…ç½®
      template:
        src: nginx_upstream.j2
        dest: /etc/nginx/conf.d/upstream.conf
      delegate_to: load_balancer
      run_once: true
      notify: reload nginx
```

### 6.2 å®‰å…¨æ³¨æ„äº‹é¡¹


**æƒé™æœ€å°åŒ–**ï¼š
```yaml
# âœ… ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·æ‰§è¡Œå§”æ‰˜ä»»åŠ¡
- name: æ•°æ®åº“æ“ä½œä½¿ç”¨ä¸“ç”¨ç”¨æˆ·
  mysql_user:
    name: "{{ app_user }}"
    password: "{{ app_password }}"
    state: present
  delegate_to: database
  become: yes
  become_user: mysql_admin  # ä½¿ç”¨ä¸“é—¨çš„æ•°æ®åº“ç®¡ç†ç”¨æˆ·
```

**æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼š
```yaml
- name: å®‰å…¨çš„APIè°ƒç”¨
  uri:
    url: "{{ api_endpoint }}"
    method: POST
    headers:
      Authorization: "Bearer {{ vault_api_token }}"  # ä½¿ç”¨vaultåŠ å¯†
    body_format: json
    body: "{{ api_payload }}"
  delegate_to: localhost
  no_log: true  # ä¸è®°å½•æ•æ„Ÿä¿¡æ¯åˆ°æ—¥å¿—
```

### 6.3 é”™è¯¯å¤„ç†


**å§”æ‰˜ä»»åŠ¡çš„é”™è¯¯å¤„ç†**ï¼š
```yaml
- name: å¸¦é”™è¯¯å¤„ç†çš„å§”æ‰˜ä»»åŠ¡
  block:
    - name: å°è¯•åœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œä»»åŠ¡
      command: /opt/scripts/deploy.sh
      delegate_to: deploy_server
      register: deploy_result

  rescue:
    - name: å§”æ‰˜ä»»åŠ¡å¤±è´¥æ—¶çš„å¤„ç†
      debug:
        msg: "éƒ¨ç½²å¤±è´¥ï¼š{{ deploy_result.stderr | default('æœªçŸ¥é”™è¯¯') }}"
      
    - name: å‘é€å¤±è´¥é€šçŸ¥
      mail:
        subject: "éƒ¨ç½²å¤±è´¥é€šçŸ¥"
        body: "æœåŠ¡å™¨{{ inventory_hostname }}éƒ¨ç½²å¤±è´¥"
      delegate_to: localhost

  always:
    - name: æ¸…ç†ä¸´æ—¶æ–‡ä»¶
      file:
        path: /tmp/deploy_temp
        state: absent
      delegate_to: deploy_server
```

### 6.4 è°ƒè¯•å’Œç›‘æ§


**å§”æ‰˜ä»»åŠ¡çš„è°ƒè¯•**ï¼š
```yaml
- name: è°ƒè¯•å§”æ‰˜ä»»åŠ¡
  debug:
    msg: |
      å½“å‰ä¸»æœº: {{ inventory_hostname }}
      å§”æ‰˜ç›®æ ‡: {{ delegate_to_host }}
      å§”æ‰˜ç›®æ ‡IP: {{ hostvars[delegate_to_host]['ansible_default_ipv4']['address'] }}
  vars:
    delegate_to_host: database
  delegate_to: "{{ delegate_to_host }}"
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ delegate_toï¼šå°†ä»»åŠ¡å§”æ‰˜ç»™æŒ‡å®šä¸»æœºæ‰§è¡Œï¼Œä½†ä½¿ç”¨åŸä¸»æœºçš„å˜é‡
ğŸ”¸ local_actionï¼šåœ¨æ§åˆ¶æœºæœ¬åœ°æ‰§è¡Œä»»åŠ¡ï¼Œç­‰åŒäºdelegate_to: localhost  
ğŸ”¸ run_onceï¼šåœ¨æ•´ä¸ªplaybookä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¸¸ä¸å§”æ‰˜ç»“åˆä½¿ç”¨
ğŸ”¸ å˜é‡æ¥æºï¼šå§”æ‰˜ä»»åŠ¡ä½¿ç”¨çš„æ˜¯åŸå§‹ç›®æ ‡ä¸»æœºçš„å˜é‡ï¼Œä¸æ˜¯å§”æ‰˜ç›®æ ‡çš„å˜é‡
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šè´Ÿè½½å‡è¡¡æ“ä½œã€æ•°æ®åº“ç®¡ç†ã€ç›‘æ§é›†æˆã€æœ¬åœ°å·¥å…·è°ƒç”¨
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å§”æ‰˜çš„æœ¬è´¨**ï¼š
```
ç†è§£è¦ç‚¹ï¼š
- æ”¹å˜æ‰§è¡Œä½ç½®ï¼Œä½†ä¸æ”¹å˜å˜é‡ä¸Šä¸‹æ–‡
- ä»»åŠ¡åœ¨å§”æ‰˜ç›®æ ‡æ‰§è¡Œï¼Œå˜é‡æ¥è‡ªåŸå§‹ä¸»æœº
- å§”æ‰˜æ˜¯ä¸ºäº†åˆ©ç”¨ç‰¹å®šæœºå™¨çš„èµ„æºæˆ–æƒé™
```

**ğŸ”¹ ä½•æ—¶ä½¿ç”¨å§”æ‰˜**ï¼š
```
ä½¿ç”¨åœºæ™¯åˆ¤æ–­ï¼š
âœ… ç›®æ ‡æœºå™¨æ²¡æœ‰å¿…è¦çš„å·¥å…·æˆ–æƒé™
âœ… éœ€è¦åœ¨ç‰¹å®šæœºå™¨ä¸Šæ‰§è¡Œæ“ä½œ(å¦‚è´Ÿè½½å‡è¡¡å™¨)
âœ… éœ€è¦æœ¬åœ°å·¥å…·å¤„ç†è¿œç¨‹æ•°æ®
âœ… åªéœ€æ‰§è¡Œä¸€æ¬¡çš„åˆå§‹åŒ–ä»»åŠ¡

é¿å…åœºæ™¯ï¼š
âŒ ç®€å•çš„è¿œç¨‹æ“ä½œ
âŒ ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€
âŒ å¤æ‚åŒ–ç®€å•ä»»åŠ¡
```

**ğŸ”¹ æ€§èƒ½å’Œå®‰å…¨è€ƒè™‘**ï¼š
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- åˆç†ä½¿ç”¨run_onceé¿å…é‡å¤æ‰§è¡Œ
- æ‰¹é‡æ”¶é›†ä¿¡æ¯ï¼Œå‡å°‘å§”æ‰˜æ¬¡æ•°
- é¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨å§”æ‰˜

å®‰å…¨å®è·µï¼š
- ä½¿ç”¨æœ€å°æƒé™åŸåˆ™
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨vaultåŠ å¯†
- å§”æ‰˜ä»»åŠ¡åŠ å…¥é€‚å½“çš„é”™è¯¯å¤„ç†
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


- **æ¶æ„è§£è€¦**ï¼šåˆ†ç¦»åº”ç”¨æœåŠ¡å™¨å’Œç®¡ç†æœåŠ¡å™¨çš„æ“ä½œ
- **æƒé™ç®¡ç†**ï¼šåœ¨æœ‰æƒé™çš„æœºå™¨ä¸Šæ‰§è¡Œç‰¹æƒæ“ä½œ
- **å·¥å…·é›†æˆ**ï¼šåˆ©ç”¨æœ¬åœ°å·¥å…·å¤„ç†è¿œç¨‹æ•°æ®
- **æµç¨‹åè°ƒ**ï¼šåè°ƒå¤šä¸ªç³»ç»Ÿé—´çš„æ“ä½œæµç¨‹

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å§”æ‰˜æ”¹ä½ç½®ä¸æ”¹å˜é‡æºï¼Œæœ¬åœ°æ‰§è¡Œç”¨local_action
- run_onceé¿å…é‡å¤æ‰§è¡Œï¼Œè´Ÿè½½å‡è¡¡æ•°æ®åº“å¸¸ç”¨å§”æ‰˜
- æ€§èƒ½å®‰å…¨è¦è€ƒè™‘ï¼Œé”™è¯¯å¤„ç†ä¸èƒ½å¿˜