---
title: 3ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨
---
## ğŸ“š ç›®å½•

1. [è¿‡æ»¤å™¨åŸºç¡€æ¦‚å¿µ](#1-è¿‡æ»¤å™¨åŸºç¡€æ¦‚å¿µ)
2. [Pythonè¿‡æ»¤å™¨å¼€å‘](#2-Pythonè¿‡æ»¤å™¨å¼€å‘)
3. [è¿‡æ»¤å™¨æ³¨å†Œä¸é…ç½®](#3-è¿‡æ»¤å™¨æ³¨å†Œä¸é…ç½®)
4. [å­—ç¬¦ä¸²å¤„ç†è¿‡æ»¤å™¨](#4-å­—ç¬¦ä¸²å¤„ç†è¿‡æ»¤å™¨)
5. [åˆ—è¡¨å­—å…¸è¿‡æ»¤å™¨](#5-åˆ—è¡¨å­—å…¸è¿‡æ»¤å™¨)
6. [æ•°å€¼ä¸æ—¥æœŸæ—¶é—´è¿‡æ»¤å™¨](#6-æ•°å€¼ä¸æ—¥æœŸæ—¶é—´è¿‡æ»¤å™¨)
7. [æ–‡ä»¶è·¯å¾„è¿‡æ»¤å™¨](#7-æ–‡ä»¶è·¯å¾„è¿‡æ»¤å™¨)
8. [è¿‡æ»¤å™¨æµ‹è¯•ä¸è°ƒè¯•](#8-è¿‡æ»¤å™¨æµ‹è¯•ä¸è°ƒè¯•)
9. [ä¼ä¸šåº”ç”¨åœºæ™¯å®è·µ](#9-ä¼ä¸šåº”ç”¨åœºæ™¯å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¿‡æ»¤å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Ansibleè¿‡æ»¤å™¨


> ğŸ’¡ **é€šä¿—ç†è§£**  
> Ansibleè¿‡æ»¤å™¨å°±åƒæ•°æ®åŠ å·¥å‚çš„æµæ°´çº¿ï¼ŒæŠŠåŸå§‹æ•°æ®é€šè¿‡"ç®¡é“"ä¼ é€’ï¼Œæ¯ä¸ªè¿‡æ»¤å™¨éƒ½æ˜¯ä¸€ä¸ªåŠ å·¥ç¯èŠ‚ï¼Œæœ€ç»ˆè¾“å‡ºæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
è¿‡æ»¤å™¨ = æ•°æ®è½¬æ¢å™¨
åŸç†ï¼šinput_data | filter_name | another_filter
ä½œç”¨ï¼šæ ¼å¼åŒ–ã€è®¡ç®—ã€ç­›é€‰ã€è½¬æ¢æ•°æ®
ä½ç½®ï¼šä¸»è¦åœ¨Jinja2æ¨¡æ¿ä¸­ä½¿ç”¨
```

**ğŸ“Š è¿‡æ»¤å™¨åœ¨Ansibleä¸­çš„ä½ç½®**
```
Ansibleæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Variables  â”‚â”€â”€â”€â–¶â”‚  Templates  â”‚â”€â”€â”€â–¶â”‚   Tasks     â”‚
â”‚   æ•°æ®æº    â”‚    â”‚  è¿‡æ»¤å™¨å¤„ç†  â”‚    â”‚  æœ€ç»ˆä½¿ç”¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                    è¿™é‡Œåº”ç”¨è¿‡æ»¤å™¨
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰è¿‡æ»¤å™¨


**ğŸ” ä½¿ç”¨åœºæ™¯åˆ†æ**
```
å†…ç½®è¿‡æ»¤å™¨å¤Ÿç”¨çš„æƒ…å†µï¼š
âœ… ç®€å•å­—ç¬¦ä¸²æ“ä½œï¼š{{ name | upper }}
âœ… åŸºç¡€æ•°æ®è½¬æ¢ï¼š{{ data | to_json }}
âœ… å¸¸è§æ ¼å¼åŒ–ï¼š{{ items | join(',') }}

éœ€è¦è‡ªå®šä¹‰çš„æƒ…å†µï¼š
âŒ å¤æ‚ä¸šåŠ¡é€»è¾‘å¤„ç†
âŒ ç‰¹å®šæ ¼å¼è½¬æ¢éœ€æ±‚  
âŒ ä¼ä¸šå†…éƒ¨æ ‡å‡†åŒ–æ“ä½œ
âŒ æ€§èƒ½ä¼˜åŒ–çš„ä¸“ç”¨å¤„ç†
```

**ğŸ’¼ å®é™…ä¼ä¸šéœ€æ±‚ç¤ºä¾‹**
- **é…ç½®æ–‡ä»¶ç”Ÿæˆ**ï¼šå°†æœåŠ¡å™¨ä¿¡æ¯è½¬æ¢ä¸ºç‰¹å®šé…ç½®æ ¼å¼
- **æ•°æ®éªŒè¯**ï¼šæ£€æŸ¥IPåœ°å€ã€åŸŸåç­‰æ ¼å¼åˆè§„æ€§
- **å­—ç¬¦ä¸²å¤„ç†**ï¼šä¼ä¸šå†…éƒ¨ç¼–ç è§„åˆ™ã€å‘½åè§„èŒƒ
- **å¤æ‚è®¡ç®—**ï¼šèµ„æºé…é¢è®¡ç®—ã€å®¹é‡è§„åˆ’

### 1.3 è¿‡æ»¤å™¨å·¥ä½œæœºåˆ¶


**âš¡ æ‰§è¡Œæµç¨‹**
```
æ•°æ®å¤„ç†ç®¡é“ï¼š
åŸå§‹æ•°æ® â†’ Jinja2å¼•æ“ â†’ è¿‡æ»¤å™¨å‡½æ•° â†’ å¤„ç†ç»“æœ

å…·ä½“æ‰§è¡Œï¼š
1. Ansibleè¯»å–å˜é‡æ•°æ®
2. Jinja2æ¨¡æ¿å¼•æ“è§£æè¿‡æ»¤å™¨è¯­æ³•  
3. è°ƒç”¨å¯¹åº”çš„Pythonå‡½æ•°
4. è¿”å›å¤„ç†åçš„ç»“æœ
5. ç»§ç»­åç»­çš„æ¨¡æ¿æ¸²æŸ“
```

---

## 2. ğŸ Pythonè¿‡æ»¤å™¨å¼€å‘


### 2.1 è¿‡æ»¤å™¨å‡½æ•°åŸºç¡€


**ğŸ“Œ è¿‡æ»¤å™¨å‡½æ•°è§„èŒƒ**
```python
# æœ€ç®€å•çš„è¿‡æ»¤å™¨å‡½æ•°
def my_filter(input_value):
    """
    è¿‡æ»¤å™¨å‡½æ•°å¿…é¡»ï¼š
    1. æ¥æ”¶è‡³å°‘ä¸€ä¸ªå‚æ•°ï¼ˆè¾“å…¥å€¼ï¼‰
    2. è¿”å›å¤„ç†åçš„ç»“æœ
    3. å¤„ç†å¼‚å¸¸æƒ…å†µ
    """
    if not input_value:
        return ""
    return str(input_value).upper()
```

**ğŸ”§ å¸¦å‚æ•°çš„è¿‡æ»¤å™¨**
```python
def truncate_string(input_value, length=10, suffix="..."):
    """
    æˆªæ–­å­—ç¬¦ä¸²è¿‡æ»¤å™¨
    ç”¨æ³•ï¼š{{ long_text | truncate_string(20, '...') }}
    """
    if not input_value:
        return ""
    
    text = str(input_value)
    if len(text) <= length:
        return text
    
    return text[:length] + suffix
```

### 2.2 è¿‡æ»¤å™¨å‡½æ•°æœ€ä½³å®è·µ


**âœ… ç¼–å†™è§„èŒƒ**
```python
def safe_filter_example(input_value, param1=None, param2="default"):
    """
    å®‰å…¨çš„è¿‡æ»¤å™¨ç¤ºä¾‹
    
    Args:
        input_value: è¾“å…¥æ•°æ®ï¼ˆå¿…éœ€ï¼‰
        param1: å¯é€‰å‚æ•°1
        param2: å¯é€‰å‚æ•°2ï¼Œé»˜è®¤å€¼
    
    Returns:
        å¤„ç†åçš„æ•°æ®
    """
    
    # 1. è¾“å…¥éªŒè¯
    if input_value is None:
        return ""
    
    # 2. ç±»å‹å¤„ç†
    try:
        if isinstance(input_value, (list, dict)):
            # å¤„ç†å¤æ‚æ•°æ®ç±»å‹
            pass
        else:
            # è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¤„ç†
            input_value = str(input_value)
    except Exception as e:
        # 3. å¼‚å¸¸å¤„ç†
        return f"è¿‡æ»¤å™¨å¤„ç†é”™è¯¯: {str(e)}"
    
    # 4. å®é™…å¤„ç†é€»è¾‘
    result = input_value  # æ›¿æ¢ä¸ºå®é™…å¤„ç†
    
    return result
```

### 2.3 å¸¸è§è¿‡æ»¤å™¨å¼€å‘æ¨¡å¼


**ğŸ¯ æ•°æ®è½¬æ¢æ¨¡å¼**
```python
def format_bytes(input_value, precision=2):
    """
    å­—èŠ‚æ•°æ ¼å¼åŒ–
    ç”¨æ³•ï¼š{{ file_size | format_bytes }}
    è¾“å‡ºï¼š1.23 GB
    """
    if not isinstance(input_value, (int, float)):
        try:
            input_value = float(input_value)
        except:
            return "Invalid size"
    
    units = ['B', 'KB', 'MB', 'GB', 'TB']
    size = float(input_value)
    
    for unit in units:
        if size < 1024.0:
            return f"{size:.{precision}f} {unit}"
        size /= 1024.0
    
    return f"{size:.{precision}f} PB"
```

**ğŸ” æ•°æ®éªŒè¯æ¨¡å¼**
```python
import re

def validate_ip(input_value):
    """
    IPåœ°å€éªŒè¯è¿‡æ»¤å™¨
    ç”¨æ³•ï¼š{% if server_ip | validate_ip %}
    """
    if not input_value:
        return False
    
    # IPv4æ­£åˆ™è¡¨è¾¾å¼
    ipv4_pattern = r'^(\d{1,3}\.){3}\d{1,3}$'
    
    if not re.match(ipv4_pattern, str(input_value)):
        return False
    
    # æ£€æŸ¥æ¯ä¸ªæ®µæ˜¯å¦åœ¨0-255èŒƒå›´å†…
    parts = str(input_value).split('.')
    return all(0 <= int(part) <= 255 for part in parts)
```

---

## 3. ğŸ”§ è¿‡æ»¤å™¨æ³¨å†Œä¸é…ç½®


### 3.1 è¿‡æ»¤å™¨æ–‡ä»¶ç»„ç»‡ç»“æ„


**ğŸ“ æ¨èç›®å½•ç»“æ„**
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ ansible.cfg              # Ansibleé…ç½®
â”œâ”€â”€ filter_plugins/          # è¿‡æ»¤å™¨æ’ä»¶ç›®å½•
â”‚   â”œâ”€â”€ __init__.py         # PythonåŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ string_filters.py   # å­—ç¬¦ä¸²å¤„ç†è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ data_filters.py     # æ•°æ®å¤„ç†è¿‡æ»¤å™¨
â”‚   â””â”€â”€ custom_filters.py   # è‡ªå®šä¹‰ä¸šåŠ¡è¿‡æ»¤å™¨
â”œâ”€â”€ playbooks/              # Playbookç›®å½•
â””â”€â”€ templates/              # æ¨¡æ¿ç›®å½•
```

### 3.2 è¿‡æ»¤å™¨ç±»å®šä¹‰


**ğŸ—ï¸ æ ‡å‡†è¿‡æ»¤å™¨ç±»**
```python
# filter_plugins/string_filters.py

class FilterModule(object):
    """
    Ansibleè¦æ±‚çš„è¿‡æ»¤å™¨æ¨¡å—ç±»
    ç±»åå¿…é¡»æ˜¯FilterModule
    """
    
    def filters(self):
        """
        è¿”å›è¿‡æ»¤å™¨å­—å…¸
        é”®ï¼šè¿‡æ»¤å™¨åç§°ï¼ˆåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨çš„åå­—ï¼‰
        å€¼ï¼šå¯¹åº”çš„Pythonå‡½æ•°
        """
        return {
            'format_bytes': self.format_bytes,
            'validate_ip': self.validate_ip,
            'truncate_string': self.truncate_string,
            'safe_filename': self.safe_filename,
        }
    
    def format_bytes(self, input_value, precision=2):
        """å­—èŠ‚æ ¼å¼åŒ–è¿‡æ»¤å™¨"""
        # å®ç°ä»£ç ...
        pass
    
    def validate_ip(self, input_value):
        """IPéªŒè¯è¿‡æ»¤å™¨"""
        # å®ç°ä»£ç ...
        pass
```

### 3.3 è¿‡æ»¤å™¨è‡ªåŠ¨åŠ è½½é…ç½®


**âš™ï¸ ansible.cfgé…ç½®**
```ini
[defaults]
# æŒ‡å®šè¿‡æ»¤å™¨æ’ä»¶ç›®å½•
filter_plugins = ./filter_plugins

# å¦‚æœæœ‰å¤šä¸ªç›®å½•ï¼Œç”¨å†’å·åˆ†éš”
# filter_plugins = ./filter_plugins:./shared_filters
```

> âš ï¸ **é‡è¦æé†’**  
> è¿‡æ»¤å™¨æ’ä»¶ç›®å½•å¿…é¡»åŒ…å«`__init__.py`æ–‡ä»¶ï¼Œå¦åˆ™Pythonæ— æ³•è¯†åˆ«ä¸ºåŒ…

**ğŸ“ åŸºç¡€__init__.pyå†…å®¹**
```python
# filter_plugins/__init__.py
"""
Ansibleè‡ªå®šä¹‰è¿‡æ»¤å™¨æ’ä»¶åŒ…
"""

# å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›åˆå§‹åŒ–å·¥ä½œ
# æ¯”å¦‚å¯¼å…¥é€šç”¨çš„å·¥å…·å‡½æ•°ç­‰
```

---

## 4. ğŸ“ å­—ç¬¦ä¸²å¤„ç†è¿‡æ»¤å™¨


### 4.1 æ–‡æœ¬æ ¼å¼åŒ–è¿‡æ»¤å™¨


**ğŸ”¤ å¸¸ç”¨å­—ç¬¦ä¸²å¤„ç†**
```python
class FilterModule(object):
    def filters(self):
        return {
            'snake_case': self.snake_case,
            'camel_case': self.camel_case,
            'title_case': self.title_case,
            'clean_string': self.clean_string,
        }
    
    def snake_case(self, input_value):
        """
        è½¬æ¢ä¸ºä¸‹åˆ’çº¿å‘½å
        ç”¨æ³•ï¼š{{ "HelloWorld" | snake_case }}
        è¾“å‡ºï¼šhello_world
        """
        import re
        if not input_value:
            return ""
        
        # åœ¨å¤§å†™å­—æ¯å‰æ’å…¥ä¸‹åˆ’çº¿
        s1 = re.sub('([a-z0-9])([A-Z])', r'\1_\2', str(input_value))
        # è½¬æ¢ä¸ºå°å†™
        return s1.lower()
    
    def camel_case(self, input_value):
        """
        è½¬æ¢ä¸ºé©¼å³°å‘½å
        ç”¨æ³•ï¼š{{ "hello_world" | camel_case }}
        è¾“å‡ºï¼šHelloWorld
        """
        if not input_value:
            return ""
        
        words = str(input_value).replace('-', '_').split('_')
        return ''.join(word.capitalize() for word in words)
    
    def clean_string(self, input_value, remove_chars=' \t\n\r'):
        """
        æ¸…ç†å­—ç¬¦ä¸²
        ç”¨æ³•ï¼š{{ messy_string | clean_string }}
        """
        if not input_value:
            return ""
        
        result = str(input_value)
        for char in remove_chars:
            result = result.replace(char, '')
        return result.strip()
```

### 4.2 æ–‡æœ¬å†…å®¹éªŒè¯


**âœ… å†…å®¹éªŒè¯è¿‡æ»¤å™¨**
```python
def validate_email(self, input_value):
    """
    é‚®ç®±æ ¼å¼éªŒè¯
    ç”¨æ³•ï¼š{% if email | validate_email %}
    """
    import re
    if not input_value:
        return False
    
    email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return bool(re.match(email_pattern, str(input_value)))

def validate_domain(self, input_value):
    """
    åŸŸåæ ¼å¼éªŒè¯
    ç”¨æ³•ï¼š{% if domain | validate_domain %}
    """
    import re
    if not input_value:
        return False
    
    # ç®€åŒ–çš„åŸŸåéªŒè¯
    domain_pattern = r'^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$'
    return bool(re.match(domain_pattern, str(input_value)))
```

---

## 5. ğŸ“‹ åˆ—è¡¨å­—å…¸è¿‡æ»¤å™¨


### 5.1 æ•°æ®ç»“æ„å¤„ç†


**ğŸ”¢ åˆ—è¡¨æ“ä½œè¿‡æ»¤å™¨**
```python
def unique_by_key(self, input_list, key):
    """
    æ ¹æ®æŒ‡å®šé”®å»é‡
    ç”¨æ³•ï¼š{{ servers | unique_by_key('ip') }}
    """
    if not isinstance(input_list, list):
        return []
    
    seen = set()
    result = []
    
    for item in input_list:
        if isinstance(item, dict) and key in item:
            if item[key] not in seen:
                seen.add(item[key])
                result.append(item)
        elif hasattr(item, key):
            attr_value = getattr(item, key)
            if attr_value not in seen:
                seen.add(attr_value)
                result.append(item)
    
    return result

def group_by_key(self, input_list, key):
    """
    æŒ‰é”®åˆ†ç»„
    ç”¨æ³•ï¼š{{ servers | group_by_key('environment') }}
    """
    if not isinstance(input_list, list):
        return {}
    
    result = {}
    for item in input_list:
        if isinstance(item, dict) and key in item:
            group_key = item[key]
            if group_key not in result:
                result[group_key] = []
            result[group_key].append(item)
    
    return result
```

### 5.2 å­—å…¸æ•°æ®å¤„ç†


**ğŸ“Š å­—å…¸æ“ä½œè¿‡æ»¤å™¨**
```python
def merge_dicts(self, dict1, dict2, deep=False):
    """
    å­—å…¸åˆå¹¶
    ç”¨æ³•ï¼š{{ config1 | merge_dicts(config2, true) }}
    """
    if not isinstance(dict1, dict):
        dict1 = {}
    if not isinstance(dict2, dict):
        return dict1
    
    if deep:
        # æ·±åº¦åˆå¹¶
        import copy
        result = copy.deepcopy(dict1)
        for key, value in dict2.items():
            if key in result and isinstance(result[key], dict) and isinstance(value, dict):
                result[key] = self.merge_dicts(result[key], value, deep=True)
            else:
                result[key] = value
        return result
    else:
        # æµ…åˆå¹¶
        result = dict1.copy()
        result.update(dict2)
        return result

def extract_keys(self, input_dict, keys):
    """
    æå–æŒ‡å®šé”®
    ç”¨æ³•ï¼š{{ server_info | extract_keys(['name', 'ip', 'port']) }}
    """
    if not isinstance(input_dict, dict):
        return {}
    
    if isinstance(keys, str):
        keys = [keys]
    
    return {k: input_dict[k] for k in keys if k in input_dict}
```

---

## 6. ğŸ”¢ æ•°å€¼ä¸æ—¥æœŸæ—¶é—´è¿‡æ»¤å™¨


### 6.1 æ•°å€¼è®¡ç®—è¿‡æ»¤å™¨


**âš¡ æ•°å­¦è¿ç®—è¿‡æ»¤å™¨**
```python
def calculate_percentage(self, value, total):
    """
    è®¡ç®—ç™¾åˆ†æ¯”
    ç”¨æ³•ï¼š{{ used_memory | calculate_percentage(total_memory) }}
    """
    try:
        value = float(value)
        total = float(total)
        if total == 0:
            return 0
        return round((value / total) * 100, 2)
    except (ValueError, TypeError):
        return 0

def human_readable_size(self, bytes_value):
    """
    äººæ€§åŒ–å¤§å°æ˜¾ç¤º
    ç”¨æ³•ï¼š{{ file_size | human_readable_size }}
    """
    try:
        bytes_value = float(bytes_value)
    except (ValueError, TypeError):
        return "0 B"
    
    for unit in ['B', 'KB', 'MB', 'GB', 'TB']:
        if bytes_value < 1024.0:
            return f"{bytes_value:.1f} {unit}"
        bytes_value /= 1024.0
    return f"{bytes_value:.1f} PB"
```

### 6.2 æ—¥æœŸæ—¶é—´å¤„ç†


**ğŸ“… æ—¶é—´æ ¼å¼åŒ–è¿‡æ»¤å™¨**
```python
def format_timestamp(self, timestamp, format_string='%Y-%m-%d %H:%M:%S'):
    """
    æ—¶é—´æˆ³æ ¼å¼åŒ–
    ç”¨æ³•ï¼š{{ deploy_time | format_timestamp('%Y-%m-%d') }}
    """
    import datetime
    
    try:
        if isinstance(timestamp, str):
            timestamp = float(timestamp)
        
        dt = datetime.datetime.fromtimestamp(timestamp)
        return dt.strftime(format_string)
    except (ValueError, TypeError, OSError):
        return "Invalid timestamp"

def time_ago(self, timestamp):
    """
    ç›¸å¯¹æ—¶é—´æ˜¾ç¤º
    ç”¨æ³•ï¼š{{ last_backup | time_ago }}
    è¾“å‡ºï¼š2å°æ—¶å‰
    """
    import datetime
    
    try:
        if isinstance(timestamp, str):
            timestamp = float(timestamp)
        
        now = datetime.datetime.now()
        past = datetime.datetime.fromtimestamp(timestamp)
        diff = now - past
        
        seconds = diff.total_seconds()
        
        if seconds < 60:
            return "åˆšåˆš"
        elif seconds < 3600:
            minutes = int(seconds / 60)
            return f"{minutes}åˆ†é’Ÿå‰"
        elif seconds < 86400:
            hours = int(seconds / 3600)
            return f"{hours}å°æ—¶å‰"
        else:
            days = int(seconds / 86400)
            return f"{days}å¤©å‰"
            
    except (ValueError, TypeError, OSError):
        return "æœªçŸ¥æ—¶é—´"
```

---

## 7. ğŸ“ æ–‡ä»¶è·¯å¾„è¿‡æ»¤å™¨


### 7.1 è·¯å¾„å¤„ç†è¿‡æ»¤å™¨


**ğŸ›¤ï¸ æ–‡ä»¶ç³»ç»Ÿæ“ä½œ**
```python
def safe_filename(self, input_value):
    """
    ç”Ÿæˆå®‰å…¨çš„æ–‡ä»¶å
    ç”¨æ³•ï¼š{{ user_input | safe_filename }}
    """
    import re
    if not input_value:
        return "unnamed"
    
    # ç§»é™¤æˆ–æ›¿æ¢ä¸å®‰å…¨å­—ç¬¦
    safe_name = re.sub(r'[<>:"/\\|?*]', '_', str(input_value))
    # ç§»é™¤å¤šä½™ç©ºæ ¼
    safe_name = re.sub(r'\s+', '_', safe_name)
    # ç§»é™¤é¦–å°¾çš„ç‚¹å’Œç©ºæ ¼
    safe_name = safe_name.strip('. ')
    
    # ç¡®ä¿ä¸ä¸ºç©º
    return safe_name if safe_name else "unnamed"

def join_path(self, *paths):
    """
    è·¯å¾„æ‹¼æ¥
    ç”¨æ³•ï¼š{{ base_dir | join_path('logs', 'app.log') }}
    """
    import os
    if not paths:
        return ""
    
    # è¿‡æ»¤ç©ºå€¼
    valid_paths = [str(p) for p in paths if p]
    if not valid_paths:
        return ""
    
    return os.path.join(*valid_paths)

def get_file_extension(self, filepath):
    """
    è·å–æ–‡ä»¶æ‰©å±•å
    ç”¨æ³•ï¼š{{ filename | get_file_extension }}
    """
    import os
    if not filepath:
        return ""
    
    _, ext = os.path.splitext(str(filepath))
    return ext.lower()
```

### 7.2 è·¯å¾„éªŒè¯è¿‡æ»¤å™¨


**âœ… è·¯å¾„å®‰å…¨æ£€æŸ¥**
```python
def is_safe_path(self, filepath, base_path=None):
    """
    æ£€æŸ¥è·¯å¾„å®‰å…¨æ€§
    ç”¨æ³•ï¼š{% if user_path | is_safe_path(base_dir) %}
    """
    import os
    if not filepath:
        return False
    
    try:
        # è§„èŒƒåŒ–è·¯å¾„
        normalized_path = os.path.normpath(str(filepath))
        
        # æ£€æŸ¥æ˜¯å¦åŒ…å«å±é™©çš„è·¯å¾„éå†
        if '..' in normalized_path:
            return False
        
        # å¦‚æœæŒ‡å®šäº†åŸºç¡€è·¯å¾„ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
        if base_path:
            base_path = os.path.normpath(str(base_path))
            if not normalized_path.startswith(base_path):
                return False
        
        return True
    except:
        return False
```

---

## 8. ğŸ” è¿‡æ»¤å™¨æµ‹è¯•ä¸è°ƒè¯•


### 8.1 è¿‡æ»¤å™¨å•å…ƒæµ‹è¯•


**ğŸ§ª æµ‹è¯•æ¡†æ¶æ­å»º**
```python
# tests/test_filters.py
import unittest
import sys
import os

# æ·»åŠ è¿‡æ»¤å™¨è·¯å¾„
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'filter_plugins'))

from string_filters import FilterModule

class TestStringFilters(unittest.TestCase):
    def setUp(self):
        """æµ‹è¯•åˆå§‹åŒ–"""
        self.filter_module = FilterModule()
        self.filters = self.filter_module.filters()
    
    def test_snake_case(self):
        """æµ‹è¯•snake_caseè¿‡æ»¤å™¨"""
        snake_case = self.filters['snake_case']
        
        # æµ‹è¯•ç”¨ä¾‹
        test_cases = [
            ('HelloWorld', 'hello_world'),
            ('XMLParser', 'xml_parser'),
            ('getUserId', 'get_user_id'),
            ('', ''),
            (None, ''),
        ]
        
        for input_val, expected in test_cases:
            with self.subTest(input=input_val):
                result = snake_case(input_val)
                self.assertEqual(result, expected)
    
    def test_validate_email(self):
        """æµ‹è¯•é‚®ç®±éªŒè¯è¿‡æ»¤å™¨"""
        validate_email = self.filters['validate_email']
        
        valid_emails = [
            'user@example.com',
            'test.email@domain.org',
            'admin+tag@company.co.uk'
        ]
        
        invalid_emails = [
            'invalid-email',
            '@domain.com',
            'user@',
            '',
            None
        ]
        
        for email in valid_emails:
            with self.subTest(email=email):
                self.assertTrue(validate_email(email))
        
        for email in invalid_emails:
            with self.subTest(email=email):
                self.assertFalse(validate_email(email))

if __name__ == '__main__':
    unittest.main()
```

### 8.2 è°ƒè¯•æŠ€å·§


**ğŸ”§ è°ƒè¯•æ–¹æ³•**
```python
def debug_filter(self, input_value, debug_info="Debug"):
    """
    è°ƒè¯•è¿‡æ»¤å™¨
    ç”¨æ³•ï¼š{{ complex_data | debug_filter("æ£€æŸ¥ç‚¹1") }}
    """
    import json
    
    debug_output = {
        'debug_info': debug_info,
        'input_type': type(input_value).__name__,
        'input_value': input_value,
        'input_length': len(str(input_value)) if input_value else 0
    }
    
    # åœ¨Ansibleä¸­æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
    print(f"[DEBUG] {json.dumps(debug_output, indent=2)}")
    
    # è¿”å›åŸå€¼ï¼Œä¸å½±å“åç»­å¤„ç†
    return input_value
```

**ğŸ“Š æ€§èƒ½ç›‘æ§**
```python
def performance_filter(self, input_value, operation_name="filter"):
    """
    æ€§èƒ½ç›‘æ§è¿‡æ»¤å™¨
    """
    import time
    import functools
    
    def timer_decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            start_time = time.time()
            result = func(*args, **kwargs)
            end_time = time.time()
            
            execution_time = end_time - start_time
            print(f"[PERF] {operation_name}: {execution_time:.4f}ç§’")
            
            return result
        return wrapper
    
    # è¿™é‡Œæ˜¯ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦åŒ…è£…å…·ä½“çš„å¤„ç†å‡½æ•°
    return input_value
```

---

## 9. ğŸ’¼ ä¼ä¸šåº”ç”¨åœºæ™¯å®è·µ


### 9.1 é…ç½®æ–‡ä»¶ç”Ÿæˆåœºæ™¯


**âš™ï¸ Nginxé…ç½®ç”Ÿæˆå™¨**
```python
def generate_nginx_upstream(self, servers, upstream_name="backend"):
    """
    ç”ŸæˆNginx upstreamé…ç½®
    ç”¨æ³•ï¼š{{ web_servers | generate_nginx_upstream('web_backend') }}
    """
    if not isinstance(servers, list) or not servers:
        return ""
    
    lines = [f"upstream {upstream_name} {{"]
    
    for server in servers:
        if isinstance(server, dict):
            ip = server.get('ip', '')
            port = server.get('port', 80)
            weight = server.get('weight', 1)
            
            if ip:
                line = f"    server {ip}:{port}"
                if weight != 1:
                    line += f" weight={weight}"
                lines.append(line + ";")
    
    lines.append("}")
    return "\n".join(lines)

def generate_hosts_entries(self, servers):
    """
    ç”Ÿæˆhostsæ–‡ä»¶æ¡ç›®
    ç”¨æ³•ï¼š{{ inventory_hosts | generate_hosts_entries }}
    """
    if not isinstance(servers, list):
        return ""
    
    entries = []
    for server in servers:
        if isinstance(server, dict):
            ip = server.get('ip', '')
            hostname = server.get('hostname', '')
            aliases = server.get('aliases', [])
            
            if ip and hostname:
                line = f"{ip}\t{hostname}"
                if aliases:
                    line += " " + " ".join(aliases)
                entries.append(line)
    
    return "\n".join(entries)
```

### 9.2 æ•°æ®è½¬æ¢åœºæ™¯


**ğŸ“ˆ ç›‘æ§æ•°æ®å¤„ç†**
```python
def calculate_resource_usage(self, servers):
    """
    è®¡ç®—èµ„æºä½¿ç”¨ç‡æ±‡æ€»
    ç”¨æ³•ï¼š{{ server_metrics | calculate_resource_usage }}
    """
    if not isinstance(servers, list):
        return {}
    
    total_cpu = 0
    total_memory = 0
    total_disk = 0
    server_count = 0
    
    for server in servers:
        if isinstance(server, dict):
            cpu = server.get('cpu_usage', 0)
            memory = server.get('memory_usage', 0)
            disk = server.get('disk_usage', 0)
            
            try:
                total_cpu += float(cpu)
                total_memory += float(memory)
                total_disk += float(disk)
                server_count += 1
            except (ValueError, TypeError):
                continue
    
    if server_count == 0:
        return {}
    
    return {
        'average_cpu': round(total_cpu / server_count, 2),
        'average_memory': round(total_memory / server_count, 2),
        'average_disk': round(total_disk / server_count, 2),
        'total_servers': server_count
    }
```

### 9.3 å®‰å…¨åˆè§„åœºæ™¯


**ğŸ”’ æ•°æ®è„±æ•è¿‡æ»¤å™¨**
```python
def mask_sensitive_data(self, input_value, mask_type="email"):
    """
    æ•æ„Ÿæ•°æ®è„±æ•
    ç”¨æ³•ï¼š{{ user_email | mask_sensitive_data('email') }}
    """
    if not input_value:
        return ""
    
    text = str(input_value)
    
    if mask_type == "email":
        # é‚®ç®±è„±æ•ï¼šus**@ex***.com
        import re
        pattern = r'([a-zA-Z0-9._%+-]{1,2})[a-zA-Z0-9._%+-]*@([a-zA-Z0-9.-]{1,3})[a-zA-Z0-9.-]*(\.[a-zA-Z]{2,})'
        return re.sub(pattern, r'\1**@\2***\3', text)
    
    elif mask_type == "phone":
        # æ‰‹æœºå·è„±æ•ï¼š138****1234
        if len(text) == 11:
            return text[:3] + "****" + text[-4:]
    
    elif mask_type == "ip":
        # IPåœ°å€è„±æ•ï¼š192.168.*.* 
        parts = text.split('.')
        if len(parts) == 4:
            return f"{parts[0]}.{parts[1]}.*.*"
    
    return text

def audit_log_format(self, action_data):
    """
    æ“ä½œå®¡è®¡æ—¥å¿—æ ¼å¼åŒ–
    ç”¨æ³•ï¼š{{ ansible_action | audit_log_format }}
    """
    import datetime
    
    if not isinstance(action_data, dict):
        return ""
    
    timestamp = datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    user = action_data.get('user', 'unknown')
    action = action_data.get('action', 'unknown')
    target = action_data.get('target', 'unknown')
    result = action_data.get('result', 'unknown')
    
    return f"[{timestamp}] User:{user} Action:{action} Target:{target} Result:{result}"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ è¿‡æ»¤å™¨æœ¬è´¨ï¼šæ•°æ®è½¬æ¢çš„Pythonå‡½æ•°ï¼Œåœ¨Jinja2æ¨¡æ¿ä¸­è°ƒç”¨
ğŸ”§ å¼€å‘è§„èŒƒï¼šFilterModuleç±»ï¼Œfilters()æ–¹æ³•è¿”å›è¿‡æ»¤å™¨å­—å…¸  
ğŸ“ æ–‡ä»¶ç»„ç»‡ï¼šfilter_pluginsç›®å½•ï¼ŒåŒ…å«__init__.pyæ–‡ä»¶
âœ… æœ€ä½³å®è·µï¼šè¾“å…¥éªŒè¯ã€å¼‚å¸¸å¤„ç†ã€ç±»å‹è½¬æ¢ã€è¿”å›å®‰å…¨å€¼
ğŸ§ª è´¨é‡ä¿éšœï¼šå•å…ƒæµ‹è¯•ã€è°ƒè¯•å·¥å…·ã€æ€§èƒ½ç›‘æ§
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¿‡æ»¤å™¨è®¾è®¡åŸåˆ™**
```
å•ä¸€èŒè´£ï¼šæ¯ä¸ªè¿‡æ»¤å™¨åªåšä¸€ä»¶äº‹æƒ…
æ•°æ®å®‰å…¨ï¼šéªŒè¯è¾“å…¥ï¼Œå¤„ç†å¼‚å¸¸æƒ…å†µ  
æ€§èƒ½è€ƒè™‘ï¼šé¿å…å¤æ‚è®¡ç®—ï¼Œç¼“å­˜é‡å¤æ“ä½œ
å¯æµ‹è¯•æ€§ï¼šå‡½æ•°çº¯å‡€ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
å¯ç»´æŠ¤æ€§ï¼šä»£ç æ¸…æ™°ï¼Œæ³¨é‡Šå®Œæ•´
```

**ğŸ”¹ å¸¸è§ä½¿ç”¨æ¨¡å¼**
```
æ•°æ®è½¬æ¢ï¼šæ ¼å¼åŒ–ã€ç±»å‹è½¬æ¢ã€ç¼–ç è½¬æ¢
æ•°æ®éªŒè¯ï¼šæ ¼å¼æ£€æŸ¥ã€è§„åˆ™éªŒè¯ã€å®‰å…¨æ£€æŸ¥
æ•°æ®è®¡ç®—ï¼šæ•°å­¦è¿ç®—ã€ç»Ÿè®¡åˆ†æã€èšåˆè®¡ç®—
æ•°æ®æå–ï¼šç­›é€‰è¿‡æ»¤ã€å­—æ®µæå–ã€æ¡ä»¶æŸ¥è¯¢
é…ç½®ç”Ÿæˆï¼šæ¨¡æ¿å¡«å……ã€æ ¼å¼é€‚é…ã€è§„åˆ™åº”ç”¨
```

### 10.3 ä¼ä¸šåº”ç”¨ä»·å€¼


**ğŸ’¼ å®é™…ä¸šåŠ¡åœºæ™¯**
- **é…ç½®ç®¡ç†**ï¼šæ ‡å‡†åŒ–é…ç½®æ–‡ä»¶ç”Ÿæˆï¼Œå‡å°‘æ‰‹åŠ¨é”™è¯¯
- **æ•°æ®å¤„ç†**ï¼šæ‰¹é‡æ•°æ®è½¬æ¢ï¼Œæé«˜è¿ç»´æ•ˆç‡
- **å®‰å…¨åˆè§„**ï¼šæ•æ„Ÿæ•°æ®è„±æ•ï¼Œæ»¡è¶³åˆè§„è¦æ±‚  
- **ç›‘æ§å‘Šè­¦**ï¼šæ•°æ®æ ¼å¼åŒ–ï¼Œä¾¿äºç›‘æ§ç³»ç»Ÿé›†æˆ
- **æ–‡æ¡£ç”Ÿæˆ**ï¼šè‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆï¼Œä¿æŒä¿¡æ¯åŒæ­¥

**ğŸš€ å¼€å‘å»ºè®®**
```
æ¸è¿›å¼€å‘ï¼šä»ç®€å•è¿‡æ»¤å™¨å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚åŠŸèƒ½
æ¨¡å—åŒ–è®¾è®¡ï¼šæŒ‰åŠŸèƒ½åˆ†ç±»ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨
æµ‹è¯•é©±åŠ¨ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œä¿è¯ä»£ç è´¨é‡
æ–‡æ¡£å®Œå–„ï¼šè¯¦ç»†çš„æ³¨é‡Šå’Œä½¿ç”¨è¯´æ˜
ç‰ˆæœ¬ç®¡ç†ï¼šä½¿ç”¨Gitç®¡ç†è¿‡æ»¤å™¨ä»£ç ç‰ˆæœ¬
```

### 10.4 å­¦ä¹ è·¯çº¿è§„åˆ’


**ğŸ“š å»ºè®®å­¦ä¹ é¡ºåº**
```
ç¬¬1é˜¶æ®µï¼šç†è§£è¿‡æ»¤å™¨æ¦‚å¿µå’ŒåŸºæœ¬ç”¨æ³•
ç¬¬2é˜¶æ®µï¼šæŒæ¡Pythonå‡½æ•°å¼€å‘å’Œæ³¨å†Œé…ç½®  
ç¬¬3é˜¶æ®µï¼šå®ç°å¸¸ç”¨çš„å­—ç¬¦ä¸²å’Œæ•°æ®å¤„ç†è¿‡æ»¤å™¨
ç¬¬4é˜¶æ®µï¼šå¼€å‘ä¼ä¸šç‰¹å®šçš„ä¸šåŠ¡è¿‡æ»¤å™¨
ç¬¬5é˜¶æ®µï¼šå»ºç«‹æµ‹è¯•ä½“ç³»å’Œæ€§èƒ½ä¼˜åŒ–
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**
```
è¿‡æ»¤ç®¡é“æ•°æ®æµï¼ŒPythonå‡½æ•°æ¥åŠ å·¥
FilterModuleæ˜¯è§„èŒƒï¼Œfilterså­—å…¸è¦è¿”å›  
è¾“å…¥éªŒè¯é˜²å¼‚å¸¸ï¼Œç±»å‹è½¬æ¢ä¿å®‰å…¨
å•å…ƒæµ‹è¯•ä¿è´¨é‡ï¼Œä¼ä¸šåœºæ™¯æ˜¾ä»·å€¼
```

**æ ¸å¿ƒç†è§£**ï¼š
- Ansibleè‡ªå®šä¹‰è¿‡æ»¤å™¨æ˜¯æ‰©å±•æ•°æ®å¤„ç†èƒ½åŠ›çš„é‡è¦å·¥å…·
- é€šè¿‡Pythonç¼–ç¨‹å®ç°å¤æ‚çš„æ•°æ®è½¬æ¢å’Œä¸šåŠ¡é€»è¾‘
- éµå¾ªå¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
- ç»“åˆä¼ä¸šå®é™…éœ€æ±‚ï¼Œå¼€å‘æœ‰ä»·å€¼çš„ä¸šåŠ¡è¿‡æ»¤å™¨