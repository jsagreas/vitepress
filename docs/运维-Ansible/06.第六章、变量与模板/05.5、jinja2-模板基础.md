---
title: 5ã€jinja2-æ¨¡æ¿åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [Jinja2æ¨¡æ¿å¼•æ“æ¦‚è¿°](#1-Jinja2æ¨¡æ¿å¼•æ“æ¦‚è¿°)
2. [å˜é‡æ’å€¼ä¸è¡¨è¾¾å¼](#2-å˜é‡æ’å€¼ä¸è¡¨è¾¾å¼)
3. [æ§åˆ¶ç»“æ„è¯¦è§£](#3-æ§åˆ¶ç»“æ„è¯¦è§£)
4. [æ¨¡æ¿æ–‡ä»¶ç»„ç»‡ä¸ç®¡ç†](#4-æ¨¡æ¿æ–‡ä»¶ç»„ç»‡ä¸ç®¡ç†)
5. [templateæ¨¡å—å®æˆ˜](#5-templateæ¨¡å—å®æˆ˜)
6. [æ¨¡æ¿æµ‹è¯•ä¸è°ƒè¯•](#6-æ¨¡æ¿æµ‹è¯•ä¸è°ƒè¯•)
7. [æœ€ä½³å®è·µæŒ‡å—](#7-æœ€ä½³å®è·µæŒ‡å—)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Jinja2æ¨¡æ¿å¼•æ“æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Jinja2æ¨¡æ¿


**é€šä¿—ç†è§£**ï¼š
Jinja2å°±åƒæ˜¯ä¸€ä¸ªæ™ºèƒ½çš„æ–‡æœ¬æ›¿æ¢å·¥å…·ã€‚æƒ³è±¡ä½ æœ‰ä¸€ä»½åˆåŒæ¨¡æ¿ï¼Œé‡Œé¢æœ‰å¾ˆå¤šç©ºç™½éœ€è¦å¡«å†™å§“åã€æ—¥æœŸã€é‡‘é¢ç­‰ä¿¡æ¯ã€‚Jinja2å°±æ˜¯å¸®ä½ è‡ªåŠ¨å¡«å†™è¿™äº›ç©ºç™½çš„å·¥å…·ï¼Œè€Œä¸”å®ƒè¿˜èƒ½æ ¹æ®ä¸åŒæ¡ä»¶ç”Ÿæˆä¸åŒçš„å†…å®¹ã€‚

```
æ™®é€šæ–‡æœ¬æ–‡ä»¶ï¼š        Jinja2æ¨¡æ¿æ–‡ä»¶ï¼š
Welcome John         Welcome {{ username }}
Today is Monday      Today is {{ ansible_date_time.weekday }}
```

### 1.2 ä¸ºä»€ä¹ˆAnsibleä½¿ç”¨Jinja2


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

ğŸ”¸ **åŠ¨æ€é…ç½®ç”Ÿæˆ**
- æ ¹æ®ä¸åŒæœåŠ¡å™¨ç”Ÿæˆä¸åŒçš„é…ç½®æ–‡ä»¶
- åŒä¸€ä¸ªæ¨¡æ¿é€‚ç”¨äºå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ

ğŸ”¸ **å‡å°‘é‡å¤å·¥ä½œ**
- ä¸€ä»½æ¨¡æ¿å¯ä»¥ç”Ÿæˆå¤šä»½é…ç½®
- é¿å…æ‰‹å·¥ç»´æŠ¤å¤§é‡ç›¸ä¼¼æ–‡ä»¶

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
æ•°æ®åº“é…ç½®æ¨¡æ¿ï¼š
- å¼€å‘ç¯å¢ƒï¼šè¿æ¥æ± 5ä¸ªï¼Œæ—¥å¿—çº§åˆ«DEBUG
- ç”Ÿäº§ç¯å¢ƒï¼šè¿æ¥æ± 50ä¸ªï¼Œæ—¥å¿—çº§åˆ«ERROR
ä½¿ç”¨åŒä¸€ä¸ªæ¨¡æ¿ï¼Œæ ¹æ®ç¯å¢ƒå˜é‡è‡ªåŠ¨è°ƒæ•´
```

### 1.3 Jinja2çš„æ ¸å¿ƒè¯­æ³•ç¬¦å·


**è¯­æ³•ç¬¦å·é€Ÿè§ˆ**ï¼š

| ç¬¦å· | ç”¨é€” | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|------|
| `{{ }}` | å˜é‡è¾“å‡º | `{{ hostname }}` | æ˜¾ç¤ºå˜é‡å€¼ |
| `{% %}` | æ§åˆ¶è¯­å¥ | `{% if condition %}` | é€»è¾‘æ§åˆ¶ |
| `{# #}` | æ³¨é‡Š | `{# è¿™æ˜¯æ³¨é‡Š #}` | ä¸ä¼šè¾“å‡º |

**è®°å¿†æŠ€å·§**ï¼š
- `{{ }}` åŒèŠ±æ‹¬å· = æ˜¾ç¤ºå†…å®¹
- `{% %}` ç™¾åˆ†å· = æ‰§è¡Œé€»è¾‘  
- `{# #}` äº•å· = éšè—æ³¨é‡Š

---

## 2. ğŸ“ å˜é‡æ’å€¼ä¸è¡¨è¾¾å¼


### 2.1 åŸºæœ¬å˜é‡æ’å€¼


**æœ€ç®€å•çš„ç”¨æ³•**ï¼š
æŠŠå˜é‡çš„å€¼æ’å…¥åˆ°æ¨¡æ¿ä¸­

```jinja2
{# åŸºæœ¬å˜é‡æ’å€¼ç¤ºä¾‹ #}
æœåŠ¡å™¨åç§°ï¼š{{ inventory_hostname }}
IPåœ°å€ï¼š{{ ansible_default_ipv4.address }}
æ“ä½œç³»ç»Ÿï¼š{{ ansible_distribution }}
```

**ç”Ÿæˆç»“æœ**ï¼š
```
æœåŠ¡å™¨åç§°ï¼šweb-server-01
IPåœ°å€ï¼š192.168.1.100
æ“ä½œç³»ç»Ÿï¼šCentOS
```

### 2.2 è®¿é—®å¤æ‚æ•°æ®ç»“æ„


**å­—å…¸(Dict)è®¿é—®æ–¹å¼**ï¼š

```jinja2
{# ä¸¤ç§è®¿é—®æ–¹å¼éƒ½å¯ä»¥ #}
ç‚¹å·è®¿é—®ï¼š{{ user.name }}
æ–¹æ‹¬å·è®¿é—®ï¼š{{ user['name'] }}

{# è®¿é—®ç³»ç»Ÿä¿¡æ¯ #}
å†…å­˜æ€»é‡ï¼š{{ ansible_memory_mb.real.total }} MB
CPUæ ¸æ•°ï¼š{{ ansible_processor_cores }}
```

**åˆ—è¡¨(List)è®¿é—®æ–¹å¼**ï¼š

```jinja2
{# è®¿é—®åˆ—è¡¨å…ƒç´  #}
ç¬¬ä¸€ä¸ªç½‘å¡ï¼š{{ ansible_interfaces[0] }}
æœ€åä¸€ä¸ªç½‘å¡ï¼š{{ ansible_interfaces[-1] }}

{# è·å–åˆ—è¡¨é•¿åº¦ #}
ç½‘å¡æ€»æ•°ï¼š{{ ansible_interfaces | length }}
```

### 2.3 è¡¨è¾¾å¼è¿ç®—


**æ•°å­¦è¿ç®—**ï¼š
```jinja2
æ€»å†…å­˜ï¼š{{ ansible_memory_mb.real.total }}MB
å¯ç”¨å†…å­˜ï¼š{{ ansible_memory_mb.real.free }}MB
ä½¿ç”¨ç‡ï¼š{{ ((ansible_memory_mb.real.total - ansible_memory_mb.real.free) / ansible_memory_mb.real.total * 100) | round(2) }}%
```

**å­—ç¬¦ä¸²æ“ä½œ**ï¼š
```jinja2
{# å­—ç¬¦ä¸²è¿æ¥ #}
å®Œæ•´ä¸»æœºåï¼š{{ inventory_hostname + '.' + domain_name }}

{# å­—ç¬¦ä¸²æ ¼å¼åŒ– #}
æ—¥å¿—è·¯å¾„ï¼š{{ "/var/log/%s.log" | format(service_name) }}
```

### 2.4 è¿‡æ»¤å™¨ä½¿ç”¨


**å¸¸ç”¨è¿‡æ»¤å™¨ç¤ºä¾‹**ï¼š

```jinja2
{# æ–‡æœ¬å¤„ç† #}
å¤§å†™ï¼š{{ hostname | upper }}
å°å†™ï¼š{{ hostname | lower }}
é¦–å­—æ¯å¤§å†™ï¼š{{ hostname | title }}

{# æ•°å­—å¤„ç† #}
å››èˆäº”å…¥ï¼š{{ 3.14159 | round(2) }}
é»˜è®¤å€¼ï¼š{{ undefined_var | default('é»˜è®¤å€¼') }}

{# åˆ—è¡¨å¤„ç† #}
æ’åºï¼š{{ server_list | sort }}
å»é‡ï¼š{{ server_list | unique }}
è¿æ¥ï¼š{{ server_list | join(',') }}
```

**ğŸ’¡ è¿‡æ»¤å™¨è®°å¿†æŠ€å·§**ï¼š
è¿‡æ»¤å™¨å°±åƒæ°´ç®¡ä¸­çš„è¿‡æ»¤ç½‘ï¼Œæ•°æ®ä»å·¦è¾¹è¿›å»ï¼Œç»è¿‡å¤„ç†åä»å³è¾¹å‡ºæ¥ã€‚

---

## 3. ğŸ”§ æ§åˆ¶ç»“æ„è¯¦è§£


### 3.1 æ¡ä»¶è¯­å¥ - if/elif/else


**åŸºæœ¬è¯­æ³•ç»“æ„**ï¼š
```jinja2
{% if æ¡ä»¶ %}
  å†…å®¹1
{% elif å…¶ä»–æ¡ä»¶ %}
  å†…å®¹2  
{% else %}
  å†…å®¹3
{% endif %}
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```jinja2
{# æ ¹æ®ç¯å¢ƒç”Ÿæˆä¸åŒé…ç½® #}
{% if env == 'production' %}
# ç”Ÿäº§ç¯å¢ƒé…ç½®
log_level=ERROR
max_connections=1000
{% elif env == 'development' %}
# å¼€å‘ç¯å¢ƒé…ç½®  
log_level=DEBUG
max_connections=10
{% else %}
# æµ‹è¯•ç¯å¢ƒé…ç½®
log_level=INFO
max_connections=100
{% endif %}
```

**æ¡ä»¶è¡¨è¾¾å¼æŠ€å·§**ï¼š

```jinja2
{# æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨ #}
{% if database_host is defined %}
database_host={{ database_host }}
{% endif %}

{# æ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©º #}
{% if server_list %}
æœåŠ¡å™¨åˆ—è¡¨ä¸ä¸ºç©º
{% endif %}

{# å¤æ‚æ¡ä»¶ç»„åˆ #}
{% if ansible_memory_mb.real.total > 4096 and ansible_processor_cores >= 4 %}
# é«˜é…ç½®æœåŠ¡å™¨è®¾ç½®
{% endif %}
```

### 3.2 å¾ªç¯è¯­å¥ - forå¾ªç¯


**åŸºæœ¬å¾ªç¯è¯­æ³•**ï¼š
```jinja2
{% for é¡¹ç›® in åˆ—è¡¨ %}
  å¤„ç†æ¯ä¸ªé¡¹ç›®
{% endfor %}
```

**åˆ—è¡¨å¾ªç¯ç¤ºä¾‹**ï¼š

```jinja2
{# ç”Ÿæˆç”¨æˆ·é…ç½® #}
{% for user in users %}
[user_{{ loop.index }}]
name={{ user.name }}
email={{ user.email }}
role={{ user.role | default('user') }}

{% endfor %}
```

**å­—å…¸å¾ªç¯ç¤ºä¾‹**ï¼š

```jinja2
{# ç”Ÿæˆç¯å¢ƒå˜é‡ #}
{% for key, value in environment_vars.items() %}
export {{ key }}="{{ value }}"
{% endfor %}
```

**å¾ªç¯æ§åˆ¶å˜é‡**ï¼š

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `loop.index` | å½“å‰ç´¢å¼•(ä»1å¼€å§‹) | ç¬¬{{ loop.index }}é¡¹ |
| `loop.index0` | å½“å‰ç´¢å¼•(ä»0å¼€å§‹) | ç´¢å¼•{{ loop.index0 }} |
| `loop.first` | æ˜¯å¦ç¬¬ä¸€é¡¹ | {% if loop.first %}é¦–é¡¹{% endif %} |
| `loop.last` | æ˜¯å¦æœ€åä¸€é¡¹ | {% if loop.last %}æœ«é¡¹{% endif %} |
| `loop.length` | æ€»é¡¹ç›®æ•° | å…±{{ loop.length }}é¡¹ |

### 3.3 å¾ªç¯é«˜çº§ç”¨æ³•


**æ¡ä»¶å¾ªç¯**ï¼š
```jinja2
{# åªå¤„ç†æ¿€æ´»çš„ç”¨æˆ· #}
{% for user in users if user.status == 'active' %}
æ¿€æ´»ç”¨æˆ·ï¼š{{ user.name }}
{% endfor %}
```

**åµŒå¥—å¾ªç¯**ï¼š
```jinja2
{# ç”Ÿæˆä¸»æœºç»„é…ç½® #}
{% for group in host_groups %}
[{{ group.name }}]
{% for host in group.hosts %}
{{ host.name }} ansible_host={{ host.ip }}
{% endfor %}

{% endfor %}
```

---

## 4. ğŸ“ æ¨¡æ¿æ–‡ä»¶ç»„ç»‡ä¸ç®¡ç†


### 4.1 æ¨¡æ¿æ–‡ä»¶ç»“æ„è§„èŒƒ


**æ ‡å‡†ç›®å½•ç»“æ„**ï¼š
```
project/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â”œâ”€â”€ nginx.conf.j2          # ä¸»é…ç½®æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ vhost.conf.j2          # è™šæ‹Ÿä¸»æœºæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ ssl.conf.j2            # SSLé…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ mysql/
â”‚   â”‚   â”œâ”€â”€ my.cnf.j2              # MySQLé…ç½®æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ backup.sh.j2           # å¤‡ä»½è„šæœ¬æ¨¡æ¿
â”‚   â””â”€â”€ common/
â”‚       â”œâ”€â”€ hosts.j2               # ä¸»æœºæ–‡ä»¶æ¨¡æ¿
â”‚       â””â”€â”€ resolv.conf.j2         # DNSé…ç½®æ¨¡æ¿
```

**ğŸ’¡ ç»„ç»‡åŸåˆ™**ï¼š
- æŒ‰æœåŠ¡åˆ†ç›®å½•å­˜æ”¾
- ä½¿ç”¨`.j2`æ‰©å±•åæ ‡è¯†æ¨¡æ¿æ–‡ä»¶
- å¤æ‚æ¨¡æ¿å¯ä»¥æ‹†åˆ†æˆå¤šä¸ªå°æ¨¡æ¿

### 4.2 æ¨¡æ¿ç»§æ‰¿ä¸åŒ…å«


**æ¨¡æ¿åŒ…å«**ï¼š
æŠŠé€šç”¨éƒ¨åˆ†æå–æˆç‹¬ç«‹æ¨¡æ¿

```jinja2
{# templates/common/header.j2 #}
# ==========================================
# é…ç½®æ–‡ä»¶ï¼š{{ ansible_managed }}
# ç”Ÿæˆæ—¶é—´ï¼š{{ ansible_date_time.iso8601 }}
# ä¸»æœºåç§°ï¼š{{ inventory_hostname }}
# ==========================================
```

```jinja2
{# templates/nginx/nginx.conf.j2 #}
{% include 'common/header.j2' %}

user {{ nginx_user }};
worker_processes {{ ansible_processor_cores }};

http {
    # ä¸»è¦é…ç½®å†…å®¹
}
```

**æ¨¡æ¿å®å®šä¹‰**ï¼š
åˆ›å»ºå¯é‡ç”¨çš„ä»£ç å—

```jinja2
{# å®šä¹‰å® #}
{% macro generate_location(path, proxy_pass) %}
location {{ path }} {
    proxy_pass {{ proxy_pass }};
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
{% endmacro %}

{# ä½¿ç”¨å® #}
{{ generate_location('/api/', 'http://backend-api') }}
{{ generate_location('/web/', 'http://backend-web') }}
```

### 4.3 æ¨¡æ¿å˜é‡ä½œç”¨åŸŸ


**å…¨å±€å˜é‡**ï¼šåœ¨æ•´ä¸ªæ¨¡æ¿ä¸­éƒ½å¯ä»¥ä½¿ç”¨
- Ansibleäº‹å®å˜é‡ (`ansible_*`)
- ä¸»æœºæ¸…å•å˜é‡
- playbookä¸­å®šä¹‰çš„å˜é‡

**å±€éƒ¨å˜é‡**ï¼šåœ¨å¾ªç¯æˆ–ç‰¹å®šå—ä¸­ä½¿ç”¨
```jinja2
{% for server in servers %}
  {% set server_config = server.name + '_config' %}
  é…ç½®æ–‡ä»¶ï¼š{{ server_config }}
{% endfor %}
```

---

## 5. ğŸ›  templateæ¨¡å—å®æˆ˜


### 5.1 templateæ¨¡å—åŸºæœ¬ç”¨æ³•


**åŸºç¡€è¯­æ³•**ï¼š
```yaml
- name: ç”Ÿæˆé…ç½®æ–‡ä»¶
  template:
    src: template_file.j2          # æºæ¨¡æ¿æ–‡ä»¶
    dest: /path/to/destination     # ç›®æ ‡æ–‡ä»¶è·¯å¾„
    owner: root                    # æ–‡ä»¶æ‰€æœ‰è€…
    group: root                    # æ–‡ä»¶ç»„
    mode: '0644'                   # æ–‡ä»¶æƒé™
```

**å®é™…ç¤ºä¾‹**ï¼š
```yaml
- name: ç”ŸæˆNginxé…ç½®æ–‡ä»¶
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: '0644'
    backup: yes                    # å¤‡ä»½åŸæ–‡ä»¶
  notify: é‡å¯NginxæœåŠ¡           # è§¦å‘å¤„ç†ç¨‹åº
```

### 5.2 é«˜çº§å‚æ•°ä½¿ç”¨


**å¸¸ç”¨å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `backup` | å¤‡ä»½åŸæ–‡ä»¶ | `backup: yes` |
| `validate` | è¯­æ³•éªŒè¯ | `validate: 'nginx -t -c %s'` |
| `force` | å¼ºåˆ¶è¦†ç›– | `force: no` |
| `block_start_string` | è‡ªå®šä¹‰å—å¼€å§‹ç¬¦å· | `block_start_string: '<%'` |
| `block_end_string` | è‡ªå®šä¹‰å—ç»“æŸç¬¦å· | `block_end_string: '%>'` |

**é…ç½®éªŒè¯ç¤ºä¾‹**ï¼š
```yaml
- name: ç”Ÿæˆå¹¶éªŒè¯Nginxé…ç½®
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    validate: 'nginx -t -c %s'      # %sä»£è¡¨ç”Ÿæˆçš„æ–‡ä»¶
    backup: yes
  notify: é‡å¯Nginx
```

### 5.3 æ‰¹é‡æ¨¡æ¿å¤„ç†


**ä½¿ç”¨å¾ªç¯ç”Ÿæˆå¤šä¸ªæ–‡ä»¶**ï¼š
```yaml
- name: ç”Ÿæˆå¤šä¸ªè™šæ‹Ÿä¸»æœºé…ç½®
  template:
    src: vhost.conf.j2
    dest: "/etc/nginx/sites-available/{{ item.name }}.conf"
    mode: '0644'
  loop: "{{ virtual_hosts }}"       # å¾ªç¯å¤„ç†å¤šä¸ªç«™ç‚¹
  notify: é‡è½½Nginxé…ç½®
```

**å˜é‡å®šä¹‰ç¤ºä¾‹**ï¼š
```yaml
virtual_hosts:
  - name: website1
    server_name: www.example1.com
    root: /var/www/example1
  - name: website2  
    server_name: www.example2.com
    root: /var/www/example2
```

---

## 6. ğŸ” æ¨¡æ¿æµ‹è¯•ä¸è°ƒè¯•


### 6.1 æ¨¡æ¿è¯­æ³•æ£€æŸ¥


**ä½¿ç”¨ansible-playbookæ£€æŸ¥**ï¼š
```bash
# è¯­æ³•æ£€æŸ¥
ansible-playbook --syntax-check site.yml

# å¹²è¿è¡Œæ¨¡å¼ï¼ˆä¸å®é™…æ‰§è¡Œï¼‰
ansible-playbook --check site.yml

# æ˜¾ç¤ºæ¨¡æ¿ç”Ÿæˆå†…å®¹ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
ansible-playbook -vvv site.yml
```

### 6.2 è°ƒè¯•æŠ€å·§


**åœ¨æ¨¡æ¿ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯**ï¼š
```jinja2
{# è°ƒè¯•ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å˜é‡ #}
{# {{ hostvars[inventory_hostname] | to_nice_json }} #}

{# è°ƒè¯•ï¼šæ˜¾ç¤ºç‰¹å®šå˜é‡ç±»å‹ #}
{# å˜é‡ç±»å‹ï¼š{{ my_var | type_debug }} #}

{# è°ƒè¯•ï¼šæ¡ä»¶åˆ¤æ–­ #}
{% if debug_mode is defined and debug_mode %}
# è°ƒè¯•æ¨¡å¼å¼€å¯
# ä¸»æœºå˜é‡ï¼š{{ inventory_hostname }}
# ç³»ç»Ÿä¿¡æ¯ï¼š{{ ansible_distribution }} {{ ansible_distribution_version }}
{% endif %}
```

**ä½¿ç”¨debugæ¨¡å—éªŒè¯å˜é‡**ï¼š
```yaml
- name: è°ƒè¯•æ¨¡æ¿å˜é‡
  debug:
    msg: |
      æœåŠ¡å™¨åï¼š{{ inventory_hostname }}
      IPåœ°å€ï¼š{{ ansible_default_ipv4.address }}
      å†…å­˜æ€»é‡ï¼š{{ ansible_memory_mb.real.total }}MB
```

### 6.3 å¸¸è§é”™è¯¯æ’æŸ¥


**ğŸ› é”™è¯¯ç±»å‹ä¸è§£å†³æ–¹æ³•**ï¼š

```
é”™è¯¯1ï¼šå˜é‡æœªå®šä¹‰
UndefinedError: 'database_host' is undefined

è§£å†³æ–¹æ³•ï¼š
{% if database_host is defined %}
database_host={{ database_host }}
{% else %}
database_host=localhost
{% endif %}
```

```
é”™è¯¯2ï¼šè¯­æ³•é”™è¯¯
TemplateSyntaxError: expected token 'end of statement block'

æ£€æŸ¥æ–¹æ³•ï¼š
- ç¡®ä¿æ‰€æœ‰{% %}å—éƒ½æ­£ç¡®å…³é—­
- æ£€æŸ¥å¼•å·åŒ¹é…
- éªŒè¯ç¼©è¿›æ ¼å¼
```

**âœ… è°ƒè¯•æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ¨¡æ¿æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- [ ] å˜é‡åæ‹¼å†™æ˜¯å¦æ­£ç¡®
- [ ] æ‰€æœ‰æ§åˆ¶å—æ˜¯å¦æ­£ç¡®å…³é—­
- [ ] ç›®æ ‡æ–‡ä»¶æƒé™æ˜¯å¦åˆé€‚
- [ ] æ˜¯å¦æœ‰è¯­æ³•éªŒè¯å‘½ä»¤

---

## 7. ğŸ’¡ æœ€ä½³å®è·µæŒ‡å—


### 7.1 æ¨¡æ¿è®¾è®¡åŸåˆ™


**ğŸ”¸ ä¿æŒæ¨¡æ¿ç®€æ´**
```jinja2
{# å¥½çš„åšæ³•ï¼šé€»è¾‘æ¸…æ™° #}
{% if env == 'production' %}
worker_processes auto;
{% else %}
worker_processes 1;
{% endif %}

{# é¿å…ï¼šè¿‡äºå¤æ‚çš„åµŒå¥—é€»è¾‘ #}
```

**ğŸ”¸ ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å**
```jinja2
{# æ¸…æ™°çš„å˜é‡å‘½å #}
{{ nginx_worker_processes }}
{{ database_max_connections }}
{{ ssl_certificate_path }}
```

### 7.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**å‡å°‘ä¸å¿…è¦çš„å¾ªç¯å’Œåˆ¤æ–­**ï¼š
```jinja2
{# ä¼˜åŒ–å‰ï¼šé‡å¤åˆ¤æ–­ #}
{% for user in users %}
{% if user.status == 'active' %}
ç”¨æˆ·ï¼š{{ user.name }}
{% endif %}
{% endfor %}

{# ä¼˜åŒ–åï¼šé¢„å…ˆè¿‡æ»¤ #}
{% set active_users = users | selectattr('status', 'equalto', 'active') %}
{% for user in active_users %}
ç”¨æˆ·ï¼š{{ user.name }}
{% endfor %}
```

### 7.3 å®‰å…¨æ³¨æ„äº‹é¡¹


**âš ï¸ é˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²**ï¼š
```jinja2
{# ä¸è¦åœ¨æ¨¡æ¿ä¸­ç¡¬ç¼–ç å¯†ç  #}
password={{ vault_database_password }}  # ä½¿ç”¨vaultåŠ å¯†

{# æ•æ„Ÿä¿¡æ¯ä½¿ç”¨é»˜è®¤å€¼ #}
api_key={{ api_key | default('[REDACTED]') }}
```

**ğŸ”’ è¾“å…¥éªŒè¯**ï¼š
```jinja2
{# éªŒè¯è¾“å…¥æ ¼å¼ #}
{% if database_port is number and database_port > 0 %}
port={{ database_port }}
{% else %}
port=3306
{% endif %}
```

### 7.4 ç»´æŠ¤æ€§å»ºè®®


**ğŸ“‹ æ–‡æ¡£åŒ–å»ºè®®**ï¼š
```jinja2
{#
æ¨¡æ¿è¯´æ˜ï¼šNginxä¸»é…ç½®æ–‡ä»¶
ç”¨é€”ï¼šç”ŸæˆNginxæœåŠ¡å™¨é…ç½®
å¿…éœ€å˜é‡ï¼š
- nginx_user: Nginxè¿è¡Œç”¨æˆ·
- nginx_worker_processes: å·¥ä½œè¿›ç¨‹æ•°
å¯é€‰å˜é‡ï¼š
- nginx_worker_connections: å·¥ä½œè¿æ¥æ•°ï¼ˆé»˜è®¤1024ï¼‰
#}
```

**ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ**ï¼š
- ä¸ºæ¨¡æ¿æ–‡ä»¶æ·»åŠ ç‰ˆæœ¬æ³¨é‡Š
- é‡è¦å˜æ›´å‰å¤‡ä»½æ¨¡æ¿
- ä½¿ç”¨Gitè·Ÿè¸ªæ¨¡æ¿å˜æ›´å†å²

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 Jinja2è¯­æ³•è®°å¿†å¡


```markdown
ğŸ¯ æ ¸å¿ƒè¯­æ³•é€ŸæŸ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {{ variable }}     - è¾“å‡ºå˜é‡å€¼     â”‚
â”‚ {% if condition %} - æ¡ä»¶åˆ¤æ–­       â”‚
â”‚ {% for item %}     - å¾ªç¯å¤„ç†       â”‚
â”‚ {# comment #}      - æ³¨é‡Šè¯´æ˜       â”‚
â”‚ {{ var | filter }} - è¿‡æ»¤å™¨åº”ç”¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å¿…æŒæ¡æ¦‚å¿µæ¸…å•


âœ… **åŸºç¡€è¯­æ³•**
- [ ] ç†è§£ä¸‰ç§è¯­æ³•ç¬¦å·çš„åŒºåˆ«å’Œç”¨æ³•
- [ ] æŒæ¡å˜é‡æ’å€¼çš„åŸºæœ¬æ–¹æ³•
- [ ] äº†è§£å¸¸ç”¨è¿‡æ»¤å™¨çš„ä½œç”¨

âœ… **æ§åˆ¶ç»“æ„**  
- [ ] ç†Ÿç»ƒä½¿ç”¨ifæ¡ä»¶åˆ¤æ–­
- [ ] æŒæ¡forå¾ªç¯çš„å„ç§ç”¨æ³•
- [ ] ç†è§£å¾ªç¯æ§åˆ¶å˜é‡çš„å«ä¹‰

âœ… **å®æˆ˜åº”ç”¨**
- [ ] èƒ½å¤Ÿä½¿ç”¨templateæ¨¡å—ç”Ÿæˆé…ç½®æ–‡ä»¶
- [ ] å­¦ä¼šè°ƒè¯•æ¨¡æ¿è¯­æ³•é”™è¯¯
- [ ] æŒæ¡æ¨¡æ¿æ–‡ä»¶çš„ç»„ç»‡æ–¹æ³•

### 8.3 å­¦ä¹ è·¯å¾„æŒ‡å¼•


```
ğŸ“… å­¦ä¹ è¿›åº¦è§„åˆ’
ç¬¬1å¤©ï¼šæŒæ¡åŸºç¡€è¯­æ³•å’Œå˜é‡æ’å€¼
ç¬¬2å¤©ï¼šå­¦ä¹ æ§åˆ¶ç»“æ„ï¼ˆif/forï¼‰
ç¬¬3å¤©ï¼šç»ƒä¹ templateæ¨¡å—ä½¿ç”¨
ç¬¬4å¤©ï¼šæ¨¡æ¿è°ƒè¯•å’Œä¼˜åŒ–æŠ€å·§
ç¬¬5å¤©ï¼šç»¼åˆå®æˆ˜é¡¹ç›®ç»ƒä¹ 
```

### 8.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è§£å†³çš„å®é™…é—®é¢˜**ï¼š
- **é…ç½®ç®¡ç†**ï¼šä¸€å¥—æ¨¡æ¿é€‚é…å¤šç§ç¯å¢ƒ
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šæ ¹æ®ä¸»æœºä¿¡æ¯åŠ¨æ€ç”Ÿæˆé…ç½®
- **æ‰¹é‡æ“ä½œ**ï¼šåŒæ—¶å¤„ç†å¤šå°æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶
- **æ ‡å‡†åŒ–**ï¼šç¡®ä¿é…ç½®æ–‡ä»¶æ ¼å¼çš„ä¸€è‡´æ€§

**ğŸ’¼ èŒåœºåº”ç”¨åœºæ™¯**ï¼š
- WebæœåŠ¡å™¨é…ç½®è‡ªåŠ¨åŒ–ï¼ˆNginxã€Apacheï¼‰
- æ•°æ®åº“é…ç½®ç®¡ç†ï¼ˆMySQLã€PostgreSQLï¼‰
- ç›‘æ§ç³»ç»Ÿé…ç½®ï¼ˆPrometheusã€Grafanaï¼‰
- å®¹å™¨ç¼–æ’é…ç½®ï¼ˆDockerã€Kubernetesï¼‰

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> Jinja2æ¨¡æ¿åŠŸèƒ½å¼ºï¼Œä¸‰ç§è¯­æ³•è¦è®°ç‰¢  
> åŒæ‹¬å·æ˜¾ç¤ºå˜é‡å€¼ï¼Œç™¾åˆ†å·æ§åˆ¶é€»è¾‘è·³  
> äº•å·æ³¨é‡Šä¸è¾“å‡ºï¼Œè¿‡æ»¤å™¨è®©æ•°æ®å·§  
> templateæ¨¡å—æ¥åº”ç”¨ï¼Œè‡ªåŠ¨åŒ–é…ç½®æ•ˆç‡é«˜