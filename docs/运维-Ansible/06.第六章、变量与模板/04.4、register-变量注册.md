---
title: 4ã€register-å˜é‡æ³¨å†Œ
---
## ğŸ“š ç›®å½•

1. [registeråŸºæœ¬æ¦‚å¿µ](#1-registeråŸºæœ¬æ¦‚å¿µ)
2. [registerè¯­æ³•ä¸ä½¿ç”¨](#2-registerè¯­æ³•ä¸ä½¿ç”¨)
3. [è¿”å›å€¼ç»“æ„è¯¦è§£](#3-è¿”å›å€¼ç»“æ„è¯¦è§£)
4. [å¸¸ç”¨è¿”å›å€¼å­—æ®µ](#4-å¸¸ç”¨è¿”å›å€¼å­—æ®µ)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [è°ƒè¯•ä¸æ•…éšœæ’æŸ¥](#6-è°ƒè¯•ä¸æ•…éšœæ’æŸ¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ registeråŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯register


**ğŸ“– æ ¸å¿ƒå®šä¹‰**
```
registerï¼šAnsibleä¸­ç”¨æ¥æ•è·ä»»åŠ¡æ‰§è¡Œç»“æœçš„æœºåˆ¶
ä½œç”¨ï¼šå°†å‘½ä»¤æˆ–æ¨¡å—çš„è¾“å‡ºç»“æœä¿å­˜åˆ°å˜é‡ä¸­ï¼Œä¾›åç»­ä»»åŠ¡ä½¿ç”¨
æœ¬è´¨ï¼šæŠŠä»»åŠ¡çš„è¿”å›æ•°æ®"æ³¨å†Œ"åˆ°ä¸€ä¸ªå˜é‡é‡Œ
```

**ğŸ’¡ é€šä¿—ç†è§£**
```
ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š
- å°±åƒä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼ŒæŸœå‘˜ç»™ä½ ä¸€å¼ å›æ‰§å•
- registerå°±æ˜¯æŠŠè¿™å¼ "å›æ‰§å•"ä¿å­˜èµ·æ¥
- åé¢éœ€è¦ç”¨åˆ°åŠç†ç»“æœæ—¶ï¼Œå¯ä»¥æŸ¥çœ‹è¿™å¼ å›æ‰§å•

Ansibleåœºæ™¯ï¼š
æ‰§è¡Œå‘½ä»¤ â†’ äº§ç”Ÿç»“æœ â†’ registerä¿å­˜ â†’ åç»­ä½¿ç”¨
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦register


**ğŸ”¸ æ ¸å¿ƒéœ€æ±‚åœºæ™¯**
```
â‘  æ¡ä»¶åˆ¤æ–­ï¼šæ ¹æ®å‰ä¸€ä¸ªä»»åŠ¡çš„ç»“æœå†³å®šåç»­æ“ä½œ
â‘¡ ç»“æœä¼ é€’ï¼šå°†ä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºä½œä¸ºä¸‹ä¸ªä»»åŠ¡çš„è¾“å…¥
â‘¢ é”™è¯¯å¤„ç†ï¼šæ•è·æ‰§è¡Œç»“æœè¿›è¡Œå¼‚å¸¸å¤„ç†
â‘£ ä¿¡æ¯æå–ï¼šä»å¤æ‚è¾“å‡ºä¸­æå–éœ€è¦çš„ä¿¡æ¯
â‘¤ è°ƒè¯•æ’æŸ¥ï¼šä¿å­˜æ‰§è¡Œè¿‡ç¨‹ä¾¿äºé—®é¢˜å®šä½
```

**ğŸ’­ å®é™…æ¡ˆä¾‹æ€è€ƒ**
```
åœºæ™¯1ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œå¦‚æœæ²¡è¿è¡Œå°±å¯åŠ¨
åœºæ™¯2ï¼šè·å–ç³»ç»Ÿä¿¡æ¯ï¼Œç”¨äºåç»­é…ç½®
åœºæ™¯3ï¼šæ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œæ£€æŸ¥æ˜¯å¦æˆåŠŸ
åœºæ™¯4ï¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œæ ¹æ®ç»“æœè¿›è¡Œæ“ä½œ
```

---

## 2. ğŸ› ï¸ registerè¯­æ³•ä¸ä½¿ç”¨


### 2.1 åŸºæœ¬è¯­æ³•æ ¼å¼


**ğŸ“ è¯­æ³•ç»“æ„**
```yaml
- name: ä»»åŠ¡æè¿°
  æ¨¡å—å:
    å‚æ•°: å€¼
  register: å˜é‡å
```

**ğŸ”¸ è¯­æ³•è¦ç‚¹è¯´æ˜**
- `register:`åé¢è·Ÿå˜é‡åï¼ˆè‡ªå®šä¹‰ï¼‰
- å˜é‡åéµå¾ªæ ‡å‡†å‘½åè§„åˆ™ï¼šå­—æ¯æ•°å­—ä¸‹åˆ’çº¿
- ä¸€ä¸ªä»»åŠ¡åªèƒ½æœ‰ä¸€ä¸ªregister
- registerå†™åœ¨ä»»åŠ¡çš„æœ€å

### 2.2 ç®€å•ä½¿ç”¨ç¤ºä¾‹


**â‘  æ•è·å‘½ä»¤è¾“å‡º**
```yaml
- name: è·å–å½“å‰æ—¶é—´
  command: date
  register: current_time

- name: æ˜¾ç¤ºæ—¶é—´ç»“æœ
  debug:
    msg: "å½“å‰æ—¶é—´æ˜¯ï¼š{{ current_time.stdout }}"
```

**â‘¡ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨**
```yaml
- name: æ£€æŸ¥é…ç½®æ–‡ä»¶
  stat:
    path: /etc/nginx/nginx.conf
  register: nginx_config

- name: è¾“å‡ºæ£€æŸ¥ç»“æœ
  debug:
    msg: "é…ç½®æ–‡ä»¶å­˜åœ¨ï¼š{{ nginx_config.stat.exists }}"
```

### 2.3 è¿›é˜¶ä½¿ç”¨æ¨¡å¼


**â‘¢ ç»“åˆæ¡ä»¶åˆ¤æ–­**
```yaml
- name: æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
  command: systemctl is-active nginx
  register: nginx_status
  ignore_errors: yes

- name: å¯åŠ¨nginxæœåŠ¡
  service:
    name: nginx
    state: started
  when: nginx_status.rc != 0
```

**â‘£ å¾ªç¯ä¸­ä½¿ç”¨register**
```yaml
- name: æ£€æŸ¥å¤šä¸ªç«¯å£
  command: netstat -tlnp | grep :{{ item }}
  register: port_check
  loop:
    - 80
    - 443
    - 22
  ignore_errors: yes

- name: æ˜¾ç¤ºç«¯å£çŠ¶æ€
  debug:
    msg: "ç«¯å£ {{ item.item }} çŠ¶æ€ï¼š{{ 'Open' if item.rc == 0 else 'Closed' }}"
  loop: "{{ port_check.results }}"
```

---

## 3. ğŸ“Š è¿”å›å€¼ç»“æ„è¯¦è§£


### 3.1 registerå˜é‡çš„æ•°æ®ç»“æ„


**ğŸ“‹ æ ‡å‡†ç»“æ„ç»„æˆ**
```
registerå˜é‡ç»“æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   registerå˜é‡      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ changed: true/false â”‚ â† ä»»åŠ¡æ˜¯å¦æ”¹å˜ç³»ç»ŸçŠ¶æ€
â”‚ failed: true/false  â”‚ â† ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå¤±è´¥
â”‚ rc: æ•°å­—           â”‚ â† è¿”å›ç ï¼ˆå‘½ä»¤æ¨¡å—ï¼‰
â”‚ stdout: "å­—ç¬¦ä¸²"    â”‚ â† æ ‡å‡†è¾“å‡ºå†…å®¹
â”‚ stderr: "å­—ç¬¦ä¸²"    â”‚ â† é”™è¯¯è¾“å‡ºå†…å®¹
â”‚ stdout_lines: []   â”‚ â† è¾“å‡ºæŒ‰è¡Œåˆ†å‰²çš„åˆ—è¡¨
â”‚ stderr_lines: []   â”‚ â† é”™è¯¯æŒ‰è¡Œåˆ†å‰²çš„åˆ—è¡¨
â”‚ æ¨¡å—ç‰¹å®šå­—æ®µ...     â”‚ â† ä¸åŒæ¨¡å—çš„ä¸“æœ‰å­—æ®µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä¸åŒæ¨¡å—çš„è¿”å›å€¼å·®å¼‚


**ğŸ”¸ command/shellæ¨¡å—è¿”å›å€¼**
```yaml
{
  "changed": true,
  "cmd": ["ls", "-la"],
  "rc": 0,
  "stdout": "æ–‡ä»¶åˆ—è¡¨å†…å®¹",
  "stderr": "",
  "stdout_lines": ["line1", "line2"],
  "stderr_lines": []
}
```

**ğŸ”¸ statæ¨¡å—è¿”å›å€¼**
```yaml
{
  "changed": false,
  "stat": {
    "exists": true,
    "path": "/path/to/file",
    "size": 1234,
    "mode": "0644",
    "uid": 0,
    "gid": 0
  }
}
```

**ğŸ”¸ serviceæ¨¡å—è¿”å›å€¼**
```yaml
{
  "changed": true,
  "name": "nginx",
  "state": "started",
  "status": {
    "ActiveState": "active",
    "LoadState": "loaded"
  }
}
```

---

## 4. ğŸ“ å¸¸ç”¨è¿”å›å€¼å­—æ®µ


### 4.1 é€šç”¨å­—æ®µè¯¦è§£


| å­—æ®µå | **å«ä¹‰è¯´æ˜** | **æ•°æ®ç±»å‹** | **ä½¿ç”¨åœºæ™¯** |
|--------|-------------|-------------|-------------|
| `changed` | `ä»»åŠ¡æ˜¯å¦æ”¹å˜äº†ç³»ç»ŸçŠ¶æ€` | `å¸ƒå°”å€¼` | `æ¡ä»¶åˆ¤æ–­ã€å¹‚ç­‰æ€§æ£€æŸ¥` |
| `failed` | `ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå¤±è´¥` | `å¸ƒå°”å€¼` | `é”™è¯¯å¤„ç†ã€å¼‚å¸¸åˆ¤æ–­` |
| `rc` | `å‘½ä»¤è¿”å›ç ï¼ˆ0=æˆåŠŸï¼‰` | `æ•´æ•°` | `å‘½ä»¤æ‰§è¡ŒçŠ¶æ€åˆ¤æ–­` |
| `stdout` | `æ ‡å‡†è¾“å‡ºå†…å®¹` | `å­—ç¬¦ä¸²` | `è·å–å‘½ä»¤æ‰§è¡Œç»“æœ` |
| `stderr` | `é”™è¯¯è¾“å‡ºå†…å®¹` | `å­—ç¬¦ä¸²` | `é”™è¯¯ä¿¡æ¯è·å–` |

### 4.2 å­—æ®µä½¿ç”¨ç¤ºä¾‹


**â‘  stdout - æ ‡å‡†è¾“å‡º**
```yaml
- name: è·å–ç³»ç»Ÿè´Ÿè½½
  command: uptime
  register: system_load

- name: æå–è´Ÿè½½ä¿¡æ¯
  debug:
    msg: "ç³»ç»Ÿè´Ÿè½½ï¼š{{ system_load.stdout }}"
```

**â‘¡ rc - è¿”å›ç åˆ¤æ–­**
```yaml
- name: æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
  command: nc -z localhost 80
  register: port_test
  ignore_errors: yes

- name: æ ¹æ®è¿”å›ç åˆ¤æ–­
  debug:
    msg: "{{ 'ç«¯å£å¼€æ”¾' if port_test.rc == 0 else 'ç«¯å£å…³é—­' }}"
```

**â‘¢ changed - çŠ¶æ€å˜åŒ–**
```yaml
- name: æ›´æ–°è½¯ä»¶åŒ…
  yum:
    name: "*"
    state: latest
  register: update_result

- name: æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
  debug:
    msg: "{{ 'æœ‰è½¯ä»¶æ›´æ–°' if update_result.changed else 'æ— éœ€æ›´æ–°' }}"
```

### 4.3 stdout_linesçš„ä¾¿åˆ©æ€§


**ğŸ”¸ æŒ‰è¡Œå¤„ç†è¾“å‡º**
```yaml
- name: æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
  command: ps aux
  register: process_list

- name: é€è¡Œæ˜¾ç¤ºè¿›ç¨‹ï¼ˆå‰5è¡Œï¼‰
  debug:
    msg: "{{ item }}"
  loop: "{{ process_list.stdout_lines[:5] }}"
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 5.1 ç³»ç»Ÿä¿¡æ¯æ”¶é›†


**ğŸ’» è·å–ç³»ç»ŸåŸºæœ¬ä¿¡æ¯**
```yaml
- name: æ”¶é›†ç³»ç»Ÿä¿¡æ¯
  setup:
  register: system_facts

- name: æ˜¾ç¤ºå…³é”®ä¿¡æ¯
  debug:
    msg: |
      æ“ä½œç³»ç»Ÿï¼š{{ system_facts.ansible_facts.ansible_distribution }}
      å†…å­˜å¤§å°ï¼š{{ system_facts.ansible_facts.ansible_memtotal_mb }}MB
      CPUæ ¸æ•°ï¼š{{ system_facts.ansible_facts.ansible_processor_vcpus }}
```

**ğŸ“Š ç£ç›˜ç©ºé—´æ£€æŸ¥**
```yaml
- name: æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
  command: df -h /
  register: disk_usage

- name: æå–ä½¿ç”¨ç‡
  set_fact:
    root_usage: "{{ disk_usage.stdout_lines[1].split()[4] }}"

- name: ç£ç›˜ç©ºé—´å‘Šè­¦
  debug:
    msg: "âš ï¸ æ ¹åˆ†åŒºä½¿ç”¨ç‡ï¼š{{ root_usage }}"
  when: root_usage.replace('%', '')|int > 80
```

### 5.2 æœåŠ¡çŠ¶æ€ç®¡ç†


**ğŸ”§ æ™ºèƒ½æœåŠ¡ç®¡ç†**
```yaml
- name: æ£€æŸ¥nginxçŠ¶æ€
  command: systemctl is-active nginx
  register: nginx_status
  ignore_errors: yes

- name: å¤„ç†nginxæœåŠ¡
  service:
    name: nginx
    state: "{{ 'restarted' if nginx_status.rc == 0 else 'started' }}"
  register: service_result

- name: æœåŠ¡æ“ä½œç»“æœ
  debug:
    msg: "NginxæœåŠ¡{{ 'é‡å¯' if nginx_status.rc == 0 else 'å¯åŠ¨' }}{{ 'æˆåŠŸ' if not service_result.failed else 'å¤±è´¥' }}"
```

### 5.3 é…ç½®éªŒè¯ä¸éƒ¨ç½²


**âš™ï¸ é…ç½®æ–‡ä»¶éªŒè¯**
```yaml
- name: æ£€æŸ¥nginxé…ç½®è¯­æ³•
  command: nginx -t
  register: config_check
  ignore_errors: yes

- name: é…ç½®æ£€æŸ¥ç»“æœå¤„ç†
  block:
    - name: é‡è½½nginxé…ç½®
      service:
        name: nginx
        state: reloaded
      when: config_check.rc == 0
    
    - name: é…ç½®é”™è¯¯æŠ¥å‘Š
      fail:
        msg: "Nginxé…ç½®è¯­æ³•é”™è¯¯ï¼š{{ config_check.stderr }}"
      when: config_check.rc != 0
```

### 5.4 æ–‡ä»¶æ“ä½œä¸æ£€æŸ¥


**ğŸ“ æ–‡ä»¶çŠ¶æ€æ£€æŸ¥**
```yaml
- name: æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
  find:
    paths: /backup
    patterns: "*.tar.gz"
    age: "7d"
    age_stamp: ctime
  register: old_backups

- name: æ¸…ç†æ—§å¤‡ä»½
  file:
    path: "{{ item.path }}"
    state: absent
  loop: "{{ old_backups.files }}"
  when: old_backups.matched > 5

- name: å¤‡ä»½æ¸…ç†æŠ¥å‘Š
  debug:
    msg: "æ¸…ç†äº† {{ old_backups.matched }} ä¸ªæ—§å¤‡ä»½æ–‡ä»¶"
```

---

## 6. ğŸ” è°ƒè¯•ä¸æ•…éšœæ’æŸ¥


### 6.1 registerè°ƒè¯•æŠ€å·§


**â‘  å®Œæ•´è¾“å‡ºæŸ¥çœ‹**
```yaml
- name: æ‰§è¡Œå¤æ‚å‘½ä»¤
  shell: |
    echo "å¼€å§‹æ‰§è¡Œä»»åŠ¡"
    ls -la /tmp
    echo "ä»»åŠ¡å®Œæˆ"
  register: complex_result

- name: æŸ¥çœ‹å®Œæ•´æ³¨å†Œå˜é‡
  debug:
    var: complex_result
```

**â‘¡ åˆ†å­—æ®µè°ƒè¯•**
```yaml
- name: é€å­—æ®µè°ƒè¯•
  debug:
    msg: |
      è¿”å›ç ï¼š{{ complex_result.rc }}
      æ˜¯å¦æ”¹å˜ï¼š{{ complex_result.changed }}
      æ ‡å‡†è¾“å‡ºï¼š{{ complex_result.stdout }}
      é”™è¯¯è¾“å‡ºï¼š{{ complex_result.stderr }}
```

### 6.2 å¸¸è§é—®é¢˜å¤„ç†


**âš ï¸ é—®é¢˜1ï¼šregisterå˜é‡æœªå®šä¹‰**
```yaml
# âŒ é”™è¯¯å†™æ³•
- name: æ¡ä»¶ä»»åŠ¡
  command: echo "test"
  register: test_result
  when: some_condition

- name: ä½¿ç”¨å˜é‡ï¼ˆå¯èƒ½æŠ¥é”™ï¼‰
  debug:
    msg: "{{ test_result.stdout }}"

# âœ… æ­£ç¡®å†™æ³•
- name: ä½¿ç”¨å˜é‡
  debug:
    msg: "{{ test_result.stdout if test_result is defined else 'ä»»åŠ¡æœªæ‰§è¡Œ' }}"
```

**âš ï¸ é—®é¢˜2ï¼šå¾ªç¯ä¸­registerè¦†ç›–**
```yaml
# âŒ é”™è¯¯ï¼šå˜é‡ä¼šè¢«è¦†ç›–
- name: æ£€æŸ¥å¤šä¸ªæœåŠ¡
  command: systemctl is-active {{ item }}
  register: service_status
  loop:
    - nginx
    - apache2
    - mysql

# âœ… æ­£ç¡®ï¼šä½¿ç”¨results
- name: ä½¿ç”¨å¾ªç¯ç»“æœ
  debug:
    msg: "æœåŠ¡{{ item.item }}çŠ¶æ€ï¼š{{ item.stdout }}"
  loop: "{{ service_status.results }}"
```

### 6.3 è°ƒè¯•æœ€ä½³å®è·µ


**ğŸ› ï¸ è°ƒè¯•æ¨¡å¼è®¾ç½®**
```yaml
- name: å¼€å‘è°ƒè¯•æ¨¡å¼
  block:
    - name: æ‰§è¡Œä»»åŠ¡
      command: some_complex_command
      register: task_result
    
    - name: è°ƒè¯•è¾“å‡º
      debug:
        var: task_result
      when: debug_mode | default(false)
    
    - name: ç®€åŒ–è¾“å‡º
      debug:
        msg: "ä»»åŠ¡æ‰§è¡Œï¼š{{ 'æˆåŠŸ' if task_result.rc == 0 else 'å¤±è´¥' }}"
      when: not (debug_mode | default(false))
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ registeræœ¬è´¨ï¼šæ•è·ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œä¿å­˜åˆ°å˜é‡ä¸­
ğŸ”¸ åŸºæœ¬è¯­æ³•ï¼šregister: å˜é‡åï¼ˆå†™åœ¨ä»»åŠ¡æœ€åï¼‰
ğŸ”¸ é€šç”¨å­—æ®µï¼šchangedã€failedã€rcã€stdoutã€stderr
ğŸ”¸ ä½¿ç”¨åœºæ™¯ï¼šæ¡ä»¶åˆ¤æ–­ã€ç»“æœä¼ é€’ã€é”™è¯¯å¤„ç†ã€ä¿¡æ¯æå–
ğŸ”¸ è°ƒè¯•æŠ€å·§ï¼šdebugæ¨¡å—æŸ¥çœ‹å®Œæ•´å˜é‡å†…å®¹
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ registerçš„æ•°æ®æµå‘**
```
ä»»åŠ¡æ‰§è¡Œæµç¨‹ï¼š
æ¨¡å—æ‰§è¡Œ â†’ äº§ç”Ÿè¿”å›æ•°æ® â†’ registeræ•è· â†’ å­˜å‚¨åˆ°å˜é‡ â†’ åç»­ä½¿ç”¨

è®°å¿†è¦ç‚¹ï¼š
- registeræ˜¯"æ•è·å™¨"ï¼Œä¸“é—¨æŠ“å–ä»»åŠ¡ç»“æœ
- æ¯ä¸ªæ¨¡å—è¿”å›çš„æ•°æ®ç»“æ„ç•¥æœ‰ä¸åŒ
- é€šè¿‡å­—æ®µè®¿é—®ï¼šå˜é‡å.å­—æ®µå
```

**ğŸ”¹ è¿”å›ç çš„å«ä¹‰**
```
RCè¿”å›ç è§„åˆ™ï¼š
â€¢ 0 = æˆåŠŸæ‰§è¡Œ
â€¢ é0 = æ‰§è¡Œå‡ºé”™
â€¢ ä¸åŒæ•°å€¼ä»£è¡¨ä¸åŒç±»å‹çš„é”™è¯¯

å®é™…åº”ç”¨ï¼š
always: rc == 0 è¡¨ç¤ºæˆåŠŸ
when: result.rc != 0 è¡¨ç¤ºå¤±è´¥
```

**ğŸ”¹ stdout vs stdout_lines**
```
æ•°æ®æ ¼å¼åŒºåˆ«ï¼š
â€¢ stdout: å®Œæ•´å­—ç¬¦ä¸²ï¼ŒåŒ…å«æ¢è¡Œç¬¦
â€¢ stdout_lines: æŒ‰è¡Œåˆ†å‰²çš„åˆ—è¡¨

ä½¿ç”¨é€‰æ‹©ï¼š
â€¢ ç®€å•æ˜¾ç¤º â†’ ç”¨stdout
â€¢ é€è¡Œå¤„ç† â†’ ç”¨stdout_lines
â€¢ æŸ¥æ‰¾ç‰¹å®šè¡Œ â†’ ç”¨stdout_lines
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ æœ€ä½³å®è·µ**
- **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åï¼ˆå¦‚`nginx_status`è€Œä¸æ˜¯`result`ï¼‰
- **é”™è¯¯å¤„ç†**ï¼šæ•æ„Ÿå‘½ä»¤è¦åŠ `ignore_errors: yes`
- **æ¡ä»¶åˆ¤æ–­**ï¼šä½¿ç”¨`when: result is defined`é¿å…æœªå®šä¹‰é”™è¯¯
- **è°ƒè¯•ä¹ æƒ¯**ï¼šå¼€å‘æ—¶å¤šç”¨`debug`æŸ¥çœ‹å®Œæ•´ç»“æœ

**âš ï¸ å¸¸è§é™·é˜±**
- registeråœ¨æ¡ä»¶ä»»åŠ¡ä¸­å¯èƒ½æœªå®šä¹‰
- å¾ªç¯ä¸­registerä¼šæœ‰`results`åˆ—è¡¨ç»“æ„
- ä¸åŒæ¨¡å—è¿”å›å­—æ®µåå¯èƒ½ä¸åŒ
- å‘½ä»¤æ¨¡å—çš„stdoutå¯èƒ½ä¸ºç©ºï¼ˆå¦‚åˆ é™¤æ–‡ä»¶ï¼‰

**ğŸ¯ ä½¿ç”¨åœºæ™¯åˆ¤æ–­**
```
ä½•æ—¶ä½¿ç”¨registerï¼š
âœ… éœ€è¦æ ¹æ®ç»“æœåšåç»­åˆ¤æ–­
âœ… è¦æå–å‘½ä»¤è¾“å‡ºä¿¡æ¯
âœ… éœ€è¦ä¼ é€’æ•°æ®ç»™ä¸‹ä¸ªä»»åŠ¡
âœ… è¦è¿›è¡Œé”™è¯¯å¤„ç†

ä½•æ—¶ä¸ç”¨registerï¼š
âŒ ç®€å•çš„ç‹¬ç«‹ä»»åŠ¡
âŒ ç»“æœä¸ä¼šè¢«åç»­ä½¿ç”¨
âŒ çº¯é…ç½®ç±»æ“ä½œ
```

### 7.4 è®°å¿†å£è¯€


**ğŸ§  æ ¸å¿ƒè¦ç‚¹è®°å¿†**
```
registeræ•è·ä»»åŠ¡æœï¼Œ
stdouté”™è¯¯è¦è®°ä½ã€‚
è¿”å›ç åˆ¤æ–­æˆåŠŸå¦ï¼Œ
æ¡ä»¶å¾ªç¯å·§è¿ç”¨ã€‚
è°ƒè¯•æ’é”™debugå¸®ï¼Œ
å˜é‡å‘½åè¦è§„èŒƒã€‚
```

**ğŸ“š æ‰©å±•å­¦ä¹ æ–¹å‘**
- ç»“åˆ`set_fact`å¤„ç†å¤æ‚æ•°æ®
- ä¸Jinja2æ¨¡æ¿ç»“åˆä½¿ç”¨
- åœ¨handlersä¸­ä½¿ç”¨registerç»“æœ
- ç»“åˆ`failed_when`è‡ªå®šä¹‰å¤±è´¥æ¡ä»¶