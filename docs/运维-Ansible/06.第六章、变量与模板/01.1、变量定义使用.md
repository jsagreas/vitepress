---
title: 1ã€å˜é‡å®šä¹‰ä½¿ç”¨
---
## ğŸ“š ç›®å½•

1. [Ansibleå˜é‡åŸºç¡€æ¦‚å¿µ](#1-ansibleå˜é‡åŸºç¡€æ¦‚å¿µ)
2. [å˜é‡å‘½åè§„èŒƒä¸è¯­æ³•](#2-å˜é‡å‘½åè§„èŒƒä¸è¯­æ³•)
3. [å˜é‡å®šä¹‰ä¸èµ‹å€¼æ–¹å¼](#3-å˜é‡å®šä¹‰ä¸èµ‹å€¼æ–¹å¼)
4. [å˜é‡ä½œç”¨åŸŸä¸ä¼˜å…ˆçº§](#4-å˜é‡ä½œç”¨åŸŸä¸ä¼˜å…ˆçº§)
5. [ä¸åŒç±»å‹å˜é‡è¯¦è§£](#5-ä¸åŒç±»å‹å˜é‡è¯¦è§£)
6. [å˜é‡å¼•ç”¨ä¸ä½¿ç”¨æŠ€å·§](#6-å˜é‡å¼•ç”¨ä¸ä½¿ç”¨æŠ€å·§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Ansibleå˜é‡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Ansibleå˜é‡


**ğŸ”¸ å˜é‡çš„æœ¬è´¨**
```
å˜é‡å°±åƒæ˜¯ä¸€ä¸ª"å®¹å™¨"ï¼Œç”¨æ¥å­˜å‚¨å¯ä»¥é‡å¤ä½¿ç”¨çš„ä¿¡æ¯
æ¯”å¦‚ï¼šæœåŠ¡å™¨IPåœ°å€ã€ç«¯å£å·ã€ç”¨æˆ·åã€è½¯ä»¶ç‰ˆæœ¬ç­‰

å®é™…æ„ä¹‰ï¼š
- é¿å…é‡å¤å†™ç›¸åŒçš„å€¼
- è®©å‰§æœ¬æ›´çµæ´»ï¼Œé€‚åº”ä¸åŒç¯å¢ƒ
- ä¾¿äºç»Ÿä¸€ç®¡ç†å’Œä¿®æ”¹é…ç½®
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å˜é‡**
```
æ²¡æœ‰å˜é‡çš„é—®é¢˜ï¼š
âŒ æ¯ä¸ªä»»åŠ¡éƒ½è¦å†™æ­»å…·ä½“çš„å€¼
âŒ æ¢ä¸ªç¯å¢ƒå°±è¦ä¿®æ”¹æ‰€æœ‰åœ°æ–¹
âŒ å®¹æ˜“å‡ºé”™ï¼Œç»´æŠ¤å›°éš¾

ä½¿ç”¨å˜é‡çš„å¥½å¤„ï¼š
âœ… ä¸€æ¬¡å®šä¹‰ï¼Œåˆ°å¤„ä½¿ç”¨
âœ… ç¯å¢ƒåˆ‡æ¢åªéœ€æ”¹å˜é‡å€¼
âœ… ä»£ç æ›´æ¸…æ™°ï¼Œç»´æŠ¤æ›´å®¹æ˜“
```

### 1.2 å˜é‡çš„ä½œç”¨åŸç†


**ğŸ¯ å˜é‡å·¥ä½œæœºåˆ¶**
```
å®šä¹‰é˜¶æ®µï¼šç»™å˜é‡èµ·ä¸ªåå­—ï¼Œèµ‹ä¸ªå€¼
  â†“
å­˜å‚¨é˜¶æ®µï¼šAnsibleæŠŠå˜é‡ä¿å­˜åœ¨å†…å­˜é‡Œ  
  â†“
ä½¿ç”¨é˜¶æ®µï¼šç”¨{{ å˜é‡å }}çš„æ–¹å¼å¼•ç”¨
  â†“
æ›¿æ¢é˜¶æ®µï¼šæ‰§è¡Œæ—¶è‡ªåŠ¨æŠŠå˜é‡åæ¢æˆå®é™…çš„å€¼
```

**ğŸ“– ç”Ÿæ´»åŒ–ç±»æ¯”**
```
å˜é‡å°±åƒæ˜¯"ä»£å·"ï¼š
- å®šä¹‰ï¼šç»™"å¼ ä¸‰"èµ·ä¸ªä»£å·å«"é˜Ÿé•¿"
- ä½¿ç”¨ï¼šä»¥åè¯´"é˜Ÿé•¿"å¤§å®¶éƒ½çŸ¥é“æ˜¯æŒ‡å¼ ä¸‰
- å¥½å¤„ï¼šå¦‚æœæ¢äººå½“é˜Ÿé•¿ï¼Œåªéœ€è¦æ”¹ä»£å·æŒ‡å‘å³å¯
```

---

## 2. ğŸ“ å˜é‡å‘½åè§„èŒƒä¸è¯­æ³•


### 2.1 å˜é‡å‘½åè§„åˆ™


**ğŸ”¸ åŸºæœ¬å‘½åè§„èŒƒ**
```
åˆæ³•çš„å˜é‡åï¼š
âœ… web_server_port     # ä¸‹åˆ’çº¿åˆ†éš”
âœ… database_host       # å…¨å°å†™å­—æ¯
âœ… app_version_2       # å¯ä»¥åŒ…å«æ•°å­—
âœ… user_home_dir       # æè¿°æ€§åç§°

ä¸åˆæ³•çš„å˜é‡åï¼š
âŒ 2web_port          # ä¸èƒ½ä»¥æ•°å­—å¼€å¤´
âŒ web-server-port    # ä¸èƒ½ç”¨è¿å­—ç¬¦
âŒ web server port    # ä¸èƒ½æœ‰ç©ºæ ¼
âŒ web@server         # ä¸èƒ½æœ‰ç‰¹æ®Šå­—ç¬¦
```

**ğŸ’¡ å‘½åæœ€ä½³å®è·µ**
```
ğŸ¯ å‘½ååŸåˆ™ï¼š
1. è§åçŸ¥æ„ï¼šå˜é‡åè¦èƒ½è¡¨è¾¾å«ä¹‰
2. ç»Ÿä¸€é£æ ¼ï¼šæ•´ä¸ªé¡¹ç›®ä¿æŒä¸€è‡´çš„å‘½åé£æ ¼
3. é€‚å½“é•¿åº¦ï¼šä¸è¦å¤ªçŸ­ä¹Ÿä¸è¦å¤ªé•¿

ğŸ”‘ æ¨èæ¨¡å¼ï¼š
- é…ç½®ç±»ï¼šconfig_database_port
- è·¯å¾„ç±»ï¼špath_log_directory  
- çŠ¶æ€ç±»ï¼šis_service_enabled
- ç‰ˆæœ¬ç±»ï¼šversion_nginx_latest
```

### 2.2 å˜é‡å¼•ç”¨è¯­æ³•


**ğŸ”¸ åŸºæœ¬å¼•ç”¨æ–¹å¼**
```yaml
# å•ç‹¬ä½¿ç”¨å˜é‡ï¼ˆæ•´ä¸ªå€¼éƒ½æ˜¯å˜é‡ï¼‰
port: "{{ web_port }}"
name: "{{ app_name }}"

# åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡
message: "Welcome to {{ app_name }} version {{ app_version }}"
path: "/var/log/{{ service_name }}.log"

# åˆ—è¡¨ä¸­ä½¿ç”¨å˜é‡
packages:
  - "{{ package_name_1 }}"
  - "{{ package_name_2 }}"
```

**âš ï¸ å¼•ç”¨æ³¨æ„äº‹é¡¹**
```yaml
# âœ… æ­£ç¡®å†™æ³• - ç”¨å¼•å·åŒ…å›´
name: "{{ user_name }}"

# âŒ é”™è¯¯å†™æ³• - å®¹æ˜“è¢«YAMLè§£æé”™è¯¯
name: {{ user_name }}

# âœ… åœ¨å­—ç¬¦ä¸²ä¸­é—´å¯ä»¥ä¸ç”¨å¼•å·
path: /home/{{ user_name }}/app

# âœ… æ¡ä»¶åˆ¤æ–­ä¸­ä¸éœ€è¦å¼•å·
when: user_name == "admin"
```

---

## 3. âš™ï¸ å˜é‡å®šä¹‰ä¸èµ‹å€¼æ–¹å¼


### 3.1 ç›´æ¥åœ¨å‰§æœ¬ä¸­å®šä¹‰


**ğŸ”¸ varså…³é”®å­—å®šä¹‰**
```yaml
---
- name: æ¼”ç¤ºå‰§æœ¬å˜é‡å®šä¹‰
  hosts: webservers
  vars:
    web_port: 8080
    app_name: "MyWebApp"
    database_host: "192.168.1.100"
    is_production: true
  
  tasks:
    - name: æ˜¾ç¤ºåº”ç”¨ä¿¡æ¯
      debug:
        msg: "åº”ç”¨{{ app_name }}è¿è¡Œåœ¨ç«¯å£{{ web_port }}"
```

**ğŸ’¡ ç†è§£è¦ç‚¹**
```
varséƒ¨åˆ†å°±æ˜¯å˜é‡å®šä¹‰åŒºåŸŸ
è¿™é‡Œå®šä¹‰çš„å˜é‡åœ¨æ•´ä¸ªå‰§æœ¬ä¸­éƒ½å¯ä»¥ä½¿ç”¨
ç›¸å½“äºç»™è¿™ä¸ªå‰§æœ¬å®šä¹‰äº†"ä¸“ç”¨å‚æ•°"
```

### 3.2 å¤–éƒ¨å˜é‡æ–‡ä»¶


**ğŸ”¸ vars_filesæ–¹å¼**
```yaml
# ä¸»å‰§æœ¬æ–‡ä»¶ site.yml
---
- name: ä½¿ç”¨å¤–éƒ¨å˜é‡æ–‡ä»¶
  hosts: all
  vars_files:
    - vars/common.yml
    - vars/web.yml
  
  tasks:
    - name: å®‰è£…è½¯ä»¶åŒ…
      yum:
        name: "{{ package_name }}"
        state: present
```

```yaml
# å˜é‡æ–‡ä»¶ vars/common.yml
---
package_name: nginx
service_name: nginx
config_dir: /etc/nginx

# å˜é‡æ–‡ä»¶ vars/web.yml  
---
web_port: 80
ssl_port: 443
worker_processes: 4
```

**ğŸ¯ å¤–éƒ¨æ–‡ä»¶çš„ä¼˜åŠ¿**
```
âœ… å˜é‡å’Œé€»è¾‘åˆ†ç¦»ï¼Œå‰§æœ¬æ›´æ¸…æ™°
âœ… å¤šä¸ªå‰§æœ¬å¯ä»¥å…±äº«åŒä¸€ä¸ªå˜é‡æ–‡ä»¶
âœ… ä¾¿äºç‰ˆæœ¬æ§åˆ¶å’Œå›¢é˜Ÿåä½œ
âœ… æ•æ„Ÿä¿¡æ¯å¯ä»¥å•ç‹¬ç®¡ç†
```

### 3.3 å‘½ä»¤è¡Œä¼ é€’å˜é‡


**ğŸ”¸ -e å‚æ•°ä¼ é€’**
```bash
# ä¼ é€’å•ä¸ªå˜é‡
ansible-playbook site.yml -e "web_port=8080"

# ä¼ é€’å¤šä¸ªå˜é‡
ansible-playbook site.yml -e "web_port=8080 app_name=TestApp"

# ä¼ é€’JSONæ ¼å¼å˜é‡
ansible-playbook site.yml -e '{"users":["tom","jerry"],"env":"test"}'

# ä»æ–‡ä»¶è¯»å–å˜é‡
ansible-playbook site.yml -e "@vars.json"
```

**ğŸ’¡ å‘½ä»¤è¡Œå˜é‡çš„ç‰¹ç‚¹**
```
ğŸ¯ ä¼˜å…ˆçº§æœ€é«˜ï¼šä¼šè¦†ç›–å…¶ä»–æ‰€æœ‰åœ°æ–¹å®šä¹‰çš„åŒåå˜é‡
ğŸ”§ ä¸´æ—¶æ€§å¼ºï¼šé€‚åˆæµ‹è¯•å’Œä¸´æ—¶è°ƒæ•´å‚æ•°
ğŸš€ çµæ´»æ–¹ä¾¿ï¼šä¸ç”¨ä¿®æ”¹æ–‡ä»¶å°±èƒ½æ”¹å˜è¡Œä¸º
```

---

## 4. ğŸ¯ å˜é‡ä½œç”¨åŸŸä¸ä¼˜å…ˆçº§


### 4.1 å˜é‡ä½œç”¨åŸŸæ¦‚å¿µ


**ğŸ”¸ ä½œç”¨åŸŸå±‚æ¬¡å›¾**
```
å…¨å±€èŒƒå›´ï¼ˆæ‰€æœ‰ä¸»æœºéƒ½èƒ½ç”¨ï¼‰
â”œâ”€â”€ å…¨å±€å˜é‡ï¼ˆgroup_vars/allï¼‰
â””â”€â”€ å‰§æœ¬å˜é‡ï¼ˆvarsã€vars_filesï¼‰
    â”‚
ä¸»æœºç»„èŒƒå›´ï¼ˆç‰¹å®šç»„çš„ä¸»æœºèƒ½ç”¨ï¼‰  
â”œâ”€â”€ ç»„å˜é‡ï¼ˆgroup_vars/ç»„åï¼‰
â””â”€â”€ å‰§æœ¬ä¸­çš„ç»„å˜é‡
    â”‚
å•ä¸ªä¸»æœºèŒƒå›´ï¼ˆåªæœ‰ä¸€å°ä¸»æœºèƒ½ç”¨ï¼‰
â”œâ”€â”€ ä¸»æœºå˜é‡ï¼ˆhost_vars/ä¸»æœºåï¼‰  
â”œâ”€â”€ inventoryä¸­çš„ä¸»æœºå˜é‡
â””â”€â”€ ä»»åŠ¡å˜é‡ï¼ˆä»…åœ¨å•ä¸ªä»»åŠ¡ä¸­æœ‰æ•ˆï¼‰
```

**ğŸ’¡ ç†è§£ä½œç”¨åŸŸ**
```
å…¨å±€å˜é‡ï¼šåƒ"å…¬å¸è§„å®š"ï¼Œæ‰€æœ‰äººéƒ½è¦éµå®ˆ
ç»„å˜é‡ï¼šåƒ"éƒ¨é—¨è§„å®š"ï¼Œåªåœ¨ç‰¹å®šéƒ¨é—¨ç”Ÿæ•ˆ  
ä¸»æœºå˜é‡ï¼šåƒ"ä¸ªäººè®¾ç½®"ï¼Œåªå¯¹ç‰¹å®šä¸ªäººæœ‰æ•ˆ
ä»»åŠ¡å˜é‡ï¼šåƒ"ä¸´æ—¶å®‰æ’"ï¼Œåªåœ¨ç‰¹å®šåœºåˆä½¿ç”¨
```

### 4.2 å˜é‡ä¼˜å…ˆçº§æ’åº


**ğŸ”¸ ä¼˜å…ˆçº§ä»é«˜åˆ°ä½**
```
ä¼˜å…ˆçº§ç­‰çº§ï¼šæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜

22. å‘½ä»¤è¡Œä¼ å…¥çš„å˜é‡ï¼ˆ-eï¼‰          â† æœ€é«˜ä¼˜å…ˆçº§
21. ä»»åŠ¡ä¸­çš„vars                   
20. å—ä¸­çš„vars
19. è§’è‰²å’Œincludeä¸­çš„vars
18. set_factsè®¾ç½®çš„å˜é‡
17. registeredå˜é‡ï¼ˆä»»åŠ¡æ³¨å†Œçš„å˜é‡ï¼‰
16. host_varsä¸­çš„å˜é‡
15. group_varsä¸­çš„å˜é‡  
14. å‰§æœ¬ä¸­vars_filesçš„å˜é‡
13. å‰§æœ¬ä¸­varsçš„å˜é‡
12. è§’è‰²é»˜è®¤å˜é‡ï¼ˆrole defaultsï¼‰   â† æœ€ä½ä¼˜å…ˆçº§
```

**ğŸ¯ å®é™…åº”ç”¨ç†è§£**
```
é«˜ä¼˜å…ˆçº§ = æ›´å…·ä½“ã€æ›´ä¸´æ—¶çš„è®¾ç½®
ä½ä¼˜å…ˆçº§ = æ›´é€šç”¨ã€æ›´é»˜è®¤çš„è®¾ç½®

å°±åƒï¼š
- è€æ¿çš„ç‰¹æ®ŠæŒ‡ç¤ºï¼ˆå‘½ä»¤è¡Œå˜é‡ï¼‰> éƒ¨é—¨è§„å®šï¼ˆç»„å˜é‡ï¼‰> å…¬å¸åˆ¶åº¦ï¼ˆå…¨å±€å˜é‡ï¼‰
- ä¸´æ—¶å®‰æ’ï¼ˆä»»åŠ¡å˜é‡ï¼‰> é•¿æœŸé…ç½®ï¼ˆå‰§æœ¬å˜é‡ï¼‰> é»˜è®¤è®¾ç½®ï¼ˆè§’è‰²é»˜è®¤å€¼ï¼‰
```

---

## 5. ğŸ“Š ä¸åŒç±»å‹å˜é‡è¯¦è§£


### 5.1 å…¨å±€å˜é‡


**ğŸ”¸ å®šä¹‰ä½ç½®ä¸æ–¹å¼**
```yaml
# æ–¹å¼1ï¼šgroup_vars/allæ–‡ä»¶
# æ–‡ä»¶è·¯å¾„ï¼šgroup_vars/all
---
ntp_server: "pool.ntp.org"
timezone: "Asia/Shanghai"  
common_packages:
  - vim
  - wget
  - curl

# æ–¹å¼2ï¼šinventoryæ–‡ä»¶ä¸­çš„[all:vars]
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11

[all:vars]
ansible_user=root
ansible_ssh_private_key_file=~/.ssh/id_rsa
```

**ğŸ’¡ å…¨å±€å˜é‡çš„åº”ç”¨åœºæ™¯**
```
âœ… æ‰€æœ‰æœåŠ¡å™¨éƒ½éœ€è¦çš„é…ç½®ï¼šæ—¶åŒºã€DNSã€åŸºç¡€è½¯ä»¶åŒ…
âœ… è¿æ¥ä¿¡æ¯ï¼šSSHç”¨æˆ·åã€å¯†é’¥æ–‡ä»¶è·¯å¾„
âœ… ç¯å¢ƒæ ‡è¯†ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒ
âœ… å…¬å¸æ ‡å‡†ï¼šæ—¥å¿—è·¯å¾„ã€å¤‡ä»½ç­–ç•¥ç­‰
```

### 5.2 ä¸»æœºå˜é‡


**ğŸ”¸ å®šä¹‰æ–¹å¼è¯¦è§£**
```yaml
# æ–¹å¼1ï¼šhost_varsç›®å½•ä¸­åˆ›å»ºä¸»æœºä¸“ç”¨æ–‡ä»¶
# æ–‡ä»¶ï¼šhost_vars/web1
---
server_role: "primary"
backup_enabled: true
max_connections: 1000

# æ–‡ä»¶ï¼šhost_vars/web2  
---
server_role: "secondary"
backup_enabled: false
max_connections: 500

# æ–¹å¼2ï¼šinventoryæ–‡ä»¶ä¸­ç›´æ¥å®šä¹‰
[webservers]
web1 ansible_host=192.168.1.10 server_role=primary max_conn=1000
web2 ansible_host=192.168.1.11 server_role=secondary max_conn=500
```

**ğŸ¯ ä¸»æœºå˜é‡ä½¿ç”¨åœºæ™¯**
```
ğŸ–¥ï¸ æœåŠ¡å™¨ç‰¹å®šé…ç½®ï¼š
- ä¸»æœåŠ¡å™¨ vs å¤‡ä»½æœåŠ¡å™¨çš„ä¸åŒè®¾ç½®
- ä¸åŒç¡¬ä»¶è§„æ ¼çš„ä¼˜åŒ–å‚æ•°
- ç‰¹æ®Šç”¨é€”æœåŠ¡å™¨çš„ä¸“é—¨é…ç½®

ğŸ“ ä½ç½®ç›¸å…³ä¿¡æ¯ï¼š
- æœºæˆ¿ä½ç½®ã€ç½‘ç»œé…ç½®
- æœ¬åœ°å­˜å‚¨è·¯å¾„ã€å¤‡ä»½ç­–ç•¥  
- ç›‘æ§å’ŒæŠ¥è­¦è®¾ç½®
```

### 5.3 ç»„å˜é‡


**ğŸ”¸ ç»„å˜é‡å®šä¹‰æ–¹å¼**
```yaml
# inventoryæ–‡ä»¶å®šä¹‰ä¸»æœºç»„
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11

[databases]  
db1 ansible_host=192.168.1.20
db2 ansible_host=192.168.1.21

# group_vars/webserversæ–‡ä»¶
---
web_service: nginx
web_port: 80
ssl_enabled: true
document_root: /var/www/html

# group_vars/databasesæ–‡ä»¶
---
db_service: mysql
db_port: 3306
db_root_password: "{{ vault_db_password }}"
backup_schedule: "0 2 * * *"
```

**ğŸ”§ ç»„å˜é‡çš„å®é™…ä»·å€¼**
```
ğŸ¯ æŒ‰åŠŸèƒ½åˆ†ç»„ç®¡ç†ï¼š
- WebæœåŠ¡å™¨ç»„ï¼šç»Ÿä¸€çš„WebæœåŠ¡é…ç½®
- æ•°æ®åº“ç»„ï¼šç»Ÿä¸€çš„æ•°æ®åº“å‚æ•°
- è´Ÿè½½å‡è¡¡ç»„ï¼šç»Ÿä¸€çš„è´Ÿè½½å‡è¡¡è§„åˆ™

ğŸ”„ ç¯å¢ƒåŒºåˆ†ï¼š
- å¼€å‘ç»„ï¼šdevelopment.yml
- æµ‹è¯•ç»„ï¼štesting.yml  
- ç”Ÿäº§ç»„ï¼šproduction.yml
```

### 5.4 å‰§æœ¬å˜é‡ä¸ä»»åŠ¡å˜é‡


**ğŸ”¸ å‰§æœ¬çº§å˜é‡**
```yaml
---
- name: WebæœåŠ¡å™¨éƒ¨ç½²å‰§æœ¬
  hosts: webservers
  vars:
    # å‰§æœ¬çº§å˜é‡ï¼šæ•´ä¸ªå‰§æœ¬éƒ½å¯ä»¥ä½¿ç”¨
    deployment_version: "v2.1.0"
    config_template: "nginx.conf.j2"
    restart_services: true
  
  tasks:
    - name: éƒ¨ç½²åº”ç”¨ç‰ˆæœ¬
      copy:
        src: "app-{{ deployment_version }}.tar.gz"
        dest: /tmp/
```

**ğŸ”¸ ä»»åŠ¡çº§å˜é‡**
```yaml
- name: ä»»åŠ¡çº§å˜é‡æ¼”ç¤º
  copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
  vars:
    # ä»»åŠ¡çº§å˜é‡ï¼šåªåœ¨è¿™ä¸ªä»»åŠ¡ä¸­æœ‰æ•ˆ
    file_permissions: "0644"
    file_owner: "nginx"
  with_items:
    - {src: "app.conf", dest: "/etc/app/app.conf"}
    - {src: "db.conf", dest: "/etc/app/db.conf"}
```

**ğŸ’¡ ä½¿ç”¨åœºæ™¯åŒºåˆ†**
```
å‰§æœ¬å˜é‡é€‚åˆï¼š
âœ… æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹éœ€è¦çš„å‚æ•°
âœ… å¤šä¸ªä»»åŠ¡å…±äº«çš„é…ç½®å€¼
âœ… å‰§æœ¬æ‰§è¡Œçš„æ§åˆ¶å¼€å…³

ä»»åŠ¡å˜é‡é€‚åˆï¼š  
âœ… å•ä¸ªä»»åŠ¡çš„ä¸´æ—¶è®¾ç½®
âœ… å¾ªç¯ä»»åŠ¡ä¸­çš„è¾…åŠ©å˜é‡
âœ… ç‰¹å®šä»»åŠ¡çš„æ ¼å¼åŒ–å‚æ•°
```

### 5.5 å‘½ä»¤è¡Œå˜é‡çš„ç‰¹æ®Šç”¨é€”


**ğŸ”¸ çµæ´»çš„è¿è¡Œæ—¶æ§åˆ¶**
```bash
# ç¯å¢ƒåˆ‡æ¢
ansible-playbook deploy.yml -e "environment=production"
ansible-playbook deploy.yml -e "environment=testing"

# ç‰ˆæœ¬æ§åˆ¶
ansible-playbook deploy.yml -e "app_version=1.2.3"

# åŠŸèƒ½å¼€å…³
ansible-playbook deploy.yml -e "enable_ssl=true backup_enabled=false"

# æ‰¹é‡æ“ä½œ
ansible-playbook maintenance.yml -e "target_date=2024-01-01 maintenance_window=2h"
```

**ğŸ¯ å‘½ä»¤è¡Œå˜é‡çš„æœ€ä½³å®è·µ**
```
ğŸš€ ä¸´æ—¶è°ƒè¯•ï¼šå¿«é€Ÿæ”¹å˜è¡Œä¸ºæµ‹è¯•æ•ˆæœ
ğŸ”„ ç¯å¢ƒé€‚é…ï¼šåŒä¸€ä¸ªå‰§æœ¬é€‚åº”ä¸åŒç¯å¢ƒ
âš¡ ç´§æ€¥ä¿®å¤ï¼šç”Ÿäº§ç¯å¢ƒç´§æ€¥å‚æ•°è°ƒæ•´
ğŸ›ï¸ ç²¾ç»†æ§åˆ¶ï¼šç²¾ç¡®æ§åˆ¶æ‰§è¡Œè¡Œä¸º
```

---

## 6. ğŸ› ï¸ å˜é‡å¼•ç”¨ä¸ä½¿ç”¨æŠ€å·§


### 6.1 å˜é‡å¼•ç”¨çš„å¸¸è§åœºæ™¯


**ğŸ”¸ åœ¨ä»»åŠ¡å‚æ•°ä¸­ä½¿ç”¨**
```yaml
- name: å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„è½¯ä»¶åŒ…
  yum:
    name: "{{ package_name }}-{{ package_version }}"
    state: present

- name: åˆ›å»ºç”¨æˆ·ç›®å½•
  file:
    path: "/home/{{ username }}"
    state: directory
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: "0755"
```

**ğŸ”¸ åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨**
```yaml
- name: ä»…åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨é˜²ç«å¢™
  firewalld:
    state: enabled
  when: environment == "production"

- name: æ ¹æ®ç³»ç»Ÿç±»å‹é€‰æ‹©åŒ…ç®¡ç†å™¨
  yum:
    name: "{{ package_name }}"
    state: present
  when: ansible_os_family == "RedHat"
```

**ğŸ”¸ åœ¨å¾ªç¯ä¸­ä½¿ç”¨å˜é‡**
```yaml
- name: æ‰¹é‡åˆ›å»ºç”¨æˆ·
  user:
    name: "{{ item.name }}"
    home: "/home/{{ item.name }}"
    shell: "{{ item.shell | default('/bin/bash') }}"
  with_items: "{{ user_list }}"
```

### 6.2 å˜é‡é»˜è®¤å€¼ä¸è¿‡æ»¤å™¨


**ğŸ”¸ è®¾ç½®é»˜è®¤å€¼**
```yaml
# å¦‚æœå˜é‡æœªå®šä¹‰ï¼Œä½¿ç”¨é»˜è®¤å€¼
- name: ä½¿ç”¨é»˜è®¤ç«¯å£
  lineinfile:
    path: /etc/config
    line: "port={{ web_port | default(8080) }}"

# å¦‚æœå˜é‡ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å€¼  
- name: è®¾ç½®ç”¨æˆ·Shell
  user:
    name: "{{ username }}"
    shell: "{{ user_shell | default('/bin/bash') }}"
```

**ğŸ”¸ å¸¸ç”¨è¿‡æ»¤å™¨æŠ€å·§**
```yaml
# å­—ç¬¦ä¸²å¤„ç†
- debug: msg="ç”¨æˆ·åå¤§å†™ï¼š{{ username | upper }}"
- debug: msg="è·¯å¾„å°å†™ï¼š{{ file_path | lower }}"

# åˆ—è¡¨å¤„ç†  
- debug: msg="ç”¨æˆ·æ€»æ•°ï¼š{{ user_list | length }}"
- debug: msg="ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼š{{ user_list | first }}"

# æ•°å€¼å¤„ç†
- debug: msg="å†…å­˜å¤§å°MBï¼š{{ memory_gb | int * 1024 }}"
```

### 6.3 å˜é‡åœ¨æ¨¡æ¿ä¸­çš„åº”ç”¨


**ğŸ”¸ Jinja2æ¨¡æ¿åŸºç¡€**
```jinja2
{# æ¨¡æ¿æ–‡ä»¶ï¼šnginx.conf.j2 #}
server {
    listen {{ web_port }};
    server_name {{ server_name }};
    
    root {{ document_root }};
    
    {% if ssl_enabled %}
    listen 443 ssl;
    ssl_certificate {{ ssl_cert_path }};
    ssl_certificate_key {{ ssl_key_path }};
    {% endif %}
    
    {% for location in custom_locations %}
    location {{ location.path }} {
        {{ location.config }}
    }
    {% endfor %}
}
```

**ğŸ”¸ åœ¨å‰§æœ¬ä¸­ä½¿ç”¨æ¨¡æ¿**
```yaml
- name: ç”ŸæˆNginxé…ç½®æ–‡ä»¶
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/sites-available/{{ site_name }}
  vars:
    web_port: 80
    server_name: "{{ ansible_hostname }}.example.com"
    document_root: "/var/www/{{ site_name }}"
    ssl_enabled: "{{ enable_ssl | default(false) }}"
  notify: reload nginx
```

### 6.4 å˜é‡è°ƒè¯•æŠ€å·§


**ğŸ”¸ æŸ¥çœ‹å˜é‡å€¼**
```yaml
- name: æ˜¾ç¤ºæ‰€æœ‰ä¸»æœºå˜é‡
  debug:
    var: hostvars[inventory_hostname]

- name: æ˜¾ç¤ºç‰¹å®šå˜é‡
  debug:
    msg: "Webç«¯å£è®¾ç½®ä¸ºï¼š{{ web_port }}"

- name: æ˜¾ç¤ºå˜é‡ç±»å‹  
  debug:
    msg: "ç”¨æˆ·åˆ—è¡¨ç±»å‹ï¼š{{ user_list | type_debug }}"
```

**ğŸ”¸ å˜é‡å­˜åœ¨æ€§æ£€æŸ¥**
```yaml
- name: æ£€æŸ¥å¿…éœ€å˜é‡æ˜¯å¦å®šä¹‰
  fail:
    msg: "å¿…é¡»å®šä¹‰database_passwordå˜é‡"
  when: database_password is not defined

- name: å˜é‡å€¼æœ‰æ•ˆæ€§æ£€æŸ¥
  fail:
    msg: "ç«¯å£å·å¿…é¡»åœ¨1024-65535èŒƒå›´å†…"
  when: web_port < 1024 or web_port > 65535
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å˜é‡æœ¬è´¨ï¼šå­˜å‚¨å¯é‡å¤ä½¿ç”¨ä¿¡æ¯çš„"å®¹å™¨"
ğŸ”¸ å‘½åè§„èŒƒï¼šå­—æ¯å¼€å¤´ã€ä¸‹åˆ’çº¿åˆ†éš”ã€è§åçŸ¥æ„
ğŸ”¸ å¼•ç”¨è¯­æ³•ï¼š{{ å˜é‡å }}ï¼Œæ³¨æ„å¼•å·ä½¿ç”¨
ğŸ”¸ ä½œç”¨åŸŸæ¦‚å¿µï¼šå…¨å±€ã€ç»„ã€ä¸»æœºã€å‰§æœ¬ã€ä»»åŠ¡äº”ä¸ªå±‚æ¬¡
ğŸ”¸ ä¼˜å…ˆçº§è§„åˆ™ï¼šå‘½ä»¤è¡Œ > ä»»åŠ¡ > å‰§æœ¬ > ä¸»æœº > ç»„ > å…¨å±€
ğŸ”¸ å®šä¹‰æ–¹å¼ï¼švarsã€vars_filesã€å¤–éƒ¨æ–‡ä»¶ã€å‘½ä»¤è¡Œä¼ é€’
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ç”¨å˜é‡**
```
è§£å†³é—®é¢˜ï¼š
- é¿å…é‡å¤ï¼šåŒæ ·çš„å€¼ä¸ç”¨é‡å¤å†™
- æé«˜çµæ´»æ€§ï¼šç¯å¢ƒåˆ‡æ¢åªéœ€æ”¹å˜é‡
- ä¾¿äºç»´æŠ¤ï¼šç»Ÿä¸€ä¿®æ”¹ï¼Œé™ä½å‡ºé”™ç‡
- å¢å¼ºå¯è¯»æ€§ï¼šç”¨æœ‰æ„ä¹‰çš„åå­—ä»£æ›¿é­”æ³•æ•°å­—
```

**ğŸ”¹ å¦‚ä½•é€‰æ‹©å˜é‡ç±»å‹**
```
é€‰æ‹©åŸåˆ™ï¼š
- æ‰€æœ‰ç¯å¢ƒé€šç”¨ â†’ å…¨å±€å˜é‡ï¼ˆgroup_vars/allï¼‰
- ç‰¹å®šæœåŠ¡å™¨ç»„ â†’ ç»„å˜é‡ï¼ˆgroup_vars/ç»„åï¼‰  
- å•å°æœåŠ¡å™¨ â†’ ä¸»æœºå˜é‡ï¼ˆhost_vars/ä¸»æœºåï¼‰
- å•ä¸ªå‰§æœ¬ â†’ å‰§æœ¬å˜é‡ï¼ˆvarsï¼‰
- ä¸´æ—¶è°ƒæ•´ â†’ å‘½ä»¤è¡Œå˜é‡ï¼ˆ-eï¼‰
```

**ğŸ”¹ å˜é‡ä¼˜å…ˆçº§çš„å®é™…æ„ä¹‰**
```
è®¾è®¡æ€æƒ³ï¼š
å…·ä½“çš„è®¾ç½®åº”è¯¥èƒ½è¦†ç›–é€šç”¨çš„è®¾ç½®
ä¸´æ—¶çš„è°ƒæ•´åº”è¯¥èƒ½è¦†ç›–å›ºå®šçš„é…ç½®
è¿è¡Œæ—¶çš„å‚æ•°åº”è¯¥èƒ½è¦†ç›–å®šä¹‰æ—¶çš„å€¼
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å˜é‡ç»„ç»‡æœ€ä½³å®è·µ**
```
ğŸ“ æ¨èçš„ç›®å½•ç»“æ„ï¼š
inventory/
â”œâ”€â”€ group_vars/
â”‚   â”œâ”€â”€ all          # å…¨å±€å˜é‡
â”‚   â”œâ”€â”€ webservers   # WebæœåŠ¡å™¨ç»„å˜é‡  
â”‚   â””â”€â”€ databases    # æ•°æ®åº“ç»„å˜é‡
â”œâ”€â”€ host_vars/
â”‚   â”œâ”€â”€ web1         # ä¸»æœºç‰¹å®šå˜é‡
â”‚   â””â”€â”€ db1          
â””â”€â”€ vars/
    â”œâ”€â”€ common.yml   # å…±ç”¨å˜é‡æ–‡ä»¶
    â””â”€â”€ sensitive.yml # æ•æ„Ÿå˜é‡æ–‡ä»¶
```

**ğŸ”§ å˜é‡ä½¿ç”¨æŠ€å·§**
```
âœ… åˆç†å‘½åï¼šç”¨æè¿°æ€§åç§°ï¼Œä¿æŒä¸€è‡´é£æ ¼
âœ… è®¾ç½®é»˜è®¤å€¼ï¼šç”¨defaultè¿‡æ»¤å™¨é¿å…æœªå®šä¹‰é”™è¯¯
âœ… åˆ†å±‚ç®¡ç†ï¼šæŒ‰ä½œç”¨åŸŸåˆç†åˆ†é…å˜é‡ä½ç½®
âœ… æ–‡æ¡£è¯´æ˜ï¼šåœ¨å˜é‡æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šè¯´æ˜ç”¨é€”
âœ… æ•æ„Ÿä¿¡æ¯ï¼šä½¿ç”¨Ansible VaultåŠ å¯†æ•æ„Ÿå˜é‡
```

**âš ï¸ å¸¸è§é™·é˜±é¿å…**
```
âŒ å˜é‡åå†²çªï¼šä¸åŒå±‚çº§å®šä¹‰åŒåå˜é‡å¯¼è‡´æ··ä¹±
âŒ å¼•ç”¨é”™è¯¯ï¼šå¿˜è®°ç”¨å¼•å·åŒ…å›´å˜é‡å¼•ç”¨
âŒ ä½œç”¨åŸŸæ··æ·†ï¼šåœ¨é”™è¯¯çš„å±‚çº§å®šä¹‰å˜é‡
âŒ ç¡¬ç¼–ç ï¼šç›´æ¥å†™æ­»å€¼è€Œä¸ä½¿ç”¨å˜é‡
âŒ è¿‡åº¦ä½¿ç”¨ï¼šç®€å•çš„å€¼ä¹Ÿè¦ç”¨å˜é‡ï¼Œå¢åŠ å¤æ‚åº¦
```

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ›¤ï¸ æŒæ¡é¡ºåº**
```
Level 1 åŸºç¡€ç†è§£ï¼š
- æ˜ç™½ä»€ä¹ˆæ˜¯å˜é‡ï¼Œä¸ºä»€ä¹ˆè¦ç”¨
- å­¦ä¼šåŸºæœ¬çš„å®šä¹‰å’Œå¼•ç”¨è¯­æ³•
- ç†è§£ä¸åŒç±»å‹å˜é‡çš„ç”¨é€”

Level 2 ç†Ÿç»ƒåº”ç”¨ï¼š  
- æŒæ¡å˜é‡ä¼˜å…ˆçº§å’Œä½œç”¨åŸŸ
- èƒ½å¤Ÿåˆç†é€‰æ‹©å˜é‡å®šä¹‰ä½ç½®
- å­¦ä¼šä½¿ç”¨è¿‡æ»¤å™¨å’Œé»˜è®¤å€¼

Level 3 é«˜çº§æŠ€å·§ï¼š
- åœ¨æ¨¡æ¿ä¸­çµæ´»ä½¿ç”¨å˜é‡
- æŒæ¡å˜é‡è°ƒè¯•å’Œé”™è¯¯å¤„ç†
- å»ºç«‹å®Œæ•´çš„å˜é‡ç®¡ç†ä½“ç³»
```

**ğŸ¯ å®è·µç»ƒä¹ å»ºè®®**
```
ğŸ”§ åŠ¨æ‰‹ç»ƒä¹ ï¼š
1. åˆ›å»ºç®€å•çš„å‰§æœ¬ï¼Œä½“éªŒä¸åŒå˜é‡å®šä¹‰æ–¹å¼
2. è®¾è®¡å¤šç¯å¢ƒéƒ¨ç½²ï¼Œç†è§£å˜é‡ä¼˜å…ˆçº§
3. ç¼–å†™æ¨¡æ¿æ–‡ä»¶ï¼Œç»ƒä¹ å˜é‡åœ¨æ¨¡æ¿ä¸­çš„ä½¿ç”¨
4. æ­å»ºå®Œæ•´é¡¹ç›®ï¼Œå»ºç«‹è§„èŒƒçš„å˜é‡ç®¡ç†ç»“æ„

ğŸ“Š æ£€éªŒæ ‡å‡†ï¼š
- èƒ½è§£é‡Šå„ç§å˜é‡çš„ä½œç”¨åŸŸå’Œç”¨é€”
- èƒ½åˆç†è®¾è®¡å˜é‡çš„ç»„ç»‡ç»“æ„
- èƒ½å¤„ç†å˜é‡ç›¸å…³çš„å¸¸è§é—®é¢˜
- èƒ½ç¼–å†™æ˜“ç»´æŠ¤çš„å˜é‡åŒ–å‰§æœ¬
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ğŸ§  å˜é‡è®°å¿†æ³•ï¼š
- å®¹å™¨å­˜ä¿¡æ¯ï¼Œé‡å¤ä½¿ç”¨çœåŠ›æ°”
- å‘½åè¦è§„èŒƒï¼Œå¼•ç”¨åŠ èŠ±æ‹¬å·å¯¹  
- ä½œç”¨åŸŸåˆ†å±‚ï¼Œä¼˜å…ˆçº§è¦ç‰¢è®°
- åˆç†é€‰ä½ç½®ï¼Œçµæ´»åˆä¾¿åˆ©
```