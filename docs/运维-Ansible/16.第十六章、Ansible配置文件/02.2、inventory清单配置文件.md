---
title: 2ã€inventoryæ¸…å•é…ç½®æ–‡ä»¶
---
## ğŸ“š ç›®å½•

1. [Inventoryæ¸…å•æ–‡ä»¶åŸºç¡€æ¦‚å¿µ](#1-inventoryæ¸…å•æ–‡ä»¶åŸºç¡€æ¦‚å¿µ)
2. [é»˜è®¤æ¸…å•æ–‡ä»¶è¯¦è§£](#2-é»˜è®¤æ¸…å•æ–‡ä»¶è¯¦è§£)
3. [æ¸…å•æ–‡ä»¶æ ¼å¼å¯¹æ¯”](#3-æ¸…å•æ–‡ä»¶æ ¼å¼å¯¹æ¯”)
4. [ä¸»æœºè¿æ¥å‚æ•°é…ç½®](#4-ä¸»æœºè¿æ¥å‚æ•°é…ç½®)
5. [å˜é‡ç®¡ç†ç›®å½•ç»“æ„](#5-å˜é‡ç®¡ç†ç›®å½•ç»“æ„)
6. [é™æ€æ¸…å•å®æˆ˜é…ç½®](#6-é™æ€æ¸…å•å®æˆ˜é…ç½®)
7. [åŠ¨æ€æ¸…å•å…¥é—¨æŒ‡å—](#7-åŠ¨æ€æ¸…å•å…¥é—¨æŒ‡å—)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Inventoryæ¸…å•æ–‡ä»¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Inventoryæ¸…å•æ–‡ä»¶


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ æ˜¯ä¸€ä¸ªå¿«é€’å‘˜ï¼Œæ‰‹é‡Œæœ‰ä¸€ä¸ªåœ°å€ç°¿ï¼Œè®°å½•äº†è¦é€è´§çš„æ‰€æœ‰å®¢æˆ·åœ°å€ã€‚Ansibleçš„Inventoryæ¸…å•æ–‡ä»¶å°±æ˜¯è¿™æ ·ä¸€ä¸ª"åœ°å€ç°¿"ï¼Œè®°å½•äº†ä½ è¦ç®¡ç†çš„æ‰€æœ‰æœåŠ¡å™¨ä¿¡æ¯ã€‚

```
ç±»æ¯”è¯´æ˜ï¼š
å¿«é€’å‘˜çš„åœ°å€ç°¿     â†â†’     Ansibleçš„æ¸…å•æ–‡ä»¶
â”œâ”€ å®¢æˆ·å§“å        â†â†’     â”œâ”€ æœåŠ¡å™¨åç§°  
â”œâ”€ è¯¦ç»†åœ°å€        â†â†’     â”œâ”€ IPåœ°å€
â”œâ”€ è”ç³»ç”µè¯        â†â†’     â”œâ”€ è¿æ¥ç«¯å£
â””â”€ å¤‡æ³¨ä¿¡æ¯        â†â†’     â””â”€ è¿æ¥å‚æ•°
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **ğŸ¯ ç›®æ ‡å®šä½**ï¼šå‘Šè¯‰Ansibleè¦ç®¡ç†å“ªäº›æœåŠ¡å™¨
- **ğŸ“‹ ä¿¡æ¯ç®¡ç†**ï¼šå­˜å‚¨æ¯å°æœåŠ¡å™¨çš„è¿æ¥ä¿¡æ¯
- **ğŸ·ï¸ åˆ†ç»„ç®¡ç†**ï¼šæŠŠæœåŠ¡å™¨æŒ‰ç”¨é€”åˆ†ç»„ï¼Œæ–¹ä¾¿æ‰¹é‡æ“ä½œ
- **âš™ï¸ å‚æ•°é…ç½®**ï¼šä¸ºä¸åŒæœåŠ¡å™¨è®¾ç½®ä¸“é—¨çš„è¿æ¥å‚æ•°

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¸…å•æ–‡ä»¶


**å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š
```
å‡è®¾ä½ ç®¡ç†ä¸€ä¸ªç”µå•†ç½‘ç«™ï¼Œæœ‰è¿™äº›æœåŠ¡å™¨ï¼š
â”œâ”€ WebæœåŠ¡å™¨ï¼šè´Ÿè´£ç”¨æˆ·è®¿é—®ï¼ˆ3å°ï¼‰
â”œâ”€ æ•°æ®åº“æœåŠ¡å™¨ï¼šå­˜å‚¨æ•°æ®ï¼ˆ2å°ï¼‰  
â”œâ”€ ç¼“å­˜æœåŠ¡å™¨ï¼šæå‡é€Ÿåº¦ï¼ˆ2å°ï¼‰
â””â”€ è´Ÿè½½å‡è¡¡å™¨ï¼šåˆ†å‘è¯·æ±‚ï¼ˆ1å°ï¼‰

æ²¡æœ‰æ¸…å•æ–‡ä»¶ï¼šæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨æŒ‡å®šIPåœ°å€ï¼Œå®¹æ˜“å‡ºé”™
æœ‰äº†æ¸…å•æ–‡ä»¶ï¼šä¸€ä¸ªå‘½ä»¤ç®¡ç†æ•´ç»„æœåŠ¡å™¨ï¼Œçœæ—¶çœåŠ›
```

**æ¸…å•æ–‡ä»¶çš„ä»·å€¼**ï¼š
- **ğŸ’ª æ‰¹é‡æ“ä½œ**ï¼šä¸€æ¡å‘½ä»¤åŒæ—¶ç®¡ç†å¤šå°æœåŠ¡å™¨
- **ğŸ”§ çµæ´»åˆ†ç»„**ï¼šæŒ‰ä¸šåŠ¡éœ€æ±‚çµæ´»ç»„ç»‡æœåŠ¡å™¨
- **ğŸ“ ä¿¡æ¯é›†ä¸­**ï¼šæ‰€æœ‰æœåŠ¡å™¨ä¿¡æ¯ç»Ÿä¸€ç®¡ç†
- **ğŸš€ æé«˜æ•ˆç‡**ï¼šé¿å…é‡å¤è¾“å…¥è¿æ¥ä¿¡æ¯

---

## 2. ğŸ“ é»˜è®¤æ¸…å•æ–‡ä»¶è¯¦è§£


### 2.1 /etc/ansible/hosts æ–‡ä»¶ä½ç½®


**æ–‡ä»¶è·¯å¾„è¯´æ˜**ï¼š`/etc/ansible/hosts` æ˜¯Ansibleå®‰è£…åçš„é»˜è®¤æ¸…å•æ–‡ä»¶ä½ç½®

```
ç³»ç»Ÿæ–‡ä»¶ç»“æ„ï¼š
/etc/ansible/
â”œâ”€ ansible.cfg     â† Ansibleä¸»é…ç½®æ–‡ä»¶
â”œâ”€ hosts          â† é»˜è®¤æ¸…å•æ–‡ä»¶ï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬è¦é…ç½®çš„ï¼‰
â””â”€ roles/         â† è§’è‰²å­˜æ”¾ç›®å½•
```

> **ğŸ’¡ å°è´´å£«**ï¼šè¿™ä¸ªæ–‡ä»¶é»˜è®¤å¯èƒ½æ˜¯ç©ºçš„æˆ–åªæœ‰æ³¨é‡Šï¼Œéœ€è¦ä½ è‡ªå·±æ·»åŠ æœåŠ¡å™¨ä¿¡æ¯

### 2.2 é»˜è®¤æ¸…å•æ–‡ä»¶çš„ç‰¹ç‚¹


**ä½¿ç”¨ç‰¹ç‚¹**ï¼š
- **ğŸ¯ è‡ªåŠ¨è¯†åˆ«**ï¼šæ‰§è¡Œansibleå‘½ä»¤æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶
- **ğŸ“ å…¨å±€æœ‰æ•ˆ**ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·å’Œé¡¹ç›®éƒ½æœ‰æ•ˆ
- **âš¡ æ— éœ€æŒ‡å®š**ï¼šè¿è¡Œå‘½ä»¤æ—¶ä¸ç”¨é¢å¤–æŒ‡å®šæ¸…å•æ–‡ä»¶è·¯å¾„

**ç®€å•é…ç½®ç¤ºä¾‹**ï¼š
```ini
# åœ¨ /etc/ansible/hosts æ–‡ä»¶ä¸­æ·»åŠ 
192.168.1.10
192.168.1.11
192.168.1.12
```

**éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ**ï¼š
```bash
# æµ‹è¯•æ˜¯å¦èƒ½è¿æ¥åˆ°æ¸…å•ä¸­çš„ä¸»æœº
ansible all -m ping
```

### 2.3 è‡ªå®šä¹‰æ¸…å•æ–‡ä»¶è·¯å¾„


**ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰è·¯å¾„**ï¼š
- **é¡¹ç›®éš”ç¦»**ï¼šä¸åŒé¡¹ç›®ç”¨ä¸åŒçš„æ¸…å•æ–‡ä»¶
- **æƒé™æ§åˆ¶**ï¼šé¿å…ä¿®æ”¹ç³»ç»Ÿå…¨å±€é…ç½®
- **ç‰ˆæœ¬ç®¡ç†**ï¼šæ¸…å•æ–‡ä»¶å¯ä»¥å’Œé¡¹ç›®ä»£ç ä¸€èµ·ç®¡ç†

**ä½¿ç”¨è‡ªå®šä¹‰æ¸…å•æ–‡ä»¶**ï¼š
```bash
# æ–¹å¼1ï¼šå‘½ä»¤è¡ŒæŒ‡å®š
ansible -i /path/to/my-inventory all -m ping

# æ–¹å¼2ï¼šé…ç½®æ–‡ä»¶æŒ‡å®šï¼ˆåœ¨ansible.cfgä¸­ï¼‰
[defaults]
inventory = /path/to/my-inventory
```

---

## 3. ğŸ“‹ æ¸…å•æ–‡ä»¶æ ¼å¼å¯¹æ¯”


## 3.1 INIæ ¼å¼æ¸…å• (inventory.ini)


**INIæ ¼å¼ç‰¹ç‚¹**ï¼šç±»ä¼¼Windowsçš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œç®€å•ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…

**åŸºç¡€è¯­æ³•ç»“æ„**ï¼š
```ini
# å•å°ä¸»æœº
server1.example.com

# ä¸»æœºç»„
[webservers]
web1.example.com
web2.example.com

[databases]  
db1.example.com
db2.example.com
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```ini
# ç”µå•†ç½‘ç«™æœåŠ¡å™¨æ¸…å•
[web]
web01 ansible_host=192.168.1.10
web02 ansible_host=192.168.1.11  
web03 ansible_host=192.168.1.12

[database]
db01 ansible_host=192.168.1.20
db02 ansible_host=192.168.1.21

[cache]
redis01 ansible_host=192.168.1.30
redis02 ansible_host=192.168.1.31
```

**INIæ ¼å¼ä¼˜ç¼ºç‚¹**ï¼š
| ä¼˜ç‚¹ âœ… | ç¼ºç‚¹ âŒ |
|---------|---------|
| è¯­æ³•ç®€å•æ˜“æ‡‚ | å¤æ‚åµŒå¥—ç»“æ„è¡¨è¾¾å›°éš¾ |
| é…ç½®ç›´è§‚æ¸…æ™° | å˜é‡å±‚æ¬¡æœ‰é™ |
| ä¸Šæ‰‹å®¹æ˜“ | å¤§é‡æ•°æ®æ—¶æ˜¾å¾—å†—é•¿ |

## 3.2 YAMLæ ¼å¼æ¸…å• (inventory.yml)


**YAMLæ ¼å¼ç‰¹ç‚¹**ï¼šç°ä»£é…ç½®æ–‡ä»¶çš„ä¸»æµæ ¼å¼ï¼Œå±‚æ¬¡æ¸…æ™°ï¼ŒåŠŸèƒ½å¼ºå¤§

**åŸºç¡€è¯­æ³•ç»“æ„**ï¼š
```yaml
all:
  children:
    webservers:
      hosts:
        web1.example.com:
        web2.example.com:
    databases:
      hosts:
        db1.example.com:
        db2.example.com:
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```yaml
all:
  children:
    web:
      hosts:
        web01:
          ansible_host: 192.168.1.10
        web02:
          ansible_host: 192.168.1.11
      vars:
        http_port: 80
        
    database:
      hosts:
        db01:
          ansible_host: 192.168.1.20
          mysql_port: 3306
        db02:
          ansible_host: 192.168.1.21  
          mysql_port: 3306
```

**YAMLæ ¼å¼ä¼˜ç¼ºç‚¹**ï¼š
| ä¼˜ç‚¹ âœ… | ç¼ºç‚¹ âŒ |
|---------|---------|
| å±‚æ¬¡ç»“æ„æ¸…æ™° | è¯­æ³•è¦æ±‚ä¸¥æ ¼ï¼ˆç¼©è¿›æ•æ„Ÿï¼‰ |
| æ”¯æŒå¤æ‚æ•°æ®ç»“æ„ | åˆå­¦è€…å®¹æ˜“å‡ºé”™ |
| ç°ä»£åŒ–æ ‡å‡†æ ¼å¼ | è°ƒè¯•ç›¸å¯¹å›°éš¾ |

## 3.3 JSONæ ¼å¼æ¸…å• (inventory.json)


**JSONæ ¼å¼ç‰¹ç‚¹**ï¼šç¨‹åºåŒ–ç”Ÿæˆæ¸…å•æ–‡ä»¶æ—¶å¸¸ç”¨ï¼Œé€‚åˆåŠ¨æ€æ¸…å•

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```json
{
  "web": {
    "hosts": ["web01", "web02"],
    "vars": {
      "http_port": 80
    }
  },
  "database": {
    "hosts": ["db01", "db02"],
    "vars": {
      "mysql_port": 3306
    }
  },
  "_meta": {
    "hostvars": {
      "web01": {"ansible_host": "192.168.1.10"},
      "web02": {"ansible_host": "192.168.1.11"},
      "db01": {"ansible_host": "192.168.1.20"},
      "db02": {"ansible_host": "192.168.1.21"}
    }
  }
}
```

**æ ¼å¼é€‰æ‹©å»ºè®®**ï¼š
```
ğŸ¯ æ–°æ‰‹å…¥é—¨ â†’ é€‰æ‹©INIæ ¼å¼
   - è¯­æ³•ç®€å•ï¼Œå®¹æ˜“ç†è§£
   - å‡ºé”™æ¦‚ç‡ä½

ğŸ¯ é¡¹ç›®å¼€å‘ â†’ é€‰æ‹©YAMLæ ¼å¼  
   - åŠŸèƒ½å¼ºå¤§ï¼Œæ‰©å±•æ€§å¥½
   - ç°ä»£åŒ–é¡¹ç›®æ ‡å‡†

ğŸ¯ ç¨‹åºç”Ÿæˆ â†’ é€‰æ‹©JSONæ ¼å¼
   - ç¨‹åºå¤„ç†æ–¹ä¾¿
   - åŠ¨æ€æ¸…å•é¦–é€‰
```

---

## 4. ğŸ” ä¸»æœºè¿æ¥å‚æ•°é…ç½®


### 4.1 åŸºæœ¬è¿æ¥å‚æ•°è¯¦è§£


**ansible_host - ä¸»æœºè¿æ¥åœ°å€**
```ini
# å«ä¹‰ï¼šå‘Šè¯‰Ansibleå®é™…è¦è¿æ¥çš„IPåœ°å€æˆ–åŸŸå
# åœºæ™¯ï¼šå½“ä¸»æœºåå’Œå®é™…è¿æ¥åœ°å€ä¸åŒæ—¶ä½¿ç”¨

[webservers]
web-server-01 ansible_host=192.168.1.100
web-server-02 ansible_host=192.168.1.101
production-web ansible_host=web.company.com
```

> **ğŸ’¡ å®ç”¨åœºæ™¯**ï¼šæ¯”å¦‚ä½ çš„æœåŠ¡å™¨åœ¨å…¬å¸å†…éƒ¨å«"web-01"ï¼Œä½†å®é™…IPæ˜¯"192.168.1.100"ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨`ansible_host`æŒ‡å®šçœŸå®åœ°å€ã€‚

**ansible_port - SSHè¿æ¥ç«¯å£**
```ini  
# å«ä¹‰ï¼šæŒ‡å®šSSHè¿æ¥ç«¯å£ï¼ˆé»˜è®¤æ˜¯22ï¼‰
# åœºæ™¯ï¼šæœåŠ¡å™¨ä¿®æ”¹äº†é»˜è®¤SSHç«¯å£æ—¶ä½¿ç”¨

[servers]
secure-server ansible_host=192.168.1.50 ansible_port=2222
normal-server ansible_host=192.168.1.51
```

**ansible_user - è¿æ¥ç”¨æˆ·å**
```ini
# å«ä¹‰ï¼šæŒ‡å®šç™»å½•æœåŠ¡å™¨çš„ç”¨æˆ·å
# åœºæ™¯ï¼šä¸åŒæœåŠ¡å™¨ä½¿ç”¨ä¸åŒç”¨æˆ·åæ—¶

[servers]  
web01 ansible_host=192.168.1.10 ansible_user=www-data
db01 ansible_host=192.168.1.20 ansible_user=mysql
admin-server ansible_host=192.168.1.30 ansible_user=administrator
```

### 4.2 SSHè®¤è¯å‚æ•°é…ç½®


**SSHå¯†é’¥è®¤è¯ï¼ˆæ¨èæ–¹å¼ï¼‰**ï¼š
```ini
# ansible_ssh_private_key_fileï¼šæŒ‡å®šSSHç§é’¥æ–‡ä»¶è·¯å¾„
[webservers]
web01 ansible_host=192.168.1.10 ansible_ssh_private_key_file=~/.ssh/web_server_key
web02 ansible_host=192.168.1.11 ansible_ssh_private_key_file=~/.ssh/web_server_key

[databases] 
db01 ansible_host=192.168.1.20 ansible_ssh_private_key_file=~/.ssh/db_server_key
```

**SSHå¯†ç è®¤è¯ï¼ˆä¸æ¨èï¼Œä»…æµ‹è¯•ç”¨ï¼‰**ï¼š
```ini
# ansible_ssh_passï¼šç›´æ¥åœ¨æ¸…å•ä¸­å­˜å‚¨å¯†ç ï¼ˆå®‰å…¨é£é™©é«˜ï¼‰
[test-servers]
test01 ansible_host=192.168.1.100 ansible_user=testuser ansible_ssh_pass=testpass123
```

> **âš ï¸ å®‰å…¨æé†’**ï¼šå¯†ç è®¤è¯æ–¹å¼ä¼šæŠŠå¯†ç æ˜æ–‡å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œç”Ÿäº§ç¯å¢ƒå¼ºçƒˆå»ºè®®ä½¿ç”¨SSHå¯†é’¥è®¤è¯ã€‚

### 4.3 ç‰¹æ®Šè¿æ¥å‚æ•°


**ansible_become_pass - sudoå¯†ç **
```ini
# å«ä¹‰ï¼šå½“éœ€è¦sudoæƒé™æ—¶çš„å¯†ç 
# ä½¿ç”¨åœºæ™¯ï¼šç”¨æ™®é€šç”¨æˆ·è¿æ¥ï¼Œä½†éœ€è¦æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ

[webservers]
web01 ansible_host=192.168.1.10 ansible_user=deploy ansible_become_pass=sudo123
```

**ansible_python_interpreter - Pythonè§£é‡Šå™¨è·¯å¾„**
```ini
# å«ä¹‰ï¼šæŒ‡å®šç›®æ ‡ä¸»æœºä¸ŠPythonè§£é‡Šå™¨çš„è·¯å¾„
# ä½¿ç”¨åœºæ™¯ï¼šæœåŠ¡å™¨Pythonå®‰è£…è·¯å¾„éæ ‡å‡†æ—¶

[old-servers]
centos6-server ansible_host=192.168.1.40 ansible_python_interpreter=/usr/bin/python2.7

[new-servers] 
ubuntu20-server ansible_host=192.168.1.41 ansible_python_interpreter=/usr/bin/python3
```

### 4.4 è¿æ¥å‚æ•°é…ç½®ç¤ºä¾‹


**å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹**ï¼š
```ini
# ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨æ¸…å•
[web-production]
web-prod-01 ansible_host=10.0.1.10 ansible_user=deploy ansible_ssh_private_key_file=~/.ssh/prod_key
web-prod-02 ansible_host=10.0.1.11 ansible_user=deploy ansible_ssh_private_key_file=~/.ssh/prod_key

[database-production]  
db-prod-01 ansible_host=10.0.2.10 ansible_user=dbadmin ansible_ssh_private_key_file=~/.ssh/db_key ansible_port=2222

[test-environment]
test-web ansible_host=192.168.1.100 ansible_user=testuser ansible_ssh_pass=temp123
test-db ansible_host=192.168.1.101 ansible_user=testuser ansible_ssh_pass=temp123
```

---

## 5. ğŸ“‚ å˜é‡ç®¡ç†ç›®å½•ç»“æ„


### 5.1 å˜é‡ç®¡ç†çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦å˜é‡ç®¡ç†**ï¼š
æƒ³è±¡ä½ ç®¡ç†100å°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨çš„é…ç½®å¯èƒ½ç•¥æœ‰ä¸åŒï¼š
- WebæœåŠ¡å™¨ç«¯å£å¯èƒ½æ˜¯80ã€8080ã€8081
- æ•°æ®åº“æœåŠ¡å™¨å†…å­˜é…ç½®ä¸åŒ
- ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶è·¯å¾„ä¸åŒ

å¦‚æœæ¯æ¬¡éƒ½å†™æ­»åœ¨å‰§æœ¬ä¸­ï¼Œä¿®æ”¹èµ·æ¥å°±æ˜¯å™©æ¢¦ã€‚å˜é‡ç®¡ç†è®©é…ç½®æ›´çµæ´»ã€‚

### 5.2 host_vars ä¸»æœºå˜é‡ç›®å½•


**ç›®å½•ä½œç”¨**ï¼šä¸ºå•å°ä¸»æœºè®¾ç½®ä¸“å±å˜é‡

**ç›®å½•ç»“æ„ç¤ºä¾‹**ï¼š
```
project/
â”œâ”€ inventory.ini          â† æ¸…å•æ–‡ä»¶
â”œâ”€ host_vars/            â† ä¸»æœºå˜é‡ç›®å½•
   â”œâ”€ web01.yml          â† web01ä¸»æœºçš„ä¸“å±å˜é‡  
   â”œâ”€ web02.yml          â† web02ä¸»æœºçš„ä¸“å±å˜é‡
   â”œâ”€ db01.yml           â† db01ä¸»æœºçš„ä¸“å±å˜é‡
   â””â”€ db02.yml           â† db02ä¸»æœºçš„ä¸“å±å˜é‡
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š

æ¸…å•æ–‡ä»¶ `inventory.ini`ï¼š
```ini
[webservers]
web01 ansible_host=192.168.1.10
web02 ansible_host=192.168.1.11

[databases]
db01 ansible_host=192.168.1.20  
db02 ansible_host=192.168.1.21
```

ä¸»æœºå˜é‡ `host_vars/web01.yml`ï¼š
```yaml
# web01æœåŠ¡å™¨çš„ä¸“å±é…ç½®
nginx_port: 80
max_connections: 1000
server_name: web01.company.com
ssl_enabled: false
```

ä¸»æœºå˜é‡ `host_vars/db01.yml`ï¼š
```yaml  
# db01æ•°æ®åº“æœåŠ¡å™¨çš„ä¸“å±é…ç½®
mysql_port: 3306
max_connections: 500
memory_limit: 8G
backup_schedule: "2 3 * * *"
```

### 5.3 group_vars ç»„å˜é‡ç›®å½•


**ç›®å½•ä½œç”¨**ï¼šä¸ºæ•´ä¸ªæœåŠ¡å™¨ç»„è®¾ç½®å…±åŒå˜é‡

**ç›®å½•ç»“æ„ç¤ºä¾‹**ï¼š
```
project/
â”œâ”€ inventory.ini          â† æ¸…å•æ–‡ä»¶
â”œâ”€ group_vars/           â† ç»„å˜é‡ç›®å½•
   â”œâ”€ webservers.yml     â† webserversç»„çš„å…±åŒå˜é‡
   â”œâ”€ databases.yml      â† databasesç»„çš„å…±åŒå˜é‡
   â”œâ”€ all.yml            â† æ‰€æœ‰ä¸»æœºçš„å…±åŒå˜é‡
   â””â”€ production.yml     â† productionç»„çš„å˜é‡
```

**å®é™…é…ç½®ç¤ºä¾‹**ï¼š

ç»„å˜é‡ `group_vars/webservers.yml`ï¼š
```yaml
# æ‰€æœ‰WebæœåŠ¡å™¨çš„å…±åŒé…ç½®
http_timeout: 30
log_level: info
backup_enabled: true
monitoring_agent: zabbix

# WebæœåŠ¡å™¨è½¯ä»¶ç‰ˆæœ¬
nginx_version: "1.18"
php_version: "7.4"
```

ç»„å˜é‡ `group_vars/databases.yml`ï¼š
```yaml
# æ‰€æœ‰æ•°æ®åº“æœåŠ¡å™¨çš„å…±åŒé…ç½®
backup_retention: 30
log_slow_queries: true
performance_monitoring: true

# æ•°æ®åº“è½¯ä»¶ç‰ˆæœ¬
mysql_version: "8.0"  
```

å…¨å±€å˜é‡ `group_vars/all.yml`ï¼š
```yaml
# æ‰€æœ‰æœåŠ¡å™¨çš„å…±åŒé…ç½®
timezone: "Asia/Shanghai"
ntp_server: "ntp.company.com"
admin_email: "admin@company.com"
monitoring_enabled: true
```

### 5.4 å˜é‡ä¼˜å…ˆçº§ç†è§£


**å˜é‡ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰**ï¼š
```
1. å‘½ä»¤è¡Œå˜é‡ (-e å‚æ•°)           â† æœ€é«˜ä¼˜å…ˆçº§
2. ä»»åŠ¡å˜é‡ (task vars)
3. å‰§æœ¬å˜é‡ (playbook vars)  
4. ä¸»æœºå˜é‡ (host_vars/)         â† ä¸»æœºä¸“å±é…ç½®
5. ç»„å˜é‡ (group_vars/)          â† ç»„å…±åŒé…ç½®  
6. æ¸…å•æ–‡ä»¶å˜é‡                   â† æœ€ä½ä¼˜å…ˆçº§
```

**å®é™…åº”ç”¨ç†è§£**ï¼š
```yaml
# å‡è®¾æœ‰è¿™æ ·çš„é…ç½®ï¼š
# group_vars/webservers.yml
nginx_port: 80

# host_vars/web01.yml  
nginx_port: 8080

# ç»“æœï¼šweb01ä½¿ç”¨8080ç«¯å£ï¼Œå…¶ä»–WebæœåŠ¡å™¨ä½¿ç”¨80ç«¯å£
# åŸå› ï¼šä¸»æœºå˜é‡ä¼˜å…ˆçº§é«˜äºç»„å˜é‡
```

---

## 6. âš™ï¸ é™æ€æ¸…å•å®æˆ˜é…ç½®


### 6.1 ä»€ä¹ˆæ˜¯é™æ€æ¸…å•


**é€šä¿—ç†è§£**ï¼šé™æ€æ¸…å•å°±åƒæ˜¯æ‰‹å·¥ç¼–å†™çš„é€šè®¯å½•ï¼Œä½ éœ€è¦æ‰‹åŠ¨æ·»åŠ æ¯ä¸ªè”ç³»äººçš„ä¿¡æ¯ã€‚ä¸€æ—¦å†™å¥½ï¼Œé™¤éä½ æ‰‹åŠ¨ä¿®æ”¹ï¼Œå¦åˆ™å†…å®¹ä¸ä¼šå˜åŒ–ã€‚

**é™æ€æ¸…å•ç‰¹ç‚¹**ï¼š
- **ğŸ“ æ‰‹å·¥ç»´æŠ¤**ï¼šæœåŠ¡å™¨ä¿¡æ¯éœ€è¦æ‰‹åŠ¨æ·»åŠ å’Œæ›´æ–°
- **ğŸ’° æˆæœ¬ä½**ï¼šä¸éœ€è¦é¢å¤–çš„ç¨‹åºæˆ–æœåŠ¡
- **ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼šæœåŠ¡å™¨æ•°é‡å›ºå®šï¼Œå˜åŒ–ä¸é¢‘ç¹çš„ç¯å¢ƒ

### 6.2 ä¼ä¸šçº§é™æ€æ¸…å•é…ç½®å®ä¾‹


**åœºæ™¯æè¿°**ï¼šå‡è®¾ä½ åœ¨ä¸€å®¶ç”µå•†å…¬å¸ï¼Œéœ€è¦ç®¡ç†ä»¥ä¸‹æœåŠ¡å™¨ï¼š
- 3å°WebæœåŠ¡å™¨ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
- 2å°æ•°æ®åº“æœåŠ¡å™¨ï¼ˆä¸»ä»å¤åˆ¶ï¼‰  
- 2å°ç¼“å­˜æœåŠ¡å™¨ï¼ˆRedisé›†ç¾¤ï¼‰
- 1å°ç›‘æ§æœåŠ¡å™¨
- 1å°è·³æ¿æœºï¼ˆå ¡å’æœºï¼‰

**å®Œæ•´é…ç½®ç¤ºä¾‹ `inventory/production.ini`**ï¼š
```ini
# ================================
# ç”µå•†ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨æ¸…å•
# ================================

# è·³æ¿æœºï¼ˆå ¡å’æœºï¼‰
[jumpserver]
jump-01 ansible_host=203.0.113.10 ansible_user=admin ansible_port=2222

# WebæœåŠ¡å™¨é›†ç¾¤
[webservers]
web-prod-01 ansible_host=10.0.1.11 ansible_user=www-data
web-prod-02 ansible_host=10.0.1.12 ansible_user=www-data  
web-prod-03 ansible_host=10.0.1.13 ansible_user=www-data

# æ•°æ®åº“æœåŠ¡å™¨ï¼ˆä¸»ä»ï¼‰
[databases]
db-master ansible_host=10.0.2.11 ansible_user=dbadmin mysql_role=master
db-slave ansible_host=10.0.2.12 ansible_user=dbadmin mysql_role=slave

# ç¼“å­˜æœåŠ¡å™¨é›†ç¾¤
[cache]
redis-01 ansible_host=10.0.3.11 ansible_user=redis redis_role=master  
redis-02 ansible_host=10.0.3.12 ansible_user=redis redis_role=slave

# ç›‘æ§æœåŠ¡å™¨
[monitoring]
monitor-01 ansible_host=10.0.4.11 ansible_user=monitor

# ================================
# æœåŠ¡å™¨ç»„åˆç®¡ç†
# ================================

# æ‰€æœ‰åº”ç”¨æœåŠ¡å™¨
[application:children]
webservers
databases
cache

# æ‰€æœ‰ç”Ÿäº§æœåŠ¡å™¨
[production:children]  
application
monitoring
jumpserver

# ================================
# ç¯å¢ƒåŒºåˆ†
# ================================

# å¼€å‘ç¯å¢ƒæœåŠ¡å™¨
[development]
dev-web ansible_host=192.168.1.10 ansible_user=developer
dev-db ansible_host=192.168.1.11 ansible_user=developer

# æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨  
[staging]
test-web ansible_host=192.168.2.10 ansible_user=tester
test-db ansible_host=192.168.2.11 ansible_user=tester
```

### 6.3 é…åˆå˜é‡ç›®å½•çš„å®Œæ•´é…ç½®


**ç›®å½•ç»“æ„**ï¼š
```
ecommerce-infrastructure/
â”œâ”€ inventory/
â”‚  â””â”€ production.ini              â† æ¸…å•æ–‡ä»¶
â”œâ”€ group_vars/
â”‚  â”œâ”€ all.yml                     â† å…¨å±€å˜é‡
â”‚  â”œâ”€ webservers.yml             â† WebæœåŠ¡å™¨ç»„å˜é‡
â”‚  â”œâ”€ databases.yml              â† æ•°æ®åº“ç»„å˜é‡
â”‚  â”œâ”€ cache.yml                  â† ç¼“å­˜æœåŠ¡å™¨ç»„å˜é‡
â”‚  â”œâ”€ production.yml             â† ç”Ÿäº§ç¯å¢ƒå˜é‡
â”‚  â””â”€ development.yml            â† å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€ host_vars/
â”‚  â”œâ”€ db-master.yml              â† ä¸»æ•°æ®åº“ä¸“å±å˜é‡
â”‚  â”œâ”€ db-slave.yml               â† ä»æ•°æ®åº“ä¸“å±å˜é‡
â”‚  â””â”€ monitor-01.yml             â† ç›‘æ§æœåŠ¡å™¨ä¸“å±å˜é‡
â””â”€ playbooks/
   â””â”€ site.yml                   â† ä¸»å‰§æœ¬æ–‡ä»¶
```

**ç»„å˜é‡é…ç½®ç¤ºä¾‹**ï¼š

`group_vars/all.yml` - å…¨å±€é…ç½®ï¼š
```yaml
# å…¨å±€é€šç”¨é…ç½®
timezone: "Asia/Shanghai"
ntp_servers:
  - ntp1.company.com
  - ntp2.company.com

# å®‰å…¨é…ç½®
ssh_port: 22
allowed_users:
  - admin
  - deploy
  
# ç›‘æ§é…ç½®  
monitoring_enabled: true
log_retention_days: 30
```

`group_vars/webservers.yml` - WebæœåŠ¡å™¨é…ç½®ï¼š
```yaml
# Nginxé…ç½®
nginx_worker_processes: 4
nginx_worker_connections: 1024
keepalive_timeout: 65

# åº”ç”¨é…ç½®
app_port: 8080
session_timeout: 1800
max_upload_size: "100M"

# è´Ÿè½½å‡è¡¡é…ç½®
load_balancer_method: "round_robin"
health_check_interval: 10
```

`host_vars/db-master.yml` - ä¸»æ•°æ®åº“ä¸“å±é…ç½®ï¼š
```yaml
# MySQLä¸»åº“ä¸“å±é…ç½®
mysql_server_id: 1
mysql_log_bin: true
mysql_binlog_format: "ROW"

# æ€§èƒ½é…ç½®
innodb_buffer_pool_size: "6G"
max_connections: 1000

# å¤‡ä»½é…ç½®
backup_schedule: "0 2 * * *"
backup_retention: 7
```

### 6.4 é™æ€æ¸…å•çš„ç®¡ç†æŠ€å·§


**é…ç½®æ–‡ä»¶ç»„ç»‡æŠ€å·§**ï¼š
```
ğŸ¯ æŒ‰ç¯å¢ƒåˆ†ç¦»ï¼š
   - inventory/production.ini    â† ç”Ÿäº§ç¯å¢ƒ
   - inventory/staging.ini       â† æµ‹è¯•ç¯å¢ƒ  
   - inventory/development.ini   â† å¼€å‘ç¯å¢ƒ

ğŸ¯ æŒ‰åŠŸèƒ½åˆ†ç»„ï¼š
   - [frontend] [backend] [database] 
   - ä¾¿äºé’ˆå¯¹ç‰¹å®šåŠŸèƒ½æ‰§è¡Œæ“ä½œ

ğŸ¯ ä½¿ç”¨å­ç»„ï¼š
   [production:children]
   webservers
   databases
   # ä¾¿äºç®¡ç†å¤æ‚çš„æœåŠ¡å™¨å±‚æ¬¡
```

**éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®**ï¼š
```bash
# æ£€æŸ¥æ¸…å•æ–‡ä»¶è¯­æ³•
ansible-inventory -i inventory/production.ini --list

# æµ‹è¯•è¿æ¥æ€§
ansible -i inventory/production.ini all -m ping

# æŸ¥çœ‹ç‰¹å®šç»„çš„ä¸»æœº
ansible -i inventory/production.ini webservers --list-hosts
```

---

## 7. ğŸ”„ åŠ¨æ€æ¸…å•å…¥é—¨æŒ‡å—


### 7.1 ä»€ä¹ˆæ˜¯åŠ¨æ€æ¸…å•


**é€šä¿—ç†è§£**ï¼šå¦‚æœé™æ€æ¸…å•æ˜¯æ‰‹å†™çš„é€šè®¯å½•ï¼Œé‚£åŠ¨æ€æ¸…å•å°±æ˜¯æ‰‹æœºé‡Œçš„é€šè®¯å½•åŒæ­¥åŠŸèƒ½ã€‚å®ƒèƒ½è‡ªåŠ¨ä»äº‘å¹³å°ã€æ•°æ®åº“ç­‰åœ°æ–¹è·å–æœ€æ–°çš„æœåŠ¡å™¨ä¿¡æ¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ã€‚

**åŠ¨æ€æ¸…å•çš„åº”ç”¨åœºæ™¯**ï¼š
```
ğŸŒ©ï¸ äº‘ç¯å¢ƒï¼š
   - AWS EC2å®ä¾‹ç»å¸¸åˆ›å»º/åˆ é™¤
   - é˜¿é‡Œäº‘ECSè‡ªåŠ¨æ‰©ç¼©å®¹
   - æœåŠ¡å™¨IPåœ°å€åŠ¨æ€å˜åŒ–

ğŸ³ å®¹å™¨ç¯å¢ƒï¼š
   - Dockerå®¹å™¨åŠ¨æ€åˆ›å»º
   - Kubernetes Podåœ°å€å˜åŒ–
   - å¾®æœåŠ¡å®ä¾‹æ•°é‡å˜åŠ¨

ğŸ“Š CMDBç³»ç»Ÿï¼š
   - èµ„äº§ç®¡ç†ç³»ç»Ÿä¸­çš„æœåŠ¡å™¨ä¿¡æ¯
   - ç›‘æ§ç³»ç»Ÿä¸­çš„ä¸»æœºåˆ—è¡¨
   - æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å®ä¾‹
```

### 7.2 åŠ¨æ€æ¸…å•çš„å·¥ä½œåŸç†


**å·¥ä½œæµç¨‹å›¾**ï¼š
```
Ansibleå‘½ä»¤æ‰§è¡Œ
        â†“
è°ƒç”¨åŠ¨æ€æ¸…å•è„šæœ¬
        â†“
è„šæœ¬æŸ¥è¯¢å¤–éƒ¨ç³»ç»Ÿ
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â†“         â†“
 AWS API   é˜¿é‡Œäº‘API
   â†“         â†“
è·å–æœåŠ¡å™¨åˆ—è¡¨
        â†“
ç”ŸæˆJSONæ ¼å¼æ¸…å•
        â†“  
è¿”å›ç»™Ansibleä½¿ç”¨
```

**æ ¸å¿ƒæ¦‚å¿µç†è§£**ï¼š
- **ğŸ“œ æ¸…å•è„šæœ¬**ï¼šä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼ˆPythonã€Shellç­‰ï¼‰ï¼Œè´Ÿè´£è·å–æœåŠ¡å™¨ä¿¡æ¯
- **ğŸ”— å¤–éƒ¨æ•°æ®æº**ï¼šäº‘å¹³å°APIã€æ•°æ®åº“ã€é…ç½®ç®¡ç†ç³»ç»Ÿç­‰
- **ğŸ“‹ JSONè¾“å‡º**ï¼šè„šæœ¬å¿…é¡»è¾“å‡ºæ ‡å‡†çš„JSONæ ¼å¼æ¸…å•æ•°æ®
- **âš¡ å®æ—¶æ›´æ–°**ï¼šæ¯æ¬¡æ‰§è¡ŒAnsibleæ—¶éƒ½ä¼šé‡æ–°è·å–æœ€æ–°ä¿¡æ¯

### 7.3 ç®€å•çš„åŠ¨æ€æ¸…å•è„šæœ¬ç¤ºä¾‹


**PythonåŠ¨æ€æ¸…å•è„šæœ¬** `dynamic_inventory.py`ï¼š
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import json
import sys

def get_inventory():
    """
    è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åŠ¨æ€æ¸…å•ç¤ºä¾‹
    åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è°ƒç”¨APIè·å–çœŸå®çš„æœåŠ¡å™¨ä¿¡æ¯
    """
    
    # æ¨¡æ‹Ÿä»å¤–éƒ¨ç³»ç»Ÿè·å–çš„æœåŠ¡å™¨ä¿¡æ¯
    inventory = {
        # WebæœåŠ¡å™¨ç»„
        'webservers': {
            'hosts': ['web-01', 'web-02', 'web-03'],
            'vars': {
                'http_port': 80,
                'environment': 'production'
            }
        },
        
        # æ•°æ®åº“æœåŠ¡å™¨ç»„
        'databases': {
            'hosts': ['db-master', 'db-slave'],  
            'vars': {
                'mysql_port': 3306,
                'environment': 'production'
            }
        },
        
        # ä¸»æœºè¯¦ç»†ä¿¡æ¯
        '_meta': {
            'hostvars': {
                'web-01': {
                    'ansible_host': '10.0.1.11',
                    'ansible_user': 'www-data',
                    'server_role': 'primary'
                },
                'web-02': {
                    'ansible_host': '10.0.1.12', 
                    'ansible_user': 'www-data',
                    'server_role': 'secondary'
                },
                'web-03': {
                    'ansible_host': '10.0.1.13',
                    'ansible_user': 'www-data', 
                    'server_role': 'secondary'
                },
                'db-master': {
                    'ansible_host': '10.0.2.11',
                    'ansible_user': 'dbadmin',
                    'mysql_role': 'master'
                },
                'db-slave': {
                    'ansible_host': '10.0.2.12',
                    'ansible_user': 'dbadmin',
                    'mysql_role': 'slave'
                }
            }
        }
    }
    
    return inventory

def get_host_info(hostname):
    """è·å–å•ä¸ªä¸»æœºçš„è¯¦ç»†ä¿¡æ¯"""
    inventory = get_inventory()
    return inventory['_meta']['hostvars'].get(hostname, {})

def main():
    """ä¸»å‡½æ•°"""
    if len(sys.argv) == 2 and sys.argv[1] == '--list':
        # è¿”å›å®Œæ•´æ¸…å•
        inventory = get_inventory()
        print(json.dumps(inventory, indent=2))
    elif len(sys.argv) == 3 and sys.argv[1] == '--host':
        # è¿”å›å•ä¸ªä¸»æœºä¿¡æ¯
        hostname = sys.argv[2] 
        host_info = get_host_info(hostname)
        print(json.dumps(host_info, indent=2))
    else:
        print("Usage: {} --list | --host <hostname>".format(sys.argv[0]))
        sys.exit(1)

if __name__ == '__main__':
    main()
```

### 7.4 ä½¿ç”¨åŠ¨æ€æ¸…å•è„šæœ¬


**è„šæœ¬ä½¿ç”¨æ­¥éª¤**ï¼š

1. **ä½¿è„šæœ¬å¯æ‰§è¡Œ**ï¼š
```bash
chmod +x dynamic_inventory.py
```

2. **æµ‹è¯•è„šæœ¬è¾“å‡º**ï¼š
```bash
# è·å–å®Œæ•´æ¸…å•
./dynamic_inventory.py --list

# è·å–å•ä¸ªä¸»æœºä¿¡æ¯
./dynamic_inventory.py --host web-01
```

3. **åœ¨Ansibleä¸­ä½¿ç”¨**ï¼š
```bash
# ä½¿ç”¨åŠ¨æ€æ¸…å•æ‰§è¡Œå‘½ä»¤
ansible -i dynamic_inventory.py all -m ping

# ä½¿ç”¨åŠ¨æ€æ¸…å•æ‰§è¡Œå‰§æœ¬
ansible-playbook -i dynamic_inventory.py site.yml
```

### 7.5 äº‘å¹³å°åŠ¨æ€æ¸…å•å®ä¾‹


**AWS EC2åŠ¨æ€æ¸…å•é…ç½®**ï¼š

å®‰è£…AWSåŠ¨æ€æ¸…å•æ’ä»¶ï¼š
```bash
pip install boto3
```

åˆ›å»ºé…ç½®æ–‡ä»¶ `aws_ec2.yml`ï¼š
```yaml
# AWS EC2åŠ¨æ€æ¸…å•é…ç½®
plugin: aws_ec2

# AWSåŒºåŸŸ
regions:
  - us-east-1
  - us-west-2

# å®ä¾‹è¿‡æ»¤å™¨ï¼ˆåªè·å–è¿è¡Œä¸­çš„å®ä¾‹ï¼‰
filters:
  instance-state-name: running

# åˆ†ç»„è§„åˆ™
keyed_groups:
  # æŒ‰å®ä¾‹ç±»å‹åˆ†ç»„  
  - key: instance_type
    prefix: type
  # æŒ‰æ ‡ç­¾Environmentåˆ†ç»„
  - key: tags.Environment
    prefix: env
  # æŒ‰å¯ç”¨åŒºåˆ†ç»„
  - key: placement.availability_zone
    prefix: az

# ä¸»æœºåç”Ÿæˆè§„åˆ™
hostnames:
  - tag:Name        # ä¼˜å…ˆä½¿ç”¨Nameæ ‡ç­¾
  - ip-address      # å…¶æ¬¡ä½¿ç”¨IPåœ°å€
  - dns-name        # æœ€åä½¿ç”¨DNSåç§°
```

**ä½¿ç”¨AWSåŠ¨æ€æ¸…å•**ï¼š
```bash
# æµ‹è¯•æ¸…å•è·å–
ansible-inventory -i aws_ec2.yml --list

# ä½¿ç”¨åŠ¨æ€æ¸…å•ç®¡ç†AWSå®ä¾‹
ansible -i aws_ec2.yml all -m ping
```

### 7.6 åŠ¨æ€æ¸…å•vsé™æ€æ¸…å•å¯¹æ¯”


| ç‰¹æ€§å¯¹æ¯” | é™æ€æ¸…å• | åŠ¨æ€æ¸…å• |
|---------|----------|----------|
| **ç»´æŠ¤æ–¹å¼** | æ‰‹å·¥ç»´æŠ¤ | è‡ªåŠ¨è·å– |
| **é€‚ç”¨ç¯å¢ƒ** | å›ºå®šæœåŠ¡å™¨ | åŠ¨æ€ç¯å¢ƒ |
| **é…ç½®å¤æ‚åº¦** | ç®€å• â­ | å¤æ‚ â­â­â­ |
| **å®æ—¶æ€§** | æ‰‹åŠ¨æ›´æ–° | å®æ—¶åŒæ­¥ |
| **ä¾èµ–æ€§** | æ— å¤–éƒ¨ä¾èµ– | éœ€è¦å¤–éƒ¨ç³»ç»Ÿ |
| **æ€§èƒ½å¼€é”€** | æ—  | æ¯æ¬¡æŸ¥è¯¢API |
| **é”™è¯¯é£é™©** | äººå·¥é”™è¯¯ | ç½‘ç»œ/APIé”™è¯¯ |

**é€‰æ‹©å»ºè®®**ï¼š
```
ğŸ¯ é€‰æ‹©é™æ€æ¸…å•çš„æƒ…å†µï¼š
   - æœåŠ¡å™¨æ•°é‡å°‘ä¸”å›ºå®š
   - ä¼ ç»Ÿç‰©ç†æœåŠ¡å™¨ç¯å¢ƒ  
   - å›¢é˜Ÿå¯¹Ansibleåˆšå…¥é—¨
   - ä¸éœ€è¦é¢‘ç¹å˜æ›´

ğŸ¯ é€‰æ‹©åŠ¨æ€æ¸…å•çš„æƒ…å†µï¼š
   - äº‘ç¯å¢ƒï¼ŒæœåŠ¡å™¨ç»å¸¸å˜åŒ–
   - å®¹å™¨/å¾®æœåŠ¡æ¶æ„
   - å¤§è§„æ¨¡æœåŠ¡å™¨ç®¡ç†
   - ä¸CMDBç³»ç»Ÿé›†æˆ
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Inventoryæ¸…å•ï¼šAnsibleçš„"æœåŠ¡å™¨åœ°å€ç°¿"ï¼Œè®°å½•è¦ç®¡ç†çš„æ‰€æœ‰ä¸»æœºä¿¡æ¯
ğŸ”¸ é»˜è®¤æ¸…å•è·¯å¾„ï¼š/etc/ansible/hostsï¼Œç³»ç»Ÿçº§å…¨å±€é…ç½®æ–‡ä»¶
ğŸ”¸ æ¸…å•æ ¼å¼ï¼šINIï¼ˆç®€å•ï¼‰ã€YAMLï¼ˆå¼ºå¤§ï¼‰ã€JSONï¼ˆç¨‹åºåŒ–ï¼‰ä¸‰ç§æ ¼å¼
ğŸ”¸ è¿æ¥å‚æ•°ï¼šansible_hostã€ansible_portã€ansible_userç­‰å…³é”®é…ç½®
ğŸ”¸ å˜é‡ç®¡ç†ï¼šhost_varsï¼ˆä¸»æœºä¸“å±ï¼‰ã€group_varsï¼ˆç»„å…±äº«ï¼‰ç›®å½•ç»“æ„
ğŸ”¸ é™æ€vsåŠ¨æ€ï¼šæ‰‹å·¥ç»´æŠ¤vsè‡ªåŠ¨è·å–çš„ä¸¤ç§æ¸…å•ç®¡ç†æ–¹å¼
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¸…å•æ–‡ä»¶çš„æœ¬è´¨ä½œç”¨**
```
ä¸æ˜¯ä»€ä¹ˆï¼šä¸æ˜¯ç®€å•çš„IPåœ°å€åˆ—è¡¨
è€Œæ˜¯ä»€ä¹ˆï¼šæ˜¯Ansibleä¸ç›®æ ‡ä¸»æœºå»ºç«‹è¿æ¥çš„å®Œæ•´ä¿¡æ¯åº“
   - å‘Šè¯‰Ansibleå»å“ªé‡Œï¼ˆIPåœ°å€ï¼‰
   - å‘Šè¯‰Ansibleæ€ä¹ˆå»ï¼ˆè¿æ¥å‚æ•°ï¼‰
   - å‘Šè¯‰Ansibleä»¥ä»€ä¹ˆèº«ä»½å»ï¼ˆç”¨æˆ·è®¤è¯ï¼‰
```

**ğŸ”¹ å˜é‡ç®¡ç†çš„å±‚æ¬¡ç†è§£**
```
å˜é‡ä¼˜å…ˆçº§è®°å¿†ï¼š
   ä¸»æœºå˜é‡ > ç»„å˜é‡ > å…¨å±€å˜é‡
   
å®é™…åº”ç”¨ï¼š
   - all.ymlï¼šæ‰€æœ‰æœåŠ¡å™¨çš„åŸºç¡€é…ç½®
   - ç»„å˜é‡ï¼šåŒç±»æœåŠ¡å™¨çš„å…±åŒé…ç½®  
   - ä¸»æœºå˜é‡ï¼šç‰¹æ®ŠæœåŠ¡å™¨çš„ä¸ªæ€§åŒ–é…ç½®
```

**ğŸ”¹ é™æ€ä¸åŠ¨æ€æ¸…å•çš„é€‰æ‹©ç­–ç•¥**
```
ç¯å¢ƒç‰¹å¾åˆ¤æ–­ï¼š
   æœåŠ¡å™¨å›ºå®š + å˜åŒ–å°‘ = é™æ€æ¸…å•
   æœåŠ¡å™¨åŠ¨æ€ + å˜åŒ–é¢‘ç¹ = åŠ¨æ€æ¸…å•
   
æŠ€æœ¯å®ç°éš¾åº¦ï¼š
   é™æ€æ¸…å•ï¼šé…ç½®ç®€å•ï¼Œç«‹å³å¯ç”¨
   åŠ¨æ€æ¸…å•ï¼šéœ€è¦ç¼–ç¨‹ï¼Œä½†è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼åŸåˆ™


**ğŸ“ é…ç½®æ–‡ä»¶ç»„ç»‡æœ€ä½³å®è·µ**
```
ğŸ¯ ç›®å½•ç»“æ„æ ‡å‡†åŒ–ï¼š
   project/
   â”œâ”€ inventory/          â† æ¸…å•æ–‡ä»¶ç›®å½•
   â”œâ”€ group_vars/        â† ç»„å˜é‡ç›®å½•
   â”œâ”€ host_vars/         â† ä¸»æœºå˜é‡ç›®å½•
   â””â”€ playbooks/         â† å‰§æœ¬æ–‡ä»¶ç›®å½•

ğŸ¯ å‘½åè§„èŒƒå»ºè®®ï¼š
   - ç¯å¢ƒå‰ç¼€ï¼šprod-web-01, test-db-01
   - åŠŸèƒ½æè¿°ï¼šweb, db, cache, monitor  
   - ç¼–å·åç¼€ï¼š01, 02, 03ï¼ˆä¾¿äºæ‰©å±•ï¼‰
```

**âš™ï¸ è¿æ¥å‚æ•°é…ç½®ç­–ç•¥**
```
ç”Ÿäº§ç¯å¢ƒæ¨èï¼š
âœ… ä½¿ç”¨SSHå¯†é’¥è®¤è¯ï¼ˆansible_ssh_private_key_fileï¼‰
âœ… ä¿®æ”¹é»˜è®¤SSHç«¯å£ï¼ˆansible_portï¼‰
âœ… ä½¿ç”¨ä¸“ç”¨ç®¡ç†è´¦æˆ·ï¼ˆansible_userï¼‰
âœ… é…ç½®sudoæƒé™ï¼ˆansible_become_passï¼‰

å¼€å‘æµ‹è¯•ç¯å¢ƒï¼š
âš ï¸ å¯ä¸´æ—¶ä½¿ç”¨å¯†ç è®¤è¯ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰
âš ï¸ ç®€åŒ–é…ç½®ä»¥æé«˜å¼€å‘æ•ˆç‡
```

**ğŸ”§ æ•…éšœæ’é™¤æ€è·¯**
```
è¿æ¥é—®é¢˜è¯Šæ–­æ­¥éª¤ï¼š
1. æ£€æŸ¥æ¸…å•æ–‡ä»¶è¯­æ³•ï¼šansible-inventory --list
2. æµ‹è¯•ç½‘ç»œè¿é€šæ€§ï¼šping ç›®æ ‡IP
3. éªŒè¯SSHè¿æ¥ï¼šssh user@host
4. æ£€æŸ¥Ansibleè¿æ¥ï¼šansible all -m ping
5. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼šansible all -m ping -vvv
```

### 8.4 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ æ·±å…¥å­¦ä¹ å»ºè®®**
```
æŒæ¡åŸºç¡€åçš„è¿›é˜¶æ–¹å‘ï¼š

ğŸ“š æ¸…å•è¿›é˜¶ï¼š
   - å­¦ä¹ å¤æ‚çš„ç»„åµŒå¥—å…³ç³»
   - æŒæ¡å˜é‡ç»§æ‰¿å’Œè¦†ç›–è§„åˆ™
   - ç ”ç©¶æ¸…å•æ’ä»¶å¼€å‘

ğŸ”§ åŠ¨æ€æ¸…å•è¿›é˜¶ï¼š
   - å¼€å‘è‡ªå®šä¹‰åŠ¨æ€æ¸…å•è„šæœ¬
   - é›†æˆä¼ä¸šCMDBç³»ç»Ÿ
   - å­¦ä¹ ä¸»æµäº‘å¹³å°åŠ¨æ€æ¸…å•

âš¡ æ€§èƒ½ä¼˜åŒ–ï¼š
   - æ¸…å•æ–‡ä»¶å¤§å°ä¼˜åŒ–
   - è¿æ¥æ± å’Œå¹¶å‘é…ç½®
   - ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ¸…å•ç®¡ç†æœ‰é—¨é“ï¼Œä¸»æœºä¿¡æ¯è¦è®°ç‰¢
é™æ€åŠ¨æ€å„æœ‰åœºï¼ŒæŒ‰éœ€é€‰æ‹©ä¸å‡ºé”™  
å˜é‡å±‚æ¬¡è¦ç†æ¸…ï¼Œä¼˜å…ˆçº§åˆ«è®°å¿ƒä¸­
è¿æ¥å‚æ•°é…ç½®å¥½ï¼Œè‡ªåŠ¨è¿ç»´æ•ˆç‡é«˜
```

**å®è·µæ£€éªŒæ¸…å•**ï¼š
- [ ] èƒ½å¤Ÿåˆ›å»ºåŸºæœ¬çš„INIæ ¼å¼æ¸…å•æ–‡ä»¶
- [ ] ç†è§£å¹¶é…ç½®å¸¸ç”¨çš„è¿æ¥å‚æ•°
- [ ] æŒæ¡host_varså’Œgroup_varsçš„ä½¿ç”¨
- [ ] èƒ½å¤ŸåŒºåˆ†é™æ€æ¸…å•å’ŒåŠ¨æ€æ¸…å•çš„ä½¿ç”¨åœºæ™¯
- [ ] å¯ä»¥ç¼–å†™ç®€å•çš„åŠ¨æ€æ¸…å•è„šæœ¬
- [ ] å…·å¤‡æ¸…å•é…ç½®é—®é¢˜çš„åŸºæœ¬æ’æŸ¥èƒ½åŠ›