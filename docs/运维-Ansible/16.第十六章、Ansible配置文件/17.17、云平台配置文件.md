---
title: 17ã€äº‘å¹³å°é…ç½®æ–‡ä»¶
---
## ğŸ“š ç›®å½•

1. [äº‘å¹³å°é…ç½®åŸºç¡€æ¦‚å¿µ](#1-äº‘å¹³å°é…ç½®åŸºç¡€æ¦‚å¿µ)
2. [AWSäº‘å¹³å°é…ç½®å®è·µ](#2-AWSäº‘å¹³å°é…ç½®å®è·µ)
3. [GCPè°·æ­Œäº‘é…ç½®å®è·µ](#3-GCPè°·æ­Œäº‘é…ç½®å®è·µ)
4. [Azureå¾®è½¯äº‘é…ç½®å®è·µ](#4-Azureå¾®è½¯äº‘é…ç½®å®è·µ)
5. [OpenStackç§æœ‰äº‘é…ç½®](#5-OpenStackç§æœ‰äº‘é…ç½®)
6. [VMwareè™šæ‹ŸåŒ–å¹³å°é…ç½®](#6-VMwareè™šæ‹ŸåŒ–å¹³å°é…ç½®)
7. [äº‘æ¸…å•æ’ä»¶é…ç½®](#7-äº‘æ¸…å•æ’ä»¶é…ç½®)
8. [å®‰å…¨æœ€ä½³å®è·µ](#8-å®‰å…¨æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. â˜ï¸ äº‘å¹³å°é…ç½®åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯äº‘å¹³å°é…ç½®


**ç®€å•ç†è§£**ï¼šå°±åƒä½ éœ€è¦é’¥åŒ™æ‰èƒ½è¿›è‡ªå·±å®¶é—¨ä¸€æ ·ï¼ŒAnsibleè¦æ“ä½œäº‘å¹³å°ä¸Šçš„èµ„æºï¼ˆåˆ›å»ºè™šæ‹Ÿæœºã€é…ç½®ç½‘ç»œç­‰ï¼‰ï¼Œä¹Ÿéœ€è¦"é’¥åŒ™"â€”â€”è¿™å°±æ˜¯äº‘å¹³å°çš„**èº«ä»½å‡­è¯**ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
ä½ çš„èº«ä»½è¯ â†’ è¯æ˜ä½ æ˜¯è°
é“¶è¡Œå¡å¯†ç  â†’ è¯æ˜ä½ æœ‰æƒé™ä½¿ç”¨é“¶è¡Œå¡

äº‘å¹³å°å‡­è¯ï¼š
Access Key â†’ è¯æ˜ä½ æ˜¯å“ªä¸ªè´¦æˆ·
Secret Key â†’ è¯æ˜ä½ æœ‰æƒé™æ“ä½œè¿™ä¸ªè´¦æˆ·çš„èµ„æº
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®å‡­è¯


**æ ¸å¿ƒåŸå› **ï¼š
- **èº«ä»½éªŒè¯** - è¯æ˜"ä½ æ˜¯è°"
- **æƒé™æ§åˆ¶** - ç¡®å®š"ä½ èƒ½åšä»€ä¹ˆ"
- **èµ„æºéš”ç¦»** - é˜²æ­¢è¯¯æ“ä½œåˆ«äººçš„èµ„æº
- **å®¡è®¡è¿½è¸ª** - è®°å½•è°åšäº†ä»€ä¹ˆæ“ä½œ

### 1.3 å‡­è¯å­˜å‚¨çš„å®‰å…¨åŸåˆ™


```
ğŸ” å®‰å…¨å±‚çº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

æœ€å®‰å…¨ï¼šç¯å¢ƒå˜é‡
â”œâ”€â”€ export AWS_ACCESS_KEY_ID=ä½ çš„å¯†é’¥
â”œâ”€â”€ ç¨‹åºè¿è¡Œæ—¶è¯»å–ï¼Œä¸å†™å…¥æ–‡ä»¶

è¾ƒå®‰å…¨ï¼šä¸“ç”¨å‡­è¯æ–‡ä»¶
â”œâ”€â”€ ~/.aws/credentialsï¼ˆæƒé™600ï¼‰
â”œâ”€â”€ åªæœ‰å½“å‰ç”¨æˆ·èƒ½è¯»å–

å±é™©ï¼šç›´æ¥å†™åœ¨ä»£ç é‡Œ
â””â”€â”€ playbook.ymlä¸­æ˜æ–‡å†™å¯†é’¥ âŒ ç»å¯¹ç¦æ­¢
```

---

## 2. ğŸš€ AWSäº‘å¹³å°é…ç½®å®è·µ


### 2.1 AWSå‡­è¯è·å–æµç¨‹


**ç¬¬ä¸€æ­¥ï¼šåœ¨AWSæ§åˆ¶å°åˆ›å»ºè®¿é—®å¯†é’¥**

```
AWSæ§åˆ¶å°æ“ä½œæµç¨‹ï¼š
1. ç™»å½•AWSæ§åˆ¶å°
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å â†’ Security credentials
3. æ‰¾åˆ° "Access keys" éƒ¨åˆ†
4. ç‚¹å‡» "Create New Access Key"
5. ä¸‹è½½ .csv æ–‡ä»¶ï¼ˆåªèƒ½ä¸‹è½½ä¸€æ¬¡ï¼ï¼‰

è·å¾—ä¸¤ä¸ªé‡è¦ä¿¡æ¯ï¼š
â”œâ”€â”€ Access Key IDï¼ˆå…¬å¼€æ ‡è¯†ï¼‰ï¼šAKIAIOSFODNN7EXAMPLE
â””â”€â”€ Secret Access Keyï¼ˆç§å¯†å¯†é’¥ï¼‰ï¼šwJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
```

### 2.2 AWSå‡­è¯é…ç½®æ–¹æ³•


#### ğŸ”§ æ–¹æ³•ä¸€ï¼šAWSå‡­è¯æ–‡ä»¶ï¼ˆæ¨èï¼‰


```bash
# åˆ›å»ºAWSé…ç½®ç›®å½•
mkdir -p ~/.aws

# ç¼–è¾‘å‡­è¯æ–‡ä»¶
vim ~/.aws/credentials
```

**å‡­è¯æ–‡ä»¶å†…å®¹æ ¼å¼ï¼š**
```ini
[default]
aws_access_key_id = AKIAIOSFODNN7EXAMPLE
aws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

[production]
aws_access_key_id = AKIAI44QH8DHBEXAMPLE
aws_secret_access_key = je7MtGbClwBF/2Zp9Utk/h3yCo8nvbEXAMPLEKEY
region = us-east-1

[testing]
aws_access_key_id = AKIAIOSFODNN7EXAMPLE
aws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
region = us-west-2
```

**æ–‡ä»¶æƒé™è®¾ç½®ï¼š**
```bash
# è®¾ç½®å®‰å…¨æƒé™ï¼ˆåªæœ‰ä½ èƒ½è¯»å†™ï¼‰
chmod 600 ~/.aws/credentials
```

#### ğŸ”§ æ–¹æ³•äºŒï¼šç¯å¢ƒå˜é‡ï¼ˆæ›´å®‰å…¨ï¼‰


```bash
# ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ä¼šè¯æœ‰æ•ˆï¼‰
export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
export AWS_DEFAULT_REGION=us-east-1

# æ°¸ä¹…è®¾ç½®ï¼ˆå†™å…¥.bashrcï¼‰
echo 'export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE' >> ~/.bashrc
echo 'export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY' >> ~/.bashrc
echo 'export AWS_DEFAULT_REGION=us-east-1' >> ~/.bashrc
```

### 2.3 åœ¨Ansibleä¸­ä½¿ç”¨AWSå‡­è¯


**ç®€å•çš„EC2å®ä¾‹åˆ›å»ºç¤ºä¾‹ï¼š**
```yaml
---
- name: åˆ›å»ºAWS EC2å®ä¾‹
  hosts: localhost
  gather_facts: no
  tasks:
    - name: å¯åŠ¨EC2å®ä¾‹
      amazon.aws.ec2_instance:
        name: "test-server"
        image_id: ami-0abcdef1234567890  # Amazon Linux 2 AMI ID
        instance_type: t2.micro
        region: us-east-1
        # å‡­è¯ä¼šè‡ªåŠ¨ä» ~/.aws/credentials è¯»å–
        state: present
```

**æŒ‡å®šç‰¹å®šé…ç½®æ–‡ä»¶ï¼š**
```yaml
- name: ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒå‡­è¯åˆ›å»ºå®ä¾‹
  amazon.aws.ec2_instance:
    name: "prod-server"
    image_id: ami-0abcdef1234567890
    instance_type: t3.small
    region: us-east-1
    # ä½¿ç”¨credentialsæ–‡ä»¶ä¸­çš„[production]é…ç½®
    profile: production
    state: present
```

---

## 3. ğŸŒ GCPè°·æ­Œäº‘é…ç½®å®è·µ


### 3.1 GCPæœåŠ¡è´¦æˆ·æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šGCPä¸åƒAWSé‚£æ ·ç»™ä¸ªäººç”¨æˆ·å‘å¯†é’¥ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ª"æœºå™¨äººè´¦æˆ·"ï¼ˆæœåŠ¡è´¦æˆ·ï¼‰ï¼Œè¿™ä¸ªæœºå™¨äººä»£æ›¿ä½ å»æ“ä½œäº‘èµ„æºã€‚

```
GCPæœåŠ¡è´¦æˆ·ç†è§£ï¼š
å…¬å¸ç±»æ¯”ï¼š
â”œâ”€â”€ ä½ æ˜¯å…¬å¸è€æ¿ï¼ˆçœŸå®ç”¨æˆ·ï¼‰
â”œâ”€â”€ é›‡ä½£ä¸€ä¸ªåŠ©ç†ï¼ˆæœåŠ¡è´¦æˆ·ï¼‰
â”œâ”€â”€ ç»™åŠ©ç†ç‰¹å®šæƒé™ï¼ˆIAMè§’è‰²ï¼‰
â””â”€â”€ åŠ©ç†ä»£æ›¿ä½ å¤„ç†äº‹åŠ¡ï¼ˆAnsibleæ“ä½œï¼‰
```

### 3.2 GCPæœåŠ¡è´¦æˆ·åˆ›å»ºæµç¨‹


**æ­¥éª¤è¯¦è§£ï¼š**
```
GCPæ§åˆ¶å°æ“ä½œï¼š
1. è¿›å…¥ Google Cloud Console
2. é€‰æ‹©é¡¹ç›® â†’ IAM & Admin â†’ Service accounts
3. ç‚¹å‡» "CREATE SERVICE ACCOUNT"
4. å¡«å†™æœåŠ¡è´¦æˆ·ä¿¡æ¯ï¼š
   â”œâ”€â”€ Name: ansible-automation
   â”œâ”€â”€ ID: ansible-automation@é¡¹ç›®ID.iam.gserviceaccount.com
   â””â”€â”€ Description: ç”¨äºAnsibleè‡ªåŠ¨åŒ–æ“ä½œ

5. åˆ†é…è§’è‰²ï¼ˆæƒé™ï¼‰ï¼š
   â”œâ”€â”€ Compute Adminï¼ˆç®¡ç†è™šæ‹Ÿæœºï¼‰
   â”œâ”€â”€ Storage Adminï¼ˆç®¡ç†å­˜å‚¨ï¼‰
   â””â”€â”€ Network Adminï¼ˆç®¡ç†ç½‘ç»œï¼‰

6. åˆ›å»ºå¯†é’¥æ–‡ä»¶ï¼š
   â”œâ”€â”€ é€‰æ‹©JSONæ ¼å¼
   â”œâ”€â”€ ä¸‹è½½åˆ°æœ¬åœ°
   â””â”€â”€ é‡å‘½åä¸º gcp-service-account.json
```

### 3.3 GCPå‡­è¯é…ç½®æ–¹æ³•


#### ğŸ”§ æ–¹æ³•ä¸€ï¼šæœåŠ¡è´¦æˆ·æ–‡ä»¶


```bash
# åˆ›å»ºGCPé…ç½®ç›®å½•
mkdir -p ~/.config/gcloud

# å°†æœåŠ¡è´¦æˆ·æ–‡ä»¶ç§»åˆ°å®‰å…¨ä½ç½®
mv ~/Downloads/gcp-service-account.json ~/.config/gcloud/
chmod 600 ~/.config/gcloud/gcp-service-account.json
```

**åœ¨Ansibleä¸­ä½¿ç”¨ï¼š**
```yaml
- name: åˆ›å»ºGCPè™šæ‹Ÿæœºå®ä¾‹
  google.cloud.gcp_compute_instance:
    name: test-vm
    machine_type: f1-micro
    zone: us-central1-a
    project: your-project-id
    # æŒ‡å®šæœåŠ¡è´¦æˆ·æ–‡ä»¶è·¯å¾„
    service_account_file: "{{ ansible_env.HOME }}/.config/gcloud/gcp-service-account.json"
    disks:
      - auto_delete: true
        boot: true
        initialize_params:
          source_image: projects/debian-cloud/global/images/family/debian-11
    state: present
```

#### ğŸ”§ æ–¹æ³•äºŒï¼šç¯å¢ƒå˜é‡


```bash
# è®¾ç½®æœåŠ¡è´¦æˆ·æ–‡ä»¶è·¯å¾„
export GOOGLE_APPLICATION_CREDENTIALS="$HOME/.config/gcloud/gcp-service-account.json"
export GOOGLE_CLOUD_PROJECT="your-project-id"
```

### 3.4 GCPåŒºåŸŸå’Œé¡¹ç›®é…ç½®


**é‡è¦æ¦‚å¿µç†è§£ï¼š**
- **Project ID** - ä½ çš„GCPé¡¹ç›®å”¯ä¸€æ ‡è¯†ç¬¦
- **Region** - ç‰©ç†åœ°ç†ä½ç½®ï¼ˆå¦‚ us-central1ï¼‰
- **Zone** - åŒºåŸŸå†…çš„å…·ä½“æ•°æ®ä¸­å¿ƒï¼ˆå¦‚ us-central1-aï¼‰

```yaml
# å®Œæ•´çš„GCPé…ç½®ç¤ºä¾‹
vars:
  gcp_project: "my-ansible-project-123456"
  gcp_region: "us-central1"
  gcp_zone: "us-central1-a"
  gcp_service_account: "{{ ansible_env.HOME }}/.config/gcloud/service-account.json"
```

---

## 4. ğŸ”µ Azureå¾®è½¯äº‘é…ç½®å®è·µ


### 4.1 Azureè®¤è¯æ¦‚å¿µç†è§£


**Azureè®¤è¯å››è¦ç´ **ï¼ˆå¿…é¡»å…¨éƒ¨é…ç½®ï¼‰ï¼š
```
Azureè®¤è¯å››ä»¶å¥—ï¼š
â”œâ”€â”€ subscription_id ï¼ˆè®¢é˜…IDï¼‰- ä½ çš„Azureè´¦å•å½’å±
â”œâ”€â”€ tenant_id ï¼ˆç§Ÿæˆ·IDï¼‰- ä½ çš„ç»„ç»‡èº«ä»½
â”œâ”€â”€ client_id ï¼ˆåº”ç”¨ç¨‹åºIDï¼‰- åº”ç”¨èº«ä»½æ ‡è¯†
â””â”€â”€ client_secret ï¼ˆå®¢æˆ·ç«¯å¯†é’¥ï¼‰- åº”ç”¨è®¿é—®å¯†ç 
```

**å½¢è±¡æ¯”å–»ï¼š**
```
ç°å®ç±»æ¯”ï¼š
subscription_id = ä½ çš„ä¿¡ç”¨å¡å·ï¼ˆä»˜è´¹è´¦æˆ·ï¼‰
tenant_id = ä½ çš„å…¬å¸åç§°ï¼ˆç»„ç»‡èº«ä»½ï¼‰
client_id = ä½ çš„å‘˜å·¥å·¥å·ï¼ˆåº”ç”¨èº«ä»½ï¼‰
client_secret = ä½ çš„å‘˜å·¥å¯†ç ï¼ˆè®¿é—®å¯†é’¥ï¼‰
```

### 4.2 Azureåº”ç”¨æ³¨å†Œæµç¨‹


**è¯¦ç»†æ“ä½œæ­¥éª¤ï¼š**
```
Azureé—¨æˆ·æ“ä½œæµç¨‹ï¼š
1. ç™»å½• portal.azure.com
2. Azure Active Directory â†’ App registrations
3. ç‚¹å‡» "New registration"
4. åº”ç”¨ä¿¡æ¯å¡«å†™ï¼š
   â”œâ”€â”€ Name: ansible-automation
   â”œâ”€â”€ Account types: é€‰æ‹©åˆé€‚çš„è´¦æˆ·ç±»å‹
   â””â”€â”€ Redirect URI: ç•™ç©º

5. è®°å½•åº”ç”¨ä¿¡æ¯ï¼š
   â”œâ”€â”€ Application (client) ID â†’ è¿™æ˜¯ä½ çš„ client_id
   â””â”€â”€ Directory (tenant) ID â†’ è¿™æ˜¯ä½ çš„ tenant_id

6. åˆ›å»ºå®¢æˆ·ç«¯å¯†é’¥ï¼š
   â”œâ”€â”€ Certificates & secrets â†’ Client secrets
   â”œâ”€â”€ ç‚¹å‡» "New client secret"
   â”œâ”€â”€ è¾“å…¥æè¿°å’Œæœ‰æ•ˆæœŸ
   â””â”€â”€ å¤åˆ¶ç”Ÿæˆçš„å€¼ â†’ è¿™æ˜¯ä½ çš„ client_secret

7. è·å–è®¢é˜…IDï¼š
   â”œâ”€â”€ è¿”å›Azureé¦–é¡µ â†’ Subscriptions
   â””â”€â”€ å¤åˆ¶ Subscription ID
```

### 4.3 Azureå‡­è¯é…ç½®æ–¹æ³•


#### ğŸ”§ æ–¹æ³•ä¸€ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰


```bash
# Azureè®¤è¯ç¯å¢ƒå˜é‡
export AZURE_SUBSCRIPTION_ID="12345678-1234-1234-1234-123456789012"
export AZURE_TENANT_ID="87654321-4321-4321-4321-210987654321" 
export AZURE_CLIENT_ID="abcdefgh-abcd-abcd-abcd-abcdefghijkl"
export AZURE_CLIENT_SECRET="ä½ çš„å®¢æˆ·ç«¯å¯†é’¥å€¼"
```

#### ğŸ”§ æ–¹æ³•äºŒï¼šAnsibleå‡­è¯æ–‡ä»¶


```bash
# åˆ›å»ºAzureå‡­è¯æ–‡ä»¶
mkdir -p ~/.azure
vim ~/.azure/credentials
```

**å‡­è¯æ–‡ä»¶å†…å®¹ï¼š**
```ini
[default]
subscription_id=12345678-1234-1234-1234-123456789012
tenant_id=87654321-4321-4321-4321-210987654321
client_id=abcdefgh-abcd-abcd-abcd-abcdefghijkl
client_secret=ä½ çš„å®¢æˆ·ç«¯å¯†é’¥å€¼

[production]
subscription_id=prod-subscription-id
tenant_id=prod-tenant-id
client_id=prod-client-id
client_secret=prod-client-secret
```

### 4.4 åœ¨Ansibleä¸­ä½¿ç”¨Azureå‡­è¯


```yaml
- name: åˆ›å»ºAzureè™šæ‹Ÿæœº
  azure.azcollection.azure_rm_virtualmachine:
    resource_group: my-resource-group
    name: test-vm
    vm_size: Standard_B1s
    location: East US
    image:
      offer: UbuntuServer
      publisher: Canonical
      sku: 18.04-LTS
      version: latest
    # å‡­è¯è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡æˆ– ~/.azure/credentials è¯»å–
    state: present
```

---

## 5. ğŸ¢ OpenStackç§æœ‰äº‘é…ç½®


### 5.1 OpenStackè®¤è¯æ¦‚å¿µ


**OpenStackè®¤è¯ä½“ç³»**ï¼š
```
OpenStackè®¤è¯å±‚çº§ï¼š
â”œâ”€â”€ auth_url - OpenStackè®¤è¯æœåŠ¡åœ°å€
â”œâ”€â”€ username - ç”¨æˆ·å
â”œâ”€â”€ password - å¯†ç   
â”œâ”€â”€ project_name - é¡¹ç›®åç§°ï¼ˆtenant_nameï¼‰
â”œâ”€â”€ user_domain_name - ç”¨æˆ·åŸŸå
â””â”€â”€ project_domain_name - é¡¹ç›®åŸŸå
```

### 5.2 OpenStackå‡­è¯é…ç½®


**ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```bash
# OpenStackè®¤è¯ç¯å¢ƒå˜é‡
export OS_AUTH_URL=http://controller:5000/v3
export OS_USERNAME=admin
export OS_PASSWORD=your-password
export OS_PROJECT_NAME=admin
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default
export OS_IDENTITY_API_VERSION=3
```

**åœ¨Ansibleä¸­ä½¿ç”¨ï¼š**
```yaml
- name: åˆ›å»ºOpenStackè™šæ‹Ÿæœº
  openstack.cloud.server:
    state: present
    name: test-instance
    image: ubuntu-20.04
    flavor: m1.small
    key_name: my-key
    network: private-network
    # è®¤è¯ä¿¡æ¯ä»ç¯å¢ƒå˜é‡è‡ªåŠ¨è¯»å–
```

---

## 6. ğŸ“¦ VMwareè™šæ‹ŸåŒ–å¹³å°é…ç½®


### 6.1 VMwareå‡­è¯ç±»å‹


**VMwareè®¤è¯ä¿¡æ¯**ï¼š
```
vCenter Serverè®¤è¯ï¼š
â”œâ”€â”€ hostname - vCenteræœåŠ¡å™¨åœ°å€
â”œâ”€â”€ username - ç®¡ç†å‘˜ç”¨æˆ·å
â”œâ”€â”€ password - ç®¡ç†å‘˜å¯†ç 
â”œâ”€â”€ datacenter - æ•°æ®ä¸­å¿ƒåç§°
â”œâ”€â”€ cluster - é›†ç¾¤åç§°ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ validate_certs - æ˜¯å¦éªŒè¯SSLè¯ä¹¦
```

### 6.2 VMwareå‡­è¯é…ç½®ç¤ºä¾‹


```yaml
# VMware vCenterè¿æ¥é…ç½®
vmware_config:
  hostname: "vcenter.example.com"
  username: "administrator@vsphere.local"
  password: "your-vcenter-password"
  datacenter: "Datacenter1"
  validate_certs: no  # æµ‹è¯•ç¯å¢ƒå¯ä»¥å…³é—­

- name: åˆ›å»ºVMwareè™šæ‹Ÿæœº
  community.vmware.vmware_guest:
    hostname: "{{ vmware_config.hostname }}"
    username: "{{ vmware_config.username }}" 
    password: "{{ vmware_config.password }}"
    datacenter: "{{ vmware_config.datacenter }}"
    name: test-vm
    template: ubuntu-template
    folder: /vm/test
    state: present
```

---

## 7. ğŸ“‹ äº‘æ¸…å•æ’ä»¶é…ç½®


### 7.1 ä»€ä¹ˆæ˜¯äº‘æ¸…å•æ’ä»¶


**é€šä¿—è§£é‡Š**ï¼šä¼ ç»Ÿçš„Ansibleéœ€è¦ä½ æ‰‹åŠ¨åœ¨inventoryæ–‡ä»¶ä¸­å†™æ˜è¦ç®¡ç†çš„æœåŠ¡å™¨IPã€‚ä½†äº‘ç¯å¢ƒä¸­çš„æœåŠ¡å™¨ç»å¸¸åˆ›å»ºå’Œé”€æ¯ï¼Œæ‰‹åŠ¨ç»´æŠ¤å¾ˆéº»çƒ¦ã€‚äº‘æ¸…å•æ’ä»¶å°±åƒä¸€ä¸ª"è‡ªåŠ¨æ›´æ–°çš„é€šè®¯å½•"ï¼Œèƒ½è‡ªåŠ¨å‘ç°äº‘å¹³å°ä¸Šçš„èµ„æºã€‚

```
ä¼ ç»Ÿæ–¹å¼ vs äº‘æ¸…å•æ’ä»¶ï¼š

ä¼ ç»Ÿinventoryæ–‡ä»¶ï¼š
[webservers]
192.168.1.10
192.168.1.11

äº‘æ¸…å•æ’ä»¶ï¼š
è‡ªåŠ¨å‘ç° â†’ æ ‡ç­¾è¿‡æ»¤ â†’ åŠ¨æ€ç”Ÿæˆæ¸…å•
           â”œâ”€â”€ æ­£åœ¨è¿è¡Œçš„å®ä¾‹
           â”œâ”€â”€ ç‰¹å®šæ ‡ç­¾çš„å®ä¾‹  
           â””â”€â”€ ç‰¹å®šåŒºåŸŸçš„å®ä¾‹
```

### 7.2 AWSåŠ¨æ€æ¸…å•é…ç½®


**å®‰è£…AWSæ¸…å•æ’ä»¶ï¼š**
```bash
# å®‰è£…boto3ï¼ˆAWS SDKï¼‰
pip install boto3 botocore

# å®‰è£…AWSé›†åˆ
ansible-galaxy collection install amazon.aws
```

**åˆ›å»ºAWSæ¸…å•é…ç½®æ–‡ä»¶ï¼š**
```yaml
# inventory/aws_ec2.yml
plugin: amazon.aws.aws_ec2
regions:
  - us-east-1
  - us-west-2
keyed_groups:
  # æŒ‰å®ä¾‹çŠ¶æ€åˆ†ç»„
  - key: instance_state_name
    prefix: instance_state
  # æŒ‰å®ä¾‹ç±»å‹åˆ†ç»„  
  - key: instance_type
    prefix: type
  # æŒ‰æ ‡ç­¾åˆ†ç»„
  - key: tags.Environment
    prefix: env
filters:
  # åªè·å–è¿è¡Œä¸­çš„å®ä¾‹
  instance-state-name: running
hostnames:
  # ä½¿ç”¨ç§æœ‰IPä½œä¸ºä¸»æœºå
  - private-ip-address
compose:
  # è®¾ç½®ansible_hostå˜é‡
  ansible_host: public_ip_address
```

### 7.3 GCPåŠ¨æ€æ¸…å•é…ç½®


```yaml
# inventory/gcp_compute.yml
plugin: google.cloud.gcp_compute
projects:
  - your-project-id
zones:
  - us-central1-a
  - us-central1-b
auth_kind: serviceaccount
service_account_file: ~/.config/gcloud/service-account.json
keyed_groups:
  # æŒ‰æœºå™¨ç±»å‹åˆ†ç»„
  - key: machineType
    prefix: type
  # æŒ‰æ ‡ç­¾åˆ†ç»„
  - key: labels.environment
    prefix: env
filters:
  # åªè·å–è¿è¡Œä¸­çš„å®ä¾‹
  - status = "RUNNING"
```

### 7.4 ä½¿ç”¨åŠ¨æ€æ¸…å•


```bash
# æµ‹è¯•åŠ¨æ€æ¸…å•
ansible-inventory -i inventory/aws_ec2.yml --list

# ä½¿ç”¨åŠ¨æ€æ¸…å•è¿è¡Œplaybook  
ansible-playbook -i inventory/aws_ec2.yml site.yml

# é’ˆå¯¹ç‰¹å®šç»„è¿è¡Œ
ansible-playbook -i inventory/aws_ec2.yml site.yml --limit env_production
```

---

## 8. ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ


### 8.1 å‡­è¯å­˜å‚¨å®‰å…¨åŸåˆ™


```
ğŸš¨ å®‰å…¨ç­‰çº§æ’åºï¼ˆä»å®‰å…¨åˆ°å±é™©ï¼‰ï¼š

âœ… æœ€å®‰å…¨ï¼š
â”œâ”€â”€ ä¸´æ—¶è®¿é—®ä»¤ç‰Œï¼ˆSTS/IAM Roleï¼‰
â”œâ”€â”€ ç¯å¢ƒå˜é‡
â”œâ”€â”€ åŠ å¯†çš„å‡­è¯æ–‡ä»¶
â””â”€â”€ ä¸“ç”¨å‡­è¯ç®¡ç†å·¥å…·

âš ï¸ ä¸­ç­‰é£é™©ï¼š
â”œâ”€â”€ æ˜æ–‡å‡­è¯æ–‡ä»¶ï¼ˆæ­£ç¡®æƒé™ï¼‰
â””â”€â”€ Ansible VaultåŠ å¯†å˜é‡

âŒ æåº¦å±é™©ï¼š
â”œâ”€â”€ playbookä¸­æ˜æ–‡å¯†ç 
â”œâ”€â”€ Gitä»“åº“ä¸­çš„å¯†é’¥
â””â”€â”€ å…¬å¼€åˆ†äº«çš„é…ç½®æ–‡ä»¶
```

### 8.2 æ–‡ä»¶æƒé™é…ç½®


```bash
# å‡­è¯æ–‡ä»¶å®‰å…¨æƒé™è®¾ç½®
chmod 600 ~/.aws/credentials      # åªæœ‰æ‰€æœ‰è€…èƒ½è¯»å†™
chmod 600 ~/.azure/credentials    # å…¶ä»–ç”¨æˆ·æ— ä»»ä½•æƒé™
chmod 600 ~/.config/gcloud/*.json # é˜²æ­¢å¯†é’¥æ³„éœ²

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la ~/.aws/credentials
# åº”è¯¥æ˜¾ç¤ºï¼š-rw------- 1 user user
```

### 8.3 ä½¿ç”¨Ansible VaultåŠ å¯†æ•æ„Ÿä¿¡æ¯


```bash
# åˆ›å»ºåŠ å¯†çš„å˜é‡æ–‡ä»¶
ansible-vault create group_vars/all/vault.yml

# ç¼–è¾‘åŠ å¯†æ–‡ä»¶
ansible-vault edit group_vars/all/vault.yml
```

**vault.ymlå†…å®¹ç¤ºä¾‹ï¼š**
```yaml
# åŠ å¯†å­˜å‚¨çš„æ•æ„Ÿä¿¡æ¯
vault_aws_access_key: AKIAIOSFODNN7EXAMPLE
vault_aws_secret_key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
vault_azure_client_secret: your-client-secret
```

**åœ¨playbookä¸­å¼•ç”¨ï¼š**
```yaml
- name: ä½¿ç”¨åŠ å¯†å˜é‡
  amazon.aws.ec2_instance:
    aws_access_key: "{{ vault_aws_access_key }}"
    aws_secret_key: "{{ vault_aws_secret_key }}"
    # å…¶ä»–é…ç½®...
```

### 8.4 æœ€å°æƒé™åŸåˆ™


**AWS IAMç­–ç•¥ç¤ºä¾‹ï¼š**
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:RunInstances",
        "ec2:TerminateInstances", 
        "ec2:DescribeInstances"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "ec2:Region": ["us-east-1", "us-west-2"]
        }
      }
    }
  ]
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‘å¹³å°å‡­è¯ï¼šå°±åƒé’¥åŒ™ï¼Œè®©Ansibleæœ‰æƒé™æ“ä½œäº‘èµ„æº
ğŸ”¸ æœåŠ¡è´¦æˆ·ï¼šä¸“é—¨ç»™ç¨‹åºä½¿ç”¨çš„"æœºå™¨äººè´¦æˆ·"ï¼Œä¸æ˜¯ç»™äººç”¨çš„
ğŸ”¸ è®¤è¯å››è¦ç´ ï¼šæ¯ä¸ªäº‘å¹³å°éƒ½æœ‰è‡ªå·±çš„èº«ä»½éªŒè¯æ–¹å¼
ğŸ”¸ åŠ¨æ€æ¸…å•ï¼šè‡ªåŠ¨å‘ç°å’Œç®¡ç†äº‘ç¯å¢ƒä¸­çš„æœåŠ¡å™¨
ğŸ”¸ å®‰å…¨å­˜å‚¨ï¼šå‡­è¯è¦å®‰å…¨å­˜æ”¾ï¼Œä¸èƒ½æ˜æ–‡å†™åœ¨ä»£ç é‡Œ
```

### 9.2 å…³é”®é…ç½®å¯¹ç…§è¡¨


| äº‘å¹³å° | **ä¸»è¦å‡­è¯** | **å­˜å‚¨ä½ç½®** | **ç¯å¢ƒå˜é‡** |
|--------|-------------|------------|-------------|
| ğŸš€ **AWS** | `Access Key + Secret Key` | `~/.aws/credentials` | `AWS_ACCESS_KEY_ID` |
| ğŸŒ **GCP** | `æœåŠ¡è´¦æˆ·JSONæ–‡ä»¶` | `~/.config/gcloud/` | `GOOGLE_APPLICATION_CREDENTIALS` |
| ğŸ”µ **Azure** | `å››ä»¶å¥—ID+Secret` | `~/.azure/credentials` | `AZURE_SUBSCRIPTION_ID` |
| ğŸ¢ **OpenStack** | `ç”¨æˆ·å+å¯†ç +é¡¹ç›®` | `ç¯å¢ƒå˜é‡` | `OS_AUTH_URL` |
| ğŸ“¦ **VMware** | `ç®¡ç†å‘˜ç”¨æˆ·å+å¯†ç ` | `playbookå˜é‡` | `æ— æ ‡å‡†` |

### 9.3 æ–°æ‰‹å¸¸è§é—®é¢˜ä¸è§£å†³


**ğŸ”¸ é—®é¢˜1ï¼šå‡­è¯é…ç½®äº†ä½†è¿˜æ˜¯æŠ¥é”™**
```bash
# æ£€æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤å‡­è¯æ–‡ä»¶æƒé™ï¼šls -la ~/.aws/credentials
2. ç¡®è®¤å‡­è¯å†…å®¹æ ¼å¼ï¼šcat ~/.aws/credentials  
3. æµ‹è¯•å‡­è¯æœ‰æ•ˆæ€§ï¼šaws sts get-caller-identity
4. æ£€æŸ¥Ansibleé›†åˆç‰ˆæœ¬ï¼šansible-galaxy collection list
```

**ğŸ”¸ é—®é¢˜2ï¼šåŠ¨æ€æ¸…å•æ²¡æœ‰å‘ç°å®ä¾‹**
```bash
# è°ƒè¯•æ­¥éª¤ï¼š
1. æµ‹è¯•æ¸…å•é…ç½®ï¼šansible-inventory -i inventory/aws_ec2.yml --list
2. æ£€æŸ¥è¿‡æ»¤æ¡ä»¶ï¼šç¡®è®¤å®ä¾‹çŠ¶æ€å’Œæ ‡ç­¾
3. éªŒè¯åŒºåŸŸé…ç½®ï¼šç¡®è®¤å®ä¾‹åœ¨æŒ‡å®šåŒºåŸŸ
4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼šansible-inventory -v
```

**ğŸ”¸ é—®é¢˜3ï¼šæƒé™ä¸è¶³é”™è¯¯**
```bash
# è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥IAMç­–ç•¥ï¼šç¡®è®¤æœ‰æ“ä½œæƒé™
2. æŸ¥çœ‹é”™è¯¯è¯¦æƒ…ï¼šansible-playbook -vvv
3. æœ€å°æƒé™æµ‹è¯•ï¼šå…ˆç»™ç®¡ç†å‘˜æƒé™æµ‹è¯•
4. é€æ­¥æ”¶ç´§æƒé™ï¼šç¡®è®¤åŠŸèƒ½åå‡å°‘æƒé™
```

### 9.4 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ å¼€å‘ç¯å¢ƒé…ç½®**ï¼š
- ä½¿ç”¨ä¸ªäººå¼€å‘è´¦æˆ·
- ç¯å¢ƒå˜é‡å­˜å‚¨å‡­è¯
- æƒé™ç›¸å¯¹å®½æ¾ä¾¿äºè°ƒè¯•

**ğŸ¯ æµ‹è¯•ç¯å¢ƒé…ç½®**ï¼š
- ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•è´¦æˆ·
- å‡­è¯æ–‡ä»¶å­˜å‚¨
- æƒé™é€‚ä¸­ï¼Œæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ

**ğŸ¯ ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
- ä½¿ç”¨IAMè§’è‰²æˆ–æ‰˜ç®¡èº«ä»½
- Ansible VaultåŠ å¯†å­˜å‚¨
- æœ€å°æƒé™åŸåˆ™
- å®šæœŸè½®æ¢å‡­è¯

**è®°å¿†è¦ç‚¹**ï¼š
- äº‘å‡­è¯å°±åƒé’¥åŒ™ï¼Œæ²¡æœ‰é’¥åŒ™è¿›ä¸äº†é—¨
- æ¯ä¸ªäº‘å¹³å°çš„é’¥åŒ™éƒ½ä¸ä¸€æ ·ï¼Œä½†åŸç†ç›¸åŒ
- å®‰å…¨ç¬¬ä¸€ï¼Œç»ä¸æŠŠé’¥åŒ™æ˜æ–‡æ”¾åœ¨ä»£ç é‡Œ
- åŠ¨æ€æ¸…å•è®©æœåŠ¡å™¨ç®¡ç†æ›´æ™ºèƒ½åŒ–
- æµ‹è¯•å‡­è¯é…ç½®æ˜¯æˆåŠŸçš„ç¬¬ä¸€æ­¥