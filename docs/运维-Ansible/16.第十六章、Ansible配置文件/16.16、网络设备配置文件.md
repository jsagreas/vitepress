---
title: 16ã€ç½‘ç»œè®¾å¤‡é…ç½®æ–‡ä»¶
---
## ğŸ“š ç›®å½•

1. [ç½‘ç»œè®¾å¤‡é…ç½®æ–‡ä»¶æ¦‚è¿°](#1-ç½‘ç»œè®¾å¤‡é…ç½®æ–‡ä»¶æ¦‚è¿°)
2. [è¿æ¥ç±»å‹è¯¦è§£](#2-è¿æ¥ç±»å‹è¯¦è§£)
3. [ç½‘ç»œæ“ä½œç³»ç»Ÿé…ç½®](#3-ç½‘ç»œæ“ä½œç³»ç»Ÿé…ç½®)
4. [è®¤è¯ä¸æƒé™é…ç½®](#4-è®¤è¯ä¸æƒé™é…ç½®)
5. [è¿æ¥è¶…æ—¶ä¸æŒä¹…åŒ–é…ç½®](#5-è¿æ¥è¶…æ—¶ä¸æŒä¹…åŒ–é…ç½®)
6. [é«˜çº§ç½‘ç»œé…ç½®é€‰é¡¹](#6-é«˜çº§ç½‘ç»œé…ç½®é€‰é¡¹)
7. [å®é™…é…ç½®ç¤ºä¾‹](#7-å®é™…é…ç½®ç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç½‘ç»œè®¾å¤‡é…ç½®æ–‡ä»¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œè®¾å¤‡é…ç½®æ–‡ä»¶


**ç®€å•ç†è§£**ï¼šç½‘ç»œè®¾å¤‡é…ç½®æ–‡ä»¶å°±æ˜¯å‘Šè¯‰Ansibleå¦‚ä½•è¿æ¥å’Œç®¡ç†ç½‘ç»œè®¾å¤‡çš„"è¯´æ˜ä¹¦"

```
ä¼ ç»Ÿç½‘ç»œç®¡ç† vs Ansibleç½‘ç»œç®¡ç†

ä¼ ç»Ÿæ–¹å¼ï¼š
å·¥ç¨‹å¸ˆ â†’ æ‰‹åŠ¨ç™»å½•äº¤æ¢æœº â†’ æ•²å‘½ä»¤ â†’ ä¸€å°ä¸€å°é…ç½®
é—®é¢˜ï¼šæ•ˆç‡ä½ã€æ˜“å‡ºé”™ã€éš¾ä»¥æ ‡å‡†åŒ–

Ansibleæ–¹å¼ï¼š
å·¥ç¨‹å¸ˆ â†’ ç¼–å†™é…ç½®æ–‡ä»¶ â†’ Ansibleè‡ªåŠ¨æ‰¹é‡é…ç½®æ‰€æœ‰è®¾å¤‡
ä¼˜åŠ¿ï¼šè‡ªåŠ¨åŒ–ã€æ ‡å‡†åŒ–ã€å¯é‡å¤ã€æ˜“ç»´æŠ¤
```

### 1.2 ç½‘ç»œè®¾å¤‡çš„ç‰¹æ®Šæ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç‰¹æ®Šé…ç½®**ï¼š
- ğŸ”¸ **è¿æ¥æ–¹å¼ç‰¹æ®Š**ï¼šä¸åƒæ™®é€šæœåŠ¡å™¨ç”¨SSHï¼Œç½‘ç»œè®¾å¤‡æœ‰å¤šç§è¿æ¥æ–¹å¼
- ğŸ”¸ **æ“ä½œç³»ç»Ÿå¤šæ ·**ï¼šCisco IOSã€Juniper Junosã€åä¸ºVRPç­‰
- ğŸ”¸ **æƒé™æœºåˆ¶ä¸åŒ**ï¼šéœ€è¦enableå¯†ç ã€ç‰¹æƒæ¨¡å¼ç­‰
- ğŸ”¸ **å“åº”æ—¶é—´è¾ƒé•¿**ï¼šç½‘ç»œè®¾å¤‡å¤„ç†å‘½ä»¤ç›¸å¯¹è¾ƒæ…¢

### 1.3 é…ç½®æ–‡ä»¶çš„ä½œç”¨


**æ ¸å¿ƒä½œç”¨**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    é…ç½®æ–‡ä»¶    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ansible      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  ç½‘ç»œè®¾å¤‡        â”‚
â”‚   æ§åˆ¶èŠ‚ç‚¹      â”‚               â”‚ (äº¤æ¢æœº/è·¯ç”±å™¨)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                                    â†‘
  è¯»å–é…ç½®æ–‡ä»¶                        æŒ‰é…ç½®è¿æ¥
     â†“                                    â†“
"å¦‚ä½•è¿æ¥è®¾å¤‡?"                      "ç”¨ä»€ä¹ˆæ–¹å¼?"
"ç”¨ä»€ä¹ˆç”¨æˆ·å?"                      "éœ€è¦ä»€ä¹ˆå¯†ç ?"
"ç”¨ä»€ä¹ˆè¿æ¥æ–¹å¼?"                    "æƒé™å¦‚ä½•æå‡?"
```

---

## 2. ğŸ”Œ è¿æ¥ç±»å‹è¯¦è§£


### 2.1 network_cli - ç½‘ç»œå‘½ä»¤è¡Œæ¥å£


**é€šä¿—è§£é‡Š**ï¼šå°±åƒä½ ç”¨SSHè¿œç¨‹ç™»å½•æœåŠ¡å™¨ä¸€æ ·ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ“ä½œç½‘ç»œè®¾å¤‡

**ä»€ä¹ˆæ—¶å€™ç”¨**ï¼š
- âœ… ä¼ ç»Ÿçš„CLIå‘½ä»¤è¡Œç®¡ç†
- âœ… å¤§å¤šæ•°ç½‘ç»œè®¾å¤‡çš„é»˜è®¤ç®¡ç†æ–¹å¼
- âœ… æ”¯æŒäº¤äº’å¼å‘½ä»¤æ“ä½œ

```yaml
# inventoryæ–‡ä»¶ä¸­çš„é…ç½®
[switches]
switch01 ansible_host=192.168.1.10
switch02 ansible_host=192.168.1.11

[switches:vars]
ansible_connection=network_cli    # ä½¿ç”¨ç½‘ç»œCLIè¿æ¥
ansible_network_os=ios           # æŒ‡å®šæ“ä½œç³»ç»Ÿä¸ºCisco IOS
ansible_user=admin               # ç™»å½•ç”¨æˆ·å
ansible_password=admin123        # ç™»å½•å¯†ç 
```

**è¿æ¥è¿‡ç¨‹**ï¼š
```
Step â‘ : Ansibleè¿æ¥åˆ°è®¾å¤‡çš„22ç«¯å£(SSH)
Step â‘¡: ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•
Step â‘¢: è¿›å…¥è®¾å¤‡çš„CLIå‘½ä»¤è¡Œç•Œé¢
Step â‘£: æ‰§è¡Œé…ç½®å‘½ä»¤
Step â‘¤: é€€å‡ºè¿æ¥
```

### 2.2 netconf - ç½‘ç»œé…ç½®åè®®


**é€šä¿—è§£é‡Š**ï¼šä¸€ç§æ›´ç°ä»£çš„ç½‘ç»œè®¾å¤‡ç®¡ç†æ–¹å¼ï¼Œä½¿ç”¨XMLæ ¼å¼ä¼ è¾“é…ç½®

**ä»€ä¹ˆæ—¶å€™ç”¨**ï¼š
- âœ… è®¾å¤‡æ”¯æŒNETCONFåè®®
- âœ… éœ€è¦ç»“æ„åŒ–é…ç½®ç®¡ç†
- âœ… è¦æ±‚æ›´é«˜çš„å¯é æ€§å’Œäº‹åŠ¡æ€§

```yaml
[routers]
router01 ansible_host=192.168.1.20

[routers:vars]
ansible_connection=netconf        # ä½¿ç”¨NETCONFè¿æ¥
ansible_network_os=junos         # Juniperè®¾å¤‡é€šå¸¸æ”¯æŒNETCONF
ansible_user=netconf_user
ansible_password=netconf_pass
```

**NETCONF vs CLI å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | **network_cli** | **netconf** |
|------|----------------|-------------|
| ğŸ”§ **ä½¿ç”¨éš¾åº¦** | `ç®€å•ï¼Œç±»ä¼¼SSHç™»å½•` | `å¤æ‚ï¼Œéœ€è¦XMLçŸ¥è¯†` |
| âš¡ **ä¼ è¾“æ•ˆç‡** | `æ–‡æœ¬ä¼ è¾“ï¼Œæ•ˆç‡ä¸€èˆ¬` | `ç»“æ„åŒ–æ•°æ®ï¼Œæ•ˆç‡é«˜` |
| ğŸ›¡ï¸ **é”™è¯¯å¤„ç†** | `åŸºç¡€é”™è¯¯æ£€æµ‹` | `å®Œæ•´çš„äº‹åŠ¡å›æ»š` |
| ğŸ“± **è®¾å¤‡æ”¯æŒ** | `å‡ ä¹æ‰€æœ‰è®¾å¤‡` | `è¾ƒæ–°è®¾å¤‡æ”¯æŒ` |

### 2.3 httpapi - HTTP APIæ¥å£


**é€šä¿—è§£é‡Š**ï¼šé€šè¿‡HTTPæ¥å£ç®¡ç†è®¾å¤‡ï¼Œå°±åƒè°ƒç”¨Web APIä¸€æ ·

**ä»€ä¹ˆæ—¶å€™ç”¨**ï¼š
- âœ… è®¾å¤‡æä¾›REST APIæ¥å£
- âœ… éœ€è¦é«˜æ€§èƒ½æ‰¹é‡æ“ä½œ
- âœ… ä¸Webç³»ç»Ÿé›†æˆ

```yaml
[firewalls]
fw01 ansible_host=192.168.1.30

[firewalls:vars]
ansible_connection=httpapi       # ä½¿ç”¨HTTP APIè¿æ¥
ansible_network_os=fortios      # FortiGateé˜²ç«å¢™
ansible_user=api_user
ansible_password=api_pass
```

---

## 3. ğŸ–¥ï¸ ç½‘ç»œæ“ä½œç³»ç»Ÿé…ç½®


### 3.1 ansible_network_os - æŒ‡å®šæ“ä½œç³»ç»Ÿç±»å‹


**ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®š**ï¼šä¸åŒå‚å•†çš„ç½‘ç»œè®¾å¤‡å‘½ä»¤æ ¼å¼ä¸åŒ

**å¸¸è§æ“ä½œç³»ç»Ÿ**ï¼š

| å‚å•† | **æ“ä½œç³»ç»Ÿ** | **é…ç½®å€¼** | **è¯´æ˜** |
|------|-------------|-----------|----------|
| ğŸ”µ **Cisco** | `IOS/IOS-XE` | `ios` | `æœ€å¸¸è§çš„äº¤æ¢æœºè·¯ç”±å™¨ç³»ç»Ÿ` |
| ğŸ”µ **Cisco** | `NX-OS` | `nxos` | `æ•°æ®ä¸­å¿ƒäº¤æ¢æœºç³»ç»Ÿ` |
| ğŸ”µ **Cisco** | `ASA` | `asa` | `é˜²ç«å¢™ç³»ç»Ÿ` |
| ğŸŸ¢ **Juniper** | `Junos` | `junos` | `ä¼ä¸šçº§è·¯ç”±äº¤æ¢è®¾å¤‡` |
| ğŸŸ¡ **åä¸º** | `VRP` | `ce` | `åä¸ºç½‘ç»œè®¾å¤‡ç³»ç»Ÿ` |
| ğŸ”´ **Arista** | `EOS` | `eos` | `äº‘ç½‘ç»œäº¤æ¢æœºç³»ç»Ÿ` |

### 3.2 é…ç½®ç¤ºä¾‹


```yaml
# å¤šå‚å•†è®¾å¤‡æ··åˆç¯å¢ƒé…ç½®
[cisco_switches]
cs01 ansible_host=10.1.1.10 ansible_network_os=ios
cs02 ansible_host=10.1.1.11 ansible_network_os=nxos

[juniper_routers] 
jr01 ansible_host=10.1.1.20 ansible_network_os=junos

[huawei_switches]
hs01 ansible_host=10.1.1.30 ansible_network_os=ce

# ç»Ÿä¸€è¿æ¥é…ç½®
[all:vars]
ansible_connection=network_cli
ansible_user=admin
```

### 3.3 æ“ä½œç³»ç»Ÿè¯†åˆ«æŠ€å·§


**å¦‚ä½•ç¡®å®šè®¾å¤‡æ“ä½œç³»ç»Ÿ**ï¼š
```
æ–¹æ³• â‘ : æŸ¥çœ‹è®¾å¤‡æ ‡ç­¾å’Œå‹å·
æ–¹æ³• â‘¡: ç™»å½•è®¾å¤‡æŸ¥çœ‹æç¤ºç¬¦
  - Cisco IOS: Router>
  - Juniper: user@device>
  - åä¸º: <Huawei>

æ–¹æ³• â‘¢: æ‰§è¡Œshow versionå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
```

---

## 4. ğŸ” è®¤è¯ä¸æƒé™é…ç½®


### 4.1 åŸºæœ¬è®¤è¯é…ç½®


**ansible_user / ansible_password - ç”¨æˆ·åå¯†ç **

**é€šä¿—è§£é‡Š**ï¼šå°±åƒä½ ç™»å½•ä»»ä½•ç³»ç»Ÿéœ€è¦ç”¨æˆ·åå¯†ç ä¸€æ ·

```yaml
# æ–¹å¼ä¸€ï¼šç›´æ¥åœ¨inventoryä¸­é…ç½®ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ï¼‰
[switches]
sw01 ansible_host=192.168.1.10 ansible_user=admin ansible_password=secret123

# æ–¹å¼äºŒï¼šä½¿ç”¨group_varsï¼ˆæ¨èï¼‰
# group_vars/switches.yml
ansible_user: admin
ansible_password: "{{ vault_switch_password }}"  # ä½¿ç”¨åŠ å¯†å˜é‡
```

### 4.2 SSHå¯†é’¥è®¤è¯


**ansible_ssh_pass vs ansible_password**ï¼š

```yaml
# SSHå¯†ç è®¤è¯
ansible_ssh_pass: password123    # ä¸“é—¨ç”¨äºSSHè¿æ¥çš„å¯†ç 
ansible_password: password123    # é€šç”¨å¯†ç ï¼Œå„ç§è¿æ¥ç±»å‹éƒ½ç”¨

# SSHå¯†é’¥è®¤è¯ï¼ˆæ¨èï¼‰
ansible_ssh_private_key_file: /path/to/private/key
ansible_ssh_user: admin
```

### 4.3 æƒé™æå‡é…ç½®


**ansible_become_method - æƒé™æå‡æ–¹æ³•**

**ä¸ºä»€ä¹ˆéœ€è¦æƒé™æå‡**ï¼š
- ğŸ”¸ æ™®é€šç”¨æˆ·ç™»å½•åæƒé™æœ‰é™
- ğŸ”¸ é…ç½®æ›´æ”¹éœ€è¦ç®¡ç†å‘˜æƒé™
- ğŸ”¸ ç±»ä¼¼Linuxçš„sudoå‘½ä»¤

**å¸¸è§æå‡æ–¹æ³•**ï¼š

| æ–¹æ³• | **è¯´æ˜** | **é€‚ç”¨è®¾å¤‡** | **ç¤ºä¾‹** |
|------|---------|-------------|---------|
| ğŸ”§ **enable** | `Ciscoè®¾å¤‡ç‰¹æƒæ¨¡å¼` | `Cisco IOS/NX-OS` | `éœ€è¦enableå¯†ç ` |
| ğŸ”§ **sudo** | `Linuxé£æ ¼æƒé™æå‡` | `éƒ¨åˆ†ç°ä»£è®¾å¤‡` | `æ‰§è¡Œsudoå‘½ä»¤` |
| ğŸ”§ **su** | `åˆ‡æ¢åˆ°rootç”¨æˆ·` | `ç±»Unixè®¾å¤‡` | `åˆ‡æ¢ç”¨æˆ·æƒé™` |

```yaml
# Ciscoè®¾å¤‡æƒé™æå‡é…ç½®
[cisco_devices:vars]
ansible_connection=network_cli
ansible_network_os=ios
ansible_user=admin
ansible_password=admin123
ansible_become=yes                    # å¯ç”¨æƒé™æå‡
ansible_become_method=enable         # ä½¿ç”¨enableæ–¹æ³•
ansible_become_password=enable123    # enableå¯†ç 
```

### 4.4 å®‰å…¨é…ç½®å»ºè®®


**ğŸ”’ å¯†ç å®‰å…¨ç®¡ç†**ï¼š
```yaml
# 1. ä½¿ç”¨Ansible VaultåŠ å¯†æ•æ„Ÿä¿¡æ¯
# åˆ›å»ºåŠ å¯†å˜é‡æ–‡ä»¶
$ ansible-vault create group_vars/switches/vault.yml

# vault.ymlå†…å®¹
vault_admin_password: "real_password_here"
vault_enable_password: "enable_password_here"

# 2. åœ¨é…ç½®ä¸­å¼•ç”¨åŠ å¯†å˜é‡
ansible_password: "{{ vault_admin_password }}"
ansible_become_password: "{{ vault_enable_password }}"
```

---

## 5. â±ï¸ è¿æ¥è¶…æ—¶ä¸æŒä¹…åŒ–é…ç½®


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶é…ç½®


**ç°å®é—®é¢˜**ï¼š
- ğŸ”¸ ç½‘ç»œè®¾å¤‡å“åº”æ¯”æœåŠ¡å™¨æ…¢
- ğŸ”¸ å¤æ‚å‘½ä»¤æ‰§è¡Œæ—¶é—´é•¿
- ğŸ”¸ ç½‘ç»œå»¶è¿Ÿå½±å“è¿æ¥ç¨³å®šæ€§

### 5.2 persistent_connection - æŒä¹…è¿æ¥


**é€šä¿—è§£é‡Š**ï¼šä¿æŒä¸è®¾å¤‡çš„è¿æ¥ä¸æ–­å¼€ï¼Œé¿å…é¢‘ç¹å»ºç«‹è¿æ¥

**å¼€å¯å‰ vs å¼€å¯å**ï¼š
```
å…³é—­æŒä¹…è¿æ¥ï¼š
ä»»åŠ¡1: è¿æ¥è®¾å¤‡ â†’ æ‰§è¡Œå‘½ä»¤ â†’ æ–­å¼€è¿æ¥
ä»»åŠ¡2: è¿æ¥è®¾å¤‡ â†’ æ‰§è¡Œå‘½ä»¤ â†’ æ–­å¼€è¿æ¥  
ä»»åŠ¡3: è¿æ¥è®¾å¤‡ â†’ æ‰§è¡Œå‘½ä»¤ â†’ æ–­å¼€è¿æ¥
é—®é¢˜ï¼šæ¯æ¬¡éƒ½è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œæ•ˆç‡ä½

å¼€å¯æŒä¹…è¿æ¥ï¼š
å»ºç«‹è¿æ¥ â†’ ä»»åŠ¡1æ‰§è¡Œ â†’ ä»»åŠ¡2æ‰§è¡Œ â†’ ä»»åŠ¡3æ‰§è¡Œ â†’ ç»Ÿä¸€æ–­å¼€
ä¼˜åŠ¿ï¼šè¿æ¥å»ºç«‹ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæ•ˆç‡é«˜
```

```yaml
[network_devices:vars]
persistent_connection=yes        # å¯ç”¨æŒä¹…è¿æ¥
persistent_command_timeout=30   # å•ä¸ªå‘½ä»¤è¶…æ—¶30ç§’
persistent_connect_timeout=60   # å»ºç«‹è¿æ¥è¶…æ—¶60ç§’
```

### 5.3 è¶…æ—¶å‚æ•°è¯¦è§£


**persistent_command_timeout - å‘½ä»¤æ‰§è¡Œè¶…æ—¶**ï¼š

| åœºæ™¯ | **å»ºè®®å€¼** | **è¯´æ˜** |
|------|-----------|---------|
| ğŸŸ¢ **ç®€å•æŸ¥è¯¢** | `10-15ç§’` | `showå‘½ä»¤ç­‰` |
| ğŸŸ¡ **é…ç½®æ›´æ”¹** | `30-60ç§’` | `é…ç½®å‘½ä»¤` |
| ğŸ”´ **å›ºä»¶å‡çº§** | `300-600ç§’` | `è€—æ—¶æ“ä½œ` |

**persistent_connect_timeout - è¿æ¥å»ºç«‹è¶…æ—¶**ï¼š
```yaml
# ç½‘ç»œç¯å¢ƒé…ç½®å»ºè®®
persistent_connect_timeout=30    # å±€åŸŸç½‘ç¯å¢ƒ
persistent_connect_timeout=60    # å¹¿åŸŸç½‘ç¯å¢ƒ  
persistent_connect_timeout=120   # é«˜å»¶è¿Ÿç½‘ç»œ
```

### 5.4 è¿æ¥ä¼˜åŒ–é…ç½®


```yaml
# å®Œæ•´çš„ç½‘ç»œè¿æ¥ä¼˜åŒ–é…ç½®
[all:vars]
# åŸºç¡€è¿æ¥é…ç½®
ansible_connection=network_cli
ansible_user=netadmin
ansible_password="{{ vault_network_password }}"

# æŒä¹…è¿æ¥é…ç½®
persistent_connection=yes
persistent_command_timeout=45
persistent_connect_timeout=30

# SSHè¿æ¥ä¼˜åŒ–
ansible_ssh_common_args='-o ControlMaster=auto -o ControlPersist=60s'
```

---

## 6. âš™ï¸ é«˜çº§ç½‘ç»œé…ç½®é€‰é¡¹


### 6.1 network_import_modules - ç½‘ç»œæ¨¡å—å¯¼å…¥


**é€šä¿—è§£é‡Š**ï¼šé¢„å…ˆåŠ è½½ç½‘ç»œç›¸å…³çš„åŠŸèƒ½æ¨¡å—ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡

**ä»€ä¹ˆæ—¶å€™éœ€è¦**ï¼š
- âœ… ä½¿ç”¨å¤§é‡ç½‘ç»œæ¨¡å—çš„playbook
- âœ… éœ€è¦æé«˜æ‰§è¡Œæ€§èƒ½
- âœ… å¤æ‚ç½‘ç»œè‡ªåŠ¨åŒ–åœºæ™¯

```yaml
[network_devices:vars]
network_import_modules=yes       # å¯ç”¨æ¨¡å—é¢„å¯¼å…¥
```

### 6.2 provider - æä¾›è€…é…ç½®ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰


**æ³¨æ„**ï¼šè¿™æ˜¯è¾ƒè€çš„é…ç½®æ–¹å¼ï¼Œæ–°ç‰ˆæœ¬å»ºè®®ä½¿ç”¨inventoryå˜é‡

```yaml
# è€å¼é…ç½®æ–¹å¼ï¼ˆäº†è§£å³å¯ï¼‰
- name: é…ç½®äº¤æ¢æœºVLAN
  ios_vlan:
    vlan_id: 100
    name: production
    provider:
      host: "{{ ansible_host }}"
      username: "{{ ansible_user }}"  
      password: "{{ ansible_password }}"
```

**ç°ä»£é…ç½®æ–¹å¼**ï¼š
```yaml
# æ¨èçš„ç°ä»£é…ç½®æ–¹å¼
- name: é…ç½®äº¤æ¢æœºVLAN
  ios_vlan:
    vlan_id: 100
    name: production
  # è¿æ¥ä¿¡æ¯é€šè¿‡inventoryå˜é‡è‡ªåŠ¨è·å–
```

### 6.3 terminal_plugins - ç»ˆç«¯æ’ä»¶


**é€šä¿—è§£é‡Š**ï¼šå¤„ç†ä¸åŒè®¾å¤‡ç»ˆç«¯äº¤äº’çš„æ’ä»¶

**è‡ªåŠ¨é€‰æ‹©æœºåˆ¶**ï¼š
```
Ansibleæ ¹æ®ansible_network_osè‡ªåŠ¨é€‰æ‹©å¯¹åº”æ’ä»¶ï¼š
- ios â†’ iosç»ˆç«¯æ’ä»¶
- junos â†’ junosç»ˆç«¯æ’ä»¶  
- nxos â†’ nxosç»ˆç«¯æ’ä»¶

ä¸€èˆ¬æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚
```

---

## 7. ğŸ’¼ å®é™…é…ç½®ç¤ºä¾‹


### 7.1 å•å‚å•†ç¯å¢ƒé…ç½®


**åœºæ™¯**ï¼šçº¯Ciscoç¯å¢ƒ

```yaml
# inventory/hosts
[cisco_switches]
sw-core-01 ansible_host=10.0.1.10
sw-core-02 ansible_host=10.0.1.11
sw-access-01 ansible_host=10.0.1.20
sw-access-02 ansible_host=10.0.1.21

[cisco_routers]
rtr-gateway ansible_host=10.0.1.1
rtr-branch ansible_host=10.0.2.1

# ç»Ÿä¸€é…ç½®
[cisco_switches:vars]
ansible_connection=network_cli
ansible_network_os=ios
ansible_user=netadmin
ansible_password="{{ vault_cisco_password }}"
ansible_become=yes
ansible_become_method=enable  
ansible_become_password="{{ vault_cisco_enable }}"
persistent_connection=yes
persistent_command_timeout=30

[cisco_routers:vars]
ansible_connection=network_cli
ansible_network_os=ios
ansible_user=netadmin
ansible_password="{{ vault_cisco_password }}"
ansible_become=yes
ansible_become_method=enable
ansible_become_password="{{ vault_cisco_enable }}"
persistent_connection=yes
persistent_command_timeout=45  # è·¯ç”±å™¨å‘½ä»¤å¯èƒ½æ›´è€—æ—¶
```

### 7.2 å¤šå‚å•†æ··åˆç¯å¢ƒé…ç½®


**åœºæ™¯**ï¼šCisco + Juniper + åä¸ºæ··åˆç¯å¢ƒ

```yaml
# inventory/hosts
[cisco_devices]
cs01 ansible_host=10.1.1.10 ansible_network_os=ios
cs02 ansible_host=10.1.1.11 ansible_network_os=nxos

[juniper_devices]  
jr01 ansible_host=10.1.2.10 ansible_network_os=junos

[huawei_devices]
hw01 ansible_host=10.1.3.10 ansible_network_os=ce

# Ciscoè®¾å¤‡é…ç½®
[cisco_devices:vars]
ansible_connection=network_cli
ansible_user=cisco_admin
ansible_password="{{ vault_cisco_password }}"
ansible_become=yes
ansible_become_method=enable
ansible_become_password="{{ vault_cisco_enable }}"

# Juniperè®¾å¤‡é…ç½®  
[juniper_devices:vars]
ansible_connection=netconf      # Juniperæ¨èç”¨NETCONF
ansible_user=juniper_admin
ansible_password="{{ vault_juniper_password }}"

# åä¸ºè®¾å¤‡é…ç½®
[huawei_devices:vars]
ansible_connection=network_cli
ansible_user=huawei_admin  
ansible_password="{{ vault_huawei_password }}"

# å…¨å±€é…ç½®
[all:vars]
persistent_connection=yes
persistent_command_timeout=30
persistent_connect_timeout=30
```

### 7.3 é«˜å¯ç”¨ç¯å¢ƒé…ç½®


**åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒï¼Œè¦æ±‚é«˜ç¨³å®šæ€§

```yaml
# group_vars/network_devices.yml
# è¿æ¥ç¨³å®šæ€§é…ç½®
persistent_connection=yes
persistent_command_timeout=60       # æ›´é•¿çš„å‘½ä»¤è¶…æ—¶
persistent_connect_timeout=45       # æ›´é•¿çš„è¿æ¥è¶…æ—¶

# SSHè¿æ¥ä¼˜åŒ–
ansible_ssh_common_args: >
  -o ControlMaster=auto 
  -o ControlPersist=300s
  -o ServerAliveInterval=60
  -o ServerAliveCountMax=3
  -o ConnectTimeout=10

# é‡è¯•æœºåˆ¶
ansible_ssh_retries=3

# å¹¶å‘æ§åˆ¶ï¼ˆé¿å…è®¾å¤‡è¿‡è½½ï¼‰
serial: 5                           # æ¯æ¬¡åªæ“ä½œ5å°è®¾å¤‡
```

### 7.4 å¼€å‘æµ‹è¯•ç¯å¢ƒé…ç½®


**åœºæ™¯**ï¼šå®éªŒå®¤ç¯å¢ƒï¼Œå¿«é€Ÿæµ‹è¯•

```yaml
# group_vars/lab_devices.yml
# å¿«é€Ÿè¿æ¥é…ç½®
persistent_connection=yes
persistent_command_timeout=15       # è¾ƒçŸ­è¶…æ—¶ï¼Œå¿«é€Ÿå¤±è´¥
persistent_connect_timeout=15

# ç®€åŒ–è®¤è¯ï¼ˆä»…ç”¨äºå®éªŒå®¤ï¼‰
ansible_user=lab
ansible_password=lab123
ansible_become=yes
ansible_become_method=enable
ansible_become_password=lab123

# ç¦ç”¨ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
ansible_ssh_common_args='-o StrictHostKeyChecking=no'
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé…ç½®


```yaml
# ğŸ”¥ æœ€é‡è¦çš„5ä¸ªé…ç½®å‚æ•°
ansible_connection=network_cli       # è¿æ¥ç±»å‹
ansible_network_os=ios              # æ“ä½œç³»ç»Ÿç±»å‹  
ansible_user=admin                  # ç™»å½•ç”¨æˆ·å
ansible_password=password           # ç™»å½•å¯†ç 
ansible_become_method=enable        # æƒé™æå‡æ–¹å¼
```

### 8.2 è¿æ¥æ–¹å¼é€‰æ‹©æŒ‡å—


| è®¾å¤‡ç±»å‹ | **æ¨èè¿æ¥æ–¹å¼** | **å¤‡é€‰æ–¹æ¡ˆ** | **ç†ç”±** |
|---------|-----------------|-------------|---------|
| ğŸ”µ **Cisco IOS** | `network_cli` | `httpapi(éƒ¨åˆ†å‹å·)` | `CLIæœ€é€šç”¨ç¨³å®š` |
| ğŸŸ¢ **Juniper** | `netconf` | `network_cli` | `NETCONFåŠŸèƒ½æ›´å¼º` |
| ğŸŸ¡ **åä¸ºè®¾å¤‡** | `network_cli` | `netconf(æ–°ç‰ˆæœ¬)` | `CLIå…¼å®¹æ€§å¥½` |
| ğŸ”´ **é˜²ç«å¢™** | `httpapi` | `network_cli` | `APIæ¥å£æ›´é«˜æ•ˆ` |

### 8.3 é…ç½®æœ€ä½³å®è·µ


**ğŸ”’ å®‰å…¨é…ç½®**ï¼š
```yaml
# âœ… æ¨èåšæ³•
ansible_password: "{{ vault_encrypted_password }}"   # ä½¿ç”¨åŠ å¯†å˜é‡
ansible_ssh_private_key_file: /secure/path/key      # ä½¿ç”¨SSHå¯†é’¥

# âŒ ä¸æ¨èåšæ³•  
ansible_password: "plaintext_password"              # æ˜æ–‡å¯†ç 
```

**âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼š
```yaml
# âœ… æ¨èé…ç½®
persistent_connection=yes              # å¯ç”¨æŒä¹…è¿æ¥
serial: 10                            # é™åˆ¶å¹¶å‘æ•°é‡
persistent_command_timeout=30         # åˆç†çš„è¶…æ—¶æ—¶é—´

# âŒ æ€§èƒ½é—®é¢˜é…ç½®
persistent_connection=no              # æ¯æ¬¡é‡æ–°è¿æ¥
serial: 100                          # å¹¶å‘è¿‡é«˜å‹å®è®¾å¤‡
persistent_command_timeout=300        # è¶…æ—¶è¿‡é•¿å½±å“æ•ˆç‡
```

### 8.4 æ•…éšœæ’æŸ¥æŠ€å·§


**ğŸ” å¸¸è§é—®é¢˜åŠè§£å†³**ï¼š

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|---------|-------------|-------------|
| `è¿æ¥è¶…æ—¶` | `ç½‘ç»œä¸é€šæˆ–é˜²ç«å¢™` | `æ£€æŸ¥ç½‘ç»œè¿é€šæ€§` |
| `è®¤è¯å¤±è´¥` | `ç”¨æˆ·åå¯†ç é”™è¯¯` | `éªŒè¯å‡­æ®ä¿¡æ¯` |
| `æƒé™ä¸è¶³` | `æœªé…ç½®become` | `æ·»åŠ æƒé™æå‡é…ç½®` |
| `å‘½ä»¤è¶…æ—¶` | `è¶…æ—¶æ—¶é—´è¿‡çŸ­` | `å¢åŠ command_timeoutå€¼` |

### 8.5 è®°å¿†è¦ç‚¹


**ğŸ¯ æ ¸å¿ƒè®°å¿†æ³•**ï¼š
```
è¿æ¥ä¸‰è¦ç´ ï¼š
1ï¸âƒ£ æ€ä¹ˆè¿ï¼šansible_connection (network_cli/netconf/httpapi)
2ï¸âƒ£ è¿ä»€ä¹ˆï¼šansible_network_os (ios/junos/nxos...)  
3ï¸âƒ£ ç”¨ä»€ä¹ˆè¿ï¼šansible_user + ansible_password

æƒé™æå‡ï¼š
ğŸ” æ˜¯å¦éœ€è¦ï¼šansible_become=yes
ğŸ”‘ å¦‚ä½•æå‡ï¼šansible_become_method=enable
ğŸ—ï¸ æå‡å¯†ç ï¼šansible_become_password

æ€§èƒ½ä¼˜åŒ–ï¼š
âš¡ æŒä¹…è¿æ¥ï¼špersistent_connection=yes
â±ï¸ è¶…æ—¶æ§åˆ¶ï¼špersistent_command_timeout
ğŸ”„ å¹¶å‘é™åˆ¶ï¼šserialå‚æ•°
```

**ğŸ“ é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
- â˜‘ï¸ è®¾å¤‡IPåœ°å€å’Œç«¯å£å¯è¾¾æ€§
- â˜‘ï¸ ç”¨æˆ·åå¯†ç æ­£ç¡®æ€§
- â˜‘ï¸ æ“ä½œç³»ç»Ÿç±»å‹åŒ¹é…
- â˜‘ï¸ è¿æ¥æ–¹å¼é€‰æ‹©åˆé€‚
- â˜‘ï¸ æƒé™æå‡é…ç½®å®Œæ•´
- â˜‘ï¸ è¶…æ—¶å‚æ•°è®¾ç½®åˆç†
- â˜‘ï¸ æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†å­˜å‚¨

**æ ¸å¿ƒç†å¿µ**ï¼šç½‘ç»œè®¾å¤‡é…ç½®çš„å…³é”®æ˜¯è¦ç†è§£æ¯ç§è®¾å¤‡çš„ç‰¹æ®Šæ€§ï¼Œé€‰æ‹©åˆé€‚çš„è¿æ¥æ–¹å¼å’Œå‚æ•°ï¼Œç¡®ä¿æ—¢èƒ½ç¨³å®šè¿æ¥åˆèƒ½é«˜æ•ˆæ‰§è¡Œä»»åŠ¡ã€‚