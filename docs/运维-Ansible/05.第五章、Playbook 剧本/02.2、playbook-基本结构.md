---
title: 2ã€playbook-åŸºæœ¬ç»“æ„
---
## ğŸ“š ç›®å½•

1. [Playå®šä¹‰ä¸æ ¸å¿ƒæ¦‚å¿µ](#1-Playå®šä¹‰ä¸æ ¸å¿ƒæ¦‚å¿µ)
2. [hostsä¸»æœºæŒ‡å®šç­–ç•¥](#2-hostsä¸»æœºæŒ‡å®šç­–ç•¥)
3. [tasksä»»åŠ¡åˆ—è¡¨è®¾è®¡](#3-tasksä»»åŠ¡åˆ—è¡¨è®¾è®¡)
4. [varså˜é‡å®šä¹‰æœºåˆ¶](#4-varså˜é‡å®šä¹‰æœºåˆ¶)
5. [nameä»»åŠ¡æè¿°è§„èŒƒ](#5-nameä»»åŠ¡æè¿°è§„èŒƒ)
6. [becomeæƒé™æå‡ç®¡ç†](#6-becomeæƒé™æå‡ç®¡ç†)
7. [gather_factsäº‹å®æ”¶é›†](#7-gather_factsäº‹å®æ”¶é›†)
8. [serialæ‰¹é‡æ‰§è¡Œæ§åˆ¶](#8-serialæ‰¹é‡æ‰§è¡Œæ§åˆ¶)
9. [max_fail_percentageå¤±è´¥ç‡ç®¡ç†](#9-max_fail_percentageå¤±è´¥ç‡ç®¡ç†)
10. [tagsæ ‡ç­¾ç®¡ç†ä½“ç³»](#10-tagsæ ‡ç­¾ç®¡ç†ä½“ç³»)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ­ Playå®šä¹‰ä¸æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Play

ğŸ¯ **ç®€å•ç†è§£**ï¼šPlayå°±åƒä¸€åœºæˆå‰§è¡¨æ¼”ï¼Œå®šä¹‰äº†åœ¨å“ªäº›ä¸»æœºä¸Šæ‰§è¡Œä»€ä¹ˆä»»åŠ¡

```
æˆå‰§ç±»æ¯”ç†è§£ï¼š
ç¼–å‰§å†™å‰§æœ¬ â†’ è¿ç»´å†™Playbook
æ¼”å‘˜åˆ†é…è§’è‰² â†’ ä¸»æœºåˆ†é…ä»»åŠ¡
æŒ‰å‰§æœ¬æ¼”å‡º â†’ æŒ‰Playbookæ‰§è¡Œ

æ ¸å¿ƒè¦ç´ ï¼š
å‰§æœ¬åç§° â†’ Play name
æ¼”å‘˜åå• â†’ hostsåˆ—è¡¨
è¡¨æ¼”å†…å®¹ â†’ tasksä»»åŠ¡
é“å…·å‡†å¤‡ â†’ varså˜é‡
```

**ğŸ“‹ Playçš„åŸºæœ¬ç»“æ„**
```yaml
- name: å®‰è£…å’Œé…ç½®WebæœåŠ¡å™¨  # Playåç§°
  hosts: webservers           # ç›®æ ‡ä¸»æœºç»„
  become: yes                 # æƒé™æå‡
  vars:                       # å˜é‡å®šä¹‰
    package_name: nginx
  tasks:                      # ä»»åŠ¡åˆ—è¡¨
    - name: å®‰è£…nginx
      package:
        name: "{{ package_name }}"
        state: present
```

### 1.2 Playä¸Playbookçš„å…³ç³»

**ğŸ”¸ å±‚çº§å…³ç³»è¯´æ˜**

```
Playbookç»“æ„å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Playbook           â”‚ â† æ•´ä¸ªå‰§æœ¬æ–‡ä»¶
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     Play 1      â”‚    â”‚ â† ç¬¬ä¸€åœºæˆ
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Task 1  â”‚    â”‚    â”‚ â† å…·ä½“åŠ¨ä½œ
â”‚  â”‚  â”‚ Task 2  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     Play 2      â”‚    â”‚ â† ç¬¬äºŒåœºæˆ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®é™…å…³ç³»ï¼š
ä¸€ä¸ªPlaybook = ä¸€ä¸ªYAMLæ–‡ä»¶
ä¸€ä¸ªPlay = ä¸€ä¸ªYAMLå­—å…¸å…ƒç´ 
ä¸€ä¸ªTask = Playä¸­tasksåˆ—è¡¨çš„ä¸€ä¸ªæ¡ç›®
```

### 1.3 Playæ‰§è¡Œæµç¨‹

**âš¡ Playçš„æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ**

```
Playæ‰§è¡Œæ­¥éª¤ï¼š
1. ä¸»æœºåŒ¹é… â†’ æ ¹æ®hostså‚æ•°ç¡®å®šç›®æ ‡æœåŠ¡å™¨
2. äº‹å®æ”¶é›† â†’ gather_factsæ”¶é›†ä¸»æœºä¿¡æ¯
3. å˜é‡å¤„ç† â†’ è§£æå’Œè®¾ç½®æ‰€æœ‰å˜é‡
4. ä»»åŠ¡æ‰§è¡Œ â†’ æŒ‰é¡ºåºæ‰§è¡Œtasksä¸­çš„ä»»åŠ¡
5. å¤„ç†å™¨è¿è¡Œ â†’ è§¦å‘çš„handlersåœ¨æœ€åæ‰§è¡Œ

æ‰§è¡Œç‰¹ç‚¹ï¼š
å¹¶è¡Œæ‰§è¡Œï¼šé»˜è®¤åŒæ—¶åœ¨å¤šå°ä¸»æœºä¸Šæ‰§è¡Œ
é¡ºåºä¿è¯ï¼šåŒä¸€ä¸»æœºä¸Šçš„ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ
å¤±è´¥å¤„ç†ï¼šå¯é…ç½®å¤±è´¥ç­–ç•¥å’Œå®¹é”™æœºåˆ¶
å¹‚ç­‰æ€§ï¼šå¤šæ¬¡æ‰§è¡Œç»“æœä¸€è‡´
```

---

## 2. ğŸ¯ hostsä¸»æœºæŒ‡å®šç­–ç•¥


### 2.1 åŸºæœ¬ä¸»æœºæŒ‡å®šæ–¹æ³•

**ğŸ”§ çµæ´»çš„ä¸»æœºé€‰æ‹©è¯­æ³•**

```yaml
# 1. æŒ‡å®šå•ä¸ªä¸»æœº
hosts: server1.example.com

# 2. æŒ‡å®šä¸»æœºç»„
hosts: webservers

# 3. æŒ‡å®šå¤šä¸ªç»„ï¼ˆå¹¶é›†ï¼‰
hosts: webservers,databases

# 4. ä½¿ç”¨é€šé…ç¬¦
hosts: web*.example.com

# 5. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
hosts: ~web[0-9]+\.example\.com
```

**ğŸ“Š ä¸»æœºé€‰æ‹©ç­–ç•¥å¯¹æ¯”**

| æŒ‡å®šæ–¹å¼ | **è¯­æ³•ç¤ºä¾‹** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|---------|-------------|-------------|-----------|
| ğŸ”¸ **å•ä¸ªä¸»æœº** | `server1.example.com` | `æµ‹è¯•éƒ¨ç½²` | `ç²¾ç¡®ä½†ä¸çµæ´»` |
| ğŸ”¸ **ä¸»æœºç»„** | `webservers` | `æ‰¹é‡æ“ä½œ` | `çµæ´»ä¸”æ˜“ç®¡ç†` |
| ğŸ”¸ **å¤šç»„åˆå¹¶** | `web,db` | `è·¨æœåŠ¡éƒ¨ç½²` | `å¼ºå¤§ä½†å¤æ‚` |
| ğŸ”¸ **é€šé…ç¬¦** | `web*.com` | `æ¨¡å¼åŒ¹é…` | `æ–¹ä¾¿ä½†å¯èƒ½è¯¯é€‰` |
| ğŸ”¸ **æ­£åˆ™è¡¨è¾¾å¼** | `~web[0-9]+` | `å¤æ‚åŒ¹é…` | `ç²¾ç¡®ä½†éš¾è¯»` |

### 2.2 é«˜çº§ä¸»æœºé€‰æ‹©æŠ€å·§

**ğŸ¨ å¤æ‚ä¸»æœºé€‰æ‹©ç»„åˆ**

```yaml
# æ’é™¤ç‰¹å®šä¸»æœº
hosts: webservers:!web3.example.com

# äº¤é›†æ“ä½œï¼ˆåŒæ—¶å±äºä¸¤ä¸ªç»„çš„ä¸»æœºï¼‰
hosts: webservers:&production

# å¤åˆæ¡ä»¶ç»„åˆ
hosts: webservers:databases:!staging:&production

# åŸºäºå˜é‡æ¡ä»¶é€‰æ‹©
hosts: all
tasks:
  - name: åªåœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ
    debug:
      msg: "ç”Ÿäº§ç¯å¢ƒä»»åŠ¡"
    when: environment == "production"
```

**ğŸ’¡ ä¸»æœºé€‰æ‹©æœ€ä½³å®è·µ**
```
ç»„ç»‡ç»“æ„å»ºè®®ï¼š
æŒ‰ç¯å¢ƒåˆ†ç»„ï¼šproduction, staging, development
æŒ‰åŠŸèƒ½åˆ†ç»„ï¼šwebservers, databases, loadbalancers
æŒ‰åœ°ç†ä½ç½®ï¼šbeijing, shanghai, guangzhou
æŒ‰äº‘å‚å•†ï¼šaws, aliyun, tencent

å‘½åè§„èŒƒï¼š
ç¯å¢ƒå‰ç¼€ï¼šprod-web, stage-db, dev-app
åŠŸèƒ½åç¼€ï¼šweb-servers, db-masters, db-slaves
ç‰ˆæœ¬æ ‡è¯†ï¼šweb-v1, web-v2, api-v3

å®‰å…¨è€ƒè™‘ï¼š
ç”Ÿäº§ç¯å¢ƒç‹¬ç«‹åˆ†ç»„
æ•æ„Ÿæ“ä½œé™åˆ¶ä¸»æœºèŒƒå›´
ä½¿ç”¨å˜é‡æ§åˆ¶æ‰§è¡Œæ¡ä»¶
```

### 2.3 åŠ¨æ€ä¸»æœºæ¸…å•

**ğŸŒ åŠ¨æ€ä¸»æœºå‘ç°æœºåˆ¶**

```yaml
# ä½¿ç”¨åŠ¨æ€æ¸…å•æ’ä»¶
- name: åŠ¨æ€è·å–äº‘æœåŠ¡å™¨
  hosts: tag_Environment_Production
  # ä»äº‘å‚å•†APIåŠ¨æ€è·å–ä¸»æœºåˆ—è¡¨
  
- name: åŸºäºæ ‡ç­¾é€‰æ‹©ä¸»æœº
  hosts: all
  vars:
    target_hosts: "{{ groups['tag_Role_WebServer'] }}"
  tasks:
    - name: å¯¹æŒ‡å®šä¸»æœºæ‰§è¡Œä»»åŠ¡
      debug:
        msg: "åœ¨ {{ inventory_hostname }} ä¸Šæ‰§è¡Œ"
      when: inventory_hostname in target_hosts
```

---

## 3. âœ… tasksä»»åŠ¡åˆ—è¡¨è®¾è®¡


### 3.1 ä»»åŠ¡çš„åŸºæœ¬ç»“æ„

**ğŸ”¸ æ ‡å‡†ä»»åŠ¡è¯­æ³•æ ¼å¼**

```yaml
tasks:
  - name: ä»»åŠ¡æè¿°ä¿¡æ¯
    module_name:          # ä½¿ç”¨çš„æ¨¡å—
      parameter1: value1  # æ¨¡å—å‚æ•°
      parameter2: value2
    register: result      # ä¿å­˜æ‰§è¡Œç»“æœ
    when: condition       # æ‰§è¡Œæ¡ä»¶
    tags: [tag1, tag2]    # ä»»åŠ¡æ ‡ç­¾
    ignore_errors: yes    # å¿½ç•¥é”™è¯¯
    changed_when: false   # å˜æ›´æ¡ä»¶
```

**ğŸ¯ å®é™…ä»»åŠ¡ç¤ºä¾‹**

```yaml
tasks:
  - name: ç¡®ä¿nginxå·²å®‰è£…
    package:
      name: nginx
      state: present
    register: nginx_install
    tags: [install, nginx]
    
  - name: åˆ›å»ºnginxé…ç½®æ–‡ä»¶
    template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      backup: yes
    notify: restart nginx
    when: nginx_install is succeeded
```

### 3.2 ä»»åŠ¡æ‰§è¡Œæ§åˆ¶

**âš™ï¸ ä»»åŠ¡æµç¨‹æ§åˆ¶æœºåˆ¶**

```yaml
# æ¡ä»¶æ‰§è¡Œ
- name: ä»…åœ¨CentOSç³»ç»Ÿæ‰§è¡Œ
  yum:
    name: epel-release
    state: present
  when: ansible_distribution == "CentOS"

# å¾ªç¯æ‰§è¡Œ
- name: å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…
  package:
    name: "{{ item }}"
    state: present
  loop:
    - nginx
    - mysql-server
    - php

# é”™è¯¯å¤„ç†
- name: å°è¯•å¯åŠ¨æœåŠ¡
  service:
    name: nginx
    state: started
  ignore_errors: yes
  register: service_result

- name: é”™è¯¯åçš„å¤„ç†
  debug:
    msg: "æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œè·³è¿‡åç»­é…ç½®"
  when: service_result is failed
```

### 3.3 ä»»åŠ¡ç»„ç»‡ç­–ç•¥

**ğŸ“‹ ä»»åŠ¡åˆ†ç»„ä¸å¤ç”¨**

```yaml
# ä½¿ç”¨import_tasksåŒ…å«ä»»åŠ¡æ–‡ä»¶
- name: å®‰è£…åŸºç¡€ç»„ä»¶
  import_tasks: common/install_base.yml

# ä½¿ç”¨include_tasksåŠ¨æ€åŒ…å«
- name: æ ¹æ®ç³»ç»Ÿç±»å‹æ‰§è¡Œä¸åŒä»»åŠ¡
  include_tasks: "{{ ansible_distribution }}.yml"

# ä»»åŠ¡å—(block)ç»„ç»‡ç›¸å…³ä»»åŠ¡
- name: WebæœåŠ¡å™¨é…ç½®å—
  block:
    - name: å®‰è£…nginx
      package:
        name: nginx
        state: present
    
    - name: é…ç½®nginx
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
        
    - name: å¯åŠ¨nginxæœåŠ¡
      service:
        name: nginx
        state: started
        enabled: yes
  rescue:
    - name: é…ç½®å¤±è´¥æ—¶çš„å¤„ç†
      debug:
        msg: "WebæœåŠ¡å™¨é…ç½®å¤±è´¥"
  always:
    - name: æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œçš„æ¸…ç†ä»»åŠ¡
      file:
        path: /tmp/install.lock
        state: absent
```

---

## 4. ğŸ“Š varså˜é‡å®šä¹‰æœºåˆ¶


### 4.1 å˜é‡å®šä¹‰çš„å¤šç§æ–¹å¼

**ğŸ”§ å˜é‡çš„å£°æ˜å’Œä½¿ç”¨**

```yaml
# Playçº§åˆ«å˜é‡å®šä¹‰
- name: WebæœåŠ¡å™¨éƒ¨ç½²
  hosts: webservers
  vars:
    nginx_version: "1.20.2"
    document_root: "/var/www/html"
    ssl_enabled: true
    
  # ä»æ–‡ä»¶åŠ è½½å˜é‡
  vars_files:
    - vars/common.yml
    - vars/{{ environment }}.yml
    
  tasks:
    - name: ä½¿ç”¨å˜é‡å®‰è£…ç‰¹å®šç‰ˆæœ¬nginx
      package:
        name: "nginx={{ nginx_version }}"
        state: present
```

**ğŸ“ å¤–éƒ¨å˜é‡æ–‡ä»¶ç»„ç»‡**

```
é¡¹ç›®ç›®å½•ç»“æ„ï¼š
playbooks/
â”œâ”€â”€ site.yml
â”œâ”€â”€ vars/
â”‚   â”œâ”€â”€ common.yml      # é€šç”¨å˜é‡
â”‚   â”œâ”€â”€ production.yml  # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”‚   â”œâ”€â”€ staging.yml     # æµ‹è¯•ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ development.yml # å¼€å‘ç¯å¢ƒå˜é‡
â””â”€â”€ group_vars/
    â”œâ”€â”€ webservers.yml  # WebæœåŠ¡å™¨ç»„å˜é‡
    â””â”€â”€ databases.yml   # æ•°æ®åº“ç»„å˜é‡
```

### 4.2 å˜é‡ä¼˜å…ˆçº§ç†è§£

**âš–ï¸ å˜é‡è¦†ç›–ä¼˜å…ˆçº§é¡ºåº**

```
å˜é‡ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. å‘½ä»¤è¡Œå‚æ•°(-e)          æœ€é«˜ä¼˜å…ˆçº§
2. taskä¸­å®šä¹‰çš„vars
3. blockä¸­å®šä¹‰çš„vars
4. playä¸­å®šä¹‰çš„vars
5. vars_filesæ–‡ä»¶
6. è§’è‰²é»˜è®¤å˜é‡
7. group_varsæ–‡ä»¶å˜é‡
8. host_varsæ–‡ä»¶å˜é‡
9. æ¸…å•æ–‡ä»¶ä¸­çš„å˜é‡      æœ€ä½ä¼˜å…ˆçº§

å®é™…åº”ç”¨ç†è§£ï¼š
å‘½ä»¤è¡Œ > Playbookå†…éƒ¨ > å¤–éƒ¨æ–‡ä»¶ > æ¸…å•å®šä¹‰
ä¸´æ—¶æ€§ > æ°¸ä¹…æ€§ï¼Œç‰¹æ®Šæ€§ > é€šç”¨æ€§
```

### 4.3 å˜é‡ä½¿ç”¨æŠ€å·§

**ğŸ’¡ é«˜çº§å˜é‡æ“ä½œ**

```yaml
# å­—å…¸å˜é‡å®šä¹‰å’Œä½¿ç”¨
vars:
  mysql_config:
    bind_address: "0.0.0.0"
    port: 3306
    max_connections: 100
    
tasks:
  - name: é…ç½®MySQLç«¯å£
    lineinfile:
      path: /etc/mysql/my.cnf
      line: "port = {{ mysql_config.port }}"

# åˆ—è¡¨å˜é‡å’Œå¾ªç¯
vars:
  users:
    - name: alice
      uid: 1001
      groups: [wheel, users]
    - name: bob
      uid: 1002
      groups: [users]

tasks:
  - name: åˆ›å»ºç”¨æˆ·
    user:
      name: "{{ item.name }}"
      uid: "{{ item.uid }}"
      groups: "{{ item.groups | join(',') }}"
    loop: "{{ users }}"

# å˜é‡æ³¨å†Œå’Œæ¡ä»¶åˆ¤æ–­
- name: æ£€æŸ¥æœåŠ¡çŠ¶æ€
  command: systemctl is-active nginx
  register: nginx_status
  ignore_errors: yes

- name: æ ¹æ®æœåŠ¡çŠ¶æ€æ‰§è¡Œä¸åŒæ“ä½œ
  debug:
    msg: "nginxæœåŠ¡ {{ 'è¿è¡Œä¸­' if nginx_status.rc == 0 else 'å·²åœæ­¢' }}"
```

---

## 5. ğŸ“ nameä»»åŠ¡æè¿°è§„èŒƒ


### 5.1 ä»»åŠ¡å‘½åæœ€ä½³å®è·µ

**âœï¸ æ¸…æ™°æ˜“æ‡‚çš„ä»»åŠ¡æè¿°**

```yaml
# âŒ ä¸å¥½çš„å‘½åæ–¹å¼
- name: install
  package:
    name: nginx

- name: copy file
  copy:
    src: config
    dest: /etc/

# âœ… å¥½çš„å‘½åæ–¹å¼
- name: å®‰è£…nginx webæœåŠ¡å™¨
  package:
    name: nginx
    state: present

- name: å¤åˆ¶nginxä¸»é…ç½®æ–‡ä»¶åˆ°ç›®æ ‡æœåŠ¡å™¨
  copy:
    src: files/nginx.conf
    dest: /etc/nginx/nginx.conf
    backup: yes
```

**ğŸ“‹ å‘½åè§„èŒƒå»ºè®®**

```
å‘½åè§„èŒƒè¦ç‚¹ï¼š

åŠ¨ä½œæè¿°ï¼š
ä½¿ç”¨åŠ¨è¯å¼€å¤´ï¼šå®‰è£…ã€é…ç½®ã€å¯åŠ¨ã€åˆ›å»ºã€åˆ é™¤
æ˜ç¡®æ“ä½œå¯¹è±¡ï¼šå®‰è£…nginxã€é…ç½®é˜²ç«å¢™ã€å¯åŠ¨MySQLæœåŠ¡

çŠ¶æ€æè¿°ï¼š
ç¡®ä¿çŠ¶æ€ï¼šç¡®ä¿nginxå·²å®‰è£…ã€ç¡®ä¿ç”¨æˆ·å­˜åœ¨
éªŒè¯ç»“æœï¼šéªŒè¯æœåŠ¡è¿è¡ŒçŠ¶æ€ã€æ£€æŸ¥æ–‡ä»¶æƒé™

æ¡ä»¶è¯´æ˜ï¼š
ä»…åœ¨ç”Ÿäº§ç¯å¢ƒå®‰è£…SSLè¯ä¹¦
å¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºé»˜è®¤é…ç½®
å½“å†…å­˜å¤§äº8GBæ—¶å¯ç”¨é«˜æ€§èƒ½æ¨¡å¼

ä¸­è‹±æ–‡é€‰æ‹©ï¼š
å›¢é˜Ÿå†…éƒ¨ï¼šå»ºè®®ä½¿ç”¨ä¸­æ–‡ï¼Œä¾¿äºç†è§£
å¼€æºé¡¹ç›®ï¼šä½¿ç”¨è‹±æ–‡ï¼Œå›½é™…åŒ–å‹å¥½
æ··åˆä½¿ç”¨ï¼šå…³é”®è¯è‹±æ–‡ï¼Œæè¿°ä¸­æ–‡
```

### 5.2 ä»»åŠ¡æè¿°çš„ä¿¡æ¯å±‚æ¬¡

**ğŸ¯ åˆ†å±‚æ¬¡çš„ä»»åŠ¡æè¿°ç­–ç•¥**

```yaml
# ç®€æ´æè¿°ï¼ˆé€‚åˆç®€å•ä»»åŠ¡ï¼‰
- name: å®‰è£…nginx
  package:
    name: nginx

# è¯¦ç»†æè¿°ï¼ˆé€‚åˆå¤æ‚ä»»åŠ¡ï¼‰
- name: é…ç½®nginx SSLè™šæ‹Ÿä¸»æœºå¹¶å¯ç”¨HTTP/2æ”¯æŒ
  template:
    src: ssl-vhost.conf.j2
    dest: "/etc/nginx/sites-available/{{ domain_name }}-ssl.conf"
    
# å¸¦çŠ¶æ€æè¿°ï¼ˆé€‚åˆéªŒè¯ä»»åŠ¡ï¼‰
- name: ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œä¸”å¼€æœºè‡ªå¯
  service:
    name: mysql
    state: started
    enabled: yes

# æ¡ä»¶æè¿°ï¼ˆé€‚åˆæ¡ä»¶æ‰§è¡Œï¼‰
- name: ä»…åœ¨Ubuntuç³»ç»Ÿä¸Šå®‰è£…apt-transport-https
  package:
    name: apt-transport-https
    state: present
  when: ansible_distribution == "Ubuntu"
```

### 5.3 ä»»åŠ¡æè¿°çš„ç‰ˆæœ¬ç®¡ç†

**ğŸ“š æè¿°çš„ç»´æŠ¤å’Œæ›´æ–°**

```yaml
# åŒ…å«ç‰ˆæœ¬ä¿¡æ¯çš„æè¿°
- name: å®‰è£…nginx 1.20.2ç‰ˆæœ¬ä»¥ä¿®å¤CVE-2021-3618æ¼æ´
  package:
    name: "nginx=1.20.2-*"
    state: present

# åŒ…å«å˜æ›´åŸå› çš„æè¿°
- name: æ›´æ–°nginxé…ç½®ä»¥æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
  template:
    src: nginx-optimized.conf.j2
    dest: /etc/nginx/nginx.conf
  # å˜æ›´è®°å½•ï¼šworker_connectionsä»1024è°ƒæ•´è‡³2048

# åŒ…å«å½±å“èŒƒå›´çš„æè¿°
- name: é‡å¯nginxæœåŠ¡(å½±å“æ‰€æœ‰è™šæ‹Ÿä¸»æœºè®¿é—®)
  service:
    name: nginx
    state: restarted
```

---

## 6. ğŸ” becomeæƒé™æå‡ç®¡ç†


### 6.1 becomeæœºåˆ¶åŸç†

**âš¡ æƒé™æå‡çš„å·¥ä½œåŸç†**

```
æƒé™æå‡æµç¨‹ï¼š
æ™®é€šç”¨æˆ·è¿æ¥ â†’ Ansibleå»ºç«‹SSHè¿æ¥
æ‰§è¡Œsudoå‘½ä»¤ â†’ becomeå‚æ•°è§¦å‘æƒé™æå‡  
è·å¾—rootæƒé™ â†’ æ‰§è¡Œéœ€è¦ç‰¹æƒçš„ä»»åŠ¡
ä»»åŠ¡å®Œæˆå â†’ æ¢å¤æ™®é€šç”¨æˆ·æƒé™

become vs sudoçš„åŒºåˆ«ï¼š
becomeï¼šAnsibleå†…ç½®æƒé™ç®¡ç†æœºåˆ¶
sudoï¼šæ“ä½œç³»ç»Ÿå±‚é¢çš„æƒé™åˆ‡æ¢å·¥å…·
becomeæ”¯æŒï¼šsudoã€suã€doasã€pbrunç­‰å¤šç§æ–¹å¼
```

### 6.2 becomeé…ç½®è¯¦è§£

**ğŸ”§ å…¨é¢çš„æƒé™é…ç½®é€‰é¡¹**

```yaml
# Playçº§åˆ«çš„becomeé…ç½®
- name: ç³»ç»Ÿç»´æŠ¤ä»»åŠ¡
  hosts: servers
  become: yes                    # å¯ç”¨æƒé™æå‡
  become_method: sudo           # æƒé™æå‡æ–¹å¼
  become_user: root             # ç›®æ ‡ç”¨æˆ·
  become_flags: '-H -S -n'      # sudoå‚æ•°
  
  tasks:
    - name: æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…
      package:
        name: "*"
        state: latest

# ä»»åŠ¡çº§åˆ«çš„becomeé…ç½®
- name: ç”¨æˆ·ç®¡ç†å’Œç³»ç»Ÿé…ç½®
  hosts: servers
  tasks:
    - name: åˆ›å»ºæ™®é€šç”¨æˆ·(æ— éœ€ç‰¹æƒ)
      user:
        name: developer
        shell: /bin/bash
      become: no
      
    - name: å®‰è£…ç³»ç»Ÿè½¯ä»¶(éœ€è¦ç‰¹æƒ)
      package:
        name: git
        state: present
      become: yes
      become_user: root
```

**ğŸ“Š ä¸åŒæƒé™æå‡æ–¹å¼å¯¹æ¯”**

| æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **é…ç½®å¤æ‚åº¦** | **å®‰å…¨æ€§** | **å…¼å®¹æ€§** |
|------|-------------|--------------|-----------|-----------|
| ğŸ”¸ **sudo** | `Linuxç³»ç»Ÿ` | `ç®€å•` | `é«˜` | `æœ€ä½³` |
| ğŸ”¸ **su** | `ä¼ ç»ŸUnix` | `ä¸­ç­‰` | `ä¸­ç­‰` | `å¹¿æ³›` |
| ğŸ”¸ **doas** | `OpenBSD` | `ç®€å•` | `é«˜` | `æœ‰é™` |
| ğŸ”¸ **pbrun** | `ä¼ä¸šç¯å¢ƒ` | `å¤æ‚` | `å¾ˆé«˜` | `æœ‰é™` |

### 6.3 æƒé™ç®¡ç†æœ€ä½³å®è·µ

**ğŸ›¡ï¸ å®‰å…¨çš„æƒé™ä½¿ç”¨ç­–ç•¥**

```yaml
# æœ€å°æƒé™åŸåˆ™
- name: WebæœåŠ¡é…ç½®
  hosts: webservers
  tasks:
    # åªåœ¨éœ€è¦æ—¶ä½¿ç”¨become
    - name: åˆ›å»ºç½‘ç«™ç›®å½•(æ™®é€šæƒé™)
      file:
        path: /home/{{ ansible_user }}/website
        state: directory
      
    # ç³»ç»Ÿé…ç½®éœ€è¦ç‰¹æƒ
    - name: å®‰è£…nginx(éœ€è¦rootæƒé™)
      package:
        name: nginx
        state: present
      become: yes
      
    # æœåŠ¡ç®¡ç†éœ€è¦ç‰¹æƒ
    - name: å¯åŠ¨nginxæœåŠ¡(éœ€è¦rootæƒé™)
      service:
        name: nginx
        state: started
      become: yes

# ä¸åŒç”¨æˆ·æƒé™åˆ‡æ¢
- name: æ•°æ®åº“æ“ä½œ
  hosts: dbservers
  tasks:
    - name: åˆ›å»ºæ•°æ®åº“ç”¨æˆ·
      mysql_user:
        name: appuser
        password: "{{ app_password }}"
        priv: "appdb.*:ALL"
      become: yes
      become_user: mysql  # åˆ‡æ¢åˆ°mysqlç”¨æˆ·æ‰§è¡Œ

# æƒé™éªŒè¯å’Œé”™è¯¯å¤„ç†
- name: æƒé™éªŒè¯ç¤ºä¾‹
  hosts: all
  tasks:
    - name: æµ‹è¯•sudoæƒé™
      command: whoami
      become: yes
      register: sudo_test
      
    - name: éªŒè¯æƒé™æå‡ç»“æœ
      fail:
        msg: "æƒé™æå‡å¤±è´¥ï¼Œå½“å‰ç”¨æˆ·ä¸æ˜¯root"
      when: sudo_test.stdout != "root"
```

---

## 7. ğŸ” gather_factsäº‹å®æ”¶é›†


### 7.1 äº‹å®æ”¶é›†æœºåˆ¶

**ğŸ“Š ç³»ç»Ÿä¿¡æ¯è‡ªåŠ¨æ”¶é›†**

```yaml
# é»˜è®¤å¯ç”¨äº‹å®æ”¶é›†
- name: ç³»ç»Ÿä¿¡æ¯æ”¶é›†æ¼”ç¤º
  hosts: all
  gather_facts: yes  # é»˜è®¤å€¼ï¼Œå¯çœç•¥
  
  tasks:
    - name: æ˜¾ç¤ºæ”¶é›†åˆ°çš„ç³»ç»Ÿä¿¡æ¯
      debug:
        msg: |
          æ“ä½œç³»ç»Ÿ: {{ ansible_distribution }} {{ ansible_distribution_version }}
          ä¸»æœºå: {{ ansible_hostname }}
          IPåœ°å€: {{ ansible_default_ipv4.address }}
          å†…å­˜å¤§å°: {{ ansible_memtotal_mb }}MB
          CPUæ ¸æ•°: {{ ansible_processor_cores }}
```

**ğŸ”¸ å¸¸ç”¨ç³»ç»Ÿäº‹å®å˜é‡**

```
ç¡¬ä»¶ä¿¡æ¯ï¼š
ansible_processor          # CPUä¿¡æ¯
ansible_memtotal_mb        # æ€»å†…å­˜(MB)
ansible_memfree_mb         # å¯ç”¨å†…å­˜(MB)
ansible_architecture       # ç³»ç»Ÿæ¶æ„

ç½‘ç»œä¿¡æ¯ï¼š
ansible_default_ipv4       # é»˜è®¤IPv4ä¿¡æ¯
ansible_all_ipv4_addresses # æ‰€æœ‰IPv4åœ°å€
ansible_hostname           # ä¸»æœºå
ansible_fqdn              # å®Œå…¨é™å®šåŸŸå

æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼š
ansible_distribution       # å‘è¡Œç‰ˆåç§°
ansible_distribution_version # ç‰ˆæœ¬å·
ansible_kernel             # å†…æ ¸ç‰ˆæœ¬
ansible_python_version     # Pythonç‰ˆæœ¬

å­˜å‚¨ä¿¡æ¯ï¼š
ansible_mounts            # æŒ‚è½½ç‚¹ä¿¡æ¯
ansible_devices           # å­˜å‚¨è®¾å¤‡ä¿¡æ¯
```

### 7.2 äº‹å®æ”¶é›†æ§åˆ¶

**âš™ï¸ çµæ´»æ§åˆ¶æ”¶é›†è¡Œä¸º**

```yaml
# ç¦ç”¨äº‹å®æ”¶é›†ï¼ˆæé«˜æ€§èƒ½ï¼‰
- name: å¿«é€Ÿä»»åŠ¡æ‰§è¡Œ
  hosts: all
  gather_facts: no
  tasks:
    - name: ç®€å•æ–‡ä»¶æ“ä½œ
      file:
        path: /tmp/test
        state: touch

# æ‰‹åŠ¨æ”¶é›†ç‰¹å®šäº‹å®
- name: æŒ‰éœ€æ”¶é›†äº‹å®
  hosts: all
  gather_facts: no
  tasks:
    - name: ä»…æ”¶é›†ç¡¬ä»¶ä¿¡æ¯
      setup:
        filter: "ansible_processor*,ansible_memtotal_mb"
      
    - name: æ˜¾ç¤ºæ”¶é›†çš„ä¿¡æ¯
      debug:
        msg: "CPU: {{ ansible_processor_count }}æ ¸, å†…å­˜: {{ ansible_memtotal_mb }}MB"

# æ¡ä»¶æ”¶é›†äº‹å®
- name: æ™ºèƒ½äº‹å®æ”¶é›†
  hosts: all
  gather_facts: no
  tasks:
    - name: æ£€æŸ¥æ˜¯å¦éœ€è¦æ”¶é›†äº‹å®
      setup:
      when: need_system_info | default(false)
```

### 7.3 è‡ªå®šä¹‰äº‹å®æ”¶é›†

**ğŸ¨ æ‰©å±•ç³»ç»Ÿäº‹å®ä¿¡æ¯**

```yaml
# è®¾ç½®è‡ªå®šä¹‰äº‹å®
- name: è‡ªå®šä¹‰äº‹å®æ¼”ç¤º
  hosts: all
  tasks:
    - name: åˆ›å»ºè‡ªå®šä¹‰äº‹å®æ–‡ä»¶
      copy:
        content: |
          #!/bin/bash
          echo '{"application_version": "1.0.2", "environment": "production"}'
        dest: /etc/ansible/facts.d/custom.fact
        mode: '0755'
      become: yes
    
    - name: é‡æ–°æ”¶é›†äº‹å®(åŒ…å«è‡ªå®šä¹‰äº‹å®)
      setup:
        
    - name: ä½¿ç”¨è‡ªå®šä¹‰äº‹å®
      debug:
        msg: "åº”ç”¨ç‰ˆæœ¬: {{ ansible_local.custom.application_version }}"

# äº‹å®ç¼“å­˜é…ç½®
- name: ä½¿ç”¨äº‹å®ç¼“å­˜æé«˜æ€§èƒ½
  hosts: all
  gather_facts: yes
  tasks:
    - name: åŸºäºç¼“å­˜çš„äº‹å®ä½¿ç”¨ç¤ºä¾‹
      template:
        src: system_info.j2
        dest: "/tmp/{{ ansible_hostname }}_info.txt"
```

---

## 8. ğŸ¢ serialæ‰¹é‡æ‰§è¡Œæ§åˆ¶


### 8.1 serialæœºåˆ¶åŸç†

**âš¡ åˆ†æ‰¹æ‰§è¡Œæ§åˆ¶ç­–ç•¥**

```yaml
# åŸºæœ¬serialç”¨æ³•
- name: æ»šåŠ¨æ›´æ–°WebæœåŠ¡
  hosts: webservers
  serial: 2  # æ¯æ¬¡åªåœ¨2å°ä¸»æœºä¸Šæ‰§è¡Œ
  
  tasks:
    - name: åœæ­¢nginxæœåŠ¡
      service:
        name: nginx
        state: stopped
        
    - name: æ›´æ–°nginxé…ç½®
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
        
    - name: å¯åŠ¨nginxæœåŠ¡
      service:
        name: nginx
        state: started

# ä½¿ç”¨ç™¾åˆ†æ¯”æ§åˆ¶
- name: å¤§è§„æ¨¡æœåŠ¡æ›´æ–°
  hosts: all_servers  # å‡è®¾æœ‰100å°æœåŠ¡å™¨
  serial: "30%"       # æ¯æ¬¡å¤„ç†30%çš„æœåŠ¡å™¨
  
  tasks:
    - name: ç³»ç»Ÿæ›´æ–°
      package:
        name: "*"
        state: latest
```

**ğŸ¯ serialçš„åº”ç”¨åœºæ™¯**

```
é€‚ç”¨åœºæ™¯åˆ†æï¼š

æ»šåŠ¨æ›´æ–°åœºæ™¯ï¼š
- WebæœåŠ¡å™¨é›†ç¾¤æ›´æ–°
- æ•°æ®åº“ä¸»ä»åˆ‡æ¢
- åº”ç”¨ç¨‹åºç‰ˆæœ¬å‡çº§
- é…ç½®æ–‡ä»¶æ‰¹é‡æ›´æ–°

é«˜å¯ç”¨ä¿éšœï¼š
- ç¡®ä¿æœåŠ¡ä¸ä¸­æ–­
- è´Ÿè½½å‡è¡¡å™¨æ‘˜é™¤èŠ‚ç‚¹
- åˆ†æ‰¹éªŒè¯æ›´æ–°æ•ˆæœ
- å‡ºç°é—®é¢˜å¿«é€Ÿå›æ»š

èµ„æºé™åˆ¶åœºæ™¯ï¼š
- é¿å…ç½‘ç»œå¸¦å®½å æ»¡
- æ§åˆ¶æ•°æ®åº“è¿æ¥æ•°
- é™åˆ¶ç£ç›˜I/Oå‹åŠ›
- ç®¡ç†CPUä½¿ç”¨ç‡
```

### 8.2 å¤æ‚serialé…ç½®

**ğŸ”§ é«˜çº§æ‰¹é‡æ§åˆ¶ç­–ç•¥**

```yaml
# åŠ¨æ€serialé…ç½®
- name: æ™ºèƒ½æ‰¹é‡æ‰§è¡Œ
  hosts: production_servers
  serial: "{{ batch_size | default(5) }}"  # é€šè¿‡å˜é‡æ§åˆ¶æ‰¹æ¬¡å¤§å°
  
  vars:
    batch_size: "{{ groups['production_servers'] | length // 4 }}"  # åˆ†4æ‰¹æ‰§è¡Œ
  
  tasks:
    - name: æ˜¾ç¤ºå½“å‰æ‰¹æ¬¡ä¿¡æ¯
      debug:
        msg: "å½“å‰å¤„ç†ç¬¬{{ play_batch }}æ‰¹ï¼Œä¸»æœº: {{ ansible_play_batch }}"

# åˆ†é˜¶æ®µserialç­–ç•¥
- name: åˆ†é˜¶æ®µæœåŠ¡æ›´æ–°
  hosts: webservers
  serial:
    - 1        # ç¬¬ä¸€é˜¶æ®µï¼š1å°æœåŠ¡å™¨(æµ‹è¯•)
    - 25%      # ç¬¬äºŒé˜¶æ®µï¼š25%æœåŠ¡å™¨(å°è§„æ¨¡éªŒè¯)  
    - 100%     # ç¬¬ä¸‰é˜¶æ®µï¼šå‰©ä½™æ‰€æœ‰æœåŠ¡å™¨
  
  tasks:
    - name: æ‰§è¡Œæ›´æ–°æ“ä½œ
      include_tasks: update_web_server.yml
      
    - name: éªŒè¯æœåŠ¡çŠ¶æ€
      uri:
        url: "http://{{ ansible_default_ipv4.address }}/health"
        method: GET
        status_code: 200
```

### 8.3 serialä¸é«˜å¯ç”¨æ¶æ„

**ğŸ—ï¸ åœ¨é«˜å¯ç”¨ç¯å¢ƒä¸­çš„åº”ç”¨**

```yaml
# è´Ÿè½½å‡è¡¡å™¨é…åˆçš„æ»šåŠ¨æ›´æ–°
- name: è´Ÿè½½å‡è¡¡ç¯å¢ƒä¸‹çš„å®‰å…¨æ›´æ–°
  hosts: web_cluster
  serial: 1
  
  tasks:
    - name: ä»è´Ÿè½½å‡è¡¡å™¨æ‘˜é™¤èŠ‚ç‚¹
      uri:
        url: "http://{{ load_balancer }}/api/remove/{{ inventory_hostname }}"
        method: POST
      delegate_to: localhost
      
    - name: ç­‰å¾…è¿æ¥è€—å°½
      wait_for:
        timeout: 30
        
    - name: æ‰§è¡ŒæœåŠ¡æ›´æ–°
      include_tasks: service_update.yml
      
    - name: éªŒè¯æœåŠ¡å¥åº·çŠ¶æ€
      wait_for:
        port: 80
        host: "{{ ansible_default_ipv4.address }}"
        timeout: 60
        
    - name: å°†èŠ‚ç‚¹é‡æ–°åŠ å…¥è´Ÿè½½å‡è¡¡
      uri:
        url: "http://{{ load_balancer }}/api/add/{{ inventory_hostname }}"
        method: POST
      delegate_to: localhost

# æ•°æ®åº“ä¸»ä»ç¯å¢ƒçš„serialåº”ç”¨
- name: MySQLä¸»ä»å¤åˆ¶ç¯å¢ƒæ›´æ–°
  hosts: mysql_slaves
  serial: 1  # é€ä¸ªæ›´æ–°ä»åº“
  
  tasks:
    - name: åœæ­¢ä»åº“å¤åˆ¶
      mysql_replication:
        mode: stopslave
        
    - name: æ‰§è¡Œæ•°æ®åº“æ›´æ–°
      mysql_db:
        name: "{{ item }}"
        state: import
        target: "/tmp/update_{{ item }}.sql"
      loop: "{{ databases }}"
      
    - name: å¯åŠ¨ä»åº“å¤åˆ¶
      mysql_replication:
        mode: startslave
        
    - name: éªŒè¯å¤åˆ¶çŠ¶æ€
      mysql_replication:
        mode: getslave
      register: slave_status
      
    - name: æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
      fail:
        msg: "ä»åº“å¤åˆ¶å»¶è¿Ÿè¿‡é«˜"
      when: slave_status.Seconds_Behind_Master > 10
```

---

## 9. âš ï¸ max_fail_percentageå¤±è´¥ç‡ç®¡ç†


### 9.1 å¤±è´¥ç‡æ§åˆ¶æœºåˆ¶

**ğŸ¯ å®¹é”™é˜ˆå€¼ç®¡ç†ç­–ç•¥**

```yaml
# åŸºæœ¬å¤±è´¥ç‡æ§åˆ¶
- name: æ‰¹é‡ç³»ç»Ÿæ›´æ–°
  hosts: all_servers
  max_fail_percentage: 20  # å…è®¸20%çš„ä¸»æœºå¤±è´¥
  
  tasks:
    - name: ç³»ç»Ÿè½¯ä»¶åŒ…æ›´æ–°
      package:
        name: "*"
        state: latest
        
    - name: é‡å¯æœåŠ¡å™¨
      reboot:
        reboot_timeout: 600

# ç»“åˆserialä½¿ç”¨
- name: å®‰å…¨çš„æ»šåŠ¨éƒ¨ç½²
  hosts: production_web
  serial: 5
  max_fail_percentage: 10  # æ¯æ‰¹æœ€å¤šå…è®¸10%å¤±è´¥
  
  tasks:
    - name: éƒ¨ç½²æ–°ç‰ˆæœ¬åº”ç”¨
      copy:
        src: "app-v{{ app_version }}.jar"
        dest: /opt/app/app.jar
        
    - name: é‡å¯åº”ç”¨æœåŠ¡
      systemd:
        name: myapp
        state: restarted
```

**ğŸ“Š å¤±è´¥ç‡è®¡ç®—é€»è¾‘**

```
å¤±è´¥ç‡è®¡ç®—æ–¹å¼ï¼š
å½“å‰æ‰¹æ¬¡å¤±è´¥ä¸»æœºæ•° / å½“å‰æ‰¹æ¬¡æ€»ä¸»æœºæ•° Ã— 100%

æ‰§è¡Œé€»è¾‘ï¼š
1. æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡éƒ½ä¼šè®¡ç®—å¤±è´¥ç‡
2. è¶…è¿‡é˜ˆå€¼æ—¶ç«‹å³åœæ­¢åç»­ä»»åŠ¡
3. å·²ç»å¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡ä¼šå®Œæˆ
4. æœªå¼€å§‹çš„æ‰¹æ¬¡ä¸ä¼šæ‰§è¡Œ

å®é™…æ¡ˆä¾‹ï¼š
10å°æœåŠ¡å™¨ï¼Œserial=5ï¼Œmax_fail_percentage=20
ç¬¬ä¸€æ‰¹5å°ï¼š1å°å¤±è´¥(20%)ï¼Œç»§ç»­æ‰§è¡Œ
ç¬¬äºŒæ‰¹5å°ï¼š2å°å¤±è´¥(40%)ï¼Œåœæ­¢æ‰§è¡Œ
```

### 9.2 å¤±è´¥å¤„ç†ç­–ç•¥

**ğŸ›¡ï¸ å¤šå±‚æ¬¡çš„é”™è¯¯å¤„ç†æœºåˆ¶**

```yaml
# ä»»åŠ¡çº§åˆ«å¤±è´¥å¤„ç†
- name: å¤æ‚æœåŠ¡éƒ¨ç½²
  hosts: app_servers
  max_fail_percentage: 15
  
  tasks:
    - name: ä¸‹è½½åº”ç”¨åŒ…
      get_url:
        url: "{{ app_download_url }}"
        dest: "/tmp/app-{{ app_version }}.tar.gz"
      register: download_result
      retries: 3           # é‡è¯•3æ¬¡
      delay: 10           # æ¯æ¬¡é‡è¯•é—´éš”10ç§’
      
    - name: è§£å‹åº”ç”¨åŒ…
      unarchive:
        src: "/tmp/app-{{ app_version }}.tar.gz"
        dest: /opt/app/
        remote_src: yes
      when: download_result is succeeded
      
    - name: å¤‡ä»½å½“å‰ç‰ˆæœ¬
      command: cp -r /opt/app/current /opt/app/backup-{{ ansible_date_time.epoch }}
      ignore_errors: yes  # é¦–æ¬¡éƒ¨ç½²æ—¶å¯èƒ½æ²¡æœ‰å½“å‰ç‰ˆæœ¬
      
    - name: éƒ¨ç½²æ–°ç‰ˆæœ¬
      file:
        src: "/opt/app/app-{{ app_version }}"
        dest: /opt/app/current
        state: link
      register: deploy_result
      
    - name: å¯åŠ¨åº”ç”¨æœåŠ¡
      systemd:
        name: myapp
        state: restarted
      when: deploy_result is succeeded

# ä½¿ç”¨rescueå¤„ç†å¤±è´¥
- name: å¸¦æœ‰å¤±è´¥å›æ»šçš„éƒ¨ç½²
  hosts: web_servers
  max_fail_percentage: 25
  
  tasks:
    - name: åº”ç”¨éƒ¨ç½²è¿‡ç¨‹
      block:
        - name: åœæ­¢å½“å‰æœåŠ¡
          systemd:
            name: webapp
            state: stopped
            
        - name: éƒ¨ç½²æ–°ç‰ˆæœ¬
          copy:
            src: "webapp-v{{ new_version }}/"
            dest: /var/www/html/
            
        - name: å¯åŠ¨æœåŠ¡
          systemd:
            name: webapp
            state: started
            
        - name: å¥åº·æ£€æŸ¥
          uri:
            url: "http://{{ ansible_default_ipv4.address }}/health"
            status_code: 200
          retries: 5
          delay: 10
          
      rescue:
        - name: å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
          copy:
            src: "/var/backups/webapp-v{{ previous_version }}/"
            dest: /var/www/html/
            
        - name: é‡å¯æœåŠ¡
          systemd:
            name: webapp
            state: restarted
```

### 9.3 ç›‘æ§å’Œé€šçŸ¥

**ğŸ“Š å¤±è´¥çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦**

```yaml
# å¤±è´¥ç›‘æ§å’Œé€šçŸ¥
- name: å…³é”®ä¸šåŠ¡ç³»ç»Ÿæ›´æ–°
  hosts: critical_servers
  max_fail_percentage: 5  # å…³é”®ç³»ç»Ÿå®¹é”™ç‡å¾ˆä½
  
  vars:
    notification_webhook: "https://hooks.slack.com/services/xxx"
  
  tasks:
    - name: ç³»ç»Ÿæ›´æ–°
      package:
        name: "{{ item }}"
        state: latest
      loop: "{{ critical_packages }}"
      register: update_results
      
    - name: ç»Ÿè®¡æ›´æ–°ç»“æœ
      set_fact:
        failed_hosts: "{{ ansible_play_hosts | difference(ansible_play_hosts_all) }}"
        success_count: "{{ ansible_play_hosts | length }}"
        total_count: "{{ groups[group_names[0]] | length }}"
        
    - name: å‘é€æˆåŠŸé€šçŸ¥
      uri:
        url: "{{ notification_webhook }}"
        method: POST
        body_format: json
        body:
          text: "ç³»ç»Ÿæ›´æ–°å®Œæˆ: {{ success_count }}/{{ total_count }} å°æœåŠ¡å™¨æˆåŠŸ"
      delegate_to: localhost
      run_once: yes
      when: failed_hosts | length == 0
      
    - name: å‘é€å¤±è´¥å‘Šè­¦
      uri:
        url: "{{ notification_webhook }}"
        method: POST
        body_format: json
        body:
          text: "âš ï¸ ç³»ç»Ÿæ›´æ–°å¼‚å¸¸: {{ failed_hosts | length }} å°æœåŠ¡å™¨å¤±è´¥"
          attachments:
            - color: "danger"
              fields:
                - title: "å¤±è´¥ä¸»æœº"
                  value: "{{ failed_hosts | join(', ') }}"
                - title: "å¤±è´¥ç‡"
                  value: "{{ (failed_hosts | length / total_count * 100) | round(1) }}%"
      delegate_to: localhost
      run_once: yes
      when: failed_hosts | length > 0
```

---

## 10. ğŸ·ï¸ tagsæ ‡ç­¾ç®¡ç†ä½“ç³»


### 10.1 tagsåŸºç¡€æ¦‚å¿µ

**ğŸ¯ æ ‡ç­¾çš„ä½œç”¨å’Œä»·å€¼**

```yaml
# åŸºæœ¬æ ‡ç­¾ä½¿ç”¨
- name: WebæœåŠ¡å™¨å®Œæ•´éƒ¨ç½²
  hosts: webservers
  
  tasks:
    - name: å®‰è£…nginx
      package:
        name: nginx
        state: present
      tags: [install, nginx]
      
    - name: é…ç½®nginx
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      tags: [config, nginx]
      notify: restart nginx
      
    - name: å¯åŠ¨nginxæœåŠ¡
      service:
        name: nginx
        state: started
        enabled: yes
      tags: [service, nginx]
      
    - name: å®‰è£…MySQL
      package:
        name: mysql-server
        state: present
      tags: [install, mysql]
      
    - name: é…ç½®MySQL
      template:
        src: my.cnf.j2
        dest: /etc/mysql/my.cnf
      tags: [config, mysql]
```

**ğŸ¨ æ ‡ç­¾çš„æ‰§è¡Œæ§åˆ¶**

```bash
# æ‰§è¡Œç‰¹å®šæ ‡ç­¾çš„ä»»åŠ¡
ansible-playbook site.yml --tags "install"
ansible-playbook site.yml --tags "nginx,mysql"

# è·³è¿‡ç‰¹å®šæ ‡ç­¾
ansible-playbook site.yml --skip-tags "config"

# åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾
ansible-playbook site.yml --list-tags

# æ‰§è¡Œé™¤äº†ç‰¹å®šæ ‡ç­¾å¤–çš„æ‰€æœ‰ä»»åŠ¡
ansible-playbook site.yml --skip-tags "mysql"
```

### 10.2 æ ‡ç­¾åˆ†ç±»ä½“ç³»

**ğŸ“‹ æ ‡ç­¾çš„åˆ†ç±»å’Œå‘½åè§„èŒƒ**

```yaml
# æŒ‰åŠŸèƒ½é˜¶æ®µåˆ†ç±»
- name: åº”ç”¨éƒ¨ç½²æµç¨‹
  hosts: app_servers
  tasks:
    # å‡†å¤‡é˜¶æ®µ
    - name: åˆ›å»ºåº”ç”¨ç›®å½•
      file:
        path: /opt/myapp
        state: directory
      tags: [prepare, setup]
      
    - name: å®‰è£…ä¾èµ–åŒ…
      package:
        name: "{{ item }}"
        state: present
      loop: "{{ app_dependencies }}"
      tags: [prepare, install, dependencies]
      
    # éƒ¨ç½²é˜¶æ®µ  
    - name: ä¸‹è½½åº”ç”¨åŒ…
      get_url:
        url: "{{ app_url }}"
        dest: "/tmp/app.tar.gz"
      tags: [deploy, download]
      
    - name: è§£å‹åº”ç”¨
      unarchive:
        src: /tmp/app.tar.gz
        dest: /opt/myapp/
        remote_src: yes
      tags: [deploy, extract]
      
    # é…ç½®é˜¶æ®µ
    - name: ç”Ÿæˆåº”ç”¨é…ç½®
      template:
        src: app.conf.j2
        dest: /opt/myapp/config/app.conf
      tags: [config, application]
      
    - name: è®¾ç½®æ•°æ®åº“è¿æ¥
      template:
        src: database.yml.j2
        dest: /opt/myapp/config/database.yml
      tags: [config, database]
      
    # å¯åŠ¨é˜¶æ®µ
    - name: å¯åŠ¨åº”ç”¨æœåŠ¡
      systemd:
        name: myapp
        state: started
        enabled: yes
      tags: [start, service]
      
    # éªŒè¯é˜¶æ®µ
    - name: å¥åº·æ£€æŸ¥
      uri:
        url: "http://{{ ansible_default_ipv4.address }}:8080/health"
        status_code: 200
      tags: [verify, healthcheck]
```

**ğŸ—ï¸ æ ‡ç­¾å‘½åä½“ç³»å»ºè®®**

```
åŠŸèƒ½ç»´åº¦æ ‡ç­¾ï¼š
install    - å®‰è£…ç›¸å…³ä»»åŠ¡
config     - é…ç½®ç›¸å…³ä»»åŠ¡  
service    - æœåŠ¡ç®¡ç†ä»»åŠ¡
security   - å®‰å…¨é…ç½®ä»»åŠ¡
backup     - å¤‡ä»½ç›¸å…³ä»»åŠ¡

ç»„ä»¶ç»´åº¦æ ‡ç­¾ï¼š
nginx      - Nginxç›¸å…³ä»»åŠ¡
mysql      - MySQLç›¸å…³ä»»åŠ¡
redis      - Redisç›¸å…³ä»»åŠ¡
app        - åº”ç”¨ç¨‹åºä»»åŠ¡

ç¯å¢ƒç»´åº¦æ ‡ç­¾ï¼š
production - ç”Ÿäº§ç¯å¢ƒä¸“ç”¨
staging    - æµ‹è¯•ç¯å¢ƒä¸“ç”¨
development- å¼€å‘ç¯å¢ƒä¸“ç”¨

ç´§æ€¥ç¨‹åº¦æ ‡ç­¾ï¼š
critical   - å…³é”®ä»»åŠ¡
normal     - æ™®é€šä»»åŠ¡
optional   - å¯é€‰ä»»åŠ¡
```

### 10.3 é«˜çº§æ ‡ç­¾åº”ç”¨

**ğŸª å¤æ‚åœºæ™¯çš„æ ‡ç­¾ç­–ç•¥**

```yaml
# æ¡ä»¶æ ‡ç­¾åº”ç”¨
- name: ç¯å¢ƒç‰¹å®šçš„éƒ¨ç½²
  hosts: all
  
  tasks:
    - name: å®‰è£…å¼€å‘å·¥å…·
      package:
        name: "{{ item }}"
        state: present
      loop:
        - git
        - vim
        - htop
      tags: 
        - always        # æ€»æ˜¯æ‰§è¡Œ
        - development   # å¼€å‘ç¯å¢ƒæ ‡ç­¾
      when: environment == "development"
      
    - name: é…ç½®ç”Ÿäº§ç¯å¢ƒå®‰å…¨è®¾ç½®
      include_tasks: security_hardening.yml
      tags: [production, security, critical]
      when: environment == "production"
      
    - name: æ€§èƒ½ä¼˜åŒ–é…ç½®
      include_tasks: performance_tuning.yml
      tags: [production, optimization]
      when: environment == "production"

# åŠ¨æ€æ ‡ç­¾ç”Ÿæˆ
- name: åŸºäºä¸»æœºç»„çš„åŠ¨æ€æ ‡ç­¾
  hosts: all
  tasks:
    - name: åº”ç”¨é€šç”¨é…ç½®
      template:
        src: common.conf.j2
        dest: /etc/common.conf
      tags: 
        - common
        - "{{ group_names | first }}"  # ä½¿ç”¨ç¬¬ä¸€ä¸ªç»„åä½œä¸ºæ ‡ç­¾
        
    - name: WebæœåŠ¡å™¨ç‰¹å®šä»»åŠ¡
      include_tasks: web_tasks.yml
      tags: ["{{ ansible_hostname }}", webserver]
      when: "'webservers' in group_names"

# æ ‡ç­¾ç»§æ‰¿å’Œç»„åˆ
- name: å¤æ‚æ ‡ç­¾ç»§æ‰¿ç¤ºä¾‹
  hosts: database_servers
  
  tasks:
    - name: æ•°æ®åº“åŸºç¡€é…ç½®
      block:
        - name: å®‰è£…MySQL
          package:
            name: mysql-server
            state: present
            
        - name: é…ç½®MySQL
          template:
            src: mysql.conf.j2
            dest: /etc/mysql/mysql.conf.d/custom.cnf
            
        - name: å¯åŠ¨MySQLæœåŠ¡
          service:
            name: mysql
            state: started
            enabled: yes
      tags: [database, mysql, basic]  # å—çº§æ ‡ç­¾
      
    - name: é«˜å¯ç”¨é…ç½®
      block:
        - name: é…ç½®ä¸»ä»å¤åˆ¶
          include_tasks: mysql_replication.yml
          
        - name: é…ç½®å¤‡ä»½ç­–ç•¥
          include_tasks: mysql_backup.yml
      tags: [database, mysql, ha, advanced]  # é«˜çº§åŠŸèƒ½æ ‡ç­¾
```

**ğŸš€ æ ‡ç­¾æœ€ä½³å®è·µ**

```yaml
# æ ‡ç­¾ä½¿ç”¨æœ€ä½³å®è·µç¤ºä¾‹
- name: ä¼ä¸šçº§åº”ç”¨éƒ¨ç½²
  hosts: production
  
  vars:
    # æ ‡ç­¾ç»„åˆå®šä¹‰
    basic_tags: [prepare, install, basic]
    config_tags: [config, security]
    service_tags: [service, start]
    verify_tags: [verify, test]
  
  tasks:
    # ä½¿ç”¨é¢„å®šä¹‰æ ‡ç­¾ç»„åˆ
    - name: åŸºç¡€ç¯å¢ƒå‡†å¤‡
      include_tasks: prepare_environment.yml
      tags: "{{ basic_tags }}"
      
    - name: åº”ç”¨é…ç½®éƒ¨ç½²  
      include_tasks: deploy_config.yml
      tags: "{{ config_tags }}"
      
    - name: æœåŠ¡å¯åŠ¨ç®¡ç†
      include_tasks: manage_services.yml
      tags: "{{ service_tags }}"
      
    - name: éƒ¨ç½²éªŒè¯æµ‹è¯•
      include_tasks: verification_tests.yml
      tags: "{{ verify_tags }}"
      
    # ç‰¹æ®Šæ ‡ç­¾ï¼šnever - é™¤éæ˜¾å¼æŒ‡å®šå¦åˆ™ä¸æ‰§è¡Œ
    - name: å±é™©æ“ä½œï¼šé‡ç½®æ•°æ®åº“
      include_tasks: reset_database.yml
      tags: [never, dangerous, reset]
      
    # ç‰¹æ®Šæ ‡ç­¾ï¼šalways - æ€»æ˜¯æ‰§è¡Œ(é™¤éä½¿ç”¨--skip-tags)
    - name: è®°å½•éƒ¨ç½²æ—¥å¿—
      lineinfile:
        path: /var/log/deployment.log
        line: "{{ ansible_date_time.iso8601 }} - Playbook executed on {{ inventory_hostname }}"
      tags: [always, logging]
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Playç»“æ„ï¼šAnsible Playbookçš„åŸºæœ¬æ‰§è¡Œå•å…ƒ
ğŸ”¸ ä¸»æœºé€‰æ‹©ï¼šçµæ´»çš„ç›®æ ‡ä¸»æœºæŒ‡å®šå’Œç»„åˆè¯­æ³•
ğŸ”¸ ä»»åŠ¡è®¾è®¡ï¼šç»“æ„åŒ–çš„ä»»åŠ¡ç»„ç»‡å’Œæµç¨‹æ§åˆ¶
ğŸ”¸ å˜é‡ç®¡ç†ï¼šå¤šå±‚æ¬¡çš„å˜é‡å®šä¹‰å’Œä¼˜å…ˆçº§æœºåˆ¶
ğŸ”¸ ä»»åŠ¡å‘½åï¼šæ¸…æ™°è§„èŒƒçš„ä»»åŠ¡æè¿°å’Œæ–‡æ¡£åŒ–
ğŸ”¸ æƒé™ç®¡ç†ï¼šå®‰å…¨çš„becomeæƒé™æå‡ç­–ç•¥
ğŸ”¸ äº‹å®æ”¶é›†ï¼šè‡ªåŠ¨åŒ–çš„ç³»ç»Ÿä¿¡æ¯æ”¶é›†å’Œä½¿ç”¨
ğŸ”¸ æ‰¹é‡æ§åˆ¶ï¼šserialæœºåˆ¶å®ç°å®‰å…¨çš„æ»šåŠ¨éƒ¨ç½²
ğŸ”¸ å®¹é”™æœºåˆ¶ï¼šmax_fail_percentageå¤±è´¥ç‡æ§åˆ¶
ğŸ”¸ æ ‡ç­¾ä½“ç³»ï¼šçµæ´»çš„ä»»åŠ¡åˆ†ç±»å’Œé€‰æ‹©æ€§æ‰§è¡Œ
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Playbookç»“æ„è®¾è®¡åŸåˆ™**
```
å±‚æ¬¡åŒ–ç»„ç»‡ï¼š
Playbook â†’ Play â†’ Task â†’ Module
æ–‡ä»¶ â†’ åœºæ™¯ â†’ æ­¥éª¤ â†’ æ“ä½œ

æ¨¡å—åŒ–è®¾è®¡ï¼š
åŠŸèƒ½åˆ†ç¦»ï¼šä¸åŒåŠŸèƒ½ç‹¬ç«‹çš„Play
ä»»åŠ¡å¤ç”¨ï¼šé€šç”¨ä»»åŠ¡ç‹¬ç«‹æ–‡ä»¶
å˜é‡é›†ä¸­ï¼šç»Ÿä¸€çš„å˜é‡ç®¡ç†

å¯ç»´æŠ¤æ€§ï¼š
æ¸…æ™°å‘½åï¼šè§åçŸ¥æ„çš„ä»»åŠ¡æè¿°
åˆç†åˆ†ç»„ï¼šç›¸å…³ä»»åŠ¡é€»è¾‘åˆ†ç»„
æ–‡æ¡£å®Œæ•´ï¼šå……åˆ†çš„æ³¨é‡Šå’Œè¯´æ˜
```

**ğŸ”¹ æ‰§è¡Œæ§åˆ¶çš„æ ¸å¿ƒæœºåˆ¶**
```
å¹¶å‘æ§åˆ¶ï¼š
serialï¼šæ§åˆ¶åŒæ—¶æ‰§è¡Œçš„ä¸»æœºæ•°é‡
max_fail_percentageï¼šæ§åˆ¶å¯æ¥å—çš„å¤±è´¥ç‡
gather_factsï¼šæ§åˆ¶ä¿¡æ¯æ”¶é›†çš„å¼€é”€

æ¡ä»¶æ§åˆ¶ï¼š
whenï¼šåŸºäºæ¡ä»¶çš„ä»»åŠ¡æ‰§è¡Œ
tagsï¼šåŸºäºæ ‡ç­¾çš„é€‰æ‹©æ€§æ‰§è¡Œ
å˜é‡ï¼šåŸºäºå˜é‡çš„åŠ¨æ€è¡Œä¸º

æƒé™æ§åˆ¶ï¼š
becomeï¼šç²¾ç¡®çš„æƒé™æå‡ç®¡ç†
æœ€å°æƒé™ï¼šåªåœ¨å¿…è¦æ—¶æå‡æƒé™
å®‰å…¨ç­–ç•¥ï¼šæƒé™ä½¿ç”¨çš„å®‰å…¨å®è·µ
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
```
å®‰å…¨éƒ¨ç½²ï¼š
æ»šåŠ¨éƒ¨ç½²ï¼šserialç¡®ä¿æœåŠ¡è¿ç»­æ€§
å¥åº·æ£€æŸ¥ï¼šéªŒè¯æ¯ä¸ªéƒ¨ç½²æ­¥éª¤
å¤±è´¥å›æ»šï¼šè‡ªåŠ¨åŒ–çš„å›æ»šæœºåˆ¶

è¿ç»´æ•ˆç‡ï¼š
æ ‡ç­¾ç®¡ç†ï¼šçµæ´»çš„ä»»åŠ¡æ‰§è¡Œæ§åˆ¶
å˜é‡å¤ç”¨ï¼šå‡å°‘é‡å¤é…ç½®
äº‹å®ç¼“å­˜ï¼šæé«˜æ‰§è¡Œæ€§èƒ½

å›¢é˜Ÿåä½œï¼š
å‘½åè§„èŒƒï¼šç»Ÿä¸€çš„å‘½åçº¦å®š
æ–‡æ¡£è§„èŒƒï¼šå®Œæ•´çš„æ“ä½œè¯´æ˜
ç‰ˆæœ¬ç®¡ç†ï¼šPlaybookçš„ç‰ˆæœ¬æ§åˆ¶
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¼ä¸šçº§åº”ç”¨åœºæ™¯**
- **WebæœåŠ¡é›†ç¾¤**ï¼šnginxè´Ÿè½½å‡è¡¡å’Œåº”ç”¨æœåŠ¡å™¨çš„ç»Ÿä¸€ç®¡ç†
- **æ•°æ®åº“é›†ç¾¤**ï¼šMySQLä¸»ä»å¤åˆ¶ç¯å¢ƒçš„è‡ªåŠ¨åŒ–éƒ¨ç½²
- **å¾®æœåŠ¡æ¶æ„**ï¼šå®¹å™¨åŒ–åº”ç”¨çš„æ‰¹é‡éƒ¨ç½²å’Œé…ç½®ç®¡ç†
- **CI/CDæµæ°´çº¿**ï¼šè‡ªåŠ¨åŒ–çš„åº”ç”¨å‘å¸ƒå’Œå›æ»šæµç¨‹

**ğŸ”§ è¿ç»´å®è·µå»ºè®®**
- **æ¸è¿›å¼éƒ¨ç½²**ï¼šä½¿ç”¨serialå®ç°é›¶åœæœºæ›´æ–°
- **æ ‡ç­¾ç­–ç•¥**ï¼šå»ºç«‹æ ‡å‡†åŒ–çš„æ ‡ç­¾åˆ†ç±»ä½“ç³»
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé€šçŸ¥æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†ä½¿ç”¨gather_factså’Œå˜é‡ç¼“å­˜

**ğŸ“ˆ æŠ€æœ¯å‘å±•è¶‹åŠ¿**
- **äº‘åŸç”Ÿé›†æˆ**ï¼šä¸Kubernetesç­‰å®¹å™¨ç¼–æ’å¹³å°çš„æ·±åº¦é›†æˆ
- **AIè¾…åŠ©è¿ç»´**ï¼šæ™ºèƒ½åŒ–çš„éƒ¨ç½²ç­–ç•¥å’Œå¼‚å¸¸æ£€æµ‹
- **å®‰å…¨å¢å¼º**ï¼šæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶å’Œå®‰å…¨å®¡è®¡
- **å¯è§‚æµ‹æ€§**ï¼šæ›´å®Œå–„çš„æ‰§è¡Œç›‘æ§å’Œå¯è§†åŒ–ç®¡ç†

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Playå®šä¹‰åœºæ™¯æ˜ï¼Œhostsé€‰æ‹©ç›®æ ‡å‡†
- tasksç»„ç»‡è¦åˆç†ï¼Œvarså˜é‡å±‚æ¬¡åˆ†
- nameæè¿°é¡»æ¸…æ™°ï¼Œbecomeæƒé™ç®¡æ§ä¸¥
- factsæ”¶é›†æŒ‰éœ€è¦ï¼Œserialæ§åˆ¶ä¿å®‰å…¨
- å¤±è´¥ç‡é˜ˆå€¼è®¾å®šå¥½ï¼Œtagsæ ‡ç­¾åŠ©ç®¡ç†