---
title: 3ã€ç½‘ç»œé…ç½®æ¨¡æ¿
---
## ğŸ“š ç›®å½•

1. [ç½‘ç»œé…ç½®æ¨¡æ¿åŸºç¡€æ¦‚å¿µ](#1-ç½‘ç»œé…ç½®æ¨¡æ¿åŸºç¡€æ¦‚å¿µ)
2. [é…ç½®æ¨¡æ¿è®¾è®¡åŸç†](#2-é…ç½®æ¨¡æ¿è®¾è®¡åŸç†)
3. [è®¾å¤‡å·®å¼‚å¤„ç†ç­–ç•¥](#3-è®¾å¤‡å·®å¼‚å¤„ç†ç­–ç•¥)
4. [å˜é‡å‚æ•°åŒ–å®ç°](#4-å˜é‡å‚æ•°åŒ–å®ç°)
5. [æ¨¡æ¿éªŒè¯ä¸æµ‹è¯•](#5-æ¨¡æ¿éªŒè¯ä¸æµ‹è¯•)
6. [é…ç½®æ ‡å‡†åŒ–å®è·µ](#6-é…ç½®æ ‡å‡†åŒ–å®è·µ)
7. [æ‰¹é‡é…ç½®éƒ¨ç½²](#7-æ‰¹é‡é…ç½®éƒ¨ç½²)
8. [ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š](#8-ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š)
9. [é…ç½®å®¡è®¡ä¸åˆè§„](#9-é…ç½®å®¡è®¡ä¸åˆè§„)
10. [å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ](#10-å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç½‘ç»œé…ç½®æ¨¡æ¿åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œé…ç½®æ¨¡æ¿


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
ç½‘ç»œé…ç½®æ¨¡æ¿æ˜¯ä¸€ç§**æ ‡å‡†åŒ–çš„é…ç½®æ–‡ä»¶æ¨¡æ¿**ï¼Œç”¨äº**ç»Ÿä¸€ç®¡ç†**å’Œ**æ‰¹é‡éƒ¨ç½²**ç½‘ç»œè®¾å¤‡é…ç½®ã€‚å®ƒå°†ç½‘ç»œé…ç½®ä¸­çš„**å¯å˜éƒ¨åˆ†**ç”¨å˜é‡æ›¿ä»£ï¼Œ**å›ºå®šéƒ¨åˆ†**ä¿æŒä¸å˜ï¼Œå®ç°**ä¸€å¥—æ¨¡æ¿é€‚ç”¨å¤šç§åœºæ™¯**ã€‚

**ğŸŒ° ç”Ÿæ´»ç±»æ¯”**
å°±åƒå·¥å‚é‡Œçš„**ç”Ÿäº§æ¨¡å…·**ï¼š
- æ¨¡å…·å½¢çŠ¶å›ºå®šï¼ˆé…ç½®æ¡†æ¶ï¼‰
- åŸææ–™å¯å˜æ¢ï¼ˆå˜é‡å‚æ•°ï¼‰
- æ‰¹é‡ç”Ÿäº§æ ‡å‡†ä»¶ï¼ˆç»Ÿä¸€é…ç½®ï¼‰

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®æ¨¡æ¿


**ğŸ”¸ ä¼ ç»Ÿé…ç½®é—®é¢˜**
```
âŒ æ‰‹å·¥é…ç½®é—®é¢˜ï¼š
â€¢ æ¯å°è®¾å¤‡å•ç‹¬é…ç½®ï¼Œæ•ˆç‡ä½ä¸‹
â€¢ å®¹æ˜“å‡ºç°é…ç½®ä¸ä¸€è‡´
â€¢ éš¾ä»¥æ‰¹é‡ä¿®æ”¹å’Œç»´æŠ¤
â€¢ äººä¸ºé”™è¯¯ç‡é«˜ï¼Œé…ç½®è´¨é‡ä¸ç¨³å®š

âŒ å¤åˆ¶ç²˜è´´é—®é¢˜ï¼š
â€¢ é…ç½®æ–‡ä»¶å†—ä½™ï¼Œç»´æŠ¤æˆæœ¬é«˜
â€¢ å‚æ•°ä¿®æ”¹å®¹æ˜“é—æ¼
â€¢ ç‰ˆæœ¬ç®¡ç†æ··ä¹±
```

**ğŸ”¸ æ¨¡æ¿åŒ–ä¼˜åŠ¿**
```
âœ… æ ‡å‡†åŒ–ï¼šç»Ÿä¸€çš„é…ç½®é£æ ¼å’Œè§„èŒƒ
âœ… è‡ªåŠ¨åŒ–ï¼šæ‰¹é‡éƒ¨ç½²ï¼Œå‡å°‘äººå·¥å¹²é¢„
âœ… å¯ç»´æŠ¤ï¼šé›†ä¸­ç®¡ç†ï¼Œæ˜“äºæ›´æ–°
âœ… å¯å¤ç”¨ï¼šä¸€å¥—æ¨¡æ¿é€‚ç”¨å¤šç§ç¯å¢ƒ
âœ… å¯å®¡è®¡ï¼šé…ç½®å˜æ›´æœ‰è¿¹å¯å¾ª
```

### 1.3 ç½‘ç»œé…ç½®æ¨¡æ¿çš„ç»„æˆ


**ğŸ—ï¸ åŸºæœ¬ç»“æ„**
```
ç½‘ç»œé…ç½®æ¨¡æ¿
â”œâ”€â”€ é™æ€é…ç½®å—      â† å›ºå®šä¸å˜çš„é…ç½®
â”œâ”€â”€ åŠ¨æ€å˜é‡åŒº      â† æ ¹æ®è®¾å¤‡å˜åŒ–çš„å‚æ•°  
â”œâ”€â”€ æ¡ä»¶åˆ¤æ–­å—      â† åŸºäºè®¾å¤‡ç±»å‹çš„å·®å¼‚é…ç½®
â””â”€â”€ å¾ªç¯é…ç½®å—      â† æ‰¹é‡ç”Ÿæˆé‡å¤é…ç½®
```

**ğŸ’¡ ç»„æˆè¦ç´ è¯¦è§£**

**é™æ€é…ç½®å—**ï¼šæ‰€æœ‰è®¾å¤‡å…±åŒçš„åŸºç¡€é…ç½®
- ç³»ç»ŸåŸºæœ¬è®¾ç½®
- é€šç”¨å®‰å…¨ç­–ç•¥
- æ ‡å‡†æœåŠ¡é…ç½®

**åŠ¨æ€å˜é‡åŒº**ï¼šå› è®¾å¤‡è€Œå¼‚çš„å‚æ•°
- è®¾å¤‡IPåœ°å€
- ä¸»æœºå
- æ¥å£é…ç½®

**æ¡ä»¶åˆ¤æ–­å—**ï¼šé’ˆå¯¹ä¸åŒè®¾å¤‡ç±»å‹çš„ç‰¹æ®Šé…ç½®
- äº¤æ¢æœºä¸“ç”¨é…ç½®
- è·¯ç”±å™¨ä¸“ç”¨é…ç½®
- é˜²ç«å¢™è§„åˆ™

---

## 2. ğŸ¯ é…ç½®æ¨¡æ¿è®¾è®¡åŸç†


### 2.1 æ¨¡æ¿åŒ–æ€ç»´


**ğŸ§  è®¾è®¡æ€è·¯**
å°†ç½‘ç»œé…ç½®**åˆ†è§£**ä¸ºï¼š
1. **å…±æ€§é…ç½®**ï¼šæ‰€æœ‰è®¾å¤‡éƒ½éœ€è¦çš„åŸºç¡€è®¾ç½®
2. **ä¸ªæ€§é…ç½®**ï¼šæ¯å°è®¾å¤‡ç‹¬ç‰¹çš„å‚æ•°
3. **æ¡ä»¶é…ç½®**ï¼šåŸºäºè®¾å¤‡ç±»å‹æˆ–è§’è‰²çš„å·®å¼‚åŒ–é…ç½®

**ğŸ”„ æ¨¡æ¿å·¥ä½œæµç¨‹**
```
é…ç½®éœ€æ±‚åˆ†æ â†’ æå–å…±æ€§é…ç½® â†’ è¯†åˆ«å˜é‡å‚æ•° â†’ è®¾è®¡æ¨¡æ¿ç»“æ„
      â†“              â†“              â†“              â†“
   æ˜ç¡®ç›®æ ‡       æŠ½è±¡å…¬å…±éƒ¨åˆ†    å®šä¹‰å‚æ•°å˜é‡    ç¼–å†™æ¨¡æ¿æ–‡ä»¶
      â†“              â†“              â†“              â†“
   å‚æ•°èµ‹å€¼ â†’ æ¨¡æ¿æ¸²æŸ“ â†’ ç”Ÿæˆé…ç½® â†’ éƒ¨ç½²åº”ç”¨
```

### 2.2 Jinja2 æ¨¡æ¿è¯­è¨€åŸºç¡€


**ğŸ”¸ Jinja2 æ ¸å¿ƒè¯­æ³•**

**å˜é‡è¾“å‡º**ï¼š`{{ variable_name }}`
```jinja2
hostname {{ device_name }}
ip address {{ management_ip }}
```

**æ¡ä»¶åˆ¤æ–­**ï¼š`{% if condition %} ... {% endif %}`
```jinja2
{% if device_type == 'router' %}
router ospf 1
  network 0.0.0.0 255.255.255.255 area 0
{% endif %}
```

**å¾ªç¯éå†**ï¼š`{% for item in list %} ... {% endfor %}`
```jinja2
{% for interface in interfaces %}
interface {{ interface.name }}
  ip address {{ interface.ip }} {{ interface.mask }}
{% endfor %}
```

### 2.3 æ¨¡æ¿è®¾è®¡åŸåˆ™


**ğŸ¯ è®¾è®¡æ ¸å¿ƒåŸåˆ™**

**å¯è¯»æ€§åŸåˆ™**
- æ¨¡æ¿ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šè¯¦ç»†
- å˜é‡å‘½åæœ‰æ„ä¹‰
- é€»è¾‘åˆ†å—æ˜ç¡®

**çµæ´»æ€§åŸåˆ™**
- æ”¯æŒå¤šç§è®¾å¤‡ç±»å‹
- å‚æ•°å¯é€‰å¯é…ç½®
- æ”¯æŒæ‰©å±•æ–°åŠŸèƒ½

**ç»´æŠ¤æ€§åŸåˆ™**
- æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºä¿®æ”¹
- ç‰ˆæœ¬ç®¡ç†å‹å¥½
- æµ‹è¯•éªŒè¯å®Œå–„

---

## 3. ğŸ”§ è®¾å¤‡å·®å¼‚å¤„ç†ç­–ç•¥


### 3.1 è®¾å¤‡ç±»å‹è¯†åˆ«


**ğŸ”¸ å¸¸è§ç½‘ç»œè®¾å¤‡å·®å¼‚**
```
äº¤æ¢æœº vs è·¯ç”±å™¨ vs é˜²ç«å¢™ï¼š
â€¢ æ”¯æŒçš„åŠŸèƒ½æ¨¡å—ä¸åŒ
â€¢ é…ç½®è¯­æ³•æ ¼å¼å·®å¼‚  
â€¢ å‚æ•°èŒƒå›´å’Œé™åˆ¶ä¸åŒ
â€¢ é»˜è®¤é…ç½®è¡Œä¸ºå·®å¼‚
```

**ğŸ’¡ å·®å¼‚å¤„ç†æ–¹æ³•**

**æ–¹æ³•1ï¼šè®¾å¤‡ç±»å‹å˜é‡**
```yaml
# è®¾å¤‡æ¸…å•å®šä¹‰

switches:
  hosts:
    sw01:
      device_type: "switch"
      model: "cisco_ios"
    sw02:  
      device_type: "switch"
      model: "cisco_ios"

routers:
  hosts:
    r01:
      device_type: "router" 
      model: "cisco_ios"
```

**æ–¹æ³•2ï¼šæ¨¡å‹ç‰¹å®šé…ç½®**
```jinja2
{% if model == 'cisco_ios' %}
interface GigabitEthernet0/1
  switchport mode access
{% elif model == 'juniper_junos' %}
interfaces {
    ge-0/0/1 {
        unit 0 {
            family ethernet-switching;
        }
    }
}
{% endif %}
```

### 3.2 å‚å•†å·®å¼‚å¤„ç†


**ğŸ­ ä¸åŒå‚å•†è¯­æ³•å·®å¼‚ç¤ºä¾‹**

**VLANé…ç½®å·®å¼‚**
```jinja2
{# Cisco IOS è¯­æ³• #}
{% if vendor == 'cisco' %}
vlan {{ vlan_id }}
  name {{ vlan_name }}
interface {{ interface }}
  switchport mode access
  switchport access vlan {{ vlan_id }}

{# Juniper è¯­æ³• #}  
{% elif vendor == 'juniper' %}
vlans {
    {{ vlan_name }} {
        vlan-id {{ vlan_id }};
    }
}
interfaces {
    {{ interface }} {
        unit 0 {
            family ethernet-switching {
                vlan {
                    members {{ vlan_name }};
                }
            }
        }
    }
}
{% endif %}
```

### 3.3 ç‰ˆæœ¬å…¼å®¹æ€§å¤„ç†


**ğŸ“Š ç‰ˆæœ¬å·®å¼‚ç®¡ç†**
```jinja2
{# åŸºäºç³»ç»Ÿç‰ˆæœ¬çš„åŠŸèƒ½å¼€å…³ #}
{% if system_version >= '15.0' %}
  {# æ–°ç‰ˆæœ¬ç‰¹æ€§ #}
  ip ssh version 2
  crypto key generate rsa modulus 2048
{% else %}
  {# å…¼å®¹è€ç‰ˆæœ¬ #}
  ip ssh version 1
  crypto key generate rsa modulus 1024
{% endif %}
```

---

## 4. ğŸ›ï¸ å˜é‡å‚æ•°åŒ–å®ç°


### 4.1 å˜é‡å±‚æ¬¡ç»“æ„


**ğŸ”¸ å˜é‡ä¼˜å…ˆçº§**
```
å‘½ä»¤è¡Œå˜é‡ > Playbookå˜é‡ > ä¸»æœºå˜é‡ > ç»„å˜é‡ > é»˜è®¤å˜é‡
    â†‘              â†‘            â†‘          â†‘          â†‘
  æœ€é«˜ä¼˜å…ˆçº§      é«˜ä¼˜å…ˆçº§     ä¸­ä¼˜å…ˆçº§    ä½ä¼˜å…ˆçº§   æœ€ä½ä¼˜å…ˆçº§
```

### 4.2 ç½‘ç»œå‚æ•°åˆ†ç±»


**ğŸŒ ç½‘ç»œé…ç½®å¸¸ç”¨å˜é‡**

**åŸºç¡€ç³»ç»Ÿå˜é‡**
```yaml
# è®¾å¤‡åŸºæœ¬ä¿¡æ¯

device_name: "SW-Core-01"
domain_name: "company.local"  
timezone: "Asia/Shanghai"
ntp_servers:
  - "192.168.1.10"
  - "192.168.1.11"
```

**æ¥å£é…ç½®å˜é‡**
```yaml
# æ¥å£å‚æ•°

interfaces:
  - name: "GigabitEthernet0/1"
    ip: "192.168.10.1"
    mask: "255.255.255.0"
    description: "Uplink to Core"
    status: "up"
  - name: "GigabitEthernet0/2"
    ip: "192.168.20.1" 
    mask: "255.255.255.0"
    description: "Server Network"
    status: "up"
```

**VLANé…ç½®å˜é‡**
```yaml
# VLAN å®šä¹‰

vlans:
  - id: 10
    name: "Users"
    description: "User Network"
  - id: 20
    name: "Servers"
    description: "Server Network"
  - id: 30
    name: "Management"
    description: "Management Network"
```

### 4.3 å˜é‡ç»„ç»‡æœ€ä½³å®è·µ


**ğŸ“ ç›®å½•ç»“æ„æ¨è**
```
network_configs/
â”œâ”€â”€ group_vars/
â”‚   â”œâ”€â”€ all.yml           # å…¨å±€å˜é‡
â”‚   â”œâ”€â”€ switches.yml      # äº¤æ¢æœºç»„å˜é‡
â”‚   â”œâ”€â”€ routers.yml       # è·¯ç”±å™¨ç»„å˜é‡
â”‚   â””â”€â”€ firewalls.yml     # é˜²ç«å¢™ç»„å˜é‡
â”œâ”€â”€ host_vars/
â”‚   â”œâ”€â”€ sw01.yml          # å…·ä½“è®¾å¤‡å˜é‡
â”‚   â””â”€â”€ r01.yml
â””â”€â”€ templates/
    â”œâ”€â”€ switch_base.j2    # äº¤æ¢æœºåŸºç¡€æ¨¡æ¿
    â””â”€â”€ router_base.j2    # è·¯ç”±å™¨åŸºç¡€æ¨¡æ¿
```

**ğŸ’¡ å˜é‡å‘½åè§„èŒƒ**
```yaml
# æ¨èå‘½åæ–¹å¼

âœ… æ¸…æ™°è¡¨è¾¾å«ä¹‰
management_vlan_id: 99
uplink_interface: "GigabitEthernet0/24"
snmp_community: "public_readonly"

âŒ é¿å…æ¨¡ç³Šå‘½å  
var1: 99
int: "Gi0/24"
community: "public"
```

---

## 5. ğŸ” æ¨¡æ¿éªŒè¯ä¸æµ‹è¯•


### 5.1 è¯­æ³•éªŒè¯


**ğŸ”¸ Jinja2 è¯­æ³•æ£€æŸ¥**

**éªŒè¯ Playbook**
```yaml
- name: éªŒè¯æ¨¡æ¿è¯­æ³•
  hosts: localhost
  tasks:
    - name: æ¸²æŸ“æ¨¡æ¿æ£€æŸ¥è¯­æ³•
      template:
        src: switch_config.j2
        dest: /tmp/switch_config_test.txt
      check_mode: yes
      
    - name: æ˜¾ç¤ºæ¸²æŸ“ç»“æœ
      debug:
        msg: "{{ lookup('template', 'switch_config.j2') }}"
```

### 5.2 æ¸²æŸ“ç»“æœéªŒè¯


**ğŸ§ª æ¨¡æ¿æµ‹è¯•ç­–ç•¥**

**æµ‹è¯•ç”¨ä¾‹è®¾è®¡**
```yaml
# æµ‹è¯•æ•°æ®å‡†å¤‡

test_scenarios:
  - name: "åŸºç¡€äº¤æ¢æœºé…ç½®"
    device_type: "switch"
    expected_lines:
      - "hostname TEST-SW-01"
      - "interface GigabitEthernet0/1"
      
  - name: "è·¯ç”±å™¨é…ç½®"
    device_type: "router"
    expected_lines:
      - "router ospf 1"
      - "network 0.0.0.0 255.255.255.255 area 0"
```

### 5.3 é…ç½®åˆè§„æ€§æ£€æŸ¥


**âœ… åˆè§„æ£€æŸ¥ç‚¹**
- **å®‰å…¨é…ç½®**ï¼šå¯†ç ç­–ç•¥ã€è®¿é—®æ§åˆ¶
- **æ ‡å‡†ç¬¦åˆæ€§**ï¼šå…¬å¸é…ç½®æ ‡å‡†
- **åŠŸèƒ½å®Œæ•´æ€§**ï¼šå¿…éœ€åŠŸèƒ½æ˜¯å¦å¯ç”¨
- **æœ€ä½³å®è·µ**ï¼šè¡Œä¸šæ¨èé…ç½®

---

## 6. ğŸ“ é…ç½®æ ‡å‡†åŒ–å®è·µ


### 6.1 ä¼ä¸šé…ç½®æ ‡å‡†


**ğŸ¢ æ ‡å‡†åŒ–ç›®æ ‡**
- **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰è®¾å¤‡éµå¾ªç›¸åŒæ ‡å‡†
- **å®‰å…¨æ€§**ï¼šç»Ÿä¸€çš„å®‰å…¨é…ç½®åŸºçº¿
- **å¯ç»´æŠ¤æ€§**ï¼šæ ‡å‡†åŒ–ä¾¿äºè¿ç»´ç®¡ç†
- **åˆè§„æ€§**ï¼šæ»¡è¶³è¡Œä¸šè§„èŒƒè¦æ±‚

### 6.2 é…ç½®åŸºçº¿æ¨¡æ¿


**ğŸ”¸ ç½‘ç»œè®¾å¤‡é€šç”¨åŸºçº¿**
```jinja2
{# åŸºç¡€ç³»ç»Ÿé…ç½® #}
service timestamps debug datetime msec
service timestamps log datetime msec  
service password-encryption
no ip domain-lookup

{# å…¨å±€å®‰å…¨é…ç½® #}
no ip http server
no ip http secure-server
ip ssh version 2
line console 0
  logging synchronous
  exec-timeout 5 0
line vty 0 15
  transport input ssh
  exec-timeout 10 0

{# NTPé…ç½® #}
{% for ntp_server in ntp_servers %}
ntp server {{ ntp_server }}
{% endfor %}

{# SNMPé…ç½® #}
{% if snmp_enabled %}
snmp-server community {{ snmp_ro_community }} RO
snmp-server location {{ site_location }}
snmp-server contact {{ network_admin }}
{% endif %}
```

### 6.3 è§’è‰²ç‰¹å®šé…ç½®


**ğŸ¯ åŸºäºè§’è‰²çš„å·®å¼‚åŒ–é…ç½®**

**æ ¸å¿ƒäº¤æ¢æœºé…ç½®**
```jinja2
{% if device_role == 'core_switch' %}
{# æ ¸å¿ƒäº¤æ¢æœºç‰¹å®šé…ç½® #}
spanning-tree mode rapid-pvst
spanning-tree portfast bpduguard default
spanning-tree extend system-id

{# VLANé…ç½® #}
{% for vlan in vlans %}
vlan {{ vlan.id }}
  name {{ vlan.name }}
{% endfor %}

{# æ¥å£é…ç½® #}
{% for interface in uplink_interfaces %}
interface {{ interface.name }}
  description {{ interface.description }}
  switchport trunk encapsulation dot1q
  switchport mode trunk
  channel-group {{ interface.channel_group }} mode active
{% endfor %}
{% endif %}
```

---

## 7. ğŸš€ æ‰¹é‡é…ç½®éƒ¨ç½²


### 7.1 æ‰¹é‡éƒ¨ç½²ç­–ç•¥


**ğŸ¯ éƒ¨ç½²æ–¹æ³•å¯¹æ¯”**

| éƒ¨ç½²æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é£é™©ç­‰çº§** |
|---------|------------|---------|----------|-------------|
| **ä¸²è¡Œéƒ¨ç½²** | `å°è§„æ¨¡ç¯å¢ƒ` | `é£é™©å¯æ§ï¼Œæ˜“äºæ’é”™` | `è€—æ—¶è¾ƒé•¿` | `ğŸŸ¢ ä½` |
| **å¹¶è¡Œéƒ¨ç½²** | `å¤§è§„æ¨¡ç¯å¢ƒ` | `æ•ˆç‡é«˜ï¼Œå¿«é€Ÿå®Œæˆ` | `é£é™©è¾ƒå¤§ï¼Œéš¾ä»¥åŠæ—¶å‘ç°é—®é¢˜` | `ğŸŸ¡ ä¸­` |
| **åˆ†æ‰¹éƒ¨ç½²** | `ç”Ÿäº§ç¯å¢ƒ` | `å¹³è¡¡æ•ˆç‡å’Œé£é™©` | `éœ€è¦è§„åˆ’éƒ¨ç½²æ‰¹æ¬¡` | `ğŸŸ¢ ä½` |

### 7.2 éƒ¨ç½²å‰æ£€æŸ¥


**ğŸ” éƒ¨ç½²å‰ç½®æ¡ä»¶éªŒè¯**
```yaml
- name: éƒ¨ç½²å‰ç¯å¢ƒæ£€æŸ¥
  hosts: network_devices
  gather_facts: no
  tasks:
    - name: è®¾å¤‡è¿é€šæ€§æµ‹è¯•
      ping:
        
    - name: éªŒè¯è®¾å¤‡å¯è¾¾æ€§
      ios_facts:
      
    - name: æ£€æŸ¥å½“å‰é…ç½®å¤‡ä»½
      ios_config:
        backup: yes
        backup_options:
          filename: "{{ inventory_hostname }}_{{ ansible_date_time.date }}.cfg"
          dir_path: "./backups/"
```

### 7.3 æ»šåŠ¨æ›´æ–°å®ç°


**ğŸ”„ é›¶ä¸­æ–­éƒ¨ç½²ç­–ç•¥**
```yaml
- name: ç½‘ç»œé…ç½®æ»šåŠ¨æ›´æ–°
  hosts: network_devices
  serial: 2  # æ¯æ‰¹å¤„ç†2å°è®¾å¤‡
  max_fail_percentage: 10  # å¤±è´¥ç‡è¶…è¿‡10%åˆ™åœæ­¢
  
  tasks:
    - name: ç”Ÿæˆé…ç½®æ–‡ä»¶
      template:
        src: "{{ device_type }}_config.j2"
        dest: "/tmp/{{ inventory_hostname }}_config.txt"
      delegate_to: localhost
      
    - name: åº”ç”¨é…ç½®
      ios_config:
        src: "/tmp/{{ inventory_hostname }}_config.txt"
        backup: yes
        
    - name: éªŒè¯é…ç½®æ­£ç¡®æ€§
      ios_command:
        commands:
          - show version
          - show ip interface brief
      register: verify_result
      
    - name: æ£€æŸ¥è®¾å¤‡çŠ¶æ€  
      assert:
        that:
          - "'up' in verify_result.stdout[1]"
        fail_msg: "è®¾å¤‡é…ç½®åæ¥å£çŠ¶æ€å¼‚å¸¸"
```

---

## 8. ğŸ“š ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š


### 8.1 é…ç½®ç‰ˆæœ¬ç®¡ç†


**ğŸ”¸ Git ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ**

**åˆ†æ”¯ç®¡ç†ç­–ç•¥**
```
master/main     â† ç”Ÿäº§ç¯å¢ƒé…ç½®
  â”œâ”€â”€ develop   â† å¼€å‘æµ‹è¯•é…ç½®  
  â”œâ”€â”€ feature/* â† åŠŸèƒ½å¼€å‘åˆ†æ”¯
  â””â”€â”€ hotfix/*  â† ç´§æ€¥ä¿®å¤åˆ†æ”¯
```

**æäº¤ä¿¡æ¯è§„èŒƒ**
```bash
# æ¨èçš„æäº¤æ ¼å¼

git commit -m "feat(switch): æ–°å¢VLAN 100é…ç½®æ¨¡æ¿"
git commit -m "fix(router): ä¿®å¤OSPFåŒºåŸŸé…ç½®é”™è¯¯" 
git commit -m "docs(template): æ›´æ–°é…ç½®æ¨¡æ¿ä½¿ç”¨è¯´æ˜"
```

### 8.2 é…ç½®å¤‡ä»½ç­–ç•¥


**ğŸ’¾ è‡ªåŠ¨å¤‡ä»½æœºåˆ¶**
```yaml
- name: å®šæœŸé…ç½®å¤‡ä»½
  hosts: network_devices  
  tasks:
    - name: åˆ›å»ºå¤‡ä»½ç›®å½•
      file:
        path: "./backups/{{ ansible_date_time.date }}"
        state: directory
      delegate_to: localhost
      
    - name: å¤‡ä»½å½“å‰é…ç½®
      ios_config:
        backup: yes  
        backup_options:
          filename: "{{ inventory_hostname }}_{{ ansible_date_time.iso8601 }}.cfg"
          dir_path: "./backups/{{ ansible_date_time.date }}/"
          
    - name: é…ç½®å·®å¼‚æ¯”è¾ƒ
      ios_config:
        diff_against: intended
        intended_config: "{{ lookup('file', 'templates/current_config.j2') }}"
      register: config_diff
      
    - name: è®°å½•é…ç½®å˜æ›´
      copy:
        content: "{{ config_diff.diff }}"
        dest: "./backups/{{ ansible_date_time.date }}/{{ inventory_hostname }}_diff.txt"
      when: config_diff.diff is defined
```

### 8.3 å¿«é€Ÿå›æ»šæœºåˆ¶


**ğŸ”™ ç´§æ€¥å›æ»šæµç¨‹**

**ä¸€é”®å›æ»š Playbook**
```yaml
- name: ç´§æ€¥é…ç½®å›æ»š
  hosts: "{{ target_hosts | default('all') }}"
  vars:
    rollback_timestamp: "{{ rollback_time | mandatory }}"
    
  tasks:
    - name: æŸ¥æ‰¾å›æ»šé…ç½®æ–‡ä»¶
      find:
        paths: "./backups/"
        patterns: "{{ inventory_hostname }}_{{ rollback_timestamp }}*.cfg"
      delegate_to: localhost
      register: backup_files
      
    - name: éªŒè¯å¤‡ä»½æ–‡ä»¶å­˜åœ¨
      fail:
        msg: "æœªæ‰¾åˆ°æŒ‡å®šæ—¶é—´ç‚¹çš„é…ç½®å¤‡ä»½"
      when: backup_files.files | length == 0
      
    - name: æ‰§è¡Œé…ç½®å›æ»š
      ios_config:
        src: "{{ backup_files.files[0].path }}"
        replace: config
        
    - name: éªŒè¯å›æ»šç»“æœ
      ios_command:
        commands:
          - show running-config | include hostname
      register: rollback_verify
```

**ğŸš¨ å›æ»šéªŒè¯æ¸…å•**
- [ ] è®¾å¤‡å¯è¾¾æ€§æ­£å¸¸
- [ ] å…³é”®æ¥å£çŠ¶æ€æ­£å¸¸  
- [ ] è·¯ç”±è¡¨ä¿¡æ¯æ­£ç¡®
- [ ] æœåŠ¡åŠŸèƒ½å¯ç”¨
- [ ] ç›‘æ§å‘Šè­¦æ¸…é™¤

---

## 9. ğŸ”’ é…ç½®å®¡è®¡ä¸åˆè§„


### 9.1 é…ç½®å®¡è®¡æ¡†æ¶


**ğŸ” å®¡è®¡æ£€æŸ¥ç»´åº¦**
```
å®‰å…¨åˆè§„æ€§ï¼šå¯†ç ç­–ç•¥ã€è®¿é—®æ§åˆ¶ã€åŠ å¯†é…ç½®
åŠŸèƒ½å®Œæ•´æ€§ï¼šå¿…éœ€æœåŠ¡ã€åè®®é…ç½®ã€ç‰¹æ€§å¯ç”¨  
æ ‡å‡†ç¬¦åˆæ€§ï¼šå‘½åè§„èŒƒã€é…ç½®æ ¼å¼ã€ç‰ˆæœ¬è¦æ±‚
å˜æ›´å¯è¿½æº¯ï¼šé…ç½®å†å²ã€å˜æ›´è®°å½•ã€å®¡æ‰¹æµç¨‹
```

### 9.2 è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥


**âœ… åˆè§„æ£€æŸ¥æ¨¡æ¿**
```yaml
- name: ç½‘ç»œè®¾å¤‡åˆè§„æ€§æ£€æŸ¥
  hosts: network_devices
  tasks:
    - name: æ”¶é›†è®¾å¤‡é…ç½®ä¿¡æ¯
      ios_facts:
        gather_subset: config
      register: device_facts
      
    - name: æ£€æŸ¥å®‰å…¨é…ç½®åˆè§„
      assert:
        that:
          - "'service password-encryption' in device_facts.ansible_net_config"
          - "'no ip http server' in device_facts.ansible_net_config" 
          - "'ip ssh version 2' in device_facts.ansible_net_config"
        fail_msg: "è®¾å¤‡å®‰å…¨é…ç½®ä¸ç¬¦åˆåˆè§„è¦æ±‚"
        success_msg: "è®¾å¤‡å®‰å…¨é…ç½®ç¬¦åˆè¦æ±‚"
      tags: security_check
      
    - name: æ£€æŸ¥NTPé…ç½®
      assert:
        that:
          - device_facts.ansible_net_config | regex_search('ntp server')
        fail_msg: "è®¾å¤‡æœªé…ç½®NTPæœåŠ¡å™¨"
      tags: ntp_check
```

### 9.3 åˆè§„æŠ¥å‘Šç”Ÿæˆ


**ğŸ“Š å®¡è®¡æŠ¥å‘Šæ¨¡æ¿**
```jinja2
# ç½‘ç»œè®¾å¤‡åˆè§„æ€§å®¡è®¡æŠ¥å‘Š


## å®¡è®¡æ¦‚è§ˆ

- å®¡è®¡æ—¶é—´ï¼š{{ ansible_date_time.iso8601 }}
- å®¡è®¡èŒƒå›´ï¼š{{ groups['network_devices'] | length }} å°ç½‘ç»œè®¾å¤‡
- åˆè§„é€šè¿‡ï¼š{{ compliant_devices | length }} å°
- ä¸åˆè§„è®¾å¤‡ï¼š{{ non_compliant_devices | length }} å°

## è¯¦ç»†å®¡è®¡ç»“æœ


{% for device in audit_results %}
### {{ device.hostname }}

- **è®¾å¤‡ç±»å‹**ï¼š{{ device.device_type }}
- **åˆè§„çŠ¶æ€**ï¼š{% if device.compliant %}âœ… é€šè¿‡{% else %}âŒ ä¸é€šè¿‡{% endif %}
- **æ£€æŸ¥é¡¹ç›®**ï¼š
{% for check in device.checks %}
  - {{ check.name }}ï¼š{% if check.passed %}âœ… é€šè¿‡{% else %}âŒ å¤±è´¥ - {{ check.error }}{% endif %}
{% endfor %}

{% if not device.compliant %}
**æ•´æ”¹å»ºè®®**ï¼š
{% for suggestion in device.suggestions %}
- {{ suggestion }}
{% endfor %}
{% endif %}
{% endfor %}
```

---

## 10. ğŸ’¼ å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ


### 10.1 ä¼ä¸šç½‘ç»œæ ‡å‡†åŒ–æ¡ˆä¾‹


**ğŸ¢ åœºæ™¯æè¿°**
æŸå…¬å¸éœ€è¦æ ‡å‡†åŒ–ç®¡ç†100å°äº¤æ¢æœºå’Œ20å°è·¯ç”±å™¨ï¼Œè¦æ±‚ï¼š
- ç»Ÿä¸€å®‰å…¨é…ç½®åŸºçº¿
- æ”¯æŒä¸åŒå‚å•†è®¾å¤‡ï¼ˆCiscoã€åä¸ºï¼‰  
- å®ç°æ‰¹é‡é…ç½®éƒ¨ç½²
- å»ºç«‹é…ç½®å®¡è®¡æœºåˆ¶

**ğŸ¯ è§£å†³æ–¹æ¡ˆæ¶æ„**
```
é…ç½®ç®¡ç†ä¸­å¿ƒ
â”œâ”€â”€ æ¨¡æ¿åº“
â”‚   â”œâ”€â”€ cisco_switch.j2
â”‚   â”œâ”€â”€ cisco_router.j2  
â”‚   â”œâ”€â”€ huawei_switch.j2
â”‚   â””â”€â”€ huawei_router.j2
â”œâ”€â”€ å˜é‡ç®¡ç†
â”‚   â”œâ”€â”€ å…¨å±€åŸºçº¿å˜é‡
â”‚   â”œâ”€â”€ è®¾å¤‡ç»„å˜é‡
â”‚   â””â”€â”€ ä¸»æœºç‰¹å®šå˜é‡
â”œâ”€â”€ éƒ¨ç½²å¼•æ“
â”‚   â”œâ”€â”€ æ‰¹é‡éƒ¨ç½²
â”‚   â”œâ”€â”€ æ»šåŠ¨æ›´æ–°
â”‚   â””â”€â”€ å›æ»šæœºåˆ¶
â””â”€â”€ å®¡è®¡ç³»ç»Ÿ
    â”œâ”€â”€ åˆè§„æ£€æŸ¥  
    â”œâ”€â”€ é…ç½®å¯¹æ¯”
    â””â”€â”€ æŠ¥å‘Šç”Ÿæˆ
```

### 10.2 å¤šäº‘ç½‘ç»œç»Ÿä¸€ç®¡ç†


**â˜ï¸ æ··åˆäº‘ç½‘ç»œé…ç½®**
```yaml
# å¤šäº‘ç¯å¢ƒè®¾å¤‡åˆ†ç»„

all:
  children:
    aws_devices:
      hosts:
        aws_switch01:
          cloud_provider: "aws"
          region: "us-west-2" 
          device_type: "virtual_switch"
    azure_devices:  
      hosts:
        azure_fw01:
          cloud_provider: "azure"
          region: "east-us"
          device_type: "virtual_firewall"
    onprem_devices:
      hosts:
        dc_switch01:
          cloud_provider: "onprem" 
          site: "beijing_dc"
          device_type: "physical_switch"
```

### 10.3 CI/CD é›†æˆå®è·µ


**ğŸ”„ é…ç½®å˜æ›´æµæ°´çº¿**
```yaml
# GitLab CI é…ç½®ç¤ºä¾‹

stages:
  - validate
  - test
  - deploy
  
validate_templates:
  stage: validate
  script:
    - ansible-playbook --syntax-check site.yml
    - ansible-lint playbooks/
    
test_configuration:
  stage: test  
  script:
    - ansible-playbook -i inventory/test site.yml --check
    - python scripts/validate_config.py
    
deploy_production:
  stage: deploy
  script:
    - ansible-playbook -i inventory/prod site.yml
  when: manual
  only:
    - master
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å…³é”®æ¦‚å¿µå›é¡¾


**ğŸ”¸ æ ¸å¿ƒç†è§£è¦ç‚¹**
- **é…ç½®æ¨¡æ¿åŒ–**ï¼šå°†ç½‘ç»œé…ç½®æŠ½è±¡ä¸ºå¯é‡ç”¨çš„æ¨¡æ¿
- **å‚æ•°åŒ–ç®¡ç†**ï¼šé€šè¿‡å˜é‡å®ç°é…ç½®çš„çµæ´»æ€§
- **å·®å¼‚åŒ–å¤„ç†**ï¼šåŸºäºè®¾å¤‡ç±»å‹ã€å‚å•†çš„ä¸ªæ€§åŒ–é…ç½®
- **æ ‡å‡†åŒ–å®æ–½**ï¼šå»ºç«‹ç»Ÿä¸€çš„é…ç½®åŸºçº¿å’Œè§„èŒƒ  
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šæ‰¹é‡åº”ç”¨é…ç½®ï¼Œæå‡è¿ç»´æ•ˆç‡
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®å˜æ›´å¯è¿½æº¯ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š
- **åˆè§„å®¡è®¡**ï¼šç¡®ä¿é…ç½®ç¬¦åˆå®‰å…¨å’Œæ ‡å‡†è¦æ±‚

### 11.2 æœ€ä½³å®è·µæ¸…å•


**âœ… æ¨¡æ¿è®¾è®¡**
- [ ] æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œå¤ç”¨
- [ ] å……åˆ†çš„æ³¨é‡Šå’Œæ–‡æ¡£è¯´æ˜
- [ ] æ”¯æŒå¤šå‚å•†ã€å¤šè®¾å¤‡ç±»å‹
- [ ] å˜é‡å‘½åè§„èŒƒã€å«ä¹‰æ¸…æ™°

**âœ… å˜é‡ç®¡ç†**  
- [ ] å»ºç«‹æ¸…æ™°çš„å˜é‡å±‚æ¬¡ç»“æ„
- [ ] åˆç†ä½¿ç”¨é»˜è®¤å€¼ï¼Œæé«˜å®¹é”™æ€§
- [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- [ ] å˜é‡éªŒè¯å’Œç±»å‹æ£€æŸ¥

**âœ… éƒ¨ç½²æµç¨‹**
- [ ] éƒ¨ç½²å‰å……åˆ†æµ‹è¯•éªŒè¯
- [ ] åˆ†æ‰¹éƒ¨ç½²ï¼Œæ§åˆ¶é£é™©èŒƒå›´
- [ ] å®æ—¶ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- [ ] å‡†å¤‡å›æ»šé¢„æ¡ˆ

**âœ… è´¨é‡ä¿éšœ**
- [ ] å»ºç«‹é…ç½®å®¡è®¡æœºåˆ¶
- [ ] å®šæœŸåˆè§„æ€§æ£€æŸ¥
- [ ] é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹
- [ ] æŒç»­æ”¹è¿›å’Œä¼˜åŒ–

### 11.3 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ—ºï¸ æ·±å…¥å­¦ä¹ å»ºè®®**

**åŸºç¡€æŒæ¡** (ğŸ”°)
- Jinja2 æ¨¡æ¿è¯­æ³•ç²¾é€š
- Ansible ç½‘ç»œæ¨¡å—ä½¿ç”¨
- åŸºæœ¬çš„é…ç½®æ¨¡æ¿ç¼–å†™

**è¿›é˜¶æå‡** (ğŸ”¸)  
- å¤æ‚ä¸šåŠ¡åœºæ™¯æ¨¡æ¿è®¾è®¡
- CI/CD é›†æˆé…ç½®ç®¡ç†
- å¤šå‚å•†è®¾å¤‡ç»Ÿä¸€ç®¡ç†

**é«˜çº§åº”ç”¨** (â­)
- ç½‘ç»œè‡ªåŠ¨åŒ–æ¶æ„è®¾è®¡
- å¤§è§„æ¨¡ç½‘ç»œé…ç½®ç®¡ç†
- æ™ºèƒ½åŒ–é…ç½®ä¼˜åŒ–

**ä¸“å®¶çº§åˆ«** (ğŸ†)
- ç½‘ç»œé…ç½®ç®¡ç†å¹³å°å¼€å‘
- è¡Œä¸šè§£å†³æ–¹æ¡ˆè®¾è®¡
- é…ç½®ç®¡ç†æ ‡å‡†åˆ¶å®š

### 11.4 å¸¸è§é—®é¢˜è§£ç­”


**ğŸ¤” Q: å¦‚ä½•å¤„ç†ä¸åŒå‚å•†è®¾å¤‡çš„é…ç½®å·®å¼‚ï¼Ÿ**
A: ä½¿ç”¨æ¡ä»¶åˆ¤æ–­å’Œè®¾å¤‡ç±»å‹å˜é‡ï¼Œä¸ºä¸åŒå‚å•†åˆ›å»ºä¸“ç”¨çš„é…ç½®å—ï¼Œä¿æŒæ¨¡æ¿çš„é€šç”¨æ€§ã€‚

**ğŸ¤” Q: æ¨¡æ¿è¿‡äºå¤æ‚æ—¶å¦‚ä½•ç®¡ç†ï¼Ÿ**  
A: é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†å¤§æ¨¡æ¿æ‹†åˆ†ä¸ºå¤šä¸ªå°æ¨¡æ¿ï¼Œä½¿ç”¨ `include` æˆ– `import` åŠŸèƒ½ç»„åˆä½¿ç”¨ã€‚

**ğŸ¤” Q: å¦‚ä½•ç¡®ä¿é…ç½®éƒ¨ç½²çš„å®‰å…¨æ€§ï¼Ÿ**
A: å»ºç«‹å®Œå–„çš„æµ‹è¯•ç¯å¢ƒã€åˆ†æ‰¹éƒ¨ç½²ç­–ç•¥ã€å®æ—¶ç›‘æ§å’Œå¿«é€Ÿå›æ»šæœºåˆ¶ã€‚

**ğŸ¤” Q: æ¨¡æ¿å˜é‡è¿‡å¤šæ—¶å¦‚ä½•ç®¡ç†ï¼Ÿ**
A: å»ºç«‹å˜é‡åˆ†ç±»ä½“ç³»ï¼Œä½¿ç”¨ `group_vars` å’Œ `host_vars` åˆ†å±‚ç®¡ç†ï¼Œåˆ›å»ºå˜é‡æ–‡æ¡£ã€‚

---

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- æ¨¡æ¿åŒ–æ˜¯ç½‘ç»œè‡ªåŠ¨åŒ–çš„åŸºç¡€ï¼ŒæŠ½è±¡å…±æ€§ã€å‚æ•°åŒ–ä¸ªæ€§
- å·®å¼‚åŒ–å¤„ç†éœ€è¦æ·±å…¥ç†è§£è®¾å¤‡ç‰¹æ€§å’Œé…ç½®è¯­æ³•
- æ ‡å‡†åŒ–é…ç½®æ˜¯è¿ç»´è´¨é‡çš„ä¿éšœï¼Œåˆè§„å®¡è®¡æ˜¯é£é™©æ§åˆ¶çš„æ‰‹æ®µ
- ç‰ˆæœ¬ç®¡ç†å’Œå›æ»šæœºåˆ¶æ˜¯ç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨ä¿éšœ
- å®è·µä¸­è¦å¹³è¡¡æ ‡å‡†åŒ–å’Œçµæ´»æ€§ï¼Œæ•ˆç‡å’Œå®‰å…¨æ€§