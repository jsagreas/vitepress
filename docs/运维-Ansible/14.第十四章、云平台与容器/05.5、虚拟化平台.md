---
title: 5ã€è™šæ‹ŸåŒ–å¹³å°
---
## ğŸ“š ç›®å½•

1. [è™šæ‹ŸåŒ–å¹³å°ç®¡ç†æ¦‚è¿°](#1-è™šæ‹ŸåŒ–å¹³å°ç®¡ç†æ¦‚è¿°)
2. [VMware vSphereåŸºç¡€æ¦‚å¿µ](#2-VMware-vSphereåŸºç¡€æ¦‚å¿µ)
3. [Ansibleä¸vSphereè¿æ¥é…ç½®](#3-Ansibleä¸vSphereè¿æ¥é…ç½®)
4. [è™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸç®¡ç†](#4-è™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸç®¡ç†)
5. [æ¨¡æ¿å…‹éš†ä¸æ‰¹é‡éƒ¨ç½²](#5-æ¨¡æ¿å…‹éš†ä¸æ‰¹é‡éƒ¨ç½²)
6. [å¿«ç…§ç®¡ç†ä¸æ•°æ®ä¿æŠ¤](#6-å¿«ç…§ç®¡ç†ä¸æ•°æ®ä¿æŠ¤)
7. [èµ„æºç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–](#7-èµ„æºç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–)
8. [ç½‘ç»œä¸å­˜å‚¨é…ç½®](#8-ç½‘ç»œä¸å­˜å‚¨é…ç½®)
9. [ç›‘æ§ä¸è¿ç»´è‡ªåŠ¨åŒ–](#9-ç›‘æ§ä¸è¿ç»´è‡ªåŠ¨åŒ–)
10. [æœ€ä½³å®è·µä¸æ•…éšœæ’é™¤](#10-æœ€ä½³å®è·µä¸æ•…éšœæ’é™¤)

---

## 1. ğŸŒ è™šæ‹ŸåŒ–å¹³å°ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è™šæ‹ŸåŒ–å¹³å°ç®¡ç†


**è™šæ‹ŸåŒ–å¹³å°**å°±åƒæ˜¯ä¸€ä¸ª"æ•°å­—åŒ–çš„æœºæˆ¿ç®¡ç†å‘˜"ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¼ ç»Ÿæœºæˆ¿é‡Œä½ éœ€è¦æ‰‹å·¥å®‰è£…æœåŠ¡å™¨ã€é…ç½®ç½‘ç»œã€ç®¡ç†å­˜å‚¨ï¼Œè€Œè™šæ‹ŸåŒ–å¹³å°æŠŠè¿™äº›ç‰©ç†è®¾å¤‡æŠ½è±¡æˆè½¯ä»¶èµ„æºï¼Œè®©ä½ å¯ä»¥åƒæ­ç§¯æœ¨ä¸€æ ·å¿«é€Ÿåˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿæœºã€‚

```
ä¼ ç»Ÿç‰©ç†ç¯å¢ƒï¼š                    è™šæ‹ŸåŒ–ç¯å¢ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰©ç†æœåŠ¡å™¨1  â”‚                 â”‚    ESXiä¸»æœº1        â”‚
â”‚ - 8æ ¸CPU    â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚ - 32GBå†…å­˜  â”‚      â†’         â”‚ â”‚VM1  â”‚ â”‚VM2  â”‚    â”‚
â”‚ - 1TBç£ç›˜   â”‚                 â”‚ â”‚2æ ¸  â”‚ â”‚4æ ¸  â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚8GB  â”‚ â”‚16GB â”‚    â”‚
                                â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ansibleåœ¨è™šæ‹ŸåŒ–ä¸­çš„ä½œç”¨**ï¼š
- ğŸ¯ **ç»Ÿä¸€ç®¡ç†**ï¼šä¸€å¥—ä»£ç ç®¡ç†å¤šä¸ªè™šæ‹ŸåŒ–å¹³å°
- âš¡ **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šå‡ åˆ†é’Ÿå†…åˆ›å»ºæ•°åå°è™šæ‹Ÿæœº
- ğŸ”„ **æ ‡å‡†åŒ–æµç¨‹**ï¼šç¡®ä¿æ¯å°è™šæ‹Ÿæœºé…ç½®ä¸€è‡´
- ğŸ“Š **æ‰¹é‡è¿ç»´**ï¼šåŒæ—¶ç®¡ç†æˆç™¾ä¸Šåƒå°è™šæ‹Ÿæœº

### 1.2 æ”¯æŒçš„è™šæ‹ŸåŒ–å¹³å°


**ä¸»æµè™šæ‹ŸåŒ–å¹³å°å¯¹æ¯”**ï¼š

| å¹³å° | **å‚å•†** | **é€‚ç”¨åœºæ™¯** | **Ansibleæ”¯æŒåº¦** | **æˆæœ¬** |
|------|---------|-------------|------------------|---------|
| ğŸ”· **VMware vSphere** | `VMware` | `ä¼ä¸šçº§æ•°æ®ä¸­å¿ƒ` | `â˜…â˜…â˜…â˜…â˜… å®Œå–„` | `å•†ä¸šè®¸å¯` |
| ğŸ”¶ **Red Hat oVirt** | `Red Hat` | `å¼€æºä¼ä¸šç¯å¢ƒ` | `â˜…â˜…â˜…â˜…â˜† è‰¯å¥½` | `å¼€æºå…è´¹` |
| ğŸ”µ **Microsoft Hyper-V** | `Microsoft` | `Windowsç¯å¢ƒ` | `â˜…â˜…â˜…â˜†â˜† åŸºç¡€` | `Windowsè®¸å¯` |
| ğŸŸ¢ **Proxmox VE** | `Proxmox` | `ä¸­å°ä¼ä¸š` | `â˜…â˜…â˜…â˜†â˜† ç¤¾åŒº` | `å¼€æºå…è´¹` |

> ğŸ’¡ **é€‰æ‹©å»ºè®®**ï¼šVMware vSphereæ˜¯ä¼ä¸šçº§é¦–é€‰ï¼ŒAnsibleå¯¹å…¶æ”¯æŒæœ€å®Œå–„ï¼Œæœ¬ç« é‡ç‚¹è®²è§£vSphereç®¡ç†ã€‚

---

## 2. ğŸ—ï¸ VMware vSphereåŸºç¡€æ¦‚å¿µ


### 2.1 vSphereæ¶æ„ç»„æˆ


**vSphereå°±åƒä¸€åº§æ™ºèƒ½åŒ–çš„å¤§æ¥¼**ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰ç‰¹å®šçš„èŒè´£ï¼š

```
vSphereæ¶æ„å›¾ï¼š
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   vCenter Server â”‚ â† ç®¡ç†ä¸­å¿ƒï¼ˆç‰©ä¸šç®¡ç†å¤„ï¼‰
                    â”‚   (ç®¡ç†æ§åˆ¶å°)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ESXiä¸»æœº1â”‚          â”‚ESXiä¸»æœº2â”‚          â”‚ESXiä¸»æœº3â”‚ â† è™šæ‹ŸåŒ–ä¸»æœºï¼ˆæ¥¼å±‚ï¼‰
   â”‚â”Œâ”€â”€â”€â”â”Œâ”€â”€â”â”‚          â”‚â”Œâ”€â”€â”€â”â”Œâ”€â”€â”â”‚          â”‚â”Œâ”€â”€â”€â”â”Œâ”€â”€â”â”‚
   â”‚â”‚VM1â”‚â”‚VM2â”‚â”‚          â”‚â”‚VM3â”‚â”‚VM4â”‚â”‚          â”‚â”‚VM5â”‚â”‚VM6â”‚â”‚ â† è™šæ‹Ÿæœºï¼ˆæˆ¿é—´ï¼‰
   â”‚â””â”€â”€â”€â”˜â””â”€â”€â”˜â”‚          â”‚â””â”€â”€â”€â”˜â””â”€â”€â”˜â”‚          â”‚â””â”€â”€â”€â”˜â””â”€â”€â”˜â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶è¯¦è§£**ï¼š

**ğŸ¢ vCenter Serverï¼ˆç®¡ç†ä¸­å¿ƒï¼‰**ï¼š
- **ä½œç”¨**ï¼šæ•´ä¸ªvSphereç¯å¢ƒçš„"å¤§è„‘"
- **åŠŸèƒ½**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰ESXiä¸»æœºå’Œè™šæ‹Ÿæœº
- **æ¯”å–»**ï¼šå°±åƒå¤§æ¥¼çš„ç‰©ä¸šç®¡ç†å¤„ï¼Œè´Ÿè´£åè°ƒå„æ¥¼å±‚èµ„æº

**ğŸ  ESXiä¸»æœºï¼ˆè™šæ‹ŸåŒ–ä¸»æœºï¼‰**ï¼š
- **ä½œç”¨**ï¼šè¿è¡Œè™šæ‹Ÿæœºçš„ç‰©ç†æœåŠ¡å™¨
- **åŠŸèƒ½**ï¼šæä¾›è®¡ç®—ã€å†…å­˜ã€å­˜å‚¨ã€ç½‘ç»œèµ„æº
- **æ¯”å–»**ï¼šå°±åƒå¤§æ¥¼çš„æ¥¼å±‚ï¼Œæ¯å±‚å¯ä»¥åˆ†å‰²æˆå¤šä¸ªæˆ¿é—´

**ğŸšª è™šæ‹Ÿæœºï¼ˆVMï¼‰**ï¼š
- **ä½œç”¨**ï¼šè¿è¡Œåº”ç”¨ç¨‹åºçš„è™šæ‹ŸæœåŠ¡å™¨
- **åŠŸèƒ½**ï¼šæ¨¡æ‹Ÿå®Œæ•´çš„æœåŠ¡å™¨ç¯å¢ƒ
- **æ¯”å–»**ï¼šå°±åƒæ¥¼å±‚ä¸­çš„æˆ¿é—´ï¼Œæ¯é—´æˆ¿å¯ä»¥ä½ä¸åŒçš„"ç§Ÿæˆ·"

### 2.2 èµ„æºæ± ä¸é›†ç¾¤æ¦‚å¿µ


**èµ„æºæ± **å°±åƒæ˜¯ä¸€ä¸ª"èµ„æºé“¶è¡Œ"ï¼ŒæŠŠå¤šå°ç‰©ç†ä¸»æœºçš„èµ„æºæ±‡é›†èµ·æ¥ç»Ÿä¸€åˆ†é…ï¼š

```
é›†ç¾¤èµ„æºç®¡ç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           vSphereé›†ç¾¤               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ESXiä¸»æœº1â”‚  â”‚ESXiä¸»æœº2â”‚  â”‚ESXiä¸»æœº3 â”‚ â”‚
â”‚  â”‚CPU:16æ ¸ â”‚  â”‚CPU:16æ ¸ â”‚  â”‚CPU:16æ ¸  â”‚ â”‚
â”‚  â”‚å†…å­˜:64GBâ”‚  â”‚å†…å­˜:64GBâ”‚  â”‚å†…å­˜:64GB â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚  æ€»èµ„æºæ± ï¼šCPU 48æ ¸ï¼Œå†…å­˜ 192GB          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      èµ„æºåˆ†é…ç­–ç•¥          â”‚
        â”‚  â— é«˜å¯ç”¨æ€§(HA)           â”‚
        â”‚  â— åˆ†å¸ƒå¼èµ„æºè°ƒåº¦(DRS)    â”‚
        â”‚  â— æ•…éšœå®¹é”™(FT)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹æ€§**ï¼š
- ğŸ”„ **DRSï¼ˆåˆ†å¸ƒå¼èµ„æºè°ƒåº¦ï¼‰**ï¼šè‡ªåŠ¨å¹³è¡¡å„ä¸»æœºè´Ÿè½½
- ğŸ›¡ï¸ **HAï¼ˆé«˜å¯ç”¨æ€§ï¼‰**ï¼šä¸»æœºæ•…éšœæ—¶è‡ªåŠ¨é‡å¯è™šæ‹Ÿæœº
- ğŸ”§ **vMotion**ï¼šè™šæ‹Ÿæœºåœ¨ä¸»æœºé—´æ— åœæœºè¿ç§»

---

## 3. ğŸ”Œ Ansibleä¸vSphereè¿æ¥é…ç½®


### 3.1 ç¯å¢ƒå‡†å¤‡ä¸ä¾èµ–å®‰è£…


**å°±åƒè¿æ¥WiFiéœ€è¦å¯†ç ä¸€æ ·**ï¼ŒAnsibleè¦ç®¡ç†vSphereä¹Ÿéœ€è¦æ­£ç¡®çš„"é’¥åŒ™"å’Œ"é©±åŠ¨ç¨‹åº"ï¼š

```yaml
# å®‰è£…å¿…è¦çš„Pythonæ¨¡å—
- name: å®‰è£…vSphereç®¡ç†ä¾èµ–
  pip:
    name:
      - pyvmomi      # VMwareçš„Python SDK
      - requests     # HTTPè¯·æ±‚åº“
      - urllib3      # URLå¤„ç†åº“
    state: present
```

**ä¾èµ–è¯´æ˜**ï¼š
- `pyvmomi`ï¼šè¿™æ˜¯VMwareå®˜æ–¹çš„Python SDKï¼Œå°±åƒæ˜¯Ansibleä¸vSphereä¹‹é—´çš„"ç¿»è¯‘å®˜"
- `requests`ï¼šå¤„ç†HTTPé€šä¿¡ï¼Œç¡®ä¿è¿æ¥ç¨³å®š
- `urllib3`ï¼šå¤„ç†URLå’Œè¯ä¹¦éªŒè¯

### 3.2 è¿æ¥å‚æ•°é…ç½®


**è¿æ¥vSphereå°±åƒç™»å½•ç½‘ç«™**ï¼Œéœ€è¦æä¾›æ­£ç¡®çš„åœ°å€ã€ç”¨æˆ·åå’Œå¯†ç ï¼š

```yaml
# vSphereè¿æ¥é…ç½®
vcenter_vars:
  hostname: "vcenter.company.com"    # vCenteræœåŠ¡å™¨åœ°å€
  username: "administrator@vsphere.local"  # ç®¡ç†å‘˜è´¦æˆ·
  password: "{{ vcenter_password }}"       # å¯†ç (å»ºè®®åŠ å¯†å­˜å‚¨)
  datacenter: "Datacenter1"               # æ•°æ®ä¸­å¿ƒåç§°
  validate_certs: false                   # æ˜¯å¦éªŒè¯SSLè¯ä¹¦
```

> âš ï¸ **å®‰å…¨æé†’**ï¼šå¯†ç åº”è¯¥ä½¿ç”¨Ansible VaultåŠ å¯†å­˜å‚¨ï¼Œä¸è¦æ˜æ–‡å†™åœ¨playbookä¸­ï¼

**éªŒè¯è¿æ¥**ï¼š
```yaml
- name: æµ‹è¯•vCenterè¿æ¥
  vmware_about_info:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: "{{ vcenter_vars.validate_certs }}"
  register: vcenter_info
  
- name: æ˜¾ç¤ºvCenterä¿¡æ¯
  debug:
    msg: "æˆåŠŸè¿æ¥åˆ° {{ vcenter_info.about_info.name }} {{ vcenter_info.about_info.version }}"
```

### 3.3 Inventoryé…ç½®


**Ansibleçš„Inventoryå°±åƒé€šè®¯å½•**ï¼Œè®°å½•äº†æ‰€æœ‰è¦ç®¡ç†çš„è™šæ‹Ÿæœºä¿¡æ¯ï¼š

```ini
# inventory/vsphere_hosts
[vcenter]
vcenter.company.com ansible_user=administrator@vsphere.local

[web_servers]
web01.company.com
web02.company.com
web03.company.com

[db_servers]
db01.company.com
db02.company.com

[vsphere_vms:children]
web_servers
db_servers
```

---

## 4. âš™ï¸ è™šæ‹Ÿæœºç”Ÿå‘½å‘¨æœŸç®¡ç†


### 4.1 è™šæ‹Ÿæœºåˆ›å»ºæµç¨‹


**åˆ›å»ºè™šæ‹Ÿæœºå°±åƒè£…ä¿®æˆ¿å­**ï¼Œéœ€è¦å…ˆé€‰æ‹©æˆ¿å­å¤§å°ã€è£…ä¿®æ ‡å‡†ï¼Œç„¶åæŒ‰æ­¥éª¤æ–½å·¥ï¼š

```
VMåˆ›å»ºæµç¨‹å›¾ï¼š
é€‰æ‹©èµ„æºè§„æ ¼ â†’ é…ç½®ç¡¬ä»¶ â†’ å®‰è£…æ“ä½œç³»ç»Ÿ â†’ ç½‘ç»œé…ç½® â†’ å¯åŠ¨è¿è¡Œ
      â†“           â†“           â†“           â†“         â†“
   CPU/å†…å­˜      ç£ç›˜å­˜å‚¨    ISOé•œåƒ     ç½‘ç»œé€‚é…å™¨   ç”µæºç®¡ç†
```

**åŸºç¡€VMåˆ›å»ºç¤ºä¾‹**ï¼š
```yaml
- name: åˆ›å»ºæ–°è™šæ‹Ÿæœº
  vmware_guest:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    # è™šæ‹ŸæœºåŸºæœ¬ä¿¡æ¯
    name: "web-server-01"                    # VMåç§°
    datacenter: "{{ vcenter_vars.datacenter }}"
    folder: "/vm/web-servers"                # å­˜æ”¾æ–‡ä»¶å¤¹
    
    # ç¡¬ä»¶é…ç½®
    guest_os: "centos7_64Guest"              # æ“ä½œç³»ç»Ÿç±»å‹
    hardware:
      memory_mb: 4096                        # å†…å­˜4GB
      num_cpus: 2                           # 2æ ¸CPU
      scsi: paravirtual                     # SCSIæ§åˆ¶å™¨ç±»å‹
    
    # ç£ç›˜é…ç½®  
    disk:
      - size_gb: 50                         # ç³»ç»Ÿç›˜50GB
        type: thin                          # ç²¾ç®€ç½®å¤‡
        datastore: "datastore1"             # å­˜å‚¨ä½ç½®
    
    # ç½‘ç»œé…ç½®
    networks:
      - name: "VM Network"                  # ç½‘ç»œåç§°
        device_type: vmxnet3                # ç½‘å¡ç±»å‹
    
    state: present                          # ç¡®ä¿VMå­˜åœ¨
```

> ğŸ’¡ **ç¡¬ä»¶é…ç½®è¯´æ˜**ï¼š
> - **ç²¾ç®€ç½®å¤‡(thin)**ï¼šå°±åƒ"æŒ‰éœ€åˆ†é…"ï¼Œå®é™…ä½¿ç”¨å¤šå°‘ç©ºé—´æ‰å ç”¨å¤šå°‘
> - **åšç½®å¤‡(thick)**ï¼šé¢„å…ˆåˆ†é…å…¨éƒ¨ç©ºé—´ï¼Œæ€§èƒ½æ›´å¥½ä½†å ç”¨å­˜å‚¨æ›´å¤š
> - **vmxnet3ç½‘å¡**ï¼šVMwareä¼˜åŒ–çš„è™šæ‹Ÿç½‘å¡ï¼Œæ€§èƒ½æœ€ä½³

### 4.2 è™šæ‹Ÿæœºç”µæºç®¡ç†


**è™šæ‹Ÿæœºçš„ç”µæºç®¡ç†å°±åƒæ§åˆ¶ç”µå™¨å¼€å…³**ï¼Œå¯ä»¥å¼€æœºã€å…³æœºã€é‡å¯ã€æš‚åœç­‰ï¼š

```yaml
# æ‰¹é‡ç”µæºç®¡ç†
- name: ç®¡ç†è™šæ‹Ÿæœºç”µæºçŠ¶æ€
  vmware_guest_powerstate:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "{{ item }}"
    state: "{{ vm_power_state }}"           # poweron/poweredoff/reboot/suspended
    force: false                           # æ˜¯å¦å¼ºåˆ¶æ‰§è¡Œ
  loop:
    - "web-server-01"
    - "web-server-02"
    - "db-server-01"
```

**ç”µæºçŠ¶æ€è¯¦è§£**ï¼š
- `poweron`ï¼š**å¼€æœº** - å¯åŠ¨è™šæ‹Ÿæœº
- `poweredoff`ï¼š**å…³æœº** - æ­£å¸¸å…³é—­è™šæ‹Ÿæœº
- `reboot`ï¼š**é‡å¯** - é‡æ–°å¯åŠ¨è™šæ‹Ÿæœº
- `suspended`ï¼š**æŒ‚èµ·** - ä¿å­˜å½“å‰çŠ¶æ€å¹¶æš‚åœè¿è¡Œ
- `shutdownguest`ï¼š**å®¢æˆ·æœºå…³æœº** - é€šè¿‡VMware Toolsä¼˜é›…å…³æœº

### 4.3 è™šæ‹Ÿæœºé…ç½®ä¿®æ”¹


**ä¿®æ”¹è™šæ‹Ÿæœºé…ç½®å°±åƒç»™æˆ¿å­è£…ä¿®å‡çº§**ï¼Œå¯ä»¥å¢åŠ æˆ¿é—´ã€å‡çº§è®¾å¤‡ç­‰ï¼š

```yaml
- name: å‡çº§è™šæ‹Ÿæœºç¡¬ä»¶é…ç½®
  vmware_guest:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "web-server-01"
    state: present
    
    # ç¡¬ä»¶å‡çº§
    hardware:
      memory_mb: 8192                       # å†…å­˜ä»4GBå‡çº§åˆ°8GB
      num_cpus: 4                          # CPUä»2æ ¸å‡çº§åˆ°4æ ¸
      
    # æ·»åŠ æ–°ç£ç›˜
    disk:
      - size_gb: 50                        # ä¿æŒåŸæœ‰ç³»ç»Ÿç›˜
        type: thin
        datastore: "datastore1"
      - size_gb: 100                       # æ–°å¢æ•°æ®ç›˜100GB
        type: thin
        datastore: "datastore2"
        
    wait_for_customization: true           # ç­‰å¾…é…ç½®å®Œæˆ
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - å¢åŠ CPUå’Œå†…å­˜é€šå¸¸éœ€è¦å…³æœºåæ‰èƒ½ç”Ÿæ•ˆ
> - ç£ç›˜åªèƒ½å¢å¤§ä¸èƒ½ç¼©å°
> - å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œé…ç½®ä¿®æ”¹

---

## 5. ğŸ“‹ æ¨¡æ¿å…‹éš†ä¸æ‰¹é‡éƒ¨ç½²


### 5.1 è™šæ‹Ÿæœºæ¨¡æ¿æ¦‚å¿µ


**è™šæ‹Ÿæœºæ¨¡æ¿å°±åƒæ˜¯"æ¯›å¯æˆ¿æ ‡å‡†æˆ·å‹"**ã€‚å¼€å‘å•†å…ˆå»ºå¥½ä¸€å¥—æ ‡å‡†çš„æ¯›å¯æˆ¿ï¼Œç„¶åå¿«é€Ÿå¤åˆ¶å‡ºå¾ˆå¤šå¥—ç›¸åŒçš„æˆ¿å­ï¼Œå†æ ¹æ®éœ€è¦è¿›è¡Œä¸ªæ€§åŒ–è£…ä¿®ã€‚

```
æ¨¡æ¿å…‹éš†æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å…‹éš†æ“ä½œ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VMæ¨¡æ¿     â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ æ–°è™šæ‹Ÿæœº1   â”‚
â”‚ â— åŸºç¡€OS    â”‚               â”‚ (ä¸ªæ€§åŒ–é…ç½®) â”‚
â”‚ â— æ ‡å‡†è½¯ä»¶  â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ æ–°è™šæ‹Ÿæœº2   â”‚
â”‚ â— ç½‘ç»œé…ç½®  â”‚               â”‚ (ä¸ªæ€§åŒ–é…ç½®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”€â”€â”€â”€â”€â”€â”€â”€â†’  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨¡æ¿çš„ä¼˜åŠ¿**ï¼š
- âš¡ **å¿«é€Ÿéƒ¨ç½²**ï¼šå‡ åˆ†é’Ÿå†…åˆ›å»ºå¤šå°ç›¸åŒé…ç½®çš„è™šæ‹Ÿæœº
- ğŸ“ **æ ‡å‡†åŒ–**ï¼šç¡®ä¿æ‰€æœ‰è™šæ‹Ÿæœºä½¿ç”¨ç»Ÿä¸€çš„åŸºç¡€é…ç½®
- ğŸ”§ **å¯å®šåˆ¶**ï¼šåœ¨æ ‡å‡†æ¨¡æ¿åŸºç¡€ä¸Šè¿›è¡Œä¸ªæ€§åŒ–é…ç½®
- ğŸ’¾ **èŠ‚çœç©ºé—´**ï¼šå¤šä¸ªè™šæ‹Ÿæœºå…±äº«ç›¸åŒçš„åŸºç¡€ç£ç›˜

### 5.2 ä»æ¨¡æ¿å…‹éš†è™šæ‹Ÿæœº


**ä»æ¨¡æ¿å…‹éš†å°±åƒç”¨å¤å°æœºå¤å°æ–‡ä»¶**ï¼Œä¸€ä»½åŸä»¶å¯ä»¥å¿«é€Ÿåˆ¶ä½œå¤šä»½å‰¯æœ¬ï¼š

```yaml
- name: ä»æ¨¡æ¿æ‰¹é‡åˆ›å»ºè™šæ‹Ÿæœº
  vmware_guest:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    # æ–°VMä¿¡æ¯
    name: "{{ item.name }}"
    datacenter: "{{ vcenter_vars.datacenter }}"
    folder: "{{ item.folder | default('/vm') }}"
    
    # ä»æ¨¡æ¿å…‹éš†
    template: "centos7-template"             # æ¨¡æ¿åç§°
    
    # ä¸ªæ€§åŒ–é…ç½®
    hardware:
      memory_mb: "{{ item.memory }}"
      num_cpus: "{{ item.cpu }}"
      
    # ç½‘ç»œä¸ªæ€§åŒ–
    networks:
      - name: "{{ item.network }}"
        ip: "{{ item.ip_address }}"          # é™æ€IP
        netmask: "255.255.255.0"
        gateway: "192.168.1.1"
        dns_servers:
          - "8.8.8.8"
          - "8.8.4.4"
          
    customization:
      hostname: "{{ item.hostname }}"        # ä¸»æœºå
      domain: "company.local"                # åŸŸå
      
    state: present
    wait_for_customization: true             # ç­‰å¾…è‡ªå®šä¹‰å®Œæˆ
    
  loop:
    - name: "web-01"
      hostname: "web01"
      folder: "/vm/web-servers"
      memory: 4096
      cpu: 2
      network: "Web-Network"
      ip_address: "192.168.1.101"
    - name: "web-02"
      hostname: "web02"
      folder: "/vm/web-servers"
      memory: 4096
      cpu: 2
      network: "Web-Network"
      ip_address: "192.168.1.102"
```

### 5.3 é“¾æ¥å…‹éš†ä¸å®Œæ•´å…‹éš†


**å…‹éš†æœ‰ä¸¤ç§æ–¹å¼**ï¼Œå°±åƒå¤å°æ–‡ä»¶å¯ä»¥é€‰æ‹©"å¿«é€Ÿå¤å°"æˆ–"å®Œæ•´å¤å°"ï¼š

```
å®Œæ•´å…‹éš† vs é“¾æ¥å…‹éš†å¯¹æ¯”ï¼š

å®Œæ•´å…‹éš† (Full Clone)ï¼š
æ¨¡æ¿ â”€â”€â”€å¤åˆ¶â”€â”€â†’ æ–°VM
â””â”€ 50GB        â””â”€ 50GB     æ€»å ç”¨: 100GB

é“¾æ¥å…‹éš† (Linked Clone)ï¼š  
æ¨¡æ¿ â†â”€â”€é“¾æ¥â”€â”€â”€ æ–°VM
â””â”€ 50GB        â””â”€ 5GB      æ€»å ç”¨: 55GB
```

**é“¾æ¥å…‹éš†é…ç½®**ï¼š
```yaml
- name: åˆ›å»ºé“¾æ¥å…‹éš†è™šæ‹Ÿæœº
  vmware_guest:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "test-vm-{{ ansible_date_time.epoch }}"
    template: "centos7-template"
    
    # é“¾æ¥å…‹éš†é…ç½®
    snapshot_src: "clean-install"           # åŸºäºå¿«ç…§å…‹éš†
    linked_clone: true                      # å¯ç”¨é“¾æ¥å…‹éš†
    
    hardware:
      memory_mb: 2048
      num_cpus: 1
      
    state: present
```

> ğŸ’¡ **é€‰æ‹©å»ºè®®**ï¼š
> - **å¼€å‘æµ‹è¯•ç¯å¢ƒ**ï¼šä½¿ç”¨é“¾æ¥å…‹éš†èŠ‚çœç©ºé—´
> - **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨å®Œæ•´å…‹éš†ç¡®ä¿ç‹¬ç«‹æ€§

---

## 6. ğŸ“¸ å¿«ç…§ç®¡ç†ä¸æ•°æ®ä¿æŠ¤


### 6.1 å¿«ç…§çš„ä½œç”¨åŸç†


**è™šæ‹Ÿæœºå¿«ç…§å°±åƒæ¸¸æˆçš„"å­˜æ¡£ç‚¹"**ï¼Œå¯ä»¥è®°å½•æŸä¸ªæ—¶åˆ»è™šæ‹Ÿæœºçš„å®Œæ•´çŠ¶æ€ï¼Œéœ€è¦æ—¶å¯ä»¥ä¸€é”®æ¢å¤ã€‚

```
å¿«ç…§å·¥ä½œåŸç†ï¼š
æ—¶é—´ç‚¹1        æ—¶é—´ç‚¹2        æ—¶é—´ç‚¹3
   â”‚             â”‚             â”‚
   â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”
â”‚å¿«ç…§1â”‚ â”€â”€â”€â”€â†’ â”‚å¿«ç…§2â”‚ â”€â”€â”€â”€â†’ â”‚å¿«ç…§3â”‚
â”‚ç³»ç»Ÿ â”‚       â”‚å®‰è£… â”‚       â”‚é…ç½® â”‚
â”‚å®‰è£… â”‚       â”‚è½¯ä»¶ â”‚       â”‚å®Œæˆ â”‚
â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜
   â†‘             â†‘             â†‘
å¯æ¢å¤åˆ°      å¯æ¢å¤åˆ°       å½“å‰çŠ¶æ€
è¿™ä¸ªçŠ¶æ€      è¿™ä¸ªçŠ¶æ€
```

**å¿«ç…§åŒ…å«çš„å†…å®¹**ï¼š
- ğŸ’¾ **ç£ç›˜æ•°æ®**ï¼šè™šæ‹Ÿæœºæ‰€æœ‰æ–‡ä»¶å’Œæ•°æ®
- ğŸ§  **å†…å­˜çŠ¶æ€**ï¼šæ­£åœ¨è¿è¡Œçš„ç¨‹åºå’Œæ•°æ®
- âš™ï¸ **é…ç½®ä¿¡æ¯**ï¼šè™šæ‹Ÿæœºç¡¬ä»¶è®¾ç½®

### 6.2 åˆ›å»ºå’Œç®¡ç†å¿«ç…§


**åˆ›å»ºå¿«ç…§å°±åƒæŒ‰ä¸‹ç›¸æœºå¿«é—¨**ï¼Œç¬é—´è®°å½•å½“å‰çŠ¶æ€ï¼š

```yaml
- name: åˆ›å»ºè™šæ‹Ÿæœºå¿«ç…§
  vmware_guest_snapshot:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "web-server-01"                   # è™šæ‹Ÿæœºåç§°
    snapshot_name: "before-update-{{ ansible_date_time.date }}"  # å¿«ç…§åç§°
    description: "æ›´æ–°å‰çš„ç³»ç»ŸçŠ¶æ€å¤‡ä»½"      # å¿«ç…§æè¿°
    state: present                          # åˆ›å»ºå¿«ç…§
    memory: true                           # åŒ…å«å†…å­˜çŠ¶æ€
    quiesce: true                          # é™é»˜å¿«ç…§(ç¡®ä¿æ•°æ®ä¸€è‡´æ€§)
```

**æ¢å¤åˆ°å¿«ç…§**ï¼š
```yaml
- name: æ¢å¤è™šæ‹Ÿæœºåˆ°æŒ‡å®šå¿«ç…§
  vmware_guest_snapshot:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "web-server-01"
    snapshot_name: "before-update-2025-01-20"
    state: revert                          # æ¢å¤æ“ä½œ
```

### 6.3 å¿«ç…§æ¸…ç†ä¸ç»´æŠ¤


**å¿«ç…§å°±åƒå­˜æ¡£æ–‡ä»¶**ï¼Œæ—¶é—´é•¿äº†ä¼šå ç”¨å¾ˆå¤šå­˜å‚¨ç©ºé—´ï¼Œéœ€è¦å®šæœŸæ¸…ç†ï¼š

```yaml
- name: è·å–è™šæ‹Ÿæœºå¿«ç…§ä¿¡æ¯
  vmware_guest_snapshot_info:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    name: "{{ vm_name }}"
  register: snapshot_info

- name: åˆ é™¤è¿‡æœŸå¿«ç…§
  vmware_guest_snapshot:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "{{ vm_name }}"
    snapshot_name: "{{ item.name }}"
    state: absent                          # åˆ é™¤å¿«ç…§
  loop: "{{ snapshot_info.guest_snapshots.snapshots }}"
  when: 
    - item.create_time is defined
    - (ansible_date_time.epoch | int) - (item.create_time | to_datetime('%Y-%m-%dT%H:%M:%S.%fZ') | strftime('%s') | int) > 604800  # 7å¤©å‰çš„å¿«ç…§
```

> âš ï¸ **å¿«ç…§ç®¡ç†è¦ç‚¹**ï¼š
> - å¿«ç…§ä¸æ˜¯å¤‡ä»½ï¼Œåªæ˜¯ä¸´æ—¶ä¿æŠ¤æ‰‹æ®µ
> - å¿«ç…§é“¾è¿‡é•¿ä¼šå½±å“æ€§èƒ½
> - ç”Ÿäº§ç¯å¢ƒå»ºè®®å¿«ç…§ä¿ç•™æ—¶é—´ä¸è¶…è¿‡72å°æ—¶
> - å®šæœŸåˆå¹¶å¿«ç…§é‡Šæ”¾å­˜å‚¨ç©ºé—´

---

## 7. ğŸ“Š èµ„æºç®¡ç†ä¸æ€§èƒ½ä¼˜åŒ–


### 7.1 èµ„æºåˆ†é…ç­–ç•¥


**è™šæ‹Ÿæœºèµ„æºåˆ†é…å°±åƒåˆ†é…å…¬å¸é¢„ç®—**ï¼Œéœ€è¦æ ¹æ®ä¸åŒéƒ¨é—¨çš„é‡è¦æ€§å’Œéœ€æ±‚æ¥åˆç†åˆ†é…èµ„æºï¼š

```
èµ„æºåˆ†é…å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç‰©ç†ä¸»æœº        â”‚ â† æ€»èµ„æºæ± 
â”‚   CPU: 32æ ¸         â”‚
â”‚   å†…å­˜: 128GB       â”‚
â”‚   å­˜å‚¨: 2TB         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
    â–¼      â–¼      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ é«˜ä¼˜ â”‚â”‚ ä¸­ä¼˜ â”‚â”‚ ä½ä¼˜ â”‚ â† ä¸åŒä¼˜å…ˆçº§çš„VM
â”‚ çº§VM â”‚â”‚ çº§VM â”‚â”‚ çº§VM â”‚
â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾ç½®èµ„æºé¢„ç•™å’Œé™åˆ¶**ï¼š
```yaml
- name: é…ç½®è™šæ‹Ÿæœºèµ„æºåˆ†é…
  vmware_guest:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    name: "database-server"
    state: present
    
    hardware:
      memory_mb: 8192
      num_cpus: 4
      
      # CPUèµ„æºé…ç½®
      cpu_reservation: 2000                 # é¢„ç•™2GHz CPU (ä¿è¯æœ€ä½æ€§èƒ½)
      cpu_limit: 4000                      # é™åˆ¶æœ€å¤§4GHz CPU
      cpu_shares_level: "high"             # CPUä¼˜å…ˆçº§: low/normal/high/custom
      
      # å†…å­˜èµ„æºé…ç½®  
      memory_reservation: 4096             # é¢„ç•™4GBå†…å­˜
      memory_reservation_lock: true        # é”å®šé¢„ç•™å†…å­˜
      mem_shares_level: "high"             # å†…å­˜ä¼˜å…ˆçº§
```

**èµ„æºé…ç½®å‚æ•°è¯¦è§£**ï¼š
- **é¢„ç•™ï¼ˆReservationï¼‰**ï¼šä¿è¯è™šæ‹Ÿæœºçš„æœ€ä½èµ„æºï¼Œå°±åƒ"åŸºæœ¬å·¥èµ„"
- **é™åˆ¶ï¼ˆLimitï¼‰**ï¼šé™åˆ¶è™šæ‹Ÿæœºçš„æœ€å¤§èµ„æºä½¿ç”¨ï¼Œå°±åƒ"æ”¯å‡ºä¸Šé™"
- **ä»½é¢ï¼ˆSharesï¼‰**ï¼šå½“èµ„æºç´§å¼ æ—¶çš„åˆ†é…ä¼˜å…ˆçº§ï¼Œå°±åƒ"è¯è¯­æƒ"

### 7.2 æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜


**ç›‘æ§è™šæ‹Ÿæœºæ€§èƒ½å°±åƒä½“æ£€**ï¼Œå®šæœŸæ£€æŸ¥å„é¡¹æŒ‡æ ‡ï¼Œå‘ç°é—®é¢˜åŠæ—¶è°ƒæ•´ï¼š

```yaml
- name: è·å–è™šæ‹Ÿæœºæ€§èƒ½ç»Ÿè®¡
  vmware_vm_info:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    vm_name: "{{ vm_name }}"
  register: vm_info

- name: æ˜¾ç¤ºè™šæ‹Ÿæœºèµ„æºä½¿ç”¨æƒ…å†µ
  debug:
    msg: |
      è™šæ‹Ÿæœº: {{ vm_name }}
      CPUä½¿ç”¨: {{ vm_info.virtual_machines[0].guest_usage.cpu_usage }}%
      å†…å­˜ä½¿ç”¨: {{ vm_info.virtual_machines[0].guest_usage.memory_usage }}MB
      ç”µæºçŠ¶æ€: {{ vm_info.virtual_machines[0].power_state }}
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

```yaml
# æ€§èƒ½ä¼˜åŒ–é…ç½®æ¨¡æ¿
performance_optimizations:
  # CPUä¼˜åŒ–
  cpu_hot_add: true                        # æ”¯æŒåœ¨çº¿å¢åŠ CPU
  cpu_hot_remove: true                     # æ”¯æŒåœ¨çº¿å‡å°‘CPU
  
  # å†…å­˜ä¼˜åŒ–  
  memory_hot_add: true                     # æ”¯æŒåœ¨çº¿å¢åŠ å†…å­˜
  memory_reservation_lock: false          # å…è®¸å†…å­˜äº¤æ¢(é™¤éæ€§èƒ½å…³é”®)
  
  # å­˜å‚¨ä¼˜åŒ–
  disk_eagerly_scrub: false                # ä¸é¢„å…ˆæ“¦é™¤ç£ç›˜(æé«˜åˆ›å»ºé€Ÿåº¦)
  disk_type: "thin"                       # ç²¾ç®€ç½®å¤‡èŠ‚çœç©ºé—´
  
  # ç½‘ç»œä¼˜åŒ–
  network_type: "vmxnet3"                 # ä½¿ç”¨é«˜æ€§èƒ½ç½‘å¡
```

### 7.3 DRSè‡ªåŠ¨è´Ÿè½½å‡è¡¡


**DRSï¼ˆåˆ†å¸ƒå¼èµ„æºè°ƒåº¦ï¼‰å°±åƒæ™ºèƒ½äº¤é€šç³»ç»Ÿ**ï¼Œè‡ªåŠ¨ç›‘æ§å„ä¸ªè·¯å£çš„æ‹¥å µæƒ…å†µï¼Œå¼•å¯¼è½¦è¾†é€‰æ‹©æœ€ä½³è·¯å¾„ï¼š

```yaml
- name: é…ç½®DRSé›†ç¾¤è§„åˆ™
  vmware_drs_rule:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    cluster_name: "Production-Cluster"
    rule_name: "database-anti-affinity"     # è§„åˆ™åç§°
    rule_type: "vm_vm_anti_affinity"        # è§„åˆ™ç±»å‹
    
    # æ•°æ®åº“æœåŠ¡å™¨åˆ†ç¦»è§„åˆ™
    vms:
      - "db-master"
      - "db-slave" 
    enabled: true                          # å¯ç”¨è§„åˆ™
    mandatory: true                        # å¼ºåˆ¶æ‰§è¡Œ
```

**DRSè§„åˆ™ç±»å‹**ï¼š
- **åäº²å’Œæ€§**ï¼šç¡®ä¿é‡è¦è™šæ‹Ÿæœºåˆ†å¸ƒåœ¨ä¸åŒä¸»æœºä¸Š
- **äº²å’Œæ€§**ï¼šè®©ç›¸å…³è™šæ‹Ÿæœºè¿è¡Œåœ¨åŒä¸€ä¸»æœºä¸Š
- **ä¸»æœºäº²å’Œæ€§**ï¼šæŒ‡å®šè™šæ‹Ÿæœºè¿è¡Œåœ¨ç‰¹å®šä¸»æœºä¸Š

---

## 8. ğŸŒ ç½‘ç»œä¸å­˜å‚¨é…ç½®


### 8.1 è™šæ‹Ÿç½‘ç»œç®¡ç†


**è™šæ‹Ÿç½‘ç»œå°±åƒå¤§æ¥¼çš„ç½‘çº¿å¸ƒå±€**ï¼Œéœ€è¦åˆç†è§„åˆ’ä¸åŒçš„ç½‘ç»œåŒºåŸŸå’Œè¿æ¥æ–¹å¼ï¼š

```
vSphereç½‘ç»œæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç‰©ç†ç½‘ç»œäº¤æ¢æœº            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       vSphereæ ‡å‡†äº¤æ¢æœº          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ç«¯å£ç»„1   â”‚ â”‚ç«¯å£ç»„2   â”‚     â”‚
â”‚  â”‚Webç½‘ç»œ  â”‚ â”‚DBç½‘ç»œ   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚Web VM  â”‚    â”‚DB VM   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ›å»ºè™šæ‹Ÿäº¤æ¢æœºå’Œç«¯å£ç»„**ï¼š
```yaml
- name: åˆ›å»ºæ ‡å‡†è™šæ‹Ÿäº¤æ¢æœº
  vmware_vswitch:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    esxi_hostname: "esxi01.company.com"     # ESXiä¸»æœºå
    switch: "vSwitch-Web"                   # äº¤æ¢æœºåç§°
    nics: 
      - vmnic1                             # ç»‘å®šç‰©ç†ç½‘å¡
      - vmnic2
    mtu: 9000                              # å·¨å‹å¸§æ”¯æŒ
    state: present

- name: åˆ›å»ºç«¯å£ç»„
  vmware_portgroup:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    esxi_hostname: "esxi01.company.com"
    switch: "vSwitch-Web"
    portgroup: "Web-Network"               # ç«¯å£ç»„åç§°
    vlan_id: 100                          # VLAN ID
    state: present
```

**ç½‘ç»œé…ç½®æœ€ä½³å®è·µ**ï¼š
- ğŸ” **VLANéš”ç¦»**ï¼šä¸åŒä¸šåŠ¡ä½¿ç”¨ä¸åŒVLANæé«˜å®‰å…¨æ€§
- ğŸ”— **é“¾è·¯èšåˆ**ï¼šå¤šç½‘å¡ç»‘å®šæé«˜å¸¦å®½å’Œå†—ä½™
- ğŸ“Š **æµé‡æ•´å½¢**ï¼šé™åˆ¶ç‰¹å®šè™šæ‹Ÿæœºçš„ç½‘ç»œå¸¦å®½

### 8.2 å­˜å‚¨ç®¡ç†


**å­˜å‚¨ç®¡ç†å°±åƒç®¡ç†ä»“åº“**ï¼Œéœ€è¦åˆç†åˆ†é…ç©ºé—´ã€ç¡®ä¿æ•°æ®å®‰å…¨ã€æé«˜è®¿é—®æ•ˆç‡ï¼š

```
vSphereå­˜å‚¨æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å­˜å‚¨é˜µåˆ—1  â”‚    â”‚   å­˜å‚¨é˜µåˆ—2  â”‚    â”‚   æœ¬åœ°å­˜å‚¨   â”‚
â”‚   (SAN)     â”‚    â”‚   (NAS)     â”‚    â”‚   (Local)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          ESXiä¸»æœº               â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚  â”‚æ•°æ®å­˜å‚¨1  â”‚ â”‚æ•°æ®å­˜å‚¨2  â”‚    â”‚
         â”‚  â”‚datastore1 â”‚ â”‚datastore2 â”‚    â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ·»åŠ æ•°æ®å­˜å‚¨**ï¼š
```yaml
- name: æ·»åŠ NFSæ•°æ®å­˜å‚¨
  vmware_host_datastore:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
    
    esxi_hostname: "{{ item }}"
    datastore_name: "nfs-datastore-01"     # æ•°æ®å­˜å‚¨åç§°
    datastore_type: "nfs"                  # å­˜å‚¨ç±»å‹
    nfs_server: "192.168.1.200"           # NFSæœåŠ¡å™¨IP
    nfs_path: "/export/vmware"             # NFSå…±äº«è·¯å¾„
    nfs_readonly: false                    # è¯»å†™æƒé™
    state: present
  loop: "{{ esxi_hosts }}"
```

**å­˜å‚¨ç±»å‹å¯¹æ¯”**ï¼š

| å­˜å‚¨ç±»å‹ | **æ€§èƒ½** | **æˆæœ¬** | **é€‚ç”¨åœºæ™¯** | **ç‰¹ç‚¹** |
|---------|---------|---------|-------------|---------|
| ğŸ”´ **æœ¬åœ°å­˜å‚¨** | `â˜…â˜…â˜…â˜…â˜†` | `â˜…â˜…â˜…â˜…â˜…` | `å¼€å‘æµ‹è¯•` | `æ€§èƒ½å¥½ï¼Œæ— å…±äº«` |
| ğŸŸ¡ **NFSå­˜å‚¨** | `â˜…â˜…â˜…â˜†â˜†` | `â˜…â˜…â˜…â˜†â˜†` | `æ–‡ä»¶å…±äº«` | `æ˜“ç®¡ç†ï¼Œæ”¯æŒå¿«ç…§` |
| ğŸŸ¢ **iSCSIå­˜å‚¨** | `â˜…â˜…â˜…â˜…â˜†` | `â˜…â˜…â˜†â˜†â˜†` | `æ•°æ®åº“åº”ç”¨` | `å—çº§è®¿é—®ï¼Œé«˜æ€§èƒ½` |
| ğŸ”µ **å…‰çº¤å­˜å‚¨** | `â˜…â˜…â˜…â˜…â˜…` | `â˜…â˜†â˜†â˜†â˜†` | `å…³é”®åº”ç”¨` | `æœ€é«˜æ€§èƒ½ï¼Œæœ€è´µ` |

---

## 9. ğŸ“ˆ ç›‘æ§ä¸è¿ç»´è‡ªåŠ¨åŒ–


### 9.1 è™šæ‹ŸæœºçŠ¶æ€ç›‘æ§


**ç›‘æ§è™šæ‹Ÿæœºå°±åƒåŒ»ç”ŸæŸ¥æˆ¿**ï¼Œå®šæœŸæ£€æŸ¥æ¯ä¸ª"ç—…äºº"çš„å¥åº·çŠ¶å†µï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜ï¼š

```yaml
- name: å®šæœŸæ£€æŸ¥è™šæ‹Ÿæœºå¥åº·çŠ¶æ€
  vmware_vm_info:
    hostname: "{{ vcenter_vars.hostname }}"
    username: "{{ vcenter_vars.username }}"
    password: "{{ vcenter_vars.password }}"
    validate_certs: false
  register: all_vms

- name: ç”Ÿæˆå¥åº·çŠ¶æ€æŠ¥å‘Š
  template:
    src: vm_health_report.j2
    dest: "/tmp/vm_health_{{ ansible_date_time.date }}.html"
  vars:
    vm_list: "{{ all_vms.virtual_machines }}"
```

**å¥åº·æ£€æŸ¥è„šæœ¬**ï¼š
```yaml
- name: è™šæ‹Ÿæœºå¥åº·çŠ¶æ€æ£€æŸ¥
  block:
    - name: æ£€æŸ¥VMç”µæºçŠ¶æ€
      fail:
        msg: "è™šæ‹Ÿæœº {{ item.guest_name }} æœªæ­£å¸¸è¿è¡Œ"
      when: item.power_state != "poweredOn"
      loop: "{{ critical_vms }}"
      
    - name: æ£€æŸ¥VMware ToolsçŠ¶æ€  
      debug:
        msg: "è­¦å‘Š: {{ item.guest_name }} VMware ToolsçŠ¶æ€å¼‚å¸¸"
      when: item.guest_tools_status != "toolsOk"
      loop: "{{ all_vms.virtual_machines }}"
      
    - name: æ£€æŸ¥å¿«ç…§æ•°é‡
      debug:
        msg: "è­¦å‘Š: {{ item.guest_name }} å¿«ç…§è¿‡å¤š({{ item.snapshots | length }})"
      when: item.snapshots | length > 3
      loop: "{{ all_vms.virtual_machines }}"
```

### 9.2 è‡ªåŠ¨åŒ–è¿ç»´ä»»åŠ¡


**è‡ªåŠ¨åŒ–è¿ç»´å°±åƒå®¶é‡Œçš„æ‰«åœ°æœºå™¨äºº**ï¼ŒæŒ‰ç…§é¢„è®¾çš„è§„åˆ™å’Œæ—¶é—´è‡ªåŠ¨å®Œæˆé‡å¤æ€§å·¥ä½œï¼š

```yaml
# æ¯æ—¥è¿ç»´ä»»åŠ¡
- name: è™šæ‹Ÿæœºæ—¥å¸¸ç»´æŠ¤
  cron:
    name: "VM Daily Maintenance"
    minute: "0"
    hour: "2"                              # å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    job: "ansible-playbook /opt/ansible/vm-maintenance.yml"
    
# ç»´æŠ¤ä»»åŠ¡å†…å®¹
- name: è™šæ‹Ÿæœºç»´æŠ¤ä»»åŠ¡
  block:
    # æ¸…ç†è¿‡æœŸå¿«ç…§
    - name: æ¸…ç†7å¤©å‰çš„å¿«ç…§
      vmware_guest_snapshot:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
        name: "{{ item.name }}"
        snapshot_name: "{{ item.snapshot_name }}"
        state: absent
      loop: "{{ old_snapshots }}"
      
    # æ•´ç†ç£ç›˜ç¢ç‰‡
    - name: è™šæ‹Ÿç£ç›˜å‹ç¼©
      vmware_guest_disk:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
        name: "{{ item }}"
        disk_operation: "compact"
      loop: "{{ maintenance_vms }}"
      
    # æ›´æ–°VMware Tools
    - name: æ›´æ–°VMware Tools
      vmware_guest_tools:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
        name: "{{ item }}"
        upgrade_tools: true
        installer_options: "/s /v /qn"       # é™é»˜å®‰è£…
      loop: "{{ vms_need_tools_update }}"
```

### 9.3 å‘Šè­¦å’Œé€šçŸ¥æœºåˆ¶


**å‘Šè­¦ç³»ç»Ÿå°±åƒç«è­¦ç³»ç»Ÿ**ï¼Œä¸€æ—¦å‘ç°å¼‚å¸¸ç«‹å³é€šçŸ¥ç›¸å…³äººå‘˜ï¼š

```yaml
- name: è™šæ‹Ÿæœºå¼‚å¸¸å‘Šè­¦
  block:
    - name: æ£€æµ‹è™šæ‹Ÿæœºå¼‚å¸¸
      vmware_vm_info:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
      register: vm_status
      
    - name: å‘é€å‘Šè­¦é‚®ä»¶
      mail:
        to: "{{ alert_emails }}"
        subject: "vSphereå‘Šè­¦: è™šæ‹Ÿæœºå¼‚å¸¸"
        body: |
          å‘ç°ä»¥ä¸‹è™šæ‹Ÿæœºå¼‚å¸¸:
          {% for vm in problem_vms %}
          - {{ vm.guest_name }}: {{ vm.power_state }}
          {% endfor %}
          
          è¯·åŠæ—¶å¤„ç†ï¼
        smtp:
          host: "smtp.company.com"
          port: 587
          username: "alert@company.com"
          password: "{{ smtp_password }}"
      when: problem_vms | length > 0
      
    - name: å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥
      uri:
        url: "{{ wechat_webhook_url }}"
        method: POST
        body_format: json
        body:
          msgtype: "text"
          text:
            content: "vSphereå‘Šè­¦: å‘ç°{{ problem_vms | length }}å°è™šæ‹Ÿæœºå¼‚å¸¸ï¼Œè¯·æŸ¥æ”¶é‚®ä»¶è¯¦æƒ…"
      when: problem_vms | length > 0
```

---

## 10. ğŸ”§ æœ€ä½³å®è·µä¸æ•…éšœæ’é™¤


### 10.1 éƒ¨ç½²æœ€ä½³å®è·µ


**å°±åƒå»ºæˆ¿å­éœ€è¦éµå¾ªå»ºç­‘è§„èŒƒ**ï¼Œè™šæ‹ŸåŒ–ç¯å¢ƒä¹Ÿæœ‰ä¸€å¥—æœ€ä½³å®è·µæ¥ç¡®ä¿ç¨³å®šå¯é ï¼š

```yaml
# æœ€ä½³å®è·µé…ç½®æ¨¡æ¿
best_practices:
  # å‘½åè§„èŒƒ
  naming_convention:
    vm_name: "{{ environment }}-{{ service }}-{{ instance_number }}"  # å¦‚: prod-web-01
    folder_structure: "{{ environment }}/{{ service_type }}"          # å¦‚: production/web-servers
    
  # èµ„æºé…ç½®å»ºè®®
  resource_allocation:
    cpu_reservation: "{{ total_cpu * 0.5 }}"      # é¢„ç•™50%CPU
    memory_reservation: "{{ total_memory * 0.8 }}" # é¢„ç•™80%å†…å­˜
    
  # å®‰å…¨é…ç½®
  security_settings:
    validate_certs: true                           # ç”Ÿäº§ç¯å¢ƒå¿…é¡»éªŒè¯è¯ä¹¦
    password_encrypted: true                       # å¯†ç å¿…é¡»åŠ å¯†å­˜å‚¨
    
  # å¤‡ä»½ç­–ç•¥
  backup_policy:
    snapshot_retention: 3                          # æœ€å¤šä¿ç•™3ä¸ªå¿«ç…§
    backup_frequency: "daily"                      # æ¯æ—¥å¤‡ä»½
```

**ç¯å¢ƒåˆ†ç¦»ç­–ç•¥**ï¼š
```yaml
environments:
  development:
    vcenter_host: "dev-vcenter.company.com"
    resource_pool: "Development"
    cpu_shares: "low"
    memory_shares: "low"
    
  staging:
    vcenter_host: "staging-vcenter.company.com" 
    resource_pool: "Staging"
    cpu_shares: "normal"
    memory_shares: "normal"
    
  production:
    vcenter_host: "prod-vcenter.company.com"
    resource_pool: "Production"  
    cpu_shares: "high"
    memory_shares: "high"
    high_availability: true
```

### 10.2 å¸¸è§é—®é¢˜è¯Šæ–­


**å°±åƒåŒ»ç”Ÿçœ‹ç—…éœ€è¦å…ˆè¯Šæ–­ç—‡çŠ¶**ï¼Œè™šæ‹ŸåŒ–é—®é¢˜ä¹Ÿéœ€è¦ç³»ç»ŸåŒ–çš„æ’æŸ¥æ–¹æ³•ï¼š

```yaml
# æ•…éšœè¯Šæ–­playbook
- name: vSphereæ•…éšœè¯Šæ–­
  block:
    # 1. è¿æ¥æ€§æµ‹è¯•
    - name: æµ‹è¯•vCenterè¿æ¥
      vmware_about_info:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
      register: connection_test
      ignore_errors: true
      
    - name: è¿æ¥å¤±è´¥å¤„ç†
      debug:
        msg: "è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥: 1)ç½‘ç»œè¿é€šæ€§ 2)ç”¨æˆ·åå¯†ç  3)é˜²ç«å¢™è®¾ç½®"
      when: connection_test is failed
      
    # 2. èµ„æºçŠ¶æ€æ£€æŸ¥
    - name: æ£€æŸ¥ESXiä¸»æœºçŠ¶æ€
      vmware_host_facts:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
        esxi_hostname: "{{ item }}"
      register: host_facts
      loop: "{{ esxi_hosts }}"
      ignore_errors: true
      
    # 3. å­˜å‚¨ç©ºé—´æ£€æŸ¥
    - name: æ£€æŸ¥æ•°æ®å­˜å‚¨ç©ºé—´
      vmware_datastore_info:
        hostname: "{{ vcenter_vars.hostname }}"
        username: "{{ vcenter_vars.username }}"
        password: "{{ vcenter_vars.password }}"
        validate_certs: false
      register: datastore_info
      
    - name: å­˜å‚¨ç©ºé—´å‘Šè­¦
      debug:
        msg: "å‘Šè­¦: æ•°æ®å­˜å‚¨ {{ item.name }} å‰©ä½™ç©ºé—´ä¸è¶³10%"
      when: (item.free_space / item.capacity * 100) < 10
      loop: "{{ datastore_info.datastores }}"
```

**æ•…éšœæ’æŸ¥æ¸…å•**ï¼š

| æ•…éšœç±»å‹ | **å¯èƒ½åŸå› ** | **æ’æŸ¥æ­¥éª¤** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **è¿æ¥å¤±è´¥** | `ç½‘ç»œ/è®¤è¯é—®é¢˜` | `pingæµ‹è¯•ã€å¯†ç éªŒè¯` | `æ£€æŸ¥ç½‘ç»œã€é‡ç½®å¯†ç ` |
| ğŸŸ¡ **è™šæ‹Ÿæœºå¯åŠ¨æ…¢** | `å­˜å‚¨æ€§èƒ½å·®` | `æ£€æŸ¥IOPSã€å»¶è¿Ÿ` | `è¿ç§»åˆ°SSDå­˜å‚¨` |
| ğŸŸ  **å†…å­˜ä¸è¶³** | `è¿‡åº¦åˆ†é…` | `æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡` | `å¢åŠ ç‰©ç†å†…å­˜` |
| ğŸ”µ **ç½‘ç»œå¼‚å¸¸** | `äº¤æ¢æœºé…ç½®` | `æ£€æŸ¥VLANã€ç«¯å£ç»„` | `é‡æ–°é…ç½®ç½‘ç»œ` |

### 10.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**æ€§èƒ½ä¼˜åŒ–å°±åƒç»™æ±½è½¦åšä¿å…»**ï¼Œå®šæœŸè°ƒæ•´å„é¡¹å‚æ•°ç¡®ä¿æœ€ä½³è¿è¡ŒçŠ¶æ€ï¼š

```yaml
# æ€§èƒ½ä¼˜åŒ–é…ç½®
performance_tuning:
  # CPUä¼˜åŒ–
  cpu_optimization:
    numa_node_affinity: true               # NUMAèŠ‚ç‚¹äº²å’Œæ€§
    cpu_hot_plug: true                     # CPUçƒ­æ’æ‹”
    hyperthreading: true                   # è¶…çº¿ç¨‹æ”¯æŒ
    
  # å†…å­˜ä¼˜åŒ–  
  memory_optimization:
    memory_ballooning: false               # ç”Ÿäº§ç¯å¢ƒç¦ç”¨å†…å­˜æ°”çƒ
    transparent_page_sharing: false        # ç¦ç”¨é€æ˜é¡µå…±äº«(å®‰å…¨è€ƒè™‘)
    large_pages: true                      # ä½¿ç”¨å¤§é¡µå†…å­˜
    
  # å­˜å‚¨ä¼˜åŒ–
  storage_optimization:
    queue_depth: 32                        # å¢åŠ é˜Ÿåˆ—æ·±åº¦
    multipathing: true                     # å¯ç”¨å¤šè·¯å¾„
    storage_io_control: true               # å­˜å‚¨IOæ§åˆ¶
    
  # ç½‘ç»œä¼˜åŒ–
  network_optimization:
    jumbo_frames: true                     # å¯ç”¨å·¨å‹å¸§
    network_io_control: true               # ç½‘ç»œIOæ§åˆ¶
    load_balancing: "route_based"          # åŸºäºè·¯ç”±çš„è´Ÿè½½å‡è¡¡
```

---

## ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### ğŸ¯ å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è™šæ‹ŸåŒ–åŸºç¡€ï¼šESXiä¸»æœºã€vCenterã€è™šæ‹Ÿæœºä¸‰å±‚æ¶æ„
ğŸ”¸ è¿æ¥é…ç½®ï¼špyvmomiä¾èµ–ã€è®¤è¯ä¿¡æ¯ã€è¯ä¹¦éªŒè¯
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»ºã€é…ç½®ã€ç”µæºç®¡ç†ã€åˆ é™¤å®Œæ•´æµç¨‹  
ğŸ”¸ æ¨¡æ¿å…‹éš†ï¼šæ ‡å‡†åŒ–éƒ¨ç½²ã€æ‰¹é‡åˆ›å»ºã€ä¸ªæ€§åŒ–é…ç½®
ğŸ”¸ å¿«ç…§ç®¡ç†ï¼šçŠ¶æ€ä¿æŠ¤ã€æ¢å¤æœºåˆ¶ã€å®šæœŸæ¸…ç†
ğŸ”¸ èµ„æºè°ƒåº¦ï¼šé¢„ç•™é™åˆ¶ã€DRSè´Ÿè½½å‡è¡¡ã€æ€§èƒ½ä¼˜åŒ–
ğŸ”¸ ç½‘ç»œå­˜å‚¨ï¼šè™šæ‹Ÿäº¤æ¢æœºã€ç«¯å£ç»„ã€æ•°æ®å­˜å‚¨
ğŸ”¸ è¿ç»´è‡ªåŠ¨åŒ–ï¼šç›‘æ§å‘Šè­¦ã€å®šæœŸç»´æŠ¤ã€æ•…éšœå¤„ç†
```

### ğŸ”¹ å…³é”®ç†è§£è¦ç‚¹


**Ansibleä¸ä¼ ç»Ÿç®¡ç†çš„åŒºåˆ«**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼š
æ‰‹å·¥æ“ä½œ â†’ å®¹æ˜“å‡ºé”™ â†’ ä¸æ˜“å¤ç° â†’ éš¾ä»¥æ‰©å±•

Ansibleæ–¹å¼ï¼š  
ä»£ç æè¿° â†’ è‡ªåŠ¨æ‰§è¡Œ â†’ æ ‡å‡†åŒ– â†’ å¯é‡å¤ â†’ æ˜“æ‰©å±•
```

**è™šæ‹ŸåŒ–èµ„æºç®¡ç†æ ¸å¿ƒæ€æƒ³**ï¼š
```
ç‰©ç†èµ„æºæ± åŒ– â†’ è™šæ‹Ÿèµ„æºåˆ†é… â†’ åŠ¨æ€è°ƒåº¦ä¼˜åŒ– â†’ æŒ‰éœ€æ‰©ç¼©å®¹
```

**æœ€ä½³å®è·µè¦ç‚¹**ï¼š
```
ğŸ”¸ ç¯å¢ƒéš”ç¦»ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§åˆ†ç¦»
ğŸ”¸ å‘½åè§„èŒƒï¼šç»Ÿä¸€çš„å‘½åå’Œæ–‡ä»¶å¤¹ç»“æ„
ğŸ”¸ èµ„æºè§„åˆ’ï¼šåˆç†çš„CPUã€å†…å­˜ã€å­˜å‚¨åˆ†é…
ğŸ”¸ å®‰å…¨ç­–ç•¥ï¼šè®¤è¯åŠ å¯†ã€ç½‘ç»œéš”ç¦»ã€æƒé™æ§åˆ¶
ğŸ”¸ å¤‡ä»½æ¢å¤ï¼šå®šæœŸå¿«ç…§ã€æ•°æ®ä¿æŠ¤ã€ç¾éš¾æ¢å¤
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šä¸»åŠ¨ç›‘æ§ã€å¼‚å¸¸å‘Šè­¦ã€è¶‹åŠ¿åˆ†æ
```

### ğŸš€ å®é™…åº”ç”¨ä»·å€¼


- **å¼€å‘ç¯å¢ƒ**ï¼šå¿«é€Ÿåˆ›å»ºæµ‹è¯•ç¯å¢ƒï¼ŒèŠ‚çœç¡¬ä»¶æˆæœ¬
- **ç”Ÿäº§éƒ¨ç½²**ï¼šæ ‡å‡†åŒ–æ‰¹é‡éƒ¨ç½²ï¼Œç¡®ä¿é…ç½®ä¸€è‡´æ€§
- **è¿ç»´ç®¡ç†**ï¼šè‡ªåŠ¨åŒ–æ—¥å¸¸ä»»åŠ¡ï¼Œæé«˜è¿ç»´æ•ˆç‡
- **ç¾éš¾æ¢å¤**ï¼šå¿«é€Ÿæ¢å¤ä¸šåŠ¡ï¼Œé™ä½å®•æœºæŸå¤±
- **æˆæœ¬ä¼˜åŒ–**ï¼šèµ„æºæ± åŒ–ç®¡ç†ï¼Œæé«˜ç¡¬ä»¶åˆ©ç”¨ç‡

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è™šæ‹Ÿå¹³å°ä¸‰ä»¶å¥—ï¼šESXiã€vCenterã€VM
- è¿æ¥ç®¡ç†pyvmomiï¼Œè®¤è¯é…ç½®è¦æ­£ç¡®  
- æ¨¡æ¿å…‹éš†æ‰¹é‡å»ºï¼Œå¿«ç…§ä¿æŠ¤é˜²æ„å¤–
- èµ„æºè°ƒåº¦è¦åˆç†ï¼Œç›‘æ§è¿ç»´è‡ªåŠ¨åŒ–
- æœ€ä½³å®è·µè¦éµå¾ªï¼Œæ•…éšœæ’æŸ¥æœ‰ç« æ³•