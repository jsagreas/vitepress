---
title: 1ã€inventory-é™æ€æ¸…å•
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ä¸»æœºæ¸…å•](#1-ä»€ä¹ˆæ˜¯ä¸»æœºæ¸…å•)
2. [é™æ€æ¸…å•æ–‡ä»¶ä½ç½®](#2-é™æ€æ¸…å•æ–‡ä»¶ä½ç½®)
3. [INIæ ¼å¼è¯­æ³•è¯¦è§£](#3-iniæ ¼å¼è¯­æ³•è¯¦è§£)
4. [YAMLæ ¼å¼è¯­æ³•è¯¦è§£](#4-yamlæ ¼å¼è¯­æ³•è¯¦è§£)
5. [ä¸»æœºåˆ†ç»„ä¸åµŒå¥—](#5-ä¸»æœºåˆ†ç»„ä¸åµŒå¥—)
6. [è¿æ¥å‚æ•°é…ç½®](#6-è¿æ¥å‚æ•°é…ç½®)
7. [å®é™…åº”ç”¨åœºæ™¯](#7-å®é™…åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯ä¸»æœºæ¸…å•


### 1.1 æ ¸å¿ƒæ¦‚å¿µç†è§£


**ğŸ”¸ ä¸»æœºæ¸…å•å®šä¹‰**
```
ä¸»æœºæ¸…å•ï¼ˆInventoryï¼‰= å‘Šè¯‰Ansibleè¦ç®¡ç†å“ªäº›æœåŠ¡å™¨çš„"èŠ±åå†Œ"

ç®€å•ç†è§£ï¼š
å°±åƒç­çº§èŠ±åå†Œè®°å½•å­¦ç”Ÿä¿¡æ¯ä¸€æ ·
Ansibleçš„inventoryè®°å½•è¦ç®¡ç†çš„æœåŠ¡å™¨ä¿¡æ¯
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ä¸»æœºæ¸…å•**
```
é—®é¢˜ï¼šAnsibleæ€ä¹ˆçŸ¥é“è¦ç®¡ç†å“ªäº›æœåŠ¡å™¨ï¼Ÿ
ç­”æ¡ˆï¼šé€šè¿‡inventoryæ–‡ä»¶å‘Šè¯‰å®ƒ

ç±»æ¯”ç†è§£ï¼š
å¿«é€’å‘˜ â†’ Ansible
åœ°å€ç°¿ â†’ Inventory
æ”¶ä»¶äºº â†’ ç›®æ ‡æœåŠ¡å™¨
```

### 1.2 æ¸…å•çš„åŸºæœ¬ä½œç”¨


**ğŸ¯ ä¸»è¦åŠŸèƒ½**
- **ğŸ“‹ æœåŠ¡å™¨ç™»è®°**ï¼šè®°å½•è¦ç®¡ç†çš„æ‰€æœ‰æœåŠ¡å™¨
- **ğŸ·ï¸ åˆ†ç»„ç®¡ç†**ï¼šå°†æœåŠ¡å™¨æŒ‰ç”¨é€”åˆ†ç»„ï¼ˆå¦‚webæœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ï¼‰
- **ğŸ”— è¿æ¥ä¿¡æ¯**ï¼šå­˜å‚¨è¿æ¥æœåŠ¡å™¨éœ€è¦çš„å‚æ•°
- **ğŸ“ å˜é‡å®šä¹‰**ï¼šä¸ºä¸åŒä¸»æœºæˆ–ç»„å®šä¹‰ä¸“å±å˜é‡

```
å®é™…åœºæ™¯ä¸¾ä¾‹ï¼š
å…¬å¸æœ‰20å°æœåŠ¡å™¨ï¼š
- 5å°WebæœåŠ¡å™¨
- 3å°æ•°æ®åº“æœåŠ¡å™¨  
- 2å°ç¼“å­˜æœåŠ¡å™¨
- 10å°åº”ç”¨æœåŠ¡å™¨

inventoryå¸®ä½ åˆ†ç»„ç®¡ç†ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸ªè®°ä½IPåœ°å€
```

---

## 2. ğŸ“ é™æ€æ¸…å•æ–‡ä»¶ä½ç½®


### 2.1 é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„


**ğŸ”¸ ç³»ç»Ÿé»˜è®¤ä½ç½®**
```bash
/etc/ansible/hosts
```

> **ğŸ’¡ ç†è§£è¯´æ˜**ï¼šè¿™æ˜¯Ansibleå®‰è£…åçš„é»˜è®¤ä¸»æœºæ¸…å•æ–‡ä»¶ï¼Œå°±åƒç³»ç»Ÿé€šè®¯å½•ä¸€æ ·

### 2.2 è‡ªå®šä¹‰æ¸…å•æ–‡ä»¶


**ğŸ¯ ä½¿ç”¨è‡ªå®šä¹‰æ–‡ä»¶çš„ä¼˜åŠ¿**
```
ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ï¼š
âœ… é¡¹ç›®éš”ç¦»ï¼šä¸åŒé¡¹ç›®ç”¨ä¸åŒçš„inventory
âœ… æƒé™æ§åˆ¶ï¼šé¿å…ä¿®æ”¹ç³»ç»Ÿçº§é…ç½®
âœ… ç‰ˆæœ¬ç®¡ç†ï¼šå¯ä»¥æ”¾åˆ°Gitä¸­ç®¡ç†
âœ… çµæ´»éƒ¨ç½²ï¼šæ”¯æŒå¤šç¯å¢ƒé…ç½®
```

**ğŸ”§ æŒ‡å®šè‡ªå®šä¹‰æ¸…å•æ–‡ä»¶**
```bash
# æ–¹æ³•1ï¼šå‘½ä»¤è¡ŒæŒ‡å®š
ansible -i /path/to/my_inventory all --list-hosts

# æ–¹æ³•2ï¼šé…ç½®æ–‡ä»¶æŒ‡å®šï¼ˆansible.cfgï¼‰
[defaults]
inventory = ./inventory/hosts

# æ–¹æ³•3ï¼šç¯å¢ƒå˜é‡
export ANSIBLE_INVENTORY=/path/to/my_inventory
```

### 2.3 æ–‡ä»¶æƒé™è®¾ç½®


**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```bash
# è®¾ç½®åˆé€‚çš„æ–‡ä»¶æƒé™
chmod 600 /path/to/inventory  # ä»…æ‰€æœ‰è€…å¯è¯»å†™
chown ansible:ansible /path/to/inventory  # è®¾ç½®åˆé€‚çš„æ‰€æœ‰è€…
```

---

## 3. ğŸ“ INIæ ¼å¼è¯­æ³•è¯¦è§£


### 3.1 åŸºæœ¬è¯­æ³•ç»“æ„


**ğŸ”¸ INIæ ¼å¼ç‰¹ç‚¹**
```
INIæ ¼å¼å°±åƒWindowsçš„é…ç½®æ–‡ä»¶ï¼š
- ç®€å•æ˜“è¯»
- ç”¨[]å®šä¹‰ç»„å
- ç”¨=å·å®šä¹‰å˜é‡
- ç”¨#å·å†™æ³¨é‡Š
```

### 3.2 æœ€ç®€å•çš„ä¸»æœºå®šä¹‰


```ini
# æœ€åŸºæœ¬çš„ä¸»æœºå®šä¹‰
192.168.1.10
192.168.1.11
web.example.com

# æ·»åŠ æ³¨é‡Šè¯´æ˜
192.168.1.20  # è¿™æ˜¯æ•°æ®åº“æœåŠ¡å™¨
```

**ğŸ’¡ ç†è§£è¦ç‚¹**ï¼š
- æ¯è¡Œä¸€ä¸ªä¸»æœº
- å¯ä»¥æ˜¯IPåœ°å€æˆ–åŸŸå
- `#`å¼€å¤´çš„æ˜¯æ³¨é‡Šï¼ŒAnsibleä¼šå¿½ç•¥

### 3.3 ä¸»æœºåˆ«åè®¾ç½®


**ğŸ·ï¸ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ«å**
```
é—®é¢˜ï¼šIPåœ°å€ä¸å¥½è®°å¿†ï¼Œ192.168.1.10æ˜¯ä»€ä¹ˆæœåŠ¡å™¨ï¼Ÿ
è§£å†³ï¼šç»™ä¸»æœºèµ·ä¸ªå®¹æ˜“ç†è§£çš„åå­—

åˆ«åçš„å¥½å¤„ï¼š
âœ… ä¾¿äºè®°å¿†å’Œç†è§£
âœ… é…ç½®æ–‡ä»¶æ›´æ˜“è¯»
âœ… ä¾¿äºå›¢é˜Ÿåä½œ
```

```ini
# ä¸»æœºåˆ«åè¯­æ³•ï¼šåˆ«å ansible_host=çœŸå®åœ°å€
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11
db1 ansible_host=192.168.1.20
cache1 ansible_host=redis.example.com

# ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥ç”¨åˆ«å
# ansible web1 -m ping
```

### 3.4 ç«¯å£æŒ‡å®š


```ini
# æŒ‡å®šSSHè¿æ¥ç«¯å£
web1 ansible_host=192.168.1.10 ansible_port=2222
web2 ansible_host=192.168.1.11:2222  # ç®€å†™æ–¹å¼

# åŸŸååŠ ç«¯å£
api.example.com:8022
```

### 3.5 èŒƒå›´è¡¨è¾¾å¼


**ğŸ”¢ æ‰¹é‡å®šä¹‰ä¸»æœºçš„æŠ€å·§**

```ini
# æ•°å­—èŒƒå›´
web[1:5].example.com  # ç­‰åŒäºï¼š
# web1.example.com
# web2.example.com  
# web3.example.com
# web4.example.com
# web5.example.com

# IPåœ°å€èŒƒå›´
192.168.1.[10:15]  # ç­‰åŒäºï¼š
# 192.168.1.10
# 192.168.1.11
# 192.168.1.12
# 192.168.1.13
# 192.168.1.14
# 192.168.1.15

# å­—æ¯èŒƒå›´
db[a:c].example.com  # ç­‰åŒäºï¼š
# dba.example.com
# dbb.example.com
# dbc.example.com
```

**ğŸ’¡ å®ç”¨æŠ€å·§**ï¼šèŒƒå›´è¡¨è¾¾å¼ç‰¹åˆ«é€‚åˆæ‰¹é‡éƒ¨ç½²ç›¸ä¼¼é…ç½®çš„æœåŠ¡å™¨

### 3.6 ä¸»æœºåˆ†ç»„


**ğŸ—ï¸ åˆ†ç»„çš„åŸºæœ¬è¯­æ³•**

```ini
# åŸºæœ¬åˆ†ç»„è¯­æ³•
[ç»„å]
ä¸»æœº1
ä¸»æœº2

# å®Œæ•´ç¤ºä¾‹
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11
nginx.example.com

[databases]  
db1 ansible_host=192.168.1.20
mysql.example.com ansible_port=3306

[cache]
redis1 ansible_host=192.168.1.30
redis2 ansible_host=192.168.1.31
```

**ğŸ¯ åˆ†ç»„çš„å®é™…æ„ä¹‰**ï¼š
- æ‰¹é‡æ“ä½œï¼š`ansible webservers -m service -a "name=nginx state=restarted"`
- ç»Ÿä¸€é…ç½®ï¼šç»™åŒç±»æœåŠ¡å™¨åº”ç”¨ç›¸åŒçš„é…ç½®
- é€»è¾‘ç®¡ç†ï¼šæŒ‰ä¸šåŠ¡é€»è¾‘ç»„ç»‡æœåŠ¡å™¨

### 3.7 åµŒå¥—ç»„ï¼ˆç»„çš„ç»„ï¼‰


```ini
# å®šä¹‰åŸºç¡€ç»„
[webservers]
web1 ansible_host=192.168.1.10
web2 ansible_host=192.168.1.11

[databases]
db1 ansible_host=192.168.1.20

# å®šä¹‰çˆ¶ç»„ï¼ŒåŒ…å«å­ç»„
[production:children]  # :childrenè¡¨ç¤ºè¿™æ˜¯ç»„çš„ç»„
webservers
databases

[staging:children]
staging_web
staging_db
```

**ğŸ’¡ åµŒå¥—ç»„çš„å®é™…åº”ç”¨**ï¼š
```bash
# åŒæ—¶æ“ä½œç”Ÿäº§ç¯å¢ƒçš„æ‰€æœ‰æœåŠ¡å™¨
ansible production -m ping

# è¿™ä¼šåŒ…æ‹¬webserverså’Œdatabasesç»„çš„æ‰€æœ‰ä¸»æœº
```

### 3.8 ç»„å˜é‡å’Œä¸»æœºå˜é‡


```ini
[webservers]
web1 ansible_host=192.168.1.10 http_port=8080
web2 ansible_host=192.168.1.11 http_port=8081

# ç»„å˜é‡ - å¯¹æ•´ä¸ªç»„ç”Ÿæ•ˆ
[webservers:vars]
nginx_version=1.18
ssl_enabled=true
environment=production
```

---

## 4. ğŸ“„ YAMLæ ¼å¼è¯­æ³•è¯¦è§£


### 4.1 YAMLæ ¼å¼ç‰¹ç‚¹


**ğŸ”¸ YAML vs INI å¯¹æ¯”**

```
INIæ ¼å¼ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆç®€å•é…ç½®
YAMLæ ¼å¼ï¼šç»“æ„æ¸…æ™°ï¼Œé€‚åˆå¤æ‚é…ç½®

é€‰æ‹©åŸåˆ™ï¼š
- ç®€å•ç¯å¢ƒ â†’ INIæ ¼å¼
- å¤æ‚é…ç½® â†’ YAMLæ ¼å¼
```

### 4.2 åŸºæœ¬YAMLè¯­æ³•


```yaml
# YAMLæ ¼å¼çš„inventoryæ–‡ä»¶
all:  # æ ¹ç»„ï¼ŒåŒ…å«æ‰€æœ‰ä¸»æœº
  hosts:  # ç›´æ¥å®šä¹‰çš„ä¸»æœº
    web1:
      ansible_host: 192.168.1.10
      ansible_port: 22
    web2:
      ansible_host: 192.168.1.11
  
  children:  # å­ç»„å®šä¹‰
    webservers:
      hosts:
        web1:
        web2:
      vars:  # ç»„å˜é‡
        nginx_version: "1.18"
        ssl_enabled: true
    
    databases:
      hosts:
        db1:
          ansible_host: 192.168.1.20
          mysql_port: 3306
```

### 4.3 YAMLè¯­æ³•è¦ç‚¹


**âš ï¸ YAMLæ ¼å¼æ³¨æ„äº‹é¡¹**
- **ç¼©è¿›æ•æ„Ÿ**ï¼šå¿…é¡»ä½¿ç”¨ç©ºæ ¼ï¼Œä¸èƒ½ç”¨Tabé”®
- **å†’å·åé¢**ï¼šå¿…é¡»æœ‰ç©ºæ ¼
- **åˆ—è¡¨é¡¹**ï¼šç”¨`-`å¼€å¤´
- **å¼•å·ä½¿ç”¨**ï¼šå­—ç¬¦ä¸²å»ºè®®åŠ å¼•å·

### 4.4 å¤æ‚YAMLç¤ºä¾‹


```yaml
all:
  children:
    production:
      children:
        webservers:
          hosts:
            web[1:3]:  # æ”¯æŒèŒƒå›´è¡¨è¾¾å¼
              ansible_host: 192.168.1.[10:12]
          vars:
            nginx_worker_processes: 4
            ssl_certificate: "/etc/ssl/prod.crt"
        
        databases:
          hosts:
            db-master:
              ansible_host: 192.168.1.20
              mysql_role: master
            db-slave:
              ansible_host: 192.168.1.21  
              mysql_role: slave
          vars:
            mysql_version: "8.0"
    
    staging:
      hosts:
        staging-web:
          ansible_host: 192.168.2.10
      vars:
        environment: staging
        debug_mode: true
```

---

## 5. ğŸ—ï¸ ä¸»æœºåˆ†ç»„ä¸åµŒå¥—


### 5.1 åˆ†ç»„ç­–ç•¥


**ğŸ¯ å¸¸è§åˆ†ç»„æ–¹å¼**

| åˆ†ç»„æ–¹å¼ | ç¤ºä¾‹ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| **æŒ‰åŠŸèƒ½** | `webservers`, `databases` | æœåŠ¡ç±»å‹ä¸åŒ |
| **æŒ‰ç¯å¢ƒ** | `production`, `staging` | éƒ¨ç½²ç¯å¢ƒéš”ç¦» |
| **æŒ‰åœ°ç†ä½ç½®** | `beijing`, `shanghai` | å¤šæœºæˆ¿éƒ¨ç½² |
| **æŒ‰ä¸šåŠ¡** | `frontend`, `backend` | ä¸šåŠ¡é€»è¾‘åˆ’åˆ† |

### 5.2 å®é™…åˆ†ç»„ç¤ºä¾‹


```ini
# æŒ‰åŠŸèƒ½å’Œç¯å¢ƒçš„åŒé‡åˆ†ç»„
[prod-web]
prod-web1 ansible_host=192.168.1.10
prod-web2 ansible_host=192.168.1.11

[prod-db]  
prod-db1 ansible_host=192.168.1.20

[staging-web]
staging-web1 ansible_host=192.168.2.10

[staging-db]
staging-db1 ansible_host=192.168.2.20

# ç¯å¢ƒåˆ†ç»„
[production:children]
prod-web  
prod-db

[staging:children]
staging-web
staging-db

# åŠŸèƒ½åˆ†ç»„
[webservers:children]
prod-web
staging-web

[databases:children]
prod-db
staging-db
```

### 5.3 åµŒå¥—ç»„çš„å±‚æ¬¡ç»“æ„


```
ç»„ç»‡æ¶æ„å›¾ç¤ºï¼š
all (æ‰€æœ‰ä¸»æœº)
â”œâ”€â”€ production (ç”Ÿäº§ç¯å¢ƒ)
â”‚   â”œâ”€â”€ prod-web (ç”Ÿäº§WebæœåŠ¡å™¨)
â”‚   â”‚   â”œâ”€â”€ prod-web1
â”‚   â”‚   â””â”€â”€ prod-web2
â”‚   â””â”€â”€ prod-db (ç”Ÿäº§æ•°æ®åº“)
â”‚       â””â”€â”€ prod-db1
â””â”€â”€ staging (æµ‹è¯•ç¯å¢ƒ)
    â”œâ”€â”€ staging-web
    â””â”€â”€ staging-db
```

---

## 6. ğŸ”— è¿æ¥å‚æ•°é…ç½®


### 6.1 å¸¸ç”¨è¿æ¥å‚æ•°


**ğŸ“‹ ä¸»è¦è¿æ¥å‚æ•°åˆ—è¡¨**

| å‚æ•°å | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|
| `ansible_host` | ç›®æ ‡ä¸»æœºIPæˆ–åŸŸå | `ansible_host=192.168.1.10` |
| `ansible_port` | SSHè¿æ¥ç«¯å£ | `ansible_port=2222` |
| `ansible_user` | SSHç™»å½•ç”¨æˆ· | `ansible_user=deploy` |
| `ansible_ssh_private_key_file` | SSHç§é’¥æ–‡ä»¶è·¯å¾„ | `ansible_ssh_private_key_file=/path/to/key` |
| `ansible_ssh_pass` | SSHå¯†ç  | `ansible_ssh_pass=password` |
| `ansible_become` | æ˜¯å¦ææƒ | `ansible_become=true` |
| `ansible_become_method` | ææƒæ–¹å¼ | `ansible_become_method=sudo` |
| `ansible_python_interpreter` | Pythonè§£é‡Šå™¨è·¯å¾„ | `ansible_python_interpreter=/usr/bin/python3` |

### 6.2 SSHå¯†é’¥è®¤è¯é…ç½®


```ini
[webservers]
# ä½¿ç”¨SSHå¯†é’¥è®¤è¯
web1 ansible_host=192.168.1.10 ansible_user=deploy ansible_ssh_private_key_file=~/.ssh/id_rsa

# æŒ‡å®šä¸åŒçš„å¯†é’¥æ–‡ä»¶
web2 ansible_host=192.168.1.11 ansible_user=admin ansible_ssh_private_key_file=/path/to/special_key
```

### 6.3 å¯†ç è®¤è¯é…ç½®


```ini
[databases]
# ä½¿ç”¨å¯†ç è®¤è¯ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰
db1 ansible_host=192.168.1.20 ansible_user=root ansible_ssh_pass=mypassword

# ç»„å˜é‡æ–¹å¼è®¾ç½®ç»Ÿä¸€å¯†ç 
[databases:vars]
ansible_user=dbadmin
ansible_ssh_pass=dbpassword
```

**âš ï¸ å®‰å…¨æé†’**ï¼š
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨SSHå¯†é’¥
- å¯†ç å†™åœ¨é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨å®‰å…¨é£é™©
- å¯ä»¥ä½¿ç”¨Ansible VaultåŠ å¯†æ•æ„Ÿä¿¡æ¯

### 6.4 ææƒé…ç½®


```ini
[webservers]
# æ™®é€šç”¨æˆ·ç™»å½•ï¼Œéœ€è¦sudoææƒ
web1 ansible_host=192.168.1.10 ansible_user=deploy ansible_become=true ansible_become_method=sudo

# ç»„çº§åˆ«ææƒé…ç½®
[webservers:vars]
ansible_become=true
ansible_become_method=sudo
ansible_become_user=root
```

### 6.5 Pythonè§£é‡Šå™¨é…ç½®


```ini
# é’ˆå¯¹ä¸åŒæ“ä½œç³»ç»ŸæŒ‡å®šPythonè·¯å¾„
[centos-servers]
centos1 ansible_host=192.168.1.30 ansible_python_interpreter=/usr/bin/python

[ubuntu-servers]  
ubuntu1 ansible_host=192.168.1.40 ansible_python_interpreter=/usr/bin/python3
```

---

## 7. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 7.1 å°å‹ç½‘ç«™éƒ¨ç½²


```ini
# å°å‹ç½‘ç«™çš„ç®€å•é…ç½®
[webservers]
web ansible_host=192.168.1.10 ansible_user=www

[databases]
db ansible_host=192.168.1.20 ansible_user=mysql

[all:vars]
ansible_ssh_private_key_file=~/.ssh/website_key
```

### 7.2 å¤šç¯å¢ƒç®¡ç†


```
é¡¹ç›®ç»“æ„ï¼š
project/
â”œâ”€â”€ inventories/
â”‚   â”œâ”€â”€ production/
â”‚   â”‚   â””â”€â”€ hosts
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â””â”€â”€ hosts
â”‚   â””â”€â”€ development/
â”‚       â””â”€â”€ hosts
â””â”€â”€ playbooks/
```

```ini
# inventories/production/hosts
[webservers]
prod-web[1:3] ansible_host=10.0.1.[10:12]

# inventories/staging/hosts  
[webservers]
staging-web ansible_host=192.168.1.10
```

**ğŸ”§ ä½¿ç”¨æ–¹å¼**ï¼š
```bash
# éƒ¨ç½²åˆ°ä¸åŒç¯å¢ƒ
ansible-playbook -i inventories/production/hosts site.yml
ansible-playbook -i inventories/staging/hosts site.yml
```

### 7.3 å¤§å‹é›†ç¾¤ç®¡ç†


```yaml
# å¤§å‹é›†ç¾¤çš„YAMLé…ç½®ç¤ºä¾‹
all:
  children:
    datacenter_beijing:
      children:
        beijing_webservers:
          hosts:
            bj-web[01:10]:
              ansible_host: 10.1.1.[10:19]
        beijing_databases:
          hosts:
            bj-db[01:03]:
              ansible_host: 10.1.1.[20:22]
          vars:
            mysql_cluster_id: beijing
    
    datacenter_shanghai:
      children:
        shanghai_webservers:
          hosts:
            sh-web[01:10]:
              ansible_host: 10.2.1.[10:19]
        shanghai_databases:
          hosts:
            sh-db[01:03]:
              ansible_host: 10.2.1.[20:22]
          vars:
            mysql_cluster_id: shanghai
```

### 7.4 æ··åˆäº‘ç¯å¢ƒ


```ini
# æ··åˆäº‘éƒ¨ç½²é…ç½®
[aws_webservers]
aws-web1 ansible_host=ec2-xxx.amazonaws.com ansible_user=ec2-user
aws-web2 ansible_host=ec2-yyy.amazonaws.com ansible_user=ec2-user

[aliyun_webservers]
ali-web1 ansible_host=ecs-xxx.aliyuncs.com ansible_user=root
ali-web2 ansible_host=ecs-yyy.aliyuncs.com ansible_user=root

[local_webservers]
local-web1 ansible_host=192.168.1.10 ansible_user=deploy

# äº‘å‚å•†åˆ†ç»„
[cloud:children]
aws_webservers
aliyun_webservers

[onpremise:children]
local_webservers

# ç»Ÿä¸€WebæœåŠ¡å™¨ç»„
[all_webservers:children]
cloud
onpremise
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ä¸»æœºæ¸…å•æœ¬è´¨ï¼šAnsibleç®¡ç†æœåŠ¡å™¨çš„"é€šè®¯å½•"
ğŸ”¸ æ–‡ä»¶ä½ç½®ï¼šé»˜è®¤/etc/ansible/hostsï¼Œæ”¯æŒè‡ªå®šä¹‰è·¯å¾„
ğŸ”¸ ä¸¤ç§æ ¼å¼ï¼šINIæ ¼å¼ç®€å•ç›´è§‚ï¼ŒYAMLæ ¼å¼åŠŸèƒ½å¼ºå¤§
ğŸ”¸ ä¸»æœºå®šä¹‰ï¼šæ”¯æŒIPã€åŸŸåã€åˆ«åã€ç«¯å£ã€èŒƒå›´è¡¨è¾¾å¼
ğŸ”¸ åˆ†ç»„ç®¡ç†ï¼šæŒ‰åŠŸèƒ½ã€ç¯å¢ƒã€åœ°ç†ä½ç½®ç­‰ç»´åº¦åˆ†ç»„
ğŸ”¸ è¿æ¥å‚æ•°ï¼šé…ç½®SSHè¿æ¥ã€è®¤è¯ã€ææƒç­‰ä¿¡æ¯
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é€‰æ‹©åˆé€‚çš„æ ¼å¼**
```
ç®€å•ç¯å¢ƒï¼š
âœ… INIæ ¼å¼ï¼šè¯­æ³•ç®€å•ï¼Œé…ç½®ç›´è§‚
âœ… é€‚åˆå°å‹é¡¹ç›®å’Œå¿«é€Ÿæ­å»º

å¤æ‚ç¯å¢ƒï¼š
âœ… YAMLæ ¼å¼ï¼šç»“æ„æ¸…æ™°ï¼Œæ”¯æŒå¤æ‚é…ç½®
âœ… é€‚åˆå¤§å‹é¡¹ç›®å’Œå¤šç¯å¢ƒç®¡ç†
```

**ğŸ”¹ åˆ†ç»„çš„å®é™…æ„ä¹‰**
```
ä¸åˆ†ç»„çš„é—®é¢˜ï¼š
âŒ æ— æ³•æ‰¹é‡æ“ä½œ
âŒ é…ç½®ç®¡ç†æ··ä¹±
âŒ éš¾ä»¥åŒºåˆ†ç¯å¢ƒ

åˆ†ç»„çš„å¥½å¤„ï¼š
âœ… æ‰¹é‡æ“ä½œï¼šansible webservers -m ping
âœ… ç¯å¢ƒéš”ç¦»ï¼šproduction vs staging
âœ… é…ç½®ç»§æ‰¿ï¼šç»„å˜é‡ç»Ÿä¸€ç®¡ç†
```

**ğŸ”¹ å®‰å…¨é…ç½®æœ€ä½³å®è·µ**
```
æ¨èåšæ³•ï¼š
âœ… ä½¿ç”¨SSHå¯†é’¥è®¤è¯
âœ… ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„inventory
âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨Ansible VaultåŠ å¯†
âœ… è®¾ç½®åˆé€‚çš„æ–‡ä»¶æƒé™

é¿å…åšæ³•ï¼š
âŒ æ˜æ–‡å­˜å‚¨å¯†ç 
âŒ ä½¿ç”¨rootç”¨æˆ·ç›´æ¥è¿æ¥
âŒ æ··åˆä¸åŒç¯å¢ƒçš„é…ç½®
```

### 8.3 å®ç”¨æ“ä½œæŠ€å·§


**ğŸ”§ éªŒè¯é…ç½®æ­£ç¡®æ€§**
```bash
# åˆ—å‡ºæ‰€æœ‰ä¸»æœº
ansible all --list-hosts -i inventory_file

# åˆ—å‡ºæŒ‡å®šç»„çš„ä¸»æœº
ansible webservers --list-hosts -i inventory_file

# æµ‹è¯•è¿æ¥æ€§
ansible all -m ping -i inventory_file

# æŸ¥çœ‹ä¸»æœºå˜é‡
ansible-inventory --list -i inventory_file
```

**ğŸ“ å¸¸ç”¨å‘½ä»¤æ¨¡æ¿**
```bash
# æŒ‡å®šinventoryæ–‡ä»¶æ‰§è¡Œä»»åŠ¡
ansible-playbook -i inventories/production/hosts site.yml

# åªå¯¹ç‰¹å®šç»„æ‰§è¡Œ
ansible-playbook -i inventory_file site.yml --limit webservers

# æ’é™¤ç‰¹å®šä¸»æœº
ansible-playbook -i inventory_file site.yml --limit 'all:!databases'
```

### 8.4 æ•…éšœæ’é™¤æŒ‡å—


**ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| ä¸»æœºè¿æ¥å¤±è´¥ | SSHé…ç½®é”™è¯¯ | æ£€æŸ¥`ansible_host`ã€`ansible_port`ã€`ansible_user` |
| æƒé™ä¸è¶³ | ææƒé…ç½®ç¼ºå¤± | æ·»åŠ `ansible_become=true` |
| Pythoné”™è¯¯ | Pythonè·¯å¾„ä¸æ­£ç¡® | è®¾ç½®`ansible_python_interpreter` |
| è¯­æ³•é”™è¯¯ | YAMLæ ¼å¼é—®é¢˜ | æ£€æŸ¥ç¼©è¿›å’Œè¯­æ³• |
| ä¸»æœºä¸åœ¨ç»„ä¸­ | åˆ†ç»„é…ç½®é”™è¯¯ | éªŒè¯ç»„å®šä¹‰å’ŒåµŒå¥—å…³ç³» |

### 8.5 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å†…å®¹**
- **åŠ¨æ€inventory**ï¼šä»äº‘å¹³å°APIåŠ¨æ€è·å–ä¸»æœºä¿¡æ¯
- **Ansible Vault**ï¼šåŠ å¯†æ•æ„Ÿé…ç½®ä¿¡æ¯
- **å˜é‡ä¼˜å…ˆçº§**ï¼šç†è§£ä¸åŒçº§åˆ«å˜é‡çš„ä¼˜å…ˆçº§
- **æ¡ä»¶åˆ¤æ–­**ï¼šæ ¹æ®ä¸»æœºå±æ€§æ‰§è¡Œä¸åŒä»»åŠ¡
- **è§’è‰²(Roles)**ï¼šæ›´é«˜çº§çš„ä»£ç ç»„ç»‡æ–¹å¼

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ¸…å•æ–‡ä»¶æ˜¯åŸºç¡€ï¼Œåˆ†ç»„ç®¡ç†æœ‰ç­–ç•¥
- è¿æ¥å‚æ•°é…ç½®å¥½ï¼Œå®‰å…¨è®¤è¯ä¸èƒ½å°‘
- INIç®€å•YAMLå¼ºï¼Œé€‰æ‹©æ ¼å¼çœ‹éœ€è¦
- æµ‹è¯•éªŒè¯è¦åšå¥½ï¼Œæ•…éšœæ’æŸ¥æœ‰æ–¹æ³•