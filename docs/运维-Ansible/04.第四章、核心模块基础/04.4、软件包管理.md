---
title: 4ã€è½¯ä»¶åŒ…ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [è½¯ä»¶åŒ…ç®¡ç†æ¦‚è¿°](#1-è½¯ä»¶åŒ…ç®¡ç†æ¦‚è¿°)
2. [ç³»ç»ŸåŒ…ç®¡ç†å™¨æ¨¡å—](#2-ç³»ç»ŸåŒ…ç®¡ç†å™¨æ¨¡å—)
3. [è¯­è¨€åŒ…ç®¡ç†å™¨æ¨¡å—](#3-è¯­è¨€åŒ…ç®¡ç†å™¨æ¨¡å—)
4. [é€šç”¨åŒ…ç®¡ç†æ¨¡å—](#4-é€šç”¨åŒ…ç®¡ç†æ¨¡å—)
5. [ä»“åº“é…ç½®ä¸å®‰å…¨](#5-ä»“åº“é…ç½®ä¸å®‰å…¨)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¦ è½¯ä»¶åŒ…ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è½¯ä»¶åŒ…ç®¡ç†


**ç®€å•ç†è§£**ï¼šè½¯ä»¶åŒ…ç®¡ç†å°±æ˜¯ç”¨è‡ªåŠ¨åŒ–çš„æ–¹å¼åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ã€æ›´æ–°ã€å¸è½½è½¯ä»¶ï¼Œè€Œä¸ç”¨æ‰‹åŠ¨ä¸€å°å°å»æ“ä½œã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
æœåŠ¡å™¨A: sshç™»å½• â†’ yum install nginx â†’ é…ç½®
æœåŠ¡å™¨B: sshç™»å½• â†’ yum install nginx â†’ é…ç½®  
æœåŠ¡å™¨C: sshç™»å½• â†’ yum install nginx â†’ é…ç½®

Ansibleæ–¹å¼ï¼š
ä¸€æ¡å‘½ä»¤ â†’ 100å°æœåŠ¡å™¨åŒæ—¶å®‰è£…nginx â†’ ç»Ÿä¸€é…ç½®
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **æ‰¹é‡æ“ä½œ**ï¼šä¸€æ¬¡æ“ä½œå½±å“å¤šå°æœåŠ¡å™¨
- **çŠ¶æ€ç®¡ç†**ï¼šç¡®ä¿è½¯ä»¶åŒ…å¤„äºæœŸæœ›çŠ¶æ€
- **ä¾èµ–å¤„ç†**ï¼šè‡ªåŠ¨è§£å†³è½¯ä»¶ä¾èµ–å…³ç³»
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶è½¯ä»¶ç‰ˆæœ¬

### 1.2 AnsibleåŒ…ç®¡ç†çš„ä¼˜åŠ¿


**å¯¹æ¯”æ‰‹åŠ¨ç®¡ç†**ï¼š
```
æ‰‹åŠ¨æ–¹å¼çš„ç—›ç‚¹ï¼š
Ã— é‡å¤åŠ³åŠ¨ï¼šæ¯å°æœåŠ¡å™¨éƒ½è¦æ‰‹åŠ¨æ“ä½œ
Ã— å®¹æ˜“å‡ºé”™ï¼šå‘½ä»¤æ•²é”™ã€æ­¥éª¤é—æ¼
Ã— éš¾ä»¥è·Ÿè¸ªï¼šä¸çŸ¥é“å“ªå°è£…äº†ä»€ä¹ˆç‰ˆæœ¬
Ã— æ—¶é—´æ¶ˆè€—ï¼š100å°æœåŠ¡å™¨éœ€è¦å¾ˆé•¿æ—¶é—´

Ansibleçš„ä¼˜åŠ¿ï¼š
âœ“ æ‰¹é‡æ‰§è¡Œï¼šä¸€æ¬¡å‘½ä»¤ç®¡ç†æ‰€æœ‰æœåŠ¡å™¨
âœ“ å¹‚ç­‰æ€§ï¼šå¤šæ¬¡æ‰§è¡Œç»“æœä¸€è‡´ï¼Œä¸ä¼šé‡å¤å®‰è£…
âœ“ çŠ¶æ€è·Ÿè¸ªï¼šæ¸…æ¥šçŸ¥é“æ¯å°æœåŠ¡å™¨çš„è½¯ä»¶çŠ¶æ€
âœ“ é”™è¯¯å¤„ç†ï¼šå¤±è´¥æ—¶è‡ªåŠ¨å›æ»šæˆ–æŠ¥å‘Š
```

### 1.3 åŒ…ç®¡ç†æ¨¡å—åˆ†ç±»


**æŒ‰æ“ä½œç³»ç»Ÿåˆ†ç±»**ï¼š
- **RedHatç³»åˆ—**ï¼š`yum`æ¨¡å—ï¼ˆCentOS 7ï¼‰ã€`dnf`æ¨¡å—ï¼ˆCentOS 8+/Fedoraï¼‰
- **Debianç³»åˆ—**ï¼š`apt`æ¨¡å—ï¼ˆUbuntu/Debianï¼‰
- **SUSEç³»åˆ—**ï¼š`zypper`æ¨¡å—ï¼ˆSUSE/openSUSEï¼‰

**æŒ‰ç¼–ç¨‹è¯­è¨€åˆ†ç±»**ï¼š
- **PythonåŒ…**ï¼š`pip`æ¨¡å—
- **Node.jsåŒ…**ï¼š`npm`æ¨¡å—  
- **RubyåŒ…**ï¼š`gem`æ¨¡å—
- **JavaåŒ…**ï¼šé€šè¿‡ä¸‹è½½æˆ–ä»“åº“å®‰è£…

**é€šç”¨æ¨¡å—**ï¼š
- **packageæ¨¡å—**ï¼šè‡ªåŠ¨è¯†åˆ«æ“ä½œç³»ç»Ÿï¼Œé€‰æ‹©åˆé€‚çš„åŒ…ç®¡ç†å™¨

---

## 2. ğŸ”§ ç³»ç»ŸåŒ…ç®¡ç†å™¨æ¨¡å—


### 2.1 yumæ¨¡å— - RedHat/CentOSç³»ç»Ÿ


**åŸºæœ¬æ¦‚å¿µ**ï¼š`yum`æ˜¯RedHatç³»åˆ—ç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨ï¼Œ`yum`æ¨¡å—è®©Ansibleèƒ½å¤Ÿæ§åˆ¶è½¯ä»¶åŒ…çš„å®‰è£…ã€æ›´æ–°ã€å¸è½½ã€‚

#### ğŸ”¸ åŸºç¡€æ“ä½œè¯­æ³•


```yaml
# å®‰è£…å•ä¸ªè½¯ä»¶åŒ…
- name: å®‰è£…nginx
  yum:
    name: nginx
    state: present

# å®‰è£…å¤šä¸ªè½¯ä»¶åŒ…
- name: å®‰è£…å¼€å‘å·¥å…·
  yum:
    name:
      - gcc
      - make
      - git
    state: present

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
- name: å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„docker
  yum:
    name: docker-ce-20.10.17
    state: present
```

#### ğŸ”¸ çŠ¶æ€å‚æ•°è¯¦è§£


| çŠ¶æ€å€¼ | **å«ä¹‰** | **æ“ä½œç»“æœ** |
|--------|----------|-------------|
| `present` | **å­˜åœ¨** | `è½¯ä»¶åŒ…å¿…é¡»å®‰è£…ï¼ˆé»˜è®¤æœ€æ–°ç‰ˆæœ¬ï¼‰` |
| `absent` | **ä¸å­˜åœ¨** | `è½¯ä»¶åŒ…å¿…é¡»å¸è½½` |
| `latest` | **æœ€æ–°ç‰ˆ** | `å®‰è£…å¹¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬` |
| `installed` | **å·²å®‰è£…** | `ç­‰åŒäºpresent` |
| `removed` | **å·²ç§»é™¤** | `ç­‰åŒäºabsent` |

#### ğŸ”¸ å®ç”¨å‚æ•°é€‰é¡¹


```yaml
# å¯ç”¨æŒ‡å®šä»“åº“å®‰è£…
- name: ä»EPELä»“åº“å®‰è£…htop
  yum:
    name: htop
    state: present
    enablerepo: epel

# ç¦ç”¨ä»“åº“å¹¶å®‰è£…
- name: ç¦ç”¨æŸäº›ä»“åº“å®‰è£…è½¯ä»¶
  yum:
    name: mysql
    state: present
    disablerepo: "mysql*"
    
# å®‰è£…æœ¬åœ°rpmåŒ…
- name: å®‰è£…æœ¬åœ°rpmåŒ…
  yum:
    name: /tmp/custom-app-1.0.rpm
    state: present

# æ‰¹é‡æ“ä½œæ—¶è·³è¿‡é”™è¯¯
- name: æ‰¹é‡å®‰è£…ï¼Œè·³è¿‡å¤±è´¥çš„åŒ…
  yum:
    name: "{{ item }}"
    state: present
  loop:
    - package1
    - package2
    - non-existent-package
  ignore_errors: yes
```

### 2.2 aptæ¨¡å— - Debian/Ubuntuç³»ç»Ÿ


**åŸºæœ¬æ¦‚å¿µ**ï¼š`apt`æ˜¯Debianç³»åˆ—ç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨ï¼ŒåŠŸèƒ½ä¸yumç±»ä¼¼ï¼Œä½†è¯­æ³•ç¨æœ‰ä¸åŒã€‚

#### ğŸ”¸ åŸºç¡€æ“ä½œç¤ºä¾‹


```yaml
# æ›´æ–°åŒ…ç´¢å¼•å¹¶å®‰è£…
- name: æ›´æ–°ç¼“å­˜å¹¶å®‰è£…nginx
  apt:
    name: nginx
    state: present
    update_cache: yes

# å®‰è£…å¤šä¸ªåŒ…
- name: å®‰è£…LAMPç¯å¢ƒ
  apt:
    name:
      - apache2
      - mysql-server
      - php
      - libapache2-mod-php
    state: present

# å®Œå…¨å¸è½½åŒ…ï¼ˆåŒ…æ‹¬é…ç½®æ–‡ä»¶ï¼‰
- name: å½»åº•å¸è½½apache2
  apt:
    name: apache2
    state: absent
    purge: yes
```

#### ğŸ”¸ aptç‰¹æœ‰å‚æ•°


```yaml
# è‡ªåŠ¨ç§»é™¤ä¸éœ€è¦çš„ä¾èµ–
- name: å®‰è£…è½¯ä»¶å¹¶æ¸…ç†ä¾èµ–
  apt:
    name: some-package
    state: present
    autoremove: yes

# å…è®¸é™çº§å®‰è£…
- name: å¼ºåˆ¶å®‰è£…æŒ‡å®šç‰ˆæœ¬
  apt:
    name: package=1.0.0
    state: present
    force: yes

# ä»…ä¸‹è½½ä¸å®‰è£…
- name: ä»…ä¸‹è½½åŒ…åˆ°æœ¬åœ°
  apt:
    name: nginx
    state: present
    download_only: yes
```

### 2.3 dnfæ¨¡å— - ç°ä»£RedHatç³»ç»Ÿ


**èƒŒæ™¯è¯´æ˜**ï¼šdnfæ˜¯yumçš„ç»§ä»»è€…ï¼Œç”¨äºFedoraã€CentOS 8+ã€RHEL 8+ç³»ç»Ÿã€‚

```yaml
# åŸºæœ¬å®‰è£…ï¼ˆè¯­æ³•ä¸yumå‡ ä¹ç›¸åŒï¼‰
- name: ä½¿ç”¨dnfå®‰è£…è½¯ä»¶
  dnf:
    name: httpd
    state: present

# å®‰è£…è½¯ä»¶ç»„
- name: å®‰è£…å¼€å‘å·¥å…·ç»„
  dnf:
    name: "@Development Tools"
    state: present

# ä»æ¨¡å—æµå®‰è£…ç‰¹å®šç‰ˆæœ¬
- name: å®‰è£…Node.jsç‰¹å®šç‰ˆæœ¬
  dnf:
    name: "@nodejs:14/common"
    state: present
```

---

## 3. ğŸ è¯­è¨€åŒ…ç®¡ç†å™¨æ¨¡å—


### 3.1 pipæ¨¡å— - PythonåŒ…ç®¡ç†


**åº”ç”¨åœºæ™¯**ï¼šç®¡ç†Pythonç¬¬ä¸‰æ–¹åº“ï¼Œå¸¸ç”¨äºéƒ¨ç½²Pythonåº”ç”¨çš„ä¾èµ–ã€‚

#### ğŸ”¸ åŸºç¡€ä½¿ç”¨æ–¹æ³•


```yaml
# å®‰è£…PythonåŒ…
- name: å®‰è£…Django
  pip:
    name: django
    state: present

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
- name: å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„requests
  pip:
    name: requests==2.25.1
    state: present

# ä½¿ç”¨requirements.txtæ‰¹é‡å®‰è£…
- name: æ ¹æ®requirements.txtå®‰è£…ä¾èµ–
  pip:
    requirements: /app/requirements.txt
    state: present
```

#### ğŸ”¸ è™šæ‹Ÿç¯å¢ƒç®¡ç†


```yaml
# åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…åŒ…
- name: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…åŒ…
  pip:
    name: flask
    virtualenv: /opt/myapp/venv
    virtualenv_python: python3.8

# ä½¿ç”¨ç³»ç»ŸPythonçš„ç‰¹å®šç‰ˆæœ¬
- name: ä½¿ç”¨æŒ‡å®šPythonç‰ˆæœ¬å®‰è£…
  pip:
    name: numpy
    executable: pip3.9
```

#### ğŸ”¸ å®é™…éƒ¨ç½²åœºæ™¯


```yaml
# Webåº”ç”¨éƒ¨ç½²ç¤ºä¾‹
- name: éƒ¨ç½²Python Webåº”ç”¨
  block:
    - name: åˆ›å»ºåº”ç”¨ç›®å½•
      file:
        path: /opt/webapp
        state: directory
        
    - name: å¤åˆ¶requirementsæ–‡ä»¶
      copy:
        src: requirements.txt
        dest: /opt/webapp/requirements.txt
        
    - name: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
      pip:
        name: pip
        virtualenv: /opt/webapp/venv
        virtualenv_command: python3 -m venv
        
    - name: å®‰è£…åº”ç”¨ä¾èµ–
      pip:
        requirements: /opt/webapp/requirements.txt
        virtualenv: /opt/webapp/venv
```

### 3.2 npmæ¨¡å— - Node.jsåŒ…ç®¡ç†


**ä½¿ç”¨åœºæ™¯**ï¼šç®¡ç†Node.jsé¡¹ç›®ä¾èµ–ï¼Œå‰ç«¯æ„å»ºå·¥å…·å®‰è£…ã€‚

```yaml
# å…¨å±€å®‰è£…å·¥å…·
- name: å…¨å±€å®‰è£…vue-cli
  npm:
    name: "@vue/cli"
    global: yes
    state: present

# é¡¹ç›®çº§ä¾èµ–å®‰è£…
- name: å®‰è£…é¡¹ç›®ä¾èµ–
  npm:
    path: /var/www/myapp
    state: present

# å®‰è£…å¼€å‘ä¾èµ–
- name: å®‰è£…å¼€å‘ä¾èµ–
  npm:
    name: webpack
    path: /var/www/myapp
    production: no
```

### 3.3 gemæ¨¡å— - RubyåŒ…ç®¡ç†


**åº”ç”¨è¯´æ˜**ï¼šä¸»è¦ç”¨äºRuby on Railsé¡¹ç›®æˆ–Rubyå·¥å…·çš„éƒ¨ç½²ã€‚

```yaml
# å®‰è£…Ruby gem
- name: å®‰è£…railsæ¡†æ¶
  gem:
    name: rails
    version: "6.1.0"
    state: present

# ä»Gemfileå®‰è£…
- name: æ ¹æ®Gemfileå®‰è£…ä¾èµ–
  bundler:
    state: present
    chdir: /opt/myrubyapp
```

---

## 4. ğŸ¯ é€šç”¨åŒ…ç®¡ç†æ¨¡å—


### 4.1 packageæ¨¡å— - è·¨å¹³å°è§£å†³æ–¹æ¡ˆ


**æ ¸å¿ƒä¼˜åŠ¿**ï¼šè‡ªåŠ¨æ£€æµ‹æ“ä½œç³»ç»Ÿç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„åŒ…ç®¡ç†å™¨ï¼Œä¸€å¥—ä»£ç é€‚é…å¤šç§ç³»ç»Ÿã€‚

#### ğŸ”¸ æ™ºèƒ½ç³»ç»Ÿæ£€æµ‹


```
Ansibleæ£€æµ‹é€»è¾‘ï¼š
CentOS/RHEL â†’ ä½¿ç”¨yum/dnf
Ubuntu/Debian â†’ ä½¿ç”¨apt  
SUSE â†’ ä½¿ç”¨zypper
macOS â†’ ä½¿ç”¨homebrew
FreeBSD â†’ ä½¿ç”¨pkg
```

#### ğŸ”¸ å®é™…ä½¿ç”¨ç¤ºä¾‹


```yaml
# è·¨å¹³å°å®‰è£…åŸºç¡€å·¥å…·
- name: å®‰è£…å¸¸ç”¨å·¥å…·ï¼ˆé€‚é…æ‰€æœ‰ç³»ç»Ÿï¼‰
  package:
    name: "{{ item }}"
    state: present
  loop:
    - git
    - curl
    - wget
    - vim

# æ ¹æ®ç³»ç»Ÿå˜é‡å®‰è£…ä¸åŒåŒ…å
- name: å®‰è£…HTTPæœåŠ¡å™¨
  package:
    name: "{{ http_server_package }}"
    state: present
  vars:
    http_server_package: >-
      {{
        'apache2' if ansible_os_family == 'Debian'
        else 'httpd'
      }}
```

### 4.2 æ··åˆç¯å¢ƒæœ€ä½³å®è·µ


**åœºæ™¯æè¿°**ï¼šä¼ä¸šç¯å¢ƒä¸­å¸¸å¸¸æ··åˆä½¿ç”¨CentOSã€Ubuntuç­‰ä¸åŒå‘è¡Œç‰ˆã€‚

```yaml
# åˆ›å»ºè·¨å¹³å°çš„è½¯ä»¶å®‰è£…ä»»åŠ¡
- name: å®‰è£…ç›‘æ§å·¥å…·
  block:
    # é’ˆå¯¹RedHatç³»åˆ—
    - name: åœ¨CentOSä¸Šå®‰è£…htop
      yum:
        name: htop
        enablerepo: epel
        state: present
      when: ansible_os_family == "RedHat"
    
    # é’ˆå¯¹Debianç³»åˆ—
    - name: åœ¨Ubuntuä¸Šå®‰è£…htop
      apt:
        name: htop
        update_cache: yes
        state: present
      when: ansible_os_family == "Debian"
```

---

## 5. ğŸ” ä»“åº“é…ç½®ä¸å®‰å…¨


### 5.1 è½¯ä»¶ä»“åº“ç®¡ç†


**ä»“åº“çš„ä½œç”¨**ï¼šä»“åº“å°±åƒè½¯ä»¶è¶…å¸‚ï¼Œé‡Œé¢å­˜æ”¾ç€å„ç§å¯å®‰è£…çš„è½¯ä»¶åŒ…ã€‚é…ç½®ä»“åº“ç›¸å½“äºå‘Šè¯‰ç³»ç»Ÿå»å“ªé‡Œ"è´­ä¹°"è½¯ä»¶ã€‚

#### ğŸ”¸ æ·»åŠ ç¬¬ä¸‰æ–¹ä»“åº“


```yaml
# æ·»åŠ EPELä»“åº“ï¼ˆCentOSé¢å¤–è½¯ä»¶åŒ…ï¼‰
- name: æ·»åŠ EPELä»“åº“
  yum_repository:
    name: epel
    description: EPEL YUM repo
    baseurl: https://download.fedoraproject.org/pub/epel/7/$basearch
    gpgcheck: yes
    gpgkey: https://download.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7
    enabled: yes

# æ·»åŠ Dockerå®˜æ–¹ä»“åº“
- name: æ·»åŠ Docker CEä»“åº“
  yum_repository:
    name: docker-ce
    description: Docker CE Stable
    baseurl: https://download.docker.com/linux/centos/7/$basearch/stable
    gpgcheck: yes
    gpgkey: https://download.docker.com/linux/centos/gpg
    enabled: yes
```

#### ğŸ”¸ Ubuntuæ·»åŠ PPAä»“åº“


```yaml
# æ·»åŠ PPAä»“åº“
- name: æ·»åŠ Nginxç¨³å®šç‰ˆPPA
  apt_repository:
    repo: ppa:nginx/stable
    state: present
    update_cache: yes

# æ·»åŠ ç¬¬ä¸‰æ–¹ä»“åº“
- name: æ·»åŠ Node.jså®˜æ–¹ä»“åº“
  apt_repository:
    repo: "deb https://deb.nodesource.com/node_16.x {{ ansible_distribution_release }} main"
    state: present
    filename: nodesource
```

### 5.2 GPGå¯†é’¥éªŒè¯


**å®‰å…¨æ„ä¹‰**ï¼šGPGå¯†é’¥éªŒè¯ç¡®ä¿ä¸‹è½½çš„è½¯ä»¶åŒ…ç¡®å®æ¥è‡ªå®˜æ–¹ï¼Œæ²¡æœ‰è¢«ç¯¡æ”¹ã€‚

```yaml
# å¯¼å…¥GPGå…¬é’¥
- name: å¯¼å…¥Docker GPGå¯†é’¥
  rpm_key:
    key: https://download.docker.com/linux/centos/gpg
    state: present

# Ubuntuç³»ç»Ÿå¯¼å…¥å¯†é’¥
- name: æ·»åŠ APTå¯†é’¥
  apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
    state: present
    id: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
```

#### ğŸ”¸ ç¦»çº¿ç¯å¢ƒå¯†é’¥ç®¡ç†


```yaml
# ä»æ–‡ä»¶å¯¼å…¥å¯†é’¥ï¼ˆé€‚ç”¨äºç¦»çº¿ç¯å¢ƒï¼‰
- name: ä»æœ¬åœ°æ–‡ä»¶å¯¼å…¥GPGå¯†é’¥
  rpm_key:
    key: /tmp/RPM-GPG-KEY-EPEL-7
    state: present

# éªŒè¯å¯†é’¥æŒ‡çº¹
- name: éªŒè¯å¯†é’¥æŒ‡çº¹
  command: gpg --with-fingerprint /tmp/key.asc
  register: key_info
  
- name: æ£€æŸ¥å¯†é’¥æŒ‡çº¹
  fail:
    msg: "å¯†é’¥æŒ‡çº¹ä¸åŒ¹é…"
  when: "'9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88' not in key_info.stdout"
```

### 5.3 æœ¬åœ°ä»“åº“æ­å»º


**åº”ç”¨åœºæ™¯**ï¼šä¼ä¸šå†…ç½‘ç¯å¢ƒï¼Œéœ€è¦æ­å»ºç§æœ‰è½¯ä»¶ä»“åº“ä¾›å†…éƒ¨ä½¿ç”¨ã€‚

```yaml
# å®‰è£…ä»“åº“ç®¡ç†å·¥å…·
- name: å®‰è£…createrepoå·¥å…·
  yum:
    name: createrepo
    state: present

# åˆ›å»ºæœ¬åœ°ä»“åº“ç›®å½•
- name: åˆ›å»ºä»“åº“ç›®å½•
  file:
    path: /var/www/html/repo
    state: directory
    owner: apache
    group: apache
    mode: '0755'

# ç”Ÿæˆä»“åº“å…ƒæ•°æ®
- name: ç”ŸæˆYUMä»“åº“å…ƒæ•°æ®
  command: createrepo /var/www/html/repo
  args:
    creates: /var/www/html/repo/repodata
```

---

## 6. ğŸš€ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 WebæœåŠ¡å™¨ç¯å¢ƒæ­å»º


**åœºæ™¯è¯´æ˜**ï¼šæ‰¹é‡éƒ¨ç½²LAMPç¯å¢ƒåˆ°å¤šå°æœåŠ¡å™¨ã€‚

```yaml
---
- name: éƒ¨ç½²LAMPç¯å¢ƒ
  hosts: webservers
  become: yes
  
  tasks:
    # å®‰è£…åŸºç¡€ç»„ä»¶
    - name: å®‰è£…Apacheã€MySQLã€PHP
      package:
        name:
          - "{{ apache_package }}"
          - "{{ mysql_package }}"  
          - "{{ php_package }}"
        state: present
      vars:
        apache_package: >-
          {{
            'apache2' if ansible_os_family == 'Debian'
            else 'httpd'
          }}
        mysql_package: >-
          {{
            'mysql-server' if ansible_os_family == 'Debian'
            else 'mariadb-server'  
          }}
        php_package: >-
          {{
            'php' if ansible_os_family == 'Debian'
            else 'php'
          }}

    # å®‰è£…PHPæ‰©å±•
    - name: å®‰è£…PHPå¸¸ç”¨æ‰©å±•
      package:
        name:
          - php-mysql
          - php-gd
          - php-curl
          - php-mbstring
        state: present

    # å¯åŠ¨æœåŠ¡
    - name: å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
      systemd:
        name: "{{ item }}"
        state: started
        enabled: yes
      loop:
        - "{{ apache_service }}"
        - "{{ mysql_service }}"
      vars:
        apache_service: >-
          {{
            'apache2' if ansible_os_family == 'Debian'
            else 'httpd'
          }}
        mysql_service: >-
          {{
            'mysql' if ansible_os_family == 'Debian'
            else 'mariadb'
          }}
```

### 6.2 å¼€å‘ç¯å¢ƒç»Ÿä¸€éƒ¨ç½²


**éœ€æ±‚åœºæ™¯**ï¼šä¸ºå¼€å‘å›¢é˜Ÿç»Ÿä¸€é…ç½®å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬ç¼–ç¨‹è¯­è¨€ã€IDEã€å·¥å…·ç­‰ã€‚

```yaml
---
- name: é…ç½®å¼€å‘ç¯å¢ƒ
  hosts: dev_machines
  become: yes
  
  tasks:
    # å®‰è£…å¼€å‘å·¥å…·
    - name: å®‰è£…åŸºç¡€å¼€å‘å·¥å…·
      package:
        name:
          - git
          - curl
          - wget
          - vim
          - build-essential  # Ubuntu
        state: present
      when: ansible_os_family == "Debian"
        
    - name: å®‰è£…å¼€å‘å·¥å…·ç»„ï¼ˆCentOSï¼‰
      yum:
        name: "@Development Tools"
        state: present
      when: ansible_os_family == "RedHat"

    # å®‰è£…Pythonå¼€å‘ç¯å¢ƒ
    - name: å®‰è£…PythonåŠå·¥å…·
      package:
        name:
          - python3
          - python3-pip
          - python3-venv
        state: present
    
    - name: å®‰è£…Pythonå¼€å‘åº“
      pip:
        name:
          - virtualenv
          - pytest
          - black
          - flake8
        state: present

    # å®‰è£…Node.jså¼€å‘ç¯å¢ƒ  
    - name: å®‰è£…Node.js
      package:
        name: nodejs
        state: present
        
    - name: å®‰è£…å‰ç«¯å·¥å…·
      npm:
        name: "{{ item }}"
        global: yes
        state: present
      loop:
        - "@vue/cli"
        - create-react-app
        - typescript
```

### 6.3 å®‰å…¨åŠ å›ºä¸ç›‘æ§éƒ¨ç½²


**åº”ç”¨ç›®æ ‡**ï¼šåœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šéƒ¨ç½²å®‰å…¨å·¥å…·å’Œç›‘æ§è½¯ä»¶ã€‚

```yaml
---
- name: éƒ¨ç½²å®‰å…¨ç›‘æ§å·¥å…·
  hosts: production
  become: yes
  
  tasks:
    # å®‰è£…å®‰å…¨å·¥å…·
    - name: å®‰è£…fail2bané˜²æš´åŠ›ç ´è§£
      package:
        name: fail2ban
        state: present
        
    - name: å®‰è£…rkhunter rootkitæ£€æµ‹
      package:
        name: rkhunter  
        state: present

    # å®‰è£…ç›‘æ§å·¥å…·
    - name: å®‰è£…ç³»ç»Ÿç›‘æ§å·¥å…·
      package:
        name:
          - htop
          - iotop  
          - netstat-nat
          - tcpdump
        state: present

    # å®‰è£…æ—¥å¿—åˆ†æå·¥å…·
    - name: å®‰è£…logwatch
      package:
        name: logwatch
        state: present
        
    # é…ç½®è‡ªåŠ¨æ›´æ–°ï¼ˆUbuntuï¼‰
    - name: å®‰è£…æ— äººå€¼å®ˆå‡çº§
      package:
        name: unattended-upgrades
        state: present
      when: ansible_os_family == "Debian"
```

### 6.4 å®¹å™¨åŒ–ç¯å¢ƒéƒ¨ç½²


**åœºæ™¯éœ€æ±‚**ï¼šæ‰¹é‡å®‰è£…Dockerå’Œå®¹å™¨ç®¡ç†å·¥å…·ã€‚

```yaml
---
- name: éƒ¨ç½²Dockerç¯å¢ƒ
  hosts: docker_hosts
  become: yes
  
  tasks:
    # å¸è½½æ—§ç‰ˆæœ¬Docker
    - name: å¸è½½æ—§ç‰ˆæœ¬Docker
      package:
        name:
          - docker
          - docker-engine
          - docker.io
          - containerd
          - runc
        state: absent

    # å®‰è£…ä¾èµ–åŒ…
    - name: å®‰è£…Dockerä¾èµ–
      package:
        name:
          - apt-transport-https
          - ca-certificates
          - curl
          - gnupg
          - lsb-release
        state: present
      when: ansible_os_family == "Debian"

    # æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥
    - name: æ·»åŠ Docker GPGå¯†é’¥
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present
      when: ansible_os_family == "Debian"

    # æ·»åŠ Dockerä»“åº“
    - name: æ·»åŠ Dockerä»“åº“
      apt_repository:
        repo: "deb https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
        state: present
        filename: docker
      when: ansible_os_family == "Debian"

    # å®‰è£…Docker CE
    - name: å®‰è£…Docker CE
      package:
        name:
          - docker-ce
          - docker-ce-cli
          - containerd.io
        state: present

    # å¯åŠ¨DockeræœåŠ¡
    - name: å¯åŠ¨DockeræœåŠ¡
      systemd:
        name: docker
        state: started
        enabled: yes

    # å®‰è£…Docker Compose
    - name: å®‰è£…Docker Compose
      pip:
        name: docker-compose
        state: present
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åŒ…ç®¡ç†å™¨æœ¬è´¨ï¼šè‡ªåŠ¨åŒ–è½¯ä»¶å®‰è£…ã€æ›´æ–°ã€å¸è½½çš„å·¥å…·
ğŸ”¸ ç³»ç»Ÿé€‚é…ï¼šä¸åŒLinuxå‘è¡Œç‰ˆä½¿ç”¨ä¸åŒçš„åŒ…ç®¡ç†å™¨
ğŸ”¸ çŠ¶æ€ç®¡ç†ï¼špresent(å®‰è£…)ã€absent(å¸è½½)ã€latest(æœ€æ–°ç‰ˆ)
ğŸ”¸ å¹‚ç­‰æ€§ï¼šå¤šæ¬¡æ‰§è¡Œç›¸åŒæ“ä½œç»“æœä¸€è‡´ï¼Œä¸ä¼šé‡å¤å®‰è£…
ğŸ”¸ ä¾èµ–ç®¡ç†ï¼šè‡ªåŠ¨å¤„ç†è½¯ä»¶åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ç”¨Ansibleç®¡ç†è½¯ä»¶åŒ…**
```
ä¼ ç»Ÿç—›ç‚¹ï¼š
- æ‰‹åŠ¨æ“ä½œæ¯å°æœåŠ¡å™¨ï¼Œé‡å¤åŠ³åŠ¨
- å®¹æ˜“é—æ¼æŸäº›æœåŠ¡å™¨æˆ–è½¯ä»¶åŒ…
- ç‰ˆæœ¬ä¸ç»Ÿä¸€ï¼Œéš¾ä»¥ç®¡ç†
- å‡ºé”™åæ’æŸ¥å›°éš¾

Ansibleä¼˜åŠ¿ï¼š
- æ‰¹é‡æ“ä½œï¼Œä¸€æ¬¡ç®¡ç†æ‰€æœ‰æœåŠ¡å™¨
- å¹‚ç­‰æ€§ä¿è¯ï¼Œå¯é‡å¤æ‰§è¡Œ
- ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†
- è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯æŠ¥å‘Š
```

**ğŸ”¹ é€‰æ‹©åˆé€‚çš„æ¨¡å—**
```
é€‰æ‹©åŸåˆ™ï¼š
å•ä¸€ç³»ç»Ÿç¯å¢ƒ â†’ ä½¿ç”¨å…·ä½“æ¨¡å—(yum/apt/dnf)
æ··åˆç³»ç»Ÿç¯å¢ƒ â†’ ä½¿ç”¨packageé€šç”¨æ¨¡å—
ç‰¹å®šè¯­è¨€é¡¹ç›® â†’ ä½¿ç”¨è¯­è¨€åŒ…ç®¡ç†å™¨(pip/npm/gem)

å…·ä½“å»ºè®®ï¼š
ç”Ÿäº§ç¯å¢ƒï¼šä¼˜å…ˆä½¿ç”¨å…·ä½“æ¨¡å—ï¼Œæ›´å¯æ§
å¼€å‘ç¯å¢ƒï¼šå¯ä»¥ä½¿ç”¨é€šç”¨æ¨¡å—ï¼Œæ›´çµæ´»
```

**ğŸ”¹ ä»“åº“å’Œå®‰å…¨ç®¡ç†**
```
ä»“åº“é…ç½®åŸåˆ™ï¼š
- ä¼˜å…ˆä½¿ç”¨å®˜æ–¹ä»“åº“
- ç¬¬ä¸‰æ–¹ä»“åº“éœ€è¦éªŒè¯å¯é æ€§
- ä¼ä¸šç¯å¢ƒå»ºè®®æ­å»ºç§æœ‰ä»“åº“

å®‰å…¨è€ƒè™‘ï¼š
- å§‹ç»ˆå¯ç”¨GPGå¯†é’¥éªŒè¯
- å®šæœŸæ›´æ–°ä»“åº“ç´¢å¼•
- è°¨æ…æ·»åŠ æœªçŸ¥æ¥æºçš„ä»“åº“
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å¸¸è§åº”ç”¨åœºæ™¯**
- **ç¯å¢ƒæ­å»º**ï¼šå¿«é€Ÿéƒ¨ç½²å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ
- **å®‰å…¨åŠ å›º**ï¼šæ‰¹é‡å®‰è£…å®‰å…¨å·¥å…·å’Œç›‘æ§è½¯ä»¶  
- **ç‰ˆæœ¬ç»Ÿä¸€**ï¼šç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨è½¯ä»¶ç‰ˆæœ¬ä¸€è‡´
- **å¿«é€Ÿä¿®å¤**ï¼šæ‰¹é‡å®‰è£…å®‰å…¨è¡¥ä¸å’Œbugfix

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
å¼€å‘é˜¶æ®µï¼š
- ä½¿ç”¨å˜é‡å®šä¹‰è½¯ä»¶åŒ…åˆ—è¡¨
- é’ˆå¯¹ä¸åŒç¯å¢ƒåˆ›å»ºä¸åŒçš„åŒ…åˆ—è¡¨
- ä½¿ç”¨whenæ¡ä»¶é€‚é…ä¸åŒæ“ä½œç³»ç»Ÿ

ç”Ÿäº§éƒ¨ç½²ï¼š
- é”å®šè½¯ä»¶ç‰ˆæœ¬é¿å…æ„å¤–å‡çº§
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•
- åšå¥½å›æ»šé¢„æ¡ˆ
```

**ğŸ”§ æ•…éšœæ’æŸ¥è¦ç‚¹**
```
å¸¸è§é—®é¢˜ï¼š
- ä»“åº“æ— æ³•è®¿é—®ï¼šæ£€æŸ¥ç½‘ç»œå’Œä»“åº“é…ç½®
- GPGéªŒè¯å¤±è´¥ï¼šç¡®è®¤å¯†é’¥æ˜¯å¦æ­£ç¡®å¯¼å…¥  
- ä¾èµ–å†²çªï¼šä½¿ç”¨--skip-brokenæˆ–æ‰‹åŠ¨è§£å†³
- æƒé™ä¸è¶³ï¼šç¡®ä¿ä½¿ç”¨sudoæˆ–becomeææƒ

è°ƒè¯•æŠ€å·§ï¼š
- ä½¿ç”¨-vvvå¢åŠ è¯¦ç»†è¾“å‡º
- æ£€æŸ¥/var/log/yum.logç­‰ç³»ç»Ÿæ—¥å¿—
- å…ˆåœ¨å•å°æœåŠ¡å™¨ä¸Šæµ‹è¯•
- ä½¿ç”¨checkæ¨¡å¼é¢„æ£€æŸ¥æ‰§è¡Œç»“æœ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- è½¯ä»¶åŒ…ç®¡ç†æ˜¯æœåŠ¡å™¨æ‰¹é‡è¿ç»´çš„åŸºç¡€
- é€‰å¯¹æ¨¡å—å¾ˆé‡è¦ï¼šyumç”¨äºCentOSï¼Œaptç”¨äºUbuntuï¼Œpackageé€šç”¨
- å®‰å…¨ç¬¬ä¸€ï¼šå¯ç”¨GPGéªŒè¯ï¼Œä½¿ç”¨å¯ä¿¡ä»“åº“
- å¹‚ç­‰æ€§è®©é‡å¤æ‰§è¡Œå˜å¾—å®‰å…¨å¯é 