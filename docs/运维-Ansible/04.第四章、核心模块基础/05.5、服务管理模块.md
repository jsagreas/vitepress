---
title: 5ã€æœåŠ¡ç®¡ç†æ¨¡å—
---
## ğŸ“š ç›®å½•

1. [æœåŠ¡ç®¡ç†æ¨¡å—æ¦‚è¿°](#1-æœåŠ¡ç®¡ç†æ¨¡å—æ¦‚è¿°)
2. [serviceæ¨¡å—åŸºç¡€æ“ä½œ](#2-serviceæ¨¡å—åŸºç¡€æ“ä½œ)
3. [systemdæ¨¡å—é«˜çº§åŠŸèƒ½](#3-systemdæ¨¡å—é«˜çº§åŠŸèƒ½)
4. [æœåŠ¡çŠ¶æ€ç®¡ç†å®è·µ](#4-æœåŠ¡çŠ¶æ€ç®¡ç†å®è·µ)
5. [æœåŠ¡ä¾èµ–ä¸é…ç½®ç®¡ç†](#5-æœåŠ¡ä¾èµ–ä¸é…ç½®ç®¡ç†)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æœåŠ¡ç®¡ç†æ¨¡å—æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡ç®¡ç†


**æœåŠ¡çš„æœ¬è´¨æ¦‚å¿µ**ï¼š
åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ï¼ˆServiceï¼‰å°±æ˜¯åœ¨åå°æŒç»­è¿è¡Œçš„ç¨‹åºï¼Œæ¯”å¦‚ç½‘ç«™æœåŠ¡å™¨ã€æ•°æ®åº“ã€ç½‘ç»œæœåŠ¡ç­‰ã€‚å°±åƒä½ æ‰‹æœºé‡Œä¸€ç›´åœ¨åå°è¿è¡Œçš„å¾®ä¿¡ã€éŸ³ä¹æ’­æ”¾å™¨ä¸€æ ·ï¼ŒLinuxçš„æœåŠ¡ä¹Ÿæ˜¯è¿™æ ·é»˜é»˜å·¥ä½œçš„ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦Ansibleç®¡ç†æœåŠ¡**ï¼š
```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
- éœ€è¦é€å°æœåŠ¡å™¨ç™»å½•
- æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤å®¹æ˜“å‡ºé”™
- æ— æ³•æ‰¹é‡æ“ä½œ
- çŠ¶æ€ä¸ç»Ÿä¸€

Ansibleçš„ä¼˜åŠ¿ï¼š
- æ‰¹é‡ç®¡ç†å¤šå°æœåŠ¡å™¨
- ç»Ÿä¸€çš„æ“ä½œè§„èŒƒ
- è‡ªåŠ¨åŒ–æ‰§è¡Œ
- çŠ¶æ€æ£€æŸ¥å’ŒæŠ¥å‘Š
```

### 1.2 ä¸¤å¤§æ ¸å¿ƒæ¨¡å—å¯¹æ¯”


| ç‰¹æ€§å¯¹æ¯” | **serviceæ¨¡å—** | **systemdæ¨¡å—** |
|---------|---------------|----------------|
| ğŸ”§ **é€‚ç”¨ç³»ç»Ÿ** | `ä¼ ç»ŸUnix/Linuxç³»ç»Ÿ` | `ç°ä»£Linuxç³»ç»Ÿ(CentOS7+/Ubuntu16+)` |
| âš™ï¸ **ç®¡ç†æ–¹å¼** | `é€šç”¨æœåŠ¡ç®¡ç†æ¥å£` | `ç›´æ¥æ“ä½œsystemd` |
| ğŸš€ **åŠŸèƒ½ä¸°å¯Œåº¦** | `åŸºç¡€æ“ä½œ` | `é«˜çº§åŠŸèƒ½` |
| ğŸ’¡ **æ¨èåœºæ™¯** | `è·¨ç‰ˆæœ¬å…¼å®¹` | `ç°ä»£Linuxç¯å¢ƒ` |

**ç®€å•ç†è§£**ï¼š
- `serviceæ¨¡å—` = ä¸‡èƒ½é’¥åŒ™ï¼Œå“ªä¸ªç³»ç»Ÿéƒ½èƒ½ç”¨ï¼Œä½†åŠŸèƒ½åŸºç¡€
- `systemdæ¨¡å—` = ä¸“ä¸šå·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä½†åªé€‚ç”¨ç°ä»£Linux

### 1.3 æœåŠ¡æ“ä½œæ¶æ„å›¾


```
Ansibleæ§åˆ¶èŠ‚ç‚¹                     ç›®æ ‡æœåŠ¡å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Playbookè„šæœ¬   â”‚               â”‚   Linuxç³»ç»Ÿ     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    SSHè¿æ¥    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚serviceæ¨¡å—  â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ â”‚æœåŠ¡ç®¡ç†å™¨   â”‚ â”‚
â”‚ â”‚systemdæ¨¡å—  â”‚ â”‚               â”‚ â”‚(systemd)    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚       â†“         â”‚
                                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                  â”‚ â”‚å®é™…æœåŠ¡è¿›ç¨‹ â”‚ â”‚
                                  â”‚ â”‚nginx/mysql  â”‚ â”‚
                                  â”‚ â”‚apache/redis â”‚ â”‚
                                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš™ï¸ serviceæ¨¡å—åŸºç¡€æ“ä½œ


### 2.1 åŸºæœ¬è¯­æ³•æ ¼å¼


**æ¨¡å—è°ƒç”¨æ–¹å¼**ï¼š
```yaml
- name: æœåŠ¡æ“ä½œæè¿°
  service:
    name: æœåŠ¡åç§°        # å¿…å¡«é¡¹
    state: æ“ä½œçŠ¶æ€       # started/stopped/restarted/reloaded
    enabled: yes/no      # å¼€æœºè‡ªå¯è®¾ç½®ï¼ˆå¯é€‰ï¼‰
```

ğŸ’¡ **å‚æ•°å«ä¹‰è§£é‡Š**ï¼š
- `name` - å°±æ˜¯ä½ è¦ç®¡ç†çš„æœåŠ¡åå­—ï¼Œæ¯”å¦‚nginxã€mysql
- `state` - å‘Šè¯‰æœåŠ¡è¦åšä»€ä¹ˆåŠ¨ä½œ
- `enabled` - å†³å®šå¼€æœºæ—¶æ˜¯å¦è‡ªåŠ¨å¯åŠ¨è¿™ä¸ªæœåŠ¡

### 2.2 æœåŠ¡çŠ¶æ€æ“ä½œè¯¦è§£


#### ğŸš€ å¯åŠ¨æœåŠ¡ (started)

```yaml
- name: å¯åŠ¨nginxç½‘ç«™æœåŠ¡
  service:
    name: nginx
    state: started
```
**å®é™…å«ä¹‰**ï¼šè®©nginxæœåŠ¡å¼€å§‹è¿è¡Œï¼Œç›¸å½“äºæ‰‹åŠ¨æ‰§è¡Œ `systemctl start nginx`

#### â¹ï¸ åœæ­¢æœåŠ¡ (stopped)

```yaml
- name: åœæ­¢ApacheæœåŠ¡
  service:
    name: apache2
    state: stopped
```
**ä½¿ç”¨åœºæ™¯**ï¼šç»´æŠ¤æœŸé—´ä¸´æ—¶å…³é—­æœåŠ¡ï¼Œæˆ–è€…åˆ‡æ¢åˆ°å…¶ä»–æœåŠ¡

#### ğŸ”„ é‡å¯æœåŠ¡ (restarted)

```yaml
- name: é‡å¯MySQLæ•°æ®åº“
  service:
    name: mysql
    state: restarted
```
**ä»€ä¹ˆæ—¶å€™ç”¨é‡å¯**ï¼š
- ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°åŠ è½½
- æœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œéœ€è¦å®Œå…¨é‡å¯
- å®‰è£…äº†æœåŠ¡æ›´æ–°

#### ğŸ”ƒ é‡è½½é…ç½® (reloaded)

```yaml
- name: é‡è½½nginxé…ç½®
  service:
    name: nginx
    state: reloaded
```
**é‡è½½ vs é‡å¯çš„åŒºåˆ«**ï¼š
- **é‡è½½**ï¼šåªé‡æ–°è¯»å–é…ç½®ï¼ŒæœåŠ¡ä¸ä¸­æ–­ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
- **é‡å¯**ï¼šå®Œå…¨åœæ­¢å†å¯åŠ¨ï¼Œä¼šçŸ­æš‚ä¸­æ–­æœåŠ¡

### 2.3 å¼€æœºè‡ªå¯ç®¡ç†


**è®¾ç½®å¼€æœºè‡ªå¯**ï¼š
```yaml
- name: è®¾ç½®nginxå¼€æœºè‡ªå¯
  service:
    name: nginx
    enabled: yes
    state: started
```

**ç¦ç”¨å¼€æœºè‡ªå¯**ï¼š
```yaml
- name: ç¦ç”¨Apacheå¼€æœºè‡ªå¯
  service:
    name: apache2
    enabled: no
```

**ç»„åˆæ“ä½œç¤ºä¾‹**ï¼š
```yaml
- name: å®Œæ•´çš„æœåŠ¡é…ç½®
  service:
    name: mysql
    state: started     # ç«‹å³å¯åŠ¨
    enabled: yes       # å¼€æœºè‡ªå¯
```

### 2.4 å®é™…æ“ä½œæ¼”ç¤º


**åœºæ™¯ï¼šéƒ¨ç½²WebæœåŠ¡å™¨**
```yaml
- name: WebæœåŠ¡å™¨æœåŠ¡ç®¡ç†
  hosts: webservers
  tasks:
    # 1ï¸âƒ£ å¯åŠ¨nginxå¹¶è®¾ç½®è‡ªå¯
    - name: ç¡®ä¿nginxæœåŠ¡è¿è¡Œ
      service:
        name: nginx
        state: started
        enabled: yes
    
    # 2ï¸âƒ£ åœæ­¢Apacheé¿å…ç«¯å£å†²çª
    - name: åœæ­¢ApacheæœåŠ¡
      service:
        name: apache2
        state: stopped
        enabled: no
    
    # 3ï¸âƒ£ å¯åŠ¨æ•°æ®åº“æœåŠ¡
    - name: å¯åŠ¨MySQLæ•°æ®åº“
      service:
        name: mysql
        state: started
        enabled: yes
```

---

## 3. ğŸ”§ systemdæ¨¡å—é«˜çº§åŠŸèƒ½


### 3.1 systemdæ¨¡å—ä¼˜åŠ¿


**ä¸ºä»€ä¹ˆé€‰æ‹©systemdæ¨¡å—**ï¼š
ç°ä»£Linuxç³»ç»Ÿï¼ˆå¦‚CentOS 7+ã€Ubuntu 16+ï¼‰éƒ½ä½¿ç”¨systemdä½œä¸ºæœåŠ¡ç®¡ç†å™¨ï¼Œå®ƒæä¾›äº†æ¯”ä¼ ç»Ÿinitç³»ç»Ÿæ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚

**systemdçš„æ ¸å¿ƒä¼˜åŠ¿**ï¼š
```
ğŸ”¸ å¹¶è¡Œå¯åŠ¨æœåŠ¡ â†’ å¼€æœºé€Ÿåº¦æ›´å¿«
ğŸ”¸ æœåŠ¡ä¾èµ–ç®¡ç† â†’ è‡ªåŠ¨å¤„ç†å¯åŠ¨é¡ºåº
ğŸ”¸ è¯¦ç»†æ—¥å¿—è®°å½• â†’ é—®é¢˜æ’æŸ¥æ›´å®¹æ˜“
ğŸ”¸ èµ„æºé™åˆ¶æ§åˆ¶ â†’ é˜²æ­¢æœåŠ¡å ç”¨è¿‡å¤šèµ„æº
ğŸ”¸ æ•…éšœè‡ªåŠ¨æ¢å¤ â†’ æœåŠ¡å´©æºƒè‡ªåŠ¨é‡å¯
```

### 3.2 systemdæ¨¡å—ç‹¬æœ‰åŠŸèƒ½


#### ğŸ­ æœåŠ¡æ©ç  (mask)

**ä»€ä¹ˆæ˜¯æœåŠ¡æ©ç **ï¼š
æ©ç å°±æ˜¯"å½»åº•ç¦ç”¨"æœåŠ¡ï¼Œè¿æ‰‹åŠ¨å¯åŠ¨éƒ½ä¸è¡Œï¼Œæ¯”ç®€å•çš„disableæ›´å½»åº•ã€‚

```yaml
- name: å®Œå…¨ç¦ç”¨ApacheæœåŠ¡
  systemd:
    name: apache2
    masked: yes
```
**åº”ç”¨åœºæ™¯**ï¼š
- å®‰å…¨åŠ å›ºï¼šå½»åº•ç¦ç”¨ä¸éœ€è¦çš„æœåŠ¡
- é¿å…è¯¯æ“ä½œï¼šé˜²æ­¢æ„å¤–å¯åŠ¨å†²çªçš„æœåŠ¡

#### ğŸ” daemoné‡è½½

```yaml
- name: é‡è½½systemdé…ç½®
  systemd:
    daemon_reload: yes
```
**ä½•æ—¶éœ€è¦daemoné‡è½½**ï¼š
- ä¿®æ”¹äº†æœåŠ¡é…ç½®æ–‡ä»¶ï¼ˆ.serviceæ–‡ä»¶ï¼‰
- æ·»åŠ äº†æ–°çš„æœåŠ¡å®šä¹‰
- åˆ é™¤äº†æœåŠ¡æ–‡ä»¶

#### ğŸŒ ç”¨æˆ·æœåŠ¡ç®¡ç†

```yaml
- name: ç®¡ç†ç”¨æˆ·çº§åˆ«çš„æœåŠ¡
  systemd:
    name: user-service
    state: started
    scope: user
```

### 3.3 systemdé«˜çº§é…ç½®ç¤ºä¾‹


**ç”Ÿäº§ç¯å¢ƒæœåŠ¡é…ç½®**ï¼š
```yaml
- name: ç”Ÿäº§ç¯å¢ƒWebæœåŠ¡é…ç½®
  hosts: production
  tasks:
    # é‡è½½systemdé…ç½®
    - name: é‡è½½systemdå®ˆæŠ¤è¿›ç¨‹
      systemd:
        daemon_reload: yes
    
    # å¯åŠ¨å¹¶é…ç½®nginx
    - name: é…ç½®nginxæœåŠ¡
      systemd:
        name: nginx
        state: started
        enabled: yes
    
    # æ©ç ä¸éœ€è¦çš„æœåŠ¡
    - name: å½»åº•ç¦ç”¨Apache
      systemd:
        name: apache2
        masked: yes
        enabled: no
```

---

## 4. ğŸ“Š æœåŠ¡çŠ¶æ€ç®¡ç†å®è·µ


### 4.1 æœåŠ¡çŠ¶æ€æ£€æŸ¥


**è·å–æœåŠ¡çŠ¶æ€ä¿¡æ¯**ï¼š
```yaml
- name: æ£€æŸ¥æœåŠ¡çŠ¶æ€
  service:
    name: nginx
  register: service_status

- name: æ˜¾ç¤ºæœåŠ¡çŠ¶æ€
  debug:
    var: service_status
```

**çŠ¶æ€ä¿¡æ¯åŒ…å«å†…å®¹**ï¼š
```
âœ… æœåŠ¡æ˜¯å¦è¿è¡Œä¸­
âœ… æ˜¯å¦è®¾ç½®å¼€æœºè‡ªå¯  
âœ… æœåŠ¡è¿›ç¨‹ID
âœ… æœ€åæ“ä½œæ—¶é—´
```

### 4.2 æ¡ä»¶åŒ–æœåŠ¡æ“ä½œ


**æ ¹æ®æ¡ä»¶æ‰§è¡ŒæœåŠ¡æ“ä½œ**ï¼š
```yaml
- name: ä»…åœ¨æœåŠ¡åœæ­¢æ—¶å¯åŠ¨
  service:
    name: mysql
    state: started
  when: ansible_service_mysql.state != "started"
```

**æ£€æŸ¥ç«¯å£åå¯åŠ¨æœåŠ¡**ï¼š
```yaml
- name: æ£€æŸ¥80ç«¯å£æ˜¯å¦è¢«å ç”¨
  wait_for:
    port: 80
    state: stopped
    timeout: 5
  ignore_errors: yes
  register: port_check

- name: å¯åŠ¨nginxï¼ˆå¦‚æœç«¯å£ç©ºé—²ï¼‰
  service:
    name: nginx
    state: started
  when: port_check is succeeded
```

### 4.3 æœåŠ¡å¥åº·æ£€æŸ¥


**æœåŠ¡å¯åŠ¨åéªŒè¯**ï¼š
```yaml
- name: å¯åŠ¨nginxæœåŠ¡
  service:
    name: nginx
    state: started

- name: éªŒè¯nginxç«¯å£ç›‘å¬
  wait_for:
    port: 80
    host: localhost
    timeout: 30
  
- name: æ£€æŸ¥nginxè¿›ç¨‹
  shell: pgrep nginx
  register: nginx_process
  
- name: ç¡®è®¤nginxæ­£å¸¸è¿è¡Œ
  debug:
    msg: "nginxè¿è¡Œæ­£å¸¸ï¼Œè¿›ç¨‹æ•°ï¼š{{ nginx_process.stdout_lines|length }}"
```

---

## 5. ğŸ”— æœåŠ¡ä¾èµ–ä¸é…ç½®ç®¡ç†


### 5.1 æœåŠ¡å¯åŠ¨é¡ºåºç®¡ç†


**æœ‰ä¾èµ–å…³ç³»çš„æœåŠ¡å¯åŠ¨**ï¼š
```yaml
- name: æ•°æ®åº“å’ŒWebæœåŠ¡å¯åŠ¨é¡ºåº
  hosts: webservers
  tasks:
    # 1ï¸âƒ£ å…ˆå¯åŠ¨æ•°æ®åº“
    - name: å¯åŠ¨MySQLæ•°æ®åº“
      service:
        name: mysql
        state: started
        enabled: yes
    
    # 2ï¸âƒ£ ç­‰å¾…æ•°æ®åº“å°±ç»ª
    - name: ç­‰å¾…MySQLå°±ç»ª
      wait_for:
        port: 3306
        host: localhost
        timeout: 60
    
    # 3ï¸âƒ£ å†å¯åŠ¨Webåº”ç”¨
    - name: å¯åŠ¨Webåº”ç”¨
      service:
        name: webapp
        state: started
        enabled: yes
```

**ä¾èµ–å…³ç³»å›¾ç¤º**ï¼š
```
å¯åŠ¨é¡ºåºæµç¨‹ï¼š
MySQLæ•°æ®åº“ â†’ ç­‰å¾…3306ç«¯å£ â†’ Webåº”ç”¨å¯åŠ¨
     â†“              â†“              â†“
  [å¯åŠ¨ä¸­...]   [æ£€æŸ¥è¿æ¥...]   [å¯åŠ¨æˆåŠŸ]
```

### 5.2 é…ç½®æ–‡ä»¶å˜æ›´å¤„ç†


**é…ç½®æ›´æ–°åé‡è½½æœåŠ¡**ï¼š
```yaml
- name: æ›´æ–°nginxé…ç½®å¹¶é‡è½½
  hosts: webservers
  tasks:
    # 1ï¸âƒ£ å¤‡ä»½åŸé…ç½®
    - name: å¤‡ä»½ç°æœ‰é…ç½®
      copy:
        src: /etc/nginx/nginx.conf
        dest: /etc/nginx/nginx.conf.bak
        remote_src: yes
    
    # 2ï¸âƒ£ æ›´æ–°é…ç½®æ–‡ä»¶
    - name: æ›´æ–°nginxé…ç½®
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      notify: reload nginx
    
    # 3ï¸âƒ£ éªŒè¯é…ç½®è¯­æ³•
    - name: éªŒè¯nginxé…ç½®è¯­æ³•
      command: nginx -t
      register: nginx_syntax
      
    # 4ï¸âƒ£ é‡è½½æœåŠ¡
    - name: é‡è½½nginxé…ç½®
      service:
        name: nginx
        state: reloaded
      when: nginx_syntax.rc == 0
```

### 5.3 æœåŠ¡ç»„ç®¡ç†


**æ‰¹é‡ç®¡ç†ç›¸å…³æœåŠ¡**ï¼š
```yaml
- name: WebæœåŠ¡æ ˆç®¡ç†
  hosts: webservers
  vars:
    web_services:
      - nginx
      - php-fpm
      - redis
      - mysql
  
  tasks:
    - name: å¯åŠ¨æ‰€æœ‰Webç›¸å…³æœåŠ¡
      service:
        name: "{{ item }}"
        state: started
        enabled: yes
      loop: "{{ web_services }}"
    
    - name: éªŒè¯æ‰€æœ‰æœåŠ¡çŠ¶æ€
      service:
        name: "{{ item }}"
      register: service_status
      loop: "{{ web_services }}"
```

---

## 6. ğŸ› ï¸ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 WebæœåŠ¡å™¨éƒ¨ç½²è‡ªåŠ¨åŒ–


```yaml
- name: å®Œæ•´WebæœåŠ¡å™¨éƒ¨ç½²
  hosts: webservers
  become: yes
  
  tasks:
    # ç¯å¢ƒæ¸…ç†
    - name: åœæ­¢å†²çªæœåŠ¡
      service:
        name: "{{ item }}"
        state: stopped
        enabled: no
      loop:
        - apache2
        - lighttpd
      ignore_errors: yes
    
    # æ ¸å¿ƒæœåŠ¡å¯åŠ¨
    - name: å¯åŠ¨WebæœåŠ¡æ ˆ
      service:
        name: "{{ item.name }}"
        state: "{{ item.state }}"
        enabled: "{{ item.enabled }}"
      loop:
        - {name: nginx, state: started, enabled: yes}
        - {name: mysql, state: started, enabled: yes}
        - {name: php-fpm, state: started, enabled: yes}
    
    # å¥åº·æ£€æŸ¥
    - name: éªŒè¯æœåŠ¡ç«¯å£
      wait_for:
        port: "{{ item }}"
        timeout: 30
      loop: [80, 443, 3306, 9000]
```

### 6.2 ç³»ç»Ÿç»´æŠ¤åœºæ™¯


#### ğŸ”„ æœåŠ¡æ›´æ–°é‡å¯

```yaml
- name: åº”ç”¨æ›´æ–°åé‡å¯æœåŠ¡
  hosts: production
  serial: 1  # é€å°æ›´æ–°ï¼Œé¿å…æœåŠ¡ä¸­æ–­
  
  tasks:
    - name: é‡å¯åº”ç”¨æœåŠ¡
      service:
        name: myapp
        state: restarted
    
    - name: ç­‰å¾…æœåŠ¡æ¢å¤
      wait_for:
        port: 8080
        timeout: 120
    
    - name: å¥åº·æ£€æŸ¥
      uri:
        url: "http://localhost:8080/health"
        method: GET
      register: health_check
      
    - name: ç¡®è®¤æœåŠ¡æ­£å¸¸
      fail:
        msg: "æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥"
      when: health_check.status != 200
```

#### ğŸš¨ ç´§æ€¥æ•…éšœæ¢å¤

```yaml
- name: ç´§æ€¥æœåŠ¡æ¢å¤
  hosts: emergency
  
  tasks:
    - name: å¼ºåˆ¶é‡å¯æ•…éšœæœåŠ¡
      systemd:
        name: "{{ failed_service }}"
        state: restarted
        daemon_reload: yes
    
    - name: æ¸…ç†ä¸´æ—¶æ–‡ä»¶
      file:
        path: /tmp/{{ failed_service }}.lock
        state: absent
    
    - name: éªŒè¯æœåŠ¡æ¢å¤
      service:
        name: "{{ failed_service }}"
      register: recovery_status
      
    - debug:
        msg: "æœåŠ¡æ¢å¤çŠ¶æ€ï¼š{{ recovery_status.status }}"
```

### 6.3 å®‰å…¨åŠ å›ºåœºæ™¯


```yaml
- name: ç³»ç»ŸæœåŠ¡å®‰å…¨åŠ å›º
  hosts: production
  
  tasks:
    # ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
    - name: ç¦ç”¨ä¸å®‰å…¨çš„æœåŠ¡
      service:
        name: "{{ item }}"
        state: stopped
        enabled: no
      loop:
        - telnet
        - rsh
        - rlogin
      ignore_errors: yes
    
    # å½»åº•å±è”½å±é™©æœåŠ¡
    - name: æ©ç å±é™©æœåŠ¡
      systemd:
        name: "{{ item }}"
        masked: yes
      loop:
        - telnet.socket
        - rsh.socket
    
    # ç¡®ä¿å®‰å…¨æœåŠ¡è¿è¡Œ
    - name: ç¡®ä¿å®‰å…¨æœåŠ¡è¿è¡Œ
      service:
        name: "{{ item }}"
        state: started
        enabled: yes
      loop:
        - ssh
        - firewalld
        - fail2ban
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æœåŠ¡ç®¡ç†æœ¬è´¨ï¼šæ§åˆ¶åå°ç¨‹åºçš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯
ğŸ”¸ ä¸¤å¤§æ¨¡å—é€‰æ‹©ï¼šserviceé€šç”¨å…¼å®¹ï¼ŒsystemdåŠŸèƒ½å¼ºå¤§
ğŸ”¸ çŠ¶æ€æ“ä½œç†è§£ï¼šstarted/stopped/restarted/reloadedå«ä¹‰
ğŸ”¸ è‡ªå¯åŠ¨é…ç½®ï¼šenabledæ§åˆ¶å¼€æœºæ˜¯å¦è‡ªåŠ¨å¯åŠ¨æœåŠ¡
ğŸ”¸ ä¾èµ–å…³ç³»å¤„ç†ï¼šåˆç†å®‰æ’æœåŠ¡å¯åŠ¨é¡ºåº
```

### 7.2 å…³é”®æ“ä½œè¦ç‚¹


**ğŸ”¹ serviceæ¨¡å—æœ€ä½³å®è·µ**ï¼š
```yaml
# âœ… æ¨èå†™æ³•ï¼šæ˜ç¡®æŒ‡å®šçŠ¶æ€å’Œè‡ªå¯åŠ¨
- service:
    name: nginx
    state: started
    enabled: yes

# âŒ é¿å…å†™æ³•ï¼šåªæŒ‡å®šnameï¼ŒçŠ¶æ€ä¸æ˜ç¡®
- service:
    name: nginx
```

**ğŸ”¹ systemdæ¨¡å—é«˜çº§ç”¨æ³•**ï¼š
```yaml
# ç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½®
- systemd:
    name: myapp
    state: started
    enabled: yes
    daemon_reload: yes  # ç¡®ä¿é…ç½®æœ€æ–°
```

**ğŸ”¹ æœåŠ¡æ“ä½œå®‰å…¨åŸåˆ™**ï¼š
```
âš ï¸ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹ï¼š
- é‡å¯å‰å…ˆå¤‡ä»½é…ç½®
- ä½¿ç”¨reloadä»£æ›¿restartï¼ˆå¦‚æœæ”¯æŒï¼‰
- ä¸²è¡Œæ“ä½œé¿å…æœåŠ¡å…¨ä¸­æ–­
- æ“ä½œåå¿…é¡»éªŒè¯æœåŠ¡çŠ¶æ€
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‚ç”¨åœºæ™¯åˆ¤æ–­**ï¼š
```
âœ… ä½¿ç”¨serviceæ¨¡å—ï¼š
- è·¨Linuxå‘è¡Œç‰ˆå…¼å®¹
- åŸºç¡€çš„å¯åœæ“ä½œ
- ç®€å•çš„æœåŠ¡ç®¡ç†

âœ… ä½¿ç”¨systemdæ¨¡å—ï¼š
- ç°ä»£Linuxç³»ç»Ÿï¼ˆCentOS7+ï¼‰
- éœ€è¦é«˜çº§åŠŸèƒ½ï¼ˆæ©ç ã€ç”¨æˆ·æœåŠ¡ï¼‰
- å¤æ‚çš„æœåŠ¡é…ç½®
```

**å¸¸è§é—®é¢˜é¿å…**ï¼š
```
ğŸš¨ å…¸å‹é”™è¯¯ï¼š
1. å¿˜è®°è®¾ç½®enabledï¼Œé‡å¯åæœåŠ¡ä¸è‡ªå¯
2. é…ç½®æ–‡ä»¶ä¿®æ”¹åå¿˜è®°reload
3. æ²¡æœ‰éªŒè¯ç«¯å£ç›‘å¬çŠ¶æ€
4. æœåŠ¡ä¾èµ–å…³ç³»å¤„ç†ä¸å½“

âœ… è§£å†³æ–¹æ¡ˆï¼š
1. å¯åŠ¨æœåŠ¡æ—¶åŒæ—¶è®¾ç½®enabled: yes
2. é…ç½®å˜æ›´åä½¿ç”¨notifyè§¦å‘reload
3. ç”¨wait_foræ¨¡å—éªŒè¯ç«¯å£çŠ¶æ€
4. æ˜ç¡®æœåŠ¡å¯åŠ¨é¡ºåºï¼ŒåŠ å…¥ç­‰å¾…æœºåˆ¶
```

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ¯ å­¦ä¹ æ­¥éª¤**ï¼š
1. **åŸºç¡€æŒæ¡** - serviceæ¨¡å—çš„åŸºæœ¬æ“ä½œ
2. **è¿›é˜¶å­¦ä¹ ** - systemdæ¨¡å—çš„é«˜çº§åŠŸèƒ½
3. **å®æˆ˜ç»ƒä¹ ** - ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯
4. **è¿ç»´é›†æˆ** - é…åˆå…¶ä»–æ¨¡å—ä½¿ç”¨

**ğŸ”— ç›¸å…³æ¨¡å—å­¦ä¹ **ï¼š
- `wait_for` - ç«¯å£å’ŒæœåŠ¡æ£€æŸ¥
- `uri` - HTTPå¥åº·æ£€æŸ¥
- `template` - é…ç½®æ–‡ä»¶ç®¡ç†
- `copy` - æ–‡ä»¶å¤‡ä»½æ“ä½œ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æœåŠ¡ç®¡ç†è¦ç‰¢è®°ï¼Œå¯åœé‡è½½è¦åˆ†æ¸…
started stoppedè¦æ˜ç¡®ï¼Œrestarted reloadedåˆ«ææ··
enabledè®¾ç½®å¼€æœºå¯ï¼Œä¾èµ–å…³ç³»è¦ç†é¡º
systemdåŠŸèƒ½æ›´å¼ºå¤§ï¼Œç°ä»£ç³»ç»Ÿé¦–é€‰å®ƒ
```