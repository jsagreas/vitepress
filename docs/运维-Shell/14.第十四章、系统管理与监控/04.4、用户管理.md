---
title: 4、用户管理
---
## 📚 目录

1. [用户管理基础概念](#1-用户管理基础概念)
2. [用户账户操作](#2-用户账户操作)
3. [用户组管理](#3-用户组管理)
4. [权限提升与切换](#4-权限提升与切换)
5. [用户权限控制](#5-用户权限控制)
6. [用户配额与策略](#6-用户配额与策略)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🏠 用户管理基础概念


### 1.1 Linux用户系统架构


**💡 核心概念**
```
Linux是多用户操作系统，每个用户都有：
• 唯一的用户标识符（UID）
• 属于一个或多个用户组（GID）
• 独立的家目录（Home Directory）
• 特定的Shell环境和权限
```

**🔍 用户系统结构图**
```
系统用户架构
├── root用户（UID=0）      ← 超级管理员，拥有所有权限
├── 系统用户（UID 1-999）   ← 系统服务专用账户
└── 普通用户（UID≥1000）    ← 真实用户账户

用户组结构
├── 主用户组（Primary Group）  ← 用户创建文件时的默认组
└── 附加用户组（Secondary）    ← 用户可以加入的其他组
```

### 1.2 用户信息存储文件


**📁 重要系统文件**

| 文件路径 | **作用** | **格式说明** |
|---------|---------|-------------|
| `/etc/passwd` | `用户基本信息` | `用户名:密码:UID:GID:描述:家目录:Shell` |
| `/etc/shadow` | `用户密码信息` | `用户名:加密密码:最后修改日期:...` |
| `/etc/group` | `用户组信息` | `组名:密码:GID:组成员` |
| `/etc/gshadow` | `用户组密码` | `组名:加密密码:组管理员:组成员` |

**🔍 文件内容示例**
```bash
# /etc/passwd 示例
root:x:0:0:root:/root:/bin/bash
john:x:1000:1000:John Doe:/home/john:/bin/bash
mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false

# /etc/group 示例  
root:x:0:
users:x:100:
john:x:1000:
```

### 1.3 用户类型分类


**👥 用户分类详解**

**🔸 Root用户（超级用户）**
```
特征：UID = 0
权限：系统最高权限，可以执行任何操作
用途：系统管理、软件安装、配置修改
风险：权限过大，误操作可能损坏系统
```

**🔸 系统用户（服务用户）**
```
特征：UID通常在1-999之间
权限：特定服务的运行权限
用途：运行系统服务（如apache、mysql等）
特点：通常不能登录系统（Shell为/bin/false）
```

**🔸 普通用户**
```
特征：UID通常从1000开始
权限：有限的系统权限，主要在自己的家目录
用途：日常工作、文件操作
限制：无法修改系统配置，需要sudo提权
```

---

## 2. 👤 用户账户操作


### 2.1 添加用户 - useradd命令


**📝 基本语法**
```bash
useradd [选项] 用户名
```

**⚙️ 常用选项详解**

| 选项 | **含义** | **示例** |
|------|---------|---------|
| `-u` | `指定UID` | `useradd -u 1500 tom` |
| `-g` | `指定主用户组` | `useradd -g users tom` |
| `-G` | `指定附加用户组` | `useradd -G wheel,audio tom` |
| `-d` | `指定家目录` | `useradd -d /home/tommy tom` |
| `-s` | `指定登录Shell` | `useradd -s /bin/bash tom` |
| `-c` | `添加用户描述` | `useradd -c "Tom Smith" tom` |
| `-m` | `创建家目录` | `useradd -m tom` |

**💡 实际使用示例**
```bash
# 创建普通用户（推荐方式）
useradd -m -s /bin/bash -c "Tom Smith" tom

# 创建系统服务用户
useradd -r -s /bin/false -c "Web Server" webuser

# 创建用户并指定多个组
useradd -m -G wheel,users,audio tom
```

**🔍 创建用户后的验证**
```bash
# 查看用户信息
id tom
# 输出：uid=1000(tom) gid=1000(tom) groups=1000(tom)

# 检查家目录是否创建
ls -la /home/tom

# 查看用户在passwd文件中的记录
grep tom /etc/passwd
```

### 2.2 修改用户 - usermod命令


**📝 基本语法**
```bash
usermod [选项] 用户名
```

**⚙️ 常用修改操作**

**🔸 修改用户基本信息**
```bash
# 修改用户描述
usermod -c "Thomas Smith" tom

# 修改用户家目录
usermod -d /home/thomas -m tom  # -m表示移动原有文件

# 修改用户Shell
usermod -s /bin/zsh tom

# 修改用户UID
usermod -u 1500 tom
```

**🔸 用户组管理**
```bash
# 修改主用户组
usermod -g developers tom

# 添加到附加用户组
usermod -aG wheel tom        # -a表示追加，不覆盖

# 设置附加用户组（覆盖原有）
usermod -G wheel,users tom   # 注意：没有-a会覆盖

# 从用户组中移除用户
gpasswd -d tom wheel
```

**🔸 账户状态管理**
```bash
# 锁定用户账户
usermod -L tom

# 解锁用户账户  
usermod -U tom

# 设置账户过期时间
usermod -e 2024-12-31 tom
```

### 2.3 删除用户 - userdel命令


**📝 基本语法**
```bash
userdel [选项] 用户名
```

**⚙️ 删除选项说明**
```bash
# 仅删除用户账户，保留家目录
userdel tom

# 删除用户账户和家目录
userdel -r tom

# 强制删除用户（即使用户已登录）
userdel -f tom
```

**⚠️ 删除用户前的检查**
```bash
# 检查用户是否正在运行进程
ps -u tom

# 检查用户拥有的文件
find / -user tom 2>/dev/null

# 检查计划任务
crontab -l -u tom
```

### 2.4 密码管理 - passwd命令


**📝 基本语法**
```bash
passwd [选项] [用户名]
```

**🔐 密码操作详解**

**🔸 设置和修改密码**
```bash
# 修改当前用户密码
passwd

# 修改指定用户密码（需要root权限）
passwd tom

# 批量设置密码（从标准输入读取）
echo "newpassword" | passwd --stdin tom
```

**🔸 密码状态管理**
```bash
# 锁定用户密码
passwd -l tom

# 解锁用户密码
passwd -u tom

# 删除用户密码（设为空密码）
passwd -d tom

# 强制用户下次登录修改密码
passwd -e tom
```

**🔸 密码信息查询**
```bash
# 查看密码状态
passwd -S tom
# 输出示例：tom PS 2024-01-15 0 99999 7 -1

# 查看所有用户密码状态
passwd -Sa
```

---

## 3. 👥 用户组管理


### 3.1 用户组基础概念


**💡 用户组的作用**
```
用户组是Linux权限管理的重要机制：
• 简化权限管理：一次设置，多个用户受益
• 资源共享：组内用户可共享文件和目录
• 安全控制：限制特定功能的访问权限
• 管理效率：批量管理多个用户权限
```

**🔍 用户组类型**
```
主用户组（Primary Group）：
• 用户创建文件时的默认组
• 每个用户只能有一个主组
• 用户登录时的有效组ID

附加用户组（Secondary Groups）：
• 用户可以同时属于多个附加组
• 通过newgrp命令可以切换有效组
• 最多可以属于15个附加组
```

### 3.2 创建用户组 - groupadd命令


**📝 基本语法**
```bash
groupadd [选项] 组名
```

**⚙️ 常用选项**
```bash
# 创建普通用户组
groupadd developers

# 指定GID创建用户组
groupadd -g 2000 webgroup

# 创建系统用户组
groupadd -r sysgroup

# 强制创建（即使组已存在）
groupadd -f developers
```

### 3.3 修改用户组 - groupmod命令


**📝 基本语法**
```bash
groupmod [选项] 组名
```

**⚙️ 修改操作**
```bash
# 修改组名
groupmod -n newname oldname

# 修改组的GID
groupmod -g 3000 developers

# 修改组密码
gpasswd developers
```

### 3.4 删除用户组 - groupdel命令


**📝 删除操作**
```bash
# 删除用户组
groupdel developers

# 注意：如果组是某个用户的主组，无法删除
# 需要先修改用户的主组或删除用户
```

### 3.5 用户组成员管理


**👥 添加和删除组成员**
```bash
# 将用户添加到用户组
gpasswd -a tom developers

# 从用户组移除用户
gpasswd -d tom developers

# 批量设置组成员（覆盖原有成员）
gpasswd -M tom,jerry,bob developers

# 查看用户属于哪些组
groups tom

# 查看组的成员
getent group developers
```

**🔄 切换用户组**
```bash
# 切换到指定用户组
newgrp developers

# 查看当前有效用户组
id

# 退出当前组（返回主组）
exit
```

---

## 4. 🔄 权限提升与切换


### 4.1 用户切换 - su命令


**📝 基本语法**
```bash
su [选项] [用户名]
```

**🔍 su命令详解**

**🔸 切换用户方式**
```bash
# 切换到root用户（不改变环境变量）
su

# 切换到root用户（完全切换环境）
su -

# 切换到指定用户
su tom

# 切换到指定用户（完全切换环境）
su - tom
```

**🔸 执行单个命令**
```bash
# 以root身份执行命令
su -c "systemctl restart nginx"

# 以指定用户身份执行命令
su - tom -c "ls /home/tom"
```

**💡 su与su -的区别**
```
su：只切换用户，保留当前环境变量
• 优点：快速切换
• 缺点：可能导致权限问题

su -：完全切换用户环境
• 优点：完整的用户环境
• 缺点：需要重新加载配置
```

### 4.2 权限提升 - sudo命令


**📝 基本语法**
```bash
sudo [选项] 命令
```

**💡 sudo核心概念**
```
sudo允许普通用户以其他用户身份执行命令：
• 更安全：不需要知道root密码
• 更灵活：可以精确控制权限
• 更可审计：所有操作都有日志记录
• 更方便：避免频繁的用户切换
```

**🔸 sudo基本使用**
```bash
# 以root身份执行命令
sudo systemctl start nginx

# 以指定用户身份执行命令
sudo -u tom ls /home/tom

# 切换到root用户
sudo -i

# 以root身份打开Shell
sudo -s

# 更新sudo权限缓存
sudo -v

# 清除sudo权限缓存
sudo -k
```

### 4.3 sudo配置 - /etc/sudoers


**📁 配置文件结构**
```
/etc/sudoers文件格式：
用户/组  主机=(运行身份)  命令

示例：
tom    ALL=(ALL)    ALL        # tom可以执行所有命令
%wheel ALL=(ALL)    ALL        # wheel组成员可以执行所有命令
```

**⚙️ 安全编辑sudoers**
```bash
# 使用visudo编辑（推荐，有语法检查）
visudo

# 检查sudoers文件语法
visudo -c
```

**🔍 常用sudo配置示例**
```bash
# 允许用户无密码执行所有命令
tom ALL=(ALL) NOPASSWD: ALL

# 允许用户执行特定命令
tom ALL=(ALL) /bin/systemctl, /usr/bin/vim

# 允许用户组成员执行系统管理命令
%sysadmin ALL=(ALL) /bin/systemctl, /usr/sbin/service

# 允许在特定主机执行命令
tom webserver1=(ALL) ALL
```

**📊 sudo权限配置对比**

| 配置类型 | **安全性** | **便利性** | **适用场景** |
|---------|-----------|-----------|-------------|
| `需要密码` | `高` | `中` | `生产环境` |
| `无需密码` | `中` | `高` | `开发环境` |
| `特定命令` | `最高` | `低` | `严格环境` |

---

## 5. 🔐 用户权限控制


### 5.1 文件权限基础


**📝 权限位详解**
```
Linux文件权限显示格式：drwxrwxrwx
├─ d：文件类型（d=目录，-=普通文件，l=链接）
├─ rwx：所有者权限（读、写、执行）
├─ rwx：用户组权限
└─ rwx：其他用户权限

权限数字表示：
r(读) = 4
w(写) = 2  
x(执行) = 1
```

**🔍 权限示例解读**
```bash
-rw-r--r-- 1 tom users 1024 Jan 15 10:30 file.txt
│││││││││
│││││││└─ 其他用户权限：r--（只读）
│││││└──── 用户组权限：r--（只读）
││││└───── 所有者权限：rw-（读写）
│││└────── 硬链接数
││└─────── 用户组：users
│└──────── 所有者：tom
└───────── 文件类型：-（普通文件）
```

### 5.2 权限修改 - chmod命令


**🔧 权限修改方法**

**🔸 数字方式修改权限**
```bash
# 设置文件权限为755（rwxr-xr-x）
chmod 755 script.sh

# 设置文件权限为644（rw-r--r--）
chmod 644 document.txt

# 递归修改目录权限
chmod -R 755 /path/to/directory
```

**🔸 符号方式修改权限**
```bash
# 给所有者添加执行权限
chmod u+x script.sh

# 给用户组移除写权限
chmod g-w file.txt

# 给其他用户设置只读权限
chmod o=r file.txt

# 给所有用户添加执行权限
chmod a+x program

# 组合操作
chmod u+rw,g+r,o-rwx sensitive.txt
```

**📊 常用权限配置**

| 权限数字 | **符号表示** | **含义** | **适用场景** |
|---------|------------|---------|-------------|
| `755` | `rwxr-xr-x` | `所有者可读写执行，其他用户可读执行` | `可执行文件` |
| `644` | `rw-r--r--` | `所有者可读写，其他用户只读` | `配置文件` |
| `600` | `rw-------` | `所有者可读写，其他用户无权限` | `私人文件` |
| `777` | `rwxrwxrwx` | `所有用户都有所有权限` | `临时共享` |

### 5.3 所有权修改 - chown命令


**📝 基本语法**
```bash
chown [选项] [用户][:组] 文件
```

**🔧 所有权修改操作**
```bash
# 修改文件所有者
chown tom file.txt

# 修改文件所有者和组
chown tom:users file.txt

# 只修改文件所属组
chown :developers file.txt

# 递归修改目录所有权
chown -R tom:users /home/tom/project

# 修改符号链接本身的所有权
chown -h tom link_file
```

### 5.4 特殊权限位


**🔐 特殊权限详解**

**🔸 SetUID（SUID）**
```
作用：执行文件时以文件所有者身份运行
权限位：s（替代x位置）
数字：4000
示例：passwd命令（普通用户可修改密码）
```

**🔸 SetGID（SGID）**
```
文件：执行时以文件所属组身份运行
目录：在目录中创建的文件继承目录的组
权限位：s（在组权限x位置）
数字：2000
```

**🔸 Sticky位**
```
作用：只有文件所有者才能删除文件
权限位：t（在其他用户x位置）
数字：1000
典型应用：/tmp目录
```

**🛠️ 特殊权限设置**
```bash
# 设置SUID权限
chmod 4755 program
chmod u+s program

# 设置SGID权限
chmod 2755 directory
chmod g+s directory

# 设置Sticky位
chmod 1777 /tmp
chmod +t shared_directory

# 组合设置多个特殊权限
chmod 6755 program  # 同时设置SUID和SGID
```

---

## 6. 💾 用户配额与策略


### 6.1 磁盘配额管理 - quota


**💡 磁盘配额概念**
```
磁盘配额用于限制用户或用户组的磁盘使用量：
• 防止单个用户占用过多磁盘空间
• 确保系统稳定运行
• 合理分配存储资源
• 避免磁盘空间耗尽
```

**📊 配额类型**
```
用户配额（User Quota）：限制单个用户的磁盘使用
组配额（Group Quota）：限制整个用户组的磁盘使用

配额限制：
软限制（Soft Limit）：超过时发出警告，允许继续使用
硬限制（Hard Limit）：绝对限制，超过时禁止写入
```

**⚙️ 配额配置基础**
```bash
# 检查文件系统是否支持配额
quotacheck -cug /home

# 启用配额功能
quotaon /home

# 设置用户配额
edquota -u tom

# 查看用户配额使用情况
quota -u tom

# 生成配额报告
repquota /home
```

### 6.2 密码策略配置


**🔐 密码复杂度要求**

**🔸 PAM密码模块配置**
```bash
# 编辑PAM配置文件
vim /etc/pam.d/passwd

# 常用密码策略模块
password requisite pam_pwquality.so retry=3
password sufficient pam_unix.so sha512 shadow
```

**🔸 密码质量配置**
```bash
# 编辑密码质量配置
vim /etc/security/pwquality.conf

# 常用配置项：
minlen = 8          # 最小长度8位
minclass = 3        # 至少包含3种字符类型
maxrepeat = 3       # 相同字符最多重复3次
dcredit = -1        # 至少包含1个数字
ucredit = -1        # 至少包含1个大写字母
lcredit = -1        # 至少包含1个小写字母
ocredit = -1        # 至少包含1个特殊字符
```

**⏰ 密码过期策略**
```bash
# 设置密码最大有效期（天）
chage -M 90 tom

# 设置密码最小更改间隔
chage -m 1 tom

# 设置密码过期前警告天数
chage -W 7 tom

# 查看用户密码策略
chage -l tom

# 批量设置默认密码策略
vim /etc/login.defs
PASS_MAX_DAYS   90
PASS_MIN_DAYS   1
PASS_WARN_AGE   7
```

### 6.3 账户锁定策略


**🔒 登录失败锁定**
```bash
# 配置登录失败锁定策略
vim /etc/pam.d/sshd

# 添加失败锁定模块
auth required pam_faillock.so preauth
auth required pam_faillock.so authfail

# 配置锁定参数
vim /etc/security/faillock.conf
deny = 5            # 失败5次后锁定
unlock_time = 900   # 锁定15分钟后自动解锁
```

**🕐 账户过期管理**
```bash
# 设置账户过期时间
usermod -e 2024-12-31 tom

# 查看账户过期信息
chage -l tom

# 禁用账户（设置过期为过去时间）
usermod -e 1 tom

# 启用账户（清除过期时间）
usermod -e "" tom
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本概念


```
🔸 用户系统：UID/GID机制，用户分类（root、系统、普通）
🔸 用户管理：useradd创建、usermod修改、userdel删除
🔸 组管理：groupadd/groupmod/groupdel，主组与附加组
🔸 权限切换：su切换用户、sudo权限提升
🔸 权限控制：chmod修改权限、chown修改所有权
🔸 安全策略：密码策略、配额管理、账户锁定
```

### 7.2 关键理解要点


**🔹 用户管理最佳实践**
```
安全原则：
• 最小权限：只给必要的权限
• 定期审查：检查无用账户和过期权限
• 强密码：设置复杂密码策略
• 日志监控：记录用户操作日志

日常管理：
• 使用sudo替代直接root登录
• 合理规划用户组结构
• 定期更新密码和检查权限
• 及时清理临时账户
```

**🔹 权限管理核心思路**
```
权限分配原则：
• 按需分配：根据工作需要分配权限
• 分层管理：通过用户组简化管理
• 定期清理：移除不需要的权限
• 文档记录：记录权限分配依据

常见权限配置：
• 系统文件：644（配置文件）、755（可执行文件）
• 用户文件：600（私人文件）、644（共享文档）
• 目录权限：755（普通目录）、1777（临时目录）
```

### 7.3 实际应用价值


**🎯 系统管理场景**
- **多用户环境**：Web服务器、开发服务器用户管理
- **安全控制**：限制用户访问权限，防止误操作
- **资源管理**：通过配额控制磁盘使用
- **自动化运维**：批量用户创建和权限管理脚本

**🔧 运维实践技巧**
```bash
# 批量创建用户脚本示例
#!/bin/bash
for user in tom jerry bob; do
    useradd -m -s /bin/bash -G users $user
    echo "password123" | passwd --stdin $user
    echo "用户 $user 创建完成"
done

# 用户权限检查脚本
#!/bin/bash
echo "检查sudo权限用户："
grep -E '^[^#]*ALL.*ALL' /etc/sudoers

echo "检查无密码登录用户："
awk -F: '$2 == "" {print $1}' /etc/shadow
```

**核心记忆**：
- 用户管理三板斧：useradd、usermod、userdel
- 权限控制双保险：文件权限+所有权控制
- 安全提升两利器：sudo配置+密码策略
- 系统维护三要点：定期检查+日志审计+权限清理