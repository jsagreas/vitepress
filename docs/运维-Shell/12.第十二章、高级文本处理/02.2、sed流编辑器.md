---
title: 2、sed流编辑器
---
## 📚 目录

1. [sed基础概念与工作原理](#1-sed基础概念与工作原理)
2. [替换命令详解](#2-替换命令详解)
3. [删除命令操作](#3-删除命令操作)
4. [插入和添加命令](#4-插入和添加命令)
5. [修改命令使用](#5-修改命令使用)
6. [地址范围精确控制](#6-地址范围精确控制)
7. [多命令执行策略](#7-多命令执行策略)
8. [原地编辑技巧](#8-原地编辑技巧)
9. [sed脚本文件编写](#9-sed脚本文件编写)
10. [sed与其他工具组合](#10-sed与其他工具组合)
11. [实战应用案例](#11-实战应用案例)
12. [核心要点总结](#12-核心要点总结)

---

## 1. 🔧 sed基础概念与工作原理


### 1.1 什么是sed

**sed**全称是**Stream Editor**（流编辑器），是Linux/Unix系统中一个强大的文本处理工具。

💡 **通俗理解**：sed就像一个"文本加工厂"，文本数据像流水一样从一端进入，经过处理后从另一端输出，整个过程**不需要打开文件**进行编辑。

🔸 **核心特点**
- **非交互式**：不需要用户手动操作，适合批量处理
- **流式处理**：逐行读取和处理文本
- **原文件不变**：默认不修改原始文件，结果输出到屏幕

### 1.2 sed的工作原理


```
文件内容 → sed处理 → 输出结果
    ↓           ↓         ↓
 原始数据    模式空间    处理结果
```

**🎯 工作流程图示**
```
输入文件        sed工作机制             输出
┌─────────┐    ┌─────────────────┐    ┌─────────┐
│ line 1  │───▶│1.读取到模式空间  │───▶│处理后的 │
│ line 2  │    │2.执行sed命令    │    │line 1   │
│ line 3  │    │3.输出结果       │    │处理后的 │
│ ...     │    │4.清空模式空间    │    │line 2   │
└─────────┘    │5.读取下一行     │    │...     │
               └─────────────────┘    └─────────┘
```

**📝 关键概念解释**
- **模式空间**：sed的工作缓冲区，每次只装载一行数据
- **逐行处理**：sed一次只处理一行，处理完输出后再处理下一行
- **自动循环**：自动重复"读取→处理→输出"的循环

### 1.3 sed命令基本语法


```bash
sed [选项] '命令' 文件名
sed [选项] -e '命令1' -e '命令2' 文件名
sed [选项] -f 脚本文件 文件名
```

**🔸 常用选项说明**
| 选项 | 作用 | 使用场景 |
|------|------|----------|
| `-n` | 静默模式，不自动输出 | 只显示匹配的行 |
| `-e` | 执行多个命令 | 一次执行多个操作 |
| `-f` | 从脚本文件读取命令 | 复杂的批处理操作 |
| `-i` | 直接修改文件内容 | 需要保存修改结果 |
| `-r` | 使用扩展正则表达式 | 复杂的模式匹配 |

---

## 2. 🔄 替换命令详解


### 2.1 替换命令基本语法

替换命令是sed最常用的功能，语法格式：

```bash
s/pattern/replacement/flags
```

**🎯 各部分含义**
- **s**：substitute（替换）命令
- **pattern**：要查找的模式（支持正则表达式）
- **replacement**：替换成的内容
- **flags**：替换标志，控制替换行为

### 2.2 基础替换操作


**📝 示例文件准备**
```bash
# 创建测试文件
cat > test.txt << EOF
hello world
hello Linux
Hello Shell
hello hello
EOF
```

**🔸 简单替换示例**
```bash
# 替换每行第一个"hello"为"hi"
sed 's/hello/hi/' test.txt
# 输出：
# hi world
# hi Linux  
# Hello Shell  # 注意：大写H不匹配
# hi hello     # 只替换第一个
```

### 2.3 替换标志详解


**🎯 常用flags说明**
| 标志 | 含义 | 示例 | 效果 |
|------|------|------|------|
| `g` | 全局替换 | `s/hello/hi/g` | 替换一行中所有匹配 |
| `数字` | 替换第N个匹配 | `s/hello/hi/2` | 只替换第2个匹配 |
| `p` | 打印替换行 | `s/hello/hi/p` | 显示发生替换的行 |
| `w file` | 写入文件 | `s/hello/hi/w new.txt` | 将替换行写入文件 |
| `i` | 忽略大小写 | `s/hello/hi/i` | 不区分大小写 |

**💡 实际操作对比**
```bash
# 全局替换
sed 's/hello/hi/g' test.txt
# 结果：hi hello → hi hi

# 替换第2个匹配
sed 's/hello/hi/2' test.txt  
# 结果：hello hello → hello hi

# 忽略大小写
sed 's/hello/hi/gi' test.txt
# 结果：Hello Shell → hi Shell
```

### 2.4 使用不同分隔符


当pattern或replacement中包含`/`字符时，可以使用其他分隔符：

```bash
# 处理文件路径时用其他分隔符更清晰
sed 's#/usr/bin#/usr/local/bin#g' file.txt
sed 's|/home/user|/home/newuser|g' file.txt
sed 's:/tmp:/var/tmp:g' file.txt
```

### 2.5 高级替换技巧


**🔸 使用正则表达式**
```bash
# 替换数字
sed 's/[0-9]/X/g' file.txt

# 替换单词边界
sed 's/\bhello\b/hi/g' file.txt

# 使用捕获组
sed 's/\([0-9]*\)-\([0-9]*\)/\2-\1/g' file.txt
# 效果：123-456 变为 456-123
```

**🔸 特殊字符处理**
```bash
# 在replacement中使用特殊字符
sed 's/hello/& world/' test.txt  # &代表匹配的内容
sed 's/hello/\U&/' test.txt      # \U转换为大写
sed 's/hello/\L&/' test.txt      # \L转换为小写
```

---

## 3. 🗑️ 删除命令操作


### 3.1 删除命令基础

删除命令使用`d`，可以删除指定的行。

**🎯 基本语法**
```bash
[地址]d
```

### 3.2 各种删除操作


**🔸 按行号删除**
```bash
# 删除第3行
sed '3d' file.txt

# 删除第2-5行
sed '2,5d' file.txt

# 删除最后一行
sed '$d' file.txt

# 删除第1行和最后一行
sed '1d;$d' file.txt
```

**🔸 按模式删除**
```bash
# 删除包含"hello"的行
sed '/hello/d' file.txt

# 删除空行
sed '/^$/d' file.txt

# 删除以#开头的注释行
sed '/^#/d' file.txt

# 删除匹配范围内的行
sed '/start/,/end/d' file.txt
```

**💡 实用删除技巧**
```bash
# 删除重复的空行（保留一个空行）
sed '/./,/^$/!d' file.txt

# 删除文件开头的空行
sed '/./,$!d' file.txt

# 删除文件末尾的空行
sed -e :a -e '/^\s*$/N;ba' -e 's/\n\s*$//' file.txt
```

---

## 4. ➕ 插入和添加命令


### 4.1 插入命令(i)和添加命令(a)


**🔸 命令区别**
- **i命令**：在指定行**之前**插入新行
- **a命令**：在指定行**之后**添加新行

### 4.2 基本插入和添加操作


```bash
# 在第2行前插入新行
sed '2i\这是插入的新行' file.txt

# 在第2行后添加新行  
sed '2a\这是添加的新行' file.txt

# 在匹配行前插入
sed '/pattern/i\插入的内容' file.txt

# 在匹配行后添加
sed '/pattern/a\添加的内容' file.txt
```

### 4.3 插入多行内容


```bash
# 方法1：使用\n
sed '2i\第一行新内容\n第二行新内容' file.txt

# 方法2：多个命令
sed -e '2i\第一行新内容' -e '2i\第二行新内容' file.txt

# 方法3：在脚本中使用
cat > insert.sed << EOF
2i\
第一行新内容
第二行新内容
EOF
sed -f insert.sed file.txt
```

### 4.4 实际应用场景


**🎯 配置文件处理**
```bash
# 在配置文件开头添加注释
sed '1i\# 配置文件修改于 2025-09-19' config.txt

# 在特定配置后添加新配置项
sed '/\[database\]/a\host=localhost\nport=3306' config.ini
```

---

## 5. 🔧 修改命令使用


### 5.1 修改命令(c)基础

修改命令`c`用于替换整行内容。

**🎯 基本语法**
```bash
[地址]c\新内容
```

### 5.2 修改操作示例


```bash
# 替换第3行
sed '3c\这是新的第3行内容' file.txt

# 替换匹配的行
sed '/old pattern/c\新的行内容' file.txt

# 替换一个范围的行
sed '2,4c\这些行都被替换为同一行' file.txt
```

**⚠️ 注意事项**：使用地址范围时，整个范围的所有行会被替换为一行新内容。

### 5.3 修改命令实际应用


```bash
# 替换错误配置行
sed '/error_config/c\correct_config=true' config.txt

# 修改特定用户信息
sed '/^olduser:/c\newuser:x:1000:1000:New User:/home/newuser:/bin/bash' /etc/passwd
```

---

## 6. 📍 地址范围精确控制


### 6.1 地址类型详解


**🔸 数字地址**
```bash
sed '5d' file.txt           # 第5行
sed '2,8d' file.txt         # 第2行到第8行
sed '3,$d' file.txt         # 第3行到文件结尾
sed '$d' file.txt           # 最后一行
```

**🔸 正则地址**
```bash
sed '/pattern/d' file.txt                    # 匹配pattern的行
sed '/start/,/end/d' file.txt               # 从start到end的行
sed '/pattern/,5d' file.txt                 # 从匹配行到第5行
sed '2,/pattern/d' file.txt                 # 从第2行到匹配行
```

### 6.2 高级地址使用


**🎯 步长地址**
```bash
# 每隔一行处理一次（从第1行开始）
sed '1~2d' file.txt         # 删除奇数行

# 每隔两行处理一次（从第2行开始）
sed '2~3d' file.txt         # 删除第2,5,8...行
```

**🎯 反向地址**
```bash
# 处理不匹配的行
sed '/pattern/!d' file.txt   # 删除不包含pattern的行
sed '1,5!d' file.txt         # 删除不在1-5行范围内的行
```

### 6.3 地址组合技巧


```bash
# 多个独立地址
sed '1d;3d;5d' file.txt      # 删除第1,3,5行

# 地址范围组合  
sed '1,3d;7,9d' file.txt     # 删除1-3行和7-9行

# 模式和数字组合
sed '/ERROR/,+2d' file.txt   # 删除ERROR行及其后2行
sed '/START/,-1d' file.txt   # 从START行到前一行
```

---

## 7. 🔀 多命令执行策略


### 7.1 多命令执行方法


**🔸 使用-e选项**
```bash
sed -e 's/old/new/g' -e '/empty/d' -e '1i\Header' file.txt
```

**🔸 使用分号分隔**
```bash
sed 's/old/new/g; /empty/d; 1i\Header' file.txt
```

**🔸 使用换行分隔**
```bash
sed '
s/old/new/g
/empty/d  
1i\Header
' file.txt
```

### 7.2 命令执行顺序


**💡 重要概念**：sed命令按顺序执行，每个命令都在前一个命令的结果基础上操作。

```bash
# 示例：多步处理
sed -e 's/hello/hi/g' -e 's/hi/hello/g' file.txt
# 结果：所有hello都变成了hello（先变hi，再变回hello）

# 正确的处理方式
sed -e 's/hello/TEMP/g' -e 's/hi/hello/g' -e 's/TEMP/hi/g' file.txt
```

### 7.3 复杂处理示例


```bash
# 综合处理：删除注释、空行，替换关键词
sed -e '/^#/d' -e '/^$/d' -e 's/old_version/new_version/g' config.txt

# 格式化处理：统一缩进，删除多余空格
sed -e 's/^[[:space:]]*/    /' -e 's/[[:space:]]*$//' -e '/^$/d' file.txt
```

---

## 8. 💾 原地编辑技巧


### 8.1 原地编辑基础


**🔸 -i选项的作用**
- 直接修改源文件内容
- 不输出到屏幕，而是保存到原文件
- ⚠️ **危险操作**：会永久改变文件内容

### 8.2 安全的原地编辑


```bash
# 创建备份文件后编辑
sed -i.bak 's/old/new/g' file.txt
# 结果：创建file.txt.bak备份，修改file.txt

# 使用日期做备份后缀
sed -i.$(date +%Y%m%d) 's/old/new/g' file.txt
# 结果：创建file.txt.20250919备份
```

### 8.3 批量文件处理


```bash
# 批量处理多个文件
sed -i 's/old/new/g' *.txt

# 处理特定目录下的文件
find /path/to/files -name "*.conf" -exec sed -i 's/old/new/g' {} \;

# 结合grep先过滤再处理
grep -l "pattern" *.txt | xargs sed -i 's/old/new/g'
```

### 8.4 原地编辑最佳实践


**✅ 推荐做法**
```bash
# 1. 先测试命令
sed 's/old/new/g' file.txt | head -10

# 2. 创建备份
cp file.txt file.txt.backup

# 3. 执行原地编辑
sed -i 's/old/new/g' file.txt

# 4. 验证结果
diff file.txt.backup file.txt
```

---

## 9. 📄 sed脚本文件编写


### 9.1 脚本文件基础


**🔸 创建sed脚本**
```bash
# 创建脚本文件
cat > cleanup.sed << 'EOF'
# 删除注释行
/^#/d
# 删除空行
/^$/d  
# 替换制表符为4个空格
s/\t/    /g
# 删除行尾空格
s/[[:space:]]*$//
EOF

# 执行脚本
sed -f cleanup.sed input.txt
```

### 9.2 复杂脚本示例


**🎯 日志处理脚本**
```bash
cat > log_process.sed << 'EOF'
#!/bin/sed -f
# 日志文件处理脚本

# 删除调试信息
/DEBUG/d

# 统一时间格式 
s/\([0-9]\{4\}\)-\([0-9]\{2\}\)-\([0-9]\{2\}\)/\1\/\2\/\3/g

# 高亮错误信息
s/ERROR/[ERROR]/g
s/WARNING/[WARN]/g

# 删除多余的空行
/^$/N
/^\n$/d
EOF

chmod +x log_process.sed
./log_process.sed access.log
```

### 9.3 脚本文件组织技巧


**🔸 模块化处理**
```bash
# 基础清理脚本
cat > basic_clean.sed << 'EOF'
/^#/d
/^$/d
s/[[:space:]]*$//
EOF

# 特定处理脚本
cat > specific_process.sed << 'EOF'  
s/old_term/new_term/g
/pattern/c\replacement line
EOF

# 组合使用
sed -f basic_clean.sed -f specific_process.sed input.txt
```

---

## 10. 🔗 sed与其他工具组合


### 10.1 与grep组合


```bash
# 先过滤再处理
grep "ERROR" log.txt | sed 's/.*ERROR: //'

# 处理grep的结果
grep -n "pattern" file.txt | sed 's/:/ -> /'
```

### 10.2 与awk组合


```bash
# sed预处理，awk进一步分析
sed 's/,/ /g' data.csv | awk '{print $2, $4}'

# awk提取，sed格式化
awk '{print $1}' file.txt | sed 's/^/User: /'
```

### 10.3 与find组合


```bash
# 查找文件并批量处理
find . -name "*.txt" -exec sed -i 's/old/new/g' {} \;

# 更安全的方式
find . -name "*.txt" -print0 | xargs -0 sed -i.bak 's/old/new/g'
```

### 10.4 在管道中的使用


```bash
# 复杂的管道处理
cat input.txt | 
    sed '/^#/d' |           # 删除注释
    sed 's/  */ /g' |       # 合并多个空格
    sed 's/^[[:space:]]*//' | # 删除行首空格
    sort | uniq             # 排序去重
```

---

## 11. 💼 实战应用案例


### 11.1 配置文件处理


**🎯 案例1：批量修改配置**
```bash
# 场景：修改多个配置文件的数据库连接
for config in /etc/app/*.conf; do
    sed -i.bak \
        -e 's/host=.*/host=localhost/' \
        -e 's/port=.*/port=3306/' \
        -e '/^$/d' \
        "$config"
done
```

### 11.2 日志文件清理


**🎯 案例2：日志文件标准化**
```bash
# 清理Apache访问日志
sed -i \
    -e 's/\[/|/g' \
    -e 's/\]/|/g' \
    -e 's/  */ /g' \
    -e '/bot/d' \
    access.log
```

### 11.3 数据格式转换


**🎯 案例3：CSV格式转换**
```bash
# 将空格分隔转为CSV格式
sed -e 's/[[:space:]]\+/,/g' -e 's/,$//' data.txt > data.csv

# 处理带引号的字段
sed -e 's/,/","/g' -e 's/^/"/' -e 's/$/"/' data.txt
```

### 11.4 代码批量重构


**🎯 案例4：代码重命名**
```bash
# 批量重命名函数
find . -name "*.py" -exec sed -i \
    -e 's/old_function/new_function/g' \
    -e 's/OLD_CONSTANT/NEW_CONSTANT/g' \
    {} \;
```

---

## 12. 📋 核心要点总结


### 12.1 必须掌握的核心概念


```
🔸 sed本质：流编辑器，逐行处理文本数据
🔸 工作原理：读取→模式空间→处理→输出→循环
🔸 基本命令：s(替换)、d(删除)、i/a(插入/添加)、c(修改)
🔸 地址范围：数字地址、正则地址、组合地址
🔸 执行方式：单命令、多命令(-e)、脚本文件(-f)
🔸 原地编辑：-i选项直接修改文件(需谨慎使用)
```

### 12.2 关键理解要点


**🔹 sed的处理特点**
- **非交互式**：适合自动化脚本和批处理
- **流式处理**：内存占用小，适合大文件处理  
- **模式匹配**：强大的正则表达式支持
- **原文件保护**：默认不修改原文件，除非使用-i

**🔹 命令使用技巧**
- **替换命令**：掌握flags的使用，特别是g(全局)和i(忽略大小写)
- **地址范围**：灵活使用数字、正则、组合地址定位
- **多命令执行**：理解命令执行顺序，避免相互干扰
- **脚本编写**：复杂处理写成脚本文件，便于重用和维护

### 12.3 实际应用指导


**✅ sed的最佳使用场景**
- 批量文本替换和格式化
- 日志文件处理和清理
- 配置文件批量修改
- 数据格式转换
- 自动化脚本中的文本处理

**⚠️ 使用注意事项**
- 使用`-i`前务必备份重要文件
- 复杂正则表达式要仔细测试
- 大文件处理时注意内存使用
- 结合其他工具使用效果更佳

### 12.4 学习进阶路径


**🎯 掌握层级**
1. **🌟 基础层**：替换、删除基本操作
2. **🔥 进阶层**：地址范围、多命令组合
3. **⚡ 高级层**：脚本编写、工具组合
4. **💀 专家层**：高级模式空间操作、性能优化

**📚 继续学习建议**
- 深入学习正则表达式
- 掌握awk和grep的协作使用
- 学习sed的高级命令(N、P、H等)
- 实践更多实际项目场景

**核心记忆口诀**：
```
sed流编辑很强大，逐行处理不打开
s替换d删除，i插入a添加
地址范围要精确，多命令组合有技巧  
原地编辑需谨慎，脚本文件可重用
```