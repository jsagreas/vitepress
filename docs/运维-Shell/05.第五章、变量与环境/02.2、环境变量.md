---
title: 2、环境变量
---
## 📚 目录

1. [环境变量基础概念](#1-环境变量基础概念)
2. [环境变量的查看与显示](#2-环境变量的查看与显示)
3. [环境变量的设置与导出](#3-环境变量的设置与导出)
4. [常用系统环境变量详解](#4-常用系统环境变量详解)
5. [临时与永久环境变量](#5-临时与永久环境变量)
6. [国际化与区域设置变量](#6-国际化与区域设置变量)
7. [终端相关环境变量](#7-终端相关环境变量)
8. [环境变量的安全考虑](#8-环境变量的安全考虑)
9. [实际应用与最佳实践](#9-实际应用与最佳实践)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🌍 环境变量基础概念


### 1.1 什么是环境变量


**简单理解**：环境变量就像是系统的"全局设置"，任何程序都可以读取这些设置信息。

```
通俗类比：
环境变量 = 系统的"通讯录"
- 存储了系统和程序需要的重要信息
- 所有程序都可以查阅这个"通讯录"
- 比如：程序在哪里、用户是谁、语言设置等
```

**环境变量的本质**：
- **全局性**：所有子进程都能继承父进程的环境变量
- **动态性**：可以在运行时修改和设置
- **持久性**：可以永久保存，每次登录都生效

### 1.2 环境变量 vs 普通变量


```
普通变量（局部变量）：
name="张三"          # 只在当前Shell中有效
echo $name          # 输出：张三

环境变量：
export NAME="张三"   # 导出为环境变量，子进程可见
bash                # 启动新的子Shell
echo $NAME          # 输出：张三（子进程中仍然可见）
```

**关键区别**：
- **普通变量**：仅在当前Shell会话中有效
- **环境变量**：可以被子进程继承，影响范围更广

### 1.3 环境变量的继承机制


```
Shell进程继承示意图：

父Shell进程
├─ 环境变量: PATH=/usr/bin:/bin
├─ 环境变量: HOME=/home/user
├─ 普通变量: temp="hello"  （不会被继承）
│
└─ 子进程（新Shell/程序）
   ├─ 继承: PATH=/usr/bin:/bin  ✓
   ├─ 继承: HOME=/home/user     ✓
   └─ 无法看到: temp           ✗
```

> 💡 **重点理解**：只有用`export`导出的变量才会被子进程继承，这是环境变量最重要的特性。

---

## 2. 👀 环境变量的查看与显示


### 2.1 查看所有环境变量


**env命令**：显示所有环境变量
```bash
env
# 输出示例：
# PATH=/usr/local/bin:/usr/bin:/bin
# HOME=/home/username
# USER=username
# SHELL=/bin/bash
```

**printenv命令**：打印环境变量
```bash
printenv              # 显示所有环境变量
printenv HOME         # 只显示HOME变量的值
printenv PATH HOME    # 显示多个指定变量
```

**set命令**：显示所有变量（包括环境变量和普通变量）
```bash
set                   # 显示所有变量和函数
set | grep "^HOME"    # 查找特定变量
```

### 2.2 查看单个环境变量


**最常用方法**：使用echo命令
```bash
echo $HOME           # 输出：/home/username
echo $PATH           # 输出：/usr/bin:/bin:/usr/local/bin
echo $USER           # 输出：username
```

**检查变量是否存在**：
```bash
if [ -n "$MY_VAR" ]; then
    echo "变量MY_VAR存在，值为：$MY_VAR"
else
    echo "变量MY_VAR不存在或为空"
fi
```

### 2.3 查看方法对比


| 命令 | **显示内容** | **使用场景** | **特点** |
|------|-------------|-------------|---------|
| `env` | 仅环境变量 | 查看可被子进程继承的变量 | 最纯净，只显示环境变量 |
| `printenv` | 仅环境变量 | 查看特定环境变量 | 可指定变量名 |
| `set` | 所有变量+函数 | 调试脚本，查看完整状态 | 信息最全面但较冗余 |
| `echo $VAR` | 单个变量值 | 快速查看特定变量 | 最简洁直接 |

---

## 3. 🔧 环境变量的设置与导出


### 3.1 export命令详解


**基本语法**：
```bash
export 变量名=值              # 设置并导出
export 变量名                # 将已有变量导出为环境变量
```

**实际示例**：
```bash
# 方式1：直接设置并导出
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk

# 方式2：先设置，后导出
JAVA_HOME=/usr/lib/jvm/java-8-openjdk
export JAVA_HOME

# 方式3：导出已存在的普通变量
name="张三"
export name      # 将name变为环境变量
```

### 3.2 环境变量的修改和追加


**直接覆盖**：
```bash
export PATH="/usr/local/bin:/usr/bin:/bin"
```

**追加到PATH（在前面添加）**：
```bash
export PATH="/opt/myapp/bin:$PATH"
# 结果：/opt/myapp/bin:/usr/local/bin:/usr/bin:/bin
```

**追加到PATH（在后面添加）**：
```bash
export PATH="$PATH:/opt/myapp/bin"
# 结果：/usr/local/bin:/usr/bin:/bin:/opt/myapp/bin
```

> 📌 **重要提醒**：PATH中路径的顺序很重要，系统会从前往后依次查找命令，找到第一个就停止。

### 3.3 取消环境变量


**unset命令**：
```bash
export TEST_VAR="hello"    # 设置环境变量
echo $TEST_VAR             # 输出：hello
unset TEST_VAR             # 取消变量
echo $TEST_VAR             # 输出：（空）
```

**清空变量值**：
```bash
export TEST_VAR=""         # 设为空值（变量仍存在）
unset TEST_VAR            # 完全删除变量
```

---

## 4. 🗂️ 常用系统环境变量详解


### 4.1 路径相关变量


**PATH - 命令搜索路径**
```
作用：告诉系统去哪里找可执行程序
格式：多个目录用冒号(:)分隔

示例查看：
echo $PATH
# 输出：/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin

理解：当你输入'ls'命令时，系统会依次在这些目录中查找ls程序
```

**HOME - 用户主目录**
```bash
echo $HOME              # 输出：/home/username
cd ~                   # 等同于 cd $HOME
cd                     # 不带参数的cd也会回到HOME目录
```

### 4.2 用户身份相关变量


**USER/USERNAME - 当前用户名**
```bash
echo $USER             # 输出：当前登录用户名
echo $USERNAME         # 在某些系统中使用这个变量
whoami                 # 命令方式查看当前用户
```

**UID - 用户ID**
```bash
echo $UID              # 输出：用户的数字ID
id -u                  # 命令方式查看用户ID
```

### 4.3 Shell相关变量


**SHELL - 当前Shell类型**
```bash
echo $SHELL            # 输出：/bin/bash 或 /bin/zsh 等
```

**PS1 - 命令提示符**
```
PS1是控制命令行提示符显示格式的变量

默认可能是：
PS1='\u@\h:\w\$ '
显示为：username@hostname:~/current/path$

常用PS1元素：
\u - 用户名
\h - 主机名
\w - 当前目录
\$ - 普通用户显示$，root显示#
```

**自定义PS1示例**：
```bash
export PS1="[\u@\h \w]# "     # 显示为：[user@host ~/path]#
export PS1="\e[1;32m\u@\h\e[0m:\w$ "  # 带颜色的提示符
```

### 4.4 系统信息变量


**PWD - 当前工作目录**
```bash
echo $PWD              # 输出：当前所在目录的完整路径
pwd                    # 命令方式查看当前目录
```

**HOSTNAME - 主机名**
```bash
echo $HOSTNAME         # 输出：计算机的主机名
hostname               # 命令方式查看主机名
```

---

## 5. ⏰ 临时与永久环境变量


### 5.1 临时环境变量


**会话级别**：只在当前登录会话中有效
```bash
export TEMP_VAR="临时值"
# 退出终端后这个变量就消失了
```

**一次性使用**：仅对单个命令有效
```bash
MY_VAR="hello" echo $MY_VAR    # 仅对这一个命令有效
MY_VAR="hello" bash -c 'echo $MY_VAR'  # 对子进程有效
```

### 5.2 永久环境变量配置文件


**配置文件层次**：
```
全局配置文件（影响所有用户）：
├─ /etc/environment          # 最基础的环境变量
├─ /etc/profile             # 登录时执行
├─ /etc/profile.d/          # 扩展配置目录
└─ /etc/bash.bashrc         # bash专用全局配置

用户个人配置文件：
├─ ~/.profile               # 登录时执行（通用）
├─ ~/.bashrc                # bash启动时执行
├─ ~/.bash_profile          # bash登录时执行
└─ ~/.bash_login            # 备选登录配置
```

### 5.3 配置文件的选择和使用


**推荐配置方式**：
```bash
# 1. 编辑用户的.bashrc文件（最常用）
nano ~/.bashrc

# 添加环境变量：
export JAVA_HOME=/usr/lib/jvm/java-8-openjdk
export PATH=$JAVA_HOME/bin:$PATH

# 2. 使配置立即生效
source ~/.bashrc
```

**配置文件执行顺序**：
```
登录Shell执行顺序：
/etc/profile → ~/.bash_profile → ~/.bash_login → ~/.profile

非登录Shell执行顺序：
/etc/bash.bashrc → ~/.bashrc
```

> 💡 **实用建议**：对于个人用户，建议将环境变量配置写在`~/.bashrc`中，这样无论是登录Shell还是非登录Shell都会生效。

---

## 6. 🌐 国际化与区域设置变量


### 6.1 LANG - 系统语言设置


**LANG变量的作用**：控制系统的默认语言和区域设置

```bash
echo $LANG             # 查看当前语言设置
# 常见输出：
# zh_CN.UTF-8          # 中文(中国)，UTF-8编码
# en_US.UTF-8          # 英文(美国)，UTF-8编码
# C                    # 标准C语言环境（英文）
```

**LANG格式解释**：
```
格式：语言_地区.编码
示例：zh_CN.UTF-8
├─ zh：语言代码（中文）
├─ CN：国家/地区代码（中国）
└─ UTF-8：字符编码
```

### 6.2 LC_* 细分设置变量


**LC系列变量**：用于更精细的区域设置控制

```bash
LC_ALL          # 覆盖所有其他LC_*设置
LC_COLLATE      # 字符串排序规则
LC_CTYPE        # 字符分类和转换
LC_MESSAGES     # 系统消息语言
LC_MONETARY     # 货币格式
LC_NUMERIC      # 数字格式
LC_TIME         # 时间日期格式
```

**实际应用示例**：
```bash
# 查看所有区域设置
locale

# 设置消息为英文，但保持其他为中文
export LC_MESSAGES=en_US.UTF-8

# 设置所有为英文环境
export LC_ALL=en_US.UTF-8
```

### 6.3 区域设置的优先级


```
优先级顺序（从高到低）：
LC_ALL > LC_* > LANG

举例说明：
LANG=zh_CN.UTF-8
LC_MESSAGES=en_US.UTF-8
LC_ALL=C

实际生效：LC_ALL=C（覆盖所有其他设置）
```

> ⚠️ **注意**：`LC_ALL`会覆盖所有其他语言设置，使用时要谨慎。

---

## 7. 💻 终端相关环境变量


### 7.1 TERM - 终端类型变量


**TERM变量的作用**：告诉系统当前使用的终端类型，以便正确显示颜色、光标控制等

```bash
echo $TERM
# 常见输出：
# xterm-256color      # 支持256色的xterm
# screen              # screen会话中
# linux               # Linux控制台
# dumb                # 简单终端（无特殊功能）
```

**TERM影响的功能**：
- **颜色显示**：是否支持颜色输出
- **光标控制**：能否移动光标位置
- **特殊字符**：是否支持特殊符号显示
- **窗口大小**：是否能检测窗口尺寸变化

### 7.2 终端尺寸变量


**COLUMNS和LINES**：控制终端的显示尺寸
```bash
echo $COLUMNS          # 终端宽度（字符数）
echo $LINES            # 终端高度（行数）

# 手动设置（通常由系统自动设置）
export COLUMNS=80
export LINES=24
```

**实际应用**：
```bash
# 许多命令会根据终端尺寸调整输出
ls                     # 会根据COLUMNS调整列数
man ls                 # 会根据LINES调整分页
```

### 7.3 终端颜色和显示


**支持颜色的检测**：
```bash
# 检查终端是否支持颜色
case "$TERM" in
    xterm*|screen*|linux*)
        echo "支持颜色显示"
        ;;
    dumb|unknown)
        echo "不支持颜色显示"
        ;;
esac
```

**终端能力查询**：
```bash
tput colors            # 查看支持的颜色数量
tput cols              # 查看终端宽度
tput lines             # 查看终端高度
```

---

## 8. 🔒 环境变量的安全考虑


### 8.1 敏感信息的处理


**不安全的做法**：
```bash
export DATABASE_PASSWORD="mypassword123"    # ❌ 密码暴露
export API_KEY="secret123456"               # ❌ API密钥暴露
```

**安全风险**：
- 通过`env`命令可以查看到敏感信息
- 子进程可以继承这些敏感变量
- 进程列表可能暴露命令行参数

### 8.2 更安全的处理方式


**使用配置文件**：
```bash
# 创建受保护的配置文件
echo "DATABASE_PASSWORD=mypassword123" > ~/.env
chmod 600 ~/.env        # 仅所有者可读写

# 在脚本中读取
source ~/.env
```

**运行时输入**：
```bash
# 提示用户输入密码（不显示在屏幕上）
read -s -p "请输入数据库密码: " DATABASE_PASSWORD
export DATABASE_PASSWORD
```

**使用专门的密钥管理工具**：
```bash
# 使用系统密钥环
secret=$(keyring get database password)
export DATABASE_PASSWORD="$secret"
```

### 8.3 PATH变量的安全


**PATH劫持风险**：
```bash
# 危险：将当前目录放在PATH开头
export PATH=".:$PATH"    # ❌ 可能执行恶意程序

# 安全：避免在PATH中包含当前目录
export PATH="/usr/local/bin:/usr/bin:/bin"  # ✓
```

**检查PATH安全性**：
```bash
# 检查PATH中是否包含危险路径
echo $PATH | grep -E "(^\.:|:\.:|:\.$)"
if [ $? -eq 0 ]; then
    echo "⚠️ PATH包含当前目录，存在安全风险"
fi
```

---

## 9. 🚀 实际应用与最佳实践


### 9.1 开发环境配置


**Java开发环境**：
```bash
# ~/.bashrc中添加
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib
```

**Node.js开发环境**：
```bash
# 使用nvm管理Node版本
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && source "$NVM_DIR/nvm.sh"
```

**Python虚拟环境**：
```bash
# Python虚拟环境激活脚本会设置这些变量
export VIRTUAL_ENV="/path/to/venv"
export PATH="$VIRTUAL_ENV/bin:$PATH"
```

### 9.2 系统管理最佳实践


**环境变量组织**：
```bash
# ~/.bashrc 结构建议
# =============环境变量设置=============
export EDITOR=vim
export BROWSER=firefox
export PATH="/usr/local/bin:$PATH"

# =============开发工具配置=============  
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk
export MAVEN_HOME=/opt/maven
export PATH=$JAVA_HOME/bin:$MAVEN_HOME/bin:$PATH

# =============个人别名设置=============
alias ll='ls -alF'
alias la='ls -A'
```

### 9.3 脚本中的环境变量处理


**检查必需的环境变量**：
```bash
#!/bin/bash

# 检查必需的环境变量
required_vars=("JAVA_HOME" "DATABASE_URL" "API_KEY")

for var in "${required_vars[@]}"; do
    if [ -z "${!var}" ]; then
        echo "错误：缺少必需的环境变量 $var"
        exit 1
    fi
done

echo "所有必需的环境变量都已设置"
```

**设置默认值**：
```bash
# 如果变量不存在或为空，使用默认值
DATABASE_HOST=${DATABASE_HOST:-localhost}
DATABASE_PORT=${DATABASE_PORT:-5432}
DEBUG_MODE=${DEBUG_MODE:-false}
```

### 9.4 故障排查技巧


**环境变量调试**：
```bash
# 显示特定前缀的环境变量
env | grep "^JAVA"       # 显示所有JAVA相关变量
env | grep "^LC_"        # 显示所有本地化变量

# 比较两个环境
env | sort > env_before.txt
# 进行某些操作后
env | sort > env_after.txt
diff env_before.txt env_after.txt  # 查看变化
```

**PATH问题调试**：
```bash
# 查看命令的实际路径
which java              # 显示java命令的完整路径
type java               # 显示java是别名、函数还是程序
whereis java            # 显示java相关文件的位置

# 分析PATH中的每个路径
echo $PATH | tr ':' '\n' | nl
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的核心概念


```
🔸 环境变量本质：系统级的全局配置，可被子进程继承
🔸 export作用：将普通变量转换为环境变量
🔸 临时vs永久：当前会话有效 vs 写入配置文件永久保存
🔸 查看命令：env(纯环境变量)、set(所有变量)、echo $VAR(单个)
🔸 常用变量：PATH、HOME、USER、SHELL、PS1
🔸 安全考虑：避免在环境变量中存储敏感信息
```

### 10.2 关键理解要点


**🔹 环境变量的继承机制**
```
父进程 → 子进程：环境变量会被继承
普通变量 → 子进程：不会被继承
这是export命令存在的根本原因
```

**🔹 PATH变量的重要性**
```
PATH决定了系统如何找到可执行程序
顺序很重要：从前往后依次查找
安全很重要：避免包含当前目录(.)
```

**🔹 配置文件的选择**
```
个人用户：推荐使用 ~/.bashrc
系统级别：使用 /etc/environment
临时设置：直接export命令
```

### 10.3 实际应用指导


**✅ 推荐做法**：
- 将开发环境配置写在`~/.bashrc`中
- 使用`source ~/.bashrc`立即生效修改
- 定期备份重要的配置文件
- 为敏感信息使用专门的配置文件

**❌ 避免做法**：
- 在环境变量中存储密码
- 在PATH开头添加当前目录(.)
- 过度使用LC_ALL覆盖所有设置
- 忘记export导致子进程无法访问

### 10.4 故障排查清单


```
环境变量问题诊断：
□ 变量是否正确设置（echo $VAR）
□ 变量是否已导出（env | grep VAR）
□ 配置文件是否正确加载（source测试）
□ PATH顺序是否正确（echo $PATH）
□ 权限是否正确（ls -la ~/.bashrc）

常见问题解决：
□ 命令找不到 → 检查PATH设置
□ 程序找不到库 → 检查LD_LIBRARY_PATH
□ 字符显示异常 → 检查LANG和LC_*设置
□ 颜色不显示 → 检查TERM设置
```

### 10.5 记忆要点


> 📌 **核心记忆**：  
> 环境变量是系统的"通讯录"，export是让变量"全局化"的钥匙，配置文件是让设置"持久化"的方法。

**实用口诀**：
- export导出全局用，子进程继承父进程
- PATH顺序很重要，从前往后来查找  
- bashrc个人配，source加载立生效
- 敏感信息别暴露，安全第一要记牢

**必备命令清单**：
```bash
env                    # 查看所有环境变量
export VAR=value       # 设置并导出环境变量
echo $VAR              # 查看单个变量
source ~/.bashrc       # 重新加载配置文件
unset VAR              # 删除变量
```