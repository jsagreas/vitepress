---
title: 1、变量基础
---
## 📚 目录

1. [变量定义基础](#1-变量定义基础)
2. [变量引用机制](#2-变量引用机制)
3. [变量作用域详解](#3-变量作用域详解)
4. [变量类型与特性](#4-变量类型与特性)
5. [变量管理操作](#5-变量管理操作)
6. [变量命名最佳实践](#6-变量命名最佳实践)
7. [实践应用场景](#7-实践应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 变量定义基础


### 1.1 什么是Shell变量


**简单理解**：变量就像一个**带标签的盒子**，用来存放数据。

```
生活类比：
标签盒子        Shell变量
┌─────────┐    name="张三"
│  张三   │  ←  盒子标签是name
│ (姓名)  │    盒子里装的是"张三"
└─────────┘
```

**核心概念**：
- **变量名**：盒子的标签（如 `name`）
- **变量值**：盒子里的内容（如 `"张三"`）
- **赋值**：往盒子里放东西的过程

### 1.2 变量定义的铁律


**🔴 最重要规则：等号两边不能有空格！**

```bash
# ✅ 正确写法
name="张三"
age=25
city="北京"

# ❌ 错误写法 - 等号两边有空格
name = "张三"     # 系统会认为这是命令，不是赋值
age= 25          # 空格会导致语法错误
city ="北京"     # 同样会报错
```

**为什么不能有空格？**
> 🧠 **核心理解**：Shell把空格当作**命令分隔符**
> 
> `name = "张三"` 被理解为：
> 1. 执行命令 `name`
> 2. 参数1：`=`  
> 3. 参数2：`"张三"`
>
> 这显然不是我们想要的赋值操作！

### 1.3 定义变量的基本语法


```bash
# 基本格式：变量名=变量值
username="admin"
count=100
message="Hello World"

# 空值变量
empty_var=""
null_var=

# 包含空格的值必须用引号
full_name="张 三"
file_path="/home/user/documents"
```

**💡 记忆技巧**：
- 想象**紧紧拥抱**：变量名和值通过等号紧紧抱在一起，中间不能有任何空隙

---

## 2. 🔍 变量引用机制


### 2.1 基本引用方式


**两种引用格式**：

```bash
name="Shell学习者"

# 方式1：$变量名（简单引用）
echo "你好，$name"

# 方式2：${变量名}（推荐方式）  
echo "你好，${name}"
```

**输出结果**：
```
你好，Shell学习者
你好，Shell学习者
```

### 2.2 什么时候必须用花括号？


**🔸 字符拼接场景**

```bash
file="report"
year="2024"

# ❌ 错误：系统找不到变量 $filemonth
echo "$filemonth.txt"   # 输出：.txt（变量不存在）

# ✅ 正确：用花括号明确变量边界
echo "${file}month.txt"   # 输出：reportmonth.txt
echo "${file}_${year}.pdf"  # 输出：report_2024.pdf
```

**🔸 数组元素访问**

```bash
colors=("红" "绿" "蓝")

# 必须用花括号访问数组元素
echo "${colors[0]}"  # 输出：红
echo "${colors[1]}"  # 输出：绿
```

### 2.3 引用中的引号规则


```bash
message="Hello World"

# 双引号：变量会被展开
echo "消息内容：$message"     # 输出：消息内容：Hello World

# 单引号：变量不会被展开（原样输出）
echo '消息内容：$message'     # 输出：消息内容：$message

# 无引号：空格会被分割
text="a b c"
echo $text    # 输出：a b c（正常）
echo "$text"  # 输出：a b c（推荐，避免意外分割）
```

**📋 引号使用指南**：

| 引号类型 | **变量展开** | **适用场景** | **示例** |
|---------|-------------|-------------|----------|
| `双引号` | ✅ **会展开** | `包含变量的字符串` | `"Hello $name"` |
| `单引号` | ❌ **不展开** | `纯字符串常量` | `'$HOME/bin'` |
| `无引号` | ✅ **会展开** | `简单变量（注意空格分割）` | `$count` |

---

## 3. 🌐 变量作用域详解


### 3.1 局部变量 vs 全局变量


**🏠 生活类比**：
```
家庭场景：
客厅的电视    ← 全局变量（全家都能用）
卧室的台灯    ← 局部变量（只在卧室能用）
```

### 3.2 局部变量（默认情况）


```bash
#!/bin/bash

# 在脚本中定义的变量默认是局部的
script_var="我是脚本变量"

function my_function() {
    # 函数内的变量也是局部的
    local func_var="我是函数变量"
    echo "函数内：$func_var"
}

my_function
echo "函数外：$func_var"  # 输出为空，变量不存在
```

**运行结果**：
```
函数内：我是函数变量
函数外：
```

### 3.3 全局变量（环境变量）


```bash
# 使用export将局部变量升级为全局变量
export GLOBAL_VAR="我是全局变量"

# 或者直接定义全局变量
export DATABASE_URL="mysql://localhost:3306/mydb"
export MAX_CONNECTIONS=100
```

**验证作用域**：

```bash
#!/bin/bash

# 局部变量
local_var="只在当前脚本可见"

# 全局变量  
export global_var="所有子进程可见"

# 启动子Shell验证
bash -c 'echo "子Shell中的local_var: $local_var"'    # 空值
bash -c 'echo "子Shell中的global_var: $global_var"'  # 有值
```

**🎯 作用域实践总结**：

```
变量可见性范围：
┌─────────────────────────────────┐
│ 全局变量 (export)               │
│  ┌─────────────────────────────┐│
│  │ 当前Shell + 所有子进程       ││
│  │  ┌─────────────────────────┐││
│  │  │ 局部变量 (默认)         │││
│  │  │ 只在当前Shell/脚本可见  │││
│  │  └─────────────────────────┘││
│  └─────────────────────────────┘│
└─────────────────────────────────┘
```

---

## 4. 📦 变量类型与特性


### 4.1 字符串变量（最常用）


```bash
# 普通字符串
username="admin"
password="123456"

# 多行字符串
sql_query="SELECT * 
FROM users 
WHERE age > 18"

# 包含特殊字符的字符串
regex_pattern='^[a-zA-Z0-9]+$'
file_path="/usr/local/bin"
```

**字符串长度获取**：
```bash
text="Hello World"
echo "字符串长度：${#text}"  # 输出：字符串长度：11
```

### 4.2 数组变量


**🔸 索引数组**

```bash
# 定义数组的几种方式
fruits=("苹果" "香蕉" "橘子")
numbers=(1 2 3 4 5)
mixed=("文本" 123 "more text")

# 访问数组元素
echo "第一个水果：${fruits[0]}"     # 苹果
echo "第二个水果：${fruits[1]}"     # 香蕉
echo "所有水果：${fruits[@]}"       # 苹果 香蕉 橘子
echo "数组长度：${#fruits[@]}"      # 3
```

**🔸 关联数组（类似字典）**

```bash
# 声明关联数组
declare -A person

# 赋值
person["name"]="张三"
person["age"]="25"  
person["city"]="北京"

# 访问
echo "姓名：${person['name']}"
echo "年龄：${person['age']}"
echo "所有键：${!person[@]}"        # name age city
echo "所有值：${person[@]}"         # 张三 25 北京
```

### 4.3 数值变量与运算


```bash
# 数值变量
num1=10
num2=20

# 算术运算（几种方式）
result1=$((num1 + num2))           # 方式1：双括号
result2=`expr $num1 + $num2`       # 方式2：expr命令
result3=$(echo "$num1 + $num2" | bc)  # 方式3：bc计算器

echo "结果1：$result1"  # 30
echo "结果2：$result2"  # 30
echo "结果3：$result3"  # 30
```

**🧮 数值运算对照表**：

| 运算类型 | **语法** | **示例** | **结果** |
|---------|---------|---------|---------|
| `加法` | `$((a + b))` | `$((10 + 5))` | `15` |
| `减法` | `$((a - b))` | `$((10 - 3))` | `7` |
| `乘法` | `$((a * b))` | `$((4 * 5))` | `20` |
| `除法` | `$((a / b))` | `$((10 / 3))` | `3` |
| `取余` | `$((a % b))` | `$((10 % 3))` | `1` |

---

## 5. 🛠️ 变量管理操作


### 5.1 删除变量（unset）


```bash
# 定义变量
temp_var="临时数据"
echo "删除前：$temp_var"

# 删除变量
unset temp_var
echo "删除后：$temp_var"  # 输出为空

# 验证变量是否存在
if [ -z "$temp_var" ]; then
    echo "变量已被删除"
fi
```

**💡 实际应用场景**：
- 清理敏感信息（如密码）
- 释放大数组占用的内存
- 脚本结束前的清理工作

### 5.2 只读变量（readonly）


```bash
# 定义只读变量
readonly CONFIG_FILE="/etc/myapp.conf"
readonly MAX_USERS=1000

# 尝试修改只读变量会报错
CONFIG_FILE="/tmp/test.conf"  # 报错：CONFIG_FILE: readonly variable

# 查看所有只读变量
readonly
```

**🔒 只读变量的用途**：
- **配置常量**：系统配置路径、最大值限制
- **安全保护**：防止重要变量被意外修改
- **脚本规范**：明确标识不应变更的值

### 5.3 变量属性查看


```bash
# 查看变量类型和属性
declare -p variable_name

# 示例
name="test"
declare -p name  # 输出：declare -- name="test"

readonly PI=3.14159
declare -p PI    # 输出：declare -r PI="3.14159"

numbers=(1 2 3)
declare -p numbers  # 输出：declare -a numbers=([0]="1" [1]="2" [2]="3")
```

---

## 6. 📏 变量命名最佳实践


### 6.1 命名规范


**🔸 基本规则**
```bash
# ✅ 推荐的命名方式
user_name="admin"          # 小写+下划线
MAX_CONNECTIONS=100        # 常量用大写
database_host="localhost"
log_file_path="/var/log/app.log"

# ❌ 避免的命名方式
2user="admin"              # 不能以数字开头
user-name="admin"          # 不能包含连字符
class="MyClass"            # class是关键字
```

**🎯 命名规范总结**：

| 规范类型 | **格式** | **用途** | **示例** |
|---------|---------|---------|---------|
| `普通变量` | `小写_下划线` | `一般变量` | `user_name, file_path` |
| `常量` | `大写_下划线` | `不变的值` | `MAX_SIZE, CONFIG_DIR` |
| `环境变量` | `大写_下划线` | `系统级变量` | `PATH, HOME` |
| `局部变量` | `小写_下划线` | `函数内变量` | `local temp_file` |

### 6.2 语义化命名


```bash
# ✅ 语义清晰的变量名
current_user="admin"
database_connection_string="mysql://localhost:3306"
processing_start_time=$(date +%s)
error_log_file="/var/log/error.log"

# ❌ 含义不清的变量名  
a="admin"              # 不知道是什么
str="mysql://..."      # 太抽象
t=$(date +%s)          # 不知道代表什么时间
f="/var/log/error.log" # 不知道是什么文件
```

**🧠 语义化命名的好处**：
- **代码自注释**：看变量名就知道用途
- **维护方便**：几个月后重新看代码也能理解
- **团队协作**：其他人看代码时一目了然

### 6.3 作用域命名约定


```bash
#!/bin/bash

# 全局配置变量（大写）
readonly APP_NAME="MyApplication"
readonly CONFIG_DIR="/etc/myapp"

# 脚本级变量（小写+下划线）
current_user=""
log_level="INFO"

function process_data() {
    # 函数局部变量（local声明）
    local input_file="$1"
    local temp_dir="/tmp/processing"
    local result_count=0
    
    # 函数内部处理...
}
```

---

## 7. 🚀 实践应用场景


### 7.1 配置管理脚本


```bash
#!/bin/bash

# 应用配置
readonly APP_NAME="WebServer"
readonly CONFIG_FILE="/etc/webserver.conf"
readonly LOG_DIR="/var/log/webserver"

# 运行时变量
server_port=8080
max_connections=1000
debug_mode=false

# 读取配置文件
if [ -f "$CONFIG_FILE" ]; then
    source "$CONFIG_FILE"
    echo "配置已加载：$APP_NAME"
else
    echo "警告：配置文件不存在，使用默认配置"
fi

# 启动服务
echo "启动 $APP_NAME，端口：$server_port，最大连接：$max_connections"
```

### 7.2 批量文件处理


```bash
#!/bin/bash

# 处理参数
input_dir="$1"
output_dir="$2"
file_pattern="*.txt"

# 验证参数
if [ -z "$input_dir" ] || [ -z "$output_dir" ]; then
    echo "用法：$0 输入目录 输出目录"
    exit 1
fi

# 处理统计
processed_count=0
error_count=0

# 批量处理文件
for file in "$input_dir"/$file_pattern; do
    if [ -f "$file" ]; then
        filename=$(basename "$file")
        
        # 处理单个文件
        if cp "$file" "$output_dir/$filename"; then
            ((processed_count++))
            echo "✅ 处理完成：$filename"
        else
            ((error_count++))
            echo "❌ 处理失败：$filename"
        fi
    fi
done

# 输出统计
echo "处理完成 - 成功：$processed_count，失败：$error_count"
```

### 7.3 系统信息收集


```bash
#!/bin/bash

# 系统信息变量
hostname=$(hostname)
current_time=$(date '+%Y-%m-%d %H:%M:%S')
cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
memory_usage=$(free -h | grep '^Mem' | awk '{print $3"/"$2}')
disk_usage=$(df -h / | tail -1 | awk '{print $5}')

# 生成报告
report_file="/tmp/system_report_$(date +%Y%m%d_%H%M%S).txt"

cat > "$report_file" << EOF
=== 系统状态报告 ===
生成时间: $current_time
主机名称: $hostname
CPU使用率: ${cpu_usage}%
内存使用: $memory_usage
磁盘使用: $disk_usage

报告文件: $report_file
EOF

echo "系统报告已生成：$report_file"
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基础知识


```
🔴 **变量定义铁律**：
变量名=值（等号两边绝对不能有空格！）

🔸 **变量引用方式**：
• $variable    - 简单引用
• ${variable}  - 推荐方式，边界清晰

🔸 **作用域概念**：
• 局部变量：默认情况，仅当前脚本可见
• 全局变量：export后，子进程也可见

🔸 **基本操作**：
• unset 变量名     - 删除变量
• readonly 变量名  - 设置只读
• declare -p 变量名 - 查看属性
```

### 8.2 实用记忆技巧


**🧠 口诀记忆**：
```
定义变量等号紧，两边空格是禁忌
引用变量加美元，花括号来保边界
局部变量脚本用，全局要用export
只读变量readonly，删除变量用unset
```

**⚡ 快速检查清单**：
- [ ] 变量定义时等号两边无空格
- [ ] 变量名遵循命名规范
- [ ] 适当使用花括号引用
- [ ] 区分局部和全局作用域
- [ ] 合理使用只读变量保护重要数据

### 8.3 常见错误防范


**❌ 最容易犯的错误**：
```bash
# 错误1：等号两边有空格
name = "value"    # ❌

# 错误2：变量名包含特殊字符  
file-name="test"  # ❌

# 错误3：忘记使用花括号
echo "$nametest"  # ❌ 找不到变量nametest

# 错误4：单双引号混淆
echo 'Hello $name'  # ❌ 变量不会展开
```

**✅ 正确的做法**：
```bash
# 正确1：等号紧贴
name="value"      # ✅

# 正确2：下划线分隔
file_name="test"  # ✅

# 正确3：花括号明确边界
echo "${name}test"  # ✅

# 正确4：双引号展开变量
echo "Hello $name"  # ✅
```

### 8.4 进阶学习路径


**📈 学习进阶**：
```
基础掌握 → 数组操作 → 字符串处理 → 参数展开
   ↓         ↓         ↓         ↓
变量定义   索引数组   模式匹配   高级替换
变量引用   关联数组   长度计算   默认值
作用域    数组遍历   子字符串   条件赋值
```

**🎯 实践建议**：
- **多练习**：通过编写实际脚本来熟悉变量操作
- **读源码**：看看系统脚本是如何使用变量的
- **做项目**：结合实际需求使用变量管理配置和状态

**核心记忆**：
> Shell变量是脚本编程的基础，掌握了变量的定义、引用、作用域和管理，就掌握了Shell编程的核心技能。记住"等号无空格，引用加美元，作用域分清，命名要规范"这四个要点！