---
title: 3ã€ç»´æŠ¤å·¥å…·
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿç»´æŠ¤è„šæœ¬æ¦‚è¿°](#1-ç³»ç»Ÿç»´æŠ¤è„šæœ¬æ¦‚è¿°)
2. [ç³»ç»Ÿæ¸…ç†ç»´æŠ¤è„šæœ¬](#2-ç³»ç»Ÿæ¸…ç†ç»´æŠ¤è„šæœ¬)
3. [è½¯ä»¶æ›´æ–°è‡ªåŠ¨åŒ–](#3-è½¯ä»¶æ›´æ–°è‡ªåŠ¨åŒ–)
4. [å®‰å…¨æ‰«æä¸ç›‘æ§](#4-å®‰å…¨æ‰«æä¸ç›‘æ§)
5. [æ€§èƒ½ä¼˜åŒ–è„šæœ¬](#5-æ€§èƒ½ä¼˜åŒ–è„šæœ¬)
6. [æ•…éšœè‡ªåŠ¨æ¢å¤æœºåˆ¶](#6-æ•…éšœè‡ªåŠ¨æ¢å¤æœºåˆ¶)
7. [Shell vs å…¶ä»–è¯­è¨€é€‰æ‹©](#7-Shell-vs-å…¶ä»–è¯­è¨€é€‰æ‹©)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ ç³»ç»Ÿç»´æŠ¤è„šæœ¬æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿç»´æŠ¤è„šæœ¬


**ç®€å•ç†è§£**ï¼šå°±åƒç»™ä½ çš„ç”µè„‘é…ä¸€ä¸ª"æœºå™¨äººä¿å§†"ï¼Œå®šæœŸæ‰“æ‰«æˆ¿é—´ã€æ£€æŸ¥è®¾å¤‡ã€ç»´æŠ¤ç³»ç»Ÿï¼Œè®©ä¸€åˆ‡éƒ½äº•äº•æœ‰æ¡ã€‚

```
ğŸ  æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡ç±»æ¯”ï¼š
æ‰‹å·¥ç»´æŠ¤ = æ¯å¤©æ‰‹åŠ¨æ£€æŸ¥åƒåœ¾ã€æ¸…ç†ç¼“å­˜ã€æŸ¥çœ‹æ—¥å¿—
è„šæœ¬ç»´æŠ¤ = å®šæ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œè§£æ”¾åŒæ‰‹

ç»´æŠ¤è„šæœ¬çš„ä»·å€¼ï¼š
âœ… è‡ªåŠ¨åŒ–æ‰§è¡Œé‡å¤ä»»åŠ¡
âœ… æ ‡å‡†åŒ–æ“ä½œæµç¨‹  
âœ… å‡å°‘äººä¸ºé”™è¯¯
âœ… æé«˜ç³»ç»Ÿç¨³å®šæ€§
âœ… èŠ‚çœå¤§é‡æ—¶é—´
```

### 1.2 ç»´æŠ¤è„šæœ¬çš„åˆ†ç±»


**ğŸ¯ æŒ‰åŠŸèƒ½åˆ†ç±»**ï¼š
```
æ¸…ç†ç±»è„šæœ¬ï¼š
â€¢ æ—¥å¿—æ–‡ä»¶æ¸…ç†
â€¢ ä¸´æ—¶æ–‡ä»¶æ¸…ç†  
â€¢ ç¼“å­˜æ¸…ç†
â€¢ ç£ç›˜ç©ºé—´å›æ”¶

ç›‘æ§ç±»è„šæœ¬ï¼š
â€¢ ç³»ç»Ÿèµ„æºç›‘æ§
â€¢ æœåŠ¡çŠ¶æ€æ£€æŸ¥
â€¢ ç½‘ç»œè¿é€šæ€§æµ‹è¯•
â€¢ å®‰å…¨å¨èƒæ‰«æ

ä¼˜åŒ–ç±»è„šæœ¬ï¼š
â€¢ æ€§èƒ½è°ƒä¼˜
â€¢ é…ç½®ä¼˜åŒ–
â€¢ æœåŠ¡é‡å¯
â€¢ å†…å­˜æ¸…ç†

æ¢å¤ç±»è„šæœ¬ï¼š
â€¢ æœåŠ¡è‡ªåŠ¨é‡å¯
â€¢ é…ç½®æ–‡ä»¶ä¿®å¤
â€¢ æ•°æ®å¤‡ä»½æ¢å¤
â€¢ æ•…éšœè‡ªåŠ¨å¤„ç†
```

### 1.3 è„šæœ¬è®¾è®¡åŸåˆ™


**âš–ï¸ è®¾è®¡è¦ç‚¹**ï¼š
```
å®‰å…¨ç¬¬ä¸€ï¼š
â€¢ æ“ä½œå‰å…ˆå¤‡ä»½
â€¢ éªŒè¯è¾“å…¥å‚æ•°
â€¢ è®¾ç½®æ“ä½œæƒé™
â€¢ è®°å½•æ“ä½œæ—¥å¿—

ç¨³å®šå¯é ï¼š
â€¢ å¼‚å¸¸å¤„ç†æœºåˆ¶
â€¢ æ“ä½œç»“æœéªŒè¯
â€¢ å›æ»šèƒ½åŠ›
â€¢ è¿è¡ŒçŠ¶æ€æ£€æŸ¥

æ˜“äºç»´æŠ¤ï¼š
â€¢ ä»£ç ç»“æ„æ¸…æ™°
â€¢ å……åˆ†çš„æ³¨é‡Š
â€¢ é…ç½®å‚æ•°åŒ–
â€¢ æ¨¡å—åŒ–è®¾è®¡
```

---

## 2. ğŸ§¹ ç³»ç»Ÿæ¸…ç†ç»´æŠ¤è„šæœ¬


### 2.1 æ—¥å¿—æ–‡ä»¶æ¸…ç†è„šæœ¬


**ä¸ºä»€ä¹ˆéœ€è¦æ¸…ç†æ—¥å¿—ï¼Ÿ**
æ—¥å¿—æ–‡ä»¶å°±åƒå®¶é‡Œçš„åƒåœ¾ï¼Œä¸å®šæœŸæ¸…ç†å°±ä¼šè¶Šç§¯è¶Šå¤šï¼Œæœ€ç»ˆå æ»¡æ•´ä¸ªç£ç›˜ç©ºé—´ã€‚

```bash
#!/bin/bash
# ç³»ç»Ÿæ—¥å¿—æ¸…ç†è„šæœ¬
# åŠŸèƒ½ï¼šæ¸…ç†è¶…è¿‡30å¤©çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¿æŒç³»ç»Ÿæ•´æ´

# é…ç½®å‚æ•°
LOG_DIRS="/var/log /home/*/logs /opt/*/logs"
DAYS_TO_KEEP=30
BACKUP_DIR="/backup/old_logs"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR"

# æ¸…ç†å‡½æ•°
cleanup_logs() {
    echo "å¼€å§‹æ¸…ç†æ—¥å¿—æ–‡ä»¶..."
    
    # æŸ¥æ‰¾å¹¶å¤„ç†æ—§æ—¥å¿—
    find $LOG_DIRS -name "*.log" -type f -mtime +$DAYS_TO_KEEP 2>/dev/null | while read logfile; do
        # å‹ç¼©å¹¶ç§»åŠ¨åˆ°å¤‡ä»½ç›®å½•
        gzip "$logfile" && mv "${logfile}.gz" "$BACKUP_DIR/"
        echo "å·²å¤„ç†: $logfile"
    done
    
    # æ¸…ç†ç³»ç»Ÿæ—¥å¿—
    journalctl --vacuum-time=30d
    
    echo "æ—¥å¿—æ¸…ç†å®Œæˆï¼"
}

cleanup_logs
```

### 2.2 ç»¼åˆç³»ç»Ÿæ¸…ç†è„šæœ¬


**ğŸ—‘ï¸ å…¨é¢æ¸…ç†ç­–ç•¥**ï¼š

```bash
#!/bin/bash
# ç³»ç»Ÿç»¼åˆæ¸…ç†è„šæœ¬

# æ˜¾ç¤ºæ¸…ç†å‰çŠ¶æ€
show_disk_usage() {
    echo "=== ç£ç›˜ä½¿ç”¨æƒ…å†µ ==="
    df -h | grep -E '^/dev/'
    echo
}

# æ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜
clean_package_cache() {
    echo "æ¸…ç†è½¯ä»¶åŒ…ç¼“å­˜..."
    
    # æ£€æµ‹ç³»ç»Ÿç±»å‹å¹¶æ¸…ç†
    if command -v apt &> /dev/null; then
        apt autoremove -y && apt autoclean
    elif command -v yum &> /dev/null; then
        yum clean all
    elif command -v dnf &> /dev/null; then
        dnf clean all
    fi
}

# æ¸…ç†ç”¨æˆ·ç¼“å­˜
clean_user_cache() {
    echo "æ¸…ç†ç”¨æˆ·ç¼“å­˜ç›®å½•..."
    
    # æµè§ˆå™¨ç¼“å­˜
    rm -rf ~/.cache/google-chrome/
    rm -rf ~/.cache/firefox/
    
    # ç³»ç»Ÿç¼“å­˜
    rm -rf /tmp/* 2>/dev/null
    rm -rf /var/tmp/* 2>/dev/null
}

# ä¸»æ¸…ç†æµç¨‹
main() {
    echo "å¼€å§‹ç³»ç»Ÿæ¸…ç†..."
    show_disk_usage
    
    clean_package_cache
    clean_user_cache
    
    echo "æ¸…ç†å®Œæˆï¼"
    show_disk_usage
}

main
```

### 2.3 å®šæœŸæ¸…ç†ä»»åŠ¡é…ç½®


**â° è‡ªåŠ¨åŒ–æ‰§è¡Œ**ï¼š
```bash
# æ·»åŠ åˆ°crontabä¸­å®ç°å®šæœŸæ‰§è¡Œ
# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œæ¸…ç†ï¼‰
0 2 * * 0 /opt/scripts/system_cleanup.sh > /var/log/cleanup.log 2>&1

# æŸ¥çœ‹å·²è®¾ç½®çš„å®šæ—¶ä»»åŠ¡
crontab -l
```

---

## 3. ğŸ“¦ è½¯ä»¶æ›´æ–°è‡ªåŠ¨åŒ–


### 3.1 ç³»ç»Ÿæ›´æ–°è„šæœ¬


**ä¸ºä»€ä¹ˆè¦è‡ªåŠ¨åŒ–æ›´æ–°ï¼Ÿ**
æ‰‹åŠ¨æ›´æ–°å°±åƒæ¯å¤©è¦è®°å¾—å–æ°´ä¸€æ ·ï¼Œå®¹æ˜“å¿˜è®°ã€‚è‡ªåŠ¨åŒ–æ›´æ–°ç¡®ä¿ç³»ç»Ÿå§‹ç»ˆä¿æŒæœ€æ–°çŠ¶æ€ï¼Œè·å¾—å®‰å…¨è¡¥ä¸ã€‚

```bash
#!/bin/bash
# ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°è„šæœ¬

# é…ç½®é¡¹
UPDATE_LOG="/var/log/auto_update.log"
EMAIL_NOTIFY="admin@company.com"

# æ—¥å¿—å‡½æ•°
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$UPDATE_LOG"
}

# æ£€æŸ¥æ›´æ–°
check_updates() {
    log_message "æ£€æŸ¥ç³»ç»Ÿæ›´æ–°..."
    
    if command -v apt &> /dev/null; then
        apt update
        UPDATES=$(apt list --upgradable 2>/dev/null | wc -l)
    elif command -v yum &> /dev/null; then
        yum check-update
        UPDATES=$?
    fi
    
    echo $UPDATES
}

# æ‰§è¡Œæ›´æ–°
perform_update() {
    log_message "å¼€å§‹ç³»ç»Ÿæ›´æ–°..."
    
    if command -v apt &> /dev/null; then
        apt upgrade -y
        apt autoremove -y
    elif command -v yum &> /dev/null; then
        yum update -y
    fi
    
    log_message "ç³»ç»Ÿæ›´æ–°å®Œæˆ"
}

# ä¸»ç¨‹åº
main() {
    UPDATE_COUNT=$(check_updates)
    
    if [ "$UPDATE_COUNT" -gt 1 ]; then
        perform_update
        
        # æ£€æŸ¥æ˜¯å¦éœ€è¦é‡å¯
        if [ -f /var/run/reboot-required ]; then
            log_message "ç³»ç»Ÿéœ€è¦é‡å¯"
            # å¯é€‰æ‹©ç«‹å³é‡å¯æˆ–å‘é€é€šçŸ¥
            # reboot
        fi
    else
        log_message "æ— å¯ç”¨æ›´æ–°"
    fi
}

main
```

### 3.2 åº”ç”¨ç¨‹åºæ›´æ–°ç®¡ç†


**ğŸ”„ ç¬¬ä¸‰æ–¹è½¯ä»¶æ›´æ–°**ï¼š
```bash
#!/bin/bash
# ç¬¬ä¸‰æ–¹åº”ç”¨æ›´æ–°è„šæœ¬

# æ›´æ–°Dockeré•œåƒ
update_docker_images() {
    echo "æ›´æ–°Dockeré•œåƒ..."
    
    # è·å–æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨ä½¿ç”¨çš„é•œåƒ
    docker images --format "table {{.Repository}}:{{.Tag}}" | tail -n +2 | while read image; do
        if [[ "$image" != "<none>:<none>" ]]; then
            echo "æ›´æ–°é•œåƒ: $image"
            docker pull "$image"
        fi
    done
}

# æ›´æ–°SnapåŒ…
update_snap_packages() {
    if command -v snap &> /dev/null; then
        echo "æ›´æ–°SnapåŒ…..."
        snap refresh
    fi
}

# æ›´æ–°Flatpakåº”ç”¨
update_flatpak_apps() {
    if command -v flatpak &> /dev/null; then
        echo "æ›´æ–°Flatpakåº”ç”¨..."
        flatpak update -y
    fi
}

# æ‰§è¡Œæ‰€æœ‰æ›´æ–°
update_docker_images
update_snap_packages  
update_flatpak_apps
```

---

## 4. ğŸ” å®‰å…¨æ‰«æä¸ç›‘æ§


### 4.1 ç³»ç»Ÿå®‰å…¨æ‰«æè„šæœ¬


**å®‰å…¨æ‰«æçš„é‡è¦æ€§**ï¼š
å°±åƒå®šæœŸä½“æ£€ä¸€æ ·ï¼Œç³»ç»Ÿä¹Ÿéœ€è¦å®šæœŸ"ä½“æ£€"æ¥å‘ç°æ½œåœ¨çš„å®‰å…¨å¨èƒå’Œæ¼æ´ã€‚

```bash
#!/bin/bash
# ç³»ç»Ÿå®‰å…¨æ‰«æè„šæœ¬

SCAN_REPORT="/var/log/security_scan_$(date +%Y%m%d).log"

# æ£€æŸ¥å¯ç–‘è¿›ç¨‹
check_processes() {
    echo "=== è¿›ç¨‹å®‰å…¨æ£€æŸ¥ ===" >> "$SCAN_REPORT"
    
    # æ£€æŸ¥é«˜CPUä½¿ç”¨ç‡è¿›ç¨‹
    ps aux --sort=-%cpu | head -10 >> "$SCAN_REPORT"
    
    # æ£€æŸ¥å¯ç–‘ç½‘ç»œè¿æ¥
    echo "ç½‘ç»œè¿æ¥æ£€æŸ¥:" >> "$SCAN_REPORT"
    netstat -tuln | grep LISTEN >> "$SCAN_REPORT"
}

# æ£€æŸ¥æ–‡ä»¶æƒé™
check_file_permissions() {
    echo "=== æ–‡ä»¶æƒé™æ£€æŸ¥ ===" >> "$SCAN_REPORT"
    
    # æŸ¥æ‰¾å…·æœ‰SUIDæƒé™çš„æ–‡ä»¶
    find / -perm -4000 -type f 2>/dev/null >> "$SCAN_REPORT"
    
    # æ£€æŸ¥é‡è¦é…ç½®æ–‡ä»¶æƒé™
    ls -la /etc/passwd /etc/shadow /etc/sudoers >> "$SCAN_REPORT"
}

# æ£€æŸ¥ç™»å½•å®‰å…¨
check_login_security() {
    echo "=== ç™»å½•å®‰å…¨æ£€æŸ¥ ===" >> "$SCAN_REPORT"
    
    # æ£€æŸ¥å¤±è´¥ç™»å½•å°è¯•
    grep "Failed password" /var/log/auth.log | tail -10 >> "$SCAN_REPORT"
    
    # æ£€æŸ¥sudoä½¿ç”¨è®°å½•
    grep "sudo:" /var/log/auth.log | tail -10 >> "$SCAN_REPORT"
}

# æ‰§è¡Œæ‰«æ
echo "å¼€å§‹å®‰å…¨æ‰«æ: $(date)" > "$SCAN_REPORT"
check_processes
check_file_permissions  
check_login_security
echo "æ‰«æå®Œæˆ: $(date)" >> "$SCAN_REPORT"
```

### 4.2 å®æ—¶ç›‘æ§è„šæœ¬


**ğŸ“Š ç³»ç»ŸçŠ¶æ€ç›‘æ§**ï¼š
```bash
#!/bin/bash
# ç³»ç»Ÿå®æ—¶ç›‘æ§è„šæœ¬

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
check_system_load() {
    LOAD=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | tr -d ',')
    LOAD_INT=$(echo "$LOAD * 100" | bc | cut -d. -f1)
    
    if [ "$LOAD_INT" -gt 80 ]; then
        echo "è­¦å‘Š: ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ ($LOAD)"
        return 1
    fi
    return 0
}

# æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk_space() {
    df -h | awk 'NR>1 {print $5 " " $6}' | while read usage mount; do
        usage_num=$(echo $usage | tr -d '%')
        if [ "$usage_num" -gt 90 ]; then
            echo "è­¦å‘Š: $mount ç£ç›˜ç©ºé—´ä¸è¶³ ($usage)"
        fi
    done
}

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
check_memory() {
    MEM_USAGE=$(free | awk '/^Mem:/ {printf "%.0f", $3/$2*100}')
    if [ "$MEM_USAGE" -gt 90 ]; then
        echo "è­¦å‘Š: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ ($MEM_USAGE%)"
    fi
}

# ä¸»ç›‘æ§å¾ªç¯
while true; do
    check_system_load
    check_disk_space
    check_memory
    sleep 300  # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
done
```

---

## 5. âš¡ æ€§èƒ½ä¼˜åŒ–è„šæœ¬


### 5.1 ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–


**æ€§èƒ½ä¼˜åŒ–ç†å¿µ**ï¼š
åƒç»™æ±½è½¦åšä¿å…»ä¸€æ ·ï¼Œå®šæœŸè°ƒä¼˜ç³»ç»Ÿå‚æ•°ï¼Œæ¸…ç†å†…å­˜ç¢ç‰‡ï¼Œä¼˜åŒ–é…ç½®ï¼Œè®©ç³»ç»Ÿè¿è¡Œæ›´æµç•…ã€‚

```bash
#!/bin/bash
# ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–è„šæœ¬

# å†…å­˜ä¼˜åŒ–
optimize_memory() {
    echo "ä¼˜åŒ–å†…å­˜ä½¿ç”¨..."
    
    # æ¸…ç†ç¼“å­˜
    sync
    echo 3 > /proc/sys/vm/drop_caches
    
    # ä¼˜åŒ–swapä½¿ç”¨
    sysctl vm.swappiness=10
    
    echo "å†…å­˜ä¼˜åŒ–å®Œæˆ"
}

# ç½‘ç»œä¼˜åŒ–
optimize_network() {
    echo "ä¼˜åŒ–ç½‘ç»œæ€§èƒ½..."
    
    # TCPæ€§èƒ½è°ƒä¼˜
    sysctl net.core.rmem_max=16777216
    sysctl net.core.wmem_max=16777216
    sysctl net.ipv4.tcp_rmem="4096 87380 16777216"
    
    echo "ç½‘ç»œä¼˜åŒ–å®Œæˆ"
}

# ç£ç›˜I/Oä¼˜åŒ–
optimize_disk_io() {
    echo "ä¼˜åŒ–ç£ç›˜I/O..."
    
    # è®¾ç½®ç£ç›˜è°ƒåº¦ç­–ç•¥
    for disk in /sys/block/sd*/queue/scheduler; do
        if [ -f "$disk" ]; then
            echo "deadline" > "$disk" 2>/dev/null
        fi
    done
    
    echo "ç£ç›˜I/Oä¼˜åŒ–å®Œæˆ"
}

# æ‰§è¡Œä¼˜åŒ–
optimize_memory
optimize_network
optimize_disk_io
```

### 5.2 æœåŠ¡æ€§èƒ½è°ƒä¼˜


**ğŸš€ WebæœåŠ¡ä¼˜åŒ–ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# WebæœåŠ¡æ€§èƒ½è°ƒä¼˜è„šæœ¬

# Nginxä¼˜åŒ–
optimize_nginx() {
    if systemctl is-active --quiet nginx; then
        echo "ä¼˜åŒ–Nginxé…ç½®..."
        
        # æ£€æŸ¥workerè¿›ç¨‹æ•°é‡
        CPU_CORES=$(nproc)
        WORKER_PROCESSES=$(grep "worker_processes" /etc/nginx/nginx.conf | awk '{print $2}' | tr -d ';')
        
        if [ "$WORKER_PROCESSES" != "$CPU_CORES" ]; then
            echo "å»ºè®®è°ƒæ•´worker_processesä¸º $CPU_CORES"
        fi
    fi
}

# æ•°æ®åº“ä¼˜åŒ–
optimize_database() {
    if systemctl is-active --quiet mysql; then
        echo "æ£€æŸ¥MySQLæ€§èƒ½..."
        
        # æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—
        SLOW_QUERIES=$(mysql -e "SHOW GLOBAL STATUS LIKE 'Slow_queries';" | tail -1 | awk '{print $2}')
        if [ "$SLOW_QUERIES" -gt 0 ]; then
            echo "å‘ç° $SLOW_QUERIES ä¸ªæ…¢æŸ¥è¯¢ï¼Œå»ºè®®æ£€æŸ¥æŸ¥è¯¢ä¼˜åŒ–"
        fi
    fi
}

optimize_nginx
optimize_database
```

---

## 6. ğŸ”„ æ•…éšœè‡ªåŠ¨æ¢å¤æœºåˆ¶


### 6.1 æœåŠ¡è‡ªåŠ¨é‡å¯è„šæœ¬


**æ•…éšœæ¢å¤ç†å¿µ**ï¼š
åƒå®¶é‡Œçš„ä¿é™©ä¸ä¸€æ ·ï¼Œå½“ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œè‡ªåŠ¨é‡‡å–æ¢å¤æªæ–½ï¼Œå‡å°‘åœæœºæ—¶é—´ã€‚

```bash
#!/bin/bash
# æœåŠ¡è‡ªåŠ¨æ¢å¤è„šæœ¬

# æœåŠ¡åˆ—è¡¨é…ç½®
SERVICES=("nginx" "mysql" "redis" "php7.4-fpm")
LOG_FILE="/var/log/service_recovery.log"

# è®°å½•æ—¥å¿—å‡½æ•°
log_event() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

# æ£€æŸ¥å¹¶æ¢å¤æœåŠ¡
check_and_recover_service() {
    local service=$1
    
    if ! systemctl is-active --quiet "$service"; then
        log_event "æœåŠ¡ $service å·²åœæ­¢ï¼Œå°è¯•é‡å¯..."
        
        # å°è¯•é‡å¯æœåŠ¡
        if systemctl restart "$service"; then
            log_event "æœåŠ¡ $service é‡å¯æˆåŠŸ"
        else
            log_event "æœåŠ¡ $service é‡å¯å¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„"
            # å‘é€å‘Šè­¦é€šçŸ¥
            echo "æœåŠ¡ $service é‡å¯å¤±è´¥" | mail -s "æœåŠ¡æ•…éšœå‘Šè­¦" admin@company.com
        fi
    fi
}

# ä¸»æ¢å¤å¾ªç¯
main() {
    for service in "${SERVICES[@]}"; do
        check_and_recover_service "$service"
    done
}

main
```

### 6.2 å¥åº·æ£€æŸ¥è„šæœ¬


**ğŸ¥ ç³»ç»Ÿå¥åº·è¯Šæ–­**ï¼š
```bash
#!/bin/bash
# ç³»ç»Ÿå¥åº·æ£€æŸ¥è„šæœ¬

HEALTH_REPORT="/tmp/system_health.txt"

# ç»¼åˆå¥åº·è¯„åˆ†
calculate_health_score() {
    local score=100
    
    # CPUä½¿ç”¨ç‡æ£€æŸ¥
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | tr -d '%us,')
    if (( $(echo "$CPU_USAGE > 80" | bc -l) )); then
        score=$((score - 20))
    fi
    
    # å†…å­˜ä½¿ç”¨ç‡æ£€æŸ¥  
    MEM_USAGE=$(free | awk '/^Mem:/ {printf "%.0f", $3/$2*100}')
    if [ "$MEM_USAGE" -gt 85 ]; then
        score=$((score - 15))
    fi
    
    # ç£ç›˜ç©ºé—´æ£€æŸ¥
    DISK_USAGE=$(df / | awk 'NR==2 {print $5}' | tr -d '%')
    if [ "$DISK_USAGE" -gt 90 ]; then
        score=$((score - 25))
    fi
    
    echo $score
}

# ç”Ÿæˆå¥åº·æŠ¥å‘Š
generate_health_report() {
    echo "=== ç³»ç»Ÿå¥åº·æŠ¥å‘Š $(date) ===" > "$HEALTH_REPORT"
    echo "å¥åº·è¯„åˆ†: $(calculate_health_score)/100" >> "$HEALTH_REPORT"
    echo "CPUä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}')" >> "$HEALTH_REPORT"
    echo "å†…å­˜ä½¿ç”¨ç‡: $(free | awk '/^Mem:/ {printf "%.1f%%", $3/$2*100}')" >> "$HEALTH_REPORT"
    echo "ç£ç›˜ä½¿ç”¨ç‡: $(df -h / | awk 'NR==2 {print $5}')" >> "$HEALTH_REPORT"
    
    cat "$HEALTH_REPORT"
}

generate_health_report
```

---

## 7. ğŸ¤” Shell vs å…¶ä»–è¯­è¨€é€‰æ‹©


### 7.1 Shellè„šæœ¬é€‚ç”¨åœºæ™¯


**Shellçš„å¤©ç„¶ä¼˜åŠ¿**ï¼š
Shellå°±åƒç³»ç»Ÿç®¡ç†çš„"ç‘å£«å†›åˆ€"ï¼Œå¤©ç”Ÿå°±æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿäº¤äº’è€Œè®¾è®¡çš„ã€‚

```
âœ… Shellè„šæœ¬æœ€é€‚åˆçš„åœºæ™¯ï¼š

ç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼š
â€¢ æ–‡ä»¶æ“ä½œå’Œå¤„ç†
â€¢ è¿›ç¨‹ç®¡ç†
â€¢ æœåŠ¡æ§åˆ¶
â€¢ ç³»ç»Ÿé…ç½®

è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼š
â€¢ æ‰¹é‡å®‰è£…è½¯ä»¶
â€¢ é…ç½®æ–‡ä»¶éƒ¨ç½²
â€¢ æœåŠ¡å¯åœæ§åˆ¶
â€¢ ç¯å¢ƒå˜é‡è®¾ç½®

ç›‘æ§å’Œç»´æŠ¤ï¼š
â€¢ æ—¥å¿—åˆ†æ
â€¢ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
â€¢ å®šæœŸæ¸…ç†ä»»åŠ¡
â€¢ ç®€å•çš„æ•°æ®å¤„ç†
```

### 7.2 Shell vs Pythonå¯¹æ¯”


**ğŸ“Š æŠ€æœ¯å¯¹æ¯”åˆ†æ**ï¼š

| ç»´åº¦ | **Shell** | **Python** |
|------|-----------|------------|
| **å­¦ä¹ æˆæœ¬** | `è¾ƒä½ï¼Œè¯­æ³•ç®€å•` | `ä¸­ç­‰ï¼Œé¢å‘å¯¹è±¡` |
| **å¼€å‘é€Ÿåº¦** | `å¿«é€Ÿï¼Œä¸€è¡Œè§£å†³` | `ä¸­ç­‰ï¼Œéœ€è¦å¯¼å…¥åº“` |
| **ç³»ç»Ÿé›†æˆ** | `å¤©ç„¶ä¼˜åŠ¿` | `éœ€è¦subprocess` |
| **å¤æ‚é€»è¾‘** | `èƒ½åŠ›æœ‰é™` | `åŠŸèƒ½å¼ºå¤§` |
| **å¯ç»´æŠ¤æ€§** | `ç®€å•è„šæœ¬å¥½ç»´æŠ¤` | `å¤§å‹é¡¹ç›®æ›´å¥½` |
| **æ€§èƒ½** | `è°ƒç”¨ç³»ç»Ÿå‘½ä»¤å¿«` | `è®¡ç®—å¯†é›†å‹æ›´å¿«` |

### 7.3 é€‰æ‹©å»ºè®®å’Œå®ä¾‹


**ğŸ¯ å…·ä½“åœºæ™¯é€‰æ‹©**ï¼š

**é€‰æ‹©Shellçš„åœºæ™¯**ï¼š
```bash
# ç³»ç»Ÿç»´æŠ¤ï¼šå¤©ç„¶é€‚åˆ
#!/bin/bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p database > backup_$(date +%Y%m%d).sql
tar -czf backup.tar.gz backup_*.sql
scp backup.tar.gz user@backup-server:/backups/

# æ‰¹é‡æ“ä½œï¼šShellæ›´ç®€æ´
find /var/log -name "*.log" -mtime +30 -exec rm {} \;
```

**é€‰æ‹©Pythonçš„åœºæ™¯**ï¼š
```python
# å¤æ‚æ•°æ®å¤„ç†ï¼šPythonæ›´å¼º
import pandas as pd
import matplotlib.pyplot as plt

# åˆ†ææ—¥å¿—æ•°æ®
df = pd.read_csv('access.log', sep=' ')
daily_stats = df.groupby('date').size()
daily_stats.plot(kind='line')
```

**é€‰æ‹©Perlçš„åœºæ™¯**ï¼š
```perl
# æ–‡æœ¬å¤„ç†å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼šPerlä¸“é•¿
perl -pe 's/(\d{1,3}\.){3}\d{1,3}/[IP_HIDDEN]/g' access.log
# ä¸€è¡Œä»£ç éšè—æ—¥å¿—ä¸­çš„IPåœ°å€
```

### 7.4 æ··åˆä½¿ç”¨ç­–ç•¥


**ğŸ”§ æœ€ä½³å®è·µç»„åˆ**ï¼š
```bash
#!/bin/bash
# Shellä¸»æ§è„šæœ¬ï¼Œè°ƒç”¨å…¶ä»–è¯­è¨€å¤„ç†å¤æ‚ä»»åŠ¡

# Shellå¤„ç†ç³»ç»Ÿæ“ä½œ
systemctl stop apache2

# Pythonå¤„ç†å¤æ‚è®¡ç®—
python3 /scripts/log_analyzer.py /var/log/apache2/access.log > report.json

# Shellå¤„ç†ç»“æœ
if [ -f report.json ]; then
    echo "æ—¥å¿—åˆ†æå®Œæˆ"
    # å‘é€æŠ¥å‘Š
    mail -s "æ—¥å¿—åˆ†ææŠ¥å‘Š" admin@company.com < report.json
fi

# æ¢å¤æœåŠ¡
systemctl start apache2
```

**ğŸ¯ é€‰æ‹©å†³ç­–æµç¨‹**ï¼š
```
ä»»åŠ¡å¤æ‚åº¦åˆ†æï¼š
ç®€å•ç³»ç»Ÿæ“ä½œ â†’ Shell
å¤æ‚æ•°æ®å¤„ç† â†’ Python
é«˜æ€§èƒ½è®¡ç®— â†’ C/C++
æ–‡æœ¬å¤„ç† â†’ Shell/Perl
Webå¼€å‘ â†’ Python/PHP
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ç»´æŠ¤è„šæœ¬æœ¬è´¨ï¼šè‡ªåŠ¨åŒ–æ‰§è¡Œé‡å¤æ€§ç³»ç»Ÿç®¡ç†ä»»åŠ¡
ğŸ”¸ è„šæœ¬åˆ†ç±»ï¼šæ¸…ç†ã€ç›‘æ§ã€ä¼˜åŒ–ã€æ¢å¤å››å¤§ç±»å‹
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šå®‰å…¨ç¬¬ä¸€ã€ç¨³å®šå¯é ã€æ˜“äºç»´æŠ¤
ğŸ”¸ è‡ªåŠ¨åŒ–ç­–ç•¥ï¼šcronå®šæ—¶æ‰§è¡Œã€æ—¥å¿—è®°å½•ã€å¼‚å¸¸å¤„ç†
ğŸ”¸ è¯­è¨€é€‰æ‹©ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦å’Œæ€§èƒ½è¦æ±‚é€‰æ‹©åˆé€‚å·¥å…·
ğŸ”¸ æœ€ä½³å®è·µï¼šå‚æ•°åŒ–é…ç½®ã€æ¨¡å—åŒ–è®¾è®¡ã€å……åˆ†æµ‹è¯•
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆShellé€‚åˆç»´æŠ¤è„šæœ¬**ï¼š
```
å¤©ç„¶ä¼˜åŠ¿ï¼š
â€¢ ç›´æ¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤
â€¢ ç®¡é“å’Œé‡å®šå‘æœºåˆ¶å¼ºå¤§
â€¢ ä¸ç³»ç»Ÿé›†æˆåº¦æœ€é«˜
â€¢ å­¦ä¹ æˆæœ¬ä½ï¼Œå¼€å‘é€Ÿåº¦å¿«

é€‚ç”¨èŒƒå›´ï¼š
â€¢ æ–‡ä»¶å’Œç›®å½•æ“ä½œ
â€¢ è¿›ç¨‹å’ŒæœåŠ¡ç®¡ç†  
â€¢ ç³»ç»Ÿé…ç½®ä¿®æ”¹
â€¢ ç®€å•çš„ç›‘æ§æ£€æŸ¥
```

**ğŸ”¹ ç»´æŠ¤è„šæœ¬çš„æ ¸å¿ƒä»·å€¼**ï¼š
```
æ•ˆç‡æå‡ï¼š
â€¢ è‡ªåŠ¨åŒ–å‡å°‘æ‰‹å·¥æ“ä½œ
â€¢ æ ‡å‡†åŒ–å‡å°‘æ“ä½œé”™è¯¯
â€¢ å®šæ—¶æ‰§è¡Œæ— éœ€äººå·¥å¹²é¢„
â€¢ æ‰¹é‡å¤„ç†æé«˜æ•ˆç‡

ç³»ç»Ÿç¨³å®šï¼š
â€¢ å®šæœŸæ¸…ç†é˜²æ­¢èµ„æºè€—å°½
â€¢ ä¸»åŠ¨ç›‘æ§åŠæ—¶å‘ç°é—®é¢˜
â€¢ è‡ªåŠ¨æ¢å¤å‡å°‘åœæœºæ—¶é—´
â€¢ æ€§èƒ½ä¼˜åŒ–ä¿æŒç³»ç»Ÿå¥åº·
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ ä¼ä¸šçº§ç»´æŠ¤ç­–ç•¥**ï¼š
```
åˆ†å±‚ç»´æŠ¤ï¼š
â€¢ åŸºç¡€å±‚ï¼šç³»ç»Ÿæ¸…ç†ã€æ›´æ–°ã€ç›‘æ§
â€¢ åº”ç”¨å±‚ï¼šæœåŠ¡ç›‘æ§ã€æ€§èƒ½ä¼˜åŒ–
â€¢ ä¸šåŠ¡å±‚ï¼šæ•°æ®å¤‡ä»½ã€æ•…éšœæ¢å¤

è¿ç»´è‡ªåŠ¨åŒ–ï¼š
â€¢ å»ºç«‹æ ‡å‡†åŒ–è„šæœ¬åº“
â€¢ é…ç½®ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼
â€¢ è®¾ç½®åˆç†çš„å‘Šè­¦æœºåˆ¶
â€¢ å®ç°æ•…éšœè‡ªåŠ¨æ¢å¤
```

**ğŸ¯ ä¸ªäººå­¦ä¹ å»ºè®®**ï¼š
```
å­¦ä¹ è·¯å¾„ï¼š
1. æŒæ¡åŸºæœ¬Shellè¯­æ³•å’Œç³»ç»Ÿå‘½ä»¤
2. å­¦ä¼šç¼–å†™ç®€å•çš„æ¸…ç†å’Œç›‘æ§è„šæœ¬
3. ç†è§£cronå®šæ—¶ä»»åŠ¡é…ç½®
4. æŒæ¡æ—¥å¿—è®°å½•å’Œå¼‚å¸¸å¤„ç†
5. å­¦ä¹ ä¸åŒè¯­è¨€çš„é€‚ç”¨åœºæ™¯

å®è·µé¡¹ç›®ï¼š
â€¢ ç¼–å†™ä¸ªäººç”µè„‘çš„æ¸…ç†è„šæœ¬
â€¢ åˆ›å»ºæœåŠ¡å™¨ç›‘æ§è„šæœ¬
â€¢ å®ç°ç®€å•çš„å¤‡ä»½è„šæœ¬
â€¢ é…ç½®è‡ªåŠ¨åŒ–æ›´æ–°è„šæœ¬
```

### 8.4 å¸¸è§é—®é¢˜è§£ç­”


**â“ Shellè„šæœ¬å®‰å…¨å—ï¼Ÿ**
```
å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š
â€¢ è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™ (chmod 750)
â€¢ éªŒè¯ç”¨æˆ·è¾“å…¥é¿å…æ³¨å…¥æ”»å‡»
â€¢ ä½¿ç”¨ç»å¯¹è·¯å¾„é¿å…PATHåŠ«æŒ
â€¢ é‡è¦æ“ä½œå‰è¿›è¡Œå¤‡ä»½
â€¢ è®°å½•è¯¦ç»†çš„æ“ä½œæ—¥å¿—
```

**â“ å¦‚ä½•å¤„ç†è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Ÿ**
```
æ•…éšœå¤„ç†ç­–ç•¥ï¼š
â€¢ ä½¿ç”¨set -eè‡ªåŠ¨é€€å‡ºé”™è¯¯
â€¢ æ£€æŸ¥å‘½ä»¤æ‰§è¡Œè¿”å›å€¼
â€¢ å®ç°é‡è¯•æœºåˆ¶
â€¢ å‘é€å‘Šè­¦é€šçŸ¥
â€¢ è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
```

**â“ Shellè„šæœ¬æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ**
```
æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼š
â€¢ é¿å…ä¸å¿…è¦çš„å­shellåˆ›å»º
â€¢ ä½¿ç”¨å†…ç½®å‘½ä»¤æ›¿ä»£å¤–éƒ¨ç¨‹åº
â€¢ åˆç†ä½¿ç”¨ç®¡é“å’Œé‡å®šå‘
â€¢ é¿å…é¢‘ç¹çš„æ–‡ä»¶I/Oæ“ä½œ
â€¢ ä½¿ç”¨æ•°ç»„å’Œå˜é‡å‡å°‘é‡å¤è®¡ç®—
```

### 8.5 å‘å±•å»ºè®®


**ğŸš€ æŠ€èƒ½æå‡æ–¹å‘**ï¼š
```
æŠ€æœ¯æ·±åŒ–ï¼š
â€¢ å­¦ä¹ é«˜çº§Shellç¼–ç¨‹æŠ€å·§
â€¢ æŒæ¡ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜æ–¹æ³•
â€¢ äº†è§£å®¹å™¨åŒ–è¿ç»´æŠ€æœ¯
â€¢ å­¦ä¹ Infrastructure as Code

å·¥å…·èåˆï¼š
â€¢ ç»“åˆAnsibleè¿›è¡Œè‡ªåŠ¨åŒ–
â€¢ ä½¿ç”¨Prometheusç›‘æ§ç³»ç»Ÿ
â€¢ é›†æˆCI/CD pipeline
â€¢ åº”ç”¨äº‘åŸç”Ÿè¿ç»´å·¥å…·
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- ç»´æŠ¤è„šæœ¬æ˜¯ç³»ç»Ÿç®¡ç†è‡ªåŠ¨åŒ–çš„åŸºç¡€å·¥å…·
- Shellå¤©ç”Ÿé€‚åˆç³»ç»Ÿç®¡ç†ä»»åŠ¡ï¼Œå­¦ä¹ æˆæœ¬ä½æ•ˆæœå¥½
- æ¸…ç†ã€ç›‘æ§ã€ä¼˜åŒ–ã€æ¢å¤æ˜¯ç»´æŠ¤è„šæœ¬çš„å››å¤§æ”¯æŸ±
- å®‰å…¨æ€§å’Œå¯é æ€§æ˜¯ç»´æŠ¤è„šæœ¬è®¾è®¡çš„é¦–è¦åŸåˆ™  
- æ ¹æ®ä»»åŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„ç¼–ç¨‹è¯­è¨€
- è‡ªåŠ¨åŒ–ä¸æ˜¯ç›®æ ‡ï¼Œç¨³å®šé«˜æ•ˆçš„ç³»ç»Ÿè¿è¡Œæ‰æ˜¯ç›®æ ‡

**æ ¸å¿ƒç†å¿µ**ï¼šå¥½çš„ç»´æŠ¤è„šæœ¬åº”è¯¥åƒå¿ è¯šçš„ç®¡å®¶ï¼Œé»˜é»˜å·¥ä½œã€åŠæ—¶å“åº”ã€ä»ä¸å‡ºé”™ã€‚é€šè¿‡æŒç»­çš„è‡ªåŠ¨åŒ–æ”¹è¿›ï¼Œè®©ç³»ç»Ÿç®¡ç†ä»ç¹ççš„ä½“åŠ›æ´»å˜æˆé«˜æ•ˆçš„è„‘åŠ›æ´»ï¼