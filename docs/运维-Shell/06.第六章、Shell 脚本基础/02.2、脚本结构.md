---
title: 2ã€è„šæœ¬ç»“æ„
---
## ğŸ“š ç›®å½•

1. [Shellè„šæœ¬åŸºæœ¬ç»“æ„](#1-Shellè„šæœ¬åŸºæœ¬ç»“æ„)
2. [è„šæœ¬å¤´éƒ¨ä¿¡æ¯è§„èŒƒ](#2-è„šæœ¬å¤´éƒ¨ä¿¡æ¯è§„èŒƒ)
3. [ä»£ç åŒºåŸŸç»„ç»‡](#3-ä»£ç åŒºåŸŸç»„ç»‡)
4. [é”™è¯¯å¤„ç†æœºåˆ¶](#4-é”™è¯¯å¤„ç†æœºåˆ¶)
5. [è„šæœ¬æ¨¡æ¿è®¾è®¡](#5-è„šæœ¬æ¨¡æ¿è®¾è®¡)
6. [ä»£ç ç»„ç»‡æœ€ä½³å®è·µ](#6-ä»£ç ç»„ç»‡æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ Shellè„šæœ¬åŸºæœ¬ç»“æ„


### 1.1 å®Œæ•´è„šæœ¬ç»“æ„æ¦‚è§ˆ


ä¸€ä¸ªè§„èŒƒçš„Shellè„šæœ¬å°±åƒä¸€æ ‹æˆ¿å­ï¼Œæœ‰æ¸…æ™°çš„ç»“æ„å±‚æ¬¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è„šæœ¬å¤´éƒ¨ä¿¡æ¯   â”‚ â† ä½œè€…ã€ç‰ˆæœ¬ã€ç”¨é€”ç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç¯å¢ƒè®¾ç½®åŒºåŸŸ   â”‚ â† Shebangã€setå‘½ä»¤ç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å˜é‡å£°æ˜åŒºåŸŸ   â”‚ â† å…¨å±€å˜é‡ã€é…ç½®å‚æ•°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å‡½æ•°å®šä¹‰åŒºåŸŸ   â”‚ â† è‡ªå®šä¹‰å‡½æ•°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸»ç¨‹åºé€»è¾‘     â”‚ â† æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é”™è¯¯å¤„ç†æœºåˆ¶   â”‚ â† å¼‚å¸¸æ•è·ä¸å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è„šæœ¬ç»“æ„çš„é‡è¦æ€§


> ğŸ’¡ **ä¸ºä»€ä¹ˆéœ€è¦ç»“æ„åŒ–ï¼Ÿ**
> 
> å°±åƒå†™æ–‡ç« éœ€è¦æœ‰å¼€å¤´ã€æ­£æ–‡ã€ç»“å°¾ä¸€æ ·ï¼ŒShellè„šæœ¬ä¹Ÿéœ€è¦æ¸…æ™°çš„ç»“æ„ã€‚è¿™æ ·åšçš„å¥½å¤„ï¼š
> - **æ˜“è¯»æ€§**ï¼šåˆ«äººï¼ˆåŒ…æ‹¬æœªæ¥çš„è‡ªå·±ï¼‰èƒ½å¿«é€Ÿç†è§£è„šæœ¬åŠŸèƒ½
> - **ç»´æŠ¤æ€§**ï¼šå‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½å’Œä¿®æ”¹
> - **æ‰©å±•æ€§**ï¼šæ·»åŠ æ–°åŠŸèƒ½æ—¶çŸ¥é“è¯¥æ”¾åœ¨å“ªé‡Œ
> - **ä¸“ä¸šæ€§**ï¼šä½“ç°ç¼–ç¨‹è§„èŒƒå’ŒèŒä¸šç´ å…»

---

## 2. ğŸ“ è„šæœ¬å¤´éƒ¨ä¿¡æ¯è§„èŒƒ


### 2.1 æ ‡å‡†å¤´éƒ¨ä¿¡æ¯æ¨¡æ¿


è„šæœ¬å¤´éƒ¨å°±åƒèº«ä»½è¯ï¼Œè®°å½•äº†è„šæœ¬çš„"èº«ä»½ä¿¡æ¯"ï¼š

```bash
#!/bin/bash
#
# è„šæœ¬åç§°: backup_system.sh
# ä½œè€…: å¼ ä¸‰ (zhangsan@company.com)
# åˆ›å»ºæ—¥æœŸ: 2024-09-19
# æœ€åä¿®æ”¹: 2024-09-19
# ç‰ˆæœ¬: v1.0.0
#
# è„šæœ¬æè¿°:
#   ç³»ç»Ÿæ–‡ä»¶è‡ªåŠ¨å¤‡ä»½å·¥å…·
#   æ”¯æŒå¢é‡å¤‡ä»½å’Œå‹ç¼©å­˜å‚¨
#
# ä½¿ç”¨æ–¹æ³•:
#   ./backup_system.sh [é€‰é¡¹] æºç›®å½• ç›®æ ‡ç›®å½•
#   é€‰é¡¹: -c å‹ç¼©å¤‡ä»½, -v è¯¦ç»†è¾“å‡º
#
# ä¾èµ–ç¯å¢ƒ:
#   - bash 4.0+
#   - tar, gzip
#
# é€€å‡ºçŠ¶æ€ç :
#   0: æˆåŠŸ
#   1: å‚æ•°é”™è¯¯
#   2: æºç›®å½•ä¸å­˜åœ¨
#   3: ç›®æ ‡ç›®å½•æ— æƒé™
#
###############################################################################

```

### 2.2 å¤´éƒ¨ä¿¡æ¯å„éƒ¨åˆ†è¯¦è§£


**ğŸ”¸ Shebangè¡Œï¼ˆ#!/bin/bashï¼‰**
```bash
#!/bin/bash          # æœ€å¸¸ç”¨ï¼Œå…¼å®¹æ€§å¥½
#!/usr/bin/env bash  # æ›´çµæ´»ï¼Œè‡ªåŠ¨æŸ¥æ‰¾bashä½ç½®
#!/bin/sh            # POSIXå…¼å®¹ï¼Œä½†åŠŸèƒ½æœ‰é™
```

> ğŸ§  **è®°å¿†æŠ€å·§**ï¼šShebang = Sharp(#) + Bang(!)ï¼Œå‘Šè¯‰ç³»ç»Ÿç”¨ä»€ä¹ˆè§£é‡Šå™¨è¿è¡Œè„šæœ¬

**ğŸ”¸ åŸºæœ¬ä¿¡æ¯å­—æ®µ**
```markdown
ğŸ“‹ **å¿…å¡«å­—æ®µ**
- è„šæœ¬åç§°ï¼šæ–‡ä»¶ååŠç®€çŸ­è¯´æ˜
- ä½œè€…ä¿¡æ¯ï¼šå§“åå’Œè”ç³»æ–¹å¼
- åˆ›å»ºæ—¥æœŸï¼šé¦–æ¬¡åˆ›å»ºæ—¶é—´
- ç‰ˆæœ¬å·ï¼šä¾¿äºç‰ˆæœ¬ç®¡ç†

ğŸ“‹ **å»ºè®®å­—æ®µ**
- æœ€åä¿®æ”¹ï¼šä¾¿äºäº†è§£æ›´æ–°æƒ…å†µ
- è„šæœ¬æè¿°ï¼šè¯¦ç»†è¯´æ˜åŠŸèƒ½å’Œç”¨é€”
- ä½¿ç”¨æ–¹æ³•ï¼šå‘½ä»¤è¡Œè°ƒç”¨ç¤ºä¾‹
- ä¾èµ–ç¯å¢ƒï¼šè¿è¡Œæ‰€éœ€çš„è½¯ä»¶å’Œç‰ˆæœ¬
- é€€å‡ºçŠ¶æ€ç ï¼šä¸åŒè¿”å›å€¼çš„å«ä¹‰
```

### 2.3 ç‰ˆæœ¬å·ç®¡ç†è§„èŒƒ


**è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶**ï¼ˆä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬ï¼‰ï¼š
```bash
# v1.0.0 - åˆå§‹ç‰ˆæœ¬
# v1.1.0 - æ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹
# v1.1.1 - Bugä¿®å¤
# v2.0.0 - é‡å¤§æ›´æ”¹ï¼Œå¯èƒ½ä¸å…¼å®¹æ—§ç‰ˆæœ¬
```

---

## 3. ğŸ”§ ä»£ç åŒºåŸŸç»„ç»‡


### 3.1 ç¯å¢ƒè®¾ç½®åŒºåŸŸ


è¿™éƒ¨åˆ†è´Ÿè´£è®¾ç½®è„šæœ¬è¿è¡Œç¯å¢ƒï¼Œç¡®ä¿è„šæœ¬è¡Œä¸ºå¯é¢„æµ‹ï¼š

```bash
#!/bin/bash

###############################################################################

# ç¯å¢ƒè®¾ç½®åŒºåŸŸ
###############################################################################


# ä¸¥æ ¼æ¨¡å¼è®¾ç½®
set -euo pipefail  # é‡é”™å³åœï¼Œæœªå®šä¹‰å˜é‡æŠ¥é”™ï¼Œç®¡é“ä»»ä¸€å‘½ä»¤å¤±è´¥åˆ™å¤±è´¥

# IFSè®¾ç½®ï¼ˆå†…éƒ¨å­—æ®µåˆ†éš”ç¬¦ï¼‰
IFS=$'\n\t'       # åªç”¨æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ä½œåˆ†éš”ç¬¦ï¼Œé¿å…ç©ºæ ¼é—®é¢˜

# è„šæœ¬ç›®å½•è·å–
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCRIPT_NAME="$(basename "$0")"
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šç¯å¢ƒè®¾ç½®å°±åƒå¼€è½¦å‰è°ƒåº§æ¤…ã€åè§†é•œï¼Œç¡®ä¿ä¸€åˆ‡å°±ç»ªå†å‡ºå‘

**ğŸ”¸ setå‘½ä»¤è¯¦è§£**
```bash
set -e  # errexitï¼šä»»ä½•å‘½ä»¤å¤±è´¥ç«‹å³é€€å‡º
set -u  # nounsetï¼šä½¿ç”¨æœªå®šä¹‰å˜é‡æ—¶æŠ¥é”™  
set -o pipefail  # ç®¡é“ä¸­ä»»ä¸€å‘½ä»¤å¤±è´¥ï¼Œæ•´ä¸ªç®¡é“å°±å¤±è´¥

# ç»„åˆå†™æ³•
set -euo pipefail  # æ¨èçš„ä¸¥æ ¼æ¨¡å¼
```

### 3.2 å˜é‡å£°æ˜åŒºåŸŸ


å˜é‡å£°æ˜è¦åˆ†ç±»ç»„ç»‡ï¼Œå°±åƒæ•´ç†ç‰©å“è¦åˆ†é—¨åˆ«ç±»ï¼š

```bash
###############################################################################

# å˜é‡å£°æ˜åŒºåŸŸ
###############################################################################


# === é…ç½®å‚æ•° ===
readonly DEFAULT_BACKUP_DIR="/backup"    # é»˜è®¤å¤‡ä»½ç›®å½•
readonly MAX_BACKUP_DAYS=30             # å¤‡ä»½ä¿ç•™å¤©æ•°
readonly LOG_LEVEL="INFO"               # æ—¥å¿—çº§åˆ«

# === è¿è¡Œæ—¶å˜é‡ ===
SOURCE_DIR=""        # æºç›®å½•ï¼ˆç”±ç”¨æˆ·å‚æ•°æŒ‡å®šï¼‰
TARGET_DIR=""        # ç›®æ ‡ç›®å½•
COMPRESS_MODE=false  # æ˜¯å¦å¯ç”¨å‹ç¼©
VERBOSE_MODE=false   # æ˜¯å¦è¯¦ç»†è¾“å‡º

# === ç³»ç»Ÿä¿¡æ¯ ===
readonly HOSTNAME=$(hostname)
readonly CURRENT_USER=$(whoami)
readonly TIMESTAMP=$(date '+%Y%m%d_%H%M%S')
```

**ğŸ”¸ å˜é‡å‘½åè§„èŒƒ**
```markdown
âœ… **å¥½çš„å‘½å**
- `SOURCE_DIR`ï¼šæè¿°æ€§å¼ºï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯æºç›®å½•
- `MAX_BACKUP_DAYS`ï¼šå«ä¹‰æ˜ç¡®
- `readonly`ï¼šå¸¸é‡ç”¨readonlyä¿®é¥°

âŒ **ä¸å¥½çš„å‘½å**  
- `a`, `temp`, `data`ï¼šå«ä¹‰ä¸æ˜
- `dir1`, `dir2`ï¼šä¸çŸ¥é“å…·ä½“ç”¨é€”
- é©¼å³°å‘½åï¼šShellä¼ ç»Ÿç”¨ä¸‹åˆ’çº¿åˆ†éš”
```

### 3.3 å‡½æ•°å®šä¹‰åŒºåŸŸ


å‡½æ•°æ˜¯ä»£ç çš„"ç§¯æœ¨å—"ï¼ŒæŠŠç›¸å…³åŠŸèƒ½å°è£…èµ·æ¥ï¼š

```bash
###############################################################################

# å‡½æ•°å®šä¹‰åŒºåŸŸ  
###############################################################################


# æ—¥å¿—è¾“å‡ºå‡½æ•°
log() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] [$level] $message" >&2
}

# é”™è¯¯é€€å‡ºå‡½æ•°
die() {
    log "ERROR" "$1"
    exit "${2:-1}"
}

# æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
check_directory() {
    local dir="$1"
    local desc="$2"
    
    if [[ ! -d "$dir" ]]; then
        die "$desc ä¸å­˜åœ¨: $dir" 2
    fi
    
    if [[ ! -r "$dir" ]]; then
        die "$desc æ— è¯»å–æƒé™: $dir" 3
    fi
}
```

> ğŸ¯ **å‡½æ•°è®¾è®¡åŸåˆ™**ï¼šä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œå°±åƒå·¥å…·ç®±é‡Œçš„å·¥å…·ï¼Œæ¯ä¸ªéƒ½æœ‰ä¸“é—¨ç”¨é€”

---

## 4. ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶


### 4.1 é”™è¯¯å¤„ç†çš„é‡è¦æ€§


ç¨‹åºè¿è¡Œæ—¶ä¼šé‡åˆ°å„ç§æ„å¤–æƒ…å†µï¼Œå°±åƒå¼€è½¦ä¼šé‡åˆ°çº¢ç»¿ç¯ã€é“è·¯æ–½å·¥ç­‰ï¼š

```
æ­£å¸¸æµç¨‹ï¼š  å¯åŠ¨ â”€â”€> å¤„ç† â”€â”€> å®Œæˆ â”€â”€> é€€å‡º
å¼‚å¸¸æƒ…å†µï¼š  å¯åŠ¨ â”€â”€> é”™è¯¯ â”€â”€Xâ”€â”€> å´©æºƒ

æœ‰é”™è¯¯å¤„ç†ï¼šå¯åŠ¨ â”€â”€> é”™è¯¯ â”€â”€> å¤„ç† â”€â”€> æ¢å¤æˆ–ä¼˜é›…é€€å‡º
```

### 4.2 å¤šå±‚æ¬¡é”™è¯¯å¤„ç†


**ğŸ”¸ å‚æ•°æ ¡éªŒå±‚**
```bash
# å‚æ•°æ•°é‡æ£€æŸ¥
if [[ $# -lt 2 ]]; then
    echo "ç”¨æ³•: $0 æºç›®å½• ç›®æ ‡ç›®å½• [é€‰é¡¹]" >&2
    echo "è¯·ä½¿ç”¨ $0 -h æŸ¥çœ‹è¯¦ç»†å¸®åŠ©" >&2
    exit 1
fi

# å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥  
check_directory "$SOURCE_DIR" "æºç›®å½•"
check_directory "$TARGET_DIR" "ç›®æ ‡ç›®å½•"
```

**ğŸ”¸ è¿è¡Œæ—¶é”™è¯¯æ•è·**
```bash
# trapæ•è·ä¿¡å·å’Œé”™è¯¯
cleanup() {
    log "INFO" "æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
    rm -f /tmp/backup_$$_*
    log "INFO" "è„šæœ¬ç»“æŸ"
}

# æ•è·é€€å‡ºä¿¡å·
trap cleanup EXIT

# æ•è·é”™è¯¯
error_handler() {
    local line_number=$1
    log "ERROR" "è„šæœ¬åœ¨ç¬¬ $line_number è¡Œå‘ç”Ÿé”™è¯¯"
    exit 1
}

trap 'error_handler $LINENO' ERR
```

### 4.3 ä¼˜é›…é€€å‡ºå¤„ç†


```bash
# ä¿¡å·å¤„ç†å‡½æ•°
graceful_exit() {
    log "INFO" "æ¥æ”¶åˆ°é€€å‡ºä¿¡å·ï¼Œæ­£åœ¨å®‰å…¨é€€å‡º..."
    
    # åœæ­¢åå°ä»»åŠ¡
    if [[ -n "${BACKUP_PID:-}" ]]; then
        kill -TERM "$BACKUP_PID" 2>/dev/null || true
        wait "$BACKUP_PID" 2>/dev/null || true
    fi
    
    cleanup
    exit 0
}

# æ•è·ç”¨æˆ·ä¸­æ–­ä¿¡å·
trap graceful_exit SIGINT SIGTERM
```

---

## 5. ğŸ“‹ è„šæœ¬æ¨¡æ¿è®¾è®¡


### 5.1 é€šç”¨è„šæœ¬æ¨¡æ¿


è¿™æ˜¯ä¸€ä¸ªå¯ä»¥åå¤ä½¿ç”¨çš„è„šæœ¬æ¡†æ¶ï¼š

```bash
#!/bin/bash
#
# è„šæœ¬æ¨¡æ¿ v1.0
# ä½œè€…: [ä½ çš„åå­—]
# æ—¥æœŸ: $(date '+%Y-%m-%d')
# ç”¨é€”: [è„šæœ¬åŠŸèƒ½æè¿°]
#
###############################################################################


# ä¸¥æ ¼æ¨¡å¼
set -euo pipefail
IFS=$'\n\t'

# è„šæœ¬ä¿¡æ¯
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly SCRIPT_NAME="$(basename "$0")"
readonly VERSION="1.0.0"

# é»˜è®¤é…ç½®
VERBOSE=false
DRY_RUN=false

# å‡½æ•°å®šä¹‰åŒºåŸŸ
usage() {
    cat << EOF
ç”¨æ³•: $SCRIPT_NAME [é€‰é¡¹]

é€‰é¡¹:
    -h, --help     æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯
    -v, --verbose  è¯¦ç»†è¾“å‡º
    -n, --dry-run  æ¼”ç»ƒæ¨¡å¼ï¼Œä¸å®é™…æ‰§è¡Œ
    --version      æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

ç¤ºä¾‹:
    $SCRIPT_NAME -v
    $SCRIPT_NAME --dry-run

EOF
}

log() {
    local level="$1"
    shift
    echo "[$(date '+%H:%M:%S')] [$level] $*" >&2
}

main() {
    # ä¸»ç¨‹åºé€»è¾‘
    log "INFO" "è„šæœ¬å¼€å§‹æ‰§è¡Œ..."
    
    # TODO: åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ä»£ç 
    
    log "INFO" "è„šæœ¬æ‰§è¡Œå®Œæˆ"
}

# å‚æ•°è§£æ
while [[ $# -gt 0 ]]; do
    case $1 in
        -h|--help)
            usage
            exit 0
            ;;
        -v|--verbose)
            VERBOSE=true
            shift
            ;;
        -n|--dry-run)
            DRY_RUN=true
            shift
            ;;
        --version)
            echo "$SCRIPT_NAME version $VERSION"
            exit 0
            ;;
        *)
            echo "æœªçŸ¥å‚æ•°: $1" >&2
            usage
            exit 1
            ;;
    esac
done

# æ‰§è¡Œä¸»å‡½æ•°
main "$@"
```

### 5.2 ä¸åŒåœºæ™¯çš„æ¨¡æ¿å˜ä½“


**ğŸ”¸ æ–‡ä»¶å¤„ç†ç±»è„šæœ¬æ¨¡æ¿**
```bash
# é€‚ç”¨äºéœ€è¦å¤„ç†æ–‡ä»¶å’Œç›®å½•çš„è„šæœ¬
readonly INPUT_FILE="$1"
readonly OUTPUT_FILE="$2"

# æ–‡ä»¶æ£€æŸ¥å‡½æ•°
check_file() {
    local file="$1"
    [[ -f "$file" ]] || die "æ–‡ä»¶ä¸å­˜åœ¨: $file"
    [[ -r "$file" ]] || die "æ–‡ä»¶æ— æ³•è¯»å–: $file"
}
```

**ğŸ”¸ ç³»ç»Ÿç®¡ç†ç±»è„šæœ¬æ¨¡æ¿**  
```bash
# é€‚ç”¨äºç³»ç»Ÿç®¡ç†å’ŒæœåŠ¡æ“ä½œçš„è„šæœ¬
# æ£€æŸ¥rootæƒé™
check_root() {
    if [[ $EUID -ne 0 ]]; then
        die "æ­¤è„šæœ¬éœ€è¦rootæƒé™è¿è¡Œ"
    fi
}

# æ£€æŸ¥å‘½ä»¤æ˜¯å¦å­˜åœ¨
check_command() {
    command -v "$1" >/dev/null 2>&1 || die "å‘½ä»¤ä¸å­˜åœ¨: $1"
}
```

---

## 6. ğŸ¯ ä»£ç ç»„ç»‡æœ€ä½³å®è·µ


### 6.1 å‡½æ•°è®¾è®¡åŸåˆ™


**ğŸ”¸ å•ä¸€èŒè´£åŸåˆ™**
```bash
# âŒ ä¸å¥½çš„è®¾è®¡ï¼šä¸€ä¸ªå‡½æ•°åšå¤ªå¤šäº‹æƒ…
process_data() {
    # è¯»å–æ–‡ä»¶
    # æ•°æ®æ ¡éªŒ  
    # æ ¼å¼è½¬æ¢
    # å†™å…¥æ•°æ®åº“
    # å‘é€é‚®ä»¶
    # ... å¤ªå¤šèŒè´£
}

# âœ… å¥½çš„è®¾è®¡ï¼šæ¯ä¸ªå‡½æ•°èŒè´£å•ä¸€
read_file() { ... }
validate_data() { ... }  
convert_format() { ... }
save_to_database() { ... }
send_notification() { ... }
```

**ğŸ”¸ å‡½æ•°å‘½åè§„èŒƒ**
```markdown
åŠ¨è¯å¼€å¤´ï¼š`get_user_info`, `check_permission`, `backup_files`
å¸ƒå°”è¿”å›ï¼š`is_valid`, `has_permission`, `can_write`
å·¥å…·å‡½æ•°ï¼š`log`, `die`, `cleanup`
```

### 6.2 ä»£ç æ³¨é‡Šç­–ç•¥


```bash
# === å¥½çš„æ³¨é‡Šç¤ºä¾‹ ===

# è§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·åšï¼ˆWhyï¼‰
# ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶é¿å…å¹¶å‘å†™å…¥å¯¼è‡´çš„æ•°æ®æŸå
temp_file=$(mktemp)

# è§£é‡Šå¤æ‚çš„é€»è¾‘ï¼ˆWhatï¼‰  
# æå–IPåœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼ï¼šåŒ¹é… xxx.xxx.xxx.xxx æ ¼å¼
ip_pattern='^([0-9]{1,3}\.){3}[0-9]{1,3}$'

# é‡è¦çš„æ³¨æ„äº‹é¡¹ï¼ˆCautionï¼‰
# æ³¨æ„ï¼šåˆ é™¤æ“ä½œä¸å¯é€†ï¼Œè¯·ç¡®ä¿è·¯å¾„æ­£ç¡®
rm -rf "$backup_dir"
```

### 6.3 ç›®å½•ç»“æ„ç»„ç»‡


å¯¹äºå¤æ‚çš„è„šæœ¬é¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨æ ‡å‡†ç›®å½•ç»“æ„ï¼š

```
project/
â”œâ”€â”€ bin/                 # å¯æ‰§è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ main.sh
â”‚   â””â”€â”€ backup.sh
â”œâ”€â”€ lib/                 # å…¬å…±å‡½æ•°åº“
â”‚   â”œâ”€â”€ utils.sh         # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ config.sh        # é…ç½®ç›¸å…³å‡½æ•°
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ default.conf
â”‚   â””â”€â”€ prod.conf
â”œâ”€â”€ logs/                # æ—¥å¿—ç›®å½•
â”œâ”€â”€ tmp/                 # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                # æ–‡æ¡£
â”‚   â””â”€â”€ README.md
â””â”€â”€ tests/               # æµ‹è¯•è„šæœ¬
    â””â”€â”€ test_main.sh
```

### 6.4 é…ç½®ç®¡ç†æœ€ä½³å®è·µ


**ğŸ”¸ é…ç½®æ–‡ä»¶ç¤ºä¾‹**
```bash
# config/default.conf
# ç³»ç»Ÿé…ç½®
BACKUP_ROOT_DIR="/var/backups"
LOG_LEVEL="INFO" 
MAX_LOG_SIZE="100M"

# ä¸šåŠ¡é…ç½®
RETENTION_DAYS=30
COMPRESSION_LEVEL=6
EMAIL_NOTIFICATIONS=true
ADMIN_EMAIL="admin@company.com"
```

**ğŸ”¸ é…ç½®åŠ è½½å‡½æ•°**
```bash
load_config() {
    local config_file="${1:-config/default.conf}"
    
    if [[ -f "$config_file" ]]; then
        source "$config_file"
        log "INFO" "å·²åŠ è½½é…ç½®æ–‡ä»¶: $config_file"
    else
        log "WARN" "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®: $config_file"
    fi
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```markdown
ğŸ”¸ è„šæœ¬ç»“æ„ï¼šå¤´éƒ¨ä¿¡æ¯ â†’ ç¯å¢ƒè®¾ç½® â†’ å˜é‡å£°æ˜ â†’ å‡½æ•°å®šä¹‰ â†’ ä¸»é€»è¾‘
ğŸ”¸ å¤´éƒ¨è§„èŒƒï¼šShebangã€ä½œè€…ä¿¡æ¯ã€ç‰ˆæœ¬å·ã€ä½¿ç”¨è¯´æ˜ã€é€€å‡ºç 
ğŸ”¸ ç¯å¢ƒè®¾ç½®ï¼šset -euo pipefailã€IFSè®¾ç½®ã€è„šæœ¬è·¯å¾„è·å–
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šå‚æ•°æ ¡éªŒã€è¿è¡Œæ—¶æ•è·ã€ä¼˜é›…é€€å‡º
ğŸ”¸ ä»£ç ç»„ç»‡ï¼šå‡½æ•°å•ä¸€èŒè´£ã€åˆç†æ³¨é‡Šã€ç›®å½•ç»“æ„
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è§„èŒƒçš„è„šæœ¬ç»“æ„ï¼Ÿ**
```
å¯ç»´æŠ¤æ€§ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£å’Œä¿®æ”¹
å¯é‡ç”¨æ€§ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œå‡½æ•°å¯ä»¥åœ¨å…¶ä»–è„šæœ¬ä¸­é‡ç”¨  
å¯é æ€§ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†ï¼Œå‡å°‘æ„å¤–æƒ…å†µ
ä¸“ä¸šæ€§ï¼šä½“ç°ç¼–ç¨‹è§„èŒƒï¼Œä¾¿äºå›¢é˜Ÿåä½œ
```

**ğŸ”¹ é”™è¯¯å¤„ç†çš„å±‚æ¬¡**
```
é¢„é˜²æ€§ï¼šå‚æ•°æ ¡éªŒã€ç¯å¢ƒæ£€æŸ¥
ç›‘æ§æ€§ï¼šset -eã€trapæ•è·
æ¢å¤æ€§ï¼šcleanupå‡½æ•°ã€èµ„æºé‡Šæ”¾
ä¿¡æ¯æ€§ï¼šæ—¥å¿—è®°å½•ã€é”™è¯¯æŠ¥å‘Š
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ å·¥ä½œåœºæ™¯åº”ç”¨**
- **è¿ç»´è‡ªåŠ¨åŒ–**ï¼šç³»ç»Ÿå¤‡ä»½ã€æ—¥å¿—æ¸…ç†ã€æœåŠ¡éƒ¨ç½²
- **æ•°æ®å¤„ç†**ï¼šæ–‡ä»¶è½¬æ¢ã€æ‰¹é‡æ“ä½œã€æŠ¥è¡¨ç”Ÿæˆ  
- **ç›‘æ§å‘Šè­¦**ï¼šç³»ç»Ÿæ£€æŸ¥ã€æ€§èƒ½ç›‘æ§ã€å¼‚å¸¸é€šçŸ¥
- **å¼€å‘å·¥å…·**ï¼šæ„å»ºè„šæœ¬ã€éƒ¨ç½²å·¥å…·ã€æµ‹è¯•è„šæœ¬

### 7.4 å­¦ä¹ è·¯å¾„å»ºè®®


```markdown
ğŸ“š **ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç»“æ„**
1. æŒæ¡åŸºæœ¬çš„è„šæœ¬æ¡†æ¶
2. å­¦ä¼šå†™è§„èŒƒçš„å¤´éƒ¨ä¿¡æ¯
3. ç†è§£ç¯å¢ƒè®¾ç½®çš„ä½œç”¨

ğŸ“š **ç¬¬äºŒé˜¶æ®µï¼šåŠŸèƒ½å®ç°**  
1. å‡½æ•°è®¾è®¡ä¸å®ç°
2. å‚æ•°å¤„ç†å’Œæ ¡éªŒ
3. åŸºæœ¬çš„é”™è¯¯å¤„ç†

ğŸ“š **ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§**
1. å¤æ‚çš„é”™è¯¯å¤„ç†æœºåˆ¶
2. é…ç½®ç®¡ç†å’Œæ¨¡å—åŒ–
3. æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•æŠ€å·§
```

### 7.5 å¸¸è§é—®é¢˜é¿å…


```markdown
âŒ **å¸¸è§é”™è¯¯**
- æ²¡æœ‰Shebangè¡Œæˆ–ä½¿ç”¨é”™è¯¯çš„è§£é‡Šå™¨
- ç¼ºå°‘é”™è¯¯å¤„ç†ï¼Œè„šæœ¬å‡ºé”™æ—¶è¡¨ç°å¼‚å¸¸
- å˜é‡å‘½åä¸è§„èŒƒï¼Œä»£ç å¯è¯»æ€§å·®
- å‡½æ•°èŒè´£ä¸å•ä¸€ï¼Œéš¾ä»¥ç»´æŠ¤
- æ²¡æœ‰ä½¿ç”¨strict modeï¼Œéšè—æ½œåœ¨é—®é¢˜

âœ… **æœ€ä½³å®è·µ**
- å§‹ç»ˆä½¿ç”¨æ¨¡æ¿å¼€å§‹æ–°è„šæœ¬
- æ¯ä¸ªå‡½æ•°éƒ½æœ‰æ˜ç¡®çš„è¾“å…¥è¾“å‡º
- é‡è¦æ“ä½œå‰éƒ½è¦æ ¡éªŒæ¡ä»¶
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å
- é€‚å½“çš„æ³¨é‡Šè§£é‡Šå¤æ‚é€»è¾‘
```

**ğŸ§  æ ¸å¿ƒè®°å¿†**ï¼š
> Shellè„šæœ¬å¦‚å»ºç­‘ï¼Œç»“æ„è§„èŒƒæ˜¯åŸºç¡€
> å¤´éƒ¨ä¿¡æ¯åƒåç‰‡ï¼Œé”™è¯¯å¤„ç†ä¿å®‰å…¨  
> å‡½æ•°è®¾è®¡è®²å•ä¸€ï¼Œä»£ç ç»„ç»‡é‡æ¡ç†
> æ¨¡æ¿ä½¿ç”¨æ•ˆç‡é«˜ï¼Œæœ€ä½³å®è·µè¦éµå¾ª