---
title: 2ã€ç¯å¢ƒæ­å»ºé…ç½®
---
## ğŸ“š ç›®å½•

1. [ç‰ˆæœ¬å…¼å®¹è¯´æ˜](#1-ç‰ˆæœ¬å…¼å®¹è¯´æ˜)
2. [Mavené¡¹ç›®æ­å»º](#2-Mavené¡¹ç›®æ­å»º)
3. [Gradleé¡¹ç›®æ­å»º](#3-Gradleé¡¹ç›®æ­å»º)
4. [å¯åŠ¨ç±»é…ç½®](#4-å¯åŠ¨ç±»é…ç½®)
5. [åŸºç¡€é…ç½®æ–‡ä»¶](#5-åŸºç¡€é…ç½®æ–‡ä»¶)
6. [æœåŠ¡æ³¨å†Œä¸ç«¯å£](#6-æœåŠ¡æ³¨å†Œä¸ç«¯å£)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ ç‰ˆæœ¬å…¼å®¹è¯´æ˜


### 1.1 ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å…¼å®¹é—®é¢˜


**é€šä¿—ç†è§£**ï¼šå°±åƒæ‰‹æœºå’Œå……ç”µå™¨è¦é…å¥—ä¸€æ ·ï¼ŒSpring Cloud Gatewayå’ŒSpring Bootä¹Ÿéœ€è¦ç‰ˆæœ¬åŒ¹é…æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚

```
ç±»æ¯”è¯´æ˜ï¼š
æ‰‹æœºå……ç”µå™¨ â† æ¥å£è¦åŒ¹é… â†’ æ‰‹æœº
Spring Boot â† ç‰ˆæœ¬è¦é…å¥— â†’ Spring Cloud Gateway

ä¸åŒ¹é…ä¼šå‡ºç°ï¼š
âŒ å¯åŠ¨æŠ¥é”™
âŒ åŠŸèƒ½å¼‚å¸¸  
âŒ è«åå…¶å¦™çš„Bug
```

### 1.2 ç‰ˆæœ¬å¯¹åº”å…³ç³»


| Spring Bootç‰ˆæœ¬ | Spring Cloudç‰ˆæœ¬ | Gatewayç‰ˆæœ¬ | æ¨èç¨‹åº¦ |
|----------------|------------------|-------------|----------|
| 3.0.x ~ 3.2.x | 2022.0.x (Kilburn) | 4.0.x | â­â­â­ æœ€æ–°ç¨³å®š |
| 2.6.x ~ 2.7.x | 2021.0.x (Jubilee) | 3.1.x | â­â­â­ ä¸»æµä½¿ç”¨ |
| 2.4.x ~ 2.5.x | 2020.0.x (Ilford) | 3.0.x | â­â­ å¯ä»¥ç”¨ |

**ğŸ”‘ é€‰æ‹©å»ºè®®**ï¼š

```
ğŸŸ¢ æ–°é¡¹ç›® â†’ æ¨èSpring Boot 3.xç³»åˆ—
  - æ€§èƒ½æ›´å¥½
  - åŠŸèƒ½æ›´å…¨
  - æ”¯æŒæ›´ä¹…

ğŸŸ¡ è€é¡¹ç›® â†’ ä½¿ç”¨Spring Boot 2.7.x
  - ç¨³å®šå¯é 
  - èµ„æ–™æœ€å¤š
  - è¸©å‘æœ€å°‘
```

### 1.3 å¿«é€Ÿç¡®è®¤ç‰ˆæœ¬


**Step 1** ğŸ” æŸ¥çœ‹ä½ çš„Spring Bootç‰ˆæœ¬

åœ¨`pom.xml`æˆ–`build.gradle`ä¸­æ‰¾åˆ°ï¼š

```xml
<!-- pom.xmlä¸­æŸ¥çœ‹ -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.7.14</version>  â† è¿™ä¸ªå°±æ˜¯Spring Bootç‰ˆæœ¬
</parent>
```

**Step 2** ğŸ“‹ å¯¹ç…§ä¸Šè¡¨é€‰æ‹©å¯¹åº”çš„Gatewayç‰ˆæœ¬

**Step 3** âœ… éªŒè¯æ˜¯å¦åŒ¹é…

```bash
# å¯åŠ¨é¡¹ç›®ï¼Œçœ‹æ§åˆ¶å°è¾“å‡º
# æ­£å¸¸ä¼šæ˜¾ç¤ºï¼š
Started GatewayApplication in 3.2 seconds
```

---

## 2. ğŸ“¦ Mavené¡¹ç›®æ­å»º


### 2.1 Mavenæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šMavenå°±åƒä¸€ä¸ª"è‡ªåŠ¨ç®¡å®¶"ï¼Œå¸®ä½ ä¸‹è½½å’Œç®¡ç†é¡¹ç›®éœ€è¦çš„å„ç§å·¥å…·åŒ…ï¼ˆä¾èµ–ï¼‰ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ä½  â†’ æ‰‹åŠ¨ä¸‹è½½jaråŒ… â†’ æ”¾åˆ°é¡¹ç›® â†’ é…ç½®è·¯å¾„
âŒ éº»çƒ¦ã€å®¹æ˜“å‡ºé”™ã€ç‰ˆæœ¬æ··ä¹±

Mavenæ–¹å¼ï¼š  
ä½  â†’ å†™é…ç½® â†’ Mavenè‡ªåŠ¨ä¸‹è½½ â†’ è‡ªåŠ¨ç®¡ç†
âœ… ç®€å•ã€ä¸ä¼šå‡ºé”™ã€ç‰ˆæœ¬ç»Ÿä¸€
```

### 2.2 å®Œæ•´çš„pom.xmlé…ç½®


**ğŸ¯ é…ç½®è¯´æ˜**ï¼šä¸‹é¢çš„é…ç½®åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æœ‰è¯¦ç»†æ³¨é‡Š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    
    <!-- ========== ç¬¬ä¸€éƒ¨åˆ†ï¼šç»§æ‰¿Spring Bootçˆ¶é¡¹ç›® ========== -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.14</version>
    </parent>

    <!-- ========== ç¬¬äºŒéƒ¨åˆ†ï¼šé¡¹ç›®åŸºæœ¬ä¿¡æ¯ ========== -->
    <groupId>com.example</groupId>
    <artifactId>gateway-demo</artifactId>
    <version>1.0.0</version>
    <name>Gateway Demo</name>

    <!-- ========== ç¬¬ä¸‰éƒ¨åˆ†ï¼šç‰ˆæœ¬ç®¡ç† ========== -->
    <properties>
        <java.version>1.8</java.version>
        <spring-cloud.version>2021.0.8</spring-cloud.version>
    </properties>

    <!-- ========== ç¬¬å››éƒ¨åˆ†ï¼šä¾èµ–ç®¡ç†ï¼ˆé‡ç‚¹ï¼‰ ========== -->
    <dependencies>
        <!-- Gatewayæ ¸å¿ƒä¾èµ– - å¿…éœ€çš„ -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-gateway</artifactId>
        </dependency>

        <!-- NacosæœåŠ¡æ³¨å†Œ - å¦‚æœç”¨å¾®æœåŠ¡å°±åŠ  -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
            <version>2021.0.5.0</version>
        </dependency>

        <!-- è´Ÿè½½å‡è¡¡ - é…åˆæœåŠ¡å‘ç°ç”¨ -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-loadbalancer</artifactId>
        </dependency>
    </dependencies>

    <!-- ========== ç¬¬äº”éƒ¨åˆ†ï¼šSpring Cloudç‰ˆæœ¬ç®¡ç† ========== -->
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <!-- ========== ç¬¬å…­éƒ¨åˆ†ï¼šæ‰“åŒ…æ’ä»¶ ========== -->
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

### 2.3 ä¾èµ–è¯´æ˜å¯¹ç…§è¡¨


| ä¾èµ–åç§° | ä½œç”¨ | æ˜¯å¦å¿…éœ€ | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|---------|
| `spring-cloud-starter-gateway` | Gatewayæ ¸å¿ƒåŠŸèƒ½ | â­â­â­ å¿…éœ€ | æ‰€æœ‰åœºæ™¯ |
| `nacos-discovery` | æœåŠ¡æ³¨å†Œå‘ç° | â­â­ æ¨è | å¾®æœåŠ¡æ¶æ„ |
| `spring-cloud-loadbalancer` | è´Ÿè½½å‡è¡¡ | â­â­ æ¨è | å¤šå®ä¾‹åœºæ™¯ |

**ğŸ’¡ æ–°æ‰‹å»ºè®®**ï¼š
- ç¬¬ä¸€æ¬¡å­¦ä¹ ï¼šåªåŠ `spring-cloud-starter-gateway`å°±å¤Ÿäº†
- å­¦å¾®æœåŠ¡æ—¶ï¼šå†åŠ ä¸Š`nacos-discovery`å’Œ`loadbalancer`

---

## 3. ğŸ› ï¸ Gradleé¡¹ç›®æ­å»º


### 3.1 Gradleæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šGradleå’ŒMavenä½œç”¨ä¸€æ ·ï¼Œéƒ½æ˜¯"é¡¹ç›®ç®¡å®¶"ï¼Œä½†Gradleæ›´ç°ä»£ã€é…ç½®æ›´ç®€æ´ã€‚

```
Maven vs Gradleï¼š
Maven  â†’ é…ç½®ç”¨XML â†’ å•°å—¦ä½†ç¨³å®š â†’ è€é¡¹ç›®å¸¸ç”¨
Gradle â†’ é…ç½®ç”¨Groovy/Kotlin â†’ ç®€æ´çµæ´» â†’ æ–°é¡¹ç›®æ¨è
```

### 3.2 å®Œæ•´çš„build.gradleé…ç½®


```groovy
// ========== æ’ä»¶é…ç½® ==========
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.7.14'
    id 'io.spring.dependency-management' version '1.1.0'
}

// ========== é¡¹ç›®ä¿¡æ¯ ==========
group = 'com.example'
version = '1.0.0'
sourceCompatibility = '1.8'

// ========== ä»“åº“é…ç½® ==========
repositories {
    // é˜¿é‡Œäº‘é•œåƒ - å›½å†…ä¸‹è½½æ›´å¿«
    maven { url 'https://maven.aliyun.com/repository/public' }
    mavenCentral()
}

// ========== ç‰ˆæœ¬ç®¡ç† ==========
ext {
    set('springCloudVersion', "2021.0.8")
    set('alibabaCloudVersion', "2021.0.5.0")
}

// ========== ä¾èµ–é…ç½®ï¼ˆé‡ç‚¹ï¼‰ ==========
dependencies {
    // Gatewayæ ¸å¿ƒ
    implementation 'org.springframework.cloud:spring-cloud-starter-gateway'
    
    // NacosæœåŠ¡å‘ç°
    implementation "com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery:${alibabaCloudVersion}"
    
    // è´Ÿè½½å‡è¡¡
    implementation 'org.springframework.cloud:spring-cloud-starter-loadbalancer'
    
    // æµ‹è¯•ä¾èµ–
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

// ========== Spring Cloudç‰ˆæœ¬ç®¡ç† ==========
dependencyManagement {
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
    }
}
```

### 3.3 Gradleå‘½ä»¤å¿«é€Ÿå‚è€ƒ


```bash
# æ¸…ç†é¡¹ç›®
./gradlew clean

# ç¼–è¯‘é¡¹ç›®  
./gradlew build

# è¿è¡Œé¡¹ç›®
./gradlew bootRun

# æŸ¥çœ‹ä¾èµ–æ ‘
./gradlew dependencies
```

---

## 4. ğŸš€ å¯åŠ¨ç±»é…ç½®


### 4.1 å¯åŠ¨ç±»çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå¯åŠ¨ç±»å°±æ˜¯æ•´ä¸ªé¡¹ç›®çš„"æ€»å¼€å…³"ï¼Œç¨‹åºä»è¿™é‡Œå¼€å§‹è¿è¡Œã€‚

```
å¯åŠ¨ç±»çš„å·¥ä½œï¼š
ç¬¬1æ­¥ï¼šæ‰«æé…ç½®æ–‡ä»¶
  â†“
ç¬¬2æ­¥ï¼šåŠ è½½æ‰€æœ‰Beanï¼ˆç»„ä»¶ï¼‰
  â†“  
ç¬¬3æ­¥ï¼šå¯åŠ¨WebæœåŠ¡å™¨
  â†“
ç¬¬4æ­¥ï¼šç­‰å¾…æ¥æ”¶è¯·æ±‚
```

### 4.2 åŸºç¡€å¯åŠ¨ç±»


```java
package com.example.gateway;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * Gatewayç½‘å…³å¯åŠ¨ç±»
 * 
 * @SpringBootApplication è¿™ä¸ªæ³¨è§£åŒ…å«3ä¸ªåŠŸèƒ½ï¼š
 * 1. @Configuration - è¡¨ç¤ºè¿™æ˜¯é…ç½®ç±»
 * 2. @EnableAutoConfiguration - è‡ªåŠ¨é…ç½®Spring
 * 3. @ComponentScan - æ‰«æå½“å‰åŒ…åŠå­åŒ…çš„ç»„ä»¶
 */
@SpringBootApplication
public class GatewayApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
        System.out.println("ğŸš€ Gatewayç½‘å…³å¯åŠ¨æˆåŠŸï¼");
    }
}
```

### 4.3 å¸¦æœåŠ¡å‘ç°çš„å¯åŠ¨ç±»


**ä½¿ç”¨åœºæ™¯**ï¼šå½“ä½ çš„ç½‘å…³éœ€è¦ä»Nacosç­‰æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åˆ—è¡¨æ—¶ä½¿ç”¨

```java
package com.example.gateway;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient  // ğŸ‘ˆ å¯ç”¨æœåŠ¡å‘ç°åŠŸèƒ½
public class GatewayApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(GatewayApplication.class, args);
    }
}
```

**ğŸ”‘ æ³¨è§£è¯´æ˜å¯¹ç…§è¡¨**ï¼š

| æ³¨è§£ | ä½œç”¨ | ä½•æ—¶ä½¿ç”¨ |
|------|------|---------|
| `@SpringBootApplication` | Spring Bootå¯åŠ¨ | â­â­â­ å¿…åŠ  |
| `@EnableDiscoveryClient` | å¯ç”¨æœåŠ¡å‘ç° | ç”¨Nacosç­‰æ—¶åŠ  |

---

## 5. ğŸ“ åŸºç¡€é…ç½®æ–‡ä»¶


### 5.1 é…ç½®æ–‡ä»¶çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šé…ç½®æ–‡ä»¶å°±åƒä¸€å¼ "è®¾ç½®è¡¨"ï¼Œå‘Šè¯‰Gatewayæ€ä¹ˆå·¥ä½œã€‚

```
æ²¡æœ‰é…ç½®æ–‡ä»¶ï¼š
ç¨‹åºä¸çŸ¥é“ç›‘å¬å“ªä¸ªç«¯å£ âŒ
ç¨‹åºä¸çŸ¥é“è·¯ç”±åˆ°å“ªé‡Œ âŒ

æœ‰äº†é…ç½®æ–‡ä»¶ï¼š
ç«¯å£ï¼š8080 âœ…
è·¯ç”±è§„åˆ™ï¼šæ¸…æ¸…æ¥šæ¥š âœ…
```

### 5.2 application.ymlå®Œæ•´é…ç½®


**â­â­â­ é‡ç‚¹é…ç½®**ï¼šä¸‹é¢æ¯ä¸€é¡¹éƒ½æœ‰è¯¦ç»†è¯´æ˜

```yaml
# ========== æœåŠ¡åŸºæœ¬ä¿¡æ¯ ==========
server:
  port: 8080  # Gatewayç›‘å¬çš„ç«¯å£å·

spring:
  application:
    name: api-gateway  # æœåŠ¡åç§°ï¼Œæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒç”¨

  # ========== Gatewayè·¯ç”±é…ç½® ==========
  cloud:
    gateway:
      routes:  # è·¯ç”±è§„åˆ™æ•°ç»„
        - id: user-service  # è·¯ç”±çš„å”¯ä¸€æ ‡è¯†
          uri: http://localhost:8081  # ç›®æ ‡æœåŠ¡åœ°å€
          predicates:  # åŒ¹é…è§„åˆ™
            - Path=/user/**  # è¯·æ±‚è·¯å¾„åŒ¹é…

        - id: order-service
          uri: http://localhost:8082
          predicates:
            - Path=/order/**

# ========== æ—¥å¿—é…ç½® ==========
logging:
  level:
    org.springframework.cloud.gateway: DEBUG  # Gatewayæ—¥å¿—çº§åˆ«
```

### 5.3 é…ç½®è¯¦è§£


**ğŸ” è·¯ç”±é…ç½®ç»“æ„å›¾**ï¼š

```
routes: (è·¯ç”±è§„åˆ™åˆ—è¡¨)
  â”œâ”€â”€ id: user-service        â† ç»™è¿™ä¸ªè·¯ç”±èµ·ä¸ªåå­—
  â”œâ”€â”€ uri: http://localhost:8081  â† è½¬å‘åˆ°å“ªé‡Œ
  â””â”€â”€ predicates:             â† ä»€ä¹ˆè¯·æ±‚ä¼šåŒ¹é…
      â””â”€â”€ Path=/user/**       â† è·¯å¾„åŒ¹é…è§„åˆ™

è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚: http://localhost:8080/user/login
    â†“ (åŒ¹é…Path=/user/**)
è½¬å‘åˆ°: http://localhost:8081/user/login
```

**ğŸ’¡ æ–°æ‰‹å¸¸è§é—®é¢˜**ï¼š

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ³• |
|------|------|---------|
| 404æ‰¾ä¸åˆ°æœåŠ¡ | Pathè·¯å¾„å†™é”™äº† | æ£€æŸ¥`Path`æ˜¯å¦å’Œå®é™…è¯·æ±‚åŒ¹é… |
| å¯åŠ¨æŠ¥é”™ | YAMLæ ¼å¼é”™è¯¯ | æ£€æŸ¥ç¼©è¿›ï¼ˆå¿…é¡»ç”¨ç©ºæ ¼ï¼Œä¸èƒ½ç”¨Tabï¼‰ |
| è½¬å‘å¤±è´¥ | uriåœ°å€é”™è¯¯ | ç¡®è®¤ç›®æ ‡æœåŠ¡æ˜¯å¦å¯åŠ¨ |

### 5.4 propertiesæ ¼å¼é…ç½®


**åœºæ™¯è¯´æ˜**ï¼šæœ‰äº›é¡¹ç›®ç”¨`.properties`æ ¼å¼ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„

```properties
# æœåŠ¡ç«¯å£
server.port=8080

# æœåŠ¡åç§°
spring.application.name=api-gateway

# è·¯ç”±é…ç½®ï¼ˆå†™æ³•ä¸åŒï¼Œæ•ˆæœä¸€æ ·ï¼‰
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=http://localhost:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/user/**

spring.cloud.gateway.routes[1].id=order-service
spring.cloud.gateway.routes[1].uri=http://localhost:8082
spring.cloud.gateway.routes[1].predicates[0]=Path=/order/**
```

**ğŸ”‘ æ ¼å¼é€‰æ‹©å»ºè®®**ï¼š
- æ¨èç”¨YAMLï¼šå±‚æ¬¡æ¸…æ™°ï¼Œæ˜“è¯»æ˜“å†™
- Propertiesé€‚åˆï¼šé…ç½®é¡¹å°‘çš„ç®€å•åœºæ™¯

---

## 6. ğŸ”Œ æœåŠ¡æ³¨å†Œä¸ç«¯å£


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡æ³¨å†Œ


**ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š

```
æ²¡æœ‰æœåŠ¡æ³¨å†Œï¼š
ä½ è¦æ‰¾äºº â†’ è®°ä½ä»–çš„æ‰‹æœºå· â†’ å·ç å˜äº†å°±æ‰¾ä¸åˆ°äº†
Gateway â†’ è®°ä½æœåŠ¡åœ°å€ â†’ åœ°å€å˜äº†å°±å¤±æ•ˆäº†

æœ‰äº†æœåŠ¡æ³¨å†Œï¼š  
ä½ è¦æ‰¾äºº â†’ æŸ¥é€šè®¯å½• â†’ å·ç å˜äº†é€šè®¯å½•è‡ªåŠ¨æ›´æ–°
Gateway â†’ æŸ¥æ³¨å†Œä¸­å¿ƒ â†’ åœ°å€å˜äº†è‡ªåŠ¨å‘ç°
```

### 6.2 Nacosæ³¨å†Œé…ç½®


**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š

```yaml
server:
  port: 8080

spring:
  application:
    name: api-gateway
    
  # ========== Nacosé…ç½® ==========
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848  # Nacosåœ°å€
        namespace: public  # å‘½åç©ºé—´
        group: DEFAULT_GROUP  # åˆ†ç»„
        
    # ========== GatewayåŠ¨æ€è·¯ç”± ==========    
    gateway:
      discovery:
        locator:
          enabled: true  # å¯ç”¨æœåŠ¡å‘ç°è·¯ç”±
          lower-case-service-id: true  # æœåŠ¡åè½¬å°å†™
      
      routes:
        - id: user-service
          uri: lb://user-service  # lbè¡¨ç¤ºè´Ÿè½½å‡è¡¡
          predicates:
            - Path=/user/**
```

**ğŸ”‘ é…ç½®è¯´æ˜**ï¼š

```
uri: lb://user-service çš„å«ä¹‰ï¼š
  â†“
lb:// â†’ LoadBalancerçš„ç¼©å†™ï¼Œè¡¨ç¤ºè´Ÿè½½å‡è¡¡
  â†“  
user-service â†’ æœåŠ¡åç§°ï¼Œä»Nacosè·å–å®é™…åœ°å€
  â†“
æœ€ç»ˆæ•ˆæœ â†’ Gatewayè‡ªåŠ¨ä»NacosæŸ¥è¯¢user-serviceçš„æ‰€æœ‰å®ä¾‹
         â†’ è‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ†å‘è¯·æ±‚
```

### 6.3 ç«¯å£è§„åˆ’å»ºè®®


**ğŸ¯ ç«¯å£åˆ†é…åŸåˆ™**ï¼š

| æœåŠ¡ç±»å‹ | æ¨èç«¯å£èŒƒå›´ | ç¤ºä¾‹ |
|---------|-------------|------|
| Gatewayç½‘å…³ | 8000-8099 | 8080 |
| ç”¨æˆ·æœåŠ¡ | 8100-8199 | 8101 |
| è®¢å•æœåŠ¡ | 8200-8299 | 8201 |
| å•†å“æœåŠ¡ | 8300-8399 | 8301 |

**ğŸ’¡ ç«¯å£å†²çªè§£å†³**ï¼š

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨ï¼ˆWindowsï¼‰
netstat -ano | findstr "8080"

# æŸ¥çœ‹ç«¯å£å ç”¨ï¼ˆLinux/Macï¼‰
lsof -i:8080

# ä¿®æ”¹é…ç½®æ–‡ä»¶ç«¯å£
server:
  port: 8081  # æ¢ä¸ªç«¯å£
```

### 6.4 å¯åŠ¨éªŒè¯æµç¨‹


**Step 1** ğŸ” å¯åŠ¨Nacosï¼ˆå¦‚æœç”¨æœåŠ¡å‘ç°ï¼‰

```bash
# è¿›å…¥Nacosç›®å½•
cd nacos/bin

# Windowså¯åŠ¨
startup.cmd -m standalone

# Linux/Macå¯åŠ¨  
sh startup.sh -m standalone
```

**Step 2** ğŸš€ å¯åŠ¨Gateway

```bash
# Mavenæ–¹å¼
mvn spring-boot:run

# Gradleæ–¹å¼
./gradlew bootRun

# æˆ–ç›´æ¥è¿è¡Œå¯åŠ¨ç±»
```

**Step 3** âœ… éªŒè¯æ˜¯å¦æˆåŠŸ

```
æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹ï¼š
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::               (v2.7.14)

Started GatewayApplication in 3.245 seconds âœ…
```

**Step 4** ğŸŒ æµè§ˆå™¨è®¿é—®æµ‹è¯•

```
è®¿é—®ï¼šhttp://localhost:8080
çœ‹åˆ°é”™è¯¯é¡µé¢æ˜¯æ­£å¸¸çš„ï¼ˆå› ä¸ºè¿˜æ²¡é…ç½®å…·ä½“è·¯ç”±ï¼‰

è®¿é—®æ³¨å†Œä¸­å¿ƒæŸ¥çœ‹ï¼š
Nacosæ§åˆ¶å°ï¼šhttp://localhost:8848/nacos
çœ‹åˆ°api-gatewayæœåŠ¡ â†’ æ³¨å†ŒæˆåŠŸ âœ…
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹


```
âœ… ç‰ˆæœ¬å…¼å®¹å…³ç³»
  - Spring Bootå’ŒSpring Cloudè¦é…å¥—
  - æŸ¥è¡¨é€‰æ‹©æ­£ç¡®çš„ç‰ˆæœ¬ç»„åˆ

âœ… ä¾èµ–é…ç½®
  - Gatewayæ ¸å¿ƒä¾èµ–æ˜¯å¿…éœ€çš„
  - æœåŠ¡å‘ç°ä¾èµ–çœ‹é¡¹ç›®éœ€è¦

âœ… å¯åŠ¨ç±»é…ç½®  
  - @SpringBootApplicationå¿…åŠ 
  - ç”¨æœåŠ¡å‘ç°åŠ @EnableDiscoveryClient

âœ… åŸºç¡€é…ç½®
  - ç«¯å£é…ç½®server.port
  - è·¯ç”±é…ç½®routes
  - æœåŠ¡æ³¨å†Œé…ç½®ï¼ˆå¦‚æœç”¨ï¼‰
```

### 7.2 é…ç½®æ£€æŸ¥æ¸…å•


**ğŸ” å¯åŠ¨å‰è‡ªæŸ¥**ï¼š

- [ ] ç‰ˆæœ¬æ˜¯å¦åŒ¹é…
- [ ] ä¾èµ–æ˜¯å¦æ·»åŠ å®Œæ•´
- [ ] å¯åŠ¨ç±»æ³¨è§£æ˜¯å¦æ­£ç¡®
- [ ] é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆYAMLç¼©è¿›ï¼‰
- [ ] ç«¯å£æ˜¯å¦è¢«å ç”¨
- [ ] Nacosæ˜¯å¦å¯åŠ¨ï¼ˆå¦‚æœç”¨ï¼‰

### 7.3 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| å¯åŠ¨æŠ¥é”™ | ç‰ˆæœ¬ä¸å…¼å®¹ | æ£€æŸ¥ç‰ˆæœ¬å¯¹åº”å…³ç³» |
| 404é”™è¯¯ | è·¯ç”±é…ç½®é”™è¯¯ | æ£€æŸ¥Pathè·¯å¾„é…ç½® |
| æ³¨å†Œå¤±è´¥ | Nacosæœªå¯åŠ¨ | å…ˆå¯åŠ¨Nacos |
| ç«¯å£å†²çª | ç«¯å£è¢«å ç”¨ | æ¢ä¸ªç«¯å£æˆ–å…³é—­å ç”¨è¿›ç¨‹ |

### 7.4 å­¦ä¹ å»ºè®®


**ğŸ¯ å­¦ä¹ è·¯å¾„**ï¼š

```
ç¬¬1å¤©ï¼šç‰ˆæœ¬é€‰æ‹© + Maven/Gradleé…ç½®
  â†“
ç¬¬2å¤©ï¼šå¯åŠ¨ç±» + åŸºç¡€é…ç½®æ–‡ä»¶
  â†“  
ç¬¬3å¤©ï¼šæœåŠ¡æ³¨å†Œ + åŠ¨æ€è·¯ç”±
  â†“
ç¬¬4å¤©ï¼šå®æˆ˜æ¼”ç»ƒ + é—®é¢˜æ’æŸ¥
```

**ğŸ’¡ å®è·µå»ºè®®**ï¼š
- å…ˆæŠŠæœ€åŸºç¡€çš„é…ç½®è·‘é€š
- å†ä¸€æ­¥æ­¥åŠ åŠŸèƒ½
- æ¯åŠ ä¸€ä¸ªåŠŸèƒ½å°±æµ‹è¯•ä¸€æ¬¡
- é‡åˆ°é—®é¢˜çœ‹æ—¥å¿—ï¼Œçœ‹é…ç½®

**ğŸ”— åç»­å­¦ä¹ æ–¹å‘**ï¼š
- è·¯ç”±è§„åˆ™è¯¦è§£ï¼ˆPredicateï¼‰
- è¿‡æ»¤å™¨ä½¿ç”¨ï¼ˆFilterï¼‰
- é™æµç†”æ–­é…ç½®
- å®‰å…¨è®¤è¯é›†æˆ

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç‰ˆæœ¬é…å¥—ç¬¬ä¸€æ¡ï¼Œä¾èµ–é…ç½®ä¸èƒ½å°‘
å¯åŠ¨æ³¨è§£è¦å†™å¯¹ï¼Œé…ç½®æ ¼å¼è«å‡ºé”™  
ç«¯å£è§„åˆ’è¦åˆç†ï¼ŒæœåŠ¡æ³¨å†ŒæŸ¥æ¸…æ¥š
é‡åˆ°é—®é¢˜çœ‹æ—¥å¿—ï¼Œä¸€æ­¥ä¸€æ­¥æ¥æ’æŸ¥
```