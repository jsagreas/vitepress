---
title: 1、静态路由配置
---
## 📚 目录

1. [静态路由配置基础](#1-静态路由配置基础)
2. [YAML配置方式详解](#2-YAML配置方式详解)
3. [路由核心要素](#3-路由核心要素)
4. [多路由配置管理](#4-多路由配置管理)
5. [配置优先级规则](#5-配置优先级规则)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 🎯 静态路由配置基础


### 1.1 什么是路由配置


**通俗理解**：路由就像高速公路的指示牌

```
生活场景类比：
你在高速上看到指示牌 → "北京方向，走左侧"
API网关的路由配置 → "用户服务请求，转发到 user-service"

指示牌的作用：告诉你往哪走
路由配置的作用：告诉网关请求该转发到哪个服务
```

**🔸 核心概念**
- **路由**：一条"转发规则"，告诉网关如何处理请求
- **静态配置**：写在配置文件里的固定规则（重启后生效）
- **动态配置**：运行时可修改的规则（后面章节会讲）

### 1.2 为什么需要路由配置


**解决的核心问题**：
```
没有路由配置的情况：
客户端 → 不知道用户服务在哪 → 直接调用失败 ❌

有了路由配置：
客户端 → 发请求到网关 → 网关查路由规则 → 转发到正确服务 ✅
```

**🎯 实际价值**
- **统一入口**：客户端只需要知道网关地址
- **服务解耦**：后端服务位置变了，只改网关配置
- **灵活路由**：可以根据路径、参数等条件智能转发

---

## 2. 📝 YAML配置方式详解


### 2.1 YAML基础认知


**什么是YAML**？
- 一种配置文件格式，比JSON更易读
- 通过缩进表示层级关系（必须用空格，不能用Tab）
- 常用于Spring Boot配置

**🔸 基本语法对照**
```
层级关系：
父级:
  子级: 值
  
列表表示：
列表名:
  - 元素1
  - 元素2
  
键值对：
键名: 值
```

### 2.2 Spring Cloud Gateway配置结构


**配置文件位置**：`application.yml` 或 `application.properties`

**完整结构示意**：
```
application.yml
├── spring
│   └── cloud
│       └── gateway
│           ├── routes (路由列表)
│           │   ├── 路由1配置
│           │   ├── 路由2配置
│           │   └── ...
│           └── 其他网关配置
```

### 2.3 第一个路由配置示例


```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-route                    # 路由唯一标识
          uri: http://localhost:8081        # 目标服务地址
          predicates:
            - Path=/user/**                 # 路径匹配规则
```

**配置解读**：
- `id: user-route`：这条路由的名字（类似给规则起个ID）
- `uri: http://localhost:8081`：请求最终要转发到哪里
- `predicates`：判断条件（什么样的请求走这条路由）
- `Path=/user/**`：所有以`/user/`开头的请求都匹配

**工作流程图示**：
```
请求流程：
客户端请求: http://网关地址/user/login
           ↓
      [网关接收请求]
           ↓
      [检查路由规则]
           ↓
   匹配到 user-route (因为路径是/user/*)
           ↓
      [转发到目标服务]
           ↓
实际请求: http://localhost:8081/user/login
```

---

## 3. 🔧 路由核心要素


### 3.1 路由ID唯一标识


**🔸 作用与特点**

| 特性 | 说明 | 示例 |
|------|------|------|
| **唯一性** | 整个网关中不能重复 | `user-route`、`order-route` |
| **可读性** | 建议使用有意义的名称 | ✅ `user-service-route`<br>❌ `route1` |
| **引用性** | 日志、监控会用到这个ID | 便于问题排查 |

**命名建议**：
```
✅ 推荐命名方式：
- user-service-route      (服务名+route)
- api-user-v1            (API+服务+版本)
- backend-user-service   (分类+服务)

❌ 不推荐的命名：
- r1, r2, r3             (无意义)
- route                  (太泛化)
- aaa, test              (不规范)
```

### 3.2 目标URI地址配置


**🔸 URI是什么**？
- **URI** = Uniform Resource Identifier（统一资源标识符）
- 简单理解：就是"服务的网络地址"

**支持的URI格式**：

```yaml
# 方式1: HTTP直连地址
uri: http://localhost:8081

# 方式2: HTTPS安全连接
uri: https://api.example.com

# 方式3: 负载均衡地址（从注册中心获取）
uri: lb://user-service
```

**负载均衡配置详解**：
```
uri: lb://user-service
 ↓    ↓        ↓
协议  标识   服务名(在注册中心的名称)

lb = LoadBalance（负载均衡）
网关会自动从Nacos/Eureka等注册中心查找user-service的所有实例
然后轮流分配请求（默认轮询策略）
```

**对比说明**：
```
固定地址 vs 负载均衡：

http://localhost:8081
  优点：简单直接
  缺点：服务IP变了要改配置，无法负载均衡
  
lb://user-service  
  优点：自动发现服务，自动负载均衡
  缺点：需要注册中心支持
```

### 3.3 路径匹配规则


**🔸 Path断言（Predicate）**

Path断言就是"路径匹配条件"，决定什么样的请求走这条路由。

**通配符说明**：

| 符号 | 含义 | 示例 | 匹配说明 |
|------|------|------|----------|
| `*` | 匹配单层路径 | `/user/*` | 匹配`/user/list`<br>不匹配`/user/info/detail` |
| `**` | 匹配多层路径 | `/user/**` | 匹配`/user/list`<br>也匹配`/user/info/detail` |
| `?` | 匹配单个字符 | `/user/?` | 匹配`/user/1`<br>不匹配`/user/10` |

**实际示例对比**：
```yaml
# 示例1: 精确匹配
predicates:
  - Path=/user/login        # 只匹配 /user/login

# 示例2: 单层通配
predicates:
  - Path=/user/*           # 匹配 /user/login, /user/list
                          # 不匹配 /user/info/detail

# 示例3: 多层通配（最常用）
predicates:
  - Path=/user/**          # 匹配所有 /user/ 开头的路径

# 示例4: 多个路径
predicates:
  - Path=/user/**,/member/**   # 同时匹配两种路径
```

**匹配过程图示**：
```
请求: /user/info/detail
               ↓
    [网关开始匹配路由规则]
               ↓
规则1: Path=/order/**  → 不匹配 ❌
规则2: Path=/user/*    → 不匹配 ❌ (只能匹配单层)
规则3: Path=/user/**   → 匹配成功 ✅
               ↓
         [使用规则3转发]
```

### 3.4 完整配置示例


```yaml
spring:
  cloud:
    gateway:
      routes:
        # 用户服务路由
        - id: user-service-route
          uri: lb://user-service
          predicates:
            - Path=/api/user/**
          
        # 订单服务路由  
        - id: order-service-route
          uri: lb://order-service
          predicates:
            - Path=/api/order/**
```

**配置说明**：
- 所有`/api/user/`开头的请求 → 转发到用户服务
- 所有`/api/order/`开头的请求 → 转发到订单服务
- 使用负载均衡自动发现服务实例

---

## 4. 🔀 多路由配置管理


### 4.1 多路由配置方式


**场景说明**：实际项目中往往有多个微服务，需要配置多条路由

**配置结构**：
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: 路由1
          # ... 路由1配置
          
        - id: 路由2
          # ... 路由2配置
          
        - id: 路由3
          # ... 路由3配置
```

### 4.2 完整微服务路由示例


```yaml
spring:
  cloud:
    gateway:
      routes:
        # 1. 用户服务路由
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/user/**
        
        # 2. 订单服务路由    
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/order/**
        
        # 3. 商品服务路由
        - id: product-service
          uri: lb://product-service
          predicates:
            - Path=/product/**
        
        # 4. 支付服务路由
        - id: payment-service
          uri: lb://payment-service
          predicates:
            - Path=/payment/**
```

**路由分发示意图**：
```
                    [API网关]
                        |
         +--------------+--------------+--------------+
         |              |              |              |
    /user/**      /order/**     /product/**     /payment/**
         |              |              |              |
         ↓              ↓              ↓              ↓
    用户服务        订单服务        商品服务        支付服务
   (user-service) (order-service) (product-service) (payment-service)
```

### 4.3 路由组织最佳实践


**🔸 按功能模块分组**

```yaml
spring:
  cloud:
    gateway:
      routes:
        # ========== 核心业务服务 ==========
        - id: user-route
          uri: lb://user-service
          predicates:
            - Path=/api/user/**
            
        - id: order-route
          uri: lb://order-service
          predicates:
            - Path=/api/order/**
        
        # ========== 基础服务 ==========
        - id: auth-route
          uri: lb://auth-service
          predicates:
            - Path=/api/auth/**
        
        # ========== 第三方服务 ==========
        - id: payment-route
          uri: lb://payment-service
          predicates:
            - Path=/api/payment/**
```

**命名规范建议**：

| 类型 | 命名格式 | 示例 |
|------|----------|------|
| **服务路由** | `服务名-route` | `user-route`、`order-route` |
| **版本路由** | `服务名-v版本号` | `user-v1`、`order-v2` |
| **环境路由** | `环境-服务名` | `test-user`、`prod-order` |

---

## 5. ⚖️ 配置优先级规则


### 5.1 匹配优先级机制


**🔸 核心原则**：从上到下匹配，找到第一个符合条件的路由就使用

```yaml
routes:
  - id: route1
    predicates:
      - Path=/user/**        # 规则A：匹配所有/user/开头
  
  - id: route2  
    predicates:
      - Path=/user/login     # 规则B：只匹配/user/login
```

**匹配过程**：
```
请求: /user/login
        ↓
检查route1: /user/** → 匹配成功 ✅
        ↓
直接使用route1，不再检查route2

结论：route2永远不会被使用！
```

### 5.2 优先级配置策略


**❌ 错误配置**：
```yaml
routes:
  # 错误：宽泛规则在前
  - id: user-all
    uri: lb://user-service-v1
    predicates:
      - Path=/user/**
  
  # 这条规则永远不会被匹配！    
  - id: user-login
    uri: lb://user-service-v2
    predicates:
      - Path=/user/login
```

**✅ 正确配置**：
```yaml
routes:
  # 正确：具体规则在前
  - id: user-login
    uri: lb://user-service-v2
    predicates:
      - Path=/user/login      # 先匹配具体路径
  
  - id: user-all
    uri: lb://user-service-v1
    predicates:
      - Path=/user/**         # 再匹配通配路径
```

### 5.3 优先级规则总结


**匹配顺序原则**：

```
优先级排序（从高到低）：
1. 精确路径     > 通配符路径
2. 路径层级多   > 路径层级少  
3. 配置在前     > 配置在后

示例排序：
/user/login           (优先级最高)
  ↓
/user/*               (次之)
  ↓
/user/**              (最后)
```

**实战配置模板**：
```yaml
routes:
  # 第一优先级：特殊接口
  - id: user-special-api
    predicates:
      - Path=/user/admin/login
  
  # 第二优先级：单层通配
  - id: user-single-level
    predicates:
      - Path=/user/*/info
  
  # 第三优先级：多层通配  
  - id: user-all
    predicates:
      - Path=/user/**
```

### 5.4 常见优先级问题


**问题1：路由不生效**
```yaml
# 问题代码
routes:
  - id: catch-all
    predicates:
      - Path=/**           # 这会拦截所有请求！
  
  - id: user-route         # 永远不会被执行
    predicates:
      - Path=/user/**

# 解决方案：将通用规则放到最后
routes:
  - id: user-route
    predicates:
      - Path=/user/**
  
  - id: catch-all         # 放到最后
    predicates:
      - Path=/**
```

**问题2：版本路由冲突**
```yaml
# 问题：想要区分v1和v2版本
routes:
  - id: user-v1
    uri: lb://user-service-v1
    predicates:
      - Path=/user/**      # 会拦截所有user请求
  
  - id: user-v2            # 永远不会执行
    uri: lb://user-service-v2
    predicates:
      - Path=/user/v2/**

# 正确做法：
routes:
  - id: user-v2           # v2在前
    uri: lb://user-service-v2
    predicates:
      - Path=/user/v2/**
  
  - id: user-v1           # v1在后（或作为默认）
    uri: lb://user-service-v1
    predicates:
      - Path=/user/**
```

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的核心概念


```
🔸 路由配置本质：告诉网关"什么请求该转发到哪里"
🔸 YAML配置方式：通过缩进表示层级，使用列表配置多个路由
🔸 路由三要素：ID（标识）+ URI（目标地址）+ Predicates（匹配条件）
🔸 路径匹配规则：*（单层）、**（多层）、精确路径
🔸 优先级原则：从上到下匹配，具体规则优先于通配规则
```

### 6.2 配置关键要点


**🔹 路由ID命名**
- 必须唯一，建议有意义
- 格式：`服务名-route` 或 `功能-版本`

**🔹 URI配置选择**
```
开发环境：http://localhost:端口
生产环境：lb://服务名（推荐）
```

**🔹 路径匹配技巧**
```
精确匹配：Path=/user/login
单层通配：Path=/user/*
多层通配：Path=/user/**（最常用）
多路径：Path=/user/**,/member/**
```

**🔹 优先级配置**
```
原则：具体 > 通配，靠前 > 靠后
实践：特殊接口写在前面，通用规则放后面
```

### 6.3 实战配置模板


**标准微服务路由配置**：
```yaml
spring:
  cloud:
    gateway:
      routes:
        # 用户服务
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/user/**
        
        # 订单服务  
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/api/order/**
        
        # 通用降级路由（放最后）
        - id: fallback
          uri: lb://fallback-service
          predicates:
            - Path=/**
```

### 6.4 常见问题速查


| 问题 | 原因 | 解决方案 |
|------|------|----------|
| **路由不生效** | 匹配规则被前面的路由拦截 | 调整路由顺序，具体规则放前面 |
| **404错误** | 路径匹配不正确 | 检查Path配置，注意`*`和`**`区别 |
| **服务找不到** | URI配置错误或服务未注册 | 确认服务名和注册中心配置 |
| **重复路由ID** | ID不唯一 | 使用唯一的路由ID |

### 6.5 学习建议


**新手学习路径**：
```
第1步：理解路由基本概念（本章内容）
  ↓
第2步：掌握YAML配置语法
  ↓  
第3步：练习Path路径匹配
  ↓
第4步：理解优先级机制
  ↓
第5步：实战项目配置
```

**核心记忆口诀**：
```
路由配置三要素，ID标识不能少
URI地址指目标，LB负载更可靠  
Path匹配定规则，两星通配最常用
配置顺序要注意，具体规则放前头
```

**下一步学习方向**：
- 动态路由配置（运行时修改）
- 路由断言（更复杂的匹配条件）
- 路由过滤器（请求/响应处理）
- 路由监控与调试