---
title: 1ã€ç†”æ–­é™çº§æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [ç†”æ–­é™çº§åŸºæœ¬æ¦‚å¿µ](#1-ç†”æ–­é™çº§åŸºæœ¬æ¦‚å¿µ)
2. [CircuitBreakerç†”æ–­å™¨åŸç†](#2-CircuitBreakerç†”æ–­å™¨åŸç†)
3. [Resilience4jé›†æˆé…ç½®](#3-Resilience4jé›†æˆé…ç½®)
4. [ç†”æ–­çŠ¶æ€è½¬æ¢æœºåˆ¶](#4-ç†”æ–­çŠ¶æ€è½¬æ¢æœºåˆ¶)
5. [ç†”æ–­æŒ‡æ ‡é…ç½®è¯¦è§£](#5-ç†”æ–­æŒ‡æ ‡é…ç½®è¯¦è§£)
6. [é™çº§å¤„ç†ç­–ç•¥](#6-é™çº§å¤„ç†ç­–ç•¥)
7. [ç†”æ–­æ¢å¤æœºåˆ¶](#7-ç†”æ–­æ¢å¤æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ ç†”æ–­é™çº§åŸºæœ¬æ¦‚å¿µ


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç†”æ–­é™çº§


**ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š
```
æƒ³è±¡ä½ å®¶çš„ç”µè·¯ä¿é™©ä¸ï¼š
- ç”µå™¨çŸ­è·¯æ—¶ï¼Œä¿é™©ä¸è‡ªåŠ¨æ–­å¼€ â†’ ä¿æŠ¤æ•´ä¸ªå®¶åº­ç”µè·¯
- é—®é¢˜è§£å†³åï¼Œæ›´æ¢ä¿é™©ä¸æ¢å¤ä¾›ç”µ â†’ æ¢å¤æ­£å¸¸

å¾®æœåŠ¡ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼
```

**å¾®æœåŠ¡ä¸­çš„é—®é¢˜**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘å…³ â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡
                              â†“
                          å“åº”è¶…æ—¶/å‡ºé”™
```

> ğŸ’¡ **æ ¸å¿ƒé—®é¢˜**
> 
> å¦‚æœåº“å­˜æœåŠ¡å‡ºç°æ•…éšœï¼Œä¼šå¯¼è‡´ï¼š
> - è®¢å•æœåŠ¡ç­‰å¾…è¶…æ—¶ï¼Œèµ„æºè¢«å ç”¨
> - è¯·æ±‚å †ç§¯ï¼Œæ•´ä¸ªç³»ç»Ÿå˜æ…¢
> - æœ€ç»ˆå¯¼è‡´é›ªå´©æ•ˆåº”ï¼Œæ‰€æœ‰æœåŠ¡éƒ½ç˜«ç—ª

### 1.2 ä»€ä¹ˆæ˜¯ç†”æ–­


**é€šä¿—è§£é‡Š**ï¼š
- **ç†”æ–­**å°±åƒç”µè·¯ä¿æŠ¤å¼€å…³ï¼Œå½“æ£€æµ‹åˆ°æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨"åˆ‡æ–­"å¯¹è¯¥æœåŠ¡çš„è°ƒç”¨
- ä¸å†å‚»å‚»ç­‰å¾…ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªå¤‡ç”¨ç»“æœï¼ˆé™çº§å“åº”ï¼‰
- é¿å…æ•…éšœæ‰©æ•£ï¼Œä¿æŠ¤æ•´ä¸ªç³»ç»Ÿ

### 1.3 ä»€ä¹ˆæ˜¯é™çº§


**é™çº§çš„å«ä¹‰**ï¼š
- å½“æœåŠ¡æ— æ³•æ­£å¸¸æä¾›åŠŸèƒ½æ—¶ï¼Œæä¾›ä¸€ä¸ª**é€€åŒ–ç‰ˆæœ¬**çš„åŠŸèƒ½
- ä¿è¯æ ¸å¿ƒæµç¨‹èƒ½èµ°é€šï¼Œç”¨æˆ·ä½“éªŒä¸è‡³äºå¤ªå·®

**é™çº§ç¤ºä¾‹å¯¹æ¯”**ï¼š

| åœºæ™¯ | æ­£å¸¸å“åº” | é™çº§å“åº” |
|------|---------|---------|
| ğŸ›’ **å•†å“è¯¦æƒ…** | å®Œæ•´çš„å•†å“ä¿¡æ¯+åº“å­˜+è¯„ä»· | åªæ˜¾ç¤ºåŸºç¡€ä¿¡æ¯ï¼Œåº“å­˜æ˜¾ç¤º"æš‚æ—¶æ— æ³•è·å–" |
| ğŸ’° **ä¼˜æƒ åˆ¸æŸ¥è¯¢** | å®æ—¶ä¼˜æƒ åˆ¸åˆ—è¡¨ | æç¤º"ä¼˜æƒ åˆ¸æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åæŸ¥çœ‹" |
| ğŸ” **æœç´¢æ¨è** | ä¸ªæ€§åŒ–æ¨èåˆ—è¡¨ | è¿”å›çƒ­é—¨å•†å“åˆ—è¡¨ |

---

## 2. âš¡ CircuitBreakerç†”æ–­å™¨åŸç†


### 2.1 ç†”æ–­å™¨æ˜¯ä»€ä¹ˆ


**æ ¸å¿ƒç»„ä»¶**ï¼š
```
CircuitBreaker = ç”µè·¯æ–­è·¯å™¨
ä½œç”¨ï¼šç›‘æ§æœåŠ¡è°ƒç”¨æƒ…å†µï¼Œè‡ªåŠ¨åˆ‡æ–­æ•…éšœæœåŠ¡
```

**å·¥ä½œæœºåˆ¶å›¾ç¤º**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
å®¢æˆ·ç«¯ â†’ [ç†”æ–­å™¨:å…³é—­] â†’ åç«¯æœåŠ¡ â†’ è¿”å›ç»“æœ

æ•…éšœè§¦å‘ï¼š
å®¢æˆ·ç«¯ â†’ [ç†”æ–­å™¨:å¼€å¯] Ã—â†’ åç«¯æœåŠ¡
          â†“
        é™çº§å¤„ç†
          â†“
        è¿”å›é»˜è®¤å€¼
```

### 2.2 ç†”æ–­å™¨çš„ä¸‰ç§çŠ¶æ€


**çŠ¶æ€è½¬æ¢æµç¨‹**ï¼š
```
åˆå§‹çŠ¶æ€
   â†“
[å…³é—­ CLOSED]
   â†“ (å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼)
[å¼€å¯ OPEN]
   â†“ (ç­‰å¾…æ—¶é—´å)
[åŠå¼€ HALF_OPEN]
   â†“ (æˆåŠŸ) â”€â”€â”€â”€â”€â”€â†’ [å…³é—­ CLOSED]
   â†“ (å¤±è´¥)
[å¼€å¯ OPEN]
```

**çŠ¶æ€è¯¦è§£**ï¼š

ğŸŸ¢ **CLOSEDï¼ˆå…³é—­çŠ¶æ€ï¼‰**
> - ç†”æ–­å™¨æ­£å¸¸å·¥ä½œï¼Œè¯·æ±‚æ­£å¸¸é€šè¿‡
> - ç»Ÿè®¡å¤±è´¥ç‡ï¼Œå½“å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œåˆ‡æ¢åˆ°å¼€å¯çŠ¶æ€
> - å°±åƒç”µè·¯æ­£å¸¸é€šç”µ

ğŸ”´ **OPENï¼ˆå¼€å¯çŠ¶æ€ï¼‰**  
> - ç†”æ–­å™¨æ‰“å¼€ï¼Œæ‰€æœ‰è¯·æ±‚ç›´æ¥èµ°é™çº§é€»è¾‘
> - ä¸å†è°ƒç”¨åç«¯æœåŠ¡ï¼Œå¿«é€Ÿå¤±è´¥
> - å°±åƒä¿é™©ä¸æ–­å¼€ï¼Œåˆ‡æ–­ç”µè·¯

ğŸŸ¡ **HALF_OPENï¼ˆåŠå¼€çŠ¶æ€ï¼‰**
> - å°è¯•æ¢å¤ï¼Œå…è®¸å°‘é‡è¯·æ±‚é€šè¿‡
> - å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæ¢å¤åˆ°å…³é—­çŠ¶æ€
> - å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œé‡æ–°å›åˆ°å¼€å¯çŠ¶æ€
> - å°±åƒè¯•æ¢æ€§åœ°æ¢å¤ä¾›ç”µ

### 2.3 ç†”æ–­å™¨å·¥ä½œæµç¨‹


**å®Œæ•´æµç¨‹å›¾ç¤º**ï¼š
```
è¯·æ±‚åˆ°è¾¾
   â†“
åˆ¤æ–­ç†”æ–­å™¨çŠ¶æ€ï¼Ÿ
   â”œâ”€ CLOSED â†’ è°ƒç”¨æœåŠ¡ â†’ æˆåŠŸ â†’ è®°å½•æˆåŠŸ
   â”‚                    â†“
   â”‚                   å¤±è´¥ â†’ è®°å½•å¤±è´¥ â†’ åˆ¤æ–­å¤±è´¥ç‡
   â”‚                                    â†“ (è¶…é˜ˆå€¼)
   â”‚                                  åˆ‡æ¢åˆ°OPEN
   â”‚
   â”œâ”€ OPEN â†’ ç›´æ¥é™çº§ â†’ è¿”å›é»˜è®¤å€¼
   â”‚           â†“
   â”‚         ç­‰å¾…æ¢å¤æ—¶é—´ â†’ åˆ‡æ¢åˆ°HALF_OPEN
   â”‚
   â””â”€ HALF_OPEN â†’ æ”¾è¡Œå°‘é‡è¯·æ±‚ â†’ æˆåŠŸ â†’ CLOSED
                                â†“
                               å¤±è´¥ â†’ OPEN
```

---

## 3. ğŸ”§ Resilience4jé›†æˆé…ç½®


### 3.1 ä»€ä¹ˆæ˜¯Resilience4j


**é€šä¿—ç†è§£**ï¼š
- Resilience4jæ˜¯ä¸€ä¸ª**è½»é‡çº§çš„å®¹é”™åº“**ï¼Œä¸“é—¨ç”¨äºå¾®æœåŠ¡åœºæ™¯
- æä¾›ç†”æ–­å™¨ã€é™æµã€é‡è¯•ã€éš”ç¦»ç­‰åŠŸèƒ½
- æ˜¯Spring Cloudæ¨èçš„ç†”æ–­ç»„ä»¶ï¼ˆæ›¿ä»£æ—§ç‰ˆçš„Hystrixï¼‰

### 3.2 æ·»åŠ ä¾èµ–


**Mavené…ç½®**ï¼š
```xml
<!-- Spring Cloud Gateway + Resilience4j -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-circuitbreaker-reactor-resilience4j</artifactId>
</dependency>
```

### 3.3 åŸºç¡€é…ç½®ç¤ºä¾‹


**application.ymlé…ç½®**ï¼š
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/order/**
          filters:
            - name: CircuitBreaker
              args:
                name: orderCircuitBreaker
                fallbackUri: forward:/fallback/order

# Resilience4jç†”æ–­å™¨é…ç½®
resilience4j:
  circuitbreaker:
    instances:
      orderCircuitBreaker:
        # æ»‘åŠ¨çª—å£å¤§å°ï¼ˆç»Ÿè®¡æœ€è¿‘100æ¬¡è¯·æ±‚ï¼‰
        sliding-window-size: 100
        # å¤±è´¥ç‡é˜ˆå€¼50%
        failure-rate-threshold: 50
        # ç­‰å¾…æ—¶é—´60ç§’
        wait-duration-in-open-state: 60s
        # åŠå¼€çŠ¶æ€å…è®¸çš„è¯·æ±‚æ•°
        permitted-number-of-calls-in-half-open-state: 10
```

**é…ç½®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `name` | ç†”æ–­å™¨åç§° | orderCircuitBreaker | å”¯ä¸€æ ‡è¯† |
| `fallbackUri` | é™çº§åœ°å€ | /fallback/order | ç†”æ–­åè·³è½¬çš„åœ°å€ |
| `sliding-window-size` | æ»‘åŠ¨çª—å£å¤§å° | 100 | ç»Ÿè®¡æœ€è¿‘Næ¬¡è¯·æ±‚ |
| `failure-rate-threshold` | å¤±è´¥ç‡é˜ˆå€¼ | 50 | å¤±è´¥ç‡è¶…è¿‡50%è§¦å‘ç†”æ–­ |
| `wait-duration-in-open-state` | ç­‰å¾…æ—¶é—´ | 60s | ç†”æ–­åç­‰å¾…60ç§’å°è¯•æ¢å¤ |

---

## 4. ğŸ”„ ç†”æ–­çŠ¶æ€è½¬æ¢æœºåˆ¶


### 4.1 çŠ¶æ€è½¬æ¢æ¡ä»¶


**ä»CLOSEDåˆ°OPEN**ï¼š
```
æ¡ä»¶ï¼šå¤±è´¥ç‡ >= é˜ˆå€¼

è®¡ç®—å…¬å¼ï¼š
å¤±è´¥ç‡ = å¤±è´¥æ¬¡æ•° / æ»‘åŠ¨çª—å£å†…æ€»è¯·æ±‚æ¬¡æ•°

ç¤ºä¾‹ï¼š
æ»‘åŠ¨çª—å£ = 100æ¬¡
å¤±è´¥æ¬¡æ•° = 55æ¬¡
å¤±è´¥ç‡ = 55/100 = 55% > 50%(é˜ˆå€¼)
â†’ è§¦å‘ç†”æ–­ï¼ŒçŠ¶æ€å˜ä¸ºOPEN
```

**ä»OPENåˆ°HALF_OPEN**ï¼š
```
æ¡ä»¶ï¼šç­‰å¾…æ—¶é—´åˆ°è¾¾

ç¤ºä¾‹ï¼š
wait-duration-in-open-state: 60s
å¼€å¯æ—¶é—´: 10:00:00
ç­‰å¾…åˆ°æœŸ: 10:01:00
â†’ è‡ªåŠ¨åˆ‡æ¢åˆ°HALF_OPENçŠ¶æ€
```

**ä»HALF_OPENåˆ°CLOSED/OPEN**ï¼š
```
åŠå¼€çŠ¶æ€ä¸‹æ”¾è¡ŒNæ¬¡è¯·æ±‚ï¼š

âœ… å¦‚æœè¿™Næ¬¡è¯·æ±‚æˆåŠŸç‡è¾¾æ ‡
   â†’ æ¢å¤åˆ°CLOSEDçŠ¶æ€

âŒ å¦‚æœå¤±è´¥ç‡ä»ç„¶å¾ˆé«˜
   â†’ é‡æ–°å›åˆ°OPENçŠ¶æ€
```

### 4.2 çŠ¶æ€è½¬æ¢å®ä¾‹æ¼”ç¤º


**åœºæ™¯æ¨¡æ‹Ÿ**ï¼š
```
æ—¶é—´è½´ï¼š
10:00:00  [CLOSED]  æ­£å¸¸è¿è¡Œ
10:00:30  [CLOSED]  è®¢å•æœåŠ¡å¼€å§‹å‡ºç°æ•…éšœ
10:00:45  [CLOSED]  å¤±è´¥ç‡è¾¾åˆ°55%ï¼Œè§¦å‘ç†”æ–­
10:00:45  [OPEN]    ç†”æ–­å™¨æ‰“å¼€ï¼Œæ‰€æœ‰è¯·æ±‚é™çº§
10:01:45  [HALF_OPEN] ç­‰å¾…60ç§’åï¼Œå°è¯•æ¢å¤
10:01:50  [HALF_OPEN] æ”¾è¡Œ10æ¬¡æµ‹è¯•è¯·æ±‚
10:01:55  [CLOSED]   æµ‹è¯•æˆåŠŸï¼Œæ¢å¤æ­£å¸¸
```

---

## 5. ğŸ“Š ç†”æ–­æŒ‡æ ‡é…ç½®è¯¦è§£


### 5.1 æ»‘åŠ¨çª—å£é…ç½®


**æ»‘åŠ¨çª—å£ç±»å‹**ï¼š

ğŸ”¹ **åŸºäºè®¡æ•°çš„æ»‘åŠ¨çª—å£**
```yaml
resilience4j:
  circuitbreaker:
    instances:
      myCircuitBreaker:
        sliding-window-type: COUNT_BASED  # åŸºäºè¯·æ±‚æ¬¡æ•°
        sliding-window-size: 100           # ç»Ÿè®¡æœ€è¿‘100æ¬¡è¯·æ±‚
```

ğŸ”¹ **åŸºäºæ—¶é—´çš„æ»‘åŠ¨çª—å£**
```yaml
resilience4j:
  circuitbreaker:
    instances:
      myCircuitBreaker:
        sliding-window-type: TIME_BASED    # åŸºäºæ—¶é—´
        sliding-window-size: 60            # ç»Ÿè®¡æœ€è¿‘60ç§’çš„è¯·æ±‚
```

**å¯¹æ¯”è¯´æ˜**ï¼š

| ç±»å‹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|------|------|
| ğŸ“ˆ **COUNT_BASED** | è¯·æ±‚é‡ç¨³å®šçš„æœåŠ¡ | ç»Ÿè®¡ç²¾ç¡®ï¼Œå®¹æ˜“ç†è§£ | ä½æµé‡æ—¶ååº”æ…¢ |
| â° **TIME_BASED** | è¯·æ±‚é‡æ³¢åŠ¨å¤§çš„æœåŠ¡ | æ—¶æ•ˆæ€§å¼ºï¼Œé€‚åˆçªå‘æµé‡ | é…ç½®ç›¸å¯¹å¤æ‚ |

### 5.2 å¤±è´¥ç‡é˜ˆå€¼é…ç½®


**å…³é”®å‚æ•°**ï¼š
```yaml
# å¤±è´¥ç‡é˜ˆå€¼
failure-rate-threshold: 50

# æ…¢è°ƒç”¨ç‡é˜ˆå€¼
slow-call-rate-threshold: 50

# æ…¢è°ƒç”¨æ—¶é•¿å®šä¹‰
slow-call-duration-threshold: 2s
```

**å‚æ•°å«ä¹‰**ï¼š

> ğŸ”¸ **failure-rate-threshold**
> - å«ä¹‰ï¼šå¤±è´¥ç‡è¾¾åˆ°å¤šå°‘ç™¾åˆ†æ¯”è§¦å‘ç†”æ–­
> - ç¤ºä¾‹ï¼š50è¡¨ç¤ºå¤±è´¥ç‡â‰¥50%æ—¶ç†”æ–­

> ğŸ”¸ **slow-call-rate-threshold**  
> - å«ä¹‰ï¼šæ…¢è°ƒç”¨æ¯”ä¾‹è¾¾åˆ°å¤šå°‘è§¦å‘ç†”æ–­
> - ç¤ºä¾‹ï¼š50è¡¨ç¤ºæ…¢è°ƒç”¨â‰¥50%æ—¶ç†”æ–­

> ğŸ”¸ **slow-call-duration-threshold**
> - å«ä¹‰ï¼šè¶…è¿‡å¤šä¹…ç®—æ…¢è°ƒç”¨
> - ç¤ºä¾‹ï¼š2sè¡¨ç¤ºå“åº”æ—¶é—´>2ç§’ç®—æ…¢è°ƒç”¨

### 5.3 æœ€å°è¯·æ±‚æ•°é…ç½®


```yaml
# æœ€å°è¯·æ±‚æ•°
minimum-number-of-calls: 10
```

**ä½œç”¨è¯´æ˜**ï¼š
- åªæœ‰è¾¾åˆ°æœ€å°è¯·æ±‚æ•°åï¼Œæ‰å¼€å§‹è®¡ç®—å¤±è´¥ç‡
- é¿å…åˆšå¯åŠ¨æ—¶å› ä¸ºæ ·æœ¬å¤ªå°‘è€Œè¯¯è§¦å‘ç†”æ–­

**ç¤ºä¾‹**ï¼š
```
minimum-number-of-calls: 10
sliding-window-size: 100

å‰9æ¬¡è¯·æ±‚ï¼š
- å³ä½¿å…¨éƒ¨å¤±è´¥ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç†”æ–­ï¼ˆæ ·æœ¬ä¸è¶³ï¼‰

ç¬¬10æ¬¡è¯·æ±‚åï¼š
- å¼€å§‹ç»Ÿè®¡å¤±è´¥ç‡
- å¦‚æœå¤±è´¥ç‡â‰¥é˜ˆå€¼ï¼Œè§¦å‘ç†”æ–­
```

---

## 6. ğŸ¯ é™çº§å¤„ç†ç­–ç•¥


### 6.1 é™çº§å¤„ç†æ–¹å¼


**æ–¹å¼ä¸€ï¼šfallbackUriè½¬å‘**
```yaml
filters:
  - name: CircuitBreaker
    args:
      name: orderCircuitBreaker
      fallbackUri: forward:/fallback/order
```

**é™çº§æ§åˆ¶å™¨å®ç°**ï¼š
```java
@RestController
@RequestMapping("/fallback")
public class FallbackController {
    
    @GetMapping("/order")
    public ResponseEntity<String> orderFallback() {
        return ResponseEntity.ok()
            .body("{\"message\":\"è®¢å•æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•\"}");
    }
}
```

**æ–¹å¼äºŒï¼šè‡ªå®šä¹‰é™çº§é€»è¾‘**
```java
@Component
public class CustomFallbackFilter implements GlobalFilter {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        return chain.filter(exchange)
            .onErrorResume(throwable -> {
                // è‡ªå®šä¹‰é™çº§å¤„ç†
                ServerHttpResponse response = exchange.getResponse();
                response.setStatusCode(HttpStatus.SERVICE_UNAVAILABLE);
                
                String fallbackResponse = "{\"code\":503,\"message\":\"æœåŠ¡é™çº§\"}";
                DataBuffer buffer = response.bufferFactory()
                    .wrap(fallbackResponse.getBytes());
                
                return response.writeWith(Mono.just(buffer));
            });
    }
}
```

### 6.2 é™çº§ç­–ç•¥æœ€ä½³å®è·µ


**åˆ†çº§é™çº§ç­–ç•¥**ï¼š

| ä¼˜å…ˆçº§ | æœåŠ¡ç±»å‹ | é™çº§ç­–ç•¥ |
|--------|---------|---------|
| ğŸ”¥ **P0æ ¸å¿ƒ** | è®¢å•ã€æ”¯ä»˜ | è¿”å›æç¤ºä¿¡æ¯ï¼Œå¼•å¯¼ç”¨æˆ·é‡è¯• |
| âš¡ **P1é‡è¦** | åº“å­˜ã€ä¼˜æƒ åˆ¸ | è¿”å›ç¼“å­˜æ•°æ®æˆ–é»˜è®¤å€¼ |
| ğŸ’¡ **P2ä¸€èˆ¬** | æ¨èã€è¯„ä»· | ç›´æ¥ä¸å±•ç¤ºï¼Œä¸å½±å“ä¸»æµç¨‹ |

**é™çº§å“åº”æ¨¡æ¿**ï¼š
```json
{
  "code": 503,
  "message": "æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•",
  "data": {
    "fallback": true,
    "reason": "circuit_breaker_open"
  }
}
```

---

## 7. ğŸ”„ ç†”æ–­æ¢å¤æœºåˆ¶


### 7.1 æ¢å¤æµç¨‹


**å®Œæ•´æ¢å¤æ—¶åºå›¾**ï¼š
```
æœåŠ¡æ•…éšœ
   â†“
ç†”æ–­å™¨å¼€å¯(OPEN)
   â†“
ç­‰å¾…æ¢å¤æ—¶é—´(wait-duration)
   â†“
è¿›å…¥åŠå¼€çŠ¶æ€(HALF_OPEN)
   â†“
æ”¾è¡Œå°‘é‡è¯·æ±‚æµ‹è¯•
   â”œâ”€ æˆåŠŸ â†’ å¤±è´¥ç‡ä¸‹é™ â†’ æ¢å¤CLOSED
   â””â”€ å¤±è´¥ â†’ å¤±è´¥ç‡ä»é«˜ â†’ é‡å›OPEN
```

### 7.2 åŠå¼€çŠ¶æ€é…ç½®


```yaml
resilience4j:
  circuitbreaker:
    instances:
      myCircuitBreaker:
        # åŠå¼€çŠ¶æ€æ”¾è¡Œçš„è¯·æ±‚æ•°
        permitted-number-of-calls-in-half-open-state: 10
        
        # æœ€å¤§ç­‰å¾…æ—¶é—´
        max-wait-duration-in-half-open-state: 10s
```

**å‚æ•°è¯´æ˜**ï¼š

> ğŸ”¸ **permitted-number-of-calls-in-half-open-state**
> - åŠå¼€çŠ¶æ€ä¸‹å…è®¸é€šè¿‡çš„è¯·æ±‚æ•°
> - ç”¨è¿™äº›è¯·æ±‚æ¥æµ‹è¯•æœåŠ¡æ˜¯å¦æ¢å¤

> ğŸ”¸ **max-wait-duration-in-half-open-state**  
> - åŠå¼€çŠ¶æ€æœ€å¤šæŒç»­å¤šä¹…
> - è¶…æ—¶åæ ¹æ®æµ‹è¯•ç»“æœå†³å®šçŠ¶æ€

### 7.3 æ¢å¤ç­–ç•¥ä¼˜åŒ–


**ç­–ç•¥ä¸€ï¼šæ¸è¿›å¼æ¢å¤**
```yaml
# ç¬¬ä¸€æ¬¡æ¢å¤å°è¯•
permitted-number-of-calls-in-half-open-state: 5

# å¦‚æœæˆåŠŸï¼Œé€æ­¥æ”¾å¼€
# å¯é€šè¿‡åŠ¨æ€é…ç½®å®ç°
```

**ç­–ç•¥äºŒï¼šç›‘æ§å‘Šè­¦**
```java
@Component
public class CircuitBreakerEventListener {
    
    @EventListener
    public void onStateTransition(CircuitBreakerOnStateTransitionEvent event) {
        String circuitBreakerName = event.getCircuitBreakerName();
        CircuitBreaker.State fromState = event.getStateTransition().getFromState();
        CircuitBreaker.State toState = event.getStateTransition().getToState();
        
        // çŠ¶æ€å˜åŒ–æ—¶å‘é€å‘Šè­¦
        if (toState == CircuitBreaker.State.OPEN) {
            log.error("ç†”æ–­å™¨ {} å·²å¼€å¯ï¼Œä» {} åˆ° {}", 
                circuitBreakerName, fromState, toState);
            // å‘é€å‘Šè­¦é€šçŸ¥
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç†”æ–­é™çº§æœ¬è´¨ï¼šä¿æŠ¤ç³»ç»Ÿï¼Œé¿å…é›ªå´©æ•ˆåº”
ğŸ”¸ ä¸‰ç§çŠ¶æ€ï¼šCLOSED(å…³é—­) â†’ OPEN(å¼€å¯) â†’ HALF_OPEN(åŠå¼€)
ğŸ”¸ è§¦å‘æ¡ä»¶ï¼šå¤±è´¥ç‡æˆ–æ…¢è°ƒç”¨ç‡è¶…è¿‡é˜ˆå€¼
ğŸ”¸ æ¢å¤æœºåˆ¶ï¼šç­‰å¾…æ—¶é—´åè¿›å…¥åŠå¼€çŠ¶æ€æµ‹è¯•
ğŸ”¸ é™çº§ç­–ç•¥ï¼šè¿”å›é»˜è®¤å€¼ã€ç¼“å­˜æ•°æ®æˆ–å‹å¥½æç¤º
```

### 8.2 å…³é”®é…ç½®å‚æ•°é€ŸæŸ¥


| å‚æ•° | ä½œç”¨ | æ¨èå€¼ |
|------|------|--------|
| `sliding-window-size` | æ»‘åŠ¨çª—å£å¤§å° | 100æ¬¡æˆ–60ç§’ |
| `failure-rate-threshold` | å¤±è´¥ç‡é˜ˆå€¼ | 50% |
| `wait-duration-in-open-state` | ç†”æ–­ç­‰å¾…æ—¶é—´ | 60ç§’ |
| `permitted-number-of-calls-in-half-open-state` | åŠå¼€çŠ¶æ€æµ‹è¯•è¯·æ±‚æ•° | 10æ¬¡ |
| `minimum-number-of-calls` | æœ€å°ç»Ÿè®¡è¯·æ±‚æ•° | 10æ¬¡ |

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ä½¿ç”¨å»ºè®®**ï¼š

âœ… **é€‚ç”¨åœºæ™¯**
- ä¾èµ–çš„ä¸‹æ¸¸æœåŠ¡ä¸ç¨³å®š
- éœ€è¦ä¿æŠ¤æ ¸å¿ƒä¸šåŠ¡æµç¨‹
- æœåŠ¡ä¹‹é—´å­˜åœ¨è°ƒç”¨é“¾è·¯

âš ï¸ **æ³¨æ„äº‹é¡¹**
- é™çº§å“åº”è¦å‹å¥½ï¼Œç»™ç”¨æˆ·æ˜ç¡®æç¤º
- ç›‘æ§ç†”æ–­æŒ‡æ ‡ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´é˜ˆå€¼å‚æ•°

ğŸ”§ **è°ƒä¼˜å»ºè®®**
- æ ¹æ®æœåŠ¡SLAè®¾ç½®åˆç†é˜ˆå€¼
- åŒºåˆ†æ ¸å¿ƒæœåŠ¡å’Œè¾¹ç¼˜æœåŠ¡
- å®šæœŸreviewç†”æ–­é…ç½®

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç†”æ–­åƒä¿é™©ä¸ï¼Œæ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ–­
- é™çº§æ˜¯å¤‡ç”¨æ–¹æ¡ˆï¼Œä¿è¯æœåŠ¡å¯ç”¨
- çŠ¶æ€ä¼šè½¬æ¢ï¼ŒæˆåŠŸåèƒ½æ¢å¤
- é…ç½®éœ€è°ƒä¼˜ï¼Œé€‚åˆè‡ªå·±æœ€é‡è¦