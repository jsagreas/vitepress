---
title: 1ã€Actuatorç›‘æ§ç«¯ç‚¹
---
## ğŸ“š ç›®å½•

1. [Actuatorç›‘æ§ç«¯ç‚¹æ¦‚è¿°](#1-Actuatorç›‘æ§ç«¯ç‚¹æ¦‚è¿°)
2. [Healthå¥åº·æ£€æŸ¥ç«¯ç‚¹](#2-Healthå¥åº·æ£€æŸ¥ç«¯ç‚¹)
3. [Gatewayè·¯ç”±ä¿¡æ¯ç«¯ç‚¹](#3-Gatewayè·¯ç”±ä¿¡æ¯ç«¯ç‚¹)
4. [MetricsæŒ‡æ ‡ç«¯ç‚¹](#4-MetricsæŒ‡æ ‡ç«¯ç‚¹)
5. [è‡ªå®šä¹‰ç›‘æ§ç«¯ç‚¹](#5-è‡ªå®šä¹‰ç›‘æ§ç«¯ç‚¹)
6. [JVMæŒ‡æ ‡ç›‘æ§](#6-JVMæŒ‡æ ‡ç›‘æ§)
7. [ç›‘æ§æ•°æ®å¯¼å‡º](#7-ç›‘æ§æ•°æ®å¯¼å‡º)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Actuatorç›‘æ§ç«¯ç‚¹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Actuator


**é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶é¤å…ï¼š
- å¨æˆ¿æ¸©åº¦ï¼šå¯¹åº”æœåŠ¡å™¨çš„CPUæ¸©åº¦
- é£Ÿæåº“å­˜ï¼šå¯¹åº”ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨
- å®¢æµé‡ç»Ÿè®¡ï¼šå¯¹åº”APIè®¿é—®é‡
- å‘˜å·¥å·¥ä½œçŠ¶æ€ï¼šå¯¹åº”å„ä¸ªæœåŠ¡çš„å¥åº·çŠ¶å†µ

Actuatorå°±åƒé¤å…çš„"ç›‘æ§å¤§å±"
èƒ½å®æ—¶æ˜¾ç¤ºè¿™äº›å…³é”®æŒ‡æ ‡ï¼Œå¸®ä½ äº†è§£é¤å…è¿è¥çŠ¶å†µ
```

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
Actuatorï¼ˆæ‰§è¡Œå™¨ï¼‰ï¼šSpring Bootæä¾›çš„ç”Ÿäº§çº§ç›‘æ§å’Œç®¡ç†å·¥å…·
ä½œç”¨ï¼šæš´éœ²åº”ç”¨è¿è¡Œæ—¶çš„å„ç§ç›‘æ§ç«¯ç‚¹
ç›®æ ‡ï¼šå¸®åŠ©å¼€å‘è€…äº†è§£åº”ç”¨çš„å¥åº·çŠ¶å†µå’Œæ€§èƒ½è¡¨ç°

ç®€å•è¯´ï¼šå°±æ˜¯ç»™ä½ çš„å¾®æœåŠ¡è£…ä¸Š"ä½“æ£€è®¾å¤‡"
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Actuator


**ğŸ”¸ é—®é¢˜åœºæ™¯**ï¼š
```
æ²¡æœ‰ç›‘æ§æ—¶çš„å›°å¢ƒï¼š
âŒ æœåŠ¡æŒ‚äº†ä¸çŸ¥é“ï¼šç”¨æˆ·æŠ•è¯‰æ‰å‘ç°
âŒ æ€§èƒ½é—®é¢˜éš¾å®šä½ï¼šä¸çŸ¥é“å“ªé‡Œæ…¢
âŒ å†…å­˜æ³„æ¼éš¾å‘ç°ï¼šç›´åˆ°ç³»ç»Ÿå´©æºƒ
âŒ é…ç½®é”™è¯¯éš¾æ’æŸ¥ï¼šéœ€è¦é‡å¯æ‰èƒ½çœ‹æ—¥å¿—

æœ‰äº†Actuatoråï¼š
âœ… å®æ—¶å¥åº·æ£€æŸ¥ï¼šæœåŠ¡çŠ¶æ€ä¸€ç›®äº†ç„¶
âœ… æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼šå“åº”æ—¶é—´ã€ååé‡å¯è§†åŒ–
âœ… èµ„æºä½¿ç”¨ç›‘æ§ï¼šCPUã€å†…å­˜å®æ—¶æ˜¾ç¤º
âœ… é…ç½®ä¿¡æ¯æŸ¥çœ‹ï¼šæ— éœ€é‡å¯å³å¯æŸ¥çœ‹
```

### 1.3 æ ¸å¿ƒç›‘æ§ç«¯ç‚¹é€Ÿè§ˆ


| ç«¯ç‚¹åç§° | **ä½œç”¨è¯´æ˜** | **è®¿é—®è·¯å¾„** | **é‡è¦ç¨‹åº¦** |
|---------|------------|------------|------------|
| ğŸ¥ **health** | `æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶å†µ` | `/actuator/health` | â­â­â­â­â­ |
| ğŸ›£ï¸ **gateway** | `æŸ¥çœ‹è·¯ç”±é…ç½®ä¿¡æ¯` | `/actuator/gateway/routes` | â­â­â­â­â­ |
| ğŸ“Š **metrics** | `è·å–æ€§èƒ½æŒ‡æ ‡æ•°æ®` | `/actuator/metrics` | â­â­â­â­ |
| ğŸ“ **info** | `æ˜¾ç¤ºåº”ç”¨åŸºæœ¬ä¿¡æ¯` | `/actuator/info` | â­â­â­ |
| âš™ï¸ **env** | `æŸ¥çœ‹ç¯å¢ƒé…ç½®` | `/actuator/env` | â­â­â­ |

---

## 2. ğŸ¥ Healthå¥åº·æ£€æŸ¥ç«¯ç‚¹


### 2.1 å¥åº·æ£€æŸ¥çš„æœ¬è´¨


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
```
å°±åƒåŒ»ç”Ÿç»™ä½ ä½“æ£€ï¼š
- æµ‹è¡€å‹ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥
- å¬å¿ƒè·³ï¼šæ£€æŸ¥Redisç¼“å­˜
- éªŒè¡€ç³–ï¼šæ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—

å¥åº·æ£€æŸ¥å°±æ˜¯ï¼šå¿«é€Ÿåˆ¤æ–­ç³»ç»Ÿå„ä¸ªéƒ¨åˆ†æ˜¯å¦æ­£å¸¸å·¥ä½œ
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
å¥åº·çŠ¶æ€åˆ†ç±»ï¼š
UPï¼š   å¥åº·ï¼Œä¸€åˆ‡æ­£å¸¸ âœ…
DOWNï¼š ä¸å¥åº·ï¼Œæœ‰é—®é¢˜ âŒ
OUT_OF_SERVICEï¼šæœåŠ¡åœç”¨ âš ï¸
UNKNOWNï¼šçŠ¶æ€æœªçŸ¥ â“

æ£€æŸ¥ç»´åº¦ï¼š
- æ•°æ®åº“è¿æ¥
- ç¼“å­˜æœåŠ¡
- æ¶ˆæ¯é˜Ÿåˆ—
- ç£ç›˜ç©ºé—´
- è‡ªå®šä¹‰æ£€æŸ¥é¡¹
```

### 2.2 åŸºç¡€é…ç½®


**ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**ğŸ“‹ ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶è®¾ç½®**
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,gateway  # å¼€æ”¾çš„ç«¯ç‚¹
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
      show-components: always  # æ˜¾ç¤ºå„ç»„ä»¶çŠ¶æ€
```

**ğŸ’¡ é…ç½®è¯´æ˜**ï¼š
```
show-detailsé€‰é¡¹ï¼š
- neverï¼šä¸æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆé»˜è®¤ï¼‰
- when-authorizedï¼šæˆæƒç”¨æˆ·å¯è§
- alwaysï¼šæ‰€æœ‰äººå¯è§

å®é™…åº”ç”¨å»ºè®®ï¼š
å¼€å‘ç¯å¢ƒï¼šalwaysï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
ç”Ÿäº§ç¯å¢ƒï¼šwhen-authorizedï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
```

### 2.3 å¥åº·æ£€æŸ¥å“åº”ç¤ºä¾‹


**ğŸ” åŸºç¡€å¥åº·æ£€æŸ¥**
```
è®¿é—®ï¼šGET http://localhost:8080/actuator/health

å“åº”ç¤ºä¾‹ï¼š
{
  "status": "UP",  // æ€»ä½“çŠ¶æ€
  "components": {
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 500000000000,
        "free": 300000000000,
        "threshold": 10485760,
        "exists": true
      }
    },
    "ping": {
      "status": "UP"  // Pingæ£€æŸ¥
    }
  }
}
```

**ğŸ” æ•°æ®åº“å¥åº·æ£€æŸ¥**
```yaml
# å½“é…ç½®äº†æ•°æ®åº“åï¼Œè‡ªåŠ¨æ£€æŸ¥
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/gateway_db
    
# å¥åº·æ£€æŸ¥å“åº”ä¼šåŒ…å«ï¼š
{
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "MySQL",
        "validationQuery": "isValid()"
      }
    }
  }
}
```

### 2.4 è‡ªå®šä¹‰å¥åº·æ£€æŸ¥æŒ‡æ ‡


**ğŸ’» å®ç°è‡ªå®šä¹‰å¥åº·æ£€æŸ¥**
```java
@Component
public class CustomHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        // æ£€æŸ¥æŸä¸ªä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£å¸¸
        boolean isHealthy = checkBusinessLogic();
        
        if (isHealthy) {
            return Health.up()
                .withDetail("message", "ä¸šåŠ¡æœåŠ¡æ­£å¸¸")
                .withDetail("checkTime", LocalDateTime.now())
                .build();
        } else {
            return Health.down()
                .withDetail("error", "ä¸šåŠ¡æœåŠ¡å¼‚å¸¸")
                .withDetail("reason", "è¿æ¥è¶…æ—¶")
                .build();
        }
    }
    
    private boolean checkBusinessLogic() {
        // å®é™…çš„ä¸šåŠ¡æ£€æŸ¥é€»è¾‘
        return true;
    }
}
```

**ğŸ’¡ ç†è§£è¦ç‚¹**ï¼š
```
è‡ªå®šä¹‰æ£€æŸ¥çš„ä»·å€¼ï¼š
1. æ£€æŸ¥ç¬¬ä¸‰æ–¹æœåŠ¡ï¼šæ”¯ä»˜æ¥å£ã€çŸ­ä¿¡æœåŠ¡ç­‰
2. æ£€æŸ¥ä¸šåŠ¡è§„åˆ™ï¼šè®¢å•å¤„ç†èƒ½åŠ›ã€åº“å­˜çŠ¶æ€ç­‰
3. æ£€æŸ¥ç³»ç»Ÿèµ„æºï¼šçº¿ç¨‹æ± ã€è¿æ¥æ± çŠ¶æ€ç­‰

è¿”å›ä¿¡æ¯åŒ…å«ï¼š
- statusï¼šå¥åº·çŠ¶æ€ï¼ˆUP/DOWNï¼‰
- detailsï¼šè¯¦ç»†ä¿¡æ¯ï¼ˆè‡ªå®šä¹‰å†…å®¹ï¼‰
```

---

## 3. ğŸ›£ï¸ Gatewayè·¯ç”±ä¿¡æ¯ç«¯ç‚¹


### 3.1 è·¯ç”±ä¿¡æ¯çš„ä½œç”¨


**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
è¿ç»´äººå‘˜çš„éœ€æ±‚ï¼š
"å½“å‰ç½‘å…³é…ç½®äº†å“ªäº›è·¯ç”±ï¼Ÿ"
"æŸä¸ªè·¯ç”±çš„è½¬å‘è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ"
"è¿‡æ»¤å™¨é“¾æ˜¯å¦‚ä½•é…ç½®çš„ï¼Ÿ"

Gatewayç«¯ç‚¹çš„ä»·å€¼ï¼š
âœ… å®æ—¶æŸ¥çœ‹æ‰€æœ‰è·¯ç”±é…ç½®
âœ… éªŒè¯è·¯ç”±è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ
âœ… æ’æŸ¥è·¯ç”±åŒ¹é…é—®é¢˜
âœ… åŠ¨æ€è°ƒæ•´è·¯ç”±é…ç½®
```

### 3.2 æŸ¥çœ‹æ‰€æœ‰è·¯ç”±


**ğŸ“‹ è®¿é—®è·¯ç”±åˆ—è¡¨**
```
GET http://localhost:8080/actuator/gateway/routes

å“åº”ç¤ºä¾‹ï¼š
[
  {
    "route_id": "user-service",
    "route_definition": {
      "id": "user-service",
      "predicates": [
        {
          "name": "Path",
          "args": {
            "_genkey_0": "/user/**"
          }
        }
      ],
      "filters": [],
      "uri": "lb://user-service",
      "order": 0
    },
    "order": 0
  },
  {
    "route_id": "order-service",
    "route_definition": {
      "id": "order-service",
      "predicates": [
        {
          "name": "Path",
          "args": {
            "_genkey_0": "/order/**"
          }
        }
      ],
      "uri": "lb://order-service"
    }
  }
]
```

**ğŸ’¡ å“åº”ä¿¡æ¯è§£è¯»**ï¼š
```
å…³é”®å­—æ®µè¯´æ˜ï¼š

route_idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡è¯†
predicatesï¼šåŒ¹é…æ¡ä»¶
  - Pathï¼šè·¯å¾„åŒ¹é…
  - Methodï¼šè¯·æ±‚æ–¹æ³•
  - Headerï¼šè¯·æ±‚å¤´åŒ¹é…
  
filtersï¼šè¿‡æ»¤å™¨é…ç½®
  - AddRequestHeader
  - StripPrefix
  - RateLimiterç­‰

uriï¼šç›®æ ‡æœåŠ¡åœ°å€
  - lb://æœåŠ¡åï¼šè´Ÿè½½å‡è¡¡
  - http://IP:ç«¯å£ï¼šç›´è¿
```

### 3.3 æŸ¥çœ‹å•ä¸ªè·¯ç”±è¯¦æƒ…


**ğŸ“‹ è·å–æŒ‡å®šè·¯ç”±ä¿¡æ¯**
```
GET http://localhost:8080/actuator/gateway/routes/{route_id}

ç¤ºä¾‹ï¼š
GET http://localhost:8080/actuator/gateway/routes/user-service

å“åº”ï¼š
{
  "route_id": "user-service",
  "predicates": [
    {
      "name": "Path",
      "args": { "_genkey_0": "/user/**" }
    },
    {
      "name": "Method",
      "args": { "_genkey_0": "GET,POST" }
    }
  ],
  "filters": [
    {
      "name": "StripPrefix",
      "args": { "_genkey_0": "1" }
    }
  ],
  "uri": "lb://user-service",
  "metadata": {},
  "order": 0
}
```

### 3.4 è·¯ç”±åˆ·æ–°æ“ä½œ


**ğŸ”„ åŠ¨æ€åˆ·æ–°è·¯ç”±**
```
POST http://localhost:8080/actuator/gateway/refresh

ä½œç”¨ï¼šé‡æ–°åŠ è½½è·¯ç”±é…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡

åº”ç”¨åœºæ™¯ï¼š
1. é…ç½®ä¸­å¿ƒæ›´æ–°äº†è·¯ç”±è§„åˆ™
2. åŠ¨æ€æ·»åŠ äº†æ–°çš„å¾®æœåŠ¡
3. ä¿®æ”¹äº†è·¯ç”±çš„è¿‡æ»¤å™¨é“¾
```

**ğŸ’¡ ä½¿ç”¨å»ºè®®**ï¼š
```
å¼€å‘ç¯å¢ƒï¼š
- é¢‘ç¹ä¿®æ”¹è·¯ç”±æ—¶ä½¿ç”¨
- å¿«é€ŸéªŒè¯é…ç½®æ•ˆæœ

ç”Ÿäº§ç¯å¢ƒï¼š
- è°¨æ…ä½¿ç”¨ï¼Œé¿å…ä¸šåŠ¡å½±å“
- å»ºè®®é…åˆé…ç½®ä¸­å¿ƒçš„ç°åº¦å‘å¸ƒ
- åšå¥½å˜æ›´è®°å½•å’Œå›æ»šå‡†å¤‡
```

---

## 4. ğŸ“Š MetricsæŒ‡æ ‡ç«¯ç‚¹


### 4.1 æŒ‡æ ‡ç›‘æ§çš„æ„ä¹‰


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦æŒ‡æ ‡ç›‘æ§**ï¼š
```
ç±»æ¯”ï¼šå¼€è½¦æ—¶çš„ä»ªè¡¨ç›˜
- é€Ÿåº¦è¡¨ï¼šå¯¹åº”APIå“åº”æ—¶é—´
- æ²¹é‡è¡¨ï¼šå¯¹åº”ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡
- æ°´æ¸©è¡¨ï¼šå¯¹åº”æœåŠ¡è´Ÿè½½æƒ…å†µ
- æ•…éšœç¯ï¼šå¯¹åº”å¼‚å¸¸é”™è¯¯ç»Ÿè®¡

Metricså°±æ˜¯å¾®æœåŠ¡çš„"ä»ªè¡¨ç›˜"
å¸®ä½ å®æ—¶äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶å†µ
```

**ğŸ”¸ æ ¸å¿ƒæŒ‡æ ‡åˆ†ç±»**ï¼š
```
ç³»ç»ŸæŒ‡æ ‡ï¼š
- CPUä½¿ç”¨ç‡
- å†…å­˜å ç”¨
- çº¿ç¨‹æ•°é‡
- GCæ¬¡æ•°

åº”ç”¨æŒ‡æ ‡ï¼š
- HTTPè¯·æ±‚æ•°
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- å¹¶å‘æ•°

ä¸šåŠ¡æŒ‡æ ‡ï¼š
- è®¢å•é‡
- ç”¨æˆ·ç™»å½•æ•°
- æ”¯ä»˜æˆåŠŸç‡
```

### 4.2 åŸºç¡€æŒ‡æ ‡æŸ¥è¯¢


**ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æŒ‡æ ‡**
```
GET http://localhost:8080/actuator/metrics

å“åº”ç¤ºä¾‹ï¼š
{
  "names": [
    "jvm.memory.used",
    "jvm.memory.max",
    "jvm.gc.pause",
    "http.server.requests",
    "system.cpu.usage",
    "process.uptime",
    "tomcat.sessions.active.current"
  ]
}
```

**ğŸ“‹ æŸ¥è¯¢å…·ä½“æŒ‡æ ‡å€¼**
```
GET http://localhost:8080/actuator/metrics/jvm.memory.used

å“åº”ï¼š
{
  "name": "jvm.memory.used",
  "description": "å½“å‰ä½¿ç”¨çš„å†…å­˜é‡",
  "baseUnit": "bytes",
  "measurements": [
    {
      "statistic": "VALUE",
      "value": 268435456  // çº¦256MB
    }
  ],
  "availableTags": [
    {
      "tag": "area",
      "values": ["heap", "nonheap"]
    },
    {
      "tag": "id",
      "values": ["PS Eden Space", "PS Old Gen"]
    }
  ]
}
```

### 4.3 HTTPè¯·æ±‚æŒ‡æ ‡


**ğŸ“Š è¯·æ±‚ç»Ÿè®¡æŒ‡æ ‡**
```
GET http://localhost:8080/actuator/metrics/http.server.requests

å…³é”®ä¿¡æ¯ï¼š
{
  "measurements": [
    {
      "statistic": "COUNT",      // è¯·æ±‚æ€»æ•°
      "value": 1523
    },
    {
      "statistic": "TOTAL_TIME", // æ€»è€—æ—¶
      "value": 45.2
    },
    {
      "statistic": "MAX",         // æœ€å¤§å“åº”æ—¶é—´
      "value": 3.5
    }
  ],
  "availableTags": [
    {
      "tag": "uri",               // å¯æŒ‰URIè¿‡æ»¤
      "values": ["/user/login", "/order/create"]
    },
    {
      "tag": "status",            // å¯æŒ‰çŠ¶æ€ç è¿‡æ»¤
      "values": ["200", "404", "500"]
    }
  ]
}
```

**ğŸ’¡ æŒ‰æ¡ä»¶æŸ¥è¯¢**
```
æŸ¥è¯¢ç‰¹å®šURIçš„è¯·æ±‚æ•°ï¼š
GET /actuator/metrics/http.server.requests?tag=uri:/user/login

æŸ¥è¯¢é”™è¯¯è¯·æ±‚æ•°ï¼š
GET /actuator/metrics/http.server.requests?tag=status:500

æŸ¥è¯¢æŸæ–¹æ³•çš„è¯·æ±‚ï¼š
GET /actuator/metrics/http.server.requests?tag=method:POST
```

### 4.4 è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡


**ğŸ’» æ³¨å†Œè‡ªå®šä¹‰æŒ‡æ ‡**
```java
@Component
public class BusinessMetrics {
    
    private final MeterRegistry meterRegistry;
    
    public BusinessMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }
    
    // è®¡æ•°å™¨ï¼šç»Ÿè®¡è®¢å•æ•°é‡
    public void recordOrder() {
        Counter.builder("business.order.created")
            .description("è®¢å•åˆ›å»ºæ•°é‡")
            .tag("type", "online")
            .register(meterRegistry)
            .increment();
    }
    
    // è®¡æ—¶å™¨ï¼šç»Ÿè®¡å¤„ç†è€—æ—¶
    public void recordPaymentTime(long milliseconds) {
        Timer.builder("business.payment.time")
            .description("æ”¯ä»˜å¤„ç†æ—¶é—´")
            .register(meterRegistry)
            .record(milliseconds, TimeUnit.MILLISECONDS);
    }
    
    // ä»ªè¡¨ï¼šç»Ÿè®¡å½“å‰åœ¨çº¿ç”¨æˆ·
    public void recordOnlineUsers(int count) {
        Gauge.builder("business.users.online", () -> count)
            .description("å½“å‰åœ¨çº¿ç”¨æˆ·æ•°")
            .register(meterRegistry);
    }
}
```

**ğŸ”¸ æŒ‡æ ‡ç±»å‹è¯´æ˜**ï¼š
```
Counterï¼ˆè®¡æ•°å™¨ï¼‰ï¼š
- åªèƒ½é€’å¢
- é€‚åˆï¼šè®¢å•æ•°ã€ç™»å½•æ¬¡æ•°ã€é”™è¯¯æ¬¡æ•°
- ç¤ºä¾‹ï¼šè®°å½•APIè°ƒç”¨æ¬¡æ•°

Timerï¼ˆè®¡æ—¶å™¨ï¼‰ï¼š
- åŒæ—¶è®°å½•æ¬¡æ•°å’Œæ—¶é•¿
- é€‚åˆï¼šæ–¹æ³•æ‰§è¡Œæ—¶é—´ã€è¯·æ±‚å“åº”æ—¶é—´
- ç¤ºä¾‹ï¼šè®°å½•æ•°æ®åº“æŸ¥è¯¢è€—æ—¶

Gaugeï¼ˆä»ªè¡¨ï¼‰ï¼š
- å¯å¢å¯å‡çš„æ•°å€¼
- é€‚åˆï¼šå½“å‰å€¼ã€å®æ—¶çŠ¶æ€
- ç¤ºä¾‹ï¼šå½“å‰çº¿ç¨‹æ•°ã€é˜Ÿåˆ—é•¿åº¦
```

---

## 5. ğŸ”§ è‡ªå®šä¹‰ç›‘æ§ç«¯ç‚¹


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰ç«¯ç‚¹


**ğŸ’¡ å®é™…éœ€æ±‚åœºæ™¯**ï¼š
```
é»˜è®¤ç«¯ç‚¹çš„å±€é™ï¼š
- æ— æ³•å±•ç¤ºä¸šåŠ¡ç‰¹å®šä¿¡æ¯
- ä¸èƒ½æ»¡è¶³ä¸ªæ€§åŒ–ç›‘æ§éœ€æ±‚
- ç¼ºå°‘ä¸šåŠ¡æ•°æ®çš„å®æ—¶æŸ¥çœ‹

è‡ªå®šä¹‰ç«¯ç‚¹çš„ä»·å€¼ï¼š
âœ… æš´éœ²ä¸šåŠ¡å…³é”®æŒ‡æ ‡
âœ… æä¾›è¿è¥æ•°æ®æŸ¥è¯¢
âœ… å®ç°è‡ªå®šä¹‰ç®¡ç†åŠŸèƒ½
```

### 5.2 åˆ›å»ºè‡ªå®šä¹‰åªè¯»ç«¯ç‚¹


**ğŸ’» å®ç°ç¤ºä¾‹**
```java
@Component
@Endpoint(id = "business")  // ç«¯ç‚¹IDï¼Œè®¿é—®è·¯å¾„ä¸º /actuator/business
public class BusinessEndpoint {
    
    // åªè¯»æ“ä½œï¼šä½¿ç”¨@ReadOperation
    @ReadOperation
    public Map<String, Object> businessInfo() {
        Map<String, Object> info = new HashMap<>();
        info.put("todayOrders", getTodayOrderCount());
        info.put("activeUsers", getActiveUserCount());
        info.put("systemStatus", "RUNNING");
        info.put("lastUpdateTime", LocalDateTime.now());
        return info;
    }
    
    private int getTodayOrderCount() {
        // å®é™…ä¸šåŠ¡é€»è¾‘
        return 1250;
    }
    
    private int getActiveUserCount() {
        // å®é™…ä¸šåŠ¡é€»è¾‘
        return 523;
    }
}
```

**ğŸ“‹ è®¿é—®è‡ªå®šä¹‰ç«¯ç‚¹**
```
GET http://localhost:8080/actuator/business

å“åº”ï¼š
{
  "todayOrders": 1250,
  "activeUsers": 523,
  "systemStatus": "RUNNING",
  "lastUpdateTime": "2025-09-23T15:30:00"
}
```

### 5.3 æ”¯æŒå‚æ•°çš„ç«¯ç‚¹


**ğŸ’» å¸¦å‚æ•°æŸ¥è¯¢**
```java
@Component
@Endpoint(id = "cache")
public class CacheEndpoint {
    
    @Autowired
    private CacheManager cacheManager;
    
    // æŸ¥è¯¢æŒ‡å®šç¼“å­˜çš„ä¿¡æ¯
    @ReadOperation
    public Map<String, Object> getCacheInfo(@Selector String cacheName) {
        Cache cache = cacheManager.getCache(cacheName);
        
        Map<String, Object> info = new HashMap<>();
        info.put("name", cacheName);
        info.put("size", getCacheSize(cache));
        info.put("hitRate", getHitRate(cache));
        return info;
    }
    
    private int getCacheSize(Cache cache) {
        // è·å–ç¼“å­˜å¤§å°çš„é€»è¾‘
        return 100;
    }
    
    private double getHitRate(Cache cache) {
        // è®¡ç®—å‘½ä¸­ç‡çš„é€»è¾‘
        return 0.85;
    }
}
```

**ğŸ“‹ ä½¿ç”¨æ–¹å¼**
```
æŸ¥è¯¢userCacheçš„ä¿¡æ¯ï¼š
GET http://localhost:8080/actuator/cache/userCache

å“åº”ï¼š
{
  "name": "userCache",
  "size": 100,
  "hitRate": 0.85
}
```

### 5.4 å†™æ“ä½œç«¯ç‚¹


**ğŸ’» æ”¯æŒä¿®æ”¹æ“ä½œ**
```java
@Component
@Endpoint(id = "feature")
public class FeatureToggleEndpoint {
    
    private Map<String, Boolean> features = new HashMap<>();
    
    // è¯»æ“ä½œï¼šæŸ¥è¯¢åŠŸèƒ½å¼€å…³çŠ¶æ€
    @ReadOperation
    public Map<String, Boolean> getFeatures() {
        return features;
    }
    
    // å†™æ“ä½œï¼šä¿®æ”¹åŠŸèƒ½å¼€å…³
    @WriteOperation
    public String toggleFeature(@Selector String featureName, 
                                boolean enabled) {
        features.put(featureName, enabled);
        return String.format("åŠŸèƒ½ %s å·²%s", 
            featureName, enabled ? "å¼€å¯" : "å…³é—­");
    }
    
    // åˆ é™¤æ“ä½œ
    @DeleteOperation
    public String removeFeature(@Selector String featureName) {
        features.remove(featureName);
        return "åŠŸèƒ½é…ç½®å·²åˆ é™¤ï¼š" + featureName;
    }
}
```

**ğŸ“‹ æ“ä½œç¤ºä¾‹**
```
æŸ¥è¯¢æ‰€æœ‰åŠŸèƒ½å¼€å…³ï¼š
GET http://localhost:8080/actuator/feature

å¼€å¯æŸä¸ªåŠŸèƒ½ï¼š
POST http://localhost:8080/actuator/feature/newPayment
Content-Type: application/json
{
  "enabled": true
}

åˆ é™¤åŠŸèƒ½é…ç½®ï¼š
DELETE http://localhost:8080/actuator/feature/oldFeature
```

**âš ï¸ å®‰å…¨æé†’**ï¼š
```
å†™æ“ä½œç«¯ç‚¹çš„é£é™©ï¼š
- å¯èƒ½å½±å“ç³»ç»Ÿè¿è¡Œ
- éœ€è¦ä¸¥æ ¼çš„æƒé™æ§åˆ¶
- å»ºè®®åªåœ¨å¼€å‘ç¯å¢ƒå¼€æ”¾

å®‰å…¨æªæ–½ï¼š
1. é…ç½®Spring Security
2. é™åˆ¶IPè®¿é—®
3. è®°å½•æ“ä½œæ—¥å¿—
4. ç”Ÿäº§ç¯å¢ƒæ…ç”¨
```

---

## 6. ğŸ’¾ JVMæŒ‡æ ‡ç›‘æ§


### 6.1 JVMç›‘æ§çš„é‡è¦æ€§


**ğŸ¯ ä¸ºä»€ä¹ˆå…³æ³¨JVMæŒ‡æ ‡**ï¼š
```
Javaåº”ç”¨çš„æ ¸å¿ƒèµ„æºï¼š
- å†…å­˜ï¼šå †å†…å­˜ã€éå †å†…å­˜
- çº¿ç¨‹ï¼šæ´»è·ƒçº¿ç¨‹ã€é˜»å¡çº¿ç¨‹
- GCï¼šåƒåœ¾å›æ”¶æ¬¡æ•°ã€åœé¡¿æ—¶é—´
- ç±»åŠ è½½ï¼šå·²åŠ è½½ç±»æ•°é‡

JVMé—®é¢˜çš„è¡¨ç°ï¼š
âŒ å†…å­˜æº¢å‡ºï¼šOutOfMemoryError
âŒ é¢‘ç¹GCï¼šåº”ç”¨å¡é¡¿
âŒ çº¿ç¨‹æ³„æ¼ï¼šçº¿ç¨‹æ•°æŒç»­å¢é•¿
âŒ CPUé£™é«˜ï¼šæ­»å¾ªç¯æˆ–è®¡ç®—å¯†é›†

æå‰å‘ç°å¼‚å¸¸ï¼Œé¿å…ç”Ÿäº§äº‹æ•…
```

### 6.2 å†…å­˜ç›‘æ§æŒ‡æ ‡


**ğŸ“Š å †å†…å­˜ç›‘æ§**
```
GET http://localhost:8080/actuator/metrics/jvm.memory.used?tag=area:heap

å…³é”®æŒ‡æ ‡ï¼š
{
  "name": "jvm.memory.used",
  "measurements": [
    {
      "statistic": "VALUE",
      "value": 536870912  // å½“å‰ä½¿ç”¨ï¼š512MB
    }
  ]
}

å†…å­˜åŒºåŸŸè¯´æ˜ï¼š
å †å†…å­˜ï¼ˆHeapï¼‰ï¼š
- Eden Spaceï¼šæ–°ç”Ÿä»£ï¼Œæ–°å¯¹è±¡åˆ†é…åŒº
- Survivor Spaceï¼šå­˜æ´»å¯¹è±¡æš‚å­˜åŒº
- Old Generationï¼šè€å¹´ä»£ï¼Œé•¿æœŸå­˜æ´»å¯¹è±¡

éå †å†…å­˜ï¼ˆNon-Heapï¼‰ï¼š
- Metaspaceï¼šå…ƒç©ºé—´ï¼Œç±»å…ƒæ•°æ®
- Code Cacheï¼šJITç¼–è¯‘ä»£ç ç¼“å­˜
- Compressed Class Spaceï¼šå‹ç¼©ç±»ç©ºé—´
```

**ğŸ’¡ å†…å­˜ä½¿ç”¨ç‡è®¡ç®—**
```
GET http://localhost:8080/actuator/metrics/jvm.memory.max?tag=area:heap
// æœ€å¤§å¯ç”¨ï¼š1GB

ä½¿ç”¨ç‡ = å·²ä½¿ç”¨ / æœ€å¤§å¯ç”¨
     = 512MB / 1024MB
     = 50%

å‘Šè­¦é˜ˆå€¼å»ºè®®ï¼š
ğŸŸ¢ <70%ï¼šæ­£å¸¸
ğŸŸ¡ 70-85%ï¼šéœ€å…³æ³¨
ğŸ”´ >85%ï¼šéœ€è¦æ‰©å®¹æˆ–ä¼˜åŒ–
```

### 6.3 GCç›‘æ§æŒ‡æ ‡


**ğŸ“Š åƒåœ¾å›æ”¶ç»Ÿè®¡**
```
GET http://localhost:8080/actuator/metrics/jvm.gc.pause

å“åº”ç¤ºä¾‹ï¼š
{
  "measurements": [
    {
      "statistic": "COUNT",
      "value": 15  // GCæ¬¡æ•°
    },
    {
      "statistic": "TOTAL_TIME",
      "value": 0.45  // æ€»è€—æ—¶450ms
    },
    {
      "statistic": "MAX",
      "value": 0.08  // æœ€é•¿åœé¡¿80ms
    }
  ],
  "availableTags": [
    {
      "tag": "action",
      "values": ["end of minor GC", "end of major GC"]
    },
    {
      "tag": "cause",
      "values": ["Allocation Failure", "System.gc()"]
    }
  ]
}
```

**ğŸ”¸ GCç±»å‹è¯´æ˜**ï¼š
```
Minor GCï¼ˆå¹´è½»ä»£GCï¼‰ï¼š
- é¢‘ç‡ï¼šè¾ƒé«˜
- è€—æ—¶ï¼šè¾ƒçŸ­ï¼ˆå‡ åæ¯«ç§’ï¼‰
- å½±å“ï¼šè¾ƒå°

Major GCï¼ˆè€å¹´ä»£GCï¼‰ï¼š
- é¢‘ç‡ï¼šè¾ƒä½
- è€—æ—¶ï¼šè¾ƒé•¿ï¼ˆå‡ ç™¾æ¯«ç§’ï¼‰
- å½±å“ï¼šæ˜æ˜¾åœé¡¿

Full GCï¼ˆå®Œæ•´GCï¼‰ï¼š
- é¢‘ç‡ï¼šå¾ˆä½
- è€—æ—¶ï¼šæœ€é•¿
- å½±å“ï¼šä¸¥é‡åœé¡¿

å¥åº·çŠ¶æ€åˆ¤æ–­ï¼š
âœ… Minor GCé¢‘ç‡ç¨³å®šï¼Œè€—æ—¶<100ms
âš ï¸ Full GCé¢‘ç¹ï¼Œè¯´æ˜å†…å­˜å‹åŠ›å¤§
âŒ é•¿æ—¶é—´GCåœé¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ
```

### 6.4 çº¿ç¨‹ç›‘æ§æŒ‡æ ‡


**ğŸ“Š çº¿ç¨‹çŠ¶æ€ç›‘æ§**
```
GET http://localhost:8080/actuator/metrics/jvm.threads.live

å½“å‰æ´»è·ƒçº¿ç¨‹æ•°ï¼š
{
  "measurements": [
    {
      "statistic": "VALUE",
      "value": 25  // 25ä¸ªæ´»è·ƒçº¿ç¨‹
    }
  ]
}

GET http://localhost:8080/actuator/metrics/jvm.threads.peak

å³°å€¼çº¿ç¨‹æ•°ï¼š
{
  "measurements": [
    {
      "statistic": "VALUE",
      "value": 32  // å†å²æœ€é«˜32ä¸ª
    }
  ]
}
```

**ğŸ’¡ çº¿ç¨‹ç›‘æ§è¦ç‚¹**ï¼š
```
å…³æ³¨æŒ‡æ ‡ï¼š
1. æ´»è·ƒçº¿ç¨‹æ•°ï¼šå½“å‰è¿è¡Œçš„çº¿ç¨‹
2. å®ˆæŠ¤çº¿ç¨‹æ•°ï¼šåå°æœåŠ¡çº¿ç¨‹
3. å³°å€¼çº¿ç¨‹æ•°ï¼šå†å²æœ€å¤§å€¼
4. æ­»é”çº¿ç¨‹æ•°ï¼šäº’ç›¸ç­‰å¾…çš„çº¿ç¨‹

å¼‚å¸¸ä¿¡å·ï¼š
ğŸ”´ çº¿ç¨‹æ•°æŒç»­å¢é•¿ï¼šå¯èƒ½æœ‰çº¿ç¨‹æ³„æ¼
ğŸ”´ å¤§é‡BLOCKEDçŠ¶æ€ï¼šå¯èƒ½æœ‰æ­»é”
ğŸ”´ çº¿ç¨‹æ•°è¶…è¿‡1000ï¼šç³»ç»Ÿè´Ÿè½½è¿‡é«˜

è¯Šæ–­å»ºè®®ï¼š
1. ä½¿ç”¨jstackå¯¼å‡ºçº¿ç¨‹å¿«ç…§
2. åˆ†æçº¿ç¨‹å †æ ˆï¼Œæ‰¾å‡ºé—®é¢˜ä»£ç 
3. æ£€æŸ¥çº¿ç¨‹æ± é…ç½®æ˜¯å¦åˆç†
```

---

## 7. ğŸ“¤ ç›‘æ§æ•°æ®å¯¼å‡º


### 7.1 ä¸ºä»€ä¹ˆè¦å¯¼å‡ºç›‘æ§æ•°æ®


**ğŸ¯ æ•°æ®å¯¼å‡ºçš„ä»·å€¼**ï¼š
```
Actuatorç«¯ç‚¹çš„å±€é™ï¼š
- åªèƒ½å®æ—¶æŸ¥çœ‹å½“å‰æ•°æ®
- æ— æ³•åˆ†æå†å²è¶‹åŠ¿
- ä¸æ”¯æŒæ•°æ®å¯è§†åŒ–
- éš¾ä»¥è®¾ç½®å‘Šè­¦è§„åˆ™

å¯¼å‡ºåˆ°ç›‘æ§ç³»ç»Ÿçš„å¥½å¤„ï¼š
âœ… æŒä¹…åŒ–å­˜å‚¨å†å²æ•°æ®
âœ… ç”Ÿæˆè¶‹åŠ¿å›¾è¡¨åˆ†æ
âœ… é…ç½®æ™ºèƒ½å‘Šè­¦è§„åˆ™
âœ… è·¨æœåŠ¡æ•°æ®å¯¹æ¯”
```

**ğŸ”¸ å¸¸è§ç›‘æ§ç³»ç»Ÿ**ï¼š
```
Prometheus + Grafanaï¼š
- å¼€æºå…è´¹
- åŠŸèƒ½å¼ºå¤§
- ç¤¾åŒºæ´»è·ƒ

ELK Stackï¼š
- æ—¥å¿— + ç›‘æ§
- å…¨æ–‡æ£€ç´¢
- å®æ—¶åˆ†æ

äº‘å‚å•†æ–¹æ¡ˆï¼š
- é˜¿é‡Œäº‘ARMS
- è…¾è®¯äº‘ç›‘æ§
- AWS CloudWatch
```

### 7.2 å¯¼å‡ºåˆ°Prometheus


**ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

**ğŸ“‹ ç¬¬äºŒæ­¥ï¼šé…ç½®æš´éœ²ç«¯ç‚¹**
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus  # æ·»åŠ prometheus
  metrics:
    export:
      prometheus:
        enabled: true  # å¯ç”¨Prometheuså¯¼å‡º
```

**ğŸ“‹ ç¬¬ä¸‰æ­¥ï¼šPrometheusé‡‡é›†é…ç½®**
```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'spring-gateway'
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['localhost:8080']
        labels:
          application: 'api-gateway'
          environment: 'production'
```

**ğŸ’¡ å·¥ä½œæµç¨‹**ï¼š
```
æ•°æ®æµè½¬è¿‡ç¨‹ï¼š

Springåº”ç”¨ â†’ æš´éœ²/actuator/prometheusç«¯ç‚¹
     â†“
Prometheus â†’ å®šæ—¶æŠ“å–æŒ‡æ ‡æ•°æ®ï¼ˆé»˜è®¤15ç§’ï¼‰
     â†“
å­˜å‚¨æ—¶åºæ•°æ® â†’ æ—¶é—´åºåˆ—æ•°æ®åº“
     â†“
Grafana â†’ æŸ¥è¯¢å±•ç¤º â†’ ä»ªè¡¨ç›˜å¯è§†åŒ–
```

### 7.3 Grafanaä»ªè¡¨ç›˜é…ç½®


**ğŸ“Š åˆ›å»ºç›‘æ§é¢æ¿**
```
æ­¥éª¤1ï¼šæ·»åŠ Prometheusæ•°æ®æº
- URLï¼šhttp://localhost:9090
- Accessï¼šServer
- æµ‹è¯•è¿æ¥æˆåŠŸ

æ­¥éª¤2ï¼šå¯¼å…¥JVMç›‘æ§æ¨¡æ¿
- Dashboard IDï¼š4701
- æˆ–è€…ä½¿ç”¨Spring Boot 2.xæ¨¡æ¿ï¼š11378

æ­¥éª¤3ï¼šè‡ªå®šä¹‰é¢æ¿
```

**ğŸ’¡ æ ¸å¿ƒç›‘æ§é¢æ¿**ï¼š
```
ç³»ç»Ÿèµ„æºé¢æ¿ï¼š
- CPUä½¿ç”¨ç‡è¶‹åŠ¿å›¾
- å†…å­˜ä½¿ç”¨ç‡è¶‹åŠ¿å›¾
- GCæ¬¡æ•°å’Œè€—æ—¶
- çº¿ç¨‹æ•°å˜åŒ–

åº”ç”¨æ€§èƒ½é¢æ¿ï¼š
- HTTPè¯·æ±‚QPS
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯ç‡ç»Ÿè®¡
- æ…¢æ¥å£Top10

ä¸šåŠ¡æŒ‡æ ‡é¢æ¿ï¼š
- è®¢å•é‡è¶‹åŠ¿
- ç”¨æˆ·æ´»è·ƒåº¦
- æ¥å£è°ƒç”¨åˆ†å¸ƒ
- è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡
```

### 7.4 å‘Šè­¦è§„åˆ™é…ç½®


**âš ï¸ Prometheuså‘Šè­¦è§„åˆ™**
```yaml
# alert_rules.yml
groups:
  - name: gateway_alerts
    interval: 30s
    rules:
      # å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighMemoryUsage
        expr: jvm_memory_used_bytes{area="heap"} / jvm_memory_max_bytes{area="heap"} > 0.85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "{{ $labels.application }} å †å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%"
      
      # é”™è¯¯ç‡å‘Šè­¦
      - alert: HighErrorRate
        expr: rate(http_server_requests_seconds_count{status=~"5.."}[5m]) > 0.05
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "æ¥å£é”™è¯¯ç‡è¿‡é«˜"
          description: "{{ $labels.uri }} é”™è¯¯ç‡è¶…è¿‡5%"
      
      # GCé¢‘ç¹å‘Šè­¦
      - alert: FrequentGC
        expr: rate(jvm_gc_pause_seconds_count[5m]) > 1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "GCè¿‡äºé¢‘ç¹"
          description: "5åˆ†é’Ÿå†…GCè¶…è¿‡5æ¬¡"
```

**ğŸ“¬ å‘Šè­¦é€šçŸ¥é…ç½®**
```yaml
# alertmanager.yml
route:
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'team-notification'

receivers:
  - name: 'team-notification'
    webhook_configs:
      - url: 'http://alertmanager-webhook/send'
    email_configs:
      - to: 'ops-team@company.com'
        from: 'alertmanager@company.com'
```

**ğŸ’¡ å‘Šè­¦ç­–ç•¥å»ºè®®**ï¼š
```
å‘Šè­¦çº§åˆ«åˆ’åˆ†ï¼š
ğŸŸ¢ Infoï¼šä¿¡æ¯é€šçŸ¥ï¼Œæ— éœ€ç«‹å³å¤„ç†
ğŸŸ¡ Warningï¼šè­¦å‘Šï¼Œéœ€è¦å…³æ³¨
ğŸ”´ Criticalï¼šä¸¥é‡ï¼Œç«‹å³å¤„ç†
ğŸ’€ Emergencyï¼šç´§æ€¥ï¼Œå…¨å‘˜å“åº”

é€šçŸ¥æ–¹å¼é€‰æ‹©ï¼š
å¼€å‘ç¯å¢ƒï¼šé’‰é’‰/ä¼ä¸šå¾®ä¿¡æœºå™¨äºº
æµ‹è¯•ç¯å¢ƒï¼šé‚®ä»¶é€šçŸ¥
ç”Ÿäº§ç¯å¢ƒï¼šçŸ­ä¿¡ + ç”µè¯ + å·¥å•ç³»ç»Ÿ

é¿å…å‘Šè­¦ç–²åŠ³ï¼š
- è®¾ç½®åˆç†çš„é˜ˆå€¼
- é¿å…é‡å¤å‘Šè­¦
- åˆ†çº§åˆ†ç»„é€šçŸ¥
- å®šæœŸè¯„å®¡å‘Šè­¦è§„åˆ™
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Actuatoræœ¬è´¨ï¼šç”Ÿäº§çº§ç›‘æ§å·¥å…·ï¼Œç»™å¾®æœåŠ¡è£…ä¸Š"ä½“æ£€è®¾å¤‡"
ğŸ”¸ æ ¸å¿ƒç«¯ç‚¹ä½œç”¨ï¼š
   - Healthï¼šå¥åº·æ£€æŸ¥ï¼Œåˆ¤æ–­æœåŠ¡æ˜¯å¦æ­£å¸¸
   - Gatewayï¼šè·¯ç”±ä¿¡æ¯ï¼ŒæŸ¥çœ‹é…ç½®å’ŒåŠ¨æ€åˆ·æ–°
   - Metricsï¼šæ€§èƒ½æŒ‡æ ‡ï¼Œç›‘æ§å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨
   - è‡ªå®šä¹‰ç«¯ç‚¹ï¼šæš´éœ²ä¸šåŠ¡ç‰¹å®šçš„ç›‘æ§æ•°æ®

ğŸ”¸ JVMç›‘æ§è¦ç‚¹ï¼š
   - å†…å­˜ï¼šå…³æ³¨å †å†…å­˜ä½¿ç”¨ç‡ï¼Œ>85%éœ€å‘Šè­¦
   - GCï¼šå…³æ³¨é¢‘ç‡å’Œåœé¡¿æ—¶é—´ï¼ŒFull GCé¢‘ç¹æ˜¯å±é™©ä¿¡å·
   - çº¿ç¨‹ï¼šç›‘æ§æ•°é‡å˜åŒ–ï¼ŒæŒç»­å¢é•¿å¯èƒ½æ³„æ¼

ğŸ”¸ æ•°æ®å¯¼å‡ºä»·å€¼ï¼š
   - Prometheusé‡‡é›† â†’ æŒä¹…åŒ–å­˜å‚¨
   - Grafanaå±•ç¤º â†’ å¯è§†åŒ–åˆ†æ
   - AlertManagerå‘Šè­¦ â†’ åŠæ—¶å‘ç°é—®é¢˜
```

### 8.2 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¼€å‘ç¯å¢ƒé…ç½®**
```yaml
# å¼€å‘ç¯å¢ƒï¼šå®Œå…¨å¼€æ”¾ï¼Œä¾¿äºè°ƒè¯•
management:
  endpoints:
    web:
      exposure:
        include: '*'  # æ‰€æœ‰ç«¯ç‚¹
  endpoint:
    health:
      show-details: always
```

**ğŸ¯ ç”Ÿäº§ç¯å¢ƒé…ç½®**
```yaml
# ç”Ÿäº§ç¯å¢ƒï¼šå®‰å…¨ä¼˜å…ˆ
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus  # ä»…å¿…è¦ç«¯ç‚¹
      base-path: /manage  # ä¿®æ”¹é»˜è®¤è·¯å¾„
  endpoint:
    health:
      show-details: when-authorized  # éœ€è¦æˆæƒ
  server:
    port: 8081  # ç‹¬ç«‹ç«¯å£ï¼Œä¾¿äºé˜²ç«å¢™é…ç½®
```

### 8.3 ç›‘æ§æœ€ä½³å®è·µ


**ğŸ“Š å…³é”®æŒ‡æ ‡ç›‘æ§æ¸…å•**

| ç›‘æ§ç±»å‹ | **å…³é”®æŒ‡æ ‡** | **å‘Šè­¦é˜ˆå€¼** | **æ£€æŸ¥é¢‘ç‡** |
|---------|------------|------------|------------|
| ğŸ¥ **å¥åº·æ£€æŸ¥** | `æœåŠ¡çŠ¶æ€` | `DOWNæ—¶å‘Šè­¦` | `30ç§’` |
| ğŸ’¾ **å†…å­˜** | `å †å†…å­˜ä½¿ç”¨ç‡` | `>85%` | `1åˆ†é’Ÿ` |
| ğŸ”„ **GC** | `Full GCé¢‘ç‡` | `>10æ¬¡/å°æ—¶` | `5åˆ†é’Ÿ` |
| ğŸŒ **è¯·æ±‚** | `å“åº”æ—¶é—´P99` | `>1000ms` | `1åˆ†é’Ÿ` |
| âŒ **é”™è¯¯ç‡** | `5xxé”™è¯¯ç‡` | `>5%` | `1åˆ†é’Ÿ` |
| ğŸ”Œ **çº¿ç¨‹** | `æ´»è·ƒçº¿ç¨‹æ•°` | `>200` | `1åˆ†é’Ÿ` |

**ğŸ”§ é—®é¢˜æ’æŸ¥æ­¥éª¤**
```
å‘ç°é—®é¢˜ â†’ æŸ¥çœ‹Healthç«¯ç‚¹ â†’ å®šä½å¼‚å¸¸ç»„ä»¶
    â†“
æŸ¥çœ‹Metrics â†’ åˆ†ææ€§èƒ½æŒ‡æ ‡ â†’ æ‰¾å‡ºç“¶é¢ˆç‚¹
    â†“
æ£€æŸ¥JVM â†’ å†…å­˜/GC/çº¿ç¨‹ â†’ è¯Šæ–­æ ¹æœ¬åŸå› 
    â†“
æŸ¥çœ‹æ—¥å¿— â†’ ç»“åˆä¸šåŠ¡é€»è¾‘ â†’ ç¡®å®šè§£å†³æ–¹æ¡ˆ
```

### 8.4 å­¦ä¹ æ£€æŸ¥ç‚¹


```
âœ… **åŸºç¡€æŒæ¡**ï¼š
- [ ] èƒ½é…ç½®å¹¶å¼€æ”¾Actuatorç«¯ç‚¹
- [ ] èƒ½è§£é‡ŠHealthã€Metricsã€Gatewayç«¯ç‚¹çš„ä½œç”¨
- [ ] èƒ½æŸ¥çœ‹å’Œç†è§£JVMåŸºæœ¬æŒ‡æ ‡

âœ… **è¿›é˜¶ç†è§£**ï¼š
- [ ] èƒ½åˆ›å»ºè‡ªå®šä¹‰å¥åº·æ£€æŸ¥æŒ‡æ ‡
- [ ] èƒ½å®ç°è‡ªå®šä¹‰ç›‘æ§ç«¯ç‚¹
- [ ] èƒ½é…ç½®ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡

âœ… **å®æˆ˜åº”ç”¨**ï¼š
- [ ] èƒ½é…ç½®Prometheusæ•°æ®å¯¼å‡º
- [ ] èƒ½è®¾è®¡Grafanaç›‘æ§é¢æ¿
- [ ] èƒ½ç¼–å†™å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥é…ç½®
```

**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
Actuatorç›‘æ§æœ‰å¦™æ‹›ï¼Œ
Healthæ£€æŸ¥æœåŠ¡å¥½ä¸å¥½ï¼Œ
Gatewayè·¯ç”±é…ç½®ç§ï¼Œ
MetricsæŒ‡æ ‡æ€§èƒ½è¡¨ï¼Œ
JVMå†…å­˜GCè¦è®°ç‰¢ï¼Œ
å¯¼å‡ºæ•°æ®PrometheusæŠ¥ï¼Œ
Grafanaé¢æ¿ä¸€ç›®äº†ï¼Œ
å‘Šè­¦è§„åˆ™ä¿éšœé«˜ï¼
```

**æ ¸å¿ƒç†è§£**ï¼š
- Actuatorä¸åªæ˜¯æŸ¥çœ‹æ•°æ®ï¼Œæ›´é‡è¦çš„æ˜¯**é¢„é˜²é—®é¢˜**
- ç›‘æ§æŒ‡æ ‡ä¸æ±‚å¤šï¼Œè€Œè¦**ç²¾å‡†æœ‰æ•ˆ**
- å‘Šè­¦è§„åˆ™è¦**åˆç†è®¾ç½®**ï¼Œé¿å…å‘Šè­¦ç–²åŠ³
- ç›‘æ§æ˜¯æ‰‹æ®µï¼Œ**ä¿éšœä¸šåŠ¡ç¨³å®š**æ‰æ˜¯ç›®çš„