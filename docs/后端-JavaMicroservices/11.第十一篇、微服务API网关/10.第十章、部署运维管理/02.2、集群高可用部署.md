---
title: 2ã€é›†ç¾¤é«˜å¯ç”¨éƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [é«˜å¯ç”¨æ¶æ„è®¾è®¡](#1-é«˜å¯ç”¨æ¶æ„è®¾è®¡)
2. [ä¸»å¤‡åˆ‡æ¢æœºåˆ¶](#2-ä¸»å¤‡åˆ‡æ¢æœºåˆ¶)
3. [è´Ÿè½½å‡è¡¡é…ç½®](#3-è´Ÿè½½å‡è¡¡é…ç½®)
4. [æ•…éšœè½¬ç§»ç­–ç•¥](#4-æ•…éšœè½¬ç§»ç­–ç•¥)
5. [æ•°æ®ä¸€è‡´æ€§ä¿è¯](#5-æ•°æ®ä¸€è‡´æ€§ä¿è¯)
6. [é…ç½®åŒæ­¥æœºåˆ¶](#6-é…ç½®åŒæ­¥æœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ é«˜å¯ç”¨æ¶æ„è®¾è®¡


### 1.1 ä»€ä¹ˆæ˜¯é«˜å¯ç”¨


**é€šä¿—ç†è§£ï¼š**
é«˜å¯ç”¨å°±åƒä¸€å®¶24å°æ—¶ä¾¿åˆ©åº—ï¼Œå³ä½¿æŸä¸ªåº—å‘˜è¯·å‡äº†ï¼Œå…¶ä»–åº—å‘˜ä¹Ÿèƒ½é¡¶ä¸Šï¼Œä¿è¯å•†åº—å§‹ç»ˆè¥ä¸šã€‚å¯¹äºAPIç½‘å…³æ¥è¯´ï¼Œå°±æ˜¯ä¿è¯æœåŠ¡æ°¸è¿œåœ¨çº¿ï¼Œä¸ä¼šå› ä¸ºæŸå°æœåŠ¡å™¨å‡ºé—®é¢˜å°±æ•´ä½“ç˜«ç—ªã€‚

**æ ¸å¿ƒç›®æ ‡ï¼š**
- **ä¸é—´æ–­æœåŠ¡** - ç”¨æˆ·éšæ—¶éƒ½èƒ½è®¿é—®
- **æ•…éšœè‡ªæ„ˆ** - å‡ºé—®é¢˜è‡ªåŠ¨æ¢å¤
- **æ€§èƒ½ç¨³å®š** - è®¿é—®é€Ÿåº¦å§‹ç»ˆå¦‚ä¸€
- **å®¹é‡å¯æ‰©å±•** - æµé‡å¢åŠ æ—¶èƒ½è‡ªåŠ¨åº”å¯¹

### 1.2 é«˜å¯ç”¨æ¶æ„æ¨¡å¼


#### ğŸ“Š æ¶æ„æ¼”è¿›å¯¹æ¯”


| æ¶æ„æ¨¡å¼ | å¯ç”¨æ€§ | å¤æ‚åº¦ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|------|----------|
| **å•æœºéƒ¨ç½²** | 99% | ä½ | ä½ | æµ‹è¯•ç¯å¢ƒ |
| **ä¸»å¤‡æ¨¡å¼** | 99.9% | ä¸­ | ä¸­ | ä¸­å°ä¼ä¸š |
| **é›†ç¾¤æ¨¡å¼** | 99.99% | é«˜ | é«˜ | å¤§å‹ä¼ä¸š |

#### ğŸ¯ é›†ç¾¤æ¶æ„ç¤ºæ„å›¾


```
                    å¤–éƒ¨ç”¨æˆ·è¯·æ±‚
                         â†“
                  [è´Ÿè½½å‡è¡¡å™¨ LB]
                    /    |    \
                   /     |     \
                  â†“      â†“      â†“
            [ç½‘å…³èŠ‚ç‚¹1] [ç½‘å…³èŠ‚ç‚¹2] [ç½‘å…³èŠ‚ç‚¹3]
                  \      |      /
                   \     |     /
                    \    |    /
                  [é…ç½®ä¸­å¿ƒé›†ç¾¤]
                         â†“
                  [åç«¯æœåŠ¡é›†ç¾¤]
```

**å…³é”®ç‰¹ç‚¹ï¼š**
- **å¤šèŠ‚ç‚¹éƒ¨ç½²** - è‡³å°‘3ä¸ªç½‘å…³èŠ‚ç‚¹ï¼ˆå¥‡æ•°ä¸ªä¾¿äºé€‰ä¸¾ï¼‰
- **æ— å•ç‚¹æ•…éšœ** - ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰éƒ½ä¸å½±å“æ•´ä½“
- **è´Ÿè½½åˆ†æ•£** - æµé‡å‡åŒ€åˆ†é…åˆ°å„èŠ‚ç‚¹
- **é…ç½®ç»Ÿä¸€** - æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¿æŒåŒæ­¥

### 1.3 éƒ¨ç½²æ‹“æ‰‘æ–¹æ¡ˆ


#### ğŸ”¸ åŒæœºæˆ¿é›†ç¾¤éƒ¨ç½²


```
æœºæˆ¿A
â”œâ”€â”€ è´Ÿè½½å‡è¡¡å™¨ï¼ˆä¸»ï¼‰
â”œâ”€â”€ ç½‘å…³èŠ‚ç‚¹1ï¼ˆä¸»ï¼‰
â”œâ”€â”€ ç½‘å…³èŠ‚ç‚¹2ï¼ˆå¤‡ï¼‰
â””â”€â”€ ç½‘å…³èŠ‚ç‚¹3ï¼ˆå¤‡ï¼‰
```

**é€‚ç”¨åœºæ™¯ï¼š** å•ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæˆæœ¬æ•æ„Ÿå‹ä¼ä¸š

**ä¼˜ç‚¹ï¼š**
- ç½‘ç»œå»¶è¿Ÿä½
- é…ç½®ç®¡ç†ç®€å•
- æˆæœ¬ç›¸å¯¹è¾ƒä½

**ç¼ºç‚¹ï¼š**
- æœºæˆ¿çº§åˆ«æ•…éšœé£é™©
- æ— æ³•åº”å¯¹åŒºåŸŸæ€§ç¾éš¾

#### ğŸ”¸ åŒæœºæˆ¿å®¹ç¾éƒ¨ç½²


```
æœºæˆ¿Aï¼ˆä¸»ï¼‰                    æœºæˆ¿Bï¼ˆå¤‡ï¼‰
â”œâ”€â”€ è´Ÿè½½å‡è¡¡å™¨                 â”œâ”€â”€ è´Ÿè½½å‡è¡¡å™¨
â”œâ”€â”€ ç½‘å…³èŠ‚ç‚¹1                  â”œâ”€â”€ ç½‘å…³èŠ‚ç‚¹4
â”œâ”€â”€ ç½‘å…³èŠ‚ç‚¹2                  â””â”€â”€ ç½‘å…³èŠ‚ç‚¹5
â””â”€â”€ ç½‘å…³èŠ‚ç‚¹3
         â†•ï¼ˆæ•°æ®åŒæ­¥ï¼‰â†•
```

**é€‚ç”¨åœºæ™¯ï¼š** é‡‘èã€ç”µå•†ç­‰å¯¹å¯ç”¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯

**æ ¸å¿ƒæœºåˆ¶ï¼š**
- **ä¸»æœºæˆ¿** - æ‰¿è½½ä¸»è¦æµé‡
- **å¤‡æœºæˆ¿** - ç¾å¤‡åˆ‡æ¢ï¼Œå¹³æ—¶å¯åˆ†æ‹…éƒ¨åˆ†æµé‡
- **æ•°æ®åŒæ­¥** - å®æ—¶æˆ–å‡†å®æ—¶åŒæ­¥é…ç½®æ•°æ®
- **DNSåˆ‡æ¢** - æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡æœºæˆ¿

#### ğŸ”¸ å¤šåœ°åŸŸåˆ†å¸ƒå¼éƒ¨ç½²


```
å…¨å±€è´Ÿè½½å‡è¡¡ï¼ˆGSLBï¼‰
    â†“
ååŒ—æœºæˆ¿ â† â†’ åä¸œæœºæˆ¿ â† â†’ åå—æœºæˆ¿
   â†“           â†“           â†“
ç½‘å…³é›†ç¾¤    ç½‘å…³é›†ç¾¤    ç½‘å…³é›†ç¾¤
```

**é€‚ç”¨åœºæ™¯ï¼š** å…¨å›½æˆ–å…¨çƒä¸šåŠ¡ï¼Œè¶…å¤§è§„æ¨¡ä¼ä¸š

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- **å°±è¿‘æ¥å…¥** - ç”¨æˆ·è®¿é—®æœ€è¿‘çš„èŠ‚ç‚¹
- **å¼‚åœ°å®¹ç¾** - å¤šåœ°äº’å¤‡ï¼Œå®‰å…¨æ€§æœ€é«˜
- **è´Ÿè½½åˆ†æ•£** - å…¨å±€æµé‡æ™ºèƒ½åˆ†é…

---

## 2. ğŸ”„ ä¸»å¤‡åˆ‡æ¢æœºåˆ¶


### 2.1 ä¸»å¤‡åˆ‡æ¢æ˜¯ä»€ä¹ˆ


**ç”Ÿæ´»ç±»æ¯”ï¼š**
å°±åƒå…¬å¸çš„ä¸¤ä¸ªç»ç†ï¼Œå¹³æ—¶ä¸»ç»ç†è´Ÿè´£å†³ç­–ï¼Œå‰¯ç»ç†å­¦ä¹ è§‚å¯Ÿã€‚å¦‚æœä¸»ç»ç†çªç„¶ç”Ÿç—…äº†ï¼Œå‰¯ç»ç†ç«‹å³æ¥ç®¡å·¥ä½œï¼Œä¿è¯å…¬å¸æ­£å¸¸è¿è½¬ã€‚

**æŠ€æœ¯å®šä¹‰ï¼š**
ä¸»å¤‡åˆ‡æ¢æ˜¯æŒ‡å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¤‡ç”¨èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡æœåŠ¡çš„è¿‡ç¨‹ï¼Œç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§ã€‚

### 2.2 ä¸»å¤‡æ¨¡å¼ç±»å‹


#### ğŸ“‹ ä¸»å¤‡æ¨¡å¼å¯¹æ¯”


| æ¨¡å¼ç±»å‹ | å·¥ä½œæ–¹å¼ | åˆ‡æ¢é€Ÿåº¦ | èµ„æºåˆ©ç”¨ç‡ | æ¨èåœºæ™¯ |
|---------|---------|---------|-----------|----------|
| **ä¸»å¤‡çƒ­å¤‡** | ä¸»å¤‡åŒæ—¶è¿è¡Œï¼Œå¤‡ç”¨èŠ‚ç‚¹éšæ—¶å¾…å‘½ | ç§’çº§ | 50% | é‡‘èæ”¯ä»˜ |
| **ä¸»å¤‡æ¸©å¤‡** | å¤‡ç”¨èŠ‚ç‚¹å®šæœŸåŒæ­¥ï¼Œæ•…éšœæ—¶å¯åŠ¨ | åˆ†é’Ÿçº§ | 80% | ä¼ä¸šåº”ç”¨ |
| **ä¸»å¤‡å†·å¤‡** | å¤‡ç”¨èŠ‚ç‚¹ä¸è¿è¡Œï¼Œéœ€æ‰‹åŠ¨å¯åŠ¨ | å°æ—¶çº§ | 90% | æµ‹è¯•ç¯å¢ƒ |

#### ğŸ”¥ çƒ­å¤‡æ¨¡å¼è¯¦è§£


```
æ­£å¸¸çŠ¶æ€ï¼š
ä¸»èŠ‚ç‚¹ï¼ˆActiveï¼‰ â”€â”€å¤„ç†è¯·æ±‚â”€â”€> ç”¨æˆ·
   â†“ï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰
å¤‡èŠ‚ç‚¹ï¼ˆStandbyï¼‰ â”€â”€å¾…å‘½â”€â”€

æ•…éšœçŠ¶æ€ï¼š
ä¸»èŠ‚ç‚¹ï¼ˆDownï¼‰ âœ— 
   â†“ï¼ˆå¿ƒè·³ä¸­æ–­ï¼‰
å¤‡èŠ‚ç‚¹ï¼ˆActiveï¼‰ â”€â”€æ¥ç®¡æœåŠ¡â”€â”€> ç”¨æˆ·
```

**çƒ­å¤‡é…ç½®ç¤ºä¾‹ï¼ˆSpring Cloud Gatewayï¼‰ï¼š**

```yaml
spring:
  cloud:
    gateway:
#      # é«˜å¯ç”¨é…ç½®
      discovery:
        locator:
          enabled: true
#      # å¥åº·æ£€æŸ¥
      health:
        enabled: true
#      # ä¸»å¤‡æ ‡è¯†
      instance:
        metadata-map:
          role: master  # æˆ– backup
```

### 2.3 å¿ƒè·³æ£€æµ‹æœºåˆ¶


**ä»€ä¹ˆæ˜¯å¿ƒè·³ï¼Ÿ**
å¿ƒè·³å°±åƒäººçš„è„‰æï¼Œå®šæœŸå‘é€"æˆ‘è¿˜æ´»ç€"çš„ä¿¡å·ã€‚å¦‚æœä¸€æ®µæ—¶é—´æ”¶ä¸åˆ°å¿ƒè·³ï¼Œå°±è®¤ä¸ºèŠ‚ç‚¹å·²ç»æŒ‚äº†ã€‚

**å¿ƒè·³æ£€æµ‹æµç¨‹ï¼š**

```
å¤‡èŠ‚ç‚¹                  ä¸»èŠ‚ç‚¹
  |                      |
  |----[å¿ƒè·³è¯·æ±‚]-------->|
  |<---[å¿ƒè·³å“åº”]---------|
  |                      |
  |----[å¿ƒè·³è¯·æ±‚]-------->| 
  |        âœ—             | (æ— å“åº”)
  |                      |
  |----[å¿ƒè·³è¯·æ±‚]-------->|
  |        âœ—             | (æ— å“åº”)
  |                      |
[åˆ¤å®šæ•…éšœï¼Œæ‰§è¡Œåˆ‡æ¢]
```

**é…ç½®å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | å«ä¹‰ | æ¨èå€¼ | è¯´æ˜ |
|-----|------|--------|------|
| `heartbeat-interval` | å¿ƒè·³é—´éš” | 1-3ç§’ | å¤ªçŸ­å¢åŠ ç½‘ç»œè´Ÿæ‹…ï¼Œå¤ªé•¿å»¶è¿Ÿå‘ç°æ•…éšœ |
| `timeout` | è¶…æ—¶æ—¶é—´ | 5-10ç§’ | è¶…è¿‡æ­¤æ—¶é—´æ— å“åº”åˆ¤å®šæ•…éšœ |
| `retry-count` | é‡è¯•æ¬¡æ•° | 3æ¬¡ | é¿å…ç½‘ç»œæŠ–åŠ¨è¯¯åˆ¤ |

### 2.4 åˆ‡æ¢ç­–ç•¥


#### ğŸ”¸ è‡ªåŠ¨åˆ‡æ¢


```java
// ä¼ªä»£ç ç¤ºä¾‹ï¼šè‡ªåŠ¨åˆ‡æ¢é€»è¾‘
public class FailoverManager {
    
    // æ£€æµ‹ä¸»èŠ‚ç‚¹å¥åº·çŠ¶æ€
    public void checkMasterHealth() {
        if (!heartbeat.isAlive(masterNode)) {
            // è¿ç»­3æ¬¡å¿ƒè·³å¤±è´¥
            if (failureCount >= 3) {
                // è§¦å‘åˆ‡æ¢
                switchToBackup();
            }
        }
    }
    
    // æ‰§è¡Œåˆ‡æ¢
    private void switchToBackup() {
        // 1. åœæ­¢å‘ä¸»èŠ‚ç‚¹è½¬å‘æµé‡
        loadBalancer.removeNode(masterNode);
        
        // 2. æ¿€æ´»å¤‡ç”¨èŠ‚ç‚¹
        backupNode.activate();
        
        // 3. æ›´æ–°è·¯ç”±è§„åˆ™
        updateRoutes(backupNode);
        
        // 4. é€šçŸ¥ç›‘æ§å‘Šè­¦
        notifyAlert("ä¸»èŠ‚ç‚¹æ•…éšœï¼Œå·²åˆ‡æ¢è‡³å¤‡ç”¨èŠ‚ç‚¹");
    }
}
```

#### ğŸ”¸ æ‰‹åŠ¨åˆ‡æ¢


**é€‚ç”¨åœºæ™¯ï¼š**
- è®¡åˆ’å†…ç»´æŠ¤å‡çº§
- æœºæˆ¿è¿ç§»
- æ€§èƒ½è°ƒä¼˜æµ‹è¯•

**æ“ä½œæ­¥éª¤ï¼š**
1. é€šçŸ¥ç”¨æˆ·ç»´æŠ¤çª—å£
2. é€æ­¥å‡å°‘ä¸»èŠ‚ç‚¹æµé‡
3. ç­‰å¾…å½“å‰è¯·æ±‚å¤„ç†å®Œæˆ
4. åˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹
5. éªŒè¯æœåŠ¡æ­£å¸¸
6. å®Œæˆåˆ‡æ¢

---

## 3. âš–ï¸ è´Ÿè½½å‡è¡¡é…ç½®


### 3.1 è´Ÿè½½å‡è¡¡ä½œç”¨


**é€šä¿—ç†è§£ï¼š**
è´Ÿè½½å‡è¡¡å°±åƒè¶…å¸‚çš„å¤šä¸ªæ”¶é“¶å°ï¼Œé¡¾å®¢ï¼ˆè¯·æ±‚ï¼‰ä¼šè¢«å¼•å¯¼åˆ°äººå°‘çš„æ”¶é“¶å°ï¼ˆç©ºé—²çš„æœåŠ¡å™¨ï¼‰ï¼Œé¿å…æŸä¸ªæ”¶é“¶å°æ’é•¿é˜Ÿï¼Œå…¶ä»–æ”¶é“¶å°å´ç©ºç€ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- **æµé‡åˆ†æ•£** - é¿å…å•ç‚¹è¿‡è½½
- **æå‡æ€§èƒ½** - å……åˆ†åˆ©ç”¨æ‰€æœ‰èµ„æº
- **æ•…éšœéš”ç¦»** - é—®é¢˜èŠ‚ç‚¹è‡ªåŠ¨å‰”é™¤
- **å¼¹æ€§æ‰©å±•** - è½»æ¾å¢å‡èŠ‚ç‚¹

### 3.2 è´Ÿè½½å‡è¡¡ç®—æ³•


#### ğŸ“Š å¸¸ç”¨ç®—æ³•å¯¹æ¯”


| ç®—æ³• | åŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|------|------|----------|
| **è½®è¯¢ï¼ˆRound Robinï¼‰** | ä¾æ¬¡åˆ†é…è¯·æ±‚ | ç®€å•å…¬å¹³ | ä¸è€ƒè™‘è´Ÿè½½å·®å¼‚ | èŠ‚ç‚¹æ€§èƒ½ç›¸è¿‘ |
| **åŠ æƒè½®è¯¢** | æŒ‰æƒé‡åˆ†é… | è€ƒè™‘èŠ‚ç‚¹èƒ½åŠ› | é…ç½®ç›¸å¯¹å¤æ‚ | èŠ‚ç‚¹æ€§èƒ½ä¸åŒ |
| **æœ€å°‘è¿æ¥** | é€‰æ‹©è¿æ¥æ•°æœ€å°‘çš„ | è´Ÿè½½æ›´å‡è¡¡ | éœ€ç»´æŠ¤è¿æ¥çŠ¶æ€ | é•¿è¿æ¥åœºæ™¯ |
| **IPå“ˆå¸Œ** | æ ¹æ®IPè®¡ç®—ç›®æ ‡ | ä¼šè¯ä¿æŒ | å¯èƒ½åˆ†å¸ƒä¸å‡ | éœ€è¦ä¼šè¯äº²å’Œæ€§ |
| **éšæœº** | éšæœºé€‰æ‹©èŠ‚ç‚¹ | å®ç°ç®€å• | çŸ­æœŸå¯èƒ½ä¸å‡ | æ— çŠ¶æ€æœåŠ¡ |

#### ğŸ”¸ è½®è¯¢ç®—æ³•ç¤ºæ„


```
è¯·æ±‚åºåˆ—ï¼šR1, R2, R3, R4, R5, R6...

èŠ‚ç‚¹1 â† R1, R4 â† å¤„ç†2ä¸ªè¯·æ±‚
èŠ‚ç‚¹2 â† R2, R5 â† å¤„ç†2ä¸ªè¯·æ±‚  
èŠ‚ç‚¹3 â† R3, R6 â† å¤„ç†2ä¸ªè¯·æ±‚

ç»“æœï¼šæµé‡å‡åŒ€åˆ†é…
```

#### ğŸ”¸ åŠ æƒè½®è¯¢ç¤ºä¾‹


```
é…ç½®æƒé‡ï¼š
èŠ‚ç‚¹1: weight=3 (é«˜æ€§èƒ½æœåŠ¡å™¨)
èŠ‚ç‚¹2: weight=2 (ä¸­ç­‰æ€§èƒ½)
èŠ‚ç‚¹3: weight=1 (ä½æ€§èƒ½æœåŠ¡å™¨)

åˆ†é…ç»“æœï¼š
6ä¸ªè¯·æ±‚ä¸­ï¼ŒèŠ‚ç‚¹1å¤„ç†3ä¸ªï¼ŒèŠ‚ç‚¹2å¤„ç†2ä¸ªï¼ŒèŠ‚ç‚¹3å¤„ç†1ä¸ª
```

### 3.3 Nginxè´Ÿè½½å‡è¡¡é…ç½®


**é…ç½®ç¤ºä¾‹ï¼š**

```nginx
# å®šä¹‰ä¸Šæ¸¸ç½‘å…³é›†ç¾¤

upstream gateway_cluster {
#    # æœ€å°‘è¿æ¥ç®—æ³•
    least_conn;
    
#    # ç½‘å…³èŠ‚ç‚¹åˆ—è¡¨
    server 192.168.1.10:8080 weight=3 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 weight=2 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:8080 weight=1 max_fails=3 fail_timeout=30s backup;
    
#    # å¥åº·æ£€æŸ¥
    keepalive 32;
}

server {
    listen 80;
    server_name api.example.com;
    
    location / {
#        # ä»£ç†åˆ°ç½‘å…³é›†ç¾¤
        proxy_pass http://gateway_cluster;
        
#        # ä¼ é€’å®¢æˆ·ç«¯çœŸå®IP
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
#        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
}
```

**é…ç½®è¯´æ˜ï¼š**
- `weight` - æƒé‡å€¼ï¼Œæ•°å­—è¶Šå¤§åˆ†é…è¶Šå¤šæµé‡
- `max_fails` - æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œè¶…è¿‡åæš‚æ—¶å‰”é™¤èŠ‚ç‚¹
- `fail_timeout` - å¤±è´¥è¶…æ—¶æ—¶é—´ï¼Œ30ç§’å†…å¤±è´¥3æ¬¡åˆ™å‰”é™¤
- `backup` - å¤‡ç”¨èŠ‚ç‚¹ï¼Œåªæœ‰å…¶ä»–èŠ‚ç‚¹éƒ½ä¸å¯ç”¨æ—¶æ‰å¯ç”¨

### 3.4 Spring Cloud Gatewayè´Ÿè½½å‡è¡¡


```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://USER-SERVICE  # lbè¡¨ç¤ºä½¿ç”¨è´Ÿè½½å‡è¡¡
          predicates:
            - Path=/user/**
            
#    # è´Ÿè½½å‡è¡¡é…ç½®
    loadbalancer:
      ribbon:
        enabled: false  # ç¦ç”¨Ribbon
#      # ä½¿ç”¨Spring Cloud LoadBalancer
      configurations: default
      
# è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥

user-service:
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule
```

**è´Ÿè½½å‡è¡¡ç­–ç•¥Javaé…ç½®ï¼š**

```java
@Configuration
public class LoadBalancerConfig {
    
    // è‡ªå®šä¹‰è½®è¯¢ç­–ç•¥
    @Bean
    public ReactorLoadBalancer<ServiceInstance> randomLoadBalancer(
            Environment environment,
            LoadBalancerClientFactory factory) {
        
        String name = environment.getProperty(
            LoadBalancerClientFactory.PROPERTY_NAME);
            
        return new RoundRobinLoadBalancer(
            factory.getLazyProvider(name, ServiceInstanceListSupplier.class),
            name);
    }
}
```

---

## 4. ğŸš¨ æ•…éšœè½¬ç§»ç­–ç•¥


### 4.1 æ•…éšœè½¬ç§»æ¦‚å¿µ


**é€šä¿—è§£é‡Šï¼š**
æ•…éšœè½¬ç§»å°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„åº”æ€¥è½¦é“ï¼Œä¸»è½¦é“å µè½¦æˆ–å‡ºäº‹æ•…æ—¶ï¼Œè½¦è¾†å¯ä»¥ä¸´æ—¶åˆ‡æ¢åˆ°åº”æ€¥è½¦é“é€šè¡Œï¼Œä¿è¯äº¤é€šä¸ä¼šå®Œå…¨ä¸­æ–­ã€‚

**æ ¸å¿ƒæœºåˆ¶ï¼š**
- **æ•…éšœæ£€æµ‹** - å¿«é€Ÿå‘ç°é—®é¢˜
- **æµé‡åˆ‡æ¢** - è½¬ç§»åˆ°å¥åº·èŠ‚ç‚¹
- **çŠ¶æ€æ¢å¤** - é—®é¢˜è§£å†³åæ¢å¤æ­£å¸¸
- **é€šçŸ¥å‘Šè­¦** - åŠæ—¶é€šçŸ¥è¿ç»´äººå‘˜

### 4.2 æ•…éšœæ£€æµ‹æ–¹å¼


#### ğŸ“‹ æ£€æµ‹æ–¹å¼å¯¹æ¯”


| æ£€æµ‹æ–¹å¼ | åŸç† | æ£€æµ‹é€Ÿåº¦ | å‡†ç¡®æ€§ | å®ç°å¤æ‚åº¦ |
|---------|------|---------|--------|-----------|
| **å¿ƒè·³æ£€æµ‹** | å®šæœŸå‘é€å¿ƒè·³åŒ… | ç§’çº§ | é«˜ | ä½ |
| **å¥åº·æ£€æŸ¥** | è°ƒç”¨å¥åº·æ£€æŸ¥æ¥å£ | ç§’çº§ | é«˜ | ä¸­ |
| **è¯·æ±‚ç›‘æ§** | åˆ†æè¯·æ±‚æˆåŠŸç‡ | åˆ†é’Ÿçº§ | ä¸­ | é«˜ |
| **æ—¥å¿—åˆ†æ** | åˆ†æé”™è¯¯æ—¥å¿— | åˆ†é’Ÿçº§ | ä½ | é«˜ |

#### ğŸ”¸ å¥åº·æ£€æŸ¥æ¥å£


```java
@RestController
public class HealthController {
    
    @Autowired
    private ServiceStatusChecker checker;
    
    // å¥åº·æ£€æŸ¥ç«¯ç‚¹
    @GetMapping("/actuator/health")
    public HealthStatus checkHealth() {
        HealthStatus status = new HealthStatus();
        
        // æ£€æŸ¥æ ¸å¿ƒç»„ä»¶
        status.setDatabase(checker.checkDatabase());
        status.setRedis(checker.checkRedis());
        status.setConfigCenter(checker.checkConfigCenter());
        
        // æ•´ä½“çŠ¶æ€
        status.setOverall(
            status.isAllHealthy() ? "UP" : "DOWN"
        );
        
        return status;
    }
}
```

**æ£€æŸ¥é¡¹ç›®æ¸…å•ï¼š**
- âœ… æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
- âœ… ç¼“å­˜æœåŠ¡æ˜¯å¦å¯ç”¨
- âœ… é…ç½®ä¸­å¿ƒæ˜¯å¦è¿é€š
- âœ… ä¾èµ–æœåŠ¡æ˜¯å¦å“åº”
- âœ… ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰

### 4.3 æ•…éšœè½¬ç§»æµç¨‹


#### ğŸ”„ è‡ªåŠ¨è½¬ç§»æµç¨‹


```
[æ•…éšœæ£€æµ‹]
    â†“
[ç¡®è®¤æ•…éšœ] (è¿ç»­3æ¬¡æ£€æµ‹å¤±è´¥)
    â†“
[æ ‡è®°èŠ‚ç‚¹Down]
    â†“
[ä»è´Ÿè½½å‡è¡¡æ± ç§»é™¤]
    â†“
[æµé‡è‡ªåŠ¨è½¬ç§»åˆ°å¥åº·èŠ‚ç‚¹]
    â†“
[å‘é€å‘Šè­¦é€šçŸ¥]
    â†“
[å®šæœŸé‡è¯•æ¢å¤] (æ¯30ç§’å°è¯•ä¸€æ¬¡)
    â†“
[èŠ‚ç‚¹æ¢å¤] â”€â”€> [é‡æ–°åŠ å…¥è´Ÿè½½å‡è¡¡æ± ]
```

**é…ç½®ç¤ºä¾‹ï¼š**

```yaml
spring:
  cloud:
    gateway:
#      # æ•…éšœè½¬ç§»é…ç½®
      httpclient:
#        # è¿æ¥è¶…æ—¶
        connect-timeout: 3000
#        # å“åº”è¶…æ—¶
        response-timeout: 5s
      
#      # é‡è¯•æœºåˆ¶
      retry:
        enabled: true
        retries: 3
#        # é‡è¯•é—´éš”
        backoff:
          firstBackoff: 10ms
          maxBackoff: 50ms
          factor: 2
```

### 4.4 é™çº§ä¸ç†”æ–­


#### ğŸ”¸ æœåŠ¡é™çº§


**ä»€ä¹ˆæ˜¯é™çº§ï¼Ÿ**
å°±åƒç½‘è´­å¤§ä¿ƒæ—¶ï¼Œä¸ºäº†ä¿è¯æ ¸å¿ƒè´­ä¹°åŠŸèƒ½ï¼Œæš‚æ—¶å…³é—­æ¨èã€è¯„è®ºç­‰éæ ¸å¿ƒåŠŸèƒ½ã€‚

**é™çº§ç­–ç•¥ï¼š**

```java
@Service
public class OrderService {
    
    @HystrixCommand(fallbackMethod = "orderFallback")
    public Order createOrder(OrderRequest request) {
        // æ­£å¸¸ä¸‹å•é€»è¾‘
        return orderClient.create(request);
    }
    
    // é™çº§æ–¹æ³•ï¼šè¿”å›å‹å¥½æç¤º
    public Order orderFallback(OrderRequest request) {
        Order order = new Order();
        order.setStatus("PENDING");
        order.setMessage("ç³»ç»Ÿç¹å¿™ï¼Œè®¢å•å·²æäº¤ï¼Œè¯·ç¨åæŸ¥çœ‹");
        return order;
    }
}
```

#### ğŸ”¸ ç†”æ–­æœºåˆ¶


**ç†”æ–­åŸç†ï¼š**
ç±»ä¼¼å®¶é‡Œçš„ä¿é™©ä¸ï¼Œå½“ç”µæµè¿‡å¤§æ—¶è‡ªåŠ¨æ–­ç”µä¿æŠ¤å…¶ä»–ç”µå™¨ã€‚

```
æ­£å¸¸çŠ¶æ€ (Closed)
    â†“
[é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼ 50%]
    â†“
ç†”æ–­çŠ¶æ€ (Open) - ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸è°ƒç”¨æœåŠ¡
    â†“
[ç­‰å¾…ä¸€æ®µæ—¶é—´]
    â†“
åŠå¼€çŠ¶æ€ (Half-Open) - å°è¯•éƒ¨åˆ†è¯·æ±‚
    â†“
[æˆåŠŸ] â”€â”€> æ¢å¤æ­£å¸¸
[å¤±è´¥] â”€â”€> ç»§ç»­ç†”æ–­
```

**ç†”æ–­é…ç½®ï¼š**

```yaml
hystrix:
  command:
    default:
      circuitBreaker:
#        # å¯ç”¨ç†”æ–­
        enabled: true
#        # è¯·æ±‚æ•°é‡é˜ˆå€¼
        requestVolumeThreshold: 20
#        # é”™è¯¯æ¯”ä¾‹é˜ˆå€¼
        errorThresholdPercentage: 50
#        # ç†”æ–­æŒç»­æ—¶é—´
        sleepWindowInMilliseconds: 10000
```

---

## 5. ğŸ” æ•°æ®ä¸€è‡´æ€§ä¿è¯


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®ä¸€è‡´æ€§


**é—®é¢˜åœºæ™¯ï¼š**
æƒ³è±¡ä¸€ä¸ªåœ¨çº¿å•†åŸï¼Œç”¨æˆ·åœ¨ç½‘å…³èŠ‚ç‚¹Açœ‹åˆ°å•†å“æœ‰è´§å¹¶ä¸‹å•ï¼Œä½†å®é™…åº“å­˜æ•°æ®åœ¨èŠ‚ç‚¹Bä¸Šå·²ç»å–å…‰äº†ã€‚è¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚

**ä¸€è‡´æ€§è¦æ±‚ï¼š**
- **é…ç½®ä¸€è‡´** - æ‰€æœ‰ç½‘å…³èŠ‚ç‚¹çš„è·¯ç”±è§„åˆ™ç›¸åŒ
- **çŠ¶æ€ä¸€è‡´** - é™æµè®¡æ•°ã€é»‘åå•ç­‰å®æ—¶åŒæ­¥
- **ç¼“å­˜ä¸€è‡´** - å„èŠ‚ç‚¹ç¼“å­˜æ•°æ®ä¿æŒåŒæ­¥

### 5.2 ä¸€è‡´æ€§çº§åˆ«


#### ğŸ“Š ä¸€è‡´æ€§å¼ºåº¦å¯¹æ¯”


| ä¸€è‡´æ€§çº§åˆ« | ç‰¹ç‚¹ | æ€§èƒ½ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|-----------|------|------|--------|----------|
| **å¼ºä¸€è‡´æ€§** | å®æ—¶åŒæ­¥ï¼Œæ•°æ®å®Œå…¨ä¸€è‡´ | ä½ | é«˜ | é‡‘èäº¤æ˜“ |
| **æœ€ç»ˆä¸€è‡´æ€§** | å…è®¸çŸ­æš‚ä¸ä¸€è‡´ï¼Œæœ€ç»ˆä¸€è‡´ | é«˜ | ä¸­ | ç¤¾äº¤è¯„è®º |
| **å¼±ä¸€è‡´æ€§** | ä¸ä¿è¯ä¸€è‡´æ€§ | æœ€é«˜ | ä½ | æ—¥å¿—ç»Ÿè®¡ |

### 5.3 é…ç½®æ•°æ®åŒæ­¥æ–¹æ¡ˆ


#### ğŸ”¸ æ–¹æ¡ˆ1ï¼šé…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†


```
Nacosé…ç½®ä¸­å¿ƒ
    â†“ (æ¨é€é…ç½®)
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚èŠ‚ç‚¹1â”‚èŠ‚ç‚¹2â”‚èŠ‚ç‚¹3â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€ï¿½
  (é…ç½®å®Œå…¨ä¸€è‡´)
```

**Nacosé…ç½®ç¤ºä¾‹ï¼š**

```yaml
# bootstrap.yml

spring:
  cloud:
    nacos:
      config:
#        # é…ç½®ä¸­å¿ƒåœ°å€
        server-addr: 127.0.0.1:8848
#        # é…ç½®æ–‡ä»¶
        file-extension: yaml
#        # åŠ¨æ€åˆ·æ–°
        refresh-enabled: true
        
#  # è‡ªåŠ¨åˆ·æ–°é…ç½®
  config:
    refresh:
      enabled: true
```

**åŠ¨æ€åˆ·æ–°é…ç½®ï¼š**

```java
@RestController
@RefreshScope  // æ”¯æŒåŠ¨æ€åˆ·æ–°
public class GatewayController {
    
    @Value("${gateway.timeout:3000}")
    private int timeout;
    
    @GetMapping("/config")
    public String getConfig() {
        return "å½“å‰è¶…æ—¶æ—¶é—´ï¼š" + timeout + "ms";
    }
}
```

#### ğŸ”¸ æ–¹æ¡ˆ2ï¼šRediså…±äº«å­˜å‚¨


```java
@Service
public class RouteConfigService {
    
    @Autowired
    private RedisTemplate<String, RouteDefinition> redisTemplate;
    
    // ä¿å­˜è·¯ç”±é…ç½®åˆ°Redis
    public void saveRoute(RouteDefinition route) {
        String key = "gateway:route:" + route.getId();
        redisTemplate.opsForValue().set(key, route);
        
        // å‘å¸ƒé…ç½®å˜æ›´äº‹ä»¶
        redisTemplate.convertAndSend(
            "gateway:route:refresh", 
            route.getId()
        );
    }
    
    // è®¢é˜…é…ç½®å˜æ›´
    @RedisListener(topics = "gateway:route:refresh")
    public void onRouteChange(String routeId) {
        // åˆ·æ–°æœ¬åœ°è·¯ç”±ç¼“å­˜
        refreshLocalRoute(routeId);
    }
}
```

### 5.4 é™æµæ•°æ®ä¸€è‡´æ€§


**é—®é¢˜ï¼š** 
åˆ†å¸ƒå¼é™æµæ—¶ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹è®¡æ•°ä¼šå¯¼è‡´é™æµå¤±æ•ˆã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

```java
@Component
public class DistributedRateLimiter {
    
    @Autowired
    private RedisTemplate<String, Long> redisTemplate;
    
    // åˆ†å¸ƒå¼é™æµ
    public boolean tryAcquire(String key, int maxRequests, int seconds) {
        String redisKey = "ratelimit:" + key;
        
        // åŸå­é€’å¢
        Long current = redisTemplate.opsForValue().increment(redisKey);
        
        if (current == 1) {
            // é¦–æ¬¡è®¿é—®ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
            redisTemplate.expire(redisKey, seconds, TimeUnit.SECONDS);
        }
        
        // åˆ¤æ–­æ˜¯å¦è¶…è¿‡é™åˆ¶
        return current <= maxRequests;
    }
}
```

**é™æµé…ç½®ï¼š**
- æ‰€æœ‰èŠ‚ç‚¹å…±äº«Redisè®¡æ•°å™¨
- ä½¿ç”¨åŸå­æ“ä½œä¿è¯å‡†ç¡®æ€§
- è®¾ç½®è¿‡æœŸæ—¶é—´è‡ªåŠ¨æ¸…ç†

---

## 6. ğŸ”„ é…ç½®åŒæ­¥æœºåˆ¶


### 6.1 é…ç½®åŒæ­¥ç­–ç•¥


#### ğŸ“‹ åŒæ­¥æ–¹å¼å¯¹æ¯”


| åŒæ­¥æ–¹å¼ | å®æ—¶æ€§ | å¯é æ€§ | å¤æ‚åº¦ | æ¨èåœºæ™¯ |
|---------|--------|--------|--------|----------|
| **æ¨é€æ¨¡å¼** | ç§’çº§ | é«˜ | ä¸­ | é…ç½®ä¸­å¿ƒ |
| **æ‹‰å–æ¨¡å¼** | åˆ†é’Ÿçº§ | ä¸­ | ä½ | å®šæ—¶ä»»åŠ¡ |
| **å‘å¸ƒè®¢é˜…** | ç§’çº§ | é«˜ | é«˜ | å®æ—¶åŒæ­¥ |
| **æ–‡ä»¶å…±äº«** | åˆ†é’Ÿçº§ | ä½ | ä½ | ç®€å•é…ç½® |

### 6.2 é…ç½®ç‰ˆæœ¬ç®¡ç†


**ç‰ˆæœ¬æ§åˆ¶æµç¨‹ï¼š**

```
å¼€å‘ç¯å¢ƒ â”€â”€> æµ‹è¯•ç¯å¢ƒ â”€â”€> é¢„å‘å¸ƒç¯å¢ƒ â”€â”€> ç”Ÿäº§ç¯å¢ƒ
  v1.0        v1.0         v1.0          v1.0
    â†“           â†“            â†“             â†“
  ä¿®æ”¹        éªŒè¯         ç°åº¦          å…¨é‡å‘å¸ƒ
    â†“           â†“            â†“             â†“
  v1.1        v1.1         v1.1          v1.1
```

**é…ç½®å›æ»šæœºåˆ¶ï¼š**

```java
@Service
public class ConfigVersionService {
    
    // å‘å¸ƒæ–°é…ç½®
    public void publishConfig(String configId, String content) {
        // 1. å¤‡ä»½å½“å‰é…ç½®
        backupCurrentConfig(configId);
        
        // 2. å‘å¸ƒæ–°é…ç½®
        String version = generateVersion();
        saveConfig(configId, content, version);
        
        // 3. é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹æ›´æ–°
        notifyAllNodes(configId, version);
    }
    
    // å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
    public void rollback(String configId, String targetVersion) {
        // 1. è·å–ç›®æ ‡ç‰ˆæœ¬é…ç½®
        String config = getConfigByVersion(configId, targetVersion);
        
        // 2. å‘å¸ƒå›æ»š
        publishConfig(configId, config);
        
        // 3. è®°å½•å›æ»šæ“ä½œ
        logRollback(configId, targetVersion);
    }
}
```

### 6.3 ç°åº¦å‘å¸ƒ


**ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒï¼Ÿ**
å°±åƒæ–°èœå“ä¸Šå¸‚å‰å…ˆè®©ä¸€éƒ¨åˆ†é¡¾å®¢è¯•åƒï¼Œæ²¡é—®é¢˜å†å…¨é¢æ¨å¹¿ã€‚

**ç°åº¦å‘å¸ƒæµç¨‹ï¼š**

```
1. é€‰æ‹©ç°åº¦èŠ‚ç‚¹ï¼ˆå¦‚èŠ‚ç‚¹1ï¼‰
    â†“
2. å‘å¸ƒæ–°é…ç½®åˆ°èŠ‚ç‚¹1
    â†“
3. è§‚å¯ŸèŠ‚ç‚¹1è¿è¡Œæƒ…å†µ
    â†“
4. ç›‘æ§å…³é”®æŒ‡æ ‡ï¼ˆæˆåŠŸç‡ã€å»¶è¿Ÿï¼‰
    â†“
5. ç¡®è®¤æ— é—®é¢˜åæ‰©å¤§èŒƒå›´
    â†“
6. æœ€ç»ˆå…¨éƒ¨èŠ‚ç‚¹æ›´æ–°
```

**ç°åº¦é…ç½®ç¤ºä¾‹ï¼š**

```yaml
# ç°åº¦è§„åˆ™

gray-release:
#  # ç°åº¦èŠ‚ç‚¹
  nodes:
    - node1
    - node2
#  # ç°åº¦æµé‡æ¯”ä¾‹
  traffic-percent: 10
#  # ç°åº¦ç­–ç•¥
  strategy:
#    # æŒ‰ç”¨æˆ·IDç°åº¦
    type: user-id
#    # ç°åº¦ç”¨æˆ·åˆ—è¡¨
    user-ids:
      - user_001
      - user_002
```

### 6.4 é…ç½®å˜æ›´ç›‘æ§


**ç›‘æ§æŒ‡æ ‡ï¼š**

```java
@Component
public class ConfigChangeMonitor {
    
    @Autowired
    private MetricsService metricsService;
    
    // è®°å½•é…ç½®å˜æ›´
    @EventListener
    public void onConfigChange(ConfigChangeEvent event) {
        // è®°å½•å˜æ›´æ—¶é—´
        metricsService.recordConfigChange(
            event.getConfigId(),
            event.getOldVersion(),
            event.getNewVersion(),
            System.currentTimeMillis()
        );
        
        // ç›‘æ§å…³é”®æŒ‡æ ‡
        monitorMetrics(event);
    }
    
    // ç›‘æ§æŒ‡æ ‡å˜åŒ–
    private void monitorMetrics(ConfigChangeEvent event) {
        // æˆåŠŸç‡
        double successRate = metricsService.getSuccessRate();
        // å¹³å‡å»¶è¿Ÿ
        double avgLatency = metricsService.getAvgLatency();
        // é”™è¯¯ç‡
        double errorRate = metricsService.getErrorRate();
        
        // å¼‚å¸¸å‘Šè­¦
        if (successRate < 0.95 || errorRate > 0.05) {
            alertService.send(
                "é…ç½®å˜æ›´åæŒ‡æ ‡å¼‚å¸¸ï¼Œå¯èƒ½éœ€è¦å›æ»š"
            );
        }
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 é«˜å¯ç”¨éƒ¨ç½²å…³é”®ç‚¹


**æ¶æ„è®¾è®¡ï¼š**
- âœ… å¤šèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²ï¼ˆè‡³å°‘3ä¸ªèŠ‚ç‚¹ï¼‰
- âœ… æ— å•ç‚¹æ•…éšœè®¾è®¡
- âœ… è·¨æœºæˆ¿/å¤šåœ°åŸŸå®¹ç¾
- âœ… è´Ÿè½½å‡è¡¡æµé‡åˆ†å‘

**åˆ‡æ¢æœºåˆ¶ï¼š**
- âœ… å¿ƒè·³æ£€æµ‹ç›‘æ§èŠ‚ç‚¹çŠ¶æ€
- âœ… è‡ªåŠ¨æ•…éšœè½¬ç§»
- âœ… ä¸»å¤‡çƒ­å¤‡æ¨¡å¼ï¼ˆç§’çº§åˆ‡æ¢ï¼‰
- âœ… å¥åº·æ£€æŸ¥æ¥å£

**æ•°æ®ä¸€è‡´æ€§ï¼š**
- âœ… é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†
- âœ… Rediså…±äº«çŠ¶æ€æ•°æ®
- âœ… å‘å¸ƒè®¢é˜…åŒæ­¥æœºåˆ¶
- âœ… ç‰ˆæœ¬ç®¡ç†ä¸å›æ»š

### 7.2 é…ç½®æ¸…å•é€ŸæŸ¥


**Nginxè´Ÿè½½å‡è¡¡ï¼š**
```nginx
upstream gateway_cluster {
    least_conn;  # æœ€å°‘è¿æ¥ç®—æ³•
    server 192.168.1.10:8080 weight=3;
    server 192.168.1.11:8080 weight=2;
    keepalive 32;
}
```

**Spring Cloud Gatewayï¼š**
```yaml
spring.cloud.gateway:
  discovery.locator.enabled: true
  httpclient.connect-timeout: 3000
  retry.enabled: true
```

**Nacosé…ç½®ä¸­å¿ƒï¼š**
```yaml
spring.cloud.nacos:
  config.server-addr: 127.0.0.1:8848
  config.refresh-enabled: true
```

### 7.3 è¿ç»´è¦ç‚¹


**ç›‘æ§æŒ‡æ ‡ï¼š**
- ğŸ”¸ èŠ‚ç‚¹å¥åº·çŠ¶æ€
- ğŸ”¸ è¯·æ±‚æˆåŠŸç‡
- ğŸ”¸ å“åº”æ—¶é—´
- ğŸ”¸ æµé‡åˆ†å¸ƒ
- ğŸ”¸ é”™è¯¯ç‡

**åº”æ€¥é¢„æ¡ˆï¼š**
1. èŠ‚ç‚¹æ•…éšœ â†’ è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨èŠ‚ç‚¹
2. é…ç½®é”™è¯¯ â†’ ç«‹å³å›æ»šä¸Šä¸€ç‰ˆæœ¬
3. æµé‡æ¿€å¢ â†’ å¿«é€Ÿæ‰©å®¹èŠ‚ç‚¹
4. å…¨å±€æ•…éšœ â†’ å¯ç”¨å¤‡ç”¨æœºæˆ¿

### 7.4 æœ€ä½³å®è·µå»ºè®®


**éƒ¨ç½²å»ºè®®ï¼š**
- ğŸ¯ å¥‡æ•°ä¸ªèŠ‚ç‚¹ä¾¿äºé€‰ä¸¾ï¼ˆ3ã€5ã€7ä¸ªï¼‰
- ğŸ¯ å…³é”®æœåŠ¡è‡³å°‘2ä¸ªæœºæˆ¿éƒ¨ç½²
- ğŸ¯ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸»å¤‡çƒ­å¤‡æ¨¡å¼
- ğŸ¯ é…ç½®å˜æ›´å…ˆç°åº¦å†å…¨é‡

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- âš¡ å¯ç”¨è¿æ¥æ± å¤ç”¨
- âš¡ åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- âš¡ ä½¿ç”¨å¼‚æ­¥éé˜»å¡IO
- âš¡ é™æµä¿æŠ¤å…³é”®èµ„æº

**å®‰å…¨åŠ å›ºï¼š**
- ğŸ”’ å¯ç”¨TLSåŠ å¯†ä¼ è¾“
- ğŸ”’ é…ç½®è®¿é—®ç™½åå•
- ğŸ”’ æ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨
- ğŸ”’ å®šæœŸå®‰å…¨å®¡è®¡

---

## ğŸ’¡ å­¦ä¹ å»ºè®®


**æ–°æ‰‹å…¥é—¨è·¯å¾„ï¼š**
1. å…ˆç†è§£é«˜å¯ç”¨çš„å¿…è¦æ€§
2. æ­å»ºç®€å•çš„ä¸»å¤‡ç¯å¢ƒ
3. é…ç½®è´Ÿè½½å‡è¡¡å™¨
4. å®è·µæ•…éšœè½¬ç§»
5. æŒæ¡é…ç½®åŒæ­¥
6. å­¦ä¹ ç›‘æ§å‘Šè­¦

**å®è·µç»ƒä¹ ï¼š**
- ğŸ”§ æ­å»º3èŠ‚ç‚¹Gatewayé›†ç¾¤
- ğŸ”§ é…ç½®Nginxè´Ÿè½½å‡è¡¡
- ğŸ”§ æ¨¡æ‹ŸèŠ‚ç‚¹æ•…éšœæµ‹è¯•
- ğŸ”§ å®ç°é…ç½®åŠ¨æ€åˆ·æ–°
- ğŸ”§ éƒ¨ç½²ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

**æ ¸å¿ƒè®°å¿†ï¼š**
> "ä¸‰èŠ‚ç‚¹é›†ç¾¤æ— å•ç‚¹ï¼Œè´Ÿè½½å‡è¡¡æµé‡åˆ†ã€‚
> å¿ƒè·³æ£€æµ‹æ•…éšœè½¬ï¼Œé…ç½®åŒæ­¥ä¿ä¸€è‡´ã€‚
> ç°åº¦å‘å¸ƒé™é£é™©ï¼Œç›‘æ§å‘Šè­¦ä¿å¹³å®‰ã€‚"