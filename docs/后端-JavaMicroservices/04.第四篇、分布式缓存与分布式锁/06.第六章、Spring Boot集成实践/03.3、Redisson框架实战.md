---
title: 3ã€Redissonæ¡†æ¶å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [Redissonæ¡†æ¶æ¦‚è¿°](#1-redissonæ¡†æ¶æ¦‚è¿°)
2. [Spring Booté›†æˆé…ç½®](#2-spring-booté›†æˆé…ç½®)
3. [RLockæ¥å£æ ¸å¿ƒä½¿ç”¨](#3-rlockæ¥å£æ ¸å¿ƒä½¿ç”¨)
4. [å¯é‡å…¥é”æ·±å…¥ç†è§£](#4-å¯é‡å…¥é”æ·±å…¥ç†è§£)
5. [å¤šç§é”ç±»å‹å®æˆ˜](#5-å¤šç§é”ç±»å‹å®æˆ˜)
6. [é«˜çº§ç‰¹æ€§åº”ç”¨](#6-é«˜çº§ç‰¹æ€§åº”ç”¨)
7. [æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜](#7-æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ Redissonæ¡†æ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Redissonï¼Ÿ

**ç®€å•ç†è§£**ï¼šRedissonå°±åƒæ˜¯Redisçš„"é«˜çº§é©¾é©¶å‘˜"ï¼Œå®ƒè®©æˆ‘ä»¬ç”¨Javaæ“ä½œRediså˜å¾—è¶…çº§ç®€å•ã€‚

```
ä¼ ç»Ÿåšæ³•ï¼š
ç¨‹åºå‘˜ â†’ å†™å¤æ‚çš„Rediså‘½ä»¤ â†’ RedisæœåŠ¡å™¨

Redissonæ–¹å¼ï¼š
ç¨‹åºå‘˜ â†’ ä½¿ç”¨ç®€å•çš„Javaå¯¹è±¡ â†’ Redissonè‡ªåŠ¨è½¬æ¢ â†’ RedisæœåŠ¡å™¨

å°±åƒï¼šæ‰‹åŠ¨æŒ¡è½¦ vs è‡ªåŠ¨æŒ¡è½¦çš„åŒºåˆ«
```

> ğŸ’¡ **é€šä¿—æ¯”å–»**  
> å¦‚æœRedisæ˜¯ä¸€ä¸ªå·¥å…·ç®±ï¼Œé‚£ä¹ˆRedissonå°±æ˜¯å¸®ä½ æ•´ç†å¥½çš„å·¥å…·å¥—è£…ï¼Œæ¯ä¸ªå·¥å…·éƒ½è´´å¥½äº†æ ‡ç­¾ï¼Œå‘Šè¯‰ä½ ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆå·¥å…·ã€‚

### 1.2 ä¸ºä»€ä¹ˆé€‰æ‹©Redissonï¼Ÿ

**æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”**ï¼š

| ç‰¹æ€§å¯¹æ¯” | **åŸç”ŸRediså®¢æˆ·ç«¯** | **Redissonæ¡†æ¶** |
|---------|-------------------|------------------|
| ğŸ”§ **ä½¿ç”¨éš¾åº¦** | éœ€è¦å­¦ä¹ Rediså‘½ä»¤è¯­æ³• | ç›´æ¥ä½¿ç”¨Javaå¯¹è±¡ï¼Œç®€å•ç›´è§‚ |
| ğŸ”’ **åˆ†å¸ƒå¼é”** | æ‰‹å†™Luaè„šæœ¬ï¼Œå®¹æ˜“å‡ºé”™ | å†…ç½®å¤šç§é”ï¼Œå¼€ç®±å³ç”¨ |
| ğŸ“Š **æ•°æ®ç»“æ„** | å‘½ä»¤å¼æ“ä½œï¼Œç¹ç | é¢å‘å¯¹è±¡ï¼Œå¦‚Javaé›†åˆä¸€æ ·ç®€å• |
| âš¡ **æ€§èƒ½ä¼˜åŒ–** | éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–è¿æ¥æ±  | è‡ªåŠ¨è¿æ¥æ± ç®¡ç†ï¼Œæ™ºèƒ½é‡è¯• |
| ğŸŒ **é›†ç¾¤æ”¯æŒ** | å¤æ‚çš„é›†ç¾¤é…ç½® | ä¸€é”®é…ç½®ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§» |

### 1.3 Redissonæ ¸å¿ƒåŠŸèƒ½æ¶æ„

```
         åº”ç”¨ç¨‹åº
             |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Redissonå®¢æˆ·ç«¯      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ åˆ†å¸ƒå¼é” (RLock)      â”‚
    â”‚ â€¢ åˆ†å¸ƒå¼é›†åˆ (RMap)     â”‚  
    â”‚ â€¢ æ¶ˆæ¯é˜Ÿåˆ— (RTopic)     â”‚
    â”‚ â€¢ åŸå­æ“ä½œ (RAtomicLong)â”‚
    â”‚ â€¢ é™æµå™¨ (RRateLimiter) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             |
        Redisé›†ç¾¤/å•æœº
```

---

## 2. âš™ï¸ Spring Booté›†æˆé…ç½®


### 2.1 ä¾èµ–å¼•å…¥

**Mavené…ç½®**ï¼š
```xml
<dependency>
    <groupId>org.redisson</groupId>
    <artifactId>redisson-spring-boot-starter</artifactId>
    <version>3.24.3</version>
</dependency>
```

> âš ï¸ **ç‰ˆæœ¬é€‰æ‹©æé†’**  
> é€‰æ‹©ä¸ä½ çš„Spring Bootç‰ˆæœ¬å…¼å®¹çš„Redissonç‰ˆæœ¬ï¼Œé¿å…å‡ºç°å¥‡æ€ªçš„é”™è¯¯ã€‚

### 2.2 é…ç½®æ–‡ä»¶è®¾ç½®

**application.yml é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# å•æœºRedisé…ç½®
spring:
  redis:
    redisson:
      config: |
        singleServerConfig:
          address: "redis://localhost:6379"
          password: "your_password"  
          database: 0
          connectionPoolSize: 64
          connectionMinimumIdleSize: 10
          timeout: 3000
          retryAttempts: 3
          retryInterval: 1500
```

**é›†ç¾¤é…ç½®ç¤ºä¾‹**ï¼š
```yaml
spring:
  redis:
    redisson:
      config: |
        clusterServersConfig:
          nodeAddresses:
            - "redis://192.168.1.10:7000"
            - "redis://192.168.1.10:7001"  
            - "redis://192.168.1.10:7002"
          password: "cluster_password"
          scanInterval: 2000
          masterConnectionPoolSize: 64
          slaveConnectionPoolSize: 32
```

### 2.3 Javaé…ç½®ç±»æ–¹å¼

```java
@Configuration
@EnableConfigurationProperties(RedissonProperties.class)
public class RedissonConfig {
    
    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        
        // å•æœºæ¨¡å¼é…ç½®
        config.useSingleServer()
            .setAddress("redis://localhost:6379")
            .setConnectionPoolSize(64)
            .setConnectionMinimumIdleSize(10)
            .setIdleConnectionTimeout(10000)
            .setConnectTimeout(10000)
            .setTimeout(3000)
            .setRetryAttempts(3)
            .setRetryInterval(1500);
            
        return Redisson.create(config);
    }
}
```

> ğŸ¯ **é…ç½®ç†è§£è¦ç‚¹**  
> â€¢ `connectionPoolSize`ï¼šæœ€å¤§è¿æ¥æ•°ï¼Œåƒåœè½¦åœºçš„è½¦ä½æ•°é‡  
> â€¢ `timeout`ï¼šç­‰å¾…å“åº”æ—¶é—´ï¼Œè¶…æ—¶å°±æ”¾å¼ƒ  
> â€¢ `retryAttempts`ï¼šé‡è¯•æ¬¡æ•°ï¼Œç½‘ç»œä¸å¥½æ—¶å¤šè¯•å‡ æ¬¡

---

## 3. ğŸ” RLockæ¥å£æ ¸å¿ƒä½¿ç”¨


### 3.1 RLockåŸºç¡€æ¦‚å¿µ

**RLockæ˜¯ä»€ä¹ˆ**ï¼šRä»£è¡¨Redissonï¼ŒLockä»£è¡¨é”ã€‚RLockå°±æ˜¯Redissonæä¾›çš„åˆ†å¸ƒå¼é”æ¥å£ã€‚

```
æœ¬åœ°é” vs åˆ†å¸ƒå¼é”å¯¹æ¯”ï¼š

æœ¬åœ°é”ï¼ˆsynchronizedï¼‰ï¼š
çº¿ç¨‹A â”€â”€â”
        â”œâ”€â”€ åªåœ¨å•ä¸ªJVMå†…æœ‰æ•ˆ
çº¿ç¨‹B â”€â”€â”˜

åˆ†å¸ƒå¼é”ï¼ˆRLockï¼‰ï¼š
æœåŠ¡å™¨A â”€â”€â”
          â”œâ”€â”€ é€šè¿‡Redisåè°ƒï¼Œè·¨æœåŠ¡å™¨æœ‰æ•ˆ  
æœåŠ¡å™¨B â”€â”€â”˜
```

### 3.2 åŸºç¡€åŠ é”è§£é”æ“ä½œ

```java
@Service
public class OrderService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    public void processOrder(String orderId) {
        // 1. è·å–é”å¯¹è±¡
        RLock lock = redissonClient.getLock("order_lock:" + orderId);
        
        try {
            // 2. å°è¯•åŠ é”ï¼Œç­‰å¾…æ—¶é—´10ç§’ï¼Œé”è¿‡æœŸæ—¶é—´30ç§’
            boolean isLocked = lock.tryLock(10, 30, TimeUnit.SECONDS);
            
            if (!isLocked) {
                throw new RuntimeException("è·å–é”å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
            }
            
            // 3. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            doProcessOrder(orderId);
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new RuntimeException("åŠ é”è¢«ä¸­æ–­");
        } finally {
            // 4. é‡Šæ”¾é”ï¼ˆé‡è¦ï¼ï¼‰
            if (lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }
}
```

### 3.3 é”çš„ç”Ÿå‘½å‘¨æœŸç†è§£

```
é”çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»ºé”å¯¹è±¡ â†’ å°è¯•è·å– â†’ è·å–æˆåŠŸ â†’ æ‰§è¡Œä¸šåŠ¡ â†’ é‡Šæ”¾é”
     â†“           â†“         â†“        â†“        â†“
  getLock()  tryLock()   ä¸šåŠ¡ä»£ç    unlock()  é”æ¶ˆå¤±

å¦‚æœè·å–å¤±è´¥ï¼š
åˆ›å»ºé”å¯¹è±¡ â†’ å°è¯•è·å– â†’ ç­‰å¾…æˆ–æ”¾å¼ƒ
     â†“           â†“         â†“
  getLock()  tryLock()   è¿”å›false
```

### 3.4 å¸¸ç”¨æ–¹æ³•è¯¦è§£

| æ–¹æ³•å | **ä½œç”¨è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** |
|-------|-------------|-------------|
| `lock()` | **æ— é™ç­‰å¾…è·å–é”** | å¿…é¡»è·å–é”çš„åœºæ™¯ |
| `tryLock()` | **ç«‹å³è¿”å›æ˜¯å¦è·å–æˆåŠŸ** | å¯ä»¥å¤±è´¥çš„æ“ä½œ |
| `tryLock(time, unit)` | **ç­‰å¾…æŒ‡å®šæ—¶é—´è·å–é”** | å¹³è¡¡æ€§èƒ½å’ŒæˆåŠŸç‡ |
| `unlock()` | **é‡Šæ”¾é”** | ä¸šåŠ¡å®Œæˆåå¿…é¡»è°ƒç”¨ |
| `isLocked()` | **æ£€æŸ¥é”æ˜¯å¦è¢«å ç”¨** | çŠ¶æ€æŸ¥è¯¢ |
| `isHeldByCurrentThread()` | **æ£€æŸ¥æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰** | å®‰å…¨é‡Šæ”¾é” |

---

## 4. ğŸ”„ å¯é‡å…¥é”æ·±å…¥ç†è§£


### 4.1 ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿ

**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒä½ å®¶çš„é—¨é”ï¼Œä½ å·²ç»æœ‰äº†é’¥åŒ™è¿›å…¥æˆ¿é—´ï¼Œå†æ¬¡é”é—¨å’Œå¼€é—¨éƒ½ä¸éœ€è¦é‡æ–°ç”³è¯·é’¥åŒ™ã€‚

```
å¯é‡å…¥é”ç¤ºä¾‹ï¼š

ç¬¬ä¸€æ¬¡åŠ é” â†’ è·å–é”ï¼Œè®¡æ•°å™¨=1
ç¬¬äºŒæ¬¡åŠ é” â†’ åŒä¸€çº¿ç¨‹ï¼Œè®¡æ•°å™¨=2  
ç¬¬ä¸‰æ¬¡åŠ é” â†’ åŒä¸€çº¿ç¨‹ï¼Œè®¡æ•°å™¨=3

è§£é”è¿‡ç¨‹ï¼š
ç¬¬ä¸€æ¬¡è§£é” â†’ è®¡æ•°å™¨=2ï¼Œé”è¿˜åœ¨
ç¬¬äºŒæ¬¡è§£é” â†’ è®¡æ•°å™¨=1ï¼Œé”è¿˜åœ¨
ç¬¬ä¸‰æ¬¡è§£é” â†’ è®¡æ•°å™¨=0ï¼Œé”é‡Šæ”¾
```

### 4.2 å¯é‡å…¥é”å®é™…åº”ç”¨

```java
@Service
public class UserService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    public void updateUserInfo(Long userId) {
        RLock userLock = redissonClient.getLock("user:" + userId);
        
        try {
            userLock.lock(); // ç¬¬ä¸€æ¬¡åŠ é”
            
            // æ›´æ–°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
            updateBasicInfo(userId);  // è¿™é‡Œä¹Ÿä¼šåŠ é”
            
            // æ›´æ–°ç”¨æˆ·æ‰©å±•ä¿¡æ¯
            updateExtendedInfo(userId); // è¿™é‡Œä¹Ÿä¼šåŠ é”
            
        } finally {
            userLock.unlock(); // å¯¹åº”çš„è§£é”
        }
    }
    
    private void updateBasicInfo(Long userId) {
        RLock userLock = redissonClient.getLock("user:" + userId);
        
        try {
            userLock.lock(); // ç¬¬äºŒæ¬¡åŠ é”ï¼ˆå¯é‡å…¥ï¼‰
            // æ›´æ–°åŸºæœ¬ä¿¡æ¯çš„ä¸šåŠ¡é€»è¾‘
            System.out.println("æ›´æ–°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯");
        } finally {
            userLock.unlock();
        }
    }
    
    private void updateExtendedInfo(Long userId) {
        RLock userLock = redissonClient.getLock("user:" + userId);
        
        try {
            userLock.lock(); // ç¬¬ä¸‰æ¬¡åŠ é”ï¼ˆå¯é‡å…¥ï¼‰
            // æ›´æ–°æ‰©å±•ä¿¡æ¯çš„ä¸šåŠ¡é€»è¾‘
            System.out.println("æ›´æ–°ç”¨æˆ·æ‰©å±•ä¿¡æ¯");
        } finally {
            userLock.unlock();
        }
    }
}
```

> ğŸ’¡ **å¯é‡å…¥é”çš„å¥½å¤„**  
> é¿å…äº†åŒä¸€çº¿ç¨‹çš„æ­»é”é—®é¢˜ï¼Œè®©ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œæ–¹æ³•ä¹‹é—´å¯ä»¥è‡ªç”±è°ƒç”¨è€Œä¸ç”¨æ‹…å¿ƒé”å†²çªã€‚

### 4.3 å¯é‡å…¥é”çš„å†…éƒ¨æœºåˆ¶

```
Redissonå¯é‡å…¥é”çš„Rediså­˜å‚¨ç»“æ„ï¼š

Key: "user:123"
Value: {
    "7c37d3c4-c4c4-4c4c-8c4c-7c37d3c4c4c4:1": 3
}

è§£é‡Šï¼š
â€¢ Key: é”çš„åç§°  
â€¢ Value: ä¸€ä¸ªHashç»“æ„
â€¢ Hashçš„Key: å®¢æˆ·ç«¯ID + çº¿ç¨‹ID
â€¢ Hashçš„Value: é‡å…¥æ¬¡æ•°

æ¯æ¬¡lock()æ—¶ï¼Œé‡å…¥æ¬¡æ•°+1
æ¯æ¬¡unlock()æ—¶ï¼Œé‡å…¥æ¬¡æ•°-1  
é‡å…¥æ¬¡æ•°ä¸º0æ—¶ï¼Œåˆ é™¤æ•´ä¸ªé”
```

---

## 5. ğŸ¯ å¤šç§é”ç±»å‹å®æˆ˜


### 5.1 å…¬å¹³é”ï¼ˆFairLockï¼‰

**ç†è§£æ¦‚å¿µ**ï¼šå°±åƒæ’é˜Ÿä¹°ç¥¨ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼Œä¿è¯è·å–é”çš„é¡ºåºå…¬å¹³æ€§ã€‚

```java
@Service  
public class TicketService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    public void buyTicket(String userId) {
        // è·å–å…¬å¹³é”ï¼Œç¡®ä¿å…ˆæ¥å…ˆæœåŠ¡
        RLock fairLock = redissonClient.getFairLock("ticket_fair_lock");
        
        try {
            // å°è¯•è·å–å…¬å¹³é”
            boolean acquired = fairLock.tryLock(30, 60, TimeUnit.SECONDS);
            
            if (!acquired) {
                throw new RuntimeException("æ’é˜Ÿäººæ•°è¿‡å¤šï¼Œè¯·ç¨åé‡è¯•");
            }
            
            // æ¨¡æ‹Ÿè´­ç¥¨ä¸šåŠ¡
            System.out.println("ç”¨æˆ· " + userId + " æ­£åœ¨è´­ç¥¨...");
            Thread.sleep(2000); // æ¨¡æ‹Ÿè´­ç¥¨è€—æ—¶
            System.out.println("ç”¨æˆ· " + userId + " è´­ç¥¨æˆåŠŸ");
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            if (fairLock.isHeldByCurrentThread()) {
                fairLock.unlock();
            }
        }
    }
}
```

**æ™®é€šé” vs å…¬å¹³é”å¯¹æ¯”**ï¼š
```
æ™®é€šé”è·å–é¡ºåºï¼š
æ—¶é—´çº¿: Aè¯·æ±‚ â†’ Bè¯·æ±‚ â†’ Cè¯·æ±‚ â†’ Aé‡Šæ”¾ â†’ ?è·å¾—
ç»“æœ:   å¯èƒ½Cå…ˆè·å¾—ï¼ˆä¸å…¬å¹³ï¼‰

å…¬å¹³é”è·å–é¡ºåºï¼š  
æ—¶é—´çº¿: Aè¯·æ±‚ â†’ Bè¯·æ±‚ â†’ Cè¯·æ±‚ â†’ Aé‡Šæ”¾ â†’ Bè·å¾—
ç»“æœ:   Bå…ˆè·å¾—ï¼ˆå…¬å¹³ï¼ŒæŒ‰é¡ºåºï¼‰
```

### 5.2 è¯»å†™é”ï¼ˆReadWriteLockï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šè¯»æ“ä½œå¯ä»¥å¹¶å‘ï¼Œå†™æ“ä½œå¿…é¡»ç‹¬å ã€‚å°±åƒå›¾ä¹¦é¦†ï¼Œå¤šäººå¯ä»¥åŒæ—¶çœ‹ä¹¦ï¼Œä½†åªæœ‰ä¸€ä¸ªäººèƒ½ä¿®æ”¹ä¹¦ã€‚

```java
@Service
public class ArticleService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    // è¯»å–æ–‡ç« å†…å®¹ï¼ˆæ”¯æŒå¹¶å‘è¯»ï¼‰
    public String readArticle(Long articleId) {
        RReadWriteLock readWriteLock = redissonClient.getReadWriteLock("article:" + articleId);
        RLock readLock = readWriteLock.readLock();
        
        try {
            readLock.lock(); // è·å–è¯»é”
            
            // æ¨¡æ‹Ÿè¯»å–æ“ä½œï¼ˆå¯ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œï¼‰
            System.out.println("æ­£åœ¨è¯»å–æ–‡ç«  " + articleId);
            Thread.sleep(1000);
            return "æ–‡ç« å†…å®¹...";
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            return null;
        } finally {
            readLock.unlock();
        }
    }
    
    // æ›´æ–°æ–‡ç« å†…å®¹ï¼ˆç‹¬å å†™ï¼‰
    public void updateArticle(Long articleId, String content) {
        RReadWriteLock readWriteLock = redissonClient.getReadWriteLock("article:" + articleId);
        RLock writeLock = readWriteLock.writeLock();
        
        try {
            writeLock.lock(); // è·å–å†™é”
            
            // æ¨¡æ‹Ÿå†™æ“ä½œï¼ˆç‹¬å ï¼Œå…¶ä»–è¯»å†™æ“ä½œéƒ½è¦ç­‰å¾…ï¼‰
            System.out.println("æ­£åœ¨æ›´æ–°æ–‡ç«  " + articleId);
            Thread.sleep(2000);
            System.out.println("æ–‡ç« æ›´æ–°å®Œæˆ");
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            writeLock.unlock();
        }
    }
}
```

**è¯»å†™é”çš„è®¿é—®è§„åˆ™**ï¼š
```
è¯»å†™é”è®¿é—®çŸ©é˜µï¼š

          è¯»æ“ä½œ    å†™æ“ä½œ
è¯»æ“ä½œ     âœ…       âŒ
å†™æ“ä½œ     âŒ       âŒ

è¯´æ˜ï¼š
âœ… å¯ä»¥åŒæ—¶è¿›è¡Œ
âŒ äº’æ–¥ï¼Œéœ€è¦ç­‰å¾…
```

### 5.3 ä¿¡å·é‡ï¼ˆSemaphoreï¼‰

**ç”Ÿæ´»ç†è§£**ï¼šå°±åƒåœè½¦åœºï¼Œæœ‰å›ºå®šæ•°é‡çš„è½¦ä½ï¼Œæ»¡äº†å°±è¦ç­‰æœ‰è½¦å¼€èµ°ã€‚

```java
@Service
public class ConnectionPoolService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    // æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥æ± ï¼Œæœ€å¤šå…è®¸10ä¸ªå¹¶å‘è¿æ¥
    public void executeQuery(String sql) {
        RSemaphore semaphore = redissonClient.getSemaphore("db_connection_pool");
        
        try {
            // åˆå§‹åŒ–ä¿¡å·é‡ï¼Œè®¾ç½®ä¸º10ä¸ªè®¸å¯è¯
            semaphore.trySetPermits(10);
            
            // å°è¯•è·å–ä¸€ä¸ªè®¸å¯è¯ï¼ˆä¸€ä¸ªè¿æ¥ï¼‰
            boolean acquired = semaphore.tryAcquire(5, TimeUnit.SECONDS);
            
            if (!acquired) {
                throw new RuntimeException("æ•°æ®åº“è¿æ¥æ± å·²æ»¡ï¼Œè¯·ç¨åé‡è¯•");
            }
            
            // æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ
            System.out.println("æ‰§è¡ŒSQL: " + sql);
            Thread.sleep(3000); // æ¨¡æ‹ŸæŸ¥è¯¢è€—æ—¶
            System.out.println("SQLæ‰§è¡Œå®Œæˆ");
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            // é‡Šæ”¾è®¸å¯è¯ï¼ˆå½’è¿˜è¿æ¥ï¼‰
            semaphore.release();
        }
    }
}
```

**ä¿¡å·é‡å·¥ä½œåŸç†**ï¼š
```
ä¿¡å·é‡çŠ¶æ€å˜åŒ–ï¼š

åˆå§‹çŠ¶æ€: è®¸å¯è¯æ•°é‡ = 10
ç¬¬1æ¬¡è¯·æ±‚: è®¸å¯è¯æ•°é‡ = 9  (è·å–æˆåŠŸ)
ç¬¬2æ¬¡è¯·æ±‚: è®¸å¯è¯æ•°é‡ = 8  (è·å–æˆåŠŸ)
...
ç¬¬10æ¬¡è¯·æ±‚: è®¸å¯è¯æ•°é‡ = 0 (è·å–æˆåŠŸ)  
ç¬¬11æ¬¡è¯·æ±‚: ç­‰å¾…...        (è·å–å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…)

æœ‰ä»»åŠ¡å®Œæˆé‡Šæ”¾è®¸å¯è¯ï¼š
è®¸å¯è¯æ•°é‡ = 1ï¼Œç¬¬11æ¬¡è¯·æ±‚è·å–æˆåŠŸ
```

### 5.4 é—­é”ï¼ˆCountDownLatchï¼‰

**åº”ç”¨åœºæ™¯**ï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡éƒ½å®Œæˆåå†ç»§ç»­ï¼Œæ¯”å¦‚ç­‰æ‰€æœ‰å¾®æœåŠ¡éƒ½å¯åŠ¨å®Œæˆåå†æä¾›æœåŠ¡ã€‚

```java
@Service
public class SystemInitService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    // ç³»ç»Ÿå¯åŠ¨ç­‰å¾…å¤šä¸ªæœåŠ¡åˆå§‹åŒ–å®Œæˆ
    public void waitForSystemReady() {
        RCountDownLatch latch = redissonClient.getCountDownLatch("system_init");
        
        try {
            // è®¾ç½®éœ€è¦ç­‰å¾…çš„ä»»åŠ¡æ•°é‡
            latch.trySetCount(3); // ç­‰å¾…3ä¸ªæœåŠ¡åˆå§‹åŒ–
            
            System.out.println("ç­‰å¾…æ‰€æœ‰æœåŠ¡åˆå§‹åŒ–å®Œæˆ...");
            
            // ç­‰å¾…è®¡æ•°å™¨å˜ä¸º0ï¼Œæœ€å¤šç­‰å¾…60ç§’
            boolean allReady = latch.await(60, TimeUnit.SECONDS);
            
            if (allReady) {
                System.out.println("æ‰€æœ‰æœåŠ¡åˆå§‹åŒ–å®Œæˆï¼Œç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼");
            } else {
                System.out.println("ç­‰å¾…è¶…æ—¶ï¼Œéƒ¨åˆ†æœåŠ¡åˆå§‹åŒ–å¤±è´¥");
            }
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    // å„ä¸ªæœåŠ¡åˆå§‹åŒ–å®Œæˆåè°ƒç”¨
    public void serviceInitCompleted(String serviceName) {
        RCountDownLatch latch = redissonClient.getCountDownLatch("system_init");
        
        System.out.println(serviceName + " æœåŠ¡åˆå§‹åŒ–å®Œæˆ");
        latch.countDown(); // è®¡æ•°å™¨å‡1
    }
}
```

**CountDownLatchè®¡æ•°è¿‡ç¨‹**ï¼š
```
é—­é”è®¡æ•°å˜åŒ–ï¼š

åˆå§‹çŠ¶æ€: count = 3
æœåŠ¡Aå®Œæˆ: count = 2  (countDownè°ƒç”¨)
æœåŠ¡Bå®Œæˆ: count = 1  (countDownè°ƒç”¨)  
æœåŠ¡Cå®Œæˆ: count = 0  (countDownè°ƒç”¨ï¼Œawaitæ–¹æ³•è¿”å›)

ä¸»çº¿ç¨‹ï¼šä¸€ç›´ç­‰å¾…ç›´åˆ°count=0æ‰ç»§ç»­æ‰§è¡Œ
```

---

## 6. âš¡ é«˜çº§ç‰¹æ€§åº”ç”¨


### 6.1 é”é…ç½®å‚æ•°è¯¦è§£

```java
@Configuration
public class RedissonLockConfig {
    
    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        
        config.useSingleServer()
            .setAddress("redis://localhost:6379")
            // é”ç›¸å…³é…ç½®
            .setSubscriptionConnectionPoolSize(50)  // è®¢é˜…è¿æ¥æ± å¤§å°
            .setSubscriptionConnectionMinimumIdleSize(1) // æœ€å°ç©ºé—²è®¢é˜…è¿æ¥
            .setConnectionPoolSize(64)     // è¿æ¥æ± å¤§å°  
            .setConnectionMinimumIdleSize(10) // æœ€å°ç©ºé—²è¿æ¥
            .setIdleConnectionTimeout(10000) // ç©ºé—²è¿æ¥è¶…æ—¶
            .setConnectTimeout(10000)      // è¿æ¥è¶…æ—¶
            .setTimeout(3000)              // å“åº”è¶…æ—¶
            .setRetryAttempts(3)           // é‡è¯•æ¬¡æ•°
            .setRetryInterval(1500);       // é‡è¯•é—´éš”
            
        return Redisson.create(config);
    }
}
```

**å‚æ•°è¯´æ˜è¡¨**ï¼š

| å‚æ•°å | **ä½œç”¨è¯´æ˜** | **å»ºè®®å€¼** | **æ³¨æ„äº‹é¡¹** |
|--------|-------------|-----------|-------------|
| `connectionPoolSize` | **è¿æ¥æ± æœ€å¤§è¿æ¥æ•°** | 64-128 | æ ¹æ®å¹¶å‘é‡è°ƒæ•´ |
| `connectionMinimumIdleSize` | **ä¿æŒçš„æœ€å°ç©ºé—²è¿æ¥** | 10-24 | é¿å…è¿æ¥åˆ›å»ºå¼€é”€ |
| `timeout` | **Rediså“åº”è¶…æ—¶æ—¶é—´** | 3000ms | ç½‘ç»œçŠ¶å†µå†³å®š |
| `retryAttempts` | **å¤±è´¥é‡è¯•æ¬¡æ•°** | 3æ¬¡ | é¿å…æ— é™é‡è¯• |
| `retryInterval` | **é‡è¯•é—´éš”æ—¶é—´** | 1500ms | ç»™Redisæ¢å¤æ—¶é—´ |

### 6.2 é›†ç¾¤æ”¯æŒé…ç½®

```java
@Configuration
public class RedissonClusterConfig {
    
    @Bean
    public RedissonClient redissonClusterClient() {
        Config config = new Config();
        
        config.useClusterServers()
            // é›†ç¾¤èŠ‚ç‚¹åœ°å€
            .addNodeAddress("redis://192.168.1.10:7000")
            .addNodeAddress("redis://192.168.1.10:7001") 
            .addNodeAddress("redis://192.168.1.10:7002")
            .addNodeAddress("redis://192.168.1.11:7000")
            .addNodeAddress("redis://192.168.1.11:7001")
            .addNodeAddress("redis://192.168.1.11:7002")
            // é›†ç¾¤é…ç½®
            .setPassword("cluster_password")
            .setMasterConnectionPoolSize(64)    // ä¸»èŠ‚ç‚¹è¿æ¥æ± 
            .setSlaveConnectionPoolSize(32)     // ä»èŠ‚ç‚¹è¿æ¥æ±   
            .setMasterConnectionMinimumIdleSize(10)
            .setSlaveConnectionMinimumIdleSize(10)
            .setReadMode(ReadMode.SLAVE)        // è¯»å–æ¨¡å¼ï¼šä»èŠ‚ç‚¹è¯»å–
            .setSubscriptionMode(SubscriptionMode.MASTER) // è®¢é˜…æ¨¡å¼ï¼šä¸»èŠ‚ç‚¹
            .setScanInterval(2000)              // é›†ç¾¤æ‹“æ‰‘æ‰«æé—´éš”
            .setFailedSlaveReconnectionInterval(3000)     // å¤±è´¥é‡è¿é—´éš”
            .setFailedSlaveCheckInterval(60000); // å¤±è´¥æ£€æŸ¥é—´éš”
            
        return Redisson.create(config);
    }
}
```

**é›†ç¾¤æ¶æ„ç†è§£**ï¼š
```
Redisé›†ç¾¤æ¶æ„ï¼š

ä¸»èŠ‚ç‚¹ç»„1: Master1 â”€â”€â”€ Slave1
ä¸»èŠ‚ç‚¹ç»„2: Master2 â”€â”€â”€ Slave2  
ä¸»èŠ‚ç‚¹ç»„3: Master3 â”€â”€â”€ Slave3

Redissonå®¢æˆ·ç«¯:
â”œâ”€â”€ å†™æ“ä½œ â†’ è·¯ç”±åˆ°å¯¹åº”MasterèŠ‚ç‚¹
â”œâ”€â”€ è¯»æ“ä½œ â†’ è·¯ç”±åˆ°SlaveèŠ‚ç‚¹ï¼ˆReadMode.SLAVEï¼‰
â””â”€â”€ è®¢é˜…æ“ä½œ â†’ è¿æ¥åˆ°MasterèŠ‚ç‚¹
```

### 6.3 å¼‚æ­¥æ“ä½œæ”¯æŒ

```java
@Service
public class AsyncLockService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    // å¼‚æ­¥è·å–é”å¹¶æ‰§è¡Œä¸šåŠ¡
    public CompletableFuture<String> processOrderAsync(String orderId) {
        RLock lock = redissonClient.getLock("order:" + orderId);
        
        // å¼‚æ­¥å°è¯•è·å–é”
        return lock.tryLockAsync(10, 30, TimeUnit.SECONDS)
            .thenCompose(acquired -> {
                if (!acquired) {
                    return CompletableFuture.completedFuture("è·å–é”å¤±è´¥");
                }
                
                // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                return CompletableFuture.supplyAsync(() -> {
                    try {
                        // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
                        Thread.sleep(2000);
                        return "è®¢å•å¤„ç†å®Œæˆ: " + orderId;
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                        return "å¤„ç†è¢«ä¸­æ–­";
                    }
                }).whenComplete((result, throwable) -> {
                    // ç¡®ä¿é”è¢«é‡Šæ”¾
                    if (lock.isHeldByCurrentThread()) {
                        lock.unlock();
                    }
                });
            });
    }
}
```

> ğŸ’¡ **å¼‚æ­¥æ“ä½œçš„å¥½å¤„**  
> â€¢ æé«˜ç³»ç»Ÿååé‡ï¼Œä¸é˜»å¡çº¿ç¨‹  
> â€¢ æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡  
> â€¢ é€‚åˆé«˜å¹¶å‘åœºæ™¯

### 6.4 é”çš„è¿‡æœŸæ—¶é—´ç­–ç•¥

```java
@Service
public class LockTimeoutService {
    
    @Autowired  
    private RedissonClient redissonClient;
    
    // ä¸åŒä¸šåŠ¡åœºæ™¯çš„è¶…æ—¶é…ç½®
    public void handleDifferentScenarios() {
        
        // åœºæ™¯1: å¿«é€Ÿæ“ä½œï¼ŒçŸ­è¶…æ—¶
        RLock quickLock = redissonClient.getLock("quick_operation");
        try {
            quickLock.tryLock(1, 5, TimeUnit.SECONDS); // ç­‰1ç§’ï¼Œé”5ç§’
            // å¿«é€Ÿä¸šåŠ¡é€»è¾‘
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            if (quickLock.isHeldByCurrentThread()) {
                quickLock.unlock();
            }
        }
        
        // åœºæ™¯2: å¤æ‚æ“ä½œï¼Œé•¿è¶…æ—¶
        RLock complexLock = redissonClient.getLock("complex_operation");
        try {
            complexLock.tryLock(30, 300, TimeUnit.SECONDS); // ç­‰30ç§’ï¼Œé”5åˆ†é’Ÿ
            // å¤æ‚ä¸šåŠ¡é€»è¾‘
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        } finally {
            if (complexLock.isHeldByCurrentThread()) {
                complexLock.unlock();
            }
        }
        
        // åœºæ™¯3: è‡ªåŠ¨ç»­æœŸé”ï¼ˆçœ‹é—¨ç‹—æœºåˆ¶ï¼‰
        RLock autoRenewLock = redissonClient.getLock("auto_renew_operation");
        try {
            autoRenewLock.lock(); // æ²¡æœ‰æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨ç»­æœŸ
            // é•¿æ—¶é—´è¿è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼ŒRedissonä¼šè‡ªåŠ¨ç»­æœŸ
        } finally {
            autoRenewLock.unlock();
        }
    }
}
```

**çœ‹é—¨ç‹—æœºåˆ¶ç†è§£**ï¼š
```
çœ‹é—¨ç‹—è‡ªåŠ¨ç»­æœŸè¿‡ç¨‹ï¼š

è·å–é” â†’ è®¾ç½®30ç§’è¿‡æœŸ â†’ å¼€å§‹ä¸šåŠ¡å¤„ç†
   â†“
20ç§’å â†’ ä¸šåŠ¡è¿˜åœ¨æ‰§è¡Œ â†’ è‡ªåŠ¨ç»­æœŸ30ç§’  
   â†“
20ç§’å â†’ ä¸šåŠ¡è¿˜åœ¨æ‰§è¡Œ â†’ å†æ¬¡ç»­æœŸ30ç§’
   â†“
ä¸šåŠ¡å®Œæˆ â†’ unlock() â†’ åœæ­¢ç»­æœŸï¼Œåˆ é™¤é”

å¥½å¤„ï¼šé¿å…ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿å¯¼è‡´é”æå‰é‡Šæ”¾
```

---

## 7. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜


### 7.1 é”æ€§èƒ½ç›‘æ§

```java
@Component
public class LockMonitor {
    
    private static final Logger logger = LoggerFactory.getLogger(LockMonitor.class);
    
    @Autowired
    private RedissonClient redissonClient;
    
    // ç›‘æ§é”çš„è·å–æ€§èƒ½
    public void monitorLockPerformance(String lockName, Runnable business) {
        RLock lock = redissonClient.getLock(lockName);
        
        // è®°å½•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        boolean acquired = false;
        
        try {
            acquired = lock.tryLock(10, 30, TimeUnit.SECONDS);
            
            if (!acquired) {
                logger.warn("é”è·å–å¤±è´¥: {}, è€—æ—¶: {}ms", lockName, 
                    System.currentTimeMillis() - startTime);
                return;
            }
            
            long lockTime = System.currentTimeMillis();
            logger.info("é”è·å–æˆåŠŸ: {}, ç­‰å¾…æ—¶é—´: {}ms", lockName, lockTime - startTime);
            
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            business.run();
            
            long businessTime = System.currentTimeMillis();
            logger.info("ä¸šåŠ¡æ‰§è¡Œå®Œæˆ: {}, æ‰§è¡Œæ—¶é—´: {}ms", lockName, businessTime - lockTime);
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            logger.error("é”è·å–è¢«ä¸­æ–­: {}", lockName, e);
        } finally {
            if (acquired && lock.isHeldByCurrentThread()) {
                lock.unlock();
                logger.info("é”é‡Šæ”¾å®Œæˆ: {}, æ€»è€—æ—¶: {}ms", lockName, 
                    System.currentTimeMillis() - startTime);
            }
        }
    }
}
```

### 7.2 æ€§èƒ½æŒ‡æ ‡æ”¶é›†

```java
@Component  
public class RedissonMetrics {
    
    @Autowired
    private RedissonClient redissonClient;
    
    // è·å–è¿æ¥æ± çŠ¶æ€
    public void logConnectionPoolStatus() {
        if (redissonClient.getConfig().useSingleServer() != null) {
            NodesGroup nodesGroup = redissonClient.getNodesGroup();
            
            logger.info("è¿æ¥æ± çŠ¶æ€ç»Ÿè®¡ï¼š");
            logger.info("æ€»è¿æ¥æ•°: {}", getTotalConnections(nodesGroup));
            logger.info("ç©ºé—²è¿æ¥æ•°: {}", getIdleConnections(nodesGroup));
            logger.info("æ´»è·ƒè¿æ¥æ•°: {}", getActiveConnections(nodesGroup));
        }
    }
    
    // ç›‘æ§é”ç«äº‰æƒ…å†µ
    public LockStats getLockStats(String lockName) {
        RLock lock = redissonClient.getLock(lockName);
        
        return LockStats.builder()
            .lockName(lockName)
            .isLocked(lock.isLocked())
            .holdCount(lock.getHoldCount())
            .remainTimeToLive(lock.remainTimeToLive())
            .build();
    }
    
    @Data
    @Builder
    public static class LockStats {
        private String lockName;
        private boolean isLocked;
        private int holdCount;  
        private long remainTimeToLive;
    }
}
```

### 7.3 æ€§èƒ½è°ƒä¼˜å»ºè®®

**è¿æ¥æ± è°ƒä¼˜**ï¼š
```
æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´è¿æ¥æ± å‚æ•°ï¼š

é«˜å¹¶å‘åœºæ™¯ï¼š
connectionPoolSize: 128-256
connectionMinimumIdleSize: 32-64  
timeout: 5000ms

æ™®é€šåº”ç”¨ï¼š
connectionPoolSize: 64
connectionMinimumIdleSize: 16
timeout: 3000ms

ä½å»¶è¿Ÿè¦æ±‚ï¼š  
connectionPoolSize: 32
connectionMinimumIdleSize: 8
timeout: 1000ms
```

**é”ç²’åº¦ä¼˜åŒ–**ï¼š
```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šé”ç²’åº¦å¤ªå¤§
public void badExample() {
    RLock lock = redissonClient.getLock("global_lock");
    try {
        lock.lock();
        // å¤„ç†ç”¨æˆ·Açš„è®¢å•
        // å¤„ç†ç”¨æˆ·Bçš„è®¢å•  
        // å¤„ç†ç”¨æˆ·Cçš„è®¢å•
    } finally {
        lock.unlock();
    }
}

// âœ… å¥½çš„åšæ³•ï¼šæŒ‰ç”¨æˆ·IDåˆ†é”
public void goodExample(String userId) {
    RLock lock = redissonClient.getLock("user_order:" + userId);
    try {
        lock.lock();
        // åªå¤„ç†ç‰¹å®šç”¨æˆ·çš„è®¢å•
    } finally {
        lock.unlock();
    }
}
```

> âš¡ **æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**  
> â€¢ åˆç†è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…è¿‡é•¿æˆ–è¿‡çŸ­  
> â€¢ ä½¿ç”¨åˆé€‚çš„é”ç²’åº¦ï¼Œé¿å…ä¸å¿…è¦çš„ç«äº‰  
> â€¢ ç›‘æ§é”çš„è·å–æˆåŠŸç‡å’Œç­‰å¾…æ—¶é—´  
> â€¢ åŠæ—¶é‡Šæ”¾é”ï¼Œé¿å…èµ„æºæµªè´¹

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ Redissonæœ¬è´¨ï¼šåŸºäºRedisçš„Javaåˆ†å¸ƒå¼å·¥å…·åŒ…ï¼Œç®€åŒ–åˆ†å¸ƒå¼ç¼–ç¨‹
ğŸ”¸ RLockæ¥å£ï¼šRedissonçš„åˆ†å¸ƒå¼é”æ ¸å¿ƒï¼Œæ”¯æŒå¯é‡å…¥ã€è¶…æ—¶ã€å¼‚æ­¥ç­‰ç‰¹æ€§  
ğŸ”¸ å¤šç§é”ç±»å‹ï¼šæ™®é€šé”ã€å…¬å¹³é”ã€è¯»å†™é”ã€ä¿¡å·é‡ã€é—­é”ç­‰ä¸åŒåº”ç”¨åœºæ™¯
ğŸ”¸ é…ç½®ä¼˜åŒ–ï¼šè¿æ¥æ± ã€è¶…æ—¶ã€é‡è¯•ç­‰å‚æ•°éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´
ğŸ”¸ æ€§èƒ½ç›‘æ§ï¼šå…³æ³¨é”è·å–æˆåŠŸç‡ã€ç­‰å¾…æ—¶é—´ã€ä¸šåŠ¡æ‰§è¡Œæ—¶é—´ç­‰æŒ‡æ ‡
```

### 8.2 å…³é”®ä½¿ç”¨è¦ç‚¹


**ğŸ”¹ é”çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†**
```
æ ‡å‡†ä½¿ç”¨æ¨¡å¼ï¼š
1. è·å–é”å¯¹è±¡ â†’ getLock()
2. å°è¯•åŠ é” â†’ tryLock() 
3. æ£€æŸ¥ç»“æœ â†’ åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ
4. æ‰§è¡Œä¸šåŠ¡ â†’ ä¸šåŠ¡é€»è¾‘ä»£ç 
5. é‡Šæ”¾é” â†’ unlock()ï¼ˆå¿…é¡»åœ¨finallyä¸­ï¼‰
```

**ğŸ”¹ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ**  
```java
// æ ‡å‡†æ¨¡æ¿
RLock lock = redissonClient.getLock(lockName);
try {
    if (!lock.tryLock(waitTime, expireTime, TimeUnit.SECONDS)) {
        // å¤„ç†è·å–é”å¤±è´¥çš„æƒ…å†µ
        return;
    }
    // ä¸šåŠ¡é€»è¾‘
} catch (InterruptedException e) {
    Thread.currentThread().interrupt();
    // å¤„ç†ä¸­æ–­å¼‚å¸¸
} finally {
    if (lock.isHeldByCurrentThread()) {
        lock.unlock();
    }
}
```

**ğŸ”¹ ä¸åŒé”ç±»å‹çš„é€‰æ‹©åŸåˆ™**
- **æ™®é€šé”RLock**ï¼šå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ï¼Œéœ€è¦ç‹¬å è®¿é—®
- **å…¬å¹³é”FairLock**ï¼šéœ€è¦æŒ‰è¯·æ±‚é¡ºåºå¤„ç†ï¼Œå¦‚æ’é˜Ÿç³»ç»Ÿ
- **è¯»å†™é”ReadWriteLock**ï¼šè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå¦‚ç¼“å­˜æ›´æ–°
- **ä¿¡å·é‡Semaphore**ï¼šéœ€è¦é™åˆ¶å¹¶å‘æ•°é‡ï¼Œå¦‚è¿æ¥æ± 
- **é—­é”CountDownLatch**ï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡å®Œæˆï¼Œå¦‚ç³»ç»Ÿåˆå§‹åŒ–

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- **æ•°æ®ä¸€è‡´æ€§**ï¼šé¿å…å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´
- **èµ„æºç«äº‰**ï¼šåˆç†åˆ†é…æœ‰é™çš„ç³»ç»Ÿèµ„æº  
- **ä¸šåŠ¡åè°ƒ**ï¼šåè°ƒåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ä¸šåŠ¡æµç¨‹
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡åˆç†çš„é”ç­–ç•¥æå‡ç³»ç»Ÿæ€§èƒ½

**ğŸš€ å¾®æœåŠ¡æ¶æ„ä¸­çš„ä»·å€¼**ï¼š
- **è·¨æœåŠ¡åè°ƒ**ï¼šä¸åŒæœåŠ¡é—´çš„èµ„æºè®¿é—®æ§åˆ¶
- **é«˜å¯ç”¨æ€§**ï¼šåŸºäºRedisé›†ç¾¤çš„é«˜å¯ç”¨åˆ†å¸ƒå¼é”
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæœåŠ¡æ°´å¹³æ‰©å±•è€Œä¸å½±å“é”æœºåˆ¶
- **ç›‘æ§è¿ç»´**ï¼šä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡å’Œè°ƒä¼˜å‚æ•°

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Redissonåˆ†å¸ƒå¼é”ï¼ŒJavaå¼€å‘å¥½å¸®æ‰‹
- è·å–é‡Šæ”¾è¦é…å¯¹ï¼Œå¼‚å¸¸å¤„ç†ä¸èƒ½å¿˜  
- é”ç±»å‹è¦é€‰å¯¹ï¼Œæ€§èƒ½ç›‘æ§å¾ˆé‡è¦
- é›†ç¾¤é…ç½®è¦åˆç†ï¼Œå‚æ•°è°ƒä¼˜ææ€§èƒ½

> ğŸ“ **æ–°æ‰‹å­¦ä¹ å»ºè®®**  
> 1. å…ˆä»åŸºç¡€çš„RLockå¼€å§‹å®è·µ  
> 2. ç†è§£å¯é‡å…¥çš„æ¦‚å¿µå’ŒåŸç†
> 3. æŒæ¡å¼‚å¸¸å¤„ç†çš„æ ‡å‡†æ¨¡å¼
> 4. æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„é”ç±»å‹
> 5. å…³æ³¨æ€§èƒ½ç›‘æ§å’Œå‚æ•°è°ƒä¼˜