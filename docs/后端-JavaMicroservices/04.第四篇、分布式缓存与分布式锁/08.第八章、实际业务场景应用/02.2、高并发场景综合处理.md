---
title: 2ã€é«˜å¹¶å‘åœºæ™¯ç»¼åˆå¤„ç†
---
## ğŸ“š ç›®å½•

1. [é«˜å¹¶å‘åœºæ™¯æ ¸å¿ƒæ¦‚å¿µ](#1-é«˜å¹¶å‘åœºæ™¯æ ¸å¿ƒæ¦‚å¿µ)
2. [çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸å¤„ç†](#2-çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸å¤„ç†)
3. [ç¼“å­˜é¢„çƒ­ç­–ç•¥è®¾è®¡](#3-ç¼“å­˜é¢„çƒ­ç­–ç•¥è®¾è®¡)
4. [æµé‡å‰Šå³°ä¸åˆ†æµæœºåˆ¶](#4-æµé‡å‰Šå³°ä¸åˆ†æµæœºåˆ¶)
5. [é™çº§ç­–ç•¥ä¸ç†”æ–­æœºåˆ¶](#5-é™çº§ç­–ç•¥ä¸ç†”æ–­æœºåˆ¶)
6. [å¼‚æ­¥å¤„ç†ä¸é˜Ÿåˆ—ç¼“å†²](#6-å¼‚æ­¥å¤„ç†ä¸é˜Ÿåˆ—ç¼“å†²)
7. [é™æµç®—æ³•æ·±åº¦åº”ç”¨](#7-é™æµç®—æ³•æ·±åº¦åº”ç”¨)
8. [ç›‘æ§å‘Šè­¦ä½“ç³»æ„å»º](#8-ç›‘æ§å‘Šè­¦ä½“ç³»æ„å»º)
9. [ç»¼åˆå®æˆ˜æ¡ˆä¾‹åˆ†æ](#9-ç»¼åˆå®æˆ˜æ¡ˆä¾‹åˆ†æ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŠ é«˜å¹¶å‘åœºæ™¯æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é«˜å¹¶å‘åœºæ™¯


> **ğŸ’¡ æ ¸å¿ƒç†è§£**  
> é«˜å¹¶å‘å°±åƒæ˜¥è¿æœŸé—´çš„ç«è½¦ç«™ï¼ŒåŒæ—¶æœ‰å¤§é‡ç”¨æˆ·ï¼ˆæ—…å®¢ï¼‰è¦ä½¿ç”¨ä½ çš„æœåŠ¡ï¼ˆä¹°ç¥¨è¿›ç«™ï¼‰ï¼Œå¦‚æœå¤„ç†ä¸å½“å°±ä¼šé€ æˆç³»ç»Ÿå´©æºƒï¼ˆè½¦ç«™ç˜«ç—ªï¼‰

**é«˜å¹¶å‘çš„æœ¬è´¨**ï¼š
```
æ™®é€šæƒ…å†µï¼š    é«˜å¹¶å‘æƒ…å†µï¼š
ç”¨æˆ·A â†’ ç³»ç»Ÿ   ç”¨æˆ·A â†˜
              ç”¨æˆ·B â†’ ç³»ç»Ÿ â† ç”¨æˆ·C
                    â†—
                  ç”¨æˆ·D

é—®é¢˜ï¼šç³»ç»Ÿæ‰¿è½½èƒ½åŠ›æœ‰é™ï¼ŒåŒæ—¶å¤„ç†è¯·æ±‚è¿‡å¤šä¼šå¯¼è‡´å“åº”å˜æ…¢ç”šè‡³å´©æºƒ
```

### 1.2 é«˜å¹¶å‘åœºæ™¯çš„å…¸å‹ç‰¹å¾


**ğŸ“Š å¹¶å‘åœºæ™¯è¯†åˆ«è¡¨**ï¼š

| åœºæ™¯ç±»å‹ | **å¹¶å‘ç‰¹ç‚¹** | **å…¸å‹QPS** | **ä¸»è¦æŒ‘æˆ˜** |
|---------|-------------|------------|-------------|
| ğŸ›’ **ç”µå•†ç§’æ€** | `ç¬æ—¶æµé‡æš´å¢` | `10ä¸‡+/ç§’` | `åº“å­˜è¶…å–ã€ç³»ç»Ÿå´©æºƒ` |
| ğŸ« **æŠ¢ç¥¨ç³»ç»Ÿ** | `é›†ä¸­æ—¶é—´è®¿é—®` | `50ä¸‡+/ç§’` | `å“åº”è¶…æ—¶ã€æ•°æ®ä¸€è‡´æ€§` |
| ğŸ“± **ç¤¾äº¤çƒ­ç‚¹** | `ç—…æ¯’å¼ä¼ æ’­` | `20ä¸‡+/ç§’` | `ç¼“å­˜ç©¿é€ã€DBå‹åŠ›` |
| ğŸ® **æ¸¸æˆæ´»åŠ¨** | `å‘¨æœŸæ€§é«˜å³°` | `5ä¸‡+/ç§’` | `çŠ¶æ€åŒæ­¥ã€æ’é˜Ÿæœºåˆ¶` |

### 1.3 é«˜å¹¶å‘å¤„ç†çš„æ ¸å¿ƒæ€æƒ³


> **ğŸ” æ·±å…¥æ€è€ƒ**  
> å¤„ç†é«˜å¹¶å‘ä¸æ˜¯è®©ç³»ç»Ÿå˜å¾—æ›´å¼ºï¼Œè€Œæ˜¯è®©ç³»ç»Ÿå˜å¾—æ›´èªæ˜ - è¯¥å¿«çš„å¿«ï¼Œè¯¥æ…¢çš„æ…¢ï¼Œè¯¥æ‹’ç»çš„æ‹’ç»

**æ ¸å¿ƒç­–ç•¥æ¶æ„**ï¼š
```
ç”¨æˆ·è¯·æ±‚æµé‡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é™æµç½‘å…³   â”‚ â† ç¬¬ä¸€é“é˜²çº¿ï¼šæ§åˆ¶è¿›å…¥æµé‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼“å­˜å±‚    â”‚ â† ç¬¬äºŒé“é˜²çº¿ï¼šå¿«é€Ÿå“åº”çƒ­ç‚¹æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡å±‚    â”‚ â† ç¬¬ä¸‰é“é˜²çº¿ï¼šæ ¸å¿ƒä¸šåŠ¡å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®å±‚    â”‚ â† æœ€åé˜²çº¿ï¼šæ•°æ®æŒä¹…åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”¥ çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸å¤„ç†


### 2.1 çƒ­ç‚¹æ•°æ®çš„è¯†åˆ«åŸç†


**ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®**ï¼š
å°±åƒå•†åœºé‡Œçš„çˆ†æ¬¾å•†å“ï¼Œå¤§å®¶éƒ½æƒ³è¦ï¼Œè®¿é—®é¢‘ç‡ç‰¹åˆ«é«˜çš„æ•°æ®å°±æ˜¯çƒ­ç‚¹æ•°æ®ã€‚

> **ğŸ’¡ æ ¸å¿ƒç†è§£**  
> çƒ­ç‚¹æ•°æ®éµå¾ª"äºŒå…«å®šå¾‹"ï¼š80%çš„è®¿é—®è¯·æ±‚é›†ä¸­åœ¨20%çš„æ•°æ®ä¸Š

**çƒ­ç‚¹æ•°æ®è¯†åˆ«æ–¹æ³•**ï¼š

```java
// åŸºäºè®¿é—®ç»Ÿè®¡çš„çƒ­ç‚¹è¯†åˆ«
@Component
public class HotDataDetector {
    
    // è®¿é—®è®¡æ•°å™¨ï¼ˆæ»‘åŠ¨çª—å£ï¼‰
    private final Map<String, AtomicLong> accessCounter = new ConcurrentHashMap<>();
    
    // çƒ­ç‚¹é˜ˆå€¼ï¼š1åˆ†é’Ÿå†…è®¿é—®è¶…è¿‡1000æ¬¡
    private static final long HOT_THRESHOLD = 1000L;
    
    /**
     * è®°å½•æ•°æ®è®¿é—®
     * @param dataKey æ•°æ®é”®
     * @return æ˜¯å¦ä¸ºçƒ­ç‚¹æ•°æ®
     */
    public boolean recordAccess(String dataKey) {
        long currentCount = accessCounter.computeIfAbsent(dataKey, 
            k -> new AtomicLong(0)).incrementAndGet();
        
        // åˆ¤æ–­æ˜¯å¦è¾¾åˆ°çƒ­ç‚¹é˜ˆå€¼
        return currentCount > HOT_THRESHOLD;
    }
}
```

### 2.2 çƒ­ç‚¹æ•°æ®å¤„ç†ç­–ç•¥


**ğŸ”„ çƒ­ç‚¹å¤„ç†å¯¹æ¯”**ï¼š

```
ä¼ ç»Ÿå¤„ç†æ–¹å¼          çƒ­ç‚¹æ•°æ®å¤„ç†æ–¹å¼
ç”¨æˆ·è¯·æ±‚ â†’ æ•°æ®åº“      ç”¨æˆ·è¯·æ±‚ â†’ ç¼“å­˜ â†’ æ•°æ®åº“
     â†“                      â†“         â†“
 å“åº”æ—¶é—´é•¿              å“åº”æ—¶é—´çŸ­   å¤‡ç”¨æ–¹æ¡ˆ
 å®¹æ˜“å‹å®æ•°æ®åº“          ä¿æŠ¤æ•°æ®åº“   ä¿è¯å¯ç”¨æ€§
```

**å¤šçº§ç¼“å­˜æ¶æ„**ï¼š

```java
@Service
public class HotDataService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // æœ¬åœ°ç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜ï¼‰
    private final Cache<String, Object> localCache = 
        CacheBuilder.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(5, TimeUnit.MINUTES)
            .build();
    
    /**
     * å¤šçº§ç¼“å­˜æŸ¥è¯¢
     */
    public Object getHotData(String key) {
        // 1. å…ˆæŸ¥æœ¬åœ°ç¼“å­˜
        Object data = localCache.getIfPresent(key);
        if (data != null) {
            return data;
        }
        
        // 2. æŸ¥Redisç¼“å­˜
        data = redisTemplate.opsForValue().get(key);
        if (data != null) {
            // å›å†™æœ¬åœ°ç¼“å­˜
            localCache.put(key, data);
            return data;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“å¹¶ç¼“å­˜
        data = queryFromDatabase(key);
        if (data != null) {
            // å†™å…¥å¤šçº§ç¼“å­˜
            redisTemplate.opsForValue().set(key, data, 10, TimeUnit.MINUTES);
            localCache.put(key, data);
        }
        
        return data;
    }
}
```

### 2.3 çƒ­ç‚¹æ•°æ®é¢„åŠ è½½æœºåˆ¶


> **ğŸ“Œ å®è·µè¦ç‚¹**  
> é¢„åŠ è½½å°±åƒæå‰å‡†å¤‡å¹´å¤œé¥­ï¼ŒæŠŠå¯èƒ½ç”¨åˆ°çš„èœå“æå‰åšå¥½ï¼Œå®¢äººæ¥äº†ç›´æ¥ä¸Šæ¡Œ

**é¢„åŠ è½½ç­–ç•¥**ï¼š

| é¢„åŠ è½½ç±»å‹ | **è§¦å‘æ¡ä»¶** | **é€‚ç”¨åœºæ™¯** | **å®ç°éš¾åº¦** |
|-----------|-------------|-------------|-------------|
| ğŸ• **å®šæ—¶é¢„åŠ è½½** | `å®šæ—¶ä»»åŠ¡è§¦å‘` | `å¯é¢„æµ‹çš„çƒ­ç‚¹` | `ç®€å•` |
| ğŸ“Š **ç»Ÿè®¡é¢„åŠ è½½** | `è®¿é—®é‡è¾¾åˆ°é˜ˆå€¼` | `åŠ¨æ€çƒ­ç‚¹æ•°æ®` | `ä¸­ç­‰` |
| ğŸ¯ **ä¸šåŠ¡é¢„åŠ è½½** | `ä¸šåŠ¡äº‹ä»¶è§¦å‘` | `ç§’æ€ã€æ´»åŠ¨ç­‰` | `å¤æ‚` |

---

## 3. â™¨ï¸ ç¼“å­˜é¢„çƒ­ç­–ç•¥è®¾è®¡


### 3.1 ç¼“å­˜é¢„çƒ­çš„æ ¸å¿ƒåŸç†


**ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜é¢„çƒ­**ï¼š
```
æ²¡æœ‰é¢„çƒ­çš„æƒ…å†µï¼š
ç”¨æˆ·è®¿é—® â†’ ç¼“å­˜ç©º â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ å†™å…¥ç¼“å­˜ â†’ è¿”å›æ•°æ®
          â†‘
        ç¼“å­˜ç©¿é€

æœ‰é¢„çƒ­çš„æƒ…å†µï¼š
æå‰åŠ è½½ â†’ ç¼“å­˜æ»¡ â†’ ç”¨æˆ·è®¿é—® â†’ ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®
                    â†‘
                 å“åº”è¿…é€Ÿ
```

### 3.2 é¢„çƒ­ç­–ç•¥çš„åˆ†ç±»å®ç°


**ğŸ”§ å®šæ—¶é¢„çƒ­å®ç°**ï¼š

```java
@Component
public class CacheWarmupScheduler {
    
    @Autowired
    private ProductService productService;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æ¯å¤©å‡Œæ™¨2ç‚¹é¢„çƒ­å•†å“æ•°æ®
     */
    @Scheduled(cron = "0 0 2 * * ?")
    public void warmupProductCache() {
        log.info("å¼€å§‹é¢„çƒ­å•†å“ç¼“å­˜");
        
        // è·å–çƒ­é—¨å•†å“åˆ—è¡¨
        List<Product> hotProducts = productService.getHotProducts();
        
        for (Product product : hotProducts) {
            String cacheKey = "product:" + product.getId();
            // é¢„åŠ è½½åˆ°ç¼“å­˜
            redisTemplate.opsForValue().set(cacheKey, product, 
                Duration.ofHours(12));
        }
        
        log.info("å•†å“ç¼“å­˜é¢„çƒ­å®Œæˆï¼Œé¢„çƒ­æ•°é‡ï¼š{}", hotProducts.size());
    }
}
```

**ğŸ“Š æ™ºèƒ½é¢„çƒ­å®ç°**ï¼š

```java
@Service
public class IntelligentWarmupService {
    
    /**
     * åŸºäºè®¿é—®æ¨¡å¼çš„æ™ºèƒ½é¢„çƒ­
     */
    public void intelligentWarmup() {
        // 1. åˆ†æè®¿é—®æ¨¡å¼
        List<AccessPattern> patterns = analyzeAccessPatterns();
        
        // 2. é¢„æµ‹å³å°†å˜çƒ­çš„æ•°æ®
        List<String> predictedHotKeys = predictHotData(patterns);
        
        // 3. å¼‚æ­¥é¢„åŠ è½½
        CompletableFuture.runAsync(() -> {
            predictedHotKeys.forEach(this::preloadData);
        });
    }
    
    /**
     * é¢„åŠ è½½å•ä¸ªæ•°æ®
     */
    private void preloadData(String key) {
        // é¿å…é¢„çƒ­æ—¶çš„å¹¶å‘é—®é¢˜
        String lockKey = "warmup:lock:" + key;
        try (RedisLock lock = new RedisLock(lockKey, 30)) {
            if (lock.tryLock()) {
                Object data = loadDataFromSource(key);
                if (data != null) {
                    cacheData(key, data);
                }
            }
        }
    }
}
```

### 3.3 é¢„çƒ­è¿‡ç¨‹çš„ç›‘æ§ä¸ä¼˜åŒ–


> **âš ï¸ å¸¸è§è¯¯åŒº**  
> é¢„çƒ­ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¿‡åº¦é¢„çƒ­ä¼šå ç”¨è¿‡å¤šå†…å­˜èµ„æºï¼Œè¦æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚åˆç†è®¾ç½®

**é¢„çƒ­æ•ˆæœç›‘æ§**ï¼š

```
é¢„çƒ­å‰åå¯¹æ¯”ï¼š
               é¢„çƒ­å‰    é¢„çƒ­å
ç¼“å­˜å‘½ä¸­ç‡ï¼š     20%      95%
å¹³å‡å“åº”æ—¶é—´ï¼š   200ms    50ms
æ•°æ®åº“å‹åŠ›ï¼š     é«˜       ä½
ç³»ç»Ÿç¨³å®šæ€§ï¼š     ä¸€èˆ¬     ä¼˜ç§€
```

---

## 4. âš¡ æµé‡å‰Šå³°ä¸åˆ†æµæœºåˆ¶


### 4.1 æµé‡å‰Šå³°çš„åŸºæœ¬åŸç†


**å‰Šå³°å°±åƒæ°´åº“è°ƒèŠ‚æ´ªæ°´**ï¼š
```
åŸå§‹æµé‡ï¼š     å‰Šå³°åæµé‡ï¼š
    â–²             â–²
    â”‚ â”‚           â”‚â”€â”
    â”‚ â”‚           â”‚ â”‚
    â”‚ â”‚           â”‚ â””â”€â”
â”€â”€â”€â”€â”´â”€â”´â”€â”€â”€      â”€â”€â”´â”€â”€â”€â””â”€â”€â”€â”€â”€
   ç¬æ—¶é«˜å³°        å¹³ç¨³å¤„ç†
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**  
> å‰Šå³°ä¸æ˜¯æ‹’ç»ç”¨æˆ·ï¼Œè€Œæ˜¯è®©ç”¨æˆ·æ’é˜Ÿï¼ŒæŠŠç¬æ—¶çš„é«˜å¹¶å‘å˜æˆæŒç»­çš„ç¨³å®šå¤„ç†

### 4.2 å‰Šå³°æŠ€æœ¯çš„å…·ä½“å®ç°


**ğŸš¦ ä»¤ç‰Œæ¡¶å‰Šå³°ç®—æ³•**ï¼š

```java
@Component
public class TokenBucketLimiter {
    
    // æ¡¶å®¹é‡
    private final int capacity;
    // ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ï¼ˆæ¯ç§’ï¼‰
    private final int refillRate;
    // å½“å‰ä»¤ç‰Œæ•°
    private volatile int tokens;
    // ä¸Šæ¬¡æ›´æ–°æ—¶é—´
    private volatile long lastRefillTime;
    
    public TokenBucketLimiter(int capacity, int refillRate) {
        this.capacity = capacity;
        this.refillRate = refillRate;
        this.tokens = capacity;
        this.lastRefillTime = System.currentTimeMillis();
    }
    
    /**
     * å°è¯•è·å–ä»¤ç‰Œ
     */
    public boolean tryAcquire() {
        synchronized (this) {
            // 1. å…ˆè¡¥å……ä»¤ç‰Œ
            refillTokens();
            
            // 2. å°è¯•è·å–ä»¤ç‰Œ
            if (tokens > 0) {
                tokens--;
                return true;  // è·å–æˆåŠŸï¼Œå¯ä»¥å¤„ç†è¯·æ±‚
            }
            return false;     // è·å–å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…
        }
    }
    
    private void refillTokens() {
        long now = System.currentTimeMillis();
        long timeElapsed = now - lastRefillTime;
        
        if (timeElapsed > 1000) { // è¶…è¿‡1ç§’æ‰è¡¥å……
            int tokensToAdd = (int) (timeElapsed / 1000 * refillRate);
            tokens = Math.min(capacity, tokens + tokensToAdd);
            lastRefillTime = now;
        }
    }
}
```

**ğŸ“¡ åˆ†æµæœºåˆ¶å®ç°**ï¼š

```java
@RestController
public class TrafficShardingController {
    
    @Autowired
    private List<OrderService> orderServiceList;  // å¤šä¸ªæœåŠ¡å®ä¾‹
    
    /**
     * åŸºäºç”¨æˆ·IDçš„åˆ†æµå¤„ç†
     */
    @PostMapping("/order")
    public ResponseEntity<?> createOrder(@RequestBody OrderRequest request) {
        // 1. æ ¹æ®ç”¨æˆ·IDè¿›è¡Œåˆ†æµ
        int shardIndex = Math.abs(request.getUserId().hashCode()) 
                        % orderServiceList.size();
        
        // 2. é€‰æ‹©å¯¹åº”çš„æœåŠ¡å®ä¾‹
        OrderService targetService = orderServiceList.get(shardIndex);
        
        // 3. å¤„ç†è®¢å•
        try {
            Order order = targetService.createOrder(request);
            return ResponseEntity.ok(order);
        } catch (Exception e) {
            // 4. å¤±è´¥æ—¶çš„é™çº§å¤„ç†
            return handleOrderFailure(request, e);
        }
    }
}
```

### 4.3 é˜Ÿåˆ—åŒ–å‰Šå³°å¤„ç†


**æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°æ¶æ„**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘å…³é™æµ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ ä¸šåŠ¡å¤„ç† â†’ ç»“æœé€šçŸ¥
   â†“         â†“         â†“         â†“         â†“
 10ä¸‡/ç§’   5000/ç§’   é˜Ÿåˆ—ç¼“å†²   1000/ç§’   å¼‚æ­¥é€šçŸ¥
```

---

## 5. ğŸ›¡ï¸ é™çº§ç­–ç•¥ä¸ç†”æ–­æœºåˆ¶


### 5.1 æœåŠ¡é™çº§çš„æ ¸å¿ƒæ€æƒ³


**é™çº§å°±åƒåº”æ€¥é¢„æ¡ˆ**ï¼š
```
æ­£å¸¸æƒ…å†µï¼šå®Œæ•´æœåŠ¡
å¼‚å¸¸æƒ…å†µï¼šæ ¸å¿ƒæœåŠ¡ + é™çº§å“åº”

ä¸¾ä¾‹ï¼š
æ­£å¸¸ï¼šæ˜¾ç¤ºå•†å“è¯¦æƒ… + æ¨èå•†å“ + ç”¨æˆ·è¯„ä»· + ç›¸å…³å•†å“
é™çº§ï¼šæ˜¾ç¤ºå•†å“è¯¦æƒ… + "æ¨èåŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨"
```

> **ğŸ” æ·±å…¥æ€è€ƒ**  
> é™çº§çš„ç›®æ ‡æ˜¯ä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼Œéæ ¸å¿ƒåŠŸèƒ½å¯ä»¥æš‚æ—¶ç‰ºç‰²

### 5.2 å¤šçº§é™çº§ç­–ç•¥è®¾è®¡


**ğŸ”„ é™çº§ç­‰çº§åˆ’åˆ†**ï¼š

| é™çº§ç­‰çº§ | **ä¿ç•™åŠŸèƒ½** | **å…³é—­åŠŸèƒ½** | **è§¦å‘æ¡ä»¶** |
|---------|-------------|-------------|-------------|
| ğŸŸ¢ **ä¸€çº§é™çº§** | `æ ¸å¿ƒä¸šåŠ¡+éƒ¨åˆ†å¢å€¼` | `ä¸ªæ€§åŒ–æ¨è` | `å“åº”æ—¶é—´>500ms` |
| ğŸŸ¡ **äºŒçº§é™çº§** | `æ ¸å¿ƒä¸šåŠ¡+ç¼“å­˜æ•°æ®` | `å®æ—¶è®¡ç®—åŠŸèƒ½` | `é”™è¯¯ç‡>10%` |
| ğŸ”´ **ä¸‰çº§é™çº§** | `åŸºç¡€åŠŸèƒ½+é™æ€é¡µé¢` | `åŠ¨æ€å†…å®¹ç”Ÿæˆ` | `ç³»ç»Ÿå¯ç”¨æ€§<90%` |

**é™çº§å®ç°ç¤ºä¾‹**ï¼š

```java
@Service
public class ProductDetailService {
    
    @Autowired
    private CircuitBreaker circuitBreaker;
    
    /**
     * å¸¦é™çº§çš„å•†å“è¯¦æƒ…æŸ¥è¯¢
     */
    public ProductDetailVO getProductDetail(Long productId) {
        try {
            // å°è¯•è·å–å®Œæ•´çš„å•†å“è¯¦æƒ…
            return circuitBreaker.executeSupplier(() -> {
                return buildFullProductDetail(productId);
            });
        } catch (CircuitBreakerOpenException e) {
            // ç†”æ–­å¼€å¯æ—¶çš„é™çº§å¤„ç†
            return buildDegradedProductDetail(productId);
        }
    }
    
    /**
     * é™çº§ç‰ˆæœ¬ï¼šåªè¿”å›åŸºæœ¬ä¿¡æ¯
     */
    private ProductDetailVO buildDegradedProductDetail(Long productId) {
        ProductDetailVO detail = new ProductDetailVO();
        
        // åªè·å–ç¼“å­˜ä¸­çš„åŸºæœ¬ä¿¡æ¯
        Product product = getProductFromCache(productId);
        if (product != null) {
            detail.setProductName(product.getName());
            detail.setPrice(product.getPrice());
            detail.setStatus("åŸºç¡€ä¿¡æ¯ï¼ˆéƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨ï¼‰");
        } else {
            detail.setStatus("å•†å“ä¿¡æ¯æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        return detail;
    }
}
```

### 5.3 æ™ºèƒ½ç†”æ–­æœºåˆ¶


**ç†”æ–­å™¨çŠ¶æ€è½¬æ¢**ï¼š
```
å…³é—­çŠ¶æ€(CLOSED) â†’ åŠå¼€çŠ¶æ€(HALF_OPEN) â†’ å¼€å¯çŠ¶æ€(OPEN)
     â†‘                    â†“                    â†“
  æ¢å¤æ­£å¸¸              æµ‹è¯•æ¢å¤            å¿«é€Ÿå¤±è´¥
     â†–_________________ è¶…æ—¶æ¢å¤ _______________â†—
```

```java
@Component
public class IntelligentCircuitBreaker {
    
    private enum State { CLOSED, OPEN, HALF_OPEN }
    
    private volatile State state = State.CLOSED;
    private final AtomicInteger failureCount = new AtomicInteger(0);
    private volatile long lastFailureTime = 0;
    
    // é…ç½®å‚æ•°
    private final int failureThreshold = 10;      // å¤±è´¥é˜ˆå€¼
    private final long timeoutDuration = 60000;   // è¶…æ—¶æ—¶é—´(ms)
    
    public <T> T execute(Supplier<T> operation, Supplier<T> fallback) {
        if (state == State.OPEN) {
            // æ£€æŸ¥æ˜¯å¦å¯ä»¥è½¬ä¸ºåŠå¼€çŠ¶æ€
            if (System.currentTimeMillis() - lastFailureTime > timeoutDuration) {
                state = State.HALF_OPEN;
            } else {
                // å¿«é€Ÿå¤±è´¥ï¼Œæ‰§è¡Œé™çº§
                return fallback.get();
            }
        }
        
        try {
            T result = operation.get();
            onSuccess();  // æ‰§è¡ŒæˆåŠŸ
            return result;
        } catch (Exception e) {
            onFailure();  // æ‰§è¡Œå¤±è´¥
            return fallback.get();
        }
    }
    
    private void onSuccess() {
        failureCount.set(0);
        state = State.CLOSED;
    }
    
    private void onFailure() {
        lastFailureTime = System.currentTimeMillis();
        
        if (failureCount.incrementAndGet() >= failureThreshold) {
            state = State.OPEN;
        }
    }
}
```

---

## 6. ğŸš€ å¼‚æ­¥å¤„ç†ä¸é˜Ÿåˆ—ç¼“å†²


### 6.1 å¼‚æ­¥å¤„ç†çš„æ ¸å¿ƒä»·å€¼


**åŒæ­¥ vs å¼‚æ­¥å¤„ç†å¯¹æ¯”**ï¼š
```
åŒæ­¥å¤„ç†ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ å¤„ç†é€»è¾‘1 â†’ å¤„ç†é€»è¾‘2 â†’ å¤„ç†é€»è¾‘3 â†’ è¿”å›ç»“æœ
          (100ms)     (200ms)     (300ms)     (æ€»å…±600ms)

å¼‚æ­¥å¤„ç†ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ å¿«é€Ÿå“åº” (50ms)
          â†“
         é˜Ÿåˆ— â†’ å¤„ç†é€»è¾‘1 â†’ å¤„ç†é€»è¾‘2 â†’ å¤„ç†é€»è¾‘3 â†’ ç»“æœé€šçŸ¥
               (åå°å¼‚æ­¥æ‰§è¡Œï¼Œç”¨æˆ·æ— éœ€ç­‰å¾…)
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**  
> å¼‚æ­¥å¤„ç†æŠŠ"å¿…é¡»ç«‹å³å®Œæˆ"å’Œ"å¯ä»¥ç¨åå®Œæˆ"çš„å·¥ä½œåˆ†å¼€ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### 6.2 æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²è®¾è®¡


**ğŸ“Š é˜Ÿåˆ—é€‰å‹å¯¹æ¯”**ï¼š

| é˜Ÿåˆ—ç±»å‹ | **æ€§èƒ½ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å¤æ‚åº¦** |
|---------|-------------|-------------|-----------|
| ğŸ”„ **RabbitMQ** | `é«˜å¯é æ€§` | `é‡‘èäº¤æ˜“` | `ä¸­ç­‰` |
| âš¡ **RocketMQ** | `é«˜ååé‡` | `ç”µå•†è®¢å•` | `ä¸­ç­‰` |
| ğŸš€ **Kafka** | `è¶…é«˜æ€§èƒ½` | `æ—¥å¿—æ”¶é›†` | `å¤æ‚` |

**é˜Ÿåˆ—ç¼“å†²å®ç°**ï¼š

```java
@Service
public class AsyncOrderProcessor {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    /**
     * å¼‚æ­¥å¤„ç†è®¢å•åˆ›å»º
     */
    @Transactional
    public OrderResponse createOrderAsync(OrderRequest request) {
        // 1. å¿«é€Ÿåˆ›å»ºè®¢å•è®°å½•ï¼ˆçŠ¶æ€ï¼šå¾…å¤„ç†ï¼‰
        Order order = createPendingOrder(request);
        
        // 2. å‘é€åˆ°é˜Ÿåˆ—å¼‚æ­¥å¤„ç†
        OrderMessage message = new OrderMessage();
        message.setOrderId(order.getId());
        message.setUserId(request.getUserId());
        message.setProductId(request.getProductId());
        
        rabbitTemplate.convertAndSend("order.process.queue", message);
        
        // 3. ç«‹å³è¿”å›å“åº”
        OrderResponse response = new OrderResponse();
        response.setOrderId(order.getId());
        response.setStatus("è®¢å•å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­");
        response.setEstimatedTime("é¢„è®¡3-5åˆ†é’Ÿå®Œæˆ");
        
        return response;
    }
    
    /**
     * å¼‚æ­¥å¤„ç†è®¢å•çš„å…·ä½“é€»è¾‘
     */
    @RabbitListener(queues = "order.process.queue")
    public void processOrder(OrderMessage message) {
        try {
            // 1. æ£€æŸ¥åº“å­˜
            if (!checkInventory(message.getProductId(), message.getQuantity())) {
                updateOrderStatus(message.getOrderId(), "åº“å­˜ä¸è¶³ï¼Œè®¢å•å–æ¶ˆ");
                return;
            }
            
            // 2. æ‰£å‡åº“å­˜
            deductInventory(message.getProductId(), message.getQuantity());
            
            // 3. åˆ›å»ºæ”¯ä»˜è®¢å•
            createPaymentOrder(message);
            
            // 4. æ›´æ–°è®¢å•çŠ¶æ€
            updateOrderStatus(message.getOrderId(), "å¾…æ”¯ä»˜");
            
            // 5. å‘é€é€šçŸ¥
            sendNotificationToUser(message.getUserId(), "è®¢å•åˆ›å»ºæˆåŠŸï¼Œè¯·åŠæ—¶æ”¯ä»˜");
            
        } catch (Exception e) {
            // å¼‚å¸¸å¤„ç†å’Œè¡¥å¿
            handleOrderProcessFailure(message, e);
        }
    }
}
```

### 6.3 å¼‚æ­¥å¤„ç†çš„å¯é æ€§ä¿è¯


> **ğŸ“Œ å®è·µè¦ç‚¹**  
> å¼‚æ­¥å¤„ç†è¦è€ƒè™‘æ¶ˆæ¯ä¸¢å¤±ã€é‡å¤æ¶ˆè´¹ã€å¤„ç†å¤±è´¥ç­‰é—®é¢˜

**å¯é æ€§æœºåˆ¶**ï¼š

```java
@Component
public class ReliableAsyncProcessor {
    
    /**
     * å¸¦é‡è¯•çš„æ¶ˆæ¯å¤„ç†
     */
    @RabbitListener(queues = "order.process.queue")
    @RetryableTopic(
        attempts = "3",
        backoff = @Backoff(delay = 1000, multiplier = 2),
        dltStrategy = DltStrategy.FAIL_ON_ERROR
    )
    public void processOrderWithRetry(OrderMessage message) {
        // å¹‚ç­‰æ€§æ£€æŸ¥
        if (isAlreadyProcessed(message.getOrderId())) {
            log.info("è®¢å•{}å·²å¤„ç†ï¼Œè·³è¿‡", message.getOrderId());
            return;
        }
        
        try {
            // ä¸šåŠ¡å¤„ç†é€»è¾‘
            processOrderBusiness(message);
            
            // æ ‡è®°å·²å¤„ç†
            markAsProcessed(message.getOrderId());
            
        } catch (BusinessException e) {
            log.error("ä¸šåŠ¡å¤„ç†å¤±è´¥: {}", e.getMessage());
            throw e;  // è§¦å‘é‡è¯•
        }
    }
    
    /**
     * æ­»ä¿¡é˜Ÿåˆ—å¤„ç†
     */
    @RabbitListener(queues = "order.process.queue.DLT")
    public void handleDeadLetter(OrderMessage message) {
        log.error("è®¢å•{}å¤„ç†å¤±è´¥ï¼Œè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—", message.getOrderId());
        
        // è®°å½•å¤±è´¥åŸå› 
        recordFailureReason(message);
        
        // å‘é€å‘Šè­¦é€šçŸ¥
        sendAlertNotification(message);
        
        // å¯é€‰ï¼šäººå·¥ä»‹å…¥å¤„ç†
        createManualTask(message);
    }
}
```

---

## 7. ğŸš¦ é™æµç®—æ³•æ·±åº¦åº”ç”¨


### 7.1 é™æµç®—æ³•åŸç†å¯¹æ¯”


**å››å¤§é™æµç®—æ³•å¯¹æ¯”**ï¼š

```
å›ºå®šçª—å£ç®—æ³•ï¼š
æ—¶é—´: 0s   1s   2s   3s   4s
è¯·æ±‚: |||||-----|||||-----|||||
ç‰¹ç‚¹: ç®€å•ä½†æœ‰çªåˆºé—®é¢˜

æ»‘åŠ¨çª—å£ç®—æ³•ï¼š
æ—¶é—´: ====1s====|====1s====
è¯·æ±‚: ||--||--|--||--||--|
ç‰¹ç‚¹: å¹³æ»‘ä½†è®¡ç®—å¤æ‚

æ¼æ¡¶ç®—æ³•ï¼š
     è¯·æ±‚ -----> [æ¼æ¡¶] -----> åŒ€é€Ÿè¾“å‡º
ç‰¹ç‚¹: ä¸¥æ ¼é™é€Ÿï¼Œå‰Šå³°å¡«è°·

ä»¤ç‰Œæ¡¶ç®—æ³•ï¼š
     ä»¤ç‰Œç”Ÿæˆ -> [ä»¤ç‰Œæ¡¶] <- è¯·æ±‚è·å–ä»¤ç‰Œ
ç‰¹ç‚¹: å…è®¸çªå‘ï¼Œçµæ´»æ€§å¥½
```

### 7.2 åˆ†å¸ƒå¼é™æµå®ç°


**åŸºäºRedisçš„åˆ†å¸ƒå¼é™æµ**ï¼š

```java
@Component
public class DistributedRateLimiter {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * åŸºäºRedisçš„æ»‘åŠ¨çª—å£é™æµ
     * @param key é™æµé”®
     * @param windowSizeSeconds çª—å£å¤§å°ï¼ˆç§’ï¼‰
     * @param maxRequests æœ€å¤§è¯·æ±‚æ•°
     */
    public boolean tryAcquire(String key, int windowSizeSeconds, int maxRequests) {
        long now = System.currentTimeMillis();
        long windowStart = now - windowSizeSeconds * 1000L;
        
        // Luaè„šæœ¬ä¿è¯åŸå­æ€§
        String luaScript = 
            "redis.call('ZREMRANGEBYSCORE', KEYS[1], 0, ARGV[1]); " +
            "local count = redis.call('ZCARD', KEYS[1]); " +
            "if count < tonumber(ARGV[3]) then " +
            "  redis.call('ZADD', KEYS[1], ARGV[2], ARGV[2]); " +
            "  redis.call('EXPIRE', KEYS[1], ARGV[4]); " +
            "  return 1; " +
            "else " +
            "  return 0; " +
            "end";
        
        DefaultRedisScript<Long> redisScript = new DefaultRedisScript<>();
        redisScript.setScriptText(luaScript);
        redisScript.setResultType(Long.class);
        
        Long result = redisTemplate.execute(
            redisScript,
            Collections.singletonList(key),
            String.valueOf(windowStart),
            String.valueOf(now),
            String.valueOf(maxRequests),
            String.valueOf(windowSizeSeconds + 1)
        );
        
        return result != null && result == 1;
    }
}
```

### 7.3 å¤šç»´åº¦é™æµç­–ç•¥


> **ğŸ” æ·±å…¥æ€è€ƒ**  
> å®é™…ä¸šåŠ¡ä¸­éœ€è¦ä»å¤šä¸ªç»´åº¦è¿›è¡Œé™æµï¼šç”¨æˆ·ç»´åº¦ã€æ¥å£ç»´åº¦ã€IPç»´åº¦ç­‰

**å¤šç»´åº¦é™æµé…ç½®**ï¼š

```java
@RestController
public class ApiController {
    
    @Autowired
    private MultiDimensionRateLimiter rateLimiter;
    
    @PostMapping("/api/order")
    @RateLimit(
        userLimit = @Limit(rate = 10, per = 60),      // æ¯ç”¨æˆ·æ¯åˆ†é’Ÿ10æ¬¡
        ipLimit = @Limit(rate = 100, per = 60),       // æ¯IPæ¯åˆ†é’Ÿ100æ¬¡
        globalLimit = @Limit(rate = 10000, per = 60)  // å…¨å±€æ¯åˆ†é’Ÿ10000æ¬¡
    )
    public ResponseEntity<?> createOrder(@RequestBody OrderRequest request, 
                                       HttpServletRequest httpRequest) {
        
        String userId = request.getUserId();
        String clientIp = getClientIp(httpRequest);
        
        // å¤šç»´åº¦é™æµæ£€æŸ¥
        if (!rateLimiter.tryAcquire("user:" + userId, 10, 60) ||
            !rateLimiter.tryAcquire("ip:" + clientIp, 100, 60) ||
            !rateLimiter.tryAcquire("global:order", 10000, 60)) {
            
            return ResponseEntity.status(HttpStatus.TOO_MANY_REQUESTS)
                .body("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        // æ­£å¸¸å¤„ç†è®¢å•é€»è¾‘
        return processOrder(request);
    }
}
```

---

## 8. ğŸ“Š ç›‘æ§å‘Šè­¦ä½“ç³»æ„å»º


### 8.1 ç›‘æ§æŒ‡æ ‡ä½“ç³»è®¾è®¡


**ç›‘æ§æŒ‡æ ‡é‡‘å­—å¡”**ï¼š
```
              [ä¸šåŠ¡æŒ‡æ ‡]
             è®¢å•æˆåŠŸç‡ã€ç”¨æˆ·æ´»è·ƒåº¦
            â†—                    â†–
      [åº”ç”¨æŒ‡æ ‡]                [ç”¨æˆ·ä½“éªŒæŒ‡æ ‡]
   QPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡        é¡µé¢åŠ è½½æ—¶é—´ã€è½¬åŒ–ç‡
      â†—        â†–                  â†—        â†–
[ç³»ç»ŸæŒ‡æ ‡]    [ä¸­é—´ä»¶æŒ‡æ ‡]    [ç½‘ç»œæŒ‡æ ‡]   [æ•°æ®åº“æŒ‡æ ‡]
CPUã€å†…å­˜     Redisã€MQ       å¸¦å®½ã€å»¶è¿Ÿ    è¿æ¥æ•°ã€æ…¢æŸ¥è¯¢
```

### 8.2 å…³é”®ç›‘æ§æŒ‡æ ‡å®ç°


**ğŸ”§ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡æ”¶é›†**ï¼š

```java
@Component
public class PerformanceMonitor {
    
    private final MeterRegistry meterRegistry;
    
    // è¯·æ±‚è®¡æ•°å™¨
    private final Counter requestCounter;
    // å“åº”æ—¶é—´ç»Ÿè®¡
    private final Timer responseTimer;
    // é”™è¯¯ç‡ç»Ÿè®¡
    private final Counter errorCounter;
    
    public PerformanceMonitor(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.requestCounter = Counter.builder("api.requests.total")
            .description("Total API requests")
            .register(meterRegistry);
        this.responseTimer = Timer.builder("api.response.time")
            .description("API response time")
            .register(meterRegistry);
        this.errorCounter = Counter.builder("api.errors.total")
            .description("Total API errors")
            .register(meterRegistry);
    }
    
    /**
     * è®°å½•è¯·æ±‚æŒ‡æ ‡
     */
    public <T> T recordRequest(String operation, Supplier<T> supplier) {
        requestCounter.increment(Tags.of("operation", operation));
        
        return Timer.Sample.start(meterRegistry)
            .stop(responseTimer.withTag("operation", operation), () -> {
                try {
                    return supplier.get();
                } catch (Exception e) {
                    errorCounter.increment(Tags.of("operation", operation, 
                                                  "error", e.getClass().getSimpleName()));
                    throw e;
                }
            });
    }
}
```

### 8.3 æ™ºèƒ½å‘Šè­¦æœºåˆ¶


**ğŸ“¡ å¤šçº§å‘Šè­¦é…ç½®**ï¼š

| å‘Šè­¦çº§åˆ« | **è§¦å‘æ¡ä»¶** | **é€šçŸ¥æ–¹å¼** | **å¤„ç†æ—¶é—´** |
|---------|-------------|-------------|-------------|
| ğŸŸ¢ **ä¿¡æ¯** | `å“åº”æ—¶é—´>500ms` | `é‚®ä»¶é€šçŸ¥` | `24å°æ—¶å†…` |
| ğŸŸ¡ **è­¦å‘Š** | `é”™è¯¯ç‡>5%` | `çŸ­ä¿¡+é‚®ä»¶` | `2å°æ—¶å†…` |
| ğŸ”´ **ä¸¥é‡** | `ç³»ç»Ÿä¸å¯ç”¨` | `ç”µè¯+çŸ­ä¿¡+é‚®ä»¶` | `ç«‹å³å¤„ç†` |

```java
@Component
public class IntelligentAlertManager {
    
    /**
     * åŸºäºæœºå™¨å­¦ä¹ çš„å¼‚å¸¸æ£€æµ‹å‘Šè­¦
     */
    public void detectAnomalyAndAlert() {
        // 1. æ”¶é›†æœ€è¿‘çš„æŒ‡æ ‡æ•°æ®
        List<MetricData> recentMetrics = collectRecentMetrics();
        
        // 2. å¼‚å¸¸æ£€æµ‹ç®—æ³•
        AnomalyDetectionResult result = detectAnomalies(recentMetrics);
        
        // 3. æ ¹æ®å¼‚å¸¸ä¸¥é‡ç¨‹åº¦å‘é€å‘Šè­¦
        if (result.getSeverity() == Severity.CRITICAL) {
            sendCriticalAlert(result);
        } else if (result.getSeverity() == Severity.WARNING) {
            sendWarningAlert(result);
        }
        
        // 4. è‡ªåŠ¨åŒ–å¤„ç†ï¼ˆå¯é€‰ï¼‰
        if (result.isAutoFixable()) {
            attemptAutoRemediation(result);
        }
    }
    
    /**
     * å‘Šè­¦æ”¶æ•›æœºåˆ¶ï¼ˆé¿å…å‘Šè­¦é£æš´ï¼‰
     */
    private void sendConvergedAlert(AlertMessage alert) {
        String convergenceKey = alert.getType() + ":" + alert.getService();
        
        // æ£€æŸ¥æ˜¯å¦åœ¨æ”¶æ•›æ—¶é—´çª—å£å†…
        if (alertCache.isInConvergenceWindow(convergenceKey)) {
            // åˆå¹¶ç›¸ä¼¼å‘Šè­¦
            alertCache.mergeAlert(convergenceKey, alert);
        } else {
            // å‘é€å‘Šè­¦å¹¶å¼€å§‹æ–°çš„æ”¶æ•›çª—å£
            actualSendAlert(alert);
            alertCache.startConvergenceWindow(convergenceKey);
        }
    }
}
```

---

## 9. ğŸ¯ ç»¼åˆå®æˆ˜æ¡ˆä¾‹åˆ†æ


### 9.1 ç”µå•†ç§’æ€åœºæ™¯å®Œæ•´æ–¹æ¡ˆ


**ç§’æ€ç³»ç»Ÿæ¶æ„å›¾**ï¼š
```
ç”¨æˆ·è¯·æ±‚(100ä¸‡/ç§’)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CDN + é™æ€é¡µâ”‚ â† 90%é™æ€èµ„æºè¯·æ±‚è¢«æ‹¦æˆª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (10ä¸‡/ç§’)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APIç½‘å…³    â”‚ â† é™æµ + é‰´æƒ + åˆ†æµ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (5ä¸‡/ç§’)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼“å­˜å±‚     â”‚ â† å•†å“ä¿¡æ¯ç¼“å­˜ + åº“å­˜é¢„æ‰£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (1ä¸‡/ç§’)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡å±‚     â”‚ â† è®¢å•å¤„ç† + æ”¯ä»˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (å®é™…æˆäº¤5000/ç§’)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®å±‚     â”‚ â† æœ€ç»ˆæ•°æ®æŒä¹…åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Œæ•´å®ç°æ–¹æ¡ˆ**ï¼š

```java
@RestController
@RequestMapping("/seckill")
public class SeckillController {
    
    @Autowired
    private SeckillService seckillService;
    
    @Autowired
    private DistributedRateLimiter rateLimiter;
    
    /**
     * ç§’æ€æ¥å£ - ç»¼åˆè¿ç”¨æ‰€æœ‰é«˜å¹¶å‘æŠ€æœ¯
     */
    @PostMapping("/{productId}")
    @SeckillLimit(qps = 10000)  // æ¥å£çº§é™æµ
    public ResponseEntity<?> seckill(@PathVariable Long productId,
                                   @RequestBody SeckillRequest request,
                                   HttpServletRequest httpRequest) {
        
        String userId = request.getUserId();
        String clientIp = getClientIp(httpRequest);
        
        try {
            // 1. å¤šç»´åº¦é™æµæ£€æŸ¥
            if (!checkRateLimit(userId, clientIp, productId)) {
                return ResponseEntity.status(HttpStatus.TOO_MANY_REQUESTS)
                    .body("è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•");
            }
            
            // 2. åŸºç¡€æ ¡éªŒï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰
            if (!basicValidation(request)) {
                return ResponseEntity.badRequest()
                    .body("å‚æ•°æ ¡éªŒå¤±è´¥");
            }
            
            // 3. åº“å­˜é¢„æ£€æŸ¥ï¼ˆç¼“å­˜å±‚ï¼‰
            if (!preCheckInventory(productId)) {
                return ResponseEntity.ok()
                    .body(SeckillResponse.soldOut("å•†å“å·²å”®å®Œ"));
            }
            
            // 4. å¼‚æ­¥å¤„ç†ç§’æ€é€»è¾‘
            CompletableFuture<SeckillResult> futureResult = 
                seckillService.processSeckillAsync(productId, userId);
            
            // 5. å¿«é€Ÿå“åº”ï¼ˆä¸ç­‰å¾…æœ€ç»ˆç»“æœï¼‰
            return ResponseEntity.ok(SeckillResponse.processing(
                "ç§’æ€è¯·æ±‚å·²æäº¤ï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ"));
            
        } catch (Exception e) {
            // 6. å¼‚å¸¸é™çº§å¤„ç†
            return handleSeckillException(e);
        }
    }
    
    /**
     * å¤šç»´åº¦é™æµæ£€æŸ¥
     */
    private boolean checkRateLimit(String userId, String clientIp, Long productId) {
        return rateLimiter.tryAcquire("user:" + userId, 5, 60) &&        // ç”¨æˆ·é™æµ
               rateLimiter.tryAcquire("ip:" + clientIp, 50, 60) &&       // IPé™æµ
               rateLimiter.tryAcquire("product:" + productId, 10000, 60); // å•†å“é™æµ
    }
}
```

### 9.2 æ€§èƒ½ä¼˜åŒ–æ•ˆæœå¯¹æ¯”


> **ğŸ“Š ä¼˜åŒ–å‰åå¯¹æ¯”æ•°æ®**

**ç³»ç»Ÿæ€§èƒ½æå‡**ï¼š

```
ä¼˜åŒ–ç»´åº¦å¯¹æ¯”è¡¨ï¼š

                  ä¼˜åŒ–å‰      ä¼˜åŒ–å      æå‡å€æ•°
å¹³å‡å“åº”æ—¶é—´        2000ms      200ms        10x
ç³»ç»Ÿååé‡         1000 QPS   50000 QPS     50x
é”™è¯¯ç‡            15%         0.1%         150x
CPUä½¿ç”¨ç‡         85%         45%          1.9x
å†…å­˜ä½¿ç”¨ç‡        90%         60%          1.5x
æ•°æ®åº“è¿æ¥æ•°      500         50           10x
ç¼“å­˜å‘½ä¸­ç‡        30%         95%          3.2x
```

**ä¸šåŠ¡æŒ‡æ ‡æ”¹å–„**ï¼š

```
ğŸ“ˆ ä¸šåŠ¡ä»·å€¼ä½“ç°ï¼š
- ç”¨æˆ·ä½“éªŒï¼šé¡µé¢åŠ è½½æ—¶é—´ä»5ç§’é™åˆ°0.5ç§’
- è½¬åŒ–ç‡ï¼šä»2%æå‡åˆ°8%ï¼ˆ4å€æå‡ï¼‰
- ç³»ç»Ÿç¨³å®šæ€§ï¼šä»æ¯å‘¨å®•æœº2æ¬¡é™åˆ°æ¯æœˆ1æ¬¡
- è¿ç»´æˆæœ¬ï¼šæœåŠ¡å™¨æ•°é‡å‡å°‘60%
- å¼€å‘æ•ˆç‡ï¼šæ–°åŠŸèƒ½ä¸Šçº¿æ—¶é—´ç¼©çŸ­50%
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 é«˜å¹¶å‘å¤„ç†æ ¸å¿ƒåŸåˆ™


> **ğŸ¯ æ ¸å¿ƒè®°å¿†è¦ç‚¹**  
> é«˜å¹¶å‘å¤„ç†çš„æœ¬è´¨æ˜¯ï¼š**é™æµé‡ã€å‰Šå³°å€¼ã€æé€Ÿåº¦ã€ä¿ç¨³å®š**

**ğŸ”¸ å››å¤§æ ¸å¿ƒç­–ç•¥**ï¼š
```
ğŸš¦ æµé‡æ§åˆ¶ï¼šè¯¥è¿›çš„è¿›ï¼Œè¯¥æ‹’çš„æ‹’
ğŸ’¾ ç¼“å­˜åŠ é€Ÿï¼šè¯¥å¿«çš„å¿«ï¼Œè¯¥å­˜çš„å­˜  
ğŸ”„ å¼‚æ­¥å¤„ç†ï¼šè¯¥ç­‰çš„ç­‰ï¼Œè¯¥å¿«çš„å¿«
ğŸ›¡ï¸ æœåŠ¡ä¿æŠ¤ï¼šè¯¥é™çš„é™ï¼Œè¯¥æ–­çš„æ–­
```

### 10.2 æŠ€æœ¯é€‰å‹æŒ‡å¯¼åŸåˆ™


**ğŸ“Š æŠ€æœ¯é€‰å‹å†³ç­–è¡¨**ï¼š

| åœºæ™¯ç‰¹ç‚¹ | **æ¨èæŠ€æœ¯** | **æ ¸å¿ƒè€ƒè™‘** |
|---------|-------------|-------------|
| ğŸ¯ **è¯»å¤šå†™å°‘** | `å¤šçº§ç¼“å­˜ + CDN` | `ç¼“å­˜å‘½ä¸­ç‡` |
| âš¡ **é«˜å¹¶å‘å†™å…¥** | `æ¶ˆæ¯é˜Ÿåˆ— + å¼‚æ­¥` | `å†™å…¥ååé‡` |
| ğŸ”’ **æ•°æ®ä¸€è‡´æ€§** | `åˆ†å¸ƒå¼é” + äº‹åŠ¡` | `ä¸€è‡´æ€§ä¿è¯` |
| ğŸš€ **è¶…é«˜æ€§èƒ½** | `å†…å­˜æ•°æ®åº“ + é¢„å¤„ç†` | `å“åº”æ—¶é—´` |

### 10.3 å®æ–½æ­¥éª¤å»ºè®®


**ğŸ”§ å¾ªåºæ¸è¿›å®æ–½è·¯å¾„**ï¼š

```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ä¼˜åŒ–ï¼ˆç«‹å³è§æ•ˆï¼‰
â”œâ”€â”€ æ·»åŠ ç¼“å­˜å±‚
â”œâ”€â”€ å®æ–½åŸºç¡€é™æµ
â””â”€â”€ ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

ç¬¬äºŒé˜¶æ®µï¼šæ¶æ„ä¼˜åŒ–ï¼ˆä¸­æœŸä¼˜åŒ–ï¼‰
â”œâ”€â”€ å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—
â”œâ”€â”€ å®ç°æœåŠ¡æ‹†åˆ†
â””â”€â”€ æ·»åŠ ç›‘æ§å‘Šè­¦

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ä¼˜åŒ–ï¼ˆé•¿æœŸè§„åˆ’ï¼‰
â”œâ”€â”€ æ™ºèƒ½åŒ–é™æµ
â”œâ”€â”€ é¢„æµ‹æ€§æ‰©å®¹
â””â”€â”€ å…¨é“¾è·¯ä¼˜åŒ–
```

### 10.4 é¿å…å¸¸è§è¯¯åŒº


> **âš ï¸ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ**

**ğŸš« è¯¯åŒºä¸€**ï¼šè¿‡åº¦ä¼˜åŒ–
- **é”™è¯¯åšæ³•**ï¼šä¸€å¼€å§‹å°±ä¸Šå…¨å¥—æŠ€æœ¯æ–¹æ¡ˆ
- **æ­£ç¡®åšæ³•**ï¼šæ ¹æ®å®é™…å¹¶å‘é‡é€æ­¥ä¼˜åŒ–

**ğŸš« è¯¯åŒºäºŒ**ï¼šå¿½è§†ç›‘æ§
- **é”™è¯¯åšæ³•**ï¼šåªå…³æ³¨åŠŸèƒ½å®ç°ï¼Œä¸å…³æ³¨ç›‘æ§
- **æ­£ç¡®åšæ³•**ï¼šå…ˆæœ‰ç›‘æ§ï¼Œå†åšä¼˜åŒ–

**ğŸš« è¯¯åŒºä¸‰**ï¼šå•ç‚¹ä¼˜åŒ–
- **é”™è¯¯åšæ³•**ï¼šåªä¼˜åŒ–æŸä¸€ä¸ªç¯èŠ‚
- **æ­£ç¡®åšæ³•**ï¼šå…¨é“¾è·¯åè°ƒä¼˜åŒ–

### 10.5 æœ€ä½³å®è·µæ€»ç»“


**ğŸ’ æ ¸å¿ƒæœ€ä½³å®è·µ**ï¼š

1. **ğŸ” å…ˆæµ‹é‡ï¼Œåä¼˜åŒ–**ï¼šåŸºäºæ•°æ®åšå†³ç­–
2. **âš¡ ç¼“å­˜ä¼˜å…ˆ**ï¼šèƒ½ç¼“å­˜çš„å°½é‡ç¼“å­˜
3. **ğŸ”„ å¼‚æ­¥ä¸ºç‹**ï¼šèƒ½å¼‚æ­¥çš„å°½é‡å¼‚æ­¥
4. **ğŸ›¡ï¸ å¤±è´¥ä¼˜é›…**ï¼šåšå¥½é™çº§å’Œç†”æ–­
5. **ğŸ“Š ç›‘æ§å¿…å¤‡**ï¼šç›‘æ§å…ˆäºåŠŸèƒ½ä¸Šçº¿

**ğŸª è®°å¿†å£è¯€**ï¼š
```
é«˜å¹¶å‘å¤„ç†æœ‰è¯€çªï¼Œ
é™æµç¼“å­˜å¼‚æ­¥å¥½ã€‚
ç›‘æ§é™çº§ä¿ç¨³å®šï¼Œ
å¾ªåºæ¸è¿›æ•ˆæœä½³ï¼
```

---

> **ğŸ”— ç›¸å…³ä¸»é¢˜å»¶ä¼¸å­¦ä¹ **  
> - [Javaå¾®æœåŠ¡æ¶æ„è®¾è®¡](/pages/microservices-architecture/)
> - [Redisç¼“å­˜æ·±åº¦åº”ç”¨](/pages/redis-advanced/)  
> - [æ¶ˆæ¯é˜Ÿåˆ—æœ€ä½³å®è·µ](/pages/message-queue-best-practices/)

**å­¦ä¹ è¿›åº¦æ£€æŸ¥**ï¼š
- [ ] ç†è§£é«˜å¹¶å‘åœºæ™¯çš„æœ¬è´¨å’ŒæŒ‘æˆ˜
- [ ] æŒæ¡çƒ­ç‚¹æ•°æ®è¯†åˆ«å’Œå¤„ç†æ–¹æ³•  
- [ ] ç†Ÿç»ƒè¿ç”¨å„ç§é™æµå’Œå‰Šå³°æŠ€æœ¯
- [ ] èƒ½å¤Ÿè®¾è®¡å®Œæ•´çš„é™çº§å’Œç†”æ–­æ–¹æ¡ˆ
- [ ] å…·å¤‡ç›‘æ§å‘Šè­¦ä½“ç³»æ„å»ºèƒ½åŠ›