---
title: 2ã€ç¼“å­˜æ›´æ–°ç­–ç•¥å®è·µ
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜æ›´æ–°ç­–ç•¥æ¦‚è¿°](#1-ç¼“å­˜æ›´æ–°ç­–ç•¥æ¦‚è¿°)
2. [å®šæ—¶æ›´æ–°æœºåˆ¶](#2-å®šæ—¶æ›´æ–°æœºåˆ¶)
3. [ä¸»åŠ¨æ›´æ–°ç­–ç•¥](#3-ä¸»åŠ¨æ›´æ–°ç­–ç•¥)
4. [è¢«åŠ¨æ›´æ–°ç­–ç•¥](#4-è¢«åŠ¨æ›´æ–°ç­–ç•¥)
5. [ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ](#5-ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ)
6. [äº‹ä»¶é©±åŠ¨æ›´æ–°](#6-äº‹ä»¶é©±åŠ¨æ›´æ–°)
7. [CDCå˜æ›´æ•°æ®æ•è·](#7-cdcå˜æ›´æ•°æ®æ•è·)
8. [æ›´æ–°ç­–ç•¥ç»„åˆåº”ç”¨](#8-æ›´æ–°ç­–ç•¥ç»„åˆåº”ç”¨)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç¼“å­˜æ›´æ–°ç­–ç•¥æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç¼“å­˜æ›´æ–°ç­–ç•¥


> ğŸ’¡ **é€šä¿—ç†è§£**  
> æƒ³è±¡ä½ çš„æ‰‹æœºç›¸å†Œé‡Œæœ‰ç…§ç‰‡ï¼Œå½“ä½ æ‹äº†æ–°ç…§ç‰‡æ—¶ï¼Œç›¸å†Œéœ€è¦æ›´æ–°ã€‚ç¼“å­˜æ›´æ–°ç­–ç•¥å°±æ˜¯å†³å®š"ä»€ä¹ˆæ—¶å€™æ›´æ–°ç¼“å­˜"å’Œ"æ€ä¹ˆæ›´æ–°ç¼“å­˜"çš„è§„åˆ™ã€‚

**ç¼“å­˜æ›´æ–°ç­–ç•¥**ï¼šç¡®ä¿ç¼“å­˜ä¸­çš„æ•°æ®ä¸åŸå§‹æ•°æ®åº“ä¿æŒä¸€è‡´çš„å„ç§æ–¹æ³•å’Œæœºåˆ¶ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼Ÿ**
```
ç°å®åœºæ™¯ï¼š
ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šä¿®æ”¹äº†ä¸ªäººä¿¡æ¯ â†’ æ•°æ®åº“æ›´æ–°äº† â†’ ä½†ç¼“å­˜è¿˜æ˜¯æ—§æ•°æ®
ç»“æœï¼šç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œçœ‹åˆ°çš„è¿˜æ˜¯æ—§ä¿¡æ¯ï¼

è¿™å°±æ˜¯"ç¼“å­˜ä¸€è‡´æ€§"é—®é¢˜ï¼Œéœ€è¦åˆé€‚çš„æ›´æ–°ç­–ç•¥è§£å†³ã€‚
```

### 1.2 ç¼“å­˜æ›´æ–°çš„æ ¸å¿ƒæŒ‘æˆ˜


**ğŸ”¸ æ•°æ®ä¸€è‡´æ€§é—®é¢˜**
- **å¼ºä¸€è‡´æ€§**ï¼šç¼“å­˜å’Œæ•°æ®åº“å®Œå…¨åŒæ­¥ï¼ˆå¾ˆéš¾å®ç°ï¼‰
- **å¼±ä¸€è‡´æ€§**ï¼šå…è®¸çŸ­æš‚ä¸åŒæ­¥ï¼ˆå¯æ¥å—çš„å»¶è¿Ÿï¼‰
- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šç»è¿‡ä¸€æ®µæ—¶é—´åä¼šåŒæ­¥ï¼ˆæœ€å¸¸ç”¨ï¼‰

**ğŸ”¸ æ€§èƒ½ä¸ä¸€è‡´æ€§çš„å¹³è¡¡**
```
é«˜ä¸€è‡´æ€§ â†â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â†’ é«˜æ€§èƒ½
    â†‘                                            â†‘
ç«‹å³æ›´æ–°ç¼“å­˜                                 å»¶è¿Ÿæ›´æ–°ç¼“å­˜
ç³»ç»Ÿè´Ÿæ‹…é‡                                   å¯èƒ½è¯»åˆ°æ—§æ•°æ®
å“åº”é€Ÿåº¦æ…¢                                   å“åº”é€Ÿåº¦å¿«
```

### 1.3 æ›´æ–°ç­–ç•¥åˆ†ç±»æ¦‚è§ˆ


**æŒ‰æ›´æ–°æ—¶æœºåˆ†ç±»ï¼š**
- **å®šæ—¶æ›´æ–°**ï¼šæŒ‰ç…§å›ºå®šæ—¶é—´é—´éš”æ›´æ–°
- **ä¸»åŠ¨æ›´æ–°**ï¼šæ•°æ®å˜åŒ–æ—¶ç«‹å³æ›´æ–°
- **è¢«åŠ¨æ›´æ–°**ï¼šæŸ¥è¯¢æ—¶å‘ç°è¿‡æœŸæ‰æ›´æ–°

**æŒ‰æ›´æ–°æ–¹å¼åˆ†ç±»ï¼š**
- **å…¨é‡æ›´æ–°**ï¼šé‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®
- **å¢é‡æ›´æ–°**ï¼šåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†
- **åˆ é™¤é‡å»º**ï¼šåˆ é™¤æ—§ç¼“å­˜ï¼Œéœ€è¦æ—¶é‡æ–°åˆ›å»º

---

## 2. â° å®šæ—¶æ›´æ–°æœºåˆ¶


### 2.1 å®šæ—¶æ›´æ–°åŸç†


> **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒä½ æ¯å¤©æ—©ä¸Š7ç‚¹çš„é—¹é’Ÿä¸€æ ·ï¼Œå®šæ—¶æ›´æ–°ä¼šæŒ‰ç…§è®¾å®šçš„æ—¶é—´é—´éš”è‡ªåŠ¨åˆ·æ–°ç¼“å­˜æ•°æ®ã€‚

**å®šæ—¶æ›´æ–°çš„å·¥ä½œæµç¨‹ï¼š**
```
æ—¶é—´è½´ï¼š
T0 â”€â”€â”€â”€ T1 â”€â”€â”€â”€ T2 â”€â”€â”€â”€ T3 â”€â”€â”€â”€ T4
â”‚       â”‚       â”‚       â”‚       â”‚
â”‚     æ›´æ–°    æ›´æ–°    æ›´æ–°    æ›´æ–°
â”‚     ç¼“å­˜    ç¼“å­˜    ç¼“å­˜    ç¼“å­˜
â”‚
èµ·å§‹æ—¶é—´    æ¯éš”å›ºå®šé—´éš”æ‰§è¡Œæ›´æ–°
```

### 2.2 å®šæ—¶æ›´æ–°å®ç°æ–¹æ¡ˆ


**ğŸ”§ æ–¹æ¡ˆ1ï¼šSpringå®šæ—¶ä»»åŠ¡**

```java
@Component
public class CacheRefreshScheduler {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private UserService userService;
    
    // æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ç”¨æˆ·ç¼“å­˜
    @Scheduled(fixedRate = 5 * 60 * 1000)
    public void refreshUserCache() {
        List<User> users = userService.getAllActiveUsers();
        
        // æ‰¹é‡æ›´æ–°ç¼“å­˜
        for (User user : users) {
            String cacheKey = "user:" + user.getId();
            redisTemplate.opsForValue().set(cacheKey, user, Duration.ofHours(1));
        }
        
        System.out.println("ç”¨æˆ·ç¼“å­˜å·²æ›´æ–°ï¼Œå…±æ›´æ–°: " + users.size() + " æ¡æ•°æ®");
    }
}
```

**ğŸ”§ æ–¹æ¡ˆ2ï¼šQuartzä»»åŠ¡è°ƒåº¦**

```java
@Component
public class ProductCacheJob implements Job {
    
    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException {
        // è·å–çƒ­é—¨å•†å“æ•°æ®
        ProductService productService = ApplicationContextHolder.getBean(ProductService.class);
        List<Product> hotProducts = productService.getHotProducts();
        
        // æ›´æ–°ç¼“å­˜
        RedisTemplate redisTemplate = ApplicationContextHolder.getBean(RedisTemplate.class);
        redisTemplate.opsForValue().set("hot_products", hotProducts, Duration.ofMinutes(30));
    }
}
```

### 2.3 å®šæ—¶æ›´æ–°çš„ä¼˜ç¼ºç‚¹åˆ†æ


**âœ… ä¼˜ç‚¹ï¼š**
- **å®ç°ç®€å•**ï¼šé…ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å°±èƒ½å·¥ä½œ
- **å¯é¢„æµ‹æ€§**ï¼šæ›´æ–°æ—¶é—´å›ºå®šï¼Œä¾¿äºç›‘æ§
- **å‡å°‘æ•°æ®åº“å‹åŠ›**ï¼šæ‰¹é‡æ›´æ–°ï¼Œä¸æ˜¯å®æ—¶æŸ¥è¯¢

**âŒ ç¼ºç‚¹ï¼š**
- **æ•°æ®æ»å**ï¼šä¸¤æ¬¡æ›´æ–°é—´éš”å†…æ•°æ®å¯èƒ½ä¸ä¸€è‡´
- **èµ„æºæµªè´¹**ï¼šå³ä½¿æ•°æ®æ²¡å˜åŒ–ä¹Ÿä¼šæ‰§è¡Œæ›´æ–°
- **æ—¶é—´çª—å£é—®é¢˜**ï¼šæ›´æ–°æœŸé—´å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½

### 2.4 å®šæ—¶æ›´æ–°æœ€ä½³å®è·µ


**ğŸ¯ é€‚ç”¨åœºæ™¯åˆ¤æ–­ï¼š**
- **æ•°æ®å˜åŒ–ä¸é¢‘ç¹**ï¼šå¦‚å•†å“åˆ†ç±»ã€ç³»ç»Ÿé…ç½®
- **å…è®¸ä¸€å®šå»¶è¿Ÿ**ï¼šå¦‚ç»Ÿè®¡æ•°æ®ã€æŠ¥è¡¨ä¿¡æ¯
- **æ•°æ®é‡ç›¸å¯¹ç¨³å®š**ï¼šé¿å…æ‰¹é‡æ›´æ–°æ—¶é—´è¿‡é•¿

**âš™ï¸ ä¼˜åŒ–å»ºè®®ï¼š**
```java
// 1. åˆ†æ‰¹æ›´æ–°ï¼Œé¿å…ä¸€æ¬¡æ€§æ›´æ–°å¤ªå¤šæ•°æ®
@Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
public void batchUpdateCache() {
    int batchSize = 100;
    int offset = 0;
    
    while (true) {
        List<Product> products = productService.getProductsBatch(offset, batchSize);
        if (products.isEmpty()) break;
        
        // æ‰¹é‡æ›´æ–°ç¼“å­˜
        Map<String, Product> cacheData = products.stream()
            .collect(Collectors.toMap(p -> "product:" + p.getId(), p -> p));
        redisTemplate.opsForValue().multiSet(cacheData);
        
        offset += batchSize;
    }
}

// 2. é”™å³°æ›´æ–°ï¼Œé¿å…æ‰€æœ‰ç¼“å­˜åŒæ—¶å¤±æ•ˆ
@Scheduled(cron = "0 */10 * * * *") // æ¯10åˆ†é’Ÿçš„æ•´ç‚¹æ‰§è¡Œ
public void staggeredUpdate() {
    // ä¸ºä¸åŒç±»å‹çš„æ•°æ®è®¾ç½®ä¸åŒçš„æ›´æ–°æ—¶é—´
    int minute = LocalDateTime.now().getMinute();
    
    if (minute % 10 == 0) {
        updateUserCache();
    } else if (minute % 10 == 5) {
        updateProductCache();
    }
}
```

---

## 3. ğŸ¯ ä¸»åŠ¨æ›´æ–°ç­–ç•¥


### 3.1 ä¸»åŠ¨æ›´æ–°åŸç†


> **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒä½ ä¸€æœ‰æ–°æ¶ˆæ¯å°±ç«‹å³æŸ¥çœ‹æ‰‹æœºä¸€æ ·ï¼Œä¸»åŠ¨æ›´æ–°æ˜¯åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–çš„ç¬é—´å°±ç«‹å³æ›´æ–°ç¼“å­˜ã€‚

**ä¸»åŠ¨æ›´æ–°çš„æ ¸å¿ƒæ€æƒ³ï¼š**
```
æ•°æ®å˜åŒ–è§¦å‘é“¾ï¼š
ä¸šåŠ¡æ“ä½œ â†’ æ•°æ®åº“æ›´æ–° â†’ åŒæ­¥æ›´æ–°ç¼“å­˜ â†’ ä¿æŒä¸€è‡´æ€§

æ—¶åºå›¾ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€â†’ ä¸šåŠ¡æœåŠ¡ â”€â”€â†’ æ•°æ®åº“
                 â†“
              æ›´æ–°ç¼“å­˜ â†â”€â”€â”€ ç¼“å­˜å±‚
```

### 3.2 ç›´æ¥æ›´æ–°æ¨¡å¼


**ğŸ”§ Write-Throughï¼ˆç›´å†™æ¨¡å¼ï¼‰**

```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private RedisTemplate<String, User> redisTemplate;
    
    public User updateUser(User user) {
        try {
            // 1. å…ˆæ›´æ–°æ•°æ®åº“
            User savedUser = userRepository.save(user);
            
            // 2. ç«‹å³æ›´æ–°ç¼“å­˜
            String cacheKey = "user:" + user.getId();
            redisTemplate.opsForValue().set(cacheKey, savedUser, Duration.ofHours(2));
            
            return savedUser;
            
        } catch (Exception e) {
            // å¦‚æœç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œè®°å½•æ—¥å¿—ä½†ä¸å½±å“ä¸šåŠ¡
            log.error("ç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œç”¨æˆ·ID: {}", user.getId(), e);
            throw e;
        }
    }
}
```

**ğŸ”§ Write-Behindï¼ˆå›å†™æ¨¡å¼ï¼‰**

```java
@Service
public class AsyncCacheUpdateService {
    
    @Autowired
    private RedisTemplate<String, User> redisTemplate;
    
    @Async("cacheUpdateExecutor")
    public void asyncUpdateCache(String cacheKey, User user) {
        try {
            // å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œä¸é˜»å¡ä¸»ä¸šåŠ¡æµç¨‹
            redisTemplate.opsForValue().set(cacheKey, user, Duration.ofHours(2));
            log.info("å¼‚æ­¥ç¼“å­˜æ›´æ–°æˆåŠŸ: {}", cacheKey);
            
        } catch (Exception e) {
            log.error("å¼‚æ­¥ç¼“å­˜æ›´æ–°å¤±è´¥: {}", cacheKey, e);
            // å¯ä»¥è€ƒè™‘é‡è¯•æœºåˆ¶æˆ–è€…å°†å¤±è´¥çš„æ›´æ–°æ”¾å…¥é˜Ÿåˆ—
        }
    }
}
```

### 3.3 ä¸»åŠ¨å¤±æ•ˆæ¨¡å¼


**åˆ é™¤åé‡å»ºç­–ç•¥ï¼š**

```java
@Service
public class ProductService {
    
    @Autowired
    private ProductRepository productRepository;
    
    @Autowired
    private RedisTemplate<String, Product> redisTemplate;
    
    public Product updateProduct(Product product) {
        // 1. æ›´æ–°æ•°æ®åº“
        Product savedProduct = productRepository.save(product);
        
        // 2. åˆ é™¤ç›¸å…³ç¼“å­˜
        String productKey = "product:" + product.getId();
        String categoryKey = "category_products:" + product.getCategoryId();
        
        redisTemplate.delete(productKey);
        redisTemplate.delete(categoryKey);
        
        // ç¼“å­˜ä¼šåœ¨ä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡æ–°ç”Ÿæˆ
        return savedProduct;
    }
    
    public Product getProduct(Long id) {
        String cacheKey = "product:" + id;
        
        // å…ˆæŸ¥ç¼“å­˜
        Product product = redisTemplate.opsForValue().get(cacheKey);
        if (product != null) {
            return product;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“å¹¶é‡å»ºç¼“å­˜
        product = productRepository.findById(id).orElse(null);
        if (product != null) {
            redisTemplate.opsForValue().set(cacheKey, product, Duration.ofMinutes(30));
        }
        
        return product;
    }
}
```

### 3.4 ä¸»åŠ¨æ›´æ–°çš„äº‹åŠ¡å¤„ç†


**ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„äº‹åŠ¡æ–¹æ¡ˆï¼š**

```java
@Service
@Transactional
public class OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    public Order createOrder(Order order) {
        try {
            // 1. æ•°æ®åº“æ“ä½œ
            Order savedOrder = orderRepository.save(order);
            
            // 2. ç¼“å­˜æ“ä½œï¼ˆåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼‰
            updateOrderCache(savedOrder);
            updateUserOrderCount(savedOrder.getUserId());
            
            return savedOrder;
            
        } catch (Exception e) {
            // äº‹åŠ¡å›æ»šï¼Œç¼“å­˜æ“ä½œä¹Ÿä¼šè¢«æ’¤é”€
            log.error("è®¢å•åˆ›å»ºå¤±è´¥ï¼Œäº‹åŠ¡å›æ»š", e);
            throw e;
        }
    }
    
    private void updateOrderCache(Order order) {
        String cacheKey = "order:" + order.getId();
        redisTemplate.opsForValue().set(cacheKey, order, Duration.ofDays(1));
    }
    
    private void updateUserOrderCount(Long userId) {
        String countKey = "user_order_count:" + userId;
        redisTemplate.opsForValue().increment(countKey);
    }
}
```

---

## 4. ğŸ”„ è¢«åŠ¨æ›´æ–°ç­–ç•¥


### 4.1 è¢«åŠ¨æ›´æ–°åŸç†


> **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒä½ æ‰“å¼€å†°ç®±å‘ç°ç‰›å¥¶è¿‡æœŸäº†æ‰å»ä¹°æ–°çš„ä¸€æ ·ï¼Œè¢«åŠ¨æ›´æ–°æ˜¯åœ¨æŸ¥è¯¢æ—¶å‘ç°ç¼“å­˜è¿‡æœŸæˆ–æ— æ•ˆæ‰å»æ›´æ–°ã€‚

**è¢«åŠ¨æ›´æ–°çš„å·¥ä½œæµç¨‹ï¼š**
```
æŸ¥è¯¢æµç¨‹å›¾ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ â†’ æ£€æŸ¥ç¼“å­˜ â†’ ç¼“å­˜å‘½ä¸­ï¼Ÿ
                â†“           â†“
              ç¼“å­˜æœªå‘½ä¸­   è¿”å›ç¼“å­˜æ•°æ®
                â†“
              æŸ¥è¯¢æ•°æ®åº“
                â†“
              æ›´æ–°ç¼“å­˜
                â†“
              è¿”å›æ•°æ®
```

### 4.2 æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰å®ç°


**ğŸ”§ åŸºç¡€æ‡’åŠ è½½æ¨¡å¼ï¼š**

```java
@Service
public class UserCacheService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private RedisTemplate<String, User> redisTemplate;
    
    public User getUserById(Long userId) {
        String cacheKey = "user:" + userId;
        
        // 1. å…ˆæŸ¥ç¼“å­˜
        User cachedUser = redisTemplate.opsForValue().get(cacheKey);
        if (cachedUser != null) {
            return cachedUser; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        User dbUser = userRepository.findById(userId).orElse(null);
        if (dbUser == null) {
            return null; // æ•°æ®ä¸å­˜åœ¨
        }
        
        // 3. æ›´æ–°ç¼“å­˜
        redisTemplate.opsForValue().set(cacheKey, dbUser, Duration.ofMinutes(30));
        
        return dbUser;
    }
}
```

**ğŸ”§ ç¼“å­˜è¿‡æœŸæ£€æŸ¥æ¨¡å¼ï¼š**

```java
@Service
public class SmartCacheService {
    
    private static final String VERSION_PREFIX = "version:";
    
    public Product getProductWithVersionCheck(Long productId) {
        String cacheKey = "product:" + productId;
        String versionKey = VERSION_PREFIX + "product:" + productId;
        
        // 1. è·å–ç¼“å­˜æ•°æ®å’Œç‰ˆæœ¬
        Product cachedProduct = redisTemplate.opsForValue().get(cacheKey);
        String cachedVersion = redisTemplate.opsForValue().get(versionKey);
        
        // 2. è·å–æ•°æ®åº“ä¸­çš„æœ€æ–°ç‰ˆæœ¬
        String currentVersion = productRepository.getProductVersion(productId);
        
        // 3. ç‰ˆæœ¬æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°
        if (cachedProduct != null && Objects.equals(cachedVersion, currentVersion)) {
            return cachedProduct; // ç‰ˆæœ¬ä¸€è‡´ï¼Œä½¿ç”¨ç¼“å­˜
        }
        
        // 4. ç‰ˆæœ¬ä¸ä¸€è‡´æˆ–ç¼“å­˜ä¸ºç©ºï¼Œä»æ•°æ®åº“åŠ è½½
        Product dbProduct = productRepository.findById(productId).orElse(null);
        if (dbProduct != null) {
            // æ›´æ–°ç¼“å­˜å’Œç‰ˆæœ¬
            redisTemplate.opsForValue().set(cacheKey, dbProduct, Duration.ofHours(1));
            redisTemplate.opsForValue().set(versionKey, currentVersion, Duration.ofHours(1));
        }
        
        return dbProduct;
    }
}
```

### 4.3 ç¼“å­˜ç©¿é€ä¿æŠ¤


**é˜²æ­¢æ¶æ„æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼š**

```java
@Service
public class ProtectedCacheService {
    
    private static final String NULL_VALUE = "NULL";
    
    public User getUser(Long userId) {
        String cacheKey = "user:" + userId;
        
        // 1. æ£€æŸ¥ç¼“å­˜
        String cachedValue = redisTemplate.opsForValue().get(cacheKey);
        if (cachedValue != null) {
            if (NULL_VALUE.equals(cachedValue)) {
                return null; // æ˜ç¡®çŸ¥é“æ•°æ®ä¸å­˜åœ¨
            }
            return (User) cachedValue;
        }
        
        // 2. æŸ¥è¯¢æ•°æ®åº“
        User user = userRepository.findById(userId).orElse(null);
        
        if (user != null) {
            // ç¼“å­˜å­˜åœ¨çš„æ•°æ®
            redisTemplate.opsForValue().set(cacheKey, user, Duration.ofMinutes(30));
        } else {
            // ç¼“å­˜"ä¸å­˜åœ¨"çš„æ ‡è®°ï¼Œé˜²æ­¢é‡å¤æŸ¥è¯¢
            redisTemplate.opsForValue().set(cacheKey, NULL_VALUE, Duration.ofMinutes(5));
        }
        
        return user;
    }
}
```

### 4.4 è¢«åŠ¨æ›´æ–°çš„ä¼˜åŠ¿ä¸æ³¨æ„äº‹é¡¹


**âœ… ä¼˜åŠ¿ï¼š**
- **æŒ‰éœ€åŠ è½½**ï¼šåªæœ‰è¢«æŸ¥è¯¢çš„æ•°æ®æ‰ä¼šè¢«ç¼“å­˜
- **å†…å­˜æ•ˆç‡**ï¼šä¸ä¼šç¼“å­˜æ— ç”¨æ•°æ®
- **å®ç°ç®€å•**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤

**âš ï¸ æ³¨æ„äº‹é¡¹ï¼š**
- **é¦–æ¬¡æŸ¥è¯¢æ…¢**ï¼šç¼“å­˜æœªå‘½ä¸­æ—¶éœ€è¦æŸ¥è¯¢æ•°æ®åº“
- **ç¼“å­˜é›ªå´©**ï¼šå¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆå¯èƒ½å¯¼è‡´æ•°æ®åº“å‹åŠ›
- **å¹¶å‘é—®é¢˜**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶æŸ¥è¯¢åŒä¸€æ•°æ®å¯èƒ½é‡å¤åŠ è½½

**ğŸ›¡ï¸ å¹¶å‘æ§åˆ¶è§£å†³æ–¹æ¡ˆï¼š**

```java
@Service
public class ConcurrencyControlledCache {
    
    private final ConcurrentHashMap<String, CompletableFuture<User>> loadingCache = new ConcurrentHashMap<>();
    
    public User getUser(Long userId) {
        String cacheKey = "user:" + userId;
        
        // å…ˆæ£€æŸ¥ç¼“å­˜
        User cached = redisTemplate.opsForValue().get(cacheKey);
        if (cached != null) {
            return cached;
        }
        
        // ä½¿ç”¨CompletableFutureé¿å…é‡å¤åŠ è½½
        CompletableFuture<User> future = loadingCache.computeIfAbsent(cacheKey, key -> 
            CompletableFuture.supplyAsync(() -> {
                try {
                    User user = userRepository.findById(userId).orElse(null);
                    if (user != null) {
                        redisTemplate.opsForValue().set(cacheKey, user, Duration.ofMinutes(30));
                    }
                    return user;
                } finally {
                    // æ¸…ç†åŠ è½½æ ‡è®°
                    loadingCache.remove(key);
                }
            })
        );
        
        try {
            return future.get(5, TimeUnit.SECONDS); // è®¾ç½®è¶…æ—¶
        } catch (Exception e) {
            log.error("è·å–ç”¨æˆ·æ•°æ®å¤±è´¥: {}", userId, e);
            return null;
        }
    }
}
```

---

## 5. ğŸ·ï¸ ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ


### 5.1 ç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒæ¦‚å¿µ


> **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒè½¯ä»¶ç‰ˆæœ¬å·ä¸€æ ·ï¼ˆå¦‚å¾®ä¿¡8.0.1ï¼‰ï¼Œæ¯æ¬¡æ•°æ®æ›´æ–°éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œé€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·æ¥åˆ¤æ–­æ•°æ®æ˜¯å¦éœ€è¦æ›´æ–°ã€‚

**ç‰ˆæœ¬æ§åˆ¶è§£å†³çš„é—®é¢˜ï¼š**
- **å¦‚ä½•åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Ÿ** â†’ é€šè¿‡ç‰ˆæœ¬å·å¯¹æ¯”
- **å¦‚ä½•é¿å…æ— æ•ˆæ›´æ–°ï¼Ÿ** â†’ åªæ›´æ–°ç‰ˆæœ¬ä¸åŒçš„æ•°æ®
- **å¦‚ä½•å¤„ç†å¹¶å‘ä¿®æ”¹ï¼Ÿ** â†’ ä¹è§‚é”æœºåˆ¶

### 5.2 æ•°æ®ç‰ˆæœ¬æ§åˆ¶å®ç°


**ğŸ”§ æ•°æ®åº“ç‰ˆæœ¬å­—æ®µæ–¹æ¡ˆï¼š**

```sql
-- å•†å“è¡¨å¢åŠ ç‰ˆæœ¬å­—æ®µ
CREATE TABLE products (
    id BIGINT PRIMARY KEY,
    name VARCHAR(255),
    price DECIMAL(10,2),
    version BIGINT NOT NULL DEFAULT 1,  -- ç‰ˆæœ¬å·
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

```java
@Entity
public class Product {
    @Id
    private Long id;
    private String name;
    private BigDecimal price;
    
    @Version  // JPAä¹è§‚é”æ³¨è§£
    private Long version;
    
    // getter/setterçœç•¥
}

@Service
public class VersionedCacheService {
    
    public Product getProductWithVersion(Long productId) {
        String cacheKey = "product:" + productId;
        String versionKey = "product_version:" + productId;
        
        // 1. è·å–ç¼“å­˜çš„æ•°æ®å’Œç‰ˆæœ¬
        Product cachedProduct = redisTemplate.opsForValue().get(cacheKey);
        Long cachedVersion = redisTemplate.opsForValue().get(versionKey);
        
        // 2. è·å–æ•°æ®åº“å½“å‰ç‰ˆæœ¬ï¼ˆè½»é‡çº§æŸ¥è¯¢ï¼‰
        Long currentVersion = productRepository.getVersionById(productId);
        
        // 3. ç‰ˆæœ¬æ¯”è¾ƒ
        if (cachedProduct != null && Objects.equals(cachedVersion, currentVersion)) {
            return cachedProduct; // ç‰ˆæœ¬ä¸€è‡´ï¼Œä½¿ç”¨ç¼“å­˜
        }
        
        // 4. ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œé‡æ–°åŠ è½½
        Product dbProduct = productRepository.findById(productId).orElse(null);
        if (dbProduct != null) {
            redisTemplate.opsForValue().set(cacheKey, dbProduct, Duration.ofHours(1));
            redisTemplate.opsForValue().set(versionKey, dbProduct.getVersion(), Duration.ofHours(1));
        }
        
        return dbProduct;
    }
    
    @Transactional
    public Product updateProductWithVersion(Product product) {
        try {
            // JPAä¼šè‡ªåŠ¨å¢åŠ versionå­—æ®µ
            Product updated = productRepository.save(product);
            
            // æ›´æ–°ç¼“å­˜
            String cacheKey = "product:" + product.getId();
            String versionKey = "product_version:" + product.getId();
            
            redisTemplate.opsForValue().set(cacheKey, updated, Duration.ofHours(1));
            redisTemplate.opsForValue().set(versionKey, updated.getVersion(), Duration.ofHours(1));
            
            return updated;
            
        } catch (OptimisticLockingFailureException e) {
            // ç‰ˆæœ¬å†²çªï¼Œéœ€è¦é‡æ–°è·å–æœ€æ–°æ•°æ®
            throw new BusinessException("æ•°æ®å·²è¢«å…¶ä»–ç”¨æˆ·ä¿®æ”¹ï¼Œè¯·åˆ·æ–°åé‡è¯•");
        }
    }
}
```

### 5.3 æ—¶é—´æˆ³ç‰ˆæœ¬æ§åˆ¶


**ğŸ”§ åŸºäºæ—¶é—´æˆ³çš„ç‰ˆæœ¬æ§åˆ¶ï¼š**

```java
@Service
public class TimestampVersionCache {
    
    public User getUserWithTimestamp(Long userId) {
        String cacheKey = "user:" + userId;
        String timestampKey = "user_timestamp:" + userId;
        
        // 1. è·å–ç¼“å­˜æ•°æ®å’Œæ—¶é—´æˆ³
        User cachedUser = redisTemplate.opsForValue().get(cacheKey);
        Long cachedTimestamp = redisTemplate.opsForValue().get(timestampKey);
        
        // 2. è·å–æ•°æ®åº“æœ€åæ›´æ–°æ—¶é—´
        Long dbTimestamp = userRepository.getLastModifiedTime(userId);
        
        // 3. æ—¶é—´æˆ³æ¯”è¾ƒ
        if (cachedUser != null && cachedTimestamp != null && 
            cachedTimestamp.equals(dbTimestamp)) {
            return cachedUser;
        }
        
        // 4. æ—¶é—´æˆ³ä¸ä¸€è‡´ï¼Œé‡æ–°åŠ è½½
        User dbUser = userRepository.findById(userId).orElse(null);
        if (dbUser != null) {
            redisTemplate.opsForValue().set(cacheKey, dbUser, Duration.ofMinutes(30));
            redisTemplate.opsForValue().set(timestampKey, dbTimestamp, Duration.ofMinutes(30));
        }
        
        return dbUser;
    }
}
```

### 5.4 å“ˆå¸Œå€¼ç‰ˆæœ¬æ§åˆ¶


**ğŸ”§ å†…å®¹å“ˆå¸Œç‰ˆæœ¬æ§åˆ¶ï¼š**

```java
@Service
public class HashVersionCache {
    
    public Article getArticleWithHash(Long articleId) {
        String cacheKey = "article:" + articleId;
        String hashKey = "article_hash:" + articleId;
        
        // 1. è·å–ç¼“å­˜å†…å®¹å’Œå“ˆå¸Œå€¼
        Article cachedArticle = redisTemplate.opsForValue().get(cacheKey);
        String cachedHash = redisTemplate.opsForValue().get(hashKey);
        
        // 2. è®¡ç®—æ•°æ®åº“å†…å®¹çš„å“ˆå¸Œå€¼ï¼ˆåªæŸ¥å…³é”®å­—æ®µï¼‰
        String dbContentHash = articleRepository.getContentHash(articleId);
        
        // 3. å“ˆå¸Œå€¼æ¯”è¾ƒ
        if (cachedArticle != null && Objects.equals(cachedHash, dbContentHash)) {
            return cachedArticle;
        }
        
        // 4. å“ˆå¸Œå€¼ä¸åŒï¼Œé‡æ–°åŠ è½½
        Article dbArticle = articleRepository.findById(articleId).orElse(null);
        if (dbArticle != null) {
            String newHash = calculateHash(dbArticle.getContent());
            redisTemplate.opsForValue().set(cacheKey, dbArticle, Duration.ofHours(2));
            redisTemplate.opsForValue().set(hashKey, newHash, Duration.ofHours(2));
        }
        
        return dbArticle;
    }
    
    private String calculateHash(String content) {
        // ä½¿ç”¨MD5æˆ–SHAè®¡ç®—å†…å®¹å“ˆå¸Œ
        return DigestUtils.md5Hex(content);
    }
}
```

### 5.5 ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆå¯¹æ¯”


| **æ–¹æ¡ˆç±»å‹** | **å®ç°éš¾åº¦** | **æ€§èƒ½å¼€é”€** | **å‡†ç¡®æ€§** | **é€‚ç”¨åœºæ™¯** |
|-------------|-------------|-------------|-----------|-------------|
| **ç‰ˆæœ¬å·** | â­â­â­ | â­â­ | â­â­â­â­â­ | éœ€è¦å¹¶å‘æ§åˆ¶çš„ä¸šåŠ¡æ•°æ® |
| **æ—¶é—´æˆ³** | â­â­ | â­â­ | â­â­â­â­ | ä¸€èˆ¬ä¸šåŠ¡æ•°æ®ï¼Œæ›´æ–°ä¸å¤ªé¢‘ç¹ |
| **å“ˆå¸Œå€¼** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | å†…å®¹å‹æ•°æ®ï¼Œå¦‚æ–‡ç« ã€é…ç½® |

---

## 6. ğŸ“¢ äº‹ä»¶é©±åŠ¨æ›´æ–°


### 6.1 æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥æœºåˆ¶


> **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒå¾®ä¿¡ç¾¤èŠä¸€æ ·ï¼Œå½“æœ‰äººå‘æ¶ˆæ¯æ—¶ï¼Œæ‰€æœ‰ç¾¤æˆå‘˜éƒ½èƒ½æ”¶åˆ°é€šçŸ¥ã€‚æ•°æ®æ›´æ–°æ—¶ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥æ‰€æœ‰éœ€è¦æ›´æ–°ç¼“å­˜çš„æœåŠ¡ã€‚

**äº‹ä»¶é©±åŠ¨æ›´æ–°çš„æ¶æ„ï¼š**
```
æ•°æ®æ›´æ–°æµç¨‹ï¼š
ä¸šåŠ¡æœåŠ¡ â†’ æ›´æ–°æ•°æ®åº“ â†’ å‘é€æ›´æ–°äº‹ä»¶ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ ç¼“å­˜æœåŠ¡ â†’ æ›´æ–°ç¼“å­˜

ç»„ä»¶å…³ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡æœåŠ¡    â”‚â”€â”€â”€â†’â”‚  æ¶ˆæ¯é˜Ÿåˆ—    â”‚â”€â”€â”€â†’â”‚  ç¼“å­˜æœåŠ¡    â”‚
â”‚ (Producer)  â”‚    â”‚ (MQ/Kafka)  â”‚    â”‚ (Consumer)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 RabbitMQå®ç°äº‹ä»¶é©±åŠ¨æ›´æ–°


**ğŸ”§ æ¶ˆæ¯å‘å¸ƒè€…ï¼ˆæ•°æ®æ›´æ–°æœåŠ¡ï¼‰ï¼š**

```java
@Service
public class UserEventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public static final String USER_EXCHANGE = "user.exchange";
    public static final String USER_UPDATE_ROUTING_KEY = "user.update";
    
    @Transactional
    public User updateUser(User user) {
        // 1. æ›´æ–°æ•°æ®åº“
        User updatedUser = userRepository.save(user);
        
        // 2. å‘é€æ›´æ–°äº‹ä»¶
        UserUpdateEvent event = new UserUpdateEvent();
        event.setUserId(updatedUser.getId());
        event.setAction("UPDATE");
        event.setTimestamp(System.currentTimeMillis());
        event.setUserData(updatedUser);
        
        rabbitTemplate.convertAndSend(USER_EXCHANGE, USER_UPDATE_ROUTING_KEY, event);
        
        return updatedUser;
    }
}

// äº‹ä»¶æ•°æ®ç»“æ„
public class UserUpdateEvent {
    private Long userId;
    private String action; // CREATE, UPDATE, DELETE
    private Long timestamp;
    private User userData;
    
    // getter/setterçœç•¥
}
```

**ğŸ”§ æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆç¼“å­˜æ›´æ–°æœåŠ¡ï¼‰ï¼š**

```java
@Component
public class CacheUpdateListener {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @RabbitListener(queues = "cache.update.queue")
    public void handleUserUpdate(UserUpdateEvent event) {
        try {
            String cacheKey = "user:" + event.getUserId();
            
            switch (event.getAction()) {
                case "UPDATE":
                case "CREATE":
                    // æ›´æ–°ç¼“å­˜
                    redisTemplate.opsForValue().set(cacheKey, event.getUserData(), Duration.ofHours(1));
                    break;
                    
                case "DELETE":
                    // åˆ é™¤ç¼“å­˜
                    redisTemplate.delete(cacheKey);
                    break;
            }
            
            log.info("ç¼“å­˜æ›´æ–°æˆåŠŸ: userId={}, action={}", event.getUserId(), event.getAction());
            
        } catch (Exception e) {
            log.error("ç¼“å­˜æ›´æ–°å¤±è´¥: {}", event, e);
            // å¯ä»¥è€ƒè™‘é‡è¯•æˆ–è€…æ­»ä¿¡é˜Ÿåˆ—å¤„ç†
        }
    }
}
```

### 6.3 Kafkaå®ç°äº‹ä»¶é©±åŠ¨æ›´æ–°


**ğŸ”§ Kafkaé…ç½®å’Œäº‹ä»¶å‘å¸ƒï¼š**

```java
@Service
public class ProductEventService {
    
    @Autowired
    private KafkaTemplate<String, Object> kafkaTemplate;
    
    private static final String TOPIC_PRODUCT_UPDATE = "product-update";
    
    public void publishProductUpdate(Product product, String action) {
        ProductUpdateEvent event = ProductUpdateEvent.builder()
            .productId(product.getId())
            .action(action)
            .timestamp(System.currentTimeMillis())
            .productData(product)
            .build();
        
        // ä½¿ç”¨äº§å“IDä½œä¸ºåˆ†åŒºé”®ï¼Œç¡®ä¿åŒä¸€äº§å“çš„äº‹ä»¶æœ‰åº
        kafkaTemplate.send(TOPIC_PRODUCT_UPDATE, product.getId().toString(), event);
    }
}

@Component
public class ProductCacheConsumer {
    
    @KafkaListener(topics = "product-update", groupId = "cache-update-group")
    public void handleProductUpdate(ProductUpdateEvent event) {
        String cacheKey = "product:" + event.getProductId();
        
        switch (event.getAction()) {
            case "UPDATE":
                redisTemplate.opsForValue().set(cacheKey, event.getProductData(), Duration.ofMinutes(30));
                
                // åŒæ—¶æ›´æ–°ç›¸å…³çš„èšåˆç¼“å­˜
                updateCategoryCache(event.getProductData().getCategoryId());
                break;
                
            case "DELETE":
                redisTemplate.delete(cacheKey);
                break;
        }
    }
    
    private void updateCategoryCache(Long categoryId) {
        // å¼‚æ­¥æ›´æ–°åˆ†ç±»ä¸‹çš„äº§å“åˆ—è¡¨ç¼“å­˜
        CompletableFuture.runAsync(() -> {
            List<Product> products = productRepository.findByCategoryId(categoryId);
            String categoryKey = "category_products:" + categoryId;
            redisTemplate.opsForValue().set(categoryKey, products, Duration.ofMinutes(15));
        });
    }
}
```

### 6.4 æ•°æ®åº“è§¦å‘å™¨æ–¹æ¡ˆ


**ğŸ”§ MySQLè§¦å‘å™¨è‡ªåŠ¨å‘é€æ›´æ–°é€šçŸ¥ï¼š**

```sql
-- åˆ›å»ºè§¦å‘å™¨è¡¨å­˜å‚¨å˜æ›´äº‹ä»¶
CREATE TABLE cache_update_events (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(64) NOT NULL,
    record_id BIGINT NOT NULL,
    action VARCHAR(10) NOT NULL, -- INSERT, UPDATE, DELETE
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç”¨æˆ·è¡¨æ›´æ–°è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER user_cache_update_trigger
    AFTER UPDATE ON users
    FOR EACH ROW
BEGIN
    INSERT INTO cache_update_events (table_name, record_id, action)
    VALUES ('users', NEW.id, 'UPDATE');
END$$
DELIMITER ;

-- ç”¨æˆ·è¡¨åˆ é™¤è§¦å‘å™¨
DELIMITER $$
CREATE TRIGGER user_cache_delete_trigger
    AFTER DELETE ON users
    FOR EACH ROW
BEGIN
    INSERT INTO cache_update_events (table_name, record_id, action)
    VALUES ('users', OLD.id, 'DELETE');
END$$
DELIMITER ;
```

**ğŸ”§ JavaæœåŠ¡å®šæœŸå¤„ç†è§¦å‘å™¨äº‹ä»¶ï¼š**

```java
@Service
public class TriggerEventProcessor {
    
    @Scheduled(fixedDelay = 5000) // æ¯5ç§’å¤„ç†ä¸€æ¬¡
    public void processCacheEvents() {
        List<CacheUpdateEvent> events = cacheEventRepository.findUnprocessedEvents();
        
        for (CacheUpdateEvent event : events) {
            try {
                processSingleEvent(event);
                event.setProcessed(true);
                cacheEventRepository.save(event);
                
            } catch (Exception e) {
                log.error("å¤„ç†ç¼“å­˜äº‹ä»¶å¤±è´¥: {}", event, e);
                event.setRetryCount(event.getRetryCount() + 1);
                
                if (event.getRetryCount() >= 3) {
                    event.setFailed(true);
                }
                cacheEventRepository.save(event);
            }
        }
    }
    
    private void processSingleEvent(CacheUpdateEvent event) {
        String cacheKey = event.getTableName() + ":" + event.getRecordId();
        
        switch (event.getAction()) {
            case "UPDATE":
                // é‡æ–°åŠ è½½æ•°æ®å¹¶æ›´æ–°ç¼“å­˜
                Object data = loadDataFromDatabase(event.getTableName(), event.getRecordId());
                if (data != null) {
                    redisTemplate.opsForValue().set(cacheKey, data, Duration.ofHours(1));
                }
                break;
                
            case "DELETE":
                redisTemplate.delete(cacheKey);
                break;
        }
    }
}
```

---

## 7. ğŸ”„ CDCå˜æ›´æ•°æ®æ•è·


### 7.1 CDCåŸºæœ¬æ¦‚å¿µ


> **é€šä¿—ç†è§£**  
> CDCï¼ˆChange Data Captureï¼‰å°±åƒæ•°æ®åº“çš„"ç›‘æ§æ‘„åƒå¤´"ï¼Œèƒ½å¤Ÿå®æ—¶ç›‘æ§æ•°æ®åº“çš„æ‰€æœ‰å˜åŒ–ï¼Œä¸€æœ‰æ•°æ®ä¿®æ”¹å°±ç«‹å³é€šçŸ¥ç›¸å…³ç³»ç»Ÿã€‚

**CDCçš„å·¥ä½œåŸç†ï¼š**
```
æ•°æ®å˜åŒ–æ•è·æµç¨‹ï¼š
æ•°æ®åº“æ“ä½œ â†’ äº‹åŠ¡æ—¥å¿— â†’ CDCå·¥å…·æ•è· â†’ è§£æå˜æ›´ â†’ å‘é€äº‹ä»¶ â†’ æ›´æ–°ç¼“å­˜

CDCæ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åº“    â”‚â”€â”€â”€â†’â”‚  CDCå·¥å…·    â”‚â”€â”€â”€â†’â”‚  ç¼“å­˜æœåŠ¡    â”‚
â”‚ (MySQL/PG)  â”‚    â”‚(Debezium)   â”‚    â”‚   (Redis)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â†‘
        â””â”€â”€ äº‹åŠ¡æ—¥å¿—(Binlog) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Debezium CDCå®ç°


**ğŸ”§ Debeziumé…ç½®æ–‡ä»¶ï¼š**

```yaml
# debezium-connector.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-connector-config
data:
  config.json: |
    {
      "name": "mysql-connector",
      "config": {
        "connector.class": "io.debezium.connector.mysql.MySqlConnector",
        "database.hostname": "mysql-server",
        "database.port": "3306",
        "database.user": "debezium",
        "database.password": "dbz",
        "database.server.id": "184054",
        "database.server.name": "myapp",
        "database.include.list": "inventory",
        "table.include.list": "inventory.users,inventory.products",
        "database.history.kafka.bootstrap.servers": "kafka:9092",
        "database.history.kafka.topic": "schema-changes.inventory"
      }
    }
```

**ğŸ”§ Javaæ¶ˆè´¹CDCäº‹ä»¶ï¼š**

```java
@Component
public class DebeziumCacheUpdater {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @KafkaListener(topics = "myapp.inventory.users")
    public void handleUserChange(String message) {
        try {
            // è§£æDebeziumæ¶ˆæ¯æ ¼å¼
            JsonNode changeEvent = objectMapper.readTree(message);
            
            String operation = changeEvent.get("op").asText(); // c=create, u=update, d=delete
            JsonNode after = changeEvent.get("after");
            JsonNode before = changeEvent.get("before");
            
            switch (operation) {
                case "c": // CREATE
                case "u": // UPDATE
                    if (after != null) {
                        Long userId = after.get("id").asLong();
                        User user = objectMapper.treeToValue(after, User.class);
                        
                        String cacheKey = "user:" + userId;
                        redisTemplate.opsForValue().set(cacheKey, user, Duration.ofHours(1));
                        
                        log.info("ç”¨æˆ·ç¼“å­˜å·²æ›´æ–°: userId={}", userId);
                    }
                    break;
                    
                case "d": // DELETE
                    if (before != null) {
                        Long userId = before.get("id").asLong();
                        String cacheKey = "user:" + userId;
                        redisTemplate.delete(cacheKey);
                        
                        log.info("ç”¨æˆ·ç¼“å­˜å·²åˆ é™¤: userId={}", userId);
                    }
                    break;
            }
            
        } catch (Exception e) {
            log.error("å¤„ç†ç”¨æˆ·å˜æ›´äº‹ä»¶å¤±è´¥: {}", message, e);
        }
    }
    
    @KafkaListener(topics = "myapp.inventory.products")
    public void handleProductChange(String message) {
        // ç±»ä¼¼çš„äº§å“å˜æ›´å¤„ç†é€»è¾‘
        processProductChange(message);
    }
}
```

### 7.3 è‡ªå®šä¹‰CDCå®ç°


**ğŸ”§ åŸºäºMySQL Binlogçš„ç®€å•CDCï¼š**

```java
@Component
public class SimpleBinlogListener {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @PostConstruct
    public void startListening() {
        BinaryLogClient client = new BinaryLogClient("localhost", 3306, "root", "password");
        
        client.registerEventListener(new BinaryLogClient.EventListener() {
            @Override
            public void onEvent(Event event) {
                EventType eventType = event.getHeader().getEventType();
                
                if (eventType == EventType.WRITE_ROWS || 
                    eventType == EventType.UPDATE_ROWS || 
                    eventType == EventType.DELETE_ROWS) {
                    
                    processRowEvent(event);
                }
            }
        });
        
        try {
            client.connect();
            log.info("Binlogç›‘å¬å™¨å·²å¯åŠ¨");
        } catch (IOException e) {
            log.error("å¯åŠ¨Binlogç›‘å¬å™¨å¤±è´¥", e);
        }
    }
    
    private void processRowEvent(Event event) {
        EventData eventData = event.getData();
        
        if (eventData instanceof WriteRowsEventData) {
            // å¤„ç†INSERTäº‹ä»¶
            handleInsertEvent((WriteRowsEventData) eventData);
            
        } else if (eventData instanceof UpdateRowsEventData) {
            // å¤„ç†UPDATEäº‹ä»¶
            handleUpdateEvent((UpdateRowsEventData) eventData);
            
        } else if (eventData instanceof DeleteRowsEventData) {
            // å¤„ç†DELETEäº‹ä»¶
            handleDeleteEvent((DeleteRowsEventData) eventData);
        }
    }
    
    private void handleUpdateEvent(UpdateRowsEventData eventData) {
        for (Map.Entry<Serializable[], Serializable[]> row : eventData.getRows()) {
            Serializable[] after = row.getValue(); // æ›´æ–°åçš„æ•°æ®
            
            // å‡è®¾ç¬¬ä¸€åˆ—æ˜¯ID
            Long id = (Long) after[0];
            
            // æ ¹æ®è¡¨åå†³å®šå¦‚ä½•å¤„ç†
            String tableName = getTableName(eventData.getTableId());
            if ("users".equals(tableName)) {
                updateUserCache(id, after);
            } else if ("products".equals(tableName)) {
                updateProductCache(id, after);
            }
        }
    }
    
    private void updateUserCache(Long userId, Serializable[] userData) {
        // ä»æ•°æ®åº“é‡æ–°æŸ¥è¯¢å®Œæ•´æ•°æ®ï¼ˆæˆ–ä»Binlogæ•°æ®æ„é€ å¯¹è±¡ï¼‰
        User user = userRepository.findById(userId).orElse(null);
        if (user != null) {
            String cacheKey = "user:" + userId;
            redisTemplate.opsForValue().set(cacheKey, user, Duration.ofHours(1));
        }
    }
}
```

### 7.4 CDCçš„ä¼˜åŠ¿ä¸æŒ‘æˆ˜


**âœ… CDCçš„ä¼˜åŠ¿ï¼š**
- **å®æ—¶æ€§å¼º**ï¼šæ•°æ®å˜åŒ–åå‡ ä¹ç«‹å³æ›´æ–°ç¼“å­˜
- **æ— ä¸šåŠ¡ä¾µå…¥**ï¼šä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç 
- **å¯é æ€§é«˜**ï¼šåŸºäºæ•°æ®åº“äº‹åŠ¡æ—¥å¿—ï¼Œä¸ä¼šä¸¢å¤±å˜æ›´
- **å…¨é¢è¦†ç›–**ï¼šå¯ä»¥æ•è·æ‰€æœ‰æ•°æ®å˜åŒ–ï¼ŒåŒ…æ‹¬æ‰¹é‡æ“ä½œ

**âš ï¸ é¢ä¸´çš„æŒ‘æˆ˜ï¼š**
- **æŠ€æœ¯å¤æ‚åº¦é«˜**ï¼šéœ€è¦æ·±å…¥ç†è§£æ•°æ®åº“å†…éƒ¨æœºåˆ¶
- **è¿ç»´æˆæœ¬å¤§**ï¼šéœ€è¦ç›‘æ§CDCå·¥å…·çš„å¥åº·çŠ¶æ€
- **æ•°æ®æ ¼å¼å¤æ‚**ï¼šBinlogç­‰æ—¥å¿—æ ¼å¼è§£æè¾ƒå¤æ‚
- **å»¶è¿Ÿå¤„ç†**ï¼šå¤§é‡å˜æ›´æ—¶å¯èƒ½å‡ºç°å¤„ç†å»¶è¿Ÿ

**ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š**
- å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜çš„ç³»ç»Ÿ
- æ•°æ®å˜åŒ–é¢‘ç¹ä¸”éœ€è¦å®æ—¶åŒæ­¥
- å¤šä¸ªç³»ç»Ÿéœ€è¦æ„ŸçŸ¥æ•°æ®å˜åŒ–
- æœ‰ä¸“ä¸šå›¢é˜Ÿç»´æŠ¤å¤æ‚çš„CDCåŸºç¡€è®¾æ–½

---

## 8. ğŸ”§ æ›´æ–°ç­–ç•¥ç»„åˆåº”ç”¨


### 8.1 æ··åˆç­–ç•¥è®¾è®¡åŸåˆ™


> **æ ¸å¿ƒæ€æƒ³**  
> å°±åƒåšèœè¦ç”¨å¤šç§è°ƒæ–™ä¸€æ ·ï¼Œå®é™…é¡¹ç›®ä¸­å¾€å¾€éœ€è¦ç»„åˆå¤šç§æ›´æ–°ç­–ç•¥ï¼Œé’ˆå¯¹ä¸åŒç±»å‹çš„æ•°æ®ä½¿ç”¨æœ€é€‚åˆçš„ç­–ç•¥ã€‚

**ç­–ç•¥é€‰æ‹©çŸ©é˜µï¼š**
```
æ•°æ®ç‰¹å¾åˆ†æï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®ç±»å‹   â”‚   æ›´æ–°é¢‘ç‡   â”‚   ä¸€è‡´æ€§è¦æ±‚ â”‚   æ¨èç­–ç•¥   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·åŸºç¡€ä¿¡æ¯ â”‚     ä½       â”‚     ä¸­       â”‚ è¢«åŠ¨æ›´æ–°+ç‰ˆæœ¬â”‚
â”‚ å•†å“ä»·æ ¼    â”‚     é«˜       â”‚     é«˜       â”‚ ä¸»åŠ¨æ›´æ–°+CDC â”‚
â”‚ ç³»ç»Ÿé…ç½®    â”‚     æä½     â”‚     ä½       â”‚   å®šæ—¶æ›´æ–°   â”‚
â”‚ æ–‡ç« å†…å®¹    â”‚     ä¸­       â”‚     ä¸­       â”‚ ä¸»åŠ¨å¤±æ•ˆ    â”‚
â”‚ ç»Ÿè®¡æ•°æ®    â”‚     ä½       â”‚     ä½       â”‚   å®šæ—¶æ›´æ–°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç”µå•†ç³»ç»Ÿçš„ç»„åˆç­–ç•¥å®è·µ


**ğŸ›’ ç”µå•†ç³»ç»Ÿç¼“å­˜ç­–ç•¥è®¾è®¡ï¼š**

```java
@Service
public class EcommerceCacheStrategy {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private ProductRepository productRepository;
    
    /**
     * ç”¨æˆ·ä¿¡æ¯ï¼šè¢«åŠ¨æ›´æ–° + ç‰ˆæœ¬æ§åˆ¶
     * ç‰¹ç‚¹ï¼šæŸ¥è¯¢é¢‘ç¹ï¼Œæ›´æ–°ä¸é¢‘ç¹ï¼Œå…è®¸çŸ­æš‚ä¸ä¸€è‡´
     */
    public User getUserInfo(Long userId) {
        String cacheKey = "user:" + userId;
        String versionKey = "user_version:" + userId;
        
        // 1. æ£€æŸ¥ç¼“å­˜å’Œç‰ˆæœ¬
        User cachedUser = (User) redisTemplate.opsForValue().get(cacheKey);
        Long cachedVersion = (Long) redisTemplate.opsForValue().get(versionKey);
        
        if (cachedUser != null && cachedVersion != null) {
            // 2. æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦æœ€æ–°ï¼ˆè½»é‡çº§æŸ¥è¯¢ï¼‰
            Long currentVersion = userRepository.getUserVersion(userId);
            if (Objects.equals(cachedVersion, currentVersion)) {
                return cachedUser; // ç‰ˆæœ¬ä¸€è‡´ï¼Œç›´æ¥è¿”å›ç¼“å­˜
            }
        }
        
        // 3. ç‰ˆæœ¬ä¸ä¸€è‡´æˆ–ç¼“å­˜ä¸ºç©ºï¼Œé‡æ–°åŠ è½½
        User dbUser = userRepository.findById(userId).orElse(null);
        if (dbUser != null) {
            redisTemplate.opsForValue().set(cacheKey, dbUser, Duration.ofMinutes(30));
            redisTemplate.opsForValue().set(versionKey, dbUser.getVersion(), Duration.ofMinutes(30));
        }
        
        return dbUser;
    }
    
    /**
     * å•†å“ä»·æ ¼ï¼šä¸»åŠ¨æ›´æ–° + äº‹ä»¶é€šçŸ¥
     * ç‰¹ç‚¹ï¼šä»·æ ¼æ•æ„Ÿï¼Œéœ€è¦å®æ—¶æ€§ï¼Œä¸èƒ½æœ‰å»¶è¿Ÿ
     */
    @EventListener
    public void handlePriceUpdate(ProductPriceUpdateEvent event) {
        String cacheKey = "product_price:" + event.getProductId();
        
        // ç«‹å³æ›´æ–°ä»·æ ¼ç¼“å­˜
        redisTemplate.opsForValue().set(cacheKey, event.getNewPrice(), Duration.ofHours(2));
        
        // åŒæ—¶æ¸…é™¤ç›¸å…³çš„èšåˆç¼“å­˜
        clearRelatedCaches(event.getProductId());
        
        log.info("å•†å“ä»·æ ¼ç¼“å­˜å·²æ›´æ–°: productId={}, newPrice={}", 
                 event.getProductId(), event.getNewPrice());
    }
    
    /**
     * çƒ­é—¨å•†å“åˆ—è¡¨ï¼šå®šæ—¶æ›´æ–°
     * ç‰¹ç‚¹ï¼šè®¡ç®—å¤æ‚ï¼Œæ›´æ–°é¢‘ç‡ä½ï¼Œå…è®¸ä¸€å®šå»¶è¿Ÿ
     */
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
    public void updateHotProductsList() {
        try {
            List<Product> hotProducts = productRepository.findHotProductsWithComplex();
            redisTemplate.opsForValue().set("hot_products", hotProducts, Duration.ofMinutes(10));
            
            log.info("çƒ­é—¨å•†å“åˆ—è¡¨å·²æ›´æ–°ï¼Œå…±{}ä¸ªå•†å“", hotProducts.size());
            
        } catch (Exception e) {
            log.error("æ›´æ–°çƒ­é—¨å•†å“åˆ—è¡¨å¤±è´¥", e);
        }
    }
    
    /**
     * è´­ç‰©è½¦ï¼šæ··åˆç­–ç•¥
     * ç‰¹ç‚¹ï¼šè¯»å†™éƒ½é¢‘ç¹ï¼Œéœ€è¦å®æ—¶æ€§ï¼Œä½†å…è®¸æœ€ç»ˆä¸€è‡´æ€§
     */
    public void addToCart(Long userId, Long productId, Integer quantity) {
        String cartKey = "cart:" + userId;
        
        // 1. å…ˆæ›´æ–°ç¼“å­˜ï¼ˆå¿«é€Ÿå“åº”ï¼‰
        redisTemplate.opsForHash().put(cartKey, productId.toString(), quantity);
        redisTemplate.expire(cartKey, Duration.ofDays(7));
        
        // 2. å¼‚æ­¥æŒä¹…åŒ–åˆ°æ•°æ®åº“
        CompletableFuture.runAsync(() -> {
            try {
                cartRepository.saveCartItem(userId, productId, quantity);
            } catch (Exception e) {
                log.error("è´­ç‰©è½¦æŒä¹…åŒ–å¤±è´¥: userId={}, productId={}", userId, productId, e);
                // å¯ä»¥è€ƒè™‘è¡¥å¿æœºåˆ¶
            }
        });
    }
    
    private void clearRelatedCaches(Long productId) {
        // æ¸…é™¤å•†å“è¯¦æƒ…ç¼“å­˜
        redisTemplate.delete("product:" + productId);
        
        // æ¸…é™¤åˆ†ç±»å•†å“åˆ—è¡¨ç¼“å­˜
        Product product = productRepository.findById(productId).orElse(null);
        if (product != null) {
            redisTemplate.delete("category_products:" + product.getCategoryId());
        }
        
        // æ¸…é™¤æœç´¢ç›¸å…³ç¼“å­˜
        redisTemplate.delete("search_cache:*");
    }
}
```

### 8.3 å†…å®¹ç®¡ç†ç³»ç»Ÿçš„ç­–ç•¥ç»„åˆ


**ğŸ“ CMSç³»ç»Ÿçš„ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼š**

```java
@Service
public class CMSCacheManager {
    
    /**
     * æ–‡ç« å†…å®¹ï¼šä¸»åŠ¨å¤±æ•ˆ + é¢„çƒ­
     * ç‰¹ç‚¹ï¼šå†…å®¹å‹æ•°æ®ï¼Œæ›´æ–°åç«‹å³ç”Ÿæ•ˆï¼Œæ”¯æŒé¢„è§ˆ
     */
    @Transactional
    public Article publishArticle(Article article) {
        // 1. ä¿å­˜åˆ°æ•°æ®åº“
        Article published = articleRepository.save(article);
        
        // 2. åˆ é™¤æ—§ç¼“å­˜
        String articleKey = "article:" + article.getId();
        redisTemplate.delete(articleKey);
        
        // 3. é¢„çƒ­æ–°ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
        if (article.isHotArticle()) {
            redisTemplate.opsForValue().set(articleKey, published, Duration.ofHours(6));
        }
        
        // 4. æ¸…é™¤ç›¸å…³åˆ—è¡¨ç¼“å­˜
        clearArticleListCaches(article);
        
        return published;
    }
    
    /**
     * ç½‘ç«™é…ç½®ï¼šå®šæ—¶æ›´æ–° + ä¸»åŠ¨é€šçŸ¥
     * ç‰¹ç‚¹ï¼šé…ç½®ç±»æ•°æ®ï¼Œå˜åŒ–å¾ˆå°‘ï¼Œä½†éœ€è¦å…¨ç«™ç”Ÿæ•ˆ
     */
    @EventListener
    public void handleConfigUpdate(ConfigUpdateEvent event) {
        // ç«‹å³æ›´æ–°é…ç½®ç¼“å­˜
        String configKey = "site_config:" + event.getConfigKey();
        redisTemplate.opsForValue().set(configKey, event.getConfigValue(), Duration.ofHours(24));
        
        // é€šçŸ¥æ‰€æœ‰åº”ç”¨èŠ‚ç‚¹åˆ·æ–°æœ¬åœ°ç¼“å­˜
        applicationEventPublisher.publishEvent(new LocalCacheRefreshEvent(event.getConfigKey()));
    }
    
    /**
     * è¯„è®ºæ•°æ®ï¼šå†™åè¯»ç­–ç•¥
     * ç‰¹ç‚¹ï¼šè¯»å¤šå†™å°‘ï¼Œä½†å†™å…¥åéœ€è¦ç«‹å³å¯è§
     */
    public Comment addComment(Comment comment) {
        // 1. ä¿å­˜åˆ°æ•°æ®åº“
        Comment saved = commentRepository.save(comment);
        
        // 2. ç«‹å³æ›´æ–°æ–‡ç« è¯„è®ºè®¡æ•°ç¼“å­˜
        String countKey = "article_comment_count:" + comment.getArticleId();
        redisTemplate.opsForValue().increment(countKey);
        
        // 3. æ·»åŠ åˆ°è¯„è®ºåˆ—è¡¨ç¼“å­˜çš„å¤´éƒ¨
        String commentsKey = "article_comments:" + comment.getArticleId();
        redisTemplate.opsForList().leftPush(commentsKey, saved);
        
        // 4. é™åˆ¶åˆ—è¡¨é•¿åº¦ï¼Œåªä¿ç•™æœ€æ–°çš„100æ¡
        redisTemplate.opsForList().trim(commentsKey, 0, 99);
        
        return saved;
    }
}
```

### 8.4 é‡‘èç³»ç»Ÿçš„ä¸¥æ ¼ä¸€è‡´æ€§ç­–ç•¥


**ğŸ’° é‡‘èç³»ç»Ÿçš„ç¼“å­˜ç­–ç•¥ï¼š**

```java
@Service
public class FinancialCacheManager {
    
    /**
     * è´¦æˆ·ä½™é¢ï¼šå¼ºä¸€è‡´æ€§è¦æ±‚
     * ç‰¹ç‚¹ï¼šç»å¯¹ä¸èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´ï¼Œé‡‡ç”¨ç¼“å­˜asideæ¨¡å¼
     */
    public BigDecimal getAccountBalance(Long accountId) {
        // é‡‘èæ•°æ®ä¸ä½¿ç”¨ç¼“å­˜ï¼Œå§‹ç»ˆä»æ•°æ®åº“è¯»å–
        return accountRepository.getBalance(accountId);
    }
    
    /**
     * äº¤æ˜“è®°å½•ï¼šæœ€ç»ˆä¸€è‡´æ€§
     * ç‰¹ç‚¹ï¼šæŸ¥è¯¢é¢‘ç¹ï¼Œä½†å¯ä»¥æ¥å—çŸ­æš‚å»¶è¿Ÿ
     */
    @EventListener
    public void handleTransactionCompleted(TransactionCompletedEvent event) {
        // ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§
        rabbitTemplate.convertAndSend("transaction.exchange", "cache.update", event);
    }
    
    @RabbitListener(queues = "transaction.cache.queue")
    public void updateTransactionCache(TransactionCompletedEvent event) {
        try {
            String cacheKey = "account_transactions:" + event.getAccountId();
            
            // é‡æ–°æŸ¥è¯¢æœ€æ–°çš„äº¤æ˜“è®°å½•
            List<Transaction> transactions = transactionRepository
                .findByAccountIdOrderByCreateTimeDesc(event.getAccountId(), PageRequest.of(0, 20));
            
            redisTemplate.opsForValue().set(cacheKey, transactions, Duration.ofMinutes(5));
            
        } catch (Exception e) {
            log.error("æ›´æ–°äº¤æ˜“ç¼“å­˜å¤±è´¥", e);
            // é‡‘èç³»ç»Ÿçš„å¤±è´¥éœ€è¦å‘Šè­¦å¤„ç†
            alertService.sendAlert("ç¼“å­˜æ›´æ–°å¤±è´¥", e.getMessage());
        }
    }
    
    /**
     * æ±‡ç‡æ•°æ®ï¼šå®šæ—¶æ›´æ–° + ç‰ˆæœ¬æ§åˆ¶
     * ç‰¹ç‚¹ï¼šå¤–éƒ¨æ•°æ®æºï¼Œéœ€è¦å®šæœŸåŒæ­¥ï¼Œæœ‰ç‰ˆæœ¬æ¦‚å¿µ
     */
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
    public void updateExchangeRates() {
        try {
            // ä»å¤–éƒ¨APIè·å–æœ€æ–°æ±‡ç‡
            ExchangeRateResponse rateResponse = exchangeRateAPI.getCurrentRates();
            
            if (rateResponse.getVersion() > getCurrentCachedVersion()) {
                // ç‰ˆæœ¬æ›´æ–°ï¼Œåˆ·æ–°ç¼“å­˜
                redisTemplate.opsForValue().set("exchange_rates", rateResponse.getRates(), Duration.ofMinutes(2));
                redisTemplate.opsForValue().set("exchange_rates_version", rateResponse.getVersion(), Duration.ofMinutes(2));
                
                log.info("æ±‡ç‡æ•°æ®å·²æ›´æ–°ï¼Œç‰ˆæœ¬: {}", rateResponse.getVersion());
            }
            
        } catch (Exception e) {
            log.error("æ›´æ–°æ±‡ç‡æ•°æ®å¤±è´¥", e);
        }
    }
}
```

### 8.5 ç­–ç•¥ç»„åˆçš„ç›‘æ§ä¸ä¼˜åŒ–


**ğŸ“Š ç¼“å­˜æ›´æ–°æ•ˆæœç›‘æ§ï¼š**

```java
@Component
public class CacheUpdateMonitor {
    
    private final MeterRegistry meterRegistry;
    
    // ç›‘æ§æŒ‡æ ‡
    private final Counter cacheUpdateSuccess;
    private final Counter cacheUpdateFailure;
    private final Timer cacheUpdateDuration;
    
    public CacheUpdateMonitor(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.cacheUpdateSuccess = Counter.builder("cache.update.success").register(meterRegistry);
        this.cacheUpdateFailure = Counter.builder("cache.update.failure").register(meterRegistry);
        this.cacheUpdateDuration = Timer.builder("cache.update.duration").register(meterRegistry);
    }
    
    @EventListener
    public void onCacheUpdate(CacheUpdateEvent event) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            // æ‰§è¡Œç¼“å­˜æ›´æ–°é€»è¾‘
            executeCacheUpdate(event);
            cacheUpdateSuccess.increment();
            
        } catch (Exception e) {
            cacheUpdateFailure.increment();
            log.error("ç¼“å­˜æ›´æ–°å¤±è´¥: {}", event, e);
            
        } finally {
            sample.stop(cacheUpdateDuration);
        }
    }
    
    // å®šæœŸè¾“å‡ºç›‘æ§æŠ¥å‘Š
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿè¾“å‡ºä¸€æ¬¡
    public void printMonitoringReport() {
        double successRate = cacheUpdateSuccess.count() / 
                           (cacheUpdateSuccess.count() + cacheUpdateFailure.count()) * 100;
        
        log.info("ç¼“å­˜æ›´æ–°ç›‘æ§æŠ¥å‘Š: æˆåŠŸç‡={}%, å¹³å‡è€—æ—¶={}ms", 
                 String.format("%.2f", successRate),
                 cacheUpdateDuration.mean(TimeUnit.MILLISECONDS));
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç¼“å­˜æ›´æ–°ç­–ç•¥æœ¬è´¨ï¼šä¿æŒç¼“å­˜ä¸æ•°æ®æºä¸€è‡´æ€§çš„å„ç§æ–¹æ³•
ğŸ”¸ ç­–ç•¥åˆ†ç±»ï¼šå®šæ—¶æ›´æ–°ã€ä¸»åŠ¨æ›´æ–°ã€è¢«åŠ¨æ›´æ–°ä¸‰å¤§ç±»
ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶ï¼šé€šè¿‡ç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ã€å“ˆå¸Œå€¼åˆ¤æ–­æ•°æ®æ˜¯å¦éœ€è¦æ›´æ–°
ğŸ”¸ äº‹ä»¶é©±åŠ¨ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“è§¦å‘å™¨å®ç°æ•°æ®å˜åŒ–é€šçŸ¥
ğŸ”¸ CDCæŠ€æœ¯ï¼šæ•è·æ•°æ®åº“å˜æ›´æ—¥å¿—ï¼Œå®ç°è¿‘å®æ—¶çš„ç¼“å­˜åŒæ­¥
ğŸ”¸ ç­–ç•¥ç»„åˆï¼šæ ¹æ®ä¸åŒæ•°æ®ç‰¹å¾é€‰æ‹©åˆé€‚çš„æ›´æ–°ç­–ç•¥ç»„åˆ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ²¡æœ‰å®Œç¾çš„ç­–ç•¥ï¼Œåªæœ‰åˆé€‚çš„ç­–ç•¥**
```
ç­–ç•¥é€‰æ‹©è€ƒè™‘å› ç´ ï¼š
â€¢ æ•°æ®æ›´æ–°é¢‘ç‡ï¼šé¢‘ç¹æ›´æ–°é€‚åˆä¸»åŠ¨ç­–ç•¥
â€¢ ä¸€è‡´æ€§è¦æ±‚ï¼šå¼ºä¸€è‡´æ€§éœ€è¦åŒæ­¥æ›´æ–°
â€¢ æ€§èƒ½è¦æ±‚ï¼šé«˜å¹¶å‘åœºæ™¯ä¼˜é€‰å¼‚æ­¥æ›´æ–°
â€¢ ç³»ç»Ÿå¤æ‚åº¦ï¼šç®€å•ç³»ç»Ÿä¼˜é€‰å®šæ—¶æˆ–è¢«åŠ¨æ›´æ–°
```

**ğŸ”¹ ä¸€è‡´æ€§ä¸æ€§èƒ½çš„å¹³è¡¡è‰ºæœ¯**
```
ä¸€è‡´æ€§çº§åˆ«ï¼š
å¼ºä¸€è‡´æ€§ â†’ åŒæ­¥æ›´æ–° â†’ æ€§èƒ½è¾ƒä½ â†’ é€‚åˆå…³é”®ä¸šåŠ¡æ•°æ®
æœ€ç»ˆä¸€è‡´æ€§ â†’ å¼‚æ­¥æ›´æ–° â†’ æ€§èƒ½è¾ƒé«˜ â†’ é€‚åˆä¸€èˆ¬ä¸šåŠ¡æ•°æ®
å¼±ä¸€è‡´æ€§ â†’ å®šæ—¶æ›´æ–° â†’ æ€§èƒ½æœ€é«˜ â†’ é€‚åˆç»Ÿè®¡ç±»æ•°æ®
```

**ğŸ”¹ å®¹é”™ä¸ç›‘æ§çš„é‡è¦æ€§**
```
ç”Ÿäº§ç¯å¢ƒå¿…å¤‡ï¼š
â€¢ æ›´æ–°å¤±è´¥çš„é‡è¯•æœºåˆ¶
â€¢ ç¼“å­˜ä¸ä¸€è‡´çš„æ£€æµ‹å’Œä¿®å¤
â€¢ æ›´æ–°æ€§èƒ½å’ŒæˆåŠŸç‡çš„ç›‘æ§
â€¢ å¼‚å¸¸æƒ…å†µçš„å‘Šè­¦å’Œå¤„ç†
```

### 9.3 å®è·µåº”ç”¨æŒ‡å¯¼


**ğŸ“‹ ç­–ç•¥é€‰æ‹©æ¸…å•ï¼š**

| **æ•°æ®ç±»å‹** | **æ›´æ–°é¢‘ç‡** | **ä¸€è‡´æ€§è¦æ±‚** | **æ¨èç­–ç•¥** | **å…³é”®é…ç½®** |
|-------------|-------------|-------------|-------------|-------------|
| ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ | ä½ | ä¸­ | è¢«åŠ¨æ›´æ–°+ç‰ˆæœ¬æ§åˆ¶ | TTL=30åˆ†é’Ÿ |
| å•†å“ä»·æ ¼ | é«˜ | æé«˜ | ä¸»åŠ¨æ›´æ–°+CDC | å®æ—¶æ›´æ–° |
| æ–‡ç« å†…å®¹ | ä¸­ | é«˜ | ä¸»åŠ¨å¤±æ•ˆ+é¢„çƒ­ | ç«‹å³ç”Ÿæ•ˆ |
| ç³»ç»Ÿé…ç½® | æä½ | ä¸­ | å®šæ—¶æ›´æ–°+å¹¿æ’­ | TTL=24å°æ—¶ |
| ç»Ÿè®¡æ•°æ® | ä½ | ä½ | å®šæ—¶æ›´æ–° | æ¯5-10åˆ†é’Ÿ |
| è´­ç‰©è½¦ | é«˜ | ä¸­ | å†™åè¯»+å¼‚æ­¥æŒä¹…åŒ– | TTL=7å¤© |

**ğŸ¯ é€‰æ‹©ç­–ç•¥çš„å†³ç­–æ ‘ï¼š**

```
æ•°æ®æ›´æ–°ç­–ç•¥å†³ç­–æµç¨‹ï¼š
                    å¼€å§‹
                     â†“
                æ•°æ®æ˜¯å¦å…³é”®ï¼Ÿ
               â†™ï¸      â†˜ï¸
            æ˜¯            å¦
             â†“             â†“
        ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Ÿ    æ›´æ–°é¢‘ç‡é«˜ï¼Ÿ
        â†™ï¸       â†˜ï¸      â†™ï¸       â†˜ï¸
      æ˜¯         å¦      æ˜¯         å¦
       â†“          â†“       â†“          â†“
   ä¸»åŠ¨æ›´æ–°    è¢«åŠ¨æ›´æ–°  ä¸»åŠ¨æ›´æ–°   å®šæ—¶æ›´æ–°
   +CDC       +ç‰ˆæœ¬    +å¼‚æ­¥      +æ‰¹é‡
```

### 9.4 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**âš™ï¸ é…ç½®ä¼˜åŒ–å»ºè®®ï¼š**

```java
// ç¼“å­˜æ›´æ–°é…ç½®ç±»
@Configuration
public class CacheUpdateConfig {
    
    // ä¸åŒç­–ç•¥çš„çº¿ç¨‹æ± é…ç½®
    @Bean("syncUpdateExecutor")
    public ThreadPoolTaskExecutor syncUpdateExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);        // åŒæ­¥æ›´æ–°ä¸éœ€è¦å¤ªå¤šçº¿ç¨‹
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("sync-update-");
        return executor;
    }
    
    @Bean("asyncUpdateExecutor")  
    public ThreadPoolTaskExecutor asyncUpdateExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(20);       // å¼‚æ­¥æ›´æ–°å¯ä»¥å¤šä¸€äº›çº¿ç¨‹
        executor.setMaxPoolSize(50);
        executor.setQueueCapacity(1000);
        executor.setThreadNamePrefix("async-update-");
        return executor;
    }
    
    // Redisé…ç½®ä¼˜åŒ–
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // ä½¿ç”¨Jacksonåºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> serializer = new Jackson2JsonRedisSerializer<>(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        serializer.setObjectMapper(om);
        
        template.setDefaultSerializer(serializer);
        template.setKeySerializer(new StringRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        
        return template;
    }
}
```

**ğŸ›¡ï¸ å®¹é”™å¤„ç†æœºåˆ¶ï¼š**

```java
@Component
public class CacheUpdateFallback {
    
    // æ›´æ–°å¤±è´¥æ—¶çš„é™çº§ç­–ç•¥
    @Retryable(value = Exception.class, maxAttempts = 3, backoff = @Backoff(delay = 1000))
    public void updateCacheWithRetry(String cacheKey, Object data) {
        try {
            redisTemplate.opsForValue().set(cacheKey, data, Duration.ofMinutes(30));
            
        } catch (RedisConnectionFailureException e) {
            log.warn("Redisè¿æ¥å¤±è´¥ï¼Œå°è¯•é™çº§å¤„ç†: {}", cacheKey);
            handleRedisFailure(cacheKey, data);
            
        } catch (Exception e) {
            log.error("ç¼“å­˜æ›´æ–°å¤±è´¥: {}", cacheKey, e);
            throw e; // é‡è¯•æœºåˆ¶ä¼šæ•è·å¹¶é‡è¯•
        }
    }
    
    @Recover
    public void recoverFromUpdateFailure(Exception e, String cacheKey, Object data) {
        // é‡è¯•å¤±è´¥åçš„æœ€ç»ˆå¤„ç†
        log.error("ç¼“å­˜æ›´æ–°æœ€ç»ˆå¤±è´¥ï¼Œè®°å½•åˆ°å¤±è´¥é˜Ÿåˆ—: {}", cacheKey, e);
        
        // å¯ä»¥å°†å¤±è´¥çš„æ›´æ–°ä»»åŠ¡æ”¾å…¥å»¶è¿Ÿé˜Ÿåˆ—ç¨åé‡è¯•
        failureQueueService.addFailedUpdate(cacheKey, data);
    }
    
    private void handleRedisFailure(String cacheKey, Object data) {
        // Redisä¸å¯ç”¨æ—¶çš„é™çº§æ–¹æ¡ˆ
        // 1. è®°å½•åˆ°æœ¬åœ°æ–‡ä»¶
        localCacheBackup.save(cacheKey, data);
        
        // 2. æˆ–è€…ä½¿ç”¨æœ¬åœ°å†…å­˜ç¼“å­˜
        localCache.put(cacheKey, data);
        
        // 3. å‘é€å‘Šè­¦é€šçŸ¥
        alertService.sendAlert("Redisè¿æ¥å¤±è´¥", "ç¼“å­˜é”®: " + cacheKey);
    }
}
```

**ğŸ“Š ç›‘æ§å‘Šè­¦é…ç½®ï¼š**

```yaml
# application.yml ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: metrics,health,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: cache-service

# å‘Šè­¦è§„åˆ™ç¤ºä¾‹ (Prometheus Alert Rules)
groups:
  - name: cache_update_alerts
    rules:
      - alert: CacheUpdateFailureRate
        expr: rate(cache_update_failure_total[5m]) / rate(cache_update_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "ç¼“å­˜æ›´æ–°å¤±è´¥ç‡è¿‡é«˜"
          description: "è¿‡å»5åˆ†é’Ÿç¼“å­˜æ›´æ–°å¤±è´¥ç‡è¶…è¿‡10%"
          
      - alert: CacheUpdateLatency
        expr: cache_update_duration{quantile="0.95"} > 1000
        for: 2m
        labels:
          severity: warning  
        annotations:
          summary: "ç¼“å­˜æ›´æ–°å»¶è¿Ÿè¿‡é«˜"
          description: "95%åˆ†ä½æ•°çš„æ›´æ–°å»¶è¿Ÿè¶…è¿‡1ç§’"
```

### 9.5 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ é—®é¢˜1ï¼šç¼“å­˜æ›´æ–°é£æš´**
```
ç°è±¡ï¼šå¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›æ¿€å¢

è§£å†³æ–¹æ¡ˆï¼š
â€¢ é”™å³°å¤±æ•ˆï¼šä¸ºç›¸åŒTTLçš„ç¼“å­˜æ·»åŠ éšæœºåç§»
â€¢ é¢„çƒ­æœºåˆ¶ï¼šåœ¨ç¼“å­˜å¤±æ•ˆå‰ä¸»åŠ¨åˆ·æ–°
â€¢ é™æµä¿æŠ¤ï¼šå¯¹æ•°æ®åº“æŸ¥è¯¢è¿›è¡Œé™æµ

ä»£ç ç¤ºä¾‹ï¼š
// æ·»åŠ éšæœºTTLé¿å…åŒæ—¶å¤±æ•ˆ
Duration ttl = Duration.ofMinutes(30).plusSeconds(random.nextInt(300)); // 30åˆ†é’ŸÂ±5åˆ†é’Ÿ
redisTemplate.opsForValue().set(key, value, ttl);
```

**â“ é—®é¢˜2ï¼šç¼“å­˜ä¸æ•°æ®åº“ä¸ä¸€è‡´**
```
ç°è±¡ï¼šæ›´æ–°äº†æ•°æ®åº“ä½†ç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œå¯¼è‡´è¯»åˆ°æ—§æ•°æ®

è§£å†³æ–¹æ¡ˆï¼š
â€¢ æœ€ç»ˆä¸€è‡´æ€§æ£€æŸ¥ï¼šå®šæœŸæ¯”è¾ƒç¼“å­˜å’Œæ•°æ®åº“
â€¢ è¡¥å¿äº‹åŠ¡ï¼šè®°å½•æ›´æ–°å¤±è´¥çš„æ“ä½œï¼Œåç»­è¡¥å¿
â€¢ ç‰ˆæœ¬æ ¡éªŒï¼šè¯»å–æ—¶æ ¡éªŒç‰ˆæœ¬å·

ä»£ç ç¤ºä¾‹ï¼š
@Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
public void checkCacheConsistency() {
    List<String> suspiciousKeys = findSuspiciousKeys();
    for (String key : suspiciousKeys) {
        repairCacheData(key);
    }
}
```

**â“ é—®é¢˜3ï¼šçƒ­ç‚¹æ•°æ®æ›´æ–°å†²çª**
```
ç°è±¡ï¼šçƒ­ç‚¹æ•°æ®é¢‘ç¹æ›´æ–°ï¼Œå¤šä¸ªæ›´æ–°è¯·æ±‚ç›¸äº’å†²çª

è§£å†³æ–¹æ¡ˆï¼š  
â€¢ åˆ†å¸ƒå¼é”ï¼šæ›´æ–°æ—¶åŠ é”é¿å…å¹¶å‘å†²çª
â€¢ é˜Ÿåˆ—åŒ–å¤„ç†ï¼šå°†æ›´æ–°è¯·æ±‚æ’é˜Ÿé¡ºåºå¤„ç†
â€¢ åˆ†ç‰‡ç­–ç•¥ï¼šå°†çƒ­ç‚¹æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªç¼“å­˜é”®

ä»£ç ç¤ºä¾‹ï¼š
@DistributedLock(key = "'update_lock:' + #productId")
public void updateHotProduct(Long productId, Product product) {
    // åŠ é”åçš„æ›´æ–°é€»è¾‘
    String key = "product:" + productId;
    redisTemplate.opsForValue().set(key, product, Duration.ofMinutes(30));
}
```

### 9.6 æŠ€æœ¯å‘å±•è¶‹åŠ¿


**ğŸ”® æœªæ¥å‘å±•æ–¹å‘ï¼š**

- **æ™ºèƒ½ç¼“å­˜æ›´æ–°**ï¼šåŸºäºAIçš„æ›´æ–°ç­–ç•¥ä¼˜åŒ–
- **è¾¹ç¼˜è®¡ç®—é›†æˆ**ï¼šCDNè¾¹ç¼˜èŠ‚ç‚¹çš„æ™ºèƒ½ç¼“å­˜
- **å¤šçº§ç¼“å­˜åè°ƒ**ï¼šL1/L2/L3ç¼“å­˜çš„ç»Ÿä¸€æ›´æ–°
- **å®æ—¶æµå¤„ç†**ï¼šåŸºäºæµè®¡ç®—çš„å¢é‡æ›´æ–°
- **åŒºå—é“¾ä¸€è‡´æ€§**ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å¼ºä¸€è‡´æ€§ä¿è¯

**ğŸ“š å­¦ä¹ å»ºè®®ï¼š**

1. **æŒæ¡åŸºç¡€**ï¼šå…ˆç†Ÿç»ƒæŒæ¡åŸºæœ¬çš„ä¸‰ç§æ›´æ–°ç­–ç•¥
2. **ç†è§£åœºæ™¯**ï¼šå­¦ä¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚ç­–ç•¥
3. **åŠ¨æ‰‹å®è·µ**ï¼šæ­å»ºæµ‹è¯•ç¯å¢ƒéªŒè¯ä¸åŒç­–ç•¥æ•ˆæœ
4. **ç›‘æ§è°ƒä¼˜**ï¼šå­¦ä¼šåˆ†æç›‘æ§æ•°æ®ä¼˜åŒ–æ›´æ–°ç­–ç•¥
5. **æŒç»­å­¦ä¹ **ï¼šå…³æ³¨æ–°æŠ€æœ¯åœ¨ç¼“å­˜é¢†åŸŸçš„åº”ç”¨

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
- å®šæ—¶æ›´æ–°çœå¿ƒçœåŠ›ï¼Œé€‚åˆå˜åŒ–ä¸é¢‘ç¹
- ä¸»åŠ¨æ›´æ–°å®æ—¶å¯é ï¼Œå…³é”®æ•°æ®å¿…é¡»é€‰  
- è¢«åŠ¨æ›´æ–°æŒ‰éœ€åŠ è½½ï¼Œå†…å­˜ä½¿ç”¨æ›´é«˜æ•ˆ
- ç‰ˆæœ¬æ§åˆ¶é¿å…å†²çªï¼Œä¸€è‡´æ€§æ£€æŸ¥è¦åšå¥½
- äº‹ä»¶é©±åŠ¨å“åº”åŠæ—¶ï¼Œè§£è€¦ç³»ç»Ÿä¿ƒæ‰©å±•
- CDCæ•è·å˜æ›´æ—¥å¿—ï¼Œè¿‘å®æ—¶åŒæ­¥æœ€å¯é 
- ç­–ç•¥ç»„åˆå› åœ°åˆ¶å®œï¼Œç›‘æ§å‘Šè­¦ä¸å¯å°‘