---
title: 3ã€ç¼“å­˜å¤±æ•ˆé—®é¢˜å¤„ç†
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜å¤±æ•ˆé—®é¢˜æ¦‚è¿°](#1-ç¼“å­˜å¤±æ•ˆé—®é¢˜æ¦‚è¿°)
2. [ç¼“å­˜ç©¿é€é—®é¢˜](#2-ç¼“å­˜ç©¿é€é—®é¢˜)
3. [ç¼“å­˜å‡»ç©¿é—®é¢˜](#3-ç¼“å­˜å‡»ç©¿é—®é¢˜)
4. [ç¼“å­˜é›ªå´©é—®é¢˜](#4-ç¼“å­˜é›ªå´©é—®é¢˜)
5. [ç»¼åˆè§£å†³æ–¹æ¡ˆ](#5-ç»¼åˆè§£å†³æ–¹æ¡ˆ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç¼“å­˜å¤±æ•ˆé—®é¢˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç¼“å­˜å¤±æ•ˆ


**ç®€å•ç†è§£**ï¼šç¼“å­˜å¤±æ•ˆå°±åƒæ˜¯ä½ å®¶å†°ç®±åäº†ï¼Œæ‰€æœ‰ä¿é²œçš„é£Ÿç‰©éƒ½ä¸èƒ½ç”¨äº†ï¼Œä½ åªèƒ½å»èœå¸‚åœºé‡æ–°ä¹°ï¼Œä½†å¦‚æœå¤§å®¶éƒ½åŒæ—¶å»èœå¸‚åœºï¼Œå°±ä¼šé€ æˆæ‹¥æŒ¤ã€‚

**æŠ€æœ¯å®šä¹‰**ï¼šç¼“å­˜å¤±æ•ˆæ˜¯æŒ‡ç¼“å­˜ä¸­çš„æ•°æ®å› ä¸ºè¿‡æœŸã€è¢«åˆ é™¤æˆ–å…¶ä»–åŸå› å¯¼è‡´æ— æ³•ä½¿ç”¨ï¼Œéœ€è¦é‡æ–°ä»æ•°æ®åº“è·å–æ•°æ®çš„æƒ…å†µã€‚

### 1.2 ç¼“å­˜å¤±æ•ˆçš„ä¸‰å¤§é—®é¢˜


```
ç¼“å­˜å¤±æ•ˆä¸‰å…„å¼Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼“å­˜ç©¿é€    â”‚    â”‚  ç¼“å­˜å‡»ç©¿    â”‚    â”‚  ç¼“å­˜é›ªå´©    â”‚
â”‚  Cache      â”‚    â”‚  Cache      â”‚    â”‚  Cache      â”‚
â”‚  Penetrationâ”‚    â”‚  Breakdown  â”‚    â”‚  Avalanche  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                   â†“                   â†“
   æŸ¥è¯¢ä¸å­˜åœ¨          çƒ­ç‚¹æ•°æ®å¤±æ•ˆ         å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ
   çš„æ•°æ®              å•ç‚¹å‹åŠ›             å…¨é¢å‹åŠ›
```

**å½±å“èŒƒå›´å¯¹æ¯”**ï¼š
- **ç¼“å­˜ç©¿é€**ï¼šğŸ¯ é’ˆå¯¹æ€§æ”»å‡»ï¼ŒæŸ¥è¯¢æ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®
- **ç¼“å­˜å‡»ç©¿**ï¼šğŸ”¥ çƒ­ç‚¹æ•°æ®å¤±æ•ˆï¼Œç¬é—´å‹åŠ›é›†ä¸­
- **ç¼“å­˜é›ªå´©**ï¼šğŸ’¥ å¤§é¢ç§¯å¤±æ•ˆï¼Œç³»ç»Ÿæ•´ä½“å´©æºƒ

---

## 2. ğŸ•³ï¸ ç¼“å­˜ç©¿é€é—®é¢˜


### 2.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒæœ‰äººæ•…æ„é—®ä½ ä¸€äº›æ ¹æœ¬ä¸å­˜åœ¨çš„é—®é¢˜ï¼Œæ¯”å¦‚"è¯·é—®æé¾™ç°åœ¨åœ¨å“ªé‡Œä¹°ç¥¨ï¼Ÿ"ä½ æ¯æ¬¡éƒ½è¦å»æŸ¥ï¼Œä½†æ°¸è¿œæŸ¥ä¸åˆ°ï¼Œç™½ç™½æµªè´¹æ—¶é—´ã€‚

**æŠ€æœ¯ç°è±¡**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ ç¼“å­˜(æ²¡æœ‰) â†’ æ•°æ®åº“(ä¹Ÿæ²¡æœ‰) â†’ è¿”å›ç©º â†’ ä¸‹æ¬¡è¿˜æ˜¯è¿™æ ·å¾ªç¯
```

### 2.2 ç¼“å­˜ç©¿é€çš„å±å®³


**ğŸš¨ å±å®³åˆ†æ**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
ç”¨æˆ· â†’ ç¼“å­˜(æœ‰æ•°æ®) â†’ ç›´æ¥è¿”å› âœ…

ç©¿é€æƒ…å†µï¼š
ç”¨æˆ· â†’ ç¼“å­˜(æ— æ•°æ®) â†’ æ•°æ®åº“(æ— æ•°æ®) â†’ ç¼“å­˜(è¿˜æ˜¯æ— ) â†’ æ•°æ®åº“ç»§ç»­æŸ¥è¯¢ âŒ
```

| å½±å“æ–¹é¢ | å…·ä½“è¡¨ç° | å±å®³ç¨‹åº¦ |
|---------|----------|---------|
| **æ•°æ®åº“å‹åŠ›** | æ¯æ¬¡éƒ½è¦æŸ¥è¯¢æ•°æ®åº“ | â­â­â­â­â­ |
| **å“åº”æ—¶é—´** | æ¯æ¬¡éƒ½æ˜¯æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | â­â­â­â­ |
| **ç³»ç»Ÿç¨³å®šæ€§** | å¯èƒ½å¯¼è‡´æ•°æ®åº“å´©æºƒ | â­â­â­â­â­ |

### 2.3 å¸ƒéš†è¿‡æ»¤å™¨è§£å†³æ–¹æ¡ˆ


**ğŸ’¡ æ ¸å¿ƒæ€æƒ³**ï¼šåœ¨ç¼“å­˜å‰é¢å†åŠ ä¸€å±‚"é—¨å«"ï¼Œå…ˆåˆ¤æ–­æ•°æ®æ˜¯å¦å¯èƒ½å­˜åœ¨ã€‚

**å¸ƒéš†è¿‡æ»¤å™¨å·¥ä½œåŸç†**ï¼š
```
å¸ƒéš†è¿‡æ»¤å™¨åƒæ˜¯ä¸€ä¸ª"å¯èƒ½æ€§æ£€æµ‹å™¨"ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¸ƒéš†è¿‡æ»¤å™¨   â”‚ â†’ è¯´"ä¸å­˜åœ¨" = ä¸€å®šä¸å­˜åœ¨ âœ…
â”‚             â”‚ â†’ è¯´"å­˜åœ¨" = å¯èƒ½å­˜åœ¨ â“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æ­¥éª¤**ï¼š

```java
// ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨
@Component
public class BloomFilterService {
    private BloomFilter<String> bloomFilter;
    
    @PostConstruct
    public void init() {
        // åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨ï¼Œé¢„è®¡100ä¸‡æ•°æ®ï¼Œ1%è¯¯åˆ¤ç‡
        bloomFilter = BloomFilter.create(
            Funnels.stringFunnel(Charset.defaultCharset()), 
            1000000, 
            0.01
        );
        
        // å°†æ‰€æœ‰å­˜åœ¨çš„æ•°æ®IDæ”¾å…¥è¿‡æ»¤å™¨
        loadExistingDataToBloomFilter();
    }
    
    public boolean mightExist(String key) {
        return bloomFilter.mightContain(key);
    }
}
```

**ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨çš„æŸ¥è¯¢æµç¨‹**ï¼š
```
æŸ¥è¯¢æµç¨‹ï¼š
1. ç”¨æˆ·è¯·æ±‚æ•°æ®ID="user123"
2. å¸ƒéš†è¿‡æ»¤å™¨æ£€æŸ¥ â†’ å¦‚æœè¯´"ä¸å­˜åœ¨"ï¼Œç›´æ¥è¿”å›null
3. å¦‚æœè¯´"å¯èƒ½å­˜åœ¨"ï¼Œç»§ç»­æŸ¥ç¼“å­˜
4. ç¼“å­˜æ²¡æœ‰ï¼Œå†æŸ¥æ•°æ®åº“
```

### 2.4 ç©ºå€¼ç¼“å­˜ç­–ç•¥


**ğŸ’¡ åŸºæœ¬æ€æƒ³**ï¼šå¯¹äºä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿç»™å®ƒåœ¨ç¼“å­˜ä¸­å ä¸ªä½ç½®ï¼Œåªæ˜¯å­˜çš„æ˜¯"ç©º"ã€‚

**å®ç°æ–¹å¼**ï¼š
```java
@Service
public class UserService {
    
    public User getUserById(String userId) {
        // 1. å…ˆæŸ¥ç¼“å­˜
        String cacheKey = "user:" + userId;
        User user = cacheService.get(cacheKey);
        
        // 2. ç¼“å­˜æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬ç©ºå€¼æ ‡è®°ï¼‰
        if (user != null) {
            return "NULL".equals(user.getName()) ? null : user;
        }
        
        // 3. ç¼“å­˜æ²¡æœ‰ï¼ŒæŸ¥æ•°æ®åº“
        user = userDao.findById(userId);
        
        // 4. æ•°æ®åº“æœ‰æ•°æ®ï¼Œå­˜å…¥ç¼“å­˜
        if (user != null) {
            cacheService.set(cacheKey, user, 3600); // 1å°æ—¶
        } else {
            // 5. æ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œå­˜å…¥ç©ºå€¼æ ‡è®°
            User emptyUser = new User();
            emptyUser.setName("NULL"); // ç©ºå€¼æ ‡è®°
            cacheService.set(cacheKey, emptyUser, 300); // 5åˆ†é’ŸçŸ­æœŸç¼“å­˜
        }
        
        return user;
    }
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- ç©ºå€¼ç¼“å­˜æ—¶é—´è¦çŸ­ï¼ˆæ¯”å¦‚5åˆ†é’Ÿï¼‰ï¼Œé¿å…å½±å“æ­£å¸¸æ•°æ®
- è¦åŒºåˆ†çœŸæ­£çš„ç©ºå€¼å’Œ"ä¸å­˜åœ¨"çš„æ ‡è®°
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ç©ºå€¼ç¼“å­˜

---

## 3. ğŸ’¥ ç¼“å­˜å‡»ç©¿é—®é¢˜


### 3.1 ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒæ¼”å”±ä¼šé—¨ç¥¨ç³»ç»Ÿï¼Œå¹³æ—¶æ²¡ä»€ä¹ˆäººï¼Œä½†ä¸€åˆ°å¼€ç¥¨æ—¶é—´ï¼Œæ‰€æœ‰äººåŒæ—¶æ¶Œå…¥ï¼Œç³»ç»Ÿç¬é—´è¢«å‡»å®ã€‚

**æŠ€æœ¯ç°è±¡**ï¼š
- æŸä¸ª**çƒ­ç‚¹æ•°æ®**ï¼ˆå¦‚çƒ­é—¨å•†å“ä¿¡æ¯ï¼‰ç¼“å­˜è¿‡æœŸ
- **å¤§é‡å¹¶å‘è¯·æ±‚**åŒæ—¶è®¿é—®è¿™ä¸ªæ•°æ®  
- æ‰€æœ‰è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆç¬é—´å‹åŠ›

```
å‡»ç©¿è¿‡ç¨‹ç¤ºæ„ï¼š
æ—¶é—´è½´ï¼š  
10:00:00 â†’ ç¼“å­˜æ­£å¸¸ï¼Œ1ä¸‡QPS
10:00:01 â†’ çƒ­ç‚¹ç¼“å­˜è¿‡æœŸ
10:00:02 â†’ 1ä¸‡ä¸ªè¯·æ±‚åŒæ—¶æ‰“åˆ°æ•°æ®åº“ ğŸ’¥
```

### 3.2 äº’æ–¥é”æœºåˆ¶è§£å†³æ–¹æ¡ˆ


**ğŸ’¡ æ ¸å¿ƒæ€æƒ³**ï¼šå½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œåªè®©ä¸€ä¸ªè¯·æ±‚å»æŸ¥æ•°æ®åº“ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…ã€‚

**åˆ†å¸ƒå¼é”å®ç°**ï¼š

```java
@Service
public class ProductService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    public Product getProduct(String productId) {
        String cacheKey = "product:" + productId;
        String lockKey = "lock:product:" + productId;
        
        // 1. æŸ¥ç¼“å­˜
        Product product = cacheService.get(cacheKey);
        if (product != null) {
            return product;
        }
        
        // 2. ç¼“å­˜æ²¡æœ‰ï¼Œå°è¯•è·å–åˆ†å¸ƒå¼é”
        String lockValue = UUID.randomUUID().toString();
        Boolean isLocked = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, lockValue, Duration.ofSeconds(10));
        
        if (isLocked) {
            try {
                // 3. è·å–é”æˆåŠŸï¼Œå†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼ˆåŒé‡æ£€æŸ¥ï¼‰
                product = cacheService.get(cacheKey);
                if (product != null) {
                    return product;
                }
                
                // 4. æŸ¥è¯¢æ•°æ®åº“
                product = productDao.findById(productId);
                
                // 5. æ›´æ–°ç¼“å­˜
                if (product != null) {
                    cacheService.set(cacheKey, product, 3600);
                }
                
            } finally {
                // 6. é‡Šæ”¾é”ï¼ˆé˜²æ­¢æ­»é”ï¼‰
                releaseLock(lockKey, lockValue);
            }
        } else {
            // 7. è·å–é”å¤±è´¥ï¼Œç¨ç­‰ä¸€ä¸‹å†æŸ¥ç¼“å­˜
            Thread.sleep(50);
            return getProduct(productId); // é€’å½’æŸ¥è¯¢
        }
        
        return product;
    }
    
    private void releaseLock(String lockKey, String lockValue) {
        String script = "if redis.call('get', KEYS[1]) == ARGV[1] then " +
                       "return redis.call('del', KEYS[1]) else return 0 end";
        redisTemplate.execute(new DefaultRedisScript<>(script, Long.class), 
                            Arrays.asList(lockKey), lockValue);
    }
}
```

**æµç¨‹å›¾ç¤º**ï¼š
```
å¹¶å‘è¯·æ±‚å¤„ç†ï¼š
è¯·æ±‚1 â†’ è·å–é”æˆåŠŸ â†’ æŸ¥è¯¢æ•°æ®åº“ â†’ æ›´æ–°ç¼“å­˜ â†’ é‡Šæ”¾é”
è¯·æ±‚2 â†˜
è¯·æ±‚3 â†’ ç­‰å¾…é”é‡Šæ”¾ â†’ ç›´æ¥ä»ç¼“å­˜è·å–æ•°æ® âœ…  
è¯·æ±‚4 â†—
```

### 3.3 é¢„çƒ­æœºåˆ¶è®¾è®¡


**ğŸ’¡ åŸºæœ¬æ€æƒ³**ï¼šåœ¨ç¼“å­˜è¿‡æœŸå‰ï¼Œæå‰åˆ·æ–°ç¼“å­˜æ•°æ®ã€‚

```java
@Component
public class CacheWarmupService {
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void warmupHotData() {
        List<String> hotKeys = getHotDataKeys(); // è·å–çƒ­ç‚¹æ•°æ®key
        
        for (String key : hotKeys) {
            // æ£€æŸ¥ç¼“å­˜å‰©ä½™æ—¶é—´
            Long ttl = redisTemplate.getExpire(key);
            
            // å¦‚æœå‰©ä½™æ—¶é—´å°‘äº10åˆ†é’Ÿï¼Œæå‰åˆ·æ–°
            if (ttl != null && ttl < 600) {
                refreshCacheData(key);
            }
        }
    }
    
    private void refreshCacheData(String key) {
        // å¼‚æ­¥åˆ·æ–°ï¼Œä¸å½±å“æ­£å¸¸è¯·æ±‚
        CompletableFuture.runAsync(() -> {
            // ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜
            updateCacheFromDatabase(key);
        });
    }
}
```

---

## 4. â„ï¸ ç¼“å­˜é›ªå´©é—®é¢˜


### 4.1 ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒå†¬å¤©çš„é›ªå´©ï¼Œä¸æ˜¯ä¸€ç‰‡é›ªèŠ±çš„é—®é¢˜ï¼Œè€Œæ˜¯å¤§é‡é›ªèŠ±åŒæ—¶æ»‘è½ï¼Œé€ æˆå·¨å¤§çš„ç ´ååŠ›ã€‚

**æŠ€æœ¯ç°è±¡**ï¼š
- **å¤§é‡ç¼“å­˜æ•°æ®åŒæ—¶å¤±æ•ˆ**
- **æ‰€æœ‰è¯·æ±‚åŒæ—¶æ‰“åˆ°æ•°æ®åº“**
- **æ•°æ®åº“å‹åŠ›æ¿€å¢ï¼Œå¯èƒ½å´©æºƒ**

```
é›ªå´©åœºæ™¯ï¼š
è®¾ç½®ç¼“å­˜æ—¶ï¼šæ‰€æœ‰æ•°æ®éƒ½è®¾ç½®1å°æ—¶è¿‡æœŸ 
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚æ•°æ®1â”‚ â”‚æ•°æ®2â”‚ â”‚æ•°æ®3â”‚ â”‚æ•°æ®4â”‚ â†’ 10:00è®¾ç½®ï¼Œ11:00è¿‡æœŸ
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

11:00æ—¶ï¼šæ‰€æœ‰ç¼“å­˜åŒæ—¶å¤±æ•ˆ ğŸ’¥
æ‰€æœ‰æŸ¥è¯¢ â†’ æ•°æ®åº“å´©æºƒ
```

### 4.2 éšæœºè¿‡æœŸæ—¶é—´ç­–ç•¥


**ğŸ’¡ æ ¸å¿ƒæ€æƒ³**ï¼šç»™æ¯ä¸ªç¼“å­˜æ•°æ®è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…åŒæ—¶å¤±æ•ˆã€‚

```java
@Service
public class CacheService {
    
    public void setCacheWithRandomExpiry(String key, Object value, int baseSeconds) {
        // åŸºç¡€è¿‡æœŸæ—¶é—´ + éšæœºæ—¶é—´ï¼ˆ0-300ç§’ï¼‰
        int randomSeconds = new Random().nextInt(300);
        int finalExpiry = baseSeconds + randomSeconds;
        
        redisTemplate.opsForValue().set(key, value, Duration.ofSeconds(finalExpiry));
        
        log.info("è®¾ç½®ç¼“å­˜ï¼škey={}, è¿‡æœŸæ—¶é—´={}ç§’", key, finalExpiry);
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public void cacheUserData(String userId, User user) {
        String key = "user:" + userId;
        // åŸºç¡€1å°æ—¶ + éšæœº0-5åˆ†é’Ÿ
        setCacheWithRandomExpiry(key, user, 3600);
    }
}
```

**æ—¶é—´åˆ†æ•£æ•ˆæœ**ï¼š
```
ä¼˜åŒ–åçš„è¿‡æœŸæ—¶é—´åˆ†å¸ƒï¼š
æ•°æ®1ï¼š3650ç§’åè¿‡æœŸ  (1å°æ—¶50ç§’)
æ•°æ®2ï¼š3720ç§’åè¿‡æœŸ  (1å°æ—¶2åˆ†é’Ÿ) 
æ•°æ®3ï¼š3580ç§’åè¿‡æœŸ  (59åˆ†40ç§’)
æ•°æ®4ï¼š3680ç§’åè¿‡æœŸ  (1å°æ—¶1åˆ†20ç§’)

è¿‡æœŸæ—¶é—´åˆ†æ•£ â†’ å‹åŠ›åˆ†æ•£ âœ…
```

### 4.3 ç†”æ–­é™çº§å¤„ç†


**ğŸ’¡ åŸºæœ¬æ€æƒ³**ï¼šå½“æ•°æ®åº“å‹åŠ›è¿‡å¤§æ—¶ï¼Œä¸´æ—¶å…³é—­éƒ¨åˆ†åŠŸèƒ½ï¼Œä¿æŠ¤æ ¸å¿ƒç³»ç»Ÿã€‚

**ç†”æ–­å™¨å®ç°**ï¼š

```java
@Component
public class DatabaseCircuitBreaker {
    private volatile boolean circuitOpen = false;
    private AtomicInteger failureCount = new AtomicInteger(0);
    private long lastFailureTime = 0;
    
    public <T> T executeWithFallback(Supplier<T> primaryAction, Supplier<T> fallbackAction) {
        // 1. æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€
        if (circuitOpen) {
            long now = System.currentTimeMillis();
            // ç†”æ–­30ç§’åï¼Œå…è®¸å°è¯•ä¸€æ¬¡
            if (now - lastFailureTime > 30000) {
                circuitOpen = false;
                failureCount.set(0);
            } else {
                return fallbackAction.get(); // æ‰§è¡Œé™çº§é€»è¾‘
            }
        }
        
        try {
            // 2. æ‰§è¡Œä¸»è¦é€»è¾‘
            T result = primaryAction.get();
            failureCount.set(0); // æˆåŠŸæ—¶é‡ç½®è®¡æ•°
            return result;
        } catch (Exception e) {
            // 3. å¤±è´¥æ—¶å¢åŠ è®¡æ•°
            int failures = failureCount.incrementAndGet();
            lastFailureTime = System.currentTimeMillis();
            
            // 4. è¿ç»­å¤±è´¥5æ¬¡ï¼Œå¼€å¯ç†”æ–­
            if (failures >= 5) {
                circuitOpen = true;
                log.warn("æ•°æ®åº“ç†”æ–­å™¨å¼€å¯ï¼Œåˆ‡æ¢åˆ°é™çº§æ¨¡å¼");
            }
            
            // 5. æ‰§è¡Œé™çº§é€»è¾‘
            return fallbackAction.get();
        }
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Service
public class OrderService {
    
    @Autowired
    private DatabaseCircuitBreaker circuitBreaker;
    
    public Order getOrder(String orderId) {
        return circuitBreaker.executeWithFallback(
            // ä¸»è¦é€»è¾‘ï¼šæŸ¥è¯¢æ•°æ®åº“
            () -> orderDao.findById(orderId),
            // é™çº§é€»è¾‘ï¼šè¿”å›é»˜è®¤æ•°æ®
            () -> getDefaultOrder(orderId)
        );
    }
    
    private Order getDefaultOrder(String orderId) {
        Order defaultOrder = new Order();
        defaultOrder.setId(orderId);
        defaultOrder.setStatus("æŸ¥è¯¢ä¸­..."); // å‹å¥½æç¤º
        return defaultOrder;
    }
}
```

### 4.4 é™æµæ§åˆ¶æ–¹æ¡ˆ


**ğŸ’¡ æ ¸å¿ƒæ€æƒ³**ï¼šæ§åˆ¶è®¿é—®æ•°æ®åº“çš„è¯·æ±‚æ•°é‡ï¼Œé¿å…å‹å®æ•°æ®åº“ã€‚

**ä»¤ç‰Œæ¡¶é™æµ**ï¼š
```java
@Component
public class RateLimiter {
    // æ¯ç§’å…è®¸100ä¸ªè¯·æ±‚è®¿é—®æ•°æ®åº“
    private final RateLimiter dbRateLimiter = RateLimiter.create(100.0);
    
    public <T> T executeWithRateLimit(Supplier<T> action) {
        // å°è¯•è·å–ä»¤ç‰Œï¼ˆæœ€å¤šç­‰å¾…100æ¯«ç§’ï¼‰
        if (dbRateLimiter.tryAcquire(100, TimeUnit.MILLISECONDS)) {
            return action.get();
        } else {
            throw new ServiceException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
        }
    }
}
```

### 4.5 å…œåº•æ•°æ®å‡†å¤‡


**ğŸ’¡ åŸºæœ¬æ€æƒ³**ï¼šå‡†å¤‡ä¸€äº›é™æ€çš„å…œåº•æ•°æ®ï¼Œå½“ç¼“å­˜å’Œæ•°æ®åº“éƒ½ä¸å¯ç”¨æ—¶ä½¿ç”¨ã€‚

```java
@Component
public class FallbackDataService {
    
    // é¢„å…ˆå‡†å¤‡çš„å…œåº•æ•°æ®
    private final Map<String, Object> fallbackData = new ConcurrentHashMap<>();
    
    @PostConstruct
    public void initFallbackData() {
        // å‡†å¤‡ä¸€äº›é»˜è®¤æ•°æ®
        fallbackData.put("hot_products", getDefaultProducts());
        fallbackData.put("user_default", getDefaultUser());
    }
    
    public Object getFallbackData(String key) {
        return fallbackData.get(key);
    }
    
    private List<Product> getDefaultProducts() {
        // è¿”å›ä¸€äº›é»˜è®¤çš„çƒ­é—¨å•†å“
        Product product = new Product();
        product.setName("ç²¾é€‰å•†å“");
        product.setDescription("ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œç¨åæŸ¥çœ‹è¯¦æƒ…");
        return Arrays.asList(product);
    }
}
```

---

## 5. ğŸ› ï¸ ç»¼åˆè§£å†³æ–¹æ¡ˆ


### 5.1 å¤šå±‚é˜²æŠ¤ä½“ç³»


**æ¶æ„è®¾è®¡**ï¼š
```
å®Œæ•´é˜²æŠ¤ä½“ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¯·æ±‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.é™æµæ§åˆ¶   â”‚ â† æ§åˆ¶å¹¶å‘é‡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2.å¸ƒéš†è¿‡æ»¤å™¨  â”‚ â† è¿‡æ»¤æ— æ•ˆè¯·æ±‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3.ç¼“å­˜æŸ¥è¯¢   â”‚ â† ä¼˜å…ˆä½¿ç”¨ç¼“å­˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4.äº’æ–¥é”    â”‚ â† é˜²æ­¢ç¼“å­˜å‡»ç©¿
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5.æ•°æ®åº“æŸ¥è¯¢  â”‚ â† æœ€åæŸ¥è¯¢æ•°æ®åº“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6.ç†”æ–­é™çº§   â”‚ â† ä¿æŠ¤ç³»ç»Ÿç¨³å®š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç»Ÿä¸€æœåŠ¡å®ç°


```java
@Service
public class RobustCacheService {
    
    @Autowired
    private BloomFilterService bloomFilter;
    @Autowired 
    private DatabaseCircuitBreaker circuitBreaker;
    @Autowired
    private RateLimiter rateLimiter;
    @Autowired
    private FallbackDataService fallbackService;
    
    public <T> T getData(String key, Class<T> type, Function<String, T> dbQuery) {
        
        // ç¬¬1å±‚ï¼šå¸ƒéš†è¿‡æ»¤å™¨æ£€æŸ¥
        if (!bloomFilter.mightExist(key)) {
            return null; // æ•°æ®è‚¯å®šä¸å­˜åœ¨
        }
        
        // ç¬¬2å±‚ï¼šç¼“å­˜æŸ¥è¯¢
        T cachedData = cacheService.get(key, type);
        if (cachedData != null) {
            return cachedData;
        }
        
        // ç¬¬3å±‚ï¼šäº’æ–¥é”é˜²å‡»ç©¿
        String lockKey = "lock:" + key;
        return distributedLock.executeWithLock(lockKey, () -> {
            
            // åŒé‡æ£€æŸ¥
            T data = cacheService.get(key, type);
            if (data != null) {
                return data;
            }
            
            // ç¬¬4å±‚ï¼šé™æµ+ç†”æ–­æŸ¥è¯¢æ•°æ®åº“
            return rateLimiter.executeWithRateLimit(() -> 
                circuitBreaker.executeWithFallback(
                    () -> {
                        // æŸ¥è¯¢æ•°æ®åº“
                        T result = dbQuery.apply(key);
                        if (result != null) {
                            // éšæœºè¿‡æœŸæ—¶é—´ç¼“å­˜
                            setCacheWithRandomExpiry(key, result, 3600);
                        }
                        return result;
                    },
                    // é™çº§ï¼šä½¿ç”¨å…œåº•æ•°æ®
                    () -> (T) fallbackService.getFallbackData(key)
                )
            );
        });
    }
}
```

### 5.3 ç›‘æ§å‘Šè­¦æœºåˆ¶


**ç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š

ç¼“å­˜æŒ‡æ ‡ï¼š
- ç¼“å­˜å‘½ä¸­ç‡ > 90%
- ç¼“å­˜ç©¿é€æ¬¡æ•° < 100æ¬¡/åˆ†é’Ÿ
- ç¼“å­˜æ›´æ–°å»¶è¿Ÿ < 100ms

æ•°æ®åº“æŒ‡æ ‡ï¼š
- æ•°æ®åº“è¿æ¥æ•°ä½¿ç”¨ç‡ < 80%  
- æ…¢æŸ¥è¯¢æ•°é‡ < 10ä¸ª/åˆ†é’Ÿ
- æ•°æ®åº“å“åº”æ—¶é—´ < 200ms

ç³»ç»ŸæŒ‡æ ‡ï¼š
- ç†”æ–­å™¨å¼€å¯æ¬¡æ•°
- é™æµæ‹’ç»æ¬¡æ•°
- å…œåº•æ•°æ®ä½¿ç”¨æ¬¡æ•°
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 ä¸‰å¤§é—®é¢˜å¯¹æ¯”


| é—®é¢˜ç±»å‹ | **é—®é¢˜æè¿°** | **ä¸»è¦å½±å“** | **è§£å†³æ–¹æ¡ˆ** |
|---------|------------|------------|------------|
| ğŸ•³ï¸ **ç¼“å­˜ç©¿é€** | æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ® | æ•°æ®åº“å‹åŠ› | å¸ƒéš†è¿‡æ»¤å™¨ + ç©ºå€¼ç¼“å­˜ |
| ğŸ’¥ **ç¼“å­˜å‡»ç©¿** | çƒ­ç‚¹æ•°æ®å¤±æ•ˆ | ç¬é—´é«˜å¹¶å‘ | äº’æ–¥é” + é¢„çƒ­æœºåˆ¶ |
| â„ï¸ **ç¼“å­˜é›ªå´©** | å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆ | ç³»ç»Ÿæ€§é£é™© | éšæœºè¿‡æœŸ + ç†”æ–­é™çº§ |

### 6.2 è§£å†³æ–¹æ¡ˆæ±‡æ€»


**ğŸ›¡ï¸ é¢„é˜²ä¸ºä¸»**ï¼š
- **å¸ƒéš†è¿‡æ»¤å™¨**ï¼šæå‰è¿‡æ»¤æ— æ•ˆè¯·æ±‚
- **éšæœºè¿‡æœŸæ—¶é—´**ï¼šé¿å…åŒæ—¶å¤±æ•ˆ
- **é¢„çƒ­æœºåˆ¶**ï¼šæå‰åˆ·æ–°çƒ­ç‚¹æ•°æ®

**ğŸš¨ åº”æ€¥å¤„ç†**ï¼š
- **äº’æ–¥é”æœºåˆ¶**ï¼šé˜²æ­¢å¹¶å‘å†²å‡»
- **ç†”æ–­é™çº§**ï¼šä¿æŠ¤æ ¸å¿ƒç³»ç»Ÿ
- **é™æµæ§åˆ¶**ï¼šæ§åˆ¶è®¿é—®é‡

**ğŸ”„ å…œåº•ä¿éšœ**ï¼š
- **ç©ºå€¼ç¼“å­˜**ï¼šè®°å½•ä¸å­˜åœ¨çš„æŸ¥è¯¢
- **å…œåº•æ•°æ®**ï¼šæä¾›é»˜è®¤è¿”å›å€¼
- **ç›‘æ§å‘Šè­¦**ï¼šåŠæ—¶å‘ç°é—®é¢˜

### 6.3 æœ€ä½³å®è·µå»ºè®®


**è®¾è®¡åŸåˆ™**ï¼š
```
âœ… å¤šå±‚é˜²æŠ¤ï¼šä¸ä¾èµ–å•ä¸€è§£å†³æ–¹æ¡ˆ
âœ… å¿«é€Ÿå¤±è´¥ï¼šé—®é¢˜å‘ç”Ÿæ—¶å¿«é€Ÿå“åº”
âœ… ä¼˜é›…é™çº§ï¼šä¿è¯åŸºæœ¬åŠŸèƒ½å¯ç”¨
âœ… ç›‘æ§é¢„è­¦ï¼šæå‰å‘ç°æ½œåœ¨é—®é¢˜
```

**å®æ–½å»ºè®®**ï¼š
1. **åˆ†æä¸šåŠ¡åœºæ™¯**ï¼šæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚æ–¹æ¡ˆ
2. **åˆ†æ­¥éª¤å®æ–½**ï¼šå…ˆè§£å†³æœ€ä¸¥é‡çš„é—®é¢˜
3. **å‹åŠ›æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿æ–¹æ¡ˆæœ‰æ•ˆ
4. **æŒç»­ç›‘æ§ä¼˜åŒ–**ï¼šæ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´ç­–ç•¥

**âš ï¸ å¸¸è§è¯¯åŒº**ï¼š
- âŒ è¿‡åº¦è®¾è®¡ï¼šå°ç³»ç»Ÿä¸éœ€è¦æ‰€æœ‰æ–¹æ¡ˆ
- âŒ å¿½è§†ç›‘æ§ï¼šæ²¡æœ‰ç›‘æ§å°±æ˜¯ç›²ç›®é£è¡Œ
- âŒ ä¸€åŠ³æ°¸é€¸ï¼šéœ€è¦æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´
- âŒ åªè€ƒè™‘æŠ€æœ¯ï¼šè¦å¹³è¡¡æˆæœ¬å’Œæ”¶ç›Š

**ğŸ’¡ è®°å¿†å£è¯€**ï¼š
- ç©¿é€ç”¨è¿‡æ»¤ï¼Œå‡»ç©¿ç”¨é”å®š
- é›ªå´©è¦åˆ†æ•£ï¼Œé™çº§ä¿ç¨³å®š
- å¤šå±‚æ¥é˜²æŠ¤ï¼Œç›‘æ§ä¸èƒ½åœ

é€šè¿‡è¿™äº›ç»¼åˆæ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆåº”å¯¹å„ç§ç¼“å­˜å¤±æ•ˆé—®é¢˜ï¼Œä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨æ€§ã€‚å…³é”®æ˜¯è¦æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆç»„åˆã€‚