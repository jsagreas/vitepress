---
title: 7ã€Seataå®¢æˆ·ç«¯é›†æˆ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Seataå®¢æˆ·ç«¯é›†æˆ](#1-ä»€ä¹ˆæ˜¯Seataå®¢æˆ·ç«¯é›†æˆ)
2. [Spring Booté›†æˆSeata](#2-Spring-Booté›†æˆSeata)
3. [Spring Cloudé›†æˆè¯¦è§£](#3-Spring-Cloudé›†æˆè¯¦è§£)
4. [Spring Cloud Alibabaé›†æˆ](#4-Spring-Cloud-Alibabaé›†æˆ)
5. [Dubboæ¡†æ¶é›†æˆ](#5-Dubboæ¡†æ¶é›†æˆ)
6. [MyBatisæ•°æ®åº“é›†æˆ](#6-MyBatisæ•°æ®åº“é›†æˆ)
7. [æ•°æ®æºä»£ç†é…ç½®](#7-æ•°æ®æºä»£ç†é…ç½®)
8. [å…¨å±€äº‹åŠ¡æ³¨è§£ä½¿ç”¨](#8-å…¨å±€äº‹åŠ¡æ³¨è§£ä½¿ç”¨)
9. [åˆ†æ”¯äº‹åŠ¡ç®¡ç†](#9-åˆ†æ”¯äº‹åŠ¡ç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯Seataå®¢æˆ·ç«¯é›†æˆ


### 1.1 å®¢æˆ·ç«¯é›†æˆçš„æœ¬è´¨


**é€šä¿—ç†è§£**ï¼šå°±åƒå®‰è£…ä¸€ä¸ª"åˆ†å¸ƒå¼äº‹åŠ¡ç®¡å®¶"åˆ°ä½ çš„åº”ç”¨é‡Œ

```
ä¼ ç»Ÿå•ä½“åº”ç”¨ï¼š
åº”ç”¨ â†’ æ•°æ®åº“
(äº‹åŠ¡ç®€å•ï¼ŒæˆåŠŸå°±æˆåŠŸï¼Œå¤±è´¥å°±å›æ»š)

å¾®æœåŠ¡åº”ç”¨ï¼š
è®¢å•æœåŠ¡ â†’ è®¢å•æ•°æ®åº“
åº“å­˜æœåŠ¡ â†’ åº“å­˜æ•°æ®åº“  
æ”¯ä»˜æœåŠ¡ â†’ æ”¯ä»˜æ•°æ®åº“
(éœ€è¦åè°ƒå¤šä¸ªæœåŠ¡çš„äº‹åŠ¡)

Seataå®¢æˆ·ç«¯ä½œç”¨ï¼š
åœ¨æ¯ä¸ªæœåŠ¡é‡Œå®‰è£…"äº‹åŠ¡åè°ƒå‘˜"
è®©åˆ†æ•£çš„æœåŠ¡èƒ½å¤Ÿç»Ÿä¸€ç®¡ç†äº‹åŠ¡
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å®¢æˆ·ç«¯é›†æˆ


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- ğŸ”¸ **äº‹åŠ¡ä¼ æ’­**ï¼šè®©äº‹åŠ¡ä¿¡æ¯åœ¨ä¸åŒæœåŠ¡é—´ä¼ é€’
- ğŸ”¸ **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†æ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡çŠ¶æ€
- ğŸ”¸ **å¼‚å¸¸å¤„ç†**ï¼šå½“æŸä¸ªæœåŠ¡å‡ºé”™æ—¶ï¼Œé€šçŸ¥å…¶ä»–æœåŠ¡å›æ»š
- ğŸ”¸ **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ‰‹åŠ¨ç¼–ç ï¼Œæé«˜å¼€å‘æ•ˆç‡

### 1.3 é›†æˆæ¶æ„æ¦‚è§ˆ


```
Seataæ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Seata TC (äº‹åŠ¡åè°ƒå™¨)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ è®¢å•æœåŠ¡   â”‚ â”‚åº“å­˜æœåŠ¡â”‚ â”‚ æ”¯ä»˜æœåŠ¡   â”‚
â”‚ (TM+RM)   â”‚ â”‚(RM) â”‚ â”‚ (RM)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TM = äº‹åŠ¡ç®¡ç†å™¨ (å‘èµ·å…¨å±€äº‹åŠ¡)
RM = èµ„æºç®¡ç†å™¨ (ç®¡ç†æœ¬åœ°èµ„æº)
TC = äº‹åŠ¡åè°ƒå™¨ (åè°ƒå…¨å±€äº‹åŠ¡)
```

---

## 2. ğŸš€ Spring Booté›†æˆSeata


### 2.1 åŸºç¡€ä¾èµ–é…ç½®


**ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**

```xml
<!-- æ ¸å¿ƒä¾èµ–ï¼šå°±åƒç»™Spring Bootè£…ä¸Šäº‹åŠ¡ç®¡ç†æ’ä»¶ -->
<dependency>
    <groupId>io.seata</groupId>
    <artifactId>seata-spring-boot-starter</artifactId>
    <version>1.6.1</version>
</dependency>

<!-- æ•°æ®åº“é©±åŠ¨ -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>
```

**ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶**

```yaml
# application.yml - åƒç»™åº”ç”¨å†™"èº«ä»½è¯"
seata:
  # åº”ç”¨åç§° - åœ¨Seataä¸­çš„èº«ä»½æ ‡è¯†
  application-id: order-service
  # äº‹åŠ¡åˆ†ç»„ - ç›¸å½“äº"éƒ¨é—¨åˆ†ç»„"
  tx-service-group: order-service-group
  
  # æ³¨å†Œä¸­å¿ƒé…ç½® - å‘Šè¯‰åº”ç”¨å»å“ªæ‰¾SeataæœåŠ¡å™¨
  registry:
    type: nacos  # ä½¿ç”¨Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒ
    nacos:
      application: seata-server
      server-addr: localhost:8848
      
  # é…ç½®ä¸­å¿ƒ - é›†ä¸­ç®¡ç†é…ç½®ä¿¡æ¯
  config:
    type: nacos
    nacos:
      server-addr: localhost:8848
```

### 2.2 æ•°æ®æºé…ç½®


**å…³é”®ç†è§£**ï¼šSeataéœ€è¦"æ¥ç®¡"ä½ çš„æ•°æ®åº“è¿æ¥

```java
@Configuration
public class DataSourceConfig {
    
    /**
     * åŸå§‹æ•°æ®æº - å°±æ˜¯æ™®é€šçš„æ•°æ®åº“è¿æ¥æ± 
     */
    @Bean
    @ConfigurationProperties(prefix = "spring.datasource")
    public DataSource dataSource() {
        return new HikariDataSource();
    }
    
    /**
     * Seataä»£ç†æ•°æ®æº - ç»™æ•°æ®æº"è£…ä¸Šç›‘æ§å™¨"
     * è¿™æ ·Seataå°±èƒ½çŸ¥é“ä»€ä¹ˆæ—¶å€™æäº¤æˆ–å›æ»šäº‹åŠ¡
     */
    @Bean
    public DataSourceProxy dataSourceProxy(DataSource dataSource) {
        return new DataSourceProxy(dataSource);
    }
    
    /**
     * SqlSessionFactoryéœ€è¦ä½¿ç”¨è¢«ä»£ç†çš„æ•°æ®æº
     */
    @Bean
    public SqlSessionFactory sqlSessionFactory(DataSourceProxy dataSourceProxy) throws Exception {
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dataSourceProxy);
        return bean.getObject();
    }
}
```

---

## 3. â˜ï¸ Spring Cloudé›†æˆè¯¦è§£


### 3.1 å¾®æœåŠ¡ç¯å¢ƒä¸‹çš„æŒ‘æˆ˜


**ä¸ºä»€ä¹ˆSpring Cloudéœ€è¦ç‰¹åˆ«é…ç½®**ï¼š

```
æ™®é€šSpring Bootï¼š
å•ä¸ªåº”ç”¨ â†’ å•ä¸ªæ•°æ®åº“ â†’ ç®€å•äº‹åŠ¡

Spring Cloudå¾®æœåŠ¡ï¼š
ç”¨æˆ·æœåŠ¡ â†â†’ ç½‘å…³ â†â†’ è®¢å•æœåŠ¡
    â†“                    â†“
ç”¨æˆ·æ•°æ®åº“              è®¢å•æ•°æ®åº“
    â†“                    â†“  
éœ€è¦åœ¨HTTPè°ƒç”¨é—´ä¼ é€’äº‹åŠ¡ä¿¡æ¯
```

### 3.2 ä¾èµ–é…ç½®


```xml
<!-- Spring Cloudä¸“ç”¨çš„Seataä¾èµ– -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-seata</artifactId>
    <version>2021.0.4.0</version>
</dependency>

<!-- æœåŠ¡æ³¨å†Œå‘ç° -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>

<!-- è¿œç¨‹è°ƒç”¨ -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

### 3.3 Feignè°ƒç”¨é…ç½®


**æ ¸å¿ƒé—®é¢˜**ï¼šå¦‚ä½•åœ¨æœåŠ¡é—´è°ƒç”¨æ—¶ä¼ é€’äº‹åŠ¡ä¿¡æ¯

```java
/**
 * è®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡çš„æ¥å£
 * @FeignClient æ³¨è§£è®©è¿™ä¸ªæ¥å£å˜æˆè¿œç¨‹è°ƒç”¨
 */
@FeignClient(name = "inventory-service")
public interface InventoryFeignClient {
    
    /**
     * å‡åº“å­˜æ“ä½œ - è¿™ä¸ªè°ƒç”¨ä¼šè‡ªåŠ¨æºå¸¦äº‹åŠ¡ä¿¡æ¯
     */
    @PostMapping("/inventory/reduce")
    Result reduceInventory(@RequestParam("productId") Long productId,
                          @RequestParam("quantity") Integer quantity);
}

/**
 * ä¸šåŠ¡æœåŠ¡å®ç°
 */
@Service
public class OrderService {
    
    @Autowired
    private InventoryFeignClient inventoryClient;
    
    /**
     * ä¸‹å•æ“ä½œ - å…¨å±€äº‹åŠ¡çš„å‘èµ·ç‚¹
     */
    @GlobalTransactional(rollbackFor = Exception.class)
    public void createOrder(OrderRequest request) {
        // 1. åˆ›å»ºè®¢å• (æœ¬åœ°äº‹åŠ¡)
        saveOrder(request);
        
        // 2. è°ƒç”¨åº“å­˜æœåŠ¡å‡åº“å­˜ (è¿œç¨‹äº‹åŠ¡)
        inventoryClient.reduceInventory(request.getProductId(), request.getQuantity());
        
        // å¦‚æœè¿™é‡Œå‡ºç°å¼‚å¸¸ï¼Œè®¢å•å’Œåº“å­˜éƒ½ä¼šå›æ»š
    }
}
```

---

## 4. ğŸ”§ Spring Cloud Alibabaé›†æˆ


### 4.1 ä¸ºä»€ä¹ˆé€‰æ‹©Alibabaç‰ˆæœ¬


**ä¼˜åŠ¿å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | **åŸç”ŸSpring Cloud** | **Spring Cloud Alibaba** |
|-----|---------------------|--------------------------|
| ğŸ”§ **é…ç½®å¤æ‚åº¦** | `éœ€è¦å¤§é‡æ‰‹åŠ¨é…ç½®` | `å¼€ç®±å³ç”¨ï¼Œè‡ªåŠ¨é…ç½®` |
| ğŸ“š **æ–‡æ¡£æ”¯æŒ** | `è‹±æ–‡æ–‡æ¡£ä¸ºä¸»` | `ä¸­æ–‡æ–‡æ¡£ä¸°å¯Œï¼Œæ¡ˆä¾‹å¤š` |
| ğŸš€ **é›†æˆç¨‹åº¦** | `éœ€è¦å•ç‹¬é…ç½®å„ç»„ä»¶` | `ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ` |
| ğŸ› ï¸ **ç»´æŠ¤æˆæœ¬** | `ç»„ä»¶ç‰ˆæœ¬éœ€è¦æ‰‹åŠ¨åŒ¹é…` | `ç‰ˆæœ¬å…¼å®¹æ€§æœ‰ä¿éšœ` |

### 4.2 å®Œæ•´é…ç½®ç¤ºä¾‹


```yaml
# application.yml - Spring Cloud Alibabaé…ç½®
spring:
  application:
    name: order-service
  cloud:
    nacos:
      # æœåŠ¡æ³¨å†Œå‘ç°
      discovery:
        server-addr: localhost:8848
      # é…ç½®ç®¡ç†
      config:
        server-addr: localhost:8848
        file-extension: yaml
        
    # Seataé…ç½®
    alibaba:
      seata:
        tx-service-group: order-service-group

# Seataè¯¦ç»†é…ç½®
seata:
  service:
    # äº‹åŠ¡åˆ†ç»„æ˜ å°„ - å‘Šè¯‰åº”ç”¨å»å“ªä¸ªSeataé›†ç¾¤
    vgroup-mapping:
      order-service-group: default
  registry:
    type: nacos
    nacos:
      application: seata-server
      server-addr: localhost:8848
```

### 4.3 è‡ªåŠ¨é…ç½®è¯´æ˜


**Alibabaç‰ˆæœ¬çš„"æ™ºèƒ½"ä¹‹å¤„**ï¼š

```java
// ä½ åªéœ€è¦å†™ä¸šåŠ¡ä»£ç ï¼Œå…¶ä»–çš„æ¡†æ¶è‡ªåŠ¨å¸®ä½ é…ç½®å¥½äº†
@RestController
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    /**
     * ä¸‹å•æ¥å£ - æ¡†æ¶è‡ªåŠ¨å¤„ç†äº‹åŠ¡ä¼ æ’­
     */
    @PostMapping("/order")
    public Result createOrder(@RequestBody OrderRequest request) {
        // æ¡†æ¶ä¼šè‡ªåŠ¨ï¼š
        // 1. åˆ›å»ºå…¨å±€äº‹åŠ¡ID
        // 2. åœ¨è°ƒç”¨é“¾ä¸­ä¼ é€’äº‹åŠ¡ä¿¡æ¯
        // 3. å¤„ç†å¼‚å¸¸æ—¶è‡ªåŠ¨å›æ»š
        orderService.createOrder(request);
        return Result.success();
    }
}
```

---

## 5. ğŸŒ Dubboæ¡†æ¶é›†æˆ


### 5.1 Dubboä¸Spring Cloudçš„åŒºåˆ«


**é€šä¿—å¯¹æ¯”**ï¼š

```
Spring Cloudå°±åƒ"å†™ä¿¡"ï¼š
æœåŠ¡A â†’ HTTPè¯·æ±‚ â†’ æœåŠ¡B
(åŸºäºHTTPï¼Œå®¹æ˜“ç†è§£ï¼Œä½†æ€§èƒ½ä¸€èˆ¬)

Dubboå°±åƒ"æ‰“ç”µè¯"ï¼š
æœåŠ¡A â†’ RPCè°ƒç”¨ â†’ æœåŠ¡B  
(åŸºäºTCPï¼Œæ€§èƒ½æ›´å¥½ï¼Œä½†é…ç½®å¤æ‚ä¸€äº›)
```

### 5.2 Dubboé›†æˆé…ç½®


```xml
<!-- Dubbo + Seataä¾èµ– -->
<dependency>
    <groupId>io.seata</groupId>
    <artifactId>seata-dubbo</artifactId>
    <version>1.6.1</version>
</dependency>

<dependency>
    <groupId>org.apache.dubbo</groupId>
    <artifactId>dubbo-spring-boot-starter</artifactId>
    <version>3.1.0</version>
</dependency>
```

### 5.3 DubboæœåŠ¡å®šä¹‰


```java
/**
 * åº“å­˜æœåŠ¡æ¥å£å®šä¹‰
 */
public interface InventoryService {
    /**
     * å‡åº“å­˜æ–¹æ³•
     */
    boolean reduceInventory(Long productId, Integer quantity);
}

/**
 * åº“å­˜æœåŠ¡å®ç° - ä½œä¸ºDubboæœåŠ¡æä¾›è€…
 */
@DubboService  // è¿™ä¸ªæ³¨è§£è®©æœåŠ¡å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨
public class InventoryServiceImpl implements InventoryService {
    
    @Autowired
    private InventoryMapper inventoryMapper;
    
    /**
     * å‡åº“å­˜å®ç° - è‡ªåŠ¨å‚ä¸åˆ†å¸ƒå¼äº‹åŠ¡
     */
    @Override
    public boolean reduceInventory(Long productId, Integer quantity) {
        // ä¸šåŠ¡é€»è¾‘ï¼šæ£€æŸ¥åº“å­˜å¹¶å‡å°‘
        Inventory inventory = inventoryMapper.getByProductId(productId);
        if (inventory.getQuantity() >= quantity) {
            inventory.setQuantity(inventory.getQuantity() - quantity);
            inventoryMapper.update(inventory);
            return true;
        }
        throw new RuntimeException("åº“å­˜ä¸è¶³");
    }
}

/**
 * è®¢å•æœåŠ¡ - ä½œä¸ºDubboæœåŠ¡æ¶ˆè´¹è€…
 */
@Service
public class OrderService {
    
    @DubboReference  // è¿œç¨‹æœåŠ¡å¼•ç”¨
    private InventoryService inventoryService;
    
    /**
     * åˆ›å»ºè®¢å• - å…¨å±€äº‹åŠ¡å‘èµ·ç‚¹
     */
    @GlobalTransactional(rollbackFor = Exception.class)
    public void createOrder(OrderRequest request) {
        // 1. ä¿å­˜è®¢å•
        saveOrder(request);
        
        // 2. è°ƒç”¨åº“å­˜æœåŠ¡ (é€šè¿‡Dubbo RPC)
        boolean success = inventoryService.reduceInventory(
            request.getProductId(), 
            request.getQuantity()
        );
        
        if (!success) {
            throw new RuntimeException("åº“å­˜æ‰£å‡å¤±è´¥");
        }
    }
}
```

---

## 6. ğŸ—„ï¸ MyBatisæ•°æ®åº“é›†æˆ


### 6.1 ä¸ºä»€ä¹ˆMyBatiséœ€è¦ç‰¹æ®Šå¤„ç†


**æ ¸å¿ƒé—®é¢˜**ï¼šè®©MyBatis"çŸ¥é“"å½“å‰åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­

```
æ™®é€šæƒ…å†µï¼š
MyBatis â†’ æ•°æ®åº“è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ æäº¤äº‹åŠ¡

Seataç¯å¢ƒï¼š
MyBatis â†’ Seataä»£ç†è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ ç­‰å¾…å…¨å±€äº‹åŠ¡å†³å®š
                â†“
            è®°å½•undo_log (å›æ»šæ—¥å¿—)
```

### 6.2 MyBatisé…ç½®


```java
@Configuration
@MapperScan("com.example.mapper")  // æ‰«æMapperæ¥å£
public class MyBatisConfig {
    
    /**
     * é…ç½®SqlSessionFactoryä½¿ç”¨Seataä»£ç†æ•°æ®æº
     */
    @Bean
    public SqlSessionFactory sqlSessionFactory(DataSourceProxy dataSourceProxy) throws Exception {
        SqlSessionFactoryBean factory = new SqlSessionFactoryBean();
        
        // å…³é”®ï¼šä½¿ç”¨Seataä»£ç†çš„æ•°æ®æº
        factory.setDataSource(dataSourceProxy);
        
        // MyBatisé…ç½®
        org.apache.ibatis.session.Configuration config = new org.apache.ibatis.session.Configuration();
        config.setMapUnderscoreToCamelCase(true);  // ä¸‹åˆ’çº¿è½¬é©¼å³°
        config.setLogImpl(StdOutImpl.class);       // SQLæ—¥å¿—
        factory.setConfiguration(config);
        
        return factory.getObject();
    }
    
    /**
     * äº‹åŠ¡ç®¡ç†å™¨
     */
    @Bean
    public DataSourceTransactionManager transactionManager(DataSourceProxy dataSourceProxy) {
        return new DataSourceTransactionManager(dataSourceProxy);
    }
}
```

### 6.3 Mapperæ¥å£ç¤ºä¾‹


```java
/**
 * è®¢å•æ•°æ®è®¿é—®æ¥å£
 */
@Mapper
public interface OrderMapper {
    
    /**
     * åˆ›å»ºè®¢å• - ä¼šè‡ªåŠ¨è®°å½•undo_log
     */
    @Insert("INSERT INTO orders(user_id, product_id, quantity, amount, status) " +
            "VALUES(#{userId}, #{productId}, #{quantity}, #{amount}, #{status})")
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int insertOrder(Order order);
    
    /**
     * æ›´æ–°è®¢å•çŠ¶æ€
     */
    @Update("UPDATE orders SET status = #{status} WHERE id = #{id}")
    int updateOrderStatus(@Param("id") Long id, @Param("status") String status);
    
    /**
     * æŸ¥è¯¢è®¢å•
     */
    @Select("SELECT * FROM orders WHERE id = #{id}")
    Order getById(@Param("id") Long id);
}

/**
 * ä¸šåŠ¡æœåŠ¡ä½¿ç”¨Mapper
 */
@Service
public class OrderService {
    
    @Autowired
    private OrderMapper orderMapper;
    
    /**
     * åˆ›å»ºè®¢å•æ–¹æ³•
     */
    @Transactional  // æœ¬åœ°äº‹åŠ¡æ³¨è§£
    public void createOrder(Order order) {
        // MyBatisä¼šè‡ªåŠ¨ä½¿ç”¨Seataä»£ç†çš„è¿æ¥
        // æ‰§è¡Œæ—¶ä¼šè®°å½•undo_logï¼Œä»¥å¤‡å›æ»šæ—¶ä½¿ç”¨
        int result = orderMapper.insertOrder(order);
        
        if (result <= 0) {
            throw new RuntimeException("è®¢å•åˆ›å»ºå¤±è´¥");
        }
        
        // å¦‚æœå…¨å±€äº‹åŠ¡éœ€è¦å›æ»šï¼ŒSeataä¼šï¼š
        // 1. è¯»å–undo_log
        // 2. æ‰§è¡Œåå‘æ“ä½œ (DELETE)
        // 3. æ¢å¤æ•°æ®åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€
    }
}
```

---

## 7. ğŸ”— æ•°æ®æºä»£ç†é…ç½®


### 7.1 æ•°æ®æºä»£ç†çš„ä½œç”¨


**é€šä¿—è§£é‡Š**ï¼šç»™ä½ çš„æ•°æ®åº“è¿æ¥è£…ä¸€ä¸ª"ç›‘å¬å™¨"

```
æ²¡æœ‰ä»£ç†çš„æƒ…å†µï¼š
åº”ç”¨ â†’ æ•°æ®åº“
(Seataä¸çŸ¥é“ä½ åšäº†ä»€ä¹ˆæ“ä½œ)

æœ‰ä»£ç†çš„æƒ…å†µï¼š
åº”ç”¨ â†’ Seataä»£ç† â†’ æ•°æ®åº“
        â†“
    è®°å½•æ“ä½œæ—¥å¿—
    ç®¡ç†äº‹åŠ¡çŠ¶æ€
```

### 7.2 æ‰‹åŠ¨é…ç½®æ•°æ®æºä»£ç†


```java
@Configuration
public class DataSourceProxyConfig {
    
    /**
     * åŸå§‹æ•°æ®æºé…ç½®
     */
    @Bean
    @ConfigurationProperties("spring.datasource")
    public DruidDataSource druidDataSource() {
        DruidDataSource dataSource = new DruidDataSource();
        return dataSource;
    }
    
    /**
     * Seataæ•°æ®æºä»£ç† - æ ¸å¿ƒé…ç½®
     */
    @Primary  // ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªæ•°æ®æº
    @Bean("dataSource")
    public DataSourceProxy dataSourceProxy(DruidDataSource druidDataSource) {
        // åˆ›å»ºä»£ç†å¯¹è±¡ï¼ŒåŒ…è£…åŸå§‹æ•°æ®æº
        return new DataSourceProxy(druidDataSource);
    }
    
    /**
     * äº‹åŠ¡ç®¡ç†å™¨é…ç½®
     */
    @Bean
    public DataSourceTransactionManager transactionManager(DataSourceProxy dataSourceProxy) {
        return new DataSourceTransactionManager(dataSourceProxy);
    }
}
```

### 7.3 è‡ªåŠ¨é…ç½®æ–¹å¼


```yaml
# ä½¿ç”¨Seataè‡ªåŠ¨é…ç½®
seata:
  data-source-proxy-mode: AT  # ATæ¨¡å¼è‡ªåŠ¨ä»£ç†
  
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/seata_order?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
```

### 7.4 å¤šæ•°æ®æºé…ç½®


```java
@Configuration
public class MultiDataSourceConfig {
    
    /**
     * è®¢å•æ•°æ®åº“
     */
    @Bean
    @ConfigurationProperties("spring.datasource.order")
    public DataSource orderDataSource() {
        return new HikariDataSource();
    }
    
    /**
     * åº“å­˜æ•°æ®åº“
     */
    @Bean  
    @ConfigurationProperties("spring.datasource.inventory")
    public DataSource inventoryDataSource() {
        return new HikariDataSource();
    }
    
    /**
     * è®¢å•æ•°æ®æºä»£ç†
     */
    @Bean
    public DataSourceProxy orderDataSourceProxy(
        @Qualifier("orderDataSource") DataSource orderDataSource) {
        return new DataSourceProxy(orderDataSource);
    }
    
    /**
     * åº“å­˜æ•°æ®æºä»£ç†  
     */
    @Bean
    public DataSourceProxy inventoryDataSourceProxy(
        @Qualifier("inventoryDataSource") DataSource inventoryDataSource) {
        return new DataSourceProxy(inventoryDataSource);
    }
}
```

---

## 8. ğŸ“ å…¨å±€äº‹åŠ¡æ³¨è§£ä½¿ç”¨


### 8.1 @GlobalTransactionalæ³¨è§£è¯¦è§£


**æ ¸å¿ƒä½œç”¨**ï¼šå‘Šè¯‰Seata"è¿™é‡Œæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„èµ·ç‚¹"

```java
/**
 * å…¨å±€äº‹åŠ¡æ³¨è§£çš„å®Œæ•´ç”¨æ³•
 */
@Service
public class BusinessService {
    
    /**
     * åŸºç¡€ç”¨æ³• - æœ€ç®€å•çš„å…¨å±€äº‹åŠ¡
     */
    @GlobalTransactional
    public void simpleGlobalTransaction() {
        // è¿™ä¸ªæ–¹æ³•å†…çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½ä¼šå‚ä¸å…¨å±€äº‹åŠ¡
        // åŒ…æ‹¬è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ“ä½œ
    }
    
    /**
     * å®Œæ•´é…ç½® - æ›´ç²¾ç¡®çš„æ§åˆ¶
     */
    @GlobalTransactional(
        name = "createOrderTransaction",           // äº‹åŠ¡åç§°ï¼Œä¾¿äºç›‘æ§
        rollbackFor = Exception.class,            // ä»€ä¹ˆå¼‚å¸¸æ—¶å›æ»š
        noRollbackFor = RuntimeException.class,   // ä»€ä¹ˆå¼‚å¸¸æ—¶ä¸å›æ»š  
        timeoutMills = 30000                      // äº‹åŠ¡è¶…æ—¶æ—¶é—´(30ç§’)
    )
    public void createOrderWithSettings(OrderRequest request) {
        // 1. åˆ›å»ºè®¢å•
        createOrder(request);
        
        // 2. æ‰£å‡åº“å­˜ (å¯èƒ½è°ƒç”¨å…¶ä»–æœåŠ¡)
        reduceInventory(request.getProductId(), request.getQuantity());
        
        // 3. æ‰£å‡ä½™é¢ (å¯èƒ½è°ƒç”¨å…¶ä»–æœåŠ¡)  
        deductBalance(request.getUserId(), request.getAmount());
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å‡ºç°å¼‚å¸¸ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šå›æ»š
    }
}
```

### 8.2 äº‹åŠ¡ä¼ æ’­æœºåˆ¶


**é‡è¦ç†è§£**ï¼šäº‹åŠ¡å¦‚ä½•åœ¨æ–¹æ³•è°ƒç”¨é—´ä¼ é€’

```java
@Service
public class OrderService {
    
    @Autowired
    private InventoryService inventoryService;
    
    @Autowired
    private PaymentService paymentService;
    
    /**
     * å…¨å±€äº‹åŠ¡å‘èµ·ç‚¹ - TM (äº‹åŠ¡ç®¡ç†å™¨)
     */
    @GlobalTransactional(rollbackFor = Exception.class)
    public void createOrder(OrderRequest request) {
        
        // æœ¬åœ°äº‹åŠ¡æ“ä½œ
        this.saveOrderToDb(request);
        
        // è¿œç¨‹æœåŠ¡è°ƒç”¨ - è‡ªåŠ¨åŠ å…¥å…¨å±€äº‹åŠ¡
        inventoryService.reduceStock(request.getProductId(), request.getQuantity());
        
        // å¦ä¸€ä¸ªè¿œç¨‹æœåŠ¡è°ƒç”¨ - ä¹Ÿè‡ªåŠ¨åŠ å…¥å…¨å±€äº‹åŠ¡
        paymentService.deductBalance(request.getUserId(), request.getAmount());
        
        // æ¨¡æ‹Ÿä¸šåŠ¡å¼‚å¸¸
        if (request.getAmount() > 1000) {
            throw new RuntimeException("é‡‘é¢è¿‡å¤§ï¼Œæ‹’ç»ä¸‹å•");
            // è¿™é‡Œå¼‚å¸¸ä¼šå¯¼è‡´ï¼š
            // 1. è®¢å•æ•°æ®å›æ»š
            // 2. åº“å­˜å›æ»š 
            // 3. ä½™é¢å›æ»š
        }
    }
    
    /**
     * æœ¬åœ°äº‹åŠ¡æ–¹æ³• - RM (èµ„æºç®¡ç†å™¨)
     */
    @Transactional  // æ™®é€šçš„Springäº‹åŠ¡æ³¨è§£
    public void saveOrderToDb(OrderRequest request) {
        // è¿™ä¸ªæ–¹æ³•çš„æ•°æ®åº“æ“ä½œä¼šè‡ªåŠ¨å‚ä¸å…¨å±€äº‹åŠ¡
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        order.setAmount(request.getAmount());
        
        orderMapper.insert(order);
    }
}
```

### 8.3 æ³¨è§£ä½¿ç”¨æœ€ä½³å®è·µ


**æ¨èåšæ³•**ï¼š

```java
/**
 * âœ… æ¨èï¼šåœ¨ä¸šåŠ¡å…¥å£æ–¹æ³•ä½¿ç”¨
 */
@RestController
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    @PostMapping("/order")
    @GlobalTransactional(rollbackFor = Exception.class)  // åœ¨Controllerå±‚å¼€å¯å…¨å±€äº‹åŠ¡
    public Result createOrder(@RequestBody OrderRequest request) {
        try {
            orderService.processOrder(request);
            return Result.success("ä¸‹å•æˆåŠŸ");
        } catch (Exception e) {
            log.error("ä¸‹å•å¤±è´¥", e);
            return Result.error("ä¸‹å•å¤±è´¥: " + e.getMessage());
        }
    }
}

/**
 * âŒ ä¸æ¨èï¼šåœ¨å†…éƒ¨æ–¹æ³•é‡å¤ä½¿ç”¨
 */  
@Service
public class OrderService {
    
    // âŒ ä¸è¦è¿™æ ·åš
    @GlobalTransactional  // å¤–å±‚å·²ç»æœ‰äº†ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤
    public void processOrder(OrderRequest request) {
        this.createOrder(request);
        this.updateInventory(request);
    }
}
```

---

## 9. ğŸ”„ åˆ†æ”¯äº‹åŠ¡ç®¡ç†


### 9.1 ä»€ä¹ˆæ˜¯åˆ†æ”¯äº‹åŠ¡


**é€šä¿—ç†è§£**ï¼šå…¨å±€äº‹åŠ¡ä¸‹çš„æ¯ä¸ª"å°äº‹åŠ¡"

```
å…¨å±€äº‹åŠ¡ï¼šä¸‹å•æµç¨‹ (æ€»æŒ‡æŒ¥)
â”œâ”€â”€ åˆ†æ”¯äº‹åŠ¡1ï¼šåˆ›å»ºè®¢å• (å£«å…µA)
â”œâ”€â”€ åˆ†æ”¯äº‹åŠ¡2ï¼šæ‰£å‡åº“å­˜ (å£«å…µB)  
â””â”€â”€ åˆ†æ”¯äº‹åŠ¡3ï¼šæ‰£å‡ä½™é¢ (å£«å…µC)

å¦‚æœæ€»æŒ‡æŒ¥è¯´"æ’¤é€€"(å›æ»š)ï¼š
æ‰€æœ‰å£«å…µéƒ½è¦å›åˆ°åŸæ¥çš„ä½ç½®
```

### 9.2 åˆ†æ”¯äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ


```java
/**
 * åˆ†æ”¯äº‹åŠ¡ç®¡ç†ç¤ºä¾‹
 */
@Service
public class InventoryService {
    
    @Autowired
    private InventoryMapper inventoryMapper;
    
    /**
     * åˆ†æ”¯äº‹åŠ¡æ–¹æ³• - è‡ªåŠ¨å‚ä¸å…¨å±€äº‹åŠ¡
     */
    @Transactional  // æœ¬åœ°äº‹åŠ¡æ³¨è§£
    public void reduceInventory(Long productId, Integer quantity) {
        
        // Phase 1: ä¸€é˜¶æ®µ - æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        log.info("å¼€å§‹æ‰£å‡åº“å­˜ï¼Œå•†å“IDï¼š{}ï¼Œæ•°é‡ï¼š{}", productId, quantity);
        
        // 1. æŸ¥è¯¢å½“å‰åº“å­˜
        Inventory inventory = inventoryMapper.selectByProductId(productId);
        if (inventory == null) {
            throw new RuntimeException("å•†å“ä¸å­˜åœ¨");
        }
        
        // 2. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
        if (inventory.getQuantity() < quantity) {
            throw new RuntimeException("åº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜ï¼š" + inventory.getQuantity());
        }
        
        // 3. æ‰£å‡åº“å­˜ (æ­¤æ—¶Seataä¼šè®°å½•undo_log)
        inventory.setQuantity(inventory.getQuantity() - quantity);
        int result = inventoryMapper.updateById(inventory);
        
        if (result <= 0) {
            throw new RuntimeException("åº“å­˜æ‰£å‡å¤±è´¥");
        }
        
        log.info("åº“å­˜æ‰£å‡æˆåŠŸï¼Œå‰©ä½™åº“å­˜ï¼š{}", inventory.getQuantity());
        
        // Phase 2: äºŒé˜¶æ®µ - Seataè‡ªåŠ¨å¤„ç†
        // å¦‚æœå…¨å±€äº‹åŠ¡æäº¤ï¼šåˆ é™¤undo_log
        // å¦‚æœå…¨å±€äº‹åŠ¡å›æ»šï¼šæ‰§è¡Œundo_logä¸­çš„åå‘SQL
    }
    
    /**
     * æ‰‹åŠ¨ç®¡ç†åˆ†æ”¯äº‹åŠ¡èµ„æº (é«˜çº§ç”¨æ³•)
     */
    public void manualBranchTransaction() {
        // è·å–å½“å‰åˆ†æ”¯äº‹åŠ¡ID
        String branchId = RootContext.getBranchId();
        
        // è·å–å…¨å±€äº‹åŠ¡ID  
        String xid = RootContext.getXID();
        
        log.info("å½“å‰å…¨å±€äº‹åŠ¡IDï¼š{}ï¼Œåˆ†æ”¯äº‹åŠ¡IDï¼š{}", xid, branchId);
        
        // å¯ä»¥æ ¹æ®äº‹åŠ¡çŠ¶æ€åšç‰¹æ®Šå¤„ç†
        if (StringUtils.isNotEmpty(xid)) {
            // åœ¨å…¨å±€äº‹åŠ¡ä¸­
            log.info("å½“å‰å¤„äºå…¨å±€äº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œäº‹åŠ¡é€»è¾‘");
        } else {
            // ä¸åœ¨å…¨å±€äº‹åŠ¡ä¸­
            log.info("å½“å‰ä¸åœ¨å…¨å±€äº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œæ™®é€šé€»è¾‘");
        }
    }
}
```

### 9.3 åˆ†æ”¯äº‹åŠ¡ç›‘å¬å™¨


```java
/**
 * åˆ†æ”¯äº‹åŠ¡ç”Ÿå‘½å‘¨æœŸç›‘å¬
 */
@Component
public class BranchTransactionListener {
    
    /**
     * åˆ†æ”¯äº‹åŠ¡å¼€å§‹å‰
     */
    @EventListener
    public void onBranchTransactionBegin(BranchTransactionBeginEvent event) {
        log.info("åˆ†æ”¯äº‹åŠ¡å¼€å§‹ - XID: {}, BranchId: {}", 
                event.getXid(), event.getBranchId());
    }
    
    /**
     * åˆ†æ”¯äº‹åŠ¡æäº¤å‰
     */  
    @EventListener
    public void onBranchTransactionCommit(BranchTransactionCommitEvent event) {
        log.info("åˆ†æ”¯äº‹åŠ¡æäº¤ - XID: {}, BranchId: {}", 
                event.getXid(), event.getBranchId());
        
        // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›æ¸…ç†å·¥ä½œ
        // æ¯”å¦‚æ¸…é™¤ç¼“å­˜ã€å‘é€æ¶ˆæ¯ç­‰
    }
    
    /**
     * åˆ†æ”¯äº‹åŠ¡å›æ»šå‰
     */
    @EventListener  
    public void onBranchTransactionRollback(BranchTransactionRollbackEvent event) {
        log.info("åˆ†æ”¯äº‹åŠ¡å›æ»š - XID: {}, BranchId: {}", 
                event.getXid(), event.getBranchId());
        
        // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›è¡¥å¿æ“ä½œ
        // æ¯”å¦‚æ¢å¤ç¼“å­˜ã€å‘é€å‘Šè­¦ç­‰
    }
}
```

### 9.4 å¼‚å¸¸æƒ…å†µå¤„ç†


```java
@Service
public class PaymentService {
    
    @Autowired
    private AccountMapper accountMapper;
    
    /**
     * å¸¦å¼‚å¸¸å¤„ç†çš„åˆ†æ”¯äº‹åŠ¡
     */
    @Transactional(rollbackFor = Exception.class)
    public void deductBalance(Long userId, BigDecimal amount) {
        
        try {
            // ä¸šåŠ¡å‰ç½®æ£€æŸ¥
            Account account = accountMapper.getByUserId(userId);
            if (account == null) {
                throw new BusinessException("ç”¨æˆ·è´¦æˆ·ä¸å­˜åœ¨");
            }
            
            if (account.getBalance().compareTo(amount) < 0) {
                throw new BusinessException("è´¦æˆ·ä½™é¢ä¸è¶³");
            }
            
            // æ‰§è¡Œæ‰£æ¬¾
            account.setBalance(account.getBalance().subtract(amount));
            int result = accountMapper.updateById(account);
            
            if (result <= 0) {
                throw new RuntimeException("ä½™é¢æ‰£å‡å¤±è´¥");
            }
            
            log.info("ç”¨æˆ· {} ä½™é¢æ‰£å‡æˆåŠŸï¼Œæ‰£å‡é‡‘é¢ï¼š{}", userId, amount);
            
        } catch (BusinessException e) {
            // ä¸šåŠ¡å¼‚å¸¸ï¼Œè®°å½•æ—¥å¿—ä½†ä¸å½±å“å…¶ä»–åˆ†æ”¯äº‹åŠ¡
            log.warn("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());
            throw e;  // é‡æ–°æŠ›å‡ºï¼Œè®©å…¨å±€äº‹åŠ¡å›æ»š
            
        } catch (Exception e) {
            // ç³»ç»Ÿå¼‚å¸¸ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
            log.error("ç³»ç»Ÿå¼‚å¸¸ï¼Œæ‰£æ¬¾å¤±è´¥", e);
            throw new RuntimeException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•", e);
        }
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¢æˆ·ç«¯é›†æˆæœ¬è´¨ï¼šåœ¨åº”ç”¨ä¸­å®‰è£…"åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒå‘˜"
ğŸ”¸ æ•°æ®æºä»£ç†ï¼šç»™æ•°æ®åº“è¿æ¥è£…"ç›‘å¬å™¨"ï¼Œè®°å½•æ“ä½œæ—¥å¿—
ğŸ”¸ å…¨å±€äº‹åŠ¡æ³¨è§£ï¼šæ ‡è®°åˆ†å¸ƒå¼äº‹åŠ¡çš„èµ·ç‚¹å’Œè¾¹ç•Œ
ğŸ”¸ åˆ†æ”¯äº‹åŠ¡ï¼šå…¨å±€äº‹åŠ¡ä¸‹çš„æ¯ä¸ªæœ¬åœ°äº‹åŠ¡
ğŸ”¸ äº‹åŠ¡ä¼ æ’­ï¼šäº‹åŠ¡ä¿¡æ¯åœ¨æœåŠ¡è°ƒç”¨é—´çš„è‡ªåŠ¨ä¼ é€’
```

### 10.2 é›†æˆæ¡†æ¶å¯¹æ¯”


| é›†æˆæ–¹å¼ | **é…ç½®å¤æ‚åº¦** | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|----------|-------------|
| ğŸš€ **Spring Boot** | `ç®€å•` | `ä¸€èˆ¬` | `å•ä½“åº”ç”¨æ”¹é€ ` |
| â˜ï¸ **Spring Cloud** | `ä¸­ç­‰` | `è‰¯å¥½` | `HTTPå¾®æœåŠ¡` |
| ğŸ¯ **Cloud Alibaba** | `ç®€å•` | `è‰¯å¥½` | `é˜¿é‡Œäº‘ç”Ÿæ€` |
| ğŸŒ **Dubbo** | `å¤æ‚` | `ä¼˜ç§€` | `RPCå¾®æœåŠ¡` |

### 10.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ”¹ é€‰æ‹©é›†æˆæ–¹å¼çš„å»ºè®®**ï¼š
```
æ–°é¡¹ç›®æ¨èï¼š
â€¢ Spring Cloud Alibaba (é…ç½®ç®€å•ï¼Œæ–‡æ¡£ä¸°å¯Œ)
â€¢ æˆ–è€… Dubbo (æ€§èƒ½æ›´å¥½ï¼Œä½†é…ç½®å¤æ‚)

è€é¡¹ç›®æ”¹é€ ï¼š
â€¢ Spring Boot (æ”¹åŠ¨æœ€å°)
â€¢ é€æ­¥è¿ç§»åˆ°å¾®æœåŠ¡æ¶æ„

æ€§èƒ½è¦æ±‚é«˜ï¼š
â€¢ ä¼˜å…ˆé€‰æ‹© Dubbo
â€¢ å…¶æ¬¡æ˜¯ Spring Cloud

å›¢é˜ŸæŠ€æœ¯æ ˆï¼š
â€¢ å·²ç”¨Alibabaç”Ÿæ€ â†’ Spring Cloud Alibaba
â€¢ å·²ç”¨Netflixç”Ÿæ€ â†’ åŸç”ŸSpring Cloud
```

**ğŸ”¹ å¸¸è§é…ç½®é™·é˜±**ï¼š
```
âŒ æ•°æ®æºé…ç½®é”™è¯¯ï¼š
â€¢ å¿˜è®°ä½¿ç”¨DataSourceProxyä»£ç†
â€¢ å¤šæ•°æ®æºæ—¶é…ç½®æ··ä¹±

âŒ æ³¨è§£ä½¿ç”¨é”™è¯¯ï¼š
â€¢ @GlobalTransactionalä½ç½®ä¸å½“
â€¢ å’Œ@Transactionalæ··åˆä½¿ç”¨å‡ºé”™

âŒ ä¾èµ–ç‰ˆæœ¬ä¸åŒ¹é…ï¼š
â€¢ Seataç‰ˆæœ¬å’ŒSpringç‰ˆæœ¬ä¸å…¼å®¹
â€¢ å¤šä¸ªSeataä¾èµ–å†²çª
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š
```
è¿æ¥æ± é…ç½®ï¼š
â€¢ åˆç†è®¾ç½®æ•°æ®åº“è¿æ¥æ± å¤§å°
â€¢ é¿å…è¿æ¥æ³„éœ²

äº‹åŠ¡è¶…æ—¶ï¼š
â€¢ æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦è®¾ç½®è¶…æ—¶æ—¶é—´
â€¢ é¿å…é•¿æ—¶é—´é”å®šèµ„æº

æ‰¹é‡æ“ä½œï¼š
â€¢ å¤§æ‰¹é‡æ“ä½œè¦åˆ†æ‰¹å¤„ç†
â€¢ é¿å…é•¿äº‹åŠ¡å½±å“æ€§èƒ½
```

### 10.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ”§ å¸¸è§é—®é¢˜è¯Šæ–­**ï¼š

```
é—®é¢˜1ï¼šäº‹åŠ¡ä¸ç”Ÿæ•ˆ
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥æ•°æ®æºæ˜¯å¦ä½¿ç”¨äº†ä»£ç†
2. ç¡®è®¤@GlobalTransactionalæ³¨è§£ä½ç½®
3. æŸ¥çœ‹SeataæœåŠ¡å™¨è¿æ¥çŠ¶æ€

é—®é¢˜2ï¼šäº‹åŠ¡å›æ»šå¼‚å¸¸  
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥undo_logè¡¨æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤æ•°æ®åº“è¿æ¥æƒé™
3. æŸ¥çœ‹å¼‚å¸¸å †æ ˆä¿¡æ¯

é—®é¢˜3ï¼šæ€§èƒ½é—®é¢˜
æ’æŸ¥æ­¥éª¤ï¼š
1. ç›‘æ§æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
2. æ£€æŸ¥äº‹åŠ¡è¶…æ—¶è®¾ç½®
3. åˆ†ææ…¢SQLå’Œé”ç­‰å¾…
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Seataå®¢æˆ·ç«¯å°±æ˜¯ç»™åº”ç”¨è£…ä¸ª"äº‹åŠ¡ç®¡å®¶"
- æ•°æ®æºä»£ç†æ˜¯æ ¸å¿ƒï¼Œè®©Seataèƒ½ç›‘æ§æ•°æ®åº“æ“ä½œ
- @GlobalTransactionalæ ‡è®°äº‹åŠ¡è¾¹ç•Œï¼Œåªåœ¨å…¥å£ä½¿ç”¨
- åˆ†æ”¯äº‹åŠ¡è‡ªåŠ¨å‚ä¸å…¨å±€äº‹åŠ¡ï¼Œæ— éœ€ç‰¹æ®Šé…ç½®
- ä¸åŒæ¡†æ¶é›†æˆæ–¹å¼ä¸åŒï¼Œä½†åŸç†ç›¸åŒ
- é…ç½®æ­£ç¡®æ¯”ç†è§£åŸç†æ›´é‡è¦ï¼Œå…ˆç”¨èµ·æ¥å†æ·±å…¥