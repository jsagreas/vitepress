---
title: 8ã€Seataç”Ÿäº§ç¯å¢ƒå®è·µ
---
## ğŸ“š ç›®å½•

1. [Seataç”Ÿäº§ç¯å¢ƒé…ç½®ç®¡ç†](#1-Seataç”Ÿäº§ç¯å¢ƒé…ç½®ç®¡ç†)
2. [æ€§èƒ½è°ƒä¼˜ç­–ç•¥](#2-æ€§èƒ½è°ƒä¼˜ç­–ç•¥)
3. [äº‹åŠ¡éš”ç¦»ä¸å¹¶å‘æ§åˆ¶](#3-äº‹åŠ¡éš”ç¦»ä¸å¹¶å‘æ§åˆ¶)
4. [å¹‚ç­‰æ€§å¤„ç†æœºåˆ¶](#4-å¹‚ç­‰æ€§å¤„ç†æœºåˆ¶)
5. [è„å†™å›æ»šå¤„ç†](#5-è„å†™å›æ»šå¤„ç†)
6. [æ—¥å¿—æ¸…ç†ä¸ç»´æŠ¤](#6-æ—¥å¿—æ¸…ç†ä¸ç»´æŠ¤)
7. [å¼‚å¸¸å‘Šè­¦ç›‘æ§](#7-å¼‚å¸¸å‘Šè­¦ç›‘æ§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. âš™ï¸ Seataç”Ÿäº§ç¯å¢ƒé…ç½®ç®¡ç†


### 1.1 é…ç½®ç®¡ç†æœ¬è´¨ç†è§£


**ä»€ä¹ˆæ˜¯Seataé…ç½®ç®¡ç†ï¼Ÿ**

æƒ³è±¡ä½ å¼€äº†ä¸€å®¶è¿é”é¤å…ï¼Œæ¯ä¸ªåˆ†åº—éƒ½éœ€è¦ç»Ÿä¸€çš„èœå•ã€ä»·æ ¼ã€æœåŠ¡æ ‡å‡†ã€‚Seataé…ç½®ç®¡ç†å°±åƒè¿™ä¸ª**ç»Ÿä¸€çš„ç®¡ç†æ‰‹å†Œ**ï¼Œç¡®ä¿æ‰€æœ‰å¾®æœåŠ¡éƒ½èƒ½æŒ‰ç…§ç›¸åŒçš„"è§„çŸ©"æ¥å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚

> **æ ¸å¿ƒç†å¿µ**ï¼šé›†ä¸­ç®¡ç†ã€åŠ¨æ€æ›´æ–°ã€å¤šç¯å¢ƒéš”ç¦»

### 1.2 é…ç½®ä¸­å¿ƒé›†æˆæ–¹æ¡ˆ


**ğŸ”— ä¸»æµé…ç½®ä¸­å¿ƒå¯¹æ¯”**

| **é…ç½®ä¸­å¿ƒ** | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **é›†æˆéš¾åº¦** |
|-------------|---------|-------------|-------------|
| **Nacos** | `æœåŠ¡å‘ç°+é…ç½®ç®¡ç†` | `Spring Cloudç”Ÿæ€` | `â­â­` |
| **Apollo** | `é…ç½®ç®¡ç†ä¸“ä¸š` | `å¤§å‹ä¼ä¸šåº”ç”¨` | `â­â­â­` |
| **Consul** | `åˆ†å¸ƒå¼ä¸€è‡´æ€§å¼º` | `å¤šè¯­è¨€ç¯å¢ƒ` | `â­â­â­â­` |
| **æ–‡ä»¶é…ç½®** | `ç®€å•ç›´æ¥` | `å°å‹é¡¹ç›®` | `â­` |

**å®é™…é…ç½®ç¤ºä¾‹**

```yaml
# registry.conf - æ³¨å†Œä¸­å¿ƒé…ç½®
registry {
  type = "nacos"
  nacos {
    application = "seata-server"
    serverAddr = "nacos-cluster.prod.com:8848"
    group = "SEATA_GROUP"
    namespace = "prod-namespace"
    username = "seata"
    password = "seata123"
  }
}

config {
  type = "nacos"
  nacos {
    serverAddr = "nacos-cluster.prod.com:8848"
    group = "SEATA_GROUP"
    namespace = "prod-namespace"
    dataId = "seataServer.properties"
  }
}
```

### 1.3 å…³é”®é…ç½®å‚æ•°è¯¦è§£


**ğŸ¯ æ ¸å¿ƒé…ç½®è¯´æ˜**

```yaml
# seata-serveræ ¸å¿ƒé…ç½®
seata:
  server:
    # æœåŠ¡ç«¯å£
    service-port: 8091
    # æœ€å¤§è¿æ¥æ•°
    max-conn: 1000
    # å…¨å±€é”è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    global-lock-timeout: 30000
    # åˆ†æ”¯äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    branch-timeout: 60000
    
  store:
    # å­˜å‚¨æ¨¡å¼ï¼šfile/db/redis
    mode: db
    db:
      datasource: druid
      db-type: mysql
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://mysql-cluster:3306/seata?useUnicode=true&rewriteBatchedStatements=true
      user: seata
      password: seata123
      min-conn: 10
      max-conn: 30
```

**é…ç½®å‚æ•°é€šä¿—è§£é‡Š**ï¼š

- **max-conn**ï¼šå°±åƒé“¶è¡Œçª—å£æ•°é‡ï¼Œå†³å®šèƒ½åŒæ—¶å¤„ç†å¤šå°‘ä¸ªäº‹åŠ¡è¯·æ±‚
- **global-lock-timeout**ï¼šå…¨å±€é”ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡å°±æ”¾å¼ƒï¼Œé¿å…æ­»ç­‰
- **branch-timeout**ï¼šå•ä¸ªåˆ†æ”¯äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢æŸä¸ªæœåŠ¡å¡æ­»

### 1.4 å¤šç¯å¢ƒé…ç½®ç­–ç•¥


**ğŸŒ ç¯å¢ƒéš”ç¦»æ¶æ„**

```
é…ç½®ç¯å¢ƒéš”ç¦»ç­–ç•¥ï¼š

ç”Ÿäº§ç¯å¢ƒ (prod)     æµ‹è¯•ç¯å¢ƒ (test)     å¼€å‘ç¯å¢ƒ (dev)
    â†“                   â†“                  â†“
é«˜å¯ç”¨é›†ç¾¤          å•æœºéƒ¨ç½²           æœ¬åœ°å¼€å‘
ä¸¥æ ¼é…ç½®           å®½æ¾é…ç½®           è°ƒè¯•é…ç½®
```

**ç¯å¢ƒé…ç½®å·®å¼‚åŒ–**

```properties
# ç”Ÿäº§ç¯å¢ƒ - prod
seata.global-transaction-timeout=300000
seata.branch-transaction-timeout=60000
seata.retry-times=3

# æµ‹è¯•ç¯å¢ƒ - test  
seata.global-transaction-timeout=180000
seata.branch-transaction-timeout=30000
seata.retry-times=5

# å¼€å‘ç¯å¢ƒ - dev
seata.global-transaction-timeout=60000
seata.branch-transaction-timeout=15000
seata.retry-times=10
```

---

## 2. ğŸš€ æ€§èƒ½è°ƒä¼˜ç­–ç•¥


### 2.1 æ€§èƒ½è°ƒä¼˜çš„æ ¸å¿ƒæ€è·¯


**æ€§èƒ½ä¼˜åŒ–å°±åƒç»™æ±½è½¦æ”¹è£…**

æƒ³è±¡åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€è¾†éœ€è¦åè°ƒå¤šä¸ªéƒ¨ä»¶çš„æ±½è½¦ï¼š
- **å¼•æ“è°ƒä¼˜** = æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- **ä¼ åŠ¨ç³»ç»Ÿ** = ç½‘ç»œé€šä¿¡ä¼˜åŒ–  
- **æ²¹è€—æ§åˆ¶** = å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- **è¡Œé©¶è·¯çº¿** = äº‹åŠ¡å¤„ç†æµç¨‹ä¼˜åŒ–

### 2.2 æ•°æ®åº“å±‚é¢ä¼˜åŒ–


**ğŸ”§ è¿æ¥æ± é…ç½®ä¼˜åŒ–**

```yaml
seata:
  store:
    db:
      # æœ€å°è¿æ¥æ•° - å°±åƒåœè½¦åœºçš„ä¿ç•™è½¦ä½
      min-conn: 20
      # æœ€å¤§è¿æ¥æ•° - åœè½¦åœºæ€»è½¦ä½æ•°
      max-conn: 100
      # è¿æ¥è·å–è¶…æ—¶æ—¶é—´
      max-wait: 5000
      # è¿æ¥éªŒè¯æŸ¥è¯¢
      validation-query: "SELECT 1"
      # ç©ºé—²è¿æ¥æ£€æµ‹æ—¶é—´
      time-between-eviction-runs-millis: 60000
```

**æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–**

```sql
-- Seataå¿…éœ€çš„æ•°æ®åº“ç´¢å¼•
-- å…¨å±€äº‹åŠ¡è¡¨ç´¢å¼•
CREATE INDEX idx_gmt_modified_status ON global_table(gmt_modified, status);
CREATE INDEX idx_transaction_id ON global_table(transaction_id);

-- åˆ†æ”¯äº‹åŠ¡è¡¨ç´¢å¼•
CREATE INDEX idx_xid ON branch_table(xid);
CREATE INDEX idx_branch_id ON branch_table(branch_id);
```

### 2.3 å†…å­˜ä¸çº¿ç¨‹è°ƒä¼˜


**ğŸ’¾ JVMå†…å­˜é…ç½®**

```bash
# Seata Server JVMå‚æ•°ä¼˜åŒ–
java -server \
  -Xms2g -Xmx2g \                    # å †å†…å­˜è®¾ç½®
  -XX:NewRatio=1 \                   # å¹´è½»ä»£æ¯”ä¾‹
  -XX:SurvivorRatio=8 \              # EdenåŒºæ¯”ä¾‹
  -XX:+UseG1GC \                     # ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨
  -XX:MaxGCPauseMillis=200 \         # GCæš‚åœæ—¶é—´ç›®æ ‡
  -XX:+PrintGCDetails \              # æ‰“å°GCè¯¦æƒ…
  -jar seata-server.jar
```

**ğŸ§µ çº¿ç¨‹æ± é…ç½®**

```yaml
# å®¢æˆ·ç«¯çº¿ç¨‹æ± é…ç½®
seata:
  client:
    tm:
      # äº‹åŠ¡ç®¡ç†å™¨çº¿ç¨‹æ± 
      commit-retry-count: 5
      rollback-retry-count: 5
    rm:
      # èµ„æºç®¡ç†å™¨é…ç½®
      async-commit-buffer-limit: 10000
      report-retry-count: 5
      report-success-enable: false
```

### 2.4 ç½‘ç»œé€šä¿¡ä¼˜åŒ–


**ğŸ“¡ é€šä¿¡å‚æ•°è°ƒä¼˜**

```yaml
# ç½‘ç»œé€šä¿¡ä¼˜åŒ–é…ç½®
seata:
  transport:
    # ä¼ è¾“ç±»å‹ï¼šTCP/NIO
    type: TCP
    # æœåŠ¡å™¨é…ç½®
    server: NIO
    # å¿ƒè·³æ£€æµ‹
    heartbeat: true
    # åºåˆ—åŒ–æ–¹å¼ï¼šseata/protobuf/kryo/hessian/fst
    serialization: seata
    # å‹ç¼©æ–¹å¼ï¼šnone/gzip/zip/sevenz/bzip2/lz4/deflater
    compressor: none
    # å¯ç”¨å®¢æˆ·ç«¯æ‰¹é‡å‘é€è¯·æ±‚
    enable-client-batch-send-request: true
```

**æ€§èƒ½ç›‘æ§æŒ‡æ ‡**

| **æŒ‡æ ‡ç±»åˆ«** | **å…³é”®æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **ä¼˜åŒ–å»ºè®®** |
|-------------|-------------|-------------|-------------|
| **å“åº”æ—¶é—´** | `äº‹åŠ¡æäº¤è€—æ—¶` | `< 100ms` | `ä¼˜åŒ–ç½‘ç»œå’Œæ•°æ®åº“` |
| **ååé‡** | `TPSå¤„ç†èƒ½åŠ›` | `> 1000` | `å¢åŠ æœåŠ¡å™¨èµ„æº` |
| **èµ„æºä½¿ç”¨** | `CPU/å†…å­˜ä½¿ç”¨ç‡` | `< 80%` | `è°ƒæ•´JVMå‚æ•°` |
| **é”™è¯¯ç‡** | `äº‹åŠ¡å¤±è´¥ç‡` | `< 1%` | `ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘` |

---

## 3. ğŸ”’ äº‹åŠ¡éš”ç¦»ä¸å¹¶å‘æ§åˆ¶


### 3.1 åˆ†å¸ƒå¼äº‹åŠ¡éš”ç¦»ç†è§£


**ä»€ä¹ˆæ˜¯äº‹åŠ¡éš”ç¦»ï¼Ÿ**

æƒ³è±¡ä¸€ä¸ªé“¶è¡ŒATMæœºï¼Œå½“ä½ åœ¨å–é’±æ—¶ï¼Œå…¶ä»–äººä¸èƒ½åŒæ—¶æ“ä½œä½ çš„è´¦æˆ·ã€‚åˆ†å¸ƒå¼äº‹åŠ¡éš”ç¦»å°±æ˜¯ç¡®ä¿åœ¨**å¤šä¸ªæœåŠ¡åŒæ—¶æ“ä½œ**æ—¶ï¼Œä¸ä¼šå‡ºç°æ•°æ®æ··ä¹±ã€‚

```
äº‹åŠ¡éš”ç¦»å°±åƒæ’é˜Ÿç³»ç»Ÿï¼š

æ­£åœ¨åŠç†ä¸šåŠ¡çš„ç”¨æˆ·    â†’    [æŸœå°A]
                     â†“
ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç”¨æˆ·     â†’    [ç­‰å¾…åŒº]
                     â†“  
ä¸‹ä¸€ä½ç”¨æˆ·          â†’    [å‡†å¤‡åŒº]
```

### 3.2 Seataéš”ç¦»çº§åˆ«é…ç½®


**ğŸ¯ éš”ç¦»çº§åˆ«å¯¹æ¯”**

| **éš”ç¦»çº§åˆ«** | **ç‰¹ç‚¹** | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|-------------|---------|---------|-------------|
| **è¯»æœªæäº¤** | `å¯èƒ½è„è¯»` | `â­â­â­â­â­` | `å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æä½` |
| **è¯»å·²æäº¤** | `é¿å…è„è¯»` | `â­â­â­â­` | `ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯` |
| **å¯é‡å¤è¯»** | `é¿å…ä¸å¯é‡å¤è¯»` | `â­â­â­` | `é‡è¦ä¸šåŠ¡æ•°æ®` |
| **åºåˆ—åŒ–** | `æœ€é«˜éš”ç¦»` | `â­` | `é‡‘èç­‰å…³é”®ä¸šåŠ¡` |

**å®é™…é…ç½®ç¤ºä¾‹**

```yaml
# æ•°æ®æºéš”ç¦»çº§åˆ«é…ç½®
spring:
  datasource:
    # è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«
    hikari:
      transaction-isolation: TRANSACTION_READ_COMMITTED
      
seata:
  client:
    rm:
      # å…¨å±€é”é‡è¯•é—´éš”
      lock-retry-interval: 10
      # å…¨å±€é”é‡è¯•æ¬¡æ•°
      lock-retry-times: 30
```

### 3.3 å¹¶å‘æ§åˆ¶ç­–ç•¥


**âš¡ å¹¶å‘æ§åˆ¶æœºåˆ¶**

```java
// ä¸šåŠ¡ä»£ç ä¸­çš„å¹¶å‘æ§åˆ¶
@GlobalTransactional(rollbackFor = Exception.class)
public void transferMoney(String fromAccount, String toAccount, BigDecimal amount) {
    // 1. è·å–å…¨å±€é”ï¼ˆè‡ªåŠ¨ï¼‰
    // 2. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    accountService.debit(fromAccount, amount);
    accountService.credit(toAccount, amount);
    // 3. é‡Šæ”¾å…¨å±€é”ï¼ˆè‡ªåŠ¨ï¼‰
}
```

**å…¨å±€é”æœºåˆ¶è§£é‡Š**ï¼š

1. **è·å–é”**ï¼šå°±åƒè¿›å…¥é“¶è¡ŒVIPå®¤ï¼Œä¸€æ¬¡åªèƒ½ä¸€ä¸ªå®¢æˆ·
2. **æ‰§è¡Œæ“ä½œ**ï¼šåœ¨VIPå®¤å†…å®Œæˆæ‰€æœ‰é“¶è¡Œä¸šåŠ¡
3. **é‡Šæ”¾é”**ï¼šä¸šåŠ¡å®Œæˆåï¼Œä¸‹ä¸€ä¸ªå®¢æˆ·æ‰èƒ½è¿›å…¥

### 3.4 æ­»é”æ£€æµ‹ä¸å¤„ç†


**ğŸ” æ­»é”åœºæ™¯åˆ†æ**

```
æ­»é”åœºæ™¯ç¤ºä¾‹ï¼š

äº‹åŠ¡A: é”å®šèµ„æº1 â†’ ç­‰å¾…èµ„æº2
äº‹åŠ¡B: é”å®šèµ„æº2 â†’ ç­‰å¾…èµ„æº1

ç»“æœï¼šä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…ï¼Œå½¢æˆæ­»é”
```

**æ­»é”é¢„é˜²é…ç½®**

```yaml
seata:
  client:
    rm:
      # å…¨å±€é”ç­‰å¾…è¶…æ—¶æ—¶é—´
      global-lock-timeout: 30000
      # æ­»é”æ£€æµ‹é—´éš”
      lock-retry-interval: 10
      # æœ€å¤§é‡è¯•æ¬¡æ•°
      lock-retry-times: 30
```

> **ğŸ’¡ æ­»é”å¤„ç†åŸåˆ™**ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œè®©é•¿æ—¶é—´ç­‰å¾…çš„äº‹åŠ¡è‡ªåŠ¨æ”¾å¼ƒï¼Œé¿å…ç³»ç»Ÿå¡æ­»ã€‚

---

## 4. ğŸ”„ å¹‚ç­‰æ€§å¤„ç†æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§


**å¹‚ç­‰æ€§çš„ç”Ÿæ´»æ¯”å–»**

æƒ³è±¡ä½ ç”¨é¥æ§å™¨å¼€ç”µè§†ï¼š
- **ç¬¬1æ¬¡æŒ‰å¼€æœº**ï¼šç”µè§†æ‰“å¼€ âœ…
- **ç¬¬2æ¬¡æŒ‰å¼€æœº**ï¼šç”µè§†è¿˜æ˜¯å¼€ç€ï¼Œæ²¡æœ‰å˜åŒ– âœ…
- **ç¬¬Næ¬¡æŒ‰å¼€æœº**ï¼šç»“æœéƒ½ä¸€æ · âœ…

è¿™å°±æ˜¯**å¹‚ç­‰æ€§**ï¼šæ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½ä¸€æ ·ã€‚

### 4.2 åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„å¹‚ç­‰æ€§é—®é¢˜


**ğŸš¨ å¸¸è§å¹‚ç­‰æ€§é—®é¢˜åœºæ™¯**

```
é‡å¤æ‰§è¡Œé—®é¢˜ï¼š

ç”¨æˆ·ç‚¹å‡»"æäº¤è®¢å•"æŒ‰é’®
        â†“
ç½‘ç»œè¶…æ—¶ï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»
        â†“
ç³»ç»Ÿæ”¶åˆ°2ä¸ªç›¸åŒè¯·æ±‚
        â†“
å¯èƒ½åˆ›å»º2ä¸ªé‡å¤è®¢å• âŒ
```

### 4.3 å¹‚ç­‰æ€§å®ç°ç­–ç•¥


**ğŸ’¡ ä¸»æµå¹‚ç­‰æ€§æ–¹æ¡ˆ**

| **æ–¹æ¡ˆç±»å‹** | **å®ç°æ–¹å¼** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-------------|-------------|---------|---------|
| **å”¯ä¸€çº¦æŸ** | `æ•°æ®åº“å”¯ä¸€ç´¢å¼•` | `ç®€å•å¯é ` | `ä»…é€‚ç”¨äºæ’å…¥æ“ä½œ` |
| **çŠ¶æ€æœº** | `è®¢å•çŠ¶æ€æ§åˆ¶` | `ä¸šåŠ¡è¯­ä¹‰æ¸…æ™°` | `çŠ¶æ€å¤æ‚æ—¶éš¾ç»´æŠ¤` |
| **Tokenæœºåˆ¶** | `è¯·æ±‚ä»¤ç‰ŒéªŒè¯` | `é€‚ç”¨æ€§å¹¿` | `éœ€è¦é¢å¤–å­˜å‚¨` |
| **åˆ†å¸ƒå¼é”** | `Redis/Zookeeper` | `å¼ºä¸€è‡´æ€§` | `æ€§èƒ½å¼€é”€å¤§` |

**å®é™…ä»£ç ç¤ºä¾‹**

```java
@Service
public class OrderService {
    
    // æ–¹æ¡ˆ1ï¼šæ•°æ®åº“å”¯ä¸€çº¦æŸ
    @GlobalTransactional
    public void createOrder(String orderId, OrderInfo orderInfo) {
        try {
            orderRepository.insert(orderId, orderInfo);
        } catch (DuplicateKeyException e) {
            log.warn("è®¢å•å·²å­˜åœ¨: {}", orderId);
            return; // å¹‚ç­‰å¤„ç†ï¼šé‡å¤è¯·æ±‚ç›´æ¥è¿”å›
        }
    }
    
    // æ–¹æ¡ˆ2ï¼šçŠ¶æ€æœºæ§åˆ¶
    @GlobalTransactional
    public void payOrder(String orderId) {
        Order order = orderRepository.findById(orderId);
        if (order.getStatus() == OrderStatus.PAID) {
            log.warn("è®¢å•å·²æ”¯ä»˜: {}", orderId);
            return; // å¹‚ç­‰å¤„ç†ï¼šå·²æ”¯ä»˜çŠ¶æ€ä¸é‡å¤å¤„ç†
        }
        
        // æ‰§è¡Œæ”¯ä»˜é€»è¾‘
        order.setStatus(OrderStatus.PAID);
        orderRepository.update(order);
    }
}
```

### 4.4 Seataå¹‚ç­‰æ€§æœ€ä½³å®è·µ


**ğŸ† æ¨èå®ç°æ¨¡å¼**

```java
@Component
public class IdempotentHandler {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * å¹‚ç­‰æ€§æ£€æŸ¥è£…é¥°å™¨
     */
    public <T> T executeWithIdempotent(String key, Supplier<T> business) {
        String lockKey = "idempotent:lock:" + key;
        String resultKey = "idempotent:result:" + key;
        
        // 1. æ£€æŸ¥æ˜¯å¦å·²æ‰§è¡Œ
        String existResult = redisTemplate.opsForValue().get(resultKey);
        if (existResult != null) {
            return JSON.parseObject(existResult, Object.class);
        }
        
        // 2. è·å–åˆ†å¸ƒå¼é”
        Boolean locked = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "1", Duration.ofMinutes(5));
        
        if (!locked) {
            throw new BusinessException("è¯·å‹¿é‡å¤æäº¤");
        }
        
        try {
            // 3. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            T result = business.get();
            
            // 4. ç¼“å­˜æ‰§è¡Œç»“æœ
            redisTemplate.opsForValue().set(
                resultKey, 
                JSON.toJSONString(result), 
                Duration.ofHours(1)
            );
            
            return result;
        } finally {
            // 5. é‡Šæ”¾é”
            redisTemplate.delete(lockKey);
        }
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**

```java
@RestController
public class OrderController {
    
    @Autowired
    private IdempotentHandler idempotentHandler;
    
    @PostMapping("/orders")
    public ResponseEntity<OrderResponse> createOrder(@RequestBody OrderRequest request) {
        String idempotentKey = "create_order:" + request.getOrderId();
        
        OrderResponse response = idempotentHandler.executeWithIdempotent(
            idempotentKey,
            () -> orderService.createOrder(request)
        );
        
        return ResponseEntity.ok(response);
    }
}
```

---

## 5. ğŸ”„ è„å†™å›æ»šå¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯è„å†™é—®é¢˜


**è„å†™çš„é€šä¿—ç†è§£**

æƒ³è±¡ä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘ä¸€ä»½Wordæ–‡æ¡£ï¼š
- **ç”¨æˆ·A** æ­£åœ¨ä¿®æ”¹ç¬¬1æ®µ
- **ç”¨æˆ·B** ä¹Ÿåœ¨ä¿®æ”¹ç¬¬1æ®µ
- **ç»“æœ**ï¼šæœ€åä¿å­˜æ—¶ï¼Œä¸€ä¸ªäººçš„ä¿®æ”¹è¦†ç›–äº†å¦ä¸€ä¸ªäººçš„ä¿®æ”¹

åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œè„å†™å°±æ˜¯**ä¸€ä¸ªæœªæäº¤çš„äº‹åŠ¡ä¿®æ”¹äº†å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„æ•°æ®**ã€‚

### 5.2 è„å†™åœºæ™¯åˆ†æ


**ğŸ’¥ å…¸å‹è„å†™åœºæ™¯**

```
è„å†™é—®é¢˜ç¤ºä¾‹ï¼š

æ—¶é—´çº¿    äº‹åŠ¡A                 äº‹åŠ¡B
T1       å¼€å§‹äº‹åŠ¡              
T2       ä¿®æ”¹è´¦æˆ·ä½™é¢: 100â†’80    
T3                           å¼€å§‹äº‹åŠ¡
T4                           è¯»å–ä½™é¢: 80
T5                           ä¿®æ”¹ä½™é¢: 80â†’50
T6       å›æ»šäº‹åŠ¡(ä½™é¢å˜å›100)   
T7                           æäº¤äº‹åŠ¡(ä½™é¢ç¡®è®¤ä¸º50) âŒ
```

**é—®é¢˜åˆ†æ**ï¼š
- äº‹åŠ¡Aå›æ»šåï¼Œè´¦æˆ·åº”è¯¥æ˜¯100
- ä½†äº‹åŠ¡BåŸºäºé”™è¯¯æ•°æ®(80)è¿›è¡Œè®¡ç®—
- æœ€ç»ˆç»“æœé”™è¯¯(50)ï¼Œæ•°æ®ä¸ä¸€è‡´

### 5.3 Seataè„å†™é˜²æŠ¤æœºåˆ¶


**ğŸ›¡ï¸ Seataçš„ä¿æŠ¤ç­–ç•¥**

Seataé€šè¿‡**å…¨å±€é”æœºåˆ¶**é˜²æ­¢è„å†™ï¼š

```java
@GlobalTransactional
public void transferMoney(String fromAccount, String toAccount, BigDecimal amount) {
    // Seataè‡ªåŠ¨åŠ å…¨å±€é”
    accountService.debit(fromAccount, amount);    // é”å®šfromè´¦æˆ·
    accountService.credit(toAccount, amount);     // é”å®štoè´¦æˆ·
    // äº‹åŠ¡ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾é”
}
```

**å…¨å±€é”å·¥ä½œæµç¨‹**ï¼š

```
å…¨å±€é”ä¿æŠ¤æœºåˆ¶ï¼š

äº‹åŠ¡Aè·å–å…¨å±€é” â†’ ä¿®æ”¹æ•°æ® â†’ æŒæœ‰é”
        â†“
äº‹åŠ¡Bå°è¯•è·å–é” â†’ ç­‰å¾…/è¶…æ—¶ â†’ é¿å…è„å†™
        â†“
äº‹åŠ¡Aæäº¤/å›æ»š â†’ é‡Šæ”¾é” â†’ äº‹åŠ¡Bè·å–é”
```

### 5.4 è„å†™å›æ»šç­–ç•¥


**ğŸ”§ å›æ»šå¤„ç†é…ç½®**

```yaml
seata:
  client:
    rm:
      # è„å†™æ£€æµ‹å¼€å…³
      enable-dirty-detection: true
      # è„å†™å¤„ç†ç­–ç•¥: ROLLBACK/IGNORE/CHECK
      dirty-policy: ROLLBACK
      # å›æ»šé‡è¯•æ¬¡æ•°
      commit-retry-count: 5
      rollback-retry-count: 5
```

**è„å†™æ£€æµ‹ä¸å¤„ç†ä»£ç **

```java
@Component
public class DirtyWriteHandler {
    
    /**
     * è„å†™æ£€æµ‹
     */
    public boolean checkDirtyWrite(String resourceId, Object beforeImage, Object afterImage) {
        // 1. è·å–æ•°æ®åº“å½“å‰å€¼
        Object currentValue = getCurrentValueFromDB(resourceId);
        
        // 2. æ¯”è¾ƒbefore_imageä¸å½“å‰å€¼
        if (!Objects.equals(beforeImage, currentValue)) {
            log.warn("æ£€æµ‹åˆ°è„å†™: resourceId={}, before={}, current={}", 
                    resourceId, beforeImage, currentValue);
            return true;
        }
        
        return false;
    }
    
    /**
     * è„å†™å›æ»šå¤„ç†
     */
    @GlobalTransactional
    public void handleDirtyWrite(String transactionId) {
        try {
            // 1. æ ‡è®°äº‹åŠ¡ä¸ºå›æ»šçŠ¶æ€
            globalTransactionManager.rollback(transactionId);
            
            // 2. è®°å½•è„å†™æ—¥å¿—
            auditLogService.logDirtyWrite(transactionId);
            
            // 3. å‘é€å‘Šè­¦é€šçŸ¥
            alertService.sendDirtyWriteAlert(transactionId);
            
        } catch (Exception e) {
            log.error("è„å†™å›æ»šå¤±è´¥: {}", transactionId, e);
        }
    }
}
```

### 5.5 è„å†™é¢„é˜²æœ€ä½³å®è·µ


**ğŸ† é¢„é˜²ç­–ç•¥æ€»ç»“**

| **ç­–ç•¥** | **å®ç°æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **æ•ˆæœè¯„ä»·** |
|---------|-------------|-------------|-------------|
| **æ‚²è§‚é”** | `æ•°æ®åº“è¡Œé”` | `é«˜å¹¶å‘æ›´æ–°` | `â­â­â­â­` |
| **ä¹è§‚é”** | `ç‰ˆæœ¬å·æœºåˆ¶` | `è¯»å¤šå†™å°‘` | `â­â­â­â­â­` |
| **å…¨å±€é”** | `Seataå…¨å±€é”` | `åˆ†å¸ƒå¼äº‹åŠ¡` | `â­â­â­â­` |
| **é˜Ÿåˆ—åŒ–** | `æ¶ˆæ¯é˜Ÿåˆ—ä¸²è¡Œ` | `éå®æ—¶æ›´æ–°` | `â­â­â­` |

```java
// ä¹è§‚é”å®ç°ç¤ºä¾‹
@Entity
public class Account {
    private String accountId;
    private BigDecimal balance;
    private Long version;  // ç‰ˆæœ¬å·
    
    // getter/setter...
}

@Service
public class AccountService {
    
    @GlobalTransactional
    public void updateBalance(String accountId, BigDecimal amount) {
        Account account = accountRepository.findById(accountId);
        Long originalVersion = account.getVersion();
        
        // ä¿®æ”¹ä½™é¢
        account.setBalance(account.getBalance().add(amount));
        account.setVersion(originalVersion + 1);
        
        // åŸºäºç‰ˆæœ¬å·æ›´æ–°
        int updated = accountRepository.updateWithVersion(account, originalVersion);
        if (updated == 0) {
            throw new OptimisticLockException("æ•°æ®å·²è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹");
        }
    }
}
```

---

## 6. ğŸ—‚ï¸ æ—¥å¿—æ¸…ç†ä¸ç»´æŠ¤


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—æ¸…ç†


**æ—¥å¿—ç§¯ç´¯çš„é—®é¢˜**

æƒ³è±¡ä½ çš„æ‰‹æœºç…§ç‰‡æ°¸è¿œä¸åˆ é™¤ï¼š
- **å­˜å‚¨ç©ºé—´**ï¼šæ‰‹æœºå†…å­˜è¶Šæ¥è¶Šæ»¡
- **æŸ¥æ‰¾æ•ˆç‡**ï¼šæ‰¾ä¸€å¼ ç…§ç‰‡è¶Šæ¥è¶Šå›°éš¾  
- **æ€§èƒ½ä¸‹é™**ï¼šæ‰‹æœºè¿è¡Œè¶Šæ¥è¶Šæ…¢

Seataçš„äº‹åŠ¡æ—¥å¿—ä¹Ÿä¸€æ ·ï¼Œ**ä¸æ¸…ç†ä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™**ã€‚

### 6.2 Seataæ—¥å¿—ç±»å‹åˆ†æ


**ğŸ“‹ æ—¥å¿—åˆ†ç±»è¯¦è§£**

```
Seataæ—¥å¿—ä½“ç³»ç»“æ„ï¼š

å…¨å±€äº‹åŠ¡æ—¥å¿— (global_table)
â”œâ”€â”€ äº‹åŠ¡IDã€çŠ¶æ€ã€è¶…æ—¶æ—¶é—´
â”œâ”€â”€ åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´
â””â”€â”€ åº”ç”¨åç§°ã€äº‹åŠ¡ç»„

åˆ†æ”¯äº‹åŠ¡æ—¥å¿— (branch_table)  
â”œâ”€â”€ åˆ†æ”¯IDã€å…¨å±€äº‹åŠ¡ID
â”œâ”€â”€ èµ„æºIDã€åˆ†æ”¯ç±»å‹
â””â”€â”€ æ‰§è¡ŒçŠ¶æ€ã€é‡è¯•æ¬¡æ•°

é”è®°å½•æ—¥å¿— (lock_table)
â”œâ”€â”€ èµ„æºIDã€è¡¨åã€ä¸»é”®
â”œâ”€â”€ åˆ†æ”¯IDã€é”çŠ¶æ€
â””â”€â”€ è·å–æ—¶é—´ã€é‡Šæ”¾æ—¶é—´
```

### 6.3 æ—¥å¿—æ¸…ç†ç­–ç•¥é…ç½®


**âš™ï¸ è‡ªåŠ¨æ¸…ç†é…ç½®**

```yaml
seata:
  server:
    # æ—¥å¿—æ¸…ç†é…ç½®
    log:
      # å¯ç”¨è‡ªåŠ¨æ¸…ç†
      delete-when-no-space: true
      # ä¿ç•™å¤©æ•°
      keep-days: 30
      # æ¸…ç†é—´éš”ï¼ˆå°æ—¶ï¼‰
      clean-period: 24
      # å•æ¬¡æ¸…ç†æ•°é‡
      clean-batch-size: 1000
      
    # å­˜å‚¨æ¸…ç†é…ç½®  
    store:
      db:
        # æœ€å¤§è¿æ¥æ•°
        max-conn: 30
        # æŸ¥è¯¢è¶…æ—¶æ—¶é—´
        query-timeout: 60
```

**è‡ªå®šä¹‰æ¸…ç†è„šæœ¬**

```sql
-- æ¸…ç†30å¤©å‰çš„å·²å®Œæˆäº‹åŠ¡æ—¥å¿—
DELETE FROM global_table 
WHERE status IN ('Committed', 'Rollbacked', 'TimeoutRollbacked') 
  AND gmt_create < DATE_SUB(NOW(), INTERVAL 30 DAY)
  LIMIT 1000;

-- æ¸…ç†å¯¹åº”çš„åˆ†æ”¯äº‹åŠ¡æ—¥å¿—
DELETE FROM branch_table 
WHERE xid NOT IN (SELECT xid FROM global_table)
  LIMIT 1000;

-- æ¸…ç†æ— æ•ˆçš„é”è®°å½•
DELETE FROM lock_table 
WHERE branch_id NOT IN (SELECT branch_id FROM branch_table)
  LIMIT 1000;
```

### 6.4 æ—¥å¿—æ¸…ç†ç›‘æ§


**ğŸ“Š æ¸…ç†æ•ˆæœç›‘æ§**

```java
@Component
public class LogCleanupMonitor {
    
    @Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    public void dailyCleanupReport() {
        // 1. ç»Ÿè®¡æ¸…ç†å‰åçš„æ•°æ®é‡
        long beforeGlobal = globalTableRepository.count();
        long beforeBranch = branchTableRepository.count();
        
        // 2. æ‰§è¡Œæ¸…ç†
        logCleanupService.cleanup();
        
        // 3. ç»Ÿè®¡æ¸…ç†åçš„æ•°æ®é‡
        long afterGlobal = globalTableRepository.count();
        long afterBranch = branchTableRepository.count();
        
        // 4. ç”Ÿæˆæ¸…ç†æŠ¥å‘Š
        CleanupReport report = CleanupReport.builder()
            .cleanupDate(LocalDate.now())
            .globalTableBefore(beforeGlobal)
            .globalTableAfter(afterGlobal)
            .branchTableBefore(beforeBranch)
            .branchTableAfter(afterBranch)
            .cleanedGlobalRecords(beforeGlobal - afterGlobal)
            .cleanedBranchRecords(beforeBranch - afterBranch)
            .build();
            
        // 5. å‘é€æ¸…ç†æŠ¥å‘Š
        notificationService.sendCleanupReport(report);
    }
}
```

### 6.5 æ—¥å¿—å½’æ¡£ç­–ç•¥


**ğŸ’¾ åˆ†å±‚å­˜å‚¨æ–¹æ¡ˆ**

| **å­˜å‚¨å±‚çº§** | **æ•°æ®ç‰¹ç‚¹** | **å­˜å‚¨ä»‹è´¨** | **ä¿ç•™æ—¶é—´** |
|-------------|-------------|-------------|-------------|
| **çƒ­æ•°æ®** | `7å¤©å†…çš„æ´»è·ƒäº‹åŠ¡` | `SSDæ•°æ®åº“` | `7å¤©` |
| **æ¸©æ•°æ®** | `30å¤©å†…çš„å†å²äº‹åŠ¡` | `æ™®é€šç£ç›˜` | `30å¤©` |
| **å†·æ•°æ®** | `å½’æ¡£çš„äº‹åŠ¡è®°å½•` | `å¯¹è±¡å­˜å‚¨` | `1å¹´` |
| **å†°æ•°æ®** | `åˆè§„å¤‡ä»½æ•°æ®` | `ç£å¸¦åº“` | `æ°¸ä¹…` |

```java
@Service
public class LogArchiveService {
    
    /**
     * åˆ†å±‚å½’æ¡£å¤„ç†
     */
    @Scheduled(cron = "0 0 1 * * ?")  // æ¯å¤©å‡Œæ™¨1ç‚¹
    public void archiveLogs() {
        
        // 1. å½’æ¡£7-30å¤©çš„æ•°æ®åˆ°æ¸©å­˜å‚¨
        archiveToWarmStorage(7, 30);
        
        // 2. å½’æ¡£30-365å¤©çš„æ•°æ®åˆ°å†·å­˜å‚¨  
        archiveToColdStorage(30, 365);
        
        // 3. æ¸…ç†å·²å½’æ¡£çš„çƒ­æ•°æ®
        cleanupArchivedHotData();
    }
    
    private void archiveToWarmStorage(int fromDays, int toDays) {
        LocalDateTime from = LocalDateTime.now().minusDays(toDays);
        LocalDateTime to = LocalDateTime.now().minusDays(fromDays);
        
        List<GlobalTransaction> transactions = globalTableRepository
            .findByCreateTimeBetween(from, to);
            
        // å†™å…¥æ¸©å­˜å‚¨
        warmStorageRepository.batchInsert(transactions);
        
        log.info("å½’æ¡£æ¸©æ•°æ®: {} æ¡è®°å½•", transactions.size());
    }
}
```

---

## 7. ğŸš¨ å¼‚å¸¸å‘Šè­¦ç›‘æ§


### 7.1 ç›‘æ§ç³»ç»Ÿçš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Ÿ**

æƒ³è±¡ä½ å¼€è½¦æ—¶çš„ä»ªè¡¨ç›˜ï¼š
- **æ²¹é‡è¡¨**ï¼šæé†’ä½ åŠæ—¶åŠ æ²¹
- **æ°´æ¸©è¡¨**ï¼šè­¦å‘Šå¼•æ“è¿‡çƒ­  
- **æ•…éšœç¯**ï¼šæç¤ºç³»ç»Ÿå¼‚å¸¸

åˆ†å¸ƒå¼äº‹åŠ¡ç›‘æ§å°±æ˜¯**ç³»ç»Ÿçš„ä»ªè¡¨ç›˜**ï¼Œå¸®ä½ åŠæ—¶å‘ç°é—®é¢˜ã€‚

### 7.2 å…³é”®ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ æ ¸å¿ƒç›‘æ§ç»´åº¦**

```
Seataç›‘æ§ä½“ç³»ï¼š

ä¸šåŠ¡æŒ‡æ ‡                  æŠ€æœ¯æŒ‡æ ‡
â”œâ”€â”€ äº‹åŠ¡æˆåŠŸç‡            â”œâ”€â”€ å“åº”æ—¶é—´
â”œâ”€â”€ äº‹åŠ¡ååé‡            â”œâ”€â”€ èµ„æºä½¿ç”¨ç‡  
â”œâ”€â”€ å›æ»šç‡               â”œâ”€â”€ è¿æ¥æ± çŠ¶æ€
â””â”€â”€ è¶…æ—¶ç‡               â””â”€â”€ é”ç­‰å¾…æ—¶é—´
```

| **æŒ‡æ ‡ç±»åˆ«** | **å…·ä½“æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|-------------|-------------|-------------|-------------|
| **æˆåŠŸç‡** | `äº‹åŠ¡æäº¤æˆåŠŸç‡` | `> 99%` | `< 95%` |
| **æ€§èƒ½** | `äº‹åŠ¡å¹³å‡è€—æ—¶` | `< 500ms` | `> 2s` |
| **å¼‚å¸¸** | `äº‹åŠ¡å›æ»šç‡` | `< 5%` | `> 10%` |
| **èµ„æº** | `æ•°æ®åº“è¿æ¥ä½¿ç”¨ç‡` | `< 80%` | `> 90%` |

### 7.3 ç›‘æ§æ•°æ®é‡‡é›†


**ğŸ“Š æ•°æ®é‡‡é›†å®ç°**

```java
@Component
public class SeataMetricsCollector {
    
    private final MeterRegistry meterRegistry;
    private final Counter transactionCommitCounter;
    private final Counter transactionRollbackCounter;
    private final Timer transactionDurationTimer;
    
    public SeataMetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.transactionCommitCounter = Counter.builder("seata.transaction.commit")
            .description("äº‹åŠ¡æäº¤è®¡æ•°")
            .register(meterRegistry);
        this.transactionRollbackCounter = Counter.builder("seata.transaction.rollback")
            .description("äº‹åŠ¡å›æ»šè®¡æ•°")
            .register(meterRegistry);
        this.transactionDurationTimer = Timer.builder("seata.transaction.duration")
            .description("äº‹åŠ¡æ‰§è¡Œæ—¶é•¿")
            .register(meterRegistry);
    }
    
    @EventListener
    public void handleGlobalTransactionEvent(GlobalTransactionEvent event) {
        switch (event.getStatus()) {
            case COMMITTED:
                transactionCommitCounter.increment(
                    Tags.of("app", event.getApplicationId())
                );
                recordTransactionDuration(event);
                break;
                
            case ROLLBACKED:
                transactionRollbackCounter.increment(
                    Tags.of("app", event.getApplicationId(), 
                           "reason", event.getRollbackReason())
                );
                break;
        }
    }
    
    private void recordTransactionDuration(GlobalTransactionEvent event) {
        long duration = event.getEndTime() - event.getBeginTime();
        transactionDurationTimer.record(duration, TimeUnit.MILLISECONDS);
    }
}
```

### 7.4 å‘Šè­¦è§„åˆ™é…ç½®


**âš ï¸ å‘Šè­¦è§„åˆ™è®¾è®¡**

```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
  - name: seata-alerts
    rules:
      # äº‹åŠ¡å¤±è´¥ç‡è¿‡é«˜
      - alert: SeataHighFailureRate
        expr: |
          (
            rate(seata_transaction_rollback_total[5m]) / 
            rate(seata_transaction_total[5m])
          ) * 100 > 10
        for: 2m
        labels:
          severity: warning
          service: seata
        annotations:
          summary: "Seataäº‹åŠ¡å¤±è´¥ç‡è¿‡é«˜"
          description: "åº”ç”¨ {{ $labels.app }} çš„äº‹åŠ¡å¤±è´¥ç‡ä¸º {{ $value }}%"
          
      # äº‹åŠ¡å“åº”æ—¶é—´è¿‡é•¿
      - alert: SeataSlowTransaction
        expr: |
          histogram_quantile(0.95, 
            rate(seata_transaction_duration_seconds_bucket[5m])
          ) > 2
        for: 1m
        labels:
          severity: critical
          service: seata
        annotations:
          summary: "Seataäº‹åŠ¡å“åº”ç¼“æ…¢"
          description: "95%çš„äº‹åŠ¡è€—æ—¶è¶…è¿‡2ç§’"
```

### 7.5 å‘Šè­¦å¤„ç†æµç¨‹


**ğŸ”” å‘Šè­¦å“åº”æœºåˆ¶**

```java
@Service
public class AlertHandlerService {
    
    @EventListener
    public void handleSeataAlert(SeataAlertEvent alert) {
        
        switch (alert.getSeverity()) {
            case CRITICAL:
                // ä¸¥é‡å‘Šè­¦ï¼šç«‹å³é€šçŸ¥ï¼Œè‡ªåŠ¨å¤„ç†
                handleCriticalAlert(alert);
                break;
                
            case WARNING:
                // è­¦å‘Šçº§åˆ«ï¼šè®°å½•æ—¥å¿—ï¼Œå»¶è¿Ÿå¤„ç†
                handleWarningAlert(alert);
                break;
                
            case INFO:
                // ä¿¡æ¯çº§åˆ«ï¼šä»…è®°å½•
                logInfoAlert(alert);
                break;
        }
    }
    
    private void handleCriticalAlert(SeataAlertEvent alert) {
        // 1. ç«‹å³é€šçŸ¥è¿ç»´äººå‘˜
        notificationService.sendUrgentAlert(alert);
        
        // 2. å°è¯•è‡ªåŠ¨ä¿®å¤
        if (alert.getType() == AlertType.CONNECTION_POOL_EXHAUSTED) {
            connectionPoolService.expandPool();
        }
        
        // 3. è®°å½•å¤„ç†æ—¥å¿—
        alertLogService.logCriticalAlert(alert);
        
        // 4. åˆ›å»ºå·¥å•
        ticketService.createUrgentTicket(alert);
    }
}
```

**å‘Šè­¦é€šçŸ¥é…ç½®**

```yaml
# å‘Šè­¦é€šçŸ¥é…ç½®
alert:
  notification:
    # é€šçŸ¥æ¸ é“
    channels:
      - type: email
        recipients: ["ops-team@company.com"]
        enabled: true
      - type: sms  
        recipients: ["13800138000"]
        enabled: true
      - type: webhook
        url: "https://hooks.slack.com/services/xxx"
        enabled: true
        
    # é€šçŸ¥è§„åˆ™
    rules:
      critical:
        immediate: true
        channels: ["email", "sms", "webhook"]
      warning:
        delay: 5m
        channels: ["email", "webhook"]  
      info:
        delay: 1h
        channels: ["email"]
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒè¦ç‚¹


```
ğŸ”¸ é…ç½®ç®¡ç†ï¼šé›†ä¸­é…ç½®ã€ç¯å¢ƒéš”ç¦»ã€åŠ¨æ€æ›´æ–°
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ•°æ®åº“è°ƒä¼˜ã€JVMè°ƒä¼˜ã€ç½‘ç»œä¼˜åŒ–
ğŸ”¸ äº‹åŠ¡éš”ç¦»ï¼šåˆç†éš”ç¦»çº§åˆ«ã€å¹¶å‘æ§åˆ¶ã€æ­»é”é¢„é˜²
ğŸ”¸ å¹‚ç­‰å¤„ç†ï¼šé˜²é‡å¤æäº¤ã€çŠ¶æ€æœºæ§åˆ¶ã€åˆ†å¸ƒå¼é”
ğŸ”¸ è„å†™é˜²æŠ¤ï¼šå…¨å±€é”æœºåˆ¶ã€ä¹è§‚é”ã€ç‰ˆæœ¬æ§åˆ¶
ğŸ”¸ æ—¥å¿—ç»´æŠ¤ï¼šå®šæœŸæ¸…ç†ã€åˆ†å±‚å½’æ¡£ã€æ€§èƒ½ç›‘æ§
ğŸ”¸ å¼‚å¸¸ç›‘æ§ï¼šå…³é”®æŒ‡æ ‡ç›‘æ§ã€å‘Šè­¦æœºåˆ¶ã€è‡ªåŠ¨å¤„ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒvså¼€å‘ç¯å¢ƒçš„å·®å¼‚**
```
å¼€å‘ç¯å¢ƒï¼šåŠŸèƒ½å®ç°ä¼˜å…ˆï¼Œé…ç½®ç®€å•
ç”Ÿäº§ç¯å¢ƒï¼šç¨³å®šæ€§ä¼˜å…ˆï¼Œé…ç½®ä¸¥æ ¼
å…³é”®å·®å¼‚ï¼šæ€§èƒ½è¦æ±‚ã€å®‰å…¨è¦æ±‚ã€ç›‘æ§è¦æ±‚
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å±‚æ¬¡æ€ç»´**
```
åº”ç”¨å±‚ï¼šä¸šåŠ¡é€»è¾‘ä¼˜åŒ–ã€ä»£ç ä¼˜åŒ–
ä¸­é—´ä»¶å±‚ï¼šSeataé…ç½®ä¼˜åŒ–ã€è¿æ¥æ± è°ƒä¼˜  
æ•°æ®åº“å±‚ï¼šç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–
åŸºç¡€è®¾æ–½å±‚ï¼šç¡¬ä»¶é…ç½®ã€ç½‘ç»œä¼˜åŒ–
```

**ğŸ”¹ ç›‘æ§å‘Šè­¦çš„é‡è¦æ€§**
```
é¢„é˜²èƒœäºæ²»ç–—ï¼šé€šè¿‡ç›‘æ§æå‰å‘ç°é—®é¢˜
å¿«é€Ÿå“åº”ï¼šå‘Šè­¦æœºåˆ¶ç¡®ä¿åŠæ—¶å¤„ç†
æŒç»­æ”¹è¿›ï¼šé€šè¿‡ç›‘æ§æ•°æ®ä¼˜åŒ–ç³»ç»Ÿ
```

### 8.3 ç”Ÿäº§å®è·µå»ºè®®


**ğŸ’¼ éƒ¨ç½²å»ºè®®**
- **é«˜å¯ç”¨éƒ¨ç½²**ï¼šè‡³å°‘3ä¸ªSeata ServerèŠ‚ç‚¹
- **èµ„æºè§„åˆ’**ï¼šé¢„ç•™30%çš„èµ„æºå†—ä½™
- **å¤‡ä»½ç­–ç•¥**ï¼šäº‹åŠ¡æ—¥å¿—å®šæœŸå¤‡ä»½
- **ç¾å¤‡æ–¹æ¡ˆ**ï¼šè·¨æœºæˆ¿éƒ¨ç½²ï¼Œæ•°æ®åŒæ­¥

**ğŸ”§ è¿ç»´å»ºè®®**  
- **æ¸è¿›å¼ä¸Šçº¿**ï¼šç°åº¦å‘å¸ƒï¼Œé€æ­¥æ‰©é‡
- **å®šæœŸå·¡æ£€**ï¼šæ¯å‘¨æ£€æŸ¥å…³é”®æŒ‡æ ‡
- **åº”æ€¥é¢„æ¡ˆ**ï¼šåˆ¶å®šæ•…éšœå¤„ç†æµç¨‹
- **æ–‡æ¡£ç»´æŠ¤**ï¼šæ›´æ–°è¿ç»´æ‰‹å†Œ

**ğŸ“Š ç›‘æ§å»ºè®®**
- **å…¨é¢ç›‘æ§**ï¼šä¸šåŠ¡æŒ‡æ ‡+æŠ€æœ¯æŒ‡æ ‡
- **åˆ†å±‚å‘Šè­¦**ï¼šä¸åŒçº§åˆ«ä¸åŒå¤„ç†æ–¹å¼
- **è¶‹åŠ¿åˆ†æ**ï¼šå…³æ³¨æŒ‡æ ‡å˜åŒ–è¶‹åŠ¿
- **å®šæœŸè¯„ä¼°**ï¼šè°ƒæ•´ç›‘æ§é˜ˆå€¼

### 8.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**âš ï¸ ç”Ÿäº§å¸¸è§é—®é¢˜**

| **é—®é¢˜ç±»å‹** | **ç°è±¡** | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|-------------|---------|---------|-------------|
| **æ€§èƒ½ä¸‹é™** | `äº‹åŠ¡è€—æ—¶å¢åŠ ` | `æ•°æ®åº“è¿æ¥ä¸è¶³` | `è°ƒæ•´è¿æ¥æ± é…ç½®` |
| **å†…å­˜æ³„éœ²** | `å†…å­˜ä½¿ç”¨æŒç»­å¢é•¿` | `æ—¥å¿—æœªæ¸…ç†` | `å¯ç”¨è‡ªåŠ¨æ¸…ç†` |
| **äº‹åŠ¡å¤±è´¥** | `å›æ»šç‡çªç„¶å‡é«˜` | `ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸` | `ç†”æ–­é™çº§å¤„ç†` |
| **æ­»é”é—®é¢˜** | `äº‹åŠ¡é•¿æ—¶é—´ç­‰å¾…` | `é”è¶…æ—¶æ—¶é—´è¿‡é•¿` | `è°ƒæ•´è¶…æ—¶é…ç½®` |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç”Ÿäº§ç¯å¢ƒé…ç½®è¦ä¸¥æ ¼ï¼Œæ€§èƒ½ç›‘æ§è¦å…¨é¢
- å¹‚ç­‰æ€§å¤„ç†æ˜¯å…³é”®ï¼Œè„å†™é˜²æŠ¤ä¸èƒ½å¿½è§†  
- æ—¥å¿—æ¸…ç†è¦åŠæ—¶ï¼Œå¼‚å¸¸å‘Šè­¦è¦å‡†ç¡®
- é—®é¢˜é¢„é˜²èƒœæ²»ç–—ï¼ŒæŒç»­ä¼˜åŒ–æ˜¯ç‹é“