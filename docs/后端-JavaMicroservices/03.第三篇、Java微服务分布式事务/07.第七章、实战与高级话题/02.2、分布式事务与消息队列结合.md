---
title: 2ã€åˆ†å¸ƒå¼äº‹åŠ¡ä¸æ¶ˆæ¯é˜Ÿåˆ—ç»“åˆ
---
## ğŸ“š ç›®å½•

1. [åŸºç¡€æ¦‚å¿µç†è§£](#1-åŸºç¡€æ¦‚å¿µç†è§£)
2. [äº‹åŠ¡æ¶ˆæ¯è¯¦è§£](#2-äº‹åŠ¡æ¶ˆæ¯è¯¦è§£)
3. [å¯é æ¶ˆæ¯æ¨¡å¼](#3-å¯é æ¶ˆæ¯æ¨¡å¼)
4. [æœ€ç»ˆä¸€è‡´æ€§å®ç°](#4-æœ€ç»ˆä¸€è‡´æ€§å®ç°)
5. [åŠæ¶ˆæ¯æœºåˆ¶](#5-åŠæ¶ˆæ¯æœºåˆ¶)
6. [MQäº‹åŠ¡å›æŸ¥æœºåˆ¶](#6-MQäº‹åŠ¡å›æŸ¥æœºåˆ¶)
7. [æ¶ˆæ¯é‡å¤æ¶ˆè´¹å¤„ç†](#7-æ¶ˆæ¯é‡å¤æ¶ˆè´¹å¤„ç†)
8. [æ¶ˆæ¯ä¸¢å¤±å¤„ç†æ–¹æ¡ˆ](#8-æ¶ˆæ¯ä¸¢å¤±å¤„ç†æ–¹æ¡ˆ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åŸºç¡€æ¦‚å¿µç†è§£


### 1.1 ä¸ºä»€ä¹ˆè¦ç»“åˆæ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ


æƒ³è±¡ä¸€ä¸ªç°å®åœºæ™¯ï¼šä½ åœ¨ç½‘ä¸Šä¹°ä¸œè¥¿ï¼Œéœ€è¦åŒæ—¶å®Œæˆ**æ‰£æ¬¾**å’Œ**å‡åº“å­˜**ä¸¤ä¸ªæ“ä½œã€‚å¦‚æœç›´æ¥è°ƒç”¨ï¼Œä¸€æ—¦æŸä¸ªç¯èŠ‚å‡ºé”™ï¼Œå°±å¯èƒ½å‡ºç°é’±æ‰£äº†ä½†åº“å­˜æ²¡å‡ï¼Œæˆ–è€…åº“å­˜å‡äº†ä½†æ‰£æ¬¾å¤±è´¥çš„é—®é¢˜ã€‚

```
ä¼ ç»ŸåŒæ­¥è°ƒç”¨çš„é—®é¢˜ï¼š
ç”¨æˆ·ä¸‹å• â†’ æ‰£æ¬¾æœåŠ¡ â†’ åº“å­˜æœåŠ¡
            â†“           â†“
          æˆåŠŸäº†      å¤±è´¥äº†âŒ
       
ç»“æœï¼šé’±æ‰£äº†ï¼Œä½†åº“å­˜æ²¡å‡ â†’ æ•°æ®ä¸ä¸€è‡´ï¼
```

**æ¶ˆæ¯é˜Ÿåˆ—çš„è§£å†³æ€è·¯**ï¼š
- ä¸ç›´æ¥è°ƒç”¨æœåŠ¡ï¼Œè€Œæ˜¯**å‘æ¶ˆæ¯**é€šçŸ¥å…¶ä»–æœåŠ¡
- æ¶ˆæ¯å¯ä»¥**æŒä¹…åŒ–å­˜å‚¨**ï¼Œä¸ä¼šå› ä¸ºç½‘ç»œé—®é¢˜ä¸¢å¤±
- å„ä¸ªæœåŠ¡**å¼‚æ­¥å¤„ç†**ï¼Œé™ä½ç³»ç»Ÿè€¦åˆåº¦
- é€šè¿‡æ¶ˆæ¯æœºåˆ¶ä¿è¯**æœ€ç»ˆä¸€è‡´æ€§**

### 1.2 æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”


| æ¦‚å¿µ | **ä¼ ç»Ÿæ–¹å¼** | **æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼** |
|------|-------------|-----------------|
| **é€šä¿¡æ–¹å¼** | `ç›´æ¥è°ƒç”¨API` | `å‘é€æ¶ˆæ¯é€šçŸ¥` |
| **ä¸€è‡´æ€§** | `å¼ºä¸€è‡´æ€§è¦æ±‚` | `æœ€ç»ˆä¸€è‡´æ€§` |
| **è€¦åˆåº¦** | `ç´§è€¦åˆ` | `æ¾è€¦åˆ` |
| **æ•…éšœå¤„ç†** | `åŒæ­¥å›æ»š` | `å¼‚æ­¥é‡è¯•` |

### 1.3 é€‚ç”¨åœºæ™¯åˆ¤æ–­


**âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯ï¼š**
- å¯¹**å®æ—¶æ€§**è¦æ±‚ä¸é‚£ä¹ˆä¸¥æ ¼çš„ä¸šåŠ¡
- éœ€è¦**è§£è€¦**ä¸åŒç³»ç»Ÿçš„åœºæ™¯
- æœ‰**é«˜å¹¶å‘**å¤„ç†éœ€æ±‚
- èƒ½æ¥å—**æœ€ç»ˆä¸€è‡´æ€§**çš„ä¸šåŠ¡

**âŒ ä¸é€‚åˆçš„åœºæ™¯ï¼š**
- å¿…é¡»**ç«‹å³çŸ¥é“ç»“æœ**çš„æ“ä½œ
- **å¼ºä¸€è‡´æ€§**è¦æ±‚çš„åœºæ™¯ï¼ˆå¦‚è½¬è´¦ï¼‰
- ä¸šåŠ¡é€»è¾‘**éå¸¸ç®€å•**çš„åœºæ™¯

---

## 2. ğŸ“¨ äº‹åŠ¡æ¶ˆæ¯è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡æ¶ˆæ¯ï¼Ÿ


**é€šä¿—è§£é‡Š**ï¼šäº‹åŠ¡æ¶ˆæ¯å°±æ˜¯æŠŠ**æœ¬åœ°äº‹åŠ¡**å’Œ**å‘é€æ¶ˆæ¯**ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚

```
æ™®é€šæ¶ˆæ¯å‘é€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬åœ°äº‹åŠ¡    â”‚    â”‚  å‘é€æ¶ˆæ¯    â”‚
â”‚   æ“ä½œ      â”‚    â”‚   æ“ä½œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ å¯èƒ½æˆåŠŸ        â†“ å¯èƒ½å¤±è´¥
  æ•°æ®ä¸ä¸€è‡´çš„é£é™©ï¼

äº‹åŠ¡æ¶ˆæ¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç»‘å®šåœ¨ä¸€èµ·æ‰§è¡Œ           â”‚
â”‚  æœ¬åœ°äº‹åŠ¡ + å‘é€æ¶ˆæ¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥
      ä¿è¯ä¸€è‡´æ€§ï¼
```

### 2.2 äº‹åŠ¡æ¶ˆæ¯çš„å·¥ä½œåŸç†


```
äº‹åŠ¡æ¶ˆæ¯æ‰§è¡Œæµç¨‹ï¼š

ç”Ÿäº§è€…                    MQæœåŠ¡å™¨                 æ¶ˆè´¹è€…
   â”‚                        â”‚                       â”‚
   â”‚â”€â”€â‘ å‘é€Halfæ¶ˆæ¯â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                       â”‚
   â”‚                        â”‚                       â”‚
   â”‚â†â”€â‘¡è¿”å›æ¶ˆæ¯IDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
   â”‚                        â”‚                       â”‚
   â”‚â”€â”€â‘¢æ‰§è¡Œæœ¬åœ°äº‹åŠ¡â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
   â”‚                        â”‚                       â”‚
   â”‚â”€â”€â‘£æäº¤/å›æ»šæ¶ˆæ¯â”€â”€â”€â”€â”€â”€â†’â”‚                       â”‚
   â”‚                        â”‚                       â”‚
   â”‚                        â”‚â”€â”€â‘¤æ¶ˆæ¯å˜ä¸ºå¯è§â”€â”€â”€â”€â”€â”€â†’â”‚æ¶ˆè´¹å¤„ç†
```

**å„æ­¥éª¤è¯¦è§£ï¼š**
1. **â‘ Halfæ¶ˆæ¯**ï¼šå…ˆå‘ä¸€ä¸ª"å‡†å¤‡æ¶ˆæ¯"ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…çœ‹ä¸åˆ°
2. **â‘¡æ¶ˆæ¯ID**ï¼šMQè¿”å›æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåç»­æ“ä½œ
3. **â‘¢æœ¬åœ°äº‹åŠ¡**ï¼šæ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ‰£æ¬¾ï¼‰
4. **â‘£æäº¤å†³å®š**ï¼šæœ¬åœ°äº‹åŠ¡æˆåŠŸå°±æäº¤æ¶ˆæ¯ï¼Œå¤±è´¥å°±åˆ é™¤æ¶ˆæ¯
5. **â‘¤æ¶ˆæ¯å¯è§**ï¼šåªæœ‰æäº¤åï¼Œæ¶ˆè´¹è€…æ‰èƒ½çœ‹åˆ°å¹¶å¤„ç†æ¶ˆæ¯

### 2.3 äº‹åŠ¡æ¶ˆæ¯ä»£ç ç¤ºä¾‹


```java
// è®¢å•æœåŠ¡å‘é€äº‹åŠ¡æ¶ˆæ¯
@Service
public class OrderService {
    
    @Autowired
    private RocketMQTemplate rocketMQTemplate;
    
    public void createOrder(OrderInfo order) {
        // å‘é€äº‹åŠ¡æ¶ˆæ¯
        rocketMQTemplate.sendMessageInTransaction(
            "order-topic",           // ä¸»é¢˜
            order,                   // æ¶ˆæ¯å†…å®¹
            order.getOrderId()       // äº‹åŠ¡æ£€æŸ¥çš„å‚æ•°
        );
    }
    
    // æ‰§è¡Œæœ¬åœ°äº‹åŠ¡
    @RocketMQTransactionListener
    public class OrderTransactionListener {
        
        public RocketMQLocalTransactionState executeLocalTransaction(
                Message msg, Object arg) {
            try {
                String orderId = (String) arg;
                
                // æ‰§è¡Œæœ¬åœ°ä¸šåŠ¡ï¼šåˆ›å»ºè®¢å•ã€æ‰£æ¬¾ç­‰
                orderMapper.createOrder(orderId);
                accountService.deductBalance(orderId);
                
                return RocketMQLocalTransactionState.COMMIT;  // æäº¤æ¶ˆæ¯
            } catch (Exception e) {
                return RocketMQLocalTransactionState.ROLLBACK; // å›æ»šæ¶ˆæ¯
            }
        }
    }
}
```

---

## 3. ğŸ”„ å¯é æ¶ˆæ¯æ¨¡å¼


### 3.1 å¯é æ¶ˆæ¯æ˜¯ä»€ä¹ˆï¼Ÿ


**ç®€å•ç†è§£**ï¼šå¯é æ¶ˆæ¯å°±æ˜¯ç¡®ä¿æ¶ˆæ¯**ä¸€å®šèƒ½é€åˆ°**ä¸”**ä¸ä¼šä¸¢å¤±**çš„æ¶ˆæ¯ä¼ é€’æ–¹å¼ã€‚

å°±åƒå¯„å¿«é€’ä¸€æ ·ï¼š
- **æ™®é€šå¿«é€’**ï¼šå¯„å‡ºå»å°±ä¸ç®¡äº†ï¼Œå¯èƒ½ä¸¢å¤±
- **æŒ‚å·ä¿¡**ï¼šæœ‰ç­¾æ”¶ç¡®è®¤ï¼Œç¡®ä¿é€è¾¾ â† è¿™å°±æ˜¯å¯é æ¶ˆæ¯

### 3.2 å¯é æ¶ˆæ¯çš„å®ç°è¦ç´ 


```
å¯é æ¶ˆæ¯çš„ä¸‰ä¸ªå…³é”®è¦ç´ ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¯é æ¶ˆæ¯ä¿éšœ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ æ¶ˆæ¯æŒä¹…åŒ–   â”‚  æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜      â”‚
â”‚  ğŸ”„ é‡è¯•æœºåˆ¶     â”‚  å¤±è´¥è‡ªåŠ¨é‡å‘        â”‚
â”‚  âœ… ç¡®è®¤æœºåˆ¶     â”‚  æ¶ˆè´¹æˆåŠŸæ‰åˆ é™¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŒä¹…åŒ–å­˜å‚¨**ï¼š
- æ¶ˆæ¯å†™å…¥ç£ç›˜ï¼ŒæœåŠ¡å™¨é‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±
- ç±»ä¼¼äºæ•°æ®åº“çš„æŒä¹…åŒ–å­˜å‚¨æ¦‚å¿µ

**é‡è¯•æœºåˆ¶**ï¼š
- å‘é€å¤±è´¥è‡ªåŠ¨é‡è¯•
- æ¶ˆè´¹å¤±è´¥ä¹Ÿä¼šé‡æ–°æŠ•é€’

**ç¡®è®¤æœºåˆ¶**ï¼š
- ç”Ÿäº§è€…ç¡®è®¤ï¼šæ¶ˆæ¯æˆåŠŸå­˜å‚¨åˆ°MQ
- æ¶ˆè´¹è€…ç¡®è®¤ï¼šæ¶ˆæ¯æˆåŠŸå¤„ç†å®Œæ¯•

### 3.3 å¯é æ¶ˆæ¯å¤„ç†æµç¨‹


```
å®Œæ•´çš„å¯é æ¶ˆæ¯æµç¨‹ï¼š

ç”Ÿäº§è€…           MQæœåŠ¡å™¨          æ¶ˆè´¹è€…
   â”‚                â”‚               â”‚
   â”‚â”€â‘ å‘é€æ¶ˆæ¯â”€â”€â”€â”€â”€â†’â”‚               â”‚
   â”‚                â”‚               â”‚
   â”‚â†â‘¡å‘é€ç¡®è®¤â”€â”€â”€â”€â”€â”‚               â”‚ (ç”Ÿäº§è€…å¯é æ€§)
   â”‚                â”‚               â”‚
   â”‚                â”‚â”€â‘¢æŠ•é€’æ¶ˆæ¯â”€â”€â”€â”€â†’â”‚
   â”‚                â”‚               â”‚
   â”‚                â”‚â†â‘£æ¶ˆè´¹ç¡®è®¤â”€â”€â”€â”€â”‚ (æ¶ˆè´¹è€…å¯é æ€§)
   â”‚                â”‚               â”‚
   â”‚                â”‚â”€â‘¤åˆ é™¤æ¶ˆæ¯â”€â”€â”€â”€â”€  (å­˜å‚¨å¯é æ€§)
```

---

## 4. ğŸ¯ æœ€ç»ˆä¸€è‡´æ€§å®ç°


### 4.1 ä»€ä¹ˆæ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Ÿ


**é€šä¿—æ¯”å–»**ï¼šå°±åƒé“¶è¡Œè½¬è´¦ï¼Œè™½ç„¶ä¸æ˜¯ç¬é—´åˆ°è´¦ï¼Œä½†æœ€ç»ˆè‚¯å®šä¼šåˆ°è´¦ã€‚

```
å¼ºä¸€è‡´æ€§ vs æœ€ç»ˆä¸€è‡´æ€§ï¼š

å¼ºä¸€è‡´æ€§ï¼ˆåŒæ­¥ï¼‰ï¼š
Aè´¦æˆ· -100å…ƒ  â†â†’  Bè´¦æˆ· +100å…ƒ
    åŒæ—¶å‘ç”Ÿï¼Œç«‹å³ç”Ÿæ•ˆ

æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¼‚æ­¥ï¼‰ï¼š
Aè´¦æˆ· -100å…ƒ  â†’  æ¶ˆæ¯é˜Ÿåˆ—  â†’  Bè´¦æˆ· +100å…ƒ
 ç«‹å³ç”Ÿæ•ˆ         å»¶è¿Ÿ        ç¨åç”Ÿæ•ˆ
```

**å…³é”®ç‰¹ç‚¹**ï¼š
- **ä¸æ˜¯ç«‹å³ä¸€è‡´**ï¼Œä½†**æœ€ç»ˆä¼šä¸€è‡´**
- ä¸­é—´å¯èƒ½å­˜åœ¨**çŸ­æš‚çš„ä¸ä¸€è‡´çŠ¶æ€**
- é€šè¿‡**æ¶ˆæ¯é‡è¯•**å’Œ**è¡¥å¿æœºåˆ¶**ä¿è¯æœ€ç»ˆä¸€è‡´

### 4.2 æœ€ç»ˆä¸€è‡´æ€§çš„å®ç°ç­–ç•¥


#### ğŸ“Š æ ¸å¿ƒç­–ç•¥å¯¹æ¯”


| ç­–ç•¥ | **å®ç°æ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|------|-------------|-------------|-----------|
| **ğŸ”„ é‡è¯•è¡¥å¿** | `å¤±è´¥é‡è¯•ç›´åˆ°æˆåŠŸ` | `ç½‘ç»œä¸ç¨³å®šç¯å¢ƒ` | `ç®€å•å¯é ï¼Œä½†å¯èƒ½å»¶è¿Ÿè¾ƒé•¿` |
| **ğŸ“… å®šæ—¶å¯¹è´¦** | `å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§` | `æ‰¹å¤„ç†ä¸šåŠ¡` | `å¯é ä½†å®æ—¶æ€§å·®` |
| **ğŸ” çŠ¶æ€æŸ¥è¯¢** | `ä¸»åŠ¨æŸ¥è¯¢å¤„ç†çŠ¶æ€` | `çŠ¶æ€æ˜ç¡®çš„ä¸šåŠ¡` | `å®æ—¶ä½†å¢åŠ ç³»ç»Ÿè´Ÿæ‹…` |

#### ğŸ”„ é‡è¯•è¡¥å¿ç¤ºä¾‹


```java
@Component
public class ConsistencyService {
    
    // æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥æ—¶çš„é‡è¯•é€»è¾‘
    @RetryableTopic(attempts = "3", delay = "2s")  
    @KafkaListener(topics = "order-topic")
    public void handleOrderMessage(OrderMessage msg) {
        try {
            // å¤„ç†åº“å­˜æ‰£å‡
            inventoryService.reduceStock(msg.getProductId(), msg.getQuantity());
            
        } catch (InsufficientStockException e) {
            // åº“å­˜ä¸è¶³ï¼Œå‘é€è¡¥å¿æ¶ˆæ¯
            sendCompensationMessage(msg);
            throw e; // è§¦å‘é‡è¯•
        }
    }
    
    private void sendCompensationMessage(OrderMessage msg) {
        // å‘é€è®¢å•å–æ¶ˆæ¶ˆæ¯
        CompensationMessage compensation = new CompensationMessage();
        compensation.setOrderId(msg.getOrderId());
        compensation.setAction("CANCEL_ORDER");
        
        kafkaTemplate.send("compensation-topic", compensation);
    }
}
```

### 4.3 æœ€ç»ˆä¸€è‡´æ€§ç›‘æ§


```
ä¸€è‡´æ€§çŠ¶æ€ç›‘æ§ï¼š

æ•°æ®çŠ¶æ€æ£€æŸ¥ç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¢å•åˆ›å»º   â”‚â†’ â”‚   æ”¯ä»˜å®Œæˆ   â”‚â†’ â”‚   åº“å­˜æ‰£å‡   â”‚
â”‚   âœ… æˆåŠŸ   â”‚  â”‚   âœ… æˆåŠŸ   â”‚  â”‚   âŒ å¤±è´¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â†“
                                 âš ï¸ æ£€æµ‹åˆ°ä¸ä¸€è‡´
                                        â†“
                                  ğŸ”„ è§¦å‘è¡¥å¿æœºåˆ¶
```

---

## 5. ğŸŒ— åŠæ¶ˆæ¯æœºåˆ¶


### 5.1 åŠæ¶ˆæ¯çš„æ¦‚å¿µ


**å½¢è±¡æ¯”å–»**ï¼šåŠæ¶ˆæ¯å°±åƒ"è‰ç¨¿é‚®ä»¶"ï¼Œå†™å¥½äº†ä½†è¿˜æ²¡æ­£å¼å‘é€ï¼Œæ”¶ä»¶äººçœ‹ä¸åˆ°ã€‚

```
æ¶ˆæ¯çš„ä¸‰ç§çŠ¶æ€ï¼š

ğŸ“ åŠæ¶ˆæ¯ï¼ˆPrepareï¼‰     ğŸ“¨ æ­£å¼æ¶ˆæ¯ï¼ˆCommitï¼‰    ğŸ—‘ï¸ åˆ é™¤æ¶ˆæ¯ï¼ˆRollbackï¼‰
â”œ å·²å†™å…¥MQ              â”œ æ¶ˆè´¹è€…å¯è§             â”œ å½»åº•åˆ é™¤
â”œ æ¶ˆè´¹è€…çœ‹ä¸åˆ°          â”œ å¯ä»¥è¢«æ¶ˆè´¹             â”œ ä¸ä¼šè¢«æ¶ˆè´¹
â”” ç­‰å¾…ç¡®è®¤              â”” æ­£å¸¸å¤„ç†               â”” é‡Šæ”¾èµ„æº
```

### 5.2 åŠæ¶ˆæ¯çš„å·¥ä½œæœºåˆ¶


```
åŠæ¶ˆæ¯å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

æ—¶åˆ»    æ“ä½œ                    æ¶ˆæ¯çŠ¶æ€           æ¶ˆè´¹è€…æ˜¯å¦å¯è§
T1  â”€â”€â†’ å‘é€åŠæ¶ˆæ¯           â”€â”€â†’  Prepare     â”€â”€â†’     âŒ ä¸å¯è§
T2  â”€â”€â†’ æ‰§è¡Œæœ¬åœ°äº‹åŠ¡         â”€â”€â†’  Processing â”€â”€â†’     âŒ ä¸å¯è§
T3  â”€â”€â†’ äº‹åŠ¡æˆåŠŸ/å¤±è´¥        â”€â”€â†’  Commit/Rollback    
T4  â”€â”€â†’ æ¶ˆæ¯æäº¤/åˆ é™¤        â”€â”€â†’  Visible/Deleted â”€â”€â†’ âœ…å¯è§/âŒåˆ é™¤
```

### 5.3 åŠæ¶ˆæ¯ä½¿ç”¨åœºæ™¯


**ğŸ’¡ å…¸å‹åº”ç”¨ï¼šç”µå•†ä¸‹å•æµç¨‹**

```java
@Service
public class OrderTransactionService {
    
    public void processOrder(OrderDTO order) {
        // ç¬¬ä¸€é˜¶æ®µï¼šå‘é€åŠæ¶ˆæ¯
        String msgId = messageProducer.sendHalfMessage("order-topic", order);
        
        try {
            // ç¬¬äºŒé˜¶æ®µï¼šæ‰§è¡Œæœ¬åœ°äº‹åŠ¡
            // 1. åˆ›å»ºè®¢å•è®°å½•
            orderService.createOrder(order);
            // 2. æ‰£å‡ç”¨æˆ·ä½™é¢  
            accountService.deductBalance(order.getUserId(), order.getAmount());
            // 3. è®°å½•äº‹åŠ¡æ—¥å¿—
            transactionLogService.recordSuccess(msgId);
            
            // ç¬¬ä¸‰é˜¶æ®µï¼šæäº¤æ¶ˆæ¯ï¼ˆæ¶ˆè´¹è€…ç°åœ¨å¯ä»¥çœ‹åˆ°äº†ï¼‰
            messageProducer.commitMessage(msgId);
            
        } catch (Exception e) {
            // æœ¬åœ°äº‹åŠ¡å¤±è´¥ï¼Œå›æ»šæ¶ˆæ¯
            messageProducer.rollbackMessage(msgId);
            throw e;
        }
    }
}
```

---

## 6. ğŸ” MQäº‹åŠ¡å›æŸ¥æœºåˆ¶


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦å›æŸ¥æœºåˆ¶ï¼Ÿ


**é—®é¢˜åœºæ™¯**ï¼šå¦‚æœå‘é€åŠæ¶ˆæ¯åï¼Œç¨‹åºçªç„¶å´©æºƒäº†æ€ä¹ˆåŠï¼Ÿ

```
å¼‚å¸¸æƒ…å†µåˆ†æï¼š

æ­£å¸¸æµç¨‹ï¼š
å‘é€åŠæ¶ˆæ¯ â†’ æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ â†’ æäº¤/å›æ»šæ¶ˆæ¯ âœ…

å¼‚å¸¸æƒ…å†µï¼š
å‘é€åŠæ¶ˆæ¯ â†’ æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ â†’ ğŸ’¥ç¨‹åºå´©æºƒ
                              â†“
                        æ¶ˆæ¯å¡åœ¨åŠæ¶ˆæ¯çŠ¶æ€
                        MQä¸çŸ¥é“è¯¥æ€ä¹ˆå¤„ç†...
```

**å›æŸ¥æœºåˆ¶çš„ä½œç”¨**ï¼šMQä¸»åŠ¨"è¯¢é—®"ä¸šåŠ¡ç³»ç»Ÿï¼š"è¿™ä¸ªåŠæ¶ˆæ¯åˆ°åº•è¦ä¸è¦å‘é€ï¼Ÿ"

### 6.2 å›æŸ¥æœºåˆ¶å·¥ä½œæµç¨‹


```
MQäº‹åŠ¡å›æŸ¥å®Œæ•´æµç¨‹ï¼š

ä¸šåŠ¡ç³»ç»Ÿ              MQæœåŠ¡å™¨
    â”‚                    â”‚
    â”‚â”€â‘ å‘é€åŠæ¶ˆæ¯â”€â”€â”€â”€â”€â”€â”€â†’â”‚ (æ¶ˆæ¯çŠ¶æ€: Prepare)
    â”‚                    â”‚
    â”‚â”€â‘¡æ‰§è¡Œæœ¬åœ°äº‹åŠ¡â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                    â”‚
ğŸ’¥  â”‚ ç¨‹åºå¼‚å¸¸é€€å‡º         â”‚ â° (è¶…æ—¶æ£€æµ‹)
    â”‚                    â”‚
    â”‚â†â‘¢å›æŸ¥è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ "è¿™ä¸ªæ¶ˆæ¯è¦ä¸è¦å‘ï¼Ÿ"
    â”‚                    â”‚
    â”‚â”€â‘£æŸ¥è¯¢æœ¬åœ°äº‹åŠ¡çŠ¶æ€â”€â”€â†’â”‚ 
    â”‚                    â”‚
    â”‚â”€â‘¤è¿”å›Commit/Rollbackâ”‚
    â”‚                    â”‚
    â”‚                    â”‚ â‘¥æ ¹æ®ç»“æœå¤„ç†æ¶ˆæ¯
```

### 6.3 å›æŸ¥å®ç°ç¤ºä¾‹


```java
@RocketMQTransactionListener
public class OrderTransactionListener implements RocketMQLocalTransactionListener {
    
    @Autowired
    private TransactionLogService logService;
    
    // æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ
    @Override
    public RocketMQLocalTransactionState executeLocalTransaction(
            Message msg, Object arg) {
        try {
            String transactionId = msg.getKeys();
            
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            processOrderBusiness(transactionId);
            
            // è®°å½•äº‹åŠ¡æˆåŠŸæ—¥å¿—
            logService.recordCommit(transactionId);
            
            return RocketMQLocalTransactionState.COMMIT;
            
        } catch (Exception e) {
            return RocketMQLocalTransactionState.ROLLBACK;
        }
    }
    
    // MQå›æŸ¥æ—¶è°ƒç”¨æ­¤æ–¹æ³•
    @Override
    public RocketMQLocalTransactionState checkLocalTransaction(Message msg) {
        String transactionId = msg.getKeys();
        
        // æŸ¥è¯¢æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€
        TransactionStatus status = logService.queryStatus(transactionId);
        
        switch (status) {
            case SUCCESS:
                return RocketMQLocalTransactionState.COMMIT;    // ç¡®è®¤å‘é€
            case FAILED:
                return RocketMQLocalTransactionState.ROLLBACK;  // ç¡®è®¤å›æ»š
            default:
                return RocketMQLocalTransactionState.UNKNOW;    // ç»§ç»­ç­‰å¾…
        }
    }
}
```

---

## 7. ğŸ”„ æ¶ˆæ¯é‡å¤æ¶ˆè´¹å¤„ç†


### 7.1 ä¸ºä»€ä¹ˆä¼šé‡å¤æ¶ˆè´¹ï¼Ÿ


**å¸¸è§åŸå› ï¼š**
```
é‡å¤æ¶ˆè´¹çš„äº§ç”ŸåŸå› ï¼š

ç½‘ç»œé—®é¢˜å¯¼è‡´ï¼š
æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯ â†’ å‘é€ACKç¡®è®¤ â†’ ğŸ’¥ç½‘ç»œè¶…æ—¶
                                    â†“
                              MQæ²¡æ”¶åˆ°ç¡®è®¤
                                    â†“  
                              é‡æ–°æŠ•é€’æ¶ˆæ¯ â†’ é‡å¤æ¶ˆè´¹

ç³»ç»Ÿé‡å¯å¯¼è‡´ï¼š
æ¶ˆè´¹è€…æ­£åœ¨å¤„ç†æ¶ˆæ¯ â†’ ğŸ’¥ç³»ç»Ÿé‡å¯
                        â†“
                   æ¶ˆæ¯é‡æ–°æŠ•é€’ â†’ é‡å¤æ¶ˆè´¹
```

### 7.2 å¹‚ç­‰æ€§è®¾è®¡åŸåˆ™


**ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿ**
> åŒä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤šæ¬¡ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„

```
å¹‚ç­‰æ“ä½œ vs éå¹‚ç­‰æ“ä½œï¼š

âœ… å¹‚ç­‰æ“ä½œç¤ºä¾‹ï¼š
â€¢ è®¾ç½®ç”¨æˆ·çŠ¶æ€ä¸º"å·²æ¿€æ´»" â†’ æ‰§è¡Œå¤šæ¬¡ç»“æœç›¸åŒ
â€¢ åˆ é™¤æŒ‡å®šè®°å½• â†’ åˆ é™¤å¤šæ¬¡æ•ˆæœä¸€æ ·
â€¢ æŸ¥è¯¢æ“ä½œ â†’ å¤©ç„¶å¹‚ç­‰

âŒ éå¹‚ç­‰æ“ä½œç¤ºä¾‹ï¼š  
â€¢ è´¦æˆ·ä½™é¢ +10å…ƒ â†’ æ‰§è¡Œå¤šæ¬¡ä½™é¢ä¼šç´¯åŠ 
â€¢ å‘é€çŸ­ä¿¡é€šçŸ¥ â†’ æ‰§è¡Œå¤šæ¬¡ç”¨æˆ·æ”¶åˆ°å¤šæ¡çŸ­ä¿¡
â€¢ åˆ›å»ºè®¢å•è®°å½• â†’ æ‰§è¡Œå¤šæ¬¡ä¼šäº§ç”Ÿé‡å¤è®¢å•
```

### 7.3 å¹‚ç­‰æ€§å®ç°æ–¹æ¡ˆ


#### æ–¹æ¡ˆä¸€ï¼šå”¯ä¸€é”®çº¦æŸ


```java
@Service
public class PaymentService {
    
    @KafkaListener(topics = "payment-topic")
    public void processPayment(PaymentMessage msg) {
        
        PaymentRecord record = new PaymentRecord();
        record.setPaymentId(msg.getPaymentId());  // å”¯ä¸€æ ‡è¯†
        record.setAmount(msg.getAmount());
        record.setUserId(msg.getUserId());
        
        try {
            // æ•°æ®åº“è®¾ç½®paymentIdä¸ºå”¯ä¸€é”®
            paymentMapper.insertPayment(record);
            
        } catch (DuplicateKeyException e) {
            // é‡å¤æ¶ˆè´¹ï¼Œç›´æ¥å¿½ç•¥
            log.info("é‡å¤æ”¯ä»˜æ¶ˆæ¯ï¼Œå¿½ç•¥å¤„ç†: {}", msg.getPaymentId());
            return;
        }
        
        // æ­£å¸¸ä¸šåŠ¡é€»è¾‘
        updateAccountBalance(msg.getUserId(), msg.getAmount());
    }
}
```

#### æ–¹æ¡ˆäºŒï¼šRedisåˆ†å¸ƒå¼é”


```java
@Component
public class IdempotentHandler {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean tryLock(String messageId, long timeoutSeconds) {
        String lockKey = "msg_lock:" + messageId;
        
        // è®¾ç½®åˆ†å¸ƒå¼é”ï¼Œè¿‡æœŸæ—¶é—´é˜²æ­¢æ­»é”
        Boolean success = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "1", Duration.ofSeconds(timeoutSeconds));
        
        return Boolean.TRUE.equals(success);
    }
    
    @KafkaListener(topics = "order-topic")  
    public void handleOrder(OrderMessage msg) {
        String messageId = msg.getMessageId();
        
        // å°è¯•è·å–é”
        if (!tryLock(messageId, 300)) {
            log.info("æ¶ˆæ¯æ­£åœ¨å¤„ç†ä¸­æˆ–å·²å¤„ç†: {}", messageId);
            return;
        }
        
        try {
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            processOrderLogic(msg);
            
        } finally {
            // å¤„ç†å®Œæˆï¼Œåˆ é™¤é”
            redisTemplate.delete("msg_lock:" + messageId);
        }
    }
}
```

---

## 8. ğŸš¨ æ¶ˆæ¯ä¸¢å¤±å¤„ç†æ–¹æ¡ˆ


### 8.1 æ¶ˆæ¯ä¸¢å¤±çš„ç¯èŠ‚åˆ†æ


```
æ¶ˆæ¯ä¼ é€’çš„ä¸‰ä¸ªç¯èŠ‚åŠä¸¢å¤±é£é™©ï¼š

ç”Ÿäº§è€… â”€â”€â”€â”€â”€â†’ MQæœåŠ¡å™¨ â”€â”€â”€â”€â”€â†’ æ¶ˆè´¹è€…
   â”‚              â”‚              â”‚
   â–¼              â–¼              â–¼
ä¸¢å¤±é£é™©1:       ä¸¢å¤±é£é™©2:      ä¸¢å¤±é£é™©3:
å‘é€å¤±è´¥        å­˜å‚¨æ•…éšœ        æ¶ˆè´¹å¤±è´¥
ç½‘ç»œè¶…æ—¶        æœåŠ¡å™¨å®•æœº       ç¨‹åºå¼‚å¸¸
```

### 8.2 ç”Ÿäº§è€…ç«¯å¯é æ€§ä¿éšœ


#### ğŸ“¤ å‘é€ç¡®è®¤æœºåˆ¶


```java
@Service
public class ReliableMessageProducer {
    
    @Autowired
    private RocketMQTemplate rocketMQTemplate;
    
    public void sendReliableMessage(String topic, Object message) {
        
        // åŒæ­¥å‘é€ï¼Œç­‰å¾…ç¡®è®¤
        SendResult result = rocketMQTemplate.syncSend(topic, message);
        
        // æ£€æŸ¥å‘é€ç»“æœ
        if (result.getSendStatus() == SendStatus.SEND_OK) {
            log.info("æ¶ˆæ¯å‘é€æˆåŠŸ: {}", result.getMsgId());
        } else {
            // å‘é€å¤±è´¥ï¼Œè¿›è¡Œé‡è¯•æˆ–æŠ¥è­¦
            handleSendFailure(topic, message, result);
        }
    }
    
    private void handleSendFailure(String topic, Object message, SendResult result) {
        // é‡è¯•ç­–ç•¥
        for (int i = 0; i < 3; i++) {
            try {
                Thread.sleep(1000 * (i + 1)); // é€’å¢å»¶è¿Ÿé‡è¯•
                SendResult retryResult = rocketMQTemplate.syncSend(topic, message);
                
                if (retryResult.getSendStatus() == SendStatus.SEND_OK) {
                    log.info("é‡è¯•å‘é€æˆåŠŸ: {}", retryResult.getMsgId());
                    return;
                }
            } catch (Exception e) {
                log.warn("ç¬¬{}æ¬¡é‡è¯•å¤±è´¥", i + 1, e);
            }
        }
        
        // æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œè®°å½•åˆ°å¤±è´¥è¡¨ï¼Œäººå·¥å¤„ç†
        saveFailedMessage(topic, message);
    }
}
```

### 8.3 MQæœåŠ¡å™¨ç«¯å¯é æ€§


#### ğŸ’¾ æ¶ˆæ¯æŒä¹…åŒ–é…ç½®


```properties
# RocketMQé…ç½®ç¤ºä¾‹
# æ¶ˆæ¯åˆ·ç›˜æ–¹å¼ï¼šåŒæ­¥åˆ·ç›˜ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±
flushDiskType=SYNC_FLUSH

# ä¸»ä»åŒæ­¥æ–¹å¼ï¼šåŒæ­¥å¤åˆ¶ä¿è¯é«˜å¯ç”¨
brokerRole=SYNC_MASTER

# æ¶ˆæ¯å­˜å‚¨æ—¶é—´ï¼š72å°æ—¶  
fileReservedTime=72
```

**æŒä¹…åŒ–ç­–ç•¥å¯¹æ¯”ï¼š**

| é…ç½®é¡¹ | **SYNCï¼ˆåŒæ­¥ï¼‰** | **ASYNCï¼ˆå¼‚æ­¥ï¼‰** |
|-------|-----------------|------------------|
| **æ•°æ®å®‰å…¨** | `æé«˜` | `è¾ƒé«˜` |
| **æ€§èƒ½å½±å“** | `è¾ƒå¤§` | `å¾ˆå°` |
| **é€‚ç”¨åœºæ™¯** | `é‡‘èæ”¯ä»˜ç­‰` | `ä¸€èˆ¬ä¸šåŠ¡` |

### 8.4 æ¶ˆè´¹è€…ç«¯å¯é æ€§


#### ğŸ“¥ æ¶ˆè´¹ç¡®è®¤æœºåˆ¶


```java
@Component
public class ReliableMessageConsumer {
    
    @Autowired
    private OrderService orderService;
    
    @RocketMQMessageListener(
        topic = "order-topic",
        consumerGroup = "order-consumer-group",
        consumeMode = ConsumeMode.ORDERLY  // é¡ºåºæ¶ˆè´¹
    )
    public class OrderMessageListener implements RocketMQListener<OrderMessage> {
        
        @Override
        public void onMessage(OrderMessage message) {
            try {
                // å¤„ç†ä¸šåŠ¡é€»è¾‘
                orderService.processOrder(message);
                
                // æ‰‹åŠ¨ç¡®è®¤æ¶ˆè´¹æˆåŠŸï¼ˆæŸäº›MQéœ€è¦æ‰‹åŠ¨ACKï¼‰
                // å¦‚æœæ–¹æ³•æ­£å¸¸ç»“æŸï¼ŒRocketMQä¼šè‡ªåŠ¨ACK
                
            } catch (BusinessException e) {
                // ä¸šåŠ¡å¼‚å¸¸ï¼Œä¸é‡è¯•ï¼Œè®°å½•æ—¥å¿—
                log.error("è®¢å•å¤„ç†ä¸šåŠ¡å¼‚å¸¸: {}", message.getOrderId(), e);
                
                // å¯ä»¥å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—æˆ–å¼‚å¸¸å¤„ç†é˜Ÿåˆ—
                sendToDeadLetterQueue(message, e);
                
            } catch (Exception e) {
                // ç³»ç»Ÿå¼‚å¸¸ï¼ŒæŠ›å‡ºå¼‚å¸¸è§¦å‘é‡è¯•
                log.error("è®¢å•å¤„ç†ç³»ç»Ÿå¼‚å¸¸: {}", message.getOrderId(), e);
                throw e;  // è®©MQé‡æ–°æŠ•é€’
            }
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡æ¶ˆæ¯ï¼šæœ¬åœ°äº‹åŠ¡ä¸æ¶ˆæ¯å‘é€ç»‘å®šï¼Œä¿è¯ä¸€è‡´æ€§
ğŸ”¸ å¯é æ¶ˆæ¯ï¼šé€šè¿‡æŒä¹…åŒ–ã€é‡è¯•ã€ç¡®è®¤æœºåˆ¶ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±  
ğŸ”¸ æœ€ç»ˆä¸€è‡´æ€§ï¼šå…è®¸çŸ­æš‚ä¸ä¸€è‡´ï¼Œä½†æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€
ğŸ”¸ åŠæ¶ˆæ¯ï¼šprepareçŠ¶æ€çš„æ¶ˆæ¯ï¼Œéœ€è¦ç¡®è®¤åæ‰èƒ½è¢«æ¶ˆè´¹
ğŸ”¸ å›æŸ¥æœºåˆ¶ï¼šMQä¸»åŠ¨è¯¢é—®åŠæ¶ˆæ¯çš„æœ€ç»ˆçŠ¶æ€
ğŸ”¸ å¹‚ç­‰å¤„ç†ï¼šåŒä¸€æ¶ˆæ¯å¤šæ¬¡å¤„ç†ç»“æœç›¸åŒ
ğŸ”¸ æ¶ˆæ¯ä¸¢å¤±é˜²æŠ¤ï¼šç”Ÿäº§è€…ã€MQã€æ¶ˆè´¹è€…ä¸‰å±‚é˜²æŠ¤
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é€‰æ‹©åˆé€‚çš„æ¨¡å¼**
```
ä¸šåŠ¡åœºæ™¯åŒ¹é…ï¼š
â€¢ å¼ºä¸€è‡´æ€§è¦æ±‚ â†’ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¦‚2PCã€TCCï¼‰
â€¢ æœ€ç»ˆä¸€è‡´æ€§å¯æ¥å— â†’ æ¶ˆæ¯é©±åŠ¨æ¨¡å¼  
â€¢ é«˜å¹¶å‘åœºæ™¯ â†’ å¼‚æ­¥æ¶ˆæ¯å¤„ç†
â€¢ ç®€å•ä¸šåŠ¡ â†’ æ™®é€šæ¶ˆæ¯å³å¯
```

**ğŸ”¹ å¯é æ€§ä¸æ€§èƒ½çš„æƒè¡¡**
```
å¯é æ€§çº§åˆ«ï¼š
é«˜ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ä½
åŒæ­¥åˆ·ç›˜ | å¼‚æ­¥åˆ·ç›˜ | å†…å­˜å­˜å‚¨
åŒæ­¥ç¡®è®¤ | å¼‚æ­¥ç¡®è®¤ | æ— éœ€ç¡®è®¤
  â†“           â†“           â†“  
æ€§èƒ½ä½      æ€§èƒ½ä¸­      æ€§èƒ½é«˜
```

**ğŸ”¹ å¼‚å¸¸å¤„ç†ç­–ç•¥**
```
å¼‚å¸¸åˆ†ç±»å¤„ç†ï¼š
â€¢ ç½‘ç»œå¼‚å¸¸ â†’ é‡è¯•
â€¢ ä¸šåŠ¡å¼‚å¸¸ â†’ è®°å½•æ—¥å¿—ï¼Œä¸é‡è¯•
â€¢ ç³»ç»Ÿå¼‚å¸¸ â†’ é‡è¯• + æŠ¥è­¦
â€¢ æŒç»­å¤±è´¥ â†’ è½¬å…¥æ­»ä¿¡é˜Ÿåˆ—
```

### 9.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®ï¼š**
- **æ¶ˆæ¯è®¾è®¡**ï¼šåŒ…å«è¶³å¤Ÿçš„ä¸šåŠ¡ä¿¡æ¯ï¼Œé¿å…æŸ¥è¯¢æ•°æ®åº“
- **å¹‚ç­‰è®¾è®¡**ï¼šæ¯ä¸ªæ¶ˆè´¹è€…éƒ½è¦è€ƒè™‘é‡å¤æ¶ˆè´¹é—®é¢˜
- **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§æ¶ˆæ¯ç§¯å‹ã€å¤±è´¥ç‡ã€å¤„ç†å»¶è¿Ÿ
- **å®¹é”™è®¾è®¡**ï¼šè€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†æ–¹æ¡ˆ

**âš ï¸ å¸¸è§é™·é˜±é¿å…ï¼š**
- ä¸è¦è¿‡åº¦ä¾èµ–æ¶ˆæ¯çš„é¡ºåºæ€§
- é¿å…æ¶ˆæ¯ä½“è¿‡å¤§å½±å“æ€§èƒ½
- ä¸è¦åœ¨æ¶ˆæ¯å¤„ç†ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- é¿å…å¾ªç¯ä¾èµ–å¯¼è‡´çš„æ¶ˆæ¯é£æš´

**ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹ï¼š**
- åˆç†è®¾ç½®æ¶ˆè´¹è€…æ•°é‡
- æ‰¹é‡å¤„ç†æé«˜ååé‡  
- å¼‚æ­¥å¤„ç†éå…³é”®é€»è¾‘
- åˆç†è®¾ç½®é‡è¯•é—´éš”å’Œæ¬¡æ•°

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¶ˆæ¯é˜Ÿåˆ—è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒæ˜¯**æœ€ç»ˆä¸€è‡´æ€§**
- å¯é æ€§é€šè¿‡**æŒä¹…åŒ–+é‡è¯•+ç¡®è®¤**ä¸‰é‡ä¿éšœ
- å¹‚ç­‰æ€§æ˜¯æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„æ ¹æœ¬è§£å†³æ–¹æ¡ˆ
- å¼‚å¸¸å¤„ç†è¦**åˆ†ç±»å¤„ç†**ï¼Œä¸èƒ½ä¸€æ¦‚è€Œè®º