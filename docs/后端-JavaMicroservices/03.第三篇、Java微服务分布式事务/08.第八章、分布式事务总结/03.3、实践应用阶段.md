---
title: 3ã€å®è·µåº”ç”¨é˜¶æ®µ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡](#1-ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡)
2. [åˆ†å¸ƒå¼äº‹åŠ¡æ ¸å¿ƒé—®é¢˜](#2-åˆ†å¸ƒå¼äº‹åŠ¡æ ¸å¿ƒé—®é¢˜)
3. [åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ](#3-åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ)
4. [CAPç†è®ºä¸BASEç†è®º](#4-CAPç†è®ºä¸BASEç†è®º)
5. [Seataæ¡†æ¶è¯¦è§£](#5-Seataæ¡†æ¶è¯¦è§£)
6. [ATæ¨¡å¼æ·±å…¥åˆ†æ](#6-ATæ¨¡å¼æ·±å…¥åˆ†æ)
7. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®è·µ](#7-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®è·µ)
8. [ç‰ˆæœ¬å…¼å®¹ä¸æŠ€æœ¯é€‰å‹](#8-ç‰ˆæœ¬å…¼å®¹ä¸æŠ€æœ¯é€‰å‹)
9. [æµ‹è¯•ç­–ç•¥ä¸æœ€ä½³å®è·µ](#9-æµ‹è¯•ç­–ç•¥ä¸æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡


### 1.1 ä»å•æœºäº‹åŠ¡è¯´èµ·


**ä¼ ç»Ÿå•æœºäº‹åŠ¡**å°±åƒä½ åœ¨é“¶è¡ŒæŸœå°åŠä¸šåŠ¡ï¼š
- ä½ è¦è½¬è´¦1000å…ƒç»™æœ‹å‹
- æŸœå‘˜ä»ä½ è´¦æˆ·æ‰£1000å…ƒ
- ç„¶åç»™æœ‹å‹è´¦æˆ·åŠ 1000å…ƒ
- è¦ä¹ˆä¸¤æ­¥éƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥å›æ»š

```
å•æœºäº‹åŠ¡ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åŒä¸€ä¸ªæ•°æ®åº“          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚è´¦æˆ·A    â”‚ â”‚è´¦æˆ·B    â”‚    â”‚
â”‚  â”‚-1000   â”‚ â”‚+1000   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         ä¸€èµ·æˆåŠŸæˆ–å¤±è´¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å¾®æœåŠ¡å¸¦æ¥çš„æŒ‘æˆ˜


ç°åœ¨ä¸šåŠ¡åˆ†æ‹†æˆäº†å¤šä¸ªå¾®æœåŠ¡ï¼Œå°±åƒæŠŠé“¶è¡Œä¸šåŠ¡åˆ†æ•£åˆ°ä¸åŒçš„éƒ¨é—¨ï¼š

```
å¾®æœåŠ¡æ¶æ„ä¸‹çš„è½¬è´¦ï¼š
ç”¨æˆ·æœåŠ¡          è´¦æˆ·æœåŠ¡          é€šçŸ¥æœåŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚éªŒè¯ç”¨æˆ·  â”‚ ---> â”‚æ‰£å‡ä½™é¢  â”‚ ---> â”‚å‘é€é€šçŸ¥  â”‚
â”‚èº«ä»½     â”‚      â”‚æ·»åŠ ä½™é¢  â”‚      â”‚è®°å½•æ—¥å¿—  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“               â†“               â†“
  MySQL          PostgreSQL       Redis
```

**é—®é¢˜æ¥äº†**ï¼šå¦‚æœè´¦æˆ·æ‰£æ¬¾æˆåŠŸäº†ï¼Œä½†é€šçŸ¥æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿç”¨æˆ·é’±æ‰£äº†ä½†æ²¡æ”¶åˆ°é€šçŸ¥ï¼Œè¿™å°±æ˜¯**æ•°æ®ä¸ä¸€è‡´**çš„é—®é¢˜ã€‚

### 1.3 åˆ†å¸ƒå¼äº‹åŠ¡çš„å®šä¹‰


> **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šè·¨è¶Šå¤šä¸ªç½‘ç»œèŠ‚ç‚¹ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰çš„äº‹åŠ¡æ“ä½œï¼Œéœ€è¦ä¿è¯è¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸŒ **è·¨ç½‘ç»œ**ï¼šæ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š
- ğŸ”— **è·¨ç³»ç»Ÿ**ï¼šæ¶‰åŠå¤šä¸ªä¸åŒçš„æ•°æ®å­˜å‚¨ç³»ç»Ÿ
- âš–ï¸ **ä¸€è‡´æ€§è¦æ±‚**ï¼šæ‰€æœ‰æ“ä½œå¿…é¡»ä¿æŒæ•°æ®ä¸€è‡´
- ğŸš« **å¤æ‚æ€§é«˜**ï¼šç½‘ç»œå»¶è¿Ÿã€æœåŠ¡æ•…éšœéƒ½å¯èƒ½å½±å“äº‹åŠ¡

---

## 2. âš ï¸ åˆ†å¸ƒå¼äº‹åŠ¡æ ¸å¿ƒé—®é¢˜


### 2.1 ç½‘ç»œä¸å¯é æ€§é—®é¢˜


ç½‘ç»œå°±åƒå¿«é€’ç³»ç»Ÿï¼Œæœ‰æ—¶ä¼šä¸¢åŒ…ã€å»¶è¿Ÿæˆ–æ–­çº¿ï¼š

```
æœåŠ¡A                    ç½‘ç»œ                    æœåŠ¡B
â”Œâ”€â”€â”€â”€â”€â”                                        â”Œâ”€â”€â”€â”€â”€â”
â”‚å‘é€ â”‚ --------[è¯·æ±‚]--------> âŒ ç½‘ç»œæ•…éšœ     â”‚æ¥æ”¶ â”‚
â”‚è¯·æ±‚ â”‚                                        â”‚å¤„ç† â”‚
â””â”€â”€â”€â”€â”€â”˜                                        â””â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼šæœåŠ¡Aä¸çŸ¥é“æœåŠ¡Bæ˜¯å¦æ”¶åˆ°å¹¶å¤„ç†äº†è¯·æ±‚
```

**å¸¸è§ç½‘ç»œé—®é¢˜**ï¼š
- ğŸ”¥ **ç½‘ç»œåˆ†åŒº**ï¼šéƒ¨åˆ†èŠ‚ç‚¹é—´æ— æ³•é€šä¿¡
- ğŸŒ **ç½‘ç»œå»¶è¿Ÿ**ï¼šè¯·æ±‚å“åº”æ—¶é—´è¿‡é•¿
- ğŸ“¦ **ä¸¢åŒ…é‡ä¼ **ï¼šæ•°æ®åŒ…åœ¨ä¼ è¾“ä¸­ä¸¢å¤±
- â° **è¶…æ—¶å¤„ç†**ï¼šä¸çŸ¥é“å¯¹æ–¹æ˜¯å¦æˆåŠŸå¤„ç†

### 2.2 éƒ¨åˆ†å¤±è´¥é—®é¢˜


æƒ³è±¡ä¸€ä¸ªåœ¨çº¿è´­ç‰©åœºæ™¯ï¼š
1. ç”¨æˆ·ä¸‹å• âœ…
2. æ‰£å‡åº“å­˜ âœ… 
3. åˆ›å»ºè®¢å• âŒï¼ˆæœåŠ¡æ•…éšœï¼‰
4. å‘é€é‚®ä»¶ ï¼Ÿï¼ˆä¸çŸ¥é“è¯¥ä¸è¯¥æ‰§è¡Œï¼‰

```
è´­ç‰©æµç¨‹çš„éƒ¨åˆ†å¤±è´¥ï¼š
ç”¨æˆ·æœåŠ¡ â†’ åº“å­˜æœåŠ¡ â†’ è®¢å•æœåŠ¡ â†’ é‚®ä»¶æœåŠ¡
  âœ…        âœ…        âŒ        ï¼Ÿ

ç»“æœï¼šåº“å­˜æ‰£äº†ï¼Œä½†è®¢å•æ²¡åˆ›å»ºï¼Œæ•°æ®ä¸ä¸€è‡´ï¼
```

### 2.3 å¦‚ä½•åˆ¤æ–­æ“ä½œæˆåŠŸï¼Ÿ


è¿™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤´ç–¼çš„é—®é¢˜ï¼š

```
åœºæ™¯ï¼šAæœåŠ¡è°ƒç”¨BæœåŠ¡è½¬è´¦
AæœåŠ¡                     BæœåŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å‘é€ï¼šè½¬è´¦1000å…ƒ  â”‚ ---> â”‚æ‰§è¡Œï¼šè´¦æˆ·æ‰£æ¬¾    â”‚
â”‚ç­‰å¾…å“åº”...     â”‚      â”‚å‘é€ï¼šå“åº”æˆåŠŸ    â”‚ 
â”‚æ”¶åˆ°ï¼šè¶…æ—¶ï¼     â”‚ <--- â”‚ç½‘ç»œï¼šå“åº”ä¸¢å¤±âŒ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AæœåŠ¡çš„å›°æƒ‘ï¼š
- é’±åˆ°åº•æ‰£äº†æ²¡æœ‰ï¼Ÿ
- è¦ä¸è¦é‡è¯•ï¼Ÿ
- é‡è¯•ä¼šä¸ä¼šé‡å¤æ‰£æ¬¾ï¼Ÿ
```

---

## 3. ğŸ› ï¸ åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ


### 3.1 2PCä¸¤é˜¶æ®µæäº¤åè®®


**2PCå°±åƒå©šç¤¼ä»ªå¼**ï¼š
- **å‡†å¤‡é˜¶æ®µ**ï¼šç‰§å¸ˆé—®æ–°éƒæ–°å¨˜"ä½ æ„¿æ„å—ï¼Ÿ"
- **æäº¤é˜¶æ®µ**ï¼šåŒæ–¹éƒ½åŒæ„åï¼Œå®£å¸ƒ"ä½ ä»¬ç»“ä¸ºå¤«å¦»"

```
2PCåè®®æµç¨‹ï¼š
åè°ƒè€…                å‚ä¸è€…A              å‚ä¸è€…B
   |                     |                   |
   |--[å‡†å¤‡é˜¶æ®µ]--------->|                   |
   |    "å‡†å¤‡æäº¤"         |                   |
   |                     |<--[é”å®šèµ„æº]       |
   |<----[åŒæ„]----------|                   |
   |                                         |
   |--[å‡†å¤‡é˜¶æ®µ]-------------------------->|
   |    "å‡†å¤‡æäº¤"                          |
   |                                     |<--[é”å®šèµ„æº]
   |<----[åŒæ„]--------------------------|
   |                                         |
   |--[æäº¤é˜¶æ®µ]--------->|                   |
   |    "æ­£å¼æäº¤"         |                   |
   |                     |--[é‡Šæ”¾é”ï¼Œæäº¤]-->|
   |--[æäº¤é˜¶æ®µ]-------------------------->|
   |    "æ­£å¼æäº¤"                          |
   |                                     |--[é‡Šæ”¾é”ï¼Œæäº¤]
```

**2PCçš„é—®é¢˜**ï¼š
- ğŸ“ˆ **æ€§èƒ½å·®**ï¼šéœ€è¦ä¸¤æ¬¡ç½‘ç»œé€šä¿¡
- ğŸ”’ **é•¿æ—¶é—´é”å®š**ï¼šå‡†å¤‡é˜¶æ®µä¼šé”å®šèµ„æº
- ğŸ’¥ **åè°ƒè€…å•ç‚¹æ•…éšœ**ï¼šåè°ƒè€…æŒ‚äº†æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨

### 3.2 TCCè¡¥å¿æ¨¡å¼


**TCCå°±åƒç½‘è´­é€€è´§æœºåˆ¶**ï¼š
- **Try**ï¼šå…ˆé¢„å èµ„æºï¼ˆä¸‹å•å åº“å­˜ï¼‰
- **Confirm**ï¼šç¡®è®¤æ“ä½œï¼ˆä»˜æ¬¾åç¡®è®¤å‘è´§ï¼‰
- **Cancel**ï¼šå–æ¶ˆæ“ä½œï¼ˆé€€è´§é‡Šæ”¾åº“å­˜ï¼‰

```java
// TCCè½¬è´¦ç¤ºä¾‹
public interface AccountService {
    // Tryï¼šå†»ç»“é‡‘é¢
    boolean tryFreeze(String userId, BigDecimal amount);
    
    // Confirmï¼šç¡®è®¤æ‰£æ¬¾
    boolean confirm(String userId, BigDecimal amount);
    
    // Cancelï¼šè§£å†»é‡‘é¢
    boolean cancel(String userId, BigDecimal amount);
}
```

**TCCè½¬è´¦æµç¨‹**ï¼š
```
è½¬è´¦1000å…ƒçš„TCCæµç¨‹ï¼š
                Tryé˜¶æ®µ              Confirmé˜¶æ®µ
è´¦æˆ·A: 1000 â†’ å†»ç»“1000 (ä½™é¢0) â†’ æ‰£é™¤å†»ç»“é‡‘é¢ (ä½™é¢0)
è´¦æˆ·B: 2000 â†’ é¢„åŠ 1000 (ä½™é¢2000) â†’ ç¡®è®¤åŠ æ¬¾ (ä½™é¢3000)

å¦‚æœå¤±è´¥ï¼ŒCancelé˜¶æ®µï¼š
è´¦æˆ·A: è§£å†»1000 (ä½™é¢1000)
è´¦æˆ·B: å–æ¶ˆé¢„åŠ  (ä½™é¢2000)
```

### 3.3 Sagaé•¿äº‹åŠ¡æ¨¡å¼


**Sagaå°±åƒæ—…è¡Œè®¡åˆ’**ï¼šæŠŠé•¿é€”æ—…è¡Œæ‹†åˆ†æˆå¤šä¸ªå°æ®µï¼Œæ¯æ®µéƒ½å¯ä»¥å•ç‹¬å–æ¶ˆã€‚

```
Sagaæ¨¡å¼ç¤ºä¾‹ - è®¢å•å¤„ç†ï¼š
æ­£å‘æµç¨‹ï¼š
ä¸‹å• â†’ æ‰£åº“å­˜ â†’ æ‰£ä½™é¢ â†’ å‘è´§ â†’ å®Œæˆ

è¡¥å¿æµç¨‹ï¼ˆæŸç¯èŠ‚å¤±è´¥ï¼‰ï¼š
å®Œæˆ â† å–æ¶ˆå‘è´§ â† æ¢å¤ä½™é¢ â† æ¢å¤åº“å­˜ â† å–æ¶ˆè®¢å•
```

**Sagaçš„ä¸¤ç§å®ç°æ–¹å¼**ï¼š

| æ–¹å¼ | **æè¿°** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|---------|---------|---------|
| ğŸ­ **ç¼–æ’å¼** | `ä¸­å¤®åè°ƒå™¨æ§åˆ¶æµç¨‹` | `æµç¨‹æ¸…æ™°ï¼Œæ˜“äºç›‘æ§` | `ä¸­å¤®åè°ƒå™¨æˆä¸ºç“¶é¢ˆ` |
| ğŸ”— **ç¼–ç å¼** | `æœåŠ¡é—´ç›´æ¥è°ƒç”¨` | `æ€§èƒ½å¥½ï¼Œæ— ä¸­å¿ƒèŠ‚ç‚¹` | `æµç¨‹åˆ†æ•£ï¼Œéš¾ä»¥ç›‘æ§` |

### 3.4 æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§


**æ¶ˆæ¯æ¨¡å¼å°±åƒé‚®å±€ç³»ç»Ÿ**ï¼šå…ˆæŠŠä¿¡ä»¶æŠ•é€’åˆ°é‚®å±€ï¼Œé‚®å±€ä¿è¯æœ€ç»ˆé€è¾¾ã€‚

```
æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§æµç¨‹ï¼š
ç”¨æˆ·ä¸‹å•                     æ¶ˆæ¯ä¸­é—´ä»¶                åº“å­˜æœåŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚1.åˆ›å»ºè®¢å•â”‚ ----æ¶ˆæ¯-----> â”‚æš‚å­˜æ¶ˆæ¯      â”‚ ----æ¶ˆæ¯--> â”‚æ‰£å‡åº“å­˜  â”‚
â”‚2.å‘é€æ¶ˆæ¯â”‚                â”‚ä¿è¯å¯é æŠ•é€’   â”‚            â”‚ç¡®è®¤æ¶ˆæ¯  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼šè®¢å•ç«‹å³åˆ›å»ºï¼Œåº“å­˜å¼‚æ­¥æ‰£å‡
```

---

## 4. ğŸ“ CAPç†è®ºä¸BASEç†è®º


### 4.1 CAPç†è®ºè¯¦è§£


**CAPå°±åƒä¸‰è§’æ‹**ï¼šä½ ä¸å¯èƒ½åŒæ—¶è·å¾—ä¸‰æ ·ä¸œè¥¿çš„å®Œç¾ã€‚

```
CAPç†è®ºä¸‰è¦ç´ ï¼š
      Consistency (ä¸€è‡´æ€§)
            â–²
           /|\
          / | \
         /  |  \
        /   |   \
       /    |    \
      /     |     \
Availability â—„â”€â”€â”€â”€â”€â–º Partition Tolerance
  (å¯ç”¨æ€§)              (åˆ†åŒºå®¹å¿æ€§)
```

**é€šä¿—è§£é‡Š**ï¼š
- **ğŸ¯ ä¸€è‡´æ€§(C)**ï¼šæ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°çš„æ•°æ®éƒ½ä¸€æ ·
  - *å°±åƒï¼šå…¨å®¶äººçš„æ‰‹è¡¨æ—¶é—´å¿…é¡»å®Œå…¨ä¸€è‡´*
- **âœ… å¯ç”¨æ€§(A)**ï¼šç³»ç»Ÿå§‹ç»ˆèƒ½å“åº”ç”¨æˆ·è¯·æ±‚  
  - *å°±åƒï¼šé“¶è¡ŒATMæœº24å°æ—¶éƒ½èƒ½å–é’±*
- **ğŸ”— åˆ†åŒºå®¹å¿æ€§(P)**ï¼šç½‘ç»œæ•…éšœæ—¶ç³»ç»Ÿä»èƒ½å·¥ä½œ
  - *å°±åƒï¼šå³ä½¿ç”µè¯çº¿æ–­äº†ï¼Œå„åœ°é“¶è¡Œè¿˜èƒ½æ­£å¸¸è¥ä¸š*

**ä¸ºä»€ä¹ˆåªèƒ½é€‰2ä¸ªï¼Ÿ**
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼šåŒ—äº¬å’Œä¸Šæµ·ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼Œç½‘ç»œçªç„¶æ–­äº†ï¼š
- é€‰æ‹©**CP**ï¼šä¸ºäº†æ•°æ®ä¸€è‡´ï¼Œåœæ­¢æœåŠ¡ç­‰ç½‘ç»œæ¢å¤
- é€‰æ‹©**AP**ï¼šç»§ç»­æœåŠ¡ä½†æ•°æ®å¯èƒ½ä¸ä¸€è‡´  
- é€‰æ‹©**CA**ï¼šå‡è®¾ç½‘ç»œæ°¸ä¸æ•…éšœï¼ˆç°å®ä¸­ä¸å¯èƒ½ï¼‰

### 4.2 BASEç†è®ºè¯¦è§£


**BASEç†è®ºå°±åƒ"å·®ä¸å¤šå°±è¡Œ"çš„å“²å­¦**ï¼š

```
BASEç†è®ºç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BA - Basically Available       â”‚  åŸºæœ¬å¯ç”¨
â”‚ S  - Soft State             â”‚  è½¯çŠ¶æ€  
â”‚ E  - Eventually Consistent     â”‚  æœ€ç»ˆä¸€è‡´æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€šä¿—è§£é‡Š**ï¼š
- **ğŸ”§ åŸºæœ¬å¯ç”¨**ï¼šç³»ç»Ÿå¤§éƒ¨åˆ†æ—¶å€™æ˜¯å¯ç”¨çš„
  - *å°±åƒï¼šå¶å°”ç½‘é€Ÿæ…¢ç‚¹ï¼Œä½†è¿˜èƒ½ç”¨*
- **ğŸ“Š è½¯çŠ¶æ€**ï¼šæ•°æ®å¯ä»¥æœ‰ä¸­é—´çŠ¶æ€
  - *å°±åƒï¼šè½¬è´¦ä¸­çš„"å¤„ç†ä¸­"çŠ¶æ€*
- **â° æœ€ç»ˆä¸€è‡´æ€§**ï¼šè¿‡ä¸€æ®µæ—¶é—´åæ•°æ®ä¼šä¸€è‡´
  - *å°±åƒï¼šé“¶è¡Œè½¬è´¦å¯èƒ½å‡ åˆ†é’Ÿåæ‰åˆ°è´¦*

---

## 5. ğŸš€ Seataæ¡†æ¶è¯¦è§£


### 5.1 ä»€ä¹ˆæ˜¯Seataï¼Ÿ


**Seata**å…¨ç§°æ˜¯**Simple Extensible Autonomous Transaction Architecture**ï¼Œæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚

> æŠŠSeataæƒ³è±¡æˆ**åˆ†å¸ƒå¼äº‹åŠ¡çš„äº¤é€šæŒ‡æŒ¥ä¸­å¿ƒ**ï¼š
> - ğŸš¦ **TCï¼ˆTransaction Coordinatorï¼‰**ï¼šäº¤é€šæŒ‡æŒ¥å‘˜ï¼Œåè°ƒæ•´ä¸ªäº‹åŠ¡
> - ğŸš— **TMï¼ˆTransaction Managerï¼‰**ï¼šå¸æœºï¼Œå‘èµ·å’Œç®¡ç†äº‹åŠ¡  
> - ğŸ›£ï¸ **RMï¼ˆResource Managerï¼‰**ï¼šå„ä¸ªè·¯å£ï¼Œç®¡ç†å…·ä½“èµ„æº

### 5.2 Seataæ¶æ„ç»„æˆ


```
Seataåˆ†å¸ƒå¼äº‹åŠ¡æ¶æ„ï¼š
                    TC (äº‹åŠ¡åè°ƒå™¨)
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Seata     â”‚
                   â”‚   Server    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                    â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
                    â”‚     â”‚     â”‚
              TM    â”‚     â”‚     â”‚    RM        RM
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ä¸šåŠ¡æœåŠ¡A â”‚     â”‚     â”‚ â”‚ä¸šåŠ¡æœåŠ¡B â”‚ â”‚ä¸šåŠ¡æœåŠ¡C â”‚
          â”‚(å‘èµ·è€…) â”‚     â”‚     â”‚ â”‚(å‚ä¸è€…) â”‚ â”‚(å‚ä¸è€…) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚     â”‚     â”‚         â”‚
                      æ³¨å†Œ â”‚     â”‚ æ³¨å†Œâ”‚     æ³¨å†Œâ”‚
                          â–¼     â–¼     â–¼         â–¼
                        å…¨å±€äº‹åŠ¡çŠ¶æ€ç®¡ç†ä¸­å¿ƒ
```

**å„ç»„ä»¶èŒè´£**ï¼š
- **ğŸ“‹ TM (Transaction Manager)**ï¼š
  - å‘èµ·å…¨å±€äº‹åŠ¡
  - å†³å®šå…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»š
  - *å°±åƒï¼šé¡¹ç›®ç»ç†ï¼Œç»Ÿç­¹æ•´ä¸ªé¡¹ç›®*

- **ğŸ¯ TC (Transaction Coordinator)**ï¼š
  - æ³¨å†Œå’Œç®¡ç†å…¨å±€äº‹åŠ¡
  - åè°ƒåˆ†æ”¯äº‹åŠ¡çš„æäº¤æˆ–å›æ»š
  - *å°±åƒï¼šé¡¹ç›®åŠ©ç†ï¼Œè·Ÿè¸ªå„ä¸ªä»»åŠ¡è¿›åº¦*

- **ğŸ”§ RM (Resource Manager)**ï¼š
  - ç®¡ç†åˆ†æ”¯äº‹åŠ¡ï¼ˆå¦‚æ•°æ®åº“äº‹åŠ¡ï¼‰
  - å‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡
  - *å°±åƒï¼šå„éƒ¨é—¨è´Ÿè´£äººï¼Œæ‰§è¡Œå…·ä½“ä»»åŠ¡*

### 5.3 Seataäº‹åŠ¡æ¨¡å¼


| æ¨¡å¼ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½** | **å¤æ‚åº¦** |
|------|---------|-------------|---------|-----------|
| ğŸ”„ **ATæ¨¡å¼** | `è‡ªåŠ¨è¡¥å¿ï¼Œä¾µå…¥æ€§ä½` | `å…³ç³»å‹æ•°æ®åº“æ“ä½œ` | `é«˜` | `ä½` |
| ğŸ­ **TCCæ¨¡å¼** | `æ‰‹åŠ¨è¡¥å¿ï¼Œç²¾ç¡®æ§åˆ¶` | `èµ„é‡‘äº¤æ˜“ï¼Œåº“å­˜ç®¡ç†` | `ä¸­` | `é«˜` |
| ğŸ“¨ **Sagaæ¨¡å¼** | `é•¿äº‹åŠ¡ï¼Œæœ€ç»ˆä¸€è‡´` | `å¤æ‚ä¸šåŠ¡æµç¨‹` | `é«˜` | `ä¸­` |
| ğŸ“ **XAæ¨¡å¼** | `å¼ºä¸€è‡´æ€§ï¼Œæ ‡å‡†åè®®` | `ä¼ ç»Ÿä¼ä¸šåº”ç”¨` | `ä½` | `ä½` |

### 5.4 å¿«é€Ÿä¸Šæ‰‹ç¤ºä¾‹


```java
// 1. åœ¨ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ @GlobalTransactionalæ³¨è§£
@Service
public class OrderService {
    
    @Autowired
    private AccountService accountService;
    
    @Autowired 
    private StorageService storageService;
    
    /**
     * ä¸‹å•ä¸šåŠ¡ï¼šæ‰£ä½™é¢ + å‡åº“å­˜
     */
    @GlobalTransactional(name = "create-order", rollbackFor = Exception.class)
    public void createOrder(Order order) {
        // 1. æ‰£å‡ç”¨æˆ·ä½™é¢
        accountService.debit(order.getUserId(), order.getAmount());
        
        // 2. æ‰£å‡å•†å“åº“å­˜  
        storageService.deduct(order.getProductId(), order.getCount());
        
        // 3. åˆ›å»ºè®¢å•è®°å½•
        orderDao.insert(order);
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼ŒSeataä¼šè‡ªåŠ¨å›æ»šæ‰€æœ‰æ“ä½œ
    }
}
```

---

## 6. ğŸ” ATæ¨¡å¼æ·±å…¥åˆ†æ


### 6.1 ATæ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ


**ATæ¨¡å¼**ï¼ˆAuto Transactionï¼‰æ˜¯Seataæœ€æ ¸å¿ƒçš„äº‹åŠ¡æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸º**"è‡ªåŠ¨æŒ¡æ±½è½¦"**ï¼š
- ä½ åªéœ€è¦è¸©æ²¹é—¨å’Œåˆ¹è½¦ï¼ˆå†™ä¸šåŠ¡ä»£ç ï¼‰
- æ¢æŒ¡æ“ä½œï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰å…¨éƒ¨è‡ªåŠ¨å®Œæˆ
- å‡ºç°é—®é¢˜æ—¶è‡ªåŠ¨å€’è½¦ï¼ˆè‡ªåŠ¨å›æ»šï¼‰

### 6.2 ATæ¨¡å¼å·¥ä½œåŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡**å‰é•œåƒ**å’Œ**åé•œåƒ**å®ç°è‡ªåŠ¨è¡¥å¿ã€‚

```
ATæ¨¡å¼æ•°æ®å˜åŒ–è¿‡ç¨‹ï¼š
                åŸå§‹æ•°æ®              æ‰§è¡Œä¸šåŠ¡SQL           ç”Ÿæˆåé•œåƒ
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚id=1     â”‚  UPDATE   â”‚id=1     â”‚  RECORD   â”‚id=1     â”‚
              â”‚money=100â”‚   SET     â”‚money=80 â”‚   AFTER   â”‚money=80 â”‚
              â”‚         â”‚  money=80 â”‚         â”‚   IMAGE   â”‚         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“                     â†“                     â†“
               è®°å½•å‰é•œåƒ              æ‰§è¡ŒSQL                è®°å½•åé•œåƒ
              (Before Image)                               (After Image)

              å¦‚æœéœ€è¦å›æ»šï¼Œä½¿ç”¨å‰é•œåƒæ•°æ®æ¢å¤ï¼š
              UPDATE account SET money=100 WHERE id=1
```

### 6.3 ATæ¨¡å¼è¯¦ç»†æµç¨‹


```
ATæ¨¡å¼å®Œæ•´äº‹åŠ¡æµç¨‹ï¼š

ç¬¬ä¸€é˜¶æ®µï¼šåˆ†æ”¯äº‹åŠ¡æ‰§è¡Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è§£æSQLï¼ŒæŸ¥è¯¢å‰é•œåƒï¼šSELECT * FROM account WHERE id=1  â”‚
â”‚    å‰é•œåƒï¼š{id:1, money:100}                            â”‚
â”‚                                                          â”‚
â”‚ 2. æ‰§è¡Œä¸šåŠ¡SQLï¼šUPDATE account SET money=80 WHERE id=1   â”‚
â”‚                                                          â”‚  
â”‚ 3. æŸ¥è¯¢åé•œåƒï¼šSELECT * FROM account WHERE id=1         â”‚
â”‚    åé•œåƒï¼š{id:1, money:80}                             â”‚
â”‚                                                          â”‚
â”‚ 4. æ’å…¥å›æ»šæ—¥å¿—åˆ°undo_logè¡¨                              â”‚
â”‚ 5. æäº¤æœ¬åœ°äº‹åŠ¡ï¼ˆé‡Šæ”¾æœ¬åœ°é”ï¼‰                              â”‚
â”‚ 6. å‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒé˜¶æ®µï¼šå…¨å±€äº‹åŠ¡å†³è®®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒ…å†µ1ï¼šå…¨å±€æäº¤                                          â”‚
â”‚   - TCé€šçŸ¥æ‰€æœ‰RMåˆ é™¤undo_log                            â”‚  
â”‚   - äº‹åŠ¡å®Œæˆ                                            â”‚
â”‚                                                          â”‚
â”‚ æƒ…å†µ2ï¼šå…¨å±€å›æ»š                                          â”‚
â”‚   - TCé€šçŸ¥æ‰€æœ‰RMæ‰§è¡Œè¡¥å¿                                 â”‚
â”‚   - RMæ ¹æ®undo_logç”Ÿæˆåå‘SQL                           â”‚
â”‚   - æ‰§è¡Œåå‘SQLï¼šUPDATE account SET money=100 WHERE id=1 â”‚
â”‚   - åˆ é™¤undo_log                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 ATæ¨¡å¼çš„ä¼˜ç¼ºç‚¹


**âœ… ATæ¨¡å¼ä¼˜åŠ¿**ï¼š
- **ğŸ”§ é›¶ä¾µå…¥**ï¼šä¸šåŠ¡ä»£ç å‡ ä¹æ— éœ€ä¿®æ”¹
- **âš¡ é«˜æ€§èƒ½**ï¼šç¬¬ä¸€é˜¶æ®µç›´æ¥æäº¤ï¼Œä¸é˜»å¡
- **ğŸ¤– å…¨è‡ªåŠ¨**ï¼šè‡ªåŠ¨ç”Ÿæˆåå‘SQLè¿›è¡Œè¡¥å¿
- **ğŸ‘¥ ä½¿ç”¨ç®€å•**ï¼šåªéœ€è¦åŠ ä¸€ä¸ªæ³¨è§£

**âŒ ATæ¨¡å¼é™åˆ¶**ï¼š
- **ğŸ—ƒï¸ ä»…æ”¯æŒå…³ç³»å‹æ•°æ®åº“**
- **ğŸ“ è¦æ±‚SQLå¯è§£æ**ï¼šå¤æ‚SQLå¯èƒ½ä¸æ”¯æŒ  
- **ğŸ” éœ€è¦ä¸»é”®**ï¼šè¡¨å¿…é¡»æœ‰ä¸»é”®ç”¨äºå®šä½è®°å½•
- **âš ï¸ è„è¯»é£é™©**ï¼šç¬¬ä¸€é˜¶æ®µæäº¤å¯èƒ½è¢«å…¶ä»–äº‹åŠ¡è¯»å–

### 6.5 ATæ¨¡å¼æœ€ä½³å®è·µ


**æ•°æ®åº“è¡¨è®¾è®¡è¦æ±‚**ï¼š
```sql
-- 1. ä¸šåŠ¡è¡¨å¿…é¡»æœ‰ä¸»é”®
CREATE TABLE account (
    id BIGINT PRIMARY KEY,    -- å¿…é¡»æœ‰ä¸»é”®
    user_id VARCHAR(50),
    money DECIMAL(10,2)
);

-- 2. æ¯ä¸ªæ•°æ®åº“éƒ½è¦æœ‰undo_logè¡¨
CREATE TABLE undo_log (
    id BIGINT(20) NOT NULL AUTO_INCREMENT,
    branch_id BIGINT(20) NOT NULL,
    xid VARCHAR(100) NOT NULL,
    context VARCHAR(128) NOT NULL,
    rollback_info LONGBLOB NOT NULL,
    log_status INT(11) NOT NULL,
    log_created DATETIME NOT NULL,
    log_modified DATETIME NOT NULL,
    PRIMARY KEY (id),
    UNIQUE KEY ux_undo_log (xid, branch_id)
);
```

**ä»£ç ä½¿ç”¨å»ºè®®**ï¼š
```java
@Service
public class BusinessService {
    
    // âœ… æ­£ç¡®ç”¨æ³•ï¼šåœ¨ä¸šåŠ¡å…¥å£æ–¹æ³•æ·»åŠ æ³¨è§£
    @GlobalTransactional(
        name = "business-transaction",    // ç»™äº‹åŠ¡èµ·ä¸ªåå­—
        rollbackFor = Exception.class,   // é‡åˆ°å¼‚å¸¸å°±å›æ»š
        timeoutMills = 300000            // 5åˆ†é’Ÿè¶…æ—¶
    )
    public void doBusinessOperation() {
        // ä¸šåŠ¡é€»è¾‘
    }
    
    // âŒ é”™è¯¯ç”¨æ³•ï¼šä¸è¦åœ¨å†…éƒ¨æ–¹æ³•æ·»åŠ æ³¨è§£
    private void internalMethod() {
        // å†…éƒ¨æ–¹æ³•ä¸éœ€è¦@GlobalTransactional
    }
}
```

---

## 7. ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®è·µ


### 7.1 Seata Serveréƒ¨ç½²æ¶æ„


```
ç”Ÿäº§ç¯å¢ƒé«˜å¯ç”¨éƒ¨ç½²ï¼š
                    Load Balancer
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   Nginx     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Seata   â”‚       â”‚ Seata   â”‚       â”‚ Seata   â”‚
   â”‚Server-1 â”‚       â”‚Server-2 â”‚       â”‚Server-3 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    MySQL    â”‚
                   â”‚  (å­˜å‚¨äº‹åŠ¡   â”‚
                   â”‚   æ—¥å¿—)     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é…ç½®æ–‡ä»¶è¯¦è§£


**registry.conf - æ³¨å†Œä¸­å¿ƒé…ç½®**ï¼š
```hocon
registry {
  # ä½¿ç”¨Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒ
  type = "nacos"
  nacos {
    application = "seata-server"
    serverAddr = "127.0.0.1:8848"
    group = "SEATA_GROUP"
    namespace = "seata"
    username = "nacos"
    password = "nacos"
  }
}

config {
  # ä½¿ç”¨Nacosä½œä¸ºé…ç½®ä¸­å¿ƒ  
  type = "nacos"
  nacos {
    serverAddr = "127.0.0.1:8848"
    group = "SEATA_GROUP"
    namespace = "seata"
    dataId = "seataServer.properties"
    username = "nacos"
    password = "nacos"
  }
}
```

**file.conf - å­˜å‚¨é…ç½®**ï¼š
```hocon
store {
  mode = "db"  # ä½¿ç”¨æ•°æ®åº“å­˜å‚¨
  
  db {
    datasource = "druid"
    dbType = "mysql" 
    driverClassName = "com.mysql.cj.jdbc.Driver"
    url = "jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&rewriteBatchedStatements=true"
    user = "root"
    password = "123456"
    minConn = 5
    maxConn = 100
    globalTable = "global_table"      # å…¨å±€äº‹åŠ¡è¡¨
    branchTable = "branch_table"      # åˆ†æ”¯äº‹åŠ¡è¡¨  
    lockTable = "lock_table"          # åˆ†å¸ƒå¼é”è¡¨
    queryLimit = 100
    maxWait = 5000
  }
}
```

### 7.3 æ•°æ®åº“è¡¨ç»“æ„


Seataéœ€è¦ä¸‰å¼ æ ¸å¿ƒè¡¨ï¼š
```sql
-- å…¨å±€äº‹åŠ¡è¡¨
CREATE TABLE global_table (
    xid VARCHAR(128) NOT NULL,
    transaction_id BIGINT,
    status TINYINT NOT NULL,
    application_id VARCHAR(32),
    transaction_service_group VARCHAR(32),
    transaction_name VARCHAR(128),
    timeout INT,
    begin_time BIGINT,
    application_data VARCHAR(2000),
    gmt_create DATETIME,
    gmt_modified DATETIME,
    PRIMARY KEY (xid),
    KEY idx_gmt_modified_status (gmt_modified, status),
    KEY idx_transaction_id (transaction_id)
);

-- åˆ†æ”¯äº‹åŠ¡è¡¨  
CREATE TABLE branch_table (
    branch_id BIGINT NOT NULL,
    xid VARCHAR(128) NOT NULL,
    transaction_id BIGINT,
    resource_group_id VARCHAR(32),
    resource_id VARCHAR(256),
    branch_type VARCHAR(8),
    status TINYINT,
    client_id VARCHAR(64),
    application_data VARCHAR(2000),
    gmt_create DATETIME(6),
    gmt_modified DATETIME(6),
    PRIMARY KEY (branch_id),
    KEY idx_xid (xid)
);

-- åˆ†å¸ƒå¼é”è¡¨
CREATE TABLE lock_table (
    row_key VARCHAR(128) NOT NULL,
    xid VARCHAR(128),
    transaction_id BIGINT,
    branch_id BIGINT NOT NULL,
    resource_id VARCHAR(256),
    table_name VARCHAR(32),
    pk VARCHAR(36),
    gmt_create DATETIME,
    gmt_modified DATETIME,
    PRIMARY KEY (row_key),
    KEY idx_branch_id (branch_id)
);
```

### 7.4 ç›‘æ§ä¸è¿ç»´


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```
äº‹åŠ¡æ€§èƒ½æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ å…¨å±€äº‹åŠ¡æˆåŠŸç‡ï¼š> 99.9%           â”‚
â”‚ â€¢ å¹³å‡äº‹åŠ¡æ‰§è¡Œæ—¶é—´ï¼š< 100ms         â”‚  
â”‚ â€¢ äº‹åŠ¡è¶…æ—¶æ¬¡æ•°ï¼šæ¯å°æ—¶ < 10æ¬¡        â”‚
â”‚ â€¢ å›æ»šäº‹åŠ¡æ¯”ä¾‹ï¼š< 1%                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç³»ç»Ÿèµ„æºæŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Seata Server CPUä½¿ç”¨ç‡ï¼š< 70%     â”‚
â”‚ â€¢ å†…å­˜ä½¿ç”¨ç‡ï¼š< 80%                 â”‚
â”‚ â€¢ æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡ï¼š< 80%          â”‚
â”‚ â€¢ ç½‘ç»œå»¶è¿Ÿï¼š< 10ms                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ğŸ“‹ ç‰ˆæœ¬å…¼å®¹ä¸æŠ€æœ¯é€‰å‹


### 8.1 Seataç‰ˆæœ¬é€‰æ‹©


| Seataç‰ˆæœ¬ | **Spring Boot** | **Spring Cloud** | **ç‰¹æ€§** | **æ¨èåº¦** |
|-----------|----------------|------------------|---------|-----------|
| `1.4.2` | `2.3.x` | `Hoxton.SR12` | `ç¨³å®šï¼Œç”Ÿäº§å¯ç”¨` | `â­â­â­â­â­` |
| `1.5.2` | `2.6.x` | `2021.0.x` | `æ–°ç‰¹æ€§ï¼Œå…¼å®¹æ€§å¥½` | `â­â­â­â­` |
| `1.6.1` | `2.7.x` | `2022.0.x` | `æœ€æ–°ç‰¹æ€§ï¼Œéœ€æµ‹è¯•` | `â­â­â­` |

**ç‰ˆæœ¬é€‰æ‹©å»ºè®®**ï¼š
```
ç”Ÿäº§ç¯å¢ƒæ¨èï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿å®ˆå‹ï¼šSeata 1.4.2 + Spring Boot 2.3.x â”‚
â”‚ å¹³è¡¡å‹ï¼šSeata 1.5.2 + Spring Boot 2.6.x â”‚  
â”‚ æ¿€è¿›å‹ï¼šSeata 1.6.1 + Spring Boot 2.7.x â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–°é¡¹ç›®å»ºè®®ï¼šç›´æ¥ä½¿ç”¨1.5.2ç‰ˆæœ¬
è€é¡¹ç›®å‡çº§ï¼šé€æ­¥ä»1.4.2å‡çº§åˆ°1.5.2
```

### 8.2 æŠ€æœ¯é€‰å‹å¯¹æ¯”


**åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆé€‰å‹**ï¼š

| æ–¹æ¡ˆ | **å­¦ä¹ æˆæœ¬** | **æ€§èƒ½** | **ä¸€è‡´æ€§** | **é€‚ç”¨åœºæ™¯** |
|------|-------------|---------|-----------|-------------|
| **Seata AT** | `ä½` | `é«˜` | `æœ€ç»ˆä¸€è‡´` | `å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯` |
| **Seata TCC** | `é«˜` | `ä¸­` | `å¼ºä¸€è‡´` | `èµ„é‡‘äº¤æ˜“åœºæ™¯` |
| **RocketMQäº‹åŠ¡** | `ä¸­` | `é«˜` | `æœ€ç»ˆä¸€è‡´` | `è§£è€¦è¦æ±‚é«˜` |
| **æœ¬åœ°æ¶ˆæ¯è¡¨** | `ä½` | `ä¸­` | `æœ€ç»ˆä¸€è‡´` | `ç®€å•åœºæ™¯` |

**é€‰å‹å†³ç­–æ ‘**ï¼š
```
ä½ çš„ä¸šåŠ¡åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ
â”œâ”€ å¼ºä¸€è‡´æ€§è¦æ±‚ï¼ˆå¦‚èµ„é‡‘äº¤æ˜“ï¼‰
â”‚  â””â”€ é€‰æ‹©ï¼šSeata TCC æˆ– ä¼ ç»Ÿ2PC
â”œâ”€ æœ€ç»ˆä¸€è‡´æ€§å¯æ¥å—  
â”‚  â”œâ”€ æœåŠ¡é—´è€¦åˆåº¦ä½ â†’ RocketMQäº‹åŠ¡æ¶ˆæ¯
â”‚  â”œâ”€ ç®€å•åœºæ™¯ â†’ æœ¬åœ°æ¶ˆæ¯è¡¨
â”‚  â””â”€ å¤æ‚åœºæ™¯ â†’ Seata ATæ¨¡å¼
â””â”€ æ€§èƒ½è¦æ±‚æé«˜
   â””â”€ è€ƒè™‘ï¼šå¼‚æ­¥å¤„ç† + è¡¥å¿æœºåˆ¶
```

### 8.3 ä¾èµ–ç®¡ç†æœ€ä½³å®è·µ


**Mavenä¾èµ–ç®¡ç†**ï¼š
```xml
<properties>
    <seata.version>1.5.2</seata.version>
    <spring-cloud-alibaba.version>2021.0.4.0</spring-cloud-alibaba.version>
</properties>

<dependencyManagement>
    <dependencies>
        <!-- Spring Cloud Alibaba -->
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-alibaba-dependencies</artifactId>
            <version>${spring-cloud-alibaba.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <!-- Seata -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-seata</artifactId>
    </dependency>
</dependencies>
```

---

## 9. ğŸ§ª æµ‹è¯•ç­–ç•¥ä¸æœ€ä½³å®è·µ


### 9.1 åˆ†å¸ƒå¼äº‹åŠ¡æµ‹è¯•ç­–ç•¥


**æµ‹è¯•é‡‘å­—å¡”**ï¼š
```
                    E2Eæµ‹è¯•
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ç«¯åˆ°ç«¯   â”‚ â† å…¨é“¾è·¯äº‹åŠ¡æµ‹è¯•
                   â”‚å®Œæ•´åœºæ™¯ â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  
              é›†æˆæµ‹è¯•  
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
            â”‚æœåŠ¡é—´åè°ƒ   â”‚ â† åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒæµ‹è¯•
            â”‚å¼‚å¸¸åœºæ™¯     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            
          å•å…ƒæµ‹è¯•
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚å•ä¸ªæœåŠ¡        â”‚ â† æœ¬åœ°äº‹åŠ¡æµ‹è¯•
    â”‚ä¸šåŠ¡é€»è¾‘        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 æ ¸å¿ƒæµ‹è¯•åœºæ™¯


**ğŸ¯ æ­£å¸¸æµç¨‹æµ‹è¯•**ï¼š
```java
@Test
@DisplayName("æ­£å¸¸åˆ†å¸ƒå¼äº‹åŠ¡æäº¤æµ‹è¯•")
public void testNormalTransactionCommit() {
    // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
    Account account = createTestAccount(1000.0);
    Order order = createTestOrder(100.0);
    
    // 2. æ‰§è¡Œåˆ†å¸ƒå¼äº‹åŠ¡
    orderService.createOrder(order);
    
    // 3. éªŒè¯ç»“æœ
    assertThat(accountService.getBalance(account.getId()))
        .isEqualTo(900.0); // ä½™é¢æ­£ç¡®æ‰£å‡
    assertThat(orderService.getOrder(order.getId()))
        .isNotNull(); // è®¢å•åˆ›å»ºæˆåŠŸ
}
```

**ğŸ’¥ å¼‚å¸¸å›æ»šæµ‹è¯•**ï¼š
```java  
@Test
@DisplayName("åˆ†å¸ƒå¼äº‹åŠ¡å›æ»šæµ‹è¯•")
public void testTransactionRollback() {
    // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
    Account account = createTestAccount(1000.0);
    Order order = createTestOrder(100.0);
    
    // 2. æ¨¡æ‹Ÿå¼‚å¸¸
    doThrow(new RuntimeException("åº“å­˜ä¸è¶³"))
        .when(storageService).deduct(any(), any());
    
    // 3. æ‰§è¡Œäº‹åŠ¡ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
    assertThrows(RuntimeException.class, () -> {
        orderService.createOrder(order);
    });
    
    // 4. éªŒè¯å›æ»šç»“æœ
    assertThat(accountService.getBalance(account.getId()))
        .isEqualTo(1000.0); // ä½™é¢æœªæ‰£å‡
    assertThat(orderService.findOrder(order.getId()))
        .isNull(); // è®¢å•æœªåˆ›å»º
}
```

### 9.3 æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ


**å‹åŠ›æµ‹è¯•åœºæ™¯**ï¼š
```java
@Test
@DisplayName("åˆ†å¸ƒå¼äº‹åŠ¡æ€§èƒ½æµ‹è¯•")  
public void testTransactionPerformance() {
    int threadCount = 10;
    int transactionCount = 100;
    
    // å¹¶å‘æ‰§è¡Œåˆ†å¸ƒå¼äº‹åŠ¡
    CompletableFuture[] futures = IntStream.range(0, threadCount)
        .mapToObj(i -> CompletableFuture.runAsync(() -> {
            for (int j = 0; j < transactionCount; j++) {
                orderService.createOrder(createTestOrder(10.0));
            }
        }))
        .toArray(CompletableFuture[]::new);
    
    // ç­‰å¾…å®Œæˆå¹¶æµ‹é‡æ€§èƒ½
    long startTime = System.currentTimeMillis();
    CompletableFuture.allOf(futures).join();
    long endTime = System.currentTimeMillis();
    
    // éªŒè¯æ€§èƒ½æŒ‡æ ‡
    long totalTransactions = threadCount * transactionCount;
    double tps = totalTransactions * 1000.0 / (endTime - startTime);
    
    System.out.println("TPS: " + tps);
    assertThat(tps).isGreaterThan(100); // æ¯ç§’è‡³å°‘100ä¸ªäº‹åŠ¡
}
```

### 9.4 æµ‹è¯•ç¯å¢ƒæ­å»º


**Docker Composeç¯å¢ƒ**ï¼š
```yaml
version: '3.8'
services:
  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_DATABASE: seata
    ports:
      - "3306:3306"
  
  # Nacosæ³¨å†Œä¸­å¿ƒ  
  nacos:
    image: nacos/nacos-server:v2.2.0
    environment:
      MODE: standalone
    ports:
      - "8848:8848"
  
  # Seata Server
  seata-server:
    image: seataio/seata-server:1.5.2
    ports:
      - "8091:8091"
    environment:
      STORE_MODE: db
    depends_on:
      - mysql
      - nacos
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡æœ¬è´¨ï¼šè·¨ç½‘ç»œèŠ‚ç‚¹çš„äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯
ğŸ”¸ æ ¸å¿ƒé—®é¢˜ï¼šç½‘ç»œä¸å¯é ã€éƒ¨åˆ†å¤±è´¥ã€çŠ¶æ€ä¸ç¡®å®š  
ğŸ”¸ è§£å†³æ–¹æ¡ˆï¼š2PCã€TCCã€Sagaã€æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§
ğŸ”¸ CAPç†è®ºï¼šä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹å¿æ€§ä¸å¯å…¼å¾—
ğŸ”¸ BASEç†è®ºï¼šåŸºæœ¬å¯ç”¨ã€è½¯çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´æ€§
ğŸ”¸ Seataæ¡†æ¶ï¼šTMã€TCã€RMä¸‰å¤§ç»„ä»¶åè°ƒåˆ†å¸ƒå¼äº‹åŠ¡
ğŸ”¸ ATæ¨¡å¼ï¼šé€šè¿‡å‰åé•œåƒå®ç°è‡ªåŠ¨è¡¥å¿å›æ»š
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ**
```
éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯ï¼š
âœ… è·¨å¤šä¸ªæ•°æ®åº“çš„æ“ä½œ
âœ… æ¶‰åŠå¤šä¸ªå¾®æœåŠ¡çš„ä¸šåŠ¡æµç¨‹  
âœ… å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜
âœ… ä¸šåŠ¡æ“ä½œä¸å¯åˆ†å‰²

ä¸éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯ï¼š
âŒ å•æ•°æ®åº“å•è¡¨æ“ä½œ
âŒ å¯ä»¥æ¥å—æœ€ç»ˆä¸€è‡´æ€§
âŒ æ“ä½œä¹‹é—´å¯ä»¥ç‹¬ç«‹å›æ»š
âŒ æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
```

**ğŸ”¹ å¦‚ä½•é€‰æ‹©åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆï¼Ÿ**
```
é€‰æ‹©å†³ç­–å› ç´ ï¼š
1. ä¸€è‡´æ€§è¦æ±‚ï¼šå¼ºä¸€è‡´ â†’ TCCï¼Œæœ€ç»ˆä¸€è‡´ â†’ AT/Saga
2. æ€§èƒ½è¦æ±‚ï¼šé«˜æ€§èƒ½ â†’ AT/Sagaï¼Œå¯æ¥å— â†’ TCC  
3. å¼€å‘å¤æ‚åº¦ï¼šç®€å• â†’ ATï¼Œå¯æ¥å— â†’ TCC/Saga
4. ä¸šåŠ¡åœºæ™¯ï¼šé‡‘è â†’ TCCï¼Œç”µå•† â†’ ATï¼Œé•¿æµç¨‹ â†’ Saga
```

**ğŸ”¹ åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€§èƒ½å½±å“**
```
æ€§èƒ½æŸè€—ä¸»è¦æ¥æºï¼š
â€¢ ç½‘ç»œé€šä¿¡æ¬¡æ•°å¢åŠ 
â€¢ äº‹åŠ¡åè°ƒå¼€é”€  
â€¢ èµ„æºé”å®šæ—¶é—´å»¶é•¿
â€¢ é¢å¤–çš„å­˜å‚¨å¼€é”€ï¼ˆundo_logç­‰ï¼‰

ä¼˜åŒ–ç­–ç•¥ï¼š
â€¢ å‡å°‘äº‹åŠ¡èŒƒå›´ï¼Œå°½é‡æœ¬åœ°åŒ–
â€¢ å¼‚æ­¥åŒ–éå…³é”®æ“ä½œ
â€¢ åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
â€¢ ä½¿ç”¨è¿æ¥æ± å’Œæ‰¹å¤„ç†
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ç”µå•†ç³»ç»Ÿåº”ç”¨**ï¼š
- è®¢å•åˆ›å»ºï¼šåº“å­˜æ‰£å‡ + ä½™é¢æ‰£é™¤ + è®¢å•å…¥åº“
- æ”¯ä»˜æµç¨‹ï¼šè´¦æˆ·æ‰£æ¬¾ + å•†æˆ·å…¥è´¦ + è®¢å•çŠ¶æ€æ›´æ–°
- é€€æ¬¾å¤„ç†ï¼šè®¢å•å–æ¶ˆ + åº“å­˜æ¢å¤ + ä½™é¢è¿”è¿˜

**é‡‘èç³»ç»Ÿåº”ç”¨**ï¼š  
- è½¬è´¦ä¸šåŠ¡ï¼šè´¦æˆ·Aæ‰£æ¬¾ + è´¦æˆ·Bå…¥è´¦ + äº¤æ˜“è®°å½•
- ç†è´¢è´­ä¹°ï¼šèµ„é‡‘å†»ç»“ + ä»½é¢åˆ†é… + æ”¶ç›Šè®¡ç®—
- è¿˜æ¬¾å¤„ç†ï¼šæœ¬é‡‘æ‰£é™¤ + åˆ©æ¯è®¡ç®— + çŠ¶æ€æ›´æ–°

**ç‰©æµç³»ç»Ÿåº”ç”¨**ï¼š
- å‘è´§æµç¨‹ï¼šåº“å­˜å‡ºåº“ + ç‰©æµåˆ›å»º + çŠ¶æ€åŒæ­¥
- ç­¾æ”¶ç¡®è®¤ï¼šç‰©æµå®Œç»“ + è®¢å•å®Œæˆ + è¯„ä»·å¼€å¯

### 10.4 å·¥ç¨‹å®è·µè¦ç‚¹


**å¼€å‘é˜¶æ®µ**ï¼š
```java
// âœ… å¥½çš„å®è·µ
@GlobalTransactional(rollbackFor = Exception.class)
public void businessMethod() {
    // ä¸šåŠ¡é€»è¾‘å°½é‡ç®€æ´
    // é¿å…é•¿æ—¶é—´æ“ä½œ
    // å¼‚å¸¸è¦æ˜ç¡®å¤„ç†
}

// âŒ é¿å…çš„åšæ³•  
@GlobalTransactional
public void badMethod() {
    // ä¸è¦æœ‰å¤ªå¤æ‚çš„ä¸šåŠ¡é€»è¾‘
    // ä¸è¦è°ƒç”¨å¤–éƒ¨æ¥å£
    // ä¸è¦æœ‰æ— å…³çš„æ“ä½œ
}
```

**éƒ¨ç½²é˜¶æ®µ**ï¼š
- ğŸ”§ **é«˜å¯ç”¨éƒ¨ç½²**ï¼šSeata Serveré›†ç¾¤åŒ–
- ğŸ“Š **ç›‘æ§å‘Šè­¦**ï¼šäº‹åŠ¡æˆåŠŸç‡ã€å“åº”æ—¶é—´ç›‘æ§
- ğŸ—„ï¸ **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½äº‹åŠ¡æ—¥å¿—
- ğŸ§ª **ç¾å¤‡æ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¢å¤æµ‹è¯•

**è¿ç»´é˜¶æ®µ**ï¼š
- ğŸ“ˆ **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®ç›‘æ§æ•°æ®ä¼˜åŒ–é…ç½®
- ğŸ§¹ **æ—¥å¿—æ¸…ç†**ï¼šå®šæœŸæ¸…ç†è¿‡æœŸçš„undo_log
- ğŸ”„ **ç‰ˆæœ¬å‡çº§**ï¼šå…³æ³¨Seataç‰ˆæœ¬æ›´æ–°
- ğŸ“ **æ–‡æ¡£ç»´æŠ¤**ï¼šä¿æŒéƒ¨ç½²å’Œé…ç½®æ–‡æ¡£æ›´æ–°

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
åˆ†å¸ƒå¼äº‹åŠ¡è§£éš¾é¢˜ï¼Œå¤šæœåŠ¡åè°ƒè¦ç»Ÿä¸€
CAPç†è®ºåšæƒè¡¡ï¼ŒBASEæ€æƒ³è¦ç‰¢è®°  
Seataæ¡†æ¶æ¥å¸®å¿™ï¼ŒATæ¨¡å¼æœ€çœåŠ›
å‰åé•œåƒåšè¡¥å¿ï¼Œè‡ªåŠ¨å›æ»šå¾ˆç»™åŠ›
```