---
title: 2ã€å‘Šè­¦é€šçŸ¥æ¸ é“é›†æˆé…ç½®
---
## ğŸ“š ç›®å½•


1. [å‘Šè­¦é€šçŸ¥æ¦‚è¿°](#1-å‘Šè­¦é€šçŸ¥æ¦‚è¿°)
2. [é‚®ä»¶é€šçŸ¥é…ç½®](#2-é‚®ä»¶é€šçŸ¥é…ç½®)
3. [é’‰é’‰é›†æˆé…ç½®](#3-é’‰é’‰é›†æˆé…ç½®)
4. [ä¼ä¸šå¾®ä¿¡é›†æˆ](#4-ä¼ä¸šå¾®ä¿¡é›†æˆ)
5. [Webhooké€šç”¨é€šçŸ¥](#5-Webhooké€šç”¨é€šçŸ¥)
6. [çŸ­ä¿¡å‘Šè­¦é…ç½®](#6-çŸ­ä¿¡å‘Šè­¦é…ç½®)
7. [é€šçŸ¥æ¨¡æ¿å®šåˆ¶](#7-é€šçŸ¥æ¨¡æ¿å®šåˆ¶)
8. [å‘Šè­¦å‡çº§æœºåˆ¶](#8-å‘Šè­¦å‡çº§æœºåˆ¶)
9. [é€šçŸ¥å»é‡ç­–ç•¥](#9-é€šçŸ¥å»é‡ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”” å‘Šè­¦é€šçŸ¥æ¦‚è¿°



### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å‘Šè­¦é€šçŸ¥



**ç°å®åœºæ™¯ç†è§£**ï¼š
```
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶é¤å…ï¼š
- å¨æˆ¿ç€ç«äº† â†’ çƒŸé›¾æŠ¥è­¦å™¨å“äº† â†’ ä½ ç«‹å³çŸ¥é“äº†
- é£Ÿæå¿«è¿‡æœŸäº† â†’ ç®¡ç†ç³»ç»Ÿæé†’ä½  â†’ åŠæ—¶å¤„ç†

å¾®æœåŠ¡ç³»ç»Ÿä¹Ÿä¸€æ ·ï¼š
- æœåŠ¡æŒ‚äº† â†’ SkyWalkingæ£€æµ‹åˆ° â†’ ä½†ä½ ä¸çŸ¥é“ï¼ŸâŒ
- å“åº”æ…¢äº† â†’ è§¦å‘å‘Šè­¦è§„åˆ™ â†’ è‡ªåŠ¨é€šçŸ¥ä½  âœ…

å‘Šè­¦é€šçŸ¥ = æŠŠé—®é¢˜åŠæ—¶é€åˆ°ä½ é¢å‰ï¼
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- **åŠæ—¶æ€§**ï¼šé—®é¢˜å‘ç”Ÿç«‹åˆ»çŸ¥é“ï¼Œä¸ç”¨ç›¯ç€ç›‘æ§å¤§å±
- **å¤šæ¸ é“**ï¼šé‚®ä»¶ã€é’‰é’‰ã€å¾®ä¿¡ï¼Œä½ åœ¨å“ªå„¿éƒ½èƒ½æ”¶åˆ°
- **è‡ªåŠ¨åŒ–**ï¼šç³»ç»Ÿè‡ªå·±å‘é€šçŸ¥ï¼Œä¸éœ€è¦äººå·¥æ£€æŸ¥

### 1.2 SkyWalkingæ”¯æŒçš„é€šçŸ¥æ–¹å¼



```
é€šçŸ¥æ¸ é“å…¨å®¶æ¡¶ï¼š

ğŸ“§ é‚®ä»¶é€šçŸ¥
   â””â”€ é€‚åˆï¼šè¯¦ç»†çš„å‘Šè­¦æŠ¥å‘Šï¼Œäº‹åè¿½æº¯
   
ğŸ’¬ å³æ—¶é€šè®¯å·¥å…·
   â”œâ”€ é’‰é’‰ï¼šä¼ä¸šå¸¸ç”¨ï¼Œæ¶ˆæ¯åˆ°è¾¾ç‡é«˜
   â”œâ”€ ä¼ä¸šå¾®ä¿¡ï¼šè…¾è®¯ç³»ä¼ä¸šé¦–é€‰
   â””â”€ Slackï¼šå›½å¤–å›¢é˜Ÿå¸¸ç”¨
   
ğŸ”— Webhookï¼ˆä¸‡èƒ½æ¥å£ï¼‰
   â””â”€ å¯ä»¥å¯¹æ¥ä»»ä½•ç³»ç»Ÿï¼šçŸ­ä¿¡ã€ç”µè¯ã€å·¥å•...
   
ğŸ“± çŸ­ä¿¡/ç”µè¯
   â””â”€ é€‚åˆï¼šç´§æ€¥å‘Šè­¦ï¼Œä¿è¯æ¥æ”¶
```

### 1.3 å‘Šè­¦é€šçŸ¥å·¥ä½œæµç¨‹



```
å®Œæ•´çš„å‘Šè­¦é“¾è·¯ï¼š

ç›‘æ§æ•°æ®é‡‡é›† â†’ å‘Šè­¦è§„åˆ™åˆ¤æ–­ â†’ è§¦å‘å‘Šè­¦ â†’ é€šçŸ¥åˆ†å‘
     â†“              â†“              â†“           â†“
  Agentæ”¶é›†      è§„åˆ™åŒ¹é…      ç”Ÿæˆäº‹ä»¶     å‘é€é€šçŸ¥
     â†“              â†“              â†“           â†“
  æŒ‡æ ‡å…¥åº“      æ£€æŸ¥é˜ˆå€¼      ç»„è£…æ¶ˆæ¯     å¤šæ¸ é“æ¨é€

ä¸¾ä¸ªä¾‹å­ï¼š
1. Agentä¸ŠæŠ¥ï¼šè®¢å•æœåŠ¡å“åº”æ—¶é—´ 2000ms
2. è§„åˆ™åˆ¤æ–­ï¼šè¶…è¿‡é˜ˆå€¼ 1000ms
3. è§¦å‘å‘Šè­¦ï¼šç”Ÿæˆå‘Šè­¦äº‹ä»¶
4. é€šçŸ¥åˆ†å‘ï¼šåŒæ—¶å‘é€é’‰é’‰ + é‚®ä»¶
```

---

## 2. ğŸ“§ é‚®ä»¶é€šçŸ¥é…ç½®



### 2.1 é‚®ä»¶é€šçŸ¥çš„åº”ç”¨åœºæ™¯



**ä»€ä¹ˆæ—¶å€™ç”¨é‚®ä»¶**ï¼š
```
âœ… é€‚åˆåœºæ™¯ï¼š
â€¢ è¯¦ç»†çš„å‘Šè­¦æŠ¥å‘Šï¼ˆåŒ…å«å›¾è¡¨ã€å®Œæ•´æ—¥å¿—ï¼‰
â€¢ éç´§æ€¥å‘Šè­¦ï¼ˆæ¯å¤©æ±‡æ€»ä¸€æ¬¡ï¼‰
â€¢ éœ€è¦å­˜æ¡£è®°å½•çš„å‘Šè­¦
â€¢ å‘ç»™ç®¡ç†å±‚çš„æŠ¥å‘Š

âŒ ä¸é€‚åˆï¼š
â€¢ ç´§æ€¥æ•…éšœï¼ˆå¯èƒ½ä¸åŠæ—¶æŸ¥çœ‹ï¼‰
â€¢ éœ€è¦ç«‹å³å“åº”çš„å‘Šè­¦
```

### 2.2 åŸºç¡€é…ç½®æ­¥éª¤



**ç¬¬ä¸€æ­¥ï¼šé…ç½®SMTPæœåŠ¡å™¨**

åœ¨ `application.yml` ä¸­æ·»åŠ é‚®ä»¶é…ç½®ï¼š

```yaml
# é‚®ä»¶æœåŠ¡å™¨é…ç½®

spring:
  mail:
    host: smtp.example.com        # SMTPæœåŠ¡å™¨åœ°å€
    port: 465                      # ç«¯å£ï¼ˆ465æ˜¯SSLç«¯å£ï¼‰
    username: alert@example.com   # å‘ä»¶é‚®ç®±
    password: your_password        # é‚®ç®±å¯†ç æˆ–æˆæƒç 
    properties:
      mail.smtp.auth: true         # å¼€å¯è®¤è¯
      mail.smtp.ssl.enable: true   # ä½¿ç”¨SSLåŠ å¯†
```

**ç†è§£è¦ç‚¹**ï¼š
- `host`ï¼šé‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼ˆé—®ä½ ä»¬å…¬å¸ITè¦ï¼‰
- `port`ï¼šå¸¸ç”¨ç«¯å£ `25`ï¼ˆæ™®é€šï¼‰ã€`465`ï¼ˆSSLï¼‰ã€`587`ï¼ˆTLSï¼‰
- `password`ï¼šä¸æ˜¯é‚®ç®±ç™»å½•å¯†ç ï¼æ˜¯**æˆæƒç **ï¼ˆé‚®ç®±è®¾ç½®é‡Œç”Ÿæˆï¼‰

**ç¬¬äºŒæ­¥ï¼šé…ç½®å‘Šè­¦Webhook**

åœ¨ `alarm-settings.yml` ä¸­é…ç½®ï¼š

```yaml
# é…ç½®é‚®ä»¶é€šçŸ¥

webhooks:
  - url: http://localhost:8080/send-email
    
rules:
  service_resp_time_rule:
    metrics-name: service_resp_time
    threshold: 1000
    period: 10
    count: 3
    silence-period: 5
#    # æŒ‡å®šä½¿ç”¨é‚®ä»¶é€šçŸ¥
    hooks:
      - http://localhost:8080/send-email
```

### 2.3 é‚®ä»¶å‘é€å®ç°ç¤ºä¾‹



åˆ›å»ºä¸€ä¸ªæ¥æ”¶å‘Šè­¦çš„é‚®ä»¶æœåŠ¡ï¼š

```java
@RestController
public class EmailAlertController {
    
    @Autowired
    private JavaMailSender mailSender;
    
    // æ¥æ”¶SkyWalkingçš„å‘Šè­¦
    @PostMapping("/send-email")
    public void sendAlert(@RequestBody List<AlarmMessage> alerts) {
        for (AlarmMessage alert : alerts) {
            sendEmail(alert);
        }
    }
    
    private void sendEmail(AlarmMessage alert) {
        SimpleMailMessage message = new SimpleMailMessage();
        
        // å‘é€ç»™è°
        message.setTo("ops-team@example.com");
        
        // é‚®ä»¶ä¸»é¢˜
        message.setSubject("ã€å‘Šè­¦ã€‘" + alert.getAlarmMessage());
        
        // é‚®ä»¶å†…å®¹
        String content = String.format(
            "å‘Šè­¦æ—¶é—´: %s\n" +
            "å‘Šè­¦çº§åˆ«: %s\n" +
            "æœåŠ¡åç§°: %s\n" +
            "å‘Šè­¦è¯¦æƒ…: %s\n",
            new Date(),
            alert.getAlarmMessage(),
            alert.getScope(),
            alert.getTags()
        );
        message.setText(content);
        
        // å‘é€
        mailSender.send(message);
    }
}
```

**ä»£ç è§£è¯»**ï¼š
- `@RequestBody`ï¼šæ¥æ”¶SkyWalkingå‘æ¥çš„JSONæ•°æ®
- `List<AlarmMessage>`ï¼šä¸€æ¬¡å¯èƒ½æ”¶åˆ°å¤šä¸ªå‘Šè­¦
- `SimpleMailMessage`ï¼šç®€å•æ–‡æœ¬é‚®ä»¶ï¼ˆä¹Ÿå¯ä»¥ç”¨HTMLæ ¼å¼ï¼‰

### 2.4 é‚®ä»¶æ¨¡æ¿ä¼˜åŒ–



**å‘é€HTMLæ ¼å¼çš„ç²¾ç¾é‚®ä»¶**ï¼š

```java
private void sendHtmlEmail(AlarmMessage alert) {
    MimeMessage message = mailSender.createMimeMessage();
    MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");
    
    helper.setTo("ops-team@example.com");
    helper.setSubject("ã€å‘Šè­¦ã€‘" + alert.getAlarmMessage());
    
    // HTMLé‚®ä»¶å†…å®¹
    String html = 
        "<div style='background:#f5f5f5;padding:20px'>" +
        "  <h2 style='color:red'>âš ï¸ ç³»ç»Ÿå‘Šè­¦é€šçŸ¥</h2>" +
        "  <table style='background:white;padding:15px'>" +
        "    <tr><td>å‘Šè­¦æ—¶é—´ï¼š</td><td>" + new Date() + "</td></tr>" +
        "    <tr><td>æœåŠ¡åç§°ï¼š</td><td>" + alert.getScope() + "</td></tr>" +
        "    <tr><td>å‘Šè­¦å†…å®¹ï¼š</td><td>" + alert.getAlarmMessage() + "</td></tr>" +
        "  </table>" +
        "</div>";
    
    helper.setText(html, true);  // trueè¡¨ç¤ºHTMLæ ¼å¼
    mailSender.send(message);
}
```

---

## 3. ğŸ’¬ é’‰é’‰é›†æˆé…ç½®



### 3.1 é’‰é’‰å‘Šè­¦çš„ä¼˜åŠ¿



**ä¸ºä»€ä¹ˆé€‰æ‹©é’‰é’‰**ï¼š
```
ç›¸æ¯”é‚®ä»¶çš„ä¼˜åŠ¿ï¼š
âœ… å³æ—¶æ€§å¼ºï¼šæ¶ˆæ¯æ¨é€ï¼Œæ‰‹æœºç«‹åˆ»å“
âœ… åˆ°è¾¾ç‡é«˜ï¼šé’‰é’‰æ¶ˆæ¯å¾ˆå°‘è¢«å¿½ç•¥
âœ… æ”¯æŒ@äººï¼šå¯ä»¥ç›´æ¥@è´Ÿè´£äºº
âœ… ç¾¤ç»„é€šçŸ¥ï¼šæ•´ä¸ªè¿ç»´å›¢é˜Ÿéƒ½èƒ½çœ‹åˆ°

å®é™…åœºæ™¯ï¼š
åŠå¤œæœåŠ¡æŒ‚äº† â†’ é’‰é’‰æœºå™¨äººå‘æ¶ˆæ¯ â†’ @å€¼ç­äººå‘˜ â†’ ç«‹å³å¤„ç†
```

### 3.2 é’‰é’‰æœºå™¨äººé…ç½®æ­¥éª¤



**â‘  åˆ›å»ºé’‰é’‰ç¾¤æœºå™¨äºº**ï¼š

```
æ“ä½œæ­¥éª¤ï¼ˆå›¾æ–‡ç‰ˆï¼‰ï¼š

ç¾¤è®¾ç½® â†’ æ™ºèƒ½ç¾¤åŠ©æ‰‹ â†’ æ·»åŠ æœºå™¨äºº â†’ è‡ªå®šä¹‰æœºå™¨äºº
    â†“
è¾“å…¥åå­—ï¼šSkyWalkingå‘Šè­¦æœºå™¨äºº
    â†“
å®‰å…¨è®¾ç½®ï¼šé€‰æ‹©"åŠ ç­¾"æ–¹å¼ï¼ˆæœ€å®‰å…¨ï¼‰
    â†“
å¤åˆ¶ä¸¤ä¸ªé‡è¦ä¿¡æ¯ï¼š
â€¢ Webhookåœ°å€ï¼šhttps://oapi.dingtalk.com/robot/send?access_token=xxx
â€¢ åŠ ç­¾å¯†é’¥ï¼šSECxxxxxxxxxxxx
```

**â‘¡ é…ç½®å‘Šè­¦è§„åˆ™**ï¼š

```yaml
# alarm-settings.yml

webhooks:
  - url: http://localhost:8080/dingtalk-alert

rules:
  service_resp_time_rule:
    metrics-name: service_resp_time
    threshold: 1000
    period: 10
    count: 3
    hooks:
      - http://localhost:8080/dingtalk-alert
```

### 3.3 é’‰é’‰æ¶ˆæ¯å‘é€å®ç°



```java
@RestController
public class DingTalkAlertController {
    
    // é’‰é’‰é…ç½®
    private static final String WEBHOOK = "https://oapi.dingtalk.com/robot/send?access_token=xxx";
    private static final String SECRET = "SECxxxxxxxxxxxx";
    
    @PostMapping("/dingtalk-alert")
    public void sendToDingTalk(@RequestBody List<AlarmMessage> alerts) {
        for (AlarmMessage alert : alerts) {
            sendMessage(alert);
        }
    }
    
    private void sendMessage(AlarmMessage alert) {
        // 1. ç”Ÿæˆç­¾åï¼ˆé’‰é’‰è¦æ±‚ï¼‰
        String timestamp = String.valueOf(System.currentTimeMillis());
        String sign = generateSign(timestamp, SECRET);
        
        // 2. ç»„è£…æ¶ˆæ¯
        Map<String, Object> message = new HashMap<>();
        message.put("msgtype", "text");
        
        Map<String, String> text = new HashMap<>();
        text.put("content", 
            "ã€å‘Šè­¦é€šçŸ¥ã€‘\n" +
            "æœåŠ¡ï¼š" + alert.getScope() + "\n" +
            "å†…å®¹ï¼š" + alert.getAlarmMessage() + "\n" +
            "æ—¶é—´ï¼š" + new Date()
        );
        message.put("text", text);
        
        // 3. @æŒ‡å®šäººå‘˜
        Map<String, Object> at = new HashMap<>();
        at.put("atMobiles", Arrays.asList("13800138000"));  // æ‰‹æœºå·
        at.put("isAtAll", false);  // æ˜¯å¦@æ‰€æœ‰äºº
        message.put("at", at);
        
        // 4. å‘é€è¯·æ±‚
        String url = WEBHOOK + "&timestamp=" + timestamp + "&sign=" + sign;
        // ä½¿ç”¨RestTemplateæˆ–HttpClientå‘é€
        restTemplate.postForObject(url, message, String.class);
    }
    
    // ç”Ÿæˆé’‰é’‰ç­¾å
    private String generateSign(String timestamp, String secret) {
        String stringToSign = timestamp + "\n" + secret;
        Mac mac = Mac.getInstance("HmacSHA256");
        mac.init(new SecretKeySpec(secret.getBytes(), "HmacSHA256"));
        byte[] signData = mac.doFinal(stringToSign.getBytes());
        return URLEncoder.encode(Base64.getEncoder().encodeToString(signData), "UTF-8");
    }
}
```

**ä»£ç è¦ç‚¹**ï¼š
- **ç­¾åæœºåˆ¶**ï¼šé˜²æ­¢æœºå™¨äººè¢«ç›—ç”¨ï¼Œå¿…é¡»è®¡ç®—ç­¾å
- **@åŠŸèƒ½**ï¼š`atMobiles` å¡«å†™è¦@çš„äººçš„æ‰‹æœºå·
- **æ¶ˆæ¯æ ¼å¼**ï¼šæ”¯æŒ `text`ï¼ˆæ–‡æœ¬ï¼‰ã€`markdown`ï¼ˆå¯Œæ–‡æœ¬ï¼‰ç­‰

### 3.4 é’‰é’‰æ¶ˆæ¯è¿›é˜¶ï¼šMarkdownæ ¼å¼



```java
// å‘é€æ›´å¥½çœ‹çš„Markdownæ¶ˆæ¯
Map<String, Object> message = new HashMap<>();
message.put("msgtype", "markdown");

Map<String, String> markdown = new HashMap<>();
markdown.put("title", "SkyWalkingå‘Šè­¦");
markdown.put("text", 
    "## âš ï¸ ç³»ç»Ÿå‘Šè­¦é€šçŸ¥\n\n" +
    "**æœåŠ¡åç§°ï¼š**" + alert.getScope() + "\n\n" +
    "**å‘Šè­¦å†…å®¹ï¼š**" + alert.getAlarmMessage() + "\n\n" +
    "**è§¦å‘æ—¶é—´ï¼š**" + new Date() + "\n\n" +
    "> è¯·ç›¸å…³äººå‘˜åŠæ—¶å¤„ç†"
);
message.put("markdown", markdown);
```

---

## 4. ğŸ¢ ä¼ä¸šå¾®ä¿¡é›†æˆ



### 4.1 ä¼ä¸šå¾®ä¿¡ vs é’‰é’‰



**é€‰æ‹©å»ºè®®**ï¼š
```
ä¼ä¸šå¾®ä¿¡é€‚åˆï¼š
â€¢ å…¬å¸å·²ç»åœ¨ç”¨ä¼ä¸šå¾®ä¿¡åŠå…¬
â€¢ éœ€è¦ä¸å¾®ä¿¡ç”Ÿæ€é›†æˆ
â€¢ å¯¹å®‰å…¨æ€§è¦æ±‚é«˜

é’‰é’‰é€‚åˆï¼š
â€¢ é˜¿é‡Œäº‘ç”Ÿæ€çš„å…¬å¸
â€¢ éœ€è¦ä¸°å¯Œçš„æœºå™¨äººåŠŸèƒ½
â€¢ è¿½æ±‚æ¶ˆæ¯åˆ°è¾¾ç‡

ä¸¤è€…é…ç½®æ–¹å¼åŸºæœ¬ä¸€æ ·ï¼
```

### 4.2 ä¼ä¸šå¾®ä¿¡æœºå™¨äººé…ç½®



**â‘  åˆ›å»ºä¼ä¸šå¾®ä¿¡ç¾¤æœºå™¨äºº**ï¼š

```
ç¾¤èŠè®¾ç½® â†’ ç¾¤æœºå™¨äºº â†’ æ·»åŠ æœºå™¨äºº
    â†“
å¤åˆ¶ Webhook åœ°å€ï¼š
https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx
```

**â‘¡ æ¶ˆæ¯å‘é€å®ç°**ï¼š

```java
@RestController
public class WeChatAlertController {
    
    private static final String WEBHOOK = "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx";
    
    @PostMapping("/wechat-alert")
    public void sendToWeChat(@RequestBody List<AlarmMessage> alerts) {
        for (AlarmMessage alert : alerts) {
            sendMessage(alert);
        }
    }
    
    private void sendMessage(AlarmMessage alert) {
        Map<String, Object> message = new HashMap<>();
        message.put("msgtype", "text");
        
        Map<String, Object> text = new HashMap<>();
        text.put("content", 
            "ã€SkyWalkingå‘Šè­¦ã€‘\n" +
            "æœåŠ¡ï¼š" + alert.getScope() + "\n" +
            "è¯¦æƒ…ï¼š" + alert.getAlarmMessage()
        );
        
        // å¯ä»¥@æŒ‡å®šäºº
        text.put("mentioned_mobile_list", Arrays.asList("13800138000"));
        
        message.put("text", text);
        
        restTemplate.postForObject(WEBHOOK, message, String.class);
    }
}
```

**ä¼ä¸šå¾®ä¿¡ç‰¹è‰²åŠŸèƒ½**ï¼š

```java
// å‘é€å›¾æ–‡æ¶ˆæ¯ï¼ˆå¸¦é“¾æ¥ï¼‰
Map<String, Object> news = new HashMap<>();
news.put("msgtype", "news");

Map<String, Object> articles = new HashMap<>();
articles.put("title", "æœåŠ¡å‘Šè­¦é€šçŸ¥");
articles.put("description", alert.getAlarmMessage());
articles.put("url", "http://skywalking.example.com");  // ç‚¹å‡»è·³è½¬
articles.put("picurl", "http://example.com/alert.png");  // å›¾ç‰‡

message.put("news", Map.of("articles", Arrays.asList(articles)));
```

---

## 5. ğŸ”— Webhooké€šç”¨é€šçŸ¥



### 5.1 ä»€ä¹ˆæ˜¯Webhook



**é€šä¿—ç†è§£**ï¼š
```
Webhook = åå‘è°ƒç”¨ = å›è°ƒæ¥å£

æ­£å¸¸æµç¨‹ï¼šä½ ä¸»åŠ¨å»é“¶è¡ŒæŸ¥ä½™é¢
Webhookï¼šä½™é¢å˜åŠ¨æ—¶ï¼Œé“¶è¡Œä¸»åŠ¨é€šçŸ¥ä½ 

SkyWalking Webhookï¼š
å‘Šè­¦è§¦å‘ â†’ SkyWalkingä¸»åŠ¨è°ƒç”¨ä½ çš„æ¥å£ â†’ ä½ æ”¶åˆ°é€šçŸ¥
```

### 5.2 Webhooké…ç½®æ–¹å¼



**åŸºç¡€é…ç½®**ï¼š

```yaml
# alarm-settings.yml

webhooks:
#  # å¯ä»¥é…ç½®å¤šä¸ªWebhook
  - url: http://localhost:8080/alert/webhook1
  - url: http://localhost:8080/alert/webhook2
  - url: http://sms-service/send-sms      # çŸ­ä¿¡æœåŠ¡
  - url: http://ticket-system/create      # åˆ›å»ºå·¥å•

rules:
  service_resp_time_rule:
    metrics-name: service_resp_time
    threshold: 1000
    hooks:
      - http://localhost:8080/alert/webhook1
      - http://sms-service/send-sms
```

**å…³é”®ç†è§£**ï¼š
- Webhookå°±æ˜¯ä¸€ä¸ªHTTPæ¥å£åœ°å€
- SkyWalkingä¼šPOSTè¯·æ±‚è¿™ä¸ªåœ°å€
- ä½ çš„æœåŠ¡æ¥æ”¶åˆ°è¯·æ±‚åï¼Œçˆ±æ€ä¹ˆå¤„ç†å°±æ€ä¹ˆå¤„ç†

### 5.3 é€šç”¨Webhookå¤„ç†å™¨



```java
@RestController
@RequestMapping("/alert")
public class UniversalWebhookController {
    
    @Autowired
    private SmsService smsService;
    
    @Autowired
    private TicketService ticketService;
    
    @Autowired
    private SlackService slackService;
    
    // é€šç”¨å‘Šè­¦å¤„ç†
    @PostMapping("/webhook")
    public void handleAlert(@RequestBody List<AlarmMessage> alerts) {
        for (AlarmMessage alert : alerts) {
            
            // 1. åˆ¤æ–­å‘Šè­¦çº§åˆ«
            String level = determineLevel(alert);
            
            // 2. æ ¹æ®çº§åˆ«é€‰æ‹©é€šçŸ¥æ–¹å¼
            switch (level) {
                case "CRITICAL":  // ç´§æ€¥
                    smsService.send(alert);      // å‘çŸ­ä¿¡
                    ticketService.create(alert); // åˆ›å»ºå·¥å•
                    slackService.notify(alert);  // é€šçŸ¥Slack
                    break;
                    
                case "WARNING":   // è­¦å‘Š
                    slackService.notify(alert);
                    break;
                    
                case "INFO":      // ä¿¡æ¯
                    // åªè®°å½•æ—¥å¿—
                    log.info("å‘Šè­¦ä¿¡æ¯: {}", alert);
                    break;
            }
        }
    }
    
    // åˆ¤æ–­å‘Šè­¦çº§åˆ«
    private String determineLevel(AlarmMessage alert) {
        String message = alert.getAlarmMessage();
        
        if (message.contains("å®•æœº") || message.contains("ä¸å¯ç”¨")) {
            return "CRITICAL";
        } else if (message.contains("å“åº”æ…¢") || message.contains("è¶…æ—¶")) {
            return "WARNING";
        } else {
            return "INFO";
        }
    }
}
```

### 5.4 Webhookæ•°æ®æ ¼å¼



**SkyWalkingå‘é€çš„JSONæ ¼å¼**ï¼š

```json
[
  {
    "scopeId": 1,
    "scope": "SERVICE",
    "name": "order-service",
    "id0": "order-service",
    "id1": "",
    "ruleName": "service_resp_time_rule",
    "alarmMessage": "Response time of service order-service is more than 1000ms in 3 minutes",
    "startTime": 1632825600000,
    "tags": {
      "level": "WARNING"
    }
  }
]
```

**å­—æ®µè¯´æ˜**ï¼š
- `scope`ï¼šå‘Šè­¦èŒƒå›´ï¼ˆSERVICEæœåŠ¡ã€ENDPOINTç«¯ç‚¹ç­‰ï¼‰
- `name`ï¼šå…·ä½“çš„æœåŠ¡åæˆ–ç«¯ç‚¹å
- `ruleName`ï¼šè§¦å‘çš„è§„åˆ™åç§°
- `alarmMessage`ï¼šå‘Šè­¦æ¶ˆæ¯å†…å®¹
- `tags`ï¼šè‡ªå®šä¹‰æ ‡ç­¾

---

## 6. ğŸ“± çŸ­ä¿¡å‘Šè­¦é…ç½®



### 6.1 çŸ­ä¿¡å‘Šè­¦åº”ç”¨åœºæ™¯



**ä»€ä¹ˆæ—¶å€™ç”¨çŸ­ä¿¡**ï¼š
```
âœ… å¿…é¡»ç”¨çŸ­ä¿¡çš„åœºæ™¯ï¼š
â€¢ P0çº§åˆ«æ•…éšœï¼ˆæ ¸å¿ƒæœåŠ¡å®•æœºï¼‰
â€¢ åŠå¤œå‘Šè­¦ï¼ˆç¡®ä¿èƒ½è¢«å«é†’ï¼‰
â€¢ é‡è¦é¢†å¯¼å…³æ³¨çš„æŒ‡æ ‡
â€¢ èµ„é‡‘ç›¸å…³çš„å¼‚å¸¸

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
â€¢ çŸ­ä¿¡æœ‰æˆæœ¬ï¼ˆæ¯æ¡å‡ åˆ†é’±ï¼‰
â€¢ é¿å…çŸ­ä¿¡è½°ç‚¸ï¼ˆåšå¥½å»é‡ï¼‰
â€¢ å†…å®¹è¦ç²¾ç®€ï¼ˆä¸€æ¡70å­—ï¼‰
```

### 6.2 å¯¹æ¥çŸ­ä¿¡æœåŠ¡å•†



**å¸¸è§çŸ­ä¿¡æœåŠ¡å•†**ï¼š
- é˜¿é‡Œäº‘çŸ­ä¿¡
- è…¾è®¯äº‘çŸ­ä¿¡
- äº‘ç‰‡ç½‘
- ......

**ä»¥é˜¿é‡Œäº‘ä¸ºä¾‹**ï¼š

```java
@Service
public class SmsAlertService {
    
    private static final String ACCESS_KEY = "your_access_key";
    private static final String SECRET_KEY = "your_secret_key";
    private static final String SIGN_NAME = "è¿ç»´å‘Šè­¦";      // çŸ­ä¿¡ç­¾å
    private static final String TEMPLATE_CODE = "SMS_12345"; // æ¨¡æ¿ç¼–å·
    
    // å‘é€çŸ­ä¿¡
    public void sendSms(AlarmMessage alert) {
        // 1. åˆå§‹åŒ–å®¢æˆ·ç«¯
        DefaultProfile profile = DefaultProfile.getProfile(
            "cn-hangzhou", ACCESS_KEY, SECRET_KEY
        );
        IAcsClient client = new DefaultAcsClient(profile);
        
        // 2. ç»„è£…è¯·æ±‚
        SendSmsRequest request = new SendSmsRequest();
        request.setPhoneNumbers("13800138000");  // æ¥æ”¶äººæ‰‹æœºå·
        request.setSignName(SIGN_NAME);
        request.setTemplateCode(TEMPLATE_CODE);
        
        // 3. æ¨¡æ¿å‚æ•°
        Map<String, String> params = new HashMap<>();
        params.put("service", alert.getScope());
        params.put("content", alert.getAlarmMessage());
        request.setTemplateParam(JSON.toJSONString(params));
        
        // 4. å‘é€
        SendSmsResponse response = client.getAcsResponse(request);
        
        if (!"OK".equals(response.getCode())) {
            log.error("çŸ­ä¿¡å‘é€å¤±è´¥: {}", response.getMessage());
        }
    }
}
```

**çŸ­ä¿¡æ¨¡æ¿ç¤ºä¾‹**ï¼š
```
ã€è¿ç»´å‘Šè­¦ã€‘æœåŠ¡${service}å‡ºç°å¼‚å¸¸ï¼š${content}ï¼Œè¯·åŠæ—¶å¤„ç†ã€‚
```

### 6.3 çŸ­ä¿¡å‘Šè­¦æœ€ä½³å®è·µ



**â‘  è®¾ç½®å‘é€é¢‘ç‡é™åˆ¶**ï¼š

```java
@Service
public class SmartSmsService {
    
    // è®°å½•æœ€è¿‘å‘é€æ—¶é—´ï¼ˆé˜²æ­¢çŸ­æ—¶é—´é‡å¤å‘é€ï¼‰
    private Map<String, Long> lastSendTime = new ConcurrentHashMap<>();
    
    public void sendSms(AlarmMessage alert) {
        String key = alert.getScope() + "_" + alert.getRuleName();
        Long last = lastSendTime.get(key);
        
        // 5åˆ†é’Ÿå†…åŒä¸€å‘Šè­¦åªå‘ä¸€æ¬¡
        if (last != null && System.currentTimeMillis() - last < 5 * 60 * 1000) {
            log.info("çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹ï¼Œè·³è¿‡ï¼š{}", key);
            return;
        }
        
        // å‘é€çŸ­ä¿¡
        actualSendSms(alert);
        
        // è®°å½•å‘é€æ—¶é—´
        lastSendTime.put(key, System.currentTimeMillis());
    }
}
```

**â‘¡ åŒºåˆ†å·¥ä½œæ—¶é—´å’Œéå·¥ä½œæ—¶é—´**ï¼š

```java
public void sendSms(AlarmMessage alert) {
    LocalTime now = LocalTime.now();
    
    // åˆ¤æ–­æ˜¯å¦å·¥ä½œæ—¶é—´ï¼ˆ9:00-18:00ï¼‰
    boolean isWorkTime = now.isAfter(LocalTime.of(9, 0)) 
                      && now.isBefore(LocalTime.of(18, 0));
    
    if (!isWorkTime) {
        // éå·¥ä½œæ—¶é—´ï¼Œåªå‘ç´§æ€¥å‘Šè­¦
        if (alert.getTags().get("level").equals("CRITICAL")) {
            actualSendSms(alert);
        }
    } else {
        // å·¥ä½œæ—¶é—´ï¼Œæ‰€æœ‰å‘Šè­¦éƒ½å‘
        actualSendSms(alert);
    }
}
```

---

## 7. ğŸ“ é€šçŸ¥æ¨¡æ¿å®šåˆ¶



### 7.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ¨¡æ¿



**é»˜è®¤æ¨¡æ¿çš„é—®é¢˜**ï¼š
```
é»˜è®¤å‘Šè­¦æ¶ˆæ¯ï¼š
"Response time of service order-service is more than 1000ms in 3 minutes"

é—®é¢˜ï¼š
âŒ å¤ªæŠ€æœ¯åŒ–ï¼Œé¢†å¯¼çœ‹ä¸æ‡‚
âŒ ä¿¡æ¯ä¸å…¨ï¼Œç¼ºå°‘å…³é”®ä¸Šä¸‹æ–‡
âŒ æ²¡æœ‰å¤„ç†å»ºè®®

ç†æƒ³çš„å‘Šè­¦æ¶ˆæ¯ï¼š
âš ï¸ã€ç´§æ€¥ã€‘è®¢å•æœåŠ¡å“åº”è¿‡æ…¢
â€¢ æœåŠ¡åç§°ï¼šorder-service
â€¢ å½“å‰å“åº”ï¼š2000msï¼ˆæ­£å¸¸<1000msï¼‰
â€¢ å½±å“èŒƒå›´ï¼šæ‰€æœ‰ä¸‹å•ç”¨æˆ·
â€¢ å»ºè®®æ“ä½œï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥æ± 
â€¢ è¯¦æƒ…é“¾æ¥ï¼šhttp://skywalking.com/...
```

### 7.2 æ¨¡æ¿è®¾è®¡åŸåˆ™



**å¥½çš„å‘Šè­¦æ¨¡æ¿åº”è¯¥åŒ…å«**ï¼š

```
ğŸ“Œ 5W1HåŸåˆ™ï¼š

Whatï¼ˆæ˜¯ä»€ä¹ˆï¼‰ï¼šå‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜
Whenï¼ˆä»€ä¹ˆæ—¶å€™ï¼‰ï¼šå‘Šè­¦è§¦å‘æ—¶é—´
Whereï¼ˆåœ¨å“ªé‡Œï¼‰ï¼šå“ªä¸ªæœåŠ¡/å“ªå°æœºå™¨
Whyï¼ˆä¸ºä»€ä¹ˆï¼‰ï¼šå¯èƒ½çš„åŸå› åˆ†æ
Whoï¼ˆè°è´Ÿè´£ï¼‰ï¼šåº”è¯¥@è°æ¥å¤„ç†
Howï¼ˆæ€ä¹ˆåŠï¼‰ï¼šå¤„ç†å»ºè®®

å®é™…ç¤ºä¾‹ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ç³»ç»Ÿå‘Šè­¦é€šçŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Whatã€‘è®¢å•æœåŠ¡å“åº”è¶…æ—¶
ã€Whenã€‘2024-09-23 14:30:25
ã€Whereã€‘order-service (10.0.1.23)
ã€Whyã€‘å¯èƒ½åŸå› ï¼šæ•°æ®åº“è¿æ¥è€—å°½
ã€Whoã€‘@å¼ ä¸‰ @æå››
ã€Howã€‘1.æ£€æŸ¥DBè¿æ¥æ±  2.é‡å¯æœåŠ¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è¯¦æƒ…ï¼šhttp://skywalking.com/...
```

### 7.3 åŠ¨æ€æ¨¡æ¿å®ç°



```java
@Component
public class AlertTemplateService {
    
    // æ¨¡æ¿é…ç½®ï¼ˆå¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶ï¼‰
    private static final String DINGTALK_TEMPLATE = 
        "## âš ï¸ ${title}\n\n" +
        "**æœåŠ¡åç§°ï¼š** ${service}\n\n" +
        "**å‘Šè­¦å†…å®¹ï¼š** ${message}\n\n" +
        "**è§¦å‘æ—¶é—´ï¼š** ${time}\n\n" +
        "**å½“å‰å€¼ï¼š** ${value}\n\n" +
        "**é˜ˆå€¼ï¼š** ${threshold}\n\n" +
        "**å¤„ç†å»ºè®®ï¼š** ${suggestion}\n\n" +
        "> è´Ÿè´£äººï¼š${owner}";
    
    // æ¸²æŸ“æ¨¡æ¿
    public String render(AlarmMessage alert, Map<String, String> extra) {
        String template = DINGTALK_TEMPLATE;
        
        // æ›¿æ¢å˜é‡
        template = template.replace("${title}", getTitle(alert));
        template = template.replace("${service}", alert.getScope());
        template = template.replace("${message}", alert.getAlarmMessage());
        template = template.replace("${time}", formatTime(alert.getStartTime()));
        template = template.replace("${value}", extra.getOrDefault("value", "N/A"));
        template = template.replace("${threshold}", extra.getOrDefault("threshold", "N/A"));
        template = template.replace("${suggestion}", getSuggestion(alert));
        template = template.replace("${owner}", getOwner(alert));
        
        return template;
    }
    
    // æ ¹æ®å‘Šè­¦ç±»å‹ç”Ÿæˆæ ‡é¢˜
    private String getTitle(AlarmMessage alert) {
        String msg = alert.getAlarmMessage();
        if (msg.contains("response time")) {
            return "ã€æ€§èƒ½å‘Šè­¦ã€‘æœåŠ¡å“åº”ç¼“æ…¢";
        } else if (msg.contains("error rate")) {
            return "ã€é”™è¯¯å‘Šè­¦ã€‘é”™è¯¯ç‡è¿‡é«˜";
        } else {
            return "ã€ç³»ç»Ÿå‘Šè­¦ã€‘";
        }
    }
    
    // ç”Ÿæˆå¤„ç†å»ºè®®
    private String getSuggestion(AlarmMessage alert) {
        String msg = alert.getAlarmMessage();
        if (msg.contains("response time")) {
            return "1. æ£€æŸ¥æ•°æ®åº“æ…¢æŸ¥è¯¢\n2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—\n3. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ";
        } else if (msg.contains("error rate")) {
            return "1. æŸ¥çœ‹å¼‚å¸¸å †æ ˆ\n2. æ£€æŸ¥ä¾èµ–æœåŠ¡\n3. å›æ»šæœ€è¿‘å‘å¸ƒ";
        } else {
            return "è¯·è”ç³»è¿ç»´äººå‘˜";
        }
    }
    
    // ç¡®å®šè´Ÿè´£äºº
    private String getOwner(AlarmMessage alert) {
        String service = alert.getScope();
        
        // æ ¹æ®æœåŠ¡åç¡®å®šè´Ÿè´£äººï¼ˆå¯ä»¥ä»é…ç½®è¯»å–ï¼‰
        Map<String, String> ownerMap = Map.of(
            "order-service", "@å¼ ä¸‰",
            "payment-service", "@æå››",
            "user-service", "@ç‹äº”"
        );
        
        return ownerMap.getOrDefault(service, "@å€¼ç­äººå‘˜");
    }
}
```

### 7.4 å¤šæ¸ é“æ¨¡æ¿ç®¡ç†



```java
@Configuration
public class AlertTemplateConfig {
    
    // é‚®ä»¶æ¨¡æ¿
    @Bean
    public String emailTemplate() {
        return """
            <html>
            <body>
                <h2 style='color:red'>âš ï¸ ${title}</h2>
                <table border='1' style='border-collapse:collapse'>
                    <tr><td>æœåŠ¡åç§°</td><td>${service}</td></tr>
                    <tr><td>å‘Šè­¦æ—¶é—´</td><td>${time}</td></tr>
                    <tr><td>å‘Šè­¦è¯¦æƒ…</td><td>${message}</td></tr>
                    <tr><td>å¤„ç†å»ºè®®</td><td>${suggestion}</td></tr>
                </table>
            </body>
            </html>
            """;
    }
    
    // çŸ­ä¿¡æ¨¡æ¿
    @Bean
    public String smsTemplate() {
        return "ã€å‘Šè­¦ã€‘${service}å‡ºç°${type}ï¼Œ${message}ï¼Œè¯·åŠæ—¶å¤„ç†ã€‚";
    }
    
    // é’‰é’‰æ¨¡æ¿
    @Bean  
    public String dingTalkTemplate() {
        return """
#            ## âš ï¸ ${title}
            
            **æœåŠ¡ï¼š** ${service}
            **è¯¦æƒ…ï¼š** ${message}
            **æ—¶é—´ï¼š** ${time}
            
            > ${suggestion}
            """;
    }
}
```

---

## 8. ğŸ“Š å‘Šè­¦å‡çº§æœºåˆ¶



### 8.1 ä»€ä¹ˆæ˜¯å‘Šè­¦å‡çº§



**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
ä½ å®¶æ¼æ°´äº†ï¼š
â€¢ åˆšå¼€å§‹ï¼šæ»´ç­”æ»´ç­”ï¼Œä½ è‡ªå·±ç”¨ç›†æ¥ç€
â€¢ 10åˆ†é’Ÿåï¼šæ°´è¶Šæ¥è¶Šå¤§ï¼Œå–Šå®¶äººå¸®å¿™
â€¢ 30åˆ†é’Ÿåï¼šå¿«æ·¹äº†ï¼Œèµ¶ç´§å«ç‰©ä¸š
â€¢ 1å°æ—¶åï¼šç‰©ä¸šæä¸å®šï¼ŒæŠ¥ç«è­¦

å‘Šè­¦å‡çº§ = é—®é¢˜æŒç»­å¾—ä¸åˆ°è§£å†³ï¼Œé€çº§ä¸ŠæŠ¥
```

### 8.2 å‡çº§ç­–ç•¥è®¾è®¡



**å¤šçº§å‡çº§æ–¹æ¡ˆ**ï¼š

```
Level 1ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
    â†“ æœªå¤„ç†
    â”œâ†’ å‘é€ï¼šé’‰é’‰æ¶ˆæ¯
    â””â†’ æ¥æ”¶ï¼š@ä¸€çº¿è¿ç»´
    
Level 2ï¼ˆ10åˆ†é’Ÿå†…ï¼‰
    â†“ æœªå¤„ç†
    â”œâ†’ å‘é€ï¼šé’‰é’‰ + é‚®ä»¶ + çŸ­ä¿¡
    â””â†’ æ¥æ”¶ï¼š@è¿ç»´ä¸»ç®¡
    
Level 3ï¼ˆ20åˆ†é’Ÿå†…ï¼‰
    â†“ æœªå¤„ç†
    â”œâ†’ å‘é€ï¼šå…¨éƒ¨æ¸ é“ + ç”µè¯
    â””â†’ æ¥æ”¶ï¼š@æŠ€æœ¯æ€»ç›‘
    
Level 4ï¼ˆ30åˆ†é’Ÿå†…ï¼‰
    â†“ æœªå¤„ç†
    â”œâ†’ å‘é€ï¼šå…¨éƒ¨æ¸ é“
    â””â†’ æ¥æ”¶ï¼š@CTO + åˆ›å»ºP0å·¥å•
```

### 8.3 å‡çº§æœºåˆ¶å®ç°



```java
@Component
public class AlertEscalationService {
    
    @Autowired
    private DingTalkService dingTalkService;
    
    @Autowired
    private SmsService smsService;
    
    @Autowired
    private EmailService emailService;
    
    // å‘Šè­¦çŠ¶æ€è®°å½•
    private Map<String, AlertStatus> alertStatusMap = new ConcurrentHashMap<>();
    
    // å¤„ç†å‘Šè­¦ï¼ˆå¸¦å‡çº§é€»è¾‘ï¼‰
    public void handleWithEscalation(AlarmMessage alert) {
        String key = alert.getScope() + "_" + alert.getRuleName();
        
        // è·å–æˆ–åˆ›å»ºå‘Šè­¦çŠ¶æ€
        AlertStatus status = alertStatusMap.computeIfAbsent(key, 
            k -> new AlertStatus(alert, System.currentTimeMillis())
        );
        
        // è®¡ç®—å‘Šè­¦æŒç»­æ—¶é—´
        long duration = System.currentTimeMillis() - status.getStartTime();
        
        // æ ¹æ®æŒç»­æ—¶é—´å‡çº§
        if (duration < 5 * 60 * 1000) {
            // 5åˆ†é’Ÿå†… - Level 1
            level1Notify(alert);
        } else if (duration < 10 * 60 * 1000) {
            // 10åˆ†é’Ÿå†… - Level 2
            level2Notify(alert);
        } else if (duration < 20 * 60 * 1000) {
            // 20åˆ†é’Ÿå†… - Level 3
            level3Notify(alert);
        } else {
            // è¶…è¿‡20åˆ†é’Ÿ - Level 4
            level4Notify(alert);
        }
        
        // æ›´æ–°å‘Šè­¦æ¬¡æ•°
        status.incrementCount();
    }
    
    // Level 1ï¼šé’‰é’‰é€šçŸ¥ä¸€çº¿è¿ç»´
    private void level1Notify(AlarmMessage alert) {
        dingTalkService.send(alert, Arrays.asList("13800138000")); // ä¸€çº¿å€¼ç­
    }
    
    // Level 2ï¼šé’‰é’‰+é‚®ä»¶+çŸ­ä¿¡é€šçŸ¥ä¸»ç®¡
    private void level2Notify(AlarmMessage alert) {
        dingTalkService.send(alert, Arrays.asList("13900139000")); // ä¸»ç®¡
        emailService.send(alert, "manager@example.com");
        smsService.send(alert, "13900139000");
    }
    
    // Level 3ï¼šå…¨æ¸ é“é€šçŸ¥æ€»ç›‘
    private void level3Notify(AlarmMessage alert) {
        dingTalkService.send(alert, Arrays.asList("13700137000")); // æ€»ç›‘
        emailService.send(alert, "director@example.com");
        smsService.send(alert, "13700137000");
        // å¯ä»¥åŠ ç”µè¯å‘Šè­¦
    }
    
    // Level 4ï¼šé€šçŸ¥CTO+åˆ›å»ºP0å·¥å•
    private void level4Notify(AlarmMessage alert) {
        dingTalkService.send(alert, Arrays.asList("13600136000")); // CTO
        emailService.send(alert, "cto@example.com");
        smsService.send(alert, "13600136000");
        
        // åˆ›å»ºæœ€é«˜ä¼˜å…ˆçº§å·¥å•
        createP0Ticket(alert);
    }
    
    // å‘Šè­¦çŠ¶æ€ç±»
    @Data
    static class AlertStatus {
        private AlarmMessage alert;
        private long startTime;
        private int notifyCount = 0;
        
        public AlertStatus(AlarmMessage alert, long startTime) {
            this.alert = alert;
            this.startTime = startTime;
        }
        
        public void incrementCount() {
            this.notifyCount++;
        }
    }
}
```

### 8.4 å‡çº§é…ç½®åŒ–



**é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†å‡çº§ç­–ç•¥**ï¼š

```yaml
# alert-escalation.yml

escalation:
  levels:
    - name: "Level1"
      duration: 5           # 5åˆ†é’Ÿ
      channels:
        - dingtalk
      recipients:
        - type: mobile
          value: "13800138000"
    
    - name: "Level2"
      duration: 10          # 10åˆ†é’Ÿ
      channels:
        - dingtalk
        - email
        - sms
      recipients:
        - type: mobile
          value: "13900139000"
        - type: email
          value: "manager@example.com"
    
    - name: "Level3"
      duration: 20          # 20åˆ†é’Ÿ
      channels:
        - dingtalk
        - email
        - sms
        - phone
      recipients:
        - type: mobile
          value: "13700137000"
```

---

## 9. ğŸ”„ é€šçŸ¥å»é‡ç­–ç•¥



### 9.1 ä¸ºä»€ä¹ˆéœ€è¦å»é‡



**å‘Šè­¦è½°ç‚¸çš„ç—›è‹¦**ï¼š
```
æƒ³è±¡è¿™ä¸ªåœºæ™¯ï¼š
æŸæœåŠ¡å‡ºé—®é¢˜ 
â†’ æ¯10ç§’è§¦å‘ä¸€æ¬¡å‘Šè­¦
â†’ 1å°æ—¶æ”¶åˆ°360æ¡é’‰é’‰æ¶ˆæ¯
â†’ æ‰‹æœºå“ä¸ªä¸åœï¼Œæ¶ˆæ¯åˆ·å±
â†’ çœŸæ­£é‡è¦çš„æ¶ˆæ¯è¢«æ·¹æ²¡

ç»“æœï¼š
âŒ ä¿¡æ¯è¿‡è½½ï¼Œæ— æ³•å¤„ç†
âŒ å…³é”®å‘Šè­¦è¢«å¿½ç•¥
âŒ è¿ç»´äººå‘˜å´©æºƒ

å»é‡çš„ç›®æ ‡ï¼š
âœ… ç›¸åŒé—®é¢˜åªé€šçŸ¥ä¸€æ¬¡
âœ… å®šæœŸæ±‡æ€»ï¼Œé¿å…åˆ·å±
âœ… ä¿ç•™é‡è¦å‘Šè­¦
```

### 9.2 å»é‡ç­–ç•¥ç±»å‹



**â‘  æ—¶é—´çª—å£å»é‡**ï¼š

```java
@Service
public class TimeWindowDeduplicationService {
    
    // è®°å½•æœ€è¿‘é€šçŸ¥æ—¶é—´
    private Map<String, Long> lastNotifyTime = new ConcurrentHashMap<>();
    
    // é™é»˜æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
    private static final int SILENCE_MINUTES = 5;
    
    public boolean shouldNotify(AlarmMessage alert) {
        // ç”Ÿæˆå”¯ä¸€key
        String key = alert.getScope() + "_" + alert.getRuleName();
        
        Long lastTime = lastNotifyTime.get(key);
        long now = System.currentTimeMillis();
        
        // é¦–æ¬¡å‘Šè­¦ï¼Œç«‹å³é€šçŸ¥
        if (lastTime == null) {
            lastNotifyTime.put(key, now);
            return true;
        }
        
        // åœ¨é™é»˜æœŸå†…ï¼Œä¸é€šçŸ¥
        if (now - lastTime < SILENCE_MINUTES * 60 * 1000) {
            return false;
        }
        
        // è¶…è¿‡é™é»˜æœŸï¼Œå¯ä»¥é€šçŸ¥
        lastNotifyTime.put(key, now);
        return true;
    }
}
```

**â‘¡ å†…å®¹ç›¸ä¼¼åº¦å»é‡**ï¼š

```java
@Service
public class ContentDeduplicationService {
    
    // è®°å½•æœ€è¿‘çš„å‘Šè­¦æ¶ˆæ¯
    private Map<String, String> lastMessages = new ConcurrentHashMap<>();
    
    public boolean shouldNotify(AlarmMessage alert) {
        String key = alert.getScope();
        String currentMsg = alert.getAlarmMessage();
        String lastMsg = lastMessages.get(key);
        
        // é¦–æ¬¡å‘Šè­¦
        if (lastMsg == null) {
            lastMessages.put(key, currentMsg);
            return true;
        }
        
        // è®¡ç®—ç›¸ä¼¼åº¦
        double similarity = calculateSimilarity(currentMsg, lastMsg);
        
        // ç›¸ä¼¼åº¦è¶…è¿‡80%ï¼Œè®¤ä¸ºæ˜¯é‡å¤å‘Šè­¦
        if (similarity > 0.8) {
            return false;
        }
        
        lastMessages.put(key, currentMsg);
        return true;
    }
    
    // ç®€å•çš„ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆç¼–è¾‘è·ç¦»ï¼‰
    private double calculateSimilarity(String s1, String s2) {
        int distance = levenshteinDistance(s1, s2);
        int maxLen = Math.max(s1.length(), s2.length());
        return 1.0 - (double) distance / maxLen;
    }
}
```

**â‘¢ åˆå¹¶é€šçŸ¥ï¼ˆæ¶ˆæ¯æ±‡æ€»ï¼‰**ï¼š

```java
@Service
public class MergedNotificationService {
    
    // å¾…åˆå¹¶çš„å‘Šè­¦é˜Ÿåˆ—
    private Map<String, List<AlarmMessage>> pendingAlerts = new ConcurrentHashMap<>();
    
    // æ¯5åˆ†é’Ÿæ±‡æ€»ä¸€æ¬¡
    @Scheduled(fixedRate = 5 * 60 * 1000)
    public void sendMergedNotifications() {
        for (Map.Entry<String, List<AlarmMessage>> entry : pendingAlerts.entrySet()) {
            String service = entry.getKey();
            List<AlarmMessage> alerts = entry.getValue();
            
            if (alerts.isEmpty()) {
                continue;
            }
            
            // æ„å»ºæ±‡æ€»æ¶ˆæ¯
            String mergedMsg = buildMergedMessage(service, alerts);
            
            // å‘é€æ±‡æ€»é€šçŸ¥
            dingTalkService.sendText(mergedMsg);
            
            // æ¸…ç©ºé˜Ÿåˆ—
            alerts.clear();
        }
    }
    
    // æ·»åŠ å¾…æ±‡æ€»çš„å‘Šè­¦
    public void addAlert(AlarmMessage alert) {
        String service = alert.getScope();
        pendingAlerts.computeIfAbsent(service, k -> new ArrayList<>()).add(alert);
    }
    
    // æ„å»ºæ±‡æ€»æ¶ˆæ¯
    private String buildMergedMessage(String service, List<AlarmMessage> alerts) {
        StringBuilder sb = new StringBuilder();
        sb.append("## ğŸ“‹ å‘Šè­¦æ±‡æ€»ï¼ˆè¿‡å»5åˆ†é’Ÿï¼‰\n\n");
        sb.append("**æœåŠ¡åç§°ï¼š** ").append(service).append("\n\n");
        sb.append("**å‘Šè­¦æ•°é‡ï¼š** ").append(alerts.size()).append("\n\n");
        sb.append("**å‘Šè­¦è¯¦æƒ…ï¼š**\n");
        
        // æŒ‰ç±»å‹åˆ†ç»„
        Map<String, Long> groupedAlerts = alerts.stream()
            .collect(Collectors.groupingBy(
                AlarmMessage::getRuleName,
                Collectors.counting()
            ));
        
        groupedAlerts.forEach((rule, count) -> {
            sb.append("- ").append(rule).append("ï¼š").append(count).append("æ¬¡\n");
        });
        
        return sb.toString();
    }
}
```

### 9.3 æ™ºèƒ½å»é‡ï¼ˆæœºå™¨å­¦ä¹ ï¼‰



**åŸºäºå†å²æ•°æ®çš„æ™ºèƒ½å»é‡**ï¼š

```java
@Service
public class SmartDeduplicationService {
    
    // å‘Šè­¦å†å²è®°å½•
    private List<AlarmRecord> history = new ArrayList<>();
    
    public boolean shouldNotify(AlarmMessage alert) {
        // 1. è®°å½•å½“å‰å‘Šè­¦
        AlarmRecord record = new AlarmRecord(alert);
        history.add(record);
        
        // 2. åˆ†ææœ€è¿‘1å°æ—¶çš„å‘Šè­¦æ¨¡å¼
        List<AlarmRecord> recentAlerts = getRecentAlerts(60);
        
        // 3. æ£€æµ‹æ˜¯å¦æ˜¯å‘¨æœŸæ€§å‘Šè­¦
        if (isPeriodicAlert(recentAlerts, record)) {
            return false;  // å‘¨æœŸæ€§å‘Šè­¦ï¼Œåªé€šçŸ¥ç¬¬ä¸€æ¬¡
        }
        
        // 4. æ£€æµ‹æ˜¯å¦æ˜¯é›ªå´©å¼å‘Šè­¦
        if (isAvalancheAlert(recentAlerts)) {
            return false;  // é›ªå´©å‘Šè­¦ï¼Œåˆå¹¶é€šçŸ¥
        }
        
        return true;
    }
    
    // æ£€æµ‹å‘¨æœŸæ€§å‘Šè­¦ï¼ˆå¦‚æ¯10åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼‰
    private boolean isPeriodicAlert(List<AlarmRecord> recent, AlarmRecord current) {
        // æŸ¥æ‰¾ç›¸åŒè§„åˆ™çš„å‘Šè­¦
        List<AlarmRecord> sameRule = recent.stream()
            .filter(r -> r.getRuleName().equals(current.getRuleName()))
            .collect(Collectors.toList());
        
        if (sameRule.size() < 3) {
            return false;
        }
        
        // è®¡ç®—æ—¶é—´é—´éš”
        List<Long> intervals = new ArrayList<>();
        for (int i = 1; i < sameRule.size(); i++) {
            long interval = sameRule.get(i).getTime() - sameRule.get(i-1).getTime();
            intervals.add(interval);
        }
        
        // é—´éš”æ–¹å·®å°ï¼Œè®¤ä¸ºæ˜¯å‘¨æœŸæ€§
        double variance = calculateVariance(intervals);
        return variance < 60000;  // æ–¹å·®å°äº1åˆ†é’Ÿ
    }
    
    // æ£€æµ‹é›ªå´©å‘Šè­¦ï¼ˆçŸ­æ—¶é—´å¤§é‡å‘Šè­¦ï¼‰
    private boolean isAvalancheAlert(List<AlarmRecord> recent) {
        // 5åˆ†é’Ÿå†…è¶…è¿‡20æ¡å‘Šè­¦
        long fiveMinutesAgo = System.currentTimeMillis() - 5 * 60 * 1000;
        long count = recent.stream()
            .filter(r -> r.getTime() > fiveMinutesAgo)
            .count();
        
        return count > 20;
    }
}
```

### 9.4 å»é‡é…ç½®æœ€ä½³å®è·µ



**æ¨èçš„å»é‡é…ç½®**ï¼š

```yaml
# deduplication-config.yml

deduplication:
#  # æ—¶é—´çª—å£å»é‡
  time-window:
    enabled: true
    silence-period: 5m        # é™é»˜æœŸ5åˆ†é’Ÿ
    
#  # å†…å®¹å»é‡  
  content:
    enabled: true
    similarity-threshold: 0.8 # ç›¸ä¼¼åº¦é˜ˆå€¼80%
    
#  # æ¶ˆæ¯åˆå¹¶
  merge:
    enabled: true
    interval: 5m              # æ¯5åˆ†é’Ÿæ±‡æ€»ä¸€æ¬¡
    max-count: 10             # è¶…è¿‡10æ¡æ‰æ±‡æ€»
    
#  # æ™ºèƒ½å»é‡
  smart:
    enabled: true
    periodic-detection: true  # æ£€æµ‹å‘¨æœŸæ€§å‘Šè­¦
    avalanche-detection: true # æ£€æµ‹é›ªå´©å‘Šè­¦
    
#  # ä¾‹å¤–è§„åˆ™ï¼ˆä¸å»é‡çš„åœºæ™¯ï¼‰
  exceptions:
    - rule: "service_down"    # æœåŠ¡å®•æœºï¼Œå§‹ç»ˆé€šçŸ¥
    - rule: "critical_error"  # ä¸¥é‡é”™è¯¯ï¼Œå§‹ç»ˆé€šçŸ¥
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 é€šçŸ¥æ¸ é“é€‰æ‹©æŒ‡å—



| æ¸ é“ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æˆæœ¬ |
|------|---------|------|------|------|
| ğŸ“§ **é‚®ä»¶** | `è¯¦ç»†æŠ¥å‘Š`<br>`éç´§æ€¥å‘Šè­¦` | â€¢ å¯å‘é€è¯¦ç»†å†…å®¹<br>â€¢ æ–¹ä¾¿å­˜æ¡£æŸ¥é˜… | â€¢ åˆ°è¾¾ä¸åŠæ—¶<br>â€¢ å®¹æ˜“è¢«å¿½ç•¥ | `ä½` |
| ğŸ’¬ **é’‰é’‰/ä¼å¾®** | `æ—¥å¸¸å‘Šè­¦`<br>`å›¢é˜Ÿåä½œ` | â€¢ å³æ—¶é€è¾¾<br>â€¢ æ”¯æŒ@äºº<br>â€¢ ç¾¤ç»„å¯è§ | â€¢ æ¶ˆæ¯å¯èƒ½è¢«æ·¹æ²¡ | `ä½` |
| ğŸ”— **Webhook** | `ç³»ç»Ÿé›†æˆ`<br>`è‡ªåŠ¨åŒ–å¤„ç†` | â€¢ çµæ´»å¯¹æ¥<br>â€¢ å¯æ‰©å±•æ€§å¼º | â€¢ éœ€è¦å¼€å‘æ¥å£ | `ä½` |
| ğŸ“± **çŸ­ä¿¡** | `ç´§æ€¥å‘Šè­¦`<br>`æ ¸å¿ƒæ•…éšœ` | â€¢ åˆ°è¾¾ç‡æœ€é«˜<br>â€¢ åŠå¤œèƒ½å«é†’ | â€¢ æœ‰æˆæœ¬<br>â€¢ å†…å®¹å—é™ | `é«˜` |

### 10.2 å‘Šè­¦é€šçŸ¥æœ€ä½³å®è·µ



**ğŸ”¸ é…ç½®åŸåˆ™**

```
åˆ†çº§é€šçŸ¥ï¼š
â€¢ P0æ•…éšœ â†’ å…¨æ¸ é“ï¼ˆé’‰é’‰+çŸ­ä¿¡+ç”µè¯ï¼‰
â€¢ P1å‘Šè­¦ â†’ é’‰é’‰+é‚®ä»¶
â€¢ P2å‘Šè­¦ â†’ ä»…é’‰é’‰
â€¢ P3ä¿¡æ¯ â†’ ä»…è®°å½•æ—¥å¿—

æ—¶é—´ç­–ç•¥ï¼š
â€¢ å·¥ä½œæ—¶é—´ï¼ˆ9-18ç‚¹ï¼‰â†’ é’‰é’‰ä¸ºä¸»
â€¢ éå·¥ä½œæ—¶é—´ â†’ ä»…ç´§æ€¥å‘Šè­¦+çŸ­ä¿¡
â€¢ æ·±å¤œï¼ˆ0-7ç‚¹ï¼‰â†’ åªå‘P0æ•…éšœ

äººå‘˜ç­–ç•¥ï¼š
â€¢ ä¸€çº¿è¿ç»´ï¼šæ¥æ”¶æ‰€æœ‰å‘Šè­¦
â€¢ å¼€å‘å›¢é˜Ÿï¼šåªæ¥æ”¶æœ¬æœåŠ¡å‘Šè­¦
â€¢ ç®¡ç†å±‚ï¼šåªæ¥æ”¶P0/P1å‘Šè­¦
```

**ğŸ”¸ é¿å…çš„å‘**

```
âŒ ä¸åšå»é‡ â†’ æ¶ˆæ¯è½°ç‚¸ï¼Œè¿ç»´å´©æºƒ
âŒ å…¨éƒ¨@æ‰€æœ‰äºº â†’ @å¤±å»æ„ä¹‰
âŒ æ¶ˆæ¯å¤ªé•¿ â†’ å…³é”®ä¿¡æ¯è¢«æ·¹æ²¡
âŒ æ²¡æœ‰å‡çº§æœºåˆ¶ â†’ é—®é¢˜æ— äººå¤„ç†
âŒ æ·±å¤œå‘éç´§æ€¥å‘Šè­¦ â†’ å½±å“ä¼‘æ¯

âœ… æ­£ç¡®åšæ³•ï¼š
â€¢ ç›¸åŒå‘Šè­¦5åˆ†é’Ÿå†…åªå‘ä¸€æ¬¡
â€¢ @å…·ä½“è´Ÿè´£äºº
â€¢ æ¶ˆæ¯ç²¾ç®€ï¼Œçªå‡ºé‡ç‚¹
â€¢ æ ¹æ®æ—¶é•¿è‡ªåŠ¨å‡çº§
â€¢ åŒºåˆ†å·¥ä½œ/éå·¥ä½œæ—¶é—´
```

### 10.3 å¿«é€Ÿä¸Šæ‰‹æ£€æŸ¥æ¸…å•



**ğŸ“ é…ç½®æ£€æŸ¥æ¸…å•**ï¼š

```
â–¡ åŸºç¡€é…ç½®
  â”œâ”€ â–¡ é…ç½®SMTPé‚®ä»¶æœåŠ¡å™¨
  â”œâ”€ â–¡ åˆ›å»ºé’‰é’‰/ä¼ä¸šå¾®ä¿¡æœºå™¨äºº
  â”œâ”€ â–¡ è·å–æœºå™¨äººWebhookåœ°å€
  â””â”€ â–¡ é…ç½®çŸ­ä¿¡æœåŠ¡å•†API

â–¡ å‘Šè­¦è§„åˆ™
  â”œâ”€ â–¡ å®šä¹‰å‘Šè­¦è§„åˆ™ï¼ˆå“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰ï¼‰
  â”œâ”€ â–¡ è®¾ç½®åˆç†é˜ˆå€¼
  â””â”€ â–¡ æŒ‡å®šé€šçŸ¥Webhook

â–¡ é€šçŸ¥æ¥å£
  â”œâ”€ â–¡ å®ç°å„æ¸ é“å‘é€ä»£ç 
  â”œâ”€ â–¡ æµ‹è¯•æ¶ˆæ¯æ ¼å¼
  â””â”€ â–¡ éªŒè¯ç­¾åæœºåˆ¶ï¼ˆé’‰é’‰ï¼‰

â–¡ ä¼˜åŒ–é…ç½®
  â”œâ”€ â–¡ é…ç½®å»é‡ç­–ç•¥
  â”œâ”€ â–¡ è®¾ç½®å‘Šè­¦å‡çº§
  â”œâ”€ â–¡ å®šåˆ¶æ¶ˆæ¯æ¨¡æ¿
  â””â”€ â–¡ åŒºåˆ†å·¥ä½œ/éå·¥ä½œæ—¶é—´

â–¡ æµ‹è¯•éªŒè¯
  â”œâ”€ â–¡ æ‰‹åŠ¨è§¦å‘æµ‹è¯•å‘Šè­¦
  â”œâ”€ â–¡ éªŒè¯å„æ¸ é“æ˜¯å¦æ”¶åˆ°
  â”œâ”€ â–¡ æ£€æŸ¥æ¶ˆæ¯å†…å®¹æ­£ç¡®æ€§
  â””â”€ â–¡ æµ‹è¯•@äººåŠŸèƒ½
```

### 10.4 æ•…éšœæ’æŸ¥æŒ‡å—



**ğŸ” å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**ï¼š

```
é—®é¢˜1ï¼šé…ç½®äº†Webhookä½†æ²¡æ”¶åˆ°é€šçŸ¥
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥Webhook URLæ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹SkyWalkingæ—¥å¿—ï¼Œæ˜¯å¦å‘é€æˆåŠŸ
3. ç”¨Postmanæµ‹è¯•æ¥å£æ˜¯å¦å¯è¾¾
4. æ£€æŸ¥é˜²ç«å¢™/ç½‘ç»œæ˜¯å¦é˜»æ–­

é—®é¢˜2ï¼šé’‰é’‰æ¶ˆæ¯å‘é€å¤±è´¥
å¯èƒ½åŸå› ï¼š
â€¢ ç­¾åè®¡ç®—é”™è¯¯ â†’ æ£€æŸ¥SECRETå’Œæ—¶é—´æˆ³
â€¢ IPç™½åå•é™åˆ¶ â†’ æ·»åŠ æœåŠ¡å™¨IP
â€¢ æ¶ˆæ¯æ ¼å¼é”™è¯¯ â†’ å‚è€ƒå®˜æ–¹æ–‡æ¡£

é—®é¢˜3ï¼šæ”¶åˆ°å¤§é‡é‡å¤å‘Šè­¦
è§£å†³æ–¹æ¡ˆï¼š
â€¢ é…ç½®æ—¶é—´çª—å£å»é‡ï¼ˆ5åˆ†é’Ÿï¼‰
â€¢ å¯ç”¨æ¶ˆæ¯åˆå¹¶ï¼ˆæ¯5åˆ†é’Ÿæ±‡æ€»ï¼‰
â€¢ è°ƒæ•´å‘Šè­¦è§„åˆ™é˜ˆå€¼

é—®é¢˜4ï¼šå‘Šè­¦å»¶è¿Ÿï¼Œä¸åŠæ—¶
æ’æŸ¥ï¼š
â€¢ æ£€æŸ¥å‘Šè­¦è§„åˆ™çš„periodå‚æ•°
â€¢ å‡å°‘countæ¬¡æ•°
â€¢ ä¼˜åŒ–Webhookæ¥å£æ€§èƒ½
```

### 10.5 è¿›é˜¶ä¼˜åŒ–æ–¹å‘



**ğŸš€ é«˜çº§ç‰¹æ€§**ï¼š

```
1. åŠ¨æ€è·¯ç”±ï¼šæ ¹æ®å‘Šè­¦å†…å®¹è‡ªåŠ¨é€‰æ‹©é€šçŸ¥æ¸ é“
2. æ™ºèƒ½é™å™ªï¼šæœºå™¨å­¦ä¹ è¯†åˆ«å™ªéŸ³å‘Šè­¦
3. å‘Šè­¦èšåˆï¼šç›¸å…³å‘Šè­¦åˆå¹¶ä¸ºä¸€ä¸ªäº‹ä»¶
4. æ ¹å› åˆ†æï¼šè‡ªåŠ¨åˆ†æå‘Šè­¦æ ¹æœ¬åŸå› 
5. è‡ªåŠ¨æ¢å¤ï¼šè§¦å‘è‡ªåŠ¨ä¿®å¤è„šæœ¬
6. å‘Šè­¦çœ‹æ¿ï¼šå®æ—¶å±•ç¤ºå‘Šè­¦è¶‹åŠ¿
7. å€¼ç­ç®¡ç†ï¼šé›†æˆå€¼ç­æ—¥ç¨‹è¡¨
8. å·¥å•é›†æˆï¼šè‡ªåŠ¨åˆ›å»ºè¿ç»´å·¥å•
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š

```
å‘Šè­¦é€šçŸ¥è¦ç‰¢è®°ï¼Œå¤šç§æ¸ é“æ¥é…ç½®
é‚®ä»¶è¯¦ç»†å¥½å­˜æ¡£ï¼Œé’‰é’‰åŠæ—¶æœ€ç»™åŠ›
çŸ­ä¿¡ç´§æ€¥åŠå¤œç”¨ï¼ŒWebhookå¯¹æ¥ä¸‡èƒ½å™¨

æ¨¡æ¿å®šåˆ¶è¦æ¸…æ™°ï¼Œ5W1Hè®²æ˜ç™½
å»é‡ç­–ç•¥é˜²è½°ç‚¸ï¼Œå‡çº§æœºåˆ¶è¦å»ºç«‹
åˆ†çº§åˆ†æ—¶æ¥é€šçŸ¥ï¼Œè¿ç»´å®‰å¿ƒä¸ç„¦è™‘
```

---

# ğŸ“ å­¦ä¹ å»ºè®®



**æ–°æ‰‹å…¥é—¨è·¯å¾„**ï¼š
1. **å…ˆæŒæ¡ä¸€ç§æ¸ é“**ï¼šå»ºè®®ä»é’‰é’‰å¼€å§‹ï¼Œé…ç½®ç®€å•ã€æ•ˆæœç›´è§‚
2. **ç†è§£æ ¸å¿ƒæ¦‚å¿µ**ï¼šå‘Šè­¦è§„åˆ™â†’è§¦å‘â†’é€šçŸ¥è¿™ä¸ªé“¾è·¯
3. **åŠ¨æ‰‹å®è·µ**ï¼šè‡ªå·±æ­ç¯å¢ƒï¼Œè§¦å‘å‘Šè­¦ï¼Œæ”¶åˆ°é€šçŸ¥
4. **é€æ­¥å®Œå–„**ï¼šåŠ å…¥å»é‡ã€å‡çº§ã€æ¨¡æ¿ç­‰é«˜çº§ç‰¹æ€§
5. **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…ä½¿ç”¨åé¦ˆè°ƒæ•´é…ç½®

è®°ä½ï¼š**å‘Šè­¦é€šçŸ¥çš„æ ¸å¿ƒæ˜¯"åŠæ—¶ã€å‡†ç¡®ã€ä¸æ‰“æ‰°"**ï¼Œæ‰€æœ‰çš„é…ç½®éƒ½å›´ç»•è¿™ä¸‰ä¸ªç›®æ ‡å±•å¼€ï¼