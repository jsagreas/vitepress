---
title: 1ã€Javaåº”ç”¨Agentæ¢é’ˆé›†æˆ
---
## ğŸ“š ç›®å½•

1. [Agentæ¢é’ˆåŸºç¡€æ¦‚å¿µ](#1-Agentæ¢é’ˆåŸºç¡€æ¦‚å¿µ)
2. [Agentä¸‹è½½ä¸å‡†å¤‡](#2-Agentä¸‹è½½ä¸å‡†å¤‡)
3. [JVMå‚æ•°é…ç½®è¯¦è§£](#3-JVMå‚æ•°é…ç½®è¯¦è§£)
4. [æœåŠ¡åç§°ä¸å®ä¾‹é…ç½®](#4-æœåŠ¡åç§°ä¸å®ä¾‹é…ç½®)
5. [æ¢é’ˆæ’ä»¶ç®¡ç†](#5-æ¢é’ˆæ’ä»¶ç®¡ç†)
6. [å¯åŠ¨å‚æ•°å®Œæ•´é…ç½®](#6-å¯åŠ¨å‚æ•°å®Œæ•´é…ç½®)
7. [é…ç½®éªŒè¯ä¸æ•…éšœæ’æŸ¥](#7-é…ç½®éªŒè¯ä¸æ•…éšœæ’æŸ¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Agentæ¢é’ˆåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SkyWalking Agent


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šAgentå°±åƒæ˜¯ç»™ä½ çš„Javaåº”ç”¨è£…ä¸Šçš„"ç›‘æ§æ‘„åƒå¤´"ï¼Œå®æ—¶è§‚å¯Ÿåº”ç”¨è¿è¡Œæƒ…å†µ

**Agentçš„æœ¬è´¨**ï¼š
```
æ™®é€šJavaåº”ç”¨ï¼š
[ä½ çš„ä»£ç ] â†’ JVM â†’ è¿è¡Œ

é›†æˆAgentåï¼š
[ä½ çš„ä»£ç ] â†’ Agentæ¢é’ˆ(è‡ªåŠ¨åŸ‹ç‚¹) â†’ JVM â†’ è¿è¡Œ
              â†“
         æ”¶é›†é“¾è·¯æ•°æ® â†’ å‘é€åˆ°SkyWalkingæœåŠ¡ç«¯
```

**Agentåšäº†ä»€ä¹ˆ**ï¼š
- â‘  **è‡ªåŠ¨åŸ‹ç‚¹**ï¼šæ— éœ€æ”¹ä»£ç ï¼Œè‡ªåŠ¨æ”¶é›†è°ƒç”¨ä¿¡æ¯
- â‘¡ **æ•°æ®é‡‡é›†**ï¼šè®°å½•æ¯æ¬¡è¯·æ±‚çš„è°ƒç”¨é“¾è·¯
- â‘¢**æ€§èƒ½ç›‘æ§**ï¼šç»Ÿè®¡æ–¹æ³•æ‰§è¡Œæ—¶é—´ã€æ•°æ®åº“æŸ¥è¯¢ç­‰
- â‘£ **å¼‚å¸¸æ•è·**ï¼šè‡ªåŠ¨æŠ“å–æŠ¥é”™ä¿¡æ¯

### 1.2 Agentå·¥ä½œåŸç†ï¼ˆæ–°æ‰‹å‹å¥½ç‰ˆï¼‰


**ç®€å•ç†è§£æµç¨‹**ï¼š
```
HTTPè¯·æ±‚è¿›æ¥
    â†“
Agentæ‹¦æˆª â†’ ç”ŸæˆTraceIDï¼ˆé“¾è·¯å”¯ä¸€æ ‡è¯†ï¼‰
    â†“
è°ƒç”¨æœåŠ¡Aæ–¹æ³• â†’ Agentè®°å½•ï¼šè°ƒç”¨æ—¶é—´ã€æ–¹æ³•åã€è€—æ—¶
    â†“
è°ƒç”¨æ•°æ®åº“ â†’ Agentè®°å½•ï¼šSQLè¯­å¥ã€æ‰§è¡Œæ—¶é—´
    â†“
è°ƒç”¨æœåŠ¡B â†’ Agentè®°å½•ï¼šè¿œç¨‹è°ƒç”¨ä¿¡æ¯
    â†“
è¿”å›ç»“æœ â†’ Agentæ±‡æ€»æ‰€æœ‰æ•°æ® â†’ å‘é€åˆ°SkyWalking
```

**æ ¸å¿ƒæŠ€æœ¯**ï¼š
- **å­—èŠ‚ç å¢å¼º**ï¼šAgentåœ¨ç±»åŠ è½½æ—¶ä¿®æ”¹å­—èŠ‚ç 
- **æ— ä¾µå…¥æ€§**ï¼šä¸éœ€è¦æ”¹ä½ çš„ä¸šåŠ¡ä»£ç 
- **è‡ªåŠ¨åŒ–**ï¼šå¯åŠ¨åè‡ªåŠ¨å·¥ä½œï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

---

## 2. ğŸ“¦ Agentä¸‹è½½ä¸å‡†å¤‡


### 2.1 ä¸‹è½½Agentæ¢é’ˆåŒ…


**å®˜æ–¹ä¸‹è½½åœ°å€**ï¼š
```
https://skywalking.apache.org/downloads/
```

**é€‰æ‹©ç‰ˆæœ¬åŸåˆ™**ï¼š
- âœ… **ä¸æœåŠ¡ç«¯ç‰ˆæœ¬ä¸€è‡´**ï¼šAgent 8.x é… SkyWalking 8.x
- âœ… **å…¼å®¹Javaç‰ˆæœ¬**ï¼šJava 8ç”¨8.xï¼ŒJava 17ç”¨9.x+
- âœ… **ç¨³å®šç‰ˆä¼˜å…ˆ**ï¼šç”Ÿäº§ç¯å¢ƒç”¨GAç‰ˆæœ¬

**ä¸‹è½½ç¤ºä¾‹**ï¼š
```bash
# ä¸‹è½½AgentåŒ…ï¼ˆä»¥8.16.0ä¸ºä¾‹ï¼‰
wget https://archive.apache.org/dist/skywalking/java-agent/8.16.0/apache-skywalking-java-agent-8.16.0.tgz

# è§£å‹
tar -zxvf apache-skywalking-java-agent-8.16.0.tgz
```

### 2.2 Agentç›®å½•ç»“æ„è¯´æ˜


```
skywalking-agent/
â”œâ”€â”€ agent/                          # æ ¸å¿ƒç›®å½•
â”‚   â”œâ”€â”€ skywalking-agent.jar       # ä¸»ç¨‹åºï¼ˆå¿…éœ€ï¼‰
â”‚   â”œâ”€â”€ config/                    # é…ç½®ç›®å½•
â”‚   â”‚   â””â”€â”€ agent.config          # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ plugins/                   # æ’ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ apm-toolkit-*.jar     # å„ç§æ¡†æ¶æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ spring-*.jar
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ optional-plugins/          # å¯é€‰æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ trace-ignore-*.jar    # å¿½ç•¥æŸäº›è¯·æ±‚
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ logs/                      # æ—¥å¿—ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â””â”€â”€ LICENSE                        # è®¸å¯è¯æ–‡ä»¶
```

**ç›®å½•è¯´æ˜**ï¼š
- ğŸ“ `agent/`ï¼šå¿…é¡»å®Œæ•´ä¿ç•™ï¼Œé‡Œé¢æ˜¯æ ¸å¿ƒæ–‡ä»¶
- ğŸ“„ `skywalking-agent.jar`ï¼šå¯åŠ¨æ—¶æŒ‡å®šçš„ä¸»jaråŒ…
- âš™ï¸ `config/agent.config`ï¼šæ‰€æœ‰é…ç½®é¡¹éƒ½åœ¨è¿™é‡Œ
- ğŸ”Œ `plugins/`ï¼šé»˜è®¤å¯ç”¨çš„æ’ä»¶ï¼Œä¸è¦åˆ 
- ğŸ”§ `optional-plugins/`ï¼šéœ€è¦æ—¶æ‰‹åŠ¨å¯ç”¨

### 2.3 ç‰ˆæœ¬å…¼å®¹æ€§å¯¹ç…§è¡¨


| **Agentç‰ˆæœ¬** | **æ”¯æŒJavaç‰ˆæœ¬** | **æ”¯æŒæ¡†æ¶** | **æ¨èåœºæ™¯** |
|--------------|---------------|------------|-----------|
| 8.x | `Java 8-11` | `Spring Boot 2.x, Dubbo 2.x` | `ä¼ ç»Ÿå¾®æœåŠ¡` |
| 9.x | `Java 11-17` | `Spring Boot 3.x, Dubbo 3.x` | `æ–°é¡¹ç›®` |
| 10.x | `Java 17-21` | `å…¨æ ˆæ”¯æŒï¼Œè™šæ‹Ÿçº¿ç¨‹` | `å‰æ²¿æŠ€æœ¯æ ˆ` |

**å¿«é€Ÿåˆ¤æ–­**ï¼š
```
ä½ çš„é¡¹ç›®æ˜¯Java 8 + Spring Boot 2.xï¼Ÿ
â†’ ç”¨Agent 8.x

ä½ çš„é¡¹ç›®æ˜¯Java 17 + Spring Boot 3.xï¼Ÿ
â†’ ç”¨Agent 9.x
```

---

## 3. âš™ï¸ JVMå‚æ•°é…ç½®è¯¦è§£


### 3.1 æ ¸å¿ƒJVMå‚æ•°


**æœ€åŸºç¡€çš„é…ç½®ï¼ˆä¸‰ä¸ªå‚æ•°æå®šï¼‰**ï¼š
```bash
-javaagent:/path/to/skywalking-agent.jar
-Dskywalking.agent.service_name=your-service-name
-Dskywalking.collector.backend_service=127.0.0.1:11800
```

**å‚æ•°å«ä¹‰è§£é‡Š**ï¼š

**â‘  `-javaagent`**ï¼šå‘Šè¯‰JVMåŠ è½½Agent
```
-javaagent:/opt/skywalking/agent/skywalking-agent.jar
           â†‘
      Agent jaråŒ…çš„ç»å¯¹è·¯å¾„
```

**â‘¡ `-Dskywalking.agent.service_name`**ï¼šä½ çš„æœåŠ¡å«ä»€ä¹ˆåå­—
```
-Dskywalking.agent.service_name=order-service
                                 â†‘
                            åœ¨ç›‘æ§ç•Œé¢æ˜¾ç¤ºçš„æœåŠ¡å
```

**â‘¢ `-Dskywalking.collector.backend_service`**ï¼šæ•°æ®å‘é€åˆ°å“ªé‡Œ
```
-Dskywalking.collector.backend_service=192.168.1.100:11800
                                        â†‘              â†‘
                                   æœåŠ¡ç«¯IP        é»˜è®¤ç«¯å£
```

### 3.2 å®Œæ•´JVMå¯åŠ¨ç¤ºä¾‹


**Spring Booté¡¹ç›®å¯åŠ¨**ï¼š
```bash
java -javaagent:/opt/skywalking/agent/skywalking-agent.jar \
     -Dskywalking.agent.service_name=order-service \
     -Dskywalking.collector.backend_service=192.168.1.100:11800 \
     -jar order-service.jar
```

**IDEAå¼€å‘ç¯å¢ƒé…ç½®**ï¼š
```
VM optionsä¸­å¡«å†™ï¼š
-javaagent:D:\tools\skywalking-agent\skywalking-agent.jar
-Dskywalking.agent.service_name=my-app
-Dskywalking.collector.backend_service=localhost:11800
```

**Dockerå®¹å™¨å¯åŠ¨**ï¼š
```bash
docker run -d \
  -e JAVA_TOOL_OPTIONS="-javaagent:/opt/skywalking/agent/skywalking-agent.jar" \
  -e SW_AGENT_NAME=order-service \
  -e SW_AGENT_COLLECTOR_BACKEND_SERVICES=192.168.1.100:11800 \
  -v /opt/skywalking/agent:/opt/skywalking/agent \
  your-image:latest
```

### 3.3 é«˜çº§JVMå‚æ•°é…ç½®


**å¸¸ç”¨é«˜çº§å‚æ•°**ï¼š
```bash
# å®Œæ•´ç¤ºä¾‹
java -javaagent:/opt/skywalking/agent/skywalking-agent.jar \
     -Dskywalking.agent.service_name=order-service \
     -Dskywalking.collector.backend_service=192.168.1.100:11800 \
     -Dskywalking.agent.instance_name=order-service-01 \
     -Dskywalking.plugin.mount=trace,webflux \
     -Dskywalking.logging.level=INFO \
     -jar order-service.jar
```

**å‚æ•°è¯´æ˜**ï¼š

| **å‚æ•°** | **ä½œç”¨** | **ç¤ºä¾‹å€¼** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|----------|------------|
| `instance_name` | `å®ä¾‹æ ‡è¯†` | `order-01` | `å¤šå®ä¾‹éƒ¨ç½²æ—¶åŒºåˆ†` |
| `plugin.mount` | `å¯ç”¨æ’ä»¶` | `trace,webflux` | `æŒ‰éœ€åŠ è½½æ’ä»¶` |
| `logging.level` | `æ—¥å¿—çº§åˆ«` | `DEBUG/INFO` | `æ•…éšœæ’æŸ¥` |
| `sample_n_per_3_secs` | `é‡‡æ ·ç‡` | `5` | `æ¯3ç§’é‡‡æ ·5æ¬¡` |

---

## 4. ğŸ·ï¸ æœåŠ¡åç§°ä¸å®ä¾‹é…ç½®


### 4.1 æœåŠ¡åç§°å‘½åè§„èŒƒ


**å¥½çš„å‘½åç¤ºä¾‹**ï¼š
```
âœ… order-service        # è®¢å•æœåŠ¡
âœ… user-service         # ç”¨æˆ·æœåŠ¡
âœ… payment-gateway      # æ”¯ä»˜ç½‘å…³
âœ… product-api          # å•†å“API
```

**ä¸å¥½çš„å‘½åç¤ºä¾‹**ï¼š
```
âŒ service1            # çœ‹ä¸å‡ºæ˜¯ä»€ä¹ˆæœåŠ¡
âŒ è®¢å•æœåŠ¡            # ä¸­æ–‡å¯èƒ½ä¹±ç 
âŒ OrderServiceImpl    # å¤ªåƒç±»å
âŒ my-app             # å¤ªé€šç”¨
```

**å‘½åå»ºè®®**ï¼š
- **å°å†™å­—æ¯**ï¼šorder-serviceï¼ˆæ¨èï¼‰
- **ç”¨æ¨ªæ åˆ†éš”**ï¼šuser-centerï¼ˆä¸è¦ç”¨ä¸‹åˆ’çº¿ï¼‰
- **è¯­ä¹‰æ¸…æ™°**ï¼šä¸€çœ‹å°±çŸ¥é“æ˜¯ä»€ä¹ˆæœåŠ¡
- **ä¸å¾®æœåŠ¡åä¸€è‡´**ï¼šå’ŒSpring Cloudä¸­çš„æœåŠ¡åä¿æŒä¸€è‡´

### 4.2 å®ä¾‹åç§°é…ç½®


**ä¸ºä»€ä¹ˆéœ€è¦å®ä¾‹å**ï¼Ÿ
```
åŒä¸€ä¸ªæœåŠ¡éƒ¨ç½²3å°ï¼š
order-service-01  â† 192.168.1.10
order-service-02  â† 192.168.1.11
order-service-03  â† 192.168.1.12

å¦‚æœä¸é…ç½®å®ä¾‹åï¼Œ3å°æœºå™¨åœ¨ç›‘æ§ç•Œé¢éš¾ä»¥åŒºåˆ†
```

**ä¸‰ç§é…ç½®æ–¹å¼**ï¼š

**â‘  æ‰‹åŠ¨æŒ‡å®š**ï¼š
```bash
-Dskywalking.agent.instance_name=order-service-01
```

**â‘¡ è‡ªåŠ¨ç”Ÿæˆï¼ˆUUIDï¼‰**ï¼š
```bash
# ä¸æŒ‡å®šinstance_nameï¼Œè‡ªåŠ¨ç”Ÿæˆ
# ç”Ÿæˆç±»ä¼¼ï¼šorder-service@192.168.1.10-uuid-12345
```

**â‘¢ ä½¿ç”¨ä¸»æœºå**ï¼š
```bash
-Dskywalking.agent.instance_name=${HOSTNAME}
# Dockerä¸­è‡ªåŠ¨ç”¨å®¹å™¨ID
```

### 4.3 é…ç½®æ–‡ä»¶æ–¹å¼


**ä¿®æ”¹ `agent.config` æ–‡ä»¶**ï¼š
```properties
# æœåŠ¡åé…ç½®
agent.service_name=${SW_AGENT_NAME:order-service}

# å®ä¾‹åé…ç½®
agent.instance_name=${SW_AGENT_INSTANCE_NAME:""}

# åç«¯åœ°å€é…ç½®
collector.backend_service=${SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800}
```

**é…ç½®ä¼˜å…ˆçº§**ï¼š
```
JVMå‚æ•° > ç¯å¢ƒå˜é‡ > agent.configæ–‡ä»¶
```

**æ¨èå®è·µ**ï¼š
```bash
# å¼€å‘ç¯å¢ƒï¼šç”¨JVMå‚æ•°ï¼Œæ–¹ä¾¿è°ƒè¯•
-Dskywalking.agent.service_name=order-service

# ç”Ÿäº§ç¯å¢ƒï¼šç”¨ç¯å¢ƒå˜é‡ï¼Œä¾¿äºå®¹å™¨åŒ–
export SW_AGENT_NAME=order-service
export SW_AGENT_INSTANCE_NAME=$HOSTNAME
```

---

## 5. ğŸ”Œ æ¢é’ˆæ’ä»¶ç®¡ç†


### 5.1 æ’ä»¶åˆ†ç±»è¯´æ˜


**æ’ä»¶ç›®å½•ç»“æ„**ï¼š
```
agent/
â”œâ”€â”€ plugins/              # é»˜è®¤å¯ç”¨çš„æ’ä»¶
â”‚   â”œâ”€â”€ apm-spring-*.jar # Springæ¡†æ¶
â”‚   â”œâ”€â”€ apm-jdbc-*.jar   # æ•°æ®åº“JDBC
â”‚   â”œâ”€â”€ apm-tomcat-*.jar # Tomcatå®¹å™¨
â”‚   â””â”€â”€ ...
â””â”€â”€ optional-plugins/     # å¯é€‰æ’ä»¶ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ï¼‰
    â”œâ”€â”€ apm-trace-ignore-plugin.jar  # å¿½ç•¥æŸäº›è¯·æ±‚
    â”œâ”€â”€ apm-customize-enhance-plugin.jar # è‡ªå®šä¹‰å¢å¼º
    â””â”€â”€ ...
```

**é»˜è®¤æ’ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæ•ˆï¼‰**ï¼š
- âœ… Spring MVC/Boot
- âœ… MyBatis/Hibernate
- âœ… MySQL/Oracle JDBC
- âœ… Tomcat/Jetty
- âœ… Dubbo/gRPC
- âœ… Redis/MongoDB

**å¯é€‰æ’ä»¶ï¼ˆéœ€æ‰‹åŠ¨å¯ç”¨ï¼‰**ï¼š
- ğŸ”§ å¿½ç•¥ç‰¹å®šURLï¼ˆå¥åº·æ£€æŸ¥ç­‰ï¼‰
- ğŸ”§ è‡ªå®šä¹‰æ–¹æ³•è¿½è¸ª
- ğŸ”§ Kafkaæ¶ˆè´¹è€…è¿½è¸ª
- ğŸ”§ Elasticsearchå®¢æˆ·ç«¯

### 5.2 å¯ç”¨å¯é€‰æ’ä»¶


**æ–¹æ³•ä¸€ï¼šç§»åŠ¨æ’ä»¶æ–‡ä»¶**
```bash
# å¯ç”¨trace-ignoreæ’ä»¶
cp agent/optional-plugins/apm-trace-ignore-plugin.jar agent/plugins/

# é‡å¯åº”ç”¨ç”Ÿæ•ˆ
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨æ’ä»¶é€‰æ‹©å™¨**
```bash
# JVMå‚æ•°æŒ‡å®šæ’ä»¶
-Dskywalking.plugin.mount=trace,webflux,kafka

# æˆ–åœ¨agent.configä¸­é…ç½®
plugin.mount=${SW_MOUNT_PLUGINS:default}
```

### 5.3 æ’ä»¶é…ç½®å®ä¾‹


**å¿½ç•¥å¥åº·æ£€æŸ¥è¯·æ±‚**ï¼š
```bash
# 1. å¯ç”¨æ’ä»¶
cp optional-plugins/apm-trace-ignore-plugin.jar plugins/

# 2. é…ç½®å¿½ç•¥è§„åˆ™ï¼ˆagent.configï¼‰
plugin.trace.ignore_path=/actuator/**,/health,/metrics
```

**è¿½è¸ªè‡ªå®šä¹‰æ–¹æ³•**ï¼š
```bash
# 1. å¯ç”¨æ’ä»¶
cp optional-plugins/apm-customize-enhance-plugin.jar plugins/

# 2. é…ç½®è¦è¿½è¸ªçš„æ–¹æ³•ï¼ˆagent.configï¼‰
plugin.customize.enhance_file=custom-enhance.xml
```

**custom-enhance.xmlç¤ºä¾‹**ï¼š
```xml
<enhanced>
  <class class_name="com.example.service.OrderService">
    <method method="createOrder" operation_name="createOrder"/>
  </class>
</enhanced>
```

---

## 6. ğŸš€ å¯åŠ¨å‚æ•°å®Œæ•´é…ç½®


### 6.1 ä¸åŒéƒ¨ç½²æ–¹å¼çš„é…ç½®


**Spring Boot JARåŒ…å¯åŠ¨**ï¼š
```bash
#!/bin/bash
# start.sh

AGENT_PATH=/opt/skywalking/agent/skywalking-agent.jar
SERVICE_NAME=order-service
BACKEND_ADDR=192.168.1.100:11800

java -javaagent:${AGENT_PATH} \
     -Dskywalking.agent.service_name=${SERVICE_NAME} \
     -Dskywalking.collector.backend_service=${BACKEND_ADDR} \
     -jar order-service.jar
```

**Tomcatå®¹å™¨å¯åŠ¨**ï¼š
```bash
# ç¼–è¾‘ catalina.shï¼ˆLinuxï¼‰æˆ– catalina.batï¼ˆWindowsï¼‰
# åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š

export JAVA_OPTS="$JAVA_OPTS \
  -javaagent:/opt/skywalking/agent/skywalking-agent.jar \
  -Dskywalking.agent.service_name=my-web-app \
  -Dskywalking.collector.backend_service=192.168.1.100:11800"

# ç„¶åæ­£å¸¸å¯åŠ¨
./catalina.sh run
```

**Docker Composeé…ç½®**ï¼š
```yaml
version: '3'
services:
  order-service:
    image: order-service:latest
    environment:
      - JAVA_TOOL_OPTIONS=-javaagent:/opt/skywalking/agent/skywalking-agent.jar
      - SW_AGENT_NAME=order-service
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=skywalking-oap:11800
    volumes:
      - ./skywalking-agent:/opt/skywalking/agent
```

**Kubernetesé…ç½®**ï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
spec:
  template:
    spec:
      containers:
      - name: order-service
        image: order-service:latest
        env:
        - name: JAVA_TOOL_OPTIONS
          value: "-javaagent:/opt/skywalking/agent/skywalking-agent.jar"
        - name: SW_AGENT_NAME
          value: "order-service"
        - name: SW_AGENT_COLLECTOR_BACKEND_SERVICES
          value: "skywalking-oap.monitoring:11800"
        volumeMounts:
        - name: skywalking-agent
          mountPath: /opt/skywalking/agent
      volumes:
      - name: skywalking-agent
        hostPath:
          path: /opt/skywalking/agent
```

### 6.2 ç¯å¢ƒå˜é‡é…ç½®å¯¹ç…§è¡¨


| **JVMå‚æ•°** | **ç¯å¢ƒå˜é‡** | **é…ç½®æ–‡ä»¶** | **é»˜è®¤å€¼** |
|-----------|------------|------------|---------|
| `-Dskywalking.agent.service_name` | `SW_AGENT_NAME` | `agent.service_name` | `Your_ApplicationName` |
| `-Dskywalking.collector.backend_service` | `SW_AGENT_COLLECTOR_BACKEND_SERVICES` | `collector.backend_service` | `127.0.0.1:11800` |
| `-Dskywalking.agent.instance_name` | `SW_AGENT_INSTANCE_NAME` | `agent.instance_name` | `è‡ªåŠ¨ç”ŸæˆUUID` |
| `-Dskywalking.logging.level` | `SW_LOGGING_LEVEL` | `logging.level` | `INFO` |

**é€‰æ‹©å»ºè®®**ï¼š
- ğŸ”§ **å¼€å‘é˜¶æ®µ**ï¼šç”¨JVMå‚æ•°ï¼Œæ–¹ä¾¿IDEAè°ƒè¯•
- ğŸ³ **å®¹å™¨éƒ¨ç½²**ï¼šç”¨ç¯å¢ƒå˜é‡ï¼Œç¬¦åˆäº‘åŸç”Ÿå®è·µ
- ğŸ“„ **ä¼ ç»Ÿéƒ¨ç½²**ï¼šç”¨é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç‰ˆæœ¬ç®¡ç†

---

## 7. âœ… é…ç½®éªŒè¯ä¸æ•…éšœæ’æŸ¥


### 7.1 éªŒè¯Agentæ˜¯å¦ç”Ÿæ•ˆ


**â‘  æŸ¥çœ‹å¯åŠ¨æ—¥å¿—**ï¼š
```bash
# AgentæˆåŠŸåŠ è½½ä¼šçœ‹åˆ°ï¼š
INFO  SkyWalking agent initialized
INFO  Connect to SkyWalking OAP server [192.168.1.100:11800] success
```

**â‘¡ æ£€æŸ¥æ—¥å¿—æ–‡ä»¶**ï¼š
```bash
# æŸ¥çœ‹Agentæ—¥å¿—
tail -f skywalking-agent/logs/skywalking-api.log

# æ­£å¸¸è¾“å‡ºï¼š
[skywalking-agent] INFO - Service[order-service] started
[skywalking-agent] INFO - Backend connected
```

**â‘¢ è®¿é—®SkyWalking UI**ï¼š
```
1. è®¿é—® http://192.168.1.100:8080
2. ç‚¹å‡»"æœåŠ¡"èœå•
3. èƒ½çœ‹åˆ°ä½ çš„æœåŠ¡å â†’ é…ç½®æˆåŠŸï¼
```

### 7.2 å¸¸è§é—®é¢˜æ’æŸ¥


**é—®é¢˜1ï¼šå¯åŠ¨åçœ‹ä¸åˆ°æœåŠ¡**

**å¯èƒ½åŸå›  â†’ è§£å†³æ–¹æ¡ˆ**ï¼š
```
âŒ Agent jarè·¯å¾„é”™è¯¯
âœ… æ£€æŸ¥ï¼šls -l /opt/skywalking/agent/skywalking-agent.jar

âŒ OAPæœåŠ¡ç«¯åœ°å€é”™è¯¯
âœ… æ£€æŸ¥ï¼štelnet 192.168.1.100 11800

âŒ æ²¡æœ‰è¯·æ±‚æµé‡
âœ… è§£å†³ï¼šè®¿é—®ä¸€æ¬¡åº”ç”¨æ¥å£ï¼Œè§¦å‘æ•°æ®ä¸ŠæŠ¥
```

**é—®é¢˜2ï¼šæœåŠ¡åæ˜¾ç¤ºä¸º "Your_ApplicationName"**

**åŸå›  â†’ è§£å†³**ï¼š
```
âŒ service_nameå‚æ•°æ²¡ç”Ÿæ•ˆ
âœ… æ£€æŸ¥JVMå‚æ•°æ˜¯å¦æ­£ç¡®
âœ… ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®å¯¼å‡º

# éªŒè¯æ–¹æ³•
jps -v | grep skywalking
# åº”è¯¥çœ‹åˆ°ï¼š-Dskywalking.agent.service_name=xxx
```

**é—®é¢˜3ï¼šæ•°æ®ä¸ä¸ŠæŠ¥**

**æ’æŸ¥æ­¥éª¤**ï¼š
```
â‘  æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
   telnet 192.168.1.100 11800

â‘¡ æŸ¥çœ‹Agentæ—¥å¿—
   grep ERROR skywalking-agent/logs/*.log

â‘¢ æ£€æŸ¥OAPæœåŠ¡çŠ¶æ€
   docker logs skywalking-oap

â‘£ ä¸´æ—¶å¼€å¯DEBUGæ—¥å¿—
   -Dskywalking.logging.level=DEBUG
```

### 7.3 æ•…éšœæ’æŸ¥å‘½ä»¤é€ŸæŸ¥


```bash
# 1. æŸ¥çœ‹Agentæ˜¯å¦åŠ è½½
jps -v | grep javaagent

# 2. æŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå˜é‡
cat /proc/<PID>/environ | tr '\0' '\n' | grep SW_

# 3. å®æ—¶æŸ¥çœ‹Agentæ—¥å¿—
tail -f skywalking-agent/logs/skywalking-api.log

# 4. æ£€æŸ¥ç½‘ç»œè¿æ¥
netstat -an | grep 11800

# 5. éªŒè¯é…ç½®æ–‡ä»¶
cat skywalking-agent/config/agent.config | grep -v '^#'
```

### 7.4 è°ƒè¯•æ¨¡å¼å¼€å¯


**æ–¹æ³•ä¸€ï¼šJVMå‚æ•°**
```bash
-Dskywalking.logging.level=DEBUG
```

**æ–¹æ³•äºŒï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**
```properties
# agent.config
logging.level=${SW_LOGGING_LEVEL:DEBUG}
```

**è°ƒè¯•æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
DEBUG Interceptor[SpringMVCInterceptor] before method
DEBUG Trace segment created: Trace[order-service-xxxx]
DEBUG Span created: GET:/api/order/create
DEBUG Exit span: duration=123ms
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„é…ç½®


```
ğŸ”¸ ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ï¼š
   -javaagent â†’ Agent jaråŒ…è·¯å¾„
   service_name â†’ æœåŠ¡åç§°
   backend_service â†’ OAPæœåŠ¡ç«¯åœ°å€

ğŸ”¸ é…ç½®æ–¹å¼ä¼˜å…ˆçº§ï¼š
   JVMå‚æ•° > ç¯å¢ƒå˜é‡ > agent.config

ğŸ”¸ é»˜è®¤æ’ä»¶è‡ªåŠ¨ç”Ÿæ•ˆï¼Œå¯é€‰æ’ä»¶éœ€æ‰‹åŠ¨å¯ç”¨

ğŸ”¸ æœåŠ¡åè¦è¯­ä¹‰æ¸…æ™°ï¼Œä¸å¾®æœåŠ¡åä¸€è‡´
```

### 8.2 æ–°æ‰‹å¸¸è§é”™è¯¯


```
âŒ Agentè·¯å¾„å†™é”™ â†’ å¯åŠ¨æŠ¥é”™æ‰¾ä¸åˆ°jar
âŒ æœåŠ¡åæ²¡é…ç½® â†’ æ˜¾ç¤ºé»˜è®¤å
âŒ OAPåœ°å€é”™è¯¯ â†’ æ•°æ®æ— æ³•ä¸ŠæŠ¥
âŒ æ’ä»¶å†²çª â†’ éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆ
```

### 8.3 æœ€ä½³å®è·µå»ºè®®


**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
# IDEA VM options
-javaagent:D:\tools\skywalking-agent\skywalking-agent.jar
-Dskywalking.agent.service_name=${spring.application.name}
-Dskywalking.collector.backend_service=localhost:11800
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```bash
# å¯åŠ¨è„šæœ¬
export SW_AGENT_NAME=order-service
export SW_AGENT_COLLECTOR_BACKEND_SERVICES=skywalking.prod:11800
java -javaagent:/opt/skywalking/agent/skywalking-agent.jar -jar app.jar
```

**Dockerç¯å¢ƒ**ï¼š
```yaml
environment:
  - SW_AGENT_NAME=order-service
  - SW_AGENT_COLLECTOR_BACKEND_SERVICES=skywalking-oap:11800
volumes:
  - ./agent:/opt/skywalking/agent
```

### 8.4 å¿«é€ŸéªŒè¯æ¸…å•


**é…ç½®å‰æ£€æŸ¥**ï¼š
- âœ… Agentç‰ˆæœ¬ä¸Javaç‰ˆæœ¬å…¼å®¹
- âœ… Agentç‰ˆæœ¬ä¸OAPç‰ˆæœ¬ä¸€è‡´
- âœ… OAPæœåŠ¡ç«¯å·²å¯åŠ¨ï¼ˆ11800ç«¯å£ï¼‰

**é…ç½®åéªŒè¯**ï¼š
- âœ… å¯åŠ¨æ—¥å¿—å‡ºç° "SkyWalking agent initialized"
- âœ… UIç•Œé¢èƒ½çœ‹åˆ°æœåŠ¡å
- âœ… è®¿é—®æ¥å£åèƒ½çœ‹åˆ°é“¾è·¯æ•°æ®

**æ ¸å¿ƒè®°å¿†**ï¼š
```
Agenté›†æˆä¸‰æ­¥èµ°ï¼š
â‘  ä¸‹è½½è§£å‹AgentåŒ…
â‘¡ æ·»åŠ ä¸‰ä¸ªJVMå‚æ•°
â‘¢ é‡å¯åº”ç”¨éªŒè¯æ•ˆæœ

é…ç½®è¦ç‚¹ï¼š
â€¢ è·¯å¾„è¦å¯¹ï¼Œä¸èƒ½æœ‰ç©ºæ ¼
â€¢ æœåŠ¡åè¦æ¸…æ™°ï¼Œä¾¿äºè¯†åˆ«
â€¢ åœ°å€è¦é€šï¼Œç½‘ç»œè¦è¿é€š
â€¢ æ’ä»¶æŒ‰éœ€å¯ç”¨ï¼Œä¸è¦å…¨å¼€
```