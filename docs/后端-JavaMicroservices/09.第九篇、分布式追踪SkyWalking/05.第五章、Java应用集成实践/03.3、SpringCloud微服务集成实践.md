---
title: 3ã€SpringCloudå¾®æœåŠ¡é›†æˆå®è·µ
---
## ğŸ“š ç›®å½•

1. [Spring Cloudä¸SkyWalkingæ¦‚è¿°](#1-spring-cloudä¸skywalkingæ¦‚è¿°)
2. [Gatewayç½‘å…³é›†æˆè¿½è¸ª](#2-gatewayç½‘å…³é›†æˆè¿½è¸ª)
3. [Feignå®¢æˆ·ç«¯è°ƒç”¨è¿½è¸ª](#3-feignå®¢æˆ·ç«¯è°ƒç”¨è¿½è¸ª)
4. [RestTemplate HTTPè¿½è¸ª](#4-resttemplate-httpè¿½è¸ª)
5. [æœåŠ¡æ³¨å†Œå‘ç°é›†æˆ](#5-æœåŠ¡æ³¨å†Œå‘ç°é›†æˆ)
6. [é…ç½®ä¸­å¿ƒé›†æˆç›‘æ§](#6-é…ç½®ä¸­å¿ƒé›†æˆç›‘æ§)
7. [ç†”æ–­å™¨Hystrixç›‘æ§](#7-ç†”æ–­å™¨hystrixç›‘æ§)
8. [è´Ÿè½½å‡è¡¡è¿½è¸ªä¼˜åŒ–](#8-è´Ÿè½½å‡è¡¡è¿½è¸ªä¼˜åŒ–)
9. [å®Œæ•´å¾®æœåŠ¡é“¾è·¯å®æˆ˜](#9-å®Œæ•´å¾®æœåŠ¡é“¾è·¯å®æˆ˜)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Spring Cloudä¸SkyWalkingæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡è¿½è¸ª


> ğŸ“Œ **æ ¸å¿ƒç†è§£**  
> å¾®æœåŠ¡è¿½è¸ªå°±åƒç»™å¿«é€’åŒ…è£¹è£…GPSå®šä½å™¨ï¼Œèƒ½è¿½è¸ªå®ƒåœ¨å„ä¸ªä¸­è½¬ç«™çš„æµè½¬è¿‡ç¨‹ã€‚åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç”¨æˆ·è¯·æ±‚å¯èƒ½è¦ç»è¿‡åå‡ ä¸ªæœåŠ¡æ‰èƒ½å®Œæˆï¼Œè¿½è¸ªç³»ç»Ÿèƒ½å¸®æˆ‘ä»¬çœ‹æ¸…è¿™ä¸ªè¯·æ±‚çš„å®Œæ•´æ—…ç¨‹ã€‚

**ç”Ÿæ´»åŒ–ç±»æ¯”**ï¼š
```
ç½‘è´­ä¸‹å•è¿‡ç¨‹              å¾®æœåŠ¡è°ƒç”¨é“¾è·¯
    â†“                        â†“
æäº¤è®¢å• â†’ åº“å­˜æ£€æŸ¥       è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡
    â†“                        â†“
æ‰£æ¬¾æ”¯ä»˜ â†’ ç§¯åˆ†å¢åŠ        æ”¯ä»˜æœåŠ¡ â†’ ç§¯åˆ†æœåŠ¡
    â†“                        â†“
å‘è´§é€šçŸ¥ â†’ ç‰©æµæ›´æ–°       é€šçŸ¥æœåŠ¡ â†’ ç‰©æµæœåŠ¡

è¿½è¸ªç³»ç»Ÿï¼šè®°å½•æ¯ä¸ªç¯èŠ‚çš„è€—æ—¶å’ŒçŠ¶æ€
```

### 1.2 Spring CloudæŠ€æœ¯æ ˆä¸è¿½è¸ª


**Spring Cloudæ ¸å¿ƒç»„ä»¶**ï¼š
```
å¾®æœåŠ¡ç”Ÿæ€ç»„ä»¶                     è¿½è¸ªå…³æ³¨ç‚¹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gatewayç½‘å…³    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ å…¥å£æµé‡è¿½è¸ª      â”‚
â”‚  (æµé‡å…¥å£)     â”‚              â”‚ è·¯ç”±è½¬å‘è€—æ—¶      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Feign/OpenFeignâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ æœåŠ¡é—´è°ƒç”¨è¿½è¸ª    â”‚
â”‚  (æœåŠ¡è°ƒç”¨)     â”‚              â”‚ RPCè¯·æ±‚å“åº”ç›‘æ§   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Eureka/Nacos   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ æœåŠ¡å‘ç°è€—æ—¶      â”‚
â”‚  (æ³¨å†Œä¸­å¿ƒ)     â”‚              â”‚ å®ä¾‹é€‰æ‹©è®°å½•      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Configé…ç½®ä¸­å¿ƒ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ é…ç½®è·å–ç›‘æ§      â”‚
â”‚  (é…ç½®ç®¡ç†)     â”‚              â”‚ åˆ·æ–°äº‹ä»¶è¿½è¸ª      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Hystrix/Sentinelâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ ç†”æ–­é™çº§ç›‘æ§      â”‚
â”‚  (æœåŠ¡ä¿æŠ¤)     â”‚              â”‚ é™æµç­–ç•¥è¿½è¸ª      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ribbon/LoadBalancerâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ è´Ÿè½½å‡è¡¡ç­–ç•¥      â”‚
â”‚  (è´Ÿè½½å‡è¡¡)     â”‚              â”‚ å®ä¾‹é€‰æ‹©è®°å½•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 SkyWalkingåœ¨Spring Cloudä¸­çš„ä»·å€¼


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

| ğŸ†š é—®é¢˜åœºæ™¯ | **ä¼ ç»Ÿæ–¹å¼** | **SkyWalkingæ–¹æ¡ˆ** | **ä¸šåŠ¡ä»·å€¼** |
|---------|----------|-----------------|------------|
| è¯·æ±‚å˜æ…¢äº† | çœ‹æ—¥å¿—çŒœæµ‹ | å¯è§†åŒ–é“¾è·¯å›¾ | å¿«é€Ÿå®šä½æ…¢æœåŠ¡ |
| æœåŠ¡è°ƒç”¨å¤±è´¥ | é€ä¸ªæ’æŸ¥ | å¼‚å¸¸èŠ‚ç‚¹æ ‡çº¢ | ç²¾å‡†æ•…éšœå®šä½ |
| æ€§èƒ½ç“¶é¢ˆåˆ†æ | å‹æµ‹çŒœæµ‹ | å®æ—¶æ€§èƒ½æ•°æ® | é’ˆå¯¹æ€§ä¼˜åŒ– |
| æœåŠ¡ä¾èµ–å…³ç³» | æ–‡æ¡£ç»´æŠ¤ | è‡ªåŠ¨æ‹“æ‰‘å›¾ | ç†æ¸…æ¶æ„å…³ç³» |

---

## 2. ğŸšª Gatewayç½‘å…³é›†æˆè¿½è¸ª


### 2.1 Gatewayæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—ç†è§£**  
> Gatewayå°±åƒå°åŒºçš„å¤§é—¨ä¿å®‰ï¼Œæ‰€æœ‰äººè¿›å‡ºå°åŒºéƒ½è¦ç»è¿‡ä»–è¿™é‡Œã€‚åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰å¤–éƒ¨è¯·æ±‚éƒ½å…ˆåˆ°Gatewayï¼Œå®ƒè´Ÿè´£æ£€æŸ¥ã€è½¬å‘åˆ°å…·ä½“çš„æœåŠ¡ã€‚

**Gatewayçš„æ ¸å¿ƒèŒè´£**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯APP  â”‚â”€â”€â”€â”€â†’â”‚   Gateway    â”‚â”€â”€â”€â”€â†’â”‚ è®¢å•æœåŠ¡  â”‚
â”‚ (ç”¨æˆ·)   â”‚     â”‚   (ç½‘å…³)     â”‚     â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚  â‘  è·¯ç”±è½¬å‘   â”‚            â†“
                â”‚  â‘¡ æƒé™éªŒè¯   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  â‘¢ é™æµä¿æŠ¤   â”‚â”€â”€â”€â”€â†’â”‚ å•†å“æœåŠ¡  â”‚
                â”‚  â‘£ æ—¥å¿—è®°å½•   â”‚     â”‚          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Gatewayè¿½è¸ªé‡ç‚¹ï¼š
â€¢ å…¥å£è¯·æ±‚è€—æ—¶ï¼šä»æ¥æ”¶è¯·æ±‚åˆ°è½¬å‘å‡ºå»
â€¢ è·¯ç”±åŒ¹é…æ—¶é—´ï¼šæ‰¾åˆ°æ­£ç¡®çš„åç«¯æœåŠ¡
â€¢ è¿‡æ»¤å™¨æ‰§è¡Œï¼šå„ç§å‰ç½®/åç½®å¤„ç†
```

### 2.2 Gatewayé›†æˆSkyWalking


**ğŸŒ± å…¥é—¨çº§ï¼šè‡ªåŠ¨é›†æˆï¼ˆæœ€ç®€å•ï¼‰**

åªéœ€è¦å¼•å…¥Agentï¼ŒGatewayè‡ªåŠ¨è¢«è¿½è¸ªï¼š

```java
// pom.xml - æ— éœ€é¢å¤–ä¾èµ–
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>

// application.yml - æ­£å¸¸é…ç½®Gatewayè·¯ç”±
spring:
  cloud:
    gateway:
      routes:
        - id: order-service      # è·¯ç”±ID
          uri: lb://order-service # ç›®æ ‡æœåŠ¡ï¼ˆlb=è´Ÿè½½å‡è¡¡ï¼‰
          predicates:
            - Path=/order/**     # åŒ¹é…è·¯å¾„
```

**å¯åŠ¨æ—¶åŠ ä¸ŠSkyWalking Agent**ï¼š
```bash
java -javaagent:/path/to/skywalking-agent.jar \
     -Dskywalking.agent.service_name=api-gateway \
     -jar gateway-service.jar
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šè‡ªå®šä¹‰è¿½è¸ªæ ‡ç­¾**

æœ‰æ—¶æˆ‘ä»¬æƒ³åœ¨è¿½è¸ªæ•°æ®ä¸­åŠ å…¥ä¸šåŠ¡æ ‡è¯†ï¼š

```java
@Component
public class TraceGatewayFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, 
                             GatewayFilterChain chain) {
        // ä»è¯·æ±‚å¤´è·å–ç”¨æˆ·ID
        String userId = exchange.getRequest()
            .getHeaders().getFirst("User-Id");
        
        // æ·»åŠ åˆ°SkyWalkingè¿½è¸ªæ ‡ç­¾ï¼ˆä¸šåŠ¡æ ‡è¯†ï¼‰
        if (userId != null) {
            Tags.of("user.id", userId).set(Tracer.activeSpan());
        }
        
        // è®°å½•è¯·æ±‚è·¯å¾„
        String path = exchange.getRequest().getPath().value();
        Tags.of("request.path", path).set(Tracer.activeSpan());
        
        return chain.filter(exchange);
    }
    
    @Override
    public int getOrder() {
        return -1; // ä¼˜å…ˆçº§æœ€é«˜
    }
}
```

### 2.3 Gatewayè¿½è¸ªæ•ˆæœå±•ç¤º


**åœ¨SkyWalking UIä¸­çœ‹åˆ°çš„ä¿¡æ¯**ï¼š

```
é“¾è·¯è§†å›¾ï¼š
[Gateway] api-gateway (50ms)
    â†“ HTTP GET /order/123
[Service] order-service (200ms)
    â†“ æŸ¥è¯¢æ•°æ®åº“
[Database] MySQL (180ms)

è¿½è¸ªæ ‡ç­¾ï¼š
â€¢ user.id = 10086          â† æˆ‘ä»¬æ·»åŠ çš„ç”¨æˆ·æ ‡è¯†
â€¢ request.path = /order/123 â† è¯·æ±‚è·¯å¾„
â€¢ http.method = GET        â† SkyWalkingè‡ªåŠ¨è®°å½•
â€¢ http.status_code = 200   â† å“åº”çŠ¶æ€
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> Gatewayæ˜¯WebFluxå“åº”å¼ç¼–ç¨‹ï¼Œå’Œä¼ ç»ŸSpringMVCä¸åŒï¼Œä½¿ç”¨`ServerWebExchange`è€Œä¸æ˜¯`HttpServletRequest`

---

## 3. ğŸ“ Feignå®¢æˆ·ç«¯è°ƒç”¨è¿½è¸ª


### 3.1 Feignæ˜¯ä»€ä¹ˆ


> ğŸ“Œ **æ ¸å¿ƒç†è§£**  
> Feignå°±åƒç”µè¯ç°¿ï¼Œä½ ä¸éœ€è¦è®°ä½æ¯ä¸ªæœ‹å‹çš„å·ç ï¼Œåªéœ€è¦åœ¨é€šè®¯å½•æ‰¾åˆ°åå­—ç‚¹å‡»æ‹¨æ‰“å³å¯ã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼ŒFeignè®©æœåŠ¡è°ƒç”¨åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚

**ä¼ ç»ŸHTTPè°ƒç”¨ vs Feignè°ƒç”¨**ï¼š

```java
// ä¼ ç»Ÿæ–¹å¼ï¼šç¹ççš„HTTPè°ƒç”¨
RestTemplate restTemplate = new RestTemplate();
String url = "http://user-service/user/123";
User user = restTemplate.getForObject(url, User.class);

// Feignæ–¹å¼ï¼šåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•
@FeignClient(name = "user-service")  // æŒ‡å®šæœåŠ¡åç§°
public interface UserClient {
    @GetMapping("/user/{id}")        // å®šä¹‰æ¥å£
    User getUser(@PathVariable Long id);
}

// ä½¿ç”¨æ—¶æ³¨å…¥è°ƒç”¨
@Autowired
private UserClient userClient;

User user = userClient.getUser(123L); // ç®€å•è°ƒç”¨
```

**è°ƒç”¨æµç¨‹å¯¹æ¯”**ï¼š
```
Feignè°ƒç”¨è¿‡ç¨‹ï¼š
è®¢å•æœåŠ¡                                       ç”¨æˆ·æœåŠ¡
   â”‚                                            â”‚
   â”œâ”€ userClient.getUser(123) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  (çœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨)                         â”‚
   â”‚                                            â”‚
   â”‚  â† å®é™…ä¸Šç»è¿‡ â”€                            â”‚
   â”‚    â‘  FeignåŠ¨æ€ä»£ç†                         â”‚
   â”‚    â‘¡ æ„é€ HTTPè¯·æ±‚                          â”‚
   â”‚    â‘¢ Ribbonè´Ÿè½½å‡è¡¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
   â”‚    â‘£ å‘é€ç½‘ç»œè¯·æ±‚                          â”‚
   â”‚                                            â”‚
   â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿”å›Userå¯¹è±¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
   â”‚                                            â”‚
```

### 3.2 Feignè¿½è¸ªé›†æˆ


**ğŸŒ± å…¥é—¨çº§ï¼šé›¶é…ç½®è‡ªåŠ¨è¿½è¸ª**

```java
// pom.xml - æ­£å¸¸å¼•å…¥Feignä¾èµ–
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>

// å¯åŠ¨ç±» - å¼€å¯Feign
@SpringBootApplication
@EnableFeignClients  // å¼€å¯Feignå®¢æˆ·ç«¯
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}

// å®šä¹‰Feignæ¥å£
@FeignClient(name = "user-service")  // æœåŠ¡å
public interface UserClient {
    @GetMapping("/user/{id}")
    User getUserById(@PathVariable Long id);
}
```

âœ… **å°±è¿™ä¹ˆç®€å•ï¼** åŠ ä¸ŠSkyWalking Agentåï¼ŒFeignè°ƒç”¨è‡ªåŠ¨è¢«è¿½è¸ª

### 3.3 Feignè°ƒç”¨é“¾è·¯å±•ç¤º


**åœ¨SkyWalkingä¸­çœ‹åˆ°çš„å®Œæ•´é“¾è·¯**ï¼š

```
å®Œæ•´è°ƒç”¨é“¾è·¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service.createOrder() - 500ms     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] æ ¡éªŒè®¢å•å‚æ•° - 10ms                   â”‚
â”‚  â†’ [Exit] Feignè°ƒç”¨ user-service - 200ms        â”‚ â† Feignè¿½è¸ªç‚¹
â”‚     â””â”€ [Entry] user-service.getUser() - 180ms   â”‚
â”‚        â””â”€ [Exit] æŸ¥è¯¢MySQL - 150ms              â”‚
â”‚  â†’ [Exit] Feignè°ƒç”¨ product-service - 150ms     â”‚ â† Feignè¿½è¸ªç‚¹
â”‚     â””â”€ [Entry] product-service.getStock() - 130msâ”‚
â”‚  â†’ [Local] åˆ›å»ºè®¢å•è®°å½• - 80ms                   â”‚
â”‚  â†’ [Exit] ä¿å­˜åˆ°æ•°æ®åº“ - 60ms                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è‡ªåŠ¨è®°å½•çš„ä¿¡æ¯ï¼š
â€¢ è°ƒç”¨çš„ç›®æ ‡æœåŠ¡åç§°ï¼šuser-service
â€¢ è°ƒç”¨çš„æ¥å£è·¯å¾„ï¼šGET /user/123
â€¢ è¯·æ±‚è€—æ—¶ï¼š200ms
â€¢ å“åº”çŠ¶æ€ï¼š200 OK
â€¢ å¼‚å¸¸ä¿¡æ¯ï¼ˆå¦‚æœæœ‰å¤±è´¥ï¼‰
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šæ·»åŠ ä¸šåŠ¡ä¸Šä¸‹æ–‡**

```java
@Component
public class FeignRequestInterceptor implements RequestInterceptor {
    
    @Override
    public void apply(RequestTemplate template) {
        // è·å–å½“å‰è¿½è¸ªä¸Šä¸‹æ–‡
        TraceContext context = ContextManager.capture();
        
        // ä¼ é€’ä¸šåŠ¡ç§Ÿæˆ·IDï¼ˆå¤šç§Ÿæˆ·ç³»ç»Ÿï¼‰
        String tenantId = TenantContext.getCurrentTenantId();
        if (tenantId != null) {
            template.header("X-Tenant-Id", tenantId);
            // è®°å½•åˆ°è¿½è¸ªæ ‡ç­¾
            Tags.of("tenant.id", tenantId).set(Tracer.activeSpan());
        }
        
        // ä¼ é€’ç”¨æˆ·ä¿¡æ¯
        String userId = UserContext.getCurrentUserId();
        if (userId != null) {
            template.header("X-User-Id", userId);
        }
    }
}
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> åœ¨Feignè°ƒç”¨ä¸­ä¼ é€’ä¸šåŠ¡æ ‡è¯†ï¼Œå¯ä»¥åœ¨SkyWalkingä¸­å¿«é€Ÿè¿‡æ»¤å‡ºç‰¹å®šç§Ÿæˆ·æˆ–ç”¨æˆ·çš„è¯·æ±‚é“¾è·¯ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

---

## 4. ğŸŒ RestTemplate HTTPè¿½è¸ª


### 4.1 RestTemplateæ˜¯ä»€ä¹ˆ


> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> RestTemplateæ˜¯Springæä¾›çš„HTTPå®¢æˆ·ç«¯å·¥å…·ï¼Œå°±åƒä½ ç”¨æ‰‹æœºæµè§ˆå™¨è®¿é—®ç½‘é¡µä¸€æ ·ï¼ŒæœåŠ¡ä¹‹é—´ä¹Ÿéœ€è¦å·¥å…·æ¥å‘é€HTTPè¯·æ±‚ï¼ŒRestTemplateå°±æ˜¯è¿™ä¸ªå·¥å…·ã€‚

**ä»€ä¹ˆæ—¶å€™ç”¨RestTemplate**ï¼š

```
Feign vs RestTemplateé€‰æ‹©ï¼š

ä½¿ç”¨Feignï¼š                ä½¿ç”¨RestTemplateï¼š
âœ… æœåŠ¡é—´æ ‡å‡†è°ƒç”¨           âœ… è°ƒç”¨å¤–éƒ¨ç¬¬ä¸‰æ–¹API
âœ… æ¥å£å®šä¹‰æ¸…æ™°             âœ… åŠ¨æ€æ„é€ è¯·æ±‚
âœ… éœ€è¦è´Ÿè½½å‡è¡¡             âœ… çµæ´»çš„è¯·æ±‚å¤„ç†
âœ… ç»Ÿä¸€çš„è°ƒç”¨é£æ ¼           âœ… ç‰¹æ®ŠHTTPåœºæ™¯

ç¤ºä¾‹åœºæ™¯ï¼š
Feign    â†’ è®¢å•æœåŠ¡è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼ˆå†…éƒ¨æœåŠ¡ï¼‰
RestTemplate â†’ è°ƒç”¨å¾®ä¿¡æ”¯ä»˜æ¥å£ï¼ˆå¤–éƒ¨APIï¼‰
```

### 4.2 RestTemplateé›†æˆè¿½è¸ª


**ğŸŒ± å…¥é—¨çº§ï¼šé…ç½®RestTemplate Bean**

```java
@Configuration
public class RestTemplateConfig {
    
    @Bean
    @LoadBalanced  // æ”¯æŒæœåŠ¡åè°ƒç”¨ï¼ˆå¯é€‰ï¼‰
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}
```

âœ… **è‡ªåŠ¨è¿½è¸ª** - åªè¦åŠ äº†SkyWalking Agentï¼ŒRestTemplateçš„HTTPè¯·æ±‚è‡ªåŠ¨è¢«è¿½è¸ª

**åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Service
public class PaymentService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public PaymentResult callWechatPay(PayRequest request) {
        String url = "https://api.weixin.qq.com/pay/unifiedorder";
        
        // SkyWalkingè‡ªåŠ¨è¿½è¸ªè¿™ä¸ªHTTPè¯·æ±‚
        ResponseEntity<PaymentResult> response = 
            restTemplate.postForEntity(url, request, PaymentResult.class);
        
        return response.getBody();
    }
}
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šæ·»åŠ è‡ªå®šä¹‰æ‹¦æˆªå™¨**

```java
@Component
public class TraceRestTemplateInterceptor implements ClientHttpRequestInterceptor {
    
    @Override
    public ClientHttpResponse intercept(HttpRequest request, 
                                        byte[] body, 
                                        ClientHttpRequestExecution execution) {
        // è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        
        // æ·»åŠ è¿½è¸ªæ ‡ç­¾
        Tags.of("http.url", request.getURI().toString())
            .set(Tracer.activeSpan());
        
        // æ‰§è¡Œè¯·æ±‚
        ClientHttpResponse response = execution.execute(request, body);
        
        // è®°å½•å“åº”ä¿¡æ¯
        long duration = System.currentTimeMillis() - startTime;
        Tags.of("http.duration", duration + "ms")
            .set(Tracer.activeSpan());
        
        return response;
    }
}

// é…ç½®æ‹¦æˆªå™¨
@Configuration
public class RestTemplateConfig {
    
    @Autowired
    private TraceRestTemplateInterceptor traceInterceptor;
    
    @Bean
    public RestTemplate restTemplate() {
        RestTemplate restTemplate = new RestTemplate();
        // æ·»åŠ æ‹¦æˆªå™¨
        restTemplate.getInterceptors().add(traceInterceptor);
        return restTemplate;
    }
}
```

### 4.3 RestTemplateè¿½è¸ªæ•ˆæœ


**è¿½è¸ªä¿¡æ¯å±•ç¤º**ï¼š

```
è°ƒç”¨ç¬¬ä¸‰æ–¹APIçš„é“¾è·¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service              â”‚
â”‚        /api/order/create           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] è®¢å•æ•°æ®æ ¡éªŒ - 20ms      â”‚
â”‚  â†’ [Exit] RestTemplate HTTPè¯·æ±‚     â”‚ â† HTTPè¿½è¸ª
â”‚     URL: https://api.weixin.qq.com â”‚
â”‚     Method: POST                   â”‚
â”‚     Duration: 500ms                â”‚
â”‚     Status: 200                    â”‚
â”‚  â†’ [Local] å¤„ç†æ”¯ä»˜ç»“æœ - 30ms      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è‡ªåŠ¨è®°å½•ï¼š
â€¢ è¯·æ±‚URLå®Œæ•´è·¯å¾„
â€¢ HTTPæ–¹æ³•ï¼ˆGET/POSTç­‰ï¼‰
â€¢ è¯·æ±‚è€—æ—¶
â€¢ å“åº”çŠ¶æ€ç 
â€¢ å¼‚å¸¸ä¿¡æ¯ï¼ˆå¦‚è¶…æ—¶ã€ç½‘ç»œé”™è¯¯ï¼‰
```

> âš ï¸ **é‡è¦æç¤º**  
> RestTemplateè°ƒç”¨å¤–éƒ¨APIæ—¶ï¼Œå¯¹æ–¹æœåŠ¡ä¸ä¼šæœ‰è¿½è¸ªä¿¡æ¯ï¼Œé“¾è·¯åœ¨è¿™é‡Œä¼š"æ–­å¼€"ï¼Œä½†è¯·æ±‚æœ¬èº«çš„è€—æ—¶å’Œç»“æœä¼šè¢«è®°å½•

---

## 5. ğŸ“‹ æœåŠ¡æ³¨å†Œå‘ç°é›†æˆ


### 5.1 æœåŠ¡æ³¨å†Œå‘ç°æ˜¯ä»€ä¹ˆ


> ğŸ“Œ **ç”Ÿæ´»åŒ–ç†è§£**  
> æ³¨å†Œä¸­å¿ƒå°±åƒ114ç”µè¯æŸ¥è¯¢å°ï¼Œæ‰€æœ‰æœåŠ¡å¯åŠ¨æ—¶è¦"æŠ¥åˆ°"ï¼ˆæ³¨å†Œï¼‰ï¼Œéœ€è¦è°ƒç”¨å…¶ä»–æœåŠ¡æ—¶æ¥"æŸ¥è¯¢"ï¼ˆå‘ç°ï¼‰ï¼Œè¿™æ ·æœåŠ¡ä¹‹é—´æ‰èƒ½äº’ç›¸æ‰¾åˆ°å¯¹æ–¹ã€‚

**æœåŠ¡æ³¨å†Œå‘ç°æµç¨‹**ï¼š
```
å¾®æœåŠ¡å¯åŠ¨æ³¨å†Œè¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•æœåŠ¡å¯åŠ¨  â”‚         â”‚ Nacosæ³¨å†Œä¸­å¿ƒ â”‚
â”‚ 192.168.1.10 â”‚ â”€â”€â‘ æ³¨å†Œâ†’â”‚              â”‚
â”‚ Port: 8081   â”‚         â”‚ æœåŠ¡åˆ—è¡¨ï¼š    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ order-serviceâ”‚
                         â”‚  â”œâ”€ 192.168.1.10:8081â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â””â”€ 192.168.1.11:8081â”‚
â”‚ ç”¨æˆ·æœåŠ¡å¯åŠ¨  â”‚ â”€â”€â‘¡æ³¨å†Œâ†’â”‚              â”‚
â”‚ 192.168.1.20 â”‚         â”‚ user-service â”‚
â”‚ Port: 8082   â”‚         â”‚  â””â”€ 192.168.1.20:8082â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•æœåŠ¡è¦è°ƒç”¨â”‚ â”€â”€â‘¢æŸ¥è¯¢â†’ è·å–user-serviceåœ°å€åˆ—è¡¨
â”‚ ç”¨æˆ·æœåŠ¡      â”‚         [192.168.1.20:8082]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†â‘£è¿”å›â”€  â†“
        â†“                é€‰æ‹©ä¸€ä¸ªå®ä¾‹è°ƒç”¨
     å‘èµ·è°ƒç”¨
```

### 5.2 Nacosæ³¨å†Œä¸­å¿ƒè¿½è¸ª


**ğŸŒ± å…¥é—¨çº§ï¼šé…ç½®Nacoså®¢æˆ·ç«¯**

```yaml
# application.yml
spring:
  application:
    name: order-service  # æœåŠ¡åç§°
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848  # Nacosåœ°å€
        namespace: dev                # å‘½åç©ºé—´
        group: DEFAULT_GROUP          # åˆ†ç»„
```

```java
// pom.xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

**è‡ªåŠ¨è¿½è¸ªçš„å†…å®¹**ï¼š
- âœ… æœåŠ¡æ³¨å†Œè€—æ—¶
- âœ… å¿ƒè·³æ£€æµ‹è¯·æ±‚
- âœ… æœåŠ¡å‘ç°æŸ¥è¯¢
- âœ… å®ä¾‹åˆ—è¡¨è·å–

### 5.3 æœåŠ¡å‘ç°è¿½è¸ªè¯¦æƒ…


**åœ¨SkyWalkingä¸­çœ‹åˆ°çš„æ³¨å†Œä¸­å¿ƒäº¤äº’**ï¼š

```
æœåŠ¡å¯åŠ¨æ—¶çš„æ³¨å†Œè¿½è¸ªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] åº”ç”¨å¯åŠ¨                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Exit] NacosæœåŠ¡æ³¨å†Œ - 50ms       â”‚
â”‚     è¯·æ±‚: POST /nacos/v1/ns/instance â”‚
â”‚     å‚æ•°: serviceName=order-service  â”‚
â”‚           ip=192.168.1.10            â”‚
â”‚           port=8081                  â”‚
â”‚     ç»“æœ: SUCCESS                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœåŠ¡è°ƒç”¨æ—¶çš„å‘ç°è¿½è¸ªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] å¤„ç†è®¢å•è¯·æ±‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Exit] NacosæŸ¥è¯¢æœåŠ¡ - 10ms       â”‚
â”‚     æŸ¥è¯¢: user-service å®ä¾‹åˆ—è¡¨      â”‚
â”‚     è¿”å›: [192.168.1.20:8082,        â”‚
â”‚            192.168.1.21:8082]        â”‚
â”‚  â†’ [Exit] Feignè°ƒç”¨ user-service     â”‚
â”‚     é€‰æ‹©: 192.168.1.20:8082          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **ä¼˜åŒ–å»ºè®®**  
> Nacoså®¢æˆ·ç«¯æœ‰æœ¬åœ°ç¼“å­˜ï¼Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨éƒ½æŸ¥è¯¢æ³¨å†Œä¸­å¿ƒã€‚SkyWalkingåªè¿½è¸ªå®é™…çš„ç½‘ç»œè¯·æ±‚ï¼Œæœ¬åœ°ç¼“å­˜å‘½ä¸­ä¸ä¼šäº§ç”Ÿè¿½è¸ªè®°å½•

---

## 6. âš™ï¸ é…ç½®ä¸­å¿ƒé›†æˆç›‘æ§


### 6.1 é…ç½®ä¸­å¿ƒçš„ä½œç”¨


> ğŸ“Œ **é€šä¿—ç†è§£**  
> é…ç½®ä¸­å¿ƒå°±åƒå…¬å¸çš„å…¬å‘Šæ ï¼Œæ‰€æœ‰éƒ¨é—¨çš„è§„åˆ™ï¼ˆé…ç½®ï¼‰éƒ½è´´åœ¨è¿™é‡Œï¼Œéœ€è¦æ—¶æ¥æŸ¥çœ‹ï¼Œæ›´æ–°æ—¶ç»Ÿä¸€é€šçŸ¥ï¼Œä¸ç”¨æ¯ä¸ªéƒ¨é—¨è‡ªå·±ç»´æŠ¤ä¸€ä»½ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ä¸­å¿ƒ**ï¼š

```
ä¼ ç»Ÿé…ç½®æ–¹å¼çš„é—®é¢˜ï¼š
æœåŠ¡Aé…ç½®æ–‡ä»¶         æœåŠ¡Bé…ç½®æ–‡ä»¶        æœåŠ¡Cé…ç½®æ–‡ä»¶
database.url=xxx   database.url=xxx   database.url=xxx
  â†“ é—®é¢˜1ï¼šé‡å¤é…ç½®ï¼Œç»´æŠ¤éº»çƒ¦
  â†“ é—®é¢˜2ï¼šä¿®æ”¹é…ç½®è¦é‡å¯æœåŠ¡
  â†“ é—®é¢˜3ï¼šä¸åŒç¯å¢ƒé…ç½®ç®¡ç†æ··ä¹±

é…ç½®ä¸­å¿ƒæ–¹æ¡ˆï¼š
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Nacosé…ç½®ä¸­å¿ƒ â”‚
                â”‚ database.url   â”‚ â† ç»Ÿä¸€å­˜å‚¨
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“     â†“     â†“
              æœåŠ¡A   æœåŠ¡B   æœåŠ¡C  â† ç»Ÿä¸€è·å–
              
ä¼˜åŠ¿ï¼š
âœ… é›†ä¸­ç®¡ç†é…ç½®
âœ… åŠ¨æ€åˆ·æ–°ï¼ˆä¸é‡å¯ï¼‰
âœ… ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»š
âœ… é…ç½®å˜æ›´å®¡è®¡
```

### 6.2 é…ç½®ä¸­å¿ƒè¿½è¸ªé›†æˆ


**ğŸŒ± å…¥é—¨çº§ï¼šNacos Configé…ç½®**

```yaml
# bootstrap.ymlï¼ˆä¼˜å…ˆçº§é«˜äºapplication.ymlï¼‰
spring:
  application:
    name: order-service
  cloud:
    nacos:
      config:
        server-addr: 127.0.0.1:8848  # Nacosåœ°å€
        file-extension: yaml          # é…ç½®æ–‡ä»¶æ ¼å¼
        namespace: dev                # å‘½åç©ºé—´
        group: DEFAULT_GROUP          # åˆ†ç»„
        refresh-enabled: true         # å¼€å¯åŠ¨æ€åˆ·æ–°
```

```java
// ä½¿ç”¨é…ç½®
@RestController
@RefreshScope  // æ”¯æŒåŠ¨æ€åˆ·æ–°
public class ConfigController {
    
    @Value("${business.discount.rate:0.9}")  // ä»é…ç½®ä¸­å¿ƒè¯»å–
    private Double discountRate;
    
    @GetMapping("/config")
    public String getConfig() {
        return "å½“å‰æŠ˜æ‰£ç‡: " + discountRate;
    }
}
```

**è‡ªåŠ¨è¿½è¸ªçš„é…ç½®æ“ä½œ**ï¼š
- âœ… å¯åŠ¨æ—¶æ‹‰å–é…ç½®
- âœ… é…ç½®å˜æ›´ç›‘å¬
- âœ… åŠ¨æ€åˆ·æ–°äº‹ä»¶
- âœ… é…ç½®åŠ è½½å¤±è´¥

### 6.3 é…ç½®ä¸­å¿ƒè¿½è¸ªè¯¦æƒ…


```
é…ç½®åŠ è½½è¿½è¸ªé“¾è·¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] åº”ç”¨å¯åŠ¨åŠ è½½é…ç½®                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Exit] Nacosæ‹‰å–é…ç½® - 100ms          â”‚
â”‚     é…ç½®Key: order-service.yaml          â”‚
â”‚     å‘½åç©ºé—´: dev                        â”‚
â”‚     é…ç½®å¤§å°: 2KB                        â”‚
â”‚     MD5æ ¡éªŒ: abc123...                   â”‚
â”‚  â†’ [Local] è§£æé…ç½®æ–‡ä»¶ - 20ms           â”‚
â”‚  â†’ [Local] æ³¨å…¥é…ç½®åˆ°Bean - 10ms         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é…ç½®åŠ¨æ€åˆ·æ–°è¿½è¸ªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Event] Nacosé…ç½®å˜æ›´é€šçŸ¥                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å˜æ›´é…ç½®: business.discount.rate        â”‚
â”‚  æ—§å€¼: 0.9                              â”‚
â”‚  æ–°å€¼: 0.8                              â”‚
â”‚  â†’ [Exit] Nacosæ‹‰å–æœ€æ–°é…ç½® - 50ms       â”‚
â”‚  â†’ [Local] åˆ·æ–°RefreshScope Bean - 30ms â”‚
â”‚  â†’ [Event] å‘å¸ƒRefreshEventäº‹ä»¶          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **é‡è¦æç¤º**  
> é…ç½®åˆ·æ–°ä¼šè§¦å‘Beançš„é‡æ–°åˆå§‹åŒ–ï¼ŒSkyWalkingèƒ½è¿½è¸ªè¿™ä¸ªè¿‡ç¨‹çš„æ€§èƒ½å½±å“ï¼Œå¦‚æœåˆ·æ–°å¤ªæ…¢å¯èƒ½å½±å“æ­£åœ¨å¤„ç†çš„è¯·æ±‚

---

## 7. ğŸ›¡ï¸ ç†”æ–­å™¨Hystrixç›‘æ§


### 7.1 ç†”æ–­å™¨æ˜¯ä»€ä¹ˆ


> ğŸ“Œ **æ ¸å¿ƒç†è§£**  
> ç†”æ–­å™¨å°±åƒå®¶é‡Œçš„ä¿é™©ä¸ï¼Œå½“ç”µè·¯å‡ºé—®é¢˜æ—¶è‡ªåŠ¨æ–­ç”µä¿æŠ¤ï¼Œé¿å…çƒ§åç”µå™¨ã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œå½“æŸä¸ªæœåŠ¡å‡ºé—®é¢˜æ—¶ï¼Œç†”æ–­å™¨è‡ªåŠ¨"æ–­å¼€"è¯·æ±‚ï¼Œé¿å…æ‹–å®æ•´ä¸ªç³»ç»Ÿã€‚

**ç†”æ–­å™¨å·¥ä½œåŸç†**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
è®¢å•æœåŠ¡ â”€â”€â”€â”€æ­£å¸¸è°ƒç”¨â”€â”€â”€â”€â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå“åº”æ­£å¸¸ï¼‰
         â†â”€â”€â”€è¿”å›ç»“æœâ”€â”€â”€â”€

æ”¯ä»˜æœåŠ¡å‡ºæ•…éšœï¼š
è®¢å•æœåŠ¡ â”€â”€â”€â”€è°ƒç”¨è¶…æ—¶â”€â”€â”€â”€â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå“åº”æ…¢/å¤±è´¥ï¼‰
         â”€â”€â”€â”€è°ƒç”¨è¶…æ—¶â”€â”€â”€â”€â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå“åº”æ…¢/å¤±è´¥ï¼‰
         â”€â”€â”€â”€è°ƒç”¨è¶…æ—¶â”€â”€â”€â”€â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå“åº”æ…¢/å¤±è´¥ï¼‰
              â†“ 
         è§¦å‘ç†”æ–­é˜ˆå€¼ï¼ˆå¦‚ï¼š10ç§’å†…å¤±è´¥5æ¬¡ï¼‰
              â†“
         ğŸ”´ ç†”æ–­å™¨æ‰“å¼€
              â†“
è®¢å•æœåŠ¡ â”€Xâ”€ä¸å†è°ƒç”¨â”€â”€â”€Xâ†’ æ”¯ä»˜æœåŠ¡
         â†å¿«é€Ÿè¿”å›é™çº§ç»“æœâ”€  ï¼ˆå¦‚ï¼šæç¤º"æ”¯ä»˜ç¹å¿™ï¼Œè¯·ç¨åå†è¯•"ï¼‰

ä¸€æ®µæ—¶é—´åï¼ˆå¦‚30ç§’ï¼‰ï¼š
         ğŸŸ¡ ç†”æ–­å™¨åŠå¼€
         â”€â”€â”€â”€å°è¯•è°ƒç”¨â”€â”€â”€â”€â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå¦‚æœæˆåŠŸï¼‰
              â†“
         ğŸŸ¢ ç†”æ–­å™¨å…³é—­
         â”€â”€â”€â”€æ¢å¤æ­£å¸¸â”€â”€â”€â”€â†’ æ”¯ä»˜æœåŠ¡
```

### 7.2 Hystrixç†”æ–­è¿½è¸ª


**ğŸŒ± å…¥é—¨çº§ï¼šåŸºæœ¬é…ç½®**

```java
// pom.xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
</dependency>

// å¯åŠ¨ç±»å¼€å¯ç†”æ–­
@SpringBootApplication
@EnableCircuitBreaker  // å¼€å¯ç†”æ–­å™¨
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}

// ä½¿ç”¨ç†”æ–­
@Service
public class PaymentService {
    
    @HystrixCommand(
        fallbackMethod = "paymentFallback",  // é™çº§æ–¹æ³•
        commandProperties = {
            @HystrixProperty(
                name = "execution.isolation.thread.timeoutInMilliseconds",
                value = "3000"  // è¶…æ—¶æ—¶é—´3ç§’
            )
        }
    )
    public PayResult callPaymentService(Long orderId) {
        // è°ƒç”¨æ”¯ä»˜æœåŠ¡
        return restTemplate.postForObject(
            "http://payment-service/pay", 
            orderId, 
            PayResult.class
        );
    }
    
    // é™çº§æ–¹æ³•ï¼šå½“ç†”æ–­æ—¶è°ƒç”¨
    public PayResult paymentFallback(Long orderId) {
        return new PayResult(false, "æ”¯ä»˜æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

### 7.3 ç†”æ–­å™¨è¿½è¸ªè¯¦æƒ…


**SkyWalkingè¿½è¸ªç†”æ–­äº‹ä»¶**ï¼š

```
æ­£å¸¸è°ƒç”¨é“¾è·¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service              â”‚
â”‚        POST /order/create          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] HystrixåŒ…è£…             â”‚
â”‚     å‘½ä»¤: PaymentServiceCommand    â”‚
â”‚     è¶…æ—¶è®¾ç½®: 3000ms               â”‚
â”‚  â†’ [Exit] è°ƒç”¨ payment-service     â”‚ â† æ­£å¸¸è°ƒç”¨
â”‚     è€—æ—¶: 800ms                    â”‚
â”‚     çŠ¶æ€: SUCCESS                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§¦å‘ç†”æ–­æ—¶çš„é“¾è·¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service              â”‚
â”‚        POST /order/create          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] HystrixåŒ…è£…             â”‚
â”‚     å‘½ä»¤: PaymentServiceCommand    â”‚
â”‚  â†’ [Exit] è°ƒç”¨ payment-service     â”‚
â”‚     è€—æ—¶: 3000ms                   â”‚
â”‚     çŠ¶æ€: TIMEOUT âŒ               â”‚ â† è¶…æ—¶
â”‚  â†’ [Local] Hystrixç†”æ–­è§¦å‘         â”‚
â”‚     ç†”æ–­å™¨çŠ¶æ€: OPEN ğŸ”´            â”‚
â”‚  â†’ [Local] æ‰§è¡Œé™çº§æ–¹æ³•            â”‚
â”‚     fallback: paymentFallback()    â”‚
â”‚     è¿”å›: "æ”¯ä»˜ç¹å¿™ï¼Œè¯·ç¨åå†è¯•"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åç»­è¯·æ±‚ï¼ˆç†”æ–­å™¨æ‰“å¼€çŠ¶æ€ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] Hystrixæ£€æµ‹åˆ°ç†”æ–­æ‰“å¼€   â”‚
â”‚     ç›´æ¥æ‰§è¡Œé™çº§æ–¹æ³•ï¼ˆä¸è°ƒç”¨æœåŠ¡ï¼‰  â”‚ â† å¿«é€Ÿå¤±è´¥
â”‚     è€—æ—¶: 1ms                      â”‚
â”‚  â†’ [Local] fallback: paymentFallback()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿½è¸ªæ ‡ç­¾ä¿¡æ¯**ï¼š
```yaml
Hystrixè¿½è¸ªæ ‡ç­¾ï¼š
  hystrix.command: PaymentServiceCommand
  hystrix.group: PaymentService  
  hystrix.circuit.status: OPEN          # ç†”æ–­å™¨çŠ¶æ€
  hystrix.fallback.reason: TIMEOUT      # é™çº§åŸå› 
  hystrix.timeout: 3000ms              # è¶…æ—¶é…ç½®
  hystrix.thread.pool: payment-pool    # çº¿ç¨‹æ± åç§°
```

> ğŸ’¡ **ç›‘æ§ä»·å€¼**  
> é€šè¿‡SkyWalkingå¯ä»¥çœ‹åˆ°ï¼š
> - å“ªäº›æœåŠ¡é¢‘ç¹è§¦å‘ç†”æ–­ï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰
> - ç†”æ–­åç³»ç»Ÿçš„æ€§èƒ½å½±å“ï¼ˆé™çº§æ•ˆæœï¼‰
> - ç†”æ–­å™¨çŠ¶æ€è½¬æ¢æ—¶é—´ï¼ˆæ¢å¤é€Ÿåº¦ï¼‰

---

## 8. âš–ï¸ è´Ÿè½½å‡è¡¡è¿½è¸ªä¼˜åŒ–


### 8.1 è´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ


> ğŸ“Œ **ç”Ÿæ´»åŒ–ç±»æ¯”**  
> è´Ÿè½½å‡è¡¡å°±åƒé“¶è¡Œçš„å«å·ç³»ç»Ÿï¼Œæœ‰3ä¸ªçª—å£åŠä¸šåŠ¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æŠŠé¡¾å®¢åˆ†é…åˆ°äººå°‘çš„çª—å£ï¼Œé¿å…æŸä¸ªçª—å£æ’é•¿é˜Ÿã€‚

**è´Ÿè½½å‡è¡¡ç­–ç•¥**ï¼š
```
åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªå®ä¾‹ï¼š
user-serviceå®ä¾‹åˆ—è¡¨ï¼š
â”œâ”€ å®ä¾‹1: 192.168.1.10:8080  å½“å‰è¿æ¥æ•°: 5
â”œâ”€ å®ä¾‹2: 192.168.1.11:8080  å½“å‰è¿æ¥æ•°: 3  â† é€‰è¿™ä¸ª
â””â”€ å®ä¾‹3: 192.168.1.12:8080  å½“å‰è¿æ¥æ•°: 8

å¸¸è§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ è½®è¯¢(Round Robin)                  â”‚
â”‚    è¯·æ±‚1â†’å®ä¾‹1, è¯·æ±‚2â†’å®ä¾‹2, è¯·æ±‚3â†’å®ä¾‹3, å¾ªç¯â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ² éšæœº(Random)                       â”‚
â”‚    éšæœºé€‰æ‹©ä¸€ä¸ªå®ä¾‹                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æœ€å°‘è¿æ¥(Least Connection)         â”‚
â”‚    é€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„å®ä¾‹             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš–ï¸ åŠ æƒ(Weighted)                     â”‚
â”‚    æ ¹æ®å®ä¾‹æ€§èƒ½è®¾ç½®æƒé‡ï¼Œæ€§èƒ½å¥½çš„å¤šåˆ†é… â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Ribbon/LoadBalancerè¿½è¸ª


**ğŸŒ± å…¥é—¨çº§ï¼šé…ç½®è´Ÿè½½å‡è¡¡**

```yaml
# application.yml
user-service:  # é’ˆå¯¹user-serviceçš„è´Ÿè½½å‡è¡¡é…ç½®
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule  # è½®è¯¢
    ConnectTimeout: 3000          # è¿æ¥è¶…æ—¶
    ReadTimeout: 3000             # è¯»å–è¶…æ—¶
    MaxAutoRetries: 1             # åŒä¸€å®ä¾‹é‡è¯•æ¬¡æ•°
    MaxAutoRetriesNextServer: 1   # æ¢å®ä¾‹é‡è¯•æ¬¡æ•°
```

**è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡è§„åˆ™**ï¼š
```java
@Configuration
public class LoadBalancerConfig {
    
    @Bean
    public IRule ribbonRule() {
        // ä½¿ç”¨"æœ€å°‘è¿æ¥"ç­–ç•¥
        return new BestAvailableRule();
        
        // å…¶ä»–å¯é€‰ç­–ç•¥ï¼š
        // return new RoundRobinRule();        // è½®è¯¢
        // return new RandomRule();            // éšæœº
        // return new WeightedResponseTimeRule(); // å“åº”æ—¶é—´åŠ æƒ
    }
}
```

### 8.3 è´Ÿè½½å‡è¡¡è¿½è¸ªè¯¦æƒ…


**SkyWalkingè¿½è¸ªè´Ÿè½½å‡è¡¡è¿‡ç¨‹**ï¼š

```
è´Ÿè½½å‡è¡¡é€‰æ‹©å®ä¾‹çš„è¿½è¸ªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service                    â”‚
â”‚        GET /order/list                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] Ribbonè´Ÿè½½å‡è¡¡                 â”‚
â”‚     ç›®æ ‡æœåŠ¡: user-service                â”‚
â”‚     å¯ç”¨å®ä¾‹:                            â”‚
â”‚       â€¢ 192.168.1.10:8080 (zone=A)       â”‚
â”‚       â€¢ 192.168.1.11:8080 (zone=A)       â”‚
â”‚       â€¢ 192.168.1.12:8080 (zone=B)       â”‚
â”‚     å‡è¡¡ç­–ç•¥: RoundRobinRule              â”‚
â”‚     é€‰ä¸­å®ä¾‹: 192.168.1.11:8080 âœ“        â”‚ â† è¿½è¸ªè®°å½•
â”‚  â†’ [Exit] Feignè°ƒç”¨                      â”‚
â”‚     åœ°å€: http://192.168.1.11:8080/user  â”‚
â”‚     è€—æ—¶: 150ms                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é‡è¯•æœºåˆ¶è¿½è¸ªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Entry] order-service                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â†’ [Local] Ribboné€‰æ‹©å®ä¾‹                 â”‚
â”‚     ç¬¬1æ¬¡å°è¯•: 192.168.1.10:8080         â”‚
â”‚  â†’ [Exit] Feignè°ƒç”¨                      â”‚
â”‚     ç»“æœ: TIMEOUT âŒ                     â”‚ â† ç¬¬1æ¬¡å¤±è´¥
â”‚  â†’ [Local] Ribboné‡è¯•ï¼ˆæ¢å®ä¾‹ï¼‰           â”‚
â”‚     ç¬¬2æ¬¡å°è¯•: 192.168.1.11:8080         â”‚
â”‚  â†’ [Exit] Feignè°ƒç”¨                      â”‚
â”‚     ç»“æœ: SUCCESS âœ“                      â”‚ â† ç¬¬2æ¬¡æˆåŠŸ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¿½è¸ªæ ‡ç­¾**ï¼š
```yaml
è´Ÿè½½å‡è¡¡è¿½è¸ªæ ‡ç­¾ï¼š
  lb.rule: RoundRobinRule           # è´Ÿè½½å‡è¡¡ç­–ç•¥
  lb.available.instances: 3         # å¯ç”¨å®ä¾‹æ•°
  lb.selected.instance: 192.168.1.11:8080  # é€‰ä¸­çš„å®ä¾‹
  lb.retry.count: 1                 # é‡è¯•æ¬¡æ•°
  lb.server.zone: zone-A            # å®ä¾‹æ‰€åœ¨åŒºåŸŸ
```

> ğŸ’¡ **ä¼˜åŒ–å»ºè®®**  
> é€šè¿‡è¿½è¸ªæ•°æ®å¯ä»¥å‘ç°ï¼š
> - æŸäº›å®ä¾‹æ˜¯å¦æ€»æ˜¯è¶…æ—¶ï¼ˆéœ€è¦ä¸‹çº¿ï¼‰
> - è´Ÿè½½æ˜¯å¦å‡è¡¡ï¼ˆæŸä¸ªå®ä¾‹è¯·æ±‚è¿‡å¤šï¼‰
> - é‡è¯•æ˜¯å¦é¢‘ç¹ï¼ˆå¯èƒ½ç½‘ç»œä¸ç¨³å®šï¼‰

---

## 9. ğŸ”— å®Œæ•´å¾®æœåŠ¡é“¾è·¯å®æˆ˜


### 9.1 ç”µå•†ä¸‹å•å®Œæ•´é“¾è·¯


> ğŸ“Œ **å®æˆ˜åœºæ™¯**  
> ç”¨æˆ·åœ¨APPä¸Šä¸‹å•è´­ä¹°å•†å“ï¼Œæ¶‰åŠå¤šä¸ªå¾®æœåŠ¡åä½œï¼Œæˆ‘ä»¬ç”¨SkyWalkingè¿½è¸ªæ•´ä¸ªè¿‡ç¨‹ï¼Œçœ‹çœ‹è¯·æ±‚æ˜¯å¦‚ä½•åœ¨å„ä¸ªæœåŠ¡é—´æµè½¬çš„ã€‚

**ä¸šåŠ¡æµç¨‹**ï¼š
```
ç”¨æˆ·ä¸‹å•å®Œæ•´æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APP â”‚â†’ â”‚ Gateway â”‚â†’ â”‚è®¢å•æœåŠ¡ â”‚â†’ â”‚ç”¨æˆ·æœåŠ¡ â”‚â†’ â”‚å•†å“æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“            â†“            â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚åº“å­˜æœåŠ¡ â”‚   â”‚ä¼˜æƒ æœåŠ¡ â”‚   â”‚æ”¯ä»˜æœåŠ¡ â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¶‰åŠçš„Spring Cloudç»„ä»¶ï¼š
âœ… Gateway    - ç»Ÿä¸€å…¥å£è·¯ç”±
âœ… Feign      - æœåŠ¡é—´è°ƒç”¨
âœ… Nacos      - æœåŠ¡æ³¨å†Œå‘ç°
âœ… Ribbon     - è´Ÿè½½å‡è¡¡
âœ… Hystrix    - ç†”æ–­é™çº§
```

### 9.2 å®Œæ•´é“¾è·¯è¿½è¸ªç¤ºä¾‹


**ä»£ç å®ç°**ï¼š

```java
// 1. Gatewayç½‘å…³ - ç»Ÿä¸€å…¥å£
@RestController
public class GatewayController {
    
    @GetMapping("/api/order/create")
    public Mono<String> createOrder(@RequestParam Long userId, 
                                    @RequestParam Long productId) {
        // Gatewayè‡ªåŠ¨è½¬å‘åˆ°order-service
        // SkyWalkingè¿½è¸ªç‚¹ï¼šGatewayå…¥å£
        return Mono.just("Order Created");
    }
}

// 2. è®¢å•æœåŠ¡ - ä¸šåŠ¡ç¼–æ’
@Service
public class OrderService {
    
    @Autowired
    private UserClient userClient;      // Feignå®¢æˆ·ç«¯
    
    @Autowired
    private ProductClient productClient;
    
    @Autowired
    private StockClient stockClient;
    
    @Autowired
    private CouponClient couponClient;
    
    @Autowired
    private PaymentClient paymentClient;
    
    @Transactional
    public OrderResult createOrder(Long userId, Long productId) {
        // SkyWalkingè¿½è¸ªç‚¹ï¼šè®¢å•æœåŠ¡å…¥å£
        
        // â‘  æ ¡éªŒç”¨æˆ·ä¿¡æ¯
        User user = userClient.getUserById(userId);
        // SkyWalkingè¿½è¸ªï¼šFeignè°ƒç”¨user-service
        
        if (!user.isValid()) {
            throw new BusinessException("ç”¨æˆ·ä¿¡æ¯æ— æ•ˆ");
        }
        
        // â‘¡ æŸ¥è¯¢å•†å“ä¿¡æ¯
        Product product = productClient.getProductById(productId);
        // SkyWalkingè¿½è¸ªï¼šFeignè°ƒç”¨product-service
        
        // â‘¢ æ£€æŸ¥åº“å­˜
        boolean hasStock = stockClient.checkStock(productId, 1);
        // SkyWalkingè¿½è¸ªï¼šFeignè°ƒç”¨stock-service
        
        if (!hasStock) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // â‘£ è®¡ç®—ä¼˜æƒ 
        BigDecimal discount = couponClient.calculateDiscount(userId, productId);
        // SkyWalkingè¿½è¸ªï¼šFeignè°ƒç”¨coupon-service
        
        BigDecimal finalPrice = product.getPrice().subtract(discount);
        
        // â‘¤ æ‰£å‡åº“å­˜
        stockClient.deductStock(productId, 1);
        // SkyWalkingè¿½è¸ªï¼šFeignè°ƒç”¨stock-service
        
        // â‘¥ åˆ›å»ºè®¢å•è®°å½•
        Order order = new Order(userId, productId, finalPrice);
        orderRepository.save(order);
        // SkyWalkingè¿½è¸ªï¼šæ•°æ®åº“æ“ä½œ
        
        // â‘¦ è°ƒç”¨æ”¯ä»˜
        PayResult payResult = paymentClient.pay(order.getId(), finalPrice);
        // SkyWalkingè¿½è¸ªï¼šFeignè°ƒç”¨payment-serviceï¼ˆå¯èƒ½è§¦å‘ç†”æ–­ï¼‰
        
        return new OrderResult(order.getId(), payResult.isSuccess());
    }
}

// 3. Feignå®¢æˆ·ç«¯å®šä¹‰
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/user/{id}")
    User getUserById(@PathVariable Long id);
}

@FeignClient(name = "product-service")
public interface ProductClient {
    @GetMapping("/product/{id}")
    Product getProductById(@PathVariable Long id);
}

@FeignClient(
    name = "payment-service",
    fallback = PaymentFallback.class  // ç†”æ–­é™çº§
)
public interface PaymentClient {
    @PostMapping("/payment/pay")
    PayResult pay(@RequestParam Long orderId, 
                  @RequestParam BigDecimal amount);
}

// 4. ç†”æ–­é™çº§å®ç°
@Component
public class PaymentFallback implements PaymentClient {
    @Override
    public PayResult pay(Long orderId, BigDecimal amount) {
        // SkyWalkingè¿½è¸ªï¼šç†”æ–­é™çº§
        return new PayResult(false, "æ”¯ä»˜æœåŠ¡ç¹å¿™ï¼Œè®¢å•å·²åˆ›å»ºï¼Œè¯·ç¨åæ”¯ä»˜");
    }
}
```

### 9.3 SkyWalkingå®Œæ•´é“¾è·¯å±•ç¤º


**åœ¨SkyWalking UIä¸­çœ‹åˆ°çš„å®Œæ•´è°ƒç”¨é“¾è·¯**ï¼š

```
ğŸ“Š å®Œæ•´è°ƒç”¨é“¾è·¯æ‹“æ‰‘å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  APPè¯·æ±‚ â†’ [Gateway] â†’ [Order-Service] â†’ å¤šä¸ªä¸‹æ¸¸æœåŠ¡    â”‚
â”‚            (50ms)      (æ€»è€—æ—¶800ms)                    â”‚
â”‚                           â”œâ†’ [User-Service] (80ms)      â”‚
â”‚                           â”œâ†’ [Product-Service] (100ms)  â”‚
â”‚                           â”œâ†’ [Stock-Service] (120ms)    â”‚
â”‚                           â”œâ†’ [Coupon-Service] (60ms)    â”‚
â”‚                           â”œâ†’ [Stock-Service] (150ms)    â”‚
â”‚                           â”œâ†’ [MySQL] (200ms)            â”‚
â”‚                           â””â†’ [Payment-Service] âŒ(è¶…æ—¶)  â”‚
â”‚                               â””â†’ Fallbacké™çº§ (1ms)     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ” è¯¦ç»†æ—¶é—´çº¿è§†å›¾ï¼š
0ms    â”œâ”€ [Entry] Gatewayæ¥æ”¶è¯·æ±‚
50ms   â”œâ”€ [Exit] Gatewayè½¬å‘åˆ°Order-Service
       â”‚
50ms   â”œâ”€ [Entry] Order-Service.createOrder()
       â”‚  â”œâ”€ [Local] å‚æ•°æ ¡éªŒ (5ms)
       â”‚  â”‚
55ms   â”‚  â”œâ”€ [Exit] Feign â†’ User-Service
135ms  â”‚  â”‚  â””â”€ [Entry] User-Service.getUser() (80ms)
       â”‚  â”‚
135ms  â”‚  â”œâ”€ [Exit] Feign â†’ Product-Service  
235ms  â”‚  â”‚  â””â”€ [Entry] Product-Service.getProduct() (100ms)
       â”‚  â”‚
235ms  â”‚  â”œâ”€ [Exit] Feign â†’ Stock-Service (æ£€æŸ¥åº“å­˜)
355ms  â”‚  â”‚  â””â”€ [Entry] Stock-Service.checkStock() (120ms)
       â”‚  â”‚
355ms  â”‚  â”œâ”€ [Exit] Feign â†’ Coupon-Service
415ms  â”‚  â”‚  â””â”€ [Entry] Coupon-Service.calculate() (60ms)
       â”‚  â”‚
415ms  â”‚  â”œâ”€ [Exit] Feign â†’ Stock-Service (æ‰£å‡åº“å­˜)
565ms  â”‚  â”‚  â””â”€ [Entry] Stock-Service.deduct() (150ms)
       â”‚  â”‚
565ms  â”‚  â”œâ”€ [Exit] æ•°æ®åº“æ“ä½œ
765ms  â”‚  â”‚  â””â”€ [Entry] MySQL INSERT (200ms)
       â”‚  â”‚
765ms  â”‚  â”œâ”€ [Exit] Feign â†’ Payment-Service
3765ms â”‚  â”‚  â””â”€ TIMEOUT âŒ (3000msè¶…æ—¶)
       â”‚  â”‚  â””â”€ [Local] Hystrixç†”æ–­è§¦å‘
3766ms â”‚  â”‚  â””â”€ [Local] æ‰§è¡ŒFallback (1ms)
       â”‚  â”‚
3766ms â”‚  â””â”€ [Local] è¿”å›ç»“æœ
       â”‚
3816ms â””â”€ [Exit] Gatewayè¿”å›å“åº”ç»™å®¢æˆ·ç«¯
```

**è¿½è¸ªæ•°æ®åˆ†æ**ï¼š

| ğŸ“Š åˆ†æç»´åº¦ | **å‘ç°é—®é¢˜** | **ä¼˜åŒ–å»ºè®®** |
|---------|----------|----------|
| **è€—æ—¶åˆ†æ** | Payment-Serviceè¶…æ—¶(3s) | å¢åŠ è¶…æ—¶æ—¶é—´æˆ–ä¼˜åŒ–æ”¯ä»˜é€»è¾‘ |
| **è°ƒç”¨æ¬¡æ•°** | Stock-Serviceè¢«è°ƒç”¨2æ¬¡ | å¯ä»¥åˆå¹¶ä¸ºä¸€æ¬¡è°ƒç”¨ |
| **æ€§èƒ½ç“¶é¢ˆ** | MySQLæ’å…¥è€—æ—¶200ms | è€ƒè™‘å¼‚æ­¥å†™å…¥æˆ–æ‰¹é‡æ’å…¥ |
| **ç†”æ–­æƒ…å†µ** | æ”¯ä»˜æœåŠ¡è§¦å‘ç†”æ–­ | æ£€æŸ¥æ”¯ä»˜æœåŠ¡å¥åº·çŠ¶å†µ |
| **æ€»ä½“è€—æ—¶** | æ•´ä¸ªé“¾è·¯800ms | å¯å¹¶è¡ŒåŒ–éƒ¨åˆ†æœåŠ¡è°ƒç”¨ |

### 9.4 æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ


**åŸºäºè¿½è¸ªæ•°æ®çš„ä¼˜åŒ–**ï¼š

```java
// ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šå¹¶è¡Œè°ƒç”¨ï¼ˆå‡å°‘ä¸²è¡Œç­‰å¾…ï¼‰
@Service
public class OptimizedOrderService {
    
    @Autowired
    private AsyncService asyncService;
    
    public OrderResult createOrder(Long userId, Long productId) {
        // å¹¶è¡Œè°ƒç”¨ç”¨æˆ·å’Œå•†å“æœåŠ¡
        CompletableFuture<User> userFuture = 
            asyncService.getUserAsync(userId);
        
        CompletableFuture<Product> productFuture = 
            asyncService.getProductAsync(productId);
        
        // ç­‰å¾…ä¸¤ä¸ªç»“æœ
        User user = userFuture.join();        // åŸ80ms
        Product product = productFuture.join(); // åŸ100ms
        // å¹¶è¡Œååªéœ€100msï¼ˆå–æœ€å¤§å€¼ï¼‰
        
        // åç»­é€»è¾‘...
    }
}

// ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šåˆå¹¶StockæœåŠ¡è°ƒç”¨
@Service
public class OptimizedStockService {
    
    // åŸæ–¹æ¡ˆï¼šæ£€æŸ¥(120ms) + æ‰£å‡(150ms) = 270ms
    // ä¼˜åŒ–ï¼šä¸€æ¬¡å®Œæˆ(150ms)
    public StockResult checkAndDeduct(Long productId, Integer quantity) {
        // åŸå­æ€§æ£€æŸ¥å¹¶æ‰£å‡
        return stockClient.checkAndDeduct(productId, quantity);
    }
}

// ä¼˜åŒ–æ–¹æ¡ˆ3ï¼šå¼‚æ­¥å†™åº“ï¼ˆé™ä½ä¸»é“¾è·¯è€—æ—¶ï¼‰
@Service
public class OptimizedOrderService {
    
    @Async  // å¼‚æ­¥æ‰§è¡Œ
    public void saveOrderAsync(Order order) {
        orderRepository.save(order);  // ä¸é˜»å¡ä¸»æµç¨‹
    }
    
    public OrderResult createOrder(Long userId, Long productId) {
        // ... å‰é¢çš„è°ƒç”¨
        
        Order order = new Order(userId, productId, finalPrice);
        saveOrderAsync(order);  // å¼‚æ­¥ä¿å­˜ï¼Œä¸»æµç¨‹ç»§ç»­
        
        // æ”¯ä»˜ç­‰æ“ä½œ...
    }
}
```

**ä¼˜åŒ–åçš„è¿½è¸ªæ•ˆæœ**ï¼š

```
ä¼˜åŒ–åçš„è°ƒç”¨é“¾è·¯ï¼š
0ms    â”œâ”€ [Entry] Gateway
50ms   â”œâ”€ [Entry] Order-Service
       â”‚  â”œâ”€ [å¹¶è¡Œ] User-Service + Product-Service (100ms) â† åŸ180ms
150ms  â”‚  â”œâ”€ Stockæ£€æŸ¥å¹¶æ‰£å‡ (150ms) â† åŸ270ms
300ms  â”‚  â”œâ”€ Couponè®¡ç®— (60ms)
360ms  â”‚  â”œâ”€ [å¼‚æ­¥] ä¿å­˜è®¢å• (1msè§¦å‘) â† åŸ200ms
361ms  â”‚  â””â”€ Paymentè°ƒç”¨ (æˆåŠŸ100ms)
461ms  â””â”€ è¿”å›ç»“æœ

æ€»è€—æ—¶ï¼š461msï¼ˆä¼˜åŒ–å‰800msï¼Œæå‡42%ï¼‰
```

> ğŸ’¡ **ä¼˜åŒ–ä»·å€¼**  
> é€šè¿‡SkyWalkingè¿½è¸ªæ•°æ®ï¼š
> - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼šå“ªä¸ªæœåŠ¡æœ€æ…¢
> - ä¼˜åŒ–å¹¶è¡ŒåŒ–ï¼šå“ªäº›è°ƒç”¨å¯ä»¥å¹¶è¡Œ
> - å¼‚æ­¥å¤„ç†ï¼šå“ªäº›æ“ä½œå¯ä»¥å¼‚æ­¥
> - æŒç»­ç›‘æ§ï¼šä¼˜åŒ–åæ•ˆæœå¯¹æ¯”

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†


```
ğŸ”¸ Gatewayé›†æˆï¼šç»Ÿä¸€å…¥å£è¿½è¸ªï¼Œè·¯ç”±è½¬å‘ç›‘æ§
ğŸ”¸ Feignè¿½è¸ªï¼šæœåŠ¡é—´è°ƒç”¨é“¾è·¯ï¼ŒRPCæ€§èƒ½åˆ†æ
ğŸ”¸ RestTemplateï¼šHTTPå®¢æˆ·ç«¯è¿½è¸ªï¼Œå¤–éƒ¨APIç›‘æ§
ğŸ”¸ Nacosé›†æˆï¼šæœåŠ¡æ³¨å†Œå‘ç°è¿½è¸ªï¼Œé…ç½®ä¸­å¿ƒç›‘æ§
ğŸ”¸ Hystrixç†”æ–­ï¼šé™çº§äº‹ä»¶è¿½è¸ªï¼Œç†”æ–­çŠ¶æ€ç›‘æ§
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šå®ä¾‹é€‰æ‹©è¿½è¸ªï¼Œé‡è¯•æœºåˆ¶ç›‘æ§
ğŸ”¸ å®Œæ•´é“¾è·¯ï¼šç«¯åˆ°ç«¯æ€§èƒ½åˆ†æï¼Œç“¶é¢ˆå®šä½ä¼˜åŒ–
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¾®æœåŠ¡è¿½è¸ªçš„æœ¬è´¨**
```
è¿½è¸ªç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼ï¼š
â€¢ å¯è§‚æµ‹æ€§ï¼šçœ‹æ¸…è¯·æ±‚åœ¨æœåŠ¡é—´çš„æµè½¬è¿‡ç¨‹
â€¢ æ€§èƒ½åˆ†æï¼šå®šä½æ¯ä¸ªç¯èŠ‚çš„è€—æ—¶ç“¶é¢ˆ
â€¢ æ•…éšœå®šä½ï¼šå¿«é€Ÿæ‰¾åˆ°é—®é¢˜æœåŠ¡å’ŒåŸå› 
â€¢ ä¾èµ–åˆ†æï¼šç†æ¸…æœåŠ¡é—´çš„ä¾èµ–å…³ç³»
â€¢ ä¼˜åŒ–æŒ‡å¯¼ï¼šåŸºäºæ•°æ®è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–
```

**ğŸ”¹ Spring Cloudç»„ä»¶è¿½è¸ªé‡ç‚¹**
```
Gatewayè¿½è¸ªï¼š
â€¢ å…³æ³¨å…¥å£æµé‡åˆ†å¸ƒ
â€¢ ç›‘æ§è·¯ç”±è½¬å‘æ€§èƒ½
â€¢ åˆ†æè¿‡æ»¤å™¨æ‰§è¡Œè€—æ—¶

Feignè¿½è¸ªï¼š
â€¢ å…³æ³¨æœåŠ¡é—´è°ƒç”¨è€—æ—¶
â€¢ ç›‘æ§å¤±è´¥å’Œé‡è¯•æƒ…å†µ
â€¢ åˆ†æè´Ÿè½½å‡è¡¡æ•ˆæœ

Hystrixè¿½è¸ªï¼š
â€¢ å…³æ³¨ç†”æ–­è§¦å‘é¢‘ç‡
â€¢ ç›‘æ§é™çº§æ‰§è¡Œæƒ…å†µ  
â€¢ åˆ†ææœåŠ¡å¥åº·çŠ¶å†µ
```

**ğŸ”¹ è¿½è¸ªæ•°æ®çš„åº”ç”¨**
```
æ€§èƒ½ä¼˜åŒ–ï¼š
â‘  è¯†åˆ«æ…¢æœåŠ¡ â†’ é’ˆå¯¹æ€§ä¼˜åŒ–
â‘¡ å‘ç°ä¸²è¡Œè°ƒç”¨ â†’ æ”¹ä¸ºå¹¶è¡Œ
â‘¢ åˆ†ææ•°æ®åº“æ“ä½œ â†’ ä¼˜åŒ–SQLæˆ–å¼‚æ­¥

æ•…éšœæ’æŸ¥ï¼š
â‘  æŸ¥çœ‹å¼‚å¸¸é“¾è·¯ â†’ å®šä½é—®é¢˜æœåŠ¡
â‘¡ åˆ†æç†”æ–­äº‹ä»¶ â†’ äº†è§£æœåŠ¡çŠ¶æ€
â‘¢ è¿½è¸ªè¶…æ—¶è¯·æ±‚ â†’ è°ƒæ•´è¶…æ—¶é…ç½®

å®¹é‡è§„åˆ’ï¼š
â‘  åˆ†æè°ƒç”¨é‡åˆ†å¸ƒ â†’ åˆç†åˆ†é…èµ„æº
â‘¡ ç›‘æ§å®ä¾‹è´Ÿè½½ â†’ åŠ¨æ€æ‰©ç¼©å®¹
â‘¢ è¯„ä¼°æœåŠ¡ä¾èµ– â†’ ä¼˜åŒ–æ¶æ„è®¾è®¡
```

### 10.3 å®æˆ˜åº”ç”¨æŒ‡å¯¼


**âœ… è‡ªæ£€æ¸…å•**ï¼š
- [ ] ç†è§£å¾®æœåŠ¡è¿½è¸ªçš„æ ¸å¿ƒä»·å€¼
- [ ] æŒæ¡Gatewayç½‘å…³è¿½è¸ªé…ç½®
- [ ] ç†è§£Feignå®¢æˆ·ç«¯è‡ªåŠ¨è¿½è¸ªåŸç†
- [ ] æŒæ¡RestTemplateè¿½è¸ªé›†æˆæ–¹æ³•
- [ ] ç†è§£æœåŠ¡æ³¨å†Œå‘ç°è¿½è¸ªæ„ä¹‰
- [ ] æŒæ¡é…ç½®ä¸­å¿ƒåŠ¨æ€åˆ·æ–°ç›‘æ§
- [ ] ç†è§£Hystrixç†”æ–­é™çº§è¿½è¸ª
- [ ] æŒæ¡è´Ÿè½½å‡è¡¡ç­–ç•¥è¿½è¸ªåˆ†æ
- [ ] èƒ½å¤Ÿåˆ†æå®Œæ•´å¾®æœåŠ¡è°ƒç”¨é“¾è·¯
- [ ] åŸºäºè¿½è¸ªæ•°æ®è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

**ğŸš€ è¿›é˜¶å­¦ä¹ è·¯å¾„**ï¼š
```
ğŸ“š å­¦ä¹ è·¯çº¿ï¼š
åŸºç¡€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼š
â€¢ ç†è§£è¿½è¸ªçš„åŸºæœ¬æ¦‚å¿µå’Œä»·å€¼
â€¢ æŒæ¡å„ç»„ä»¶çš„è‡ªåŠ¨è¿½è¸ªé…ç½®
â€¢ å­¦ä¼šåœ¨SkyWalking UIä¸­æŸ¥çœ‹é“¾è·¯

è¿›é˜¶é˜¶æ®µï¼ˆ2-3å‘¨ï¼‰ï¼š
â€¢ æŒæ¡è‡ªå®šä¹‰è¿½è¸ªæ ‡ç­¾æ·»åŠ 
â€¢ å­¦ä¹ æ€§èƒ½ç“¶é¢ˆåˆ†ææ–¹æ³•
â€¢ å®è·µå¾®æœåŠ¡é“¾è·¯ä¼˜åŒ–

é«˜çº§é˜¶æ®µï¼ˆæŒç»­ï¼‰ï¼š
â€¢ å»ºç«‹è¿½è¸ªæ•°æ®åˆ†æä½“ç³»
â€¢ å®ç°è‡ªåŠ¨åŒ–æ€§èƒ½ç›‘æ§å‘Šè­¦
â€¢ æ¶æ„çº§åˆ«çš„å¯è§‚æµ‹æ€§è®¾è®¡
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³**ï¼š

| â“ é—®é¢˜ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|----------|----------|
| é“¾è·¯æ–­å¼€ | Agentæœªæ­£ç¡®é…ç½® | æ£€æŸ¥æ¯ä¸ªæœåŠ¡çš„Agenté…ç½® |
| è¿½è¸ªæ•°æ®ç¼ºå¤± | æœåŠ¡åé…ç½®é”™è¯¯ | ç»Ÿä¸€æœåŠ¡å‘½åè§„èŒƒ |
| æ€§èƒ½å½±å“å¤§ | é‡‡æ ·ç‡è®¾ç½®è¿‡é«˜ | è°ƒæ•´é‡‡æ ·ç‡ï¼ˆå¦‚1/100ï¼‰ |
| æ ‡ç­¾ä¸¢å¤± | å¼‚æ­¥è°ƒç”¨æœªä¼ é€’ä¸Šä¸‹æ–‡ | ä½¿ç”¨`@TraceCrossThread` |

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**ï¼š
```
ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š
â€¢ é‡‡æ ·ç‡ï¼šæ ¹æ®æµé‡è®¾ç½®ï¼ˆå¦‚0.1% - 10%ï¼‰
â€¢ æœåŠ¡å‘½åï¼šç»Ÿä¸€è§„èŒƒï¼Œä¾¿äºè¯†åˆ«
â€¢ æ ‡ç­¾æ·»åŠ ï¼šå…³é”®ä¸šåŠ¡æ ‡è¯†ï¼ˆç”¨æˆ·IDã€ç§Ÿæˆ·IDï¼‰
â€¢ å‘Šè­¦é…ç½®ï¼šå¼‚å¸¸é“¾è·¯ã€æ…¢æŸ¥è¯¢è‡ªåŠ¨å‘Šè­¦

ç›‘æ§ç­–ç•¥ï¼š
â€¢ å®æ—¶ç›‘æ§ï¼šP99è€—æ—¶ã€é”™è¯¯ç‡
â€¢ å®šæœŸå·¡æ£€ï¼šæœåŠ¡å¥åº·åº¦ã€ä¾èµ–å…³ç³»
â€¢ å®¹é‡è¯„ä¼°ï¼šåŸºäºè¿½è¸ªæ•°æ®é¢„æµ‹å®¹é‡
â€¢ æŒç»­ä¼˜åŒ–ï¼šå»ºç«‹æ€§èƒ½ä¼˜åŒ–é—­ç¯
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Gatewayå…¥å£æŠŠå…³ä¸¥ï¼ŒFeignè°ƒç”¨é“¾è·¯å…¨
RestTemplateå¤–éƒ¨è¿ï¼ŒNacosæ³¨å†Œè¦è¿½è¸ª
é…ç½®ä¸­å¿ƒåŠ¨æ€ä¼ ï¼ŒHystrixç†”æ–­é™çº§æ˜¾
è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰ï¼Œå®Œæ•´é“¾è·¯æ€§èƒ½ç°
è¿½è¸ªæ•°æ®ä»·å€¼å¤§ï¼Œä¼˜åŒ–æ•…éšœå…¨é å®ƒ
```

---

> ğŸ“š **æ‰©å±•é˜…è¯»**  
> - Spring Cloudå®˜æ–¹æ–‡æ¡£ï¼šå¾®æœåŠ¡æœ€ä½³å®è·µ
> - SkyWalkingå®˜æ–¹æ–‡æ¡£ï¼šæ’ä»¶å¼€å‘æŒ‡å—  
> - ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹ï¼šå¯è§‚æµ‹æ€§ç« èŠ‚
> - ä¼ä¸šå®æˆ˜æ¡ˆä¾‹ï¼šå¤§è§„æ¨¡å¾®æœåŠ¡è¿½è¸ªå®è·µ