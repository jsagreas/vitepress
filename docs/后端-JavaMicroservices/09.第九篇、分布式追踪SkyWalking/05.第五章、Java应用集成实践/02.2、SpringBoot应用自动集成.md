---
title: 2ã€SpringBootåº”ç”¨è‡ªåŠ¨é›†æˆ
---
## ğŸ“š ç›®å½•

1. [Spring Bootè‡ªåŠ¨é›†æˆæ¦‚è¿°](#1-Spring-Bootè‡ªåŠ¨é›†æˆæ¦‚è¿°)
2. [ä¾èµ–ç®¡ç†ä¸å¼•å…¥](#2-ä¾èµ–ç®¡ç†ä¸å¼•å…¥)
3. [application.ymlæ ¸å¿ƒé…ç½®](#3-applicationymlæ ¸å¿ƒé…ç½®)
4. [è‡ªåŠ¨é…ç½®åŸç†](#4-è‡ªåŠ¨é…ç½®åŸç†)
5. [æœåŠ¡å‘ç°é›†æˆ](#5-æœåŠ¡å‘ç°é›†æˆ)
6. [å¥åº·æ£€æŸ¥é…ç½®](#6-å¥åº·æ£€æŸ¥é…ç½®)
7. [é…ç½®çƒ­æ›´æ–°](#7-é…ç½®çƒ­æ›´æ–°)
8. [æ³¨è§£æ”¯æŒä¸ä½¿ç”¨](#8-æ³¨è§£æ”¯æŒä¸ä½¿ç”¨)
9. [é›†æˆéªŒè¯ä¸æµ‹è¯•](#9-é›†æˆéªŒè¯ä¸æµ‹è¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŸ Spring Bootè‡ªåŠ¨é›†æˆæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é›†æˆ


**é€šä¿—ç†è§£ï¼š**
```
ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹åŠ¨å†™é…ç½®ä»£ç ï¼Œåƒç»„è£…å®¶å…·éœ€è¦è‡ªå·±çœ‹è¯´æ˜ä¹¦
è‡ªåŠ¨é›†æˆï¼šæ¡†æ¶è‡ªåŠ¨å®Œæˆé…ç½®ï¼Œåƒä¹°æˆå“å®¶å…·ç›´æ¥ç”¨

SkyWalking + Spring Boot = å¼€ç®±å³ç”¨çš„é“¾è·¯è¿½è¸ª
```

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- ğŸš€ **é›¶ä»£ç ä¾µå…¥** - ä¸éœ€è¦æ”¹ä¸šåŠ¡ä»£ç 
- âš™ï¸ **è‡ªåŠ¨é…ç½®** - æ¡†æ¶è‡ªåŠ¨å®Œæˆå¤§éƒ¨åˆ†è®¾ç½®
- ğŸ”Œ **æ’ä»¶åŒ–è®¾è®¡** - éœ€è¦ä»€ä¹ˆåŠŸèƒ½åŠ ä»€ä¹ˆä¾èµ–
- ğŸ“ **é…ç½®æ–‡ä»¶é©±åŠ¨** - é€šè¿‡ymlæ–‡ä»¶æ§åˆ¶è¡Œä¸º

### 1.2 å·¥ä½œåŸç†ç®€è¿°


```
åº”ç”¨å¯åŠ¨æµç¨‹ï¼š
å¯åŠ¨ â†’ Spring Bootè‡ªåŠ¨é…ç½® â†’ åŠ è½½SkyWalking Agent â†’ å¼€å§‹è¿½è¸ª
  â”‚           â”‚                    â”‚                    â”‚
  â”‚      æ£€æµ‹ä¾èµ–å­˜åœ¨           åˆå§‹åŒ–æ¢é’ˆ            æ‹¦æˆªæ–¹æ³•è°ƒç”¨
  â”‚           â”‚                    â”‚                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¿è¡Œä¸­
                                                      æŒç»­æ”¶é›†æ•°æ®
```

**å…³é”®æ¦‚å¿µï¼š**
- **è‡ªåŠ¨é…ç½®** - Spring Bootæ£€æµ‹åˆ°SkyWalkingä¾èµ–åè‡ªåŠ¨å¯ç”¨
- **Agentæ¢é’ˆ** - è´Ÿè´£å®é™…çš„æ•°æ®æ”¶é›†å·¥ä½œ
- **é…ç½®ç»‘å®š** - ymlé…ç½®è‡ªåŠ¨æ˜ å°„åˆ°Javaå¯¹è±¡

---

## 2. ğŸ“¦ ä¾èµ–ç®¡ç†ä¸å¼•å…¥


### 2.1 æ ¸å¿ƒä¾èµ–è¯´æ˜


**ä¾èµ–ä½“ç³»æ¶æ„ï¼š**
```
SkyWalkingä¾èµ–å±‚æ¬¡
    â”œâ”€â”€ skywalking-agent (å¿…éœ€)
    â”‚   â””â”€â”€ æ ¸å¿ƒè¿½è¸ªèƒ½åŠ›
    â”œâ”€â”€ spring-boot-starter (å¯é€‰)
    â”‚   â””â”€â”€ è‡ªåŠ¨é…ç½®æ”¯æŒ
    â””â”€â”€ toolkit-trace (å¯é€‰)
        â””â”€â”€ æ‰‹åŠ¨åŸ‹ç‚¹å·¥å…·
```

### 2.2 Mavenä¾èµ–é…ç½®


**åŸºç¡€é›†æˆï¼ˆæ¨èæ–°æ‰‹ï¼‰ï¼š**
```xml
<dependencies>
    <!-- Spring BootåŸºç¡€ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- SkyWalkingè‡ªåŠ¨é…ç½®æ”¯æŒ -->
    <dependency>
        <groupId>org.apache.skywalking</groupId>
        <artifactId>apm-toolkit-trace</artifactId>
        <version>9.0.0</version>
    </dependency>
</dependencies>
```

**å®Œæ•´é›†æˆï¼ˆåŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼‰ï¼š**
```xml
<dependencies>
    <!-- æ ¸å¿ƒè¿½è¸ªå·¥å…·åŒ… -->
    <dependency>
        <groupId>org.apache.skywalking</groupId>
        <artifactId>apm-toolkit-trace</artifactId>
        <version>9.0.0</version>
    </dependency>
    
    <!-- æ—¥å¿—é›†æˆï¼ˆæ”¯æŒTraceIdæ‰“å°ï¼‰ -->
    <dependency>
        <groupId>org.apache.skywalking</groupId>
        <artifactId>apm-toolkit-logback-1.x</artifactId>
        <version>9.0.0</version>
    </dependency>
    
    <!-- å¼‚æ­¥æ”¯æŒ -->
    <dependency>
        <groupId>org.apache.skywalking</groupId>
        <artifactId>apm-toolkit-async</artifactId>
        <version>9.0.0</version>
    </dependency>
</dependencies>
```

**ğŸ’¡ ä¾èµ–é€‰æ‹©æŒ‡å—ï¼š**

| ä¾èµ–åŒ… | ç”¨é€” | æ˜¯å¦å¿…éœ€ | é€‚ç”¨åœºæ™¯ |
|--------|------|----------|----------|
| `apm-toolkit-trace` | åŸºç¡€è¿½è¸ª | âœ… å¿…éœ€ | æ‰€æœ‰é¡¹ç›® |
| `apm-toolkit-logback` | æ—¥å¿—TraceId | â­ æ¨è | éœ€è¦æ—¥å¿—å…³è” |
| `apm-toolkit-async` | å¼‚æ­¥è¿½è¸ª | ğŸ“Œ æŒ‰éœ€ | ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ |
| `apm-toolkit-opentracing` | OpenTracingå…¼å®¹ | ğŸ“Œ æŒ‰éœ€ | å¤šé“¾è·¯ç³»ç»Ÿ |

### 2.3 Gradleé…ç½®æ–¹å¼


```gradle
dependencies {
    // Spring BootåŸºç¡€
    implementation 'org.springframework.boot:spring-boot-starter-web'
    
    // SkyWalkingæ ¸å¿ƒ
    implementation 'org.apache.skywalking:apm-toolkit-trace:9.0.0'
    
    // æ—¥å¿—é›†æˆ
    implementation 'org.apache.skywalking:apm-toolkit-logback-1.x:9.0.0'
}
```

---

## 3. âš™ï¸ application.ymlæ ¸å¿ƒé…ç½®


### 3.1 åŸºç¡€é…ç½®æ¨¡æ¿


**æœ€ç®€é…ç½®ï¼ˆå¼€ç®±å³ç”¨ï¼‰ï¼š**
```yaml
spring:
  application:
    name: user-service  # æœåŠ¡åç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨SkyWalking UI

# SkyWalking Agenté…ç½®ï¼ˆé€šè¿‡JVMå‚æ•°ä¼ é€’ï¼Œè¿™é‡Œä»…ä½œè¯´æ˜ï¼‰
# -javaagent:/path/to/skywalking-agent.jar
# -Dskywalking.agent.service_name=user-service
# -Dskywalking.collector.backend_service=127.0.0.1:11800
```

**å®Œæ•´é…ç½®ï¼ˆç”Ÿäº§æ¨èï¼‰ï¼š**
```yaml
spring:
  application:
    name: ${APP_NAME:user-service}  # æ”¯æŒç¯å¢ƒå˜é‡
    
server:
  port: 8080

# åº”ç”¨è‡ªå®šä¹‰é…ç½®
skywalking:
  trace:
    ignore_suffix: .jpg,.jpeg,.js,.css,.png,.ico  # å¿½ç•¥é™æ€èµ„æº
  plugin:
    jdbc:
      trace_sql_parameters: true  # è®°å½•SQLå‚æ•°
    spring:
      mvc:
        use_qualified_name_as_endpoint_name: false  # ç®€åŒ–ç«¯ç‚¹å
```

### 3.2 é…ç½®é¡¹è¯¦ç»†è¯´æ˜


**ğŸ”¸ æœåŠ¡æ ‡è¯†é…ç½®**

```yaml
spring:
  application:
    name: order-service  # â† è¿™ä¸ªåå­—ä¼šå‡ºç°åœ¨é“¾è·¯å›¾ä¸Š
```

**ä½œç”¨è¯´æ˜ï¼š**
- ğŸ“› **æœåŠ¡è¯†åˆ«** - åœ¨SkyWalkingä¸­æ ‡è¯†è¿™ä¸ªæœåŠ¡
- ğŸ”— **é“¾è·¯å…³è”** - å¤šä¸ªæœåŠ¡é€šè¿‡åç§°å»ºç«‹è°ƒç”¨å…³ç³»
- ğŸ“Š **ç›‘æ§åˆ†ç»„** - ç›¸åŒåç§°çš„å¤šä¸ªå®ä¾‹ä¼šèšåˆç»Ÿè®¡

**ğŸ”¸ è¿½è¸ªé‡‡æ ·é…ç½®**

```yaml
# é€šè¿‡JVMå‚æ•°é…ç½®ï¼ˆapplication.ymlä¸ç›´æ¥æ”¯æŒï¼‰
# -Dskywalking.agent.sample_n_per_3_secs=9
# å«ä¹‰ï¼šæ¯3ç§’æœ€å¤šé‡‡æ ·9ä¸ªè¯·æ±‚ï¼ˆé™ä½æ€§èƒ½å¼€é”€ï¼‰
```

**é‡‡æ ·ç­–ç•¥å¯¹æ¯”ï¼š**

| ç­–ç•¥ | é…ç½®å€¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|------|--------|----------|--------|
| **å…¨é‡é‡‡æ ·** | `-1`ï¼ˆé»˜è®¤ï¼‰ | å¼€å‘/æµ‹è¯•ç¯å¢ƒ | âœ… æ•°æ®å®Œæ•´ âŒ æ€§èƒ½å¼€é”€å¤§ |
| **å®šé‡é‡‡æ ·** | `N per 3 secs` | ç”Ÿäº§ç¯å¢ƒ | âœ… æ€§èƒ½å‹å¥½ âŒ æ•°æ®ä¸å®Œæ•´ |
| **ä¸é‡‡æ ·** | `0` | æ€§èƒ½å‹æµ‹ | âœ… æ— å¼€é”€ âŒ æ— ç›‘æ§æ•°æ® |

**ğŸ”¸ æ’ä»¶åŠŸèƒ½é…ç½®**

```yaml
skywalking:
  plugin:
    # æ•°æ®åº“æ’ä»¶é…ç½®
    jdbc:
      trace_sql_parameters: true      # æ˜¯å¦è®°å½•SQLå‚æ•°
      sql_parameters_max_length: 512  # SQLå‚æ•°æœ€å¤§é•¿åº¦
      
    # Spring MVCæ’ä»¶é…ç½®  
    spring:
      mvc:
        collect_http_params: true  # æ”¶é›†HTTPå‚æ•°
        
    # MongoDBæ’ä»¶é…ç½®
    mongodb:
      trace_parameters: false  # ä¸è®°å½•MongoDBæŸ¥è¯¢å‚æ•°
```

### 3.3 ç¯å¢ƒå·®å¼‚åŒ–é…ç½®


**å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆapplication-dev.ymlï¼‰ï¼š**
```yaml
skywalking:
  trace:
    ignore_suffix: ""  # ä¸å¿½ç•¥ä»»ä½•è¯·æ±‚ï¼Œæ–¹ä¾¿è°ƒè¯•
  plugin:
    jdbc:
      trace_sql_parameters: true  # è®°å½•SQLå‚æ•°ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆapplication-prod.ymlï¼‰ï¼š**
```yaml
skywalking:
  trace:
    ignore_suffix: .jpg,.jpeg,.js,.css,.png,.ico,.woff  # å¿½ç•¥é™æ€èµ„æº
  plugin:
    jdbc:
      trace_sql_parameters: false  # ä¸è®°å½•æ•æ„Ÿå‚æ•°
      sql_body_max_length: 2048   # é™åˆ¶SQLé•¿åº¦
```

**ğŸ¯ é…ç½®é€‰æ‹©å»ºè®®ï¼š**

```
å¼€å‘ç¯å¢ƒï¼šå…¨é‡é‡‡é›† + è¯¦ç»†æ—¥å¿— + è®°å½•å‚æ•°
æµ‹è¯•ç¯å¢ƒï¼šéƒ¨åˆ†é‡‡é›† + å…³é”®æ—¥å¿— + è„±æ•å‚æ•°
ç”Ÿäº§ç¯å¢ƒï¼šå®šé‡é‡‡é›† + å¿…è¦æ—¥å¿— + ä¸è®°æ•æ„Ÿæ•°æ®
```

---

## 4. ğŸ”§ è‡ªåŠ¨é…ç½®åŸç†


### 4.1 Spring Bootè‡ªåŠ¨é…ç½®æœºåˆ¶


**å·¥ä½œæµç¨‹å›¾ç¤ºï¼š**
```
åº”ç”¨å¯åŠ¨
    â”œâ”€â”€ 1. æ‰«æclasspathä¸‹çš„ä¾èµ–
    â”œâ”€â”€ 2. å‘ç°skywalkingç›¸å…³jaråŒ…
    â”œâ”€â”€ 3. è¯»å–spring.factoriesé…ç½®
    â”œâ”€â”€ 4. åŠ è½½SkyWalkingAutoConfigurationç±»
    â”œâ”€â”€ 5. æ ¹æ®@Conditionalæ³¨è§£åˆ¤æ–­æ˜¯å¦å¯ç”¨
    â”œâ”€â”€ 6. åˆ›å»ºç›¸å…³Beanï¼ˆTracerã€Reporterç­‰ï¼‰
    â””â”€â”€ 7. æ³¨å†Œåˆ°Springå®¹å™¨
            â””â”€â”€ åº”ç”¨å¯ä»¥ä½¿ç”¨è¿½è¸ªåŠŸèƒ½
```

**æ ¸å¿ƒé…ç½®ç±»ç¤ºä¾‹ç†è§£ï¼š**
```java
// è¿™æ˜¯æ¡†æ¶å†…éƒ¨çš„é…ç½®ç±»ï¼Œä½ ä¸éœ€è¦å†™ï¼Œä½†è¦ç†è§£å®ƒåšäº†ä»€ä¹ˆ
@Configuration  // å£°æ˜è¿™æ˜¯ä¸ªé…ç½®ç±»
@ConditionalOnClass(SkyWalkingAgent.class)  // åªæœ‰å­˜åœ¨Agentç±»æ‰ç”Ÿæ•ˆ
@EnableConfigurationProperties(SkyWalkingProperties.class)  // ç»‘å®šé…ç½®
public class SkyWalkingAutoConfiguration {
    
    // è‡ªåŠ¨åˆ›å»ºè¿½è¸ªå™¨Bean
    @Bean
    public Tracer tracer(SkyWalkingProperties properties) {
        return new SkyWalkingTracer(properties);
    }
}
```

**ğŸ’¡ ç†è§£è¦ç‚¹ï¼š**
- `@ConditionalOnClass` - åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨æ‰ç”Ÿæ•ˆ
- `@EnableConfigurationProperties` - è®©ymlé…ç½®å’ŒJavaç±»å…³è”
- `@Bean` - è‡ªåŠ¨åˆ›å»ºå¯¹è±¡å¹¶äº¤ç»™Springç®¡ç†

### 4.2 AgentåŠ è½½æ—¶æœº


**Java Agentå·¥ä½œåŸç†ï¼š**
```
JVMå¯åŠ¨è¿‡ç¨‹ï¼š
1. JVMå¯åŠ¨
2. åŠ è½½Agent (é€šè¿‡-javaagentå‚æ•°)
3. Agentä¿®æ”¹å­—èŠ‚ç ï¼ˆåœ¨ç±»åŠ è½½æ—¶æ’å…¥è¿½è¸ªä»£ç ï¼‰
4. åŠ è½½åº”ç”¨ä¸»ç±»
5. æ‰§è¡ŒSpring Bootå¯åŠ¨æµç¨‹
6. ä¸šåŠ¡ä»£ç æ‰§è¡Œï¼ˆå·²è¢«Agentå¢å¼ºï¼‰
```

**å­—èŠ‚ç å¢å¼ºç¤ºä¾‹ï¼š**
```
åŸå§‹æ–¹æ³•ï¼š
public User getUser(Long id) {
    return userDao.findById(id);
}

Agentå¢å¼ºåï¼ˆå®é™…æ‰§è¡Œï¼‰ï¼š
public User getUser(Long id) {
    Span span = Tracer.createSpan("getUser");  // â† Agentè‡ªåŠ¨æ’å…¥
    try {
        return userDao.findById(id);
    } finally {
        span.finish();  // â† Agentè‡ªåŠ¨æ’å…¥
    }
}
```

**ğŸ” å…³é”®è®¤çŸ¥ï¼š**
- Agentåœ¨JVMå¯åŠ¨æ—¶å°±å¼€å§‹å·¥ä½œ
- ä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼Œè‡ªåŠ¨ç»‡å…¥è¿½è¸ªé€»è¾‘
- è¿™å°±æ˜¯"é›¶ä¾µå…¥"çš„å®ç°åŸç†

---

## 5. ğŸ”— æœåŠ¡å‘ç°é›†æˆ


### 5.1 ä¸æ³¨å†Œä¸­å¿ƒçš„é…åˆ


**é›†æˆæ¶æ„å›¾ï¼š**
```
åº”ç”¨å®ä¾‹
    â”œâ”€â”€ å‘Nacos/Eurekaæ³¨å†Œï¼ˆæœåŠ¡åï¼šuser-serviceï¼‰
    â”œâ”€â”€ å‘SkyWalkingä¸ŠæŠ¥ï¼ˆæœåŠ¡åï¼šuser-serviceï¼‰
    â””â”€â”€ ä¿æŒåç§°ä¸€è‡´ï¼Œä¾¿äºå…³è”

è°ƒç”¨é“¾è·¯ï¼š
[è®¢å•æœåŠ¡] --Feignè°ƒç”¨--> [ç”¨æˆ·æœåŠ¡]
     â†“                          â†“
  ä¸ŠæŠ¥åˆ°SkyWalking         ä¸ŠæŠ¥åˆ°SkyWalking
     â†“                          â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€ è‡ªåŠ¨å…³è” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Nacosé›†æˆç¤ºä¾‹


**å®Œæ•´é…ç½®ï¼š**
```yaml
spring:
  application:
    name: order-service  # â† å¿…é¡»ä¿æŒä¸€è‡´
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
        namespace: dev
        group: DEFAULT_GROUP

# SkyWalkingä¹Ÿä½¿ç”¨ç›¸åŒçš„æœåŠ¡å
# -Dskywalking.agent.service_name=order-service
```

**æœåŠ¡è°ƒç”¨ç¤ºä¾‹ï¼š**
```java
@RestController
public class OrderController {
    
    @Autowired
    private UserClient userClient;  // Feignå®¢æˆ·ç«¯
    
    @GetMapping("/order/{id}")
    public Order getOrder(@PathVariable Long id) {
        // è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼ˆè‡ªåŠ¨ä¼ é€’TraceIdï¼‰
        User user = userClient.getUser(123L);
        
        // SkyWalkingè‡ªåŠ¨è®°å½•ï¼š
        // 1. å½“å‰æœåŠ¡ï¼šorder-service
        // 2. è°ƒç”¨ç›®æ ‡ï¼šuser-service  
        // 3. è°ƒç”¨è€—æ—¶ï¼šxx ms
        
        return buildOrder(user);
    }
}
```

**ğŸ¯ é›†æˆè¦ç‚¹ï¼š**

âœ… **æœåŠ¡åç§°ç»Ÿä¸€** - æ³¨å†Œä¸­å¿ƒå’ŒSkyWalkingä½¿ç”¨ç›¸åŒåç§°
âœ… **è‡ªåŠ¨ä¼ é€’ä¸Šä¸‹æ–‡** - TraceIdé€šè¿‡HTTP Headerä¼ é€’
âœ… **æ— éœ€é¢å¤–é…ç½®** - Feign/RestTemplateè‡ªåŠ¨æ”¯æŒ

### 5.3 Eurekaé›†æˆç¤ºä¾‹


```yaml
spring:
  application:
    name: payment-service
    
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
  instance:
    instance-id: ${spring.application.name}:${server.port}
    prefer-ip-address: true
```

---

## 6. ğŸ’Š å¥åº·æ£€æŸ¥é…ç½®


### 6.1 Spring Boot Actuatoré›†æˆ


**æ·»åŠ ä¾èµ–ï¼š**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**å¥åº·æ£€æŸ¥é…ç½®ï¼š**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,skywalking  # æš´éœ²ç«¯ç‚¹
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
      
  health:
    skywalking:
      enabled: true  # å¯ç”¨SkyWalkingå¥åº·æ£€æŸ¥
```

### 6.2 å¥åº·çŠ¶æ€æ£€æŸ¥


**è®¿é—®å¥åº·ç«¯ç‚¹ï¼š**
```bash
# æŸ¥çœ‹æ•´ä½“å¥åº·çŠ¶æ€
curl http://localhost:8080/actuator/health

# å“åº”ç¤ºä¾‹
{
  "status": "UP",
  "components": {
    "skywalking": {
      "status": "UP",
      "details": {
        "connected": true,
        "backend": "127.0.0.1:11800",
        "lastReportTime": "2025-09-23T10:30:45"
      }
    }
  }
}
```

**å¥åº·çŠ¶æ€è¯´æ˜ï¼š**

| çŠ¶æ€ | å«ä¹‰ | å¤„ç†æ–¹å¼ |
|------|------|----------|
| `UP` | æ­£å¸¸è¿æ¥OAP | âœ… æ— éœ€å¤„ç† |
| `DOWN` | æ— æ³•è¿æ¥OAP | âš ï¸ æ£€æŸ¥ç½‘ç»œå’ŒOAPçŠ¶æ€ |
| `UNKNOWN` | çŠ¶æ€æœªçŸ¥ | ğŸ” æŸ¥çœ‹æ—¥å¿—æ’æŸ¥ |

### 6.3 è‡ªå®šä¹‰å¥åº·æŒ‡æ ‡


```java
@Component
public class SkyWalkingHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        boolean connected = checkOAPConnection();
        
        if (connected) {
            return Health.up()
                .withDetail("backend", "127.0.0.1:11800")
                .withDetail("status", "æ­£å¸¸ä¸ŠæŠ¥")
                .build();
        } else {
            return Health.down()
                .withDetail("error", "æ— æ³•è¿æ¥OAPæœåŠ¡å™¨")
                .build();
        }
    }
    
    private boolean checkOAPConnection() {
        // æ£€æŸ¥è¿æ¥é€»è¾‘
        return true;
    }
}
```

---

## 7. ğŸ”„ é…ç½®çƒ­æ›´æ–°


### 7.1 åŠ¨æ€é…ç½®åŸç†


**é…ç½®åˆ·æ–°æµç¨‹ï¼š**
```
é…ç½®ä¸­å¿ƒï¼ˆNacos/Apolloï¼‰
    â†“ é…ç½®å˜æ›´
Spring Cloud Configåˆ·æ–°
    â†“ è§¦å‘@RefreshScope
SkyWalkingé…ç½®é‡æ–°åŠ è½½
    â†“ æ— éœ€é‡å¯
æ–°é…ç½®ç”Ÿæ•ˆ
```

### 7.2 NacosåŠ¨æ€é…ç½®


**Nacosé…ç½®ä¸­å¿ƒè®¾ç½®ï¼š**
```yaml
# åœ¨Nacosé…ç½®ä¸­å¿ƒåˆ›å»ºé…ç½®
# Data ID: skywalking-config.yml
# Group: DEFAULT_GROUP

skywalking:
  trace:
    ignore_suffix: .jpg,.png,.css  # å¯åŠ¨æ€ä¿®æ”¹
  plugin:
    jdbc:
      trace_sql_parameters: true   # å¯åŠ¨æ€å¼€å…³
```

**åº”ç”¨é…ç½®å¼•ç”¨ï¼š**
```yaml
spring:
  cloud:
    nacos:
      config:
        server-addr: 127.0.0.1:8848
        file-extension: yml
        shared-configs:
          - data-id: skywalking-config.yml
            refresh: true  # â† å¼€å¯è‡ªåŠ¨åˆ·æ–°
```

### 7.3 é…ç½®åˆ·æ–°ç«¯ç‚¹


**æ‰‹åŠ¨è§¦å‘åˆ·æ–°ï¼š**
```bash
# è°ƒç”¨åˆ·æ–°ç«¯ç‚¹
curl -X POST http://localhost:8080/actuator/refresh

# å“åº”ç¤ºä¾‹ï¼ˆæ˜¾ç¤ºå˜æ›´çš„é…ç½®é¡¹ï¼‰
[
  "skywalking.trace.ignore_suffix",
  "skywalking.plugin.jdbc.trace_sql_parameters"
]
```

**ğŸ¯ çƒ­æ›´æ–°åº”ç”¨åœºæ™¯ï¼š**

```
ç”Ÿäº§é—®é¢˜æ’æŸ¥ï¼š
1. å‘ç°æŸä¸ªSQLå¾ˆæ…¢
2. åŠ¨æ€å¼€å¯SQLå‚æ•°è®°å½•
3. æŸ¥çœ‹å…·ä½“SQLè¯­å¥
4. é—®é¢˜è§£å†³åå…³é—­è®°å½•
5. å…¨ç¨‹æ— éœ€é‡å¯æœåŠ¡
```

---

## 8. ğŸ“ æ³¨è§£æ”¯æŒä¸ä½¿ç”¨


### 8.1 æ ¸å¿ƒæ³¨è§£è¯´æ˜


**æ³¨è§£åŠŸèƒ½å¯¹ç…§è¡¨ï¼š**

| æ³¨è§£ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `@Trace` | åˆ›å»ºè‡ªå®šä¹‰Span | å…³é”®ä¸šåŠ¡æ–¹æ³• |
| `@Tag` | æ·»åŠ æ ‡ç­¾ä¿¡æ¯ | æ–¹æ³•å‚æ•°/è¿”å›å€¼ |
| `@Tags` | æ‰¹é‡æ·»åŠ æ ‡ç­¾ | å¤æ‚å‚æ•°æ ‡è®° |

### 8.2 @Traceæ³¨è§£ä½¿ç”¨


**åŸºç¡€ç”¨æ³•ï¼š**
```java
@Service
public class OrderService {
    
    // è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º"createOrder"çš„Span
    @Trace
    public Order createOrder(OrderDTO dto) {
        // ä¸šåŠ¡é€»è¾‘
        return saveOrder(dto);
    }
    
    // è‡ªå®šä¹‰Spanåç§°
    @Trace(operationName = "è®¢å•ä¿å­˜")
    private Order saveOrder(OrderDTO dto) {
        return orderRepository.save(dto);
    }
}
```

**æ‰§è¡Œæ•ˆæœï¼š**
```
é“¾è·¯è¿½è¸ªæ˜¾ç¤ºï¼š
OrderController.createOrder (HTTP Span)
    â””â”€â”€ OrderService.createOrder (@Trace Span)
            â””â”€â”€ OrderService.è®¢å•ä¿å­˜ (@Trace Span)
                    â””â”€â”€ MySQL.insert (è‡ªåŠ¨Span)
```

### 8.3 @Tagæ³¨è§£ä½¿ç”¨


**å‚æ•°æ ‡ç­¾ï¼š**
```java
@Service
public class UserService {
    
    @Trace
    public User getUser(
        @Tag(key = "userId") Long id,      // æ ‡è®°ç”¨æˆ·ID
        @Tag(key = "source") String source  // æ ‡è®°æ¥æº
    ) {
        return userRepository.findById(id);
    }
}
```

**è¿”å›å€¼æ ‡ç­¾ï¼š**
```java
@Trace
@Tag(key = "returnType", value = "arg[0]")  // æ ‡è®°è¿”å›ç±»å‹
public Order createOrder(String orderType) {
    return new Order(orderType);
}
```

**åœ¨SkyWalking UIä¸­æ˜¾ç¤ºï¼š**
```
Spanè¯¦æƒ…ï¼š
  æ“ä½œåï¼šgetUser
  æ ‡ç­¾ï¼š
    - userId: 12345
    - source: mobile
    - returnType: NORMAL
```

### 8.4 @Tagsæ‰¹é‡æ ‡ç­¾


```java
@Trace
@Tags({
    @Tag(key = "module", value = "order"),
    @Tag(key = "operation", value = "create"),
    @Tag(key = "version", value = "v2.0")
})
public Order createOrderV2(OrderDTO dto) {
    // ä¸šåŠ¡é€»è¾‘
}
```

**ğŸ’¡ æ³¨è§£ä½¿ç”¨å»ºè®®ï¼š**

âœ… **DOï¼ˆæ¨èï¼‰ï¼š**
- åœ¨æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•ä¸Šä½¿ç”¨
- æ ‡è®°é‡è¦çš„ä¸šåŠ¡å‚æ•°
- æ·»åŠ æœ‰æ„ä¹‰çš„æ ‡ç­¾

âŒ **DON'Tï¼ˆé¿å…ï¼‰ï¼š**
- ä¸åœ¨æ¯ä¸ªæ–¹æ³•éƒ½åŠ @Traceï¼ˆæ•°æ®é‡å¤ªå¤§ï¼‰
- ä¸æ ‡è®°æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€æ‰‹æœºå·ï¼‰
- ä¸åœ¨é«˜é¢‘æ–¹æ³•ä¸Šä½¿ç”¨ï¼ˆæ€§èƒ½å½±å“ï¼‰

---

## 9. âœ… é›†æˆéªŒè¯ä¸æµ‹è¯•


### 9.1 é›†æˆæˆåŠŸéªŒè¯


**æ£€æŸ¥æ¸…å•ï¼š**

```
âœ… éªŒè¯æ­¥éª¤ï¼š
1. [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨ï¼Œæ— æŠ¥é”™
2. [ ] æ—¥å¿—ä¸­æœ‰SkyWalkingåˆå§‹åŒ–ä¿¡æ¯
3. [ ] Actuatorå¥åº·æ£€æŸ¥æ˜¾ç¤ºUP
4. [ ] SkyWalking UIä¸­èƒ½çœ‹åˆ°æœåŠ¡
5. [ ] å‘èµ·è¯·æ±‚åèƒ½çœ‹åˆ°é“¾è·¯æ•°æ®
```

**æ—¥å¿—éªŒè¯ï¼š**
```log
# æ­£å¸¸å¯åŠ¨æ—¥å¿—ç¤ºä¾‹
2025-09-23 10:30:15 INFO  SkyWalkingAgent - Skywalking agent initialized
2025-09-23 10:30:15 INFO  SkyWalkingAgent - Service name: order-service
2025-09-23 10:30:15 INFO  SkyWalkingAgent - Backend service: 127.0.0.1:11800
2025-09-23 10:30:15 INFO  BootService - All plugins initialized successfully
```

### 9.2 åŠŸèƒ½æµ‹è¯•


**æµ‹è¯•æ§åˆ¶å™¨ï¼š**
```java
@RestController
@RequestMapping("/test")
public class TraceTestController {
    
    @Autowired
    private UserClient userClient;
    
    // æµ‹è¯•é“¾è·¯è¿½è¸ª
    @GetMapping("/trace")
    public String testTrace() {
        // 1. è°ƒç”¨å¤–éƒ¨æœåŠ¡
        User user = userClient.getUser(1L);
        
        // 2. æ•°æ®åº“æ“ä½œ
        orderRepository.findAll();
        
        // 3. è¿”å›ç»“æœ
        return "Trace test completed, check SkyWalking UI";
    }
    
    // æµ‹è¯•è‡ªå®šä¹‰Span
    @GetMapping("/custom")
    @Trace(operationName = "è‡ªå®šä¹‰è¿½è¸ªæµ‹è¯•")
    public String testCustomTrace(
        @Tag(key = "testParam") String param
    ) {
        return "Custom trace: " + param;
    }
}
```

**æµ‹è¯•æ­¥éª¤ï¼š**
```bash
# 1. å‘èµ·æµ‹è¯•è¯·æ±‚
curl http://localhost:8080/test/trace

# 2. è®¿é—®SkyWalking UI
http://localhost:8080

# 3. æŸ¥çœ‹è¿½è¸ªæ•°æ®
æœåŠ¡åˆ—è¡¨ â†’ order-service â†’ æŸ¥çœ‹Trace â†’ çœ‹åˆ°å®Œæ•´é“¾è·¯
```

### 9.3 å¸¸è§é—®é¢˜æ’æŸ¥


**é—®é¢˜è¯Šæ–­è¡¨ï¼š**

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|----------|----------|----------|
| UIä¸­çœ‹ä¸åˆ°æœåŠ¡ | Agentæœªå¯åŠ¨ | æ£€æŸ¥JVMå‚æ•° `-javaagent` |
| é“¾è·¯æ•°æ®ä¸å®Œæ•´ | é‡‡æ ·ç‡è¿‡ä½ | è°ƒæ•´é‡‡æ ·é…ç½® |
| æ€§èƒ½æ˜æ˜¾ä¸‹é™ | è®°å½•å‚æ•°è¿‡å¤š | å…³é—­æ•æ„Ÿå‚æ•°è®°å½• |
| æ—¥å¿—æ— TraceId | æ—¥å¿—ç»„ä»¶æœªé›†æˆ | æ·»åŠ logbackä¾èµ– |

**è°ƒè¯•æŠ€å·§ï¼š**
```yaml
# å¼€å¯è°ƒè¯•æ—¥å¿—
logging:
  level:
    org.apache.skywalking: DEBUG  # SkyWalkingè°ƒè¯•æ—¥å¿—
    
# æ£€æŸ¥AgentçŠ¶æ€
-Dskywalking.logging.level=DEBUG  # Agentè°ƒè¯•æ¨¡å¼
```

### 9.4 æ€§èƒ½æµ‹è¯•


**å‹æµ‹éªŒè¯ï¼š**
```bash
# ä½¿ç”¨JMeteræˆ–Apache Benchå‹æµ‹
ab -n 10000 -c 100 http://localhost:8080/api/order/1

# è§‚å¯ŸæŒ‡æ ‡ï¼š
- å“åº”æ—¶é—´å˜åŒ–ï¼ˆå¯¹æ¯”å¼€å…³SkyWalkingå‰åï¼‰
- CPU/å†…å­˜å ç”¨
- SkyWalkingæ•°æ®ä¸ŠæŠ¥é‡
```

**æ€§èƒ½å½±å“å‚è€ƒï¼š**
```
æ­£å¸¸æƒ…å†µä¸‹çš„æ€§èƒ½å¼€é”€ï¼š
- å“åº”æ—¶é—´å¢åŠ ï¼š< 5%
- CPUå¢åŠ ï¼š< 10%
- å†…å­˜å¢åŠ ï¼š< 50MB

ä¼˜åŒ–å»ºè®®ï¼š
âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é‡‡æ ·
âœ… å…³é—­SQLå‚æ•°è®°å½•
âœ… é™åˆ¶Spanæ ‡ç­¾æ•°é‡
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è‡ªåŠ¨é›†æˆåŸç†
  - Spring Bootè‡ªåŠ¨é…ç½®æœºåˆ¶
  - Java Agentå­—èŠ‚ç å¢å¼º
  - é›¶ä¾µå…¥çš„å®ç°æ–¹å¼

ğŸ”¸ é…ç½®ç®¡ç†
  - application.ymlæ ¸å¿ƒé…ç½®
  - ç¯å¢ƒå·®å¼‚åŒ–é…ç½®
  - åŠ¨æ€é…ç½®çƒ­æ›´æ–°

ğŸ”¸ æœåŠ¡é›†æˆ
  - ä¸æ³¨å†Œä¸­å¿ƒé…åˆä½¿ç”¨
  - æœåŠ¡åç§°ä¿æŒä¸€è‡´
  - è‡ªåŠ¨ä¼ é€’è¿½è¸ªä¸Šä¸‹æ–‡

ğŸ”¸ æ³¨è§£ä½¿ç”¨
  - @Traceåˆ›å»ºè‡ªå®šä¹‰Span
  - @Tagæ·»åŠ ä¸šåŠ¡æ ‡ç­¾
  - åˆç†ä½¿ç”¨é¿å…æ€§èƒ½å½±å“
```

### 10.2 å…³é”®å®è·µè¦ç‚¹


**âœ… é…ç½®æœ€ä½³å®è·µï¼š**

```yaml
# æ¨èçš„ç”Ÿäº§é…ç½®æ¨¡æ¿
spring:
  application:
    name: ${SERVICE_NAME}  # ä½¿ç”¨ç¯å¢ƒå˜é‡

skywalking:
  trace:
    ignore_suffix: .jpg,.css,.js,.png,.ico
  plugin:
    jdbc:
      trace_sql_parameters: false  # ç”Ÿäº§ä¸è®°å½•æ•æ„Ÿå‚æ•°
      sql_body_max_length: 2048
    spring:
      mvc:
        collect_http_params: false  # ä¸æ”¶é›†HTTPå‚æ•°

# JVMå‚æ•°é…ç½®
-javaagent:/path/to/agent.jar
-Dskywalking.agent.service_name=${SERVICE_NAME}
-Dskywalking.collector.backend_service=${SKYWALKING_OAP}
-Dskywalking.agent.sample_n_per_3_secs=3  # é‡‡æ ·æ§åˆ¶
```

**ğŸ¯ æ³¨è§£ä½¿ç”¨åŸåˆ™ï¼š**

```
DOï¼ˆæ¨èï¼‰ï¼š
âœ… æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•ä½¿ç”¨@Trace
âœ… é‡è¦å‚æ•°ä½¿ç”¨@Tagæ ‡è®°
âœ… å…³é”®èŠ‚ç‚¹æ·»åŠ ä¸šåŠ¡æ ‡ç­¾

DON'Tï¼ˆé¿å…ï¼‰ï¼š
âŒ ä¸åœ¨æ¯ä¸ªæ–¹æ³•éƒ½åŠ æ³¨è§£
âŒ ä¸æ ‡è®°æ•æ„Ÿä¿¡æ¯
âŒ ä¸åœ¨é«˜é¢‘æ–¹æ³•ä½¿ç”¨
```

### 10.3 é›†æˆæ£€æŸ¥æ¸…å•


**ğŸ” ä¸Šçº¿å‰éªŒè¯ï¼š**

- [ ] âœ… ä¾èµ–ç‰ˆæœ¬æ­£ç¡®ä¸”å®Œæ•´
- [ ] âœ… application.ymlé…ç½®åˆç†
- [ ] âœ… Agentå‚æ•°é…ç½®æ­£ç¡®
- [ ] âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹å¯ç”¨
- [ ] âœ… UIä¸­èƒ½çœ‹åˆ°æœåŠ¡å’Œé“¾è·¯
- [ ] âœ… æ—¥å¿—ä¸­æœ‰TraceId
- [ ] âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] âœ… é‡‡æ ·ç­–ç•¥ç¬¦åˆé¢„æœŸ

### 10.4 æ•…éšœæ’æŸ¥æŒ‡å—


**å¸¸è§é—®é¢˜é€ŸæŸ¥ï¼š**

```
é—®é¢˜1ï¼šUIä¸­çœ‹ä¸åˆ°æœåŠ¡
â†’ æ£€æŸ¥Agentæ˜¯å¦å¯åŠ¨
â†’ ç¡®è®¤OAPåœ°å€æ­£ç¡®
â†’ æŸ¥çœ‹Agentæ—¥å¿—

é—®é¢˜2ï¼šé“¾è·¯æ•°æ®ä¸å®Œæ•´  
â†’ æ£€æŸ¥é‡‡æ ·é…ç½®
â†’ ç¡®è®¤æœåŠ¡è°ƒç”¨æˆåŠŸ
â†’ æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸

é—®é¢˜3ï¼šæ€§èƒ½ä¸‹é™æ˜æ˜¾
â†’ å…³é—­SQLå‚æ•°è®°å½•
â†’ é™ä½é‡‡æ ·ç‡
â†’ å‡å°‘æ ‡ç­¾æ•°é‡

é—®é¢˜4ï¼šé…ç½®ä¸ç”Ÿæ•ˆ
â†’ æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„
â†’ ç¡®è®¤åˆ·æ–°ç«¯ç‚¹è°ƒç”¨
â†’ æŸ¥çœ‹Springä¸Šä¸‹æ–‡
```

**æ ¸å¿ƒè®°å¿†ï¼š**
- Spring Bootè‡ªåŠ¨é›†æˆè®©SkyWalkingå¼€ç®±å³ç”¨
- é…ç½®æ–‡ä»¶æ§åˆ¶è¡Œä¸ºï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- æ³¨è§£æ”¯æŒè®©è‡ªå®šä¹‰è¿½è¸ªæ›´çµæ´»
- æ€§èƒ½å’ŒåŠŸèƒ½éœ€è¦å¹³è¡¡ï¼Œç”Ÿäº§ç¯å¢ƒè¦ä¼˜åŒ–é…ç½®

---

**ğŸ“ å­¦ä¹ å»ºè®®ï¼š**

```
å­¦ä¹ è·¯å¾„ï¼š
ç¬¬1æ­¥ï¼šç†è§£è‡ªåŠ¨é…ç½®åŸç†ï¼ˆçŸ¥é“ä¸ºä»€ä¹ˆé›¶ä¾µå…¥ï¼‰
ç¬¬2æ­¥ï¼šæŒæ¡åŸºç¡€é…ç½®ï¼ˆèƒ½è®©æœåŠ¡è·‘èµ·æ¥ï¼‰
ç¬¬3æ­¥ï¼šç†Ÿæ‚‰æ³¨è§£ä½¿ç”¨ï¼ˆèƒ½è‡ªå®šä¹‰è¿½è¸ªï¼‰
ç¬¬4æ­¥ï¼šå®è·µé›†æˆéªŒè¯ï¼ˆèƒ½æ’æŸ¥é—®é¢˜ï¼‰

åŠ¨æ‰‹å®è·µï¼š
1. åˆ›å»ºä¸€ä¸ªç®€å•çš„Spring Booté¡¹ç›®
2. æ·»åŠ SkyWalkingä¾èµ–
3. é…ç½®Agentå‚æ•°å¯åŠ¨
4. åœ¨SkyWalking UIä¸­æŸ¥çœ‹é“¾è·¯
5. å°è¯•ä½¿ç”¨@Traceå’Œ@Tagæ³¨è§£
```