---
title: 2ã€è¿½è¸ªæ ¸å¿ƒæœ¯è¯­ä¸Žå…³é”®è¦ç´ 
---
## ðŸ“š ç›®å½•

1. [Traceä¸ŽSpanåŸºç¡€æ¦‚å¿µ](#1-traceä¸ŽspanåŸºç¡€æ¦‚å¿µ)
2. [è¿½è¸ªæ ‡è¯†ä½“ç³»](#2-è¿½è¸ªæ ‡è¯†ä½“ç³»)
3. [Spançš„å±‚çº§å…³ç³»](#3-spançš„å±‚çº§å…³ç³»)
4. [ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶](#4-ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶)
5. [Baggageè¡ŒæŽç®±æœºåˆ¶](#5-baggageè¡ŒæŽç®±æœºåˆ¶)
6. [è¿½è¸ªæ•°æ®çš„é™„åŠ ä¿¡æ¯](#6-è¿½è¸ªæ•°æ®çš„é™„åŠ ä¿¡æ¯)
7. [ä¾èµ–å…³ç³»å›¾](#7-ä¾èµ–å…³ç³»å›¾)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ Traceä¸ŽSpanåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Traceï¼ˆè¿½è¸ªï¼‰


> ðŸ’¡ **é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ åœ¨ç½‘ä¸Šä¹°ä¸œè¥¿ï¼Œä»Žä¸‹å•åˆ°æ”¶è´§ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€ä¸ªTrace

**Traceçš„æœ¬è´¨**ï¼š
- ðŸ“¦ **å®Œæ•´çš„ä¸šåŠ¡æµç¨‹**ï¼šä»£è¡¨ä¸€æ¬¡å®Œæ•´çš„ç”¨æˆ·è¯·æ±‚æ—…ç¨‹
- ðŸ”— **è·¨æœåŠ¡çš„é“¾è·¯**ï¼šå¯èƒ½ç»è¿‡å¤šä¸ªå¾®æœåŠ¡ç³»ç»Ÿ
- â±ï¸ **æ—¶é—´çš„å®Œæ•´è·¨åº¦**ï¼šä»Žè¯·æ±‚å¼€å§‹åˆ°æœ€ç»ˆå“åº”

```
ç”¨æˆ·è´­ç‰©çš„Traceç¤ºä¾‹ï¼š
ç”¨æˆ·ä¸‹å• â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡ â†’ ç‰©æµæœåŠ¡ â†’ è®¢å•å®Œæˆ
[================= ä¸€ä¸ªå®Œæ•´çš„Trace =================]
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… ä¸€æ¬¡è¯·æ±‚å¯¹åº”ä¸€ä¸ªTrace
- âœ… TraceåŒ…å«è¯·æ±‚ç»è¿‡çš„æ‰€æœ‰èŠ‚ç‚¹
- âœ… è®°å½•äº†æ•´ä¸ªè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸ

### 1.2 ä»€ä¹ˆæ˜¯Spanï¼ˆè·¨åº¦ï¼‰


> ðŸ’¡ **é€šä¿—ç†è§£**ï¼šSpanå°±åƒæ˜¯æ•´ä¸ªæ—…ç¨‹ä¸­çš„æ¯ä¸€ä¸ª"ç«™ç‚¹"æˆ–"æ­¥éª¤"

**Spançš„æœ¬è´¨**ï¼š
- ðŸŽ¯ **æœ€å°è¿½è¸ªå•å…ƒ**ï¼šä»£è¡¨ä¸€æ¬¡å…·ä½“çš„æ“ä½œ
- â° **æœ‰æ˜Žç¡®æ—¶é—´èŒƒå›´**ï¼šæœ‰å¼€å§‹å’Œç»“æŸæ—¶é—´
- ðŸ“ **æºå¸¦æ“ä½œä¿¡æ¯**ï¼šè®°å½•è¿™ä¸€æ­¥åšäº†ä»€ä¹ˆ

```
è®¢å•æœåŠ¡å†…éƒ¨çš„Spanï¼š
Span1: æŽ¥æ”¶è®¢å•è¯·æ±‚      [å¼€å§‹ â†’ ç»“æŸ]
Span2: éªŒè¯ç”¨æˆ·ä¿¡æ¯      [å¼€å§‹ â†’ ç»“æŸ]
Span3: è°ƒç”¨åº“å­˜æœåŠ¡      [å¼€å§‹ â†’ ç»“æŸ]
Span4: ä¿å­˜è®¢å•æ•°æ®      [å¼€å§‹ â†’ ç»“æŸ]
```

**Spanè®°å½•çš„ä¿¡æ¯**ï¼š
- ðŸ”¸ æ“ä½œåç§°ï¼ˆå¦‚ï¼šæŸ¥è¯¢æ•°æ®åº“ï¼‰
- ðŸ”¸ å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´
- ðŸ”¸ æ‰§è¡ŒçŠ¶æ€ï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
- ðŸ”¸ ç›¸å…³æ ‡ç­¾å’Œæ—¥å¿—

### 1.3 Traceå’ŒSpançš„å…³ç³»


**å½¢è±¡ç±»æ¯”**ï¼š
```
Trace = ä¸€è¶Ÿå®Œæ•´çš„ç«è½¦æ—…ç¨‹
Span  = æ—…ç¨‹ä¸­ç»è¿‡çš„æ¯ä¸€ä¸ªè½¦ç«™

åŒ—äº¬ â†’ å¤©æ´¥ â†’ æµŽå— â†’ å—äº¬ â†’ ä¸Šæµ·
[Span1][Span2][Span3][Span4][Span5]
[============ Trace ============]
```

**å…³ç³»è¦ç‚¹**ï¼š
- ðŸ“Œ **ä¸€å¯¹å¤šå…³ç³»**ï¼šä¸€ä¸ªTraceåŒ…å«å¤šä¸ªSpan
- ðŸ“Œ **æ ‘å½¢ç»“æž„**ï¼šSpanä¹‹é—´æœ‰çˆ¶å­å…³ç³»
- ðŸ“Œ **æ—¶é—´åŒ…å«**ï¼šçˆ¶Spançš„æ—¶é—´èŒƒå›´åŒ…å«å­Span

---

## 2. ðŸ”‘ è¿½è¸ªæ ‡è¯†ä½“ç³»


### 2.1 TraceId - è¿½è¸ªå”¯ä¸€æ ‡è¯†


**TraceIdæ˜¯ä»€ä¹ˆï¼Ÿ**
> å°±åƒæ˜¯å¿«é€’å•å·ï¼Œæ•´ä¸ªé…é€è¿‡ç¨‹éƒ½ç”¨è¿™ä¸€ä¸ªå•å·è¿½è¸ª

**æ ¸å¿ƒä½œç”¨**ï¼š
- ðŸŽ« **å…¨å±€å”¯ä¸€ID**ï¼šæ ‡è¯†ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚é“¾è·¯
- ðŸ”— **ä¸²è”æ‰€æœ‰Span**ï¼šæ‰€æœ‰ç›¸å…³Spanéƒ½æºå¸¦ç›¸åŒTraceId
- ðŸ“ **è¿½è¸ªå®šä½**ï¼šé€šè¿‡TraceIdæ‰¾åˆ°æ•´æ¡è°ƒç”¨é“¾

```
TraceIdç¤ºä¾‹ï¼š7d8349a3-9c2e-4b5f-a1d3-8e7c9f2b4a6d

è¯·æ±‚æµè½¬è¿‡ç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘å…³æœåŠ¡ â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡
        [ç›¸åŒçš„TraceIdè´¯ç©¿å§‹ç»ˆ]
```

**TraceIdçš„ç‰¹å¾**ï¼š
- âœ… å…¨å±€å”¯ä¸€ï¼ˆé€šå¸¸æ˜¯UUIDæ ¼å¼ï¼‰
- âœ… åœ¨è¯·æ±‚å…¥å£ç”Ÿæˆ
- âœ… éšç€è°ƒç”¨é“¾ä¼ é€’
- âœ… ä¸ä¼šæ”¹å˜æˆ–é‡å¤

### 2.2 SpanId - Spanå”¯ä¸€æ ‡è¯†


**SpanIdæ˜¯ä»€ä¹ˆï¼Ÿ**
> å°±åƒæ˜¯ç«è½¦æ—…ç¨‹ä¸­æ¯ä¸ªè½¦ç«™çš„ç¼–å·

**æ ¸å¿ƒä½œç”¨**ï¼š
- ðŸ·ï¸ **æ ‡è¯†å•ä¸ªæ“ä½œ**ï¼šæ¯ä¸ªSpanæœ‰è‡ªå·±çš„å”¯ä¸€ID
- ðŸ”¢ **åŒºåˆ†ä¸åŒæ­¥éª¤**ï¼šåœ¨åŒä¸€Traceä¸­åŒºåˆ†ä¸åŒæ“ä½œ
- ðŸ“Š **æž„å»ºè°ƒç”¨å…³ç³»**ï¼šé…åˆParentIdå»ºç«‹çˆ¶å­å…³ç³»

```
åŒä¸€Traceä¸­çš„SpanIdï¼š
TraceId: abc123

SpanId: span-1  â†’ ç½‘å…³æœåŠ¡æŽ¥æ”¶è¯·æ±‚
SpanId: span-2  â†’ è°ƒç”¨è®¢å•æœåŠ¡
SpanId: span-3  â†’ è®¢å•æœåŠ¡å¤„ç†
SpanId: span-4  â†’ è°ƒç”¨åº“å­˜æœåŠ¡
```

**SpanIdçš„ç‰¹å¾**ï¼š
- âœ… åœ¨åŒä¸€Traceå†…å”¯ä¸€
- âœ… æ¯åˆ›å»ºä¸€ä¸ªSpanç”Ÿæˆä¸€ä¸ª
- âœ… ç”¨äºŽæ ‡è¯†å½“å‰æ“ä½œ
- âœ… é…åˆParentIdæž„å»ºæ ‘å½¢ç»“æž„

### 2.3 ParentId - çˆ¶Spanæ ‡è¯†


**ParentIdæ˜¯ä»€ä¹ˆï¼Ÿ**
> å°±åƒæ˜¯ä½ çš„èº«ä»½è¯ä¸Šçˆ¶äº²çš„ä¿¡æ¯ï¼Œè¯´æ˜Žä½ ä»Žå“ªæ¥

**æ ¸å¿ƒä½œç”¨**ï¼š
- ðŸ‘¨â€ðŸ‘¦ **æ ‡è¯†çˆ¶å­å…³ç³»**ï¼šæŒ‡å‘å½“å‰Spançš„çˆ¶Span
- ðŸŒ³ **æž„å»ºè°ƒç”¨æ ‘**ï¼šé€šè¿‡ParentIdå½¢æˆæ ‘å½¢ç»“æž„
- ðŸ“ˆ **è¿˜åŽŸè°ƒç”¨é“¾**ï¼šå¯ä»¥é€†å‘è¿½è¸ªè°ƒç”¨è·¯å¾„

```
çˆ¶å­å…³ç³»ç¤ºä¾‹ï¼š
Span A: SpanId=1, ParentId=null    (æ ¹Span)
  â”‚
  â”œâ”€ Span B: SpanId=2, ParentId=1  (Açš„å­Span)
  â”‚    â”‚
  â”‚    â””â”€ Span D: SpanId=4, ParentId=2
  â”‚
  â””â”€ Span C: SpanId=3, ParentId=1  (Açš„å­Span)
```

**ParentIdçš„ç‰¹æ®Šæƒ…å†µ**ï¼š
- ðŸ”¸ æ ¹Spançš„ParentIdä¸ºnullæˆ–0
- ðŸ”¸ å…¶ä»–Spançš„ParentIdæŒ‡å‘è°ƒç”¨è€…çš„SpanId
- ðŸ”¸ ç”¨äºŽè¿˜åŽŸå®Œæ•´çš„è°ƒç”¨å±‚æ¬¡

---

## 3. ðŸŒ³ Spançš„å±‚çº§å…³ç³»


### 3.1 æ ¹Spanï¼ˆRoot Spanï¼‰


**æ ¹Spanæ˜¯ä»€ä¹ˆï¼Ÿ**
> å°±åƒæ˜¯ä¸€æ£µæ ‘çš„æ ‘æ ¹ï¼Œæ˜¯æ•´ä¸ªè°ƒç”¨é“¾çš„èµ·ç‚¹

**æ ¹Spançš„ç‰¹å¾**ï¼š
- ðŸŒ± **è°ƒç”¨é“¾èµ·ç‚¹**ï¼šè¯·æ±‚è¿›å…¥ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªSpan
- â­• **æ²¡æœ‰çˆ¶èŠ‚ç‚¹**ï¼šParentIdä¸ºnull
- ðŸŽ¬ **å‘èµ·è€…**ï¼šé€šå¸¸åœ¨ç½‘å…³æˆ–ç¬¬ä¸€ä¸ªæŽ¥æ”¶è¯·æ±‚çš„æœåŠ¡åˆ›å»º

```
æ ¹Spanç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¹Span (ç½‘å…³æœåŠ¡)           â”‚
â”‚  SpanId: root-1             â”‚
â”‚  ParentId: null             â”‚
â”‚  æ“ä½œ: æŽ¥æ”¶HTTPè¯·æ±‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
      [åŽç»­å­Span]
```

**æ ¹Spanè®°å½•çš„ä¿¡æ¯**ï¼š
- ðŸ“ è¯·æ±‚çš„å…¥å£ç‚¹ï¼ˆå¦‚ï¼šHTTPè·¯å¾„ï¼‰
- ðŸ“ è¯·æ±‚çš„åˆå§‹æ—¶é—´
- ðŸ“ å®¢æˆ·ç«¯ä¿¡æ¯ï¼ˆIPã€User-Agentç­‰ï¼‰
- ðŸ“ æ•´ä½“è¯·æ±‚çš„å…ƒæ•°æ®

### 3.2 çˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰


**çˆ¶å­å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ**
> å°±åƒå®¶æ—æ ‘ï¼Œçˆ¶äº²è°ƒç”¨å„¿å­ï¼Œå½¢æˆå±‚çº§ç»“æž„

**çˆ¶å­å…³ç³»çš„å½¢æˆ**ï¼š
```
åœºæ™¯ï¼šè®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡

è®¢å•æœåŠ¡ï¼š
  åˆ›å»ºSpan Aï¼ˆçˆ¶Spanï¼‰
  â†“
  å‘èµ·RPCè°ƒç”¨
  â†“
åº“å­˜æœåŠ¡ï¼š
  åˆ›å»ºSpan Bï¼ˆå­Spanï¼ŒParentIdæŒ‡å‘Span Aï¼‰
```

**å±‚çº§å…³ç³»çš„å¯è§†åŒ–**ï¼š
```
Spanå±‚çº§æ ‘ï¼š
ç½‘å…³æœåŠ¡ (Span-1)
  â”‚
  â”œâ”€ è®¢å•æœåŠ¡ (Span-2, parent=1)
  â”‚    â”‚
  â”‚    â”œâ”€ æŸ¥è¯¢ç”¨æˆ· (Span-4, parent=2)
  â”‚    â”‚
  â”‚    â””â”€ è°ƒç”¨åº“å­˜ (Span-5, parent=2)
  â”‚         â”‚
  â”‚         â””â”€ åº“å­˜æœåŠ¡ (Span-6, parent=5)
  â”‚
  â””â”€ è°ƒç”¨æ”¯ä»˜ (Span-3, parent=1)
       â”‚
       â””â”€ æ”¯ä»˜æœåŠ¡ (Span-7, parent=3)
```

**çˆ¶å­å…³ç³»çš„ä½œç”¨**ï¼š
- âœ… **è¿˜åŽŸè°ƒç”¨é¡ºåº**ï¼šçŸ¥é“è°è°ƒç”¨äº†è°
- âœ… **è®¡ç®—è€—æ—¶å æ¯”**ï¼šåˆ†æžå“ªä¸ªçŽ¯èŠ‚æœ€æ…¢
- âœ… **å®šä½é—®é¢˜èŠ‚ç‚¹**ï¼šå¿«é€Ÿæ‰¾åˆ°å‡ºé”™çš„æœåŠ¡

### 3.3 å…„å¼ŸSpanä¸Žä¸²è¡Œ/å¹¶è¡Œå…³ç³»


**å…„å¼ŸSpançš„æ¦‚å¿µ**ï¼š
> æœ‰ç›¸åŒçˆ¶äº²çš„Spanå°±æ˜¯å…„å¼Ÿå…³ç³»

**ä¸²è¡Œè°ƒç”¨**ï¼š
```
çˆ¶Spanè°ƒç”¨å¤šä¸ªæœåŠ¡ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š

çˆ¶Span
  â”‚
  â”œâ”€ å­Span A (å…ˆæ‰§è¡Œ)
  â”‚   [å¼€å§‹â”â”â”â”â”â”ç»“æŸ]
  â”‚
  â””â”€ å­Span B (åŽæ‰§è¡Œ)
      [å¼€å§‹â”â”â”â”â”â”ç»“æŸ]

æ—¶é—´è½´ï¼šâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â†’
```

**å¹¶è¡Œè°ƒç”¨**ï¼š
```
çˆ¶SpanåŒæ—¶è°ƒç”¨å¤šä¸ªæœåŠ¡ï¼š

çˆ¶Span
  â”‚
  â”œâ”€ å­Span A
  â”‚   [å¼€å§‹â”â”â”â”â”â”ç»“æŸ]
  â”‚
  â””â”€ å­Span B
      [å¼€å§‹â”â”â”â”â”â”ç»“æŸ]

æ—¶é—´è½´ï¼šâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â†’
(ä¸¤ä¸ªSpanæ—¶é—´é‡å )
```

---

## 4. ðŸ”„ ä¸Šä¸‹æ–‡ä¼ æ’­æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ä¼ æ’­


**ä¸Šä¸‹æ–‡ä¼ æ’­çš„æœ¬è´¨**ï¼š
> å°±åƒæŽ¥åŠ›èµ›è·‘ä¸­ä¼ é€’æŽ¥åŠ›æ£’ï¼ŒæŠŠè¿½è¸ªä¿¡æ¯ä¸€ç«™ç«™ä¼ ä¸‹åŽ»

**ä¸ºä»€ä¹ˆéœ€è¦ä¸Šä¸‹æ–‡ä¼ æ’­ï¼Ÿ**
- ðŸŽ¯ **å…³è”åˆ†å¸ƒå¼è°ƒç”¨**ï¼šè®©ä¸åŒæœåŠ¡çŸ¥é“å®ƒä»¬åœ¨å¤„ç†åŒä¸€ä¸ªè¯·æ±‚
- ðŸŽ¯ **ä¿æŒTraceIdä¸€è‡´**ï¼šæ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒçš„TraceId
- ðŸŽ¯ **å»ºç«‹çˆ¶å­å…³ç³»**ï¼šå­æœåŠ¡çŸ¥é“è‡ªå·±çš„çˆ¶Spanæ˜¯è°

### 4.2 ä¸Šä¸‹æ–‡ä¼ æ’­çš„æ–¹å¼


**HTTPåè®®ä¼ æ’­**ï¼š
```
é€šè¿‡HTTP Headerä¼ é€’ï¼š

è¯·æ±‚å¤´ç¤ºä¾‹ï¼š
X-B3-TraceId: 7d8349a3-9c2e-4b5f-a1d3
X-B3-SpanId: 9c2e4b5f
X-B3-ParentSpanId: 7d8349a3
X-B3-Sampled: 1

æœåŠ¡A â†’ HTTPè¯·æ±‚ â†’ æœåŠ¡B
       [Headeræºå¸¦è¿½è¸ªä¿¡æ¯]
```

**RPCæ¡†æž¶ä¼ æ’­**ï¼š
```
é€šè¿‡RPCä¸Šä¸‹æ–‡ä¼ é€’ï¼š

Dubbo: 
- é€šè¿‡RpcContext.getContext()ä¼ é€’
- è‡ªåŠ¨æ³¨å…¥è¿½è¸ªä¿¡æ¯

gRPC:
- é€šè¿‡Metadataä¼ é€’
- ä½¿ç”¨æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç†
```

**æ¶ˆæ¯é˜Ÿåˆ—ä¼ æ’­**ï¼š
```
é€šè¿‡æ¶ˆæ¯å±žæ€§ä¼ é€’ï¼š

Kafkaæ¶ˆæ¯ï¼š
Headers:
  - trace-id: abc123
  - span-id: def456
  - parent-span-id: xyz789

ç”Ÿäº§è€… â†’ Kafka â†’ æ¶ˆè´¹è€…
        [æ¶ˆæ¯å¤´æºå¸¦è¿½è¸ªä¿¡æ¯]
```

### 4.3 ä¸Šä¸‹æ–‡ä¼ æ’­çš„æµç¨‹


```
å®Œæ•´ä¼ æ’­æµç¨‹ï¼š

å®¢æˆ·ç«¯è¯·æ±‚
   â”‚
   â–¼
[1] ç½‘å…³æœåŠ¡ï¼ˆç”ŸæˆTraceIdå’Œæ ¹SpanIdï¼‰
   â”‚ åˆ›å»ºè¿½è¸ªä¸Šä¸‹æ–‡
   â”‚ TraceId: abc123
   â”‚ SpanId: span-1
   â”‚ ParentId: null
   â”‚
   â–¼
[2] è°ƒç”¨è®¢å•æœåŠ¡ï¼ˆæå–ä¸Šä¸‹æ–‡ï¼Œåˆ›å»ºæ–°Spanï¼‰
   â”‚ è¯»å–ï¼šTraceId=abc123
   â”‚ åˆ›å»ºï¼šSpanId=span-2, ParentId=span-1
   â”‚
   â–¼
[3] è°ƒç”¨åº“å­˜æœåŠ¡ï¼ˆç»§ç»­ä¼ æ’­ï¼‰
   â”‚ è¯»å–ï¼šTraceId=abc123
   â”‚ åˆ›å»ºï¼šSpanId=span-3, ParentId=span-2
   â”‚
   â–¼
å“åº”è¿”å›ž
```

**å…³é”®æ­¥éª¤**ï¼š
1. **æå–ï¼ˆExtractï¼‰**ï¼šä»Žè¯·æ±‚ä¸­è¯»å–è¿½è¸ªä¿¡æ¯
2. **åˆ›å»ºï¼ˆCreateï¼‰**ï¼šåˆ›å»ºå½“å‰æœåŠ¡çš„Span
3. **æ³¨å…¥ï¼ˆInjectï¼‰**ï¼šå°†è¿½è¸ªä¿¡æ¯æ³¨å…¥åˆ°ä¸‹æ¸¸è¯·æ±‚ä¸­

---

## 5. ðŸŽ’ Baggageè¡ŒæŽç®±æœºåˆ¶


### 5.1 Baggageæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼š
> Baggageå°±åƒä½ æ—…è¡Œæ—¶çš„è¡ŒæŽç®±ï¼Œå¯ä»¥éšèº«æºå¸¦ä¸€äº›é¢å¤–çš„ä¸œè¥¿

**Baggageçš„æœ¬è´¨**ï¼š
- ðŸ“¦ **è·¨æœåŠ¡ä¼ é€’çš„é”®å€¼å¯¹**ï¼šå¯ä»¥æºå¸¦ä¸šåŠ¡æ•°æ®
- ðŸ”„ **éšç€è°ƒç”¨é“¾ä¼ æ’­**ï¼šè‡ªåŠ¨åœ¨æœåŠ¡é—´ä¼ é€’
- ðŸ“ **å­˜å‚¨é¢å¤–ä¿¡æ¯**ï¼šä¸ä»…ä»…æ˜¯è¿½è¸ªID

```
Baggageä¼ æ’­ç¤ºä¾‹ï¼š

æœåŠ¡Aæ·»åŠ Baggageï¼š
baggage.put("userId", "10086")
baggage.put("platform", "mobile")

æœåŠ¡A â†’ æœåŠ¡B â†’ æœåŠ¡C
      [Baggageè‡ªåŠ¨ä¼ é€’]

æœåŠ¡Cå¯ä»¥è¯»å–ï¼š
userId = baggage.get("userId")    // "10086"
platform = baggage.get("platform") // "mobile"
```

### 5.2 Baggageçš„ä½¿ç”¨åœºæ™¯


**å…¸åž‹åº”ç”¨åœºæ™¯**ï¼š

**åœºæ™¯1ï¼šä¼ é€’ç”¨æˆ·ä¿¡æ¯**
```
ç”¨æˆ·ç™»å½•åŽï¼Œåœ¨Baggageä¸­å­˜å‚¨ï¼š
- ç”¨æˆ·ID
- ç”¨æˆ·è§’è‰²
- ç§Ÿæˆ·ID

ä¸‹æ¸¸æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥èŽ·å–è¿™äº›ä¿¡æ¯ï¼Œ
æ— éœ€é‡å¤æŸ¥è¯¢æ•°æ®åº“
```

**åœºæ™¯2ï¼šä¼ é€’ä¸šåŠ¡ä¸Šä¸‹æ–‡**
```
åœ¨Baggageä¸­å­˜å‚¨ï¼š
- è¯·æ±‚æ¥æºï¼ˆAPP/Web/å°ç¨‹åºï¼‰
- ä¸šåŠ¡åœºæ™¯ï¼ˆä¿ƒé”€æ´»åŠ¨IDï¼‰
- ç°åº¦æ ‡è¯†

ç”¨äºŽå®žçŽ°ï¼š
- ä¸åŒæ¸ é“çš„å·®å¼‚åŒ–å¤„ç†
- æ´»åŠ¨è§„åˆ™çš„åº”ç”¨
- ç°åº¦å‘å¸ƒçš„æµé‡æŽ§åˆ¶
```

**åœºæ™¯3ï¼šä¼ é€’è°ƒè¯•ä¿¡æ¯**
```
åœ¨Baggageä¸­å­˜å‚¨ï¼š
- è°ƒè¯•æ ‡è®°
- è¯·æ±‚æµæ°´å·
- çŽ¯å¢ƒæ ‡è¯†ï¼ˆtest/prodï¼‰

ç”¨äºŽï¼š
- çº¿ä¸Šé—®é¢˜æŽ’æŸ¥
- è¯·æ±‚é“¾è·¯è·Ÿè¸ª
- çŽ¯å¢ƒéš”ç¦»
```

### 5.3 Baggageä½¿ç”¨æ³¨æ„äº‹é¡¹


> âš ï¸ **é‡è¦æç¤º**ï¼šBaggageä¼šå¢žåŠ ç½‘ç»œä¼ è¾“å¼€é”€ï¼Œä¸å®œå­˜å‚¨è¿‡å¤šæ•°æ®

**ä½¿ç”¨åŽŸåˆ™**ï¼š
- âœ… **åªå­˜å¿…è¦ä¿¡æ¯**ï¼šä¸è¦æŠŠæ‰€æœ‰æ•°æ®éƒ½æ”¾è¿›åŽ»
- âœ… **æŽ§åˆ¶æ•°æ®å¤§å°**ï¼šå»ºè®®å•ä¸ªå€¼ä¸è¶…è¿‡1KB
- âœ… **é¿å…æ•æ„Ÿä¿¡æ¯**ï¼šä¸è¦å­˜å¯†ç ã€tokenç­‰
- âœ… **é™åˆ¶æ•°é‡**ï¼šå»ºè®®ä¸è¶…è¿‡10ä¸ªé”®å€¼å¯¹

**Baggage vs å…¶ä»–ä¼ é€’æ–¹å¼**ï¼š

| ä¼ é€’æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|---------|
| **Baggage** | `è‡ªåŠ¨ä¼ æ’­ï¼Œä½¿ç”¨ç®€å•` | `å¢žåŠ ç½‘ç»œå¼€é”€` | `å°‘é‡å…¨å±€æ•°æ®` |
| **HTTP Header** | `æ ‡å‡†åŒ–ï¼Œå…¼å®¹æ€§å¥½` | `éœ€è¦æ‰‹åŠ¨å¤„ç†` | `ç‰¹å®šæœåŠ¡é—´ä¼ é€’` |
| **RPCå‚æ•°** | `æ˜¾å¼æ¸…æ™°` | `éœ€è¦ä¿®æ”¹æŽ¥å£` | `æ˜Žç¡®çš„å‚æ•°ä¼ é€’` |
| **ç¼“å­˜/æ•°æ®åº“** | `ä¸å½±å“è°ƒç”¨é“¾è·¯` | `éœ€è¦é¢å¤–æŸ¥è¯¢` | `å¤§é‡æ•°æ®æˆ–æŒä¹…åŒ–` |

---

## 6. ðŸ“Š è¿½è¸ªæ•°æ®çš„é™„åŠ ä¿¡æ¯


### 6.1 é”™è¯¯æ ‡è®°ï¼ˆError Flagï¼‰


**é”™è¯¯æ ‡è®°æ˜¯ä»€ä¹ˆï¼Ÿ**
> æ ‡è¯†è¿™ä¸ªSpanæ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œå°±åƒè€ƒè¯•å·ä¸Šçš„å¯¹é”™æ ‡è®°

**é”™è¯¯æ ‡è®°çš„ä½œç”¨**ï¼š
- âŒ **æ ‡è¯†å¤±è´¥æ“ä½œ**ï¼šå¿«é€Ÿå®šä½å‡ºé”™çš„çŽ¯èŠ‚
- ðŸ“ **è®°å½•å¼‚å¸¸ä¿¡æ¯**ï¼šä¿å­˜é”™è¯¯è¯¦æƒ…
- ðŸš¨ **è§¦å‘å‘Šè­¦**ï¼šé”™è¯¯çŽ‡è¶…æ ‡æ—¶æŠ¥è­¦

```
é”™è¯¯æ ‡è®°çš„è¡¨çŽ°ï¼š

æ­£å¸¸Spanï¼š
{
  "spanId": "span-123",
  "error": false,
  "status": "OK"
}

å¼‚å¸¸Spanï¼š
{
  "spanId": "span-456",
  "error": true,
  "status": "ERROR",
  "errorType": "NullPointerException",
  "errorMsg": "è®¢å•å¯¹è±¡ä¸ºç©º",
  "stackTrace": "..."
}
```

**é”™è¯¯åˆ†ç±»**ï¼š
- ðŸ”¸ **ä¸šåŠ¡å¼‚å¸¸**ï¼šå¦‚åº“å­˜ä¸è¶³ã€ç”¨æˆ·ä¸å­˜åœ¨
- ðŸ”¸ **ç³»ç»Ÿå¼‚å¸¸**ï¼šå¦‚æ•°æ®åº“è¿žæŽ¥å¤±è´¥ã€è¶…æ—¶
- ðŸ”¸ **ç½‘ç»œå¼‚å¸¸**ï¼šå¦‚RPCè°ƒç”¨å¤±è´¥ã€HTTP 500

### 6.2 è€—æ—¶ç»Ÿè®¡ï¼ˆDurationï¼‰


**è€—æ—¶ç»Ÿè®¡æ˜¯ä»€ä¹ˆï¼Ÿ**
> è®°å½•æ¯ä¸ªæ“ä½œèŠ±äº†å¤šé•¿æ—¶é—´ï¼Œæ‰¾å‡ºæ…¢çš„çŽ¯èŠ‚

**è€—æ—¶çš„è®¡ç®—æ–¹å¼**ï¼š
```
è€—æ—¶ = ç»“æŸæ—¶é—´ - å¼€å§‹æ—¶é—´

Spanè€—æ—¶ç¤ºä¾‹ï¼š
å¼€å§‹æ—¶é—´: 2025-09-23 10:00:00.000
ç»“æŸæ—¶é—´: 2025-09-23 10:00:02.500
è€—æ—¶: 2500ms (2.5ç§’)
```

**è€—æ—¶åˆ†æžçš„ä»·å€¼**ï¼š
```
æ•´ä½“è¯·æ±‚è€—æ—¶ï¼š5000ms

åˆ†è§£åˆ†æžï¼š
- ç½‘å…³æœåŠ¡ï¼š50ms (1%)
- è®¢å•æœåŠ¡ï¼š200ms (4%)
- åº“å­˜æœåŠ¡ï¼š3500ms (70%)  â† æ€§èƒ½ç“¶é¢ˆ
- æ”¯ä»˜æœåŠ¡ï¼š1000ms (20%)
- å…¶ä»–ï¼š250ms (5%)

ç»“è®ºï¼šåº“å­˜æœåŠ¡æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œéœ€è¦ä¼˜åŒ–
```

**è€—æ—¶çš„ç»Ÿè®¡ç»´åº¦**ï¼š
- ðŸ“ˆ **å•ä¸ªSpanè€—æ—¶**ï¼šæŸä¸ªæ“ä½œçš„æ‰§è¡Œæ—¶é—´
- ðŸ“ˆ **å­Spanæ€»è€—æ—¶**ï¼šæ‰€æœ‰å­æ“ä½œçš„æ—¶é—´æ€»å’Œ
- ðŸ“ˆ **è‡ªèº«è€—æ—¶**ï¼šæ‰£é™¤å­SpanåŽçš„è‡ªèº«æ‰§è¡Œæ—¶é—´
- ðŸ“ˆ **æ•´ä½“Traceè€—æ—¶**ï¼šä»Žå¤´åˆ°å°¾çš„æ€»æ—¶é—´

### 6.3 æ ‡ç­¾ï¼ˆTagsï¼‰ä¸Žæ—¥å¿—ï¼ˆLogsï¼‰


**Tags - ç»“æž„åŒ–æ ‡ç­¾**ï¼š
> åƒç»™æ–‡ä»¶è´´æ ‡ç­¾ï¼Œæ–¹ä¾¿åˆ†ç±»å’Œæœç´¢

```
å¸¸ç”¨æ ‡ç­¾ç¤ºä¾‹ï¼š

# æœåŠ¡ç›¸å…³
span.kind: server/client
service.name: order-service
service.version: v1.2.3

# æ•°æ®åº“ç›¸å…³
db.type: MySQL
db.instance: order_db
db.statement: SELECT * FROM orders

# HTTPç›¸å…³
http.method: POST
http.url: /api/orders
http.status_code: 200

# ä¸šåŠ¡ç›¸å…³
order.id: 123456
user.id: 10086
```

**Logs - æ—¶é—´ç‚¹æ—¥å¿—**ï¼š
> è®°å½•å…³é”®æ—¶åˆ»å‘ç”Ÿçš„äº‹æƒ…

```
æ—¥å¿—è®°å½•ç¤ºä¾‹ï¼š

[10:00:00.100] å¼€å§‹å¤„ç†è®¢å•
[10:00:00.500] æ ¡éªŒç”¨æˆ·ä¿¡æ¯å®Œæˆ
[10:00:01.200] è°ƒç”¨åº“å­˜æœåŠ¡
[10:00:02.800] åº“å­˜æ‰£å‡æˆåŠŸ
[10:00:03.500] è®¢å•åˆ›å»ºå®Œæˆ
```

**Tags vs Logsçš„åŒºåˆ«**ï¼š

| ç‰¹æ€§ | Tagsï¼ˆæ ‡ç­¾ï¼‰ | Logsï¼ˆæ—¥å¿—ï¼‰ |
|------|------------|-------------|
| **æ€§è´¨** | `é”®å€¼å¯¹ï¼Œé™æ€` | `æ—¶é—´åºåˆ—ï¼ŒåŠ¨æ€` |
| **æ—¶é—´** | `Spançº§åˆ«` | `ç‰¹å®šæ—¶åˆ»` |
| **ç”¨é€”** | `åˆ†ç±»ã€ç­›é€‰ã€èšåˆ` | `è¯¦ç»†è¿‡ç¨‹ã€æŽ’æŸ¥é—®é¢˜` |
| **ç¤ºä¾‹** | `http.method=POST` | `[æ—¶é—´] ç”¨æˆ·ç™»å½•æˆåŠŸ` |

---

## 7. ðŸ•¸ï¸ ä¾èµ–å…³ç³»å›¾


### 7.1 ä»€ä¹ˆæ˜¯ä¾èµ–å…³ç³»å›¾


**ä¾èµ–å…³ç³»å›¾çš„å®šä¹‰**ï¼š
> å°±åƒæ˜¯ä¸€å¼ æœåŠ¡é—´çš„"å…³ç³»ç½‘ç»œå›¾"ï¼Œå±•ç¤ºè°è°ƒç”¨äº†è°

**ä¾èµ–å…³ç³»å›¾çš„æž„æˆ**ï¼š
```
ä¾èµ–å…³ç³»ç¤ºä¾‹ï¼š

        ç½‘å…³æœåŠ¡
         /   \
        /     \
    è®¢å•æœåŠ¡  ç”¨æˆ·æœåŠ¡
      /  \
     /    \
  åº“å­˜æœåŠ¡ æ”¯ä»˜æœåŠ¡
```

**ä»ŽTraceæ•°æ®ç”Ÿæˆä¾èµ–å›¾**ï¼š
```
é€šè¿‡åˆ†æžå¤šä¸ªTraceçš„è°ƒç”¨å…³ç³»ï¼š

Trace-1: ç½‘å…³ â†’ è®¢å• â†’ åº“å­˜
Trace-2: ç½‘å…³ â†’ è®¢å• â†’ æ”¯ä»˜
Trace-3: ç½‘å…³ â†’ ç”¨æˆ·

æ±‡æ€»åŽå½¢æˆä¾èµ–å›¾ï¼š
ç½‘å…³æœåŠ¡ â†’ è®¢å•æœåŠ¡
ç½‘å…³æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡  
è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡
è®¢å•æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡
```

### 7.2 ä¾èµ–å…³ç³»å›¾çš„ä½œç”¨


**ä½œç”¨1ï¼šæž¶æž„å¯è§†åŒ–**
```
æ¸…æ™°å±•ç¤ºï¼š
- ç³»ç»Ÿæœ‰å¤šå°‘ä¸ªæœåŠ¡
- æœåŠ¡é—´çš„è°ƒç”¨å…³ç³»
- å“ªäº›æ˜¯æ ¸å¿ƒæœåŠ¡
- å“ªäº›æ˜¯ç‹¬ç«‹æ¨¡å—
```

**ä½œç”¨2ï¼šå½±å“é¢åˆ†æž**
```
å½“æŸä¸ªæœåŠ¡å‡ºé—®é¢˜æ—¶ï¼š
è®¢å•æœåŠ¡æŒ‚äº† â†’ å½±å“ï¼šç½‘å…³æœåŠ¡ï¼ˆè°ƒç”¨æ–¹ï¼‰
                   å½±å“ï¼šåº“å­˜æœåŠ¡ï¼ˆè¢«è°ƒç”¨æ–¹æ— æ³•æ‰§è¡Œï¼‰
                   å½±å“ï¼šæ”¯ä»˜æœåŠ¡ï¼ˆè¢«è°ƒç”¨æ–¹æ— æ³•æ‰§è¡Œï¼‰
```

**ä½œç”¨3ï¼šæ€§èƒ½åˆ†æž**
```
è¯†åˆ«ï¼š
- è°ƒç”¨æ¬¡æ•°æœ€å¤šçš„æœåŠ¡ï¼ˆçƒ­ç‚¹æœåŠ¡ï¼‰
- è°ƒç”¨é“¾è·¯æœ€é•¿çš„è·¯å¾„ï¼ˆä¼˜åŒ–é‡ç‚¹ï¼‰
- å­˜åœ¨å¾ªçŽ¯ä¾èµ–çš„æœåŠ¡ï¼ˆæž¶æž„é—®é¢˜ï¼‰
```

### 7.3 ä¾èµ–å…³ç³»çš„æŒ‡æ ‡


**å…³é”®æŒ‡æ ‡è¯´æ˜Ž**ï¼š

| æŒ‡æ ‡ | å«ä¹‰ | è¯´æ˜Ž | ä½œç”¨ |
|------|------|------|------|
| **è°ƒç”¨æ¬¡æ•°** | `Aè°ƒç”¨Bçš„æ€»æ¬¡æ•°` | `åæ˜ è°ƒç”¨é¢‘çŽ‡` | `æ‰¾å‡ºçƒ­ç‚¹è°ƒç”¨` |
| **å¹³å‡è€—æ—¶** | `è°ƒç”¨çš„å¹³å‡å“åº”æ—¶é—´` | `åæ˜ æ€§èƒ½æ°´å¹³` | `æ€§èƒ½ä¼˜åŒ–ä¾æ®` |
| **é”™è¯¯çŽ‡** | `å¤±è´¥æ¬¡æ•°/æ€»æ¬¡æ•°` | `åæ˜ ç¨³å®šæ€§` | `é—®é¢˜å®šä½` |
| **P95è€—æ—¶** | `95%è¯·æ±‚çš„è€—æ—¶` | `åæ˜ æ…¢è¯·æ±‚æƒ…å†µ` | `SLAä¿éšœ` |

**ä¾èµ–å…³ç³»å›¾çš„å±•çŽ°å½¢å¼**ï¼š
```
æ‹“æ‰‘å›¾å½¢å¼ï¼š
       (A) ----50æ¬¡/s----> (B)
        |                   |
      30æ¬¡/s              20æ¬¡/s
        |                   |
        â–¼                   â–¼
       (C) <----10æ¬¡/s---- (D)

ç®­å¤´è¡¨ç¤ºè°ƒç”¨æ–¹å‘
æ•°å­—è¡¨ç¤ºè°ƒç”¨é¢‘çŽ‡
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ Traceï¼ˆè¿½è¸ªï¼‰ï¼šä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚é“¾è·¯ï¼Œåƒå¿«é€’å…¨ç¨‹è¿½è¸ª
ðŸ”¸ Spanï¼ˆè·¨åº¦ï¼‰ï¼šé“¾è·¯ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼Œåƒå¿«é€’ä¸­çš„ä¸€ä¸ªç«™ç‚¹
ðŸ”¸ TraceIdï¼šå…¨å±€å”¯ä¸€æ ‡è¯†ï¼Œä¸²è”æ•´æ¡é“¾è·¯
ðŸ”¸ SpanIdï¼šSpançš„å”¯ä¸€æ ‡è¯†ï¼ŒåŒºåˆ†ä¸åŒæ­¥éª¤
ðŸ”¸ ParentIdï¼šçˆ¶Spanæ ‡è¯†ï¼Œå»ºç«‹å±‚çº§å…³ç³»
```

### 8.2 æ ¸å¿ƒæ ‡è¯†ä½“ç³»ç†è§£


**æ ‡è¯†çš„å…³ç³»**ï¼š
```
TraceId: æ•´æ¡é“¾è·¯çš„èº«ä»½è¯å·
  â””â”€ SpanId-1: ç¬¬ä¸€æ­¥çš„ç¼–å·
       â””â”€ ParentId: null (æ ¹èŠ‚ç‚¹)
  â””â”€ SpanId-2: ç¬¬äºŒæ­¥çš„ç¼–å·
       â””â”€ ParentId: SpanId-1 (çˆ¶å­å…³ç³»)
  â””â”€ SpanId-3: ç¬¬ä¸‰æ­¥çš„ç¼–å·
       â””â”€ ParentId: SpanId-2 (çˆ¶å­å…³ç³»)
```

### 8.3 å…³é”®æœºåˆ¶è®°å¿†è¦ç‚¹


**ä¸Šä¸‹æ–‡ä¼ æ’­**ï¼š
- ðŸ”„ **åƒæŽ¥åŠ›æ£’**ï¼šè¿½è¸ªä¿¡æ¯åœ¨æœåŠ¡é—´ä¼ é€’
- ðŸ”„ **å¤šç§æ–¹å¼**ï¼šHTTP Headerã€RPCä¸Šä¸‹æ–‡ã€æ¶ˆæ¯å¤´
- ðŸ”„ **è‡ªåŠ¨å¤„ç†**ï¼šæ¡†æž¶é€šå¸¸ä¼šè‡ªåŠ¨ä¼ æ’­

**Baggageè¡ŒæŽç®±**ï¼š
- ðŸŽ’ **é¢å¤–æ•°æ®**ï¼šæºå¸¦ä¸šåŠ¡ä¸Šä¸‹æ–‡ä¿¡æ¯
- ðŸŽ’ **å…¨é“¾è·¯ä¼ æ’­**ï¼šæ‰€æœ‰æœåŠ¡éƒ½èƒ½è®¿é—®
- ðŸŽ’ **è°¨æ…Žä½¿ç”¨**ï¼šæŽ§åˆ¶æ•°æ®é‡é¿å…å¼€é”€

**é”™è¯¯ä¸Žè€—æ—¶**ï¼š
- âŒ **é”™è¯¯æ ‡è®°**ï¼šå¿«é€Ÿå®šä½é—®é¢˜çŽ¯èŠ‚
- â±ï¸ **è€—æ—¶ç»Ÿè®¡**ï¼šæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ
- ðŸ“Š **æ•°æ®é©±åŠ¨**ï¼šåŸºäºŽæ•°æ®åšä¼˜åŒ–å†³ç­–

### 8.4 å®žé™…åº”ç”¨ä»·å€¼


**é—®é¢˜æŽ’æŸ¥**ï¼š
```
ç”Ÿäº§çŽ¯å¢ƒè®¢å•åˆ›å»ºå¤±è´¥

é€šè¿‡TraceIdæŸ¥è¯¢ â†’ æ‰¾åˆ°å®Œæ•´è°ƒç”¨é“¾
åˆ†æžSpan â†’ å‘çŽ°åº“å­˜æœåŠ¡å‡ºé”™
æŸ¥çœ‹é”™è¯¯æ ‡è®° â†’ å®šä½å…·ä½“å¼‚å¸¸
æ£€æŸ¥è€—æ—¶ â†’ å‘çŽ°è¶…æ—¶é—®é¢˜
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
```
æŽ¥å£å“åº”æ…¢

æŸ¥çœ‹Traceè€—æ—¶åˆ†å¸ƒ â†’ å‘çŽ°æ•°æ®åº“æŸ¥è¯¢å 70%
åˆ†æžSpanè¯¦æƒ… â†’ å®šä½æ…¢SQL
æŸ¥çœ‹ä¾èµ–å…³ç³»å›¾ â†’ ä¼˜åŒ–è°ƒç”¨é“¾è·¯
```

**æž¶æž„æ²»ç†**ï¼š
```
ç³»ç»Ÿæž¶æž„å¤æ‚åº¦è¯„ä¼°

ç”Ÿæˆä¾èµ–å…³ç³»å›¾ â†’ å¯è§†åŒ–æœåŠ¡å…³ç³»
åˆ†æžè°ƒç”¨æ·±åº¦ â†’ è¯†åˆ«è¿‡æ·±çš„è°ƒç”¨é“¾
æ£€æµ‹å¾ªçŽ¯ä¾èµ– â†’ å‘çŽ°æž¶æž„é—®é¢˜
```

### 8.5 å­¦ä¹ è·¯å¾„å»ºè®®


**æ–°æ‰‹å…¥é—¨**ï¼š
1. ç†è§£Traceå’ŒSpançš„åŸºæœ¬æ¦‚å¿µ
2. æŽŒæ¡TraceIdã€SpanIdã€ParentIdçš„ä½œç”¨
3. äº†è§£ä¸Šä¸‹æ–‡ä¼ æ’­çš„åŸºæœ¬åŽŸç†

**è¿›é˜¶å­¦ä¹ **ï¼š
1. æ·±å…¥ç†è§£Baggageæœºåˆ¶çš„ä½¿ç”¨åœºæ™¯
2. æŽŒæ¡é”™è¯¯æ ‡è®°å’Œè€—æ—¶ç»Ÿè®¡çš„åˆ†æžæ–¹æ³•
3. å­¦ä¹ ä¾èµ–å…³ç³»å›¾çš„ç”Ÿæˆå’Œåˆ†æž

**å®žæˆ˜åº”ç”¨**ï¼š
1. åœ¨å®žé™…é¡¹ç›®ä¸­é…ç½®åˆ†å¸ƒå¼è¿½è¸ª
2. ä½¿ç”¨TraceIdè¿›è¡Œé—®é¢˜æŽ’æŸ¥
3. åŸºäºŽè¿½è¸ªæ•°æ®è¿›è¡Œæ€§èƒ½ä¼˜åŒ–

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Traceæ˜¯å…¨ç¨‹ï¼ŒSpanæ˜¯ç«™ç‚¹
TraceIdä¸²è”ï¼ŒSpanIdæ ‡è¯†
ParentIdå…³ç³»ï¼Œä¸Šä¸‹æ–‡ä¼ é€’
Baggageæºå¸¦ï¼Œé”™è¯¯æ ‡è®°
è€—æ—¶ç»Ÿè®¡ï¼Œä¾èµ–åˆ†æž
```