---
title: 5ã€äº‹ä»¶é©±åŠ¨æ¶æ„
---
## ğŸ“š ç›®å½•

1. [äº‹ä»¶é©±åŠ¨æ¶æ„åŸºç¡€æ¦‚å¿µ](#1-äº‹ä»¶é©±åŠ¨æ¶æ„åŸºç¡€æ¦‚å¿µ)
2. [é¢†åŸŸäº‹ä»¶è®¾è®¡](#2-é¢†åŸŸäº‹ä»¶è®¾è®¡)
3. [äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶](#3-äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶)
4. [äº‹ä»¶æº¯æºä¸CQRSæ¨¡å¼](#4-äº‹ä»¶æº¯æºä¸cqrsæ¨¡å¼)
5. [äº‹ä»¶å­˜å‚¨ä¸ç‰ˆæœ¬ç®¡ç†](#5-äº‹ä»¶å­˜å‚¨ä¸ç‰ˆæœ¬ç®¡ç†)
6. [æœ€ç»ˆä¸€è‡´æ€§å®ç°](#6-æœ€ç»ˆä¸€è‡´æ€§å®ç°)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ äº‹ä»¶é©±åŠ¨æ¶æ„åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„


**ç®€å•ç†è§£**ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„å°±åƒç”Ÿæ´»ä¸­çš„"æ¶ˆæ¯ä¼ é€’"ç³»ç»Ÿã€‚

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
ä½ åœ¨æ·˜å®ä¸‹å• â†’ è§¦å‘"è®¢å•åˆ›å»º"äº‹ä»¶
â†“
åº“å­˜ç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯ï¼šå‡å°‘åº“å­˜
æ”¯ä»˜ç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯ï¼šç­‰å¾…ä»˜æ¬¾
ç‰©æµç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯ï¼šå‡†å¤‡å‘è´§
çŸ­ä¿¡ç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯ï¼šå‘é€é€šçŸ¥

è¿™å°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼ä¸€ä¸ªåŠ¨ä½œè§¦å‘å¤šä¸ªåç»­ååº”
```

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEvent-Driven Architecture, EDAï¼‰
æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼Œç³»ç»Ÿçš„å„ä¸ªç»„ä»¶é€šè¿‡äº‹ä»¶è¿›è¡Œé€šä¿¡

å…³é”®ç‰¹ç‚¹ï¼š
ğŸ”¸ æ¾è€¦åˆï¼šå„ä¸ªæœåŠ¡ä¸ç›´æ¥ä¾èµ–ï¼Œé€šè¿‡äº‹ä»¶è¿æ¥
ğŸ”¸ å¼‚æ­¥å¤„ç†ï¼šäº‹ä»¶å‘å‡ºåä¸ç­‰å¾…ï¼Œç»§ç»­æ‰§è¡Œ
ğŸ”¸ å¯æ‰©å±•ï¼šæ–°åŠŸèƒ½åªéœ€è¦ç›‘å¬ç›¸å…³äº‹ä»¶
ğŸ”¸ æœ€ç»ˆä¸€è‡´æ€§ï¼šæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€
```

### 1.2 ä¼ ç»Ÿæ¶æ„ VS äº‹ä»¶é©±åŠ¨æ¶æ„


**ä¼ ç»ŸåŒæ­¥è°ƒç”¨æ–¹å¼**ï¼š
```
ç”¨æˆ·ä¸‹å•æµç¨‹ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š

ç”¨æˆ·æœåŠ¡ â†’ ç›´æ¥è°ƒç”¨åº“å­˜æœåŠ¡ï¼ˆç­‰å¾…å“åº”ï¼‰
       â†’ ç›´æ¥è°ƒç”¨æ”¯ä»˜æœåŠ¡ï¼ˆç­‰å¾…å“åº”ï¼‰  
       â†’ ç›´æ¥è°ƒç”¨ç‰©æµæœåŠ¡ï¼ˆç­‰å¾…å“åº”ï¼‰
       â†’ ç›´æ¥è°ƒç”¨çŸ­ä¿¡æœåŠ¡ï¼ˆç­‰å¾…å“åº”ï¼‰

é—®é¢˜ï¼š
âŒ ä»»ä½•ä¸€ä¸ªæœåŠ¡æ•…éšœï¼Œæ•´ä¸ªæµç¨‹å¤±è´¥
âŒ å“åº”æ—¶é—´=æ‰€æœ‰æœåŠ¡å¤„ç†æ—¶é—´ä¹‹å’Œ
âŒ æœåŠ¡é—´ç´§å¯†è€¦åˆï¼Œéš¾ä»¥æ‰©å±•
```

**äº‹ä»¶é©±åŠ¨æ–¹å¼**ï¼š
```
ç”¨æˆ·ä¸‹å•æµç¨‹ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰ï¼š

ç”¨æˆ·æœåŠ¡ â†’ å‘å¸ƒ"è®¢å•åˆ›å»º"äº‹ä»¶ â†’ ç«‹å³è¿”å›æˆåŠŸ

äº‹ä»¶æ€»çº¿/æ¶ˆæ¯é˜Ÿåˆ—
    â†“         â†“         â†“         â†“
åº“å­˜æœåŠ¡   æ”¯ä»˜æœåŠ¡   ç‰©æµæœåŠ¡   çŸ­ä¿¡æœåŠ¡
(å„è‡ªç‹¬ç«‹å¤„ç†ï¼Œäº’ä¸å½±å“)

ä¼˜åŠ¿ï¼š
âœ… å•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“ä¸»æµç¨‹
âœ… ç”¨æˆ·å¿«é€Ÿå¾—åˆ°å“åº”
âœ… æœåŠ¡é—´è§£è€¦ï¼Œæ˜“äºæ‰©å±•
âœ… å¯ä»¥éšæ—¶æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬è€…
```

### 1.3 äº‹ä»¶é©±åŠ¨çš„æ ¸å¿ƒç»„ä»¶


**æ¶æ„å›¾ç¤º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å‘å¸ƒäº‹ä»¶    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº‹ä»¶ç”Ÿäº§è€…  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  äº‹ä»¶æ€»çº¿    â”‚
â”‚(Event       â”‚               â”‚(Event Bus)  â”‚
â”‚ Publisher)  â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
                                     â”‚ åˆ†å‘äº‹ä»¶
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â†“              â†“              â†“
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚äº‹ä»¶æ¶ˆè´¹è€…A   â”‚â”‚äº‹ä»¶æ¶ˆè´¹è€…B   â”‚â”‚äº‹ä»¶æ¶ˆè´¹è€…C   â”‚
               â”‚(Event       â”‚â”‚(Event       â”‚â”‚(Event       â”‚
               â”‚ Consumer)   â”‚â”‚ Consumer)   â”‚â”‚ Consumer)   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶è¯´æ˜**ï¼š

ğŸ”¸ **äº‹ä»¶ç”Ÿäº§è€…ï¼ˆEvent Publisherï¼‰**
- ä½œç”¨ï¼šäº§ç”Ÿå’Œå‘å¸ƒäº‹ä»¶çš„æœåŠ¡
- ä¾‹å­ï¼šç”¨æˆ·æœåŠ¡å‘å¸ƒ"ç”¨æˆ·æ³¨å†Œ"äº‹ä»¶

ğŸ”¸ **äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰**  
- ä½œç”¨ï¼šäº‹ä»¶çš„ä¼ è¾“é€šé“
- å®ç°ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQã€Kafkaç­‰ï¼‰

ğŸ”¸ **äº‹ä»¶æ¶ˆè´¹è€…ï¼ˆEvent Consumerï¼‰**
- ä½œç”¨ï¼šç›‘å¬å’Œå¤„ç†äº‹ä»¶çš„æœåŠ¡  
- ä¾‹å­ï¼šé‚®ä»¶æœåŠ¡ç›‘å¬"ç”¨æˆ·æ³¨å†Œ"äº‹ä»¶å¹¶å‘é€æ¬¢è¿é‚®ä»¶

---

## 2. ğŸ“‹ é¢†åŸŸäº‹ä»¶è®¾è®¡


### 2.1 ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶


**é€šä¿—è§£é‡Š**ï¼šé¢†åŸŸäº‹ä»¶å°±æ˜¯ä¸šåŠ¡ä¸­"å‘ç”Ÿäº†ä»€ä¹ˆé‡è¦çš„äº‹æƒ…"ã€‚

```
ç”µå•†ç³»ç»Ÿä¸­çš„é¢†åŸŸäº‹ä»¶ï¼š
ğŸ”¸ ç”¨æˆ·æ³¨å†Œäº† â†’ UserRegistered
ğŸ”¸ è®¢å•è¢«åˆ›å»º â†’ OrderCreated  
ğŸ”¸ è®¢å•è¢«æ”¯ä»˜ â†’ OrderPaid
ğŸ”¸ å•†å“åº“å­˜ä¸è¶³ â†’ InventoryInsufficient
ğŸ”¸ è®¢å•è¢«å–æ¶ˆ â†’ OrderCancelled

è¿™äº›éƒ½æ˜¯ä¸šåŠ¡ä¸­çœŸå®å‘ç”Ÿçš„ã€å€¼å¾—å…¶ä»–æœåŠ¡å…³æ³¨çš„äº‹æƒ…
```

### 2.2 äº‹ä»¶çš„å‘½åè§„èŒƒ


**è‰¯å¥½çš„äº‹ä»¶å‘½å**ï¼š
```
âœ… æ¨èçš„å‘½åæ–¹å¼ï¼š
- ä½¿ç”¨è¿‡å»æ—¶ï¼šUserRegisteredï¼ˆç”¨æˆ·å·²æ³¨å†Œï¼‰
- è¡¨è¾¾ä¸šåŠ¡å«ä¹‰ï¼šOrderCompletedï¼ˆè®¢å•å·²å®Œæˆï¼‰
- ç®€æ´æ˜ç¡®ï¼šPaymentFailedï¼ˆæ”¯ä»˜å¤±è´¥ï¼‰

âŒ é¿å…çš„å‘½åæ–¹å¼ï¼š  
- ä½¿ç”¨ç°åœ¨æ—¶ï¼šUserRegister
- æŠ€æœ¯æœ¯è¯­ï¼šDataUpdated
- è¿‡äºå¤æ‚ï¼šUserRegistrationProcessCompletedSuccessfully
```

### 2.3 äº‹ä»¶çš„æ•°æ®ç»“æ„è®¾è®¡


**åŸºç¡€äº‹ä»¶ç»“æ„**ï¼š
```java
// æ‰€æœ‰äº‹ä»¶çš„åŸºç¡€ç±»
public abstract class DomainEvent {
    private String eventId;        // äº‹ä»¶å”¯ä¸€æ ‡è¯†
    private String eventType;      // äº‹ä»¶ç±»å‹
    private LocalDateTime occurredOn; // å‘ç”Ÿæ—¶é—´
    private String aggregateId;    // èšåˆæ ¹ID
    private int version;          // ç‰ˆæœ¬å·
    
    // æ„é€ å‡½æ•°å’Œgetteræ–¹æ³•...
}
```

**å…·ä½“äº‹ä»¶ç¤ºä¾‹**ï¼š
```java
// è®¢å•åˆ›å»ºäº‹ä»¶
public class OrderCreated extends DomainEvent {
    private String orderId;      // è®¢å•ID
    private String userId;       // ç”¨æˆ·ID  
    private BigDecimal amount;   // è®¢å•é‡‘é¢
    private List<OrderItem> items; // è®¢å•å•†å“
    private String status;       // è®¢å•çŠ¶æ€
    
    public OrderCreated(String orderId, String userId, 
                       BigDecimal amount, List<OrderItem> items) {
        super("OrderCreated");
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
        this.items = items;
        this.status = "CREATED";
    }
}
```

### 2.4 äº‹ä»¶è®¾è®¡çš„æœ€ä½³å®è·µ


**è®¾è®¡åŸåˆ™**ï¼š

ğŸ”¸ **äº‹ä»¶åº”è¯¥æ˜¯ä¸å¯å˜çš„**
```java
// âœ… æ­£ç¡®ï¼šæ‰€æœ‰å­—æ®µéƒ½æ˜¯finalï¼Œåªæœ‰getter
public class OrderCreated extends DomainEvent {
    private final String orderId;
    private final BigDecimal amount;
    
    // åªæä¾›getterï¼Œä¸æä¾›setter
    public String getOrderId() { return orderId; }
}
```

ğŸ”¸ **åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯**
```java
// âœ… å¥½çš„äº‹ä»¶ï¼šåŒ…å«å¤„ç†è¯¥äº‹ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯
public class OrderCreated {
    private String orderId;
    private String userId;
    private BigDecimal amount;
    private String shippingAddress;  // å…¶ä»–æœåŠ¡å¯èƒ½éœ€è¦çš„ä¿¡æ¯
    private List<OrderItem> items;
}

// âŒ ä¸å¥½çš„äº‹ä»¶ï¼šä¿¡æ¯ä¸è¶³ï¼Œæ¶ˆè´¹è€…éœ€è¦é¢å¤–æŸ¥è¯¢
public class OrderCreated {
    private String orderId;  // åªæœ‰IDï¼Œå…¶ä»–æœåŠ¡è¿˜éœ€è¦æŸ¥è¯¢è®¢å•è¯¦æƒ…
}
```

---

## 3. ğŸš€ äº‹ä»¶å‘å¸ƒè®¢é˜…æœºåˆ¶


### 3.1 å‘å¸ƒè®¢é˜…æ¨¡å¼åŸç†


**æ¨¡å¼è§£é‡Š**ï¼š
```
å‘å¸ƒè®¢é˜…å°±åƒè®¢é˜…æŠ¥çº¸ï¼š

å‘å¸ƒè€…ï¼ˆæŠ¥ç¤¾ï¼‰ â†’ å‘å¸ƒæŠ¥çº¸ â†’ ä¸çŸ¥é“è°ä¼šçœ‹
                     â†“
                 åˆ†å‘æ¸ é“
                     â†“
è®¢é˜…è€…ä»¬ â† å„è‡ªæ”¶åˆ°æŠ¥çº¸ â† æŠ¥ç¤¾ä¸çŸ¥é“å…·ä½“æ˜¯è°

å…³é”®ç‰¹ç‚¹ï¼š
ğŸ”¸ å‘å¸ƒè€…ä¸çŸ¥é“æœ‰å“ªäº›è®¢é˜…è€…
ğŸ”¸ è®¢é˜…è€…ä¸çŸ¥é“å‘å¸ƒè€…æ˜¯è°  
ğŸ”¸ ä¸¤è€…å®Œå…¨è§£è€¦ï¼Œé€šè¿‡ä¸­é—´æ¸ é“è¿æ¥
```

### 3.2 åœ¨Spring Bootä¸­å®ç°äº‹ä»¶å‘å¸ƒè®¢é˜…


**ç®€å•çš„å†…éƒ¨äº‹ä»¶ç³»ç»Ÿ**ï¼š
```java
// 1. äº‹ä»¶å‘å¸ƒè€…
@Service
public class OrderService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void createOrder(OrderRequest request) {
        // åˆ›å»ºè®¢å•çš„ä¸šåŠ¡é€»è¾‘
        Order order = new Order(request);
        orderRepository.save(order);
        
        // å‘å¸ƒäº‹ä»¶
        OrderCreated event = new OrderCreated(
            order.getId(), 
            order.getUserId(), 
            order.getAmount()
        );
        eventPublisher.publishEvent(event);
    }
}
```

```java
// 2. äº‹ä»¶ç›‘å¬è€…
@Component
public class InventoryEventHandler {
    
    @EventListener
    public void handleOrderCreated(OrderCreated event) {
        // å¤„ç†åº“å­˜æ‰£å‡
        System.out.println("æ”¶åˆ°è®¢å•åˆ›å»ºäº‹ä»¶ï¼Œè®¢å•ID: " + event.getOrderId());
        // æ‰§è¡Œåº“å­˜æ‰£å‡é€»è¾‘
        inventoryService.reduceInventory(event.getItems());
    }
}

@Component  
public class NotificationEventHandler {
    
    @EventListener
    public void handleOrderCreated(OrderCreated event) {
        // å‘é€é€šçŸ¥
        System.out.println("å‘é€è®¢å•åˆ›å»ºé€šçŸ¥ç»™ç”¨æˆ·: " + event.getUserId());
        // æ‰§è¡Œé€šçŸ¥é€»è¾‘
        notificationService.sendOrderConfirmation(event);
    }
}
```

### 3.3 ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å®ç°è·¨æœåŠ¡é€šä¿¡


**åŸºäºRabbitMQçš„äº‹ä»¶å‘å¸ƒ**ï¼š
```java
@Service
public class EventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void publishOrderCreated(OrderCreated event) {
        // å‘å¸ƒåˆ°æ¶ˆæ¯é˜Ÿåˆ—
        rabbitTemplate.convertAndSend(
            "order.exchange",     // äº¤æ¢æœº
            "order.created",      // è·¯ç”±é”®  
            event                 // äº‹ä»¶æ•°æ®
        );
    }
}
```

**äº‹ä»¶æ¶ˆè´¹é…ç½®**ï¼š
```java
@Component
public class OrderEventConsumer {
    
    @RabbitListener(queues = "inventory.queue")
    public void handleOrderCreated(OrderCreated event) {
        // åº“å­˜æœåŠ¡å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶
        inventoryService.reserveItems(event.getItems());
    }
}
```

### 3.4 äº‹ä»¶è·¯ç”±ä¸è¿‡æ»¤


**ä¸»é¢˜æ¨¡å¼è·¯ç”±**ï¼š
```
äº‹ä»¶è·¯ç”±ç¤ºä¾‹ï¼š

è®¢å•ç›¸å…³äº‹ä»¶è·¯ç”±é”®è®¾è®¡ï¼š
order.created    â†’ è®¢å•åˆ›å»º
order.paid       â†’ è®¢å•æ”¯ä»˜  
order.shipped    â†’ è®¢å•å‘è´§
order.cancelled  â†’ è®¢å•å–æ¶ˆ

ç”¨æˆ·ç›¸å…³äº‹ä»¶è·¯ç”±é”®ï¼š
user.registered  â†’ ç”¨æˆ·æ³¨å†Œ
user.updated     â†’ ç”¨æˆ·ä¿¡æ¯æ›´æ–°
user.deleted     â†’ ç”¨æˆ·åˆ é™¤

æœåŠ¡å¯ä»¥é€‰æ‹©æ€§è®¢é˜…ï¼š
ğŸ“¬ åº“å­˜æœåŠ¡ï¼šåªå…³å¿ƒ order.* äº‹ä»¶
ğŸ“¬ é‚®ä»¶æœåŠ¡ï¼šå…³å¿ƒ user.registered å’Œ order.* äº‹ä»¶
ğŸ“¬ æ•°æ®åˆ†ææœåŠ¡ï¼šå…³å¿ƒæ‰€æœ‰äº‹ä»¶ *.*
```

---

## 4. ğŸ“Š äº‹ä»¶æº¯æºä¸CQRSæ¨¡å¼


### 4.1 ä»€ä¹ˆæ˜¯äº‹ä»¶æº¯æº


**é€šä¿—ç†è§£**ï¼šäº‹ä»¶æº¯æºå°±åƒè®°å½•"æµæ°´è´¦"ï¼Œè®°å½•æ¯ä¸€ä¸ªæ“ä½œè€Œä¸æ˜¯æœ€ç»ˆç»“æœã€‚

```
ä¼ ç»Ÿæ–¹å¼ - åªä¿å­˜å½“å‰çŠ¶æ€ï¼š
ç”¨æˆ·è´¦æˆ·è¡¨ï¼š
| ç”¨æˆ·ID | å§“å | ä½™é¢  |
|--------|------|-------|
| 001    | å¼ ä¸‰ | 1000  |

ä½ çœ‹ä¸å‡º1000å…ƒæ˜¯æ€ä¹ˆæ¥çš„ï¼

äº‹ä»¶æº¯æºæ–¹å¼ - ä¿å­˜æ‰€æœ‰æ“ä½œè®°å½•ï¼š
äº‹ä»¶æµï¼š
1. ç”¨æˆ·æ³¨å†Œ â†’ ä½™é¢0å…ƒ
2. å……å€¼500å…ƒ â†’ ä½™é¢500å…ƒ  
3. è´­ä¹°å•†å“200å…ƒ â†’ ä½™é¢300å…ƒ
4. å……å€¼700å…ƒ â†’ ä½™é¢1000å…ƒ

é€šè¿‡é‡æ’­æ‰€æœ‰äº‹ä»¶ï¼Œå¯ä»¥å¾—åˆ°ä»»ä½•æ—¶åˆ»çš„çŠ¶æ€ï¼
```

### 4.2 äº‹ä»¶æº¯æºçš„ä¼˜åŠ¿ä¸æŒ‘æˆ˜


**ä¼˜åŠ¿**ï¼š
```
ğŸ”¸ å®Œæ•´çš„å®¡è®¡æ—¥å¿—ï¼šçŸ¥é“ä½•æ—¶ä½•äººåšäº†ä»€ä¹ˆ
ğŸ”¸ æ—¶é—´æ—…è¡Œï¼šå¯ä»¥æŸ¥çœ‹ä»»ä½•æ—¶åˆ»çš„æ•°æ®çŠ¶æ€
ğŸ”¸ è°ƒè¯•å‹å¥½ï¼šé‡ç°é—®é¢˜æ—¶çš„ç¡®åˆ‡çŠ¶æ€
ğŸ”¸ æ•°æ®æ¢å¤ï¼šæ°¸è¿œä¸ä¼šä¸¢å¤±å†å²æ•°æ®
```

**æŒ‘æˆ˜**ï¼š
```
ğŸ”¸ æŸ¥è¯¢å¤æ‚ï¼šéœ€è¦é‡æ’­äº‹ä»¶æ¥è·å–å½“å‰çŠ¶æ€
ğŸ”¸ å­˜å‚¨ç©ºé—´ï¼šäº‹ä»¶æ•°æ®ä¼šæŒç»­å¢é•¿
ğŸ”¸ äº‹ä»¶ç»“æ„å˜æ›´ï¼šæ—§äº‹ä»¶æ ¼å¼çš„å…¼å®¹æ€§é—®é¢˜
ğŸ”¸ å­¦ä¹ æˆæœ¬ï¼šå¼€å‘å›¢é˜Ÿéœ€è¦è½¬å˜æ€ç»´æ–¹å¼
```

### 4.3 CQRSæ¨¡å¼è¯¦è§£


**CQRSå…¨ç§°**ï¼šCommand Query Responsibility Segregationï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼š
è¯»å†™ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®æ¨¡å‹

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ•°æ®åº“    â”‚ â† å†™å…¥æ•°æ®
â”‚             â”‚ â† æŸ¥è¯¢æ•°æ®  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CQRSæ–¹å¼ï¼š
è¯»å†™ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¨¡å‹

å†™å…¥ä¾§ï¼š                    è¯»å–ä¾§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‘½ä»¤æ¨¡å‹   â”‚            â”‚   æŸ¥è¯¢æ¨¡å‹   â”‚
â”‚  (Command)  â”‚    åŒæ­¥     â”‚   (Query)   â”‚
â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```java
// å‘½ä»¤ä¾§ - å¤„ç†ä¸šåŠ¡æ“ä½œ
@Service
public class OrderCommandService {
    
    public void createOrder(CreateOrderCommand command) {
        // éªŒè¯ä¸šåŠ¡è§„åˆ™
        validateOrderRules(command);
        
        // åˆ›å»ºè®¢å•
        Order order = new Order(command);
        
        // ä¿å­˜äº‹ä»¶åˆ°äº‹ä»¶å­˜å‚¨
        OrderCreated event = new OrderCreated(order);
        eventStore.append(event);
        
        // å‘å¸ƒäº‹ä»¶
        eventPublisher.publish(event);
    }
}

// æŸ¥è¯¢ä¾§ - å¤„ç†æŸ¥è¯¢è¯·æ±‚
@Service  
public class OrderQueryService {
    
    public OrderView getOrderById(String orderId) {
        // ä»è¯»æ¨¡å‹ï¼ˆå¯èƒ½æ˜¯MongoDBã€Redisç­‰ï¼‰æŸ¥è¯¢
        return orderReadRepository.findById(orderId);
    }
    
    public List<OrderView> getOrdersByUser(String userId) {
        // ä¼˜åŒ–çš„æŸ¥è¯¢æ¨¡å‹ï¼Œå¯èƒ½åŒ…å«èšåˆæ•°æ®
        return orderReadRepository.findByUserId(userId);
    }
}
```

### 4.4 CQRSä¸äº‹ä»¶æº¯æºçš„ç»“åˆ


**æ¶æ„å›¾ç¤º**ï¼š
```
å‘½ä»¤ä¾§(å†™)                              æŸ¥è¯¢ä¾§(è¯»)
     â”‚                                      â”‚
     â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   äº‹ä»¶   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘½ä»¤å¤„ç†å™¨  â”‚ â”€â”€â”€â”€â”€â†’  â”‚  äº‹ä»¶å­˜å‚¨    â”‚   â”‚  è¯»æ¨¡å‹æ•°æ®åº“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                         â”‚                 â–²
     â”‚                         â”‚                 â”‚
     â–¼                         â–¼                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  é¢†åŸŸæ¨¡å‹    â”‚         â”‚  äº‹ä»¶æ€»çº¿    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ äº‹ä»¶å¤„ç†å™¨   â”‚
                        â”‚(æ›´æ–°è¯»æ¨¡å‹)  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ğŸ’¾ äº‹ä»¶å­˜å‚¨ä¸ç‰ˆæœ¬ç®¡ç†


### 5.1 äº‹ä»¶å­˜å‚¨çš„è®¾è®¡


**äº‹ä»¶å­˜å‚¨è¡¨ç»“æ„**ï¼š
```sql
CREATE TABLE event_store (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    aggregate_id VARCHAR(100) NOT NULL,     -- èšåˆæ ¹ID
    event_type VARCHAR(200) NOT NULL,       -- äº‹ä»¶ç±»å‹
    event_data JSON NOT NULL,               -- äº‹ä»¶æ•°æ®
    version INT NOT NULL,                   -- ç‰ˆæœ¬å·
    occurred_on TIMESTAMP NOT NULL,         -- å‘ç”Ÿæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_aggregate_version (aggregate_id, version),
    INDEX idx_aggregate_id (aggregate_id),
    INDEX idx_event_type (event_type),
    INDEX idx_occurred_on (occurred_on)
);
```

**äº‹ä»¶å­˜å‚¨çš„å®ç°**ï¼š
```java
@Repository
public class EventStore {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public void appendEvent(String aggregateId, DomainEvent event, int expectedVersion) {
        // ä¹è§‚é”æœºåˆ¶ï¼šæ£€æŸ¥ç‰ˆæœ¬å·é˜²æ­¢å¹¶å‘å†²çª
        String sql = """
            INSERT INTO event_store 
            (aggregate_id, event_type, event_data, version, occurred_on)
            VALUES (?, ?, ?, ?, ?)
            """;
            
        try {
            jdbcTemplate.update(sql,
                aggregateId,
                event.getEventType(),
                objectMapper.writeValueAsString(event),
                expectedVersion + 1,
                event.getOccurredOn()
            );
        } catch (DuplicateKeyException e) {
            throw new ConcurrencyException("ç‰ˆæœ¬å†²çªï¼Œèšåˆå·²è¢«å…¶ä»–æ“ä½œä¿®æ”¹");
        }
    }
    
    public List<DomainEvent> getEvents(String aggregateId, int fromVersion) {
        String sql = """
            SELECT event_type, event_data, version 
            FROM event_store 
            WHERE aggregate_id = ? AND version > ?
            ORDER BY version
            """;
            
        return jdbcTemplate.query(sql, 
            (rs, rowNum) -> deserializeEvent(rs.getString("event_data"), rs.getString("event_type")),
            aggregateId, fromVersion
        );
    }
}
```

### 5.2 äº‹ä»¶ç‰ˆæœ¬ç®¡ç†ç­–ç•¥


**ç‰ˆæœ¬ç®¡ç†çš„å¿…è¦æ€§**ï¼š
```
éšç€ç³»ç»Ÿå‘å±•ï¼Œäº‹ä»¶ç»“æ„ä¼šå‘ç”Ÿå˜åŒ–ï¼š

ç‰ˆæœ¬1çš„è®¢å•åˆ›å»ºäº‹ä»¶ï¼š
{
  "orderId": "12345",
  "userId": "user001", 
  "amount": 100.00
}

ç‰ˆæœ¬2çš„è®¢å•åˆ›å»ºäº‹ä»¶ï¼ˆå¢åŠ äº†é…é€åœ°å€ï¼‰ï¼š
{
  "orderId": "12345",
  "userId": "user001",
  "amount": 100.00,
  "shippingAddress": "åŒ—äº¬å¸‚æœé˜³åŒº..."  â† æ–°å¢å­—æ®µ
}

é—®é¢˜ï¼šæ—§ç‰ˆæœ¬çš„äº‹ä»¶å¦‚ä½•å¤„ç†ï¼Ÿ
```

**ç‰ˆæœ¬å…¼å®¹ç­–ç•¥**ï¼š

ğŸ”¸ **å‘åå…¼å®¹**ï¼ˆæ¨èï¼‰
```java
public class OrderCreated extends DomainEvent {
    private String orderId;
    private String userId;
    private BigDecimal amount;
    private String shippingAddress;  // æ–°å¢å­—æ®µï¼Œå¯ä»¥ä¸ºnull
    
    // ååºåˆ—åŒ–æ—¶ï¼Œç¼ºå¤±çš„å­—æ®µè®¾ä¸ºé»˜è®¤å€¼
    public String getShippingAddress() {
        return shippingAddress != null ? shippingAddress : "åœ°å€å¾…è¡¥å……";
    }
}
```

ğŸ”¸ **äº‹ä»¶å‡çº§å™¨**
```java
@Component
public class EventUpgrader {
    
    public DomainEvent upgrade(String eventData, String eventType) {
        JsonNode json = objectMapper.readTree(eventData);
        
        if ("OrderCreated".equals(eventType)) {
            // æ£€æŸ¥ç‰ˆæœ¬
            if (!json.has("shippingAddress")) {
                // å‡çº§æ—§ç‰ˆæœ¬äº‹ä»¶
                ((ObjectNode) json).put("shippingAddress", "åœ°å€å¾…è¡¥å……");
            }
        }
        
        return objectMapper.treeToValue(json, getEventClass(eventType));
    }
}
```

### 5.3 å¿«ç…§æœºåˆ¶ä¼˜åŒ–


**å¿«ç…§çš„ä½œç”¨**ï¼š
```
é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªèšåˆæœ‰1000ä¸ªäº‹ä»¶ï¼Œæ¯æ¬¡åŠ è½½éƒ½è¦é‡æ’­1000ä¸ªäº‹ä»¶ï¼Œå¤ªæ…¢ï¼

è§£å†³ï¼šå®šæœŸä¿å­˜å¿«ç…§

äº‹ä»¶æµç¤ºä¾‹ï¼š
äº‹ä»¶1: è´¦æˆ·åˆ›å»º â†’ ä½™é¢0
äº‹ä»¶2: å……å€¼100 â†’ ä½™é¢100  
äº‹ä»¶3: æ¶ˆè´¹50 â†’ ä½™é¢50
äº‹ä»¶4: å……å€¼200 â†’ ä½™é¢250
å¿«ç…§: ä¿å­˜å½“å‰çŠ¶æ€ï¼ˆä½™é¢250ï¼Œç‰ˆæœ¬4ï¼‰
äº‹ä»¶5: æ¶ˆè´¹30 â†’ ä½™é¢220
äº‹ä»¶6: å……å€¼100 â†’ ä½™é¢320

åŠ è½½æ—¶ï¼šç›´æ¥ä»å¿«ç…§å¼€å§‹ + é‡æ’­äº‹ä»¶5ã€6 = æœ€ç»ˆçŠ¶æ€
```

**å¿«ç…§å®ç°**ï¼š
```java
@Entity
public class AggregateSnapshot {
    private String aggregateId;
    private String aggregateType; 
    private String snapshotData;   // JSONæ ¼å¼çš„èšåˆçŠ¶æ€
    private int version;           // å¿«ç…§æ—¶çš„ç‰ˆæœ¬å·
    private LocalDateTime createdAt;
}

@Service
public class SnapshotService {
    
    // æ¯100ä¸ªäº‹ä»¶ä¿å­˜ä¸€æ¬¡å¿«ç…§
    private static final int SNAPSHOT_INTERVAL = 100;
    
    public void saveSnapshotIfNeeded(String aggregateId, Object aggregate, int version) {
        if (version % SNAPSHOT_INTERVAL == 0) {
            AggregateSnapshot snapshot = new AggregateSnapshot();
            snapshot.setAggregateId(aggregateId);
            snapshot.setSnapshotData(objectMapper.writeValueAsString(aggregate));
            snapshot.setVersion(version);
            snapshotRepository.save(snapshot);
        }
    }
}
```

---

## 6. ğŸ”„ æœ€ç»ˆä¸€è‡´æ€§å®ç°


### 6.1 ç†è§£æœ€ç»ˆä¸€è‡´æ€§


**ä»€ä¹ˆæ˜¯æœ€ç»ˆä¸€è‡´æ€§**ï¼š
```
ä¼ ç»Ÿæ•°æ®åº“äº‹åŠ¡ï¼šå¼ºä¸€è‡´æ€§
æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œæ•°æ®ç«‹å³ä¸€è‡´

åˆ†å¸ƒå¼ç³»ç»Ÿï¼šæœ€ç»ˆä¸€è‡´æ€§  
æ•°æ®åœ¨ä¸€æ®µæ—¶é—´åä¼šè¾¾åˆ°ä¸€è‡´ï¼Œä½†ä¸ä¿è¯ç«‹å³ä¸€è‡´

ä¾‹å­ï¼šå¾®ä¿¡è½¬è´¦
1. ä½ çš„è´¦æˆ·ç«‹å³æ‰£é’± âœ“
2. å¯¹æ–¹è´¦æˆ·å¯èƒ½å»¶è¿Ÿå‡ ç§’æ‰åˆ°è´¦ â°
3. æœ€ç»ˆä¸¤è¾¹è´¦æˆ·éƒ½æ­£ç¡® âœ“

è¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼
```

### 6.2 Sagaæ¨¡å¼å®ç°æœ€ç»ˆä¸€è‡´æ€§


**Sagaæ¨¡å¼**ï¼šå°†é•¿äº‹åŠ¡åˆ†è§£ä¸ºä¸€ç³»åˆ—æœ¬åœ°äº‹åŠ¡ï¼Œæ¯ä¸ªæœ¬åœ°äº‹åŠ¡éƒ½æœ‰å¯¹åº”çš„è¡¥å¿äº‹åŠ¡ã€‚

**è®¢å•å¤„ç†çš„Sagaç¤ºä¾‹**ï¼š
```
æ­£å¸¸æµç¨‹ï¼š
1. åˆ›å»ºè®¢å• âœ“
2. æ‰£å‡åº“å­˜ âœ“  
3. æ‰£é™¤ä½™é¢ âœ“
4. ç”Ÿæˆç‰©æµå• âœ“

å¤±è´¥è¡¥å¿æµç¨‹ï¼ˆå‡è®¾æ­¥éª¤3å¤±è´¥ï¼‰ï¼š
1. åˆ›å»ºè®¢å• âœ“
2. æ‰£å‡åº“å­˜ âœ“
3. æ‰£é™¤ä½™é¢ âŒ (ä½™é¢ä¸è¶³)
4. è¡¥å¿ï¼šæ¢å¤åº“å­˜ âœ“
5. è¡¥å¿ï¼šå–æ¶ˆè®¢å• âœ“
```

**Sagaå®ç°ä»£ç **ï¼š
```java
@Component
public class OrderSaga {
    
    @SagaOrchestrationStart
    public void handleOrderCreated(OrderCreated event) {
        // å¼€å§‹Sagaæµç¨‹
        sagaManager.orchestrate(OrderSagaData.builder()
            .orderId(event.getOrderId())
            .userId(event.getUserId())
            .amount(event.getAmount())
            .build());
    }
    
    @SagaStep(compensatingMethod = "compensateInventoryReduction")
    public void reduceInventory(OrderSagaData data) {
        // æ‰£å‡åº“å­˜
        inventoryService.reduce(data.getItems());
    }
    
    public void compensateInventoryReduction(OrderSagaData data) {
        // è¡¥å¿ï¼šæ¢å¤åº“å­˜
        inventoryService.restore(data.getItems());
    }
    
    @SagaStep(compensatingMethod = "compensatePaymentDeduction")  
    public void deductPayment(OrderSagaData data) {
        // æ‰£é™¤æ”¯ä»˜é‡‘é¢
        paymentService.deduct(data.getUserId(), data.getAmount());
    }
    
    public void compensatePaymentDeduction(OrderSagaData data) {
        // è¡¥å¿ï¼šé€€æ¬¾
        paymentService.refund(data.getUserId(), data.getAmount());
    }
}
```

### 6.3 æ¶ˆæ¯é‡è¯•ä¸å¹‚ç­‰æ€§


**æ¶ˆæ¯é‡è¯•æœºåˆ¶**ï¼š
```java
@Component
public class OrderEventHandler {
    
    @RetryableTopic(
        attempts = "3",                    // æœ€å¤šé‡è¯•3æ¬¡
        backoff = @Backoff(delay = 1000),  // é‡è¯•é—´éš”1ç§’
        include = {Exception.class}        // å“ªäº›å¼‚å¸¸éœ€è¦é‡è¯•
    )
    @KafkaListener(topics = "order.created")
    public void handleOrderCreated(OrderCreated event) {
        try {
            // å¤„ç†è®¢å•åˆ›å»ºé€»è¾‘
            processOrder(event);
        } catch (TemporaryException e) {
            // ä¸´æ—¶å¼‚å¸¸ï¼Œä¼šè‡ªåŠ¨é‡è¯•
            throw e;
        } catch (BusinessException e) {
            // ä¸šåŠ¡å¼‚å¸¸ï¼Œä¸é‡è¯•ï¼Œè®°å½•æ—¥å¿—
            log.error("è®¢å•å¤„ç†ä¸šåŠ¡å¼‚å¸¸", e);
        }
    }
    
    @DltHandler  // é‡è¯•å¤±è´¥åçš„å¤„ç†
    public void handleFailure(OrderCreated event, Exception ex) {
        // å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—æˆ–äººå·¥å¤„ç†
        deadLetterService.send(event, ex);
    }
}
```

**å¹‚ç­‰æ€§ä¿è¯**ï¼š
```java
@Service
public class PaymentService {
    
    @Autowired
    private PaymentRepository paymentRepository;
    
    public void processPayment(PaymentRequest request) {
        String idempotencyKey = request.getIdempotencyKey();
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡
        Payment existingPayment = paymentRepository.findByIdempotencyKey(idempotencyKey);
        if (existingPayment != null) {
            log.info("æ”¯ä»˜è¯·æ±‚å·²å¤„ç†è¿‡ï¼Œå¹‚ç­‰æ€§æ£€æŸ¥é€šè¿‡: {}", idempotencyKey);
            return; // å¹‚ç­‰æ€§ä¿è¯ï¼šé‡å¤è¯·æ±‚ä¸é‡å¤å¤„ç†
        }
        
        // å¤„ç†æ”¯ä»˜é€»è¾‘
        Payment payment = new Payment(request);
        payment.setIdempotencyKey(idempotencyKey);
        paymentRepository.save(payment);
        
        // å‘å¸ƒæ”¯ä»˜å®Œæˆäº‹ä»¶
        eventPublisher.publish(new PaymentCompleted(payment));
    }
}
```

### 6.4 äº‹ä»¶çš„é¡ºåºæ€§ä¿è¯


**åˆ†åŒºé”®ç­–ç•¥**ï¼š
```java
@Service
public class EventPublisher {
    
    public void publishOrderEvent(DomainEvent event, String orderId) {
        // ä½¿ç”¨è®¢å•IDä½œä¸ºåˆ†åŒºé”®ï¼Œç¡®ä¿åŒä¸€è®¢å•çš„äº‹ä»¶æœ‰åº
        kafkaTemplate.send("order-events", orderId, event);
    }
    
    public void publishUserEvent(DomainEvent event, String userId) {
        // ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºåˆ†åŒºé”®ï¼Œç¡®ä¿åŒä¸€ç”¨æˆ·çš„äº‹ä»¶æœ‰åº
        kafkaTemplate.send("user-events", userId, event);
    }
}
```

**æ¶ˆè´¹è€…é¡ºåºå¤„ç†**ï¼š
```java
@KafkaListener(
    topics = "order-events",
    containerFactory = "orderEventListenerFactory"
)
public void handleOrderEvents(
    OrderEvent event,
    @Header(KafkaHeaders.RECEIVED_PARTITION_ID) int partition) {
    
    // åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯ä¼šé¡ºåºå¤„ç†
    log.info("å¤„ç†è®¢å•äº‹ä»¶ï¼Œåˆ†åŒº: {}, äº‹ä»¶: {}", partition, event.getType());
    
    switch (event.getType()) {
        case "OrderCreated":
            handleOrderCreated((OrderCreated) event);
            break;
        case "OrderPaid":
            handleOrderPaid((OrderPaid) event);
            break;
        // ...å…¶ä»–äº‹ä»¶å¤„ç†
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šé€šè¿‡äº‹ä»¶å®ç°æœåŠ¡é—´æ¾è€¦åˆå¼‚æ­¥é€šä¿¡
ğŸ”¸ é¢†åŸŸäº‹ä»¶ï¼šä¸šåŠ¡ä¸­å‘ç”Ÿçš„é‡è¦äº‹æƒ…ï¼Œä½¿ç”¨è¿‡å»æ—¶å‘½å
ğŸ”¸ å‘å¸ƒè®¢é˜…ï¼šå‘å¸ƒè€…å’Œè®¢é˜…è€…è§£è€¦ï¼Œé€šè¿‡äº‹ä»¶æ€»çº¿è¿æ¥
ğŸ”¸ äº‹ä»¶æº¯æºï¼šä¿å­˜æ‰€æœ‰äº‹ä»¶è€Œéæœ€ç»ˆçŠ¶æ€ï¼Œæ”¯æŒæ—¶é—´æ—…è¡Œ
ğŸ”¸ CQRSï¼šè¯»å†™åˆ†ç¦»ï¼Œå‘½ä»¤ä¾§å¤„ç†ä¸šåŠ¡æ“ä½œï¼ŒæŸ¥è¯¢ä¾§ä¼˜åŒ–è¯»å–
ğŸ”¸ æœ€ç»ˆä¸€è‡´æ€§ï¼šæ•°æ®åœ¨ä¸€æ®µæ—¶é—´åè¾¾åˆ°ä¸€è‡´ï¼Œä¸ä¿è¯ç«‹å³ä¸€è‡´
```

### 7.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ äº‹ä»¶è®¾è®¡åŸåˆ™**
```
è®¾è®¡è¦ç‚¹ï¼š
- äº‹ä»¶ä¸å¯å˜ï¼ŒåŒ…å«è¶³å¤Ÿä¿¡æ¯
- ä½¿ç”¨è¿‡å»æ—¶å‘½åï¼Œè¡¨è¾¾ä¸šåŠ¡å«ä¹‰
- è€ƒè™‘ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œæ”¯æŒå­—æ®µæ–°å¢
- å¹‚ç­‰æ€§è®¾è®¡ï¼Œé‡å¤å¤„ç†ä¸äº§ç”Ÿå‰¯ä½œç”¨
```

**ğŸ”¹ æŠ€æœ¯å®ç°è¦ç‚¹**
```
å®ç°å…³é”®ï¼š
- é€‰æ‹©åˆé€‚çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆKafkaã€RabbitMQï¼‰
- å®ç°é‡è¯•æœºåˆ¶å’Œæ­»ä¿¡é˜Ÿåˆ—
- ä¿è¯æ¶ˆæ¯é¡ºåºæ€§ï¼ˆåˆ†åŒºé”®ç­–ç•¥ï¼‰
- å®ç°å¿«ç…§æœºåˆ¶ä¼˜åŒ–æ€§èƒ½
- å¤„ç†äº‹ä»¶ç‰ˆæœ¬å‡çº§
```

**ğŸ”¹ æ¶æ„è®¾è®¡æƒè¡¡**
```
è€ƒè™‘å› ç´ ï¼š
- ä¸€è‡´æ€§ vs æ€§èƒ½ï¼šå¼ºä¸€è‡´æ€§è¿˜æ˜¯æœ€ç»ˆä¸€è‡´æ€§
- å¤æ‚æ€§ vs è§£è€¦ï¼šäº‹ä»¶é©±åŠ¨å¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§
- å­˜å‚¨æˆæœ¬ vs å®¡è®¡éœ€æ±‚ï¼šäº‹ä»¶æº¯æºéœ€è¦æ›´å¤šå­˜å‚¨
- å¼€å‘æˆæœ¬ vs ç»´æŠ¤æ€§ï¼šéœ€è¦å›¢é˜Ÿå­¦ä¹ æˆæœ¬
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **ç”µå•†ç³»ç»Ÿ**ï¼šè®¢å•æµç¨‹è§£è€¦ï¼Œæ”¯ä»˜ã€åº“å­˜ã€ç‰©æµç‹¬ç«‹å¤„ç†
- **é‡‘èç³»ç»Ÿ**ï¼šäº¤æ˜“è®°å½•å®Œæ•´å®¡è®¡ï¼Œæ”¯æŒç›‘ç®¡è¦æ±‚
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šæ³¨å†Œã€ç™»å½•äº‹ä»¶è§¦å‘å„ç§åç»­å¤„ç†
- **å†…å®¹ç³»ç»Ÿ**ï¼šæ–‡ç« å‘å¸ƒè§¦å‘æ¨èã€æœç´¢ç´¢å¼•æ›´æ–°

**æŠ€æœ¯æ”¶ç›Š**ï¼š
- **å¯æ‰©å±•æ€§**ï¼šæ–°åŠŸèƒ½åªéœ€ç›‘å¬ç›¸å…³äº‹ä»¶
- **å®¹é”™æ€§**ï¼šå•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“æµç¨‹  
- **è°ƒè¯•æ€§**ï¼šå®Œæ•´çš„äº‹ä»¶æ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯»å†™åˆ†ç¦»ï¼ŒæŸ¥è¯¢æ¨¡å‹å¯ä¸“é—¨ä¼˜åŒ–

### 7.4 å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ


| å¸¸è§é—®é¢˜ | **äº§ç”ŸåŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|------------|-------------|
| ğŸ”¸ **äº‹ä»¶ä¸¢å¤±** | `ç½‘ç»œæ•…éšœã€æœåŠ¡å®•æœº` | `æ¶ˆæ¯æŒä¹…åŒ–ã€ç¡®è®¤æœºåˆ¶ã€é‡è¯•ç­–ç•¥` |
| ğŸ”¸ **é‡å¤å¤„ç†** | `æ¶ˆæ¯é‡å¤æŠ•é€’` | `å¹‚ç­‰æ€§è®¾è®¡ã€å»é‡æœºåˆ¶` |
| ğŸ”¸ **é¡ºåºé”™ä¹±** | `å¹¶è¡Œå¤„ç†ã€ç½‘ç»œå»¶è¿Ÿ` | `åˆ†åŒºé”®ç­–ç•¥ã€ç‰ˆæœ¬å·æ§åˆ¶` |
| ğŸ”¸ **äº‹ä»¶ç§¯å‹** | `æ¶ˆè´¹èƒ½åŠ›ä¸è¶³` | `æ°´å¹³æ‰©å±•æ¶ˆè´¹è€…ã€æ‰¹é‡å¤„ç†` |
| ğŸ”¸ **è°ƒè¯•å›°éš¾** | `å¼‚æ­¥æµç¨‹å¤æ‚` | `äº‹ä»¶è¿½è¸ªã€é“¾è·¯ç›‘æ§ã€æ—¥å¿—å…³è”` |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- äº‹ä»¶é©±åŠ¨è§£è€¦å¥½ï¼Œå¼‚æ­¥å¤„ç†æ€§èƒ½é«˜
- é¢†åŸŸäº‹ä»¶è¿‡å»æ—¶ï¼ŒåŒ…å«ä¿¡æ¯è¦å……è¶³  
- å‘å¸ƒè®¢é˜…æ¾è€¦åˆï¼Œæœ€ç»ˆä¸€è‡´å¯æ¥å—
- æº¯æºå­˜å‚¨äº‹ä»¶æµï¼ŒCQRSè¯»å†™è¦åˆ†ç¦»
- å¹‚ç­‰é‡è¯•ä¿å¯é ï¼Œé¡ºåºåˆ†åŒºæ˜¯å…³é”®

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„æ˜¯å¾®æœåŠ¡çš„é«˜çº§ä¸»é¢˜ï¼Œå»ºè®®å…ˆæŒæ¡åŸºç¡€çš„REST APIé€šä¿¡ï¼Œå†é€æ­¥å­¦ä¹ å¼‚æ­¥é€šä¿¡æ¨¡å¼ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥å…ˆä»ç®€å•çš„å†…éƒ¨äº‹ä»¶å¼€å§‹ï¼Œå†æ‰©å±•åˆ°è·¨æœåŠ¡çš„äº‹ä»¶é€šä¿¡ã€‚