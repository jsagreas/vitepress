---
title: 2ã€å®¹é”™æ¡†æ¶åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡å®¹é”™åŸºç¡€æ¦‚å¿µ](#1-å¾®æœåŠ¡å®¹é”™åŸºç¡€æ¦‚å¿µ)
2. [Hystrixç†”æ–­å™¨æ¡†æ¶](#2-hystrixç†”æ–­å™¨æ¡†æ¶)
3. [Resilience4jç°ä»£å®¹é”™æ–¹æ¡ˆ](#3-resilience4jç°ä»£å®¹é”™æ–¹æ¡ˆ)
4. [Sentinelé˜¿é‡Œå·´å·´æµæ§æ¡†æ¶](#4-sentinelé˜¿é‡Œå·´å·´æµæ§æ¡†æ¶)
5. [éš”ç¦»ç­–ç•¥è¯¦è§£](#5-éš”ç¦»ç­–ç•¥è¯¦è§£)
6. [ç¼“å­˜ä¸åˆå¹¶ä¼˜åŒ–](#6-ç¼“å­˜ä¸åˆå¹¶ä¼˜åŒ–)
7. [ç›‘æ§é¢æ¿ä¸è¿ç»´](#7-ç›‘æ§é¢æ¿ä¸è¿ç»´)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ å¾®æœåŠ¡å®¹é”™åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡å®¹é”™


**ç®€å•ç†è§£**ï¼šå®¹é”™å°±åƒç»™ä½ çš„å¾®æœåŠ¡ç³»ç»Ÿé…å¤‡"å®‰å…¨æ°”å›Š"å’Œ"ä¿é™©ä¸"

```
ç°å®ç±»æ¯”ï¼š
å®¶ç”¨ç”µè·¯ â†’ ä¿é™©ä¸ï¼šç”µæµè¿‡å¤§æ—¶è‡ªåŠ¨æ–­å¼€ï¼Œä¿æŠ¤æ•´ä¸ªç”µè·¯
æ±½è½¦å®‰å…¨ â†’ å®‰å…¨æ°”å›Šï¼šå‘ç”Ÿç¢°æ’æ—¶ä¿æŠ¤ä¹˜å®¢
å¾®æœåŠ¡   â†’ å®¹é”™æœºåˆ¶ï¼šæœåŠ¡å‡ºé”™æ—¶ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿ
```

**æ ¸å¿ƒé—®é¢˜**ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜å¯èƒ½å¼•å‘"é›ªå´©æ•ˆåº”"

```
âŒ æ²¡æœ‰å®¹é”™çš„å±é™©é“¾æ¡ï¼š
ç”¨æˆ·ä¸‹å• â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡(æ•…éšœ) â†’ è®¢å•æœåŠ¡å¡æ­» â†’ ç”¨æˆ·ç•Œé¢æ— å“åº”

âœ… æœ‰å®¹é”™ä¿æŠ¤çš„å®‰å…¨é“¾æ¡ï¼š
ç”¨æˆ·ä¸‹å• â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡(æ•…éšœ) â†’ ç†”æ–­å™¨å¯åŠ¨ â†’ è¿”å›é™çº§å“åº” â†’ ç”¨æˆ·çœ‹åˆ°å‹å¥½æç¤º
```

### 1.2 å®¹é”™çš„æ ¸å¿ƒæ€æƒ³


**ğŸ”¸ æ•…éšœéš”ç¦»**
```
åŸç†ï¼šæŠŠæ•…éšœé™åˆ¶åœ¨å°èŒƒå›´å†…ï¼Œä¸è®©å®ƒä¼ æ’­
å°±åƒï¼šèˆ¹èˆ±è¿›æ°´æ—¶å…³é—­èˆ±é—¨ï¼Œé˜²æ­¢æ•´èˆ¹æ²‰æ²¡

å®ç°æ–¹å¼ï¼š
â€¢ çº¿ç¨‹æ± éš”ç¦»ï¼šæ¯ä¸ªæœåŠ¡ç”¨ç‹¬ç«‹çº¿ç¨‹æ± 
â€¢ ä¿¡å·é‡éš”ç¦»ï¼šé™åˆ¶åŒæ—¶è®¿é—®çš„è¯·æ±‚æ•°
â€¢ æœåŠ¡ç†”æ–­ï¼šè‡ªåŠ¨åˆ‡æ–­æ•…éšœæœåŠ¡
```

**ğŸ”¸ å¿«é€Ÿå¤±è´¥**
```
ä¼ ç»Ÿæ€è·¯ï¼šä¸€ç›´é‡è¯•ç›´åˆ°æˆåŠŸ
å®¹é”™æ€è·¯ï¼šå¿«é€Ÿè¯†åˆ«å¤±è´¥ï¼Œç«‹å³è¿”å›å¤‡ç”¨æ–¹æ¡ˆ

å¥½å¤„ï¼š
â€¢ é¿å…èµ„æºæµªè´¹
â€¢ ç”¨æˆ·ä½“éªŒæ›´å¥½
â€¢ ç³»ç»Ÿå“åº”æ›´å¿«
```

**ğŸ”¸ ä¼˜é›…é™çº§**
```
æ ¸å¿ƒæ€æƒ³ï¼šä¸å…¶è®©ç³»ç»Ÿå´©æºƒï¼Œä¸å¦‚æä¾›ç®€åŒ–ç‰ˆæœåŠ¡

ä¾‹å­ï¼š
è´­ç‰©ç½‘ç«™æ¨èç³»ç»Ÿæ•…éšœ
âŒ é”™è¯¯åšæ³•ï¼šæ•´ä¸ªé¡µé¢åŠ è½½å¤±è´¥
âœ… æ­£ç¡®åšæ³•ï¼šæ˜¾ç¤ºçƒ­é—¨å•†å“ï¼Œæ¨èåŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨
```

### 1.3 å®¹é”™æœºåˆ¶åˆ†ç±»


| **å®¹é”™ç±»å‹** | **ä½œç”¨åŸç†** | **é€‚ç”¨åœºæ™¯** | **ç”Ÿæ´»ç±»æ¯”** |
|-------------|-------------|-------------|-------------|
| **ç†”æ–­å™¨** | `æ•…éšœè¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨æ–­å¼€` | `ä¸‹æ¸¸æœåŠ¡ä¸ç¨³å®š` | `å®¶ç”¨ä¿é™©ä¸` |
| **é™æµ** | `æ§åˆ¶è¯·æ±‚æµé‡å¤§å°` | `é˜²æ­¢ç³»ç»Ÿè¿‡è½½` | `é«˜é€Ÿè·¯æ”¶è´¹ç«™` |
| **é™çº§** | `æä¾›ç®€åŒ–ç‰ˆæœåŠ¡` | `éæ ¸å¿ƒåŠŸèƒ½æ•…éšœ` | `é£æœºå¤‡ç”¨ç³»ç»Ÿ` |
| **é‡è¯•** | `å¤±è´¥åè‡ªåŠ¨é‡æ–°å°è¯•` | `ç½‘ç»œæŠ–åŠ¨ç­‰ä¸´æ—¶æ•…éšœ` | `æ‹¨æ‰“å¿™çº¿ç”µè¯` |
| **è¶…æ—¶** | `è¶…è¿‡æ—¶é—´é™åˆ¶å°±æ”¾å¼ƒ` | `é˜²æ­¢æ— é™ç­‰å¾…` | `æ’é˜Ÿç­‰é¤çš„æ—¶é—´é™åˆ¶` |

---

## 2. âš¡ Hystrixç†”æ–­å™¨æ¡†æ¶


### 2.1 Hystrixæ˜¯ä»€ä¹ˆ


**ç®€å•è§£é‡Š**ï¼šHystrixæ˜¯Netflixå¼€å‘çš„å®¹é”™æ¡†æ¶ï¼Œå°±åƒç»™ä½ çš„å¾®æœåŠ¡å®‰è£…äº†ä¸€å¥—"æ™ºèƒ½ä¿æŠ¤ç³»ç»Ÿ"

```
Hystrixåå­—æ¥æºï¼š
Hystrix = è±ªçŒªï¼ˆä¸€ç§é˜²å¾¡æ€§å¾ˆå¼ºçš„åŠ¨ç‰©ï¼‰
å¯“æ„ï¼šä¿æŠ¤ç³»ç»Ÿä¸å—å¤–éƒ¨æ”»å‡»å½±å“
```

**ğŸ”¸ æ ¸å¿ƒåŠŸèƒ½ä¸€è§ˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             HystrixåŠŸèƒ½             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç†”æ–­ä¿æŠ¤      â”‚   çº¿ç¨‹æ± éš”ç¦»      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚è‡ªåŠ¨å¼€å…³ â”‚   â”‚   â”‚ç‹¬ç«‹çº¿ç¨‹æ±    â”‚ â”‚
â”‚   â”‚æ•…éšœæ£€æµ‹ â”‚   â”‚   â”‚èµ„æºéš”ç¦»     â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¯·æ±‚ç¼“å­˜      â”‚   è¯·æ±‚åˆå¹¶        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚å‡å°‘è°ƒç”¨ â”‚   â”‚   â”‚æ‰¹é‡å¤„ç†     â”‚ â”‚
â”‚   â”‚æé«˜æ€§èƒ½ â”‚   â”‚   â”‚ä¼˜åŒ–ç½‘ç»œ     â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Hystrixç†”æ–­å™¨å·¥ä½œåŸç†


**ğŸ”¸ ç†”æ–­å™¨çŠ¶æ€æœº**
```
ä¸‰ç§çŠ¶æ€è½¬æ¢ï¼š

CLOSEDï¼ˆå…³é—­ï¼‰          OPENï¼ˆæ‰“å¼€ï¼‰           HALF_OPENï¼ˆåŠå¼€ï¼‰
   â”‚                      â”‚                      â”‚
   â”‚ å¤±è´¥ç‡è¾¾åˆ°é˜ˆå€¼         â”‚ ç­‰å¾…æ—¶é—´åˆ°æœŸ         â”‚ æµ‹è¯•è¯·æ±‚æˆåŠŸ
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                      â”‚                      â”‚
   â”‚                      â”‚ æµ‹è¯•è¯·æ±‚å¤±è´¥         â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ æµ‹è¯•è¯·æ±‚æˆåŠŸ

çŠ¶æ€è¯´æ˜ï¼š
â€¢ CLOSEDï¼šæ­£å¸¸å·¥ä½œï¼Œç»Ÿè®¡å¤±è´¥ç‡
â€¢ OPENï¼šç†”æ–­çŠ¶æ€ï¼Œç›´æ¥è¿”å›é™çº§å“åº”  
â€¢ HALF_OPENï¼šå°è¯•æ¢å¤ï¼Œå…è®¸å°‘é‡è¯·æ±‚æµ‹è¯•
```

**ğŸ”¸ å…³é”®å‚æ•°é…ç½®**
```java
@HystrixCommand(
    commandProperties = {
        // ç†”æ–­å™¨è¯·æ±‚é˜ˆå€¼ï¼š10ç§’å†…è‡³å°‘20ä¸ªè¯·æ±‚æ‰å¯åŠ¨ç†”æ–­
        @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "20"),
        
        // å¤±è´¥ç‡é˜ˆå€¼ï¼š50%å¤±è´¥ç‡è§¦å‘ç†”æ–­
        @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "50"),
        
        // ç†”æ–­æŒç»­æ—¶é—´ï¼š5ç§’åå°è¯•åŠå¼€çŠ¶æ€
        @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds", value = "5000"),
        
        // è¶…æ—¶æ—¶é—´ï¼š2ç§’è¶…æ—¶
        @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "2000")
    }
)
public String callRemoteService() {
    // è°ƒç”¨è¿œç¨‹æœåŠ¡
    return restTemplate.getForObject("http://user-service/users/1", String.class);
}

// é™çº§æ–¹æ³•ï¼šå½“ç†”æ–­æˆ–è¶…æ—¶æ—¶æ‰§è¡Œ
public String callRemoteServiceFallback() {
    return "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•";
}
```

### 2.3 Hystrixå®æˆ˜åº”ç”¨


**ğŸ”¸ åŸºç¡€é›†æˆæ­¥éª¤**

```java
// 1. æ·»åŠ ä¾èµ–
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
</dependency>

// 2. å¯ç”¨Hystrix
@SpringBootApplication
@EnableHystrix  // å¯ç”¨Hystrix
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}

// 3. æœåŠ¡è°ƒç”¨ç±»
@Service
public class UserService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    // ä¸»æ–¹æ³•ï¼šæ­£å¸¸è°ƒç”¨
    @HystrixCommand(fallbackMethod = "getUserFallback")
    public User getUserById(Long id) {
        return restTemplate.getForObject(
            "http://user-service/users/" + id, User.class);
    }
    
    // é™çº§æ–¹æ³•ï¼šå‡ºé”™æ—¶è°ƒç”¨
    public User getUserFallback(Long id) {
        User defaultUser = new User();
        defaultUser.setId(id);
        defaultUser.setName("é»˜è®¤ç”¨æˆ·");
        defaultUser.setStatus("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
        return defaultUser;
    }
}
```

**ğŸ”¸ å®é™…ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹**
```java
@RestController
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    @GetMapping("/orders/{id}")
    public ResponseEntity<OrderVO> getOrder(@PathVariable Long id) {
        try {
            OrderVO order = orderService.getOrderWithUserInfo(id);
            return ResponseEntity.ok(order);
        } catch (Exception e) {
            // è¿™é‡ŒHystrixä¼šè‡ªåŠ¨å¤„ç†å¼‚å¸¸å’Œé™çº§
            return ResponseEntity.status(503)
                .body(OrderVO.builder()
                    .id(id)
                    .status("æŸ¥è¯¢å¤±è´¥")
                    .message("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•")
                    .build());
        }
    }
}

@Service
public class OrderService {
    
    // è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
    @HystrixCommand(
        fallbackMethod = "getOrderWithDefaultUser",
        commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "3000")
        }
    )
    public OrderVO getOrderWithUserInfo(Long orderId) {
        // 1. è·å–è®¢å•åŸºç¡€ä¿¡æ¯
        Order order = orderRepository.findById(orderId);
        
        // 2. è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·è¯¦æƒ…ï¼ˆå¯èƒ½å¤±è´¥çš„åœ°æ–¹ï¼‰
        User user = restTemplate.getForObject(
            "http://user-service/users/" + order.getUserId(), User.class);
        
        // 3. ç»„è£…è¿”å›æ•°æ®
        return OrderVO.builder()
            .id(order.getId())
            .productName(order.getProductName())
            .userName(user.getName())
            .userLevel(user.getLevel())
            .build();
    }
    
    // é™çº§æ–¹æ³•ï¼šç”¨æˆ·æœåŠ¡ä¸å¯ç”¨æ—¶çš„å¤„ç†
    public OrderVO getOrderWithDefaultUser(Long orderId) {
        Order order = orderRepository.findById(orderId);
        return OrderVO.builder()
            .id(order.getId())
            .productName(order.getProductName())
            .userName("ç”¨æˆ·ä¿¡æ¯æš‚æ—¶æ— æ³•è·å–")
            .userLevel("æ™®é€šç”¨æˆ·")
            .build();
    }
}
```

---

## 3. ğŸš€ Resilience4jç°ä»£å®¹é”™æ–¹æ¡ˆ


### 3.1 ä¸ºä»€ä¹ˆé€‰æ‹©Resilience4j


**èƒŒæ™¯è¯´æ˜**ï¼šHystrixå·²ç»åœæ­¢æ›´æ–°ï¼ŒSpringå®˜æ–¹æ¨èä½¿ç”¨Resilience4j

```
Hystrix vs Resilience4jå¯¹æ¯”ï¼š

                    Hystrix              Resilience4j
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç»´æŠ¤çŠ¶æ€      â”‚   åœæ­¢ç»´æŠ¤       â”‚   ç§¯æç»´æŠ¤          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è®¾è®¡ç†å¿µ      â”‚   æ³¨è§£é©±åŠ¨       â”‚   å‡½æ•°å¼ç¼–ç¨‹        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ€§èƒ½å¼€é”€      â”‚   è¾ƒé«˜           â”‚   æ›´ä½              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é…ç½®å¤æ‚åº¦    â”‚   ç›¸å¯¹å¤æ‚       â”‚   æ›´çµæ´»            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç›‘æ§èƒ½åŠ›      â”‚   å†…ç½®é¢æ¿       â”‚   æ”¯æŒå¤šç§ç›‘æ§      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ Resilience4jæ ¸å¿ƒæ¨¡å—**
```
Resilience4j = 6ä¸ªæ ¸å¿ƒæ¨¡å—ç»„åˆ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CircuitBreakerâ”‚  â”‚   RateLimiter   â”‚  â”‚     Retry       â”‚
â”‚   (ç†”æ–­å™¨)      â”‚  â”‚   (é™æµå™¨)      â”‚  â”‚   (é‡è¯•æœºåˆ¶)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TimeLimiter   â”‚  â”‚    Bulkhead     â”‚  â”‚     Cache       â”‚
â”‚   (è¶…æ—¶æ§åˆ¶)    â”‚  â”‚   (èˆ±å£éš”ç¦»)    â”‚  â”‚   (ç»“æœç¼“å­˜)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Resilience4jå¿«é€Ÿä¸Šæ‰‹


**ğŸ”¸ ä¾èµ–é…ç½®**
```xml
<dependencies>
    <!-- æ ¸å¿ƒåº“ -->
    <dependency>
        <groupId>io.github.resilience4j</groupId>
        <artifactId>resilience4j-spring-boot2</artifactId>
        <version>1.7.1</version>
    </dependency>
    
    <!-- ç›‘æ§æ”¯æŒ -->
    <dependency>
        <groupId>io.github.resilience4j</groupId>
        <artifactId>resilience4j-micrometer</artifactId>
        <version>1.7.1</version>
    </dependency>
</dependencies>
```

**ğŸ”¸ YAMLé…ç½®æ–‡ä»¶**
```yaml
resilience4j:
  # ç†”æ–­å™¨é…ç½®
  circuitbreaker:
    instances:
      userService:  # å®ä¾‹åç§°
        failure-rate-threshold: 50        # å¤±è´¥ç‡é˜ˆå€¼50%
        minimum-number-of-calls: 10       # æœ€å°‘è°ƒç”¨æ¬¡æ•°
        sliding-window-size: 20           # æ»‘åŠ¨çª—å£å¤§å°
        wait-duration-in-open-state: 10s  # ç†”æ–­åç­‰å¾…æ—¶é—´
        
  # é™æµå™¨é…ç½®  
  ratelimiter:
    instances:
      userService:
        limit-for-period: 100    # æ—¶é—´çª—å£å†…å…è®¸çš„è¯·æ±‚æ•°
        limit-refresh-period: 1s # æ—¶é—´çª—å£å¤§å°
        timeout-duration: 3s     # ç­‰å¾…ä»¤ç‰Œçš„è¶…æ—¶æ—¶é—´
        
  # é‡è¯•é…ç½®
  retry:
    instances:
      userService:
        max-attempts: 3          # æœ€å¤§é‡è¯•æ¬¡æ•°
        wait-duration: 1s        # é‡è¯•é—´éš”
        retry-exceptions:        # éœ€è¦é‡è¯•çš„å¼‚å¸¸
          - java.net.ConnectException
          - java.net.SocketTimeoutException
```

**ğŸ”¸ ä»£ç å®ç°ç¤ºä¾‹**
```java
@Service
public class UserService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    // æ–¹å¼1ï¼šæ³¨è§£æ–¹å¼ï¼ˆæ¨èæ–°æ‰‹ä½¿ç”¨ï¼‰
    @CircuitBreaker(name = "userService", fallbackMethod = "getUserFallback")
    @RateLimiter(name = "userService")
    @Retry(name = "userService")
    public User getUserById(Long id) {
        String url = "http://user-service/users/" + id;
        return restTemplate.getForObject(url, User.class);
    }
    
    // é™çº§æ–¹æ³•
    public User getUserFallback(Long id, Exception ex) {
        log.warn("è°ƒç”¨ç”¨æˆ·æœåŠ¡å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆï¼ŒåŸå› ï¼š{}", ex.getMessage());
        
        User fallbackUser = new User();
        fallbackUser.setId(id);
        fallbackUser.setName("é»˜è®¤ç”¨æˆ·");
        fallbackUser.setEmail("default@example.com");
        return fallbackUser;
    }
    
    // æ–¹å¼2ï¼šç¼–ç¨‹å¼æ–¹å¼ï¼ˆæ›´çµæ´»ï¼‰
    public User getUserByIdProgrammatic(Long id) {
        CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults("userService");
        
        Supplier<User> decoratedSupplier = CircuitBreaker
            .decorateSupplier(circuitBreaker, () -> {
                String url = "http://user-service/users/" + id;
                return restTemplate.getForObject(url, User.class);
            });
            
        return Try.ofSupplier(decoratedSupplier)
            .recover(throwable -> {
                log.error("è°ƒç”¨ç”¨æˆ·æœåŠ¡å¤±è´¥ï¼š{}", throwable.getMessage());
                return createDefaultUser(id);
            })
            .get();
    }
}
```

### 3.3 ç»„åˆä½¿ç”¨å¤šç§ä¿æŠ¤æœºåˆ¶


```java
@Service
public class OrderService {
    
    // ç»„åˆä½¿ç”¨ï¼šç†”æ–­å™¨ + é™æµ + é‡è¯• + è¶…æ—¶
    @CircuitBreaker(name = "paymentService", fallbackMethod = "paymentFallback")
    @RateLimiter(name = "paymentService") 
    @Retry(name = "paymentService")
    @TimeLimiter(name = "paymentService")
    public CompletableFuture<PaymentResult> processPayment(PaymentRequest request) {
        return CompletableFuture.supplyAsync(() -> {
            // è°ƒç”¨æ”¯ä»˜æœåŠ¡
            return paymentClient.pay(request);
        });
    }
    
    // é™çº§æ–¹æ³•ï¼šæ”¯ä»˜æœåŠ¡ä¸å¯ç”¨æ—¶
    public CompletableFuture<PaymentResult> paymentFallback(PaymentRequest request, Exception ex) {
        log.error("æ”¯ä»˜æœåŠ¡è°ƒç”¨å¤±è´¥ï¼š{}", ex.getMessage());
        
        PaymentResult result = new PaymentResult();
        result.setStatus("PENDING");
        result.setMessage("æ”¯ä»˜è¯·æ±‚å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­...");
        
        // å¯ä»¥åœ¨è¿™é‡Œå®ç°è¡¥å¿é€»è¾‘ï¼Œæ¯”å¦‚ï¼š
        // 1. å°†æ”¯ä»˜è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ç­‰å¾…é‡è¯•
        // 2. å‘é€é€šçŸ¥ç»™è¿ç»´äººå‘˜
        // 3. è®°å½•å¼‚å¸¸æ—¥å¿—ä¾¿äºåç»­åˆ†æ
        
        return CompletableFuture.completedFuture(result);
    }
}
```

---

## 4. ğŸ¯ Sentinelé˜¿é‡Œå·´å·´æµæ§æ¡†æ¶


### 4.1 Sentinelæ¡†æ¶ä»‹ç»


**ç®€å•ç†è§£**ï¼šSentinelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„æµé‡æ§åˆ¶æ¡†æ¶ï¼Œä¸“é—¨å¤„ç†"åŒ11"è¿™æ ·çš„è¶…é«˜å¹¶å‘åœºæ™¯

```
Sentinelçš„è®¾è®¡ç†å¿µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æµé‡æ¼æ–—              â”‚
â”‚    å¤§é‡è¯·æ±‚ â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                 â”‚                â”‚
â”‚              â”Œâ”€â”€â–¼â”€â”€â”             â”‚
â”‚              â”‚     â”‚ é™æµè¿‡æ»¤    â”‚
â”‚              â”‚     â”‚             â”‚
â”‚              â””â”€â”€â”¬â”€â”€â”˜             â”‚
â”‚                 â”‚                â”‚
â”‚    åˆç†æµé‡ â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ¸å¿ƒåŠŸèƒ½ï¼š
â€¢ æµé‡æ§åˆ¶ï¼šé˜²æ­¢ç³»ç»Ÿè¢«å‹å®
â€¢ ç†”æ–­é™çº§ï¼šå¿«é€Ÿå¤±è´¥ä¿æŠ¤ç³»ç»Ÿ  
â€¢ ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ï¼šæ ¹æ®CPUã€å†…å­˜ç­‰æŒ‡æ ‡æ§åˆ¶æµé‡
â€¢ çƒ­ç‚¹å‚æ•°é™æµï¼šå¯¹ç‰¹å®šå‚æ•°å€¼é™æµ
```

### 4.2 Sentinelæ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ èµ„æºä¸è§„åˆ™**
```
èµ„æºï¼ˆResourceï¼‰ï¼šéœ€è¦ä¿æŠ¤çš„ä¸šåŠ¡é€»è¾‘
è§„åˆ™ï¼ˆRuleï¼‰ï¼šå¦‚ä½•ä¿æŠ¤è¿™äº›èµ„æº

ä¸¾ä¾‹è¯´æ˜ï¼š
èµ„æºï¼šç”¨æˆ·ç™»å½•æ¥å£ /api/login
è§„åˆ™ï¼šæ¯ç§’æœ€å¤šå¤„ç†100ä¸ªç™»å½•è¯·æ±‚

èµ„æºï¼šå•†å“è¯¦æƒ…æ¥å£ /api/products/{id}  
è§„åˆ™ï¼šçƒ­é—¨å•†å“(id=1001)æ¯ç§’é™åˆ¶1000æ¬¡è®¿é—®
```

**ğŸ”¸ æµæ§è§„åˆ™ç±»å‹**

| **æµæ§ç±»å‹** | **è¯´æ˜** | **é€‚ç”¨åœºæ™¯** | **ç”Ÿæ´»ä¾‹å­** |
|-------------|---------|-------------|-------------|
| **QPSé™æµ** | `é™åˆ¶æ¯ç§’è¯·æ±‚æ•°é‡` | `APIæ¥å£ä¿æŠ¤` | `é“¶è¡Œçª—å£é™åˆ¶æ¯å°æ—¶åŠç†ä¸šåŠ¡æ•°` |
| **çº¿ç¨‹æ•°é™æµ** | `é™åˆ¶å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°` | `èµ„æºæ± ä¿æŠ¤` | `é¤å…é™åˆ¶åŒæ—¶ç”¨é¤æ¡Œæ•°` |
| **å…³è”æµæ§** | `å…³è”èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶é™æµ` | `ä¿æŠ¤æ ¸å¿ƒä¸šåŠ¡` | `åœè½¦åœºVIPåŒºåŸŸä¼˜å…ˆä¿éšœ` |
| **é“¾è·¯æµæ§** | `é’ˆå¯¹ç‰¹å®šè°ƒç”¨é“¾è·¯é™æµ` | `ç²¾ç¡®æµæ§` | `é«˜é€Ÿè·¯ç‰¹å®šå…¥å£é™æµ` |

### 4.3 Sentinelå¿«é€Ÿé›†æˆ


**ğŸ”¸ åŸºç¡€ä¾èµ–é…ç½®**
```xml
<dependencies>
    <!-- Sentinelæ ¸å¿ƒ -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
    </dependency>
    
    <!-- Sentinelæ§åˆ¶å° -->
    <dependency>
        <groupId>com.alibaba.csp</groupId>
        <artifactId>sentinel-transport-simple-http</artifactId>
    </dependency>
</dependencies>
```

**ğŸ”¸ é…ç½®æ–‡ä»¶è®¾ç½®**
```yaml
spring:
  application:
    name: order-service
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080    # Sentinelæ§åˆ¶å°åœ°å€
        port: 8719                   # ä¸æ§åˆ¶å°é€šä¿¡ç«¯å£
      datasource:
        ds1:
          file:
            file: classpath:flowrule.json  # æµæ§è§„åˆ™æ–‡ä»¶
            data-type: json
            rule-type: flow
```

**ğŸ”¸ ä»£ç å®ç°ç¤ºä¾‹**
```java
@RestController
public class ProductController {
    
    // æ–¹å¼1ï¼šæ³¨è§£æ–¹å¼ä¿æŠ¤æ¥å£
    @GetMapping("/products/{id}")
    @SentinelResource(
        value = "getProduct",           // èµ„æºåç§°
        blockHandler = "productBlocked", // æµæ§é™çº§æ–¹æ³•
        fallback = "productFallback"     // å¼‚å¸¸é™çº§æ–¹æ³•
    )
    public ResponseEntity<Product> getProduct(@PathVariable Long id) {
        // æ¨¡æ‹Ÿå¯èƒ½å‡ºé”™çš„ä¸šåŠ¡é€»è¾‘
        if (id <= 0) {
            throw new IllegalArgumentException("å•†å“IDä¸èƒ½ä¸ºç©º");
        }
        
        Product product = productService.findById(id);
        return ResponseEntity.ok(product);
    }
    
    // æµæ§è§¦å‘æ—¶è°ƒç”¨ï¼ˆè¯·æ±‚è¢«é™åˆ¶ï¼‰
    public ResponseEntity<Product> productBlocked(Long id, BlockException ex) {
        log.warn("å•†å“æŸ¥è¯¢è¯·æ±‚è¢«é™æµï¼Œå•†å“IDï¼š{}", id);
        
        Product product = new Product();
        product.setId(id);
        product.setName("å•†å“ä¿¡æ¯è·å–ä¸­...");
        product.setStatus("LOADING");
        
        return ResponseEntity.status(429)  // 429 Too Many Requests
            .body(product);
    }
    
    // ä¸šåŠ¡å¼‚å¸¸æ—¶è°ƒç”¨
    public ResponseEntity<Product> productFallback(Long id, Throwable ex) {
        log.error("å•†å“æŸ¥è¯¢å‡ºç°å¼‚å¸¸ï¼Œå•†å“IDï¼š{}ï¼Œå¼‚å¸¸ï¼š{}", id, ex.getMessage());
        
        Product product = new Product();
        product.setId(id);
        product.setName("å•†å“æš‚æ—¶æ— æ³•è·å–");
        product.setStatus("ERROR");
        
        return ResponseEntity.status(500)
            .body(product);
    }
}

// æœåŠ¡å±‚çš„ä¿æŠ¤
@Service
public class ProductService {
    
    // æ–¹å¼2ï¼šç¼–ç¨‹å¼æµæ§
    public Product findById(Long id) {
        Entry entry = null;
        try {
            // å®šä¹‰èµ„æºå¹¶å°è¯•è·å–ä»¤ç‰Œ
            entry = SphU.entry("productQuery");
            
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            return doQueryProduct(id);
            
        } catch (BlockException e) {
            // è¢«æµæ§æ—¶çš„å¤„ç†
            log.warn("å•†å“æŸ¥è¯¢è¢«é™æµ");
            return createDefaultProduct(id);
            
        } finally {
            if (entry != null) {
                entry.exit();  // é‡Šæ”¾èµ„æº
            }
        }
    }
    
    private Product doQueryProduct(Long id) {
        // å®é™…çš„æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
        return productRepository.findById(id);
    }
}
```

### 4.4 Sentinelè§„åˆ™é…ç½®å®æˆ˜


**ğŸ”¸ æµæ§è§„åˆ™JSONé…ç½®**
```json
[
  {
    "resource": "getProduct",
    "grade": 1,
    "count": 100,
    "strategy": 0,
    "controlBehavior": 0
  },
  {
    "resource": "hotProduct",
    "grade": 1, 
    "count": 50,
    "strategy": 0,
    "controlBehavior": 2,
    "warmUpPeriodSec": 10
  }
]
```

**ğŸ”¸ çƒ­ç‚¹å‚æ•°é™æµ**
```java
@RestController
public class SearchController {
    
    // å¯¹çƒ­é—¨æœç´¢è¯è¿›è¡Œç‰¹æ®Šé™æµ
    @GetMapping("/search")
    @SentinelResource(
        value = "searchProducts",
        blockHandler = "searchBlocked"
    )
    public List<Product> searchProducts(@RequestParam String keyword,
                                      @RequestParam(defaultValue = "1") Integer page) {
        return productService.search(keyword, page);
    }
    
    public List<Product> searchBlocked(String keyword, Integer page, BlockException ex) {
        // çƒ­é—¨æœç´¢è¯è¢«é™æµæ—¶è¿”å›ç¼“å­˜ç»“æœ
        return productService.getCachedHotProducts();
    }
}

// çƒ­ç‚¹å‚æ•°è§„åˆ™ï¼ˆé€šè¿‡æ§åˆ¶å°æˆ–é…ç½®æ–‡ä»¶è®¾ç½®ï¼‰
// é’ˆå¯¹keywordå‚æ•°ï¼š
// - "iPhone" æ¯ç§’é™åˆ¶1000æ¬¡
// - "åä¸º" æ¯ç§’é™åˆ¶800æ¬¡  
// - å…¶ä»–å…³é”®è¯æ¯ç§’é™åˆ¶200æ¬¡
```

---

## 5. ğŸ¢ éš”ç¦»ç­–ç•¥è¯¦è§£


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦éš”ç¦»


**æ ¸å¿ƒé—®é¢˜**ï¼šå¾®æœåŠ¡ä¸­ä¸€ä¸ªæ…¢æ¥å£å¯èƒ½æ‹–å®æ•´ä¸ªåº”ç”¨

```
æ²¡æœ‰éš”ç¦»çš„å±é™©åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               WebæœåŠ¡å™¨                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ çº¿ç¨‹1   â”‚ â”‚ çº¿ç¨‹2   â”‚ â”‚ çº¿ç¨‹3   â”‚ ...   â”‚
â”‚  â”‚è°ƒç”¨AæœåŠ¡â”‚ â”‚è°ƒç”¨BæœåŠ¡â”‚ â”‚è°ƒç”¨CæœåŠ¡â”‚       â”‚
â”‚  â”‚(æ­£å¸¸)   â”‚ â”‚(æ…¢æŸ¥è¯¢) â”‚ â”‚(æ­£å¸¸)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“              â†“              â†“
   å¿«é€Ÿè¿”å›     å¡ä½5ç§’é’Ÿ     å¿«é€Ÿè¿”å›

é—®é¢˜ï¼šBæœåŠ¡æ…¢æŸ¥è¯¢å ç”¨çº¿ç¨‹æ± ï¼Œæœ€ç»ˆæ‰€æœ‰çº¿ç¨‹éƒ½è¢«BæœåŠ¡å ç”¨
ç»“æœï¼šAæœåŠ¡å’ŒCæœåŠ¡ä¹Ÿæ— æ³•å“åº”ç”¨æˆ·è¯·æ±‚
```

**éš”ç¦»è§£å†³æ–¹æ¡ˆ**ï¼šç»™ä¸åŒæœåŠ¡åˆ†é…ç‹¬ç«‹çš„èµ„æºæ± 

```
æœ‰éš”ç¦»çš„å®‰å…¨åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               WebæœåŠ¡å™¨                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚AæœåŠ¡ä¸“ç”¨â”‚ â”‚BæœåŠ¡ä¸“ç”¨â”‚ â”‚CæœåŠ¡ä¸“ç”¨â”‚        â”‚
â”‚ â”‚çº¿ç¨‹æ±    â”‚ â”‚çº¿ç¨‹æ±    â”‚ â”‚çº¿ç¨‹æ±    â”‚        â”‚
â”‚ â”‚ çº¿ç¨‹1-5 â”‚ â”‚ çº¿ç¨‹6-10â”‚ â”‚çº¿ç¨‹11-15â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“              â†“              â†“
   ç‹¬ç«‹è¿è¡Œ     åªå½±å“è‡ªå·±     ç‹¬ç«‹è¿è¡Œ

å¥½å¤„ï¼šBæœåŠ¡å†æ…¢ä¹Ÿä¸ä¼šå½±å“AæœåŠ¡å’ŒCæœåŠ¡
```

### 5.2 çº¿ç¨‹æ± éš”ç¦»


**ğŸ”¸ å®ç°åŸç†**
```
çº¿ç¨‹æ± éš”ç¦» = æ¯ä¸ªæœåŠ¡ä½¿ç”¨ç‹¬ç«‹çš„çº¿ç¨‹æ± 

ä¼˜ç‚¹ï¼š
âœ… å®Œå…¨éš”ç¦»ï¼šä¸€ä¸ªæœåŠ¡çš„é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡
âœ… èµ„æºæ§åˆ¶ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªæœåŠ¡çš„èµ„æºä½¿ç”¨
âœ… ç›‘æ§å‹å¥½ï¼šå®¹æ˜“ç›‘æ§æ¯ä¸ªæœåŠ¡çš„çº¿ç¨‹ä½¿ç”¨æƒ…å†µ

ç¼ºç‚¹ï¼š
âŒ èµ„æºå¼€é”€ï¼šéœ€è¦ç»´æŠ¤å¤šä¸ªçº¿ç¨‹æ± 
âŒ ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šçº¿ç¨‹åˆ‡æ¢æœ‰ä¸€å®šæ€§èƒ½å¼€é”€
```

**ğŸ”¸ Hystrixçº¿ç¨‹æ± éš”ç¦»é…ç½®**
```java
@Service
public class RemoteService {
    
    // ç”¨æˆ·æœåŠ¡çº¿ç¨‹æ± 
    @HystrixCommand(
        commandKey = "getUserInfo",
        threadPoolKey = "userServicePool",  // çº¿ç¨‹æ± åç§°
        threadPoolProperties = {
            @HystrixProperty(name = "coreSize", value = "10"),           // æ ¸å¿ƒçº¿ç¨‹æ•°
            @HystrixProperty(name = "maximumSize", value = "20"),        // æœ€å¤§çº¿ç¨‹æ•°
            @HystrixProperty(name = "maxQueueSize", value = "100"),      // é˜Ÿåˆ—å¤§å°
            @HystrixProperty(name = "queueSizeRejectionThreshold", value = "80")
        },
        fallbackMethod = "getUserInfoFallback"
    )
    public UserInfo getUserInfo(Long userId) {
        return userServiceClient.getUser(userId);
    }
    
    // è®¢å•æœåŠ¡çº¿ç¨‹æ± ï¼ˆç‹¬ç«‹é…ç½®ï¼‰
    @HystrixCommand(
        commandKey = "getOrderInfo", 
        threadPoolKey = "orderServicePool",  // ä¸åŒçš„çº¿ç¨‹æ± 
        threadPoolProperties = {
            @HystrixProperty(name = "coreSize", value = "5"),    // æ›´å°çš„çº¿ç¨‹æ± 
            @HystrixProperty(name = "maximumSize", value = "10"),
            @HystrixProperty(name = "maxQueueSize", value = "50")
        },
        fallbackMethod = "getOrderInfoFallback"
    )
    public OrderInfo getOrderInfo(Long orderId) {
        return orderServiceClient.getOrder(orderId);
    }
}
```

**ğŸ”¸ å®é™…åœºæ™¯çº¿ç¨‹æ± è§„åˆ’**
```yaml
# application.yml çº¿ç¨‹æ± é…ç½®ç¤ºä¾‹
hystrix:
  threadpool:
    # æ ¸å¿ƒç”¨æˆ·æœåŠ¡ï¼šé«˜ä¼˜å…ˆçº§ï¼Œå¤§çº¿ç¨‹æ± 
    userServicePool:
      coreSize: 20
      maximumSize: 40
      maxQueueSize: 200
      
    # æ¨èæœåŠ¡ï¼šéæ ¸å¿ƒï¼Œå°çº¿ç¨‹æ±   
    recommendServicePool:
      coreSize: 5
      maximumSize: 10
      maxQueueSize: 50
      
    # æ”¯ä»˜æœåŠ¡ï¼šé‡è¦ä½†è°ƒç”¨è¾ƒå°‘
    paymentServicePool:
      coreSize: 8
      maximumSize: 15
      maxQueueSize: 100

çº¿ç¨‹æ± è§„åˆ’åŸåˆ™ï¼š
ğŸ”¸ æ ¸å¿ƒæœåŠ¡ï¼šå¤§çº¿ç¨‹æ± ï¼Œä¿è¯å¯ç”¨æ€§
ğŸ”¸ éæ ¸å¿ƒæœåŠ¡ï¼šå°çº¿ç¨‹æ± ï¼Œé¿å…èµ„æºæµªè´¹
ğŸ”¸ é‡è¦æœåŠ¡ï¼šä¸­ç­‰çº¿ç¨‹æ± ï¼Œå¹³è¡¡æ€§èƒ½å’Œèµ„æº
```

### 5.3 ä¿¡å·é‡éš”ç¦»


**ğŸ”¸ å·¥ä½œåŸç†**
```
ä¿¡å·é‡éš”ç¦» = ç”¨è®¡æ•°å™¨æ§åˆ¶å¹¶å‘è®¿é—®æ•°é‡

åŸç†ç±»æ¯”ï¼š
åœè½¦åœº â†’ æœ‰100ä¸ªåœè½¦ä½ï¼ˆä¿¡å·é‡=100ï¼‰
æ¥è½¦   â†’ å¦‚æœæœ‰ç©ºä½å°±è¿›å…¥ï¼Œæ²¡æœ‰å°±ç­‰å¾…
ç¦»å¼€   â†’ é‡Šæ”¾åœè½¦ä½ï¼Œå…¶ä»–è½¦å¯ä»¥è¿›å…¥

ä»£ç å±‚é¢ï¼š
acquire() â†’ è·å–è®¸å¯è¯ï¼ˆåœè½¦ä½ï¼‰
release() â†’ é‡Šæ”¾è®¸å¯è¯
```

**ä¼˜ç¼ºç‚¹å¯¹æ¯”**ï¼š
```
ä¿¡å·é‡éš”ç¦» vs çº¿ç¨‹æ± éš”ç¦»

               ä¿¡å·é‡éš”ç¦»                çº¿ç¨‹æ± éš”ç¦»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èµ„æºå¼€é”€  â”‚        å¾ˆå°         â”‚        è¾ƒå¤§         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  éš”ç¦»ç¨‹åº¦  â”‚      è¯·æ±‚çº§åˆ«       â”‚      çº¿ç¨‹çº§åˆ«       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¶…æ—¶æ”¯æŒ  â”‚       ä¸æ”¯æŒ        â”‚       æ”¯æŒ          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‚ç”¨åœºæ™¯  â”‚   é«˜å¹¶å‘ã€è½»é‡æ“ä½œ   â”‚   é‡è¦æœåŠ¡ã€é•¿æ“ä½œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ ä¿¡å·é‡éš”ç¦»ä»£ç ç¤ºä¾‹**
```java
@Service
public class CacheService {
    
    // ç¼“å­˜æŸ¥è¯¢ç”¨ä¿¡å·é‡éš”ç¦»ï¼ˆè½»é‡æ“ä½œï¼‰
    @HystrixCommand(
        commandProperties = {
            // ä½¿ç”¨ä¿¡å·é‡éš”ç¦»ç­–ç•¥
            @HystrixProperty(name = "execution.isolation.strategy", value = "SEMAPHORE"),
            // å…è®¸åŒæ—¶20ä¸ªè¯·æ±‚è®¿é—®
            @HystrixProperty(name = "execution.isolation.semaphore.maxConcurrentRequests", value = "20")
        },
        fallbackMethod = "getCacheDataFallback"
    )
    public String getCacheData(String key) {
        // è½»é‡çº§çš„ç¼“å­˜æŸ¥è¯¢æ“ä½œ
        return redisTemplate.opsForValue().get(key);
    }
    
    public String getCacheDataFallback(String key) {
        return "ç¼“å­˜æš‚æ—¶ä¸å¯ç”¨";
    }
}

// Resilience4jçš„ä¿¡å·é‡å®ç°
@Service 
public class SearchService {
    
    private final Semaphore searchSemaphore = Semaphore.of(50); // æœ€å¤š50ä¸ªå¹¶å‘æœç´¢
    
    public List<Product> searchProducts(String keyword) {
        return searchSemaphore.executeSupplier(() -> {
            // æ‰§è¡Œæœç´¢é€»è¾‘
            return elasticsearchService.search(keyword);
        });
    }
}
```

### 5.4 èˆ±å£éš”ç¦»æ¨¡å¼


**ğŸ”¸ èˆ±å£æ¨¡å¼è§£é‡Š**
```
èˆ±å£æ¨¡å¼æ¥æºäºèˆ¹èˆ¶è®¾è®¡ï¼š

æ™®é€šèˆ¹èˆ±ï¼š                    èˆ±å£åˆ†éš”èˆ¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚                 â”‚           â”‚ A â”‚ B â”‚ C â”‚ D â”‚
â”‚   ä¸€ä¸ªå¤§èˆ±å®¤     â”‚           â”‚   â”‚   â”‚   â”‚   â”‚
â”‚                 â”‚           â”‚   â”‚   â”‚   â”‚   â”‚
â”‚  è¿›æ°´å°±æ²‰èˆ¹     â”‚           â”‚   â”‚   â”‚   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
                               Aèˆ±è¿›æ°´ï¼ŒBCDèˆ±å®‰å…¨

å¾®æœåŠ¡åº”ç”¨èˆ±å£æ¨¡å¼ï¼š
æŠŠç³»ç»Ÿèµ„æºæŒ‰åŠŸèƒ½åˆ†å‰²ï¼Œé¿å…ä¸€ä¸ªåŠŸèƒ½æ•…éšœå½±å“å…¨å±€
```

**ğŸ”¸ Resilience4jèˆ±å£å®ç°**
```java
@Configuration
public class BulkheadConfig {
    
    @Bean
    public Bulkhead userServiceBulkhead() {
        return Bulkhead.custom()
            .maxConcurrentCalls(25)    // æœ€å¤§å¹¶å‘è°ƒç”¨
            .maxWaitDuration(Duration.ofMillis(500))  // æœ€å¤§ç­‰å¾…æ—¶é—´
            .build();
    }
    
    @Bean
    public Bulkhead orderServiceBulkhead() {
        return Bulkhead.custom()
            .maxConcurrentCalls(15)    // æ›´å°çš„å¹¶å‘æ•°
            .maxWaitDuration(Duration.ofMillis(300))
            .build();
    }
}

@Service
public class CompositeService {
    
    @Autowired
    private Bulkhead userServiceBulkhead;
    
    @Autowired  
    private Bulkhead orderServiceBulkhead;
    
    // ç”¨æˆ·æœåŠ¡è°ƒç”¨å—èˆ±å£ä¿æŠ¤
    public UserInfo getUserInfo(Long userId) {
        Supplier<UserInfo> decoratedSupplier = Bulkhead
            .decorateSupplier(userServiceBulkhead, () -> {
                return userServiceClient.getUser(userId);
            });
            
        return Try.ofSupplier(decoratedSupplier)
            .recover(throwable -> createDefaultUser(userId))
            .get();
    }
    
    // è®¢å•æœåŠ¡è°ƒç”¨å—ç‹¬ç«‹èˆ±å£ä¿æŠ¤
    public OrderInfo getOrderInfo(Long orderId) {
        Supplier<OrderInfo> decoratedSupplier = Bulkhead
            .decorateSupplier(orderServiceBulkhead, () -> {
                return orderServiceClient.getOrder(orderId);
            });
            
        return Try.ofSupplier(decoratedSupplier)
            .recover(throwable -> createDefaultOrder(orderId))
            .get();
    }
}
```

---

## 6. ğŸš€ ç¼“å­˜ä¸åˆå¹¶ä¼˜åŒ–


### 6.1 è¯·æ±‚ç¼“å­˜æœºåˆ¶


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦è¯·æ±‚ç¼“å­˜**
```
é—®é¢˜åœºæ™¯ï¼šä¸€ä¸ªç”¨æˆ·è¯·æ±‚å¯èƒ½è§¦å‘å¯¹åŒä¸€æœåŠ¡çš„å¤šæ¬¡è°ƒç”¨

ç”¨æˆ·æŸ¥çœ‹è®¢å•è¯¦æƒ…ï¼š
1. è·å–è®¢å•åŸºæœ¬ä¿¡æ¯     â†’ è°ƒç”¨è®¢å•æœåŠ¡
2. è·å–å•†å“ä¿¡æ¯         â†’ è°ƒç”¨å•†å“æœåŠ¡  
3. è·å–ç”¨æˆ·é…é€åœ°å€     â†’ è°ƒç”¨ç”¨æˆ·æœåŠ¡
4. è·å–ç”¨æˆ·ç­‰çº§æŠ˜æ‰£     â†’ å†æ¬¡è°ƒç”¨ç”¨æˆ·æœåŠ¡ âŒ é‡å¤è°ƒç”¨

ä¼˜åŒ–åï¼š
4. è·å–ç”¨æˆ·ç­‰çº§æŠ˜æ‰£     â†’ ä»ç¼“å­˜è·å– âœ… é¿å…é‡å¤
```

**ğŸ”¸ Hystrixè¯·æ±‚ç¼“å­˜å®ç°**
```java
@Service
public class UserService {
    
    // å¯ç”¨è¯·æ±‚ç¼“å­˜
    @HystrixCommand(
        commandKey = "getUserById",
        fallbackMethod = "getUserFallback"
    )
    @HystrixCacheResult  // å¼€å¯ç¼“å­˜
    public User getUserById(@HystrixCacheKey Long userId) {  // ç¼“å­˜key
        log.info("å®é™…è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ï¼š{}", userId);
        return userServiceClient.getUser(userId);
    }
    
    // ç¼“å­˜å¤±æ•ˆ
    @HystrixCommand
    @HystrixCacheRemove(commandKey = "getUserById")  // ç§»é™¤ç¼“å­˜
    public void updateUser(@HystrixCacheKey Long userId, User user) {
        userServiceClient.updateUser(userId, user);
        log.info("ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°ï¼Œæ¸…é™¤ç¼“å­˜ï¼š{}", userId);
    }
    
    public User getUserFallback(Long userId) {
        return createDefaultUser(userId);
    }
}

// è¯·æ±‚ä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼ˆé‡è¦ï¼ï¼‰
@Component
public class HystrixRequestContextFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HystrixRequestContext context = HystrixRequestContext.initializeContext();
        try {
            chain.doFilter(request, response);
        } finally {
            context.close();  // è¯·æ±‚ç»“æŸæ—¶æ¸…ç†ä¸Šä¸‹æ–‡
        }
    }
}
```

**ğŸ”¸ å®é™…ä¸šåŠ¡åœºæ™¯åº”ç”¨**
```java
@RestController
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    @GetMapping("/orders/{id}/details")
    public OrderDetailVO getOrderDetails(@PathVariable Long id) {
        return orderService.getOrderDetails(id);
    }
}

@Service
public class OrderService {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private ProductService productService;
    
    public OrderDetailVO getOrderDetails(Long orderId) {
        // 1. è·å–è®¢å•ä¿¡æ¯
        Order order = orderRepository.findById(orderId);
        
        // 2. è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ï¼‰
        User user = userService.getUserById(order.getUserId());
        
        // 3. è·å–å•†å“ä¿¡æ¯
        Product product = productService.getProductById(order.getProductId());
        
        // 4. è·å–ç”¨æˆ·ç­‰çº§ä¿¡æ¯ï¼ˆåŒä¸€ä¸ªç”¨æˆ·IDï¼Œå‘½ä¸­ç¼“å­˜ï¼ï¼‰
        User userForLevel = userService.getUserById(order.getUserId());
        
        // 5. è®¡ç®—æŠ˜æ‰£
        BigDecimal discount = calculateDiscount(userForLevel.getLevel(), product.getPrice());
        
        return OrderDetailVO.builder()
            .orderId(order.getId())
            .userName(user.getName())
            .productName(product.getName())
            .originalPrice(product.getPrice())
            .discount(discount)
            .finalPrice(product.getPrice().subtract(discount))
            .build();
    }
}
```

### 6.2 è¯·æ±‚åˆå¹¶æœºåˆ¶


**ğŸ”¸ è¯·æ±‚åˆå¹¶çš„ä»·å€¼**
```
é—®é¢˜ï¼šN+1æŸ¥è¯¢é—®é¢˜

åœºæ™¯ï¼šç”¨æˆ·æŸ¥çœ‹è´­ç‰©è½¦(10ä¸ªå•†å“)
ä¼ ç»Ÿæ–¹å¼ï¼š
1. æŸ¥è¯¢è´­ç‰©è½¦åˆ—è¡¨               â†’ 1æ¬¡æ•°æ®åº“æŸ¥è¯¢
2. é€ä¸ªæŸ¥è¯¢å•†å“è¯¦æƒ…             â†’ 10æ¬¡å•†å“æœåŠ¡è°ƒç”¨
æ€»è®¡ï¼š11æ¬¡è¿œç¨‹è°ƒç”¨

è¯·æ±‚åˆå¹¶æ–¹å¼ï¼š
1. æŸ¥è¯¢è´­ç‰©è½¦åˆ—è¡¨               â†’ 1æ¬¡æ•°æ®åº“æŸ¥è¯¢  
2. æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰å•†å“è¯¦æƒ…          â†’ 1æ¬¡å•†å“æœåŠ¡è°ƒç”¨
æ€»è®¡ï¼š2æ¬¡è¿œç¨‹è°ƒç”¨

æ€§èƒ½æå‡ï¼šç½‘ç»œè¯·æ±‚ä»11æ¬¡å‡å°‘åˆ°2æ¬¡ï¼
```

**ğŸ”¸ Hystrixè¯·æ±‚åˆå¹¶å®ç°**
```java
// å•ä¸ªå•†å“æŸ¥è¯¢å‘½ä»¤
public class GetProductCommand extends HystrixCommand<Product> {
    
    private final Long productId;
    private final ProductService productService;
    
    public GetProductCommand(Long productId, ProductService productService) {
        super(HystrixCommandGroupKey.Factory.asKey("ProductService"));
        this.productId = productId;
        this.productService = productService;
    }
    
    @Override
    protected Product run() throws Exception {
        return productService.getProduct(productId);
    }
    
    @Override
    protected Product getFallback() {
        return createDefaultProduct(productId);
    }
}

// æ‰¹é‡å•†å“æŸ¥è¯¢åˆå¹¶å™¨
public class GetProductBatchCommand extends HystrixCollapser<List<Product>, Product, Long> {
    
    private final Long productId;
    private final ProductService productService;
    
    public GetProductBatchCommand(Long productId, ProductService productService) {
        super(HystrixCollapserKey.Factory.asKey("ProductBatch"),
              HystrixCollapserProperties.Setter()
                  .withTimerDelayInMilliseconds(10)    // 10mså†…çš„è¯·æ±‚åˆå¹¶
                  .withMaxRequestsInBatch(100));       // æœ€å¤šåˆå¹¶100ä¸ªè¯·æ±‚
        this.productId = productId;
        this.productService = productService;
    }
    
    @Override
    public Long getRequestArgument() {
        return productId;
    }
    
    @Override
    protected HystrixCommand<List<Product>> createCommand(
            Collection<CollapsedRequest<Product, Long>> requests) {
        
        // æå–æ‰€æœ‰å•†å“ID
        List<Long> productIds = requests.stream()
            .map(CollapsedRequest::getArgument)
            .collect(Collectors.toList());
            
        // åˆ›å»ºæ‰¹é‡æŸ¥è¯¢å‘½ä»¤
        return new HystrixCommand<List<Product>>(
                HystrixCommandGroupKey.Factory.asKey("ProductBatch")) {
            @Override
            protected List<Product> run() throws Exception {
                // æ‰¹é‡æŸ¥è¯¢å•†å“
                return productService.getProductsBatch(productIds);
            }
        };
    }
    
    @Override
    protected void mapResponseToRequests(List<Product> batchResponse,
            Collection<CollapsedRequest<Product, Long>> requests) {
        
        // å°†æ‰¹é‡ç»“æœåˆ†å‘ç»™å„ä¸ªè¯·æ±‚
        Map<Long, Product> productMap = batchResponse.stream()
            .collect(Collectors.toMap(Product::getId, Function.identity()));
            
        for (CollapsedRequest<Product, Long> request : requests) {
            Long productId = request.getArgument();
            Product product = productMap.get(productId);
            
            if (product != null) {
                request.setResponse(product);
            } else {
                request.setException(new ProductNotFoundException(productId));
            }
        }
    }
}
```

**ğŸ”¸ ç®€åŒ–çš„è¯·æ±‚åˆå¹¶åº”ç”¨**
```java
@Service
public class ShoppingCartService {
    
    @Autowired
    private ProductService productService;
    
    // ä½¿ç”¨æ³¨è§£æ–¹å¼å®ç°è¯·æ±‚åˆå¹¶
    @HystrixCollapser(
        batchMethod = "getProductsBatch",           // æ‰¹é‡æŸ¥è¯¢æ–¹æ³•
        collapserProperties = {
            @HystrixProperty(name = "timerDelayInMilliseconds", value = "20"),
            @HystrixProperty(name = "maxRequestsInBatch", value = "50")
        }
    )
    public Future<Product> getProductAsync(Long productId) {
        // è¿™ä¸ªæ–¹æ³•å®é™…ä¸ä¼šæ‰§è¡Œï¼Œè¯·æ±‚ä¼šè¢«åˆå¹¶åˆ°æ‰¹é‡æ–¹æ³•
        throw new RuntimeException("This method should not be executed");
    }
    
    // æ‰¹é‡æŸ¥è¯¢æ–¹æ³•
    @HystrixCommand
    public List<Product> getProductsBatch(List<Long> productIds) {
        log.info("æ‰¹é‡æŸ¥è¯¢å•†å“ï¼ŒIDåˆ—è¡¨ï¼š{}", productIds);
        return productService.getProductsByIds(productIds);
    }
    
    // è´­ç‰©è½¦è¯¦æƒ…è·å–
    public ShoppingCartVO getCartDetails(Long userId) {
        // 1. è·å–è´­ç‰©è½¦å•†å“åˆ—è¡¨
        List<CartItem> cartItems = cartRepository.findByUserId(userId);
        
        // 2. å¼‚æ­¥è·å–å•†å“è¯¦æƒ…ï¼ˆä¼šè¢«è‡ªåŠ¨åˆå¹¶ï¼‰
        List<Future<Product>> productFutures = cartItems.stream()
            .map(item -> getProductAsync(item.getProductId()))
            .collect(Collectors.toList());
        
        // 3. ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ç»“æœ
        List<CartItemVO> cartItemVOs = new ArrayList<>();
        for (int i = 0; i < cartItems.size(); i++) {
            try {
                CartItem item = cartItems.get(i);
                Product product = productFutures.get(i).get(1000, TimeUnit.MILLISECONDS);
                
                CartItemVO itemVO = CartItemVO.builder()
                    .productId(product.getId())
                    .productName(product.getName())
                    .price(product.getPrice())
                    .quantity(item.getQuantity())
                    .subtotal(product.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))
                    .build();
                    
                cartItemVOs.add(itemVO);
                
            } catch (Exception e) {
                log.error("è·å–å•†å“è¯¦æƒ…å¤±è´¥ï¼š{}", e.getMessage());
                // æ·»åŠ é»˜è®¤å•†å“ä¿¡æ¯
            }
        }
        
        return ShoppingCartVO.builder()
            .userId(userId)
            .items(cartItemVOs)
            .totalAmount(calculateTotal(cartItemVOs))
            .build();
    }
}
```

---

## 7. ğŸ“Š ç›‘æ§é¢æ¿ä¸è¿ç»´


### 7.1 Hystrix Dashboardç›‘æ§é¢æ¿


**ğŸ”¸ ç›‘æ§é¢æ¿çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§é¢æ¿ï¼Ÿ

é—®é¢˜åœºæ™¯ï¼š
ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œè¿ç»´äººå‘˜éœ€è¦å¿«é€Ÿå®šä½ï¼š
â“ å“ªä¸ªæœåŠ¡å‡ºç°äº†æ•…éšœï¼Ÿ
â“ ç†”æ–­å™¨çŠ¶æ€å¦‚ä½•ï¼Ÿ
â“ è¯·æ±‚æˆåŠŸç‡æ˜¯å¤šå°‘ï¼Ÿ
â“ å“åº”æ—¶é—´æœ‰å¤šé•¿ï¼Ÿ

Hystrix Dashboardæä¾›ï¼š
âœ… å®æ—¶æ•°æ®å¯è§†åŒ–
âœ… ç†”æ–­å™¨çŠ¶æ€ç›‘æ§
âœ… è¯·æ±‚é‡å’Œé”™è¯¯ç‡ç»Ÿè®¡
âœ… å“åº”æ—¶é—´åˆ†å¸ƒ
```

**ğŸ”¸ Dashboardé›†æˆé…ç½®**
```xml
<!-- ç›‘æ§é¢æ¿ä¾èµ– -->
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>
    </dependency>
    
    <!-- æ•°æ®æµæ”¯æŒ -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-turbine</artifactId>
    </dependency>
</dependencies>
```

```java
// ç›‘æ§é¢æ¿å¯åŠ¨ç±»
@SpringBootApplication
@EnableHystrixDashboard    // å¯ç”¨Hystrixç›‘æ§é¢æ¿
@EnableTurbine            // å¯ç”¨Turbineèšåˆç›‘æ§
public class MonitorApplication {
    public static void main(String[] args) {
        SpringApplication.run(MonitorApplication.class, args);
    }
}

// è¢«ç›‘æ§æœåŠ¡çš„é…ç½®
@SpringBootApplication
@EnableHystrix
public class OrderServiceApplication {
    
    // æš´éœ²ç›‘æ§ç«¯ç‚¹
    @Bean
    public ServletRegistrationBean hystrixMetricsStreamServlet() {
        ServletRegistrationBean registration = new ServletRegistrationBean(
            new HystrixMetricsStreamServlet());
        registration.addUrlMappings("/hystrix.stream");
        return registration;
    }
}
```

**ğŸ”¸ ç›‘æ§é¢æ¿ä½¿ç”¨**
```yaml
# ç›‘æ§é…ç½®
turbine:
  app-config: order-service,user-service,product-service  # è¢«ç›‘æ§çš„æœåŠ¡
  cluster-name-expression: new String("default")
  combine-host-port: true

# è®¿é—®åœ°å€ï¼š
# å•æœåŠ¡ç›‘æ§ï¼šhttp://localhost:8080/hystrix
# è¾“å…¥æµåœ°å€ï¼šhttp://order-service:port/hystrix.stream
# 
# èšåˆç›‘æ§ï¼šhttp://localhost:8080/hystrix
# è¾“å…¥æµåœ°å€ï¼šhttp://turbine-server:port/turbine.stream
```

### 7.2 Sentinelæ§åˆ¶å°


**ğŸ”¸ Sentinelæ§åˆ¶å°åŠŸèƒ½ç‰¹ç‚¹**
```
Sentinelæ§åˆ¶å° vs Hystrix Dashboard

åŠŸèƒ½å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åŠŸèƒ½       â”‚   Hystrix       â”‚    Sentinel     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å®æ—¶ç›‘æ§      â”‚       âœ…        â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è§„åˆ™é…ç½®      â”‚     é™æ€é…ç½®     â”‚    åŠ¨æ€é…ç½®     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æµæ§è°ƒæ•´      â”‚       âŒ        â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   çƒ­ç‚¹åˆ†æ      â”‚       âŒ        â”‚       âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æœºå™¨å‘ç°      â”‚     æ‰‹åŠ¨é…ç½®     â”‚    è‡ªåŠ¨å‘ç°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ Sentinelæ§åˆ¶å°éƒ¨ç½²**
```bash
# 1. ä¸‹è½½Sentinelæ§åˆ¶å°jaråŒ…
wget https://github.com/alibaba/Sentinel/releases/download/1.8.0/sentinel-dashboard-1.8.0.jar

# 2. å¯åŠ¨æ§åˆ¶å°
java -Dserver.port=8080 \
     -Dcsp.sentinel.dashboard.server=localhost:8080 \
     -Dproject.name=sentinel-dashboard \
     -jar sentinel-dashboard-1.8.0.jar

# 3. è®¿é—®æ§åˆ¶å°
# URL: http://localhost:8080
# é»˜è®¤ç”¨æˆ·åå¯†ç ï¼šsentinel/sentinel
```

**ğŸ”¸ æ§åˆ¶å°åŠŸèƒ½ä½¿ç”¨**
```java
// åº”ç”¨æ¥å…¥æ§åˆ¶å°
@RestController
public class TestController {
    
    // æ¥å£ä¼šè‡ªåŠ¨å‡ºç°åœ¨æ§åˆ¶å°ä¸­
    @GetMapping("/test")
    @SentinelResource("testResource")
    public String test() {
        return "Hello Sentinel";
    }
}
```

```yaml
# åº”ç”¨é…ç½®
spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080  # æ§åˆ¶å°åœ°å€
        port: 8719                 # å®¢æˆ·ç«¯ç«¯å£
      web-context-unify: false     # å…³é—­URLè·¯å¾„èšåˆ
```

### 7.3 ç›‘æ§æŒ‡æ ‡ä¸å‘Šè­¦


**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**
```
æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼š

å¯ç”¨æ€§æŒ‡æ ‡ï¼š
â€¢ æˆåŠŸç‡ï¼ˆSuccess Rateï¼‰ï¼šæ­£å¸¸å¤„ç†çš„è¯·æ±‚æ¯”ä¾‹
â€¢ é”™è¯¯ç‡ï¼ˆError Rateï¼‰ï¼šå‡ºé”™è¯·æ±‚çš„æ¯”ä¾‹  
â€¢ ç†”æ–­å™¨çŠ¶æ€ï¼šOPEN/CLOSED/HALF_OPEN

æ€§èƒ½æŒ‡æ ‡ï¼š
â€¢ å¹³å‡å“åº”æ—¶é—´ï¼ˆMean Response Timeï¼‰
â€¢ 99åˆ†ä½å“åº”æ—¶é—´ï¼ˆ99th Percentileï¼‰
â€¢ QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
â€¢ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰

èµ„æºæŒ‡æ ‡ï¼š
â€¢ çº¿ç¨‹æ± ä½¿ç”¨ç‡
â€¢ ä¿¡å·é‡ä½¿ç”¨ç‡
â€¢ é˜Ÿåˆ—é•¿åº¦
â€¢ å†…å­˜ä½¿ç”¨æƒ…å†µ
```

**ğŸ”¸ å‘Šè­¦é…ç½®ç¤ºä¾‹**
```yaml
# Prometheus + Grafana + AlertManageré…ç½®
# prometheus.yml
scrape_configs:
  - job_name: 'hystrix-metrics'
    static_configs:
      - targets: ['order-service:8080', 'user-service:8080']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 15s

# alerting rules
groups:
  - name: hystrix-alerts
    rules:
      - alert: HighErrorRate
        expr: hystrix_command_error_percentage > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "æœåŠ¡ {{ $labels.command_group }} é”™è¯¯ç‡è¿‡é«˜"
          description: "é”™è¯¯ç‡: {{ $value }}%"
          
      - alert: CircuitBreakerOpen
        expr: hystrix_circuit_breaker_open == 1
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ç†”æ–­å™¨æ‰“å¼€ï¼š{{ $labels.command_key }}"
          description: "æœåŠ¡ç†”æ–­ï¼Œéœ€è¦ç«‹å³æ£€æŸ¥"
```

**ğŸ”¸ è¿ç»´å®è·µå»ºè®®**
```java
// è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
@Component
public class ServiceHealthIndicator implements HealthIndicator {
    
    @Autowired
    private HystrixCircuitBreakerMonitor monitor;
    
    @Override
    public Health health() {
        // æ£€æŸ¥å…³é”®æœåŠ¡ç†”æ–­å™¨çŠ¶æ€
        boolean userServiceHealthy = !monitor.isCircuitBreakerOpen("userService");
        boolean paymentServiceHealthy = !monitor.isCircuitBreakerOpen("paymentService");
        
        if (userServiceHealthy && paymentServiceHealthy) {
            return Health.up()
                .withDetail("userService", "æ­£å¸¸")
                .withDetail("paymentService", "æ­£å¸¸")
                .build();
        } else {
            return Health.down()
                .withDetail("userService", userServiceHealthy ? "æ­£å¸¸" : "ç†”æ–­")
                .withDetail("paymentService", paymentServiceHealthy ? "æ­£å¸¸" : "ç†”æ–­")
                .build();
        }
    }
}

// è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬
@Component
@Slf4j
public class AutoRecoveryService {
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void checkAndRecover() {
        // 1. æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€
        Map<String, Boolean> circuitStatus = hystrixMonitor.getCircuitBreakerStatus();
        
        // 2. å¯¹äºé•¿æ—¶é—´ç†”æ–­çš„æœåŠ¡ï¼Œå°è¯•é™çº§å¤„ç†
        circuitStatus.entrySet().stream()
            .filter(entry -> entry.getValue()) // ç†”æ–­çŠ¶æ€
            .forEach(entry -> {
                String serviceName = entry.getKey();
                log.warn("æœåŠ¡ {} å¤„äºç†”æ–­çŠ¶æ€ï¼Œå¯åŠ¨è‡ªåŠ¨æ¢å¤ç¨‹åº", serviceName);
                
                // 3. è‡ªåŠ¨æ¢å¤æªæ–½
                handleServiceRecovery(serviceName);
            });
    }
    
    private void handleServiceRecovery(String serviceName) {
        // å¯èƒ½çš„æ¢å¤æªæ–½ï¼š
        // 1. é‡å¯æœåŠ¡å®ä¾‹
        // 2. åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡
        // 3. é€šçŸ¥è¿ç»´äººå‘˜
        // 4. è°ƒæ•´æµæ§è§„åˆ™
        
        if ("userService".equals(serviceName)) {
            // ç”¨æˆ·æœåŠ¡ç†”æ–­ï¼šå¯ç”¨ç¼“å­˜æ¨¡å¼
            enableCacheMode(serviceName);
        } else if ("paymentService".equals(serviceName)) {
            // æ”¯ä»˜æœåŠ¡ç†”æ–­ï¼šåˆ‡æ¢åˆ°å¤‡ç”¨æ”¯ä»˜é€šé“
            switchToBackupPayment();
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¹é”™æœ¬è´¨ï¼šå°±åƒç»™å¾®æœåŠ¡ç³»ç»Ÿå®‰è£…"å®‰å…¨æ°”å›Š"å’Œ"ä¿é™©ä¸"
ğŸ”¸ æ ¸å¿ƒæ€æƒ³ï¼šæ•…éšœéš”ç¦»ã€å¿«é€Ÿå¤±è´¥ã€ä¼˜é›…é™çº§
ğŸ”¸ ä¸‰å¤§æ¡†æ¶ï¼šHystrix(åœæ›´)ã€Resilience4j(æ¨è)ã€Sentinel(é˜¿é‡Œç³»)
ğŸ”¸ éš”ç¦»ç­–ç•¥ï¼šçº¿ç¨‹æ± éš”ç¦»(èµ„æºéš”ç¦»)ã€ä¿¡å·é‡éš”ç¦»(è½»é‡çº§)
ğŸ”¸ ä¼˜åŒ–æ‰‹æ®µï¼šè¯·æ±‚ç¼“å­˜(é¿å…é‡å¤è°ƒç”¨)ã€è¯·æ±‚åˆå¹¶(è§£å†³N+1é—®é¢˜)
ğŸ”¸ è¿ç»´ç›‘æ§ï¼šå®æ—¶é¢æ¿ã€å…³é”®æŒ‡æ ‡ã€è‡ªåŠ¨å‘Šè­¦
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦å®¹é”™æ¡†æ¶**
```
å¾®æœåŠ¡ç—›ç‚¹ï¼š
â€¢ æœåŠ¡é—´è°ƒç”¨å¤æ‚ï¼šä¸€ä¸ªè¯·æ±‚å¯èƒ½è°ƒç”¨å¤šä¸ªæœåŠ¡
â€¢ æ•…éšœä¼ æ’­é£é™©ï¼šä¸€ä¸ªæœåŠ¡æ•…éšœå¯èƒ½å¯¼è‡´æ•´ä½“ç³»ç»Ÿå´©æºƒ
â€¢ é›ªå´©æ•ˆåº”ï¼šæµé‡æ´ªå³°æ—¶æœåŠ¡ç›¸äº’å½±å“

å®¹é”™è§£å†³æ–¹æ¡ˆï¼š
â€¢ ç†”æ–­å™¨ï¼šè‡ªåŠ¨åˆ‡æ–­æ•…éšœæœåŠ¡ï¼Œé˜²æ­¢æ•…éšœä¼ æ’­
â€¢ é™æµï¼šæ§åˆ¶æµé‡ï¼Œé˜²æ­¢æœåŠ¡è¿‡è½½
â€¢ é™çº§ï¼šæä¾›å¤‡ç”¨æ–¹æ¡ˆï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨
â€¢ éš”ç¦»ï¼šèµ„æºéš”ç¦»ï¼Œé¿å…ç›¸äº’å½±å“
```

**ğŸ”¹ æ¡†æ¶é€‰æ‹©å»ºè®®**
```
Hystrixï¼š
âœ… æˆç†Ÿç¨³å®šï¼Œæ–‡æ¡£ä¸°å¯Œ
âœ… ç¤¾åŒºèµ„æºå¤šï¼Œé—®é¢˜å®¹æ˜“è§£å†³
âŒ å·²åœæ­¢æ›´æ–°ï¼Œä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨

Resilience4jï¼š
âœ… ç°ä»£åŒ–è®¾è®¡ï¼Œæ€§èƒ½æ›´å¥½
âœ… å‡½æ•°å¼ç¼–ç¨‹é£æ ¼ï¼Œä½¿ç”¨çµæ´»
âœ… Springå®˜æ–¹æ¨è
âŒ å­¦ä¹ æˆæœ¬ç¨é«˜

Sentinelï¼š
âœ… é˜¿é‡Œç”Ÿäº§ç¯å¢ƒéªŒè¯
âœ… æ§åˆ¶å°åŠŸèƒ½å¼ºå¤§
âœ… é€‚åˆå›½å†…å›¢é˜Ÿ
âŒ ç”Ÿæ€ç›¸å¯¹è¾ƒå°

é€‰æ‹©å»ºè®®ï¼š
â€¢ æ–°é¡¹ç›®é¦–é€‰Resilience4j
â€¢ å·²æœ‰Hystrixé¡¹ç›®å¯ç»§ç»­ä½¿ç”¨
â€¢ é˜¿é‡Œäº‘ç¯å¢ƒæ¨èSentinel
```

**ğŸ”¹ éš”ç¦»ç­–ç•¥å¯¹æ¯”**
```
çº¿ç¨‹æ± éš”ç¦»ï¼š
é€‚ç”¨åœºæ™¯ï¼šé‡è¦æœåŠ¡ã€é•¿æ—¶é—´æ“ä½œã€éœ€è¦å®Œå…¨éš”ç¦»
ä¼˜ç‚¹ï¼šéš”ç¦»å½»åº•ã€æ”¯æŒè¶…æ—¶ã€ç›‘æ§å‹å¥½
ç¼ºç‚¹ï¼šèµ„æºå¼€é”€å¤§ã€ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬

ä¿¡å·é‡éš”ç¦»ï¼š
é€‚ç”¨åœºæ™¯ï¼šè½»é‡æ“ä½œã€é«˜é¢‘è°ƒç”¨ã€æ€§èƒ½æ•æ„Ÿ
ä¼˜ç‚¹ï¼šå¼€é”€å°ã€æ€§èƒ½å¥½
ç¼ºç‚¹ï¼šä¸æ”¯æŒè¶…æ—¶ã€éš”ç¦»ç¨‹åº¦æœ‰é™

é€‰æ‹©åŸåˆ™ï¼š
â€¢ æ ¸å¿ƒä¸šåŠ¡ â†’ çº¿ç¨‹æ± éš”ç¦»
â€¢ ç¼“å­˜æŸ¥è¯¢ â†’ ä¿¡å·é‡éš”ç¦»
â€¢ æ•°æ®åº“æ“ä½œ â†’ çº¿ç¨‹æ± éš”ç¦»
â€¢ å†…å­˜è®¡ç®— â†’ ä¿¡å·é‡éš”ç¦»
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ”¹ å®¹é”™ç­–ç•¥è®¾è®¡**
```
åˆ†å±‚å®¹é”™è®¾è®¡ï¼š

æ¥å…¥å±‚ï¼ˆGatewayï¼‰ï¼š
â€¢ å…¨å±€é™æµï¼šé˜²æ­¢ç³»ç»Ÿè¿‡è½½
â€¢ IPé»‘ç™½åå•ï¼šå®‰å…¨é˜²æŠ¤
â€¢ è¯·æ±‚è·¯ç”±ï¼šæ•…éšœè½¬ç§»

æœåŠ¡å±‚ï¼ˆBusiness Serviceï¼‰ï¼š
â€¢ ç†”æ–­é™çº§ï¼šæ ¸å¿ƒä¿æŠ¤æœºåˆ¶
â€¢ è¯·æ±‚ç¼“å­˜ï¼šå‡å°‘é‡å¤è°ƒç”¨
â€¢ è¶…æ—¶æ§åˆ¶ï¼šé¿å…é•¿æ—¶é—´ç­‰å¾…

æ•°æ®å±‚ï¼ˆData Accessï¼‰ï¼š
â€¢ è¿æ¥æ± ä¿æŠ¤ï¼šæ•°æ®åº“è¿æ¥é™åˆ¶
â€¢ è¯»å†™åˆ†ç¦»ï¼šé™ä½ä¸»åº“å‹åŠ›
â€¢ ç¼“å­˜ç­–ç•¥ï¼šå‡å°‘æ•°æ®åº“è®¿é—®
```

**ğŸ”¹ å‚æ•°è°ƒä¼˜å»ºè®®**
```
ç†”æ–­å™¨å‚æ•°ï¼š
â€¢ è¯·æ±‚é˜ˆå€¼ï¼šæ ¹æ®QPSè®¾ç½®ï¼Œå»ºè®®20-100
â€¢ å¤±è´¥ç‡ï¼šæ ¹æ®ä¸šåŠ¡å®¹å¿åº¦ï¼Œå»ºè®®30-60%
â€¢ æ¢å¤æ—¶é—´ï¼š5-30ç§’ï¼Œå…³é”®æœåŠ¡å¯æ›´çŸ­

çº¿ç¨‹æ± å‚æ•°ï¼š
â€¢ æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šCPUæ ¸æ•° * 2
â€¢ æœ€å¤§çº¿ç¨‹æ•°ï¼šæ ¸å¿ƒçº¿ç¨‹æ•° * 2-4å€
â€¢ é˜Ÿåˆ—å¤§å°ï¼šæœ€å¤§çº¿ç¨‹æ•° * 2-10å€

é™æµå‚æ•°ï¼š
â€¢ QPSé˜ˆå€¼ï¼šç³»ç»Ÿæœ€å¤§å¤„ç†èƒ½åŠ›çš„70-80%
â€¢ çªå‘æµé‡ï¼šå…è®¸çŸ­æ—¶é—´è¶…è¿‡é˜ˆå€¼
â€¢ é¢„çƒ­æ—¶é—´ï¼šç³»ç»Ÿå¯åŠ¨åçš„ç¼“å†²æ—¶é—´
```

**ğŸ”¹ ç›‘æ§å‘Šè­¦ç­–ç•¥**
```
ç›‘æ§åˆ†çº§ï¼š

P0çº§å‘Šè­¦ï¼ˆç«‹å³å¤„ç†ï¼‰ï¼š
â€¢ ç†”æ–­å™¨æ‰“å¼€
â€¢ é”™è¯¯ç‡è¶…è¿‡20%
â€¢ å“åº”æ—¶é—´è¶…è¿‡5ç§’

P1çº§å‘Šè­¦ï¼ˆ30åˆ†é’Ÿå†…å¤„ç†ï¼‰ï¼š
â€¢ é”™è¯¯ç‡è¶…è¿‡10%
â€¢ å“åº”æ—¶é—´è¶…è¿‡2ç§’
â€¢ çº¿ç¨‹æ± ä½¿ç”¨ç‡è¶…è¿‡80%

P2çº§å‘Šè­¦ï¼ˆ2å°æ—¶å†…å¤„ç†ï¼‰ï¼š
â€¢ QPSå¼‚å¸¸æ³¢åŠ¨
â€¢ ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™
â€¢ é˜Ÿåˆ—å †ç§¯

å‘Šè­¦å¤„ç†æµç¨‹ï¼š
1. è‡ªåŠ¨é™çº§ï¼šä¼˜å…ˆä¿è¯ç³»ç»Ÿå¯ç”¨
2. é—®é¢˜å®šä½ï¼šæ—¥å¿—åˆ†æã€é“¾è·¯è¿½è¸ª
3. å¿«é€Ÿä¿®å¤ï¼šé‡å¯ã€æ‰©å®¹ã€åˆ‡æµé‡
4. æ ¹æœ¬ä¿®å¤ï¼šä»£ç ä¼˜åŒ–ã€æ¶æ„è°ƒæ•´
```

### 8.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ”¹ å¼€å‘é˜¶æ®µ**
```
è®¾è®¡åŸåˆ™ï¼š
â€¢ å¤±è´¥ä¼˜å…ˆï¼šè€ƒè™‘å„ç§å¤±è´¥åœºæ™¯
â€¢ å¿«é€Ÿå¤±è´¥ï¼šé¿å…èµ„æºæµªè´¹
â€¢ ä¼˜é›…é™çº§ï¼šä¿è¯æ ¸å¿ƒåŠŸèƒ½

ç¼–ç è§„èŒƒï¼š
â€¢ é™çº§æ–¹æ³•è¦ç®€å•å¯é 
â€¢ é¿å…é™çº§æ–¹æ³•ä¸­å†æ¬¡è¿œç¨‹è°ƒç”¨
â€¢ åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
â€¢ è®°å½•è¯¦ç»†çš„æ—¥å¿—
```

**ğŸ”¹ æµ‹è¯•éªŒè¯**
```
å®¹é”™æµ‹è¯•æ¸…å•ï¼š
â˜‘ï¸ ä¸‹æ¸¸æœåŠ¡å®Œå…¨ä¸å¯ç”¨
â˜‘ï¸ ä¸‹æ¸¸æœåŠ¡å“åº”ç¼“æ…¢
â˜‘ï¸ ä¸‹æ¸¸æœåŠ¡è¿”å›å¼‚å¸¸æ•°æ®
â˜‘ï¸ ç½‘ç»œæŠ–åŠ¨å’Œè¶…æ—¶
â˜‘ï¸ é«˜å¹¶å‘å‹åŠ›æµ‹è¯•
â˜‘ï¸ ç†”æ–­å™¨çŠ¶æ€åˆ‡æ¢
â˜‘ï¸ é™çº§é€»è¾‘æ­£ç¡®æ€§

æµ‹è¯•å·¥å…·ï¼š
â€¢ Chaos Monkeyï¼šéšæœºæ•…éšœæ³¨å…¥
â€¢ Gatling/JMeterï¼šå‹åŠ›æµ‹è¯•
â€¢ WireMockï¼šæ¨¡æ‹ŸæœåŠ¡æ•…éšœ
â€¢ Postmanï¼šæ¥å£åŠŸèƒ½æµ‹è¯•
```

**ğŸ”¹ ç”Ÿäº§è¿ç»´**
```
å‘å¸ƒç­–ç•¥ï¼š
â€¢ ç°åº¦å‘å¸ƒï¼šé€æ­¥æ”¾é‡éªŒè¯
â€¢ è“ç»¿éƒ¨ç½²ï¼šå¿«é€Ÿå›æ»š
â€¢ é‡‘ä¸é›€å‘å¸ƒï¼šå°æµé‡éªŒè¯

åº”æ€¥é¢„æ¡ˆï¼š
â€¢ æœåŠ¡é™çº§å¼€å…³ï¼šå¿«é€Ÿå…³é—­éæ ¸å¿ƒåŠŸèƒ½
â€¢ æµé‡åˆ‡æ¢ï¼šæ•…éšœæ—¶è½¬ç§»åˆ°å¤‡ç”¨é›†ç¾¤
â€¢ é™æµè°ƒæ•´ï¼šåŠ¨æ€è°ƒæ•´æµé‡é˜ˆå€¼
â€¢ æ•°æ®å›æ»šï¼šæ•°æ®å¼‚å¸¸æ—¶çš„æ¢å¤æ–¹æ¡ˆ

æ—¥å¸¸ç»´æŠ¤ï¼š
â€¢ å®šæœŸæ£€æŸ¥ç†”æ–­å™¨é…ç½®
â€¢ åˆ†æé”™è¯¯æ—¥å¿—å’Œè¶‹åŠ¿
â€¢ ä¼˜åŒ–å“åº”æ—¶é—´å’ŒæˆåŠŸç‡
â€¢ å®¹é‡è§„åˆ’å’Œæ‰©å®¹å‡†å¤‡
```

### 8.5 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ”¹ æ–°æ‰‹å­¦ä¹ é¡ºåº**
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç†è§£
1. ç†è§£å¾®æœåŠ¡å®¹é”™çš„å¿…è¦æ€§
2. æŒæ¡ç†”æ–­ã€é™çº§ã€é™æµæ¦‚å¿µ
3. äº†è§£å¸¸è§çš„æ•…éšœåœºæ™¯

ç¬¬äºŒé˜¶æ®µï¼šæ¡†æ¶å®è·µ
1. é€‰æ‹©ä¸€ä¸ªæ¡†æ¶æ·±å…¥å­¦ä¹ ï¼ˆæ¨èResilience4jï¼‰
2. å®ŒæˆåŸºç¡€çš„Demoé¡¹ç›®
3. ç†è§£é…ç½®å‚æ•°çš„å«ä¹‰

ç¬¬ä¸‰é˜¶æ®µï¼šç”Ÿäº§åº”ç”¨
1. åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨å®¹é”™æ¡†æ¶
2. å­¦ä¹ ç›‘æ§å’Œè¿ç»´
3. ç§¯ç´¯æ•…éšœå¤„ç†ç»éªŒ

ç¬¬å››é˜¶æ®µï¼šæ·±å…¥ä¼˜åŒ–
1. æ€§èƒ½è°ƒä¼˜å’Œå‚æ•°è°ƒæ•´
2. è‡ªå®šä¹‰å®¹é”™ç­–ç•¥
3. æ¡†æ¶æºç é˜…è¯»
```

**ğŸ”¹ å¸¸è§é—®é¢˜ä¸è§£å†³**
```
é—®é¢˜1ï¼šé™çº§æ–¹æ³•ä¹Ÿå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
è§£å†³ï¼šé™çº§æ–¹æ³•è¦è¶³å¤Ÿç®€å•ï¼Œé¿å…å¤–éƒ¨ä¾èµ–

é—®é¢˜2ï¼šå¦‚ä½•æµ‹è¯•å®¹é”™æœºåˆ¶ï¼Ÿ
è§£å†³ï¼šä½¿ç”¨æ•…éšœæ³¨å…¥å·¥å…·ï¼Œæ¨¡æ‹Ÿå„ç§å¼‚å¸¸æƒ…å†µ

é—®é¢˜3ï¼šå®¹é”™ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ
è§£å†³ï¼šåˆç†é…ç½®å‚æ•°ï¼Œç›‘æ§æ€§èƒ½æŒ‡æ ‡

é—®é¢˜4ï¼šå¦‚ä½•å¤„ç†æ•°æ®ä¸€è‡´æ€§ï¼Ÿ
è§£å†³ï¼šç»“åˆåˆ†å¸ƒå¼äº‹åŠ¡å’Œè¡¥å¿æœºåˆ¶
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å®¹é”™æ¡†æ¶æŠ¤ç³»ç»Ÿï¼Œç†”æ–­é™çº§æ˜¯æ ¸å¿ƒ
éš”ç¦»ç­–ç•¥é˜²ä¼ æ’­ï¼Œç¼“å­˜åˆå¹¶ææ€§èƒ½
ç›‘æ§å‘Šè­¦ä¸å¯å°‘ï¼Œè¿ç»´å®è·µè¦è·Ÿä¸Š
å¿«é€Ÿå¤±è´¥ä¼˜é›…é™ï¼Œå¾®æœåŠ¡ç¨³å®šæœ‰ä¿éšœ
```

**å­¦ä¹ å»ºè®®**ï¼š
- ä»ç®€å•çš„Demoå¼€å§‹ï¼Œé€æ­¥ç†è§£æ¯ä¸ªæ¦‚å¿µ
- å¤šåšæ•…éšœæ¨¡æ‹Ÿç»ƒä¹ ï¼ŒåŠ æ·±å¯¹å®¹é”™æœºåˆ¶çš„ç†è§£
- å…³æ³¨ç”Ÿäº§ç¯å¢ƒçš„ç›‘æ§æ•°æ®ï¼Œç§¯ç´¯å®æˆ˜ç»éªŒ
- å­¦ä¹ å…¶ä»–å…¬å¸çš„æœ€ä½³å®è·µæ¡ˆä¾‹