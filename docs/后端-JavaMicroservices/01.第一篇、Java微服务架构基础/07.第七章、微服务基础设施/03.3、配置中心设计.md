---
title: 3ã€é…ç½®ä¸­å¿ƒè®¾è®¡
---
## ğŸ“š ç›®å½•


1. [é…ç½®ä¸­å¿ƒåŸºç¡€æ¦‚å¿µ](#1-é…ç½®ä¸­å¿ƒåŸºç¡€æ¦‚å¿µ)
2. [ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ä¸­å¿ƒ](#2-ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ä¸­å¿ƒ)
3. [Spring Cloud Configè¯¦è§£](#3-spring-cloud-configè¯¦è§£)
4. [Nacosé…ç½®ç®¡ç†](#4-nacosé…ç½®ç®¡ç†)
5. [é›†ä¸­åŒ–é…ç½®å®ç°](#5-é›†ä¸­åŒ–é…ç½®å®ç°)
6. [é…ç½®ç‰ˆæœ¬ç®¡ç†](#6-é…ç½®ç‰ˆæœ¬ç®¡ç†)
7. [ç¯å¢ƒéš”ç¦»ç­–ç•¥](#7-ç¯å¢ƒéš”ç¦»ç­–ç•¥)
8. [é…ç½®åŠ å¯†ä¸å®‰å…¨](#8-é…ç½®åŠ å¯†ä¸å®‰å…¨)
9. [åŠ¨æ€åˆ·æ–°æœºåˆ¶](#9-åŠ¨æ€åˆ·æ–°æœºåˆ¶)
10. [é…ç½®å›æ»šæ“ä½œ](#10-é…ç½®å›æ»šæ“ä½œ)
11. [æœ€ä½³å®è·µä¸æ€»ç»“](#11-æœ€ä½³å®è·µä¸æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ä¸­å¿ƒåŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ä¸­å¿ƒ



**ğŸ”¸ ç®€å•ç†è§£**
æƒ³è±¡ä½ æœ‰ä¸€ä¸ªå¤§å‹è´­ç‰©ç½‘ç«™ï¼ŒåŒ…å«ç”¨æˆ·æœåŠ¡ã€å•†å“æœåŠ¡ã€è®¢å•æœåŠ¡ç­‰å¤šä¸ªå¾®æœåŠ¡ã€‚æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦é…ç½®ä¿¡æ¯ï¼š
- æ•°æ®åº“è¿æ¥åœ°å€
- Redisç¼“å­˜åœ°å€  
- ç¬¬ä¸‰æ–¹APIå¯†é’¥
- ä¸šåŠ¡å‚æ•°è®¾ç½®

ä¼ ç»Ÿåšæ³•æ˜¯æŠŠè¿™äº›é…ç½®å†™åœ¨æ¯ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶é‡Œï¼Œä½†è¿™æ ·ä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ã€‚**é…ç½®ä¸­å¿ƒå°±æ˜¯ä¸“é—¨ç”¨æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¾®æœåŠ¡é…ç½®çš„ç»„ä»¶**ã€‚

### 1.2 é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒä½œç”¨



```
ä¼ ç»Ÿé…ç½®æ–¹å¼çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æœåŠ¡   â”‚  â”‚  å•†å“æœåŠ¡   â”‚  â”‚  è®¢å•æœåŠ¡   â”‚
â”‚ config.yml  â”‚  â”‚ config.yml  â”‚  â”‚ config.yml  â”‚
â”‚ æ•°æ®åº“åœ°å€  â”‚  â”‚ æ•°æ®åº“åœ°å€  â”‚  â”‚ æ•°æ®åº“åœ°å€  â”‚
â”‚ Redisåœ°å€   â”‚  â”‚ Redisåœ°å€   â”‚  â”‚ Redisåœ°å€   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“é…ç½®é‡å¤       â†“éš¾ä»¥ç»´æŠ¤       â†“æ›´æ–°å›°éš¾

é…ç½®ä¸­å¿ƒè§£å†³æ–¹æ¡ˆï¼š
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  é…ç½®ä¸­å¿ƒ    â”‚
                 â”‚ ç»Ÿä¸€ç®¡ç†é…ç½® â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æœåŠ¡   â”‚  â”‚  å•†å“æœåŠ¡   â”‚  â”‚  è®¢å•æœåŠ¡   â”‚
â”‚ ä»é…ç½®ä¸­å¿ƒ  â”‚  â”‚ ä»é…ç½®ä¸­å¿ƒ  â”‚  â”‚ ä»é…ç½®ä¸­å¿ƒ  â”‚
â”‚ è·å–é…ç½®    â”‚  â”‚ è·å–é…ç½®    â”‚  â”‚ è·å–é…ç½®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒä»·å€¼**
- **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰é…ç½®ç»Ÿä¸€å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹
- **åŠ¨æ€æ›´æ–°**ï¼šé…ç½®ä¿®æ”¹åæ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆ
- **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®åˆ†ç¦»
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®å˜æ›´æœ‰å†å²è®°å½•ï¼Œæ”¯æŒå›æ»š
- **å®‰å…¨æ€§**ï¼šæ•æ„Ÿé…ç½®å¯ä»¥åŠ å¯†å­˜å‚¨

---

## 2. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ä¸­å¿ƒ



### 2.1 ä¼ ç»Ÿé…ç½®ç®¡ç†çš„ç—›ç‚¹



**ğŸ“‹ å®é™…åœºæ™¯åˆ†æ**

å‡è®¾ä½ çš„ç”µå•†ç³»ç»Ÿæœ‰10ä¸ªå¾®æœåŠ¡ï¼Œéœ€è¦ä¿®æ”¹RedisæœåŠ¡å™¨åœ°å€ï¼š

> **ä¼ ç»Ÿæ–¹å¼çš„éº»çƒ¦**ï¼š
> 1. æ‰¾åˆ°æ‰€æœ‰ç”¨åˆ°Redisçš„æœåŠ¡é…ç½®æ–‡ä»¶ï¼ˆå¯èƒ½é—æ¼æŸä¸ªæœåŠ¡ï¼‰
> 2. é€ä¸ªä¿®æ”¹æ¯ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶
> 3. é‡æ–°æ„å»ºæ‰€æœ‰ç›¸å…³æœåŠ¡çš„Dockeré•œåƒ
> 4. é€ä¸ªé‡å¯è¿™äº›æœåŠ¡
> 5. éªŒè¯æ¯ä¸ªæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

è¿™ä¸ªè¿‡ç¨‹å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”åœæœºæ—¶é—´é•¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

### 2.2 å¾®æœåŠ¡é…ç½®ç®¡ç†æŒ‘æˆ˜



**ğŸ”¸ é…ç½®å¤æ‚æ€§å¢é•¿**

| æœåŠ¡æ•°é‡ | é…ç½®æ–‡ä»¶æ•°é‡ | ç®¡ç†å¤æ‚åº¦ | å‡ºé”™æ¦‚ç‡ |
|---------|-------------|-----------|---------|
| å•ä½“åº”ç”¨(1ä¸ª) | 1ä¸ª | ç®€å• | ä½ |
| å°å‹å¾®æœåŠ¡(5ä¸ª) | 5ä¸ª | ä¸­ç­‰ | ä¸­ç­‰ |
| ä¸­å‹å¾®æœåŠ¡(20ä¸ª) | 20ä¸ª | å¤æ‚ | é«˜ |
| å¤§å‹å¾®æœåŠ¡(100ä¸ª) | 100ä¸ª+ | æå…¶å¤æ‚ | æé«˜ |

**ğŸ”¸ å¤šç¯å¢ƒé…ç½®åŒæ­¥é—®é¢˜**
```
å¼€å‘ç¯å¢ƒ â†’ æµ‹è¯•ç¯å¢ƒ â†’ é¢„ç”Ÿäº§ç¯å¢ƒ â†’ ç”Ÿäº§ç¯å¢ƒ

æ¯ä¸ªç¯å¢ƒçš„é…ç½®éƒ½ä¸åŒï¼š
- æ•°æ®åº“åœ°å€ä¸åŒ
- æ—¥å¿—çº§åˆ«ä¸åŒ  
- ç¼“å­˜é…ç½®ä¸åŒ
- ç¬¬ä¸‰æ–¹æœåŠ¡åœ°å€ä¸åŒ

æ‰‹åŠ¨åŒæ­¥é…ç½®å®¹æ˜“å‡ºç°ï¼š
âŒ é…ç½®é—æ¼
âŒ é…ç½®é”™è¯¯
âŒ ç¯å¢ƒæ··æ·†
```

### 2.3 é…ç½®ä¸­å¿ƒè§£å†³çš„æ ¸å¿ƒé—®é¢˜



**âœ… ç»Ÿä¸€é…ç½®æº**
```
æ‰€æœ‰æœåŠ¡ä»åŒä¸€ä¸ªé…ç½®ä¸­å¿ƒè·å–é…ç½®
â†’ é¿å…é…ç½®ä¸ä¸€è‡´
â†’ é™ä½ç»´æŠ¤æˆæœ¬
```

**âœ… åŠ¨æ€é…ç½®æ›´æ–°**
```
é…ç½®ä¿®æ”¹åç«‹å³æ¨é€ç»™ç›¸å…³æœåŠ¡
â†’ æ— éœ€é‡å¯æœåŠ¡
â†’ æé«˜ç³»ç»Ÿå¯ç”¨æ€§
```

**âœ… é…ç½®å®‰å…¨æ€§**
```
æ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨
â†’ æ•°æ®åº“å¯†ç ã€APIå¯†é’¥ç­‰å®‰å…¨ä¿æŠ¤
â†’ æƒé™æ§åˆ¶ï¼Œé˜²æ­¢é…ç½®æ³„éœ²
```

---

## 3. ğŸŒ¿ Spring Cloud Configè¯¦è§£



### 3.1 Spring Cloud Configæ¶æ„



Spring Cloud Configæ˜¯Netflixå¼€æºçš„é…ç½®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œåˆ†ä¸º**é…ç½®æœåŠ¡å™¨**å’Œ**é…ç½®å®¢æˆ·ç«¯**ä¸¤éƒ¨åˆ†ã€‚

```
Gitä»“åº“é…ç½®å­˜å‚¨æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ‹‰å–é…ç½®    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPè¯·æ±‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Gitä»“åº“   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚ Config Serverâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚å¾®æœåŠ¡å®¢æˆ·ç«¯  â”‚
â”‚  å­˜å‚¨é…ç½®   â”‚               â”‚  é…ç½®æœåŠ¡å™¨  â”‚              â”‚ è·å–é…ç½®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                              â”‚                           â”‚
     â”‚ é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š                â”‚ æš´éœ²REST APIï¼š             â”‚ è‡ªåŠ¨é…ç½®æ³¨å…¥ï¼š
     â”‚ user-service-dev.yml          â”‚ /user-service/dev          â”‚ @Valueæ³¨è§£
     â”‚ user-service-prod.yml         â”‚ /user-service/prod         â”‚ @ConfigurationProperties
     â”‚ order-service-dev.yml         â”‚ /order-service/dev         â”‚
```

### 3.2 Config Serveræ­å»º



**ğŸ”§ åˆ›å»ºé…ç½®æœåŠ¡å™¨**

é¦–å…ˆåˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ä½œä¸ºé…ç½®æœåŠ¡å™¨ï¼š

ä¾èµ–é…ç½®ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-config-server</artifactId>
</dependency>
```

å¯åŠ¨ç±»é…ç½®ï¼š
```java
@SpringBootApplication
@EnableConfigServer  // å¯ç”¨é…ç½®æœåŠ¡å™¨
public class ConfigServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(ConfigServerApplication.class, args);
    }
}
```

**âš™ï¸ é…ç½®æœåŠ¡å™¨è®¾ç½®**
```yaml
server:
  port: 8888

spring:
  application:
    name: config-server
  cloud:
    config:
      server:
        git:
          uri: https://github.com/your-name/microservice-config
          search-paths: config  # é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•
          default-label: main   # é»˜è®¤åˆ†æ”¯
```

### 3.3 Gitä»“åº“é…ç½®æ–‡ä»¶ç»„ç»‡



**ğŸ“ é…ç½®æ–‡ä»¶å‘½åè§„åˆ™**
```
Gitä»“åº“ç»“æ„ï¼š
microservice-config/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ application.yml           # æ‰€æœ‰æœåŠ¡çš„å…¬å…±é…ç½®
â”‚   â”œâ”€â”€ user-service.yml          # ç”¨æˆ·æœåŠ¡é€šç”¨é…ç½®
â”‚   â”œâ”€â”€ user-service-dev.yml      # ç”¨æˆ·æœåŠ¡å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ user-service-test.yml     # ç”¨æˆ·æœåŠ¡æµ‹è¯•ç¯å¢ƒ
â”‚   â”œâ”€â”€ user-service-prod.yml     # ç”¨æˆ·æœåŠ¡ç”Ÿäº§ç¯å¢ƒ
â”‚   â”œâ”€â”€ order-service.yml         # è®¢å•æœåŠ¡é€šç”¨é…ç½®
â”‚   â”œâ”€â”€ order-service-dev.yml     # è®¢å•æœåŠ¡å¼€å‘ç¯å¢ƒ
â”‚   â””â”€â”€ order-service-prod.yml    # è®¢å•æœåŠ¡ç”Ÿäº§ç¯å¢ƒ
```

**ğŸ“ é…ç½®æ–‡ä»¶å†…å®¹ç¤ºä¾‹**
```yaml
# user-service-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒé…ç½®ï¼‰

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/user_dev
    username: dev_user
    password: dev_password
  
  redis:
    host: localhost
    port: 6379
    database: 0

# ä¸šåŠ¡é…ç½®

user:
  registration:
    email-verification: false  # å¼€å‘ç¯å¢ƒå…³é—­é‚®ç®±éªŒè¯
  cache:
    ttl: 300  # ç¼“å­˜5åˆ†é’Ÿ
```

### 3.4 Config Clienté…ç½®



**ğŸ”§ å¾®æœåŠ¡å®¢æˆ·ç«¯é›†æˆ**

åœ¨éœ€è¦è·å–é…ç½®çš„å¾®æœåŠ¡ä¸­æ·»åŠ ä¾èµ–ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>
```

**âš™ï¸ bootstrap.ymlé…ç½®**
```yaml
spring:
  application:
    name: user-service  # å¯¹åº”é…ç½®æ–‡ä»¶åå‰ç¼€
  profiles:
    active: dev        # å¯¹åº”ç¯å¢ƒåç¼€
  cloud:
    config:
      uri: http://localhost:8888  # é…ç½®æœåŠ¡å™¨åœ°å€
      fail-fast: true             # é…ç½®è·å–å¤±è´¥æ—¶å¿«é€Ÿå¤±è´¥
```

**ğŸ“¥ é…ç½®å±æ€§æ³¨å…¥**
```java
@RestController
@RefreshScope  // æ”¯æŒåŠ¨æ€åˆ·æ–°
public class UserController {
    
    @Value("${user.cache.ttl}")
    private int cacheTtl;
    
    @Autowired
    private UserConfig userConfig;  // é…ç½®ç±»æ³¨å…¥
    
    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        Map<String, Object> config = new HashMap<>();
        config.put("cacheTtl", cacheTtl);
        config.put("emailVerification", userConfig.getRegistration().isEmailVerification());
        return config;
    }
}
```

---

## 4. ğŸ® Nacosé…ç½®ç®¡ç†



### 4.1 Nacosé…ç½®ä¸­å¿ƒæ¦‚è¿°



Nacosï¼ˆDynamic Naming and Configuration Serviceï¼‰æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„é…ç½®ç®¡ç†å’ŒæœåŠ¡å‘ç°å¹³å°ï¼Œåœ¨å›½å†…ä½¿ç”¨éå¸¸å¹¿æ³›ã€‚

**ğŸ”¸ Nacos vs Spring Cloud Configå¯¹æ¯”**

| ç‰¹æ€§ | Nacos | Spring Cloud Config |
|------|-------|-------------------|
| **å­¦ä¹ æˆæœ¬** | ä½ï¼Œæœ‰ä¸­æ–‡æ–‡æ¡£å’ŒUIç•Œé¢ | ä¸­ç­‰ï¼Œéœ€è¦GitåŸºç¡€ |
| **é…ç½®å­˜å‚¨** | å†…ç½®æ•°æ®åº“ï¼Œæ”¯æŒMySQL | ä¾èµ–Gitä»“åº“ |
| **ç®¡ç†ç•Œé¢** | ä¸°å¯Œçš„Webæ§åˆ¶å° | æ— ï¼Œéœ€è¦ç¬¬ä¸‰æ–¹å·¥å…· |
| **åŠ¨æ€åˆ·æ–°** | åŸç”Ÿæ”¯æŒï¼Œå®æ—¶æ¨é€ | éœ€è¦æ‰‹åŠ¨è§¦å‘æˆ–é…ç½® |
| **é«˜å¯ç”¨** | æ”¯æŒé›†ç¾¤éƒ¨ç½² | ä¾èµ–Gitä»“åº“å¯ç”¨æ€§ |

### 4.2 Nacos Serveræ­å»º



**ğŸš€ å¿«é€Ÿå¯åŠ¨Nacos**

ä¸‹è½½å¹¶å¯åŠ¨Nacosï¼š
```bash
# ä¸‹è½½Nacos

wget https://github.com/alibaba/nacos/releases/download/2.2.3/nacos-server-2.2.3.tar.gz

# è§£å‹

tar -xzf nacos-server-2.2.3.tar.gz

# å•æœºæ¨¡å¼å¯åŠ¨

cd nacos/bin
./startup.sh -m standalone
```

è®¿é—®ç®¡ç†ç•Œé¢ï¼š`http://localhost:8848/nacos`
é»˜è®¤ç”¨æˆ·åå¯†ç ï¼š`nacos/nacos`

### 4.3 Nacosé…ç½®ç®¡ç†ç•Œé¢



**ğŸ–¥ï¸ é…ç½®ç®¡ç†æ“ä½œ**

é€šè¿‡Nacosæ§åˆ¶å°å¯ä»¥ç›´è§‚åœ°ç®¡ç†é…ç½®ï¼š

1. **åˆ›å»ºé…ç½®**
   - Data IDï¼š`user-service-dev.yaml`
   - Groupï¼š`DEFAULT_GROUP`
   - é…ç½®æ ¼å¼ï¼š`YAML`

2. **é…ç½®å†…å®¹ç¤ºä¾‹**
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/user_dev
    username: dev_user
    password: dev_password

user:
  registration:
    email-verification: false
  cache:
    ttl: 300
```

3. **å‘å¸ƒé…ç½®**
   - ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®
   - é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨è·å–

### 4.4 Spring Booté›†æˆNacos



**ğŸ”§ æ·»åŠ Nacosä¾èµ–**
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
</dependency>
```

**âš™ï¸ bootstrap.ymlé…ç½®**
```yaml
spring:
  application:
    name: user-service
  profiles:
    active: dev
  cloud:
    nacos:
      config:
        server-addr: localhost:8848
        file-extension: yaml
        group: DEFAULT_GROUP
        namespace: development  # å‘½åç©ºé—´ï¼Œç”¨äºç¯å¢ƒéš”ç¦»
```

**ğŸ“± åŠ¨æ€é…ç½®ä½¿ç”¨**
```java
@Component
@RefreshScope
public class ConfigBean {
    
    @Value("${user.cache.ttl:300}")
    private int cacheTtl;
    
    @NacosValue(value = "${user.registration.email-verification:true}", autoRefreshed = true)
    private boolean emailVerification;
    
    // getteræ–¹æ³•...
}
```

---

## 5. ğŸ—ï¸ é›†ä¸­åŒ–é…ç½®å®ç°



### 5.1 é…ç½®åˆ†å±‚æ¶æ„è®¾è®¡



**ğŸ”¸ é…ç½®å±‚æ¬¡ç»“æ„**

åˆç†çš„é…ç½®æ¶æ„åº”è¯¥åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œå°±åƒç©¿è¡£æœä¸€æ ·ï¼Œé‡Œé¢æ˜¯åŸºç¡€é…ç½®ï¼Œå¤–é¢æ˜¯ä¸ªæ€§åŒ–é…ç½®ï¼š

```
é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æœåŠ¡ç‰¹å®šç¯å¢ƒé…ç½®             â”‚  â† æœ€é«˜ä¼˜å…ˆçº§
â”‚  user-service-prod.yaml         â”‚    
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     æœåŠ¡é€šç”¨é…ç½®                â”‚  
â”‚  user-service.yaml              â”‚    
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     åº”ç”¨çº§å…¬å…±é…ç½®              â”‚  
â”‚  application.yaml               â”‚    
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â† æœ€ä½ä¼˜å…ˆçº§

é…ç½®è¦†ç›–ç¤ºä¾‹ï¼š
- application.yaml: database.timeout=30
- user-service.yaml: database.timeout=60  # è¦†ç›–å…¬å…±é…ç½®
- user-service-prod.yaml: database.timeout=120  # ç”Ÿäº§ç¯å¢ƒç‰¹æ®Šè®¾ç½®
```

### 5.2 é…ç½®æ¨¡æ¿åŒ–ç®¡ç†



**ğŸ“‹ é€šç”¨é…ç½®æŠ½å–**

å°†é‡å¤çš„é…ç½®æŠ½å–åˆ°å…¬å…±é…ç½®æ–‡ä»¶ä¸­ï¼š

```yaml
# application.yaml - æ‰€æœ‰æœåŠ¡çš„å…¬å…±é…ç½®

spring:
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
  
logging:
  level:
    com.company: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
```

**ğŸ”§ æœåŠ¡ç‰¹å®šé…ç½®**
```yaml
# user-service.yaml - ç”¨æˆ·æœåŠ¡ä¸“ç”¨é…ç½®

server:
  port: 8081

spring:
  application:
    name: user-service

user:
  default-avatar: https://example.com/default-avatar.png
  password:
    min-length: 6
    require-special-char: true
```

### 5.3 é…ç½®å¼•ç”¨å’Œå¤ç”¨



**ğŸ”— é…ç½®å¼•ç”¨æœºåˆ¶**

é¿å…é…ç½®é‡å¤ï¼Œæé«˜ç»´æŠ¤æ•ˆç‡ï¼š

```yaml
# åŸºç¡€é…ç½®å®šä¹‰

database: &database-config
  driver-class-name: com.mysql.cj.jdbc.Driver
  hikari:
    maximum-pool-size: 20
    minimum-idle: 5
    connection-timeout: 30000

redis: &redis-config
  lettuce:
    pool:
      max-active: 20
      max-idle: 10

# æœåŠ¡é…ç½®å¼•ç”¨

spring:
  datasource:
    <<: *database-config
    url: jdbc:mysql://localhost:3306/user_service
    username: ${DB_USER:user}
    password: ${DB_PASSWORD:password}
  
  redis:
    <<: *redis-config
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
```

---

## 6. ğŸ“š é…ç½®ç‰ˆæœ¬ç®¡ç†



### 6.1 Gitç‰ˆæœ¬æ§åˆ¶



**ğŸ”¸ é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬ç®¡ç†**

ä½¿ç”¨Gitç®¡ç†é…ç½®æ–‡ä»¶å°±åƒç®¡ç†ä»£ç ä¸€æ ·é‡è¦ï¼š

```bash
# é…ç½®å˜æ›´å·¥ä½œæµ

git checkout -b feature/update-database-config

# ä¿®æ”¹é…ç½®æ–‡ä»¶

vim config/user-service-prod.yml

# æäº¤å˜æ›´

git add .
git commit -m "feat: æ›´æ–°ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è¿æ¥æ± é…ç½®

- å¢åŠ æœ€å¤§è¿æ¥æ•°åˆ°50
- è°ƒæ•´è¿æ¥è¶…æ—¶æ—¶é—´ä¸º20ç§’
- æ·»åŠ è¿æ¥æœ‰æ•ˆæ€§æ£€æŸ¥"

# æ¨é€åˆ°è¿œç¨‹

git push origin feature/update-database-config

# åˆå¹¶åˆ°ä¸»åˆ†æ”¯

git checkout main
git merge feature/update-database-config
```

### 6.2 é…ç½®å˜æ›´è®°å½•



**ğŸ“‹ å˜æ›´æ—¥å¿—ç®¡ç†**

å»ºç«‹é…ç½®å˜æ›´çš„æ ‡å‡†æµç¨‹ï¼š

```yaml
# CHANGELOG.md - é…ç½®å˜æ›´è®°å½•

# [2024-01-15] - ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–


## å˜æ›´å†…å®¹


- user-service-prod.yml
  - æ•°æ®åº“è¿æ¥æ± ï¼š20 â†’ 50
  - ç¼“å­˜TTLï¼š300s â†’ 600s
  
## å½±å“èŒƒå›´


- ç”¨æˆ·æœåŠ¡æ€§èƒ½æå‡
- å†…å­˜ä½¿ç”¨ç•¥æœ‰å¢åŠ 

## å›æ»šæ–¹æ¡ˆ


- Git commit: a1b2c3d4
- ç´§æ€¥å›æ»šå‘½ä»¤: git reset --hard a1b2c3d4

# [2024-01-10] - æ–°å¢é‚®ä»¶æœåŠ¡é…ç½®


## å˜æ›´å†…å®¹


- æ–°å¢ mail-service.yml
- é…ç½®SMTPæœåŠ¡å™¨ä¿¡æ¯
```

### 6.3 Nacosé…ç½®å†å²



**ğŸ• é…ç½®å†å²æŸ¥çœ‹**

Nacosæä¾›äº†é…ç½®å†å²åŠŸèƒ½ï¼š

> **é…ç½®å†å²æ“ä½œ**ï¼š
> 1. è¿›å…¥Nacosæ§åˆ¶å°
> 2. é€‰æ‹©é…ç½®ç®¡ç† â†’ é…ç½®åˆ—è¡¨
> 3. ç‚¹å‡»é…ç½®é¡¹åçš„"æ›´å¤š" â†’ "å†å²ç‰ˆæœ¬"
> 4. å¯ä»¥æŸ¥çœ‹æ¯æ¬¡å˜æ›´çš„ï¼š
>    - å˜æ›´æ—¶é—´
>    - å˜æ›´å†…å®¹å¯¹æ¯”
>    - æ“ä½œäººå‘˜
>    - ä¸€é”®å›æ»šåŠŸèƒ½

**ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”ç¤ºä¾‹**
```yaml
# ç‰ˆæœ¬1ï¼ˆ2024-01-10 10:00ï¼‰

user:
  cache:
    ttl: 300
  registration:
    email-verification: true

# ç‰ˆæœ¬2ï¼ˆ2024-01-15 14:30ï¼‰  

user:
  cache:
    ttl: 600        # å˜æ›´ï¼š300 â†’ 600
  registration:
    email-verification: false  # å˜æ›´ï¼štrue â†’ false
    sms-verification: true     # æ–°å¢ï¼šçŸ­ä¿¡éªŒè¯
```

---

## 7. ğŸŒ ç¯å¢ƒéš”ç¦»ç­–ç•¥



### 7.1 å‘½åç©ºé—´éš”ç¦»



**ğŸ”¸ Nacoså‘½åç©ºé—´è®¾è®¡**

å‘½åç©ºé—´å°±åƒä¸åŒçš„æˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´é‡Œçš„é…ç½®äº’ä¸å¹²æ‰°ï¼š

```
Nacoså‘½åç©ºé—´è®¾è®¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å‘ç¯å¢ƒ        â”‚  â”‚  æµ‹è¯•ç¯å¢ƒ        â”‚  â”‚  ç”Ÿäº§ç¯å¢ƒ        â”‚
â”‚  dev-namespace   â”‚  â”‚  test-namespace  â”‚  â”‚  prod-namespace  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user-service.yml â”‚  â”‚ user-service.yml â”‚  â”‚ user-service.yml â”‚
â”‚ order-service.ymlâ”‚  â”‚ order-service.ymlâ”‚  â”‚ order-service.ymlâ”‚
â”‚ æ•°æ®åº“:devåº“     â”‚  â”‚ æ•°æ®åº“:teståº“    â”‚  â”‚ æ•°æ®åº“:prodåº“    â”‚
â”‚ Redis:å•æœº       â”‚  â”‚ Redis:å•æœº       â”‚  â”‚ Redis:é›†ç¾¤       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš™ï¸ å‘½åç©ºé—´é…ç½®**
```yaml
# å¼€å‘ç¯å¢ƒæœåŠ¡é…ç½®

spring:
  cloud:
    nacos:
      config:
        server-addr: localhost:8848
        namespace: development-env
        group: user-service-group

# ç”Ÿäº§ç¯å¢ƒæœåŠ¡é…ç½®  

spring:
  cloud:
    nacos:
      config:
        server-addr: nacos-cluster:8848
        namespace: production-env
        group: user-service-group
```

### 7.2 é…ç½®åˆ†ç»„ç®¡ç†



**ğŸ·ï¸ Groupåˆ†ç»„ç­–ç•¥**

åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´å†…ï¼Œå¯ä»¥ä½¿ç”¨Groupè¿›ä¸€æ­¥åˆ†ç»„ï¼š

```yaml
åˆ†ç»„ç­–ç•¥ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”Ÿäº§ç¯å¢ƒå‘½åç©ºé—´          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æ¨¡å—ç»„ (USER_GROUP)        â”‚
â”‚  - user-service.yml             â”‚
â”‚  - user-auth-service.yml        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚  è®¢å•æ¨¡å—ç»„ (ORDER_GROUP)       â”‚
â”‚  - order-service.yml            â”‚
â”‚  - payment-service.yml          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€è®¾æ–½ç»„ (INFRA_GROUP)       â”‚
â”‚  - gateway.yml                  â”‚
â”‚  - eureka.yml                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 ç¯å¢ƒé…ç½®å·®å¼‚ç®¡ç†



**ğŸ“Š ç¯å¢ƒå·®å¼‚å¯¹æ¯”è¡¨**

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|---------|---------|---------|
| **æ•°æ®åº“** | å•æœºMySQL | å•æœºMySQL | ä¸»ä»MySQLé›†ç¾¤ |
| **Redis** | å•æœº | å•æœº | é›†ç¾¤æ¨¡å¼ |
| **æ—¥å¿—çº§åˆ«** | DEBUG | INFO | WARN |
| **ç¼“å­˜TTL** | 60ç§’ | 300ç§’ | 1800ç§’ |
| **é‚®ä»¶éªŒè¯** | å…³é—­ | å¼€å¯ | å¼€å¯ |
| **ç›‘æ§** | å…³é—­ | å¼€å¯ | å¼€å¯ |

**ğŸ”§ é…ç½®æ¨¡æ¿åŒ–**
```yaml
# é…ç½®æ¨¡æ¿ï¼šuser-service-${env}.yml

spring:
  datasource:
    url: jdbc:mysql://${mysql.host:localhost}:3306/user_${env}
    username: ${mysql.username}
    password: ${mysql.password}
    hikari:
      maximum-pool-size: ${db.pool.max:10}

logging:
  level:
    com.company: ${log.level:INFO}

user:
  cache:
    ttl: ${cache.ttl:300}
  registration:
    email-verification: ${email.verify:true}
```

---

## 8. ğŸ” é…ç½®åŠ å¯†ä¸å®‰å…¨



### 8.1 æ•æ„Ÿé…ç½®åŠ å¯†



**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦é…ç½®åŠ å¯†**

æƒ³è±¡ä½ çš„é…ç½®æ–‡ä»¶åŒ…å«ï¼š
- æ•°æ®åº“å¯†ç 
- Rediså¯†ç   
- ç¬¬ä¸‰æ–¹APIå¯†é’¥
- JWTç­¾åå¯†é’¥

å¦‚æœè¿™äº›ä¿¡æ¯ä»¥æ˜æ–‡å­˜å‚¨ï¼Œä»»ä½•èƒ½çœ‹åˆ°é…ç½®çš„äººéƒ½èƒ½è·å–æ•æ„Ÿä¿¡æ¯ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚

### 8.2 Spring Cloud ConfigåŠ å¯†



**ğŸ” é…ç½®æœåŠ¡å™¨åŠ å¯†è®¾ç½®**
```yaml
# config-serveré…ç½®

encrypt:
  key: mySecretKey  # å¯¹ç§°åŠ å¯†å¯†é’¥
#  # æˆ–è€…ä½¿ç”¨éå¯¹ç§°åŠ å¯†
#  # key-store:
#  #   location: classpath:server.jks
#  #   password: keystorepass
#  #   alias: mytestkey
```

**ğŸ”§ é…ç½®åŠ å¯†æ“ä½œ**
```bash
# åŠ å¯†å¯†ç 

curl -X POST http://localhost:8888/encrypt -d "mysecretpassword"
# è¿”å›ï¼šAQA1I5A1j5DYb3TbvG5V8dF2Jp...ï¼ˆåŠ å¯†åçš„å€¼ï¼‰


# è§£å¯†éªŒè¯

curl -X POST http://localhost:8888/decrypt -d "AQA1I5A1j5DYb3TbvG5V8dF2Jp..."
# è¿”å›ï¼šmysecretpassword

```

**ğŸ“ åŠ å¯†é…ç½®ä½¿ç”¨**
```yaml
# user-service-prod.yml

spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/user_prod
    username: prod_user
    password: '{cipher}AQA1I5A1j5DYb3TbvG5V8dF2Jp...'  # åŠ å¯†åçš„å¯†ç 

jwt:
  secret: '{cipher}BQB2J6B2k6EZc4UcwH6W9eG3Kq...'  # åŠ å¯†åçš„JWTå¯†é’¥
```

### 8.3 Nacosé…ç½®åŠ å¯†



**ğŸ” è‡ªå®šä¹‰é…ç½®è§£å¯†**

Nacosæœ¬èº«ä¸æä¾›åŠ å¯†åŠŸèƒ½ï¼Œéœ€è¦åœ¨åº”ç”¨ä¸­å®ç°ï¼š

```java
@Component
public class ConfigDecryptor {
    
    private final AESUtil aesUtil;
    
    @PostConstruct
    public void decryptConfigs() {
        // è·å–åŠ å¯†çš„é…ç½®
        String encryptedPassword = environment.getProperty("spring.datasource.password");
        
        if (encryptedPassword != null && encryptedPassword.startsWith("{cipher}")) {
            // è§£å¯†é…ç½®
            String decryptedPassword = aesUtil.decrypt(encryptedPassword.substring(8));
            
            // è®¾ç½®åˆ°ç³»ç»Ÿå±æ€§ä¸­
            System.setProperty("spring.datasource.password", decryptedPassword);
        }
    }
}
```

### 8.4 é…ç½®è®¿é—®æƒé™æ§åˆ¶



**ğŸ‘¥ æƒé™ç®¡ç†ç­–ç•¥**

```yaml
Nacosæƒé™æ§åˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å‘äººå‘˜   â”‚   â”‚  æµ‹è¯•äººå‘˜   â”‚   â”‚  è¿ç»´äººå‘˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åªèƒ½è®¿é—®    â”‚   â”‚ åªèƒ½è®¿é—®    â”‚   â”‚ å¯ä»¥è®¿é—®    â”‚
â”‚ å¼€å‘ç¯å¢ƒ    â”‚   â”‚ æµ‹è¯•ç¯å¢ƒ    â”‚   â”‚ æ‰€æœ‰ç¯å¢ƒ    â”‚
â”‚ é…ç½®        â”‚   â”‚ é…ç½®        â”‚   â”‚ é…ç½®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ Nacosæƒé™é…ç½®**
```yaml
# nacosç”¨æˆ·è§’è‰²é…ç½®

ç”¨æˆ·ç®¡ç†:
  - å¼€å‘ç»„: dev-user (åªèƒ½è®¿é—®developmentå‘½åç©ºé—´)
  - æµ‹è¯•ç»„: test-user (åªèƒ½è®¿é—®testingå‘½åç©ºé—´)  
  - è¿ç»´ç»„: ops-user (å¯ä»¥è®¿é—®æ‰€æœ‰å‘½åç©ºé—´)
```

---

## 9. ğŸ”„ åŠ¨æ€åˆ·æ–°æœºåˆ¶



### 9.1 é…ç½®åˆ·æ–°åŸç†



**ğŸ”¸ åˆ·æ–°æœºåˆ¶å¯¹æ¯”**

ä¼ ç»Ÿæ–¹å¼ä¿®æ”¹é…ç½®éœ€è¦é‡å¯æœåŠ¡ï¼ŒåŠ¨æ€åˆ·æ–°å¯ä»¥è®©é…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼š

```
ä¼ ç»Ÿé…ç½®ä¿®æ”¹æµç¨‹ï¼š
ä¿®æ”¹é…ç½® â†’ é‡æ–°æ‰“åŒ… â†’ åœæ­¢æœåŠ¡ â†’ éƒ¨ç½²æ–°ç‰ˆæœ¬ â†’ å¯åŠ¨æœåŠ¡
(åœæœºæ—¶é—´ï¼š5-10åˆ†é’Ÿ)

åŠ¨æ€åˆ·æ–°æµç¨‹ï¼š  
ä¿®æ”¹é…ç½® â†’ æ¨é€é€šçŸ¥ â†’ æœåŠ¡è‡ªåŠ¨è·å–æ–°é…ç½® â†’ ç«‹å³ç”Ÿæ•ˆ
(åœæœºæ—¶é—´ï¼š0ç§’)
```

### 9.2 Spring Cloud Configåˆ·æ–°



**ğŸ”„ æ‰‹åŠ¨åˆ·æ–°æ–¹å¼**

æ·»åŠ Actuatorä¾èµ–ï¼š
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

é…ç½®åˆ·æ–°ç«¯ç‚¹ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: refresh
```

**ğŸ”§ è§¦å‘åˆ·æ–°**
```bash
# ä¿®æ”¹Gité…ç½®æ–‡ä»¶åï¼Œé€šçŸ¥æœåŠ¡åˆ·æ–°

curl -X POST http://localhost:8081/actuator/refresh

# è¿”å›åˆ·æ–°çš„é…ç½®é¡¹

[
  "user.cache.ttl",
  "user.registration.email-verification"
]
```

### 9.3 Spring Cloud Busæ‰¹é‡åˆ·æ–°



**ğŸ“¡ æ¶ˆæ¯æ€»çº¿åˆ·æ–°**

Spring Cloud Buså¯ä»¥é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶å®ç°æ‰¹é‡åˆ·æ–°ï¼š

```
Gité…ç½®æ›´æ–° â†’ Config Server â†’ æ¶ˆæ¯æ€»çº¿ â†’ æ‰€æœ‰ç›¸å…³æœåŠ¡è‡ªåŠ¨åˆ·æ–°

                 RabbitMQ/Kafka
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼            â–¼            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚æœåŠ¡A    â”‚  â”‚æœåŠ¡B    â”‚  â”‚æœåŠ¡C    â”‚
   â”‚è‡ªåŠ¨åˆ·æ–° â”‚  â”‚è‡ªåŠ¨åˆ·æ–° â”‚  â”‚è‡ªåŠ¨åˆ·æ–° â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 Nacosè‡ªåŠ¨åˆ·æ–°



**âš¡ Nacoså®æ—¶æ¨é€**

Nacosæ”¯æŒå®æ—¶é…ç½®æ¨é€ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°ï¼š

```java
@Component
@RefreshScope  // æ”¯æŒåŠ¨æ€åˆ·æ–°
public class DynamicConfigBean {
    
    @Value("${user.cache.ttl:300}")
    private int cacheTtl;
    
    @NacosValue(value = "${user.max-login-attempts:5}", autoRefreshed = true)
    private int maxLoginAttempts;
    
    // é…ç½®å˜æ›´ç›‘å¬
    @NacosConfigListener(dataId = "user-service.yaml")
    public void onConfigChange(String newValue) {
        log.info("é…ç½®å‘ç”Ÿå˜æ›´ï¼Œæ–°é…ç½®: {}", newValue);
        // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†é…ç½®å˜æ›´åçš„é€»è¾‘
    }
}
```

**ğŸ“Š åˆ·æ–°æ•ˆæœéªŒè¯**
```java
@RestController
public class ConfigTestController {
    
    @Autowired
    private DynamicConfigBean configBean;
    
    @GetMapping("/current-config")
    public Map<String, Object> getCurrentConfig() {
        return Map.of(
            "cacheTtl", configBean.getCacheTtl(),
            "maxLoginAttempts", configBean.getMaxLoginAttempts(),
            "timestamp", System.currentTimeMillis()
        );
    }
}
```

---

## 10. â†©ï¸ é…ç½®å›æ»šæ“ä½œ



### 10.1 Gité…ç½®å›æ»š



**ğŸ”„ ç‰ˆæœ¬å›æ»šç­–ç•¥**

å½“é…ç½®æ›´æ–°å¯¼è‡´é—®é¢˜æ—¶ï¼Œéœ€è¦å¿«é€Ÿå›æ»šåˆ°ç¨³å®šç‰ˆæœ¬ï¼š

```bash
# æŸ¥çœ‹é…ç½®å˜æ›´å†å²

git log --oneline config/user-service-prod.yml

# è¾“å‡ºç¤ºä¾‹ï¼š

# a1b2c3d (HEAD) feat: ä¼˜åŒ–ç¼“å­˜é…ç½®  

# e4f5g6h fix: ä¿®å¤æ•°æ®åº“è¿æ¥é…ç½®

# i7j8k9l feat: æ–°å¢é‚®ä»¶é…ç½®


# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬

git checkout e4f5g6h -- config/user-service-prod.yml

# æäº¤å›æ»š

git commit -m "rollback: å›æ»šç”¨æˆ·æœåŠ¡é…ç½®åˆ°ç¨³å®šç‰ˆæœ¬ e4f5g6h"
```

### 10.2 Nacosé…ç½®å›æ»š



**ğŸ–¥ï¸ æ§åˆ¶å°ä¸€é”®å›æ»š**

Nacosæä¾›äº†ä¾¿æ·çš„å›æ»šåŠŸèƒ½ï¼š

> **å›æ»šæ“ä½œæ­¥éª¤**ï¼š
> 1. è¿›å…¥Nacosæ§åˆ¶å°
> 2. é…ç½®ç®¡ç† â†’ é…ç½®åˆ—è¡¨
> 3. æ‰¾åˆ°éœ€è¦å›æ»šçš„é…ç½®
> 4. ç‚¹å‡»"æ›´å¤š" â†’ "å†å²ç‰ˆæœ¬"
> 5. é€‰æ‹©è¦å›æ»šçš„ç‰ˆæœ¬
> 6. ç‚¹å‡»"å›æ»š"æŒ‰é’®
> 7. ç¡®è®¤å›æ»šæ“ä½œ

**ğŸ“‹ å›æ»šè®°å½•ç¤ºä¾‹**
```yaml
é…ç½®å›æ»šæ—¥å¿—ï¼š
æ—¶é—´: 2024-01-15 15:30:25
æ“ä½œ: é…ç½®å›æ»š  
é…ç½®: user-service-prod.yaml
ä»ç‰ˆæœ¬: v1.2.3 (2024-01-15 14:30)
å›æ»šåˆ°: v1.2.1 (2024-01-10 10:00)
æ“ä½œäºº: admin
åŸå› : æ–°é…ç½®å¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥
```

### 10.3 è‡ªåŠ¨åŒ–å›æ»šæœºåˆ¶



**ğŸ¤– å¥åº·æ£€æŸ¥è§¦å‘å›æ»š**

å¯ä»¥ç»“åˆç›‘æ§ç³»ç»Ÿå®ç°è‡ªåŠ¨å›æ»šï¼š

```java
@Component
public class ConfigHealthChecker {
    
    @EventListener
    public void onConfigRefresh(RefreshEvent event) {
        // é…ç½®åˆ·æ–°åè¿›è¡Œå¥åº·æ£€æŸ¥
        boolean isHealthy = performHealthCheck();
        
        if (!isHealthy) {
            log.error("é…ç½®æ›´æ–°åæœåŠ¡ä¸å¥åº·ï¼Œè§¦å‘è‡ªåŠ¨å›æ»š");
            triggerConfigRollback();
        }
    }
    
    private boolean performHealthCheck() {
        try {
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥
            dataSource.getConnection().close();
            
            // æ£€æŸ¥Redisè¿æ¥
            redisTemplate.execute((RedisCallback<String>) connection -> {
                return connection.ping();
            });
            
            return true;
        } catch (Exception e) {
            log.error("å¥åº·æ£€æŸ¥å¤±è´¥", e);
            return false;
        }
    }
}
```

---

## 11. ğŸ¯ æœ€ä½³å®è·µä¸æ€»ç»“



### 11.1 é…ç½®ä¸­å¿ƒé€‰å‹å»ºè®®



**ğŸ”¸ æŠ€æœ¯é€‰å‹å¯¹æ¯”**

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **å°å›¢é˜Ÿå¿«é€Ÿå¼€å‘** | Nacos | å­¦ä¹ æˆæœ¬ä½ï¼Œä¸­æ–‡æ–‡æ¡£ï¼ŒUIå‹å¥½ |
| **å¤§å‹ä¼ä¸šçº§åº”ç”¨** | Spring Cloud Config | ç”Ÿæ€æˆç†Ÿï¼Œä¸Springé›†æˆå¥½ |
| **å·²æœ‰Gitå·¥ä½œæµ** | Spring Cloud Config | é…ç½®å˜æ›´æµç¨‹ä¸ä»£ç ä¸€è‡´ |
| **éœ€è¦å¤šè¯­è¨€æ”¯æŒ** | Apollo/Consul | æ”¯æŒéJavaåº”ç”¨ |

### 11.2 é…ç½®ç®¡ç†æœ€ä½³å®è·µ



**âœ… é…ç½®è®¾è®¡åŸåˆ™**

1. **åˆ†å±‚æ¸…æ™°**ï¼šå…¬å…±é…ç½®ã€æœåŠ¡é…ç½®ã€ç¯å¢ƒé…ç½®å±‚æ¬¡åˆ†æ˜
2. **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒï¼Œå¦‚ï¼š`æœåŠ¡å-ç¯å¢ƒ.æ‰©å±•å`
3. **æ•æ„Ÿä¿¡æ¯åŠ å¯†**ï¼šæ•°æ®åº“å¯†ç ã€APIå¯†é’¥ç­‰å¿…é¡»åŠ å¯†å­˜å‚¨
4. **ç‰ˆæœ¬ç®¡ç†**ï¼šæ‰€æœ‰é…ç½®å˜æ›´éƒ½è¦æœ‰ç‰ˆæœ¬è®°å½•å’Œå˜æ›´è¯´æ˜
5. **æƒé™æ§åˆ¶**ï¼šä¸åŒç¯å¢ƒçš„é…ç½®è®¿é—®æƒé™è¦ä¸¥æ ¼æ§åˆ¶

**ğŸ”§ è¿ç»´æœ€ä½³å®è·µ**

```yaml
é…ç½®å˜æ›´æ ‡å‡†æµç¨‹ï¼š
1. éœ€æ±‚åˆ†æ â†’ ç¡®å®šé…ç½®å˜æ›´èŒƒå›´
2. æµ‹è¯•éªŒè¯ â†’ åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®æ­£ç¡®æ€§  
3. å˜æ›´ç”³è¯· â†’ å¡«å†™å˜æ›´ç”³è¯·ï¼Œè¯´æ˜å˜æ›´åŸå› 
4. å®¡æ ¸é€šè¿‡ â†’ ç”±è¿ç»´æˆ–æ¶æ„å¸ˆå®¡æ ¸
5. é…ç½®å‘å¸ƒ â†’ æŒ‰ç…§å‘å¸ƒè®¡åˆ’æ›´æ–°é…ç½®
6. ç›‘æ§éªŒè¯ â†’ å‘å¸ƒåç›‘æ§æœåŠ¡çŠ¶æ€
7. å›æ»šå‡†å¤‡ â†’ å¦‚æœ‰é—®é¢˜ç«‹å³å›æ»š
```

### 11.3 å¸¸è§é—®é¢˜æ’æŸ¥



**âŒ é…ç½®ä¸ç”Ÿæ•ˆé—®é¢˜**

```
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿æ¥åˆ°æ­£ç¡®çš„é…ç½®ä¸­å¿ƒ
2. éªŒè¯é…ç½®æ–‡ä»¶å‘½åæ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ç¯å¢ƒå˜é‡ï¼ˆprofileï¼‰æ˜¯å¦åŒ¹é…
4. æ£€æŸ¥é…ç½®åˆ·æ–°æ˜¯å¦æˆåŠŸ
5. æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é…ç½®åŠ è½½ä¿¡æ¯
```

**âŒ é…ç½®åŠ è½½å¤±è´¥**

```
å¸¸è§åŸå› ï¼š
1. é…ç½®ä¸­å¿ƒæœåŠ¡ä¸å¯ç”¨
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼ˆYAMLç¼©è¿›é—®é¢˜ï¼‰
4. æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®é…ç½®
5. é…ç½®å†…å®¹åŒ…å«ç‰¹æ®Šå­—ç¬¦å¯¼è‡´è§£æå¤±è´¥
```

### 11.4 æ ¸å¿ƒè¦ç‚¹æ€»ç»“



**ğŸ¯ é…ç½®ä¸­å¿ƒæ ¸å¿ƒä»·å€¼**
- **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰æœåŠ¡é…ç½®ç»Ÿä¸€ç®¡ç†ï¼Œé¿å…é…ç½®åˆ†æ•£
- **åŠ¨æ€æ›´æ–°**ï¼šé…ç½®ä¿®æ”¹æ— éœ€é‡å¯æœåŠ¡å³å¯ç”Ÿæ•ˆ
- **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®å®Œå…¨åˆ†ç¦»
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®å˜æ›´æœ‰å®Œæ•´çš„å†å²è®°å½•å’Œå›æ»šèƒ½åŠ›
- **å®‰å…¨æ€§**ï¼šæ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨ï¼Œæƒé™ä¸¥æ ¼æ§åˆ¶

**ğŸ’¡ å®æ–½å»ºè®®**
- **å¾ªåºæ¸è¿›**ï¼šå…ˆä»éæ ¸å¿ƒæœåŠ¡å¼€å§‹è¯•ç‚¹ï¼Œé€æ­¥æ¨å¹¿
- **å›¢é˜ŸåŸ¹è®­**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜ç†Ÿæ‚‰é…ç½®ä¸­å¿ƒçš„ä½¿ç”¨æ–¹æ³•
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹é…ç½®å˜æ›´çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- **ç¾å¤‡è®¡åˆ’**ï¼šåˆ¶å®šé…ç½®ä¸­å¿ƒæ•…éšœæ—¶çš„åº”æ€¥é¢„æ¡ˆ

**ğŸš€ å‘å±•è¶‹åŠ¿**
éšç€äº‘åŸç”ŸæŠ€æœ¯çš„å‘å±•ï¼Œé…ç½®ç®¡ç†æ­£åœ¨å‘æ›´åŠ æ™ºèƒ½åŒ–ã€è‡ªåŠ¨åŒ–çš„æ–¹å‘å‘å±•ï¼š
- **æ™ºèƒ½æ¨è**ï¼šåŸºäºæœåŠ¡ç‰¹å¾è‡ªåŠ¨æ¨èæœ€ä¼˜é…ç½®
- **è‡ªåŠ¨è°ƒä¼˜**ï¼šæ ¹æ®æœåŠ¡è¿è¡ŒçŠ¶æ€è‡ªåŠ¨è°ƒæ•´é…ç½®å‚æ•°
- **é…ç½®å³ä»£ç **ï¼šå°†é…ç½®ç®¡ç†çº³å…¥DevOpsæµç¨‹ï¼Œå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- é…ç½®ä¸­å¿ƒè§£å†³å¾®æœåŠ¡é…ç½®ç®¡ç†å¤æ‚æ€§é—®é¢˜
- Spring Cloud Configé€‚åˆGitå·¥ä½œæµï¼ŒNacosé€‚åˆå¿«é€Ÿå¼€å‘
- ç¯å¢ƒéš”ç¦»å’Œç‰ˆæœ¬ç®¡ç†æ˜¯é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒèƒ½åŠ›
- å®‰å…¨æ€§å’ŒåŠ¨æ€åˆ·æ–°æå‡äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§