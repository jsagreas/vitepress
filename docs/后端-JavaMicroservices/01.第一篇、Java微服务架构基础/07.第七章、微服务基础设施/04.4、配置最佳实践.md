---
title: 4ã€é…ç½®æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [é…ç½®ç®¡ç†æ¦‚è¿°](#1-é…ç½®ç®¡ç†æ¦‚è¿°)
2. [é…ç½®åˆ†å±‚ç®¡ç†ç­–ç•¥](#2-é…ç½®åˆ†å±‚ç®¡ç†ç­–ç•¥)
3. [æ•æ„Ÿä¿¡æ¯å¤„ç†æ–¹æ¡ˆ](#3-æ•æ„Ÿä¿¡æ¯å¤„ç†æ–¹æ¡ˆ)
4. [é…ç½®å˜æ›´é€šçŸ¥æœºåˆ¶](#4-é…ç½®å˜æ›´é€šçŸ¥æœºåˆ¶)
5. [é…ç½®å®¡è®¡ä¸è¿½è¸ª](#5-é…ç½®å®¡è®¡ä¸è¿½è¸ª)
6. [é»˜è®¤å€¼ç­–ç•¥è®¾è®¡](#6-é»˜è®¤å€¼ç­–ç•¥è®¾è®¡)
7. [é…ç½®éªŒè¯æœºåˆ¶](#7-é…ç½®éªŒè¯æœºåˆ¶)
8. [çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ](#8-çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ)
9. [å®é™…åº”ç”¨åœºæ™¯](#9-å®é™…åº”ç”¨åœºæ™¯)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡é…ç½®ç®¡ç†


> ğŸ’¡ **é€šä¿—ç†è§£**  
> æƒ³è±¡ä¸€ä¸‹å¼€é¥­åº—ï¼Œæ¯å®¶åˆ†åº—éƒ½éœ€è¦çŸ¥é“èœå•ä»·æ ¼ã€è¥ä¸šæ—¶é—´ã€å‘˜å·¥æ•°é‡ç­‰ä¿¡æ¯ã€‚å¦‚æœæ€»éƒ¨è¦è°ƒæ•´ä»·æ ¼ï¼Œä¸å¯èƒ½ä¸€å®¶å®¶é€šçŸ¥ã€‚é…ç½®ç®¡ç†å°±åƒæ˜¯æ€»éƒ¨çš„"é€šçŸ¥ç³»ç»Ÿ"ï¼Œèƒ½ç»Ÿä¸€ç®¡ç†æ‰€æœ‰åˆ†åº—çš„è®¾ç½®ï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶æ›´æ–°ã€‚

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
é…ç½®ç®¡ç† = ç»Ÿä¸€å­˜å‚¨ + åŠ¨æ€æ›´æ–° + å®‰å…¨æ§åˆ¶
ç›®çš„ï¼šè®©å¾®æœåŠ¡èƒ½å¤Ÿçµæ´»ã€å®‰å…¨åœ°è·å–å’Œæ›´æ–°é…ç½®ä¿¡æ¯
å¥½å¤„ï¼šé¿å…ç¡¬ç¼–ç ï¼Œæ”¯æŒä¸åŒç¯å¢ƒï¼Œä¾¿äºè¿ç»´ç®¡ç†
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç®¡ç†


**ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**ï¼š

```
é—®é¢˜åœºæ™¯ï¼š
âŒ æ•°æ®åº“è¿æ¥ä¿¡æ¯å†™æ­»åœ¨ä»£ç é‡Œ
âŒ ä¸åŒç¯å¢ƒéœ€è¦é‡æ–°æ‰“åŒ…éƒ¨ç½²
âŒ é…ç½®ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡
âŒ æ•æ„Ÿä¿¡æ¯æš´éœ²åœ¨é…ç½®æ–‡ä»¶ä¸­
```

**é…ç½®ç®¡ç†çš„ä»·å€¼**ï¼š

| ä¼ ç»Ÿæ–¹å¼ | é…ç½®ç®¡ç†æ–¹å¼ | **æ”¹è¿›æ•ˆæœ** |
|---------|-------------|-------------|
| `ç¡¬ç¼–ç é…ç½®` | `å¤–éƒ¨åŒ–é…ç½®` | `ä»£ç ä¸é…ç½®åˆ†ç¦»` |
| `æ‰‹åŠ¨ä¿®æ”¹é‡å¯` | `åŠ¨æ€åˆ·æ–°` | `é›¶åœæœºæ—¶é—´æ›´æ–°` |
| `æ˜æ–‡å­˜å‚¨å¯†ç ` | `åŠ å¯†å­˜å‚¨` | `å®‰å…¨æ€§å¤§å¹…æå‡` |
| `ç¯å¢ƒæ··ä¹±` | `åˆ†å±‚ç®¡ç†` | `æ¸…æ™°çš„ç¯å¢ƒéš”ç¦»` |

---

## 2. ğŸ“Š é…ç½®åˆ†å±‚ç®¡ç†ç­–ç•¥


### 2.1 åˆ†å±‚ç®¡ç†çš„åŸºæœ¬æ€è·¯


> ğŸ­ **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒç©¿è¡£æœä¸€æ ·ï¼šå†…è¡£(åŸºç¡€é…ç½®) â†’ è¡¬è¡«(ç¯å¢ƒé…ç½®) â†’ å¤–å¥—(åº”ç”¨é…ç½®) â†’ å›´å·¾(ä¸´æ—¶é…ç½®)ã€‚æ¯ä¸€å±‚éƒ½æœ‰è‡ªå·±çš„ä½œç”¨ï¼Œå¤–å±‚å¯ä»¥è¦†ç›–å†…å±‚ã€‚

**ğŸ”¸ å››å±‚é…ç½®æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åº”ç”¨ç‰¹å®šé…ç½® (æœ€é«˜ä¼˜å…ˆçº§)         â”‚  â† å•ä¸ªæœåŠ¡çš„ä¸ªæ€§åŒ–é…ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             ç¯å¢ƒé…ç½®                    â”‚  â† dev/test/prod ç¯å¢ƒå·®å¼‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            å…¬å…±é…ç½®                     â”‚  â† å¤šä¸ªæœåŠ¡å…±äº«çš„é…ç½®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          é»˜è®¤é…ç½® (æœ€ä½ä¼˜å…ˆçº§)           â”‚  â† å…œåº•çš„åŸºç¡€é…ç½®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜å…ˆçº§ï¼šåº”ç”¨ç‰¹å®š > ç¯å¢ƒé…ç½® > å…¬å…±é…ç½® > é»˜è®¤é…ç½®
```

### 2.2 å®é™…åˆ†å±‚ç¤ºä¾‹


**ğŸ’» Spring Cloud Config åˆ†å±‚å®ç°**

```yaml
# é»˜è®¤é…ç½® (application.yml)
server:
  port: 8080
logging:
  level:
    root: INFO

# å…¬å…±é…ç½® (application-common.yml)  
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
  redis:
    timeout: 3000ms

# ç¯å¢ƒé…ç½® (application-prod.yml)
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/business
  redis:
    host: prod-redis
    
# åº”ç”¨ç‰¹å®šé…ç½® (user-service-prod.yml)
spring:
  datasource:
    pool-size: 50
business:
  user:
    cache-expire: 3600
```

### 2.3 åˆ†å±‚ç®¡ç†çš„æœ€ä½³å®è·µ


**ğŸ¯ é…ç½®åˆ†ç±»åŸåˆ™**

> âš ï¸ **åˆ’åˆ†å»ºè®®**  
> - **é»˜è®¤é…ç½®**ï¼šæ‰€æœ‰æœåŠ¡éƒ½èƒ½ç”¨çš„é€šç”¨è®¾ç½®
> - **å…¬å…±é…ç½®**ï¼šæŸä¸€ç±»æœåŠ¡å…±äº«çš„é…ç½®  
> - **ç¯å¢ƒé…ç½®**ï¼šä¸åŒéƒ¨ç½²ç¯å¢ƒçš„å·®å¼‚é…ç½®
> - **åº”ç”¨é…ç½®**ï¼šå•ä¸ªæœåŠ¡çš„ä¸ªæ€§åŒ–é…ç½®

**ğŸ”§ å‘½åè§„èŒƒç¤ºä¾‹**

```
é…ç½®æ–‡ä»¶å‘½åè§„èŒƒï¼š
â”œâ”€â”€ application.yml              # é»˜è®¤é…ç½®
â”œâ”€â”€ application-{profile}.yml    # ç¯å¢ƒé…ç½®
â”œâ”€â”€ {service-name}.yml          # æœåŠ¡å…¬å…±é…ç½®  
â””â”€â”€ {service-name}-{profile}.yml # æœåŠ¡ç¯å¢ƒé…ç½®

å®é™…ç¤ºä¾‹ï¼š
â”œâ”€â”€ application.yml              # åŸºç¡€é…ç½®
â”œâ”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ user-service.yml            # ç”¨æˆ·æœåŠ¡å…¬å…±é…ç½®
â””â”€â”€ user-service-prod.yml       # ç”¨æˆ·æœåŠ¡ç”Ÿäº§é…ç½®
```

---

## 3. ğŸ” æ•æ„Ÿä¿¡æ¯å¤„ç†æ–¹æ¡ˆ


### 3.1 æ•æ„Ÿä¿¡æ¯çš„è¯†åˆ«


> âš ï¸ **å®‰å…¨æé†’**  
> æ•æ„Ÿä¿¡æ¯å°±åƒå®¶é‡Œçš„é’¥åŒ™ï¼Œç»å¯¹ä¸èƒ½éšä¾¿æ”¾åœ¨é—¨å«ä¸‹é¢ã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œè¿™äº›"é’¥åŒ™"åŒ…æ‹¬å¯†ç ã€å¯†é’¥ã€ä»¤ç‰Œç­‰ï¼Œéœ€è¦ç‰¹æ®Šä¿æŠ¤ã€‚

**ğŸ” å¸¸è§æ•æ„Ÿä¿¡æ¯ç±»å‹**

```
æ•°æ®åº“ç›¸å…³ï¼š
âœ“ æ•°æ®åº“å¯†ç 
âœ“ è¿æ¥å­—ç¬¦ä¸²ä¸­çš„å‡­æ®
âœ“ æ•°æ®åº“åŠ å¯†å¯†é’¥

å¤–éƒ¨æœåŠ¡ï¼š  
âœ“ APIå¯†é’¥ (å¦‚æ”¯ä»˜å®ã€å¾®ä¿¡API)
âœ“ OAuthå®¢æˆ·ç«¯å¯†é’¥
âœ“ ç¬¬ä¸‰æ–¹æœåŠ¡token

ç³»ç»Ÿå®‰å…¨ï¼š
âœ“ JWTç­¾åå¯†é’¥  
âœ“ åŠ å¯†/è§£å¯†å¯†é’¥
âœ“ SSLè¯ä¹¦ç§é’¥
```

### 3.2 åŠ å¯†å­˜å‚¨æ–¹æ¡ˆ


**ğŸ”’ å¯¹ç§°åŠ å¯†å®ç°**

```java
@Component
public class ConfigEncryption {
    
    // ä½¿ç”¨AESåŠ å¯†é…ç½®å€¼
    public String encrypt(String plainText, String key) {
        // å®é™…é¡¹ç›®ä¸­keyåº”è¯¥ä»å®‰å…¨çš„åœ°æ–¹è·å–
        try {
            Cipher cipher = Cipher.getInstance("AES");
            SecretKeySpec secretKey = new SecretKeySpec(
                key.getBytes(), "AES");
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            
            byte[] encrypted = cipher.doFinal(plainText.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }
    
    // è§£å¯†é…ç½®å€¼
    public String decrypt(String encryptedText, String key) {
        // è§£å¯†é€»è¾‘
        // ...
    }
}
```

**ğŸ“ é…ç½®æ–‡ä»¶ä¸­çš„ä½¿ç”¨**

```yaml
# æ˜æ–‡é…ç½® (ä¸æ¨è)
spring:
  datasource:
    password: admin123

# åŠ å¯†é…ç½® (æ¨è)  
spring:
  datasource:
    password: '{cipher}AgAhG8+12dEd...'  # åŠ å¯†åçš„å¯†ç 
    
# ä½¿ç”¨å ä½ç¬¦
spring:
  datasource:
    password: '${DB_PASSWORD:defaultpass}'  # ä»ç¯å¢ƒå˜é‡è·å–
```

### 3.3 å¤–éƒ¨å¯†é’¥ç®¡ç†


**ğŸª é›†æˆå¤–éƒ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿ**

```
å¸¸ç”¨çš„å¯†é’¥ç®¡ç†è§£å†³æ–¹æ¡ˆï¼š

äº‘æœåŠ¡å•†æ–¹æ¡ˆï¼š
â”œâ”€â”€ AWS Secrets Manager
â”œâ”€â”€ Azure Key Vault  
â”œâ”€â”€ é˜¿é‡Œäº‘å¯†é’¥ç®¡ç†æœåŠ¡
â””â”€â”€ è…¾è®¯äº‘å¯†é’¥ç®¡ç†ç³»ç»Ÿ

å¼€æºæ–¹æ¡ˆï¼š
â”œâ”€â”€ HashiCorp Vault  â† æœ€å—æ¬¢è¿
â”œâ”€â”€ Kubernetes Secrets
â””â”€â”€ Docker Secrets
```

**ğŸ’¡ HashiCorp Vault é›†æˆç¤ºä¾‹**

```java
@Service
public class VaultConfigService {
    
    @Value("${vault.server.url}")
    private String vaultUrl;
    
    // ä»Vaultè·å–æ•°æ®åº“å¯†ç 
    public String getDatabasePassword() {
        VaultTemplate vaultTemplate = new VaultTemplate(
            VaultEndpoint.create(vaultUrl), 
            new TokenAuthentication("vault-token")
        );
        
        VaultResponse response = vaultTemplate.read("secret/database");
        return response.getData().get("password").toString();
    }
}
```

---

## 4. ğŸ”” é…ç½®å˜æ›´é€šçŸ¥æœºåˆ¶


### 4.1 æ¨é€ vs æ‹‰å–æ¨¡å¼


> ğŸ“± **æ‰‹æœºç±»æ¯”**  
> æ¨é€æ¨¡å¼åƒå¾®ä¿¡æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€ç»™ä½ ï¼›æ‹‰å–æ¨¡å¼åƒåˆ·æœ‹å‹åœˆï¼Œä½ ä¸»åŠ¨å»è·å–æœ€æ–°å†…å®¹ã€‚ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ã€‚

**ğŸ“Š æ¨¡å¼å¯¹æ¯”åˆ†æ**

| é€šçŸ¥æ–¹å¼ | **å·¥ä½œåŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|---------|----------|-------------|
| ğŸ”” **æ¨é€æ¨¡å¼** | `é…ç½®ä¸­å¿ƒä¸»åŠ¨é€šçŸ¥` | `å®æ—¶æ€§å¥½ï¼Œèµ„æºæ¶ˆè€—ä½` | `éœ€è¦ç»´æŠ¤è¿æ¥çŠ¶æ€` | `é…ç½®å˜æ›´é¢‘ç¹` |
| ğŸ”„ **æ‹‰å–æ¨¡å¼** | `æœåŠ¡å®šæœŸæŸ¥è¯¢` | `å®ç°ç®€å•ï¼Œç¨³å®šæ€§å¥½` | `æœ‰å»¶è¿Ÿï¼Œèµ„æºæ¶ˆè€—é«˜` | `é…ç½®å˜æ›´è¾ƒå°‘` |
| ğŸ”€ **æ··åˆæ¨¡å¼** | `æ¨é€+æ‹‰å–ç»“åˆ` | `å…¼å…·ä¸¤è€…ä¼˜ç‚¹` | `å¤æ‚åº¦è¾ƒé«˜` | `ç”Ÿäº§ç¯å¢ƒæ¨è` |

### 4.2 Spring Cloud Bus å®ç°æ¨é€


**ğŸšŒ æ¶ˆæ¯æ€»çº¿æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     æ¶ˆæ¯æ€»çº¿     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®ä¸­å¿ƒ   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   æœåŠ¡å®ä¾‹A   â”‚
â”‚ Config Serverâ”‚                 â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                â”‚
        â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   æœåŠ¡å®ä¾‹B   â”‚â†â”€â”€â”€â”€â”€â”€â”˜
                 â”‚              â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’» ä»£ç å®ç°ç¤ºä¾‹**

```java
// é…ç½®å˜æ›´ç›‘å¬å™¨
@Component
public class ConfigChangeListener {
    
    private static final Logger logger = 
        LoggerFactory.getLogger(ConfigChangeListener.class);
    
    // ç›‘å¬é…ç½®åˆ·æ–°äº‹ä»¶
    @EventListener
    public void onConfigChange(RefreshRemoteApplicationEvent event) {
        logger.info("æ”¶åˆ°é…ç½®å˜æ›´é€šçŸ¥ï¼Œæ¥æºæœåŠ¡: {}", 
                   event.getOriginService());
        
        // æ‰§è¡Œè‡ªå®šä¹‰çš„é…ç½®å˜æ›´å¤„ç†é€»è¾‘
        handleConfigChange();
    }
    
    private void handleConfigChange() {
        // 1. æ¸…ç†ç›¸å…³ç¼“å­˜
        // 2. é‡æ–°åˆå§‹åŒ–æŸäº›ç»„ä»¶  
        // 3. è®°å½•å˜æ›´æ—¥å¿—
        logger.info("é…ç½®å˜æ›´å¤„ç†å®Œæˆ");
    }
}

// æ‰‹åŠ¨è§¦å‘é…ç½®åˆ·æ–°
@RestController
public class ConfigController {
    
    @Autowired
    private ContextRefresher contextRefresher;
    
    @PostMapping("/actuator/refresh")
    public Set<String> refresh() {
        // æ‰‹åŠ¨åˆ·æ–°é…ç½®
        return contextRefresher.refresh();
    }
}
```

### 4.3 WebHook æœºåˆ¶å®ç°


**ğŸ”— WebHook é…ç½®å˜æ›´é€šçŸ¥**

```java
@RestController
public class ConfigWebHookController {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    // Gitä»“åº“é…ç½®å˜æ›´æ—¶çš„å›è°ƒæ¥å£
    @PostMapping("/webhook/config-change")
    public ResponseEntity<String> handleConfigChange(
            @RequestBody GitWebHookPayload payload) {
        
        logger.info("æ”¶åˆ°Gité…ç½®å˜æ›´é€šçŸ¥: {}", payload.getCommitId());
        
        // è§¦å‘é…ç½®é‡æ–°åŠ è½½
        eventPublisher.publishEvent(
            new ConfigChangeEvent(payload.getChangedFiles())
        );
        
        return ResponseEntity.ok("é…ç½®å˜æ›´å¤„ç†æˆåŠŸ");
    }
}

// è‡ªå®šä¹‰é…ç½®å˜æ›´äº‹ä»¶
public class ConfigChangeEvent extends ApplicationEvent {
    private final List<String> changedFiles;
    
    public ConfigChangeEvent(Object source, List<String> changedFiles) {
        super(source);
        this.changedFiles = changedFiles;
    }
    
    // getter methods...
}
```

---

## 5. ğŸ“‹ é…ç½®å®¡è®¡ä¸è¿½è¸ª


### 5.1 å®¡è®¡çš„é‡è¦æ€§


> ğŸ•µï¸ **ä¾¦æ¢æ€ç»´**  
> å®¡è®¡å°±åƒç»™é…ç½®å˜æ›´è£…ä¸Š"è¡Œè½¦è®°å½•ä»ª"ï¼Œè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™æ”¹äº†ä»€ä¹ˆé…ç½®ã€‚å½“ç³»ç»Ÿå‡ºé—®é¢˜æ—¶ï¼Œèƒ½å¿«é€Ÿå®šä½æ˜¯ä¸æ˜¯é…ç½®å˜æ›´å¼•èµ·çš„ã€‚

**ğŸ¯ å®¡è®¡éœ€è¦è®°å½•çš„ä¿¡æ¯**

```
åŸºæœ¬ä¿¡æ¯ï¼š
âœ“ å˜æ›´æ—¶é—´ (ä»€ä¹ˆæ—¶å€™)
âœ“ å˜æ›´äººå‘˜ (è°æ”¹çš„)  
âœ“ å˜æ›´å†…å®¹ (æ”¹äº†ä»€ä¹ˆ)
âœ“ å˜æ›´åŸå›  (ä¸ºä»€ä¹ˆæ”¹)

è¯¦ç»†ä¿¡æ¯ï¼š
âœ“ å˜æ›´å‰çš„å€¼
âœ“ å˜æ›´åçš„å€¼
âœ“ å˜æ›´çš„é…ç½®é¡¹è·¯å¾„
âœ“ å½±å“çš„æœåŠ¡å®ä¾‹

æ“ä½œä¿¡æ¯ï¼š
âœ“ å˜æ›´æ–¹å¼ (ç•Œé¢/API/Git)
âœ“ å˜æ›´æ‰¹æ¬¡ (æ‰¹é‡å˜æ›´çš„æ ‡è¯†)
âœ“ å˜æ›´çŠ¶æ€ (æˆåŠŸ/å¤±è´¥/å›æ»š)
```

### 5.2 å®¡è®¡æ—¥å¿—è®¾è®¡


**ğŸ“ å®¡è®¡æ—¥å¿—æ•°æ®ç»“æ„**

```java
@Entity
public class ConfigAuditLog {
    @Id
    private String id;
    
    private String configKey;      // é…ç½®é¡¹è·¯å¾„
    private String oldValue;       // å˜æ›´å‰çš„å€¼
    private String newValue;       // å˜æ›´åçš„å€¼
    
    private String operator;       // æ“ä½œäººå‘˜
    private String operatorIp;     // æ“ä½œIP
    private Date changeTime;       // å˜æ›´æ—¶é—´
    
    private String changeReason;   // å˜æ›´åŸå› 
    private String batchId;        // æ‰¹æ¬¡æ ‡è¯†
    private String operation;      // æ“ä½œç±»å‹: CREATE/UPDATE/DELETE
    
    // getter/setter methods...
}

// å®¡è®¡æ—¥å¿—æœåŠ¡
@Service
public class ConfigAuditService {
    
    public void logConfigChange(String configKey, String oldValue, 
                               String newValue, String operator) {
        ConfigAuditLog log = new ConfigAuditLog();
        log.setId(UUID.randomUUID().toString());
        log.setConfigKey(configKey);
        log.setOldValue(oldValue);
        log.setNewValue(newValue);
        log.setOperator(operator);
        log.setChangeTime(new Date());
        log.setOperatorIp(getCurrentUserIp());
        
        // å¼‚æ­¥ä¿å­˜å®¡è®¡æ—¥å¿—ï¼Œé¿å…å½±å“æ€§èƒ½
        auditLogRepository.save(log);
    }
}
```

### 5.3 å˜æ›´è¿½è¸ªæŸ¥è¯¢


**ğŸ” å®¡è®¡æŸ¥è¯¢æ¥å£**

```java
@RestController
public class ConfigAuditController {
    
    // æŸ¥è¯¢é…ç½®é¡¹çš„å˜æ›´å†å²
    @GetMapping("/audit/config/{configKey}/history")
    public List<ConfigAuditLog> getConfigHistory(
            @PathVariable String configKey,
            @RequestParam(defaultValue = "30") int days) {
        
        Date startDate = Date.from(Instant.now().minus(days, ChronoUnit.DAYS));
        return auditService.findByConfigKeyAndChangeTimeAfter(configKey, startDate);
    }
    
    // æŸ¥è¯¢æŸä¸ªæ—¶é—´æ®µçš„æ‰€æœ‰å˜æ›´
    @GetMapping("/audit/changes")
    public List<ConfigAuditLog> getChangesByTimeRange(
            @RequestParam String startTime,
            @RequestParam String endTime) {
        
        return auditService.findByTimeRange(
            parseTime(startTime), parseTime(endTime)
        );
    }
}
```

---

## 6. ğŸ¯ é»˜è®¤å€¼ç­–ç•¥è®¾è®¡


### 6.1 é»˜è®¤å€¼çš„ä½œç”¨


> ğŸ  **è£…ä¿®ç±»æ¯”**  
> é»˜è®¤å€¼å°±åƒæ¯›å¯æˆ¿çš„åŸºç¡€è£…ä¿®ï¼Œè™½ç„¶ç®€å•ä½†èƒ½ç¡®ä¿"å¯ä»¥ä½äºº"ã€‚å³ä½¿æ²¡æœ‰ä¸ªæ€§åŒ–é…ç½®ï¼Œç³»ç»Ÿä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå› ä¸ºç¼ºå°‘é…ç½®è€Œå´©æºƒã€‚

**ğŸ”¸ é»˜è®¤å€¼çš„ä»·å€¼**

```
ç³»ç»Ÿç¨³å®šæ€§ï¼š
âœ“ é˜²æ­¢é…ç½®ç¼ºå¤±å¯¼è‡´å¯åŠ¨å¤±è´¥
âœ“ é™ä½æ–°ç¯å¢ƒéƒ¨ç½²çš„å¤æ‚åº¦
âœ“ æä¾›é…ç½®çš„æœ€å°å¯ç”¨é›†åˆ

å¼€å‘ä½“éªŒï¼š
âœ“ æ–°å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹
âœ“ å‡å°‘ç¯å¢ƒæ­å»ºæ—¶é—´
âœ“ é™ä½é…ç½®é”™è¯¯æ¦‚ç‡
```

### 6.2 åˆ†çº§é»˜è®¤å€¼ç­–ç•¥


**ğŸ“Š ä¸‰çº§é»˜è®¤å€¼ä½“ç³»**

```java
@Component
@ConfigurationProperties(prefix = "business.user")
public class UserServiceConfig {
    
    // ç¬¬ä¸€çº§ï¼šç¡¬ç¼–ç é»˜è®¤å€¼ï¼ˆå…œåº•ï¼‰
    private int cacheExpire = 1800;  // 30åˆ†é’Ÿ
    private int maxConnections = 100;
    private boolean enableCache = true;
    
    // ç¬¬äºŒçº§ï¼šé…ç½®æ–‡ä»¶é»˜è®¤å€¼
    @Value("${business.user.cache-expire:3600}")  // 1å°æ—¶
    private int configCacheExpire;
    
    // ç¬¬ä¸‰çº§ï¼šç¯å¢ƒå˜é‡é»˜è®¤å€¼  
    @Value("${USER_CACHE_EXPIRE:${business.user.cache-expire:1800}}")
    private int finalCacheExpire;
    
    // getter/setter methods...
}
```

**ğŸ”„ é»˜è®¤å€¼ä¼˜å…ˆçº§**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç¯å¢ƒå˜é‡ (æœ€é«˜ä¼˜å…ˆçº§)              â”‚  â† USER_CACHE_EXPIRE=7200
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        é…ç½®æ–‡ä»¶                          â”‚  â† business.user.cache-expire: 3600
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        æ³¨è§£é»˜è®¤å€¼                        â”‚  â† @Value("....:1800")
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ç¡¬ç¼–ç é»˜è®¤å€¼ (æœ€ä½ä¼˜å…ˆçº§)          â”‚  â† private int cacheExpire = 1800;
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 æ™ºèƒ½é»˜è®¤å€¼é€‰æ‹©


**ğŸ§  åŸºäºç¯å¢ƒçš„é»˜è®¤å€¼**

```java
@Configuration
public class EnvironmentAwareConfig {
    
    @Value("${spring.profiles.active:dev}")
    private String activeProfile;
    
    @Bean
    @ConfigurationProperties(prefix = "database")
    public DatabaseConfig databaseConfig() {
        DatabaseConfig config = new DatabaseConfig();
        
        // æ ¹æ®ç¯å¢ƒè®¾ç½®ä¸åŒçš„é»˜è®¤å€¼
        if ("prod".equals(activeProfile)) {
            config.setConnectionPoolSize(50);
            config.setConnectionTimeout(5000);
            config.setIdleTimeout(600000);  // 10åˆ†é’Ÿ
        } else if ("test".equals(activeProfile)) {
            config.setConnectionPoolSize(10);
            config.setConnectionTimeout(3000);
            config.setIdleTimeout(300000);  // 5åˆ†é’Ÿ
        } else {  // devç¯å¢ƒ
            config.setConnectionPoolSize(5);
            config.setConnectionTimeout(1000);
            config.setIdleTimeout(60000);   // 1åˆ†é’Ÿ
        }
        
        return config;
    }
}
```

---

## 7. âœ… é…ç½®éªŒè¯æœºåˆ¶


### 7.1 é…ç½®éªŒè¯çš„å¿…è¦æ€§


> ğŸ›¡ï¸ **è´¨æ£€å‘˜æ€ç»´**  
> é…ç½®éªŒè¯å°±åƒå·¥å‚çš„è´¨æ£€å‘˜ï¼Œç¡®ä¿"äº§å“"(é…ç½®)ç¬¦åˆæ ‡å‡†å†æŠ•å…¥ä½¿ç”¨ã€‚é”™è¯¯çš„é…ç½®å¯èƒ½å¯¼è‡´æœåŠ¡å´©æºƒï¼ŒéªŒè¯èƒ½æå‰å‘ç°é—®é¢˜ã€‚

**âš ï¸ å¸¸è§é…ç½®é”™è¯¯**

```
æ ¼å¼é”™è¯¯ï¼š
âŒ ç«¯å£å·ä¸æ˜¯æ•°å­—
âŒ å¸ƒå°”å€¼å†™æˆå­—ç¬¦ä¸²
âŒ æ—¶é—´æ ¼å¼ä¸æ­£ç¡®

é€»è¾‘é”™è¯¯ï¼š
âŒ è¶…æ—¶æ—¶é—´è®¾ç½®ä¸ºè´Ÿæ•°
âŒ è¿æ¥æ± å¤§å°ä¸º0
âŒ ç¼“å­˜æ—¶é—´æ¯”æ•°æ®åº“è¿æ¥è¶…æ—¶è¿˜é•¿

ä¾èµ–é”™è¯¯ï¼š
âŒ æ•°æ®åº“åœ°å€æ— æ³•è¿æ¥
âŒ RedisæœåŠ¡ä¸å¯è¾¾
âŒ å¤–éƒ¨APIå¯†é’¥æ— æ•ˆ
```

### 7.2 åŸºç¡€é…ç½®éªŒè¯


**ğŸ”§ ä½¿ç”¨JSR-303æ³¨è§£éªŒè¯**

```java
@Component
@ConfigurationProperties(prefix = "business.payment")
@Validated  // å¯ç”¨éªŒè¯
public class PaymentConfig {
    
    @NotBlank(message = "æ”¯ä»˜ç½‘å…³URLä¸èƒ½ä¸ºç©º")
    @URL(message = "æ”¯ä»˜ç½‘å…³URLæ ¼å¼ä¸æ­£ç¡®")
    private String gatewayUrl;
    
    @Min(value = 1000, message = "è¶…æ—¶æ—¶é—´ä¸èƒ½å°‘äº1ç§’")
    @Max(value = 30000, message = "è¶…æ—¶æ—¶é—´ä¸èƒ½è¶…è¿‡30ç§’")
    private int timeoutMs = 5000;
    
    @NotBlank(message = "å•†æˆ·IDä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^[A-Z0-9]{8,16}$", 
             message = "å•†æˆ·IDå¿…é¡»æ˜¯8-16ä½å¤§å†™å­—æ¯å’Œæ•°å­—")
    private String merchantId;
    
    @DecimalMin(value = "0.01", message = "æœ€å°æ”¯ä»˜é‡‘é¢ä¸èƒ½ä½äº0.01å…ƒ")
    @DecimalMax(value = "50000.00", message = "æœ€å¤§æ”¯ä»˜é‡‘é¢ä¸èƒ½è¶…è¿‡5ä¸‡å…ƒ")
    private BigDecimal maxAmount;
    
    // getter/setter methods...
}
```

### 7.3 è‡ªå®šä¹‰é…ç½®éªŒè¯å™¨


**ğŸ” ä¸šåŠ¡é€»è¾‘éªŒè¯**

```java
// è‡ªå®šä¹‰éªŒè¯æ³¨è§£
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = DatabaseConfigValidator.class)
public @interface ValidDatabaseConfig {
    String message() default "æ•°æ®åº“é…ç½®éªŒè¯å¤±è´¥";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

// éªŒè¯å™¨å®ç°
public class DatabaseConfigValidator 
        implements ConstraintValidator<ValidDatabaseConfig, DatabaseConfig> {
    
    @Override
    public boolean isValid(DatabaseConfig config, 
                          ConstraintValidatorContext context) {
        
        List<String> errors = new ArrayList<>();
        
        // éªŒè¯è¿æ¥æ± é…ç½®çš„åˆç†æ€§
        if (config.getMaxPoolSize() < config.getMinPoolSize()) {
            errors.add("æœ€å¤§è¿æ¥æ•°ä¸èƒ½å°äºæœ€å°è¿æ¥æ•°");
        }
        
        // éªŒè¯è¶…æ—¶é…ç½®çš„åˆç†æ€§
        if (config.getConnectionTimeout() > config.getSocketTimeout()) {
            errors.add("è¿æ¥è¶…æ—¶ä¸åº”è¯¥å¤§äºè¯»å–è¶…æ—¶");
        }
        
        // éªŒè¯æ•°æ®åº“è¿æ¥æ˜¯å¦å¯ç”¨
        if (!isConnectionValid(config)) {
            errors.add("æ— æ³•è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨");
        }
        
        if (!errors.isEmpty()) {
            context.disableDefaultConstraintViolation();
            for (String error : errors) {
                context.buildConstraintViolationWithTemplate(error)
                       .addConstraintViolation();
            }
            return false;
        }
        
        return true;
    }
    
    private boolean isConnectionValid(DatabaseConfig config) {
        // å®é™…çš„è¿æ¥æµ‹è¯•é€»è¾‘
        try (Connection conn = DriverManager.getConnection(
                config.getUrl(), config.getUsername(), config.getPassword())) {
            return conn.isValid(3);  // 3ç§’è¶…æ—¶æµ‹è¯•
        } catch (SQLException e) {
            return false;
        }
    }
}
```

---

## 8. ğŸ”„ çƒ­æ›´æ–°å®ç°æ–¹æ¡ˆ


### 8.1 çƒ­æ›´æ–°çš„æ¦‚å¿µ


> ğŸ­ **æ¢è£…è¡¨æ¼”ç±»æ¯”**  
> çƒ­æ›´æ–°å°±åƒé­”æœ¯å¸ˆçš„æ¢è£…è¡¨æ¼”ï¼Œä¸åœæ­¢è¡¨æ¼”çš„æƒ…å†µä¸‹æ›´æ¢æœè£…ã€‚ç³»ç»Ÿä¸åœæœºçš„æƒ…å†µä¸‹æ›´æ–°é…ç½®ï¼Œç”¨æˆ·å®Œå…¨æ„ŸçŸ¥ä¸åˆ°å˜åŒ–ã€‚

**ğŸ¯ çƒ­æ›´æ–°çš„æŒ‘æˆ˜**

```
æŠ€æœ¯æŒ‘æˆ˜ï¼š
â€¢ å¦‚ä½•ä¿è¯é…ç½®æ›´æ–°çš„åŸå­æ€§ï¼Ÿ
â€¢ å¦‚ä½•å¤„ç†æ›´æ–°å¤±è´¥çš„å›æ»šï¼Ÿ
â€¢ å¦‚ä½•ç¡®ä¿å¤šå®ä¾‹çš„é…ç½®ä¸€è‡´æ€§ï¼Ÿ

ä¸šåŠ¡æŒ‘æˆ˜ï¼š
â€¢ å“ªäº›é…ç½®å¯ä»¥çƒ­æ›´æ–°ï¼Ÿ
â€¢ å“ªäº›é…ç½®éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼Ÿ
â€¢ å¦‚ä½•å¤„ç†æ­£åœ¨è¿›è¡Œçš„ä¸šåŠ¡æ“ä½œï¼Ÿ
```

### 8.2 Spring Cloud Config çƒ­åˆ·æ–°


**ğŸ”§ åŸºç¡€çƒ­åˆ·æ–°å®ç°**

```java
@RestController
@RefreshScope  // é‡è¦ï¼šå¯ç”¨åˆ·æ–°åŠŸèƒ½
public class BusinessController {
    
    @Value("${business.discount.rate:0.1}")
    private double discountRate;
    
    @Value("${business.promotion.message:æ¬¢è¿ä½¿ç”¨}")
    private String promotionMessage;
    
    @GetMapping("/config/info")
    public Map<String, Object> getCurrentConfig() {
        Map<String, Object> info = new HashMap<>();
        info.put("discountRate", discountRate);
        info.put("promotionMessage", promotionMessage);
        info.put("updateTime", new Date());
        return info;
    }
}

// é…ç½®å˜æ›´ç›‘å¬å™¨
@Component
public class ConfigRefreshListener {
    
    @EventListener
    public void handleRefreshEvent(RefreshEvent event) {
        logger.info("é…ç½®åˆ·æ–°å®Œæˆï¼Œåˆ·æ–°çš„é…ç½®é¡¹æ•°é‡: {}", 
                   event.getKeys().size());
        
        // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›é¢å¤–çš„å¤„ç†
        // æ¯”å¦‚æ¸…é™¤ç¼“å­˜ã€é‡æ–°åˆå§‹åŒ–æŸäº›ç»„ä»¶ç­‰
        clearRelatedCache();
    }
    
    private void clearRelatedCache() {
        // æ¸…é™¤ç›¸å…³ç¼“å­˜çš„é€»è¾‘
    }
}
```

### 8.3 é«˜çº§çƒ­æ›´æ–°ç­–ç•¥


**ğŸš€ åˆ†çº§çƒ­æ›´æ–°æœºåˆ¶**

```java
@Component
public class SmartConfigManager {
    
    // å¯ä»¥çƒ­æ›´æ–°çš„é…ç½®ç±»å‹
    private static final Set<String> HOT_UPDATEABLE_CONFIGS = Set.of(
        "business.discount",
        "business.promotion", 
        "business.feature.flags",
        "logging.level"
    );
    
    // éœ€è¦é‡å¯çš„é…ç½®ç±»å‹
    private static final Set<String> RESTART_REQUIRED_CONFIGS = Set.of(
        "server.port",
        "spring.datasource.url",
        "spring.datasource.username"
    );
    
    @EventListener
    public void handleConfigChange(ConfigChangeEvent event) {
        
        for (String changedKey : event.getChangedKeys()) {
            
            if (isHotUpdateable(changedKey)) {
                // çƒ­æ›´æ–°
                logger.info("é…ç½® {} æ”¯æŒçƒ­æ›´æ–°ï¼Œç«‹å³ç”Ÿæ•ˆ", changedKey);
                applyHotUpdate(changedKey, event.getNewValue(changedKey));
                
            } else if (requiresRestart(changedKey)) {
                // éœ€è¦é‡å¯
                logger.warn("é…ç½® {} éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ", changedKey);
                scheduleRestart(changedKey);
                
            } else {
                // å»¶è¿Ÿç”Ÿæ•ˆ
                logger.info("é…ç½® {} å°†åœ¨ä¸‹æ¬¡é‡å¯æ—¶ç”Ÿæ•ˆ", changedKey);
            }
        }
    }
    
    private boolean isHotUpdateable(String configKey) {
        return HOT_UPDATEABLE_CONFIGS.stream()
               .anyMatch(configKey::startsWith);
    }
    
    private void applyHotUpdate(String key, String newValue) {
        // å…·ä½“çš„çƒ­æ›´æ–°é€»è¾‘
        // å¯èƒ½åŒ…æ‹¬ï¼šæ›´æ–°ç¼“å­˜ã€é€šçŸ¥ç›¸å…³ç»„ä»¶ã€è®°å½•æ—¥å¿—ç­‰
    }
}
```

**ğŸ¯ ä¼˜é›…çš„é…ç½®åˆ‡æ¢**

```java
@Service
public class GracefulConfigSwitcher {
    
    @Autowired
    private BusinessService businessService;
    
    // ä¼˜é›…åœ°åˆ‡æ¢é…ç½®
    public void switchConfig(String configKey, String newValue) {
        
        // 1. å…ˆéªŒè¯æ–°é…ç½®çš„æœ‰æ•ˆæ€§
        if (!validateNewConfig(configKey, newValue)) {
            throw new IllegalArgumentException("æ–°é…ç½®éªŒè¯å¤±è´¥");
        }
        
        // 2. æš‚åœæ–°çš„ä¸šåŠ¡è¯·æ±‚å¤„ç†
        businessService.pauseNewRequests();
        
        try {
            // 3. ç­‰å¾…å½“å‰è¯·æ±‚å¤„ç†å®Œæˆ
            waitForCurrentRequestsComplete();
            
            // 4. åº”ç”¨æ–°é…ç½®
            applyNewConfig(configKey, newValue);
            
            // 5. éªŒè¯é…ç½®ç”Ÿæ•ˆ
            if (!verifyConfigApplied(configKey, newValue)) {
                // å›æ»šé…ç½®
                rollbackConfig(configKey);
                throw new RuntimeException("é…ç½®åº”ç”¨å¤±è´¥ï¼Œå·²å›æ»š");
            }
            
        } finally {
            // 6. æ¢å¤ä¸šåŠ¡è¯·æ±‚å¤„ç†
            businessService.resumeRequests();
        }
        
        logger.info("é…ç½® {} å·²æˆåŠŸåˆ‡æ¢åˆ°æ–°å€¼: {}", configKey, newValue);
    }
    
    private void waitForCurrentRequestsComplete() {
        // ç­‰å¾…é€»è¾‘ï¼Œæ¯”å¦‚ç­‰å¾…æ´»è·ƒè¿æ¥æ•°é™åˆ°0
        // æˆ–è€…ç­‰å¾…æŒ‡å®šçš„æ—¶é—´
    }
}
```

---

## 9. ğŸª å®é™…åº”ç”¨åœºæ™¯


### 9.1 ç”µå•†ç³»ç»Ÿé…ç½®ç®¡ç†


> ğŸ›’ **ç”µå•†åœºæ™¯ç¤ºä¾‹**  
> åŒ11æœŸé—´ï¼Œéœ€è¦å¿«é€Ÿè°ƒæ•´ä¿ƒé”€è§„åˆ™ã€æ”¯ä»˜é™é¢ã€åº“å­˜é˜ˆå€¼ç­‰é…ç½®ï¼Œè€Œä¸”ä¸èƒ½åœæœºã€‚è¿™å°±æ˜¯é…ç½®ç®¡ç†çš„å…¸å‹åº”ç”¨åœºæ™¯ã€‚

**ğŸ’° ä¿ƒé”€é…ç½®åŠ¨æ€ç®¡ç†**

```java
@Component
@ConfigurationProperties(prefix = "promotion")
@RefreshScope
public class PromotionConfig {
    
    // ä¿ƒé”€å¼€å…³
    private boolean enabled = false;
    
    // æŠ˜æ‰£æ¯”ä¾‹
    private Map<String, Double> discountRates = new HashMap<>();
    
    // ä¼˜æƒ åˆ¸é…ç½®
    private CouponConfig coupon = new CouponConfig();
    
    // åº“å­˜é¢„è­¦é˜ˆå€¼
    private int stockWarningThreshold = 100;
    
    public static class CouponConfig {
        private boolean enabled = false;
        private int maxAmount = 100;
        private int minOrderAmount = 500;
        
        // getter/setter...
    }
    
    // getter/setter methods...
}

// ä¿ƒé”€æœåŠ¡ä½¿ç”¨é…ç½®
@Service
public class PromotionService {
    
    @Autowired
    private PromotionConfig promotionConfig;
    
    public BigDecimal calculateDiscount(String productCategory, 
                                       BigDecimal originalPrice) {
        
        if (!promotionConfig.isEnabled()) {
            return BigDecimal.ZERO;  // ä¿ƒé”€æœªå¼€å¯
        }
        
        Double discountRate = promotionConfig.getDiscountRates()
                             .get(productCategory);
        
        if (discountRate == null) {
            return BigDecimal.ZERO;  // è¯¥ç±»åˆ«æ²¡æœ‰æŠ˜æ‰£
        }
        
        return originalPrice.multiply(BigDecimal.valueOf(discountRate));
    }
}
```

### 9.2 æ”¯ä»˜ç³»ç»Ÿé…ç½®ç®¡ç†


**ğŸ’³ æ”¯ä»˜é™é¢åŠ¨æ€è°ƒæ•´**

```yaml
# æ”¯ä»˜é…ç½®ç¤ºä¾‹
payment:
  limits:
    daily:
      individual: 50000      # ä¸ªäººæ—¥é™é¢5ä¸‡
      business: 1000000      # ä¼ä¸šæ—¥é™é¢100ä¸‡
    single:
      individual: 5000       # ä¸ªäººå•ç¬”é™é¢5åƒ
      business: 100000       # ä¼ä¸šå•ç¬”é™é¢10ä¸‡
  
  gateways:
    alipay:
      enabled: true
      timeout: 30000
      retry-count: 3
    wechat:
      enabled: true  
      timeout: 25000
      retry-count: 2
    
  risk-control:
    max-fail-count: 5        # æœ€å¤§å¤±è´¥æ¬¡æ•°
    lock-duration: 1800      # é”å®šæ—¶é•¿(ç§’)
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ¯ **å…³é”®çŸ¥è¯†ç‚¹å›é¡¾**

```
ğŸ”¸ é…ç½®åˆ†å±‚ï¼šé»˜è®¤ â†’ å…¬å…± â†’ ç¯å¢ƒ â†’ åº”ç”¨ å››å±‚æ¶æ„
ğŸ”¸ æ•æ„Ÿä¿¡æ¯ï¼šåŠ å¯†å­˜å‚¨ï¼Œå¤–éƒ¨å¯†é’¥ç®¡ç†ï¼Œç¯å¢ƒå˜é‡æ³¨å…¥
ğŸ”¸ å˜æ›´é€šçŸ¥ï¼šæ¨é€æ¨¡å¼å®æ—¶æ€§å¥½ï¼Œæ‹‰å–æ¨¡å¼ç¨³å®šæ€§å¼º
ğŸ”¸ å®¡è®¡è¿½è¸ªï¼šè®°å½•å˜æ›´å†å²ï¼Œæ”¯æŒé—®é¢˜å›æº¯
ğŸ”¸ é»˜è®¤å€¼ç­–ç•¥ï¼šå¤šçº§å…œåº•ï¼Œç¯å¢ƒæ„ŸçŸ¥ï¼Œæ™ºèƒ½é€‰æ‹©
ğŸ”¸ é…ç½®éªŒè¯ï¼šæ ¼å¼éªŒè¯ï¼Œé€»è¾‘éªŒè¯ï¼Œè¿é€šæ€§éªŒè¯  
ğŸ”¸ çƒ­æ›´æ–°ï¼š@RefreshScopeæ³¨è§£ï¼Œä¼˜é›…åˆ‡æ¢ï¼Œåˆ†çº§æ›´æ–°
```

### 10.2 å®è·µåº”ç”¨æŒ‡å¯¼


**âœ… é…ç½®ç®¡ç†æœ€ä½³å®è·µæ¸…å•**

- [ ] **åˆ†å±‚è®¾è®¡**ï¼šå»ºç«‹æ¸…æ™°çš„å››å±‚é…ç½®æ¶æ„
- [ ] **å®‰å…¨ä¿æŠ¤**ï¼šæ•æ„Ÿä¿¡æ¯å¿…é¡»åŠ å¯†å­˜å‚¨
- [ ] **å˜æ›´æ§åˆ¶**ï¼šå»ºç«‹é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹
- [ ] **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰é…ç½®å˜æ›´å†å²
- [ ] **éªŒè¯æœºåˆ¶**ï¼šé…ç½®åº”ç”¨å‰è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯
- [ ] **çƒ­æ›´æ–°èƒ½åŠ›**ï¼šæ”¯æŒä¸åœæœºçš„é…ç½®æ›´æ–°
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®å˜æ›´å¼‚å¸¸åŠæ—¶å‘Šè­¦
- [ ] **å›æ»šèƒ½åŠ›**ï¼šæ”¯æŒå¿«é€Ÿå›æ»šåˆ°å†å²ç‰ˆæœ¬

**ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®**

| åœºæ™¯éœ€æ±‚ | **æ¨èæ–¹æ¡ˆ** | **å…³é”®ç‰¹æ€§** |
|---------|-------------|-------------|
| `ç®€å•é¡¹ç›®` | **Spring Boot Profile** | `å¤Ÿç”¨ï¼Œç®€å•ï¼Œé›¶ä¾èµ–` |
| `å¾®æœåŠ¡æ¶æ„` | **Spring Cloud Config** | `æˆç†Ÿï¼Œç”Ÿæ€å¥½ï¼ŒåŠŸèƒ½å…¨` |
| `é«˜å®‰å…¨è¦æ±‚` | **HashiCorp Vault** | `ä¸“ä¸šå¯†é’¥ç®¡ç†ï¼Œå®‰å…¨æ€§å¼º` |
| `äº‘åŸç”Ÿç¯å¢ƒ` | **Kubernetes ConfigMap** | `äº‘åŸç”Ÿï¼Œå®¹å™¨å‹å¥½` |

### 10.3 é¿å…å¸¸è§é™·é˜±


**âš ï¸ é…ç½®ç®¡ç†å¸¸è§é—®é¢˜**

```
é…ç½®è®¾è®¡é—®é¢˜ï¼š
âŒ é…ç½®é¡¹å‘½åä¸è§„èŒƒï¼Œéš¾ä»¥ç†è§£
âŒ æ²¡æœ‰åˆç†çš„é»˜è®¤å€¼ï¼Œéƒ¨ç½²å¤æ‚
âŒ æ•æ„Ÿä¿¡æ¯æ˜æ–‡å­˜å‚¨ï¼Œå®‰å…¨é£é™©é«˜

è¿ç»´ç®¡ç†é—®é¢˜ï¼š  
âŒ ç¼ºä¹å˜æ›´å®¡è®¡ï¼Œé—®é¢˜éš¾ä»¥è¿½è¸ª
âŒ æ²¡æœ‰é…ç½®éªŒè¯ï¼Œé”™è¯¯é…ç½®å¯¼è‡´æ•…éšœ
âŒ çƒ­æ›´æ–°æœºåˆ¶ä¸å®Œå–„ï¼Œå½±å“æœåŠ¡ç¨³å®šæ€§

å›¢é˜Ÿåä½œé—®é¢˜ï¼š
âŒ é…ç½®å˜æ›´æµç¨‹ä¸æ¸…æ™°ï¼Œæƒè´£ä¸æ˜
âŒ ç¼ºä¹æ–‡æ¡£è¯´æ˜ï¼Œé…ç½®é¡¹å«ä¹‰ä¸æ¸…
âŒ ç¯å¢ƒé…ç½®ä¸ä¸€è‡´ï¼Œå¯¼è‡´ç¯å¢ƒå·®å¼‚é—®é¢˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é…ç½®åˆ†å±‚å¾ˆé‡è¦ï¼Œé»˜è®¤å…¬å…±ç¯å¢ƒåº”ç”¨
- æ•æ„Ÿä¿¡æ¯è¦åŠ å¯†ï¼Œå®‰å…¨ç¬¬ä¸€ä¸èƒ½å¿˜  
- å˜æ›´é€šçŸ¥æ¨æ‹‰å–ï¼Œå®¡è®¡æ—¥å¿—è¦è®°è¯¦
- éªŒè¯æœºåˆ¶ä¿è´¨é‡ï¼Œçƒ­æ›´æ–°æ¥ææ•ˆç‡
- æœ€ä½³å®è·µè¦éµå¾ªï¼Œé¿å…é™·é˜±ä¿å®‰å…¨