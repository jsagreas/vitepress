---
title: 2ã€æˆæƒæ§åˆ¶ç­–ç•¥
---
## ğŸ“š ç›®å½•


1. [ä»€ä¹ˆæ˜¯æˆæƒæ§åˆ¶](#1-ä»€ä¹ˆæ˜¯æˆæƒæ§åˆ¶)
2. [RBACæƒé™æ¨¡å‹è¯¦è§£](#2-RBACæƒé™æ¨¡å‹è¯¦è§£)
3. [ABACæƒé™æ¨¡å‹æ·±å…¥](#3-ABACæƒé™æ¨¡å‹æ·±å…¥)
4. [ç»†ç²’åº¦æƒé™è®¾è®¡](#4-ç»†ç²’åº¦æƒé™è®¾è®¡)
5. [åŠ¨æ€æƒé™ä¸ç»§æ‰¿æœºåˆ¶](#5-åŠ¨æ€æƒé™ä¸ç»§æ‰¿æœºåˆ¶)
6. [æƒé™å®¡è®¡ä¸ç¼“å­˜ä¼˜åŒ–](#6-æƒé™å®¡è®¡ä¸ç¼“å­˜ä¼˜åŒ–)
7. [å®æˆ˜åº”ç”¨æŒ‡å—](#7-å®æˆ˜åº”ç”¨æŒ‡å—)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# 1. ğŸ” ä»€ä¹ˆæ˜¯æˆæƒæ§åˆ¶



## 1.1 æˆæƒæ§åˆ¶çš„æœ¬è´¨ç†è§£



æƒ³è±¡ä¸€ä¸‹å…¬å¸çš„é—¨ç¦ç³»ç»Ÿï¼šä½ æœ‰å‘˜å·¥å¡èƒ½è¿›å…¥åŠå…¬å®¤ï¼ˆ**è®¤è¯**ï¼‰ï¼Œä½†ä½ èƒ½è¿›å…¥å“ªäº›æˆ¿é—´ã€èƒ½ä½¿ç”¨å“ªäº›è®¾å¤‡ï¼Œè¿™å°±æ˜¯**æˆæƒ**çš„èŒƒç•´ã€‚

```
ç®€å•ç±»æ¯”ï¼š
è®¤è¯ = è¯æ˜ä½ æ˜¯è° (èº«ä»½è¯æ˜)
æˆæƒ = å†³å®šä½ èƒ½åšä»€ä¹ˆ (æƒé™æ§åˆ¶)

æ¯”å¦‚ï¼š
- å¼ ä¸‰æ˜¯å…¬å¸å‘˜å·¥ â† è®¤è¯é€šè¿‡
- å¼ ä¸‰èƒ½è®¿é—®å¼€å‘éƒ¨é—¨èµ„æ–™ â† æˆæƒæ£€æŸ¥
- å¼ ä¸‰ä¸èƒ½æŸ¥çœ‹è´¢åŠ¡æŠ¥è¡¨ â† æˆæƒæ‹’ç»
```

**ğŸ”¸ æˆæƒæ§åˆ¶çš„æ ¸å¿ƒä½œç”¨**
- **å®‰å…¨é˜²æŠ¤**ï¼šé˜²æ­¢æœªæˆæƒè®¿é—®æ•æ„Ÿèµ„æº
- **èŒè´£åˆ†ç¦»**ï¼šä¸åŒè§’è‰²æœ‰ä¸åŒæƒé™èŒƒå›´
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³æ³•å¾‹æ³•è§„çš„æƒé™ç®¡ç†è¦æ±‚
- **ä¸šåŠ¡éš”ç¦»**ï¼šç¡®ä¿ä¸šåŠ¡æ•°æ®çš„å®‰å…¨è¾¹ç•Œ

## 1.2 å¾®æœåŠ¡ä¸­çš„æˆæƒæŒ‘æˆ˜



ä¼ ç»Ÿå•ä½“åº”ç”¨vså¾®æœåŠ¡æ¶æ„çš„æƒé™æ§åˆ¶å·®å¼‚ï¼š

```
å•ä½“åº”ç”¨æƒé™æ§åˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å•ä½“åº”ç”¨            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   æƒé™æ£€æŸ¥æ¨¡å—   â”‚    â”‚ â† é›†ä¸­å¼æƒé™æ§åˆ¶
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚    â†“        â†“        â†“   â”‚
â”‚  ç”¨æˆ·æ¨¡å—  è®¢å•æ¨¡å—  å•†å“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¾®æœåŠ¡æƒé™æ§åˆ¶ï¼š
ç”¨æˆ·æœåŠ¡ â†â†’ ç½‘å…³æƒé™ä¸­å¿ƒ â†â†’ è®¢å•æœåŠ¡
   â†“              â†“              â†“
æƒé™ç¼“å­˜        ç»Ÿä¸€é‰´æƒ        æƒé™ç¼“å­˜
```

**âš ï¸ å¾®æœåŠ¡æƒé™æ§åˆ¶çš„æŒ‘æˆ˜**
- **åˆ†å¸ƒå¼å¤æ‚æ€§**ï¼šæƒé™ä¿¡æ¯åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡ä¸­
- **æ€§èƒ½é—®é¢˜**ï¼šæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦æƒé™éªŒè¯
- **æ•°æ®ä¸€è‡´æ€§**ï¼šæƒé™å˜æ›´éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰æœåŠ¡
- **æœåŠ¡é—´è°ƒç”¨**ï¼šå†…éƒ¨æœåŠ¡è°ƒç”¨çš„æƒé™ç®¡ç†

---

# 2. ğŸ‘¥ RBACæƒé™æ¨¡å‹è¯¦è§£



## 2.1 RBACæ¨¡å‹åŸºç¡€æ¦‚å¿µ



**RBAC**ï¼ˆRole-Based Access Controlï¼‰= **åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶**

æŠŠå®ƒæƒ³è±¡æˆå…¬å¸çš„ç»„ç»‡æ¶æ„ï¼šä¸æ˜¯ç»™æ¯ä¸ªäººå•ç‹¬åˆ†é…æƒé™ï¼Œè€Œæ˜¯å…ˆå®šä¹‰èŒä½ï¼ˆè§’è‰²ï¼‰ï¼Œå†ç»™èŒä½åˆ†é…æƒé™ï¼Œæœ€åæŠŠäººåˆ†é…åˆ°èŒä½ä¸Šã€‚

```
RBACæ ¸å¿ƒè¦ç´ å…³ç³»å›¾ï¼š
                    
ç”¨æˆ·(User) â†â†’ è§’è‰²(Role) â†â†’ æƒé™(Permission) â†â†’ èµ„æº(Resource)
   â†‘             â†‘              â†‘                â†‘
  å¼ ä¸‰          å¼€å‘ç»ç†         ç”¨æˆ·ç®¡ç†          ç”¨æˆ·æ•°æ®åº“
  æå››          äº§å“ç»ç†         è®¢å•æŸ¥çœ‹          è®¢å•æ¥å£
  ç‹äº”          æµ‹è¯•å·¥ç¨‹å¸ˆ       ç³»ç»Ÿé…ç½®          é…ç½®æ–‡ä»¶
```

## 2.2 RBACæ¨¡å‹å±‚æ¬¡ç»“æ„



### ğŸ¢ æ ‡å‡†RBACæ¨¡å‹ (RBAC0)



```
åŸºç¡€å››è¦ç´ ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·    â”‚â”€â”€â†’ â”‚   è§’è‰²    â”‚â”€â”€â†’ â”‚   æƒé™    â”‚â”€â”€â†’ â”‚   èµ„æº    â”‚
â”‚  (User)  â”‚    â”‚ (Role)   â”‚    â”‚(Permission)â”‚   â”‚(Resource)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘              â†‘               â†‘               â†‘
    å¼ ä¸‰           ç®¡ç†å‘˜           åˆ é™¤ç”¨æˆ·         ç”¨æˆ·è¡¨
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```java
// ç”¨æˆ·è¡¨
User user = new User("å¼ ä¸‰", "zhangsan@company.com");

// è§’è‰²å®šä¹‰
Role adminRole = new Role("ADMIN", "ç³»ç»Ÿç®¡ç†å‘˜");
Role userRole = new Role("USER", "æ™®é€šç”¨æˆ·");

// æƒé™å®šä¹‰
Permission userDelete = new Permission("user:delete", "åˆ é™¤ç”¨æˆ·");
Permission userView = new Permission("user:view", "æŸ¥çœ‹ç”¨æˆ·");

// è§’è‰²æƒé™å…³è”
adminRole.addPermissions(userDelete, userView);
userRole.addPermissions(userView); // æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹

// ç”¨æˆ·è§’è‰²åˆ†é…
user.assignRole(adminRole);
```

### ğŸ—ï¸ åˆ†å±‚RBACæ¨¡å‹ (RBAC1)



è§’è‰²å¯ä»¥æœ‰ä¸Šä¸‹çº§å…³ç³»ï¼Œå°±åƒå…¬å¸çš„ç®¡ç†å±‚çº§ï¼š

```
è§’è‰²ç»§æ‰¿å…³ç³»å›¾ï¼š
                 ç³»ç»Ÿç®¡ç†å‘˜
                     â†“
                 éƒ¨é—¨ç®¡ç†å‘˜  
                     â†“
                 æ™®é€šç”¨æˆ·
                     
ç»§æ‰¿è§„åˆ™ï¼š
- ç³»ç»Ÿç®¡ç†å‘˜ ç»§æ‰¿ éƒ¨é—¨ç®¡ç†å‘˜ + æ™®é€šç”¨æˆ·çš„æ‰€æœ‰æƒé™
- éƒ¨é—¨ç®¡ç†å‘˜ ç»§æ‰¿ æ™®é€šç”¨æˆ·çš„æ‰€æœ‰æƒé™  
- æ™®é€šç”¨æˆ· åªæœ‰åŸºç¡€æƒé™
```

**ğŸ”¸ è§’è‰²ç»§æ‰¿çš„å¥½å¤„**
- **æƒé™å¤ç”¨**ï¼šé¿å…é‡å¤åˆ†é…ç›¸åŒæƒé™
- **ç®¡ç†ç®€åŒ–**ï¼šä¸Šçº§è§’è‰²è‡ªåŠ¨è·å¾—ä¸‹çº§æƒé™
- **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢è§’è‰²æ—¶å®¹æ˜“ç»§æ‰¿ç°æœ‰æƒé™

### ğŸ”’ çº¦æŸRBACæ¨¡å‹ (RBAC2)



åŠ å…¥äº†å„ç§ä¸šåŠ¡çº¦æŸè§„åˆ™ï¼š

```
å¸¸è§çº¦æŸç±»å‹ï¼š

äº’æ–¥çº¦æŸï¼š
â”œâ”€ è§’è‰²äº’æ–¥ï¼šä¸€ä¸ªç”¨æˆ·ä¸èƒ½åŒæ—¶æ˜¯"å‡ºçº³"å’Œ"ä¼šè®¡"
â”œâ”€ æƒé™äº’æ–¥ï¼šä¸èƒ½åŒæ—¶æœ‰"å®¡æ‰¹"å’Œ"ç”³è¯·"æƒé™
â””â”€ æ—¶é—´çº¦æŸï¼šåªèƒ½åœ¨å·¥ä½œæ—¶é—´è¡Œä½¿æŸäº›æƒé™

æ•°é‡çº¦æŸï¼š
â”œâ”€ è§’è‰²æ•°é‡ï¼šæ¯ä¸ªéƒ¨é—¨æœ€å¤š3ä¸ªç®¡ç†å‘˜
â”œâ”€ ç”¨æˆ·æ•°é‡ï¼šè´¢åŠ¡è§’è‰²æœ€å¤šåˆ†é…ç»™5ä¸ªäºº
â””â”€ æƒé™æ•°é‡ï¼šä¸´æ—¶è§’è‰²æœ€å¤šåˆ†é…10ä¸ªæƒé™
```

## 2.3 RBACåœ¨å¾®æœåŠ¡ä¸­çš„å®ç°



```java
// å¾®æœåŠ¡æƒé™æ£€æŸ¥å®ç°
@Component
public class RBACAuthorizationManager {
    
    @Autowired
    private UserRoleService userRoleService;
    
    @Autowired
    private RolePermissionService rolePermissionService;
    
    /**
     * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šæƒé™
     * @param userId ç”¨æˆ·ID  
     * @param permission æƒé™ç¼–ç 
     * @return æ˜¯å¦æœ‰æƒé™
     */
    public boolean hasPermission(String userId, String permission) {
        // 1. è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
        List<Role> userRoles = userRoleService.getUserRoles(userId);
        
        // 2. è·å–è§’è‰²å¯¹åº”çš„æ‰€æœ‰æƒé™
        Set<Permission> allPermissions = new HashSet<>();
        for (Role role : userRoles) {
            List<Permission> rolePermissions = 
                rolePermissionService.getRolePermissions(role.getId());
            allPermissions.addAll(rolePermissions);
            
            // 3. å¤„ç†è§’è‰²ç»§æ‰¿
            processRoleInheritance(role, allPermissions);
        }
        
        // 4. æ£€æŸ¥æ˜¯å¦åŒ…å«ç›®æ ‡æƒé™
        return allPermissions.stream()
            .anyMatch(p -> p.getCode().equals(permission));
    }
}
```

---

# 3. ğŸ¯ ABACæƒé™æ¨¡å‹æ·±å…¥



## 3.1 ABACæ¨¡å‹æ ¸å¿ƒç†å¿µ



**ABAC**ï¼ˆAttribute-Based Access Controlï¼‰= **åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶**

å¦‚æœè¯´RBACæ˜¯æŒ‰"èŒä½"åˆ†æƒé™ï¼Œé‚£ABACå°±æ˜¯æŒ‰"å…·ä½“æƒ…å†µ"åˆ†æƒé™ã€‚

```
RBACæ€ç»´ï¼šå¼ ä¸‰æ˜¯ç®¡ç†å‘˜ï¼Œæ‰€ä»¥èƒ½åˆ é™¤ç”¨æˆ·
ABACæ€ç»´ï¼šåœ¨å·¥ä½œæ—¶é—´ï¼Œéƒ¨é—¨å†…çš„ï¼Œçº§åˆ«è¾ƒä½çš„ç”¨æˆ·ï¼Œå¯ä»¥è¢«åˆ é™¤

ABACå››å¤§å±æ€§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»ä½“å±æ€§    â”‚  â”‚  å®¢ä½“å±æ€§    â”‚  â”‚  ç¯å¢ƒå±æ€§    â”‚  â”‚  åŠ¨ä½œå±æ€§    â”‚
â”‚ (Subject)   â”‚  â”‚ (Object)    â”‚  â”‚(Environment)â”‚  â”‚ (Action)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“              â†“              â†“              â†“
   ç”¨æˆ·éƒ¨é—¨         èµ„æºç±»å‹        å½“å‰æ—¶é—´        æ“ä½œç±»å‹
   ç”¨æˆ·çº§åˆ«         æ•°æ®æ•æ„Ÿåº¦       è®¿é—®åœ°ç‚¹        æ“ä½œé£é™©
```

## 3.2 ABACå±æ€§è¯¦è§£



### ğŸ‘¤ ä¸»ä½“å±æ€§ï¼ˆç”¨æˆ·ç›¸å…³ï¼‰


```
ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼š
- éƒ¨é—¨ï¼šç ”å‘éƒ¨ã€å¸‚åœºéƒ¨ã€è´¢åŠ¡éƒ¨
- èŒçº§ï¼šP1-P10
- å·¥ä½œå¹´é™ï¼šæ–°å‘˜å·¥ã€è€å‘˜å·¥
- å®‰å…¨ç­‰çº§ï¼šæ™®é€šã€æœºå¯†ã€ç»å¯†

ç¤ºä¾‹å±æ€§ç»„åˆï¼š
{
  "department": "ç ”å‘éƒ¨",
  "level": "P6", 
  "experience": "3å¹´",
  "clearance": "æœºå¯†"
}
```

### ğŸ“„ å®¢ä½“å±æ€§ï¼ˆèµ„æºç›¸å…³ï¼‰


```
èµ„æºç‰¹å¾ï¼š
- æ•°æ®ç±»å‹ï¼šç”¨æˆ·æ•°æ®ã€è´¢åŠ¡æ•°æ®ã€ç³»ç»Ÿé…ç½®
- æ•æ„Ÿçº§åˆ«ï¼šå…¬å¼€ã€å†…éƒ¨ã€æœºå¯†ã€ç»å¯†  
- æ‰€å±éƒ¨é—¨ï¼šå“ªä¸ªéƒ¨é—¨çš„æ•°æ®
- åˆ›å»ºæ—¶é—´ï¼šæ•°æ®çš„æ–°æ—§ç¨‹åº¦

ç¤ºä¾‹å±æ€§ç»„åˆï¼š
{
  "type": "è´¢åŠ¡æ•°æ®",
  "sensitivity": "æœºå¯†",
  "department": "è´¢åŠ¡éƒ¨", 
  "created": "2024-01-01"
}
```

### ğŸŒ ç¯å¢ƒå±æ€§ï¼ˆä¸Šä¸‹æ–‡ç›¸å…³ï¼‰


```
æ—¶ç©ºç¯å¢ƒï¼š
- è®¿é—®æ—¶é—´ï¼šå·¥ä½œæ—¶é—´ã€éå·¥ä½œæ—¶é—´
- è®¿é—®åœ°ç‚¹ï¼šåŠå…¬å®¤ã€å®¶é‡Œã€å‡ºå·®
- ç½‘ç»œç¯å¢ƒï¼šå†…ç½‘ã€å¤–ç½‘ã€VPN
- è®¾å¤‡ç±»å‹ï¼šå…¬å¸ç”µè„‘ã€ä¸ªäººæ‰‹æœº

ç¤ºä¾‹å±æ€§ç»„åˆï¼š
{
  "time": "09:00-18:00",
  "location": "åŠå…¬å®¤",
  "network": "å†…ç½‘",
  "device": "å…¬å¸ç”µè„‘"
}
```

## 3.3 ABACç­–ç•¥å¼•æ“å®ç°



```java
// ABACç­–ç•¥è¯„ä¼°å™¨
@Component  
public class ABACPolicyEngine {
    
    /**
     * è¯„ä¼°è®¿é—®è¯·æ±‚
     * @param request è®¿é—®è¯·æ±‚ï¼ˆåŒ…å«æ‰€æœ‰å±æ€§ï¼‰
     * @return æ˜¯å¦å…è®¸è®¿é—®
     */
    public boolean evaluate(AccessRequest request) {
        // è·å–æ‰€æœ‰ç›¸å…³ç­–ç•¥
        List<Policy> policies = getPoliciesForResource(request.getResource());
        
        // é€ä¸ªè¯„ä¼°ç­–ç•¥
        for (Policy policy : policies) {
            PolicyResult result = evaluatePolicy(policy, request);
            
            if (result == PolicyResult.DENY) {
                return false; // ä»»ä½•ä¸€ä¸ªæ‹’ç»ç­–ç•¥ç”Ÿæ•ˆï¼Œå°±æ‹’ç»è®¿é—®
            }
            
            if (result == PolicyResult.PERMIT) {
                return true; // æ‰¾åˆ°å…è®¸ç­–ç•¥ï¼Œå…è®¸è®¿é—®
            }
        }
        
        return false; // é»˜è®¤æ‹’ç»
    }
    
    private PolicyResult evaluatePolicy(Policy policy, AccessRequest request) {
        // æ£€æŸ¥æ‰€æœ‰æ¡ä»¶æ˜¯å¦æ»¡è¶³
        for (Condition condition : policy.getConditions()) {
            if (!condition.evaluate(request)) {
                return PolicyResult.NOT_APPLICABLE;
            }
        }
        
        return policy.getDecision(); // è¿”å›ç­–ç•¥å†³å®š
    }
}
```

**ğŸ“‹ ABACç­–ç•¥é…ç½®ç¤ºä¾‹**
```yaml
# è´¢åŠ¡æ•°æ®è®¿é—®ç­–ç•¥

policy:
  name: "è´¢åŠ¡æ•°æ®è®¿é—®æ§åˆ¶"
  description: "åªæœ‰è´¢åŠ¡éƒ¨é—¨é«˜çº§å‘˜å·¥åœ¨å·¥ä½œæ—¶é—´å¯ä»¥è®¿é—®è´¢åŠ¡æ•°æ®"
  
  conditions:
    - attribute: "subject.department"
      operator: "equals"
      value: "è´¢åŠ¡éƒ¨"
      
    - attribute: "subject.level" 
      operator: "greaterThan"
      value: "P5"
      
    - attribute: "environment.time"
      operator: "between" 
      value: ["09:00", "18:00"]
      
    - attribute: "object.type"
      operator: "equals"
      value: "è´¢åŠ¡æ•°æ®"
  
  decision: "PERMIT"
```

---

# 4. ğŸ”¬ ç»†ç²’åº¦æƒé™è®¾è®¡



## 4.1 ä»€ä¹ˆæ˜¯ç»†ç²’åº¦æƒé™



**ç²—ç²’åº¦æƒé™**ï¼šç”¨æˆ·æœ‰"è®¢å•ç®¡ç†"æƒé™
**ç»†ç²’åº¦æƒé™**ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±éƒ¨é—¨çš„ã€é‡‘é¢å°äº1ä¸‡çš„ã€æœ€è¿‘3ä¸ªæœˆçš„è®¢å•

```
æƒé™ç²’åº¦å¯¹æ¯”ï¼š

ç²—ç²’åº¦ (åŠŸèƒ½çº§):
â”œâ”€ ç”¨æˆ·ç®¡ç† âœ“
â”œâ”€ è®¢å•ç®¡ç† âœ“  
â””â”€ å•†å“ç®¡ç† âœ—

ç»†ç²’åº¦ (æ•°æ®çº§):
â”œâ”€ æŸ¥çœ‹æœ¬éƒ¨é—¨ç”¨æˆ· âœ“
â”œâ”€ ç¼–è¾‘ä¸‹çº§ç”¨æˆ· âœ“
â”œâ”€ åˆ é™¤ä¸´æ—¶ç”¨æˆ· âœ—
â”œâ”€ æŸ¥çœ‹å°é¢è®¢å• âœ“
â””â”€ ä¿®æ”¹è‡ªå·±è®¢å• âœ“
```

## 4.2 æ•°æ®çº§æƒé™æ§åˆ¶



### ğŸ“Š è¡Œçº§æƒé™ï¼ˆRow-Level Securityï¼‰



```java
// è®¢å•æŸ¥è¯¢çš„è¡Œçº§æƒé™æ§åˆ¶
@Service
public class OrderService {
    
    public List<Order> getOrders(String userId) {
        User currentUser = getCurrentUser();
        
        // æ„å»ºæŸ¥è¯¢æ¡ä»¶
        QueryWrapper<Order> wrapper = new QueryWrapper<>();
        
        // æ ¹æ®ç”¨æˆ·è§’è‰²æ·»åŠ æ•°æ®è¿‡æ»¤æ¡ä»¶
        if (hasRole(currentUser, "ADMIN")) {
            // ç®¡ç†å‘˜èƒ½çœ‹æ‰€æœ‰è®¢å•
            // ä¸æ·»åŠ é¢å¤–æ¡ä»¶
        } else if (hasRole(currentUser, "MANAGER")) {
            // ç»ç†èƒ½çœ‹æœ¬éƒ¨é—¨è®¢å•
            wrapper.eq("department", currentUser.getDepartment());
        } else {
            // æ™®é€šç”¨æˆ·åªèƒ½çœ‹è‡ªå·±çš„è®¢å•
            wrapper.eq("user_id", currentUser.getId());
        }
        
        return orderMapper.selectList(wrapper);
    }
}
```

### ğŸ·ï¸ åˆ—çº§æƒé™ï¼ˆColumn-Level Securityï¼‰



```java
// ç”¨æˆ·ä¿¡æ¯çš„åˆ—çº§æƒé™æ§åˆ¶
@Component
public class UserDataFilter {
    
    public UserVO filterUserData(User user, String requesterId) {
        UserVO userVO = new UserVO();
        User requester = userService.getById(requesterId);
        
        // åŸºç¡€ä¿¡æ¯éƒ½èƒ½çœ‹
        userVO.setId(user.getId());
        userVO.setUsername(user.getUsername());
        userVO.setDepartment(user.getDepartment());
        
        // æ•æ„Ÿä¿¡æ¯éœ€è¦æƒé™
        if (hasPermission(requester, "user:phone:view")) {
            userVO.setPhone(user.getPhone());
        }
        
        if (hasPermission(requester, "user:salary:view")) {
            userVO.setSalary(user.getSalary());
        } else {
            userVO.setSalary("***"); // è„±æ•æ˜¾ç¤º
        }
        
        return userVO;
    }
}
```

## 4.3 å­—æ®µçº§æƒé™ä¸æ•°æ®è„±æ•



```java
// æ•°æ®è„±æ•å¤„ç†å™¨
@Component
public class DataMaskingProcessor {
    
    /**
     * æ ¹æ®æƒé™å¯¹æ•°æ®è¿›è¡Œè„±æ•å¤„ç†
     */
    public Object maskData(Object data, String field, String userId) {
        String permission = "data:" + field + ":view";
        
        if (hasPermission(userId, permission)) {
            return data; // æœ‰æƒé™ï¼Œè¿”å›åŸæ•°æ®
        }
        
        // æ²¡æƒé™ï¼Œè¿›è¡Œè„±æ•
        return maskByDataType(data, field);
    }
    
    private Object maskByDataType(Object data, String field) {
        if (data == null) return null;
        
        switch (field) {
            case "phone":
                return maskPhone(data.toString());
            case "email": 
                return maskEmail(data.toString());
            case "idCard":
                return maskIdCard(data.toString());
            case "bankCard":
                return maskBankCard(data.toString());
            default:
                return "***";
        }
    }
    
    private String maskPhone(String phone) {
        if (phone.length() != 11) return phone;
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
}
```

---

# 5. âš¡ åŠ¨æ€æƒé™ä¸ç»§æ‰¿æœºåˆ¶



## 5.1 åŠ¨æ€æƒé™çš„æ¦‚å¿µ



**é™æ€æƒé™**ï¼šæƒé™åœ¨ç³»ç»Ÿè®¾è®¡æ—¶å°±å›ºå®šäº†
**åŠ¨æ€æƒé™**ï¼šæƒé™æ ¹æ®ä¸šåŠ¡åœºæ™¯å®æ—¶è®¡ç®—

```
é™æ€æƒé™ç¤ºä¾‹ï¼š
- å¼ ä¸‰æœ‰"è®¢å•æŸ¥çœ‹"æƒé™ â† å›ºå®šä¸å˜

åŠ¨æ€æƒé™ç¤ºä¾‹ï¼š  
- å·¥ä½œæ—¥9-18ç‚¹ï¼Œå¼ ä¸‰å¯ä»¥å®¡æ‰¹5ä¸‡ä»¥ä¸‹è®¢å• â† æ ¹æ®æ—¶é—´ã€é‡‘é¢åŠ¨æ€åˆ¤æ–­
- å¼ ä¸‰çš„ç›´æ¥ä¸‹å±æäº¤çš„è¯·å‡ç”³è¯·ï¼Œå¼ ä¸‰å¯ä»¥å®¡æ‰¹ â† æ ¹æ®ç»„ç»‡å…³ç³»åŠ¨æ€åˆ¤æ–­
```

## 5.2 åŠ¨æ€æƒé™å®ç°æœºåˆ¶



```java
// åŠ¨æ€æƒé™è®¡ç®—å™¨
@Component
public class DynamicPermissionCalculator {
    
    @Autowired
    private OrganizationService orgService;
    
    @Autowired
    private BusinessRuleEngine ruleEngine;
    
    /**
     * åŠ¨æ€è®¡ç®—ç”¨æˆ·åœ¨ç‰¹å®šåœºæ™¯ä¸‹çš„æƒé™
     */
    public Set<Permission> calculateDynamicPermissions(
            String userId, String resourceId, Map<String, Object> context) {
        
        Set<Permission> permissions = new HashSet<>();
        
        // 1. åŸºäºç»„ç»‡å…³ç³»çš„åŠ¨æ€æƒé™
        permissions.addAll(calculateOrgPermissions(userId, resourceId));
        
        // 2. åŸºäºä¸šåŠ¡è§„åˆ™çš„åŠ¨æ€æƒé™  
        permissions.addAll(calculateRulePermissions(userId, context));
        
        // 3. åŸºäºæ—¶é—´çš„åŠ¨æ€æƒé™
        permissions.addAll(calculateTimePermissions(userId));
        
        return permissions;
    }
    
    private Set<Permission> calculateOrgPermissions(String userId, String resourceId) {
        Set<Permission> permissions = new HashSet<>();
        
        // è·å–ç”¨æˆ·çš„ç»„ç»‡å…³ç³»
        List<User> subordinates = orgService.getSubordinates(userId);
        List<User> superiors = orgService.getSuperiors(userId);
        
        // å¦‚æœèµ„æºå±äºä¸‹å±ï¼Œæœ‰ç®¡ç†æƒé™
        if (isSubordinateResource(resourceId, subordinates)) {
            permissions.add(new Permission("resource:manage"));
        }
        
        // å¦‚æœèµ„æºå±äºä¸Šçº§ï¼Œåªæœ‰æŸ¥çœ‹æƒé™
        if (isSuperiorResource(resourceId, superiors)) {
            permissions.add(new Permission("resource:view"));
        }
        
        return permissions;
    }
}
```

## 5.3 æƒé™ç»§æ‰¿æœºåˆ¶



### ğŸ¢ ç»„ç»‡æ¶æ„æƒé™ç»§æ‰¿



```
å…¬å¸ç»„ç»‡æ¶æ„æƒé™ç»§æ‰¿ï¼š

                    CEO (æ‰€æœ‰æƒé™)
                     â†“ ç»§æ‰¿
                   CTO â† æŠ€æœ¯éƒ¨é—¨æ‰€æœ‰æƒé™
                  â†™  â†“  â†˜
            ç ”å‘ç»ç†  æµ‹è¯•ç»ç†  è¿ç»´ç»ç†
               â†“      â†“       â†“
            ç ”å‘å‘˜å·¥  æµ‹è¯•å‘˜å·¥  è¿ç»´å‘˜å·¥

ç»§æ‰¿è§„åˆ™ï¼š
- ä¸Šçº§ç»§æ‰¿ä¸‹çº§çš„ç®¡ç†æƒé™
- å¹³çº§ä¹‹é—´æƒé™éš”ç¦»
- è·¨éƒ¨é—¨éœ€è¦ç‰¹æ®Šæˆæƒ
```

```java
// ç»„ç»‡æƒé™ç»§æ‰¿å¤„ç†å™¨
@Service
public class OrganizationPermissionInheritanceService {
    
    /**
     * è·å–ç”¨æˆ·é€šè¿‡ç»„ç»‡å…³ç³»ç»§æ‰¿çš„æƒé™
     */
    public Set<Permission> getInheritedPermissions(String userId) {
        Set<Permission> inherited = new HashSet<>();
        
        // 1. è·å–ç›´æ¥ä¸‹å±çš„ç®¡ç†æƒé™
        List<User> directSubordinates = orgService.getDirectSubordinates(userId);
        for (User subordinate : directSubordinates) {
            inherited.add(new Permission("user:" + subordinate.getId() + ":manage"));
        }
        
        // 2. è·å–ä¸‹å±éƒ¨é—¨çš„æŸ¥çœ‹æƒé™
        List<Department> managedDepts = orgService.getManagedDepartments(userId);
        for (Department dept : managedDepts) {
            inherited.add(new Permission("dept:" + dept.getId() + ":view"));
        }
        
        // 3. è·å–é¡¹ç›®æƒé™ç»§æ‰¿
        List<Project> managedProjects = projectService.getManagedProjects(userId);
        for (Project project : managedProjects) {
            inherited.add(new Permission("project:" + project.getId() + ":manage"));
        }
        
        return inherited;
    }
}
```

### ğŸ“Š æ•°æ®æƒé™ç»§æ‰¿



```java
// æ•°æ®æƒé™ç»§æ‰¿ç¤ºä¾‹
@Component 
public class DataPermissionInheritanceHandler {
    
    /**
     * è®¡ç®—ç”¨æˆ·å¯¹æŸæ¡æ•°æ®è®°å½•çš„ç»§æ‰¿æƒé™
     */
    public Set<String> calculateDataPermissions(String userId, DataRecord record) {
        Set<String> permissions = new HashSet<>();
        User user = userService.getById(userId);
        
        // 1. åˆ›å»ºè€…æƒé™
        if (record.getCreatorId().equals(userId)) {
            permissions.addAll(Arrays.asList("read", "update", "delete"));
        }
        
        // 2. éƒ¨é—¨æƒé™ç»§æ‰¿
        if (record.getDepartment().equals(user.getDepartment())) {
            permissions.add("read");
            
            // éƒ¨é—¨è´Ÿè´£äººé¢å¤–æƒé™
            if (isDepartmentManager(user)) {
                permissions.addAll(Arrays.asList("update", "approve"));
            }
        }
        
        // 3. é¡¹ç›®æƒé™ç»§æ‰¿
        if (isProjectMember(userId, record.getProjectId())) {
            permissions.add("read");
            
            if (isProjectManager(userId, record.getProjectId())) {
                permissions.add("update");
            }
        }
        
        return permissions;
    }
}
```

---

# 6. ğŸ“‹ æƒé™å®¡è®¡ä¸ç¼“å­˜ä¼˜åŒ–



## 6.1 æƒé™å®¡è®¡çš„é‡è¦æ€§



æƒé™å®¡è®¡å°±åƒç›‘æ§æ‘„åƒå¤´ï¼Œè®°å½•"è°åœ¨ä»€ä¹ˆæ—¶å€™å¯¹ä»€ä¹ˆèµ„æºåšäº†ä»€ä¹ˆæ“ä½œ"ã€‚

```
å®¡è®¡ä¿¡æ¯çš„ä»·å€¼ï¼š

åˆè§„è¦æ±‚ï¼š
â”œâ”€ SOXæ³•æ¡ˆè¦æ±‚ï¼šè´¢åŠ¡ç³»ç»Ÿè®¿é—®è®°å½•
â”œâ”€ GDPRè¦æ±‚ï¼šä¸ªäººæ•°æ®è®¿é—®è·Ÿè¸ª  
â””â”€ è¡Œä¸šæ ‡å‡†ï¼šé“¶è¡Œã€åŒ»ç–—ç­‰è¡Œä¸šåˆè§„

å®‰å…¨åˆ†æï¼š
â”œâ”€ å¼‚å¸¸è®¿é—®æ£€æµ‹ï¼šæ·±å¤œå¤§é‡æ•°æ®è®¿é—®
â”œâ”€ æƒé™æ»¥ç”¨å‘ç°ï¼šæƒé™èŒƒå›´å¤–çš„æ“ä½œ
â””â”€ æ”»å‡»è½¨è¿¹åˆ†æï¼šæƒé™æå‡æ”»å‡»é“¾

è¿è¥ä¼˜åŒ–ï¼š
â”œâ”€ æƒé™ä½¿ç”¨ç»Ÿè®¡ï¼šå“ªäº›æƒé™ä»æœªä½¿ç”¨
â”œâ”€ æ€§èƒ½ç“¶é¢ˆåˆ†æï¼šå“ªäº›æƒé™æ£€æŸ¥æœ€æ…¢
â””â”€ ç”¨æˆ·è¡Œä¸ºåˆ†æï¼šä¼˜åŒ–æƒé™åˆ†é…ç­–ç•¥
```

## 6.2 å®¡è®¡æ—¥å¿—è®¾è®¡



```java
// æƒé™å®¡è®¡æ—¥å¿—å®ä½“
@Entity
@Table(name = "permission_audit_log")
public class PermissionAuditLog {
    
    @Id
    private String id;
    
    // åŸºæœ¬ä¿¡æ¯
    private String userId;           // æ“ä½œç”¨æˆ·
    private String username;         // ç”¨æˆ·å
    private String operation;        // æ“ä½œç±»å‹
    private String resource;         // è®¿é—®èµ„æº
    private String permission;       // ä½¿ç”¨æƒé™
    
    // ç»“æœä¿¡æ¯
    private Boolean success;         // æ˜¯å¦æˆåŠŸ
    private String failureReason;    // å¤±è´¥åŸå› 
    private Integer responseTime;    // å“åº”æ—¶é—´ms
    
    // ä¸Šä¸‹æ–‡ä¿¡æ¯
    private String clientIp;         // å®¢æˆ·ç«¯IP
    private String userAgent;        // å®¢æˆ·ç«¯ä¿¡æ¯
    private String sessionId;        // ä¼šè¯ID
    
    // æ—¶é—´ä¿¡æ¯
    private LocalDateTime createTime; // æ“ä½œæ—¶é—´
    private String timeZone;         // æ—¶åŒº
}

// å®¡è®¡æ—¥å¿—è®°å½•å™¨
@Component
public class PermissionAuditLogger {
    
    @Async // å¼‚æ­¥è®°å½•ï¼Œä¸å½±å“ä¸šåŠ¡æ€§èƒ½
    public void logPermissionCheck(PermissionCheckEvent event) {
        PermissionAuditLog log = new PermissionAuditLog();
        
        // åŸºæœ¬ä¿¡æ¯
        log.setUserId(event.getUserId());
        log.setOperation(event.getOperation());
        log.setResource(event.getResource());
        log.setPermission(event.getPermission());
        
        // ç»“æœä¿¡æ¯
        log.setSuccess(event.isSuccess());
        log.setFailureReason(event.getFailureReason());
        log.setResponseTime(event.getResponseTime());
        
        // ä¸Šä¸‹æ–‡ä¿¡æ¯
        log.setClientIp(getClientIp());
        log.setUserAgent(getUserAgent());
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        auditLogRepository.save(log);
        
        // å®æ—¶å¼‚å¸¸æ£€æµ‹
        if (!event.isSuccess()) {
            securityAlertService.handleFailedPermissionCheck(event);
        }
    }
}
```

## 6.3 æƒé™ç¼“å­˜ç­–ç•¥



æƒé™æ£€æŸ¥é¢‘ç¹ï¼Œæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“ä¼šå¾ˆæ…¢ï¼Œéœ€è¦åˆç†çš„ç¼“å­˜ç­–ç•¥ï¼š

```
ç¼“å­˜å±‚æ¬¡ç»“æ„ï¼š

L1ç¼“å­˜ (æœ¬åœ°ç¼“å­˜):
â”œâ”€ ä½ç½®ï¼šåº”ç”¨æœåŠ¡å™¨å†…å­˜
â”œâ”€ å®¹é‡ï¼šæœ‰é™ (å‡ MBåˆ°å‡ GB)
â”œâ”€ é€Ÿåº¦ï¼šæå¿« (çº³ç§’çº§)
â””â”€ é€‚ç”¨ï¼šé«˜é¢‘è®¿é—®çš„æƒé™æ•°æ®

L2ç¼“å­˜ (åˆ†å¸ƒå¼ç¼“å­˜):  
â”œâ”€ ä½ç½®ï¼šRedisé›†ç¾¤
â”œâ”€ å®¹é‡ï¼šè¾ƒå¤§ (GBåˆ°TBçº§)
â”œâ”€ é€Ÿåº¦ï¼šå¾ˆå¿« (æ¯«ç§’çº§)
â””â”€ é€‚ç”¨ï¼šç”¨æˆ·ä¼šè¯æƒé™æ•°æ®

L3å­˜å‚¨ (æ•°æ®åº“):
â”œâ”€ ä½ç½®ï¼šMySQL/PostgreSQL
â”œâ”€ å®¹é‡ï¼šæµ·é‡å­˜å‚¨
â”œâ”€ é€Ÿåº¦ï¼šç›¸å¯¹æ…¢ (10-100ms)
â””â”€ é€‚ç”¨ï¼šå®Œæ•´æƒé™æ•°æ®æŒä¹…åŒ–
```

```java
// åˆ†å±‚æƒé™ç¼“å­˜ç®¡ç†å™¨
@Component
public class PermissionCacheManager {
    
    // L1: æœ¬åœ°ç¼“å­˜ (Caffeine)
    private Cache<String, Set<Permission>> localCache = Caffeine.newBuilder()
        .maximumSize(10000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    // L2: åˆ†å¸ƒå¼ç¼“å­˜ (Redis) 
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // L3: æ•°æ®åº“
    @Autowired
    private PermissionRepository permissionRepository;
    
    /**
     * è·å–ç”¨æˆ·æƒé™ (å¤šçº§ç¼“å­˜ç­–ç•¥)
     */
    public Set<Permission> getUserPermissions(String userId) {
        // L1ç¼“å­˜æŸ¥æ‰¾
        Set<Permission> permissions = localCache.getIfPresent(userId);
        if (permissions != null) {
            return permissions;
        }
        
        // L2ç¼“å­˜æŸ¥æ‰¾
        String cacheKey = "user:permissions:" + userId;
        permissions = (Set<Permission>) redisTemplate.opsForValue().get(cacheKey);
        if (permissions != null) {
            // å›å¡«L1ç¼“å­˜
            localCache.put(userId, permissions);
            return permissions;
        }
        
        // L3æ•°æ®åº“æŸ¥æ‰¾
        permissions = loadPermissionsFromDatabase(userId);
        
        // å›å¡«æ‰€æœ‰ç¼“å­˜å±‚çº§
        redisTemplate.opsForValue().set(cacheKey, permissions, Duration.ofHours(1));
        localCache.put(userId, permissions);
        
        return permissions;
    }
    
    /**
     * æƒé™å˜æ›´æ—¶çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥
     */
    public void invalidateUserPermissions(String userId) {
        // æ¸…é™¤L1ç¼“å­˜
        localCache.invalidate(userId);
        
        // æ¸…é™¤L2ç¼“å­˜
        String cacheKey = "user:permissions:" + userId;
        redisTemplate.delete(cacheKey);
        
        // å‘å¸ƒç¼“å­˜å¤±æ•ˆæ¶ˆæ¯ (å¦‚æœæ˜¯é›†ç¾¤ç¯å¢ƒ)
        publishCacheInvalidationEvent(userId);
    }
}
```

---

# 7. ğŸš€ å®æˆ˜åº”ç”¨æŒ‡å—



## 7.1 å¾®æœåŠ¡æƒé™æ¶æ„è®¾è®¡



```
å¾®æœåŠ¡æƒé™æ¶æ„å…¨æ™¯å›¾ï¼š

                    å‰ç«¯åº”ç”¨
                       â†“
                   APIç½‘å…³
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   è®¤è¯æˆæƒä¸­å¿ƒ    â”‚
              â”‚  - JWTç­¾å‘      â”‚ 
              â”‚  - æƒé™éªŒè¯      â”‚
              â”‚  - ç­–ç•¥ç®¡ç†      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“         â†“         â†“         â†“         â†“
    ç”¨æˆ·æœåŠ¡   è®¢å•æœåŠ¡   å•†å“æœåŠ¡   æ”¯ä»˜æœåŠ¡   é€šçŸ¥æœåŠ¡
    â†“         â†“         â†“         â†“         â†“
  æƒé™ç¼“å­˜   æƒé™ç¼“å­˜   æƒé™ç¼“å­˜   æƒé™ç¼“å­˜   æƒé™ç¼“å­˜
```

## 7.2 æƒé™ç½‘å…³å®ç°



```java
// æƒé™æ£€æŸ¥ç½‘å…³è¿‡æ»¤å™¨
@Component
public class AuthorizationGatewayFilter implements GlobalFilter {
    
    @Autowired
    private AuthorizationService authorizationService;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        
        // æå–JWT Token
        String token = extractToken(request);
        if (token == null) {
            return unauthorized(exchange);
        }
        
        // è§£æç”¨æˆ·ä¿¡æ¯
        String userId = parseUserIdFromToken(token);
        String requestPath = request.getPath().value();
        String requestMethod = request.getMethod().name();
        
        // æ„å»ºæƒé™æ£€æŸ¥è¯·æ±‚
        AuthorizationRequest authRequest = AuthorizationRequest.builder()
            .userId(userId)
            .resource(requestPath)
            .action(requestMethod)
            .clientIp(getClientIp(request))
            .build();
        
        // å¼‚æ­¥æƒé™æ£€æŸ¥
        return authorizationService.checkPermission(authRequest)
            .flatMap(result -> {
                if (result.isPermitted()) {
                    // æƒé™æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­å¤„ç†
                    return chain.filter(exchange);
                } else {
                    // æƒé™ä¸è¶³ï¼Œè¿”å›403
                    return forbidden(exchange, result.getReason());
                }
            })
            .onErrorResume(ex -> {
                // æƒé™æ£€æŸ¥å¼‚å¸¸ï¼Œè®°å½•æ—¥å¿—å¹¶æ‹’ç»è®¿é—®
                log.error("Authorization check failed", ex);
                return serverError(exchange);
            });
    }
}
```

## 7.3 æœåŠ¡é—´è°ƒç”¨æƒé™æ§åˆ¶



```java
// æœåŠ¡é—´è°ƒç”¨æƒé™æ‹¦æˆªå™¨
@Component
public class ServiceAuthInterceptor implements ClientHttpRequestInterceptor {
    
    @Value("${spring.application.name}")
    private String serviceName;
    
    @Autowired
    private ServiceTokenManager tokenManager;
    
    @Override
    public ClientHttpResponse intercept(
            HttpRequest request, 
            byte[] body, 
            ClientHttpRequestExecution execution) throws IOException {
        
        // 1. ç”ŸæˆæœåŠ¡é—´è°ƒç”¨token
        String serviceToken = tokenManager.generateServiceToken(
            serviceName, 
            getTargetServiceName(request.getURI())
        );
        
        // 2. æ·»åŠ åˆ°è¯·æ±‚å¤´
        request.getHeaders().add("X-Service-Token", serviceToken);
        request.getHeaders().add("X-Source-Service", serviceName);
        
        // 3. ç»§ç»­è¯·æ±‚
        return execution.execute(request, body);
    }
}

// æœåŠ¡é—´è°ƒç”¨æƒé™éªŒè¯
@Component
public class ServiceAuthValidator {
    
    /**
     * éªŒè¯æœåŠ¡é—´è°ƒç”¨æƒé™
     */
    public boolean validateServiceCall(String sourceService, String targetEndpoint) {
        // 1. æ£€æŸ¥æœåŠ¡è°ƒç”¨ç™½åå•
        if (!isServiceCallAllowed(sourceService, getCurrentServiceName())) {
            return false;
        }
        
        // 2. æ£€æŸ¥æ¥å£è®¿é—®æƒé™
        if (!isEndpointAccessAllowed(sourceService, targetEndpoint)) {
            return false;
        }
        
        // 3. æ£€æŸ¥è°ƒç”¨é¢‘ç‡é™åˆ¶
        if (isRateLimitExceeded(sourceService)) {
            return false;
        }
        
        return true;
    }
}
```

---

# 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æˆæƒæ§åˆ¶æœ¬è´¨ï¼šå†³å®š"å·²è®¤è¯ç”¨æˆ·"èƒ½è®¿é—®"å“ªäº›èµ„æº"æ‰§è¡Œ"ä»€ä¹ˆæ“ä½œ"
ğŸ”¸ RBACæ¨¡å‹ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼Œé€‚åˆç»„ç»‡æ¶æ„æ˜ç¡®çš„åœºæ™¯  
ğŸ”¸ ABACæ¨¡å‹ï¼šåŸºäºå±æ€§çš„æƒé™æ§åˆ¶ï¼Œé€‚åˆå¤æ‚ä¸šåŠ¡è§„åˆ™çš„åœºæ™¯
ğŸ”¸ ç»†ç²’åº¦æƒé™ï¼šä»åŠŸèƒ½çº§æ·±å…¥åˆ°æ•°æ®çº§çš„ç²¾ç¡®æƒé™æ§åˆ¶
ğŸ”¸ åŠ¨æ€æƒé™ï¼šæ ¹æ®ä¸Šä¸‹æ–‡å’Œä¸šåŠ¡è§„åˆ™å®æ—¶è®¡ç®—çš„æƒé™
ğŸ”¸ æƒé™ç¼“å­˜ï¼šå¤šçº§ç¼“å­˜æå‡æƒé™æ£€æŸ¥æ€§èƒ½
ğŸ”¸ æƒé™å®¡è®¡ï¼šåˆè§„è¦æ±‚å’Œå®‰å…¨ç›‘æ§çš„é‡è¦æ‰‹æ®µ
```

## 8.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ é€‰æ‹©åˆé€‚çš„æƒé™æ¨¡å‹**
```
ç®€å•ç»„ç»‡ç»“æ„ + ç›¸å¯¹å›ºå®šæƒé™ï¼š
â†’ é€‰æ‹©RBACæ¨¡å‹
â†’ å¼€å‘ç®€å•ï¼Œç»´æŠ¤å®¹æ˜“

å¤æ‚ä¸šåŠ¡è§„åˆ™ + åŠ¨æ€æƒé™éœ€æ±‚ï¼š  
â†’ é€‰æ‹©ABACæ¨¡å‹
â†’ çµæ´»å¼ºå¤§ï¼Œä½†å®ç°å¤æ‚

ä¸­å°å‹ç³»ç»Ÿï¼š
â†’ RBAC + å°‘é‡ABACè¡¥å……
â†’ å¹³è¡¡å¤æ‚åº¦å’ŒåŠŸèƒ½éœ€æ±‚
```

**ğŸ”¹ å¾®æœåŠ¡æƒé™è®¾è®¡åŸåˆ™**
```
ç»Ÿä¸€è®¤è¯ï¼Œåˆ†å¸ƒå¼æˆæƒï¼š
- è®¤è¯åœ¨ç½‘å…³å±‚ç»Ÿä¸€å¤„ç†
- æˆæƒå¯ä»¥åœ¨å„æœåŠ¡åˆ†åˆ«å¤„ç†

æ€§èƒ½ä¼˜å…ˆï¼Œå®‰å…¨ä¸ºæœ¬ï¼š
- åˆç†ä½¿ç”¨ç¼“å­˜æå‡æ€§èƒ½  
- ç¡®ä¿æƒé™æ•°æ®çš„ä¸€è‡´æ€§

æœ€å°æƒé™åŸåˆ™ï¼š
- ç”¨æˆ·åªè·å¾—å¿…éœ€çš„æœ€å°æƒé™
- æƒé™å®šæœŸå®¡æ ¸å’Œæ¸…ç†
```

## 8.3 å®é™…åº”ç”¨å»ºè®®



**ğŸ¯ æƒé™è®¾è®¡æœ€ä½³å®è·µ**
- **ç²’åº¦é€‚ä¸­**ï¼šæ—¢ä¸è¿‡ç²—ä¹Ÿä¸è¿‡ç»†ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦è®¾è®¡
- **æ˜“äºç†è§£**ï¼šæƒé™å‘½åå’Œåˆ†ç»„è¦ç¬¦åˆä¸šåŠ¡äººå‘˜ç†è§£
- **ä¾¿äºç®¡ç†**ï¼šæä¾›å¯è§†åŒ–çš„æƒé™ç®¡ç†ç•Œé¢
- **æ€§èƒ½å‹å¥½**ï¼šåˆç†ä½¿ç”¨ç¼“å­˜ï¼Œé¿å…é¢‘ç¹æ•°æ®åº“æŸ¥è¯¢

**âš ï¸ å¸¸è§é—®é¢˜é¿å…**
- **æƒé™çˆ†ç‚¸**ï¼šè¿‡åº¦è®¾è®¡å¯¼è‡´æƒé™æ•°é‡å¤±æ§
- **å¾ªç¯ä¾èµ–**ï¼šè§’è‰²ç»§æ‰¿å‡ºç°å¾ªç¯å¼•ç”¨
- **ç¼“å­˜ä¸€è‡´æ€§**ï¼šæƒé™å˜æ›´åç¼“å­˜æœªåŠæ—¶æ›´æ–°
- **å®¡è®¡ç¼ºå¤±**ï¼šæ²¡æœ‰å®Œæ•´çš„æƒé™æ“ä½œå®¡è®¡è®°å½•

**ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®**
- **å°å‹é¡¹ç›®**ï¼šSpring Security + ç®€å•RBAC
- **ä¸­å‹é¡¹ç›®**ï¼šSpring Security + JWT + Redisç¼“å­˜
- **å¤§å‹é¡¹ç›®**ï¼šç‹¬ç«‹æˆæƒä¸­å¿ƒ + åˆ†å¸ƒå¼ç¼“å­˜ + å®Œæ•´å®¡è®¡

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è®¤è¯è¯èº«ä»½ï¼Œæˆæƒç®¡æƒé™
- RBACç®€å•ç”¨ï¼ŒABACè§„åˆ™æ´»
- ç¼“å­˜ææ€§èƒ½ï¼Œå®¡è®¡ä¿åˆè§„
- æœ€å°æƒé™å¥½ï¼Œå®šæœŸè¦æ¸…ç†