---
title: 1ã€æ•°æ®åº“æ‹†åˆ†æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡æ•°æ®ç®¡ç†æ¦‚è¿°](#1-å¾®æœåŠ¡æ•°æ®ç®¡ç†æ¦‚è¿°)
2. [æ•°æ®åº“æ‹†åˆ†åŸºæœ¬åŸåˆ™](#2-æ•°æ®åº“æ‹†åˆ†åŸºæœ¬åŸåˆ™)
3. [æ¯æœåŠ¡ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼](#3-æ¯æœåŠ¡ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼)
4. [å…±äº«æ•°æ®åº“åæ¨¡å¼](#4-å…±äº«æ•°æ®åº“åæ¨¡å¼)
5. [æ•°æ®åŒæ­¥ç­–ç•¥](#5-æ•°æ®åŒæ­¥ç­–ç•¥)
6. [è¯»å†™åˆ†ç¦»ä¸åˆ†åº“åˆ†è¡¨](#6-è¯»å†™åˆ†ç¦»ä¸åˆ†åº“åˆ†è¡¨)
7. [æ•°æ®ä¸€è‡´æ€§ä¿éšœ](#7-æ•°æ®ä¸€è‡´æ€§ä¿éšœ)
8. [è·¨æœåŠ¡æŸ¥è¯¢è§£å†³æ–¹æ¡ˆ](#8-è·¨æœåŠ¡æŸ¥è¯¢è§£å†³æ–¹æ¡ˆ)
9. [æ•°æ®è¿ç§»ç­–ç•¥](#9-æ•°æ®è¿ç§»ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—„ï¸ å¾®æœåŠ¡æ•°æ®ç®¡ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ•°æ®ç®¡ç†


ğŸ’­ **æ€è€ƒä¸€ä¸‹**ï¼šå¦‚æœæŠŠä¸€ä¸ªå¤§å‹åº”ç”¨æ¯”ä½œä¸€æ ‹å¤§æ¥¼ï¼Œé‚£ä¼ ç»Ÿçš„å•ä½“åº”ç”¨å°±åƒæ‰€æœ‰éƒ¨é—¨éƒ½å…±ç”¨ä¸€ä¸ªå¤§ä»“åº“ï¼Œè€Œå¾®æœåŠ¡å°±åƒæ¯ä¸ªéƒ¨é—¨éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ä»“åº“ã€‚

**ğŸ·ï¸ æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- `å¾®æœåŠ¡æ•°æ®ç®¡ç†` = æ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„æ•°æ®
- `æ•°æ®éš”ç¦»` = æœåŠ¡ä¹‹é—´ä¸ç›´æ¥è®¿é—®å¯¹æ–¹çš„æ•°æ®åº“
- `å»ä¸­å¿ƒåŒ–` = æ²¡æœ‰ç»Ÿä¸€çš„æ•°æ®å­˜å‚¨ä¸­å¿ƒ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ‹†åˆ†


ğŸ¤” **ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼š

**ä¼ ç»Ÿå•ä½“åº”ç”¨çš„é—®é¢˜**ï¼š
```
å•ä½“åº”ç”¨æ•°æ®ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¤§å‹æ•°æ®åº“              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·è¡¨ | è®¢å•è¡¨ | å•†å“è¡¨ | æ”¯ä»˜è¡¨ â”‚
â”‚ è¯„è®ºè¡¨ | ç‰©æµè¡¨ | è´¢åŠ¡è¡¨ | ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
    æ‰€æœ‰æœåŠ¡éƒ½è®¿é—®

é—®é¢˜ï¼š
âŒ æ•°æ®åº“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
âŒ ä¸€ä¸ªè¡¨ç»“æ„å˜æ›´å½±å“æ‰€æœ‰æœåŠ¡
âŒ æ— æ³•æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ•°æ®åº“
âŒ æ‰©å±•å›°éš¾ï¼Œéš¾ä»¥æ°´å¹³æ‰©å±•
```

**å¾®æœåŠ¡æ•°æ®ç®¡ç†çš„ä¼˜åŠ¿**ï¼š
```
å¾®æœåŠ¡æ•°æ®ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ·æœåŠ¡  â”‚ â”‚è®¢å•æœåŠ¡  â”‚ â”‚å•†å“æœåŠ¡  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ç”¨æˆ·æ•°æ®åº“â”‚ â”‚è®¢å•æ•°æ®åº“â”‚ â”‚å•†å“æ•°æ®åº“â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŠ¿ï¼š
âœ… æ¯ä¸ªæœåŠ¡å¯ç‹¬ç«‹æ‰©å±•
âœ… å¯é€‰æ‹©æœ€é€‚åˆçš„æ•°æ®åº“ç±»å‹
âœ… æ•…éšœéš”ç¦»ï¼Œä¸€ä¸ªæ•°æ®åº“é—®é¢˜ä¸å½±å“å…¶ä»–æœåŠ¡
âœ… å›¢é˜Ÿå¯ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
```

### 1.3 æ•°æ®ç®¡ç†çš„æ ¸å¿ƒæŒ‘æˆ˜


âš ï¸ **é‡è¦æé†’**ï¼šæ•°æ®æ‹†åˆ†å¸¦æ¥çµæ´»æ€§ï¼Œä½†ä¹Ÿå¼•å…¥äº†å¤æ‚æ€§

**ä¸»è¦æŒ‘æˆ˜**ï¼š
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå¦‚ä½•ä¿è¯è·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´
- **äº‹åŠ¡ç®¡ç†**ï¼šåˆ†å¸ƒå¼äº‹åŠ¡æ¯”å•æœºäº‹åŠ¡å¤æ‚
- **æ•°æ®æŸ¥è¯¢**ï¼šå¦‚ä½•è¿›è¡Œè·¨æœåŠ¡çš„æ•°æ®æŸ¥è¯¢
- **æ•°æ®åŒæ­¥**ï¼šæœåŠ¡é—´å¦‚ä½•åŒæ­¥å¿…è¦çš„æ•°æ®

---

## 2. ğŸ“‹ æ•°æ®åº“æ‹†åˆ†åŸºæœ¬åŸåˆ™


### 2.1 ä¸šåŠ¡è¾¹ç•Œä¼˜å…ˆåŸåˆ™


ğŸ¯ **æ ¸å¿ƒæ€æƒ³**ï¼šæŒ‰ç…§ä¸šåŠ¡é¢†åŸŸæ¥åˆ’åˆ†æ•°æ®ï¼Œè€Œä¸æ˜¯æŒ‰ç…§æŠ€æœ¯å±‚é¢

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼š
```
ç”µå•†ç³»ç»Ÿçš„ä¸šåŠ¡åˆ’åˆ†ï¼š

ç”¨æˆ·åŸŸï¼š
- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- ç”¨æˆ·åå¥½è®¾ç½®
- ç”¨æˆ·è®¤è¯ä¿¡æ¯

è®¢å•åŸŸï¼š
- è®¢å•åŸºæœ¬ä¿¡æ¯
- è®¢å•çŠ¶æ€
- è®¢å•å•†å“æ¸…å•

å•†å“åŸŸï¼š
- å•†å“åŸºæœ¬ä¿¡æ¯
- å•†å“åº“å­˜
- å•†å“åˆ†ç±»

è€Œä¸æ˜¯æŒ‰æŠ€æœ¯åˆ’åˆ†ï¼š
âŒ æ‰€æœ‰ä¸»è¡¨æ”¾ä¸€ä¸ªæ•°æ®åº“
âŒ æ‰€æœ‰æ—¥å¿—è¡¨æ”¾ä¸€ä¸ªæ•°æ®åº“
âŒ æ‰€æœ‰é…ç½®è¡¨æ”¾ä¸€ä¸ªæ•°æ®åº“
```

### 2.2 æ•°æ®æ‰€æœ‰æƒæ˜ç¡®


ğŸ”‘ **å…³é”®åŸåˆ™**ï¼šæ¯ä»½æ•°æ®åªèƒ½ç”±ä¸€ä¸ªæœåŠ¡æ‹¥æœ‰å’Œä¿®æ”¹

```
æ•°æ®æ‰€æœ‰æƒç¤ºä¾‹ï¼š

ç”¨æˆ·æœåŠ¡æ‹¥æœ‰ï¼š
âœ… ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€é‚®ç®±ç­‰ï¼‰
âœ… ç”¨æˆ·çŠ¶æ€ï¼ˆæ´»è·ƒã€å†»ç»“ç­‰ï¼‰

è®¢å•æœåŠ¡æ‹¥æœ‰ï¼š
âœ… è®¢å•ä¿¡æ¯
âœ… è®¢å•çŠ¶æ€
âŒ ä¸èƒ½ç›´æ¥ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯

å•†å“æœåŠ¡æ‹¥æœ‰ï¼š
âœ… å•†å“ä¿¡æ¯
âœ… åº“å­˜æ•°é‡
âŒ ä¸èƒ½ç›´æ¥ä¿®æ”¹è®¢å•çŠ¶æ€
```

### 2.3 æ¾è€¦åˆè®¾è®¡


ğŸ”„ **è®¾è®¡åŸåˆ™**ï¼šæœåŠ¡é—´é€šè¿‡æ˜ç¡®çš„æ¥å£äº¤äº’ï¼Œä¸ç›´æ¥è®¿é—®å¯¹æ–¹æ•°æ®åº“

**æ­£ç¡®çš„æ–¹å¼**ï¼š
```
æœåŠ¡Aéœ€è¦æœåŠ¡Bçš„æ•°æ®ï¼š
æœåŠ¡A â†’ APIè°ƒç”¨ â†’ æœåŠ¡B â†’ è¿”å›æ•°æ® â†’ æœåŠ¡A

è€Œä¸æ˜¯ï¼š
æœåŠ¡A â†’ ç›´æ¥è¿æ¥ â†’ æœåŠ¡Bçš„æ•°æ®åº“ âŒ
```

---

## 3. ğŸ—ï¸ æ¯æœåŠ¡ç‹¬ç«‹æ•°æ®åº“æ¨¡å¼


### 3.1 æ¨¡å¼å®šä¹‰


ğŸ’¡ **ä¸€å¥è¯æ€»ç»“**ï¼šæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±ä¸“å±çš„æ•°æ®åº“ï¼Œå…¶ä»–æœåŠ¡ä¸èƒ½ç›´æ¥è®¿é—®

### 3.2 å®ç°æ–¹å¼


#### ğŸ“¦ ç‰©ç†éš”ç¦»æ–¹å¼


**æ–¹å¼ä¸€ï¼šç‹¬ç«‹æ•°æ®åº“å®ä¾‹**
```
æ¯ä¸ªæœåŠ¡ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“æœåŠ¡å™¨ï¼š

ç”¨æˆ·æœåŠ¡ â†’ MySQLå®ä¾‹1 (ç«¯å£3306)
è®¢å•æœåŠ¡ â†’ MySQLå®ä¾‹2 (ç«¯å£3307)  
å•†å“æœåŠ¡ â†’ PostgreSQLå®ä¾‹ (ç«¯å£5432)
```

**æ–¹å¼äºŒï¼šåŒå®ä¾‹ä¸åŒæ•°æ®åº“**
```
å…±äº«æ•°æ®åº“æœåŠ¡å™¨ï¼Œä½†ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“ï¼š

MySQLæœåŠ¡å™¨ï¼š
â”œâ”€â”€ user_service_db
â”œâ”€â”€ order_service_db  
â””â”€â”€ product_service_db
```

**æ–¹å¼ä¸‰ï¼šä¸åŒæ•°æ®åº“ç±»å‹**
```
æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©ä¸åŒç±»å‹çš„æ•°æ®åº“ï¼š

ç”¨æˆ·æœåŠ¡ â†’ MySQL (å…³ç³»å‹æ•°æ®)
å•†å“æœåŠ¡ â†’ PostgreSQL (å¤æ‚æŸ¥è¯¢)
æ—¥å¿—æœåŠ¡ â†’ MongoDB (æ–‡æ¡£å‹æ•°æ®)
ç¼“å­˜æœåŠ¡ â†’ Redis (é”®å€¼å­˜å‚¨)
```

#### ğŸ”§ æŠ€æœ¯å®ç°ç¤ºä¾‹


```java
// ç”¨æˆ·æœåŠ¡çš„æ•°æ®åº“é…ç½®
@Configuration
public class UserServiceDataConfig {
    
    @Bean
    @Primary
    public DataSource userDataSource() {
        return DataSourceBuilder.create()
            .url("jdbc:mysql://user-db:3306/user_service")
            .username("user_service")
            .password("password")
            .build();
    }
}

// è®¢å•æœåŠ¡çš„æ•°æ®åº“é…ç½®  
@Configuration
public class OrderServiceDataConfig {
    
    @Bean
    @Primary
    public DataSource orderDataSource() {
        return DataSourceBuilder.create()
            .url("jdbc:mysql://order-db:3306/order_service")
            .username("order_service") 
            .password("password")
            .build();
    }
}
```

### 3.3 ä¼˜åŠ¿ä¸æŒ‘æˆ˜


**âœ… ä¸»è¦ä¼˜åŠ¿**ï¼š

| æ–¹é¢ | å…·ä½“ä¼˜åŠ¿ | å®é™…æ•ˆæœ |
|------|----------|----------|
| **ç‹¬ç«‹æ‰©å±•** | æ ¹æ®ä¸šåŠ¡è´Ÿè½½ç‹¬ç«‹æ‰©å±• | ç”¨æˆ·æœåŠ¡æ•°æ®åº“å¯ä»¥ç‹¬ç«‹å‡çº§é…ç½® |
| **æŠ€æœ¯é€‰å‹** | é€‰æ‹©æœ€é€‚åˆçš„æ•°æ®åº“ç±»å‹ | æœç´¢ç”¨ESï¼Œç”¨æˆ·æ•°æ®ç”¨MySQL |
| **æ•…éšœéš”ç¦»** | ä¸€ä¸ªæ•°æ®åº“æ•…éšœä¸å½±å“å…¶ä»–æœåŠ¡ | è®¢å•æ•°æ®åº“å®•æœºä¸å½±å“ç”¨æˆ·ç™»å½• |
| **å›¢é˜Ÿç‹¬ç«‹** | å›¢é˜Ÿå¯ç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½² | ä¸éœ€è¦åè°ƒæ•°æ®åº“å˜æ›´ |

**âŒ ä¸»è¦æŒ‘æˆ˜**ï¼š

ğŸš¨ **é‡è¦æé†’**ï¼šç‹¬ç«‹æ•°æ®åº“è™½ç„¶å¸¦æ¥çµæ´»æ€§ï¼Œä½†ä¹Ÿå¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦

- **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šè·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯å›°éš¾
- **æ•°æ®å†—ä½™**ï¼šå¯èƒ½éœ€è¦åœ¨å¤šä¸ªæœåŠ¡ä¸­å­˜å‚¨ç›¸åŒæ•°æ®
- **æŸ¥è¯¢å¤æ‚**ï¼šè·¨æœåŠ¡æŸ¥è¯¢éœ€è¦å¤šæ¬¡APIè°ƒç”¨
- **è¿ç»´æˆæœ¬**ï¼šéœ€è¦ç®¡ç†å¤šä¸ªæ•°æ®åº“å®ä¾‹

---

## 4. âš ï¸ å…±äº«æ•°æ®åº“åæ¨¡å¼


### 4.1 ä»€ä¹ˆæ˜¯å…±äº«æ•°æ®åº“åæ¨¡å¼


ğŸ·ï¸ **åæ¨¡å¼å®šä¹‰**ï¼šå¤šä¸ªå¾®æœåŠ¡å…±äº«åŒä¸€ä¸ªæ•°æ®åº“æˆ–æ•°æ®è¡¨çš„è®¾è®¡æ–¹å¼

ğŸ’­ **æ€è€ƒä¸€ä¸‹**ï¼šå°±åƒå¤šä¸ªéƒ¨é—¨å…±ç”¨ä¸€ä¸ªæ–‡ä»¶æŸœï¼Œçœ‹èµ·æ¥æ–¹ä¾¿ï¼Œä½†ä¼šé€ æˆå¾ˆå¤šé—®é¢˜

### 4.2 å¸¸è§çš„å…±äº«æ•°æ®åº“åœºæ™¯


**åœºæ™¯ä¸€ï¼šå¤šæœåŠ¡å…±äº«æ•°æ®åº“**
```
é”™è¯¯è®¾è®¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ·æœåŠ¡  â”‚ â”‚è®¢å•æœåŠ¡  â”‚ â”‚å•†å“æœåŠ¡  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“          â†“          â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚        å…±äº«æ•°æ®åº“            â”‚
  â”‚ ç”¨æˆ·è¡¨|è®¢å•è¡¨|å•†å“è¡¨|...     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯äºŒï¼šå¤šæœåŠ¡å…±äº«æ•°æ®è¡¨**
```
é”™è¯¯è®¾è®¡ï¼š
ç”¨æˆ·æœåŠ¡ â†’ è¯»å†™ç”¨æˆ·è¡¨
è®¢å•æœåŠ¡ â†’ è¯»å–ç”¨æˆ·è¡¨ (è·å–ç”¨æˆ·ä¿¡æ¯)
è¥é”€æœåŠ¡ â†’ è¯»å–ç”¨æˆ·è¡¨ (ç”¨æˆ·ç”»åƒåˆ†æ)

é—®é¢˜ï¼šä¸€ä¸ªè¡¨è¢«å¤šä¸ªæœåŠ¡ç›´æ¥è®¿é—®
```

### 4.3 ä¸ºä»€ä¹ˆæ˜¯åæ¨¡å¼


ğŸ’¥ **å®¹æ˜“å‡ºé”™**ï¼šå…±äº«æ•°æ®åº“è¿èƒŒäº†å¾®æœåŠ¡çš„æ ¸å¿ƒåŸåˆ™

**ä¸»è¦é—®é¢˜**ï¼š

1. **ç´§è€¦åˆ**ï¼š
```
ç”¨æˆ·è¡¨ç»“æ„å˜æ›´ï¼š
ç”¨æˆ·æœåŠ¡ï¼šéœ€è¦æ·»åŠ æ–°å­—æ®µ
â†“
å½±å“è®¢å•æœåŠ¡ï¼šæŸ¥è¯¢è¯­å¥å¯èƒ½æŠ¥é”™  
â†“
å½±å“è¥é”€æœåŠ¡ï¼šä¾èµ–çš„å­—æ®µå¯èƒ½å˜åŒ–
â†“
éœ€è¦æ‰€æœ‰æœåŠ¡åŒæ—¶æ›´æ–°å’Œéƒ¨ç½²
```

2. **æ€§èƒ½ç“¶é¢ˆ**ï¼š
```
æ•°æ®åº“è´Ÿè½½åˆ†æï¼š
ç”¨æˆ·æœåŠ¡ï¼šé«˜å¹¶å‘è¯»å†™ç”¨æˆ·æ•°æ®
è®¢å•æœåŠ¡ï¼šå¤§é‡è®¢å•æŸ¥è¯¢
å•†å“æœåŠ¡ï¼šå•†å“ä¿¡æ¯æ›´æ–°
æ—¥å¿—æœåŠ¡ï¼šå¤§é‡æ—¥å¿—å†™å…¥
â†“
å•ä¸ªæ•°æ®åº“æ‰¿å—æ‰€æœ‰æœåŠ¡çš„è´Ÿè½½
```

3. **æ‰©å±•å›°éš¾**ï¼š
```
æ‰©å±•éœ€æ±‚ï¼š
ç”¨æˆ·æœåŠ¡ï¼šéœ€è¦è¯»å†™åˆ†ç¦»
å•†å“æœåŠ¡ï¼šéœ€è¦åˆ†åº“åˆ†è¡¨
è®¢å•æœåŠ¡ï¼šéœ€è¦åˆ‡æ¢åˆ°NoSQL
â†“
å…±äº«æ•°æ®åº“æ— æ³•æ»¡è¶³ä¸åŒæœåŠ¡çš„ä¸ªæ€§åŒ–éœ€æ±‚
```

### 4.4 å¦‚ä½•é¿å…å…±äº«æ•°æ®åº“åæ¨¡å¼


ğŸ¯ **æœ€ä½³å®è·µ**ï¼š

**ç­–ç•¥ä¸€ï¼šæ•°æ®æ‹†åˆ†**
```java
// åŸæ¥çš„å…±äº«ç”¨æˆ·è¡¨
// æ‹†åˆ†ä¸ºï¼š

// ç”¨æˆ·æœåŠ¡ï¼šç”¨æˆ·åŸºæœ¬ä¿¡æ¯
@Entity
public class User {
    private Long userId;
    private String username;
    private String email;
    // åªä¿ç•™ç”¨æˆ·æœåŠ¡éœ€è¦çš„å­—æ®µ
}

// è®¢å•æœåŠ¡ï¼šç”¨æˆ·è®¢å•ç›¸å…³ä¿¡æ¯
@Entity  
public class OrderUser {
    private Long userId;
    private String username; // å†—ä½™å­˜å‚¨
    private String shippingAddress;
    // åªä¿ç•™è®¢å•ç›¸å…³çš„ç”¨æˆ·ä¿¡æ¯
}
```

**ç­–ç•¥äºŒï¼šAPIè°ƒç”¨æ›¿ä»£ç›´æ¥è®¿é—®**
```java
// è®¢å•æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
@Service
public class OrderService {
    
    @Autowired
    private UserServiceClient userServiceClient;
    
    public Order createOrder(Long userId, List<OrderItem> items) {
        // é€šè¿‡APIè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ç›´æ¥æŸ¥è¯¢ç”¨æˆ·è¡¨
        User user = userServiceClient.getUserById(userId);
        
        Order order = new Order();
        order.setUserId(userId);
        order.setUserName(user.getUsername());
        // ...
        return orderRepository.save(order);
    }
}
```

---

## 5. ğŸ”„ æ•°æ®åŒæ­¥ç­–ç•¥


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åŒæ­¥


ğŸ¤” **ä¸ºä»€ä¹ˆè¿™æ ·**ï¼šè™½ç„¶æ¯ä¸ªæœåŠ¡æœ‰ç‹¬ç«‹æ•°æ®åº“ï¼Œä½†æœ‰æ—¶éœ€è¦å…¶ä»–æœåŠ¡çš„æ•°æ®

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼š
```
è®¢å•æœåŠ¡åˆ›å»ºè®¢å•æ—¶éœ€è¦ï¼š
- ç”¨æˆ·ä¿¡æ¯ï¼ˆæ¥è‡ªç”¨æˆ·æœåŠ¡ï¼‰
- å•†å“ä¿¡æ¯ï¼ˆæ¥è‡ªå•†å“æœåŠ¡ï¼‰
- åº“å­˜ä¿¡æ¯ï¼ˆæ¥è‡ªåº“å­˜æœåŠ¡ï¼‰

å¦‚æœæ¯æ¬¡éƒ½å®æ—¶è°ƒç”¨APIï¼š
- ç½‘ç»œå»¶è¿Ÿå½±å“æ€§èƒ½
- ä¾èµ–æœåŠ¡æ•…éšœä¼šå¯¼è‡´è®¢å•åˆ›å»ºå¤±è´¥
- é«˜å¹¶å‘æ—¶å¯èƒ½é€ æˆæœåŠ¡é›ªå´©
```

### 5.2 äº‹ä»¶é©±åŠ¨åŒæ­¥


ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼šå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸»åŠ¨é€šçŸ¥ç›¸å…³æœåŠ¡

#### ğŸ“¨ å¼‚æ­¥æ¶ˆæ¯åŒæ­¥


```
äº‹ä»¶æµç¨‹ï¼š
ç”¨æˆ·æœåŠ¡ â†’ ç”¨æˆ·ä¿¡æ¯å˜æ›´ â†’ å‘å¸ƒäº‹ä»¶ â†’ æ¶ˆæ¯é˜Ÿåˆ— 
                                      â†“
è®¢å•æœåŠ¡ â† æ›´æ–°æœ¬åœ°ç”¨æˆ·ä¿¡æ¯ â† æ¥æ”¶äº‹ä»¶ â†â”˜
```

**å®ç°ç¤ºä¾‹**ï¼š
```java
// ç”¨æˆ·æœåŠ¡ï¼šå‘å¸ƒç”¨æˆ·å˜æ›´äº‹ä»¶
@Service
public class UserService {
    
    @Autowired
    private MessagePublisher messagePublisher;
    
    public void updateUser(User user) {
        userRepository.save(user);
        
        // å‘å¸ƒç”¨æˆ·å˜æ›´äº‹ä»¶
        UserChangedEvent event = new UserChangedEvent(
            user.getUserId(),
            user.getUsername(),
            user.getEmail()
        );
        messagePublisher.publish("user.changed", event);
    }
}

// è®¢å•æœåŠ¡ï¼šç›‘å¬ç”¨æˆ·å˜æ›´äº‹ä»¶
@EventListener
public class OrderUserSyncHandler {
    
    @RabbitListener(queues = "user.changed")
    public void handleUserChanged(UserChangedEvent event) {
        // æ›´æ–°è®¢å•æœåŠ¡ä¸­çš„ç”¨æˆ·ä¿¡æ¯
        OrderUser orderUser = orderUserRepository
            .findByUserId(event.getUserId());
        
        if (orderUser != null) {
            orderUser.setUsername(event.getUsername());
            orderUser.setEmail(event.getEmail());
            orderUserRepository.save(orderUser);
        }
    }
}
```

#### ğŸ“Š æ•°æ®åº“æ—¥å¿—åŒæ­¥


**CDC (Change Data Capture) æ–¹å¼**ï¼š
```
åŒæ­¥æµç¨‹ï¼š
MySQL Binlog â†’ Debezium â†’ Kafka â†’ å„ä¸ªæœåŠ¡æ¶ˆè´¹
```

### 5.3 APIè°ƒç”¨åŒæ­¥


ğŸ”„ **æ¢å¥è¯è¯´**ï¼šå®æ—¶è°ƒç”¨å…¶ä»–æœåŠ¡çš„APIè·å–æœ€æ–°æ•°æ®

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®å®æ—¶æ€§è¦æ±‚é«˜
- æ•°æ®é‡ä¸å¤§
- è°ƒç”¨é¢‘ç‡ä¸é«˜

```java
// å®æ—¶APIè°ƒç”¨ç¤ºä¾‹
@Service
public class OrderService {
    
    @Autowired
    private UserServiceClient userClient;
    
    @Autowired  
    private ProductServiceClient productClient;
    
    public Order createOrder(CreateOrderRequest request) {
        // å®æ—¶è·å–ç”¨æˆ·ä¿¡æ¯
        User user = userClient.getUser(request.getUserId());
        if (user == null) {
            throw new UserNotFoundException();
        }
        
        // å®æ—¶è·å–å•†å“ä¿¡æ¯
        Product product = productClient.getProduct(request.getProductId());
        if (product == null || product.getStock() < request.getQuantity()) {
            throw new InsufficientStockException();
        }
        
        // åˆ›å»ºè®¢å•
        Order order = buildOrder(user, product, request);
        return orderRepository.save(order);
    }
}
```

### 5.4 æ•°æ®åŒæ­¥ç­–ç•¥å¯¹æ¯”


| åŒæ­¥æ–¹å¼ | **å®æ—¶æ€§** | **æ€§èƒ½** | **å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|----------|------------|----------|------------|--------------|
| **äº‹ä»¶é©±åŠ¨** | å‡†å®æ—¶ | é«˜ | ä¸­ç­‰ | æ•°æ®å˜æ›´é¢‘ç‡é€‚ä¸­ï¼Œå¯æ¥å—å»¶è¿Ÿ |
| **APIè°ƒç”¨** | å®æ—¶ | ä¸­ç­‰ | ä½ | æ•°æ®å®æ—¶æ€§è¦æ±‚é«˜ï¼Œè°ƒç”¨é‡ä¸å¤§ |
| **å®šæ—¶åŒæ­¥** | å»¶è¿Ÿè¾ƒå¤§ | é«˜ | ä½ | æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ |
| **CDCåŒæ­¥** | å‡†å®æ—¶ | é«˜ | é«˜ | å¤§æ•°æ®é‡ï¼Œé«˜é¢‘å˜æ›´ |

---

## 6. ğŸ“ˆ è¯»å†™åˆ†ç¦»ä¸åˆ†åº“åˆ†è¡¨


### 6.1 è¯»å†™åˆ†ç¦»


ğŸ·ï¸ **ä¸“ä¸šæœ¯è¯­**ï¼š`è¯»å†™åˆ†ç¦»` = å†™æ“ä½œä½¿ç”¨ä¸»åº“ï¼Œè¯»æ“ä½œä½¿ç”¨ä»åº“

### 6.2 ä¸ºä»€ä¹ˆéœ€è¦è¯»å†™åˆ†ç¦»


ğŸ’­ **æ€è€ƒä¸€ä¸‹**ï¼šå°±åƒé“¶è¡Œçš„ä¸šåŠ¡ï¼Œå­˜é’±å–é’±åœ¨æŸœå°åŠç†ï¼ˆå†™æ“ä½œï¼‰ï¼ŒæŸ¥ä½™é¢å¯ä»¥åœ¨ATMæœºæŸ¥çœ‹ï¼ˆè¯»æ“ä½œï¼‰

**ä¸šåŠ¡åœºæ™¯åˆ†æ**ï¼š
```
ç”µå•†è®¢å•æœåŠ¡çš„è¯»å†™æ¯”ä¾‹ï¼š
å†™æ“ä½œï¼ˆ20%ï¼‰ï¼š
- åˆ›å»ºè®¢å•
- æ›´æ–°è®¢å•çŠ¶æ€  
- å–æ¶ˆè®¢å•

è¯»æ“ä½œï¼ˆ80%ï¼‰ï¼š
- æŸ¥è¯¢è®¢å•è¯¦æƒ…
- è®¢å•åˆ—è¡¨æŸ¥è¯¢
- è®¢å•ç»Ÿè®¡æŠ¥è¡¨
```

### 6.3 è¯»å†™åˆ†ç¦»å®ç°


```java
// æ•°æ®æºé…ç½®
@Configuration
public class DataSourceConfig {
    
    // ä¸»åº“é…ç½®ï¼ˆå†™æ“ä½œï¼‰
    @Bean
    @Primary
    public DataSource masterDataSource() {
        return DataSourceBuilder.create()
            .url("jdbc:mysql://master-db:3306/order_service")
            .username("master_user")
            .password("password")
            .build();
    }
    
    // ä»åº“é…ç½®ï¼ˆè¯»æ“ä½œï¼‰
    @Bean
    public DataSource slaveDataSource() {
        return DataSourceBuilder.create()
            .url("jdbc:mysql://slave-db:3306/order_service")
            .username("slave_user")
            .password("password")
            .build();
    }
    
    // åŠ¨æ€æ•°æ®æº
    @Bean
    public DataSource routingDataSource() {
        Map<Object, Object> dataSourceMap = new HashMap<>();
        dataSourceMap.put("master", masterDataSource());
        dataSourceMap.put("slave", slaveDataSource());
        
        DynamicRoutingDataSource routingDataSource = new DynamicRoutingDataSource();
        routingDataSource.setTargetDataSources(dataSourceMap);
        routingDataSource.setDefaultTargetDataSource(masterDataSource());
        
        return routingDataSource;
    }
}

// è¯»å†™åˆ†ç¦»è·¯ç”±
@Service
public class OrderService {
    
    // å†™æ“ä½œï¼šè‡ªåŠ¨è·¯ç”±åˆ°ä¸»åº“
    @Transactional
    public Order createOrder(Order order) {
        return orderRepository.save(order);
    }
    
    // è¯»æ“ä½œï¼šè·¯ç”±åˆ°ä»åº“
    @Transactional(readOnly = true)
    public Order getOrder(Long orderId) {
        return orderRepository.findById(orderId);
    }
    
    // è¯»æ“ä½œï¼šæŸ¥è¯¢åˆ—è¡¨
    @Transactional(readOnly = true)
    public List<Order> getOrdersByUser(Long userId) {
        return orderRepository.findByUserId(userId);
    }
}
```

### 6.4 åˆ†åº“åˆ†è¡¨ç­–ç•¥


ğŸ” **æ·±å…¥ç†è§£**ï¼šå½“å•è¡¨æ•°æ®é‡è¿‡å¤§æ—¶ï¼Œéœ€è¦å°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªæ•°æ®åº“æˆ–è¡¨ä¸­

#### ğŸ—‚ï¸ æ°´å¹³æ‹†åˆ†ï¼ˆåˆ†è¡¨ï¼‰


**æŒ‰è®¢å•IDåˆ†è¡¨**ï¼š
```
åŸæ¥ï¼šorder_table (1000ä¸‡æ¡è®°å½•)
æ‹†åˆ†åï¼š
- order_table_0 (è®¢å•ID % 4 = 0)
- order_table_1 (è®¢å•ID % 4 = 1) 
- order_table_2 (è®¢å•ID % 4 = 2)
- order_table_3 (è®¢å•ID % 4 = 3)
```

**æŒ‰æ—¶é—´åˆ†è¡¨**ï¼š
```
è®¢å•è¡¨æŒ‰æœˆåˆ†è¡¨ï¼š
- order_table_202501 (2025å¹´1æœˆçš„è®¢å•)
- order_table_202502 (2025å¹´2æœˆçš„è®¢å•)
- order_table_202503 (2025å¹´3æœˆçš„è®¢å•)
```

#### ğŸ“Š å‚ç›´æ‹†åˆ†ï¼ˆåˆ†åº“ï¼‰


**æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ†åº“**ï¼š
```
ç”µå•†ç³»ç»Ÿåˆ†åº“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·åº“     â”‚ â”‚   è®¢å•åº“     â”‚ â”‚   å•†å“åº“     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_table  â”‚ â”‚order_table  â”‚ â”‚product_tableâ”‚
â”‚profile_tableâ”‚ â”‚order_item   â”‚ â”‚category     â”‚
â”‚address_tableâ”‚ â”‚order_log    â”‚ â”‚inventory    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 åˆ†åº“åˆ†è¡¨çš„å®ç°


```java
// åˆ†è¡¨è·¯ç”±ç­–ç•¥
@Component
public class OrderShardingStrategy {
    
    // æ ¹æ®è®¢å•IDè®¡ç®—è¡¨å
    public String getTableName(Long orderId) {
        int tableIndex = (int)(orderId % 4);
        return "order_table_" + tableIndex;
    }
    
    // æ ¹æ®ç”¨æˆ·IDè®¡ç®—æ•°æ®åº“
    public String getDatabaseName(Long userId) {
        int dbIndex = (int)(userId % 2);
        return "order_db_" + dbIndex;
    }
}

// åˆ†åº“åˆ†è¡¨çš„DAOå®ç°
@Repository
public class OrderDao {
    
    @Autowired
    private OrderShardingStrategy shardingStrategy;
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public Order save(Order order) {
        String tableName = shardingStrategy.getTableName(order.getOrderId());
        String sql = "INSERT INTO " + tableName + " (user_id, amount, status) VALUES (?, ?, ?)";
        
        jdbcTemplate.update(sql, order.getUserId(), order.getAmount(), order.getStatus());
        return order;
    }
    
    public Order findById(Long orderId) {
        String tableName = shardingStrategy.getTableName(orderId);
        String sql = "SELECT * FROM " + tableName + " WHERE order_id = ?";
        
        return jdbcTemplate.queryForObject(sql, new OrderRowMapper(), orderId);
    }
}
```

---

## 7. âš–ï¸ æ•°æ®ä¸€è‡´æ€§ä¿éšœ


### 7.1 æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜


ğŸ’­ **æ€è€ƒä¸€ä¸‹**ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå¦‚ä½•ä¿è¯å¤šä¸ªæœåŠ¡çš„æ•°æ®ä¿æŒä¸€è‡´ï¼Ÿ

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼š
```
ä¸‹å•æµç¨‹æ¶‰åŠçš„æ•°æ®å˜æ›´ï¼š
1. è®¢å•æœåŠ¡ï¼šåˆ›å»ºè®¢å•è®°å½•
2. åº“å­˜æœåŠ¡ï¼šå‡å°‘å•†å“åº“å­˜  
3. ç”¨æˆ·æœåŠ¡ï¼šæ‰£å‡ç”¨æˆ·ç§¯åˆ†
4. æ”¯ä»˜æœåŠ¡ï¼šåˆ›å»ºæ”¯ä»˜è®°å½•

å¦‚æœå…¶ä¸­ä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ
```

### 7.2 ACID vs BASE


**ä¼ ç»ŸACIDç‰¹æ€§**ï¼š
- **åŸå­æ€§(Atomicity)**ï¼šäº‹åŠ¡å…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥
- **ä¸€è‡´æ€§(Consistency)**ï¼šæ•°æ®å§‹ç»ˆä¿æŒä¸€è‡´çŠ¶æ€  
- **éš”ç¦»æ€§(Isolation)**ï¼šäº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°
- **æŒä¹…æ€§(Durability)**ï¼šäº‹åŠ¡æäº¤åæ•°æ®æŒä¹…ä¿å­˜

**åˆ†å¸ƒå¼ç¯å¢ƒçš„BASEç†è®º**ï¼š
- **åŸºæœ¬å¯ç”¨(Basically Available)**ï¼šç³»ç»ŸåŸºæœ¬åŠŸèƒ½å¯ç”¨
- **è½¯çŠ¶æ€(Soft State)**ï¼šå…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…ä¸ä¸€è‡´
- **æœ€ç»ˆä¸€è‡´(Eventually Consistent)**ï¼šä¿è¯æœ€ç»ˆæ•°æ®ä¸€è‡´

### 7.3 åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ


#### ğŸ”„ ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰


```
ä¸¤é˜¶æ®µæäº¤æµç¨‹ï¼š
                äº‹åŠ¡åè°ƒå™¨
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
    è®¢å•æœåŠ¡      åº“å­˜æœåŠ¡      æ”¯ä»˜æœåŠ¡
        â”‚            â”‚            â”‚
   â•”â•â•â•â•â–¼â•â•â•â•â•—  â•”â•â•â•â•â–¼â•â•â•â•â•—  â•”â•â•â•â•â–¼â•â•â•â•â•—
   â•‘å‡†å¤‡é˜¶æ®µ  â•‘  â•‘å‡†å¤‡é˜¶æ®µ  â•‘  â•‘å‡†å¤‡é˜¶æ®µ  â•‘
   â•‘ å‡†å¤‡OK  â•‘  â•‘ å‡†å¤‡OK  â•‘  â•‘ å‡†å¤‡OK  â•‘
   â•šâ•â•â•â•â•¤â•â•â•â•â•  â•šâ•â•â•â•â•¤â•â•â•â•â•  â•šâ•â•â•â•â•¤â•â•â•â•â•
        â”‚            â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                â•”â•â•â•â•â–¼â•â•â•â•â•—
                â•‘æäº¤é˜¶æ®µ  â•‘
                â•‘å…¨éƒ¨æäº¤  â•‘
                â•šâ•â•â•â•â•â•â•â•â•â•
```

#### ğŸ”” Sagaæ¨¡å¼


ğŸ’¡ **ä¸€å¥è¯æ€»ç»“**ï¼šå°†å¤§äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡ï¼Œæ¯ä¸ªå°äº‹åŠ¡éƒ½æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ

```java
// Sagaç¼–æ’å™¨ç¤ºä¾‹
@Component
public class OrderSagaOrchestrator {
    
    public void processOrder(OrderRequest request) {
        try {
            // æ­¥éª¤1ï¼šåˆ›å»ºè®¢å•
            Order order = orderService.createOrder(request);
            
            // æ­¥éª¤2ï¼šæ‰£å‡åº“å­˜
            inventoryService.reserveStock(request.getProductId(), request.getQuantity());
            
            // æ­¥éª¤3ï¼šæ‰£å‡ç§¯åˆ†
            userService.deductPoints(request.getUserId(), request.getPoints());
            
            // æ­¥éª¤4ï¼šåˆ›å»ºæ”¯ä»˜
            paymentService.createPayment(order.getOrderId(), order.getAmount());
            
        } catch (Exception e) {
            // æ‰§è¡Œè¡¥å¿æ“ä½œ
            compensate(request);
        }
    }
    
    private void compensate(OrderRequest request) {
        // è¡¥å¿æ“ä½œï¼šæŒ‰ç›¸åé¡ºåºå›æ»š
        try {
            paymentService.cancelPayment(request.getOrderId());
        } catch (Exception e) { /* è®°å½•æ—¥å¿— */ }
        
        try {
            userService.refundPoints(request.getUserId(), request.getPoints());
        } catch (Exception e) { /* è®°å½•æ—¥å¿— */ }
        
        try {
            inventoryService.releaseStock(request.getProductId(), request.getQuantity());
        } catch (Exception e) { /* è®°å½•æ—¥å¿— */ }
        
        try {
            orderService.cancelOrder(request.getOrderId());
        } catch (Exception e) { /* è®°å½•æ—¥å¿— */ }
    }
}
```

#### ğŸ“¤ äº‹ä»¶æº¯æºæ¨¡å¼


ğŸ” **æ·±å…¥ç†è§£**ï¼šä¸å­˜å‚¨å½“å‰çŠ¶æ€ï¼Œè€Œæ˜¯å­˜å‚¨æ‰€æœ‰çš„çŠ¶æ€å˜æ›´äº‹ä»¶

```java
// äº‹ä»¶æº¯æºç¤ºä¾‹
@Entity
public class OrderEvent {
    private String eventId;
    private String orderId;
    private String eventType;  // ORDER_CREATED, PAYMENT_COMPLETED, ORDER_SHIPPED
    private String eventData;
    private LocalDateTime timestamp;
}

@Service
public class OrderEventStore {
    
    // ä¿å­˜äº‹ä»¶
    public void saveEvent(OrderEvent event) {
        eventRepository.save(event);
        // å‘å¸ƒäº‹ä»¶åˆ°æ¶ˆæ¯é˜Ÿåˆ—
        eventPublisher.publish(event);
    }
    
    // é‡æ„è®¢å•å½“å‰çŠ¶æ€
    public Order rebuildOrderState(String orderId) {
        List<OrderEvent> events = eventRepository.findByOrderIdOrderByTimestamp(orderId);
        
        Order order = new Order();
        for (OrderEvent event : events) {
            applyEvent(order, event);
        }
        return order;
    }
    
    private void applyEvent(Order order, OrderEvent event) {
        switch (event.getEventType()) {
            case "ORDER_CREATED":
                // åº”ç”¨è®¢å•åˆ›å»ºäº‹ä»¶
                break;
            case "PAYMENT_COMPLETED":
                // åº”ç”¨æ”¯ä»˜å®Œæˆäº‹ä»¶
                break;
            // å…¶ä»–äº‹ä»¶å¤„ç†...
        }
    }
}
```

### 7.4 æœ€ç»ˆä¸€è‡´æ€§å®ç°


ğŸ¯ **æœ€ä½³å®è·µ**ï¼šåœ¨å¾®æœåŠ¡ä¸­ï¼Œé€šå¸¸é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§è€Œä¸æ˜¯å¼ºä¸€è‡´æ€§

```java
// æœ€ç»ˆä¸€è‡´æ€§ç¤ºä¾‹ï¼šè®¢å•çŠ¶æ€åŒæ­¥
@Service
public class OrderStatusSyncService {
    
    @Scheduled(fixedDelay = 30000) // æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
    public void syncOrderStatus() {
        // æŸ¥æ‰¾çŠ¶æ€ä¸ä¸€è‡´çš„è®¢å•
        List<Order> pendingOrders = orderRepository.findPendingOrders();
        
        for (Order order : pendingOrders) {
            try {
                // æŸ¥è¯¢æ”¯ä»˜æœåŠ¡çš„å®é™…çŠ¶æ€
                PaymentStatus paymentStatus = paymentService.getPaymentStatus(order.getOrderId());
                
                // æ›´æ–°è®¢å•çŠ¶æ€
                if (paymentStatus == PaymentStatus.COMPLETED && 
                    order.getStatus() == OrderStatus.PENDING_PAYMENT) {
                    
                    order.setStatus(OrderStatus.PAID);
                    orderRepository.save(order);
                    
                    // å‘é€è®¢å•çŠ¶æ€å˜æ›´äº‹ä»¶
                    publishOrderStatusChanged(order);
                }
                
            } catch (Exception e) {
                log.error("åŒæ­¥è®¢å•çŠ¶æ€å¤±è´¥ï¼š{}", order.getOrderId(), e);
            }
        }
    }
}
```

---

## 8. ğŸ” è·¨æœåŠ¡æŸ¥è¯¢è§£å†³æ–¹æ¡ˆ


### 8.1 è·¨æœåŠ¡æŸ¥è¯¢æŒ‘æˆ˜


ğŸ¤” **ä¸ºä»€ä¹ˆè¿™æ ·**ï¼šæ¯ä¸ªæœåŠ¡æœ‰ç‹¬ç«‹æ•°æ®åº“åï¼Œå¦‚ä½•è¿›è¡Œè·¨æœåŠ¡çš„å¤æ‚æŸ¥è¯¢ï¼Ÿ

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼š
```
æŸ¥è¯¢éœ€æ±‚ï¼š"æŸ¥è¯¢æŸç”¨æˆ·æœ€è¿‘30å¤©è´­ä¹°é‡‘é¢è¶…è¿‡1000å…ƒçš„è®¢å•ï¼Œ
           å¹¶æ˜¾ç¤ºå•†å“åç§°å’Œç”¨æˆ·ç­‰çº§"

æ¶‰åŠçš„æœåŠ¡ï¼š
- è®¢å•æœåŠ¡ï¼šè®¢å•ä¿¡æ¯ã€è´­ä¹°é‡‘é¢
- ç”¨æˆ·æœåŠ¡ï¼šç”¨æˆ·ç­‰çº§  
- å•†å“æœåŠ¡ï¼šå•†å“åç§°

ä¼ ç»ŸSQLï¼š
SELECT o.*, u.user_level, p.product_name 
FROM orders o 
JOIN users u ON o.user_id = u.user_id
JOIN products p ON o.product_id = p.product_id  
WHERE o.user_id = ? AND o.amount > 1000 
  AND o.create_time > DATE_SUB(NOW(), INTERVAL 30 DAY)

å¾®æœåŠ¡ç¯å¢ƒï¼šæ— æ³•ä½¿ç”¨JOINæŸ¥è¯¢ âŒ
```

### 8.2 APIèšåˆæ¨¡å¼


ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡APIè°ƒç”¨è·å–å„æœåŠ¡æ•°æ®ï¼Œåœ¨åº”ç”¨å±‚è¿›è¡Œèšåˆ

```java
// APIèšåˆæœåŠ¡
@Service
public class OrderQueryService {
    
    @Autowired
    private OrderServiceClient orderClient;
    @Autowired
    private UserServiceClient userClient;
    @Autowired
    private ProductServiceClient productClient;
    
    public OrderDetailVO getOrderDetailWithUserAndProduct(Long orderId) {
        // ç¬¬ä¸€æ­¥ï¼šè·å–è®¢å•åŸºæœ¬ä¿¡æ¯
        Order order = orderClient.getOrder(orderId);
        if (order == null) {
            return null;
        }
        
        // ç¬¬äºŒæ­¥ï¼šå¹¶è¡Œè·å–ç”¨æˆ·å’Œå•†å“ä¿¡æ¯
        CompletableFuture<User> userFuture = CompletableFuture.supplyAsync(() -> 
            userClient.getUser(order.getUserId()));
            
        CompletableFuture<Product> productFuture = CompletableFuture.supplyAsync(() -> 
            productClient.getProduct(order.getProductId()));
        
        // ç¬¬ä¸‰æ­¥ï¼šç­‰å¾…æ‰€æœ‰è°ƒç”¨å®Œæˆå¹¶èšåˆæ•°æ®
        try {
            User user = userFuture.get(2, TimeUnit.SECONDS);
            Product product = productFuture.get(2, TimeUnit.SECONDS);
            
            // èšåˆæ•°æ®
            OrderDetailVO detail = new OrderDetailVO();
            detail.setOrder(order);
            detail.setUserName(user.getUserName());
            detail.setUserLevel(user.getUserLevel());
            detail.setProductName(product.getProductName());
            detail.setProductPrice(product.getPrice());
            
            return detail;
            
        } catch (Exception e) {
            log.error("è·å–è®¢å•è¯¦æƒ…å¤±è´¥", e);
            // è¿”å›éƒ¨åˆ†æ•°æ®æˆ–é»˜è®¤å€¼
            return buildPartialOrderDetail(order);
        }
    }
}
```

### 8.3 CQRSæ¨¡å¼


ğŸ·ï¸ **ä¸“ä¸šæœ¯è¯­**ï¼š`CQRS` = Command Query Responsibility Segregationï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰

**åŸºæœ¬æ€æƒ³**ï¼š
- **å‘½ä»¤ç«¯**ï¼šè´Ÿè´£å†™æ“ä½œï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
- **æŸ¥è¯¢ç«¯**ï¼šè´Ÿè´£è¯»æ“ä½œï¼Œé’ˆå¯¹æŸ¥è¯¢ä¼˜åŒ–

```
CQRSæ¶æ„å›¾ï¼š
          å‘½ä»¤ç«¯                      æŸ¥è¯¢ç«¯
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  è®¢å•æœåŠ¡    â”‚              â”‚  æŸ¥è¯¢æœåŠ¡    â”‚
     â”‚(å†™æ“ä½œä¼˜åŒ–)  â”‚              â”‚(è¯»æ“ä½œä¼˜åŒ–)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                            â†‘
           â”‚                            â”‚
           â–¼                            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ•°æ®åŒæ­¥     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   å†™æ•°æ®åº“   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   è¯»æ•°æ®åº“   â”‚
     â”‚ (è§„èŒƒåŒ–è®¾è®¡) â”‚              â”‚ (åè§„èŒƒåŒ–è®¾è®¡)â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```java
// æŸ¥è¯¢ç«¯çš„èšåˆæ•°æ®æ¨¡å‹
@Entity
@Table(name = "order_query_view")
public class OrderQueryView {
    private Long orderId;
    private Long userId;
    private String userName;
    private String userLevel;
    private Long productId;
    private String productName;
    private BigDecimal productPrice;
    private BigDecimal orderAmount;
    private String orderStatus;
    private LocalDateTime createTime;
    
    // ä¸“é—¨ä¸ºæŸ¥è¯¢ä¼˜åŒ–çš„å­—æ®µç»„åˆ
}

// æŸ¥è¯¢æœåŠ¡
@Service
public class OrderQueryViewService {
    
    // å¤æ‚æŸ¥è¯¢å˜æˆç®€å•çš„å•è¡¨æŸ¥è¯¢
    public List<OrderQueryView> findHighValueOrders(Long userId, int days, BigDecimal minAmount) {
        LocalDateTime startTime = LocalDateTime.now().minusDays(days);
        
        return orderQueryRepository.findByUserIdAndCreateTimeAfterAndOrderAmountGreaterThan(
            userId, startTime, minAmount);
    }
    
    // äº‹ä»¶å¤„ç†ï¼šåŒæ­¥æ›´æ–°æŸ¥è¯¢è§†å›¾
    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        OrderQueryView view = new OrderQueryView();
        view.setOrderId(event.getOrderId());
        view.setUserId(event.getUserId());
        view.setOrderAmount(event.getAmount());
        // ... è®¾ç½®å…¶ä»–å­—æ®µ
        
        orderQueryRepository.save(view);
    }
    
    @EventListener
    public void handleUserUpdated(UserUpdatedEvent event) {
        // æ›´æ–°æ‰€æœ‰ç›¸å…³è®¢å•çš„ç”¨æˆ·ä¿¡æ¯
        List<OrderQueryView> orders = orderQueryRepository.findByUserId(event.getUserId());
        orders.forEach(order -> {
            order.setUserName(event.getUserName());
            order.setUserLevel(event.getUserLevel());
        });
        orderQueryRepository.saveAll(orders);
    }
}
```

### 8.4 æ•°æ®æ¹–/æ•°æ®ä»“åº“æ¨¡å¼


ğŸ” **æ·±å…¥ç†è§£**ï¼šå°†å„æœåŠ¡çš„æ•°æ®ç»Ÿä¸€æ”¶é›†åˆ°æ•°æ®æ¹–ä¸­è¿›è¡Œå¤æ‚åˆ†æ

```
æ•°æ®æ¹–æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¢å•æœåŠ¡  â”‚ â”‚ç”¨æˆ·æœåŠ¡  â”‚ â”‚å•†å“æœåŠ¡  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚
     â–¼           â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æ•°æ®æ¹–               â”‚
â”‚  è®¢å•æ•°æ® | ç”¨æˆ·æ•°æ® | å•†å“æ•°æ®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          åˆ†ææŸ¥è¯¢æœåŠ¡            â”‚
â”‚    æ”¯æŒå¤æ‚çš„è·¨åŸŸæŸ¥è¯¢å’Œåˆ†æ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ğŸš€ æ•°æ®è¿ç§»ç­–ç•¥


### 9.1 æ•°æ®è¿ç§»åœºæ™¯


ğŸ’­ **æ€è€ƒä¸€ä¸‹**ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦è¿›è¡Œæ•°æ®è¿ç§»ï¼Ÿ

**å¸¸è§è¿ç§»åœºæ™¯**ï¼š
- **å•ä½“åˆ°å¾®æœåŠ¡**ï¼šå°†å…±äº«æ•°æ®åº“æ‹†åˆ†ä¸ºç‹¬ç«‹æ•°æ®åº“
- **æœåŠ¡é‡æ„**ï¼šè°ƒæ•´æœåŠ¡è¾¹ç•Œï¼Œé‡æ–°åˆ†é…æ•°æ®æ‰€æœ‰æƒ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ•°æ®åº“ç±»å‹åˆ‡æ¢æˆ–åˆ†åº“åˆ†è¡¨
- **æŠ€æœ¯å‡çº§**ï¼šæ•°æ®åº“ç‰ˆæœ¬å‡çº§æˆ–è¿ç§»åˆ°äº‘ç«¯

### 9.2 æ•°æ®è¿ç§»ç­–ç•¥


#### ğŸ”„ æ¸è¿›å¼è¿ç§»ï¼ˆæ¨èï¼‰


**åŸºæœ¬æ€æƒ³**ï¼šé€æ­¥è¿ç§»ï¼Œä¿è¯æœåŠ¡è¿ç»­æ€§

```
æ¸è¿›å¼è¿ç§»æ­¥éª¤ï¼š
ç¬¬ä¸€é˜¶æ®µï¼šåŒå†™ç­–ç•¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å†™å…¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  æ—§æ•°æ®åº“ â”‚
â”‚  æœåŠ¡   â”‚    â”Œâ”€â”€â”€â”€â†’â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚å†™å…¥  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â””â”€â”€â”€â”€â†’â”‚  æ–°æ•°æ®åº“ â”‚
                     â”‚          â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒé˜¶æ®µï¼šè¯»å†™åˆ‡æ¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨   â”‚           â”‚  æ—§æ•°æ®åº“ â”‚
â”‚  æœåŠ¡   â”‚           â”‚  (åªè¯»)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚è¯»å†™
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°æ•°æ®åº“ â”‚
â”‚  (ä¸»åº“)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå…¨åˆ‡æ¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨   â”‚           â”‚  æ—§æ•°æ®åº“ â”‚
â”‚  æœåŠ¡   â”‚           â”‚ (å·²ä¸‹çº¿) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚è¯»å†™
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°æ•°æ®åº“ â”‚
â”‚  (å”¯ä¸€)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ“Š å®ç°ç¤ºä¾‹


```java
// åŒå†™ç­–ç•¥å®ç°
@Service
public class MigrationUserService {
    
    @Autowired
    private OldUserRepository oldUserRepository;
    
    @Autowired
    private NewUserRepository newUserRepository;
    
    @Value("${migration.phase:1}")
    private int migrationPhase;
    
    public User saveUser(User user) {
        switch (migrationPhase) {
            case 1: // åŒå†™é˜¶æ®µ
                return dualWrite(user);
            case 2: // æ–°åº“ä¸ºä¸»
                return writeToNewDatabase(user);
            case 3: // å®Œå…¨åˆ‡æ¢
                return newUserRepository.save(user);
            default:
                return oldUserRepository.save(user);
        }
    }
    
    private User dualWrite(User user) {
        try {
            // å…ˆå†™æ—§åº“
            User savedUser = oldUserRepository.save(user);
            
            // å¼‚æ­¥å†™æ–°åº“
            CompletableFuture.runAsync(() -> {
                try {
                    newUserRepository.save(user);
                } catch (Exception e) {
                    log.error("å†™å…¥æ–°æ•°æ®åº“å¤±è´¥", e);
                    // è®°å½•å¤±è´¥çš„æ•°æ®ï¼Œåç»­è¡¥å¿
                    recordFailedMigration(user);
                }
            });
            
            return savedUser;
        } catch (Exception e) {
            log.error("å†™å…¥æ—§æ•°æ®åº“å¤±è´¥", e);
            throw e;
        }
    }
    
    public User getUser(Long userId) {
        switch (migrationPhase) {
            case 1: // ä»æ—§åº“è¯»å–
                return oldUserRepository.findById(userId);
            case 2: // ä¼˜å…ˆä»æ–°åº“è¯»å–
                return readFromNewDatabaseWithFallback(userId);
            case 3: // åªä»æ–°åº“è¯»å–
                return newUserRepository.findById(userId);
            default:
                return oldUserRepository.findById(userId);
        }
    }
    
    private User readFromNewDatabaseWithFallback(Long userId) {
        try {
            User user = newUserRepository.findById(userId);
            if (user != null) {
                return user;
            }
        } catch (Exception e) {
            log.warn("ä»æ–°æ•°æ®åº“è¯»å–å¤±è´¥ï¼Œå›é€€åˆ°æ—§æ•°æ®åº“", e);
        }
        
        // å›é€€åˆ°æ—§æ•°æ®åº“
        return oldUserRepository.findById(userId);
    }
}
```

### 9.3 æ•°æ®ä¸€è‡´æ€§éªŒè¯


ğŸ”§ **è§£å†³æ–¹æ¡ˆ**ï¼šå®šæœŸéªŒè¯æ–°æ—§æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§

```java
// æ•°æ®ä¸€è‡´æ€§éªŒè¯å·¥å…·
@Component
public class DataConsistencyChecker {
    
    @Scheduled(fixedDelay = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void checkUserDataConsistency() {
        List<Long> userIds = getUserIdsToCheck();
        
        for (Long userId : userIds) {
            try {
                User oldUser = oldUserRepository.findById(userId);
                User newUser = newUserRepository.findById(userId);
                
                if (!isUserDataConsistent(oldUser, newUser)) {
                    log.warn("æ•°æ®ä¸ä¸€è‡´: userId={}, old={}, new={}", 
                        userId, oldUser, newUser);
                    
                    // è®°å½•ä¸ä¸€è‡´æ•°æ®
                    recordInconsistentData(userId, oldUser, newUser);
                    
                    // è‡ªåŠ¨ä¿®å¤ï¼ˆå¯é€‰ï¼‰
                    if (shouldAutoFix()) {
                        fixInconsistentData(userId, oldUser, newUser);
                    }
                }
                
            } catch (Exception e) {
                log.error("æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§å¤±è´¥: userId={}", userId, e);
            }
        }
    }
    
    private boolean isUserDataConsistent(User oldUser, User newUser) {
        if (oldUser == null && newUser == null) {
            return true;
        }
        if (oldUser == null || newUser == null) {
            return false;
        }
        
        return Objects.equals(oldUser.getUserName(), newUser.getUserName()) &&
               Objects.equals(oldUser.getEmail(), newUser.getEmail()) &&
               Objects.equals(oldUser.getStatus(), newUser.getStatus());
    }
}
```

### 9.4 æ•°æ®è¿ç§»æœ€ä½³å®è·µ


â­ **é‡ç‚¹æ ‡è®°**ï¼šæ•°æ®è¿ç§»çš„å…³é”®æˆåŠŸå› ç´ 

**ğŸ¯ æœ€ä½³å®è·µ**ï¼š

1. **åˆ¶å®šè¯¦ç»†è®¡åˆ’**ï¼š
   - è¿ç§»æ—¶é—´è¡¨
   - å›æ»šç­–ç•¥  
   - éªŒè¯æ–¹æ¡ˆ
   - åº”æ€¥é¢„æ¡ˆ

2. **åˆ†é˜¶æ®µæ‰§è¡Œ**ï¼š
   - å…ˆè¿ç§»æµ‹è¯•ç¯å¢ƒ
   - å°è§„æ¨¡ç”Ÿäº§éªŒè¯
   - é€æ­¥æ‰©å¤§èŒƒå›´

3. **ä¿è¯æ•°æ®å®‰å…¨**ï¼š
   - è¿ç§»å‰å¤‡ä»½
   - è¿‡ç¨‹ä¸­ç›‘æ§
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

4. **æ€§èƒ½å½±å“æœ€å°åŒ–**ï¼š
   - é€‰æ‹©ä½å³°æ—¶æ®µ
   - å¼‚æ­¥è¿ç§»
   - é™æµæ§åˆ¶

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¯æœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼šå¾®æœåŠ¡æ•°æ®ç®¡ç†çš„åŸºæœ¬åŸåˆ™
ğŸ”¸ å…±äº«æ•°æ®åº“åæ¨¡å¼ï¼šå¤šæœåŠ¡å…±äº«æ•°æ®åº“çš„é—®é¢˜å’Œå±å®³  
ğŸ”¸ æ•°æ®åŒæ­¥ç­–ç•¥ï¼šäº‹ä»¶é©±åŠ¨ã€APIè°ƒç”¨ã€å®šæ—¶åŒæ­¥ç­‰æ–¹å¼
ğŸ”¸ è¯»å†™åˆ†ç¦»ï¼šæå‡æ•°æ®åº“æ€§èƒ½çš„åŸºæœ¬æŠ€æœ¯
ğŸ”¸ åˆ†åº“åˆ†è¡¨ï¼šå¤„ç†å¤§æ•°æ®é‡çš„æ°´å¹³æ‰©å±•æ–¹æ¡ˆ
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ä¸€è‡´æ€§ä¿éšœæœºåˆ¶
ğŸ”¸ è·¨æœåŠ¡æŸ¥è¯¢ï¼šAPIèšåˆã€CQRSç­‰è§£å†³æ–¹æ¡ˆ
ğŸ”¸ æ•°æ®è¿ç§»ï¼šæ¸è¿›å¼è¿ç§»å’Œä¸€è‡´æ€§éªŒè¯
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ç‹¬ç«‹æ•°æ®åº“**ï¼š
```
æŠ€æœ¯ä¼˜åŠ¿ï¼š
- ç‹¬ç«‹æ‰©å±•å’ŒæŠ€æœ¯é€‰å‹
- æ•…éšœéš”ç¦»å’Œå›¢é˜Ÿç‹¬ç«‹
- ç¬¦åˆå¾®æœåŠ¡æ¾è€¦åˆåŸåˆ™

ä¸šåŠ¡ä»·å€¼ï¼š
- æé«˜å¼€å‘æ•ˆç‡
- é™ä½ç³»ç»Ÿå¤æ‚åº¦
- å¢å¼ºç³»ç»Ÿç¨³å®šæ€§
```

**ğŸ”¹ æ•°æ®ä¸€è‡´æ€§çš„å¹³è¡¡**ï¼š
```
å¼ºä¸€è‡´æ€§ vs æœ€ç»ˆä¸€è‡´æ€§ï¼š
- é‡‘èäº¤æ˜“ï¼šéœ€è¦å¼ºä¸€è‡´æ€§
- ç”¨æˆ·ä¿¡æ¯åŒæ­¥ï¼šå¯æ¥å—æœ€ç»ˆä¸€è‡´æ€§
- åº“å­˜æ‰£å‡ï¼šéœ€è¦å‡†å®æ—¶ä¸€è‡´æ€§

é€‰æ‹©æ ‡å‡†ï¼š
- ä¸šåŠ¡é‡è¦ç¨‹åº¦
- æ€§èƒ½è¦æ±‚
- æŠ€æœ¯å¤æ‚åº¦
```

**ğŸ”¹ è·¨æœåŠ¡æŸ¥è¯¢çš„æƒè¡¡**ï¼š
```
å®æ—¶æ€§ vs å¤æ‚åº¦ï¼š
- APIèšåˆï¼šå®æ—¶æ€§å¥½ï¼Œä½†æ€§èƒ½å¼€é”€å¤§
- CQRSï¼šæŸ¥è¯¢é«˜æ•ˆï¼Œä½†æ•°æ®å¯èƒ½å»¶è¿Ÿ
- æ•°æ®æ¹–ï¼šæ”¯æŒå¤æ‚åˆ†æï¼Œä½†éå®æ—¶

é€‰æ‹©å»ºè®®ï¼š
- æ ¸å¿ƒä¸šåŠ¡ï¼šAPIèšåˆ
- æŸ¥è¯¢å¯†é›†ï¼šCQRSæ¨¡å¼
- åˆ†ææŠ¥è¡¨ï¼šæ•°æ®æ¹–æ–¹æ¡ˆ
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ åœ¨å·¥ä½œä¸­å¦‚ä½•åº”ç”¨**ï¼š

- **ç³»ç»Ÿè®¾è®¡**ï¼šè®¾è®¡å¾®æœåŠ¡æ—¶æ­£ç¡®åˆ’åˆ†æ•°æ®è¾¹ç•Œ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡è¯»å†™åˆ†ç¦»å’Œåˆ†åº“åˆ†è¡¨æå‡æ€§èƒ½
- **æ•…éšœå¤„ç†**ï¼šç†è§£åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ
- **æŠ€æœ¯é€‰å‹**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ•°æ®åŒæ­¥ç­–ç•¥

**ğŸ“ å­¦ä¹ å»ºè®®**ï¼š
- å…ˆç†è§£æ¦‚å¿µï¼Œå†åŠ¨æ‰‹å®è·µ
- ä»ç®€å•åœºæ™¯å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚åº¦
- å…³æ³¨ä¸šåŠ¡éœ€æ±‚ï¼ŒæŠ€æœ¯æœåŠ¡äºä¸šåŠ¡
- å¤šæ€è€ƒæƒè¡¡ï¼Œæ²¡æœ‰å®Œç¾çš„è§£å†³æ–¹æ¡ˆ

**ğŸ’¡ è®°å¿†æŠ€å·§**ï¼š
- **ç‹¬ç«‹æ•°æ®åº“**ï¼šåƒæ¯ä¸ªéƒ¨é—¨æœ‰è‡ªå·±çš„æ¡£æ¡ˆæŸœ
- **æ•°æ®åŒæ­¥**ï¼šåƒå„éƒ¨é—¨é—´çš„ä¿¡æ¯é€šæŠ¥
- **ä¸€è‡´æ€§**ï¼šåƒé“¶è¡Œè´¦æˆ·çš„èµ„é‡‘å¹³è¡¡
- **è·¨æœåŠ¡æŸ¥è¯¢**ï¼šåƒè·¨éƒ¨é—¨åä½œåŠäº‹

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ•°æ®ç‹¬ç«‹æ˜¯å¾®æœåŠ¡çš„åŸºç¡€
- ä¸€è‡´æ€§å’Œæ€§èƒ½éœ€è¦æƒè¡¡
- ä¸šåŠ¡éœ€æ±‚å†³å®šæŠ€æœ¯é€‰æ‹©
- æ¸è¿›å¼è¿ç§»é™ä½é£é™©