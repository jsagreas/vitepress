---
title: 5ã€DDDå®è·µæ¡ˆä¾‹åˆ†æ
---
## ğŸ“š ç›®å½•

1. [DDDä¸å¾®æœåŠ¡ç»“åˆæ¦‚è¿°](#1-DDDä¸å¾®æœåŠ¡ç»“åˆæ¦‚è¿°)
2. [è®¢å•ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡](#2-è®¢å•ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡)
3. [ç”¨æˆ·æœåŠ¡è¾¹ç•Œåˆ’åˆ†](#3-ç”¨æˆ·æœåŠ¡è¾¹ç•Œåˆ’åˆ†)
4. [åº“å­˜æœåŠ¡èŒè´£å®šä¹‰](#4-åº“å­˜æœåŠ¡èŒè´£å®šä¹‰)
5. [æ”¯ä»˜æœåŠ¡ç‹¬ç«‹è®¾è®¡](#5-æ”¯ä»˜æœåŠ¡ç‹¬ç«‹è®¾è®¡)
6. [é¢†åŸŸäº‹ä»¶åœ¨æœåŠ¡é—´çš„åº”ç”¨](#6-é¢†åŸŸäº‹ä»¶åœ¨æœåŠ¡é—´çš„åº”ç”¨)
7. [æœåŠ¡é—´åä½œæœºåˆ¶](#7-æœåŠ¡é—´åä½œæœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ DDDä¸å¾®æœåŠ¡ç»“åˆæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯DDDä¸å¾®æœåŠ¡çš„ç»“åˆ


**ğŸ”¸ é€šä¿—ç†è§£**
æƒ³è±¡ä½ åœ¨ç»è¥ä¸€å®¶å¤§å‹è´­ç‰©ä¸­å¿ƒï¼Œä¼ ç»Ÿåšæ³•æ˜¯æŠŠæ‰€æœ‰ä¸šåŠ¡ï¼ˆæ”¶é“¶ã€åº“å­˜ã€å®¢æœã€æ¸…æ´ï¼‰éƒ½æ”¾åœ¨ä¸€ä¸ªå¤§å…é‡Œç®¡ç†ã€‚è€ŒDDD+å¾®æœåŠ¡å°±åƒæŠŠè´­ç‰©ä¸­å¿ƒåˆ†æˆä¸åŒçš„ä¸“ä¸šåº—é“ºï¼Œæ¯ä¸ªåº—é“ºä¸“é—¨è´Ÿè´£è‡ªå·±æ“…é•¿çš„ä¸šåŠ¡ã€‚

```
ä¼ ç»Ÿå•ä½“åº”ç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸€ä¸ªå¤§åº”ç”¨ç³»ç»Ÿ            â”‚
â”‚  ç”¨æˆ·ç®¡ç†+è®¢å•+åº“å­˜+æ”¯ä»˜+ç‰©æµ     â”‚
â”‚      æ‰€æœ‰åŠŸèƒ½æ··åœ¨ä¸€èµ·            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DDD+å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ·æœåŠ¡  â”‚ â”‚è®¢å•æœåŠ¡  â”‚ â”‚åº“å­˜æœåŠ¡  â”‚ â”‚æ”¯ä»˜æœåŠ¡  â”‚
â”‚ä¸“é—¨ç®¡ç†  â”‚ â”‚ä¸“é—¨å¤„ç†  â”‚ â”‚ä¸“é—¨æ§åˆ¶  â”‚ â”‚ä¸“é—¨å¤„ç†  â”‚
â”‚ç”¨æˆ·ä¿¡æ¯  â”‚ â”‚è®¢å•æµç¨‹  â”‚ â”‚å•†å“åº“å­˜  â”‚ â”‚æ”¯ä»˜æµç¨‹  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿**
- **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæœåŠ¡éƒ½æœ‰æ˜ç¡®çš„ä¸šåŠ¡èŒƒå›´
- **ç‹¬ç«‹å¼€å‘**ï¼šä¸åŒå›¢é˜Ÿå¯ä»¥å¹¶è¡Œå¼€å‘ä¸åŒæœåŠ¡
- **æŠ€æœ¯çµæ´»**ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯æ ˆ
- **æ•…éšœéš”ç¦»**ï¼šä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜ä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿ

### 1.2 DDDçš„æ ¸å¿ƒæ¦‚å¿µåœ¨å¾®æœåŠ¡ä¸­çš„ä½“ç°


**ğŸ’¡ é¢†åŸŸï¼ˆDomainï¼‰â†’ å¾®æœåŠ¡**
- **é¢†åŸŸ**å°±æ˜¯ä¸šåŠ¡é¢†åŸŸï¼Œæ¯”å¦‚"è®¢å•ç®¡ç†"ã€"ç”¨æˆ·ç®¡ç†"
- **å¾®æœåŠ¡**å°±æ˜¯é’ˆå¯¹ç‰¹å®šé¢†åŸŸçš„ç‹¬ç«‹åº”ç”¨ç¨‹åº

**ğŸ›ï¸ é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰â†’ æœåŠ¡è¾¹ç•Œ**
- **é™ç•Œä¸Šä¸‹æ–‡**å®šä¹‰äº†ä¸šåŠ¡æ¦‚å¿µçš„ä½¿ç”¨èŒƒå›´
- **æœåŠ¡è¾¹ç•Œ**å†³å®šäº†å“ªäº›åŠŸèƒ½åº”è¯¥åœ¨åŒä¸€ä¸ªå¾®æœåŠ¡é‡Œ

```
å®é™…æ¡ˆä¾‹å¯¹æ¯”ï¼š

é”™è¯¯çš„æœåŠ¡åˆ’åˆ†ï¼š
âŒ æ•°æ®åº“è¡¨é©±åŠ¨ï¼šç”¨æˆ·è¡¨æœåŠ¡ã€è®¢å•è¡¨æœåŠ¡ã€å•†å“è¡¨æœåŠ¡

æ­£ç¡®çš„æœåŠ¡åˆ’åˆ†ï¼š
âœ… ä¸šåŠ¡é¢†åŸŸé©±åŠ¨ï¼šç”¨æˆ·ç®¡ç†æœåŠ¡ã€è®¢å•ç®¡ç†æœåŠ¡ã€åº“å­˜ç®¡ç†æœåŠ¡
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦DDDæŒ‡å¯¼å¾®æœåŠ¡è®¾è®¡


**ğŸš¨ å¸¸è§é—®é¢˜**
å¾ˆå¤šå›¢é˜Ÿç›´æ¥æŒ‰ç…§æ•°æ®åº“è¡¨æˆ–è€…æŠ€æœ¯å±‚æ¬¡æ¥æ‹†åˆ†å¾®æœåŠ¡ï¼Œç»“æœå‡ºç°ï¼š
- **æœåŠ¡ç²’åº¦è¿‡ç»†**ï¼šä¸€ä¸ªç®€å•æ“ä½œéœ€è¦è°ƒç”¨10å¤šä¸ªæœåŠ¡
- **æœåŠ¡è€¦åˆä¸¥é‡**ï¼šä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½éœ€è¦åŒæ—¶ä¿®æ”¹å¤šä¸ªæœåŠ¡
- **æ•°æ®ä¸€è‡´æ€§å›°éš¾**ï¼šåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜å¤æ‚

**âœ… DDDçš„è§£å†³æ–¹æ¡ˆ**
- **æŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†**ï¼šæ¯ä¸ªæœåŠ¡è´Ÿè´£å®Œæ•´çš„ä¸šåŠ¡åŠŸèƒ½
- **é«˜å†…èšä½è€¦åˆ**ï¼šç›¸å…³çš„åŠŸèƒ½åœ¨åŒä¸€ä¸ªæœåŠ¡å†…
- **æ¸…æ™°çš„æœåŠ¡è¾¹ç•Œ**ï¼šå‡å°‘æœåŠ¡é—´çš„é¢‘ç¹è°ƒç”¨

---

## 2. ğŸ›ï¸ è®¢å•ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡


### 2.1 ä¸šåŠ¡åœºæ™¯åˆ†æ


**ğŸ“‹ ç”µå•†è®¢å•å®Œæ•´æµç¨‹**
```
ç”¨æˆ·è´­ä¹°æµç¨‹ï¼š
1ï¸âƒ£ ç”¨æˆ·ç™»å½• â†’ æµè§ˆå•†å“ â†’ åŠ å…¥è´­ç‰©è½¦
2ï¸âƒ£ ç¡®è®¤è®¢å• â†’ æ£€æŸ¥åº“å­˜ â†’ è®¡ç®—ä»·æ ¼
3ï¸âƒ£ é€‰æ‹©æ”¯ä»˜æ–¹å¼ â†’ æ”¯ä»˜ â†’ å‡åº“å­˜
4ï¸âƒ£ ç”Ÿæˆè®¢å• â†’ å‘è´§å‡†å¤‡ â†’ ç‰©æµé…é€
5ï¸âƒ£ ç¡®è®¤æ”¶è´§ â†’ è®¢å•å®Œæˆ
```

**ğŸ” è¯†åˆ«æ ¸å¿ƒé¢†åŸŸ**
é€šè¿‡åˆ†æä¸šåŠ¡æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºå‡ ä¸ªæ ¸å¿ƒçš„ä¸šåŠ¡é¢†åŸŸï¼š

| é¢†åŸŸåç§° | æ ¸å¿ƒèŒè´£ | ä¸»è¦å®ä½“ | ä¸šåŠ¡è§„åˆ™ |
|---------|---------|---------|---------|
| **ğŸ‘¤ ç”¨æˆ·é¢†åŸŸ** | ç”¨æˆ·èº«ä»½ç®¡ç† | ç”¨æˆ·ã€è´¦å·ã€æƒé™ | æ³¨å†ŒéªŒè¯ã€ç™»å½•è®¤è¯ |
| **ğŸ“¦ å•†å“é¢†åŸŸ** | å•†å“ä¿¡æ¯ç®¡ç† | å•†å“ã€åˆ†ç±»ã€ä»·æ ¼ | å•†å“ä¸Šä¸‹æ¶ã€ä»·æ ¼ç­–ç•¥ |
| **ğŸ“‹ è®¢å•é¢†åŸŸ** | è®¢å•ç”Ÿå‘½å‘¨æœŸ | è®¢å•ã€è®¢å•é¡¹ | è®¢å•çŠ¶æ€æµè½¬ |
| **ğŸ“Š åº“å­˜é¢†åŸŸ** | åº“å­˜æ•°é‡æ§åˆ¶ | åº“å­˜ã€ä»“åº“ | åº“å­˜æ‰£å‡ã€è¡¥è´§ |
| **ğŸ’³ æ”¯ä»˜é¢†åŸŸ** | æ”¯ä»˜å¤„ç† | æ”¯ä»˜å•ã€è´¦å• | æ”¯ä»˜éªŒè¯ã€é€€æ¬¾ |

### 2.2 å¾®æœåŠ¡æ¶æ„å›¾


```
                          ğŸŒ APIç½‘å…³
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚         â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
              â”‚ç”¨æˆ·æœåŠ¡  â”‚ â”‚è®¢å•æœåŠ¡â”‚ â”‚å•†å“æœåŠ¡ â”‚
              â”‚         â”‚ â”‚       â”‚ â”‚        â”‚
              â”‚ç”¨æˆ·ç®¡ç†  â”‚ â”‚è®¢å•ç®¡ç†â”‚ â”‚å•†å“ç®¡ç† â”‚
              â”‚æƒé™éªŒè¯  â”‚ â”‚çŠ¶æ€è·Ÿè¸ªâ”‚ â”‚åˆ†ç±»ç®¡ç† â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚         â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
              â”‚åº“å­˜æœåŠ¡  â”‚ â”‚æ”¯ä»˜æœåŠ¡â”‚ â”‚ç‰©æµæœåŠ¡ â”‚
              â”‚         â”‚ â”‚       â”‚ â”‚        â”‚
              â”‚åº“å­˜ç®¡ç†  â”‚ â”‚æ”¯ä»˜å¤„ç†â”‚ â”‚å‘è´§ç®¡ç† â”‚
              â”‚å‡ºå…¥åº“   â”‚ â”‚è´¦å•ç®¡ç†â”‚ â”‚ç‰©æµè·Ÿè¸ª â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æœåŠ¡é—´é€šä¿¡æ–¹å¼


**ğŸ”— åŒæ­¥é€šä¿¡ vs å¼‚æ­¥é€šä¿¡**

```
åŒæ­¥é€šä¿¡åœºæ™¯ï¼ˆç«‹å³éœ€è¦ç»“æœï¼‰ï¼š
ç”¨æˆ·æœåŠ¡ â”€â”€HTTPè°ƒç”¨â”€â”€> è®¢å•æœåŠ¡
"æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨"

å¼‚æ­¥é€šä¿¡åœºæ™¯ï¼ˆå¤„ç†è€—æ—¶æ“ä½œï¼‰ï¼š
è®¢å•æœåŠ¡ â”€â”€å‘å¸ƒäº‹ä»¶â”€â”€> æ¶ˆæ¯é˜Ÿåˆ— â”€â”€æ¶ˆè´¹äº‹ä»¶â”€â”€> åº“å­˜æœåŠ¡
"è®¢å•åˆ›å»ºæˆåŠŸ" â†’ "æ‰£å‡åº“å­˜"
```

**âš¡ é€šä¿¡ç­–ç•¥é€‰æ‹©**

| åœºæ™¯ç±»å‹ | æ¨èæ–¹å¼ | åŸå›  | ç¤ºä¾‹ |
|---------|---------|------|------|
| **æŸ¥è¯¢æ“ä½œ** | ğŸ”„ åŒæ­¥HTTP | éœ€è¦ç«‹å³è¿”å›ç»“æœ | æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ |
| **å‘½ä»¤æ“ä½œ** | ğŸ“¨ å¼‚æ­¥æ¶ˆæ¯ | å…è®¸å»¶è¿Ÿå¤„ç† | å‘é€é‚®ä»¶é€šçŸ¥ |
| **å…³é”®æµç¨‹** | ğŸ”„ åŒæ­¥HTTP | éœ€è¦ç¡®ä¿æ“ä½œæˆåŠŸ | æ”¯ä»˜éªŒè¯ |
| **æ‰¹é‡å¤„ç†** | ğŸ“¨ å¼‚æ­¥æ¶ˆæ¯ | æé«˜ç³»ç»Ÿæ€§èƒ½ | ç”ŸæˆæŠ¥è¡¨ |

---

## 3. ğŸ‘¤ ç”¨æˆ·æœåŠ¡è¾¹ç•Œåˆ’åˆ†


### 3.1 ç”¨æˆ·æœåŠ¡èŒè´£èŒƒå›´


**âœ… åº”è¯¥åŒ…å«çš„åŠŸèƒ½**
```
æ ¸å¿ƒç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼š
ğŸ”¸ ç”¨æˆ·æ³¨å†Œ - åˆ›å»ºæ–°ç”¨æˆ·è´¦å·
ğŸ”¸ ç”¨æˆ·ç™»å½• - èº«ä»½éªŒè¯å’Œæˆæƒ
ğŸ”¸ ä¸ªäººä¿¡æ¯ - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ç®¡ç†
ğŸ”¸ å¯†ç ç®¡ç† - å¯†ç ä¿®æ”¹ã€é‡ç½®
ğŸ”¸ è´¦å·çŠ¶æ€ - è´¦å·å¯ç”¨ã€ç¦ç”¨
```

**âŒ ä¸åº”è¯¥åŒ…å«çš„åŠŸèƒ½**
```
éç”¨æˆ·æ ¸å¿ƒåŠŸèƒ½ï¼š
âŒ è®¢å•å†å² - å±äºè®¢å•æœåŠ¡
âŒ è´­ç‰©è½¦ - å±äºè®¢å•æˆ–å•†å“æœåŠ¡
âŒ æ”¶è´§åœ°å€ - å¯èƒ½å±äºè®¢å•æœåŠ¡
âŒ æ”¯ä»˜æ–¹å¼ - å±äºæ”¯ä»˜æœåŠ¡
```

### 3.2 ç”¨æˆ·æœåŠ¡é¢†åŸŸæ¨¡å‹


**ğŸ›ï¸ ç”¨æˆ·é¢†åŸŸçš„æ ¸å¿ƒå®ä½“**

```java
// ç”¨æˆ·èšåˆæ ¹
public class User {
    private UserId id;           // ç”¨æˆ·å”¯ä¸€æ ‡è¯†
    private String username;     // ç”¨æˆ·å
    private Email email;         // é‚®ç®±
    private Password password;   // å¯†ç 
    private UserStatus status;   // ç”¨æˆ·çŠ¶æ€
    private Profile profile;     // ç”¨æˆ·èµ„æ–™
    
    // ä¸šåŠ¡æ–¹æ³•
    public void changePassword(String oldPwd, String newPwd) {
        // éªŒè¯æ—§å¯†ç ï¼Œè®¾ç½®æ–°å¯†ç 
    }
    
    public void updateProfile(Profile newProfile) {
        // æ›´æ–°ç”¨æˆ·èµ„æ–™
    }
}
```

**ğŸ¯ é¢†åŸŸæœåŠ¡ç¤ºä¾‹**

```java
// ç”¨æˆ·è®¤è¯é¢†åŸŸæœåŠ¡
public class UserAuthenticationService {
    
    public AuthResult authenticate(String username, String password) {
        // 1. æŸ¥æ‰¾ç”¨æˆ·
        // 2. éªŒè¯å¯†ç 
        // 3. æ£€æŸ¥è´¦å·çŠ¶æ€
        // 4. ç”Ÿæˆè®¤è¯ä»¤ç‰Œ
    }
}
```

### 3.3 ç”¨æˆ·æœåŠ¡å¯¹å¤–æ¥å£


**ğŸ“¡ REST APIè®¾è®¡**

| HTTPæ–¹æ³• | è·¯å¾„ | åŠŸèƒ½è¯´æ˜ | è¯·æ±‚ç¤ºä¾‹ |
|---------|------|---------|---------|
| `POST` | `/users` | ç”¨æˆ·æ³¨å†Œ | `{"username":"john", "email":"john@example.com"}` |
| `POST` | `/users/login` | ç”¨æˆ·ç™»å½• | `{"username":"john", "password":"123456"}` |
| `GET` | `/users/{id}` | è·å–ç”¨æˆ·ä¿¡æ¯ | - |
| `PUT` | `/users/{id}` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | `{"email":"new@example.com"}` |
| `DELETE` | `/users/{id}` | åˆ é™¤ç”¨æˆ· | - |

**ğŸ” æœåŠ¡è°ƒç”¨ç¤ºä¾‹**
```
å…¶ä»–æœåŠ¡è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼š

è®¢å•æœåŠ¡éœ€è¦éªŒè¯ç”¨æˆ·ï¼š
GET /users/12345 â†’ è¿”å›ç”¨æˆ·åŸºæœ¬ä¿¡æ¯

æ”¯ä»˜æœåŠ¡éœ€è¦ç”¨æˆ·çŠ¶æ€ï¼š
GET /users/12345/status â†’ è¿”å›ç”¨æˆ·çŠ¶æ€
```

---

## 4. ğŸ“Š åº“å­˜æœåŠ¡èŒè´£å®šä¹‰


### 4.1 åº“å­˜æœåŠ¡æ ¸å¿ƒèŒè´£


**ğŸ¯ åº“å­˜ç®¡ç†çš„æ ¸å¿ƒä¸šåŠ¡**
åº“å­˜æœåŠ¡å°±åƒä»“åº“ç®¡ç†å‘˜ï¼Œéœ€è¦ç²¾ç¡®çŸ¥é“æ¯ä¸ªå•†å“æœ‰å¤šå°‘åº“å­˜ï¼Œä»€ä¹ˆæ—¶å€™è¿›è´§ï¼Œä»€ä¹ˆæ—¶å€™å‡ºè´§ã€‚

```
åº“å­˜æœåŠ¡ä¸»è¦èŒè´£ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ å•†å“åº“å­˜     â”‚ â† è®°å½•æ¯ä¸ªå•†å“çš„æ•°é‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â• å…¥åº“ç®¡ç†     â”‚ â† å•†å“è¿›è´§æ—¶å¢åŠ åº“å­˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â– å‡ºåº“ç®¡ç†     â”‚ â† é”€å”®æ—¶å‡å°‘åº“å­˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”’ åº“å­˜é¢„å      â”‚ â† ä¸‹å•æ—¶å…ˆé”å®šåº“å­˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš ï¸ åº“å­˜é¢„è­¦     â”‚ â† åº“å­˜ä¸è¶³æ—¶æé†’
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åº“å­˜é¢†åŸŸæ¨¡å‹è®¾è®¡


**ğŸ—ï¸ åº“å­˜èšåˆæ ¹**

```java
// åº“å­˜èšåˆæ ¹
public class Inventory {
    private ProductId productId;      // å•†å“ID
    private int availableQuantity;    // å¯ç”¨åº“å­˜
    private int reservedQuantity;     // é¢„å åº“å­˜
    private int totalQuantity;        // æ€»åº“å­˜
    
    // æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•
    public boolean reserve(int quantity) {
        if (availableQuantity >= quantity) {
            availableQuantity -= quantity;
            reservedQuantity += quantity;
            return true;
        }
        return false;
    }
    
    public void confirmReservation(int quantity) {
        reservedQuantity -= quantity;
        // åº“å­˜ç¡®è®¤å‡ºåº“
    }
    
    public void cancelReservation(int quantity) {
        reservedQuantity -= quantity;
        availableQuantity += quantity;
    }
}
```

### 4.3 åº“å­˜æ“ä½œæµç¨‹


**ğŸ“‹ ä¸‹å•æ—¶çš„åº“å­˜å¤„ç†æµç¨‹**

```
æ­£å¸¸ä¸‹å•æµç¨‹ï¼š
ç”¨æˆ·ä¸‹å•
    â”‚
    â–¼
1ï¸âƒ£ æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    â”‚
    â–¼ (åº“å­˜å……è¶³)
2ï¸âƒ£ é¢„å åº“å­˜ï¼ˆé”å®šå•†å“ï¼‰
    â”‚
    â–¼
3ï¸âƒ£ ç”¨æˆ·æ”¯ä»˜
    â”‚
    â–¼ (æ”¯ä»˜æˆåŠŸ)
4ï¸âƒ£ ç¡®è®¤å‡ºåº“ï¼ˆçœŸæ­£å‡åº“å­˜ï¼‰

å¼‚å¸¸å¤„ç†æµç¨‹ï¼š
ç”¨æˆ·ä¸‹å•
    â”‚
    â–¼
1ï¸âƒ£ æ£€æŸ¥åº“å­˜
    â”‚
    â–¼ (åº“å­˜ä¸è¶³)
2ï¸âƒ£ è¿”å›åº“å­˜ä¸è¶³é”™è¯¯

æˆ–è€…ï¼š
2ï¸âƒ£ é¢„å åº“å­˜æˆåŠŸ
    â”‚
    â–¼
3ï¸âƒ£ æ”¯ä»˜è¶…æ—¶/å¤±è´¥
    â”‚
    â–¼
4ï¸âƒ£ é‡Šæ”¾é¢„å åº“å­˜
```

**â° åº“å­˜é¢„å è¶…æ—¶æœºåˆ¶**

```java
// åº“å­˜é¢„å æœ‰æ—¶é—´é™åˆ¶
public class InventoryReservation {
    private ProductId productId;
    private int quantity;
    private LocalDateTime reserveTime;
    private Duration timeout = Duration.ofMinutes(15); // 15åˆ†é’Ÿè¶…æ—¶
    
    public boolean isExpired() {
        return LocalDateTime.now().isAfter(reserveTime.plus(timeout));
    }
}
```

### 4.4 åº“å­˜æœåŠ¡ä¸å…¶ä»–æœåŠ¡çš„åä½œ


**ğŸ”— ä¸è®¢å•æœåŠ¡çš„åä½œ**

```
è®¢å•åˆ›å»ºæµç¨‹ä¸­çš„åº“å­˜äº¤äº’ï¼š

1. è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡ï¼š"é¢„å åº“å­˜"
   POST /inventory/reserve
   {"productId": "123", "quantity": 2}

2. åº“å­˜æœåŠ¡ â†’ è®¢å•æœåŠ¡ï¼š"é¢„å æˆåŠŸ"
   {"reservationId": "res_456", "success": true}

3. æ”¯ä»˜å®Œæˆå â†’ åº“å­˜æœåŠ¡ï¼š"ç¡®è®¤å‡ºåº“"
   POST /inventory/confirm
   {"reservationId": "res_456"}

4. æ”¯ä»˜å¤±è´¥å â†’ åº“å­˜æœåŠ¡ï¼š"é‡Šæ”¾é¢„å "
   POST /inventory/cancel
   {"reservationId": "res_456"}
```

---

## 5. ğŸ’³ æ”¯ä»˜æœåŠ¡ç‹¬ç«‹è®¾è®¡


### 5.1 æ”¯ä»˜æœåŠ¡çš„ç‹¬ç«‹æ€§


**ğŸ”’ ä¸ºä»€ä¹ˆæ”¯ä»˜æœåŠ¡å¿…é¡»ç‹¬ç«‹**
æ”¯ä»˜å°±åƒé“¶è¡Œï¼Œå¿…é¡»æœ‰ä¸¥æ ¼çš„å®‰å…¨æªæ–½å’Œç‹¬ç«‹çš„ç®¡ç†ã€‚å¦‚æœæŠŠæ”¯ä»˜åŠŸèƒ½å’Œå…¶ä»–åŠŸèƒ½æ··åœ¨ä¸€èµ·ï¼Œé£é™©å¤ªå¤§ã€‚

```
æ”¯ä»˜æœåŠ¡ç‹¬ç«‹çš„åŸå› ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” å®‰å…¨éš”ç¦»     â”‚ â† æ”¯ä»˜æ•°æ®éœ€è¦ç‰¹æ®Šä¿æŠ¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“œ åˆè§„è¦æ±‚     â”‚ â† æ”¯ä»˜è¡Œä¸šæœ‰ä¸¥æ ¼è§„èŒƒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”„ å¤šæ”¯ä»˜æ¸ é“   â”‚ â† æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š è´¢åŠ¡ç®¡ç†     â”‚ â† ç‹¬ç«‹çš„è´¢åŠ¡æ ¸ç®—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ”¯ä»˜é¢†åŸŸæ¨¡å‹


**ğŸ’° æ”¯ä»˜æ ¸å¿ƒå®ä½“**

```java
// æ”¯ä»˜è®¢å•èšåˆæ ¹
public class PaymentOrder {
    private PaymentId paymentId;         // æ”¯ä»˜å•å·
    private OrderId orderId;             // å…³è”çš„ä¸šåŠ¡è®¢å•å·
    private UserId userId;               // ç”¨æˆ·ID
    private Money amount;                // æ”¯ä»˜é‡‘é¢
    private PaymentMethod paymentMethod; // æ”¯ä»˜æ–¹å¼
    private PaymentStatus status;        // æ”¯ä»˜çŠ¶æ€
    
    public PaymentResult pay() {
        // 1. éªŒè¯æ”¯ä»˜é‡‘é¢
        // 2. è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜
        // 3. æ›´æ–°æ”¯ä»˜çŠ¶æ€
        // 4. å‘å¸ƒæ”¯ä»˜æˆåŠŸäº‹ä»¶
    }
}

// æ”¯ä»˜çŠ¶æ€æšä¸¾
public enum PaymentStatus {
    PENDING,    // å¾…æ”¯ä»˜
    PROCESSING, // æ”¯ä»˜ä¸­
    SUCCESS,    // æ”¯ä»˜æˆåŠŸ
    FAILED,     // æ”¯ä»˜å¤±è´¥
    CANCELLED   // æ”¯ä»˜å–æ¶ˆ
}
```

### 5.3 æ”¯ä»˜æµç¨‹è®¾è®¡


**ğŸ’³ å®Œæ•´æ”¯ä»˜æµç¨‹**

```
æ”¯ä»˜æµç¨‹å›¾ï¼š

ç”¨æˆ·å‘èµ·æ”¯ä»˜
    â”‚
    â–¼
1ï¸âƒ£ åˆ›å»ºæ”¯ä»˜å•
    â”‚
    â–¼
2ï¸âƒ£ è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£
    â”‚
    â”œâ”€â”€â”€ æ”¯ä»˜å® â”€â”€â”
    â”œâ”€â”€â”€ å¾®ä¿¡æ”¯ä»˜ â”€â”¤
    â””â”€â”€â”€ é“¶è¡Œå¡ â”€â”€â”˜
    â”‚
    â–¼
3ï¸âƒ£ ç­‰å¾…æ”¯ä»˜ç»“æœ
    â”‚
    â”œâ”€â”€â”€ æˆåŠŸ â†’ 4ï¸âƒ£ å‘å¸ƒæ”¯ä»˜æˆåŠŸäº‹ä»¶
    â””â”€â”€â”€ å¤±è´¥ â†’ 5ï¸âƒ£ å‘å¸ƒæ”¯ä»˜å¤±è´¥äº‹ä»¶
```

**ğŸ”„ æ”¯ä»˜çŠ¶æ€æµè½¬**

| å½“å‰çŠ¶æ€ | æ“ä½œ | ç›®æ ‡çŠ¶æ€ | è¯´æ˜ |
|---------|------|---------|------|
| `PENDING` | å¼€å§‹æ”¯ä»˜ | `PROCESSING` | ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜æŒ‰é’® |
| `PROCESSING` | æ”¯ä»˜æˆåŠŸ | `SUCCESS` | ç¬¬ä¸‰æ–¹è¿”å›æˆåŠŸ |
| `PROCESSING` | æ”¯ä»˜å¤±è´¥ | `FAILED` | ç¬¬ä¸‰æ–¹è¿”å›å¤±è´¥ |
| `PENDING` | å–æ¶ˆæ”¯ä»˜ | `CANCELLED` | ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆ |

### 5.4 æ”¯ä»˜æœåŠ¡æ¥å£è®¾è®¡


**ğŸ“¡ æ”¯ä»˜æœåŠ¡API**

```java
// æ”¯ä»˜æœåŠ¡æ¥å£
@RestController
public class PaymentController {
    
    // åˆ›å»ºæ”¯ä»˜å•
    @PostMapping("/payments")
    public PaymentOrder createPayment(@RequestBody CreatePaymentRequest request) {
        // åˆ›å»ºæ”¯ä»˜å•ï¼Œè¿”å›æ”¯ä»˜ä¿¡æ¯
    }
    
    // æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€
    @GetMapping("/payments/{paymentId}")
    public PaymentStatus getPaymentStatus(@PathVariable String paymentId) {
        // è¿”å›æ”¯ä»˜çŠ¶æ€
    }
    
    // æ”¯ä»˜å›è°ƒæ¥å£ï¼ˆç¬¬ä¸‰æ–¹æ”¯ä»˜è°ƒç”¨ï¼‰
    @PostMapping("/payments/callback")
    public void paymentCallback(@RequestBody PaymentCallbackRequest request) {
        // å¤„ç†ç¬¬ä¸‰æ–¹æ”¯ä»˜å›è°ƒ
    }
}
```

---

## 6. ğŸ“¨ é¢†åŸŸäº‹ä»¶åœ¨æœåŠ¡é—´çš„åº”ç”¨


### 6.1 ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶


**ğŸ¯ é¢†åŸŸäº‹ä»¶çš„é€šä¿—ç†è§£**
é¢†åŸŸäº‹ä»¶å°±åƒç”Ÿæ´»ä¸­çš„"é€šçŸ¥æ¶ˆæ¯"ã€‚æ¯”å¦‚ä½ åœ¨ç½‘ä¸Šä¸‹å•åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘é€çŸ­ä¿¡é€šçŸ¥ä½ "è®¢å•å·²åˆ›å»º"ï¼Œè¿™ä¸ªçŸ­ä¿¡å°±ç±»ä¼¼äºé¢†åŸŸäº‹ä»¶ã€‚

```
ç°å®ç”Ÿæ´»ä¸­çš„äº‹ä»¶ï¼š
ğŸ“± "æ‚¨çš„å¤–å–è®¢å•å·²ç¡®è®¤" â†’ é€šçŸ¥ç”¨æˆ·
ğŸ“§ "æ‚¨çš„å¿«é€’å·²å‘è´§"     â†’ é€šçŸ¥ç”¨æˆ·
ğŸ’° "æ‚¨çš„è´¦æˆ·å·²æ‰£æ¬¾"     â†’ é€šçŸ¥é“¶è¡Œ

å¾®æœåŠ¡ä¸­çš„é¢†åŸŸäº‹ä»¶ï¼š
ğŸ›’ "è®¢å•å·²åˆ›å»º"äº‹ä»¶ â†’ é€šçŸ¥åº“å­˜æœåŠ¡ã€æ”¯ä»˜æœåŠ¡
ğŸ’³ "æ”¯ä»˜å·²å®Œæˆ"äº‹ä»¶ â†’ é€šçŸ¥è®¢å•æœåŠ¡ã€ç‰©æµæœåŠ¡  
ğŸ“¦ "å•†å“å·²å‘è´§"äº‹ä»¶ â†’ é€šçŸ¥è®¢å•æœåŠ¡ã€ç”¨æˆ·æœåŠ¡
```

### 6.2 é¢†åŸŸäº‹ä»¶çš„è®¾è®¡


**ğŸ“‹ äº‹ä»¶ç»“æ„è®¾è®¡**

```java
// åŸºç¡€äº‹ä»¶æ¥å£
public interface DomainEvent {
    String getEventId();        // äº‹ä»¶å”¯ä¸€ID
    LocalDateTime getOccurredOn(); // äº‹ä»¶å‘ç”Ÿæ—¶é—´
    String getEventType();      // äº‹ä»¶ç±»å‹
}

// è®¢å•åˆ›å»ºäº‹ä»¶
public class OrderCreatedEvent implements DomainEvent {
    private String eventId;
    private LocalDateTime occurredOn;
    private String orderId;
    private String userId;
    private List<OrderItem> orderItems;
    
    // getterå’Œsetter...
}

// æ”¯ä»˜å®Œæˆäº‹ä»¶
public class PaymentCompletedEvent implements DomainEvent {
    private String eventId;
    private LocalDateTime occurredOn;
    private String paymentId;
    private String orderId;
    private BigDecimal amount;
    
    // getterå’Œsetter...
}
```

### 6.3 äº‹ä»¶å‘å¸ƒä¸è®¢é˜…


**ğŸ“¤ äº‹ä»¶å‘å¸ƒæœºåˆ¶**

```java
// äº‹ä»¶å‘å¸ƒå™¨
@Component
public class EventPublisher {
    
    @Autowired
    private MessageProducer messageProducer;
    
    public void publish(DomainEvent event) {
        // 1. åºåˆ—åŒ–äº‹ä»¶
        String eventJson = serialize(event);
        
        // 2. å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—
        messageProducer.send(event.getEventType(), eventJson);
        
        // 3. è®°å½•äº‹ä»¶æ—¥å¿—
        logEvent(event);
    }
}
```

**ğŸ“¥ äº‹ä»¶è®¢é˜…å¤„ç†**

```java
// åº“å­˜æœåŠ¡ç›‘å¬è®¢å•äº‹ä»¶
@Component
public class InventoryEventHandler {
    
    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        // å¤„ç†è®¢å•åˆ›å»ºï¼šé¢„å åº“å­˜
        for (OrderItem item : event.getOrderItems()) {
            inventoryService.reserve(item.getProductId(), item.getQuantity());
        }
    }
    
    @EventListener  
    public void handlePaymentCompleted(PaymentCompletedEvent event) {
        // å¤„ç†æ”¯ä»˜å®Œæˆï¼šç¡®è®¤å‡ºåº“
        inventoryService.confirmReservation(event.getOrderId());
    }
}
```

### 6.4 äº‹ä»¶é©±åŠ¨çš„ä¸šåŠ¡æµç¨‹


**ğŸ”„ å®Œæ•´çš„äº‹ä»¶é©±åŠ¨æµç¨‹**

```
è®¢å•å¤„ç†çš„äº‹ä»¶æµï¼š

1ï¸âƒ£ ç”¨æˆ·ä¸‹å•
   è®¢å•æœåŠ¡ â†’ å‘å¸ƒ "OrderCreatedEvent"
   
2ï¸âƒ£ åº“å­˜é¢„å 
   åº“å­˜æœåŠ¡ â† ç›‘å¬ "OrderCreatedEvent"
   åº“å­˜æœåŠ¡ â†’ å‘å¸ƒ "InventoryReservedEvent"
   
3ï¸âƒ£ ç”¨æˆ·æ”¯ä»˜
   æ”¯ä»˜æœåŠ¡ â†’ å‘å¸ƒ "PaymentCompletedEvent"
   
4ï¸âƒ£ åº“å­˜ç¡®è®¤
   åº“å­˜æœåŠ¡ â† ç›‘å¬ "PaymentCompletedEvent"  
   åº“å­˜æœåŠ¡ â†’ å‘å¸ƒ "InventoryConfirmedEvent"
   
5ï¸âƒ£ è®¢å•å®Œæˆ
   è®¢å•æœåŠ¡ â† ç›‘å¬ "InventoryConfirmedEvent"
   è®¢å•æœåŠ¡ â†’ å‘å¸ƒ "OrderCompletedEvent"
```

**âš ï¸ äº‹ä»¶å¤„ç†çš„æ³¨æ„äº‹é¡¹**

| é—®é¢˜åœºæ™¯ | è§£å†³æ–¹æ¡ˆ | è¯´æ˜ |
|---------|---------|------|
| **äº‹ä»¶é‡å¤** | å¹‚ç­‰æ€§å¤„ç† | åŒä¸€ä¸ªäº‹ä»¶å¤šæ¬¡å¤„ç†ç»“æœç›¸åŒ |
| **äº‹ä»¶é¡ºåº** | äº‹ä»¶åºå· | ç¡®ä¿äº‹ä»¶æŒ‰æ­£ç¡®é¡ºåºå¤„ç† |
| **äº‹ä»¶ä¸¢å¤±** | å¯é æ€§ä¿è¯ | äº‹ä»¶å­˜å‚¨å’Œé‡è¯•æœºåˆ¶ |
| **å¤„ç†å¤±è´¥** | è¡¥å¿æœºåˆ¶ | å¤±è´¥æ—¶å›æ»šæˆ–è¡¥å¿æ“ä½œ |

---

## 7. ğŸ¤ æœåŠ¡é—´åä½œæœºåˆ¶


### 7.1 æœåŠ¡åä½œæ¨¡å¼


**ğŸ­ ç¼–æ’æ¨¡å¼ vs ç¼–é…æ¨¡å¼**

```
ç¼–æ’æ¨¡å¼ï¼ˆOrchestrationï¼‰- ä¸­å¤®æŒ‡æŒ¥ï¼š
                è®¢å•æœåŠ¡ï¼ˆæŒ‡æŒ¥å®˜ï¼‰
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼            â–¼            â–¼
    ç”¨æˆ·æœåŠ¡      åº“å­˜æœåŠ¡      æ”¯ä»˜æœåŠ¡
    
ç¼–é…æ¨¡å¼ï¼ˆChoreographyï¼‰- å„è‡ªå“åº”ï¼š
    è®¢å•äº‹ä»¶ â†’ åº“å­˜æœåŠ¡è‡ªåŠ¨å“åº”
    æ”¯ä»˜äº‹ä»¶ â†’ è®¢å•æœåŠ¡è‡ªåŠ¨å“åº”
    åº“å­˜äº‹ä»¶ â†’ ç‰©æµæœåŠ¡è‡ªåŠ¨å“åº”
```

**ğŸ¯ æ¨¡å¼é€‰æ‹©æŒ‡å—**

| åœºæ™¯ç±»å‹ | æ¨èæ¨¡å¼ | åŸå›  | ç¤ºä¾‹ |
|---------|---------|------|------|
| **ç®€å•æµç¨‹** | ğŸ­ ç¼–æ’æ¨¡å¼ | æµç¨‹æ¸…æ™°ï¼Œæ˜“äºæ§åˆ¶ | ç”¨æˆ·æ³¨å†Œæµç¨‹ |
| **å¤æ‚æµç¨‹** | ğŸª ç¼–é…æ¨¡å¼ | é™ä½è€¦åˆï¼Œæé«˜çµæ´»æ€§ | è®¢å•å¤„ç†æµç¨‹ |
| **å®æ—¶è¦æ±‚é«˜** | ğŸ­ ç¼–æ’æ¨¡å¼ | ç›´æ¥è°ƒç”¨ï¼Œå“åº”å¿« | æ”¯ä»˜éªŒè¯ |
| **å¯é æ€§è¦æ±‚é«˜** | ğŸª ç¼–é…æ¨¡å¼ | å¼‚æ­¥å¤„ç†ï¼Œå®¹é”™æ€§å¥½ | æ•°æ®åŒæ­¥ |

### 7.2 æ•°æ®ä¸€è‡´æ€§ä¿è¯


**ğŸ’¡ åˆ†å¸ƒå¼äº‹åŠ¡çš„æŒ‘æˆ˜**
åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªä¸šåŠ¡æ“ä½œå¯èƒ½æ¶‰åŠå¤šä¸ªæœåŠ¡ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§æ˜¯ä¸ªå¤§æŒ‘æˆ˜ã€‚

```
ä¼ ç»Ÿäº‹åŠ¡ï¼ˆå•ä¸ªæ•°æ®åº“ï¼‰ï¼š
å¼€å§‹äº‹åŠ¡ â†’ æ“ä½œA â†’ æ“ä½œB â†’ æ“ä½œC â†’ æäº¤äº‹åŠ¡
ï¼ˆè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ï¼‰

åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¤šä¸ªæœåŠ¡ï¼‰ï¼š
æœåŠ¡Aæ“ä½œ â†’ æœåŠ¡Bæ“ä½œ â†’ æœåŠ¡Cæ“ä½œ
ï¼ˆå¯èƒ½éƒ¨åˆ†æˆåŠŸï¼Œéƒ¨åˆ†å¤±è´¥ï¼‰
```

**ğŸ”„ Sagaæ¨¡å¼å®ç°**

```java
// Sagaåè°ƒå™¨
public class OrderSagaOrchestrator {
    
    public void processOrder(OrderCreatedEvent event) {
        try {
            // æ­¥éª¤1ï¼šé¢„å åº“å­˜
            ReserveInventoryCommand reserveCmd = new ReserveInventoryCommand(event);
            CommandResult result1 = inventoryService.reserve(reserveCmd);
            
            if (result1.isSuccess()) {
                // æ­¥éª¤2ï¼šåˆ›å»ºæ”¯ä»˜å•
                CreatePaymentCommand paymentCmd = new CreatePaymentCommand(event);
                CommandResult result2 = paymentService.createPayment(paymentCmd);
                
                if (!result2.isSuccess()) {
                    // è¡¥å¿ï¼šé‡Šæ”¾åº“å­˜
                    CancelReservationCommand cancelCmd = new CancelReservationCommand(result1.getReservationId());
                    inventoryService.cancelReservation(cancelCmd);
                }
            }
            
        } catch (Exception e) {
            // æ‰§è¡Œè¡¥å¿æ“ä½œ
            executeCompensation(event);
        }
    }
}
```

### 7.3 æœåŠ¡é—´é€šä¿¡æœ€ä½³å®è·µ


**ğŸ“ åŒæ­¥è°ƒç”¨æœ€ä½³å®è·µ**

```java
// ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼
@Component
public class UserServiceClient {
    
    @Autowired
    private CircuitBreaker circuitBreaker;
    
    public User getUserById(String userId) {
        return circuitBreaker.executeSupplier(() -> {
            // HTTPè°ƒç”¨ç”¨æˆ·æœåŠ¡
            return restTemplate.getForObject("/users/" + userId, User.class);
        });
    }
}

// è®¾ç½®è¶…æ—¶å’Œé‡è¯•
@Bean
public RestTemplate restTemplate() {
    RestTemplate template = new RestTemplate();
    
    // è®¾ç½®è¿æ¥è¶…æ—¶ï¼š5ç§’
    template.setRequestFactory(new HttpComponentsClientHttpRequestFactory());
    HttpComponentsClientHttpRequestFactory factory = 
        (HttpComponentsClientHttpRequestFactory) template.getRequestFactory();
    factory.setConnectTimeout(5000);
    factory.setReadTimeout(10000);
    
    return template;
}
```

**ğŸ“¨ å¼‚æ­¥æ¶ˆæ¯æœ€ä½³å®è·µ**

```java
// æ¶ˆæ¯å‘é€
@Component
public class OrderEventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void publishOrderCreated(OrderCreatedEvent event) {
        try {
            // å‘é€æ¶ˆæ¯
            rabbitTemplate.convertAndSend("order.exchange", "order.created", event);
            
            // è®°å½•å‘é€æ—¥å¿—
            log.info("Published OrderCreatedEvent: {}", event.getOrderId());
            
        } catch (Exception e) {
            // å‘é€å¤±è´¥å¤„ç†
            log.error("Failed to publish event", e);
            // å¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“ï¼Œåç»­é‡è¯•
        }
    }
}

// æ¶ˆæ¯æ¥æ”¶
@RabbitListener(queues = "inventory.order.created.queue")
public void handleOrderCreated(OrderCreatedEvent event) {
    try {
        // å¤„ç†ä¸šåŠ¡é€»è¾‘
        inventoryService.reserveForOrder(event);
        
    } catch (Exception e) {
        // å¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šé‡æ–°å…¥é˜Ÿé‡è¯•
        log.error("Failed to handle OrderCreatedEvent", e);
        throw e; // æŠ›å‡ºå¼‚å¸¸è§¦å‘é‡è¯•
    }
}
```

### 7.4 ç›‘æ§å’Œæ•…éšœå¤„ç†


**ğŸ“Š æœåŠ¡ç›‘æ§æŒ‡æ ‡**

```
é‡è¦ç›‘æ§æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â±ï¸ å“åº”æ—¶é—´     â”‚ â† æœåŠ¡è°ƒç”¨çš„è€—æ—¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ æˆåŠŸç‡       â”‚ â† è°ƒç”¨æˆåŠŸçš„æ¯”ä¾‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”„ é‡è¯•æ¬¡æ•°     â”‚ â† å¤±è´¥é‡è¯•çš„é¢‘ç‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ èµ„æºä½¿ç”¨ç‡   â”‚ â† CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸš¨ æ•…éšœå¤„ç†ç­–ç•¥**

| æ•…éšœç±»å‹ | å¤„ç†ç­–ç•¥ | å®ç°æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| **æœåŠ¡ä¸å¯ç”¨** | ç†”æ–­é™çº§ | Circuit Breaker | ä¾èµ–æœåŠ¡æ•…éšœ |
| **å“åº”è¶…æ—¶** | è¶…æ—¶é‡è¯• | Timeout + Retry | ç½‘ç»œæ³¢åŠ¨ |
| **æ¶ˆæ¯ä¸¢å¤±** | æ¶ˆæ¯ç¡®è®¤ | ACKæœºåˆ¶ | å¼‚æ­¥é€šä¿¡ |
| **æ•°æ®ä¸ä¸€è‡´** | æœ€ç»ˆä¸€è‡´æ€§ | Sagaæ¨¡å¼ | åˆ†å¸ƒå¼äº‹åŠ¡ |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ DDDä¸å¾®æœåŠ¡ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†æœåŠ¡ï¼Œè€Œä¸æ˜¯æŒ‰æŠ€æœ¯å±‚æ¬¡
ğŸ”¸ é™ç•Œä¸Šä¸‹æ–‡ï¼šå®šä¹‰æ¸…æ™°çš„æœåŠ¡è¾¹ç•Œï¼Œé¿å…åŠŸèƒ½é‡å 
ğŸ”¸ é¢†åŸŸäº‹ä»¶ï¼šæœåŠ¡é—´å¼‚æ­¥é€šä¿¡çš„é‡è¦æ–¹å¼
ğŸ”¸ æœåŠ¡åä½œï¼šç¼–æ’æ¨¡å¼vsç¼–é…æ¨¡å¼çš„é€‰æ‹©
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„äº‹åŠ¡å¤„ç†æŒ‘æˆ˜
```

### 8.2 å®è·µç»éªŒæ€»ç»“


**âœ… æˆåŠŸç»éªŒ**
- **å…ˆå»ºæ¨¡å†æ‹†åˆ†**ï¼šåŸºäºDDDå»ºç«‹é¢†åŸŸæ¨¡å‹ï¼Œå†åˆ’åˆ†å¾®æœåŠ¡è¾¹ç•Œ
- **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šä½¿ç”¨é¢†åŸŸäº‹ä»¶å®ç°æœåŠ¡é—´æ¾è€¦åˆ
- **æ¸è¿›å¼æ”¹é€ **ï¼šä»å•ä½“åº”ç”¨é€æ­¥æ‹†åˆ†ï¼Œä¸è¦ä¸€æ¬¡æ€§å¤§æ”¹
- **ç›‘æ§ä¸ºå…ˆ**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

**âŒ å¸¸è§é™·é˜±**
- **è¿‡åº¦æ‹†åˆ†**ï¼šæŠŠå¾®æœåŠ¡æ‹†å¾—å¤ªç»†ï¼Œå¢åŠ å¤æ‚æ€§
- **æ•°æ®å…±äº«**ï¼šå¤šä¸ªæœåŠ¡ç›´æ¥è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“
- **åŒæ­¥è°ƒç”¨è¿‡å¤š**ï¼šæœåŠ¡é—´å¤§é‡åŒæ­¥è°ƒç”¨ï¼Œå½¢æˆå¼ºè€¦åˆ
- **å¿½ç•¥è¿ç»´å¤æ‚æ€§**ï¼šåªè€ƒè™‘å¼€å‘ï¼Œä¸è€ƒè™‘éƒ¨ç½²è¿ç»´

### 8.3 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ é¡ºåº**
```
1ï¸âƒ£ ç†è§£DDDåŸºæœ¬æ¦‚å¿µ
   â†“
2ï¸âƒ£ å­¦ä¹ å¾®æœåŠ¡æ‹†åˆ†åŸåˆ™  
   â†“
3ï¸âƒ£ æŒæ¡æœåŠ¡é—´é€šä¿¡æ¨¡å¼
   â†“
4ï¸âƒ£ å®è·µåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
   â†“
5ï¸âƒ£ å»ºç«‹ç›‘æ§å’Œè¿ç»´ä½“ç³»
```

**ğŸ› ï¸ å®è·µå»ºè®®**
- **ä»ç®€å•å¼€å§‹**ï¼šå…ˆå®ç°åŸºæœ¬çš„CRUDæ“ä½œ
- **é€æ­¥å®Œå–„**ï¼šæ·»åŠ äº‹ä»¶æœºåˆ¶ã€ç†”æ–­é™çº§ç­‰é«˜çº§ç‰¹æ€§
- **å…³æ³¨éåŠŸèƒ½æ€§éœ€æ±‚**ï¼šæ€§èƒ½ã€å¯ç”¨æ€§ã€å®‰å…¨æ€§
- **å›¢é˜Ÿåä½œ**ï¼šå»ºç«‹ä»£ç è§„èŒƒå’Œåä½œæµç¨‹

**ğŸ¯ æ ¸å¿ƒè®°å¿†**
> DDDæŒ‡å¯¼å¾®æœåŠ¡æ‹†åˆ†ï¼Œé¢†åŸŸäº‹ä»¶è¿æ¥æœåŠ¡åä½œ
> 
> è¾¹ç•Œæ¸…æ™°èŒè´£æ˜ç¡®ï¼Œç›‘æ§å®Œå–„æ•…éšœå¯æ§
> 
> å¾ªåºæ¸è¿›æŒç»­æ”¹è¿›ï¼Œç†è®ºå®è·µç›¸ç»“åˆ