---
title: 34ã€Dubboé«˜å¹¶å‘åœºæ™¯å®æˆ˜æ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [é«˜å¹¶å‘åœºæ™¯æ¦‚è¿°](#1-é«˜å¹¶å‘åœºæ™¯æ¦‚è¿°)
2. [ç§’æ€ç³»ç»Ÿæ¶æ„è®¾è®¡](#2-ç§’æ€ç³»ç»Ÿæ¶æ„è®¾è®¡)
3. [é«˜å¹¶å‘é™æµå®æˆ˜](#3-é«˜å¹¶å‘é™æµå®æˆ˜)
4. [æœåŠ¡ç†”æ–­é™çº§ç­–ç•¥](#4-æœåŠ¡ç†”æ–­é™çº§ç­–ç•¥)
5. [ç¼“å­˜ç©¿é€é˜²æŠ¤æ–¹æ¡ˆ](#5-ç¼“å­˜ç©¿é€é˜²æŠ¤æ–¹æ¡ˆ)
6. [æµé‡å‰Šå³°å¡«è°·æŠ€æœ¯](#6-æµé‡å‰Šå³°å¡«è°·æŠ€æœ¯)
7. [å¼‚æ­¥å¤„ç†ä¼˜åŒ–](#7-å¼‚æ­¥å¤„ç†ä¼˜åŒ–)
8. [æ•°æ®åº“åˆ†åº“åˆ†è¡¨](#8-æ•°æ®åº“åˆ†åº“åˆ†è¡¨)
9. [æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦](#9-æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŠ é«˜å¹¶å‘åœºæ™¯æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é«˜å¹¶å‘


**ğŸ”¸ å¤§ç™½è¯ç†è§£**
```
æƒ³è±¡ä¸€ä¸ªè¶…å¸‚ï¼š
å¹³æ—¶ï¼š10ä¸ªæ”¶é“¶å°ï¼Œé¡¾å®¢æ’é˜Ÿå¾ˆå¿«
ä¿ƒé”€æ—¥ï¼š1000äººåŒæ—¶æ¶Œå…¥ï¼Œ10ä¸ªæ”¶é“¶å°å®Œå…¨ä¸å¤Ÿç”¨

é«˜å¹¶å‘å°±æ˜¯è¿™æ ·ï¼š
- çŸ­æ—¶é—´å†…å¤§é‡ç”¨æˆ·åŒæ—¶è®¿é—®ç³»ç»Ÿ
- ç³»ç»Ÿå‹åŠ›çªç„¶å¢å¤§å¥½å‡ å€ç”šè‡³å‡ åå€
- å¦‚æœä¸åšå‡†å¤‡ï¼Œç³»ç»Ÿå¾ˆå¯èƒ½ä¼šå´©æºƒ
```

**ğŸ’¡ å…¸å‹é«˜å¹¶å‘åœºæ™¯**
- **ç§’æ€æŠ¢è´­**ï¼šiPhoneæ–°å“å¼€å”®ï¼Œå‡ ä¸‡äººåŒæ—¶æŠ¢
- **èŠ‚æ—¥ä¿ƒé”€**ï¼šåŒ11é›¶ç‚¹ï¼Œå‡ ç™¾ä¸‡è®¢å•ç¬é—´æ¶Œå…¥
- **çƒ­ç‚¹äº‹ä»¶**ï¼šæ˜æ˜Ÿçˆ†æ–™ï¼Œå¾®åšæœåŠ¡å™¨ç¬é—´å‹åŠ›æš´å¢
- **çº¢åŒ…é›¨**ï¼šæ˜¥æ™šæ‘‡ä¸€æ‘‡ï¼Œäº¿çº§ç”¨æˆ·åŒæ—¶æ“ä½œ

### 1.2 é«˜å¹¶å‘å¸¦æ¥çš„é—®é¢˜


| é—®é¢˜ç±»å‹ | **å…·ä½“è¡¨ç°** | **åæœ** |
|---------|------------|---------|
| ğŸ”´ **ç³»ç»Ÿå´©æºƒ** | `æœåŠ¡å™¨å®•æœºã€æ•°æ®åº“è¿æ¥è€—å°½` | `æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨` |
| ğŸŸ¡ **æ€§èƒ½ä¸‹é™** | `å“åº”æ—¶é—´ä»100mså˜æˆ10ç§’` | `ç”¨æˆ·ä½“éªŒæå·®` |
| ğŸŸ  **æ•°æ®ä¸ä¸€è‡´** | `åº“å­˜æ‰£å‡é”™è¯¯ã€é‡å¤ä¸‹å•` | `ä¸šåŠ¡æŸå¤±ã€ç”¨æˆ·æŠ•è¯‰` |
| ğŸ”µ **èµ„æºæµªè´¹** | `å¤§é‡æ— æ•ˆè¯·æ±‚å ç”¨èµ„æº` | `æˆæœ¬å¢åŠ ã€çœŸå®ç”¨æˆ·æ— æ³•è®¿é—®` |

> âš ï¸ **æ ¸å¿ƒæŒ‘æˆ˜**ï¼šå¦‚ä½•åœ¨æœ‰é™çš„èµ„æºä¸‹ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šè¿è¡Œï¼ŒåŒæ—¶ç»™ç”¨æˆ·è‰¯å¥½ä½“éªŒ

---

## 2. ğŸ¯ ç§’æ€ç³»ç»Ÿæ¶æ„è®¾è®¡


### 2.1 ç§’æ€ç³»ç»Ÿçš„ç‰¹ç‚¹


**ğŸ”¸ ç§’æ€ä¸šåŠ¡ç‰¹æ€§**
```
æ—¶é—´ç‰¹ç‚¹ï¼š
â€¢ ç¬æ—¶æµé‡ï¼šå¼€å§‹å‰å‡ ç§’æµé‡æš´å¢100å€
â€¢ æŒç»­æ—¶é—´çŸ­ï¼šé€šå¸¸åªæœ‰å‡ åˆ†é’Ÿ
â€¢ å¯é¢„æµ‹ï¼šæå‰çŸ¥é“ä»€ä¹ˆæ—¶å€™å¼€å§‹

ä¸šåŠ¡ç‰¹ç‚¹ï¼š
â€¢ è¯»å¤šå†™å°‘ï¼š99%çš„äººåªæ˜¯çœ‹ï¼Œ1%çš„äººèƒ½æŠ¢åˆ°
â€¢ åº“å­˜æœ‰é™ï¼š100ä¸ªå•†å“ï¼Œ10ä¸‡äººæŠ¢
â€¢ å…è®¸éƒ¨åˆ†å¤±è´¥ï¼šæŠ¢ä¸åˆ°å¾ˆæ­£å¸¸ï¼Œä¸å½±å“ä½“éªŒ
```

**ğŸ’­ è®¾è®¡æ€è·¯**
> å°±åƒæ¼”å”±ä¼šæŠ¢ç¥¨ï¼š
> - æå‰å‡†å¤‡å¥½æœåŠ¡å™¨ï¼ˆæ‰©å®¹ï¼‰
> - å‰é¢è®¾ç½®éªŒè¯ç å…³å¡ï¼ˆé˜²åˆ·ï¼‰
> - åˆ†æ‰¹æ”¾äººè¿›æ¥ï¼ˆé™æµï¼‰
> - å–å®Œäº†å°±æç¤ºç»“æŸï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰

### 2.2 ç§’æ€ç³»ç»Ÿæ•´ä½“æ¶æ„


```
ç”¨æˆ·å±‚
   â†“
CDNé™æ€èµ„æºï¼ˆå•†å“å›¾ç‰‡ã€é¡µé¢ï¼‰
   â†“
æ¥å…¥å±‚ï¼ˆNginxï¼‰â†’ [é™æµ] [é˜²åˆ·]
   â†“
åº”ç”¨å±‚ï¼ˆDubboæœåŠ¡ï¼‰
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redisç¼“å­˜   â”‚  æ¶ˆæ¯é˜Ÿåˆ—    â”‚  æ•°æ®åº“      â”‚
â”‚  ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰â”‚  ï¼ˆå‰Šå³°ï¼‰    â”‚  ï¼ˆæŒä¹…åŒ–ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ æ¶æ„åˆ†å±‚èŒè´£**

| å±‚æ¬¡ | **ä½œç”¨** | **å…³é”®æŠ€æœ¯** |
|-----|---------|------------|
| **CDNå±‚** | `é™æ€èµ„æºåŠ é€Ÿï¼Œå‡å°‘æºç«™å‹åŠ›` | `å›¾ç‰‡ã€CSSã€JSç¼“å­˜` |
| **æ¥å…¥å±‚** | `æµé‡è¿‡æ»¤ï¼Œæ¶æ„è¯·æ±‚æ‹¦æˆª` | `Nginxé™æµã€é˜²åˆ·è„šæœ¬` |
| **åº”ç”¨å±‚** | `ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ŒæœåŠ¡è°ƒç”¨` | `Dubbo RPCã€é™æµç†”æ–­` |
| **ç¼“å­˜å±‚** | `çƒ­ç‚¹æ•°æ®å­˜å‚¨ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›` | `Redisé›†ç¾¤` |
| **æ¶ˆæ¯å±‚** | `å¼‚æ­¥å¤„ç†ï¼Œæµé‡å‰Šå³°` | `RocketMQ/Kafka` |
| **å­˜å‚¨å±‚** | `æ•°æ®æŒä¹…åŒ–` | `MySQLåˆ†åº“åˆ†è¡¨` |

### 2.3 ç§’æ€ç³»ç»Ÿæ ¸å¿ƒæµç¨‹


```
ç”¨æˆ·ç‚¹å‡»ç§’æ€æŒ‰é’®
   â†“
å‰ç«¯éªŒè¯ç éªŒè¯ â”€â”€â”€â”€âœ— éªŒè¯å¤±è´¥ â†’ æç¤ºé‡è¯•
   â†“ âœ“
Nginxæ¥å…¥å±‚é™æµ â”€â”€â”€â”€âœ— è¶…å‡ºé™åˆ¶ â†’ è¿”å›"äººå¤ªå¤šï¼Œç¨åå†è¯•"
   â†“ âœ“
åº”ç”¨å±‚æ£€æŸ¥Redisåº“å­˜ â”€â”€â”€âœ— åº“å­˜ä¸è¶³ â†’ è¿”å›"å·²å”®ç½„"
   â†“ âœ“
æ‰£å‡Redisåº“å­˜
   â†“
å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼ˆå¼‚æ­¥ï¼‰
   â†“
è¿”å›ç”¨æˆ·ï¼šæŠ¢è´­æˆåŠŸ
   â†“
[åå°å¼‚æ­¥]
æ¶ˆè´¹æ¶ˆæ¯ â†’ æ‰£å‡æ•°æ®åº“åº“å­˜ â†’ ç”Ÿæˆè®¢å•
```

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼šèƒ½æŒ¡åœ¨å‰é¢çš„å°±åˆ«è®©å®ƒåˆ°åé¢ï¼Œèƒ½ç¼“å­˜çš„å°±åˆ«æŸ¥æ•°æ®åº“ï¼Œèƒ½å¼‚æ­¥çš„å°±åˆ«åŒæ­¥

---

## 3. ğŸš¦ é«˜å¹¶å‘é™æµå®æˆ˜


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦é™æµ


**ğŸ”¸ ç”Ÿæ´»ç±»æ¯”**
```
ç«è½¦ç«™å®‰æ£€å£ï¼š
- åŒæ—¶åªèƒ½è¿‡5ä¸ªäºº
- è¶…è¿‡5ä¸ªäººå°±è¦æ’é˜Ÿç­‰å¾…
- ä¿è¯å®‰æ£€è´¨é‡ï¼Œé˜²æ­¢æ‹¥å µ

ç³»ç»Ÿé™æµä¹Ÿæ˜¯ä¸€æ ·ï¼š
- ç³»ç»Ÿå¤„ç†èƒ½åŠ›æœ‰é™ï¼ˆæ¯”å¦‚æ¯ç§’1000ä¸ªè¯·æ±‚ï¼‰
- è¶…è¿‡èƒ½åŠ›å°±æ‹’ç»æˆ–æ’é˜Ÿ
- ä¿è¯ç³»ç»Ÿç¨³å®šï¼Œä¸è¢«å‹å®
```

> âš ï¸ **ä¸é™æµçš„åæœ**ï¼šå°±åƒæ°´åº“æ³„æ´ªï¼Œæ´ªæ°´ä¸€æ¥ç›´æ¥å†²å®å¤§å

### 3.2 Dubboä¸­çš„é™æµæ–¹å¼


**ğŸ”§ ä¸‰ç§é™æµä½ç½®**

```
å®¢æˆ·ç«¯é™æµï¼ˆæ¶ˆè´¹ç«¯ï¼‰
   â†“
ç½‘ç»œä¼ è¾“
   â†“
æœåŠ¡ç«¯é™æµï¼ˆæä¾›ç«¯ï¼‰
   â†“
åç«¯æœåŠ¡å¤„ç†
```

**æ–¹å¼ä¸€ï¼šå®¢æˆ·ç«¯é™æµï¼ˆactiveså‚æ•°ï¼‰**

```java
// é…ç½®ï¼šé™åˆ¶å®¢æˆ·ç«¯å¹¶å‘è°ƒç”¨æ•°
@DubboReference(actives = 10)  // åŒæ—¶æœ€å¤š10ä¸ªè¯·æ±‚åœ¨è°ƒç”¨è¿™ä¸ªæœåŠ¡
private OrderService orderService;
```

> **è§£é‡Š**ï¼šå°±åƒä½ å®¶åªæœ‰10ä¸ªå¿«é€’æŸœï¼ŒåŒæ—¶æœ€å¤šå¯„10ä¸ªå¿«é€’ï¼Œè¶…è¿‡çš„è¦ç­‰æŸœå­ç©ºå‡ºæ¥

**æ–¹å¼äºŒï¼šæœåŠ¡ç«¯é™æµï¼ˆexecuteså‚æ•°ï¼‰**

```java
// é…ç½®ï¼šé™åˆ¶æœåŠ¡ç«¯å¹¶å‘æ‰§è¡Œæ•°
@DubboService(executes = 100)  // è¿™ä¸ªæœåŠ¡åŒæ—¶æœ€å¤šå¤„ç†100ä¸ªè¯·æ±‚
public class OrderServiceImpl implements OrderService {
    // ...
}
```

> **è§£é‡Š**ï¼šå°±åƒé¤å…å¨æˆ¿åŒæ—¶åªèƒ½åš100ä»½èœï¼Œè¶…è¿‡çš„è¦ç­‰å¨å¸ˆå¿™å®Œ

**æ–¹å¼ä¸‰ï¼šé›†æˆSentinelé«˜çº§é™æµ**

```java
// åœ¨Dubboä¸­é›†æˆSentinel
@DubboService
public class SeckillServiceImpl implements SeckillService {
    
    @SentinelResource(value = "seckill",
        blockHandler = "seckillBlockHandler",  // é™æµåçš„å¤„ç†æ–¹æ³•
        fallback = "seckillFallback")          // å¼‚å¸¸åçš„å¤„ç†æ–¹æ³•
    public Result seckill(Long productId) {
        // ç§’æ€ä¸šåŠ¡é€»è¾‘
    }
    
    // é™æµå¤„ç†ï¼šå‘Šè¯‰ç”¨æˆ·"äººå¤ªå¤šäº†"
    public Result seckillBlockHandler(Long productId, BlockException e) {
        return Result.fail("æŠ¢è´­äººæ•°å¤ªå¤šï¼Œè¯·ç¨åå†è¯•");
    }
    
    // å¼‚å¸¸å¤„ç†ï¼šç³»ç»Ÿå‡ºé”™äº†
    public Result seckillFallback(Long productId, Throwable e) {
        return Result.fail("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

### 3.3 é™æµç®—æ³•é€‰æ‹©


| ç®—æ³• | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|-----|---------|---------|---------|------------|
| ğŸª£ **ä»¤ç‰Œæ¡¶** | `åŒ€é€Ÿäº§ç”Ÿä»¤ç‰Œï¼Œè¯·æ±‚æ‹¿ä»¤ç‰Œæ‰èƒ½é€šè¿‡` | `å…è®¸ä¸€å®šç¨‹åº¦çš„çªå‘æµé‡` | `å®ç°ç¨å¤æ‚` | `ç§’æ€åœºæ™¯` |
| ğŸš° **æ¼æ¡¶** | `è¯·æ±‚åƒæ°´ä¸€æ ·åŒ€é€Ÿæµå‡º` | `æµé‡ç»å¯¹å¹³æ»‘` | `ä¸èƒ½åº”å¯¹çªå‘` | `æ¶ˆæ¯æ¶ˆè´¹` |
| ğŸšª **å›ºå®šçª—å£** | `æ¯ç§’å›ºå®š1000ä¸ªè¯·æ±‚` | `å®ç°ç®€å•` | `ä¸´ç•Œé—®é¢˜` | `ç®€å•é™æµ` |
| ğŸ“Š **æ»‘åŠ¨çª—å£** | `æ›´ç²¾ç¡®çš„è®¡æ•°ç»Ÿè®¡` | `è§£å†³ä¸´ç•Œé—®é¢˜` | `å å†…å­˜å¤š` | `ç²¾ç¡®é™æµ` |

> ğŸ’¡ **å®æˆ˜å»ºè®®**ï¼šç§’æ€åœºæ™¯ç”¨**ä»¤ç‰Œæ¡¶**ï¼Œå®ƒå…è®¸çŸ­æ—¶é—´å†…çš„æµé‡çªå‘ï¼Œæ›´ç¬¦åˆçœŸå®æƒ…å†µ

---

## 4. ğŸ”Œ æœåŠ¡ç†”æ–­é™çº§ç­–ç•¥


### 4.1 ç†”æ–­é™çº§æ˜¯ä»€ä¹ˆ


**ğŸ”¸ ç”Ÿæ´»ç±»æ¯”**
```
å®¶é‡Œçš„ç”µè·¯ä¿æŠ¤ï¼š
- ç”¨ç”µå™¨å¤ªå¤šï¼Œç”µæµè¿‡å¤§
- ä¿é™©ä¸è‡ªåŠ¨æ–­å¼€ï¼ˆç†”æ–­ï¼‰
- é¿å…ç”µçº¿çƒ§æ¯ã€å¼•å‘ç«ç¾

æœåŠ¡ç†”æ–­ä¹Ÿæ˜¯ä¸€æ ·ï¼š
- ä¸‹æ¸¸æœåŠ¡å‡ºé—®é¢˜ï¼Œå“åº”è¶…æ—¶
- è‡ªåŠ¨æ–­å¼€è°ƒç”¨ï¼ˆç†”æ–­ï¼‰
- é¿å…æ•…éšœæ‰©æ•£ï¼Œæ‹–å®æ•´ä¸ªç³»ç»Ÿ
```

**é™çº§**åˆ™æ˜¯ï¼šä¿é™©ä¸æ–­äº†ï¼Œæˆ‘ä»¬ç”¨èœ¡çƒ›ç…§æ˜ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰

### 4.2 ç†”æ–­çš„ä¸‰ç§çŠ¶æ€


```
æ­£å¸¸è°ƒç”¨
   â†“
ã€å…³é—­çŠ¶æ€ã€‘æ­£å¸¸è½¬å‘è¯·æ±‚
   â†“
å¤±è´¥æ¬¡æ•°è¿‡å¤š/è¶…æ—¶è¿‡å¤š
   â†“
ã€æ‰“å¼€çŠ¶æ€ã€‘ç›´æ¥æ‹’ç»è¯·æ±‚ï¼Œå¿«é€Ÿå¤±è´¥
   â†“
ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆå¦‚10ç§’ï¼‰
   â†“
ã€åŠå¼€çŠ¶æ€ã€‘å°è¯•æ”¾è¡Œå°‘é‡è¯·æ±‚æµ‹è¯•
   â†“
æˆåŠŸ â†’ å›åˆ°å…³é—­çŠ¶æ€
å¤±è´¥ â†’ å›åˆ°æ‰“å¼€çŠ¶æ€
```

### 4.3 Dubboä¸­çš„ç†”æ–­å®ç°


**æ–¹å¼ä¸€ï¼šè¶…æ—¶ç†”æ–­**

```java
// è°ƒç”¨è¶…æ—¶è‡ªåŠ¨ç†”æ–­
@DubboReference(
    timeout = 3000,           // 3ç§’è¶…æ—¶
    retries = 0,              // ä¸é‡è¯•
    cluster = "failfast"      // å¿«é€Ÿå¤±è´¥
)
private PaymentService paymentService;
```

**æ–¹å¼äºŒï¼šé›†æˆSentinelç†”æ–­**

```java
// Sentinelé…ç½®æ–‡ä»¶
spring:
  cloud:
    sentinel:
      datasource:
        degrade-rule:  # ç†”æ–­è§„åˆ™
          - resource: orderService
            count: 50              # å¼‚å¸¸æ¯”ä¾‹é˜ˆå€¼50%
            grade: 0               # æŒ‰å¼‚å¸¸æ¯”ä¾‹ç†”æ–­
            timeWindow: 10         # ç†”æ–­æ—¶é•¿10ç§’
```

```java
// æœåŠ¡å®ç°
@DubboService
public class OrderServiceImpl implements OrderService {
    
    @DubboReference
    private PaymentService paymentService;
    
    @DubboReference
    private InventoryService inventoryService;
    
    @SentinelResource(
        value = "createOrder",
        fallback = "createOrderFallback"  // é™çº§æ–¹æ³•
    )
    public OrderResult createOrder(OrderDTO dto) {
        // è°ƒç”¨æ”¯ä»˜æœåŠ¡
        paymentService.pay(dto);
        // è°ƒç”¨åº“å­˜æœåŠ¡
        inventoryService.deduct(dto);
        return OrderResult.success();
    }
    
    // é™çº§å¤„ç†ï¼šæ”¯ä»˜æœåŠ¡æŒ‚äº†ï¼Œæˆ‘ä»¬å…ˆè®°å½•è®¢å•ï¼Œåç»­è¡¥å¿
    public OrderResult createOrderFallback(OrderDTO dto, Throwable e) {
        // è®°å½•è®¢å•åˆ°æ•°æ®åº“ï¼ŒçŠ¶æ€ä¸º"å¾…æ”¯ä»˜"
        saveOrderPending(dto);
        return OrderResult.success("è®¢å•å·²æäº¤ï¼Œæ”¯ä»˜å¤„ç†ä¸­");
    }
}
```

> ğŸ’¡ **é™çº§ç­–ç•¥**ï¼šæœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè¿”å›ä¸€ä¸ªåˆç†çš„å¤‡é€‰ç»“æœï¼Œè€Œä¸æ˜¯ç›´æ¥æŠ¥é”™

### 4.4 ç†”æ–­é™çº§æœ€ä½³å®è·µ


**ğŸ¯ è®¾è®¡åŸåˆ™**

âœ… **å¿«é€Ÿå¤±è´¥**ï¼šå‘ç°é—®é¢˜ç«‹å³ç†”æ–­ï¼Œä¸è¦ç­‰å¾…
```java
// å¥½çš„åšæ³•
@DubboReference(timeout = 1000, retries = 0)

// ä¸å¥½çš„åšæ³•
@DubboReference(timeout = 30000, retries = 3)  // ç­‰å¤ªä¹…ï¼Œé‡è¯•å¤ªå¤š
```

âœ… **æœ‰æŸæœåŠ¡**ï¼šå…³é”®åŠŸèƒ½ä¿ç•™ï¼Œæ¬¡è¦åŠŸèƒ½é™çº§
```
ç§’æ€ç³»ç»Ÿä¼˜å…ˆçº§ï¼š
æ ¸å¿ƒï¼šä¸‹å•åŠŸèƒ½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¿…é¡»ä¿è¯
é‡è¦ï¼šæŸ¥è¯¢è®¢å• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¯ä»¥é™çº§ï¼ˆæŸ¥ç¼“å­˜ï¼‰
æ¬¡è¦ï¼šè¯„è®ºåŠŸèƒ½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¯ä»¥å…³é—­
```

âœ… **ç”¨æˆ·å‹å¥½**ï¼šé™çº§åç»™ç”¨æˆ·æ˜ç¡®æç¤º
```java
// å‹å¥½æç¤º
return Result.fail("å½“å‰äººæ•°è¾ƒå¤šï¼Œè¯·ç¨åå†è¯•");

// ç³Ÿç³•æç¤º
throw new RuntimeException("æœåŠ¡å¼‚å¸¸");  // ç”¨æˆ·çœ‹ä¸æ‡‚
```

---

## 5. ğŸ›¡ï¸ ç¼“å­˜ç©¿é€é˜²æŠ¤æ–¹æ¡ˆ


### 5.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€


**ğŸ”¸ åœºæ™¯æè¿°**
```
æ­£å¸¸æµç¨‹ï¼š
ç”¨æˆ·æŸ¥è¯¢å•†å“ID=100
   â†“
Redisæœ‰ç¼“å­˜ â†’ ç›´æ¥è¿”å› âœ“

ç¼“å­˜ç©¿é€ï¼š
é»‘å®¢æŸ¥è¯¢å•†å“ID=99999999ï¼ˆä¸å­˜åœ¨ï¼‰
   â†“
Redisæ²¡ç¼“å­˜
   â†“
æŸ¥è¯¢æ•°æ®åº“ä¹Ÿæ²¡æœ‰
   â†“
å¤§é‡è¿™æ ·çš„è¯·æ±‚ â†’ æ•°æ®åº“å‹åŠ›æš´å¢ â†’ å®•æœº
```

> âš ï¸ **æœ¬è´¨é—®é¢˜**ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜èµ·ä¸åˆ°ä¿æŠ¤ä½œç”¨ï¼Œæ¯æ¬¡éƒ½æ‰“åˆ°æ•°æ®åº“

### 5.2 é˜²æŠ¤æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆæ¨èï¼‰**

```
åŸç†ï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å¸ƒéš†è¿‡æ»¤å™¨    â”‚ â† æå‰å­˜å¥½æ‰€æœ‰åˆæ³•ID
    â”‚ [å¿«é€Ÿåˆ¤æ–­]   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
    IDå­˜åœ¨å—ï¼Ÿ
      â†™      â†˜
   ä¸å­˜åœ¨      å¯èƒ½å­˜åœ¨
     â†“          â†“
  ç›´æ¥æ‹’ç»    ç»§ç»­æŸ¥ç¼“å­˜/æ•°æ®åº“
```

```java
@Service
public class ProductService {
    
    @Autowired
    private RedissonClient redisson;
    
    // å¸ƒéš†è¿‡æ»¤å™¨
    private RBloomFilter<Long> productFilter;
    
    @PostConstruct
    public void init() {
        productFilter = redisson.getBloomFilter("product:filter");
        // é¢„æœŸ100ä¸‡å•†å“ï¼Œè¯¯åˆ¤ç‡0.01%
        productFilter.tryInit(1000000, 0.0001);
        
        // æŠŠæ‰€æœ‰å•†å“IDåŠ å…¥è¿‡æ»¤å™¨
        List<Long> allProductIds = productDao.getAllIds();
        allProductIds.forEach(productFilter::add);
    }
    
    public Product getProduct(Long id) {
        // ç¬¬ä¸€æ­¥ï¼šå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­
        if (!productFilter.contains(id)) {
            return null;  // è‚¯å®šä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
        }
        
        // ç¬¬äºŒæ­¥ï¼šæŸ¥Redisç¼“å­˜
        Product product = redis.get("product:" + id);
        if (product != null) {
            return product;
        }
        
        // ç¬¬ä¸‰æ­¥ï¼šæŸ¥æ•°æ®åº“
        product = productDao.getById(id);
        if (product != null) {
            redis.set("product:" + id, product);
        }
        return product;
    }
}
```

> ğŸ’¡ **å¸ƒéš†è¿‡æ»¤å™¨ä¼˜åŠ¿**ï¼šå†…å­˜å ç”¨æå°ï¼Œ100ä¸‡æ•°æ®åªéœ€1MBï¼ŒæŸ¥è¯¢é€Ÿåº¦O(1)

**æ–¹æ¡ˆäºŒï¼šç¼“å­˜ç©ºå€¼**

```java
public Product getProduct(Long id) {
    // æŸ¥Redis
    String cacheKey = "product:" + id;
    Product product = redis.get(cacheKey);
    
    if (product != null) {
        return product;
    }
    
    // æŸ¥æ•°æ®åº“
    product = productDao.getById(id);
    
    if (product != null) {
        // æœ‰æ•°æ®ï¼Œç¼“å­˜30åˆ†é’Ÿ
        redis.set(cacheKey, product, 1800);
    } else {
        // æ²¡æœ‰æ•°æ®ï¼Œç¼“å­˜ç©ºå€¼ï¼Œä½†æ—¶é—´çŸ­ä¸€ç‚¹ï¼ˆ5åˆ†é’Ÿï¼‰
        redis.set(cacheKey, "NULL", 300);
    }
    
    return product;
}
```

> âš ï¸ **æ³¨æ„**ï¼šç¼“å­˜ç©ºå€¼è¦è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…æµªè´¹å†…å­˜

**æ–¹æ¡ˆä¸‰ï¼šæ¥å£æ ¡éªŒ**

```java
@RestController
public class ProductController {
    
    public Result getProduct(Long id) {
        // å‚æ•°æ ¡éªŒ
        if (id == null || id <= 0) {
            return Result.fail("å•†å“IDä¸åˆæ³•");
        }
        
        // IDèŒƒå›´æ ¡éªŒï¼ˆå‡è®¾å•†å“IDåœ¨1-1000000ä¹‹é—´ï¼‰
        if (id > 1000000) {
            return Result.fail("å•†å“ä¸å­˜åœ¨");
        }
        
        // æ­£å¸¸æŸ¥è¯¢
        Product product = productService.getProduct(id);
        return Result.success(product);
    }
}
```

### 5.3 æ–¹æ¡ˆå¯¹æ¯”


| æ–¹æ¡ˆ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|-----|---------|---------|------------|
| ğŸŒ¸ **å¸ƒéš†è¿‡æ»¤å™¨** | `å†…å­˜å°‘ï¼Œé€Ÿåº¦å¿«ï¼Œæ‹¦æˆªæ•ˆæœå¥½` | `å­˜åœ¨è¯¯åˆ¤ï¼ˆå¾ˆå°ï¼‰` | `æ•°æ®é‡å¤§ï¼Œè¯»å¤šåœºæ™¯` |
| ğŸ“¦ **ç¼“å­˜ç©ºå€¼** | `å®ç°ç®€å•ï¼Œå®Œå…¨å‡†ç¡®` | `å ç”¨ç¼“å­˜ç©ºé—´` | `æ•°æ®é‡å°ï¼ŒæŸ¥è¯¢ä¸é¢‘ç¹` |
| âœ… **æ¥å£æ ¡éªŒ** | `å‰ç½®æ‹¦æˆªï¼Œæˆæœ¬ä½` | `éœ€è¦ä¸šåŠ¡è§„åˆ™æ”¯æŒ` | `æœ‰æ˜ç¡®è§„åˆ™çš„åœºæ™¯` |

> ğŸ¯ **å®æˆ˜å»ºè®®**ï¼š**å¸ƒéš†è¿‡æ»¤å™¨ + æ¥å£æ ¡éªŒ** ç»„åˆä½¿ç”¨ï¼Œæ•ˆæœæœ€ä½³

---

## 6. ğŸŒŠ æµé‡å‰Šå³°å¡«è°·æŠ€æœ¯


### 6.1 å‰Šå³°å¡«è°·æ˜¯ä»€ä¹ˆ


**ğŸ”¸ ç”Ÿæ´»ç±»æ¯”**
```
ç”¨ç”µåœºæ™¯ï¼š
ç™½å¤©é«˜å³°æœŸï¼šç”¨ç”µé‡å¤§ï¼Œç”µåŠ›ç´§å¼ 
æ™šä¸Šä½è°·æœŸï¼šç”¨ç”µé‡å°ï¼Œç”µåŠ›å¯Œä½™

å‰Šå³°å¡«è°·ï¼š
- æŠŠé«˜å³°æœŸçš„ç”¨ç”µéœ€æ±‚å»¶ååˆ°ä½è°·æœŸ
- å¹³æ»‘ç”¨ç”µæ›²çº¿ï¼Œé¿å…ç”µç½‘è¿‡è½½

æµé‡å‰Šå³°åŒç†ï¼š
ç§’æ€ç¬é—´ï¼š100ä¸‡è¯·æ±‚æ¶Œå…¥
   â†“
é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼šå˜æˆ1åˆ†é’Ÿå†…å¤„ç†å®Œ
   â†“
ç³»ç»Ÿå‹åŠ›å˜æˆï¼šæ¯ç§’1.6ä¸‡è¯·æ±‚ï¼ˆå¯æ‰¿å—ï¼‰
```

### 6.2 å‰Šå³°çš„æ ¸å¿ƒæŠ€æœ¯ï¼šæ¶ˆæ¯é˜Ÿåˆ—


```
ç§’æ€åœºæ™¯æµé‡å¯¹æ¯”ï¼š

ä¸å‰Šå³°ï¼š
   100ä¸‡è¯·æ±‚
      â†“
   0.1ç§’å†…å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“
      â†“
   æ•°æ®åº“å´©æºƒ Ã—

å‰Šå³°åï¼š
   100ä¸‡è¯·æ±‚
      â†“
   å…ˆè¿›æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç¬é—´å®Œæˆï¼‰
      â†“
   åç«¯æ…¢æ…¢æ¶ˆè´¹ï¼ˆ1åˆ†é’Ÿå¤„ç†å®Œï¼‰
      â†“
   æ•°æ®åº“å‹åŠ›å¹³ç¨³ âœ“
```

### 6.3 Dubbo + RocketMQå®ç°å‰Šå³°


**æ­¥éª¤ä¸€ï¼šæ¥æ”¶è¯·æ±‚ï¼Œå‘é€åˆ°MQ**

```java
@DubboService
public class SeckillServiceImpl implements SeckillService {
    
    @Autowired
    private RocketMQTemplate rocketMQ;
    
    @Autowired
    private RedisTemplate redis;
    
    public SeckillResult doSeckill(Long userId, Long productId) {
        // 1. æ£€æŸ¥Redisåº“å­˜
        String stockKey = "stock:" + productId;
        Long stock = redis.opsForValue().decrement(stockKey);
        
        if (stock < 0) {
            // åº“å­˜ä¸è¶³ï¼Œæ¢å¤åº“å­˜
            redis.opsForValue().increment(stockKey);
            return SeckillResult.fail("å•†å“å·²å”®ç½„");
        }
        
        // 2. åº“å­˜å……è¶³ï¼Œå‘é€æ¶ˆæ¯åˆ°MQ
        SeckillMessage msg = new SeckillMessage(userId, productId);
        rocketMQ.syncSend("seckill-topic", msg);
        
        // 3. ç«‹å³è¿”å›ç”¨æˆ·ï¼ˆä¸ç­‰å¾…åç»­å¤„ç†ï¼‰
        return SeckillResult.success("æŠ¢è´­æˆåŠŸï¼Œè®¢å•ç”Ÿæˆä¸­");
    }
}
```

**æ­¥éª¤äºŒï¼šå¼‚æ­¥æ¶ˆè´¹MQæ¶ˆæ¯**

```java
@Component
@RocketMQMessageListener(
    topic = "seckill-topic",
    consumerGroup = "seckill-consumer"
)
public class SeckillConsumer implements RocketMQListener<SeckillMessage> {
    
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private InventoryService inventoryService;
    
    @Override
    public void onMessage(SeckillMessage msg) {
        try {
            // 1. æ‰£å‡æ•°æ®åº“åº“å­˜
            inventoryService.deductStock(msg.getProductId(), 1);
            
            // 2. ç”Ÿæˆè®¢å•
            orderService.createOrder(msg.getUserId(), msg.getProductId());
            
            // 3. å‘é€é€šçŸ¥ï¼ˆçŸ­ä¿¡/æ¨é€ï¼‰
            notifyUser(msg.getUserId(), "æŠ¢è´­æˆåŠŸï¼Œè¯·å°½å¿«æ”¯ä»˜");
            
        } catch (Exception e) {
            // å¤±è´¥äº†å¯ä»¥é‡è¯•æˆ–è¡¥å¿
            log.error("ç§’æ€è®¢å•å¤„ç†å¤±è´¥", e);
        }
    }
}
```

### 6.4 å‰Šå³°æ•ˆæœå¯¹æ¯”


| æŒ‡æ ‡ | **ä¸å‰Šå³°** | **å‰Šå³°å** |
|-----|----------|----------|
| ğŸ“Š **ç¬æ—¶QPS** | `100ä¸‡/ç§’` | `1000/ç§’` |
| â±ï¸ **å“åº”æ—¶é—´** | `10ç§’ä»¥ä¸Š` | `100mså†…` |
| ğŸ’¾ **æ•°æ®åº“è¿æ¥** | `ç¬é—´æ‰“æ»¡` | `å¹³ç¨³ä½¿ç”¨` |
| âœ… **æˆåŠŸç‡** | `20%` | `95%` |
| ğŸ‘¤ **ç”¨æˆ·ä½“éªŒ** | `é¡µé¢å¡æ­»` | `ç§’çº§å“åº”` |

> ğŸ’¡ **æ ¸å¿ƒä»·å€¼**ï¼šç”¨æˆ·ä½“éªŒå¥½ï¼ˆå¿«é€Ÿå“åº”ï¼‰ï¼Œç³»ç»Ÿå‹åŠ›å°ï¼ˆæ…¢æ…¢å¤„ç†ï¼‰ï¼Œè¿™å°±æ˜¯å‰Šå³°çš„å¨åŠ›

---

## 7. âš¡ å¼‚æ­¥å¤„ç†ä¼˜åŒ–


### 7.1 ä¸ºä»€ä¹ˆè¦å¼‚æ­¥å¤„ç†


**ğŸ”¸ åŒæ­¥è°ƒç”¨çš„é—®é¢˜**
```
åŒæ­¥æµç¨‹ï¼ˆæ…¢ï¼‰ï¼š
ç”¨æˆ·ä¸‹å•
   â†“ ç­‰å¾…3ç§’
è°ƒç”¨æ”¯ä»˜æœåŠ¡
   â†“ ç­‰å¾…2ç§’
è°ƒç”¨åº“å­˜æœåŠ¡
   â†“ ç­‰å¾…1ç§’
å‘é€çŸ­ä¿¡
   â†“ ç­‰å¾…1ç§’
è¿”å›ç»“æœ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è€—æ—¶ï¼š7ç§’ Ã—

å¼‚æ­¥æµç¨‹ï¼ˆå¿«ï¼‰ï¼š
ç”¨æˆ·ä¸‹å•
   â†“ 
ç«‹å³è¿”å›"è®¢å•å·²æäº¤" â† 100ms
   â†“
åå°å¼‚æ­¥å¤„ç†ï¼š
- æ”¯ä»˜ï¼ˆ3ç§’ï¼‰
- åº“å­˜ï¼ˆ2ç§’ï¼‰  å¹¶è¡Œæ‰§è¡Œ
- çŸ­ä¿¡ï¼ˆ1ç§’ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç”¨æˆ·æ„ŸçŸ¥ï¼š100ms âœ“
```

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šç”¨æˆ·ä¸éœ€è¦ç­‰æ‰€æœ‰äº‹æƒ…åšå®Œï¼Œå…ˆç»™ä¸ªåé¦ˆï¼Œåå°æ…¢æ…¢å¹²

### 7.2 Dubboå¼‚æ­¥è°ƒç”¨


**æ–¹å¼ä¸€ï¼šCompletableFutureå¼‚æ­¥**

```java
@DubboService
public class OrderServiceImpl implements OrderService {
    
    @DubboReference(async = true)  // å¼€å¯å¼‚æ­¥è°ƒç”¨
    private PaymentService paymentService;
    
    @DubboReference(async = true)
    private InventoryService inventoryService;
    
    @DubboReference(async = true)
    private NotifyService notifyService;
    
    public OrderResult createOrder(OrderDTO dto) {
        // 1. åˆ›å»ºè®¢å•ï¼ˆåŒæ­¥ï¼Œå¿…é¡»ç­‰ï¼‰
        Order order = saveOrder(dto);
        
        // 2. å¼‚æ­¥è°ƒç”¨æ”¯ä»˜æœåŠ¡
        CompletableFuture<Void> payFuture = CompletableFuture.runAsync(() -> {
            paymentService.pay(order.getId(), dto.getAmount());
        });
        
        // 3. å¼‚æ­¥è°ƒç”¨åº“å­˜æœåŠ¡
        CompletableFuture<Void> stockFuture = CompletableFuture.runAsync(() -> {
            inventoryService.deduct(dto.getProductId(), dto.getQuantity());
        });
        
        // 4. å¼‚æ­¥å‘é€é€šçŸ¥
        CompletableFuture<Void> notifyFuture = CompletableFuture.runAsync(() -> {
            notifyService.sendSMS(dto.getUserId(), "è®¢å•å·²æäº¤");
        });
        
        // 5. ç«‹å³è¿”å›ï¼ˆä¸ç­‰å¼‚æ­¥å®Œæˆï¼‰
        return OrderResult.success(order.getId());
        
        // åå°ç­‰æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆ
        CompletableFuture.allOf(payFuture, stockFuture, notifyFuture)
            .whenComplete((result, ex) -> {
                if (ex != null) {
                    // å¼‚æ­¥å¤±è´¥å¤„ç†
                    handleAsyncError(order.getId(), ex);
                }
            });
    }
}
```

**æ–¹å¼äºŒï¼šäº‹ä»¶é©±åŠ¨å¼‚æ­¥**

```java
// 1. å®šä¹‰äº‹ä»¶
public class OrderCreatedEvent {
    private Long orderId;
    private Long userId;
    private BigDecimal amount;
}

// 2. å‘å¸ƒäº‹ä»¶
@DubboService
public class OrderServiceImpl implements OrderService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public OrderResult createOrder(OrderDTO dto) {
        // åˆ›å»ºè®¢å•
        Order order = saveOrder(dto);
        
        // å‘å¸ƒäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent(order);
        eventPublisher.publishEvent(event);
        
        // ç«‹å³è¿”å›
        return OrderResult.success(order.getId());
    }
}

// 3. ç›‘å¬äº‹ä»¶ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
@Component
public class OrderEventListener {
    
    @DubboReference
    private PaymentService paymentService;
    
    @Async  // å¼‚æ­¥æ‰§è¡Œ
    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        // å¼‚æ­¥è°ƒç”¨æ”¯ä»˜
        paymentService.pay(event.getOrderId(), event.getAmount());
    }
}
```

### 7.3 å¼‚æ­¥å¤„ç†æœ€ä½³å®è·µ


**âœ… é€‚åˆå¼‚æ­¥çš„åœºæ™¯**
- å‘é€çŸ­ä¿¡/é‚®ä»¶/æ¨é€é€šçŸ¥
- è®°å½•æ—¥å¿—/åŸ‹ç‚¹æ•°æ®
- ç”ŸæˆæŠ¥è¡¨/ç»Ÿè®¡æ•°æ®
- è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡

**âŒ ä¸é€‚åˆå¼‚æ­¥çš„åœºæ™¯**
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆä¸‹å•ã€æ”¯ä»˜ï¼‰
- éœ€è¦ç«‹å³è¿”å›ç»“æœçš„æ“ä½œ
- å¼ºä¸€è‡´æ€§è¦æ±‚çš„åœºæ™¯

**ğŸ¯ å¼‚æ­¥å¤±è´¥å¤„ç†**
```java
@Async
public void asyncTask() {
    try {
        // å¼‚æ­¥ä¸šåŠ¡
        doSomething();
    } catch (Exception e) {
        // å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
        // 1. é‡è¯•ï¼ˆç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
        sendToRetryQueue(task);
        
        // 2. è¡¥å¿ï¼ˆè®°å½•å¤±è´¥ï¼Œäººå·¥å¤„ç†ï¼‰
        saveFailLog(task, e);
        
        // 3. é€šçŸ¥ï¼ˆå‘Šè­¦ï¼‰
        sendAlert("å¼‚æ­¥ä»»åŠ¡å¤±è´¥", e);
    }
}
```

---

## 8. ğŸ—„ï¸ æ•°æ®åº“åˆ†åº“åˆ†è¡¨


### 8.1 ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨


**ğŸ”¸ æ•°æ®åº“çš„ç“¶é¢ˆ**
```
å•åº“å•è¡¨çš„é—®é¢˜ï¼š
â€¢ æ•°æ®é‡å¤§ï¼š1äº¿æ¡æ•°æ®ï¼ŒæŸ¥è¯¢å¾ˆæ…¢
â€¢ è¿æ¥æ•°æ»¡ï¼š1000ä¸ªè¿æ¥ï¼Œæ–°è¯·æ±‚ç­‰å¾…
â€¢ ç£ç›˜IOé«˜ï¼šè¯»å†™éƒ½åœ¨ä¸€ä¸ªç›˜ï¼Œé€Ÿåº¦æ…¢

åˆ†åº“åˆ†è¡¨åï¼š
â€¢ æ•°æ®åˆ†æ•£ï¼šæ¯ä¸ªåº“1000ä¸‡ï¼ŒæŸ¥è¯¢å¿«
â€¢ è¿æ¥åˆ†æ•£ï¼šæ¯ä¸ªåº“200è¿æ¥ï¼Œå‹åŠ›å°
â€¢ IOåˆ†æ•£ï¼šå¤šä¸ªç£ç›˜ï¼Œå¹¶è¡Œè¯»å†™
```

> ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼šåˆ†è€Œæ²»ä¹‹ï¼ŒåŒ–æ•´ä¸ºé›¶

### 8.2 åˆ†åº“åˆ†è¡¨ç­–ç•¥


**ğŸ”§ åˆ†åº“ç­–ç•¥**
```
åˆ†åº“è·¯ç”±ï¼š
ç”¨æˆ·ID = 1001
   â†“
è®¡ç®—ï¼š1001 % 4 = 1
   â†“
è·¯ç”±åˆ°ï¼šDB_1

ç”¨æˆ·ID = 1002
   â†“
è®¡ç®—ï¼š1002 % 4 = 2
   â†“
è·¯ç”±åˆ°ï¼šDB_2
```

**ğŸ”§ åˆ†è¡¨ç­–ç•¥**
```
è®¢å•è¡¨åˆ†è¡¨ï¼š
è®¢å•æ—¶é—´ï¼š2024-01-15
   â†“
è·¯ç”±åˆ°ï¼šorder_2024_01

è®¢å•æ—¶é—´ï¼š2024-02-20
   â†“
è·¯ç”±åˆ°ï¼šorder_2024_02
```

### 8.3 ä½¿ç”¨ShardingSphereå®ç°


**é…ç½®åˆ†åº“åˆ†è¡¨è§„åˆ™**
```yaml
# application.yml
spring:
  shardingsphere:
    datasource:
      names: db0,db1,db2,db3
      db0:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        jdbc-url: jdbc:mysql://localhost:3306/order_db_0
      db1:
        jdbc-url: jdbc:mysql://localhost:3306/order_db_1
      # ... db2, db3
    
    rules:
      sharding:
        tables:
          t_order:  # è®¢å•è¡¨
            actual-data-nodes: db$->{0..3}.t_order_$->{2024..2025}_$->{01..12}
            
            # åˆ†åº“ç­–ç•¥ï¼šæŒ‰user_idåˆ†åº“
            database-strategy:
              standard:
                sharding-column: user_id
                sharding-algorithm-name: db_mod
            
            # åˆ†è¡¨ç­–ç•¥ï¼šæŒ‰order_timeåˆ†è¡¨ï¼ˆæŒ‰æœˆï¼‰
            table-strategy:
              standard:
                sharding-column: order_time
                sharding-algorithm-name: table_month
        
        sharding-algorithms:
          # åˆ†åº“ç®—æ³•ï¼šå–æ¨¡
          db_mod:
            type: MOD
            props:
              sharding-count: 4
          
          # åˆ†è¡¨ç®—æ³•ï¼šæŒ‰æœˆ
          table_month:
            type: INTERVAL
            props:
              datetime-pattern: yyyy-MM-dd
              datetime-interval-amount: 1
              datetime-interval-unit: MONTHS
```

**ä¸šåŠ¡ä»£ç ä¸å˜**
```java
@Service
public class OrderService {
    
    @Autowired
    private OrderMapper orderMapper;
    
    // ä»£ç ä¸éœ€è¦æ”¹ï¼ŒShardingSphereè‡ªåŠ¨è·¯ç”±
    public void createOrder(Order order) {
        // è‡ªåŠ¨è·¯ç”±åˆ°æ­£ç¡®çš„åº“å’Œè¡¨
        orderMapper.insert(order);
    }
    
    public Order getOrder(Long userId, Long orderId) {
        // è‡ªåŠ¨æ‰¾åˆ°æ­£ç¡®çš„åº“å’Œè¡¨
        return orderMapper.selectByUserIdAndId(userId, orderId);
    }
}
```

### 8.4 åˆ†åº“åˆ†è¡¨æ³¨æ„äº‹é¡¹


**âš ï¸ å¸¸è§é—®é¢˜**

| é—®é¢˜ | **è§£å†³æ–¹æ¡ˆ** |
|-----|------------|
| ğŸ”‘ **åˆ†å¸ƒå¼ID** | `ä½¿ç”¨é›ªèŠ±ç®—æ³•ã€ç¾å›¢Leafç­‰ç”Ÿæˆå…¨å±€å”¯ä¸€ID` |
| ğŸ” **è·¨åº“æŸ¥è¯¢** | `å°½é‡é¿å…ï¼Œå®åœ¨éœ€è¦ç”¨ESç­‰æœç´¢å¼•æ“` |
| ğŸ”„ **åˆ†å¸ƒå¼äº‹åŠ¡** | `ç”¨Seataç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶` |
| ğŸ“Š **ç»Ÿè®¡æŸ¥è¯¢** | `ç”¨å¤§æ•°æ®å¹³å°ï¼ˆHiveã€Sparkï¼‰ç¦»çº¿è®¡ç®—` |
| ğŸ“ˆ **æ•°æ®è¿ç§»** | `åœæœºè¿ç§»æˆ–åŒå†™è¿ç§»` |

> ğŸ’¡ **ç»éªŒ**ï¼šåˆ†åº“åˆ†è¡¨æ˜¯æœ€åæ‰‹æ®µï¼Œèƒ½ä¼˜åŒ–å°±ä¼˜åŒ–ï¼Œèƒ½åŠ ç¼“å­˜å°±åŠ ç¼“å­˜ï¼Œå®åœ¨æ‰›ä¸ä½å†åˆ†

---

## 9. ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—


**ğŸ”¸ æœåŠ¡è€¦åˆçš„é—®é¢˜**
```
åŒæ­¥è°ƒç”¨ï¼ˆç´§è€¦åˆï¼‰ï¼š
è®¢å•æœåŠ¡ â”€â”€ç›´æ¥è°ƒç”¨â”€â”€> åº“å­˜æœåŠ¡
            â†“
        åº“å­˜æœåŠ¡æŒ‚äº†
            â†“
        è®¢å•æœåŠ¡ä¹Ÿä¸å¯ç”¨ Ã—

æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ï¼š
è®¢å•æœåŠ¡ â”€â”€å‘æ¶ˆæ¯â”€â”€> MQ â”€â”€æ¶ˆè´¹â”€â”€> åº“å­˜æœåŠ¡
                     â†“
                MQä¿è¯é€è¾¾
                     â†“
            åº“å­˜æœåŠ¡æŒ‚äº†ä¹Ÿæ²¡å…³ç³»
            è®¢å•æœåŠ¡ç»§ç»­å·¥ä½œ âœ“
```

**ğŸ¯ æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰å¤§ä½œç”¨**
- **è§£è€¦**ï¼šæœåŠ¡ä¹‹é—´ä¸ç›´æ¥è°ƒç”¨
- **å¼‚æ­¥**ï¼šä¸ç­‰å¤„ç†å®Œæˆå°±è¿”å›
- **å‰Šå³°**ï¼šå¹³æ»‘æµé‡é«˜å³°

### 9.2 Dubbo + RocketMQå®ç°è§£è€¦


**åœºæ™¯ï¼šè®¢å•å®Œæˆåçš„åç»­å¤„ç†**
```
è®¢å•å®Œæˆ â†’ éœ€è¦åšçš„äº‹ï¼š
â€¢ æ‰£å‡åº“å­˜
â€¢ å¢åŠ ç§¯åˆ†
â€¢ å‘é€çŸ­ä¿¡
â€¢ æ›´æ–°ç»Ÿè®¡
â€¢ æ¨é€æ¶ˆæ¯

å¦‚æœéƒ½åŒæ­¥è°ƒç”¨ï¼š
- ä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œéƒ½ä¼šå½±å“è®¢å•
- å“åº”æ—¶é—´é•¿ï¼Œç”¨æˆ·ä½“éªŒå·®

ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼š
- è®¢å•å®Œæˆå‘ä¸€æ¡æ¶ˆæ¯
- å„ä¸ªæœåŠ¡è‡ªå·±è®¢é˜…æ¶ˆè´¹
- äº’ä¸å½±å“
```

**ä»£ç å®ç°**
```java
// 1. è®¢å•æœåŠ¡ï¼šå‘é€æ¶ˆæ¯
@DubboService
public class OrderServiceImpl implements OrderService {
    
    @Autowired
    private RocketMQTemplate rocketMQ;
    
    public void completeOrder(Long orderId) {
        // 1. æ›´æ–°è®¢å•çŠ¶æ€
        orderDao.updateStatus(orderId, "COMPLETED");
        
        // 2. å‘é€è®¢å•å®Œæˆæ¶ˆæ¯
        OrderCompletedEvent event = new OrderCompletedEvent(orderId);
        rocketMQ.syncSend("order-completed-topic", event);
        
        // 3. ç«‹å³è¿”å›ï¼Œåç»­å¼‚æ­¥å¤„ç†
    }
}

// 2. åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹æ¶ˆæ¯ï¼Œæ‰£å‡åº“å­˜
@Component
@RocketMQMessageListener(
    topic = "order-completed-topic",
    consumerGroup = "inventory-consumer"
)
public class InventoryConsumer implements RocketMQListener<OrderCompletedEvent> {
    
    @Override
    public void onMessage(OrderCompletedEvent event) {
        // æ‰£å‡åº“å­˜
        inventoryService.deduct(event.getOrderId());
    }
}

// 3. ç§¯åˆ†æœåŠ¡ï¼šæ¶ˆè´¹æ¶ˆæ¯ï¼Œå¢åŠ ç§¯åˆ†
@Component
@RocketMQMessageListener(
    topic = "order-completed-topic",
    consumerGroup = "point-consumer"
)
public class PointConsumer implements RocketMQListener<OrderCompletedEvent> {
    
    @Override
    public void onMessage(OrderCompletedEvent event) {
        // å¢åŠ ç§¯åˆ†
        pointService.addPoint(event.getUserId(), event.getAmount());
    }
}

// 4. çŸ­ä¿¡æœåŠ¡ï¼šæ¶ˆè´¹æ¶ˆæ¯ï¼Œå‘é€é€šçŸ¥
@Component
@RocketMQMessageListener(
    topic = "order-completed-topic",
    consumerGroup = "sms-consumer"
)
public class SmsConsumer implements RocketMQListener<OrderCompletedEvent> {
    
    @Override
    public void onMessage(OrderCompletedEvent event) {
        // å‘é€çŸ­ä¿¡
        smsService.send(event.getUserId(), "è®¢å•å·²å®Œæˆ");
    }
}
```

### 9.3 æ¶ˆæ¯å¯é æ€§ä¿è¯


**ğŸ”¸ ä¸‰ä¸ªå…³é”®é—®é¢˜**

**é—®é¢˜1ï¼šæ¶ˆæ¯ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ**
```java
// è§£å†³ï¼šæ¶ˆæ¯æŒä¹…åŒ– + å‘é€ç¡®è®¤
rocketMQ.syncSend("topic", message, 3000);  // åŒæ­¥å‘é€ï¼Œç­‰å¾…ç¡®è®¤

// RocketMQé…ç½®
broker.conf:
  flushDiskType = SYNC_FLUSH  # åŒæ­¥åˆ·ç›˜ï¼Œä¸ä¸¢æ¶ˆæ¯
```

**é—®é¢˜2ï¼šæ¶ˆæ¯é‡å¤æ€ä¹ˆåŠï¼Ÿ**
```java
// è§£å†³ï¼šæ¶ˆè´¹å¹‚ç­‰æ€§
@Component
public class OrderConsumer implements RocketMQListener<OrderMessage> {
    
    @Override
    public void onMessage(OrderMessage msg) {
        String msgId = msg.getMsgId();
        
        // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†ï¼ˆç”¨Redisè®°å½•ï¼‰
        if (redis.exists("msg:processed:" + msgId)) {
            return;  // å·²å¤„ç†ï¼Œç›´æ¥è¿”å›
        }
        
        // å¤„ç†ä¸šåŠ¡
        processOrder(msg);
        
        // è®°å½•å·²å¤„ç†
        redis.set("msg:processed:" + msgId, "1", 24 * 3600);
    }
}
```

**é—®é¢˜3ï¼šæ¶ˆæ¯é¡ºåºæ€ä¹ˆä¿è¯ï¼Ÿ**
```java
// è§£å†³ï¼šé¡ºåºæ¶ˆæ¯ï¼ˆç›¸åŒkeyè·¯ç”±åˆ°åŒä¸€é˜Ÿåˆ—ï¼‰
// å‘é€æ—¶æŒ‡å®škey
rocketMQ.syncSendOrderly(
    "topic", 
    message, 
    orderId.toString(),  // ç›¸åŒè®¢å•çš„æ¶ˆæ¯é¡ºåºæ¶ˆè´¹
    3000
);
```

### 9.4 æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹


| MQ | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|----|---------|---------|------------|
| ğŸš€ **RocketMQ** | `é«˜æ€§èƒ½ï¼ŒåŠŸèƒ½å…¨ï¼Œé¡ºåºæ¶ˆæ¯` | `è¿ç»´å¤æ‚` | `è®¢å•ã€æ”¯ä»˜ç­‰æ ¸å¿ƒä¸šåŠ¡` |
| ğŸ° **RabbitMQ** | `çµæ´»ï¼Œè·¯ç”±ä¸°å¯Œï¼Œæ˜“ç”¨` | `æ€§èƒ½ä¸€èˆ¬` | `ä¸­å°è§„æ¨¡ï¼Œçµæ´»è·¯ç”±åœºæ™¯` |
| âš¡ **Kafka** | `è¶…é«˜ååï¼Œé€‚åˆæ—¥å¿—` | `ä¸ä¿è¯ä¸¥æ ¼é¡ºåº` | `æ—¥å¿—æ”¶é›†ï¼Œå¤§æ•°æ®åœºæ™¯` |

> ğŸ’¡ **å®æˆ˜é€‰æ‹©**ï¼šDubboå¾®æœåŠ¡æ¨èç”¨**RocketMQ**ï¼Œé˜¿é‡Œå‡ºå“ï¼Œé…åˆé»˜å¥‘

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 é«˜å¹¶å‘åº”å¯¹ç­–ç•¥


```
â”Œâ”€ é«˜å¹¶å‘ä¸‰æ¿æ–§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚  1ï¸âƒ£ é™æµï¼šæŒ¡åœ¨é—¨å¤–              â”‚
â”‚     â€¢ ä»¤ç‰Œæ¡¶ç®—æ³•                â”‚
â”‚     â€¢ Sentinelé™æµ              â”‚
â”‚                                â”‚
â”‚  2ï¸âƒ£ é™çº§ï¼šä¿å‘½è¦ç´§              â”‚
â”‚     â€¢ ç†”æ–­ä¿æŠ¤                  â”‚
â”‚     â€¢ æœåŠ¡é™çº§                  â”‚
â”‚                                â”‚
â”‚  3ï¸âƒ£ ç¼“å­˜ï¼šå‡å°‘å‹åŠ›              â”‚
â”‚     â€¢ Redisç¼“å­˜                â”‚
â”‚     â€¢ å¸ƒéš†è¿‡æ»¤å™¨                â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç§’æ€ç³»ç»Ÿæ¶æ„è¦ç‚¹


**ğŸ¯ äº”å±‚é˜²æŠ¤**
```
ç¬¬ä¸€å±‚ï¼šCDN + é™æ€èµ„æº
    â†“ 90%æµé‡è¢«æ‹¦æˆª
ç¬¬äºŒå±‚ï¼šNginxé™æµ + é˜²åˆ·
    â†“ 5%æµé‡è¢«è¿‡æ»¤
ç¬¬ä¸‰å±‚ï¼šRedisåº“å­˜é¢„å‡
    â†“ 4%æµé‡è¢«æ‹’ç»  
ç¬¬å››å±‚ï¼šæ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°
    â†“ å¼‚æ­¥å¤„ç†
ç¬¬äº”å±‚ï¼šæ•°æ®åº“åˆ†åº“åˆ†è¡¨
    â†“ æœ€ç»ˆè½åº“
```

### 10.3 å…³é”®æŠ€æœ¯å¯¹æ¯”


| æŠ€æœ¯ | **è§£å†³é—®é¢˜** | **æ ¸å¿ƒä»·å€¼** |
|-----|------------|------------|
| ğŸš¦ **é™æµ** | `è¯·æ±‚å¤ªå¤šç³»ç»Ÿæ‰›ä¸ä½` | `ä¿æŠ¤ç³»ç»Ÿä¸è¢«å‹å®` |
| ğŸ”Œ **ç†”æ–­** | `ä¸‹æ¸¸æ•…éšœå½±å“ä¸Šæ¸¸` | `é¿å…é›ªå´©ï¼Œå¿«é€Ÿå¤±è´¥` |
| ğŸ›¡ï¸ **ç¼“å­˜ç©¿é€é˜²æŠ¤** | `æ¶æ„è¯·æ±‚æ‰“å®æ•°æ®åº“` | `å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆªæ— æ•ˆè¯·æ±‚` |
| ğŸŒŠ **å‰Šå³°** | `ç¬æ—¶æµé‡å¤ªå¤§` | `æ¶ˆæ¯é˜Ÿåˆ—å¹³æ»‘æµé‡` |
| âš¡ **å¼‚æ­¥** | `åŒæ­¥ç­‰å¾…æ—¶é—´é•¿` | `æå‡å“åº”é€Ÿåº¦å’Œååé‡` |
| ğŸ—„ï¸ **åˆ†åº“åˆ†è¡¨** | `å•åº“å•è¡¨æ€§èƒ½ç“¶é¢ˆ` | `æ°´å¹³æ‰©å±•ï¼Œåˆ†æ•£å‹åŠ›` |
| ğŸ“¨ **æ¶ˆæ¯é˜Ÿåˆ—** | `æœåŠ¡è€¦åˆåº¦é«˜` | `è§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°` |

### 10.4 å®æˆ˜ç»éªŒæ€»ç»“


**âœ… å¿…é¡»æŒæ¡**
- é™æµæ˜¯ç¬¬ä¸€é“é˜²çº¿ï¼Œç”¨Sentinel
- ç¼“å­˜æ˜¯æ€§èƒ½å…³é”®ï¼ŒRedisé›†ç¾¤
- å¼‚æ­¥æ˜¯ååä¿éšœï¼Œæ¶ˆæ¯é˜Ÿåˆ—
- é™çº§æ˜¯æœ€åä¿é™©ï¼Œå¿«é€Ÿå¤±è´¥

**âš ï¸ å¸¸è§è¯¯åŒº**
- âŒ æ‰€æœ‰æœåŠ¡éƒ½åŠ é™æµï¼ˆåº”è¯¥åªåŠ æ ¸å¿ƒæ¥å£ï¼‰
- âŒ ç¼“å­˜è®¾ç½®æ°¸ä¸è¿‡æœŸï¼ˆåº”è¯¥æœ‰è¿‡æœŸæ—¶é—´ï¼‰
- âŒ æ¶ˆæ¯é˜Ÿåˆ—ç”¨åŒæ­¥å‘é€ï¼ˆåº”è¯¥å¼‚æ­¥å‘é€ï¼‰
- âŒ åˆ†åº“åˆ†è¡¨è¿‡æ—©ä¼˜åŒ–ï¼ˆå…ˆä¼˜åŒ–å†åˆ†åº“ï¼‰

**ğŸ¯ æ¶æ„åŸåˆ™**
```
é«˜å¯ç”¨ > é«˜æ€§èƒ½ > ä½æˆæœ¬

ä¼˜å…ˆçº§ï¼š
1. ä¿è¯ç³»ç»Ÿä¸æŒ‚ï¼ˆé™æµã€é™çº§ï¼‰
2. æå‡ç”¨æˆ·ä½“éªŒï¼ˆç¼“å­˜ã€å¼‚æ­¥ï¼‰
3. é™ä½è¿ç»´æˆæœ¬ï¼ˆç›‘æ§ã€è‡ªåŠ¨åŒ–ï¼‰
```

> ğŸ’¡ **ä¸€å¥è¯æ€»ç»“**ï¼šé«˜å¹¶å‘ä¸å¯æ€•ï¼Œå…³é”®æ˜¯æå‰å‡†å¤‡å¥½å„ç§åº”å¯¹ç­–ç•¥ï¼Œé™æµæŒ¡åœ¨å‰ï¼Œç¼“å­˜åŠ é€Ÿä¸­ï¼Œå¼‚æ­¥å‰Šå³°åï¼Œé™çº§ä¿åº•çº¿ï¼

---

## ğŸ“š å»¶ä¼¸å­¦ä¹ 


**ğŸ”— æ¨èé˜…è¯»**
- ğŸ“˜ ã€Šäº¿çº§æµé‡ç½‘ç«™æ¶æ„æ ¸å¿ƒæŠ€æœ¯ã€‹
- ğŸ“˜ ã€Šé«˜å¯ç”¨æ¶æ„ï¼šç³»ç»Ÿä¸å®•æœºçš„Nç§å§¿åŠ¿ã€‹
- ğŸ“„ é˜¿é‡Œå·´å·´ã€ŠåŒ11æŠ€æœ¯æ­ç§˜ã€‹ç³»åˆ—æ–‡ç« 

**ğŸ”§ å®æˆ˜é¡¹ç›®**
- æ­å»ºä¸€ä¸ªç®€å•çš„ç§’æ€ç³»ç»Ÿ
- ç”¨JMeterå‹æµ‹éªŒè¯é™æµæ•ˆæœ
- å®ç°åŸºäºRedisçš„åˆ†å¸ƒå¼é™æµ

**ğŸ¯ å­¦ä¹ è·¯å¾„**
```
åŸºç¡€ â†’ æŒæ¡DubboåŸºæœ¬ç”¨æ³•
è¿›é˜¶ â†’ ç†è§£é™æµã€ç†”æ–­åŸç†
å®æˆ˜ â†’ æ­å»ºé«˜å¹¶å‘ç§’æ€ç³»ç»Ÿ
ä¼˜åŒ– â†’ æ€§èƒ½è°ƒä¼˜ã€æ¶æ„æ¼”è¿›
```