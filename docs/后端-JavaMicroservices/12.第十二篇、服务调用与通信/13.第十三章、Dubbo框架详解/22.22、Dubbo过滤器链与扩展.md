---
title: 22ã€Dubboè¿‡æ»¤å™¨é“¾ä¸æ‰©å±•
---
## ğŸ“š ç›®å½•

1. [è¿‡æ»¤å™¨æ˜¯ä»€ä¹ˆ](#1-è¿‡æ»¤å™¨æ˜¯ä»€ä¹ˆ)
2. [è¿‡æ»¤å™¨é“¾æœºåˆ¶è¯¦è§£](#2-è¿‡æ»¤å™¨é“¾æœºåˆ¶è¯¦è§£)
3. [Dubboå†…ç½®è¿‡æ»¤å™¨](#3-Dubboå†…ç½®è¿‡æ»¤å™¨)
4. [è‡ªå®šä¹‰è¿‡æ»¤å™¨å¼€å‘](#4-è‡ªå®šä¹‰è¿‡æ»¤å™¨å¼€å‘)
5. [è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºæ§åˆ¶](#5-è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºæ§åˆ¶)
6. [è¯·æ±‚æ‹¦æˆªä¸å“åº”å¤„ç†](#6-è¯·æ±‚æ‹¦æˆªä¸å“åº”å¤„ç†)
7. [å®æˆ˜åº”ç”¨åœºæ™¯](#7-å®æˆ˜åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¿‡æ»¤å™¨æ˜¯ä»€ä¹ˆ


### 1.1 ç”Ÿæ´»ä¸­çš„è¿‡æ»¤å™¨


> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šè¿‡æ»¤å™¨å°±åƒå®‰æ£€é€šé“
> 
> - ä½ å»æœºåœºåé£æœº â†’ å¿…é¡»ç»è¿‡å®‰æ£€ï¼ˆæ£€æŸ¥å±é™©å“ï¼‰
> - RPCè°ƒç”¨ â†’ å¿…é¡»ç»è¿‡è¿‡æ»¤å™¨ï¼ˆæ£€æŸ¥ã€è®°å½•ã€å¤„ç†è¯·æ±‚ï¼‰

**è¿‡æ»¤å™¨çš„æœ¬è´¨**ï¼š
```
æ­£å¸¸è°ƒç”¨æµç¨‹ï¼š
æ¶ˆè´¹è€… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> æä¾›è€…
         ç›´æ¥è°ƒç”¨

æœ‰è¿‡æ»¤å™¨çš„æµç¨‹ï¼š
æ¶ˆè´¹è€… â”€â”€â†’ [è¿‡æ»¤å™¨1] â”€â”€â†’ [è¿‡æ»¤å™¨2] â”€â”€â†’ æä¾›è€…
         æ£€æŸ¥æƒé™    è®°å½•æ—¥å¿—
```

### 1.2 è¿‡æ»¤å™¨åœ¨Dubboä¸­çš„ä½œç”¨


**æ ¸å¿ƒåŠŸèƒ½**ï¼šåœ¨RPCè°ƒç”¨å‰ååšé¢å¤–å¤„ç†

| ä½¿ç”¨åœºæ™¯ | **ä½œç”¨è¯´æ˜** | **ç±»æ¯”ç†è§£** |
|---------|------------|------------|
| ğŸ” **æƒé™æ ¡éªŒ** | `æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦æœ‰æƒé™` | `é—¨ç¦å¡éªŒè¯` |
| ğŸ“Š **æ€§èƒ½ç›‘æ§** | `è®°å½•è°ƒç”¨è€—æ—¶ã€æˆåŠŸç‡` | `ä½“æ£€è®°å½•è¡¨` |
| ğŸ“ **æ—¥å¿—è®°å½•** | `è®°å½•è¯·æ±‚å‚æ•°å’Œç»“æœ` | `ç›‘æ§æ‘„åƒå¤´` |
| âš¡ **ç¼“å­˜å¤„ç†** | `ç¼“å­˜å¸¸ç”¨æ•°æ®é¿å…é‡å¤è°ƒç”¨` | `å¿«é€’ä»£æ”¶ç‚¹` |
| ğŸ›¡ï¸ **å¼‚å¸¸å¤„ç†** | `ç»Ÿä¸€å¤„ç†è°ƒç”¨å¤±è´¥` | `åº”æ€¥é¢„æ¡ˆ` |

### 1.3 è¿‡æ»¤å™¨çš„ä¸¤ç§ç±»å‹


```
è°ƒç”¨é“¾è·¯å›¾ï¼š
                    
æ¶ˆè´¹è€…ç«¯                           æä¾›è€…ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨A   â”‚                      â”‚ åº”ç”¨B   â”‚
â”‚         â”‚                      â”‚         â”‚
â”‚ [æ¶ˆè´¹è€… â”‚ â”€â”€â”€â”€â”€â”€ ç½‘ç»œ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ æä¾›è€…] â”‚
â”‚  è¿‡æ»¤å™¨]â”‚                      â”‚ [è¿‡æ»¤å™¨]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                                 â†“
  å‘é€å‰å¤„ç†                        æ¥æ”¶åå¤„ç†
```

**â‘  æ¶ˆè´¹è€…ç«¯è¿‡æ»¤å™¨**ï¼š
- åœ¨**å‘èµ·è°ƒç”¨å‰**æ‰§è¡Œ
- ä¾‹å¦‚ï¼šå‚æ•°éªŒè¯ã€è¯·æ±‚åŠ å¯†ã€è´Ÿè½½ç»Ÿè®¡

**â‘¡ æä¾›è€…ç«¯è¿‡æ»¤å™¨**ï¼š
- åœ¨**å¤„ç†è¯·æ±‚å‰**æ‰§è¡Œ
- ä¾‹å¦‚ï¼šæƒé™éªŒè¯ã€è§£å¯†ã€æ‰§è¡Œæ—¥å¿—

---

## 2. âš™ï¸ è¿‡æ»¤å™¨é“¾æœºåˆ¶è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨é“¾


> ğŸ”— **è´£ä»»é“¾æ¨¡å¼**ï¼šå¤šä¸ªè¿‡æ»¤å™¨æŒ‰é¡ºåºä¸²è”æ‰§è¡Œ

**æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
è¯·æ±‚æµç¨‹ï¼š
å®¢æˆ·ç«¯è¯·æ±‚
   â”‚
   â†“
[è¿‡æ»¤å™¨A] â”€â”€â”€â”€â”€â†’ å‚æ•°æ£€æŸ¥
   â”‚
   â†“
[è¿‡æ»¤å™¨B] â”€â”€â”€â”€â”€â†’ æ—¥å¿—è®°å½•
   â”‚
   â†“
[è¿‡æ»¤å™¨C] â”€â”€â”€â”€â”€â†’ æ€§èƒ½ç»Ÿè®¡
   â”‚
   â†“
çœŸæ­£çš„æœåŠ¡æ–¹æ³•
   â”‚
   â†“
[è¿‡æ»¤å™¨C] â†â”€â”€â”€â”€ å“åº”å¤„ç†
   â”‚
   â†“
[è¿‡æ»¤å™¨B] â†â”€â”€â”€â”€ è®°å½•ç»“æœ
   â”‚
   â†“
[è¿‡æ»¤å™¨A] â†â”€â”€â”€â”€ æ¸…ç†èµ„æº
   â”‚
   â†“
è¿”å›ç»™å®¢æˆ·ç«¯
```

### 2.2 è¿‡æ»¤å™¨é“¾çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ Invokerï¼ˆè°ƒç”¨è€…ï¼‰**ï¼š
- **å«ä¹‰**ï¼šä»£è¡¨ä¸€ä¸ªå¯æ‰§è¡Œçš„æœåŠ¡
- **ç†è§£**ï¼šå°±åƒä¸€ä¸ª"æœåŠ¡ä»£ç†äºº"ï¼Œè´Ÿè´£æ‰§è¡ŒçœŸæ­£çš„æ–¹æ³•

**ğŸ”¸ Invocationï¼ˆè°ƒç”¨ä¿¡æ¯ï¼‰**ï¼š
- **å«ä¹‰**ï¼šåŒ…å«æœ¬æ¬¡è°ƒç”¨çš„æ‰€æœ‰ä¿¡æ¯
- **åŒ…æ‹¬**ï¼šæ–¹æ³•åã€å‚æ•°ã€é™„åŠ ä¿¡æ¯ç­‰

**ğŸ”¸ Resultï¼ˆè°ƒç”¨ç»“æœï¼‰**ï¼š
- **å«ä¹‰**ï¼šæ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼
- **åŒ…æ‹¬**ï¼šè¿”å›æ•°æ®æˆ–å¼‚å¸¸ä¿¡æ¯

**å…³ç³»å›¾ç¤º**ï¼š
```
                Invocation
                (è°ƒç”¨ä¿¡æ¯)
                    â”‚
                    â†“
Filter â”€â”€â”€â”€â”€â”€> Invoker â”€â”€â”€â”€â”€â”€> Result
(è¿‡æ»¤å™¨)       (æ‰§è¡Œè€…)        (ç»“æœ)
```

### 2.3 è¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œæœºåˆ¶


**â‘  é“¾å¼è°ƒç”¨åŸç†**ï¼š
```
ä¼ªä»£ç æ¼”ç¤ºï¼š

Filter1.invoke(invoker, invocation) {
    // å‰ç½®å¤„ç†
    System.out.println("Filter1 å¼€å§‹");
    
    // è°ƒç”¨ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨
    Result result = invoker.invoke(invocation);
    
    // åç½®å¤„ç†
    System.out.println("Filter1 ç»“æŸ");
    return result;
}

Filter2.invoke(invoker, invocation) {
    System.out.println("Filter2 å¼€å§‹");
    Result result = invoker.invoke(invocation);
    System.out.println("Filter2 ç»“æŸ");
    return result;
}

æ‰§è¡Œé¡ºåºï¼š
Filter1 å¼€å§‹
  Filter2 å¼€å§‹
    çœŸæ­£çš„æ–¹æ³•æ‰§è¡Œ
  Filter2 ç»“æŸ
Filter1 ç»“æŸ
```

**â‘¡ æ´‹è‘±æ¨¡å‹**ï¼š
```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Filter 1         â”‚  â† æœ€å¤–å±‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚   Filter 2    â”‚  â”‚  â† ä¸­é—´å±‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
        â”‚  â”‚  â”‚ æ ¸å¿ƒæ–¹æ³• â”‚  â”‚  â”‚  â† æœ€å†…å±‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯·æ±‚ï¼šä»å¤–åˆ°å†…ç©¿è¿‡
å“åº”ï¼šä»å†…åˆ°å¤–è¿”å›
```

---

## 3. ğŸ“¦ Dubboå†…ç½®è¿‡æ»¤å™¨


### 3.1 å¸¸ç”¨å†…ç½®è¿‡æ»¤å™¨åˆ—è¡¨


| è¿‡æ»¤å™¨åç§° | **ä½œç”¨** | **é»˜è®¤å¯ç”¨** | **é€‚ç”¨ç«¯** |
|-----------|---------|------------|----------|
| `ConsumerContextFilter` | `è®¾ç½®æ¶ˆè´¹è€…ä¸Šä¸‹æ–‡ä¿¡æ¯` | âœ… | æ¶ˆè´¹è€… |
| `AccessLogFilter` | `è®¿é—®æ—¥å¿—è®°å½•` | âŒ | æä¾›è€… |
| `ExecuteLimitFilter` | `é™åˆ¶å¹¶å‘æ‰§è¡Œæ•°` | âŒ | æä¾›è€… |
| `TimeoutFilter` | `è¶…æ—¶å¤„ç†` | âœ… | æ¶ˆè´¹è€… |
| `MonitorFilter` | `ç›‘æ§ç»Ÿè®¡` | âœ… | åŒç«¯ |
| `ExceptionFilter` | `å¼‚å¸¸å¤„ç†` | âœ… | æä¾›è€… |
| `TokenFilter` | `ä»¤ç‰ŒéªŒè¯` | âŒ | æä¾›è€… |

### 3.2 æ ¸å¿ƒè¿‡æ»¤å™¨è¯¦è§£


**ğŸ”¸ ConsumerContextFilterï¼ˆæ¶ˆè´¹è€…ä¸Šä¸‹æ–‡ï¼‰**ï¼š

**ä½œç”¨**ï¼šåœ¨æ¶ˆè´¹è€…ç«¯è®¾ç½®RPCè°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

```java
// è‡ªåŠ¨è®¾ç½®çš„ä¿¡æ¯ï¼š
- è¿œç¨‹åœ°å€
- æœ¬åœ°åœ°å€  
- æ¥å£åç§°
- æ–¹æ³•åç§°
- å‚æ•°ç±»å‹

// ä½¿ç”¨åœºæ™¯ï¼š
åœ¨è°ƒç”¨é“¾è·¯ä¸­ä¼ é€’ç”¨æˆ·ä¿¡æ¯ã€é“¾è·¯IDç­‰
```

**å®é™…æ•ˆæœ**ï¼š
```
è°ƒç”¨å‰ï¼š
RpcContext.getContext().setAttachment("userId", "12345");

æœåŠ¡ç«¯å¯ä»¥è·å–ï¼š
String userId = RpcContext.getContext().getAttachment("userId");
```

**ğŸ”¸ AccessLogFilterï¼ˆè®¿é—®æ—¥å¿—ï¼‰**ï¼š

**ä½œç”¨**ï¼šè®°å½•æ¯æ¬¡RPCè°ƒç”¨çš„è¯¦ç»†æ—¥å¿—

é…ç½®æ–¹å¼ï¼š
```xml
<!-- åœ¨æœåŠ¡æä¾›è€…é…ç½® -->
<dubbo:service interface="com.example.UserService" 
               accesslog="true"/>

<!-- æˆ–æŒ‡å®šæ—¥å¿—æ–‡ä»¶ -->
<dubbo:service interface="com.example.UserService" 
               accesslog="/var/log/dubbo-access.log"/>
```

æ—¥å¿—æ ¼å¼ç¤ºä¾‹ï¼š
```
[2025-09-23 10:30:15] 192.168.1.100:20880 -> 
com.example.UserService.getUser(123) 
elapsed: 45ms result: User[id=123]
```

**ğŸ”¸ ExecuteLimitFilterï¼ˆæ‰§è¡Œé™æµï¼‰**ï¼š

**ä½œç”¨**ï¼šé™åˆ¶æä¾›è€…ç«¯åŒæ—¶æ‰§è¡Œçš„è¯·æ±‚æ•°

```xml
<!-- æœ€å¤šåŒæ—¶å¤„ç†10ä¸ªè¯·æ±‚ -->
<dubbo:service interface="com.example.UserService" 
               executes="10"/>
```

**å·¥ä½œåŸç†**ï¼š
```
å½“å‰æ‰§è¡Œæ•°ï¼š8ä¸ª

æ–°è¯·æ±‚æ¥äº†ï¼š
  â”œâ”€ 9 < 10 â†’ å…è®¸æ‰§è¡Œ
  â””â”€ 10 = 10 â†’ å…è®¸æ‰§è¡Œ
  
å†æ¥ä¸€ä¸ªè¯·æ±‚ï¼š
  â””â”€ 11 > 10 â†’ æ‹’ç»æ‰§è¡Œï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰
```

**ğŸ”¸ MonitorFilterï¼ˆç›‘æ§ç»Ÿè®¡ï¼‰**ï¼š

**ä½œç”¨**ï¼šè‡ªåŠ¨æ”¶é›†è°ƒç”¨ç»Ÿè®¡æ•°æ®

**æ”¶é›†çš„æŒ‡æ ‡**ï¼š
- â‘  è°ƒç”¨æ¬¡æ•°
- â‘¡ æˆåŠŸæ¬¡æ•°
- â‘¢ å¤±è´¥æ¬¡æ•°
- â‘£ å¹³å‡è€—æ—¶
- â‘¤ æœ€å¤§è€—æ—¶

```java
// è‡ªåŠ¨ç»Ÿè®¡ï¼Œæ— éœ€ä»£ç 
// æ•°æ®ä¼šå‘é€åˆ°ç›‘æ§ä¸­å¿ƒï¼ˆå¦‚æœé…ç½®äº†ï¼‰
```

**ğŸ”¸ ExceptionFilterï¼ˆå¼‚å¸¸å¤„ç†ï¼‰**ï¼š

**ä½œç”¨**ï¼šç»Ÿä¸€å¤„ç†æœåŠ¡ç«¯å¼‚å¸¸

**å¤„ç†è§„åˆ™**ï¼š
```
å¼‚å¸¸ç±»å‹åˆ¤æ–­ï¼š
  â”œâ”€ ä¸šåŠ¡å¼‚å¸¸ï¼ˆcheckedï¼‰ â†’ ç›´æ¥è¿”å›
  â”œâ”€ RuntimeException â†’ æ£€æŸ¥æ˜¯å¦åœ¨æ¥å£å£°æ˜ä¸­
  â”‚                     â””â”€ æ˜¯ â†’ è¿”å›
  â”‚                     â””â”€ å¦ â†’ åŒ…è£…æˆRuntimeException
  â””â”€ Error â†’ ç›´æ¥æŠ›å‡º
```

å®é™…æ•ˆæœï¼š
```java
// æœåŠ¡ç«¯æŠ›å‡ºçš„å¼‚å¸¸
public User getUser(Long id) {
    if (id == null) {
        throw new IllegalArgumentException("IDä¸èƒ½ä¸ºç©º");
    }
    // ...
}

// æ¶ˆè´¹è€…ç«¯æ¥æ”¶åˆ°çš„
try {
    user = userService.getUser(null);
} catch (IllegalArgumentException e) {
    // èƒ½æ­£ç¡®æ•è·å¼‚å¸¸
    System.out.println(e.getMessage()); // "IDä¸èƒ½ä¸ºç©º"
}
```

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰è¿‡æ»¤å™¨å¼€å‘


### 4.1 å¼€å‘æ­¥éª¤æ€»è§ˆ


**å®Œæ•´å¼€å‘æµç¨‹**ï¼š
```
æ­¥éª¤1ï¼šå®ç°Filteræ¥å£
   â†“
æ­¥éª¤2ï¼šç¼–å†™è¿‡æ»¤é€»è¾‘
   â†“
æ­¥éª¤3ï¼šæ·»åŠ @Activateæ³¨è§£
   â†“
æ­¥éª¤4ï¼šé…ç½®SPIæ–‡ä»¶
   â†“
æ­¥éª¤5ï¼šåœ¨é¡¹ç›®ä¸­å¯ç”¨
```

### 4.2 å®ç°Filteræ¥å£


**åŸºç¡€ç»“æ„**ï¼š
```java
import org.apache.dubbo.rpc.*;

@Activate(group = {CommonConstants.PROVIDER})
public class MyCustomFilter implements Filter {
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) 
        throws RpcException {
        
        // 1. å‰ç½®å¤„ç†ï¼ˆè¯·æ±‚åˆ°è¾¾æ—¶ï¼‰
        long startTime = System.currentTimeMillis();
        
        try {
            // 2. è°ƒç”¨ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–çœŸæ­£çš„æ–¹æ³•
            Result result = invoker.invoke(invocation);
            
            // 3. åç½®å¤„ç†ï¼ˆå¾—åˆ°ç»“æœåï¼‰
            long cost = System.currentTimeMillis() - startTime;
            System.out.println("è°ƒç”¨è€—æ—¶ï¼š" + cost + "ms");
            
            return result;
            
        } catch (Exception e) {
            // 4. å¼‚å¸¸å¤„ç†
            System.err.println("è°ƒç”¨å‡ºé”™ï¼š" + e.getMessage());
            throw e;
        }
    }
}
```

**æ ¸å¿ƒæ–¹æ³•å‚æ•°**ï¼š
- `Invoker<?> invoker`ï¼šä¸‹ä¸€ä¸ªè°ƒç”¨èŠ‚ç‚¹
- `Invocation invocation`ï¼šæœ¬æ¬¡è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯

### 4.3 å®æˆ˜æ¡ˆä¾‹ï¼šè¯·æ±‚æ—¥å¿—è¿‡æ»¤å™¨


**éœ€æ±‚**ï¼šè®°å½•æ¯æ¬¡è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯

```java
@Activate(group = {CommonConstants.PROVIDER}, order = -1000)
public class RequestLogFilter implements Filter {
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        // è·å–è°ƒç”¨ä¿¡æ¯
        String methodName = invocation.getMethodName();
        Object[] args = invocation.getArguments();
        
        // è®°å½•è¯·æ±‚
        System.out.println("===== è¯·æ±‚å¼€å§‹ =====");
        System.out.println("æ¥å£ï¼š" + invoker.getInterface().getName());
        System.out.println("æ–¹æ³•ï¼š" + methodName);
        System.out.println("å‚æ•°ï¼š" + Arrays.toString(args));
        
        long start = System.currentTimeMillis();
        
        try {
            // æ‰§è¡ŒçœŸæ­£çš„è°ƒç”¨
            Result result = invoker.invoke(invocation);
            
            // è®°å½•å“åº”
            long cost = System.currentTimeMillis() - start;
            System.out.println("ç»“æœï¼š" + result.getValue());
            System.out.println("è€—æ—¶ï¼š" + cost + "ms");
            System.out.println("===== è¯·æ±‚ç»“æŸ =====");
            
            return result;
            
        } catch (Exception e) {
            System.err.println("è°ƒç”¨å¤±è´¥ï¼š" + e.getMessage());
            throw e;
        }
    }
}
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
===== è¯·æ±‚å¼€å§‹ =====
æ¥å£ï¼šcom.example.UserService
æ–¹æ³•ï¼šgetUser
å‚æ•°ï¼š[123]
ç»“æœï¼šUser[id=123, name=å¼ ä¸‰]
è€—æ—¶ï¼š35ms
===== è¯·æ±‚ç»“æŸ =====
```

### 4.4 SPIé…ç½®æ–‡ä»¶


**é…ç½®æ­¥éª¤**ï¼š

â‘  åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ–‡ä»¶ï¼š
```
src/main/resources/
  â””â”€â”€ META-INF/
      â””â”€â”€ dubbo/
          â””â”€â”€ org.apache.dubbo.rpc.Filter
```

â‘¡ æ–‡ä»¶å†…å®¹ï¼š
```properties
# æ ¼å¼ï¼šè¿‡æ»¤å™¨åç§°=è¿‡æ»¤å™¨å®Œæ•´ç±»å
requestLog=com.example.filter.RequestLogFilter
```

### 4.5 å¯ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨


**æ–¹å¼ä¸€ï¼šæ³¨è§£å¯ç”¨ï¼ˆæ¨èï¼‰**
```java
@DubboService(filter = "requestLog")
public class UserServiceImpl implements UserService {
    // ...
}
```

**æ–¹å¼äºŒï¼šXMLé…ç½®å¯ç”¨**
```xml
<dubbo:service interface="com.example.UserService" 
               filter="requestLog"/>
```

**æ–¹å¼ä¸‰ï¼šå¯ç”¨å¤šä¸ªè¿‡æ»¤å™¨**
```java
@DubboService(filter = "requestLog,myAuth,myCache")
public class UserServiceImpl implements UserService {
    // ...
}
```

---

## 5. ğŸ”¢ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºæ§åˆ¶


### 5.1 æ‰§è¡Œé¡ºåºçš„é‡è¦æ€§


> âš ï¸ **é¡ºåºå¾ˆå…³é”®**ï¼šè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºä¼šå½±å“åŠŸèƒ½

**é”™è¯¯é¡ºåºç¤ºä¾‹**ï¼š
```
é¡ºåº1ï¼šæƒé™éªŒè¯ â†’ æ—¥å¿—è®°å½• âœ…
  â””â”€ å…ˆéªŒè¯æƒé™ï¼Œé€šè¿‡åå†è®°å½•æ—¥å¿—

é¡ºåº2ï¼šæ—¥å¿—è®°å½• â†’ æƒé™éªŒè¯ âŒ
  â””â”€ æ— æƒé™çš„è¯·æ±‚ä¹Ÿä¼šè®°å½•æ—¥å¿—ï¼ˆæµªè´¹ï¼‰
```

### 5.2 ä¸‰ç§é¡ºåºæ§åˆ¶æ–¹å¼


**â‘  ä½¿ç”¨@Activateçš„orderå±æ€§**

```java
@Activate(group = {CommonConstants.PROVIDER}, order = -1000)
public class AuthFilter implements Filter {
    // orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
    // -1000 ä¼šæ¯” 0 å…ˆæ‰§è¡Œ
}

@Activate(group = {CommonConstants.PROVIDER}, order = 0)
public class LogFilter implements Filter {
    // é»˜è®¤orderä¸º0
}
```

**é¡ºåºè§„åˆ™**ï¼š
```
order = -1000  â†’  æœ€å…ˆæ‰§è¡Œ
order = -100
order = 0      â†’  é»˜è®¤å€¼
order = 100
order = 1000   â†’  æœ€åæ‰§è¡Œ
```

**â‘¡ é…ç½®æ—¶æŒ‡å®šé¡ºåº**

```java
// ç”¨é€—å·åˆ†éš”ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ‰§è¡Œ
@DubboService(filter = "auth,log,monitor")
public class UserServiceImpl implements UserService {
    // æ‰§è¡Œé¡ºåºï¼šauth â†’ log â†’ monitor
}
```

**â‘¢ ä½¿ç”¨before/afteræŒ‡å®šç›¸å¯¹ä½ç½®**

```java
@Activate(
    group = {CommonConstants.PROVIDER},
    before = {"exception"},  // åœ¨exceptionè¿‡æ»¤å™¨ä¹‹å‰
    after = {"context"}      // åœ¨contextè¿‡æ»¤å™¨ä¹‹å
)
public class MyFilter implements Filter {
    // ...
}
```

### 5.3 å®Œæ•´æ‰§è¡Œé“¾ç¤ºä¾‹


**é…ç½®å¤šä¸ªè¿‡æ»¤å™¨**ï¼š
```java
@DubboService(filter = "auth,validate,log,cache,monitor")
public class OrderServiceImpl implements OrderService {
    
    public Order createOrder(OrderDTO dto) {
        return new Order();
    }
}
```

**å®é™…æ‰§è¡Œæµç¨‹**ï¼š
```
è¯·æ±‚åˆ°è¾¾
   â”‚
   â†“
â‘  AuthFilter (order=-1000)
   â”‚ æ£€æŸ¥ç”¨æˆ·æƒé™
   â†“
â‘¡ ValidateFilter (order=-500)  
   â”‚ éªŒè¯å‚æ•°æ ¼å¼
   â†“
â‘¢ LogFilter (order=0)
   â”‚ è®°å½•è¯·æ±‚æ—¥å¿—
   â†“
â‘£ CacheFilter (order=500)
   â”‚ æ£€æŸ¥ç¼“å­˜
   â†“
â‘¤ MonitorFilter (order=1000)
   â”‚ æ€§èƒ½ç›‘æ§ç»Ÿè®¡
   â†“
çœŸæ­£çš„ createOrder() æ–¹æ³•
   â”‚
   â†“ (è¿”å›è·¯å¾„ç›¸å)
â‘¤ MonitorFilter
   â”‚ è®°å½•å“åº”æ—¶é—´
   â†“
â‘£ CacheFilter
   â”‚ æ›´æ–°ç¼“å­˜
   â†“
â‘¢ LogFilter
   â”‚ è®°å½•å“åº”ç»“æœ
   â†“
â‘¡ ValidateFilter
   â”‚ éªŒè¯è¿”å›å€¼
   â†“
â‘  AuthFilter
   â”‚ æ¸…ç†æƒé™ä¸Šä¸‹æ–‡
   â†“
è¿”å›ç»™å®¢æˆ·ç«¯
```

---

## 6. ğŸ¯ è¯·æ±‚æ‹¦æˆªä¸å“åº”å¤„ç†


### 6.1 è¯·æ±‚æ‹¦æˆªåœºæ™¯


**ä»€ä¹ˆæ˜¯è¯·æ±‚æ‹¦æˆª**ï¼šåœ¨è¯·æ±‚åˆ°è¾¾çœŸæ­£çš„æœåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œå…ˆåšä¸€äº›æ£€æŸ¥æˆ–å¤„ç†

**å…¸å‹åœºæ™¯**ï¼š
- ğŸ” æƒé™éªŒè¯
- âœ… å‚æ•°æ ¡éªŒ
- ğŸš« IPé»‘ç™½åå•
- ğŸ« TokenéªŒè¯

### 6.2 å®æˆ˜ï¼šæƒé™éªŒè¯è¿‡æ»¤å™¨


```java
@Activate(group = {CommonConstants.PROVIDER}, order = -1000)
public class AuthFilter implements Filter {
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        
        // 1. è·å–é™„åŠ ä¿¡æ¯ä¸­çš„token
        String token = invocation.getAttachment("token");
        
        // 2. éªŒè¯token
        if (token == null || !isValidToken(token)) {
            // éªŒè¯å¤±è´¥ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸ç»§ç»­æ‰§è¡Œ
            return AsyncRpcResult.newDefaultAsyncResult(
                new RuntimeException("æœªæˆæƒï¼šæ— æ•ˆçš„token"), 
                invocation
            );
        }
        
        // 3. éªŒè¯é€šè¿‡ï¼Œç»§ç»­æ‰§è¡Œ
        return invoker.invoke(invocation);
    }
    
    private boolean isValidToken(String token) {
        // å®é™…é¡¹ç›®ä¸­è°ƒç”¨è®¤è¯æœåŠ¡éªŒè¯
        return "valid_token_123".equals(token);
    }
}
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```java
// æ¶ˆè´¹è€…ç«¯è°ƒç”¨æ—¶è®¾ç½®token
RpcContext.getContext().setAttachment("token", "valid_token_123");
User user = userService.getUser(123L);
```

### 6.3 å®æˆ˜ï¼šå‚æ•°æ ¡éªŒè¿‡æ»¤å™¨


```java
@Activate(group = {CommonConstants.PROVIDER})
public class ValidationFilter implements Filter {
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        
        // è·å–æ–¹æ³•å‚æ•°
        Object[] args = invocation.getArguments();
        
        // æ ¡éªŒå‚æ•°
        for (Object arg : args) {
            if (arg == null) {
                return AsyncRpcResult.newDefaultAsyncResult(
                    new IllegalArgumentException("å‚æ•°ä¸èƒ½ä¸ºnull"),
                    invocation
                );
            }
            
            // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºç©º
            if (arg instanceof String && ((String) arg).isEmpty()) {
                return AsyncRpcResult.newDefaultAsyncResult(
                    new IllegalArgumentException("å­—ç¬¦ä¸²å‚æ•°ä¸èƒ½ä¸ºç©º"),
                    invocation
                );
            }
        }
        
        // éªŒè¯é€šè¿‡ï¼Œç»§ç»­æ‰§è¡Œ
        return invoker.invoke(invocation);
    }
}
```

### 6.4 å“åº”åç½®å¤„ç†


**ä»€ä¹ˆæ˜¯å“åº”å¤„ç†**ï¼šåœ¨å¾—åˆ°æ–¹æ³•æ‰§è¡Œç»“æœåï¼Œå¯¹ç»“æœåšè¿›ä¸€æ­¥å¤„ç†

**å…¸å‹åœºæ™¯**ï¼š
- ğŸ“ è®°å½•å“åº”æ—¥å¿—
- ğŸ”„ ç»“æœç¼“å­˜
- ğŸ”’ æ•æ„Ÿä¿¡æ¯è„±æ•
- ğŸ“Š ç»Ÿè®¡å“åº”æ—¶é—´

### 6.5 å®æˆ˜ï¼šæ•°æ®è„±æ•è¿‡æ»¤å™¨


```java
@Activate(group = {CommonConstants.PROVIDER})
public class DesensitizationFilter implements Filter {
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        
        // è°ƒç”¨çœŸæ­£çš„æ–¹æ³•
        Result result = invoker.invoke(invocation);
        
        // å¯¹è¿”å›å€¼è„±æ•
        Object value = result.getValue();
        if (value instanceof User) {
            User user = (User) value;
            // æ‰‹æœºå·è„±æ•ï¼š138****5678
            user.setPhone(desensitizePhone(user.getPhone()));
            // èº«ä»½è¯è„±æ•ï¼š320***********1234
            user.setIdCard(desensitizeIdCard(user.getIdCard()));
        }
        
        return result;
    }
    
    private String desensitizePhone(String phone) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
    
    private String desensitizeIdCard(String idCard) {
        if (idCard == null || idCard.length() != 18) {
            return idCard;
        }
        return idCard.substring(0, 3) + "***********" + idCard.substring(14);
    }
}
```

**æ•ˆæœå¯¹æ¯”**ï¼š
```
åŸå§‹æ•°æ®ï¼š
User{
  phone: "13812345678",
  idCard: "320123199001011234"
}

è„±æ•åï¼š
User{
  phone: "138****5678",
  idCard: "320***********1234"
}
```

---

## 7. ğŸ’¼ å®æˆ˜åº”ç”¨åœºæ™¯


### 7.1 åœºæ™¯ä¸€ï¼šæ¥å£è°ƒç”¨ç›‘æ§ç»Ÿè®¡


**éœ€æ±‚**ï¼šç»Ÿè®¡æ¯ä¸ªæ¥å£çš„è°ƒç”¨æƒ…å†µ

```java
@Activate(group = {CommonConstants.PROVIDER, CommonConstants.CONSUMER})
public class MetricsFilter implements Filter {
    
    // ä½¿ç”¨ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨
    private static final ConcurrentHashMap<String, AtomicLong> metrics = 
        new ConcurrentHashMap<>();
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        String key = invoker.getInterface().getName() + "." + 
                     invocation.getMethodName();
        
        // è°ƒç”¨æ¬¡æ•°+1
        metrics.computeIfAbsent(key, k -> new AtomicLong(0))
               .incrementAndGet();
        
        long start = System.currentTimeMillis();
        
        try {
            Result result = invoker.invoke(invocation);
            
            long cost = System.currentTimeMillis() - start;
            // è®°å½•å“åº”æ—¶é—´
            System.out.println(key + " è€—æ—¶: " + cost + "ms");
            
            return result;
        } catch (Exception e) {
            // è®°å½•å¤±è´¥æ¬¡æ•°
            metrics.computeIfAbsent(key + ".error", k -> new AtomicLong(0))
                   .incrementAndGet();
            throw e;
        }
    }
    
    // æä¾›æŸ¥è¯¢æ¥å£
    public static Map<String, Long> getMetrics() {
        Map<String, Long> result = new HashMap<>();
        metrics.forEach((k, v) -> result.put(k, v.get()));
        return result;
    }
}
```

**æŸ¥çœ‹ç»Ÿè®¡æ•°æ®**ï¼š
```java
// åœ¨ç®¡ç†æ¥å£ä¸­æš´éœ²
Map<String, Long> metrics = MetricsFilter.getMetrics();
// è¾“å‡ºï¼š
// UserService.getUser = 1523æ¬¡
// UserService.getUser.error = 12æ¬¡
// OrderService.createOrder = 856æ¬¡
```

### 7.2 åœºæ™¯äºŒï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª


**éœ€æ±‚**ï¼šè¿½è¸ªä¸€æ¬¡è¯·æ±‚çš„å®Œæ•´è°ƒç”¨é“¾è·¯

```java
@Activate(group = {CommonConstants.CONSUMER}, order = -10000)
public class TraceFilter implements Filter {
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        
        // ç”Ÿæˆæˆ–ä¼ é€’traceId
        String traceId = RpcContext.getContext().getAttachment("traceId");
        if (traceId == null) {
            traceId = UUID.randomUUID().toString();
        }
        
        // ä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡
        RpcContext.getContext().setAttachment("traceId", traceId);
        RpcContext.getContext().setAttachment("spanId", generateSpanId());
        
        System.out.println("[" + traceId + "] è°ƒç”¨ " + 
            invocation.getMethodName());
        
        return invoker.invoke(invocation);
    }
    
    private String generateSpanId() {
        return System.currentTimeMillis() + "-" + 
               Thread.currentThread().getId();
    }
}
```

**è°ƒç”¨é“¾è·¯æ•ˆæœ**ï¼š
```
[trace-123] å‰ç«¯ â†’ AæœåŠ¡ â†’ BæœåŠ¡ â†’ CæœåŠ¡
   â”‚           â”‚        â”‚        â”‚
   â”‚           â”‚        â”‚        â””â”€ [trace-123] CæœåŠ¡å¤„ç†
   â”‚           â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [trace-123] BæœåŠ¡è°ƒç”¨C
   â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [trace-123] AæœåŠ¡è°ƒç”¨B
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [trace-123] å‰ç«¯å‘èµ·è¯·æ±‚
```

### 7.3 åœºæ™¯ä¸‰ï¼šæ™ºèƒ½ç¼“å­˜è¿‡æ»¤å™¨


**éœ€æ±‚**ï¼šç¼“å­˜æŸ¥è¯¢ç»“æœï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›

```java
@Activate(group = {CommonConstants.PROVIDER})
public class CacheFilter implements Filter {
    
    // ç®€å•çš„å†…å­˜ç¼“å­˜ï¼ˆå®é™…é¡¹ç›®ç”¨Redisï¼‰
    private static final Map<String, Object> cache = new ConcurrentHashMap<>();
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        
        // åªç¼“å­˜æŸ¥è¯¢æ–¹æ³•
        String methodName = invocation.getMethodName();
        if (!methodName.startsWith("get") && !methodName.startsWith("query")) {
            return invoker.invoke(invocation);
        }
        
        // ç”Ÿæˆç¼“å­˜key
        String cacheKey = generateCacheKey(invoker, invocation);
        
        // æ£€æŸ¥ç¼“å­˜
        Object cachedResult = cache.get(cacheKey);
        if (cachedResult != null) {
            System.out.println("ç¼“å­˜å‘½ä¸­ï¼š" + cacheKey);
            return AsyncRpcResult.newDefaultAsyncResult(cachedResult, invocation);
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡ŒçœŸæ­£çš„è°ƒç”¨
        Result result = invoker.invoke(invocation);
        
        // å­˜å…¥ç¼“å­˜ï¼ˆ5åˆ†é’Ÿè¿‡æœŸï¼‰
        cache.put(cacheKey, result.getValue());
        scheduleExpire(cacheKey, 5 * 60 * 1000);
        
        return result;
    }
    
    private String generateCacheKey(Invoker<?> invoker, Invocation invocation) {
        return invoker.getInterface().getName() + "." +
               invocation.getMethodName() + ":" +
               Arrays.toString(invocation.getArguments());
    }
    
    private void scheduleExpire(String key, long delay) {
        // å®šæ—¶åˆ é™¤ç¼“å­˜
        new Timer().schedule(new TimerTask() {
            @Override
            public void run() {
                cache.remove(key);
            }
        }, delay);
    }
}
```

**ç¼“å­˜æ•ˆæœ**ï¼š
```
ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šuserService.getUser(123)
  â””â”€ ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“ (è€—æ—¶50ms)
  
ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šuserService.getUser(123)  
  â””â”€ ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å› (è€—æ—¶1ms)
  
5åˆ†é’Ÿåè°ƒç”¨ï¼šuserService.getUser(123)
  â””â”€ ç¼“å­˜è¿‡æœŸï¼Œé‡æ–°æŸ¥è¯¢ (è€—æ—¶50ms)
```

### 7.4 åœºæ™¯å››ï¼šæœåŠ¡é™çº§è¿‡æ»¤å™¨


**éœ€æ±‚**ï¼šå½“æœåŠ¡å‹åŠ›å¤§æ—¶ï¼Œè‡ªåŠ¨é™çº§è¿”å›é»˜è®¤å€¼

```java
@Activate(group = {CommonConstants.PROVIDER})
public class DegradeFilter implements Filter {
    
    private static final AtomicInteger concurrentCount = new AtomicInteger(0);
    private static final int MAX_CONCURRENT = 100; // æœ€å¤§å¹¶å‘æ•°
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) {
        
        int current = concurrentCount.incrementAndGet();
        
        try {
            // è¶…è¿‡é˜ˆå€¼ï¼Œæ‰§è¡Œé™çº§
            if (current > MAX_CONCURRENT) {
                System.err.println("è§¦å‘é™çº§ï¼Œå½“å‰å¹¶å‘ï¼š" + current);
                return getDegradeResult(invocation);
            }
            
            // æ­£å¸¸æ‰§è¡Œ
            return invoker.invoke(invocation);
            
        } finally {
            concurrentCount.decrementAndGet();
        }
    }
    
    private Result getDegradeResult(Invocation invocation) {
        String methodName = invocation.getMethodName();
        
        // æ ¹æ®æ–¹æ³•è¿”å›é»˜è®¤å€¼
        if (methodName.startsWith("get")) {
            return AsyncRpcResult.newDefaultAsyncResult(null, invocation);
        } else if (methodName.equals("createOrder")) {
            return AsyncRpcResult.newDefaultAsyncResult(
                new Order("DEGRADED"), invocation
            );
        }
        
        return AsyncRpcResult.newDefaultAsyncResult(
            "æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•", invocation
        );
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è¿‡æ»¤å™¨æ ¸å¿ƒæ¦‚å¿µ


> ğŸ¯ **è¿‡æ»¤å™¨æœ¬è´¨**ï¼šRPCè°ƒç”¨çš„æ‹¦æˆªå™¨ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘

**å…³é”®ç†è§£**ï¼š
```
âœ… è¿‡æ»¤å™¨ = å®‰æ£€é€šé“
âœ… è¿‡æ»¤å™¨é“¾ = å¤šé“å®‰æ£€ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰
âœ… æ‰§è¡Œé¡ºåº = æ´‹è‘±æ¨¡å‹ï¼ˆä»å¤–åˆ°å†…ï¼Œå†ä»å†…åˆ°å¤–ï¼‰
âœ… åŒå‘å¤„ç† = è¯·æ±‚æ‹¦æˆª + å“åº”å¤„ç†
```

### 8.2 å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹


**â‘  è¿‡æ»¤å™¨çš„ä¸¤ç§ç±»å‹**ï¼š
- æ¶ˆè´¹è€…ç«¯è¿‡æ»¤å™¨ï¼šå‘èµ·è°ƒç”¨å‰æ‰§è¡Œ
- æä¾›è€…ç«¯è¿‡æ»¤å™¨ï¼šå¤„ç†è¯·æ±‚å‰æ‰§è¡Œ

**â‘¡ è¿‡æ»¤å™¨æ ¸å¿ƒæ¥å£**ï¼š
```java
Result invoke(Invoker<?> invoker, Invocation invocation)
```

**â‘¢ å¸¸ç”¨å†…ç½®è¿‡æ»¤å™¨**ï¼š
| è¿‡æ»¤å™¨ | **ç”¨é€”** |
|-------|---------|
| `AccessLogFilter` | `è®¿é—®æ—¥å¿—` |
| `ExecuteLimitFilter` | `é™æµ` |
| `ExceptionFilter` | `å¼‚å¸¸å¤„ç†` |
| `MonitorFilter` | `ç›‘æ§ç»Ÿè®¡` |

**â‘£ è‡ªå®šä¹‰è¿‡æ»¤å™¨æ­¥éª¤**ï¼š
```
1. å®ç°Filteræ¥å£
2. æ·»åŠ @Activateæ³¨è§£
3. é…ç½®SPIæ–‡ä»¶
4. åœ¨æœåŠ¡ä¸­å¯ç”¨
```

### 8.3 æ‰§è¡Œé¡ºåºæ§åˆ¶è¦ç‚¹


**ä¸‰ç§æ–¹å¼**ï¼š
```
æ–¹å¼1ï¼š@Activate(order = -1000)  // æ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œ
æ–¹å¼2ï¼šfilter = "auth,log,monitor"  // é…ç½®é¡ºåºå°±æ˜¯æ‰§è¡Œé¡ºåº
æ–¹å¼3ï¼šbefore/afterå±æ€§  // ç›¸å¯¹ä½ç½®
```

**é¡ºåºå»ºè®®**ï¼š
```
æ¨èé¡ºåºï¼š
  æƒé™éªŒè¯(-1000) â†’ å‚æ•°æ ¡éªŒ(-500) â†’ æ—¥å¿—(0) â†’ 
  ç¼“å­˜(500) â†’ ç›‘æ§(1000)
```

### 8.4 å®æˆ˜åº”ç”¨æ€»ç»“


| åº”ç”¨åœºæ™¯ | **å®ç°è¦ç‚¹** | **æ³¨æ„äº‹é¡¹** |
|---------|------------|------------|
| ğŸ” **æƒé™éªŒè¯** | `æ£€æŸ¥token/session` | `æ”¾åœ¨æœ€å‰é¢æ‰§è¡Œ` |
| ğŸ“Š **æ€§èƒ½ç›‘æ§** | `è®°å½•å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´` | `æ”¾åœ¨è¾ƒåä½ç½®` |
| ğŸ’¾ **ç»“æœç¼“å­˜** | `æŸ¥è¯¢æ—¶å…ˆæ£€æŸ¥ç¼“å­˜` | `åªç¼“å­˜æŸ¥è¯¢æ–¹æ³•` |
| ğŸ”’ **æ•°æ®è„±æ•** | `å“åº”åå¤„ç†æ•æ„Ÿå­—æ®µ` | `æ³¨æ„æ€§èƒ½å½±å“` |
| ğŸ“ **é“¾è·¯è¿½è¸ª** | `ç”Ÿæˆå’Œä¼ é€’traceId` | `æ¶ˆè´¹è€…ç«¯æœ€å…ˆæ‰§è¡Œ` |

### 8.5 å¼€å‘æ³¨æ„äº‹é¡¹


**âœ… æœ€ä½³å®è·µ**ï¼š
- â‘  è¿‡æ»¤å™¨é€»è¾‘è¦ç®€å•é«˜æ•ˆï¼Œé¿å…å¤æ‚è®¡ç®—
- â‘¡ å¼‚å¸¸è¦å¦¥å–„å¤„ç†ï¼Œä¸èƒ½åæ‰å¼‚å¸¸
- â‘¢ åˆç†è®¾ç½®orderå€¼ï¼Œæ§åˆ¶æ‰§è¡Œé¡ºåº
- â‘£ ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„
- â‘¤ é¿å…åœ¨è¿‡æ»¤å™¨ä¸­é˜»å¡çº¿ç¨‹

**âŒ å¸¸è§é”™è¯¯**ï¼š
```
Ã— åœ¨è¿‡æ»¤å™¨ä¸­åšæ•°æ®åº“æ“ä½œï¼ˆå¤ªæ…¢ï¼‰
Ã— å¿˜è®°è°ƒç”¨invoker.invoke()ï¼ˆè°ƒç”¨é“¾ä¸­æ–­ï¼‰
Ã— é¡ºåºè®¾ç½®ä¸åˆç†ï¼ˆæƒé™éªŒè¯æ”¾åœ¨æœ€åï¼‰
Ã— æ²¡æœ‰å¤„ç†å¼‚å¸¸ï¼ˆå¯¼è‡´è°ƒç”¨å¤±è´¥ï¼‰
Ã— è¿‡æ»¤å™¨é€»è¾‘å¤ªå¤æ‚ï¼ˆå½±å“æ€§èƒ½ï¼‰
```

### 8.6 å¿«é€Ÿè®°å¿†å£è¯€


```
è¿‡æ»¤å™¨é“¾è´£ä»»ä¼ ï¼Œè¯·æ±‚å“åº”åŒå‘ç®¡
é¡ºåºæ§åˆ¶è¦åˆç†ï¼Œæƒé™æ—¥å¿—æ€§èƒ½ç›‘
è‡ªå®šä¹‰å¼€å‘å››æ­¥èµ°ï¼Œæ¥å£æ³¨è§£SPIæ–‡ä»¶
å†…ç½®è¿‡æ»¤åŠŸèƒ½å…¨ï¼Œå®æˆ˜åœºæ™¯è®°å¿ƒé—´
```

**æ ¸å¿ƒæŠ€èƒ½æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ç†è§£è¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œæœºåˆ¶
- [ ] æŒæ¡@Activateæ³¨è§£çš„ä½¿ç”¨
- [ ] ä¼šå¼€å‘è‡ªå®šä¹‰è¿‡æ»¤å™¨
- [ ] èƒ½æ§åˆ¶è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
- [ ] ç†è§£å¸¸ç”¨å†…ç½®è¿‡æ»¤å™¨
- [ ] èƒ½åº”ç”¨åˆ°å®é™…ä¸šåŠ¡åœºæ™¯

---

## ğŸ“š å»¶ä¼¸å­¦ä¹ 


**ç›¸å…³ä¸»é¢˜**ï¼š
- Dubbo SPIæœºåˆ¶è¯¦è§£
- Dubboå¼‚æ­¥è°ƒç”¨ä¸Filter
- åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªå®ç°
- å¾®æœåŠ¡ç›‘æ§ä½“ç³»å»ºè®¾