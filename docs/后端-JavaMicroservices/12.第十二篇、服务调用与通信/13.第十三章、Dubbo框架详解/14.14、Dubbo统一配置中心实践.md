---
title: 14ã€Dubboç»Ÿä¸€é…ç½®ä¸­å¿ƒå®è·µ
---
## ğŸ“š ç›®å½•

1. [é…ç½®ä¸­å¿ƒæ¦‚è¿°](#1-é…ç½®ä¸­å¿ƒæ¦‚è¿°)
2. [Nacosé…ç½®ä¸­å¿ƒå®æˆ˜](#2-Nacosé…ç½®ä¸­å¿ƒå®æˆ˜)
3. [Apolloé…ç½®ä¸­å¿ƒå®æˆ˜](#3-Apolloé…ç½®ä¸­å¿ƒå®æˆ˜)
4. [åŠ¨æ€é…ç½®ä¸‹å‘æœºåˆ¶](#4-åŠ¨æ€é…ç½®ä¸‹å‘æœºåˆ¶)
5. [é…ç½®çƒ­æ›´æ–°å®ç°](#5-é…ç½®çƒ­æ›´æ–°å®ç°)
6. [æ²»ç†è§„åˆ™ç®¡ç†](#6-æ²»ç†è§„åˆ™ç®¡ç†)
7. [é…ç½®ç‰ˆæœ¬æ§åˆ¶](#7-é…ç½®ç‰ˆæœ¬æ§åˆ¶)
8. [é…ç½®å®‰å…¨ç®¡ç†](#8-é…ç½®å®‰å…¨ç®¡ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ä¸­å¿ƒæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ä¸­å¿ƒ


**é€šä¿—ç†è§£**ï¼š
é…ç½®ä¸­å¿ƒå°±åƒä¸€ä¸ª"**ç»Ÿä¸€çš„è®¾ç½®é¢æ¿**"ï¼Œæ‰€æœ‰å¾®æœåŠ¡çš„é…ç½®ä¿¡æ¯éƒ½é›†ä¸­å­˜æ”¾åœ¨è¿™é‡Œã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆåˆ†æ•£é…ç½®ï¼‰ï¼š
æ¯ä¸ªæœåŠ¡è‡ªå·±çš„é…ç½®æ–‡ä»¶
æœåŠ¡A â†’ application.properties
æœåŠ¡B â†’ application.properties  
æœåŠ¡C â†’ application.properties
é—®é¢˜ï¼šä¿®æ”¹é…ç½®è¦é‡å¯ï¼Œç®¡ç†æ··ä¹±

é…ç½®ä¸­å¿ƒæ–¹å¼ï¼ˆé›†ä¸­ç®¡ç†ï¼‰ï¼š
         é…ç½®ä¸­å¿ƒ
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â†“      â†“      â†“
  æœåŠ¡A   æœåŠ¡B   æœåŠ¡C
ä¼˜åŠ¿ï¼šç»Ÿä¸€ç®¡ç†ï¼ŒåŠ¨æ€æ›´æ–°
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ¯ **é›†ä¸­å­˜å‚¨**ï¼šæ‰€æœ‰é…ç½®ç»Ÿä¸€å­˜æ”¾ï¼Œä¾¿äºç®¡ç†
- ğŸ”„ **åŠ¨æ€æ›´æ–°**ï¼šä¿®æ”¹é…ç½®ä¸éœ€è¦é‡å¯æœåŠ¡
- ğŸ”’ **æƒé™æ§åˆ¶**ï¼šè°èƒ½æ”¹ã€è°èƒ½çœ‹ï¼Œæ¸…æ¸…æ¥šæ¥š
- ğŸ“ **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®æ”¹é”™äº†ï¼Ÿä¸€é”®å›é€€

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ä¸­å¿ƒ


**å®é™…ä¸šåŠ¡åœºæ™¯**ï¼š

> ğŸ’¡ **åœºæ™¯1ï¼šç´§æ€¥é™æµ**  
> ç³»ç»Ÿçªç„¶æµé‡æš´å¢ï¼Œéœ€è¦ç«‹å³é™ä½æŸä¸ªæœåŠ¡çš„å¹¶å‘é‡ã€‚ä¼ ç»Ÿæ–¹å¼è¦æ”¹é…ç½®ã€æ‰“åŒ…ã€é‡å¯ï¼Œè‡³å°‘10åˆ†é’Ÿã€‚ç”¨é…ç½®ä¸­å¿ƒï¼Œæ”¹ä¸ªæ•°å­—ï¼Œå‡ ç§’é’Ÿç”Ÿæ•ˆã€‚

> ğŸ’¡ **åœºæ™¯2ï¼šç°åº¦å‘å¸ƒ**  
> æ–°åŠŸèƒ½ä¸Šçº¿ï¼Œå…ˆè®©10%ç”¨æˆ·ä½“éªŒã€‚é…ç½®ä¸­å¿ƒå¯ä»¥åŠ¨æ€è°ƒæ•´è¿™ä¸ªç™¾åˆ†æ¯”ï¼Œå‡ºé—®é¢˜ç«‹å³è°ƒå›0%ã€‚

**é…ç½®ä¸­å¿ƒ vs æœ¬åœ°é…ç½®**ï¼š

| å¯¹æ¯”é¡¹ | **æœ¬åœ°é…ç½®æ–‡ä»¶** | **é…ç½®ä¸­å¿ƒ** |
|--------|-----------------|-------------|
| ä¿®æ”¹ç”Ÿæ•ˆ | â° éœ€è¦é‡å¯æœåŠ¡ | âš¡ ç§’çº§ç”Ÿæ•ˆ |
| ç®¡ç†æ–¹å¼ | ğŸ“‚ åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡ | ğŸ“¦ ç»Ÿä¸€ç®¡ç† |
| ç‰ˆæœ¬æ§åˆ¶ | âŒ éœ€è¦Gitç®¡ç† | âœ… è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç† |
| å®‰å…¨æ€§ | âš ï¸ ä»£ç ä¸­æ˜æ–‡ | ğŸ”’ åŠ å¯†å­˜å‚¨ |
| å¤šç¯å¢ƒ | ğŸ˜° æ‰‹åŠ¨åˆ‡æ¢ | ğŸ¯ ç¯å¢ƒéš”ç¦» |

### 1.3 ä¸»æµé…ç½®ä¸­å¿ƒå¯¹æ¯”


**Nacos vs Apollo vs Spring Cloud Config**ï¼š

```
Nacosï¼ˆé˜¿é‡Œç³»ï¼‰ï¼š
âœ… é…ç½®ç®¡ç† + æœåŠ¡æ³¨å†Œï¼ˆäºŒåˆä¸€ï¼‰
âœ… å›½å†…æ–‡æ¡£é½å…¨ï¼Œç¤¾åŒºæ´»è·ƒ
âœ… ç•Œé¢å‹å¥½ï¼Œä¸Šæ‰‹å¿«
âš ï¸ ä¼ä¸šçº§åŠŸèƒ½ç›¸å¯¹ç®€å•

Apolloï¼ˆæºç¨‹ï¼‰ï¼š
âœ… åŠŸèƒ½æœ€å¼ºå¤§ï¼Œä¼ä¸šçº§ç‰¹æ€§å®Œå–„
âœ… æƒé™ã€å®¡è®¡ã€ç°åº¦æ ·æ ·é½å…¨
âœ… é«˜å¯ç”¨æ¶æ„è®¾è®¡å¥½
âš ï¸ éƒ¨ç½²ç›¸å¯¹å¤æ‚

Spring Cloud Configï¼š
âœ… Springç”Ÿæ€æ— ç¼é›†æˆ
âœ… åŸºäºGitï¼Œç¨‹åºå‘˜ç†Ÿæ‚‰
âš ï¸ åŠŸèƒ½è¾ƒåŸºç¡€
âš ï¸ ç¼ºå°‘ç®¡ç†ç•Œé¢
```

**é€‰å‹å»ºè®®**ï¼š
- ğŸ¯ **å°å›¢é˜Ÿ/åˆå­¦è€…**ï¼šé€‰ Nacosï¼ˆç®€å•å¥½ç”¨ï¼‰
- ğŸ¢ **å¤§ä¼ä¸š/é«˜è¦æ±‚**ï¼šé€‰ Apolloï¼ˆåŠŸèƒ½å®Œå–„ï¼‰
- ğŸŒ± **Springé¡¹ç›®**ï¼šå¯ä»¥å…ˆç”¨ Spring Cloud Configï¼ˆå¤Ÿç”¨ï¼‰

---

## 2. ğŸš€ Nacosé…ç½®ä¸­å¿ƒå®æˆ˜


### 2.1 Nacosæ ¸å¿ƒæ¦‚å¿µ


**å¿…é¡»ç†è§£çš„ä¸‰ä¸ªæ¦‚å¿µ**ï¼š

**å‘½åç©ºé—´ï¼ˆNamespaceï¼‰**ï¼š
```
ç†è§£ä¸º"ç¯å¢ƒéš”ç¦»"

å¼€å‘ç¯å¢ƒ (dev)      æµ‹è¯•ç¯å¢ƒ (test)      ç”Ÿäº§ç¯å¢ƒ (prod)
   â†“                    â†“                    â†“
å¼€å‘é…ç½®              æµ‹è¯•é…ç½®              ç”Ÿäº§é…ç½®

ä½œç”¨ï¼šä¸åŒç¯å¢ƒçš„é…ç½®å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“
```

**åˆ†ç»„ï¼ˆGroupï¼‰**ï¼š
```
ç†è§£ä¸º"ä¸šåŠ¡éš”ç¦»"

åŒä¸€ä¸ªç¯å¢ƒä¸‹ï¼Œä¸åŒä¸šåŠ¡çº¿çš„é…ç½®åˆ†ç»„

DEFAULT_GROUP          ORDER_GROUP          USER_GROUP
  â†“                      â†“                     â†“
é€šç”¨é…ç½®              è®¢å•æœåŠ¡é…ç½®          ç”¨æˆ·æœåŠ¡é…ç½®

ä½œç”¨ï¼šç›¸åŒç¯å¢ƒä¸‹ï¼ŒæŒ‰ä¸šåŠ¡åˆ’åˆ†é…ç½®
```

**Data ID**ï¼š
```
ç†è§£ä¸º"é…ç½®æ–‡ä»¶å"

è§„èŒƒå‘½åï¼šæœåŠ¡å-ç¯å¢ƒ.æ–‡ä»¶ç±»å‹
ç¤ºä¾‹ï¼š
- user-service-dev.yml      (ç”¨æˆ·æœåŠ¡å¼€å‘ç¯å¢ƒ)
- order-service-prod.yml    (è®¢å•æœåŠ¡ç”Ÿäº§ç¯å¢ƒ)
- common-config.properties  (å…¬å…±é…ç½®)
```

**ä¸‰è€…å…³ç³»å›¾**ï¼š
```
Namespace(å‘½åç©ºé—´)
    â””â”€â”€ Group(åˆ†ç»„)
           â””â”€â”€ Data ID(é…ç½®æ–‡ä»¶)
                  â””â”€â”€ é…ç½®å†…å®¹

å®ä¾‹ï¼šprodå‘½åç©ºé—´ â†’ ORDER_GROUPåˆ†ç»„ â†’ order-service.yml
```

### 2.2 å¿«é€Ÿæ¥å…¥Nacos


**æ­¥éª¤ä¸€ï¼šæ·»åŠ ä¾èµ–**
```xml
<!-- Nacosé…ç½®ä¸­å¿ƒä¾èµ– -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
</dependency>

<!-- åŠ¨æ€åˆ·æ–°ä¾èµ– -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

**æ­¥éª¤äºŒï¼šé…ç½®è¿æ¥ä¿¡æ¯**

åˆ›å»º `bootstrap.yml`ï¼ˆæ³¨æ„ï¼šä¸æ˜¯application.ymlï¼‰

```yaml
spring:
  application:
    name: user-service  # æœåŠ¡å
  cloud:
    nacos:
      config:
        server-addr: 127.0.0.1:8848    # Nacosåœ°å€
        namespace: dev                  # å‘½åç©ºé—´ID
        group: DEFAULT_GROUP            # åˆ†ç»„
        file-extension: yml             # é…ç½®æ–‡ä»¶æ ¼å¼
        refresh-enabled: true           # å¼€å¯åŠ¨æ€åˆ·æ–°
```

> ğŸ“ **ä¸ºä»€ä¹ˆç”¨bootstrap.ymlï¼Ÿ**  
> å› ä¸ºé…ç½®ä¸­å¿ƒçš„é…ç½®è¦å…ˆåŠ è½½ï¼Œbootstrap.ymlæ¯”application.ymlæ›´æ—©åŠ è½½ã€‚

**æ­¥éª¤ä¸‰ï¼šNacosæ§åˆ¶å°åˆ›å»ºé…ç½®**

```
1. ç™»å½•Nacosæ§åˆ¶å°ï¼šhttp://localhost:8848/nacos
   é»˜è®¤è´¦å·å¯†ç ï¼šnacos/nacos

2. åˆ›å»ºé…ç½®ï¼š
   - å‘½åç©ºé—´ï¼šé€‰æ‹©dev
   - Data IDï¼šuser-service-dev.yml
   - Groupï¼šDEFAULT_GROUP
   - é…ç½®æ ¼å¼ï¼šYAML
   - é…ç½®å†…å®¹ï¼š
     server:
       port: 8080
     dubbo:
       protocol:
         port: 20880
```

### 2.3 è¯»å–é…ç½®çš„ä¸‰ç§æ–¹å¼


**æ–¹å¼ä¸€ï¼š@Valueæ³¨è§£ï¼ˆæœ€ç®€å•ï¼‰**
```java
@RestController
public class ConfigController {
    
    @Value("${dubbo.protocol.port}")
    private int dubboPort;
    
    @GetMapping("/port")
    public String getPort() {
        return "Dubboç«¯å£ï¼š" + dubboPort;
    }
}
```

**æ–¹å¼äºŒï¼š@ConfigurationPropertiesï¼ˆæ¨èï¼‰**
```java
@Component
@ConfigurationProperties(prefix = "dubbo.protocol")
@Data
public class DubboConfig {
    private String name;    // å¯¹åº” dubbo.protocol.name
    private Integer port;   // å¯¹åº” dubbo.protocol.port
    private String host;    // å¯¹åº” dubbo.protocol.host
}

// ä½¿ç”¨
@Autowired
private DubboConfig dubboConfig;
```

**æ–¹å¼ä¸‰ï¼šEnvironmentå¯¹è±¡ï¼ˆçµæ´»ï¼‰**
```java
@Autowired
private Environment env;

public void printConfig() {
    String port = env.getProperty("dubbo.protocol.port");
    System.out.println("ç«¯å£ï¼š" + port);
}
```

**ä¸‰ç§æ–¹å¼å¯¹æ¯”**ï¼š

| æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| @Value | ç®€å•ç›´æ¥ | é…ç½®å¤šæ—¶ä»£ç å†—é•¿ | å•ä¸ªé…ç½®é¡¹ |
| @ConfigurationProperties | ç±»å‹å®‰å…¨ã€è‡ªåŠ¨æ˜ å°„ | éœ€è¦åˆ›å»ºé…ç½®ç±» | âœ… **æ‰¹é‡é…ç½®ï¼ˆæ¨èï¼‰** |
| Environment | çµæ´»åŠ¨æ€è·å– | æ‰‹åŠ¨å¤„ç†ç±»å‹è½¬æ¢ | åŠ¨æ€è¯»å–é…ç½® |

---

## 3. ğŸ¨ Apolloé…ç½®ä¸­å¿ƒå®æˆ˜


### 3.1 Apolloæ ¸å¿ƒæ¦‚å¿µ


**Apolloçš„å››å±‚æ¨¡å‹**ï¼š
```
åº”ç”¨ (App)
  â””â”€â”€ ç¯å¢ƒ (Environment: DEV/TEST/PROD)
       â””â”€â”€ é›†ç¾¤ (Cluster: é»˜è®¤default)
            â””â”€â”€ å‘½åç©ºé—´ (Namespace: application/å…¬å…±é…ç½®)
                 â””â”€â”€ é…ç½®é¡¹ (Key-Value)

ç¤ºä¾‹è·¯å¾„ï¼š
user-service â†’ DEV â†’ default â†’ application â†’ dubbo.port=20880
```

**å…³é”®æ¦‚å¿µè§£é‡Š**ï¼š

**åº”ç”¨ï¼ˆAppï¼‰**ï¼š
- é€šä¿—ç†è§£ï¼šä¸€ä¸ªå¾®æœåŠ¡å°±æ˜¯ä¸€ä¸ªåº”ç”¨
- ç¤ºä¾‹ï¼š`user-service`ã€`order-service`

**ç¯å¢ƒï¼ˆEnvironmentï¼‰**ï¼š
- å¼€å‘ç¯å¢ƒï¼ˆDEVï¼‰ã€æµ‹è¯•ï¼ˆFATï¼‰ã€ç”Ÿäº§ï¼ˆPROï¼‰
- æ¯ä¸ªç¯å¢ƒç‹¬ç«‹é…ç½®

**é›†ç¾¤ï¼ˆClusterï¼‰**ï¼š
```
åŒä¸€ä¸ªæœåŠ¡éƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿/åŒºåŸŸ

       user-service
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
åŒ—äº¬æœºæˆ¿(BJ)    ä¸Šæµ·æœºæˆ¿(SH)
    â†“              â†“
 ä¸åŒé…ç½®        ä¸åŒé…ç½®

ä½œç”¨ï¼šä¸åŒé›†ç¾¤å¯ä»¥æœ‰ä¸åŒé…ç½®ï¼ˆå¦‚æ•°æ®åº“åœ°å€ï¼‰
```

**å‘½åç©ºé—´ï¼ˆNamespaceï¼‰**ï¼š
```
application         â†’ ç§æœ‰é…ç½®ï¼ˆæœåŠ¡ç‹¬äº«ï¼‰
common.yml          â†’ å…¬å…±é…ç½®ï¼ˆæ‰€æœ‰æœåŠ¡å…±äº«ï¼‰
dubbo-config.yml    â†’ ä¸­é—´ä»¶é…ç½®
```

### 3.2 å¿«é€Ÿæ¥å…¥Apollo


**æ­¥éª¤ä¸€ï¼šæ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>com.ctrip.framework.apollo</groupId>
    <artifactId>apollo-client</artifactId>
    <version>2.0.1</version>
</dependency>
```

**æ­¥éª¤äºŒï¼šé…ç½®Apolloè¿æ¥**

åˆ›å»º `apollo-env.properties`ï¼ˆæ”¾åœ¨resourcesç›®å½•ï¼‰
```properties
# Apolloé…ç½®ä¸­å¿ƒåœ°å€
dev.meta=http://localhost:8080
fat.meta=http://test-apollo:8080
pro.meta=http://prod-apollo:8080
```

**æ­¥éª¤ä¸‰ï¼šåº”ç”¨é…ç½®**

`application.properties`
```properties
# Apolloé…ç½®
app.id=user-service                    # åº”ç”¨IDï¼ˆåœ¨Apolloåˆ›å»ºï¼‰
apollo.meta=http://localhost:8080      # Apolloåœ°å€
apollo.bootstrap.enabled=true          # å¯ç”¨Apollo
apollo.bootstrap.namespaces=application,common.yml  # å‘½åç©ºé—´
```

**æ­¥éª¤å››ï¼šå¯åŠ¨ç±»å¯ç”¨**
```java
@SpringBootApplication
@EnableApolloConfig  // å¯ç”¨Apolloé…ç½®
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

### 3.3 Apolloç•Œé¢æ“ä½œ


**åˆ›å»ºåº”ç”¨æ­¥éª¤**ï¼š
```
1. ç™»å½•Apollo Portal
   â†’ é»˜è®¤åœ°å€ï¼šhttp://localhost:8070

2. åˆ›å»ºåº”ç”¨
   â†’ AppId: user-service
   â†’ åº”ç”¨åç§°: ç”¨æˆ·æœåŠ¡
   â†’ éƒ¨é—¨: é€‰æ‹©å¯¹åº”éƒ¨é—¨

3. æ·»åŠ é…ç½®
   â†’ è¿›å…¥applicationå‘½åç©ºé—´
   â†’ æ–°å¢é…ç½®é¡¹
   â†’ Key: dubbo.protocol.port
   â†’ Value: 20880
   â†’ ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®
```

**é…ç½®å‘å¸ƒæµç¨‹**ï¼š
```
ç¼–è¾‘é…ç½® â†’ é¢„è§ˆå˜æ›´ â†’ å¡«å†™å‘å¸ƒè¯´æ˜ â†’ å‘å¸ƒ
    â†“
é…ç½®ç”Ÿæ•ˆï¼ˆå®¢æˆ·ç«¯å®æ—¶æ¥æ”¶ï¼‰
```

---

## 4. ğŸ”„ åŠ¨æ€é…ç½®ä¸‹å‘æœºåˆ¶


### 4.1 é…ç½®ä¸‹å‘åŸç†


**é•¿è½®è¯¢æœºåˆ¶ï¼ˆNacos/Apolloéƒ½ä½¿ç”¨ï¼‰**ï¼š

```
å®¢æˆ·ç«¯                          é…ç½®ä¸­å¿ƒ
  |                                |
  |----[1]è¯·æ±‚æœ€æ–°é…ç½®------------>|
  |                                |
  |<---[2]é…ç½®æœªå˜åŒ–ï¼Œç­‰å¾…30ç§’-----|  â† æœåŠ¡ç«¯holdä½è¯·æ±‚
  |                                |
  |        (é…ç½®å‘ç”Ÿå˜åŒ–)          |
  |                                |
  |<---[3]ç«‹å³è¿”å›æ–°é…ç½®-----------|
  |                                |
  |----[4]å†æ¬¡è¯·æ±‚æœ€æ–°é…ç½®-------->|
  |                                |

ä¼˜ç‚¹ï¼šå®æ—¶æ€§å¥½ï¼Œèµ„æºæ¶ˆè€—ä½
```

> ğŸ’¡ **é€šä¿—ç†è§£é•¿è½®è¯¢**ï¼š  
> å°±åƒä½ é—®æœåŠ¡å‘˜"é¥­å¥½äº†å—"ï¼ŒæœåŠ¡å‘˜è¯´"è¿˜æ²¡å¥½ï¼Œä½ ç­‰ç€ï¼Œå¥½äº†æˆ‘å«ä½ "ã€‚å¦‚æœ30ç§’è¿˜æ²¡å¥½ï¼Œä½ å†é—®ä¸€æ¬¡ã€‚

**æ¨é€æœºåˆ¶å¯¹æ¯”**ï¼š

| æœºåˆ¶ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|---------|---------|---------|
| è½®è¯¢ | å®¢æˆ·ç«¯å®šæ—¶æŸ¥è¯¢ | ç®€å• | å»¶è¿Ÿé«˜ã€æµªè´¹èµ„æº |
| é•¿è½®è¯¢ | æœåŠ¡ç«¯holdè¯·æ±‚ | âœ… å®æ—¶ã€çœèµ„æº | éœ€è¦æœåŠ¡ç«¯æ”¯æŒ |
| WebSocket | åŒå‘é€šä¿¡ | å®æ—¶æ€§æœ€å¥½ | å¤æ‚ã€è¿æ¥å¤š |

### 4.2 é…ç½®ç›‘å¬å®ç°


**Nacosç›‘å¬é…ç½®å˜åŒ–**ï¼š

```java
@Component
public class ConfigListener {
    
    @Autowired
    private ConfigService configService;
    
    @PostConstruct
    public void init() {
        String dataId = "user-service-dev.yml";
        String group = "DEFAULT_GROUP";
        
        // æ·»åŠ ç›‘å¬å™¨
        configService.addListener(dataId, group, new Listener() {
            
            @Override
            public void receiveConfigInfo(String configInfo) {
                System.out.println("é…ç½®æ›´æ–°äº†ï¼æ–°é…ç½®ï¼š" + configInfo);
                // è¿™é‡Œå¯ä»¥åšä¸šåŠ¡å¤„ç†
                handleConfigChange(configInfo);
            }
            
            @Override
            public Executor getExecutor() {
                return null;  // ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± 
            }
        });
    }
    
    private void handleConfigChange(String config) {
        // å¤„ç†é…ç½®å˜åŒ–çš„ä¸šåŠ¡é€»è¾‘
        System.out.println("é‡æ–°åŠ è½½é…ç½®...");
    }
}
```

**Apolloç›‘å¬é…ç½®å˜åŒ–**ï¼š

```java
@Component
public class ApolloConfigListener {
    
    // æ–¹å¼ä¸€ï¼šç›‘å¬æ•´ä¸ªå‘½åç©ºé—´
    @ApolloConfigChangeListener
    public void onChange(ConfigChangeEvent event) {
        for (String key : event.changedKeys()) {
            ConfigChange change = event.getChange(key);
            System.out.println(String.format(
                "é…ç½®å˜åŒ– - Key: %s, æ—§å€¼: %s, æ–°å€¼: %s",
                key, change.getOldValue(), change.getNewValue()
            ));
        }
    }
    
    // æ–¹å¼äºŒï¼šç›‘å¬ç‰¹å®šé…ç½®é¡¹
    @ApolloConfigChangeListener(value = "application", 
                                 interestedKeys = {"dubbo.protocol.port"})
    public void onDubboPortChange(ConfigChangeEvent event) {
        String newPort = event.getChange("dubbo.protocol.port").getNewValue();
        System.out.println("Dubboç«¯å£å˜æ›´ä¸ºï¼š" + newPort);
    }
}
```

---

## 5. âš¡ é…ç½®çƒ­æ›´æ–°å®ç°


### 5.1 ä»€ä¹ˆæ˜¯é…ç½®çƒ­æ›´æ–°


**é€šä¿—è§£é‡Š**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼š
ä¿®æ”¹é…ç½® â†’ é‡å¯æœåŠ¡ï¼ˆå‡ åˆ†é’Ÿï¼‰ â†’ é…ç½®ç”Ÿæ•ˆ
é—®é¢˜ï¼šæœåŠ¡ä¸­æ–­ï¼Œå½±å“ç”¨æˆ·

çƒ­æ›´æ–°ï¼š
ä¿®æ”¹é…ç½® â†’ é…ç½®è‡ªåŠ¨ç”Ÿæ•ˆï¼ˆå‡ ç§’é’Ÿï¼‰ â†’ æ— éœ€é‡å¯
ä¼˜åŠ¿ï¼šä¸ä¸­æ–­æœåŠ¡ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
```

### 5.2 @RefreshScopeå®ç°çƒ­æ›´æ–°


**åŸºæœ¬ç”¨æ³•**ï¼š

```java
@RestController
@RefreshScope  // å…³é”®æ³¨è§£ï¼šæ”¯æŒé…ç½®çƒ­æ›´æ–°
public class DubboController {
    
    @Value("${dubbo.protocol.port}")
    private int dubboPort;
    
    @Value("${dubbo.protocol.threads:200}")  // é»˜è®¤å€¼200
    private int threads;
    
    @GetMapping("/dubbo-config")
    public Map<String, Object> getConfig() {
        Map<String, Object> config = new HashMap<>();
        config.put("port", dubboPort);
        config.put("threads", threads);
        return config;
    }
}
```

**å·¥ä½œåŸç†**ï¼š
```
1. @RefreshScopeæ ‡è®°çš„Beanæ˜¯ç‰¹æ®Šçš„ä»£ç†Bean
2. é…ç½®å˜åŒ–æ—¶ï¼Œå®¹å™¨ä¼šï¼š
   - é”€æ¯æ—§çš„Beanå®ä¾‹
   - ç”¨æ–°é…ç½®åˆ›å»ºæ–°çš„Beanå®ä¾‹
3. ä¸‹æ¬¡è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨æ–°å®ä¾‹ï¼ˆæ–°é…ç½®ï¼‰
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - @RefreshScopeä¼šé™ä½ä¸€ç‚¹æ€§èƒ½ï¼ˆä»£ç†å¼€é”€ï¼‰
> - ä¸è¦åœ¨@RefreshScopeçš„Beanä¸­åšå¤æ‚åˆå§‹åŒ–
> - å•ä¾‹Beanä¸­çš„@Valueä¸ä¼šè‡ªåŠ¨åˆ·æ–°

### 5.3 æ‰‹åŠ¨åˆ·æ–°é…ç½®


**åœºæ™¯**ï¼šæŸäº›é…ç½®éœ€è¦æ‰‹åŠ¨è§¦å‘åˆ·æ–°

```java
@Service
public class ConfigRefreshService {
    
    @Autowired
    private NacosConfigManager configManager;
    
    public String manualRefresh(String dataId, String group) {
        try {
            // ä»Nacosè·å–æœ€æ–°é…ç½®
            String config = configManager.getConfigService()
                .getConfig(dataId, group, 3000);
            
            System.out.println("æ‰‹åŠ¨è·å–é…ç½®ï¼š" + config);
            
            // è§¦å‘é…ç½®åˆ·æ–°äº‹ä»¶
            publishRefreshEvent();
            
            return "åˆ·æ–°æˆåŠŸ";
        } catch (Exception e) {
            return "åˆ·æ–°å¤±è´¥ï¼š" + e.getMessage();
        }
    }
    
    @Autowired
    private ApplicationContext context;
    
    private void publishRefreshEvent() {
        // å‘å¸ƒåˆ·æ–°äº‹ä»¶
        context.publishEvent(new RefreshEvent(this, null, "æ‰‹åŠ¨åˆ·æ–°"));
    }
}
```

---

## 6. ğŸ›¡ï¸ æ²»ç†è§„åˆ™ç®¡ç†


### 6.1 ä»€ä¹ˆæ˜¯æ²»ç†è§„åˆ™


**é€šä¿—ç†è§£**ï¼š
æ²»ç†è§„åˆ™å°±æ˜¯**å¾®æœåŠ¡çš„"äº¤é€šè§„åˆ™"**ï¼Œè§„å®šæœåŠ¡ä¹‹é—´å¦‚ä½•è°ƒç”¨ã€å¦‚ä½•é™æµã€å‡ºé”™äº†æ€ä¹ˆåŠã€‚

**å¸¸è§æ²»ç†è§„åˆ™**ï¼š
```
ğŸš¦ è·¯ç”±è§„åˆ™ï¼š
   - è°ƒç”¨è®¢å•æœåŠ¡æ—¶ï¼Œ20%æµé‡åˆ°æ–°ç‰ˆæœ¬ï¼Œ80%åˆ°æ—§ç‰ˆæœ¬ï¼ˆç°åº¦å‘å¸ƒï¼‰

ğŸš§ é™æµè§„åˆ™ï¼š
   - æ¯ç§’æœ€å¤šæ¥æ”¶1000ä¸ªè¯·æ±‚ï¼Œè¶…è¿‡å°±æ‹’ç»

âš–ï¸ è´Ÿè½½å‡è¡¡è§„åˆ™ï¼š
   - ä¼˜å…ˆè°ƒç”¨åŒæœºæˆ¿çš„æœåŠ¡ï¼ˆå°±è¿‘è®¿é—®ï¼‰

ğŸ”„ é™çº§è§„åˆ™ï¼š
   - æ”¯ä»˜æœåŠ¡æŒ‚äº†ï¼Œæš‚æ—¶ç”¨å¼‚æ­¥å¤„ç†ï¼ˆæœåŠ¡é™çº§ï¼‰
```

### 6.2 Nacosæ²»ç†è§„åˆ™é…ç½®


**è·¯ç”±è§„åˆ™ç¤ºä¾‹**ï¼š

åœ¨Nacosåˆ›å»ºé…ç½®ï¼š`user-service-router.yml`

```yaml
# ç°åº¦å‘å¸ƒè·¯ç”±è§„åˆ™
dubbo:
  consumer:
    router:
      - name: gray-router
        enabled: true
        priority: 100
        conditions:
          - key: version
            values:
              - v2.0
            weight: 20    # 20%æµé‡åˆ°v2.0ç‰ˆæœ¬
          - key: version  
            values:
              - v1.0
            weight: 80    # 80%æµé‡åˆ°v1.0ç‰ˆæœ¬
```

**ä»£ç ä¸­è¯»å–æ²»ç†è§„åˆ™**ï¼š

```java
@Component
public class RouterRuleManager {
    
    @NacosValue(value = "${dubbo.consumer.router}", autoRefreshed = true)
    private String routerRule;
    
    @PostConstruct
    public void init() {
        System.out.println("å½“å‰è·¯ç”±è§„åˆ™ï¼š" + routerRule);
    }
    
    // é…ç½®å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘
    @NacosConfigListener(dataId = "user-service-router.yml")
    public void onRouterChange(String newRule) {
        System.out.println("è·¯ç”±è§„åˆ™å˜æ›´ï¼š" + newRule);
        applyNewRouterRule(newRule);
    }
    
    private void applyNewRouterRule(String rule) {
        // åº”ç”¨æ–°çš„è·¯ç”±è§„åˆ™
    }
}
```

### 6.3 é™æµè§„åˆ™é…ç½®


**Sentinelé™æµè§„åˆ™**ï¼š

```yaml
# é™æµè§„åˆ™é…ç½®
sentinel:
  datasource:
    nacos:
      server-addr: 127.0.0.1:8848
      dataId: user-service-flow-rules
      groupId: SENTINEL_GROUP
      rule-type: flow  # é™æµè§„åˆ™ç±»å‹

# å…·ä½“é™æµè§„åˆ™
flow-rules:
  - resource: com.example.UserService:getUserInfo  # é™æµèµ„æº
    grade: 1           # é™æµç±»å‹ï¼š1=QPS
    count: 100         # é˜ˆå€¼ï¼šæ¯ç§’100æ¬¡
    strategy: 0        # ç­–ç•¥ï¼š0=ç›´æ¥æ‹’ç»
    controlBehavior: 0 # è¡Œä¸ºï¼š0=å¿«é€Ÿå¤±è´¥
```

**æ•ˆæœ**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
è¯·æ±‚ â†’ é™æµæ£€æŸ¥(100æ¬¡/ç§’) â†’ æ‰§è¡Œä¸šåŠ¡ â†’ è¿”å›ç»“æœ

æµé‡è¶…é™ï¼š
è¯·æ±‚ â†’ é™æµæ£€æŸ¥(è¶…è¿‡100) â†’ ç›´æ¥æ‹’ç» â†’ è¿”å›é™æµæç¤º
```

---

## 7. ğŸ“¦ é…ç½®ç‰ˆæœ¬æ§åˆ¶


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶


**å®é™…åœºæ™¯**ï¼š
```
ä¸‹åˆ3ç‚¹ï¼šè¿ç»´å°å¼ ä¿®æ”¹äº†æ•°æ®åº“è¿æ¥é…ç½®
ä¸‹åˆ3:05ï¼šç³»ç»Ÿå¼€å§‹æŠ¥é”™ï¼Œè¿ä¸ä¸Šæ•°æ®åº“
ä¸‹åˆ3:10ï¼šç´§æ€¥å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
ä¸‹åˆ3:11ï¼šç³»ç»Ÿæ¢å¤æ­£å¸¸

ç‰ˆæœ¬æ§åˆ¶çš„ä½œç”¨ï¼š
âœ… è®°å½•æ¯æ¬¡ä¿®æ”¹
âœ… çŸ¥é“è°æ”¹çš„ã€ä»€ä¹ˆæ—¶å€™æ”¹çš„
âœ… ä¸€é”®å›é€€åˆ°ä»»æ„å†å²ç‰ˆæœ¬
```

### 7.2 Nacosç‰ˆæœ¬ç®¡ç†


**ç‰ˆæœ¬è®°å½•æŸ¥çœ‹**ï¼š
```
1. Nacosæ§åˆ¶å° â†’ é…ç½®ç®¡ç† â†’ é…ç½®åˆ—è¡¨
2. ç‚¹å‡»é…ç½®çš„"å†å²ç‰ˆæœ¬"æŒ‰é’®
3. å¯ä»¥çœ‹åˆ°ï¼š
   - ç‰ˆæœ¬å·
   - ä¿®æ”¹æ—¶é—´
   - ä¿®æ”¹äºº
   - é…ç½®å†…å®¹å¯¹æ¯”
```

**ç‰ˆæœ¬å›é€€æ“ä½œ**ï¼š
```java
@Service
public class ConfigVersionService {
    
    @Autowired
    private NacosConfigManager configManager;
    
    public boolean rollback(String dataId, String group, String historyId) {
        try {
            ConfigService configService = configManager.getConfigService();
            
            // 1. è·å–å†å²ç‰ˆæœ¬å†…å®¹
            // Nacosæš‚ä¸æ”¯æŒAPIç›´æ¥å›é€€ï¼Œéœ€è¦å…ˆè·å–å†å²å†…å®¹
            String historyContent = getHistoryContent(dataId, group, historyId);
            
            // 2. é‡æ–°å‘å¸ƒå†å²å†…å®¹
            boolean success = configService.publishConfig(
                dataId, 
                group, 
                historyContent
            );
            
            System.out.println("å›é€€ç»“æœï¼š" + (success ? "æˆåŠŸ" : "å¤±è´¥"));
            return success;
            
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
}
```

### 7.3 Apolloç‰ˆæœ¬ç®¡ç†


**Apolloçš„ç‰ˆæœ¬åŠŸèƒ½æ›´å¼ºå¤§**ï¼š

```
ç‰ˆæœ¬å¯¹æ¯”ï¼š
  å½“å‰ç‰ˆæœ¬ vs å†å²ç‰ˆæœ¬
    â†“
  é«˜äº®æ˜¾ç¤ºå·®å¼‚
    â†“
  ç¡®è®¤åä¸€é”®å›é€€

ç‰ˆæœ¬ä¿¡æ¯åŒ…æ‹¬ï¼š
- å‘å¸ƒæ—¶é—´ï¼š2025-01-23 15:30:00
- å‘å¸ƒäººï¼šzhangsan
- å‘å¸ƒè¯´æ˜ï¼šç´§æ€¥ä¿®å¤æ•°æ®åº“é…ç½®
- å˜æ›´å†…å®¹ï¼š
  + db.url=jdbc:mysql://new-host:3306/db  (æ–°å¢)
  - db.url=jdbc:mysql://old-host:3306/db  (åˆ é™¤)
```

**APIå›é€€ç‰ˆæœ¬**ï¼š

```java
@RestController
@RequestMapping("/config/version")
public class VersionController {
    
    @Autowired
    private PortalRestClient apolloClient;
    
    @PostMapping("/rollback")
    public String rollback(@RequestParam String env,
                          @RequestParam String appId,
                          @RequestParam Long releaseId) {
        try {
            // è°ƒç”¨Apolloå›é€€æ¥å£
            apolloClient.rollback(env, appId, releaseId);
            return "å›é€€æˆåŠŸ";
        } catch (Exception e) {
            return "å›é€€å¤±è´¥ï¼š" + e.getMessage();
        }
    }
    
    @GetMapping("/history")
    public List<ReleaseHistory> getHistory(@RequestParam String appId) {
        // æŸ¥è¯¢å‘å¸ƒå†å²
        return apolloClient.getReleaseHistory(appId);
    }
}
```

---

## 8. ğŸ” é…ç½®å®‰å…¨ç®¡ç†


### 8.1 é…ç½®åŠ å¯†å­˜å‚¨


**ä¸ºä»€ä¹ˆè¦åŠ å¯†é…ç½®**ï¼š
```
æ•æ„Ÿä¿¡æ¯æ˜æ–‡å­˜å‚¨çš„é£é™©ï¼š
âŒ æ•°æ®åº“å¯†ç ï¼šroot/123456
âŒ APIå¯†é’¥ï¼šsk_live_xxxxxxxxxxxxxx
âŒ åŠ å¯†å¯†é’¥ï¼šAES_KEY_123456

é—®é¢˜ï¼š
- é…ç½®ä¸­å¿ƒè¢«æ”»å‡»ï¼Œå¯†ç æ³„éœ²
- è¿ç»´äººå‘˜çœ‹åˆ°æ‰€æœ‰å¯†ç 
- æ—¥å¿—ä¸­å¯èƒ½æ‰“å°æ•æ„Ÿä¿¡æ¯
```

**Nacosé…ç½®åŠ å¯†**ï¼š

```java
@Component
public class ConfigEncryptor {
    
    // ä½¿ç”¨JasyptåŠ å¯†å·¥å…·
    @Autowired
    private StringEncryptor encryptor;
    
    /**
     * åŠ å¯†é…ç½®
     */
    public String encrypt(String plainText) {
        return encryptor.encrypt(plainText);
    }
    
    /**
     * è§£å¯†é…ç½®
     */
    public String decrypt(String encryptedText) {
        return encryptor.decrypt(encryptedText);
    }
}

// é…ç½®æ–‡ä»¶ä¸­çš„åŠ å¯†å€¼
// åŸå§‹ï¼špassword: 123456
// åŠ å¯†åï¼špassword: ENC(xMjE3NzIwMTY1NQ==)
```

**Springé…ç½®åŠ å¯†ä¾èµ–**ï¼š

```xml
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.5</version>
</dependency>
```

**åŠ å¯†é…ç½®ä½¿ç”¨**ï¼š

```yaml
# application.yml
jasypt:
  encryptor:
    password: my-secret-key  # åŠ å¯†å¯†é’¥ï¼ˆå®é™…éƒ¨ç½²æ—¶ä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
    algorithm: PBEWithMD5AndDES

# ä½¿ç”¨åŠ å¯†å€¼
spring:
  datasource:
    password: ENC(xMjE3NzIwMTY1NQ==)  # ENC()åŒ…è£¹çš„æ˜¯åŠ å¯†åçš„å€¼
```

### 8.2 æƒé™æ§åˆ¶


**Nacosæƒé™é…ç½®**ï¼š

```yaml
# nacosé…ç½®æ–‡ä»¶ï¼šapplication.properties
nacos.core.auth.enabled=true                    # å¯ç”¨æƒé™
nacos.core.auth.server.identity.key=nacos       # èº«ä»½key
nacos.core.auth.server.identity.value=nacos     # èº«ä»½value

# è§’è‰²æƒé™é…ç½®
# 1. å¼€å‘äººå‘˜ï¼šåªè¯»æƒé™
# 2. è¿ç»´äººå‘˜ï¼šè¯»å†™æƒé™  
# 3. ç®¡ç†å‘˜ï¼šå…¨éƒ¨æƒé™
```

**Apolloæƒé™é…ç½®**ï¼š

```
Apolloæƒé™ä½“ç³»ï¼š

åº”ç”¨çº§åˆ«ï¼š
â”œâ”€â”€ Ownerï¼ˆæ‹¥æœ‰è€…ï¼‰ï¼šå…¨éƒ¨æƒé™
â”œâ”€â”€ Masterï¼ˆç®¡ç†å‘˜ï¼‰ï¼šå‘å¸ƒæƒé™
â””â”€â”€ Developerï¼ˆå¼€å‘è€…ï¼‰ï¼šç¼–è¾‘æƒé™

å‘½åç©ºé—´çº§åˆ«ï¼š
â”œâ”€â”€ ä¿®æ”¹æƒé™ï¼šå¯ä»¥ç¼–è¾‘é…ç½®
â”œâ”€â”€ å‘å¸ƒæƒé™ï¼šå¯ä»¥å‘å¸ƒé…ç½®
â””â”€â”€ æŸ¥çœ‹æƒé™ï¼šåªèƒ½æŸ¥çœ‹é…ç½®

ç¯å¢ƒéš”ç¦»ï¼š
- DEVç¯å¢ƒï¼šå¼€å‘äººå‘˜å¯ä¿®æ”¹
- TESTç¯å¢ƒï¼šæµ‹è¯•äººå‘˜å¯ä¿®æ”¹
- PRODç¯å¢ƒï¼šåªæœ‰è¿ç»´å¯ä¿®æ”¹
```

**ä»£ç ä¸­çš„æƒé™æ ¡éªŒ**ï¼š

```java
@Service
public class ConfigSecurityService {
    
    /**
     * ä¿®æ”¹é…ç½®å‰çš„æƒé™æ ¡éªŒ
     */
    public boolean checkPermission(String userId, String dataId, String operation) {
        
        // 1. è·å–ç”¨æˆ·è§’è‰²
        String role = getUserRole(userId);
        
        // 2. è·å–é…ç½®çš„æƒé™è¦æ±‚
        String requiredRole = getConfigPermission(dataId);
        
        // 3. æ ¡éªŒæƒé™
        if ("ADMIN".equals(role)) {
            return true;  // ç®¡ç†å‘˜å…¨éƒ¨æƒé™
        }
        
        if ("WRITE".equals(operation) && "OWNER".equals(role)) {
            return true;  // æ‹¥æœ‰è€…å¯å†™
        }
        
        if ("READ".equals(operation)) {
            return true;  // è¯»å–æƒé™å¼€æ”¾
        }
        
        return false;  // å…¶ä»–æƒ…å†µæ‹’ç»
    }
}
```

### 8.3 é…ç½®å®¡è®¡


**å®¡è®¡æ—¥å¿—å†…å®¹**ï¼š
```
æ“ä½œè®°å½•ï¼š
- æ—¶é—´ï¼š2025-01-23 15:30:00
- æ“ä½œäººï¼šzhangsan
- æ“ä½œç±»å‹ï¼šä¿®æ”¹é…ç½®
- é…ç½®é¡¹ï¼šdubbo.protocol.port
- æ—§å€¼ï¼š20880
- æ–°å€¼ï¼š20881
- IPåœ°å€ï¼š192.168.1.100
- æ“ä½œç»“æœï¼šæˆåŠŸ
```

**å®ç°å®¡è®¡åŠŸèƒ½**ï¼š

```java
@Aspect
@Component
public class ConfigAuditAspect {
    
    @Autowired
    private AuditLogRepository auditLogRepo;
    
    @Around("@annotation(ConfigChange)")
    public Object auditConfigChange(ProceedingJoinPoint pjp) throws Throwable {
        
        // 1. è®°å½•æ“ä½œå‰ä¿¡æ¯
        String oldValue = getCurrentConfigValue();
        String operator = getCurrentUser();
        
        // 2. æ‰§è¡Œé…ç½®ä¿®æ”¹
        Object result = pjp.proceed();
        
        // 3. è®°å½•æ“ä½œåä¿¡æ¯
        String newValue = getCurrentConfigValue();
        
        // 4. ä¿å­˜å®¡è®¡æ—¥å¿—
        AuditLog log = AuditLog.builder()
            .operator(operator)
            .oldValue(oldValue)
            .newValue(newValue)
            .operateTime(LocalDateTime.now())
            .build();
        
        auditLogRepo.save(log);
        
        return result;
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 é…ç½®ä¸­å¿ƒå¿…çŸ¥å¿…ä¼š


```
ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼š
- é…ç½®ä¸­å¿ƒ = ç»Ÿä¸€ç®¡ç†é…ç½® + åŠ¨æ€ä¸‹å‘
- Nacos = é…ç½®ä¸­å¿ƒ + æœåŠ¡æ³¨å†Œï¼ˆäºŒåˆä¸€ï¼‰
- Apollo = ä¼ä¸šçº§é…ç½®ä¸­å¿ƒï¼ˆåŠŸèƒ½æœ€å…¨ï¼‰

ğŸ”„ å·¥ä½œåŸç†ï¼š
- é•¿è½®è¯¢æœºåˆ¶ï¼šå®æ—¶è·å–é…ç½®å˜åŒ–
- é…ç½®ç›‘å¬ï¼šè‡ªåŠ¨å“åº”é…ç½®æ›´æ–°
- çƒ­æ›´æ–°ï¼š@RefreshScopeå®ç°ä¸é‡å¯æ›´æ–°

ğŸ›¡ï¸ æ²»ç†èƒ½åŠ›ï¼š
- è·¯ç”±è§„åˆ™ï¼šç°åº¦å‘å¸ƒã€æµé‡æ§åˆ¶
- é™æµè§„åˆ™ï¼šä¿æŠ¤æœåŠ¡ç¨³å®šæ€§
- ç‰ˆæœ¬ç®¡ç†ï¼šé…ç½®å›é€€ã€å†å²è¿½æº¯

ğŸ” å®‰å…¨ç®¡ç†ï¼š
- é…ç½®åŠ å¯†ï¼šæ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- æƒé™æ§åˆ¶ï¼šä¸åŒè§’è‰²ä¸åŒæƒé™
- å®¡è®¡æ—¥å¿—ï¼šæ“ä½œå¯è¿½æº¯
```

### 9.2 Nacos vs Apollo é€‰å‹


| å¯¹æ¯”é¡¹ | **Nacos** | **Apollo** |
|--------|-----------|------------|
| ä¸Šæ‰‹éš¾åº¦ | â­â­ ç®€å• | â­â­â­ ä¸­ç­‰ |
| åŠŸèƒ½å®Œå–„åº¦ | â­â­â­ å¤Ÿç”¨ | â­â­â­â­â­ å®Œå–„ |
| ç•Œé¢å‹å¥½åº¦ | â­â­â­â­ å‹å¥½ | â­â­â­â­â­ å¾ˆå¥½ |
| ç¤¾åŒºæ´»è·ƒåº¦ | â­â­â­â­â­ å¾ˆé«˜ | â­â­â­â­ é«˜ |
| ä¼ä¸šçº§ç‰¹æ€§ | â­â­â­ åŸºç¡€ | â­â­â­â­â­ å®Œå–„ |
| é€‚ç”¨åœºæ™¯ | âœ… ä¸­å°å›¢é˜Ÿ | âœ… å¤§å‹ä¼ä¸š |

### 9.3 æœ€ä½³å®è·µå»ºè®®


**é…ç½®ç®¡ç†è§„èŒƒ**ï¼š
```
âœ… DOï¼ˆåº”è¯¥åšï¼‰ï¼š
- æŒ‰ç¯å¢ƒéš”ç¦»é…ç½®ï¼ˆdev/test/prodï¼‰
- æ•æ„Ÿä¿¡æ¯å¿…é¡»åŠ å¯†å­˜å‚¨
- é…ç½®ä¿®æ”¹å¿…é¡»å¡«å†™å˜æ›´è¯´æ˜
- é‡è¦é…ç½®ä¿®æ”¹å‰å…ˆå¤‡ä»½
- å®šæœŸæ¸…ç†æ— ç”¨é…ç½®

âŒ DON'Tï¼ˆä¸è¦åšï¼‰ï¼š
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é…ç½®
- ä¸è¦æŠŠå¯†ç æ˜æ–‡å†™åœ¨é…ç½®ä¸­
- ä¸è¦ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒæµ‹è¯•é…ç½®
- ä¸è¦è·³è¿‡å®¡æ‰¹æµç¨‹ä¿®æ”¹é…ç½®
- ä¸è¦å¿˜è®°é…ç½®çš„ç‰ˆæœ¬ç®¡ç†
```

**é…ç½®ä¼˜å…ˆçº§**ï¼š
```
é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. å‘½ä»¤è¡Œå‚æ•°         ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. é…ç½®ä¸­å¿ƒåŠ¨æ€é…ç½®   ï¼ˆæ¨èä½¿ç”¨ï¼‰
3. application.yml    ï¼ˆæœ¬åœ°é…ç½®ï¼‰
4. bootstrap.yml      ï¼ˆå¯åŠ¨é…ç½®ï¼‰
5. é»˜è®¤å€¼             ï¼ˆå…œåº•é…ç½®ï¼‰

å®é™…åº”ç”¨ï¼š
- æœ¬åœ°å¼€å‘ï¼šç”¨application.yml
- æµ‹è¯•/ç”Ÿäº§ï¼šç”¨é…ç½®ä¸­å¿ƒ
- ç´§æ€¥è°ƒæ•´ï¼šç”¨å‘½ä»¤è¡Œå‚æ•°
```

### 9.4 å¸¸è§é—®é¢˜è§£å†³


> â“ **é—®é¢˜1ï¼šé…ç½®æ›´æ–°äº†ï¼Œç¨‹åºæ²¡ç”Ÿæ•ˆï¼Ÿ**  
> ğŸ’¡ æ£€æŸ¥æ¸…å•ï¼š
> - [ ] æ˜¯å¦æ·»åŠ äº†@RefreshScopeæ³¨è§£
> - [ ] æ˜¯å¦å¯ç”¨äº†åŠ¨æ€åˆ·æ–°ï¼ˆrefresh-enabled: trueï¼‰
> - [ ] é…ç½®ä¸­å¿ƒçš„é…ç½®æ˜¯å¦å·²å‘å¸ƒ
> - [ ] ç½‘ç»œæ˜¯å¦æ­£å¸¸è¿æ¥é…ç½®ä¸­å¿ƒ

> â“ **é—®é¢˜2ï¼šå¦‚ä½•å¿«é€Ÿå®šä½é…ç½®é—®é¢˜ï¼Ÿ**  
> ğŸ’¡ æ’æŸ¥æ­¥éª¤ï¼š
> ```
> 1. æŸ¥çœ‹é…ç½®ä¸­å¿ƒï¼šé…ç½®æ˜¯å¦æ­£ç¡®
> 2. æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—ï¼šæ˜¯å¦æˆåŠŸæ‹‰å–é…ç½®
> 3. ä½¿ç”¨Actuatorç«¯ç‚¹ï¼š/actuator/env æŸ¥çœ‹å½“å‰é…ç½®
> 4. å¯¹æ¯”é¢„æœŸå€¼ï¼šå®é™…å€¼æ˜¯å¦ä¸é¢„æœŸä¸€è‡´
> ```

> â“ **é—®é¢˜3ï¼šé…ç½®ä¸­å¿ƒæŒ‚äº†æ€ä¹ˆåŠï¼Ÿ**  
> ğŸ’¡ å®¹ç¾æ–¹æ¡ˆï¼š
> ```
> 1. æœ¬åœ°ç¼“å­˜ï¼šNacoså®¢æˆ·ç«¯ä¼šç¼“å­˜é…ç½®åˆ°æœ¬åœ°
> 2. é™çº§ç­–ç•¥ï¼šé…ç½®ä¸­å¿ƒä¸å¯ç”¨æ—¶ï¼Œä½¿ç”¨æœ¬åœ°é…ç½®
> 3. é«˜å¯ç”¨éƒ¨ç½²ï¼šé…ç½®ä¸­å¿ƒé›†ç¾¤éƒ¨ç½²ï¼ˆè‡³å°‘3ä¸ªèŠ‚ç‚¹ï¼‰
> 4. ç›‘æ§å‘Šè­¦ï¼šåŠæ—¶å‘ç°é…ç½®ä¸­å¿ƒå¼‚å¸¸
> ```

**è®°å¿†å£è¯€**ï¼š
```
é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ï¼Œ
åŠ¨æ€ä¸‹å‘ä¸é‡å¯ã€‚
ç‰ˆæœ¬ç®¡ç†å¯å›é€€ï¼Œ
æƒé™åŠ å¯†ä¿å®‰å…¨ã€‚
Nacosç®€å•ä¸Šæ‰‹å¿«ï¼Œ
Apolloä¼ä¸šåŠŸèƒ½å…¨ã€‚
é•¿è½®è¯¢æœºåˆ¶å®æ—¶å“ï¼Œ
çƒ­æ›´æ–°æ³¨è§£è¦è®°ç‰¢ã€‚
```