---
title: 20ã€Dubboå¼‚æ­¥è°ƒç”¨ä¸å¹¶å‘æ§åˆ¶
---
## ğŸ“š ç›®å½•

1. [å¼‚æ­¥è°ƒç”¨æœºåˆ¶æ·±åº¦è§£æ](#1-å¼‚æ­¥è°ƒç”¨æœºåˆ¶æ·±åº¦è§£æ)
2. [Futureä¸CompletableFuture](#2-Futureä¸CompletableFuture)
3. [å›è°ƒä¸Promiseæ¨¡å¼](#3-å›è°ƒä¸Promiseæ¨¡å¼)
4. [å“åº”å¼ç¼–ç¨‹å®è·µ](#4-å“åº”å¼ç¼–ç¨‹å®è·µ)
5. [å¹¶å‘æ§åˆ¶ç­–ç•¥](#5-å¹¶å‘æ§åˆ¶ç­–ç•¥)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ å¼‚æ­¥è°ƒç”¨æœºåˆ¶æ·±åº¦è§£æ


### 1.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥è°ƒç”¨ï¼Ÿ


**é€šä¿—ç†è§£**ï¼š
```
åŒæ­¥è°ƒç”¨ = æ’é˜Ÿæ‰“é¥­
ä½ ç«™åœ¨çª—å£ï¼Œå¿…é¡»ç­‰å¸ˆå‚…æŠŠé¥­æ‰“å¥½ï¼Œæ‰èƒ½ç¦»å¼€
æœŸé—´ä½ ä»€ä¹ˆéƒ½ä¸èƒ½åšï¼Œåªèƒ½å¹²ç­‰ç€

å¼‚æ­¥è°ƒç”¨ = å–å·ç­‰ä½
ä½ æ‹¿åˆ°å·ç åå¯ä»¥å»é€›è¡—ã€ç©æ‰‹æœº
ç­‰å«åˆ°ä½ çš„å·å†å›æ¥å–é¥­
æœŸé—´ä½ å¯ä»¥åšå¾ˆå¤šå…¶ä»–äº‹æƒ…
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
> **å¼‚æ­¥è°ƒç”¨**ï¼šè°ƒç”¨æ–¹å‘èµ·è¯·æ±‚åä¸ç­‰å¾…ç»“æœï¼Œç»§ç»­æ‰§è¡Œåç»­é€»è¾‘ï¼Œç»“æœé€šè¿‡å›è°ƒæˆ–Futureè·å–

**ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ**
- âœ… **æå‡å“åº”é€Ÿåº¦**ï¼šä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
- âœ… **æé«˜ååé‡**ï¼šä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚
- âœ… **èµ„æºåˆ©ç”¨ç‡é«˜**ï¼šçº¿ç¨‹ä¸ç”¨å‚»ç­‰ï¼Œå¯ä»¥å¹²å…¶ä»–äº‹

### 1.2 Dubboå¼‚æ­¥è°ƒç”¨çš„æ¼”è¿›


**ğŸ“Š å‘å±•å†ç¨‹å¯¹æ¯”**

| ç‰ˆæœ¬é˜¶æ®µ | **å®ç°æ–¹å¼** | **ä¼˜åŠ¿** | **å±€é™æ€§** |
|---------|------------|---------|----------|
| **æ—©æœŸç‰ˆæœ¬** | `RpcContext.getContext().getFuture()` | `ç®€å•ç›´æ¥` | `APIä¸å‹å¥½ï¼Œéš¾ä»¥ç»„åˆ` |
| **2.7.0ç‰ˆæœ¬** | `CompletableFutureåŸç”Ÿæ”¯æŒ` | `é“¾å¼è°ƒç”¨ï¼Œæ˜“ç»„åˆ` | `éœ€è¦JDK8+` |
| **3.0ç‰ˆæœ¬** | `å…¨é¢å“åº”å¼ï¼Œæ”¯æŒReactive` | `å®Œå…¨éé˜»å¡ï¼Œæ€§èƒ½æœ€ä¼˜` | `å­¦ä¹ æˆæœ¬é«˜` |

### 1.3 å¼‚æ­¥è°ƒç”¨çš„å·¥ä½œåŸç†


**ğŸ”§ åº•å±‚æœºåˆ¶å›¾ç¤º**
```
è°ƒç”¨æ–¹                     ç½‘ç»œ                     æœåŠ¡ç«¯
  |                         |                         |
  |--[1]å‘èµ·å¼‚æ­¥è¯·æ±‚-------->|                         |
  |   (ä¸é˜»å¡ï¼Œç«‹å³è¿”å›)     |                         |
  |                         |--[2]è½¬å‘è¯·æ±‚----------->|
  |--[3]ç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘---->|                         |
  |                         |                         |--[4]å¤„ç†è¯·æ±‚
  |                         |                         |
  |                         |<--[5]è¿”å›å“åº”-----------|
  |<--[6]è§¦å‘å›è°ƒ/Future-----|                         |
  |   (è·å–ç»“æœ)            |                         |
```

**æ ¸å¿ƒç†è§£**ï¼š
- è¯·æ±‚å‘å‡ºæ—¶åªæ˜¯"ç™»è®°"äº†ä¸€ä¸ªä»»åŠ¡
- ä¸»çº¿ç¨‹ç»§ç»­å¾€ä¸‹èµ°ï¼Œä¸å‚»ç­‰
- ç»“æœå›æ¥åé€šè¿‡"é€šçŸ¥æœºåˆ¶"å‘Šè¯‰ä½ 

---

## 2. ğŸ¯ Futureä¸CompletableFuture


### 2.1 ä¼ ç»ŸFutureæ¨¡å¼


**ğŸ”¸ ä»€ä¹ˆæ˜¯Futureï¼Ÿ**

> **Future**ï¼šç›¸å½“äº"æè´§åˆ¸"ï¼Œç°åœ¨æ‹¿ç€åˆ¸ï¼Œå°†æ¥å‡­åˆ¸æè´§

**åŸºç¡€ä½¿ç”¨ç¤ºä¾‹**
```java
// æœåŠ¡æ¥å£å®šä¹‰ï¼ˆæ³¨æ„è¿”å›å€¼æ˜¯CompletableFutureï¼‰
public interface UserService {
    CompletableFuture<User> getUserAsync(Long id);
}

// æ¶ˆè´¹ç«¯è°ƒç”¨
UserService userService = ...; // Dubboæ³¨å…¥
CompletableFuture<User> future = userService.getUserAsync(1L);

// æ–¹å¼1ï¼šé˜»å¡ç­‰å¾…ç»“æœï¼ˆå¤±å»äº†å¼‚æ­¥çš„æ„ä¹‰ï¼‰
User user = future.get(); // ä¸æ¨èï¼

// æ–¹å¼2ï¼šéé˜»å¡è·å–ï¼ˆæ¨èï¼‰
future.whenComplete((user, error) -> {
    if (error != null) {
        System.out.println("è°ƒç”¨å¤±è´¥ï¼š" + error.getMessage());
    } else {
        System.out.println("è·å–ç”¨æˆ·ï¼š" + user.getName());
    }
});
```

**âš ï¸ æ˜“é”™é‡ç‚¹**
> å¾ˆå¤šäººç”¨äº†Futureä½†è¿˜æ˜¯è°ƒç”¨`get()`é˜»å¡ç­‰å¾…ï¼Œè¿™å°±å¤±å»å¼‚æ­¥çš„æ„ä¹‰äº†ï¼
> **æ­£ç¡®åšæ³•**ï¼šç”¨`whenComplete()`ã€`thenApply()`ç­‰éé˜»å¡æ–¹æ³•

### 2.2 CompletableFutureå¼ºå¤§ä¹‹å¤„


**ğŸ”¸ é“¾å¼æ“ä½œçš„é­…åŠ›**

```java
// åœºæ™¯ï¼šæŸ¥è¯¢ç”¨æˆ· â†’ è·å–è®¢å• â†’ è®¡ç®—æ€»é‡‘é¢
CompletableFuture<User> userFuture = userService.getUserAsync(1L);

CompletableFuture<BigDecimal> totalAmountFuture = userFuture
    // ç”¨æˆ·ä¿¡æ¯è·å–åï¼Œå¼‚æ­¥æŸ¥è¯¢è®¢å•
    .thenCompose(user -> orderService.getOrdersAsync(user.getId()))
    // è®¢å•åˆ—è¡¨è·å–åï¼Œè®¡ç®—æ€»é‡‘é¢
    .thenApply(orders -> {
        return orders.stream()
            .map(Order::getAmount)
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    })
    // å¼‚å¸¸å¤„ç†
    .exceptionally(error -> {
        log.error("æŸ¥è¯¢å¤±è´¥", error);
        return BigDecimal.ZERO;
    });

// æœ€ç»ˆç»“æœå¤„ç†
totalAmountFuture.thenAccept(total -> {
    System.out.println("ç”¨æˆ·æ€»æ¶ˆè´¹ï¼š" + total);
});
```

**ğŸ’¡ å…³é”®æ“ä½œç¬¦å¯¹æ¯”**

| æ“ä½œç¬¦ | **ä½œç”¨** | **ä½¿ç”¨åœºæ™¯** |
|-------|---------|------------|
| `thenApply()` | `è½¬æ¢ç»“æœ` | `User â†’ UserDTO` |
| `thenCompose()` | `å±•å¹³åµŒå¥—Future` | `User â†’ Future<Order>` |
| `thenAccept()` | `æ¶ˆè´¹ç»“æœï¼Œæ— è¿”å›` | `æ‰“å°æ—¥å¿—ã€å‘æ¶ˆæ¯` |
| `whenComplete()` | `è·å–ç»“æœå’Œå¼‚å¸¸` | `ç»Ÿä¸€å¤„ç†æˆåŠŸ/å¤±è´¥` |
| `exceptionally()` | `å¼‚å¸¸é™çº§å¤„ç†` | `è¿”å›é»˜è®¤å€¼` |

### 2.3 å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»„åˆ


**ğŸ”¸ å¹¶è¡ŒæŸ¥è¯¢åœºæ™¯**

```java
// åœºæ™¯ï¼šåŒæ—¶æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€è®¢å•ä¿¡æ¯ã€ç§¯åˆ†ä¿¡æ¯
CompletableFuture<User> userFuture = userService.getUserAsync(1L);
CompletableFuture<List<Order>> orderFuture = orderService.getOrdersAsync(1L);
CompletableFuture<Integer> pointFuture = pointService.getPointsAsync(1L);

// ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆ
CompletableFuture<Void> allFuture = CompletableFuture.allOf(
    userFuture, orderFuture, pointFuture
);

// æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œç»„åˆç»“æœ
allFuture.thenRun(() -> {
    User user = userFuture.join();
    List<Order> orders = orderFuture.join();
    Integer points = pointFuture.join();
    
    // ç»„åˆä¸šåŠ¡é€»è¾‘
    UserDetailVO vo = new UserDetailVO(user, orders, points);
    System.out.println("ç”¨æˆ·è¯¦æƒ…ï¼š" + vo);
});
```

**è®°å¿†æŠ€å·§**ï¼š
- `allOf()`ï¼šæ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆæ‰ç»§ç»­ï¼ˆANDé€»è¾‘ï¼‰
- `anyOf()`ï¼šä»»æ„ä¸€ä¸ªå®Œæˆå°±ç»§ç»­ï¼ˆORé€»è¾‘ï¼‰

---

## 3. ğŸ“ å›è°ƒä¸Promiseæ¨¡å¼


### 3.1 å›è°ƒå‡½æ•°æœºåˆ¶


**ğŸ”¸ ä»€ä¹ˆæ˜¯å›è°ƒï¼Ÿ**

> **å›è°ƒå‡½æ•°**ï¼šå°±åƒ"å¿«é€’åˆ°äº†ç»™ä½ æ‰“ç”µè¯"ï¼Œä½ ç•™ä¸ªç”µè¯å·ç ï¼Œå¿«é€’åˆ°äº†å¿«é€’å‘˜ä¸»åŠ¨é€šçŸ¥ä½ 

**åŸºç¡€å›è°ƒç¤ºä¾‹**
```java
// Dubboæ”¯æŒçš„å›è°ƒæ–¹å¼
@DubboReference(async = true)
private UserService userService;

public void asyncCallWithCallback() {
    // å‘èµ·å¼‚æ­¥è°ƒç”¨
    userService.getUser(1L);
    
    // è·å–Futureå¹¶è®¾ç½®å›è°ƒ
    CompletableFuture<User> future = RpcContext.getServiceContext()
        .getCompletableFuture();
    
    future.whenComplete((user, error) -> {
        if (error != null) {
            System.out.println("è°ƒç”¨å¤±è´¥ï¼š" + error.getMessage());
        } else {
            System.out.println("å›è°ƒè·å–ç”¨æˆ·ï¼š" + user.getName());
        }
    });
    
    // ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä¸ç­‰å¾…ç»“æœ
    System.out.println("ç»§ç»­æ‰§è¡Œå…¶ä»–ä¸šåŠ¡...");
}
```

### 3.2 Promiseæ¨¡å¼æ·±åº¦ç†è§£


**ğŸ”¸ Promise vs Future**

```
Future = æè´§åˆ¸ï¼ˆè¢«åŠ¨ç­‰å¾…ï¼‰
ä½ æ‹¿ç€åˆ¸ï¼Œå®šæœŸå»é—®"è´§åˆ°äº†å—ï¼Ÿ"

Promise = æ‰¿è¯ºä¹¦ï¼ˆä¸»åŠ¨é€šçŸ¥ï¼‰
å•†å®¶æ‰¿è¯º"è´§åˆ°äº†ä¸»åŠ¨é€šçŸ¥ä½ "
```

**å®è·µåº”ç”¨**
```java
// è‡ªå®šä¹‰PromiseåŒ…è£…
public class PromiseWrapper<T> {
    private final CompletableFuture<T> future;
    
    public PromiseWrapper() {
        this.future = new CompletableFuture<>();
    }
    
    // æˆåŠŸæ—¶è°ƒç”¨
    public void resolve(T value) {
        future.complete(value);
    }
    
    // å¤±è´¥æ—¶è°ƒç”¨
    public void reject(Throwable error) {
        future.completeExceptionally(error);
    }
    
    // æ³¨å†ŒæˆåŠŸå›è°ƒ
    public PromiseWrapper<T> then(Consumer<T> onSuccess) {
        future.thenAccept(onSuccess);
        return this;
    }
    
    // æ³¨å†Œå¤±è´¥å›è°ƒ
    public PromiseWrapper<T> catchError(Consumer<Throwable> onError) {
        future.exceptionally(error -> {
            onError.accept(error);
            return null;
        });
        return this;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
PromiseWrapper<User> promise = new PromiseWrapper<>();

promise.then(user -> {
    System.out.println("æˆåŠŸï¼š" + user.getName());
}).catchError(error -> {
    System.out.println("å¤±è´¥ï¼š" + error.getMessage());
});

// å¼‚æ­¥æ“ä½œå®Œæˆå
promise.resolve(userFromDb);
```

**ğŸ§  è®°å¿†é”šç‚¹**ï¼š
Promise = "æˆ‘ä¿è¯å®Œæˆåé€šçŸ¥ä½ "ï¼Œä¸»åŠ¨æ€§æ›´å¼º

---

## 4. ğŸŒŠ å“åº”å¼ç¼–ç¨‹å®è·µ


### 4.1 ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹ï¼Ÿ


**é€šä¿—ç†è§£**ï¼š
```
ä¼ ç»Ÿç¼–ç¨‹ = æ°´é¾™å¤´æ¥æ°´
ä½ æ‰“å¼€æ°´é¾™å¤´ï¼ˆå‘è¯·æ±‚ï¼‰ï¼Œç­‰æ°´æµå‡ºæ¥ï¼ˆé˜»å¡ç­‰ç»“æœï¼‰

å“åº”å¼ç¼–ç¨‹ = è®¢é˜…æ°´æµ
ä½ è®¢é˜…æ°´æµï¼ˆæ³¨å†Œç›‘å¬ï¼‰ï¼Œæœ‰æ°´å°±è‡ªåŠ¨æµåˆ°ä½ æ¡¶é‡Œï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**
- **éé˜»å¡ I/O**ï¼šçº¿ç¨‹ä¸å‚»ç­‰ï¼Œæ•ˆç‡é«˜
- **æ•°æ®æµé©±åŠ¨**ï¼šæ•°æ®æ¥äº†è‡ªåŠ¨å¤„ç†
- **èƒŒå‹æ”¯æŒ**ï¼šæ¶ˆè´¹æ…¢äº†å¯ä»¥"å–Šåœ"

### 4.2 Dubbo3çš„å“åº”å¼æ”¯æŒ


**é…ç½®å“åº”å¼è°ƒç”¨**
```java
// 1. æœåŠ¡æ¥å£å®šä¹‰ï¼ˆä½¿ç”¨Reactorç±»å‹ï¼‰
public interface ReactiveUserService {
    Mono<User> getUser(Long id);           // å•ä¸ªç»“æœ
    Flux<Order> getOrders(Long userId);    // å¤šä¸ªç»“æœæµ
}

// 2. æ¶ˆè´¹ç«¯è°ƒç”¨
@DubboReference
private ReactiveUserService userService;

public void reactiveCall() {
    // å•ä¸ªç»“æœè®¢é˜…
    userService.getUser(1L)
        .subscribe(
            user -> System.out.println("ç”¨æˆ·ï¼š" + user),
            error -> System.err.println("é”™è¯¯ï¼š" + error)
        );
    
    // æ•°æ®æµè®¢é˜…
    userService.getOrders(1L)
        .filter(order -> order.getAmount().compareTo(BigDecimal.ZERO) > 0)
        .map(Order::getAmount)
        .reduce(BigDecimal.ZERO, BigDecimal::add)
        .subscribe(total -> System.out.println("æ€»é‡‘é¢ï¼š" + total));
}
```

**ğŸ“Š å“åº”å¼ vs ä¼ ç»Ÿå¼‚æ­¥å¯¹æ¯”**

| ç‰¹æ€§ | **CompletableFuture** | **Reactor (Mono/Flux)** |
|-----|---------------------|----------------------|
| **æ•°æ®é‡** | `å•ä¸ªç»“æœ` | `æ”¯æŒæµå¼æ•°æ®` |
| **èƒŒå‹** | `ä¸æ”¯æŒ` | `æ”¯æŒ` |
| **æ“ä½œç¬¦** | `æœ‰é™` | `ä¸°å¯Œï¼ˆ100+ï¼‰` |
| **å­¦ä¹ æˆæœ¬** | `ä½` | `ä¸­é«˜` |

### 4.3 å“åº”å¼çš„å®æˆ˜åœºæ™¯


**ğŸ¬ åœºæ™¯ï¼šå®æ—¶æ•°æ®æ¨é€**

```java
// åœºæ™¯ï¼šç›‘æ§ç³»ç»Ÿå®æ—¶æ¨é€æœåŠ¡å™¨çŠ¶æ€
public interface MonitorService {
    Flux<ServerStatus> streamServerStatus();
}

// æ¶ˆè´¹ç«¯å®ç°
@DubboReference
private MonitorService monitorService;

public void monitorServers() {
    monitorService.streamServerStatus()
        // åªå…³å¿ƒCPUè¶…è¿‡80%çš„æœåŠ¡å™¨
        .filter(status -> status.getCpuUsage() > 80)
        // é—´éš”1ç§’é‡‡æ ·ä¸€æ¬¡ï¼ˆé¿å…å¤ªé¢‘ç¹ï¼‰
        .sample(Duration.ofSeconds(1))
        // è®¢é˜…å¤„ç†
        .subscribe(status -> {
            // å‘é€å‘Šè­¦
            alertService.sendAlert("æœåŠ¡å™¨CPUè¿‡é«˜ï¼š" + status.getServerName());
        });
}
```

**ğŸ’¡ å“åº”å¼ä¼˜åŠ¿**ï¼š
- å¤©ç„¶æ”¯æŒæ•°æ®æµ
- æ“ä½œç¬¦ä¸°å¯Œï¼Œæ˜“äºç»„åˆ
- è‡ªåŠ¨å¤„ç†èƒŒå‹é—®é¢˜

---

## 5. ğŸ›¡ï¸ å¹¶å‘æ§åˆ¶ç­–ç•¥


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘æ§åˆ¶ï¼Ÿ


**é—®é¢˜åœºæ™¯**ï¼š
```
æ²¡æœ‰å¹¶å‘æ§åˆ¶çš„åæœï¼š

åœºæ™¯1ï¼šç§’æ€æ´»åŠ¨
1ä¸‡ç”¨æˆ·åŒæ—¶æŠ¢è´­ â†’ 10ä¸‡ä¸ªå¹¶å‘è¯·æ±‚æ‰“åˆ°åç«¯
â†’ æ•°æ®åº“è¿æ¥æ± è¢«æ‰“æ»¡ â†’ ç³»ç»Ÿå´©æºƒ

åœºæ™¯2ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£
ç¬¬ä¸‰æ–¹é™åˆ¶1000 QPS â†’ æˆ‘ä»¬å‘é€2000 QPS
â†’ è¢«é™æµï¼Œå¤§é‡è¯·æ±‚å¤±è´¥
```

**ğŸ”¸ æ ¸å¿ƒç›®æ ‡**
- ä¿æŠ¤ç³»ç»Ÿèµ„æºä¸è¢«è€—å°½
- é¿å…é›ªå´©æ•ˆåº”
- æä¾›é™çº§èƒ½åŠ›

### 5.2 çº¿ç¨‹æ± é…ç½®ä¼˜åŒ–


**Dubboçº¿ç¨‹æ¨¡å‹**
```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
   |                        |
   |----è¯·æ±‚1------>  [IOçº¿ç¨‹æ± ] -----> [ä¸šåŠ¡çº¿ç¨‹æ± ]
   |----è¯·æ±‚2------>  (æ¥æ”¶è¯·æ±‚)        (å¤„ç†ä¸šåŠ¡)
   |----è¯·æ±‚3------>  
   
IOçº¿ç¨‹ï¼šè´Ÿè´£ç½‘ç»œæ”¶å‘ï¼ˆå¿«é€Ÿå“åº”ï¼‰
ä¸šåŠ¡çº¿ç¨‹ï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼ˆå¯èƒ½è€—æ—¶ï¼‰
```

**çº¿ç¨‹æ± é…ç½®ç¤ºä¾‹**
```java
// application.yml é…ç½®
dubbo:
  provider:
    # ä¸šåŠ¡çº¿ç¨‹æ± é…ç½®
    threads: 200              # æ ¸å¿ƒçº¿ç¨‹æ•°
    queues: 0                 # é˜Ÿåˆ—é•¿åº¦ï¼ˆ0è¡¨ç¤ºä¸æ’é˜Ÿï¼‰
    threadpool: cached        # çº¿ç¨‹æ± ç±»å‹
  
  consumer:
    # æ¶ˆè´¹ç«¯çº¿ç¨‹é…ç½®
    connections: 10           # æ¯ä¸ªæœåŠ¡çš„è¿æ¥æ•°
    timeout: 3000            # è°ƒç”¨è¶…æ—¶æ—¶é—´

# ä»£ç æ–¹å¼é…ç½®
@DubboService(
    timeout = 3000,
    threads = 100,
    threadpool = "fixed"
)
public class UserServiceImpl implements UserService {
    // ...
}
```

**ğŸ“Œ çº¿ç¨‹æ± ç±»å‹é€‰æ‹©**

| ç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|-----|---------|------------|
| `fixed` | `å›ºå®šå¤§å°ï¼Œä»»åŠ¡æ’é˜Ÿ` | `ä»»åŠ¡è€—æ—¶ç¨³å®š` |
| `cached` | `æŒ‰éœ€åˆ›å»ºï¼Œç©ºé—²å›æ”¶` | `ä»»åŠ¡è€—æ—¶æ³¢åŠ¨å¤§` |
| `limited` | `å›ºå®šå¤§å°ï¼Œæ‹’ç»æ’é˜Ÿ` | `å¿«é€Ÿå¤±è´¥åœºæ™¯` |

### 5.3 å¹¶å‘é™æµç­–ç•¥


**ğŸ”¸ Dubboå†…ç½®é™æµ**

```java
// æ–¹å¼1ï¼šæœåŠ¡ç«¯é™æµï¼ˆä¿æŠ¤è‡ªå·±ï¼‰
@DubboService(
    executes = 100,          // æœ€å¤š100ä¸ªå¹¶å‘æ‰§è¡Œ
    actives = 50             // æ¯ä¸ªå®¢æˆ·ç«¯æœ€å¤š50ä¸ªå¹¶å‘
)
public class OrderServiceImpl implements OrderService {
    // è¶…è¿‡é™åˆ¶çš„è¯·æ±‚ä¼šç­‰å¾…æˆ–æ‹’ç»
}

// æ–¹å¼2ï¼šæ¶ˆè´¹ç«¯é™æµï¼ˆä¿æŠ¤æœåŠ¡ç«¯ï¼‰
@DubboReference(
    actives = 10,            // æœ€å¤š10ä¸ªå¹¶å‘è¯·æ±‚
    timeout = 5000           // è¶…æ—¶æ—¶é—´
)
private UserService userService;
```

**å·¥ä½œæœºåˆ¶å›¾ç¤º**
```
å®¢æˆ·ç«¯å‘èµ·100ä¸ªå¹¶å‘è¯·æ±‚
         â†“
[actives=10 é™æµ]
         â†“
åªæœ‰10ä¸ªè¯·æ±‚é€šè¿‡ï¼Œå…¶ä»–90ä¸ªç­‰å¾…
         â†“
æ‰§è¡Œå®Œæˆåï¼Œå†å…è®¸åç»­è¯·æ±‚é€šè¿‡
```

### 5.4 æœåŠ¡éš”ç¦»ä¸ç†”æ–­é™çº§


**ğŸ”¸ éš”ç¦»ç­–ç•¥**

```java
// çº¿ç¨‹æ± éš”ç¦»ï¼ˆæ¨èï¼‰
@DubboReference(
    protocol = "dubbo",
    threadpool = "isolated_user_service",  // ç‹¬ç«‹çº¿ç¨‹æ± 
    threads = 20
)
private UserService userService;

@DubboReference(
    protocol = "dubbo", 
    threadpool = "isolated_order_service", // å¦ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹æ± 
    threads = 30
)
private OrderService orderService;
```

**å¥½å¤„**ï¼š
- UserServiceæ•…éšœä¸å½±å“OrderService
- èµ„æºéš”ç¦»ï¼Œäº’ä¸å¹²æ‰°

**ğŸ”¸ ç†”æ–­é™çº§å®ç°**

```java
// é›†æˆSentinelå®ç°ç†”æ–­
@DubboReference
private UserService userService;

@SentinelResource(
    value = "getUserInfo",
    blockHandler = "handleBlock",      // é™æµ/ç†”æ–­å¤„ç†
    fallback = "handleFallback"        // å¼‚å¸¸é™çº§å¤„ç†
)
public User getUserInfo(Long id) {
    return userService.getUser(id);
}

// é™æµ/ç†”æ–­æ—¶çš„å¤„ç†
public User handleBlock(Long id, BlockException ex) {
    log.warn("è§¦å‘é™æµ/ç†”æ–­ï¼ŒuserId={}", id);
    return getDefaultUser();
}

// å¼‚å¸¸æ—¶çš„é™çº§å¤„ç†
public User handleFallback(Long id, Throwable ex) {
    log.error("è°ƒç”¨å¼‚å¸¸é™çº§ï¼ŒuserId={}", id, ex);
    return getDefaultUser();
}

private User getDefaultUser() {
    User user = new User();
    user.setName("é»˜è®¤ç”¨æˆ·");
    return user;
}
```

**ğŸ§ª ç†”æ–­çŠ¶æ€è½¬æ¢**
```
æ­£å¸¸çŠ¶æ€ï¼ˆClosedï¼‰
    â†“ ï¼ˆé”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼ï¼‰
æ‰“å¼€çŠ¶æ€ï¼ˆOpenï¼‰â† æ‹’ç»æ‰€æœ‰è¯·æ±‚
    â†“ ï¼ˆç­‰å¾…ä¸€æ®µæ—¶é—´ï¼‰
åŠå¼€çŠ¶æ€ï¼ˆHalf-Openï¼‰
    â†“ ï¼ˆå°è¯•æ”¾è¡Œå°‘é‡è¯·æ±‚ï¼‰
    æˆåŠŸ â†’ æ¢å¤æ­£å¸¸
    å¤±è´¥ â†’ é‡æ–°æ‰“å¼€
```

### 5.5 å¹¶å‘æ§åˆ¶æœ€ä½³å®è·µ


**ğŸ¯ ç»¼åˆé…ç½®ç¤ºä¾‹**

```java
@Configuration
public class DubboConfig {
    
    // æ ¸å¿ƒæœåŠ¡ï¼šé«˜å¹¶å‘ã€å¿«é€Ÿå“åº”
    @Bean
    public ReferenceConfig<UserService> userServiceConfig() {
        ReferenceConfig<UserService> config = new ReferenceConfig<>();
        config.setInterface(UserService.class);
        config.setTimeout(1000);        // 1ç§’è¶…æ—¶
        config.setRetries(0);           // ä¸é‡è¯•
        config.setActives(50);          // æœ€å¤š50å¹¶å‘
        config.setLoadbalance("leastactive"); // æœ€å°‘æ´»è·ƒæ•°
        return config;
    }
    
    // éæ ¸å¿ƒæœåŠ¡ï¼šå…è®¸ç­‰å¾…ã€æœ‰é™çº§
    @Bean
    public ReferenceConfig<ReportService> reportServiceConfig() {
        ReferenceConfig<ReportService> config = new ReferenceConfig<>();
        config.setInterface(ReportService.class);
        config.setTimeout(5000);        // 5ç§’è¶…æ—¶
        config.setRetries(2);           // é‡è¯•2æ¬¡
        config.setActives(10);          // æœ€å¤š10å¹¶å‘
        config.setCluster("failsafe");  // å¤±è´¥å®‰å…¨
        return config;
    }
}
```

**ğŸ“Š å¹¶å‘æ§åˆ¶ç­–ç•¥æ€»ç»“**

```
â”Œâ”€â”€â”€ å¹¶å‘æ§åˆ¶å±‚æ¬¡ â”€â”€â”€â”
â”‚                   â”‚
â”‚  [1]çº¿ç¨‹æ± éš”ç¦»    â”‚ â† æœ€å¤–å±‚é˜²æŠ¤
â”‚       â†“          â”‚
â”‚  [2]é™æµæ§åˆ¶      â”‚ â† æµé‡æ§åˆ¶
â”‚       â†“          â”‚
â”‚  [3]è¶…æ—¶ç†”æ–­      â”‚ â† å¿«é€Ÿå¤±è´¥
â”‚       â†“          â”‚
â”‚  [4]é™çº§å…œåº•      â”‚ â† æœ€åé˜²çº¿
â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¼‚æ­¥è°ƒç”¨ï¼šå‘èµ·è¯·æ±‚ä¸ç­‰å¾…ï¼Œé€šè¿‡Future/å›è°ƒè·å–ç»“æœ
ğŸ”¸ CompletableFutureï¼šJava8å¼‚æ­¥ç¼–ç¨‹åˆ©å™¨ï¼Œæ”¯æŒé“¾å¼ç»„åˆ
ğŸ”¸ å“åº”å¼ç¼–ç¨‹ï¼šæ•°æ®æµé©±åŠ¨ï¼Œå¤©ç„¶æ”¯æŒèƒŒå‹å’Œæµå¼å¤„ç†
ğŸ”¸ å¹¶å‘æ§åˆ¶ï¼šçº¿ç¨‹æ± ã€é™æµã€éš”ç¦»ã€ç†”æ–­çš„ç»¼åˆè¿ç”¨
ğŸ”¸ éé˜»å¡I/Oï¼šæå‡ç³»ç»Ÿååé‡çš„å…³é”®æŠ€æœ¯
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¼‚æ­¥è°ƒç”¨çš„æœ¬è´¨**
> ä¸æ˜¯è®©ä»»åŠ¡æ‰§è¡Œæ›´å¿«ï¼Œè€Œæ˜¯è®©å½“å‰çº¿ç¨‹ä¸ç”¨ç­‰å¾…ï¼Œå¯ä»¥å»åšå…¶ä»–äº‹æƒ…

**ğŸ”¹ Future vs å“åº”å¼çš„é€‰æ‹©**
- å•æ¬¡è°ƒç”¨ç»“æœ â†’ CompletableFuture
- æµå¼æ•°æ®å¤„ç† â†’ Reactive (Mono/Flux)
- éœ€è¦èƒŒå‹æ§åˆ¶ â†’ Reactive

**ğŸ”¹ å¹¶å‘æ§åˆ¶çš„å±‚æ¬¡é˜²æŠ¤**
```
ç¬¬1å±‚ï¼šçº¿ç¨‹æ± éš”ç¦» â†’ æ•…éšœä¸ä¼ æ’­
ç¬¬2å±‚ï¼šé™æµæ§åˆ¶   â†’ ä¿æŠ¤èµ„æº
ç¬¬3å±‚ï¼šè¶…æ—¶ç†”æ–­   â†’ å¿«é€Ÿå¤±è´¥
ç¬¬4å±‚ï¼šé™çº§å…œåº•   â†’ ä¿åº•æ–¹æ¡ˆ
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**âœ… æœ¬èŠ‚æ£€æŸ¥æ¸…å•**ï¼š
- [ ] èƒ½è¯´å‡ºå¼‚æ­¥è°ƒç”¨çš„ä¸‰ç§å®ç°æ–¹å¼
- [ ] èƒ½ç”¨CompletableFutureç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡
- [ ] ç†è§£å“åº”å¼ç¼–ç¨‹çš„é€‚ç”¨åœºæ™¯
- [ ] èƒ½é…ç½®Dubboçš„çº¿ç¨‹æ± å’Œå¹¶å‘é™åˆ¶
- [ ] æŒæ¡ç†”æ–­é™çº§çš„åŸºæœ¬å®ç°

**ğŸ¯ ä¸€å¥è¯ç²¾å**ï¼š
å¼‚æ­¥è®©çº¿ç¨‹ä¸å‚»ç­‰ï¼Œå“åº”å¼è®©æ•°æ®è‡ªå·±æµï¼Œå¹¶å‘æ§åˆ¶è®©ç³»ç»Ÿä¸å´©æºƒ

**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
å¼‚æ­¥è°ƒç”¨ä¸ç­‰å¾…ï¼ŒFutureå›è°ƒä¸¤å¼€èŠ±
å“åº”ç¼–ç¨‹æ•°æ®æµï¼ŒèƒŒå‹æ§åˆ¶æ›´ä¼˜é›…
çº¿ç¨‹éš”ç¦»é˜²æ•…éšœï¼Œé™æµç†”æ–­ä¿ç³»ç»Ÿ
é™çº§å…œåº•æœ€åé˜²ï¼Œå±‚å±‚é˜²æŠ¤ä¿å¹³å®‰
```

**ğŸ”„ çŸ¥è¯†å…³è”**
```
å‰ç½®çŸ¥è¯† â† æœ¬ç« å†…å®¹ â†’ åç»­å»¶ä¼¸
    â†“         â†“          â†“
 RPCåŸºç¡€  å¼‚æ­¥å¹¶å‘æ§åˆ¶  æ€§èƒ½è°ƒä¼˜
 çº¿ç¨‹æ¨¡å‹  å“åº”å¼ç¼–ç¨‹   åˆ†å¸ƒå¼è¿½è¸ª
```

**ğŸ“Š æŒæ¡åº¦è‡ªè¯„**ï¼š
- ç†è®ºç†è§£ï¼šâ­â­â­â­â­ (æ¦‚å¿µæ¸…æ™°)
- ä»£ç å®è·µï¼šâ­â­â­â­â˜† (éœ€è¦å¤šç»ƒ)
- ç”Ÿäº§åº”ç”¨ï¼šâ­â­â­â˜†â˜† (éœ€è¦å®æˆ˜)