---
title: 4ã€Dubboè°ƒç”¨æµç¨‹ä¸åŸç†å‰–æ
---
## ğŸ“š ç›®å½•

1. [Dubboè°ƒç”¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ](#1-dubboè°ƒç”¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ)
2. [æœåŠ¡æš´éœ²æµç¨‹è¯¦è§£](#2-æœåŠ¡æš´éœ²æµç¨‹è¯¦è§£)
3. [æœåŠ¡å¼•ç”¨æµç¨‹è¯¦è§£](#3-æœåŠ¡å¼•ç”¨æµç¨‹è¯¦è§£)
4. [è¿œç¨‹è°ƒç”¨é“¾è·¯å‰–æ](#4-è¿œç¨‹è°ƒç”¨é“¾è·¯å‰–æ)
5. [ä»£ç†æœºåˆ¶æ·±å…¥ç†è§£](#5-ä»£ç†æœºåˆ¶æ·±å…¥ç†è§£)
6. [ç½‘ç»œé€šä¿¡å±‚åŸç†](#6-ç½‘ç»œé€šä¿¡å±‚åŸç†)
7. [Nettyç½‘ç»œæ¡†æ¶åº”ç”¨](#7-nettyç½‘ç»œæ¡†æ¶åº”ç”¨)
8. [åè®®æ ˆç»“æ„è§£æ](#8-åè®®æ ˆç»“æ„è§£æ)
9. [åºåˆ—åŒ–è¿‡ç¨‹è¯¦è§£](#9-åºåˆ—åŒ–è¿‡ç¨‹è¯¦è§£)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ Dubboè°ƒç”¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ


### 1.1 ä»€ä¹ˆæ˜¯Dubboè°ƒç”¨


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼Œä½ ï¼ˆæ¶ˆè´¹è€…ï¼‰å‘Šè¯‰æœåŠ¡å‘˜ï¼ˆDubboæ¡†æ¶ï¼‰ä½ è¦ä»€ä¹ˆèœï¼ŒæœåŠ¡å‘˜æŠŠè®¢å•ä¼ ç»™å¨æˆ¿ï¼ˆæœåŠ¡æä¾›è€…ï¼‰ï¼Œå¨æˆ¿åšå¥½åï¼ŒæœåŠ¡å‘˜å†æŠŠèœç«¯ç»™ä½ ã€‚è¿™æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯Dubboè°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **æœåŠ¡æä¾›è€…ï¼ˆProviderï¼‰**ï¼šæä¾›å…·ä½“åŠŸèƒ½çš„ä¸€æ–¹ï¼Œå°±åƒå¨æˆ¿
- **æœåŠ¡æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰**ï¼šä½¿ç”¨åŠŸèƒ½çš„ä¸€æ–¹ï¼Œå°±åƒé¡¾å®¢
- **æ³¨å†Œä¸­å¿ƒï¼ˆRegistryï¼‰**ï¼šè®°å½•è°èƒ½æä¾›ä»€ä¹ˆæœåŠ¡ï¼Œå°±åƒèœå•

### 1.2 å®Œæ•´è°ƒç”¨é“¾è·¯æ¦‚è§ˆ


```
ã€æœåŠ¡å¯åŠ¨é˜¶æ®µã€‘
Provider â†’ æš´éœ²æœåŠ¡ â†’ æ³¨å†Œä¸­å¿ƒè®°å½•
Consumer â†’ å¼•ç”¨æœåŠ¡ â†’ ä»æ³¨å†Œä¸­å¿ƒè·å–Providerä¿¡æ¯

ã€è°ƒç”¨æ‰§è¡Œé˜¶æ®µã€‘
Consumerå‘èµ·è°ƒç”¨ â†’ ä»£ç†æ‹¦æˆª â†’ ç½‘ç»œä¼ è¾“ â†’ Provideræ‰§è¡Œ â†’ è¿”å›ç»“æœ

ã€æŒç»­è¿è¡Œé˜¶æ®µã€‘
æ³¨å†Œä¸­å¿ƒç›‘å¬å˜åŒ– â†’ è‡ªåŠ¨æ›´æ–°Provideråˆ—è¡¨ â†’ è°ƒç”¨è·¯ç”±è‡ªåŠ¨è°ƒæ•´
```

**ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾**ï¼š

```
å¯åŠ¨å‡†å¤‡é˜¶æ®µ              è¿è¡Œè°ƒç”¨é˜¶æ®µ              æŒç»­ç›‘æ§é˜¶æ®µ
     â”‚                        â”‚                        â”‚
     â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æœåŠ¡æš´éœ² â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚è¿œç¨‹è°ƒç”¨ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚çŠ¶æ€ç›‘æ§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æœåŠ¡å¼•ç”¨ â”‚             â”‚ç»“æœè¿”å› â”‚             â”‚åŠ¨æ€è°ƒæ•´ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“¤ æœåŠ¡æš´éœ²æµç¨‹è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯æœåŠ¡æš´éœ²


> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼šæœåŠ¡æš´éœ²å°±æ˜¯æŠŠä½ å†™çš„Javaç±»æ–¹æ³•ï¼Œå˜æˆå¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„æœåŠ¡ã€‚å°±åƒæŠŠè‡ªå®¶é¤é¦†çš„èœå“ä¿¡æ¯æŒ‚åˆ°ç¾å›¢ä¸Šï¼Œè®©åˆ«äººèƒ½çœ‹åˆ°å¹¶ç‚¹é¤ã€‚

**æœåŠ¡æš´éœ²è¦åšçš„äº‹æƒ…**ï¼š
- âœ… å°†æœ¬åœ°Javaæ¥å£åŒ…è£…æˆç½‘ç»œæœåŠ¡
- âœ… åœ¨æ³¨å†Œä¸­å¿ƒç™»è®°æœåŠ¡ä¿¡æ¯
- âœ… å¯åŠ¨ç½‘ç»œç›‘å¬ï¼Œç­‰å¾…è°ƒç”¨è¯·æ±‚
- âœ… å‡†å¤‡å¥½åºåˆ—åŒ–å’Œåè®®å¤„ç†

### 2.2 æœåŠ¡æš´éœ²çš„æ ¸å¿ƒæ­¥éª¤


**æ­¥éª¤1ï¼šè§£ææœåŠ¡é…ç½®**

```java
// è¿™æ˜¯ä½ å†™çš„æœåŠ¡å®ç°ç±»
@DubboService  // è¿™ä¸ªæ³¨è§£å‘Šè¯‰Dubboï¼š"æˆ‘è¦æš´éœ²è¿™ä¸ªæœåŠ¡"
public class UserServiceImpl implements UserService {
    public User getUser(Long id) {
        // å…·ä½“ä¸šåŠ¡é€»è¾‘
        return new User(id, "å¼ ä¸‰");
    }
}
```

**Dubboåšäº†ä»€ä¹ˆ**ï¼š
- ğŸ” æ‰«æ`@DubboService`æ³¨è§£
- ğŸ“ è¯»å–æœåŠ¡æ¥å£ä¿¡æ¯ï¼ˆæ¥å£åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ç­‰ï¼‰
- âš™ï¸ è¯»å–é…ç½®å‚æ•°ï¼ˆè¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ç­‰ï¼‰

**æ­¥éª¤2ï¼šåˆ›å»ºæœåŠ¡å¯¹è±¡**

```
åŸå§‹å¯¹è±¡: UserServiceImplå®ä¾‹
    â”‚
    â–¼
åŒ…è£…å¤„ç†: æ·»åŠ è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨
    â”‚
    â–¼
æœ€ç»ˆå¯¹è±¡: å¢å¼ºåçš„æœåŠ¡ä»£ç†å¯¹è±¡
```

> âš ï¸ **æ³¨æ„**ï¼šè¿™é‡Œçš„"åŒ…è£…"ä¸æ˜¯æ”¹å˜ä½ çš„ä»£ç ï¼Œè€Œæ˜¯åœ¨å¤–é¢å¥—ä¸€å±‚"ä¿æŠ¤å£³"ï¼ŒåŠ ä¸Šç›‘æ§ã€æ—¥å¿—ã€äº‹åŠ¡ç­‰åŠŸèƒ½ã€‚

**æ­¥éª¤3ï¼šå¯åŠ¨ç½‘ç»œç›‘å¬**

```
æœ¬åœ°æœåŠ¡ â†’ ç»‘å®šç«¯å£ï¼ˆå¦‚20880ï¼‰â†’ å¼€å¯ç½‘ç»œç›‘å¬
    â”‚
    â–¼
ç­‰å¾…Consumerçš„ç½‘ç»œè¯·æ±‚åˆ°æ¥
```

| é…ç½®é¡¹ | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|--------|------|--------|
| **åè®®** | ä½¿ç”¨ä»€ä¹ˆé€šä¿¡æ–¹å¼ | `dubbo://` |
| **ç«¯å£** | ç›‘å¬å“ªä¸ªç«¯å£ | `20880` |
| **çº¿ç¨‹æ•°** | å¤„ç†è¯·æ±‚çš„å·¥ä½œçº¿ç¨‹ | `200` |

**æ­¥éª¤4ï¼šæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ**

```
Provider                  æ³¨å†Œä¸­å¿ƒ(Zookeeper/Nacos)
   â”‚                             â”‚
   â”‚â”€â”€â”€â”€ æˆ‘æä¾›UserService â”€â”€â”€â”€â–¶â”‚
   â”‚     åœ°å€:192.168.1.100      â”‚
   â”‚     ç«¯å£:20880              â”‚
   â”‚                             â”‚
   â”‚â—€â”€â”€â”€â”€ æ³¨å†ŒæˆåŠŸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**æ³¨å†Œçš„ä¿¡æ¯åŒ…æ‹¬**ï¼š
- æœåŠ¡æ¥å£å…¨åï¼š`com.example.UserService`
- æœåŠ¡åœ°å€ï¼š`192.168.1.100:20880`
- åè®®ç±»å‹ï¼š`dubbo`
- æœåŠ¡å‚æ•°ï¼šè¶…æ—¶ã€é‡è¯•ç­‰é…ç½®

### 2.3 æœåŠ¡æš´éœ²çš„å®Œæ•´æµç¨‹å›¾


```
ã€Providerå¯åŠ¨ã€‘
     â”‚
     â–¼
1. åŠ è½½é…ç½®æ–‡ä»¶/æ³¨è§£
     â”‚
     â–¼
2. åˆ›å»ºServiceBean
     â”‚
     â–¼
3. æ„å»ºURL(dubbo://192.168.1.100:20880/UserService)
     â”‚
     â–¼
4. å¯åŠ¨NettyæœåŠ¡å™¨ï¼Œç»‘å®šç«¯å£
     â”‚
     â–¼
5. å°†æœåŠ¡URLæ³¨å†Œåˆ°Zookeeper
     â”‚
     â–¼
6. åˆ›å»ºç›‘å¬å™¨ï¼Œç­‰å¾…è°ƒç”¨
     â”‚
     â–¼
ã€æš´éœ²å®Œæˆï¼Œç­‰å¾…è°ƒç”¨ã€‘
```

> ğŸš€ **å®é™…æ•ˆæœ**ï¼šå½“æœåŠ¡æš´éœ²å®Œæˆåï¼Œä½ çš„Javaæ–¹æ³•å°±å˜æˆäº†ä¸€ä¸ª"ç½‘ç»œæœåŠ¡"ï¼Œå¯ä»¥è¢«ä»»ä½•çŸ¥é“å®ƒåœ°å€çš„Consumerè°ƒç”¨ã€‚

---

## 3. ğŸ“¥ æœåŠ¡å¼•ç”¨æµç¨‹è¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯æœåŠ¡å¼•ç”¨


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šæœåŠ¡å¼•ç”¨å°±æ˜¯Consumerè·å–ProvideræœåŠ¡çš„"é¥æ§å™¨"ã€‚ä½ ä¸éœ€è¦çŸ¥é“Provideråœ¨å“ªå°æœºå™¨ä¸Šï¼Œåªè¦æ‹¿åˆ°è¿™ä¸ª"é¥æ§å™¨"ï¼ŒæŒ‰æŒ‰é’®ï¼ˆè°ƒç”¨æ–¹æ³•ï¼‰å°±èƒ½è®©Providerå¹²æ´»ã€‚

**æœåŠ¡å¼•ç”¨çš„æœ¬è´¨**ï¼š
- ğŸ¯ åˆ›å»ºä¸€ä¸ªæœ¬åœ°ä»£ç†å¯¹è±¡
- ğŸ”— è¿™ä¸ªä»£ç†å¯¹è±¡ä¼šè‡ªåŠ¨æŠŠè°ƒç”¨è½¬å‘ç»™è¿œç¨‹Provider
- ğŸ“¡ ä»æ³¨å†Œä¸­å¿ƒè·å–Providerçš„åœ°å€ä¿¡æ¯

### 3.2 æœåŠ¡å¼•ç”¨çš„æ ¸å¿ƒæ­¥éª¤


**æ­¥éª¤1ï¼šå£°æ˜å¼•ç”¨**

```java
// åœ¨Consumerç«¯ï¼Œä½ è¿™æ ·å£°æ˜è¦ä½¿ç”¨çš„æœåŠ¡
@DubboReference  // è¿™ä¸ªæ³¨è§£å‘Šè¯‰Dubboï¼š"æˆ‘è¦ç”¨è¿™ä¸ªæœåŠ¡"
private UserService userService;

// ç„¶åå°±å¯ä»¥åƒæœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨
public void test() {
    User user = userService.getUser(1L);  // å®é™…æ˜¯è¿œç¨‹è°ƒç”¨
    System.out.println(user.getName());
}
```

**Dubboåšäº†ä»€ä¹ˆ**ï¼š
- ğŸ” è¯†åˆ«`@DubboReference`æ³¨è§£
- ğŸ“ è®°å½•æ¥å£ç±»å‹ï¼ˆUserServiceï¼‰
- ğŸ› ï¸ å‡†å¤‡åˆ›å»ºä»£ç†å¯¹è±¡

**æ­¥éª¤2ï¼šä»æ³¨å†Œä¸­å¿ƒè·å–Providerä¿¡æ¯**

```
Consumer                  æ³¨å†Œä¸­å¿ƒ                Provideråˆ—è¡¨
   â”‚                         â”‚                        â”‚
   â”‚â”€â”€æˆ‘è¦UserServiceâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
   â”‚                         â”‚                        â”‚
   â”‚                         â”‚â—€â”€æŸ¥è¯¢Provideråˆ—è¡¨â”€â”€â”€â”€â”€â”‚
   â”‚                         â”‚                        â”‚
   â”‚â—€â”€â”€â”€è¿”å›åœ°å€åˆ—è¡¨â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
   â”‚   [192.168.1.100:20880] â”‚                        â”‚
   â”‚   [192.168.1.101:20880] â”‚                        â”‚
```

**è·å–åˆ°çš„ä¿¡æ¯**ï¼š
- Provideråœ°å€åˆ—è¡¨
- æ¯ä¸ªProviderçš„é…ç½®å‚æ•°
- æœåŠ¡çš„ç‰ˆæœ¬ã€åˆ†ç»„ç­‰å…ƒæ•°æ®

**æ­¥éª¤3ï¼šåˆ›å»ºä»£ç†å¯¹è±¡**

```
æ¥å£å®šä¹‰: UserService
    â”‚
    â–¼
åŠ¨æ€ç”Ÿæˆ: UserServiceçš„ä»£ç†å®ç°ç±»
    â”‚
    â–¼
æ³¨å…¥å±æ€§: ç»™ä½ çš„@DubboReferenceèµ‹å€¼
```

> ğŸ”§ **æŠ€æœ¯ç»†èŠ‚**ï¼šDubboé»˜è®¤ä½¿ç”¨JavassiståŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œè¿™ä¸ªä»£ç†ç±»å®ç°äº†UserServiceæ¥å£ï¼Œä½†æ–¹æ³•ä½“æ˜¯ç½‘ç»œè°ƒç”¨é€»è¾‘ã€‚

**æ­¥éª¤4ï¼šå»ºç«‹è¿æ¥**

```
ä»£ç†å¯¹è±¡åˆ›å»ºå®Œæˆ
    â”‚
    â–¼
ä¸Providerå»ºç«‹Nettyè¿æ¥
    â”‚
    â–¼
è¿æ¥æ± ç®¡ç†ï¼ˆå¤ç”¨è¿æ¥ï¼‰
    â”‚
    â–¼
å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…è°ƒç”¨
```

| è¿æ¥é…ç½® | å«ä¹‰ | é»˜è®¤å€¼ |
|----------|------|--------|
| **è¿æ¥æ•°** | ä¸æ¯ä¸ªProviderå»ºç«‹å‡ æ¡è¿æ¥ | `1` |
| **å…±äº«è¿æ¥** | å¤šä¸ªæœåŠ¡æ˜¯å¦å…±ç”¨è¿æ¥ | `æ˜¯` |
| **è¿æ¥è¶…æ—¶** | å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ | `3ç§’` |

### 3.3 æœåŠ¡å¼•ç”¨çš„å®Œæ•´æµç¨‹å›¾


```
ã€Consumerå¯åŠ¨ã€‘
     â”‚
     â–¼
1. æ‰«æ@DubboReferenceæ³¨è§£
     â”‚
     â–¼
2. åˆ›å»ºReferenceBean
     â”‚
     â–¼
3. è®¢é˜…æ³¨å†Œä¸­å¿ƒï¼ˆç›‘å¬Providerå˜åŒ–ï¼‰
     â”‚
     â–¼
4. è·å–Provideråœ°å€åˆ—è¡¨
     â”‚
     â–¼
5. åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡
     â”‚
     â–¼
6. ä¸Providerå»ºç«‹Nettyè¿æ¥
     â”‚
     â–¼
7. æ³¨å…¥åˆ°Springå®¹å™¨
     â”‚
     â–¼
ã€å¼•ç”¨å®Œæˆï¼Œå¯ä»¥è°ƒç”¨ã€‘
```

> âœ… **å…³é”®ç†è§£**ï¼šå¼•ç”¨å®Œæˆåï¼Œä½ å¾—åˆ°çš„`userService`å¯¹è±¡çœ‹èµ·æ¥åƒæœ¬åœ°å¯¹è±¡ï¼Œä½†å®é™…æ˜¯ä¸ª"è¿œç¨‹è°ƒç”¨çš„ä»£ç†"ã€‚

---

## 4. ğŸ”— è¿œç¨‹è°ƒç”¨é“¾è·¯å‰–æ


### 4.1 ä¸€æ¬¡å®Œæ•´è°ƒç”¨çš„å…¨è¿‡ç¨‹


> ğŸ“– **åœºæ™¯æ¨¡æ‹Ÿ**ï¼šä½ åœ¨Consumerç«¯è°ƒç”¨`userService.getUser(1L)`ï¼Œçœ‹çœ‹Dubboå†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆã€‚

**è°ƒç”¨é“¾è·¯å›¾**ï¼š

```
Consumerç«¯                                             Providerç«¯
    â”‚                                                      â”‚
ã€1.æ–¹æ³•è°ƒç”¨ã€‘                                        ã€ç­‰å¾…è¯·æ±‚ã€‘
    â”‚                                                      â”‚
userService.getUser(1L)                                   â”‚
    â”‚                                                      â”‚
    â–¼                                                      â”‚
ã€2.ä»£ç†æ‹¦æˆªã€‘                                            â”‚
    â”‚                                                      â”‚
ä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•è°ƒç”¨                                      â”‚
    â”‚                                                      â”‚
    â–¼                                                      â”‚
ã€3.å‚æ•°åºåˆ—åŒ–ã€‘                                          â”‚
    â”‚                                                      â”‚
å°†å‚æ•°è½¬ä¸ºå­—èŠ‚æ•°ç»„                                        â”‚
å‚æ•°: 1L â†’ [0x00,0x01]                                   â”‚
    â”‚                                                      â”‚
    â–¼                                                      â”‚
ã€4.æ„å»ºè¯·æ±‚ã€‘                                            â”‚
    â”‚                                                      â”‚
å°è£…è¯·æ±‚ä¿¡æ¯:                                             â”‚
- æ¥å£å: UserService                                     â”‚
- æ–¹æ³•å: getUser                                         â”‚
- å‚æ•°: [0x00,0x01]                                      â”‚
    â”‚                                                      â”‚
    â–¼                                                      â”‚
ã€5.ç½‘ç»œä¼ è¾“ã€‘â”€â”€â”€â”€â”€â”€â”€â”€â”€Requestæ•°æ®åŒ…â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ã€6.æ¥æ”¶è¯·æ±‚ã€‘
    â”‚                                                      â”‚
    â”‚                                                      â–¼
    â”‚                                                 è§£æè¯·æ±‚å¤´
    â”‚                                                      â”‚
    â”‚                                                      â–¼
    â”‚                                                ã€7.ååºåˆ—åŒ–ã€‘
    â”‚                                                      â”‚
    â”‚                                                 å­—èŠ‚â†’å¯¹è±¡
    â”‚                                                      â”‚
    â”‚                                                      â–¼
    â”‚                                                ã€8.æ‰§è¡Œæ–¹æ³•ã€‘
    â”‚                                                      â”‚
    â”‚                                          userServiceImpl.getUser(1L)
    â”‚                                                      â”‚
    â”‚                                                      â–¼
    â”‚                                                 è¿”å›ç»“æœå¯¹è±¡
    â”‚                                                      â”‚
ã€11.å¾—åˆ°ç»“æœã€‘â—€â”€â”€â”€â”€Responseæ•°æ®åŒ…â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ã€9.ç»“æœåºåˆ—åŒ–ã€‘
    â”‚                                                      â”‚
    â–¼                                                      â–¼
ã€12.ååºåˆ—åŒ–ã€‘                                      é€šè¿‡ç½‘ç»œè¿”å›
    â”‚
    â–¼
ã€13.è¿”å›ç»™è°ƒç”¨æ–¹ã€‘
    â”‚
    â–¼
Userå¯¹è±¡ = {id:1, name:"å¼ ä¸‰"}
```

### 4.2 è°ƒç”¨è¿‡ç¨‹çš„å…³é”®æ­¥éª¤è¯¦è§£


**æ­¥éª¤1-2ï¼šæ–¹æ³•è°ƒç”¨ä¸ä»£ç†æ‹¦æˆª**

```java
// ä½ å†™çš„ä»£ç 
User user = userService.getUser(1L);

// å®é™…æ‰§è¡Œçš„æ˜¯ä»£ç†ç±»çš„invokeæ–¹æ³•
// ä»£ç†å†…éƒ¨é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
public Object invoke(Object proxy, Method method, Object[] args) {
    // 1. è·å–æ–¹æ³•ä¿¡æ¯
    String methodName = method.getName();  // "getUser"
    
    // 2. é€‰æ‹©Provideråœ°å€ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
    String providerUrl = loadBalance.select(providerList);
    
    // 3. æ„å»ºè°ƒç”¨è¯·æ±‚
    RpcInvocation invocation = new RpcInvocation(methodName, args);
    
    // 4. å‘èµ·è¿œç¨‹è°ƒç”¨
    return invoker.invoke(invocation);
}
```

> ğŸ¯ **æ ¸å¿ƒç†è§£**ï¼šä»£ç†çš„ä½œç”¨å°±æ˜¯"å·æ¢æ¢æŸ±"ï¼ŒæŠŠæœ¬åœ°æ–¹æ³•è°ƒç”¨å·å·æ¢æˆç½‘ç»œè°ƒç”¨ã€‚

**æ­¥éª¤3-4ï¼šåºåˆ—åŒ–ä¸è¯·æ±‚æ„å»º**

```
åŸå§‹å‚æ•°: Longç±»å‹çš„1
    â”‚
    â–¼
åºåˆ—åŒ–å™¨å¤„ç†: Hessian2/Fastjson
    â”‚
    â–¼
å­—èŠ‚æ•°ç»„: [0x00, 0x00, 0x00, 0x01]
    â”‚
    â–¼
å°è£…åˆ°Requestå¯¹è±¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request Header      â”‚
â”‚ - é­”æ•°: 0xdabb      â”‚
â”‚ - è¯·æ±‚ID: 12345     â”‚
â”‚ - æ•°æ®é•¿åº¦: 100     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Request Body        â”‚
â”‚ - æ¥å£: UserService â”‚
â”‚ - æ–¹æ³•: getUser     â”‚
â”‚ - å‚æ•°: [0x00,0x01] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åºåˆ—åŒ–æ ¼å¼å¯¹æ¯”**ï¼š

| åºåˆ—åŒ–æ–¹å¼ | é€Ÿåº¦ | ä½“ç§¯ | å…¼å®¹æ€§ | æ¨èåœºæ™¯ |
|------------|------|------|--------|----------|
| **Hessian2** | â­â­â­â­ | å° | å¥½ | é»˜è®¤æ¨è |
| **Fastjson** | â­â­â­â­â­ | ä¸­ | ä¸€èˆ¬ | JSONäº¤äº’ |
| **Protobuf** | â­â­â­â­â­ | æå° | éœ€å®šä¹‰ | æ€§èƒ½ä¼˜å…ˆ |
| **JavaåŸç”Ÿ** | â­â­ | å¤§ | å·® | ä¸æ¨è |

**æ­¥éª¤5-6ï¼šç½‘ç»œä¼ è¾“**

```
Consumerç«¯Netty                     Providerç«¯Netty
    â”‚                                    â”‚
    â”‚â”€â”€â”€â”€ TCPè¿æ¥å·²å»ºç«‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                                    â”‚
    â”‚â”€â”€â”€â”€ Requestå­—èŠ‚æµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚
    â”‚     [Header][Body]                â”‚
    â”‚                                    â”‚
    â”‚                                    â–¼
    â”‚                              è§£ç å™¨è§£æ
    â”‚                                    â”‚
    â”‚                                    â–¼
    â”‚                              ä¸šåŠ¡çº¿ç¨‹æ± 
    â”‚                                    â”‚
    â”‚  â—€â”€â”€â”€â”€ Responseå­—èŠ‚æµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚     [Header][Body]                â”‚
```

> âš¡ **æ€§èƒ½å…³é”®**ï¼šDubboä½¿ç”¨Nettyçš„NIOæ¨¡å‹ï¼Œä¸€æ¡è¿æ¥å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå¤§å¤§æå‡å¹¶å‘èƒ½åŠ›ã€‚

**æ­¥éª¤7-10ï¼šProviderç«¯å¤„ç†**

```
æ¥æ”¶åˆ°è¯·æ±‚
    â”‚
    â–¼
ååºåˆ—åŒ–å‚æ•°: å­—èŠ‚ â†’ Javaå¯¹è±¡
    â”‚
    â–¼
æŸ¥æ‰¾æœåŠ¡å®ç°ç±»: UserServiceImpl
    â”‚
    â–¼
åå°„è°ƒç”¨æ–¹æ³•: method.invoke(serviceImpl, args)
    â”‚
    â–¼
è·å¾—è¿”å›å€¼: Userå¯¹è±¡
    â”‚
    â–¼
åºåˆ—åŒ–ç»“æœ: Userå¯¹è±¡ â†’ å­—èŠ‚
    â”‚
    â–¼
æ„å»ºResponseè¿”å›
```

**æ­¥éª¤11-13ï¼šConsumerç«¯æ¥æ”¶ç»“æœ**

```
æ¥æ”¶Response
    â”‚
    â–¼
è§£æå“åº”å¤´: è¯·æ±‚IDåŒ¹é…
    â”‚
    â–¼
ååºåˆ—åŒ–ç»“æœ: å­—èŠ‚ â†’ Userå¯¹è±¡
    â”‚
    â–¼
è¿”å›ç»™è°ƒç”¨æ–¹
```

### 4.3 è°ƒç”¨è¿‡ç¨‹ä¸­çš„å…³é”®æœºåˆ¶


**å¼‚æ­¥è½¬åŒæ­¥æœºåˆ¶**ï¼š

```
è°ƒç”¨çº¿ç¨‹                    IOçº¿ç¨‹                    ä¸šåŠ¡çº¿ç¨‹
    â”‚                         â”‚                          â”‚
å‘èµ·è°ƒç”¨                      â”‚                          â”‚
    â”‚                         â”‚                          â”‚
    â–¼                         â”‚                          â”‚
ç­‰å¾…ç»“æœ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                          â”‚
(é˜»å¡)            â”‚          â”‚                          â”‚
    â”‚             â”‚          â–¼                          â”‚
    â”‚         è·å–Future  æ¥æ”¶å“åº”                       â”‚
    â”‚             â”‚          â”‚                          â”‚
    â”‚             â”‚          â–¼                          â”‚
    â”‚             â””â”€â”€â”€â”€ ç»“æœæ”¾å…¥Future                  â”‚
    â”‚                         â”‚                          â”‚
    â–¼                         â–¼                          â”‚
å¾—åˆ°ç»“æœ                   ç»§ç»­ç›‘å¬                      â”‚
(å”¤é†’)
```

> ğŸ’¡ **åŸç†è§£é‡Š**ï¼šè°ƒç”¨çº¿ç¨‹å‘èµ·è¯·æ±‚åä¼šé˜»å¡ç­‰å¾…ï¼ŒIOçº¿ç¨‹æ”¶åˆ°å“åº”åä¼šå”¤é†’è°ƒç”¨çº¿ç¨‹ï¼Œè¿™æ ·å°±æŠŠå¼‚æ­¥ç½‘ç»œIOå˜æˆäº†åŒæ­¥è°ƒç”¨ã€‚

---

## 5. ğŸ­ ä»£ç†æœºåˆ¶æ·±å…¥ç†è§£


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†


> ğŸ“– **æœ¬è´¨é—®é¢˜**ï¼šä½ è°ƒç”¨`userService.getUser(1L)`æ—¶ï¼ŒuserServiceæ˜æ˜æ˜¯ä¸ªæ¥å£ï¼Œæ²¡æœ‰å®ç°ç±»ï¼Œä¸ºä»€ä¹ˆèƒ½è°ƒç”¨æˆåŠŸï¼Ÿ

**ç­”æ¡ˆ**ï¼šDubboåŠ¨æ€ç”Ÿæˆäº†ä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™ä¸ªä»£ç†ç±»ï¼š
- âœ… å®ç°äº†UserServiceæ¥å£
- âœ… æ–¹æ³•ä½“æ˜¯ç½‘ç»œè°ƒç”¨é€»è¾‘
- âœ… å¯¹ä½ é€æ˜ï¼Œç”¨èµ·æ¥åƒæœ¬åœ°å¯¹è±¡

### 5.2 Dubboçš„ä¸¤ç§ä»£ç†æ–¹å¼


**æ–¹å¼1ï¼šJavassistä»£ç†ï¼ˆé»˜è®¤ï¼‰**

```java
// DubboåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰
public class UserService$Proxy implements UserService {
    
    private Invoker invoker;  // çœŸæ­£æ‰§è¡Œè°ƒç”¨çš„å¯¹è±¡
    
    public User getUser(Long id) {
        // 1. æ„å»ºè°ƒç”¨ä¿¡æ¯
        RpcInvocation invocation = new RpcInvocation();
        invocation.setMethodName("getUser");
        invocation.setParameterTypes(new Class[]{Long.class});
        invocation.setArguments(new Object[]{id});
        
        // 2. æ‰§è¡Œè¿œç¨‹è°ƒç”¨
        Result result = invoker.invoke(invocation);
        
        // 3. è¿”å›ç»“æœ
        return (User) result.getValue();
    }
}
```

**Javassistç‰¹ç‚¹**ï¼š
- ğŸš€ é€Ÿåº¦å¿«ï¼šç›´æ¥ç”Ÿæˆå­—èŠ‚ç 
- ğŸ“¦ ä½“ç§¯å°ï¼šç”Ÿæˆçš„ä»£ç ç²¾ç®€
- âš™ï¸ çµæ´»ï¼šå¯è‡ªå®šä¹‰ä»£ç†é€»è¾‘

**æ–¹å¼2ï¼šJDKåŠ¨æ€ä»£ç†**

```java
// JDKæ–¹å¼éœ€è¦InvocationHandler
public class DubboInvocationHandler implements InvocationHandler {
    
    private Invoker invoker;
    
    public Object invoke(Object proxy, Method method, Object[] args) {
        // æ„å»ºè°ƒç”¨
        RpcInvocation invocation = new RpcInvocation(method, args);
        
        // æ‰§è¡Œè°ƒç”¨
        Result result = invoker.invoke(invocation);
        
        return result.getValue();
    }
}
```

**JDKåŠ¨æ€ä»£ç†ç‰¹ç‚¹**ï¼š
- âœ… æ ‡å‡†ï¼šJDKåŸç”Ÿæ”¯æŒ
- âš ï¸ é™åˆ¶ï¼šåªèƒ½ä»£ç†æ¥å£
- ğŸ“‰ æ€§èƒ½ï¼šç›¸æ¯”Javassistç•¥æ…¢

**ä»£ç†æ–¹å¼å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | Javassist | JDKåŠ¨æ€ä»£ç† |
|------|-----------|-------------|
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ |
| **çµæ´»æ€§** | â­â­â­â­â­ | â­â­â­ |
| **æ˜“ç”¨æ€§** | â­â­â­ | â­â­â­â­â­ |
| **ä¾èµ–** | éœ€è¦Javassiståº“ | JDKè‡ªå¸¦ |

### 5.3 ä»£ç†çš„å·¥ä½œæµç¨‹


```
ã€Consumerç«¯è°ƒç”¨ã€‘
     â”‚
ç”¨æˆ·è°ƒç”¨: userService.getUser(1L)
     â”‚
     â–¼
ä»£ç†æ‹¦æˆª: Proxyå¯¹è±¡çš„getUseræ–¹æ³•
     â”‚
     â–¼
æ–¹æ³•ä¿¡æ¯å°è£…:
- æ¥å£å: com.example.UserService
- æ–¹æ³•å: getUser
- å‚æ•°ç±»å‹: [Long.class]
- å‚æ•°å€¼: [1L]
     â”‚
     â–¼
é€‰æ‹©Invoker: æ ¹æ®è´Ÿè½½å‡è¡¡é€‰Provider
     â”‚
     â–¼
æ‰§è¡Œè°ƒç”¨: invoker.invoke(invocation)
     â”‚
     â–¼
ã€è¿›å…¥ç½‘ç»œä¼ è¾“é˜¶æ®µã€‘
```

> ğŸ” **æ·±å…¥ç†è§£**ï¼šä»£ç†æ˜¯Consumerç«¯çš„"ç¿»è¯‘å®˜"ï¼ŒæŠŠJavaæ–¹æ³•è°ƒç”¨ç¿»è¯‘æˆç½‘ç»œè¯·æ±‚ï¼ŒæŠŠç½‘ç»œå“åº”ç¿»è¯‘å›Javaå¯¹è±¡ã€‚

---

## 6. ğŸŒ ç½‘ç»œé€šä¿¡å±‚åŸç†


### 6.1 Dubboçš„ç½‘ç»œæ¨¡å‹


> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼šDubboä½¿ç”¨å¼‚æ­¥éé˜»å¡IOï¼ˆNIOï¼‰æ¨¡å‹ï¼Œç”¨å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ã€‚

**ä¼ ç»ŸBIOæ¨¡å‹ vs Dubbo NIOæ¨¡å‹**ï¼š

```
ã€BIOæ¨¡å‹ - ä¼ ç»Ÿæ–¹å¼ã€‘
æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿æ¥å¤šäº†çº¿ç¨‹çˆ†ç‚¸

å®¢æˆ·ç«¯1 â†’ çº¿ç¨‹1 â†’ ç­‰å¾…IO
å®¢æˆ·ç«¯2 â†’ çº¿ç¨‹2 â†’ ç­‰å¾…IO
å®¢æˆ·ç«¯3 â†’ çº¿ç¨‹3 â†’ ç­‰å¾…IO
...
å®¢æˆ·ç«¯1000 â†’ çº¿ç¨‹1000 â†’ ç³»ç»Ÿå´©æºƒâŒ

ã€NIOæ¨¡å‹ - Dubboæ–¹å¼ã€‘
ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªè¿æ¥

        Bossçº¿ç¨‹ï¼ˆæ¥æ”¶è¿æ¥ï¼‰
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚
Workerçº¿ç¨‹1      Workerçº¿ç¨‹2
    â”‚               â”‚
å¤„ç†å¤šä¸ªè¿æ¥    å¤„ç†å¤šä¸ªè¿æ¥
å®¢æˆ·ç«¯1,3,5... å®¢æˆ·ç«¯2,4,6...
```

### 6.2 ç½‘ç»œé€šä¿¡çš„å…³é”®ç»„ä»¶


**ç»„ä»¶1ï¼šChannelï¼ˆé€šé“ï¼‰**

> ğŸ“– **æ¦‚å¿µ**ï¼šChannelå°±åƒä¸€æ¡"æ•°æ®ç®¡é“"ï¼ŒConsumerå’ŒProvideré€šè¿‡è¿™æ¡ç®¡é“ä¼ è¾“æ•°æ®ã€‚

```
Consumer                Channel               Provider
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€ Request â”€â”€â”€â”€â”€â”€â–¶â”‚â”€â”€â”€â”€â”€Request â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                      â”‚                      â”‚
   â”‚â—€â”€â”€â”€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€Responseâ”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**Channelç‰¹æ€§**ï¼š
- ğŸ”— åŒå‘é€šä¿¡ï¼šå¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶
- â™»ï¸ å¤ç”¨è¿æ¥ï¼šä¸€æ¡Channelå¤„ç†å¤šä¸ªè¯·æ±‚
- ğŸ“Š çŠ¶æ€ç®¡ç†ï¼šè¿æ¥ã€æ–­å¼€ã€å¼‚å¸¸çŠ¶æ€

**ç»„ä»¶2ï¼šç¼–è§£ç å™¨ï¼ˆCodecï¼‰**

```
ã€å‘é€ç«¯ã€‘
Javaå¯¹è±¡ â†’ ç¼–ç å™¨ â†’ å­—èŠ‚æµ â†’ ç½‘ç»œä¼ è¾“

ã€æ¥æ”¶ç«¯ã€‘
ç½‘ç»œä¼ è¾“ â†’ å­—èŠ‚æµ â†’ è§£ç å™¨ â†’ Javaå¯¹è±¡
```

**ç¼–è§£ç æµç¨‹**ï¼š

```
å‘é€æ•°æ®æµç¨‹:
Userå¯¹è±¡
    â”‚
    â–¼
åºåˆ—åŒ–å™¨: å¯¹è±¡â†’å­—èŠ‚
    â”‚
    â–¼
åè®®ç¼–ç å™¨: æ·»åŠ åè®®å¤´
    â”‚
    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Dubboåè®®å¤´     â”‚ 16å­—èŠ‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ åºåˆ—åŒ–åçš„æ•°æ®   â”‚ Nå­—èŠ‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
å‘é€åˆ°ç½‘ç»œ

æ¥æ”¶æ•°æ®æµç¨‹:
ä»ç½‘ç»œæ¥æ”¶
    â”‚
    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Dubboåè®®å¤´     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ åºåˆ—åŒ–æ•°æ®       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
åè®®è§£ç å™¨: è¯»å–åè®®å¤´
    â”‚
    â–¼
ååºåˆ—åŒ–å™¨: å­—èŠ‚â†’å¯¹è±¡
    â”‚
    â–¼
Userå¯¹è±¡
```

**ç»„ä»¶3ï¼šçº¿ç¨‹æ¨¡å‹**

```
                ã€Nettyçº¿ç¨‹æ¨¡å‹ã€‘
                
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        Bossçº¿ç¨‹ç»„(1ä¸ª)         â”‚
    â”‚    è´Ÿè´£æ¥æ”¶TCPè¿æ¥è¯·æ±‚          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Workerçº¿ç¨‹ç»„(CPUæ ¸æ•°*2)   â”‚
    â”‚    è´Ÿè´£IOè¯»å†™å’Œç¼–è§£ç            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      ä¸šåŠ¡çº¿ç¨‹æ± (200)            â”‚
    â”‚    è´Ÿè´£æ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çº¿ç¨‹åˆ†å·¥**ï¼š

| çº¿ç¨‹ç±»å‹ | æ•°é‡ | èŒè´£ | ç‰¹ç‚¹ |
|----------|------|------|------|
| **Bossçº¿ç¨‹** | `1` | æ¥æ”¶æ–°è¿æ¥ | ä¸å¤„ç†IO |
| **Workerçº¿ç¨‹** | `CPU*2` | å¤„ç†IOè¯»å†™ | é«˜æ•ˆä¸é˜»å¡ |
| **ä¸šåŠ¡çº¿ç¨‹** | `200` | æ‰§è¡Œä¸šåŠ¡é€»è¾‘ | å¯é˜»å¡ |

> âš¡ **æ€§èƒ½å…³é”®**ï¼šIOçº¿ç¨‹åªè´Ÿè´£æ”¶å‘æ•°æ®ï¼Œè€—æ—¶çš„ä¸šåŠ¡é€»è¾‘æ”¾åˆ°ä¸šåŠ¡çº¿ç¨‹æ± ï¼Œé¿å…é˜»å¡IOã€‚

### 6.3 è¯·æ±‚-å“åº”åŒ¹é…æœºåˆ¶


> ğŸ¤” **é—®é¢˜**ï¼šä¸€æ¡è¿æ¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå“åº”å›æ¥æ—¶æ€ä¹ˆçŸ¥é“æ˜¯å“ªä¸ªè¯·æ±‚çš„å“åº”ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼šè¯·æ±‚IDæœºåˆ¶**

```
Consumerç«¯:
è¯·æ±‚1(ID=1001) â”€â”€â”€â–¶
è¯·æ±‚2(ID=1002) â”€â”€â”€â–¶  åŒä¸€æ¡è¿æ¥
è¯·æ±‚3(ID=1003) â”€â”€â”€â–¶

Providerç«¯:
å“åº”(ID=1002) â—€â”€â”€â”€
å“åº”(ID=1001) â—€â”€â”€â”€  é¡ºåºå¯èƒ½ä¸åŒ
å“åº”(ID=1003) â—€â”€â”€â”€

Consumerç«¯åŒ¹é…:
Future<1001> â† å“åº”(ID=1001)
Future<1002> â† å“åº”(ID=1002)
Future<1003> â† å“åº”(ID=1003)
```

**åŒ¹é…è¿‡ç¨‹**ï¼š
1. å‘é€è¯·æ±‚æ—¶ç”Ÿæˆå”¯ä¸€ID
2. åˆ›å»ºFutureå¯¹è±¡ï¼Œæ”¾å…¥Map<ID, Future>
3. æ¥æ”¶å“åº”æ—¶ï¼Œæ ¹æ®IDä»Mapå–å‡ºFuture
4. å°†å“åº”ç»“æœè®¾ç½®åˆ°Futureï¼Œå”¤é†’ç­‰å¾…çº¿ç¨‹

---

## 7. ğŸš€ Nettyç½‘ç»œæ¡†æ¶åº”ç”¨


### 7.1 ä¸ºä»€ä¹ˆé€‰æ‹©Netty


> ğŸ“– **Nettyæ˜¯ä»€ä¹ˆ**ï¼šNettyæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œæ¡†æ¶ï¼Œä¸“é—¨ç”¨äºå¼€å‘é«˜æ€§èƒ½ç½‘ç»œåº”ç”¨ã€‚

**Dubboé€‰æ‹©Nettyçš„åŸå› **ï¼š
- âš¡ **æ€§èƒ½å¼ºå¤§**ï¼šå¤„ç†ç™¾ä¸‡çº§å¹¶å‘è¿æ¥
- ğŸ›¡ï¸ **ç¨³å®šå¯é **ï¼šä¹…ç»è€ƒéªŒï¼Œå¤§å‚éƒ½åœ¨ç”¨
- ğŸ”§ **æ˜“äºæ‰©å±•**ï¼šçµæ´»çš„å¤„ç†å™¨é“¾
- ğŸ“¦ **åŠŸèƒ½ä¸°å¯Œ**ï¼šå†…ç½®ç¼–è§£ç ã€SSLç­‰

**Netty vs å…¶ä»–æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | æ€§èƒ½ | æ˜“ç”¨æ€§ | ç¨³å®šæ€§ | Dubboé€‰æ‹© |
|------|------|--------|--------|-----------|
| **Netty** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | âœ… é»˜è®¤ |
| **Mina** | â­â­â­â­ | â­â­â­ | â­â­â­â­ | å¯é€‰ |
| **Grizzly** | â­â­â­â­ | â­â­â­ | â­â­â­ | å¯é€‰ |

### 7.2 Dubboä¸­Nettyçš„ä½¿ç”¨


**Providerç«¯å¯åŠ¨NettyæœåŠ¡å™¨**ï¼š

```java
// Dubboå¯åŠ¨NettyæœåŠ¡å™¨çš„ç®€åŒ–é€»è¾‘
public class NettyServer {
    
    public void start(int port) {
        // 1. åˆ›å»ºçº¿ç¨‹ç»„
        EventLoopGroup bossGroup = new NioEventLoopGroup(1);
        EventLoopGroup workerGroup = new NioEventLoopGroup();
        
        try {
            // 2. åˆ›å»ºæœåŠ¡å™¨å¯åŠ¨å™¨
            ServerBootstrap bootstrap = new ServerBootstrap();
            bootstrap.group(bossGroup, workerGroup)
                .channel(NioServerSocketChannel.class)  // NIOæ¨¡å¼
                .childHandler(new ChannelInitializer<Channel>() {
                    protected void initChannel(Channel ch) {
                        // 3. æ·»åŠ å¤„ç†å™¨é“¾
                        ch.pipeline()
                          .addLast(new DubboCodec())      // ç¼–è§£ç 
                          .addLast(new NettyHandler());   // ä¸šåŠ¡å¤„ç†
                    }
                });
            
            // 4. ç»‘å®šç«¯å£ï¼Œå¯åŠ¨æœåŠ¡
            ChannelFuture future = bootstrap.bind(port).sync();
            System.out.println("NettyæœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£: " + port);
            
            // 5. ç­‰å¾…å…³é—­
            future.channel().closeFuture().sync();
        } finally {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }
}
```

**Consumerç«¯åˆ›å»ºNettyå®¢æˆ·ç«¯**ï¼š

```java
// Dubboåˆ›å»ºNettyå®¢æˆ·ç«¯çš„ç®€åŒ–é€»è¾‘
public class NettyClient {
    
    public Channel connect(String host, int port) {
        EventLoopGroup group = new NioEventLoopGroup();
        
        try {
            Bootstrap bootstrap = new Bootstrap();
            bootstrap.group(group)
                .channel(NioSocketChannel.class)
                .handler(new ChannelInitializer<Channel>() {
                    protected void initChannel(Channel ch) {
                        ch.pipeline()
                          .addLast(new DubboCodec())
                          .addLast(new NettyClientHandler());
                    }
                });
            
            // è¿æ¥Provider
            ChannelFuture future = bootstrap.connect(host, port).sync();
            return future.channel();
        } catch (Exception e) {
            group.shutdownGracefully();
            throw new RuntimeException("è¿æ¥å¤±è´¥", e);
        }
    }
}
```

### 7.3 Nettyçš„å¤„ç†å™¨é“¾ï¼ˆPipelineï¼‰


> ğŸ’¡ **ç†è§£Pipeline**ï¼šå°±åƒå·¥å‚æµæ°´çº¿ï¼Œè¯·æ±‚/å“åº”ç»è¿‡ä¸€ç³»åˆ—å¤„ç†å™¨åŠ å·¥ã€‚

**Pipelineå¤„ç†æµç¨‹**ï¼š

```
ã€æ¥æ”¶è¯·æ±‚ã€‘
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§£ç å™¨Handler   â”‚ â† å­—èŠ‚æµâ†’å¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¿ƒè·³Handler     â”‚ â† å¤„ç†å¿ƒè·³æ£€æµ‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡Handler     â”‚ â† æ‰§è¡Œä¸šåŠ¡é€»è¾‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–ç å™¨Handler   â”‚ â† å¯¹è±¡â†’å­—èŠ‚æµ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
ã€å‘é€å“åº”ã€‘
```

**å¸¸ç”¨Handlerç±»å‹**ï¼š

| Handlerç±»å‹ | ä½œç”¨ | ä½ç½® |
|-------------|------|------|
| **DubboCodec** | ç¼–è§£ç Dubboåè®® | æœ€å‰é¢ |
| **IdleStateHandler** | å¿ƒè·³æ£€æµ‹ | ä¸­é—´ |
| **NettyServerHandler** | ä¸šåŠ¡å¤„ç† | æœ€åé¢ |

---

## 8. ğŸ“š åè®®æ ˆç»“æ„è§£æ


### 8.1 ä»€ä¹ˆæ˜¯åè®®æ ˆ


> ğŸ“– **é€šä¿—ç†è§£**ï¼šåè®®æ ˆå°±åƒ"ä¿¡å°æ ¼å¼"ï¼Œè§„å®šäº†æ•°æ®æ€ä¹ˆæ‰“åŒ…ã€æ€ä¹ˆæ ‡è®°ã€æ€ä¹ˆä¼ è¾“ã€‚

**Dubboåè®®æ ˆå±‚æ¬¡**ï¼š

```
åº”ç”¨å±‚: ä¸šåŠ¡æ•°æ®(Userå¯¹è±¡ã€è®¢å•æ•°æ®ç­‰)
   â”‚
   â–¼
Dubboåè®®å±‚: Dubboåè®®å¤´ + åºåˆ—åŒ–æ•°æ®
   â”‚
   â–¼
ä¼ è¾“å±‚: TCPåè®®
   â”‚
   â–¼
ç½‘ç»œå±‚: IPåè®®
   â”‚
   â–¼
æ•°æ®é“¾è·¯å±‚: ä»¥å¤ªç½‘å¸§
```

### 8.2 Dubboåè®®æ ¼å¼è¯¦è§£


**å®Œæ•´åè®®æ ¼å¼ï¼ˆ16å­—èŠ‚å¤´éƒ¨ï¼‰**ï¼š

```
0    1    2    3    4    5    6    7    8    9    10   11   12   13   14   15
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚Magicâ”‚Req â”‚Seriâ”‚Evenâ”‚Statâ”‚           Request ID                â”‚  Data Length  â”‚
â”‚Numberâ”‚Flagâ”‚alizâ”‚    â”‚us  â”‚           (8å­—èŠ‚)                  â”‚   (4å­—èŠ‚)      â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
  2B    1B   1B   1B   1B                8B                            4B

æ€»å…±16å­—èŠ‚å›ºå®šå¤´éƒ¨ + Nå­—èŠ‚æ•°æ®ä½“
```

**å„å­—æ®µå«ä¹‰**ï¼š

| å­—æ®µ | é•¿åº¦ | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|------|------|------|--------|
| **Magic Number** | 2å­—èŠ‚ | é­”æ•°ï¼Œæ ‡è¯†Dubboåè®® | `0xdabb` |
| **Req/Res Flag** | 1ä½ | è¯·æ±‚(1)æˆ–å“åº”(0) | `1` |
| **2Way Flag** | 1ä½ | æ˜¯å¦éœ€è¦å“åº” | `1` |
| **Event Flag** | 1ä½ | æ˜¯å¦äº‹ä»¶æ¶ˆæ¯ | `0` |
| **Serialization ID** | 5ä½ | åºåˆ—åŒ–ç±»å‹ | `2`(Hessian) |
| **Status** | 1å­—èŠ‚ | å“åº”çŠ¶æ€ | `20`(æˆåŠŸ) |
| **Request ID** | 8å­—èŠ‚ | è¯·æ±‚å”¯ä¸€æ ‡è¯† | `123456789` |
| **Data Length** | 4å­—èŠ‚ | æ•°æ®ä½“é•¿åº¦ | `256` |

> ğŸ” **å…³é”®ç†è§£**ï¼šé­”æ•°`0xdabb`å°±åƒå¿«é€’åŒ…è£¹ä¸Šçš„"Dubboä¸“ç”¨"æ ‡ç­¾ï¼Œæ¥æ”¶æ–¹ä¸€çœ‹å°±çŸ¥é“è¿™æ˜¯Dubboåè®®ã€‚

### 8.3 è¯·æ±‚æ•°æ®ä½“ç»“æ„


**Request Bodyå†…å®¹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dubboç‰ˆæœ¬å· (String)            â”‚
â”‚ "2.7.8"                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡æ¥å£å (String)             â”‚
â”‚ "com.example.UserService"      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡ç‰ˆæœ¬ (String)               â”‚
â”‚ "1.0.0"                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–¹æ³•å (String)                 â”‚
â”‚ "getUser"                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°ç±»å‹æè¿° (String)           â”‚
â”‚ "Ljava/lang/Long;"             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°å€¼ (åºåˆ—åŒ–åçš„å­—èŠ‚)         â”‚
â”‚ [0x00, 0x00, 0x00, 0x01]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é™„åŠ å‚æ•° (Map)                  â”‚
â”‚ {"timeout":"3000"}             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 å“åº”æ•°æ®ä½“ç»“æ„


**Response Bodyå†…å®¹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å“åº”æ ‡è¯† (byte)                 â”‚
â”‚ 20 = æˆåŠŸ                       â”‚
â”‚ 30 = å®¢æˆ·ç«¯è¶…æ—¶                 â”‚
â”‚ 31 = æœåŠ¡ç«¯è¶…æ—¶                 â”‚
â”‚ 40 = è¯·æ±‚é”™è¯¯                   â”‚
â”‚ 50 = æœåŠ¡å™¨é”™è¯¯                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿”å›å€¼ç±»å‹ (byte)               â”‚
â”‚ 1 = æœ‰è¿”å›å€¼                    â”‚
â”‚ 2 = æ— è¿”å›å€¼                    â”‚
â”‚ 3 = å¼‚å¸¸                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿”å›å€¼/å¼‚å¸¸ (åºåˆ—åŒ–åçš„å­—èŠ‚)     â”‚
â”‚ Userå¯¹è±¡çš„å­—èŠ‚æ•°æ®               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åè®®å®Œæ•´ç¤ºä¾‹**ï¼š

```
ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚-å“åº”:

ã€Requestã€‘
Header: [0xda, 0xbb, 0xc2, ..., è¯·æ±‚ID=1001, é•¿åº¦=120]
Body:   ["2.7.8", "UserService", "1.0.0", "getUser", "J", 1L]

ã€Responseã€‘  
Header: [0xda, 0xbb, 0x42, ..., è¯·æ±‚ID=1001, é•¿åº¦=80]
Body:   [çŠ¶æ€=20, ç±»å‹=1, User{id=1,name="å¼ ä¸‰"}]
```

---

## 9. ğŸ”„ åºåˆ—åŒ–è¿‡ç¨‹è¯¦è§£


### 9.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–


> ğŸ’¡ **ç”Ÿæ´»æ¯”å–»**ï¼šåºåˆ—åŒ–å°±åƒæŠŠå®¶å…·æ‹†æˆé›¶ä»¶æ‰“åŒ…ï¼Œæ–¹ä¾¿è¿è¾“ï¼›ååºåˆ—åŒ–å°±æ˜¯æ”¶åˆ°åé‡æ–°ç»„è£…ã€‚

**åºåˆ—åŒ–çš„ç›®çš„**ï¼š
- ğŸ“¦ å°†Javaå¯¹è±¡è½¬ä¸ºå­—èŠ‚æµï¼Œæ–¹ä¾¿ç½‘ç»œä¼ è¾“
- ğŸ’¾ å°†å¯¹è±¡æŒä¹…åŒ–åˆ°ç£ç›˜
- ğŸ”„ å®ç°è·¨è¯­è¨€çš„æ•°æ®äº¤æ¢

**åºåˆ—åŒ– vs ååºåˆ—åŒ–**ï¼š

```
ã€åºåˆ—åŒ–ã€‘Javaå¯¹è±¡ â†’ å­—èŠ‚æµ

Userå¯¹è±¡:                  å­—èŠ‚æµ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id = 1   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚ 00 00 00 01 â”‚
â”‚ name="å¼ ä¸‰"â”‚              â”‚ 00 03 E5... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ååºåˆ—åŒ–ã€‘å­—èŠ‚æµ â†’ Javaå¯¹è±¡

å­—èŠ‚æµ:                    Userå¯¹è±¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 00 00 00 01 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ id = 1   â”‚
â”‚ 00 03 E5... â”‚           â”‚ name="å¼ ä¸‰"â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Dubboæ”¯æŒçš„åºåˆ—åŒ–æ–¹å¼


| åºåˆ—åŒ–æ–¹å¼ | ç‰¹ç‚¹ | æ€§èƒ½ | å…¼å®¹æ€§ | æ¨èåº¦ |
|------------|------|------|--------|--------|
| **Hessian2** | äºŒè¿›åˆ¶ï¼Œè·¨è¯­è¨€ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **Fastjson** | JSONæ ¼å¼ï¼Œå¯è¯» | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| **Protobuf** | äºŒè¿›åˆ¶ï¼Œæè‡´æ€§èƒ½ | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| **Kryo** | äºŒè¿›åˆ¶ï¼Œé«˜æ€§èƒ½ | â­â­â­â­â­ | â­â­ | â­â­â­ |
| **FST** | äºŒè¿›åˆ¶ï¼Œå¿«é€Ÿ | â­â­â­â­ | â­â­â­ | â­â­â­ |

> âœ… **æ¨èé€‰æ‹©**ï¼šé»˜è®¤ç”¨Hessian2ï¼Œæ€§èƒ½å’Œå…¼å®¹æ€§æœ€å‡è¡¡ï¼›è¿½æ±‚æè‡´æ€§èƒ½å¯é€‰Protobufã€‚

### 9.3 åºåˆ—åŒ–çš„å®Œæ•´è¿‡ç¨‹


**åºåˆ—åŒ–æµç¨‹**ï¼š

```
ã€Consumerç«¯å‘é€ã€‘
     â”‚
Userå¯¹è±¡ {id:1, name:"å¼ ä¸‰"}
     â”‚
     â–¼
é€‰æ‹©åºåˆ—åŒ–å™¨: Hessian2Serialization
     â”‚
     â–¼
å¯¹è±¡ â†’ å­—èŠ‚è½¬æ¢:
     â”‚
     â–¼
å­—èŠ‚æ•°ç»„: [0x43, 0x00, 0x04, 0x55, 0x73, 0x65, 0x72, ...]
     â”‚
     â–¼
å†™å…¥åè®®Body: è¿½åŠ åˆ°Dubboåè®®ä½“
     â”‚
     â–¼
å‘é€åˆ°ç½‘ç»œ

ã€Providerç«¯æ¥æ”¶ã€‘
     â”‚
ä»ç½‘ç»œæ¥æ”¶å­—èŠ‚æµ
     â”‚
     â–¼
è§£æåè®®å¤´: è¯»å–åºåˆ—åŒ–ç±»å‹ID
     â”‚
     â–¼
é€‰æ‹©ååºåˆ—åŒ–å™¨: Hessian2Serialization
     â”‚
     â–¼
å­—èŠ‚ â†’ å¯¹è±¡è½¬æ¢:
     â”‚
     â–¼
è¿˜åŸUserå¯¹è±¡ {id:1, name:"å¼ ä¸‰"}
```

**Hessian2åºåˆ—åŒ–ç¤ºä¾‹**ï¼š

```java
// Userå¯¹è±¡åºåˆ—åŒ–
User user = new User(1L, "å¼ ä¸‰");

// Hessian2åºåˆ—åŒ–è¿‡ç¨‹ï¼ˆç®€åŒ–ï¼‰
ByteArrayOutputStream bos = new ByteArrayOutputStream();
Hessian2Output output = new Hessian2Output(bos);

// å†™å…¥ç±»å‹æ ‡è¯†
output.writeObject(user);

// å®é™…å†™å…¥å†…å®¹ï¼ˆä¼ªä»£ç ï¼‰:
// 1. å†™å…¥ç±»å: "com.example.User"
// 2. å†™å…¥å­—æ®µæ•°é‡: 2
// 3. å†™å…¥å­—æ®µ1: "id" = 1L
// 4. å†™å…¥å­—æ®µ2: "name" = "å¼ ä¸‰"

byte[] bytes = bos.toByteArray();
```

### 9.4 åºåˆ—åŒ–çš„æ€§èƒ½å¯¹æ¯”


**æ€§èƒ½æµ‹è¯•æ•°æ®**ï¼ˆåºåˆ—åŒ–100ä¸‡æ¬¡ï¼‰ï¼š

```
Hessian2:  è€—æ—¶ 1200ms, ä½“ç§¯ 80MB
Fastjson:  è€—æ—¶ 800ms,  ä½“ç§¯ 120MB
Protobuf:  è€—æ—¶ 600ms,  ä½“ç§¯ 60MB
JavaåŸç”Ÿ:  è€—æ—¶ 2000ms, ä½“ç§¯ 150MB

ç»“è®º:
- é€Ÿåº¦: Protobuf > Fastjson > Hessian2 > JavaåŸç”Ÿ
- ä½“ç§¯: Protobuf < Hessian2 < Fastjson < JavaåŸç”Ÿ
- ç»¼åˆ: Hessian2æœ€å‡è¡¡
```

**é€‰æ‹©å»ºè®®**ï¼š

- âœ… **é»˜è®¤åœºæ™¯** â†’ Hessian2ï¼ˆç¨³å®šå¯é ï¼‰
- âš¡ **é«˜æ€§èƒ½åœºæ™¯** â†’ Protobufï¼ˆéœ€è¦å®šä¹‰.protoæ–‡ä»¶ï¼‰
- ğŸ“ **å¯è¯»æ€§è¦æ±‚** â†’ Fastjsonï¼ˆä¾¿äºè°ƒè¯•ï¼‰
- âŒ **ä¸æ¨è** â†’ JavaåŸç”Ÿï¼ˆæ€§èƒ½å·®ï¼Œä½“ç§¯å¤§ï¼‰

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 è°ƒç”¨æµç¨‹æ€»ç»“


**å®Œæ•´è°ƒç”¨é“¾è·¯**ï¼š

```
ã€å¯åŠ¨é˜¶æ®µã€‘
Provideræš´éœ² â†’ æ³¨å†Œä¸­å¿ƒ â†’ Consumerå¼•ç”¨
     â”‚
     â–¼
ã€è°ƒç”¨é˜¶æ®µã€‘
Consumerè°ƒç”¨ â†’ ä»£ç†æ‹¦æˆª â†’ åºåˆ—åŒ– â†’ ç½‘ç»œä¼ è¾“ 
     â”‚
     â–¼
Provideræ¥æ”¶ â†’ ååºåˆ—åŒ– â†’ æ‰§è¡Œæ–¹æ³• â†’ åºåˆ—åŒ–ç»“æœ
     â”‚
     â–¼
ã€è¿”å›é˜¶æ®µã€‘
ç½‘ç»œä¼ è¾“ â†’ Consumerååºåˆ—åŒ– â†’ è¿”å›ç»“æœ
```

### 10.2 å…³é”®æ¦‚å¿µè®°å¿†


> ğŸ”¸ **æœåŠ¡æš´éœ²**ï¼šæŠŠJavaæ–¹æ³•å˜æˆç½‘ç»œæœåŠ¡
> ğŸ”¸ **æœåŠ¡å¼•ç”¨**ï¼šåˆ›å»ºè¿œç¨‹è°ƒç”¨çš„ä»£ç†å¯¹è±¡
> ğŸ”¸ **ä»£ç†æœºåˆ¶**ï¼šæœ¬åœ°è°ƒç”¨è‡ªåŠ¨è½¬ç½‘ç»œè°ƒç”¨
> ğŸ”¸ **Netty**ï¼šé«˜æ€§èƒ½NIOç½‘ç»œæ¡†æ¶
> ğŸ”¸ **åè®®æ ˆ**ï¼šè§„å®šæ•°æ®æ‰“åŒ…æ ¼å¼
> ğŸ”¸ **åºåˆ—åŒ–**ï¼šå¯¹è±¡ä¸å­—èŠ‚æµäº’è½¬

### 10.3 æ ¸å¿ƒæµç¨‹å›¾


```
å¯åŠ¨é˜¶æ®µ                 è°ƒç”¨é˜¶æ®µ                 æ‰§è¡Œé˜¶æ®µ
   â”‚                       â”‚                       â”‚
   â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æœåŠ¡æš´éœ² â”‚          â”‚ä»£ç†æ‹¦æˆª â”‚          â”‚ååºåˆ—åŒ– â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚æ³¨å†ŒæœåŠ¡ â”‚          â”‚åºåˆ—åŒ–   â”‚          â”‚æ‰§è¡Œæ–¹æ³• â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚æœåŠ¡å¼•ç”¨ â”‚          â”‚ç½‘ç»œä¼ è¾“ â”‚          â”‚åºåˆ—åŒ–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.4 å®æˆ˜è¦ç‚¹æé†’


> âš ï¸ **æ€§èƒ½ä¼˜åŒ–**ï¼š
> - åˆç†é€‰æ‹©åºåˆ—åŒ–æ–¹å¼
> - æ§åˆ¶çº¿ç¨‹æ± å¤§å°
> - å¯ç”¨è¿æ¥å¤ç”¨

> ğŸ›¡ï¸ **ç¨³å®šæ€§ä¿éšœ**ï¼š
> - è®¾ç½®åˆç†è¶…æ—¶æ—¶é—´
> - é…ç½®é‡è¯•ç­–ç•¥
> - ç›‘æ§æœåŠ¡çŠ¶æ€

> ğŸ”§ **æœ€ä½³å®è·µ**ï¼š
> - Provideræ— çŠ¶æ€è®¾è®¡
> - æ¥å£å‚æ•°ç®€å•åŒ–
> - é¿å…å¤§å¯¹è±¡ä¼ è¾“

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æœåŠ¡æš´éœ²å¯ç½‘ç»œï¼Œæ³¨å†Œä¸­å¿ƒæ¥ç™»è®°
- æœåŠ¡å¼•ç”¨åˆ›ä»£ç†ï¼Œæœ¬åœ°è°ƒç”¨å˜è¿œç¨‹
- åºåˆ—åŒ–æ‰“åŒ…è£…ï¼ŒNettyè´Ÿè´£æ¥ä¼ è¾“
- åè®®æ ¼å¼è¦è§„èŒƒï¼Œè¯·æ±‚å“åº”èƒ½åŒ¹é…