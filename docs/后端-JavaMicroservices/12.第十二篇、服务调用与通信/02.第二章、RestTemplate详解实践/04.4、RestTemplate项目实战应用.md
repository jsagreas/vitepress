---
title: 4ã€RestTemplateé¡¹ç›®å®æˆ˜åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [ç»Ÿä¸€è¿”å›ç»“æœå°è£…](#1-ç»Ÿä¸€è¿”å›ç»“æœå°è£…)
2. [å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ](#2-å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ)
3. [è¯·æ±‚é‡è¯•æœºåˆ¶å®ç°](#3-è¯·æ±‚é‡è¯•æœºåˆ¶å®ç°)
4. [æ—¥å¿—è®°å½•ä¸ç›‘æ§](#4-æ—¥å¿—è®°å½•ä¸ç›‘æ§)
5. [å•å…ƒæµ‹è¯•ç¼–å†™](#5-å•å…ƒæµ‹è¯•ç¼–å†™)
6. [MockæœåŠ¡è°ƒç”¨æµ‹è¯•](#6-MockæœåŠ¡è°ƒç”¨æµ‹è¯•)
7. [å·¥å…·ç±»å°è£…è®¾è®¡](#7-å·¥å…·ç±»å°è£…è®¾è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¦ ç»Ÿä¸€è¿”å›ç»“æœå°è£…


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€è¿”å›ç»“æœ


åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸åŒçš„æœåŠ¡å¯èƒ½è¿”å›å„ç§å„æ ·çš„æ•°æ®æ ¼å¼ã€‚æœ‰çš„è¿”å›JSONå¯¹è±¡ï¼Œæœ‰çš„è¿”å›æ•°ç»„ï¼Œè¿˜æœ‰çš„ç›´æ¥è¿”å›å­—ç¬¦ä¸²ã€‚è¿™å°±åƒä½ å»ä¸åŒçš„å•†åº—ä¹°ä¸œè¥¿ï¼Œæ¯å®¶åº—ç»™ä½ çš„å°ç¥¨æ ¼å¼éƒ½ä¸ä¸€æ ·ï¼Œå¤„ç†èµ·æ¥éå¸¸éº»çƒ¦ã€‚

**ç»Ÿä¸€è¿”å›æ ¼å¼å°±åƒåˆ¶å®šä¸€ä¸ªæ ‡å‡†**ï¼šæ‰€æœ‰æœåŠ¡éƒ½ç”¨åŒæ ·çš„"åŒ…è£…ç›’"æ¥è¿”å›æ•°æ®ï¼Œè¿™æ ·æ¥æ”¶æ–¹å°±çŸ¥é“å¦‚ä½•æ‹†åŒ…äº†ã€‚

```
æœªç»Ÿä¸€çš„æƒ…å†µï¼š
æœåŠ¡Aè¿”å›: {"name": "å¼ ä¸‰"}
æœåŠ¡Bè¿”å›: [{"id": 1}, {"id": 2}]
æœåŠ¡Cè¿”å›: "success"
ğŸ‘‰ æ¯æ¬¡éƒ½è¦çŒœæµ‹è¿”å›çš„æ˜¯ä»€ä¹ˆæ ¼å¼

ç»Ÿä¸€åçš„æƒ…å†µï¼š
æ‰€æœ‰æœåŠ¡éƒ½è¿”å›:
{
  "code": 200,        // çŠ¶æ€ç ï¼šæˆåŠŸè¿˜æ˜¯å¤±è´¥
  "message": "æˆåŠŸ",   // æç¤ºä¿¡æ¯
  "data": {...}       // çœŸæ­£çš„æ•°æ®
}
ğŸ‘‰ ä¸€çœ‹å°±çŸ¥é“ç»“æœå¦‚ä½•ï¼Œæ•°æ®åœ¨å“ª
```

### 1.2 è®¾è®¡é€šç”¨è¿”å›ç»“æœç±»


**æ ¸å¿ƒæ€è·¯**ï¼šè®¾è®¡ä¸€ä¸ª"ä¸‡èƒ½å®¹å™¨"ï¼Œèƒ½è£…ä¸‹ä»»ä½•ç±»å‹çš„è¿”å›æ•°æ®

```java
/**
 * ç»Ÿä¸€è¿”å›ç»“æœç±»
 * å°±åƒä¸€ä¸ªæ ‡å‡†å¿«é€’ç›’ï¼Œé‡Œé¢å¯ä»¥æ”¾ä»»ä½•ä¸œè¥¿
 */
public class Result<T> {
    private Integer code;      // çŠ¶æ€ç ï¼š200æˆåŠŸï¼Œ500å¤±è´¥
    private String message;    // æç¤ºä¿¡æ¯ï¼šå‘Šè¯‰ç”¨æˆ·å‘ç”Ÿäº†ä»€ä¹ˆ
    private T data;           // å®é™…æ•°æ®ï¼šæ³›å‹ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹
    
    // æˆåŠŸæ—¶çš„å¿«æ·æ–¹æ³•
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("æ“ä½œæˆåŠŸ");
        result.setData(data);
        return result;
    }
    
    // å¤±è´¥æ—¶çš„å¿«æ·æ–¹æ³•
    public static <T> Result<T> fail(String message) {
        Result<T> result = new Result<>();
        result.setCode(500);
        result.setMessage(message);
        return result;
    }
    
    // getterå’Œsetterçœç•¥...
}
```

**å…³é”®ç†è§£**ï¼š
- `<T>`æ˜¯æ³›å‹ï¼Œæ„æ€æ˜¯"ä»»æ„ç±»å‹"ï¼Œå¯ä»¥æ˜¯Userã€Listã€Stringç­‰
- `code`æ˜¯çŠ¶æ€ç ï¼Œçº¦å®šå¥½ï¼š200è¡¨ç¤ºæˆåŠŸï¼Œ500è¡¨ç¤ºå¤±è´¥
- `message`æ˜¯ç»™äººçœ‹çš„æç¤ºä¿¡æ¯
- `data`æ˜¯çœŸæ­£çš„ä¸šåŠ¡æ•°æ®

### 1.3 åœ¨RestTemplateä¸­ä½¿ç”¨ç»Ÿä¸€ç»“æœ


**å®é™…åº”ç”¨åœºæ™¯**ï¼šè°ƒç”¨å…¶ä»–æœåŠ¡å¹¶ç»Ÿä¸€å¤„ç†è¿”å›ç»“æœ

```java
@Service
public class UserService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
     * è¿™ä¸ªæ–¹æ³•å±•ç¤ºäº†å¦‚ä½•å¤„ç†ç»Ÿä¸€æ ¼å¼çš„è¿”å›ç»“æœ
     */
    public User getUserById(Long userId) {
        String url = "http://user-service/user/" + userId;
        
        // ParameterizedTypeReferenceï¼šå‘Šè¯‰RestTemplateè¿”å›çš„ç±»å‹
        // è¿™é‡Œæ˜¯Result<User>ï¼Œæ„æ€æ˜¯ResultåŒ…è£…çš„Userå¯¹è±¡
        ParameterizedTypeReference<Result<User>> responseType = 
            new ParameterizedTypeReference<Result<User>>() {};
        
        // å‘èµ·è¯·æ±‚
        ResponseEntity<Result<User>> response = 
            restTemplate.exchange(url, HttpMethod.GET, null, responseType);
        
        // è·å–è¿”å›ç»“æœ
        Result<User> result = response.getBody();
        
        // åˆ¤æ–­æ˜¯å¦æˆåŠŸ
        if (result.getCode() == 200) {
            return result.getData();  // æˆåŠŸå°±è¿”å›æ•°æ®
        } else {
            throw new RuntimeException(result.getMessage());  // å¤±è´¥å°±æŠ›å¼‚å¸¸
        }
    }
}
```

**`ParameterizedTypeReference`æ˜¯ä»€ä¹ˆ**ï¼Ÿ
- æ™®é€šçš„`Class`åªèƒ½è¡¨ç¤ºç®€å•ç±»å‹ï¼Œæ¯”å¦‚`User.class`
- ä½†`Result<User>`æ˜¯å¸¦æ³›å‹çš„å¤æ‚ç±»å‹ï¼Œéœ€è¦ç”¨`ParameterizedTypeReference`
- å®ƒèƒ½å‘Šè¯‰RestTemplateï¼š"æˆ‘è¦çš„è¿”å›ç»“æœæ˜¯ResultåŒ…è£…çš„Userå¯¹è±¡"

### 1.4 ä¸šåŠ¡çŠ¶æ€ç è®¾è®¡


å®é™…é¡¹ç›®ä¸­ï¼Œåªç”¨200å’Œ500å¤ªç®€å•äº†ã€‚æˆ‘ä»¬éœ€è¦æ›´è¯¦ç»†çš„çŠ¶æ€ç æ¥è¡¨ç¤ºä¸åŒçš„ä¸šåŠ¡æƒ…å†µï¼š

```java
/**
 * ä¸šåŠ¡çŠ¶æ€ç æšä¸¾
 * å®šä¹‰å„ç§ä¸šåŠ¡åœºæ™¯çš„çŠ¶æ€ç 
 */
public enum ResultCode {
    SUCCESS(200, "æ“ä½œæˆåŠŸ"),
    FAILED(500, "æ“ä½œå¤±è´¥"),
    
    // å‚æ•°ç›¸å…³ 4xx
    PARAM_ERROR(400, "å‚æ•°é”™è¯¯"),
    UNAUTHORIZED(401, "æœªç™»å½•"),
    FORBIDDEN(403, "æ— æƒé™"),
    NOT_FOUND(404, "èµ„æºä¸å­˜åœ¨"),
    
    // ä¸šåŠ¡ç›¸å…³ 5xx
    USER_NOT_EXIST(1001, "ç”¨æˆ·ä¸å­˜åœ¨"),
    USER_ALREADY_EXIST(1002, "ç”¨æˆ·å·²å­˜åœ¨"),
    PASSWORD_ERROR(1003, "å¯†ç é”™è¯¯"),
    
    // ç³»ç»Ÿç›¸å…³
    SYSTEM_ERROR(9999, "ç³»ç»Ÿå¼‚å¸¸");
    
    private Integer code;
    private String message;
    
    ResultCode(Integer code, String message) {
        this.code = code;
        this.message = message;
    }
    
    // getteræ–¹æ³•...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
// æˆåŠŸè¿”å›
return Result.success(user);

// å¤±è´¥è¿”å›ï¼ˆå¸¦å…·ä½“é”™è¯¯ç ï¼‰
return Result.fail(ResultCode.USER_NOT_EXIST);

// è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯
return Result.fail(ResultCode.PARAM_ERROR, "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®");
```

---

## 2. ğŸ›¡ï¸ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


### 2.1 ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†


è°ƒç”¨å…¶ä»–æœåŠ¡å°±åƒæ‰“ç”µè¯ï¼Œå¯èƒ½é‡åˆ°å„ç§é—®é¢˜ï¼š

```
åœºæ™¯1ï¼šå¯¹æ–¹å…³æœºäº†ï¼ˆæœåŠ¡æŒ‚äº†ï¼‰
åœºæ™¯2ï¼šå¯¹æ–¹ä¸æ¥ï¼ˆè¶…æ—¶ï¼‰
åœºæ™¯3ï¼šå¯¹æ–¹è¯´è¯ä½ å¬ä¸æ‡‚ï¼ˆè¿”å›æ•°æ®æ ¼å¼é”™è¯¯ï¼‰
åœºæ™¯4ï¼šå¯¹æ–¹è¯´"æˆ‘ä¸çŸ¥é“"ï¼ˆä¸šåŠ¡å¼‚å¸¸ï¼‰
```

**å¦‚æœä¸å¤„ç†è¿™äº›å¼‚å¸¸**ï¼Œä½ çš„ç¨‹åºå°±ä¼šå´©æºƒã€‚å°±åƒæ‰“ç”µè¯æ²¡äººæ¥ï¼Œä½ ä¸èƒ½ä¸€ç›´ç­‰ç€ï¼Œè¦æœ‰Plan Bã€‚

### 2.2 RestTemplateå¼‚å¸¸ä½“ç³»


RestTemplateè°ƒç”¨æ—¶å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼š

```
RestClientExceptionï¼ˆçˆ¶ç±»å¼‚å¸¸ï¼‰
    â”œâ”€â”€ ResourceAccessException     // ç½‘ç»œé—®é¢˜ï¼šè¿ä¸ä¸Šã€è¶…æ—¶
    â”œâ”€â”€ HttpClientErrorException    // å®¢æˆ·ç«¯é”™è¯¯ï¼š4xxï¼ˆå‚æ•°é”™è¯¯ã€æœªæˆæƒç­‰ï¼‰
    â”œâ”€â”€ HttpServerErrorException    // æœåŠ¡ç«¯é”™è¯¯ï¼š5xxï¼ˆæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼‰
    â””â”€â”€ RestClientResponseException // å…¶ä»–HTTPç›¸å…³å¼‚å¸¸
```

### 2.3 å¼‚å¸¸å¤„ç†ç­–ç•¥


**ç­–ç•¥ä¸€ï¼šæ•è·å¹¶è½¬æ¢å¼‚å¸¸**

æŠŠåº•å±‚çš„æŠ€æœ¯å¼‚å¸¸è½¬æ¢æˆä¸šåŠ¡å¼‚å¸¸ï¼Œè®©è°ƒç”¨æ–¹æ›´å®¹æ˜“ç†è§£ï¼š

```java
@Service
public class OrderService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜
     * å±•ç¤ºå¦‚ä½•ä¼˜é›…åœ°å¤„ç†å„ç§å¼‚å¸¸
     */
    public void deductStock(Long productId, Integer quantity) {
        String url = "http://stock-service/stock/deduct";
        
        // æ„å»ºè¯·æ±‚å‚æ•°
        Map<String, Object> params = new HashMap<>();
        params.put("productId", productId);
        params.put("quantity", quantity);
        
        try {
            // å‘èµ·è¯·æ±‚
            Result result = restTemplate.postForObject(url, params, Result.class);
            
            // æ£€æŸ¥ä¸šåŠ¡ç»“æœ
            if (result.getCode() != 200) {
                throw new BusinessException("æ‰£å‡åº“å­˜å¤±è´¥ï¼š" + result.getMessage());
            }
            
        } catch (ResourceAccessException e) {
            // ç½‘ç»œé—®é¢˜ï¼šè¿æ¥è¶…æ—¶ã€è¯»å–è¶…æ—¶ç­‰
            throw new BusinessException("åº“å­˜æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•", e);
            
        } catch (HttpClientErrorException e) {
            // å®¢æˆ·ç«¯é”™è¯¯ï¼šå‚æ•°é”™è¯¯ã€æœªæˆæƒç­‰
            throw new BusinessException("è¯·æ±‚åº“å­˜æœåŠ¡å¤±è´¥ï¼š" + e.getMessage(), e);
            
        } catch (HttpServerErrorException e) {
            // æœåŠ¡ç«¯é”™è¯¯ï¼šåº“å­˜æœåŠ¡å†…éƒ¨é”™è¯¯
            throw new BusinessException("åº“å­˜æœåŠ¡å¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜", e);
            
        } catch (Exception e) {
            // å…¶ä»–æœªçŸ¥å¼‚å¸¸
            throw new BusinessException("æ‰£å‡åº“å­˜æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯", e);
        }
    }
}
```

**å…³é”®ç†è§£**ï¼š
- ä¸åŒå¼‚å¸¸ç±»å‹å¯¹åº”ä¸åŒçš„å¤„ç†ç­–ç•¥
- `ResourceAccessException`ï¼šç½‘ç»œé—®é¢˜ï¼Œå¯èƒ½éœ€è¦é‡è¯•
- `HttpClientErrorException`ï¼šæˆ‘ä»¬çš„å‚æ•°æœ‰é—®é¢˜ï¼Œéœ€è¦ä¿®æ­£
- `HttpServerErrorException`ï¼šå¯¹æ–¹æœåŠ¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬æ— èƒ½ä¸ºåŠ›

**ç­–ç•¥äºŒï¼šè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨**

åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œç»Ÿä¸€å¤„ç†RestTemplateå¼‚å¸¸ï¼š

```java
/**
 * RestTemplateå¼‚å¸¸å¤„ç†å™¨
 * é›†ä¸­å¤„ç†æ‰€æœ‰RestTemplateè°ƒç”¨å¼‚å¸¸
 */
@Component
public class RestTemplateErrorHandler implements ResponseErrorHandler {
    
    /**
     * åˆ¤æ–­å“åº”æ˜¯å¦æœ‰é”™è¯¯
     * å°±åƒæ£€æŸ¥å¿«é€’åŒ…è£¹æ˜¯å¦æŸå
     */
    @Override
    public boolean hasError(ClientHttpResponse response) throws IOException {
        HttpStatus status = response.getStatusCode();
        // 4xxå’Œ5xxéƒ½è®¤ä¸ºæ˜¯é”™è¯¯
        return status.is4xxClientError() || status.is5xxServerError();
    }
    
    /**
     * å¤„ç†é”™è¯¯å“åº”
     * æ ¹æ®ä¸åŒçš„é”™è¯¯ç åšä¸åŒçš„å¤„ç†
     */
    @Override
    public void handleError(ClientHttpResponse response) throws IOException {
        HttpStatus status = response.getStatusCode();
        
        // è¯»å–é”™è¯¯ä¿¡æ¯
        String errorMsg = StreamUtils.copyToString(
            response.getBody(), StandardCharsets.UTF_8);
        
        if (status.is4xxClientError()) {
            // å®¢æˆ·ç«¯é”™è¯¯ï¼šå¯èƒ½æ˜¯æˆ‘ä»¬çš„å‚æ•°æœ‰é—®é¢˜
            throw new BusinessException("è¯·æ±‚å‚æ•°é”™è¯¯ï¼š" + errorMsg);
            
        } else if (status.is5xxServerError()) {
            // æœåŠ¡ç«¯é”™è¯¯ï¼šå¯¹æ–¹æœåŠ¡æœ‰é—®é¢˜
            throw new BusinessException("è¿œç¨‹æœåŠ¡å¼‚å¸¸ï¼š" + errorMsg);
        }
    }
}

// é…ç½®åˆ°RestTemplate
@Bean
public RestTemplate restTemplate() {
    RestTemplate restTemplate = new RestTemplate();
    restTemplate.setErrorHandler(new RestTemplateErrorHandler());
    return restTemplate;
}
```

### 2.4 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µæ€»ç»“


| å¼‚å¸¸ç±»å‹ | **å«ä¹‰** | **å¤„ç†å»ºè®®** | **æ˜¯å¦é‡è¯•** |
|---------|---------|-------------|-------------|
| `ResourceAccessException` | `ç½‘ç»œè¿æ¥é—®é¢˜` | `è®°å½•æ—¥å¿—ï¼Œå¯é‡è¯•` | `âœ… å¯ä»¥` |
| `HttpClientErrorException` | `å®¢æˆ·ç«¯é”™è¯¯(4xx)` | `æ£€æŸ¥å‚æ•°ï¼Œä¿®æ­£åé‡è¯•` | `âŒ ä¸å»ºè®®` |
| `HttpServerErrorException` | `æœåŠ¡ç«¯é”™è¯¯(5xx)` | `è®°å½•æ—¥å¿—ï¼Œé™çº§å¤„ç†` | `âš ï¸ è°¨æ…é‡è¯•` |
| `RestClientException` | `å…¶ä»–RestTemplateå¼‚å¸¸` | `è®°å½•å®Œæ•´å †æ ˆï¼Œäººå·¥ä»‹å…¥` | `âŒ ä¸å»ºè®®` |

**è®°å¿†å£è¯€**ï¼š
```
ç½‘ç»œé—®é¢˜å¯é‡è¯•ï¼Œå‚æ•°é”™è¯¯è¦ä¿®æ­£
æœåŠ¡å¼‚å¸¸éœ€é™çº§ï¼ŒæœªçŸ¥é”™è¯¯è®°æ—¥å¿—
```

---

## 3. ğŸ”„ è¯·æ±‚é‡è¯•æœºåˆ¶å®ç°


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦é‡è¯•æœºåˆ¶


æƒ³è±¡ä½ åœ¨ç½‘è´­æ—¶æ”¯ä»˜å¤±è´¥äº†ï¼Œç³»ç»Ÿä¼šæç¤º"ç½‘ç»œæ³¢åŠ¨ï¼Œè¯·é‡è¯•"ã€‚è¿™å°±æ˜¯é‡è¯•æœºåˆ¶çš„åº”ç”¨åœºæ™¯ã€‚

**é‡è¯•çš„æ ¸å¿ƒç›®çš„**ï¼šåº”å¯¹**ä¸´æ—¶æ€§æ•…éšœ**ï¼Œæé«˜ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›

```
ä¸´æ—¶æ€§æ•…éšœç¤ºä¾‹ï¼š
âŒ ç½‘ç»œæŠ–åŠ¨ï¼šæ•°æ®åŒ…ä¸¢å¤±
âŒ æœåŠ¡é‡å¯ï¼šçŸ­æš‚ä¸å¯ç”¨  
âŒ ç¬æ—¶è´Ÿè½½é«˜ï¼šæš‚æ—¶å“åº”æ…¢

è¿™äº›é—®é¢˜é‡è¯•ä¸€ä¸‹å¯èƒ½å°±å¥½äº†ï¼
```

**ä½†ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½åº”è¯¥é‡è¯•**ï¼š

```
âœ… é€‚åˆé‡è¯•çš„åœºæ™¯ï¼š
- ç½‘ç»œè¶…æ—¶
- è¿æ¥è¢«æ‹’ç»
- è¯»å–æ•°æ®è¶…æ—¶
- ä¸´æ—¶çš„5xxé”™è¯¯

âŒ ä¸é€‚åˆé‡è¯•çš„åœºæ™¯ï¼š
- å‚æ•°é”™è¯¯ï¼ˆ4xxï¼‰ï¼šé‡è¯•ä¹Ÿè¿˜æ˜¯é”™
- ä¸šåŠ¡å¼‚å¸¸ï¼šæ¯”å¦‚ä½™é¢ä¸è¶³
- å¹‚ç­‰æ€§é—®é¢˜ï¼šé‡å¤æ‰§è¡Œä¼šå¯¼è‡´é—®é¢˜
```

### 3.2 ä½¿ç”¨Spring Retryå®ç°é‡è¯•


**ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**

```xml
<dependency>
    <groupId>org.springframework.retry</groupId>
    <artifactId>spring-retry</artifactId>
</dependency>
```

**ç¬¬äºŒæ­¥ï¼šå¯ç”¨é‡è¯•åŠŸèƒ½**

```java
@Configuration
@EnableRetry  // å¼€å¯é‡è¯•åŠŸèƒ½
public class RetryConfig {
}
```

**ç¬¬ä¸‰æ­¥ï¼šåœ¨æ–¹æ³•ä¸Šæ·»åŠ é‡è¯•æ³¨è§£**

```java
@Service
public class PaymentService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * è°ƒç”¨æ”¯ä»˜æœåŠ¡
     * @Retryableï¼šè¿™ä¸ªæ³¨è§£è¡¨ç¤ºæ–¹æ³•å¯ä»¥é‡è¯•
     */
    @Retryable(
        value = {ResourceAccessException.class},  // é‡åˆ°è¿™ä¸ªå¼‚å¸¸æ‰é‡è¯•
        maxAttempts = 3,                          // æœ€å¤šé‡è¯•3æ¬¡
        backoff = @Backoff(delay = 1000)         // æ¯æ¬¡é‡è¯•é—´éš”1ç§’
    )
    public PaymentResult callPaymentService(PaymentRequest request) {
        String url = "http://payment-service/pay";
        
        try {
            return restTemplate.postForObject(url, request, PaymentResult.class);
        } catch (ResourceAccessException e) {
            // ç½‘ç»œå¼‚å¸¸ï¼Œä¼šè‡ªåŠ¨é‡è¯•
            throw e;
        } catch (HttpClientErrorException e) {
            // å‚æ•°é”™è¯¯ï¼Œä¸é‡è¯•ï¼Œç›´æ¥æŠ›å‡º
            throw new BusinessException("æ”¯ä»˜å‚æ•°é”™è¯¯", e);
        }
    }
    
    /**
     * å½“é‡è¯•å…¨éƒ¨å¤±è´¥åï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•
     * @Recoverï¼šé‡è¯•å¤±è´¥çš„å…œåº•æ–¹æ³•
     */
    @Recover
    public PaymentResult recover(ResourceAccessException e, PaymentRequest request) {
        // è®°å½•æ—¥å¿—
        log.error("æ”¯ä»˜æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œå·²é‡è¯•3æ¬¡ï¼Œè®¢å•å·ï¼š{}", request.getOrderNo(), e);
        
        // è¿”å›é»˜è®¤ç»“æœæˆ–é™çº§å¤„ç†
        return PaymentResult.failed("æ”¯ä»˜æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

**æ³¨è§£å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | **å«ä¹‰** | **ç¤ºä¾‹** |
|------|---------|---------|
| `value` | `å“ªäº›å¼‚å¸¸è§¦å‘é‡è¯•` | `ResourceAccessException.class` |
| `maxAttempts` | `æœ€å¤šé‡è¯•å‡ æ¬¡` | `3ï¼ˆåŒ…å«ç¬¬ä¸€æ¬¡ï¼Œå®é™…é‡è¯•2æ¬¡ï¼‰` |
| `backoff` | `é‡è¯•é—´éš”ç­–ç•¥` | `@Backoff(delay = 1000)` |

### 3.3 é«˜çº§é‡è¯•ç­–ç•¥


**æŒ‡æ•°é€€é¿ç­–ç•¥**ï¼šæ¯æ¬¡é‡è¯•çš„é—´éš”æ—¶é—´é€æ¸å¢åŠ 

```java
@Retryable(
    value = {ResourceAccessException.class},
    maxAttempts = 4,
    backoff = @Backoff(
        delay = 1000,        // åˆå§‹å»¶è¿Ÿ1ç§’
        multiplier = 2,      // æ¯æ¬¡å»¶è¿Ÿæ—¶é—´ç¿»å€
        maxDelay = 10000     // æœ€å¤§å»¶è¿Ÿ10ç§’
    )
)
public void callServiceWithExponentialBackoff() {
    // é‡è¯•é—´éš”ï¼š1ç§’ -> 2ç§’ -> 4ç§’ -> 8ç§’
}
```

**ä¸ºä»€ä¹ˆè¦æŒ‡æ•°é€€é¿**ï¼Ÿ
```
å›ºå®šé—´éš”1ç§’ï¼š1ç§’ -> 1ç§’ -> 1ç§’ -> 1ç§’
ğŸ‘‰ å¦‚æœæœåŠ¡å‹åŠ›å¤§ï¼Œé‡è¯•å¤ªå¿«å¯èƒ½åŠ é‡è´Ÿæ‹…

æŒ‡æ•°é€€é¿ï¼š1ç§’ -> 2ç§’ -> 4ç§’ -> 8ç§’  
ğŸ‘‰ ç»™æœåŠ¡æ›´å¤šæ—¶é—´æ¢å¤ï¼Œé¿å…"é›ªä¸ŠåŠ éœœ"
```

**è‡ªå®šä¹‰é‡è¯•ç­–ç•¥**ï¼š

```java
@Configuration
public class CustomRetryConfig {
    
    @Bean
    public RetryTemplate retryTemplate() {
        RetryTemplate retryTemplate = new RetryTemplate();
        
        // é‡è¯•ç­–ç•¥ï¼šæœ€å¤š3æ¬¡
        SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();
        retryPolicy.setMaxAttempts(3);
        
        // é€€é¿ç­–ç•¥ï¼šæŒ‡æ•°é€€é¿
        ExponentialBackOffPolicy backOffPolicy = new ExponentialBackOffPolicy();
        backOffPolicy.setInitialInterval(1000L);  // åˆå§‹1ç§’
        backOffPolicy.setMultiplier(2.0);         // å€æ•°2
        backOffPolicy.setMaxInterval(10000L);     // æœ€å¤§10ç§’
        
        retryTemplate.setRetryPolicy(retryPolicy);
        retryTemplate.setBackOffPolicy(backOffPolicy);
        
        return retryTemplate;
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰RetryTemplate
@Service
public class OrderService {
    
    @Autowired
    private RetryTemplate retryTemplate;
    
    public void createOrder(Order order) {
        retryTemplate.execute(context -> {
            // è¿™é‡Œçš„ä»£ç ä¼šè‡ªåŠ¨é‡è¯•
            return restTemplate.postForObject(url, order, Result.class);
        });
    }
}
```

### 3.4 é‡è¯•æœºåˆ¶æ³¨æ„äº‹é¡¹


âš ï¸ **é‡è¦æé†’**ï¼š

```java
// âŒ é”™è¯¯ï¼šå¯¹éå¹‚ç­‰æ“ä½œé‡è¯•
@Retryable
public void deductMoney(Long userId, BigDecimal amount) {
    // æ‰£æ¬¾æ“ä½œé‡è¯•ä¼šå¯¼è‡´é‡å¤æ‰£æ¬¾ï¼
    restTemplate.postForObject(url, params, Result.class);
}

// âœ… æ­£ç¡®ï¼šæ·»åŠ å¹‚ç­‰æ€§ä¿è¯
@Retryable
public void deductMoneyIdempotent(Long userId, BigDecimal amount, String requestId) {
    // ä½¿ç”¨requestIdä¿è¯å¹‚ç­‰æ€§
    params.put("requestId", requestId);  // æœåŠ¡ç«¯ä¼šæ£€æŸ¥è¿™ä¸ªID
    restTemplate.postForObject(url, params, Result.class);
}
```

**å¹‚ç­‰æ€§æ˜¯ä»€ä¹ˆ**ï¼Ÿ
- åŒä¸€ä¸ªæ“ä½œæ‰§è¡Œ1æ¬¡å’Œæ‰§è¡ŒNæ¬¡ï¼Œç»“æœæ˜¯ä¸€æ ·çš„
- æŸ¥è¯¢æ“ä½œå¤©ç„¶å¹‚ç­‰
- æ‰£æ¬¾ã€ä¸‹å•è¿™ç§æ“ä½œéœ€è¦ç‰¹æ®Šè®¾è®¡æ‰èƒ½ä¿è¯å¹‚ç­‰

---

## 4. ğŸ“Š æ—¥å¿—è®°å½•ä¸ç›‘æ§


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—ç›‘æ§


è°ƒç”¨å…¶ä»–æœåŠ¡å°±åƒå¯„å¿«é€’ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼š
- ğŸ“¦ å¿«é€’å‘å‡ºå»äº†æ²¡ï¼Ÿï¼ˆè¯·æ±‚æ˜¯å¦æˆåŠŸå‘é€ï¼‰
- ğŸšš å¿«é€’åˆ°å“ªäº†ï¼Ÿï¼ˆè°ƒç”¨è¿‡ç¨‹è¿½è¸ªï¼‰
- â±ï¸ èŠ±äº†å¤šé•¿æ—¶é—´ï¼Ÿï¼ˆæ€§èƒ½ç›‘æ§ï¼‰
- âŒ æœ‰æ²¡æœ‰ä¸¢ä»¶ï¼Ÿï¼ˆå¼‚å¸¸æƒ…å†µè®°å½•ï¼‰

**æ²¡æœ‰æ—¥å¿—çš„åæœ**ï¼šå‡ºé—®é¢˜æ—¶ä¸¤çœ¼ä¸€æŠ¹é»‘ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºé”™äº†ã€‚

### 4.2 è¯·æ±‚æ—¥å¿—è®°å½•


**æ ¸å¿ƒæ€è·¯**ï¼šè®°å½•æ¯æ¬¡è°ƒç”¨çš„å…³é”®ä¿¡æ¯

```java
@Slf4j
@Service
public class UserService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public User getUserInfo(Long userId) {
        String url = "http://user-service/user/" + userId;
        
        // 1. è®°å½•è¯·æ±‚å¼€å§‹
        log.info("å¼€å§‹è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼ŒuserId={}, url={}", userId, url);
        long startTime = System.currentTimeMillis();
        
        try {
            // 2. å‘èµ·è¯·æ±‚
            User user = restTemplate.getForObject(url, User.class);
            
            // 3. è®°å½•è¯·æ±‚æˆåŠŸ
            long costTime = System.currentTimeMillis() - startTime;
            log.info("è°ƒç”¨ç”¨æˆ·æœåŠ¡æˆåŠŸï¼ŒuserId={}, è€—æ—¶={}ms, ç»“æœ={}", 
                userId, costTime, user);
            
            return user;
            
        } catch (Exception e) {
            // 4. è®°å½•è¯·æ±‚å¤±è´¥
            long costTime = System.currentTimeMillis() - startTime;
            log.error("è°ƒç”¨ç”¨æˆ·æœåŠ¡å¤±è´¥ï¼ŒuserId={}, è€—æ—¶={}ms, é”™è¯¯ä¿¡æ¯={}", 
                userId, costTime, e.getMessage(), e);
            
            throw new BusinessException("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥", e);
        }
    }
}
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š

```
æˆåŠŸæƒ…å†µï¼š
2025-09-23 15:30:00 INFO  å¼€å§‹è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼ŒuserId=1001, url=http://user-service/user/1001
2025-09-23 15:30:00 INFO  è°ƒç”¨ç”¨æˆ·æœåŠ¡æˆåŠŸï¼ŒuserId=1001, è€—æ—¶=25ms, ç»“æœ=User(id=1001, name=å¼ ä¸‰)

å¤±è´¥æƒ…å†µï¼š
2025-09-23 15:30:00 INFO  å¼€å§‹è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼ŒuserId=1001, url=http://user-service/user/1001
2025-09-23 15:30:05 ERROR è°ƒç”¨ç”¨æˆ·æœåŠ¡å¤±è´¥ï¼ŒuserId=1001, è€—æ—¶=5000ms, é”™è¯¯ä¿¡æ¯=Read timed out
```

### 4.3 ä½¿ç”¨æ‹¦æˆªå™¨ç»Ÿä¸€è®°å½•æ—¥å¿—


**é—®é¢˜**ï¼šæ¯ä¸ªæ–¹æ³•éƒ½å†™æ—¥å¿—ä»£ç å¤ªéº»çƒ¦äº†

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè‡ªåŠ¨è®°å½•æ‰€æœ‰è¯·æ±‚

```java
/**
 * RestTemplateæ—¥å¿—æ‹¦æˆªå™¨
 * è‡ªåŠ¨è®°å½•æ‰€æœ‰HTTPè¯·æ±‚çš„æ—¥å¿—
 */
@Slf4j
public class LoggingInterceptor implements ClientHttpRequestInterceptor {
    
    @Override
    public ClientHttpResponse intercept(
            HttpRequest request, 
            byte[] body, 
            ClientHttpRequestExecution execution) throws IOException {
        
        // 1. è®°å½•è¯·æ±‚ä¿¡æ¯
        logRequest(request, body);
        
        // 2. æ‰§è¡Œè¯·æ±‚å¹¶è®¡æ—¶
        long startTime = System.currentTimeMillis();
        ClientHttpResponse response = execution.execute(request, body);
        long costTime = System.currentTimeMillis() - startTime;
        
        // 3. è®°å½•å“åº”ä¿¡æ¯
        logResponse(response, costTime);
        
        return response;
    }
    
    /**
     * è®°å½•è¯·æ±‚ä¿¡æ¯
     */
    private void logRequest(HttpRequest request, byte[] body) {
        log.info("====== HTTPè¯·æ±‚å¼€å§‹ ======");
        log.info("URI: {}", request.getURI());
        log.info("Method: {}", request.getMethod());
        log.info("Headers: {}", request.getHeaders());
        
        if (body.length > 0) {
            String requestBody = new String(body, StandardCharsets.UTF_8);
            log.info("Request Body: {}", requestBody);
        }
    }
    
    /**
     * è®°å½•å“åº”ä¿¡æ¯
     */
    private void logResponse(ClientHttpResponse response, long costTime) throws IOException {
        log.info("====== HTTPå“åº”ç»“æŸ ======");
        log.info("Status Code: {}", response.getStatusCode());
        log.info("Status Text: {}", response.getStatusText());
        log.info("Cost Time: {}ms", costTime);
        log.info("========================");
    }
}

// é…ç½®æ‹¦æˆªå™¨
@Configuration
public class RestTemplateConfig {
    
    @Bean
    public RestTemplate restTemplate() {
        RestTemplate restTemplate = new RestTemplate();
        
        // æ·»åŠ æ—¥å¿—æ‹¦æˆªå™¨
        List<ClientHttpRequestInterceptor> interceptors = new ArrayList<>();
        interceptors.add(new LoggingInterceptor());
        restTemplate.setInterceptors(interceptors);
        
        return restTemplate;
    }
}
```

### 4.4 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


é™¤äº†è®°å½•æ—¥å¿—ï¼Œè¿˜è¦æ”¶é›†æ€§èƒ½æŒ‡æ ‡ç”¨äºåˆ†æï¼š

```java
@Component
public class RestTemplateMetrics implements ClientHttpRequestInterceptor {
    
    // ä½¿ç”¨Micrometerè¿›è¡Œç›‘æ§ï¼ˆSpring Bootè‡ªå¸¦ï¼‰
    private final MeterRegistry meterRegistry;
    
    public RestTemplateMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }
    
    @Override
    public ClientHttpResponse intercept(
            HttpRequest request, 
            byte[] body, 
            ClientHttpRequestExecution execution) throws IOException {
        
        long startTime = System.currentTimeMillis();
        String serviceName = request.getURI().getHost();  // æœåŠ¡å
        
        try {
            ClientHttpResponse response = execution.execute(request, body);
            long costTime = System.currentTimeMillis() - startTime;
            
            // è®°å½•æˆåŠŸçš„è°ƒç”¨
            recordMetrics(serviceName, "success", costTime);
            
            return response;
            
        } catch (IOException e) {
            long costTime = System.currentTimeMillis() - startTime;
            
            // è®°å½•å¤±è´¥çš„è°ƒç”¨
            recordMetrics(serviceName, "failed", costTime);
            
            throw e;
        }
    }
    
    /**
     * è®°å½•ç›‘æ§æŒ‡æ ‡
     */
    private void recordMetrics(String serviceName, String status, long costTime) {
        // è®°å½•è°ƒç”¨æ¬¡æ•°
        meterRegistry.counter("http.client.requests", 
            "service", serviceName,
            "status", status
        ).increment();
        
        // è®°å½•è€—æ—¶åˆ†å¸ƒ
        meterRegistry.timer("http.client.duration",
            "service", serviceName
        ).record(costTime, TimeUnit.MILLISECONDS);
    }
}
```

**è¿™äº›æŒ‡æ ‡å¯ä»¥ç”¨æ¥**ï¼š
- ç»Ÿè®¡æ¯ä¸ªæœåŠ¡çš„è°ƒç”¨æ¬¡æ•°
- åˆ†æå¹³å‡å“åº”æ—¶é—´
- å‘ç°æ€§èƒ½ç“¶é¢ˆ
- è®¾ç½®å‘Šè­¦é˜ˆå€¼

---

## 5. ğŸ§ª å•å…ƒæµ‹è¯•ç¼–å†™


### 5.1 ä¸ºä»€ä¹ˆè¦ä¸ºRestTemplateå†™æµ‹è¯•


**æµ‹è¯•çš„æ ¸å¿ƒç›®çš„**ï¼šç¡®ä¿ä½ çš„æœåŠ¡è°ƒç”¨é€»è¾‘æ˜¯æ­£ç¡®çš„

```
åœºæ™¯ï¼šä½ å†™äº†ä¸€ä¸ªè°ƒç”¨ç”¨æˆ·æœåŠ¡çš„æ–¹æ³•
é—®é¢˜ï¼šå¦‚ä½•éªŒè¯è¿™ä¸ªæ–¹æ³•èƒ½æ­£å¸¸å·¥ä½œï¼Ÿ

âŒ ä¸å¥½çš„åšæ³•ï¼šå¯åŠ¨æ•´ä¸ªé¡¹ç›®ï¼Œæ‰‹åŠ¨è°ƒç”¨è¯•è¯•
   â†’ æ…¢ã€éº»çƒ¦ã€ä¾èµ–å…¶ä»–æœåŠ¡

âœ… å¥½çš„åšæ³•ï¼šå†™å•å…ƒæµ‹è¯•ï¼Œè‡ªåŠ¨éªŒè¯
   â†’ å¿«ã€å¯é ã€ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡
```

### 5.2 ä½¿ç”¨MockRestServiceServeræµ‹è¯•


**æ ¸å¿ƒæ€è·¯**ï¼šæ¨¡æ‹ŸæœåŠ¡å™¨çš„å“åº”ï¼Œä¸éœ€è¦çœŸæ­£è°ƒç”¨å¤–éƒ¨æœåŠ¡

```java
@SpringBootTest
public class UserServiceTest {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @Autowired
    private UserService userService;
    
    private MockRestServiceServer mockServer;
    
    /**
     * æ¯ä¸ªæµ‹è¯•å‰çš„å‡†å¤‡å·¥ä½œ
     */
    @BeforeEach
    public void setup() {
        // åˆ›å»ºMockæœåŠ¡å™¨
        mockServer = MockRestServiceServer.createServer(restTemplate);
    }
    
    /**
     * æµ‹è¯•ï¼šè·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸçš„æƒ…å†µ
     */
    @Test
    public void testGetUserInfo_Success() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        Long userId = 1001L;
        String expectedUrl = "http://user-service/user/" + userId;
        
        // æ¨¡æ‹Ÿçš„ç”¨æˆ·å¯¹è±¡
        User mockUser = new User();
        mockUser.setId(userId);
        mockUser.setName("å¼ ä¸‰");
        
        // 2. è®¾ç½®MockæœåŠ¡å™¨çš„æœŸæœ›
        mockServer.expect(requestTo(expectedUrl))  // æœŸæœ›è¯·æ±‚è¿™ä¸ªURL
                  .andExpect(method(HttpMethod.GET))  // æœŸæœ›GETè¯·æ±‚
                  .andRespond(withSuccess(  // è¿”å›æˆåŠŸå“åº”
                      JSON.toJSONString(mockUser),  // å“åº”å†…å®¹
                      MediaType.APPLICATION_JSON  // å“åº”æ ¼å¼
                  ));
        
        // 3. æ‰§è¡Œæµ‹è¯•
        User actualUser = userService.getUserInfo(userId);
        
        // 4. éªŒè¯ç»“æœ
        assertNotNull(actualUser);
        assertEquals(userId, actualUser.getId());
        assertEquals("å¼ ä¸‰", actualUser.getName());
        
        // 5. éªŒè¯MockæœåŠ¡å™¨çš„æœŸæœ›æ˜¯å¦è¢«æ»¡è¶³
        mockServer.verify();
    }
    
    /**
     * æµ‹è¯•ï¼šæœåŠ¡è°ƒç”¨å¤±è´¥çš„æƒ…å†µ
     */
    @Test
    public void testGetUserInfo_Failed() {
        Long userId = 1001L;
        String expectedUrl = "http://user-service/user/" + userId;
        
        // è®¾ç½®MockæœåŠ¡å™¨è¿”å›500é”™è¯¯
        mockServer.expect(requestTo(expectedUrl))
                  .andExpect(method(HttpMethod.GET))
                  .andRespond(withServerError());  // è¿”å›500é”™è¯¯
        
        // éªŒè¯ä¼šæŠ›å‡ºå¼‚å¸¸
        assertThrows(BusinessException.class, () -> {
            userService.getUserInfo(userId);
        });
        
        mockServer.verify();
    }
}
```

**å…³é”®ç†è§£**ï¼š
- `MockRestServiceServer`ï¼šæ¨¡æ‹Ÿçš„HTTPæœåŠ¡å™¨
- `expect()`ï¼šè®¾ç½®æœŸæœ›çš„è¯·æ±‚
- `andRespond()`ï¼šè®¾ç½®è¿”å›çš„å“åº”
- `verify()`ï¼šéªŒè¯æœŸæœ›æ˜¯å¦è¢«æ»¡è¶³

### 5.3 æµ‹è¯•å„ç§åœºæ™¯


**åœºæ™¯1ï¼šæµ‹è¯•è¶…æ—¶æƒ…å†µ**

```java
@Test
public void testTimeout() {
    mockServer.expect(requestTo(url))
              .andExpect(method(HttpMethod.GET))
              .andRespond(request -> {
                  // æ¨¡æ‹Ÿå»¶è¿Ÿ3ç§’
                  Thread.sleep(3000);
                  throw new SocketTimeoutException("Read timed out");
              });
    
    // éªŒè¯è¶…æ—¶å¼‚å¸¸å¤„ç†
    assertThrows(BusinessException.class, () -> {
        userService.getUserInfo(1001L);
    });
}
```

**åœºæ™¯2ï¼šæµ‹è¯•é‡è¯•é€»è¾‘**

```java
@Test
public void testRetry() {
    // ç¬¬ä¸€æ¬¡è¯·æ±‚å¤±è´¥ï¼Œç¬¬äºŒæ¬¡æˆåŠŸ
    mockServer.expect(requestTo(url))
              .andExpect(method(HttpMethod.GET))
              .andRespond(withServerError());  // ç¬¬ä¸€æ¬¡å¤±è´¥
    
    mockServer.expect(requestTo(url))
              .andExpect(method(HttpMethod.GET))
              .andRespond(withSuccess(mockData, MediaType.APPLICATION_JSON));  // ç¬¬äºŒæ¬¡æˆåŠŸ
    
    // æ‰§è¡Œè¯·æ±‚ï¼ˆä¼šè‡ªåŠ¨é‡è¯•ï¼‰
    User user = userService.getUserInfo(1001L);
    
    assertNotNull(user);
    mockServer.verify();  // éªŒè¯è¯·æ±‚äº†2æ¬¡
}
```

---

## 6. ğŸ­ MockæœåŠ¡è°ƒç”¨æµ‹è¯•


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦Mock


**å®é™…å¼€å‘ä¸­çš„å›°å¢ƒ**ï¼š

```
åœºæ™¯1ï¼šå…¶ä»–å›¢é˜Ÿçš„æœåŠ¡è¿˜æ²¡å¼€å‘å®Œ
ğŸ‘‰ æ— æ³•çœŸæ­£è°ƒç”¨ï¼Œæ€ä¹ˆæµ‹è¯•æˆ‘çš„ä»£ç ï¼Ÿ

åœºæ™¯2ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡è¦æ”¶è´¹
ğŸ‘‰ æµ‹è¯•æ—¶ä¸æƒ³çœŸçš„æ‰£é’±

åœºæ™¯3ï¼šæµ‹è¯•å¼‚å¸¸æƒ…å†µ
ğŸ‘‰ æ— æ³•è®©çœŸå®æœåŠ¡"æ•…æ„å‡ºé”™"

è§£å†³æ–¹æ¡ˆï¼šMockï¼ˆæ¨¡æ‹Ÿï¼‰æœåŠ¡çš„è¿”å›ç»“æœ
```

### 6.2 ä½¿ç”¨Mockitoè¿›è¡ŒMock


**Mockitoæ˜¯ä»€ä¹ˆ**ï¼Ÿä¸€ä¸ªä¸“é—¨ç”¨æ¥æ¨¡æ‹Ÿå¯¹è±¡è¡Œä¸ºçš„å·¥å…·

```java
@SpringBootTest
public class OrderServiceTest {
    
    @Mock  // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„RestTemplate
    private RestTemplate restTemplate;
    
    @InjectMocks  // å°†mockçš„å¯¹è±¡æ³¨å…¥åˆ°OrderService
    private OrderService orderService;
    
    @BeforeEach
    public void setup() {
        MockitoAnnotations.openMocks(this);
    }
    
    /**
     * æµ‹è¯•ï¼šåˆ›å»ºè®¢å•æˆåŠŸ
     */
    @Test
    public void testCreateOrder_Success() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        Order order = new Order();
        order.setUserId(1001L);
        order.setProductId(2001L);
        
        // æ¨¡æ‹Ÿåº“å­˜æœåŠ¡çš„è¿”å›ç»“æœ
        Result stockResult = Result.success("æ‰£å‡åº“å­˜æˆåŠŸ");
        
        // 2. è®¾ç½®Mockè¡Œä¸ºï¼šå½“è°ƒç”¨åº“å­˜æœåŠ¡æ—¶ï¼Œè¿”å›æ¨¡æ‹Ÿç»“æœ
        when(restTemplate.postForObject(
            eq("http://stock-service/stock/deduct"),  // URLåŒ¹é…
            any(),  // ä»»æ„å‚æ•°
            eq(Result.class)  // è¿”å›ç±»å‹
        )).thenReturn(stockResult);  // è¿”å›æ¨¡æ‹Ÿç»“æœ
        
        // 3. æ‰§è¡Œæµ‹è¯•
        orderService.createOrder(order);
        
        // 4. éªŒè¯ï¼šåº“å­˜æœåŠ¡ç¡®å®è¢«è°ƒç”¨äº†1æ¬¡
        verify(restTemplate, times(1))
            .postForObject(anyString(), any(), eq(Result.class));
    }
    
    /**
     * æµ‹è¯•ï¼šåº“å­˜ä¸è¶³çš„æƒ…å†µ
     */
    @Test
    public void testCreateOrder_StockNotEnough() {
        Order order = new Order();
        
        // æ¨¡æ‹Ÿåº“å­˜ä¸è¶³çš„è¿”å›ç»“æœ
        Result stockResult = Result.fail("åº“å­˜ä¸è¶³");
        
        when(restTemplate.postForObject(
            anyString(), any(), eq(Result.class)
        )).thenReturn(stockResult);
        
        // éªŒè¯ä¼šæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
        assertThrows(BusinessException.class, () -> {
            orderService.createOrder(order);
        });
    }
}
```

**Mockitoæ ¸å¿ƒæ–¹æ³•**ï¼š

| æ–¹æ³• | **ä½œç”¨** | **ç¤ºä¾‹** |
|-----|---------|---------|
| `@Mock` | `åˆ›å»ºæ¨¡æ‹Ÿå¯¹è±¡` | `@Mock private RestTemplate restTemplate;` |
| `@InjectMocks` | `æ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡` | `@InjectMocks private OrderService orderService;` |
| `when().thenReturn()` | `è®¾ç½®æ–¹æ³•è¿”å›å€¼` | `when(xxx).thenReturn(yyy)` |
| `verify()` | `éªŒè¯æ–¹æ³•è¢«è°ƒç”¨` | `verify(mock, times(1)).method()` |

### 6.3 Mockå¤æ‚åœºæ™¯


**åœºæ™¯ï¼šæ ¹æ®ä¸åŒå‚æ•°è¿”å›ä¸åŒç»“æœ**

```java
@Test
public void testDifferentResponse() {
    // VIPç”¨æˆ·è¿”å›æŠ˜æ‰£ä»·æ ¼
    when(restTemplate.getForObject(
        eq("http://price-service/price/1001?userType=VIP"),
        eq(BigDecimal.class)
    )).thenReturn(new BigDecimal("80.00"));
    
    // æ™®é€šç”¨æˆ·è¿”å›åŸä»·
    when(restTemplate.getForObject(
        eq("http://price-service/price/1001?userType=NORMAL"),
        eq(BigDecimal.class)
    )).thenReturn(new BigDecimal("100.00"));
    
    // æµ‹è¯•VIPç”¨æˆ·
    BigDecimal vipPrice = priceService.getPrice(1001L, "VIP");
    assertEquals(new BigDecimal("80.00"), vipPrice);
    
    // æµ‹è¯•æ™®é€šç”¨æˆ·
    BigDecimal normalPrice = priceService.getPrice(1001L, "NORMAL");
    assertEquals(new BigDecimal("100.00"), normalPrice);
}
```

**åœºæ™¯ï¼šæ¨¡æ‹Ÿå¼‚å¸¸æŠ›å‡º**

```java
@Test
public void testException() {
    // è®¾ç½®ï¼šè°ƒç”¨æ—¶æŠ›å‡ºå¼‚å¸¸
    when(restTemplate.postForObject(
        anyString(), any(), any()
    )).thenThrow(new ResourceAccessException("è¿æ¥è¶…æ—¶"));
    
    // éªŒè¯å¼‚å¸¸å¤„ç†é€»è¾‘
    assertThrows(BusinessException.class, () -> {
        orderService.createOrder(new Order());
    });
}
```

---

## 7. ğŸ”§ å·¥å…·ç±»å°è£…è®¾è®¡


### 7.1 ä¸ºä»€ä¹ˆè¦å°è£…å·¥å…·ç±»


**é—®é¢˜**ï¼šæ¯æ¬¡ä½¿ç”¨RestTemplateéƒ½è¦å†™ä¸€å †é‡å¤ä»£ç 

```java
// âŒ æ¯æ¬¡éƒ½å†™è¿™ä¹ˆå¤šä»£ç ï¼Œå¤ªéº»çƒ¦äº†
String url = "http://xxx";
HttpHeaders headers = new HttpHeaders();
headers.set("token", "xxx");
HttpEntity<String> entity = new HttpEntity<>(body, headers);
ResponseEntity<Result> response = restTemplate.exchange(url, HttpMethod.POST, entity, ...);
Result result = response.getBody();
if (result.getCode() != 200) {
    throw new BusinessException(result.getMessage());
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼šå°è£…æˆå·¥å…·ç±»ï¼Œä¸€è¡Œä»£ç æå®š

```java
// âœ… å°è£…åï¼Œç®€æ´æ˜äº†
Result result = RestTemplateUtil.post(url, params, Result.class);
```

### 7.2 é€šç”¨å·¥å…·ç±»è®¾è®¡


```java
/**
 * RestTemplateå·¥å…·ç±»
 * å°è£…å¸¸ç”¨çš„HTTPè°ƒç”¨æ–¹æ³•
 */
@Component
public class RestTemplateUtil {
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * GETè¯·æ±‚
     * @param url è¯·æ±‚åœ°å€
     * @param responseType è¿”å›ç±»å‹
     * @return å“åº”ç»“æœ
     */
    public <T> T get(String url, Class<T> responseType) {
        return get(url, null, responseType);
    }
    
    /**
     * GETè¯·æ±‚ï¼ˆå¸¦å‚æ•°ï¼‰
     * @param url è¯·æ±‚åœ°å€
     * @param params URLå‚æ•°
     * @param responseType è¿”å›ç±»å‹
     */
    public <T> T get(String url, Map<String, Object> params, Class<T> responseType) {
        try {
            // æ„å»ºå®Œæ•´URL
            String fullUrl = buildUrl(url, params);
            
            // å‘èµ·è¯·æ±‚
            return restTemplate.getForObject(fullUrl, responseType);
            
        } catch (Exception e) {
            throw new BusinessException("GETè¯·æ±‚å¤±è´¥ï¼š" + url, e);
        }
    }
    
    /**
     * POSTè¯·æ±‚
     * @param url è¯·æ±‚åœ°å€
     * @param body è¯·æ±‚ä½“
     * @param responseType è¿”å›ç±»å‹
     */
    public <T> T post(String url, Object body, Class<T> responseType) {
        try {
            return restTemplate.postForObject(url, body, responseType);
        } catch (Exception e) {
            throw new BusinessException("POSTè¯·æ±‚å¤±è´¥ï¼š" + url, e);
        }
    }
    
    /**
     * POSTè¯·æ±‚ï¼ˆå¸¦è¯·æ±‚å¤´ï¼‰
     */
    public <T> T post(String url, Object body, Map<String, String> headers, Class<T> responseType) {
        try {
            // æ„å»ºè¯·æ±‚å¤´
            HttpHeaders httpHeaders = new HttpHeaders();
            if (headers != null) {
                headers.forEach(httpHeaders::set);
            }
            
            // æ„å»ºè¯·æ±‚å®ä½“
            HttpEntity<?> entity = new HttpEntity<>(body, httpHeaders);
            
            // å‘èµ·è¯·æ±‚
            ResponseEntity<T> response = restTemplate.exchange(
                url, HttpMethod.POST, entity, responseType);
            
            return response.getBody();
            
        } catch (Exception e) {
            throw new BusinessException("POSTè¯·æ±‚å¤±è´¥ï¼š" + url, e);
        }
    }
    
    /**
     * æ„å»ºURLï¼ˆæ‹¼æ¥å‚æ•°ï¼‰
     */
    private String buildUrl(String url, Map<String, Object> params) {
        if (params == null || params.isEmpty()) {
            return url;
        }
        
        StringBuilder sb = new StringBuilder(url);
        sb.append("?");
        
        params.forEach((key, value) -> {
            sb.append(key).append("=").append(value).append("&");
        });
        
        // åˆ é™¤æœ€åä¸€ä¸ª&
        return sb.substring(0, sb.length() - 1);
    }
}
```

### 7.3 å¸¦ç»Ÿä¸€ç»“æœå¤„ç†çš„å·¥å…·ç±»


```java
/**
 * å¢å¼ºç‰ˆå·¥å…·ç±»
 * è‡ªåŠ¨å¤„ç†ç»Ÿä¸€è¿”å›ç»“æœ
 */
@Component
public class HttpClient {
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * GETè¯·æ±‚å¹¶è‡ªåŠ¨è§£æResult
     */
    public <T> T get(String url, Class<T> dataType) {
        return get(url, null, dataType);
    }
    
    public <T> T get(String url, Map<String, Object> params, Class<T> dataType) {
        // æ„å»ºè¿”å›ç±»å‹ï¼šResult<T>
        ParameterizedTypeReference<Result<T>> responseType = 
            new ParameterizedTypeReference<Result<T>>() {};
        
        String fullUrl = buildUrl(url, params);
        
        // å‘èµ·è¯·æ±‚
        ResponseEntity<Result<T>> response = restTemplate.exchange(
            fullUrl, HttpMethod.GET, null, responseType);
        
        // å¤„ç†ç»“æœ
        return handleResult(response.getBody());
    }
    
    /**
     * POSTè¯·æ±‚å¹¶è‡ªåŠ¨è§£æResult
     */
    public <T> T post(String url, Object body, Class<T> dataType) {
        ParameterizedTypeReference<Result<T>> responseType = 
            new ParameterizedTypeReference<Result<T>>() {};
        
        HttpEntity<?> entity = new HttpEntity<>(body);
        
        ResponseEntity<Result<T>> response = restTemplate.exchange(
            url, HttpMethod.POST, entity, responseType);
        
        return handleResult(response.getBody());
    }
    
    /**
     * ç»Ÿä¸€å¤„ç†Result
     */
    private <T> T handleResult(Result<T> result) {
        if (result == null) {
            throw new BusinessException("å“åº”ç»“æœä¸ºç©º");
        }
        
        if (result.getCode() != 200) {
            throw new BusinessException(result.getMessage());
        }
        
        return result.getData();
    }
    
    private String buildUrl(String url, Map<String, Object> params) {
        // å®ç°åŒä¸Š
    }
}
```

**ä½¿ç”¨å¯¹æ¯”**ï¼š

```java
// åŸå§‹æ–¹å¼ï¼šå¤æ‚
ParameterizedTypeReference<Result<User>> responseType = new ParameterizedTypeReference<Result<User>>() {};
ResponseEntity<Result<User>> response = restTemplate.exchange(url, HttpMethod.GET, null, responseType);
Result<User> result = response.getBody();
if (result.getCode() != 200) {
    throw new BusinessException(result.getMessage());
}
User user = result.getData();

// å·¥å…·ç±»æ–¹å¼ï¼šç®€æ´
User user = httpClient.get(url, User.class);
```

### 7.4 å®ç”¨åŠŸèƒ½æ‰©å±•


**åŠŸèƒ½1ï¼šè‡ªåŠ¨æ·»åŠ é€šç”¨è¯·æ±‚å¤´**

```java
public class HttpClient {
    
    /**
     * è·å–é€šç”¨è¯·æ±‚å¤´
     */
    private HttpHeaders getCommonHeaders() {
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        
        // ä»ä¸Šä¸‹æ–‡è·å–token
        String token = SecurityContextHolder.getToken();
        if (token != null) {
            headers.set("Authorization", "Bearer " + token);
        }
        
        // æ·»åŠ è¿½è¸ªID
        String traceId = MDC.get("traceId");
        if (traceId != null) {
            headers.set("X-Trace-Id", traceId);
        }
        
        return headers;
    }
}
```

**åŠŸèƒ½2ï¼šè‡ªåŠ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–**

```java
/**
 * POSTè¯·æ±‚ï¼Œè‡ªåŠ¨å°†å¯¹è±¡è½¬ä¸ºJSON
 */
public <T> T post(String url, Object requestBody, Class<T> responseType) {
    HttpHeaders headers = getCommonHeaders();
    
    // è‡ªåŠ¨åºåˆ—åŒ–è¯·æ±‚å¯¹è±¡
    String jsonBody = JSON.toJSONString(requestBody);
    
    HttpEntity<String> entity = new HttpEntity<>(jsonBody, headers);
    
    return restTemplate.postForObject(url, entity, responseType);
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 ç»Ÿä¸€è¿”å›ç»“æœå°è£…


**æ ¸å¿ƒè¦ç‚¹**ï¼š
```
ğŸ”¸ ç»Ÿä¸€æ ¼å¼ï¼šæ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒçš„è¿”å›ç»“æ„ï¼ˆcodeã€messageã€dataï¼‰
ğŸ”¸ ä¸šåŠ¡çŠ¶æ€ç ï¼šå®šä¹‰æ¸…æ™°çš„çŠ¶æ€ç ä½“ç³»ï¼ŒåŒºåˆ†ä¸åŒä¸šåŠ¡åœºæ™¯
ğŸ”¸ æ³›å‹è®¾è®¡ï¼šä½¿ç”¨æ³›å‹æ”¯æŒä»»æ„ç±»å‹çš„æ•°æ®è¿”å›
ğŸ”¸ å·¥å…·æ–¹æ³•ï¼šæä¾›ä¾¿æ·çš„æˆåŠŸ/å¤±è´¥é™æ€æ–¹æ³•
```

**è®°å¿†å£è¯€**ï¼š
```
ç»Ÿä¸€æ ¼å¼å¥½å¤„å¤šï¼Œè§£ææ•°æ®ä¸å‡ºé”™
çŠ¶æ€ç è¦åˆ†æ¸…æ¥šï¼ŒæˆåŠŸå¤±è´¥ä¸€çœ¼æ˜
```

### 8.2 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**æ ¸å¿ƒè¦ç‚¹**ï¼š
```
ğŸ”¸ å¼‚å¸¸åˆ†ç±»ï¼šåŒºåˆ†ç½‘ç»œå¼‚å¸¸ã€å®¢æˆ·ç«¯å¼‚å¸¸ã€æœåŠ¡ç«¯å¼‚å¸¸
ğŸ”¸ è½¬æ¢å¼‚å¸¸ï¼šå°†æŠ€æœ¯å¼‚å¸¸è½¬ä¸ºä¸šåŠ¡å¼‚å¸¸ï¼Œä¾¿äºç†è§£
ğŸ”¸ è‡ªå®šä¹‰å¤„ç†å™¨ï¼šä½¿ç”¨ResponseErrorHandlerç»Ÿä¸€å¤„ç†
ğŸ”¸ åŒºåˆ«å¯¹å¾…ï¼šä¸åŒå¼‚å¸¸é‡‡å–ä¸åŒçš„å¤„ç†ç­–ç•¥
```

**å¤„ç†åŸåˆ™**ï¼š
| å¼‚å¸¸ç±»å‹ | **å¤„ç†æ–¹å¼** |
|---------|------------|
| `ç½‘ç»œå¼‚å¸¸` | `è®°å½•æ—¥å¿— + é‡è¯•` |
| `å‚æ•°é”™è¯¯` | `æ£€æŸ¥å‚æ•° + ä¿®æ­£` |
| `æœåŠ¡å¼‚å¸¸` | `é™çº§å¤„ç† + å‘Šè­¦` |

### 8.3 é‡è¯•æœºåˆ¶å®ç°


**æ ¸å¿ƒè¦ç‚¹**ï¼š
```
ğŸ”¸ é€‚ç”¨åœºæ™¯ï¼šä»…å¯¹ä¸´æ—¶æ€§æ•…éšœé‡è¯•
ğŸ”¸ é‡è¯•ç­–ç•¥ï¼šä½¿ç”¨æŒ‡æ•°é€€é¿ï¼Œé¿å…åŠ é‡æœåŠ¡å‹åŠ›
ğŸ”¸ å¹‚ç­‰æ€§ï¼šç¡®ä¿é‡è¯•ä¸ä¼šé€ æˆé‡å¤æ“ä½œ
ğŸ”¸ å…œåº•æ–¹æ¡ˆï¼šé‡è¯•å¤±è´¥åè¦æœ‰é™çº§å¤„ç†
```

**é‡è¯•ä¸‰åŸåˆ™**ï¼š
1. åªé‡è¯•å¯æ¢å¤çš„é”™è¯¯
2. é‡è¯•é—´éš”è¦é€’å¢
3. æ“ä½œè¦ä¿è¯å¹‚ç­‰æ€§

### 8.4 æ—¥å¿—ç›‘æ§


**æ ¸å¿ƒè¦ç‚¹**ï¼š
```
ğŸ”¸ å…³é”®ä¿¡æ¯ï¼šè®°å½•URLã€å‚æ•°ã€è€—æ—¶ã€ç»“æœ
ğŸ”¸ ä½¿ç”¨æ‹¦æˆªå™¨ï¼šç»Ÿä¸€è®°å½•æ‰€æœ‰è¯·æ±‚
ğŸ”¸ æ€§èƒ½æŒ‡æ ‡ï¼šæ”¶é›†è°ƒç”¨æ¬¡æ•°ã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡
ğŸ”¸ é“¾è·¯è¿½è¸ªï¼šä½¿ç”¨traceIdä¸²è”æ•´ä¸ªè°ƒç”¨é“¾
```

**æ—¥å¿—è¦ç´ **ï¼š
- âœ… è°ï¼šè°ƒç”¨å“ªä¸ªæœåŠ¡
- âœ… ä½•æ—¶ï¼šä»€ä¹ˆæ—¶é—´è°ƒç”¨
- âœ… ä½•äº‹ï¼šåšäº†ä»€ä¹ˆæ“ä½œ
- âœ… ç»“æœï¼šæˆåŠŸè¿˜æ˜¯å¤±è´¥
- âœ… è€—æ—¶ï¼šèŠ±äº†å¤šé•¿æ—¶é—´

### 8.5 æµ‹è¯•è¦ç‚¹


**æ ¸å¿ƒè¦ç‚¹**ï¼š
```
ğŸ”¸ Mockæµ‹è¯•ï¼šä½¿ç”¨MockRestServiceServeræ¨¡æ‹ŸæœåŠ¡å™¨
ğŸ”¸ Mockitoï¼šä½¿ç”¨Mockitoæ¨¡æ‹Ÿå¯¹è±¡è¡Œä¸º
ğŸ”¸ åœºæ™¯è¦†ç›–ï¼šæµ‹è¯•æˆåŠŸã€å¤±è´¥ã€è¶…æ—¶ã€é‡è¯•ç­‰åœºæ™¯
ğŸ”¸ éªŒè¯è¡Œä¸ºï¼šéªŒè¯æ–¹æ³•æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨
```

**æµ‹è¯•æ­¥éª¤**ï¼š
1. å‡†å¤‡æµ‹è¯•æ•°æ®
2. è®¾ç½®MockæœŸæœ›
3. æ‰§è¡Œæµ‹è¯•æ–¹æ³•
4. éªŒè¯ç»“æœ
5. éªŒè¯è¡Œä¸º

### 8.6 å·¥å…·ç±»å°è£…


**æ ¸å¿ƒè¦ç‚¹**ï¼š
```
ğŸ”¸ ç®€åŒ–è°ƒç”¨ï¼šå°è£…å¸¸ç”¨æ“ä½œï¼Œå‡å°‘é‡å¤ä»£ç 
ğŸ”¸ ç»Ÿä¸€å¤„ç†ï¼šè‡ªåŠ¨å¤„ç†Resultã€å¼‚å¸¸ã€è¯·æ±‚å¤´ç­‰
ğŸ”¸ åŠŸèƒ½æ‰©å±•ï¼šæ”¯æŒé‡è¯•ã€æ—¥å¿—ã€ç›‘æ§ç­‰åŠŸèƒ½
ğŸ”¸ æ˜“äºä½¿ç”¨ï¼šæä¾›ç®€æ´çš„APIæ¥å£
```

**å°è£…åŸåˆ™**ï¼š
- ç®€å•çš„æ›´ç®€å•
- å¤æ‚çš„èƒ½åº”å¯¹
- é€šç”¨çš„å¯æ‰©å±•

### 8.7 å®æˆ˜ç»éªŒæ€»ç»“


**æœ€ä½³å®è·µæ¸…å•**ï¼š

âœ… **å¿…é¡»åšçš„**ï¼š
- ç»Ÿä¸€è¿”å›æ ¼å¼
- å¼‚å¸¸å¤„ç†
- æ—¥å¿—è®°å½•
- è¶…æ—¶è®¾ç½®

âš ï¸ **å»ºè®®åšçš„**ï¼š
- è¯·æ±‚é‡è¯•
- æ€§èƒ½ç›‘æ§
- å•å…ƒæµ‹è¯•
- å·¥å…·ç±»å°è£…

ğŸ”¥ **é«˜çº§æŠ€å·§**ï¼š
- é“¾è·¯è¿½è¸ª
- ç†”æ–­é™çº§
- è´Ÿè½½å‡è¡¡
- æœåŠ¡å‘ç°

**è®°ä½è¿™å¥è¯**ï¼š
```
è°ƒç”¨æœåŠ¡è¦è°¨æ…ï¼Œå¼‚å¸¸å¤„ç†ä¸èƒ½å°‘
æ—¥å¿—ç›‘æ§è¦å®Œå–„ï¼Œæµ‹è¯•è¦†ç›–ä¿è´¨é‡
å·¥å…·å°è£…ææ•ˆç‡ï¼Œå®æˆ˜ç»éªŒæœ€é‡è¦
```