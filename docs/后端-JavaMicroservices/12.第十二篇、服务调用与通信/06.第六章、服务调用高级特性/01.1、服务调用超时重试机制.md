---
title: 1ã€æœåŠ¡è°ƒç”¨è¶…æ—¶é‡è¯•æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [è¶…æ—¶æœºåˆ¶æ ¸å¿ƒæ¦‚å¿µ](#1-è¶…æ—¶æœºåˆ¶æ ¸å¿ƒæ¦‚å¿µ)
2. [è¿æ¥è¶…æ—¶ä¸è¯»å–è¶…æ—¶](#2-è¿æ¥è¶…æ—¶ä¸è¯»å–è¶…æ—¶)
3. [é‡è¯•ç­–ç•¥è¯¦è§£](#3-é‡è¯•ç­–ç•¥è¯¦è§£)
4. [æŒ‡æ•°é€€é¿ç®—æ³•](#4-æŒ‡æ•°é€€é¿ç®—æ³•)
5. [è¯·æ±‚å¹‚ç­‰æ€§ä¿è¯](#5-è¯·æ±‚å¹‚ç­‰æ€§ä¿è¯)
6. [å¼‚å¸¸å¤„ç†ä¸é‡è¯•æ¡ä»¶](#6-å¼‚å¸¸å¤„ç†ä¸é‡è¯•æ¡ä»¶)
7. [å®æˆ˜é…ç½®æŒ‡å—](#7-å®æˆ˜é…ç½®æŒ‡å—)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¶…æ—¶æœºåˆ¶æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶æœºåˆ¶


**ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š  
æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼ŒæœåŠ¡å‘˜è¯´"é©¬ä¸Šå°±å¥½"ã€‚å¦‚æœä½ ä¸€ç›´ç­‰ä¸‹å»ï¼Œå¯èƒ½ç­‰ä¸€æ•´å¤©éƒ½æ²¡é¥­åƒã€‚æ‰€ä»¥ä½ ä¼šç»™è‡ªå·±è®¾å®šä¸€ä¸ªç­‰å¾…æ—¶é—´ï¼š**è¶…è¿‡30åˆ†é’Ÿå°±æ¢é¤å…**ã€‚è¿™å°±æ˜¯è¶…æ—¶æœºåˆ¶çš„æœ¬è´¨ã€‚

**å¾®æœåŠ¡åœºæ™¯**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ æœåŠ¡A â†’ è°ƒç”¨æœåŠ¡B â†’ ç­‰å¾…å“åº”

é—®é¢˜æ¥äº†ï¼š
â€¢ å¦‚æœæœåŠ¡Bå¡ä½äº†ï¼ŒæœåŠ¡Aè¦ç­‰å¤šä¹…ï¼Ÿ
â€¢ å¦‚æœä¸€ç›´ç­‰ï¼Œç”¨æˆ·ä½“éªŒä¼šå¾ˆå·®
â€¢ å¦‚æœç­‰å¤ªä¹…ï¼ŒæœåŠ¡Açš„èµ„æºä¼šè¢«è€—å°½

è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®è¶…æ—¶æ—¶é—´
```

### 1.2 è¶…æ—¶çš„ä¸¤ç§ç±»å‹


**ğŸ”¸ ç®€å•ç†è§£**ï¼š
- **è¿æ¥è¶…æ—¶**ï¼šæ‰“ç”µè¯æ‹¨å·çš„ç­‰å¾…æ—¶é—´
- **è¯»å–è¶…æ—¶**ï¼šç”µè¯æ¥é€šåï¼Œç­‰å¯¹æ–¹è¯´è¯çš„æ—¶é—´

```
å®Œæ•´çš„æœåŠ¡è°ƒç”¨è¿‡ç¨‹ï¼š

å®¢æˆ·ç«¯                     æœåŠ¡ç«¯
  |                          |
  |----[1.å»ºç«‹è¿æ¥]---------->|  â† è¿æ¥è¶…æ—¶æ§åˆ¶è¿™æ®µ
  |<---[2.è¿æ¥æˆåŠŸ]----------|
  |                          |
  |----[3.å‘é€è¯·æ±‚]---------->|
  |                          |
  |----[4.ç­‰å¾…å“åº”]---------->|  â† è¯»å–è¶…æ—¶æ§åˆ¶è¿™æ®µ
  |<---[5.è¿”å›æ•°æ®]----------|
  |                          |
```

**æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”**ï¼š

| å¯¹æ¯”é¡¹ | **è¿æ¥è¶…æ—¶** | **è¯»å–è¶…æ—¶** |
|-------|------------|------------|
| **æ§åˆ¶é˜¶æ®µ** | `å»ºç«‹è¿æ¥çš„æ—¶é—´` | `ç­‰å¾…å“åº”æ•°æ®çš„æ—¶é—´` |
| **ç±»æ¯”** | `ç”µè¯æ‹¨å·ç­‰å¾…æ¥å¬` | `ç”µè¯æ¥é€šåç­‰å¯¹æ–¹è¯´è¯` |
| **å¸¸è§åŸå› ** | `ç½‘ç»œä¸é€šã€é˜²ç«å¢™ã€æœåŠ¡å®•æœº` | `å¤„ç†æ…¢ã€æ•°æ®åº“æ…¢æŸ¥è¯¢ã€æ­»é”` |
| **å»ºè®®å€¼** | `2-5ç§’ï¼ˆè¾ƒçŸ­ï¼‰` | `10-30ç§’ï¼ˆè¾ƒé•¿ï¼‰` |
| **å¤±è´¥å½±å“** | `å¿«é€Ÿå¤±è´¥ï¼ŒèŠ‚çœèµ„æº` | `é¿å…é•¿æ—¶é—´å ç”¨è¿æ¥` |

---

## 2. â±ï¸ è¿æ¥è¶…æ—¶ä¸è¯»å–è¶…æ—¶


### 2.1 è¿æ¥è¶…æ—¶é…ç½®è¯¦è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¿æ¥è¶…æ—¶**ï¼š
ä»å‘èµ·è¿æ¥è¯·æ±‚åˆ°æˆåŠŸå»ºç«‹TCPè¿æ¥çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡è¿ä¸Šï¼Œå°±æ”¾å¼ƒè¿æ¥ã€‚

**å®é™…æ„ä¹‰**ï¼š
```
åœºæ™¯1ï¼šæœåŠ¡Bå®•æœºäº†
â†’ å®¢æˆ·ç«¯å°è¯•è¿æ¥ï¼Œä½†æœåŠ¡ä¸å­˜åœ¨
â†’ å¦‚æœæ²¡æœ‰è¿æ¥è¶…æ—¶ï¼Œå¯èƒ½ç­‰å¾ˆä¹…æ‰å‘ç°è¿æ¥ä¸ä¸Š
â†’ è®¾ç½®è¿æ¥è¶…æ—¶3ç§’ï¼Œ3ç§’åç«‹å³å¤±è´¥

åœºæ™¯2ï¼šç½‘ç»œæ•…éšœ
â†’ è¯·æ±‚å‘å‡ºå»äº†ï¼Œä½†ç½‘ç»œä¸é€š
â†’ è¿æ¥è¶…æ—¶å¯ä»¥å¿«é€Ÿå‘ç°é—®é¢˜
â†’ é¿å…æ— æ„ä¹‰çš„ç­‰å¾…
```

**é…ç½®ç¤ºä¾‹ï¼ˆRestTemplateï¼‰**ï¼š
```java
// æ–¹å¼1ï¼šç®€å•é…ç½®
@Bean
public RestTemplate restTemplate() {
    SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();
    factory.setConnectTimeout(3000);  // è¿æ¥è¶…æ—¶3ç§’
    return new RestTemplate(factory);
}

// æ–¹å¼2ï¼šä½¿ç”¨HttpClientï¼ˆæ›´çµæ´»ï¼‰
@Bean
public RestTemplate restTemplate() {
    RequestConfig requestConfig = RequestConfig.custom()
        .setConnectTimeout(3000)      // è¿æ¥è¶…æ—¶3ç§’
        .build();
    
    CloseableHttpClient httpClient = HttpClients.custom()
        .setDefaultRequestConfig(requestConfig)
        .build();
    
    HttpComponentsClientHttpRequestFactory factory = 
        new HttpComponentsClientHttpRequestFactory(httpClient);
    
    return new RestTemplate(factory);
}
```

### 2.2 è¯»å–è¶…æ—¶é…ç½®è¯¦è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¯»å–è¶…æ—¶**ï¼š
è¿æ¥å»ºç«‹åï¼Œä»å‘é€è¯·æ±‚åˆ°æ¥æ”¶åˆ°å“åº”æ•°æ®çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚

**å®é™…æ„ä¹‰**ï¼š
```
åœºæ™¯1ï¼šæœåŠ¡Bå¤„ç†æ…¢
â†’ è¿æ¥å·²ç»å»ºç«‹æˆåŠŸ
â†’ ä½†æ˜¯æœåŠ¡BæŸ¥è¯¢æ•°æ®åº“å¾ˆæ…¢
â†’ è¯»å–è¶…æ—¶30ç§’åï¼Œå®¢æˆ·ç«¯ä¸å†ç­‰å¾…

åœºæ™¯2ï¼šæœåŠ¡Bæ­»é”
â†’ æœåŠ¡Bé™·å…¥æ­»é”ï¼Œæ°¸è¿œä¸è¿”å›
â†’ è¯»å–è¶…æ—¶å¯ä»¥é¿å…æ— é™ç­‰å¾…
â†’ é‡Šæ”¾å®¢æˆ·ç«¯èµ„æº
```

**é…ç½®ç¤ºä¾‹**ï¼š
```java
@Bean
public RestTemplate restTemplate() {
    SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();
    factory.setConnectTimeout(3000);   // è¿æ¥è¶…æ—¶3ç§’
    factory.setReadTimeout(30000);     // è¯»å–è¶…æ—¶30ç§’
    return new RestTemplate(factory);
}
```

### 2.3 Feignè¶…æ—¶é…ç½®


**Feigné»˜è®¤è¶…æ—¶æ—¶é—´**ï¼š
- è¿æ¥è¶…æ—¶ï¼š`10ç§’`
- è¯»å–è¶…æ—¶ï¼š`60ç§’`

**é…ç½®æ–¹å¼**ï¼š
```yaml
# å…¨å±€é…ç½®
feign:
  client:
    config:
      default:
        connectTimeout: 3000    # è¿æ¥è¶…æ—¶3ç§’
        readTimeout: 30000      # è¯»å–è¶…æ—¶30ç§’

# é’ˆå¯¹ç‰¹å®šæœåŠ¡é…ç½®
feign:
  client:
    config:
      user-service:             # æœåŠ¡å
        connectTimeout: 2000    # è¿æ¥è¶…æ—¶2ç§’
        readTimeout: 20000      # è¯»å–è¶…æ—¶20ç§’
      order-service:
        connectTimeout: 5000    # è¿æ¥è¶…æ—¶5ç§’
        readTimeout: 60000      # è¯»å–è¶…æ—¶60ç§’
```

### 2.4 è¶…æ—¶æ—¶é—´è®¾ç½®å»ºè®®


**ğŸ¯ è®¾ç½®åŸåˆ™**ï¼š

**è¿æ¥è¶…æ—¶ï¼ˆè¾ƒçŸ­ï¼‰**ï¼š
- âœ… **2-5ç§’**ï¼šé€‚åˆå†…ç½‘æœåŠ¡è°ƒç”¨
- âœ… **5-10ç§’**ï¼šé€‚åˆå¤–ç½‘æœåŠ¡è°ƒç”¨
- âŒ **ä¸å»ºè®®è¶…è¿‡10ç§’**ï¼šè¿æ¥å¤±è´¥åº”è¯¥å¿«é€Ÿæ„ŸçŸ¥

**è¯»å–è¶…æ—¶ï¼ˆæ ¹æ®ä¸šåŠ¡ï¼‰**ï¼š
- âœ… **10-30ç§’**ï¼šæ™®é€šæŸ¥è¯¢æ¥å£
- âœ… **30-60ç§’**ï¼šå¤æ‚è®¡ç®—æ¥å£
- âœ… **60-120ç§’**ï¼šæŠ¥è¡¨ç”Ÿæˆã€æ‰¹é‡å¤„ç†
- âš ï¸ **è¶…è¿‡120ç§’**ï¼šè€ƒè™‘æ”¹ä¸ºå¼‚æ­¥å¤„ç†

**å¸¸è§é”™è¯¯**ï¼š
```
âŒ é”™è¯¯1ï¼šè¿æ¥è¶…æ—¶è®¾ç½®å¤ªé•¿
connectTimeout: 60000  // 60ç§’å¤ªé•¿äº†

âœ… æ­£ç¡®åšæ³•ï¼š
connectTimeout: 3000   // 3ç§’åˆç†

âŒ é”™è¯¯2ï¼šæ‰€æœ‰æ¥å£ç”¨åŒä¸€ä¸ªè¶…æ—¶æ—¶é—´
readTimeout: 30000     // æŸ¥è¯¢å’Œæ‰¹å¤„ç†éƒ½æ˜¯30ç§’

âœ… æ­£ç¡®åšæ³•ï¼š
# å¿«é€ŸæŸ¥è¯¢æ¥å£
user-service:
  readTimeout: 10000
  
# æ…¢æ¥å£
report-service:
  readTimeout: 60000
```

---

## 3. ğŸ”„ é‡è¯•ç­–ç•¥è¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯é‡è¯•æœºåˆ¶


**é€šä¿—ç†è§£**ï¼š
ä½ æ‰“ç”µè¯ç»™æœ‹å‹ï¼Œæ²¡äººæ¥ã€‚ä½ å¯ä»¥é€‰æ‹©ï¼š
- **ä¸é‡è¯•**ï¼šæ”¾å¼ƒï¼Œä¸æ‰“äº†
- **é‡è¯•**ï¼šå†æ‰“ä¸€æ¬¡ã€ä¸¤æ¬¡ã€ä¸‰æ¬¡...

å¾®æœåŠ¡çš„é‡è¯•ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚

### 3.2 é‡è¯•æ¬¡æ•°è®¾ç½®


**ğŸ”¸ é‡è¯•æ¬¡æ•°çš„å«ä¹‰**ï¼š
```
maxAttempts = 3  è¡¨ç¤ºä»€ä¹ˆï¼Ÿ

ç¬¬1æ¬¡ï¼šåŸå§‹è¯·æ±‚ï¼ˆä¸ç®—é‡è¯•ï¼‰
ç¬¬2æ¬¡ï¼šç¬¬1æ¬¡é‡è¯•
ç¬¬3æ¬¡ï¼šç¬¬2æ¬¡é‡è¯•

æ€»å…±æ‰§è¡Œ3æ¬¡ï¼Œé‡è¯•äº†2æ¬¡
```

**é…ç½®ç¤ºä¾‹ï¼ˆSpring Retryï¼‰**ï¼š
```java
@Service
public class OrderService {
    
    @Retryable(
        value = {TimeoutException.class},  // ä»€ä¹ˆå¼‚å¸¸æ—¶é‡è¯•
        maxAttempts = 3,                   // æœ€å¤šæ‰§è¡Œ3æ¬¡
        backoff = @Backoff(delay = 2000)   // é‡è¯•é—´éš”2ç§’
    )
    public Order getOrder(Long orderId) {
        // è°ƒç”¨è¿œç¨‹æœåŠ¡
        return restTemplate.getForObject(
            "http://order-service/order/" + orderId, 
            Order.class
        );
    }
}
```

**Feigné‡è¯•é…ç½®**ï¼š
```yaml
feign:
  client:
    config:
      default:
        # æ˜¯å¦å¯ç”¨é‡è¯•ï¼ˆé»˜è®¤falseï¼‰
        retryer: feign.Retryer.Default
        
# è‡ªå®šä¹‰é‡è¯•å™¨
@Bean
public Retryer feignRetryer() {
    return new Retryer.Default(
        100,      // åˆå§‹é‡è¯•é—´éš”100ms
        1000,     // æœ€å¤§é‡è¯•é—´éš”1ç§’
        3         // æœ€å¤šé‡è¯•3æ¬¡
    );
}
```

### 3.3 é‡è¯•é—´éš”é…ç½®


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦é‡è¯•é—´éš”**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
æœåŠ¡Bå› ä¸ºæµé‡è¿‡å¤§ï¼Œå“åº”å˜æ…¢

å¦‚æœç«‹å³é‡è¯•ï¼š
ç¬¬1æ¬¡ï¼šå¤±è´¥ï¼ˆæœåŠ¡Bå‹åŠ›å¤§ï¼‰
ç¬¬2æ¬¡ï¼šç«‹å³é‡è¯•ï¼Œå¤±è´¥ï¼ˆå‹åŠ›æ›´å¤§äº†ï¼‰
ç¬¬3æ¬¡ï¼šç«‹å³é‡è¯•ï¼Œå¤±è´¥ï¼ˆé›ªä¸ŠåŠ éœœï¼‰
â†’ ç»“æœï¼šè¶Šé‡è¯•ï¼ŒæœåŠ¡Bå‹åŠ›è¶Šå¤§

åŠ ä¸Šé‡è¯•é—´éš”ï¼š
ç¬¬1æ¬¡ï¼šå¤±è´¥
ç­‰å¾…2ç§’ï¼ˆç»™æœåŠ¡Bç¼“å†²æ—¶é—´ï¼‰
ç¬¬2æ¬¡ï¼šé‡è¯•ï¼Œå¯èƒ½æˆåŠŸ
```

**é…ç½®æ–¹å¼**ï¼š
```java
// å›ºå®šé—´éš”é‡è¯•
@Retryable(
    maxAttempts = 3,
    backoff = @Backoff(delay = 2000)  // æ¯æ¬¡é—´éš”2ç§’
)

// æ‰§è¡Œæ—¶é—´çº¿ï¼š
// 0ç§’ï¼šç¬¬1æ¬¡è¯·æ±‚å¤±è´¥
// 2ç§’ï¼šç¬¬1æ¬¡é‡è¯•
// 4ç§’ï¼šç¬¬2æ¬¡é‡è¯•
```

**å»ºè®®é—´éš”æ—¶é—´**ï¼š

| åœºæ™¯ | **é‡è¯•é—´éš”** | **è¯´æ˜** |
|-----|------------|---------|
| `å¿«é€Ÿå¤±è´¥åœºæ™¯` | **100-500ms** | `ç½‘ç»œæŠ–åŠ¨ã€ç¬æ—¶æ•…éšœ` |
| `ä¸€èˆ¬åœºæ™¯` | **1-3ç§’** | `æœåŠ¡æš‚æ—¶ç¹å¿™` |
| `æ…¢æ¥å£` | **3-5ç§’** | `æ•°æ®åº“æ¢å¤ã€ç¼“å­˜é¢„çƒ­` |
| `æ‰¹é‡ä»»åŠ¡` | **10-30ç§’** | `ç³»ç»Ÿèµ„æºæ¢å¤` |

---

## 4. ğŸ“ˆ æŒ‡æ•°é€€é¿ç®—æ³•


### 4.1 ä»€ä¹ˆæ˜¯æŒ‡æ•°é€€é¿


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒç©æ¸¸æˆå¤±è´¥åçš„é‡è¯•ç­‰å¾…æ—¶é—´ï¼š
- ç¬¬1æ¬¡å¤±è´¥ï¼šç­‰1ç§’
- ç¬¬2æ¬¡å¤±è´¥ï¼šç­‰2ç§’  
- ç¬¬3æ¬¡å¤±è´¥ï¼šç­‰4ç§’
- ç¬¬4æ¬¡å¤±è´¥ï¼šç­‰8ç§’

**ç­‰å¾…æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œè¿™å°±æ˜¯"æŒ‡æ•°çº§"å¢é•¿**ã€‚

### 4.2 ä¸ºä»€ä¹ˆè¦ç”¨æŒ‡æ•°é€€é¿


**å¯¹æ¯”å›ºå®šé—´éš”**ï¼š
```
å›ºå®šé—´éš”é‡è¯•ï¼ˆæ¯æ¬¡ç­‰2ç§’ï¼‰ï¼š
æ—¶é—´è½´ï¼š0ç§’ â†’ 2ç§’ â†’ 4ç§’ â†’ 6ç§’ â†’ 8ç§’
é—®é¢˜ï¼šå¦‚æœæœåŠ¡å‹åŠ›å¤§ï¼Œè¿™æ ·é‡è¯•åè€ŒåŠ é‡è´Ÿæ‹…

æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆåˆå§‹1ç§’ï¼‰ï¼š
æ—¶é—´è½´ï¼š0ç§’ â†’ 1ç§’ â†’ 2ç§’ â†’ 4ç§’ â†’ 8ç§’
ä¼˜åŠ¿ï¼šç»™æœåŠ¡æ›´å¤šæ¢å¤æ—¶é—´
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
åœºæ™¯ï¼šç”µå•†ç§’æ€åå°æœåŠ¡è¿‡è½½

ç”¨æˆ·Açš„è¯·æ±‚ï¼š
ç¬¬1æ¬¡ï¼šå¤±è´¥ï¼ˆ0ç§’ï¼‰
ç¬¬1æ¬¡é‡è¯•ï¼šå¤±è´¥ï¼ˆç­‰å¾…1ç§’åï¼‰
ç¬¬2æ¬¡é‡è¯•ï¼šå¤±è´¥ï¼ˆç­‰å¾…2ç§’åï¼‰
ç¬¬3æ¬¡é‡è¯•ï¼šæˆåŠŸï¼ˆç­‰å¾…4ç§’åï¼‰â† æœåŠ¡æ¢å¤äº†

å¦‚æœæ˜¯å›ºå®šé—´éš”1ç§’ï¼š
å¯èƒ½åœ¨3ç§’å†…å°±æ”¾å¼ƒäº†ï¼Œé”™è¿‡äº†æœåŠ¡æ¢å¤çš„æœºä¼š
```

### 4.3 é…ç½®æŒ‡æ•°é€€é¿


**Spring Retryé…ç½®**ï¼š
```java
@Retryable(
    maxAttempts = 5,
    backoff = @Backoff(
        delay = 1000,          // åˆå§‹å»¶è¿Ÿ1ç§’
        multiplier = 2,        // æ¯æ¬¡å»¶è¿Ÿç¿»å€ï¼ˆæŒ‡æ•°å› å­ï¼‰
        maxDelay = 10000       // æœ€å¤§å»¶è¿Ÿ10ç§’
    )
)
public String callService() {
    // ä¸šåŠ¡ä»£ç 
}

// é‡è¯•æ—¶é—´è®¡ç®—ï¼š
// ç¬¬1æ¬¡é‡è¯•ï¼š1ç§’å
// ç¬¬2æ¬¡é‡è¯•ï¼š2ç§’å  ï¼ˆ1 Ã— 2ï¼‰
// ç¬¬3æ¬¡é‡è¯•ï¼š4ç§’å  ï¼ˆ2 Ã— 2ï¼‰
// ç¬¬4æ¬¡é‡è¯•ï¼š8ç§’å  ï¼ˆ4 Ã— 2ï¼‰
// ç¬¬5æ¬¡é‡è¯•ï¼š10ç§’å ï¼ˆ16ç§’ï¼Œä½†é™åˆ¶äº†æœ€å¤§10ç§’ï¼‰
```

**è‡ªå®šä¹‰é€€é¿ç­–ç•¥**ï¼š
```java
@Bean
public RetryTemplate retryTemplate() {
    RetryTemplate template = new RetryTemplate();
    
    // æŒ‡æ•°é€€é¿ç­–ç•¥
    ExponentialBackOffPolicy backOffPolicy = new ExponentialBackOffPolicy();
    backOffPolicy.setInitialInterval(1000);    // åˆå§‹é—´éš”1ç§’
    backOffPolicy.setMultiplier(2.0);          // æŒ‡æ•°å› å­2
    backOffPolicy.setMaxInterval(10000);       // æœ€å¤§é—´éš”10ç§’
    
    template.setBackOffPolicy(backOffPolicy);
    return template;
}
```

### 4.4 é€€é¿ç®—æ³•å¯¹æ¯”


```
åœºæ™¯ï¼šæœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œéœ€è¦é‡è¯•5æ¬¡

å›ºå®šé—´éš”ï¼ˆ2ç§’ï¼‰ï¼š
â”œâ”€ ç¬¬1æ¬¡é‡è¯•ï¼š2ç§’å
â”œâ”€ ç¬¬2æ¬¡é‡è¯•ï¼š4ç§’å
â”œâ”€ ç¬¬3æ¬¡é‡è¯•ï¼š6ç§’å
â”œâ”€ ç¬¬4æ¬¡é‡è¯•ï¼š8ç§’å
â””â”€ ç¬¬5æ¬¡é‡è¯•ï¼š10ç§’å
æ€»è€—æ—¶ï¼š10ç§’

æŒ‡æ•°é€€é¿ï¼ˆåˆå§‹1ç§’ï¼Œå€æ•°2ï¼‰ï¼š
â”œâ”€ ç¬¬1æ¬¡é‡è¯•ï¼š1ç§’å
â”œâ”€ ç¬¬2æ¬¡é‡è¯•ï¼š2ç§’å
â”œâ”€ ç¬¬3æ¬¡é‡è¯•ï¼š4ç§’å
â”œâ”€ ç¬¬4æ¬¡é‡è¯•ï¼š8ç§’å
â””â”€ ç¬¬5æ¬¡é‡è¯•ï¼š16ç§’å
æ€»è€—æ—¶ï¼š31ç§’ï¼ˆä½†ç»™äº†æœåŠ¡æ›´å¤šæ¢å¤æ—¶é—´ï¼‰

å¸¦ä¸Šé™çš„æŒ‡æ•°é€€é¿ï¼ˆåˆå§‹1ç§’ï¼Œå€æ•°2ï¼Œæœ€å¤§5ç§’ï¼‰ï¼š
â”œâ”€ ç¬¬1æ¬¡é‡è¯•ï¼š1ç§’å
â”œâ”€ ç¬¬2æ¬¡é‡è¯•ï¼š2ç§’å
â”œâ”€ ç¬¬3æ¬¡é‡è¯•ï¼š4ç§’å
â”œâ”€ ç¬¬4æ¬¡é‡è¯•ï¼š5ç§’åï¼ˆè¾¾åˆ°ä¸Šé™ï¼‰
â””â”€ ç¬¬5æ¬¡é‡è¯•ï¼š5ç§’åï¼ˆè¾¾åˆ°ä¸Šé™ï¼‰
æ€»è€—æ—¶ï¼š17ç§’ï¼ˆå¹³è¡¡äº†é€Ÿåº¦å’Œå®¹é”™ï¼‰
```

**ğŸ¯ é€‰æ‹©å»ºè®®**ï¼š
- âœ… **å¿«é€Ÿæ¢å¤åœºæ™¯**ï¼šå›ºå®šé—´éš”ï¼Œå¿«é€Ÿé‡è¯•
- âœ… **æœåŠ¡è¿‡è½½åœºæ™¯**ï¼šæŒ‡æ•°é€€é¿ï¼Œé€æ­¥å¢åŠ é—´éš”
- âœ… **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¸¦ä¸Šé™çš„æŒ‡æ•°é€€é¿ï¼Œæœ€å®ç”¨

---

## 5. ğŸ” è¯·æ±‚å¹‚ç­‰æ€§ä¿è¯


### 5.1 ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§


**ç”Ÿæ´»åœºæ™¯ç†è§£**ï¼š
- **å¹‚ç­‰æ“ä½œ**ï¼šç”µæ¢¯æŒ‰é’®ï¼ŒæŒ‰1æ¬¡å’ŒæŒ‰10æ¬¡æ•ˆæœä¸€æ ·
- **éå¹‚ç­‰æ“ä½œ**ï¼šæ‰£æ¬¾ï¼Œæ‰£1æ¬¡å’Œæ‰£10æ¬¡ç»“æœå®Œå…¨ä¸åŒ

**æŠ€æœ¯å®šä¹‰**ï¼š
```
å¹‚ç­‰æ€§ï¼šåŒä¸€ä¸ªè¯·æ±‚æ‰§è¡Œå¤šæ¬¡ï¼Œäº§ç”Ÿçš„ç»“æœå’Œæ‰§è¡Œä¸€æ¬¡å®Œå…¨ç›¸åŒ

ç¤ºä¾‹å¯¹æ¯”ï¼š

âœ… å¹‚ç­‰æ“ä½œï¼š
æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼šGET /user/123
â†’ æŸ¥1æ¬¡ï¼šè¿”å›ç”¨æˆ·ä¿¡æ¯
â†’ æŸ¥10æ¬¡ï¼šè¿”å›çš„è¿˜æ˜¯åŒæ ·çš„ç”¨æˆ·ä¿¡æ¯

âŒ éå¹‚ç­‰æ“ä½œï¼š
æ‰£å‡åº“å­˜ï¼šPOST /stock/reduce
â†’ æ‰£1æ¬¡ï¼šåº“å­˜-1
â†’ æ‰£10æ¬¡ï¼šåº“å­˜-10ï¼ˆå®Œè›‹äº†ï¼ï¼‰
```

### 5.2 é‡è¯•ä¸ºä»€ä¹ˆè¦è€ƒè™‘å¹‚ç­‰æ€§


**é—®é¢˜åœºæ™¯**ï¼š
```
ç”¨æˆ·è´­ä¹°å•†å“ï¼Œæ‰£å‡åº“å­˜ï¼š

æ­£å¸¸æµç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯ï¼šæ‰£å‡åº“å­˜1ä»¶
æœåŠ¡ç«¯ï¼šåº“å­˜100 â†’ 99 âœ…
æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ï¼šè¿”å›æˆåŠŸ

é‡è¯•åœºæ™¯ï¼ˆç½‘ç»œè¶…æ—¶ï¼‰ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯ï¼šæ‰£å‡åº“å­˜1ä»¶
æœåŠ¡ç«¯ï¼šåº“å­˜100 â†’ 99ï¼ˆæ‰§è¡ŒæˆåŠŸï¼‰
æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ï¼šå“åº”åŒ…ä¸¢å¤±âŒ

å®¢æˆ·ç«¯ä»¥ä¸ºå¤±è´¥ï¼Œè‡ªåŠ¨é‡è¯•ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯ï¼šæ‰£å‡åº“å­˜1ä»¶ï¼ˆé‡è¯•ï¼‰
æœåŠ¡ç«¯ï¼šåº“å­˜99 â†’ 98ï¼ˆåˆæ‰£äº†ä¸€æ¬¡ï¼ï¼‰âŒ
æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ï¼šè¿”å›æˆåŠŸ

ç»“æœï¼šç”¨æˆ·ä¹°1ä»¶ï¼Œæ‰£äº†2ä»¶åº“å­˜
```

### 5.3 å¹‚ç­‰æ€§å®ç°æ–¹æ¡ˆ


**æ–¹æ¡ˆ1ï¼šå”¯ä¸€è¯·æ±‚IDï¼ˆæ¨èï¼‰**

åŸç†ï¼šæ¯ä¸ªè¯·æ±‚å¸¦å”¯ä¸€IDï¼ŒæœåŠ¡ç«¯è®°å½•å·²å¤„ç†çš„ID

```java
// å®¢æˆ·ç«¯ï¼šç”Ÿæˆå”¯ä¸€è¯·æ±‚ID
public class OrderService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public void reduceStock(Long productId, Integer count) {
        // ç”Ÿæˆå”¯ä¸€è¯·æ±‚ID
        String requestId = UUID.randomUUID().toString();
        
        HttpHeaders headers = new HttpHeaders();
        headers.set("X-Request-Id", requestId);  // è¯·æ±‚IDæ”¾header
        
        HttpEntity<StockRequest> request = new HttpEntity<>(
            new StockRequest(productId, count),
            headers
        );
        
        restTemplate.postForObject(
            "http://stock-service/reduce",
            request,
            String.class
        );
    }
}

// æœåŠ¡ç«¯ï¼šæ£€æŸ¥è¯·æ±‚ID
@Service
public class StockService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    public void reduceStock(String requestId, Long productId, Integer count) {
        // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡è¿™ä¸ªè¯·æ±‚
        String key = "request:processed:" + requestId;
        
        if (redisTemplate.opsForValue().get(key) != null) {
            // å·²ç»å¤„ç†è¿‡ï¼Œç›´æ¥è¿”å›
            return;
        }
        
        // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        doReduceStock(productId, count);
        
        // æ ‡è®°è¯·æ±‚å·²å¤„ç†ï¼ˆä¿å­˜1å°æ—¶ï¼‰
        redisTemplate.opsForValue().set(key, "1", 1, TimeUnit.HOURS);
    }
}
```

**æ–¹æ¡ˆ2ï¼šæ•°æ®åº“å”¯ä¸€çº¦æŸ**

é€‚åˆè®¢å•ã€æ”¯ä»˜ç­‰åœºæ™¯

```sql
-- è®¢å•è¡¨æ·»åŠ å”¯ä¸€ç´¢å¼•
CREATE TABLE `order` (
  `id` BIGINT PRIMARY KEY,
  `order_no` VARCHAR(32) UNIQUE,  -- è®¢å•å·å”¯ä¸€
  `user_id` BIGINT,
  `amount` DECIMAL(10,2)
);

-- æ’å…¥æ—¶è‡ªåŠ¨å»é‡
INSERT INTO `order` (order_no, user_id, amount) 
VALUES ('ORDER123', 1001, 100.00);

-- é‡å¤æ’å…¥ä¼šå¤±è´¥ï¼ˆå”¯ä¸€çº¦æŸï¼‰
-- ä¿è¯äº†å¹‚ç­‰æ€§
```

**æ–¹æ¡ˆ3ï¼šçŠ¶æ€æœºæ§åˆ¶**

é€šè¿‡çŠ¶æ€æµè½¬ä¿è¯å¹‚ç­‰

```java
public class OrderService {
    
    public void payOrder(Long orderId) {
        Order order = orderMapper.selectById(orderId);
        
        // æ£€æŸ¥è®¢å•çŠ¶æ€
        if (order.getStatus() == OrderStatus.PAID) {
            // å·²æ”¯ä»˜ï¼Œç›´æ¥è¿”å›
            return;
        }
        
        if (order.getStatus() != OrderStatus.WAIT_PAY) {
            throw new BusinessException("è®¢å•çŠ¶æ€ä¸æ­£ç¡®");
        }
        
        // æ‰§è¡Œæ”¯ä»˜é€»è¾‘
        doPayment(order);
        
        // æ›´æ–°è®¢å•çŠ¶æ€ï¼šå¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜
        order.setStatus(OrderStatus.PAID);
        orderMapper.updateById(order);
    }
}
```

### 5.4 å¹‚ç­‰æ€§æ–¹æ¡ˆé€‰æ‹©


| æ–¹æ¡ˆ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-----|------------|---------|---------|
| `å”¯ä¸€è¯·æ±‚ID` | **é€šç”¨åœºæ™¯** | `çµæ´»ï¼Œé€‚ç”¨å„ç§æ¥å£` | `éœ€è¦Redisç­‰å­˜å‚¨` |
| `æ•°æ®åº“å”¯ä¸€çº¦æŸ` | **è®¢å•ã€æ”¯ä»˜** | `ç®€å•å¯é ï¼Œæ•°æ®åº“ä¿è¯` | `ä»…é™æœ‰å”¯ä¸€å­—æ®µçš„åœºæ™¯` |
| `çŠ¶æ€æœº` | **çŠ¶æ€æµè½¬åœºæ™¯** | `ä¸šåŠ¡è¯­ä¹‰æ¸…æ™°` | `åªé€‚åˆæœ‰çŠ¶æ€çš„ä¸šåŠ¡` |
| `ä¹è§‚é”` | **åº“å­˜æ‰£å‡** | `é«˜å¹¶å‘æ€§èƒ½å¥½` | `éœ€è¦versionå­—æ®µ` |

---

## 6. âš ï¸ å¼‚å¸¸å¤„ç†ä¸é‡è¯•æ¡ä»¶


### 6.1 è¶…æ—¶å¼‚å¸¸å¤„ç†


**å¸¸è§è¶…æ—¶å¼‚å¸¸ç±»å‹**ï¼š
```
è¿æ¥è¶…æ—¶å¼‚å¸¸ï¼š
â†’ java.net.ConnectException
â†’ java.net.SocketTimeoutException (connect timeout)

è¯»å–è¶…æ—¶å¼‚å¸¸ï¼š
â†’ java.net.SocketTimeoutException (read timeout)
â†’ org.springframework.web.client.ResourceAccessException

Feignè¶…æ—¶å¼‚å¸¸ï¼š
â†’ feign.RetryableException
```

**å¼‚å¸¸æ•è·å¤„ç†**ï¼š
```java
@Service
public class OrderService {
    
    public Order getOrder(Long orderId) {
        try {
            return restTemplate.getForObject(
                "http://order-service/order/" + orderId,
                Order.class
            );
        } catch (ResourceAccessException e) {
            // åˆ¤æ–­æ˜¯å¦æ˜¯è¶…æ—¶å¼‚å¸¸
            if (e.getCause() instanceof SocketTimeoutException) {
                log.error("è°ƒç”¨è®¢å•æœåŠ¡è¶…æ—¶: {}", orderId);
                // è¿”å›é™çº§æ•°æ®æˆ–æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸
                return getOrderFromCache(orderId);
            }
            throw e;
        }
    }
}
```

### 6.2 é‡è¯•æ¡ä»¶åˆ¤æ–­


**ğŸ”¸ ä»€ä¹ˆæ—¶å€™åº”è¯¥é‡è¯•**ï¼š
```
âœ… åº”è¯¥é‡è¯•çš„åœºæ™¯ï¼š
1. ç½‘ç»œè¶…æ—¶ï¼ˆä¸´æ—¶ç½‘ç»œæŠ–åŠ¨ï¼‰
2. 503æœåŠ¡ä¸å¯ç”¨ï¼ˆæœåŠ¡é‡å¯ä¸­ï¼‰
3. è¿æ¥è¢«æ‹’ç»ï¼ˆæœåŠ¡æ­£åœ¨å¯åŠ¨ï¼‰
4. è¯»å–è¶…æ—¶ï¼ˆæœåŠ¡å¤„ç†æ…¢ï¼‰

âŒ ä¸åº”è¯¥é‡è¯•çš„åœºæ™¯ï¼š
1. 400å‚æ•°é”™è¯¯ï¼ˆé‡è¯•ä¹Ÿæ˜¯é”™ï¼‰
2. 401æœªæˆæƒï¼ˆé‡è¯•æ²¡æ„ä¹‰ï¼‰
3. 404èµ„æºä¸å­˜åœ¨ï¼ˆé‡è¯•è¿˜æ˜¯ä¸å­˜åœ¨ï¼‰
4. 500æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ˆå¯èƒ½æ˜¯ä¸šåŠ¡å¼‚å¸¸ï¼‰
```

**é…ç½®é‡è¯•æ¡ä»¶**ï¼š
```java
@Configuration
public class RetryConfig {
    
    @Bean
    public RetryTemplate retryTemplate() {
        RetryTemplate template = new RetryTemplate();
        
        // è®¾ç½®é‡è¯•ç­–ç•¥
        SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();
        retryPolicy.setMaxAttempts(3);
        
        // å®šä¹‰å“ªäº›å¼‚å¸¸éœ€è¦é‡è¯•
        Map<Class<? extends Throwable>, Boolean> exceptions = new HashMap<>();
        exceptions.put(SocketTimeoutException.class, true);      // è¶…æ—¶é‡è¯•
        exceptions.put(ConnectException.class, true);            // è¿æ¥å¼‚å¸¸é‡è¯•
        exceptions.put(HttpServerErrorException.class, false);   // 5xxä¸é‡è¯•
        exceptions.put(HttpClientErrorException.class, false);   // 4xxä¸é‡è¯•
        
        retryPolicy.setRetryableExceptions(exceptions);
        template.setRetryPolicy(retryPolicy);
        
        return template;
    }
}
```

**Feigné‡è¯•æ¡ä»¶**ï¼š
```java
@Bean
public Retryer feignRetryer() {
    return new Retryer.Default(100, 1000, 3) {
        @Override
        public void continueOrPropagate(RetryableException e) {
            // è‡ªå®šä¹‰é‡è¯•é€»è¾‘
            if (e.status() == 503) {
                // 503æœåŠ¡ä¸å¯ç”¨ï¼Œç»§ç»­é‡è¯•
                super.continueOrPropagate(e);
            } else if (e.status() >= 400 && e.status() < 500) {
                // 4xxå®¢æˆ·ç«¯é”™è¯¯ï¼Œä¸é‡è¯•
                throw e;
            } else {
                // å…¶ä»–æƒ…å†µç»§ç»­é‡è¯•
                super.continueOrPropagate(e);
            }
        }
    };
}
```

### 6.3 é‡è¯•ä¸é™çº§ç»„åˆ


**å®é™…åœºæ™¯å¤„ç†**ï¼š
```java
@Service
public class ProductService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    // é‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”2ç§’
    @Retryable(
        value = {SocketTimeoutException.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 2000)
    )
    public Product getProduct(Long productId) {
        return restTemplate.getForObject(
            "http://product-service/product/" + productId,
            Product.class
        );
    }
    
    // é‡è¯•å¤±è´¥åçš„é™çº§å¤„ç†
    @Recover
    public Product recover(SocketTimeoutException e, Long productId) {
        log.error("è·å–å•†å“ä¿¡æ¯å¤±è´¥ï¼Œå¯ç”¨é™çº§: {}", productId);
        
        // é™çº§æ–¹æ¡ˆ1ï¼šä»ç¼“å­˜è·å–
        Product cachedProduct = getCachedProduct(productId);
        if (cachedProduct != null) {
            return cachedProduct;
        }
        
        // é™çº§æ–¹æ¡ˆ2ï¼šè¿”å›é»˜è®¤å•†å“ä¿¡æ¯
        return getDefaultProduct(productId);
    }
}
```

---

## 7. ğŸ› ï¸ å®æˆ˜é…ç½®æŒ‡å—


### 7.1 RestTemplateå®Œæ•´é…ç½®


```java
@Configuration
public class RestTemplateConfig {
    
    @Bean
    public RestTemplate restTemplate() {
        // 1. é…ç½®è¶…æ—¶æ—¶é—´
        RequestConfig requestConfig = RequestConfig.custom()
            .setConnectTimeout(3000)           // è¿æ¥è¶…æ—¶3ç§’
            .setSocketTimeout(30000)           // è¯»å–è¶…æ—¶30ç§’
            .setConnectionRequestTimeout(1000) // ä»è¿æ¥æ± è·å–è¿æ¥è¶…æ—¶1ç§’
            .build();
        
        // 2. é…ç½®è¿æ¥æ± 
        PoolingHttpClientConnectionManager connectionManager = 
            new PoolingHttpClientConnectionManager();
        connectionManager.setMaxTotal(200);         // æœ€å¤§è¿æ¥æ•°200
        connectionManager.setDefaultMaxPerRoute(50); // æ¯ä¸ªè·¯ç”±æœ€å¤§50
        
        // 3. åˆ›å»ºHttpClient
        CloseableHttpClient httpClient = HttpClients.custom()
            .setConnectionManager(connectionManager)
            .setDefaultRequestConfig(requestConfig)
            .setRetryHandler(new DefaultHttpRequestRetryHandler(3, true))
            .build();
        
        // 4. åˆ›å»ºRestTemplate
        HttpComponentsClientHttpRequestFactory factory = 
            new HttpComponentsClientHttpRequestFactory(httpClient);
        
        RestTemplate restTemplate = new RestTemplate(factory);
        
        // 5. æ·»åŠ æ‹¦æˆªå™¨ï¼ˆå¯é€‰ï¼‰
        restTemplate.setInterceptors(Arrays.asList(
            new LoggingInterceptor()
        ));
        
        return restTemplate;
    }
}
```

### 7.2 Feignå®Œæ•´é…ç½®


```yaml
# application.yml
feign:
  client:
    config:
      # å…¨å±€é…ç½®
      default:
        connectTimeout: 3000      # è¿æ¥è¶…æ—¶3ç§’
        readTimeout: 30000        # è¯»å–è¶…æ—¶30ç§’
        loggerLevel: basic        # æ—¥å¿—çº§åˆ«
        
      # ç‰¹å®šæœåŠ¡é…ç½®
      product-service:
        connectTimeout: 2000
        readTimeout: 20000
        
      order-service:
        connectTimeout: 5000
        readTimeout: 60000
  
  # å¯ç”¨é‡è¯•
  httpclient:
    enabled: true
    max-connections: 200
    max-connections-per-route: 50
```

```java
// Feignå®¢æˆ·ç«¯
@FeignClient(
    name = "product-service",
    fallback = ProductServiceFallback.class
)
public interface ProductServiceClient {
    
    @GetMapping("/product/{id}")
    Product getProduct(@PathVariable("id") Long id);
}

// é™çº§å¤„ç†
@Component
public class ProductServiceFallback implements ProductServiceClient {
    
    @Override
    public Product getProduct(Long id) {
        // è¿”å›é™çº§æ•°æ®
        return Product.builder()
            .id(id)
            .name("å•†å“æœåŠ¡æš‚æ—¶ä¸å¯ç”¨")
            .build();
    }
}
```

### 7.3 ç›‘æ§ä¸å‘Šè­¦é…ç½®


**å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼š
```java
@Component
@Aspect
public class ServiceCallMonitor {
    
    @Autowired
    private MeterRegistry meterRegistry;
    
    @Around("@annotation(Retryable)")
    public Object monitorRetry(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            Object result = joinPoint.proceed();
            
            // è®°å½•æˆåŠŸè°ƒç”¨
            meterRegistry.counter(
                "service.call.success",
                "method", methodName
            ).increment();
            
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥è°ƒç”¨
            meterRegistry.counter(
                "service.call.failure",
                "method", methodName,
                "exception", e.getClass().getSimpleName()
            ).increment();
            
            throw e;
            
        } finally {
            // è®°å½•è°ƒç”¨è€—æ—¶
            sample.stop(Timer.builder("service.call.duration")
                .tag("method", methodName)
                .register(meterRegistry));
        }
    }
}
```

**å‘Šè­¦è§„åˆ™ç¤ºä¾‹**ï¼š
```
ç›‘æ§æŒ‡æ ‡ï¼š
1. æœåŠ¡è°ƒç”¨è¶…æ—¶ç‡ > 10%  â†’ å‘é€å‘Šè­¦
2. é‡è¯•æ¬¡æ•° > 100æ¬¡/åˆ†é’Ÿ  â†’ å‘é€å‘Šè­¦
3. æœåŠ¡å“åº”æ—¶é—´ > 5ç§’    â†’ å‘é€å‘Šè­¦
4. è¿æ¥æ± ä½¿ç”¨ç‡ > 80%    â†’ å‘é€å‘Šè­¦
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è¶…æ—¶æœºåˆ¶å…³é”®ç‚¹


```
ğŸ”¸ è¿æ¥è¶…æ—¶ vs è¯»å–è¶…æ—¶
â”œâ”€ è¿æ¥è¶…æ—¶ï¼šå»ºç«‹TCPè¿æ¥çš„æ—¶é—´ï¼ˆ2-5ç§’ï¼‰
â””â”€ è¯»å–è¶…æ—¶ï¼šç­‰å¾…å“åº”æ•°æ®çš„æ—¶é—´ï¼ˆ10-60ç§’ï¼‰

ğŸ”¸ è¶…æ—¶è®¾ç½®åŸåˆ™
â”œâ”€ å†…ç½‘æœåŠ¡ï¼šè¿æ¥3ç§’ï¼Œè¯»å–30ç§’
â”œâ”€ å¤–ç½‘æœåŠ¡ï¼šè¿æ¥5ç§’ï¼Œè¯»å–60ç§’
â””â”€ æ…¢æ¥å£ï¼šå•ç‹¬é…ç½®æ›´é•¿è¶…æ—¶
```

### 8.2 é‡è¯•æœºåˆ¶å…³é”®ç‚¹


```
ğŸ”¸ é‡è¯•æ¬¡æ•°
â”œâ”€ ä¸€èˆ¬åœºæ™¯ï¼š3æ¬¡
â”œâ”€ é‡è¦åœºæ™¯ï¼š5æ¬¡
â””â”€ ä¸å»ºè®®ï¼šè¶…è¿‡5æ¬¡

ğŸ”¸ é‡è¯•é—´éš”
â”œâ”€ å›ºå®šé—´éš”ï¼šé€‚åˆå¿«é€Ÿæ¢å¤åœºæ™¯
â”œâ”€ æŒ‡æ•°é€€é¿ï¼šé€‚åˆæœåŠ¡è¿‡è½½åœºæ™¯
â””â”€ å»ºè®®ï¼šå¸¦ä¸Šé™çš„æŒ‡æ•°é€€é¿ï¼ˆæœ€å®ç”¨ï¼‰

ğŸ”¸ é‡è¯•æ¡ä»¶
â”œâ”€ âœ… ç½‘ç»œè¶…æ—¶ã€è¿æ¥æ‹’ç»ã€503é”™è¯¯
â””â”€ âŒ å‚æ•°é”™è¯¯ã€æœªæˆæƒã€ä¸šåŠ¡å¼‚å¸¸
```

### 8.3 å¹‚ç­‰æ€§å…³é”®ç‚¹


```
ğŸ”¸ å¹‚ç­‰æ€§å®šä¹‰
åŒä¸€ä¸ªè¯·æ±‚æ‰§è¡Œå¤šæ¬¡ï¼Œç»“æœå’Œæ‰§è¡Œä¸€æ¬¡ç›¸åŒ

ğŸ”¸ å®ç°æ–¹æ¡ˆ
â”œâ”€ å”¯ä¸€è¯·æ±‚IDï¼šé€šç”¨æ–¹æ¡ˆï¼Œæœ€çµæ´»
â”œâ”€ æ•°æ®åº“å”¯ä¸€çº¦æŸï¼šè®¢å•ã€æ”¯ä»˜åœºæ™¯
â”œâ”€ çŠ¶æ€æœºï¼šæœ‰çŠ¶æ€æµè½¬çš„ä¸šåŠ¡
â””â”€ ä¹è§‚é”ï¼šåº“å­˜æ‰£å‡ã€å¹¶å‘æ›´æ–°

ğŸ”¸ æ³¨æ„äº‹é¡¹
é‡è¯•å¿…é¡»è€ƒè™‘å¹‚ç­‰æ€§ï¼Œå¦åˆ™å¯èƒ½é€ æˆæ•°æ®é”™è¯¯
```

### 8.4 å®æˆ˜å»ºè®®


**é…ç½®æ¨¡æ¿ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**ï¼š
```yaml
# æ¨èé…ç½®
feign:
  client:
    config:
      default:
        connectTimeout: 3000          # è¿æ¥è¶…æ—¶3ç§’
        readTimeout: 30000            # è¯»å–è¶…æ—¶30ç§’
        
# é‡è¯•é…ç½®
@Retryable(
    value = {SocketTimeoutException.class},
    maxAttempts = 3,
    backoff = @Backoff(
        delay = 1000,       # åˆå§‹1ç§’
        multiplier = 2,     # æŒ‡æ•°å› å­2
        maxDelay = 5000     # æœ€å¤§5ç§’
    )
)
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è¶…æ—¶æœºåˆ¶åˆ†ä¸¤æ®µï¼Œè¿æ¥è¯»å–è¦åˆ†æ¸…
é‡è¯•ç­–ç•¥è¦åˆç†ï¼ŒæŒ‡æ•°é€€é¿æœ€ç¨³å¦¥
å¹‚ç­‰ä¿è¯æ˜¯å…³é”®ï¼Œè¯·æ±‚IDæ¥å¸®å¿™
å¼‚å¸¸åˆ†ç±»è¦æ˜ç¡®ï¼Œè¯¥é‡è¯•æ—¶å†é‡è¯•
ç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œé—®é¢˜å‘ç°è¦åŠæ—¶
```