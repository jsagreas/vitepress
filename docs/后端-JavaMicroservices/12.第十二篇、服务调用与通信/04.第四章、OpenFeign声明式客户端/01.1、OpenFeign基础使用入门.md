---
title: 1ã€OpenFeignåŸºç¡€ä½¿ç”¨å…¥é—¨
---
## ğŸ“š ç›®å½•

1. [OpenFeignæ˜¯ä»€ä¹ˆ](#1-OpenFeignæ˜¯ä»€ä¹ˆ)
2. [EnableFeignClientsæ³¨è§£é…ç½®](#2-EnableFeignClientsæ³¨è§£é…ç½®)
3. [FeignClientæ¥å£å®šä¹‰](#3-FeignClientæ¥å£å®šä¹‰)
4. [Spring MVCæ³¨è§£æ”¯æŒ](#4-SpringMVCæ³¨è§£æ”¯æŒ)
5. [æœåŠ¡åç§°é…ç½®è¯¦è§£](#5-æœåŠ¡åç§°é…ç½®è¯¦è§£)
6. [å‚æ•°ä¼ é€’çš„å¤šç§æ–¹å¼](#6-å‚æ•°ä¼ é€’çš„å¤šç§æ–¹å¼)
7. [è¿”å›å€¼å¤„ç†æœºåˆ¶](#7-è¿”å›å€¼å¤„ç†æœºåˆ¶)
8. [æ¥å£ä»£ç†è°ƒç”¨åŸç†](#8-æ¥å£ä»£ç†è°ƒç”¨åŸç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ OpenFeignæ˜¯ä»€ä¹ˆ


### 1.1 ç™½è¯ç†è§£OpenFeign


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šOpenFeignå°±åƒæ˜¯ä¸€ä¸ª"è‡ªåŠ¨æ‰“ç”µè¯"çš„å·¥å…·ã€‚ä½ åªéœ€è¦å‘Šè¯‰å®ƒ"æˆ‘è¦ç»™è°æ‰“ç”µè¯"å’Œ"è¯´ä»€ä¹ˆè¯"ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®ä½ æ‹¨å·ã€é€šè¯ã€æ‹¿åˆ°ç»“æœã€‚

**ä¼ ç»Ÿæ–¹å¼è°ƒç”¨å…¶ä»–æœåŠ¡**ï¼ˆå°±åƒè‡ªå·±æ‰‹åŠ¨æ‰“ç”µè¯ï¼‰ï¼š
```
ä½ éœ€è¦åšçš„äº‹æƒ…ï¼š
1. æ‰¾åˆ°å¯¹æ–¹çš„ç”µè¯å·ç ï¼ˆæœåŠ¡åœ°å€ï¼‰
2. æ‹¨å·ï¼ˆå»ºç«‹HTTPè¿æ¥ï¼‰
3. è¯´è¯ï¼ˆå‘é€è¯·æ±‚å‚æ•°ï¼‰
4. å¬å›å¤ï¼ˆæ¥æ”¶å“åº”ï¼‰
5. æŒ‚ç”µè¯ï¼ˆå…³é—­è¿æ¥ï¼‰
```

**ä½¿ç”¨OpenFeign**ï¼ˆåƒæœ‰ä¸ªæ™ºèƒ½åŠ©æ‰‹å¸®ä½ æ‰“ç”µè¯ï¼‰ï¼š
```
ä½ åªéœ€è¦ï¼š
1. å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¯´æ˜è¦è°ƒç”¨è°çš„ä»€ä¹ˆæ–¹æ³•
2. ç›´æ¥è°ƒç”¨è¿™ä¸ªæ¥å£
3. OpenFeignè‡ªåŠ¨å®Œæˆæ‰€æœ‰é€šä¿¡ç»†èŠ‚
```

### 1.2 OpenFeignçš„æ ¸å¿ƒä½œç”¨


**æœ¬è´¨**ï¼šOpenFeignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„HTTPå®¢æˆ·ç«¯ï¼Œè®©å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚

```
â”Œâ”€ ä¼ ç»ŸRestTemplateè°ƒç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚  String url = "http://user-service/..";â”‚
â”‚  RestTemplate rest = new RestTemplate();â”‚
â”‚  User user = rest.getForObject(url,    â”‚
â”‚                User.class, params);    â”‚
â”‚  // éœ€è¦æ‰‹åŠ¨æ‹¼æ¥URLã€å¤„ç†å‚æ•°          â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â¬‡ï¸ OpenFeignç®€åŒ–

â”Œâ”€ OpenFeignå£°æ˜å¼è°ƒç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚  @FeignClient("user-service")         â”‚
â”‚  interface UserClient {               â”‚
â”‚    @GetMapping("/user/{id}")          â”‚
â”‚    User getUser(@PathVariable id);    â”‚
â”‚  }                                    â”‚
â”‚                                        â”‚
â”‚  // ç›´æ¥è°ƒç”¨ï¼Œåƒæœ¬åœ°æ–¹æ³•ä¸€æ ·           â”‚
â”‚  User user = userClient.getUser(1);   â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ä¼˜åŠ¿**ï¼š
- âœ… **ç®€æ´ç›´è§‚**ï¼šæ¥å£å®šä¹‰å³è°ƒç”¨è§„åˆ™ï¼Œä¸ç”¨å†™HTTPè°ƒç”¨ä»£ç 
- âœ… **è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨å¤„ç†åºåˆ—åŒ–ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°
- âœ… **å¯ç»´æŠ¤**ï¼šæ¥å£å³æ–‡æ¡£ï¼Œä¸€çœ‹å°±çŸ¥é“è°ƒç”¨ä»€ä¹ˆæœåŠ¡
- âœ… **Springé›†æˆ**ï¼šå®Œç¾å…¼å®¹Spring MVCæ³¨è§£

### 1.3 OpenFeignåœ¨å¾®æœåŠ¡ä¸­çš„ä½ç½®


```
å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ï¼š
                                         
è®¢å•æœåŠ¡                ç”¨æˆ·æœåŠ¡          åº“å­˜æœåŠ¡
Order-Service   â†’      User-Service  â†’  Stock-Service
    â¬‡ï¸                      â¬‡ï¸                â¬‡ï¸
  OpenFeign            OpenFeign         OpenFeign
  è°ƒç”¨å®¢æˆ·ç«¯            è°ƒç”¨å®¢æˆ·ç«¯         è°ƒç”¨å®¢æˆ·ç«¯
    â¬‡ï¸                      â¬‡ï¸                â¬‡ï¸
        HTTPé€šä¿¡ + è´Ÿè½½å‡è¡¡ + æœåŠ¡å‘ç°
```

---

## 2. ğŸ”§ EnableFeignClientsæ³¨è§£é…ç½®


### 2.1 @EnableFeignClientsæ˜¯ä»€ä¹ˆ


> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼š`@EnableFeignClients`æ˜¯OpenFeignçš„"æ€»å¼€å…³"ï¼ŒåŠ ä¸Šå®ƒï¼ŒSpringæ‰ä¼šå¸®ä½ æ‰«æå’Œåˆ›å»ºFeignå®¢æˆ·ç«¯ã€‚

**é€šä¿—æ¯”å–»**ï¼šå°±åƒä½ ä¹°äº†ä¸ªæ™ºèƒ½éŸ³ç®±ï¼Œå¿…é¡»å…ˆæ’ç”µå¼€æœºï¼ˆåŠ @EnableFeignClientsï¼‰ï¼Œæ‰èƒ½ä½¿ç”¨å®ƒçš„åŠŸèƒ½ã€‚

### 2.2 åŸºç¡€ä½¿ç”¨æ–¹å¼


**æœ€ç®€å•çš„é…ç½®**ï¼š
```java
@SpringBootApplication
@EnableFeignClients  // å¼€å¯Feignå®¢æˆ·ç«¯åŠŸèƒ½
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

> âš ï¸ **æ³¨æ„**ï¼šå¿…é¡»åŠ åœ¨å¯åŠ¨ç±»æˆ–é…ç½®ç±»ä¸Šï¼Œå¦åˆ™Feignå®¢æˆ·ç«¯ä¸ä¼šç”Ÿæ•ˆã€‚

### 2.3 æŒ‡å®šæ‰«æè·¯å¾„


**é—®é¢˜åœºæ™¯**ï¼šå¦‚æœä½ çš„Feignæ¥å£ä¸åœ¨å¯åŠ¨ç±»çš„åŒ…æˆ–å­åŒ…ä¸‹ï¼Œé»˜è®¤æ‰«æä¸åˆ°ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šæ˜ç¡®æŒ‡å®šæ‰«æè·¯å¾„

```java
// æ–¹å¼1ï¼šæŒ‡å®šå…·ä½“çš„åŒ…è·¯å¾„
@EnableFeignClients(basePackages = "com.example.api.client")

// æ–¹å¼2ï¼šæŒ‡å®šæŸä¸ªç±»æ‰€åœ¨çš„åŒ…
@EnableFeignClients(basePackageClasses = UserClient.class)

// æ–¹å¼3ï¼šæ‰«æå¤šä¸ªåŒ…
@EnableFeignClients(basePackages = {
    "com.example.order.client",
    "com.example.user.client"
})
```

**å‚æ•°è¯´æ˜è¡¨**ï¼š

| å‚æ•° | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `basePackages` | æŒ‡å®šæ‰«æçš„åŒ…è·¯å¾„ | Feignæ¥å£åœ¨ç‰¹å®šåŒ…ä¸‹ |
| `basePackageClasses` | é€šè¿‡ç±»å®šä½åŒ…ä½ç½® | é¿å…ç¡¬ç¼–ç åŒ…å |
| `clients` | ç›´æ¥æŒ‡å®šFeignæ¥å£ç±» | ç²¾ç¡®æ§åˆ¶å“ªäº›æ¥å£ç”Ÿæ•ˆ |
| `defaultConfiguration` | å…¨å±€é»˜è®¤é…ç½®ç±» | ç»Ÿä¸€é…ç½®è¶…æ—¶ã€æ—¥å¿—ç­‰ |

### 2.4 å®Œæ•´é…ç½®ç¤ºä¾‹


```java
@SpringBootApplication
@EnableFeignClients(
    basePackages = "com.example.clients",  // æ‰«æè·¯å¾„
    defaultConfiguration = FeignConfig.class  // é»˜è®¤é…ç½®
)
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}

// è‡ªå®šä¹‰Feigné…ç½®ç±»
@Configuration
public class FeignConfig {
    @Bean
    public Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;  // é…ç½®æ—¥å¿—çº§åˆ«
    }
}
```

---

## 3. ğŸ“ FeignClientæ¥å£å®šä¹‰


### 3.1 @FeignClientæ³¨è§£è¯¦è§£


> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼š`@FeignClient`æ ‡è®°ä¸€ä¸ªæ¥å£æ˜¯Feignå®¢æˆ·ç«¯ï¼Œå‘Šè¯‰OpenFeignè¿™ä¸ªæ¥å£è¦è°ƒç”¨å“ªä¸ªæœåŠ¡ã€‚

**åŸºæœ¬æ ¼å¼**ï¼š
```java
@FeignClient(name = "æœåŠ¡åç§°")
public interface æ¥å£å {
    // å®šä¹‰è°ƒç”¨æ–¹æ³•
}
```

### 3.2 æœåŠ¡åç§°é…ç½®ï¼ˆé‡è¦ï¼‰


**æ–¹å¼1ï¼šä½¿ç”¨æœåŠ¡åï¼ˆæ¨èï¼‰**
```java
@FeignClient(name = "user-service")  // æœåŠ¡åï¼Œä»æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾
public interface UserClient {
    // ...
}
```

**å·¥ä½œåŸç†å›¾ç¤º**ï¼š
```
è°ƒç”¨æµç¨‹ï¼š
UserClient.getUser(1)
    â¬‡ï¸
ä»æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾ "user-service" çš„å®ä¾‹åˆ—è¡¨
    â¬‡ï¸
[192.168.1.10:8080, 192.168.1.11:8080]
    â¬‡ï¸
è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ªå®ä¾‹
    â¬‡ï¸
å‘èµ·HTTPè¯·æ±‚
```

**æ–¹å¼2ï¼šç›´æ¥æŒ‡å®šURLï¼ˆä¸æ¨èï¼‰**
```java
@FeignClient(name = "user-service", url = "http://localhost:8080")
public interface UserClient {
    // ç›´æ¥è°ƒç”¨æŒ‡å®šåœ°å€ï¼Œä¸èµ°æœåŠ¡å‘ç°
}
```

> âš ï¸ **ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š
> - **æœåŠ¡åæ–¹å¼**ï¼šé€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨
> - **URLæ–¹å¼**ï¼šé€‚åˆå¼€å‘è°ƒè¯•ï¼Œæˆ–è°ƒç”¨å¤–éƒ¨å›ºå®šåœ°å€çš„æœåŠ¡

### 3.3 æ¥å£å®šä¹‰çš„å®Œæ•´ç¤ºä¾‹


```java
@FeignClient(
    name = "user-service",           // æœåŠ¡åç§°ï¼ˆå¿…å¡«ï¼‰
    path = "/api/v1",                // ç»Ÿä¸€è·¯å¾„å‰ç¼€
    configuration = UserFeignConfig.class  // è‡ªå®šä¹‰é…ç½®
)
public interface UserClient {
    
    // æŸ¥è¯¢å•ä¸ªç”¨æˆ·
    @GetMapping("/user/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    // æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
    @GetMapping("/users")
    List<User> getAllUsers();
    
    // åˆ›å»ºç”¨æˆ·
    @PostMapping("/user")
    User createUser(@RequestBody User user);
    
    // æ›´æ–°ç”¨æˆ·
    @PutMapping("/user/{id}")
    User updateUser(@PathVariable("id") Long id, @RequestBody User user);
    
    // åˆ é™¤ç”¨æˆ·
    @DeleteMapping("/user/{id}")
    void deleteUser(@PathVariable("id") Long id);
}
```

**æ¥å£è¦æ±‚è¯´æ˜**ï¼š
- âœ… å¿…é¡»æ˜¯æ¥å£ï¼Œä¸èƒ½æ˜¯ç±»
- âœ… ä¸éœ€è¦@Componentç­‰Springæ³¨è§£ï¼ŒFeignä¼šè‡ªåŠ¨åˆ›å»ºä»£ç†å¯¹è±¡
- âœ… æ–¹æ³•ä¸Šä½¿ç”¨Spring MVCæ³¨è§£å®šä¹‰HTTPè°ƒç”¨è§„åˆ™

---

## 4. ğŸ¯ Spring MVCæ³¨è§£æ”¯æŒ


### 4.1 OpenFeignæ”¯æŒçš„æ³¨è§£


> ğŸ“– **é‡è¦æ¦‚å¿µ**ï¼šOpenFeignå®Œç¾æ”¯æŒSpring MVCçš„å¸¸ç”¨æ³¨è§£ï¼Œè®©ä½ ç”¨å†™Controllerçš„æ–¹å¼å®šä¹‰å®¢æˆ·ç«¯ã€‚

**æ”¯æŒçš„æ ¸å¿ƒæ³¨è§£**ï¼š

| æ³¨è§£ | ä½œç”¨ | HTTPæ–¹æ³• |
|------|------|----------|
| `@GetMapping` | æŸ¥è¯¢æ“ä½œ | GET |
| `@PostMapping` | åˆ›å»ºæ“ä½œ | POST |
| `@PutMapping` | æ›´æ–°æ“ä½œ | PUT |
| `@DeleteMapping` | åˆ é™¤æ“ä½œ | DELETE |
| `@RequestMapping` | é€šç”¨æ˜ å°„ | å¯æŒ‡å®šä»»æ„æ–¹æ³• |

### 4.2 @GetMappingæŸ¥è¯¢è¯·æ±‚


**åœºæ™¯1ï¼šæŸ¥è¯¢å•ä¸ªèµ„æº**
```java
// æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
@GetMapping("/user/{id}")
User getUser(@PathVariable("id") Long id);

// å®é™…è¯·æ±‚ï¼šGET http://user-service/user/123
```

**åœºæ™¯2ï¼šå¸¦æŸ¥è¯¢å‚æ•°**
```java
// åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
@GetMapping("/users")
List<User> getUserList(
    @RequestParam("page") int page,
    @RequestParam("size") int size
);

// å®é™…è¯·æ±‚ï¼šGET http://user-service/users?page=1&size=10
```

### 4.3 @PostMappingåˆ›å»ºè¯·æ±‚


```java
// åˆ›å»ºæ–°ç”¨æˆ·
@PostMapping("/user")
User createUser(@RequestBody User user);

// è¯·æ±‚ä½“ä¼šè‡ªåŠ¨åºåˆ—åŒ–ä¸ºJSON
// POST http://user-service/user
// Content-Type: application/json
// Body: {"name":"å¼ ä¸‰", "age":25}
```

### 4.4 @PutMappingæ›´æ–°è¯·æ±‚


```java
// æ›´æ–°ç”¨æˆ·ä¿¡æ¯
@PutMapping("/user/{id}")
User updateUser(
    @PathVariable("id") Long id,
    @RequestBody User user
);

// PUT http://user-service/user/123
// Body: {"name":"æå››", "age":26}
```

### 4.5 @DeleteMappingåˆ é™¤è¯·æ±‚


```java
// åˆ é™¤ç”¨æˆ·
@DeleteMapping("/user/{id}")
void deleteUser(@PathVariable("id") Long id);

// DELETE http://user-service/user/123
```

### 4.6 @RequestMappingé€šç”¨æ–¹å¼


```java
// è‡ªå®šä¹‰HTTPæ–¹æ³•
@RequestMapping(value = "/user/{id}", method = RequestMethod.PATCH)
User partialUpdate(
    @PathVariable("id") Long id,
    @RequestBody Map<String, Object> updates
);

// PATCH http://user-service/user/123
```

---

## 5. ğŸ·ï¸ æœåŠ¡åç§°é…ç½®è¯¦è§£


### 5.1 æœåŠ¡åç§°çš„é‡è¦æ€§


> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šæœåŠ¡åç§°æ˜¯OpenFeignæ‰¾åˆ°ç›®æ ‡æœåŠ¡çš„"é—¨ç‰Œå·"ï¼Œå¿…é¡»å’Œæ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åä¸€è‡´ã€‚

**å·¥ä½œæµç¨‹å›¾**ï¼š
```
Feignè°ƒç”¨è¿‡ç¨‹ï¼š

@FeignClient(name = "user-service")
         â¬‡ï¸
   æŸ¥æ‰¾æ³¨å†Œä¸­å¿ƒ
         â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Nacos/Eureka/Consul â”‚
â”‚                      â”‚
â”‚  user-service:       â”‚
â”‚  - 192.168.1.10:8080â”‚
â”‚  - 192.168.1.11:8080â”‚
â”‚  - 192.168.1.12:8080â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â¬‡ï¸
   è´Ÿè½½å‡è¡¡é€‰æ‹©
         â¬‡ï¸
  å‘é€HTTPè¯·æ±‚åˆ°é€‰ä¸­çš„å®ä¾‹
```

### 5.2 æœåŠ¡åç§°çš„é…ç½®æ–¹å¼


**æ–¹å¼1ï¼šç›´æ¥åœ¨@FeignClientä¸­æŒ‡å®š**
```java
@FeignClient(name = "user-service")
public interface UserClient {
    // ...
}
```

**æ–¹å¼2ï¼šä½¿ç”¨valueå±æ€§ï¼ˆç­‰åŒnameï¼‰**
```java
@FeignClient(value = "user-service")  // valueå’Œnameå®Œå…¨ç­‰ä»·
public interface UserClient {
    // ...
}
```

**æ–¹å¼3ï¼šé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šï¼ˆä¸å¸¸ç”¨ï¼‰**
```yaml
# application.yml
feign:
  client:
    config:
      user-service:  # æœåŠ¡åç§°
        url: http://localhost:8080  # å¯é€‰ï¼šå›ºå®šURL
```

### 5.3 æœåŠ¡åç§°çš„æ³¨æ„äº‹é¡¹


> âš ï¸ **é‡è¦æé†’**ï¼š

**âœ… æ­£ç¡®åšæ³•**ï¼š
- æœåŠ¡åç§°å¿…é¡»å’Œæ³¨å†Œä¸­å¿ƒå®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦ï¼ˆå¦‚ï¼š`user-service`ï¼‰
- ä¿æŒå‘½åè§„èŒƒç»Ÿä¸€

**âŒ å¸¸è§é”™è¯¯**ï¼š
```java
// é”™è¯¯1ï¼šæœåŠ¡åæ‹¼å†™é”™è¯¯
@FeignClient(name = "userservice")  // æ³¨å†Œä¸­å¿ƒæ˜¯user-service

// é”™è¯¯2ï¼šå¤§å°å†™ä¸åŒ¹é…  
@FeignClient(name = "User-Service")  // æ³¨å†Œä¸­å¿ƒæ˜¯user-service

// é”™è¯¯3ï¼šå¤šä½™çš„åè®®å‰ç¼€
@FeignClient(name = "http://user-service")  // nameä¸éœ€è¦http://
```

### 5.4 æœåŠ¡åç§°ä¸è´Ÿè½½å‡è¡¡


**å…³é”®ç†è§£**ï¼šä½¿ç”¨æœåŠ¡åç§°æ—¶ï¼ŒOpenFeignè‡ªåŠ¨é›†æˆè´Ÿè½½å‡è¡¡ã€‚

```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/user/{id}")
    User getUser(@PathVariable Long id);
}

// è°ƒç”¨æ—¶çš„è´Ÿè½½å‡è¡¡è¿‡ç¨‹ï¼š
// ç¬¬1æ¬¡è°ƒç”¨ â†’ 192.168.1.10:8080
// ç¬¬2æ¬¡è°ƒç”¨ â†’ 192.168.1.11:8080  ï¼ˆè½®è¯¢ç­–ç•¥ï¼‰
// ç¬¬3æ¬¡è°ƒç”¨ â†’ 192.168.1.12:8080
// ç¬¬4æ¬¡è°ƒç”¨ â†’ 192.168.1.10:8080  ï¼ˆå¾ªç¯ï¼‰
```

**è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®**ï¼š
```yaml
# application.yml
user-service:
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule
    # å¯é€‰ç­–ç•¥ï¼š
    # - RoundRobinRuleï¼ˆè½®è¯¢ï¼Œé»˜è®¤ï¼‰
    # - RandomRuleï¼ˆéšæœºï¼‰
    # - WeightedResponseTimeRuleï¼ˆå“åº”æ—¶é—´æƒé‡ï¼‰
```

---

## 6. ğŸ“¦ å‚æ•°ä¼ é€’çš„å¤šç§æ–¹å¼


### 6.1 å‚æ•°ä¼ é€’æ–¹å¼æ€»è§ˆ


**OpenFeignæ”¯æŒçš„å‚æ•°ç±»å‹**ï¼š

| å‚æ•°ç±»å‹ | æ³¨è§£ | å¯¹åº”HTTPä½ç½® | ä½¿ç”¨åœºæ™¯ |
|---------|------|-------------|----------|
| è·¯å¾„å‚æ•° | `@PathVariable` | URLè·¯å¾„ | RESTfulé£æ ¼ï¼Œå¦‚ `/user/123` |
| æŸ¥è¯¢å‚æ•° | `@RequestParam` | URLå‚æ•° | æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚ `?name=å¼ ä¸‰` |
| è¯·æ±‚ä½“ | `@RequestBody` | HTTP Body | å¤æ‚å¯¹è±¡ä¼ è¾“ |
| è¯·æ±‚å¤´ | `@RequestHeader` | HTTP Header | ä¼ é€’tokenç­‰ |
| è¡¨å•å‚æ•° | `@RequestParam` + ä¸åŠ æ³¨è§£ | Form Data | è¡¨å•æäº¤ |

### 6.2 @PathVariableè·¯å¾„å‚æ•°


> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šèµ„æºçš„å”¯ä¸€æ ‡è¯†ï¼Œç¬¦åˆRESTfulè®¾è®¡é£æ ¼ã€‚

**åŸºæœ¬ç”¨æ³•**ï¼š
```java
// æŸ¥è¯¢æŒ‡å®šIDçš„ç”¨æˆ·
@GetMapping("/user/{id}")
User getUser(@PathVariable("id") Long id);

// è°ƒç”¨ï¼šuserClient.getUser(123L)
// è¯·æ±‚ï¼šGET /user/123
```

**å¤šä¸ªè·¯å¾„å‚æ•°**ï¼š
```java
// æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„æŸä¸ªè®¢å•
@GetMapping("/user/{userId}/order/{orderId}")
Order getUserOrder(
    @PathVariable("userId") Long userId,
    @PathVariable("orderId") Long orderId
);

// è°ƒç”¨ï¼šuserClient.getUserOrder(123L, 456L)
// è¯·æ±‚ï¼šGET /user/123/order/456
```

**ç®€å†™å½¢å¼ï¼ˆå‚æ•°åä¸€è‡´æ—¶ï¼‰**ï¼š
```java
@GetMapping("/user/{id}")
User getUser(@PathVariable Long id);  // å‚æ•°åå’Œå ä½ç¬¦ä¸€è‡´ï¼Œå¯çœç•¥value
```

### 6.3 @RequestParamæŸ¥è¯¢å‚æ•°


> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šè¿‡æ»¤æ¡ä»¶ã€åˆ†é¡µå‚æ•°ã€å¯é€‰å‚æ•°ç­‰ã€‚

**å•ä¸ªæŸ¥è¯¢å‚æ•°**ï¼š
```java
// æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
@GetMapping("/user/search")
User findByName(@RequestParam("name") String name);

// è°ƒç”¨ï¼šuserClient.findByName("å¼ ä¸‰")
// è¯·æ±‚ï¼šGET /user/search?name=å¼ ä¸‰
```

**å¤šä¸ªæŸ¥è¯¢å‚æ•°**ï¼š
```java
// åˆ†é¡µæŸ¥è¯¢
@GetMapping("/users")
List<User> getUserList(
    @RequestParam("page") int page,
    @RequestParam("size") int size,
    @RequestParam(value = "keyword", required = false) String keyword
);

// è°ƒç”¨ï¼šuserClient.getUserList(1, 10, "å¼ ")
// è¯·æ±‚ï¼šGET /users?page=1&size=10&keyword=å¼ 
```

**å‚æ•°è¯´æ˜**ï¼š
- `value`ï¼šå‚æ•°åç§°
- `required`ï¼šæ˜¯å¦å¿…å¡«ï¼Œé»˜è®¤true
- `defaultValue`ï¼šé»˜è®¤å€¼

```java
@GetMapping("/users")
List<User> getUsers(
    @RequestParam(value = "page", defaultValue = "1") int page,
    @RequestParam(value = "size", defaultValue = "10") int size
);
// ä¸ä¼ å‚æ•°æ—¶ä½¿ç”¨é»˜è®¤å€¼
```

### 6.4 @RequestBodyè¯·æ±‚ä½“å‚æ•°


> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šä¼ é€’å¤æ‚å¯¹è±¡ï¼Œé€šå¸¸ç”¨äºPOSTã€PUTè¯·æ±‚ã€‚

**ä¼ é€’å•ä¸ªå¯¹è±¡**ï¼š
```java
// åˆ›å»ºç”¨æˆ·
@PostMapping("/user")
User createUser(@RequestBody User user);

// è°ƒç”¨ï¼š
User newUser = new User("å¼ ä¸‰", 25);
userClient.createUser(newUser);

// è¯·æ±‚ï¼šPOST /user
// Content-Type: application/json
// Body: {"name":"å¼ ä¸‰", "age":25}
```

**ä¼ é€’Mapç±»å‹**ï¼š
```java
// éƒ¨åˆ†æ›´æ–°
@PatchMapping("/user/{id}")
User partialUpdate(
    @PathVariable Long id,
    @RequestBody Map<String, Object> updates
);

// è°ƒç”¨ï¼š
Map<String, Object> map = new HashMap<>();
map.put("name", "æå››");
userClient.partialUpdate(123L, map);
```

### 6.5 @RequestHeaderè¯·æ±‚å¤´å‚æ•°


> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šä¼ é€’tokenã€traceIdç­‰å…ƒæ•°æ®ã€‚

```java
// ä¼ é€’è®¤è¯token
@GetMapping("/user/profile")
User getProfile(@RequestHeader("Authorization") String token);

// è°ƒç”¨ï¼š
String token = "Bearer abc123...";
userClient.getProfile(token);

// è¯·æ±‚å¤´ï¼šAuthorization: Bearer abc123...
```

**å¸¸è§è¯·æ±‚å¤´**ï¼š
```java
@GetMapping("/data")
String getData(
    @RequestHeader("Authorization") String token,
    @RequestHeader("X-Request-Id") String requestId,
    @RequestHeader(value = "User-Agent", required = false) String userAgent
);
```

### 6.6 æ··åˆå‚æ•°ä½¿ç”¨


**å®é™…ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹**ï¼š
```java
// æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆå¸¦è®¤è¯ï¼‰
@PutMapping("/user/{id}")
User updateUser(
    @PathVariable("id") Long id,              // è·¯å¾„å‚æ•°ï¼šç”¨æˆ·ID
    @RequestBody User user,                   // è¯·æ±‚ä½“ï¼šç”¨æˆ·ä¿¡æ¯
    @RequestHeader("Authorization") String token  // è¯·æ±‚å¤´ï¼šè®¤è¯token
);

// è°ƒç”¨ï¼š
User updateData = new User("æå››", 26);
String token = "Bearer xxx";
userClient.updateUser(123L, updateData, token);

// å®Œæ•´è¯·æ±‚ï¼š
// PUT /user/123
// Authorization: Bearer xxx
// Body: {"name":"æå››", "age":26}
```

---

## 7. ğŸ”„ è¿”å›å€¼å¤„ç†æœºåˆ¶


### 7.1 OpenFeignè¿”å›å€¼å¤„ç†åŸç†


> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šOpenFeignä¼šè‡ªåŠ¨å°†HTTPå“åº”çš„JSONæ•°æ®è½¬æ¢æˆJavaå¯¹è±¡ï¼Œä½ åªéœ€è¦å®šä¹‰å¥½è¿”å›ç±»å‹ã€‚

**å¤„ç†æµç¨‹**ï¼š
```
HTTPå“åº” JSON
    â¬‡ï¸
{"id":1, "name":"å¼ ä¸‰", "age":25}
    â¬‡ï¸
OpenFeign è‡ªåŠ¨ååºåˆ—åŒ–
    â¬‡ï¸
Userå¯¹è±¡
    â¬‡ï¸
è¿”å›ç»™è°ƒç”¨æ–¹
```

### 7.2 å¸¸è§è¿”å›å€¼ç±»å‹


**ç±»å‹1ï¼šå•ä¸ªå¯¹è±¡**
```java
@GetMapping("/user/{id}")
User getUser(@PathVariable Long id);

// HTTPå“åº”ï¼š{"id":1, "name":"å¼ ä¸‰", "age":25}
// è¿”å›ï¼šUserå¯¹è±¡
```

**ç±»å‹2ï¼šåˆ—è¡¨é›†åˆ**
```java
@GetMapping("/users")
List<User> getUserList();

// HTTPå“åº”ï¼š[{"id":1,"name":"å¼ ä¸‰"},{"id":2,"name":"æå››"}]
// è¿”å›ï¼šList<User>é›†åˆ
```

**ç±»å‹3ï¼šMapç±»å‹**
```java
@GetMapping("/user/info")
Map<String, Object> getUserInfo(@RequestParam Long id);

// HTTPå“åº”ï¼š{"id":1, "name":"å¼ ä¸‰", "age":25}
// è¿”å›ï¼šMap<String, Object>
```

**ç±»å‹4ï¼šåŸºæœ¬ç±»å‹**
```java
@GetMapping("/user/count")
Integer getUserCount();

// HTTPå“åº”ï¼š100
// è¿”å›ï¼šIntegerç±»å‹
```

**ç±»å‹5ï¼švoidæ— è¿”å›å€¼**
```java
@DeleteMapping("/user/{id}")
void deleteUser(@PathVariable Long id);

// åªå…³å¿ƒæ“ä½œæ˜¯å¦æˆåŠŸï¼Œä¸éœ€è¦è¿”å›å€¼
```

### 7.3 ç»Ÿä¸€å“åº”å¯¹è±¡å¤„ç†


**å®é™…ä¸šåŠ¡ä¸­çš„é€šç”¨è¿”å›æ ¼å¼**ï¼š
```java
// ç»Ÿä¸€å“åº”å¯¹è±¡
public class Result<T> {
    private Integer code;    // çŠ¶æ€ç 
    private String message;  // æç¤ºä¿¡æ¯
    private T data;          // ä¸šåŠ¡æ•°æ®
    
    // getter/setter...
}

// Feignæ¥å£å®šä¹‰
@GetMapping("/user/{id}")
Result<User> getUser(@PathVariable Long id);

// è°ƒç”¨
Result<User> result = userClient.getUser(123L);
if (result.getCode() == 200) {
    User user = result.getData();
    // å¤„ç†ç”¨æˆ·æ•°æ®
}
```

### 7.4 æ³›å‹è¿”å›å€¼


```java
// åˆ†é¡µç»“æœå¯¹è±¡
public class PageResult<T> {
    private List<T> list;    // æ•°æ®åˆ—è¡¨
    private Long total;      // æ€»è®°å½•æ•°
    private Integer page;    // å½“å‰é¡µ
    private Integer size;    // æ¯é¡µå¤§å°
}

// Feignæ¥å£
@GetMapping("/users")
PageResult<User> getUserPage(
    @RequestParam int page,
    @RequestParam int size
);

// è°ƒç”¨
PageResult<User> pageResult = userClient.getUserPage(1, 10);
List<User> users = pageResult.getList();
```

### 7.5 è¿”å›å€¼å¼‚å¸¸å¤„ç†


> âš ï¸ **é‡è¦**ï¼šå½“HTTPçŠ¶æ€ç é2xxæ—¶ï¼ŒOpenFeignä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

**å¼‚å¸¸ç±»å‹å¯¹ç…§**ï¼š

| HTTPçŠ¶æ€ç  | OpenFeignå¼‚å¸¸ | è¯´æ˜ |
|-----------|--------------|------|
| 404 | `FeignException.NotFound` | èµ„æºä¸å­˜åœ¨ |
| 500 | `FeignException.InternalServerError` | æœåŠ¡å™¨é”™è¯¯ |
| å…¶ä»– | `FeignException` | é€šç”¨Feignå¼‚å¸¸ |

**å¼‚å¸¸å¤„ç†ç¤ºä¾‹**ï¼š
```java
// ä¸šåŠ¡ä»£ç ä¸­æ•è·å¼‚å¸¸
try {
    User user = userClient.getUser(999L);
} catch (FeignException.NotFound e) {
    // ç”¨æˆ·ä¸å­˜åœ¨
    log.error("ç”¨æˆ·ä¸å­˜åœ¨: {}", e.getMessage());
} catch (FeignException e) {
    // å…¶ä»–Feignè°ƒç”¨å¼‚å¸¸
    log.error("æœåŠ¡è°ƒç”¨å¤±è´¥: {}", e.getMessage());
}
```

### 7.6 è‡ªå®šä¹‰è§£ç å™¨


**é«˜çº§ç”¨æ³•ï¼šè‡ªå®šä¹‰è¿”å›å€¼è§£ç é€»è¾‘**
```java
@Configuration
public class FeignConfig {
    
    @Bean
    public Decoder feignDecoder() {
        return new ResponseEntityDecoder(new SpringDecoder(messageConverters()));
    }
    
    private ObjectFactory<HttpMessageConverters> messageConverters() {
        return () -> new HttpMessageConverters(new MappingJackson2HttpMessageConverter());
    }
}
```

---

## 8. ğŸ” æ¥å£ä»£ç†è°ƒç”¨åŸç†


### 8.1 OpenFeignçš„å·¥ä½œåŸç†


> ğŸ’¡ **æ ¸å¿ƒåŸç†**ï¼šOpenFeignä½¿ç”¨**åŠ¨æ€ä»£ç†**æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶ä¸ºæ¥å£ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œæ‹¦æˆªæ–¹æ³•è°ƒç”¨å¹¶è½¬æ¢ä¸ºHTTPè¯·æ±‚ã€‚

**å·¥ä½œæµç¨‹å›¾**ï¼š
```
ä½ çš„ä»£ç è°ƒç”¨
    â¬‡ï¸
userClient.getUser(123L)
    â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    JDK åŠ¨æ€ä»£ç†å¯¹è±¡      â”‚
â”‚  (InvocationHandler)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â¬‡ï¸
è§£ææ–¹æ³•ä¸Šçš„æ³¨è§£
@GetMapping("/user/{id}")
    â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å»ºHTTPè¯·æ±‚            â”‚
â”‚  - URL: /user/123        â”‚
â”‚  - Method: GET           â”‚
â”‚  - Headers: ...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â¬‡ï¸
é€šè¿‡è´Ÿè½½å‡è¡¡é€‰æ‹©æœåŠ¡å®ä¾‹
    â¬‡ï¸
å‘é€HTTPè¯·æ±‚
    â¬‡ï¸
æ¥æ”¶å“åº”å¹¶ååºåˆ—åŒ–
    â¬‡ï¸
è¿”å›Userå¯¹è±¡
```

### 8.2 ä»£ç†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹


**ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨æ—¶æ‰«æ**
```
@EnableFeignClients æ³¨è§£è§¦å‘
    â¬‡ï¸
æ‰«ææ‰€æœ‰æ ‡è®° @FeignClient çš„æ¥å£
    â¬‡ï¸
UserClient.class
OrderClient.class
StockClient.class
```

**ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä»£ç†å·¥å‚**
```java
// Springä¸ºæ¯ä¸ªFeignæ¥å£åˆ›å»ºFeignClientFactoryBean
FeignClientFactoryBean factory = new FeignClientFactoryBean();
factory.setType(UserClient.class);
factory.setName("user-service");
```

**ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆä»£ç†å¯¹è±¡**
```
FeignClientFactoryBean
    â¬‡ï¸
åˆ›å»º Feign.Builder
    â¬‡ï¸
é…ç½®ç¼–ç å™¨ã€è§£ç å™¨ã€æ‹¦æˆªå™¨
    â¬‡ï¸
åˆ›å»º JDK åŠ¨æ€ä»£ç†å¯¹è±¡
    â¬‡ï¸
æ³¨å†Œåˆ° Spring å®¹å™¨
```

### 8.3 æ–¹æ³•è°ƒç”¨çš„æ‹¦æˆªè¿‡ç¨‹


**æ ¸å¿ƒç»„ä»¶ï¼šInvocationHandler**

```java
// ç®€åŒ–çš„åŸç†ç¤ºæ„ï¼ˆå®é™…æ›´å¤æ‚ï¼‰
class FeignInvocationHandler implements InvocationHandler {
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) {
        // 1. è§£ææ–¹æ³•æ³¨è§£
        GetMapping mapping = method.getAnnotation(GetMapping.class);
        String path = mapping.value()[0];  // "/user/{id}"
        
        // 2. æ›¿æ¢è·¯å¾„å‚æ•°
        PathVariable pathVar = method.getParameters()[0].getAnnotation(PathVariable.class);
        String url = path.replace("{id}", args[0].toString());
        
        // 3. æ„å»ºHTTPè¯·æ±‚
        Request request = Request.create(
            Request.HttpMethod.GET,
            "http://user-service" + url,
            headers,
            body,
            charset
        );
        
        // 4. å‘é€è¯·æ±‚
        Response response = client.execute(request);
        
        // 5. è§£ç å“åº”
        return decoder.decode(response, method.getGenericReturnType());
    }
}
```

### 8.4 å…³é”®ç»„ä»¶åä½œ


**ç»„ä»¶å…³ç³»å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        @FeignClient æ¥å£             â”‚
â”‚                                     â”‚
â”‚  UserClient (ä½ å®šä¹‰çš„æ¥å£)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åŠ¨æ€ä»£ç†å¯¹è±¡                 â”‚
â”‚                                     â”‚
â”‚  - æ‹¦æˆªæ–¹æ³•è°ƒç”¨                      â”‚
â”‚  - è§£ææ³¨è§£ä¿¡æ¯                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â¬‡ï¸
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â¬‡ï¸               â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Encoder     â”‚  â”‚   Decoder    â”‚
â”‚  (ç¼–ç å™¨)      â”‚  â”‚  (è§£ç å™¨)     â”‚
â”‚               â”‚  â”‚              â”‚
â”‚ å‚æ•°â†’JSON     â”‚  â”‚ JSONâ†’å¯¹è±¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â¬‡ï¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          HTTP Client                â”‚
â”‚                                     â”‚
â”‚  - å‘é€è¯·æ±‚                          â”‚
â”‚  - è´Ÿè½½å‡è¡¡                          â”‚
â”‚  - æœåŠ¡å‘ç°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.5 ä¸ºä»€ä¹ˆä½¿ç”¨ä»£ç†æ¨¡å¼


**ä¼˜åŠ¿å¯¹æ¯”**ï¼š

```
âŒ ä¸ä½¿ç”¨ä»£ç†ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š
public class UserService {
    public User getUser(Long id) {
        String url = "http://user-service/user/" + id;
        RestTemplate rest = new RestTemplate();
        return rest.getForObject(url, User.class);
    }
    // æ¯ä¸ªæ–¹æ³•éƒ½è¦å†™HTTPè°ƒç”¨ä»£ç 
}

âœ… ä½¿ç”¨ä»£ç†ï¼ˆOpenFeignæ–¹å¼ï¼‰ï¼š
@FeignClient("user-service")
public interface UserClient {
    @GetMapping("/user/{id}")
    User getUser(@PathVariable Long id);
    // åªéœ€å®šä¹‰æ¥å£ï¼Œä»£ç†è‡ªåŠ¨å¤„ç†
}
```

**ä»£ç†æ¨¡å¼çš„å¥½å¤„**ï¼š
- âœ… **è§£è€¦**ï¼šæ¥å£å®šä¹‰å’ŒHTTPè°ƒç”¨åˆ†ç¦»
- âœ… **å¤ç”¨**ï¼šä»£ç†é€»è¾‘å¯å¤ç”¨ï¼Œä¸ç”¨æ¯ä¸ªæ–¹æ³•éƒ½å†™
- âœ… **æ‰©å±•**ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ‹¦æˆªå™¨ã€æ—¥å¿—ç­‰åŠŸèƒ½
- âœ… **ç»´æŠ¤**ï¼šæ¥å£å˜æ›´åªéœ€ä¿®æ”¹æ³¨è§£ï¼Œä¸ç”¨æ”¹HTTPè°ƒç”¨ä»£ç 

### 8.6 è°ƒè¯•æŠ€å·§ï¼šæŸ¥çœ‹ä»£ç†å¯¹è±¡


```java
@Autowired
private UserClient userClient;

public void debug() {
    // æ‰“å°ä»£ç†å¯¹è±¡çš„ç±»å‹
    System.out.println(userClient.getClass().getName());
    // è¾“å‡ºï¼šcom.sun.proxy.$Proxy123
    
    // åˆ¤æ–­æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡
    boolean isProxy = Proxy.isProxyClass(userClient.getClass());
    System.out.println("æ˜¯ä»£ç†å¯¹è±¡: " + isProxy);  // true
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ OpenFeignæœ¬è´¨ï¼šå£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼Œç®€åŒ–å¾®æœåŠ¡è°ƒç”¨
ğŸ”¸ @EnableFeignClientsï¼šæ€»å¼€å…³ï¼Œå¯ç”¨FeignåŠŸèƒ½
ğŸ”¸ @FeignClientï¼šæ ‡è®°æ¥å£ï¼Œå®šä¹‰è°ƒç”¨å“ªä¸ªæœåŠ¡
ğŸ”¸ æœåŠ¡åç§°ï¼šä»æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾æœåŠ¡å®ä¾‹ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡
ğŸ”¸ Spring MVCæ³¨è§£ï¼šå®šä¹‰HTTPè¯·æ±‚è§„åˆ™
ğŸ”¸ å‚æ•°ä¼ é€’ï¼šæ”¯æŒè·¯å¾„ã€æŸ¥è¯¢ã€è¯·æ±‚ä½“ã€è¯·æ±‚å¤´ç­‰å¤šç§æ–¹å¼
ğŸ”¸ è¿”å›å€¼å¤„ç†ï¼šè‡ªåŠ¨ååºåˆ—åŒ–JSONä¸ºJavaå¯¹è±¡
ğŸ”¸ ä»£ç†åŸç†ï¼šåŠ¨æ€ä»£ç†æ‹¦æˆªæ–¹æ³•è°ƒç”¨è½¬æ¢ä¸ºHTTPè¯·æ±‚
```

### 9.2 å¿«é€Ÿä¸Šæ‰‹æ£€æŸ¥æ¸…å•


**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

**æ­¥éª¤2ï¼šå¯ç”¨Feign**
```java
@EnableFeignClients
@SpringBootApplication
public class Application { }
```

**æ­¥éª¤3ï¼šå®šä¹‰æ¥å£**
```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/user/{id}")
    User getUser(@PathVariable Long id);
}
```

**æ­¥éª¤4ï¼šæ³¨å…¥ä½¿ç”¨**
```java
@Autowired
private UserClient userClient;

public void test() {
    User user = userClient.getUser(123L);
}
```

### 9.3 å¸¸è§é—®é¢˜è§£å†³


> âš ï¸ **é—®é¢˜1**ï¼š`No Feign Client for loadBalancing defined`

**åŸå› **ï¼šæ²¡æœ‰åŠ  `@EnableFeignClients` æ³¨è§£  
**è§£å†³**ï¼šåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ è¯¥æ³¨è§£

> âš ï¸ **é—®é¢˜2**ï¼šæœåŠ¡è°ƒç”¨404

**åŸå› **ï¼šæœåŠ¡åç§°æˆ–è·¯å¾„é…ç½®é”™è¯¯  
**è§£å†³**ï¼šæ£€æŸ¥@FeignClientçš„nameå’Œ@GetMappingçš„è·¯å¾„

> âš ï¸ **é—®é¢˜3**ï¼šè¿”å›å€¼ä¸ºnull

**åŸå› **ï¼šJSONå­—æ®µåå’Œå¯¹è±¡å±æ€§åä¸åŒ¹é…  
**è§£å†³**ï¼šä½¿ç”¨@JsonPropertyæ³¨è§£æˆ–ç»Ÿä¸€å‘½åè§„èŒƒ

### 9.4 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**ï¼š
```java
// 1. ç»Ÿä¸€ç®¡ç†Feignæ¥å£ï¼Œæ”¾åœ¨clientåŒ…ä¸‹
com.example.client
  â”œâ”€â”€ UserClient.java
  â”œâ”€â”€ OrderClient.java
  â””â”€â”€ StockClient.java

// 2. ä½¿ç”¨ç»Ÿä¸€çš„è¿”å›å¯¹è±¡
Result<User> getUser(@PathVariable Long id);

// 3. æ·»åŠ æœåŠ¡é™çº§ï¼ˆåç»­ç« èŠ‚ï¼‰
@FeignClient(name = "user-service", fallback = UserClientFallback.class)

// 4. é…ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 10000
```

**âŒ é¿å…çš„åšæ³•**ï¼š
```java
// 1. ä¸è¦åœ¨Feignæ¥å£ä¸­å†™ä¸šåŠ¡é€»è¾‘
// 2. ä¸è¦åœ¨@FeignClientä¸­ç¡¬ç¼–ç URL
// 3. ä¸è¦å¿˜è®°å¤„ç†å¼‚å¸¸
// 4. ä¸è¦è¿‡åº¦ä½¿ç”¨@RequestBodyä¼ å‚
```

### 9.5 å­¦ä¹ è·¯å¾„å»ºè®®


```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ä½¿ç”¨ â­â­â­â­â­
â”œâ”€ @EnableFeignClientsé…ç½®
â”œâ”€ @FeignClientæ¥å£å®šä¹‰
â”œâ”€ åŸºæœ¬æ³¨è§£ä½¿ç”¨
â””â”€ ç®€å•å‚æ•°ä¼ é€’

ç¬¬äºŒé˜¶æ®µï¼šè¿›é˜¶é…ç½® â­â­â­â­
â”œâ”€ è¶…æ—¶é…ç½®
â”œâ”€ æ—¥å¿—é…ç½®
â”œâ”€ æ‹¦æˆªå™¨ä½¿ç”¨
â””â”€ è‡ªå®šä¹‰ç¼–è§£ç å™¨

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§ â­â­â­
â”œâ”€ æœåŠ¡é™çº§
â”œâ”€ è¯·æ±‚é‡è¯•
â”œâ”€ ç†”æ–­æœºåˆ¶
â””â”€ æ€§èƒ½ä¼˜åŒ–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Feignå®¢æˆ·ç«¯ï¼Œå£°æ˜å¼è°ƒç”¨
æ¥å£å®šä¹‰å¥½ï¼Œä»£ç†å…¨è‡ªåŠ¨
æœåŠ¡åæ‰¾å¯¹ï¼Œè´Ÿè½½å‡è¡¡å¦™
å‚æ•°ä¼ é€’æ¸…ï¼Œè¿”å›è‡ªåŠ¨è½¬
```