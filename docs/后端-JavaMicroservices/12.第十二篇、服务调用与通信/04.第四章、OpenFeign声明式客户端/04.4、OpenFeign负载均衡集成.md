---
title: 4ã€OpenFeignè´Ÿè½½å‡è¡¡é›†æˆ
---
## ğŸ“š ç›®å½•

1. [OpenFeignè´Ÿè½½å‡è¡¡åŸºç¡€](#1-OpenFeignè´Ÿè½½å‡è¡¡åŸºç¡€)
2. [Ribboné›†æˆé…ç½®](#2-Ribboné›†æˆé…ç½®)
3. [Spring Cloud LoadBalanceré›†æˆ](#3-Spring-Cloud-LoadBalanceré›†æˆ)
4. [æœåŠ¡å‘ç°ç»“åˆä½¿ç”¨](#4-æœåŠ¡å‘ç°ç»“åˆä½¿ç”¨)
5. [è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®](#5-è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®)
6. [å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»](#6-å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ OpenFeignè´Ÿè½½å‡è¡¡åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ å»ä¸€å®¶è¿é”è¶…å¸‚è´­ç‰©ï¼Œè¿™å®¶è¶…å¸‚åœ¨åŒä¸€ä¸ªå•†åœˆæœ‰3å®¶åˆ†åº—ã€‚ä½ ä¸éœ€è¦çŸ¥é“å…·ä½“å»å“ªå®¶åº—ï¼Œè¶…å¸‚çš„å¯¼è´­ç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ åˆ†é…åˆ°äººæœ€å°‘çš„é‚£å®¶åº—ã€‚è´Ÿè½½å‡è¡¡å°±æ˜¯è¿™ä¸ªå¯¼è´­ç³»ç»Ÿçš„è§’è‰²ã€‚

```
å¾®æœåŠ¡åœºæ™¯ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ â†’ OpenFeign â†’ è´Ÿè½½å‡è¡¡å™¨ â†’ é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹

æ¯”å¦‚ï¼šè®¢å•æœåŠ¡æœ‰3ä¸ªå®ä¾‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¢å•æœåŠ¡Aâ”‚ â† ç¬¬1æ¬¡è¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚è®¢å•æœåŠ¡Bâ”‚ â† ç¬¬2æ¬¡è¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚è®¢å•æœåŠ¡Câ”‚ â† ç¬¬3æ¬¡è¯·æ±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **åˆ†æ•£å‹åŠ›**ï¼šæŠŠè¯·æ±‚å‡åŒ€åˆ†é…åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Š
- ğŸ”¸ **æé«˜å¯ç”¨æ€§**ï¼šæŸä¸ªå®ä¾‹æŒ‚äº†ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–å®ä¾‹
- ğŸ”¸ **æå‡æ€§èƒ½**ï¼šå¤šä¸ªå®ä¾‹å¹¶è¡Œå¤„ç†ï¼Œæ•´ä½“å“åº”æ›´å¿«

### 1.2 OpenFeignçš„è´Ÿè½½å‡è¡¡æœºåˆ¶


**å·¥ä½œåŸç†**ï¼šOpenFeignè‡ªå·±ä¸åšè´Ÿè½½å‡è¡¡ï¼Œå®ƒä¾èµ–å¤–éƒ¨çš„è´Ÿè½½å‡è¡¡ç»„ä»¶æ¥å®ç°

```
è¯·æ±‚æµç¨‹ï¼š

1. ä½ å†™ä»£ç è°ƒç”¨ï¼šorderClient.getOrder(123)
   
2. OpenFeignæ‹¦æˆªè¯·æ±‚ï¼š"è¦è°ƒç”¨order-serviceæœåŠ¡"
   
3. è¯¢é—®è´Ÿè½½å‡è¡¡å™¨ï¼š"order-serviceæœ‰å“ªäº›å®ä¾‹ï¼Ÿå¸®æˆ‘é€‰ä¸€ä¸ª"
   
4. è´Ÿè½½å‡è¡¡å™¨è¿”å›ï¼š"ç”¨è¿™ä¸ª â†’ http://192.168.1.100:8080"
   
5. OpenFeignå‘èµ·çœŸå®HTTPè°ƒç”¨
```

**ä¸¤å¤§è´Ÿè½½å‡è¡¡ç»„ä»¶**ï¼š

| ç»„ä»¶ | ç‰¹ç‚¹ | çŠ¶æ€ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Ribbon** | `Netflixå¼€æºï¼ŒåŠŸèƒ½ä¸°å¯Œ` | `ç»´æŠ¤æ¨¡å¼ï¼Œä¸å†æ›´æ–°` | `è€é¡¹ç›®ï¼Œå·²æœ‰Ribboné…ç½®` |
| **Spring Cloud LoadBalancer** | `Springå®˜æ–¹ï¼Œè½»é‡ç®€æ´` | `ç§¯æç»´æŠ¤ï¼Œæ¨èä½¿ç”¨` | `æ–°é¡¹ç›®ï¼ŒSpring Cloudæ–°ç‰ˆæœ¬` |

---

## 2. ğŸ”§ Ribboné›†æˆé…ç½®


### 2.1 Ribbonæ˜¯ä»€ä¹ˆ


**ç®€å•ç†è§£**ï¼šRibbonå°±åƒä¸€ä¸ª"æ™ºèƒ½é€‰æ‹©å™¨"ï¼Œå®ƒè®°ä½äº†æ‰€æœ‰å¯ç”¨çš„æœåŠ¡å®ä¾‹åœ°å€ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶æŒ‰ç…§æŸç§è§„åˆ™ï¼ˆè½®è¯¢ã€éšæœºç­‰ï¼‰é€‰ä¸€ä¸ªå‡ºæ¥ç”¨ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡**ï¼šåœ¨è°ƒç”¨æ–¹è¿™è¾¹åšé€‰æ‹©ï¼Œä¸æ˜¯åœ¨æœåŠ¡ç«¯
- **ä¸æœåŠ¡å‘ç°é…åˆ**ï¼šä»Nacosæˆ–Eurekaè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
- **å¤šç§ç­–ç•¥**ï¼šè½®è¯¢ã€éšæœºã€å“åº”æ—¶é—´åŠ æƒç­‰

### 2.2 æ·»åŠ Ribbonä¾èµ–


```xml
<!-- æ–¹å¼1ï¼šSpring Cloudè€ç‰ˆæœ¬ï¼Œé»˜è®¤åŒ…å«Ribbon -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>

<!-- æ–¹å¼2ï¼šæ–°ç‰ˆæœ¬éœ€è¦æ˜¾å¼æ·»åŠ ï¼ˆå¦‚æœä½¿ç”¨Ribbonï¼‰ -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>
</dependency>
```

> âš ï¸ **æ³¨æ„**ï¼šSpring Cloud 2020.xä»¥åé»˜è®¤ç§»é™¤äº†Ribbonï¼Œæ¨èä½¿ç”¨LoadBalancer

### 2.3 åŸºç¡€é…ç½®ç¤ºä¾‹


**é…ç½®æ–‡ä»¶æ–¹å¼**ï¼š

```yaml
# application.yml
# å…¨å±€Ribboné…ç½®
ribbon:
  # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  ConnectTimeout: 3000
  # è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  ReadTimeout: 5000
  # æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œéƒ½é‡è¯•
  OkToRetryOnAllOperations: false
  # åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°
  MaxAutoRetriesNextServer: 1
  # åŒä¸€å®ä¾‹çš„é‡è¯•æ¬¡æ•°
  MaxAutoRetries: 0

# é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„é…ç½®
order-service:
  ribbon:
    # è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šè½®è¯¢
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule
    # è¿æ¥è¶…æ—¶ï¼ˆé’ˆå¯¹è®¢å•æœåŠ¡ï¼‰
    ConnectTimeout: 2000
```

**Javaé…ç½®æ–¹å¼**ï¼š

```java
/**
 * Ribbonå…¨å±€é…ç½®ç±»
 * æ³¨æ„ï¼šä¸è¦æ”¾åœ¨@SpringBootApplicationæ‰«æçš„åŒ…ä¸‹ï¼Œé¿å…å…¨å±€ç”Ÿæ•ˆ
 */
public class RibbonConfiguration {
    
    /**
     * è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡è§„åˆ™ï¼šéšæœºç­–ç•¥
     */
    @Bean
    public IRule ribbonRule() {
        return new RandomRule();  // éšæœºé€‰æ‹©æœåŠ¡å®ä¾‹
    }
    
    /**
     * è‡ªå®šä¹‰Pingç­–ç•¥ï¼šå¥åº·æ£€æŸ¥
     */
    @Bean
    public IPing ribbonPing() {
        return new PingUrl();  // é€šè¿‡HTTPè¯·æ±‚æ£€æŸ¥æœåŠ¡å¥åº·
    }
}

/**
 * å¯åŠ¨ç±»ï¼šæŒ‡å®šæœåŠ¡ä½¿ç”¨çš„Ribboné…ç½®
 */
@SpringBootApplication
@EnableFeignClients
@RibbonClient(name = "order-service", configuration = RibbonConfiguration.class)
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### 2.4 Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥è¯¦è§£


| ç­–ç•¥ç±» | ç­–ç•¥åç§° | å·¥ä½œæ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|--------|----------|----------|----------|
| `RoundRobinRule` | **è½®è¯¢** | `æŒ‰é¡ºåºä¾æ¬¡é€‰æ‹©å®ä¾‹` | `å®ä¾‹æ€§èƒ½ç›¸è¿‘ï¼Œé»˜è®¤ç­–ç•¥` |
| `RandomRule` | **éšæœº** | `éšæœºæŒ‘é€‰ä¸€ä¸ªå®ä¾‹` | `å®ä¾‹æ€§èƒ½ç›¸è¿‘ï¼Œåˆ†å¸ƒå¼åœºæ™¯` |
| `WeightedResponseTimeRule` | **å“åº”æ—¶é—´åŠ æƒ** | `å“åº”è¶Šå¿«çš„å®ä¾‹ï¼Œè¢«é€‰ä¸­æ¦‚ç‡è¶Šé«˜` | `å®ä¾‹æ€§èƒ½å·®å¼‚å¤§` |
| `BestAvailableRule` | **æœ€ä½å¹¶å‘** | `é€‰æ‹©å¹¶å‘è¯·æ±‚æ•°æœ€å°‘çš„å®ä¾‹` | `é•¿è¿æ¥æœåŠ¡ï¼ŒWebSocket` |
| `RetryRule` | **é‡è¯•** | `å¤±è´¥åæ¢ä¸‹ä¸€ä¸ªå®ä¾‹é‡è¯•` | `éœ€è¦é«˜å¯ç”¨çš„åœºæ™¯` |
| `AvailabilityFilteringRule` | **å¯ç”¨è¿‡æ»¤** | `è¿‡æ»¤æ‰æ•…éšœå’Œé«˜å¹¶å‘å®ä¾‹` | `ç”Ÿäº§ç¯å¢ƒæ¨è` |

**ç­–ç•¥é€‰æ‹©å»ºè®®**ï¼š

```
æ–°æ‰‹æ¨èé…ç½®ï¼š
ribbon:
  NFLoadBalancerRuleClassName: com.netflix.loadbalancer.AvailabilityFilteringRule
  
è¿™ä¸ªç­–ç•¥ä¼šï¼š
âœ… è‡ªåŠ¨è¿‡æ»¤æ‰å®•æœºçš„å®ä¾‹
âœ… é¿å…é€‰æ‹©é«˜å¹¶å‘çš„å®ä¾‹
âœ… åœ¨å‰©ä½™å®ä¾‹ä¸­è½®è¯¢é€‰æ‹©
```

---

## 3. ğŸŒŸ Spring Cloud LoadBalanceré›†æˆ


### 3.1 ä¸ºä»€ä¹ˆè¦ç”¨LoadBalancer


**èƒŒæ™¯è¯´æ˜**ï¼šRibbonå·²ç»è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼ŒSpringå®˜æ–¹æ¨å‡ºäº†LoadBalancerä½œä¸ºæ›¿ä»£å“ï¼Œæ›´è½»é‡ã€æ›´ç°ä»£ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- ğŸ”¸ **å®˜æ–¹æ”¯æŒ**ï¼šSpringå›¢é˜ŸæŒç»­ç»´æŠ¤ï¼Œç´§è·ŸæŠ€æœ¯å‘å±•
- ğŸ”¸ **ç®€å•æ˜“ç”¨**ï¼šé…ç½®æ›´ç®€æ´ï¼Œå­¦ä¹ æˆæœ¬ä½
- ğŸ”¸ **å“åº”å¼æ”¯æŒ**ï¼šåŸç”Ÿæ”¯æŒWebFluxå“åº”å¼ç¼–ç¨‹
- ğŸ”¸ **å¯æ‰©å±•**ï¼šå®¹æ˜“è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥

### 3.2 å¿«é€Ÿé›†æˆæ­¥éª¤


**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**

```xml
<!-- OpenFeignå·²ç»åŒ…å«LoadBalancer -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>

<!-- å¦‚æœä½¿ç”¨NacosæœåŠ¡å‘ç° -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>

<!-- å¦‚æœè¦æ’é™¤Ribbonï¼ˆSpring Cloud 2020.xä¹‹å‰ç‰ˆæœ¬ï¼‰ -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-loadbalancer</artifactId>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®æ–‡ä»¶**

```yaml
spring:
  application:
    name: user-service
  cloud:
    # NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒ
    nacos:
      discovery:
        server-addr: localhost:8848
    # LoadBalanceré…ç½®
    loadbalancer:
      # ä½¿ç”¨Nacosä½œä¸ºæœåŠ¡å‘ç°
      nacos:
        enabled: true
      # ç¼“å­˜é…ç½®
      cache:
        enabled: true
        ttl: 35s  # å®ä¾‹åˆ—è¡¨ç¼“å­˜æ—¶é—´

# OpenFeigné…ç½®
feign:
  client:
    config:
      default:
        connectTimeout: 3000
        readTimeout: 5000
```

**æ­¥éª¤3ï¼šå®šä¹‰Feignå®¢æˆ·ç«¯**

```java
/**
 * è®¢å•æœåŠ¡å®¢æˆ·ç«¯
 * nameæŒ‡å®šæœåŠ¡åï¼ŒLoadBalancerä¼šè‡ªåŠ¨ä»Nacosè·å–å®ä¾‹åˆ—è¡¨
 */
@FeignClient(name = "order-service")
public interface OrderClient {
    
    @GetMapping("/orders/{id}")
    OrderDTO getOrder(@PathVariable("id") Long id);
    
    @PostMapping("/orders")
    OrderDTO createOrder(@RequestBody OrderDTO order);
}
```

### 3.3 LoadBalancerè´Ÿè½½å‡è¡¡ç­–ç•¥


**é»˜è®¤ç­–ç•¥ï¼šè½®è¯¢ï¼ˆRoundRobinï¼‰**

```java
/**
 * è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®
 * æ³¨æ„ï¼šè¿™ä¸ªç±»ä¸è¦æ”¾åœ¨@ComponentScanæ‰«æçš„åŒ…ä¸‹
 */
public class LoadBalancerConfig {
    
    /**
     * ä½¿ç”¨éšæœºç­–ç•¥
     */
    @Bean
    public ReactorLoadBalancer<ServiceInstance> randomLoadBalancer(
            Environment environment,
            LoadBalancerClientFactory loadBalancerClientFactory) {
        
        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);
        return new RandomLoadBalancer(
            loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class),
            name
        );
    }
}

/**
 * å¯åŠ¨ç±»ï¼šæŒ‡å®šæœåŠ¡ä½¿ç”¨çš„é…ç½®
 */
@SpringBootApplication
@EnableFeignClients
@LoadBalancerClient(name = "order-service", configuration = LoadBalancerConfig.class)
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

**è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ç¤ºä¾‹**ï¼š

```java
/**
 * åŸºäºæƒé‡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥
 * åœºæ™¯ï¼šæŸäº›å®ä¾‹æ€§èƒ½æ›´å¥½ï¼Œåˆ†é…æ›´å¤šè¯·æ±‚
 */
@Slf4j
public class WeightedLoadBalancer implements ReactorServiceInstanceLoadBalancer {
    
    private final ObjectProvider<ServiceInstanceListSupplier> serviceInstanceListSupplierProvider;
    private final String serviceId;
    
    public WeightedLoadBalancer(ObjectProvider<ServiceInstanceListSupplier> provider, String serviceId) {
        this.serviceInstanceListSupplierProvider = provider;
        this.serviceId = serviceId;
    }
    
    @Override
    public Mono<Response<ServiceInstance>> choose(Request request) {
        ServiceInstanceListSupplier supplier = serviceInstanceListSupplierProvider.getIfAvailable();
        return supplier.get(request).next().map(this::getInstanceResponse);
    }
    
    /**
     * æ ¹æ®æƒé‡é€‰æ‹©å®ä¾‹
     */
    private Response<ServiceInstance> getInstanceResponse(List<ServiceInstance> instances) {
        if (instances.isEmpty()) {
            return new EmptyResponse();
        }
        
        // è®¡ç®—æ€»æƒé‡ï¼ˆä»å…ƒæ•°æ®ä¸­è·å–æƒé‡å€¼ï¼‰
        int totalWeight = instances.stream()
            .mapToInt(instance -> {
                String weight = instance.getMetadata().getOrDefault("weight", "1");
                return Integer.parseInt(weight);
            })
            .sum();
        
        // ç”Ÿæˆéšæœºæ•°
        int randomWeight = ThreadLocalRandom.current().nextInt(totalWeight);
        
        // é€‰æ‹©å®ä¾‹
        int currentWeight = 0;
        for (ServiceInstance instance : instances) {
            String weight = instance.getMetadata().getOrDefault("weight", "1");
            currentWeight += Integer.parseInt(weight);
            if (randomWeight < currentWeight) {
                log.info("é€‰ä¸­æœåŠ¡å®ä¾‹: {}:{}", instance.getHost(), instance.getPort());
                return new DefaultResponse(instance);
            }
        }
        
        return new DefaultResponse(instances.get(0));
    }
}
```

### 3.4 LoadBalanceræ ¸å¿ƒé…ç½®é¡¹


| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ä½¿ç”¨å»ºè®® |
|--------|------|--------|----------|
| `spring.cloud.loadbalancer.cache.enabled` | `æ˜¯å¦å¼€å¯å®ä¾‹ç¼“å­˜` | `true` | `å»ºè®®å¼€å¯ï¼Œå‡å°‘æœåŠ¡å‘ç°è°ƒç”¨` |
| `spring.cloud.loadbalancer.cache.ttl` | `ç¼“å­˜è¿‡æœŸæ—¶é—´` | `35s` | `æ ¹æ®æœåŠ¡ç¨³å®šæ€§è°ƒæ•´` |
| `spring.cloud.loadbalancer.health-check.interval` | `å¥åº·æ£€æŸ¥é—´éš”` | `25s` | `é…åˆç¼“å­˜æ—¶é—´ä½¿ç”¨` |
| `spring.cloud.loadbalancer.retry.enabled` | `æ˜¯å¦å¯ç”¨é‡è¯•` | `true` | `é«˜å¯ç”¨åœºæ™¯å»ºè®®å¼€å¯` |

---

## 4. ğŸ” æœåŠ¡å‘ç°ç»“åˆä½¿ç”¨


### 4.1 æœåŠ¡å‘ç°çš„ä½œç”¨


**é€šä¿—æ¯”å–»**ï¼šæœåŠ¡å‘ç°å°±åƒæ‰‹æœºé€šè®¯å½•ï¼Œä½ æƒ³æ‰“ç”µè¯ç»™"å¼ ä¸‰"ï¼Œä¸éœ€è¦è®°ä½ä»–çš„å·ç ï¼Œé€šè®¯å½•ä¼šè‡ªåŠ¨å¸®ä½ æ‰¾åˆ°ã€‚

```
å¾®æœåŠ¡åœºæ™¯ï¼š

æ²¡æœ‰æœåŠ¡å‘ç°ï¼ˆç¡¬ç¼–ç ï¼‰ï¼š
@FeignClient(name = "order-service", url = "http://192.168.1.100:8080")
é—®é¢˜ï¼šIPå˜äº†æ€ä¹ˆåŠï¼Ÿæ–°å¢å®ä¾‹æ€ä¹ˆåŠï¼Ÿ

æœ‰æœåŠ¡å‘ç°ï¼š
@FeignClient(name = "order-service")  
å¥½å¤„ï¼šè‡ªåŠ¨è·å–æ‰€æœ‰å®ä¾‹ï¼Œè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œå®ä¾‹å˜åŒ–è‡ªåŠ¨æ„ŸçŸ¥
```

### 4.2 NacosæœåŠ¡å‘ç°é›†æˆ


**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š

```yaml
spring:
  application:
    name: user-service
  cloud:
    nacos:
      discovery:
        # NacosæœåŠ¡å™¨åœ°å€
        server-addr: localhost:8848
        # å‘½åç©ºé—´ï¼ˆç”¨äºç¯å¢ƒéš”ç¦»ï¼‰
        namespace: dev
        # åˆ†ç»„ï¼ˆç”¨äºä¸šåŠ¡éš”ç¦»ï¼‰
        group: DEFAULT_GROUP
        # é›†ç¾¤åç§°
        cluster-name: BJ
        # å…ƒæ•°æ®ï¼ˆå¯ä»¥å­˜æƒé‡ç­‰ä¿¡æ¯ï¼‰
        metadata:
          version: 1.0
          weight: 100
```

**æœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹**ï¼š

```
æœåŠ¡å¯åŠ¨æµç¨‹ï¼š

1. è®¢å•æœåŠ¡å¯åŠ¨
   â†“
2. å‘Nacosæ³¨å†Œè‡ªå·±
   åç§°ï¼šorder-service
   IPï¼š192.168.1.100
   ç«¯å£ï¼š8080
   â†“
3. Nacosè®°å½•å®ä¾‹ä¿¡æ¯
   â†“
4. è®¢å•æœåŠ¡å®šæ—¶å‘å¿ƒè·³ï¼ˆé»˜è®¤5ç§’ï¼‰
   å‘Šè¯‰Nacosï¼š"æˆ‘è¿˜æ´»ç€"


æœåŠ¡è°ƒç”¨æµç¨‹ï¼š

1. ç”¨æˆ·æœåŠ¡è¦è°ƒç”¨è®¢å•æœåŠ¡
   â†“
2. OpenFeignè¯¢é—®LoadBalancer
   "order-serviceæœ‰å“ªäº›å®ä¾‹ï¼Ÿ"
   â†“
3. LoadBalanceræŸ¥è¯¢Nacos
   â†“
4. Nacosè¿”å›å®ä¾‹åˆ—è¡¨
   [192.168.1.100:8080, 192.168.1.101:8080]
   â†“
5. LoadBalanceré€‰æ‹©ä¸€ä¸ªå®ä¾‹
   â†“
6. OpenFeignå‘èµ·HTTPè°ƒç”¨
```

### 4.3 æœåŠ¡å®ä¾‹é€‰æ‹©ç­–ç•¥


**åŒé›†ç¾¤ä¼˜å…ˆç­–ç•¥**ï¼ˆç”Ÿäº§æ¨èï¼‰ï¼š

```java
/**
 * åŒé›†ç¾¤ä¼˜å…ˆè´Ÿè½½å‡è¡¡
 * åœºæ™¯ï¼šåŒ—äº¬æœºæˆ¿ä¼˜å…ˆé€‰åŒ—äº¬çš„å®ä¾‹ï¼Œå‡å°‘è·¨æœºæˆ¿è°ƒç”¨
 */
@Configuration
public class NacosLoadBalancerConfig {
    
    @Bean
    public ReactorLoadBalancer<ServiceInstance> nacosLoadBalancer(
            Environment environment,
            LoadBalancerClientFactory factory,
            NacosDiscoveryProperties nacosProperties) {
        
        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);
        
        return new NacosLoadBalancer(
            factory.getLazyProvider(name, ServiceInstanceListSupplier.class),
            name,
            nacosProperties
        );
    }
}

/**
 * Nacosè´Ÿè½½å‡è¡¡å®ç°
 */
public class NacosLoadBalancer implements ReactorServiceInstanceLoadBalancer {
    
    private final ObjectProvider<ServiceInstanceListSupplier> supplierProvider;
    private final String serviceId;
    private final NacosDiscoveryProperties nacosProperties;
    
    @Override
    public Mono<Response<ServiceInstance>> choose(Request request) {
        ServiceInstanceListSupplier supplier = supplierProvider.getIfAvailable();
        return supplier.get(request).next().map(this::selectInstance);
    }
    
    private Response<ServiceInstance> selectInstance(List<ServiceInstance> instances) {
        if (instances.isEmpty()) {
            return new EmptyResponse();
        }
        
        // 1. è·å–å½“å‰æœåŠ¡æ‰€åœ¨é›†ç¾¤
        String currentCluster = nacosProperties.getClusterName();
        
        // 2. ä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤çš„å®ä¾‹
        List<ServiceInstance> sameClusterInstances = instances.stream()
            .filter(instance -> {
                String cluster = instance.getMetadata().get("nacos.cluster");
                return currentCluster.equals(cluster);
            })
            .collect(Collectors.toList());
        
        // 3. å¦‚æœåŒé›†ç¾¤æ²¡æœ‰å®ä¾‹ï¼Œä½¿ç”¨å…¨éƒ¨å®ä¾‹
        List<ServiceInstance> targetInstances = 
            sameClusterInstances.isEmpty() ? instances : sameClusterInstances;
        
        // 4. åœ¨ç›®æ ‡å®ä¾‹ä¸­è½®è¯¢é€‰æ‹©
        int index = new Random().nextInt(targetInstances.size());
        return new DefaultResponse(targetInstances.get(index));
    }
}
```

---

## 5. âš™ï¸ è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®


### 5.1 å¸¸ç”¨ç­–ç•¥å¯¹æ¯”


**å®é™…åœºæ™¯é€‰æ‹©æŒ‡å—**ï¼š

```
åœºæ™¯1ï¼šæ‰€æœ‰å®ä¾‹æ€§èƒ½ç›¸åŒï¼Œæµé‡å‡åŒ€
æ¨èç­–ç•¥ï¼šè½®è¯¢ï¼ˆRoundRobinï¼‰
åŸå› ï¼šç®€å•é«˜æ•ˆï¼Œåˆ†é…å‡åŒ€

åœºæ™¯2ï¼šå®ä¾‹æ€§èƒ½å·®å¼‚å¤§ï¼ˆæœ‰çš„8æ ¸16Gï¼Œæœ‰çš„2æ ¸4Gï¼‰
æ¨èç­–ç•¥ï¼šæƒé‡éšæœºï¼ˆWeighted Randomï¼‰
é…ç½®ï¼šåœ¨Nacoså…ƒæ•°æ®ä¸­è®¾ç½®weight=100æˆ–weight=50

åœºæ™¯3ï¼šé•¿è¿æ¥æœåŠ¡ï¼ˆWebSocketã€gRPCï¼‰
æ¨èç­–ç•¥ï¼šæœ€å°‘å¹¶å‘ï¼ˆLeast Connectionï¼‰
åŸå› ï¼šé¿å…æŸä¸ªå®ä¾‹è¿æ¥æ•°è¿‡å¤š

åœºæ™¯4ï¼šéœ€è¦é«˜å¯ç”¨ï¼Œå®¹å¿å¶å°”å¤±è´¥
æ¨èç­–ç•¥ï¼šé‡è¯•ç­–ç•¥ï¼ˆRetryï¼‰
åŸå› ï¼šå¤±è´¥åè‡ªåŠ¨æ¢å®ä¾‹é‡è¯•
```

### 5.2 ç­–ç•¥é…ç½®æœ€ä½³å®è·µ


**é…ç½®æ–‡ä»¶æ–¹å¼ï¼ˆå…¨å±€ï¼‰**ï¼š

```yaml
spring:
  cloud:
    loadbalancer:
      # é‡è¯•é…ç½®
      retry:
        enabled: true
        # æœ€å¤§é‡è¯•æ¬¡æ•°
        max-retries-on-same-service-instance: 0
        max-retries-on-next-service-instance: 1
      # å¥åº·æ£€æŸ¥
      health-check:
        initial-delay: 10s
        interval: 25s

# é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„Ribboné…ç½®ï¼ˆå¦‚æœè¿˜åœ¨ç”¨Ribbonï¼‰
order-service:
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.AvailabilityFilteringRule
    ConnectTimeout: 2000
    ReadTimeout: 5000
```

**ä»£ç æ–¹å¼ï¼ˆç»†ç²’åº¦æ§åˆ¶ï¼‰**ï¼š

```java
/**
 * é’ˆå¯¹ä¸åŒæœåŠ¡ä½¿ç”¨ä¸åŒç­–ç•¥
 */
@Configuration
public class LoadBalancerConfiguration {
    
    /**
     * è®¢å•æœåŠ¡ï¼šä½¿ç”¨è½®è¯¢
     */
    @Configuration
    @LoadBalancerClient(name = "order-service", configuration = RoundRobinConfig.class)
    static class OrderServiceConfig {}
    
    /**
     * æ”¯ä»˜æœåŠ¡ï¼šä½¿ç”¨éšæœºï¼ˆåˆ†æ•£çƒ­ç‚¹ï¼‰
     */
    @Configuration
    @LoadBalancerClient(name = "payment-service", configuration = RandomConfig.class)
    static class PaymentServiceConfig {}
    
    /**
     * åº“å­˜æœåŠ¡ï¼šä½¿ç”¨æƒé‡ï¼ˆæœºå™¨æ€§èƒ½å·®å¼‚å¤§ï¼‰
     */
    @Configuration
    @LoadBalancerClient(name = "inventory-service", configuration = WeightedConfig.class)
    static class InventoryServiceConfig {}
}
```

### 5.3 åŠ¨æ€è°ƒæ•´ç­–ç•¥


**åŸºäºé…ç½®ä¸­å¿ƒåŠ¨æ€è°ƒæ•´**ï¼š

```java
/**
 * ç›‘å¬é…ç½®å˜åŒ–ï¼ŒåŠ¨æ€è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥
 */
@Component
@Slf4j
public class DynamicLoadBalancerConfig {
    
    @Value("${loadbalancer.rule:round-robin}")
    private String rule;
    
    @Bean
    @RefreshScope  // é…ç½®åˆ·æ–°
    public ReactorLoadBalancer<ServiceInstance> dynamicLoadBalancer(
            Environment environment,
            LoadBalancerClientFactory factory) {
        
        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);
        
        log.info("å½“å‰è´Ÿè½½å‡è¡¡ç­–ç•¥: {}", rule);
        
        // æ ¹æ®é…ç½®è¿”å›ä¸åŒç­–ç•¥
        if ("random".equalsIgnoreCase(rule)) {
            return new RandomLoadBalancer(
                factory.getLazyProvider(name, ServiceInstanceListSupplier.class),
                name
            );
        } else {
            return new RoundRobinLoadBalancer(
                factory.getLazyProvider(name, ServiceInstanceListSupplier.class),
                name
            );
        }
    }
}
```

---

## 6. ğŸ¥ å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»


### 6.1 å¥åº·æ£€æŸ¥æœºåˆ¶


**ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥**ï¼šå°±åƒå…¬å¸å®šæœŸä½“æ£€ï¼Œå®šæ—¶æ£€æŸ¥æœåŠ¡å®ä¾‹æ˜¯å¦è¿˜"å¥åº·"ï¼Œä¸å¥åº·çš„å°±ä¸ç»™å®ƒåˆ†é…è¯·æ±‚ã€‚

**Nacoså¥åº·æ£€æŸ¥**ï¼š

```yaml
spring:
  cloud:
    nacos:
      discovery:
        # å¿ƒè·³é—´éš”ï¼ˆé»˜è®¤5ç§’ï¼‰
        heart-beat-interval: 5000
        # å¿ƒè·³è¶…æ—¶ï¼ˆé»˜è®¤15ç§’ï¼‰
        heart-beat-timeout: 15000
        # IPåˆ é™¤è¶…æ—¶ï¼ˆé»˜è®¤30ç§’ï¼‰
        ip-delete-timeout: 30000
```

**å·¥ä½œæµç¨‹**ï¼š

```
æ­£å¸¸æµç¨‹ï¼š
æœåŠ¡å®ä¾‹ --[æ¯5ç§’å‘å¿ƒè·³]--> Nacos
                            Nacosæ›´æ–°æœ€åå¿ƒè·³æ—¶é—´

å¼‚å¸¸æµç¨‹ï¼š
æœåŠ¡å®ä¾‹å®•æœº
    â†“
15ç§’å†…æ²¡æ”¶åˆ°å¿ƒè·³
    â†“
Nacosæ ‡è®°å®ä¾‹ä¸º"ä¸å¥åº·"
    â†“
LoadBalancerè·å–å®ä¾‹åˆ—è¡¨æ—¶è¿‡æ»¤æ‰ä¸å¥åº·å®ä¾‹
    â†“
30ç§’åNacosåˆ é™¤è¯¥å®ä¾‹
```

### 6.2 è‡ªå®šä¹‰å¥åº·æ£€æŸ¥


**å®ç°è‡ªå®šä¹‰å¥åº·æ£€æŸ¥æ¥å£**ï¼š

```java
/**
 * è®¢å•æœåŠ¡å¥åº·æ£€æŸ¥
 * æ£€æŸ¥æ•°æ®åº“è¿æ¥ã€Redisè¿æ¥ç­‰
 */
@RestController
@Slf4j
public class HealthCheckController {
    
    @Autowired
    private DataSource dataSource;
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * Nacoså¥åº·æ£€æŸ¥æ¥å£
     * è¿”å›200è¡¨ç¤ºå¥åº·ï¼Œå…¶ä»–è¡¨ç¤ºä¸å¥åº·
     */
    @GetMapping("/actuator/health")
    public ResponseEntity<Map<String, Object>> health() {
        Map<String, Object> result = new HashMap<>();
        
        try {
            // æ£€æŸ¥æ•°æ®åº“
            dataSource.getConnection().close();
            result.put("database", "UP");
            
            // æ£€æŸ¥Redis
            redisTemplate.opsForValue().get("health-check");
            result.put("redis", "UP");
            
            result.put("status", "UP");
            return ResponseEntity.ok(result);
            
        } catch (Exception e) {
            log.error("å¥åº·æ£€æŸ¥å¤±è´¥", e);
            result.put("status", "DOWN");
            result.put("error", e.getMessage());
            return ResponseEntity.status(503).body(result);
        }
    }
}
```

**é…ç½®å¥åº·æ£€æŸ¥è·¯å¾„**ï¼š

```yaml
spring:
  cloud:
    nacos:
      discovery:
        # è‡ªå®šä¹‰å¥åº·æ£€æŸ¥è·¯å¾„
        health-check-path: /actuator/health
        # å¥åº·æ£€æŸ¥ç±»å‹ï¼šHTTPæˆ–TCP
        health-check-type: HTTP
```

### 6.3 æ•…éšœè½¬ç§»ç­–ç•¥


**é‡è¯•æœºåˆ¶é…ç½®**ï¼š

```yaml
feign:
  client:
    config:
      default:
        connectTimeout: 3000
        readTimeout: 5000
  # å¼€å¯é‡è¯•
  httpclient:
    max-connections: 200
    max-connections-per-route: 50
  compression:
    request:
      enabled: true
    response:
      enabled: true

# Spring Retryé…ç½®
spring:
  cloud:
    loadbalancer:
      retry:
        enabled: true
        # åŒä¸€å®ä¾‹é‡è¯•æ¬¡æ•°
        max-retries-on-same-service-instance: 0
        # åˆ‡æ¢å®ä¾‹é‡è¯•æ¬¡æ•°
        max-retries-on-next-service-instance: 1
        # å“ªäº›çŠ¶æ€ç é‡è¯•
        retryable-status-codes: 500,502,503
```

**è‡ªå®šä¹‰é‡è¯•é€»è¾‘**ï¼š

```java
/**
 * è‡ªå®šä¹‰é‡è¯•æ‹¦æˆªå™¨
 */
@Component
@Slf4j
public class FeignRetryInterceptor implements RequestInterceptor {
    
    @Override
    public void apply(RequestTemplate template) {
        // æ·»åŠ é‡è¯•æ ‡è¯†
        template.header("X-Retry-Count", "0");
    }
}

/**
 * é‡è¯•é…ç½®
 */
@Configuration
public class RetryConfiguration {
    
    @Bean
    public Retryer feignRetryer() {
        // æœ€å¤§é‡è¯•3æ¬¡ï¼Œåˆå§‹é—´éš”100msï¼Œæœ€å¤§é—´éš”1s
        return new Retryer.Default(100, 1000, 3);
    }
    
    /**
     * è‡ªå®šä¹‰å¼‚å¸¸é‡è¯•åˆ¤æ–­
     */
    @Bean
    public ErrorDecoder errorDecoder() {
        return (methodKey, response) -> {
            if (response.status() >= 500) {
                log.warn("æœåŠ¡ç«¯é”™è¯¯ï¼Œå‡†å¤‡é‡è¯•: {}", response.status());
                // è¿”å›RetryableExceptionä¼šè§¦å‘é‡è¯•
                return new RetryableException(
                    response.status(),
                    "æœåŠ¡å™¨é”™è¯¯",
                    response.request().httpMethod(),
                    null,
                    response.request()
                );
            }
            return FeignException.errorStatus(methodKey, response);
        };
    }
}
```

### 6.4 ç†”æ–­é™çº§é…ç½®


**æ•´åˆSentinelå®ç°ç†”æ–­**ï¼š

```xml
<!-- æ·»åŠ Sentinelä¾èµ– -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>
```

```yaml
feign:
  sentinel:
    enabled: true  # å¼€å¯Sentinelæ”¯æŒ

spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080  # Sentinelæ§åˆ¶å°åœ°å€
```

```java
/**
 * è®¢å•æœåŠ¡å®¢æˆ·ç«¯ï¼ˆå¸¦é™çº§ï¼‰
 */
@FeignClient(
    name = "order-service",
    fallback = OrderClientFallback.class  // é™çº§å¤„ç†ç±»
)
public interface OrderClient {
    @GetMapping("/orders/{id}")
    OrderDTO getOrder(@PathVariable Long id);
}

/**
 * é™çº§å¤„ç†å®ç°
 */
@Component
@Slf4j
public class OrderClientFallback implements OrderClient {
    
    @Override
    public OrderDTO getOrder(Long id) {
        log.warn("è®¢å•æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œæ‰§è¡Œé™çº§é€»è¾‘ï¼Œè®¢å•ID: {}", id);
        
        // è¿”å›é»˜è®¤æ•°æ®
        OrderDTO order = new OrderDTO();
        order.setId(id);
        order.setStatus("UNKNOWN");
        order.setMessage("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•");
        return order;
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è´Ÿè½½å‡è¡¡æœ¬è´¨ï¼šåœ¨å¤šä¸ªæœåŠ¡å®ä¾‹é—´åˆ†é…è¯·æ±‚ï¼Œæé«˜æ€§èƒ½å’Œå¯ç”¨æ€§
ğŸ”¸ å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼šåœ¨è°ƒç”¨æ–¹é€‰æ‹©æœåŠ¡å®ä¾‹ï¼Œä¸æ˜¯æœåŠ¡ç«¯
ğŸ”¸ Ribbon vs LoadBalancerï¼šè€é¡¹ç›®ç”¨Ribbonï¼Œæ–°é¡¹ç›®ç”¨LoadBalancer
ğŸ”¸ æœåŠ¡å‘ç°ï¼šè‡ªåŠ¨è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œæ— éœ€ç¡¬ç¼–ç IP
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šå®šæœŸæ£€æŸ¥å®ä¾‹å¥åº·çŠ¶æ€ï¼Œè¿‡æ»¤ä¸å¯ç”¨å®ä¾‹
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šå¤±è´¥åè‡ªåŠ¨é‡è¯•å…¶ä»–å®ä¾‹ï¼Œæé«˜æˆåŠŸç‡
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è´Ÿè½½å‡è¡¡çš„å®ç°è·¯å¾„**
```
è¯·æ±‚å‘èµ·
    â†“
OpenFeignæ‹¦æˆª
    â†“
LoadBalanceré€‰æ‹©å®ä¾‹ï¼ˆä»æœåŠ¡å‘ç°è·å–åˆ—è¡¨ï¼‰
    â†“
å‘èµ·HTTPè°ƒç”¨
    â†“
å¤±è´¥ï¼Ÿâ†’ é‡è¯•æœºåˆ¶ â†’ æ¢å®ä¾‹é‡è¯•
æˆåŠŸï¼Ÿâ†’ è¿”å›ç»“æœ
```

**ğŸ”¹ é…ç½®ä¼˜å…ˆçº§**
```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. ä»£ç é…ç½®ï¼ˆ@LoadBalancerClientæŒ‡å®šçš„é…ç½®ç±»ï¼‰
2. é…ç½®æ–‡ä»¶ä¸­é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„é…ç½®
3. é…ç½®æ–‡ä»¶ä¸­çš„å…¨å±€é…ç½®
4. é»˜è®¤é…ç½®
```

**ğŸ”¹ ç­–ç•¥é€‰æ‹©åŸåˆ™**
```
æ€§èƒ½ç›¸è¿‘ â†’ è½®è¯¢ï¼ˆç®€å•é«˜æ•ˆï¼‰
æ€§èƒ½å·®å¼‚ â†’ æƒé‡ç­–ç•¥ï¼ˆæŒ‰èƒ½åŠ›åˆ†é…ï¼‰
é•¿è¿æ¥   â†’ æœ€å°‘è¿æ¥ï¼ˆé¿å…è¿‡è½½ï¼‰
é«˜å¯ç”¨   â†’ é‡è¯•+å¥åº·æ£€æŸ¥ï¼ˆå®¹é”™èƒ½åŠ›å¼ºï¼‰
```

### 7.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**æ¨èé…ç½®ç»„åˆ**ï¼š

```yaml
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
spring:
  cloud:
    # æœåŠ¡å‘ç°
    nacos:
      discovery:
        server-addr: nacos-cluster:8848
        namespace: prod
        cluster-name: ${CLUSTER_NAME}  # ä»ç¯å¢ƒå˜é‡è¯»å–
        metadata:
          version: ${APP_VERSION}
          weight: 100
        heart-beat-interval: 5000
        heart-beat-timeout: 15000
    
    # è´Ÿè½½å‡è¡¡
    loadbalancer:
      cache:
        enabled: true
        ttl: 30s  # ç¼“å­˜30ç§’
      retry:
        enabled: true
        max-retries-on-next-service-instance: 2
      health-check:
        interval: 20s

# OpenFeigné…ç½®
feign:
  client:
    config:
      default:
        connectTimeout: 3000
        readTimeout: 10000
  httpclient:
    enabled: true
    max-connections: 200
  compression:
    request:
      enabled: true
    response:
      enabled: true
  sentinel:
    enabled: true  # ç†”æ–­é™çº§

# æ—¥å¿—çº§åˆ«
logging:
  level:
    com.your.package.feign: DEBUG  # å¼€å‘ç¯å¢ƒDEBUGï¼Œç”Ÿäº§æ”¹INFO
```

**ç›‘æ§æŒ‡æ ‡å…³æ³¨**ï¼š

| æŒ‡æ ‡ | è¯´æ˜ | å‘Šè­¦é˜ˆå€¼ |
|------|------|----------|
| `å®ä¾‹å¥åº·ç‡` | `å¥åº·å®ä¾‹/æ€»å®ä¾‹` | `< 80%å‘Šè­¦` |
| `è¯·æ±‚å¤±è´¥ç‡` | `å¤±è´¥è¯·æ±‚/æ€»è¯·æ±‚` | `> 5%å‘Šè­¦` |
| `å¹³å‡å“åº”æ—¶é—´` | `æ‰€æœ‰è¯·æ±‚çš„å¹³å‡è€—æ—¶` | `> 500mså‘Šè­¦` |
| `é‡è¯•æ¬¡æ•°` | `å‘ç”Ÿé‡è¯•çš„è¯·æ±‚æ•°` | `> 10%å‘Šè­¦` |
| `ç†”æ–­æ¬¡æ•°` | `è§¦å‘ç†”æ–­çš„æ¬¡æ•°` | `> 5æ¬¡/åˆ†é’Ÿå‘Šè­¦` |

### 7.4 å¸¸è§é—®é¢˜æ’æŸ¥


**é—®é¢˜1ï¼šè°ƒç”¨æ€»æ˜¯å¤±è´¥**
```
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ³¨å†Œåˆ°Nacos â†’ ç™»å½•Nacosæ§åˆ¶å°æŸ¥çœ‹
2. æ£€æŸ¥å®ä¾‹æ˜¯å¦å¥åº· â†’ æŸ¥çœ‹å¥åº·æ£€æŸ¥æ¥å£è¿”å›
3. æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€š â†’ pingå’Œtelnetæµ‹è¯•
4. æŸ¥çœ‹è´Ÿè½½å‡è¡¡å™¨æ—¥å¿— â†’ ç¡®è®¤é€‰æ‹©äº†å“ªä¸ªå®ä¾‹
```

**é—®é¢˜2ï¼šéƒ¨åˆ†è¯·æ±‚å¤±è´¥**
```
å¯èƒ½åŸå› ï¼š
1. æŸä¸ªå®ä¾‹æœ‰é—®é¢˜ â†’ æ£€æŸ¥è¯¥å®ä¾‹æ—¥å¿—å’Œå¥åº·æ£€æŸ¥
2. è´Ÿè½½ä¸å‡ â†’ è°ƒæ•´è´Ÿè½½å‡è¡¡ç­–ç•¥
3. ç½‘ç»œæŠ–åŠ¨ â†’ å¯ç”¨é‡è¯•æœºåˆ¶
```

**é—®é¢˜3ï¼šå“åº”æ—¶é—´ä¸ç¨³å®š**
```
ä¼˜åŒ–æ–¹å‘ï¼š
1. å¯ç”¨å®ä¾‹ç¼“å­˜ï¼Œå‡å°‘æœåŠ¡å‘ç°è°ƒç”¨
2. ä½¿ç”¨æƒé‡ç­–ç•¥ï¼Œé¿å¼€æ…¢å®ä¾‹
3. é…ç½®åˆç†è¶…æ—¶æ—¶é—´ï¼ŒåŠæ—¶å¤±è´¥å¿«é€Ÿé‡è¯•
4. å¯ç”¨è¿æ¥æ± ï¼Œå¤ç”¨HTTPè¿æ¥
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è´Ÿè½½å‡è¡¡é€‰å®ä¾‹ï¼ŒæœåŠ¡å‘ç°æ‰¾åœ°å€
- å¥åº·æ£€æŸ¥ä¿å¯ç”¨ï¼Œå¤±è´¥é‡è¯•é˜²é›ªå´©
- ç­–ç•¥é…ç½®è¦åˆç†ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘
- åŒé›†ç¾¤ä¼˜å…ˆè°ƒï¼Œè·¨æœºæˆ¿å°½é‡å°‘