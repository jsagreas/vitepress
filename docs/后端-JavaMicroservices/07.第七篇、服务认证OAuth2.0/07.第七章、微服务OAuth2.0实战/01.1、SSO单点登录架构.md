---
title: 1ã€SSOå•ç‚¹ç™»å½•æ¶æ„
---
## ğŸ“š ç›®å½•

1. [SSOå•ç‚¹ç™»å½•åŸºç¡€æ¦‚å¿µ](#1-SSOå•ç‚¹ç™»å½•åŸºç¡€æ¦‚å¿µ)
2. [SSOæ ¸å¿ƒå·¥ä½œåŸç†](#2-SSOæ ¸å¿ƒå·¥ä½œåŸç†)
3. [OAuth2.0åœ¨SSOä¸­çš„åº”ç”¨](#3-OAuth20åœ¨SSOä¸­çš„åº”ç”¨)
4. [SSOæ¶æ„è®¾è®¡ä¸å®ç°](#4-SSOæ¶æ„è®¾è®¡ä¸å®ç°)
5. [Sessionå…±äº«ä¸Tokenä¼ é€’](#5-Sessionå…±äº«ä¸Tokenä¼ é€’)
6. [è®¤è¯ä¸­å¿ƒè®¾è®¡](#6-è®¤è¯ä¸­å¿ƒè®¾è®¡)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” SSOå•ç‚¹ç™»å½•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSOå•ç‚¹ç™»å½•


**SSOï¼ˆSingle Sign-Onï¼‰**ï¼šå•ç‚¹ç™»å½•ï¼Œå°±æ˜¯**ç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±èƒ½è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„ç³»ç»Ÿ**ã€‚

**ç”Ÿæ´»ä¸­çš„ä¾‹å­ç†è§£**ï¼š
```
ä¼ ç»Ÿå¤šæ¬¡ç™»å½•ï¼ˆæ²¡æœ‰SSOï¼‰ï¼š
ä½ å»å•†åœº â†’ æ¯ä¸ªåº—é“ºéƒ½è¦ç™»è®°èº«ä»½è¯
- è¿›æœè£…åº—ï¼šå‡ºç¤ºèº«ä»½è¯ç™»è®°
- è¿›ç”µå™¨åº—ï¼šåˆè¦å‡ºç¤ºèº«ä»½è¯ç™»è®°  
- è¿›é¤å…ï¼šå†æ¬¡å‡ºç¤ºèº«ä»½è¯ç™»è®°
ğŸ˜“ å¾ˆéº»çƒ¦å¯¹å§ï¼Ÿ

SSOå•ç‚¹ç™»å½•ï¼š
ä½ å»å•†åœº â†’ åœ¨å…¥å£å¤„ç™»è®°ä¸€æ¬¡èº«ä»½è¯ï¼Œæ‹¿åˆ°ä¸€ä¸ªé€šè¡Œè¯
- è¿›æœè£…åº—ï¼šå‡ºç¤ºé€šè¡Œè¯ âœ…
- è¿›ç”µå™¨åº—ï¼šå‡ºç¤ºé€šè¡Œè¯ âœ…
- è¿›é¤å…ï¼šå‡ºç¤ºé€šè¡Œè¯ âœ…
ğŸ˜Š ä¸€æ¬¡ç™»è®°ï¼Œåˆ°å¤„é€šè¡Œï¼
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šä¸ç”¨åå¤è¾“å…¥è´¦å·å¯†ç 
- âœ… **å®‰å…¨æ€§é«˜**ï¼šå¯†ç åªåœ¨è®¤è¯ä¸­å¿ƒéªŒè¯ä¸€æ¬¡
- âœ… **ç®¡ç†æ–¹ä¾¿**ï¼šç»Ÿä¸€çš„ç”¨æˆ·ç®¡ç†å’Œæƒé™æ§åˆ¶
- âœ… **å¼€å‘ç®€åŒ–**ï¼šå„ä¸ªç³»ç»Ÿä¸ç”¨è‡ªå·±åšç™»å½•åŠŸèƒ½

### 1.2 æ²¡æœ‰SSOçš„ç—›ç‚¹


**ä¼ ç»Ÿå¤šç³»ç»Ÿç™»å½•çš„é—®é¢˜**ï¼š

```
ä¼ä¸šæœ‰å¤šä¸ªç³»ç»Ÿï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•ç³»ç»Ÿ â”‚  â”‚ åº“å­˜ç³»ç»Ÿ â”‚  â”‚ è´¢åŠ¡ç³»ç»Ÿ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“            â†“            â†“
  è¦ç™»å½•       è¦ç™»å½•       è¦ç™»å½•

ç”¨æˆ·çš„ç³Ÿç³•ä½“éªŒï¼š
1. æ‰“å¼€è®¢å•ç³»ç»Ÿ â†’ è¾“å…¥è´¦å·å¯†ç ç™»å½•
2. åˆ‡æ¢åˆ°åº“å­˜ç³»ç»Ÿ â†’ åˆè¦è¾“å…¥è´¦å·å¯†ç ç™»å½•
3. å†åˆ‡æ¢åˆ°è´¢åŠ¡ç³»ç»Ÿ â†’ å†æ¬¡è¾“å…¥è´¦å·å¯†ç ç™»å½•

é—®é¢˜ï¼š
âŒ ç”¨æˆ·è®°ä¸ä½å¤šä¸ªå¯†ç 
âŒ é¢‘ç¹ç™»å½•å½±å“å·¥ä½œæ•ˆç‡
âŒ æ¯ä¸ªç³»ç»Ÿéƒ½è¦ç»´æŠ¤ç”¨æˆ·ä¿¡æ¯
âŒ å¯†ç åˆ†æ•£å­˜å‚¨ä¸å®‰å…¨
```

### 1.3 SSOè§£å†³æ–¹æ¡ˆå¯¹æ¯”


**ä¸»æµSSOè§£å†³æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆç±»å‹ | **å·¥ä½œæ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|---------|------------|-------------|-----------|
| ğŸ”¹ **CAS** | `ä¸­å¤®è®¤è¯æœåŠ¡` | `ä¼ ç»Ÿä¼ä¸šåº”ç”¨` | `æˆç†Ÿç¨³å®šï¼Œä½†è¾ƒé‡é‡çº§` |
| ğŸ”¹ **OAuth2.0** | `æˆæƒæ¡†æ¶` | `å¼€æ”¾å¹³å°ã€ç¬¬ä¸‰æ–¹ç™»å½•` | `çµæ´»å¼ºå¤§ï¼Œæ˜¯ä¸»æµæ–¹æ¡ˆ` |
| ğŸ”¹ **SAML** | `XMLæ ¼å¼äº¤æ¢` | `å¤§å‹ä¼ä¸šã€æ”¿åºœ` | `å®‰å…¨æ€§é«˜ï¼Œé…ç½®å¤æ‚` |
| ğŸ”¹ **JWT Token** | `æ— çŠ¶æ€ä»¤ç‰Œ` | `å¾®æœåŠ¡æ¶æ„` | `è½»é‡ç®€å•ï¼Œéœ€é…åˆä½¿ç”¨` |

> **ğŸ’¡ æœ¬ç« é‡ç‚¹**ï¼šæˆ‘ä»¬ä¸»è¦å­¦ä¹ **OAuth2.0å®ç°SSO**ï¼Œå› ä¸ºå®ƒæ˜¯ç›®å‰å¾®æœåŠ¡æ¶æ„ä¸­æœ€æµè¡Œçš„æ–¹æ¡ˆã€‚

---

## 2. âš™ï¸ SSOæ ¸å¿ƒå·¥ä½œåŸç†


### 2.1 SSOåŸºæœ¬æµç¨‹


**æ ¸å¿ƒæ€æƒ³**ï¼šå»ºç«‹ä¸€ä¸ª**è®¤è¯ä¸­å¿ƒ**ï¼Œæ‰€æœ‰ç³»ç»Ÿçš„ç™»å½•éƒ½é€šè¿‡å®ƒéªŒè¯ã€‚

**æµç¨‹å›¾è§£**ï¼š
```
ç¬¬ä¸€æ¬¡è®¿é—®ç³»ç»ŸAï¼š

ç”¨æˆ·æµè§ˆå™¨          ç³»ç»ŸA(è®¢å•)        è®¤è¯ä¸­å¿ƒ
    |                  |                |
    |--è®¿é—®è®¢å•é¡µé¢---->|                |
    |                  |                |
    |                  |--æ£€æŸ¥ç™»å½•çŠ¶æ€-->|
    |                  |   (æœªç™»å½•)     |
    |                  |                |
    |<----è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒç™»å½•é¡µé¢---------|
    |                                   |
    |--------è¾“å…¥è´¦å·å¯†ç ç™»å½•----------->|
    |                                   |
    |                     (éªŒè¯æˆåŠŸ)    |
    |<-------è¿”å›è®¤è¯å‡­è¯Token----------|
    |                                   |
    |--å¸¦ç€Tokenè®¿é—®ç³»ç»ŸA--------------->|
    |                  |                |
    |                  |--éªŒè¯Token---->|
    |                  |   (æœ‰æ•ˆ)       |
    |                  |                |
    |<----è¿”å›è®¢å•é¡µé¢--|                |
    |(å·²ç™»å½•)           |                |

è®¿é—®ç³»ç»ŸBï¼š

ç”¨æˆ·æµè§ˆå™¨          ç³»ç»ŸB(åº“å­˜)        è®¤è¯ä¸­å¿ƒ
    |                  |                |
    |--è®¿é—®åº“å­˜é¡µé¢---->|                |
    |                  |                |
    |                  |--æ£€æŸ¥Token---->|
    |                  |   (å·²æœ‰æ•ˆ)     |
    |                  |                |
    |<----ç›´æ¥è¿”å›åº“å­˜é¡µé¢-(æ— éœ€ç™»å½•)---|
    |(è‡ªåŠ¨ç™»å½•)         |                |
```

**å…³é”®ç‚¹ç†è§£**ï¼š
1. **ç¬¬ä¸€æ¬¡è®¿é—®**ï¼šç”¨æˆ·åœ¨è®¤è¯ä¸­å¿ƒç™»å½•ï¼Œè·å¾—Token
2. **åç»­è®¿é—®**ï¼šç›´æ¥ç”¨Tokenè®¿é—®å…¶ä»–ç³»ç»Ÿï¼Œæ— éœ€å†ç™»å½•
3. **TokenéªŒè¯**ï¼šå„ç³»ç»Ÿå‘è®¤è¯ä¸­å¿ƒéªŒè¯Tokenæœ‰æ•ˆæ€§

### 2.2 ç»Ÿä¸€è®¤è¯ä¸­å¿ƒçš„ä½œç”¨


**è®¤è¯ä¸­å¿ƒï¼ˆAuthentication Centerï¼‰** å°±åƒä¸€ä¸ª"èº«ä»½è¯åŠç†ä¸­å¿ƒ"ï¼š

```
è®¤è¯ä¸­å¿ƒçš„èŒè´£ï¼š

1ï¸âƒ£ ç”¨æˆ·ç™»å½•éªŒè¯
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  è¾“å…¥è´¦å·å¯†ç      â”‚
   â”‚      â†“          â”‚
   â”‚  éªŒè¯æ˜¯å¦æ­£ç¡®    â”‚ â† è®¤è¯ä¸­å¿ƒ
   â”‚      â†“          â”‚
   â”‚  é¢å‘Tokenå‡­è¯   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2ï¸âƒ£ Tokenç®¡ç†
   - ç”ŸæˆTokenï¼ˆåƒåŠç†èº«ä»½è¯ï¼‰
   - éªŒè¯Tokenï¼ˆåƒæŸ¥éªŒèº«ä»½è¯çœŸå‡ï¼‰
   - åˆ·æ–°Tokenï¼ˆåƒèº«ä»½è¯ç»­æœŸï¼‰
   - æ’¤é”€Tokenï¼ˆåƒèº«ä»½è¯æŒ‚å¤±ï¼‰

3ï¸âƒ£ ç”¨æˆ·ä¿¡æ¯ç®¡ç†
   - å­˜å‚¨ç”¨æˆ·è´¦å·å¯†ç 
   - ç®¡ç†ç”¨æˆ·æƒé™
   - è®°å½•ç™»å½•æ—¥å¿—
```

**ä¸ºä»€ä¹ˆéœ€è¦è®¤è¯ä¸­å¿ƒ**ï¼š
- âœ… **å¯†ç é›†ä¸­ç®¡ç†**ï¼šå¯†ç åªå­˜åœ¨è®¤è¯ä¸­å¿ƒï¼Œæ›´å®‰å…¨
- âœ… **ç»Ÿä¸€ç™»å½•å…¥å£**ï¼šæ‰€æœ‰ç³»ç»Ÿå…±ç”¨ä¸€ä¸ªç™»å½•é¡µé¢
- âœ… **ä¾¿äºæƒé™æ§åˆ¶**ï¼šåœ¨è®¤è¯ä¸­å¿ƒç»Ÿä¸€åˆ†é…æƒé™
- âœ… **ç®€åŒ–ç³»ç»Ÿå¼€å‘**ï¼šå„ä¸šåŠ¡ç³»ç»Ÿä¸ç”¨å…³å¿ƒç™»å½•é€»è¾‘

---

## 3. ğŸ”‘ OAuth2.0åœ¨SSOä¸­çš„åº”ç”¨


### 3.1 OAuth2.0æ˜¯ä»€ä¹ˆ


**OAuth2.0**ï¼šä¸€ä¸ª**æˆæƒæ¡†æ¶**ï¼Œç”¨äºè®©åº”ç”¨å®‰å…¨åœ°è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€çŸ¥é“ç”¨æˆ·å¯†ç ã€‚

**é€šä¿—ç†è§£**ï¼š
```
ç”Ÿæ´»ä¾‹å­ - ä½ è®©æœ‹å‹å¸®ä½ å–å¿«é€’ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸å®‰å…¨ï¼‰ï¼š
ä½ æŠŠå®¶é—¨é’¥åŒ™ç»™æœ‹å‹ â†’ æœ‹å‹è¿›ä½ å®¶å–å¿«é€’
âŒ é—®é¢˜ï¼šæœ‹å‹æœ‰äº†é’¥åŒ™ï¼Œå¯ä»¥éšæ—¶è¿›ä½ å®¶

OAuth2.0æ–¹å¼ï¼ˆå®‰å…¨ï¼‰ï¼š
ä½ ç»™å¿«é€’å‘˜ä¸€ä¸ªä¸´æ—¶é—¨ç¦å¡ â†’ å¡åªèƒ½å¼€å¿«é€’æŸœ
âœ… å¥½å¤„ï¼š
   - ä¸ç”¨ç»™å®¶é—¨é’¥åŒ™
   - å¡åªèƒ½å¼€å¿«é€’æŸœï¼Œä¸èƒ½è¿›æˆ¿é—´
   - å¡å¯ä»¥è®¾ç½®æœ‰æ•ˆæœŸ
   - ä½ å¯ä»¥éšæ—¶å–æ¶ˆå¡çš„æƒé™
```

**OAuth2.0æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **Resource Ownerï¼ˆèµ„æºæ‹¥æœ‰è€…ï¼‰**ï¼šç”¨æˆ·æœ¬äºº
- **Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šè¦è®¿é—®ç”¨æˆ·ä¿¡æ¯çš„åº”ç”¨
- **Authorization Serverï¼ˆæˆæƒæœåŠ¡å™¨ï¼‰**ï¼šè®¤è¯ä¸­å¿ƒ
- **Resource Serverï¼ˆèµ„æºæœåŠ¡å™¨ï¼‰**ï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æœåŠ¡å™¨

### 3.2 OAuth2.0æˆæƒç æ¨¡å¼


**æˆæƒç æ¨¡å¼ï¼ˆAuthorization Codeï¼‰**ï¼šæœ€å®‰å…¨ã€æœ€å¸¸ç”¨çš„OAuth2.0æµç¨‹ã€‚

**å®Œæ•´æµç¨‹å›¾è§£**ï¼š
```
ç”¨æˆ·        å®¢æˆ·ç«¯åº”ç”¨     è®¤è¯ä¸­å¿ƒ      èµ„æºæœåŠ¡å™¨
 |             |            |              |
 |--è®¿é—®åº”ç”¨-â†’ |            |              |
 |             |            |              |
 |             |--è¯·æ±‚æˆæƒâ†’ |              |
 |             |            |              |
 |             |â†-è·³è½¬ç™»å½•é¡µ-|              |
 |â†-æ˜¾ç¤ºç™»å½•é¡µ-|            |              |
 |             |            |              |
 |--è¾“å…¥è´¦å·å¯†ç ----------â†’ |              |
 |             |            |              |
 |             |            | (éªŒè¯é€šè¿‡)   |
 |             |            |              |
 |â†-è¿”å›æˆæƒç (code)--------|              |
 |             |            |              |
 |--codeä¼ ç»™åº”ç”¨----------â†’ |              |
 |             |            |              |
 |             |--ç”¨codeæ¢Token--------â†’   |
 |             |            |              |
 |             |â†-è¿”å›Access Token---------|
 |             |            |              |
 |             |--ç”¨Tokenè¯·æ±‚ç”¨æˆ·ä¿¡æ¯---â†’  |
 |             |            |              |
 |             |â†-è¿”å›ç”¨æˆ·ä¿¡æ¯-------------|
 |             |            |              |
 |â†-ç™»å½•æˆåŠŸ---|            |              |
```

**å…³é”®æ­¥éª¤è¯¦è§£**ï¼š

**æ­¥éª¤1-3ï¼šè·å–æˆæƒç **
```java
// ç”¨æˆ·ç‚¹å‡»ç™»å½•ï¼Œåº”ç”¨è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ
String authUrl = "https://auth.example.com/oauth/authorize?" +
    "client_id=YOUR_CLIENT_ID" +           // åº”ç”¨ID
    "&response_type=code" +                // è¦æ±‚è¿”å›æˆæƒç 
    "&redirect_uri=http://app.com/callback" + // å›è°ƒåœ°å€
    "&scope=read_user";                    // è¯·æ±‚çš„æƒé™

// ç”¨æˆ·ç™»å½•åï¼Œè®¤è¯ä¸­å¿ƒè¿”å›æˆæƒç 
// å›è°ƒ: http://app.com/callback?code=AUTH_CODE_123
```

**æ­¥éª¤4-5ï¼šç”¨æˆæƒç æ¢Token**
```java
// åº”ç”¨åå°ç”¨æˆæƒç æ¢å–Token
String tokenUrl = "https://auth.example.com/oauth/token";
Map<String, String> params = Map.of(
    "grant_type", "authorization_code",
    "code", "AUTH_CODE_123",              // åˆšè·å¾—çš„æˆæƒç 
    "client_id", "YOUR_CLIENT_ID",
    "client_secret", "YOUR_CLIENT_SECRET", // åº”ç”¨å¯†é’¥
    "redirect_uri", "http://app.com/callback"
);

// è¿”å›ï¼š
{
  "access_token": "eyJhbGc...",     // è®¿é—®ä»¤ç‰Œ
  "token_type": "Bearer",
  "expires_in": 3600,               // æœ‰æ•ˆæœŸ1å°æ—¶
  "refresh_token": "tGzv3J..."      // åˆ·æ–°ä»¤ç‰Œ
}
```

**æ­¥éª¤6-7ï¼šä½¿ç”¨Tokenè®¿é—®èµ„æº**
```java
// ç”¨Tokenè·å–ç”¨æˆ·ä¿¡æ¯
HttpHeaders headers = new HttpHeaders();
headers.set("Authorization", "Bearer eyJhbGc...");

// è¯·æ±‚ç”¨æˆ·ä¿¡æ¯
String userInfo = restTemplate.exchange(
    "https://api.example.com/user/info",
    HttpMethod.GET,
    new HttpEntity<>(headers),
    String.class
).getBody();

// è¿”å›ï¼š
{
  "id": "12345",
  "username": "zhangsan",
  "email": "zhangsan@example.com"
}
```

### 3.3 ä¸ºä»€ä¹ˆç”¨æˆæƒç è€Œä¸ç›´æ¥ç»™Token


**å®‰å…¨æ€§è€ƒè™‘**ï¼š

```
âŒ ä¸å®‰å…¨çš„åšæ³•ï¼ˆç›´æ¥è¿”å›Tokenï¼‰ï¼š
è®¤è¯ä¸­å¿ƒ --Token--> æµè§ˆå™¨ --Token--> åº”ç”¨åå°
           â†‘ æš´éœ²åœ¨æµè§ˆå™¨åœ°å€æ ï¼Œå¯èƒ½è¢«åŠ«æŒ

âœ… å®‰å…¨çš„åšæ³•ï¼ˆæˆæƒç æ¢Tokenï¼‰ï¼š
è®¤è¯ä¸­å¿ƒ --æˆæƒç --> æµè§ˆå™¨ --æˆæƒç --> åº”ç”¨åå°
                                        â†“
        åº”ç”¨åå° --æˆæƒç +å¯†é’¥--> è®¤è¯ä¸­å¿ƒ
                     â†“
              è·å¾—Tokenï¼ˆåœ¨åå°å®‰å…¨äº¤æ¢ï¼‰

å¥½å¤„ï¼š
1. Tokenä¸ç»è¿‡æµè§ˆå™¨ï¼Œä¸ä¼šæš´éœ²
2. éœ€è¦client_secretæ‰èƒ½æ¢Tokenï¼Œæ›´å®‰å…¨
3. æˆæƒç åªèƒ½ç”¨ä¸€æ¬¡ï¼Œç”¨å®Œå°±å¤±æ•ˆ
```

---

## 4. ğŸ—ï¸ SSOæ¶æ„è®¾è®¡ä¸å®ç°


### 4.1 æ•´ä½“æ¶æ„è®¾è®¡


**SSOç³»ç»Ÿæ¶æ„**ï¼š

```
                    äº’è”ç½‘
                      |
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Nginxç½‘å…³     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        |             |             |
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚è®¢å•ç³»ç»Ÿ  â”‚   â”‚åº“å­˜ç³»ç»Ÿâ”‚   â”‚ç”¨æˆ·ç³»ç»Ÿâ”‚
   â”‚(å®¢æˆ·ç«¯)  â”‚   â”‚(å®¢æˆ·ç«¯)â”‚   â”‚(å®¢æˆ·ç«¯)â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        |            |            |
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  |
           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
           â”‚ è®¤è¯ä¸­å¿ƒ     â”‚
           â”‚(æˆæƒæœåŠ¡å™¨)  â”‚
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  |
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         |                 |
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ç”¨æˆ·æ•°æ®åº“â”‚      â”‚Redisç¼“å­˜â”‚
    â”‚         â”‚      â”‚(Token)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„ç»„ä»¶èŒè´£**ï¼š

- **è®¤è¯ä¸­å¿ƒ**ï¼šè´Ÿè´£ç”¨æˆ·ç™»å½•ã€Tokené¢å‘
- **è®¢å•/åº“å­˜/ç”¨æˆ·ç³»ç»Ÿ**ï¼šä¸šåŠ¡ç³»ç»Ÿï¼Œä¾èµ–è®¤è¯ä¸­å¿ƒéªŒè¯ç”¨æˆ·
- **Redisç¼“å­˜**ï¼šå­˜å‚¨Tokenï¼Œæ”¯æŒå¿«é€ŸéªŒè¯
- **ç”¨æˆ·æ•°æ®åº“**ï¼šå­˜å‚¨ç”¨æˆ·è´¦å·ä¿¡æ¯

### 4.2 Spring Security OAuth2å®ç°


**å¼•å…¥ä¾èµ–**ï¼š
```xml
<!-- Spring Security OAuth2 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-oauth2-authorization-server</artifactId>
</dependency>
```

**è®¤è¯ä¸­å¿ƒé…ç½®**ï¼š
```java
@Configuration
public class AuthorizationServerConfig {
    
    @Bean
    public SecurityFilterChain authorizationServerSecurityFilterChain(
            HttpSecurity http) throws Exception {
        
        // é…ç½®OAuth2æˆæƒæœåŠ¡å™¨
        OAuth2AuthorizationServerConfiguration
            .applyDefaultSecurity(http);
        
        return http
            .formLogin(Customizer.withDefaults()) // æ”¯æŒè¡¨å•ç™»å½•
            .build();
    }
    
    @Bean
    public RegisteredClientRepository registeredClientRepository() {
        // æ³¨å†Œå®¢æˆ·ç«¯åº”ç”¨
        RegisteredClient orderClient = RegisteredClient
            .withId(UUID.randomUUID().toString())
            .clientId("order-service")           // å®¢æˆ·ç«¯ID
            .clientSecret("{noop}secret")        // å®¢æˆ·ç«¯å¯†é’¥
            .clientAuthenticationMethod(
                ClientAuthenticationMethod.CLIENT_SECRET_BASIC)
            .authorizationGrantType(
                AuthorizationGrantType.AUTHORIZATION_CODE) // æˆæƒç æ¨¡å¼
            .authorizationGrantType(
                AuthorizationGrantType.REFRESH_TOKEN)      // åˆ·æ–°ä»¤ç‰Œ
            .redirectUri("http://localhost:8081/callback") // å›è°ƒåœ°å€
            .scope("read")                       // æƒé™èŒƒå›´
            .scope("write")
            .build();
        
        return new InMemoryRegisteredClientRepository(orderClient);
    }
}
```

**ä¸šåŠ¡ç³»ç»Ÿé…ç½®ï¼ˆè®¢å•ç³»ç»Ÿï¼‰**ï¼š
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) 
            throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll()
                .anyRequest().authenticated()
            )
            .oauth2Login(oauth2 -> oauth2
                .userInfoEndpoint(userInfo -> userInfo
                    .userService(customOAuth2UserService())
                )
            );
        
        return http.build();
    }
    
    @Bean
    public OAuth2UserService<OAuth2UserRequest, OAuth2User> 
            customOAuth2UserService() {
        return new DefaultOAuth2UserService();
    }
}

// application.ymlé…ç½®
spring:
  security:
    oauth2:
      client:
        registration:
          auth-server:
            client-id: order-service
            client-secret: secret
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/callback"
            scope: read,write
        provider:
          auth-server:
            authorization-uri: http://localhost:9000/oauth2/authorize
            token-uri: http://localhost:9000/oauth2/token
            user-info-uri: http://localhost:9000/userinfo
```

### 4.3 ç™»å½•æµç¨‹ä»£ç å®ç°


**ç”¨æˆ·è®¿é—®å—ä¿æŠ¤èµ„æº**ï¼š
```java
@RestController
public class OrderController {
    
    @GetMapping("/order/list")
    public ResponseEntity<?> getOrders(
            @AuthenticationPrincipal OAuth2User user) {
        
        // è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
        String username = user.getAttribute("name");
        String email = user.getAttribute("email");
        
        // æŸ¥è¯¢è¯¥ç”¨æˆ·çš„è®¢å•
        List<Order> orders = orderService.findByUser(username);
        
        return ResponseEntity.ok(orders);
    }
}
```

**æµç¨‹è¯´æ˜**ï¼š
1. ç”¨æˆ·è®¿é—®`/order/list`
2. å‘ç°æœªç™»å½•ï¼Œè‡ªåŠ¨è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ
3. ç”¨æˆ·åœ¨è®¤è¯ä¸­å¿ƒç™»å½•
4. è®¤è¯ä¸­å¿ƒè¿”å›æˆæƒç 
5. åº”ç”¨ç”¨æˆæƒç æ¢Token
6. åº”ç”¨ç”¨Tokenè·å–ç”¨æˆ·ä¿¡æ¯
7. è¿”å›è®¢å•åˆ—è¡¨

---

## 5. ğŸ”„ Sessionå…±äº«ä¸Tokenä¼ é€’


### 5.1 Sessionå…±äº«é—®é¢˜


**ä¼ ç»ŸSessionçš„é—®é¢˜**ï¼š

```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·åœ¨è®¢å•ç³»ç»Ÿç™»å½• â†’ Sessionå­˜åœ¨è®¢å•ç³»ç»ŸæœåŠ¡å™¨
ç”¨æˆ·è®¿é—®åº“å­˜ç³»ç»Ÿ â†’ åº“å­˜ç³»ç»Ÿæ²¡æœ‰Session â†’ è¦é‡æ–°ç™»å½•

åŸå› ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¢å•ç³»ç»Ÿ   â”‚         â”‚åº“å­˜ç³»ç»Ÿ   â”‚
â”‚Server A  â”‚         â”‚Server B  â”‚
â”‚          â”‚         â”‚          â”‚
â”‚Session:  â”‚         â”‚Session:  â”‚
â”‚{         â”‚         â”‚{         â”‚
â”‚ user:"å¼ ä¸‰"â”‚    â‰    â”‚ (ç©º)     â”‚
â”‚}         â”‚         â”‚}         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sessionå­˜åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œæ— æ³•å…±äº«ï¼
```

**è§£å†³æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-----|---------|---------|---------|
| ğŸ”¹ **Sessionå¤åˆ¶** | `å„æœåŠ¡å™¨äº’ç›¸åŒæ­¥Session` | `å®ç°ç®€å•` | `æ€§èƒ½å·®ï¼Œä¸é€‚åˆå¤§è§„æ¨¡` |
| ğŸ”¹ **Sessionç²˜æ»** | `è´Ÿè½½å‡è¡¡ç»‘å®šç”¨æˆ·åˆ°å›ºå®šæœåŠ¡å™¨` | `é…ç½®ç®€å•` | `æœåŠ¡å™¨å®•æœºSessionä¸¢å¤±` |
| ğŸ”¹ **Sessioné›†ä¸­å­˜å‚¨** | `Sessionå­˜Redisç­‰å…±äº«å­˜å‚¨` | `é«˜å¯ç”¨ï¼Œæ”¯æŒå¤§è§„æ¨¡` | `éœ€è¦é¢å¤–çš„Redis` |
| ğŸ”¹ **Tokenæ–¹å¼** | `ä¸ç”¨Sessionï¼Œç”¨TokenéªŒè¯` | `æ— çŠ¶æ€ï¼Œæ˜“æ‰©å±•` | `Tokenéœ€è¦åŠ å¯†é˜²ä¼ªé€ ` |

> **ğŸ’¡ æ¨èæ–¹æ¡ˆ**ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ**ä½¿ç”¨Tokenæ–¹å¼**ï¼Œå®Œå…¨ä¸ç”¨Sessionã€‚

### 5.2 Tokenä¼ é€’æœºåˆ¶


**Tokenåœ¨è¯·æ±‚ä¸­çš„ä¼ é€’**ï¼š

```
æ–¹å¼1ï¼šHTTP Headerä¼ é€’ï¼ˆæ¨èï¼‰
GET /api/orders HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
             â†‘        â†‘
           å›ºå®šå‰ç¼€   Tokenå†…å®¹

æ–¹å¼2ï¼šURLå‚æ•°ä¼ é€’ï¼ˆä¸æ¨èï¼Œä¸å®‰å…¨ï¼‰
GET /api/orders?access_token=eyJhbGc... HTTP/1.1

æ–¹å¼3ï¼šCookieä¼ é€’ï¼ˆéƒ¨åˆ†åœºæ™¯ï¼‰
GET /api/orders HTTP/1.1
Cookie: access_token=eyJhbGc...
```

**è·¨ç³»ç»ŸTokenä¼ é€’æµç¨‹**ï¼š
```
ç”¨æˆ·æµè§ˆå™¨                è®¢å•ç³»ç»Ÿ              åº“å­˜ç³»ç»Ÿ
    |                       |                    |
    |--è¯·æ±‚è®¢å•(å¸¦Token)--->|                    |
    |   Header: Bearer xxx  |                    |
    |                       |                    |
    |                       |--éªŒè¯TokenæˆåŠŸ--   |
    |                       |                    |
    |                       |--è¯·æ±‚åº“å­˜(å¸¦Token)->|
    |                       |   Header: Bearer xxx
    |                       |                    |
    |                       |                    |--éªŒè¯TokenæˆåŠŸ
    |                       |                    |
    |                       |<--è¿”å›åº“å­˜ä¿¡æ¯-----|
    |                       |                    |
    |<--è¿”å›è®¢å•ä¿¡æ¯--------|                    |

å…³é”®ï¼šåŒä¸€ä¸ªTokenåœ¨å¤šä¸ªç³»ç»Ÿé—´ä¼ é€’ï¼Œæ— éœ€Session
```

### 5.3 TokenéªŒè¯å®ç°


**ç½‘å…³ç»Ÿä¸€éªŒè¯Token**ï¼š
```java
@Component
public class AuthenticationFilter implements GlobalFilter {
    
    @Autowired
    private TokenValidator tokenValidator;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, 
                             GatewayFilterChain chain) {
        
        // 1. ä»Headerä¸­è·å–Token
        String token = exchange.getRequest()
            .getHeaders()
            .getFirst("Authorization");
        
        if (token == null || !token.startsWith("Bearer ")) {
            // æ²¡æœ‰Tokenï¼Œè¿”å›401
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
        
        token = token.substring(7); // å»æ‰"Bearer "
        
        // 2. éªŒè¯Tokenæœ‰æ•ˆæ€§
        try {
            Claims claims = tokenValidator.validateToken(token);
            
            // 3. å°†ç”¨æˆ·ä¿¡æ¯æ”¾å…¥è¯·æ±‚å¤´ï¼Œä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡
            ServerHttpRequest request = exchange.getRequest()
                .mutate()
                .header("X-User-Id", claims.get("userId").toString())
                .header("X-Username", claims.get("username").toString())
                .build();
            
            return chain.filter(
                exchange.mutate().request(request).build()
            );
            
        } catch (Exception e) {
            // Tokenæ— æ•ˆ
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
    }
}
```

**ä¸‹æ¸¸æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯**ï¼š
```java
@RestController
public class OrderController {
    
    @GetMapping("/order/list")
    public List<Order> getOrders(
            @RequestHeader("X-User-Id") String userId,
            @RequestHeader("X-Username") String username) {
        
        // ç›´æ¥ä»Headerè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€æŸ¥è¯¢
        return orderService.findByUserId(userId);
    }
}
```

---

## 6. ğŸ›ï¸ è®¤è¯ä¸­å¿ƒè®¾è®¡


### 6.1 è®¤è¯ä¸­å¿ƒæ ¸å¿ƒåŠŸèƒ½


**è®¤è¯ä¸­å¿ƒçš„èŒè´£**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        è®¤è¯ä¸­å¿ƒ                  â”‚
â”‚                                 â”‚
â”‚  1ï¸âƒ£ ç”¨æˆ·è®¤è¯                     â”‚
â”‚     â”œâ”€ è´¦å·å¯†ç éªŒè¯              â”‚
â”‚     â”œâ”€ ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€QQï¼‰     â”‚
â”‚     â””â”€ å¤šå› ç´ è®¤è¯ï¼ˆçŸ­ä¿¡éªŒè¯ç ï¼‰   â”‚
â”‚                                 â”‚
â”‚  2ï¸âƒ£ Tokenç®¡ç†                    â”‚
â”‚     â”œâ”€ ç”ŸæˆAccess Token         â”‚
â”‚     â”œâ”€ ç”ŸæˆRefresh Token        â”‚
â”‚     â”œâ”€ TokenéªŒè¯                â”‚
â”‚     â””â”€ Tokenåˆ·æ–°                â”‚
â”‚                                 â”‚
â”‚  3ï¸âƒ£ å®¢æˆ·ç«¯ç®¡ç†                   â”‚
â”‚     â”œâ”€ æ³¨å†Œå®¢æˆ·ç«¯åº”ç”¨            â”‚
â”‚     â”œâ”€ ç®¡ç†å®¢æˆ·ç«¯æƒé™            â”‚
â”‚     â””â”€ å®¢æˆ·ç«¯å¯†é’¥ç®¡ç†            â”‚
â”‚                                 â”‚
â”‚  4ï¸âƒ£ ç”¨æˆ·æƒé™ç®¡ç†                 â”‚
â”‚     â”œâ”€ è§’è‰²ç®¡ç†                 â”‚
â”‚     â”œâ”€ æƒé™åˆ†é…                 â”‚
â”‚     â””â”€ æƒé™éªŒè¯                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Tokenç”Ÿæˆä¸éªŒè¯


**JWT Tokenç»“æ„**ï¼š
```
JWT = Header.Payload.Signature

Headerï¼ˆå¤´éƒ¨ï¼‰ï¼š
{
  "alg": "RS256",         // åŠ å¯†ç®—æ³•
  "typ": "JWT"            // ç±»å‹
}

Payloadï¼ˆè½½è·ï¼‰ï¼š
{
  "sub": "12345",         // ç”¨æˆ·ID
  "name": "å¼ ä¸‰",         // ç”¨æˆ·å
  "iat": 1516239022,      // ç­¾å‘æ—¶é—´
  "exp": 1516242622,      // è¿‡æœŸæ—¶é—´
  "scope": "read write"   // æƒé™èŒƒå›´
}

Signatureï¼ˆç­¾åï¼‰ï¼š
RSASHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  privateKey
)
```

**Tokenç”Ÿæˆå®ç°**ï¼š
```java
@Service
public class TokenService {
    
    @Value("${jwt.private-key}")
    private String privateKeyPath;
    
    @Value("${jwt.expiration}")
    private long expirationTime;
    
    public String generateToken(UserDetails user) {
        
        Date now = new Date();
        Date expiryDate = new Date(now.getTime() + expirationTime);
        
        return Jwts.builder()
            .setSubject(user.getUserId())                    // ç”¨æˆ·ID
            .claim("username", user.getUsername())           // ç”¨æˆ·å
            .claim("authorities", user.getAuthorities())     // æƒé™
            .setIssuedAt(now)                               // ç­¾å‘æ—¶é—´
            .setExpiration(expiryDate)                      // è¿‡æœŸæ—¶é—´
            .signWith(getPrivateKey(), SignatureAlgorithm.RS256) // ç­¾å
            .compact();
    }
    
    private PrivateKey getPrivateKey() {
        // è¯»å–ç§é’¥æ–‡ä»¶
        // ...
    }
}
```

**TokenéªŒè¯å®ç°**ï¼š
```java
@Service
public class TokenValidator {
    
    @Value("${jwt.public-key}")
    private String publicKeyPath;
    
    public Claims validateToken(String token) {
        try {
            return Jwts.parserBuilder()
                .setSigningKey(getPublicKey())    // ç”¨å…¬é’¥éªŒè¯ç­¾å
                .build()
                .parseClaimsJws(token)
                .getBody();
                
        } catch (ExpiredJwtException e) {
            throw new TokenExpiredException("Tokenå·²è¿‡æœŸ");
        } catch (JwtException e) {
            throw new InvalidTokenException("æ— æ•ˆçš„Token");
        }
    }
    
    private PublicKey getPublicKey() {
        // è¯»å–å…¬é’¥æ–‡ä»¶
        // ...
    }
}
```

### 6.3 Tokenåˆ·æ–°æœºåˆ¶


**ä¸ºä»€ä¹ˆéœ€è¦Refresh Token**ï¼š

```
é—®é¢˜ï¼šAccess Tokenè¿‡æœŸæ—¶é—´çŸ­ï¼ˆå¦‚1å°æ—¶ï¼‰
     â†’ ç”¨æˆ·é¢‘ç¹éœ€è¦é‡æ–°ç™»å½• â†’ ä½“éªŒå·®

è§£å†³ï¼šåŒTokenæœºåˆ¶
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Access Token   â”‚  æœ‰æ•ˆæœŸçŸ­(1å°æ—¶)
     â”‚  ç”¨äºè®¿é—®èµ„æº    â”‚  å­˜æ”¾ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Refresh Token  â”‚  æœ‰æ•ˆæœŸé•¿(7å¤©)
     â”‚  ç”¨äºåˆ·æ–°Token   â”‚  åªç”¨äºè·å–æ–°Token
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ·æ–°æµç¨‹**ï¼š
```
å®¢æˆ·ç«¯              è®¤è¯ä¸­å¿ƒ
  |                   |
  |--Access Tokenè¿‡æœŸ->|
  |   (ç»§ç»­è®¿é—®èµ„æº)   |
  |                   |
  |<--è¿”å›401---------|
  |                   |
  |--å‘é€Refresh Token->|
  |                   |
  |                   |--éªŒè¯Refresh Token
  |                   |
  |<--è¿”å›æ–°çš„Token---|
  |  {               |
  |    access_token  |
  |    refresh_token |
  |  }               |
  |                   |
  |--ç”¨æ–°Tokenè®¿é—®--->|
  |                   |
  |<--è¿”å›æ•°æ®--------|
```

**åˆ·æ–°Tokenå®ç°**ï¼š
```java
@RestController
@RequestMapping("/oauth2")
public class TokenController {
    
    @Autowired
    private TokenService tokenService;
    
    @PostMapping("/refresh")
    public ResponseEntity<?> refreshToken(
            @RequestBody RefreshTokenRequest request) {
        
        String refreshToken = request.getRefreshToken();
        
        try {
            // éªŒè¯Refresh Token
            Claims claims = tokenService.validateRefreshToken(refreshToken);
            
            // ç”Ÿæˆæ–°çš„Access Token
            String newAccessToken = tokenService.generateAccessToken(claims);
            
            // å¯é€‰ï¼šç”Ÿæˆæ–°çš„Refresh Token
            String newRefreshToken = tokenService.generateRefreshToken(claims);
            
            return ResponseEntity.ok(Map.of(
                "access_token", newAccessToken,
                "refresh_token", newRefreshToken,
                "expires_in", 3600
            ));
            
        } catch (Exception e) {
            return ResponseEntity
                .status(HttpStatus.UNAUTHORIZED)
                .body("Invalid refresh token");
        }
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SSOå•ç‚¹ç™»å½•ï¼šä¸€æ¬¡ç™»å½•ï¼Œå…¨å±€è®¿é—®
ğŸ”¸ è®¤è¯ä¸­å¿ƒï¼šç»Ÿä¸€çš„èº«ä»½éªŒè¯å’ŒTokené¢å‘ä¸­å¿ƒ
ğŸ”¸ OAuth2.0ï¼šæˆæƒæ¡†æ¶ï¼Œå®‰å…¨è·å–ç”¨æˆ·ä¿¡æ¯
ğŸ”¸ æˆæƒç æ¨¡å¼ï¼šæœ€å®‰å…¨çš„OAuth2.0æµç¨‹
ğŸ”¸ Tokenä¼ é€’ï¼šé€šè¿‡HTTP Headeråœ¨ç³»ç»Ÿé—´ä¼ é€’èº«ä»½ä¿¡æ¯
ğŸ”¸ JWT Tokenï¼šè‡ªåŒ…å«çš„ç”¨æˆ·ä¿¡æ¯ä»¤ç‰Œ
ğŸ”¸ Refresh Tokenï¼šç”¨äºåˆ·æ–°è¿‡æœŸTokençš„é•¿æœŸå‡­è¯
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ SSO vs ä¼ ç»Ÿç™»å½•**
```
ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªç³»ç»Ÿç‹¬ç«‹ç™»å½•ï¼Œä½“éªŒå·®
SSOæ–¹å¼ï¼šè®¤è¯ä¸­å¿ƒç»Ÿä¸€ç™»å½•ï¼Œä¸€æ¬¡ç™»å½•å…¨å±€è®¿é—®

æ ¸å¿ƒï¼šå»ºç«‹è®¤è¯ä¸­å¿ƒï¼Œæ‰€æœ‰ç³»ç»Ÿä¿¡ä»»è®¤è¯ä¸­å¿ƒé¢å‘çš„Token
```

**ğŸ”¹ ä¸ºä»€ä¹ˆç”¨æˆæƒç æ¨¡å¼**
```
å®‰å…¨æ€§ï¼š
1. Tokenä¸ç»è¿‡æµè§ˆå™¨ï¼Œé¿å…æ³„éœ²
2. éœ€è¦client_secretæ‰èƒ½æ¢Token
3. æˆæƒç åªèƒ½ç”¨ä¸€æ¬¡

æµç¨‹ï¼š
ç”¨æˆ·ç™»å½• â†’ è·å¾—æˆæƒç  â†’ åº”ç”¨ç”¨æˆæƒç +å¯†é’¥æ¢Token â†’ è®¿é—®èµ„æº
```

**ğŸ”¹ Session vs Token**
```
Sessionæ–¹å¼ï¼ˆä¼ ç»Ÿï¼‰ï¼š
- æœåŠ¡å™¨å­˜å‚¨Session
- æ— æ³•è·¨æœåŠ¡å™¨å…±äº«
- éœ€è¦Sessionå¤åˆ¶æˆ–é›†ä¸­å­˜å‚¨

Tokenæ–¹å¼ï¼ˆç°ä»£ï¼‰ï¼š
- æ— çŠ¶æ€ï¼Œä¸å­˜å‚¨Session
- TokenåŒ…å«ç”¨æˆ·ä¿¡æ¯
- å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼å’Œè·¨åŸŸ
```

**ğŸ”¹ Access Token vs Refresh Token**
```
Access Tokenï¼š
- æœ‰æ•ˆæœŸçŸ­ï¼ˆ1å°æ—¶ï¼‰
- åŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
- ç”¨äºè®¿é—®å—ä¿æŠ¤èµ„æº

Refresh Tokenï¼š
- æœ‰æ•ˆæœŸé•¿ï¼ˆ7å¤©ï¼‰
- åªç”¨äºåˆ·æ–°Access Token
- æå‡ç”¨æˆ·ä½“éªŒ
```

### 7.3 å®æˆ˜åº”ç”¨è¦ç‚¹


**âœ… æ¶æ„è®¾è®¡å»ºè®®**
- å»ºç«‹ç‹¬ç«‹çš„è®¤è¯ä¸­å¿ƒæœåŠ¡
- ä½¿ç”¨ç½‘å…³ç»Ÿä¸€éªŒè¯Token
- Tokenå­˜å‚¨åœ¨Redisï¼Œæ”¯æŒå¿«é€ŸéªŒè¯å’Œæ’¤é”€
- æ‰€æœ‰ç³»ç»Ÿé€šè¿‡OAuth2.0æ¥å…¥è®¤è¯ä¸­å¿ƒ

**âœ… å®‰å…¨æ³¨æ„äº‹é¡¹**
- HTTPSä¼ è¾“ï¼Œé˜²æ­¢Tokenè¢«æˆªè·
- Tokenè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
- ä½¿ç”¨RS256éå¯¹ç§°åŠ å¯†ç­¾å
- å®ç°Tokené»‘åå•æœºåˆ¶ï¼ˆç”¨æˆ·ç™»å‡ºæ—¶ï¼‰
- åˆ·æ–°Tokenä¹Ÿè¦è®¾ç½®è¿‡æœŸæ—¶é—´

**âœ… æ€§èƒ½ä¼˜åŒ–**
- TokenéªŒè¯åœ¨ç½‘å…³å±‚å®Œæˆï¼Œå‡å°‘ä¸‹æ¸¸å‹åŠ›
- ä½¿ç”¨Redisç¼“å­˜TokenéªŒè¯ç»“æœ
- åˆç†è®¾ç½®Tokenè¿‡æœŸæ—¶é—´ï¼Œå¹³è¡¡å®‰å…¨å’Œæ€§èƒ½

**âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
- å®ç°è‡ªåŠ¨åˆ·æ–°Tokenæœºåˆ¶
- æ”¯æŒ"è®°ä½æˆ‘"åŠŸèƒ½ï¼ˆå»¶é•¿Refresh Tokenæœ‰æ•ˆæœŸï¼‰
- ç™»å‡ºæ—¶æ¸…é™¤æ‰€æœ‰Token
- è·¨åŸŸç™»å½•è¦å¤„ç†å¥½Cookieå’ŒTokenä¼ é€’

### 7.4 å¸¸è§é—®é¢˜è§£å†³


**Q1ï¼šå¦‚ä½•å®ç°å•ç‚¹ç™»å‡ºï¼ˆSingle Sign-Outï¼‰ï¼Ÿ**
```
æ–¹æ¡ˆï¼š
1. ç”¨æˆ·ç™»å‡ºæ—¶ï¼Œè®¤è¯ä¸­å¿ƒå°†TokenåŠ å…¥é»‘åå•ï¼ˆRedisï¼‰
2. å„ç³»ç»ŸéªŒè¯Tokenæ—¶ï¼Œæ£€æŸ¥é»‘åå•
3. å¦‚æœåœ¨é»‘åå•ä¸­ï¼Œæ‹’ç»è®¿é—®
4. å¯é€‰ï¼šè®¤è¯ä¸­å¿ƒé€šçŸ¥å„ç³»ç»Ÿæ¸…é™¤æœ¬åœ°Tokenç¼“å­˜
```

**Q2ï¼šTokenè¢«ç›—ç”¨æ€ä¹ˆåŠï¼Ÿ**
```
é˜²æŠ¤æªæ–½ï¼š
1. HTTPSä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»
2. Tokenç»‘å®šIPåœ°å€æˆ–è®¾å¤‡æŒ‡çº¹
3. å¼‚å¸¸ç™»å½•æ£€æµ‹ï¼ˆå¦‚å¼‚åœ°ç™»å½•æé†’ï¼‰
4. æ”¯æŒç”¨æˆ·ä¸»åŠ¨æ’¤é”€Token
5. é‡è¦æ“ä½œè¦æ±‚äºŒæ¬¡éªŒè¯
```

**Q3ï¼šå¦‚ä½•æ”¯æŒç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€QQï¼‰ï¼Ÿ**
```
å®ç°ï¼š
1. è®¤è¯ä¸­å¿ƒé›†æˆç¬¬ä¸‰æ–¹OAuth2.0
2. ç”¨æˆ·é€‰æ‹©ç¬¬ä¸‰æ–¹ç™»å½•
3. è·³è½¬åˆ°ç¬¬ä¸‰æ–¹æˆæƒé¡µé¢
4. è·å–ç¬¬ä¸‰æ–¹ç”¨æˆ·ä¿¡æ¯
5. åœ¨æœ¬ç³»ç»Ÿåˆ›å»ºæˆ–å…³è”è´¦å·
6. é¢å‘æœ¬ç³»ç»Ÿçš„Token
```

**æ ¸å¿ƒè®°å¿†**ï¼š
> SSOè®©ç”¨æˆ·ä¸€æ¬¡ç™»å½•ã€ç•…è¡Œæ— é˜»  
> OAuth2æˆæƒç æ¨¡å¼æœ€å®‰å…¨  
> Tokenæ— çŠ¶æ€ã€æ˜“ä¼ é€’ã€å¥½æ‰©å±•  
> è®¤è¯ä¸­å¿ƒç»Ÿä¸€ç®¡ç†èº«ä»½å’Œæƒé™