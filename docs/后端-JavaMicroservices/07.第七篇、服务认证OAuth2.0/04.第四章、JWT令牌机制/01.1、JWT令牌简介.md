---
title: 1ã€JWTä»¤ç‰Œç®€ä»‹
---
## ğŸ“š ç›®å½•

1. [JWTåŸºç¡€æ¦‚å¿µ](#1-JWTåŸºç¡€æ¦‚å¿µ)
2. [JWTç»“æ„è¯¦è§£](#2-JWTç»“æ„è¯¦è§£)
3. [JWTå·¥ä½œåŸç†](#3-JWTå·¥ä½œåŸç†)
4. [JWTä¼˜åŠ¿ä¸ç‰¹ç‚¹](#4-JWTä¼˜åŠ¿ä¸ç‰¹ç‚¹)
5. [JWTåº”ç”¨åœºæ™¯](#5-JWTåº”ç”¨åœºæ™¯)
6. [JWTå®æˆ˜åº”ç”¨](#6-JWTå®æˆ˜åº”ç”¨)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ JWTåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯JWTï¼Ÿ


**JWTï¼ˆJSON Web Tokenï¼‰** æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œç”¨äºåœ¨ç½‘ç»œåº”ç”¨é—´å®‰å…¨åœ°ä¼ é€’ä¿¡æ¯ã€‚

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒä½ çš„èº«ä»½è¯ï¼Œé‡Œé¢åŒ…å«äº†ä½ çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€èº«ä»½è¯å·ã€ç…§ç‰‡ï¼‰ï¼Œå¹¶ä¸”æœ‰é˜²ä¼ªæ ‡è¯†ã€‚JWTä¹Ÿæ˜¯è¿™æ ·ï¼ŒåŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œé˜²ç¯¡æ”¹çš„ç­¾åã€‚

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
JWT = ä¸€æ®µç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²
ä½œç”¨ = åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨ä¼ é€’ç”¨æˆ·ä¿¡æ¯
æ ¼å¼ = Header.Payload.Signatureï¼ˆä¸‰æ®µå¼ç»“æ„ï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦JWTï¼Ÿ


åœ¨ä¼ ç»Ÿçš„Webåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§å¸¸è§çš„è®¤è¯æ–¹å¼ï¼š

**ğŸ“Š ä¼ ç»Ÿè®¤è¯æ–¹å¼å¯¹æ¯”**

| æ–¹å¼ | å·¥ä½œåŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|---------|------|------|
| **Session** | æœåŠ¡å™¨å­˜å‚¨ç”¨æˆ·çŠ¶æ€ | ç®€å•ç›´è§‚ | å ç”¨æœåŠ¡å™¨å†…å­˜<br>åˆ†å¸ƒå¼ç¯å¢ƒå›°éš¾ |
| **Cookie** | æµè§ˆå™¨å­˜å‚¨æ ‡è¯† | è‡ªåŠ¨æºå¸¦ | ä¸æ”¯æŒè·¨åŸŸ<br>ç§»åŠ¨ç«¯ä¸å‹å¥½ |
| **JWT** | å®¢æˆ·ç«¯å­˜å‚¨ä»¤ç‰Œ | æ— çŠ¶æ€æ‰©å±•<br>è·¨åŸŸå‹å¥½ | æ— æ³•ä¸»åŠ¨åºŸé™¤<br>è½½è·ä¸å®œè¿‡å¤§ |

**ä¼ ç»ŸSessionçš„é—®é¢˜**ï¼š
```
ç”¨æˆ·ç™»å½•æµç¨‹ï¼š
å®¢æˆ·ç«¯ â”€â”€ç™»å½•è¯·æ±‚â”€â”€> æœåŠ¡å™¨
         <â”€â”€åˆ›å»ºSessionâ”€â”€ ï¼ˆæœåŠ¡å™¨å†…å­˜å­˜å‚¨ï¼‰
         <â”€â”€è¿”å›SessionIDâ”€â”€
å®¢æˆ·ç«¯ä¿å­˜SessionID
         â”€â”€æºå¸¦SessionIDâ”€â”€> æœåŠ¡å™¨
                           æœåŠ¡å™¨æŸ¥æ‰¾Sessionï¼ˆè€—æ—¶ï¼‰
                           è¿”å›æ•°æ®

é—®é¢˜ï¼š
âŒ æœåŠ¡å™¨éœ€è¦å­˜å‚¨å¤§é‡Session
âŒ åˆ†å¸ƒå¼ç¯å¢ƒä¸‹SessionåŒæ­¥å›°éš¾
âŒ ç§»åŠ¨ç«¯ã€è·¨åŸŸåœºæ™¯æ”¯æŒå·®
```

**JWTçš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
ç”¨æˆ·ç™»å½•æµç¨‹ï¼š
å®¢æˆ·ç«¯ â”€â”€ç™»å½•è¯·æ±‚â”€â”€> æœåŠ¡å™¨
         <â”€â”€ç”ŸæˆJWTä»¤ç‰Œâ”€â”€ ï¼ˆä¸éœ€è¦å­˜å‚¨ï¼‰
         <â”€â”€è¿”å›JWTâ”€â”€
å®¢æˆ·ç«¯ä¿å­˜JWT
         â”€â”€æºå¸¦JWTâ”€â”€> æœåŠ¡å™¨
                     ç›´æ¥éªŒè¯ç­¾åï¼ˆå¿«é€Ÿï¼‰
                     è¿”å›æ•°æ®

ä¼˜åŠ¿ï¼š
âœ… æœåŠ¡å™¨æ— éœ€å­˜å‚¨çŠ¶æ€ï¼ˆæ— çŠ¶æ€ï¼‰
âœ… å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼å’Œè·¨åŸŸ
âœ… ç§»åŠ¨ç«¯å‹å¥½
```

### 1.3 JWTçš„æ ¸å¿ƒç‰¹æ€§


**ğŸ”¸ è‡ªåŒ…å«ï¼ˆSelf-Containedï¼‰**
> JWTä»¤ç‰Œæœ¬èº«åŒ…å«äº†ç”¨æˆ·çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦å†æŸ¥è¯¢æ•°æ®åº“

```
ä¸¾ä¾‹è¯´æ˜ï¼š
ä¼ ç»ŸSessionï¼šä»¤ç‰Œåªæ˜¯ä¸€ä¸ªIDï¼Œéœ€è¦ç”¨IDå»æ•°æ®åº“æŸ¥ç”¨æˆ·ä¿¡æ¯
JWTï¼šä»¤ç‰Œæœ¬èº«å°±åŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·IDã€è§’è‰²ã€æƒé™ç­‰ï¼‰

å°±åƒï¼š
Session = å­˜åŒ…å‡­è¯ï¼ˆéœ€è¦å‡­è¯å»å–åŒ…ï¼‰
JWT = éšèº«èƒŒåŒ…ï¼ˆæ‰€æœ‰ä¸œè¥¿éƒ½åœ¨èº«ä¸Šï¼‰
```

**ğŸ”¸ æ— çŠ¶æ€ï¼ˆStatelessï¼‰**
> æœåŠ¡å™¨ä¸éœ€è¦ä¿å­˜ä»»ä½•ä¼šè¯ä¿¡æ¯ï¼Œå®Œå…¨ä¾èµ–JWTä»¤ç‰Œæœ¬èº«

```
æ— çŠ¶æ€çš„å¥½å¤„ï¼š
âœ… æœåŠ¡å™¨é‡å¯ä¸å½±å“è®¤è¯
âœ… å¤šå°æœåŠ¡å™¨å…±äº«è®¤è¯
âœ… æ˜“äºæ°´å¹³æ‰©å±•

ä¼ ç»Ÿå¯¹æ¯”ï¼š
Sessionæœ‰çŠ¶æ€ï¼šæœåŠ¡å™¨å¿…é¡»è®°ä½"è°ç™»å½•äº†"
JWTæ— çŠ¶æ€ï¼šæœåŠ¡å™¨åªéœ€éªŒè¯"è¿™ä¸ªä»¤ç‰Œæ˜¯ä¸æ˜¯æˆ‘ç­¾å‘çš„"
```

**ğŸ”¸ ç­¾åéªŒè¯ï¼ˆSignature Verificationï¼‰**
> é€šè¿‡å¯†é’¥ç­¾åï¼Œç¡®ä¿æ•°æ®ä¸è¢«ç¯¡æ”¹

```
ç­¾åæœºåˆ¶ï¼š
1. æœåŠ¡å™¨ç”¨å¯†é’¥å¯¹æ•°æ®ç­¾å
2. å®¢æˆ·ç«¯æ— æ³•ä¼ªé€ ï¼ˆæ²¡æœ‰å¯†é’¥ï¼‰
3. æœåŠ¡å™¨éªŒè¯ç­¾åç¡®è®¤çœŸä¼ª

ç±»æ¯”ï¼š
å°±åƒæ”¿åºœå…¬æ–‡ä¸Šçš„å…¬ç« ï¼Œåªæœ‰æ”¿åºœæœ‰å…¬ç« ï¼Œ
åˆ«äººæ— æ³•ä¼ªé€ ï¼Œçœ‹åˆ°å…¬ç« å°±çŸ¥é“æ˜¯çœŸçš„
```

**ğŸ”¸ è·¨åŸŸä¼ è¾“ï¼ˆCross-Domainï¼‰**
> å¯ä»¥åœ¨HTTPå¤´ã€URLå‚æ•°ã€è¯·æ±‚ä½“ä¸­ä¼ è¾“ï¼Œä¸å—Cookieè·¨åŸŸé™åˆ¶

```
ä¼ è¾“æ–¹å¼ï¼š
æ–¹å¼1ï¼šHTTPè¯·æ±‚å¤´
Authorization: Bearer eyJhbGc...

æ–¹å¼2ï¼šURLå‚æ•°
https://api.com/user?token=eyJhbGc...

æ–¹å¼3ï¼šè¯·æ±‚ä½“
{ "token": "eyJhbGc..." }

ä¼˜åŠ¿ï¼šä¸å—æµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶
```

---

## 2. ğŸ” JWTç»“æ„è¯¦è§£


JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç”¨ç‚¹å·ï¼ˆ`.`ï¼‰åˆ†éš”ï¼š

```
å®Œæ•´JWTç¤ºä¾‹ï¼š
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjM0NSIsInVzZXJuYW1lIjoiemhhbmdzYW4iLCJyb2xlIjoiYWRtaW4ifQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c

ç»“æ„æ‹†è§£ï¼š
Headerï¼ˆå¤´éƒ¨ï¼‰    .    Payloadï¼ˆè½½è·ï¼‰    .    Signatureï¼ˆç­¾åï¼‰
    â†“                       â†“                        â†“
  å…ƒæ•°æ®ä¿¡æ¯              ç”¨æˆ·æ•°æ®                 é˜²ç¯¡æ”¹ç­¾å
```

### 2.1 Headerï¼ˆå¤´éƒ¨ï¼‰


**ä½œç”¨**ï¼šæè¿°JWTçš„å…ƒæ•°æ®ä¿¡æ¯

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | å«ä¹‰ | å¸¸ç”¨å€¼ |
|------|------|--------|
| `alg` | ç­¾åç®—æ³• | HS256ï¼ˆHMAC-SHA256ï¼‰<br>RS256ï¼ˆRSA-SHA256ï¼‰ |
| `typ` | ä»¤ç‰Œç±»å‹ | JWT |

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šHeaderå°±åƒä¿¡å°ä¸Šçš„è¯´æ˜ï¼Œå‘Šè¯‰æ¥æ”¶æ–¹"è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„ä¿¡ï¼Œç”¨ä»€ä¹ˆæ–¹å¼éªŒè¯"

**ç¼–ç æ–¹å¼**ï¼š
```
åŸå§‹JSON â†’ Base64URLç¼–ç  â†’ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

æ³¨æ„ï¼šBase64URLæ˜¯å¯é€†çš„ç¼–ç ï¼Œä¸æ˜¯åŠ å¯†ï¼
ä»»ä½•äººéƒ½èƒ½è§£ç çœ‹åˆ°å†…å®¹ï¼Œä½†æ— æ³•ç¯¡æ”¹ï¼ˆæœ‰ç­¾åä¿æŠ¤ï¼‰
```

### 2.2 Payloadï¼ˆè½½è·ï¼‰


**ä½œç”¨**ï¼šå­˜å‚¨å®é™…è¦ä¼ é€’çš„æ•°æ®

```json
{
  "userId": "12345",
  "username": "zhangsan",
  "role": "admin",
  "exp": 1672531200
}
```

**è½½è·åˆ†ç±»**ï¼š

**ğŸ”¸ æ³¨å†Œå£°æ˜ï¼ˆRegistered Claimsï¼‰**
> JWTæ ‡å‡†é¢„å®šä¹‰çš„å­—æ®µï¼Œå»ºè®®ä½¿ç”¨ä½†éå¼ºåˆ¶

| å£°æ˜ | å«ä¹‰ | è¯´æ˜ |
|------|------|------|
| `iss` | ç­¾å‘è€… | Issuerï¼Œè°é¢å‘çš„ä»¤ç‰Œ |
| `sub` | ä¸»é¢˜ | Subjectï¼Œä»¤ç‰Œé¢å‘çš„ç”¨æˆ· |
| `aud` | å—ä¼— | Audienceï¼Œä»¤ç‰Œçš„æ¥æ”¶æ–¹ |
| `exp` | è¿‡æœŸæ—¶é—´ | Expirationï¼ŒUnixæ—¶é—´æˆ³ |
| `nbf` | ç”Ÿæ•ˆæ—¶é—´ | Not Beforeï¼Œæ­¤æ—¶é—´å‰æ— æ•ˆ |
| `iat` | ç­¾å‘æ—¶é—´ | Issued Atï¼Œä»¤ç‰Œåˆ›å»ºæ—¶é—´ |
| `jti` | å”¯ä¸€æ ‡è¯† | JWT IDï¼Œä»¤ç‰Œçš„å”¯ä¸€ç¼–å· |

**ğŸ”¸ å…¬å…±å£°æ˜ï¼ˆPublic Claimsï¼‰**
> å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†å»ºè®®ä½¿ç”¨æ ‡å‡†åŒ–çš„å‘½åé¿å…å†²çª

**ğŸ”¸ ç§æœ‰å£°æ˜ï¼ˆPrivate Claimsï¼‰**
> å®Œå…¨è‡ªå®šä¹‰çš„ä¸šåŠ¡å­—æ®µ

```json
{
  // æ³¨å†Œå£°æ˜
  "iss": "my-auth-server",
  "exp": 1672531200,
  "iat": 1672527600,
  
  // ç§æœ‰å£°æ˜ï¼ˆä¸šåŠ¡æ•°æ®ï¼‰
  "userId": "12345",
  "username": "zhangsan",
  "role": "admin",
  "permissions": ["read", "write"]
}
```

âš ï¸ **é‡è¦æé†’**ï¼š
```
è½½è·å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š

âŒ ä¸è¦å­˜æ•æ„Ÿä¿¡æ¯ï¼š
   - å¯†ç 
   - ä¿¡ç”¨å¡å·
   - èº«ä»½è¯å·
   
âœ… å¯ä»¥å­˜æ”¾ï¼š
   - ç”¨æˆ·ID
   - ç”¨æˆ·å
   - è§’è‰²æƒé™
   - éæ•æ„Ÿé…ç½®

åŸå› ï¼šPayloadåªæ˜¯Base64ç¼–ç ï¼Œä»»ä½•äººéƒ½èƒ½è§£ç æŸ¥çœ‹ï¼
```

### 2.3 Signatureï¼ˆç­¾åï¼‰


**ä½œç”¨**ï¼šé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ï¼ŒéªŒè¯ä»¤ç‰ŒçœŸå®æ€§

**ğŸ”¸ ç­¾åç”Ÿæˆè¿‡ç¨‹**ï¼š

```
æ­¥éª¤1ï¼šå‡†å¤‡æ•°æ®
data = Base64URL(Header) + "." + Base64URL(Payload)

æ­¥éª¤2ï¼šä½¿ç”¨ç®—æ³•å’Œå¯†é’¥ç­¾å
signature = HMACSHA256(data, secret_key)

æ­¥éª¤3ï¼šBase64URLç¼–ç 
encoded_signature = Base64URL(signature)

å®Œæ•´JWT = data + "." + encoded_signature
```

**å›¾ç¤ºæµç¨‹**ï¼š
```
Headerï¼ˆåŸå§‹ï¼‰         Payloadï¼ˆåŸå§‹ï¼‰
     â†“                      â†“
Base64URLç¼–ç           Base64URLç¼–ç 
     â†“                      â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€ æ‹¼æ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
        + secret_keyï¼ˆå¯†é’¥ï¼‰
               â†“
         HMAC-SHA256ç®—æ³•
               â†“
           ç­¾åç»“æœ
               â†“
         Base64URLç¼–ç 
               â†“
         æœ€ç»ˆSignature
```

**ğŸ”¸ ç­¾åéªŒè¯è¿‡ç¨‹**ï¼š

```
æœåŠ¡å™¨æ”¶åˆ°JWTåçš„éªŒè¯æ­¥éª¤ï¼š

æ­¥éª¤1ï¼šæ‹†åˆ†JWT
parts = jwt.split(".")
header = parts[0]
payload = parts[1]
signature = parts[2]

æ­¥éª¤2ï¼šé‡æ–°è®¡ç®—ç­¾å
expected_signature = HMACSHA256(
  header + "." + payload,
  secret_key
)

æ­¥éª¤3ï¼šå¯¹æ¯”ç­¾å
if (expected_signature === signature) {
  âœ… éªŒè¯é€šè¿‡ï¼Œæ•°æ®æœªè¢«ç¯¡æ”¹
} else {
  âŒ éªŒè¯å¤±è´¥ï¼Œå¯èƒ½è¢«ç¯¡æ”¹
}
```

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šç­¾åå°±åƒé˜²ä¼ªæ ‡ç­¾ï¼Œåªæœ‰æ‹¥æœ‰å¯†é’¥çš„æœåŠ¡å™¨èƒ½ç”Ÿæˆæ­£ç¡®çš„ç­¾åã€‚å®¢æˆ·ç«¯å³ä½¿ä¿®æ”¹äº†Headeræˆ–Payloadï¼Œä¹Ÿæ— æ³•ç”ŸæˆåŒ¹é…çš„ç­¾åã€‚

---

## 3. âš™ï¸ JWTå·¥ä½œåŸç†


### 3.1 å®Œæ•´è®¤è¯æµç¨‹


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯  â”‚                          â”‚  æœåŠ¡å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                     â”‚
     â”‚  [1] å‘é€ç™»å½•è¯·æ±‚                    â”‚
     â”‚  POST /login                        â”‚
     â”‚  { username, password }             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                     â”‚
     â”‚                                [2] éªŒè¯ç”¨æˆ·
     â”‚                                     â”‚
     â”‚                                [3] ç”ŸæˆJWT
     â”‚                                     â”‚
     â”‚  [4] è¿”å›JWTä»¤ç‰Œ                     â”‚
     â”‚  { token: "eyJhbGc..." }            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                     â”‚
[5] ä¿å­˜JWT                                â”‚
  ï¼ˆlocalStorage/                          â”‚
   sessionStorageï¼‰                        â”‚
     â”‚                                     â”‚
     â”‚  [6] è®¿é—®å—ä¿æŠ¤èµ„æº                  â”‚
     â”‚  GET /api/user/profile              â”‚
     â”‚  Authorization: Bearer eyJhbGc...   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                     â”‚
     â”‚                                [7] éªŒè¯ç­¾å
     â”‚                                     â”‚
     â”‚                                [8] è§£æPayload
     â”‚                                     â”‚
     â”‚  [9] è¿”å›æ•°æ®                        â”‚
     â”‚  { userId: "12345", ... }           â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 3.2 ç™»å½•ç”ŸæˆJWTæµç¨‹è¯¦è§£


**æ­¥éª¤1ï¼šç”¨æˆ·æäº¤ç™»å½•ä¿¡æ¯**
```javascript
// å‰ç«¯å‘é€ç™»å½•è¯·æ±‚
fetch('/api/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'zhangsan',
    password: '123456'
  })
})
```

**æ­¥éª¤2ï¼šæœåŠ¡å™¨éªŒè¯ç”¨æˆ·**
```java
// åç«¯éªŒè¯é€»è¾‘ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
@PostMapping("/login")
public LoginResponse login(@RequestBody LoginRequest request) {
    // 1. éªŒè¯ç”¨æˆ·åå¯†ç 
    User user = userService.authenticate(
        request.getUsername(), 
        request.getPassword()
    );
    
    if (user == null) {
        throw new AuthException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }
    
    // 2. éªŒè¯é€šè¿‡ï¼Œç”ŸæˆJWT
    String token = jwtService.generateToken(user);
    
    return new LoginResponse(token);
}
```

**æ­¥éª¤3ï¼šç”ŸæˆJWTä»¤ç‰Œ**
```java
// JWTç”Ÿæˆæ ¸å¿ƒé€»è¾‘
public String generateToken(User user) {
    // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ24å°æ—¶åï¼‰
    Date expiration = new Date(System.currentTimeMillis() + 24 * 60 * 60 * 1000);
    
    // æ„å»ºJWT
    return Jwts.builder()
        // Headerè‡ªåŠ¨ç”Ÿæˆ
        .setSubject(user.getUsername())           // ä¸»é¢˜
        .claim("userId", user.getId())            // è‡ªå®šä¹‰è½½è·
        .claim("role", user.getRole())
        .setIssuedAt(new Date())                  // ç­¾å‘æ—¶é—´
        .setExpiration(expiration)                // è¿‡æœŸæ—¶é—´
        .signWith(SignatureAlgorithm.HS256, secretKey)  // ç­¾å
        .compact();
}
```

**æ­¥éª¤4ï¼šè¿”å›ç»™å®¢æˆ·ç«¯**
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjM0NSIsInVzZXJuYW1lIjoiemhhbmdzYW4iLCJyb2xlIjoiYWRtaW4iLCJleHAiOjE2NzI1MzEyMDB9.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
  "expiresIn": 86400
}
```

### 3.3 è®¿é—®èµ„æºéªŒè¯æµç¨‹


**æ­¥éª¤1ï¼šå®¢æˆ·ç«¯æºå¸¦JWTè®¿é—®**
```javascript
// å‰ç«¯è®¿é—®å—ä¿æŠ¤èµ„æº
fetch('/api/user/profile', {
  method: 'GET',
  headers: {
    'Authorization': 'Bearer ' + token  // åœ¨è¯·æ±‚å¤´æºå¸¦JWT
  }
})
```

**æ­¥éª¤2ï¼šæœåŠ¡å™¨æ‹¦æˆªéªŒè¯**
```java
// JWTæ‹¦æˆªå™¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
public class JwtInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) {
        // 1. ä»è¯·æ±‚å¤´è·å–token
        String authHeader = request.getHeader("Authorization");
        
        if (authHeader == null || !authHeader.startsWith("Bearer ")) {
            throw new AuthException("æœªæä¾›è®¤è¯ä»¤ç‰Œ");
        }
        
        String token = authHeader.substring(7); // ç§»é™¤"Bearer "å‰ç¼€
        
        // 2. éªŒè¯token
        try {
            Claims claims = jwtService.parseToken(token);
            
            // 3. å°†ç”¨æˆ·ä¿¡æ¯æ”¾å…¥è¯·æ±‚ä¸Šä¸‹æ–‡
            request.setAttribute("userId", claims.get("userId"));
            request.setAttribute("username", claims.getSubject());
            request.setAttribute("role", claims.get("role"));
            
            return true; // éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œ
            
        } catch (ExpiredJwtException e) {
            throw new AuthException("ä»¤ç‰Œå·²è¿‡æœŸ");
        } catch (Exception e) {
            throw new AuthException("ä»¤ç‰Œæ— æ•ˆ");
        }
    }
}
```

**æ­¥éª¤3ï¼šè§£æå¹¶ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯**
```java
@GetMapping("/user/profile")
public UserProfile getProfile(HttpServletRequest request) {
    // ä»è¯·æ±‚ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå·²åœ¨æ‹¦æˆªå™¨ä¸­è§£æï¼‰
    String userId = (String) request.getAttribute("userId");
    
    // æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
    return userService.getProfileById(userId);
}
```

---

## 4. ğŸ’ JWTä¼˜åŠ¿ä¸ç‰¹ç‚¹


### 4.1 æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”


**ğŸ“Š JWT vs Session å…¨é¢å¯¹æ¯”**

| å¯¹æ¯”ç»´åº¦ | Sessionæ–¹æ¡ˆ | JWTæ–¹æ¡ˆ |
|---------|------------|---------|
| **å­˜å‚¨ä½ç½®** | æœåŠ¡å™¨å†…å­˜/æ•°æ®åº“ | å®¢æˆ·ç«¯ |
| **æœåŠ¡å™¨å‹åŠ›** | ğŸ”´ é«˜<br>éœ€è¦å­˜å‚¨æ‰€æœ‰ä¼šè¯ | ğŸŸ¢ ä½<br>å®Œå…¨æ— çŠ¶æ€ |
| **æ‰©å±•æ€§** | ğŸ”´ å·®<br>éœ€è¦Sessionå…±äº« | ğŸŸ¢ ä¼˜<br>å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼ |
| **è·¨åŸŸæ”¯æŒ** | ğŸŸ¡ ä¸€èˆ¬<br>ä¾èµ–Cookie | ğŸŸ¢ ä¼˜<br>ä¸å—åŒæºç­–ç•¥é™åˆ¶ |
| **ç§»åŠ¨ç«¯å‹å¥½** | ğŸ”´ å·®<br>Cookieæœºåˆ¶ä¸é€‚ç”¨ | ğŸŸ¢ ä¼˜<br>çµæ´»æºå¸¦ |
| **å®‰å…¨æ€§** | ğŸŸ¢ å¯æ§<br>æœåŠ¡å™¨å¯ä¸»åŠ¨åºŸé™¤ | ğŸŸ¡ å—é™<br>è¿‡æœŸå‰æ— æ³•åºŸé™¤ |
| **æ€§èƒ½** | ğŸ”´ æ…¢<br>éœ€è¦æŸ¥è¯¢å­˜å‚¨ | ğŸŸ¢ å¿«<br>åªéœ€éªŒè¯ç­¾å |

### 4.2 JWTçš„äº”å¤§ä¼˜åŠ¿


**ğŸ”¸ ä¼˜åŠ¿1ï¼šæ— çŠ¶æ€æ‰©å±•**

```
ä¼ ç»ŸSessionæ¶æ„çš„å›°å¢ƒï¼š

ç”¨æˆ· â†’ æœåŠ¡å™¨Aï¼ˆå­˜å‚¨Sessionï¼‰
    â†’ æœåŠ¡å™¨Bï¼ˆæ— Sessionï¼Œè®¤è¯å¤±è´¥ï¼‰âŒ

è§£å†³æ–¹æ¡ˆ1ï¼šSessionå¤åˆ¶
æœåŠ¡å™¨A â†â†’ æœåŠ¡å™¨B ï¼ˆåŒæ­¥Sessionï¼‰
é—®é¢˜ï¼šåŒæ­¥å¼€é”€å¤§ï¼Œå®æ—¶æ€§å·®

è§£å†³æ–¹æ¡ˆ2ï¼šSessioné›†ä¸­å­˜å‚¨
æœåŠ¡å™¨Aã€B â†’ Redisï¼ˆç»Ÿä¸€å­˜å‚¨ï¼‰
é—®é¢˜ï¼šRedisæˆä¸ºç“¶é¢ˆå’Œå•ç‚¹

JWTçš„è§£å†³æ–¹æ¡ˆï¼š

ç”¨æˆ· â†’ æœåŠ¡å™¨Aï¼ˆéªŒè¯ç­¾åï¼‰âœ…
    â†’ æœåŠ¡å™¨Bï¼ˆéªŒè¯ç­¾åï¼‰âœ…
    â†’ æœåŠ¡å™¨Cï¼ˆéªŒè¯ç­¾åï¼‰âœ…

åŸç†ï¼šæ‰€æœ‰æœåŠ¡å™¨åªéœ€å¯†é’¥ï¼Œæ— éœ€å…±äº«çŠ¶æ€
```

**ğŸ”¸ ä¼˜åŠ¿2ï¼šè·¨åŸŸå‹å¥½**

```
Cookieçš„è·¨åŸŸé™åˆ¶ï¼š

åœºæ™¯ï¼š
å‰ç«¯ï¼šhttps://www.example.com
åç«¯ï¼šhttps://api.example.com

Cookieé—®é¢˜ï¼š
- ä¸åŒåŸŸåï¼ŒCookieæ— æ³•è‡ªåŠ¨æºå¸¦
- éœ€è¦CORSé…ç½®ï¼Œä»æœ‰é™åˆ¶

JWTæ–¹æ¡ˆï¼š

æ–¹å¼1ï¼šè¯·æ±‚å¤´æºå¸¦
Authorization: Bearer eyJhbGc...
âœ… ä¸å—åŸŸåé™åˆ¶

æ–¹å¼2ï¼šURLå‚æ•°
https://api.example.com/data?token=eyJhbGc...
âœ… ä»»ä½•åŸŸåéƒ½èƒ½è®¿é—®
```

**ğŸ”¸ ä¼˜åŠ¿3ï¼šç§»åŠ¨ç«¯å‹å¥½**

```
ç§»åŠ¨åº”ç”¨çš„è®¤è¯éœ€æ±‚ï¼š

ä¼ ç»ŸCookieï¼š
âŒ ç§»åŠ¨APPæ²¡æœ‰æµè§ˆå™¨Cookieæœºåˆ¶
âŒ éœ€è¦é¢å¤–çš„Cookieç®¡ç†

JWTæ–¹æ¡ˆï¼š
âœ… å­˜å‚¨åœ¨æœ¬åœ°ï¼ˆSharedPreferences/Keychainï¼‰
âœ… æ¯æ¬¡è¯·æ±‚æ‰‹åŠ¨æ·»åŠ åˆ°Header
âœ… ä¸Webç«¯å®Œå…¨ä¸€è‡´çš„è®¤è¯æœºåˆ¶

ç¤ºä¾‹ï¼ˆAndroidï¼‰ï¼š
String token = sharedPreferences.getString("jwt_token", "");
request.addHeader("Authorization", "Bearer " + token);
```

**ğŸ”¸ ä¼˜åŠ¿4ï¼šæ€§èƒ½ä¼˜å¼‚**

```
è®¤è¯æ€§èƒ½å¯¹æ¯”ï¼š

Sessionæ–¹æ¡ˆï¼š
1. ä»è¯·æ±‚ä¸­æå–SessionIDï¼ˆ1msï¼‰
2. æŸ¥è¯¢Redis/æ•°æ®åº“ï¼ˆ5-20msï¼‰â±ï¸
3. ååºåˆ—åŒ–Sessionæ•°æ®ï¼ˆ2msï¼‰
4. éªŒè¯æœ‰æ•ˆæ€§ï¼ˆ1msï¼‰
æ€»è€—æ—¶ï¼š9-24ms

JWTæ–¹æ¡ˆï¼š
1. ä»è¯·æ±‚ä¸­æå–Tokenï¼ˆ1msï¼‰
2. éªŒè¯ç­¾åï¼ˆ2-3msï¼‰âš¡
3. è§£æPayloadï¼ˆ1msï¼‰
æ€»è€—æ—¶ï¼š4-5ms

æ€§èƒ½æå‡ï¼šçº¦5å€
```

**ğŸ”¸ ä¼˜åŠ¿5ï¼šæ ‡å‡†åŒ–**

```
JWTçš„æ ‡å‡†åŒ–ä¼˜åŠ¿ï¼š

RFC 7519æ ‡å‡†ï¼š
âœ… è·¨è¯­è¨€æ”¯æŒï¼ˆJavaã€Pythonã€Goã€JS...ï¼‰
âœ… è·¨å¹³å°å…¼å®¹ï¼ˆWebã€ç§»åŠ¨ã€æ¡Œé¢ï¼‰
âœ… ç”Ÿæ€ä¸°å¯Œï¼ˆå„ç§å¼€æºåº“ï¼‰

å¸¸ç”¨åº“ï¼š
Javaï¼š  io.jsonwebtoken (jjwt)
Python: PyJWT
Node.js: jsonwebtoken
Go:     golang-jwt/jwt

å¼€å‘æ•ˆç‡ï¼š
- æ— éœ€è‡ªå·±å®ç°åŠ å¯†é€»è¾‘
- å¼€ç®±å³ç”¨çš„å®Œæ•´æ–¹æ¡ˆ
- ç¤¾åŒºæ”¯æŒå’Œæ–‡æ¡£ä¸°å¯Œ
```

### 4.3 JWTçš„å±€é™æ€§


âš ï¸ **éœ€è¦æ³¨æ„çš„é—®é¢˜**ï¼š

**ğŸ”¸ é—®é¢˜1ï¼šæ— æ³•ä¸»åŠ¨åºŸé™¤**

```
åœºæ™¯ï¼šç”¨æˆ·ç‚¹å‡»"é€€å‡ºç™»å½•"

Sessionæ–¹æ¡ˆï¼š
1. åˆ é™¤æœåŠ¡å™¨ç«¯Session âœ…
2. ç”¨æˆ·ç«‹å³å¤±å»è®¿é—®æƒé™

JWTæ–¹æ¡ˆï¼š
1. å®¢æˆ·ç«¯åˆ é™¤Token
2. ä½†Tokenåœ¨è¿‡æœŸå‰ä»ç„¶æœ‰æ•ˆ âŒ

è§£å†³æ–¹æ¡ˆï¼š
æ–¹æ¡ˆ1ï¼šè®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´
- expè®¾ç½®ä¸º15åˆ†é’Ÿ
- é…åˆåˆ·æ–°ä»¤ç‰Œæœºåˆ¶

æ–¹æ¡ˆ2ï¼šç»´æŠ¤é»‘åå•
- é€€å‡ºæ—¶å°†TokenåŠ å…¥é»‘åå•
- æ¯æ¬¡éªŒè¯æ—¶æ£€æŸ¥é»‘åå•
- ï¼ˆè¿èƒŒäº†æ— çŠ¶æ€åŸåˆ™ï¼‰

æ–¹æ¡ˆ3ï¼šTokenç‰ˆæœ¬æ§åˆ¶
- Payloadä¸­åŠ å…¥ç‰ˆæœ¬å·
- ä¿®æ”¹å¯†ç æ—¶å¢åŠ ç‰ˆæœ¬
- æ—§ç‰ˆæœ¬Tokenè‡ªåŠ¨å¤±æ•ˆ
```

**ğŸ”¸ é—®é¢˜2ï¼šPayloadä¸å®œè¿‡å¤§**

```
Tokenå¤§å°å½±å“ï¼š

å°Payloadï¼ˆ100å­—èŠ‚ï¼‰ï¼š
- ç½‘ç»œä¼ è¾“å¿«
- Headerå¼€é”€å°

å¤§Payloadï¼ˆ5KBï¼‰ï¼š
- æ¯æ¬¡è¯·æ±‚éƒ½æºå¸¦
- ç´¯ç§¯ç½‘ç»œå¼€é”€å¤§
- å¯èƒ½è¶…è¿‡Headeré™åˆ¶

æœ€ä½³å®è·µï¼š
âœ… åªå­˜å¿…è¦ä¿¡æ¯ï¼ˆuserIdã€roleï¼‰
âœ… é¿å…å­˜å‚¨å¤§é‡æ•°æ®
âŒ ä¸è¦å­˜å®Œæ•´ç”¨æˆ·å¯¹è±¡
âŒ ä¸è¦å­˜å¤æ‚çš„åµŒå¥—ç»“æ„

ç¤ºä¾‹ï¼š
// âŒ ä¸æ¨è
{
  "user": {
    "id": 123,
    "profile": {...},
    "settings": {...},
    "history": [...]
  }
}

// âœ… æ¨è
{
  "userId": 123,
  "role": "admin"
}
```

**ğŸ”¸ é—®é¢˜3ï¼šå¯†é’¥å®‰å…¨è‡³å…³é‡è¦**

```
å¯†é’¥æ³„éœ²çš„ä¸¥é‡åæœï¼š

å¦‚æœå¯†é’¥è¢«çªƒå–ï¼š
âŒ æ”»å‡»è€…å¯ä»¥ä¼ªé€ ä»»ä½•JWT
âŒ å¯ä»¥å†’å……ä»»ä½•ç”¨æˆ·
âŒ å¯ä»¥æˆäºˆè‡ªå·±ä»»æ„æƒé™

å®‰å…¨å»ºè®®ï¼š

1ï¸âƒ£ å¯†é’¥ç®¡ç†ï¼š
- ä½¿ç”¨å¼ºéšæœºå¯†é’¥ï¼ˆè‡³å°‘256ä½ï¼‰
- å®šæœŸè½®æ¢å¯†é’¥
- ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡

2ï¸âƒ£ ä¼ è¾“å®‰å…¨ï¼š
- å¿…é¡»ä½¿ç”¨HTTPS
- é˜²æ­¢ä¸­é—´äººæ”»å‡»

3ï¸âƒ£ å­˜å‚¨å®‰å…¨ï¼š
- ä¸è¦ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- ä¸è¦æäº¤åˆ°Gitä»“åº“
- ä½¿ç”¨é…ç½®ä¸­å¿ƒæˆ–å¯†é’¥æœåŠ¡
```

---

## 5. ğŸ¯ JWTåº”ç”¨åœºæ™¯


### 5.1 å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰


**åœºæ™¯æè¿°**ï¼šä¸€æ¬¡ç™»å½•ï¼Œå¤šä¸ªç³»ç»Ÿå…ç™»å½•

```
ä¼ä¸šå†…éƒ¨ç³»ç»Ÿæ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OAç³»ç»Ÿ  â”‚   â”‚  é‚®ä»¶ç³»ç»Ÿ â”‚   â”‚  è€ƒå‹¤ç³»ç»Ÿ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  è®¤è¯ä¸­å¿ƒ      â”‚
            â”‚  (ç­¾å‘JWT)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æµç¨‹**ï¼š

```
æ­¥éª¤1ï¼šç”¨æˆ·ç™»å½•è®¤è¯ä¸­å¿ƒ
ç”¨æˆ· â†’ è®¤è¯ä¸­å¿ƒï¼šè¾“å…¥è´¦å·å¯†ç 
è®¤è¯ä¸­å¿ƒ â†’ ç”¨æˆ·ï¼šè¿”å›JWT

æ­¥éª¤2ï¼šè®¿é—®OAç³»ç»Ÿ
ç”¨æˆ· â†’ OAç³»ç»Ÿï¼šæºå¸¦JWT
OAç³»ç»Ÿï¼šéªŒè¯JWTç­¾å âœ…
OAç³»ç»Ÿ â†’ ç”¨æˆ·ï¼šè¿”å›æ•°æ®ï¼ˆå…ç™»å½•ï¼‰

æ­¥éª¤3ï¼šè®¿é—®é‚®ä»¶ç³»ç»Ÿ
ç”¨æˆ· â†’ é‚®ä»¶ç³»ç»Ÿï¼šæºå¸¦åŒä¸€ä¸ªJWT
é‚®ä»¶ç³»ç»Ÿï¼šéªŒè¯JWTç­¾å âœ…
é‚®ä»¶ç³»ç»Ÿ â†’ ç”¨æˆ·ï¼šè¿”å›æ•°æ®ï¼ˆå…ç™»å½•ï¼‰

å…³é”®ç‚¹ï¼š
- æ‰€æœ‰ç³»ç»Ÿå…±äº«åŒä¸€ä¸ªå¯†é’¥
- JWTç”±ç»Ÿä¸€è®¤è¯ä¸­å¿ƒç­¾å‘
- å„ç³»ç»Ÿåªéœ€éªŒè¯ç­¾åå³å¯
```

### 5.2 ç§»åŠ¨åº”ç”¨è®¤è¯


**åœºæ™¯æè¿°**ï¼šAPPçš„ç”¨æˆ·è®¤è¯

```
ç§»åŠ¨APPçš„è®¤è¯æµç¨‹ï¼š

[ç”¨æˆ·æ‰“å¼€APP]
     â†“
[æ£€æŸ¥æœ¬åœ°JWT]
     â†“
  JWTå­˜åœ¨ï¼Ÿ
   â†™    â†˜
 æ˜¯      å¦
 â†“       â†“
éªŒè¯è¿‡æœŸ  è·³è½¬ç™»å½•
 â†“       â†“
è¿‡æœŸï¼Ÿ   è¾“å…¥è´¦å¯†
â†™  â†˜     â†“
æ˜¯  å¦   è·å–JWT
â†“   â†“    â†“
åˆ·æ–° ç›´æ¥ä½¿ç”¨
ä»¤ç‰Œ  â†“     â†“
 â†“   â””â”€â”€ä¿å­˜åˆ°æœ¬åœ°â”€â”€â”˜
 â†“         â†“
 â””â”€â”€â”€â”€è®¿é—®APIâ”€â”€â”€â”€â”˜
```

**å­˜å‚¨æ–¹å¼**ï¼š
```
Androidå¹³å°ï¼š
SharedPreferences.Editor editor = sharedPreferences.edit();
editor.putString("jwt_token", token);
editor.apply();

iOSå¹³å°ï¼š
Keychain.set(token, forKey: "jwt_token")

æ³¨æ„ï¼š
- Androidæ¨èåŠ å¯†å­˜å‚¨
- iOSä¼˜å…ˆä½¿ç”¨Keychainï¼ˆæ›´å®‰å…¨ï¼‰
- ä¸è¦ä½¿ç”¨æ˜æ–‡æ–‡ä»¶å­˜å‚¨
```

### 5.3 å¾®æœåŠ¡é‰´æƒ


**åœºæ™¯æè¿°**ï¼šå¾®æœåŠ¡é—´çš„è®¤è¯ä¼ é€’

```
å¾®æœåŠ¡è°ƒç”¨é“¾ï¼š

ç”¨æˆ· â†’ ç½‘å…³ â†’ ç”¨æˆ·æœåŠ¡ â†’ è®¢å•æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡
       â”‚        â”‚           â”‚           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              æºå¸¦åŒä¸€ä¸ªJWTä»¤ç‰Œ

ä¼˜åŠ¿ï¼š
âœ… æ— éœ€æ¯ä¸ªæœåŠ¡å•ç‹¬è®¤è¯
âœ… ç”¨æˆ·èº«ä»½åœ¨è°ƒç”¨é“¾ä¸­ä¼ é€’
âœ… ç»Ÿä¸€çš„æƒé™æ§åˆ¶
```

**å®ç°ç¤ºä¾‹**ï¼š
```java
// ç½‘å…³å±‚ï¼šéªŒè¯JWT
@Component
public class GatewayFilter implements GlobalFilter {
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // 1. è·å–JWT
        String token = exchange.getRequest().getHeaders().getFirst("Authorization");
        
        // 2. éªŒè¯JWT
        if (!jwtService.validate(token)) {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
        
        // 3. é€ä¼ JWTåˆ°ä¸‹æ¸¸æœåŠ¡
        ServerHttpRequest request = exchange.getRequest().mutate()
            .header("Authorization", token)
            .build();
            
        return chain.filter(exchange.mutate().request(request).build());
    }
}

// è®¢å•æœåŠ¡ï¼šä»JWTè·å–ç”¨æˆ·ä¿¡æ¯
@GetMapping("/orders")
public List<Order> getUserOrders(HttpServletRequest request) {
    String userId = (String) request.getAttribute("userId");
    return orderService.getOrdersByUserId(userId);
}
```

### 5.4 ç¬¬ä¸‰æ–¹APIæˆæƒ


**åœºæ™¯æè¿°**ï¼šå¯¹å¤–å¼€æ”¾APIçš„è®¤è¯

```
ç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥æµç¨‹ï¼š

1. ç”³è¯·APIå¯†é’¥ï¼š
   ç¬¬ä¸‰æ–¹ â†’ å¹³å°ï¼šç”³è¯·æ¥å…¥
   å¹³å° â†’ ç¬¬ä¸‰æ–¹ï¼šåˆ†é…AppKeyå’ŒAppSecret

2. è·å–è®¿é—®ä»¤ç‰Œï¼š
   ç¬¬ä¸‰æ–¹ â†’ å¹³å°ï¼šAppKey + AppSecret
   å¹³å° â†’ ç¬¬ä¸‰æ–¹ï¼šJWTä»¤ç‰Œ

3. è°ƒç”¨APIï¼š
   ç¬¬ä¸‰æ–¹ â†’ å¹³å°ï¼šæºå¸¦JWTè®¿é—®API
   å¹³å°ï¼šéªŒè¯JWTå¹¶è¿”å›æ•°æ®

JWTå†…å®¹ï¼š
{
  "appId": "third_app_123",
  "permissions": ["read:user", "write:order"],
  "exp": 1672531200
}
```

---

## 6. ğŸ› ï¸ JWTå®æˆ˜åº”ç”¨


### 6.1 Javaå®ç°JWT


**å¼•å…¥ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.11.5</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-impl</artifactId>
    <version>0.11.5</version>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-jackson</artifactId>
    <version>0.11.5</version>
    <scope>runtime</scope>
</dependency>
```

**æ ¸å¿ƒå·¥å…·ç±»**ï¼š
```java
@Component
public class JwtUtil {
    
    @Value("${jwt.secret}")
    private String secret; // ä»é…ç½®æ–‡ä»¶è¯»å–å¯†é’¥
    
    @Value("${jwt.expiration}")
    private Long expiration; // è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    
    /**
     * ç”ŸæˆJWTä»¤ç‰Œ
     */
    public String generateToken(UserDetails userDetails) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("username", userDetails.getUsername());
        claims.put("roles", userDetails.getAuthorities());
        
        return Jwts.builder()
            .setClaims(claims)
            .setSubject(userDetails.getUsername())
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + expiration))
            .signWith(SignatureAlgorithm.HS512, secret)
            .compact();
    }
    
    /**
     * è§£æJWTä»¤ç‰Œ
     */
    public Claims parseToken(String token) {
        return Jwts.parserBuilder()
            .setSigningKey(secret)
            .build()
            .parseClaimsJws(token)
            .getBody();
    }
    
    /**
     * éªŒè¯ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
     */
    public boolean validateToken(String token) {
        try {
            Claims claims = parseToken(token);
            return !claims.getExpiration().before(new Date());
        } catch (JwtException e) {
            return false;
        }
    }
    
    /**
     * ä»ä»¤ç‰Œä¸­è·å–ç”¨æˆ·å
     */
    public String getUsernameFromToken(String token) {
        return parseToken(token).getSubject();
    }
}
```

### 6.2 é…ç½®JWTæ‹¦æˆªå™¨


```java
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private JwtUtil jwtUtil;
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain filterChain) throws ServletException, IOException {
        
        // 1. è·å–Authorizationè¯·æ±‚å¤´
        String authHeader = request.getHeader("Authorization");
        
        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            String token = authHeader.substring(7);
            
            // 2. éªŒè¯ä»¤ç‰Œ
            if (jwtUtil.validateToken(token)) {
                // 3. è·å–ç”¨æˆ·å
                String username = jwtUtil.getUsernameFromToken(token);
                
                // 4. åŠ è½½ç”¨æˆ·è¯¦æƒ…
                UserDetails userDetails = userDetailsService.loadUserByUsername(username);
                
                // 5. æ„å»ºè®¤è¯å¯¹è±¡
                UsernamePasswordAuthenticationToken authentication = 
                    new UsernamePasswordAuthenticationToken(
                        userDetails, null, userDetails.getAuthorities()
                    );
                
                // 6. è®¾ç½®åˆ°å®‰å…¨ä¸Šä¸‹æ–‡
                SecurityContextHolder.getContext().setAuthentication(authentication);
            }
        }
        
        // 7. ç»§ç»­è¿‡æ»¤é“¾
        filterChain.doFilter(request, response);
    }
}
```

### 6.3 ç™»å½•æ¥å£å®ç°


```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    
    @Autowired
    private AuthenticationManager authenticationManager;
    
    @Autowired
    private JwtUtil jwtUtil;
    
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest request) {
        try {
            // 1. è®¤è¯ç”¨æˆ·
            Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(
                    request.getUsername(),
                    request.getPassword()
                )
            );
            
            // 2. è·å–ç”¨æˆ·è¯¦æƒ…
            UserDetails userDetails = (UserDetails) authentication.getPrincipal();
            
            // 3. ç”ŸæˆJWT
            String token = jwtUtil.generateToken(userDetails);
            
            // 4. è¿”å›å“åº”
            return ResponseEntity.ok(new JwtResponse(token));
            
        } catch (BadCredentialsException e) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
                .body(new ErrorResponse("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"));
        }
    }
}
```

### 6.4 åˆ·æ–°ä»¤ç‰Œæœºåˆ¶


**ä¸ºä»€ä¹ˆéœ€è¦åˆ·æ–°ä»¤ç‰Œï¼Ÿ**

```
é—®é¢˜ï¼šJWTè¿‡æœŸåç”¨æˆ·ä½“éªŒå·®

çŸ­è¿‡æœŸæ—¶é—´ï¼ˆ15åˆ†é’Ÿï¼‰ï¼š
âœ… å®‰å…¨æ€§é«˜
âŒ ç”¨æˆ·é¢‘ç¹é‡æ–°ç™»å½•

é•¿è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰ï¼š
âœ… ç”¨æˆ·ä½“éªŒå¥½
âŒ å®‰å…¨é£é™©é«˜ï¼ˆæ³„éœ²åé•¿æœŸæœ‰æ•ˆï¼‰

è§£å†³æ–¹æ¡ˆï¼šåŒä»¤ç‰Œæœºåˆ¶
```

**åŒä»¤ç‰Œæ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Access Tokenâ”‚          â”‚Refresh Tokenâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿‡æœŸæ—¶é—´:15åˆ†é’Ÿâ”‚          â”‚ è¿‡æœŸæ—¶é—´:7å¤©  â”‚
â”‚ ç”¨é€”:è®¿é—®API â”‚          â”‚ ç”¨é€”:åˆ·æ–°ä»¤ç‰Œ â”‚
â”‚ å­˜å‚¨:å†…å­˜    â”‚          â”‚ å­˜å‚¨:æ•°æ®åº“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ·æ–°æµç¨‹**ï¼š
```
æ­£å¸¸è®¿é—®ï¼š
ç”¨æˆ· â†’ API: æºå¸¦Access Token
API: éªŒè¯é€šè¿‡ï¼Œè¿”å›æ•°æ®

Access Tokenè¿‡æœŸï¼š
ç”¨æˆ· â†’ API: æºå¸¦è¿‡æœŸçš„Access Token
API: è¿”å›401 Tokenè¿‡æœŸ

ç”¨æˆ· â†’ åˆ·æ–°æ¥å£: æºå¸¦Refresh Token
åˆ·æ–°æ¥å£: 
  1. éªŒè¯Refresh Token
  2. ç”Ÿæˆæ–°çš„Access Token
  3. è¿”å›æ–°ä»¤ç‰Œ

ç”¨æˆ· â†’ API: æºå¸¦æ–°çš„Access Token
API: éªŒè¯é€šè¿‡ï¼Œè¿”å›æ•°æ®
```

**å®ç°ä»£ç **ï¼š
```java
@PostMapping("/refresh")
public ResponseEntity<?> refresh(@RequestBody RefreshRequest request) {
    try {
        // 1. éªŒè¯Refresh Token
        String refreshToken = request.getRefreshToken();
        if (!jwtUtil.validateRefreshToken(refreshToken)) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
                .body(new ErrorResponse("åˆ·æ–°ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ"));
        }
        
        // 2. ä»Refresh Tokenè·å–ç”¨æˆ·å
        String username = jwtUtil.getUsernameFromToken(refreshToken);
        
        // 3. åŠ è½½ç”¨æˆ·ä¿¡æ¯
        UserDetails userDetails = userDetailsService.loadUserByUsername(username);
        
        // 4. ç”Ÿæˆæ–°çš„Access Token
        String newAccessToken = jwtUtil.generateToken(userDetails);
        
        // 5. è¿”å›æ–°ä»¤ç‰Œ
        return ResponseEntity.ok(new JwtResponse(newAccessToken));
        
    } catch (Exception e) {
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
            .body(new ErrorResponse("ä»¤ç‰Œåˆ·æ–°å¤±è´¥"));
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


ğŸ¯ **ä¸€å¥è¯æ€»ç»“**
> JWTæ˜¯ä¸€ç§è‡ªåŒ…å«çš„ã€æ— çŠ¶æ€çš„ã€å¯è·¨åŸŸçš„ä»¤ç‰Œè®¤è¯æ–¹æ¡ˆï¼Œé€šè¿‡ç­¾åæœºåˆ¶ä¿è¯æ•°æ®å®Œæ•´æ€§ã€‚

**ğŸ”¸ JWTä¸‰è¦ç´ **
```
Header  â†’ æè¿°ç­¾åç®—æ³•
Payload â†’ å­˜å‚¨ç”¨æˆ·æ•°æ®  
Signature â†’ é˜²ç¯¡æ”¹ç­¾å
```

**ğŸ”¸ äº”å¤§æ ¸å¿ƒç‰¹æ€§**
```
âœ… è‡ªåŒ…å«ï¼šä»¤ç‰Œæœ¬èº«åŒ…å«æ‰€æœ‰ä¿¡æ¯
âœ… æ— çŠ¶æ€ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨
âœ… ç­¾åéªŒè¯ï¼šç¡®ä¿æ•°æ®æœªè¢«ç¯¡æ”¹
âœ… è·¨åŸŸå‹å¥½ï¼šä¸å—Cookieé™åˆ¶
âœ… æ ‡å‡†åŒ–ï¼šè·¨è¯­è¨€ã€è·¨å¹³å°
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ JWT vs Session**

| ç»´åº¦ | Session | JWT |
|------|---------|-----|
| æœ¬è´¨ | æœåŠ¡å™¨ç»´æŠ¤çŠ¶æ€ | å®¢æˆ·ç«¯æºå¸¦å‡­è¯ |
| æ‰©å±•æ€§ | éœ€è¦Sessionå…±äº« | å¤©ç„¶åˆ†å¸ƒå¼ |
| æ€§èƒ½ | éœ€è¦æŸ¥è¯¢å­˜å‚¨ | åªéœ€éªŒè¯ç­¾å |
| å®‰å…¨ | å¯ä¸»åŠ¨åºŸé™¤ | è¿‡æœŸå‰æœ‰æ•ˆ |

**ğŸ”¹ å®‰å…¨æ€§ç†è§£**

```
JWTå®‰å…¨çš„æœ¬è´¨ï¼š

ä¸æ˜¯åŠ å¯†ï¼â†’ Payloadå¯è¢«è§£ç æŸ¥çœ‹
æ˜¯ç­¾åï¼  â†’ æ•°æ®ä¸èƒ½è¢«ç¯¡æ”¹

å®‰å…¨å»ºè®®ï¼š
ğŸ” å¯†é’¥ä¿å¯†ï¼ˆè‡³å°‘256ä½ï¼‰
ğŸ” ä½¿ç”¨HTTPSä¼ è¾“
ğŸ” è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´
ğŸ” æ•æ„Ÿæ•°æ®ä¸æ”¾Payload
```

**ğŸ”¹ ä½¿ç”¨åœºæ™¯åˆ¤æ–­**

```
âœ… é€‚åˆJWTçš„åœºæ™¯ï¼š
- åˆ†å¸ƒå¼ç³»ç»Ÿ/å¾®æœåŠ¡
- è·¨åŸŸè®¤è¯
- ç§»åŠ¨åº”ç”¨
- ç¬¬ä¸‰æ–¹APIæˆæƒ
- å•ç‚¹ç™»å½•

âŒ ä¸é€‚åˆJWTçš„åœºæ™¯ï¼š
- éœ€è¦ç«‹å³åºŸé™¤ä»¤ç‰Œ
- é«˜æ•æ„Ÿæ•°æ®ä¼ è¾“
- ä»¤ç‰Œè½½è·è¿‡å¤§
- é¢‘ç¹ä¿®æ”¹ç”¨æˆ·æƒé™
```

### 7.3 å®è·µè¦ç‚¹


**ğŸ“ å¼€å‘æ¸…å•**
- [ ] ç†è§£JWTçš„ä¸‰æ®µå¼ç»“æ„
- [ ] æŒæ¡ç­¾åç”Ÿæˆå’ŒéªŒè¯åŸç†
- [ ] é…ç½®JWTå·¥å…·ç±»å’Œæ‹¦æˆªå™¨
- [ ] å®ç°ç™»å½•å’Œä»¤ç‰Œåˆ·æ–°æ¥å£
- [ ] è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
- [ ] ä¿æŠ¤å¥½å¯†é’¥å®‰å…¨

**âš ï¸ å¸¸è§é™·é˜±**
```
é™·é˜±1ï¼šæŠŠJWTå½“åŠ å¯†
Ã— é”™è¯¯ï¼šåœ¨Payloadæ”¾å¯†ç ç­‰æ•æ„Ÿæ•°æ®
âˆš æ­£ç¡®ï¼šPayloadåªæ”¾éæ•æ„Ÿæ ‡è¯†ä¿¡æ¯

é™·é˜±2ï¼šå¯†é’¥ç®¡ç†ä¸å½“  
Ã— é”™è¯¯ï¼šç¡¬ç¼–ç åœ¨ä»£ç ä¸­
âˆš æ­£ç¡®ï¼šä½¿ç”¨é…ç½®ä¸­å¿ƒæˆ–ç¯å¢ƒå˜é‡

é™·é˜±3ï¼šä¸éªŒè¯è¿‡æœŸæ—¶é—´
Ã— é”™è¯¯ï¼šåªéªŒè¯ç­¾å
âˆš æ­£ç¡®ï¼šåŒæ—¶éªŒè¯expå­—æ®µ

é™·é˜±4ï¼šè¿‡æœŸæ—¶é—´è®¾ç½®ä¸åˆç†
Ã— é”™è¯¯ï¼šæ°¸ä¸è¿‡æœŸæˆ–è¿‡æœŸå¤ªçŸ­
âˆš æ­£ç¡®ï¼šAccess TokençŸ­æœŸ + Refresh Tokené•¿æœŸ
```

**ğŸš€ æœ€ä½³å®è·µ**
```
1. åŒä»¤ç‰Œæœºåˆ¶
   - Access Token: 15-30åˆ†é’Ÿ
   - Refresh Token: 7-30å¤©

2. åˆç†çš„Payloadè®¾è®¡
   {
     "userId": "12345",
     "role": "admin",
     "exp": 1672531200
   }

3. å®Œå–„çš„å¼‚å¸¸å¤„ç†
   - Tokenè¿‡æœŸ â†’ 401
   - Tokenæ— æ•ˆ â†’ 401  
   - Tokenç¼ºå¤± â†’ 401

4. HTTPSä¼ è¾“
   - ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶HTTPS
   - é˜²æ­¢ä¸­é—´äººæ”»å‡»

5. å¯†é’¥è½®æ¢
   - å®šæœŸæ›´æ¢å¯†é’¥
   - æ”¯æŒå¤šå¯†é’¥éªŒè¯ï¼ˆè¿‡æ¸¡æœŸï¼‰
```

### 7.4 å­¦ä¹ è·¯å¾„


```
åˆçº§ â†’ ä¸­çº§ â†’ é«˜çº§
 â†“      â†“      â†“
åŸºç¡€   å®æˆ˜   ä¼˜åŒ–

ğŸ“š åˆçº§é˜¶æ®µï¼š
- ç†è§£JWTç»“æ„å’ŒåŸç†
- æŒæ¡åŸºæœ¬çš„ç”Ÿæˆå’ŒéªŒè¯
- å®ç°ç®€å•çš„ç™»å½•è®¤è¯

ğŸ’¼ ä¸­çº§é˜¶æ®µï¼š
- é…ç½®æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨
- å®ç°åˆ·æ–°ä»¤ç‰Œæœºåˆ¶
- å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ

ğŸš€ é«˜çº§é˜¶æ®µï¼š
- å¾®æœåŠ¡é‰´æƒä¼ é€’
- å•ç‚¹ç™»å½•å®ç°
- å®‰å…¨åŠ å›ºå’Œæ€§èƒ½ä¼˜åŒ–
```

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
JWTä»¤ç‰Œä¸‰æ®µå¼ï¼Œå¤´éƒ¨è½½è·åŠ ç­¾å
è‡ªåŒ…å«ç‰¹æ€§å¼ºï¼ŒæœåŠ¡æ— çŠ¶æ€æ‰©å±•
è·¨åŸŸä¼ è¾“ä¸å—é™ï¼Œç§»åŠ¨ç«¯ä¸Šæ›´çµæ´»
å¯†é’¥å®‰å…¨æ˜¯æ ¹æœ¬ï¼Œåˆç†è¿‡æœŸä¿å®‰å…¨
åŒä»¤ç‰Œæœºåˆ¶å¥½ï¼Œä½“éªŒå®‰å…¨ä¸¤ä¸è¯¯
```

**ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼š
- æ·±å…¥å­¦ä¹ OAuth2.0åè®®
- äº†è§£OpenID Connect
- æŒæ¡Spring Securityæ•´åˆ
- å®è·µå¾®æœåŠ¡å®‰å…¨æ¶æ„