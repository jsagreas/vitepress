---
title: 2ã€JWTç»“æ„è§£æ
---
## ğŸ“š ç›®å½•

1. [JWTæ˜¯ä»€ä¹ˆ](#1-JWTæ˜¯ä»€ä¹ˆ)
2. [JWTçš„ä¸‰æ®µå¼ç»“æ„](#2-JWTçš„ä¸‰æ®µå¼ç»“æ„)
3. [Headerå¤´éƒ¨è¯¦è§£](#3-Headerå¤´éƒ¨è¯¦è§£)
4. [Payloadè½½è·è¯¦è§£](#4-Payloadè½½è·è¯¦è§£)
5. [Signatureç­¾åè¯¦è§£](#5-Signatureç­¾åè¯¦è§£)
6. [Base64URLç¼–ç æœºåˆ¶](#6-Base64URLç¼–ç æœºåˆ¶)
7. [JWTå®Œæ•´å·¥ä½œæµç¨‹](#7-JWTå®Œæ•´å·¥ä½œæµç¨‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ JWTæ˜¯ä»€ä¹ˆ


### 1.1 JWTçš„æœ¬è´¨ç†è§£


> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> JWTå°±åƒä½ çš„**ç”µå­èº«ä»½è¯**ï¼šåŒ…å«ä½ çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€å¹´é¾„ï¼‰ã€ç‰¹æ®Šæƒé™ï¼ˆé©¾é©¶è¯ç±»å‹ï¼‰ã€è¿˜æœ‰é˜²ä¼ªæ ‡è¯†ï¼ˆäºŒç»´ç ç­¾åï¼‰ï¼Œåˆ«äººä¸€æ‰«å°±çŸ¥é“ä½ æ˜¯è°ã€èƒ½å¹²ä»€ä¹ˆã€‚

**JWTæ ¸å¿ƒå®šä¹‰**
```
JWT = JSON Web Tokenï¼ˆJSONç½‘ç»œä»¤ç‰Œï¼‰
æœ¬è´¨ï¼šä¸€ç§ç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ•°æ®ä¼ è¾“æ ¼å¼
ç”¨é€”ï¼šåœ¨ç½‘ç»œåº”ç”¨é—´å®‰å…¨åœ°ä¼ é€’ç”¨æˆ·ä¿¡æ¯å’Œæƒé™
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦JWTï¼Ÿ**

ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
```
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨åˆ›å»ºSession â†’ å­˜å‚¨åœ¨æœåŠ¡å™¨å†…å­˜
é—®é¢˜1ï¼šæœåŠ¡å™¨è¦è®°ä½æ¯ä¸ªç”¨æˆ·ï¼Œå†…å­˜å‹åŠ›å¤§
é—®é¢˜2ï¼šå¤šå°æœåŠ¡å™¨æ—¶Sessionéš¾ä»¥å…±äº«
é—®é¢˜3ï¼šç§»åŠ¨ç«¯ã€å‰åç«¯åˆ†ç¦»æ¶æ„ä¸å‹å¥½
```

JWTçš„è§£å†³æ–¹æ¡ˆï¼š
```
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ç”ŸæˆJWT â†’ è¿”å›ç»™å®¢æˆ·ç«¯
âœ… æœåŠ¡å™¨æ— éœ€å­˜å‚¨ï¼Œå‡è½»å‹åŠ›
âœ… å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚æºå¸¦JWT
âœ… æœåŠ¡å™¨åªéœ€éªŒè¯ç­¾åï¼Œæ— çŠ¶æ€è®¾è®¡
âœ… å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿ
```

### 1.2 JWTçš„æ ¸å¿ƒç‰¹ç‚¹


**ğŸŒŸ ä¸»è¦ç‰¹å¾**
- **è‡ªåŒ…å«**ï¼šä»¤ç‰Œæœ¬èº«åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯ï¼Œæ— éœ€æŸ¥è¯¢æ•°æ®åº“
- **ç´§å‡‘æ€§**ï¼šä½“ç§¯å°ï¼Œé€‚åˆåœ¨HTTPå¤´éƒ¨ä¼ è¾“
- **è·¨è¯­è¨€**ï¼šåŸºäºJSONï¼Œä»»ä½•ç¼–ç¨‹è¯­è¨€éƒ½èƒ½è§£æ
- **æ— çŠ¶æ€**ï¼šæœåŠ¡å™¨ä¸ä¿å­˜ä¼šè¯ï¼Œæ˜“äºæ‰©å±•

**ğŸ“Š JWT vs ä¼ ç»ŸSessionå¯¹æ¯”**

| ç‰¹æ€§ | **ä¼ ç»ŸSession** | **JWTä»¤ç‰Œ** |
|------|----------------|------------|
| å­˜å‚¨ä½ç½® | `æœåŠ¡å™¨å†…å­˜/æ•°æ®åº“` | `å®¢æˆ·ç«¯(æµè§ˆå™¨/APP)` |
| æœåŠ¡å™¨è´Ÿæ‹… | `éœ€è¦å­˜å‚¨å’Œç®¡ç†` | `æ— éœ€å­˜å‚¨ï¼ŒåªéªŒè¯` |
| æ‰©å±•æ€§ | `å¤šæœåŠ¡å™¨éœ€è¦å…±äº«Session` | `å¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼` |
| å®‰å…¨æ€§ | `æœåŠ¡å™¨ç«¯æ§åˆ¶` | `ä¾èµ–ç­¾åå’Œè¿‡æœŸæ—¶é—´` |
| é€‚ç”¨åœºæ™¯ | `ä¼ ç»ŸWebåº”ç”¨` | `å¾®æœåŠ¡ã€ç§»åŠ¨ç«¯ã€å‰åç«¯åˆ†ç¦»` |

---

## 2. ğŸ”— JWTçš„ä¸‰æ®µå¼ç»“æ„


### 2.1 ç»“æ„æ€»è§ˆ


**JWTçš„æ ‡å‡†æ ¼å¼**
```
xxxxx.yyyyy.zzzzz
  â†“     â†“     â†“
Header.Payload.Signature
å¤´éƒ¨   è½½è·    ç­¾å
```

**ğŸ”¸ çœŸå®çš„JWTç¤ºä¾‹**
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIxMjM0NSIsInVzZXJuYW1lIjoiem
hhbmdzYW4iLCJyb2xlIjoiYWRtaW4iLCJleHAiOjE2OTUxMjM0NTZ9.SflKxwRJSMeKKF2QT4fwpM
eJf36POk6yJV_adQssw5c

â†“ ç”¨"."åˆ†éš”æˆä¸‰éƒ¨åˆ† â†“

ç¬¬ä¸€æ®µï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
ç¬¬äºŒæ®µï¼šeyJ1c2VySWQiOiIxMjM0NSIsInVzZXJuYW1lIjoiemhhbmdzYW4i...
ç¬¬ä¸‰æ®µï¼šSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

### 2.2 ä¸‰æ®µå¼ç»“æ„å›¾è§£


```
å®Œæ•´JWTä»¤ç‰Œçš„æ„æˆï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      JWT ä»¤ç‰Œ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Header     â”‚      Payload         â”‚    Signature     â”‚
â”‚   (å¤´éƒ¨)     â”‚      (è½½è·)          â”‚     (ç­¾å)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç®—æ³•ç±»å‹    â”‚ â€¢ ç”¨æˆ·ä¿¡æ¯            â”‚ â€¢ é˜²ç¯¡æ”¹æ ‡è¯†      â”‚
â”‚ â€¢ ä»¤ç‰Œç±»å‹    â”‚ â€¢ æƒé™æ•°æ®            â”‚ â€¢ æœåŠ¡å™¨éªŒè¯      â”‚
â”‚              â”‚ â€¢ è¿‡æœŸæ—¶é—´            â”‚ â€¢ ç¡®ä¿å®Œæ•´æ€§      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                  â†“                    â†“
   Base64URL         Base64URL            å¯†é’¥ç­¾å
    ç¼–ç                 ç¼–ç                (ä¸å¯é€†)
```

**ğŸ¯ ä¸‰éƒ¨åˆ†çš„è§’è‰²åˆ†å·¥**

```
ğŸ“‹ Headerï¼ˆé…ç½®è¯´æ˜ä¹¦ï¼‰
ä½œç”¨ï¼šå‘Šè¯‰ç³»ç»Ÿ"æˆ‘ç”¨ä»€ä¹ˆç®—æ³•åŠ å¯†çš„"
å°±åƒï¼šäº§å“è¯´æ˜ä¹¦ä¸Šçš„"åŠ å¯†æ–¹å¼ï¼šAES-256"

ğŸ“¦ Payloadï¼ˆå®é™…è´§ç‰©ï¼‰
ä½œç”¨ï¼šå­˜æ”¾çœŸæ­£çš„ç”¨æˆ·æ•°æ®å’Œæƒé™ä¿¡æ¯
å°±åƒï¼šå¿«é€’åŒ…è£¹é‡Œçš„å®é™…å•†å“

ğŸ”’ Signatureï¼ˆé˜²ä¼ªç­¾åï¼‰
ä½œç”¨ï¼šç¡®ä¿æ•°æ®æ²¡è¢«ç¯¡æ”¹
å°±åƒï¼šå¿«é€’å•ä¸Šçš„æ¡å½¢ç ï¼Œæ‰«ä¸€ä¸‹å°±çŸ¥é“çœŸå‡
```

---

## 3. ğŸ“‹ Headerå¤´éƒ¨è¯¦è§£


### 3.1 Headerçš„ä½œç”¨


> ğŸ” **Headeræ˜¯ä»€ä¹ˆï¼Ÿ**  
> Headerå°±åƒ**é…æ–¹è¯´æ˜**ï¼Œå‘Šè¯‰æ¥æ”¶æ–¹"è¿™ä¸ªJWTç”¨ä»€ä¹ˆç®—æ³•åˆ¶ä½œçš„ã€æ˜¯ä»€ä¹ˆç±»å‹çš„ä»¤ç‰Œ"

**HeaderåŸºæœ¬ç»“æ„**
```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

### 3.2 Headerå­—æ®µè¯¦è§£


**ğŸ”¸ algï¼ˆç®—æ³•å­—æ®µï¼‰**

å¸¸è§çš„ç­¾åç®—æ³•ï¼š
```
å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆåŒä¸€ä¸ªå¯†é’¥ï¼‰ï¼š
â€¢ HS256ï¼šHMAC + SHA256ï¼Œæœ€å¸¸ç”¨
â€¢ HS384ï¼šHMAC + SHA384
â€¢ HS512ï¼šHMAC + SHA512

éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆå…¬é’¥ç§é’¥ï¼‰ï¼š
â€¢ RS256ï¼šRSA + SHA256
â€¢ ES256ï¼šæ¤­åœ†æ›²çº¿ + SHA256

é€‰æ‹©åŸåˆ™ï¼š
ğŸŸ¢ HS256ï¼šç®€å•å¿«é€Ÿï¼Œé€‚åˆå•ä½“åº”ç”¨
ğŸŸ¡ RS256ï¼šå®‰å…¨æ€§é«˜ï¼Œé€‚åˆå¾®æœåŠ¡æ¶æ„
```

**ğŸ”¸ typï¼ˆç±»å‹å­—æ®µï¼‰**

```
typ: "JWT" â†’ è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªJWTä»¤ç‰Œ
ä½œç”¨ï¼šè®©æ¥æ”¶æ–¹çŸ¥é“å¦‚ä½•è§£æè¿™ä¸ªä»¤ç‰Œ
```

### 3.3 Headerç¼–ç è¿‡ç¨‹


**ç¼–ç æ­¥éª¤æ¼”ç¤º**
```
æ­¥éª¤1ï¼šåŸå§‹Headerï¼ˆJSONæ ¼å¼ï¼‰
{
  "alg": "HS256",
  "typ": "JWT"
}

æ­¥éª¤2ï¼šè½¬ä¸ºç´§å‡‘JSONï¼ˆå»æ‰ç©ºæ ¼æ¢è¡Œï¼‰
{"alg":"HS256","typ":"JWT"}

æ­¥éª¤3ï¼šBase64URLç¼–ç 
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9

âœ… è¿™å°±æ˜¯JWTçš„ç¬¬ä¸€éƒ¨åˆ†ï¼
```

---

## 4. ğŸ“¦ Payloadè½½è·è¯¦è§£


### 4.1 Payloadçš„æœ¬è´¨


> ğŸ’¡ **Payloadæ˜¯ä»€ä¹ˆï¼Ÿ**  
> Payloadæ˜¯**æ•°æ®è´§ç®±**ï¼Œè£…ç€ç”¨æˆ·ä¿¡æ¯ã€æƒé™ã€è¿‡æœŸæ—¶é—´ç­‰æ ¸å¿ƒæ•°æ®ã€‚å°±åƒå¿«é€’åŒ…è£¹é‡Œçš„å®é™…å•†å“ã€‚

**Payloadçš„ç»„æˆ**
```
Payload = æ ‡å‡†å£°æ˜ + è‡ªå®šä¹‰æ•°æ®

æ ‡å‡†å£°æ˜ï¼šJWTè§„èŒƒå®šä¹‰çš„å­—æ®µ
è‡ªå®šä¹‰æ•°æ®ï¼šä½ è‡ªå·±æ·»åŠ çš„ä¸šåŠ¡ä¿¡æ¯
```

### 4.2 æ ‡å‡†å£°æ˜å­—æ®µï¼ˆRegistered Claimsï¼‰


**ğŸ”¸ å¸¸ç”¨çš„7ä¸ªæ ‡å‡†å­—æ®µ**

| å­—æ®µå | å…¨ç§° | **å«ä¹‰** | **ç¤ºä¾‹** |
|-------|------|---------|---------|
| `iss` | Issuer | `ç­¾å‘è€…ï¼Œè°ç”Ÿæˆçš„ä»¤ç‰Œ` | `"auth.company.com"` |
| `sub` | Subject | `ä¸»é¢˜ï¼Œä»¤ç‰Œé¢å‘çš„ç”¨æˆ·` | `"user123"` |
| `aud` | Audience | `æ¥æ”¶æ–¹ï¼Œè°èƒ½ç”¨è¿™ä¸ªä»¤ç‰Œ` | `"api.company.com"` |
| `exp` | Expiration | `è¿‡æœŸæ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰` | `1695123456` |
| `nbf` | Not Before | `ç”Ÿæ•ˆæ—¶é—´ï¼ˆè¿™ä¹‹å‰ä¸èƒ½ç”¨ï¼‰` | `1695120000` |
| `iat` | Issued At | `ç­¾å‘æ—¶é—´` | `1695120000` |
| `jti` | JWT ID | `ä»¤ç‰Œå”¯ä¸€æ ‡è¯†` | `"abc123"` |

**å®é™…åº”ç”¨ç¤ºä¾‹**
```json
{
  "iss": "auth-service",           // è®¤è¯æœåŠ¡ç­¾å‘
  "sub": "user_12345",             // ç»™ç”¨æˆ·12345ç”¨çš„
  "aud": "api-gateway",            // APIç½‘å…³æ¥æ”¶
  "exp": 1695130000,               // 2å°æ—¶åè¿‡æœŸ
  "iat": 1695123000                // ç°åœ¨ç­¾å‘
}
```

### 4.3 è‡ªå®šä¹‰å£°æ˜ï¼ˆPrivate Claimsï¼‰


**ğŸ”¸ ä½ å¯ä»¥æ·»åŠ çš„ä¸šåŠ¡æ•°æ®**

```json
{
  // æ ‡å‡†å­—æ®µ
  "exp": 1695130000,
  "iat": 1695123000,
  
  // è‡ªå®šä¹‰å­—æ®µï¼ˆä½ çš„ä¸šåŠ¡æ•°æ®ï¼‰
  "userId": "12345",
  "username": "zhangsan",
  "email": "zhangsan@example.com",
  "role": "admin",
  "permissions": ["read", "write", "delete"],
  "department": "æŠ€æœ¯éƒ¨"
}
```

**âš ï¸ é‡è¦æé†’**
```
âŒ ä¸è¦å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼š
- å¯†ç ï¼ˆæ˜æ–‡æˆ–åŠ å¯†éƒ½ä¸è¡Œï¼‰
- ä¿¡ç”¨å¡å·
- èº«ä»½è¯å·
- å…¶ä»–éšç§æ•°æ®

âœ… é€‚åˆå­˜æ”¾çš„æ•°æ®ï¼š
- ç”¨æˆ·ID
- ç”¨æˆ·å
- è§’è‰²æƒé™
- éæ•æ„Ÿçš„åŸºæœ¬ä¿¡æ¯

åŸå› ï¼šPayloadåªæ˜¯Base64ç¼–ç ï¼Œä¸æ˜¯åŠ å¯†ï¼
ä»»ä½•äººéƒ½å¯ä»¥è§£ç çœ‹åˆ°å†…å®¹ã€‚
```

### 4.4 Payloadç¼–ç è¿‡ç¨‹


**å®Œæ•´ç¤ºä¾‹**
```
æ­¥éª¤1ï¼šå‡†å¤‡Payloadæ•°æ®
{
  "userId": "12345",
  "username": "zhangsan",
  "role": "admin",
  "exp": 1695130000
}

æ­¥éª¤2ï¼šè½¬ä¸ºç´§å‡‘JSON
{"userId":"12345","username":"zhangsan","role":"admin","exp":1695130000}

æ­¥éª¤3ï¼šBase64URLç¼–ç 
eyJ1c2VySWQiOiIxMjM0NSIsInVzZXJuYW1lIjoiemhhbmdzYW4iLCJyb2xlIjoiYWRta
W4iLCJleHAiOjE2OTUxMzAwMDB9

âœ… è¿™å°±æ˜¯JWTçš„ç¬¬äºŒéƒ¨åˆ†ï¼
```

---

## 5. ğŸ”’ Signatureç­¾åè¯¦è§£


### 5.1 Signatureçš„ä½œç”¨


> ğŸ” **Signatureæ˜¯ä»€ä¹ˆï¼Ÿ**  
> Signatureæ˜¯**é˜²ä¼ªå°ç« **ï¼Œç¡®ä¿JWTæ²¡è¢«ç¯¡æ”¹ã€‚å°±åƒå…¬æ–‡ä¸Šçš„çº¢ç« ï¼Œå‡ç« ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ã€‚

**ç­¾åçš„æ ¸å¿ƒç›®çš„**
```
ç›®çš„1ï¼šéªŒè¯å®Œæ•´æ€§
â†’ ç¡®ä¿Headerå’ŒPayloadæ²¡è¢«ä¿®æ”¹

ç›®çš„2ï¼šéªŒè¯æ¥æº
â†’ ç¡®ä¿ä»¤ç‰Œæ˜¯å¯ä¿¡æœåŠ¡å™¨ç­¾å‘çš„

ç›®çš„3ï¼šé˜²æ­¢ä¼ªé€ 
â†’ æ²¡æœ‰å¯†é’¥æ— æ³•ç”Ÿæˆæœ‰æ•ˆç­¾å
```

### 5.2 ç­¾åç”Ÿæˆè¿‡ç¨‹


**ğŸ”¸ ç­¾åç®—æ³•æµç¨‹ï¼ˆä»¥HS256ä¸ºä¾‹ï¼‰**

```
ç­¾åç”Ÿæˆå…¬å¼ï¼š
Signature = HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret_key
)
```

**è¯¦ç»†æ­¥éª¤æ¼”ç¤º**
```
æ­¥éª¤1ï¼šå‡†å¤‡å·²ç¼–ç çš„Headerå’ŒPayload
header_encoded = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"
payload_encoded = "eyJ1c2VySWQiOiIxMjM0NSIsInVzZXJuYW1lIjoiemhhbmdzYW4i..."

æ­¥éª¤2ï¼šç”¨"."æ‹¼æ¥
data = header_encoded + "." + payload_encoded

æ­¥éª¤3ï¼šä½¿ç”¨å¯†é’¥è¿›è¡ŒHMAC-SHA256è¿ç®—
secret_key = "my_super_secret_key_123"
signature = HMACSHA256(data, secret_key)

æ­¥éª¤4ï¼šBase64URLç¼–ç ç­¾åç»“æœ
signature_encoded = "SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"

âœ… è¿™å°±æ˜¯JWTçš„ç¬¬ä¸‰éƒ¨åˆ†ï¼
```

### 5.3 ç­¾åéªŒè¯è¿‡ç¨‹


**ğŸ”¸ æœåŠ¡å™¨å¦‚ä½•éªŒè¯JWTï¼Ÿ**

```
éªŒè¯æµç¨‹ï¼š

å®¢æˆ·ç«¯å‘æ¥JWTï¼š
xxxxx.yyyyy.zzzzz
  â†“
æœåŠ¡å™¨æ‰§è¡Œï¼š

1ï¸âƒ£ åˆ†ç¦»ä¸‰éƒ¨åˆ†
   header = xxxxx
   payload = yyyyy
   received_signature = zzzzz

2ï¸âƒ£ ç”¨ç›¸åŒç®—æ³•é‡æ–°è®¡ç®—ç­¾å
   data = header + "." + payload
   computed_signature = HMACSHA256(data, secret_key)

3ï¸âƒ£ æ¯”å¯¹ç­¾å
   if (computed_signature == received_signature) {
     âœ… éªŒè¯é€šè¿‡ï¼Œæ•°æ®æœªè¢«ç¯¡æ”¹
   } else {
     âŒ éªŒè¯å¤±è´¥ï¼Œæ•°æ®å¯èƒ½è¢«ä¿®æ”¹
   }

4ï¸âƒ£ æ£€æŸ¥è¿‡æœŸæ—¶é—´
   if (payload.exp > å½“å‰æ—¶é—´) {
     âœ… ä»¤ç‰Œæœ‰æ•ˆ
   } else {
     âŒ ä»¤ç‰Œå·²è¿‡æœŸ
   }
```

### 5.4 å¯†é’¥ç®¡ç†


**ğŸ” å¯†é’¥çš„é‡è¦æ€§**

```
å¯¹ç§°åŠ å¯†ï¼ˆHS256ï¼‰ï¼š
æœåŠ¡å™¨å¯†é’¥ï¼šmy_super_secret_key_123
ç‰¹ç‚¹ï¼šç­¾åå’ŒéªŒè¯ç”¨åŒä¸€ä¸ªå¯†é’¥
é£é™©ï¼šå¯†é’¥æ³„éœ²åˆ™ç³»ç»Ÿä¸å®‰å…¨

éå¯¹ç§°åŠ å¯†ï¼ˆRS256ï¼‰ï¼š
ç§é’¥ï¼šç”¨äºç­¾åï¼ˆåªæœ‰è®¤è¯æœåŠ¡å™¨æœ‰ï¼‰
å…¬é’¥ï¼šç”¨äºéªŒè¯ï¼ˆæ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥æœ‰ï¼‰
ç‰¹ç‚¹ï¼šæ›´å®‰å…¨ï¼Œé€‚åˆåˆ†å¸ƒå¼ç³»ç»Ÿ
```

**âœ… å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ**
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥
- å®šæœŸæ›´æ¢å¯†é’¥
- ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒå¯†é’¥
- å¯†é’¥é•¿åº¦è‡³å°‘256ä½

---

## 6. ğŸ”¤ Base64URLç¼–ç æœºåˆ¶


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦Base64URLï¼Ÿ


> â“ **ä¸ºä»€ä¹ˆä¸ç›´æ¥ä¼ è¾“JSONï¼Ÿ**  
> å› ä¸ºJSONåŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆç©ºæ ¼ã€å¼•å·ã€æ¢è¡Œï¼‰ï¼Œåœ¨URLä¸­ä¼ è¾“ä¼šå‡ºé—®é¢˜ã€‚Base64URLå°±æ˜¯è®©æ•°æ®"URLå®‰å…¨"ã€‚

**é—®é¢˜åœºæ™¯**
```
åŸå§‹JSONï¼š
{"userId":"12345", "username":"å¼ ä¸‰"}

âŒ ç›´æ¥æ”¾URLä¸­çš„é—®é¢˜ï¼š
http://api.com/data?token={"userId":"12345", "username":"å¼ ä¸‰"}
â†‘ ç©ºæ ¼ã€å¼•å·ã€ä¸­æ–‡éƒ½ä¼šå¯¼è‡´URLè§£æé”™è¯¯

âœ… Base64URLç¼–ç åï¼š
http://api.com/data?token=eyJ1c2VySWQiOiIxMjM0NSIsInVzZXJu...
â†‘ åªæœ‰å­—æ¯æ•°å­—å’Œ-_ï¼Œå®Œå…¨URLå®‰å…¨
```

### 6.2 Base64 vs Base64URL


**ğŸ”¸ ä¸¤ç§ç¼–ç çš„åŒºåˆ«**

| ç‰¹æ€§ | **Base64** | **Base64URL** |
|------|-----------|--------------|
| å­—ç¬¦é›† | `A-Z, a-z, 0-9, +, /` | `A-Z, a-z, 0-9, -, _` |
| å¡«å……ç¬¦ | `=` | `å»æ‰=` |
| URLå®‰å…¨ | `âŒ ä¸å®‰å…¨ï¼ˆ+å’Œ/æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼‰` | `âœ… å®Œå…¨å®‰å…¨` |
| ä½¿ç”¨åœºæ™¯ | `é‚®ä»¶ã€æ–‡ä»¶` | `JWTã€URLå‚æ•°` |

**æ›¿æ¢è§„åˆ™**
```
Base64    â†’    Base64URL
   +      â†’       -
   /      â†’       _
   =      â†’      åˆ é™¤
```

### 6.3 ç¼–ç è§£ç ç¤ºä¾‹


**ğŸ”¸ ç¼–ç è¿‡ç¨‹**
```
åŸå§‹æ•°æ®ï¼š{"alg":"HS256","typ":"JWT"}

1. è½¬äºŒè¿›åˆ¶
2. æ¯6ä½ä¸€ç»„è½¬Base64å­—ç¬¦
3. æ›¿æ¢URLä¸å®‰å…¨å­—ç¬¦
4. å»æ‰å¡«å……ç¬¦=

ç»“æœï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
```

**ğŸ”¸ è§£ç è¿‡ç¨‹**
```java
// Javaç¤ºä¾‹
String encoded = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9";

// æ–¹æ³•1ï¼šä½¿ç”¨Java 8+å†…ç½®æ–¹æ³•
byte[] decoded = Base64.getUrlDecoder().decode(encoded);
String json = new String(decoded, StandardCharsets.UTF_8);
// ç»“æœï¼š{"alg":"HS256","typ":"JWT"}

// æ–¹æ³•2ï¼šæ‰‹åŠ¨è§£ç ï¼ˆç†è§£åŸç†ï¼‰
String withPadding = encoded;
// å¦‚æœé•¿åº¦ä¸æ˜¯4çš„å€æ•°ï¼Œè¡¥=
while (withPadding.length() % 4 != 0) {
    withPadding += "=";
}
byte[] bytes = Base64.getDecoder().decode(
    withPadding.replace('-', '+').replace('_', '/')
);
```

**âš ï¸ é‡è¦æé†’**
```
Base64URLåªæ˜¯ç¼–ç ï¼Œä¸æ˜¯åŠ å¯†ï¼

ç¼–ç  â‰  åŠ å¯†
â€¢ ç¼–ç ï¼šæ•°æ®æ ¼å¼è½¬æ¢ï¼Œå¯é€†
â€¢ åŠ å¯†ï¼šæ•°æ®å†…å®¹ä¿æŠ¤ï¼Œéœ€è¦å¯†é’¥æ‰èƒ½è§£å¼€

ä»»ä½•äººéƒ½å¯ä»¥è§£ç JWTçš„Headerå’ŒPayload
åªæœ‰ç­¾åéƒ¨åˆ†èƒ½ä¿è¯æ•°æ®æ²¡è¢«ç¯¡æ”¹
```

---

## 7. ğŸ”„ JWTå®Œæ•´å·¥ä½œæµç¨‹


### 7.1 JWTç”Ÿå‘½å‘¨æœŸ


**ğŸ”¸ ä»ç”Ÿæˆåˆ°éªŒè¯çš„å®Œæ•´è¿‡ç¨‹**

```
æ•´ä½“æµç¨‹å›¾ï¼š

ç”¨æˆ·           è®¤è¯æœåŠ¡å™¨              ä¸šåŠ¡æœåŠ¡å™¨
  |                |                      |
  |--[1]ç™»å½•è¯·æ±‚--->|                      |
  |  (ç”¨æˆ·å+å¯†ç )  |                      |
  |                |                      |
  |                |--[2]éªŒè¯ç”¨æˆ·--------->|æ•°æ®åº“
  |                |<--[3]è¿”å›ç”¨æˆ·ä¿¡æ¯-----|
  |                |                      |
  |                |--[4]ç”ŸæˆJWT------    |
  |                |  â€¢ åˆ›å»ºHeader        |
  |                |  â€¢ åˆ›å»ºPayload       |
  |                |  â€¢ ç”ŸæˆSignature     |
  |                |                      |
  |<--[5]è¿”å›JWT----|                      |
  |   (å®¢æˆ·ç«¯å­˜å‚¨)  |                      |
  |                |                      |
  |--[6]ä¸šåŠ¡è¯·æ±‚------------------------>  |
  |  (æºå¸¦JWT)                            |
  |                                       |
  |                               [7]éªŒè¯JWT
  |                               â€¢ åˆ†ç¦»ä¸‰éƒ¨åˆ†
  |                               â€¢ éªŒè¯ç­¾å
  |                               â€¢ æ£€æŸ¥è¿‡æœŸ
  |                                       |
  |<--[8]è¿”å›ä¸šåŠ¡æ•°æ®---------------------|
  |                                       |
```

### 7.2 ç”ŸæˆJWTçš„è¯¦ç»†æ­¥éª¤


**Step 1ï¼šç”¨æˆ·ç™»å½•è®¤è¯**
```java
// ç”¨æˆ·æäº¤ç™»å½•ä¿¡æ¯
POST /auth/login
{
  "username": "zhangsan",
  "password": "123456"
}

// æœåŠ¡å™¨éªŒè¯ç”¨æˆ·åå¯†ç 
if (ç”¨æˆ·å­˜åœ¨ && å¯†ç æ­£ç¡®) {
  // ç»§ç»­ç”ŸæˆJWT
}
```

**Step 2ï¼šæ„å»ºHeader**
```java
Map<String, Object> header = new HashMap<>();
header.put("alg", "HS256");
header.put("typ", "JWT");

String headerJson = JSONUtil.toJsonStr(header);
String headerEncoded = Base64.getUrlEncoder()
    .withoutPadding()
    .encodeToString(headerJson.getBytes());
// ç»“æœï¼šeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
```

**Step 3ï¼šæ„å»ºPayload**
```java
Map<String, Object> payload = new HashMap<>();
payload.put("userId", "12345");
payload.put("username", "zhangsan");
payload.put("role", "admin");
payload.put("exp", System.currentTimeMillis() + 7200000); // 2å°æ—¶åè¿‡æœŸ

String payloadJson = JSONUtil.toJsonStr(payload);
String payloadEncoded = Base64.getUrlEncoder()
    .withoutPadding()
    .encodeToString(payloadJson.getBytes());
```

**Step 4ï¼šç”ŸæˆSignature**
```java
String data = headerEncoded + "." + payloadEncoded;
String secret = "my_super_secret_key_123";

Mac hmacSha256 = Mac.getInstance("HmacSHA256");
SecretKeySpec secretKey = new SecretKeySpec(
    secret.getBytes(), "HmacSHA256"
);
hmacSha256.init(secretKey);

byte[] signatureBytes = hmacSha256.doFinal(data.getBytes());
String signature = Base64.getUrlEncoder()
    .withoutPadding()
    .encodeToString(signatureBytes);
```

**Step 5ï¼šæ‹¼æ¥å®Œæ•´JWT**
```java
String jwt = headerEncoded + "." + payloadEncoded + "." + signature;

// è¿”å›ç»™å®¢æˆ·ç«¯
return jwt;
```

### 7.3 éªŒè¯JWTçš„è¯¦ç»†æ­¥éª¤


**å®¢æˆ·ç«¯è¯·æ±‚æºå¸¦JWT**
```java
// HTTPè¯·æ±‚å¤´
GET /api/user/profile
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2Vy...
```

**æœåŠ¡å™¨éªŒè¯æµç¨‹**
```java
// Step 1: æå–JWT
String authHeader = request.getHeader("Authorization");
String jwt = authHeader.replace("Bearer ", "");

// Step 2: åˆ†ç¦»ä¸‰éƒ¨åˆ†
String[] parts = jwt.split("\\.");
String headerEncoded = parts[0];
String payloadEncoded = parts[1];
String receivedSignature = parts[2];

// Step 3: é‡æ–°è®¡ç®—ç­¾å
String data = headerEncoded + "." + payloadEncoded;
String computedSignature = HMACSHA256(data, secret);

// Step 4: éªŒè¯ç­¾å
if (!computedSignature.equals(receivedSignature)) {
    throw new Exception("ç­¾åéªŒè¯å¤±è´¥ï¼Œä»¤ç‰Œå¯èƒ½è¢«ç¯¡æ”¹");
}

// Step 5: è§£ç Payload
byte[] payloadBytes = Base64.getUrlDecoder().decode(payloadEncoded);
String payloadJson = new String(payloadBytes);
JSONObject payload = JSON.parseObject(payloadJson);

// Step 6: æ£€æŸ¥è¿‡æœŸæ—¶é—´
long exp = payload.getLong("exp");
if (System.currentTimeMillis() > exp) {
    throw new Exception("ä»¤ç‰Œå·²è¿‡æœŸ");
}

// Step 7: æå–ç”¨æˆ·ä¿¡æ¯
String userId = payload.getString("userId");
String role = payload.getString("role");

// âœ… éªŒè¯é€šè¿‡ï¼Œç»§ç»­ä¸šåŠ¡é€»è¾‘
```

### 7.4 å®é™…åº”ç”¨æµç¨‹å›¾


**ğŸ”¸ å¾®æœåŠ¡æ¶æ„ä¸­çš„JWTæµç¨‹**

```
å‰ç«¯åº”ç”¨           ç½‘å…³            ç”¨æˆ·æœåŠ¡         è®¢å•æœåŠ¡
   |                |                |                |
   |--[1]ç™»å½•------->|                |                |
   |                |--[2]è½¬å‘------->|                |
   |                |<--[3]è¿”å›JWT----|                |
   |<--[4]è¿”å›------|                |                |
   |  (å­˜localStorage)               |                |
   |                                 |                |
   |--[5]æŸ¥è¯¢è®¢å•--->|                |                |
   |  (å¸¦JWT)       |                |                |
   |                |--[6]éªŒè¯JWT--  |                |
   |                |  âœ…ç­¾åæ­£ç¡®    |                |
   |                |  âœ…æœªè¿‡æœŸ      |                |
   |                |                |                |
   |                |--[7]è½¬å‘(å¸¦ç”¨æˆ·ID)------------->|
   |                |                |                |
   |                |<--[8]è¿”å›è®¢å•æ•°æ®---------------|
   |<--[9]è¿”å›------|                |                |
   |                                 |                |
```

**æ ¸å¿ƒä¼˜åŠ¿ä½“ç°**
```
âœ… ç½‘å…³ç»Ÿä¸€éªŒè¯JWTï¼Œä¸šåŠ¡æœåŠ¡æ— éœ€é‡å¤éªŒè¯
âœ… ç”¨æˆ·ä¿¡æ¯å·²åœ¨JWTä¸­ï¼Œæ— éœ€æŸ¥è¯¢ç”¨æˆ·æœåŠ¡
âœ… æœåŠ¡å™¨æ— éœ€å­˜å‚¨Sessionï¼Œæ˜“äºæ°´å¹³æ‰©å±•
âœ… è·¨åŸŸã€è·¨æœåŠ¡ä¼ é€’ç”¨æˆ·èº«ä»½ä¿¡æ¯
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 JWTç»“æ„è®°å¿†æ³•


```
ğŸ§  è®°å¿†å£è¯€ï¼š
å¤´è½½ç­¾ï¼Œç‚¹åˆ†ä¸‰æ®µä¼ 
å¤´è¯´æ³•ï¼Œè½½è£…è´§ï¼Œç­¾é˜²ç¯¡
ç¼–ç ä¼ è¾“çœŸæ–¹ä¾¿ï¼ŒéªŒç­¾è¿‡æœŸä¸¤é“å…³

è¯¦ç»†è§£é‡Šï¼š
â€¢ å¤´éƒ¨(Header)ï¼šè¯´æ˜ç”¨ä»€ä¹ˆç®—æ³•
â€¢ è½½è·(Payload)ï¼šè£…ç€ç”¨æˆ·æ•°æ®
â€¢ ç­¾å(Signature)ï¼šé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹
â€¢ Base64URLç¼–ç ï¼šè®©æ•°æ®URLå®‰å…¨ä¼ è¾“
â€¢ éªŒè¯ä¸¤æ­¥ï¼šå…ˆéªŒç­¾åï¼Œå†æŸ¥è¿‡æœŸ
```

### 8.2 ä¸‰éƒ¨åˆ†å¯¹ç…§è¡¨


| éƒ¨åˆ† | **ä½œç”¨** | **å†…å®¹ç¤ºä¾‹** | **å¯ä»¥è§£ç å—** |
|------|---------|-------------|--------------|
| **Header** | `è¯´æ˜ç®—æ³•å’Œç±»å‹` | `{"alg":"HS256","typ":"JWT"}` | `âœ… å¯ä»¥ï¼ˆåªæ˜¯ç¼–ç ï¼‰` |
| **Payload** | `å­˜å‚¨ç”¨æˆ·ä¿¡æ¯` | `{"userId":"123","role":"admin"}` | `âœ… å¯ä»¥ï¼ˆåªæ˜¯ç¼–ç ï¼‰` |
| **Signature** | `éªŒè¯å®Œæ•´æ€§` | `å¯†é’¥ç­¾åçš„ç»“æœ` | `âŒ ä¸å¯ä»¥ï¼ˆå•å‘åŠ å¯†ï¼‰` |

### 8.3 å…³é”®æ¦‚å¿µæ¸…å•


**ğŸ”¸ Base64URLç¼–ç **
```
ä½œç”¨ï¼šè®©æ•°æ®URLå®‰å…¨ä¼ è¾“
ç‰¹ç‚¹ï¼šå¯é€†ï¼ˆç¼–ç â‰ åŠ å¯†ï¼‰
æ›¿æ¢ï¼š+ â†’ -ï¼Œ/ â†’ _ï¼Œåˆ é™¤=
```

**ğŸ”¸ ç­¾åç®—æ³•**
```
HS256ï¼šå¯¹ç§°åŠ å¯†ï¼Œé€Ÿåº¦å¿«
RS256ï¼šéå¯¹ç§°åŠ å¯†ï¼Œæ›´å®‰å…¨
é€‰æ‹©ï¼šå•ä½“ç”¨HS256ï¼Œå¾®æœåŠ¡ç”¨RS256
```

**ğŸ”¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
âŒ ä¸è¦åœ¨Payloadå­˜å¯†ç 
âŒ ä¸è¦åœ¨Payloadå­˜æ•æ„Ÿä¿¡æ¯
âœ… ä½¿ç”¨HTTPSä¼ è¾“JWT
âœ… è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
âœ… å¯†é’¥å®šæœŸæ›´æ¢
```

### 8.4 å®é™…åº”ç”¨æ£€æŸ¥æ¸…å•


**ğŸ“‹ JWTç”Ÿæˆæ£€æŸ¥**
- [ ] HeaderåŒ…å«algå’Œtyp
- [ ] PayloadåŒ…å«å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯
- [ ] è®¾ç½®äº†expè¿‡æœŸæ—¶é—´
- [ ] ä½¿ç”¨äº†å®‰å…¨çš„å¯†é’¥
- [ ] ä¸‰éƒ¨åˆ†ç”¨"."æ­£ç¡®æ‹¼æ¥

**ğŸ“‹ JWTéªŒè¯æ£€æŸ¥**
- [ ] æå–Authorizationå¤´éƒ¨
- [ ] åˆ†ç¦»ä¸‰éƒ¨åˆ†
- [ ] é‡æ–°è®¡ç®—ç­¾åå¹¶æ¯”å¯¹
- [ ] æ£€æŸ¥è¿‡æœŸæ—¶é—´
- [ ] è§£æPayloadè·å–ç”¨æˆ·ä¿¡æ¯

### 8.5 å¸¸è§é—®é¢˜å¿«é€Ÿè§£ç­”


**â“ JWTå¯ä»¥åŠ å¯†å—ï¼Ÿ**
```
ç­”ï¼šæ ‡å‡†JWTä¸åŠ å¯†ï¼Œä½†å¯ä»¥ä½¿ç”¨JWEï¼ˆåŠ å¯†ç‰ˆJWTï¼‰
æ™®é€šJWTï¼šåªç­¾åï¼Œå†…å®¹å¯è§
JWEï¼šåŠ å¯†+ç­¾åï¼Œå†…å®¹ä¸å¯è§
```

**â“ JWTè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ**
```
æ–¹æ¡ˆ1ï¼šé‡æ–°ç™»å½•è·å–æ–°JWT
æ–¹æ¡ˆ2ï¼šä½¿ç”¨RefreshTokenåˆ·æ–°
æ–¹æ¡ˆ3ï¼šçŸ­æœŸAccessToken + é•¿æœŸRefreshToken
```

**â“ JWTèƒ½æ’¤é”€å—ï¼Ÿ**
```
é—®é¢˜ï¼šJWTæ— çŠ¶æ€ï¼ŒæœåŠ¡å™¨ä¸å­˜å‚¨
è§£å†³æ–¹æ¡ˆï¼š
â€¢ è®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´
â€¢ ç»´æŠ¤é»‘åå•ï¼ˆRedisï¼‰
â€¢ ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶
```

**ğŸ¯ æ ¸å¿ƒç†è§£**
- JWT = Header.Payload.Signature
- å‰ä¸¤éƒ¨åˆ†åªæ˜¯ç¼–ç ï¼Œä»»ä½•äººå¯è§£ç 
- ç­¾åç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œä½†ä¸ä¿å¯†
- é€‚åˆæ— çŠ¶æ€çš„åˆ†å¸ƒå¼ç³»ç»Ÿ
- åˆç†ä½¿ç”¨æ‰èƒ½å‘æŒ¥æœ€å¤§ä»·å€¼