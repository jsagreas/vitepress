---
title: 3ã€OAuth2.0åè®®æ‰©å±•
---
## ğŸ“š ç›®å½•

1. [è®¾å¤‡æˆæƒæµç¨‹](#1-è®¾å¤‡æˆæƒæµç¨‹)
2. [Tokenå†…çœæœºåˆ¶](#2-Tokenå†…çœæœºåˆ¶)
3. [Tokenæ’¤é”€æœºåˆ¶](#3-Tokenæ’¤é”€æœºåˆ¶)
4. [åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ](#4-åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ)
5. [SAMLé›†æˆæ–¹æ¡ˆ](#5-SAMLé›†æˆæ–¹æ¡ˆ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“± è®¾å¤‡æˆæƒæµç¨‹


### 1.1 ä»€ä¹ˆæ˜¯è®¾å¤‡æˆæƒæµç¨‹


**ğŸ¯ ç”Ÿæ´»åœºæ™¯ç±»æ¯”**
```
æƒ³è±¡ä½ è¦åœ¨æ™ºèƒ½ç”µè§†ä¸Šç™»å½•Netflixï¼š
ç”µè§†æ²¡æœ‰é”®ç›˜ â†’ è¾“å…¥è´¦å·å¯†ç å¾ˆéº»çƒ¦
ä½†ä½ æœ‰æ‰‹æœº â†’ æ‰‹æœºè¾“å…¥æ–¹ä¾¿

è§£å†³æ–¹æ¡ˆï¼š
1. ç”µè§†æ˜¾ç¤ºä¸€ä¸ªéªŒè¯ç 
2. ä½ ç”¨æ‰‹æœºè®¿é—®ç‰¹å®šç½‘å€
3. åœ¨æ‰‹æœºä¸Šè¾“å…¥éªŒè¯ç 
4. åœ¨æ‰‹æœºä¸Šå®Œæˆç™»å½•
5. ç”µè§†è‡ªåŠ¨è·å¾—æˆæƒ
```

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
è®¾å¤‡æˆæƒæµç¨‹ï¼ˆDevice Authorization Grantï¼‰æ˜¯OAuth2.0çš„æ‰©å±•åè®®ï¼Œä¸“é—¨ä¸º**è¾“å…¥å—é™è®¾å¤‡**è®¾è®¡çš„æˆæƒæ–¹å¼ã€‚

### 1.2 é€‚ç”¨åœºæ™¯


**âœ… å…¸å‹åº”ç”¨åœºæ™¯**

| åœºæ™¯ | è®¾å¤‡ç±»å‹ | ä¸ºä»€ä¹ˆéœ€è¦ |
|------|---------|-----------|
| ğŸ“º **æ™ºèƒ½ç”µè§†** | `æ— é”®ç›˜è®¾å¤‡` | è¾“å…¥è´¦å·å¯†ç ä¸ä¾¿ |
| ğŸ–¨ï¸ **æ™ºèƒ½æ‰“å°æœº** | `åµŒå…¥å¼è®¾å¤‡` | æ— æµè§ˆå™¨ç•Œé¢ |
| ğŸ® **æ¸¸æˆä¸»æœº** | `æ¸¸æˆè®¾å¤‡` | ç”¨é¥æ§å™¨è¾“å…¥å›°éš¾ |
| ğŸ  **IoTè®¾å¤‡** | `ç‰©è”ç½‘ç»ˆç«¯` | æ— æ˜¾ç¤ºå±æˆ–è¾“å…¥è®¾å¤‡ |
| ğŸ“¡ **æœºé¡¶ç›’** | `åª’ä½“è®¾å¤‡` | äº¤äº’èƒ½åŠ›æœ‰é™ |

### 1.3 å·¥ä½œåŸç†å›¾è§£


```
è®¾å¤‡ç«¯(ç”µè§†)          æˆæƒæœåŠ¡å™¨          ç”¨æˆ·ç«¯(æ‰‹æœº/ç”µè„‘)
    |                    |                      |
    |--[1]è¯·æ±‚è®¾å¤‡ç ----->|                      |
    |  (client_id)        |                      |
    |                    |                      |
    |<--[2]è¿”å›è®¾å¤‡ç -----|                      |
    |  device_code        |                      |
    |  user_code: A1B2    |                      |
    |  éªŒè¯URL            |                      |
    |                    |                      |
    |--[æ˜¾ç¤ºéªŒè¯ç ]------->|                      |
    |  A1B2              |                      |
    |  è®¿é—®: auth.com/device                    |
    |                    |                      |
    |                    |<--[3]ç”¨æˆ·è®¿é—®URL-----|
    |                    |                      |
    |                    |<--[4]è¾“å…¥éªŒè¯ç A1B2--|
    |                    |                      |
    |                    |<--[5]ç”¨æˆ·ç™»å½•æˆæƒ----|
    |                    |                      |
    |--[6]è½®è¯¢Token------>|                      |
    |  (device_code)      |                      |
    |                    |                      |
    |<--[7]è¿”å›Token-----|                      |
    |  access_token       |                      |
    |                    |                      |
```

### 1.4 å®ç°æ­¥éª¤è¯¦è§£


**æ­¥éª¤ 1ï¸âƒ£ï¼šè®¾å¤‡è¯·æ±‚è®¾å¤‡ç **

```java
// è®¾å¤‡ç«¯å‘èµ·è¯·æ±‚
POST /device/code
Content-Type: application/x-www-form-urlencoded

client_id=smart_tv_app
scope=video.read profile
```

**æ­¥éª¤ 2ï¸âƒ£ï¼šè·å–è®¾å¤‡ç å’Œç”¨æˆ·ç **

```json
// æœåŠ¡å™¨è¿”å›
{
  "device_code": "GmRhmhcxhwAzkoEqiMEg_DnyEysNkuNhszIySk9eS",
  "user_code": "A1B2-C3D4",
  "verification_uri": "https://auth.example.com/device",
  "expires_in": 1800,
  "interval": 5
}
```

**ğŸ“‹ å­—æ®µè¯´æ˜**
- `device_code` - è®¾å¤‡å”¯ä¸€æ ‡è¯†ç ï¼ˆé•¿å­—ç¬¦ä¸²ï¼‰
- `user_code` - ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç ï¼ˆçŸ­å°æ˜“è®°ï¼‰
- `verification_uri` - ç”¨æˆ·è®¿é—®çš„éªŒè¯ç½‘å€
- `expires_in` - éªŒè¯ç æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
- `interval` - è½®è¯¢é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰

**æ­¥éª¤ 3ï¸âƒ£ï¼šè®¾å¤‡æ˜¾ç¤ºéªŒè¯ä¿¡æ¯**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“º ç™»å½•Netflix            â”‚
â”‚                             â”‚
â”‚   è¯·åœ¨æ‰‹æœºæˆ–ç”µè„‘ä¸Šè®¿é—®:      â”‚
â”‚   https://auth.com/device   â”‚
â”‚                             â”‚
â”‚   å¹¶è¾“å…¥éªŒè¯ç :              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  A1B2-C3D4  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                             â”‚
â”‚   éªŒè¯ç 15åˆ†é’Ÿåè¿‡æœŸ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤ 4ï¸âƒ£ï¼šè®¾å¤‡è½®è¯¢Token**

```java
// è®¾å¤‡ç«¯æ¯5ç§’è½®è¯¢ä¸€æ¬¡
POST /oauth/token
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:device_code
device_code=GmRhmhcxhwAzkoEqiMEg_DnyEysNkuNhszIySk9eS
client_id=smart_tv_app
```

**å¯èƒ½çš„å“åº”ï¼š**

```json
// ç”¨æˆ·è¿˜æœªæˆæƒ - ç»§ç»­ç­‰å¾…
{
  "error": "authorization_pending",
  "error_description": "ç­‰å¾…ç”¨æˆ·æˆæƒ"
}

// ç”¨æˆ·æ‹’ç»æˆæƒ
{
  "error": "access_denied",
  "error_description": "ç”¨æˆ·æ‹’ç»äº†æˆæƒè¯·æ±‚"
}

// æˆæƒæˆåŠŸ - è¿”å›Token
{
  "access_token": "eyJhbGc...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "refresh_token": "tGzv3JOk..."
}
```

### 1.5 Spring Securityå®ç°ç¤ºä¾‹


```java
@RestController
@RequestMapping("/device")
public class DeviceAuthController {
    
    // ç”Ÿæˆè®¾å¤‡ç 
    @PostMapping("/code")
    public DeviceCodeResponse generateCode(@RequestParam String clientId) {
        String deviceCode = UUID.randomUUID().toString();
        String userCode = generateUserCode(); // A1B2-C3D4æ ¼å¼
        
        // ä¿å­˜åˆ°Redisï¼Œ15åˆ†é’Ÿè¿‡æœŸ
        redisTemplate.opsForValue()
            .set("device:" + deviceCode, userCode, 15, TimeUnit.MINUTES);
        
        return DeviceCodeResponse.builder()
            .deviceCode(deviceCode)
            .userCode(userCode)
            .verificationUri("https://auth.example.com/device")
            .expiresIn(900)
            .interval(5)
            .build();
    }
    
    // ç”¨æˆ·éªŒè¯ç éªŒè¯
    @PostMapping("/verify")
    public String verifyUserCode(@RequestParam String userCode) {
        String deviceCode = findDeviceCodeByUserCode(userCode);
        if (deviceCode != null) {
            // å¼•å¯¼ç”¨æˆ·ç™»å½•æˆæƒ
            return "redirect:/oauth/authorize?device_code=" + deviceCode;
        }
        return "éªŒè¯ç æ— æ•ˆ";
    }
    
    // ç”Ÿæˆæ˜“è¯»çš„ç”¨æˆ·ç 
    private String generateUserCode() {
        String chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
        return IntStream.range(0, 4)
            .mapToObj(i -> String.valueOf(chars.charAt(random.nextInt(chars.length()))))
            .collect(Collectors.joining()) + "-" +
            IntStream.range(0, 4)
            .mapToObj(i -> String.valueOf(chars.charAt(random.nextInt(chars.length()))))
            .collect(Collectors.joining());
    }
}
```

### 1.6 æœ€ä½³å®è·µ


> ğŸ’¡ **å®æ–½å»ºè®®**

**å®‰å…¨è€ƒè™‘ï¼š**
- âœ… ç”¨æˆ·ç è¦ç®€çŸ­æ˜“è®°ï¼ˆå¦‚ï¼š`A1B2-C3D4`ï¼‰
- âœ… è®¾å¤‡ç è¦è¶³å¤Ÿéšæœºä¸”å”¯ä¸€
- âœ… è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼ˆé€šå¸¸10-15åˆ†é’Ÿï¼‰
- âœ… é™åˆ¶è½®è¯¢é¢‘ç‡é˜²æ­¢æ»¥ç”¨

**ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼š**
- ğŸ“± æä¾›äºŒç»´ç æ‰«ææ–¹å¼
- ğŸ”— æ˜¾ç¤ºå¯ç‚¹å‡»çš„çŸ­é“¾æ¥
- â° æ˜¾ç¤ºå€’è®¡æ—¶æç¤º
- âœ… æˆæƒæˆåŠŸåè‡ªåŠ¨è·³è½¬

---

## 2. ğŸ” Tokenå†…çœæœºåˆ¶


### 2.1 ä»€ä¹ˆæ˜¯Tokenå†…çœ


**ğŸ¯ ç”Ÿæ´»åœºæ™¯ç±»æ¯”**
```
ä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼Œå‡ºç¤ºèº«ä»½è¯ï¼š
å·¥ä½œäººå‘˜ä¸æ˜¯çœ‹ä¸€çœ¼å°±ç›¸ä¿¡ â†’ è€Œæ˜¯æ‰«æéªŒè¯çœŸä¼ª
åŒæ ·é“ç†ï¼š
æœåŠ¡æ‹¿åˆ°Token â†’ ä¸èƒ½ç›´æ¥ç›¸ä¿¡ â†’ éœ€è¦å‘æˆæƒæœåŠ¡å™¨éªŒè¯
```

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
Tokenå†…çœï¼ˆToken Introspectionï¼‰æ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„TokenéªŒè¯æœºåˆ¶ï¼Œå…è®¸èµ„æºæœåŠ¡å™¨å‘æˆæƒæœåŠ¡å™¨æŸ¥è¯¢Tokençš„çŠ¶æ€å’Œä¿¡æ¯ã€‚

### 2.2 ä¸ºä»€ä¹ˆéœ€è¦å†…çœ


**â“ å¸¸è§é—®é¢˜åœºæ™¯**

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| ğŸ“ **Tokenè¢«ç¯¡æ”¹** | `å†…çœéªŒè¯å®Œæ•´æ€§` |
| â° **Tokenå·²è¿‡æœŸ** | `å®æ—¶æ£€æŸ¥æœ‰æ•ˆæœŸ` |
| ğŸš« **Tokenè¢«æ’¤é”€** | `æŸ¥è¯¢æ’¤é”€çŠ¶æ€` |
| ğŸ‘¤ **ç”¨æˆ·æƒé™å˜æ›´** | `è·å–æœ€æ–°æƒé™` |
| ğŸ” **ä¸é€æ˜Token** | `è§£æTokenå†…å®¹` |

### 2.3 å†…çœæµç¨‹å›¾è§£


```
èµ„æºæœåŠ¡å™¨           æˆæƒæœåŠ¡å™¨          Tokenå­˜å‚¨
    |                    |                  |
    |<--[1]æºå¸¦Token-----|å®¢æˆ·ç«¯             |
    |  Authorization:     |                  |
    |  Bearer xxx         |                  |
    |                    |                  |
    |--[2]å†…çœè¯·æ±‚------->|                  |
    |  token=xxx          |                  |
    |  token_type_hint    |                  |
    |                    |                  |
    |                    |--[3]æŸ¥è¯¢çŠ¶æ€----->|
    |                    |                  |
    |                    |<--[4]è¿”å›ä¿¡æ¯-----|
    |                    |                  |
    |<--[5]å†…çœå“åº”-------|                  |
    |  active: true       |                  |
    |  scope, exp, sub    |                  |
    |                    |                  |
    |--[6]éªŒè¯é€šè¿‡------->|ä¸šåŠ¡å¤„ç†           |
```

### 2.4 å†…çœè¯·æ±‚ä¸å“åº”


**ğŸ“¤ å†…çœè¯·æ±‚æ ¼å¼**

```http
POST /oauth/introspect
Authorization: Basic Y2xpZW50OnNlY3JldA==
Content-Type: application/x-www-form-urlencoded

token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
token_type_hint=access_token
```

**ğŸ“¥ å†…çœå“åº”æ ¼å¼**

```json
// Tokenæœ‰æ•ˆ
{
  "active": true,
  "scope": "read write",
  "client_id": "my_client",
  "username": "zhangsan",
  "token_type": "Bearer",
  "exp": 1672531200,
  "iat": 1672527600,
  "sub": "user123",
  "aud": "resource_server"
}

// Tokenæ— æ•ˆ
{
  "active": false
}
```

**ğŸ“‹ å“åº”å­—æ®µè¯´æ˜**

| å­—æ®µ | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `active` | Tokenæ˜¯å¦æœ‰æ•ˆ | `true/false` |
| `scope` | æˆæƒèŒƒå›´ | `"read write"` |
| `client_id` | å®¢æˆ·ç«¯ID | `"my_app"` |
| `username` | ç”¨æˆ·å | `"zhangsan"` |
| `exp` | è¿‡æœŸæ—¶é—´æˆ³ | `1672531200` |
| `sub` | ä¸»ä½“æ ‡è¯† | `"user123"` |
| `aud` | ç›®æ ‡å—ä¼— | `"api_server"` |

### 2.5 Spring Securityå®ç°


```java
@Configuration
@EnableResourceServer
public class ResourceServerConfig extends ResourceServerConfigurerAdapter {
    
    @Override
    public void configure(ResourceServerSecurityConfigurer resources) {
        resources.tokenServices(tokenServices());
    }
    
    // é…ç½®Tokenå†…çœ
    @Bean
    public ResourceServerTokenServices tokenServices() {
        RemoteTokenServices tokenServices = new RemoteTokenServices();
        tokenServices.setCheckTokenEndpointUrl(
            "http://auth-server/oauth/check_token");
        tokenServices.setClientId("resource_server");
        tokenServices.setClientSecret("secret");
        return tokenServices;
    }
}

// æˆæƒæœåŠ¡å™¨ç«¯ç‚¹
@RestController
public class IntrospectionEndpoint {
    
    @PostMapping("/oauth/introspect")
    public Map<String, Object> introspect(@RequestParam String token) {
        try {
            // è§£æToken
            Jwt jwt = jwtDecoder.decode(token);
            
            // æ£€æŸ¥æ˜¯å¦è¢«æ’¤é”€
            if (isRevoked(token)) {
                return Map.of("active", false);
            }
            
            // è¿”å›Tokenä¿¡æ¯
            return Map.of(
                "active", true,
                "scope", jwt.getClaim("scope"),
                "client_id", jwt.getClaim("client_id"),
                "username", jwt.getClaim("username"),
                "exp", jwt.getExpiresAt().getEpochSecond(),
                "sub", jwt.getSubject()
            );
        } catch (Exception e) {
            return Map.of("active", false);
        }
    }
}
```

### 2.6 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


> âš ï¸ **æ€§èƒ½æ³¨æ„äº‹é¡¹**

**é—®é¢˜ï¼š** æ¯æ¬¡è¯·æ±‚éƒ½å†…çœä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™

**è§£å†³æ–¹æ¡ˆï¼š**

```
æ–¹æ¡ˆä¸€ï¼šæœ¬åœ°ç¼“å­˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é¦–æ¬¡è¯·æ±‚ â†’ å†…çœéªŒè¯          â”‚
â”‚ 2. ç¼“å­˜ç»“æœ5åˆ†é’Ÿ                â”‚
â”‚ 3. åç»­è¯·æ±‚ â†’ è¯»ç¼“å­˜            â”‚
â”‚ 4. ç¼“å­˜è¿‡æœŸ â†’ é‡æ–°å†…çœ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ¡ˆäºŒï¼šJWTè‡ªåŒ…å«
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä½¿ç”¨JWTæ ¼å¼Token             â”‚
â”‚ 2. æœ¬åœ°éªŒè¯ç­¾å                 â”‚
â”‚ 3. ä»…å…³é”®æ“ä½œå†…çœ               â”‚
â”‚ 4. å®šæœŸåˆ·æ–°å…¬é’¥                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```java
@Component
public class CachedTokenIntrospection {
    
    @Cacheable(value = "tokenCache", key = "#token")
    public TokenInfo introspect(String token) {
        // è°ƒç”¨è¿œç¨‹å†…çœæ¥å£
        return remoteIntrospection(token);
    }
    
    // 5åˆ†é’Ÿåç¼“å­˜è‡ªåŠ¨å¤±æ•ˆ
    @CacheEvict(value = "tokenCache", allEntries = true)
    @Scheduled(fixedDelay = 300000)
    public void evictCache() {
        // å®šæœŸæ¸…ç†ç¼“å­˜
    }
}
```

---

## 3. ğŸš« Tokenæ’¤é”€æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯Tokenæ’¤é”€


**ğŸ¯ ç”Ÿæ´»åœºæ™¯ç±»æ¯”**
```
ä½ çš„é“¶è¡Œå¡ä¸¢äº†ï¼š
æ‰“ç”µè¯ç»™é“¶è¡Œ â†’ ç«‹å³æŒ‚å¤± â†’ å¡ç‰‡å¤±æ•ˆ
ä¸ç”¨ç­‰å¡ç‰‡"è‡ªç„¶è¿‡æœŸ"

åŒæ ·é“ç†ï¼š
ç”¨æˆ·é€€å‡ºç™»å½•/å‘ç°æ³„éœ² â†’ ä¸»åŠ¨æ’¤é”€Token â†’ ç«‹å³å¤±æ•ˆ
ä¸ç”¨ç­‰Tokenè¿‡æœŸæ—¶é—´åˆ°
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
Tokenæ’¤é”€ï¼ˆToken Revocationï¼‰å…è®¸å®¢æˆ·ç«¯æˆ–ç”¨æˆ·ä¸»åŠ¨ä½¿Tokenå¤±æ•ˆï¼Œå³ä½¿Tokenè¿˜åœ¨æœ‰æ•ˆæœŸå†…ã€‚

### 3.2 æ’¤é”€åœºæ™¯


**ğŸ”¸ å¸¸è§æ’¤é”€åœºæ™¯**

| åœºæ™¯ | è§¦å‘æ¡ä»¶ | æ’¤é”€å¯¹è±¡ |
|------|---------|---------|
| ğŸšª **ç”¨æˆ·ä¸»åŠ¨é€€å‡º** | `ç‚¹å‡»é€€å‡ºæŒ‰é’®` | Access Token + Refresh Token |
| ğŸ” **å¯†ç é‡ç½®** | `ä¿®æ”¹å¯†ç å` | è¯¥ç”¨æˆ·æ‰€æœ‰Token |
| ğŸš¨ **å®‰å…¨äº‹ä»¶** | `æ£€æµ‹åˆ°å¼‚å¸¸` | å¯ç–‘Token |
| ğŸ“± **è®¾å¤‡è§£ç»‘** | `ç§»é™¤æˆæƒè®¾å¤‡` | è¯¥è®¾å¤‡çš„Token |
| â° **ä¼šè¯è¶…æ—¶** | `é•¿æ—¶é—´æœªæ´»åŠ¨` | å½“å‰ä¼šè¯Token |

### 3.3 æ’¤é”€æµç¨‹å›¾è§£


```
å®¢æˆ·ç«¯              æˆæƒæœåŠ¡å™¨           Tokené»‘åå•
  |                     |                    |
  |--[1]æ’¤é”€è¯·æ±‚------->|                    |
  |  token=xxx          |                    |
  |  token_type_hint    |                    |
  |                     |                    |
  |                     |--[2]éªŒè¯Token----->|
  |                     |                    |
  |                     |--[3]åŠ å…¥é»‘åå•---->|
  |                     |                    |
  |                     |--[4]æ¸…ç†ç¼“å­˜------>|
  |                     |                    |
  |<--[5]æ’¤é”€æˆåŠŸ-------|                    |
  |  HTTP 200           |                    |
  |                     |                    |
  |--[6]åç»­è¯·æ±‚(ä½¿ç”¨è¢«æ’¤é”€Token)----------->|
  |                     |                    |
  |<--[7]æ‹’ç»è®¿é—®-------|                    |
  |  HTTP 401           |                    |
```

### 3.4 æ’¤é”€è¯·æ±‚è§„èŒƒ


**ğŸ“¤ æ’¤é”€è¯·æ±‚**

```http
POST /oauth/revoke
Authorization: Basic Y2xpZW50OnNlY3JldA==
Content-Type: application/x-www-form-urlencoded

token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
token_type_hint=access_token
```

**ğŸ“‹ å‚æ•°è¯´æ˜**
- `token` - è¦æ’¤é”€çš„Tokenï¼ˆå¿…éœ€ï¼‰
- `token_type_hint` - Tokenç±»å‹æç¤ºï¼ˆå¯é€‰ï¼‰
  - `access_token` - è®¿é—®ä»¤ç‰Œ
  - `refresh_token` - åˆ·æ–°ä»¤ç‰Œ

**ğŸ“¥ æ’¤é”€å“åº”**

```http
HTTP/1.1 200 OK

// æˆåŠŸæ’¤é”€ï¼Œè¿”å›ç©ºå“åº”ä½“
// å³ä½¿Tokenä¸å­˜åœ¨ä¹Ÿè¿”å›200ï¼ˆé¿å…ä¿¡æ¯æ³„éœ²ï¼‰
```

### 3.5 å®ç°ç­–ç•¥å¯¹æ¯”


**ğŸ”¸ å®ç°æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **é»‘åå•** | `å®æ—¶ç”Ÿæ•ˆ` `ç²¾ç¡®æ§åˆ¶` | éœ€è¦å­˜å‚¨ç©ºé—´ | ç”Ÿäº§ç¯å¢ƒæ¨è |
| **ç‰ˆæœ¬å·** | `æ‰¹é‡æ’¤é”€` `å®ç°ç®€å•` | ç²’åº¦è¾ƒç²— | å¯†ç é‡ç½®åœºæ™¯ |
| **çŸ­æœŸToken** | `è‡ªåŠ¨è¿‡æœŸ` `æ— éœ€ç»´æŠ¤` | ç”¨æˆ·ä½“éªŒå·® | é«˜å®‰å…¨åœºæ™¯ |

### 3.6 é»‘åå•å®ç°ç¤ºä¾‹


```java
@Service
public class TokenRevocationService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    // æ’¤é”€Token
    public void revokeToken(String token) {
        try {
            Jwt jwt = jwtDecoder.decode(token);
            long exp = jwt.getExpiresAt().getEpochSecond();
            long now = Instant.now().getEpochSecond();
            long ttl = exp - now;
            
            if (ttl > 0) {
                // åŠ å…¥é»‘åå•ï¼Œè¿‡æœŸæ—¶é—´=Tokenå‰©ä½™æœ‰æ•ˆæœŸ
                redisTemplate.opsForValue()
                    .set("revoked:" + token, "1", ttl, TimeUnit.SECONDS);
            }
        } catch (Exception e) {
            // Tokenæ— æ•ˆï¼Œæ— éœ€å¤„ç†
        }
    }
    
    // æ£€æŸ¥Tokenæ˜¯å¦è¢«æ’¤é”€
    public boolean isRevoked(String token) {
        return redisTemplate.hasKey("revoked:" + token);
    }
    
    // æ’¤é”€ç”¨æˆ·æ‰€æœ‰Tokenï¼ˆå¯†ç é‡ç½®åœºæ™¯ï¼‰
    public void revokeAllUserTokens(String userId) {
        // æ›´æ–°ç”¨æˆ·Tokenç‰ˆæœ¬å·
        redisTemplate.opsForValue()
            .set("user:token:version:" + userId, 
                 String.valueOf(System.currentTimeMillis()));
    }
}

// æ‹¦æˆªå™¨ä¸­éªŒè¯
@Component
public class TokenValidationInterceptor {
    
    @Autowired
    private TokenRevocationService revocationService;
    
    public boolean preHandle(HttpServletRequest request) {
        String token = extractToken(request);
        
        if (revocationService.isRevoked(token)) {
            throw new InvalidTokenException("Tokenå·²è¢«æ’¤é”€");
        }
        
        return true;
    }
}
```

### 3.7 çº§è”æ’¤é”€æœºåˆ¶


> ğŸ’¡ **å…³è”Tokenå¤„ç†**

```
æ’¤é”€Refresh Tokenæ—¶ï¼š
â”œâ”€ æŸ¥æ‰¾å…³è”çš„æ‰€æœ‰Access Token
â”œâ”€ å…¨éƒ¨åŠ å…¥é»‘åå•
â””â”€ æ¸…ç†ç›¸å…³ç¼“å­˜

æ’¤é”€Access Tokenæ—¶ï¼š
â”œâ”€ ä»…æ’¤é”€è¯¥Token
â””â”€ Refresh Tokenå¯ç»§ç»­ä½¿ç”¨ï¼ˆå¯é€‰ç­–ç•¥ï¼‰
```

```java
// çº§è”æ’¤é”€å®ç°
public void revokeRefreshToken(String refreshToken) {
    // 1. æ’¤é”€Refresh Tokenæœ¬èº«
    revokeToken(refreshToken);
    
    // 2. æŸ¥æ‰¾å¹¶æ’¤é”€æ‰€æœ‰å…³è”çš„Access Token
    String tokenFamily = extractTokenFamily(refreshToken);
    Set<String> relatedTokens = findRelatedTokens(tokenFamily);
    
    relatedTokens.forEach(this::revokeToken);
    
    // 3. æ¸…ç†Tokenå®¶æ—è®°å½•
    redisTemplate.delete("token:family:" + tokenFamily);
}
```

---

## 4. ğŸ”§ åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ


### 4.1 ä»€ä¹ˆæ˜¯åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ


**ğŸ¯ ä¼ ç»Ÿæ–¹å¼ vs åŠ¨æ€æ³¨å†Œ**

```
ä¼ ç»Ÿæ–¹å¼ï¼š
å¼€å‘è€… â†’ æ‰‹åŠ¨åœ¨åå°å¡«è¡¨ â†’ ç®¡ç†å‘˜å®¡æ ¸ â†’ è·å¾—client_id
ç¼ºç‚¹ï¼šæµç¨‹ç¹çï¼Œæ— æ³•è‡ªåŠ¨åŒ–

åŠ¨æ€æ³¨å†Œï¼š
åº”ç”¨ç¨‹åº â†’ è°ƒç”¨APIè‡ªåŠ¨æ³¨å†Œ â†’ ç«‹å³è·å¾—client_id
ä¼˜ç‚¹ï¼šè‡ªåŠ¨åŒ–ï¼Œæ”¯æŒå¤§è§„æ¨¡åº”ç”¨æ¥å…¥
```

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œï¼ˆDynamic Client Registrationï¼‰å…è®¸å®¢æˆ·ç«¯åº”ç”¨é€šè¿‡APIè‡ªåŠ¨å‘æˆæƒæœåŠ¡å™¨æ³¨å†Œï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

### 4.2 æ³¨å†Œæµç¨‹


**ğŸ“‹ æ³¨å†Œæµç¨‹å›¾**

```
å®¢æˆ·ç«¯åº”ç”¨          æˆæƒæœåŠ¡å™¨         å®¢æˆ·ç«¯å­˜å‚¨
    |                   |                  |
    |--[1]æ³¨å†Œè¯·æ±‚----->|                  |
    |  è½¯ä»¶å£°æ˜          |                  |
    |  é‡å®šå‘URI         |                  |
    |                   |                  |
    |                   |--[2]éªŒè¯ä¿¡æ¯---->|
    |                   |                  |
    |                   |--[3]ç”Ÿæˆå‡­è¯---->|
    |                   |                  |
    |<--[4]è¿”å›å‡­è¯-----|                  |
    |  client_id        |                  |
    |  client_secret    |                  |
    |  registration_token                  |
    |                   |                  |
    |--[5]ä½¿ç”¨å‡­è¯è¿›è¡ŒOAuth2æˆæƒ---------->|
```

### 4.3 æ³¨å†Œè¯·æ±‚ç¤ºä¾‹


**ğŸ“¤ æ³¨å†Œè¯·æ±‚**

```http
POST /oauth/register
Content-Type: application/json
Authorization: Bearer initial_access_token

{
  "client_name": "æˆ‘çš„åº”ç”¨",
  "redirect_uris": [
    "https://myapp.com/callback"
  ],
  "grant_types": ["authorization_code", "refresh_token"],
  "response_types": ["code"],
  "scope": "read write",
  "token_endpoint_auth_method": "client_secret_basic",
  "logo_uri": "https://myapp.com/logo.png",
  "contacts": ["dev@myapp.com"]
}
```

**ğŸ“¥ æ³¨å†Œå“åº”**

```json
{
  "client_id": "a1b2c3d4e5f6",
  "client_secret": "secret_xyz123",
  "client_id_issued_at": 1672527600,
  "client_secret_expires_at": 0,
  "registration_access_token": "reg_token_abc",
  "registration_client_uri": "https://auth.com/oauth/register/a1b2c3d4e5f6",
  "grant_types": ["authorization_code", "refresh_token"],
  "redirect_uris": ["https://myapp.com/callback"],
  "token_endpoint_auth_method": "client_secret_basic"
}
```

### 4.4 å®¢æˆ·ç«¯ç®¡ç†æ“ä½œ


**ğŸ”¸ æ”¯æŒçš„æ“ä½œ**

| æ“ä½œ | HTTPæ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|---------|------|------|
| **æ³¨å†Œ** | `POST` | `/oauth/register` | åˆ›å»ºæ–°å®¢æˆ·ç«¯ |
| **æŸ¥è¯¢** | `GET` | `/oauth/register/{client_id}` | è·å–å®¢æˆ·ç«¯ä¿¡æ¯ |
| **æ›´æ–°** | `PUT` | `/oauth/register/{client_id}` | ä¿®æ”¹å®¢æˆ·ç«¯é…ç½® |
| **åˆ é™¤** | `DELETE` | `/oauth/register/{client_id}` | æ³¨é”€å®¢æˆ·ç«¯ |

**æ›´æ–°å®¢æˆ·ç«¯ç¤ºä¾‹**

```http
PUT /oauth/register/a1b2c3d4e5f6
Authorization: Bearer reg_token_abc
Content-Type: application/json

{
  "client_id": "a1b2c3d4e5f6",
  "client_name": "æˆ‘çš„åº”ç”¨(æ–°ç‰ˆ)",
  "redirect_uris": [
    "https://myapp.com/callback",
    "https://myapp.com/oauth/callback"
  ]
}
```

### 4.5 Springå®ç°ç¤ºä¾‹


```java
@RestController
@RequestMapping("/oauth/register")
public class DynamicClientRegistration {
    
    @Autowired
    private ClientDetailsService clientDetailsService;
    
    // åŠ¨æ€æ³¨å†Œå®¢æˆ·ç«¯
    @PostMapping
    public ClientRegistrationResponse register(
            @RequestBody ClientRegistrationRequest request) {
        
        // ç”Ÿæˆå®¢æˆ·ç«¯å‡­è¯
        String clientId = generateClientId();
        String clientSecret = generateClientSecret();
        String registrationToken = generateRegistrationToken();
        
        // åˆ›å»ºå®¢æˆ·ç«¯é…ç½®
        BaseClientDetails client = new BaseClientDetails();
        client.setClientId(clientId);
        client.setClientSecret(passwordEncoder.encode(clientSecret));
        client.setAuthorizedGrantTypes(request.getGrantTypes());
        client.setRegisteredRedirectUri(
            new HashSet<>(request.getRedirectUris()));
        client.setScope(Arrays.asList(request.getScope().split(" ")));
        
        // ä¿å­˜å®¢æˆ·ç«¯
        clientDetailsService.addClientDetails(client);
        
        // ä¿å­˜æ³¨å†Œä»¤ç‰Œ
        saveRegistrationToken(clientId, registrationToken);
        
        return ClientRegistrationResponse.builder()
            .clientId(clientId)
            .clientSecret(clientSecret)
            .registrationAccessToken(registrationToken)
            .registrationClientUri("/oauth/register/" + clientId)
            .build();
    }
    
    // æŸ¥è¯¢å®¢æˆ·ç«¯ä¿¡æ¯
    @GetMapping("/{clientId}")
    public ClientDetails getClient(
            @PathVariable String clientId,
            @RequestHeader("Authorization") String token) {
        
        validateRegistrationToken(clientId, extractToken(token));
        return clientDetailsService.loadClientByClientId(clientId);
    }
}
```

### 4.6 å®‰å…¨è€ƒè™‘


> âš ï¸ **å®‰å…¨é˜²æŠ¤æªæ–½**

```
é˜²æŠ¤æªæ–½æ¸…å•ï¼š

âœ… åˆå§‹è®¿é—®ä»¤ç‰Œ
   â””â”€ æ³¨å†Œå‰éœ€è¦æä¾›åˆå§‹ä»¤ç‰Œ
   â””â”€ é™åˆ¶å¯æ³¨å†Œçš„å®¢æˆ·ç«¯æ•°é‡

âœ… é‡å®šå‘URIç™½åå•
   â””â”€ éªŒè¯URIæ ¼å¼åˆæ³•æ€§
   â””â”€ é˜²æ­¢å¼€æ”¾é‡å®šå‘æ”»å‡»

âœ… å®¢æˆ·ç«¯é…é¢é™åˆ¶
   â””â”€ é™åˆ¶æ¯ä¸ªè´¦æˆ·çš„å®¢æˆ·ç«¯æ•°é‡
   â””â”€ é™åˆ¶æ³¨å†Œé¢‘ç‡ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰

âœ… å®¡è®¡æ—¥å¿—
   â””â”€ è®°å½•æ‰€æœ‰æ³¨å†Œæ“ä½œ
   â””â”€ ç›‘æ§å¼‚å¸¸æ³¨å†Œè¡Œä¸º
```

---

## 5. ğŸ” SAMLé›†æˆæ–¹æ¡ˆ


### 5.1 SAMLæ˜¯ä»€ä¹ˆ


**ğŸ¯ OAuth2 vs SAMLå¯¹æ¯”**

```
OAuth2ï¼ˆæˆæƒåè®®ï¼‰ï¼š
ä½ ï¼šæˆ‘å…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®æˆ‘çš„ç…§ç‰‡
é‡ç‚¹ï¼šæˆæƒè®¿é—®èµ„æº

SAMLï¼ˆè®¤è¯åè®®ï¼‰ï¼š
ä½ ï¼šæˆ‘æ˜¯å¼ ä¸‰ï¼Œè¿™æ˜¯æˆ‘çš„èº«ä»½è¯æ˜
é‡ç‚¹ï¼šè¯æ˜èº«ä»½

ä¼ä¸šåœºæ™¯ï¼š
å‘˜å·¥è®¿é—®å…¬å¸å¤šä¸ªç³»ç»Ÿ â†’ åªéœ€ç™»å½•ä¸€æ¬¡ â†’ SAMLå•ç‚¹ç™»å½•(SSO)
```

**ğŸ”¸ SAMLç®€ä»‹**
SAMLï¼ˆSecurity Assertion Markup Languageï¼‰æ˜¯ä¸€ç§åŸºäºXMLçš„èº«ä»½è®¤è¯å’Œæˆæƒæ ‡å‡†ï¼Œä¸»è¦ç”¨äºä¼ä¸šçº§å•ç‚¹ç™»å½•ã€‚

### 5.2 ä¸ºä»€ä¹ˆè¦é›†æˆSAML


**ğŸ“Š é›†æˆä»·å€¼**

| åœºæ™¯ | éœ€æ±‚ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| ğŸ¢ **ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ** | ç»Ÿä¸€èº«ä»½è®¤è¯ | SAML SSO |
| ğŸ”— **è·¨åŸŸè®¿é—®** | å®‰å…¨ä¼ é€’èº«ä»½ | SAMLæ–­è¨€ |
| ğŸ¤ **ç¬¬ä¸‰æ–¹é›†æˆ** | æ ‡å‡†åŒ–å¯¹æ¥ | SAMLåè®® |
| ğŸ“± **ç§»åŠ¨åº”ç”¨** | çµæ´»æˆæƒ | OAuth2 + SAML |

### 5.3 é›†æˆæ¶æ„


**ğŸ—ï¸ SAML + OAuth2æ··åˆæ¶æ„**

```
ç”¨æˆ·æµè§ˆå™¨         OAuth2æœåŠ¡å™¨        SAMLèº«ä»½æä¾›å•†(IdP)
    |                  |                      |
    |--[1]è¯·æ±‚æˆæƒ---->|                      |
    |                  |                      |
    |<--[2]é‡å®šå‘------|                      |
    |  åˆ°SAML IdP      |                      |
    |                  |                      |
    |--[3]SAMLè®¤è¯è¯·æ±‚----------------------->|
    |                  |                      |
    |<--[4]ç™»å½•é¡µé¢-------------------------- |
    |                  |                      |
    |--[5]è¾“å…¥å‡­è¯-------------------------->|
    |                  |                      |
    |<--[6]SAMLæ–­è¨€-------------------------- |
    |  (åŒ…å«ç”¨æˆ·èº«ä»½)   |                      |
    |                  |                      |
    |--[7]æäº¤æ–­è¨€---->|                      |
    |                  |                      |
    |                  |--[8]éªŒè¯SAMLæ–­è¨€---->|
    |                  |                      |
    |<--[9]è¿”å›Token---|                      |
    |  OAuth2 Token    |                      |
```

### 5.4 é›†æˆæ–¹å¼


**æ–¹å¼ä¸€ï¼šSAMLä½œä¸ºèº«ä»½æä¾›å•†**

```java
@Configuration
public class SamlOAuth2Integration {
    
    // é…ç½®SAMLä½œä¸ºOAuth2çš„è®¤è¯æº
    @Bean
    public AuthenticationProvider samlAuthenticationProvider() {
        return new SAMLAuthenticationProvider() {
            @Override
            public Authentication authenticate(Authentication auth) {
                // 1. éªŒè¯SAMLæ–­è¨€
                SAMLCredential credential = (SAMLCredential) auth.getCredentials();
                
                // 2. æå–ç”¨æˆ·ä¿¡æ¯
                String username = credential.getNameID().getValue();
                List<String> roles = credential.getAttributeAsStringArray("role");
                
                // 3. åˆ›å»ºOAuth2è®¤è¯å¯¹è±¡
                return new OAuth2Authentication(
                    createOAuth2Request(username),
                    createUserAuthentication(username, roles)
                );
            }
        };
    }
}
```

**æ–¹å¼äºŒï¼šOAuth2å¢å¼ºSAMLæ–­è¨€**

```java
// åœ¨OAuth2 Tokenä¸­åµŒå…¥SAMLæ–­è¨€
@Component
public class SamlTokenEnhancer implements TokenEnhancer {
    
    @Override
    public OAuth2AccessToken enhance(OAuth2AccessToken token, 
                                     OAuth2Authentication auth) {
        Map<String, Object> info = new HashMap<>(token.getAdditionalInformation());
        
        // è·å–SAMLæ–­è¨€
        SAMLCredential samlCredential = getSamlCredential(auth);
        if (samlCredential != null) {
            info.put("saml_assertion", encodeSamlAssertion(samlCredential));
            info.put("saml_session_index", samlCredential.getSessionIndexes());
        }
        
        ((DefaultOAuth2AccessToken) token).setAdditionalInformation(info);
        return token;
    }
}
```

### 5.5 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹é›†æˆåœºæ™¯**

**åœºæ™¯ä¸€ï¼šä¼ä¸šå†…ç½‘SSO**
```
å‘˜å·¥è®¿é—®OAç³»ç»Ÿï¼š
1. è·³è½¬åˆ°ä¼ä¸šIdPç™»å½•
2. IdPè¿”å›SAMLæ–­è¨€
3. OAç³»ç»ŸéªŒè¯æ–­è¨€
4. ç­¾å‘OAuth2 Token
5. è®¿é—®å…¶ä»–å­ç³»ç»Ÿè‡ªåŠ¨ç™»å½•
```

**åœºæ™¯äºŒï¼šè·¨ç»„ç»‡åä½œ**
```
Aå…¬å¸å‘˜å·¥è®¿é—®Bå…¬å¸ç³»ç»Ÿï¼š
1. Aå…¬å¸ä½œä¸ºIdPæä¾›èº«ä»½
2. Bå…¬å¸ä¿¡ä»»Aå…¬å¸çš„SAMLæ–­è¨€
3. Bå…¬å¸ç­¾å‘è‡ªå·±çš„OAuth2 Token
4. å®ç°è·¨ç»„ç»‡å®‰å…¨è®¿é—®
```

### 5.6 é…ç½®ç¤ºä¾‹


```yaml
# application.yml
security:
  saml2:
    # SAMLæœåŠ¡æä¾›å•†é…ç½®
    service-provider:
      entity-id: https://myapp.com/saml/metadata
      acs-url: https://myapp.com/saml/SSO
      
    # SAMLèº«ä»½æä¾›å•†é…ç½®  
    identity-provider:
      entity-id: https://idp.company.com
      sso-url: https://idp.company.com/saml/SSO
      certificate: classpath:saml/idp-cert.pem
      
  oauth2:
    # OAuth2ä¸SAMLé›†æˆ
    authentication:
      saml-enabled: true
      saml-attribute-mapping:
        username: urn:oid:0.9.2342.19200300.100.1.1
        email: urn:oid:0.9.2342.19200300.100.1.3
        roles: urn:oid:1.3.6.1.4.1.5923.1.1.1.7
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 åè®®æ‰©å±•å¯¹æ¯”


| æ‰©å±•åè®® | æ ¸å¿ƒä»·å€¼ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ |
|---------|---------|---------|--------|
| **è®¾å¤‡æˆæƒ** | è§£å†³è¾“å…¥å—é™é—®é¢˜ | æ™ºèƒ½ç”µè§†ã€IoTè®¾å¤‡ | â­â­ |
| **Tokenå†…çœ** | å®æ—¶éªŒè¯TokençŠ¶æ€ | å¾®æœåŠ¡æ¶æ„ | â­â­â­ |
| **Tokenæ’¤é”€** | ä¸»åŠ¨åºŸæ­¢Token | å®‰å…¨äº‹ä»¶å¤„ç† | â­â­ |
| **åŠ¨æ€æ³¨å†Œ** | è‡ªåŠ¨åŒ–å®¢æˆ·ç«¯ç®¡ç† | å¼€æ”¾å¹³å° | â­â­â­â­ |
| **SAMLé›†æˆ** | ä¼ä¸šçº§èº«ä»½è”é‚¦ | ä¼ä¸šSSO | â­â­â­â­â­ |

### 6.2 æŠ€æœ¯é€‰å‹å»ºè®®


> ğŸ’¡ **é€‰å‹å†³ç­–æ ‘**

```
éœ€æ±‚åˆ†æ
    â”‚
    â”œâ”€ è¾“å…¥å—é™è®¾å¤‡ï¼Ÿ
    â”‚   â””â”€ Yes â†’ è®¾å¤‡æˆæƒæµç¨‹
    â”‚
    â”œâ”€ å¾®æœåŠ¡æ¶æ„ï¼Ÿ
    â”‚   â””â”€ Yes â†’ Tokenå†…çœ
    â”‚
    â”œâ”€ éœ€è¦å³æ—¶æ’¤é”€ï¼Ÿ
    â”‚   â””â”€ Yes â†’ Tokenæ’¤é”€æœºåˆ¶
    â”‚
    â”œâ”€ å¤§é‡å®¢æˆ·ç«¯æ¥å…¥ï¼Ÿ
    â”‚   â””â”€ Yes â†’ åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ
    â”‚
    â””â”€ ä¼ä¸šèº«ä»½é›†æˆï¼Ÿ
        â””â”€ Yes â†’ SAMLé›†æˆ
```

### 6.3 å®æ–½æ£€æŸ¥æ¸…å•


**ğŸ“ éƒ¨ç½²å‰æ£€æŸ¥**

- [ ] **è®¾å¤‡æˆæƒ**
  - [ ] ç”Ÿæˆæ˜“è¯»çš„ç”¨æˆ·ç æ ¼å¼
  - [ ] é…ç½®åˆç†çš„è½®è¯¢é—´éš”
  - [ ] è®¾ç½®éªŒè¯ç è¿‡æœŸæ—¶é—´
  - [ ] æä¾›äºŒç»´ç æ‰«æé€‰é¡¹

- [ ] **Tokenå†…çœ**  
  - [ ] å¯ç”¨ç»“æœç¼“å­˜æœºåˆ¶
  - [ ] é…ç½®å†…çœæ¥å£è®¤è¯
  - [ ] ç›‘æ§å†…çœæ¥å£æ€§èƒ½
  - [ ] å®ç°é™çº§ç­–ç•¥

- [ ] **Tokenæ’¤é”€**
  - [ ] é€‰æ‹©åˆé€‚çš„æ’¤é”€ç­–ç•¥
  - [ ] é…ç½®é»‘åå•å­˜å‚¨
  - [ ] å®ç°çº§è”æ’¤é”€é€»è¾‘
  - [ ] å®šæœŸæ¸…ç†è¿‡æœŸè®°å½•

- [ ] **åŠ¨æ€æ³¨å†Œ**
  - [ ] å®ç°åˆå§‹è®¿é—®ä»¤ç‰Œ
  - [ ] éªŒè¯é‡å®šå‘URI
  - [ ] é™åˆ¶æ³¨å†Œé¢‘ç‡
  - [ ] è®°å½•å®¡è®¡æ—¥å¿—

- [ ] **SAMLé›†æˆ**
  - [ ] é…ç½®IdPå…ƒæ•°æ®
  - [ ] éªŒè¯æ–­è¨€ç­¾å
  - [ ] æ˜ å°„ç”¨æˆ·å±æ€§
  - [ ] æµ‹è¯•å•ç‚¹ç™»å½•æµç¨‹

### 6.4 å®‰å…¨æœ€ä½³å®è·µ


> ğŸ”’ **å®‰å…¨åŠ å›ºè¦ç‚¹**

**é€šç”¨å®‰å…¨æªæ–½ï¼š**
```
âœ… ä¼ è¾“å±‚å®‰å…¨
   â””â”€ æ‰€æœ‰ç«¯ç‚¹å¼ºåˆ¶HTTPS
   â””â”€ ä½¿ç”¨TLS 1.2+ç‰ˆæœ¬

âœ… è®¿é—®æ§åˆ¶
   â””â”€ ç«¯ç‚¹æ·»åŠ å®¢æˆ·ç«¯è®¤è¯
   â””â”€ é™åˆ¶è¯·æ±‚é¢‘ç‡

âœ… æ•°æ®ä¿æŠ¤
   â””â”€ æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
   â””â”€ Tokenä½¿ç”¨å¼ºéšæœºç®—æ³•

âœ… å®¡è®¡ç›‘æ§
   â””â”€ è®°å½•å…³é”®æ“ä½œæ—¥å¿—
   â””â”€ è®¾ç½®å¼‚å¸¸å‘Šè­¦
```

### 6.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ ä¼˜åŒ–ç­–ç•¥**

| ä¼˜åŒ–ç‚¹ | ç­–ç•¥ | æ•ˆæœ |
|--------|------|------|
| å†…çœæ€§èƒ½ | ç»“æœç¼“å­˜ | å‡å°‘50%+ç½‘ç»œè¯·æ±‚ |
| æ’¤é”€æ£€æŸ¥ | Redisé›†ç¾¤ | æ¯«ç§’çº§å“åº” |
| SAMLæ–­è¨€ | å‹ç¼©ä¼ è¾“ | å‡å°‘30%å¸¦å®½ |
| åŠ¨æ€æ³¨å†Œ | å¼‚æ­¥å¤„ç† | æå‡ååé‡ |

### 6.6 æ•…éšœå¤„ç†æŒ‡å—


**ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥**

```
é—®é¢˜ï¼šè®¾å¤‡æˆæƒä¸€ç›´pending
æ’æŸ¥ï¼š
  â”œâ”€ æ£€æŸ¥ç”¨æˆ·ç æ˜¯å¦æ­£ç¡®
  â”œâ”€ éªŒè¯è½®è¯¢é—´éš”è®¾ç½®
  â””â”€ æŸ¥çœ‹æˆæƒæœåŠ¡å™¨æ—¥å¿—

é—®é¢˜ï¼šå†…çœæ¥å£è¶…æ—¶
æ’æŸ¥ï¼š
  â”œâ”€ æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
  â”œâ”€ éªŒè¯ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆ
  â””â”€ æŸ¥çœ‹æœåŠ¡å™¨è´Ÿè½½

é—®é¢˜ï¼šTokenæ’¤é”€æœªç”Ÿæ•ˆ  
æ’æŸ¥ï¼š
  â”œâ”€ ç¡®è®¤é»‘åå•åŒæ­¥
  â”œâ”€ æ£€æŸ¥ç¼“å­˜è¿‡æœŸæ—¶é—´
  â””â”€ éªŒè¯æ‹¦æˆªå™¨é…ç½®

é—®é¢˜ï¼šSAMLæ–­è¨€éªŒè¯å¤±è´¥
æ’æŸ¥ï¼š
  â”œâ”€ æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
  â”œâ”€ éªŒè¯æ—¶é’ŸåŒæ­¥
  â””â”€ æŸ¥çœ‹æ–­è¨€æ ¼å¼
```

**æ ¸å¿ƒè®°å¿†å£è¯€**
```
ğŸ¯ è®¾å¤‡æˆæƒè§£è¾“å…¥éš¾ï¼Œ
ğŸ” å†…çœéªŒè¯ä¿å®‰å…¨ã€‚
ğŸš« æ’¤é”€æœºåˆ¶é˜²æ³„éœ²ï¼Œ
ğŸ”§ åŠ¨æ€æ³¨å†Œæ˜“ç®¡ç†ã€‚
ğŸ” SAMLé›†æˆé€šä¼ä¸šï¼Œ
ğŸ“š æ‰©å±•åè®®åŠŸèƒ½å…¨ï¼
```