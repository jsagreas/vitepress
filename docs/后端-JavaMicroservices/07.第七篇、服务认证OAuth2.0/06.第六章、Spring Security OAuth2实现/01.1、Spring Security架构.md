---
title: 1ã€Spring Securityæ¶æ„
---
## ğŸ“š ç›®å½•

1. [Spring SecurityåŸºç¡€æ¶æ„](#1-spring-securityåŸºç¡€æ¶æ„)
2. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#2-æ ¸å¿ƒç»„ä»¶è¯¦è§£)
3. [è®¤è¯æµç¨‹ä¸åŸç†](#3-è®¤è¯æµç¨‹ä¸åŸç†)
4. [æˆæƒæœºåˆ¶è¯¦è§£](#4-æˆæƒæœºåˆ¶è¯¦è§£)
5. [Securityé…ç½®å®æˆ˜](#5-securityé…ç½®å®æˆ˜)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Spring SecurityåŸºç¡€æ¶æ„


### 1.1 ä»€ä¹ˆæ˜¯Spring Security


**é€šä¿—ç†è§£**ï¼šSpring Securityå°±åƒæ˜¯ä½ å®¶çš„å®‰ä¿ç³»ç»Ÿï¼Œè´Ÿè´£æ£€æŸ¥è°èƒ½è¿›é—¨ï¼ˆè®¤è¯ï¼‰ã€è°èƒ½è¿›å“ªä¸ªæˆ¿é—´ï¼ˆæˆæƒï¼‰ã€‚

```
ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š
å°åŒºé—¨ç¦ç³»ç»Ÿï¼š
1. åˆ·é—¨ç¦å¡ â†’ è®¤è¯ï¼ˆAuthenticationï¼‰ï¼šç¡®è®¤ä½ æ˜¯å°åŒºå±…æ°‘
2. ç”µæ¢¯æ¥¼å±‚æƒé™ â†’ æˆæƒï¼ˆAuthorizationï¼‰ï¼šä½ åªèƒ½å»è‡ªå·±æ¥¼å±‚
3. ä¿å®‰å·¡é€» â†’ è¿‡æ»¤å™¨é“¾ï¼ˆFilter Chainï¼‰ï¼šå¤šé“æ£€æŸ¥

Spring Security = åº”ç”¨ç¨‹åºçš„"é—¨ç¦+ä¿å®‰"ç³»ç»Ÿ
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**ï¼š
- **è®¤è¯ï¼ˆAuthenticationï¼‰**ï¼šéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œç¡®è®¤"ä½ æ˜¯è°"
- **æˆæƒï¼ˆAuthorizationï¼‰**ï¼šæ§åˆ¶è®¿é—®æƒé™ï¼Œç¡®è®¤"ä½ èƒ½åšä»€ä¹ˆ"
- **é˜²æŠ¤æ”»å‡»**ï¼šé˜²æ­¢å¸¸è§çš„Webæ”»å‡»ï¼ˆCSRFã€XSSç­‰ï¼‰

### 1.2 Spring Securityåœ¨å¾®æœåŠ¡ä¸­çš„ä½ç½®


```
å¾®æœåŠ¡æ¶æ„ä¸­çš„å®‰å…¨å±‚æ¬¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API Gatewayï¼ˆç½‘å…³ï¼‰              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚   ç»Ÿä¸€è®¤è¯ã€TokenéªŒè¯         â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“           â†“           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç”¨æˆ·æœåŠ¡    â”‚ â”‚  è®¢å•æœåŠ¡    â”‚ â”‚  å•†å“æœåŠ¡    â”‚
    â”‚ Spring       â”‚ â”‚ Spring       â”‚ â”‚ Spring       â”‚
    â”‚ Security     â”‚ â”‚ Security     â”‚ â”‚ Security     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“               â†“               â†“
    å„æœåŠ¡å†…éƒ¨ä¹Ÿæœ‰è‡ªå·±çš„æƒé™æ§åˆ¶

Spring Securityè´¯ç©¿æ•´ä¸ªæ¶æ„çš„å®‰å…¨æ§åˆ¶
```

### 1.3 Spring Securityæ¶æ„å…¨æ™¯


**ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾**ï¼š
```
HTTPè¯·æ±‚è¿›æ¥çš„å®Œæ•´æµç¨‹ï¼š

ç”¨æˆ·è¯·æ±‚
   â†“
[SecurityFilterChain è¿‡æ»¤å™¨é“¾]
   â†“                           
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. UsernamePassword      â”‚ â†’ æå–ç”¨æˆ·åå¯†ç 
â”‚    AuthenticationFilter  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. AuthenticationManager â”‚ â†’ è®¤è¯ç®¡ç†å™¨
â”‚    (è®¤è¯åè°ƒè€…)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. AuthenticationProviderâ”‚ â†’ çœŸæ­£æ‰§è¡Œè®¤è¯
â”‚    (è®¤è¯æ‰§è¡Œè€…)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. UserDetailsService    â”‚ â†’ åŠ è½½ç”¨æˆ·ä¿¡æ¯
â”‚    (ç”¨æˆ·æ•°æ®æº)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
[SecurityContext å®‰å…¨ä¸Šä¸‹æ–‡]
   â†“
å­˜å‚¨è®¤è¯ä¿¡æ¯ï¼Œä¾›åç»­ä½¿ç”¨
```

> ğŸ’¡ **æ–°æ‰‹ç†è§£è¦ç‚¹**  
> æŠŠSpring Securityæƒ³è±¡æˆæœºåœºå®‰æ£€æµç¨‹ï¼š
> - **Filter Chain** = å®‰æ£€é€šé“ï¼ˆå¤šä¸ªæ£€æŸ¥ç‚¹ï¼‰
> - **AuthenticationManager** = å®‰æ£€ä¸»ç®¡ï¼ˆåè°ƒå„é¡¹æ£€æŸ¥ï¼‰
> - **AuthenticationProvider** = å…·ä½“æ£€æŸ¥å‘˜ï¼ˆéªŒè¯èº«ä»½è¯ã€æ‰«æè¡Œæï¼‰
> - **SecurityContext** = ç™»æœºç‰Œï¼ˆé€šè¿‡å®‰æ£€åçš„å‡­è¯ï¼‰

---

## 2. ğŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£


### 2.1 SecurityContextï¼ˆå®‰å…¨ä¸Šä¸‹æ–‡ï¼‰


**å«ä¹‰**ï¼šå­˜å‚¨å½“å‰ç”¨æˆ·è®¤è¯ä¿¡æ¯çš„å®¹å™¨ï¼Œå°±åƒæ˜¯ç™»å½•åçš„"é€šè¡Œè¯"ã€‚

**ğŸ”¸ é€šä¿—è§£é‡Š**ï¼š
```
æƒ³è±¡ä½ å»æ¸¸ä¹å›­ï¼š
1. ä¹°ç¥¨è¿›é—¨ï¼ˆè®¤è¯æˆåŠŸï¼‰
2. å·¥ä½œäººå‘˜ç»™ä½ æˆ´ä¸Šæ‰‹ç¯ï¼ˆSecurityContextï¼‰
3. å‡­æ‰‹ç¯ç©å„ç§é¡¹ç›®ï¼ˆè®¿é—®å„ä¸ªæ¥å£ï¼‰
4. ç¦»å¼€æ—¶æ‘˜ä¸‹æ‰‹ç¯ï¼ˆé€€å‡ºç™»å½•ï¼‰

SecurityContext = ä½ æ‰‹ä¸Šçš„é€šè¡Œæ‰‹ç¯
```

**å®é™…ä½¿ç”¨**ï¼š
```java
// è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
Authentication auth = SecurityContextHolder.getContext().getAuthentication();
String username = auth.getName(); // è·å–ç”¨æˆ·å
Collection<? extends GrantedAuthority> authorities = auth.getAuthorities(); // è·å–æƒé™
```

**ğŸ” å…³é”®ç‰¹æ€§**ï¼š
- **çº¿ç¨‹éš”ç¦»**ï¼šæ¯ä¸ªè¯·æ±‚éƒ½æœ‰ç‹¬ç«‹çš„SecurityContextï¼Œäº’ä¸å¹²æ‰°
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šè¯·æ±‚å¼€å§‹åˆ›å»ºï¼Œè¯·æ±‚ç»“æŸé”€æ¯
- **ä¼ é€’æ–¹å¼**ï¼šé€šè¿‡ThreadLocalå®ç°ï¼Œè‡ªåŠ¨åœ¨å½“å‰çº¿ç¨‹ä¸­ä¼ é€’

### 2.2 Authenticationï¼ˆè®¤è¯å¯¹è±¡ï¼‰


**å«ä¹‰**ï¼šä»£è¡¨ä¸€æ¬¡è®¤è¯çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…å«"è°ç™»å½•äº†"ã€"å¯†ç æ˜¯ä»€ä¹ˆ"ã€"æœ‰ä»€ä¹ˆæƒé™"ã€‚

**ğŸ”¸ æ ¸å¿ƒå±æ€§è§£æ**ï¼š

| å±æ€§ | **å«ä¹‰** | **ç”Ÿæ´»ç±»æ¯”** | **ç¤ºä¾‹** |
|------|---------|------------|----------|
| `principal` | **ç”¨æˆ·ä¸»ä½“** | `èº«ä»½è¯ä¿¡æ¯` | `ç”¨æˆ·å¯¹è±¡/ç”¨æˆ·å` |
| `credentials` | **å‡­è¯ï¼ˆå¯†ç ï¼‰** | `å¯†ç /æŒ‡çº¹` | `åŠ å¯†åçš„å¯†ç ` |
| `authorities` | **æƒé™åˆ—è¡¨** | `VIPç­‰çº§` | `[ROLE_USER, ROLE_ADMIN]` |
| `authenticated` | **æ˜¯å¦å·²è®¤è¯** | `æ˜¯å¦å·²éªŒè¯èº«ä»½` | `true/false` |

**ä»£ç ç¤ºä¾‹**ï¼š
```java
public class CustomAuthentication implements Authentication {
    private String username;           // ç”¨æˆ·å
    private String password;           // å¯†ç ï¼ˆè®¤è¯åä¼šæ¸…ç©ºï¼‰
    private List<GrantedAuthority> authorities; // æƒé™åˆ—è¡¨
    private boolean authenticated;     // æ˜¯å¦å·²è®¤è¯
    
    @Override
    public String getName() {
        return username;
    }
    
    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return authorities;
    }
}
```

> âš ï¸ **å®‰å…¨æé†’**  
> è®¤è¯æˆåŠŸåï¼Œå¯†ç ï¼ˆcredentialsï¼‰ä¼šè¢«è‡ªåŠ¨æ¸…ç©ºï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ï¼

### 2.3 Authorityï¼ˆæƒé™ï¼‰


**å«ä¹‰**ï¼šç”¨æˆ·æ‹¥æœ‰çš„æ“ä½œæƒé™ï¼Œå†³å®š"èƒ½è®¿é—®å“ªäº›èµ„æº"ã€‚

**ğŸ”¸ æƒé™çš„ä¸¤ç§å½¢å¼**ï¼š

**1. è§’è‰²æƒé™ï¼ˆRole-basedï¼‰**ï¼š
```java
// åŸºäºè§’è‰²çš„æƒé™
è§’è‰²ï¼šROLE_USER, ROLE_ADMIN, ROLE_MANAGER

ä½¿ç”¨åœºæ™¯ï¼š
- ROLE_USERï¼šæ™®é€šç”¨æˆ·ï¼Œåªèƒ½æŸ¥çœ‹
- ROLE_ADMINï¼šç®¡ç†å‘˜ï¼Œå¯ä»¥å¢åˆ æ”¹æŸ¥
- ROLE_MANAGERï¼šç»ç†ï¼Œå¯ä»¥å®¡æ‰¹

é…ç½®ç¤ºä¾‹ï¼š
@PreAuthorize("hasRole('ADMIN')")
public void deleteUser(Long id) {
    // åªæœ‰ADMINè§’è‰²æ‰èƒ½åˆ é™¤ç”¨æˆ·
}
```

**2. ç»†ç²’åº¦æƒé™ï¼ˆPermission-basedï¼‰**ï¼š
```java
// åŸºäºæƒé™çš„æ§åˆ¶
æƒé™ï¼šuser:read, user:write, order:delete

ä½¿ç”¨åœºæ™¯ï¼š
- user:readï¼šå¯ä»¥æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
- user:writeï¼šå¯ä»¥ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
- order:deleteï¼šå¯ä»¥åˆ é™¤è®¢å•

é…ç½®ç¤ºä¾‹ï¼š
@PreAuthorize("hasAuthority('user:write')")
public void updateUser(User user) {
    // åªæœ‰æ‹¥æœ‰user:writeæƒé™çš„ç”¨æˆ·æ‰èƒ½ä¿®æ”¹
}
```

**ğŸ¯ å¦‚ä½•é€‰æ‹©**ï¼š
- **è§’è‰²æƒé™**ï¼šé€‚åˆç®€å•åœºæ™¯ï¼Œæƒé™ç›¸å¯¹å›ºå®š
- **ç»†ç²’åº¦æƒé™**ï¼šé€‚åˆå¤æ‚ä¸šåŠ¡ï¼Œéœ€è¦ç²¾ç»†æ§åˆ¶

### 2.4 Filter Chainï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰


**å«ä¹‰**ï¼šå¤šä¸ªå®‰å…¨æ£€æŸ¥ç‚¹ç»„æˆçš„é“¾æ¡ï¼Œè¯·æ±‚å¿…é¡»é€šè¿‡æ‰€æœ‰æ£€æŸ¥æ‰èƒ½è®¿é—®èµ„æºã€‚

**ğŸ”¸ è¿‡æ»¤å™¨é“¾å·¥ä½œæµç¨‹**ï¼š
```
HTTPè¯·æ±‚çš„"å®‰æ£€æµç¨‹"ï¼š

å®¢æˆ·ç«¯è¯·æ±‚
    â†“
[1. SecurityContextPersistenceFilter]
    â†“ æ¢å¤ä¹‹å‰çš„ç™»å½•çŠ¶æ€
[2. LogoutFilter]  
    â†“ å¤„ç†é€€å‡ºç™»å½•
[3. UsernamePasswordAuthenticationFilter]
    â†“ å¤„ç†ç”¨æˆ·åå¯†ç ç™»å½•
[4. BasicAuthenticationFilter]
    â†“ å¤„ç†HTTP Basicè®¤è¯
[5. ExceptionTranslationFilter]
    â†“ å¤„ç†è®¤è¯/æˆæƒå¼‚å¸¸
[6. FilterSecurityInterceptor]
    â†“ æœ€åçš„è®¿é—®æ§åˆ¶å†³ç­–
åˆ°è¾¾ç›®æ ‡èµ„æºï¼ˆControllerï¼‰
```

**å¸¸ç”¨è¿‡æ»¤å™¨è¯´æ˜**ï¼š

```
æ ¸å¿ƒè¿‡æ»¤å™¨èŒè´£ï¼š

ğŸ”¹ UsernamePasswordAuthenticationFilter
  ä½œç”¨ï¼šæ‹¦æˆª/loginè¯·æ±‚ï¼Œæå–ç”¨æˆ·åå¯†ç è¿›è¡Œè®¤è¯
  è§¦å‘æ—¶æœºï¼šç”¨æˆ·æäº¤ç™»å½•è¡¨å•
  
ğŸ”¹ JwtAuthenticationFilterï¼ˆè‡ªå®šä¹‰ï¼‰
  ä½œç”¨ï¼šè§£æJWT Tokenï¼ŒéªŒè¯ç”¨æˆ·èº«ä»½
  è§¦å‘æ—¶æœºï¼šæ¯æ¬¡è¯·æ±‚æºå¸¦Token
  
ğŸ”¹ ExceptionTranslationFilter
  ä½œç”¨ï¼šæ•è·è®¤è¯å¤±è´¥ã€æƒé™ä¸è¶³ç­‰å¼‚å¸¸
  è§¦å‘æ—¶æœºï¼šè®¤è¯æˆ–æˆæƒå¤±è´¥æ—¶
  
ğŸ”¹ FilterSecurityInterceptor
  ä½œç”¨ï¼šæœ€ç»ˆçš„è®¿é—®æ§åˆ¶å†³ç­–
  è§¦å‘æ—¶æœºï¼šæ‰€æœ‰è®¤è¯æˆæƒæ£€æŸ¥é€šè¿‡å
```

> ğŸ’¡ **æ–°æ‰‹ç†è§£**  
> Filter Chainå°±åƒæœºåœºå®‰æ£€çš„å¤šé“ç¨‹åºï¼š
> - ç¬¬ä¸€é“ï¼šæ£€æŸ¥èº«ä»½è¯ï¼ˆè®¤è¯ï¼‰
> - ç¬¬äºŒé“ï¼šå®‰æ£€æ‰«æï¼ˆTokenéªŒè¯ï¼‰
> - ç¬¬ä¸‰é“ï¼šæŸ¥çœ‹ç™»æœºç‰Œï¼ˆæƒé™æ£€æŸ¥ï¼‰
> - æ¯ä¸€é“éƒ½é€šè¿‡æ‰èƒ½ç™»æœº

---

## 3. ğŸ”„ è®¤è¯æµç¨‹ä¸åŸç†


### 3.1 è®¤è¯æµç¨‹å®Œæ•´è§£æ


**ğŸ”¸ ç”¨æˆ·ç™»å½•çš„å®Œæ•´æ—…ç¨‹**ï¼š
```
ç”¨æˆ·ç™»å½•è¿‡ç¨‹ï¼ˆä»¥ç”¨æˆ·åå¯†ç ç™»å½•ä¸ºä¾‹ï¼‰ï¼š

æ­¥éª¤1ï¼šç”¨æˆ·æäº¤è¡¨å•
POST /login
{
  "username": "zhangsan",
  "password": "123456"
}
    â†“
æ­¥éª¤2ï¼šè¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚
UsernamePasswordAuthenticationFilteræ‹¦æˆªåˆ°è¯·æ±‚
    â†“
æ­¥éª¤3ï¼šåˆ›å»ºæœªè®¤è¯çš„Authenticationå¯¹è±¡
new UsernamePasswordAuthenticationToken(
    "zhangsan",     // principal
    "123456",       // credentials
    null            // authoritiesï¼ˆæ­¤æ—¶ä¸ºç©ºï¼‰
)
    â†“
æ­¥éª¤4ï¼šäº¤ç»™AuthenticationManagerå¤„ç†
authenticationManager.authenticate(token)
    â†“
æ­¥éª¤5ï¼šAuthenticationManagerå§”æ‰˜ç»™Provider
æ‰¾åˆ°åˆé€‚çš„AuthenticationProvideræ‰§è¡Œè®¤è¯
    â†“
æ­¥éª¤6ï¼šProviderè°ƒç”¨UserDetailsService
userDetailsService.loadUserByUsername("zhangsan")
ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    â†“
æ­¥éª¤7ï¼šå¯†ç éªŒè¯
passwordEncoder.matches("123456", "æ•°æ®åº“å¯†ç ")
    â†“
æ­¥éª¤8ï¼šè®¤è¯æˆåŠŸï¼Œåˆ›å»ºå·²è®¤è¯çš„Authentication
new UsernamePasswordAuthenticationToken(
    userDetails,           // principalï¼ˆç”¨æˆ·è¯¦æƒ…ï¼‰
    null,                  // credentialsï¼ˆå¯†ç æ¸…ç©ºï¼‰
    userDetails.getAuthorities() // authoritiesï¼ˆæƒé™ï¼‰
)
    â†“
æ­¥éª¤9ï¼šå­˜å…¥SecurityContext
SecurityContextHolder.getContext().setAuthentication(auth)
    â†“
æ­¥éª¤10ï¼šè¿”å›æˆåŠŸå“åº”
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "zhangsan"
}
```

### 3.2 æ ¸å¿ƒè®¤è¯æ¥å£è¯¦è§£


**AuthenticationManagerï¼ˆè®¤è¯ç®¡ç†å™¨ï¼‰**ï¼š
```java
public interface AuthenticationManager {
    // å”¯ä¸€æ–¹æ³•ï¼šæ‰§è¡Œè®¤è¯
    Authentication authenticate(Authentication authentication) 
        throws AuthenticationException;
}

// ç†è§£ï¼šAuthenticationManagerå°±æ˜¯"å®‰æ£€ä¸»ç®¡"
// èŒè´£ï¼šåè°ƒå„ä¸ªProviderï¼Œä½†ä¸äº²è‡ªåŠ¨æ‰‹éªŒè¯
```

**AuthenticationProviderï¼ˆè®¤è¯æä¾›è€…ï¼‰**ï¼š
```java
public interface AuthenticationProvider {
    // æ‰§è¡Œå…·ä½“è®¤è¯é€»è¾‘
    Authentication authenticate(Authentication authentication)
        throws AuthenticationException;
    
    // æ˜¯å¦æ”¯æŒè¯¥è®¤è¯æ–¹å¼
    boolean supports(Class<?> authentication);
}

// è‡ªå®šä¹‰Providerç¤ºä¾‹
public class CustomAuthenticationProvider implements AuthenticationProvider {
    
    @Override
    public Authentication authenticate(Authentication auth) {
        String username = auth.getName();
        String password = auth.getCredentials().toString();
        
        // 1. æŸ¥è¯¢ç”¨æˆ·
        UserDetails user = userDetailsService.loadUserByUsername(username);
        
        // 2. éªŒè¯å¯†ç 
        if (passwordEncoder.matches(password, user.getPassword())) {
            // è®¤è¯æˆåŠŸ
            return new UsernamePasswordAuthenticationToken(
                user, null, user.getAuthorities()
            );
        }
        
        throw new BadCredentialsException("å¯†ç é”™è¯¯");
    }
    
    @Override
    public boolean supports(Class<?> authentication) {
        return UsernamePasswordAuthenticationToken.class
            .isAssignableFrom(authentication);
    }
}
```

**UserDetailsServiceï¼ˆç”¨æˆ·è¯¦æƒ…æœåŠ¡ï¼‰**ï¼š
```java
public interface UserDetailsService {
    // æ ¹æ®ç”¨æˆ·ååŠ è½½ç”¨æˆ·ä¿¡æ¯
    UserDetails loadUserByUsername(String username) 
        throws UsernameNotFoundException;
}

// å®é™…ä½¿ç”¨ç¤ºä¾‹
@Service
public class CustomUserDetailsService implements UserDetailsService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Override
    public UserDetails loadUserByUsername(String username) {
        // ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
        User user = userRepository.findByUsername(username)
            .orElseThrow(() -> new UsernameNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));
        
        // è½¬æ¢ä¸ºSpring Securityçš„UserDetails
        return org.springframework.security.core.userdetails.User
            .withUsername(user.getUsername())
            .password(user.getPassword()) // åŠ å¯†åçš„å¯†ç 
            .authorities(user.getRoles())  // ç”¨æˆ·æƒé™
            .accountExpired(false)
            .accountLocked(false)
            .credentialsExpired(false)
            .disabled(false)
            .build();
    }
}
```

### 3.3 è®¤è¯å¤±è´¥çš„å¼‚å¸¸å¤„ç†


**ğŸ”¸ å¸¸è§è®¤è¯å¼‚å¸¸**ï¼š

| å¼‚å¸¸ç±»å‹ | **å«ä¹‰** | **è§¦å‘åœºæ™¯** | **å¤„ç†å»ºè®®** |
|---------|---------|------------|-------------|
| `BadCredentialsException` | **å¯†ç é”™è¯¯** | `å¯†ç ä¸åŒ¹é…` | `æç¤ºç”¨æˆ·å¯†ç é”™è¯¯` |
| `UsernameNotFoundException` | **ç”¨æˆ·ä¸å­˜åœ¨** | `ç”¨æˆ·åä¸å­˜åœ¨` | `æç¤ºç”¨æˆ·åé”™è¯¯` |
| `AccountExpiredException` | **è´¦å·è¿‡æœŸ** | `è´¦å·å·²è¿‡æœŸ` | `æç¤ºç»­è´¹æˆ–è”ç³»ç®¡ç†å‘˜` |
| `DisabledException` | **è´¦å·è¢«ç¦ç”¨** | `è´¦å·è¢«å°ç¦` | `æç¤ºè”ç³»ç®¡ç†å‘˜` |
| `LockedException` | **è´¦å·è¢«é”å®š** | `å¤šæ¬¡å¯†ç é”™è¯¯` | `æç¤ºç­‰å¾…æˆ–æ‰¾å›å¯†ç ` |

**ç»Ÿä¸€å¼‚å¸¸å¤„ç†**ï¼š
```java
@RestControllerAdvice
public class SecurityExceptionHandler {
    
    @ExceptionHandler(BadCredentialsException.class)
    public ResponseEntity<?> handleBadCredentials(BadCredentialsException ex) {
        return ResponseEntity.status(401)
            .body(Map.of(
                "error", "è®¤è¯å¤±è´¥",
                "message", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
            ));
    }
    
    @ExceptionHandler(AccessDeniedException.class)
    public ResponseEntity<?> handleAccessDenied(AccessDeniedException ex) {
        return ResponseEntity.status(403)
            .body(Map.of(
                "error", "æƒé™ä¸è¶³",
                "message", "æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤èµ„æº"
            ));
    }
}
```

---

## 4. ğŸ›¡ï¸ æˆæƒæœºåˆ¶è¯¦è§£


### 4.1 æˆæƒçš„åŸºæœ¬æ¦‚å¿µ


**å«ä¹‰**ï¼šåœ¨ç¡®è®¤ç”¨æˆ·èº«ä»½åï¼Œåˆ¤æ–­ç”¨æˆ·èƒ½å¦è®¿é—®ç‰¹å®šèµ„æºã€‚

**ğŸ”¸ æˆæƒçš„ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜**ï¼š
```
1. è°åœ¨è®¿é—®ï¼Ÿ
   â†’ ä»SecurityContextä¸­è·å–å½“å‰ç”¨æˆ·

2. è®¿é—®ä»€ä¹ˆèµ„æºï¼Ÿ
   â†’ URLã€æ–¹æ³•ã€æ•°æ®ç­‰

3. æ˜¯å¦æœ‰æƒé™ï¼Ÿ
   â†’ æ£€æŸ¥ç”¨æˆ·æƒé™ä¸èµ„æºè¦æ±‚çš„æƒé™æ˜¯å¦åŒ¹é…
```

**æˆæƒæ£€æŸ¥æ—¶æœº**ï¼š
```
è¯·æ±‚å¤„ç†æµç¨‹ä¸­çš„æˆæƒæ£€æŸ¥ï¼š

HTTP Request
    â†“
è®¤è¯é€šè¿‡ï¼ˆå·²ç¡®è®¤èº«ä»½ï¼‰
    â†“
[æ–¹æ³•çº§æˆæƒæ£€æŸ¥]
@PreAuthorize("hasRole('ADMIN')")
    â†“
[URLçº§æˆæƒæ£€æŸ¥]
.requestMatchers("/admin/**").hasRole("ADMIN")
    â†“
[æ•°æ®çº§æˆæƒæ£€æŸ¥]
if (!currentUser.getId().equals(data.getOwnerId())) {
    throw new AccessDeniedException();
}
    â†“
æ‰§è¡Œä¸šåŠ¡é€»è¾‘
```

### 4.2 æƒé™é…ç½®æ–¹å¼


**ğŸ”¸ æ–¹å¼ä¸€ï¼šåŸºäºURLçš„æƒé™æ§åˆ¶**

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // å…¬å¼€æ¥å£ï¼Œæ— éœ€è®¤è¯
                .requestMatchers("/api/public/**").permitAll()
                
                // éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®
                .requestMatchers("/api/user/**").authenticated()
                
                // éœ€è¦ADMINè§’è‰²
                .requestMatchers("/api/admin/**").hasRole("ADMIN")
                
                // éœ€è¦ç‰¹å®šæƒé™
                .requestMatchers(HttpMethod.DELETE, "/api/orders/**")
                    .hasAuthority("order:delete")
                
                // å…¶ä»–è¯·æ±‚éƒ½éœ€è¦è®¤è¯
                .anyRequest().authenticated()
            );
        
        return http.build();
    }
}
```

**ğŸ”¸ æ–¹å¼äºŒï¼šåŸºäºæ–¹æ³•çš„æƒé™æ§åˆ¶**

```java
@Service
public class UserService {
    
    // åªæœ‰ADMINè§’è‰²å¯ä»¥è°ƒç”¨
    @PreAuthorize("hasRole('ADMIN')")
    public void deleteUser(Long id) {
        userRepository.deleteById(id);
    }
    
    // éœ€è¦ç‰¹å®šæƒé™
    @PreAuthorize("hasAuthority('user:write')")
    public void updateUser(User user) {
        userRepository.save(user);
    }
    
    // åªèƒ½ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯
    @PreAuthorize("#user.id == authentication.principal.id")
    public void updateOwnProfile(User user) {
        userRepository.save(user);
    }
    
    // æ–¹æ³•æ‰§è¡Œåæ£€æŸ¥ï¼ˆè¿‡æ»¤è¿”å›ç»“æœï¼‰
    @PostAuthorize("returnObject.username == authentication.name")
    public User getUserById(Long id) {
        return userRepository.findById(id).orElse(null);
    }
}
```

**ğŸ”¸ æ–¹å¼ä¸‰ï¼šSpELè¡¨è¾¾å¼æƒé™æ§åˆ¶**

```java
// SpELï¼ˆSpring Expression Languageï¼‰å¸¸ç”¨è¡¨è¾¾å¼

// 1. æ£€æŸ¥è§’è‰²
@PreAuthorize("hasRole('ADMIN')")           // æœ‰ADMINè§’è‰²
@PreAuthorize("hasAnyRole('ADMIN','USER')") // æœ‰ä»»ä¸€è§’è‰²

// 2. æ£€æŸ¥æƒé™
@PreAuthorize("hasAuthority('user:delete')") // æœ‰ç‰¹å®šæƒé™

// 3. æ£€æŸ¥å‚æ•°
@PreAuthorize("#username == authentication.name") // å‚æ•°ä¸å½“å‰ç”¨æˆ·åŒ¹é…

// 4. å¤æ‚è¡¨è¾¾å¼
@PreAuthorize("hasRole('ADMIN') or #user.id == authentication.principal.id")

// 5. è‡ªå®šä¹‰å®‰å…¨è¡¨è¾¾å¼
@PreAuthorize("@customSecurity.check(#orderId, authentication)")
```

### 4.3 åŠ¨æ€æƒé™æ§åˆ¶


**åœºæ™¯**ï¼šæƒé™é…ç½®å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚

```java
// è‡ªå®šä¹‰æƒé™åˆ¤æ–­æœåŠ¡
@Service("customSecurity")
public class CustomSecurityService {
    
    @Autowired
    private PermissionRepository permissionRepository;
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æŸä¸ªèµ„æºçš„æƒé™
    public boolean hasPermission(Authentication auth, String resource, String action) {
        String username = auth.getName();
        
        // ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·æƒé™
        List<Permission> permissions = permissionRepository
            .findByUsername(username);
        
        // æ£€æŸ¥æ˜¯å¦åŒ¹é…
        return permissions.stream()
            .anyMatch(p -> p.getResource().equals(resource) 
                && p.getAction().equals(action));
    }
}

// åœ¨Controllerä¸­ä½¿ç”¨
@RestController
public class OrderController {
    
    @GetMapping("/orders/{id}")
    @PreAuthorize("@customSecurity.hasPermission(authentication, 'order', 'read')")
    public Order getOrder(@PathVariable Long id) {
        return orderService.findById(id);
    }
}
```

---

## 5. âš™ï¸ Securityé…ç½®å®æˆ˜


### 5.1 åŸºç¡€é…ç½®ç¤ºä¾‹


```java
@Configuration
@EnableWebSecurity
@EnableMethodSecurity // å¼€å¯æ–¹æ³•çº§æƒé™æ§åˆ¶
public class SecurityConfig {
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    // å¯†ç ç¼–ç å™¨
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
    // è®¤è¯ç®¡ç†å™¨
    @Bean
    public AuthenticationManager authenticationManager(
            AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }
    
    // å®‰å…¨è¿‡æ»¤å™¨é“¾
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            // ç¦ç”¨CSRFï¼ˆå‰åç«¯åˆ†ç¦»é¡¹ç›®é€šå¸¸ç¦ç”¨ï¼‰
            .csrf(csrf -> csrf.disable())
            
            // ä¼šè¯ç®¡ç†ï¼šæ— çŠ¶æ€ï¼ˆä½¿ç”¨Tokenï¼‰
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )
            
            // æˆæƒé…ç½®
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/auth/**").permitAll()
                .requestMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            
            // å¼‚å¸¸å¤„ç†
            .exceptionHandling(ex -> ex
                .authenticationEntryPoint((request, response, authException) -> {
                    response.setStatus(401);
                    response.getWriter().write("æœªè®¤è¯");
                })
                .accessDeniedHandler((request, response, accessDeniedException) -> {
                    response.setStatus(403);
                    response.getWriter().write("æƒé™ä¸è¶³");
                })
            );
        
        return http.build();
    }
}
```

### 5.2 JWT Tokené›†æˆé…ç½®


```java
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private JwtTokenProvider tokenProvider;
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                   HttpServletResponse response,
                                   FilterChain filterChain) {
        // 1. ä»è¯·æ±‚å¤´è·å–Token
        String token = getTokenFromRequest(request);
        
        if (token != null && tokenProvider.validateToken(token)) {
            // 2. ä»Tokenä¸­æå–ç”¨æˆ·å
            String username = tokenProvider.getUsernameFromToken(token);
            
            // 3. åŠ è½½ç”¨æˆ·è¯¦æƒ…
            UserDetails userDetails = userDetailsService
                .loadUserByUsername(username);
            
            // 4. åˆ›å»ºè®¤è¯å¯¹è±¡
            UsernamePasswordAuthenticationToken authentication = 
                new UsernamePasswordAuthenticationToken(
                    userDetails, null, userDetails.getAuthorities()
                );
            
            // 5. å­˜å…¥SecurityContext
            SecurityContextHolder.getContext()
                .setAuthentication(authentication);
        }
        
        filterChain.doFilter(request, response);
    }
    
    private String getTokenFromRequest(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
}
```

### 5.3 å®Œæ•´çš„è®¤è¯æµç¨‹å®ç°


**ç™»å½•æ¥å£**ï¼š
```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {
    
    @Autowired
    private AuthenticationManager authenticationManager;
    
    @Autowired
    private JwtTokenProvider tokenProvider;
    
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest request) {
        // 1. åˆ›å»ºè®¤è¯å¯¹è±¡
        Authentication authentication = authenticationManager.authenticate(
            new UsernamePasswordAuthenticationToken(
                request.getUsername(),
                request.getPassword()
            )
        );
        
        // 2. è®¤è¯æˆåŠŸï¼Œå­˜å…¥ä¸Šä¸‹æ–‡
        SecurityContextHolder.getContext().setAuthentication(authentication);
        
        // 3. ç”ŸæˆJWT Token
        String token = tokenProvider.generateToken(authentication);
        
        // 4. è¿”å›Token
        return ResponseEntity.ok(new JwtResponse(token));
    }
    
    @GetMapping("/me")
    public ResponseEntity<?> getCurrentUser() {
        // ä»SecurityContextè·å–å½“å‰ç”¨æˆ·
        Authentication auth = SecurityContextHolder.getContext()
            .getAuthentication();
        
        return ResponseEntity.ok(auth.getPrincipal());
    }
}
```

> ğŸ’¡ **é…ç½®è¦ç‚¹æ€»ç»“**  
> 1. **å¯†ç åŠ å¯†**ï¼šå¿…é¡»ä½¿ç”¨BCryptPasswordEncoderç­‰åŠ å¯†ç®—æ³•
> 2. **æ— çŠ¶æ€ä¼šè¯**ï¼šå‰åç«¯åˆ†ç¦»ä½¿ç”¨STATELESS
> 3. **TokenéªŒè¯**ï¼šè‡ªå®šä¹‰Filterè§£æJWT
> 4. **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€å¤„ç†è®¤è¯å’Œæˆæƒå¼‚å¸¸

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SecurityContextï¼šå®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨å½“å‰ç”¨æˆ·è®¤è¯ä¿¡æ¯çš„å®¹å™¨
ğŸ”¸ Authenticationï¼šè®¤è¯å¯¹è±¡ï¼ŒåŒ…å«ç”¨æˆ·èº«ä»½ã€å‡­è¯ã€æƒé™ä¿¡æ¯
ğŸ”¸ Authorityï¼šæƒé™ï¼Œå†³å®šç”¨æˆ·èƒ½è®¿é—®å“ªäº›èµ„æº
ğŸ”¸ Filter Chainï¼šè¿‡æ»¤å™¨é“¾ï¼Œå¤šé“å®‰å…¨æ£€æŸ¥çš„æ‰§è¡Œé“¾æ¡
ğŸ”¸ UserDetailsServiceï¼šç”¨æˆ·è¯¦æƒ…æœåŠ¡ï¼Œä»æ•°æ®æºåŠ è½½ç”¨æˆ·ä¿¡æ¯
```

### 6.2 è®¤è¯æˆæƒæµç¨‹è®°å¿†


**ğŸ”¹ è®¤è¯æµç¨‹ï¼ˆ5æ­¥è®°å¿†æ³•ï¼‰**ï¼š
```
1. æ‹¦æˆªï¼šFilteræ‹¦æˆªç™»å½•è¯·æ±‚
2. æå–ï¼šæå–ç”¨æˆ·åå¯†ç 
3. éªŒè¯ï¼šProvideréªŒè¯å¯†ç 
4. åŠ è½½ï¼šåŠ è½½ç”¨æˆ·æƒé™
5. å­˜å‚¨ï¼šå­˜å…¥SecurityContext
```

**ğŸ”¹ æˆæƒæ£€æŸ¥ï¼ˆ3ä¸ªå±‚æ¬¡ï¼‰**ï¼š
```
1. URLçº§åˆ«ï¼š.requestMatchers("/admin/**").hasRole("ADMIN")
2. æ–¹æ³•çº§åˆ«ï¼š@PreAuthorize("hasRole('ADMIN')")
3. æ•°æ®çº§åˆ«ï¼šä¸šåŠ¡ä»£ç ä¸­æ£€æŸ¥æ•°æ®æ‰€æœ‰æƒ
```

### 6.3 å®æˆ˜åº”ç”¨è¦ç‚¹


**âœ… é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
- [ ] å¯†ç æ˜¯å¦åŠ å¯†å­˜å‚¨ï¼ˆBCryptPasswordEncoderï¼‰
- [ ] æ˜¯å¦ç¦ç”¨ä¸å¿…è¦çš„CSRF
- [ ] ä¼šè¯ç®¡ç†æ˜¯å¦é…ç½®ä¸ºSTATELESS
- [ ] å…¬å¼€æ¥å£æ˜¯å¦é…ç½®permitAll()
- [ ] å¼‚å¸¸å¤„ç†æ˜¯å¦ç»Ÿä¸€é…ç½®
- [ ] TokenéªŒè¯Filteræ˜¯å¦æ­£ç¡®æ·»åŠ 

**âœ… å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š

| é—®é¢˜ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|------------|-------------|
| `403 Forbidden` | **æƒé™ä¸è¶³** | `æ£€æŸ¥ç”¨æˆ·è§’è‰²/æƒé™é…ç½®` |
| `401 Unauthorized` | **æœªè®¤è¯** | `æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®ä¼ é€’` |
| `å¯†ç æ€»æ˜¯é”™è¯¯` | **ç¼–ç å™¨ä¸åŒ¹é…** | `ç¡®ä¿åŠ å¯†å’ŒéªŒè¯ä½¿ç”¨åŒä¸€ç¼–ç å™¨` |
| `Filterä¸ç”Ÿæ•ˆ` | **é¡ºåºé—®é¢˜** | `ç¡®ä¿Filteråœ¨æ­£ç¡®çš„ä½ç½®` |

> ğŸ¯ **æ ¸å¿ƒè®°å¿†**  
> Spring Security = è®¤è¯ï¼ˆä½ æ˜¯è°ï¼‰+ æˆæƒï¼ˆä½ èƒ½å¹²å•¥ï¼‰  
> SecurityContextæ˜¯æ ¸å¿ƒå®¹å™¨  
> Filter Chainæ˜¯æ‰§è¡Œå…¥å£  
> Authenticationæ˜¯è®¤è¯å‡­è¯  
> Authorityæ˜¯æƒé™æ ‡è¯†

### 6.4 ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®


**ğŸ”¸ è¿›é˜¶ä¸»é¢˜**ï¼š
- OAuth2.0åè®®è¯¦è§£
- JWT Tokenæ·±å…¥ä½¿ç”¨
- å¤šç§Ÿæˆ·æƒé™éš”ç¦»
- ç»†ç²’åº¦æ•°æ®æƒé™æ§åˆ¶
- åˆ†å¸ƒå¼Sessionç®¡ç†

**ğŸ”¸ å®è·µå»ºè®®**ï¼š
- ä»ç®€å•çš„ç”¨æˆ·åå¯†ç è®¤è¯å¼€å§‹
- é€æ­¥å¼•å…¥JWT Token
- ç»ƒä¹ æ–¹æ³•çº§æƒé™æ§åˆ¶
- å°è¯•åŠ¨æ€æƒé™é…ç½®
- ç†è§£æ•´ä¸ªè®¤è¯æˆæƒæµç¨‹

---

**æ ¸å¿ƒç†å¿µ**ï¼š  
Spring Securityæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª"é—¨ç¦+ä¿å®‰"ç³»ç»Ÿï¼Œé€šè¿‡è¿‡æ»¤å™¨é“¾å®ç°å¤šé“æ£€æŸ¥ï¼Œç”¨SecurityContextå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨Authorityæ§åˆ¶è®¿é—®æƒé™ã€‚ç†è§£è¿™ä¸ªæ ¸å¿ƒæ€æƒ³ï¼Œå°±èƒ½çµæ´»è¿ç”¨Spring Securityä¿æŠ¤ä½ çš„åº”ç”¨ï¼