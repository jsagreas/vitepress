---
title: 2ã€Spring Security OAuth2ä¾èµ–
---
## ğŸ“š ç›®å½•

1. [OAuth2ä¾èµ–ä½“ç³»æ¦‚è¿°](#1-OAuth2ä¾èµ–ä½“ç³»æ¦‚è¿°)
2. [æ ¸å¿ƒä¾èµ–é…ç½®](#2-æ ¸å¿ƒä¾èµ–é…ç½®)
3. [ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†](#3-ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†)
4. [è‡ªåŠ¨é…ç½®åŸç†](#4-è‡ªåŠ¨é…ç½®åŸç†)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#5-å¸¸è§é—®é¢˜æ’æŸ¥)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ OAuth2ä¾èµ–ä½“ç³»æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Spring Security OAuth2


**ğŸ”¸ ç®€å•ç†è§£**
```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ æƒ³ç”¨å¾®ä¿¡ç™»å½•æŸä¸ªè´­ç‰©ç½‘ç«™ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯OAuth2è®¤è¯

ä¼ ç»Ÿç™»å½•ï¼šç½‘ç«™è‡ªå·±éªŒè¯ä½ çš„ç”¨æˆ·åå¯†ç 
OAuth2ç™»å½•ï¼šè®©å¾®ä¿¡å¸®å¿™éªŒè¯ä½ çš„èº«ä»½ï¼Œç„¶åå‘Šè¯‰ç½‘ç«™"è¿™ä¸ªäººæ˜¯çœŸçš„"

Spring Security OAuth2å°±æ˜¯å¸®ä½ åœ¨Javaé¡¹ç›®ä¸­å®ç°è¿™ç§"ç¬¬ä¸‰æ–¹è®¤è¯"åŠŸèƒ½çš„å·¥å…·åŒ…
```

**ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**
```
Spring Security OAuth2 = Spring Security + OAuth2åè®®

â€¢ Spring Securityï¼šè´Ÿè´£å®‰å…¨æ§åˆ¶ï¼ˆè°èƒ½è®¿é—®ä»€ä¹ˆèµ„æºï¼‰
â€¢ OAuth2ï¼šå®šä¹‰äº†å¦‚ä½•å®‰å…¨åœ°æˆæƒç¬¬ä¸‰æ–¹è®¿é—®èµ„æº
â€¢ ä¸¤è€…ç»“åˆï¼šè®©ä½ çš„å¾®æœåŠ¡æ—¢å®‰å…¨åˆæ”¯æŒç°ä»£åŒ–çš„è®¤è¯æ–¹å¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ä¾èµ–


**ğŸ” ä¾èµ–çš„ä½œç”¨**
```
ğŸ“¦ ä¾èµ–åŒ…å°±åƒæ­ç§¯æœ¨çš„é›¶ä»¶ï¼š

åŸºç¡€ä¾èµ–ï¼š
â†’ spring-boot-starter-securityï¼ˆå®‰å…¨æ¡†æ¶çš„åŸºç¡€ï¼‰
â†’ spring-boot-starter-webï¼ˆWebåŠŸèƒ½ï¼‰

OAuth2ä¾èµ–ï¼š
â†’ spring-security-oauth2-authorization-serverï¼ˆè®¤è¯æœåŠ¡å™¨ï¼‰
â†’ spring-security-oauth2-resource-serverï¼ˆèµ„æºæœåŠ¡å™¨ï¼‰
â†’ spring-security-oauth2-clientï¼ˆå®¢æˆ·ç«¯ï¼‰

æ²¡æœ‰è¿™äº›ä¾èµ– = æƒ³åšé¥­ä½†æ²¡æœ‰é”…ç¢—ç“¢ç›†
```

### 1.3 ä¾èµ–ä½“ç³»æ¶æ„


```
Spring Security OAuth2 ä¾èµ–å±‚æ¬¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Spring Boot Starter           â”‚ â† è‡ªåŠ¨é…ç½®å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Spring Security OAuth2        â”‚ â† OAuth2å®ç°å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Spring Security Core          â”‚ â† å®‰å…¨æ ¸å¿ƒå±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Spring Framework              â”‚ â† SpringåŸºç¡€å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä»ä¸Šåˆ°ä¸‹ï¼š
â€¢ ä¸Šå±‚ä¾èµ–ä¸‹å±‚
â€¢ ä¸‹å±‚æä¾›åŸºç¡€åŠŸèƒ½
â€¢ ä¸Šå±‚æä¾›ä¾¿æ·å°è£…
```

---

## 2. ğŸ“¦ æ ¸å¿ƒä¾èµ–é…ç½®


### 2.1 Mavenä¾èµ–é…ç½®


**ğŸ”¸ è®¤è¯æœåŠ¡å™¨ä¾èµ–ï¼ˆAuthorization Serverï¼‰**

> ğŸ’¡ **ä»€ä¹ˆæ˜¯è®¤è¯æœåŠ¡å™¨**ï¼šå°±æ˜¯ä¸“é—¨è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½ã€å‘æ”¾ä»¤ç‰Œçš„æœåŠ¡

```xml
<dependencies>
    <!-- Spring Boot WebåŸºç¡€ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Spring SecurityåŸºç¡€ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>
    
    <!-- OAuth2è®¤è¯æœåŠ¡å™¨æ ¸å¿ƒä¾èµ– -->
    <dependency>
        <groupId>org.springframework.security</groupId>
        <artifactId>spring-security-oauth2-authorization-server</artifactId>
        <version>1.1.3</version>
    </dependency>
</dependencies>
```

**ğŸ“‹ ä¾èµ–è¯´æ˜è¡¨**

| ä¾èµ–åç§° | **ä½œç”¨** | **æ˜¯å¦å¿…éœ€** | **é€šä¿—è§£é‡Š** |
|---------|---------|-------------|-------------|
| `spring-boot-starter-web` | WebåŠŸèƒ½æ”¯æŒ | âœ… å¿…éœ€ | æä¾›HTTPæ¥å£èƒ½åŠ›ï¼Œè®©æœåŠ¡èƒ½æ¥æ”¶è¯·æ±‚ |
| `spring-boot-starter-security` | å®‰å…¨æ¡†æ¶ | âœ… å¿…éœ€ | æä¾›ç™»å½•ã€æƒé™æ§åˆ¶ç­‰å®‰å…¨åŠŸèƒ½ |
| `spring-security-oauth2-authorization-server` | OAuth2è®¤è¯æœåŠ¡ | âœ… å¿…éœ€ | å®ç°OAuth2è®¤è¯æœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½ |

**ğŸ”¸ èµ„æºæœåŠ¡å™¨ä¾èµ–ï¼ˆResource Serverï¼‰**

> ğŸ’¡ **ä»€ä¹ˆæ˜¯èµ„æºæœåŠ¡å™¨**ï¼šå°±æ˜¯å­˜æ”¾å—ä¿æŠ¤èµ„æºï¼ˆå¦‚ç”¨æˆ·æ•°æ®ã€è®¢å•ä¿¡æ¯ï¼‰çš„æœåŠ¡

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- OAuth2èµ„æºæœåŠ¡å™¨ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-oauth2-resource-server</artifactId>
    </dependency>
</dependencies>
```

**ğŸ”¸ å®¢æˆ·ç«¯ä¾èµ–ï¼ˆOAuth2 Clientï¼‰**

> ğŸ’¡ **ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯**ï¼šå°±æ˜¯éœ€è¦è®¿é—®ç”¨æˆ·èµ„æºçš„åº”ç”¨ï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹è´­ç‰©ç½‘ç«™

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- OAuth2å®¢æˆ·ç«¯ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-oauth2-client</artifactId>
    </dependency>
</dependencies>
```

### 2.2 Gradleä¾èµ–é…ç½®


```groovy
dependencies {
    // WebåŸºç¡€
    implementation 'org.springframework.boot:spring-boot-starter-web'
    
    // SecurityåŸºç¡€
    implementation 'org.springframework.boot:spring-boot-starter-security'
    
    // OAuth2è®¤è¯æœåŠ¡å™¨
    implementation 'org.springframework.security:spring-security-oauth2-authorization-server:1.1.3'
    
    // æˆ–è€…èµ„æºæœåŠ¡å™¨
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'
    
    // æˆ–è€…å®¢æˆ·ç«¯
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'
}
```

### 2.3 ä¸‰ç§è§’è‰²çš„ä¾èµ–å¯¹æ¯”


```
è§’è‰²å¯¹æ¯”å›¾ï¼š

è®¤è¯æœåŠ¡å™¨                èµ„æºæœåŠ¡å™¨              å®¢æˆ·ç«¯
    â”‚                        â”‚                      â”‚
    â”œâ”€ WebåŸºç¡€               â”œâ”€ WebåŸºç¡€             â”œâ”€ WebåŸºç¡€
    â”œâ”€ SecurityåŸºç¡€          â”œâ”€ èµ„æºæœåŠ¡å™¨          â”œâ”€ OAuth2å®¢æˆ·ç«¯
    â””â”€ è®¤è¯æœåŠ¡å™¨            â””â”€ (éªŒè¯ä»¤ç‰Œ)          â””â”€ (è·å–ä»¤ç‰Œ)
    
    å‘æ”¾ä»¤ç‰Œ                  éªŒè¯ä»¤ç‰Œ               ä½¿ç”¨ä»¤ç‰Œè®¿é—®
```

**ğŸ“Š é€‰æ‹©æŒ‡å—**

| ä½ çš„æœåŠ¡ç±»å‹ | **éœ€è¦çš„ä¾èµ–** | **ä½¿ç”¨åœºæ™¯** |
|------------|---------------|-------------|
| ğŸ” **è®¤è¯ä¸­å¿ƒ** | `oauth2-authorization-server` | ç»Ÿä¸€ç™»å½•ã€å‘æ”¾ä»¤ç‰Œ |
| ğŸ“¦ **APIæœåŠ¡** | `oauth2-resource-server` | æä¾›æ•°æ®æ¥å£ã€éªŒè¯ä»¤ç‰Œ |
| ğŸ–¥ï¸ **å‰ç«¯åº”ç”¨** | `oauth2-client` | ç”¨æˆ·ç™»å½•ã€è°ƒç”¨API |

---

## 3. ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†


### 3.1 Spring Bootä¸OAuth2ç‰ˆæœ¬å¯¹åº”


**ğŸ”¸ ç‰ˆæœ¬å…¼å®¹å…³ç³»è¡¨**

```
Spring Bootç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š

Spring Boot 3.x (æ¨è)
    â”‚
    â”œâ”€â†’ Spring Security 6.x
    â”‚   â””â”€â†’ OAuth2 Authorization Server 1.1.x
    â”‚
    â””â”€â†’ Java 17+ (å¿…éœ€)

Spring Boot 2.7.x (ç»´æŠ¤ä¸­)
    â”‚
    â”œâ”€â†’ Spring Security 5.7.x
    â”‚   â””â”€â†’ OAuth2 Authorization Server 0.4.x
    â”‚
    â””â”€â†’ Java 8+ (æ”¯æŒ)
```

**ğŸ“‹ ç‰ˆæœ¬é€‰æ‹©å»ºè®®**

| Spring Bootç‰ˆæœ¬ | **OAuth2ç‰ˆæœ¬** | **Javaç‰ˆæœ¬** | **æ¨èç¨‹åº¦** |
|----------------|---------------|-------------|-------------|
| `3.2.x` | `1.1.3` | Java 17+ | â­â­â­â­â­ æœ€æ–°ç¨³å®šç‰ˆ |
| `3.1.x` | `1.1.0` | Java 17+ | â­â­â­â­ ç¨³å®šç‰ˆ |
| `2.7.x` | `0.4.0` | Java 8+ | â­â­â­ ç»´æŠ¤ç‰ˆ |

> âš ï¸ **æ³¨æ„**ï¼šSpring Boot 2.x ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆOAuth2 Authorization Server(0.x)ï¼ŒAPIæœ‰è¾ƒå¤§å·®å¼‚

### 3.2 ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ


**ğŸ”¸ ä½¿ç”¨Spring Boot BOMç®¡ç†ç‰ˆæœ¬**

```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.2.0</version>
</parent>

<dependencies>
    <!-- ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼Œç”±çˆ¶POMç®¡ç† -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>
    
    <!-- OAuth2éœ€è¦æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬ -->
    <dependency>
        <groupId>org.springframework.security</groupId>
        <artifactId>spring-security-oauth2-authorization-server</artifactId>
        <version>1.1.3</version>
    </dependency>
</dependencies>
```

**ğŸ’¡ ç‰ˆæœ¬ç®¡ç†åŸåˆ™**
```
âœ… æ¨èåšæ³•ï¼š
â€¢ ä½¿ç”¨Spring Bootçˆ¶POMç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬
â€¢ OAuth2å•ç‹¬æŒ‡å®šä¸Spring BootåŒ¹é…çš„ç‰ˆæœ¬
â€¢ å®šæœŸæ›´æ–°åˆ°æœ€æ–°ç¨³å®šç‰ˆ

âŒ é¿å…åšæ³•ï¼š
â€¢ æ··ç”¨ä¸åŒå¤§ç‰ˆæœ¬çš„ä¾èµ–ï¼ˆå¦‚Boot 3 + Security 5ï¼‰
â€¢ éšæ„å‡çº§å•ä¸ªä¾èµ–ç‰ˆæœ¬
â€¢ ä½¿ç”¨å¿«ç…§ç‰ˆæœ¬(SNAPSHOT)åˆ°ç”Ÿäº§ç¯å¢ƒ
```

### 3.3 å¸¸è§ç‰ˆæœ¬é—®é¢˜


**ğŸ” ç‰ˆæœ¬å†²çªæ’æŸ¥**

```
é—®é¢˜ç°è±¡ï¼šé¡¹ç›®å¯åŠ¨æŠ¥é”™ NoSuchMethodError

åŸå› åˆ†æï¼š
    åº”ç”¨ä¾èµ–                  ä¼ é€’ä¾èµ–
        â”‚                        â”‚
        â”œâ”€ Spring Security 6.x   â”‚
        â”‚                        â”‚
        â””â”€ æŸä¸ªç¬¬ä¸‰æ–¹åº“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ Spring Security 5.x
                                 â”‚
                             ç‰ˆæœ¬å†²çªï¼

è§£å†³æ–¹æ¡ˆï¼š
1. æŸ¥çœ‹ä¾èµ–æ ‘ï¼šmvn dependency:tree
2. æ’é™¤å†²çªä¾èµ–ï¼š<exclusions>æ ‡ç­¾
3. å¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ï¼š<dependencyManagement>
```

**ğŸ”§ ä¾èµ–æ’é™¤ç¤ºä¾‹**

```xml
<dependency>
    <groupId>com.example</groupId>
    <artifactId>some-library</artifactId>
    <version>1.0.0</version>
    <exclusions>
        <!-- æ’é™¤æ—§ç‰ˆæœ¬çš„Spring Security -->
        <exclusion>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-core</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

---

## 4. âš™ï¸ è‡ªåŠ¨é…ç½®åŸç†


### 4.1 Spring Bootè‡ªåŠ¨é…ç½®æœºåˆ¶


**ğŸ”¸ è‡ªåŠ¨é…ç½®æ˜¯ä»€ä¹ˆ**

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰ï¼š
1. åˆ›å»ºSecurityFilterChain
2. é…ç½®UserDetailsService
3. é…ç½®OAuth2AuthorizationService
4. é…ç½®JwtEncoder/JwtDecoder
... 10å¤šä¸ªBeanéœ€è¦æ‰‹åŠ¨åˆ›å»º

Spring Bootè‡ªåŠ¨é…ç½®ï¼š
1. æ·»åŠ ä¾èµ–
2. å†™å‡ è¡Œé…ç½®æ–‡ä»¶
3. å¯åŠ¨é¡¹ç›® âœ“

åŸç†ï¼šSpring Bootè‡ªåŠ¨å¸®ä½ åˆ›å»ºå’Œé…ç½®å¥½è¿™äº›Bean
```

**ğŸ’¡ è‡ªåŠ¨é…ç½®è§¦å‘æ¡ä»¶**

```
è‡ªåŠ¨é…ç½®è§¦å‘æµç¨‹ï¼š

1. æ£€æµ‹ä¾èµ–
   â†“
   å‘ç°classpathä¸­æœ‰oauth2-authorization-server.jar
   â†“
2. åŠ è½½é…ç½®ç±»
   â†“
   OAuth2AuthorizationServerAutoConfiguration
   â†“
3. æ£€æŸ¥æ¡ä»¶æ³¨è§£
   â†“
   @ConditionalOnClass(OAuth2AuthorizationService.class)
   @ConditionalOnMissingBean(AuthorizationServerSettings.class)
   â†“
4. åˆ›å»ºé»˜è®¤Bean
   â†“
   è‡ªåŠ¨é…ç½®å®Œæˆï¼
```

### 4.2 æ ¸å¿ƒè‡ªåŠ¨é…ç½®ç±»


**ğŸ“¦ è®¤è¯æœåŠ¡å™¨è‡ªåŠ¨é…ç½®**

```java
// Spring Bootè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒç±»ï¼ˆä½ ä¸éœ€è¦å†™ï¼Œäº†è§£åŸç†å³å¯ï¼‰
@Configuration
@ConditionalOnClass(OAuth2AuthorizationService.class)
public class OAuth2AuthorizationServerAutoConfiguration {
    
    // è‡ªåŠ¨é…ç½®ï¼šæˆæƒæœåŠ¡
    @Bean
    @ConditionalOnMissingBean
    public OAuth2AuthorizationService authorizationService() {
        return new InMemoryOAuth2AuthorizationService();
    }
    
    // è‡ªåŠ¨é…ç½®ï¼šå®¢æˆ·ç«¯æ³¨å†Œ
    @Bean
    @ConditionalOnMissingBean
    public RegisteredClientRepository clientRepository() {
        return new InMemoryRegisteredClientRepository();
    }
}
```

**ğŸ” å…³é”®æ³¨è§£è§£é‡Š**

| æ³¨è§£ | **å«ä¹‰** | **é€šä¿—ç†è§£** |
|-----|---------|-------------|
| `@ConditionalOnClass` | å½“æŸä¸ªç±»å­˜åœ¨æ—¶æ‰ç”Ÿæ•ˆ | æ£€æµ‹åˆ°ä¾èµ–æ‰å¯ç”¨é…ç½® |
| `@ConditionalOnMissingBean` | å½“æŸä¸ªBeanä¸å­˜åœ¨æ—¶æ‰åˆ›å»º | ä½ æ²¡é…ç½®ï¼Œæˆ‘æ‰å¸®ä½ é…ç½® |
| `@AutoConfiguration` | æ ‡è®°ä¸ºè‡ªåŠ¨é…ç½®ç±» | å‘Šè¯‰Springè¿™æ˜¯è‡ªåŠ¨é…ç½® |

### 4.3 é…ç½®æ–‡ä»¶ç»“æ„


**ğŸ”¸ application.ymlé…ç½®ç¤ºä¾‹**

```yaml
spring:
  security:
    oauth2:
      # è®¤è¯æœåŠ¡å™¨é…ç½®
      authorizationserver:
        issuer: http://localhost:9000  # ä»¤ç‰Œå‘è¡Œè€…åœ°å€
        
      # èµ„æºæœåŠ¡å™¨é…ç½®  
      resourceserver:
        jwt:
          issuer-uri: http://localhost:9000  # éªŒè¯ä»¤ç‰Œçš„åœ°å€
          
      # å®¢æˆ·ç«¯é…ç½®
      client:
        registration:
          my-client:
            client-id: client-app
            client-secret: secret
            authorization-grant-type: authorization_code
            redirect-uri: http://localhost:8080/login/oauth2/code/my-client
```

**ğŸ“‹ é…ç½®é¡¹è¯´æ˜**

```
é…ç½®å±‚æ¬¡ç†è§£ï¼š

spring.security.oauth2
    â”‚
    â”œâ”€ authorizationserver (è®¤è¯æœåŠ¡å™¨)
    â”‚   â””â”€ issuer: å‘è¡Œè€…åœ°å€
    â”‚
    â”œâ”€ resourceserver (èµ„æºæœåŠ¡å™¨)
    â”‚   â””â”€ jwt: JWTé…ç½®
    â”‚       â””â”€ issuer-uri: éªŒè¯åœ°å€
    â”‚
    â””â”€ client (å®¢æˆ·ç«¯)
        â””â”€ registration: å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯
            â””â”€ [å®¢æˆ·ç«¯ID]: å…·ä½“é…ç½®
```

### 4.4 è‡ªå®šä¹‰é…ç½®è¦†ç›–


**ğŸ’¡ è¦†ç›–è‡ªåŠ¨é…ç½®çš„æ–¹æ³•**

```java
@Configuration
public class CustomSecurityConfig {
    
    // è‡ªå®šä¹‰Beanä¼šè¦†ç›–è‡ªåŠ¨é…ç½®çš„Bean
    @Bean
    public RegisteredClientRepository registeredClientRepository() {
        RegisteredClient client = RegisteredClient.withId("my-client")
            .clientId("client-app")
            .clientSecret("{noop}secret")  // {noop}è¡¨ç¤ºæ˜æ–‡å¯†ç 
            .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
            .redirectUri("http://localhost:8080/authorized")
            .scope("read")
            .scope("write")
            .build();
            
        return new InMemoryRegisteredClientRepository(client);
    }
}
```

> âœ… **å…³é”®ç†è§£**ï¼šä½ è‡ªå·±é…ç½®çš„Beanä¼šä¼˜å…ˆä½¿ç”¨ï¼Œè‡ªåŠ¨é…ç½®ä¸ä¼šç”Ÿæ•ˆï¼ˆå› ä¸º`@ConditionalOnMissingBean`ï¼‰

---

## 5. ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥


### 5.1 ä¾èµ–å†²çªé—®é¢˜


**ğŸ” é—®é¢˜è¡¨ç°**
```
é”™è¯¯ä¿¡æ¯ï¼š
java.lang.NoSuchMethodError: 
  org.springframework.security.config.annotation.web.builders.HttpSecurity.xxx()

åŸå› ï¼šä¾èµ–ç‰ˆæœ¬ä¸åŒ¹é…
```

**ğŸ› ï¸ æ’æŸ¥æ­¥éª¤**

```
æ­¥éª¤1ï¼šæŸ¥çœ‹ä¾èµ–æ ‘
mvn dependency:tree | grep spring-security

è¾“å‡ºç¤ºä¾‹ï¼š
[INFO] +- org.springframework.security:spring-security-core:6.1.0
[INFO] +- org.springframework.security:spring-security-web:5.7.0
                                                          ^^^^
                                                        ç‰ˆæœ¬å†²çªï¼

æ­¥éª¤2ï¼šç»Ÿä¸€ç‰ˆæœ¬
åœ¨pom.xmlä¸­æŒ‡å®šç‰ˆæœ¬ï¼š

<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-bom</artifactId>
            <version>6.1.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

### 5.2 å¯åŠ¨å¤±è´¥é—®é¢˜


**âŒ å¸¸è§å¯åŠ¨é”™è¯¯**

```
é”™è¯¯1ï¼šæ‰¾ä¸åˆ°Bean
Error: No qualifying bean of type 'OAuth2AuthorizationService'

è§£å†³æ–¹æ³•ï¼š
â†’ æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†oauth2-authorization-serverä¾èµ–
â†’ ç¡®è®¤@EnableAuthorizationServeræ³¨è§£(æ—§ç‰ˆæœ¬éœ€è¦)

é”™è¯¯2ï¼šé…ç½®å±æ€§æ— æ•ˆ
Error: Unknown property 'spring.security.oauth2.authorizationserver.issuer'

è§£å†³æ–¹æ³•ï¼š
â†’ æ£€æŸ¥Spring Bootç‰ˆæœ¬æ˜¯å¦æ”¯æŒè¯¥é…ç½®
â†’ ç¡®è®¤é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®(YAMLç¼©è¿›)
```

**âœ… å¿«é€Ÿè¯Šæ–­æ¸…å•**

```
â–¡ ä¾èµ–æ˜¯å¦æ­£ç¡®æ·»åŠ 
â–¡ ç‰ˆæœ¬æ˜¯å¦å…¼å®¹
â–¡ é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
â–¡ Javaç‰ˆæœ¬æ˜¯å¦æ»¡è¶³è¦æ±‚(Boot 3éœ€è¦Java 17+)
â–¡ æ˜¯å¦æœ‰å…¶ä»–ä¾èµ–å†²çª
```

### 5.3 è¿è¡Œæ—¶é—®é¢˜


**ğŸ” ä»¤ç‰ŒéªŒè¯å¤±è´¥**

```
é—®é¢˜ç°è±¡ï¼š
å®¢æˆ·ç«¯è·å–äº†ä»¤ç‰Œï¼Œä½†èµ„æºæœåŠ¡å™¨éªŒè¯å¤±è´¥

æ’æŸ¥æµç¨‹ï¼š
1. æ£€æŸ¥issueré…ç½®æ˜¯å¦ä¸€è‡´
   è®¤è¯æœåŠ¡å™¨ï¼šissuer: http://localhost:9000
   èµ„æºæœåŠ¡å™¨ï¼šissuer-uri: http://localhost:9000
                          ^^^^^^^^^^^^^^^^^^^
                          å¿…é¡»å®Œå…¨ä¸€è‡´ï¼

2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
   èµ„æºæœåŠ¡å™¨èƒ½å¦è®¿é—®è®¤è¯æœåŠ¡å™¨çš„/.well-known/oauth-authorization-server

3. æ£€æŸ¥æ—¶é’ŸåŒæ­¥
   JWTæœ‰æ—¶é—´çª—å£ï¼ŒæœåŠ¡å™¨æ—¶é—´å·®å¼‚>5åˆ†é’Ÿä¼šå¤±è´¥
```

**ğŸ› ï¸ è°ƒè¯•æŠ€å·§**

```yaml
# å¼€å¯è°ƒè¯•æ—¥å¿—
logging:
  level:
    org.springframework.security: DEBUG
    org.springframework.security.oauth2: TRACE
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„ä¾èµ–æ¸…å•


```
ğŸ”¸ è®¤è¯æœåŠ¡å™¨ï¼ˆå‘ä»¤ç‰Œçš„ï¼‰ï¼š
â†’ spring-boot-starter-web
â†’ spring-boot-starter-security  
â†’ spring-security-oauth2-authorization-server

ğŸ”¸ èµ„æºæœåŠ¡å™¨ï¼ˆéªŒä»¤ç‰Œçš„ï¼‰ï¼š
â†’ spring-boot-starter-web
â†’ spring-boot-starter-oauth2-resource-server

ğŸ”¸ å®¢æˆ·ç«¯ï¼ˆç”¨ä»¤ç‰Œçš„ï¼‰ï¼š
â†’ spring-boot-starter-web
â†’ spring-boot-starter-oauth2-client
```

### 6.2 ç‰ˆæœ¬é€‰æ‹©åŸåˆ™


| åœºæ™¯ | **æ¨èç‰ˆæœ¬** | **åŸå› ** |
|-----|-------------|---------|
| ğŸ†• æ–°é¡¹ç›® | Spring Boot 3.2 + OAuth2 1.1.3 | æœ€æ–°ç‰¹æ€§ï¼Œé•¿æœŸæ”¯æŒ |
| ğŸ”„ å‡çº§é¡¹ç›® | è¯„ä¼°åé€æ­¥å‡çº§åˆ°3.x | ç¨³å®šè¿‡æ¸¡ |
| ğŸ¢ ä¼ä¸šé¡¹ç›® | ä½¿ç”¨ç¨³å®šçš„LTSç‰ˆæœ¬ | å‡å°‘é£é™© |

### 6.3 è‡ªåŠ¨é…ç½®ç†è§£


```
è®°ä½ä¸‰ä¸ªå…³é”®ç‚¹ï¼š

1ï¸âƒ£ æ·»åŠ ä¾èµ– â†’ è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆ
   spring-boot-starterä¼šè‡ªåŠ¨æ‰«æå¹¶é…ç½®

2ï¸âƒ£ è‡ªå·±é…ç½® â†’ è¦†ç›–è‡ªåŠ¨é…ç½®
   ä½ çš„Beanä¼šä¼˜å…ˆä½¿ç”¨

3ï¸âƒ£ é…ç½®æ–‡ä»¶ â†’ å¾®è°ƒè¡Œä¸º
   application.ymlè°ƒæ•´ç»†èŠ‚
```

### 6.4 å¿«é€Ÿæ’æŸ¥é—®é¢˜


```
é‡åˆ°é—®é¢˜æŒ‰é¡ºåºæ£€æŸ¥ï¼š

âœ“ ä¾èµ–æ˜¯å¦æ·»åŠ  (pom.xml)
  â†“
âœ“ ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ (Spring Bootç‰ˆæœ¬å¯¹åº”è¡¨)
  â†“
âœ“ é…ç½®æ˜¯å¦æ­£ç¡® (application.yml)
  â†“
âœ“ æ—¥å¿—æŸ¥çœ‹æŠ¥é”™ (å¯ç”¨DEBUGæ—¥å¿—)
  â†“
âœ“ ä¾èµ–æ ‘åˆ†æ (mvn dependency:tree)
```

### 6.5 å®æˆ˜å»ºè®®


> ğŸ’¡ **ç»™æ–°æ‰‹çš„å»ºè®®**ï¼š
> - ä»æœ€ç®€å•çš„è®¤è¯æœåŠ¡å™¨å¼€å§‹ï¼Œä¸è¦ä¸€æ¬¡é…ç½®å¤ªå¤š
> - ä½¿ç”¨Spring Bootæ¨èçš„ç‰ˆæœ¬ç»„åˆï¼Œé¿å…è¸©å‘
> - å…ˆç”¨å†…å­˜å­˜å‚¨(InMemory)æµ‹è¯•ï¼Œå†æ¢æ•°æ®åº“
> - å¤šçœ‹å®˜æ–¹æ–‡æ¡£å’Œç¤ºä¾‹é¡¹ç›®

> ğŸš€ **è¿›é˜¶å­¦ä¹ è·¯å¾„**ï¼š
> 1. æŒæ¡ä¾èµ–é…ç½®ï¼ˆæœ¬æ–‡å†…å®¹ï¼‰
> 2. ç†è§£OAuth2åŸºæœ¬æ¦‚å¿µ
> 3. å®ç°ç®€å•çš„è®¤è¯æµç¨‹
> 4. é›†æˆJWTä»¤ç‰Œ
> 5. å®ç°èµ„æºæœåŠ¡å™¨
> 6. ç”Ÿäº§ç¯å¢ƒé…ç½®ä¼˜åŒ–

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ä¾èµ–ä¸‰å¤§ä»¶ï¼Œè§’è‰²è¦åˆ†æ¸…
ç‰ˆæœ¬è¦å…¼å®¹ï¼Œé…ç½®é è‡ªåŠ¨
å†²çªçœ‹ä¾èµ–æ ‘ï¼Œé—®é¢˜æŸ¥æ—¥å¿—
ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å¾€æ·±èµ°
```