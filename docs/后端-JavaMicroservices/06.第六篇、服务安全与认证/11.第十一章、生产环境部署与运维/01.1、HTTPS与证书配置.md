---
title: 1ã€HTTPSä¸è¯ä¹¦é…ç½®
---
## ğŸ“š ç›®å½•

1. [HTTPSåŸºç¡€æ¦‚å¿µ](#1-HTTPSåŸºç¡€æ¦‚å¿µ)
2. [SSL/TLSè¯ä¹¦é…ç½®](#2-SSL-TLSè¯ä¹¦é…ç½®)
3. [HTTPSå¼ºåˆ¶è·³è½¬](#3-HTTPSå¼ºåˆ¶è·³è½¬)
4. [è¯ä¹¦è‡ªåŠ¨ç»­æœŸ](#4-è¯ä¹¦è‡ªåŠ¨ç»­æœŸ)
5. [è¯ä¹¦é“¾éªŒè¯](#5-è¯ä¹¦é“¾éªŒè¯)
6. [åŒå‘SSLè®¤è¯](#6-åŒå‘SSLè®¤è¯)
7. [è¯ä¹¦å­˜å‚¨å®‰å…¨](#7-è¯ä¹¦å­˜å‚¨å®‰å…¨)
8. [è¯ä¹¦ç›‘æ§å‘Šè­¦](#8-è¯ä¹¦ç›‘æ§å‘Šè­¦)
9. [CAè¯ä¹¦ç®¡ç†](#9-CAè¯ä¹¦ç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ HTTPSåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯HTTPS


**é€šä¿—ç†è§£**ï¼šHTTPSå°±æ˜¯ç»™HTTPåŠ äº†ä¸€æŠŠé”ï¼Œè®©æ•°æ®ä¼ è¾“æ›´å®‰å…¨ã€‚

```
HTTPä¼ è¾“ï¼ˆæ˜æ–‡ï¼‰ï¼š
å®¢æˆ·ç«¯ --[ç”¨æˆ·å:admin,å¯†ç :123456]--> æœåŠ¡å™¨
         â†‘ å®¹æ˜“è¢«çªƒå¬ï¼

HTTPSä¼ è¾“ï¼ˆåŠ å¯†ï¼‰ï¼š
å®¢æˆ·ç«¯ --[åŠ å¯†åçš„ä¹±ç æ•°æ®]--> æœåŠ¡å™¨
         â†‘ å³ä½¿è¢«æˆªè·ä¹Ÿçœ‹ä¸æ‡‚
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **ğŸ” æ•°æ®åŠ å¯†**ï¼šé˜²æ­¢ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå¬
- **âœ… èº«ä»½éªŒè¯**ï¼šç¡®è®¤æœåŠ¡å™¨æ˜¯çœŸå®çš„ï¼Œä¸æ˜¯å‡å†’çš„
- **ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§**ï¼šé˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹

### 1.2 HTTPSå·¥ä½œåŸç†


**ç®€å•ç†è§£**ï¼šåƒå¯„å¿«é€’æ—¶çš„ä¸‰ä¸ªæ­¥éª¤

```
æ­¥éª¤1ï¼šéªŒè¯å¿«é€’å…¬å¸èº«ä»½
å®¢æˆ·ç«¯                              æœåŠ¡å™¨
   |--â‘ è¯·æ±‚å»ºç«‹å®‰å…¨è¿æ¥-------------->|
   |<-â‘¡å‡ºç¤ºè¯ä¹¦è¯æ˜èº«ä»½---------------|
   |--â‘¢éªŒè¯è¯ä¹¦æ˜¯å¦å¯ä¿¡-------------->|
        (æ£€æŸ¥è¯ä¹¦é¢å‘æœºæ„ã€æœ‰æ•ˆæœŸç­‰)

æ­¥éª¤2ï¼šåå•†åŠ å¯†æ–¹å¼
   |<-â‘£å‘ŠçŸ¥æ”¯æŒçš„åŠ å¯†ç®—æ³•-------------|
   |--â‘¤é€‰æ‹©ä¸€ç§åŠ å¯†ç®—æ³•-------------->|

æ­¥éª¤3ï¼šå¼€å§‹åŠ å¯†é€šä¿¡
   |<-â‘¥ç”¨åŠ å¯†å¯†é’¥ä¼ è¾“æ•°æ®-------------|
   |--â‘¦ç”¨åŠ å¯†å¯†é’¥ä¼ è¾“æ•°æ®------------->|
```

**å…³é”®æ¦‚å¿µè§£é‡Š**ï¼š

ğŸ”¸ **SSL/TLSåè®®**
- **SSL**ï¼ˆSecure Sockets Layerï¼‰ï¼šå®‰å…¨å¥—æ¥å±‚ï¼Œå·²è¿‡æ—¶
- **TLS**ï¼ˆTransport Layer Securityï¼‰ï¼šä¼ è¾“å±‚å®‰å…¨ï¼ŒSSLçš„å‡çº§ç‰ˆ
- **ç°çŠ¶**ï¼šç°åœ¨è¯´SSLå…¶å®æŒ‡çš„å°±æ˜¯TLSï¼ˆä¹ æƒ¯å«æ³•ï¼‰

ğŸ”¸ **åŠ å¯†ç®—æ³•**
- **å¯¹ç§°åŠ å¯†**ï¼šåƒä¸€æŠŠé’¥åŒ™å¼€ä¸€æŠŠé”ï¼ˆé€Ÿåº¦å¿«ï¼Œä¼ è¾“æ•°æ®ç”¨ï¼‰
- **éå¯¹ç§°åŠ å¯†**ï¼šä¸€æŠŠå…¬é’¥åŠ å¯†ï¼Œå¦ä¸€æŠŠç§é’¥è§£å¯†ï¼ˆå®‰å…¨ä½†æ…¢ï¼Œæ¡æ‰‹ç”¨ï¼‰
- **æ··åˆä½¿ç”¨**ï¼šæ¡æ‰‹ç”¨éå¯¹ç§°ï¼Œä¼ è¾“ç”¨å¯¹ç§°ï¼ˆå…¼é¡¾å®‰å…¨å’Œé€Ÿåº¦ï¼‰

---

## 2. ğŸ“œ SSL/TLSè¯ä¹¦é…ç½®


### 2.1 è¯ä¹¦æ˜¯ä»€ä¹ˆ


**å½¢è±¡æ¯”å–»**ï¼šè¯ä¹¦å°±åƒç½‘ç«™çš„èº«ä»½è¯ï¼Œè¯æ˜"æˆ‘æ˜¯è°"

```
è¯ä¹¦å†…å®¹åŒ…æ‹¬ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ ç½‘ç«™åŸŸå: www.example.com â”‚
â”‚ ğŸ›ï¸  é¢å‘æœºæ„: Let's Encrypt   â”‚
â”‚ ğŸ“… æœ‰æ•ˆæœŸ: 2025-01-01 è‡³      â”‚
â”‚          2025-12-31         â”‚
â”‚ ğŸ”‘ å…¬é’¥: MIIB...             â”‚
â”‚ âœï¸  æ•°å­—ç­¾å: (CAçš„ç­¾å)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è¯ä¹¦ç±»å‹å¯¹æ¯”


| è¯ä¹¦ç±»å‹ | **éªŒè¯çº§åˆ«** | **é€‚ç”¨åœºæ™¯** | **ä»·æ ¼** | **è·å–æ—¶é—´** |
|---------|------------|------------|---------|------------|
| ğŸŸ¢ **DVåŸŸåéªŒè¯** | `ä»…éªŒè¯åŸŸåæ‰€æœ‰æƒ` | `ä¸ªäººç½‘ç«™ã€å°å‹åº”ç”¨` | `å…è´¹/ä¾¿å®œ` | `å‡ åˆ†é’Ÿ` |
| ğŸŸ¡ **OVç»„ç»‡éªŒè¯** | `éªŒè¯ä¼ä¸šçœŸå®æ€§` | `ä¼ä¸šå®˜ç½‘ã€å•†ä¸šåº”ç”¨` | `ä¸­ç­‰` | `1-3å¤©` |
| ğŸ”´ **EVæ‰©å±•éªŒè¯** | `æœ€ä¸¥æ ¼éªŒè¯` | `é‡‘èã€ç”µå•†ç­‰é«˜å®‰å…¨éœ€æ±‚` | `è¾ƒè´µ` | `3-7å¤©` |

### 2.3 Spring Bootä¸­é…ç½®HTTPS


**é…ç½®æ­¥éª¤**ï¼š

**â‘  ç”Ÿæˆè¯ä¹¦**ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰

```bash
# ä½¿ç”¨Javaè‡ªå¸¦çš„keytoolç”Ÿæˆè‡ªç­¾åè¯ä¹¦
keytool -genkeypair \
  -alias myapp \
  -keyalg RSA \
  -keysize 2048 \
  -storetype PKCS12 \
  -keystore keystore.p12 \
  -validity 365

# ä¼šæç¤ºè¾“å…¥ï¼š
# - å¯†é’¥åº“å¯†ç : 123456ï¼ˆè‡ªå·±è®¾ç½®ï¼‰
# - å§“å: localhost
# - ç»„ç»‡: MyCompany
# ç­‰ä¿¡æ¯...
```

**â‘¡ é…ç½®Spring Boot**

```yaml
# application.yml
server:
  port: 8443  # HTTPSé»˜è®¤ç«¯å£
  ssl:
    enabled: true
    key-store: classpath:keystore.p12  # è¯ä¹¦æ–‡ä»¶ä½ç½®
    key-store-password: 123456         # è¯ä¹¦å¯†ç 
    key-store-type: PKCS12             # è¯ä¹¦æ ¼å¼
    key-alias: myapp                   # è¯ä¹¦åˆ«å
```

**â‘¢ è®¿é—®æµ‹è¯•**

```bash
# æµè§ˆå™¨è®¿é—®
https://localhost:8443

# âš ï¸ æµè§ˆå™¨ä¼šè­¦å‘Š"ä¸å®‰å…¨"
# åŸå› ï¼šè‡ªç­¾åè¯ä¹¦ä¸è¢«æµè§ˆå™¨ä¿¡ä»»
# å¼€å‘æµ‹è¯•å¯ä»¥ç‚¹å‡»"ç»§ç»­è®¿é—®"
```

### 2.4 ä½¿ç”¨çœŸå®è¯ä¹¦ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰


**æ–¹æ¡ˆ1ï¼šLet's Encryptå…è´¹è¯ä¹¦**

```bash
# å®‰è£…certbotå·¥å…·
sudo apt-get install certbot

# è‡ªåŠ¨è·å–è¯ä¹¦
sudo certbot certonly --standalone -d www.example.com

# è¯ä¹¦ä¼šä¿å­˜åœ¨ï¼š
# /etc/letsencrypt/live/www.example.com/fullchain.pem  # è¯ä¹¦
# /etc/letsencrypt/live/www.example.com/privkey.pem    # ç§é’¥
```

**æ–¹æ¡ˆ2ï¼šè½¬æ¢è¯ä¹¦æ ¼å¼**

```bash
# Let's Encryptç»™çš„æ˜¯PEMæ ¼å¼ï¼Œéœ€è¦è½¬æˆPKCS12
openssl pkcs12 -export \
  -in fullchain.pem \
  -inkey privkey.pem \
  -out keystore.p12 \
  -name myapp

# ç„¶ååœ¨Spring Bootä¸­ä½¿ç”¨è¿™ä¸ªkeystore.p12
```

---

## 3. â†—ï¸ HTTPSå¼ºåˆ¶è·³è½¬


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦å¼ºåˆ¶è·³è½¬


**åœºæ™¯è¯´æ˜**ï¼šç”¨æˆ·å¯èƒ½ç”¨HTTPè®¿é—®ï¼Œæˆ‘ä»¬è¦è‡ªåŠ¨è·³è½¬åˆ°HTTPS

```
ç”¨æˆ·è¾“å…¥: http://www.example.com
         â†“ è‡ªåŠ¨è·³è½¬
å®é™…è®¿é—®: https://www.example.com

ç›®çš„ï¼šç¡®ä¿æ‰€æœ‰æµé‡éƒ½èµ°HTTPSåŠ å¯†é€šé“
```

### 3.2 å®ç°æ–¹å¼


**æ–¹å¼1ï¼šé…ç½®ç±»å®ç°**

```java
@Configuration
public class HttpsRedirectConfig {
    
    // åŒæ—¶ç›‘å¬HTTPå’ŒHTTPSç«¯å£
    @Bean
    public ServletWebServerFactory servletContainer() {
        TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory() {
            @Override
            protected void postProcessContext(Context context) {
                // è®¾ç½®å®‰å…¨çº¦æŸ
                SecurityConstraint constraint = new SecurityConstraint();
                constraint.setUserConstraint("CONFIDENTIAL");
                
                SecurityCollection collection = new SecurityCollection();
                collection.addPattern("/*");  // æ‰€æœ‰è·¯å¾„
                constraint.addCollection(collection);
                context.addConstraint(constraint);
            }
        };
        
        // æ·»åŠ HTTPè¿æ¥å™¨
        tomcat.addAdditionalTomcatConnectors(createHttpConnector());
        return tomcat;
    }
    
    private Connector createHttpConnector() {
        Connector connector = new Connector(TomcatServletWebServerFactory.DEFAULT_PROTOCOL);
        connector.setScheme("http");
        connector.setPort(8080);      // HTTPç«¯å£
        connector.setSecure(false);
        connector.setRedirectPort(8443); // é‡å®šå‘åˆ°HTTPSç«¯å£
        return connector;
    }
}
```

**æ–¹å¼2ï¼šNginxåå‘ä»£ç†ï¼ˆæ¨èï¼‰**

```nginx
# nginx.conf
server {
    listen 80;
    server_name www.example.com;
    
    # æ‰€æœ‰HTTPè¯·æ±‚é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name www.example.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;
    
    # åå‘ä»£ç†åˆ°åç«¯æœåŠ¡
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header X-Forwarded-Proto https;
    }
}
```

### 3.3 HSTSå®‰å…¨å¤´


**HSTSï¼ˆHTTP Strict Transport Securityï¼‰**ï¼šå‘Šè¯‰æµè§ˆå™¨"ä»¥ååªç”¨HTTPSè®¿é—®"

```java
@Configuration
public class SecurityHeadersConfig {
    
    @Bean
    public FilterRegistrationBean<HstsFilter> hstsFilter() {
        FilterRegistrationBean<HstsFilter> registration = new FilterRegistrationBean<>();
        registration.setFilter(new HstsFilter());
        registration.addUrlPatterns("/*");
        return registration;
    }
}

class HstsFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // æ·»åŠ HSTSå¤´
        // max-age=31536000: 1å¹´å†…å¼ºåˆ¶HTTPS
        // includeSubDomains: åŒ…æ‹¬æ‰€æœ‰å­åŸŸå
        httpResponse.setHeader("Strict-Transport-Security", 
            "max-age=31536000; includeSubDomains");
        
        chain.doFilter(request, response);
    }
}
```

---

## 4. ğŸ”„ è¯ä¹¦è‡ªåŠ¨ç»­æœŸ


### 4.1 è¯ä¹¦è¿‡æœŸé—®é¢˜


**ä¸ºä»€ä¹ˆä¼šè¿‡æœŸ**ï¼š
- è¯ä¹¦éƒ½æœ‰æœ‰æ•ˆæœŸï¼ˆé€šå¸¸90å¤©-1å¹´ï¼‰
- è¿‡æœŸåHTTPSå¤±æ•ˆï¼Œç½‘ç«™æ— æ³•è®¿é—®
- éœ€è¦å®šæœŸæ›´æ–°è¯ä¹¦

### 4.2 Let's Encryptè‡ªåŠ¨ç»­æœŸ


**ä½¿ç”¨certbotè‡ªåŠ¨ç»­æœŸ**

```bash
# æµ‹è¯•ç»­æœŸå‘½ä»¤æ˜¯å¦æ­£å¸¸
sudo certbot renew --dry-run

# è®¾ç½®è‡ªåŠ¨ç»­æœŸä»»åŠ¡ï¼ˆæ¯å¤©æ£€æŸ¥ï¼‰
sudo crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡
0 3 * * * certbot renew --quiet --post-hook "systemctl reload nginx"

# è§£é‡Šï¼š
# 0 3 * * *  : æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œ
# --quiet    : é™é»˜æ¨¡å¼
# --post-hook: ç»­æœŸæˆåŠŸåé‡å¯Nginx
```

### 4.3 è¯ä¹¦ç»­æœŸç›‘æ§


**Javaåº”ç”¨ä¸­ç›‘æ§è¯ä¹¦æœ‰æ•ˆæœŸ**

```java
@Component
@Slf4j
public class CertificateMonitor {
    
    @Scheduled(cron = "0 0 1 * * ?")  // æ¯å¤©å‡Œæ™¨1ç‚¹æ£€æŸ¥
    public void checkCertificateExpiry() {
        try {
            // è¯»å–è¯ä¹¦
            KeyStore keyStore = KeyStore.getInstance("PKCS12");
            keyStore.load(
                new FileInputStream("keystore.p12"), 
                "123456".toCharArray()
            );
            
            Certificate cert = keyStore.getCertificate("myapp");
            if (cert instanceof X509Certificate) {
                X509Certificate x509 = (X509Certificate) cert;
                Date notAfter = x509.getNotAfter();  // è¿‡æœŸæ—¶é—´
                
                // è®¡ç®—å‰©ä½™å¤©æ•°
                long daysLeft = ChronoUnit.DAYS.between(
                    LocalDate.now(), 
                    notAfter.toInstant().atZone(ZoneId.systemDefault()).toLocalDate()
                );
                
                // å°‘äº30å¤©å‘é€å‘Šè­¦
                if (daysLeft < 30) {
                    log.warn("âš ï¸ è¯ä¹¦å³å°†è¿‡æœŸï¼å‰©ä½™{}å¤©", daysLeft);
                    sendAlert("è¯ä¹¦å³å°†è¿‡æœŸ", daysLeft);
                }
            }
        } catch (Exception e) {
            log.error("è¯ä¹¦æ£€æŸ¥å¤±è´¥", e);
        }
    }
    
    private void sendAlert(String message, long days) {
        // å‘é€é‚®ä»¶/çŸ­ä¿¡/é’‰é’‰é€šçŸ¥
        // ...
    }
}
```

---

## 5. ğŸ”— è¯ä¹¦é“¾éªŒè¯


### 5.1 ä»€ä¹ˆæ˜¯è¯ä¹¦é“¾


**å½¢è±¡æ¯”å–»**ï¼šåƒèº«ä»½è¯çš„éªŒè¯å±‚çº§

```
è¯ä¹¦ä¿¡ä»»é“¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ ¹CAè¯ä¹¦       â”‚  â† æµè§ˆå™¨å†…ç½®ä¿¡ä»»ï¼ˆæœ€é«˜æƒå¨ï¼‰
â”‚  (Root CA)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ç­¾å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸­é—´CAè¯ä¹¦      â”‚  â† è¯ä¹¦é¢å‘æœºæ„
â”‚ (Intermediate)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ç­¾å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç½‘ç«™è¯ä¹¦        â”‚  â† www.example.com
â”‚ (End Entity)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éªŒè¯è¿‡ç¨‹ï¼š
1. æµè§ˆå™¨æ£€æŸ¥ç½‘ç«™è¯ä¹¦
2. æ‰¾åˆ°ç­¾å‘å®ƒçš„ä¸­é—´CA
3. æ‰¾åˆ°ç­¾å‘ä¸­é—´CAçš„æ ¹CA
4. æ ¹CAåœ¨æµè§ˆå™¨ä¿¡ä»»åˆ—è¡¨ä¸­ âœ…
```

### 5.2 å®Œæ•´è¯ä¹¦é“¾é…ç½®


**é”™è¯¯ç¤ºä¾‹**ï¼šåªé…ç½®ç½‘ç«™è¯ä¹¦

```bash
# âŒ ä¸å®Œæ•´çš„è¯ä¹¦é“¾
ssl_certificate /path/to/cert.pem;  # åªæœ‰ç½‘ç«™è¯ä¹¦

# ç»“æœï¼šæµè§ˆå™¨å¯èƒ½ä¸ä¿¡ä»»
```

**æ­£ç¡®ç¤ºä¾‹**ï¼šåŒ…å«å®Œæ•´é“¾

```bash
# âœ… å®Œæ•´çš„è¯ä¹¦é“¾
# fullchain.pem åŒ…å«ï¼š
# 1. ç½‘ç«™è¯ä¹¦
# 2. ä¸­é—´CAè¯ä¹¦
# 3. (æœ‰æ—¶åŒ…å«)æ ¹CAè¯ä¹¦

ssl_certificate /path/to/fullchain.pem;
ssl_certificate_key /path/to/privkey.pem;
```

### 5.3 éªŒè¯è¯ä¹¦é“¾


**åœ¨çº¿éªŒè¯å·¥å…·**ï¼š
```bash
# ä½¿ç”¨openssléªŒè¯
openssl s_client -connect www.example.com:443 -showcerts

# è¾“å‡ºä¼šæ˜¾ç¤ºè¯ä¹¦é“¾ï¼š
# Certificate chain
#  0 s:CN = www.example.com          â† ç½‘ç«™è¯ä¹¦
#    i:CN = Let's Encrypt Authority  
#  1 s:CN = Let's Encrypt Authority   â† ä¸­é—´è¯ä¹¦
#    i:CN = ISRG Root X1
```

**Javaä»£ç éªŒè¯**ï¼š

```java
public class CertificateChainValidator {
    
    public boolean validateChain(String host, int port) {
        try {
            SSLContext sslContext = SSLContext.getInstance("TLS");
            TrustManagerFactory tmf = TrustManagerFactory.getInstance(
                TrustManagerFactory.getDefaultAlgorithm()
            );
            tmf.init((KeyStore) null);  // ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ä¿¡ä»»åº“
            
            sslContext.init(null, tmf.getTrustManagers(), null);
            SSLSocketFactory factory = sslContext.getSocketFactory();
            
            // è¿æ¥æœåŠ¡å™¨
            SSLSocket socket = (SSLSocket) factory.createSocket(host, port);
            socket.startHandshake();
            
            // è·å–è¯ä¹¦é“¾
            Certificate[] certs = socket.getSession().getPeerCertificates();
            System.out.println("è¯ä¹¦é“¾é•¿åº¦: " + certs.length);
            
            for (int i = 0; i < certs.length; i++) {
                X509Certificate cert = (X509Certificate) certs[i];
                System.out.println("è¯ä¹¦" + i + ": " + cert.getSubjectDN());
            }
            
            socket.close();
            return true;
            
        } catch (Exception e) {
            System.err.println("è¯ä¹¦é“¾éªŒè¯å¤±è´¥: " + e.getMessage());
            return false;
        }
    }
}
```

---

## 6. ğŸ” åŒå‘SSLè®¤è¯


### 6.1 å•å‘è®¤è¯ vs åŒå‘è®¤è¯


**å•å‘è®¤è¯**ï¼ˆå¸¸è§ï¼‰ï¼šåªéªŒè¯æœåŠ¡å™¨èº«ä»½

```
å®¢æˆ·ç«¯                     æœåŠ¡å™¨
   |--è¯·æ±‚è¿æ¥-------------->|
   |<-å‡ºç¤ºæœåŠ¡å™¨è¯ä¹¦----------|
   |--éªŒè¯è¯ä¹¦--------------->|
   |<-å¼€å§‹é€šä¿¡----------------|
   
åªæœ‰å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨ âœ…
```

**åŒå‘è®¤è¯**ï¼ˆæ›´å®‰å…¨ï¼‰ï¼šäº’ç›¸éªŒè¯èº«ä»½

```
å®¢æˆ·ç«¯                     æœåŠ¡å™¨
   |--è¯·æ±‚è¿æ¥-------------->|
   |<-å‡ºç¤ºæœåŠ¡å™¨è¯ä¹¦----------|
   |--éªŒè¯è¯ä¹¦--------------->|
   |--å‡ºç¤ºå®¢æˆ·ç«¯è¯ä¹¦--------->|
   |<-éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦----------|
   |<-åŒæ–¹éªŒè¯é€šè¿‡------------|
   
æœåŠ¡å™¨ä¹ŸéªŒè¯å®¢æˆ·ç«¯ âœ…âœ…
```

### 6.2 åº”ç”¨åœºæ™¯


**é€‚åˆåŒå‘è®¤è¯çš„åœºæ™¯**ï¼š
- âœ… **å†…éƒ¨ç³»ç»Ÿé€šä¿¡**ï¼šæœåŠ¡Aå’ŒæœåŠ¡Bä¹‹é—´
- âœ… **é“¶è¡Œæ¥å£**ï¼šPOSæœºä¸é“¶è¡ŒæœåŠ¡å™¨
- âœ… **ä¼ä¸šVPN**ï¼šå‘˜å·¥è®¾å¤‡æ¥å…¥å…¬å¸ç½‘ç»œ
- âœ… **APIç½‘å…³**ï¼šä¿¡ä»»çš„åˆä½œä¼™ä¼´æ¥å…¥

**ä¸é€‚åˆçš„åœºæ™¯**ï¼š
- âŒ **å…¬å¼€ç½‘ç«™**ï¼šæ™®é€šç”¨æˆ·æ— æ³•æä¾›è¯ä¹¦
- âŒ **ç§»åŠ¨APP**ï¼šè¯ä¹¦ç®¡ç†å¤æ‚

### 6.3 é…ç½®åŒå‘è®¤è¯


**â‘  ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦**

```bash
# 1. ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥å¯¹
keytool -genkeypair \
  -alias client \
  -keyalg RSA \
  -keystore client.p12 \
  -storetype PKCS12

# 2. å¯¼å‡ºå®¢æˆ·ç«¯è¯ä¹¦
keytool -exportcert \
  -alias client \
  -keystore client.p12 \
  -file client.cer

# 3. æœåŠ¡å™¨å¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆä¿¡ä»»å®¢æˆ·ç«¯ï¼‰
keytool -importcert \
  -alias clientcert \
  -file client.cer \
  -keystore truststore.p12
```

**â‘¡ Spring Booté…ç½®**

```yaml
server:
  port: 8443
  ssl:
    enabled: true
    # æœåŠ¡å™¨è¯ä¹¦
    key-store: classpath:server.p12
    key-store-password: server123
    key-store-type: PKCS12
    
    # å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯
    client-auth: need  # need:å¿…é¡», want:å¯é€‰
    trust-store: classpath:truststore.p12
    trust-store-password: trust123
    trust-store-type: PKCS12
```

**â‘¢ å®¢æˆ·ç«¯ä»£ç **

```java
@Configuration
public class MutualSSLConfig {
    
    @Bean
    public RestTemplate mutualSSLRestTemplate() throws Exception {
        // åŠ è½½å®¢æˆ·ç«¯è¯ä¹¦
        KeyStore keyStore = KeyStore.getInstance("PKCS12");
        keyStore.load(
            new FileInputStream("client.p12"), 
            "client123".toCharArray()
        );
        
        // åŠ è½½ä¿¡ä»»çš„æœåŠ¡å™¨è¯ä¹¦
        KeyStore trustStore = KeyStore.getInstance("PKCS12");
        trustStore.load(
            new FileInputStream("truststore.p12"), 
            "trust123".toCharArray()
        );
        
        // é…ç½®SSLä¸Šä¸‹æ–‡
        SSLContext sslContext = SSLContexts.custom()
            .loadKeyMaterial(keyStore, "client123".toCharArray())  // å®¢æˆ·ç«¯è¯ä¹¦
            .loadTrustMaterial(trustStore, null)                   // ä¿¡ä»»çš„æœåŠ¡å™¨
            .build();
        
        // åˆ›å»ºHttpClient
        CloseableHttpClient httpClient = HttpClients.custom()
            .setSSLContext(sslContext)
            .build();
        
        // åˆ›å»ºRestTemplate
        HttpComponentsClientHttpRequestFactory factory = 
            new HttpComponentsClientHttpRequestFactory(httpClient);
        
        return new RestTemplate(factory);
    }
}
```

**â‘£ ä½¿ç”¨ç¤ºä¾‹**

```java
@Service
public class SecureApiClient {
    
    @Autowired
    @Qualifier("mutualSSLRestTemplate")
    private RestTemplate restTemplate;
    
    public String callSecureApi() {
        // è¿™ä¸ªè¯·æ±‚ä¼šä½¿ç”¨åŒå‘SSLè®¤è¯
        String response = restTemplate.getForObject(
            "https://secure-api.example.com/data",
            String.class
        );
        return response;
    }
}
```

---

## 7. ğŸ”’ è¯ä¹¦å­˜å‚¨å®‰å…¨


### 7.1 è¯ä¹¦æ³„éœ²çš„é£é™©


**é£é™©åœºæ™¯**ï¼š

```
âŒ ä¸å®‰å…¨çš„åšæ³•ï¼š
1. è¯ä¹¦å¯†ç ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
2. è¯ä¹¦æ–‡ä»¶ç›´æ¥æ”¾åœ¨é¡¹ç›®ç›®å½•
3. è¯ä¹¦ä¸Šä¼ åˆ°Gitä»“åº“
4. æ‰€æœ‰ç¯å¢ƒç”¨åŒä¸€ä¸ªè¯ä¹¦

ğŸ”´ åæœï¼š
- è¯ä¹¦è¢«ç›—ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªè£…æˆä½ çš„æœåŠ¡
- ç§é’¥æ³„éœ²ï¼Œæ‰€æœ‰åŠ å¯†é€šä¿¡éƒ½å¯è¢«è§£å¯†
```

### 7.2 å®‰å…¨å­˜å‚¨æ–¹æ¡ˆ


**æ–¹æ¡ˆ1ï¼šç¯å¢ƒå˜é‡**

```yaml
# application.yml
server:
  ssl:
    key-store: ${SSL_KEYSTORE_PATH}
    key-store-password: ${SSL_KEYSTORE_PASSWORD}
```

```bash
# å¯åŠ¨æ—¶ä¼ å…¥
export SSL_KEYSTORE_PATH=/secure/path/keystore.p12
export SSL_KEYSTORE_PASSWORD=MySecurePassword123!
java -jar app.jar
```

**æ–¹æ¡ˆ2ï¼šé…ç½®åŠ å¯†**

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.5</version>
</dependency>
```

```yaml
# application.yml
server:
  ssl:
    key-store: classpath:keystore.p12
    key-store-password: ENC(åŠ å¯†åçš„å¯†ç )

# åŠ å¯†é…ç½®
jasypt:
  encryptor:
    password: ${JASYPT_PASSWORD}  # åŠ å¯†ä¸»å¯†é’¥
```

```bash
# åŠ å¯†å¯†ç 
java -cp jasypt.jar org.jasypt.intf.cli.JasyptPBEStringEncryptionCLI \
  input="MyPassword" \
  password="MasterKey" \
  algorithm="PBEWithMD5AndDES"

# è¾“å‡º: ENC(qwer1234asdf...)
```

**æ–¹æ¡ˆ3ï¼šå¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆæ¨èç”Ÿäº§ï¼‰**

```java
// ä½¿ç”¨HashiCorp Vault
@Configuration
public class VaultConfig {
    
    @Bean
    public RestTemplate vaultRestTemplate() {
        // Vaultå®¢æˆ·ç«¯é…ç½®
        VaultTemplate vaultTemplate = new VaultTemplate(
            VaultEndpoint.create("vault.example.com", 8200),
            new TokenAuthentication("vault-token")
        );
        
        // ä»Vaultè¯»å–è¯ä¹¦å¯†ç 
        VaultResponse response = vaultTemplate.read("secret/data/ssl");
        String password = (String) response.getData().get("keystore-password");
        
        // ä½¿ç”¨å¯†ç ...
        return new RestTemplate();
    }
}
```

### 7.3 æƒé™æ§åˆ¶


**æ–‡ä»¶æƒé™è®¾ç½®**ï¼ˆLinuxï¼‰ï¼š

```bash
# è¯ä¹¦æ–‡ä»¶åªæœ‰åº”ç”¨ç”¨æˆ·å¯è¯»
chmod 600 keystore.p12
chown appuser:appgroup keystore.p12

# éªŒè¯æƒé™
ls -l keystore.p12
# -rw------- 1 appuser appgroup 2048 Jan 1 12:00 keystore.p12
```

**Dockerç¯å¢ƒ**ï¼š

```dockerfile
# Dockerfile
FROM openjdk:11-jre-slim

# åˆ›å»ºérootç”¨æˆ·
RUN useradd -m -u 1000 appuser

# å¤åˆ¶è¯ä¹¦ï¼ˆæ„å»ºæ—¶ï¼Œä¸æ‰“åŒ…åˆ°é•œåƒï¼‰
# ä½¿ç”¨Docker Secrets
USER appuser

# è¿è¡Œæ—¶æŒ‚è½½è¯ä¹¦
# docker run -v /secure/certs:/app/certs app:latest
```

---

## 8. ğŸ“Š è¯ä¹¦ç›‘æ§å‘Šè­¦


### 8.1 ç›‘æ§ç»´åº¦


**éœ€è¦ç›‘æ§çš„æŒ‡æ ‡**ï¼š

```
âœ… è¯ä¹¦æœ‰æ•ˆæœŸ
âœ… è¯ä¹¦é“¾å®Œæ•´æ€§
âœ… è¯ä¹¦åŠé”€çŠ¶æ€
âœ… SSL/TLSåè®®ç‰ˆæœ¬
âœ… åŠ å¯†å¥—ä»¶å®‰å…¨æ€§
```

### 8.2 å®Œæ•´ç›‘æ§å®ç°


```java
@Component
@Slf4j
public class CertificateHealthMonitor {
    
    @Autowired
    private NotificationService notificationService;
    
    // æ¯å¤©æ£€æŸ¥ä¸€æ¬¡
    @Scheduled(cron = "0 0 2 * * ?")
    public void monitorCertificate() {
        CertificateStatus status = checkCertificate();
        
        // åˆ¤æ–­å‘Šè­¦çº§åˆ«
        if (status.getDaysToExpire() < 7) {
            sendAlert(AlertLevel.CRITICAL, status);
        } else if (status.getDaysToExpire() < 30) {
            sendAlert(AlertLevel.WARNING, status);
        }
        
        // è®°å½•ç›‘æ§æ—¥å¿—
        logCertificateStatus(status);
    }
    
    private CertificateStatus checkCertificate() {
        CertificateStatus status = new CertificateStatus();
        
        try {
            // 1. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
            KeyStore ks = loadKeyStore();
            X509Certificate cert = (X509Certificate) ks.getCertificate("myapp");
            
            Date notAfter = cert.getNotAfter();
            long daysLeft = ChronoUnit.DAYS.between(
                LocalDate.now(),
                notAfter.toInstant().atZone(ZoneId.systemDefault()).toLocalDate()
            );
            status.setDaysToExpire(daysLeft);
            
            // 2. æ£€æŸ¥è¯ä¹¦é“¾
            Certificate[] chain = ks.getCertificateChain("myapp");
            status.setChainLength(chain != null ? chain.length : 0);
            status.setChainValid(chain != null && chain.length > 0);
            
            // 3. æ£€æŸ¥è¯ä¹¦åŠé”€çŠ¶æ€ï¼ˆOCSPï¼‰
            status.setRevoked(checkRevocationStatus(cert));
            
            // 4. æ£€æŸ¥TLSç‰ˆæœ¬
            status.setTlsVersion(getCurrentTlsVersion());
            
        } catch (Exception e) {
            log.error("è¯ä¹¦æ£€æŸ¥å¤±è´¥", e);
            status.setHealthy(false);
            status.setError(e.getMessage());
        }
        
        return status;
    }
    
    private boolean checkRevocationStatus(X509Certificate cert) {
        try {
            // ä½¿ç”¨OCSPæ£€æŸ¥è¯ä¹¦æ˜¯å¦è¢«åŠé”€
            Security.setProperty("ocsp.enable", "true");
            
            PKIXParameters params = new PKIXParameters(
                getTrustedCertificates()
            );
            params.setRevocationEnabled(true);
            
            CertPathValidator validator = CertPathValidator.getInstance("PKIX");
            CertificateFactory cf = CertificateFactory.getInstance("X.509");
            CertPath certPath = cf.generateCertPath(Arrays.asList(cert));
            
            validator.validate(certPath, params);
            return false;  // æœªè¢«åŠé”€
            
        } catch (CertPathValidatorException e) {
            if (e.getReason() == CertPathValidatorException.BasicReason.REVOKED) {
                return true;  // å·²è¢«åŠé”€
            }
            throw new RuntimeException("åŠé”€æ£€æŸ¥å¤±è´¥", e);
        } catch (Exception e) {
            throw new RuntimeException("åŠé”€æ£€æŸ¥å¤±è´¥", e);
        }
    }
    
    private void sendAlert(AlertLevel level, CertificateStatus status) {
        String message = String.format(
            "ğŸš¨ è¯ä¹¦å‘Šè­¦ [%s]\n" +
            "å‰©ä½™å¤©æ•°: %då¤©\n" +
            "è¯ä¹¦é“¾: %s\n" +
            "åŠé”€çŠ¶æ€: %s",
            level,
            status.getDaysToExpire(),
            status.isChainValid() ? "å®Œæ•´" : "ä¸å®Œæ•´",
            status.isRevoked() ? "å·²åŠé”€" : "æ­£å¸¸"
        );
        
        // å‘é€å‘Šè­¦
        notificationService.sendAlert(level, message);
    }
}

// å‘Šè­¦çº§åˆ«
enum AlertLevel {
    INFO,     // ä¿¡æ¯
    WARNING,  // è­¦å‘Šï¼ˆ30å¤©å†…è¿‡æœŸï¼‰
    CRITICAL  // ä¸¥é‡ï¼ˆ7å¤©å†…è¿‡æœŸï¼‰
}

// è¯ä¹¦çŠ¶æ€å¯¹è±¡
@Data
class CertificateStatus {
    private long daysToExpire;      // å‰©ä½™å¤©æ•°
    private boolean chainValid;      // è¯ä¹¦é“¾æ˜¯å¦å®Œæ•´
    private int chainLength;         // è¯ä¹¦é“¾é•¿åº¦
    private boolean revoked;         // æ˜¯å¦è¢«åŠé”€
    private String tlsVersion;       // TLSç‰ˆæœ¬
    private boolean healthy = true;  // æ•´ä½“å¥åº·çŠ¶æ€
    private String error;            // é”™è¯¯ä¿¡æ¯
}
```

### 8.3 é›†æˆç›‘æ§ç³»ç»Ÿ


**Prometheusç›‘æ§**ï¼š

```java
@Component
public class CertificateMetrics {
    
    private final Gauge certificateExpiry = Gauge.build()
        .name("ssl_certificate_expiry_days")
        .help("SSLè¯ä¹¦å‰©ä½™å¤©æ•°")
        .register();
    
    private final Gauge certificateChainValid = Gauge.build()
        .name("ssl_certificate_chain_valid")
        .help("è¯ä¹¦é“¾æ˜¯å¦æœ‰æ•ˆ (1=æœ‰æ•ˆ, 0=æ— æ•ˆ)")
        .register();
    
    @Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ›´æ–°
    public void updateMetrics() {
        try {
            KeyStore ks = loadKeyStore();
            X509Certificate cert = (X509Certificate) ks.getCertificate("myapp");
            
            long daysLeft = ChronoUnit.DAYS.between(
                LocalDate.now(),
                cert.getNotAfter().toInstant().atZone(ZoneId.systemDefault()).toLocalDate()
            );
            
            certificateExpiry.set(daysLeft);
            
            Certificate[] chain = ks.getCertificateChain("myapp");
            certificateChainValid.set(chain != null && chain.length > 0 ? 1 : 0);
            
        } catch (Exception e) {
            certificateExpiry.set(-1); // å¼‚å¸¸æ ‡è®°
            certificateChainValid.set(0);
        }
    }
}
```

**Grafanaå‘Šè­¦è§„åˆ™**ï¼š

```yaml
# prometheus-alerts.yml
groups:
  - name: ssl_certificate
    interval: 1h
    rules:
      - alert: CertificateExpiringSoon
        expr: ssl_certificate_expiry_days < 30
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "SSLè¯ä¹¦å³å°†è¿‡æœŸ"
          description: "è¯ä¹¦å°†åœ¨{{ $value }}å¤©åè¿‡æœŸ"
      
      - alert: CertificateExpiringCritical
        expr: ssl_certificate_expiry_days < 7
        for: 1h
        labels:
          severity: critical
        annotations:
          summary: "SSLè¯ä¹¦å³å°†è¿‡æœŸï¼"
          description: "è¯ä¹¦å°†åœ¨{{ $value }}å¤©åè¿‡æœŸï¼Œè¯·ç«‹å³å¤„ç†ï¼"
      
      - alert: CertificateChainInvalid
        expr: ssl_certificate_chain_valid == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "è¯ä¹¦é“¾éªŒè¯å¤±è´¥"
          description: "SSLè¯ä¹¦é“¾ä¸å®Œæ•´æˆ–æ— æ•ˆ"
```

---

## 9. ğŸ›ï¸ CAè¯ä¹¦ç®¡ç†


### 9.1 CAè¯ä¹¦æ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šCAï¼ˆCertificate Authorityï¼‰å°±åƒ"åŠè¯å¤§å…"

```
ç°å®ä¸–ç•Œï¼š
å…¬å®‰å±€ â† åŠç†èº«ä»½è¯çš„æƒå¨æœºæ„

æ•°å­—ä¸–ç•Œï¼š
CAæœºæ„ â† é¢å‘æ•°å­—è¯ä¹¦çš„æƒå¨æœºæ„

çŸ¥åCAæœºæ„ï¼š
ğŸ¢ Let's Encrypt  (å…è´¹)
ğŸ¢ DigiCert       (å•†ä¸š)
ğŸ¢ GlobalSign     (å•†ä¸š)
ğŸ¢ Comodo         (å•†ä¸š)
```

### 9.2 å†…éƒ¨CAæ­å»ºï¼ˆç§æœ‰è¯ä¹¦ï¼‰


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ä¼ä¸šå†…éƒ¨ç³»ç»Ÿé€šä¿¡
- âœ… å¾®æœåŠ¡é—´è®¤è¯
- âœ… å¼€å‘æµ‹è¯•ç¯å¢ƒ

**æ­å»ºæ­¥éª¤**ï¼š

**â‘  åˆ›å»ºæ ¹CA**

```bash
# 1. ç”Ÿæˆæ ¹CAç§é’¥
openssl genrsa -out ca-key.pem 4096

# 2. ç”Ÿæˆæ ¹CAè¯ä¹¦ï¼ˆè‡ªç­¾åï¼Œ10å¹´æœ‰æ•ˆï¼‰
openssl req -new -x509 -days 3650 \
  -key ca-key.pem \
  -out ca-cert.pem \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=MyCompany/CN=MyCompany Root CA"

# ç°åœ¨ä½ æœ‰äº†ï¼š
# ca-key.pem  : æ ¹CAç§é’¥ï¼ˆå¦¥å–„ä¿ç®¡ï¼ï¼‰
# ca-cert.pem : æ ¹CAè¯ä¹¦ï¼ˆå¯ä»¥åˆ†å‘ï¼‰
```

**â‘¡ ç­¾å‘æœåŠ¡å™¨è¯ä¹¦**

```bash
# 1. ç”ŸæˆæœåŠ¡å™¨ç§é’¥
openssl genrsa -out server-key.pem 2048

# 2. ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰
openssl req -new \
  -key server-key.pem \
  -out server.csr \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=MyCompany/CN=api.mycompany.com"

# 3. ç”¨æ ¹CAç­¾å‘æœåŠ¡å™¨è¯ä¹¦ï¼ˆ1å¹´æœ‰æ•ˆï¼‰
openssl x509 -req -days 365 \
  -in server.csr \
  -CA ca-cert.pem \
  -CAkey ca-key.pem \
  -CAcreateserial \
  -out server-cert.pem

# å¾—åˆ°ï¼š
# server-key.pem  : æœåŠ¡å™¨ç§é’¥
# server-cert.pem : æœåŠ¡å™¨è¯ä¹¦ï¼ˆç”±æ ¹CAç­¾å‘ï¼‰
```

**â‘¢ åˆ¶ä½œPKCS12æ ¼å¼**

```bash
# åˆå¹¶è¯ä¹¦å’Œç§é’¥ä¸ºPKCS12æ ¼å¼ï¼ˆSpring Bootå¯ç”¨ï¼‰
openssl pkcs12 -export \
  -in server-cert.pem \
  -inkey server-key.pem \
  -certfile ca-cert.pem \
  -out server.p12 \
  -name myserver \
  -passout pass:server123
```

### 9.3 ä¿¡ä»»è‡ªç­¾åCA


**å®¢æˆ·ç«¯ä¿¡ä»»é…ç½®**ï¼š

**æ–¹å¼1ï¼šJavaä»£ç ä¿¡ä»»**

```java
@Configuration
public class CustomCAConfig {
    
    @Bean
    public RestTemplate restTemplateWithCustomCA() throws Exception {
        // åŠ è½½è‡ªå®šä¹‰CAè¯ä¹¦
        CertificateFactory cf = CertificateFactory.getInstance("X.509");
        Certificate caCert = cf.generateCertificate(
            new FileInputStream("ca-cert.pem")
        );
        
        // åˆ›å»ºä¿¡ä»»åº“
        KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());
        trustStore.load(null, null);
        trustStore.setCertificateEntry("myCA", caCert);
        
        // é…ç½®SSLä¸Šä¸‹æ–‡
        TrustManagerFactory tmf = TrustManagerFactory.getInstance(
            TrustManagerFactory.getDefaultAlgorithm()
        );
        tmf.init(trustStore);
        
        SSLContext sslContext = SSLContext.getInstance("TLS");
        sslContext.init(null, tmf.getTrustManagers(), null);
        
        // åˆ›å»ºHttpClient
        CloseableHttpClient httpClient = HttpClients.custom()
            .setSSLContext(sslContext)
            .setSSLHostnameVerifier(NoopHostnameVerifier.INSTANCE)  // å¼€å‘ç¯å¢ƒå¯ç”¨
            .build();
        
        HttpComponentsClientHttpRequestFactory factory = 
            new HttpComponentsClientHttpRequestFactory(httpClient);
        
        return new RestTemplate(factory);
    }
}
```

**æ–¹å¼2ï¼šç³»ç»Ÿçº§ä¿¡ä»»ï¼ˆLinuxï¼‰**

```bash
# Ubuntu/Debian
sudo cp ca-cert.pem /usr/local/share/ca-certificates/mycompany-ca.crt
sudo update-ca-certificates

# CentOS/RHEL
sudo cp ca-cert.pem /etc/pki/ca-trust/source/anchors/
sudo update-ca-trust

# éªŒè¯
openssl s_client -connect api.mycompany.com:443 -CAfile ca-cert.pem
```

### 9.4 CAè¯ä¹¦è½®æ¢


**ä¸ºä»€ä¹ˆè¦è½®æ¢**ï¼š
- ğŸ”’ æé«˜å®‰å…¨æ€§ï¼ˆå®šæœŸæ›´æ¢ï¼‰
- ğŸ“… æ ¹CAè¯ä¹¦è¿‡æœŸ
- ğŸš¨ ç§é’¥å¯èƒ½æ³„éœ²

**è½®æ¢æ­¥éª¤**ï¼š

```bash
# 1. ç”Ÿæˆæ–°çš„æ ¹CA
openssl genrsa -out ca-key-new.pem 4096
openssl req -new -x509 -days 3650 \
  -key ca-key-new.pem \
  -out ca-cert-new.pem \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=MyCompany/CN=MyCompany Root CA v2"

# 2. ç”¨æ–°CAé‡æ–°ç­¾å‘æ‰€æœ‰æœåŠ¡å™¨è¯ä¹¦
# ï¼ˆæŒ‰ä¹‹å‰çš„æ­¥éª¤ï¼Œç”¨ca-key-new.pemç­¾å‘ï¼‰

# 3. è¿‡æ¸¡æœŸï¼šåŒæ—¶ä¿¡ä»»æ–°æ—§CA
# truststore.p12ä¸­åŒæ—¶åŒ…å«ca-cert.pemå’Œca-cert-new.pem

# 4. é€æ­¥è¿ç§»æ‰€æœ‰æœåŠ¡

# 5. åºŸå¼ƒæ—§CA
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…çŸ¥å¿…ä¼š


```
ğŸ”¸ HTTPSæ ¸å¿ƒï¼šåŠ å¯†ä¼ è¾“ + èº«ä»½éªŒè¯ + æ•°æ®å®Œæ•´æ€§
ğŸ”¸ è¯ä¹¦ä½œç”¨ï¼šè¯æ˜"æˆ‘æ˜¯è°"çš„æ•°å­—èº«ä»½è¯
ğŸ”¸ å¼ºåˆ¶è·³è½¬ï¼šç¡®ä¿æ‰€æœ‰æµé‡èµ°HTTPSåŠ å¯†é€šé“
ğŸ”¸ è‡ªåŠ¨ç»­æœŸï¼šé¿å…è¯ä¹¦è¿‡æœŸå¯¼è‡´æœåŠ¡ä¸­æ–­
ğŸ”¸ è¯ä¹¦é“¾ï¼šå®Œæ•´çš„ä¿¡ä»»é“¾æ¡ï¼Œä»æ ¹CAåˆ°ç½‘ç«™è¯ä¹¦
ğŸ”¸ åŒå‘è®¤è¯ï¼šæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº’ç›¸éªŒè¯èº«ä»½
ğŸ”¸ å®‰å…¨å­˜å‚¨ï¼šè¯ä¹¦å’Œå¯†é’¥è¦åŠ å¯†ä¿æŠ¤ï¼Œä¸èƒ½æ³„éœ²
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šåŠæ—¶å‘ç°è¯ä¹¦é—®é¢˜ï¼Œæå‰å¤„ç†
```

### 10.2 é…ç½®æ£€æŸ¥æ¸…å•


**ç”Ÿäº§ç¯å¢ƒä¸Šçº¿å‰**ï¼š

âœ… **è¯ä¹¦é…ç½®**
- [ ] ä½¿ç”¨æ­£è§„CAé¢å‘çš„è¯ä¹¦ï¼ˆä¸ç”¨è‡ªç­¾åï¼‰
- [ ] è¯ä¹¦åŒ…å«å®Œæ•´è¯ä¹¦é“¾
- [ ] è¯ä¹¦æœ‰æ•ˆæœŸå……è¶³ï¼ˆ>30å¤©ï¼‰
- [ ] è¯ä¹¦åŸŸåä¸å®é™…åŸŸååŒ¹é…

âœ… **HTTPSé…ç½®**
- [ ] å¼ºåˆ¶HTTPSè·³è½¬å·²é…ç½®
- [ ] HSTSå®‰å…¨å¤´å·²å¯ç”¨
- [ ] ç¦ç”¨ä¸å®‰å…¨çš„TLSç‰ˆæœ¬ï¼ˆ<TLS 1.2ï¼‰
- [ ] ä½¿ç”¨å®‰å…¨çš„åŠ å¯†å¥—ä»¶

âœ… **å®‰å…¨åŠ å›º**
- [ ] è¯ä¹¦å¯†ç å·²åŠ å¯†å­˜å‚¨
- [ ] è¯ä¹¦æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆ600ï¼‰
- [ ] ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 
- [ ] ä¸å°†è¯ä¹¦æäº¤åˆ°Git

âœ… **ç›‘æ§å‘Šè­¦**
- [ ] è¯ä¹¦è¿‡æœŸç›‘æ§å·²é…ç½®
- [ ] å‘Šè­¦é€šçŸ¥æ¸ é“å·²æµ‹è¯•
- [ ] è¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²å¯ç”¨
- [ ] è¯ä¹¦å¥åº·æ£€æŸ¥å®šæ—¶ä»»åŠ¡è¿è¡Œ

âœ… **åŒå‘è®¤è¯**ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] å®¢æˆ·ç«¯è¯ä¹¦å·²æ­£ç¡®é…ç½®
- [ ] ä¿¡ä»»åº“åŒ…å«æ‰€æœ‰å®¢æˆ·ç«¯CA
- [ ] è¯ä¹¦åŠé”€æ£€æŸ¥å·²å¯ç”¨

### 10.3 å¸¸è§é—®é¢˜æ’æŸ¥


**é—®é¢˜1ï¼šæµè§ˆå™¨æç¤º"ä¸å®‰å…¨"**
```
åŸå› ï¼š
âŒ ä½¿ç”¨è‡ªç­¾åè¯ä¹¦
âŒ è¯ä¹¦è¿‡æœŸ
âŒ åŸŸåä¸åŒ¹é…
âŒ è¯ä¹¦é“¾ä¸å®Œæ•´

è§£å†³ï¼š
âœ… ä½¿ç”¨æ­£è§„CAè¯ä¹¦
âœ… æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
âœ… ç¡®è®¤åŸŸåé…ç½®æ­£ç¡®
âœ… åŒ…å«å®Œæ•´è¯ä¹¦é“¾
```

**é—®é¢˜2ï¼šè¯ä¹¦éªŒè¯å¤±è´¥**
```
é”™è¯¯ï¼šsun.security.validator.ValidatorException: PKIX path building failed

åŸå› ï¼š
âŒ è¯ä¹¦é“¾ä¸å®Œæ•´
âŒ å®¢æˆ·ç«¯ä¸ä¿¡ä»»CA
âŒ è¯ä¹¦å·²è¿‡æœŸæˆ–è¢«åŠé”€

è§£å†³ï¼š
âœ… ä½¿ç”¨fullchain.pemï¼ˆå®Œæ•´é“¾ï¼‰
âœ… å°†CAè¯ä¹¦åŠ å…¥ä¿¡ä»»åº“
âœ… æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸå’ŒåŠé”€çŠ¶æ€
```

**é—®é¢˜3ï¼šåŒå‘è®¤è¯è¿æ¥å¤±è´¥**
```
é”™è¯¯ï¼šReceived fatal alert: bad_certificate

åŸå› ï¼š
âŒ å®¢æˆ·ç«¯æ²¡æœ‰æä¾›è¯ä¹¦
âŒ å®¢æˆ·ç«¯è¯ä¹¦ä¸åœ¨ä¿¡ä»»åˆ—è¡¨
âŒ å®¢æˆ·ç«¯è¯ä¹¦å·²è¿‡æœŸ

è§£å†³ï¼š
âœ… æ­£ç¡®é…ç½®å®¢æˆ·ç«¯KeyStore
âœ… æœåŠ¡å™¨å¯¼å…¥å®¢æˆ·ç«¯CAè¯ä¹¦
âœ… æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
```

### 10.4 æœ€ä½³å®è·µ


**å¼€å‘ç¯å¢ƒ**ï¼š
- ğŸ’¡ ä½¿ç”¨è‡ªç­¾åè¯ä¹¦å¿«é€Ÿå¼€å‘
- ğŸ’¡ é…ç½®IDEä¿¡ä»»å¼€å‘è¯ä¹¦
- ğŸ’¡ å›¢é˜Ÿå…±äº«å¼€å‘CAè¯ä¹¦

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- ğŸ’¡ ä½¿ç”¨å†…éƒ¨CAç­¾å‘è¯ä¹¦
- ğŸ’¡ æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒé…ç½®
- ğŸ’¡ æµ‹è¯•è¯ä¹¦ç»­æœŸæµç¨‹

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
- ğŸ’¡ ä½¿ç”¨å•†ä¸šæˆ–Let's Encryptè¯ä¹¦
- ğŸ’¡ é…ç½®è‡ªåŠ¨ç»­æœŸå’Œç›‘æ§
- ğŸ’¡ ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ç»Ÿä¸€TLSç»ˆæ­¢
- ğŸ’¡ å®šæœŸå®¡è®¡è¯ä¹¦é…ç½®

**è®°å¿†å£è¯€**ï¼š
```
HTTPSå®‰å…¨å¾ˆé‡è¦ï¼Œè¯ä¹¦é…ç½®ä¸èƒ½å°‘
å¼ºåˆ¶è·³è½¬HTTPè½¬ï¼Œç›‘æ§å‘Šè­¦è¦è¶æ—©
è¯ä¹¦è¿‡æœŸæå‰çŸ¥ï¼Œè‡ªåŠ¨ç»­æœŸä¸ç”¨æ…Œ
åŒå‘è®¤è¯æ›´å®‰å…¨ï¼Œå†…éƒ¨é€šä¿¡å¥½é€‰æ‹©
å¯†é’¥ä¿æŠ¤åˆ«å¿˜è®°ï¼Œç”Ÿäº§ç¯å¢ƒä¸¥æŠŠå…³
```