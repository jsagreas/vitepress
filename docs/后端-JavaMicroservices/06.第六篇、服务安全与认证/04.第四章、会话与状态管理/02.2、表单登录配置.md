---
title: 2ã€è¡¨å•ç™»å½•é…ç½®
---
## ğŸ“š ç›®å½•

1. [è¡¨å•ç™»å½•åŸºæœ¬æ¦‚å¿µ](#1-è¡¨å•ç™»å½•åŸºæœ¬æ¦‚å¿µ)
2. [formLoginæ ¸å¿ƒé…ç½®](#2-formLoginæ ¸å¿ƒé…ç½®)
3. [ç™»å½•é¡µé¢å®šåˆ¶](#3-ç™»å½•é¡µé¢å®šåˆ¶)
4. [ç™»å½•å‚æ•°é…ç½®](#4-ç™»å½•å‚æ•°é…ç½®)
5. [æˆåŠŸä¸å¤±è´¥å¤„ç†](#5-æˆåŠŸä¸å¤±è´¥å¤„ç†)
6. [å®Œæ•´å®æˆ˜æ¡ˆä¾‹](#6-å®Œæ•´å®æˆ˜æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è¡¨å•ç™»å½•åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¡¨å•ç™»å½•


**é€šä¿—ç†è§£**ï¼šè¡¨å•ç™»å½•å°±åƒä½ å»é“¶è¡ŒåŠä¸šåŠ¡éœ€è¦å¡«å†™è¡¨æ ¼ä¸€æ ·ï¼Œç”¨æˆ·åœ¨ç½‘é¡µä¸Šè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œç³»ç»ŸéªŒè¯åå…è®¸è®¿é—®ã€‚

```
ä¼ ç»Ÿç™»å½•æµç¨‹ï¼š
ç”¨æˆ· â†’ è®¿é—®ç½‘ç«™ â†’ è·³è½¬ç™»å½•é¡µ â†’ å¡«å†™è¡¨å• â†’ æäº¤ â†’ éªŒè¯ â†’ è¿›å…¥ç³»ç»Ÿ

             ç™»å½•é¡µé¢
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ç”¨æˆ·å: â–¡  â”‚
         â”‚  å¯†ç :   â–¡  â”‚
         â”‚  [ç™»å½•æŒ‰é’®] â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         éªŒè¯ç”¨æˆ·ä¿¡æ¯
              â†“
         æˆåŠŸ â†’ è·³è½¬ä¸»é¡µ
         å¤±è´¥ â†’ è¿”å›ç™»å½•é¡µ
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **èº«ä»½éªŒè¯**ï¼šç¡®è®¤"ä½ æ˜¯è°"
- ğŸ”¸ **è®¿é—®æ§åˆ¶**ï¼šå†³å®š"èƒ½è®¿é—®ä»€ä¹ˆ"
- ğŸ”¸ **ä¼šè¯å»ºç«‹**ï¼šè®°ä½"ç™»å½•çŠ¶æ€"

### 1.2 Spring Securityè¡¨å•ç™»å½•ç‰¹ç‚¹


**ä¸ä¼ ç»Ÿç™»å½•çš„åŒºåˆ«**ï¼š

| å¯¹æ¯”é¡¹ | **ä¼ ç»Ÿæ‰‹å†™ç™»å½•** | **Spring Securityè¡¨å•ç™»å½•** |
|--------|-----------------|---------------------------|
| å¼€å‘éš¾åº¦ | éœ€è¦è‡ªå·±å†™å…¨éƒ¨é€»è¾‘ | æ¡†æ¶æä¾›ç°æˆæ–¹æ¡ˆ |
| å®‰å…¨æ€§ | å®¹æ˜“é—æ¼å®‰å…¨æªæ–½ | å†…ç½®å¤šé‡å®‰å…¨é˜²æŠ¤ |
| æ‰©å±•æ€§ | ä¿®æ”¹å›°éš¾ | é…ç½®çµæ´»æ˜“æ‰©å±• |
| ä¼šè¯ç®¡ç† | æ‰‹åŠ¨å¤„ç† | è‡ªåŠ¨ç®¡ç†ä¼šè¯ |

**Spring Securityçš„ä¼˜åŠ¿**ï¼š
```
âœ… è‡ªåŠ¨é˜²æŠ¤ï¼šCSRFæ”»å‡»é˜²æŠ¤ã€ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤
âœ… å¯†ç åŠ å¯†ï¼šè‡ªåŠ¨ä½¿ç”¨BCryptç­‰åŠ å¯†ç®—æ³•
âœ… è®°ä½æˆ‘åŠŸèƒ½ï¼šä¸€é”®å®ç°è®°ä½ç™»å½•çŠ¶æ€
âœ… å¹¶å‘æ§åˆ¶ï¼šé™åˆ¶åŒä¸€è´¦å·ç™»å½•æ•°é‡
```

---

## 2. âš™ï¸ formLoginæ ¸å¿ƒé…ç½®


### 2.1 å¯ç”¨è¡¨å•ç™»å½•


**åŸºç¡€é…ç½®**ï¼š
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .formLogin()  // å¯ç”¨è¡¨å•ç™»å½•
                .and()
            .authorizeHttpRequests()
                .anyRequest().authenticated();  // æ‰€æœ‰è¯·æ±‚éœ€è¦è®¤è¯
        
        return http.build();
    }
}
```

**é…ç½®è§£è¯»**ï¼š
- `formLogin()` - å‘Šè¯‰Spring Securityä½¿ç”¨è¡¨å•ç™»å½•æ–¹å¼
- `authorizeHttpRequests()` - é…ç½®å“ªäº›URLéœ€è¦ç™»å½•
- `anyRequest().authenticated()` - æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦å…ˆç™»å½•

### 2.2 formLogin()æ–¹æ³•é“¾


**å®Œæ•´æ–¹æ³•é“¾ç»“æ„**ï¼š
```
formLogin()
  â”œâ”€â”€ loginPage()           â†’ è‡ªå®šä¹‰ç™»å½•é¡µé¢URL
  â”œâ”€â”€ loginProcessingUrl()  â†’ ç™»å½•è¡¨å•æäº¤åœ°å€
  â”œâ”€â”€ defaultSuccessUrl()   â†’ ç™»å½•æˆåŠŸè·³è½¬åœ°å€
  â”œâ”€â”€ failureUrl()          â†’ ç™»å½•å¤±è´¥è·³è½¬åœ°å€
  â”œâ”€â”€ usernameParameter()   â†’ ç”¨æˆ·åå‚æ•°å
  â”œâ”€â”€ passwordParameter()   â†’ å¯†ç å‚æ•°å
  â””â”€â”€ permitAll()           â†’ å…è®¸æ‰€æœ‰äººè®¿é—®ç™»å½•é¡µ
```

**å·¥ä½œæµç¨‹å›¾**ï¼š
```
ç”¨æˆ·è®¿é—®å—ä¿æŠ¤èµ„æº
         â†“
    æœªç™»å½•ï¼Ÿ
         â†“ æ˜¯
  é‡å®šå‘åˆ° loginPage()
         â†“
    ç”¨æˆ·å¡«å†™è¡¨å•
         â†“
  æäº¤åˆ° loginProcessingUrl()
         â†“
     Spring SecurityéªŒè¯
         â†“
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  æˆåŠŸ          å¤±è´¥
    â†“            â†“
defaultSuccessUrl  failureUrl
```

---

## 3. ğŸ¨ ç™»å½•é¡µé¢å®šåˆ¶


### 3.1 loginPage() - è‡ªå®šä¹‰ç™»å½•é¡µé¢


**ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰**ï¼š
- Spring Securityé»˜è®¤ç™»å½•é¡µé¢å¾ˆç®€é™‹ï¼Œä¸ç¬¦åˆä¼ä¸šéœ€æ±‚
- éœ€è¦é…åˆå…¬å¸UIè®¾è®¡ï¼Œç»Ÿä¸€è§†è§‰é£æ ¼
- æ·»åŠ éªŒè¯ç ã€ç¬¬ä¸‰æ–¹ç™»å½•ç­‰é¢å¤–åŠŸèƒ½

**é…ç½®ç¤ºä¾‹**ï¼š
```java
http
    .formLogin()
        .loginPage("/login")  // è‡ªå®šä¹‰ç™»å½•é¡µé¢URL
        .permitAll();         // ç™»å½•é¡µé¢å…è®¸æ‰€æœ‰äººè®¿é—®ï¼ˆé‡è¦ï¼ï¼‰
```

**å…³é”®ç‚¹è¯´æ˜**ï¼š

> **ğŸ’¡ ä¸ºä»€ä¹ˆè¦åŠ permitAll()ï¼Ÿ**
> 
> å¦‚æœä¸åŠ ï¼Œè®¿é—®ç™»å½•é¡µé¢æœ¬èº«ä¹Ÿéœ€è¦ç™»å½•ï¼Œå°±é™·å…¥æ­»å¾ªç¯äº†ï¼
> ```
> è®¿é—®ç™»å½•é¡µ â†’ éœ€è¦ç™»å½• â†’ è·³è½¬ç™»å½•é¡µ â†’ éœ€è¦ç™»å½• â†’ ...ï¼ˆæ— é™å¾ªç¯ï¼‰
> ```

### 3.2 åˆ›å»ºè‡ªå®šä¹‰ç™»å½•é¡µé¢


**Controllerä»£ç **ï¼š
```java
@Controller
public class LoginController {
    
    @GetMapping("/login")
    public String loginPage() {
        return "login";  // è¿”å›ç™»å½•é¡µé¢è§†å›¾
    }
}
```

**HTMLç™»å½•é¡µé¢**ï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰ï¼š
```html
<form action="/login" method="post">
    
    <!-- ç”¨æˆ·åè¾“å…¥æ¡† -->
    <input type="text" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
    
    <!-- å¯†ç è¾“å…¥æ¡† -->
    <input type="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç ">
    
    <!-- CSRFä»¤ç‰Œï¼ˆSpring Securityè‡ªåŠ¨éªŒè¯ï¼‰ -->
    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}">
    
    <!-- æäº¤æŒ‰é’® -->
    <button type="submit">ç™»å½•</button>
</form>
```

**è¡¨å•è¦æ±‚æ¸…å•**ï¼š
- âœ… methodå¿…é¡»æ˜¯`POST`ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
- âœ… actionåœ°å€è¦å’ŒloginProcessingUrl()é…ç½®ä¸€è‡´
- âœ… å¿…é¡»åŒ…å«CSRFä»¤ç‰Œï¼ˆé˜²æ­¢è·¨ç«™æ”»å‡»ï¼‰
- âœ… ç”¨æˆ·åå’Œå¯†ç çš„nameå±æ€§è¦æ­£ç¡®

### 3.3 loginProcessingUrl() - ç™»å½•å¤„ç†åœ°å€


**ä½œç”¨è¯´æ˜**ï¼šæŒ‡å®šè¡¨å•æäº¤çš„å¤„ç†URLï¼ŒSpring Securityä¼šæ‹¦æˆªè¿™ä¸ªURLè¿›è¡Œè®¤è¯ã€‚

```java
http
    .formLogin()
        .loginPage("/login")              // ç™»å½•é¡µé¢
        .loginProcessingUrl("/do-login")  // è¡¨å•æäº¤åœ°å€
        .permitAll();
```

**å¯¹åº”HTML**ï¼š
```html
<form action="/do-login" method="post">
    <!-- è¡¨å•å†…å®¹ -->
</form>
```

**æµç¨‹ç¤ºæ„**ï¼š
```
å‰ç«¯è¡¨å•æäº¤åˆ° /do-login
         â†“
Spring Securityæ‹¦æˆªå™¨æ¥ç®¡
         â†“
æå–ç”¨æˆ·åå’Œå¯†ç 
         â†“
è°ƒç”¨UserDetailsServiceéªŒè¯
         â†“
   éªŒè¯æˆåŠŸ/å¤±è´¥
```

> **âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
> - ä¸éœ€è¦è‡ªå·±å†™Controllerå¤„ç†è¿™ä¸ªURL
> - Spring Securityä¼šè‡ªåŠ¨æ‹¦æˆªå¤„ç†
> - å¦‚æœå†™äº†Controlleråè€Œä¼šå†²çª

---

## 4. ğŸ”§ ç™»å½•å‚æ•°é…ç½®


### 4.1 é»˜è®¤å‚æ•°åç§°


**Spring Securityçš„é»˜è®¤çº¦å®š**ï¼š
```
ç”¨æˆ·åå‚æ•°ï¼šusername
å¯†ç å‚æ•°ï¼špassword
```

**é»˜è®¤HTMLè¡¨å•**ï¼š
```html
<input type="text" name="username">
<input type="password" name="password">
```

### 4.2 è‡ªå®šä¹‰å‚æ•°åç§°


**ä¸šåŠ¡åœºæ™¯**ï¼š
- å‰ç«¯æ¡†æ¶è¦æ±‚ç”¨`account`ä»£æ›¿`username`
- æ‰‹æœºå·ç™»å½•åœºæ™¯ç”¨`mobile`
- é‚®ç®±ç™»å½•åœºæ™¯ç”¨`email`

**é…ç½®æ–¹æ³•**ï¼š
```java
http
    .formLogin()
        .usernameParameter("account")  // è‡ªå®šä¹‰ç”¨æˆ·åå‚æ•°
        .passwordParameter("pwd")      // è‡ªå®šä¹‰å¯†ç å‚æ•°
        .permitAll();
```

**å¯¹åº”HTML**ï¼š
```html
<form action="/login" method="post">
    <input type="text" name="account" placeholder="è´¦å·">
    <input type="password" name="pwd" placeholder="å¯†ç ">
    <button type="submit">ç™»å½•</button>
</form>
```

**å‚æ•°ååŒ¹é…å…³ç³»**ï¼š
```
HTMLè¡¨å•              Spring Securityé…ç½®
name="account"   â†â†’   usernameParameter("account")
name="pwd"       â†â†’   passwordParameter("pwd")

åªæœ‰åç§°å®Œå…¨åŒ¹é…ï¼Œæ‰èƒ½æ­£ç¡®æå–å‚æ•°ï¼
```

---

## 5. âœ… æˆåŠŸä¸å¤±è´¥å¤„ç†


### 5.1 defaultSuccessUrl() - æˆåŠŸè·³è½¬


**ä½œç”¨**ï¼šç™»å½•æˆåŠŸåè·³è½¬åˆ°æŒ‡å®šé¡µé¢ã€‚

**åŸºç¡€é…ç½®**ï¼š
```java
http
    .formLogin()
        .defaultSuccessUrl("/home")  // æˆåŠŸåè·³è½¬åˆ°ä¸»é¡µ
        .permitAll();
```

**ä¸¤ç§è·³è½¬æ¨¡å¼**ï¼š

| æ¨¡å¼ | **é…ç½®** | **è¡Œä¸ºè¯´æ˜** |
|------|---------|-------------|
| é»˜è®¤æ¨¡å¼ | `defaultSuccessUrl("/home")` | å¦‚æœç”¨æˆ·ä¹‹å‰è®¿é—®è¿‡æŸä¸ªé¡µé¢è¢«æ‹¦æˆªï¼Œç™»å½•åè·³å›é‚£ä¸ªé¡µé¢ |
| å¼ºåˆ¶æ¨¡å¼ | `defaultSuccessUrl("/home", true)` | æ— è®ºä¹‹å‰è®¿é—®ä»€ä¹ˆï¼Œç™»å½•åéƒ½è·³åˆ°/home |

**å®é™…åœºæ™¯å¯¹æ¯”**ï¼š
```
åœºæ™¯1ï¼šç”¨æˆ·ç›´æ¥è®¿é—®ç™»å½•é¡µ
ç™»å½•æˆåŠŸ â†’ è·³è½¬åˆ° defaultSuccessUrl é…ç½®çš„åœ°å€

åœºæ™¯2ï¼šç”¨æˆ·è®¿é—® /order è¢«æ‹¦æˆªåˆ°ç™»å½•é¡µ
ç™»å½•æˆåŠŸ â†’ è·³å› /order ï¼ˆè®°ä½äº†åŸå§‹è¯·æ±‚ï¼‰

åœºæ™¯3ï¼šå¼ºåˆ¶æ¨¡å¼
ç™»å½•æˆåŠŸ â†’ æ— è®ºä¹‹å‰è®¿é—®ä»€ä¹ˆéƒ½è·³åˆ° /home
```

### 5.2 failureUrl() - å¤±è´¥è·³è½¬


**ä½œç”¨**ï¼šç™»å½•å¤±è´¥åè·³è½¬åˆ°æŒ‡å®šé¡µé¢ï¼Œå¹¶å¯ä»¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚

**é…ç½®ç¤ºä¾‹**ï¼š
```java
http
    .formLogin()
        .failureUrl("/login?error=true")  // å¤±è´¥åå¸¦å‚æ•°è·³è½¬
        .permitAll();
```

**Controlleræ¥æ”¶é”™è¯¯ä¿¡æ¯**ï¼š
```java
@GetMapping("/login")
public String loginPage(@RequestParam(required = false) String error,
                       Model model) {
    if (error != null) {
        model.addAttribute("errorMsg", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼");
    }
    return "login";
}
```

**HTMLæ˜¾ç¤ºé”™è¯¯**ï¼š
```html
<form action="/login" method="post">
    <!-- é”™è¯¯æç¤º -->
    <div th:if="${errorMsg}" class="error">
        <span th:text="${errorMsg}"></span>
    </div>
    
    <input type="text" name="username">
    <input type="password" name="password">
    <button type="submit">ç™»å½•</button>
</form>
```

### 5.3 é«˜çº§å¤„ç†å™¨


**è‡ªå®šä¹‰æˆåŠŸå¤„ç†å™¨**ï¼ˆé€‚åˆè¿”å›JSONï¼‰ï¼š
```java
@Component
public class MyAuthenticationSuccessHandler 
    implements AuthenticationSuccessHandler {
    
    @Override
    public void onAuthenticationSuccess(HttpServletRequest request,
                                       HttpServletResponse response,
                                       Authentication authentication) 
                                       throws IOException {
        // è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯
        String username = authentication.getName();
        
        // è¿”å›JSONæ ¼å¼
        response.setContentType("application/json;charset=UTF-8");
        response.getWriter().write("{\"code\":200,\"msg\":\"ç™»å½•æˆåŠŸ\",\"username\":\"" + username + "\"}");
    }
}
```

**é…ç½®ä½¿ç”¨**ï¼š
```java
@Autowired
private MyAuthenticationSuccessHandler successHandler;

http
    .formLogin()
        .successHandler(successHandler)  // ä½¿ç”¨è‡ªå®šä¹‰å¤„ç†å™¨
        .permitAll();
```

---

## 6. ğŸ’¼ å®Œæ•´å®æˆ˜æ¡ˆä¾‹


### 6.1 é…ç½®ç±»å®Œæ•´ä»£ç 


```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            // è¡¨å•ç™»å½•é…ç½®
            .formLogin()
                .loginPage("/login")                    // ç™»å½•é¡µé¢
                .loginProcessingUrl("/do-login")        // æäº¤åœ°å€
                .usernameParameter("account")           // ç”¨æˆ·åå‚æ•°
                .passwordParameter("pwd")               // å¯†ç å‚æ•°
                .defaultSuccessUrl("/home", true)       // æˆåŠŸè·³è½¬
                .failureUrl("/login?error=true")        // å¤±è´¥è·³è½¬
                .permitAll()                            // ç™»å½•ç›¸å…³URLå…è®¸è®¿é—®
                
            .and()
            // æˆæƒé…ç½®
            .authorizeHttpRequests()
                .requestMatchers("/css/**", "/js/**").permitAll()  // é™æ€èµ„æºæ”¾è¡Œ
                .anyRequest().authenticated();                     // å…¶ä»–è¯·æ±‚éœ€è®¤è¯
        
        return http.build();
    }
    
    // é…ç½®ç”¨æˆ·ä¿¡æ¯ï¼ˆå®é™…é¡¹ç›®åº”ä»æ•°æ®åº“æŸ¥è¯¢ï¼‰
    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails user = User.builder()
            .username("admin")
            .password("{noop}123456")  // {noop}è¡¨ç¤ºæ˜æ–‡å¯†ç ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰
            .roles("USER")
            .build();
        
        return new InMemoryUserDetailsManager(user);
    }
}
```

### 6.2 ç™»å½•é¡µé¢HTML


```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ç”¨æˆ·ç™»å½•</title>
    <style>
        .login-container {
            width: 300px;
            margin: 100px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .error { color: red; margin-bottom: 10px; }
        input { width: 100%; padding: 8px; margin: 5px 0; }
        button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div class="login-container">
        <h2>ç³»ç»Ÿç™»å½•</h2>
        
        <!-- é”™è¯¯æç¤º -->
        <div th:if="${param.error}" class="error">
            ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼
        </div>
        
        <!-- ç™»å½•è¡¨å• -->
        <form th:action="@{/do-login}" method="post">
            <input type="text" name="account" placeholder="è¯·è¾“å…¥è´¦å·" required>
            <input type="password" name="pwd" placeholder="è¯·è¾“å…¥å¯†ç " required>
            
            <!-- CSRFä»¤ç‰Œï¼ˆThymeleafè‡ªåŠ¨æ·»åŠ ï¼‰ -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            
            <button type="submit">ç™»å½•</button>
        </form>
    </div>
</body>
</html>
```

### 6.3 Controllerä»£ç 


```java
@Controller
public class LoginController {
    
    // æ˜¾ç¤ºç™»å½•é¡µé¢
    @GetMapping("/login")
    public String loginPage() {
        return "login";
    }
    
    // ç™»å½•æˆåŠŸåçš„ä¸»é¡µ
    @GetMapping("/home")
    public String home(Authentication authentication, Model model) {
        // è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
        String username = authentication.getName();
        model.addAttribute("username", username);
        return "home";
    }
}
```

### 6.4 è¿è¡Œæ•ˆæœæµç¨‹


```
æ­¥éª¤1ï¼šå¯åŠ¨åº”ç”¨
æ­¥éª¤2ï¼šè®¿é—® http://localhost:8080/home
         â†“
      æœªç™»å½•ï¼Œè‡ªåŠ¨è·³è½¬
         â†“
æ­¥éª¤3ï¼šåˆ°è¾¾ç™»å½•é¡µ /login
æ­¥éª¤4ï¼šè¾“å…¥ account=admin, pwd=123456
æ­¥éª¤5ï¼šç‚¹å‡»ç™»å½•æŒ‰é’®
         â†“
      æäº¤åˆ° /do-login
         â†“
æ­¥éª¤6ï¼šSpring SecurityéªŒè¯
         â†“
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    æˆåŠŸ          å¤±è´¥
      â†“            â†“
  è·³è½¬åˆ°/home   è·³è½¬å›/login?error=true
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„é…ç½®


```
æ ¸å¿ƒé…ç½®æ–¹æ³•ï¼š
ğŸ”¸ formLogin()          â†’ å¯ç”¨è¡¨å•ç™»å½•
ğŸ”¸ loginPage()          â†’ è‡ªå®šä¹‰ç™»å½•é¡µé¢
ğŸ”¸ loginProcessingUrl() â†’ è¡¨å•æäº¤åœ°å€
ğŸ”¸ usernameParameter()  â†’ ç”¨æˆ·åå‚æ•°å
ğŸ”¸ passwordParameter()  â†’ å¯†ç å‚æ•°å
ğŸ”¸ defaultSuccessUrl()  â†’ æˆåŠŸè·³è½¬åœ°å€
ğŸ”¸ failureUrl()         â†’ å¤±è´¥è·³è½¬åœ°å€
ğŸ”¸ permitAll()          â†’ ç™»å½•ç›¸å…³URLæ”¾è¡Œ
```

### 7.2 å…³é”®ç†è§£ç‚¹


**ğŸ”¹ è¡¨å•å‚æ•°åŒ¹é…åŸåˆ™**
```
HTMLçš„nameå±æ€§ = Spring Securityé…ç½®çš„å‚æ•°å

<input name="username"> â†â†’ usernameParameter("username")
<input name="account">  â†â†’ usernameParameter("account")

ä¸åŒ¹é…å°±æ— æ³•æå–å‚æ•°ï¼Œå¯¼è‡´ç™»å½•å¤±è´¥ï¼
```

**ğŸ”¹ URLé…ç½®å…³ç³»**
```
ç™»å½•é¡µé¢URLï¼š    loginPage("/login")
è¡¨å•æäº¤URLï¼š    loginProcessingUrl("/do-login")
æˆåŠŸè·³è½¬URLï¼š    defaultSuccessUrl("/home")
å¤±è´¥è·³è½¬URLï¼š    failureUrl("/login?error=true")

è¿™äº›URLå¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒï¼Œæ ¹æ®éœ€æ±‚é…ç½®
```

**ğŸ”¹ CSRFä¿æŠ¤æœºåˆ¶**
```
POSTè¯·æ±‚å¿…é¡»æºå¸¦CSRFä»¤ç‰Œï¼Œå¦åˆ™è¢«æ‹¦æˆªï¼

Thymeleafè‡ªåŠ¨å¤„ç†ï¼š
<form th:action="@{/login}" method="post">
  <!-- è‡ªåŠ¨æ·»åŠ CSRFä»¤ç‰Œ -->
</form>

æ‰‹åŠ¨æ·»åŠ ï¼š
<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}">
```

### 7.3 å¸¸è§é”™è¯¯æ’æŸ¥


| é”™è¯¯ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|---------|------------|-------------|
| è®¿é—®ç™»å½•é¡µæ­»å¾ªç¯ | å¿˜è®°é…ç½®permitAll() | åœ¨loginPage()ååŠ .permitAll() |
| æäº¤è¡¨å•404é”™è¯¯ | loginProcessingUrlé…ç½®é”™è¯¯ | æ£€æŸ¥URLæ˜¯å¦å’Œè¡¨å•actionä¸€è‡´ |
| ç™»å½•å¤±è´¥æ— æç¤º | failureUrlæœªé…ç½® | æ·»åŠ .failureUrl("/login?error=true") |
| å‚æ•°æå–å¤±è´¥ | å‚æ•°åä¸åŒ¹é… | ç¡®ä¿HTMLçš„nameå’Œé…ç½®çš„å‚æ•°åä¸€è‡´ |
| CSRFéªŒè¯å¤±è´¥ | ç¼ºå°‘CSRFä»¤ç‰Œ | æ·»åŠ éšè—åŸŸä¼ é€’CSRF token |

### 7.4 å®é™…åº”ç”¨å»ºè®®


**âœ… æ¨èåšæ³•**ï¼š
```
1. ä½¿ç”¨è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼ˆæ›´ç¾è§‚ã€æ›´çµæ´»ï¼‰
2. é…ç½®è¯¦ç»†çš„é”™è¯¯æç¤ºï¼ˆæå‡ç”¨æˆ·ä½“éªŒï¼‰
3. ä½¿ç”¨HTTPSä¼ è¾“ï¼ˆä¿æŠ¤å¯†ç å®‰å…¨ï¼‰
4. å®ç°è®°ä½æˆ‘åŠŸèƒ½ï¼ˆæ–¹ä¾¿ç”¨æˆ·ï¼‰
5. æ·»åŠ éªŒè¯ç ï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰
```

**âŒ é¿å…çš„é—®é¢˜**ï¼š
```
1. ä¸è¦åœ¨URLä¸­ä¼ é€’å¯†ç 
2. ä¸è¦ç¦ç”¨CSRFä¿æŠ¤ï¼ˆé™¤éçœŸçš„ä¸éœ€è¦ï¼‰
3. ä¸è¦åœ¨å‰ç«¯å­˜å‚¨æ˜æ–‡å¯†ç 
4. ä¸è¦å¿˜è®°å¯¹ç™»å½•ç›¸å…³URLæ”¾è¡Œ
```

---

## ğŸ¯ å­¦ä¹ æ£€æŸ¥æ¸…å•


å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
- [ ] ç†è§£è¡¨å•ç™»å½•çš„åŸºæœ¬åŸç†å’Œæµç¨‹
- [ ] é…ç½®è‡ªå®šä¹‰ç™»å½•é¡µé¢å’Œå¤„ç†URL
- [ ] ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç çš„å‚æ•°åç§°
- [ ] å®ç°ç™»å½•æˆåŠŸå’Œå¤±è´¥çš„è·³è½¬
- [ ] åˆ›å»ºå®Œæ•´çš„ç™»å½•åŠŸèƒ½ï¼ˆåŒ…æ‹¬å‰åç«¯ï¼‰
- [ ] æ’æŸ¥å¸¸è§çš„ç™»å½•é…ç½®é—®é¢˜

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è¡¨å•ç™»å½•é…ä¸‰é¡¹ï¼Œé¡µé¢æäº¤å’Œå‚æ•°ï¼›
æˆåŠŸå¤±è´¥å„è·³è½¬ï¼Œæ”¾è¡Œç™»å½•è«å¿˜è®°ï¼›
CSRFä»¤ç‰Œè¦æºå¸¦ï¼Œå‚æ•°åŒ¹é…æ˜¯å…³é”®ã€‚
```