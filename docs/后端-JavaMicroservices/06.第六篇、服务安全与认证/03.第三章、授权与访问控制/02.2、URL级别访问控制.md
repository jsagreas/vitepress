---
title: 2ã€URLçº§åˆ«è®¿é—®æ§åˆ¶
---
## ğŸ“š ç›®å½•

1. [URLè®¿é—®æ§åˆ¶åŸºç¡€æ¦‚å¿µ](#1-URLè®¿é—®æ§åˆ¶åŸºç¡€æ¦‚å¿µ)
2. [è¯·æ±‚æˆæƒé…ç½®æ–¹æ³•](#2-è¯·æ±‚æˆæƒé…ç½®æ–¹æ³•)
3. [è¯·æ±‚åŒ¹é…å™¨è¯¦è§£](#3-è¯·æ±‚åŒ¹é…å™¨è¯¦è§£)
4. [æƒé™æ£€æŸ¥æ–¹å¼](#4-æƒé™æ£€æŸ¥æ–¹å¼)
5. [è·¯å¾„æ¨¡å¼åŒ¹é…è§„åˆ™](#5-è·¯å¾„æ¨¡å¼åŒ¹é…è§„åˆ™)
6. [å®æˆ˜é…ç½®ç¤ºä¾‹](#6-å®æˆ˜é…ç½®ç¤ºä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” URLè®¿é—®æ§åˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯URLçº§åˆ«è®¿é—®æ§åˆ¶


**é€šä¿—ç†è§£**ï¼šå°±åƒå°åŒºé—¨ç¦ç³»ç»Ÿï¼Œä¸åŒçš„é—¨éœ€è¦ä¸åŒçš„æƒé™æ‰èƒ½è¿›å…¥ã€‚

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
ğŸ¢ å…¬å¸å¤§æ¥¼è®¿é—®æ§åˆ¶
â”œâ”€â”€ å¤§å… â†’ æ‰€æœ‰äººå¯ä»¥è¿›å…¥
â”œâ”€â”€ åŠå…¬åŒº â†’ éœ€è¦å‘˜å·¥å¡
â”œâ”€â”€ è´¢åŠ¡å®¤ â†’ åªæœ‰è´¢åŠ¡éƒ¨é—¨å¯ä»¥è¿›
â””â”€â”€ æ€»ç»ç†å®¤ â†’ åªæœ‰é«˜ç®¡å¯ä»¥è¿›

å¯¹åº”åˆ°ç½‘ç«™ï¼š
ğŸŒ ç½‘ç«™URLè®¿é—®æ§åˆ¶
â”œâ”€â”€ /home â†’ æ‰€æœ‰äººå¯ä»¥è®¿é—®
â”œâ”€â”€ /user/** â†’ éœ€è¦ç™»å½•
â”œâ”€â”€ /admin/** â†’ éœ€è¦ç®¡ç†å‘˜è§’è‰²
â””â”€â”€ /api/sensitive â†’ éœ€è¦ç‰¹å®šæƒé™
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ›¡ï¸ **ä¿æŠ¤èµ„æº**ï¼šé˜²æ­¢æœªæˆæƒè®¿é—®æ•æ„Ÿé¡µé¢
- ğŸ‘¤ **åˆ†çº§ç®¡ç†**ï¼šä¸åŒç”¨æˆ·çœ‹åˆ°ä¸åŒå†…å®¹
- ğŸ”’ **å®‰å…¨é˜²æŠ¤**ï¼šä»URLå±‚é¢æ‹¦æˆªéæ³•è¯·æ±‚

### 1.2 Spring Securityä¸­çš„è®¿é—®æ§åˆ¶åŸç†


**å·¥ä½œæµç¨‹**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ è¿‡æ»¤å™¨é“¾ â†’ æƒé™åˆ¤æ–­ â†’ å…è®¸/æ‹’ç»
   â†“          â†“           â†“          â†“
è®¿é—®URL   åŒ¹é…è§„åˆ™    æ£€æŸ¥æƒé™   è¿”å›ç»“æœ
```

**æ ¸å¿ƒæœºåˆ¶**ï¼š
1. **è¯·æ±‚æ‹¦æˆª**ï¼šæ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šè¢«Spring Securityæ‹¦æˆª
2. **è§„åˆ™åŒ¹é…**ï¼šæ ¹æ®URLè·¯å¾„åŒ¹é…é…ç½®çš„è®¿é—®è§„åˆ™
3. **æƒé™éªŒè¯**ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰€éœ€æƒé™
4. **å†³ç­–æ‰§è¡Œ**ï¼šå…è®¸è®¿é—®æˆ–è¿”å›403é”™è¯¯

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šURLè®¿é—®æ§åˆ¶æ˜¯Spring Securityçš„ç¬¬ä¸€é“é˜²çº¿ï¼Œåœ¨è¯·æ±‚åˆ°è¾¾Controllerä¹‹å‰å°±å®Œæˆäº†æƒé™æ£€æŸ¥ã€‚

---

## 2. âš™ï¸ è¯·æ±‚æˆæƒé…ç½®æ–¹æ³•


### 2.1 authorizeHttpRequests() - æ ¸å¿ƒé…ç½®æ–¹æ³•


**ä»€ä¹ˆæ˜¯authorizeHttpRequests**ï¼š
- è¿™æ˜¯Spring Security 6.xæ¨èçš„è¯·æ±‚æˆæƒé…ç½®æ–¹æ³•
- ç”¨æ¥å®šä¹‰"å“ªäº›URLéœ€è¦ä»€ä¹ˆæƒé™æ‰èƒ½è®¿é—®"
- æ›¿ä»£äº†æ—§ç‰ˆæœ¬çš„`authorizeRequests()`ï¼ˆå·²è¿‡æ—¶ï¼‰

**åŸºç¡€é…ç½®ç»“æ„**ï¼š
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // åœ¨è¿™é‡Œé…ç½®URLè®¿é—®è§„åˆ™
                .requestMatchers("/public/**").permitAll()
                .requestMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            );
        return http.build();
    }
}
```

**é…ç½®è¯­æ³•è§£æ**ï¼š
```
authorizeHttpRequests(auth -> auth
    .requestMatchers("URLæ¨¡å¼").æƒé™è¦æ±‚()
    .requestMatchers("URLæ¨¡å¼").æƒé™è¦æ±‚()
    ...
    .anyRequest().æœ€ç»ˆè§„åˆ™()
)

ç­‰ä»·äºï¼š
authorizeHttpRequests(new Customizer<AuthorizeHttpRequestsConfigurer>() {
    @Override
    public void customize(AuthorizeHttpRequestsConfigurer config) {
        config.requestMatchers("URLæ¨¡å¼").æƒé™è¦æ±‚();
        config.anyRequest().æœ€ç»ˆè§„åˆ™();
    }
})
```

### 2.2 é…ç½®è§„åˆ™çš„æ‰§è¡Œé¡ºåº


**é‡è¦åŸåˆ™**ï¼šâš ï¸ **ä»ä¸Šåˆ°ä¸‹åŒ¹é…ï¼Œå…ˆåŒ¹é…å…ˆç”Ÿæ•ˆ**

```java
http.authorizeHttpRequests(auth -> auth
    .requestMatchers("/admin/**").hasRole("ADMIN")     // è§„åˆ™1ï¼šç®¡ç†å‘˜é¡µé¢
    .requestMatchers("/user/**").hasRole("USER")       // è§„åˆ™2ï¼šç”¨æˆ·é¡µé¢
    .requestMatchers("/**").permitAll()                // è§„åˆ™3ï¼šæ‰€æœ‰é¡µé¢
    .anyRequest().denyAll()                            // è§„åˆ™4ï¼šå…œåº•è§„åˆ™
);
```

**åŒ¹é…è¿‡ç¨‹ç¤ºä¾‹**ï¼š
```
è¯·æ±‚ï¼š/admin/dashboard
  â†“
æ£€æŸ¥è§„åˆ™1ï¼š/admin/** â†’ åŒ¹é…æˆåŠŸ âœ“
  â†“
éœ€è¦ADMINè§’è‰² â†’ åœæ­¢åŒ¹é…ï¼Œä¸å†æ£€æŸ¥åç»­è§„åˆ™

è¯·æ±‚ï¼š/home
  â†“
æ£€æŸ¥è§„åˆ™1ï¼š/admin/** â†’ ä¸åŒ¹é… âœ—
  â†“
æ£€æŸ¥è§„åˆ™2ï¼š/user/** â†’ ä¸åŒ¹é… âœ—
  â†“
æ£€æŸ¥è§„åˆ™3ï¼š/** â†’ åŒ¹é…æˆåŠŸ âœ“
  â†“
å…è®¸æ‰€æœ‰äººè®¿é—®
```

> ğŸš¨ **å¸¸è§é”™è¯¯**ï¼šæŠŠé€šç”¨è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œå¯¼è‡´å…·ä½“è§„åˆ™æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼
> 
> âŒ é”™è¯¯ç¤ºä¾‹ï¼š
> ```java
> .requestMatchers("/**").permitAll()      // è¿™ä¸ªä¼šåŒ¹é…æ‰€æœ‰è¯·æ±‚
> .requestMatchers("/admin/**").hasRole("ADMIN")  // æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
> ```

---

## 3. ğŸ¯ è¯·æ±‚åŒ¹é…å™¨è¯¦è§£


### 3.1 requestMatchers() - URLåŒ¹é…å™¨


**ä½œç”¨**ï¼šæŒ‡å®šè¦åº”ç”¨è®¿é—®æ§åˆ¶çš„URLè·¯å¾„æ¨¡å¼ã€‚

**å¸¸ç”¨åŒ¹é…æ–¹å¼**ï¼š

#### ğŸ“ æ–¹å¼1ï¼šå­—ç¬¦ä¸²è·¯å¾„åŒ¹é…

```java
// ç²¾ç¡®åŒ¹é…
.requestMatchers("/login").permitAll()           // åªåŒ¹é… /login

// Anté£æ ¼é€šé…ç¬¦ï¼ˆæœ€å¸¸ç”¨ï¼‰
.requestMatchers("/admin/**").hasRole("ADMIN")   // /admin/ä¸‹æ‰€æœ‰è·¯å¾„
.requestMatchers("/api/*.json").permitAll()      // /api/ä¸‹æ‰€æœ‰.jsonæ–‡ä»¶
.requestMatchers("/user/*/profile").authenticated() // /user/ä»»æ„/profile
```

#### ğŸ“ æ–¹å¼2ï¼šHTTPæ–¹æ³•åŒ¹é…

```java
// åªå¯¹ç‰¹å®šHTTPæ–¹æ³•ç”Ÿæ•ˆ
.requestMatchers(HttpMethod.POST, "/api/users").hasRole("ADMIN")
.requestMatchers(HttpMethod.GET, "/api/users").permitAll()
.requestMatchers(HttpMethod.DELETE, "/api/**").hasAuthority("DELETE")
```

**å®æˆ˜ç¤ºä¾‹**ï¼š
```java
http.authorizeHttpRequests(auth -> auth
    // 1. é™æ€èµ„æº - æ‰€æœ‰äººå¯è®¿é—®
    .requestMatchers("/css/**", "/js/**", "/images/**").permitAll()
    
    // 2. ç™»å½•æ³¨å†Œ - åŒ¿åç”¨æˆ·å¯è®¿é—®
    .requestMatchers("/login", "/register").permitAll()
    
    // 3. APIæ¥å£ - æŒ‰HTTPæ–¹æ³•åŒºåˆ†
    .requestMatchers(HttpMethod.GET, "/api/products").permitAll()     // æŸ¥çœ‹å•†å“
    .requestMatchers(HttpMethod.POST, "/api/products").hasRole("ADMIN") // æ·»åŠ å•†å“
    .requestMatchers(HttpMethod.DELETE, "/api/products/**").hasRole("ADMIN")
    
    // 4. ç®¡ç†åå° - éœ€è¦ç®¡ç†å‘˜
    .requestMatchers("/admin/**").hasRole("ADMIN")
    
    // 5. å…¶ä»–æ‰€æœ‰è¯·æ±‚ - éœ€è¦ç™»å½•
    .anyRequest().authenticated()
);
```

### 3.2 å¤šæ¡ä»¶ç»„åˆåŒ¹é…


**åŒæ—¶åŒ¹é…å¤šä¸ªè·¯å¾„**ï¼š
```java
// æ–¹å¼1ï¼šå¯å˜å‚æ•°
.requestMatchers("/login", "/register", "/forgot-password").permitAll()

// æ–¹å¼2ï¼šæ•°ç»„å½¢å¼
String[] publicUrls = {"/login", "/register", "/forgot-password"};
.requestMatchers(publicUrls).permitAll()
```

**åŒ¹é…ç‰¹å®šæ–‡ä»¶ç±»å‹**ï¼š
```java
.requestMatchers(
    "/css/**", 
    "/js/**", 
    "/images/**",
    "/**/*.css",
    "/**/*.js",
    "/**/*.png",
    "/**/*.jpg"
).permitAll()
```

---

## 4. âœ… æƒé™æ£€æŸ¥æ–¹å¼


### 4.1 permitAll() - å…è®¸æ‰€æœ‰è®¿é—®


**å«ä¹‰**ï¼šä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ï¼ŒåŒ…æ‹¬æœªç™»å½•ç”¨æˆ·ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ğŸ  é¦–é¡µã€å…¬å‘Šé¡µé¢
- ğŸ“„ é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ï¼‰
- ğŸ”“ ç™»å½•ã€æ³¨å†Œé¡µé¢
- ğŸ“š å…¬å¼€APIæ–‡æ¡£

```java
.requestMatchers("/", "/home", "/about").permitAll()
.requestMatchers("/static/**").permitAll()
.requestMatchers("/api/public/**").permitAll()
```

### 4.2 authenticated() - éœ€è¦è®¤è¯


**å«ä¹‰**ï¼šå¿…é¡»ç™»å½•æ‰èƒ½è®¿é—®ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆè§’è‰²ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ğŸ‘¤ ç”¨æˆ·ä¸ªäººä¸­å¿ƒ
- ğŸ“ éœ€è¦ç™»å½•çš„åŠŸèƒ½
- ğŸ’¬ è¯„è®ºã€ç‚¹èµç­‰äº’åŠ¨åŠŸèƒ½

```java
.requestMatchers("/user/**").authenticated()
.requestMatchers("/profile", "/settings").authenticated()
.requestMatchers("/api/comments").authenticated()
```

**è®¤è¯vsæˆæƒçš„åŒºåˆ«**ï¼š
```
è®¤è¯(Authentication)ï¼šéªŒè¯"ä½ æ˜¯è°"
â”œâ”€â”€ æ£€æŸ¥æ˜¯å¦ç™»å½•
â””â”€â”€ åªè¦ç™»å½•å°±å¯ä»¥è®¿é—®

æˆæƒ(Authorization)ï¼šéªŒè¯"ä½ èƒ½åšä»€ä¹ˆ"
â”œâ”€â”€ æ£€æŸ¥è§’è‰²/æƒé™
â””â”€â”€ å¿…é¡»æœ‰ç‰¹å®šè§’è‰²æ‰èƒ½è®¿é—®
```

### 4.3 hasRole() - å•ä¸ªè§’è‰²æ£€æŸ¥


**å«ä¹‰**ï¼šå¿…é¡»æ‹¥æœ‰æŒ‡å®šè§’è‰²æ‰èƒ½è®¿é—®ã€‚

**é‡è¦ç‰¹æ€§**ï¼š
- ğŸ”¸ ä¼šè‡ªåŠ¨æ·»åŠ `ROLE_`å‰ç¼€
- ğŸ”¸ é…ç½®æ—¶å†™`ADMIN`ï¼Œå®é™…æ£€æŸ¥`ROLE_ADMIN`
- ğŸ”¸ åŒºåˆ†å¤§å°å†™

```java
// åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®
.requestMatchers("/admin/**").hasRole("ADMIN")

// åªæœ‰VIPç”¨æˆ·å¯ä»¥è®¿é—®
.requestMatchers("/vip/**").hasRole("VIP")
```

**è§’è‰²çš„å­˜å‚¨æ ¼å¼**ï¼š
```java
// åœ¨UserDetailsä¸­å­˜å‚¨è§’è‰²
public Collection<? extends GrantedAuthority> getAuthorities() {
    return List.of(
        new SimpleGrantedAuthority("ROLE_ADMIN"),    // è§’è‰²å¿…é¡»æœ‰ROLE_å‰ç¼€
        new SimpleGrantedAuthority("ROLE_USER")
    );
}

// Spring Securityé…ç½®
.hasRole("ADMIN")  // ä¼šè‡ªåŠ¨åŒ¹é… ROLE_ADMIN
```

### 4.4 hasAuthority() - æƒé™æ£€æŸ¥


**å«ä¹‰**ï¼šå¿…é¡»æ‹¥æœ‰æŒ‡å®šæƒé™æ‰èƒ½è®¿é—®ã€‚

**ä¸hasRoleçš„åŒºåˆ«**ï¼š
```
hasRole("ADMIN")
â”œâ”€â”€ è‡ªåŠ¨æ·»åŠ  ROLE_ å‰ç¼€
â”œâ”€â”€ å®é™…æ£€æŸ¥ï¼šROLE_ADMIN
â””â”€â”€ ç”¨äºæ£€æŸ¥è§’è‰²

hasAuthority("ROLE_ADMIN")
â”œâ”€â”€ ä¸æ·»åŠ å‰ç¼€
â”œâ”€â”€ æ£€æŸ¥ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆ
â””â”€â”€ ç”¨äºæ£€æŸ¥å…·ä½“æƒé™
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// æ£€æŸ¥å…·ä½“æ“ä½œæƒé™
.requestMatchers("/api/users/delete").hasAuthority("DELETE_USER")
.requestMatchers("/api/products/edit").hasAuthority("EDIT_PRODUCT")

// ä¹Ÿå¯ä»¥ç”¨æ¥æ£€æŸ¥è§’è‰²ï¼ˆæ‰‹åŠ¨åŠ å‰ç¼€ï¼‰
.requestMatchers("/admin/**").hasAuthority("ROLE_ADMIN")
```

**æƒé™ç²’åº¦å¯¹æ¯”**ï¼š
```
è§’è‰²(Role)ï¼šç²—ç²’åº¦
â”œâ”€â”€ ADMIN â†’ ç®¡ç†å‘˜
â”œâ”€â”€ USER â†’ æ™®é€šç”¨æˆ·
â””â”€â”€ VIP â†’ VIPç”¨æˆ·

æƒé™(Authority)ï¼šç»†ç²’åº¦
â”œâ”€â”€ READ_USER â†’ æŸ¥çœ‹ç”¨æˆ·
â”œâ”€â”€ CREATE_USER â†’ åˆ›å»ºç”¨æˆ·
â”œâ”€â”€ DELETE_USER â†’ åˆ é™¤ç”¨æˆ·
â””â”€â”€ EDIT_PRODUCT â†’ ç¼–è¾‘å•†å“
```

### 4.5 hasAnyRole() / hasAnyAuthority() - å¤šæ¡ä»¶æ£€æŸ¥


**å«ä¹‰**ï¼šæ»¡è¶³ä»»æ„ä¸€ä¸ªæ¡ä»¶å³å¯è®¿é—®ã€‚

**hasAnyRoleç¤ºä¾‹**ï¼š
```java
// ç®¡ç†å‘˜æˆ–ç‰ˆä¸»éƒ½å¯ä»¥è®¿é—®
.requestMatchers("/moderate/**").hasAnyRole("ADMIN", "MODERATOR")

// ç­‰ä»·äºï¼šROLE_ADMIN æˆ– ROLE_MODERATOR
```

**hasAnyAuthorityç¤ºä¾‹**ï¼š
```java
// æ‹¥æœ‰ä»»ä¸€æƒé™å³å¯
.requestMatchers("/api/content/manage").hasAnyAuthority(
    "EDIT_CONTENT",
    "DELETE_CONTENT",
    "APPROVE_CONTENT"
)
```

**å®æˆ˜åœºæ™¯**ï¼š
```java
// å†…å®¹ç®¡ç†ç³»ç»Ÿ
http.authorizeHttpRequests(auth -> auth
    // 1. å…¬å¼€å†…å®¹ - æ‰€æœ‰äººå¯çœ‹
    .requestMatchers("/articles/view/**").permitAll()
    
    // 2. å‘å¸ƒæ–‡ç«  - ä½œè€…å’Œç¼–è¾‘å¯ä»¥
    .requestMatchers("/articles/create").hasAnyRole("AUTHOR", "EDITOR")
    
    // 3. å®¡æ ¸æ–‡ç«  - ç¼–è¾‘å’Œç®¡ç†å‘˜å¯ä»¥
    .requestMatchers("/articles/review/**").hasAnyRole("EDITOR", "ADMIN")
    
    // 4. åˆ é™¤æ–‡ç«  - åªæœ‰ç®¡ç†å‘˜
    .requestMatchers("/articles/delete/**").hasRole("ADMIN")
);
```

### 4.6 access() - è‡ªå®šä¹‰æƒé™è¡¨è¾¾å¼


**å«ä¹‰**ï¼šä½¿ç”¨SpELè¡¨è¾¾å¼è¿›è¡Œå¤æ‚çš„æƒé™åˆ¤æ–­ã€‚

**åŸºç¡€è¯­æ³•**ï¼š
```java
.requestMatchers("/api/users/{id}/edit")
    .access("@permissionChecker.canEditUser(authentication, #id)")
```

**å¸¸ç”¨SpELè¡¨è¾¾å¼**ï¼š
```java
// 1. æ£€æŸ¥æ˜¯å¦è®¤è¯
.access("isAuthenticated()")

// 2. æ£€æŸ¥æ˜¯å¦åŒ¿å
.access("isAnonymous()")

// 3. æ£€æŸ¥è§’è‰²ï¼ˆORå…³ç³»ï¼‰
.access("hasRole('ADMIN') or hasRole('MODERATOR')")

// 4. æ£€æŸ¥è§’è‰²ï¼ˆANDå…³ç³»ï¼‰
.access("hasRole('ADMIN') and hasAuthority('SUPER_ADMIN')")

// 5. è°ƒç”¨è‡ªå®šä¹‰Beanæ–¹æ³•
.access("@customSecurity.check(authentication, request)")
```

**è‡ªå®šä¹‰æƒé™æ£€æŸ¥å™¨**ï¼š
```java
@Component("permissionChecker")
public class PermissionChecker {
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥ç¼–è¾‘æŒ‡å®šç”¨æˆ·
    public boolean canEditUser(Authentication auth, String userId) {
        String currentUserId = auth.getName();
        
        // ç®¡ç†å‘˜å¯ä»¥ç¼–è¾‘ä»»ä½•äºº
        if (hasRole(auth, "ADMIN")) {
            return true;
        }
        
        // æ™®é€šç”¨æˆ·åªèƒ½ç¼–è¾‘è‡ªå·±
        return currentUserId.equals(userId);
    }
    
    private boolean hasRole(Authentication auth, String role) {
        return auth.getAuthorities().stream()
            .anyMatch(a -> a.getAuthority().equals("ROLE_" + role));
    }
}
```

---

## 5. ğŸ¨ è·¯å¾„æ¨¡å¼åŒ¹é…è§„åˆ™


### 5.1 Anté£æ ¼é€šé…ç¬¦


**ä¸‰ç§é€šé…ç¬¦**ï¼š

| é€šé…ç¬¦ | å«ä¹‰ | ç¤ºä¾‹ | åŒ¹é…ç»“æœ |
|--------|------|------|----------|
| `?` | åŒ¹é…å•ä¸ªå­—ç¬¦ | `/user/?.html` | `/user/1.html` âœ“<br>`/user/a.html` âœ“<br>`/user/12.html` âœ— |
| `*` | åŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦<br>ï¼ˆä¸å«`/`ï¼‰ | `/user/*.html` | `/user/index.html` âœ“<br>`/user/a.html` âœ“<br>`/user/admin/a.html` âœ— |
| `**` | åŒ¹é…0ä¸ªæˆ–å¤šä¸ªè·¯å¾„æ®µ | `/admin/**` | `/admin` âœ“<br>`/admin/user` âœ“<br>`/admin/user/list` âœ“ |

### 5.2 é€šé…ç¬¦ä½¿ç”¨ç¤ºä¾‹


**å•æ˜Ÿå·`*`çš„ä½¿ç”¨**ï¼š
```java
// åŒ¹é…ï¼š/api/users.json, /api/products.json
// ä¸åŒ¹é…ï¼š/api/users/1.json
.requestMatchers("/api/*.json").permitAll()

// åŒ¹é…ï¼š/files/a.pdf, /files/doc.pdf
// ä¸åŒ¹é…ï¼š/files/folder/a.pdf
.requestMatchers("/files/*.pdf").authenticated()
```

**åŒæ˜Ÿå·`**`çš„ä½¿ç”¨**ï¼š
```java
// åŒ¹é… /admin ä¸‹çš„æ‰€æœ‰è·¯å¾„
// /admin, /admin/users, /admin/users/1, /admin/users/1/edit
.requestMatchers("/admin/**").hasRole("ADMIN")

// åŒ¹é…æ‰€æœ‰ .js æ–‡ä»¶ï¼Œä¸ç®¡åœ¨å“ªä¸ªç›®å½•
// /js/app.js, /static/js/app.js, /admin/static/js/app.js
.requestMatchers("/**/*.js").permitAll()
```

**é—®å·`?`çš„ä½¿ç”¨**ï¼š
```java
// åŒ¹é…ï¼š/user/1, /user/a, /user/5
// ä¸åŒ¹é…ï¼š/user/12, /user/ab
.requestMatchers("/user/?").authenticated()

// åŒ¹é…ï¼š/doc/a.pdf, /doc/1.pdf
// ä¸åŒ¹é…ï¼š/doc/ab.pdf
.requestMatchers("/doc/?.pdf").permitAll()
```

### 5.3 å¸¸è§åŒ¹é…æ¨¡å¼


**é™æ€èµ„æºåŒ¹é…**ï¼š
```java
.requestMatchers(
    "/static/**",        // æ‰€æœ‰staticç›®å½•ä¸‹çš„æ–‡ä»¶
    "/css/**",           // æ‰€æœ‰cssç›®å½•ä¸‹çš„æ–‡ä»¶
    "/js/**",            // æ‰€æœ‰jsç›®å½•ä¸‹çš„æ–‡ä»¶
    "/images/**",        // æ‰€æœ‰imagesç›®å½•ä¸‹çš„æ–‡ä»¶
    "/webjars/**",       // WebJarsèµ„æº
    "/favicon.ico"       // ç½‘ç«™å›¾æ ‡
).permitAll()
```

**APIæ¥å£åŒ¹é…**ï¼š
```java
.requestMatchers("/api/public/**").permitAll()           // å…¬å¼€API
.requestMatchers("/api/v1/**").authenticated()           // V1ç‰ˆæœ¬API
.requestMatchers("/api/admin/**").hasRole("ADMIN")       // ç®¡ç†API
.requestMatchers("/api/**/export").hasAuthority("EXPORT") // æ‰€æœ‰å¯¼å‡ºæ¥å£
```

**RESTfulé£æ ¼åŒ¹é…**ï¼š
```java
.requestMatchers(HttpMethod.GET, "/api/users").permitAll()
.requestMatchers(HttpMethod.POST, "/api/users").hasRole("ADMIN")
.requestMatchers(HttpMethod.PUT, "/api/users/*").hasRole("ADMIN")
.requestMatchers(HttpMethod.DELETE, "/api/users/*").hasRole("ADMIN")
```

### 5.4 åŒ¹é…ä¼˜å…ˆçº§ä¸å†²çªå¤„ç†


**ä¼˜å…ˆçº§è§„åˆ™**ï¼š
```
ç²¾ç¡®åŒ¹é… > æœ€é•¿è·¯å¾„åŒ¹é… > é€šé…ç¬¦åŒ¹é…
```

**ç¤ºä¾‹è¯´æ˜**ï¼š
```java
http.authorizeHttpRequests(auth -> auth
    .requestMatchers("/admin/public").permitAll()           // è§„åˆ™1ï¼šç²¾ç¡®
    .requestMatchers("/admin/users/**").hasRole("ADMIN")    // è§„åˆ™2ï¼šå…·ä½“
    .requestMatchers("/admin/**").hasRole("SUPER_ADMIN")    // è§„åˆ™3ï¼šé€šç”¨
);

åŒ¹é…è¿‡ç¨‹ï¼š
/admin/public       â†’ è§„åˆ™1 âœ“ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
/admin/users/list   â†’ è§„åˆ™2 âœ“ï¼ˆæœ€é•¿è·¯å¾„ï¼‰
/admin/settings     â†’ è§„åˆ™3 âœ“ï¼ˆé€šé…ç¬¦ï¼‰
```

> âš ï¸ **æœ€ä½³å®è·µ**ï¼šæŠŠæœ€å…·ä½“çš„è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œæœ€é€šç”¨çš„è§„åˆ™æ”¾åœ¨åé¢ã€‚

---

## 6. ğŸ’¼ å®æˆ˜é…ç½®ç¤ºä¾‹


### 6.1 åŸºç¡€ç”µå•†ç½‘ç«™é…ç½®


```java
@Configuration
@EnableWebSecurity
public class EcommerceSecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // 1. é™æ€èµ„æº - å®Œå…¨å…¬å¼€
                .requestMatchers("/css/**", "/js/**", "/images/**", "/favicon.ico")
                    .permitAll()
                
                // 2. é¦–é¡µå’Œå•†å“æµè§ˆ - å®Œå…¨å…¬å¼€
                .requestMatchers("/", "/home", "/products/**", "/search")
                    .permitAll()
                
                // 3. ç”¨æˆ·è®¤è¯ç›¸å…³ - åŒ¿åå¯è®¿é—®
                .requestMatchers("/login", "/register", "/forgot-password")
                    .permitAll()
                
                // 4. è´­ç‰©è½¦å’Œè®¢å• - éœ€è¦ç™»å½•
                .requestMatchers("/cart/**", "/checkout/**", "/orders/**")
                    .authenticated()
                
                // 5. ç”¨æˆ·ä¸­å¿ƒ - éœ€è¦ç™»å½•
                .requestMatchers("/profile/**", "/settings/**")
                    .authenticated()
                
                // 6. å–å®¶ä¸­å¿ƒ - éœ€è¦å–å®¶è§’è‰²
                .requestMatchers("/seller/**")
                    .hasRole("SELLER")
                
                // 7. ç®¡ç†åå° - éœ€è¦ç®¡ç†å‘˜
                .requestMatchers("/admin/**")
                    .hasRole("ADMIN")
                
                // 8. å…¶ä»–æ‰€æœ‰è¯·æ±‚ - éœ€è¦è®¤è¯
                .anyRequest()
                    .authenticated()
            );
        
        return http.build();
    }
}
```

### 6.2 ä¼ä¸šç®¡ç†ç³»ç»Ÿé…ç½®


```java
@Configuration
@EnableWebSecurity
public class EnterpriseSecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // 1. å…¬å…±èµ„æº
                .requestMatchers("/static/**", "/public/**").permitAll()
                .requestMatchers("/login", "/logout").permitAll()
                
                // 2. éƒ¨é—¨ç®¡ç†æ¨¡å— - HRå’Œç®¡ç†å‘˜
                .requestMatchers("/dept/**")
                    .hasAnyRole("HR", "ADMIN")
                
                // 3. å‘˜å·¥ç®¡ç† - HRéƒ¨é—¨
                .requestMatchers("/employee/**")
                    .hasRole("HR")
                
                // 4. è´¢åŠ¡æ¨¡å— - è´¢åŠ¡éƒ¨é—¨
                .requestMatchers("/finance/**")
                    .hasRole("FINANCE")
                
                // 5. æŠ¥è¡¨æŸ¥çœ‹ - å¤šä¸ªè§’è‰²
                .requestMatchers(HttpMethod.GET, "/reports/**")
                    .hasAnyRole("FINANCE", "MANAGER", "ADMIN")
                
                // 6. æŠ¥è¡¨å¯¼å‡º - éœ€è¦ç‰¹å®šæƒé™
                .requestMatchers("/reports/export/**")
                    .hasAuthority("EXPORT_DATA")
                
                // 7. ç³»ç»Ÿè®¾ç½® - åªæœ‰ç®¡ç†å‘˜
                .requestMatchers("/system/**")
                    .hasRole("ADMIN")
                
                // 8. APIæ¥å£ - æŒ‰HTTPæ–¹æ³•åŒºåˆ†
                .requestMatchers(HttpMethod.GET, "/api/**")
                    .authenticated()
                .requestMatchers(HttpMethod.POST, "/api/**")
                    .hasAnyAuthority("CREATE", "ADMIN")
                .requestMatchers(HttpMethod.DELETE, "/api/**")
                    .hasRole("ADMIN")
                
                // 9. å…¶ä»–è¯·æ±‚
                .anyRequest().authenticated()
            );
        
        return http.build();
    }
}
```

### 6.3 å†…å®¹ç®¡ç†ç³»ç»Ÿé…ç½®


```java
@Configuration
@EnableWebSecurity
public class CmsSecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // 1. å‰å°å†…å®¹æµè§ˆ - å…¬å¼€
                .requestMatchers("/articles/**", "/category/**", "/tag/**")
                    .permitAll()
                
                // 2. å†…å®¹åˆ›ä½œ - ä½œè€…åŠä»¥ä¸Š
                .requestMatchers("/create/**", "/draft/**")
                    .hasAnyRole("AUTHOR", "EDITOR", "ADMIN")
                
                // 3. å†…å®¹ç¼–è¾‘ - ç¼–è¾‘åŠä»¥ä¸Š
                .requestMatchers("/edit/**")
                    .hasAnyRole("EDITOR", "ADMIN")
                
                // 4. å†…å®¹å®¡æ ¸ - ç¼–è¾‘åŠä»¥ä¸Š
                .requestMatchers("/review/**", "/approve/**")
                    .hasAnyRole("EDITOR", "ADMIN")
                
                // 5. å†…å®¹å‘å¸ƒ - ç¼–è¾‘åŠä»¥ä¸Š
                .requestMatchers("/publish/**")
                    .hasAnyRole("EDITOR", "ADMIN")
                
                // 6. ç”¨æˆ·ç®¡ç† - åªæœ‰ç®¡ç†å‘˜
                .requestMatchers("/users/manage/**")
                    .hasRole("ADMIN")
                
                // 7. è¯„è®ºç®¡ç† - ç‰ˆä¸»åŠä»¥ä¸Š
                .requestMatchers("/comments/manage/**")
                    .hasAnyRole("MODERATOR", "EDITOR", "ADMIN")
                
                // 8. å…¶ä»–è¯·æ±‚
                .anyRequest().authenticated()
            );
        
        return http.build();
    }
}
```

### 6.4 å¤šç§Ÿæˆ·SaaSå¹³å°é…ç½®


```java
@Configuration
@EnableWebSecurity
public class SaasSecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                // 1. ç§Ÿæˆ·æ³¨å†Œå’Œç™»å½•
                .requestMatchers("/tenant/register", "/tenant/login")
                    .permitAll()
                
                // 2. ç§Ÿæˆ·ç®¡ç†ç«¯
                .requestMatchers("/tenant/admin/**")
                    .hasRole("TENANT_ADMIN")
                
                // 3. ç§Ÿæˆ·æ™®é€šç”¨æˆ·
                .requestMatchers("/tenant/user/**")
                    .hasAnyRole("TENANT_USER", "TENANT_ADMIN")
                
                // 4. å¹³å°ç®¡ç†ç«¯ - å¹³å°ç®¡ç†å‘˜
                .requestMatchers("/platform/admin/**")
                    .hasRole("PLATFORM_ADMIN")
                
                // 5. è®¡è´¹ç›¸å…³ - éœ€è¦ç‰¹å®šæƒé™
                .requestMatchers("/billing/**")
                    .hasAuthority("MANAGE_BILLING")
                
                // 6. APIè®¿é—® - éœ€è¦APIå¯†é’¥
                .requestMatchers("/api/v1/**")
                    .hasAuthority("API_ACCESS")
                
                // 7. Webhook - ç‰¹å®šæƒé™
                .requestMatchers("/webhook/**")
                    .hasAuthority("WEBHOOK_ACCESS")
                
                .anyRequest().authenticated()
            );
        
        return http.build();
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ URLè®¿é—®æ§åˆ¶ï¼šä»URLå±‚é¢æ‹¦æˆªå’Œä¿æŠ¤èµ„æº
ğŸ”¸ authorizeHttpRequests()ï¼šSpring Security 6.xçš„æ ¸å¿ƒé…ç½®æ–¹æ³•
ğŸ”¸ requestMatchers()ï¼šå®šä¹‰è¦åŒ¹é…çš„URLæ¨¡å¼
ğŸ”¸ ä»ä¸Šåˆ°ä¸‹åŒ¹é…ï¼šè§„åˆ™é¡ºåºå¾ˆé‡è¦ï¼Œå…ˆåŒ¹é…å…ˆç”Ÿæ•ˆ
ğŸ”¸ Anté€šé…ç¬¦ï¼š?å•å­—ç¬¦ *å¤šå­—ç¬¦ **å¤šè·¯å¾„æ®µ
```

### 7.2 æƒé™æ£€æŸ¥æ–¹æ³•å¯¹æ¯”


| æ–¹æ³• | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|------|----------|------|
| **permitAll()** | å…è®¸æ‰€æœ‰äººè®¿é—® | é™æ€èµ„æºã€å…¬å¼€é¡µé¢ | `.permitAll()` |
| **authenticated()** | éœ€è¦ç™»å½• | éœ€è¦è®¤è¯çš„åŠŸèƒ½ | `.authenticated()` |
| **hasRole()** | éœ€è¦æŒ‡å®šè§’è‰² | è§’è‰²æ£€æŸ¥ï¼ˆè‡ªåŠ¨åŠ `ROLE_`ï¼‰ | `.hasRole("ADMIN")` |
| **hasAuthority()** | éœ€è¦æŒ‡å®šæƒé™ | æƒé™æ£€æŸ¥ï¼ˆä¸åŠ å‰ç¼€ï¼‰ | `.hasAuthority("DELETE")` |
| **hasAnyRole()** | éœ€è¦ä»»ä¸€è§’è‰² | å¤šä¸ªè§’è‰²æ»¡è¶³ä¸€ä¸ªå³å¯ | `.hasAnyRole("A","B")` |
| **hasAnyAuthority()** | éœ€è¦ä»»ä¸€æƒé™ | å¤šä¸ªæƒé™æ»¡è¶³ä¸€ä¸ªå³å¯ | `.hasAnyAuthority("X","Y")` |

### 7.3 é…ç½®æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
```java
http.authorizeHttpRequests(auth -> auth
    // 1. å…ˆé…ç½®é™æ€èµ„æºï¼ˆæœ€å®½æ¾ï¼‰
    .requestMatchers("/static/**").permitAll()
    
    // 2. å†é…ç½®å…·ä½“è·¯å¾„ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
    .requestMatchers("/admin/public").permitAll()
    
    // 3. ç„¶åé…ç½®è§’è‰²æƒé™ï¼ˆèŒƒå›´é™å®šï¼‰
    .requestMatchers("/admin/**").hasRole("ADMIN")
    
    // 4. æœ€åé…ç½®é€šç”¨è§„åˆ™ï¼ˆå…œåº•ï¼‰
    .anyRequest().authenticated()
);
```

**âŒ å¸¸è§é”™è¯¯**ï¼š
```java
// é”™è¯¯1ï¼šé€šç”¨è§„åˆ™æ”¾åœ¨å‰é¢
.anyRequest().authenticated()              // è¿™ä¸ªåŒ¹é…æ‰€æœ‰
.requestMatchers("/public/**").permitAll() // æ°¸è¿œä¸ä¼šæ‰§è¡Œ

// é”™è¯¯2ï¼šè§’è‰²åç§°å†™é”™
.hasRole("ROLE_ADMIN")  // âŒ ä¼šå˜æˆ ROLE_ROLE_ADMIN
.hasRole("ADMIN")       // âœ“ æ­£ç¡®å†™æ³•

// é”™è¯¯3ï¼šé€šé…ç¬¦ä½¿ç”¨é”™è¯¯
.requestMatchers("/api/**/data")  // âŒ **ä¸èƒ½åœ¨ä¸­é—´
.requestMatchers("/api/**")       // âœ“ **åªèƒ½åœ¨æœ«å°¾
```

### 7.4 å­¦ä¹ æ£€æŸ¥ç‚¹


**ğŸ¯ å¿«é€Ÿè‡ªæµ‹**ï¼š
- [ ] èƒ½è¯´å‡ºauthorizeHttpRequests()çš„ä½œç”¨
- [ ] ç†è§£è§„åˆ™ä»ä¸Šåˆ°ä¸‹åŒ¹é…çš„åŸç†
- [ ] æŒæ¡Anté£æ ¼é€šé…ç¬¦çš„ä½¿ç”¨
- [ ] åŒºåˆ†hasRoleå’ŒhasAuthorityçš„åŒºåˆ«
- [ ] èƒ½å†™å‡ºåŸºæœ¬çš„URLè®¿é—®æ§åˆ¶é…ç½®

**ğŸ’ª å®è·µæŒ‘æˆ˜**ï¼š
1. ä¸ºä½ çš„é¡¹ç›®è®¾è®¡ä¸€å¥—URLè®¿é—®æ§åˆ¶è§„åˆ™
2. å®ç°ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ã€æ¸¸å®¢ä¸‰ç§è§’è‰²çš„è®¿é—®æ§åˆ¶
3. ä½¿ç”¨é€šé…ç¬¦é…ç½®é™æ€èµ„æºçš„è®¿é—®è§„åˆ™

### 7.5 å…³é”®è®°å¿†å£è¯€


> ğŸ¯ **URLè®¿é—®æ§åˆ¶ä¸‰æ­¥èµ°**ï¼š
> 1. å…ˆå®šä¹‰URLæ¨¡å¼ï¼ˆrequestMatchersï¼‰
> 2. å†æŒ‡å®šæƒé™è¦æ±‚ï¼ˆpermitAll/hasRoleç­‰ï¼‰
> 3. æœ€åè®°ä½ä»ä¸Šåˆ°ä¸‹åŒ¹é…åŸåˆ™

> ğŸ” **æƒé™æ£€æŸ¥è®°å¿†æ³•**ï¼š
> - permitå…è®¸å¤§å®¶è®¿é—®
> - authenticatedç™»å½•å°±èƒ½è¡Œ
> - hasRoleè§’è‰²æ¥é™åˆ¶
> - hasAuthorityæƒé™æ›´ç»†è‡´

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- URLè®¿é—®æ§åˆ¶æ˜¯Spring Securityçš„ç¬¬ä¸€é“é˜²çº¿
- é…ç½®é¡ºåºå†³å®šåŒ¹é…ç»“æœï¼Œå…·ä½“è§„åˆ™åœ¨å‰é€šç”¨è§„åˆ™åœ¨å
- åˆç†ä½¿ç”¨é€šé…ç¬¦å¯ä»¥ç®€åŒ–é…ç½®
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æƒé™æ£€æŸ¥æ–¹æ³•
- è§’è‰²ç”¨äºç²—ç²’åº¦æ§åˆ¶ï¼Œæƒé™ç”¨äºç»†ç²’åº¦æ§åˆ¶