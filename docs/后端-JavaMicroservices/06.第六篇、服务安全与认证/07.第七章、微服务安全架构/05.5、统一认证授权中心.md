---
title: 5ã€ç»Ÿä¸€è®¤è¯æˆæƒä¸­å¿ƒ
---
## ğŸ“š ç›®å½•

1. [ç»Ÿä¸€è®¤è¯ä¸­å¿ƒæ¦‚è¿°](#1-ç»Ÿä¸€è®¤è¯ä¸­å¿ƒæ¦‚è¿°)
2. [å•ç‚¹ç™»å½•(SSO)åŸç†ä¸å®ç°](#2-å•ç‚¹ç™»å½•SSOåŸç†ä¸å®ç°)
3. [CASåè®®è¯¦è§£](#3-CASåè®®è¯¦è§£)
4. [SAMLåè®®æ”¯æŒ](#4-SAMLåè®®æ”¯æŒ)
5. [å¤šåº”ç”¨ç»Ÿä¸€ç™»å½•æ–¹æ¡ˆ](#5-å¤šåº”ç”¨ç»Ÿä¸€ç™»å½•æ–¹æ¡ˆ)
6. [ç™»å½•çŠ¶æ€åŒæ­¥æœºåˆ¶](#6-ç™»å½•çŠ¶æ€åŒæ­¥æœºåˆ¶)
7. [å®‰å…¨é€€å‡ºæœºåˆ¶](#7-å®‰å…¨é€€å‡ºæœºåˆ¶)
8. [è®¤è¯ä¸­å¿ƒé«˜å¯ç”¨è®¾è®¡](#8-è®¤è¯ä¸­å¿ƒé«˜å¯ç”¨è®¾è®¡)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¢ ç»Ÿä¸€è®¤è¯ä¸­å¿ƒæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ


**é€šä¿—ç†è§£**ï¼šå°±åƒå°åŒºçš„é—¨å«å®¤ï¼Œæ‰€æœ‰äººè¿›å…¥å°åŒºéƒ½è¦åœ¨é—¨å«å¤„ç™»è®°éªŒè¯èº«ä»½ï¼ŒéªŒè¯é€šè¿‡åæ‹¿åˆ°é€šè¡Œè¯ï¼Œå°±å¯ä»¥è‡ªç”±è¿›å‡ºå°åŒºå†…çš„å„ä¸ªæ¥¼æ ‹ï¼Œä¸éœ€è¦åœ¨æ¯æ ‹æ¥¼é—¨å£å†æ¬¡éªŒè¯ã€‚

**ä¸“ä¸šå®šä¹‰**ï¼šç»Ÿä¸€è®¤è¯ä¸­å¿ƒï¼ˆUnified Authentication Centerï¼‰æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„**é›†ä¸­å¼èº«ä»½è®¤è¯ç³»ç»Ÿ**ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰åº”ç”¨çš„ç”¨æˆ·ç™»å½•è®¤è¯ï¼Œå®ç°ä¸€æ¬¡ç™»å½•ã€å¤šå¤„ä½¿ç”¨çš„æ•ˆæœã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆåˆ†æ•£è®¤è¯ï¼‰ï¼š
ç”¨æˆ· â†’ åº”ç”¨Aç™»å½• â†’ åº”ç”¨Bç™»å½• â†’ åº”ç”¨Cç™»å½•
      â†“           â†“           â†“
    éªŒè¯å¯†ç     éªŒè¯å¯†ç     éªŒè¯å¯†ç 
é—®é¢˜ï¼šé‡å¤ç™»å½•ï¼Œä½“éªŒå·®ï¼Œå¯†ç åˆ†æ•£å­˜å‚¨ä¸å®‰å…¨

ç»Ÿä¸€è®¤è¯æ–¹å¼ï¼š
ç”¨æˆ· â†’ è®¤è¯ä¸­å¿ƒç™»å½• â†’ è·å–ä»¤ç‰Œ â†’ è®¿é—®æ‰€æœ‰åº”ç”¨
              â†“
          éªŒè¯ä¸€æ¬¡å¯†ç 
ä¼˜åŠ¿ï¼šä¸€æ¬¡ç™»å½•ï¼Œåˆ°å¤„ä½¿ç”¨ï¼Œå®‰å…¨é›†ä¸­ç®¡æ§
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€è®¤è¯


**ğŸ”¸ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

ğŸ’¡ **ç”¨æˆ·ä½“éªŒé—®é¢˜**
- **é‡å¤ç™»å½•çƒ¦æ¼**ï¼šæ¯ä¸ªåº”ç”¨éƒ½è¦ç™»å½•ä¸€æ¬¡ï¼Œè®°ä¸ä½å¤šä¸ªå¯†ç 
- **æ“ä½œç¹ç**ï¼šé¢‘ç¹è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œé™ä½å·¥ä½œæ•ˆç‡

ğŸ”’ **å®‰å…¨ç®¡ç†é—®é¢˜**
- **å¯†ç åˆ†æ•£**ï¼šæ¯ä¸ªåº”ç”¨éƒ½å­˜å‚¨å¯†ç ï¼Œæ³„éœ²é£é™©æˆå€å¢åŠ 
- **æƒé™æ··ä¹±**ï¼šç”¨æˆ·åœ¨ä¸åŒåº”ç”¨çš„æƒé™éš¾ä»¥ç»Ÿä¸€ç®¡ç†
- **å®¡è®¡å›°éš¾**ï¼šæ— æ³•è¿½è¸ªç”¨æˆ·åœ¨æ‰€æœ‰ç³»ç»Ÿçš„æ“ä½œè½¨è¿¹

âš™ï¸ **ç³»ç»Ÿç»´æŠ¤é—®é¢˜**
- **å¼€å‘é‡å¤**ï¼šæ¯ä¸ªåº”ç”¨éƒ½è¦å®ç°ç™»å½•é€»è¾‘
- **å‡çº§å›°éš¾**ï¼šä¿®æ”¹è®¤è¯æ–¹å¼éœ€è¦æ”¹æ‰€æœ‰åº”ç”¨
- **æ ‡å‡†ä¸ä¸€**ï¼šå„åº”ç”¨è®¤è¯æ–¹å¼äº”èŠ±å…«é—¨

### 1.3 ç»Ÿä¸€è®¤è¯çš„æ ¸å¿ƒä»·å€¼


| ä»·å€¼ç»´åº¦ | **å…·ä½“ä½“ç°** | **å¸¦æ¥æ”¶ç›Š** |
|---------|------------|-------------|
| ğŸ¯ **ç”¨æˆ·ä½“éªŒ** | `ä¸€æ¬¡ç™»å½•ï¼Œå…¨ç½‘é€šè¡Œ` | `å‡å°‘80%çš„ç™»å½•æ“ä½œ` |
| ğŸ” **å®‰å…¨æ€§** | `é›†ä¸­ç®¡æ§ï¼Œç»Ÿä¸€ç­–ç•¥` | `å®‰å…¨é£é™©é™ä½60%` |
| ğŸ› ï¸ **å¼€å‘æ•ˆç‡** | `æ— éœ€é‡å¤å¼€å‘è®¤è¯` | `å¼€å‘æˆæœ¬èŠ‚çœ50%` |
| ğŸ“Š **è¿ç»´ç®¡ç†** | `ç»Ÿä¸€ç›‘æ§ï¼Œé›†ä¸­å®¡è®¡` | `è¿ç»´æ•ˆç‡æå‡70%` |

---

## 2. ğŸ”‘ å•ç‚¹ç™»å½•(SSO)åŸç†ä¸å®ç°


### 2.1 SSOåŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯SSO**

**ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒè¿ªå£«å°¼ä¹å›­çš„æ‰‹ç¯ï¼Œå…¥å›­æ—¶éªŒè¯ä¸€æ¬¡èº«ä»½æˆ´ä¸Šæ‰‹ç¯ï¼Œä¹‹åç©æ‰€æœ‰é¡¹ç›®éƒ½åˆ·æ‰‹ç¯å°±è¡Œï¼Œä¸ç”¨æ¯ä¸ªé¡¹ç›®éƒ½é‡æ–°ä¹°ç¥¨éªŒè¯ã€‚

**æŠ€æœ¯å®šä¹‰**ï¼šSSOï¼ˆSingle Sign-Onï¼‰å•ç‚¹ç™»å½•ï¼Œæ˜¯ä¸€ç§**èº«ä»½è®¤è¯æœºåˆ¶**ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚

```
SSOå·¥ä½œæµç¨‹ï¼š

æ­¥éª¤1ï¼šé¦–æ¬¡è®¿é—®åº”ç”¨A
ç”¨æˆ· â†’ åº”ç”¨A â†’ å‘ç°æœªç™»å½• â†’ è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ

æ­¥éª¤2ï¼šè®¤è¯ä¸­å¿ƒç™»å½•
è®¤è¯ä¸­å¿ƒ â†’ éªŒè¯ç”¨æˆ·åå¯†ç  â†’ åˆ›å»ºå…¨å±€ä¼šè¯ â†’ é¢å‘ä»¤ç‰Œ

æ­¥éª¤3ï¼šè®¿é—®å…¶ä»–åº”ç”¨
ç”¨æˆ· â†’ åº”ç”¨B â†’ æºå¸¦ä»¤ç‰Œ â†’ åº”ç”¨BéªŒè¯ä»¤ç‰Œ â†’ ç›´æ¥ç™»å½•æˆåŠŸ
```

### 2.2 SSOæ ¸å¿ƒæœºåˆ¶


**ğŸ” ä»¤ç‰Œ(Token)æœºåˆ¶**

```java
// è®¤è¯ä¸­å¿ƒé¢å‘ä»¤ç‰Œ
public class AuthenticationCenter {
    
    // ç”¨æˆ·ç™»å½•æˆåŠŸåç”Ÿæˆä»¤ç‰Œ
    public String login(String username, String password) {
        // 1. éªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.authenticate(username, password);
        
        // 2. ç”Ÿæˆå…¨å±€ä»¤ç‰Œï¼ˆç±»ä¼¼é—¨ç¥¨ï¼‰
        String token = generateToken(user);
        
        // 3. å­˜å‚¨ä»¤ç‰Œä¿¡æ¯ï¼ˆè®°å½•è°æ‹¿åˆ°äº†é—¨ç¥¨ï¼‰
        tokenStore.save(token, user);
        
        // 4. è¿”å›ä»¤ç‰Œ
        return token;
    }
    
    // ç”Ÿæˆä»¤ç‰Œçš„æ–¹æ³•
    private String generateToken(User user) {
        // åŒ…å«ç”¨æˆ·ä¿¡æ¯ã€è¿‡æœŸæ—¶é—´ã€ç­¾åç­‰
        return JWT.create()
            .withClaim("userId", user.getId())
            .withClaim("username", user.getUsername())
            .withExpiresAt(new Date(System.currentTimeMillis() + 7200000)) // 2å°æ—¶è¿‡æœŸ
            .sign(Algorithm.HMAC256("å¯†é’¥"));
    }
}
```

**ğŸ”„ ä»¤ç‰ŒéªŒè¯æµç¨‹**

```java
// åº”ç”¨æœåŠ¡éªŒè¯ä»¤ç‰Œ
public class ApplicationService {
    
    public boolean validateToken(String token) {
        // 1. å‘è®¤è¯ä¸­å¿ƒéªŒè¯ä»¤ç‰Œ
        boolean isValid = authCenter.verify(token);
        
        // 2. ä»ä»¤ç‰Œä¸­æå–ç”¨æˆ·ä¿¡æ¯
        if (isValid) {
            UserInfo userInfo = extractUserInfo(token);
            // 3. å»ºç«‹æœ¬åœ°ä¼šè¯
            createLocalSession(userInfo);
            return true;
        }
        return false;
    }
}
```

### 2.3 SSOå®ç°æ–¹æ¡ˆå¯¹æ¯”


| å®ç°æ–¹å¼ | **å·¥ä½œåŸç†** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|---------|---------|-------------|
| ğŸª **å…±äº«Cookie** | `æ‰€æœ‰åº”ç”¨å…±ç”¨åŒä¸€åŸŸåçš„Cookie` | `å®ç°ç®€å•` | `åªé€‚ç”¨åŒåŸŸå` | `ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ` |
| ğŸ« **Tokenä¼ é€’** | `é€šè¿‡URLæˆ–Headerä¼ é€’ä»¤ç‰Œ` | `è·¨åŸŸæ”¯æŒå¥½` | `éœ€é˜²æ­¢ä»¤ç‰Œæ³„éœ²` | `å‰åç«¯åˆ†ç¦»åº”ç”¨` |
| ğŸ” **OAuth2.0** | `æ ‡å‡†æˆæƒåè®®` | `å®‰å…¨æ€§é«˜ã€é€šç”¨æ€§å¼º` | `å®ç°å¤æ‚` | `å¼€æ”¾å¹³å°` |
| ğŸ›ï¸ **CASåè®®** | `é›†ä¸­å¼è®¤è¯æœåŠ¡` | `ä¼ä¸šçº§æˆç†Ÿæ–¹æ¡ˆ` | `éœ€éƒ¨ç½²CASæœåŠ¡å™¨` | `å¤§å‹ä¼ä¸š` |

---

## 3. ğŸ¯ CASåè®®è¯¦è§£


### 3.1 CASåè®®åŸºç¡€


**ğŸ”¸ CASæ˜¯ä»€ä¹ˆ**

**å½¢è±¡æ¯”å–»**ï¼šCASå°±åƒå­¦æ ¡çš„å­¦ç”Ÿè¯åŠç†ä¸­å¿ƒï¼Œæ–°ç”Ÿå…¥å­¦æ—¶åˆ°ä¸­å¿ƒåŠç†å­¦ç”Ÿè¯ï¼Œä¹‹åå‡­å­¦ç”Ÿè¯å°±èƒ½è¿›å›¾ä¹¦é¦†ã€é£Ÿå ‚ã€å®¿èˆç­‰æ‰€æœ‰æ ¡å†…åœºæ‰€ã€‚

**ä¸“ä¸šè§£é‡Š**ï¼šCASï¼ˆCentral Authentication Serviceï¼‰æ˜¯ä¸€ç§**ä¼ä¸šçº§å•ç‚¹ç™»å½•åè®®**ï¼Œç”±è€¶é²å¤§å­¦å¼€å‘ï¼Œæ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„SSOè§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚

```
CASæ ¸å¿ƒç»„ä»¶ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAS Server (è®¤è¯æœåŠ¡å™¨)       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚  Â· éªŒè¯ç”¨æˆ·èº«ä»½            â”‚     â”‚
â”‚    â”‚  Â· é¢å‘ç¥¨æ®(Ticket)       â”‚     â”‚
â”‚    â”‚  Â· ç®¡ç†ä¼šè¯               â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘        â†“
         è¯·æ±‚è®¤è¯    è¿”å›ç¥¨æ®
              â†‘        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CAS Client (åº”ç”¨å®¢æˆ·ç«¯)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åº”ç”¨A   â”‚  â”‚ åº”ç”¨B   â”‚  â”‚ åº”ç”¨C   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 CASè®¤è¯æµç¨‹


**ğŸ“‹ è¯¦ç»†è®¤è¯æ­¥éª¤**

```
ç”¨æˆ·é¦–æ¬¡è®¿é—®åº”ç”¨Aï¼š

æ­¥éª¤1ï¼šç”¨æˆ·è®¿é—®åº”ç”¨A
æµè§ˆå™¨ â†’ http://app-a.com/home

æ­¥éª¤2ï¼šåº”ç”¨Aæ£€æŸ¥ç™»å½•çŠ¶æ€
åº”ç”¨A â†’ å‘ç°æœªç™»å½• â†’ é‡å®šå‘åˆ°CAS Server

æ­¥éª¤3ï¼šCAS Serveræ˜¾ç¤ºç™»å½•é¡µ
æµè§ˆå™¨ â†’ https://cas.company.com/login?service=http://app-a.com

æ­¥éª¤4ï¼šç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
ç”¨æˆ· â†’ æäº¤è¡¨å• â†’ CAS ServeréªŒè¯

æ­¥éª¤5ï¼šCAS Serverç”Ÿæˆç¥¨æ®
CAS Server â†’ åˆ›å»ºTGT(ç¥¨æ®æˆäºˆç¥¨æ®) â†’ åˆ›å»ºST(æœåŠ¡ç¥¨æ®)

æ­¥éª¤6ï¼šé‡å®šå‘å›åº”ç”¨Aå¹¶æºå¸¦ç¥¨æ®
æµè§ˆå™¨ â†’ http://app-a.com/home?ticket=ST-123456

æ­¥éª¤7ï¼šåº”ç”¨AéªŒè¯ç¥¨æ®
åº”ç”¨A â†’ å‘CAS ServeréªŒè¯ST-123456 â†’ è·å–ç”¨æˆ·ä¿¡æ¯

æ­¥éª¤8ï¼šå»ºç«‹æœ¬åœ°ä¼šè¯
åº”ç”¨A â†’ åˆ›å»ºSession â†’ è¿”å›é¡µé¢ç»™ç”¨æˆ·
```

**ğŸ« ç¥¨æ®ç±»å‹è¯´æ˜**

```
TGT (Ticket Granting Ticket) - ç¥¨æ®æˆäºˆç¥¨æ®ï¼š
Â· ä½œç”¨ï¼šè¯æ˜ç”¨æˆ·å·²åœ¨CAS Serverç™»å½•
Â· å­˜å‚¨ä½ç½®ï¼šCAS Server
Â· ç”Ÿå‘½å‘¨æœŸï¼šç”¨æˆ·æ•´ä¸ªç™»å½•æœŸé—´æœ‰æ•ˆï¼ˆå¦‚2å°æ—¶ï¼‰
Â· ç±»æ¯”ï¼šå°±åƒæŠ¤ç…§ï¼Œè¯æ˜ä½ çš„èº«ä»½

ST (Service Ticket) - æœåŠ¡ç¥¨æ®ï¼š
Â· ä½œç”¨ï¼šå…è®¸è®¿é—®ç‰¹å®šåº”ç”¨
Â· å­˜å‚¨ä½ç½®ï¼šé€šè¿‡URLä¼ é€’
Â· ç”Ÿå‘½å‘¨æœŸï¼šä¸€æ¬¡æ€§ä½¿ç”¨ï¼ŒéªŒè¯åç«‹å³å¤±æ•ˆ
Â· ç±»æ¯”ï¼šå°±åƒæ™¯åŒºé—¨ç¥¨ï¼Œä¸€æ¬¡æ€§ä½¿ç”¨

PGT (Proxy Granting Ticket) - ä»£ç†æˆäºˆç¥¨æ®ï¼š
Â· ä½œç”¨ï¼šå…è®¸åº”ç”¨ä»£è¡¨ç”¨æˆ·è®¿é—®å…¶ä»–åº”ç”¨
Â· ä½¿ç”¨åœºæ™¯ï¼šåº”ç”¨é—´è°ƒç”¨
Â· ç±»æ¯”ï¼šå°±åƒæˆæƒå§”æ‰˜ä¹¦
```

### 3.3 Spring Booté›†æˆCAS


```java
// Mavenä¾èµ–
/*
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-cas</artifactId>
</dependency>
*/

// CASé…ç½®ç±»
@Configuration
@EnableWebSecurity
public class CasSecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Value("${cas.server.url}")
    private String casServerUrl; // CASæœåŠ¡å™¨åœ°å€
    
    @Value("${app.service.url}")
    private String appServiceUrl; // æœ¬åº”ç”¨åœ°å€
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/public/**").permitAll() // å…¬å¼€èµ„æº
                .anyRequest().authenticated() // å…¶ä»–éƒ½éœ€è¦è®¤è¯
            .and()
            .addFilter(casAuthenticationFilter()) // CASè®¤è¯è¿‡æ»¤å™¨
            .exceptionHandling()
                .authenticationEntryPoint(casAuthenticationEntryPoint()); // æœªç™»å½•è·³è½¬
    }
    
    // CASè®¤è¯å…¥å£
    @Bean
    public CasAuthenticationEntryPoint casAuthenticationEntryPoint() {
        CasAuthenticationEntryPoint entryPoint = new CasAuthenticationEntryPoint();
        entryPoint.setLoginUrl(casServerUrl + "/login"); // CASç™»å½•é¡µ
        entryPoint.setServiceProperties(serviceProperties());
        return entryPoint;
    }
    
    // CASè®¤è¯è¿‡æ»¤å™¨
    @Bean
    public CasAuthenticationFilter casAuthenticationFilter() throws Exception {
        CasAuthenticationFilter filter = new CasAuthenticationFilter();
        filter.setAuthenticationManager(authenticationManager());
        return filter;
    }
    
    // æœåŠ¡å±æ€§é…ç½®
    @Bean
    public ServiceProperties serviceProperties() {
        ServiceProperties properties = new ServiceProperties();
        properties.setService(appServiceUrl + "/login/cas"); // å›è°ƒåœ°å€
        properties.setSendRenew(false);
        return properties;
    }
}
```

**âš™ï¸ é…ç½®æ–‡ä»¶**

```yaml
# application.yml
cas:
  server:
    url: https://cas.company.com  # CASæœåŠ¡å™¨åœ°å€
    
app:
  service:
    url: http://localhost:8080   # æœ¬åº”ç”¨åœ°å€
    
spring:
  security:
    cas:
      ticket-validator: Cas30ServiceTicketValidator  # ç¥¨æ®éªŒè¯å™¨ç‰ˆæœ¬
```

---

## 4. ğŸŒ SAMLåè®®æ”¯æŒ


### 4.1 SAMLåè®®æ¦‚è¿°


**ğŸ”¸ ä»€ä¹ˆæ˜¯SAML**

**é€šä¿—ç†è§£**ï¼šSAMLå°±åƒå›½é™…é€šç”¨çš„èº«ä»½è¯ï¼Œä½ åœ¨ä¸€ä¸ªå›½å®¶éªŒè¯è¿‡èº«ä»½ï¼Œå…¶ä»–è®¤å¯è¿™å¥—æ ‡å‡†çš„å›½å®¶éƒ½æ‰¿è®¤ä½ çš„èº«ä»½ï¼Œä¸éœ€è¦é‡å¤éªŒè¯ã€‚

**ä¸“ä¸šå®šä¹‰**ï¼šSAMLï¼ˆSecurity Assertion Markup Languageï¼‰æ˜¯ä¸€ç§åŸºäºXMLçš„**å¼€æ”¾æ ‡å‡†åè®®**ï¼Œç”¨äºåœ¨ä¸åŒå®‰å…¨åŸŸä¹‹é—´äº¤æ¢è®¤è¯å’Œæˆæƒæ•°æ®ã€‚

```
SAML vs CAS å¯¹æ¯”ï¼š

CASåè®®ï¼š
Â· ä¼ä¸šå†…éƒ¨ä½¿ç”¨
Â· å®ç°ç›¸å¯¹ç®€å•
Â· ä¸»è¦ç”¨äºWebåº”ç”¨
Â· ç¥¨æ®åŸºäºHTTPé‡å®šå‘

SAMLåè®®ï¼š
Â· è·¨ç»„ç»‡ä½¿ç”¨
Â· æ ‡å‡†åŒ–ç¨‹åº¦é«˜
Â· æ”¯æŒå¤šç§åº”ç”¨ç±»å‹
Â· æ–­è¨€åŸºäºXMLç­¾å
```

### 4.2 SAMLæ ¸å¿ƒæ¦‚å¿µ


**ğŸ“‹ ä¸‰å¤§æ ¸å¿ƒè§’è‰²**

```
SAMLç”Ÿæ€ç³»ç»Ÿï¼š

1ï¸âƒ£ ç”¨æˆ·(Principal)
   â””â”€â”€ éœ€è¦è®¿é—®èµ„æºçš„äºº

2ï¸âƒ£ èº«ä»½æä¾›å•†(IdP - Identity Provider)
   â””â”€â”€ è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½
   â””â”€â”€ ç±»æ¯”ï¼šå…¬å®‰å±€ï¼ˆéªŒè¯èº«ä»½ï¼‰

3ï¸âƒ£ æœåŠ¡æä¾›å•†(SP - Service Provider)
   â””â”€â”€ æä¾›å®é™…æœåŠ¡çš„åº”ç”¨
   â””â”€â”€ ç±»æ¯”ï¼šé“¶è¡Œï¼ˆæä¾›æœåŠ¡ï¼‰

å·¥ä½œæµç¨‹ï¼š
ç”¨æˆ· â†’ SP(å‘ç°æœªç™»å½•) â†’ IdP(éªŒè¯èº«ä»½) 
     â†’ IdP(é¢å‘æ–­è¨€) â†’ SP(éªŒè¯æ–­è¨€) â†’ æä¾›æœåŠ¡
```

**ğŸ” SAMLæ–­è¨€(Assertion)**

```xml
<!-- SAMLæ–­è¨€ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ -->
<saml:Assertion>
    <!-- æ–­è¨€ä¿¡æ¯ -->
    <saml:Issuer>https://idp.company.com</saml:Issuer>
    
    <!-- ç”¨æˆ·èº«ä»½ä¿¡æ¯ -->
    <saml:Subject>
        <saml:NameID>user@company.com</saml:NameID>
    </saml:Subject>
    
    <!-- è®¤è¯å£°æ˜ -->
    <saml:AuthnStatement>
        <saml:AuthnContext>
            <saml:AuthnContextClassRef>
                urn:oasis:names:tc:SAML:2.0:ac:classes:Password
            </saml:AuthnContextClassRef>
        </saml:AuthnContext>
    </saml:AuthnStatement>
    
    <!-- å±æ€§ä¿¡æ¯ -->
    <saml:AttributeStatement>
        <saml:Attribute Name="email">
            <saml:AttributeValue>user@company.com</saml:AttributeValue>
        </saml:Attribute>
        <saml:Attribute Name="role">
            <saml:AttributeValue>admin</saml:AttributeValue>
        </saml:Attribute>
    </saml:AttributeStatement>
</saml:Assertion>
```

### 4.3 Spring Securityé›†æˆSAML


```java
// SAMLé…ç½®ç±»
@Configuration
@EnableWebSecurity
public class SamlSecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/saml/**").permitAll()
                .anyRequest().authenticated()
            .and()
            .apply(saml()) // åº”ç”¨SAMLé…ç½®
            .and()
            .logout()
                .logoutSuccessUrl("/");
    }
    
    // SAMLé…ç½®
    private SAMLConfigurer saml() {
        return new SAMLConfigurer()
            .identityProvider()
                .metadataFilePath("classpath:idp-metadata.xml") // IdPå…ƒæ•°æ®
            .and()
            .serviceProvider()
                .entityId("myapp-saml") // SPå®ä½“ID
                .signMetadata(true) // ç­¾åå…ƒæ•°æ®
                .keyStore()
                    .keyStoreFilePath("classpath:saml-keystore.jks") // å¯†é’¥åº“
                    .password("changeit")
                    .keyname("myapp")
                    .keyPassword("changeit");
    }
}
```

---

## 5. ğŸ”— å¤šåº”ç”¨ç»Ÿä¸€ç™»å½•æ–¹æ¡ˆ


### 5.1 ç»Ÿä¸€ç™»å½•æ¶æ„è®¾è®¡


**ğŸ—ï¸ æ•´ä½“æ¶æ„**

```
                        Internet
                           â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Nginx      â”‚ â† ç»Ÿä¸€å…¥å£
                  â”‚  (åå‘ä»£ç†)   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è®¤è¯ä¸­å¿ƒ(Auth Center) â”‚
              â”‚  Â· ç™»å½•/ç™»å‡º          â”‚
              â”‚  Â· ä»¤ç‰Œé¢å‘           â”‚
              â”‚  Â· ç”¨æˆ·ç®¡ç†           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                â†“                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åº”ç”¨A    â”‚    â”‚  åº”ç”¨B    â”‚    â”‚  åº”ç”¨C    â”‚
  â”‚ (è®¢å•)    â”‚    â”‚ (åº“å­˜)    â”‚    â”‚ (æ”¯ä»˜)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å‰åç«¯åˆ†ç¦»åœºæ™¯


**ğŸ¨ å‰ç«¯ç»Ÿä¸€ç™»å½•æµç¨‹**

```javascript
// å‰ç«¯ç™»å½•æ‹¦æˆªå™¨
axios.interceptors.request.use(
    config => {
        // 1. ä»æœ¬åœ°è·å–ä»¤ç‰Œ
        const token = localStorage.getItem('token');
        
        // 2. å¦‚æœæœ‰ä»¤ç‰Œï¼Œæ·»åŠ åˆ°è¯·æ±‚å¤´
        if (token) {
            config.headers['Authorization'] = `Bearer ${token}`;
        }
        return config;
    },
    error => {
        return Promise.reject(error);
    }
);

// å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(
    response => response,
    error => {
        // 3. å¦‚æœè¿”å›401æœªæˆæƒ
        if (error.response && error.response.status === 401) {
            // 4. æ¸…é™¤æœ¬åœ°ä»¤ç‰Œ
            localStorage.removeItem('token');
            // 5. è·³è½¬åˆ°ç»Ÿä¸€ç™»å½•é¡µ
            window.location.href = 'https://auth.company.com/login';
        }
        return Promise.reject(error);
    }
);
```

**âš™ï¸ åç«¯ä»¤ç‰ŒéªŒè¯**

```java
// ç»Ÿä¸€è®¤è¯è¿‡æ»¤å™¨
@Component
public class AuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private TokenService tokenService;
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                    HttpServletResponse response, 
                                    FilterChain chain) {
        // 1. ä»è¯·æ±‚å¤´è·å–ä»¤ç‰Œ
        String token = request.getHeader("Authorization");
        
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7);
            
            // 2. éªŒè¯ä»¤ç‰Œ
            if (tokenService.validateToken(token)) {
                // 3. æå–ç”¨æˆ·ä¿¡æ¯
                UserDetails user = tokenService.getUserFromToken(token);
                
                // 4. è®¾ç½®åˆ°å®‰å…¨ä¸Šä¸‹æ–‡
                UsernamePasswordAuthenticationToken auth = 
                    new UsernamePasswordAuthenticationToken(
                        user, null, user.getAuthorities()
                    );
                SecurityContextHolder.getContext().setAuthentication(auth);
            }
        }
        
        // 5. ç»§ç»­è¿‡æ»¤é“¾
        chain.doFilter(request, response);
    }
}
```

### 5.3 å¤šç«¯ç»Ÿä¸€ç™»å½•


**ğŸ“± ç§»åŠ¨ç«¯/PCç«¯/Webç«¯ç»Ÿä¸€æ–¹æ¡ˆ**

```java
// ç»Ÿä¸€ä»¤ç‰Œç”ŸæˆæœåŠ¡
@Service
public class UnifiedTokenService {
    
    // ç”Ÿæˆè®¾å¤‡ç›¸å…³çš„ä»¤ç‰Œ
    public TokenResponse generateToken(String username, String deviceType) {
        // 1. åˆ›å»ºä»¤ç‰Œå£°æ˜
        Map<String, Object> claims = new HashMap<>();
        claims.put("username", username);
        claims.put("deviceType", deviceType); // PC/Mobile/Web
        claims.put("loginTime", System.currentTimeMillis());
        
        // 2. ç”Ÿæˆè®¿é—®ä»¤ç‰Œï¼ˆçŸ­æœŸæœ‰æ•ˆï¼‰
        String accessToken = JWT.create()
            .withClaim("claims", claims)
            .withExpiresAt(new Date(System.currentTimeMillis() + 3600000)) // 1å°æ—¶
            .sign(Algorithm.HMAC256("secret"));
        
        // 3. ç”Ÿæˆåˆ·æ–°ä»¤ç‰Œï¼ˆé•¿æœŸæœ‰æ•ˆï¼‰
        String refreshToken = JWT.create()
            .withClaim("username", username)
            .withExpiresAt(new Date(System.currentTimeMillis() + 604800000)) // 7å¤©
            .sign(Algorithm.HMAC256("secret"));
        
        // 4. è¿”å›ä»¤ç‰Œå¯¹
        return new TokenResponse(accessToken, refreshToken);
    }
}
```

---

## 6. ğŸ”„ ç™»å½•çŠ¶æ€åŒæ­¥æœºåˆ¶


### 6.1 çŠ¶æ€åŒæ­¥çš„æŒ‘æˆ˜


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€åŒæ­¥**

```
é—®é¢˜åœºæ™¯ï¼š

åœºæ™¯1ï¼šç”¨æˆ·åœ¨åº”ç”¨Aä¿®æ”¹äº†å¯†ç 
æœŸæœ›ï¼šå…¶ä»–åº”ç”¨ç«‹å³è¦æ±‚é‡æ–°ç™»å½•
ç°å®ï¼šå…¶ä»–åº”ç”¨ä»å¯ç»§ç»­ä½¿ç”¨ï¼ˆä»¤ç‰Œæœªå¤±æ•ˆï¼‰

åœºæ™¯2ï¼šç®¡ç†å‘˜ç¦ç”¨äº†æŸä¸ªç”¨æˆ·
æœŸæœ›ï¼šè¯¥ç”¨æˆ·ç«‹å³è¢«è¸¢å‡ºæ‰€æœ‰åº”ç”¨
ç°å®ï¼šç”¨æˆ·ä»¤ç‰Œæœªè¿‡æœŸå‰ä»å¯è®¿é—®

åœºæ™¯3ï¼šç”¨æˆ·åœ¨åº”ç”¨Aé€€å‡ºç™»å½•
æœŸæœ›ï¼šæ‰€æœ‰åº”ç”¨åŒæ—¶é€€å‡º
ç°å®ï¼šå…¶ä»–åº”ç”¨ä»ç„¶å¤„äºç™»å½•çŠ¶æ€

æ ¸å¿ƒé—®é¢˜ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„çŠ¶æ€ä¸€è‡´æ€§
```

### 6.2 çŠ¶æ€åŒæ­¥æ–¹æ¡ˆ


**ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | **å®ç°æ–¹å¼** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|------|------------|---------|---------|-------------|
| ğŸ”´ **Rediså‘å¸ƒè®¢é˜…** | `é€šè¿‡Rediså¹¿æ’­çŠ¶æ€å˜æ›´` | `å®æ—¶æ€§å¥½` | `ä¾èµ–Redis` | `ä¸­å°è§„æ¨¡` |
| ğŸŸ¢ **æ¶ˆæ¯é˜Ÿåˆ—** | `é€šè¿‡MQåŒæ­¥çŠ¶æ€` | `å¯é æ€§é«˜` | `å»¶è¿Ÿç¨é«˜` | `å¤§è§„æ¨¡åˆ†å¸ƒå¼` |
| ğŸ”µ **å®šæ—¶è½®è¯¢** | `å®šæœŸæ£€æŸ¥ä»¤ç‰ŒçŠ¶æ€` | `å®ç°ç®€å•` | `å®æ—¶æ€§å·®` | `å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜` |
| ğŸŸ¡ **ä»¤ç‰ŒçŸ­æœŸåŒ–** | `ç¼©çŸ­ä»¤ç‰Œæœ‰æ•ˆæœŸ` | `å®‰å…¨æ€§é«˜` | `ä½“éªŒç¨å·®` | `é«˜å®‰å…¨è¦æ±‚` |

**âš¡ Rediså‘å¸ƒè®¢é˜…å®ç°**

```java
// çŠ¶æ€åŒæ­¥æœåŠ¡
@Service
public class LoginStateSyncService {
    
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    // å‘å¸ƒç”¨æˆ·ç™»å‡ºæ¶ˆæ¯
    public void publishLogout(String username) {
        // æ„é€ æ¶ˆæ¯
        LogoutMessage message = new LogoutMessage();
        message.setUsername(username);
        message.setTimestamp(System.currentTimeMillis());
        
        // å‘å¸ƒåˆ°Redisé¢‘é“
        redisTemplate.convertAndSend("user-logout-channel", message);
    }
    
    // å‘å¸ƒå¯†ç ä¿®æ”¹æ¶ˆæ¯
    public void publishPasswordChange(String username) {
        PasswordChangeMessage message = new PasswordChangeMessage();
        message.setUsername(username);
        message.setTimestamp(System.currentTimeMillis());
        
        redisTemplate.convertAndSend("password-change-channel", message);
    }
}

// æ¶ˆæ¯ç›‘å¬å™¨
@Component
public class LoginStateListener {
    
    @Autowired
    private TokenBlacklistService blacklistService;
    
    // ç›‘å¬ç™»å‡ºæ¶ˆæ¯
    @RedisListener(channel = "user-logout-channel")
    public void handleLogout(LogoutMessage message) {
        // å°†è¯¥ç”¨æˆ·çš„æ‰€æœ‰ä»¤ç‰ŒåŠ å…¥é»‘åå•
        blacklistService.addUserTokensToBlacklist(message.getUsername());
        
        // æ¸…é™¤æœ¬åœ°ç¼“å­˜
        localCache.remove(message.getUsername());
    }
    
    // ç›‘å¬å¯†ç ä¿®æ”¹æ¶ˆæ¯
    @RedisListener(channel = "password-change-channel")
    public void handlePasswordChange(PasswordChangeMessage message) {
        // å¼ºåˆ¶è¯¥ç”¨æˆ·æ‰€æœ‰ä»¤ç‰Œå¤±æ•ˆ
        blacklistService.invalidateUserTokens(message.getUsername());
    }
}
```

### 6.3 ä»¤ç‰Œé»‘åå•æœºåˆ¶


```java
// ä»¤ç‰Œé»‘åå•æœåŠ¡
@Service
public class TokenBlacklistService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    // æ·»åŠ ä»¤ç‰Œåˆ°é»‘åå•
    public void addToBlacklist(String token, long expireSeconds) {
        String key = "token:blacklist:" + token;
        // å­˜å‚¨åˆ°Redisï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
        redisTemplate.opsForValue().set(key, "1", expireSeconds, TimeUnit.SECONDS);
    }
    
    // æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦åœ¨é»‘åå•ä¸­
    public boolean isBlacklisted(String token) {
        String key = "token:blacklist:" + token;
        return redisTemplate.hasKey(key);
    }
    
    // å°†ç”¨æˆ·æ‰€æœ‰ä»¤ç‰ŒåŠ å…¥é»‘åå•
    public void addUserTokensToBlacklist(String username) {
        // æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒä»¤ç‰Œ
        Set<String> tokens = redisTemplate.keys("token:user:" + username + ":*");
        
        // é€ä¸ªåŠ å…¥é»‘åå•
        for (String tokenKey : tokens) {
            String token = redisTemplate.opsForValue().get(tokenKey);
            addToBlacklist(token, 3600); // 1å°æ—¶åè‡ªåŠ¨æ¸…ç†
        }
    }
}
```

---

## 7. ğŸšª å®‰å…¨é€€å‡ºæœºåˆ¶


### 7.1 å•åº”ç”¨é€€å‡ºvså…¨å±€é€€å‡º


**ğŸ”¸ ä¸¤ç§é€€å‡ºæ–¹å¼**

```
å•åº”ç”¨é€€å‡ºï¼ˆLocal Logoutï¼‰ï¼š
ç”¨æˆ· â†’ é€€å‡ºåº”ç”¨A â†’ ä»…æ¸…é™¤åº”ç”¨Açš„ä¼šè¯
     â†’ è®¿é—®åº”ç”¨B â†’ ä»ç„¶æ˜¯ç™»å½•çŠ¶æ€
ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·åªæƒ³é€€å‡ºæŸä¸ªåº”ç”¨

å…¨å±€é€€å‡ºï¼ˆGlobal Logoutï¼‰ï¼š
ç”¨æˆ· â†’ é€€å‡ºåº”ç”¨A â†’ æ¸…é™¤æ‰€æœ‰åº”ç”¨ä¼šè¯
     â†’ è®¿é—®åº”ç”¨B â†’ éœ€è¦é‡æ–°ç™»å½•
ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·å®Œå…¨é€€å‡ºç³»ç»Ÿ
```

### 7.2 å…¨å±€é€€å‡ºå®ç°


**ğŸ” å®Œæ•´é€€å‡ºæµç¨‹**

```
æ­¥éª¤1ï¼šç”¨æˆ·ç‚¹å‡»é€€å‡ºæŒ‰é’®
åº”ç”¨A â†’ è°ƒç”¨è®¤è¯ä¸­å¿ƒé€€å‡ºæ¥å£

æ­¥éª¤2ï¼šè®¤è¯ä¸­å¿ƒå¤„ç†é€€å‡º
è®¤è¯ä¸­å¿ƒ â†’ é”€æ¯TGT(å…¨å±€ä»¤ç‰Œ)
         â†’ å‘å¸ƒé€€å‡ºæ¶ˆæ¯
         â†’ é€šçŸ¥æ‰€æœ‰åº”ç”¨

æ­¥éª¤3ï¼šå„åº”ç”¨å“åº”é€€å‡º
åº”ç”¨A/B/C â†’ æ¥æ”¶é€€å‡ºæ¶ˆæ¯
          â†’ é”€æ¯æœ¬åœ°ä¼šè¯
          â†’ æ¸…é™¤ç”¨æˆ·ç¼“å­˜

æ­¥éª¤4ï¼šå‰ç«¯æ¸…ç†
å‰ç«¯ â†’ æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ä»¤ç‰Œ
     â†’ è·³è½¬åˆ°ç™»å½•é¡µ
```

**âš™ï¸ ä»£ç å®ç°**

```java
// å…¨å±€é€€å‡ºæ§åˆ¶å™¨
@RestController
@RequestMapping("/auth")
public class LogoutController {
    
    @Autowired
    private LoginStateSyncService syncService;
    
    @Autowired
    private TokenBlacklistService blacklistService;
    
    @PostMapping("/logout")
    public ResponseEntity<?> globalLogout(@RequestHeader("Authorization") String token) {
        // 1. è§£æä»¤ç‰Œè·å–ç”¨æˆ·ä¿¡æ¯
        String username = tokenService.getUsernameFromToken(token);
        
        // 2. å°†å½“å‰ä»¤ç‰ŒåŠ å…¥é»‘åå•
        blacklistService.addToBlacklist(token, 3600);
        
        // 3. å‘å¸ƒå…¨å±€é€€å‡ºæ¶ˆæ¯
        syncService.publishLogout(username);
        
        // 4. æ¸…é™¤è®¤è¯ä¸­å¿ƒçš„ä¼šè¯
        sessionRegistry.removeSession(username);
        
        // 5. è¿”å›æˆåŠŸå“åº”
        return ResponseEntity.ok("é€€å‡ºæˆåŠŸ");
    }
}

// å‰ç«¯é€€å‡ºå¤„ç†
function globalLogout() {
    // 1. è°ƒç”¨é€€å‡ºæ¥å£
    axios.post('/auth/logout')
        .then(() => {
            // 2. æ¸…é™¤æœ¬åœ°ä»¤ç‰Œ
            localStorage.removeItem('token');
            localStorage.removeItem('refreshToken');
            localStorage.removeItem('userInfo');
            
            // 3. è·³è½¬åˆ°ç™»å½•é¡µ
            window.location.href = '/login';
        })
        .catch(error => {
            console.error('é€€å‡ºå¤±è´¥', error);
        });
}
```

### 7.3 è¶…æ—¶è‡ªåŠ¨é€€å‡º


```java
// ä¼šè¯è¶…æ—¶é…ç½®
@Configuration
public class SessionTimeoutConfig {
    
    @Bean
    public SessionInformationExpiredStrategy expiredStrategy() {
        return event -> {
            HttpServletResponse response = event.getResponse();
            
            // æ„é€ è¶…æ—¶å“åº”
            Map<String, Object> result = new HashMap<>();
            result.put("code", 401);
            result.put("message", "ä¼šè¯å·²è¶…æ—¶,è¯·é‡æ–°ç™»å½•");
            
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write(JSON.toJSONString(result));
        };
    }
    
    @Bean
    public HttpSessionEventPublisher httpSessionEventPublisher() {
        return new HttpSessionEventPublisher();
    }
}

// application.ymlé…ç½®
server:
  servlet:
    session:
      timeout: 30m  # ä¼šè¯30åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨è¿‡æœŸ
```

---

## 8. âš¡ è®¤è¯ä¸­å¿ƒé«˜å¯ç”¨è®¾è®¡


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦é«˜å¯ç”¨


**ğŸ”¸ å•ç‚¹æ•…éšœçš„é£é™©**

```
è®¤è¯ä¸­å¿ƒæ˜¯æ•´ä¸ªç³»ç»Ÿçš„"å¿ƒè„"ï¼š

å•ç‚¹æ•…éšœå½±å“ï¼š
è®¤è¯ä¸­å¿ƒå®•æœº â†’ æ‰€æœ‰åº”ç”¨æ— æ³•ç™»å½•
              â†’ å·²ç™»å½•ç”¨æˆ·æ— æ³•éªŒè¯ä»¤ç‰Œ
              â†’ æ•´ä¸ªç³»ç»Ÿç˜«ç—ª

ä¸šåŠ¡æŸå¤±ï¼š
Â· ç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿ
Â· ä¸šåŠ¡æµç¨‹ä¸­æ–­
Â· å…¬å¸ä¿¡èª‰å—æŸ
Â· ç»æµæŸå¤±å·¨å¤§

è§£å†³æ–¹æ¡ˆï¼šå¿…é¡»å®ç°é«˜å¯ç”¨æ¶æ„
```

### 8.2 é«˜å¯ç”¨æ¶æ„è®¾è®¡


**ğŸ—ï¸ å¤šèŠ‚ç‚¹é›†ç¾¤æ¶æ„**

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Nginx   â”‚ â† è´Ÿè½½å‡è¡¡
                    â”‚  (ä¸»LB)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“               â†“               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ è®¤è¯ä¸­å¿ƒ1 â”‚    â”‚ è®¤è¯ä¸­å¿ƒ2 â”‚    â”‚ è®¤è¯ä¸­å¿ƒ3 â”‚
    â”‚ (Master) â”‚    â”‚ (Slave)  â”‚    â”‚ (Slave)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“               â†“               â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    Redis     â”‚ â† å…±äº«ä¼šè¯å­˜å‚¨
                  â”‚   (Cluster)  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    MySQL     â”‚ â† ç”¨æˆ·æ•°æ®
                  â”‚   (ä¸»ä»)     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 ä¼šè¯å…±äº«æ–¹æ¡ˆ


**ğŸ”„ Redisé›†ç¾¤å…±äº«ä¼šè¯**

```java
// Spring Sessioné…ç½®
@Configuration
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 3600) // 1å°æ—¶
public class RedisSessionConfig {
    
    @Bean
    public LettuceConnectionFactory connectionFactory() {
        // Redisé›†ç¾¤é…ç½®
        RedisClusterConfiguration clusterConfig = 
            new RedisClusterConfiguration(Arrays.asList(
                "redis-node1:6379",
                "redis-node2:6379", 
                "redis-node3:6379"
            ));
        
        return new LettuceConnectionFactory(clusterConfig);
    }
    
    @Bean
    public RedisSerializer<Object> springSessionDefaultRedisSerializer() {
        // ä½¿ç”¨JSONåºåˆ—åŒ–ä¼šè¯æ•°æ®
        return new GenericJackson2JsonRedisSerializer();
    }
}

// ä¼šè¯æ“ä½œç¤ºä¾‹
@Service
public class SessionService {
    
    @Autowired
    private HttpSession session;
    
    // å­˜å‚¨ç”¨æˆ·ä¿¡æ¯åˆ°ä¼šè¯
    public void saveUserToSession(User user) {
        session.setAttribute("user", user);
        // è‡ªåŠ¨åŒæ­¥åˆ°Redisé›†ç¾¤
    }
    
    // ä»ä¼šè¯è·å–ç”¨æˆ·ä¿¡æ¯
    public User getUserFromSession() {
        return (User) session.getAttribute("user");
        // è‡ªåŠ¨ä»Redisé›†ç¾¤è·å–
    }
}
```

### 8.4 å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»


**âš•ï¸ å¥åº·æ£€æŸ¥æœºåˆ¶**

```java
// å¥åº·æ£€æŸ¥ç«¯ç‚¹
@RestController
@RequestMapping("/actuator")
public class HealthCheckController {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Autowired
    private DataSource dataSource;
    
    @GetMapping("/health")
    public Map<String, Object> healthCheck() {
        Map<String, Object> health = new HashMap<>();
        
        // 1. æ£€æŸ¥Redisè¿æ¥
        try {
            redisTemplate.opsForValue().get("health-check");
            health.put("redis", "UP");
        } catch (Exception e) {
            health.put("redis", "DOWN");
        }
        
        // 2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
        try (Connection conn = dataSource.getConnection()) {
            health.put("database", "UP");
        } catch (Exception e) {
            health.put("database", "DOWN");
        }
        
        // 3. æ£€æŸ¥å†…å­˜ä½¿ç”¨
        Runtime runtime = Runtime.getRuntime();
        long usedMemory = runtime.totalMemory() - runtime.freeMemory();
        health.put("memory", usedMemory / 1024 / 1024 + "MB");
        
        // 4. æ•´ä½“çŠ¶æ€
        boolean isHealthy = "UP".equals(health.get("redis")) 
                         && "UP".equals(health.get("database"));
        health.put("status", isHealthy ? "UP" : "DOWN");
        
        return health;
    }
}
```

**ğŸ”„ Nginxå¥åº·æ£€æŸ¥é…ç½®**

```nginx
# nginx.conf
upstream auth_center {
    # å¥åº·æ£€æŸ¥é…ç½®
    server 192.168.1.10:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.12:8080 max_fails=3 fail_timeout=30s backup;
    
    # è´Ÿè½½å‡è¡¡ç­–ç•¥
    ip_hash;  # åŒä¸€IPè¯·æ±‚åˆ†é…åˆ°åŒä¸€æœåŠ¡å™¨
}

server {
    listen 80;
    server_name auth.company.com;
    
    location / {
        proxy_pass http://auth_center;
        
        # å¥åº·æ£€æŸ¥
        proxy_next_upstream error timeout http_500 http_502 http_503;
        
        # è¯·æ±‚å¤´è®¾ç½®
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    location /health {
        proxy_pass http://auth_center/actuator/health;
        access_log off;
    }
}
```

### 8.5 æ•°æ®ä¸€è‡´æ€§ä¿è¯


**ğŸ” ä»¤ç‰Œä¸€è‡´æ€§æ–¹æ¡ˆ**

```java
// åˆ†å¸ƒå¼é”ä¿è¯ä»¤ç‰Œå”¯ä¸€æ€§
@Service
public class DistributedTokenService {
    
    @Autowired
    private RedissonClient redisson;
    
    public String generateUniqueToken(String username) {
        // è·å–åˆ†å¸ƒå¼é”
        RLock lock = redisson.getLock("token:lock:" + username);
        
        try {
            // å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…10ç§’
            if (lock.tryLock(10, TimeUnit.SECONDS)) {
                // 1. æ£€æŸ¥æ˜¯å¦å·²æœ‰ä»¤ç‰Œ
                String existingToken = redisTemplate.opsForValue()
                    .get("token:user:" + username);
                
                if (existingToken != null) {
                    return existingToken; // è¿”å›å·²æœ‰ä»¤ç‰Œ
                }
                
                // 2. ç”Ÿæˆæ–°ä»¤ç‰Œ
                String newToken = UUID.randomUUID().toString();
                
                // 3. å­˜å‚¨ä»¤ç‰Œï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰
                redisTemplate.opsForValue().set(
                    "token:user:" + username, 
                    newToken, 
                    2, 
                    TimeUnit.HOURS
                );
                
                return newToken;
            }
        } finally {
            // é‡Šæ”¾é”
            lock.unlock();
        }
        
        throw new RuntimeException("è·å–ä»¤ç‰Œå¤±è´¥");
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 ç»Ÿä¸€è®¤è¯æ ¸å¿ƒæ¦‚å¿µ


ğŸ¯ **ä¸€å¥è¯æ€»ç»“**
ç»Ÿä¸€è®¤è¯ä¸­å¿ƒæ˜¯å¾®æœåŠ¡æ¶æ„çš„**èº«ä»½ç®¡å®¶**,å®ç°ä¸€æ¬¡ç™»å½•ã€å…¨ç½‘é€šè¡Œ,é›†ä¸­ç®¡æ§ç”¨æˆ·èº«ä»½å’Œæƒé™ã€‚

ğŸ“ **å…³é”®ç†è§£è¦ç‚¹**

```
æ ¸å¿ƒä»·å€¼ï¼š
ğŸ”¸ ç”¨æˆ·ä½“éªŒï¼šä¸€æ¬¡ç™»å½•,åˆ°å¤„ä½¿ç”¨
ğŸ”¸ å®‰å…¨ç®¡æ§ï¼šé›†ä¸­éªŒè¯,ç»Ÿä¸€ç­–ç•¥  
ğŸ”¸ å¼€å‘æ•ˆç‡ï¼šæ— éœ€é‡å¤å®ç°è®¤è¯é€»è¾‘
ğŸ”¸ è¿ç»´ä¾¿åˆ©ï¼šç»Ÿä¸€ç›‘æ§,é›†ä¸­å®¡è®¡
```

### 9.2 ä¸»æµåè®®å¯¹æ¯”


| åè®® | **æ ¸å¿ƒç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ å»ºè®®** |
|------|------------|-------------|-------------|
| **CAS** | `ä¼ä¸šçº§SSOæ ‡å‡†æ–¹æ¡ˆ` | `ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ` | `â­â­â­ ä¼˜å…ˆæŒæ¡` |
| **SAML** | `è·¨ç»„ç»‡èº«ä»½è”é‚¦` | `å¤šç»„ç»‡åä½œ` | `â­â­ äº†è§£å³å¯` |
| **OAuth2** | `æˆæƒåè®®æ ‡å‡†` | `å¼€æ”¾å¹³å°/ç¬¬ä¸‰æ–¹ç™»å½•` | `â­â­â­ é‡ç‚¹å­¦ä¹ ` |

### 9.3 å®æ–½å…³é”®ç‚¹


**ğŸ”‘ å¿…çŸ¥å¿…ä¼š**

```
âœ… ä»¤ç‰Œæœºåˆ¶ï¼š
   Â· JWTä»¤ç‰Œç»“æ„å’ŒéªŒè¯
   Â· è®¿é—®ä»¤ç‰Œ+åˆ·æ–°ä»¤ç‰Œç»„åˆ
   Â· ä»¤ç‰Œé»‘åå•ç®¡ç†

âœ… çŠ¶æ€åŒæ­¥ï¼š
   Â· Rediså‘å¸ƒè®¢é˜…
   Â· æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥
   Â· å®šæ—¶è½®è¯¢éªŒè¯

âœ… é«˜å¯ç”¨ä¿éšœï¼š
   Â· é›†ç¾¤éƒ¨ç½²
   Â· ä¼šè¯å…±äº«(Redis)
   Â· å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»
```

**ğŸ’¡ æœ€ä½³å®è·µ**

```
å®‰å…¨å»ºè®®ï¼š
ğŸ” ä»¤ç‰ŒçŸ­æœŸåŒ–,é™ä½æ³„éœ²é£é™©
ğŸ” HTTPSä¼ è¾“,é˜²æ­¢ä»¤ç‰Œçªƒå–
ğŸ” é™æµé˜²åˆ·,é¿å…æš´åŠ›ç ´è§£
ğŸ” å¼‚åœ°ç™»å½•å‘Šè­¦,åŠæ—¶å‘ç°å¼‚å¸¸

æ€§èƒ½ä¼˜åŒ–ï¼š
âš¡ ä»¤ç‰Œæœ¬åœ°ç¼“å­˜,å‡å°‘éªŒè¯å¼€é”€
âš¡ è¿æ¥æ± å¤ç”¨,æå‡å“åº”é€Ÿåº¦
âš¡ å¼‚æ­¥å¤„ç†,é¿å…é˜»å¡ä¸»æµç¨‹
```

**ğŸ§  å­¦ä¹ è·¯å¾„**

```
ç¬¬1å‘¨ï¼šç†è§£SSOåŸºæœ¬åŸç†
      â””â”€â”€ æŒæ¡ä»¤ç‰Œæœºåˆ¶

ç¬¬2å‘¨ï¼šå­¦ä¹ CASåè®®
      â””â”€â”€ å®ŒæˆSpring Booté›†æˆ

ç¬¬3å‘¨ï¼šå®ç°çŠ¶æ€åŒæ­¥
      â””â”€â”€ æŒæ¡Rediså‘å¸ƒè®¢é˜…

ç¬¬4å‘¨ï¼šé«˜å¯ç”¨æ¶æ„
      â””â”€â”€ å®ç°é›†ç¾¤éƒ¨ç½²
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç»Ÿä¸€è®¤è¯æ˜¯é—¨å«ï¼Œä¸€æ¬¡éªŒè¯åˆ°å¤„è¡Œ
CASåè®®ä¼ä¸šç”¨ï¼ŒSAMLè·¨åŸŸæ˜¾ç¥é€š  
ä»¤ç‰Œæœºåˆ¶æ˜¯æ ¸å¿ƒï¼Œé»‘åå•æ§åˆ¶è¦è®°æ¸…
çŠ¶æ€åŒæ­¥é Redisï¼Œé«˜å¯ç”¨é›†ç¾¤ä¿ç¨³å®š
```