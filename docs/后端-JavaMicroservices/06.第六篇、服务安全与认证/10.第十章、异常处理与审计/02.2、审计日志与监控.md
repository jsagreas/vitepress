---
title: 2ã€å®¡è®¡æ—¥å¿—ä¸ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [å®¡è®¡æ—¥å¿—åŸºç¡€æ¦‚å¿µ](#1-å®¡è®¡æ—¥å¿—åŸºç¡€æ¦‚å¿µ)
2. [ç™»å½•æ—¥å¿—è®°å½•](#2-ç™»å½•æ—¥å¿—è®°å½•)
3. [æƒé™è®¿é—®æ—¥å¿—](#3-æƒé™è®¿é—®æ—¥å¿—)
4. [æ•æ„Ÿæ“ä½œå®¡è®¡](#4-æ•æ„Ÿæ“ä½œå®¡è®¡)
5. [æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–](#5-æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–)
6. [æ—¥å¿—å­˜å‚¨ç­–ç•¥](#6-æ—¥å¿—å­˜å‚¨ç­–ç•¥)
7. [å®æ—¶ç›‘æ§å‘Šè­¦](#7-å®æ—¶ç›‘æ§å‘Šè­¦)
8. [å®‰å…¨äº‹ä»¶åˆ†æ](#8-å®‰å…¨äº‹ä»¶åˆ†æ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å®¡è®¡æ—¥å¿—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å®‰å…¨å®¡è®¡æ—¥å¿—


**é€šä¿—ç†è§£**ï¼š
å°±åƒé“¶è¡Œç»™ä½ çš„è´¦å•ï¼Œè®°å½•äº†ä½ çš„æ¯ä¸€ç¬”äº¤æ˜“ã€‚å®‰å…¨å®¡è®¡æ—¥å¿—å°±æ˜¯ç³»ç»Ÿçš„"å®‰å…¨è´¦å•"ï¼Œè®°å½•äº†è°åœ¨ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚

```
é“¶è¡Œè´¦å•ç¤ºä¾‹ï¼š
2024-01-15 09:30  å¼ ä¸‰  ATMå–æ¬¾  -500å…ƒ  ä½™é¢:2000å…ƒ
2024-01-15 14:20  å¼ ä¸‰  è¶…å¸‚åˆ·å¡  -89å…ƒ   ä½™é¢:1911å…ƒ

å®‰å…¨å®¡è®¡æ—¥å¿—ç¤ºä¾‹ï¼š
2024-01-15 09:30  admin   ç™»å½•æˆåŠŸ     æ¥è‡ªIP:192.168.1.100
2024-01-15 09:35  admin   æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨  è®¿é—®/api/users
2024-01-15 09:40  admin   åˆ é™¤ç”¨æˆ·     userId=1001
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡æ—¥å¿—


**ğŸ¯ æ ¸å¿ƒä»·å€¼ï¼š**

**å®‰å…¨è¿½æº¯**
- å‡ºé—®é¢˜æ—¶å¯ä»¥æŸ¥æ¸…æ¥šï¼šè°å¹²çš„ï¼Ÿä»€ä¹ˆæ—¶å€™å¹²çš„ï¼Ÿ
- å°±åƒç›‘æ§å½•åƒï¼Œå…³é”®æ—¶åˆ»èƒ½æ‰¾åˆ°è¯æ®

**åˆè§„è¦æ±‚**
- å¾ˆå¤šè¡Œä¸šæœ‰æ³•å¾‹æ³•è§„è¦æ±‚ï¼ˆé‡‘èã€åŒ»ç–—ï¼‰
- å¿…é¡»ä¿å­˜æ“ä½œè®°å½•ä¸€å®šå¹´é™

**è¡Œä¸ºåˆ†æ**
- å‘ç°å¼‚å¸¸æ“ä½œæ¨¡å¼
- æ¯”å¦‚ï¼šå‡Œæ™¨3ç‚¹æœ‰äººç–¯ç‹‚åˆ é™¤æ•°æ®ï¼Œè‚¯å®šæœ‰é—®é¢˜

**è´£ä»»ç•Œå®š**
- æ˜ç¡®æ˜¯ç³»ç»Ÿbugè¿˜æ˜¯äººä¸ºæ“ä½œ
- è°çš„è´£ä»»ä¸€ç›®äº†ç„¶

### 1.3 å®¡è®¡æ—¥å¿—çš„æ ¸å¿ƒè¦ç´ 


**å¿…å¤‡ä¿¡æ¯ï¼ˆ5W1HåŸåˆ™ï¼‰ï¼š**

```
ğŸ“‹ å®¡è®¡æ—¥å¿—åº”è¯¥è®°å½•ä»€ä¹ˆï¼Ÿ

âœ… WHO   - è°æ“ä½œçš„ï¼ˆç”¨æˆ·å/IDï¼‰
âœ… WHEN  - ä»€ä¹ˆæ—¶å€™ï¼ˆç²¾ç¡®æ—¶é—´æˆ³ï¼‰
âœ… WHERE - ä»å“ªé‡Œæ¥ï¼ˆIPåœ°å€/è®¾å¤‡ï¼‰
âœ… WHAT  - åšäº†ä»€ä¹ˆï¼ˆå…·ä½“æ“ä½œï¼‰
âœ… WHY   - ä¸ºä»€ä¹ˆï¼ˆæ“ä½œåŸå› /ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼‰
âœ… HOW   - ç»“æœå¦‚ä½•ï¼ˆæˆåŠŸ/å¤±è´¥/é”™è¯¯ä¿¡æ¯ï¼‰

å®ä¾‹ï¼š
[2024-01-15 10:30:25] admin(WHO) ä»192.168.1.100(WHERE) 
æ‰§è¡Œåˆ é™¤ç”¨æˆ·æ“ä½œ(WHAT)ï¼ŒåŸå› ï¼šç”¨æˆ·ç”³è¯·æ³¨é”€(WHY)ï¼Œ
æ“ä½œæˆåŠŸ(HOW)
```

---

## 2. ğŸ” ç™»å½•æ—¥å¿—è®°å½•


### 2.1 ä¸ºä»€ä¹ˆè¦è®°å½•ç™»å½•æ—¥å¿—


**å®‰å…¨é˜²æŠ¤ç¬¬ä¸€é“é˜²çº¿**ï¼š
- ç™»å½•æ˜¯è¿›å…¥ç³»ç»Ÿçš„å¤§é—¨ï¼Œå¿…é¡»ä¸¥å¯†ç›‘æ§
- å¼‚å¸¸ç™»å½•å¾€å¾€æ˜¯æ”»å‡»çš„å‰å…†

**å¸¸è§å®‰å…¨å¨èƒï¼š**
```
âš ï¸ æš´åŠ›ç ´è§£ï¼šçŸ­æ—¶é—´å†…å¤§é‡ç™»å½•å¤±è´¥
âš ï¸ è´¦å·ç›—ç”¨ï¼šå¼‚åœ°ç™»å½•ã€å¼‚å¸¸æ—¶é—´ç™»å½•  
âš ï¸ æ’åº“æ”»å‡»ï¼šä½¿ç”¨å…¶ä»–ç½‘ç«™æ³„éœ²çš„å¯†ç å°è¯•ç™»å½•
```

### 2.2 ç™»å½•æ—¥å¿—å®ç°


**åŸºç¡€å®ç°æ–¹å¼**ï¼š

```java
// ç™»å½•äº‹ä»¶ç›‘å¬å™¨ï¼ˆSpringçš„äº‹ä»¶æœºåˆ¶ï¼‰
@Component
public class LoginEventListener {
    
    @Autowired
    private LoginLogService loginLogService;
    
    // ç›‘å¬ç™»å½•æˆåŠŸäº‹ä»¶
    @EventListener
    public void handleLoginSuccess(AuthenticationSuccessEvent event) {
        // è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯
        String username = event.getAuthentication().getName();
        
        // è·å–è¯·æ±‚ä¿¡æ¯
        ServletRequestAttributes attrs = 
            (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attrs.getRequest();
        
        // è®°å½•ç™»å½•æ—¥å¿—
        LoginLog log = new LoginLog();
        log.setUsername(username);
        log.setLoginTime(new Date());
        log.setIpAddress(getIpAddr(request));
        log.setStatus("æˆåŠŸ");
        
        loginLogService.save(log);
    }
    
    // ç›‘å¬ç™»å½•å¤±è´¥äº‹ä»¶
    @EventListener
    public void handleLoginFailure(AuthenticationFailureBadCredentialsEvent event) {
        String username = event.getAuthentication().getName();
        // è®°å½•å¤±è´¥æ—¥å¿—...
    }
}
```

### 2.3 ç™»å½•æ—¥å¿—åº”è¯¥è®°å½•ä»€ä¹ˆ


**ğŸ“ æ ¸å¿ƒè®°å½•å†…å®¹ï¼š**

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ | é‡è¦æ€§ |
|------|------|------|--------|
| **ç”¨æˆ·å** | ç™»å½•è´¦å· | `admin` | â­â­â­ |
| **ç™»å½•æ—¶é—´** | ç²¾ç¡®åˆ°ç§’ | `2024-01-15 10:30:25` | â­â­â­ |
| **IPåœ°å€** | æ¥æºIP | `192.168.1.100` | â­â­â­ |
| **ç™»å½•çŠ¶æ€** | æˆåŠŸ/å¤±è´¥ | `æˆåŠŸ` | â­â­â­ |
| **å¤±è´¥åŸå› ** | é”™è¯¯ä¿¡æ¯ | `å¯†ç é”™è¯¯` | â­â­ |
| **æµè§ˆå™¨ä¿¡æ¯** | User-Agent | `Chrome 120` | â­ |
| **åœ°ç†ä½ç½®** | IPå®šä½ | `åŒ—äº¬å¸‚` | â­ |

### 2.4 å¼‚å¸¸ç™»å½•æ£€æµ‹


**ğŸš¨ å…¸å‹å¼‚å¸¸æ¨¡å¼è¯†åˆ«ï¼š**

```
å¼‚å¸¸æ£€æµ‹è§„åˆ™ï¼š

1. çŸ­æ—¶é—´å¤šæ¬¡å¤±è´¥ï¼ˆæš´åŠ›ç ´è§£ï¼‰
   è§„åˆ™ï¼š5åˆ†é’Ÿå†…å¤±è´¥3æ¬¡ â†’ é”å®šè´¦å·30åˆ†é’Ÿ
   
2. å¼‚åœ°ç™»å½•ï¼ˆè´¦å·ç›—ç”¨ï¼‰  
   è§„åˆ™ï¼š1å°æ—¶å†…ä»åŒ—äº¬å’Œä¸Šæµ·ç™»å½• â†’ å‘é€éªŒè¯çŸ­ä¿¡
   
3. éå·¥ä½œæ—¶é—´ç™»å½•ï¼ˆå¯ç–‘è¡Œä¸ºï¼‰
   è§„åˆ™ï¼šå‡Œæ™¨2ç‚¹ç™»å½• â†’ è§¦å‘å‘Šè­¦
   
4. æ–°è®¾å¤‡ç™»å½•ï¼ˆå®‰å…¨éªŒè¯ï¼‰
   è§„åˆ™ï¼šæ£€æµ‹åˆ°æ–°è®¾å¤‡ â†’ å‘é€éªŒè¯ç ç¡®è®¤
```

**ç®€å•å®ç°æ€è·¯**ï¼š

```java
// ç™»å½•æ£€æŸ¥æœåŠ¡
@Service
public class LoginCheckService {
    
    // æ£€æŸ¥æ˜¯å¦é¢‘ç¹å¤±è´¥
    public boolean isFrequentFailure(String username) {
        // æŸ¥è¯¢æœ€è¿‘5åˆ†é’Ÿçš„å¤±è´¥æ¬¡æ•°
        long failCount = loginLogRepository
            .countByUsernameAndStatusAndTimeAfter(
                username, "å¤±è´¥", 
                Date.from(Instant.now().minus(5, ChronoUnit.MINUTES))
            );
        
        return failCount >= 3;  // è¶…è¿‡3æ¬¡è§†ä¸ºå¼‚å¸¸
    }
    
    // æ£€æŸ¥å¼‚åœ°ç™»å½•
    public boolean isAbnormalLocation(String username, String currentIp) {
        // è·å–æœ€è¿‘ä¸€æ¬¡ç™»å½•çš„IP
        LoginLog lastLogin = loginLogRepository
            .findFirstByUsernameOrderByLoginTimeDesc(username);
        
        if (lastLogin == null) return false;
        
        // å¯¹æ¯”IPå½’å±åœ°ï¼ˆéœ€è¦IPåœ°ç†ä½ç½®åº“ï¼‰
        String lastCity = ipService.getCity(lastLogin.getIpAddress());
        String currentCity = ipService.getCity(currentIp);
        
        return !lastCity.equals(currentCity);
    }
}
```

---

## 3. ğŸ›¡ï¸ æƒé™è®¿é—®æ—¥å¿—


### 3.1 ä»€ä¹ˆæ˜¯æƒé™è®¿é—®æ—¥å¿—


**é€šä¿—ç†è§£**ï¼š
è®°å½•ç”¨æˆ·è®¿é—®äº†å“ªäº›åŠŸèƒ½ã€æŸ¥çœ‹äº†å“ªäº›æ•°æ®ã€‚å°±åƒå•†åœºçš„é¡¾å®¢è¡Œä¸ºè¿½è¸ªï¼ŒçŸ¥é“é¡¾å®¢å»äº†å“ªäº›åŒºåŸŸã€çœ‹äº†å“ªäº›å•†å“ã€‚

**ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ**
- å‘ç°è¶Šæƒè®¿é—®ï¼ˆç”¨æˆ·è®¿é—®äº†ä¸è¯¥è®¿é—®çš„æ•°æ®ï¼‰
- åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼
- å®¡è®¡åˆè§„è¦æ±‚

### 3.2 ä½¿ç”¨AOPè®°å½•è®¿é—®æ—¥å¿—


**ğŸ’¡ å®ç°åŸç†**ï¼š
ä½¿ç”¨Spring AOPï¼ˆåˆ‡é¢ç¼–ç¨‹ï¼‰è‡ªåŠ¨è®°å½•æ¥å£è®¿é—®ï¼Œä¸ç”¨åœ¨æ¯ä¸ªæ–¹æ³•é‡Œå†™æ—¥å¿—ä»£ç ã€‚

```java
// è‡ªå®šä¹‰æ³¨è§£æ ‡è®°éœ€è¦å®¡è®¡çš„æ¥å£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AuditLog {
    String operation();  // æ“ä½œè¯´æ˜
    String module();     // æ‰€å±æ¨¡å—
}

// AOPåˆ‡é¢å®ç°
@Aspect
@Component
public class AuditLogAspect {
    
    @Autowired
    private AuditLogService auditLogService;
    
    // åœ¨æ ‡æ³¨äº†@AuditLogçš„æ–¹æ³•æ‰§è¡Œåè®°å½•æ—¥å¿—
    @AfterReturning(
        pointcut = "@annotation(auditLog)", 
        returning = "result"
    )
    public void recordLog(JoinPoint joinPoint, AuditLog auditLog, Object result) {
        
        // è·å–å½“å‰ç”¨æˆ·
        String username = SecurityContextHolder.getContext()
            .getAuthentication().getName();
        
        // è·å–æ–¹æ³•å‚æ•°
        Object[] args = joinPoint.getArgs();
        
        // æ„å»ºæ—¥å¿—å¯¹è±¡
        AccessLog log = new AccessLog();
        log.setUsername(username);
        log.setOperation(auditLog.operation());
        log.setModule(auditLog.module());
        log.setParams(JSON.toJSONString(args));
        log.setResult(result != null ? "æˆåŠŸ" : "å¤±è´¥");
        log.setAccessTime(new Date());
        
        // ä¿å­˜æ—¥å¿—
        auditLogService.save(log);
    }
}
```

**ğŸ“Œ ä½¿ç”¨ç¤ºä¾‹ï¼š**

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // åªéœ€è¦åŠ ä¸ªæ³¨è§£ï¼Œè®¿é—®æ—¥å¿—è‡ªåŠ¨è®°å½•
    @AuditLog(operation = "æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨", module = "ç”¨æˆ·ç®¡ç†")
    @GetMapping
    public List<User> listUsers() {
        return userService.findAll();
    }
    
    @AuditLog(operation = "åˆ é™¤ç”¨æˆ·", module = "ç”¨æˆ·ç®¡ç†")
    @DeleteMapping("/{id}")
    public void deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
    }
}
```

### 3.3 è®¿é—®æ—¥å¿—è®°å½•ä»€ä¹ˆ


**ğŸ“Š å…³é”®ä¿¡æ¯ï¼š**

```
å®Œæ•´çš„è®¿é—®æ—¥å¿—ç»“æ„ï¼š

{
  "logId": "202401151030001",
  "username": "admin",              // è°è®¿é—®çš„
  "operation": "æŸ¥è¯¢è®¢å•è¯¦æƒ…",       // åšä»€ä¹ˆæ“ä½œ
  "module": "è®¢å•ç®¡ç†",              // å“ªä¸ªæ¨¡å—
  "url": "/api/orders/1001",        // è®¿é—®åœ°å€
  "method": "GET",                   // HTTPæ–¹æ³•
  "params": {"orderId": 1001},      // è¯·æ±‚å‚æ•°
  "result": "æˆåŠŸ",                  // æ‰§è¡Œç»“æœ
  "duration": "125ms",               // è€—æ—¶
  "accessTime": "2024-01-15 10:30:25",
  "ipAddress": "192.168.1.100"
}
```

---

## 4. ğŸ”’ æ•æ„Ÿæ“ä½œå®¡è®¡


### 4.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿæ“ä½œ


**æ ¸å¿ƒæ•æ„Ÿæ“ä½œåˆ†ç±»ï¼š**

```
ğŸ’° æ•°æ®æ“ä½œç±»ï¼ˆé«˜é£é™©ï¼‰
   âœ“ åˆ é™¤æ•°æ®ï¼ˆdeleteï¼‰
   âœ“ æ‰¹é‡ä¿®æ”¹ï¼ˆbatch updateï¼‰
   âœ“ æ•°æ®å¯¼å‡ºï¼ˆexportï¼‰

ğŸ”‘ æƒé™æ“ä½œç±»ï¼ˆé«˜é£é™©ï¼‰
   âœ“ ä¿®æ”¹è§’è‰²æƒé™
   âœ“ åˆ†é…ç”¨æˆ·æƒé™
   âœ“ ä¿®æ”¹ç³»ç»Ÿé…ç½®

ğŸ’³ ä¸šåŠ¡æ“ä½œç±»ï¼ˆä¸­é£é™©ï¼‰
   âœ“ è´¢åŠ¡å®¡æ ¸
   âœ“ è®¢å•é€€æ¬¾
   âœ“ ä»·æ ¼è°ƒæ•´

ğŸ“Š æ•°æ®è®¿é—®ç±»ï¼ˆä½é£é™©ï¼‰
   âœ“ æŸ¥çœ‹æ•æ„Ÿä¿¡æ¯
   âœ“ å¯¼å‡ºæŠ¥è¡¨
   âœ“ æ‰¹é‡æŸ¥è¯¢
```

### 4.2 æ•æ„Ÿæ“ä½œå®¡è®¡å®ç°


**å®Œæ•´å®¡è®¡æ–¹æ¡ˆï¼š**

```java
// æ•æ„Ÿæ“ä½œæ—¥å¿—å®ä½“
@Entity
public class SensitiveOperationLog {
    @Id
    private String logId;
    
    private String username;          // æ“ä½œäºº
    private String operation;         // æ“ä½œç±»å‹
    private String tableName;         // æ¶‰åŠè¡¨
    private String recordId;          // è®°å½•ID
    private String oldValue;          // ä¿®æ”¹å‰æ•°æ®
    private String newValue;          // ä¿®æ”¹åæ•°æ®
    private String reason;            // æ“ä½œåŸå› 
    private Date operationTime;
    private String approver;          // å®¡æ‰¹äººï¼ˆå¦‚éœ€è¦ï¼‰
}

// æ•æ„Ÿæ“ä½œåˆ‡é¢
@Aspect
@Component
public class SensitiveOperationAspect {
    
    @Around("@annotation(sensitive)")
    public Object logSensitiveOperation(
        ProceedingJoinPoint joinPoint, 
        SensitiveOperation sensitive
    ) throws Throwable {
        
        // æ‰§è¡Œå‰ï¼šè®°å½•åŸå§‹æ•°æ®
        Object oldData = getOldData(joinPoint);
        
        // æ‰§è¡Œæ“ä½œ
        Object result = joinPoint.proceed();
        
        // æ‰§è¡Œåï¼šè®°å½•æ–°æ•°æ®å’Œæ“ä½œæ—¥å¿—
        SensitiveOperationLog log = new SensitiveOperationLog();
        log.setOperation(sensitive.value());
        log.setOldValue(JSON.toJSONString(oldData));
        log.setNewValue(JSON.toJSONString(result));
        log.setReason(getReason(joinPoint));  // ä»å‚æ•°è·å–åŸå› 
        
        logService.save(log);
        
        return result;
    }
}
```

**ğŸ“ ä½¿ç”¨ç¤ºä¾‹ï¼š**

```java
@Service
public class UserService {
    
    @SensitiveOperation("åˆ é™¤ç”¨æˆ·")
    public void deleteUser(Long userId, String reason) {
        // reasonå‚æ•°ä¼šè¢«è®°å½•åˆ°å®¡è®¡æ—¥å¿—ä¸­
        userRepository.deleteById(userId);
    }
    
    @SensitiveOperation("ä¿®æ”¹ç”¨æˆ·è§’è‰²")
    public void updateUserRole(Long userId, String newRole, String reason) {
        User user = userRepository.findById(userId);
        user.setRole(newRole);
        userRepository.save(user);
    }
}
```

### 4.3 æ•°æ®å˜æ›´è¿½è¸ª


**ğŸ”„ è®°å½•æ•°æ®å˜åŒ–çš„å‰åå¯¹æ¯”ï¼š**

```
åˆ é™¤ç”¨æˆ·å®¡è®¡ç¤ºä¾‹ï¼š

æ“ä½œæ—¶é—´ï¼š2024-01-15 10:30:25
æ“ä½œäººï¼šadmin
æ“ä½œç±»å‹ï¼šåˆ é™¤ç”¨æˆ·
è®°å½•IDï¼šuser_1001

å˜æ›´å‰æ•°æ®ï¼š
{
  "userId": 1001,
  "username": "zhangsan",
  "role": "æ™®é€šç”¨æˆ·",
  "status": "æ­£å¸¸"
}

å˜æ›´åæ•°æ®ï¼šnullï¼ˆå·²åˆ é™¤ï¼‰

æ“ä½œåŸå› ï¼šç”¨æˆ·ç”³è¯·æ³¨é”€è´¦å·
å®¡æ‰¹äººï¼šmanager
```

---

## 5. ğŸ“‹ æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ ‡å‡†åŒ–


**ç»Ÿä¸€æ ¼å¼çš„å¥½å¤„ï¼š**
- æ–¹ä¾¿æ—¥å¿—åˆ†æå·¥å…·è§£æ
- ä¾¿äºæœç´¢å’Œç»Ÿè®¡
- æ”¯æŒè·¨ç³»ç»Ÿæ—¥å¿—èšåˆ

**å¸¸è§æ—¥å¿—æ ¼å¼æ ‡å‡†ï¼š**
```
âœ“ JSONæ ¼å¼ï¼ˆæ¨èï¼‰- ç»“æ„åŒ–ã€æ˜“è§£æ
âœ“ ELKæ ¼å¼ - é€‚é…Elasticsearch
âœ“ Syslogæ ¼å¼ - æ ‡å‡†ç³»ç»Ÿæ—¥å¿—æ ¼å¼
```

### 5.2 JSONæ ¼å¼æ—¥å¿—è®¾è®¡


**ğŸ¯ æ ‡å‡†JSONæ—¥å¿—ç»“æ„ï¼š**

```json
{
  "timestamp": "2024-01-15T10:30:25.123Z",
  "level": "INFO",
  "service": "user-service",
  "traceId": "abc123def456",
  "spanId": "span001",
  "user": {
    "username": "admin",
    "userId": 1,
    "ip": "192.168.1.100"
  },
  "operation": {
    "type": "DELETE",
    "module": "ç”¨æˆ·ç®¡ç†",
    "action": "åˆ é™¤ç”¨æˆ·",
    "resource": "/api/users/1001"
  },
  "result": {
    "status": "success",
    "duration": 125,
    "message": "æ“ä½œæˆåŠŸ"
  },
  "context": {
    "reason": "ç”¨æˆ·ç”³è¯·æ³¨é”€",
    "approver": "manager"
  }
}
```

**ä»£ç å®ç°ï¼š**

```java
// æ—¥å¿—æ„å»ºå™¨ï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰
public class AuditLogBuilder {
    
    private final Map<String, Object> logData = new HashMap<>();
    
    public AuditLogBuilder timestamp(Date time) {
        logData.put("timestamp", time);
        return this;
    }
    
    public AuditLogBuilder user(String username, String ip) {
        Map<String, String> user = new HashMap<>();
        user.put("username", username);
        user.put("ip", ip);
        logData.put("user", user);
        return this;
    }
    
    public AuditLogBuilder operation(String type, String action) {
        Map<String, String> op = new HashMap<>();
        op.put("type", type);
        op.put("action", action);
        logData.put("operation", op);
        return this;
    }
    
    public String buildJson() {
        return JSON.toJSONString(logData);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
String logJson = new AuditLogBuilder()
    .timestamp(new Date())
    .user("admin", "192.168.1.100")
    .operation("DELETE", "åˆ é™¤ç”¨æˆ·")
    .buildJson();
```

### 5.3 æ—¥å¿—çº§åˆ«åˆ†ç±»


**ğŸ“Š æŒ‰é‡è¦æ€§åˆ†çº§ï¼š**

| çº§åˆ« | è¯´æ˜ | ç¤ºä¾‹åœºæ™¯ | ä¿ç•™æ—¶é•¿ |
|------|------|---------|---------|
| **CRITICAL** | ğŸ”´ ä¸¥é‡å®‰å…¨äº‹ä»¶ | æ•°æ®æ³„éœ²ã€ç³»ç»Ÿè¢«æ”»å‡» | æ°¸ä¹… |
| **ERROR** | ğŸŸ  é”™è¯¯æ“ä½œ | åˆ é™¤å¤±è´¥ã€è¶Šæƒè®¿é—® | 1å¹´ |
| **WARN** | ğŸŸ¡ è­¦å‘Šäº‹ä»¶ | å¼‚å¸¸ç™»å½•ã€é¢‘ç¹æ“ä½œ | 6ä¸ªæœˆ |
| **INFO** | ğŸ”µ ä¸€èˆ¬æ“ä½œ | æ­£å¸¸ç™»å½•ã€æŸ¥è¯¢æ•°æ® | 3ä¸ªæœˆ |
| **DEBUG** | âšª è°ƒè¯•ä¿¡æ¯ | è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹ | 1ä¸ªæœˆ |

---

## 6. ğŸ’¾ æ—¥å¿—å­˜å‚¨ç­–ç•¥


### 6.1 æ—¥å¿—å­˜å‚¨æ–¹æ¡ˆé€‰æ‹©


**å¸¸è§å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”ï¼š**

```
ğŸ“¦ æ•°æ®åº“å­˜å‚¨ï¼ˆMySQL/PostgreSQLï¼‰
   ä¼˜ç‚¹ï¼šâœ“ æŸ¥è¯¢æ–¹ä¾¿ âœ“ æ”¯æŒäº‹åŠ¡ âœ“ æ•°æ®ä¸€è‡´æ€§å¥½
   ç¼ºç‚¹ï¼šâœ— æ•°æ®é‡å¤§æ—¶æ€§èƒ½å·® âœ— ç£ç›˜å ç”¨é«˜
   é€‚åˆï¼šçŸ­æœŸæ—¥å¿—ã€é‡è¦å®¡è®¡æ—¥å¿—

ğŸ“‚ æ–‡ä»¶å­˜å‚¨ï¼ˆæ—¥å¿—æ–‡ä»¶ï¼‰  
   ä¼˜ç‚¹ï¼šâœ“ å†™å…¥å¿« âœ“ å ç”¨ç©ºé—´å° âœ“ ä¾¿äºå½’æ¡£
   ç¼ºç‚¹ï¼šâœ— æŸ¥è¯¢ä¸ä¾¿ âœ— åˆ†æå›°éš¾
   é€‚åˆï¼šå¤§é‡æ—¥å¿—ã€é•¿æœŸå½’æ¡£

ğŸ” ESå­˜å‚¨ï¼ˆElasticsearchï¼‰
   ä¼˜ç‚¹ï¼šâœ“ å…¨æ–‡æœç´¢å¼ºå¤§ âœ“ å®æ—¶åˆ†æ âœ“ æ”¯æŒæµ·é‡æ•°æ®
   ç¼ºç‚¹ï¼šâœ— éƒ¨ç½²å¤æ‚ âœ— èµ„æºæ¶ˆè€—é«˜
   é€‚åˆï¼šæ—¥å¿—åˆ†æã€å®æ—¶ç›‘æ§
```

### 6.2 åˆ†çº§å­˜å‚¨ç­–ç•¥


**â™»ï¸ æ—¥å¿—ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š**

```
æ—¥å¿—å­˜å‚¨åˆ†å±‚ç­–ç•¥ï¼š

ç¬¬1å±‚ï¼šçƒ­æ•°æ®ï¼ˆè¿‘7å¤©ï¼‰
   å­˜å‚¨ï¼šMySQL + Redisç¼“å­˜
   ç‰¹ç‚¹ï¼šå®æ—¶æŸ¥è¯¢ã€é«˜é¢‘è®¿é—®
   
ç¬¬2å±‚ï¼šæ¸©æ•°æ®ï¼ˆ7-30å¤©ï¼‰
   å­˜å‚¨ï¼šElasticsearch
   ç‰¹ç‚¹ï¼šæ”¯æŒæ£€ç´¢ã€å®šæœŸåˆ†æ
   
ç¬¬3å±‚ï¼šå†·æ•°æ®ï¼ˆ30-90å¤©ï¼‰
   å­˜å‚¨ï¼šæ—¥å¿—æ–‡ä»¶ + å‹ç¼©
   ç‰¹ç‚¹ï¼šä½é¢‘è®¿é—®ã€èŠ‚çœç©ºé—´
   
ç¬¬4å±‚ï¼šå½’æ¡£æ•°æ®ï¼ˆ90å¤©ä»¥ä¸Šï¼‰
   å­˜å‚¨ï¼šå¯¹è±¡å­˜å‚¨ï¼ˆOSS/S3ï¼‰
   ç‰¹ç‚¹ï¼šé•¿æœŸä¿å­˜ã€åˆè§„è¦æ±‚
```

**ä»£ç ç¤ºä¾‹ï¼š**

```java
@Service
public class LogStorageService {
    
    // ä¿å­˜æ—¥å¿—ï¼ˆè‡ªåŠ¨åˆ†çº§ï¼‰
    public void saveLog(AuditLog log) {
        // å®æ—¶æ—¥å¿—å­˜å…¥æ•°æ®åº“
        logRepository.save(log);
        
        // åŒæ—¶å‘é€åˆ°ESï¼ˆå¼‚æ­¥ï¼‰
        elasticsearchTemplate.save(log);
        
        // åŒæ—¶å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼ˆå¼‚æ­¥ï¼‰
        logFileWriter.write(log);
    }
    
    // å®šæ—¶ä»»åŠ¡ï¼šæ•°æ®è¿ç§»ï¼ˆæ¯å¤©å‡Œæ™¨æ‰§è¡Œï¼‰
    @Scheduled(cron = "0 0 2 * * ?")
    public void archiveOldLogs() {
        // æŸ¥è¯¢7å¤©å‰çš„æ—¥å¿—
        Date sevenDaysAgo = DateUtils.addDays(new Date(), -7);
        List<AuditLog> oldLogs = logRepository
            .findByCreateTimeBefore(sevenDaysAgo);
        
        // è¿ç§»åˆ°æ–‡ä»¶å­˜å‚¨
        for (AuditLog log : oldLogs) {
            archiveToFile(log);
            logRepository.delete(log);  // ä»æ•°æ®åº“åˆ é™¤
        }
    }
}
```

### 6.3 æ—¥å¿—æ¸…ç†ç­–ç•¥


**ğŸ—‘ï¸ è‡ªåŠ¨æ¸…ç†è§„åˆ™ï¼š**

```java
@Configuration
public class LogCleanupConfig {
    
    // é…ç½®æ¸…ç†ç­–ç•¥
    @Bean
    public LogCleanupStrategy cleanupStrategy() {
        return LogCleanupStrategy.builder()
            .debugLogRetention(30)      // Debugæ—¥å¿—ä¿ç•™30å¤©
            .infoLogRetention(90)       // Infoæ—¥å¿—ä¿ç•™90å¤©
            .warnLogRetention(180)      // Warnæ—¥å¿—ä¿ç•™180å¤©
            .errorLogRetention(365)     // Erroræ—¥å¿—ä¿ç•™1å¹´
            .criticalLogRetention(-1)   // ä¸¥é‡æ—¥å¿—æ°¸ä¹…ä¿ç•™
            .build();
    }
    
    // å®šæ—¶æ¸…ç†ä»»åŠ¡
    @Scheduled(cron = "0 0 3 * * ?")
    public void cleanOldLogs() {
        logCleanupService.cleanByStrategy(cleanupStrategy());
    }
}
```

---

## 7. ğŸš¨ å®æ—¶ç›‘æ§å‘Šè­¦


### 7.1 ç›‘æ§æŒ‡æ ‡è®¾è®¡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š**

```
å®‰å…¨ç›‘æ§æŒ‡æ ‡ä½“ç³»ï¼š

ğŸ” ç™»å½•å®‰å…¨
   âœ“ ç™»å½•å¤±è´¥ç‡ï¼ˆ>5%è§¦å‘å‘Šè­¦ï¼‰
   âœ“ å¼‚åœ°ç™»å½•æ¬¡æ•°
   âœ“ æš´åŠ›ç ´è§£å°è¯•

âš ï¸ æ“ä½œå¼‚å¸¸  
   âœ“ æ•æ„Ÿæ“ä½œé¢‘ç‡
   âœ“ æ‰¹é‡åˆ é™¤æ“ä½œ
   âœ“ éå·¥ä½œæ—¶é—´æ“ä½œ

ğŸ“Š ç³»ç»Ÿå¥åº·
   âœ“ æ—¥å¿—å†™å…¥é€Ÿåº¦
   âœ“ æ—¥å¿—å­˜å‚¨å®¹é‡
   âœ“ æ—¥å¿—æŸ¥è¯¢æ€§èƒ½
```

### 7.2 å‘Šè­¦è§„åˆ™é…ç½®


**å®ç°æ–¹å¼ï¼š**

```java
// å‘Šè­¦è§„åˆ™é…ç½®
@Configuration
public class AlertRuleConfig {
    
    // ç™»å½•å¤±è´¥å‘Šè­¦è§„åˆ™
    @Bean
    public AlertRule loginFailureRule() {
        return AlertRule.builder()
            .name("ç™»å½•å¤±è´¥å‘Šè­¦")
            .condition("ç™»å½•å¤±è´¥æ¬¡æ•° > 3 åœ¨ 5åˆ†é’Ÿå†…")
            .action(this::sendLoginAlert)
            .build();
    }
    
    // å‘Šè­¦æ‰§è¡Œé€»è¾‘
    private void sendLoginAlert(AlertEvent event) {
        // å‘é€é‚®ä»¶
        emailService.send(
            "security@company.com",
            "ç™»å½•å¼‚å¸¸å‘Šè­¦",
            "ç”¨æˆ·" + event.getUsername() + "ç™»å½•å¤±è´¥" + event.getCount() + "æ¬¡"
        );
        
        // å‘é€é’‰é’‰/ä¼ä¸šå¾®ä¿¡
        dingTalkService.sendAlert(event);
        
        // è®°å½•å‘Šè­¦æ—¥å¿—
        alertLogService.save(event);
    }
}
```

### 7.3 å®æ—¶ç›‘æ§å®ç°


**ğŸ’¡ ä½¿ç”¨Spring Eventå®ç°å®æ—¶ç›‘æ§ï¼š**

```java
// å®‰å…¨äº‹ä»¶ç›‘æ§å™¨
@Component
public class SecurityMonitor {
    
    @Autowired
    private AlertService alertService;
    
    // ç›‘å¬æ‰€æœ‰å®¡è®¡æ—¥å¿—äº‹ä»¶
    @EventListener
    public void monitorAuditLog(AuditLogEvent event) {
        AuditLog log = event.getLog();
        
        // æ£€æŸ¥1: é¢‘ç¹æ“ä½œæ£€æµ‹
        if (isFrequentOperation(log)) {
            alertService.trigger(
                AlertType.FREQUENT_OPERATION,
                "ç”¨æˆ·" + log.getUsername() + "æ“ä½œè¿‡äºé¢‘ç¹"
            );
        }
        
        // æ£€æŸ¥2: æ•æ„Ÿæ“ä½œæ£€æµ‹
        if (isSensitiveOperation(log)) {
            alertService.trigger(
                AlertType.SENSITIVE_OPERATION,
                "æ£€æµ‹åˆ°æ•æ„Ÿæ“ä½œï¼š" + log.getOperation()
            );
        }
        
        // æ£€æŸ¥3: å¼‚å¸¸æ—¶é—´æ£€æµ‹
        if (isAbnormalTime(log)) {
            alertService.trigger(
                AlertType.ABNORMAL_TIME,
                "éå·¥ä½œæ—¶é—´æ“ä½œï¼š" + log.getOperationTime()
            );
        }
    }
    
    // é¢‘ç¹æ“ä½œåˆ¤æ–­
    private boolean isFrequentOperation(AuditLog log) {
        // ç»Ÿè®¡æœ€è¿‘1åˆ†é’Ÿçš„æ“ä½œæ¬¡æ•°
        long count = logRepository.countRecentOperations(
            log.getUsername(), 
            Duration.ofMinutes(1)
        );
        return count > 10;  // 1åˆ†é’Ÿè¶…è¿‡10æ¬¡è§†ä¸ºé¢‘ç¹
    }
}
```

---

## 8. ğŸ“Š å®‰å…¨äº‹ä»¶åˆ†æ


### 8.1 æ—¥å¿—åˆ†æç»´åº¦


**ğŸ” å¤šç»´åº¦åˆ†æä½“ç³»ï¼š**

```
åˆ†æç»´åº¦å›¾ï¼š

æ—¶é—´ç»´åº¦ â”€â”€â”€â”€â”€â†’ è¶‹åŠ¿åˆ†æ
   â”œâ”€ æŒ‰å°æ—¶ç»Ÿè®¡
   â”œâ”€ æŒ‰å¤©ç»Ÿè®¡  
   â””â”€ æŒ‰å‘¨/æœˆç»Ÿè®¡

ç”¨æˆ·ç»´åº¦ â”€â”€â”€â”€â”€â†’ è¡Œä¸ºåˆ†æ
   â”œâ”€ æ´»è·ƒç”¨æˆ·TOP10
   â”œâ”€ é«˜é£é™©ç”¨æˆ·è¯†åˆ«
   â””â”€ ç”¨æˆ·æ“ä½œä¹ æƒ¯

æ“ä½œç»´åº¦ â”€â”€â”€â”€â”€â†’ çƒ­ç‚¹åˆ†æ
   â”œâ”€ é«˜é¢‘æ“ä½œç»Ÿè®¡
   â”œâ”€ æ•æ„Ÿæ“ä½œæ±‡æ€»
   â””â”€ å¤±è´¥æ“ä½œåˆ†æ

åœ°åŸŸç»´åº¦ â”€â”€â”€â”€â”€â†’ å¼‚å¸¸æ£€æµ‹
   â”œâ”€ IPåœ°åŸŸåˆ†å¸ƒ
   â”œâ”€ å¼‚åœ°è®¿é—®ç»Ÿè®¡
   â””â”€ å¯ç–‘IPè¯†åˆ«
```

### 8.2 SQLåˆ†æç¤ºä¾‹


**å¸¸ç”¨åˆ†ææŸ¥è¯¢ï¼š**

```sql
-- 1. ç™»å½•å¤±è´¥æ¬¡æ•°TOP10ç”¨æˆ·
SELECT username, COUNT(*) as fail_count
FROM login_log
WHERE status = 'å¤±è´¥' 
  AND login_time > DATE_SUB(NOW(), INTERVAL 1 DAY)
GROUP BY username
ORDER BY fail_count DESC
LIMIT 10;

-- 2. æ•æ„Ÿæ“ä½œç»Ÿè®¡
SELECT operation, COUNT(*) as count
FROM sensitive_operation_log
WHERE operation_time > DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY operation
ORDER BY count DESC;

-- 3. å¼‚å¸¸æ—¶é—´æ“ä½œè®°å½•
SELECT username, operation, operation_time
FROM audit_log
WHERE HOUR(operation_time) NOT BETWEEN 8 AND 18
  AND DATE(operation_time) = CURDATE()
ORDER BY operation_time DESC;

-- 4. å¼‚åœ°ç™»å½•æ£€æµ‹
SELECT a.username, a.ip_address as ip1, b.ip_address as ip2,
       a.login_time, b.login_time
FROM login_log a
JOIN login_log b ON a.username = b.username
WHERE a.login_time < b.login_time
  AND TIMESTAMPDIFF(HOUR, a.login_time, b.login_time) <= 1
  AND a.city <> b.city;
```

### 8.3 å¯è§†åŒ–åˆ†æ


**ğŸ“ˆ å¸¸è§åˆ†æå›¾è¡¨ï¼š**

```
ä»ªè¡¨ç›˜è®¾è®¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä»Šæ—¥å®‰å…¨æ¦‚è§ˆ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç™»å½•æ¬¡æ•°: 1,234  æˆåŠŸç‡: 98.5%      â”‚
â”‚ æ•æ„Ÿæ“ä½œ: 45     å‘Šè­¦æ¬¡æ•°: 3        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç™»å½•è¶‹åŠ¿å›¾     â”‚  â”‚  æ“ä½œç±»å‹åˆ†å¸ƒ   â”‚
â”‚     /\          â”‚  â”‚   â”Œâ”€â”           â”‚
â”‚    /  \    /\   â”‚  â”‚   â”‚â–ˆâ”‚ æŸ¥è¯¢ 60%  â”‚
â”‚   /    \  /  \  â”‚  â”‚   â”œâ”€â”¤           â”‚
â”‚  /      \/    \ â”‚  â”‚   â”‚â–ˆâ”‚ ä¿®æ”¹ 30%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚â–ˆâ”‚ åˆ é™¤ 10%  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å¼‚å¸¸äº‹ä»¶åˆ—è¡¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸ ç”¨æˆ·adminåœ¨å‡Œæ™¨2ç‚¹åˆ é™¤äº†100æ¡æ•°æ® â”‚
â”‚ âš ï¸ ç”¨æˆ·testè¿ç»­ç™»å½•å¤±è´¥5æ¬¡          â”‚
â”‚ âš ï¸ æ£€æµ‹åˆ°ä»ç¾å›½IPçš„å¼‚å¸¸ç™»å½•          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 æ™ºèƒ½åˆ†æå®ç°


```java
@Service
public class SecurityAnalysisService {
    
    // ç”Ÿæˆå®‰å…¨åˆ†ææŠ¥å‘Š
    public SecurityReport generateDailyReport(Date date) {
        SecurityReport report = new SecurityReport();
        
        // 1. ç»Ÿè®¡åŸºç¡€æ•°æ®
        report.setTotalLogins(loginLogRepository.countByDate(date));
        report.setFailedLogins(loginLogRepository.countFailureByDate(date));
        
        // 2. è¯†åˆ«é«˜é£é™©ç”¨æˆ·
        List<String> riskUsers = findRiskUsers(date);
        report.setRiskUsers(riskUsers);
        
        // 3. åˆ†ææ“ä½œè¶‹åŠ¿
        Map<String, Long> operationTrend = analyzeOperationTrend(date);
        report.setOperationTrend(operationTrend);
        
        // 4. å¼‚å¸¸äº‹ä»¶æ±‡æ€»
        List<AbnormalEvent> abnormalEvents = detectAbnormalEvents(date);
        report.setAbnormalEvents(abnormalEvents);
        
        return report;
    }
    
    // é«˜é£é™©ç”¨æˆ·è¯†åˆ«
    private List<String> findRiskUsers(Date date) {
        // è§„åˆ™1: é¢‘ç¹å¤±è´¥ç™»å½•
        List<String> frequentFailUsers = loginLogRepository
            .findUsersWithFrequentFailure(date, 5);
        
        // è§„åˆ™2: å¤§é‡æ•æ„Ÿæ“ä½œ
        List<String> sensitiveOpUsers = auditLogRepository
            .findUsersWithManySensitiveOps(date, 10);
        
        // åˆå¹¶å»é‡
        Set<String> riskUsers = new HashSet<>();
        riskUsers.addAll(frequentFailUsers);
        riskUsers.addAll(sensitiveOpUsers);
        
        return new ArrayList<>(riskUsers);
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ å®¡è®¡æ—¥å¿—æ ¸å¿ƒè¦ç´ ï¼š
   âœ“ 5W1HåŸåˆ™ï¼šWHOã€WHENã€WHEREã€WHATã€WHYã€HOW
   âœ“ ä¸‰å¤§æ—¥å¿—ï¼šç™»å½•æ—¥å¿—ã€è®¿é—®æ—¥å¿—ã€æ•æ„Ÿæ“ä½œæ—¥å¿—
   âœ“ å››ä¸ªç¯èŠ‚ï¼šè®°å½•ã€å­˜å‚¨ã€åˆ†æã€å‘Šè­¦

ğŸ” å®‰å…¨å®¡è®¡ä»·å€¼ï¼š
   âœ“ å®‰å…¨è¿½æº¯ï¼šå‡ºé—®é¢˜èƒ½æŸ¥åˆ°æ ¹æº
   âœ“ åˆè§„è¦æ±‚ï¼šæ»¡è¶³æ³•å¾‹æ³•è§„
   âœ“ è¡Œä¸ºåˆ†æï¼šå‘ç°å¼‚å¸¸æ¨¡å¼
   âœ“ è´£ä»»ç•Œå®šï¼šæ˜ç¡®æ“ä½œè´£ä»»
```

### 9.2 å®æ–½è¦ç‚¹


**â­â­â­ æ ¸å¿ƒå®è·µå»ºè®®ï¼š**

```
1ï¸âƒ£ æ—¥å¿—è®°å½•åŸåˆ™
   âœ“ å…³é”®æ“ä½œå¿…è®°å½•ï¼ˆç™»å½•ã€åˆ é™¤ã€æƒé™å˜æ›´ï¼‰
   âœ“ æ•æ„Ÿæ•°æ®è¦è„±æ•ï¼ˆå¯†ç ã€èº«ä»½è¯å·ï¼‰
   âœ“ æ€§èƒ½å½±å“è¦æ§åˆ¶ï¼ˆå¼‚æ­¥è®°å½•ï¼‰

2ï¸âƒ£ å­˜å‚¨ç­–ç•¥
   âœ“ åˆ†çº§å­˜å‚¨ï¼šçƒ­æ•°æ®DBã€å†·æ•°æ®æ–‡ä»¶
   âœ“ å®šæœŸå½’æ¡£ï¼šè¶…è¿‡ä¿ç•™æœŸè‡ªåŠ¨å½’æ¡£
   âœ“ å®¹é‡è§„åˆ’ï¼šé¢„ä¼°æ—¥å¿—å¢é•¿é‡

3ï¸âƒ£ ç›‘æ§å‘Šè­¦
   âœ“ å®æ—¶ç›‘æ§ï¼šå…³é”®æŒ‡æ ‡å®æ—¶æ£€æµ‹
   âœ“ åˆ†çº§å‘Šè­¦ï¼šä¸¥é‡/è­¦å‘Š/æç¤º
   âœ“ å¤šæ¸ é“é€šçŸ¥ï¼šé‚®ä»¶ã€çŸ­ä¿¡ã€IM

4ï¸âƒ£ åˆ†æåº”ç”¨
   âœ“ å®šæœŸåˆ†æï¼šæ¯æ—¥/æ¯å‘¨å®‰å…¨æŠ¥å‘Š
   âœ“ è¶‹åŠ¿è¿½è¸ªï¼šå‘ç°å¼‚å¸¸æ¨¡å¼
   âœ“ æŒç»­ä¼˜åŒ–ï¼šæ ¹æ®åˆ†æç»“æœæ”¹è¿›
```

### 9.3 å¸¸è§é—®é¢˜ä¸è§£å†³


**â“ FAQï¼š**

```
Q1: æ—¥å¿—å¤ªå¤šå½±å“æ€§èƒ½æ€ä¹ˆåŠï¼Ÿ
A: âœ“ ä½¿ç”¨å¼‚æ­¥è®°å½•ï¼ˆ@Asyncï¼‰
   âœ“ æ‰¹é‡å†™å…¥æ•°æ®åº“
   âœ“ éå…³é”®æ—¥å¿—é™çº§

Q2: å¦‚ä½•é˜²æ­¢æ—¥å¿—è¢«ç¯¡æ”¹ï¼Ÿ
A: âœ“ ä½¿ç”¨åªè¿½åŠ çš„æ—¥å¿—æ–‡ä»¶
   âœ“ æ—¥å¿—ç­¾åæˆ–åŠ å¯†
   âœ“ å†™å…¥åç«‹å³å½’æ¡£

Q3: æ—¥å¿—å­˜å‚¨æˆæœ¬å¤ªé«˜ï¼Ÿ
A: âœ“ åˆ†çº§å­˜å‚¨ï¼ˆçƒ­æ¸©å†·æ•°æ®ï¼‰
   âœ“ æ—¥å¿—å‹ç¼©
   âœ“ å®šæœŸæ¸…ç†éå…³é”®æ—¥å¿—

Q4: å¦‚ä½•å¿«é€ŸæŸ¥è¯¢å†å²æ—¥å¿—ï¼Ÿ
A: âœ“ ä½¿ç”¨Elasticsearchå…¨æ–‡æ£€ç´¢
   âœ“ æŒ‰æ—¶é—´å’Œç”¨æˆ·å»ºç«‹ç´¢å¼•
   âœ“ çƒ­æ•°æ®ç¼“å­˜åˆ°Redis
```

### 9.4 è®°å¿†å£è¯€


```
ğŸ“ å®¡è®¡æ—¥å¿—è®°å¿ƒé—´ï¼š

ç™»å½•æ—¥å¿—é˜²æš´ç ´ï¼Œ
è®¿é—®æ—¥å¿—æŸ¥è¶Šæƒï¼Œ
æ•æ„Ÿæ“ä½œå¿…å®¡è®¡ï¼Œ
æ ¼å¼æ ‡å‡†ä¾¿åˆ†æã€‚

çƒ­æ¸©å†·æ•°åˆ†çº§å­˜ï¼Œ
å®æ—¶ç›‘æ§åŠ å‘Šè­¦ï¼Œ
å®šæœŸåˆ†ææ‰¾å¼‚å¸¸ï¼Œ
å®‰å…¨åˆè§„ä¸¤ä¸è¯¯ã€‚
```

---

**ğŸ“ å­¦ä¹ å»ºè®®ï¼š**

1. **å…ˆç†è§£æ¦‚å¿µ**ï¼šææ¸…æ¥šä¸ºä»€ä¹ˆè¦åšå®¡è®¡ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜
2. **åŠ¨æ‰‹å®è·µ**ï¼šä»ç™»å½•æ—¥å¿—å¼€å§‹ï¼Œé€æ­¥å®Œå–„å®¡è®¡ä½“ç³»
3. **æ³¨é‡å®ç”¨**ï¼šä¸è¦è¿½æ±‚å®Œç¾ï¼Œå…ˆæ»¡è¶³æ ¸å¿ƒéœ€æ±‚
4. **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´æ—¥å¿—ç­–ç•¥

> ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼šå®¡è®¡æ—¥å¿—ä¸æ˜¯ä¸ºäº†è®°å½•è€Œè®°å½•ï¼Œè€Œæ˜¯ä¸ºäº†åœ¨å…³é”®æ—¶åˆ»èƒ½å¿«é€Ÿå®šä½é—®é¢˜ã€è¿½æº¯è´£ä»»ã€ä¿éšœç³»ç»Ÿå®‰å…¨ï¼