---
title: 3、基础配置详解
---
## 📚 目录

1. [XXL-JOB配置核心概念](#1-XXL-JOB配置核心概念)
2. [调度中心地址配置详解](#2-调度中心地址配置详解)  
3. [执行器配置全攻略](#3-执行器配置全攻略)
4. [安全认证配置](#4-安全认证配置)
5. [日志管理配置](#5-日志管理配置)
6. [网络配置优化](#6-网络配置优化)
7. [配置优先级与覆盖规则](#7-配置优先级与覆盖规则)
8. [实际部署配置示例](#8-实际部署配置示例)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🎯 XXL-JOB配置核心概念


### 1.1 什么是XXL-JOB配置

**简单理解**：就像给你的手机设置联系人一样，XXL-JOB需要知道"谁是老板"（调度中心）、"我是谁"（执行器）、"怎么联系"（网络配置）。

```
现实类比：
公司管理 ≈ XXL-JOB系统
┌─────────────┐     ┌─────────────┐
│   总经理     │ ←→  │  调度中心    │
│ (下达任务)   │     │ (管理任务)   │
└─────────────┘     └─────────────┘
       ↓                    ↓
┌─────────────┐     ┌─────────────┐
│   员工群体   │ ←→  │  执行器集群  │
│ (执行任务)   │     │ (运行任务)   │
└─────────────┘     └─────────────┘
```

### 1.2 配置的两大角色


**🏢 调度中心（Admin）**
- **作用**：任务的"大脑"，负责管理和调度
- **职责**：创建任务、监控执行、查看日志
- **类比**：项目经理，安排谁什么时候做什么事

**⚙️ 执行器（Executor）**  
- **作用**：任务的"双手"，负责实际执行
- **职责**：接收任务、执行业务逻辑、报告结果
- **类比**：程序员，接到需求后写代码实现

### 1.3 配置文件的作用


> 💡 **核心理解**：配置文件就像是"通讯录+工作手册"，告诉系统各个组件如何找到彼此，如何工作。

**配置解决的核心问题**：
- 📍 **位置问题**：调度中心在哪里？
- 🆔 **身份问题**：我是哪个执行器？  
- 🔒 **安全问题**：如何验证身份？
- 📝 **日志问题**：日志保存多久？
- 🌐 **网络问题**：如何通信？

---

## 2. 🏢 调度中心地址配置详解


### 2.1 调度中心地址的本质


**通俗理解**：就像你手机里存的"老板电话"，执行器需要知道调度中心的"电话号码"才能联系上。

```yaml
# 配置示例
xxl:
  job:
    admin:
      addresses: http://127.0.0.1:8080/xxl-job-admin
```

### 2.2 地址格式详解


**🔸 标准格式**
```
协议://IP地址:端口/应用路径
http://127.0.0.1:8080/xxl-job-admin
│   │  │        │    │
│   │  │        │    └── 应用路径（一般固定）
│   │  │        └─────── 端口号（默认8080）
│   │  └──────────────── IP地址（本机或远程）
│   └─────────────────── 协议（http或https）
```

**🔸 常见配置场景**

| 环境类型 | 配置示例 | 使用场景 |
|---------|---------|----------|
| **本地开发** | `http://localhost:8080/xxl-job-admin` | 开发测试 |
| **内网部署** | `http://192.168.1.100:8080/xxl-job-admin` | 公司内部 |
| **生产环境** | `http://job.company.com/xxl-job-admin` | 正式上线 |
| **高可用集群** | `http://job1.com,http://job2.com` | 多台调度中心 |

### 2.3 多地址配置（高可用）


**场景**：公司有多台调度中心服务器，防止单点故障

```yaml
xxl:
  job:
    admin:
      addresses: http://job1.company.com:8080/xxl-job-admin,http://job2.company.com:8080/xxl-job-admin
```

**工作原理**：
```
执行器启动时的地址选择：
┌─ 尝试连接 job1.company.com
├─ 连接成功 ✅ → 使用这个地址  
├─ 连接失败 ❌ → 尝试下一个
└─ 尝试连接 job2.company.com
```

> ⚠️ **注意事项**：多个地址用英文逗号分隔，不要有空格

---

## 3. ⚙️ 执行器配置全攻略


### 3.1 执行器端口设置


**🔌 端口的作用**：就像你家的门牌号，调度中心通过这个端口找到执行器。

```yaml
xxl:
  job:
    executor:
      port: 9999
```

**端口选择原则**：
- ✅ **避开系统端口**：不要用1-1024（系统保留）
- ✅ **避开常用端口**：8080（Tomcat）、3306（MySQL）等
- ✅ **企业内部协调**：同一台服务器上不同应用用不同端口
- ✅ **防火墙放行**：确保端口能被访问

**端口冲突解决**：
```
场景：一台服务器部署多个执行器
解决方案：
执行器A：port: 9999
执行器B：port: 9998  
执行器C：port: 9997
```

### 3.2 执行器名称定义


**🏷️ 执行器名称的作用**：就像员工的工号，用来区分不同的执行器。

```yaml
xxl:
  job:
    executor:
      appname: xxl-job-executor-sample
```

**命名规范建议**：
- 📝 **见名知意**：`user-service-executor`（用户服务执行器）
- 📝 **环境区分**：`order-service-prod`（生产环境订单服务）
- 📝 **版本标识**：`payment-service-v2`（支付服务v2版本）

**命名示例对比**：
```
❌ 不好的命名：
- executor1, executor2（无意义）
- test（不明确）
- abc（随意命名）

✅ 好的命名：
- user-service-executor（用户服务执行器）
- order-cleanup-job（订单清理任务）
- data-sync-executor（数据同步执行器）
```

### 3.3 执行器注册模式


**📋 自动注册 vs 手动注册**

```yaml
# 自动注册模式（推荐）
xxl:
  job:
    executor:
      address: ""  # 留空，系统自动获取IP
      
# 手动指定模式  
xxl:
  job:
    executor:
      address: "192.168.1.100:9999"  # 手动指定IP和端口
```

**选择建议**：

| 场景 | 推荐模式 | 原因 |
|-----|---------|------|
| **开发环境** | 自动注册 | IP经常变动，自动获取方便 |
| **测试环境** | 自动注册 | 环境切换频繁 |
| **生产环境** | 手动指定 | 网络环境复杂，手动指定更稳定 |
| **容器部署** | 手动指定 | 容器IP不固定，需要指定宿主机IP |

---

## 4. 🔒 安全认证配置


### 4.1 访问令牌的作用


**通俗理解**：访问令牌就像公司的门禁卡，只有持有正确门禁卡的人才能进入。

```yaml
xxl:
  job:
    accessToken: "your-secret-token-here"
```

### 4.2 令牌配置策略


**🔸 开发环境**
```yaml
# 开发时可以暂时不设置（但不推荐）
xxl:
  job:
    accessToken: ""
```

**🔸 生产环境**
```yaml
# 生产环境必须设置强令牌
xxl:
  job:
    accessToken: "Ax8Nv2Ps9Kq7Wm3Rt6Yz1Bc4Df5Gh8Jk"
```

**令牌设计原则**：
- 🔐 **复杂性**：包含大小写字母、数字
- 🔐 **长度**：建议32位以上
- 🔐 **唯一性**：每个环境使用不同令牌
- 🔐 **保密性**：不要把令牌写在代码里，用配置文件

> ⚠️ **安全提醒**：令牌就像密码，不要随便告诉别人，定期更换。

---

## 5. 📝 日志管理配置


### 5.1 日志保留天数设置


**问题场景**：任务运行久了，日志文件越来越大，占用磁盘空间。

```yaml
xxl:
  job:
    executor:
      logretentiondays: 30
```

**保留天数选择建议**：

| 环境类型 | 建议天数 | 理由 |
|---------|---------|------|
| **开发环境** | 3-7天 | 开发调试用，不需要长期保存 |
| **测试环境** | 15-30天 | 测试周期相对较长 |
| **生产环境** | 30-90天 | 需要历史问题排查 |
| **监管行业** | 365天+ | 法规要求长期保存 |

### 5.2 日志存储路径


**默认路径理解**：
```
日志存储位置：
/data/applogs/xxl-job/jobhandler/
│    │       │       │
│    │       │       └── 任务处理器目录
│    │       └── XXL-JOB专用目录  
│    └── 应用日志根目录
└── 数据存储根目录
```

**自定义路径配置**：
```yaml
xxl:
  job:
    executor:
      logpath: "/app/logs/xxl-job/"  # 自定义日志路径
```

### 5.3 日志文件清理机制


**自动清理原理**：
```
清理时机：每天凌晨自动执行
清理逻辑：删除超过保留天数的日志文件
清理范围：只清理XXL-JOB相关日志

清理流程：
检查日志文件 → 计算文件年龄 → 超期删除 → 保留最新文件
```

---

## 6. 🌐 网络配置优化


### 6.1 IP地址获取策略


**🔸 自动获取IP（推荐新手）**
```yaml
xxl:
  job:
    executor:
      ip: ""  # 留空，系统自动获取
```

**自动获取的优缺点**：
- ✅ **优点**：简单方便，适合简单网络环境
- ❌ **缺点**：复杂网络可能获取错误IP

**🔸 手动指定IP**
```yaml
xxl:
  job:
    executor:
      ip: "192.168.1.100"  # 手动指定具体IP
```

**手动指定的应用场景**：
- 🖥️ **多网卡服务器**：有多个网卡，需要指定使用哪个
- 🐳 **容器部署**：容器内IP和宿主机IP不同
- 🌐 **复杂网络**：有VPN、代理等复杂网络环境

### 6.2 网络连通性检查


**连通性测试命令**：
```bash
# 检查执行器端口是否开放
telnet 执行器IP 执行器端口

# 检查调度中心是否可达  
curl http://调度中心地址/health
```

**网络问题排查步骤**：
```
问题：执行器注册不上调度中心

排查步骤：
1️⃣ 检查配置文件中的地址是否正确
2️⃣ 检查网络连通性（ping、telnet）
3️⃣ 检查防火墙是否阻拦端口
4️⃣ 检查令牌是否匹配
5️⃣ 查看双方的日志文件
```

---

## 7. ⚖️ 配置优先级与覆盖规则


### 7.1 配置文件优先级


**配置加载顺序**（优先级从高到低）：
```
1. 命令行参数          (最高优先级)
   ↓
2. application.yml     (项目配置文件) 
   ↓
3. application.properties
   ↓
4. 默认配置            (最低优先级)
```

**实际应用示例**：
```yaml
# application.yml 中配置
xxl:
  job:
    executor:
      port: 9999

# 启动命令行覆盖
java -jar app.jar --xxl.job.executor.port=8888
# 最终使用端口：8888（命令行优先级更高）
```

### 7.2 环境配置分离


**多环境配置策略**：
```
项目结构：
├── application.yml              (公共配置)
├── application-dev.yml          (开发环境)  
├── application-test.yml         (测试环境)
└── application-prod.yml         (生产环境)
```

**环境切换示例**：
```yaml
# application.yml (公共配置)
xxl:
  job:
    executor:
      logretentiondays: 30

# application-prod.yml (生产环境特定)
xxl:
  job:
    admin:
      addresses: http://prod-job.company.com:8080/xxl-job-admin
    accessToken: "prod-secret-token-123"
    
# application-dev.yml (开发环境特定)  
xxl:
  job:
    admin:
      addresses: http://localhost:8080/xxl-job-admin
    accessToken: ""
```

---

## 8. 💻 实际部署配置示例


### 8.1 单机开发环境配置


```yaml
# 开发环境完整配置
server:
  port: 8081

xxl:
  job:
    admin:
      addresses: http://localhost:8080/xxl-job-admin
    accessToken: ""  # 开发环境可以不设置
    executor:
      appname: my-app-executor
      address: ""      # 自动获取
      ip: ""           # 自动获取  
      port: 9999
      logpath: /data/applogs/xxl-job/jobhandler
      logretentiondays: 7
```

> 💡 **开发小贴士**：开发环境追求简单快捷，安全性要求不高，配置尽量简化。

### 8.2 生产环境配置


```yaml
# 生产环境完整配置
server:
  port: 8080

xxl:
  job:
    admin:
      addresses: http://job1.company.com:8080/xxl-job-admin,http://job2.company.com:8080/xxl-job-admin
    accessToken: "Ax8Nv2Ps9Kq7Wm3Rt6Yz1Bc4Df5Gh8Jk"
    executor:
      appname: user-service-executor-prod
      address: "192.168.100.50:9999"  # 手动指定，确保准确
      ip: "192.168.100.50"
      port: 9999
      logpath: /app/logs/xxl-job/
      logretentiondays: 90
```

> 🔒 **生产重点**：生产环境要求高可用、高安全，配置要精确可控。

### 8.3 Docker容器配置


```yaml
# Docker环境配置要点
xxl:
  job:
    admin:
      addresses: http://宿主机IP:8080/xxl-job-admin  # 注意不是容器内IP
    executor:
      address: "宿主机IP:9999"    # 必须是宿主机IP
      ip: "宿主机IP"             # 必须是宿主机IP
      port: 9999                # 容器内端口
```

**Docker部署注意事项**：
- 🐳 **网络模式**：使用host模式最简单
- 🐳 **端口映射**：容器端口要映射到宿主机
- 🐳 **IP地址**：调度中心需要能访问到宿主机IP

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的配置要点


```
🔸 调度中心地址：执行器找到"老板"的关键
🔸 执行器端口：调度中心联系执行器的"电话号码"  
🔸 访问令牌：系统安全的"门禁卡"
🔸 应用名称：执行器的"身份证"
🔸 日志配置：任务执行的"记录本"
🔸 IP配置：网络通信的"家庭住址"
```

### 9.2 新手常见配置错误


| 错误类型 | 常见问题 | 正确做法 |
|---------|---------|----------|
| **地址配置** | 调度中心地址写错 | 仔细检查IP、端口、路径 |
| **端口冲突** | 多个应用用同一端口 | 为每个应用分配不同端口 |
| **令牌不匹配** | 调度中心和执行器令牌不一致 | 确保令牌完全相同 |
| **网络不通** | 防火墙阻挡或IP错误 | 测试网络连通性 |
| **命名冲突** | 多个执行器使用相同appname | 每个执行器使用唯一名称 |

### 9.3 配置最佳实践


**🏆 配置检查清单**：
- ✅ 调度中心地址能否正常访问？
- ✅ 执行器端口是否已开放？
- ✅ 访问令牌在两边是否一致？
- ✅ 执行器名称是否唯一且有意义？
- ✅ 日志路径是否有写入权限？
- ✅ IP地址配置是否适合当前网络环境？

**🎯 环境配置建议**：
- 📝 **开发环境**：配置简单，快速启动为主
- 📝 **测试环境**：接近生产，便于测试为主  
- 📝 **生产环境**：高可用、高安全、稳定为主

**💡 核心记忆要点**：
- XXL-JOB配置就像设置"通讯录"，让调度中心和执行器能互相找到
- 配置文件有优先级，命令行 > 配置文件 > 默认值
- 生产环境必须设置访问令牌，就像给系统上锁
- 网络配置是关键，IP和端口配置错误是最常见问题
- 不同环境用不同配置，开发求简单，生产求稳定

**🚀 下一步学习**：
掌握了基础配置后，接下来可以学习：
- 任务创建与管理
- 任务执行器编写  
- 任务监控与日志查看
- 高级特性使用