---
title: 3ã€ç”µå•†ä¸šåŠ¡ä»»åŠ¡å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [ç”µå•†å®šæ—¶ä»»åŠ¡åœºæ™¯æ¦‚è¿°](#1-ç”µå•†å®šæ—¶ä»»åŠ¡åœºæ™¯æ¦‚è¿°)
2. [è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡](#2-è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡)
3. [åº“å­˜åŒæ­¥ä»»åŠ¡](#3-åº“å­˜åŒæ­¥ä»»åŠ¡)
4. [æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡](#4-æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡)
5. [è¥é”€æ´»åŠ¨ä»»åŠ¡](#5-è¥é”€æ´»åŠ¨ä»»åŠ¡)
6. [ä¼˜æƒ åˆ¸è¿‡æœŸå¤„ç†](#6-ä¼˜æƒ åˆ¸è¿‡æœŸå¤„ç†)
7. [ç§¯åˆ†æ¸…ç®—ä»»åŠ¡](#7-ç§¯åˆ†æ¸…ç®—ä»»åŠ¡)
8. [æ¶ˆæ¯æ¨é€ä»»åŠ¡](#8-æ¶ˆæ¯æ¨é€ä»»åŠ¡)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›’ ç”µå•†å®šæ—¶ä»»åŠ¡åœºæ™¯æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆç”µå•†éœ€è¦å®šæ—¶ä»»åŠ¡


**é€šä¿—ç†è§£ï¼š**
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶ç½‘åº—ï¼Œæœ‰å¾ˆå¤šäº‹æƒ…éœ€è¦å®šæ—¶å»åšï¼š
- æ¯å¤©å‡Œæ™¨è¦ç»Ÿè®¡æ˜¨å¤©çš„é”€å”®é¢ï¼ˆæŠ¥è¡¨ï¼‰
- è¶…è¿‡30åˆ†é’Ÿæ²¡ä»˜æ¬¾çš„è®¢å•è¦è‡ªåŠ¨å…³é—­ï¼ˆè®¢å•ç®¡ç†ï¼‰
- æ¯å°æ—¶åŒæ­¥ä¸€æ¬¡åº“å­˜æ•°æ®ï¼ˆåº“å­˜ç®¡ç†ï¼‰
- ä¼˜æƒ åˆ¸åˆ°æœŸäº†è¦è‡ªåŠ¨å¤±æ•ˆï¼ˆè¥é”€ç®¡ç†ï¼‰

è¿™äº›äº‹æƒ…å¦‚æœé äººå·¥å»åšï¼Œæ—¢è´¹æ—¶åˆå®¹æ˜“å‡ºé”™ã€‚å®šæ—¶ä»»åŠ¡å°±åƒä½ é›‡äº†ä¸€ä¸ªæ°¸ä¸ç–²å€¦çš„å‘˜å·¥ï¼Œåˆ°ç‚¹å°±è‡ªåŠ¨å¹²æ´»ã€‚

```
ç”µå•†ä¸šåŠ¡æµç¨‹ä¸­çš„å®šæ—¶ä»»åŠ¡èŠ‚ç‚¹ï¼š

ç”¨æˆ·ä¸‹å• â†’ ç­‰å¾…æ”¯ä»˜ â†’ [30åˆ†é’Ÿå€’è®¡æ—¶] â†’ æœªæ”¯ä»˜è‡ªåŠ¨å…³é—­ â† å®šæ—¶ä»»åŠ¡
         â†“
       å·²æ”¯ä»˜ â†’ åº“å­˜æ‰£å‡ â†’ [æ¯å°æ—¶åŒæ­¥] â†’ æ›´æ–°åº“å­˜æ•°æ® â† å®šæ—¶ä»»åŠ¡
         â†“
       å‘è´§ â†’ ç”¨æˆ·ç¡®è®¤æ”¶è´§ â†’ [7å¤©å] â†’ è‡ªåŠ¨å¥½è¯„ â† å®šæ—¶ä»»åŠ¡
         â†“
    è®¢å•å®Œæˆ â†’ [æ¯æ—¥å‡Œæ™¨] â†’ ç”Ÿæˆé”€å”®æŠ¥è¡¨ â† å®šæ—¶ä»»åŠ¡
```

### 1.2 XXL-JOBåœ¨ç”µå•†ä¸­çš„ä¼˜åŠ¿


**æ ¸å¿ƒä»·å€¼ï¼š**
- **å¯é æ€§é«˜** - ä»»åŠ¡ä¸ä¼šå› ä¸ºæœåŠ¡å™¨é‡å¯è€Œä¸¢å¤±
- **å¯è§†åŒ–ç®¡ç†** - åœ¨ç®¡ç†åå°å°±èƒ½çœ‹åˆ°æ‰€æœ‰å®šæ—¶ä»»åŠ¡
- **çµæ´»è°ƒåº¦** - å¯ä»¥éšæ—¶è°ƒæ•´ä»»åŠ¡æ‰§è¡Œæ—¶é—´
- **æ•…éšœè½¬ç§»** - æŸå°æœåŠ¡å™¨æŒ‚äº†ï¼Œä»»åŠ¡ä¼šè‡ªåŠ¨è½¬åˆ°å…¶ä»–æœåŠ¡å™¨

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šXXL-JOBå°±åƒä¸€ä¸ªæ™ºèƒ½ç®¡å®¶ï¼Œå¸®ä½ ç®¡ç†æ‰€æœ‰éœ€è¦å®šæ—¶æ‰§è¡Œçš„å·¥ä½œï¼Œè€Œä¸”è¿˜èƒ½è‡ªåŠ¨å¤‡ä»½ï¼Œé˜²æ­¢ä»»åŠ¡é—æ¼ã€‚

---

## 2. â° è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡


### 2.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**ä»€ä¹ˆæ˜¯è®¢å•è¶…æ—¶å…³é—­ï¼Ÿ**
ç”¨æˆ·ä¸‹å•åï¼Œå¦‚æœ30åˆ†é’Ÿå†…ä¸ä»˜æ¬¾ï¼Œè®¢å•å°±è‡ªåŠ¨å–æ¶ˆï¼Œé‡Šæ”¾å ç”¨çš„åº“å­˜ã€‚è¿™å°±åƒä½ åœ¨é¤å…é¢„å®šäº†åº§ä½ï¼Œå¦‚æœ15åˆ†é’Ÿä¸åˆ°å°±ä¼šè¢«å–æ¶ˆé¢„å®šã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Ÿ**
- **é‡Šæ”¾åº“å­˜** - è®©å…¶ä»–æƒ³ä¹°çš„äººèƒ½å¤Ÿä¸‹å•
- **é˜²æ­¢æ¶æ„å å•** - æœ‰äº›äººä¸‹å•ä¸ä»˜æ¬¾å ç€åº“å­˜
- **æå‡è½¬åŒ–ç‡** - å‚¬ä¿ƒçŠ¹è±«çš„ç”¨æˆ·å°½å¿«ä»˜æ¬¾

### 2.2 ä»»åŠ¡è®¾è®¡æ€è·¯


**æ–¹æ¡ˆå¯¹æ¯”ï¼š**

| æ–¹æ¡ˆ | **è¯´æ˜** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|---------|-------------|
| å®šæ—¶æ‰«æ | æ¯éš”ä¸€æ®µæ—¶é—´æ‰«ææ‰€æœ‰å¾…ä»˜æ¬¾è®¢å• | å®ç°ç®€å• | å®æ—¶æ€§å·®ï¼Œæ•°æ®åº“å‹åŠ›å¤§ | è®¢å•é‡å°çš„åœºæ™¯ |
| å»¶è¿Ÿæ¶ˆæ¯ | ä¸‹å•æ—¶å‘é€å»¶è¿Ÿ30åˆ†é’Ÿçš„æ¶ˆæ¯ | å®æ—¶æ€§å¥½ | éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒ | è®¢å•é‡å¤§çš„åœºæ™¯ |
| Redisè¿‡æœŸ | åˆ©ç”¨Redisçš„keyè¿‡æœŸæœºåˆ¶ | æ€§èƒ½é«˜ | å¯èƒ½ä¸¢å¤±ä»»åŠ¡ | å¯¹å‡†ç¡®æ€§è¦æ±‚ä¸é«˜ |

> âš ï¸ **æ³¨æ„**ï¼šå®é™…é¡¹ç›®ä¸­é€šå¸¸é‡‡ç”¨ **å®šæ—¶æ‰«æ + å»¶è¿Ÿæ¶ˆæ¯** ç»“åˆçš„æ–¹å¼ï¼Œæ—¢ä¿è¯å¯é æ€§åˆå…¼é¡¾æ€§èƒ½ã€‚

### 2.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**ä»»åŠ¡é…ç½®ä¿¡æ¯ï¼š**
```
ä»»åŠ¡åç§°ï¼šè®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡
è°ƒåº¦ç±»å‹ï¼šCRON
Cronè¡¨è¾¾å¼ï¼š0 */5 * * * ?  (æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡)
è¿è¡Œæ¨¡å¼ï¼šBEANæ¨¡å¼
æ‰§è¡Œå™¨ï¼šorder-executor
```

**æ ¸å¿ƒå®ç°é€»è¾‘ï¼š**

```java
@XxlJob("orderTimeoutHandler")
public void handleTimeoutOrders() {
    // 1. æŸ¥è¯¢è¶…æ—¶æœªæ”¯ä»˜çš„è®¢å•ï¼ˆåˆ›å»ºæ—¶é—´ < å½“å‰æ—¶é—´-30åˆ†é’Ÿï¼‰
    LocalDateTime timeoutThreshold = LocalDateTime.now().minusMinutes(30);
    List<Order> timeoutOrders = orderMapper.findUnpaidOrders(timeoutThreshold);
    
    // 2. æ‰¹é‡å¤„ç†è¶…æ—¶è®¢å•
    for (Order order : timeoutOrders) {
        // å…³é—­è®¢å•
        order.setStatus(OrderStatus.CLOSED);
        order.setCloseReason("æ”¯ä»˜è¶…æ—¶è‡ªåŠ¨å…³é—­");
        orderMapper.updateOrder(order);
        
        // é‡Šæ”¾åº“å­˜
        inventoryService.releaseStock(order.getProductId(), order.getQuantity());
        
        // å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
        notifyService.sendOrderClosedNotice(order.getUserId());
    }
    
    XxlJobLogger.log("å¤„ç†è¶…æ—¶è®¢å•æ•°é‡ï¼š{}", timeoutOrders.size());
}
```

**æµç¨‹å›¾ç¤ºï¼š**
```
å®šæ—¶ä»»åŠ¡è§¦å‘ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        â†“
æŸ¥è¯¢30åˆ†é’Ÿå‰çš„å¾…ä»˜æ¬¾è®¢å•
        â†“
    è®¢å•åˆ—è¡¨ â†’ éå†å¤„ç†
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â†“         â†“
å…³é—­è®¢å•   é‡Šæ”¾åº“å­˜
   â†“         â†“
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â†“
   å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
        â†“
   è®°å½•æ—¥å¿—å®Œæˆ
```

> ğŸ”§ **å®è·µå»ºè®®**ï¼š
> - æ¯æ¬¡å¤„ç†è®¢å•æ•°é‡ä¸è¦å¤ªå¤šï¼Œå»ºè®®500-1000æ¡ï¼Œé¿å…å•æ¬¡æ‰§è¡Œæ—¶é—´è¿‡é•¿
> - ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®
> - å¢åŠ å¹‚ç­‰æ€§æ ¡éªŒï¼Œé˜²æ­¢è®¢å•è¢«é‡å¤å…³é—­

---

## 3. ğŸ“¦ åº“å­˜åŒæ­¥ä»»åŠ¡


### 3.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**ä»€ä¹ˆæ˜¯åº“å­˜åŒæ­¥ï¼Ÿ**
ç”µå•†ç³»ç»Ÿé€šå¸¸æœ‰å¤šä¸ªé”€å”®æ¸ é“ï¼ˆç½‘ç«™ã€APPã€å°ç¨‹åºï¼‰ï¼Œéœ€è¦å®šæœŸæŠŠå„ä¸ªæ¸ é“çš„åº“å­˜æ•°æ®åŒæ­¥åˆ°æ€»åº“å­˜ç³»ç»Ÿï¼Œç¡®ä¿æ•°æ®ä¸€è‡´ã€‚

**ç”Ÿæ´»åŒ–ç†è§£ï¼š**
å°±åƒè¿é”è¶…å¸‚ï¼Œæ¯ä¸ªåˆ†åº—çš„åº“å­˜å˜åŒ–è¦å®šæ—¶æ±‡æ€»åˆ°æ€»éƒ¨ç³»ç»Ÿï¼Œè¿™æ ·æ€»éƒ¨æ‰çŸ¥é“å“ªäº›å•†å“éœ€è¦è¡¥è´§ã€‚

```
åº“å­˜æ•°æ®æµè½¬ï¼š

å„æ¸ é“é”€å”®
 â†“  â†“  â†“
ç½‘ç«™ APP å°ç¨‹åº
 â†“  â†“  â†“
[æ¯å°æ—¶åŒæ­¥] â† XXL-JOBå®šæ—¶ä»»åŠ¡
      â†“
   æ€»åº“å­˜ç³»ç»Ÿ
      â†“
  ERPä»“å‚¨ç³»ç»Ÿ
```

### 3.2 åŒæ­¥ç­–ç•¥è®¾è®¡


**åŒæ­¥é¢‘ç‡é€‰æ‹©ï¼š**

```
å®æ—¶åŒæ­¥ï¼šæ¯æ¬¡é”€å”®ç«‹å³åŒæ­¥
ä¼˜ç‚¹ï¼šâœ… æ•°æ®æœ€å‡†ç¡®
ç¼ºç‚¹ï¼šâŒ ç³»ç»Ÿå‹åŠ›å¤§ï¼Œæˆæœ¬é«˜
é€‚ç”¨ï¼šé«˜ä»·å€¼å•†å“ï¼ˆç å®ã€3Cï¼‰

å‡†å®æ—¶åŒæ­¥ï¼šæ¯5-10åˆ†é’Ÿä¸€æ¬¡
ä¼˜ç‚¹ï¼šâœ… å¹³è¡¡å‡†ç¡®æ€§å’Œæ€§èƒ½
ç¼ºç‚¹ï¼šâŒ æœ‰å°å»¶è¿Ÿ
é€‚ç”¨ï¼šæ™®é€šå•†å“ï¼ˆæœè£…ã€æ—¥ç”¨å“ï¼‰

å®šæ—¶æ‰¹é‡åŒæ­¥ï¼šæ¯å°æ—¶ä¸€æ¬¡
ä¼˜ç‚¹ï¼šâœ… ç³»ç»Ÿå‹åŠ›å°
ç¼ºç‚¹ï¼šâŒ æ•°æ®æœ‰å»¶è¿Ÿ
é€‚ç”¨ï¼šæ…¢é€Ÿæµè½¬å•†å“ï¼ˆå®¶å…·ã€å¤§å®¶ç”µï¼‰
```

> ğŸ’¡ **é€‰æ‹©å»ºè®®**ï¼šæ ¹æ®å•†å“ç‰¹æ€§é€‰æ‹©åˆé€‚çš„åŒæ­¥é¢‘ç‡ï¼Œä¸æ˜¯è¶Šå¿«è¶Šå¥½ã€‚

### 3.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**ä»»åŠ¡é…ç½®ï¼š**
```
ä»»åŠ¡åç§°ï¼šåº“å­˜æ•°æ®åŒæ­¥ä»»åŠ¡
Cronè¡¨è¾¾å¼ï¼š0 0 * * * ?  (æ¯å°æ—¶æ•´ç‚¹æ‰§è¡Œ)
åˆ†ç‰‡å¹¿æ’­ï¼šå¼€å¯ï¼ˆæ”¯æŒå¤šæ¸ é“å¹¶è¡ŒåŒæ­¥ï¼‰
é˜»å¡ç­–ç•¥ï¼šå•æœºä¸²è¡Œï¼ˆé¿å…æ•°æ®å†²çªï¼‰
```

**å®ç°ä»£ç ï¼š**

```java
@XxlJob("inventorySyncHandler")
public void syncInventory() {
    // è·å–åˆ†ç‰‡å‚æ•°ï¼ˆæ”¯æŒæŒ‰æ¸ é“åˆ†ç‰‡ï¼‰
    int shardIndex = XxlJobHelper.getShardIndex();
    int shardTotal = XxlJobHelper.getShardTotal();
    
    // 1. æŸ¥è¯¢éœ€è¦åŒæ­¥çš„å•†å“ï¼ˆåˆ†ç‰‡æŸ¥è¯¢ï¼‰
    List<Product> products = productMapper.findByShardIndex(shardIndex, shardTotal);
    
    // 2. æ‰¹é‡åŒæ­¥åº“å­˜æ•°æ®
    for (Product product : products) {
        // è·å–å„æ¸ é“åº“å­˜
        int webStock = channelStockService.getWebStock(product.getId());
        int appStock = channelStockService.getAppStock(product.getId());
        int miniStock = channelStockService.getMiniStock(product.getId());
        
        // è®¡ç®—æ€»åº“å­˜
        int totalStock = webStock + appStock + miniStock;
        
        // æ›´æ–°æ€»åº“å­˜ç³»ç»Ÿ
        inventoryService.updateTotalStock(product.getId(), totalStock);
        
        // åŒæ­¥åˆ°ERPç³»ç»Ÿ
        erpService.syncStock(product.getId(), totalStock);
    }
    
    XxlJobLogger.log("åˆ†ç‰‡[{}/{}]åŒæ­¥å•†å“æ•°é‡ï¼š{}", 
        shardIndex, shardTotal, products.size());
}
```

**æ•°æ®ä¸€è‡´æ€§ä¿éšœï¼š**

â”Œâ”€ åº“å­˜åŒæ­¥ä¿éšœæœºåˆ¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚  1ï¸âƒ£ ä¹è§‚é”æœºåˆ¶ï¼šversionå­—æ®µæ§åˆ¶     â”‚
â”‚  2ï¸âƒ£ è¡¥å¿æœºåˆ¶ï¼šåŒæ­¥å¤±è´¥é‡è¯•3æ¬¡       â”‚
â”‚  3ï¸âƒ£ å¯¹è´¦æœºåˆ¶ï¼šæ¯æ—¥å…¨é‡å¯¹è´¦ä¸€æ¬¡       â”‚
â”‚  4ï¸âƒ£ é¢„è­¦æœºåˆ¶ï¼šåº“å­˜å·®å¼‚è¶…5%å‘Šè­¦      â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

> âš ï¸ **å…³é”®ç‚¹**ï¼šåº“å­˜åŒæ­¥è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œä½¿ç”¨æ•°æ®åº“è¡Œé”æˆ–Redisåˆ†å¸ƒå¼é”é¿å…æ•°æ®é”™ä¹±ã€‚

---

## 4. ğŸ“Š æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡


### 4.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**ç”µå•†å¸¸è§æŠ¥è¡¨ç±»å‹ï¼š**
- **é”€å”®æŠ¥è¡¨** - æ¯æ—¥/æ¯å‘¨/æ¯æœˆé”€å”®é¢ç»Ÿè®¡
- **å•†å“æŠ¥è¡¨** - çƒ­é”€å•†å“ã€æ»é”€å•†å“åˆ†æ
- **ç”¨æˆ·æŠ¥è¡¨** - æ–°å¢ç”¨æˆ·ã€æ´»è·ƒç”¨æˆ·ç»Ÿè®¡
- **è´¢åŠ¡æŠ¥è¡¨** - æ”¶å…¥ã€æ”¯å‡ºã€åˆ©æ¶¦æ±‡æ€»

**ä¸ºä»€ä¹ˆè¦å®šæ—¶ç”Ÿæˆï¼Ÿ**
æŠ¥è¡¨æ•°æ®é‡å¤§ï¼Œå®æ—¶è®¡ç®—ä¼šå¾ˆæ…¢ã€‚æå‰ç”Ÿæˆå¥½ï¼Œç”¨æˆ·æŸ¥çœ‹æ—¶ç›´æ¥å±•ç¤ºï¼Œä½“éªŒå¥½ã€é€Ÿåº¦å¿«ã€‚

```
æŠ¥è¡¨ç”Ÿæˆæ—¶æœºé€‰æ‹©ï¼š

å‡Œæ™¨3ç‚¹ - ç³»ç»Ÿè®¿é—®é‡æœ€å°ï¼Œä¸å½±å“ç”¨æˆ·
  â†“
æ•°æ®åº“è´Ÿè½½ä½ - é€‚åˆæ‰§è¡Œå¤æ‚æŸ¥è¯¢ç»Ÿè®¡
  â†“
æå‰å‡†å¤‡å¥½ - æ—©ä¸Šä¸Šç­æ—¶ç›´æ¥æŸ¥çœ‹
```

### 4.2 æŠ¥è¡¨ä»»åŠ¡è®¾è®¡


**åˆ†å±‚è®¾è®¡æ€è·¯ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æŠ¥è¡¨ä»»åŠ¡åˆ†å±‚æ¶æ„              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  Layer 1: åŸºç¡€æ•°æ®å±‚                â”‚
â”‚  â””â”€ è®¢å•è¡¨ã€å•†å“è¡¨ã€ç”¨æˆ·è¡¨...       â”‚
â”‚           â†“                         â”‚
â”‚  Layer 2: æ±‡æ€»æ•°æ®å±‚                â”‚
â”‚  â””â”€ æ¯å°æ—¶æ±‡æ€»åˆ°ä¸´æ—¶è¡¨              â”‚
â”‚           â†“                         â”‚
â”‚  Layer 3: æŠ¥è¡¨æ•°æ®å±‚                â”‚
â”‚  â””â”€ æ¯æ—¥ç”Ÿæˆæœ€ç»ˆæŠ¥è¡¨                â”‚
â”‚           â†“                         â”‚
â”‚  Layer 4: ç¼“å­˜å±‚                    â”‚
â”‚  â””â”€ æŠ¥è¡¨ç»“æœå­˜å…¥Redis               â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **è®¾è®¡ç†å¿µ**ï¼šé‡‡ç”¨åˆ†å±‚æ±‡æ€»ï¼Œé¿å…å•æ¬¡è®¡ç®—å‹åŠ›è¿‡å¤§ï¼Œä¹Ÿæ–¹ä¾¿é—®é¢˜æ’æŸ¥ã€‚

### 4.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**ä»»åŠ¡é…ç½®ï¼š**
```
ä»»åŠ¡åç§°ï¼šæ¯æ—¥é”€å”®æŠ¥è¡¨ç”Ÿæˆ
Cronè¡¨è¾¾å¼ï¼š0 0 3 * * ?  (æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œ)
ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼š1800ç§’ï¼ˆ30åˆ†é’Ÿï¼‰
å¤±è´¥é‡è¯•æ¬¡æ•°ï¼š3æ¬¡
```

**æ ¸å¿ƒä»£ç ï¼š**

```java
@XxlJob("dailySalesReportHandler")
public void generateDailySalesReport() {
    LocalDate yesterday = LocalDate.now().minusDays(1);
    
    // 1. ç»Ÿè®¡æ˜¨æ—¥é”€å”®æ€»é¢
    BigDecimal totalSales = orderMapper.calculateDailySales(yesterday);
    
    // 2. ç»Ÿè®¡è®¢å•é‡
    Long orderCount = orderMapper.countDailyOrders(yesterday);
    
    // 3. ç»Ÿè®¡çƒ­é”€å•†å“TOP10
    List<ProductSales> topProducts = orderMapper.findTopProducts(yesterday, 10);
    
    // 4. ä¿å­˜æŠ¥è¡¨æ•°æ®
    DailySalesReport report = new DailySalesReport();
    report.setReportDate(yesterday);
    report.setTotalSales(totalSales);
    report.setOrderCount(orderCount);
    report.setTopProducts(JSON.toJSONString(topProducts));
    reportMapper.insert(report);
    
    // 5. ç¼“å­˜åˆ°Redisï¼ˆåŠ é€ŸæŸ¥è¯¢ï¼‰
    redisTemplate.opsForValue().set(
        "report:daily:" + yesterday, 
        report, 
        7, 
        TimeUnit.DAYS
    );
    
    XxlJobLogger.log("ç”ŸæˆæŠ¥è¡¨æˆåŠŸï¼Œæ—¥æœŸï¼š{}ï¼Œé”€å”®é¢ï¼š{}", yesterday, totalSales);
}
```

**æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼š**

éš¾åº¦ç­‰çº§: â­â­â­â˜†â˜†

- âœ… **åˆ†è¡¨æŸ¥è¯¢** - æŒ‰æ—¥æœŸåˆ†è¡¨ï¼ŒåªæŸ¥è¯¢ç›¸å…³åˆ†åŒº
- âœ… **ç´¢å¼•ä¼˜åŒ–** - åœ¨ç»Ÿè®¡å­—æ®µä¸Šå»ºç«‹ç´¢å¼•
- âœ… **å¼‚æ­¥ç”Ÿæˆ** - å¤æ‚æŠ¥è¡¨ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡
- âœ… **å¢é‡è®¡ç®—** - åªè®¡ç®—å˜åŒ–çš„æ•°æ®ï¼Œä¸å…¨é‡é‡ç®—

> ğŸš€ **è¿›é˜¶æŠ€å·§**ï¼šå¤§æ•°æ®é‡æŠ¥è¡¨å¯ä»¥è€ƒè™‘ä½¿ç”¨Flinkã€Sparkç­‰æµå¼è®¡ç®—æ¡†æ¶ï¼Œå®æ—¶æ±‡æ€»æ•°æ®ã€‚

---

## 5. ğŸ¯ è¥é”€æ´»åŠ¨ä»»åŠ¡


### 5.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**å¸¸è§è¥é”€æ´»åŠ¨ï¼š**
- **é™æ—¶ç§’æ€** - æ¯å¤©10ç‚¹å¼€å§‹ï¼Œ11ç‚¹ç»“æŸ
- **æ»¡å‡æ´»åŠ¨** - æ»¡100å‡20ï¼Œæ´»åŠ¨æœŸ3å¤©
- **æ–°äººä¸“äº«** - æ³¨å†Œå24å°æ—¶å†…æœ‰æ•ˆ
- **ä¼šå‘˜æ—¥** - æ¯æœˆ28å·ä¼šå‘˜ä¸“å±ä¼˜æƒ 

**ç”Ÿæ´»åŒ–ä¾‹å­ï¼š**
å°±åƒè¶…å¸‚çš„ä¿ƒé”€æ´»åŠ¨ï¼Œ"æ˜å¤©ä¸Šåˆ10ç‚¹å¼€å§‹æ‰“æŠ˜ï¼Œæ™šä¸Š8ç‚¹ç»“æŸ"ï¼Œéœ€è¦æœ‰äººåˆ°ç‚¹å¼€å¯å’Œå…³é—­æ´»åŠ¨ã€‚

```
è¥é”€æ´»åŠ¨ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»ºæ´»åŠ¨ â†’ é¢„çƒ­æœŸ â†’ [å®šæ—¶å¼€å¯] â†’ è¿›è¡Œä¸­ â†’ [å®šæ—¶ç»“æŸ] â†’ æ•°æ®ç»Ÿè®¡
            â†“          â†“           â†“          â†“         â†“
         é¢„çƒ­æ¨é€   å¼€å¯æŠ¢è´­    åº“å­˜æ‰£å‡   å…³é—­å…¥å£   ç”ŸæˆæŠ¥å‘Š
           â†‘          â†‘           â†‘          â†‘         â†‘
       XXL-JOB    XXL-JOB      å®æ—¶      XXL-JOB   XXL-JOB
```

### 5.2 æ´»åŠ¨ç®¡ç†ä»»åŠ¡è®¾è®¡


**æ´»åŠ¨çŠ¶æ€ç®¡ç†ï¼š**

```
æ´»åŠ¨çŠ¶æ€æµè½¬å›¾ï¼š

  æœªå¼€å§‹ â†’ [å®šæ—¶ä»»åŠ¡] â†’ è¿›è¡Œä¸­ â†’ [å®šæ—¶ä»»åŠ¡] â†’ å·²ç»“æŸ
    â†“                     â†“                     â†“
 é¢„çƒ­æ¨é€              æ­£å¸¸å”®å–              æ•°æ®æ±‡æ€»
 å€’è®¡æ—¶æé†’            åº“å­˜ç›‘æ§              ç»“ç®—è¿”åˆ©
```

**ä»»åŠ¡ç±»å‹åˆ’åˆ†ï¼š**

| ä»»åŠ¡ç±»å‹ | **æ‰§è¡Œæ—¶æœº** | **ä»»åŠ¡å†…å®¹** |
|---------|------------|-------------|
| ğŸ”” æ´»åŠ¨é¢„çƒ­ | å¼€å§‹å‰1å°æ—¶ | æ¨é€æé†’æ¶ˆæ¯ã€å‰ç«¯å€’è®¡æ—¶ |
| ğŸš€ æ´»åŠ¨å¼€å¯ | æ´»åŠ¨å¼€å§‹æ—¶é—´ | æ›´æ–°æ´»åŠ¨çŠ¶æ€ã€å¼€æ”¾å•†å“è´­ä¹° |
| ğŸ“Š æ´»åŠ¨ç›‘æ§ | æ´»åŠ¨æœŸé—´æ¯åˆ†é’Ÿ | ç›‘æ§åº“å­˜ã€ç»Ÿè®¡é”€é‡ |
| ğŸ›‘ æ´»åŠ¨ç»“æŸ | æ´»åŠ¨ç»“æŸæ—¶é—´ | å…³é—­å…¥å£ã€ç»“ç®—æ•°æ® |
| ğŸ“ˆ æ•°æ®ç»Ÿè®¡ | ç»“æŸå1å°æ—¶ | ç”Ÿæˆæ´»åŠ¨æŠ¥è¡¨ã€è®¡ç®—ROI |

### 5.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**ç§’æ€æ´»åŠ¨å¼€å¯ä»»åŠ¡ï¼š**

```java
@XxlJob("seckillStartHandler")
public void startSeckillActivity() {
    // 1. æŸ¥è¯¢å³å°†å¼€å§‹çš„ç§’æ€æ´»åŠ¨ï¼ˆå¼€å§‹æ—¶é—´ = å½“å‰æ—¶é—´ï¼‰
    List<SeckillActivity> activities = activityMapper.findStartingActivities();
    
    for (SeckillActivity activity : activities) {
        try {
            // 2. æ›´æ–°æ´»åŠ¨çŠ¶æ€
            activity.setStatus(ActivityStatus.RUNNING);
            activityMapper.updateActivity(activity);
            
            // 3. é¢„åŠ è½½å•†å“åº“å­˜åˆ°Redisï¼ˆæå‡æ€§èƒ½ï¼‰
            redisTemplate.opsForValue().set(
                "seckill:stock:" + activity.getProductId(),
                activity.getStockQuantity(),
                2, TimeUnit.HOURS
            );
            
            // 4. å‘é€å¼€å§‹é€šçŸ¥
            List<Long> subscribers = activity.getSubscriberIds();
            messageService.batchSend(subscribers, "ç§’æ€å¼€å§‹å•¦ï¼");
            
            XxlJobLogger.log("ç§’æ€æ´»åŠ¨å¼€å¯æˆåŠŸï¼Œæ´»åŠ¨IDï¼š{}", activity.getId());
            
        } catch (Exception e) {
            XxlJobLogger.log("æ´»åŠ¨å¼€å¯å¤±è´¥ï¼ŒIDï¼š{}ï¼ŒåŸå› ï¼š{}", 
                activity.getId(), e.getMessage());
        }
    }
}
```

**æ´»åŠ¨ç»“æŸä»»åŠ¡ï¼š**

```java
@XxlJob("activityEndHandler")
public void endActivity() {
    List<Activity> endingActivities = activityMapper.findEndingActivities();
    
    for (Activity activity : endingActivities) {
        // 1. å…³é—­æ´»åŠ¨å…¥å£
        activity.setStatus(ActivityStatus.ENDED);
        activityMapper.updateActivity(activity);
        
        // 2. æ¸…ç†Redisç¼“å­˜
        redisTemplate.delete("activity:" + activity.getId());
        
        // 3. ç»Ÿè®¡æ´»åŠ¨æ•°æ®
        ActivityReport report = statisticsService.generateReport(activity);
        reportMapper.insert(report);
        
        // 4. å¤„ç†æœªä½¿ç”¨çš„ä¼˜æƒ åˆ¸
        couponService.expireActivityCoupons(activity.getId());
        
        XxlJobLogger.log("æ´»åŠ¨ç»“æŸï¼Œæ€»é”€å”®é¢ï¼š{}ï¼Œå‚ä¸äººæ•°ï¼š{}", 
            report.getTotalSales(), report.getParticipants());
    }
}
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - ç§’æ€æ´»åŠ¨è¦è€ƒè™‘é«˜å¹¶å‘ï¼Œåº“å­˜æ‰£å‡è¦ç”¨Redis + Luaè„šæœ¬ä¿è¯åŸå­æ€§
> - æ´»åŠ¨å¼€å§‹/ç»“æŸæ—¶é—´è¦ç²¾ç¡®åˆ°ç§’ï¼Œé¿å…æå‰æˆ–å»¶è¿Ÿ
> - å¤±è´¥è¦æœ‰è¡¥å¿æœºåˆ¶ï¼Œæ¯”å¦‚æ´»åŠ¨æ²¡å¼€å¯æˆåŠŸè¦å‘Šè­¦

---

## 6. ğŸ« ä¼˜æƒ åˆ¸è¿‡æœŸå¤„ç†


### 6.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**ä¼˜æƒ åˆ¸ç”Ÿå‘½å‘¨æœŸï¼š**
```
å‘æ”¾ â†’ æœªä½¿ç”¨ â†’ [æœ‰æ•ˆæœŸå†…] â†’ å·²ä½¿ç”¨ âœ…
                    â†“
                [è¶…è¿‡æœ‰æ•ˆæœŸ]
                    â†“
                  å·²è¿‡æœŸ âŒ â† XXL-JOBå¤„ç†
```

**ä¸ºä»€ä¹ˆè¦å¤„ç†è¿‡æœŸåˆ¸ï¼Ÿ**
- **æ•°æ®å‡†ç¡®æ€§** - è¿‡æœŸåˆ¸ä¸èƒ½å†ä½¿ç”¨ï¼ŒçŠ¶æ€è¦æ ‡è®°
- **ç»Ÿè®¡åˆ†æ** - çŸ¥é“æœ‰å¤šå°‘åˆ¸è¿‡æœŸäº†ï¼Œä¼˜åŒ–å‘åˆ¸ç­–ç•¥
- **æ¸…ç†æ•°æ®** - è¿‡æœŸåˆ¸å¯ä»¥å½’æ¡£æˆ–åˆ é™¤ï¼Œé‡Šæ”¾æ•°æ®åº“ç©ºé—´

### 6.2 è¿‡æœŸå¤„ç†ç­–ç•¥


**å¤„ç†æ–¹å¼å¯¹æ¯”ï¼š**

```
æ–¹æ¡ˆ1ï¼šå®æ—¶è¿‡æœŸï¼ˆæŸ¥è¯¢æ—¶åˆ¤æ–­ï¼‰
ä¼˜ç‚¹ï¼šâœ… ä¸éœ€è¦å®šæ—¶ä»»åŠ¡ï¼Œé€»è¾‘ç®€å•
ç¼ºç‚¹ï¼šâŒ æ¯æ¬¡æŸ¥è¯¢éƒ½è¦åˆ¤æ–­ï¼Œæ€§èƒ½å·®
åº”ç”¨ï¼šå°è§„æ¨¡ç³»ç»Ÿ

æ–¹æ¡ˆ2ï¼šå®šæ—¶æ‰¹é‡è¿‡æœŸï¼ˆXXL-JOBï¼‰
ä¼˜ç‚¹ï¼šâœ… é›†ä¸­å¤„ç†ï¼Œæ€§èƒ½å¥½
ç¼ºç‚¹ï¼šâŒ æœ‰å»¶è¿Ÿï¼Œæœ€å¤šå»¶è¿Ÿä¸€ä¸ªæ‰§è¡Œå‘¨æœŸ
åº”ç”¨ï¼šä¸­å¤§è§„æ¨¡ç³»ç»Ÿï¼ˆæ¨èï¼‰

æ–¹æ¡ˆ3ï¼šRedisè¿‡æœŸç›‘å¬
ä¼˜ç‚¹ï¼šâœ… å®æ—¶æ€§å¥½
ç¼ºç‚¹ï¼šâŒ å¯èƒ½ä¸¢å¤±è¿‡æœŸäº‹ä»¶
åº”ç”¨ï¼šå¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šä½¿ç”¨æ–¹æ¡ˆ2ï¼ˆå®šæ—¶æ‰¹é‡ï¼‰+ æ–¹æ¡ˆ1ï¼ˆå…œåº•æ ¡éªŒï¼‰çš„ç»„åˆæ–¹å¼ã€‚

### 6.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**ä»»åŠ¡é…ç½®ï¼š**
```
ä»»åŠ¡åç§°ï¼šä¼˜æƒ åˆ¸è¿‡æœŸå¤„ç†
Cronè¡¨è¾¾å¼ï¼š0 0 1 * * ?  (æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ)
è·¯ç”±ç­–ç•¥ï¼šåˆ†ç‰‡å¹¿æ’­ï¼ˆå¹¶è¡Œå¤„ç†ï¼‰
```

**å®ç°ä»£ç ï¼š**

```java
@XxlJob("couponExpireHandler")
public void expireCoupons() {
    // è·å–åˆ†ç‰‡ä¿¡æ¯
    int shardIndex = XxlJobHelper.getShardIndex();
    int shardTotal = XxlJobHelper.getShardTotal();
    
    // 1. åˆ†ç‰‡æŸ¥è¯¢æ˜¨å¤©è¿‡æœŸçš„ä¼˜æƒ åˆ¸
    LocalDateTime yesterday = LocalDate.now().minusDays(1).atStartOfDay();
    List<Coupon> expiredCoupons = couponMapper.findExpiredCoupons(
        yesterday, shardIndex, shardTotal
    );
    
    int successCount = 0;
    int failCount = 0;
    
    // 2. æ‰¹é‡æ›´æ–°çŠ¶æ€
    for (Coupon coupon : expiredCoupons) {
        try {
            // æ›´æ–°ä¸ºè¿‡æœŸçŠ¶æ€
            coupon.setStatus(CouponStatus.EXPIRED);
            coupon.setExpiredTime(LocalDateTime.now());
            couponMapper.updateCoupon(coupon);
            
            // è®°å½•è¿‡æœŸæ—¥å¿—
            CouponLog log = new CouponLog();
            log.setCouponId(coupon.getId());
            log.setAction("EXPIRED");
            logMapper.insert(log);
            
            successCount++;
            
        } catch (Exception e) {
            failCount++;
            XxlJobLogger.log("ä¼˜æƒ åˆ¸è¿‡æœŸå¤±è´¥ï¼Œåˆ¸IDï¼š{}ï¼ŒåŸå› ï¼š{}", 
                coupon.getId(), e.getMessage());
        }
    }
    
    XxlJobLogger.log("åˆ†ç‰‡[{}/{}] å¤„ç†å®Œæˆï¼ŒæˆåŠŸï¼š{}ï¼Œå¤±è´¥ï¼š{}", 
        shardIndex, shardTotal, successCount, failCount);
}
```

**æ‰¹é‡ä¼˜åŒ–æŠ€å·§ï¼š**

```java
// ä½¿ç”¨æ‰¹é‡æ›´æ–°æå‡æ€§èƒ½
public void batchExpireCoupons(List<Long> couponIds) {
    // æ¯æ¬¡æ›´æ–°500æ¡
    int batchSize = 500;
    for (int i = 0; i < couponIds.size(); i += batchSize) {
        int end = Math.min(i + batchSize, couponIds.size());
        List<Long> batch = couponIds.subList(i, end);
        
        // æ‰¹é‡æ›´æ–°
        couponMapper.batchUpdateStatus(batch, CouponStatus.EXPIRED);
    }
}
```

**è¿‡æœŸé€šçŸ¥æœºåˆ¶ï¼š**

â”Œâ”€ ä¼˜æƒ åˆ¸è¿‡æœŸé€šçŸ¥æµç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   â”‚
â”‚  åˆ¸å³å°†è¿‡æœŸï¼ˆ3å¤©å‰ï¼‰              â”‚
â”‚       â†“                           â”‚
â”‚  å‘é€æé†’é€šçŸ¥ "æ‚¨çš„åˆ¸å³å°†è¿‡æœŸ"     â”‚
â”‚       â†“                           â”‚
â”‚  åˆ¸å·²è¿‡æœŸï¼ˆå½“å¤©ï¼‰                 â”‚
â”‚       â†“                           â”‚
â”‚  æ ‡è®°è¿‡æœŸçŠ¶æ€                      â”‚
â”‚       â†“                           â”‚
â”‚  å‘é€è¿‡æœŸé€šçŸ¥ "æ‚¨çš„åˆ¸å·²è¿‡æœŸ"       â”‚
â”‚       â†“                           â”‚
â”‚  ç”Ÿæˆè¿‡æœŸç»Ÿè®¡æŠ¥è¡¨                  â”‚
â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

> ğŸ”§ **å®è·µå»ºè®®**ï¼š
> - æå‰3å¤©å‘é€å³å°†è¿‡æœŸæé†’ï¼Œæå‡åˆ¸ä½¿ç”¨ç‡
> - è¿‡æœŸåˆ¸æ•°æ®å¯ä»¥å®šæœŸå½’æ¡£åˆ°å†å²è¡¨
> - ç»Ÿè®¡è¿‡æœŸç‡ï¼Œä¼˜åŒ–åˆ¸çš„æœ‰æ•ˆæœŸè®¾ç½®

---

## 7. ğŸ’° ç§¯åˆ†æ¸…ç®—ä»»åŠ¡


### 7.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**ä»€ä¹ˆæ˜¯ç§¯åˆ†æ¸…ç®—ï¼Ÿ**
ç”¨æˆ·è´­ç‰©è·å¾—ç§¯åˆ†ï¼Œè¿™äº›ç§¯åˆ†éœ€è¦å®šæœŸç»“ç®—ã€è¿‡æœŸå¤„ç†ã€ç­‰çº§è®¡ç®—ç­‰ã€‚

**ç§¯åˆ†ä¸šåŠ¡æµç¨‹ï¼š**
```
ç”¨æˆ·æ¶ˆè´¹
    â†“
è·å¾—ç§¯åˆ† â†’ ç§¯åˆ†è´¦æˆ· â†’ [å®šæœŸæ¸…ç®—] â†’ ç­‰çº§è®¡ç®—
    â†“                     â†“           â†“
ä¸´æ—¶ç§¯åˆ†              è¿‡æœŸå¤„ç†    æƒç›Šå‘æ”¾
    â†“                     â†“           â†“
[30å¤©åç¡®è®¤]        æ¸…é›¶/å½’æ¡£    ä¼˜æƒ åˆ¸/ç¤¼å“
    â†“
æ­£å¼ç§¯åˆ†
```

**ä¸ºä»€ä¹ˆè¦å®šæœŸæ¸…ç®—ï¼Ÿ**
- **ç§¯åˆ†ç¡®è®¤** - é€€è´§æœŸè¿‡äº†ï¼Œä¸´æ—¶ç§¯åˆ†è½¬ä¸ºæ­£å¼ç§¯åˆ†
- **è¿‡æœŸå¤„ç†** - ç§¯åˆ†1å¹´æœ‰æ•ˆæœŸï¼Œè¿‡æœŸè¦æ¸…é›¶
- **ç­‰çº§è®¡ç®—** - æ ¹æ®ç§¯åˆ†é‡æ–°è®¡ç®—ç”¨æˆ·ä¼šå‘˜ç­‰çº§
- **è´¢åŠ¡å¯¹è´¦** - ç§¯åˆ†ä»£è¡¨ç°é‡‘ä»·å€¼ï¼Œéœ€è¦å¯¹è´¦

### 7.2 ç§¯åˆ†æ¸…ç®—è§„åˆ™


**ç§¯åˆ†ç±»å‹ï¼š**

| ç§¯åˆ†ç±»å‹ | **æœ‰æ•ˆæœŸ** | **è·å–æ–¹å¼** | **æ¸…ç®—è§„åˆ™** |
|---------|-----------|------------|-------------|
| ğŸ èµ é€ç§¯åˆ† | 30å¤© | æ–°äººæ³¨å†Œã€æ´»åŠ¨å¥–åŠ± | 30å¤©åè¿‡æœŸæ¸…é›¶ |
| ğŸ’³ æ¶ˆè´¹ç§¯åˆ† | 1å¹´ | è´­ç‰©æ¶ˆè´¹è·å¾— | 1å¹´åè¿‡æœŸæ¸…é›¶ |
| ğŸ‘‘ æ°¸ä¹…ç§¯åˆ† | æ°¸ä¹… | ä¼šå‘˜å……å€¼è·å¾— | æ°¸ä¸è¿‡æœŸ |
| â° ä¸´æ—¶ç§¯åˆ† | è®¢å•å®Œæˆåç”Ÿæ•ˆ | è´­ç‰©å¾…ç¡®è®¤ | é€€è´§æœŸåè½¬æ­£å¼ |

**æ¸…ç®—å‘¨æœŸï¼š**
```
æ¯æ—¥å‡Œæ™¨2ç‚¹ï¼š
â”œâ”€ ç¡®è®¤æ˜¨æ—¥è®¢å•çš„ä¸´æ—¶ç§¯åˆ†
â”œâ”€ æ¸…ç†30å¤©å‰çš„èµ é€ç§¯åˆ†
â””â”€ æ¸…ç†1å¹´å‰çš„æ¶ˆè´¹ç§¯åˆ†

æ¯æœˆ1æ—¥å‡Œæ™¨ï¼š
â”œâ”€ é‡æ–°è®¡ç®—ç”¨æˆ·ç­‰çº§
â”œâ”€ å‘æ”¾ç­‰çº§æƒç›Š
â””â”€ ç”Ÿæˆç§¯åˆ†æœˆæŠ¥
```

### 7.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**æ¯æ—¥ç§¯åˆ†ç¡®è®¤ä»»åŠ¡ï¼š**

```java
@XxlJob("pointsConfirmHandler")
public void confirmPoints() {
    // 1. æŸ¥è¯¢30å¤©å‰çš„å¾…ç¡®è®¤ç§¯åˆ†ï¼ˆé€€è´§æœŸå·²è¿‡ï¼‰
    LocalDateTime confirmDate = LocalDateTime.now().minusDays(30);
    List<PointsRecord> pendingPoints = pointsMapper.findPendingPoints(confirmDate);
    
    for (PointsRecord record : pendingPoints) {
        // æ£€æŸ¥è®¢å•çŠ¶æ€
        Order order = orderMapper.findById(record.getOrderId());
        
        if (order.getStatus() == OrderStatus.COMPLETED) {
            // è®¢å•æ­£å¸¸å®Œæˆï¼Œç§¯åˆ†è½¬ä¸ºæ­£å¼
            record.setStatus(PointsStatus.CONFIRMED);
            record.setConfirmTime(LocalDateTime.now());
            pointsMapper.updateRecord(record);
            
            // æ›´æ–°ç”¨æˆ·æ€»ç§¯åˆ†
            userPointsService.addPoints(record.getUserId(), record.getPoints());
            
        } else if (order.getStatus() == OrderStatus.REFUNDED) {
            // è®¢å•å·²é€€æ¬¾ï¼Œå–æ¶ˆç§¯åˆ†
            record.setStatus(PointsStatus.CANCELLED);
            pointsMapper.updateRecord(record);
        }
    }
    
    XxlJobLogger.log("ç¡®è®¤ç§¯åˆ†è®°å½•æ•°ï¼š{}", pendingPoints.size());
}
```

**ç§¯åˆ†è¿‡æœŸæ¸…ç†ä»»åŠ¡ï¼š**

```java
@XxlJob("pointsExpireHandler")
public void expirePoints() {
    // 1. æ¸…ç†èµ é€ç§¯åˆ†ï¼ˆ30å¤©è¿‡æœŸï¼‰
    LocalDateTime giftExpireDate = LocalDateTime.now().minusDays(30);
    int giftExpired = pointsMapper.expireGiftPoints(giftExpireDate);
    
    // 2. æ¸…ç†æ¶ˆè´¹ç§¯åˆ†ï¼ˆ1å¹´è¿‡æœŸï¼‰
    LocalDateTime consumeExpireDate = LocalDateTime.now().minusYears(1);
    int consumeExpired = pointsMapper.expireConsumePoints(consumeExpireDate);
    
    // 3. å‘é€è¿‡æœŸé€šçŸ¥
    List<User> affectedUsers = pointsMapper.findAffectedUsers();
    for (User user : affectedUsers) {
        int expiredPoints = giftExpired + consumeExpired;
        messageService.send(user.getId(), 
            "æ‚¨æœ‰" + expiredPoints + "ç§¯åˆ†å·²è¿‡æœŸ");
    }
    
    XxlJobLogger.log("è¿‡æœŸç§¯åˆ†æ¸…ç†å®Œæˆï¼Œèµ é€ç§¯åˆ†ï¼š{}ï¼Œæ¶ˆè´¹ç§¯åˆ†ï¼š{}", 
        giftExpired, consumeExpired);
}
```

**ä¼šå‘˜ç­‰çº§è®¡ç®—ä»»åŠ¡ï¼š**

```java
@XxlJob("memberLevelHandler")
public void calculateMemberLevel() {
    // æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒç”¨æˆ·
    List<User> users = userMapper.findActiveUsers();
    
    for (User user : users) {
        // è·å–ç”¨æˆ·å½“å‰æ€»ç§¯åˆ†
        int totalPoints = userPointsService.getTotalPoints(user.getId());
        
        // è®¡ç®—åº”å¾—ç­‰çº§
        MemberLevel newLevel = levelService.calculateLevel(totalPoints);
        
        // å¦‚æœç­‰çº§å˜åŒ–
        if (!newLevel.equals(user.getCurrentLevel())) {
            // æ›´æ–°ç”¨æˆ·ç­‰çº§
            user.setCurrentLevel(newLevel);
            user.setLevelUpdateTime(LocalDateTime.now());
            userMapper.updateUser(user);
            
            // å‘æ”¾æ–°ç­‰çº§æƒç›Š
            if (newLevel.isUpgrade()) {
                benefitService.grantBenefits(user.getId(), newLevel);
                messageService.send(user.getId(), 
                    "æ­å–œå‡çº§åˆ°" + newLevel.getName());
            }
        }
    }
}
```

**ç§¯åˆ†å¯¹è´¦æµç¨‹ï¼š**

```
æ¯æ—¥å¯¹è´¦æµç¨‹ï¼š

1. ç»Ÿè®¡å½“æ—¥ç§¯åˆ†å‘æ”¾æ€»æ•°
      â†“
2. ç»Ÿè®¡å½“æ—¥ç§¯åˆ†æ¶ˆè´¹æ€»æ•°
      â†“
3. è®¡ç®—ç§¯åˆ†ä½™é¢å˜åŒ–
      â†“
4. ä¸è´¢åŠ¡ç³»ç»Ÿå¯¹è´¦
      â†“
   å·®å¼‚ > 0ï¼Ÿ
   â†™        â†˜
 æ˜¯          å¦
  â†“          â†“
å‘Šè­¦å¤„ç†   ç”ŸæˆæŠ¥è¡¨
```

> ğŸ’¡ **å…³é”®ç‚¹**ï¼š
> - ç§¯åˆ†æ¶‰åŠç”¨æˆ·æƒç›Šï¼Œæ¸…ç®—é€»è¾‘è¦ä¸¥è°¨ï¼Œæœ€å¥½åŠ ä¸Šäººå·¥å®¡æ ¸ç¯èŠ‚
> - ç­‰çº§é™çº§è¦æ…é‡ï¼Œå¯ä»¥è®¾ç½®ä¿çº§æœŸï¼Œé¿å…ç”¨æˆ·åæ„Ÿ
> - ç§¯åˆ†è¿‡æœŸå‰è¦å¤šæ¬¡æé†’ï¼Œæå‡ç”¨æˆ·æ´»è·ƒåº¦

---

## 8. ğŸ“¬ æ¶ˆæ¯æ¨é€ä»»åŠ¡


### 8.1 ä¸šåŠ¡åœºæ™¯è¯´æ˜


**ç”µå•†æ¶ˆæ¯æ¨é€ç±»å‹ï¼š**

```
æ¨é€ç±»å‹åˆ†ç±»ï¼š

ğŸ“± è¥é”€ç±»æ¶ˆæ¯
â”œâ”€ æ´»åŠ¨é¢„å‘Š
â”œâ”€ ä¼˜æƒ æé†’
â”œâ”€ æ–°å“ä¸Šæ¶
â””â”€ ä¸ªæ€§åŒ–æ¨è

ğŸ”” ä¸šåŠ¡ç±»æ¶ˆæ¯  
â”œâ”€ è®¢å•çŠ¶æ€æ›´æ–°
â”œâ”€ ç‰©æµä¿¡æ¯
â”œâ”€ æ”¯ä»˜æˆåŠŸ
â””â”€ é€€æ¬¾é€šçŸ¥

âš ï¸ ç³»ç»Ÿç±»æ¶ˆæ¯
â”œâ”€ è´¦æˆ·å¼‚å¸¸
â”œâ”€ å¯†ç ä¿®æ”¹
â”œâ”€ ç§¯åˆ†å˜åŠ¨
â””â”€ åˆ¸å³å°†è¿‡æœŸ
```

**ä¸ºä»€ä¹ˆéœ€è¦å®šæ—¶æ¨é€ï¼Ÿ**
- **é¿å…æ‰“æ‰°** - ä¸åœ¨ç”¨æˆ·ä¼‘æ¯æ—¶é—´æ¨é€ï¼ˆæ¯”å¦‚æ™šä¸Š10ç‚¹åï¼‰
- **æ‰¹é‡å¤„ç†** - ä¸€æ¬¡æ€§æ¨é€ç»™æ‰€æœ‰ç›®æ ‡ç”¨æˆ·ï¼Œæ•ˆç‡é«˜
- **ç²¾å‡†è¥é”€** - åœ¨åˆé€‚çš„æ—¶é—´æ¨é€ï¼Œè½¬åŒ–ç‡æ›´é«˜

### 8.2 æ¨é€ç­–ç•¥è®¾è®¡


**æ¨é€æ—¶é—´é€‰æ‹©ï¼š**

```
æ—¶æ®µæ¨é€æ•ˆæœåˆ†æï¼š

08:00-09:00  æ—©é«˜å³°  ğŸ“ˆ æ‰“å¼€ç‡é«˜ï¼ˆä¸Šç­è·¯ä¸Šçœ‹æ‰‹æœºï¼‰
12:00-13:00  åˆä¼‘æ—¶  ğŸ“ˆ æ‰“å¼€ç‡é«˜ï¼ˆåˆä¼‘åˆ·æ‰‹æœºï¼‰
18:00-20:00  æ™šé«˜å³°  ğŸ“ˆ æ‰“å¼€ç‡é«˜ï¼ˆä¸‹ç­è·¯ä¸Šï¼‰
22:00-23:00  ç¡å‰    ğŸ“Š æ‰“å¼€ç‡ä¸­ï¼ˆéƒ¨åˆ†äººä¼šçœ‹ï¼‰
23:00-08:00  ä¼‘æ¯æ—¶  ğŸ“‰ æ‰“å¼€ç‡ä½ï¼ˆæ‰“æ‰°ç”¨æˆ·ï¼‰
```

> âš ï¸ **é‡è¦**ï¼šè¥é”€ç±»æ¶ˆæ¯é¿å¼€å¤œé—´æ¨é€ï¼Œç³»ç»Ÿç±»æ¶ˆæ¯ï¼ˆå¦‚æ”¯ä»˜æˆåŠŸï¼‰åˆ™éœ€è¦å®æ—¶æ¨é€ã€‚

**ç”¨æˆ·åˆ†ç¾¤æ¨é€ï¼š**

| ç”¨æˆ·ç¾¤ä½“ | **æ¨é€å†…å®¹** | **æ¨é€æ—¶é—´** | **é¢‘ç‡é™åˆ¶** |
|---------|------------|------------|-------------|
| ğŸ‘¥ æ–°ç”¨æˆ· | æ–°äººä¼˜æƒ åˆ¸ã€ä½¿ç”¨æŒ‡å— | æ³¨å†Œå24å°æ—¶å†… | æ¯å¤©æœ€å¤š3æ¡ |
| ğŸ›’ æ´»è·ƒç”¨æˆ· | ä¸ªæ€§åŒ–æ¨èã€æ´»åŠ¨é€šçŸ¥ | æ—©æ™šé«˜å³° | æ¯å¤©æœ€å¤š5æ¡ |
| ğŸ˜´ æ²‰ç¡ç”¨æˆ· | å”¤é†’ä¼˜æƒ ã€å›å½’ç¤¼åŒ… | å‘¨æœ«ä¸Šåˆ | æ¯å‘¨æœ€å¤š2æ¡ |
| ğŸ‘‘ VIPç”¨æˆ· | ä¸“å±æ´»åŠ¨ã€ä¼˜å…ˆè´­ä¹° | è‡ªå®šä¹‰æ—¶é—´ | æ— é™åˆ¶ |

### 8.3 XXL-JOBå®ç°æ–¹æ¡ˆ


**æ´»åŠ¨é¢„å‘Šæ¨é€ä»»åŠ¡ï¼š**

```java
@XxlJob("activityNoticeHandler")
public void sendActivityNotice() {
    // 1. æŸ¥è¯¢æ˜å¤©å¼€å§‹çš„æ´»åŠ¨
    LocalDate tomorrow = LocalDate.now().plusDays(1);
    List<Activity> upcomingActivities = activityMapper.findUpcoming(tomorrow);
    
    for (Activity activity : upcomingActivities) {
        // 2. æŸ¥è¯¢è®¢é˜…ç”¨æˆ·
        List<Long> subscribers = activityMapper.findSubscribers(activity.getId());
        
        // 3. æ„å»ºæ¨é€æ¶ˆæ¯
        PushMessage message = new PushMessage();
        message.setTitle("æ˜æ—¥" + activity.getStartTime() + " æ´»åŠ¨å¼€å§‹");
        message.setContent(activity.getName() + "ï¼Œä¸å®¹é”™è¿‡ï¼");
        message.setJumpUrl("/activity/" + activity.getId());
        
        // 4. æ‰¹é‡æ¨é€ï¼ˆåˆ†æ‰¹é¿å…å‹åŠ›è¿‡å¤§ï¼‰
        int batchSize = 1000;
        for (int i = 0; i < subscribers.size(); i += batchSize) {
            List<Long> batch = subscribers.subList(
                i, Math.min(i + batchSize, subscribers.size())
            );
            pushService.batchSend(batch, message);
            
            // é™æµï¼Œé¿å…æ¨é€æœåŠ¡è¿‡è½½
            Thread.sleep(100);
        }
        
        XxlJobLogger.log("æ´»åŠ¨é¢„å‘Šæ¨é€å®Œæˆï¼Œæ´»åŠ¨IDï¼š{}ï¼Œæ¨é€äººæ•°ï¼š{}", 
            activity.getId(), subscribers.size());
    }
}
```

**ä¸ªæ€§åŒ–æ¨èæ¨é€ï¼š**

```java
@XxlJob("personalRecommendHandler")
public void sendPersonalRecommend() {
    // è·å–åˆ†ç‰‡ä¿¡æ¯
    int shardIndex = XxlJobHelper.getShardIndex();
    int shardTotal = XxlJobHelper.getShardTotal();
    
    // 1. åˆ†ç‰‡æŸ¥è¯¢æ´»è·ƒç”¨æˆ·
    List<User> activeUsers = userMapper.findActiveUsers(shardIndex, shardTotal);
    
    for (User user : activeUsers) {
        // 2. è°ƒç”¨æ¨èç®—æ³•è·å–å•†å“
        List<Product> recommendProducts = recommendService.getRecommend(
            user.getId(), 5
        );
        
        if (recommendProducts.isEmpty()) {
            continue; // æ²¡æœ‰æ¨èå•†å“å°±è·³è¿‡
        }
        
        // 3. æ„å»ºæ¨é€å†…å®¹
        StringBuilder content = new StringBuilder("ä¸ºæ‚¨æ¨èï¼š");
        for (Product product : recommendProducts) {
            content.append(product.getName()).append("ã€");
        }
        
        PushMessage message = new PushMessage();
        message.setTitle("çŒœæ‚¨å–œæ¬¢");
        message.setContent(content.toString());
        message.setUserId(user.getId());
        
        // 4. æ£€æŸ¥æ¨é€é¢‘ç‡é™åˆ¶
        if (pushService.canSend(user.getId())) {
            pushService.send(message);
        }
    }
    
    XxlJobLogger.log("åˆ†ç‰‡[{}/{}]æ¨èæ¨é€å®Œæˆï¼Œç”¨æˆ·æ•°ï¼š{}", 
        shardIndex, shardTotal, activeUsers.size());
}
```

**æ¨é€æ•ˆæœç»Ÿè®¡ï¼š**

```java
@XxlJob("pushStatisticsHandler")
public void statisticsPushEffect() {
    // 1. ç»Ÿè®¡æ˜¨æ—¥æ¨é€æ•°æ®
    LocalDate yesterday = LocalDate.now().minusDays(1);
    
    // 2. æŒ‰æ¨é€ç±»å‹ç»Ÿè®¡
    Map<String, PushStats> typeStats = new HashMap<>();
    typeStats.put("è¥é”€", pushMapper.statsByType("MARKETING", yesterday));
    typeStats.put("ä¸šåŠ¡", pushMapper.statsByType("BUSINESS", yesterday));
    typeStats.put("ç³»ç»Ÿ", pushMapper.statsByType("SYSTEM", yesterday));
    
    // 3. è®¡ç®—å…³é”®æŒ‡æ ‡
    for (Map.Entry<String, PushStats> entry : typeStats.entrySet()) {
        PushStats stats = entry.getValue();
        
        // é€è¾¾ç‡ = é€è¾¾æ•° / å‘é€æ•°
        double deliveryRate = stats.getDelivered() * 100.0 / stats.getSent();
        
        // æ‰“å¼€ç‡ = æ‰“å¼€æ•° / é€è¾¾æ•°
        double openRate = stats.getOpened() * 100.0 / stats.getDelivered();
        
        // è½¬åŒ–ç‡ = è½¬åŒ–æ•° / æ‰“å¼€æ•°
        double conversionRate = stats.getConverted() * 100.0 / stats.getOpened();
        
        XxlJobLogger.log("{}ç±»æ¨é€ - é€è¾¾ç‡ï¼š{:.2f}%ï¼Œæ‰“å¼€ç‡ï¼š{:.2f}%ï¼Œè½¬åŒ–ç‡ï¼š{:.2f}%",
            entry.getKey(), deliveryRate, openRate, conversionRate);
    }
    
    // 4. ä¿å­˜ç»Ÿè®¡ç»“æœ
    PushDailyReport report = new PushDailyReport();
    report.setReportDate(yesterday);
    report.setTypeStats(JSON.toJSONString(typeStats));
    reportMapper.insert(report);
}
```

**æ¨é€æ•ˆæœä¼˜åŒ–å»ºè®®ï¼š**

â”Œâ”€ æå‡æ¨é€æ•ˆæœçš„æ–¹æ³• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   â”‚
â”‚  1ï¸âƒ£ æ ‡é¢˜ä¼˜åŒ–ï¼š                    â”‚
â”‚     âŒ "æ–°æ´»åŠ¨é€šçŸ¥"               â”‚
â”‚     âœ… "é™æ—¶5æŠ˜ï¼ä»…å‰©3å°æ—¶"       â”‚
â”‚                                   â”‚
â”‚  2ï¸âƒ£ æ—¶é—´ä¼˜åŒ–ï¼š                    â”‚
â”‚     é¿å¼€å¤œé—´ã€é€‰æ‹©ç”¨æˆ·æ´»è·ƒæ—¶æ®µ     â”‚
â”‚                                   â”‚
â”‚  3ï¸âƒ£ é¢‘ç‡æ§åˆ¶ï¼š                    â”‚
â”‚     æ¯å¤©æœ€å¤š5æ¡ï¼Œé¿å…æ‰“æ‰°          â”‚
â”‚                                   â”‚
â”‚  4ï¸âƒ£ å†…å®¹ä¸ªæ€§åŒ–ï¼š                  â”‚
â”‚     åŸºäºç”¨æˆ·è¡Œä¸ºæ¨é€æ„Ÿå…´è¶£å†…å®¹     â”‚
â”‚                                   â”‚
â”‚  5ï¸âƒ£ A/Bæµ‹è¯•ï¼š                     â”‚
â”‚     æµ‹è¯•ä¸åŒæ–‡æ¡ˆçš„è½¬åŒ–æ•ˆæœ         â”‚
â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

> ğŸš€ **è¿›é˜¶æŠ€å·§**ï¼š
> - ä½¿ç”¨æœºå™¨å­¦ä¹ é¢„æµ‹ç”¨æˆ·æœ€ä½³æ¨é€æ—¶é—´
> - å»ºç«‹ç”¨æˆ·ç”»åƒï¼Œç²¾å‡†åˆ†ç¾¤æ¨é€
> - è®¾ç½®é™é»˜æœŸï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰å‹¿æ‰°æ—¶é—´

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 ä»»åŠ¡è®¾è®¡åŸåˆ™


**è®¾è®¡ä¸‰è¦ç´ ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  â”‚
â”‚   å¯é æ€§  â—„â”€â”€â”€â”€â”                â”‚
â”‚     â†‘          â”‚                â”‚
â”‚     â”‚      æ ¸å¿ƒç›®æ ‡              â”‚
â”‚     â”‚          â”‚                â”‚
â”‚     â†“          â†“                â”‚
â”‚   æ€§èƒ½ â—„â”€â”€â–º å¯ç»´æŠ¤æ€§             â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **å¯é æ€§** - ä»»åŠ¡ä¸èƒ½ä¸¢å¤±ï¼Œå¤±è´¥è¦é‡è¯•
- **æ€§èƒ½** - å¤§æ•°æ®é‡è¦åˆ†ç‰‡å¤„ç†ï¼Œé¿å…é˜»å¡
- **å¯ç»´æŠ¤æ€§** - æ—¥å¿—å®Œå–„ï¼Œé—®é¢˜å¯è¿½æº¯

### 9.2 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**é—®é¢˜1ï¼šä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿**
```
åŸå› åˆ†æï¼š
â”œâ”€ æ•°æ®é‡å¤ªå¤§ï¼Œä¸€æ¬¡æ€§å¤„ç†ä¸å®Œ
â”œâ”€ SQLæŸ¥è¯¢æ…¢ï¼Œæ²¡æœ‰å»ºç´¢å¼•
â””â”€ å¤–éƒ¨æ¥å£è°ƒç”¨æ…¢

è§£å†³æ–¹æ¡ˆï¼š
â”œâ”€ å¯ç”¨åˆ†ç‰‡å¹¿æ’­ï¼Œå¹¶è¡Œå¤„ç†
â”œâ”€ ä¼˜åŒ–SQLï¼Œæ·»åŠ ç´¢å¼•
â”œâ”€ å¼‚æ­¥è°ƒç”¨å¤–éƒ¨æ¥å£
â””â”€ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
```

**é—®é¢˜2ï¼šä»»åŠ¡é‡å¤æ‰§è¡Œ**
```
åŸå› ï¼šé›†ç¾¤ç¯å¢ƒä¸‹å¤šä¸ªå®ä¾‹åŒæ—¶æ‰§è¡Œ

è§£å†³æ–¹æ¡ˆï¼š
âœ… ä½¿ç”¨å•æœºä¸²è¡Œé˜»å¡ç­–ç•¥
âœ… åˆ†ç‰‡å¹¿æ’­ + åˆ†ç‰‡å‚æ•°éš”ç¦»
âœ… æ•°æ®åº“å”¯ä¸€ç´¢å¼•é˜²é‡
```

**é—®é¢˜3ï¼šä»»åŠ¡å¤±è´¥å¤„ç†**
```
å¤±è´¥ç±»å‹ï¼š
â”œâ”€ ç½‘ç»œå¼‚å¸¸ â†’ è‡ªåŠ¨é‡è¯•3æ¬¡
â”œâ”€ æ•°æ®å¼‚å¸¸ â†’ è®°å½•é”™è¯¯æ—¥å¿—ï¼Œäººå·¥å¤„ç†
â””â”€ ç³»ç»Ÿå¼‚å¸¸ â†’ å‘Šè­¦é€šçŸ¥ï¼Œå¿«é€Ÿæ¢å¤

è¡¥å¿æœºåˆ¶ï¼š
å®šæ—¶ä»»åŠ¡ + äººå·¥è¡¥å¿ + æ•°æ®å¯¹è´¦
```

### 9.3 æœ€ä½³å®è·µæ¸…å•


âœ… **ä»»åŠ¡é…ç½®**
- åˆç†è®¾ç½®Cronè¡¨è¾¾å¼ï¼Œé¿å…é«˜å³°æœŸæ‰§è¡Œ
- æ ¹æ®æ•°æ®é‡é€‰æ‹©ä¸²è¡Œæˆ–åˆ†ç‰‡æ‰§è¡Œ
- è®¾ç½®ä»»åŠ¡è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡

âœ… **ä»£ç å®ç°**
- å‚æ•°æ ¡éªŒï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸
- åˆ†æ‰¹å¤„ç†å¤§æ•°æ®é‡ï¼Œé¿å…å†…å­˜æº¢å‡º
- å¹‚ç­‰æ€§è®¾è®¡ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ

âœ… **ç›‘æ§å‘Šè­¦**
- è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- ä»»åŠ¡å¤±è´¥åŠæ—¶å‘Šè­¦
- å®šæœŸæŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒæŠ¥è¡¨

âœ… **æ€§èƒ½ä¼˜åŒ–**
- æ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ“ä½œ
- åˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
- å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ

### 9.4 ä»»åŠ¡æ¨¡æ¿å‚è€ƒ


```java
/**
 * XXL-JOBä»»åŠ¡æ ‡å‡†æ¨¡æ¿
 */
@Component
public class StandardJobHandler {
    
    @XxlJob("standardHandler")
    public void execute() {
        // 1. å‚æ•°æ ¡éªŒ
        String param = XxlJobHelper.getJobParam();
        if (StringUtils.isEmpty(param)) {
            XxlJobLogger.log("ä»»åŠ¡å‚æ•°ä¸ºç©º");
            return;
        }
        
        // 2. åˆ†ç‰‡ä¿¡æ¯è·å–
        int shardIndex = XxlJobHelper.getShardIndex();
        int shardTotal = XxlJobHelper.getShardTotal();
        
        try {
            // 3. ä¸šåŠ¡é€»è¾‘å¤„ç†
            List<DataItem> items = queryData(shardIndex, shardTotal);
            int successCount = 0;
            int failCount = 0;
            
            for (DataItem item : items) {
                try {
                    processItem(item);
                    successCount++;
                } catch (Exception e) {
                    failCount++;
                    XxlJobLogger.log("å¤„ç†å¤±è´¥ï¼ŒIDï¼š{}ï¼ŒåŸå› ï¼š{}", 
                        item.getId(), e.getMessage());
                }
            }
            
            // 4. æ‰§è¡Œç»“æœè®°å½•
            XxlJobLogger.log("æ‰§è¡Œå®Œæˆï¼ŒæˆåŠŸï¼š{}ï¼Œå¤±è´¥ï¼š{}", 
                successCount, failCount);
            
        } catch (Exception e) {
            // 5. å¼‚å¸¸å¤„ç†
            XxlJobLogger.log("ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ï¼š{}", e.getMessage());
            throw new RuntimeException(e);
        }
    }
    
    private List<DataItem> queryData(int shardIndex, int shardTotal) {
        // åˆ†ç‰‡æŸ¥è¯¢é€»è¾‘
        return null;
    }
    
    private void processItem(DataItem item) {
        // ä¸šåŠ¡å¤„ç†é€»è¾‘
    }
}
```

### 9.5 å­¦ä¹ å»ºè®®


**å…¥é—¨é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰**
- ğŸ“– ç†è§£å®šæ—¶ä»»åŠ¡çš„åŸºæœ¬æ¦‚å¿µ
- ğŸ”§ æŒæ¡Cronè¡¨è¾¾å¼çš„å†™æ³•
- ğŸ’» å®Œæˆç®€å•ä»»åŠ¡çš„å¼€å‘

**è¿›é˜¶é˜¶æ®µï¼ˆ2-4å‘¨ï¼‰**
- ğŸ¯ æŒæ¡åˆ†ç‰‡å¹¿æ’­çš„ä½¿ç”¨
- âš¡ å­¦ä¼šä»»åŠ¡æ€§èƒ½ä¼˜åŒ–
- ğŸ›¡ï¸ ç†è§£å¤±è´¥é‡è¯•æœºåˆ¶

**é«˜çº§é˜¶æ®µï¼ˆ1-2æœˆï¼‰**
- ğŸ—ï¸ è®¾è®¡å¤æ‚ä¸šåŠ¡åœºæ™¯ä»»åŠ¡
- ğŸ“Š å»ºç«‹ä»»åŠ¡ç›‘æ§ä½“ç³»
- ğŸ” æŒæ¡ä»»åŠ¡å®‰å…¨é˜²æŠ¤

> ğŸ’¡ **å­¦ä¹ è·¯å¾„**ï¼šç†è®ºå­¦ä¹  â†’ ç®€å•å®è·µ â†’ é¡¹ç›®åº”ç”¨ â†’ æ€§èƒ½ä¼˜åŒ– â†’ æ¶æ„è®¾è®¡

---

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
```
ç”µå•†ä»»åŠ¡ä¸ƒä»¶äº‹ï¼Œå®šæ—¶è°ƒåº¦æ ·æ ·é½
è®¢å•è¶…æ—¶è¦å…³é—­ï¼Œåº“å­˜åŒæ­¥åˆ«å¿˜è®°
æŠ¥è¡¨ç»Ÿè®¡å‡Œæ™¨åšï¼Œè¥é”€æ´»åŠ¨å®šæ—¶èµ·
ä¼˜æƒ åˆ¸è¿‡æœŸè¦å¤„ç†ï¼Œç§¯åˆ†æ¸…ç®—æœˆæœˆè®¡
æ¶ˆæ¯æ¨é€è®²ç­–ç•¥ï¼ŒXXL-JOBå¸®åŠ©ä½ 
```