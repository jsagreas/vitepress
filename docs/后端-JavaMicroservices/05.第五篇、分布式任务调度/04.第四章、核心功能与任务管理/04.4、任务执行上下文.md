---
title: 4ã€ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡
---
## ğŸ“š ç›®å½•

1. [ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡æ¦‚è¿°](#1-ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡æ¦‚è¿°)
2. [XxlJobContextæ ¸å¿ƒåŠŸèƒ½](#2-XxlJobContextæ ¸å¿ƒåŠŸèƒ½)
3. [ä»»åŠ¡åŸºç¡€ä¿¡æ¯è·å–](#3-ä»»åŠ¡åŸºç¡€ä¿¡æ¯è·å–)
4. [åˆ†ç‰‡ä»»åŠ¡ä¸Šä¸‹æ–‡](#4-åˆ†ç‰‡ä»»åŠ¡ä¸Šä¸‹æ–‡)
5. [å¹¿æ’­ä»»åŠ¡ä¸Šä¸‹æ–‡](#5-å¹¿æ’­ä»»åŠ¡ä¸Šä¸‹æ–‡)
6. [æ‰§è¡Œæ§åˆ¶ä¸è¶…æ—¶ç®¡ç†](#6-æ‰§è¡Œæ§åˆ¶ä¸è¶…æ—¶ç®¡ç†)
7. [è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º](#7-è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º)
8. [å®è·µåº”ç”¨ä¸æœ€ä½³å®è·µ](#8-å®è·µåº”ç”¨ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡å°±åƒæ˜¯ä»»åŠ¡æ‰§è¡Œæ—¶çš„"èº«ä»½è¯"å’Œ"å·¥å…·ç®±"ï¼Œå®ƒåŒ…å«äº†ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯å’Œå·¥å…·ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰**ï¼šä»»åŠ¡è¿è¡Œæ—¶çš„ç¯å¢ƒä¿¡æ¯
- **XxlJobContext**ï¼šXXL-JOBæä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡
- **ç”Ÿå‘½å‘¨æœŸ**ï¼šä¼´éšä»»åŠ¡æ‰§è¡Œå…¨è¿‡ç¨‹

### 1.2 ä¸Šä¸‹æ–‡çš„ä½œç”¨å’Œä»·å€¼


```
ä»»åŠ¡æ‰§è¡Œæµç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ï¼š

è°ƒåº¦ä¸­å¿ƒ                æ‰§è¡Œå™¨ç«¯
    |                     |
    |--[è§¦å‘ä»»åŠ¡]--------->|
    |  æºå¸¦ä»»åŠ¡ä¿¡æ¯         |--[åˆ›å»ºä¸Šä¸‹æ–‡]
    |                     |  ä»»åŠ¡IDã€å‚æ•°ç­‰
    |                     |
    |                     |--[æ‰§è¡Œä»»åŠ¡é€»è¾‘]
    |                     |  è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯
    |                     |  è¾“å‡ºè‡ªå®šä¹‰æ—¥å¿—
    |                     |
    |<--[è¿”å›æ‰§è¡Œç»“æœ]-----|  é”€æ¯ä¸Šä¸‹æ–‡
    |                     |
```

**ä¸Šä¸‹æ–‡çš„æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ” **ä¿¡æ¯è·å–**ï¼šè·å–ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ï¼ˆIDã€å‚æ•°ç­‰ï¼‰
- ğŸ“Š **åˆ†ç‰‡æ”¯æŒ**ï¼šè·å–åˆ†ç‰‡å‚æ•°è¿›è¡Œå¹¶è¡Œå¤„ç†
- ğŸ“¡ **å¹¿æ’­æ”¯æŒ**ï¼šè·å–å¹¿æ’­æ‰§è¡Œçš„èŠ‚ç‚¹ä¿¡æ¯
- â±ï¸ **æ‰§è¡Œæ§åˆ¶**ï¼šç›‘æ§è¶…æ—¶ã€æ”¯æŒä»»åŠ¡å–æ¶ˆ
- ğŸ“ **æ—¥å¿—è¾“å‡º**ï¼šè‡ªå®šä¹‰æ—¥å¿—è®°å½•

### 1.3 ä¸Šä¸‹æ–‡çš„ä½¿ç”¨åœºæ™¯


| åº”ç”¨åœºæ™¯ | **ä½¿ç”¨ç›®çš„** | **è·å–ä¿¡æ¯** |
|---------|-------------|-------------|
| ğŸ“ **æ•°æ®å¤„ç†** | `è·å–ä»»åŠ¡å‚æ•°` | `å¤„ç†å“ªäº›æ•°æ®ã€å¦‚ä½•å¤„ç†` |
| âš¡ **åˆ†ç‰‡ä»»åŠ¡** | `è·å–åˆ†ç‰‡ä¿¡æ¯` | `å½“å‰åˆ†ç‰‡ç´¢å¼•ã€æ€»åˆ†ç‰‡æ•°` |
| ğŸ“¢ **å¹¿æ’­ä»»åŠ¡** | `è·å–èŠ‚ç‚¹ä¿¡æ¯` | `å½“å‰èŠ‚ç‚¹ç´¢å¼•ã€æ€»èŠ‚ç‚¹æ•°` |
| â° **é•¿æ—¶é—´ä»»åŠ¡** | `ç›‘æ§æ‰§è¡ŒçŠ¶æ€` | `æ˜¯å¦è¶…æ—¶ã€æ˜¯å¦è¢«å–æ¶ˆ` |
| ğŸ“‹ **ä»»åŠ¡æ—¥å¿—** | `è®°å½•æ‰§è¡Œè¿‡ç¨‹` | `è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º` |

---

## 2. ğŸ”§ XxlJobContextæ ¸å¿ƒåŠŸèƒ½


### 2.1 XxlJobContextåŸºæœ¬ä»‹ç»


**ä»€ä¹ˆæ˜¯XxlJobContextï¼Ÿ**
- XXL-JOBæ¡†æ¶æä¾›çš„**ä»»åŠ¡ä¸Šä¸‹æ–‡å·¥å…·ç±»**
- é€šè¿‡**é™æ€æ–¹æ³•**è·å–å½“å‰ä»»åŠ¡çš„æ‰§è¡Œä¿¡æ¯
- åªåœ¨**ä»»åŠ¡æ‰§è¡ŒæœŸé—´**æœ‰æ•ˆ

### 2.2 è·å–XxlJobContextå¯¹è±¡


```java
@Component
public class MyJobHandler {
    
    @XxlJob("dataProcessJob")
    public void processData() {
        // è·å–å½“å‰ä»»åŠ¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡
        XxlJobContext context = XxlJobContext.getXxlJobContext();
        
        if (context != null) {
            // å¯ä»¥å®‰å…¨ä½¿ç”¨ä¸Šä¸‹æ–‡
            XxlJobContext.log("å¼€å§‹æ‰§è¡Œæ•°æ®å¤„ç†ä»»åŠ¡");
        } else {
            // éä»»åŠ¡æ‰§è¡Œç¯å¢ƒï¼Œä¸Šä¸‹æ–‡ä¸ºnull
            System.out.println("å½“å‰ä¸åœ¨ä»»åŠ¡æ‰§è¡Œç¯å¢ƒä¸­");
        }
    }
}
```

> âš ï¸ **é‡è¦æç¤º**ï¼šXxlJobContextåªåœ¨ä»»åŠ¡æ–¹æ³•æ‰§è¡ŒæœŸé—´æœ‰æ•ˆï¼Œåœ¨æ™®é€šæ–¹æ³•ä¸­è°ƒç”¨ä¼šè¿”å›null

### 2.3 ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸ


```
ä»»åŠ¡æ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼š

1. [ä»»åŠ¡è§¦å‘] â†’ è°ƒåº¦ä¸­å¿ƒå‘èµ·è°ƒç”¨
2. [åˆ›å»ºä¸Šä¸‹æ–‡] â†’ æ‰§è¡Œå™¨åˆ›å»ºXxlJobContext
3. [æ‰§è¡Œä»»åŠ¡] â†’ è°ƒç”¨@XxlJobæ ‡æ³¨çš„æ–¹æ³•
4. [é”€æ¯ä¸Šä¸‹æ–‡] â†’ ä»»åŠ¡æ‰§è¡Œå®Œæˆåæ¸…ç†
```

**ç”Ÿå‘½å‘¨æœŸç‰¹ç‚¹**ï¼š
- âœ… **è‡ªåŠ¨ç®¡ç†**ï¼šæ¡†æ¶è‡ªåŠ¨åˆ›å»ºå’Œé”€æ¯
- âœ… **çº¿ç¨‹ç»‘å®š**ï¼šæ¯ä¸ªä»»åŠ¡çº¿ç¨‹ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡
- âœ… **å®‰å…¨éš”ç¦»**ï¼šä¸åŒä»»åŠ¡é—´äº’ä¸å½±å“

---

## 3. ğŸ“‹ ä»»åŠ¡åŸºç¡€ä¿¡æ¯è·å–


### 3.1 è·å–ä»»åŠ¡ID


**ä»»åŠ¡IDçš„å«ä¹‰**ï¼š
- æ¯ä¸ªä»»åŠ¡æ‰§è¡Œå®ä¾‹çš„**å”¯ä¸€æ ‡è¯†**
- ç”¨äº**æ—¥å¿—è·Ÿè¸ª**å’Œ**é—®é¢˜æ’æŸ¥**
- å¯ä»¥å…³è”è°ƒåº¦ä¸­å¿ƒçš„æ‰§è¡Œè®°å½•

```java
@XxlJob("orderProcessJob")
public void processOrder() {
    // è·å–å½“å‰ä»»åŠ¡çš„å”¯ä¸€ID
    long jobId = XxlJobContext.getXxlJobContext().getJobId();
    
    XxlJobContext.log("ä»»åŠ¡ID: " + jobId);
    XxlJobContext.log("å¼€å§‹å¤„ç†è®¢å•æ•°æ®...");
    
    try {
        // ä¸šåŠ¡é€»è¾‘å¤„ç†
        processOrderData();
        XxlJobContext.log("ä»»åŠ¡ID " + jobId + " æ‰§è¡ŒæˆåŠŸ");
    } catch (Exception e) {
        XxlJobContext.log("ä»»åŠ¡ID " + jobId + " æ‰§è¡Œå¤±è´¥: " + e.getMessage());
        throw e;
    }
}
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
- ğŸ“ **æ—¥å¿—æ ‡è®°**ï¼šåœ¨æ—¥å¿—ä¸­æ ‡è®°ä»»åŠ¡æ‰§è¡Œå®ä¾‹
- ğŸ” **é—®é¢˜è¿½è¸ª**ï¼šæ ¹æ®ä»»åŠ¡IDæŸ¥è¯¢æ‰§è¡Œè¯¦æƒ…
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**ï¼šç»Ÿè®¡ä»»åŠ¡æ‰§è¡Œæƒ…å†µ

### 3.2 è·å–ä»»åŠ¡å‚æ•°


**ä»»åŠ¡å‚æ•°çš„ä½œç”¨**ï¼š
- è°ƒåº¦ä¸­å¿ƒä¼ é€’ç»™æ‰§è¡Œå™¨çš„**é…ç½®ä¿¡æ¯**
- æ§åˆ¶ä»»åŠ¡çš„**æ‰§è¡Œè¡Œä¸º**
- å®ç°**çµæ´»é…ç½®**è€Œä¸éœ€è¦ä¿®æ”¹ä»£ç 

```java
@XxlJob("dataCleanJob")
public void cleanData() {
    // è·å–ä»»åŠ¡å‚æ•°
    String jobParam = XxlJobContext.getXxlJobContext().getJobParam();
    
    XxlJobContext.log("æ¥æ”¶åˆ°ä»»åŠ¡å‚æ•°: " + jobParam);
    
    if (jobParam != null && !jobParam.trim().isEmpty()) {
        // è§£æå‚æ•°ï¼ˆå‡è®¾æ˜¯JSONæ ¼å¼ï¼‰
        try {
            JSONObject params = JSON.parseObject(jobParam);
            
            // è·å–å…·ä½“é…ç½®
            String dataType = params.getString("dataType");
            int days = params.getIntValue("days");
            boolean backupData = params.getBooleanValue("backup");
            
            XxlJobContext.log("æ•°æ®ç±»å‹: " + dataType);
            XxlJobContext.log("æ¸…ç†å¤©æ•°: " + days);
            XxlJobContext.log("æ˜¯å¦å¤‡ä»½: " + backupData);
            
            // æ ¹æ®å‚æ•°æ‰§è¡Œä¸åŒé€»è¾‘
            cleanDataByType(dataType, days, backupData);
            
        } catch (Exception e) {
            XxlJobContext.log("å‚æ•°è§£æå¤±è´¥: " + e.getMessage());
        }
    } else {
        XxlJobContext.log("æœªé…ç½®ä»»åŠ¡å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤é…ç½®");
        cleanDataByType("all", 30, true);
    }
}
```

**å‚æ•°é…ç½®ç¤ºä¾‹**ï¼š
```json
{
  "dataType": "user_log",
  "days": 7,
  "backup": true,
  "batchSize": 1000
}
```

**æœ€ä½³å®è·µ**ï¼š
- âœ… **å‚æ•°æ ¡éªŒ**ï¼šæ£€æŸ¥å‚æ•°æ ¼å¼å’Œæœ‰æ•ˆæ€§
- âœ… **é»˜è®¤å€¼**ï¼šæä¾›åˆç†çš„é»˜è®¤é…ç½®
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šå‚æ•°è§£æå¤±è´¥çš„å®¹é”™æœºåˆ¶
- âœ… **æ—¥å¿—è®°å½•**ï¼šè®°å½•å‚æ•°å†…å®¹ä¾¿äºè°ƒè¯•

---

## 4. ğŸ”„ åˆ†ç‰‡ä»»åŠ¡ä¸Šä¸‹æ–‡


### 4.1 åˆ†ç‰‡ä»»åŠ¡æ¦‚å¿µç†è§£


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šåˆ†ç‰‡ä»»åŠ¡å°±åƒæŠŠä¸€ä¸ªå¤§è›‹ç³•åˆ‡æˆå‡ å—ï¼Œæ¯ä¸ªæ‰§è¡Œå™¨è´Ÿè´£å¤„ç†å…¶ä¸­ä¸€å—ï¼Œå¤§å®¶å¹¶è¡Œå·¥ä½œæé«˜æ•ˆç‡ã€‚

**åˆ†ç‰‡ä»»åŠ¡çš„ä¼˜åŠ¿**ï¼š
```
ä¼ ç»Ÿå•æœºä»»åŠ¡ï¼š
å¤„ç†å™¨A: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 12å°æ—¶

åˆ†ç‰‡å¹¶è¡Œä»»åŠ¡ï¼š
å¤„ç†å™¨A: [â–ˆâ–ˆâ–ˆâ–ˆ] 3å°æ—¶ (åˆ†ç‰‡0)
å¤„ç†å™¨B: [â–ˆâ–ˆâ–ˆâ–ˆ] 3å°æ—¶ (åˆ†ç‰‡1)  
å¤„ç†å™¨C: [â–ˆâ–ˆâ–ˆâ–ˆ] 3å°æ—¶ (åˆ†ç‰‡2)
å¤„ç†å™¨D: [â–ˆâ–ˆâ–ˆâ–ˆ] 3å°æ—¶ (åˆ†ç‰‡3)
æ€»ç”¨æ—¶: 3å°æ—¶ï¼ˆæ•ˆç‡æå‡4å€ï¼‰
```

### 4.2 è·å–åˆ†ç‰‡å‚æ•°


```java
@XxlJob("bigDataProcessJob")
public void processBigData() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    // è·å–åˆ†ç‰‡å‚æ•°
    int shardIndex = context.getShardIndex();  // å½“å‰åˆ†ç‰‡ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰
    int shardTotal = context.getShardTotal();  // æ€»åˆ†ç‰‡æ•°
    
    XxlJobContext.log("å½“å‰åˆ†ç‰‡: " + shardIndex + "/" + shardTotal);
    
    // æ ¹æ®åˆ†ç‰‡å‚æ•°å¤„ç†å¯¹åº”çš„æ•°æ®
    processDataByShard(shardIndex, shardTotal);
}

private void processDataByShard(int shardIndex, int shardTotal) {
    XxlJobContext.log("å¼€å§‹å¤„ç†ç¬¬ " + shardIndex + " ä¸ªåˆ†ç‰‡");
    
    // æ–¹å¼1ï¼šæŒ‰IDå–æ¨¡åˆ†ç‰‡
    List<Long> userIds = getUserIds();
    List<Long> myUserIds = userIds.stream()
        .filter(id -> id % shardTotal == shardIndex)
        .collect(Collectors.toList());
    
    XxlJobContext.log("åˆ†ç‰‡ " + shardIndex + " éœ€è¦å¤„ç† " + myUserIds.size() + " ä¸ªç”¨æˆ·");
    
    // å¤„ç†å½“å‰åˆ†ç‰‡çš„æ•°æ®
    for (Long userId : myUserIds) {
        processUserData(userId);
    }
    
    XxlJobContext.log("åˆ†ç‰‡ " + shardIndex + " å¤„ç†å®Œæˆ");
}
```

### 4.3 åˆ†ç‰‡ç­–ç•¥å®ç°


**å¸¸ç”¨åˆ†ç‰‡ç­–ç•¥**ï¼š

```java
/**
 * åˆ†ç‰‡å·¥å…·ç±»
 */
public class ShardingUtil {
    
    /**
     * IDå–æ¨¡åˆ†ç‰‡ï¼ˆé€‚åˆæ•°å­—IDï¼‰
     */
    public static boolean belongsToShard(Long id, int shardIndex, int shardTotal) {
        return id % shardTotal == shardIndex;
    }
    
    /**
     * å“ˆå¸Œåˆ†ç‰‡ï¼ˆé€‚åˆå­—ç¬¦ä¸²ï¼‰
     */
    public static boolean belongsToShardByHash(String key, int shardIndex, int shardTotal) {
        return Math.abs(key.hashCode()) % shardTotal == shardIndex;
    }
    
    /**
     * èŒƒå›´åˆ†ç‰‡ï¼ˆé€‚åˆè¿ç»­æ•°æ®ï¼‰
     */
    public static boolean belongsToRange(Long id, int shardIndex, int shardTotal, 
                                        Long minId, Long maxId) {
        long rangeSize = (maxId - minId + 1) / shardTotal;
        long startId = minId + shardIndex * rangeSize;
        long endId = shardIndex == shardTotal - 1 ? maxId : startId + rangeSize - 1;
        
        return id >= startId && id <= endId;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@XxlJob("userDataSyncJob")
public void syncUserData() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    int shardIndex = context.getShardIndex();
    int shardTotal = context.getShardTotal();
    
    XxlJobContext.log("åŒæ­¥ç”¨æˆ·æ•°æ® - åˆ†ç‰‡: " + shardIndex + "/" + shardTotal);
    
    // è·å–ç”¨æˆ·åˆ—è¡¨å¹¶æŒ‰åˆ†ç‰‡è¿‡æ»¤
    List<User> allUsers = userService.getAllUsers();
    List<User> shardUsers = allUsers.stream()
        .filter(user -> ShardingUtil.belongsToShard(user.getId(), shardIndex, shardTotal))
        .collect(Collectors.toList());
    
    XxlJobContext.log("å½“å‰åˆ†ç‰‡éœ€è¦åŒæ­¥ " + shardUsers.size() + " ä¸ªç”¨æˆ·");
    
    // å¤„ç†å½“å‰åˆ†ç‰‡çš„ç”¨æˆ·æ•°æ®
    for (User user : shardUsers) {
        try {
            syncUserToThirdParty(user);
            XxlJobContext.log("ç”¨æˆ· " + user.getId() + " åŒæ­¥æˆåŠŸ");
        } catch (Exception e) {
            XxlJobContext.log("ç”¨æˆ· " + user.getId() + " åŒæ­¥å¤±è´¥: " + e.getMessage());
        }
    }
}
```

---

## 5. ğŸ“¢ å¹¿æ’­ä»»åŠ¡ä¸Šä¸‹æ–‡


### 5.1 å¹¿æ’­ä»»åŠ¡æ¦‚å¿µç†è§£


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå¹¿æ’­ä»»åŠ¡å°±åƒç­ä¸»ä»»åœ¨ç­çº§ç¾¤é‡Œå‘é€šçŸ¥ï¼Œæ‰€æœ‰åŒå­¦ï¼ˆæ‰§è¡Œå™¨ï¼‰éƒ½ä¼šæ”¶åˆ°å¹¶æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œä½†æ¯ä¸ªäººå¯èƒ½å¤„ç†ä¸åŒçš„éƒ¨åˆ†ã€‚

**å¹¿æ’­ä»»åŠ¡ä¸åˆ†ç‰‡ä»»åŠ¡çš„åŒºåˆ«**ï¼š

| ç‰¹å¾ | **åˆ†ç‰‡ä»»åŠ¡** | **å¹¿æ’­ä»»åŠ¡** |
|------|-------------|-------------|
| ğŸ¯ **è§¦å‘æ–¹å¼** | `é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œå™¨ç»„` | `æ‰€æœ‰æ‰§è¡Œå™¨éƒ½æ‰§è¡Œ` |
| ğŸ“Š **æ•°æ®å¤„ç†** | `æ¯ä¸ªåˆ†ç‰‡å¤„ç†ä¸åŒæ•°æ®` | `æ¯ä¸ªèŠ‚ç‚¹å¯å¤„ç†ç›¸åŒæˆ–ä¸åŒæ•°æ®` |
| ğŸ”„ **ä½¿ç”¨åœºæ™¯** | `å¤§æ•°æ®é‡å¹¶è¡Œå¤„ç†` | `é…ç½®æ›´æ–°ã€ç¼“å­˜åˆ·æ–°` |
| âš¡ **æ‰§è¡Œç­–ç•¥** | `è´Ÿè½½å‡è¡¡åˆ†é…` | `å…¨èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œ` |

### 5.2 è·å–å¹¿æ’­ç´¢å¼•ä¿¡æ¯


```java
@XxlJob("configUpdateJob")
public void updateConfig() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    // è·å–å¹¿æ’­ç´¢å¼•ä¿¡æ¯
    int shardIndex = context.getShardIndex();  // å½“å‰èŠ‚ç‚¹ç´¢å¼•
    int shardTotal = context.getShardTotal();  // æ€»èŠ‚ç‚¹æ•°
    
    XxlJobContext.log("å¹¿æ’­ä»»åŠ¡æ‰§è¡Œ - èŠ‚ç‚¹: " + shardIndex + "/" + shardTotal);
    
    // æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œç›¸åŒçš„é…ç½®æ›´æ–°
    updateLocalConfig();
    
    // å¯ä»¥æ ¹æ®èŠ‚ç‚¹ç´¢å¼•æ‰§è¡Œä¸åŒçš„åˆå§‹åŒ–é€»è¾‘
    if (shardIndex == 0) {
        // ä¸»èŠ‚ç‚¹æ‰§è¡Œç‰¹æ®Šé€»è¾‘
        XxlJobContext.log("ä¸»èŠ‚ç‚¹æ‰§è¡Œé…ç½®éªŒè¯");
        validateConfigUpdate();
    }
    
    XxlJobContext.log("èŠ‚ç‚¹ " + shardIndex + " é…ç½®æ›´æ–°å®Œæˆ");
}
```

### 5.3 å¹¿æ’­ä»»åŠ¡å®é™…åº”ç”¨


**ç¼“å­˜åˆ·æ–°åœºæ™¯**ï¼š
```java
@XxlJob("cacheRefreshJob")
public void refreshCache() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    int shardIndex = context.getShardIndex();
    int shardTotal = context.getShardTotal();
    
    XxlJobContext.log("å¼€å§‹åˆ·æ–°ç¼“å­˜ - èŠ‚ç‚¹: " + shardIndex + "/" + shardTotal);
    
    try {
        // æ¯ä¸ªèŠ‚ç‚¹éƒ½æ¸…ç©ºæœ¬åœ°ç¼“å­˜
        clearLocalCache();
        
        // é‡æ–°åŠ è½½é…ç½®åˆ°ç¼“å­˜
        loadConfigToCache();
        
        XxlJobContext.log("èŠ‚ç‚¹ " + shardIndex + " ç¼“å­˜åˆ·æ–°æˆåŠŸ");
        
        // å¯é€‰ï¼šä¸»èŠ‚ç‚¹å‘é€é€šçŸ¥
        if (shardIndex == 0) {
            sendRefreshNotification();
        }
        
    } catch (Exception e) {
        XxlJobContext.log("èŠ‚ç‚¹ " + shardIndex + " ç¼“å­˜åˆ·æ–°å¤±è´¥: " + e.getMessage());
        throw e;
    }
}
```

**åº”ç”¨é‡å¯åœºæ™¯**ï¼š
```java
@XxlJob("appRestartJob")
public void restartApplication() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    int shardIndex = context.getShardIndex();
    int shardTotal = context.getShardTotal();
    
    XxlJobContext.log("åº”ç”¨é‡å¯ä»»åŠ¡ - èŠ‚ç‚¹: " + shardIndex + "/" + shardTotal);
    
    // åˆ†é˜¶æ®µé‡å¯ï¼Œé¿å…æ‰€æœ‰æœåŠ¡åŒæ—¶ä¸‹çº¿
    int delaySeconds = shardIndex * 30; // æ¯ä¸ªèŠ‚ç‚¹å»¶è¿Ÿ30ç§’
    
    XxlJobContext.log("èŠ‚ç‚¹ " + shardIndex + " å°†åœ¨ " + delaySeconds + " ç§’åé‡å¯");
    
    try {
        Thread.sleep(delaySeconds * 1000);
        
        // æ‰§è¡Œé‡å¯é€»è¾‘
        performRestart();
        
    } catch (InterruptedException e) {
        XxlJobContext.log("é‡å¯è¢«ä¸­æ–­");
        Thread.currentThread().interrupt();
    }
}
```

---

## 6. â±ï¸ æ‰§è¡Œæ§åˆ¶ä¸è¶…æ—¶ç®¡ç†


### 6.1 æ‰§è¡Œè¶…æ—¶æ§åˆ¶åŸç†


**è¶…æ—¶æ§åˆ¶çš„æ„ä¹‰**ï¼š
- ğŸ›¡ï¸ **èµ„æºä¿æŠ¤**ï¼šé¿å…ä»»åŠ¡é•¿æ—¶é—´å ç”¨ç³»ç»Ÿèµ„æº
- âš¡ **æ€§èƒ½ä¿éšœ**ï¼šç¡®ä¿ç³»ç»Ÿæ•´ä½“å“åº”æ€§èƒ½
- ğŸ”§ **æ•…éšœæ¢å¤**ï¼šè‡ªåŠ¨ç»ˆæ­¢å¼‚å¸¸çš„é•¿æ—¶é—´ä»»åŠ¡

```
ä»»åŠ¡è¶…æ—¶æ§åˆ¶æµç¨‹ï¼š

è°ƒåº¦ä¸­å¿ƒ              æ‰§è¡Œå™¨               ä»»åŠ¡çº¿ç¨‹
    |                   |                    |
    |--[å‘èµ·è°ƒç”¨]------->|                    |
    |  è®¾ç½®è¶…æ—¶æ—¶é—´       |--[å¯åŠ¨ä»»åŠ¡]------->|
    |                   |  åˆ›å»ºè¶…æ—¶ç›‘æ§       |--[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]
    |                   |                    |  å®šæœŸæ£€æŸ¥è¶…æ—¶
    |                   |                    |
    |                   |--[è¶…æ—¶ä¿¡å·]------->|
    |                   |                    |--[ä»»åŠ¡ä¸­æ–­]
    |<--[è¿”å›è¶…æ—¶]-------|                    |
```

### 6.2 æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¶…æ—¶


```java
@XxlJob("longRunningJob")
public void longRunningTask() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    XxlJobContext.log("å¼€å§‹æ‰§è¡Œé•¿æ—¶é—´ä»»åŠ¡");
    
    // æ¨¡æ‹Ÿå¤§é‡æ•°æ®å¤„ç†
    List<DataItem> dataItems = getDataItems();
    int totalCount = dataItems.size();
    
    for (int i = 0; i < totalCount; i++) {
        // å®šæœŸæ£€æŸ¥æ˜¯å¦è¶…æ—¶
        if (i % 100 == 0) { // æ¯å¤„ç†100æ¡è®°å½•æ£€æŸ¥ä¸€æ¬¡
            if (context.isTimeout()) {
                XxlJobContext.log("ä»»åŠ¡æ‰§è¡Œè¶…æ—¶ï¼Œå·²å¤„ç†: " + i + "/" + totalCount);
                XxlJobContext.log("ä¿å­˜å½“å‰è¿›åº¦å¹¶é€€å‡º");
                saveProgress(i);
                return; // ä¼˜é›…é€€å‡º
            }
        }
        
        // å¤„ç†æ•°æ®é¡¹
        processDataItem(dataItems.get(i));
        
        // è®°å½•è¿›åº¦
        if (i % 1000 == 0) {
            XxlJobContext.log("å¤„ç†è¿›åº¦: " + i + "/" + totalCount);
        }
    }
    
    XxlJobContext.log("é•¿æ—¶é—´ä»»åŠ¡æ‰§è¡Œå®Œæˆ");
}
```

**æœ€ä½³å®è·µ**ï¼š
```java
@XxlJob("batchProcessJob")
public void batchProcess() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    int batchSize = 500;
    int processedCount = 0;
    
    while (true) {
        // æ¯ä¸ªæ‰¹æ¬¡å¼€å§‹å‰æ£€æŸ¥è¶…æ—¶
        if (context.isTimeout()) {
            XxlJobContext.log("æ£€æµ‹åˆ°è¶…æ—¶ä¿¡å·ï¼Œå·²å¤„ç†: " + processedCount + " æ¡è®°å½•");
            break;
        }
        
        // è·å–ä¸€æ‰¹æ•°æ®å¤„ç†
        List<Record> batch = getNextBatch(processedCount, batchSize);
        if (batch.isEmpty()) {
            XxlJobContext.log("æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆï¼Œæ€»è®¡: " + processedCount + " æ¡");
            break;
        }
        
        // å¤„ç†å½“å‰æ‰¹æ¬¡
        for (Record record : batch) {
            processRecord(record);
        }
        
        processedCount += batch.size();
        XxlJobContext.log("æ‰¹æ¬¡å¤„ç†å®Œæˆï¼Œå½“å‰è¿›åº¦: " + processedCount);
    }
}
```

### 6.3 ä»»åŠ¡å–æ¶ˆæœºåˆ¶


```java
@XxlJob("cancelableJob")
public void cancelableTask() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    XxlJobContext.log("å¼€å§‹æ‰§è¡Œå¯å–æ¶ˆä»»åŠ¡");
    
    for (int i = 0; i < 10000; i++) {
        // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆ
        if (context.isTimeout()) {
            XxlJobContext.log("ä»»åŠ¡è¢«å–æ¶ˆæˆ–è¶…æ—¶ï¼Œåœæ­¢æ‰§è¡Œ");
            cleanup(); // æ¸…ç†èµ„æº
            return;
        }
        
        // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
        try {
            Thread.sleep(100); // æ¯æ¬¡å¤„ç†è€—æ—¶100ms
            processItem(i);
            
            if (i % 100 == 0) {
                XxlJobContext.log("å¤„ç†è¿›åº¦: " + i + "/10000");
            }
            
        } catch (InterruptedException e) {
            XxlJobContext.log("ä»»åŠ¡çº¿ç¨‹è¢«ä¸­æ–­");
            Thread.currentThread().interrupt();
            return;
        }
    }
    
    XxlJobContext.log("ä»»åŠ¡æ­£å¸¸å®Œæˆ");
}

private void cleanup() {
    // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    // å…³é—­æ•°æ®åº“è¿æ¥
    // é‡Šæ”¾å…¶ä»–èµ„æº
    XxlJobContext.log("èµ„æºæ¸…ç†å®Œæˆ");
}
```

---

## 7. ğŸ“ è‡ªå®šä¹‰æ—¥å¿—è¾“å‡º


### 7.1 æ—¥å¿—è¾“å‡ºçš„é‡è¦æ€§


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šè‡ªå®šä¹‰æ—¥å¿—å°±åƒä»»åŠ¡æ‰§è¡Œæ—¶çš„"å®å†µæ’­æŠ¥"ï¼Œè®©ä½ åœ¨è°ƒåº¦ä¸­å¿ƒèƒ½å®æ—¶çœ‹åˆ°ä»»åŠ¡åœ¨åšä»€ä¹ˆï¼Œæœ‰æ²¡æœ‰é—®é¢˜ã€‚

**æ—¥å¿—çš„ä»·å€¼**ï¼š
- ğŸ” **å®æ—¶ç›‘æ§**ï¼šäº†è§£ä»»åŠ¡æ‰§è¡Œè¿›åº¦å’ŒçŠ¶æ€
- ğŸ› **é—®é¢˜æ’æŸ¥**ï¼šå¿«é€Ÿå®šä½ä»»åŠ¡å¤±è´¥åŸå› 
- ğŸ“Š **æ€§èƒ½åˆ†æ**ï¼šç»Ÿè®¡ä»»åŠ¡æ‰§è¡Œæ—¶é—´å’Œæ•ˆç‡
- ğŸ“‹ **å®¡è®¡è¿½æº¯**ï¼šè®°å½•ä»»åŠ¡æ‰§è¡Œå†å²

### 7.2 åŸºç¡€æ—¥å¿—è¾“å‡º


```java
@XxlJob("reportGenerateJob")
public void generateReport() {
    // å¼€å§‹æ—¥å¿—
    XxlJobContext.log("=== æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡å¼€å§‹ ===");
    
    String reportType = XxlJobContext.getXxlJobContext().getJobParam();
    XxlJobContext.log("æŠ¥è¡¨ç±»å‹: " + reportType);
    
    try {
        // æ­¥éª¤1ï¼šæ•°æ®æ”¶é›†
        XxlJobContext.log("æ­¥éª¤1: å¼€å§‹æ”¶é›†æ•°æ®...");
        long startTime = System.currentTimeMillis();
        
        List<ReportData> data = collectReportData(reportType);
        
        long collectTime = System.currentTimeMillis() - startTime;
        XxlJobContext.log("æ­¥éª¤1: æ•°æ®æ”¶é›†å®Œæˆï¼Œè€—æ—¶: " + collectTime + "msï¼Œæ•°æ®é‡: " + data.size());
        
        // æ­¥éª¤2ï¼šæ•°æ®å¤„ç†
        XxlJobContext.log("æ­¥éª¤2: å¼€å§‹å¤„ç†æ•°æ®...");
        startTime = System.currentTimeMillis();
        
        ReportResult result = processReportData(data);
        
        long processTime = System.currentTimeMillis() - startTime;
        XxlJobContext.log("æ­¥éª¤2: æ•°æ®å¤„ç†å®Œæˆï¼Œè€—æ—¶: " + processTime + "ms");
        
        // æ­¥éª¤3ï¼šç”ŸæˆæŠ¥è¡¨æ–‡ä»¶
        XxlJobContext.log("æ­¥éª¤3: å¼€å§‹ç”ŸæˆæŠ¥è¡¨æ–‡ä»¶...");
        startTime = System.currentTimeMillis();
        
        String filePath = generateReportFile(result);
        
        long generateTime = System.currentTimeMillis() - startTime;
        XxlJobContext.log("æ­¥éª¤3: æŠ¥è¡¨æ–‡ä»¶ç”Ÿæˆå®Œæˆï¼Œè€—æ—¶: " + generateTime + "ms");
        XxlJobContext.log("æŠ¥è¡¨æ–‡ä»¶è·¯å¾„: " + filePath);
        
        // æˆåŠŸæ—¥å¿—
        XxlJobContext.log("=== æŠ¥è¡¨ç”Ÿæˆä»»åŠ¡æˆåŠŸå®Œæˆ ===");
        
    } catch (Exception e) {
        // é”™è¯¯æ—¥å¿—
        XxlJobContext.log("æŠ¥è¡¨ç”Ÿæˆå¤±è´¥: " + e.getMessage());
        XxlJobContext.log("é”™è¯¯è¯¦æƒ…: " + getStackTrace(e));
        throw e;
    }
}
```

### 7.3 è¿›åº¦æ—¥å¿—ä¸æ€§èƒ½ç»Ÿè®¡


```java
@XxlJob("dataImportJob")
public void importData() {
    XxlJobContext.log("å¼€å§‹æ•°æ®å¯¼å…¥ä»»åŠ¡");
    
    String filePath = XxlJobContext.getXxlJobContext().getJobParam();
    XxlJobContext.log("å¯¼å…¥æ–‡ä»¶: " + filePath);
    
    long totalStartTime = System.currentTimeMillis();
    int successCount = 0;
    int errorCount = 0;
    
    try {
        List<String> dataLines = readFile(filePath);
        int totalCount = dataLines.size();
        
        XxlJobContext.log("æ–‡ä»¶è¯»å–å®Œæˆï¼Œæ€»è®°å½•æ•°: " + totalCount);
        
        // æ‰¹é‡å¤„ç†æ•°æ®
        int batchSize = 1000;
        for (int i = 0; i < totalCount; i += batchSize) {
            int endIndex = Math.min(i + batchSize, totalCount);
            List<String> batch = dataLines.subList(i, endIndex);
            
            long batchStartTime = System.currentTimeMillis();
            
            for (String line : batch) {
                try {
                    importDataLine(line);
                    successCount++;
                } catch (Exception e) {
                    errorCount++;
                    XxlJobContext.log("å¯¼å…¥å¤±è´¥ - è¡Œ: " + (i + 1) + ", é”™è¯¯: " + e.getMessage());
                }
            }
            
            long batchTime = System.currentTimeMillis() - batchStartTime;
            double progress = ((double) endIndex / totalCount) * 100;
            
            // è¿›åº¦æ—¥å¿—
            XxlJobContext.log(String.format("è¿›åº¦: %.2f%% (%d/%d), æœ¬æ‰¹æ¬¡è€—æ—¶: %dms, æˆåŠŸ: %d, å¤±è´¥: %d",
                progress, endIndex, totalCount, batchTime, successCount, errorCount));
        }
        
        // æœ€ç»ˆç»Ÿè®¡
        long totalTime = System.currentTimeMillis() - totalStartTime;
        XxlJobContext.log("=== æ•°æ®å¯¼å…¥å®Œæˆ ===");
        XxlJobContext.log("æ€»è€—æ—¶: " + totalTime + "ms");
        XxlJobContext.log("æˆåŠŸå¯¼å…¥: " + successCount + " æ¡");
        XxlJobContext.log("å¯¼å…¥å¤±è´¥: " + errorCount + " æ¡");
        XxlJobContext.log("æˆåŠŸç‡: " + String.format("%.2f%%", (double) successCount / (successCount + errorCount) * 100));
        
    } catch (Exception e) {
        XxlJobContext.log("æ•°æ®å¯¼å…¥ä»»åŠ¡å¼‚å¸¸ç»ˆæ­¢: " + e.getMessage());
        throw e;
    }
}
```

### 7.4 åˆ†ç‰‡ä»»åŠ¡çš„æ—¥å¿—è¾“å‡º


```java
@XxlJob("shardDataSyncJob")
public void syncDataWithShard() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    int shardIndex = context.getShardIndex();
    int shardTotal = context.getShardTotal();
    
    // åˆ†ç‰‡æ ‡è¯†æ—¥å¿—
    String shardTag = "[åˆ†ç‰‡" + shardIndex + "/" + shardTotal + "]";
    
    XxlJobContext.log(shardTag + " å¼€å§‹æ•°æ®åŒæ­¥");
    
    try {
        // è·å–å½“å‰åˆ†ç‰‡éœ€è¦å¤„ç†çš„æ•°æ®
        List<SyncData> shardData = getShardData(shardIndex, shardTotal);
        
        XxlJobContext.log(shardTag + " éœ€è¦åŒæ­¥æ•°æ®: " + shardData.size() + " æ¡");
        
        int syncedCount = 0;
        for (SyncData data : shardData) {
            try {
                syncSingleData(data);
                syncedCount++;
                
                // æ¯åŒæ­¥100æ¡è®°å½•è¾“å‡ºä¸€æ¬¡è¿›åº¦
                if (syncedCount % 100 == 0) {
                    XxlJobContext.log(shardTag + " å·²åŒæ­¥: " + syncedCount + "/" + shardData.size());
                }
                
            } catch (Exception e) {
                XxlJobContext.log(shardTag + " åŒæ­¥å¤±è´¥ - ID: " + data.getId() + ", é”™è¯¯: " + e.getMessage());
            }
        }
        
        XxlJobContext.log(shardTag + " æ•°æ®åŒæ­¥å®Œæˆï¼ŒæˆåŠŸ: " + syncedCount + "/" + shardData.size());
        
    } catch (Exception e) {
        XxlJobContext.log(shardTag + " æ•°æ®åŒæ­¥å¼‚å¸¸: " + e.getMessage());
        throw e;
    }
}
```

---

## 8. ğŸ› ï¸ å®è·µåº”ç”¨ä¸æœ€ä½³å®è·µ


### 8.1 ç»¼åˆåº”ç”¨æ¡ˆä¾‹


```java
/**
 * ç»¼åˆåº”ç”¨æ¡ˆä¾‹ï¼šå¤§æ•°æ®é‡ç”¨æˆ·ç§¯åˆ†è®¡ç®—ä»»åŠ¡
 */
@Component
public class UserPointsCalculator {
    
    @XxlJob("calculateUserPoints")
    public void calculateUserPoints() {
        XxlJobContext context = XxlJobContext.getXxlJobContext();
        
        // è·å–åŸºæœ¬ä¿¡æ¯
        long jobId = context.getJobId();
        String jobParam = context.getJobParam();
        int shardIndex = context.getShardIndex();
        int shardTotal = context.getShardTotal();
        
        // è§£æä»»åŠ¡å‚æ•°
        PointsCalculateParam param = parseParam(jobParam);
        
        XxlJobContext.log("=== ç§¯åˆ†è®¡ç®—ä»»åŠ¡å¼€å§‹ ===");
        XxlJobContext.log("ä»»åŠ¡ID: " + jobId);
        XxlJobContext.log("åˆ†ç‰‡ä¿¡æ¯: " + shardIndex + "/" + shardTotal);
        XxlJobContext.log("è®¡ç®—æœˆä»½: " + param.getMonth());
        XxlJobContext.log("è®¡ç®—ç±»å‹: " + param.getType());
        
        long startTime = System.currentTimeMillis();
        int processedUsers = 0;
        
        try {
            // è·å–å½“å‰åˆ†ç‰‡éœ€è¦å¤„ç†çš„ç”¨æˆ·
            List<Long> userIds = getUserIdsByShard(param.getMonth(), shardIndex, shardTotal);
            
            XxlJobContext.log("åˆ†ç‰‡ " + shardIndex + " éœ€è¦å¤„ç†ç”¨æˆ·æ•°: " + userIds.size());
            
            for (Long userId : userIds) {
                // æ£€æŸ¥è¶…æ—¶
                if (context.isTimeout()) {
                    XxlJobContext.log("ä»»åŠ¡è¶…æ—¶ï¼Œå·²å¤„ç†ç”¨æˆ·æ•°: " + processedUsers);
                    saveProgress(jobId, shardIndex, processedUsers);
                    return;
                }
                
                try {
                    // è®¡ç®—ç”¨æˆ·ç§¯åˆ†
                    calculateUserPoints(userId, param);
                    processedUsers++;
                    
                    // æ¯å¤„ç†100ä¸ªç”¨æˆ·è¾“å‡ºä¸€æ¬¡è¿›åº¦
                    if (processedUsers % 100 == 0) {
                        XxlJobContext.log("å¤„ç†è¿›åº¦: " + processedUsers + "/" + userIds.size());
                    }
                    
                } catch (Exception e) {
                    XxlJobContext.log("ç”¨æˆ· " + userId + " ç§¯åˆ†è®¡ç®—å¤±è´¥: " + e.getMessage());
                    // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªç”¨æˆ·
                }
            }
            
            long totalTime = System.currentTimeMillis() - startTime;
            
            XxlJobContext.log("=== ç§¯åˆ†è®¡ç®—ä»»åŠ¡å®Œæˆ ===");
            XxlJobContext.log("å¤„ç†ç”¨æˆ·æ•°: " + processedUsers);
            XxlJobContext.log("æ€»è€—æ—¶: " + totalTime + "ms");
            XxlJobContext.log("å¹³å‡è€—æ—¶: " + (totalTime / processedUsers) + "ms/ç”¨æˆ·");
            
        } catch (Exception e) {
            XxlJobContext.log("ç§¯åˆ†è®¡ç®—ä»»åŠ¡æ‰§è¡Œå¤±è´¥: " + e.getMessage());
            throw e;
        }
    }
    
    // å‚æ•°è§£æ
    private PointsCalculateParam parseParam(String jobParam) {
        if (jobParam == null || jobParam.trim().isEmpty()) {
            XxlJobContext.log("æœªé…ç½®ä»»åŠ¡å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤é…ç½®");
            return PointsCalculateParam.defaultParam();
        }
        
        try {
            return JSON.parseObject(jobParam, PointsCalculateParam.class);
        } catch (Exception e) {
            XxlJobContext.log("å‚æ•°è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®: " + e.getMessage());
            return PointsCalculateParam.defaultParam();
        }
    }
}
```

### 8.2 æœ€ä½³å®è·µæ€»ç»“


#### ğŸ¯ ä¸Šä¸‹æ–‡ä½¿ç”¨åŸåˆ™


```java
// âœ… æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼
@XxlJob("goodPracticeJob")
public void goodPractice() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    // åœ¨æ–¹æ³•å¼€å§‹æ—¶è·å–æ‰€æœ‰éœ€è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
    long jobId = context.getJobId();
    String jobParam = context.getJobParam();
    int shardIndex = context.getShardIndex();
    int shardTotal = context.getShardTotal();
    
    // åç»­ä½¿ç”¨å˜é‡ï¼Œè€Œä¸æ˜¯é‡å¤è°ƒç”¨
    XxlJobContext.log("ä»»åŠ¡ " + jobId + " å¼€å§‹æ‰§è¡Œ");
}

// âŒ ä¸æ¨èçš„ä½¿ç”¨æ–¹å¼
@XxlJob("badPracticeJob")
public void badPractice() {
    // é¿å…åœ¨å¾ªç¯ä¸­é‡å¤è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯
    for (int i = 0; i < 1000; i++) {
        // âŒ é‡å¤è·å–ï¼Œæ€§èƒ½å·®
        if (XxlJobContext.getXxlJobContext().isTimeout()) {
            break;
        }
    }
}
```

#### ğŸ“ æ—¥å¿—è¾“å‡ºè§„èŒƒ


| æ—¥å¿—ç±»å‹ | **è¾“å‡ºæ—¶æœº** | **æ ¼å¼è¦æ±‚** |
|---------|-------------|-------------|
| ğŸ” **å¼€å§‹æ—¥å¿—** | `ä»»åŠ¡å¼€å§‹æ‰§è¡Œ` | `åŒ…å«ä»»åŠ¡åŸºæœ¬ä¿¡æ¯` |
| ğŸ“Š **è¿›åº¦æ—¥å¿—** | `å®šæœŸè¾“å‡ºè¿›åº¦` | `ç™¾åˆ†æ¯” + æ•°é‡ç»Ÿè®¡` |
| âš ï¸ **å¼‚å¸¸æ—¥å¿—** | `å‡ºç°é”™è¯¯æ—¶` | `é”™è¯¯ç±»å‹ + è¯¦ç»†ä¿¡æ¯` |
| âœ… **å®Œæˆæ—¥å¿—** | `ä»»åŠ¡æ‰§è¡Œç»“æŸ` | `æ‰§è¡Œç»“æœ + ç»Ÿè®¡ä¿¡æ¯` |

#### ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®


> ğŸ“– **æ ¸å¿ƒåŸåˆ™**ï¼šåˆç†ä½¿ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œé¿å…é¢‘ç¹è°ƒç”¨ï¼Œé‡ç‚¹å…³æ³¨è¶…æ—¶æ£€æŸ¥ã€‚

```java
@XxlJob("optimizedJob")
public void optimizedJob() {
    XxlJobContext context = XxlJobContext.getXxlJobContext();
    
    // ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯
    JobContextInfo contextInfo = new JobContextInfo(context);
    
    int batchSize = 1000;
    int checkInterval = 100; // æ¯å¤„ç†100æ¡æ£€æŸ¥ä¸€æ¬¡è¶…æ—¶
    
    List<DataItem> dataItems = getDataItems(contextInfo.getShardIndex(), contextInfo.getShardTotal());
    
    for (int i = 0; i < dataItems.size(); i++) {
        // å®šæœŸæ£€æŸ¥è¶…æ—¶ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æ£€æŸ¥
        if (i % checkInterval == 0 && context.isTimeout()) {
            XxlJobContext.log("ä»»åŠ¡è¶…æ—¶ï¼Œå·²å¤„ç†: " + i + "/" + dataItems.size());
            break;
        }
        
        processDataItem(dataItems.get(i));
        
        // æ‰¹é‡è¾“å‡ºæ—¥å¿—
        if (i % batchSize == 0) {
            XxlJobContext.log("å¤„ç†è¿›åº¦: " + i + "/" + dataItems.size());
        }
    }
}

// ä¸Šä¸‹æ–‡ä¿¡æ¯å°è£…ç±»
private static class JobContextInfo {
    private final long jobId;
    private final String jobParam;
    private final int shardIndex;
    private final int shardTotal;
    
    public JobContextInfo(XxlJobContext context) {
        this.jobId = context.getJobId();
        this.jobParam = context.getJobParam();
        this.shardIndex = context.getShardIndex();
        this.shardTotal = context.getShardTotal();
    }
    
    // getter methods...
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä»»åŠ¡æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šä»»åŠ¡è¿è¡Œæ—¶çš„ç¯å¢ƒä¿¡æ¯å’Œå·¥å…·é›†åˆ
ğŸ”¸ XxlJobContextï¼šXXL-JOBæä¾›çš„ä¸Šä¸‹æ–‡è®¿é—®å·¥å…·ç±»
ğŸ”¸ åŸºç¡€ä¿¡æ¯ï¼šä»»åŠ¡IDã€ä»»åŠ¡å‚æ•°çš„è·å–å’Œä½¿ç”¨
ğŸ”¸ åˆ†ç‰‡å‚æ•°ï¼šåˆ†ç‰‡ç´¢å¼•å’Œæ€»æ•°ï¼Œç”¨äºå¹¶è¡Œå¤„ç†
ğŸ”¸ å¹¿æ’­ç´¢å¼•ï¼šèŠ‚ç‚¹ç´¢å¼•å’Œæ€»æ•°ï¼Œç”¨äºå…¨èŠ‚ç‚¹æ‰§è¡Œ
ğŸ”¸ è¶…æ—¶æ§åˆ¶ï¼šé€šè¿‡isTimeout()æ£€æŸ¥ä»»åŠ¡æ˜¯å¦è¶…æ—¶
ğŸ”¸ è‡ªå®šä¹‰æ—¥å¿—ï¼šä½¿ç”¨XxlJobContext.log()è¾“å‡ºæ‰§è¡Œæ—¥å¿—
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ**
```
ç†è§£è¦ç‚¹ï¼š
- ä¸Šä¸‹æ–‡åªåœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´æœ‰æ•ˆ
- ç”±æ¡†æ¶è‡ªåŠ¨åˆ›å»ºå’Œé”€æ¯
- æ¯ä¸ªä»»åŠ¡çº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡
- åœ¨æ™®é€šæ–¹æ³•ä¸­è°ƒç”¨ä¼šè¿”å›null
```

**ğŸ”¹ åˆ†ç‰‡ä¸å¹¿æ’­çš„åŒºåˆ«**
```
åˆ†ç‰‡ä»»åŠ¡ï¼š
- æ•°æ®è¢«åˆ†å‰²ï¼Œæ¯ä¸ªæ‰§è¡Œå™¨å¤„ç†ä¸åŒéƒ¨åˆ†
- ç”¨äºå¤§æ•°æ®é‡å¹¶è¡Œå¤„ç†
- æé«˜å¤„ç†æ•ˆç‡

å¹¿æ’­ä»»åŠ¡ï¼š
- æ‰€æœ‰æ‰§è¡Œå™¨éƒ½æ‰§è¡Œç›¸åŒä»»åŠ¡
- ç”¨äºé…ç½®æ›´æ–°ã€ç¼“å­˜åˆ·æ–°ç­‰åœºæ™¯
- ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´
```

**ğŸ”¹ è¶…æ—¶æ§åˆ¶çš„æ„ä¹‰**
```
æ ¸å¿ƒä½œç”¨ï¼š
- é˜²æ­¢ä»»åŠ¡é•¿æ—¶é—´å ç”¨èµ„æº
- æ”¯æŒä»»åŠ¡çš„ä¼˜é›…ç»ˆæ­¢
- æé«˜ç³»ç»Ÿæ•´ä½“ç¨³å®šæ€§
- ä¾¿äºé—®é¢˜æ’æŸ¥å’Œç›‘æ§
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


- **ğŸ“Š å¤§æ•°æ®å¤„ç†**ï¼šåˆ©ç”¨åˆ†ç‰‡å‚æ•°å®ç°å¹¶è¡Œæ•°æ®å¤„ç†
- **ğŸ”„ ç³»ç»Ÿç»´æŠ¤**ï¼šä½¿ç”¨å¹¿æ’­ä»»åŠ¡è¿›è¡Œé…ç½®æ›´æ–°å’Œç¼“å­˜åˆ·æ–°  
- **ğŸ” ç›‘æ§è°ƒè¯•**ï¼šé€šè¿‡è‡ªå®šä¹‰æ—¥å¿—å®ç°ä»»åŠ¡æ‰§è¡Œç›‘æ§
- **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†ä½¿ç”¨è¶…æ—¶æ§åˆ¶é¿å…èµ„æºæµªè´¹
- **ğŸ› ï¸ æ•…éšœå¤„ç†**ï¼šåŸºäºä¸Šä¸‹æ–‡ä¿¡æ¯è¿›è¡Œé”™è¯¯å®šä½å’Œæ¢å¤

**æ ¸å¿ƒè®°å¿†**ï¼š
- ä»»åŠ¡ä¸Šä¸‹æ–‡æ˜¯æ‰§è¡Œå™¨ä¸è°ƒåº¦ä¸­å¿ƒçš„ä¿¡æ¯æ¡¥æ¢
- åˆ†ç‰‡è®©å¤§ä»»åŠ¡å¹¶è¡Œå¤„ç†ï¼Œå¹¿æ’­è®©å…¨èŠ‚ç‚¹åŒæ­¥æ‰§è¡Œ
- å®šæœŸæ£€æŸ¥è¶…æ—¶ï¼ŒåŠæ—¶è¾“å‡ºæ—¥å¿—ï¼Œç¡®ä¿ä»»åŠ¡å¯æ§å¯è§‚æµ‹
- ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸€æ¬¡è·å–å¤šæ¬¡ä½¿ç”¨ï¼Œé¿å…é¢‘ç¹è°ƒç”¨å½±å“æ€§èƒ½