---
title: 12ã€ä¼ªé›†ç¾¤æ¨¡å¼éƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ä¼ªé›†ç¾¤æ¨¡å¼](#1-ä»€ä¹ˆæ˜¯ä¼ªé›†ç¾¤æ¨¡å¼)
2. [ä¼ªé›†ç¾¤éƒ¨ç½²å‡†å¤‡å·¥ä½œ](#2-ä¼ªé›†ç¾¤éƒ¨ç½²å‡†å¤‡å·¥ä½œ)
3. [myidæ–‡ä»¶è¯¦è§£](#3-myidæ–‡ä»¶è¯¦è§£)
4. [ç«¯å£é…ç½®è§„åˆ’](#4-ç«¯å£é…ç½®è§„åˆ’)
5. [æ•°æ®ç›®å½•è§„åˆ’](#5-æ•°æ®ç›®å½•è§„åˆ’)
6. [é…ç½®æ–‡ä»¶éš”ç¦»](#6-é…ç½®æ–‡ä»¶éš”ç¦»)
7. [å®Œæ•´éƒ¨ç½²å®æˆ˜](#7-å®Œæ•´éƒ¨ç½²å®æˆ˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯ä¼ªé›†ç¾¤æ¨¡å¼


### 1.1 é€šä¿—ç†è§£ä¼ªé›†ç¾¤


**æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”**ï¼š
```
çœŸå®é›†ç¾¤ = 3å°ç‹¬ç«‹ç”µè„‘ï¼Œæ¯å°è¿è¡Œä¸€ä¸ªZookeeper
ä¼ªé›†ç¾¤ = 1å°ç”µè„‘ï¼ŒåŒæ—¶è¿è¡Œ3ä¸ªZookeeperï¼ˆå‡è£…æ˜¯3å°ï¼‰

å°±åƒï¼š
- çœŸå®å‰§ç»„ï¼š3ä¸ªæ¼”å‘˜åˆ†åˆ«æ¼”3ä¸ªè§’è‰²
- ä¸€äººåˆ†é¥°ï¼š1ä¸ªæ¼”å‘˜åŒæ—¶æ¼”3ä¸ªè§’è‰²ï¼ˆæ¢è£…æ‰®æ¼”ï¼‰
```

**æŠ€æœ¯æ¦‚å¿µ**ï¼š
> ğŸ“– **ä¼ªé›†ç¾¤æ¨¡å¼**  
> åœ¨**ä¸€å°ç‰©ç†æœºå™¨**ä¸Šå¯åŠ¨**å¤šä¸ªZookeeperå®ä¾‹**ï¼Œæ¨¡æ‹ŸçœŸå®çš„é›†ç¾¤ç¯å¢ƒã€‚æ¯ä¸ªå®ä¾‹æœ‰ç‹¬ç«‹çš„é…ç½®ã€æ•°æ®ç›®å½•å’Œç«¯å£ï¼Œä½†å…±äº«åŒä¸€å°æœºå™¨çš„èµ„æºã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¼ªé›†ç¾¤


**ä½¿ç”¨åœºæ™¯**ï¼š

ğŸ“ **å­¦ä¹ æµ‹è¯•åœºæ™¯**
```
âœ… ä¼˜åŠ¿ï¼š
- æ²¡æœ‰å¤šå°æœåŠ¡å™¨ä¹Ÿèƒ½å­¦ä¹ é›†ç¾¤
- å¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒ
- èŠ‚çœç¡¬ä»¶æˆæœ¬

âŒ å±€é™ï¼š
- æ€§èƒ½å—é™äºå•æœº
- ä¸èƒ½æ¨¡æ‹ŸçœŸå®çš„ç½‘ç»œæ•…éšœ
- ç”Ÿäº§ç¯å¢ƒç»ä¸èƒ½ç”¨
```

ğŸ’¡ **å®é™…åº”ç”¨ä»·å€¼**
- **å¼€å‘è°ƒè¯•**ï¼šæœ¬åœ°éªŒè¯é›†ç¾¤åŠŸèƒ½
- **åŠŸèƒ½æµ‹è¯•**ï¼šæµ‹è¯•é€‰ä¸¾ã€æ•°æ®åŒæ­¥ç­‰æœºåˆ¶
- **å­¦ä¹ å®è·µ**ï¼šç†è§£é›†ç¾¤å·¥ä½œåŸç†

---

## 2. ğŸ”§ ä¼ªé›†ç¾¤éƒ¨ç½²å‡†å¤‡å·¥ä½œ


### 2.1 éƒ¨ç½²å‰çš„ç†è§£


**æ ¸å¿ƒæ€æƒ³**ï¼šä¸€å°æœºå™¨è¿è¡Œ3ä¸ªZookeeperï¼Œå®ƒä»¬è¦"å‡è£…"è‡ªå·±æ˜¯ç‹¬ç«‹çš„

```
ä¸€å°æœºå™¨éœ€è¦å‡†å¤‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç‰©ç†æœº (1å°)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ZKå®ä¾‹1  â”‚  ZKå®ä¾‹2  â”‚ ZKå®ä¾‹3 â”‚
â”‚  ç«¯å£2181 â”‚  ç«¯å£2182 â”‚ ç«¯å£2183â”‚
â”‚  ç›®å½•data1â”‚  ç›®å½•data2â”‚ ç›®å½•data3â”‚
â”‚  é…ç½®zoo1 â”‚  é…ç½®zoo2 â”‚ é…ç½®zoo3 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç¯å¢ƒæ£€æŸ¥æ¸…å•


ğŸ“‹ **éƒ¨ç½²æ£€æŸ¥è¡¨**
- [x] Javaç¯å¢ƒå·²å®‰è£…ï¼ˆJDK 8+ï¼‰
- [x] Zookeeperå®‰è£…åŒ…å·²è§£å‹
- [x] ç¡®è®¤å¯ç”¨ç«¯å£ï¼ˆæ¯ä¸ªå®ä¾‹éœ€è¦3ä¸ªç«¯å£ï¼‰
- [x] è§„åˆ’å¥½ç›®å½•ç»“æ„
- [x] äº†è§£é…ç½®æ–‡ä»¶ä½ç½®

**ç«¯å£éœ€æ±‚è¯´æ˜**ï¼š
```
æ¯ä¸ªZKå®ä¾‹éœ€è¦3ä¸ªç«¯å£ï¼š
ğŸ”Œ å®¢æˆ·ç«¯ç«¯å£ï¼šåº”ç”¨è¿æ¥ç”¨ï¼ˆå¦‚2181ï¼‰
ğŸ”Œ é€‰ä¸¾ç«¯å£ï¼šé€‰ä¸¾Leaderç”¨ï¼ˆå¦‚3881ï¼‰
ğŸ”Œ æ•°æ®ç«¯å£ï¼šæ•°æ®åŒæ­¥ç”¨ï¼ˆå¦‚2881ï¼‰

3ä¸ªå®ä¾‹ Ã— 3ä¸ªç«¯å£ = å…±éœ€9ä¸ªç«¯å£
```

---

## 3. ğŸ“ myidæ–‡ä»¶è¯¦è§£


### 3.1 myidæ–‡ä»¶æ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼š
> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> myidæ–‡ä»¶å°±åƒæ˜¯æ¯ä¸ªZookeeperçš„"èº«ä»½è¯å·"ï¼Œè®©å®ƒçŸ¥é“"æˆ‘æ˜¯è°"

```
èº«ä»½è¯åœºæ™¯ï¼š
å¼ ä¸‰çš„èº«ä»½è¯å·ï¼š1
æå››çš„èº«ä»½è¯å·ï¼š2  
ç‹äº”çš„èº«ä»½è¯å·ï¼š3

Zookeeperåœºæ™¯ï¼š
å®ä¾‹1çš„myidï¼š1
å®ä¾‹2çš„myidï¼š2
å®ä¾‹3çš„myidï¼š3
```

### 3.2 myidæ–‡ä»¶å†…å®¹


**æ–‡ä»¶æ ¼å¼**ï¼š
```
myidæ–‡ä»¶å†…å®¹æå…¶ç®€å•ï¼Œå°±ä¸€ä¸ªæ•°å­—ï¼

å®ä¾‹1çš„myidæ–‡ä»¶ï¼š
1

å®ä¾‹2çš„myidæ–‡ä»¶ï¼š
2

å®ä¾‹3çš„myidæ–‡ä»¶ï¼š
3
```

> âš ï¸ **é‡è¦æç¤º**  
> - myidæ–‡ä»¶åªæœ‰**ä¸€è¡Œ**ï¼Œåªæœ‰**ä¸€ä¸ªæ•°å­—**
> - æ•°å­—èŒƒå›´ï¼š1-255
> - ä¸èƒ½æœ‰ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰å…¶ä»–å†…å®¹
> - å¿…é¡»ä¸é…ç½®æ–‡ä»¶ä¸­çš„server.Xå¯¹åº”

### 3.3 myidçš„ä½œç”¨åŸç†


**å·¥ä½œæœºåˆ¶**ï¼š
```
å¯åŠ¨è¿‡ç¨‹ï¼š
1ï¸âƒ£ Zookeeperå¯åŠ¨æ—¶è¯»å–myidæ–‡ä»¶
2ï¸âƒ£ çŸ¥é“è‡ªå·±çš„IDæ˜¯å‡ å·
3ï¸âƒ£ å»é…ç½®æ–‡ä»¶æ‰¾å¯¹åº”çš„server.Xé…ç½®
4ï¸âƒ£ ç¡®å®šè‡ªå·±çš„ç«¯å£å’Œè§’è‰²

ç¤ºä¾‹ï¼š
myid=2 â†’ å»æ‰¾server.2çš„é…ç½® â†’ çŸ¥é“è‡ªå·±ç›‘å¬å“ªäº›ç«¯å£
```

---

## 4. ğŸ”Œ ç«¯å£é…ç½®è§„åˆ’


### 4.1 ç«¯å£ç±»å‹è¯´æ˜


**ä¸‰ç§ç«¯å£çš„ä½œç”¨**ï¼š

| ç«¯å£ç±»å‹ | **ä½œç”¨è¯´æ˜** | **ä½¿ç”¨åœºæ™¯** | **é»˜è®¤ç«¯å£** |
|---------|------------|-------------|-------------|
| ğŸ”Œ **å®¢æˆ·ç«¯ç«¯å£** | åº”ç”¨ç¨‹åºè¿æ¥Zookeeper | è¯»å†™æ•°æ®ã€ç›‘å¬å˜åŒ– | 2181 |
| ğŸ”Œ **æ•°æ®åŒæ­¥ç«¯å£** | Followerè¿æ¥LeaderåŒæ­¥æ•°æ® | é›†ç¾¤æ•°æ®å¤åˆ¶ | 2888 |
| ğŸ”Œ **é€‰ä¸¾ç«¯å£** | é›†ç¾¤æˆå‘˜é—´é€‰ä¸¾é€šä¿¡ | Leaderé€‰ä¸¾æŠ•ç¥¨ | 3888 |

**å½¢è±¡ç†è§£**ï¼š
```
å®¢æˆ·ç«¯ç«¯å£ = è¥ä¸šçª—å£ï¼ˆå¯¹å¤–æœåŠ¡ï¼‰
æ•°æ®ç«¯å£ = å†…éƒ¨ä¼ é€å¸¦ï¼ˆæ•°æ®åŒæ­¥ï¼‰
é€‰ä¸¾ç«¯å£ = æŠ•ç¥¨ç®±ï¼ˆé€‰ä¸¾Leaderï¼‰
```

### 4.2 ä¼ªé›†ç¾¤ç«¯å£è§„åˆ’ç¤ºä¾‹


**ç«¯å£åˆ†é…æ–¹æ¡ˆ**ï¼š
```
å®ä¾‹1ï¼ˆserver.1ï¼‰:
â”œâ”€ å®¢æˆ·ç«¯ç«¯å£ï¼š2181
â”œâ”€ æ•°æ®åŒæ­¥ç«¯å£ï¼š2881  
â””â”€ é€‰ä¸¾ç«¯å£ï¼š3881

å®ä¾‹2ï¼ˆserver.2ï¼‰:
â”œâ”€ å®¢æˆ·ç«¯ç«¯å£ï¼š2182
â”œâ”€ æ•°æ®åŒæ­¥ç«¯å£ï¼š2882
â””â”€ é€‰ä¸¾ç«¯å£ï¼š3882

å®ä¾‹3ï¼ˆserver.3ï¼‰:
â”œâ”€ å®¢æˆ·ç«¯ç«¯å£ï¼š2183
â”œâ”€ æ•°æ®åŒæ­¥ç«¯å£ï¼š2883
â””â”€ é€‰ä¸¾ç«¯å£ï¼š3883
```

> ğŸ’¡ **ç«¯å£è§„åˆ’æŠ€å·§**  
> - å®¢æˆ·ç«¯ç«¯å£ï¼š2181, 2182, 2183ï¼ˆè¿ç»­é€’å¢ï¼‰
> - æ•°æ®ç«¯å£ï¼š2881, 2882, 2883ï¼ˆç™¾ä½æ•°é€’å¢ï¼‰
> - é€‰ä¸¾ç«¯å£ï¼š3881, 3882, 3883ï¼ˆåƒä½æ•°é€’å¢ï¼‰
> - è§„å¾‹æ¸…æ™°ï¼Œä¾¿äºè®°å¿†å’Œç®¡ç†

---

## 5. ğŸ“‚ æ•°æ®ç›®å½•è§„åˆ’


### 5.1 ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç›®å½•


**ç›®å½•éš”ç¦»çš„å¿…è¦æ€§**ï¼š
```
âŒ é”™è¯¯åšæ³•ï¼š3ä¸ªå®ä¾‹å…±ç”¨ä¸€ä¸ªç›®å½•
â”œâ”€ data/
â”‚   â”œâ”€ version-2/
â”‚   â””â”€ myidï¼ˆåªæœ‰ä¸€ä¸ªï¼Œä¼šå†²çªï¼ï¼‰

âœ… æ­£ç¡®åšæ³•ï¼šæ¯ä¸ªå®ä¾‹ç‹¬ç«‹ç›®å½•
â”œâ”€ data1/ï¼ˆå®ä¾‹1ä¸“ç”¨ï¼‰
â”‚   â”œâ”€ version-2/
â”‚   â””â”€ myidï¼ˆå†…å®¹ï¼š1ï¼‰
â”œâ”€ data2/ï¼ˆå®ä¾‹2ä¸“ç”¨ï¼‰
â”‚   â”œâ”€ version-2/
â”‚   â””â”€ myidï¼ˆå†…å®¹ï¼š2ï¼‰
â””â”€ data3/ï¼ˆå®ä¾‹3ä¸“ç”¨ï¼‰
    â”œâ”€ version-2/
    â””â”€ myidï¼ˆå†…å®¹ï¼š3ï¼‰
```

### 5.2 ç›®å½•ç»“æ„è§„åˆ’


**å®Œæ•´ç›®å½•è®¾è®¡**ï¼š
```
zookeeper-cluster/ï¼ˆä¼ªé›†ç¾¤æ ¹ç›®å½•ï¼‰
â”‚
â”œâ”€ zookeeper/ï¼ˆZKç¨‹åºç›®å½•ï¼‰
â”‚   â”œâ”€ bin/
â”‚   â”œâ”€ conf/
â”‚   â””â”€ lib/
â”‚
â”œâ”€ data1/ï¼ˆå®ä¾‹1æ•°æ®ï¼‰
â”‚   â”œâ”€ myid
â”‚   â””â”€ version-2/
â”‚
â”œâ”€ data2/ï¼ˆå®ä¾‹2æ•°æ®ï¼‰
â”‚   â”œâ”€ myid
â”‚   â””â”€ version-2/
â”‚
â”œâ”€ data3/ï¼ˆå®ä¾‹3æ•°æ®ï¼‰
â”‚   â”œâ”€ myid
â”‚   â””â”€ version-2/
â”‚
â”œâ”€ logs1/ï¼ˆå®ä¾‹1æ—¥å¿—ï¼‰
â”œâ”€ logs2/ï¼ˆå®ä¾‹2æ—¥å¿—ï¼‰
â””â”€ logs3/ï¼ˆå®ä¾‹3æ—¥å¿—ï¼‰
```

### 5.3 åˆ›å»ºç›®å½•å®æˆ˜


**æ“ä½œå‘½ä»¤**ï¼š
```bash
# åˆ›å»ºæ ¹ç›®å½•
mkdir -p /opt/zookeeper-cluster

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /opt/zookeeper-cluster/data1
mkdir -p /opt/zookeeper-cluster/data2
mkdir -p /opt/zookeeper-cluster/data3

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p /opt/zookeeper-cluster/logs1
mkdir -p /opt/zookeeper-cluster/logs2
mkdir -p /opt/zookeeper-cluster/logs3

# åˆ›å»ºmyidæ–‡ä»¶
echo "1" > /opt/zookeeper-cluster/data1/myid
echo "2" > /opt/zookeeper-cluster/data2/myid
echo "3" > /opt/zookeeper-cluster/data3/myid
```

---

## 6. âš™ï¸ é…ç½®æ–‡ä»¶éš”ç¦»


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç‹¬ç«‹é…ç½®


**é…ç½®éš”ç¦»çš„åŸå› **ï¼š
```
æ¯ä¸ªå®ä¾‹éœ€è¦ä¸åŒçš„é…ç½®ï¼š
ğŸ”¸ æ•°æ®ç›®å½•ä¸åŒï¼ˆdata1ã€data2ã€data3ï¼‰
ğŸ”¸ å®¢æˆ·ç«¯ç«¯å£ä¸åŒï¼ˆ2181ã€2182ã€2183ï¼‰
ğŸ”¸ æ—¥å¿—ç›®å½•ä¸åŒï¼ˆlogs1ã€logs2ã€logs3ï¼‰

æ‰€ä»¥å¿…é¡»æœ‰ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼
```

### 6.2 é…ç½®æ–‡ä»¶å†…å®¹è¯¦è§£


**å®ä¾‹1é…ç½®ï¼ˆzoo1.cfgï¼‰**ï¼š
```properties
# åŸºç¡€é…ç½®
tickTime=2000
initLimit=10
syncLimit=5

# å®ä¾‹1çš„ç‹¬ç«‹é…ç½®
dataDir=/opt/zookeeper-cluster/data1
dataLogDir=/opt/zookeeper-cluster/logs1
clientPort=2181

# é›†ç¾¤é…ç½®ï¼ˆæ‰€æœ‰å®ä¾‹ç›¸åŒï¼‰
server.1=localhost:2881:3881
server.2=localhost:2882:3882
server.3=localhost:2883:3883
```

**å®ä¾‹2é…ç½®ï¼ˆzoo2.cfgï¼‰**ï¼š
```properties
# åŸºç¡€é…ç½®ï¼ˆä¸å®ä¾‹1ç›¸åŒï¼‰
tickTime=2000
initLimit=10
syncLimit=5

# å®ä¾‹2çš„ç‹¬ç«‹é…ç½®
dataDir=/opt/zookeeper-cluster/data2
dataLogDir=/opt/zookeeper-cluster/logs2
clientPort=2182

# é›†ç¾¤é…ç½®ï¼ˆä¸å®ä¾‹1ç›¸åŒï¼‰
server.1=localhost:2881:3881
server.2=localhost:2882:3882
server.3=localhost:2883:3883
```

**å®ä¾‹3é…ç½®ï¼ˆzoo3.cfgï¼‰**ï¼š
```properties
# åŸºç¡€é…ç½®ï¼ˆä¸å®ä¾‹1ç›¸åŒï¼‰
tickTime=2000
initLimit=10
syncLimit=5

# å®ä¾‹3çš„ç‹¬ç«‹é…ç½®
dataDir=/opt/zookeeper-cluster/data3
dataLogDir=/opt/zookeeper-cluster/logs3
clientPort=2183

# é›†ç¾¤é…ç½®ï¼ˆä¸å®ä¾‹1ç›¸åŒï¼‰
server.1=localhost:2881:3881
server.2=localhost:2882:3882
server.3=localhost:2883:3883
```

### 6.3 é…ç½®å‚æ•°é€šä¿—è§£é‡Š


**å…³é”®å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **å«ä¹‰** | **é€šä¿—ç†è§£** |
|-----|---------|------------|
| `tickTime` | åŸºæœ¬æ—¶é—´å•ä½ï¼ˆæ¯«ç§’ï¼‰ | ZKçš„"å¿ƒè·³é—´éš”"ï¼Œåƒé’Ÿè¡¨çš„æ»´ç­”å£° |
| `initLimit` | åˆå§‹åŒ–è¿æ¥è¶…æ—¶æ—¶é—´ | æ–°æˆå‘˜åŠ å…¥é›†ç¾¤çš„æœ€é•¿ç­‰å¾…æ—¶é—´ |
| `syncLimit` | æ•°æ®åŒæ­¥è¶…æ—¶æ—¶é—´ | æ•°æ®å¤åˆ¶çš„æœ€é•¿ç­‰å¾…æ—¶é—´ |
| `dataDir` | æ•°æ®å­˜å‚¨ç›®å½• | å­˜æ”¾myidå’Œå¿«ç…§æ–‡ä»¶ |
| `dataLogDir` | æ—¥å¿—å­˜å‚¨ç›®å½• | å­˜æ”¾äº‹åŠ¡æ—¥å¿— |
| `clientPort` | å®¢æˆ·ç«¯è¿æ¥ç«¯å£ | åº”ç”¨ç¨‹åºè¿æ¥çš„ç«¯å£ |
| `server.X` | é›†ç¾¤æˆå‘˜é…ç½® | æ ¼å¼ï¼šserver.X=IP:æ•°æ®ç«¯å£:é€‰ä¸¾ç«¯å£ |

**server.Xé…ç½®è§£è¯»**ï¼š
```
server.1=localhost:2881:3881
  â”‚      â”‚         â”‚    â”‚
  â”‚      â”‚         â”‚    â””â”€ é€‰ä¸¾ç«¯å£
  â”‚      â”‚         â””â”€â”€â”€â”€â”€â”€ æ•°æ®åŒæ­¥ç«¯å£
  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IPåœ°å€ï¼ˆä¼ªé›†ç¾¤ç”¨localhostï¼‰
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœåŠ¡å™¨ç¼–å·ï¼ˆå¯¹åº”myidï¼‰
```

---

## 7. ğŸš€ å®Œæ•´éƒ¨ç½²å®æˆ˜


### 7.1 éƒ¨ç½²æ­¥éª¤æ€»è§ˆ


**éƒ¨ç½²æµç¨‹å›¾**ï¼š
```
å‡†å¤‡å·¥ä½œ â”€â”€> åˆ›å»ºç›®å½• â”€â”€> åˆ›å»ºmyid â”€â”€> ç¼–å†™é…ç½® â”€â”€> å¯åŠ¨é›†ç¾¤ â”€â”€> éªŒè¯
   â†“           â†“           â†“           â†“           â†“         â†“
 æ£€æŸ¥ç¯å¢ƒ    9ä¸ªç›®å½•     3ä¸ªæ–‡ä»¶     3ä¸ªé…ç½®    ä¾æ¬¡å¯åŠ¨   æŸ¥çœ‹çŠ¶æ€
```

### 7.2 è¯¦ç»†éƒ¨ç½²æ­¥éª¤


**æ­¥éª¤â‘  åˆ›å»ºå®Œæ•´ç›®å½•ç»“æ„**ï¼š
```bash
# ä¸€é”®åˆ›å»ºæ‰€æœ‰ç›®å½•
mkdir -p /opt/zookeeper-cluster/{data1,data2,data3,logs1,logs2,logs3}

# éªŒè¯ç›®å½•ç»“æ„
tree /opt/zookeeper-cluster
```

**æ­¥éª¤â‘¡ åˆ›å»ºmyidæ–‡ä»¶**ï¼š
```bash
# åˆ›å»º3ä¸ªmyidæ–‡ä»¶
echo "1" > /opt/zookeeper-cluster/data1/myid
echo "2" > /opt/zookeeper-cluster/data2/myid
echo "3" > /opt/zookeeper-cluster/data3/myid

# éªŒè¯myidå†…å®¹
cat /opt/zookeeper-cluster/data1/myid  # è¾“å‡ºï¼š1
cat /opt/zookeeper-cluster/data2/myid  # è¾“å‡ºï¼š2
cat /opt/zookeeper-cluster/data3/myid  # è¾“å‡ºï¼š3
```

**æ­¥éª¤â‘¢ åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼š
```bash
# è¿›å…¥ZKé…ç½®ç›®å½•
cd /opt/zookeeper/conf

# å¤åˆ¶æ¨¡æ¿åˆ›å»º3ä¸ªé…ç½®æ–‡ä»¶
cp zoo_sample.cfg zoo1.cfg
cp zoo_sample.cfg zoo2.cfg
cp zoo_sample.cfg zoo3.cfg

# ç¼–è¾‘æ¯ä¸ªé…ç½®æ–‡ä»¶ï¼ˆå‚è€ƒ6.2èŠ‚å†…å®¹ï¼‰
vim zoo1.cfg
vim zoo2.cfg
vim zoo3.cfg
```

**æ­¥éª¤â‘£ å¯åŠ¨é›†ç¾¤**ï¼š
```bash
# å¯åŠ¨å®ä¾‹1
/opt/zookeeper/bin/zkServer.sh start /opt/zookeeper/conf/zoo1.cfg

# å¯åŠ¨å®ä¾‹2
/opt/zookeeper/bin/zkServer.sh start /opt/zookeeper/conf/zoo2.cfg

# å¯åŠ¨å®ä¾‹3
/opt/zookeeper/bin/zkServer.sh start /opt/zookeeper/conf/zoo3.cfg
```

**æ­¥éª¤â‘¤ éªŒè¯é›†ç¾¤çŠ¶æ€**ï¼š
```bash
# æŸ¥çœ‹å®ä¾‹1çŠ¶æ€
/opt/zookeeper/bin/zkServer.sh status /opt/zookeeper/conf/zoo1.cfg
# è¾“å‡ºï¼šMode: followerï¼ˆæˆ–leaderï¼‰

# æŸ¥çœ‹å®ä¾‹2çŠ¶æ€
/opt/zookeeper/bin/zkServer.sh status /opt/zookeeper/conf/zoo2.cfg
# è¾“å‡ºï¼šMode: leaderï¼ˆæˆ–followerï¼‰

# æŸ¥çœ‹å®ä¾‹3çŠ¶æ€
/opt/zookeeper/bin/zkServer.sh status /opt/zookeeper/conf/zoo3.cfg
# è¾“å‡ºï¼šMode: followerï¼ˆæˆ–leaderï¼‰
```

### 7.3 éªŒè¯é›†ç¾¤åŠŸèƒ½


**åŠŸèƒ½æµ‹è¯•**ï¼š
```bash
# 1. è¿æ¥åˆ°å®ä¾‹1å†™å…¥æ•°æ®
/opt/zookeeper/bin/zkCli.sh -server localhost:2181
create /test "hello cluster"

# 2. è¿æ¥åˆ°å®ä¾‹2è¯»å–æ•°æ®
/opt/zookeeper/bin/zkCli.sh -server localhost:2182
get /test
# è¾“å‡ºï¼šhello clusterï¼ˆè¯æ˜æ•°æ®å·²åŒæ­¥ï¼ï¼‰

# 3. è¿æ¥åˆ°å®ä¾‹3éªŒè¯
/opt/zookeeper/bin/zkCli.sh -server localhost:2183
get /test
# è¾“å‡ºï¼šhello clusterï¼ˆ3ä¸ªå®ä¾‹æ•°æ®ä¸€è‡´ï¼ï¼‰
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 ä¼ªé›†ç¾¤æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æœ¬è´¨ï¼šä¸€å°æœºå™¨è¿è¡Œå¤šä¸ªZKå®ä¾‹ï¼Œæ¨¡æ‹Ÿé›†ç¾¤ç¯å¢ƒ
ğŸ”¸ ç›®çš„ï¼šå­¦ä¹ æµ‹è¯•ï¼Œä¸èƒ½ç”¨äºç”Ÿäº§ç¯å¢ƒ
ğŸ”¸ å…³é”®ï¼šæ¯ä¸ªå®ä¾‹å¿…é¡»å®Œå…¨éš”ç¦»ï¼ˆé…ç½®ã€ç›®å½•ã€ç«¯å£ï¼‰
ğŸ”¸ è¯†åˆ«ï¼šé€šè¿‡myidæ–‡ä»¶ç¡®å®šå®ä¾‹èº«ä»½
```

### 8.2 é…ç½®è¦ç‚¹è®°å¿†


**å››å¤§éš”ç¦»åŸåˆ™**ï¼š
```
1ï¸âƒ£ é…ç½®éš”ç¦»ï¼šæ¯ä¸ªå®ä¾‹ç‹¬ç«‹é…ç½®æ–‡ä»¶
   zoo1.cfgã€zoo2.cfgã€zoo3.cfg

2ï¸âƒ£ ç›®å½•éš”ç¦»ï¼šæ•°æ®å’Œæ—¥å¿—åˆ†å¼€å­˜æ”¾
   data1/ã€data2/ã€data3/

3ï¸âƒ£ ç«¯å£éš”ç¦»ï¼š9ä¸ªç«¯å£äº’ä¸å†²çª
   å®¢æˆ·ç«¯ï¼š2181/2182/2183
   æ•°æ®ï¼š2881/2882/2883
   é€‰ä¸¾ï¼š3881/3882/3883

4ï¸âƒ£ èº«ä»½éš”ç¦»ï¼šmyidæ–‡ä»¶å”¯ä¸€æ ‡è¯†
   myid=1ã€myid=2ã€myid=3
```

### 8.3 å¸¸è§é—®é¢˜æ’æŸ¥


**é—®é¢˜è¯Šæ–­è¡¨**ï¼š

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ³•** |
|---------|------------|------------|
| å¯åŠ¨å¤±è´¥ | ç«¯å£è¢«å ç”¨ | æ£€æŸ¥ç«¯å£ï¼Œä¿®æ”¹é…ç½® |
| æ— æ³•é€‰ä¸¾ | myidé…ç½®é”™è¯¯ | æ£€æŸ¥myidä¸server.Xæ˜¯å¦å¯¹åº” |
| æ•°æ®ä¸åŒæ­¥ | é›†ç¾¤é…ç½®ä¸ä¸€è‡´ | ç¡®ä¿server.Xé…ç½®å®Œå…¨ç›¸åŒ |
| è¿æ¥è¶…æ—¶ | é˜²ç«å¢™æ‹¦æˆª | å…³é—­é˜²ç«å¢™æˆ–å¼€æ”¾ç«¯å£ |

### 8.4 å®æˆ˜æ£€æŸ¥æ¸…å•


ğŸ“‹ **éƒ¨ç½²åæ£€æŸ¥**
- [ ] 3ä¸ªmyidæ–‡ä»¶å†…å®¹æ­£ç¡®ï¼ˆ1ã€2ã€3ï¼‰
- [ ] 3ä¸ªé…ç½®æ–‡ä»¶ç›®å½•è·¯å¾„æ­£ç¡®
- [ ] 9ä¸ªç«¯å£å…¨éƒ¨ä¸åŒä¸”æœªè¢«å ç”¨
- [ ] å¯åŠ¨åæœ‰1ä¸ªLeaderã€2ä¸ªFollower
- [ ] æ•°æ®èƒ½åœ¨3ä¸ªå®ä¾‹é—´åŒæ­¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ§  **ä¼ªé›†ç¾¤éƒ¨ç½²å››æ­¥èµ°**  
> ä¸€åˆ›ç›®å½•äºŒå†™IDï¼Œä¸‰æ”¹é…ç½®å››å¯åŠ¨  
> ç«¯å£ç›®å½•è¦éš”ç¦»ï¼Œé›†ç¾¤é…ç½®éœ€ä¸€è‡´  
> æ•°æ®åŒæ­¥éªŒåŠŸèƒ½ï¼Œä¸€ä¸»ä¸¤ä»é€‰ä¸¾æˆ

---

## é™„å½•ï¼šå¿«é€Ÿå¯åŠ¨è„šæœ¬


**ä¾¿æ·ç®¡ç†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# start-cluster.sh - ä¸€é”®å¯åŠ¨ä¼ªé›†ç¾¤

ZK_HOME=/opt/zookeeper
CONF_DIR=$ZK_HOME/conf

echo "æ­£åœ¨å¯åŠ¨Zookeeperä¼ªé›†ç¾¤..."

# å¯åŠ¨3ä¸ªå®ä¾‹
$ZK_HOME/bin/zkServer.sh start $CONF_DIR/zoo1.cfg
sleep 2
$ZK_HOME/bin/zkServer.sh start $CONF_DIR/zoo2.cfg
sleep 2
$ZK_HOME/bin/zkServer.sh start $CONF_DIR/zoo3.cfg
sleep 2

# æŸ¥çœ‹çŠ¶æ€
echo "======== é›†ç¾¤çŠ¶æ€ ========"
$ZK_HOME/bin/zkServer.sh status $CONF_DIR/zoo1.cfg
$ZK_HOME/bin/zkServer.sh status $CONF_DIR/zoo2.cfg
$ZK_HOME/bin/zkServer.sh status $CONF_DIR/zoo3.cfg
```

**åœæ­¢é›†ç¾¤è„šæœ¬**ï¼š
```bash
#!/bin/bash
# stop-cluster.sh - ä¸€é”®åœæ­¢ä¼ªé›†ç¾¤

ZK_HOME=/opt/zookeeper
CONF_DIR=$ZK_HOME/conf

echo "æ­£åœ¨åœæ­¢Zookeeperä¼ªé›†ç¾¤..."

$ZK_HOME/bin/zkServer.sh stop $CONF_DIR/zoo1.cfg
$ZK_HOME/bin/zkServer.sh stop $CONF_DIR/zoo2.cfg
$ZK_HOME/bin/zkServer.sh stop $CONF_DIR/zoo3.cfg

echo "é›†ç¾¤å·²åœæ­¢"
```