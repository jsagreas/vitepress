---
title: 21ã€é…ç½®ä¸­å¿ƒå®ç°
---
## ğŸ“š ç›®å½•


1. [é…ç½®ä¸­å¿ƒåŸºç¡€æ¦‚å¿µ](#1-é…ç½®ä¸­å¿ƒåŸºç¡€æ¦‚å¿µ)
2. [é›†ä¸­é…ç½®å­˜å‚¨](#2-é›†ä¸­é…ç½®å­˜å‚¨)
3. [åŠ¨æ€é…ç½®æ›´æ–°](#3-åŠ¨æ€é…ç½®æ›´æ–°)
4. [é…ç½®ç‰ˆæœ¬ç®¡ç†](#4-é…ç½®ç‰ˆæœ¬ç®¡ç†)
5. [é…ç½®æ¨é€æœºåˆ¶](#5-é…ç½®æ¨é€æœºåˆ¶)
6. [å®¹é”™å¤„ç†ç­–ç•¥](#6-å®¹é”™å¤„ç†ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šZookeeperåŸºç¡€æ¦‚å¿µã€Watchæœºåˆ¶ â†’ **å½“å‰å†…å®¹**ï¼šé…ç½®ä¸­å¿ƒå®ç° â†’ **åç»­å­¦ä¹ **ï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« 40åˆ†é’Ÿ | å®è·µ30åˆ†é’Ÿ

ğŸŸ¢ **éš¾åº¦ç­‰çº§**ï¼šè¿›é˜¶çº§ | **é‡è¦ç¨‹åº¦**ï¼šâ˜…â˜…â˜…â˜…â˜…

---

## 1. ğŸ—ï¸ é…ç½®ä¸­å¿ƒåŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ä¸­å¿ƒ



**ğŸ“ é€šä¿—ç†è§£**
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶è¿é”é¤å…ï¼š
- **ä¼ ç»Ÿæ–¹å¼**ï¼šæ¯ä¸ªåˆ†åº—çš„èœå•ã€ä»·æ ¼éƒ½è¦åº—é•¿æ‰‹åŠ¨æ›´æ–°
- **é…ç½®ä¸­å¿ƒ**ï¼šæ€»éƒ¨ç»Ÿä¸€ç®¡ç†ï¼Œæ‰€æœ‰åˆ†åº—è‡ªåŠ¨åŒæ­¥æœ€æ–°ä¿¡æ¯

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼š
- **é…ç½®ä¸­å¿ƒ** = ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æœåŠ¡é…ç½®çš„"æ€»éƒ¨"
- **å„ä¸ªæœåŠ¡** = ä»æ€»éƒ¨è·å–é…ç½®çš„"åˆ†åº—"

```
ä¼ ç»Ÿé…ç½®æ–¹å¼çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  é…ç½®æ–‡ä»¶åœ¨æœ¬åœ°
â”‚ æœåŠ¡A    â”‚  ä¿®æ”¹è¦é‡å¯ âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ¯ä¸ªæœåŠ¡ç‹¬ç«‹é…ç½®
â”‚ æœåŠ¡B    â”‚  ç®¡ç†æ··ä¹± âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  é…ç½®åˆ†æ•£
â”‚ æœåŠ¡C    â”‚  éš¾ä»¥ç»Ÿä¸€ âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼š
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  é…ç½®ä¸­å¿ƒ     â”‚ â† ç»Ÿä¸€ç®¡ç† âœ…
         â”‚  (Zookeeper) â”‚ â† å®æ—¶æ›´æ–° âœ…
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â† ç‰ˆæœ¬æ§åˆ¶ âœ…
            â†“   â†“   â†“
         æœåŠ¡A æœåŠ¡B æœåŠ¡C
```

### 1.2 é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒä»·å€¼



**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

| **é—®é¢˜** | **ä¼ ç»Ÿæ–¹å¼** | **é…ç½®ä¸­å¿ƒæ–¹æ¡ˆ** |
|---------|------------|----------------|
| **é…ç½®ä¿®æ”¹** | æ”¹æ–‡ä»¶é‡å¯æœåŠ¡ â±ï¸ | å®æ—¶ç”Ÿæ•ˆæ— éœ€é‡å¯ âš¡ |
| **å¤šç¯å¢ƒç®¡ç†** | æ‰‹åŠ¨ç»´æŠ¤å¤šä»½é…ç½® ğŸ˜« | ç»Ÿä¸€ç®¡ç†è‡ªåŠ¨åˆ‡æ¢ âœ¨ |
| **é…ç½®ä¸€è‡´æ€§** | å®¹æ˜“ä¸åŒæ­¥å‡ºé”™ âŒ | ä¿è¯æ‰€æœ‰æœåŠ¡ä¸€è‡´ âœ… |
| **å›æ»šèƒ½åŠ›** | æ‰‹åŠ¨å¤‡ä»½æ¢å¤ ğŸ¤¦ | ç‰ˆæœ¬ç®¡ç†ä¸€é”®å›æ»š ğŸ”„ |

### 1.3 Zookeeperåšé…ç½®ä¸­å¿ƒçš„ä¼˜åŠ¿



**ğŸ”¸ ä¸ºä»€ä¹ˆé€‰æ‹©Zookeeper**
```
å¤©ç„¶ä¼˜åŠ¿ï¼š
âœ… æ•°æ®ç›‘å¬ï¼ˆWatchæœºåˆ¶ï¼‰â†’ é…ç½®å˜æ›´è‡ªåŠ¨é€šçŸ¥
âœ… å¼ºä¸€è‡´æ€§ä¿è¯ â†’ æ‰€æœ‰æœåŠ¡çœ‹åˆ°çš„é…ç½®ç›¸åŒ
âœ… é«˜å¯ç”¨é›†ç¾¤ â†’ é…ç½®æœåŠ¡ä¸ä¼šå®•æœº
âœ… æ ‘å½¢ç»“æ„ â†’ å¤©ç„¶æ”¯æŒé…ç½®åˆ†å±‚ç®¡ç†

å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆï¼š
Apollo/Nacosï¼šåŠŸèƒ½æ›´å…¨ï¼Œä½†æ›´å¤æ‚
Spring Cloud Configï¼šä¾èµ–Gitï¼Œå®æ—¶æ€§ç¨å·®
Zookeeperï¼šè½»é‡çº§ï¼Œå®æ—¶æ€§å¥½ï¼Œå­¦ä¹ æˆæœ¬ä½
```

---

## 2. ğŸ“¦ é›†ä¸­é…ç½®å­˜å‚¨



### 2.1 é…ç½®å­˜å‚¨ç»“æ„è®¾è®¡



**ğŸ—‚ï¸ æ ‘å½¢ç›®å½•è§„åˆ’**
```
é…ç½®å­˜å‚¨çš„å…³é”®ï¼šåˆç†çš„ç›®å½•ç»“æ„

å…¸å‹ç»“æ„è®¾è®¡ï¼š
/config                          # é…ç½®æ ¹èŠ‚ç‚¹
  /app-name                      # åº”ç”¨åç§°
    /dev                         # å¼€å‘ç¯å¢ƒ
      /database                  # æ•°æ®åº“é…ç½®
      /redis                     # Redisé…ç½®
      /common                    # é€šç”¨é…ç½®
    /test                        # æµ‹è¯•ç¯å¢ƒ
    /prod                        # ç”Ÿäº§ç¯å¢ƒ

å®é™…æ¡ˆä¾‹ï¼š
/config
  /order-service               # è®¢å•æœåŠ¡
    /prod                      
      /database               # å­˜å‚¨ï¼šjdbc:mysql://...
      /cache                  # å­˜å‚¨ï¼šredisé…ç½®
    /dev
      /database
  /user-service               # ç”¨æˆ·æœåŠ¡
    /prod
    /dev
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
- **æŒ‰åº”ç”¨éš”ç¦»**ï¼šä¸åŒæœåŠ¡é…ç½®äº’ä¸å¹²æ‰°
- **æŒ‰ç¯å¢ƒåˆ†å±‚**ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç‹¬ç«‹ç®¡ç†
- **æŒ‰åŠŸèƒ½åˆ†ç±»**ï¼šæ•°æ®åº“ã€ç¼“å­˜ã€MQç­‰åˆ†å¼€å­˜å‚¨

### 2.2 é…ç½®æ•°æ®æ ¼å¼é€‰æ‹©



**ğŸ“ å¸¸ç”¨æ ¼å¼å¯¹æ¯”**

```
æ–¹å¼ä¸€ï¼šçº¯æ–‡æœ¬å­˜å‚¨
èŠ‚ç‚¹ï¼š/config/order-service/prod/database
æ•°æ®ï¼šjdbc:mysql://localhost:3306/order
ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚
ç¼ºç‚¹ï¼šå¤æ‚é…ç½®ä¸å¥½ç®¡ç†

æ–¹å¼äºŒï¼šJSONæ ¼å¼
èŠ‚ç‚¹ï¼š/config/order-service/prod/database  
æ•°æ®ï¼š{
  "url": "jdbc:mysql://localhost:3306/order",
  "username": "root",
  "password": "123456",
  "maxPoolSize": 20
}
ä¼˜ç‚¹ï¼šç»“æ„åŒ–ï¼Œæ˜“è§£æ
ç¼ºç‚¹ï¼šéœ€è¦JSONè§£æåº“

æ–¹å¼ä¸‰ï¼šPropertiesæ ¼å¼
èŠ‚ç‚¹ï¼š/config/order-service/prod/app
æ•°æ®ï¼š
db.url=jdbc:mysql://localhost:3306/order
db.username=root
db.password=123456
ä¼˜ç‚¹ï¼šSpringåŸç”Ÿæ”¯æŒ
ç¼ºç‚¹ï¼šä¸æ”¯æŒåµŒå¥—ç»“æ„
```

**ğŸ¯ æ¨èå®è·µ**
- **ç®€å•é…ç½®**ï¼šç”¨çº¯æ–‡æœ¬ï¼ˆå¦‚å•ä¸ªURLï¼‰
- **ç»“æ„åŒ–é…ç½®**ï¼šç”¨JSONï¼ˆå¦‚æ•°æ®åº“è¿æ¥æ± é…ç½®ï¼‰
- **Springé¡¹ç›®**ï¼šç”¨Propertiesï¼ˆå…¼å®¹æ€§å¥½ï¼‰

### 2.3 é…ç½®å­˜å‚¨å®ç°



**ğŸ”§ Javaå®ç°ç¤ºä¾‹**
```java
public class ConfigStorage {
    private ZooKeeper zk;
    
    /**
     * ä¿å­˜é…ç½®åˆ°Zookeeper
     * @param path é…ç½®è·¯å¾„ï¼Œå¦‚ï¼š/config/order-service/prod/database
     * @param config é…ç½®å†…å®¹ï¼Œå¦‚ï¼š{"url":"...","username":"..."}
     */
    public void saveConfig(String path, String config) throws Exception {
        // ç¡®ä¿çˆ¶èŠ‚ç‚¹å­˜åœ¨
        createParentPath(path);
        
        // æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
        if (zk.exists(path, false) != null) {
            // å­˜åœ¨åˆ™æ›´æ–°
            zk.setData(path, config.getBytes(), -1);
            System.out.println("âœ… é…ç½®å·²æ›´æ–°: " + path);
        } else {
            // ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ˆæŒä¹…èŠ‚ç‚¹ï¼‰
            zk.create(path, config.getBytes(), 
                ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                CreateMode.PERSISTENT);
            System.out.println("âœ… é…ç½®å·²åˆ›å»º: " + path);
        }
    }
    
    /**
     * è¯»å–é…ç½®
     */
    public String getConfig(String path) throws Exception {
        byte[] data = zk.getData(path, false, null);
        return new String(data);
    }
    
    /**
     * åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼ˆé€’å½’åˆ›å»ºï¼‰
     */
    private void createParentPath(String path) throws Exception {
        String[] parts = path.split("/");
        StringBuilder current = new StringBuilder();
        
        for (int i = 1; i < parts.length - 1; i++) {
            current.append("/").append(parts[i]);
            if (zk.exists(current.toString(), false) == null) {
                zk.create(current.toString(), new byte[0], 
                    ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                    CreateMode.PERSISTENT);
            }
        }
    }
}
```

**ğŸ’¬ ä»£ç è§£è¯»**
- `saveConfig`ï¼šä¿å­˜é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„èŠ‚ç‚¹
- `createParentPath`ï¼šç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ï¼ˆåƒLinuxçš„`mkdir -p`ï¼‰
- ä½¿ç”¨**æŒä¹…èŠ‚ç‚¹**ï¼šé…ç½®éœ€è¦æ°¸ä¹…ä¿å­˜

---

## 3. ğŸ”„ åŠ¨æ€é…ç½®æ›´æ–°



### 3.1 é…ç½®ç›‘å¬æœºåˆ¶



**ğŸ‘‚ Watchæœºåˆ¶åŸç†**
```
é…ç½®æ›´æ–°æµç¨‹ï¼š

1. æœåŠ¡å¯åŠ¨æ—¶æ³¨å†Œç›‘å¬
   æœåŠ¡ â†’ è¯»å–é…ç½® + è®¾ç½®Watch â†’ Zookeeper

2. é…ç½®å‘ç”Ÿå˜æ›´
   ç®¡ç†å‘˜ â†’ ä¿®æ”¹é…ç½® â†’ Zookeeper â†’ é€šçŸ¥æ‰€æœ‰ç›‘å¬çš„æœåŠ¡

3. æœåŠ¡æ”¶åˆ°é€šçŸ¥
   æœåŠ¡ â† æ”¶åˆ°å˜æ›´äº‹ä»¶ â† Zookeeper
   æœåŠ¡ â†’ é‡æ–°è¯»å–é…ç½® â†’ åº”ç”¨æ–°é…ç½®

å…³é”®ç‚¹ï¼šWatchæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè§¦å‘åéœ€è¦é‡æ–°æ³¨å†Œï¼
```

**âš ï¸ å¸¸è§è¯¯åŒº**
```
âŒ é”™è¯¯ç†è§£ï¼šè®¾ç½®ä¸€æ¬¡Watchå°±æ°¸ä¹…ç›‘å¬
âœ… æ­£ç¡®ç†è§£ï¼šæ¯æ¬¡è§¦å‘åè¦é‡æ–°æ³¨å†ŒWatch

è¿™å°±åƒï¼š
âŒ è®¢é˜…äº†ä¸€æ¬¡å¤–å–é€šçŸ¥ï¼Œä»¥åæ°¸è¿œæ”¶åˆ°
âœ… æ¯æ¬¡ç‚¹å¤–å–éƒ½è¦é‡æ–°è®¢é˜…é€šçŸ¥
```

### 3.2 åŠ¨æ€åˆ·æ–°å®ç°



**ğŸ”§ é…ç½®åŠ¨æ€åŠ è½½ä»£ç **
```java
public class DynamicConfigLoader {
    private ZooKeeper zk;
    private Map<String, String> configCache = new ConcurrentHashMap<>();
    
    /**
     * åŠ è½½é…ç½®å¹¶è®¾ç½®ç›‘å¬
     */
    public String loadConfig(String path) throws Exception {
        // è®¾ç½®Watchç›‘å¬å™¨ï¼ˆå…³é”®ï¼ï¼‰
        Watcher watcher = new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getType() == Event.EventType.NodeDataChanged) {
                    System.out.println("ğŸ”” é…ç½®å˜æ›´é€šçŸ¥: " + path);
                    try {
                        // é‡æ–°åŠ è½½é…ç½®ï¼ˆå¹¶å†æ¬¡è®¾ç½®Watchï¼‰
                        loadConfig(path);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
        };
        
        // è¯»å–æ•°æ®å¹¶æ³¨å†Œç›‘å¬
        byte[] data = zk.getData(path, watcher, null);
        String config = new String(data);
        
        // æ›´æ–°ç¼“å­˜
        configCache.put(path, config);
        System.out.println("âœ… é…ç½®å·²åŠ è½½: " + path + " = " + config);
        
        return config;
    }
    
    /**
     * è·å–å½“å‰é…ç½®ï¼ˆä»ç¼“å­˜ï¼‰
     */
    public String getConfig(String path) {
        return configCache.get(path);
    }
}
```

**ğŸ’¡ å·¥ä½œåŸç†**
1. **é¦–æ¬¡åŠ è½½**ï¼šè¯»å–é…ç½® + è®¾ç½®Watch
2. **é…ç½®å˜æ›´**ï¼šè§¦å‘Watchå›è°ƒ
3. **è‡ªåŠ¨æ›´æ–°**ï¼šå›è°ƒä¸­é‡æ–°åŠ è½½ + é‡è®¾Watch
4. **å¾ªç¯å¾€å¤**ï¼šå½¢æˆæŒç»­ç›‘å¬

### 3.3 å®æ—¶ç”Ÿæ•ˆç­–ç•¥



**ğŸ¯ ä¸åŒåœºæ™¯çš„åˆ·æ–°ç­–ç•¥**

| **é…ç½®ç±»å‹** | **åˆ·æ–°æ–¹å¼** | **ä»£ç ç¤ºä¾‹** |
|------------|------------|------------|
| **å¼€å…³é…ç½®** | ç«‹å³ç”Ÿæ•ˆ | `if (getConfig("feature.enabled"))` |
| **æ•°æ®åº“è¿æ¥** | é‡å»ºè¿æ¥æ±  | `dataSource.close(); createNewDataSource();` |
| **æ—¥å¿—çº§åˆ«** | åŠ¨æ€è°ƒæ•´ | `logger.setLevel(newLevel);` |
| **é™æµé˜ˆå€¼** | æ›´æ–°å†…å­˜å€¼ | `rateLimiter.setRate(newRate);` |

**å®æˆ˜æ¡ˆä¾‹ï¼šåŠŸèƒ½å¼€å…³**
```java
public class FeatureToggle {
    private DynamicConfigLoader configLoader;
    
    /**
     * æ£€æŸ¥åŠŸèƒ½æ˜¯å¦å¼€å¯
     */
    public boolean isFeatureEnabled(String featureName) {
        String path = "/config/features/" + featureName;
        String value = configLoader.getConfig(path);
        return "true".equals(value);
    }
    
    // ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨
    public void processOrder(Order order) {
        if (isFeatureEnabled("new-discount-rule")) {
            // ä½¿ç”¨æ–°çš„æŠ˜æ‰£è§„åˆ™
            applyNewDiscount(order);
        } else {
            // ä½¿ç”¨æ—§çš„æŠ˜æ‰£è§„åˆ™
            applyOldDiscount(order);
        }
    }
}
```

---

## 4. ğŸ“š é…ç½®ç‰ˆæœ¬ç®¡ç†



### 4.1 ç‰ˆæœ¬æ§åˆ¶å¿…è¦æ€§



**ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†ï¼Ÿ**
```
åœºæ™¯ä¸€ï¼šé…ç½®æ”¹é”™äº†
è¿ç»´ï¼šåˆšæ”¹äº†æ•°æ®åº“é…ç½®ï¼Œæ‰€æœ‰æœåŠ¡è¿ä¸ä¸Šäº†ï¼
è§£å†³ï¼šä¸€é”®å›æ»šåˆ°ä¸Šä¸ªç‰ˆæœ¬ âœ…

åœºæ™¯äºŒï¼šç°åº¦å‘å¸ƒ
éœ€æ±‚ï¼šæ–°é…ç½®å…ˆç»™10%ç”¨æˆ·è¯•ç”¨
è§£å†³ï¼šç‰ˆæœ¬æ§åˆ¶ + ç°åº¦ç­–ç•¥ âœ…

åœºæ™¯ä¸‰ï¼šå®¡è®¡è¿½è¸ª
è€æ¿ï¼šè°æ”¹äº†è¿™ä¸ªé…ç½®ï¼Œä»€ä¹ˆæ—¶å€™æ”¹çš„ï¼Ÿ
è§£å†³ï¼šç‰ˆæœ¬å†å²å®Œæ•´è®°å½• âœ…
```

### 4.2 ç‰ˆæœ¬å­˜å‚¨æ–¹æ¡ˆ



**ğŸ“ æ–¹æ¡ˆä¸€ï¼šå¤šç‰ˆæœ¬èŠ‚ç‚¹**
```
ç›®å½•ç»“æ„ï¼š
/config/order-service/database
  /v1  â†’ {"url":"old_db", "time":"2024-01-01"}
  /v2  â†’ {"url":"new_db", "time":"2024-01-15"}
  /current â†’ v2  (æŒ‡å‘å½“å‰ç‰ˆæœ¬)

ä¼˜ç‚¹ï¼šå†å²ç‰ˆæœ¬å®Œæ•´ä¿ç•™
ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–çš„ç‰ˆæœ¬ç®¡ç†é€»è¾‘
```

**ğŸ“ æ–¹æ¡ˆäºŒï¼šç‰ˆæœ¬å·åœ¨æ•°æ®ä¸­**
```
èŠ‚ç‚¹ï¼š/config/order-service/database
æ•°æ®ï¼š{
  "version": "v2",
  "timestamp": "2024-01-15 10:30:00",
  "config": {
    "url": "jdbc:mysql://new_db:3306",
    "username": "admin"
  },
  "previous": "v1"  // æŒ‡å‘å‰ä¸€ç‰ˆæœ¬
}

ä¼˜ç‚¹ï¼šç»“æ„ç®€å•ï¼Œæ˜“å®ç°
ç¼ºç‚¹ï¼šå†å²ç‰ˆæœ¬å¯èƒ½ä¸¢å¤±
```

### 4.3 ç‰ˆæœ¬å›æ»šå®ç°



**ğŸ”„ å›æ»šåŠŸèƒ½ä»£ç **
```java
public class ConfigVersionManager {
    
    /**
     * ä¿å­˜é…ç½®å¹¶åˆ›å»ºç‰ˆæœ¬
     */
    public void saveConfigWithVersion(String path, String config) 
            throws Exception {
        // è¯»å–å½“å‰é…ç½®ä½œä¸ºå†å²ç‰ˆæœ¬
        String currentVersion = "v" + System.currentTimeMillis();
        String historyPath = path + "/history/" + currentVersion;
        
        if (zk.exists(path, false) != null) {
            // ä¿å­˜å½“å‰é…ç½®åˆ°å†å²
            byte[] oldData = zk.getData(path, false, null);
            zk.create(historyPath, oldData, 
                ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                CreateMode.PERSISTENT);
        }
        
        // æ›´æ–°å½“å‰é…ç½®
        zk.setData(path, config.getBytes(), -1);
        System.out.println("âœ… é…ç½®å·²ä¿å­˜ï¼Œç‰ˆæœ¬: " + currentVersion);
    }
    
    /**
     * å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
     */
    public void rollback(String path, String version) throws Exception {
        String historyPath = path + "/history/" + version;
        
        // è¯»å–å†å²ç‰ˆæœ¬
        byte[] historyData = zk.getData(historyPath, false, null);
        
        // æ¢å¤åˆ°å½“å‰
        zk.setData(path, historyData, -1);
        System.out.println("ğŸ”„ å·²å›æ»šåˆ°ç‰ˆæœ¬: " + version);
    }
    
    /**
     * åˆ—å‡ºæ‰€æœ‰å†å²ç‰ˆæœ¬
     */
    public List<String> listVersions(String path) throws Exception {
        String historyPath = path + "/history";
        return zk.getChildren(historyPath, false);
    }
}
```

**ğŸ’¬ ä½¿ç”¨ç¤ºä¾‹**
```java
// ä¿å­˜é…ç½®
manager.saveConfigWithVersion("/config/db", "æ–°é…ç½®");

// æŸ¥çœ‹å†å²
List<String> versions = manager.listVersions("/config/db");
// è¾“å‡ºï¼š[v1234567890, v1234567900, v1234567910]

// å‡ºé—®é¢˜äº†ï¼Œå›æ»šï¼
manager.rollback("/config/db", "v1234567890");
```

---

## 5. ğŸ“¡ é…ç½®æ¨é€æœºåˆ¶



### 5.1 ä¸»åŠ¨æ¨é€vsè¢«åŠ¨æ‹‰å–



**ğŸ”„ ä¸¤ç§æ¨¡å¼å¯¹æ¯”**

```
è¢«åŠ¨æ‹‰å–æ¨¡å¼ï¼ˆPullï¼‰ï¼š
æœåŠ¡ â†’ å®šæ—¶è¯¢é—®ï¼šæœ‰æ–°é…ç½®å—ï¼Ÿ â†’ Zookeeper
ç‰¹ç‚¹ï¼šç®€å•ï¼Œä½†æœ‰å»¶è¿Ÿ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ¯10ç§’é—®ä¸€æ¬¡   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚    ZK    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              æœ‰/æ²¡æœ‰æ–°é…ç½®

ä¸»åŠ¨æ¨é€æ¨¡å¼ï¼ˆPushï¼‰ï¼š
Zookeeper â†’ é…ç½®å˜äº†ï¼é€šçŸ¥ä½  â†’ æœåŠ¡
ç‰¹ç‚¹ï¼šå®æ—¶ï¼ŒWatchæœºåˆ¶

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡   â”‚  â†â”€â”€ é…ç½®å˜æ›´é€šçŸ¥ â”€â”€  â”‚    ZK    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             ç«‹å³çŸ¥é“å˜åŒ–
```

**ğŸ¯ Zookeeperå¤©ç„¶æ”¯æŒæ¨é€**
- Watchæœºåˆ¶ = ä¸»åŠ¨æ¨é€
- é…ç½®å˜æ›´ â†’ ç«‹å³é€šçŸ¥ â†’ å®æ—¶ç”Ÿæ•ˆ

### 5.2 é…ç½®åˆ†ç»„æ¨é€



**ğŸ‘¥ åœºæ™¯ï¼šä¸åŒæœåŠ¡ç»„éœ€è¦ä¸åŒé…ç½®**
```
æ¡ˆä¾‹ï¼šæ•°æ®åº“è¿æ¥æ± é…ç½®
- æ ¸å¿ƒæœåŠ¡ï¼ˆè®¢å•ã€æ”¯ä»˜ï¼‰ï¼šmaxPoolSize=50
- æ™®é€šæœåŠ¡ï¼ˆæ—¥å¿—ã€ç»Ÿè®¡ï¼‰ï¼šmaxPoolSize=10

å®ç°æ–¹å¼ï¼š
/config
  /core-services        # æ ¸å¿ƒæœåŠ¡ç»„
    /database          # é…ç½®ï¼šmaxPoolSize=50
  /normal-services     # æ™®é€šæœåŠ¡ç»„  
    /database          # é…ç½®ï¼šmaxPoolSize=10

æœåŠ¡å¯åŠ¨æ—¶ï¼š
è®¢å•æœåŠ¡ â†’ ç›‘å¬ /config/core-services/database
æ—¥å¿—æœåŠ¡ â†’ ç›‘å¬ /config/normal-services/database
```

**ğŸ”§ åˆ†ç»„æ¨é€ä»£ç **
```java
public class GroupConfigPush {
    
    /**
     * æœåŠ¡æ³¨å†Œåˆ°é…ç½®ç»„
     */
    public void registerToGroup(String serviceName, String group) 
            throws Exception {
        String groupPath = "/config/" + group;
        
        // ç›‘å¬é…ç½®ç»„
        zk.getChildren(groupPath, event -> {
            if (event.getType() == Event.EventType.NodeChildrenChanged) {
                System.out.println("ğŸ”” é…ç½®ç»„æœ‰å˜åŒ–: " + group);
                reloadGroupConfigs(group);
            }
        });
        
        System.out.println("âœ… " + serviceName + " å·²åŠ å…¥é…ç½®ç»„: " + group);
    }
    
    /**
     * æ¨é€é…ç½®åˆ°æ•´ä¸ªç»„
     */
    public void pushToGroup(String group, String configKey, String value) 
            throws Exception {
        String path = "/config/" + group + "/" + configKey;
        zk.setData(path, value.getBytes(), -1);
        System.out.println("ğŸ“¤ é…ç½®å·²æ¨é€åˆ°ç»„: " + group);
    }
}
```

### 5.3 æ¨é€ç¡®è®¤æœºåˆ¶



**âœ… ç¡®ä¿é…ç½®æ¨é€æˆåŠŸ**
```java
public class ConfigPushConfirm {
    
    /**
     * æ¨é€é…ç½®å¹¶ç­‰å¾…ç¡®è®¤
     */
    public boolean pushAndConfirm(String path, String config, 
                                   int timeoutSeconds) {
        try {
            // 1. åˆ›å»ºç¡®è®¤èŠ‚ç‚¹
            String confirmPath = path + "/confirm";
            zk.create(confirmPath, "0".getBytes(), 
                ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                CreateMode.EPHEMERAL);
            
            // 2. æ¨é€é…ç½®
            zk.setData(path, config.getBytes(), -1);
            System.out.println("ğŸ“¤ é…ç½®å·²æ¨é€: " + path);
            
            // 3. ç­‰å¾…æœåŠ¡ç¡®è®¤ï¼ˆå¢åŠ ç¡®è®¤è®¡æ•°ï¼‰
            long startTime = System.currentTimeMillis();
            while (System.currentTimeMillis() - startTime < timeoutSeconds * 1000) {
                byte[] data = zk.getData(confirmPath, false, null);
                int confirmCount = Integer.parseInt(new String(data));
                
                if (confirmCount >= getExpectedServiceCount(path)) {
                    System.out.println("âœ… æ‰€æœ‰æœåŠ¡å·²ç¡®è®¤é…ç½®æ›´æ–°");
                    return true;
                }
                
                Thread.sleep(100);
            }
            
            System.out.println("âš ï¸ éƒ¨åˆ†æœåŠ¡æœªç¡®è®¤ï¼Œå¯èƒ½æ›´æ–°å¤±è´¥");
            return false;
            
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
    
    /**
     * æœåŠ¡ç«¯ç¡®è®¤é…ç½®å·²æ›´æ–°
     */
    public void confirmUpdate(String path) throws Exception {
        String confirmPath = path + "/confirm";
        // åŸå­æ€§å¢åŠ ç¡®è®¤è®¡æ•°
        Stat stat = new Stat();
        byte[] data = zk.getData(confirmPath, false, stat);
        int count = Integer.parseInt(new String(data)) + 1;
        zk.setData(confirmPath, String.valueOf(count).getBytes(), 
            stat.getVersion());
    }
}
```

---

## 6. ğŸ›¡ï¸ å®¹é”™å¤„ç†ç­–ç•¥



### 6.1 Zookeeperè¿æ¥å¤±è´¥å¤„ç†



**ğŸ”Œ è¿æ¥æ–­å¼€æ€ä¹ˆåŠï¼Ÿ**
```
é—®é¢˜åœºæ™¯ï¼š
æœåŠ¡è¿è¡Œä¸­ â†’ Zookeeperå®•æœº â†’ è¿æ¥æ–­å¼€ â†’ é…ç½®æ— æ³•æ›´æ–°

è§£å†³æ–¹æ¡ˆï¼š
1. æœ¬åœ°ç¼“å­˜é…ç½®ï¼ˆæ–­ç½‘ä¹Ÿèƒ½ç”¨ï¼‰
2. è‡ªåŠ¨é‡è¿æœºåˆ¶
3. é™çº§ç­–ç•¥
```

**ğŸ”§ æœ¬åœ°ç¼“å­˜å®ç°**
```java
public class ConfigCacheManager {
    private Map<String, String> localCache = new ConcurrentHashMap<>();
    private String cacheFile = "config_cache.json";
    
    /**
     * åŠ è½½é…ç½®ï¼ˆä¼˜å…ˆä»ZKï¼Œå¤±è´¥ç”¨ç¼“å­˜ï¼‰
     */
    public String getConfig(String path) {
        try {
            // å°è¯•ä»Zookeeperè¯»å–
            String config = loadFromZookeeper(path);
            
            // æ›´æ–°æœ¬åœ°ç¼“å­˜
            localCache.put(path, config);
            saveToLocalFile();  // æŒä¹…åŒ–åˆ°æ–‡ä»¶
            
            return config;
        } catch (Exception e) {
            System.out.println("âš ï¸ ZKè¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜");
            
            // ä»ç¼“å­˜è¯»å–
            String cached = localCache.get(path);
            if (cached != null) {
                return cached;
            }
            
            // ä»æ–‡ä»¶æ¢å¤
            return loadFromLocalFile(path);
        }
    }
    
    /**
     * æŒä¹…åŒ–ç¼“å­˜åˆ°æ–‡ä»¶
     */
    private void saveToLocalFile() {
        try (FileWriter fw = new FileWriter(cacheFile)) {
            fw.write(new Gson().toJson(localCache));
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### 6.2 é…ç½®æ›´æ–°å¤±è´¥å›æ»š



**ğŸ”„ æ›´æ–°å¤±è´¥è‡ªåŠ¨å›æ»š**
```java
public class SafeConfigUpdate {
    
    /**
     * å®‰å…¨æ›´æ–°é…ç½®ï¼ˆå¤±è´¥è‡ªåŠ¨å›æ»šï¼‰
     */
    public boolean safeUpdate(String path, String newConfig) {
        String backupPath = path + ".backup";
        
        try {
            // 1. å¤‡ä»½å½“å‰é…ç½®
            byte[] oldData = zk.getData(path, false, null);
            zk.setData(backupPath, oldData, -1);
            System.out.println("âœ… å·²å¤‡ä»½å½“å‰é…ç½®");
            
            // 2. æ›´æ–°é…ç½®
            zk.setData(path, newConfig.getBytes(), -1);
            System.out.println("âœ… é…ç½®å·²æ›´æ–°");
            
            // 3. éªŒè¯æ›´æ–°ï¼ˆæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼‰
            if (verifyConfigUpdate(path)) {
                System.out.println("âœ… é…ç½®éªŒè¯æˆåŠŸ");
                return true;
            } else {
                // 4. éªŒè¯å¤±è´¥ï¼Œå›æ»š
                System.out.println("âŒ é…ç½®éªŒè¯å¤±è´¥ï¼Œå¼€å§‹å›æ»š...");
                zk.setData(path, oldData, -1);
                System.out.println("ğŸ”„ å·²å›æ»šåˆ°æ—§é…ç½®");
                return false;
            }
            
        } catch (Exception e) {
            System.out.println("âŒ æ›´æ–°å¼‚å¸¸: " + e.getMessage());
            // å°è¯•å›æ»š
            tryRollback(path, backupPath);
            return false;
        }
    }
    
    /**
     * éªŒè¯é…ç½®æ›´æ–°ï¼ˆå¯è‡ªå®šä¹‰éªŒè¯é€»è¾‘ï¼‰
     */
    private boolean verifyConfigUpdate(String path) {
        try {
            Thread.sleep(2000);  // ç­‰å¾…2ç§’è§‚å¯Ÿ
            // è¿™é‡Œå¯ä»¥æ£€æŸ¥ï¼š
            // - æœåŠ¡æ˜¯å¦æ­£å¸¸å“åº”
            // - é”™è¯¯æ—¥å¿—æ˜¯å¦å¢åŠ 
            // - ä¸šåŠ¡æŒ‡æ ‡æ˜¯å¦å¼‚å¸¸
            return checkServiceHealth();
        } catch (Exception e) {
            return false;
        }
    }
}
```

### 6.3 é…ç½®å†²çªè§£å†³



**âš”ï¸ å¤šä¸ªæœåŠ¡åŒæ—¶ä¿®æ”¹é…ç½®**
```java
public class ConfigConflictResolver {
    
    /**
     * ä½¿ç”¨ç‰ˆæœ¬å·é˜²æ­¢å†²çª
     */
    public boolean updateWithVersion(String path, String newConfig) {
        try {
            // è¯»å–å½“å‰ç‰ˆæœ¬
            Stat stat = new Stat();
            byte[] data = zk.getData(path, false, stat);
            int currentVersion = stat.getVersion();
            
            // å¸¦ç‰ˆæœ¬å·æ›´æ–°ï¼ˆç‰ˆæœ¬ä¸åŒ¹é…ä¼šå¤±è´¥ï¼‰
            zk.setData(path, newConfig.getBytes(), currentVersion);
            
            System.out.println("âœ… æ›´æ–°æˆåŠŸï¼Œç‰ˆæœ¬: " + (currentVersion + 1));
            return true;
            
        } catch (KeeperException.BadVersionException e) {
            System.out.println("âŒ é…ç½®å·²è¢«å…¶ä»–æœåŠ¡ä¿®æ”¹ï¼Œè¯·é‡æ–°è¯»å–");
            return false;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
}
```

**ğŸ’¡ å·¥ä½œåŸç†**
ç±»ä¼¼æ•°æ®åº“çš„ä¹è§‚é”ï¼š
1. è¯»å–é…ç½® + ç‰ˆæœ¬å·
2. ä¿®æ”¹é…ç½®å†…å®¹
3. æäº¤æ—¶æ£€æŸ¥ç‰ˆæœ¬å·
4. ç‰ˆæœ¬å·å˜äº† â†’ è¯´æ˜è¢«åˆ«äººæ”¹äº† â†’ æ›´æ–°å¤±è´¥

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ é…ç½®ä¸­å¿ƒæœ¬è´¨ï¼šé›†ä¸­ç®¡ç†é…ç½®ï¼ŒåŠ¨æ€æ¨é€æ›´æ–°
ğŸ”¸ æ ¸å¿ƒæœºåˆ¶ï¼šWatchç›‘å¬ + æœ¬åœ°ç¼“å­˜ + ç‰ˆæœ¬æ§åˆ¶
ğŸ”¸ å…³é”®ä¼˜åŠ¿ï¼šå®æ—¶ç”Ÿæ•ˆã€ç»Ÿä¸€ç®¡ç†ã€ç‰ˆæœ¬å›æ»š
ğŸ”¸ å®¹é”™ç­–ç•¥ï¼šæœ¬åœ°ç¼“å­˜ + è‡ªåŠ¨é‡è¿ + å¤±è´¥å›æ»š
```

### 7.2 é…ç½®ä¸­å¿ƒæ¶æ„å›¾



```
æ•´ä½“æ¶æ„æµç¨‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          é…ç½®ç®¡ç†å¹³å°/è„šæœ¬               â”‚
â”‚     (è¿ç»´äººå‘˜ä¿®æ”¹é…ç½®çš„ç•Œé¢)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“ ä¿®æ”¹é…ç½®
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Zookeeper    â”‚
         â”‚   é…ç½®ä¸­å¿ƒ      â”‚ â† æŒä¹…åŒ–å­˜å‚¨
         â”‚  (ä¸»åŠ¨æ¨é€)     â”‚ â† ç‰ˆæœ¬ç®¡ç†
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“ Watché€šçŸ¥
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â†“           â†“                â†“
   â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”
   â”‚æœåŠ¡Aâ”‚    â”‚æœåŠ¡Bâ”‚   ...    â”‚æœåŠ¡Nâ”‚
   â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”˜
   æœ¬åœ°ç¼“å­˜    æœ¬åœ°ç¼“å­˜          æœ¬åœ°ç¼“å­˜
   (å®¹é”™ä¿éšœ)  (å®¹é”™ä¿éšœ)        (å®¹é”™ä¿éšœ)
```

### 7.3 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆWatchæ˜¯ä¸€æ¬¡æ€§çš„**
```
Zookeeperè®¾è®¡è€ƒè™‘ï¼š
âœ… é¿å…"æƒŠç¾¤æ•ˆåº”"ï¼ˆå¤§é‡å®¢æˆ·ç«¯åŒæ—¶è§¦å‘ï¼‰
âœ… è®©å®¢æˆ·ç«¯è‡ªå·±å†³å®šæ˜¯å¦ç»§ç»­ç›‘å¬
âœ… ä¿è¯é€šçŸ¥çš„å¯é æ€§ï¼ˆä¸ä¼šæ¼æ‰ï¼‰

å®è·µå»ºè®®ï¼š
åœ¨Watchå›è°ƒä¸­é‡æ–°æ³¨å†Œ â†’ å½¢æˆæŒç»­ç›‘å¬
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ç”¨é…ç½®ä¸­å¿ƒ**
```
âœ… é€‚åˆåœºæ™¯ï¼š
- å¾®æœåŠ¡æ¶æ„ï¼ˆæœåŠ¡å¤šï¼Œé…ç½®åˆ†æ•£ï¼‰
- éœ€è¦åŠ¨æ€è°ƒæ•´å‚æ•°ï¼ˆé™æµã€å¼€å…³ï¼‰
- å¤šç¯å¢ƒéƒ¨ç½²ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
- é…ç½®éœ€è¦ç‰ˆæœ¬ç®¡ç†

âŒ ä¸é€‚åˆåœºæ™¯ï¼š
- å•ä½“åº”ç”¨ï¼ˆæ²¡å¿…è¦ï¼‰
- é™æ€é…ç½®ï¼ˆå¾ˆå°‘æ”¹åŠ¨ï¼‰
- æ•æ„Ÿé…ç½®ï¼ˆå¯†ç ç­‰ï¼Œéœ€è¦åŠ å¯†ï¼‰
```

### 7.4 å®æˆ˜æœ€ä½³å®è·µ



**ğŸ“Œ é…ç½®ç®¡ç†è§„èŒƒ**
```
å‘½åè§„èŒƒï¼š
/config/{åº”ç”¨å}/{ç¯å¢ƒ}/{é…ç½®ç±»å‹}
ç¤ºä¾‹ï¼š/config/order-service/prod/database

æ›´æ–°æµç¨‹ï¼š
1. ä¿®æ”¹é…ç½®å‰å…ˆå¤‡ä»½
2. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
3. ç°åº¦å‘å¸ƒåˆ°ç”Ÿäº§
4. ç›‘æ§æœåŠ¡çŠ¶æ€
5. å¼‚å¸¸æ—¶å¿«é€Ÿå›æ»š

ç›‘æ§è¦ç‚¹ï¼š
- é…ç½®å˜æ›´æ—¥å¿—
- æœåŠ¡å“åº”æ—¶é—´
- é”™è¯¯æ—¥å¿—æ•°é‡
- ä¸šåŠ¡æ ¸å¿ƒæŒ‡æ ‡
```

### 7.5 å­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ¯ çŸ¥è¯†æŒæ¡æ£€æŸ¥**
- [ ] ç†è§£é…ç½®ä¸­å¿ƒè§£å†³çš„æ ¸å¿ƒé—®é¢˜
- [ ] æŒæ¡Zookeeper Watchæœºåˆ¶åŸç†
- [ ] èƒ½è®¾è®¡åˆç†çš„é…ç½®å­˜å‚¨ç»“æ„
- [ ] ä¼šå®ç°åŠ¨æ€é…ç½®æ›´æ–°
- [ ] äº†è§£ç‰ˆæœ¬ç®¡ç†å’Œå›æ»šæœºåˆ¶
- [ ] çŸ¥é“å¦‚ä½•å¤„ç†è¿æ¥å¤±è´¥ç­‰å¼‚å¸¸

**ğŸ’¡ å®è·µç»ƒä¹ å»ºè®®**
1. æ­å»ºç®€å•çš„é…ç½®ä¸­å¿ƒDemo
2. å®ç°ä¸€ä¸ªå¼€å…³åŠŸèƒ½ï¼ˆåŠ¨æ€å¼€å¯/å…³é—­ï¼‰
3. æ¨¡æ‹ŸZookeeperå®•æœºï¼Œæµ‹è¯•æœ¬åœ°ç¼“å­˜
4. å®ç°é…ç½®ç‰ˆæœ¬å›æ»šåŠŸèƒ½

### 7.6 å¸¸è§é—®é¢˜è§£ç­”



**â“ é…ç½®ä¸­å¿ƒä¼šæˆä¸ºå•ç‚¹æ•…éšœå—ï¼Ÿ**
```
ä¸ä¼šï¼Œå› ä¸ºï¼š
âœ… Zookeeperé›†ç¾¤éƒ¨ç½²ï¼ˆ3/5/7èŠ‚ç‚¹ï¼‰
âœ… æœåŠ¡æœ‰æœ¬åœ°ç¼“å­˜ï¼ˆZKæŒ‚äº†ä¹Ÿèƒ½è¿è¡Œï¼‰
âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼ˆZKæ¢å¤åè‡ªåŠ¨åŒæ­¥ï¼‰
```

**â“ é…ç½®æ›´æ–°ä¼šå¯¼è‡´æœåŠ¡é‡å¯å—ï¼Ÿ**
```
ä¸ä¼šï¼Œè¿™å°±æ˜¯é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒä»·å€¼ï¼š
âœ… Watchæœºåˆ¶å®æ—¶é€šçŸ¥
âœ… åº”ç”¨å†…å­˜ä¸­ç›´æ¥æ›´æ–°
âœ… æ— éœ€é‡å¯ï¼ŒåŠ¨æ€ç”Ÿæ•ˆ

æ³¨æ„ï¼šæŸäº›é…ç½®å¯èƒ½éœ€è¦é‡å»ºå¯¹è±¡ï¼ˆå¦‚è¿æ¥æ± ï¼‰
```

**â“ å¦‚ä½•ä¿è¯é…ç½®çš„å®‰å…¨æ€§ï¼Ÿ**
```
å¤šå±‚é˜²æŠ¤ï¼š
1. Zookeeper ACLæƒé™æ§åˆ¶
2. æ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨
3. é…ç½®å˜æ›´å®¡è®¡æ—¥å¿—
4. ç½‘ç»œéš”ç¦»ï¼ˆåªå…è®¸å†…ç½‘è®¿é—®ï¼‰
```

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
```
é…ç½®ä¸­å¿ƒä¸‰å¤§æ ¸å¿ƒï¼š
1. é›†ä¸­å­˜å‚¨ â†’ ç»Ÿä¸€ç®¡ç†ä¸æ··ä¹±
2. åŠ¨æ€æ¨é€ â†’ Watchæœºåˆ¶å®æ—¶é€šçŸ¥
3. ç‰ˆæœ¬æ§åˆ¶ â†’ æ”¹é”™äº†å¯ä»¥å›æ»š

å®¹é”™ä¸‰ä»¶å¥—ï¼š
1. æœ¬åœ°ç¼“å­˜ â†’ ZKæŒ‚äº†ä¹Ÿèƒ½ç”¨
2. è‡ªåŠ¨é‡è¿ â†’ ç½‘ç»œæ¢å¤è‡ªåŠ¨åŒæ­¥
3. å¤±è´¥å›æ»š â†’ æ›´æ–°å¼‚å¸¸è‡ªåŠ¨æ¢å¤
```

---

# ğŸš€ **è¿›é˜¶å­¦ä¹ å»ºè®®**



å­¦å®Œé…ç½®ä¸­å¿ƒåï¼Œå»ºè®®ç»§ç»­å­¦ä¹ ï¼š
- **æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼šZookeeperå®ç°æœåŠ¡æ²»ç†
- **åˆ†å¸ƒå¼é”**ï¼šè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒçš„å¹¶å‘é—®é¢˜
- **é…ç½®åŠ å¯†**ï¼šå¦‚ä½•å®‰å…¨å­˜å‚¨æ•æ„Ÿé…ç½®
- **é…ç½®ç°åº¦å‘å¸ƒ**ï¼šæ–°é…ç½®å¦‚ä½•å¹³æ»‘ä¸Šçº¿