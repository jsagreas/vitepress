---
title: 1ã€ä»€ä¹ˆæ˜¯Zookeeper
---
## ðŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Zookeeper](#1-ä»€ä¹ˆæ˜¯Zookeeper)
2. [Zookeeperçš„æ ¸å¿ƒä½œç”¨](#2-Zookeeperçš„æ ¸å¿ƒä½œç”¨)
3. [CAPå®šç†ä¸Žå¼ºä¸€è‡´æ€§](#3-CAPå®šç†ä¸Žå¼ºä¸€è‡´æ€§)
4. [é›†ç¾¤ç®¡ç†æœºåˆ¶](#4-é›†ç¾¤ç®¡ç†æœºåˆ¶)
5. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#5-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ ä»€ä¹ˆæ˜¯Zookeeper


### 1.1 ç™½è¯ç†è§£Zookeeper


**ðŸ”¸ ç”Ÿæ´»ä¸­çš„ä¾‹å­**

æƒ³è±¡ä¸€ä¸ªå¤§åž‹ä¼ä¸šçš„**æ€»æœºè°ƒåº¦ä¸­å¿ƒ**ï¼š
```
åœºæ™¯ï¼šä½ è¦æ‰¾è´¢åŠ¡éƒ¨çŽ‹ç»ç†
ä¼ ç»Ÿæ–¹å¼ï¼š
ä½  â†’ æ‰“éæ‰€æœ‰åˆ†æœº â†’ ç»ˆäºŽæ‰¾åˆ°çŽ‹ç»ç†

æœ‰äº†æ€»æœºï¼š
ä½  â†’ æ€»æœºï¼ˆæŸ¥è¯¢çŽ‹ç»ç†åœ¨å“ªï¼‰ â†’ æ€»æœºå‘Šè¯‰ä½ åˆ†æœºå· â†’ ç›´æŽ¥è”ç³»

Zookeeperå°±æ˜¯å¾®æœåŠ¡ä¸–ç•Œçš„"æ€»æœºè°ƒåº¦ä¸­å¿ƒ"ï¼
```

**ðŸ’¡ æŠ€æœ¯å®šä¹‰**

Zookeeper æ˜¯ä¸€ä¸ª**åˆ†å¸ƒå¼åè°ƒæœåŠ¡**ï¼Œè¯´äººè¯å°±æ˜¯ï¼š
- ðŸ“‹ **é€šè®¯å½•ç®¡å®¶** - å¸®ä½ è®°ä½æ‰€æœ‰æœåŠ¡åœ¨å“ªé‡Œ
- ðŸ”§ **é…ç½®ç®¡ç†å‘˜** - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®ä¿¡æ¯
- ðŸ‘® **äº¤é€šæŒ‡æŒ¥** - åè°ƒå¤šä¸ªæœåŠ¡ä¹‹é—´çš„å·¥ä½œ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Zookeeper


**âŒ æ²¡æœ‰Zookeeperçš„æ··ä¹±**

```
å¾®æœåŠ¡Aï¼šæˆ‘æƒ³è°ƒç”¨è®¢å•æœåŠ¡ï¼Œå®ƒåœ¨å“ªï¼Ÿ
å¾®æœåŠ¡Bï¼šæˆ‘ä¹Ÿä¸çŸ¥é“å•Š...
å¾®æœåŠ¡Cï¼šæˆ‘è¿™æœ‰ä¸ªåœ°å€ï¼Œä½†ä¸çŸ¥é“è¿˜èƒ½ä¸èƒ½ç”¨

ç»“æžœï¼šæœåŠ¡æ‰¾ä¸åˆ°å½¼æ­¤ï¼Œç³»ç»Ÿç˜«ç—ªï¼
```

**âœ… æœ‰äº†Zookeeperçš„ç§©åº**

```
å¾®æœåŠ¡Aï¼šZookeeperï¼Œè®¢å•æœåŠ¡åœ¨å“ªï¼Ÿ
Zookeeperï¼šåœ¨ 192.168.1.10:8080
å¾®æœåŠ¡Aï¼šå¥½çš„ï¼Œé©¬ä¸Šè°ƒç”¨ï¼

è®¢å•æœåŠ¡ï¼šæˆ‘ä¸Šçº¿äº†ï¼Œåœ°å€æ˜¯ 192.168.1.10:8080
Zookeeperï¼šæ”¶åˆ°ï¼Œå·²ç™»è®°ï¼
```

### 1.3 Zookeeperçš„æœ¬è´¨


**ðŸ”¹ æ ¸å¿ƒç‰¹ç‚¹**

| ç‰¹æ€§ | è¯´æ˜Ž | ç”Ÿæ´»ç±»æ¯” |
|------|------|----------|
| **é›†ä¸­ç®¡ç†** | `æ‰€æœ‰ä¿¡æ¯ç»Ÿä¸€å­˜å‚¨` | å›¾ä¹¦é¦†çš„ä¹¦ç›®æ£€ç´¢ç³»ç»Ÿ |
| **å®žæ—¶åŒæ­¥** | `ä¿¡æ¯å˜åŒ–ç«‹å³é€šçŸ¥` | å¾®ä¿¡ç¾¤æ¶ˆæ¯@æ‰€æœ‰äºº |
| **é«˜å¯ç”¨æ€§** | `7x24å°æ—¶ä¸å®•æœº` | 110æŠ¥è­¦ç”µè¯æ°¸è¿œåœ¨çº¿ |
| **å¼ºä¸€è‡´æ€§** | `æ‰€æœ‰äººçœ‹åˆ°çš„ä¿¡æ¯éƒ½ä¸€æ ·` | é“¶è¡Œè´¦æˆ·ä½™é¢å…¨å›½ä¸€è‡´ |

---

## 2. ðŸ› ï¸ Zookeeperçš„æ ¸å¿ƒä½œç”¨


### 2.1 æ³¨å†Œä¸­å¿ƒ - æœåŠ¡çš„"æˆ·å£æœ¬"


**ðŸ”¸ ä»€ä¹ˆæ˜¯æ³¨å†Œä¸­å¿ƒ**

å°±åƒæ´¾å‡ºæ‰€çš„**æˆ·ç±ç®¡ç†ç³»ç»Ÿ**ï¼š
- ä½ æ¬å®¶äº† â†’ åŽ»æ´¾å‡ºæ‰€ç™»è®°æ–°åœ°å€
- åˆ«äººæ‰¾ä½  â†’ åŽ»æ´¾å‡ºæ‰€æŸ¥ä½ çš„åœ°å€

åœ¨å¾®æœåŠ¡ä¸­ï¼š
- æœåŠ¡å¯åŠ¨ â†’ åœ¨Zookeeperæ³¨å†Œè‡ªå·±çš„åœ°å€
- å…¶ä»–æœåŠ¡ â†’ åœ¨ZookeeperæŸ¥è¯¢æœåŠ¡åœ°å€

**ðŸ’¡ å·¥ä½œæµç¨‹**

```
æœåŠ¡æ³¨å†Œè¿‡ç¨‹ï¼š
è®¢å•æœåŠ¡å¯åŠ¨
   â†“
å‘ZookeeperæŠ¥å‘Šï¼š"æˆ‘æ˜¯è®¢å•æœåŠ¡ï¼Œæˆ‘åœ¨ 192.168.1.10:8080"
   â†“
Zookeeperè®°å½•ï¼š"è®¢å•æœåŠ¡ â†’ 192.168.1.10:8080"
   â†“
å…¶ä»–æœåŠ¡å¯ä»¥æ‰¾åˆ°è®¢å•æœåŠ¡äº†ï¼

æœåŠ¡å‘çŽ°è¿‡ç¨‹ï¼š
ç”¨æˆ·æœåŠ¡éœ€è¦è°ƒç”¨è®¢å•æœåŠ¡
   â†“
é—®Zookeeperï¼š"è®¢å•æœåŠ¡åœ¨å“ªï¼Ÿ"
   â†“
Zookeeperå›žç­”ï¼š"åœ¨ 192.168.1.10:8080"
   â†“
ç”¨æˆ·æœåŠ¡ç›´æŽ¥è°ƒç”¨ 192.168.1.10:8080
```

**ðŸŽ¯ å®žé™…åº”ç”¨**

```java
// æœåŠ¡å¯åŠ¨æ—¶æ³¨å†Œï¼ˆä¼ªä»£ç ç¤ºä¾‹ï¼‰
public class OrderService {
    public void start() {
        // 1. å¯åŠ¨æœåŠ¡
        startServer(8080);
        
        // 2. å‘Zookeeperæ³¨å†Œ
        zookeeper.register("/services/order", "192.168.1.10:8080");
        
        System.out.println("è®¢å•æœåŠ¡å·²æ³¨å†Œåˆ°Zookeeper");
    }
}

// è°ƒç”¨æœåŠ¡æ—¶å‘çŽ°
public class UserService {
    public void callOrder() {
        // ä»ŽZookeeperèŽ·å–è®¢å•æœåŠ¡åœ°å€
        String address = zookeeper.getService("/services/order");
        
        // è°ƒç”¨è®¢å•æœåŠ¡
        httpClient.get("http://" + address + "/api/order");
    }
}
```

### 2.2 é…ç½®ç®¡ç†ä¸­å¿ƒ - ç»Ÿä¸€çš„"é¥æŽ§å™¨"


**ðŸ”¸ é…ç½®ç®¡ç†çš„ç—›ç‚¹**

ä¼ ç»Ÿæ–¹å¼çš„éº»çƒ¦ï¼š
```
âŒ 10ä¸ªæœåŠ¡ï¼Œä¿®æ”¹æ•°æ®åº“åœ°å€ï¼š
æœåŠ¡1çš„é…ç½®æ–‡ä»¶ â†’ æ”¹
æœåŠ¡2çš„é…ç½®æ–‡ä»¶ â†’ æ”¹
...
æœåŠ¡10çš„é…ç½®æ–‡ä»¶ â†’ æ”¹
æ¯ä¸ªéƒ½è¦é‡å¯ï¼å¤ªéº»çƒ¦äº†ï¼
```

**âœ… Zookeeperçš„è§£å†³æ–¹æ¡ˆ**

```
é…ç½®å­˜åœ¨Zookeeperï¼š
Zookeeperå­˜å‚¨ï¼šdatabase.url = jdbc:mysql://localhost:3306/db

æ‰€æœ‰æœåŠ¡ä»ŽZookeeperè¯»é…ç½®ï¼š
æœåŠ¡1 â†’ è¯»å– â†’ jdbc:mysql://localhost:3306/db
æœåŠ¡2 â†’ è¯»å– â†’ jdbc:mysql://localhost:3306/db
...

ä¿®æ”¹ä¸€æ¬¡ï¼Œå…¨éƒ¨ç”Ÿæ•ˆï¼š
æ”¹Zookeeperçš„é…ç½® â†’ æ‰€æœ‰æœåŠ¡è‡ªåŠ¨æ„ŸçŸ¥ â†’ æ— éœ€é‡å¯ï¼
```

**ðŸ’¡ é…ç½®çƒ­æ›´æ–°åŽŸç†**

```
é…ç½®ç›‘å¬æœºåˆ¶ï¼š
                Zookeeper
                    |
        é…ç½®: timeout=3000
                    |
        +-----------+-----------+
        |           |           |
    æœåŠ¡Aç›‘å¬    æœåŠ¡Bç›‘å¬    æœåŠ¡Cç›‘å¬
        |           |           |
    
ç®¡ç†å‘˜ä¿®æ”¹é…ç½®: timeout=5000
        â†“
    Zookeeperé€šçŸ¥æ‰€æœ‰æœåŠ¡
        â†“
æœåŠ¡Aã€Bã€Cè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€é‡å¯ï¼
```

### 2.3 å‘½åæœåŠ¡ - åˆ†å¸ƒå¼çš„"èº«ä»½è¯ç³»ç»Ÿ"


**ðŸ”¸ å‘½åæœåŠ¡çš„ä½œç”¨**

ç±»ä¼¼äºŽ**åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰**ï¼š
- `www.baidu.com` â†’ äººç±»å®¹æ˜“è®°
- `110.242.68.66` â†’ æœºå™¨ä½¿ç”¨çš„IP

Zookeeperçš„å‘½åæœåŠ¡ï¼š
- `/services/order/instance-001` â†’ æœ‰æ„ä¹‰çš„åå­—
- `192.168.1.10:8080` â†’ å®žé™…çš„åœ°å€

**ðŸŽ¯ å±‚çº§å‘½åç»“æž„**

```
Zookeeperå‘½åç©ºé—´ï¼ˆç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼š

/services
    â”œâ”€â”€ /order-service
    â”‚       â”œâ”€â”€ /instance-001 â†’ 192.168.1.10:8080
    â”‚       â”œâ”€â”€ /instance-002 â†’ 192.168.1.11:8080
    â”‚       â””â”€â”€ /instance-003 â†’ 192.168.1.12:8080
    â”‚
    â”œâ”€â”€ /user-service
    â”‚       â”œâ”€â”€ /instance-001 â†’ 192.168.1.20:8080
    â”‚       â””â”€â”€ /instance-002 â†’ 192.168.1.21:8080
    â”‚
    â””â”€â”€ /payment-service
            â””â”€â”€ /instance-001 â†’ 192.168.1.30:8080

ä¼˜åŠ¿ï¼š
âœ… ç»“æž„æ¸…æ™°ï¼Œä¸€ç›®äº†ç„¶
âœ… æ–¹ä¾¿ç®¡ç†å’ŒæŸ¥è¯¢
âœ… æ”¯æŒæœåŠ¡åˆ†ç»„å’Œç‰ˆæœ¬æŽ§åˆ¶
```

---

## 3. ðŸ“Š CAPå®šç†ä¸Žå¼ºä¸€è‡´æ€§


### 3.1 CAPå®šç† - åˆ†å¸ƒå¼ç³»ç»Ÿçš„"ä¸å¯èƒ½ä¸‰è§’"


**ðŸ”¸ ä»€ä¹ˆæ˜¯CAP**

CAPæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸‰ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼š

| ç‰¹æ€§ | è‹±æ–‡ | é€šä¿—è§£é‡Š | ç”Ÿæ´»ç±»æ¯” |
|------|------|----------|----------|
| **C** | `Consistency ä¸€è‡´æ€§` | æ‰€æœ‰äººçœ‹åˆ°çš„æ•°æ®éƒ½ä¸€æ · | é“¶è¡ŒATMå–é’±ï¼Œä½™é¢å…¨å›½ä¸€è‡´ |
| **A** | `Availability å¯ç”¨æ€§` | ç³»ç»Ÿéšæ—¶éƒ½èƒ½å“åº”è¯·æ±‚ | 24å°æ—¶ä¾¿åˆ©åº—ï¼Œéšæ—¶è¥ä¸š |
| **P** | `Partition Tolerance åˆ†åŒºå®¹é”™` | ç½‘ç»œå‡ºé—®é¢˜ä¹Ÿèƒ½å·¥ä½œ | åˆ†åº—ä¹‹é—´æ–­ç½‘ä¹Ÿèƒ½å„è‡ªè¥ä¸š |

**ðŸ’¡ CAPä¸å¯èƒ½ä¸‰è§’**

```
å®šç†ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ï¼

CAPä¸‰è§’å½¢ï¼š
         C (ä¸€è‡´æ€§)
         /\
        /  \
       /    \
      /      \
     /        \
    /          \
   A ---------- P
(å¯ç”¨æ€§)    (åˆ†åŒºå®¹é”™)

åªèƒ½é€‰ä¸¤ä¸ªï¼š
CPç»„åˆï¼šä¿è¯ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œç‰ºç‰²å¯ç”¨æ€§
APç»„åˆï¼šä¿è¯å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™ï¼Œç‰ºç‰²ä¸€è‡´æ€§
CAç»„åˆï¼šä¿è¯ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Œä¸èƒ½å®¹å¿åˆ†åŒºï¼ˆå•æœºï¼Œéžåˆ†å¸ƒå¼ï¼‰
```

**ðŸŽ¯ å®žé™…åœºæ™¯ç†è§£**

```
åœºæ™¯ï¼šé“¶è¡Œè½¬è´¦ç³»ç»Ÿ

é€‰æ‹©CPï¼ˆZookeeperçš„é€‰æ‹©ï¼‰ï¼š
ä½ ï¼šç»™æœ‹å‹è½¬è´¦1000å…ƒ
ç³»ç»Ÿï¼šç­‰ç­‰ï¼Œæˆ‘è¦ç¡®ä¿æ‰€æœ‰é“¶è¡Œéƒ½è®°å½•ä¸€è‡´
       å¦‚æžœç½‘ç»œæœ‰é—®é¢˜ï¼Œæš‚æ—¶ä¸èƒ½è½¬è´¦ï¼ˆç‰ºç‰²å¯ç”¨æ€§ï¼‰
       ç¡®ä¿è½¬è´¦è®°å½•ç»å¯¹å‡†ç¡®ï¼ˆä¿è¯ä¸€è‡´æ€§ï¼‰

é€‰æ‹©APï¼ˆå¦‚Redisé›†ç¾¤ï¼‰ï¼š
ä½ ï¼šæŸ¥è¯¢å•†å“åº“å­˜
ç³»ç»Ÿï¼šç«‹å³è¿”å›žç»“æžœï¼ˆä¿è¯å¯ç”¨æ€§ï¼‰
       å¯èƒ½ä¸åŒæœåŠ¡å™¨æ•°æ®ç¨æœ‰å»¶è¿Ÿï¼ˆç‰ºç‰²å¼ºä¸€è‡´æ€§ï¼‰
       ä½†æœ€ç»ˆä¼šä¸€è‡´ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰
```

### 3.2 Zookeeperçš„å¼ºä¸€è‡´æ€§


**ðŸ”¸ ä»€ä¹ˆæ˜¯å¼ºä¸€è‡´æ€§**

**å¼ºä¸€è‡´æ€§**å°±æ˜¯ï¼š"æ‰€æœ‰äººã€æ‰€æœ‰æ—¶åˆ»çœ‹åˆ°çš„æ•°æ®éƒ½ä¸€æ ·"

```
å¯¹æ¯”ï¼š

å¼ºä¸€è‡´æ€§ï¼ˆZookeeperï¼‰ï¼š
æ—¶åˆ»1ï¼šæœåŠ¡AæŸ¥è¯¢é…ç½® â†’ timeout=3000
       æœåŠ¡BæŸ¥è¯¢é…ç½® â†’ timeout=3000  âœ… å®Œå…¨ä¸€è‡´
æ—¶åˆ»2ï¼šé…ç½®æ”¹ä¸º timeout=5000
       æœåŠ¡AæŸ¥è¯¢é…ç½® â†’ timeout=5000
       æœåŠ¡BæŸ¥è¯¢é…ç½® â†’ timeout=5000  âœ… å®Œå…¨ä¸€è‡´

æœ€ç»ˆä¸€è‡´æ€§ï¼ˆRedisï¼‰ï¼š
æ—¶åˆ»1ï¼šé…ç½®æ”¹ä¸º timeout=5000
       æœåŠ¡AæŸ¥è¯¢ â†’ timeout=5000 âœ…
       æœåŠ¡BæŸ¥è¯¢ â†’ timeout=3000 âŒ è¿˜æ˜¯æ—§å€¼
æ—¶åˆ»2ï¼šç­‰å¾…å‡ ç§’åŽ
       æœåŠ¡BæŸ¥è¯¢ â†’ timeout=5000 âœ… æœ€ç»ˆä¸€è‡´
```

**ðŸ’¡ Zookeeperå¦‚ä½•ä¿è¯å¼ºä¸€è‡´æ€§**

```
ZABåè®®ï¼ˆZookeeper Atomic Broadcastï¼‰ï¼š

å†™æ“ä½œæµç¨‹ï¼š
å®¢æˆ·ç«¯                Leader              Followeré›†ç¾¤
   |                     |                      |
   |--å†™è¯·æ±‚------------>|                      |
   |                     |---åŒæ­¥æ•°æ®---------->|
   |                     |<--ç¡®è®¤æ”¶åˆ°æ•°æ®-------|
   |                     |                      |
   |                     |ï¼ˆè¶…è¿‡åŠæ•°ç¡®è®¤ï¼‰       |
   |                     |                      |
   |                     |---æäº¤å‘½ä»¤---------->|
   |                     |                      |
   |<--å†™æˆåŠŸ------------|                      |

å…³é”®ç‚¹ï¼š
ðŸ”¸ åªæœ‰Leaderå¤„ç†å†™è¯·æ±‚
ðŸ”¸ å¿…é¡»è¶…è¿‡åŠæ•°èŠ‚ç‚¹ç¡®è®¤
ðŸ”¸ ç¡®è®¤åŽæ‰è¿”å›žæˆåŠŸ
ðŸ”¸ ä¿è¯æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ä¸€è‡´
```

**ðŸš¨ å¼ºä¸€è‡´æ€§çš„ä»£ä»·**

```
ä¼˜ç‚¹ï¼š
âœ… æ•°æ®ç»å¯¹å‡†ç¡®
âœ… ä¸ä¼šå‡ºçŽ°è„æ•°æ®
âœ… é€‚åˆé‡‘èžã€æ³¨å†Œä¸­å¿ƒç­‰å…³é”®åœºæ™¯

ç¼ºç‚¹ï¼š
âŒ æ€§èƒ½ç›¸å¯¹è¾ƒæ…¢ï¼ˆéœ€è¦ç­‰å¾…ç¡®è®¤ï¼‰
âŒ ç½‘ç»œåˆ†åŒºæ—¶å¯èƒ½ä¸å¯ç”¨
âŒ å†™æ“ä½œå»¶è¿Ÿè¾ƒé«˜

é€‚ç”¨åœºæ™¯ï¼š
âœ”ï¸ æœåŠ¡æ³¨å†Œå‘çŽ°ï¼ˆå¿…é¡»å‡†ç¡®ï¼‰
âœ”ï¸ é…ç½®ç®¡ç†ï¼ˆä¸èƒ½å‡ºé”™ï¼‰
âœ”ï¸ åˆ†å¸ƒå¼é”ï¼ˆå¿…é¡»å¯é ï¼‰

ä¸é€‚ç”¨åœºæ™¯ï¼š
âœ–ï¸ é«˜å¹¶å‘å†™å…¥ï¼ˆå¦‚ç§’æ€ï¼‰
âœ–ï¸ å¤§é‡æ•°æ®å­˜å‚¨ï¼ˆå¦‚ç¼“å­˜ï¼‰
âœ–ï¸ å¯¹å»¶è¿Ÿæžåº¦æ•æ„Ÿçš„åœºæ™¯
```

---

## 4. ðŸŽ›ï¸ é›†ç¾¤ç®¡ç†æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯é›†ç¾¤ç®¡ç†


**ðŸ”¸ é›†ç¾¤ç®¡ç†çš„æ ¸å¿ƒé—®é¢˜**

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œéœ€è¦è§£å†³ï¼š
- ðŸ¤” **è°æ˜¯è€å¤§ï¼Ÿ** - é€‰ä¸¾Leader
- ðŸ‘€ **è°è¿˜æ´»ç€ï¼Ÿ** - å¥åº·æ£€æµ‹
- ðŸ“¢ **è°æ–°æ¥çš„ï¼Ÿ** - æˆå‘˜å˜æ›´é€šçŸ¥

**ðŸ’¡ Zookeeperé›†ç¾¤æž¶æž„**

```
Zookeeperé›†ç¾¤ç»“æž„ï¼ˆé€šå¸¸3-7å°æœºå™¨ï¼‰ï¼š

          å®¢æˆ·ç«¯è¯·æ±‚
               â†“
    +----------+----------+
    |          |          |
 [Leader]  [Follower] [Follower]
    |          |          |
    +----------+----------+
         æ•°æ®åŒæ­¥

è§’è‰²è¯´æ˜Žï¼š
ðŸ”¸ Leaderï¼ˆé¢†å¯¼è€…ï¼‰ï¼š1ä¸ª
   - å¤„ç†æ‰€æœ‰å†™è¯·æ±‚
   - è´Ÿè´£æ•°æ®åŒæ­¥
   - å‘èµ·æŠ•ç¥¨
   
ðŸ”¸ Followerï¼ˆè·Ÿéšè€…ï¼‰ï¼šå¤šä¸ª
   - å¤„ç†è¯»è¯·æ±‚
   - è½¬å‘å†™è¯·æ±‚ç»™Leader
   - å‚ä¸ŽæŠ•ç¥¨
```

### 4.2 Leaderé€‰ä¸¾æœºåˆ¶


**ðŸ”¸ é€‰ä¸¾è§¦å‘æ—¶æœº**

```
ä»€ä¹ˆæ—¶å€™é€‰ä¸¾ï¼Ÿ
1ï¸âƒ£ é›†ç¾¤å¯åŠ¨æ—¶
2ï¸âƒ£ Leaderå®•æœºæ—¶
3ï¸âƒ£ Leaderä¸Žè¿‡åŠFollowerå¤±è”æ—¶
```

**ðŸ’¡ é€‰ä¸¾è¿‡ç¨‹ï¼ˆç®€åŒ–ç†è§£ï¼‰**

```
é€‰ä¸¾æŠ•ç¥¨æµç¨‹ï¼š

åˆå§‹çŠ¶æ€ï¼ˆ3å°æœåŠ¡å™¨å¯åŠ¨ï¼‰ï¼š
Server1: æˆ‘æŠ•æˆ‘è‡ªå·±ä¸€ç¥¨ (1,0) â†’ ç¥¨æ•°1
Server2: æˆ‘æŠ•æˆ‘è‡ªå·±ä¸€ç¥¨ (2,0) â†’ ç¥¨æ•°1  
Server3: æˆ‘æŠ•æˆ‘è‡ªå·±ä¸€ç¥¨ (3,0) â†’ ç¥¨æ•°1

æ¯”è¾ƒè§„åˆ™ï¼š
1. è°çš„æ•°æ®æ›´æ–°ï¼ˆäº‹åŠ¡IDæ›´å¤§ï¼‰ï¼Ÿ
2. æ•°æ®ä¸€æ ·æ–°ï¼Œè°çš„æœåŠ¡å™¨IDå¤§ï¼Ÿ

ç¬¬äºŒè½®ï¼š
Server1: Server3æ•°æ®æ›´æ–°ï¼Œæ”¹æŠ•Server3 â†’ Server3å¾—2ç¥¨
Server2: Server3æ•°æ®æ›´æ–°ï¼Œæ”¹æŠ•Server3 â†’ Server3å¾—3ç¥¨
Server3: æˆ‘å°±æ˜¯Leaderäº†ï¼

ç»“æžœï¼šServer3 å½“é€‰Leaderï¼ˆèŽ·å¾—è¶…è¿‡åŠæ•°é€‰ç¥¨ï¼‰

ç±»æ¯”ï¼š
å°±åƒç­çº§é€‰ç­é•¿ï¼š
- å…ˆè‡ªå·±æŠ•è‡ªå·±
- ç„¶åŽçœ‹è°æˆç»©å¥½ï¼ˆæ•°æ®æ–°ï¼‰
- æˆç»©ä¸€æ ·çœ‹è°å¹´çºªå¤§ï¼ˆIDå¤§ï¼‰
- ç¥¨æ•°è¿‡åŠå°±å½“é€‰
```

**ðŸŽ¯ ä¸ºä»€ä¹ˆè¦å¥‡æ•°å°æœåŠ¡å™¨**

```
å®¹é”™å¯¹æ¯”ï¼š

3å°é›†ç¾¤ï¼š
- æŒ‚1å° â†’ å‰©2å° â†’ è¿‡åŠ âœ… æ­£å¸¸å·¥ä½œ
- æŒ‚2å° â†’ å‰©1å° â†’ ä¸è¿‡åŠ âŒ æ— æ³•å·¥ä½œ
å®¹é”™ï¼š1å°

4å°é›†ç¾¤ï¼š
- æŒ‚1å° â†’ å‰©3å° â†’ è¿‡åŠ âœ… æ­£å¸¸å·¥ä½œ
- æŒ‚2å° â†’ å‰©2å° â†’ ä¸è¿‡åŠ âŒ æ— æ³•å·¥ä½œ
å®¹é”™ï¼š1å°

ç»“è®ºï¼š3å°å’Œ4å°å®¹é”™èƒ½åŠ›ä¸€æ ·ï¼Œä½†4å°æˆæœ¬æ›´é«˜ï¼
æŽ¨èï¼š3å°ã€5å°ã€7å°ï¼ˆå¥‡æ•°ï¼‰

è¿‡åŠåŽŸåˆ™ï¼š
é›†ç¾¤èŠ‚ç‚¹æ•° = 2N + 1
å®¹é”™èŠ‚ç‚¹æ•° = N
ä¾‹ï¼š5å°é›†ç¾¤ï¼Œå¯å®¹å¿2å°æ•…éšœ
```

### 4.3 å¥åº·æ£€æµ‹ä¸Žæ•…éšœè½¬ç§»


**ðŸ”¸ å¿ƒè·³æœºåˆ¶**

```
å¿ƒè·³æ£€æµ‹æµç¨‹ï¼š

Follower â†’ Leader:
   |
   |--- æ¯éš”Xç§’å‘å¿ƒè·³ ---
   |                    |
   |                    â†“
   |                [Leader]
   |                    |
   |<--- æˆ‘æ”¶åˆ°äº†ï¼-------|
   |
   
å¦‚æžœLeaderæ²¡æ”¶åˆ°å¿ƒè·³ï¼š
Leaderåˆ¤æ–­ï¼šè¿™ä¸ªFollowerå¯èƒ½æŒ‚äº†
         
å¦‚æžœFolloweræ²¡æ”¶åˆ°å“åº”ï¼š
Followeråˆ¤æ–­ï¼šLeaderå¯èƒ½æŒ‚äº†
            â†“
         å‘èµ·æ–°é€‰ä¸¾
```

**ðŸ’¡ æ•…éšœè‡ªåŠ¨æ¢å¤**

```
åœºæ™¯1ï¼šFollowerå®•æœº
Follower-1 å®•æœº
         â†“
Leaderæ£€æµ‹åˆ°å¿ƒè·³è¶…æ—¶
         â†“
Leaderæ ‡è®°è¯¥èŠ‚ç‚¹ä¸º"ä¸‹çº¿"
         â†“
å…¶ä»–èŠ‚ç‚¹ç»§ç»­æ­£å¸¸å·¥ä½œ
         â†“
Follower-1 æ¢å¤
         â†“
é‡æ–°åŠ å…¥é›†ç¾¤ï¼ŒåŒæ­¥æ•°æ®

åœºæ™¯2ï¼šLeaderå®•æœº
Leader å®•æœº
         â†“
Followerä»¬æ£€æµ‹åˆ°å¿ƒè·³è¶…æ—¶
         â†“
å‘èµ·Leaderé€‰ä¸¾
         â†“
é€‰å‡ºæ–°çš„Leader
         â†“
æ–°LeaderæŽ¥ç®¡å·¥ä½œ
         â†“
æ—§Leaderæ¢å¤åŽå˜ä¸ºFollower
```

### 4.4 æ•°æ®åŒæ­¥æœºåˆ¶


**ðŸ”¸ åŒæ­¥ç­–ç•¥**

```
å†™æ•°æ®åŒæ­¥è¿‡ç¨‹ï¼š

å®¢æˆ·ç«¯å†™è¯·æ±‚ â†’ Leader
                  â†“
         Leaderå†™æœ¬åœ°æ—¥å¿—
                  â†“
         å¹¿æ’­ç»™æ‰€æœ‰Follower
                  â†“
         ç­‰å¾…è¿‡åŠFollowerç¡®è®¤
                  â†“
         æäº¤äº‹åŠ¡
                  â†“
         é€šçŸ¥Followeræäº¤
                  â†“
         è¿”å›žå®¢æˆ·ç«¯æˆåŠŸ

æ—¶é—´çº¿ï¼š
t1: Leaderæ”¶åˆ°å†™è¯·æ±‚
t2: LeaderåŒæ­¥ç»™Follower
t3: è¿‡åŠFollowerç¡®è®¤
t4: Leaderæäº¤å¹¶è¿”å›ž
t5: å…¶ä»–Followeré™†ç»­æäº¤

ä¿è¯ï¼šè¶…è¿‡åŠæ•°ç¡®è®¤æ‰ç®—æˆåŠŸ
```

---

## 5. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 5.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ Zookeeperæœ¬è´¨ï¼šåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¾®æœåŠ¡çš„"æ€»æœºè°ƒåº¦ä¸­å¿ƒ"
ðŸ”¸ å››å¤§æ ¸å¿ƒä½œç”¨ï¼š
   - æ³¨å†Œä¸­å¿ƒï¼ˆæœåŠ¡çš„æˆ·å£æœ¬ï¼‰
   - é…ç½®ä¸­å¿ƒï¼ˆç»Ÿä¸€é¥æŽ§å™¨ï¼‰
   - å‘½åæœåŠ¡ï¼ˆèº«ä»½è¯ç³»ç»Ÿï¼‰
   - é›†ç¾¤ç®¡ç†ï¼ˆç»„ç»‡åè°ƒå‘˜ï¼‰

ðŸ”¸ CAPå®šç†ï¼šåªèƒ½åŒæ—¶æ»¡è¶³Cã€Aã€Pä¸­çš„ä¸¤é¡¹
ðŸ”¸ Zookeeperé€‰æ‹©ï¼šCPï¼ˆå¼ºä¸€è‡´æ€§ + åˆ†åŒºå®¹é”™ï¼‰
ðŸ”¸ é›†ç¾¤è§’è‰²ï¼šLeaderï¼ˆ1ä¸ªï¼‰+ Followerï¼ˆå¤šä¸ªï¼‰
```

### 5.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦Zookeeper**
```
å¾®æœåŠ¡ç—›ç‚¹ï¼š
âŒ æœåŠ¡æ‰¾ä¸åˆ°å½¼æ­¤
âŒ é…ç½®ä¿®æ”¹è¦é‡å¯
âŒ é›†ç¾¤ç®¡ç†æ··ä¹±

Zookeeperè§£å†³ï¼š
âœ… ç»Ÿä¸€æ³¨å†Œå‘çŽ°
âœ… é…ç½®çƒ­æ›´æ–°
âœ… è‡ªåŠ¨é€‰ä¸¾å’Œæ•…éšœè½¬ç§»
```

**ðŸ”¹ å¼ºä¸€è‡´æ€§çš„æ„ä¹‰**
```
å…³é”®åœºæ™¯å¿…é¡»å¼ºä¸€è‡´ï¼š
âœ”ï¸ æœåŠ¡åœ°å€ï¼ˆé”™äº†å°±è°ƒç”¨å¤±è´¥ï¼‰
âœ”ï¸ é…ç½®ä¿¡æ¯ï¼ˆé”™äº†ç³»ç»Ÿå‡ºbugï¼‰
âœ”ï¸ åˆ†å¸ƒå¼é”ï¼ˆé”™äº†æ•°æ®ä¸ä¸€è‡´ï¼‰

ä»£ä»·ï¼š
- æ€§èƒ½ç›¸å¯¹æ…¢
- ç½‘ç»œåˆ†åŒºå¯èƒ½ä¸å¯ç”¨
- ä½†å…³é”®åœºæ™¯å€¼å¾—ä»˜å‡ºä»£ä»·
```

**ðŸ”¹ é›†ç¾¤çš„å®¹é”™è®¾è®¡**
```
è®¾è®¡åŽŸåˆ™ï¼š
- å¥‡æ•°å°æœåŠ¡å™¨ï¼ˆ3ã€5ã€7ï¼‰
- è¿‡åŠæœºåˆ¶ï¼ˆè¶…è¿‡åŠæ•°æ‰æœ‰æ•ˆï¼‰
- è‡ªåŠ¨é€‰ä¸¾ï¼ˆLeaderæŒ‚äº†ç«‹å³é€‰æ–°çš„ï¼‰

å®žé™…æ•ˆæžœï¼š
3å°é›†ç¾¤ â†’ å®¹å¿1å°æ•…éšœ
5å°é›†ç¾¤ â†’ å®¹å¿2å°æ•…éšœ
7å°é›†ç¾¤ â†’ å®¹å¿3å°æ•…éšœ
```

### 5.3 å®žé™…åº”ç”¨å»ºè®®


**ðŸŽ¯ ä½¿ç”¨åœºæ™¯**
- âœ… **æœåŠ¡æ³¨å†Œå‘çŽ°** - Dubboã€Spring Cloudéƒ½ç”¨
- âœ… **é…ç½®ç®¡ç†** - ç»Ÿä¸€é…ç½®ï¼ŒåŠ¨æ€æ›´æ–°
- âœ… **åˆ†å¸ƒå¼é”** - ä¿è¯æ“ä½œçš„äº’æ–¥æ€§
- âœ… **Masteré€‰ä¸¾** - è‡ªåŠ¨é€‰ä¸»ï¼Œæ•…éšœåˆ‡æ¢

**âš ï¸ ä¸é€‚åˆåœºæ™¯**  
- âŒ **å¤§æ•°æ®å­˜å‚¨** - Zookeeperä¸æ˜¯æ•°æ®åº“
- âŒ **é«˜é¢‘å†™å…¥** - å¼ºä¸€è‡´æ€§å½±å“æ€§èƒ½
- âŒ **æ¶ˆæ¯é˜Ÿåˆ—** - ä¸æ˜¯ä¸ºæ­¤è®¾è®¡çš„

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Zookeeperæ˜¯æ€»æœºï¼Œå¾®æœåŠ¡éƒ½æ‰¾å®ƒ
æ³¨å†Œå‘çŽ°é…ç½®ç®¡ï¼Œå‘½åæœåŠ¡ä¹Ÿé å®ƒ
CAPåªèƒ½é€‰ä¸¤ä¸ªï¼Œå¼ºä¸€è‡´æ€§æ˜¯å®ƒ
é›†ç¾¤å¥‡æ•°å¥½å®¹é”™ï¼Œè¿‡åŠæ‰èƒ½è¯´äº†ç®—
Leaderå¤„ç†å†™è¯·æ±‚ï¼ŒFollowerè´Ÿè´£æ¥æŠ•ç¥¨
```