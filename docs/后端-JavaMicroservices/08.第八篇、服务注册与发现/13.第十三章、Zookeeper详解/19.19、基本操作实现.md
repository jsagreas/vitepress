---
title: 19ã€åŸºæœ¬æ“ä½œå®ç°
---
## ğŸ“š ç›®å½•

1. [å®¢æˆ·ç«¯åŸºæœ¬æ“ä½œæ¦‚è¿°](#1-å®¢æˆ·ç«¯åŸºæœ¬æ“ä½œæ¦‚è¿°)
2. [åˆ›å»ºèŠ‚ç‚¹æ“ä½œ](#2-åˆ›å»ºèŠ‚ç‚¹æ“ä½œ)
3. [è¯»å–æ•°æ®æ“ä½œ](#3-è¯»å–æ•°æ®æ“ä½œ)
4. [æ›´æ–°æ•°æ®æ“ä½œ](#4-æ›´æ–°æ•°æ®æ“ä½œ)
5. [åˆ é™¤èŠ‚ç‚¹æ“ä½œ](#5-åˆ é™¤èŠ‚ç‚¹æ“ä½œ)
6. [è·å–å­èŠ‚ç‚¹æ“ä½œ](#6-è·å–å­èŠ‚ç‚¹æ“ä½œ)
7. [æ•°æ®ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶](#7-æ•°æ®ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å®¢æˆ·ç«¯åŸºæœ¬æ“ä½œæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Zookeeperå®¢æˆ·ç«¯æ“ä½œ


**é€šä¿—ç†è§£**ï¼šå°±åƒä½ ç”¨æ‰‹æœºAPPæ“ä½œäº‘ç›˜ä¸€æ ·ï¼ŒZookeeperå®¢æˆ·ç«¯å°±æ˜¯ä½ çš„"æ“ä½œå·¥å…·"

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
äº‘ç›˜æ“ä½œ              Zookeeperæ“ä½œ
â”œâ”€ åˆ›å»ºæ–‡ä»¶å¤¹    â†’    åˆ›å»ºèŠ‚ç‚¹(create)
â”œâ”€ æŸ¥çœ‹æ–‡ä»¶      â†’    è¯»å–æ•°æ®(getData)
â”œâ”€ ä¿®æ”¹æ–‡ä»¶      â†’    æ›´æ–°æ•°æ®(setData)
â”œâ”€ åˆ é™¤æ–‡ä»¶      â†’    åˆ é™¤èŠ‚ç‚¹(delete)
â”œâ”€ æŸ¥çœ‹ç›®å½•      â†’    è·å–å­èŠ‚ç‚¹(getChildren)
â””â”€ ç‰ˆæœ¬æ§åˆ¶      â†’    æ•°æ®ç‰ˆæœ¬(version)
```

**æ ¸å¿ƒæ“ä½œä¸€è§ˆ**ï¼š

| æ“ä½œç±»å‹ | **ä½œç”¨è¯´æ˜** | **å®é™…åº”ç”¨åœºæ™¯** | **è¿”å›ç»“æœ** |
|---------|------------|----------------|------------|
| ğŸ“ **create** | `åˆ›å»ºæ–°èŠ‚ç‚¹` | `æ³¨å†ŒæœåŠ¡ã€é…ç½®åˆå§‹åŒ–` | `èŠ‚ç‚¹è·¯å¾„` |
| ğŸ“– **getData** | `è¯»å–èŠ‚ç‚¹æ•°æ®` | `è·å–é…ç½®ã€æŸ¥è¯¢çŠ¶æ€` | `æ•°æ®å†…å®¹+ç‰ˆæœ¬` |
| âœï¸ **setData** | `æ›´æ–°èŠ‚ç‚¹æ•°æ®` | `ä¿®æ”¹é…ç½®ã€æ›´æ–°çŠ¶æ€` | `æ›´æ–°åçš„ç‰ˆæœ¬` |
| ğŸ—‘ï¸ **delete** | `åˆ é™¤èŠ‚ç‚¹` | `æœåŠ¡ä¸‹çº¿ã€æ¸…ç†é…ç½®` | `æ“ä½œæˆåŠŸ/å¤±è´¥` |
| ğŸ“‚ **getChildren** | `è·å–å­èŠ‚ç‚¹åˆ—è¡¨` | `æœåŠ¡å‘ç°ã€é›†ç¾¤ç®¡ç†` | `å­èŠ‚ç‚¹åç§°åˆ—è¡¨` |
| ğŸ”¢ **exists** | `æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨` | `åˆ¤æ–­æœåŠ¡çŠ¶æ€` | `èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯` |

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶


**é—®é¢˜åœºæ™¯**ï¼š
```
åœºæ™¯ï¼šä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶ä¿®æ”¹é…ç½®

æ—¶é—´çº¿ï¼š
å®¢æˆ·ç«¯Aè¯»å–é…ç½® version=5 â†’ ä¿®æ”¹æ•°æ® â†’ å‡†å¤‡å†™å…¥
å®¢æˆ·ç«¯Bè¯»å–é…ç½® version=5 â†’ ä¿®æ”¹æ•°æ® â†’ å…ˆå†™å…¥æˆåŠŸ version=6
å®¢æˆ·ç«¯Aå†™å…¥ â†’ ï¼Ÿï¼Ÿï¼Ÿä¼šè¦†ç›–Bçš„ä¿®æ”¹å—ï¼Ÿ

æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼šAä¼šè¦†ç›–Bçš„ä¿®æ”¹ï¼ˆæ•°æ®ä¸¢å¤±ï¼ï¼‰
æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼šAå†™å…¥å¤±è´¥ï¼Œæç¤ºç‰ˆæœ¬å†²çª
```

> ğŸ’¡ **æ ¸å¿ƒç†è§£**  
> ç‰ˆæœ¬å·å°±åƒæ–‡æ¡£çš„"ä¿®è®¢ç‰ˆ"ï¼Œç¡®ä¿æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯åŸºäºæœ€æ–°ç‰ˆæœ¬è¿›è¡Œçš„

---

## 2. ğŸ“ åˆ›å»ºèŠ‚ç‚¹æ“ä½œ


### 2.1 èŠ‚ç‚¹åˆ›å»ºçš„åŸºæœ¬æ¦‚å¿µ


**èŠ‚ç‚¹(ZNode)æ˜¯ä»€ä¹ˆ**ï¼šå¯ä»¥ç†è§£ä¸ºZookeeperä¸­çš„"æ–‡ä»¶å¤¹+æ–‡ä»¶"çš„ç»„åˆä½“

```
æ–‡ä»¶ç³»ç»Ÿå¯¹æ¯”ï¼š
/app/config/database.conf    â† æ—¢æ˜¯è·¯å¾„ï¼Œä¹Ÿå¯ä»¥å­˜æ•°æ®

ZookeeperèŠ‚ç‚¹ï¼š
/app/config/database         â† æ—¢æ˜¯èŠ‚ç‚¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥å­˜é…ç½®æ•°æ®
```

**èŠ‚ç‚¹ç±»å‹è¯¦è§£**ï¼š

```
æŒä¹…èŠ‚ç‚¹(PERSISTENT)
â”œâ”€ ç‰¹ç‚¹ï¼šåˆ›å»ºåæ°¸ä¹…å­˜åœ¨ï¼Œé™¤éä¸»åŠ¨åˆ é™¤
â”œâ”€ ç”¨é€”ï¼šå­˜å‚¨é…ç½®ä¿¡æ¯ã€å…ƒæ•°æ®
â””â”€ ç¤ºä¾‹ï¼š/config/databaseï¼ˆæ•°æ®åº“é…ç½®ï¼‰

æŒä¹…é¡ºåºèŠ‚ç‚¹(PERSISTENT_SEQUENTIAL)  
â”œâ”€ ç‰¹ç‚¹ï¼šæŒä¹…èŠ‚ç‚¹ + è‡ªåŠ¨ç¼–å·
â”œâ”€ ç”¨é€”ï¼šç”Ÿæˆå…¨å±€å”¯ä¸€ID
â””â”€ ç¤ºä¾‹ï¼š/queue/task0000000001ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰

ä¸´æ—¶èŠ‚ç‚¹(EPHEMERAL)
â”œâ”€ ç‰¹ç‚¹ï¼šä¼šè¯æ–­å¼€è‡ªåŠ¨åˆ é™¤
â”œâ”€ ç”¨é€”ï¼šæœåŠ¡æ³¨å†Œã€å¿ƒè·³æ£€æµ‹
â””â”€ ç¤ºä¾‹ï¼š/services/order-serviceï¼ˆè®¢å•æœåŠ¡å®ä¾‹ï¼‰

ä¸´æ—¶é¡ºåºèŠ‚ç‚¹(EPHEMERAL_SEQUENTIAL)
â”œâ”€ ç‰¹ç‚¹ï¼šä¸´æ—¶èŠ‚ç‚¹ + è‡ªåŠ¨ç¼–å·
â”œâ”€ ç”¨é€”ï¼šåˆ†å¸ƒå¼é”ã€é€‰ä¸¾
â””â”€ ç¤ºä¾‹ï¼š/lock/lock0000000001ï¼ˆé”åºå·ï¼‰
```

### 2.2 åˆ›å»ºèŠ‚ç‚¹å®æˆ˜


**åŸºç¡€åˆ›å»ºç¤ºä¾‹**ï¼š

```java
// åˆ›å»ºæŒä¹…èŠ‚ç‚¹
String path = zooKeeper.create(
    "/config/app",           // èŠ‚ç‚¹è·¯å¾„
    "v1.0".getBytes(),       // èŠ‚ç‚¹æ•°æ®
    ZooDefs.Ids.OPEN_ACL_UNSAFE,  // è®¿é—®æƒé™
    CreateMode.PERSISTENT    // èŠ‚ç‚¹ç±»å‹
);
```

**å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | **å«ä¹‰è¯´æ˜** | **å¸¸ç”¨å€¼** |
|-----|------------|-----------|
| `path` | `èŠ‚ç‚¹è·¯å¾„ï¼Œç±»ä¼¼æ–‡ä»¶è·¯å¾„` | `/app/config` |
| `data` | `èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®(å­—èŠ‚æ•°ç»„)` | `é…ç½®å†…å®¹ã€çŠ¶æ€ä¿¡æ¯` |
| `acl` | `è®¿é—®æ§åˆ¶åˆ—è¡¨(æƒé™)` | `OPEN_ACL_UNSAFE`(å®Œå…¨å¼€æ”¾) |
| `createMode` | `èŠ‚ç‚¹ç±»å‹` | `PERSISTENT/EPHEMERAL` |

**å®ç”¨åœºæ™¯ç¤ºä¾‹**ï¼š

```java
// åœºæ™¯1ï¼šæœåŠ¡æ³¨å†Œï¼ˆä¸´æ—¶èŠ‚ç‚¹ï¼‰
public void registerService(String serviceName, String host, int port) {
    String servicePath = "/services/" + serviceName;
    String serviceData = host + ":" + port;
    
    zooKeeper.create(
        servicePath,
        serviceData.getBytes(),
        ZooDefs.Ids.OPEN_ACL_UNSAFE,
        CreateMode.EPHEMERAL  // æœåŠ¡ä¸‹çº¿è‡ªåŠ¨åˆ é™¤
    );
}

// åœºæ™¯2ï¼šåˆ†å¸ƒå¼é”ï¼ˆä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼‰
public String acquireLock(String lockName) {
    return zooKeeper.create(
        "/locks/" + lockName + "/lock-",  // æ³¨æ„ç»“å°¾æœ‰-
        "".getBytes(),
        ZooDefs.Ids.OPEN_ACL_UNSAFE,
        CreateMode.EPHEMERAL_SEQUENTIAL  // è‡ªåŠ¨ç¼–å·
    );
    // è¿”å›ï¼š/locks/mylock/lock-0000000001
}
```

> âš ï¸ **å¸¸è§é”™è¯¯**  
> - åˆ›å»ºèŠ‚ç‚¹å‰ï¼Œçˆ¶èŠ‚ç‚¹å¿…é¡»å­˜åœ¨ï¼ˆä¸ä¼šè‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼‰
> - åŒä¸€è·¯å¾„ä¸èƒ½é‡å¤åˆ›å»ºï¼ˆä¼šæŠ›NodeExistsExceptionï¼‰
> - ä¸´æ—¶èŠ‚ç‚¹ä¸‹ä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹

### 2.3 æ‰¹é‡åˆ›å»ºå’Œé€’å½’åˆ›å»º


**é€’å½’åˆ›å»ºå·¥å…·æ–¹æ³•**ï¼š

```java
// é€’å½’åˆ›å»ºèŠ‚ç‚¹ï¼ˆè‡ªåŠ¨åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼‰
public void createRecursive(String path, byte[] data) throws Exception {
    // æ£€æŸ¥çˆ¶èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
    String parentPath = path.substring(0, path.lastIndexOf('/'));
    
    if (parentPath.length() > 0 && zooKeeper.exists(parentPath, false) == null) {
        createRecursive(parentPath, new byte[0]);  // é€’å½’åˆ›å»ºçˆ¶èŠ‚ç‚¹
    }
    
    // åˆ›å»ºå½“å‰èŠ‚ç‚¹
    if (zooKeeper.exists(path, false) == null) {
        zooKeeper.create(path, data, ZooDefs.Ids.OPEN_ACL_UNSAFE, 
                        CreateMode.PERSISTENT);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
createRecursive("/app/config/database", "mysql://localhost:3306".getBytes());
// ä¼šè‡ªåŠ¨åˆ›å»º /app â†’ /app/config â†’ /app/config/database
```

---

## 3. ğŸ“– è¯»å–æ•°æ®æ“ä½œ


### 3.1 è¯»å–æ•°æ®çš„æ ¸å¿ƒæ–¹æ³•


**getDataæ–¹æ³•è¯¦è§£**ï¼š

```java
// åŸºæœ¬ç”¨æ³•
byte[] data = zooKeeper.getData(
    "/config/app",      // è¦è¯»å–çš„èŠ‚ç‚¹è·¯å¾„
    false,              // æ˜¯å¦è®¾ç½®ç›‘å¬
    null                // èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
);
String config = new String(data);
```

**å¸¦çŠ¶æ€ä¿¡æ¯çš„è¯»å–**ï¼š

```java
Stat stat = new Stat();  // ç”¨äºæ¥æ”¶èŠ‚ç‚¹çŠ¶æ€
byte[] data = zooKeeper.getData("/config/app", false, stat);

// statåŒ…å«ä¸°å¯Œçš„èŠ‚ç‚¹ä¿¡æ¯
System.out.println("æ•°æ®ç‰ˆæœ¬ï¼š" + stat.getVersion());
System.out.println("åˆ›å»ºæ—¶é—´ï¼š" + stat.getCtime());
System.out.println("ä¿®æ”¹æ—¶é—´ï¼š" + stat.getMtime());
System.out.println("æ•°æ®é•¿åº¦ï¼š" + stat.getDataLength());
```

**StatçŠ¶æ€ä¿¡æ¯è§£æ**ï¼š

| å­—æ®µ | **å«ä¹‰** | **ç”¨é€”** |
|-----|---------|---------|
| `version` | `æ•°æ®ç‰ˆæœ¬å·` | `ä¹è§‚é”æ§åˆ¶` |
| `cversion` | `å­èŠ‚ç‚¹ç‰ˆæœ¬å·` | `ç›‘æ§å­èŠ‚ç‚¹å˜åŒ–` |
| `aversion` | `ACLç‰ˆæœ¬å·` | `æƒé™å˜æ›´æ£€æµ‹` |
| `ctime` | `åˆ›å»ºæ—¶é—´æˆ³` | `èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ` |
| `mtime` | `ä¿®æ”¹æ—¶é—´æˆ³` | `æ•°æ®æ›´æ–°æ—¶é—´` |
| `dataLength` | `æ•°æ®é•¿åº¦` | `æ•°æ®å¤§å°é™åˆ¶` |

### 3.2 å¸¦ç›‘å¬çš„æ•°æ®è¯»å–


**Watcherç›‘å¬æœºåˆ¶**ï¼š

```
ç›‘å¬æµç¨‹å›¾ï¼š
å®¢æˆ·ç«¯                           ZookeeperæœåŠ¡å™¨
  |                                    |
  |--[1]getData(path, watcher)------â†’|
  |â†-[2]è¿”å›æ•°æ®+æ³¨å†Œç›‘å¬-------------|
  |                                    |
  |    ... æ•°æ®è¢«ä¿®æ”¹ ...              |
  |                                    |
  |â†-[3]è§¦å‘watcheräº‹ä»¶---------------|
  |                                    |
  |--[4]å¤„ç†äº‹ä»¶+é‡æ–°æ³¨å†Œç›‘å¬--------â†’|
```

**å®æˆ˜ç¤ºä¾‹**ï¼š

```java
// å®šä¹‰ç›‘å¬å™¨
Watcher watcher = new Watcher() {
    @Override
    public void process(WatchedEvent event) {
        if (event.getType() == Event.EventType.NodeDataChanged) {
            System.out.println("é…ç½®å·²æ›´æ–°ï¼š" + event.getPath());
            // é‡æ–°è¯»å–æ•°æ®ï¼ˆä¸€æ¬¡æ€§ç›‘å¬ï¼Œéœ€è¦é‡æ–°æ³¨å†Œï¼‰
            try {
                byte[] newData = zooKeeper.getData(event.getPath(), this, null);
                System.out.println("æœ€æ–°é…ç½®ï¼š" + new String(newData));
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
};

// é¦–æ¬¡è¯»å–å¹¶è®¾ç½®ç›‘å¬
byte[] data = zooKeeper.getData("/config/app", watcher, null);
```

> ğŸ’¡ **ç›‘å¬æœºåˆ¶ç‰¹ç‚¹**  
> - **ä¸€æ¬¡æ€§è§¦å‘**ï¼šæ¯æ¬¡ç›‘å¬åªè§¦å‘ä¸€æ¬¡ï¼Œéœ€è¦é‡æ–°æ³¨å†Œ
> - **è½»é‡çº§é€šçŸ¥**ï¼šåªå‘Šè¯‰ä½ "å˜äº†"ï¼Œä¸å‘Šè¯‰ä½ "å˜æˆä»€ä¹ˆ"
> - **æœ‰åºä¿è¯**ï¼šäº‹ä»¶é€šçŸ¥é¡ºåºä¸æ•°æ®å˜æ›´é¡ºåºä¸€è‡´

---

## 4. âœï¸ æ›´æ–°æ•°æ®æ“ä½œ


### 4.1 åŸºæœ¬æ›´æ–°æ–¹æ³•


**setDataæ–¹æ³•è¯¦è§£**ï¼š

```java
// åŸºæœ¬æ›´æ–°ï¼ˆä¸æŒ‡å®šç‰ˆæœ¬ï¼‰
Stat stat = zooKeeper.setData(
    "/config/app",              // èŠ‚ç‚¹è·¯å¾„
    "v2.0".getBytes(),          // æ–°æ•°æ®
    -1                          // ç‰ˆæœ¬å·ï¼ˆ-1è¡¨ç¤ºä¸æ£€æŸ¥ç‰ˆæœ¬ï¼‰
);
```

**ç‰ˆæœ¬æ§åˆ¶çš„æ›´æ–°**ï¼š

```java
// å®‰å…¨æ›´æ–°æµç¨‹
public boolean safeUpdate(String path, String newValue) {
    try {
        // 1. å…ˆè¯»å–å½“å‰ç‰ˆæœ¬
        Stat stat = new Stat();
        byte[] oldData = zooKeeper.getData(path, false, stat);
        int currentVersion = stat.getVersion();
        
        // 2. åŸºäºå½“å‰ç‰ˆæœ¬æ›´æ–°
        zooKeeper.setData(path, newValue.getBytes(), currentVersion);
        return true;
        
    } catch (KeeperException.BadVersionException e) {
        // ç‰ˆæœ¬å†²çªï¼Œå…¶ä»–å®¢æˆ·ç«¯å·²ä¿®æ”¹
        System.out.println("æ›´æ–°å¤±è´¥ï¼šæ•°æ®å·²è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹");
        return false;
    } catch (Exception e) {
        e.printStackTrace();
        return false;
    }
}
```

### 4.2 å¹¶å‘æ›´æ–°åœºæ™¯


**åœºæ™¯ï¼šå¤šå®¢æˆ·ç«¯åŒæ—¶ä¿®æ”¹é…ç½®**

```
æ—¶é—´è½´æ¼”ç¤ºï¼š
æ—¶åˆ»    å®¢æˆ·ç«¯A                     å®¢æˆ·ç«¯B
T1     è¯»å–æ•°æ® v=5               
T2     ä¿®æ”¹ä¸º"configA"             è¯»å–æ•°æ® v=5
T3     å†™å…¥æˆåŠŸ v=6               
T4                                å†™å…¥å¤±è´¥ï¼ˆv=5è¿‡æœŸï¼‰
T5                                é‡æ–°è¯»å– v=6
T6                                åŸºäºv=6ä¿®æ”¹
T7                                å†™å…¥æˆåŠŸ v=7
```

**å¯¹æ¯”ï¼šæœ‰æ— ç‰ˆæœ¬æ§åˆ¶**

| æƒ…å†µ | **æ— ç‰ˆæœ¬æ§åˆ¶(-1)** | **æœ‰ç‰ˆæœ¬æ§åˆ¶** |
|-----|------------------|--------------|
| `å¹¶å‘å†™å…¥` | `åå†™å…¥è¦†ç›–å…ˆå†™å…¥` | `ç‰ˆæœ¬å†²çªï¼Œå†™å…¥å¤±è´¥` |
| `æ•°æ®å®‰å…¨` | `å¯èƒ½ä¸¢å¤±æ•°æ®` | `ä¿è¯æ•°æ®å®Œæ•´æ€§` |
| `é€‚ç”¨åœºæ™¯` | `æ— å…³ç´§è¦çš„æ•°æ®` | `å…³é”®é…ç½®ã€çŠ¶æ€ä¿¡æ¯` |

**CAS(Compare-And-Swap)æ¨¡å¼å®ç°**ï¼š

```java
// ç±»ä¼¼AtomicIntegerçš„CASæ“ä½œ
public void updateWithRetry(String path, Function<String, String> updater) {
    int maxRetry = 3;
    for (int i = 0; i < maxRetry; i++) {
        try {
            Stat stat = new Stat();
            byte[] data = zooKeeper.getData(path, false, stat);
            
            // åº”ç”¨æ›´æ–°å‡½æ•°
            String oldValue = new String(data);
            String newValue = updater.apply(oldValue);
            
            // å°è¯•æ›´æ–°
            zooKeeper.setData(path, newValue.getBytes(), stat.getVersion());
            return;  // æˆåŠŸ
            
        } catch (KeeperException.BadVersionException e) {
            // ç‰ˆæœ¬å†²çªï¼Œé‡è¯•
            if (i == maxRetry - 1) {
                throw new RuntimeException("æ›´æ–°å¤±è´¥ï¼Œè¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°");
            }
        }
    }
}
```

---

## 5. ğŸ—‘ï¸ åˆ é™¤èŠ‚ç‚¹æ“ä½œ


### 5.1 åˆ é™¤æ“ä½œåŸºç¡€


**deleteæ–¹æ³•è¯¦è§£**ï¼š

```java
// åŸºæœ¬åˆ é™¤
zooKeeper.delete(
    "/config/app",    // è¦åˆ é™¤çš„èŠ‚ç‚¹è·¯å¾„
    -1                // ç‰ˆæœ¬å·ï¼ˆ-1è¡¨ç¤ºä¸æ£€æŸ¥ç‰ˆæœ¬ï¼‰
);
```

**å®‰å…¨åˆ é™¤ï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰**ï¼š

```java
// åœºæ™¯ï¼šç¡®ä¿åˆ é™¤çš„æ˜¯é¢„æœŸç‰ˆæœ¬
public void safeDelete(String path) throws Exception {
    Stat stat = zooKeeper.exists(path, false);
    if (stat != null) {
        // åŸºäºå½“å‰ç‰ˆæœ¬åˆ é™¤
        zooKeeper.delete(path, stat.getVersion());
    }
}
```

### 5.2 åˆ é™¤é™åˆ¶å’Œæ³¨æ„äº‹é¡¹


**é‡è¦è§„åˆ™**ï¼š

```
åˆ é™¤é™åˆ¶ï¼š
âœ“ åªèƒ½åˆ é™¤å¶å­èŠ‚ç‚¹ï¼ˆæ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼‰
âœ— ä¸èƒ½ç›´æ¥åˆ é™¤æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹

ç¤ºä¾‹ï¼š
/app/config
    â”œâ”€ database     â† æœ‰å­èŠ‚ç‚¹
    â”‚   â””â”€ mysql    â† å¶å­èŠ‚ç‚¹ï¼ˆå¯åˆ é™¤ï¼‰
    â””â”€ cache        â† å¶å­èŠ‚ç‚¹ï¼ˆå¯åˆ é™¤ï¼‰

åˆ é™¤é¡ºåºï¼š
1. å…ˆåˆ é™¤ /app/config/database/mysql
2. å†åˆ é™¤ /app/config/database
3. æœ€ååˆ é™¤ /app/config
```

**é€’å½’åˆ é™¤å®ç°**ï¼š

```java
// é€’å½’åˆ é™¤èŠ‚ç‚¹åŠæ‰€æœ‰å­èŠ‚ç‚¹
public void deleteRecursive(String path) throws Exception {
    // è·å–æ‰€æœ‰å­èŠ‚ç‚¹
    List<String> children = zooKeeper.getChildren(path, false);
    
    // å…ˆåˆ é™¤æ‰€æœ‰å­èŠ‚ç‚¹
    for (String child : children) {
        deleteRecursive(path + "/" + child);
    }
    
    // æœ€ååˆ é™¤å½“å‰èŠ‚ç‚¹
    zooKeeper.delete(path, -1);
}
```

> âš ï¸ **åˆ é™¤æ³¨æ„äº‹é¡¹**  
> - ä¸´æ—¶èŠ‚ç‚¹ä¼šè¯æ–­å¼€è‡ªåŠ¨åˆ é™¤ï¼Œæ— éœ€æ‰‹åŠ¨åˆ é™¤
> - åˆ é™¤èŠ‚ç‚¹ä¼šè§¦å‘ç›‘å¬è¯¥èŠ‚ç‚¹çš„Watcher
> - åˆ é™¤åç‰ˆæœ¬å·ä¿¡æ¯æ°¸ä¹…ä¸¢å¤±

### 5.3 åˆ é™¤åº”ç”¨åœºæ™¯


**åœºæ™¯1ï¼šæœåŠ¡ä¸‹çº¿**

```java
// æœåŠ¡ä¼˜é›…ä¸‹çº¿
public void unregisterService(String servicePath) {
    try {
        // æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
        if (zooKeeper.exists(servicePath, false) != null) {
            zooKeeper.delete(servicePath, -1);
            System.out.println("æœåŠ¡å·²ä¸‹çº¿ï¼š" + servicePath);
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

**åœºæ™¯2ï¼šæ¸…ç†è¿‡æœŸé”**

```java
// é‡Šæ”¾åˆ†å¸ƒå¼é”
public void releaseLock(String lockPath) throws Exception {
    // åˆ é™¤è‡ªå·±åˆ›å»ºçš„ä¸´æ—¶é¡ºåºèŠ‚ç‚¹
    zooKeeper.delete(lockPath, -1);
}
```

---

## 6. ğŸ“‚ è·å–å­èŠ‚ç‚¹æ“ä½œ


### 6.1 getChildrenæ–¹æ³•è¯¦è§£


**åŸºæœ¬ç”¨æ³•**ï¼š

```java
// è·å–å­èŠ‚ç‚¹åˆ—è¡¨
List<String> children = zooKeeper.getChildren(
    "/services",     // çˆ¶èŠ‚ç‚¹è·¯å¾„
    false            // æ˜¯å¦è®¾ç½®ç›‘å¬
);

// è¾“å‡ºç¤ºä¾‹ï¼š[order-service, user-service, payment-service]
```

**å®Œæ•´ç¤ºä¾‹**ï¼š

```java
// æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„æœåŠ¡
public void listServices() throws Exception {
    List<String> services = zooKeeper.getChildren("/services", false);
    
    System.out.println("å·²æ³¨å†ŒæœåŠ¡åˆ—è¡¨ï¼š");
    for (String service : services) {
        // è·å–æ¯ä¸ªæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯
        String servicePath = "/services/" + service;
        byte[] data = zooKeeper.getData(servicePath, false, null);
        System.out.println("- " + service + ": " + new String(data));
    }
}
```

### 6.2 ç›‘å¬å­èŠ‚ç‚¹å˜åŒ–


**æœåŠ¡å‘ç°åœºæ™¯**ï¼š

```
æœåŠ¡å‘ç°æµç¨‹ï¼š
å®¢æˆ·ç«¯                          Zookeeper
  |                                |
  |--è·å–/servicesçš„å­èŠ‚ç‚¹------â†’ |
  |â†-è¿”å›[service1, service2]----- |
  |--æ³¨å†Œå­èŠ‚ç‚¹å˜åŒ–ç›‘å¬----------â†’|
  |                                |
  |    æ–°æœåŠ¡æ³¨å†Œ service3         |
  |â†-è§¦å‘NodeChildrenChangedäº‹ä»¶--|
  |                                |
  |--é‡æ–°è·å–å­èŠ‚ç‚¹åˆ—è¡¨----------â†’|
  |â†-è¿”å›[service1,service2,service3]|
```

**å®æˆ˜ä»£ç **ï¼š

```java
// æœåŠ¡å‘ç°ç›‘å¬å™¨
public class ServiceDiscovery {
    private ZooKeeper zooKeeper;
    private List<String> serviceList = new CopyOnWriteArrayList<>();
    
    public void watchServices() throws Exception {
        // å®šä¹‰å­èŠ‚ç‚¹å˜åŒ–ç›‘å¬å™¨
        Watcher childrenWatcher = new Watcher() {
            @Override
            public void process(WatchedEvent event) {
                if (event.getType() == Event.EventType.NodeChildrenChanged) {
                    try {
                        // å­èŠ‚ç‚¹å˜åŒ–ï¼Œé‡æ–°è·å–åˆ—è¡¨
                        updateServiceList();
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                }
            }
        };
        
        updateServiceList();
    }
    
    private void updateServiceList() throws Exception {
        // è·å–å­èŠ‚ç‚¹å¹¶é‡æ–°æ³¨å†Œç›‘å¬
        List<String> children = zooKeeper.getChildren("/services", 
                                    this::watchServices);
        
        serviceList.clear();
        serviceList.addAll(children);
        System.out.println("æœåŠ¡åˆ—è¡¨æ›´æ–°ï¼š" + serviceList);
    }
}
```

### 6.3 å­èŠ‚ç‚¹ç›‘å¬ç±»å‹


**ä¸‰ç§äº‹ä»¶ç±»å‹å¯¹æ¯”**ï¼š

| äº‹ä»¶ç±»å‹ | **è§¦å‘æ¡ä»¶** | **åº”ç”¨åœºæ™¯** |
|---------|------------|------------|
| `NodeChildrenChanged` | `å­èŠ‚ç‚¹å¢åŠ /åˆ é™¤` | `æœåŠ¡å‘ç°ã€é›†ç¾¤ç›‘æ§` |
| `NodeDataChanged` | `èŠ‚ç‚¹æ•°æ®ä¿®æ”¹` | `é…ç½®å˜æ›´ã€çŠ¶æ€æ›´æ–°` |
| `NodeDeleted` | `èŠ‚ç‚¹è¢«åˆ é™¤` | `æœåŠ¡ä¸‹çº¿ã€èµ„æºé‡Šæ”¾` |

---

## 7. ğŸ”¢ æ•°æ®ç‰ˆæœ¬æ§åˆ¶æœºåˆ¶


### 7.1 ç‰ˆæœ¬å·ä½“ç³»è¯¦è§£


**ä¸‰ç§ç‰ˆæœ¬å·**ï¼š

```
èŠ‚ç‚¹ç‰ˆæœ¬ä¿¡æ¯ï¼š
/config/app
â”œâ”€ version (dataVersion)    â† æ•°æ®ç‰ˆæœ¬
â”‚   â””â”€ ç”¨é€”ï¼šæ•°æ®ä¿®æ”¹æ—¶+1
â”œâ”€ cversion (childVersion)  â† å­èŠ‚ç‚¹ç‰ˆæœ¬  
â”‚   â””â”€ ç”¨é€”ï¼šå­èŠ‚ç‚¹å˜åŒ–æ—¶+1
â””â”€ aversion (aclVersion)    â† ACLç‰ˆæœ¬
    â””â”€ ç”¨é€”ï¼šæƒé™ä¿®æ”¹æ—¶+1
```

**ç‰ˆæœ¬å·ç¤ºä¾‹**ï¼š

```java
Stat stat = zooKeeper.exists("/config/app", false);

System.out.println("æ•°æ®ç‰ˆæœ¬ï¼š" + stat.getVersion());      // 0,1,2...
System.out.println("å­èŠ‚ç‚¹ç‰ˆæœ¬ï¼š" + stat.getCversion());    // 0,1,2...
System.out.println("ACLç‰ˆæœ¬ï¼š" + stat.getAversion());      // 0,1,2...
```

### 7.2 ä¹è§‚é”å®ç°åŸç†


**ä»€ä¹ˆæ˜¯ä¹è§‚é”**ï¼š

```
æ‚²è§‚é”æ€æƒ³ï¼š
æ¯æ¬¡æ“ä½œå‰å…ˆåŠ é” â†’ æ“ä½œ â†’ é‡Šæ”¾é”
ç¼ºç‚¹ï¼šå¹¶å‘åº¦ä½ï¼Œå¯èƒ½æ­»é”

ä¹è§‚é”æ€æƒ³ï¼š
è¯»å–æ•°æ®+ç‰ˆæœ¬ â†’ ä¿®æ”¹æ•°æ® â†’ æäº¤æ—¶æ£€æŸ¥ç‰ˆæœ¬
ä¼˜ç‚¹ï¼šé«˜å¹¶å‘ï¼Œæ— é”å¼€é”€
```

**ç‰ˆæœ¬å·å·¥ä½œæµç¨‹**ï¼š

```
æ­¥éª¤è¯¦è§£ï¼š
1. å®¢æˆ·ç«¯Aè¯»å–æ•°æ®ï¼švalue="100", version=5
2. å®¢æˆ·ç«¯Bè¯»å–æ•°æ®ï¼švalue="100", version=5
3. Aè®¡ç®—æ–°å€¼ï¼š"150"ï¼Œå°è¯•æ›´æ–°ï¼ˆåŸºäºversion=5ï¼‰
4. Aæ›´æ–°æˆåŠŸï¼švalue="150", version=6
5. Bè®¡ç®—æ–°å€¼ï¼š"200"ï¼Œå°è¯•æ›´æ–°ï¼ˆåŸºäºversion=5ï¼‰
6. Bæ›´æ–°å¤±è´¥ï¼šç‰ˆæœ¬å†²çªï¼å½“å‰ç‰ˆæœ¬å·²æ˜¯6ï¼Œä¸æ˜¯5
7. Bé‡æ–°è¯»å–ï¼švalue="150", version=6
8. Bé‡æ–°è®¡ç®—å¹¶æ›´æ–°æˆåŠŸ
```

**å®Œæ•´å®ç°**ï¼š

```java
// åˆ†å¸ƒå¼è®¡æ•°å™¨ï¼ˆåŸºäºä¹è§‚é”ï¼‰
public class DistributedCounter {
    private ZooKeeper zooKeeper;
    private String counterPath;
    
    // å¢åŠ è®¡æ•°ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
    public int increment() throws Exception {
        while (true) {
            try {
                // 1. è¯»å–å½“å‰å€¼å’Œç‰ˆæœ¬
                Stat stat = new Stat();
                byte[] data = zooKeeper.getData(counterPath, false, stat);
                int currentValue = Integer.parseInt(new String(data));
                int currentVersion = stat.getVersion();
                
                // 2. è®¡ç®—æ–°å€¼
                int newValue = currentValue + 1;
                
                // 3. å°è¯•æ›´æ–°ï¼ˆCASæ“ä½œï¼‰
                zooKeeper.setData(counterPath, 
                                String.valueOf(newValue).getBytes(), 
                                currentVersion);
                
                return newValue;  // æˆåŠŸ
                
            } catch (KeeperException.BadVersionException e) {
                // ç‰ˆæœ¬å†²çªï¼Œè‡ªæ—‹é‡è¯•
                continue;
            }
        }
    }
}
```

### 7.3 ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ


**ä½¿ç”¨å»ºè®®**ï¼š

| åœºæ™¯ | **ç‰ˆæœ¬ç­–ç•¥** | **åŸå› ** |
|-----|------------|---------|
| `é…ç½®ä¸­å¿ƒ` | `å¿…é¡»ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶` | `é˜²æ­¢é…ç½®è¦†ç›–` |
| `åˆ†å¸ƒå¼é”` | `ä½¿ç”¨ç‰ˆæœ¬æˆ–åºå·` | `ç¡®ä¿é”çš„æ­£ç¡®æ€§` |
| `è®¡æ•°å™¨` | `å¿…é¡»ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶` | `ä¿è¯è®¡æ•°å‡†ç¡®` |
| `æ—¥å¿—è®°å½•` | `å¯ä»¥ä¸ç”¨ç‰ˆæœ¬(-1)` | `è¿½åŠ å†™å…¥æ— å†²çª` |
| `ä¸´æ—¶çŠ¶æ€` | `å¯ä»¥ä¸ç”¨ç‰ˆæœ¬(-1)` | `å…è®¸è¦†ç›–` |

**é”™è¯¯å¤„ç†æ¨¡å¼**ï¼š

```java
// æ ‡å‡†çš„ç‰ˆæœ¬å†²çªå¤„ç†
public void updateWithVersionCheck(String path, String newData) {
    int maxRetry = 3;
    int retryCount = 0;
    
    while (retryCount < maxRetry) {
        try {
            Stat stat = new Stat();
            zooKeeper.getData(path, false, stat);
            
            // å°è¯•æ›´æ–°
            zooKeeper.setData(path, newData.getBytes(), stat.getVersion());
            return;  // æˆåŠŸ
            
        } catch (KeeperException.BadVersionException e) {
            retryCount++;
            if (retryCount >= maxRetry) {
                throw new RuntimeException("ç‰ˆæœ¬å†²çªï¼Œè¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°", e);
            }
            // å»¶è¿Ÿé‡è¯•ï¼Œé¿å…é¢‘ç¹å†²çª
            Thread.sleep(100);
        }
    }
}
```

> ğŸ’¡ **ç‰ˆæœ¬æ§åˆ¶æ ¸å¿ƒæ€æƒ³**  
> - è¯»å–æ—¶è®°å½•ç‰ˆæœ¬å·
> - ä¿®æ”¹æ—¶æ£€æŸ¥ç‰ˆæœ¬å·
> - å†²çªæ—¶é‡æ–°è¯»å–æˆ–æ”¾å¼ƒ

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å…­å¤§åŸºæœ¬æ“ä½œé€ŸæŸ¥


```
æ“ä½œé€ŸæŸ¥è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ create()   â†’ åˆ›å»ºèŠ‚ç‚¹ï¼ˆ4ç§ç±»å‹ï¼‰             â”‚
â”‚ getData()  â†’ è¯»å–æ•°æ®ï¼ˆå¯è®¾ç½®ç›‘å¬ï¼‰          â”‚
â”‚ setData()  â†’ æ›´æ–°æ•°æ®ï¼ˆæ”¯æŒç‰ˆæœ¬æ§åˆ¶ï¼‰        â”‚
â”‚ delete()   â†’ åˆ é™¤èŠ‚ç‚¹ï¼ˆåªèƒ½åˆ å¶å­èŠ‚ç‚¹ï¼‰      â”‚
â”‚ getChildren() â†’ è·å–å­èŠ‚ç‚¹ï¼ˆå¯ç›‘å¬å˜åŒ–ï¼‰     â”‚
â”‚ exists()   â†’ æ£€æŸ¥èŠ‚ç‚¹ï¼ˆè¿”å›çŠ¶æ€ä¿¡æ¯ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æ ¸å¿ƒæ¦‚å¿µç†è§£


**ğŸ”¸ èŠ‚ç‚¹ç±»å‹é€‰æ‹©**

```
æŒä¹…èŠ‚ç‚¹ï¼šé…ç½®æ•°æ®ã€å…ƒæ•°æ®
æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼šå…¨å±€IDç”Ÿæˆ
ä¸´æ—¶èŠ‚ç‚¹ï¼šæœåŠ¡æ³¨å†Œã€å¿ƒè·³
ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼šåˆ†å¸ƒå¼é”ã€é€‰ä¸¾
```

**ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶åŸåˆ™**

```
ä½•æ—¶ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼š
âœ“ å…³é”®é…ç½®ä¿®æ”¹
âœ“ åˆ†å¸ƒå¼è®¡æ•°å™¨
âœ“ çŠ¶æ€æœºè½¬æ¢
âœ“ å¤šå®¢æˆ·ç«¯å¹¶å‘å†™

ä½•æ—¶ä¸ç”¨ç‰ˆæœ¬(-1)ï¼š
âœ“ æ—¥å¿—è¿½åŠ å†™å…¥
âœ“ ä¸´æ—¶çŠ¶æ€æ›´æ–°
âœ“ æ— å…³ç´§è¦çš„æ•°æ®
```

**ğŸ”¸ ç›‘å¬æœºåˆ¶è¦ç‚¹**

```
Watcherç‰¹æ€§ï¼š
â€¢ ä¸€æ¬¡æ€§è§¦å‘ï¼ˆéœ€é‡æ–°æ³¨å†Œï¼‰
â€¢ è½»é‡çº§é€šçŸ¥ï¼ˆä¸ä¼ é€’æ•°æ®ï¼‰
â€¢ æœ‰åºæ€§ä¿è¯ï¼ˆé¡ºåºä¸€è‡´ï¼‰
â€¢ å®¢æˆ·ç«¯å›è°ƒï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
```

### 8.3 å®æˆ˜åº”ç”¨æ¨¡å¼


**é…ç½®ä¸­å¿ƒæ¨¡å¼**ï¼š
```java
// è¯»å–é…ç½® + ç›‘å¬å˜åŒ–
getData(path, watcher, stat) â†’ åº”ç”¨é…ç½® â†’ ç›‘å¬æ›´æ–° â†’ é‡æ–°åŠ è½½
```

**æœåŠ¡æ³¨å†Œæ¨¡å¼**ï¼š
```java
// åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ + ç›‘å¬å­èŠ‚ç‚¹
create(EPHEMERAL) â†’ getChildren(watcher) â†’ å‘ç°æœåŠ¡ â†’ æ›´æ–°åˆ—è¡¨
```

**åˆ†å¸ƒå¼é”æ¨¡å¼**ï¼š
```java
// åˆ›å»ºé¡ºåºèŠ‚ç‚¹ + ç‰ˆæœ¬æ§åˆ¶
create(EPHEMERAL_SEQUENTIAL) â†’ åˆ¤æ–­åºå· â†’ è·å–é” â†’ deleteé‡Šæ”¾
```

**åˆ†å¸ƒå¼è®¡æ•°å™¨æ¨¡å¼**ï¼š
```java
// è¯»å–ç‰ˆæœ¬ + CASæ›´æ–°
getData(stat) â†’ increment â†’ setData(version) â†’ é‡è¯•æœºåˆ¶
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**é—®é¢˜1ï¼šèŠ‚ç‚¹å·²å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ**
```java
// å…ˆæ£€æŸ¥å†åˆ›å»º
if (zooKeeper.exists(path, false) == null) {
    zooKeeper.create(path, data, acl, mode);
}
```

**é—®é¢˜2ï¼šå¦‚ä½•åˆ›å»ºå¤šçº§è·¯å¾„ï¼Ÿ**
```java
// é€’å½’åˆ›å»ºçˆ¶èŠ‚ç‚¹
createRecursive("/a/b/c/d", data);
```

**é—®é¢˜3ï¼šåˆ é™¤éç©ºèŠ‚ç‚¹æŠ¥é”™ï¼Ÿ**
```java
// é€’å½’åˆ é™¤æ‰€æœ‰å­èŠ‚ç‚¹
deleteRecursive(path);
```

**é—®é¢˜4ï¼šç›‘å¬ä¸ºä»€ä¹ˆåªè§¦å‘ä¸€æ¬¡ï¼Ÿ**
```java
// æ¯æ¬¡è§¦å‘åé‡æ–°æ³¨å†Œ
watcher.process(event) {
    getData(path, this, null);  // é‡æ–°æ³¨å†Œè‡ªå·±
}
```

**é—®é¢˜5ï¼šç‰ˆæœ¬å†²çªå¦‚ä½•å¤„ç†ï¼Ÿ**
```java
// æ•è·å¼‚å¸¸å¹¶é‡è¯•
try {
    setData(path, data, version);
} catch (BadVersionException e) {
    // é‡æ–°è¯»å–å¹¶é‡è¯•
    retry();
}
```

### 8.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ä¼˜åŒ–è¦ç‚¹**ï¼š

| åœºæ™¯ | **ä¼˜åŒ–æ–¹æ³•** | **æ•ˆæœ** |
|-----|------------|---------|
| `æ‰¹é‡æ“ä½œ` | `ä½¿ç”¨multi()æ‰¹é‡æäº¤` | `å‡å°‘ç½‘ç»œå¾€è¿”` |
| `è¯»å¤šå†™å°‘` | `å®¢æˆ·ç«¯ç¼“å­˜+Watcher` | `å‡å°‘æœåŠ¡å™¨å‹åŠ›` |
| `å¤§æ•°æ®å­˜å‚¨` | `åˆ†ç‰‡å­˜å‚¨+å¼•ç”¨` | `çªç ´1MBé™åˆ¶` |
| `é«˜å¹¶å‘å†™` | `å‡å°‘ç‰ˆæœ¬å†²çª` | `æé«˜æˆåŠŸç‡` |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
èŠ‚ç‚¹æ“ä½œè®°å…­æ¡ï¼Œå¢åˆ æ”¹æŸ¥è¦è®°ç‰¢
ç‰ˆæœ¬æ§åˆ¶é˜²å†²çªï¼Œç›‘å¬æœºåˆ¶å·§è¿ç”¨
ä¸´æ—¶æŒä¹…åˆ†åœºæ™¯ï¼Œé¡ºåºç¼–å·æœ‰å¦™æ‹›
é€’å½’åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼Œå®‰å…¨åˆ é™¤æ£€å­å­™
```