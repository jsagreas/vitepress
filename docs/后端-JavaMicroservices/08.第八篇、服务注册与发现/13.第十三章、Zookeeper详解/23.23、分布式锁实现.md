---
title: 23ã€åˆ†å¸ƒå¼é”å®ç°
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼é”åŸºç¡€æ¦‚å¿µ](#1-åˆ†å¸ƒå¼é”åŸºç¡€æ¦‚å¿µ)
2. [æ’ä»–é”å®ç°åŸç†](#2-æ’ä»–é”å®ç°åŸç†)
3. [å…±äº«é”å®ç°åŸç†](#3-å…±äº«é”å®ç°åŸç†)
4. [é¡ºåºèŠ‚ç‚¹ä¼˜åŒ–æ–¹æ¡ˆ](#4-é¡ºåºèŠ‚ç‚¹ä¼˜åŒ–æ–¹æ¡ˆ)
5. [é”çš„è¶…æ—¶ä¸å¼‚å¸¸å¤„ç†](#5-é”çš„è¶…æ—¶ä¸å¼‚å¸¸å¤„ç†)
6. [æ­»é”é—®é¢˜ä¸é¿å…ç­–ç•¥](#6-æ­»é”é—®é¢˜ä¸é¿å…ç­–ç•¥)
7. [æ€§èƒ½ä¼˜åŒ–å®è·µ](#7-æ€§èƒ½ä¼˜åŒ–å®è·µ)
8. [å¯é‡å…¥é”å®ç°](#8-å¯é‡å…¥é”å®ç°)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” åˆ†å¸ƒå¼é”åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
å•æœºç¯å¢ƒå°±åƒä½ å®¶çš„å«ç”Ÿé—´ï¼š
- ä¸€ä¸ªäººè¿›å»åé”é—¨ï¼Œå…¶ä»–äººåœ¨å¤–é¢ç­‰
- ç”¨å®Œåå¼€é”ï¼Œä¸‹ä¸€ä¸ªäººæ‰èƒ½è¿›
- è¿™å°±æ˜¯æœ¬åœ°é”ï¼ˆJavaçš„synchronizedï¼‰

åˆ†å¸ƒå¼ç¯å¢ƒå°±åƒå°åŒºçš„å…¬å…±ä¼šè®®å®¤ï¼š
- å¤šæ ‹æ¥¼çš„äººéƒ½å¯èƒ½æ¥ç”¨
- éœ€è¦ä¸€ä¸ª"ç®¡ç†å‘˜"ç»Ÿä¸€ç®¡ç†é’¥åŒ™
- Zookeeperå°±æ˜¯è¿™ä¸ª"ç®¡ç†å‘˜"
```

**æ ¸å¿ƒå®šä¹‰**ï¼š
> ğŸ”‘ **åˆ†å¸ƒå¼é”**ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰éœ€è¦è®¿é—®åŒä¸€ä¸ªå…±äº«èµ„æºæ—¶ï¼Œé€šè¿‡ä¸€ä¸ªåè°ƒæœºåˆ¶ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½è®¿é—®è¯¥èµ„æºã€‚

**ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”**ï¼š
| åœºæ™¯ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **å•†å“ç§’æ€** | å¤šä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•ï¼Œåº“å­˜æ‰£å‡æ··ä¹± | ğŸ”’ ç”¨é”ä¿æŠ¤åº“å­˜æ“ä½œ |
| **è®¢å•å·ç”Ÿæˆ** | å¤šä¸ªæœåŠ¡å™¨ç”Ÿæˆé‡å¤è®¢å•å· | ğŸ”’ åŠ é”ç¡®ä¿å”¯ä¸€æ€§ |
| **å®šæ—¶ä»»åŠ¡** | å¤šä¸ªèŠ‚ç‚¹é‡å¤æ‰§è¡ŒåŒä¸€ä»»åŠ¡ | ğŸ”’ æŠ¢é”æˆåŠŸè€…æ‰§è¡Œ |
| **ç¼“å­˜æ›´æ–°** | å¤šä¸ªèŠ‚ç‚¹åŒæ—¶æ›´æ–°ç¼“å­˜å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ | ğŸ”’ ä¸²è¡ŒåŒ–æ›´æ–°è¿‡ç¨‹ |

### 1.2 åˆ†å¸ƒå¼é”çš„åŸºæœ¬è¦æ±‚


**å¿…é¡»æ»¡è¶³çš„ç‰¹æ€§**ï¼š
```
âœ… äº’æ–¥æ€§ï¼šåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”
âœ… é¿å…æ­»é”ï¼šå³ä½¿æŒé”å®¢æˆ·ç«¯å´©æºƒï¼Œé”ä¹Ÿèƒ½è¢«é‡Šæ”¾
âœ… åŠ é”è§£é”åŒä¸€æ€§ï¼šè°åŠ çš„é”è°æ¥è§£ï¼Œä¸èƒ½è§£åˆ«äººçš„é”
âœ… é«˜å¯ç”¨ï¼šé”æœåŠ¡æœ¬èº«è¦ç¨³å®šå¯é 
```

**Zookeeper å®ç°é”çš„ä¼˜åŠ¿**ï¼š
- ğŸŸ¢ **å¼ºä¸€è‡´æ€§**ï¼šåŸºäºZABåè®®ä¿è¯æ•°æ®ä¸€è‡´
- ğŸŸ¢ **ä¸´æ—¶èŠ‚ç‚¹**ï¼šå®¢æˆ·ç«¯æ–­å¼€è‡ªåŠ¨åˆ é™¤ï¼Œé¿å…æ­»é”
- ğŸŸ¢ **Watchæœºåˆ¶**ï¼šé«˜æ•ˆçš„é€šçŸ¥æœºåˆ¶ï¼Œå‡å°‘è½®è¯¢
- ğŸŸ¢ **é¡ºåºèŠ‚ç‚¹**ï¼šå…¬å¹³é”çš„å¤©ç„¶å®ç°

---

## 2. ğŸšª æ’ä»–é”å®ç°åŸç†


### 2.1 ä»€ä¹ˆæ˜¯æ’ä»–é”


**é€šä¿—ç†è§£**ï¼š
> æ’ä»–é”å°±åƒç‹¬å å«ç”Ÿé—´ï¼Œä¸€æ¬¡åªèƒ½ä¸€ä¸ªäººç”¨ï¼Œç”¨å®Œäº†ä¸‹ä¸€ä¸ªæ‰èƒ½è¿›ã€‚

**ç‰¹ç‚¹**ï¼š
- ğŸ”¸ åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰
- ğŸ”¸ å…¶ä»–å®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…
- ğŸ”¸ å¸¸ç”¨äºå†™æ“ä½œåœºæ™¯

### 2.2 ç®€å•å®ç°æ–¹æ¡ˆï¼ˆæœ‰ç¼ºé™·ï¼‰


**å®ç°æ€è·¯**ï¼š
```
åŠ é”æµç¨‹ï¼š
å®¢æˆ·ç«¯A                    Zookeeper
   |                          |
   |--åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹------------>| /locks/my-lock
   |      (EPHEMERAL)         |
   |<------åˆ›å»ºæˆåŠŸ-----------|
   |   âœ… è·å¾—é”              |
   |                          |
   
å®¢æˆ·ç«¯Bï¼ˆæ™šåˆ°ï¼‰
   |                          |
   |--åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹------------>| /locks/my-lock
   |                          |
   |<------èŠ‚ç‚¹å·²å­˜åœ¨---------|
   |   âŒ è·å–é”å¤±è´¥          |
   |                          |
   |--è®¾ç½®Watchç›‘å¬---------->| ç›‘å¬èŠ‚ç‚¹åˆ é™¤
   |                          |

å®¢æˆ·ç«¯Aé‡Šæ”¾é”ï¼š
   |--åˆ é™¤èŠ‚ç‚¹--------------->| åˆ é™¤ /locks/my-lock
   |                          |
   |                          |--è§¦å‘Watché€šçŸ¥-->å®¢æˆ·ç«¯B
   |                          |
å®¢æˆ·ç«¯Bæ”¶åˆ°é€šçŸ¥ï¼š
   |--é‡æ–°å°è¯•åˆ›å»ºèŠ‚ç‚¹------->| 
   |<------åˆ›å»ºæˆåŠŸ-----------|
   |   âœ… è·å¾—é”              |
```

**ä»£ç ç¤ºä¾‹**ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰ï¼š
```java
public class SimpleDistributedLock {
    private ZooKeeper zk;
    private String lockPath = "/locks/my-lock";
    
    // åŠ é”
    public boolean lock() throws Exception {
        try {
            // å°è¯•åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹
            zk.create(lockPath, 
                     new byte[0], 
                     ZooDefs.Ids.OPEN_ACL_UNSAFE,
                     CreateMode.EPHEMERAL);
            return true; // åˆ›å»ºæˆåŠŸï¼Œè·å¾—é”
        } catch (KeeperException.NodeExistsException e) {
            // èŠ‚ç‚¹å·²å­˜åœ¨ï¼Œè¯´æ˜é”è¢«å ç”¨
            return false;
        }
    }
    
    // è§£é”
    public void unlock() throws Exception {
        zk.delete(lockPath, -1);
    }
}
```

**è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜**ï¼š
> âš ï¸ **æƒŠç¾¤æ•ˆåº”**ï¼šå½“é”é‡Šæ”¾æ—¶ï¼Œæ‰€æœ‰ç­‰å¾…çš„å®¢æˆ·ç«¯éƒ½ä¼šè¢«å”¤é†’ï¼Œç„¶åç«äº‰åˆ›å»ºèŠ‚ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªæˆåŠŸï¼Œå…¶ä»–ç»§ç»­ç­‰å¾…ã€‚è¿™ä¼šé€ æˆå¤§é‡æ— æ•ˆçš„ç½‘ç»œè¯·æ±‚å’ŒCPUæ¶ˆè€—ã€‚

---

## 3. ğŸ“– å…±äº«é”å®ç°åŸç†


### 3.1 ä»€ä¹ˆæ˜¯å…±äº«é”


**é€šä¿—ç†è§£**ï¼š
```
æ’ä»–é” = ç‹¬å å«ç”Ÿé—´ï¼Œä¸€æ¬¡åªèƒ½ä¸€ä¸ªäºº
å…±äº«é” = å›¾ä¹¦é¦†é˜…è§ˆå®¤ï¼š
  - å¯ä»¥å¤šäººåŒæ—¶é˜…è¯»ï¼ˆå…±äº«è®¿é—®ï¼‰
  - ä½†åªèƒ½ä¸€ä¸ªäººå†™ï¼ˆæ’ä»–è®¿é—®ï¼‰
```

**åº”ç”¨åœºæ™¯**ï¼š
- ğŸ“š **è¯»å¤šå†™å°‘**ï¼šå¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶è¯»å–æ•°æ®
- ğŸ“ **å†™æ“ä½œäº’æ–¥**ï¼šå†™æ“ä½œéœ€è¦æ’ä»–è®¿é—®
- âš–ï¸ **è¯»å†™åˆ†ç¦»**ï¼šè¯»ä¸å½±å“è¯»ï¼Œå†™æ’æ–¥ä¸€åˆ‡

### 3.2 è¯»å†™é”è®¾è®¡


**èŠ‚ç‚¹ç»“æ„è®¾è®¡**ï¼š
```
/locks
  â”œâ”€â”€ /read-0000000001  (è¯»é”)
  â”œâ”€â”€ /read-0000000002  (è¯»é”)
  â”œâ”€â”€ /write-0000000003 (å†™é”ï¼Œéœ€è¦ç­‰å¾…)
  â””â”€â”€ /read-0000000004  (è¯»é”ï¼Œéœ€è¦ç­‰å¾…)
```

**åŠ é”è§„åˆ™**ï¼š
| é”ç±»å‹ | èƒ½å¦è·å¾—é”çš„æ¡ä»¶ | è¯´æ˜ |
|--------|-----------------|------|
| **è¯»é”** | å‰é¢æ²¡æœ‰å†™é” | âœ… å¯ä»¥å’Œå…¶ä»–è¯»é”å…±å­˜ |
| **å†™é”** | å‰é¢æ²¡æœ‰ä»»ä½•é” | âŒ å¿…é¡»ç‹¬å èµ„æº |

**æ ¸å¿ƒé€»è¾‘**ï¼š
```java
public class ReadWriteLock {
    
    // è·å–è¯»é”
    public void lockRead() throws Exception {
        String myNode = zk.create("/locks/read-", 
                                  new byte[0],
                                  ZooDefs.Ids.OPEN_ACL_UNSAFE,
                                  CreateMode.EPHEMERAL_SEQUENTIAL);
        
        // æ£€æŸ¥å‰é¢æ˜¯å¦æœ‰å†™é”
        List<String> children = zk.getChildren("/locks", false);
        Collections.sort(children);
        
        for (String child : children) {
            if (child.equals(myNode)) break;
            
            // å¦‚æœå‰é¢æœ‰å†™é”ï¼Œç­‰å¾…
            if (child.startsWith("write-")) {
                waitForNode("/locks/" + child);
            }
        }
    }
    
    // è·å–å†™é”
    public void lockWrite() throws Exception {
        String myNode = zk.create("/locks/write-", 
                                  new byte[0],
                                  ZooDefs.Ids.OPEN_ACL_UNSAFE,
                                  CreateMode.EPHEMERAL_SEQUENTIAL);
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯æœ€å°èŠ‚ç‚¹
        List<String> children = zk.getChildren("/locks", false);
        Collections.sort(children);
        
        if (!children.get(0).equals(myNode)) {
            // ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œç­‰å¾…å‰ä¸€ä¸ªèŠ‚ç‚¹
            waitForNode("/locks/" + children.get(0));
        }
    }
}
```

---

## 4. ğŸ”¢ é¡ºåºèŠ‚ç‚¹ä¼˜åŒ–æ–¹æ¡ˆ


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦é¡ºåºèŠ‚ç‚¹


**é—®é¢˜å›é¡¾**ï¼š
```
ç®€å•æ–¹æ¡ˆçš„é—®é¢˜ï¼ˆæƒŠç¾¤æ•ˆåº”ï¼‰ï¼š
100ä¸ªå®¢æˆ·ç«¯ç­‰å¾…é”
   â†“
é”é‡Šæ”¾ï¼Œ100ä¸ªå®¢æˆ·ç«¯åŒæ—¶é†’æ¥
   â†“  
99ä¸ªå®¢æˆ·ç«¯æŠ¢é”å¤±è´¥ï¼Œç»§ç»­ç­‰å¾…
   â†“
æµªè´¹èµ„æºï¼Œæ•ˆç‡ä½ä¸‹
```

**é¡ºåºèŠ‚ç‚¹çš„ä¼˜åŠ¿**ï¼š
```
ä½¿ç”¨é¡ºåºèŠ‚ç‚¹ï¼š
æ¯ä¸ªå®¢æˆ·ç«¯åˆ›å»º /locks/lock-0000000001, 0002, 0003...
   â†“
æ¯ä¸ªå®¢æˆ·ç«¯åªç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
   â†“
é”é‡Šæ”¾æ—¶ï¼Œåªå”¤é†’ä¸‹ä¸€ä¸ªç­‰å¾…è€…
   â†“
æ•ˆç‡é«˜ï¼Œæ— æƒŠç¾¤é—®é¢˜
```

### 4.2 é¡ºåºèŠ‚ç‚¹åŠ é”æµç¨‹


**å®Œæ•´æµç¨‹å›¾**ï¼š
```
å®¢æˆ·ç«¯A                     Zookeeper                  å®¢æˆ·ç«¯B
   |                           |                          |
   |--åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹-------->| /locks/lock-0000000001   |
   |                           |                          |
   |--è·å–æ‰€æœ‰å­èŠ‚ç‚¹---------->|                          |
   |<--è¿”å›å­èŠ‚ç‚¹åˆ—è¡¨---------|                          |
   |  [lock-0000000001]        |                          |
   |                           |                          |
   | åˆ¤æ–­è‡ªå·±æ˜¯æœ€å°èŠ‚ç‚¹        |                          |
   | âœ… è·å¾—é”                 |                          |
   |                           |                          |
   |                           |   <--åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹----|
   |                           | /locks/lock-0000000002   |
   |                           |                          |
   |                           |   <--è·å–æ‰€æœ‰å­èŠ‚ç‚¹------|
   |                           | --è¿”å›[001, 002]-------->|
   |                           |                          |
   |                           |   åˆ¤æ–­ä¸æ˜¯æœ€å°èŠ‚ç‚¹       |
   |                           |   ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹(001)    |
   |                           | <--Watch(/locks/001)-----|
   |                           |                          |
Aé‡Šæ”¾é”                        |                          |
   |--åˆ é™¤èŠ‚ç‚¹--------------->| åˆ é™¤ lock-0000000001     |
   |                           |                          |
   |                           | --è§¦å‘Watché€šçŸ¥--------->|
   |                           |                          |
   |                           |   <--é‡æ–°æ£€æŸ¥æœ€å°èŠ‚ç‚¹----|
   |                           |   âœ… è·å¾—é”              |
```

**æ ¸å¿ƒå®ç°**ï¼š
```java
public class SequentialLock {
    private String myNode;
    
    public void lock() throws Exception {
        // 1. åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹
        myNode = zk.create("/locks/lock-", 
                          new byte[0],
                          ZooDefs.Ids.OPEN_ACL_UNSAFE,
                          CreateMode.EPHEMERAL_SEQUENTIAL);
        
        // 2. è·å–æ‰€æœ‰å­èŠ‚ç‚¹å¹¶æ’åº
        List<String> children = zk.getChildren("/locks", false);
        Collections.sort(children);
        
        // 3. åˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯æœ€å°èŠ‚ç‚¹
        String minNode = children.get(0);
        if (myNode.endsWith(minNode)) {
            // æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè·å¾—é”
            return;
        }
        
        // 4. ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œæ‰¾åˆ°å‰ä¸€ä¸ªèŠ‚ç‚¹å¹¶ç›‘å¬
        String prevNode = null;
        for (int i = 0; i < children.size(); i++) {
            if (myNode.endsWith(children.get(i))) {
                prevNode = children.get(i - 1);
                break;
            }
        }
        
        // 5. ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ é™¤äº‹ä»¶
        CountDownLatch latch = new CountDownLatch(1);
        zk.exists("/locks/" + prevNode, event -> {
            if (event.getType() == Watcher.Event.EventType.NodeDeleted) {
                latch.countDown();
            }
        });
        
        // 6. ç­‰å¾…å‰ä¸€ä¸ªèŠ‚ç‚¹é‡Šæ”¾
        latch.await();
        
        // 7. é€’å½’è°ƒç”¨ï¼Œé‡æ–°ç«äº‰é”
        lock();
    }
    
    public void unlock() throws Exception {
        zk.delete(myNode, -1);
    }
}
```

**ä¼˜åŒ–æ•ˆæœå¯¹æ¯”**ï¼š
| æ–¹æ¡ˆ | å”¤é†’å®¢æˆ·ç«¯æ•° | ç½‘ç»œè¯·æ±‚æ¬¡æ•° | CPUæ¶ˆè€— |
|------|-------------|-------------|---------|
| **ç®€å•æ–¹æ¡ˆ** | `Nä¸ªå…¨éƒ¨å”¤é†’` | `Næ¬¡åˆ›å»ºè¯·æ±‚` | `é«˜` |
| **é¡ºåºèŠ‚ç‚¹** | `1ä¸ªï¼ˆä¸‹ä¸€ä¸ªï¼‰` | `1æ¬¡åˆ›å»ºè¯·æ±‚` | `ä½` |

---

## 5. â±ï¸ é”çš„è¶…æ—¶ä¸å¼‚å¸¸å¤„ç†


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶æœºåˆ¶


**å¸¸è§é—®é¢˜**ï¼š
```
é—®é¢˜åœºæ™¯1ï¼šå®¢æˆ·ç«¯è·å–é”åå´©æºƒ
å®¢æˆ·ç«¯AæŒæœ‰é” â†’ ç¨‹åºå´©æºƒ â†’ é”æ— æ³•é‡Šæ”¾
   â†“
Zookeeperçš„ä¸´æ—¶èŠ‚ç‚¹æœºåˆ¶ï¼š
ä¼šè¯æ–­å¼€ â†’ è‡ªåŠ¨åˆ é™¤ä¸´æ—¶èŠ‚ç‚¹ â†’ é”è‡ªåŠ¨é‡Šæ”¾ âœ…

é—®é¢˜åœºæ™¯2ï¼šè·å–é”æ—¶é•¿æ—¶é—´ç­‰å¾…
å®¢æˆ·ç«¯Bç­‰å¾…é” â†’ ä¸€ç›´ç­‰å¾… â†’ ä¸šåŠ¡è¶…æ—¶
   â†“
éœ€è¦åŠ é”è¶…æ—¶æœºåˆ¶ï¼š
ç­‰å¾…è¶…è¿‡Nç§’ â†’ æ”¾å¼ƒè·å–é” â†’ è¿”å›å¤±è´¥ âœ…
```

### 5.2 è¶…æ—¶æœºåˆ¶å®ç°


**è¶…æ—¶æ§åˆ¶æ–¹æ¡ˆ**ï¼š
```java
public class TimeoutLock {
    
    // å¸¦è¶…æ—¶çš„åŠ é”
    public boolean lock(long timeout, TimeUnit unit) throws Exception {
        long deadline = System.currentTimeMillis() + unit.toMillis(timeout);
        
        myNode = zk.create("/locks/lock-", 
                          new byte[0],
                          ZooDefs.Ids.OPEN_ACL_UNSAFE,
                          CreateMode.EPHEMERAL_SEQUENTIAL);
        
        while (true) {
            List<String> children = zk.getChildren("/locks", false);
            Collections.sort(children);
            
            if (myNode.endsWith(children.get(0))) {
                return true; // è·å¾—é”
            }
            
            // æ£€æŸ¥æ˜¯å¦è¶…æ—¶
            long remaining = deadline - System.currentTimeMillis();
            if (remaining <= 0) {
                // è¶…æ—¶ï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹å¹¶è¿”å›å¤±è´¥
                zk.delete(myNode, -1);
                return false;
            }
            
            // æ‰¾åˆ°å‰ä¸€ä¸ªèŠ‚ç‚¹å¹¶ç­‰å¾…ï¼ˆå¸¦è¶…æ—¶ï¼‰
            String prevNode = findPrevNode(children);
            CountDownLatch latch = new CountDownLatch(1);
            zk.exists("/locks/" + prevNode, event -> {
                if (event.getType() == EventType.NodeDeleted) {
                    latch.countDown();
                }
            });
            
            // ç­‰å¾…æŒ‡å®šæ—¶é—´
            boolean acquired = latch.await(remaining, TimeUnit.MILLISECONDS);
            if (!acquired) {
                // ç­‰å¾…è¶…æ—¶
                zk.delete(myNode, -1);
                return false;
            }
        }
    }
}
```

### 5.3 å¼‚å¸¸æƒ…å†µå¤„ç†


**å¸¸è§å¼‚å¸¸åœºæ™¯**ï¼š
| å¼‚å¸¸ç±»å‹ | åŸå›  | å¤„ç†ç­–ç•¥ |
|---------|------|---------|
| **ConnectionLossException** | ç½‘ç»œæ–­å¼€ | ğŸ”„ é‡è¯•è¿æ¥ï¼Œæ£€æŸ¥é”çŠ¶æ€ |
| **SessionExpiredException** | ä¼šè¯è¿‡æœŸ | ğŸ”„ é‡å»ºä¼šè¯ï¼Œé‡æ–°è·å–é” |
| **NodeExistsException** | èŠ‚ç‚¹å·²å­˜åœ¨ | â³ æ­£å¸¸ç­‰å¾…é€»è¾‘ |
| **NoNodeException** | èŠ‚ç‚¹ä¸å­˜åœ¨ | ğŸ”„ é‡æ–°åˆ›å»ºèŠ‚ç‚¹ |

**å¼‚å¸¸å¤„ç†ç¤ºä¾‹**ï¼š
```java
public void lockWithRetry() throws Exception {
    int retryCount = 0;
    int maxRetries = 3;
    
    while (retryCount < maxRetries) {
        try {
            lock();
            return;
        } catch (ConnectionLossException e) {
            // ç½‘ç»œé—®é¢˜ï¼Œé‡è¯•
            retryCount++;
            Thread.sleep(1000);
        } catch (SessionExpiredException e) {
            // ä¼šè¯è¿‡æœŸï¼Œé‡å»ºè¿æ¥
            reconnect();
            retryCount++;
        }
    }
    
    throw new Exception("è·å–é”å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°");
}
```

---

## 6. ğŸ’€ æ­»é”é—®é¢˜ä¸é¿å…ç­–ç•¥


### 6.1 ä»€ä¹ˆæ˜¯æ­»é”


**é€šä¿—ä¾‹å­**ï¼š
```
ä¸¤ä¸ªäººè¿‡ç‹¬æœ¨æ¡¥ï¼š
Aä»å·¦è¾¹ä¸Šæ¡¥ â†â†’ Bä»å³è¾¹ä¸Šæ¡¥
   â†“              â†“
éƒ½ä¸è‚¯é€€è®©ï¼ŒåƒµæŒä¸ä¸‹
   â†“
è¿™å°±æ˜¯æ­»é”ï¼
```

**åˆ†å¸ƒå¼ç¯å¢ƒçš„æ­»é”åœºæ™¯**ï¼š
```
äº‹åŠ¡1ï¼šéœ€è¦é”A â†’ é”B
äº‹åŠ¡2ï¼šéœ€è¦é”B â†’ é”A

æ—¶é—´çº¿ï¼š
t1: äº‹åŠ¡1è·å–é”A âœ…
t2: äº‹åŠ¡2è·å–é”B âœ…
t3: äº‹åŠ¡1ç­‰å¾…é”B â³ (è¢«äº‹åŠ¡2æŒæœ‰)
t4: äº‹åŠ¡2ç­‰å¾…é”A â³ (è¢«äº‹åŠ¡1æŒæœ‰)
   â†“
æ°¸è¿œç­‰å¾…ï¼Œæ­»é”å½¢æˆï¼
```

### 6.2 æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶


**è®°å¿†å£è¯€**ï¼šäº’æ–¥å ç”¨ä¸å¯æŠ¢ï¼Œå¾ªç¯ç­‰å¾…æ˜¯æ­»é”

| æ¡ä»¶ | è¯´æ˜ | ä¾‹å­ |
|------|------|------|
| **äº’æ–¥** | èµ„æºåŒæ—¶åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ | ğŸšª å«ç”Ÿé—´åªèƒ½ä¸€äººç”¨ |
| **å æœ‰ä¸”ç­‰å¾…** | æŒæœ‰èµ„æºçš„åŒæ—¶ç­‰å¾…å…¶ä»–èµ„æº | ğŸ« æ‹¿ç€Aç¥¨ç­‰Bç¥¨ |
| **ä¸å¯æŠ¢å ** | èµ„æºä¸èƒ½è¢«å¼ºè¡Œå‰¥å¤º | ğŸ”’ é”ä¸èƒ½å¼ºåˆ¶è§£å¼€ |
| **å¾ªç¯ç­‰å¾…** | è¿›ç¨‹é—´å½¢æˆç­‰å¾…ç¯è·¯ | ğŸ”„ Aç­‰Bï¼ŒBç­‰A |

### 6.3 é¿å…æ­»é”çš„ç­–ç•¥


**ç­–ç•¥1ï¼šèµ„æºæœ‰åºåˆ†é…**
```
è§„å®šåŠ é”é¡ºåºï¼š
âŒ é”™è¯¯åšæ³•ï¼š
äº‹åŠ¡1: é”A â†’ é”B
äº‹åŠ¡2: é”B â†’ é”A  (é¡ºåºä¸ä¸€è‡´ï¼Œå¯èƒ½æ­»é”)

âœ… æ­£ç¡®åšæ³•ï¼š
äº‹åŠ¡1: é”A â†’ é”B
äº‹åŠ¡2: é”A â†’ é”B  (é¡ºåºä¸€è‡´ï¼Œä¸ä¼šæ­»é”)
```

**ä»£ç å®ç°**ï¼š
```java
public class OrderedLock {
    
    // æŒ‰å­—å…¸åºåŠ é”
    public void lockMultiple(String... resources) throws Exception {
        // 1. æ’åºèµ„æº
        Arrays.sort(resources);
        
        // 2. æŒ‰é¡ºåºåŠ é”
        for (String resource : resources) {
            lock(resource);
        }
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public void transfer(String accountA, String accountB, int amount) {
        // ä¸ç®¡Aã€Bçš„é¡ºåºï¼Œæ€»æ˜¯æŒ‰å­—å…¸åºåŠ é”
        lockMultiple(accountA, accountB);
        try {
            // æ‰§è¡Œè½¬è´¦é€»è¾‘
            deduct(accountA, amount);
            add(accountB, amount);
        } finally {
            unlock(accountA);
            unlock(accountB);
        }
    }
}
```

**ç­–ç•¥2ï¼šè¶…æ—¶æ”¾å¼ƒ**
```
åŠ é”æ—¶è®¾ç½®è¶…æ—¶ï¼š
å°è¯•è·å–é” â†’ è¶…æ—¶æœªè·å¾— â†’ æ”¾å¼ƒå·²æŒæœ‰çš„é” â†’ é¿å…æ­»é”
```

**ç­–ç•¥3ï¼šæ­»é”æ£€æµ‹ä¸æ¢å¤**
```
å®šæœŸæ£€æµ‹ï¼š
éå†æ‰€æœ‰é”çš„ç­‰å¾…å…³ç³»
   â†“
å‘ç°ç¯è·¯ï¼ˆå¾ªç¯ç­‰å¾…ï¼‰
   â†“
é€‰æ‹©ä¸€ä¸ªäº‹åŠ¡å›æ»šï¼Œæ‰“ç ´æ­»é”
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–å®è·µ


### 7.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ


**ä¸»è¦æ€§èƒ½é—®é¢˜**ï¼š
| é—®é¢˜ | åŸå›  | å½±å“ |
|------|------|------|
| **ç½‘ç»œå»¶è¿Ÿ** | å®¢æˆ·ç«¯ä¸ZKé€šä¿¡è€—æ—¶ | ğŸŒ åŠ é”/è§£é”æ…¢ |
| **æƒŠç¾¤æ•ˆåº”** | æ‰€æœ‰ç­‰å¾…è€…åŒæ—¶å”¤é†’ | ğŸ“ˆ CPU/ç½‘ç»œå³°å€¼ |
| **é¢‘ç¹åˆ›å»ºåˆ é™¤èŠ‚ç‚¹** | æ¯æ¬¡åŠ é”éƒ½è¦åˆ›å»ºèŠ‚ç‚¹ | ğŸ’¾ ZKè´Ÿè½½é«˜ |
| **Watché£æš´** | å¤§é‡WatchåŒæ—¶è§¦å‘ | ğŸŒŠ ç½‘ç»œæ‹¥å µ |

### 7.2 ä¼˜åŒ–æ–¹æ¡ˆ


**ä¼˜åŒ–1ï¼šé¡ºåºèŠ‚ç‚¹ + é“¾å¼ç›‘å¬**
```
åŸç†ï¼šæ¯ä¸ªèŠ‚ç‚¹åªç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
æ•ˆæœï¼šæƒŠç¾¤æ•ˆåº” â†’ é“¾å¼å”¤é†’

ä¼˜åŒ–å‰ï¼š100ä¸ªèŠ‚ç‚¹åŒæ—¶å”¤é†’
ä¼˜åŒ–åï¼šæ¯æ¬¡åªå”¤é†’1ä¸ªèŠ‚ç‚¹

æ€§èƒ½æå‡ï¼š
ç½‘ç»œè¯·æ±‚å‡å°‘ï¼š100æ¬¡ â†’ 1æ¬¡
CPUæ¶ˆè€—é™ä½ï¼š99%
```

**ä¼˜åŒ–2ï¼šè¿æ¥æ± å¤ç”¨**
```java
public class ZkConnectionPool {
    private BlockingQueue<ZooKeeper> pool;
    
    public ZkConnectionPool(int poolSize) {
        pool = new LinkedBlockingQueue<>(poolSize);
        for (int i = 0; i < poolSize; i++) {
            pool.offer(createConnection());
        }
    }
    
    public ZooKeeper borrowConnection() {
        return pool.poll();
    }
    
    public void returnConnection(ZooKeeper zk) {
        pool.offer(zk);
    }
}

// ä½¿ç”¨è¿æ¥æ± 
ZooKeeper zk = pool.borrowConnection();
try {
    // æ‰§è¡ŒåŠ é”æ“ä½œ
    lock.lock(zk);
} finally {
    pool.returnConnection(zk);
}
```

**ä¼˜åŒ–3ï¼šæœ¬åœ°ç¼“å­˜é”çŠ¶æ€**
```java
public class CachedLock {
    private volatile boolean locked = false;
    
    public void lock() throws Exception {
        // å…ˆæ£€æŸ¥æœ¬åœ°ç¼“å­˜
        if (locked) {
            // æœ¬åœ°å·²æœ‰é”ï¼Œç›´æ¥è¿”å›
            return;
        }
        
        // æœ¬åœ°æ²¡é”ï¼Œå»ZKè·å–
        zkLock();
        locked = true;
    }
    
    public void unlock() throws Exception {
        if (!locked) return;
        
        zkUnlock();
        locked = false;
    }
}
```

**ä¼˜åŒ–4ï¼šæ‰¹é‡æ“ä½œ**
```java
// æ‰¹é‡åŠ é”
public void lockBatch(List<String> resources) throws Exception {
    // ä½¿ç”¨ZKçš„multiæ“ä½œï¼Œä¸€æ¬¡æ€§åˆ›å»ºå¤šä¸ªèŠ‚ç‚¹
    List<Op> ops = resources.stream()
        .map(r -> Op.create("/locks/" + r, 
                           new byte[0],
                           ZooDefs.Ids.OPEN_ACL_UNSAFE,
                           CreateMode.EPHEMERAL))
        .collect(Collectors.toList());
    
    zk.multi(ops); // åŸå­æ€§æ‰¹é‡æ“ä½œ
}
```

### 7.3 æ€§èƒ½å¯¹æ¯”


**ä¼˜åŒ–å‰åå¯¹æ¯”**ï¼ˆ1000ä¸ªå¹¶å‘è¯·æ±‚ï¼‰ï¼š
| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **å¹³å‡å“åº”æ—¶é—´** | 500ms | 50ms | 90% â¬‡ï¸ |
| **QPS** | 200 | 1500 | 650% â¬†ï¸ |
| **ç½‘ç»œè¯·æ±‚æ•°** | 10ä¸‡æ¬¡ | 1ä¸‡æ¬¡ | 90% â¬‡ï¸ |
| **CPUä½¿ç”¨ç‡** | 80% | 20% | 75% â¬‡ï¸ |

---

## 8. ğŸ”„ å¯é‡å…¥é”å®ç°


### 8.1 ä»€ä¹ˆæ˜¯å¯é‡å…¥é”


**é€šä¿—ç†è§£**ï¼š
```
ä¸å¯é‡å…¥é” = å‡ºé—¨å¿˜è®°å¸¦é’¥åŒ™ï¼š
ä½ å‡ºé—¨é”é—¨ â†’ æƒ³å›å®¶ â†’ å‘ç°è‡ªå·±æŠŠè‡ªå·±é”åœ¨å¤–é¢äº† âŒ

å¯é‡å…¥é” = æŒ‡çº¹é”ï¼š
ä½ å‡ºé—¨é”é—¨ â†’ æƒ³å›å®¶ â†’ æŒ‡çº¹è¯†åˆ«æ˜¯ä½  â†’ ç›´æ¥å¼€é—¨ âœ…
åŒä¸€ä¸ªäººå¯ä»¥å¤šæ¬¡è¿›å…¥
```

**ä¸ºä»€ä¹ˆéœ€è¦å¯é‡å…¥**ï¼š
```java
public void method1() {
    lock.lock();
    try {
        // ä¸šåŠ¡é€»è¾‘
        method2(); // è°ƒç”¨å¦ä¸€ä¸ªéœ€è¦é”çš„æ–¹æ³•
    } finally {
        lock.unlock();
    }
}

public void method2() {
    lock.lock(); // å¦‚æœä¸å¯é‡å…¥ï¼Œè¿™é‡Œä¼šæ­»é”ï¼
    try {
        // ä¸šåŠ¡é€»è¾‘
    } finally {
        lock.unlock();
    }
}
```

### 8.2 å¯é‡å…¥é”å®ç°åŸç†


**æ ¸å¿ƒæ€è·¯**ï¼š
```
è®°å½•é”çš„æŒæœ‰è€…å’Œé‡å…¥æ¬¡æ•°ï¼š
{
  "owner": "client-001",    // å½“å‰æŒæœ‰é”çš„å®¢æˆ·ç«¯
  "count": 3                // é‡å…¥æ¬¡æ•°
}

åŠ é”è§„åˆ™ï¼š
1. å¦‚æœé”ç©ºé—² â†’ è·å–é”ï¼Œcount=1
2. å¦‚æœæ˜¯è‡ªå·±æŒæœ‰ â†’ count+1ï¼Œå…è®¸é‡å…¥
3. å¦‚æœæ˜¯åˆ«äººæŒæœ‰ â†’ ç­‰å¾…

è§£é”è§„åˆ™ï¼š
1. count-1
2. å¦‚æœcount=0 â†’ é‡Šæ”¾é”
```

**å®Œæ•´å®ç°**ï¼š
```java
public class ReentrantDistributedLock {
    private String clientId = UUID.randomUUID().toString();
    private ThreadLocal<Integer> holdCount = ThreadLocal.withInitial(() -> 0);
    private String lockNode;
    
    public void lock() throws Exception {
        // æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»æŒæœ‰é”
        if (holdCount.get() > 0) {
            // é‡å…¥ï¼Œè®¡æ•°+1
            holdCount.set(holdCount.get() + 1);
            return;
        }
        
        // é¦–æ¬¡åŠ é”ï¼Œåˆ›å»ºèŠ‚ç‚¹ï¼ˆæ•°æ®ä¸­åŒ…å«å®¢æˆ·ç«¯IDï¼‰
        lockNode = zk.create("/locks/lock-",
                            clientId.getBytes(),
                            ZooDefs.Ids.OPEN_ACL_UNSAFE,
                            CreateMode.EPHEMERAL_SEQUENTIAL);
        
        // ç«äº‰é”çš„é€»è¾‘ï¼ˆä¸ä¹‹å‰ç›¸åŒï¼‰
        acquireLock();
        
        // è·å–é”æˆåŠŸï¼Œè®¡æ•°è®¾ä¸º1
        holdCount.set(1);
    }
    
    public void unlock() throws Exception {
        int count = holdCount.get();
        if (count == 0) {
            throw new IllegalStateException("æœªæŒæœ‰é”");
        }
        
        // è®¡æ•°-1
        count--;
        holdCount.set(count);
        
        // å®Œå…¨é‡Šæ”¾é”
        if (count == 0) {
            zk.delete(lockNode, -1);
        }
    }
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰å®¢æˆ·ç«¯æŒæœ‰çš„é”
    private boolean isMyLock(String node) throws Exception {
        byte[] data = zk.getData(node, false, null);
        String owner = new String(data);
        return clientId.equals(owner);
    }
}
```

### 8.3 ä½¿ç”¨ç¤ºä¾‹


**é€’å½’è°ƒç”¨åœºæ™¯**ï¼š
```java
public class OrderService {
    private ReentrantDistributedLock lock = new ReentrantDistributedLock();
    
    public void createOrder(Order order) {
        lock.lock();
        try {
            // 1. æ‰£å‡åº“å­˜ï¼ˆéœ€è¦é”ï¼‰
            reduceStock(order.getProductId(), order.getQuantity());
            
            // 2. åˆ›å»ºè®¢å•è®°å½•
            saveOrder(order);
            
        } finally {
            lock.unlock();
        }
    }
    
    public void reduceStock(String productId, int quantity) {
        lock.lock(); // å¯é‡å…¥ï¼Œä¸ä¼šæ­»é”
        try {
            // æ‰£å‡åº“å­˜é€»è¾‘
            updateStock(productId, -quantity);
        } finally {
            lock.unlock();
        }
    }
}
```

**é‡å…¥è®¡æ•°æ¼”ç¤º**ï¼š
```
è°ƒç”¨createOrder():
  lock.lock()    â†’ holdCount = 1
    è°ƒç”¨reduceStock():
      lock.lock()  â†’ holdCount = 2 (é‡å…¥)
      lock.unlock()â†’ holdCount = 1
  lock.unlock()  â†’ holdCount = 0 (å®Œå…¨é‡Šæ”¾)
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ åˆ†å¸ƒå¼é”åŸºç¡€**ï¼š
- ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„èµ„æºäº’æ–¥è®¿é—®
- å¿…é¡»æ»¡è¶³äº’æ–¥æ€§ã€é¿å…æ­»é”ã€é«˜å¯ç”¨
- Zookeeperé€šè¿‡ä¸´æ—¶èŠ‚ç‚¹å’ŒWatchæœºåˆ¶å®ç°

**ğŸ”¸ é”çš„ç±»å‹**ï¼š
```
æ’ä»–é”ï¼šä¸€æ¬¡åªèƒ½ä¸€ä¸ªæŒæœ‰ï¼Œç”¨äºå†™æ“ä½œ
å…±äº«é”ï¼šå…è®¸å¤šä¸ªè¯»ï¼Œä½†å†™æ“ä½œäº’æ–¥
å¯é‡å…¥é”ï¼šåŒä¸€å®¢æˆ·ç«¯å¯ä»¥å¤šæ¬¡è·å–
```

**ğŸ”¸ å®ç°æ–¹æ¡ˆæ¼”è¿›**ï¼š
```
ç®€å•æ–¹æ¡ˆ â†’ æƒŠç¾¤æ•ˆåº”
   â†“
é¡ºåºèŠ‚ç‚¹ â†’ é“¾å¼ç›‘å¬ â†’ æ€§èƒ½ä¼˜åŒ–
   â†“
è¶…æ—¶æœºåˆ¶ â†’ æ­»é”é¿å… â†’ ç¨³å®šæ€§æå‡
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆé¡ºåºèŠ‚ç‚¹èƒ½è§£å†³æƒŠç¾¤é—®é¢˜**ï¼š
```
æ¯ä¸ªèŠ‚ç‚¹åªç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
   â†“
é”é‡Šæ”¾åªå”¤é†’ä¸‹ä¸€ä¸ªç­‰å¾…è€…
   â†“
é“¾å¼ä¼ é€’ï¼Œé¿å…åŒæ—¶å”¤é†’
```

**ğŸ”¹ ä¸´æ—¶èŠ‚ç‚¹å¦‚ä½•é¿å…æ­»é”**ï¼š
```
å®¢æˆ·ç«¯å´©æºƒ â†’ ä¼šè¯æ–­å¼€ â†’ ä¸´æ—¶èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤ â†’ é”è‡ªåŠ¨é‡Šæ”¾
```

**ğŸ”¹ å¯é‡å…¥é”çš„å…³é”®**ï¼š
```
è®°å½•æŒæœ‰è€…èº«ä»½ + é‡å…¥è®¡æ•°
   â†“
åŒä¸€æŒæœ‰è€…ï¼šè®¡æ•°+1ï¼Œå…è®¸é‡å…¥
ä¸åŒæŒæœ‰è€…ï¼šç­‰å¾…
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‰æ‹©åˆé€‚çš„é”ç±»å‹**ï¼š
| åœºæ™¯ | æ¨èé”ç±»å‹ | åŸå›  |
|------|-----------|------|
| **ç§’æ€æ‰£åº“å­˜** | æ’ä»–é” | å†™æ“ä½œï¼Œéœ€è¦äº’æ–¥ |
| **é…ç½®è¯»å–** | å…±äº«é” | è¯»å¤šå†™å°‘ |
| **é€’å½’è°ƒç”¨** | å¯é‡å…¥é” | é¿å…è‡ªå·±é”è‡ªå·± |
| **å®šæ—¶ä»»åŠ¡** | æ’ä»–é” + è¶…æ—¶ | é˜²æ­¢ä»»åŠ¡é‡å¤æ‰§è¡Œ |

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- âœ… ä½¿ç”¨é¡ºåºèŠ‚ç‚¹é¿å…æƒŠç¾¤
- âœ… è¿æ¥æ± å¤ç”¨ZKè¿æ¥
- âœ… æœ¬åœ°ç¼“å­˜å‡å°‘ç½‘ç»œè¯·æ±‚
- âœ… æ‰¹é‡æ“ä½œæå‡ååé‡

**å¼‚å¸¸å¤„ç†åŸåˆ™**ï¼š
- âœ… ç½‘ç»œå¼‚å¸¸ï¼šé‡è¯•æœºåˆ¶
- âœ… ä¼šè¯è¿‡æœŸï¼šé‡å»ºè¿æ¥
- âœ… åŠ é”è¶…æ—¶ï¼šä¸šåŠ¡é™çº§
- âœ… æ­»é”æ£€æµ‹ï¼šè¶…æ—¶æ”¾å¼ƒ

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**Q1ï¼šé”ä¸€ç›´è·å–ä¸åˆ°æ€ä¹ˆåŠï¼Ÿ**
> Aï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åè¿”å›å¤±è´¥æˆ–é™çº§å¤„ç†

**Q2ï¼šå¦‚ä½•ä¿è¯åŠ é”è§£é”çš„åŸå­æ€§ï¼Ÿ**
> Aï¼šä½¿ç”¨try-finallyç¡®ä¿è§£é”ï¼Œå¼‚å¸¸æ—¶ä¹Ÿèƒ½é‡Šæ”¾

**Q3ï¼šåˆ†å¸ƒå¼é”ä¼šæœ‰æ€§èƒ½é—®é¢˜å—ï¼Ÿ**
> Aï¼šåˆç†ä½¿ç”¨ï¼Œé…åˆä¼˜åŒ–ç­–ç•¥ï¼Œæ€§èƒ½å¯ä»¥æ¥å—ã€‚å…³é”®æ˜¯å‡å°‘é”çš„ç²’åº¦å’ŒæŒæœ‰æ—¶é—´

**Q4ï¼šZookeeperæŒ‚äº†æ€ä¹ˆåŠï¼Ÿ**
> Aï¼šZKé›†ç¾¤éƒ¨ç½²ä¿è¯é«˜å¯ç”¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é…ç½®é™çº§ç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ä¸´æ—¶é¡ºåºæ˜¯åŸºç¡€ï¼Œé“¾å¼ç›‘å¬é˜²æƒŠç¾¤
è¶…æ—¶æœºåˆ¶é¿æ­»ç­‰ï¼Œé‡å…¥è®¡æ•°è¦è®°æ¸…
æ€§èƒ½ä¼˜åŒ–å¤šæ‰‹æ®µï¼Œç¨³å®šå¯é æ˜¯æ ¹æœ¬
```