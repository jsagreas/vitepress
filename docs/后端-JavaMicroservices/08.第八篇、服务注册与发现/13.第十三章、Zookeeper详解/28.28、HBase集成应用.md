---
title: 28ã€HBaseé›†æˆåº”ç”¨
---
## ğŸ“š ç›®å½•

1. [HBaseä¸Zookeeperçš„å…³ç³»](#1-HBaseä¸Zookeeperçš„å…³ç³»)
2. [RegionServerç®¡ç†æœºåˆ¶](#2-RegionServerç®¡ç†æœºåˆ¶)
3. [HBaseå…ƒæ•°æ®å­˜å‚¨](#3-HBaseå…ƒæ•°æ®å­˜å‚¨)
4. [HBase Masteré€‰ä¸¾](#4-HBase-Masteré€‰ä¸¾)
5. [é›†ç¾¤åè°ƒä¸æ•…éšœå¤„ç†](#5-é›†ç¾¤åè°ƒä¸æ•…éšœå¤„ç†)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— HBaseä¸Zookeeperçš„å…³ç³»


### 1.1 ä¸ºä»€ä¹ˆHBaseéœ€è¦Zookeeper


**ğŸ¤” ç†è§£HBaseçš„ç—›ç‚¹**

æƒ³è±¡ä¸€ä¸‹ï¼ŒHBaseå°±åƒä¸€ä¸ªè¶…å¤§å‹å›¾ä¹¦é¦†ï¼š
- å›¾ä¹¦é¦†æœ‰å¾ˆå¤šä¸ªåˆ†é¦†ï¼ˆRegionServerï¼‰
- éœ€è¦ä¸€ä¸ªæ€»é¦†é•¿ï¼ˆMasterï¼‰ç»Ÿä¸€ç®¡ç†
- è¿˜è¦æœ‰ä¸ª"ä¿¡æ¯ä¸­å¿ƒ"å‘Šè¯‰è¯»è€…å»å“ªä¸ªåˆ†é¦†æ‰¾ä¹¦

```
ç°å®åœºæ™¯å¯¹æ¯”ï¼š

æ²¡æœ‰Zookeeperçš„HBaseï¼š
- Masterå®•æœºäº†ï¼Œè°æ¥æ¥ç®¡ï¼ŸâŒ
- RegionServeræŒ‚äº†ï¼Œè°çŸ¥é“ï¼ŸâŒ
- æ•°æ®å­˜åœ¨å“ªä¸ªæœåŠ¡å™¨ï¼Œæ€ä¹ˆæ‰¾ï¼ŸâŒ

æœ‰äº†Zookeeperçš„HBaseï¼š
- Masteré€‰ä¸¾è‡ªåŠ¨è¿›è¡Œ âœ…
- å®æ—¶ç›‘æ§æ‰€æœ‰æœåŠ¡å™¨çŠ¶æ€ âœ…
- å…ƒæ•°æ®å¿«é€ŸæŸ¥è¯¢å®šä½ âœ…
```

**ğŸ“‹ æ ¸å¿ƒä¾èµ–å…³ç³»**

â”Œâ”€ Zookeeperåœ¨HBaseä¸­çš„è§’è‰² â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚ ğŸ¯ Masteré€‰ä¸¾  â†’ ä¿è¯é«˜å¯ç”¨        â”‚
â”‚ ğŸ“Š çŠ¶æ€ç›‘æ§    â†’ å®æ—¶æ„ŸçŸ¥æ•…éšœ      â”‚
â”‚ ğŸ—‚ï¸ å…ƒæ•°æ®å­˜å‚¨  â†’ å¿«é€Ÿæ•°æ®å®šä½      â”‚
â”‚ ğŸ”” äº‹ä»¶é€šçŸ¥    â†’ é›†ç¾¤å˜æ›´åŒæ­¥      â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 1.2 HBase-Zookeeperæ¶æ„å›¾


**ğŸ—ï¸ æ•´ä½“æ¶æ„å…³ç³»**

```
           Clientï¼ˆå®¢æˆ·ç«¯ï¼‰
              â†“
         [è¿æ¥Zookeeper]
              â†“
       è·å–Masterå’ŒMetaä¿¡æ¯
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                   â†“
  Master            RegionServer
    â†‘                   â†‘
    â””â”€â”€â”€â”€â”€ Zookeeper â”€â”€â”€â”˜
         (åè°ƒä¸­å¿ƒ)
           â†“
    å­˜å‚¨ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
    â€¢ Masteråœ°å€
    â€¢ RegionServeråˆ—è¡¨
    â€¢ Metaè¡¨ä½ç½®
    â€¢ åˆ†å¸ƒå¼é”
```

**ğŸ”‘ Zookeeperå­˜å‚¨çš„HBaseå…³é”®èŠ‚ç‚¹**

| èŠ‚ç‚¹è·¯å¾„ | **ä½œç”¨** | **è¯´æ˜** |
|---------|---------|---------|
| `/hbase/master` | `å­˜å‚¨Masteråœ°å€` | `å®¢æˆ·ç«¯é€šè¿‡è¿™é‡Œæ‰¾åˆ°Master` |
| `/hbase/rs` | `RegionServeråˆ—è¡¨` | `ä¸´æ—¶èŠ‚ç‚¹ï¼Œç”¨äºå¿ƒè·³æ£€æµ‹` |
| `/hbase/meta-region-server` | `Metaè¡¨ä½ç½®` | `æŒ‡å‘å­˜å‚¨Metaè¡¨çš„RegionServer` |
| `/hbase/table` | `è¡¨çŠ¶æ€ä¿¡æ¯` | `è®°å½•è¡¨çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€` |
| `/hbase/splitWAL` | `æ—¥å¿—åˆ†å‰²åè°ƒ` | `æ•…éšœæ¢å¤æ—¶ä½¿ç”¨` |

### 1.3 æ ¸å¿ƒäº¤äº’æµç¨‹


**ğŸ“ å®¢æˆ·ç«¯è®¿é—®æ•°æ®çš„å®Œæ•´æµç¨‹**

```
æ­¥éª¤1: å®¢æˆ·ç«¯å¯åŠ¨
   â†“
æ­¥éª¤2: è¿æ¥Zookeeperé›†ç¾¤
   â†“
æ­¥éª¤3: ä» /hbase/meta-region-server è·å–Metaè¡¨ä½ç½®
   â†“
æ­¥éª¤4: è®¿é—®Metaè¡¨ï¼ŒæŸ¥è¯¢ç›®æ ‡æ•°æ®æ‰€åœ¨çš„RegionServer
   â†“
æ­¥éª¤5: ç›´æ¥è¿æ¥å¯¹åº”çš„RegionServerè¯»å†™æ•°æ®
   â†“
æ­¥éª¤6: ç¼“å­˜è·¯ç”±ä¿¡æ¯ï¼Œä¸‹æ¬¡è®¿é—®æ›´å¿«
```

**ğŸ’¡ é€šä¿—ç†è§£**

å°±åƒå»åŒ»é™¢çœ‹ç—…ï¼š
1. å…ˆå»æŒ‚å·å¤„ï¼ˆZookeeperï¼‰æŸ¥è¯¢
2. æŒ‚å·å¤„å‘Šè¯‰ä½ å»å‡ å·æ¥¼ï¼ˆMetaè¡¨ä½ç½®ï¼‰
3. åˆ°å¯¹åº”æ¥¼å±‚æŸ¥çœ‹ç§‘å®¤åˆ†å¸ƒï¼ˆMetaè¡¨ï¼‰
4. æ‰¾åˆ°å…·ä½“è¯Šå®¤ï¼ˆRegionServerï¼‰
5. ç›´æ¥å°±è¯Šï¼ˆè¯»å†™æ•°æ®ï¼‰

---

## 2. ğŸ–¥ï¸ RegionServerç®¡ç†æœºåˆ¶


### 2.1 ä»€ä¹ˆæ˜¯RegionServer


**ğŸ“– åŸºæœ¬æ¦‚å¿µ**

RegionServerå°±æ˜¯HBaseçš„"å·¥ä½œèŠ‚ç‚¹"ï¼š
- **å­˜å‚¨æ•°æ®**ï¼šè´Ÿè´£ç®¡ç†å¤šä¸ªRegionï¼ˆæ•°æ®åˆ†ç‰‡ï¼‰
- **å¤„ç†è¯·æ±‚**ï¼šå“åº”å®¢æˆ·ç«¯çš„è¯»å†™æ“ä½œ
- **æ±‡æŠ¥çŠ¶æ€**ï¼šå®šæœŸå‘ZookeeperæŠ¥å‘Šå­˜æ´»çŠ¶æ€

```
RegionServerå·¥ä½œç¤ºæ„ï¼š

RegionServer-1           RegionServer-2
   â”œâ”€ Region-A              â”œâ”€ Region-C
   â”œâ”€ Region-B              â”œâ”€ Region-D
   â””â”€ å¿ƒè·³â†’Zookeeper        â””â”€ å¿ƒè·³â†’Zookeeper
```

### 2.2 RegionServeræ³¨å†Œæµç¨‹


**ğŸ”„ æ³¨å†Œä¸ç›‘æ§æœºåˆ¶**

```
RegionServerå¯åŠ¨æµç¨‹ï¼š

1ï¸âƒ£ RegionServerå¯åŠ¨
   â†“
2ï¸âƒ£ è¿æ¥Zookeeperé›†ç¾¤
   â†“
3ï¸âƒ£ åœ¨ /hbase/rs ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹
   èŠ‚ç‚¹åå¦‚: rs-192.168.1.100:16020
   â†“
4ï¸âƒ£ èŠ‚ç‚¹å­˜å‚¨è‡ªèº«ä¿¡æ¯ï¼š
   â€¢ IPåœ°å€å’Œç«¯å£
   â€¢ å¯åŠ¨æ—¶é—´
   â€¢ è´Ÿè½½ä¿¡æ¯
   â†“
5ï¸âƒ£ å®šæœŸå‘é€å¿ƒè·³ï¼ˆé»˜è®¤3ç§’ï¼‰
   â†“
6ï¸âƒ£ Masterç›‘å¬è¯¥ç›®å½•ï¼Œæ„ŸçŸ¥RegionServerå˜åŒ–
```

**ğŸ¯ å…³é”®é…ç½®ç¤ºä¾‹**

```xml
<!-- hbase-site.xml -->
<property>
  <name>zookeeper.session.timeout</name>
  <value>90000</value>
  <!-- ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡å³è®¤ä¸ºRegionServerå®•æœº -->
</property>

<property>
  <name>hbase.regionserver.info.port</name>
  <value>16030</value>
  <!-- RegionServer Web UIç«¯å£ -->
</property>
```

### 2.3 å¿ƒè·³æ£€æµ‹æœºåˆ¶


**ğŸ’“ Zookeeperå¦‚ä½•ç›‘æ§RegionServer**

â”Œâ”€ å¿ƒè·³ç›‘æ§åŸç† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚ RegionServeræ¯3ç§’å‘é€å¿ƒè·³      â”‚
â”‚          â†“                     â”‚
â”‚ Zookeeperç»´æŠ¤ä¸´æ—¶èŠ‚ç‚¹          â”‚
â”‚          â†“                     â”‚
â”‚ è¶…è¿‡90ç§’æœªæ”¶åˆ°å¿ƒè·³             â”‚
â”‚          â†“                     â”‚
â”‚ ä¸´æ—¶èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤               â”‚
â”‚          â†“                     â”‚
â”‚ Masteræ„ŸçŸ¥åˆ°èŠ‚ç‚¹åˆ é™¤äº‹ä»¶       â”‚
â”‚          â†“                     â”‚
â”‚ è§¦å‘æ•…éšœæ¢å¤æµç¨‹               â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**âš¡ æ•…éšœæ£€æµ‹ç¤ºä¾‹**

æ­£å¸¸æƒ…å†µï¼š
```
æ—¶é—´è½´ï¼š
00:00 â†’ RSå‘é€å¿ƒè·³ âœ…
00:03 â†’ RSå‘é€å¿ƒè·³ âœ…
00:06 â†’ RSå‘é€å¿ƒè·³ âœ…
...æŒç»­è¿è¡Œ
```

æ•…éšœæƒ…å†µï¼š
```
æ—¶é—´è½´ï¼š
00:00 â†’ RSå‘é€å¿ƒè·³ âœ…
00:03 â†’ RSå‘é€å¿ƒè·³ âœ…
00:06 â†’ RSå®•æœº âŒ
00:09 â†’ æœªæ”¶åˆ°å¿ƒè·³
...
01:36 â†’ Zookeeperåˆ é™¤ä¸´æ—¶èŠ‚ç‚¹
01:36 â†’ Masteræ”¶åˆ°èŠ‚ç‚¹åˆ é™¤é€šçŸ¥
01:37 â†’ Masterå¯åŠ¨æ•…éšœæ¢å¤
```

### 2.4 RegionServeråŠ¨æ€æ„ŸçŸ¥


**ğŸ“¡ Masterå¦‚ä½•æ„ŸçŸ¥RegionServerå˜åŒ–**

Masteré€šè¿‡Watchæœºåˆ¶å®æ—¶ç›‘å¬ï¼š

```java
// ä¼ªä»£ç ç¤ºæ„Masterç›‘å¬é€»è¾‘
zookeeper.watchChildren("/hbase/rs", (event) -> {
    if (event.type == NodeDeleted) {
        // RegionServerå®•æœº
        String failedRS = event.path;
        startFailoverProcess(failedRS);
    } 
    else if (event.type == NodeCreated) {
        // æ–°RegionServeråŠ å…¥
        String newRS = event.path;
        assignRegionsToNewRS(newRS);
    }
});
```

**ğŸ”„ é›†ç¾¤å˜åŒ–å“åº”æµç¨‹**

```
åœºæ™¯1: RegionServerä¸‹çº¿
RegionServerå®•æœº
    â†“
Zookeeperåˆ é™¤ä¸´æ—¶èŠ‚ç‚¹
    â†“
Masteræ”¶åˆ°åˆ é™¤äº‹ä»¶
    â†“
å°†è¯¥RSä¸Šçš„Regionåˆ†é…ç»™å…¶ä»–RS
    â†“
å®¢æˆ·ç«¯è·¯ç”±ä¿¡æ¯æ›´æ–°

åœºæ™¯2: RegionServerä¸Šçº¿
æ–°RegionServerå¯åŠ¨
    â†“
åœ¨Zookeeperåˆ›å»ºä¸´æ—¶èŠ‚ç‚¹
    â†“
Masteræ”¶åˆ°åˆ›å»ºäº‹ä»¶
    â†“
åˆ†é…éƒ¨åˆ†Regionåˆ°æ–°RS
    â†“
è´Ÿè½½è‡ªåŠ¨å‡è¡¡
```

---

## 3. ğŸ—‚ï¸ HBaseå…ƒæ•°æ®å­˜å‚¨


### 3.1 ä»€ä¹ˆæ˜¯Metaè¡¨


**ğŸ“š Metaè¡¨çš„ä½œç”¨**

Metaè¡¨å°±åƒHBaseçš„"åœ°å›¾ç´¢å¼•"ï¼š
- è®°å½•äº†æ‰€æœ‰Regionçš„ä½ç½®ä¿¡æ¯
- å‘Šè¯‰å®¢æˆ·ç«¯æ•°æ®å­˜åœ¨å“ªä¸ªRegionServerä¸Š

```
ç±»æ¯”ç†è§£ï¼š

å›¾ä¹¦é¦†åœºæ™¯ï¼š
â€¢ Metaè¡¨ = æ€»ç›®å½•
â€¢ è®°å½•æ¯æœ¬ä¹¦åœ¨å“ªä¸ªä¹¦æ¶ï¼ˆRegionServerï¼‰
â€¢ æ¯ä¸ªä¹¦æ¶çš„ç¼–å·èŒƒå›´ï¼ˆRowKeyèŒƒå›´ï¼‰

HBaseåœºæ™¯ï¼š
â€¢ Metaè¡¨ = è·¯ç”±è¡¨
â€¢ RowKeyèŒƒå›´ â†’ RegionServeræ˜ å°„
â€¢ å®¢æˆ·ç«¯é€šè¿‡Metaè¡¨å®šä½æ•°æ®
```

### 3.2 Metaè¡¨å­˜å‚¨ä½ç½®


**ğŸ¯ Zookeeperä¸­çš„Metaä½ç½®èŠ‚ç‚¹**

```
ZookeeperèŠ‚ç‚¹ç»“æ„ï¼š

/hbase
  â”œâ”€â”€ master               (Masteråœ°å€)
  â”œâ”€â”€ meta-region-server   (Metaè¡¨ä½ç½®) â­
  â”‚     â””â”€â”€ æ•°æ®: 192.168.1.101:16020
  â”œâ”€â”€ rs                   (RegionServeråˆ—è¡¨)
  â”‚     â”œâ”€â”€ rs-192.168.1.101:16020
  â”‚     â”œâ”€â”€ rs-192.168.1.102:16020
  â”‚     â””â”€â”€ rs-192.168.1.103:16020
  â””â”€â”€ table                (è¡¨çŠ¶æ€)
```

**ğŸ’¡ Metaè¡¨å®šä½æµç¨‹**

```
å®¢æˆ·ç«¯æŸ¥æ‰¾æ•°æ®çš„ä¸¤è·³è¿‡ç¨‹ï¼š

ç¬¬ä¸€è·³ï¼šæŸ¥Zookeeper
   â†“
Client â†’ Zookeeper(/hbase/meta-region-server)
   â†“
è¿”å›: Metaè¡¨åœ¨ 192.168.1.101:16020

ç¬¬äºŒè·³ï¼šæŸ¥Metaè¡¨
   â†“
Client â†’ RegionServer(192.168.1.101)
   â†“
æŸ¥è¯¢Metaè¡¨: RowKey=user:123 åœ¨å“ªï¼Ÿ
   â†“
è¿”å›: åœ¨ 192.168.1.102:16020

ç¬¬ä¸‰è·³ï¼šè®¿é—®æ•°æ®
   â†“
Client â†’ RegionServer(192.168.1.102)
   â†“
è¯»å†™ user:123 çš„æ•°æ®
```

### 3.3 Metaè¡¨ç»“æ„è¯¦è§£


**ğŸ“‹ Metaè¡¨å†…å®¹ç¤ºä¾‹**

| RowKey | **Regionä¿¡æ¯** | **RegionServer** |
|--------|--------------|-----------------|
| `table1,,00001` | `è¡¨å:table1`<br>`èµ·å§‹Key:ç©º`<br>`ç»“æŸKey:1000` | `192.168.1.101:16020` |
| `table1,1000,00002` | `è¡¨å:table1`<br>`èµ·å§‹Key:1000`<br>`ç»“æŸKey:2000` | `192.168.1.102:16020` |
| `table1,2000,00003` | `è¡¨å:table1`<br>`èµ·å§‹Key:2000`<br>`ç»“æŸKey:ç©º` | `192.168.1.103:16020` |

**ğŸ” å¦‚ä½•å®šä½æ•°æ®**

å‡è®¾è¦æŸ¥è¯¢ `RowKey = 1500` çš„æ•°æ®ï¼š

```
1. åœ¨Metaè¡¨ä¸­æŸ¥æ‰¾
   1500 è½åœ¨ [1000, 2000) åŒºé—´
   
2. æ‰¾åˆ°å¯¹åº”çš„Regionä¿¡æ¯
   table1,1000,00002
   
3. è·å–RegionServeråœ°å€
   192.168.1.102:16020
   
4. è¿æ¥è¯¥RegionServerè¯»å–æ•°æ®
```

### 3.4 å…ƒæ•°æ®ç¼“å­˜æœºåˆ¶


**ğŸš€ å®¢æˆ·ç«¯ç¼“å­˜ä¼˜åŒ–**

```
é¦–æ¬¡è®¿é—®ï¼š
Client â†’ Zookeeper (æŸ¥Metaä½ç½®)
       â†’ Metaè¡¨ (æŸ¥Regionä½ç½®)
       â†’ RegionServer (è¯»å†™æ•°æ®)
å…±éœ€è¦3æ¬¡ç½‘ç»œè¯·æ±‚

ç¼“å­˜åè®¿é—®ï¼š
Client â†’ æœ¬åœ°ç¼“å­˜ (ç›´æ¥è·å–RegionServeråœ°å€)
       â†’ RegionServer (è¯»å†™æ•°æ®)
åªéœ€è¦1æ¬¡ç½‘ç»œè¯·æ±‚ âš¡
```

**ğŸ“Š ç¼“å­˜å¤±æ•ˆå¤„ç†**

```
è§¦å‘ç¼“å­˜æ›´æ–°çš„æƒ…å†µï¼š

1. Regionè¿ç§»
   Regionä»RS-1è¿ç§»åˆ°RS-2
   â†“
   å®¢æˆ·ç«¯è®¿é—®RS-1å¤±è´¥
   â†“
   é‡æ–°æŸ¥è¯¢Metaè¡¨æ›´æ–°ç¼“å­˜

2. RegionServerå®•æœº
   RS-2å®•æœº
   â†“
   è¿æ¥è¶…æ—¶
   â†“
   æ¸…é™¤ç¼“å­˜ï¼Œé‡æ–°å®šä½

3. Regionåˆ†è£‚
   ä¸€ä¸ªRegionåˆ†è£‚æˆä¸¤ä¸ª
   â†“
   Metaè¡¨æ›´æ–°
   â†“
   å®¢æˆ·ç«¯ä¸‹æ¬¡æŸ¥è¯¢æ—¶æ›´æ–°ç¼“å­˜
```

---

## 4. ğŸ‘‘ HBase Masteré€‰ä¸¾


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦Masteré€‰ä¸¾


**ğŸ¤” Masterçš„å…³é”®ä½œç”¨**

HBase Masterå°±åƒ"æŒ‡æŒ¥ä¸­å¿ƒ"ï¼š
- **è´Ÿè½½å‡è¡¡**ï¼šå°†Regionåˆç†åˆ†é…åˆ°å„ä¸ªRegionServer
- **è¡¨ç®¡ç†**ï¼šåˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹è¡¨ç»“æ„
- **æ•…éšœæ¢å¤**ï¼šRegionServerå®•æœºæ—¶é‡æ–°åˆ†é…Region

```
æ²¡æœ‰Masterçš„é—®é¢˜ï¼š
â€¢ è°æ¥åè°ƒRegionåˆ†é…ï¼ŸâŒ
â€¢ è¡¨æ“ä½œç”±è°æ‰§è¡Œï¼ŸâŒ
â€¢ RegionServerå®•æœºè°å¤„ç†ï¼ŸâŒ

æœ‰Masterä½†æ²¡æœ‰å¤‡ä»½ï¼š
â€¢ Masterå®•æœºæ•´ä¸ªé›†ç¾¤ç˜«ç—ª âŒ

Masteré€‰ä¸¾çš„ä»·å€¼ï¼š
â€¢ è‡ªåŠ¨æ•…éšœåˆ‡æ¢ âœ…
â€¢ é«˜å¯ç”¨ä¿éšœ âœ…
```

### 4.2 Masteré€‰ä¸¾æœºåˆ¶


**ğŸ† åŸºäºZookeeperçš„é€‰ä¸¾æµç¨‹**

```
Masteré€‰ä¸¾æµç¨‹ï¼š

1ï¸âƒ£ å¤šä¸ªMasterè¿›ç¨‹å¯åŠ¨
   Master-1, Master-2, Master-3
   
2ï¸âƒ£ ç«äº‰åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹
   /hbase/master
   (åªèƒ½æœ‰ä¸€ä¸ªæˆåŠŸåˆ›å»º)
   
3ï¸âƒ£ åˆ›å»ºæˆåŠŸè€…æˆä¸ºActive Master
   Master-1 åˆ›å»ºæˆåŠŸ â†’ Active ğŸ¯
   
4ï¸âƒ£ å¤±è´¥è€…æˆä¸ºBackup Master
   Master-2, Master-3 â†’ Standby ğŸ’¤
   
5ï¸âƒ£ Backup Masterç›‘å¬èŠ‚ç‚¹
   Watch /hbase/master
   
6ï¸âƒ£ Active Masterå®•æœº
   ä¸´æ—¶èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤
   
7ï¸âƒ£ Backup Masteræ„ŸçŸ¥åˆ°å˜åŒ–
   é‡æ–°ç«äº‰åˆ›å»ºèŠ‚ç‚¹
   
8ï¸âƒ£ æ–°çš„Active Masteräº§ç”Ÿ
   Master-2 åˆ›å»ºæˆåŠŸ â†’ Active ğŸ¯
```

**âš¡ é€‰ä¸¾è¿‡ç¨‹å¯è§†åŒ–**

æ­£å¸¸çŠ¶æ€ï¼š
```
Master-1 (Active)  â† /hbase/masterèŠ‚ç‚¹
    â†‘
    ç›‘å¬
    â†“
Master-2 (Backup)
Master-3 (Backup)
```

æ•…éšœåˆ‡æ¢ï¼š
```
Master-1 å®•æœº ğŸ’¥
    â†“
/hbase/masterèŠ‚ç‚¹åˆ é™¤
    â†“
Master-2, Master-3 ç«äº‰åˆ›å»º
    â†“
Master-2 æˆåŠŸ âœ…
    â†“
Master-2 (Active)  â† /hbase/masterèŠ‚ç‚¹
Master-3 (Backup)  â† ç»§ç»­ç­‰å¾…
```

### 4.3 MasterèŠ‚ç‚¹æ•°æ®å†…å®¹


**ğŸ“ Active Masterä¿¡æ¯å­˜å‚¨**

```
/hbase/master èŠ‚ç‚¹å†…å®¹ï¼š
{
  "hostname": "hbase-master-1",
  "port": 16000,
  "startTime": 1736923800000,
  "versionInfo": "2.4.9",
  "infoPort": 16010
}
```

**ğŸ” å®¢æˆ·ç«¯å¦‚ä½•è·å–Masterä¿¡æ¯**

```java
// ä¼ªä»£ç ï¼šå®¢æˆ·ç«¯è·å–Masteråœ°å€
String masterAddress = zookeeper.getData("/hbase/master");
// è¿”å›: hbase-master-1:16000

// è¿æ¥Masteræ‰§è¡Œç®¡ç†æ“ä½œ
AdminClient admin = new AdminClient(masterAddress);
admin.createTable("users");
```

### 4.4 é€‰ä¸¾é…ç½®ä¸ä¼˜åŒ–


**âš™ï¸ å…³é”®é…ç½®å‚æ•°**

```xml
<!-- hbase-site.xml Masteré€‰ä¸¾é…ç½® -->

<property>
  <name>hbase.master.port</name>
  <value>16000</value>
  <!-- MasteræœåŠ¡ç«¯å£ -->
</property>

<property>
  <name>hbase.master.info.port</name>
  <value>16010</value>
  <!-- Master Web UIç«¯å£ -->
</property>

<property>
  <name>zookeeper.session.timeout</name>
  <value>180000</value>
  <!-- ä¼šè¯è¶…æ—¶ï¼Œå½±å“æ•…éšœåˆ‡æ¢é€Ÿåº¦ -->
</property>
```

**ğŸ“Š é€‰ä¸¾æ€§èƒ½å¯¹æ¯”**

| é…ç½® | **æ•…éšœåˆ‡æ¢æ—¶é—´** | **é€‚ç”¨åœºæ™¯** |
|-----|----------------|------------|
| ä¼šè¯è¶…æ—¶30ç§’ | `~30ç§’` | `æµ‹è¯•ç¯å¢ƒï¼Œå¿«é€Ÿæ„ŸçŸ¥` |
| ä¼šè¯è¶…æ—¶90ç§’ | `~90ç§’` | `ç”Ÿäº§ç¯å¢ƒï¼Œå¹³è¡¡ç¨³å®šæ€§` |
| ä¼šè¯è¶…æ—¶180ç§’ | `~180ç§’` | `ç½‘ç»œä¸ç¨³å®šç¯å¢ƒ` |

---

## 5. ğŸ”„ é›†ç¾¤åè°ƒä¸æ•…éšœå¤„ç†


### 5.1 æ•…éšœæ£€æµ‹æµç¨‹


**ğŸš¨ å®Œæ•´æ•…éšœæ£€æµ‹é“¾è·¯**

```
æ•…éšœæ£€æµ‹æµç¨‹ï¼š

RegionServeræ•…éšœåœºæ™¯ï¼š

1ï¸âƒ£ RegionServerå¿ƒè·³åœæ­¢
   RS-2 å®•æœºï¼Œåœæ­¢å‘é€å¿ƒè·³
   â†“
2ï¸âƒ£ Zookeeperä¼šè¯è¶…æ—¶
   90ç§’æœªæ”¶åˆ°å¿ƒè·³
   â†“
3ï¸âƒ£ åˆ é™¤ä¸´æ—¶èŠ‚ç‚¹
   /hbase/rs/rs-192.168.1.102:16020 åˆ é™¤
   â†“
4ï¸âƒ£ Masteræ”¶åˆ°åˆ é™¤äº‹ä»¶
   Watchè§¦å‘
   â†“
5ï¸âƒ£ Masterå¯åŠ¨æ•…éšœæ¢å¤
   é‡æ–°åˆ†é…Region
```

**ğŸ’¡ é€šä¿—ç†è§£**

å°±åƒå‘˜å·¥è€ƒå‹¤ç³»ç»Ÿï¼š
- å‘˜å·¥ï¼ˆRegionServerï¼‰æ¯å¤©æ‰“å¡ï¼ˆå¿ƒè·³ï¼‰
- è¶…è¿‡3ä¸ªæœˆä¸æ‰“å¡ï¼ˆä¼šè¯è¶…æ—¶ï¼‰
- ç³»ç»Ÿè‡ªåŠ¨æ³¨é”€è´¦å·ï¼ˆåˆ é™¤èŠ‚ç‚¹ï¼‰
- HRï¼ˆMasterï¼‰æ”¶åˆ°é€šçŸ¥
- é‡æ–°åˆ†é…å·¥ä½œä»»åŠ¡ï¼ˆRegionï¼‰

### 5.2 Regionæ•…éšœæ¢å¤


**ğŸ”§ Regioné‡æ–°åˆ†é…æµç¨‹**

```
Regionæ•…éšœæ¢å¤è¯¦ç»†æ­¥éª¤ï¼š

æ•…éšœå‘ç”Ÿï¼š
RS-2 å®•æœºï¼Œä¸Šé¢æœ‰ Region-A, Region-B
    â†“
Masteræ„ŸçŸ¥ï¼š
æ”¶åˆ° /hbase/rs/rs-2 åˆ é™¤äº‹ä»¶
    â†“
WALæ—¥å¿—åˆ†å‰²ï¼š
åˆ†å‰²RS-2çš„é¢„å†™æ—¥å¿—(WAL)
ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±
    â†“
Regionåˆ†é…ï¼š
å°†Region-Aåˆ†é…ç»™RS-1
å°†Region-Båˆ†é…ç»™RS-3
    â†“
Metaè¡¨æ›´æ–°ï¼š
æ›´æ–°Regionä½ç½®ä¿¡æ¯
Region-A â†’ RS-1
Region-B â†’ RS-3
    â†“
æœåŠ¡æ¢å¤ï¼š
å®¢æˆ·ç«¯é‡æ–°å®šä½ï¼Œè®¿é—®æ¢å¤
```

**ğŸ“Š æ¢å¤æ—¶é—´çº¿**

```
æ—¶é—´è½´ç¤ºä¾‹ï¼š

T+0ç§’:  RS-2å®•æœº
T+90ç§’: Zookeeperåˆ é™¤èŠ‚ç‚¹
T+91ç§’: Masteræ”¶åˆ°é€šçŸ¥
T+92ç§’: å¼€å§‹WALæ—¥å¿—åˆ†å‰²
T+120ç§’: æ—¥å¿—åˆ†å‰²å®Œæˆ
T+121ç§’: åˆ†é…Regionåˆ°å…¶ä»–RS
T+125ç§’: Metaè¡¨æ›´æ–°å®Œæˆ
T+126ç§’: å®¢æˆ·ç«¯è®¿é—®æ¢å¤

æ€»æ¢å¤æ—¶é—´: çº¦2åˆ†é’Ÿ
```

### 5.3 åˆ†å¸ƒå¼é”åº”ç”¨


**ğŸ”’ Zookeeperåœ¨HBaseä¸­çš„é”æœºåˆ¶**

**åœºæ™¯1ï¼šè¡¨æ“ä½œäº’æ–¥**

```
è¡¨çº§é”åœºæ™¯ï¼š

é—®é¢˜ï¼š
å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶ä¿®æ”¹åŒä¸€å¼ è¡¨çš„schemaä¼šå†²çª

è§£å†³æ–¹æ¡ˆï¼š
Client-1 åˆ›å»º /hbase/table/users/lock
    â†“ (æˆåŠŸï¼Œè·å¾—é”)
æ‰§è¡Œ alter table users
    â†“
åˆ é™¤ /hbase/table/users/lock
    â†“ (é‡Šæ”¾é”)
Client-2 æ‰èƒ½è·å–é”
```

**åœºæ™¯2ï¼šRegionåˆ†é…äº’æ–¥**

```
Regionåˆ†é…é”ï¼š

ç›®çš„ï¼š
é˜²æ­¢åŒä¸€Regionè¢«åˆ†é…åˆ°å¤šä¸ªRegionServer

æµç¨‹ï¼š
Master-1 å‡†å¤‡åˆ†é…Region-A
    â†“
åˆ›å»º /hbase/region-in-transition/Region-A
    â†“ (åˆ›å»ºæˆåŠŸï¼Œè·å¾—åˆ†é…æƒ)
å°†Region-Aåˆ†é…ç»™RS-1
    â†“
åˆ é™¤ /hbase/region-in-transition/Region-A
    â†“ (é‡Šæ”¾é”)
```

### 5.4 é›†ç¾¤çŠ¶æ€åŒæ­¥


**ğŸ”„ çŠ¶æ€å˜æ›´é€šçŸ¥æœºåˆ¶**

â”Œâ”€ Zookeeperäº‹ä»¶é€šçŸ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚
â”‚ RegionServerå˜åŒ–             â”‚
â”‚    â†“                         â”‚
â”‚ Zookeeperé€šçŸ¥Master          â”‚
â”‚    â†“                         â”‚
â”‚ Masteræ›´æ–°å†…å­˜çŠ¶æ€            â”‚
â”‚    â†“                         â”‚
â”‚ å®¢æˆ·ç«¯Watch Metaå˜åŒ–          â”‚
â”‚    â†“                         â”‚
â”‚ å®¢æˆ·ç«¯æ›´æ–°è·¯ç”±ç¼“å­˜            â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

**ğŸ“¡ å®æ—¶ç›‘æ§ç¤ºä¾‹**

```java
// ä¼ªä»£ç ï¼šMasterç›‘å¬é›†ç¾¤å˜åŒ–
public class MasterMonitor {
    
    // ç›‘å¬RegionServerå˜åŒ–
    zookeeper.watchChildren("/hbase/rs", event -> {
        if (event.type == NodeDeleted) {
            handleRegionServerCrash(event.path);
        }
    });
    
    // ç›‘å¬è¡¨çŠ¶æ€å˜åŒ–
    zookeeper.watchChildren("/hbase/table", event -> {
        if (event.type == NodeDataChanged) {
            reloadTableState(event.path);
        }
    });
    
    // ç›‘å¬Masterä¸»å¤‡åˆ‡æ¢
    zookeeper.watchNode("/hbase/master", event -> {
        if (event.type == NodeDeleted) {
            startMasterElection();
        }
    });
}
```

**ğŸ¯ æ ¸å¿ƒç›‘æ§èŠ‚ç‚¹**

| ç›‘æ§è·¯å¾„ | **ç›‘æ§å†…å®¹** | **è§¦å‘åŠ¨ä½œ** |
|---------|------------|------------|
| `/hbase/rs/*` | `RegionServerä¸Šä¸‹çº¿` | `Regioné‡åˆ†é…` |
| `/hbase/master` | `Masterä¸»å¤‡åˆ‡æ¢` | `é‡æ–°é€‰ä¸¾` |
| `/hbase/table/*` | `è¡¨çŠ¶æ€å˜æ›´` | `æ›´æ–°è·¯ç”±ä¿¡æ¯` |
| `/hbase/splitWAL/*` | `æ—¥å¿—åˆ†å‰²çŠ¶æ€` | `æ•…éšœæ¢å¤åè°ƒ` |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ HBaseä¾èµ–Zookeeperçš„å››å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š
   1. Masteré€‰ä¸¾ - ä¿è¯é«˜å¯ç”¨
   2. RegionServerç›‘æ§ - å®æ—¶æ„ŸçŸ¥æ•…éšœ
   3. å…ƒæ•°æ®å­˜å‚¨ - å¿«é€Ÿæ•°æ®å®šä½
   4. é›†ç¾¤åè°ƒ - ç»Ÿä¸€çŠ¶æ€ç®¡ç†

ğŸ”¸ å…³é”®èŠ‚ç‚¹åŠä½œç”¨ï¼š
   â€¢ /hbase/master - å­˜å‚¨Active Masterä¿¡æ¯
   â€¢ /hbase/rs - RegionServerå¿ƒè·³èŠ‚ç‚¹
   â€¢ /hbase/meta-region-server - Metaè¡¨ä½ç½®
   â€¢ /hbase/table - è¡¨çŠ¶æ€ä¿¡æ¯
```

### 6.2 å…³é”®æµç¨‹ç†è§£


**ğŸ”¹ æ•°æ®å®šä½ä¸‰æ­¥èµ°**

```
æ­¥éª¤è®°å¿†ï¼š

1. é—®Zookeeperï¼šMetaè¡¨åœ¨å“ªï¼Ÿ
   â†’ è¿”å›RegionServeråœ°å€
   
2. æŸ¥Metaè¡¨ï¼šæˆ‘çš„æ•°æ®åœ¨å“ªä¸ªRegionï¼Ÿ
   â†’ è¿”å›ç›®æ ‡RegionServer
   
3. è®¿é—®RegionServerï¼šè¯»å†™æ•°æ®
   â†’ å®Œæˆæ“ä½œ

ä¼˜åŒ–ï¼šç¼“å­˜è·¯ç”±ä¿¡æ¯ï¼Œå‡å°‘æŸ¥è¯¢
```

**ğŸ”¹ æ•…éšœæ¢å¤äº”æ­¥éª¤**

```
æ¢å¤æµç¨‹è®°å¿†ï¼š

1. RegionServerå¿ƒè·³åœæ­¢
2. Zookeeperåˆ é™¤ä¸´æ—¶èŠ‚ç‚¹ï¼ˆ90ç§’è¶…æ—¶ï¼‰
3. Masteræ”¶åˆ°åˆ é™¤äº‹ä»¶é€šçŸ¥
4. åˆ†å‰²WALæ—¥å¿—ï¼Œé‡æ–°åˆ†é…Region
5. æ›´æ–°Metaè¡¨ï¼Œå®¢æˆ·ç«¯æ¢å¤è®¿é—®

å…³é”®æ—¶é—´ï¼šçº¦2åˆ†é’Ÿå®Œæˆæ¢å¤
```

### 6.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**

```
åœºæ™¯1: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
â€¢ é…ç½®ï¼š3å°Zookeeper + 1 Active Master + 2 Backup Master
â€¢ å¥½å¤„ï¼šMasteræ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼ŒæœåŠ¡ä¸ä¸­æ–­
â€¢ æ•…éšœåˆ‡æ¢æ—¶é—´ï¼š< 3åˆ†é’Ÿ

åœºæ™¯2: RegionServeræ‰©å®¹
â€¢ æ“ä½œï¼šæ–°å¢RegionServerèŠ‚ç‚¹
â€¢ è‡ªåŠ¨ï¼šåœ¨Zookeeperæ³¨å†Œä¸´æ—¶èŠ‚ç‚¹
â€¢ ç»“æœï¼šMasterè‡ªåŠ¨åˆ†é…Regionï¼Œè´Ÿè½½å‡è¡¡

åœºæ™¯3: å®¢æˆ·ç«¯è®¿é—®ä¼˜åŒ–
â€¢ ç¬¬ä¸€æ¬¡ï¼šæŸ¥Zookeeper + Metaè¡¨ï¼ˆè¾ƒæ…¢ï¼‰
â€¢ åç»­ï¼šä½¿ç”¨ç¼“å­˜ç›´æ¥è®¿é—®ï¼ˆæå¿«ï¼‰
â€¢ å¤±æ•ˆï¼šRegionè¿ç§»æ—¶è‡ªåŠ¨æ›´æ–°ç¼“å­˜
```

**ğŸ“Š æ€§èƒ½è°ƒä¼˜å»ºè®®**

```
é…ç½®ä¼˜åŒ–ï¼š

1. ä¼šè¯è¶…æ—¶æ—¶é—´
   â€¢ æµ‹è¯•ç¯å¢ƒï¼š30-60ç§’ï¼ˆå¿«é€Ÿæ•…éšœåˆ‡æ¢ï¼‰
   â€¢ ç”Ÿäº§ç¯å¢ƒï¼š90-180ç§’ï¼ˆé¿å…è¯¯åˆ¤ï¼‰

2. å¿ƒè·³é—´éš”
   â€¢ é»˜è®¤3ç§’ï¼Œç½‘ç»œä¸ç¨³å®šå¯è°ƒå¤§åˆ°5ç§’
   â€¢ ä¸å»ºè®®è¶…è¿‡10ç§’

3. å®¢æˆ·ç«¯ç¼“å­˜
   â€¢ å¼€å¯è·¯ç”±ç¼“å­˜ï¼Œå‡å°‘Metaè¡¨æŸ¥è¯¢
   â€¢ è®¾ç½®åˆç†çš„ç¼“å­˜å¤±æ•ˆæ—¶é—´
```

### 6.4 æ ¸å¿ƒè®°å¿†è¦ç‚¹


**ğŸ§  ä¸€å¥è¯æ€»ç»“**

```
Zookeeperæ˜¯HBaseçš„"ç¥ç»ä¸­æ¢"ï¼š
â€¢ é€‰ä¸¾Masterï¼ˆå¤§è„‘ï¼‰
â€¢ ç›‘æ§RegionServerï¼ˆå™¨å®˜ï¼‰
â€¢ å­˜å‚¨Metaä¿¡æ¯ï¼ˆè®°å¿†ï¼‰
â€¢ åè°ƒé›†ç¾¤ï¼ˆæŒ‡æŒ¥ï¼‰
```

**ğŸ“Œ å¸¸è§é—®é¢˜é€ŸæŸ¥**

| é—®é¢˜ | **ç­”æ¡ˆ** |
|-----|---------|
| **HBaseä¸ºä»€ä¹ˆä¾èµ–Zookeeperï¼Ÿ** | `å®ç°Masteré€‰ä¸¾ã€RegionServerç›‘æ§ã€å…ƒæ•°æ®å­˜å‚¨ã€é›†ç¾¤åè°ƒ` |
| **å®¢æˆ·ç«¯å¦‚ä½•æ‰¾åˆ°æ•°æ®ï¼Ÿ** | `ZookeeperæŸ¥Metaä½ç½® â†’ Metaè¡¨æŸ¥Regionä½ç½® â†’ è®¿é—®RegionServer` |
| **RegionServerå®•æœºæ€ä¹ˆåŠï¼Ÿ** | `Zookeeperåˆ é™¤èŠ‚ç‚¹ â†’ Masteré‡æ–°åˆ†é…Region â†’ æœåŠ¡æ¢å¤ï¼ˆçº¦2åˆ†é’Ÿï¼‰` |
| **Masterå®•æœºæ€ä¹ˆåŠï¼Ÿ** | `Backup Masteré€šè¿‡Zookeeperé€‰ä¸¾ï¼Œè‡ªåŠ¨æ¥ç®¡ï¼ˆçº¦3åˆ†é’Ÿï¼‰` |
| **å¦‚ä½•æå‡å®¢æˆ·ç«¯æ€§èƒ½ï¼Ÿ** | `å¼€å¯è·¯ç”±ç¼“å­˜ï¼Œé¿å…æ¯æ¬¡éƒ½æŸ¥Metaè¡¨` |

**ğŸ¯ å­¦ä¹ å»ºè®®**

```
å­¦ä¹ è·¯çº¿ï¼š

åŸºç¡€ç†è§£ â†’ æŒæ¡æ¶æ„å…³ç³»å’Œæ ¸å¿ƒèŠ‚ç‚¹
   â†“
æµç¨‹æŒæ¡ â†’ ç†è§£æ•°æ®å®šä½å’Œæ•…éšœæ¢å¤
   â†“
å®æˆ˜åº”ç”¨ â†’ é…ç½®ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜
   â†“
æ·±å…¥åŸç† â†’ æºç åˆ†æå’Œé«˜çº§ç‰¹æ€§
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Zookeeperç®¡åè°ƒï¼ŒHBaseç¦»ä¸äº†
- Masteré€‰ä¸¾å®ƒåšä¸»ï¼ŒRegionServerå®ƒç›‘æ§
- Metaä½ç½®å®ƒå­˜å‚¨ï¼Œæ•…éšœæ¢å¤å®ƒåè°ƒ
- å®¢æˆ·ç«¯å…ˆé—®å®ƒï¼Œæ•°æ®å®šä½å°‘ä¸äº†