---
title: 4ã€Eureka Clienté›†æˆå®æˆ˜
---
## ğŸ“š ç›®å½•

1. [Eureka Clientæ ¸å¿ƒæ¦‚å¿µ](#1-Eureka-Clientæ ¸å¿ƒæ¦‚å¿µ)
2. [æœåŠ¡æä¾›è€…æ³¨å†Œ](#2-æœåŠ¡æä¾›è€…æ³¨å†Œ)
3. [æœåŠ¡æ¶ˆè´¹è€…å‘ç°](#3-æœåŠ¡æ¶ˆè´¹è€…å‘ç°)
4. [å®ä¾‹å…ƒæ•°æ®é…ç½®](#4-å®ä¾‹å…ƒæ•°æ®é…ç½®)
5. [å¥åº·æ£€æŸ¥ä¸ä¼˜é›…åœæœº](#5-å¥åº·æ£€æŸ¥ä¸ä¼˜é›…åœæœº)
6. [é…ç½®å‚æ•°è¯¦è§£](#6-é…ç½®å‚æ•°è¯¦è§£)
7. [REST APIä½¿ç”¨](#7-REST-APIä½¿ç”¨)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Eureka Clientæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Eureka Client


> ğŸ’¡ **é€šä¿—ç†è§£**
> 
> æƒ³è±¡ä¸€ä¸ªå¤§å‹å•†åœºï¼ŒEureka Serverå°±åƒ**å•†åœºå¯¼è´­å°**ï¼Œè€ŒEureka Clientå°±æ˜¯**å…¥é©»çš„å•†å®¶**ã€‚
> - å•†å®¶éœ€è¦åœ¨å¯¼è´­å°**ç™»è®°è‡ªå·±çš„ä½ç½®**ï¼ˆæœåŠ¡æ³¨å†Œï¼‰
> - é¡¾å®¢å¯ä»¥åœ¨å¯¼è´­å°**æŸ¥è¯¢å•†å®¶ä½ç½®**ï¼ˆæœåŠ¡å‘ç°ï¼‰
> - å•†å®¶è¦å®šæœŸå‘å¯¼è´­å°**æŠ¥å‘Šè¥ä¸šçŠ¶æ€**ï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰

**ğŸ“‹ Eureka Clientçš„ä¸¤ç§è§’è‰²**

```
å¾®æœåŠ¡æ¶æ„ä¸­çš„è§’è‰²åˆ†å·¥ï¼š

ğŸª æœåŠ¡æä¾›è€… (Service Provider)          ğŸ‘¤ æœåŠ¡æ¶ˆè´¹è€… (Service Consumer)
â”œâ”€ æ³¨å†Œè‡ªå·±åˆ°Eureka Server                â”œâ”€ ä»Eureka Serverè·å–æœåŠ¡åˆ—è¡¨
â”œâ”€ å®šæœŸå‘é€å¿ƒè·³ä¿æŒåœ¨çº¿                    â”œâ”€ æ ¹æ®æœåŠ¡åè°ƒç”¨å…¶ä»–æœåŠ¡  
â”œâ”€ æä¾›å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½                      â”œâ”€ å®ç°è´Ÿè½½å‡è¡¡ç­–ç•¥
â””â”€ ä¾‹å¦‚ï¼šè®¢å•æœåŠ¡ã€ç”¨æˆ·æœåŠ¡                 â””â”€ ä¾‹å¦‚ï¼šç½‘å…³æœåŠ¡ã€å‰ç«¯æœåŠ¡

æ³¨æ„ï¼šä¸€ä¸ªæœåŠ¡å¯ä»¥åŒæ—¶æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…ï¼
```

### 1.2 Eureka Clientå·¥ä½œæµç¨‹


```
å®Œæ•´çš„æœåŠ¡æ³¨å†Œä¸å‘ç°æµç¨‹ï¼š

æœåŠ¡æä¾›è€…                  Eureka Server              æœåŠ¡æ¶ˆè´¹è€…
    |                           |                          |
    |--[1]å¯åŠ¨æ—¶æ³¨å†ŒæœåŠ¡-------->|                          |
    |   (æœåŠ¡å+IP+ç«¯å£)         |                          |
    |                           |                          |
    |<--[2]è¿”å›æ³¨å†ŒæˆåŠŸ----------|                          |
    |                           |                          |
    |--[3]æ¯30ç§’å‘é€å¿ƒè·³-------->|                          |
    |   (æˆ‘è¿˜æ´»ç€ï¼)             |                          |
    |                           |                          |
    |                           |<--[4]æ‹‰å–æœåŠ¡åˆ—è¡¨--------|
    |                           |   (ç»™æˆ‘è®¢å•æœåŠ¡çš„åœ°å€)    |
    |                           |                          |
    |                           |--[5]è¿”å›å¯ç”¨å®ä¾‹åˆ—è¡¨---->|
    |                           |   (3ä¸ªè®¢å•æœåŠ¡å®ä¾‹)      |
    |                           |                          |
    |<--------------[6]è´Ÿè½½å‡è¡¡è°ƒç”¨------------------------|
    |   (æ ¹æ®ç­–ç•¥é€‰æ‹©ä¸€ä¸ªå®ä¾‹)                             |
```

**ğŸ” å…³é”®æ—¶é—´èŠ‚ç‚¹**

| æ—¶é—´èŠ‚ç‚¹ | é»˜è®¤å€¼ | è¯´æ˜ | å¯è°ƒæ•´å— |
|---------|--------|------|---------|
| **æ³¨å†Œæ—¶æœº** | `å¯åŠ¨åç«‹å³` | æœåŠ¡å¯åŠ¨å®Œæˆå°±æ³¨å†Œ | âœ… å¯å»¶è¿Ÿæ³¨å†Œ |
| **å¿ƒè·³é—´éš”** | `30ç§’` | è¯æ˜æœåŠ¡è¿˜æ´»ç€ | âœ… å¯è°ƒæ•´ |
| **æ‹‰å–é—´éš”** | `30ç§’` | æ›´æ–°æœåŠ¡åˆ—è¡¨ | âœ… å¯è°ƒæ•´ |
| **å‰”é™¤æ—¶é—´** | `90ç§’` | è¶…æ—¶æœªå¿ƒè·³å°±å‰”é™¤ | âœ… å¯è°ƒæ•´ |

---

## 2. ğŸª æœåŠ¡æä¾›è€…æ³¨å†Œ


### 2.1 å¿«é€Ÿä¸Šæ‰‹ï¼šä¸‰æ­¥æ³¨å†ŒæœåŠ¡


> ğŸ¯ **å­¦ä¹ ç›®æ ‡**
> 
> è®©ä½ çš„ç¬¬ä¸€ä¸ªå¾®æœåŠ¡æˆåŠŸæ³¨å†Œåˆ°Eurekaï¼Œå°±åƒåœ¨å•†åœºå¼€åº—ä¸€æ ·ç®€å•ï¼

**æ­¥éª¤ 1ï¸âƒ£ï¼šæ·»åŠ ä¾èµ–**

åœ¨ `pom.xml` ä¸­æ·»åŠ Eureka Clientä¾èµ–ï¼š

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

**æ­¥éª¤ 2ï¸âƒ£ï¼šå¯ç”¨Eureka Client**

åœ¨ä¸»å¯åŠ¨ç±»ä¸ŠåŠ  `@EnableEurekaClient` æ³¨è§£ï¼š

```java
@SpringBootApplication
@EnableEurekaClient  // ğŸ‘ˆ è¿™ä¸ªæ³¨è§£å¯ç”¨Eurekaå®¢æˆ·ç«¯åŠŸèƒ½
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

> ğŸ’¡ **@EnableEurekaClient vs @EnableDiscoveryClient**
> 
> | æ³¨è§£ | é€‚ç”¨èŒƒå›´ | æ¨èåº¦ |
> |------|---------|--------|
> | `@EnableEurekaClient` | åªé€‚ç”¨äºEureka | â­â­â­ Eurekaä¸“ç”¨ |
> | `@EnableDiscoveryClient` | é€‚ç”¨äºæ‰€æœ‰æ³¨å†Œä¸­å¿ƒ | â­â­â­â­ æ›´é€šç”¨ |
> 
> **æ–°æ‰‹å»ºè®®**ï¼šå¦‚æœç¡®å®šç”¨Eurekaï¼Œä¸¤ä¸ªéƒ½å¯ä»¥ï¼›æƒ³æ¢æ³¨å†Œä¸­å¿ƒï¼Œç”¨ `@EnableDiscoveryClient`

**æ­¥éª¤ 3ï¸âƒ£ï¼šé…ç½®æ–‡ä»¶**

åœ¨ `application.yml` ä¸­é…ç½®æœåŠ¡ä¿¡æ¯ï¼š

```yaml
spring:
  application:
    name: order-service  # ğŸ‘ˆ æœåŠ¡åç§°ï¼Œéå¸¸é‡è¦ï¼å…¶ä»–æœåŠ¡é€šè¿‡è¿™ä¸ªåå­—æ‰¾ä½ 

server:
  port: 8081  # æœåŠ¡ç«¯å£

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # Eureka Serveråœ°å€
  instance:
    prefer-ip-address: true  # æ³¨å†Œæ—¶ä½¿ç”¨IPè€Œä¸æ˜¯ä¸»æœºå
```

### 2.2 æ³¨å†Œè¿‡ç¨‹è¯¦è§£


**ğŸ”„ æœåŠ¡å¯åŠ¨åå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ**

```
åº”ç”¨å¯åŠ¨æµç¨‹ï¼š

1. Spring Bootå¯åŠ¨
   â†“
2. æ‰«æåˆ° @EnableEurekaClient æ³¨è§£
   â†“
3. è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„æœåŠ¡ä¿¡æ¯
   â†“  
4. æ„å»ºæ³¨å†Œä¿¡æ¯ï¼ˆInstanceInfoï¼‰
   â”œâ”€ æœåŠ¡åï¼šorder-service
   â”œâ”€ IPåœ°å€ï¼š192.168.1.100
   â”œâ”€ ç«¯å£ï¼š8081
   â””â”€ å…ƒæ•°æ®ï¼š{version=1.0}
   â†“
5. å‘é€HTTPè¯·æ±‚åˆ°Eureka Server
   POST /eureka/apps/ORDER-SERVICE
   â†“
6. Eureka Serverä¿å­˜æ³¨å†Œä¿¡æ¯
   â†“
7. è¿”å›æ³¨å†ŒæˆåŠŸå“åº”
   â†“
8. å®¢æˆ·ç«¯å¯åŠ¨å¿ƒè·³å®šæ—¶ä»»åŠ¡
   æ¯30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
```

**ğŸ“Š æ³¨å†Œä¿¡æ¯åŒ…å«ä»€ä¹ˆï¼Ÿ**

| ä¿¡æ¯ç±»å‹ | å­—æ®µå | ç¤ºä¾‹å€¼ | ä½œç”¨ |
|---------|--------|--------|------|
| **æœåŠ¡æ ‡è¯†** | `appName` | `ORDER-SERVICE` | æœåŠ¡çš„å”¯ä¸€åç§° |
| **å®ä¾‹æ ‡è¯†** | `instanceId` | `192.168.1.100:order-service:8081` | åŒºåˆ†åŒä¸€æœåŠ¡çš„ä¸åŒå®ä¾‹ |
| **ç½‘ç»œä¿¡æ¯** | `ipAddr` | `192.168.1.100` | æœåŠ¡çš„IPåœ°å€ |
| **ç«¯å£ä¿¡æ¯** | `port` | `8081` | æœåŠ¡çš„HTTPç«¯å£ |
| **çŠ¶æ€ä¿¡æ¯** | `status` | `UP` | æœåŠ¡å¥åº·çŠ¶æ€ |
| **å…ƒæ•°æ®** | `metadata` | `{version: "1.0"}` | è‡ªå®šä¹‰ä¿¡æ¯ |

### 2.3 å¤šå®ä¾‹æ³¨å†Œ


> ğŸ”¥ **å®æˆ˜åœºæ™¯**
> 
> ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒåŒä¸€ä¸ªæœåŠ¡é€šå¸¸ä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œå®ç°é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡

**åŒä¸€å°æœºå™¨éƒ¨ç½²å¤šå®ä¾‹**

```yaml
# å®ä¾‹1é…ç½® (application-8081.yml)
server:
  port: 8081
spring:
  application:
    name: order-service
eureka:
  instance:
    instance-id: ${spring.application.name}:${server.port}  # è‡ªå®šä¹‰å®ä¾‹ID

---
# å®ä¾‹2é…ç½® (application-8082.yml)  
server:
  port: 8082
spring:
  application:
    name: order-service  # æœåŠ¡åç›¸åŒ
eureka:
  instance:
    instance-id: ${spring.application.name}:${server.port}
```

**å¯åŠ¨å‘½ä»¤**

```bash
# å¯åŠ¨å®ä¾‹1
java -jar order-service.jar --spring.profiles.active=8081

# å¯åŠ¨å®ä¾‹2  
java -jar order-service.jar --spring.profiles.active=8082
```

**Eureka Serverä¸Šçš„æ˜¾ç¤ºæ•ˆæœ**

```
ORDER-SERVICE
â”œâ”€ order-service:8081  ğŸŸ¢ UP
â””â”€ order-service:8082  ğŸŸ¢ UP

åŒä¸€ä¸ªæœåŠ¡åï¼Œä¸¤ä¸ªä¸åŒçš„å®ä¾‹ï¼
```

---

## 3. ğŸ‘¤ æœåŠ¡æ¶ˆè´¹è€…å‘ç°


### 3.1 æœåŠ¡å‘ç°çš„ä¸‰ç§æ–¹å¼


> ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**
> 
> æœåŠ¡æ¶ˆè´¹è€…ä¸éœ€è¦çŸ¥é“æœåŠ¡æä¾›è€…çš„å…·ä½“åœ°å€ï¼Œåªéœ€è¦çŸ¥é“**æœåŠ¡å**å°±èƒ½è°ƒç”¨

**æ–¹å¼å¯¹æ¯”**

| æ–¹å¼ | éš¾åº¦ | åŠŸèƒ½ | æ¨èåº¦ |
|------|------|------|--------|
| **DiscoveryClient** | â­ ç®€å• | æ‰‹åŠ¨æŸ¥è¯¢æœåŠ¡åˆ—è¡¨ | â­â­ äº†è§£åŸç†ç”¨ |
| **LoadBalancerClient** | â­â­ ä¸­ç­‰ | è‡ªåŠ¨è´Ÿè½½å‡è¡¡ | â­â­â­ å¸¸ç”¨ |
| **@LoadBalanced RestTemplate** | â­ ç®€å• | è‡ªåŠ¨å‘ç°+è´Ÿè½½å‡è¡¡ | â­â­â­â­â­ æœ€æ¨è |

### 3.2 æ–¹å¼ä¸€ï¼šDiscoveryClientåŸç”ŸAPI


**ğŸ“ åŸºç¡€ç”¨æ³•**

```java
@RestController
@RequestMapping("/consumer")
public class ConsumerController {
    
    @Autowired
    private DiscoveryClient discoveryClient;  // æ³¨å…¥æœåŠ¡å‘ç°å®¢æˆ·ç«¯
    
    @Autowired
    private RestTemplate restTemplate;
    
    @GetMapping("/order/{id}")
    public String getOrder(@PathVariable Long id) {
        // 1. è·å–æœåŠ¡åˆ—è¡¨
        List<ServiceInstance> instances = 
            discoveryClient.getInstances("order-service");  // é€šè¿‡æœåŠ¡åæŸ¥è¯¢
        
        if (instances.isEmpty()) {
            return "è®¢å•æœåŠ¡ä¸å¯ç”¨";
        }
        
        // 2. æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªå®ä¾‹ï¼ˆè¿™é‡Œç®€å•é€‰ç¬¬ä¸€ä¸ªï¼‰
        ServiceInstance instance = instances.get(0);
        
        // 3. æ„å»ºè¯·æ±‚URL
        String url = "http://" + instance.getHost() + ":" 
                   + instance.getPort() + "/order/" + id;
        
        // 4. å‘èµ·HTTPè¯·æ±‚
        return restTemplate.getForObject(url, String.class);
    }
}
```

**ğŸ” ServiceInstanceå¯¹è±¡åŒ…å«ä»€ä¹ˆï¼Ÿ**

```
ServiceInstanceå®ä¾‹ä¿¡æ¯ï¼š
â”œâ”€ serviceId: "order-service"      // æœåŠ¡å
â”œâ”€ host: "192.168.1.100"           // ä¸»æœºåœ°å€
â”œâ”€ port: 8081                       // ç«¯å£å·
â”œâ”€ uri: "http://192.168.1.100:8081" // å®Œæ•´URI
â”œâ”€ metadata: {version: "1.0"}       // å…ƒæ•°æ®
â””â”€ instanceId: "order-service:8081" // å®ä¾‹ID
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**
> 
> è¿™ç§æ–¹å¼éœ€è¦**æ‰‹åŠ¨å®ç°è´Ÿè½½å‡è¡¡**ï¼Œé€‚åˆå­¦ä¹ ç†è§£åŸç†ï¼Œç”Ÿäº§ç¯å¢ƒä¸æ¨è

### 3.3 æ–¹å¼äºŒï¼šLoadBalancerClient


**ğŸ“ æ”¹è¿›ç‰ˆæœ¬**

```java
@RestController
@RequestMapping("/consumer")
public class ConsumerController {
    
    @Autowired
    private LoadBalancerClient loadBalancer;  // è‡ªåŠ¨è´Ÿè½½å‡è¡¡
    
    @Autowired
    private RestTemplate restTemplate;
    
    @GetMapping("/order/{id}")
    public String getOrder(@PathVariable Long id) {
        // 1. é€šè¿‡è´Ÿè½½å‡è¡¡å™¨é€‰æ‹©å®ä¾‹
        ServiceInstance instance = loadBalancer.choose("order-service");
        
        if (instance == null) {
            return "è®¢å•æœåŠ¡ä¸å¯ç”¨";
        }
        
        // 2. æ„å»ºURLå¹¶è°ƒç”¨
        String url = "http://" + instance.getHost() + ":" 
                   + instance.getPort() + "/order/" + id;
        
        return restTemplate.getForObject(url, String.class);
    }
}
```

**ğŸ¯ è´Ÿè½½å‡è¡¡ç­–ç•¥**

```
é»˜è®¤ç­–ç•¥ï¼šè½®è¯¢ (Round Robin)

ç¬¬1æ¬¡è¯·æ±‚ â†’ instance1 (192.168.1.100:8081)
ç¬¬2æ¬¡è¯·æ±‚ â†’ instance2 (192.168.1.101:8081)  
ç¬¬3æ¬¡è¯·æ±‚ â†’ instance3 (192.168.1.102:8081)
ç¬¬4æ¬¡è¯·æ±‚ â†’ instance1 (å¾ªç¯å¾€å¤)
```

### 3.4 æ–¹å¼ä¸‰ï¼š@LoadBalanced RestTemplateï¼ˆæœ€æ¨èï¼‰


**ğŸ“ æœ€ä¼˜é›…çš„æ–¹å¼**

```java
// é…ç½®ç±»
@Configuration
public class RestTemplateConfig {
    
    @Bean
    @LoadBalanced  // ğŸ‘ˆ é­”æ³•å°±åœ¨è¿™ä¸ªæ³¨è§£ï¼
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

// ä½¿ç”¨
@RestController
@RequestMapping("/consumer")
public class ConsumerController {
    
    @Autowired
    private RestTemplate restTemplate;  // æ³¨å…¥å¢å¼ºåçš„RestTemplate
    
    @GetMapping("/order/{id}")
    public String getOrder(@PathVariable Long id) {
        // ç›´æ¥ç”¨æœåŠ¡åè°ƒç”¨ï¼è¶…çº§ç®€å•ï¼
        String url = "http://order-service/order/" + id;
        return restTemplate.getForObject(url, String.class);
    }
}
```

> ğŸ‰ **ä¸ºä»€ä¹ˆè¿™ä¹ˆç¥å¥‡ï¼Ÿ**
> 
> `@LoadBalanced` æ³¨è§£ä¼šç»™RestTemplateåŠ ä¸Š**æ‹¦æˆªå™¨**ï¼š
> 
> ```
> è¯·æ±‚æµç¨‹ï¼š
> 
> ä½ çš„ä»£ç ï¼šhttp://order-service/order/1
>     â†“
> æ‹¦æˆªå™¨æ‹¦æˆªåˆ°è¯·æ±‚
>     â†“
> ä»Eurekaè·å– order-service çš„å®ä¾‹åˆ—è¡¨
>     â†“  
> è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªå®ä¾‹
>     â†“
> æ›¿æ¢URLï¼šhttp://192.168.1.100:8081/order/1
>     â†“
> å‘èµ·çœŸå®çš„HTTPè¯·æ±‚
> ```

**ğŸ†š ä¸‰ç§æ–¹å¼å¯¹æ¯”**

| ç‰¹æ€§ | DiscoveryClient | LoadBalancerClient | @LoadBalanced |
|------|----------------|-------------------|--------------|
| **ä»£ç é‡** | å¤š | ä¸­ç­‰ | å°‘ |
| **è´Ÿè½½å‡è¡¡** | âŒ éœ€æ‰‹åŠ¨å®ç° | âœ… è‡ªåŠ¨ | âœ… è‡ªåŠ¨ |
| **ä½¿ç”¨å¤æ‚åº¦** | é«˜ | ä¸­ | ä½ |
| **é€‚ç”¨åœºæ™¯** | å­¦ä¹ åŸç† | ç‰¹æ®Šéœ€æ±‚ | æ—¥å¸¸å¼€å‘ |

---

## 4. ğŸ·ï¸ å®ä¾‹å…ƒæ•°æ®é…ç½®


### 4.1 ä»€ä¹ˆæ˜¯å…ƒæ•°æ®


> ğŸ’¡ **é€šä¿—ç†è§£**
> 
> å…ƒæ•°æ®å°±åƒå•†å“çš„**é™„åŠ ä¿¡æ¯æ ‡ç­¾**ï¼š
> - æœåŠ¡åã€IPã€ç«¯å£ â†’ å•†å“çš„åŸºæœ¬ä¿¡æ¯
> - å…ƒæ•°æ® â†’ å•†å“çš„ç‰ˆæœ¬å·ã€ç”Ÿäº§æ—¥æœŸã€è§„æ ¼å‹å·ç­‰

**å…ƒæ•°æ®çš„ä¸¤ç§ç±»å‹**

```
ğŸ“‹ æ ‡å‡†å…ƒæ•°æ® (Eurekaè‡ªå¸¦)         ğŸ¨ è‡ªå®šä¹‰å…ƒæ•°æ® (ä½ è‡ªå·±å®šä¹‰)
â”œâ”€ instanceId                     â”œâ”€ version: "1.0.0"
â”œâ”€ hostName                       â”œâ”€ env: "prod"  
â”œâ”€ app                            â”œâ”€ zone: "beijing"
â”œâ”€ ipAddr                         â”œâ”€ weight: "100"
â””â”€ status                         â””â”€ ä»»ä½•ä½ æƒ³åŠ çš„ä¿¡æ¯
```

### 4.2 é…ç½®è‡ªå®šä¹‰å…ƒæ•°æ®


**ğŸ“ é…ç½®ç¤ºä¾‹**

```yaml
eureka:
  instance:
    metadata-map:  # è‡ªå®šä¹‰å…ƒæ•°æ®
      version: 1.0.0              # æœåŠ¡ç‰ˆæœ¬
      company: mycompany          # å…¬å¸å
      team: order-team            # å›¢é˜Ÿ
      zone: beijing-zone-1        # å¯ç”¨åŒº
      weight: 100                 # æƒé‡ï¼ˆå¯ç”¨äºç°åº¦å‘å¸ƒï¼‰
      update-time: 2024-01-01     # æ›´æ–°æ—¶é—´
```

### 4.3 å…ƒæ•°æ®çš„å®æˆ˜åº”ç”¨


**ğŸ¯ åœºæ™¯1ï¼šç‰ˆæœ¬è·¯ç”±ï¼ˆç°åº¦å‘å¸ƒï¼‰**

```java
@Service
public class OrderService {
    
    @Autowired
    private DiscoveryClient discoveryClient;
    
    public ServiceInstance chooseInstanceByVersion(String version) {
        List<ServiceInstance> instances = 
            discoveryClient.getInstances("order-service");
        
        // æ ¹æ®ç‰ˆæœ¬å·è¿‡æ»¤å®ä¾‹
        return instances.stream()
            .filter(instance -> {
                String v = instance.getMetadata().get("version");
                return version.equals(v);
            })
            .findFirst()
            .orElse(null);
    }
}
```

**æµé‡åˆ†é…ç¤ºæ„**

```
ç”¨æˆ·è¯·æ±‚
    â†“
APIç½‘å…³åˆ¤æ–­
    â†“
â”œâ”€ 10%æµé‡ â†’ version=2.0 (æ–°ç‰ˆæœ¬)
â””â”€ 90%æµé‡ â†’ version=1.0 (è€ç‰ˆæœ¬)
```

**ğŸ¯ åœºæ™¯2ï¼šç¯å¢ƒéš”ç¦»**

```yaml
# å¼€å‘ç¯å¢ƒ
eureka:
  instance:
    metadata-map:
      env: dev

# ç”Ÿäº§ç¯å¢ƒ  
eureka:
  instance:
    metadata-map:
      env: prod
```

```java
// åªè°ƒç”¨ç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡
public ServiceInstance chooseProdInstance() {
    return instances.stream()
        .filter(i -> "prod".equals(i.getMetadata().get("env")))
        .findFirst()
        .orElse(null);
}
```

**ğŸ¯ åœºæ™¯3ï¼šé‡‘ä¸é›€å‘å¸ƒ**

| å®ä¾‹ | version | weight | æµé‡å æ¯” |
|------|---------|--------|---------|
| instance-1 | 1.0 | 90 | 90% |
| instance-2 | 2.0 | 10 | 10% |

```
é‡‘ä¸é›€å‘å¸ƒæµç¨‹ï¼š
1. éƒ¨ç½²å°‘é‡æ–°ç‰ˆæœ¬å®ä¾‹ (weight=10)
2. è§‚å¯Ÿæ–°ç‰ˆæœ¬è¡¨ç°
3. é€æ­¥å¢åŠ æ–°ç‰ˆæœ¬æƒé‡
4. æœ€ç»ˆå…¨éƒ¨åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬
```

---

## 5. ğŸ’Š å¥åº·æ£€æŸ¥ä¸ä¼˜é›…åœæœº


### 5.1 å¥åº·æ£€æŸ¥æœºåˆ¶


> ğŸ’¡ **ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥ï¼Ÿ**
> 
> æœåŠ¡è™½ç„¶å¯åŠ¨äº†ï¼Œä½†å¯èƒ½ï¼š
> - æ•°æ®åº“è¿æ¥æ–­äº†
> - ä¾èµ–çš„å…¶ä»–æœåŠ¡æŒ‚äº†  
> - å†…å­˜ä¸è¶³äº†
> 
> å¥åº·æ£€æŸ¥å°±æ˜¯å®šæœŸä½“æ£€ï¼Œç¡®ä¿æœåŠ¡çœŸæ­£å¯ç”¨

**ğŸ” Eurekaçš„å¥åº·æ£€æŸ¥æ–¹å¼**

```
é»˜è®¤æ–¹å¼ï¼šå¿ƒè·³æ£€æŸ¥ (ç®€å•ä½†ä¸å¤Ÿå‡†ç¡®)
    â†“
æœåŠ¡æ¯30ç§’å‘é€å¿ƒè·³
    â†“
Eurekaè®¤ä¸ºæœåŠ¡å¥åº·
    â†“
âŒ é—®é¢˜ï¼šæœåŠ¡è¿›ç¨‹åœ¨ï¼Œä½†åŠŸèƒ½ä¸å¯ç”¨


æ”¹è¿›æ–¹å¼ï¼šSpring Boot Actuator (å‡†ç¡®)
    â†“
é›†æˆå¥åº·æ£€æŸ¥ç«¯ç‚¹
    â†“
æ£€æŸ¥æ•°æ®åº“ã€Redisã€ç£ç›˜ç­‰
    â†“
âœ… çœŸæ­£åæ˜ æœåŠ¡å¥åº·çŠ¶æ€
```

### 5.2 é…ç½®Actuatorå¥åº·æ£€æŸ¥


**æ­¥éª¤ 1ï¸âƒ£ï¼šæ·»åŠ ä¾èµ–**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**æ­¥éª¤ 2ï¸âƒ£ï¼šé…ç½®å¥åº·æ£€æŸ¥**

```yaml
# å¯ç”¨å¥åº·æ£€æŸ¥
eureka:
  client:
    healthcheck:
      enabled: true  # å¯ç”¨å¥åº·æ£€æŸ¥

# Actuatoré…ç½®
management:
  endpoints:
    web:
      exposure:
        include: health  # æš´éœ²å¥åº·æ£€æŸ¥ç«¯ç‚¹
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
```

**æ­¥éª¤ 3ï¸âƒ£ï¼šè‡ªå®šä¹‰å¥åº·æŒ‡æ ‡**

```java
@Component
public class CustomHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        // æ£€æŸ¥æ•°æ®åº“è¿æ¥
        boolean dbOk = checkDatabase();
        // æ£€æŸ¥Redisè¿æ¥
        boolean redisOk = checkRedis();
        
        if (dbOk && redisOk) {
            return Health.up()
                .withDetail("database", "è¿æ¥æ­£å¸¸")
                .withDetail("redis", "è¿æ¥æ­£å¸¸")
                .build();
        } else {
            return Health.down()
                .withDetail("database", dbOk ? "æ­£å¸¸" : "å¼‚å¸¸")
                .withDetail("redis", redisOk ? "æ­£å¸¸" : "å¼‚å¸¸")
                .build();
        }
    }
    
    private boolean checkDatabase() {
        // å®é™…çš„æ•°æ®åº“æ£€æŸ¥é€»è¾‘
        return true;
    }
    
    private boolean checkRedis() {
        // å®é™…çš„Redisæ£€æŸ¥é€»è¾‘
        return true;
    }
}
```

**ğŸ“Š å¥åº·çŠ¶æ€çš„ä¼ é€’**

```
æœåŠ¡å¥åº·æ£€æŸ¥æµç¨‹ï¼š

Actuator /healthç«¯ç‚¹
    â†“ (æ¯30ç§’)
æ£€æŸ¥å„é¡¹æŒ‡æ ‡
â”œâ”€ æ•°æ®åº“ âœ…
â”œâ”€ Redis âœ…  
â””â”€ ç£ç›˜ç©ºé—´ âœ…
    â†“
æ±‡æ€»çŠ¶æ€ï¼šUP
    â†“
æ›´æ–°åˆ°Eureka
    â†“
Eurekaæ ‡è®°å®ä¾‹çŠ¶æ€ï¼šğŸŸ¢ UP
```

### 5.3 ä¼˜é›…åœæœºé…ç½®


> âš ï¸ **é—®é¢˜åœºæ™¯**
> 
> ç›´æ¥ `kill` æœåŠ¡è¿›ç¨‹ä¼šå¯¼è‡´ï¼š
> - æ­£åœ¨å¤„ç†çš„è¯·æ±‚è¢«ä¸­æ–­
> - Eurekaä¸Šçš„æœåŠ¡çŠ¶æ€å»¶è¿Ÿæ›´æ–°ï¼ˆ90ç§’åæ‰å‰”é™¤ï¼‰
> - æ¶ˆè´¹è€…ä»ç„¶å¯èƒ½è°ƒç”¨å·²åœæ­¢çš„æœåŠ¡

**ğŸ¯ ä¼˜é›…åœæœºçš„ç›®æ ‡**

```
ä¼˜é›…åœæœºæµç¨‹ï¼š

1. æ”¶åˆ°åœæœºä¿¡å·
    â†“
2. ä¸»åŠ¨ä»Eurekaä¸‹çº¿
    â†“
3. ç­‰å¾…æ­£åœ¨å¤„ç†çš„è¯·æ±‚å®Œæˆ
    â†“
4. å…³é—­æ•°æ®åº“è¿æ¥ã€çº¿ç¨‹æ± ç­‰èµ„æº
    â†“
5. æœ€ç»ˆé€€å‡ºè¿›ç¨‹

âœ… ç¡®ä¿è¯·æ±‚ä¸ä¸¢å¤±ï¼Œèµ„æºæ­£ç¡®é‡Šæ”¾
```

**ğŸ“ é…ç½®ä¼˜é›…åœæœº**

```yaml
# Spring Boot 2.3+ å†…ç½®æ”¯æŒ
server:
  shutdown: graceful  # å¯ç”¨ä¼˜é›…åœæœº

spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s  # ç­‰å¾…æ—¶é—´30ç§’
```

**æ‰‹åŠ¨æ§åˆ¶ä¸‹çº¿**

```java
@RestController
public class ShutdownController {
    
    @Autowired
    private EurekaServiceRegistry serviceRegistry;
    
    @Autowired
    private EurekaRegistration registration;
    
    @PostMapping("/shutdown")
    public String shutdown() {
        // 1. ä¸»åŠ¨ä»Eurekaä¸‹çº¿
        serviceRegistry.setStatus(registration, "DOWN");
        
        // 2. ç­‰å¾…ä¸€æ®µæ—¶é—´è®©æ¶ˆè´¹è€…æ„ŸçŸ¥
        Thread.sleep(10000);
        
        // 3. åœæ­¢åº”ç”¨
        System.exit(0);
        
        return "æœåŠ¡æ­£åœ¨ä¼˜é›…åœæœº...";
    }
}
```

**ğŸ”§ å®Œæ•´çš„åœæœºè„šæœ¬**

```bash
#!/bin/bash
# graceful-shutdown.sh

echo "å¼€å§‹ä¼˜é›…åœæœº..."

# 1. è°ƒç”¨ä¸‹çº¿æ¥å£
curl -X POST http://localhost:8081/shutdown

# 2. ç­‰å¾…è¯·æ±‚å¤„ç†å®Œæˆ
sleep 10

# 3. åœæ­¢è¿›ç¨‹
kill -15 $(cat app.pid)

echo "æœåŠ¡å·²ä¼˜é›…åœæœº"
```

---

## 6. âš™ï¸ é…ç½®å‚æ•°è¯¦è§£


### 6.1 æ ¸å¿ƒé…ç½®å‚æ•°åˆ†ç±»


**ğŸ“‹ é…ç½®å‚æ•°å…¨æ™¯å›¾**

```
Eureka Clienté…ç½®
â”œâ”€ ğŸŒ æ³¨å†Œç›¸å…³ (eureka.instance.*)
â”‚   â”œâ”€ å®ä¾‹æ ‡è¯†é…ç½®
â”‚   â”œâ”€ ç½‘ç»œé…ç½®
â”‚   â””â”€ å¿ƒè·³é…ç½®
â”‚
â”œâ”€ ğŸ” å‘ç°ç›¸å…³ (eureka.client.*)
â”‚   â”œâ”€ æœåŠ¡æ‹‰å–é…ç½®
â”‚   â”œâ”€ æ³¨å†Œå¼€å…³
â”‚   â””â”€ Eureka Serveråœ°å€
â”‚
â””â”€ ğŸ’Š å¥åº·æ£€æŸ¥ (eureka.client.healthcheck.*)
    â””â”€ å¥åº·æ£€æŸ¥å¼€å…³
```

### 6.2 å®ä¾‹é…ç½®è¯¦è§£


**ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹**

```yaml
eureka:
  instance:
    # ===== å®ä¾‹æ ‡è¯†é…ç½® =====
    instance-id: ${spring.application.name}:${server.port}  # å®ä¾‹ID
    appname: ${spring.application.name}                     # åº”ç”¨å
    
    # ===== ç½‘ç»œé…ç½® =====
    prefer-ip-address: true        # ä¼˜å…ˆä½¿ç”¨IPæ³¨å†Œ
    ip-address: 192.168.1.100      # æ‰‹åŠ¨æŒ‡å®šIP
    non-secure-port: 8081          # HTTPç«¯å£
    secure-port: 8443              # HTTPSç«¯å£  
    non-secure-port-enabled: true  # å¯ç”¨HTTP
    secure-port-enabled: false     # ç¦ç”¨HTTPS
    
    # ===== å¿ƒè·³é…ç½® =====
    lease-renewal-interval-in-seconds: 30     # å¿ƒè·³é—´éš”(é»˜è®¤30ç§’)
    lease-expiration-duration-in-seconds: 90  # è¿‡æœŸæ—¶é—´(é»˜è®¤90ç§’)
    
    # ===== å…ƒæ•°æ®é…ç½® =====
    metadata-map:
      version: 1.0.0
      zone: beijing
```

**ğŸ” é‡è¦å‚æ•°è¯´æ˜**

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ | æ¨èè®¾ç½® |
|------|--------|------|---------|
| **prefer-ip-address** | `false` | ä½¿ç”¨IPè¿˜æ˜¯ä¸»æœºå | `true` (ç”Ÿäº§ç¯å¢ƒ) |
| **lease-renewal-interval** | `30ç§’` | å¿ƒè·³å‘é€é—´éš” | `30ç§’` (é»˜è®¤å³å¯) |
| **lease-expiration-duration** | `90ç§’` | å¤šä¹…æœªå¿ƒè·³å°±å‰”é™¤ | `90ç§’` (é»˜è®¤å³å¯) |
| **instance-id** | `è‡ªåŠ¨ç”Ÿæˆ` | å®ä¾‹å”¯ä¸€æ ‡è¯† | `è‡ªå®šä¹‰` (ä¾¿äºè¯†åˆ«) |

> ğŸ’¡ **ä¸ºä»€ä¹ˆprefer-ip-addressè¦è®¾ç½®trueï¼Ÿ**
> 
> - **falseï¼ˆé»˜è®¤ï¼‰**ï¼šä½¿ç”¨ä¸»æœºåï¼Œå¦‚ `DESKTOP-ABC123`
>   - âŒ åœ¨å®¹å™¨ç¯å¢ƒå¯èƒ½æ— æ³•è§£æ
>   - âŒ è·¨ç½‘æ®µè°ƒç”¨å¯èƒ½å¤±è´¥
> 
> - **true**ï¼šä½¿ç”¨IPåœ°å€ï¼Œå¦‚ `192.168.1.100`
>   - âœ… ç›´æ¥å¯è®¿é—®
>   - âœ… å®¹å™¨ç¯å¢ƒå…¼å®¹æ€§å¥½

### 6.3 å®¢æˆ·ç«¯é…ç½®è¯¦è§£


```yaml
eureka:
  client:
    # ===== æ³¨å†Œå¼€å…³ =====
    register-with-eureka: true       # æ˜¯å¦æ³¨å†Œåˆ°Eureka
    fetch-registry: true             # æ˜¯å¦æ‹‰å–æœåŠ¡åˆ—è¡¨
    
    # ===== Eureka Serveråœ°å€ =====
    service-url:
      defaultZone: http://localhost:8761/eureka/  # å•èŠ‚ç‚¹
      # defaultZone: http://eureka1:8761/eureka/,http://eureka2:8762/eureka/  # é›†ç¾¤
    
    # ===== æœåŠ¡æ‹‰å–é…ç½® =====
    registry-fetch-interval-seconds: 30  # æ‹‰å–æœåŠ¡åˆ—è¡¨é—´éš”
    
    # ===== å¥åº·æ£€æŸ¥ =====
    healthcheck:
      enabled: true  # å¯ç”¨å¥åº·æ£€æŸ¥
    
    # ===== å…¶ä»–é…ç½® =====
    eureka-server-connect-timeout-seconds: 5   # è¿æ¥è¶…æ—¶
    eureka-server-read-timeout-seconds: 8      # è¯»å–è¶…æ—¶
```

**ğŸ¯ ä¸åŒè§’è‰²çš„é…ç½®å·®å¼‚**

| è§’è‰² | register-with-eureka | fetch-registry | è¯´æ˜ |
|------|---------------------|----------------|------|
| **çº¯æœåŠ¡æä¾›è€…** | `true` | `false` | åªæ³¨å†Œï¼Œä¸æ‹‰å– |
| **çº¯æœåŠ¡æ¶ˆè´¹è€…** | `false` | `true` | åªæ‹‰å–ï¼Œä¸æ³¨å†Œ |
| **æ—¢æ˜¯æä¾›è€…åˆæ˜¯æ¶ˆè´¹è€…** | `true` | `true` | éƒ½éœ€è¦ |
| **Eureka Server** | `false` | `false` | éƒ½ä¸éœ€è¦ |

### 6.4 å¸¸è§åœºæ™¯é…ç½®æ¨¡æ¿


**ğŸ¨ åœºæ™¯1ï¼šå¼€å‘ç¯å¢ƒé…ç½®ï¼ˆå¿«é€Ÿå“åº”ï¼‰**

```yaml
eureka:
  instance:
    lease-renewal-interval-in-seconds: 5   # 5ç§’å¿ƒè·³(å¿«é€Ÿå‘ç°æ•…éšœ)
    lease-expiration-duration-in-seconds: 10  # 10ç§’è¿‡æœŸ
  client:
    registry-fetch-interval-seconds: 5     # 5ç§’æ‹‰å–ä¸€æ¬¡
```

**ğŸ¨ åœºæ™¯2ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆç¨³å®šä¼˜å…ˆï¼‰**

```yaml
eureka:
  instance:
    lease-renewal-interval-in-seconds: 30  # 30ç§’å¿ƒè·³(å‡å°‘ç½‘ç»œå¼€é”€)
    lease-expiration-duration-in-seconds: 90  # 90ç§’è¿‡æœŸ(é˜²æ­¢è¯¯åˆ¤)
  client:
    registry-fetch-interval-seconds: 30    # 30ç§’æ‹‰å–ä¸€æ¬¡
```

**ğŸ¨ åœºæ™¯3ï¼šé«˜å¯ç”¨é›†ç¾¤é…ç½®**

```yaml
eureka:
  client:
    service-url:
      defaultZone: http://eureka1:8761/eureka/,http://eureka2:8762/eureka/,http://eureka3:8763/eureka/
  instance:
    prefer-ip-address: true
    metadata-map:
      zone: zone1  # æ ‡è®°å¯ç”¨åŒº
```

---

## 7. ğŸŒ REST APIä½¿ç”¨


### 7.1 Eureka REST APIæ¦‚è§ˆ


> ğŸ’¡ **ä»€ä¹ˆæ˜¯REST APIï¼Ÿ**
> 
> é™¤äº†Javaå®¢æˆ·ç«¯ï¼ŒEurekaè¿˜æä¾›HTTPæ¥å£ï¼Œè®©å…¶ä»–è¯­è¨€ä¹Ÿèƒ½ä½¿ç”¨

**ğŸ“‹ æ ¸å¿ƒAPIåˆ—è¡¨**

| æ“ä½œ | HTTPæ–¹æ³• | APIè·¯å¾„ | è¯´æ˜ |
|------|---------|---------|------|
| **æ³¨å†ŒæœåŠ¡** | `POST` | `/eureka/apps/{appID}` | æ³¨å†Œæ–°å®ä¾‹ |
| **æ³¨é”€æœåŠ¡** | `DELETE` | `/eureka/apps/{appID}/{instanceID}` | åˆ é™¤å®ä¾‹ |
| **å‘é€å¿ƒè·³** | `PUT` | `/eureka/apps/{appID}/{instanceID}` | ç»­çº¦ |
| **æŸ¥è¯¢æ‰€æœ‰æœåŠ¡** | `GET` | `/eureka/apps` | è·å–æœåŠ¡åˆ—è¡¨ |
| **æŸ¥è¯¢æŒ‡å®šæœåŠ¡** | `GET` | `/eureka/apps/{appID}` | è·å–æŒ‡å®šæœåŠ¡ä¿¡æ¯ |
| **æŸ¥è¯¢å®ä¾‹ä¿¡æ¯** | `GET` | `/eureka/apps/{appID}/{instanceID}` | è·å–å®ä¾‹è¯¦æƒ… |
| **æ›´æ–°çŠ¶æ€** | `PUT` | `/eureka/apps/{appID}/{instanceID}/status?value=UP` | ä¿®æ”¹å®ä¾‹çŠ¶æ€ |

### 7.2 æ³¨å†ŒæœåŠ¡API


**ğŸ“ æ‰‹åŠ¨æ³¨å†Œç¤ºä¾‹**

```bash
curl -X POST \
  http://localhost:8761/eureka/apps/ORDER-SERVICE \
  -H 'Content-Type: application/json' \
  -d '{
    "instance": {
        "instanceId": "192.168.1.100:order-service:8081",
        "hostName": "192.168.1.100",
        "app": "ORDER-SERVICE",
        "ipAddr": "192.168.1.100",
        "status": "UP",
        "port": {
            "$": 8081,
            "@enabled": "true"
        },
        "dataCenterInfo": {
            "@class": "com.netflix.appinfo.InstanceInfo$DefaultDataCenterInfo",
            "name": "MyOwn"
        },
        "metadata": {
            "version": "1.0.0"
        }
    }
}'
```

**å“åº”ç»“æœ**

```xml
HTTP/1.1 204 No Content
```

> ğŸ”¥ **å®æˆ˜ç”¨é€”**
> 
> - éJavaæœåŠ¡ï¼ˆå¦‚Node.jsã€Pythonï¼‰æ‰‹åŠ¨æ³¨å†Œ
> - æµ‹è¯•å·¥å…·æ¨¡æ‹ŸæœåŠ¡æ³¨å†Œ
> - ç›‘æ§è„šæœ¬æ‰¹é‡ç®¡ç†æœåŠ¡

### 7.3 æŸ¥è¯¢æœåŠ¡API


**ğŸ“ æŸ¥è¯¢æ‰€æœ‰æœåŠ¡**

```bash
curl http://localhost:8761/eureka/apps
```

**å“åº”ç¤ºä¾‹ï¼ˆç®€åŒ–ï¼‰**

```json
{
  "applications": {
    "application": [
      {
        "name": "ORDER-SERVICE",
        "instance": [
          {
            "instanceId": "order-service:8081",
            "hostName": "192.168.1.100",
            "app": "ORDER-SERVICE",
            "ipAddr": "192.168.1.100",
            "status": "UP",
            "port": 8081
          }
        ]
      }
    ]
  }
}
```

**ğŸ“ æŸ¥è¯¢æŒ‡å®šæœåŠ¡**

```bash
curl http://localhost:8761/eureka/apps/ORDER-SERVICE
```

### 7.4 å¿ƒè·³ç»­çº¦API


**ğŸ“ å‘é€å¿ƒè·³**

```bash
curl -X PUT \
  http://localhost:8761/eureka/apps/ORDER-SERVICE/order-service:8081
```

**å¿ƒè·³æœºåˆ¶**

```
å¿ƒè·³å‘¨æœŸï¼š

T0: æ³¨å†ŒæˆåŠŸ
    â†“
T30: å‘é€ç¬¬1æ¬¡å¿ƒè·³ âœ…
    â†“  
T60: å‘é€ç¬¬2æ¬¡å¿ƒè·³ âœ…
    â†“
T90: å‘é€ç¬¬3æ¬¡å¿ƒè·³ âœ…
    â†“
T120: å¦‚æœæ²¡å‘é€å¿ƒè·³ âŒ
    â†“
T150: å®ä¾‹è¢«Eurekaå‰”é™¤ ğŸ—‘ï¸
```

### 7.5 çŠ¶æ€ç®¡ç†API


**ğŸ“ æ›´æ–°å®ä¾‹çŠ¶æ€**

```bash
# è®¾ç½®ä¸ºUP
curl -X PUT \
  "http://localhost:8761/eureka/apps/ORDER-SERVICE/order-service:8081/status?value=UP"

# è®¾ç½®ä¸ºDOWNï¼ˆä¸ä¼šè¢«è°ƒç”¨ï¼‰
curl -X PUT \
  "http://localhost:8761/eureka/apps/ORDER-SERVICE/order-service:8081/status?value=DOWN"

# è®¾ç½®ä¸ºOUT_OF_SERVICEï¼ˆä¸´æ—¶ä¸‹çº¿ï¼‰
curl -X PUT \
  "http://localhost:8761/eureka/apps/ORDER-SERVICE/order-service:8081/status?value=OUT_OF_SERVICE"
```

**çŠ¶æ€è¯´æ˜**

| çŠ¶æ€ | è¯´æ˜ | æ˜¯å¦å¯è°ƒç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|-----------|---------|
| **UP** | æ­£å¸¸è¿è¡Œ | âœ… æ˜¯ | æ­£å¸¸æœåŠ¡ |
| **DOWN** | å·²åœæ­¢ | âŒ å¦ | æœåŠ¡æŒ‚äº† |
| **OUT_OF_SERVICE** | æš‚åœæœåŠ¡ | âŒ å¦ | ç»´æŠ¤å‡çº§ |
| **STARTING** | å¯åŠ¨ä¸­ | âŒ å¦ | æ­£åœ¨å¯åŠ¨ |

**ğŸ”§ å®æˆ˜ï¼šæœåŠ¡ç»´æŠ¤æµç¨‹**

```bash
# 1. è®¾ç½®ä¸ºOUT_OF_SERVICE
curl -X PUT "http://localhost:8761/eureka/apps/ORDER-SERVICE/order-service:8081/status?value=OUT_OF_SERVICE"

# 2. æ‰§è¡Œç»´æŠ¤æ“ä½œï¼ˆé‡å¯ã€å‡çº§ç­‰ï¼‰
./maintenance.sh

# 3. æ¢å¤æœåŠ¡
curl -X PUT "http://localhost:8761/eureka/apps/ORDER-SERVICE/order-service:8081/status?value=UP"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Eureka Client = æœåŠ¡æä¾›è€… + æœåŠ¡æ¶ˆè´¹è€…
ğŸ”¸ æœåŠ¡æ³¨å†Œï¼šå¯åŠ¨æ—¶æ³¨å†Œï¼Œå®šæ—¶å¿ƒè·³ï¼Œä¼˜é›…ä¸‹çº¿
ğŸ”¸ æœåŠ¡å‘ç°ï¼šæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œæœ¬åœ°ç¼“å­˜ï¼Œè´Ÿè½½å‡è¡¡
ğŸ”¸ å…ƒæ•°æ®ï¼šæºå¸¦é¢å¤–ä¿¡æ¯ï¼Œå®ç°é«˜çº§åŠŸèƒ½
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šç¡®ä¿æœåŠ¡çœŸæ­£å¯ç”¨
```

### 8.2 ä¸‰ç§æœåŠ¡å‘ç°æ–¹å¼å¯¹æ¯”


| æ–¹å¼ | ä»£ç å¤æ‚åº¦ | æ¨èæŒ‡æ•° | é€‚ç”¨åœºæ™¯ |
|------|-----------|---------|---------|
| **DiscoveryClient** | é«˜ | â­â­ | å­¦ä¹ åŸç† |
| **LoadBalancerClient** | ä¸­ | â­â­â­ | ç‰¹æ®Šéœ€æ±‚ |
| **@LoadBalanced RestTemplate** | ä½ | â­â­â­â­â­ | æ—¥å¸¸å¼€å‘ |

### 8.3 å…³é”®é…ç½®é€ŸæŸ¥è¡¨


```yaml
# ğŸ”¥ æœ€å¸¸ç”¨çš„é…ç½®
eureka:
  instance:
    prefer-ip-address: true                   # ä½¿ç”¨IPæ³¨å†Œ
    instance-id: ${spring.application.name}:${server.port}  # è‡ªå®šä¹‰å®ä¾‹ID
    lease-renewal-interval-in-seconds: 30     # å¿ƒè·³é—´éš”
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # Eurekaåœ°å€
    healthcheck:
      enabled: true  # å¯ç”¨å¥åº·æ£€æŸ¥
```

### 8.4 å®æˆ˜æœ€ä½³å®è·µ


> âœ… **ç”Ÿäº§ç¯å¢ƒå»ºè®®**

**æœåŠ¡æä¾›è€…**
```
1. å¯ç”¨å¥åº·æ£€æŸ¥ï¼ˆActuatorï¼‰
2. é…ç½®ä¼˜é›…åœæœºï¼ˆgraceful shutdownï¼‰
3. ä½¿ç”¨IPåœ°å€æ³¨å†Œï¼ˆprefer-ip-address: trueï¼‰
4. è‡ªå®šä¹‰å®ä¾‹IDï¼ˆä¾¿äºè¯†åˆ«ï¼‰
5. åˆç†è®¾ç½®å…ƒæ•°æ®ï¼ˆç‰ˆæœ¬å·ã€ç¯å¢ƒç­‰ï¼‰
```

**æœåŠ¡æ¶ˆè´¹è€…**  
```
1. ä½¿ç”¨@LoadBalanced RestTemplateï¼ˆç®€å•é«˜æ•ˆï¼‰
2. é…ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
3. å®ç°ç†”æ–­é™çº§ï¼ˆHystrix/Sentinelï¼‰
4. æœ¬åœ°ç¼“å­˜æœåŠ¡åˆ—è¡¨
```

**æ€§èƒ½ä¼˜åŒ–**
```
1. å¿ƒè·³é—´éš”ä¸è¦å¤ªçŸ­ï¼ˆ30ç§’åˆé€‚ï¼‰
2. æ‹‰å–æœåŠ¡åˆ—è¡¨é—´éš”ä¸è¦å¤ªé¢‘ç¹ï¼ˆ30ç§’åˆé€‚ï¼‰
3. å¯ç”¨æœ¬åœ°ç¼“å­˜
4. åˆç†è®¾ç½®è¿æ¥æ± å¤§å°
```

### 8.5 å¸¸è§é—®é¢˜é€ŸæŸ¥


**ğŸ› é—®é¢˜1ï¼šæœåŠ¡æ³¨å†ŒæˆåŠŸä½†æ— æ³•è°ƒç”¨**

```
æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥prefer-ip-addressé…ç½® âœ…
2. ç¡®è®¤é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£ âœ…
3. æŸ¥çœ‹Eurekaæ§åˆ¶å°çš„å®ä¾‹IPæ˜¯å¦æ­£ç¡® âœ…
4. æµ‹è¯•ç›´æ¥è®¿é—®æœåŠ¡IP:ç«¯å£ âœ…
```

**ğŸ› é—®é¢˜2ï¼šæœåŠ¡ä¸‹çº¿åä»è¢«è°ƒç”¨**

```
åŸå› ï¼šæ¶ˆè´¹è€…æœ¬åœ°ç¼“å­˜æœªæ›´æ–°
è§£å†³ï¼š
1. ç¼©çŸ­æ‹‰å–é—´éš”ï¼ˆregistry-fetch-interval-secondsï¼‰
2. å¯ç”¨å¥åº·æ£€æŸ¥
3. å®ç°ç†”æ–­é™çº§
```

**ğŸ› é—®é¢˜3ï¼šå¿ƒè·³æ­£å¸¸ä½†å¥åº·æ£€æŸ¥å¤±è´¥**

```
åŸå› ï¼šActuatorå¥åº·æ£€æŸ¥é…ç½®é—®é¢˜
è§£å†³ï¼š
1. æ£€æŸ¥ä¾èµ–é¡¹ï¼ˆæ•°æ®åº“ã€Redisç­‰ï¼‰
2. æŸ¥çœ‹/actuator/healthç«¯ç‚¹è¯¦æƒ…
3. è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é€»è¾‘
```

### 8.6 è®°å¿†å£è¯€


> ğŸ§  **Eureka Clientå£è¯€**
> 
> *æ³¨å†Œå¯åŠ¨åŠ æ³¨è§£ï¼Œé…ç½®æ–‡ä»¶å†™ä¸‰å®ï¼›*  
> *æœåŠ¡åç§°ç«¯å£å·ï¼ŒEurekaåœ°å€ä¸èƒ½å°‘ï¼›*  
> *å¿ƒè·³ç»­çº¦ä¸‰åç§’ï¼Œå¥åº·æ£€æŸ¥å¾ˆé‡è¦ï¼›*  
> *è´Ÿè½½å‡è¡¡åŠ æ³¨è§£ï¼ŒæœåŠ¡è°ƒç”¨çœŸè½»å·§ï¼*

---

**ğŸ“ å­¦ä¹ å»ºè®®**

- **æ–°æ‰‹å…¥é—¨**ï¼šå…ˆæŒæ¡åŸºç¡€æ³¨å†Œå’Œå‘ç°ï¼Œä½¿ç”¨ `@LoadBalanced`
- **è¿›é˜¶å­¦ä¹ **ï¼šç†è§£å…ƒæ•°æ®ã€å¥åº·æ£€æŸ¥ã€REST API
- **ç”Ÿäº§å®è·µ**ï¼šå…³æ³¨é«˜å¯ç”¨ã€æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦

**ğŸ“š æ‰©å±•é˜…è¯»**
- Eurekaå®˜æ–¹æ–‡æ¡£
- Spring Cloud Netflixæ–‡æ¡£  
- å¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼

---

> ğŸ’¡ **ä¸‹ä¸€æ­¥å­¦ä¹ **
> 
> - 2.4 Eurekaé«˜å¯ç”¨é›†ç¾¤æ­å»º
> - 2.5 Eurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶
> - 2.6 Eurekaä¸å…¶ä»–æ³¨å†Œä¸­å¿ƒå¯¹æ¯”