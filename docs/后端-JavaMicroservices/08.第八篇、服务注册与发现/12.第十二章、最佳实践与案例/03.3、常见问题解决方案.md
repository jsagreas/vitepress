---
title: 3ã€å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ
---
## ğŸ“š ç›®å½•


1. [æœåŠ¡æ³¨å†Œå¤±è´¥é—®é¢˜](#1-æœåŠ¡æ³¨å†Œå¤±è´¥é—®é¢˜)
2. [æœåŠ¡å‘ç°å»¶è¿Ÿé—®é¢˜](#2-æœåŠ¡å‘ç°å»¶è¿Ÿé—®é¢˜)
3. [ç½‘ç»œåˆ†åŒºå¤„ç†](#3-ç½‘ç»œåˆ†åŒºå¤„ç†)
4. [æ•°æ®ä¸ä¸€è‡´é—®é¢˜](#4-æ•°æ®ä¸ä¸€è‡´é—®é¢˜)
5. [æ€§èƒ½ç“¶é¢ˆåˆ†æ](#5-æ€§èƒ½ç“¶é¢ˆåˆ†æ)
6. [å†…å­˜æ³„éœ²æ’æŸ¥](#6-å†…å­˜æ³„éœ²æ’æŸ¥)
7. [é…ç½®é”™è¯¯è¯Šæ–­](#7-é…ç½®é”™è¯¯è¯Šæ–­)
8. [ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜](#8-ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš« æœåŠ¡æ³¨å†Œå¤±è´¥é—®é¢˜



### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œå¤±è´¥



**é€šä¿—ç†è§£**ï¼šå°±åƒä½ å¼€äº†ä¸€å®¶æ–°åº—ï¼Œæƒ³æŠŠåº—é“ºä¿¡æ¯ç™»è®°åˆ°å•†ä¸šè¡—çš„æ€»ç›®å½•ä¸Šï¼Œä½†æ˜¯ç™»è®°å¤±è´¥äº†ï¼Œå…¶ä»–äººå°±æ‰¾ä¸åˆ°ä½ çš„åº—ã€‚

åœ¨å¾®æœåŠ¡ä¸­ï¼ŒæœåŠ¡æ³¨å†Œå¤±è´¥æ„å‘³ç€ï¼š
- ä½ çš„æœåŠ¡å¯åŠ¨äº†
- ä½†æ˜¯æ²¡æœ‰æˆåŠŸå‘Šè¯‰æ³¨å†Œä¸­å¿ƒ"æˆ‘åœ¨è¿™é‡Œ"
- å…¶ä»–æœåŠ¡å°±æ— æ³•å‘ç°å’Œè°ƒç”¨ä½ 

### 1.2 å¸¸è§å¤±è´¥åŸå› 



#### ğŸ”¸ ç½‘ç»œè¿æ¥é—®é¢˜



**é—®é¢˜è¡¨ç°**ï¼š
```
âŒ é”™è¯¯ä¿¡æ¯ï¼šConnection refused: connect
âŒ å«ä¹‰ï¼šè¿ä¸ä¸Šæ³¨å†Œä¸­å¿ƒæœåŠ¡å™¨
```

**æ’æŸ¥æ­¥éª¤**ï¼š

```
ç¬¬1æ­¥ï¼šæ£€æŸ¥æ³¨å†Œä¸­å¿ƒæ˜¯å¦å¯åŠ¨
â†’ è®¿é—®æ³¨å†Œä¸­å¿ƒç®¡ç†é¡µé¢ï¼ˆå¦‚ http://localhost:8761ï¼‰
â†’ èƒ½è®¿é—® = æ³¨å†Œä¸­å¿ƒæ­£å¸¸ âœ…
â†’ ä¸èƒ½è®¿é—® = æ³¨å†Œä¸­å¿ƒæ²¡å¯åŠ¨ âŒ

ç¬¬2æ­¥ï¼šæ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…  
â†’ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼šping æ³¨å†Œä¸­å¿ƒåœ°å€
â†’ é€š = ç½‘ç»œæ­£å¸¸ âœ…
â†’ ä¸é€š = ç½‘ç»œæœ‰é—®é¢˜ âŒ

ç¬¬3æ­¥ï¼šæ£€æŸ¥é˜²ç«å¢™è®¾ç½®
â†’ æ˜¯å¦æ‹¦æˆªäº†ç«¯å£
â†’ æ˜¯å¦å…è®¸æœåŠ¡é—´é€šä¿¡
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æ³¨å†Œä¸­å¿ƒå…ˆå¯åŠ¨
- æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„åœ°å€æ˜¯å¦æ­£ç¡®
- å…³é—­æˆ–é…ç½®é˜²ç«å¢™å…è®¸é€šä¿¡

#### ğŸ”¸ é…ç½®ä¿¡æ¯é”™è¯¯



**é—®é¢˜è¡¨ç°**ï¼šæœåŠ¡å¯åŠ¨æ­£å¸¸ï¼Œä½†æ³¨å†Œä¸­å¿ƒçœ‹ä¸åˆ°

**å…¸å‹é”™è¯¯é…ç½®**ï¼š

```yaml
# âŒ é”™è¯¯ç¤ºä¾‹ï¼šåœ°å€å†™é”™äº†

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eurka/  # æ³¨æ„ï¼šeurkaæ‹¼å†™é”™äº†

# âœ… æ­£ç¡®é…ç½®ï¼š

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # eurekaæ‹¼å†™æ­£ç¡®
```

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ³¨å†Œä¸­å¿ƒåœ°å€æ˜¯å¦æ­£ç¡®
- [ ] ç«¯å£å·æ˜¯å¦æ­£ç¡®
- [ ] æœåŠ¡åç§°æ˜¯å¦ç¬¦åˆè§„èŒƒï¼ˆä¸èƒ½æœ‰ä¸‹åˆ’çº¿_ï¼‰
- [ ] é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆæ³¨æ„ç¼©è¿›ï¼‰

#### ğŸ”¸ æœåŠ¡è‡ªèº«é—®é¢˜



**é—®é¢˜1ï¼šå¿ƒè·³è¶…æ—¶**
```
ç°è±¡ï¼šæœåŠ¡æ³¨å†ŒæˆåŠŸï¼Œä½†å¾ˆå¿«è¢«ç§»é™¤

åŸå› ï¼šå°±åƒç™»è®°äº†åº—é“ºä¿¡æ¯ï¼Œä½†é•¿æ—¶é—´ä¸è¥ä¸š
     â†’ æ³¨å†Œä¸­å¿ƒå®šæœŸæ£€æŸ¥"ä½ è¿˜æ´»ç€å—"
     â†’ å¦‚æœæ²¡åŠæ—¶å›åº”ï¼Œå°±è®¤ä¸ºä½ å…³é—¨äº†

è§£å†³ï¼šè°ƒæ•´å¿ƒè·³é—´éš”é…ç½®
```

é…ç½®ç¤ºä¾‹ï¼š

```yaml
eureka:
  instance:
    lease-renewal-interval-in-seconds: 30  # æ¯30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
    lease-expiration-duration-in-seconds: 90  # 90ç§’æ”¶ä¸åˆ°å¿ƒè·³æ‰è¸¢å‡º
```

**é—®é¢˜2ï¼šæœåŠ¡åç§°å†²çª**
```
ç°è±¡ï¼šæ³¨å†Œå¤±è´¥æˆ–è¦†ç›–å…¶ä»–æœåŠ¡

åŸå› ï¼šä¸¤ä¸ªä¸åŒçš„æœåŠ¡ç”¨äº†ç›¸åŒçš„åå­—
     â†’ å°±åƒä¸¤å®¶åº—ç”¨åŒä¸€ä¸ªåå­—ç™»è®°
     â†’ ä¼šé€ æˆæ··æ·†

è§£å†³ï¼šç¡®ä¿æ¯ä¸ªæœåŠ¡åç§°å”¯ä¸€
```

### 1.3 å¿«é€Ÿè¯Šæ–­æµç¨‹



```
æœåŠ¡æ³¨å†Œå¤±è´¥äº†ï¼Ÿ
    â†“
æ£€æŸ¥æ³¨å†Œä¸­å¿ƒæ˜¯å¦å¯åŠ¨ï¼Ÿ
    â”œâ”€ å¦ â†’ å…ˆå¯åŠ¨æ³¨å†Œä¸­å¿ƒ
    â””â”€ æ˜¯ â†“
         â†“
    ç½‘ç»œæ˜¯å¦é€šç•…ï¼Ÿ
         â”œâ”€ å¦ â†’ æ£€æŸ¥ç½‘ç»œ/é˜²ç«å¢™
         â””â”€ æ˜¯ â†“
              â†“
         é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
              â”œâ”€ å¦ â†’ ä¿®æ”¹é…ç½®æ–‡ä»¶
              â””â”€ æ˜¯ â†“
                   â†“
              æŸ¥çœ‹è¯¦ç»†æ—¥å¿—æ‰¾åŸå› 
```

ğŸ’¡ **å°è´´å£«**ï¼š90%çš„æ³¨å†Œå¤±è´¥éƒ½æ˜¯é…ç½®é—®é¢˜ï¼Œä»”ç»†æ£€æŸ¥é…ç½®æ–‡ä»¶çš„åœ°å€ã€ç«¯å£ã€æœåŠ¡åï¼

---

## 2. â±ï¸ æœåŠ¡å‘ç°å»¶è¿Ÿé—®é¢˜



### 2.1 ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°å»¶è¿Ÿ



**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
åœºæ™¯ï¼šä½ å¼€äº†æ–°åº—ï¼Œå·²ç»ç™»è®°åˆ°å•†ä¸šè¡—ç›®å½•
é—®é¢˜ï¼šä½†æ˜¯åˆ«äººç¿»ç›®å½•æ—¶ï¼Œè¿‡äº†å¾ˆä¹…æ‰èƒ½çœ‹åˆ°ä½ çš„åº—

è¿™å°±æ˜¯æœåŠ¡å‘ç°å»¶è¿Ÿ
```

**æŠ€æœ¯å«ä¹‰**ï¼š
- æœåŠ¡Aå·²ç»æ³¨å†ŒæˆåŠŸ
- ä½†æœåŠ¡Bè¦è°ƒç”¨æœåŠ¡Aæ—¶
- å‘ç°æœåŠ¡Açš„è¿‡ç¨‹éœ€è¦è¾ƒé•¿æ—¶é—´
- æˆ–è€…å¹²è„†å‘ç°ä¸äº†ï¼ˆè¿˜åœ¨ç”¨æ—§ä¿¡æ¯ï¼‰

### 2.2 å»¶è¿Ÿäº§ç”ŸåŸå› 



#### ğŸ”¸ ç¼“å­˜æœºåˆ¶å¯¼è‡´



**Eurekaçš„ä¸‰å±‚ç¼“å­˜æœºåˆ¶**ï¼š

```
æœåŠ¡æ³¨å†Œæµç¨‹ï¼ˆæœ‰å»¶è¿Ÿï¼‰ï¼š

æœåŠ¡Aæ³¨å†Œ 
    â†“
å†™å…¥æ³¨å†Œè¡¨ï¼ˆreadWriteCacheMapï¼‰
    â†“ [30ç§’åŒæ­¥ä¸€æ¬¡]
åŒæ­¥åˆ°åªè¯»ç¼“å­˜ï¼ˆreadOnlyCacheMapï¼‰
    â†“ [å®¢æˆ·ç«¯æ¯30ç§’æ‹‰å–ä¸€æ¬¡]
æœåŠ¡Bè·å–åˆ°æœ€æ–°ä¿¡æ¯

æ€»å»¶è¿Ÿï¼šæœ€é•¿å¯è¾¾ 30ç§’ + 30ç§’ = 60ç§’
```

**é€šä¿—è§£é‡Š**ï¼š
- å°±åƒä½ åœ¨AæŸœå°åŠäº†ä¼šå‘˜å¡
- AæŸœå°æ¯30ç§’æŠŠä¿¡æ¯ä¼ ç»™æ€»éƒ¨
- æ€»éƒ¨æ¯30ç§’æ›´æ–°ç»™BæŸœå°
- æ‰€ä»¥BæŸœå°æœ€é•¿60ç§’åæ‰çŸ¥é“ä½ æ˜¯ä¼šå‘˜

#### ğŸ”¸ åˆ·æ–°é¢‘ç‡è®¾ç½®



**é»˜è®¤æƒ…å†µ**ï¼š

| é…ç½®é¡¹ | é»˜è®¤å€¼ | å«ä¹‰ |
|-------|--------|------|
| æœåŠ¡æ‹‰å–é—´éš” | 30ç§’ | æ¯30ç§’ä»æ³¨å†Œä¸­å¿ƒè·å–ä¸€æ¬¡æœåŠ¡åˆ—è¡¨ |
| ç¼“å­˜åˆ·æ–°é—´éš” | 30ç§’ | æ³¨å†Œä¸­å¿ƒæ¯30ç§’åˆ·æ–°ä¸€æ¬¡ç¼“å­˜ |
| å¿ƒè·³é—´éš” | 30ç§’ | æœåŠ¡æ¯30ç§’æŠ¥å‘Šä¸€æ¬¡"æˆ‘è¿˜æ´»ç€" |

**ç´¯ç§¯æ•ˆæœ**ï¼šæ–°æœåŠ¡ä¸Šçº¿ï¼Œå…¶ä»–æœåŠ¡æœ€é•¿60ç§’åæ‰èƒ½å‘ç°

### 2.3 ä¼˜åŒ–è§£å†³æ–¹æ¡ˆ



#### ğŸ”¸ æ–¹æ¡ˆ1ï¼šè°ƒæ•´åˆ·æ–°é¢‘ç‡ï¼ˆé€‚åˆå¼€å‘æµ‹è¯•ï¼‰



**æœåŠ¡ç«¯é…ç½®**ï¼š

```yaml
eureka:
  server:
#    # å…³é—­åªè¯»ç¼“å­˜ï¼Œç›´æ¥è¯»å†™ç¼“å­˜
    use-read-only-response-cache: false
#    # å“åº”ç¼“å­˜æ›´æ–°é—´éš”æ”¹ä¸º3ç§’
    response-cache-update-interval-ms: 3000
```

**å®¢æˆ·ç«¯é…ç½®**ï¼š

```yaml
eureka:
  client:
#    # æœåŠ¡åˆ—è¡¨æ‹‰å–é—´éš”æ”¹ä¸º5ç§’
    registry-fetch-interval-seconds: 5
  instance:
#    # å¿ƒè·³é—´éš”æ”¹ä¸º5ç§’
    lease-renewal-interval-in-seconds: 5
#    # 15ç§’æ²¡å¿ƒè·³å°±å‰”é™¤
    lease-expiration-duration-in-seconds: 15
```

**æ•ˆæœå¯¹æ¯”**ï¼š

```
ä¼˜åŒ–å‰ï¼šæ–°æœåŠ¡ä¸Šçº¿ï¼Œæœ€é•¿60ç§’è¢«å‘ç°
ä¼˜åŒ–åï¼šæ–°æœåŠ¡ä¸Šçº¿ï¼Œæœ€é•¿8ç§’è¢«å‘ç°

ä½†è¦æ³¨æ„ï¼šé¢‘ç‡å¤ªé«˜ä¼šå¢åŠ ç½‘ç»œå¼€é”€
```

#### ğŸ”¸ æ–¹æ¡ˆ2ï¼šä½¿ç”¨æœåŠ¡ç«¯æ¨é€ï¼ˆç”Ÿäº§æ¨èï¼‰



**Nacosçš„æ¨é€æœºåˆ¶**ï¼š

```
æœåŠ¡æ³¨å†Œ/ä¸‹çº¿æ—¶ä¸»åŠ¨æ¨é€

æœåŠ¡Aä¸‹çº¿
    â†“ [ç«‹å³æ¨é€]
é€šçŸ¥æ‰€æœ‰è®¢é˜…çš„å®¢æˆ·ç«¯
    â†“ [å®æ—¶æ›´æ–°]
æœåŠ¡Bç«‹å³çŸ¥é“Aä¸å¯ç”¨

å»¶è¿Ÿï¼šæ¯«ç§’çº§
```

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
spring:
  cloud:
    nacos:
      discovery:
#        # å¼€å¯æ¨é€æ¨¡å¼
        push:
          enabled: true
```

#### ğŸ”¸ æ–¹æ¡ˆ3ï¼šç»“åˆå¥åº·æ£€æŸ¥



**ä¸»åŠ¨å¥åº·æ£€æŸ¥**ï¼š

```
ä¸ç­‰æ³¨å†Œä¸­å¿ƒé€šçŸ¥ï¼Œè‡ªå·±ä¸»åŠ¨æ£€æŸ¥

è°ƒç”¨æœåŠ¡å‰ï¼š
    â†“
å…ˆå‘ä¸ª"ä½ å¥½å—"çš„è¯·æ±‚
    â†“
èƒ½å“åº” â†’ è°ƒç”¨æœåŠ¡ âœ…
è¶…æ—¶/å¤±è´¥ â†’ åˆ‡æ¢å…¶ä»–å®ä¾‹ âŒ
```

å®ç°æ–¹å¼ï¼š
```java
// ä½¿ç”¨ Ribbon çš„ Ping æœºåˆ¶
ribbon:
  NFLoadBalancerPingClassName: com.netflix.loadbalancer.PingUrl
  NFLoadBalancerPingInterval: 5  // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
```

### 2.4 ä¸åŒåœºæ™¯çš„é€‰æ‹©



| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|-----|---------|------|
| ğŸ§ª **å¼€å‘æµ‹è¯•** | è°ƒæ•´åˆ·æ–°é¢‘ç‡ | ç®€å•ç›´æ¥ï¼Œå‘ç°é—®é¢˜å¿« |
| ğŸ­ **ç”Ÿäº§ç¯å¢ƒ** | ä½¿ç”¨Nacosæ¨é€ | å®æ—¶æ€§å¥½ï¼Œæ€§èƒ½æŸè€—å° |
| ğŸ”„ **æœåŠ¡é¢‘ç¹å˜æ›´** | æ¨é€+å¥åº·æ£€æŸ¥ | åŒé‡ä¿éšœï¼Œæ›´å¯é  |
| ğŸ“Š **æœåŠ¡æ•°é‡å°‘** | æé«˜åˆ·æ–°é¢‘ç‡ | ç½‘ç»œå¼€é”€å¯æ¥å— |

âš ï¸ **æ³¨æ„**ï¼šä¸è¦ç›²ç›®è¿½æ±‚é›¶å»¶è¿Ÿï¼Œè¦å¹³è¡¡å®æ—¶æ€§å’Œç³»ç»Ÿå¼€é”€

---

## 3. ğŸŒ ç½‘ç»œåˆ†åŒºå¤„ç†



### 3.1 ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒº



**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
åœºæ™¯ï¼šä¸€åº§åŸå¸‚è¢«æ²³æµåˆ†æˆå—åŒ—ä¸¤åŒº

å¹³æ—¶ï¼šæœ‰æ¡¥è¿æ¥ï¼Œä¿¡æ¯äº’é€š
æ´ªæ°´ï¼šæ¡¥æ–­äº†ï¼Œä¸¤è¾¹éš”ç¦»

ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰ï¼š
    åŒ—åŒºè¯´ï¼š"æˆ‘æ˜¯å¸‚ä¸­å¿ƒ"
    å—åŒºè¯´ï¼š"æˆ‘æ‰æ˜¯å¸‚ä¸­å¿ƒ"
    
ä¸¤è¾¹éƒ½æ­£å¸¸è¿è¡Œï¼Œä½†ä¿¡æ¯ä¸åŒæ­¥
```

**æŠ€æœ¯å«ä¹‰**ï¼š
- å¾®æœåŠ¡é›†ç¾¤å› ç½‘ç»œæ•…éšœè¢«åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†
- æ¯ä¸ªéƒ¨åˆ†ç‹¬ç«‹è¿è¡Œ
- å½¼æ­¤æ— æ³•é€šä¿¡
- å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´

### 3.2 ç½‘ç»œåˆ†åŒºçš„å½±å“



#### ğŸ”¸ Eurekaçš„å¤„ç†æ–¹å¼ï¼ˆAPæ¨¡å¼ï¼‰



**è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶**ï¼š

```
æ­£å¸¸æƒ…å†µï¼š
æ³¨å†Œä¸­å¿ƒæ¯åˆ†é’Ÿæ”¶åˆ°çš„å¿ƒè·³æ•° > é˜ˆå€¼ï¼ˆ85%ï¼‰
    â†“
ä¸€åˆ‡æ­£å¸¸è¿è¡Œ

ç½‘ç»œåˆ†åŒºï¼š
æŸäº›æœåŠ¡å¿ƒè·³æ”¶ä¸åˆ°äº†
    â†“
å¿ƒè·³æ•° < é˜ˆå€¼
    â†“
è¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼
    â†“
å®å¯ä¿ç•™å¯èƒ½å¤±æ•ˆçš„æœåŠ¡ï¼Œä¹Ÿä¸éšä¾¿å‰”é™¤
```

**é€šä¿—è§£é‡Š**ï¼š
```
å°±åƒç–«æƒ…æœŸé—´ï¼Œå¾ˆå¤šåº—æ²¡è¥ä¸š
ä½†å•†ä¸šè¡—ç›®å½•ä¸ä¼šæŠŠå®ƒä»¬éƒ½åˆ æ‰
å› ä¸ºå¯èƒ½åªæ˜¯æš‚æ—¶è”ç³»ä¸ä¸Š
ä¿ç•™ä¿¡æ¯ï¼Œç­‰æ¢å¤åç»§ç»­ç”¨
```

**é…ç½®æ§åˆ¶**ï¼š

```yaml
eureka:
  server:
#    # æ˜¯å¦å¼€å¯è‡ªæˆ‘ä¿æŠ¤ï¼ˆé»˜è®¤trueï¼‰
    enable-self-preservation: true
#    # å¿ƒè·³é˜ˆå€¼ç³»æ•°ï¼ˆé»˜è®¤0.85ï¼‰
    renewal-percent-threshold: 0.85
```

#### ğŸ”¸ Consulçš„å¤„ç†æ–¹å¼ï¼ˆCPæ¨¡å¼ï¼‰



**ä¸€è‡´æ€§ä¼˜å…ˆ**ï¼š

```
ç½‘ç»œåˆ†åŒºå‘ç”Ÿï¼š
    â†“
å°‘æ•°æ´¾åˆ†åŒºæ— æ³•é€‰å‡ºLeader
    â†“
åœæ­¢æœåŠ¡æ³¨å†Œå’Œå‘ç°
    â†“
ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå®å¯ä¸å¯ç”¨
```

**Raftç®—æ³•ä¿è¯**ï¼š
```
é›†ç¾¤5ä¸ªèŠ‚ç‚¹ï¼Œåˆ†æˆä¸¤ç»„ï¼š
    ç»„1ï¼š3ä¸ªèŠ‚ç‚¹ï¼ˆå¤šæ•°æ´¾ï¼‰â†’ ç»§ç»­å·¥ä½œ âœ…
    ç»„2ï¼š2ä¸ªèŠ‚ç‚¹ï¼ˆå°‘æ•°æ´¾ï¼‰â†’ åœæ­¢æœåŠ¡ âŒ

åŸåˆ™ï¼šå¤šæ•°æ´¾è·èƒœï¼Œä¿è¯æ•°æ®ä¸€è‡´
```

### 3.3 é¢„é˜²å’Œåº”å¯¹æªæ–½



#### ğŸ”¸ æªæ–½1ï¼šå¤šæ³¨å†Œä¸­å¿ƒéƒ¨ç½²



**é«˜å¯ç”¨æ¶æ„**ï¼š

```
        å®¢æˆ·ç«¯
          |
    /-----------\
   /             \
æ³¨å†Œä¸­å¿ƒ1      æ³¨å†Œä¸­å¿ƒ2      æ³¨å†Œä¸­å¿ƒ3
   \             /
    \-----------/
   ç›¸äº’æ³¨å†Œï¼Œæ•°æ®åŒæ­¥

ä¼˜åŠ¿ï¼š
- å•ä¸ªæ•…éšœä¸å½±å“æ•´ä½“
- æ•°æ®å¤šå‰¯æœ¬ä¿å­˜
- è‡ªåŠ¨æ•…éšœè½¬ç§»
```

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
eureka:
  client:
    service-url:
#      # é…ç½®å¤šä¸ªæ³¨å†Œä¸­å¿ƒåœ°å€
      defaultZone: http://eureka1:8761/eureka/,http://eureka2:8762/eureka/,http://eureka3:8763/eureka/
```

#### ğŸ”¸ æªæ–½2ï¼šè®¾ç½®åˆç†è¶…æ—¶



**åˆ†å±‚è¶…æ—¶ç­–ç•¥**ï¼š

| å±‚çº§ | è¶…æ—¶æ—¶é—´ | è¯´æ˜ |
|-----|---------|------|
| è¿æ¥è¶…æ—¶ | 1-2ç§’ | å»ºç«‹è¿æ¥çš„æ—¶é—´ |
| è¯»å–è¶…æ—¶ | 3-5ç§’ | ç­‰å¾…å“åº”çš„æ—¶é—´ |
| é‡è¯•é—´éš” | 5-10ç§’ | å¤±è´¥åé‡è¯•çš„é—´éš” |

```yaml
ribbon:
  ConnectTimeout: 1000          # è¿æ¥è¶…æ—¶1ç§’
  ReadTimeout: 3000             # è¯»å–è¶…æ—¶3ç§’
  MaxAutoRetries: 1             # å•ä¸ªå®ä¾‹é‡è¯•1æ¬¡
  MaxAutoRetriesNextServer: 2   # åˆ‡æ¢å®ä¾‹é‡è¯•2æ¬¡
```

#### ğŸ”¸ æªæ–½3ï¼šé™çº§å’Œç†”æ–­



**æœåŠ¡é™çº§**ï¼š
```
å½“æœåŠ¡ä¸å¯ç”¨æ—¶æä¾›å¤‡ç”¨æ–¹æ¡ˆ

ä¾‹å¦‚ï¼š
æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥
    â†“
è¿”å›ç¼“å­˜çš„ç”¨æˆ·ä¿¡æ¯
æˆ–è¿”å›é»˜è®¤ç”¨æˆ·ä¿¡æ¯
    â†“
ä¿è¯ç³»ç»Ÿå¯ç”¨ï¼Œè™½ç„¶æ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°
```

**ç†”æ–­æœºåˆ¶**ï¼š
```
è¿ç»­å¤±è´¥è¾¾åˆ°é˜ˆå€¼
    â†“
å¿«é€Ÿå¤±è´¥ï¼Œä¸å†å°è¯•
    â†“
è¿‡ä¸€æ®µæ—¶é—´å°è¯•æ¢å¤
    â†“
æˆåŠŸ â†’ å…³é—­ç†”æ–­ âœ…
å¤±è´¥ â†’ ç»§ç»­ç†”æ–­ âŒ
```

ä½¿ç”¨Hystrixé…ç½®ï¼š

```yaml
hystrix:
  command:
    default:
      circuitBreaker:
        requestVolumeThreshold: 20      # 20æ¬¡è¯·æ±‚åæ‰è®¡ç®—å¤±è´¥ç‡
        errorThresholdPercentage: 50    # å¤±è´¥ç‡50%è§¦å‘ç†”æ–­
        sleepWindowInMilliseconds: 5000 # 5ç§’åå°è¯•æ¢å¤
```

### 3.4 ç›‘æ§å’Œå‘Šè­¦



**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

```
ğŸ“Š ç½‘ç»œå¥åº·åº¦
- å¿ƒè·³æˆåŠŸç‡
- ç½‘ç»œå»¶è¿Ÿ
- ä¸¢åŒ…ç‡

ğŸ“Š æœåŠ¡çŠ¶æ€  
- å¯ç”¨å®ä¾‹æ•°
- å¿ƒè·³å¼‚å¸¸æ•°
- è‡ªæˆ‘ä¿æŠ¤çŠ¶æ€

ğŸ“Š ä¸šåŠ¡å½±å“
- è¯·æ±‚æˆåŠŸç‡
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
```

ğŸ’¡ **æœ€ä½³å®è·µ**ï¼š
- ä½¿ç”¨Prometheus + Grafanaç›‘æ§
- è®¾ç½®åˆ†çº§å‘Šè­¦ï¼ˆè­¦å‘Š/ä¸¥é‡/ç´§æ€¥ï¼‰
- å»ºç«‹åº”æ€¥å“åº”æµç¨‹

---

## 4. ğŸ”„ æ•°æ®ä¸ä¸€è‡´é—®é¢˜



### 4.1 ä»€ä¹ˆæ˜¯æ•°æ®ä¸ä¸€è‡´



**é€šä¿—ç†è§£**ï¼š
```
åœºæ™¯ï¼šä½ åœ¨ç½‘ç«™ä¸Šä¹°ä¸œè¥¿

é—®é¢˜ï¼š
- æŸ¥åº“å­˜æ˜¾ç¤ºæœ‰è´§ï¼ˆè¯»çš„æ—§æ•°æ®ï¼‰
- ä¸‹å•æ—¶å‘ç°æ²¡è´§äº†ï¼ˆå®é™…å·²å”®ç½„ï¼‰

åŸå› ï¼šåº“å­˜æ•°æ®åœ¨ä¸åŒåœ°æ–¹ä¸åŒæ­¥
```

**å¾®æœåŠ¡ä¸­çš„è¡¨ç°**ï¼š
- æœåŠ¡Aæ˜¾ç¤ºç”¨æˆ·ä½™é¢100å…ƒ
- æœåŠ¡Bæ˜¾ç¤ºç”¨æˆ·ä½™é¢80å…ƒ
- åŒä¸€ä¸ªæ•°æ®ï¼Œä¸åŒæœåŠ¡çœ‹åˆ°çš„ä¸ä¸€æ ·

### 4.2 ä¸ä¸€è‡´çš„äº§ç”ŸåŸå› 



#### ğŸ”¸ åŸå› 1ï¼šç¼“å­˜å»¶è¿Ÿ



**å¤šçº§ç¼“å­˜é—®é¢˜**ï¼š

```
æ•°æ®æ›´æ–°æµç¨‹ï¼š

ä¿®æ”¹æ•°æ®åº“
    â†“
æ›´æ–°Redisç¼“å­˜
    â†“ [å»¶è¿Ÿ]
æ›´æ–°æœ¬åœ°ç¼“å­˜
    â†“ [å»¶è¿Ÿ]
å…¶ä»–æœåŠ¡æ„ŸçŸ¥åˆ°å˜åŒ–

é—®é¢˜ï¼šä¸­é—´çš„å»¶è¿Ÿå¯¼è‡´çŸ­æš‚ä¸ä¸€è‡´
```

**ç¤ºä¾‹åœºæ™¯**ï¼š
```
ç”¨æˆ·ä¿®æ”¹äº†æ˜µç§°ï¼š
    æ—¶åˆ»T0ï¼šæ•°æ®åº“æ”¹äº† "å°æ˜" â†’ "å°çº¢"
    æ—¶åˆ»T1ï¼šRedisæ”¹äº†ï¼ˆ1ç§’åï¼‰
    æ—¶åˆ»T2ï¼šæœåŠ¡Bçš„æœ¬åœ°ç¼“å­˜è¿˜æ²¡æ›´æ–°ï¼ˆ30ç§’åï¼‰
    
åœ¨T1-T2æœŸé—´ï¼ŒæœåŠ¡Bçœ‹åˆ°çš„è¿˜æ˜¯"å°æ˜"
```

#### ğŸ”¸ åŸå› 2ï¼šæœ€ç»ˆä¸€è‡´æ€§



**åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ¬è´¨**ï¼š

```
å¼ºä¸€è‡´æ€§ï¼ˆç†æƒ³ä½†éš¾å®ç°ï¼‰ï¼š
ä¿®æ”¹ç«‹å³åŒæ­¥åˆ°æ‰€æœ‰åœ°æ–¹
    â†“
è¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
    â†“
å®ç°ä»£ä»·å¤§ï¼Œæ€§èƒ½å·®

æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå®é™…é€‰æ‹©ï¼‰ï¼š
å…è®¸çŸ­æš‚ä¸ä¸€è‡´
    â†“
é€šè¿‡è¡¥å¿æœºåˆ¶æœ€ç»ˆä¸€è‡´
    â†“
æ€§èƒ½å¥½ï¼Œä½†æœ‰æ—¶é—´çª—å£
```

#### ğŸ”¸ åŸå› 3ï¼šç½‘ç»œåˆ†åŒº



**è„‘è£‚å¯¼è‡´çš„ä¸ä¸€è‡´**ï¼š

```
æ•°æ®åº“ä¸»ä»æ¶æ„ï¼š

ç½‘ç»œæ­£å¸¸ï¼š
    ä¸»åº“ â†â†’ ä»åº“ï¼ˆæ•°æ®åŒæ­¥ï¼‰
    
ç½‘ç»œåˆ†åŒºï¼š
    ä¸»åº“ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰  ä»åº“ï¼ˆç‹¬ç«‹è¿è¡Œï¼‰
      â†“                  â†“
   å†™å…¥æ•°æ®A          å†™å…¥æ•°æ®B
      â†“                  â†“
   ä¸¤è¾¹æ•°æ®ä¸åŒäº†ï¼
```

### 4.3 è§£å†³æ–¹æ¡ˆ



#### ğŸ”¸ æ–¹æ¡ˆ1ï¼šç¼“å­˜ä¸€è‡´æ€§ç­–ç•¥



**Cache Asideæ¨¡å¼**ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š

```java
// è¯»æ•°æ®æµç¨‹
public User getUser(Long id) {
    // 1. å…ˆæŸ¥ç¼“å­˜
    User user = redis.get("user:" + id);
    if (user != null) {
        return user;  // ç¼“å­˜å‘½ä¸­
    }
    
    // 2. ç¼“å­˜æ²¡æœ‰ï¼ŒæŸ¥æ•°æ®åº“
    user = database.query(id);
    
    // 3. å†™å…¥ç¼“å­˜
    redis.set("user:" + id, user, 300);  // 5åˆ†é’Ÿè¿‡æœŸ
    
    return user;
}

// å†™æ•°æ®æµç¨‹
public void updateUser(User user) {
    // 1. å…ˆæ›´æ–°æ•°æ®åº“
    database.update(user);
    
    // 2. åˆ é™¤ç¼“å­˜ï¼ˆä¸æ˜¯æ›´æ–°ï¼‰
    redis.delete("user:" + user.getId());
    
    // ä¸‹æ¬¡è¯»å–æ—¶ä¼šé‡æ–°åŠ è½½æœ€æ–°æ•°æ®
}
```

**ä¸ºä»€ä¹ˆåˆ é™¤è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ**
```
åŸå› 1ï¼šé¿å…å¹¶å‘é—®é¢˜
    çº¿ç¨‹Aæ›´æ–°ç¼“å­˜ â†’ çº¿ç¨‹Bä¹Ÿæ›´æ–°ç¼“å­˜
    è°çš„ç”Ÿæ•ˆï¼Ÿå¯èƒ½é”™ä¹±

åŸå› 2ï¼šèŠ‚çœèµ„æº
    åˆ é™¤ç¼“å­˜ï¼šä¸€æ¬¡æ“ä½œ
    æ›´æ–°ç¼“å­˜ï¼šå…ˆæŸ¥æ•°æ®åº“å†å†™ç¼“å­˜ï¼Œä¸¤æ¬¡æ“ä½œ
    
ä¸‹æ¬¡è¯»å–æ—¶è‡ªç„¶ä¼šåŠ è½½æœ€æ–°æ•°æ®
```

#### ğŸ”¸ æ–¹æ¡ˆ2ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æœ€ç»ˆä¸€è‡´



**äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼š

```
è®¢å•æœåŠ¡ä¿®æ”¹è®¢å•çŠ¶æ€
    â†“
å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰
    â†“
åº“å­˜æœåŠ¡è®¢é˜…æ¶ˆæ¯
    â†“
æ›´æ–°åº“å­˜çŠ¶æ€
    â†“
é€šçŸ¥å…¶ä»–ç›¸å…³æœåŠ¡

ç‰¹ç‚¹ï¼šå¼‚æ­¥å¤„ç†ï¼Œæœ€ç»ˆä¸€è‡´
```

**å¯é æ¶ˆæ¯å®ç°**ï¼š

```java
// è®¢å•æœåŠ¡
@Transactional
public void createOrder(Order order) {
    // 1. ä¿å­˜è®¢å•
    orderMapper.insert(order);
    
    // 2. å‘é€æ¶ˆæ¯ï¼ˆæœ¬åœ°æ¶ˆæ¯è¡¨ä¿è¯å¯é æ€§ï¼‰
    messageService.sendMessage("order.created", order);
}

// åº“å­˜æœåŠ¡
@RabbitListener(queues = "order.created")
public void handleOrderCreated(Order order) {
    try {
        // æ‰£å‡åº“å­˜
        stockMapper.reduce(order.getProductId(), order.getQuantity());
    } catch (Exception e) {
        // å¤±è´¥é‡è¯•æˆ–è®°å½•
        log.error("æ‰£å‡åº“å­˜å¤±è´¥", e);
        throw e;  // æ¶ˆæ¯é‡æ–°å…¥é˜Ÿ
    }
}
```

#### ğŸ”¸ æ–¹æ¡ˆ3ï¼šåˆ†å¸ƒå¼é”



**é˜²æ­¢å¹¶å‘ä¿®æ”¹**ï¼š

```
ä¸¤ä¸ªè¯·æ±‚åŒæ—¶ä¿®æ”¹ä½™é¢

ä¸åŠ é”ï¼š
    è¯·æ±‚Aï¼šè¯»ä½™é¢100 â†’ æ‰£10 â†’ å†™90
    è¯·æ±‚Bï¼šè¯»ä½™é¢100 â†’ æ‰£20 â†’ å†™80
    ç»“æœï¼šå†™äº†ä¸¤æ¬¡ï¼Œæœ€ç»ˆæ˜¯80ï¼ˆé”™äº†ï¼åº”è¯¥æ˜¯70ï¼‰

åŠ é”ï¼š
    è¯·æ±‚Aï¼šè·å–é” â†’ è¯»100 â†’ æ‰£10 â†’ å†™90 â†’ é‡Šæ”¾é”
    è¯·æ±‚Bï¼šç­‰å¾… â†’ è·å–é” â†’ è¯»90 â†’ æ‰£20 â†’ å†™70 â†’ é‡Šæ”¾é”  
    ç»“æœï¼šæ­£ç¡®æ˜¯70
```

**Redisåˆ†å¸ƒå¼é”å®ç°**ï¼š

```java
public void updateBalance(Long userId, int amount) {
    String lockKey = "lock:user:" + userId;
    String lockValue = UUID.randomUUID().toString();
    
    try {
        // è·å–é”ï¼ˆ30ç§’è¶…æ—¶ï¼‰
        boolean locked = redis.setNx(lockKey, lockValue, 30);
        
        if (!locked) {
            throw new BizException("æ“ä½œå¤ªé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•");
        }
        
        // æ‰§è¡Œä¸šåŠ¡
        User user = userMapper.selectById(userId);
        user.setBalance(user.getBalance() - amount);
        userMapper.updateById(user);
        
    } finally {
        // é‡Šæ”¾é”ï¼ˆåˆ¤æ–­æ˜¯è‡ªå·±çš„é”æ‰åˆ é™¤ï¼‰
        if (lockValue.equals(redis.get(lockKey))) {
            redis.delete(lockKey);
        }
    }
}
```

### 4.4 ç›‘æ§æ•°æ®ä¸€è‡´æ€§



**å…³é”®æ£€æŸ¥ç‚¹**ï¼š

```
ğŸ“Œ å®šæœŸå¯¹è´¦
- æ¯å°æ—¶/æ¯å¤©æ¯”å¯¹å…³é”®æ•°æ®
- æ•°æ®åº“ vs ç¼“å­˜
- ä¸»åº“ vs ä»åº“

ğŸ“Œ åŸ‹ç‚¹ç›‘æ§
- è®°å½•æ•°æ®ä¿®æ”¹æ—¶é—´æˆ³
- æ¯”å¯¹ä¸åŒæœåŠ¡çš„æ—¶é—´å·®
- è¶…è¿‡é˜ˆå€¼å‘Šè­¦

ğŸ“Œ è¡¥å¿ä»»åŠ¡
- å‘ç°ä¸ä¸€è‡´åè‡ªåŠ¨ä¿®å¤
- æˆ–äººå·¥ä»‹å…¥å¤„ç†
```

âš ï¸ **é‡è¦æç¤º**ï¼šå®Œç¾çš„å®æ—¶ä¸€è‡´æ€§å¾ˆéš¾å®ç°ï¼Œå…³é”®æ˜¯ï¼š
1. ç¡®å®šèƒ½æ¥å—çš„ä¸ä¸€è‡´æ—¶é—´çª—å£
2. å»ºç«‹è¡¥å¿å’Œä¿®å¤æœºåˆ¶
3. å¯¹ç”¨æˆ·é€æ˜å¤„ç†ï¼ˆå¦‚æ˜¾ç¤º"æ•°æ®æ›´æ–°ä¸­"ï¼‰

---

## 5. âš¡ æ€§èƒ½ç“¶é¢ˆåˆ†æ



### 5.1 ä»€ä¹ˆæ˜¯æ€§èƒ½ç“¶é¢ˆ



**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
é«˜é€Ÿå…¬è·¯å¾ˆå®½æ•ï¼Œä½†æ”¶è´¹ç«™åªæœ‰1ä¸ªçª—å£
    â†“
è½¦æµåœ¨æ”¶è´¹ç«™å µå¡
    â†“
æ”¶è´¹ç«™å°±æ˜¯æ€§èƒ½ç“¶é¢ˆ

å¾®æœåŠ¡ä¹Ÿä¸€æ ·ï¼š
    æŸä¸ªç¯èŠ‚å¤„ç†èƒ½åŠ›ä¸è¶³
    â†“
    æ•´ä½“æ€§èƒ½è¢«æ‹–ç´¯
```

### 5.2 å¸¸è§æ€§èƒ½ç“¶é¢ˆç‚¹



#### ğŸ”¸ ç“¶é¢ˆ1ï¼šæ³¨å†Œä¸­å¿ƒå‹åŠ›å¤§



**é—®é¢˜è¡¨ç°**ï¼š

```
ç—‡çŠ¶ï¼š
- æœåŠ¡æ³¨å†Œå¾ˆæ…¢
- æ‹‰å–æœåŠ¡åˆ—è¡¨è¶…æ—¶
- æ³¨å†Œä¸­å¿ƒCPU/å†…å­˜é£™é«˜

åŸå› ï¼š
- æœåŠ¡æ•°é‡å¤ªå¤šï¼ˆå‡ åƒä¸ªå®ä¾‹ï¼‰
- å¿ƒè·³é¢‘ç‡å¤ªé«˜
- æ‹‰å–é¢‘ç‡å¤ªé«˜
```

**æ’æŸ¥æ–¹æ³•**ï¼š

| æ£€æŸ¥é¡¹ | æŸ¥çœ‹æ–¹å¼ | æ­£å¸¸èŒƒå›´ |
|-------|---------|---------|
| CPUä½¿ç”¨ç‡ | `top`å‘½ä»¤ | < 70% |
| å†…å­˜ä½¿ç”¨ç‡ | `free -h` | < 80% |
| ç½‘ç»œæµé‡ | `iftop` | æ ¹æ®å¸¦å®½è¯„ä¼° |
| è¯·æ±‚å“åº”æ—¶é—´ | æ—¥å¿—/ç›‘æ§ | < 100ms |

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

```yaml
# é™ä½å¿ƒè·³é¢‘ç‡ï¼ˆé€‚åº¦å³å¯ï¼‰

eureka:
  instance:
    lease-renewal-interval-in-seconds: 30  # ä»10ç§’æ”¹ä¸º30ç§’
  client:
    registry-fetch-interval-seconds: 30    # ä»5ç§’æ”¹ä¸º30ç§’
```

```
æ•ˆæœï¼š
- ç½‘ç»œæµé‡é™ä½ 60%
- æ³¨å†Œä¸­å¿ƒè´Ÿè½½é™ä½ 50%
- æœåŠ¡å‘ç°å»¶è¿Ÿå¢åŠ  10ç§’ï¼ˆå¯æ¥å—ï¼‰
```

#### ğŸ”¸ ç“¶é¢ˆ2ï¼šæœåŠ¡è°ƒç”¨é“¾è·¯é•¿



**é—®é¢˜åœºæ™¯**ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ ç½‘å…³ â†’ æœåŠ¡A â†’ æœåŠ¡B â†’ æœåŠ¡C â†’ æ•°æ®åº“
                â†“       â†“       â†“
              100ms   150ms   200ms
              
æ€»è€—æ—¶ï¼š450msï¼ˆå¤ªæ…¢äº†ï¼ï¼‰
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š

**ç­–ç•¥1ï¼šå¼‚æ­¥è°ƒç”¨**
```java
// åŒæ­¥è°ƒç”¨ï¼ˆæ…¢ï¼‰
Order order = orderService.getOrder(orderId);        // 100ms
User user = userService.getUser(order.getUserId()); // 100ms
// æ€»è®¡200ms

// å¼‚æ­¥å¹¶è¡Œè°ƒç”¨ï¼ˆå¿«ï¼‰
CompletableFuture<Order> orderFuture = 
    CompletableFuture.supplyAsync(() -> orderService.getOrder(orderId));
    
CompletableFuture<User> userFuture = 
    CompletableFuture.supplyAsync(() -> userService.getUser(userId));

// ç­‰å¾…ä¸¤ä¸ªéƒ½å®Œæˆ
CompletableFuture.allOf(orderFuture, userFuture).join();
// æ€»è®¡100msï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
```

**ç­–ç•¥2ï¼šç¼“å­˜çƒ­ç‚¹æ•°æ®**
```java
@Cacheable(value = "user", key = "#id")
public User getUser(Long id) {
    return userMapper.selectById(id);  // åªæœ‰ç¬¬ä¸€æ¬¡æŸ¥æ•°æ®åº“
}

// åç»­è¯·æ±‚ç›´æ¥èµ°ç¼“å­˜ï¼Œè€—æ—¶ä»100msé™åˆ°5ms
```

**ç­–ç•¥3ï¼šæ‰¹é‡æŸ¥è¯¢**
```java
// é¿å…å¾ªç¯è°ƒç”¨ï¼ˆN+1é—®é¢˜ï¼‰
for (Order order : orders) {
    User user = userService.getUser(order.getUserId()); // è°ƒç”¨Næ¬¡
}

// æ”¹ä¸ºæ‰¹é‡æŸ¥è¯¢
List<Long> userIds = orders.stream()
    .map(Order::getUserId)
    .collect(Collectors.toList());
List<User> users = userService.batchGetUsers(userIds); // è°ƒç”¨1æ¬¡
```

#### ğŸ”¸ ç“¶é¢ˆ3ï¼šæ•°æ®åº“æŸ¥è¯¢æ…¢



**æ…¢æŸ¥è¯¢å®šä½**ï¼š

```sql
-- MySQLå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;  -- è¶…è¿‡2ç§’è®°å½•

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SHOW VARIABLES LIKE 'slow_query%';
```

**ä¼˜åŒ–æ–¹æ³•**ï¼š

```
1. æ·»åŠ ç´¢å¼•
   SELECT * FROM orders WHERE user_id = ? AND status = ?
   â†“ æ·»åŠ è”åˆç´¢å¼•
   CREATE INDEX idx_user_status ON orders(user_id, status)

2. åˆ†é¡µæŸ¥è¯¢
   SELECT * FROM orders  -- æŸ¥å…¨éƒ¨ï¼ˆæ…¢ï¼‰
   â†“ æ”¹ä¸º
   SELECT * FROM orders LIMIT 0, 20  -- åªæŸ¥20æ¡

3. è¯»å†™åˆ†ç¦»
   å†™æ“ä½œ â†’ ä¸»åº“
   è¯»æ“ä½œ â†’ ä»åº“ï¼ˆå¤šä¸ªï¼‰
```

### 5.3 æ€§èƒ½ç›‘æ§å·¥å…·



#### ğŸ”¸ APMå·¥å…·ï¼ˆåº”ç”¨æ€§èƒ½ç›‘æ§ï¼‰



**SkyWalkingä½¿ç”¨**ï¼š

```
åŠŸèƒ½ï¼š
- è‡ªåŠ¨è¿½è¸ªè°ƒç”¨é“¾è·¯
- ç»Ÿè®¡æ¯ä¸ªæœåŠ¡çš„å“åº”æ—¶é—´
- æ‰¾å‡ºæ…¢çš„ç¯èŠ‚

ç¤ºä¾‹ï¼š
è¯·æ±‚ID: abc123
ç½‘å…³      â†’ 10ms
â”œâ”€ æœåŠ¡A  â†’ 50ms
â”‚  â”œâ”€ æœåŠ¡B â†’ 100ms  â† æ…¢ï¼
â”‚  â””â”€ æœåŠ¡C â†’ 30ms
â””â”€ æ•°æ®åº“  â†’ 200ms   â† æœ€æ…¢ï¼

ç»“è®ºï¼šä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢å’ŒæœåŠ¡B
```

#### ğŸ”¸ å‹åŠ›æµ‹è¯•



**JMeteræµ‹è¯•ç¤ºä¾‹**ï¼š

```
æµ‹è¯•åœºæ™¯ï¼š100ä¸ªå¹¶å‘ç”¨æˆ·ï¼ŒæŒç»­10åˆ†é’Ÿ

ç»“æœåˆ†æï¼š
å¹³å‡å“åº”æ—¶é—´ï¼š200ms
90%å“åº”æ—¶é—´ï¼š300ms  â† å…³æ³¨è¿™ä¸ª
æœ€å¤§å“åº”æ—¶é—´ï¼š2000ms
ååé‡ï¼š500 req/s

ç“¶é¢ˆåˆ¤æ–­ï¼š
- 90%å“åº”æ—¶é—´ > 500ms â†’ æœ‰é—®é¢˜
- é”™è¯¯ç‡ > 1% â†’ æœ‰é—®é¢˜  
- CPU > 80% â†’ èµ„æºä¸è¶³
```

### 5.4 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•



```
âœ… æ³¨å†Œä¸­å¿ƒ
- [ ] å¿ƒè·³é¢‘ç‡æ˜¯å¦åˆç†ï¼ˆ30ç§’å·¦å³ï¼‰
- [ ] ç¼“å­˜é…ç½®æ˜¯å¦ä¼˜åŒ–
- [ ] é›†ç¾¤æ˜¯å¦è¶³å¤Ÿ

âœ… æœåŠ¡è°ƒç”¨
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜
- [ ] æ˜¯å¦å¼‚æ­¥å¹¶è¡Œè°ƒç”¨
- [ ] æ˜¯å¦æœ‰è¿æ¥æ± 
- [ ] è¶…æ—¶æ—¶é—´æ˜¯å¦åˆç†

âœ… æ•°æ®åº“
- [ ] æ˜¯å¦æ·»åŠ ç´¢å¼•
- [ ] æ˜¯å¦åˆ†é¡µæŸ¥è¯¢
- [ ] æ˜¯å¦è¯»å†™åˆ†ç¦»
- [ ] è¿æ¥æ± é…ç½®æ˜¯å¦åˆç†

âœ… ç½‘ç»œ
- [ ] æ˜¯å¦è·¨æœºæˆ¿è°ƒç”¨
- [ ] å¸¦å®½æ˜¯å¦å……è¶³
- [ ] æ˜¯å¦ä½¿ç”¨CDNåŠ é€Ÿ
```

ğŸ’¡ **ä¼˜åŒ–åŸåˆ™**ï¼š
1. å…ˆæµ‹é‡ï¼Œå†ä¼˜åŒ–ï¼ˆä¸è¦ç›²ç›®ä¼˜åŒ–ï¼‰
2. æŠ“å¤§æ”¾å°ï¼ˆä¼˜åŒ–ç“¶é¢ˆç‚¹ï¼Œä¸è¦ç»†ææœ«èŠ‚ï¼‰
3. ç©ºé—´æ¢æ—¶é—´ï¼ˆåˆç†ä½¿ç”¨ç¼“å­˜ï¼‰

---

## 6. ğŸ’¾ å†…å­˜æ³„éœ²æ’æŸ¥



### 6.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„éœ²



**é€šä¿—è§£é‡Š**ï¼š
```
å†…å­˜å°±åƒä»“åº“ï¼Œç”¨å®Œçš„ä¸œè¥¿åº”è¯¥è¿˜å›å»

æ­£å¸¸æƒ…å†µï¼š
    å€Ÿä¸œè¥¿ â†’ ç”¨å®Œ â†’ è¿˜å›å» â†’ ç©ºé—´é‡Šæ”¾ âœ…

å†…å­˜æ³„éœ²ï¼š
    å€Ÿä¸œè¥¿ â†’ ç”¨å®Œ â†’ å¿˜è®°è¿˜ â†’ ç©ºé—´å ç€ âŒ
    ä¸æ–­å€Ÿ â†’ ä»“åº“æ»¡äº† â†’ å´©æºƒ
```

**æŠ€æœ¯å«ä¹‰**ï¼š
- ç¨‹åºç”³è¯·çš„å†…å­˜
- ä½¿ç”¨åæ²¡æœ‰é‡Šæ”¾
- å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤§
- æœ€ç»ˆå¯¼è‡´`OutOfMemoryError`

### 6.2 å†…å­˜æ³„éœ²çš„å¸¸è§åŸå› 



#### ğŸ”¸ åŸå› 1ï¼šé›†åˆç±»æœªæ¸…ç†



**é—®é¢˜ä»£ç **ï¼š

```java
public class UserService {
    // é™æ€é›†åˆï¼Œä¸€ç›´å¢é•¿
    private static Map<Long, User> userCache = new HashMap<>();
    
    public void addUser(User user) {
        userCache.put(user.getId(), user);  // åªåŠ ä¸åˆ 
    }
    
    // é—®é¢˜ï¼šuserCacheä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ°¸è¿œä¸é‡Šæ”¾
}
```

**æ­£ç¡®åšæ³•**ï¼š

```java
public class UserService {
    // ä½¿ç”¨æœ‰ç•Œç¼“å­˜
    private static Map<Long, User> userCache = 
        new LinkedHashMap<Long, User>(1000, 0.75f, true) {
            @Override
            protected boolean removeEldestEntry(Map.Entry eldest) {
                return size() > 1000;  // è¶…è¿‡1000è‡ªåŠ¨åˆ é™¤æœ€è€çš„
            }
        };
}
```

æˆ–ä½¿ç”¨Guavaçš„ç¼“å­˜ï¼š

```java
LoadingCache<Long, User> userCache = CacheBuilder.newBuilder()
    .maximumSize(1000)           // æœ€å¤§1000æ¡
    .expireAfterWrite(10, MINUTES)  // 10åˆ†é’Ÿè¿‡æœŸ
    .build(key -> loadUser(key));
```

#### ğŸ”¸ åŸå› 2ï¼šèµ„æºæœªå…³é—­



**é—®é¢˜ä»£ç **ï¼š

```java
public void queryData() {
    Connection conn = dataSource.getConnection();
    Statement stmt = conn.createStatement();
    ResultSet rs = stmt.executeQuery("SELECT * FROM users");
    
    // å¤„ç†æ•°æ®...
    
    // å¿˜è®°å…³é—­ï¼Œè¿æ¥æ³„éœ²ï¼
}
```

**æ­£ç¡®åšæ³•ï¼ˆä½¿ç”¨try-with-resourcesï¼‰**ï¼š

```java
public void queryData() {
    try (Connection conn = dataSource.getConnection();
         Statement stmt = conn.createStatement();
         ResultSet rs = stmt.executeQuery("SELECT * FROM users")) {
        
        // å¤„ç†æ•°æ®...
        
    }  // è‡ªåŠ¨å…³é—­ï¼Œä¸ä¼šæ³„éœ²
}
```

#### ğŸ”¸ åŸå› 3ï¼šThreadLocalæœªæ¸…ç†



**é—®é¢˜ä»£ç **ï¼š

```java
public class RequestContext {
    private static ThreadLocal<User> currentUser = new ThreadLocal<>();
    
    public void setUser(User user) {
        currentUser.set(user);  // è®¾ç½®ç”¨æˆ·
    }
    
    // é—®é¢˜ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤ç”¨ï¼ŒThreadLocalä¸æ¸…ç†ä¼šæ³„éœ²
}
```

**æ­£ç¡®åšæ³•**ï¼š

```java
public class RequestContext {
    private static ThreadLocal<User> currentUser = new ThreadLocal<>();
    
    public void setUser(User user) {
        currentUser.set(user);
    }
    
    public void clear() {
        currentUser.remove();  // ç”¨å®Œå¿…é¡»æ¸…ç†
    }
}

// æ‹¦æˆªå™¨ä¸­ä½¿ç”¨
@Override
public void afterCompletion(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler, Exception ex) {
    RequestContext.clear();  // è¯·æ±‚ç»“æŸæ¸…ç†
}
```

### 6.3 æ’æŸ¥å†…å­˜æ³„éœ²



#### ğŸ”¸ æ­¥éª¤1ï¼šè§‚å¯Ÿå†…å­˜ä½¿ç”¨è¶‹åŠ¿



**ä½¿ç”¨JVMå‚æ•°**ï¼š
```bash
java -Xms512m -Xmx1024m \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/logs/heapdump.hprof \
     -jar app.jar
```

**ç›‘æ§å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹JVMå†…å­˜ä½¿ç”¨

jstat -gc <pid> 1000 10  # æ¯ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±10æ¬¡

# è¾“å‡ºç¤ºä¾‹ï¼š

S0C    S1C    S0U    S1U      EC       EU        OC         OU  
10240  10240  0      8192    81920    57344     204800     153600

å…³æ³¨ï¼š
- EUï¼ˆEdenåŒºä½¿ç”¨ï¼‰ï¼šä¸æ–­å¢é•¿
- OUï¼ˆè€å¹´ä»£ä½¿ç”¨ï¼‰ï¼šæŒç»­å¢é•¿ä¸ä¸‹é™ â†’ å¯èƒ½æ³„éœ²
```

#### ğŸ”¸ æ­¥éª¤2ï¼šç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶



**æ‰‹åŠ¨ç”Ÿæˆ**ï¼š
```bash
# ç”Ÿæˆå †è½¬å‚¨

jmap -dump:live,format=b,file=heap.hprof <pid>

# æŸ¥çœ‹å †å†…å­˜ç»Ÿè®¡

jmap -histo:live <pid> | head -20
```

**è¾“å‡ºåˆ†æ**ï¼š
```
num     #instances  #bytes  class name
1:      1245678     45678900  [C  â† charæ•°ç»„å ç”¨æœ€å¤š
2:      892345      28234567  java.lang.String
3:      456789      18345678  com.example.User  â† è‡ªå®šä¹‰å¯¹è±¡å¾ˆå¤š

å‘ç°ï¼šUserå¯¹è±¡æ•°é‡å¼‚å¸¸ï¼Œå¯èƒ½æ³„éœ²
```

#### ğŸ”¸ æ­¥éª¤3ï¼šMATå·¥å…·åˆ†æ



**ä½¿ç”¨Eclipse MAT**ï¼š

```
1. æ‰“å¼€heap.hprofæ–‡ä»¶
2. æŸ¥çœ‹ Leak Suspectsï¼ˆæ³„éœ²å«Œç–‘ï¼‰
3. åˆ†ææŠ¥å‘Šç¤ºä¾‹ï¼š

Problem Suspect 1:
---
UserServiceçš„userCacheå ç”¨500MB (50%å †å†…å­˜)
åŒ…å«1,000,000ä¸ªUserå¯¹è±¡

å»ºè®®ï¼š
- æ£€æŸ¥ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šUserå¯¹è±¡
- æ˜¯å¦éœ€è¦è¿™ä¹ˆå¤§çš„ç¼“å­˜
- è€ƒè™‘ä½¿ç”¨æœ‰ç•Œç¼“å­˜æˆ–å®šæœŸæ¸…ç†
```

**æŸ¥çœ‹å¯¹è±¡å¼•ç”¨é“¾**ï¼š
```
userCache
  â†“
HashMap$Node[]
  â†“  
Userå¯¹è±¡
  â†“
è¢«GC Rootå¼•ç”¨ï¼ˆæ— æ³•å›æ”¶ï¼‰

è§£å†³ï¼šæ¸…ç†userCacheæˆ–ä½¿ç”¨å¼±å¼•ç”¨
```

### 6.4 é¢„é˜²å†…å­˜æ³„éœ²



**ç¼–ç è§„èŒƒ**ï¼š

```
âœ… ä½¿ç”¨å®Œèµ„æºç«‹å³å…³é—­
   - æ•°æ®åº“è¿æ¥
   - æ–‡ä»¶æµ
   - ç½‘ç»œè¿æ¥

âœ… åˆç†ä½¿ç”¨é›†åˆ
   - è®¾ç½®æœ€å¤§å®¹é‡
   - å®šæœŸæ¸…ç†
   - è€ƒè™‘ä½¿ç”¨WeakHashMap

âœ… ThreadLocalå¿…é¡»æ¸…ç†
   - ç”¨å®Œè°ƒç”¨remove()
   - åœ¨æ‹¦æˆªå™¨/è¿‡æ»¤å™¨ä¸­ç»Ÿä¸€æ¸…ç†

âœ… ç›‘å¬å™¨åŠæ—¶ç§»é™¤
   - äº‹ä»¶ç›‘å¬å™¨ç”¨å®Œç§»é™¤
   - é¿å…å¾ªç¯å¼•ç”¨
```

**ç›‘æ§å‘Šè­¦**ï¼š
```yaml
# Prometheuså‘Šè­¦è§„åˆ™

groups:
  - name: jvm
    rules:
      - alert: MemoryUsageHigh
        expr: jvm_memory_used_bytes / jvm_memory_max_bytes > 0.9
        for: 5m
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%"
```

ğŸ’¡ **æ’æŸ¥æŠ€å·§**ï¼š
1. å…ˆçœ‹ç›‘æ§è¶‹åŠ¿ï¼Œç¡®è®¤æ˜¯å¦çœŸçš„æ³„éœ²
2. ç”Ÿæˆå †è½¬å‚¨ï¼Œç”¨MATåˆ†æ
3. æ‰¾åˆ°æ³„éœ²å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨é“¾
4. å®šä½ä»£ç ï¼Œä¿®å¤é—®é¢˜

---

## 7. âš™ï¸ é…ç½®é”™è¯¯è¯Šæ–­



### 7.1 é…ç½®æ–‡ä»¶åŠ è½½é—®é¢˜



#### ğŸ”¸ é—®é¢˜1ï¼šé…ç½®æ–‡ä»¶æ‰¾ä¸åˆ°



**å¸¸è§é”™è¯¯**ï¼š
```
Error: Could not find application.yml
æˆ–
Configuration property 'spring.application.name' not found
```

**æ’æŸ¥æ­¥éª¤**ï¼š

```
ç¬¬1æ­¥ï¼šæ£€æŸ¥æ–‡ä»¶ä½ç½®
é¡¹ç›®ç»“æ„åº”è¯¥æ˜¯ï¼š
src
â””â”€â”€ main
    â””â”€â”€ resources
        â””â”€â”€ application.yml  â† å¿…é¡»åœ¨è¿™é‡Œ

å¸¸è§é”™è¯¯ï¼š
- æ”¾åœ¨javaç›®å½•ä¸‹ âŒ
- æ–‡ä»¶åæ‹¼å†™é”™è¯¯ï¼ˆappliction.ymlï¼‰âŒ
- æ–‡ä»¶æ‰©å±•åé”™è¯¯ï¼ˆ.yaml vs .ymlï¼‰âŒ

ç¬¬2æ­¥ï¼šæ£€æŸ¥æ–‡ä»¶æ ¼å¼
YAMLæ ¼å¼ä¸¥æ ¼è¦æ±‚ç¼©è¿›

é”™è¯¯ç¤ºä¾‹ï¼š
spring:
application:  â† ç¼©è¿›é”™äº†
  name: user-service

æ­£ç¡®ç¤ºä¾‹ï¼š
spring:
  application:  â† 2ä¸ªç©ºæ ¼ç¼©è¿›
    name: user-service
```

#### ğŸ”¸ é—®é¢˜2ï¼šé…ç½®ä¼˜å…ˆçº§æ··ä¹±



**é…ç½®åŠ è½½é¡ºåº**ï¼š

```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. å‘½ä»¤è¡Œå‚æ•°
   java -jar app.jar --server.port=8081

2. ç³»ç»Ÿç¯å¢ƒå˜é‡
   export SERVER_PORT=8081

3. application-{profile}.yml
   application-prod.yml

4. application.yml
   é»˜è®¤é…ç½®æ–‡ä»¶

5. ä»£ç ä¸­çš„@Valueé»˜è®¤å€¼
   @Value("${server.port:8080}")
```

**å®é™…æ¡ˆä¾‹**ï¼š

```
é—®é¢˜ï¼šæ˜æ˜é…ç½®äº†ç«¯å£8080ï¼Œä¸ºä»€ä¹ˆå¯åŠ¨åœ¨8081ï¼Ÿ

æ’æŸ¥ï¼š
1. æ£€æŸ¥application.yml â† ç«¯å£8080 âœ“
2. æ£€æŸ¥ç¯å¢ƒå˜é‡ â† å‘ç° SERVER_PORT=8081 âœ“

åŸå› ï¼šç¯å¢ƒå˜é‡ä¼˜å…ˆçº§æ›´é«˜ï¼Œè¦†ç›–äº†é…ç½®æ–‡ä»¶

è§£å†³ï¼šåˆ é™¤ç¯å¢ƒå˜é‡æˆ–ä½¿ç”¨å‘½ä»¤è¡Œæ˜ç¡®æŒ‡å®š
```

#### ğŸ”¸ é—®é¢˜3ï¼šå¤šç¯å¢ƒé…ç½®æ··ä¹±



**æ­£ç¡®çš„é…ç½®ç»“æ„**ï¼š

```
resources/
â”œâ”€â”€ application.yml          # å…¬å…±é…ç½®
â”œâ”€â”€ application-dev.yml      # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ application-test.yml     # æµ‹è¯•ç¯å¢ƒ
â””â”€â”€ application-prod.yml     # ç”Ÿäº§ç¯å¢ƒ
```

**application.ymlï¼ˆå…¬å…±é…ç½®ï¼‰**ï¼š
```yaml
spring:
  application:
    name: user-service       # æ‰€æœ‰ç¯å¢ƒç›¸åŒ
  profiles:
    active: @spring.profiles.active@  # Maven/Gradleæ›¿æ¢

# å…¬å…±é…ç½®

logging:
  level:
    root: INFO
```

**application-dev.ymlï¼ˆå¼€å‘é…ç½®ï¼‰**ï¼š
```yaml
server:
  port: 8080

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # æœ¬åœ°æ³¨å†Œä¸­å¿ƒ

logging:
  level:
    com.example: DEBUG  # å¼€å‘ç¯å¢ƒå¼€å¯è°ƒè¯•
```

**application-prod.ymlï¼ˆç”Ÿäº§é…ç½®ï¼‰**ï¼š
```yaml
server:
  port: 80

eureka:
  client:
    service-url:
      defaultZone: http://eureka1:8761/eureka/,http://eureka2:8762/eureka/  # ç”Ÿäº§é›†ç¾¤

logging:
  level:
    com.example: WARN  # ç”Ÿäº§åªè®°å½•è­¦å‘Š
```

### 7.2 æ³¨å†Œä¸­å¿ƒé…ç½®é”™è¯¯



#### ğŸ”¸ Eurekaé…ç½®é”™è¯¯



**é”™è¯¯é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# âŒ é”™è¯¯1ï¼šURLè·¯å¾„å†™é”™

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eurka/  # æ‹¼å†™é”™è¯¯

# âŒ é”™è¯¯2ï¼šæœåŠ¡åæ ¼å¼é”™è¯¯

spring:
  application:
    name: user_service  # ä¸èƒ½æœ‰ä¸‹åˆ’çº¿

# âŒ é”™è¯¯3ï¼šå¿ƒè·³é…ç½®ä¸åˆç†

eureka:
  instance:
    lease-renewal-interval-in-seconds: 1  # å¤ªé¢‘ç¹
    lease-expiration-duration-in-seconds: 2  # å¤ªçŸ­

# âœ… æ­£ç¡®é…ç½®ï¼š

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # æ­£ç¡®è·¯å¾„
  instance:
    lease-renewal-interval-in-seconds: 30     # 30ç§’å¿ƒè·³
    lease-expiration-duration-in-seconds: 90  # 90ç§’è¿‡æœŸ
spring:
  application:
    name: user-service  # ä½¿ç”¨ä¸­åˆ’çº¿
```

#### ğŸ”¸ Nacosé…ç½®é”™è¯¯



**å¸¸è§é—®é¢˜**ï¼š

```yaml
# âŒ é”™è¯¯ï¼šå‘½åç©ºé—´IDå†™é”™

spring:
  cloud:
    nacos:
      discovery:
        namespace: dev  # åº”è¯¥æ˜¯UUID

# âœ… æ­£ç¡®ï¼š

spring:
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: d8a5c890-xxxx-xxxx-xxxx-xxxxxxxxxxxx  # æ­£ç¡®çš„UUID
        group: DEFAULT_GROUP
```

**éªŒè¯é…ç½®**ï¼š
```bash
# æ£€æŸ¥Nacosè¿æ¥

curl http://localhost:8848/nacos/v1/ns/operator/servers

# æŸ¥çœ‹æœåŠ¡åˆ—è¡¨

curl http://localhost:8848/nacos/v1/ns/instance/list?serviceName=user-service
```

### 7.3 é…ç½®æ£€æŸ¥å·¥å…·



#### ğŸ”¸ Spring Boot Actuator



**å¼€å¯é…ç½®ç«¯ç‚¹**ï¼š

```yaml
management:
  endpoints:
    web:
      exposure:
        include: env,configprops,health
```

**æŸ¥çœ‹æ‰€æœ‰é…ç½®**ï¼š
```bash
# æŸ¥çœ‹ç¯å¢ƒå˜é‡å’Œé…ç½®

curl http://localhost:8080/actuator/env

# æŸ¥çœ‹é…ç½®å±æ€§

curl http://localhost:8080/actuator/configprops
```

#### ğŸ”¸ é…ç½®éªŒè¯è„šæœ¬



**å¯åŠ¨å‰æ£€æŸ¥**ï¼š

```bash
#!/bin/bash

# check-config.sh


echo "æ£€æŸ¥é…ç½®æ–‡ä»¶..."

# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨

if [ ! -f "src/main/resources/application.yml" ]; then
    echo "âŒ application.ymlä¸å­˜åœ¨"
    exit 1
fi

# 2. æ£€æŸ¥YAMLè¯­æ³•

python -c "import yaml; yaml.safe_load(open('src/main/resources/application.yml'))"
if [ $? -ne 0 ]; then
    echo "âŒ YAMLæ ¼å¼é”™è¯¯"
    exit 1
fi

# 3. æ£€æŸ¥å¿…éœ€é…ç½®

if ! grep -q "spring.application.name" src/main/resources/application.yml; then
    echo "âŒ ç¼ºå°‘æœåŠ¡åé…ç½®"
    exit 1
fi

echo "âœ… é…ç½®æ£€æŸ¥é€šè¿‡"
```

### 7.4 é…ç½®æœ€ä½³å®è·µ



**æ£€æŸ¥æ¸…å•**ï¼š

```
âœ… åŸºç¡€é…ç½®
- [ ] æ–‡ä»¶ä½ç½®æ­£ç¡®ï¼ˆresourcesç›®å½•ï¼‰
- [ ] YAMLæ ¼å¼æ­£ç¡®ï¼ˆç¼©è¿›2ç©ºæ ¼ï¼‰
- [ ] æœåŠ¡åç¬¦åˆè§„èŒƒï¼ˆå°å†™å­—æ¯+ä¸­åˆ’çº¿ï¼‰

âœ… æ³¨å†Œä¸­å¿ƒ
- [ ] åœ°å€æ‹¼å†™æ­£ç¡®
- [ ] ç«¯å£å·æ­£ç¡®
- [ ] å¿ƒè·³é—´éš”åˆç†ï¼ˆ30ç§’ï¼‰

âœ… ç¯å¢ƒé…ç½®
- [ ] åŒºåˆ†å¼€å‘/æµ‹è¯•/ç”Ÿäº§é…ç½®
- [ ] æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] ç”Ÿäº§é…ç½®ä¸æäº¤åˆ°ä»£ç ä»“åº“

âœ… æ—¥å¿—é…ç½®
- [ ] å¼€å‘ç¯å¢ƒDEBUGçº§åˆ«
- [ ] ç”Ÿäº§ç¯å¢ƒWARNçº§åˆ«
- [ ] æ—¥å¿—æ–‡ä»¶å®šæœŸæ¸…ç†

âœ… è¶…æ—¶é…ç½®
- [ ] è¿æ¥è¶…æ—¶1-3ç§’
- [ ] è¯»å–è¶…æ—¶3-5ç§’
- [ ] åˆç†çš„é‡è¯•æ¬¡æ•°
```

ğŸ’¡ **é…ç½®å»ºè®®**ï¼š
1. ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼ˆNacos/Apolloï¼‰ç»Ÿä¸€ç®¡ç†
2. æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
3. é…ç½®å˜æ›´éœ€è¦å®¡æ‰¹å’Œç°åº¦å‘å¸ƒ
4. å®šæœŸå®¡æŸ¥é…ç½®ï¼Œåˆ é™¤æ— ç”¨é…ç½®

---

## 8. ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜



### 8.1 ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜



**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
åœºæ™¯ï¼šä½ çš„iPhoneç”¨iOS 16ï¼Œæœ‹å‹çš„ç”¨iOS 12

é—®é¢˜ï¼š
- ä½ å‘çš„æ–°emojiï¼Œæœ‹å‹çœ‹åˆ°æ˜¯æ–¹æ¡†
- ä½ ç”¨çš„æ–°åŠŸèƒ½ï¼Œæœ‹å‹çš„æ‰‹æœºæ²¡æœ‰

è¿™å°±æ˜¯ç‰ˆæœ¬ä¸å…¼å®¹
```

**å¾®æœåŠ¡ä¸­çš„è¡¨ç°**ï¼š
```
æœåŠ¡Aç”¨ Spring Cloud 2021ç‰ˆæœ¬
æœåŠ¡Bç”¨ Spring Cloud 2020ç‰ˆæœ¬
    â†“
æ¥å£è°ƒç”¨å¤±è´¥
åè®®ä¸å…¼å®¹
æ•°æ®æ ¼å¼ä¸ä¸€è‡´
```

### 8.2 å¸¸è§å…¼å®¹æ€§é—®é¢˜



#### ğŸ”¸ é—®é¢˜1ï¼šSpring Cloudç‰ˆæœ¬ä¸åŒ¹é…



**ç‰ˆæœ¬å¯¹åº”å…³ç³»**ï¼š

| Spring Cloud | Spring Boot | JDK |
|-------------|-------------|-----|
| 2023.x (Leyton) | 3.2.x | 17+ |
| 2022.x (Kilburn) | 3.0.x | 17+ |
| 2021.x (Jubilee) | 2.6.x | 8+ |
| 2020.x (Ilford) | 2.4.x | 8+ |

**é”™è¯¯ç¤ºä¾‹**ï¼š

```xml
<!-- âŒ ç‰ˆæœ¬ä¸åŒ¹é… -->
<spring-boot.version>2.7.0</spring-boot.version>
<spring-cloud.version>2023.0.0</spring-cloud.version>
<!-- Spring Boot 2.7é…Spring Cloud 2023ä¼šæŠ¥é”™ -->

<!-- âœ… æ­£ç¡®åŒ¹é… -->
<spring-boot.version>3.2.0</spring-boot.version>
<spring-cloud.version>2023.0.0</spring-cloud.version>
```

**æŠ¥é”™ä¿¡æ¯**ï¼š
```
NoSuchMethodError: org.springframework.boot.XXX
æˆ–
ClassNotFoundException: æŸä¸ªç±»æ‰¾ä¸åˆ°

åŸå› ï¼šç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´APIå˜åŒ–æˆ–ç±»ä¸å­˜åœ¨
```

#### ğŸ”¸ é—®é¢˜2ï¼šæ³¨å†Œä¸­å¿ƒåè®®ä¸å…¼å®¹



**Eurekaç‰ˆæœ¬å·®å¼‚**ï¼š

```
Eureka Server 1.xï¼ˆè€ç‰ˆæœ¬ï¼‰
    â†“
ä¸æ”¯æŒæŸäº›æ–°ç‰¹æ€§
    â†“
Eureka Client 2.xï¼ˆæ–°ç‰ˆæœ¬ï¼‰ä½¿ç”¨æ–°ç‰¹æ€§
    â†“
æ³¨å†Œå¤±è´¥æˆ–æ•°æ®ä¸¢å¤±
```

**å®é™…æ¡ˆä¾‹**ï¼š

```yaml
# æœåŠ¡Aï¼ˆè€ç‰ˆæœ¬ï¼‰

eureka:
  instance:
    metadata-map:
      version: 1.0  # åªèƒ½ç”¨ç®€å•çš„key-value

# æœåŠ¡Bï¼ˆæ–°ç‰ˆæœ¬ï¼‰  

eureka:
  instance:
    metadata-map:
      config:        # ä½¿ç”¨åµŒå¥—ç»“æ„
        version: 2.0
        region: cn-north

# é—®é¢˜ï¼šè€ç‰ˆæœ¬Eureka Serverå¯èƒ½è§£æå¤±è´¥

```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```yaml
# ç»Ÿä¸€ä½¿ç”¨æ‰å¹³ç»“æ„

eureka:
  instance:
    metadata-map:
      config.version: 2.0      # ç”¨ç‚¹å·ä»£æ›¿åµŒå¥—
      config.region: cn-north
```

#### ğŸ”¸ é—®é¢˜3ï¼šåºåˆ—åŒ–åè®®å˜æ›´



**Jacksonç‰ˆæœ¬å‡çº§å¯¼è‡´çš„é—®é¢˜**ï¼š

```java
// è€ç‰ˆæœ¬åºåˆ—åŒ–
{"createTime": 1234567890}  // æ—¶é—´æˆ³

// æ–°ç‰ˆæœ¬åºåˆ—åŒ–
{"createTime": "2024-01-15T10:30:00Z"}  // ISOæ ¼å¼

// é—®é¢˜ï¼šè€ç‰ˆæœ¬æœåŠ¡è§£ææ–°æ ¼å¼å¤±è´¥
```

**å…¼å®¹æ–¹æ¡ˆ**ï¼š

```java
@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss", timezone = "GMT+8")
private Date createTime;

// æˆ–è€…è‡ªå®šä¹‰åºåˆ—åŒ–å™¨
@JsonSerialize(using = CustomDateSerializer.class)
private Date createTime;
```

### 8.3 ç‰ˆæœ¬å‡çº§ç­–ç•¥



#### ğŸ”¸ ç­–ç•¥1ï¼šç°åº¦å‘å¸ƒ



**æ¸è¿›å¼å‡çº§æµç¨‹**ï¼š

```
æ­¥éª¤1ï¼šå°èŒƒå›´éªŒè¯
    æ–°ç‰ˆæœ¬æœåŠ¡ 10%æµé‡
    è€ç‰ˆæœ¬æœåŠ¡ 90%æµé‡
    â†“
è§‚å¯Ÿ1-2å¤©ï¼Œæ— é—®é¢˜ç»§ç»­

æ­¥éª¤2ï¼šé€æ­¥æ‰©å¤§
    æ–°ç‰ˆæœ¬ 50%æµé‡
    è€ç‰ˆæœ¬ 50%æµé‡
    â†“
è§‚å¯Ÿ1å¤©ï¼Œæ— é—®é¢˜ç»§ç»­

æ­¥éª¤3ï¼šå…¨é‡ä¸Šçº¿
    æ–°ç‰ˆæœ¬ 100%æµé‡
    è€ç‰ˆæœ¬ä¸‹çº¿
```

**é…ç½®æ–¹å¼**ï¼š

```yaml
# ä½¿ç”¨ç‰ˆæœ¬å·è·¯ç”±

spring:
  cloud:
    loadbalancer:
      configurations: version-aware

# æœåŠ¡å®ä¾‹æ ‡è®°ç‰ˆæœ¬

eureka:
  instance:
    metadata-map:
      version: v2
      
# è·¯ç”±è§„åˆ™

ribbon:
  NFLoadBalancerRuleClassName: com.example.VersionLoadBalancer
```

#### ğŸ”¸ ç­–ç•¥2ï¼šAPIç‰ˆæœ¬æ§åˆ¶



**URLç‰ˆæœ¬åŒ–**ï¼š

```java
// è€ç‰ˆæœ¬API
@GetMapping("/v1/users/{id}")
public User getUserV1(@PathVariable Long id) {
    return userService.getUser(id);
}

// æ–°ç‰ˆæœ¬API
@GetMapping("/v2/users/{id}")
public UserDTO getUserV2(@PathVariable Long id) {
    return userService.getUserWithDetails(id);
}

// ä¼˜åŠ¿ï¼š
- è€æ¥å£ç»§ç»­å¯ç”¨
- æ–°æ¥å£ç‹¬ç«‹æ¼”è¿›
- å®¢æˆ·ç«¯è‡ªä¸»é€‰æ‹©
```

**Headerç‰ˆæœ¬åŒ–**ï¼š

```java
@GetMapping("/users/{id}")
public Object getUser(
    @PathVariable Long id,
    @RequestHeader(value = "API-Version", defaultValue = "1") int version) {
    
    if (version == 2) {
        return userService.getUserWithDetails(id);
    }
    return userService.getUser(id);
}
```

#### ğŸ”¸ ç­–ç•¥3ï¼šå‘åå…¼å®¹è®¾è®¡



**æ•°æ®ç»“æ„å…¼å®¹**ï¼š

```java
// è€ç‰ˆæœ¬
public class UserV1 {
    private Long id;
    private String name;
}

// æ–°ç‰ˆæœ¬ï¼ˆå‘åå…¼å®¹ï¼‰
public class UserV2 extends UserV1 {
    private String email;      // æ–°å¢å­—æ®µ
    private String phone;      // æ–°å¢å­—æ®µ
    
    // æä¾›è½¬æ¢æ–¹æ³•
    public UserV1 toV1() {
        UserV1 user = new UserV1();
        user.setId(this.getId());
        user.setName(this.getName());
        return user;
    }
}
```

**é…ç½®é¡¹å…¼å®¹**ï¼š

```yaml
# åŒæ—¶æ”¯æŒæ–°æ—§é…ç½®

spring:
  datasource:
    url: ${spring.datasource.new-url:${spring.datasource.old-url:jdbc:mysql://localhost:3306/db}}
    
# è§£é‡Šï¼š

# 1. å…ˆè¯»new-url

# 2. å¦‚æœæ²¡æœ‰ï¼Œè¯»old-url  

# 3. å¦‚æœéƒ½æ²¡æœ‰ï¼Œç”¨é»˜è®¤å€¼

```

### 8.4 å…¼å®¹æ€§æµ‹è¯•



#### ğŸ”¸ æµ‹è¯•çŸ©é˜µ



**ç‰ˆæœ¬ç»„åˆæµ‹è¯•**ï¼š

| æœåŠ¡Aç‰ˆæœ¬ | æœåŠ¡Bç‰ˆæœ¬ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |
|----------|----------|---------|------|
| v1.0 | v1.0 | âœ… | åŸºçº¿ç‰ˆæœ¬ |
| v1.0 | v2.0 | âœ… | å‘åå…¼å®¹ |
| v2.0 | v1.0 | âš ï¸ | éƒ¨åˆ†åŠŸèƒ½é™çº§ |
| v2.0 | v2.0 | âœ… | æœ€æ–°ç‰ˆæœ¬ |

#### ğŸ”¸ å¥‘çº¦æµ‹è¯•



**ä½¿ç”¨Spring Cloud Contract**ï¼š

```java
// å®šä¹‰å¥‘çº¦
@AutoConfigureStubRunner(
    ids = "com.example:user-service:+:stubs:8080",
    stubsMode = StubsMode.LOCAL
)
public class UserServiceContractTest {
    
    @Test
    public void should_return_user() {
        // æµ‹è¯•æ˜¯å¦ç¬¦åˆå¥‘çº¦å®šä¹‰
        User user = restTemplate.getForObject(
            "http://localhost:8080/users/1", User.class);
            
        assertThat(user.getName()).isEqualTo("å¼ ä¸‰");
    }
}
```

### 8.5 ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ



**æ£€æŸ¥æ¸…å•**ï¼š

```
âœ… ç‰ˆæœ¬å·è§„èŒƒ
- [ ] ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.è¡¥ä¸ç‰ˆæœ¬ï¼‰
- [ ] ä¸»ç‰ˆæœ¬å˜æ›´è¡¨ç¤ºä¸å…¼å®¹
- [ ] æ¬¡ç‰ˆæœ¬å˜æ›´è¡¨ç¤ºæ–°åŠŸèƒ½
- [ ] è¡¥ä¸ç‰ˆæœ¬è¡¨ç¤ºbugä¿®å¤

âœ… ä¾èµ–ç®¡ç†
- [ ] ç»Ÿä¸€åœ¨çˆ¶POMä¸­ç®¡ç†ç‰ˆæœ¬
- [ ] ä½¿ç”¨dependencyManagementé”å®šç‰ˆæœ¬
- [ ] å®šæœŸæ£€æŸ¥ä¾èµ–å®‰å…¨æ¼æ´

âœ… å‡çº§è®¡åˆ’
- [ ] åˆ¶å®šç‰ˆæœ¬å‡çº§è·¯çº¿å›¾
- [ ] é¢„ç•™å…¼å®¹çª—å£æœŸï¼ˆ1-2ä¸ªæœˆï¼‰
- [ ] æå‰é€šçŸ¥ä¸‹æ¸¸æœåŠ¡

âœ… å›æ»šå‡†å¤‡
- [ ] ä¿ç•™ä¸Šä¸€ç‰ˆæœ¬éƒ¨ç½²åŒ…
- [ ] å‡†å¤‡å¿«é€Ÿå›æ»šè„šæœ¬
- [ ] ç›‘æ§å…³é”®æŒ‡æ ‡
```

ğŸ’¡ **å‡çº§å»ºè®®**ï¼š
1. æ°¸è¿œä¸è¦"å¤§çˆ†ç‚¸"å¼å‡çº§ï¼ˆå…¨éƒ¨ä¸€èµ·å‡ï¼‰
2. å»ºç«‹ç‰ˆæœ¬å…¼å®¹æµ‹è¯•ç¯å¢ƒ
3. ä¼˜å…ˆå‡çº§åº•å±‚æœåŠ¡ï¼ˆå¦‚ç½‘å…³ã€é…ç½®ä¸­å¿ƒï¼‰
4. ä¸šåŠ¡æœåŠ¡æœ€åå‡çº§

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 é—®é¢˜è¯Šæ–­æ€è·¯



**é€šç”¨æ’æŸ¥æµç¨‹**ï¼š

```
å‘ç°é—®é¢˜
    â†“
æ”¶é›†ç°è±¡å’Œæ—¥å¿—
    â†“
å®šä½é—®é¢˜å±‚æ¬¡
    â”œâ”€ ç½‘ç»œå±‚ï¼šè¿æ¥ã€è¶…æ—¶ã€åˆ†åŒº
    â”œâ”€ åº”ç”¨å±‚ï¼šé…ç½®ã€ä»£ç ã€èµ„æº
    â””â”€ æ•°æ®å±‚ï¼šä¸€è‡´æ€§ã€æ€§èƒ½
    â†“
åˆ¶å®šè§£å†³æ–¹æ¡ˆ
    â†“
éªŒè¯å’Œç›‘æ§
```

### 9.2 å¿«é€Ÿè®°å¿†è¦ç‚¹



#### ğŸ”¸ æœåŠ¡æ³¨å†Œå¤±è´¥


```
å£è¯€ï¼šåœ°å€ã€ç½‘ç»œã€é…ç½®ã€å¿ƒè·³
- æ£€æŸ¥æ³¨å†Œä¸­å¿ƒåœ°å€
- éªŒè¯ç½‘ç»œè¿é€šæ€§
- æ ¸å¯¹é…ç½®æ ¼å¼
- è°ƒæ•´å¿ƒè·³å‚æ•°
```

#### ğŸ”¸ æœåŠ¡å‘ç°å»¶è¿Ÿ


```
å£è¯€ï¼šç¼“å­˜ã€åˆ·æ–°ã€æ¨é€ã€æ£€æŸ¥
- ç†è§£ä¸‰å±‚ç¼“å­˜
- è°ƒæ•´åˆ·æ–°é¢‘ç‡
- ä½¿ç”¨æ¨é€æ¨¡å¼
- ä¸»åŠ¨å¥åº·æ£€æŸ¥
```

#### ğŸ”¸ ç½‘ç»œåˆ†åŒº


```
å£è¯€ï¼šé›†ç¾¤ã€è¶…æ—¶ã€é™çº§ã€ç†”æ–­
- å¤šèŠ‚ç‚¹éƒ¨ç½²
- åˆç†è¶…æ—¶è®¾ç½®
- æœåŠ¡é™çº§æ–¹æ¡ˆ
- ç†”æ–­ä¿æŠ¤æœºåˆ¶
```

#### ğŸ”¸ æ•°æ®ä¸ä¸€è‡´


```
å£è¯€ï¼šç¼“å­˜ã€æ¶ˆæ¯ã€é”ã€è¡¥å¿
- ç¼“å­˜ä¸€è‡´æ€§ç­–ç•¥
- æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥
- åˆ†å¸ƒå¼é”æ§åˆ¶
- å®šæœŸå¯¹è´¦è¡¥å¿
```

#### ğŸ”¸ æ€§èƒ½ç“¶é¢ˆ


```
å£è¯€ï¼šç›‘æ§ã€å®šä½ã€ä¼˜åŒ–ã€éªŒè¯
- APMå…¨é“¾è·¯ç›‘æ§
- æ‰¾å‡ºæ…¢ç¯èŠ‚
- é’ˆå¯¹æ€§ä¼˜åŒ–
- å‹æµ‹éªŒè¯æ•ˆæœ
```

#### ğŸ”¸ å†…å­˜æ³„éœ²


```
å£è¯€ï¼šé›†åˆã€èµ„æºã€çº¿ç¨‹ã€å·¥å…·
- é›†åˆåŠæ—¶æ¸…ç†
- èµ„æºå¿…é¡»å…³é—­
- ThreadLocalè¦remove
- MATå·¥å…·åˆ†æ
```

#### ğŸ”¸ é…ç½®é”™è¯¯


```
å£è¯€ï¼šä½ç½®ã€æ ¼å¼ã€ç¯å¢ƒã€éªŒè¯
- æ–‡ä»¶ä½ç½®æ­£ç¡®
- YAMLæ ¼å¼è§„èŒƒ
- ç¯å¢ƒé…ç½®åˆ†ç¦»
- å¯åŠ¨å‰éªŒè¯
```

#### ğŸ”¸ ç‰ˆæœ¬å…¼å®¹


```
å£è¯€ï¼šåŒ¹é…ã€ç°åº¦ã€å…¼å®¹ã€æµ‹è¯•
- ç‰ˆæœ¬å¯¹åº”å…³ç³»
- ç°åº¦å‘å¸ƒä¸Šçº¿
- å‘åå…¼å®¹è®¾è®¡
- å¥‘çº¦æµ‹è¯•ä¿éšœ
```

### 9.3 å·¥å…·ç®±é€ŸæŸ¥



#### ğŸ“Š ç›‘æ§è¯Šæ–­å·¥å…·



| å·¥å…·ç±»å‹ | å·¥å…·åç§° | ä¸»è¦ç”¨é€” | ä½¿ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| **APMç›‘æ§** | SkyWalking | åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª | å®šä½æ…¢æ¥å£ |
| **JVMè¯Šæ–­** | JVisualVM | å†…å­˜/çº¿ç¨‹åˆ†æ | æ’æŸ¥å†…å­˜æ³„éœ² |
| **å†…å­˜åˆ†æ** | MAT | å †è½¬å‚¨åˆ†æ | å®šä½æ³„éœ²å¯¹è±¡ |
| **æ€§èƒ½æµ‹è¯•** | JMeter | å‹åŠ›æµ‹è¯• | æ‰¾æ€§èƒ½ç“¶é¢ˆ |
| **ç½‘ç»œæŠ“åŒ…** | Wireshark | ç½‘ç»œåˆ†æ | æ’æŸ¥ç½‘ç»œé—®é¢˜ |
| **æ—¥å¿—åˆ†æ** | ELK | æ—¥å¿—èšåˆæŸ¥è¯¢ | é—®é¢˜å›æº¯ |

#### ğŸ”§ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥



**JVMè¯Šæ–­å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹Javaè¿›ç¨‹

jps -l

# æŸ¥çœ‹JVMå‚æ•°

jinfo -flags <pid>

# æŸ¥çœ‹å†…å­˜ç»Ÿè®¡

jstat -gc <pid> 1000 10

# æŸ¥çœ‹çº¿ç¨‹å †æ ˆ

jstack <pid> > thread.log

# ç”Ÿæˆå †è½¬å‚¨

jmap -dump:live,format=b,file=heap.hprof <pid>

# æŸ¥çœ‹å¯¹è±¡ç»Ÿè®¡

jmap -histo:live <pid> | head -20
```

**ç½‘ç»œè¯Šæ–­å‘½ä»¤**ï¼š
```bash
# æµ‹è¯•è¿é€šæ€§

ping <host>

# æµ‹è¯•ç«¯å£

telnet <host> <port>
nc -zv <host> <port>

# æŸ¥çœ‹ç«¯å£å ç”¨

netstat -tulnp | grep <port>
lsof -i:<port>

# è¿½è¸ªè·¯ç”±

traceroute <host>

# DNSæŸ¥è¯¢

nslookup <domain>
dig <domain>
```

**æœåŠ¡æ£€æŸ¥å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥EurekaæœåŠ¡

curl http://localhost:8761/eureka/apps

# æ£€æŸ¥NacosæœåŠ¡

curl http://localhost:8848/nacos/v1/ns/instance/list?serviceName=user-service

# æŸ¥çœ‹å¥åº·çŠ¶æ€

curl http://localhost:8080/actuator/health

# æŸ¥çœ‹é…ç½®

curl http://localhost:8080/actuator/env
```

### 9.4 åº”æ€¥å¤„ç†æµç¨‹



#### ğŸš¨ æœåŠ¡ä¸å¯ç”¨åº”æ€¥



```
ç«‹å³å“åº”ï¼ˆ5åˆ†é’Ÿå†…ï¼‰ï¼š
    â†“
1. ç¡®è®¤å½±å“èŒƒå›´
   - å“ªäº›æœåŠ¡å—å½±å“ï¼Ÿ
   - å½±å“å¤šå°‘ç”¨æˆ·ï¼Ÿ
   
2. åˆ¤æ–­ä¸¥é‡ç¨‹åº¦
   - æ ¸å¿ƒæœåŠ¡è¿˜æ˜¯è¾¹ç¼˜æœåŠ¡ï¼Ÿ
   - èƒ½å¦é™çº§å¤„ç†ï¼Ÿ
   
3. å¿«é€Ÿå†³ç­–
   â”œâ”€ èƒ½å¿«é€Ÿä¿®å¤ â†’ ç«‹å³ä¿®å¤ä¸Šçº¿
   â”œâ”€ æ— æ³•å¿«é€Ÿä¿®å¤ â†’ å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
   â””â”€ æ— æ³•å›æ»š â†’ å¯ç”¨é™çº§æ–¹æ¡ˆ
   
4. é€šçŸ¥ç›¸å…³æ–¹
   - é€šçŸ¥ç”¨æˆ·ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
   - é€šçŸ¥ä¸šåŠ¡æ–¹
   - è®°å½•äº‹æ•…ä¿¡æ¯
```

#### ğŸ“ é—®é¢˜å¤„ç†æ¨¡æ¿



```markdown
# æ•…éšœè®°å½•



**åŸºæœ¬ä¿¡æ¯**ï¼š
- å‘ç”Ÿæ—¶é—´ï¼š2024-01-15 10:30
- å½±å“æœåŠ¡ï¼šç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡
- å½±å“èŒƒå›´ï¼šååŒ—åŒºåŸŸç”¨æˆ·
- æŒç»­æ—¶é—´ï¼š30åˆ†é’Ÿ

**é—®é¢˜ç°è±¡**ï¼š
- æœåŠ¡æ³¨å†Œå¤±è´¥
- æ¥å£å“åº”è¶…æ—¶
- é”™è¯¯ç‡è¾¾åˆ°15%

**é—®é¢˜åŸå› **ï¼š
- æ ¹å› ï¼šEureka Serverå†…å­˜æº¢å‡º
- ç›´æ¥åŸå› ï¼šå¿ƒè·³é¢‘ç‡è¿‡é«˜
- é—´æ¥åŸå› ï¼šæœåŠ¡å®ä¾‹æ•°é‡æ¿€å¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¸´æ—¶æ–¹æ¡ˆï¼šé‡å¯Eureka Server
2. é•¿æœŸæ–¹æ¡ˆï¼šä¼˜åŒ–å¿ƒè·³é…ç½®ï¼Œæ‰©å®¹æ³¨å†Œä¸­å¿ƒ

**é¢„é˜²æªæ–½**ï¼š
- æ·»åŠ å†…å­˜ç›‘æ§å‘Šè­¦
- è®¾ç½®æœåŠ¡å®ä¾‹æ•°é‡ä¸Šé™
- å®šæœŸå‹æµ‹éªŒè¯å®¹é‡
```

### 9.5 æœ€ä½³å®è·µæ¸…å•



#### âœ… æ—¥å¸¸è¿ç»´æ£€æŸ¥



**æ¯æ—¥æ£€æŸ¥**ï¼š
```
â–¡ æŸ¥çœ‹æœåŠ¡å¥åº·çŠ¶æ€
â–¡ æ£€æŸ¥é”™è¯¯æ—¥å¿—
â–¡ æŸ¥çœ‹ç›‘æ§å¤§ç›˜
â–¡ ç¡®è®¤å¤‡ä»½ä»»åŠ¡æ‰§è¡Œ
```

**æ¯å‘¨æ£€æŸ¥**ï¼š
```
â–¡ åˆ†ææ€§èƒ½è¶‹åŠ¿
â–¡ æ¸…ç†æ— ç”¨æ—¥å¿—
â–¡ æ£€æŸ¥ç£ç›˜ç©ºé—´
â–¡ æ›´æ–°ä¾èµ–ç‰ˆæœ¬
```

**æ¯æœˆæ£€æŸ¥**ï¼š
```
â–¡ å®‰å…¨æ¼æ´æ‰«æ
â–¡ å‹åŠ›æµ‹è¯•éªŒè¯
â–¡ å®¹é‡è§„åˆ’è¯„ä¼°
â–¡ åº”æ€¥æ¼”ç»ƒ
```

#### âœ… ä»£ç å¼€å‘è§„èŒƒ



```java
// 1. èµ„æºå¿…é¡»å…³é—­
try (Connection conn = dataSource.getConnection()) {
    // ä½¿ç”¨è¿æ¥
} // è‡ªåŠ¨å…³é—­

// 2. åˆç†ä½¿ç”¨ç¼“å­˜
@Cacheable(value = "user", key = "#id", unless = "#result == null")
public User getUser(Long id) {
    return userMapper.selectById(id);
}

// 3. å¼‚å¸¸è¦æ•è·å¹¶è®°å½•
try {
    // ä¸šåŠ¡é€»è¾‘
} catch (Exception e) {
    log.error("æ“ä½œå¤±è´¥: userId={}", userId, e);
    throw new BizException("æ“ä½œå¤±è´¥", e);
}

// 4. ThreadLocalå¿…é¡»æ¸…ç†
try {
    context.set(user);
    // ä¸šåŠ¡é€»è¾‘
} finally {
    context.remove();  // å¿…é¡»æ¸…ç†
}

// 5. è¶…æ—¶è¦è®¾ç½®
@HystrixCommand(
    fallbackMethod = "getUserFallback",
    commandProperties = {
        @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "3000")
    }
)
public User getUser(Long id) {
    return restTemplate.getForObject("http://user-service/users/" + id, User.class);
}
```

#### âœ… é…ç½®ç®¡ç†è§„èŒƒ



```yaml
# 1. æ•æ„Ÿä¿¡æ¯åŠ å¯†

spring:
  datasource:
    password: ENC(encrypted_password)  # åŠ å¯†åçš„å¯†ç 

# 2. ç¯å¢ƒåŒºåˆ†æ˜ç¡®

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}  # ç¯å¢ƒå˜é‡æ§åˆ¶

# 3. è¶…æ—¶åˆç†è®¾ç½®

ribbon:
  ConnectTimeout: 1000    # è¿æ¥è¶…æ—¶
  ReadTimeout: 3000       # è¯»å–è¶…æ—¶
  
hystrix:
  command:
    default:
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 5000  # ç†”æ–­è¶…æ—¶

# 4. ç›‘æ§å¿…é¡»å¼€å¯

management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
```

### 9.6 å­¦ä¹ å»ºè®®



**æ–°æ‰‹å­¦ä¹ è·¯å¾„**ï¼š

```
ç¬¬1é˜¶æ®µï¼šç†è§£åŸºç¡€æ¦‚å¿µï¼ˆ1-2å‘¨ï¼‰
    â†“
- ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°
- ä¸ºä»€ä¹ˆéœ€è¦æ³¨å†Œä¸­å¿ƒ
- å¸¸è§æ³¨å†Œä¸­å¿ƒå¯¹æ¯”
    â†“
åŠ¨æ‰‹ï¼šæ­å»ºEureka/Nacosç¯å¢ƒ

ç¬¬2é˜¶æ®µï¼šæŒæ¡å¸¸è§é—®é¢˜ï¼ˆ2-3å‘¨ï¼‰
    â†“
- æœåŠ¡æ³¨å†Œå¤±è´¥æ€ä¹ˆåŠ
- æœåŠ¡å‘ç°å»¶è¿Ÿå¦‚ä½•ä¼˜åŒ–
- é…ç½®é”™è¯¯å¦‚ä½•æ’æŸ¥
    â†“
åŠ¨æ‰‹ï¼šæ¨¡æ‹Ÿæ•…éšœå¹¶è§£å†³

ç¬¬3é˜¶æ®µï¼šæ·±å…¥åŸç†å’Œä¼˜åŒ–ï¼ˆ1ä¸ªæœˆï¼‰
    â†“
- ç½‘ç»œåˆ†åŒºå¤„ç†æœºåˆ¶
- æ€§èƒ½ç“¶é¢ˆåˆ†ææ–¹æ³•
- å†…å­˜æ³„éœ²æ’æŸ¥æŠ€å·§
    â†“
åŠ¨æ‰‹ï¼šæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

ç¬¬4é˜¶æ®µï¼šç”Ÿäº§å®è·µç»éªŒï¼ˆæŒç»­ï¼‰
    â†“
- ç›‘æ§å‘Šè­¦ä½“ç³»å»ºè®¾
- åº”æ€¥å“åº”æµç¨‹åˆ¶å®š
- æ•…éšœå¤ç›˜å’Œæ”¹è¿›
    â†“
æ€»ç»“ï¼šå½¢æˆè‡ªå·±çš„æœ€ä½³å®è·µ
```

**å®è·µé¡¹ç›®å»ºè®®**ï¼š

```
ğŸ¯ é¡¹ç›®1ï¼šç”µå•†å¾®æœåŠ¡ç³»ç»Ÿ
æœåŠ¡ï¼šç”¨æˆ·ã€å•†å“ã€è®¢å•ã€æ”¯ä»˜
ç»ƒä¹ ï¼šæœåŠ¡æ³¨å†Œã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§

ğŸ¯ é¡¹ç›®2ï¼šé«˜å¯ç”¨æ³¨å†Œä¸­å¿ƒ
æ­å»ºï¼šEureka/Nacosé›†ç¾¤
ç»ƒä¹ ï¼šæ•…éšœè½¬ç§»ã€æ•°æ®åŒæ­¥ã€ç½‘ç»œåˆ†åŒº

ğŸ¯ é¡¹ç›®3ï¼šç›‘æ§å‘Šè­¦å¹³å°
é›†æˆï¼šSkyWalking + Prometheus + Grafana
ç»ƒä¹ ï¼šé“¾è·¯è¿½è¸ªã€æŒ‡æ ‡ç›‘æ§ã€å‘Šè­¦é…ç½®
```

---

## ğŸ’¡ ç»“è¯­



å¾®æœåŠ¡çš„é—®é¢˜è¯Šæ–­å’Œè§£å†³æ˜¯ä¸€ä¸ª**å®è·µæ€§å¾ˆå¼º**çš„æŠ€èƒ½ï¼Œéœ€è¦ï¼š

1. **æ‰å®çš„åŸºç¡€**ï¼šç†è§£åŸç†æ‰èƒ½å¿«é€Ÿå®šä½é—®é¢˜
2. **ä¸°å¯Œçš„ç»éªŒ**ï¼šè§è¿‡çš„é—®é¢˜è¶Šå¤šï¼Œè§£å†³è¶Šå¿«
3. **å·¥å…·çš„ç†Ÿç»ƒ**ï¼šå–„ç”¨å·¥å…·äº‹åŠåŠŸå€
4. **æŒç»­çš„å­¦ä¹ **ï¼šæŠ€æœ¯åœ¨è¿›æ­¥ï¼Œé—®é¢˜åœ¨å˜åŒ–

è®°ä½ï¼š**æ²¡æœ‰å®Œç¾çš„ç³»ç»Ÿï¼Œåªæœ‰ä¸æ–­æ”¹è¿›çš„ç³»ç»Ÿ**ã€‚æ¯æ¬¡æ•…éšœéƒ½æ˜¯å­¦ä¹ å’Œæå‡çš„æœºä¼šï¼

ğŸ”– **æœ¬ç« æ ¸å¿ƒ**ï¼š
- æœåŠ¡æ³¨å†Œå¤±è´¥ â†’ æŸ¥åœ°å€ã€ç½‘ç»œã€é…ç½®
- æœåŠ¡å‘ç°å»¶è¿Ÿ â†’ è°ƒç¼“å­˜ã€ç”¨æ¨é€ã€åŠ æ£€æŸ¥
- ç½‘ç»œåˆ†åŒº â†’ å¤šèŠ‚ç‚¹ã€é™çº§ã€ç†”æ–­
- æ•°æ®ä¸ä¸€è‡´ â†’ ç¼“å­˜ç­–ç•¥ã€æ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é”
- æ€§èƒ½ç“¶é¢ˆ â†’ ç›‘æ§å®šä½ã€é’ˆå¯¹ä¼˜åŒ–
- å†…å­˜æ³„éœ² â†’ é›†åˆæ¸…ç†ã€èµ„æºå…³é—­ã€å·¥å…·åˆ†æ
- é…ç½®é”™è¯¯ â†’ æ ¼å¼è§„èŒƒã€ç¯å¢ƒåˆ†ç¦»ã€å¯åŠ¨éªŒè¯
- ç‰ˆæœ¬å…¼å®¹ â†’ ç°åº¦å‘å¸ƒã€å‘åå…¼å®¹ã€å¥‘çº¦æµ‹è¯•

ğŸ“š **æ¨èé˜…è¯»**ï¼š
- ã€ŠSpring Cloudå¾®æœåŠ¡å®æˆ˜ã€‹
- ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹
- ã€ŠSREï¼šGoogleè¿ç»´è§£å¯†ã€‹