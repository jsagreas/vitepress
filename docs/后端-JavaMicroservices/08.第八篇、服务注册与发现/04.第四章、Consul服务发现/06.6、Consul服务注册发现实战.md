---
title: 6ã€ConsulæœåŠ¡æ³¨å†Œå‘ç°å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [Spring Cloud Consulé›†æˆåŸºç¡€](#1-Spring-Cloud-Consulé›†æˆåŸºç¡€)
2. [æœåŠ¡æ³¨å†Œé…ç½®è¯¦è§£](#2-æœåŠ¡æ³¨å†Œé…ç½®è¯¦è§£)
3. [å¥åº·æ£€æŸ¥é…ç½®](#3-å¥åº·æ£€æŸ¥é…ç½®)
4. [æœåŠ¡å‘ç°å®ç°](#4-æœåŠ¡å‘ç°å®ç°)
5. [æ ‡ç­¾Tagsä½¿ç”¨æŠ€å·§](#5-æ ‡ç­¾Tagsä½¿ç”¨æŠ€å·§)
6. [å…ƒæ•°æ®é…ç½®ä¸åº”ç”¨](#6-å…ƒæ•°æ®é…ç½®ä¸åº”ç”¨)
7. [è´Ÿè½½å‡è¡¡é›†æˆ](#7-è´Ÿè½½å‡è¡¡é›†æˆ)
8. [æ•…éšœè½¬ç§»å¤„ç†](#8-æ•…éšœè½¬ç§»å¤„ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ Spring Cloud Consulé›†æˆåŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Spring Cloud Consul

ğŸ¯ **é€šä¿—ç†è§£**ï¼šSpring Cloud Consulå°±åƒæ˜¯å¸®ä½ çš„å¾®æœåŠ¡è‡ªåŠ¨"æŠ¥åˆ°"å’Œ"æ‰¾æœ‹å‹"çš„æ™ºèƒ½åŠ©æ‰‹

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
æƒ³è±¡ä¸€ä¸ªå¤§å‹å•†åœºï¼š
- æ¯ä¸ªåº—é“ºå¼€ä¸šæ—¶è¦åˆ°æ€»å°ç™»è®°ï¼ˆæœåŠ¡æ³¨å†Œï¼‰
- é¡¾å®¢æƒ³æ‰¾æŸç±»åº—é“ºæ—¶æŸ¥è¯¢æ€»å°ï¼ˆæœåŠ¡å‘ç°ï¼‰
- æ€»å°ä¼šå®šæœŸæ£€æŸ¥åº—é“ºæ˜¯å¦è¿˜åœ¨è¥ä¸šï¼ˆå¥åº·æ£€æŸ¥ï¼‰

å¾®æœåŠ¡ä¸–ç•Œï¼š
- æœåŠ¡å¯åŠ¨æ—¶å‘Consulæ³¨å†Œ
- å…¶ä»–æœåŠ¡é€šè¿‡ConsulæŸ¥æ‰¾éœ€è¦çš„æœåŠ¡
- ConsulæŒç»­ç›‘æ§æœåŠ¡å¥åº·çŠ¶æ€
```

**ğŸ”¸ æ ¸å¿ƒä»·å€¼**
```
æœåŠ¡æ³¨å†Œï¼šè‡ªåŠ¨æŠŠæœåŠ¡ä¿¡æ¯ç™»è®°åˆ°Consul
æœåŠ¡å‘ç°ï¼šå¿«é€Ÿæ‰¾åˆ°éœ€è¦è°ƒç”¨çš„æœåŠ¡åœ°å€
å¥åº·æ£€æŸ¥ï¼šå®æ—¶ç›‘æ§æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
é…ç½®ç®¡ç†ï¼šé›†ä¸­ç®¡ç†æœåŠ¡é…ç½®ä¿¡æ¯
```

### 1.2 å¿«é€Ÿé›†æˆæ­¥éª¤

**ğŸ“¦ æ·»åŠ ä¾èµ–**

é¦–å…ˆåœ¨ä½ çš„å¾®æœåŠ¡é¡¹ç›®ä¸­å¼•å…¥Consulä¾èµ–ï¼Œå°±åƒç»™é¡¹ç›®å®‰è£…ä¸€ä¸ª"è‡ªåŠ¨æ³¨å†Œ"çš„æ’ä»¶ï¼š

```xml
<!-- pom.xml -->
<dependencies>
    <!-- Spring Cloud Consulæ ¸å¿ƒä¾èµ– -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-consul-discovery</artifactId>
    </dependency>
    
    <!-- å¥åº·æ£€æŸ¥éœ€è¦çš„Actuator -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-actuator</artifactId>
    </dependency>
</dependencies>
```

**âš™ï¸ åŸºç¡€é…ç½®**

ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­å‘Šè¯‰æœåŠ¡"Consulåœ¨å“ªé‡Œ"ï¼Œå°±åƒå‘Šè¯‰å‘˜å·¥"æ€»å°åœ¨å‡ æ¥¼"ï¼š

```yaml
# application.yml
spring:
  application:
    name: user-service  # æœåŠ¡åç§°ï¼Œç›¸å½“äºå•†é“ºåå­—
  cloud:
    consul:
      host: localhost   # ConsulæœåŠ¡å™¨åœ°å€
      port: 8500        # Consulç«¯å£
      discovery:
        enabled: true   # å¼€å¯æœåŠ¡å‘ç°
        service-name: ${spring.application.name}  # æ³¨å†Œçš„æœåŠ¡å
        instance-id: ${spring.application.name}:${server.port}  # å®ä¾‹å”¯ä¸€æ ‡è¯†
```

**ğŸ”§ å¯ç”¨æœåŠ¡å‘ç°**

æœ€ååœ¨å¯åŠ¨ç±»åŠ ä¸Šä¸€ä¸ªæ³¨è§£ï¼Œå‘Šè¯‰Spring"æˆ‘è¦ç”¨Consul"ï¼š

```java
@SpringBootApplication
@EnableDiscoveryClient  // è¿™ä¸ªæ³¨è§£å¯ç”¨æœåŠ¡å‘ç°åŠŸèƒ½
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

### 1.3 é›†æˆéªŒè¯

**âœ… éªŒè¯æœåŠ¡æ˜¯å¦æ³¨å†ŒæˆåŠŸ**

å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

**æ–¹æ³•ä¸€ï¼šè®¿é—®Consul UIç•Œé¢**
```
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8500/ui
åœ¨Servicesé¡µé¢æŸ¥çœ‹æ˜¯å¦å‡ºç°ä½ çš„æœåŠ¡å
å¦‚æœçœ‹åˆ°user-serviceä¸”çŠ¶æ€ä¸ºç»¿è‰²ï¼Œè¯´æ˜æ³¨å†ŒæˆåŠŸï¼
```

**æ–¹æ³•äºŒï¼šé€šè¿‡æ—¥å¿—ç¡®è®¤**
```
å¯åŠ¨æ—¥å¿—ä¸­ä¼šçœ‹åˆ°ç±»ä¼¼ä¿¡æ¯ï¼š
âœ… Registering service with consul: NewService{id='user-service:8080'...}
âœ… Registration succeeded for service 'user-service'

å¦‚æœçœ‹åˆ°è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜æ³¨å†ŒæˆåŠŸ
```

**æ–¹æ³•ä¸‰ï¼šè°ƒç”¨Consul APIæ£€æŸ¥**
```bash
# æŸ¥è¯¢æ‰€æœ‰æœåŠ¡
curl http://localhost:8500/v1/catalog/services

# æŸ¥è¯¢ç‰¹å®šæœåŠ¡
curl http://localhost:8500/v1/catalog/service/user-service
```

---

## 2. ğŸ“ æœåŠ¡æ³¨å†Œé…ç½®è¯¦è§£


### 2.1 æœåŠ¡å®ä¾‹é…ç½®

**ğŸ¯ è®©Consulå‡†ç¡®è¯†åˆ«ä½ çš„æœåŠ¡**

æœåŠ¡æ³¨å†Œå°±åƒå¡«å†™ä¸€ä»½è¯¦ç»†çš„"åº—é“ºç™»è®°è¡¨"ï¼Œä¿¡æ¯è¶Šå‡†ç¡®ï¼Œåˆ«äººè¶Šå®¹æ˜“æ‰¾åˆ°ä½ ï¼š

```yaml
spring:
  cloud:
    consul:
      discovery:
        # åŸºç¡€ä¿¡æ¯é…ç½®
        service-name: user-service        # æœåŠ¡åç§°
        hostname: 192.168.1.100          # æœåŠ¡ä¸»æœºåœ°å€
        port: 8080                       # æœåŠ¡ç«¯å£
        instance-id: user-service-001    # å®ä¾‹å”¯ä¸€ID
        
        # å¥åº·æ£€æŸ¥è·¯å¾„
        health-check-path: /actuator/health
        health-check-interval: 10s       # æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
        health-check-timeout: 5s         # è¶…æ—¶æ—¶é—´5ç§’
        
        # æ˜¯å¦ä¼˜å…ˆä½¿ç”¨IPåœ°å€
        prefer-ip-address: true          # trueè¡¨ç¤ºç”¨IPï¼Œfalseç”¨hostname
        
        # å®ä¾‹åˆ†ç»„é…ç½®
        instance-zone: zone-a            # å®ä¾‹æ‰€åœ¨åŒºåŸŸ
```

**ğŸ’¡ é…ç½®é¡¹è¯¦è§£**

| é…ç½®é¡¹ | **è¯´æ˜** | **ä½¿ç”¨å»ºè®®** |
|--------|---------|------------|
| `service-name` | æœåŠ¡çš„é€»è¾‘åç§° | åŒä¸€ç±»æœåŠ¡ç”¨ç›¸åŒåç§°ï¼Œå¦‚user-service |
| `instance-id` | å®ä¾‹çš„å”¯ä¸€æ ‡è¯† | å»ºè®®æ ¼å¼ï¼šæœåŠ¡å:ç«¯å£ï¼Œå¦‚user-service:8080 |
| `prefer-ip-address` | æ˜¯å¦ä½¿ç”¨IPæ³¨å†Œ | å®¹å™¨ç¯å¢ƒå»ºè®®trueï¼Œä¸»æœºåå¯èƒ½ä¸å¯è¾¾ |
| `health-check-interval` | å¥åº·æ£€æŸ¥é¢‘ç‡ | å»ºè®®10-30ç§’ï¼Œè¿‡é¢‘å½±å“æ€§èƒ½ |

### 2.2 å¤šå®ä¾‹éƒ¨ç½²é…ç½®

**ğŸ”„ åŒä¸€ä¸ªæœåŠ¡å¯åŠ¨å¤šä¸ªå®ä¾‹**

å°±åƒåŒä¸€ä¸ªè¿é”åº—å¼€äº†å¤šå®¶åˆ†åº—ï¼Œæ¯ä¸ªåˆ†åº—éƒ½è¦å•ç‹¬ç™»è®°ï¼š

```yaml
# å®ä¾‹1é…ç½® (application-instance1.yml)
server:
  port: 8081

spring:
  cloud:
    consul:
      discovery:
        instance-id: ${spring.application.name}:8081
        port: 8081

# å®ä¾‹2é…ç½® (application-instance2.yml)
server:
  port: 8082

spring:
  cloud:
    consul:
      discovery:
        instance-id: ${spring.application.name}:8082
        port: 8082
```

**ğŸš€ å¯åŠ¨å¤šå®ä¾‹**
```bash
# å¯åŠ¨å®ä¾‹1
java -jar user-service.jar --spring.profiles.active=instance1

# å¯åŠ¨å®ä¾‹2  
java -jar user-service.jar --spring.profiles.active=instance2
```

### 2.3 åŠ¨æ€ç«¯å£é…ç½®

**âš™ï¸ è®©æœåŠ¡è‡ªåŠ¨é€‰æ‹©å¯ç”¨ç«¯å£**

æœ‰æ—¶å€™ä½ ä¸æƒ³å›ºå®šç«¯å£ï¼Œå¸Œæœ›ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼Œå°±åƒ"éšä¾¿æ‰¾ä¸ªç©ºä½å"ï¼š

```yaml
server:
  port: 0  # 0è¡¨ç¤ºéšæœºç«¯å£

spring:
  cloud:
    consul:
      discovery:
        instance-id: ${spring.application.name}:${random.value}
        # ä½¿ç”¨éšæœºå€¼ä½œä¸ºIDï¼Œé¿å…å†²çª
        
        # é‡è¦ï¼å‘Šè¯‰ConsulçœŸå®ç«¯å£
        port: ${server.port}
```

**âš ï¸ åŠ¨æ€ç«¯å£æ³¨æ„äº‹é¡¹**
```
ä¼˜ç‚¹ï¼š
âœ… é¿å…ç«¯å£å†²çª
âœ… æ–¹ä¾¿å¿«é€Ÿæ‰©å®¹
âœ… é€‚åˆå®¹å™¨åŒ–éƒ¨ç½²

æ³¨æ„äº‹é¡¹ï¼š
â— éœ€è¦é…åˆæœåŠ¡å‘ç°ä½¿ç”¨
â— æ—¥å¿—ä¸­è¦è®°å½•å®é™…ç«¯å£
â— æœ¬åœ°è°ƒè¯•å¯èƒ½ä¸æ–¹ä¾¿
```

---

## 3. ğŸ¥ å¥åº·æ£€æŸ¥é…ç½®


### 3.1 å¥åº·æ£€æŸ¥çš„é‡è¦æ€§

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥**

æƒ³è±¡ä¸€ä¸ªå¤–å–å¹³å°ï¼Œå¦‚æœä¸æ£€æŸ¥é¤å…æ˜¯å¦è¥ä¸šå°±æ´¾å•ï¼Œé¡¾å®¢ä¼šæ”¶åˆ°"å•†å®¶å·²æ‰“çƒŠ"çš„æç¤ºã€‚å¥åº·æ£€æŸ¥å°±æ˜¯é˜²æ­¢è¿™ç§æƒ…å†µï¼š

```
æ²¡æœ‰å¥åº·æ£€æŸ¥çš„é—®é¢˜ï¼š
âŒ æœåŠ¡å·²æŒ‚æ‰ï¼Œä½†Consulè¿˜æ¨èç»™è°ƒç”¨æ–¹
âŒ è°ƒç”¨æ–¹è¯·æ±‚å¤±è´¥ï¼Œç”¨æˆ·ä½“éªŒå·®
âŒ é—®é¢˜éš¾ä»¥åŠæ—¶å‘ç°

æœ‰å¥åº·æ£€æŸ¥çš„å¥½å¤„ï¼š
âœ… æœåŠ¡å¼‚å¸¸ç«‹å³è¢«å‘ç°
âœ… è‡ªåŠ¨å‰”é™¤ä¸å¥åº·çš„å®ä¾‹
âœ… æµé‡åªè½¬å‘åˆ°å¥åº·å®ä¾‹
```

### 3.2 HTTPå¥åº·æ£€æŸ¥é…ç½®

**ğŸ” æœ€å¸¸ç”¨çš„å¥åº·æ£€æŸ¥æ–¹å¼**

å°±åƒå®šæœŸæ‰“ç”µè¯ç¡®è®¤åº—é“ºæ˜¯å¦è¥ä¸šï¼ŒHTTPæ£€æŸ¥é€šè¿‡è®¿é—®ç‰¹å®šæ¥å£åˆ¤æ–­æœåŠ¡çŠ¶æ€ï¼š

```yaml
spring:
  cloud:
    consul:
      discovery:
        # HTTPå¥åº·æ£€æŸ¥é…ç½®
        health-check-path: /actuator/health  # å¥åº·æ£€æŸ¥æ¥å£
        health-check-interval: 15s           # æ¯15ç§’æ£€æŸ¥ä¸€æ¬¡
        health-check-timeout: 3s             # è¶…æ—¶æ—¶é—´3ç§’
        health-check-critical-timeout: 30s   # å¤±è´¥30ç§’åç§»é™¤æœåŠ¡
```

**ğŸ“Š å¥åº·æ£€æŸ¥å‚æ•°è¯¦è§£**

| å‚æ•° | **å«ä¹‰** | **æ¨èå€¼** | **è¯´æ˜** |
|------|---------|-----------|---------|
| `health-check-interval` | æ£€æŸ¥é¢‘ç‡ | `10-30ç§’` | å¤ªé¢‘ç¹å½±å“æ€§èƒ½ï¼Œå¤ªæ…¢å‘ç°ä¸åŠæ—¶ |
| `health-check-timeout` | è¶…æ—¶æ—¶é—´ | `3-5ç§’` | ç½‘ç»œå»¶è¿Ÿçš„ç¼“å†²æ—¶é—´ |
| `health-check-critical-timeout` | å¤±è´¥åå¤šä¹…ç§»é™¤ | `30-60ç§’` | ç»™æœåŠ¡æ¢å¤çš„æœºä¼š |

### 3.3 è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é€»è¾‘

**ğŸ”§ å®ç°ä¸šåŠ¡çº§çš„å¥åº·æ£€æŸ¥**

é™¤äº†æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œè¿˜è¦æ£€æŸ¥ä¸šåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥ã€ç¼“å­˜å¯ç”¨æ€§ï¼š

```java
@Component
public class CustomHealthIndicator implements HealthIndicator {
    
    @Autowired
    private DataSource dataSource;
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Override
    public Health health() {
        try {
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥
            checkDatabase();
            
            // æ£€æŸ¥Redisè¿æ¥
            checkRedis();
            
            // æ£€æŸ¥å…¶ä»–ä¾èµ–æœåŠ¡
            checkDependencies();
            
            // æ‰€æœ‰æ£€æŸ¥é€šè¿‡
            return Health.up()
                .withDetail("status", "æ‰€æœ‰ä¾èµ–æ­£å¸¸")
                .build();
                
        } catch (Exception e) {
            // ä»»ä½•æ£€æŸ¥å¤±è´¥éƒ½è¿”å›DOWN
            return Health.down()
                .withDetail("error", e.getMessage())
                .build();
        }
    }
    
    private void checkDatabase() throws Exception {
        // æ‰§è¡Œç®€å•SQLéªŒè¯è¿æ¥
        dataSource.getConnection().createStatement()
            .execute("SELECT 1");
    }
    
    private void checkRedis() {
        // ping Redis
        redisTemplate.getConnectionFactory()
            .getConnection().ping();
    }
    
    private void checkDependencies() {
        // æ£€æŸ¥ä¾èµ–çš„å…¶ä»–æœåŠ¡æ˜¯å¦å¯ç”¨
    }
}
```

### 3.4 å¥åº·æ£€æŸ¥ç›‘æ§

**ğŸ“ˆ å®æ—¶æŒæ¡æœåŠ¡å¥åº·çŠ¶æ€**

é€šè¿‡æš´éœ²å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹æœåŠ¡å¥åº·è¯¦æƒ…ï¼š

```yaml
# æš´éœ²å¥åº·æ£€æŸ¥ç«¯ç‚¹
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
```

**è®¿é—®å¥åº·æ£€æŸ¥æ¥å£ï¼š**
```bash
# æŸ¥çœ‹æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8080/actuator/health

# è¿”å›ç¤ºä¾‹
{
  "status": "UP",
  "components": {
    "consul": {
      "status": "UP",
      "details": {
        "services": ["user-service", "order-service"]
      }
    },
    "db": {
      "status": "UP",
      "details": {
        "database": "MySQL",
        "validationQuery": "isValid()"
      }
    },
    "custom": {
      "status": "UP",
      "details": {
        "message": "æ‰€æœ‰ä¾èµ–æ­£å¸¸"
      }
    }
  }
}
```

---

## 4. ğŸ” æœåŠ¡å‘ç°å®ç°


### 4.1 æœåŠ¡å‘ç°çš„ä¸¤ç§æ–¹å¼

**ğŸ¯ æ€ä¹ˆæ‰¾åˆ°éœ€è¦è°ƒç”¨çš„æœåŠ¡**

å°±åƒä½ è¦æ‰¾å•†åœºé‡Œçš„æŸä¸ªåº—é“ºï¼Œå¯ä»¥é—®æ€»å°ï¼Œä¹Ÿå¯ä»¥çœ‹åœ°å›¾ï¼š

**æ–¹å¼ä¸€ï¼šDiscoveryClientï¼ˆç¼–ç¨‹å¼å‘ç°ï¼‰**
```
å°±åƒä¸»åŠ¨å»æ€»å°è¯¢é—®ï¼š
"è¯·é—®user-serviceåœ¨å“ªé‡Œï¼Ÿ"
æ€»å°ç»™ä½ ä¸€ä¸ªåœ°å€åˆ—è¡¨ï¼Œä½ è‡ªå·±é€‰ä¸€ä¸ª
```

**æ–¹å¼äºŒï¼šLoadBalancerClientï¼ˆè´Ÿè½½å‡è¡¡å‘ç°ï¼‰**
```
å°±åƒè®©æ€»å°ç›´æ¥å®‰æ’ï¼š
"è¯·å¸®æˆ‘æ‰¾ä¸€ä¸ªuser-service"
æ€»å°æ™ºèƒ½åˆ†é…ä¸€ä¸ªæœ€åˆé€‚çš„åœ°å€
```

### 4.2 ä½¿ç”¨DiscoveryClientå‘ç°æœåŠ¡

**ğŸ“‹ æ‰‹åŠ¨æŸ¥è¯¢å’Œé€‰æ‹©æœåŠ¡å®ä¾‹**

```java
@Service
public class UserServiceClient {
    
    @Autowired
    private DiscoveryClient discoveryClient;
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
     */
    public User getUserById(Long userId) {
        // 1. ä»Consulè·å–user-serviceçš„æ‰€æœ‰å®ä¾‹
        List<ServiceInstance> instances = 
            discoveryClient.getInstances("user-service");
        
        // 2. æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨å®ä¾‹
        if (instances.isEmpty()) {
            throw new RuntimeException("user-serviceæœåŠ¡ä¸å¯ç”¨");
        }
        
        // 3. ç®€å•é€‰æ‹©ç¬¬ä¸€ä¸ªå®ä¾‹ï¼ˆå®é™…åº”è¯¥ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰
        ServiceInstance instance = instances.get(0);
        
        // 4. æ„å»ºè¯·æ±‚URL
        String url = String.format("http://%s:%d/users/%d",
            instance.getHost(),
            instance.getPort(),
            userId);
        
        // 5. å‘èµ·HTTPè¯·æ±‚
        return restTemplate.getForObject(url, User.class);
    }
    
    /**
     * è·å–æ‰€æœ‰å¯ç”¨çš„æœåŠ¡åˆ—è¡¨
     */
    public List<String> getAllServices() {
        return discoveryClient.getServices();
    }
}
```

**ğŸ’¡ å®ä¾‹ä¿¡æ¯è¯¦è§£**
```java
// ServiceInstanceåŒ…å«çš„ä¿¡æ¯
ServiceInstance instance = instances.get(0);

instance.getServiceId();    // æœåŠ¡åï¼šuser-service
instance.getHost();          // ä¸»æœºåœ°å€ï¼š192.168.1.100
instance.getPort();          // ç«¯å£ï¼š8080
instance.getUri();           // å®Œæ•´URIï¼šhttp://192.168.1.100:8080
instance.getMetadata();      // å…ƒæ•°æ®ï¼šç‰ˆæœ¬ã€åŒºåŸŸç­‰ä¿¡æ¯
instance.isSecure();         // æ˜¯å¦HTTPS
```

### 4.3 ä½¿ç”¨Ribbonè´Ÿè½½å‡è¡¡

**âš–ï¸ æ™ºèƒ½åˆ†é…è¯·æ±‚åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹**

Ribbonå°±åƒä¸€ä¸ªæ™ºèƒ½çš„"æœåŠ¡è°ƒåº¦å‘˜"ï¼Œè‡ªåŠ¨å¸®ä½ é€‰æ‹©æœ€åˆé€‚çš„æœåŠ¡å®ä¾‹ï¼š

```java
@Configuration
public class RestTemplateConfig {
    
    @Bean
    @LoadBalanced  // è¿™ä¸ªæ³¨è§£è®©RestTemplateå…·å¤‡è´Ÿè½½å‡è¡¡èƒ½åŠ›
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

@Service
public class OrderService {
    
    @Autowired
    @LoadBalanced
    private RestTemplate restTemplate;
    
    /**
     * è°ƒç”¨ç”¨æˆ·æœåŠ¡ - è‡ªåŠ¨è´Ÿè½½å‡è¡¡
     */
    public User getUser(Long userId) {
        // ç¥å¥‡çš„åœ°æ–¹ï¼šç›´æ¥ç”¨æœåŠ¡åï¼Œä¸éœ€è¦IPå’Œç«¯å£ï¼
        // Ribbonä¼šè‡ªåŠ¨ï¼š
        // 1. ä»Consulè·å–user-serviceçš„æ‰€æœ‰å®ä¾‹
        // 2. é€‰æ‹©ä¸€ä¸ªå¥åº·çš„å®ä¾‹
        // 3. æ›¿æ¢æœåŠ¡åä¸ºå®é™…çš„IP:PORT
        String url = "http://user-service/users/" + userId;
        
        return restTemplate.getForObject(url, User.class);
    }
}
```

**ğŸ”„ è´Ÿè½½å‡è¡¡ç­–ç•¥**

Ribbonæ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå°±åƒä¸åŒçš„"é€‰æ‹©è§„åˆ™"ï¼š

```yaml
# é…ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥
user-service:
  ribbon:
    # å¯é€‰ç­–ç•¥ï¼š
    # 1. RoundRobinRule - è½®è¯¢ï¼ˆé»˜è®¤ï¼‰
    # 2. RandomRule - éšæœº
    # 3. RetryRule - é‡è¯•
    # 4. WeightedResponseTimeRule - å“åº”æ—¶é—´åŠ æƒ
    # 5. BestAvailableRule - æœ€ä½å¹¶å‘
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule
```

**ç­–ç•¥å¯¹æ¯”ç†è§£ï¼š**
```
è½®è¯¢ç­–ç•¥ï¼ˆRoundRobinRuleï¼‰ï¼š
å°±åƒæ’é˜Ÿä¹°ç¥¨ï¼Œæ¯ä¸ªçª—å£è½®æµæœåŠ¡
å®ä¾‹1 â†’ å®ä¾‹2 â†’ å®ä¾‹3 â†’ å®ä¾‹1...

éšæœºç­–ç•¥ï¼ˆRandomRuleï¼‰ï¼š
å°±åƒæŠ½ç­¾ï¼Œéšæœºé€‰ä¸€ä¸ªå®ä¾‹
å¯èƒ½è¿ç»­é€‰ä¸­åŒä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½å¾ˆåˆ†æ•£

å“åº”æ—¶é—´åŠ æƒï¼ˆWeightedResponseTimeRuleï¼‰ï¼š
å°±åƒä¼˜å…ˆå»æ’é˜Ÿå°‘çš„çª—å£
å“åº”å¿«çš„å®ä¾‹ä¼šè¢«æ›´å¤šé€‰æ‹©
```

### 4.4 Feignå£°æ˜å¼è°ƒç”¨

**ğŸ¨ æœ€ä¼˜é›…çš„æœåŠ¡è°ƒç”¨æ–¹å¼**

Feignè®©æœåŠ¡è°ƒç”¨å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ï¼Œä¸éœ€è¦å†™URLæ‹¼æ¥å’ŒHTTPè¯·æ±‚ä»£ç ï¼š

```java
// 1. å®šä¹‰Feignå®¢æˆ·ç«¯æ¥å£
@FeignClient(name = "user-service")  // æŒ‡å®šè¦è°ƒç”¨çš„æœåŠ¡å
public interface UserServiceClient {
    
    /**
     * è°ƒç”¨user-serviceçš„è·å–ç”¨æˆ·æ¥å£
     * å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ï¼
     */
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    @GetMapping("/users")
    List<User> getAllUsers();
    
    @PostMapping("/users")
    User createUser(@RequestBody User user);
}

// 2. åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨
@Service
public class OrderService {
    
    @Autowired
    private UserServiceClient userServiceClient;
    
    public void createOrder(Long userId) {
        // ç›´æ¥è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•
        // Feignä¼šè‡ªåŠ¨ï¼š
        // 1. ä»Consulå‘ç°user-service
        // 2. è´Ÿè½½å‡è¡¡é€‰æ‹©å®ä¾‹
        // 3. å‘èµ·HTTPè¯·æ±‚
        // 4. å¤„ç†å“åº”è½¬æ¢ä¸ºå¯¹è±¡
        User user = userServiceClient.getUserById(userId);
        
        // ä¸šåŠ¡é€»è¾‘
        System.out.println("ä¸ºç”¨æˆ· " + user.getName() + " åˆ›å»ºè®¢å•");
    }
}
```

**âš™ï¸ Feigné…ç½®ä¼˜åŒ–**
```yaml
feign:
  client:
    config:
      default:  # å…¨å±€é…ç½®
        connectTimeout: 5000      # è¿æ¥è¶…æ—¶5ç§’
        readTimeout: 10000        # è¯»å–è¶…æ—¶10ç§’
        loggerLevel: BASIC        # æ—¥å¿—çº§åˆ«
      user-service:  # ç‰¹å®šæœåŠ¡é…ç½®
        connectTimeout: 3000      # å¯¹user-serviceçš„è¶…æ—¶è®¾ç½®
        readTimeout: 5000
```

---

## 5. ğŸ·ï¸ æ ‡ç­¾Tagsä½¿ç”¨æŠ€å·§


### 5.1 æ ‡ç­¾çš„ä½œç”¨

**ğŸ¯ ç»™æœåŠ¡æ‰“ä¸Š"ç‰¹å¾æ ‡è®°"**

æ ‡ç­¾å°±åƒå•†å“çš„æ ‡ç­¾ï¼Œå¸®åŠ©å¿«é€Ÿè¯†åˆ«å’Œåˆ†ç±»ï¼š

```
å®é™…åº”ç”¨åœºæ™¯ï¼š
ğŸ“ ç¯å¢ƒåŒºåˆ†ï¼šdevã€testã€prod
ğŸ“ ç‰ˆæœ¬æ ‡è¯†ï¼šv1.0ã€v2.0
ğŸ“ åœ°åŸŸæ ‡è®°ï¼šbeijingã€shanghai
ğŸ“ åŠŸèƒ½ç‰¹æ€§ï¼šæ”¯æŒæ–°åŠŸèƒ½ã€å…¼å®¹æ—§ç‰ˆæœ¬
```

### 5.2 é…ç½®æœåŠ¡æ ‡ç­¾

**ğŸ”§ å¦‚ä½•ç»™æœåŠ¡æ·»åŠ æ ‡ç­¾**

```yaml
spring:
  cloud:
    consul:
      discovery:
        tags:
          - env=prod              # ç¯å¢ƒæ ‡ç­¾
          - version=2.0           # ç‰ˆæœ¬æ ‡ç­¾
          - zone=beijing          # åœ°åŸŸæ ‡ç­¾
          - feature=æ–°æ”¯ä»˜åŠŸèƒ½    # åŠŸèƒ½æ ‡ç­¾
```

**ğŸ’¡ æ ‡ç­¾å‘½åè§„èŒƒ**
```
å»ºè®®æ ¼å¼ï¼škey=value

å¥½çš„ç¤ºä¾‹ï¼š
âœ… env=prod
âœ… version=2.0.1
âœ… datacenter=dc1

é¿å…çš„å†™æ³•ï¼š
âŒ productionï¼ˆæ²¡æœ‰keyï¼‰
âŒ v2ï¼ˆå«ä¹‰ä¸æ˜ç¡®ï¼‰
âŒ beijing_zoneï¼ˆä¸æ˜¯key=valueæ ¼å¼ï¼‰
```

### 5.3 åŸºäºæ ‡ç­¾çš„æœåŠ¡å‘ç°

**ğŸ” æ ¹æ®æ ‡ç­¾ç­›é€‰æœåŠ¡**

å°±åƒåœ¨å•†åœºæ‰¾"åªå–å„¿ç«¥ç©å…·çš„åº—"ï¼Œå¯ä»¥é€šè¿‡æ ‡ç­¾ç²¾ç¡®ç­›é€‰ï¼š

```java
@Service
public class ServiceDiscoveryWithTags {
    
    @Autowired
    private ConsulClient consulClient;
    
    /**
     * æŸ¥æ‰¾ç‰¹å®šç¯å¢ƒçš„æœåŠ¡
     */
    public List<ServiceInstance> findServicesByEnv(String serviceName, String env) {
        // ä»Consulè·å–æœåŠ¡ä¿¡æ¯
        Response<List<HealthService>> response = 
            consulClient.getHealthServices(serviceName, true, null);
        
        List<ServiceInstance> instances = new ArrayList<>();
        
        for (HealthService healthService : response.getValue()) {
            Service service = healthService.getService();
            List<String> tags = service.getTags();
            
            // ç­›é€‰åŒ…å«æŒ‡å®šç¯å¢ƒæ ‡ç­¾çš„æœåŠ¡
            if (tags.contains("env=" + env)) {
                // æ„å»ºServiceInstanceå¯¹è±¡
                ServiceInstance instance = buildInstance(service);
                instances.add(instance);
            }
        }
        
        return instances;
    }
    
    /**
     * æŸ¥æ‰¾ç‰¹å®šç‰ˆæœ¬çš„æœåŠ¡
     */
    public List<ServiceInstance> findServicesByVersion(
            String serviceName, String version) {
        
        // ç±»ä¼¼çš„ç­›é€‰é€»è¾‘
        // æŸ¥æ‰¾tagsä¸­åŒ…å«"version=ç‰ˆæœ¬å·"çš„æœåŠ¡
    }
}
```

### 5.4 æ ‡ç­¾åœ¨ç°åº¦å‘å¸ƒä¸­çš„åº”ç”¨

**ğŸš€ å®ç°é‡‘ä¸é›€å‘å¸ƒ**

é€šè¿‡æ ‡ç­¾å¯ä»¥å®ç°æµé‡çš„ç²¾ç»†åŒ–æ§åˆ¶ï¼š

```
ç°åº¦å‘å¸ƒåœºæ™¯ï¼š
æ—§ç‰ˆæœ¬ï¼šv1.0 (90%æµé‡)  â†’ tags: version=1.0, stable=true
æ–°ç‰ˆæœ¬ï¼šv2.0 (10%æµé‡)  â†’ tags: version=2.0, canary=true

æµé‡åˆ†é…ç­–ç•¥ï¼š
1. æ™®é€šç”¨æˆ· â†’ è·¯ç”±åˆ°v1.0
2. æµ‹è¯•ç”¨æˆ· â†’ è·¯ç”±åˆ°v2.0
3. é€æ­¥å¢åŠ v2.0æµé‡æ¯”ä¾‹
```

**å®ç°ç¤ºä¾‹ï¼š**
```java
@Component
public class GrayReleaseLoadBalancer {
    
    /**
     * ç°åº¦å‘å¸ƒè·¯ç”±è§„åˆ™
     */
    public ServiceInstance chooseInstance(
            List<ServiceInstance> instances, 
            HttpServletRequest request) {
        
        // 1. è·å–ç”¨æˆ·æ ‡è¯†ï¼ˆä»è¯·æ±‚å¤´æˆ–Cookieï¼‰
        String userId = request.getHeader("User-Id");
        
        // 2. åˆ¤æ–­æ˜¯å¦ä¸ºç°åº¦ç”¨æˆ·
        boolean isGrayUser = isInGrayList(userId);
        
        // 3. æ ¹æ®ç”¨æˆ·ç±»å‹é€‰æ‹©æœåŠ¡ç‰ˆæœ¬
        if (isGrayUser) {
            // ç°åº¦ç”¨æˆ·ä½¿ç”¨æ–°ç‰ˆæœ¬
            return findInstanceByTag(instances, "version=2.0");
        } else {
            // æ™®é€šç”¨æˆ·ä½¿ç”¨ç¨³å®šç‰ˆæœ¬
            return findInstanceByTag(instances, "version=1.0");
        }
    }
    
    private ServiceInstance findInstanceByTag(
            List<ServiceInstance> instances, String tag) {
        
        return instances.stream()
            .filter(instance -> hasTag(instance, tag))
            .findFirst()
            .orElse(instances.get(0));  // æ‰¾ä¸åˆ°å°±ç”¨ç¬¬ä¸€ä¸ª
    }
}
```

---

## 6. ğŸ“‹ å…ƒæ•°æ®é…ç½®ä¸åº”ç”¨


### 6.1 å…ƒæ•°æ®æ˜¯ä»€ä¹ˆ

**ğŸ¯ æœåŠ¡çš„"é¢å¤–è¯´æ˜ä¹¦"**

å¦‚æœè¯´æ ‡ç­¾æ˜¯å•†å“çš„åˆ†ç±»æ ‡ç­¾ï¼Œé‚£å…ƒæ•°æ®å°±æ˜¯å•†å“çš„è¯¦ç»†è¯´æ˜ä¹¦ï¼š

```
æ ‡ç­¾ vs å…ƒæ•°æ®ï¼š

æ ‡ç­¾ï¼ˆTagsï¼‰ï¼š
- ç®€å•çš„key=value
- ç”¨äºå¿«é€Ÿåˆ†ç±»å’Œç­›é€‰
- ç¤ºä¾‹ï¼šenv=prod, version=2.0

å…ƒæ•°æ®ï¼ˆMetadataï¼‰ï¼š
- å¤æ‚çš„ç»“æ„åŒ–ä¿¡æ¯
- è¯¦ç»†çš„é…ç½®å’ŒçŠ¶æ€
- ç¤ºä¾‹ï¼šè´Ÿè½½ã€æƒé‡ã€æ‰©å±•ä¿¡æ¯
```

### 6.2 é…ç½®æœåŠ¡å…ƒæ•°æ®

**ğŸ“ æ·»åŠ ä¸°å¯Œçš„æœåŠ¡ä¿¡æ¯**

```yaml
spring:
  cloud:
    consul:
      discovery:
        metadata:
          # åŸºç¡€ä¿¡æ¯
          version: 2.0.1
          group: user-group
          
          # è´Ÿè½½ä¿¡æ¯
          weight: 80              # æƒé‡ï¼Œç”¨äºåŠ æƒè´Ÿè½½å‡è¡¡
          max-connections: 500    # æœ€å¤§è¿æ¥æ•°
          
          # ä¸šåŠ¡ä¿¡æ¯
          region: north           # åœ°åŸŸ
          idc: idc-beijing-1      # æœºæˆ¿
          
          # æ‰©å±•ä¿¡æ¯
          maintainer: zhangsan    # ç»´æŠ¤äºº
          deploy-time: 2024-01-10 # éƒ¨ç½²æ—¶é—´
          
          # ä¸šåŠ¡ç‰¹æ€§
          support-new-api: true   # æ˜¯å¦æ”¯æŒæ–°API
          database-type: mysql    # ä½¿ç”¨çš„æ•°æ®åº“ç±»å‹
```

### 6.3 ä½¿ç”¨å…ƒæ•°æ®å®ç°é«˜çº§è·¯ç”±

**ğŸ”€ åŸºäºå…ƒæ•°æ®çš„æ™ºèƒ½è·¯ç”±**

```java
@Component
public class MetadataBasedRouter {
    
    @Autowired
    private DiscoveryClient discoveryClient;
    
    /**
     * æ ¹æ®åœ°åŸŸé€‰æ‹©æœ€è¿‘çš„æœåŠ¡å®ä¾‹
     */
    public ServiceInstance selectNearestInstance(
            String serviceName, String userRegion) {
        
        List<ServiceInstance> instances = 
            discoveryClient.getInstances(serviceName);
        
        // ä¼˜å…ˆé€‰æ‹©åŒåœ°åŸŸçš„å®ä¾‹
        Optional<ServiceInstance> sameRegion = instances.stream()
            .filter(instance -> {
                Map<String, String> metadata = instance.getMetadata();
                return userRegion.equals(metadata.get("region"));
            })
            .findFirst();
        
        // å¦‚æœæœ‰åŒåœ°åŸŸçš„å°±ç”¨ï¼Œå¦åˆ™ç”¨ç¬¬ä¸€ä¸ª
        return sameRegion.orElse(instances.get(0));
    }
    
    /**
     * æ ¹æ®æƒé‡é€‰æ‹©å®ä¾‹ï¼ˆåŠ æƒè´Ÿè½½å‡è¡¡ï¼‰
     */
    public ServiceInstance selectByWeight(List<ServiceInstance> instances) {
        
        // è®¡ç®—æ€»æƒé‡
        int totalWeight = instances.stream()
            .mapToInt(instance -> {
                String weightStr = instance.getMetadata().get("weight");
                return weightStr != null ? Integer.parseInt(weightStr) : 100;
            })
            .sum();
        
        // éšæœºæ•°è½åœ¨å“ªä¸ªæƒé‡åŒºé—´å°±é€‰å“ªä¸ªå®ä¾‹
        int randomWeight = new Random().nextInt(totalWeight);
        int currentWeight = 0;
        
        for (ServiceInstance instance : instances) {
            String weightStr = instance.getMetadata().get("weight");
            int weight = weightStr != null ? Integer.parseInt(weightStr) : 100;
            currentWeight += weight;
            
            if (randomWeight < currentWeight) {
                return instance;
            }
        }
        
        return instances.get(0);
    }
}
```

### 6.4 å…ƒæ•°æ®åœ¨æœåŠ¡æ²»ç†ä¸­çš„åº”ç”¨

**ğŸ› ï¸ å®ç°ç²¾ç»†åŒ–çš„æœåŠ¡ç®¡ç†**

```
å…ƒæ•°æ®åº”ç”¨åœºæ™¯ï¼š

1. æµé‡æ§åˆ¶
   - æ ¹æ®max-connectionsé™åˆ¶è¿æ¥æ•°
   - æ ¹æ®weightåˆ†é…æµé‡æ¯”ä¾‹

2. ç°åº¦å‘å¸ƒ
   - æ ¹æ®versionæ§åˆ¶ç‰ˆæœ¬è®¿é—®
   - æ ¹æ®featureæ ‡è¯†åŠŸèƒ½å¼€å…³

3. å¤šæœºæˆ¿éƒ¨ç½²
   - æ ¹æ®idcä¼˜å…ˆè®¿é—®åŒæœºæˆ¿
   - æ ¹æ®regionå®ç°åœ°åŸŸéš”ç¦»

4. ç›‘æ§å‘Šè­¦
   - æ ¹æ®maintainerå‘é€å‘Šè­¦
   - æ ¹æ®deploy-timeåˆ†æç¨³å®šæ€§
```

**å®é™…é…ç½®ç¤ºä¾‹ï¼š**
```yaml
# ç”Ÿäº§ç¯å¢ƒæœåŠ¡å…ƒæ•°æ®
spring:
  cloud:
    consul:
      discovery:
        metadata:
          # æµé‡æ§åˆ¶
          weight: 100
          max-qps: 1000
          circuit-breaker: enabled
          
          # éƒ¨ç½²ä¿¡æ¯
          env: production
          idc: idc-bj-01
          rack: rack-03
          
          # ç›‘æ§ä¿¡æ¯
          monitor-port: 9090
          metrics-path: /actuator/prometheus
          
          # ä¸šåŠ¡ä¿¡æ¯
          db-shard: shard-01
          cache-cluster: redis-cluster-1
```

---

## 7. âš–ï¸ è´Ÿè½½å‡è¡¡é›†æˆ


### 7.1 Ribbonè´Ÿè½½å‡è¡¡åŸç†

**ğŸ¯ ç†è§£Ribbonå¦‚ä½•åˆ†é…è¯·æ±‚**

Ribbonå°±åƒä¸€ä¸ªèªæ˜çš„"äº¤é€šè­¦å¯Ÿ"ï¼ŒæŒ‡æŒ¥è¯·æ±‚å»å¾€ä¸åŒçš„æœåŠ¡å®ä¾‹ï¼š

```
å·¥ä½œæµç¨‹ï¼š
1. æ‹¦æˆªè¯·æ±‚ï¼šå‘ç°URLä¸­æœ‰æœåŠ¡å
2. æœåŠ¡å‘ç°ï¼šä»Consulè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
3. è¿‡æ»¤ç­›é€‰ï¼šå»æ‰ä¸å¥åº·çš„å®ä¾‹
4. è´Ÿè½½å‡è¡¡ï¼šç”¨ç­–ç•¥é€‰æ‹©ä¸€ä¸ªå®ä¾‹
5. å‘èµ·è¯·æ±‚ï¼šæŠŠæœåŠ¡åæ›¿æ¢ä¸ºå®é™…åœ°å€
```

**ğŸ”„ è´Ÿè½½å‡è¡¡ç­–ç•¥è¯¦è§£**

```java
// 1. è½®è¯¢ç­–ç•¥ - æœ€å…¬å¹³çš„åˆ†é…æ–¹å¼
public class RoundRobinRule extends AbstractLoadBalancerRule {
    // åƒæ’é˜Ÿå«å·ï¼š1å·ã€2å·ã€3å·ã€1å·...
    // æ¯ä¸ªå®ä¾‹è½®æµå¤„ç†è¯·æ±‚
}

// 2. éšæœºç­–ç•¥ - ç®€å•ç²—æš´
public class RandomRule extends AbstractLoadBalancerRule {
    // åƒæŠ½ç­¾ï¼šéšæœºé€‰ä¸€ä¸ªå®ä¾‹
    // ç®€å•ä½†å¯èƒ½åˆ†å¸ƒä¸å‡
}

// 3. é‡è¯•ç­–ç•¥ - å¤±è´¥è‡ªåŠ¨é‡è¯•
public class RetryRule extends AbstractLoadBalancerRule {
    // é€‰ä¸­ä¸€ä¸ªå®ä¾‹åï¼Œå¦‚æœå¤±è´¥å°±æ¢ä¸€ä¸ªé‡è¯•
    // æé«˜æˆåŠŸç‡
}

// 4. å“åº”æ—¶é—´åŠ æƒ - å¿«çš„å®ä¾‹å¤„ç†æ›´å¤š
public class WeightedResponseTimeRule extends RoundRobinRule {
    // å“åº”å¿«çš„å®ä¾‹æƒé‡é«˜ï¼Œå¤„ç†æ›´å¤šè¯·æ±‚
    // è‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½
}
```

### 7.2 è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥

**ğŸ”§ å®ç°ä¸šåŠ¡å®šåˆ¶çš„è´Ÿè½½å‡è¡¡**

æœ‰æ—¶å€™é»˜è®¤ç­–ç•¥ä¸æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ï¼š

```java
/**
 * è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š
 * ä¼˜å…ˆé€‰æ‹©åŒæœºæˆ¿çš„æœåŠ¡å®ä¾‹
 */
public class SameIDCRule extends AbstractLoadBalancerRule {
    
    @Override
    public Server choose(Object key) {
        ILoadBalancer lb = getLoadBalancer();
        
        // 1. è·å–æ‰€æœ‰å¯ç”¨å®ä¾‹
        List<Server> allServers = lb.getReachableServers();
        
        // 2. è·å–å½“å‰æœåŠ¡æ‰€åœ¨æœºæˆ¿ï¼ˆä»é…ç½®è¯»å–ï¼‰
        String currentIDC = getCurrentIDC();
        
        // 3. ç­›é€‰åŒæœºæˆ¿çš„å®ä¾‹
        List<Server> sameIDCServers = allServers.stream()
            .filter(server -> {
                // ä»æœåŠ¡å…ƒæ•°æ®è·å–æœºæˆ¿ä¿¡æ¯
                String serverIDC = getServerIDC(server);
                return currentIDC.equals(serverIDC);
            })
            .collect(Collectors.toList());
        
        // 4. å¦‚æœåŒæœºæˆ¿æœ‰å®ä¾‹ï¼Œå°±åœ¨å…¶ä¸­è½®è¯¢é€‰æ‹©
        if (!sameIDCServers.isEmpty()) {
            int index = incrementAndGetModulo(sameIDCServers.size());
            return sameIDCServers.get(index);
        }
        
        // 5. å¦åˆ™åœ¨æ‰€æœ‰å®ä¾‹ä¸­è½®è¯¢
        int index = incrementAndGetModulo(allServers.size());
        return allServers.get(index);
    }
    
    private String getCurrentIDC() {
        // ä»é…ç½®ä¸­è·å–å½“å‰æœåŠ¡æ‰€åœ¨æœºæˆ¿
        return "idc-beijing-1";
    }
    
    private String getServerIDC(Server server) {
        // ä»æœåŠ¡å®ä¾‹çš„å…ƒæ•°æ®è·å–æœºæˆ¿ä¿¡æ¯
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…éœ€è¦è§£æå…ƒæ•°æ®
        return "idc-beijing-1";
    }
}
```

**é…ç½®ä½¿ç”¨è‡ªå®šä¹‰ç­–ç•¥ï¼š**
```yaml
# å…¨å±€ä½¿ç”¨è‡ªå®šä¹‰ç­–ç•¥
ribbon:
  NFLoadBalancerRuleClassName: com.example.SameIDCRule

# åªå¯¹ç‰¹å®šæœåŠ¡ä½¿ç”¨
user-service:
  ribbon:
    NFLoadBalancerRuleClassName: com.example.SameIDCRule
```

### 7.3 è´Ÿè½½å‡è¡¡é…ç½®ä¼˜åŒ–

**âš™ï¸ è°ƒä¼˜è´Ÿè½½å‡è¡¡æ€§èƒ½**

```yaml
ribbon:
  # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  ConnectTimeout: 3000
  
  # è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  ReadTimeout: 10000
  
  # æ˜¯å¦æ‰€æœ‰æ“ä½œéƒ½é‡è¯•
  OkToRetryOnAllOperations: false
  
  # åŒä¸€å®ä¾‹æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆä¸åŒ…æ‹¬ç¬¬ä¸€æ¬¡ï¼‰
  MaxAutoRetries: 1
  
  # åˆ‡æ¢å®ä¾‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°
  MaxAutoRetriesNextServer: 2
  
  # ä»Consulåˆ·æ–°æœåŠ¡åˆ—è¡¨çš„é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  ServerListRefreshInterval: 2000
```

**ğŸ’¡ é…ç½®é¡¹å«ä¹‰è§£é‡Šï¼š**
```
MaxAutoRetries: 1
â†’ æ„æ€æ˜¯åœ¨åŒä¸€ä¸ªå®ä¾‹ä¸Šæœ€å¤šé‡è¯•1æ¬¡
â†’ æ€»å…±è¯·æ±‚2æ¬¡ï¼ˆé¦–æ¬¡ + é‡è¯•1æ¬¡ï¼‰

MaxAutoRetriesNextServer: 2  
â†’ æ„æ€æ˜¯æœ€å¤šåˆ‡æ¢2ä¸ªå…¶ä»–å®ä¾‹é‡è¯•
â†’ å¦‚æœç¬¬ä¸€ä¸ªå®ä¾‹å¤±è´¥ï¼Œä¼šå°è¯•å¦å¤–2ä¸ªå®ä¾‹

å®é™…æ•ˆæœï¼š
æœ€å¤šè¯·æ±‚æ¬¡æ•° = (1 + MaxAutoRetries) Ã— (1 + MaxAutoRetriesNextServer)
              = 2 Ã— 3 = 6æ¬¡
```

---

## 8. ğŸ”„ æ•…éšœè½¬ç§»å¤„ç†


### 8.1 æ•…éšœè½¬ç§»æœºåˆ¶

**ğŸ¯ å½“æœåŠ¡å‡ºé—®é¢˜æ—¶å¦‚ä½•åº”å¯¹**

æ•…éšœè½¬ç§»å°±åƒå¤‡ç”¨æ–¹æ¡ˆï¼Œå½“ä¸»è¦æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡ï¼š

```
æ•…éšœè½¬ç§»åœºæ™¯ï¼š

åœºæ™¯1ï¼šæœåŠ¡å®ä¾‹å®•æœº
é—®é¢˜ï¼šuser-serviceçš„æŸä¸ªå®ä¾‹æŒ‚äº†
å¤„ç†ï¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–å¥åº·å®ä¾‹

åœºæ™¯2ï¼šç½‘ç»œåˆ†åŒº
é—®é¢˜ï¼šæŸä¸ªæœºæˆ¿ç½‘ç»œæ•…éšœ
å¤„ç†ï¼šåˆ‡æ¢åˆ°å…¶ä»–æœºæˆ¿çš„å®ä¾‹

åœºæ™¯3ï¼šæœåŠ¡é™çº§
é—®é¢˜ï¼šä¾èµ–çš„æœåŠ¡å…¨éƒ¨ä¸å¯ç”¨
å¤„ç†ï¼šè¿”å›é»˜è®¤æ•°æ®æˆ–å‹å¥½æç¤º
```

### 8.2 å®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»

**ğŸ›¡ï¸ é…ç½®æ•…éšœè‡ªåŠ¨æ¢å¤**

```yaml
# Ribboné‡è¯•é…ç½®
ribbon:
  # å¼€å¯é‡è¯•æœºåˆ¶
  OkToRetryOnAllOperations: true
  MaxAutoRetries: 1                 # åŒä¸€å®ä¾‹é‡è¯•1æ¬¡
  MaxAutoRetriesNextServer: 2       # åˆ‡æ¢2ä¸ªå…¶ä»–å®ä¾‹
  
# Consulå¥åº·æ£€æŸ¥é…ç½®  
spring:
  cloud:
    consul:
      discovery:
        health-check-critical-timeout: 30s  # 30ç§’åç§»é™¤ä¸å¥åº·å®ä¾‹
        
# Feignè¶…æ—¶é…ç½®
feign:
  client:
    config:
      default:
        connectTimeout: 3000
        readTimeout: 10000
```

**ğŸ”§ ç¼–ç¨‹å¼æ•…éšœå¤„ç†**
```java
@Service
public class ResilientUserService {
    
    @Autowired
    private UserServiceClient userServiceClient;
    
    /**
     * å¸¦é‡è¯•çš„æœåŠ¡è°ƒç”¨
     */
    @Retryable(
        value = {ConnectException.class, SocketTimeoutException.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 1000)
    )
    public User getUserWithRetry(Long userId) {
        try {
            return userServiceClient.getUserById(userId);
        } catch (Exception e) {
            log.error("è°ƒç”¨user-serviceå¤±è´¥ï¼Œå°†é‡è¯•", e);
            throw e;  // æŠ›å‡ºå¼‚å¸¸è§¦å‘é‡è¯•
        }
    }
    
    /**
     * å¸¦ç†”æ–­çš„æœåŠ¡è°ƒç”¨
     */
    @HystrixCommand(
        fallbackMethod = "getUserFallback",
        commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "3000"),
            @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "10")
        }
    )
    public User getUserWithCircuitBreaker(Long userId) {
        return userServiceClient.getUserById(userId);
    }
    
    /**
     * é™çº§æ–¹æ³•ï¼šå½“æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›é»˜è®¤æ•°æ®
     */
    public User getUserFallback(Long userId) {
        User defaultUser = new User();
        defaultUser.setId(userId);
        defaultUser.setName("é»˜è®¤ç”¨æˆ·");
        defaultUser.setStatus("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
        return defaultUser;
    }
}
```

### 8.3 æœåŠ¡é™çº§ç­–ç•¥

**ğŸ“‰ ä¼˜é›…å¤„ç†æœåŠ¡ä¸å¯ç”¨**

æœåŠ¡é™çº§å°±åƒ"Plan B"ï¼Œå½“Aè®¡åˆ’å¤±è´¥æ—¶å¯åŠ¨Bè®¡åˆ’ï¼š

```
é™çº§ç­–ç•¥å±‚æ¬¡ï¼š

Level 1 - è¿”å›ç¼“å­˜æ•°æ®
å½“æœåŠ¡æ…¢æˆ–ä¸å¯ç”¨æ—¶ï¼Œè¿”å›ä¹‹å‰ç¼“å­˜çš„æ•°æ®
ä¼˜ç‚¹ï¼šç”¨æˆ·ä½“éªŒå¥½
ç¼ºç‚¹ï¼šæ•°æ®å¯èƒ½è¿‡æœŸ

Level 2 - è¿”å›é»˜è®¤å€¼
è¿”å›é¢„è®¾çš„é»˜è®¤æ•°æ®
ä¼˜ç‚¹ï¼šä¿è¯æœåŠ¡å¯ç”¨
ç¼ºç‚¹ï¼šæ•°æ®ä¸å‡†ç¡®

Level 3 - è¿”å›é”™è¯¯æç¤º
å‹å¥½åœ°å‘Šè¯‰ç”¨æˆ·æœåŠ¡æš‚æ—¶ä¸å¯ç”¨
ä¼˜ç‚¹ï¼šè¯šå®é€æ˜
ç¼ºç‚¹ï¼šç”¨æˆ·ä½“éªŒå·®
```

**å®ç°å¤šçº§é™çº§ï¼š**
```java
@Service
public class UserServiceFallback {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    /**
     * å¤šçº§é™çº§ç­–ç•¥
     */
    public User getUser(Long userId) {
        try {
            // ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šè°ƒç”¨æœåŠ¡
            return callUserService(userId);
            
        } catch (Exception e) {
            // ç¬¬äºŒä¼˜å…ˆçº§ï¼šè¯»å–ç¼“å­˜
            User cachedUser = getUserFromCache(userId);
            if (cachedUser != null) {
                log.warn("æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œè¿”å›ç¼“å­˜æ•°æ®, userId={}", userId);
                return cachedUser;
            }
            
            // ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šè¿”å›é»˜è®¤ç”¨æˆ·
            log.error("æœåŠ¡è°ƒç”¨å¤±è´¥ä¸”æ— ç¼“å­˜ï¼Œè¿”å›é»˜è®¤æ•°æ®, userId={}", userId);
            return getDefaultUser(userId);
        }
    }
    
    private User callUserService(Long userId) {
        // è°ƒç”¨è¿œç¨‹æœåŠ¡
        return userServiceClient.getUserById(userId);
    }
    
    private User getUserFromCache(Long userId) {
        // ä»Redisè·å–ç¼“å­˜
        String key = "user:" + userId;
        return (User) redisTemplate.opsForValue().get(key);
    }
    
    private User getDefaultUser(Long userId) {
        // è¿”å›é»˜è®¤ç”¨æˆ·å¯¹è±¡
        User user = new User();
        user.setId(userId);
        user.setName("ç³»ç»Ÿç”¨æˆ·");
        user.setRemark("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºé»˜è®¤ä¿¡æ¯");
        return user;
    }
}
```

### 8.4 å¥åº·æ£€æŸ¥ä¸è‡ªåŠ¨æ¢å¤

**ğŸ¥ å®æ—¶ç›‘æ§å’Œè‡ªåŠ¨ä¿®å¤**

```java
/**
 * æœåŠ¡å¥åº·ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤
 */
@Component
@Slf4j
public class ServiceHealthMonitor {
    
    @Autowired
    private DiscoveryClient discoveryClient;
    
    @Autowired
    private ConsulClient consulClient;
    
    /**
     * å®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
     */
    @Scheduled(fixedRate = 30000)  // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void checkServiceHealth() {
        List<String> services = discoveryClient.getServices();
        
        for (String serviceName : services) {
            List<ServiceInstance> instances = 
                discoveryClient.getInstances(serviceName);
            
            log.info("æœåŠ¡[{}]å½“å‰æœ‰{}ä¸ªå®ä¾‹", serviceName, instances.size());
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¥åº·å®ä¾‹
            if (instances.size() < 2) {
                log.warn("âš ï¸ æœåŠ¡[{}]å¥åº·å®ä¾‹ä¸è¶³ï¼Œå»ºè®®æ‰©å®¹", serviceName);
                // å‘é€å‘Šè­¦é€šçŸ¥
                sendAlert(serviceName, "å®ä¾‹æ•°é‡ä¸è¶³");
            }
            
            // æ£€æŸ¥å®ä¾‹è´Ÿè½½
            checkInstanceLoad(instances);
        }
    }
    
    /**
     * æ£€æŸ¥å®ä¾‹è´Ÿè½½æƒ…å†µ
     */
    private void checkInstanceLoad(List<ServiceInstance> instances) {
        for (ServiceInstance instance : instances) {
            Map<String, String> metadata = instance.getMetadata();
            
            // ä»å…ƒæ•°æ®è·å–è´Ÿè½½ä¿¡æ¯
            String currentLoad = metadata.get("current-load");
            String maxLoad = metadata.get("max-load");
            
            if (currentLoad != null && maxLoad != null) {
                int load = Integer.parseInt(currentLoad);
                int max = Integer.parseInt(maxLoad);
                
                // è´Ÿè½½è¶…è¿‡80%å‘å‡ºè­¦å‘Š
                if (load > max * 0.8) {
                    log.warn("âš ï¸ å®ä¾‹[{}]è´Ÿè½½è¿‡é«˜: {}/{}",
                        instance.getInstanceId(), load, max);
                }
            }
        }
    }
    
    private void sendAlert(String serviceName, String message) {
        // å‘é€é‚®ä»¶ã€çŸ­ä¿¡æˆ–æ¨é€å‘Šè­¦
        log.error("ğŸš¨ å‘Šè­¦ï¼šæœåŠ¡[{}] - {}", serviceName, message);
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æœåŠ¡æ³¨å†Œï¼šæœåŠ¡å¯åŠ¨æ—¶å‘ConsulæŠ¥åˆ°ï¼Œç™»è®°è‡ªå·±çš„ä¿¡æ¯
ğŸ”¸ æœåŠ¡å‘ç°ï¼šé€šè¿‡ConsulæŸ¥æ‰¾éœ€è¦è°ƒç”¨çš„æœåŠ¡åœ°å€
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šConsulå®šæœŸæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
ğŸ”¸ æ ‡ç­¾Tagsï¼šç»™æœåŠ¡æ‰“æ ‡è®°ï¼Œæ–¹ä¾¿åˆ†ç±»å’Œç­›é€‰
ğŸ”¸ å…ƒæ•°æ®Metadataï¼šæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯å’Œé…ç½®
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šæ™ºèƒ½åˆ†é…è¯·æ±‚åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šæœåŠ¡å¼‚å¸¸æ—¶è‡ªåŠ¨åˆ‡æ¢å’Œé™çº§å¤„ç†
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æœåŠ¡æ³¨å†Œå‘ç°çš„å·¥ä½œæµç¨‹**
```
æ³¨å†Œæµç¨‹ï¼š
1. æœåŠ¡å¯åŠ¨
2. è¯»å–é…ç½®ä¿¡æ¯
3. å‘Consulæ³¨å†Œ
4. å®šæœŸå‘é€å¿ƒè·³

å‘ç°æµç¨‹ï¼š
1. éœ€è¦è°ƒç”¨æœåŠ¡
2. å‘ConsulæŸ¥è¯¢
3. è·å–å®ä¾‹åˆ—è¡¨  
4. é€‰æ‹©ä¸€ä¸ªè°ƒç”¨

å°±åƒï¼š
æ³¨å†Œ = æ–°åº—å¼€ä¸šè¦å»å·¥å•†å±€ç™»è®°
å‘ç° = é¡¾å®¢è¦æ‰¾åº—æ—¶æŸ¥åœ°å›¾
```

**ğŸ”¹ å¥åº·æ£€æŸ¥çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥ï¼š
âœ… åŠæ—¶å‘ç°æœåŠ¡æ•…éšœ
âœ… è‡ªåŠ¨å‰”é™¤å¼‚å¸¸å®ä¾‹
âœ… ä¿è¯ç”¨æˆ·è¯·æ±‚æˆåŠŸç‡

æ£€æŸ¥æ–¹å¼ï¼š
HTTPæ£€æŸ¥ï¼šè®¿é—®/healthæ¥å£
TCPæ£€æŸ¥ï¼šæ£€æŸ¥ç«¯å£è¿é€šæ€§
è„šæœ¬æ£€æŸ¥ï¼šæ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬

å»ºè®®é…ç½®ï¼š
æ£€æŸ¥é—´éš”ï¼š10-30ç§’
è¶…æ—¶æ—¶é—´ï¼š3-5ç§’
å¤±è´¥ç§»é™¤ï¼š30-60ç§’å
```

**ğŸ”¹ è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©**
```
å¸¸ç”¨ç­–ç•¥å¯¹æ¯”ï¼š

è½®è¯¢ï¼ˆRoundRobinï¼‰ï¼š
é€‚åˆï¼šæœåŠ¡æ€§èƒ½ç›¸è¿‘
ç‰¹ç‚¹ï¼šå…¬å¹³åˆ†é…ï¼Œç®€å•æœ‰æ•ˆ

éšæœºï¼ˆRandomï¼‰ï¼š
é€‚åˆï¼šå¿«é€Ÿåˆ†é…
ç‰¹ç‚¹ï¼šå®ç°ç®€å•ï¼Œåˆ†å¸ƒå‡åŒ€

åŠ æƒå“åº”æ—¶é—´ï¼ˆWeightedResponseTimeï¼‰ï¼š
é€‚åˆï¼šæœåŠ¡æ€§èƒ½å·®å¼‚å¤§
ç‰¹ç‚¹ï¼šè‡ªåŠ¨ä¼˜åŒ–ï¼Œæ€§èƒ½æœ€ä¼˜

é‡è¯•ï¼ˆRetryï¼‰ï¼š
é€‚åˆï¼šç½‘ç»œä¸ç¨³å®š
ç‰¹ç‚¹ï¼šæé«˜æˆåŠŸç‡
```

**ğŸ”¹ æ•…éšœå¤„ç†çš„å±‚æ¬¡åŒ–ç­–ç•¥**
```
ç¬¬ä¸€å±‚ï¼šè‡ªåŠ¨é‡è¯•
- å¤±è´¥åè‡ªåŠ¨æ¢å®ä¾‹é‡è¯•
- æé«˜å•æ¬¡è¯·æ±‚æˆåŠŸç‡

ç¬¬äºŒå±‚ï¼šæœåŠ¡é™çº§
- è¿”å›ç¼“å­˜æ•°æ®
- è¿”å›é»˜è®¤å€¼

ç¬¬ä¸‰å±‚ï¼šç†”æ–­ä¿æŠ¤
- å¿«é€Ÿå¤±è´¥
- é¿å…é›ªå´©

ç¬¬å››å±‚ï¼šå‘Šè­¦é€šçŸ¥
- å‘é€è¿ç»´å‘Šè­¦
- äººå·¥ä»‹å…¥å¤„ç†
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**

```
é…ç½®å»ºè®®ï¼š
âœ… ä½¿ç”¨prefer-ip-address=trueï¼ˆå®¹å™¨ç¯å¢ƒï¼‰
âœ… è®¾ç½®åˆç†çš„å¥åº·æ£€æŸ¥é—´éš”ï¼ˆ10-30ç§’ï¼‰
âœ… é…ç½®å®ä¾‹IDåŒ…å«ç«¯å£å·é¿å…å†²çª
âœ… ä½¿ç”¨æ ‡ç­¾åŒºåˆ†ç¯å¢ƒï¼ˆdev/test/prodï¼‰
âœ… é…ç½®å…ƒæ•°æ®è®°å½•å…³é”®ä¿¡æ¯

ä»£ç å»ºè®®ï¼š
âœ… ä¼˜å…ˆä½¿ç”¨Feignç®€åŒ–è°ƒç”¨
âœ… å®ç°è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é€»è¾‘
âœ… é…ç½®åˆç†çš„è¶…æ—¶å’Œé‡è¯•
âœ… ä½¿ç”¨æœåŠ¡é™çº§ä¿è¯å¯ç”¨æ€§

è¿ç»´å»ºè®®ï¼š
âœ… ç›‘æ§æœåŠ¡æ³¨å†ŒçŠ¶æ€
âœ… å®šæœŸæ£€æŸ¥å¥åº·å®ä¾‹æ•°é‡
âœ… å»ºç«‹å®Œå–„çš„å‘Šè­¦æœºåˆ¶
âœ… åˆ¶å®šæ•…éšœåº”æ€¥é¢„æ¡ˆ
```

**ğŸ“ˆ å¸¸è§é—®é¢˜è§£å†³**

```
é—®é¢˜1ï¼šæœåŠ¡æ³¨å†Œä¸ä¸Š
æ’æŸ¥ï¼šæ£€æŸ¥Consulåœ°å€é…ç½®ã€ç½‘ç»œè¿é€šæ€§ã€æœåŠ¡åæ˜¯å¦é‡å¤

é—®é¢˜2ï¼šæœåŠ¡è°ƒç”¨å¤±è´¥
æ’æŸ¥ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦å¥åº·ã€è´Ÿè½½å‡è¡¡é…ç½®ã€ç½‘ç»œæ˜¯å¦é€šç•…

é—®é¢˜3ï¼šè´Ÿè½½ä¸å‡è¡¡
æ’æŸ¥ï¼šæ£€æŸ¥è´Ÿè½½å‡è¡¡ç­–ç•¥ã€å®ä¾‹æƒé‡é…ç½®ã€å¥åº·æ£€æŸ¥è®¾ç½®

é—®é¢˜4ï¼šé¢‘ç¹æœåŠ¡å‘ç°
æ’æŸ¥ï¼šæ£€æŸ¥ç¼“å­˜é…ç½®ã€åˆ·æ–°é—´éš”ã€æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æœåŠ¡æ³¨å†Œè¦é…å‡†ï¼Œå¥åº·æ£€æŸ¥ä¿ç¨³å®š
- å‘ç°è°ƒç”¨ç”¨Feignï¼Œè´Ÿè½½å‡è¡¡è‡ªåŠ¨é€‰
- æ ‡ç­¾å…ƒæ•°æ®å·§åˆ©ç”¨ï¼Œæ•…éšœè½¬ç§»æœ‰é¢„æ¡ˆ
- ç›‘æ§å‘Šè­¦è¦å®Œå–„ï¼Œç”Ÿäº§ç¯å¢ƒç¨³å¦‚å±±