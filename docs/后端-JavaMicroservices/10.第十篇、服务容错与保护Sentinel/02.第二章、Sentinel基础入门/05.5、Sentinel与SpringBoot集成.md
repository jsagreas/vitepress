---
title: 5ã€Sentinelä¸SpringBooté›†æˆ
---
## ğŸ“š ç›®å½•

1. [é›†æˆæ¦‚è¿°](#1-é›†æˆæ¦‚è¿°)
2. [Mavenä¾èµ–é…ç½®](#2-Mavenä¾èµ–é…ç½®)
3. [application.ymlæ ¸å¿ƒé…ç½®](#3-applicationymlæ ¸å¿ƒé…ç½®)
4. [@SentinelResourceæ³¨è§£è¯¦è§£](#4-SentinelResourceæ³¨è§£è¯¦è§£)
5. [è‡ªåŠ¨é…ç½®åŸç†](#5-è‡ªåŠ¨é…ç½®åŸç†)
6. [å¥åº·æ£€æŸ¥ä¸ç›‘æ§](#6-å¥åº·æ£€æŸ¥ä¸ç›‘æ§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ é›†æˆæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Sentinelä¸SpringBooté›†æˆ


**é€šä¿—ç†è§£**ï¼š
```
å°±åƒç»™ä½ çš„SpringBootåº”ç”¨è£…ä¸Šä¸€ä¸ª"æ™ºèƒ½ä¿æŠ¤ç½©"

æ²¡æœ‰Sentinelï¼š
ä½ çš„æœåŠ¡ â†’ ç›´æ¥å¤„ç†è¯·æ±‚ â†’ å¯èƒ½è¢«æ‰“å®

æœ‰äº†Sentinelï¼š
ä½ çš„æœåŠ¡ â†’ Sentinelä¿æŠ¤å±‚ â†’ å®‰å…¨å¤„ç†è¯·æ±‚
            â†“
         é™æµã€é™çº§ã€ä¿æŠ¤
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ›¡ï¸ **ä¿æŠ¤æœåŠ¡**ï¼šé˜²æ­¢æœåŠ¡è¢«å¤§é‡è¯·æ±‚å‹å®
- ğŸš¦ **æµé‡æ§åˆ¶**ï¼šåƒçº¢ç»¿ç¯ä¸€æ ·æ§åˆ¶è¯·æ±‚æµé‡
- ğŸ“‰ **æœåŠ¡é™çº§**ï¼šå‡ºé—®é¢˜æ—¶è‡ªåŠ¨é™çº§ä¿æŠ¤
- ğŸ“Š **å®æ—¶ç›‘æ§**ï¼šéšæ—¶çœ‹åˆ°æœåŠ¡è¿è¡ŒçŠ¶æ€

### 1.2 ä¸ºä»€ä¹ˆè¦é›†æˆSentinel


**å®é™…åœºæ™¯å¯¹æ¯”**ï¼š

| åœºæ™¯ | æ²¡æœ‰Sentinel | æœ‰äº†Sentinel |
|------|-------------|-------------|
| ğŸ”¥ **æµé‡çªå¢** | `æœåŠ¡ç›´æ¥å´©æºƒ` | `è‡ªåŠ¨é™æµï¼Œä¿æŠ¤æœåŠ¡` |
| âš ï¸ **ä¾èµ–æ•…éšœ** | `æ•´ä¸ªé“¾è·¯ç˜«ç—ª` | `å¿«é€Ÿé™çº§ï¼Œè¿”å›é»˜è®¤å€¼` |
| ğŸ“ˆ **æ€§èƒ½ç›‘æ§** | `ä¸çŸ¥é“å“ªé‡Œæ…¢` | `å®æ—¶æŸ¥çœ‹è°ƒç”¨æ•°æ®` |
| ğŸ”§ **åŠ¨æ€è°ƒæ•´** | `éœ€è¦é‡å¯æœåŠ¡` | `æ§åˆ¶å°å®æ—¶ä¿®æ”¹è§„åˆ™` |

---

## 2. ğŸ“¦ Mavenä¾èµ–é…ç½®


### 2.1 æ ¸å¿ƒä¾èµ–è¯´æ˜


**spring-cloud-starter-alibaba-sentinel** è¿™ä¸ªä¾èµ–æ˜¯ä»€ä¹ˆï¼Ÿ

```
é€šä¿—ç†è§£ï¼šè¿™æ˜¯ä¸€ä¸ª"å…¨å®¶æ¡¶"ä¾èµ–

å°±åƒä½ ä¹°æ‰‹æœºï¼š
- ä¹°iPhone â†’ è‡ªåŠ¨å¸¦å……ç”µå™¨ã€æ•°æ®çº¿ã€è€³æœº
- å¼•å…¥sentinelä¾èµ– â†’ è‡ªåŠ¨å¸¦æ‰€æœ‰éœ€è¦çš„ç»„ä»¶
```

**å®ƒåŒ…å«äº†ä»€ä¹ˆ**ï¼š
- âœ… Sentinelæ ¸å¿ƒåº“ï¼ˆä¿æŠ¤åŠŸèƒ½ï¼‰
- âœ… ä¸SpringBootçš„é€‚é…å™¨ï¼ˆè®©å®ƒä»¬èƒ½å¯¹è¯ï¼‰
- âœ… è‡ªåŠ¨é…ç½®ç±»ï¼ˆå¼€ç®±å³ç”¨ï¼‰
- âœ… ç›‘æ§æ•°æ®é‡‡é›†å™¨ï¼ˆæ”¶é›†è¿è¡Œæ•°æ®ï¼‰

### 2.2 pom.xmlå®Œæ•´é…ç½®


```xml
<!-- çˆ¶ä¾èµ–ï¼šå®šä¹‰ç‰ˆæœ¬ç®¡ç† -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.6.13</version>
</parent>

<properties>
    <!-- Spring Cloud Alibabaç‰ˆæœ¬ -->
    <spring-cloud-alibaba.version>2021.0.5.0</spring-cloud-alibaba.version>
</properties>

<dependencies>
    <!-- 1. SpringBoot Webä¾èµ–ï¼ˆåŸºç¡€webåŠŸèƒ½ï¼‰ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- 2. Sentinelæ ¸å¿ƒä¾èµ–ï¼ˆæ ¸å¿ƒï¼ï¼‰ -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
    </dependency>
    
    <!-- 3. Sentinelæ§åˆ¶å°é€šä¿¡ä¾èµ–ï¼ˆå¯é€‰ä½†æ¨èï¼‰ -->
    <dependency>
        <groupId>com.alibaba.csp</groupId>
        <artifactId>sentinel-transport-simple-http</artifactId>
    </dependency>
</dependencies>

<!-- ç‰ˆæœ¬ç®¡ç† -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-alibaba-dependencies</artifactId>
            <version>${spring-cloud-alibaba.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

**ä¾èµ–è¯´æ˜**ï¼š

| ä¾èµ– | ä½œç”¨ | å¿…éœ€æ€§ |
|------|------|--------|
| `spring-boot-starter-web` | `æä¾›WebæœåŠ¡åŸºç¡€åŠŸèƒ½` | âœ… å¿…éœ€ |
| `spring-cloud-starter-alibaba-sentinel` | `Sentinelæ ¸å¿ƒä¿æŠ¤åŠŸèƒ½` | âœ… å¿…éœ€ |
| `sentinel-transport-simple-http` | `ä¸æ§åˆ¶å°é€šä¿¡` | â­ æ¨è |

---

## 3. âš™ï¸ application.ymlæ ¸å¿ƒé…ç½®


### 3.1 åŸºç¡€é…ç½®ç»“æ„


**é…ç½®æ–‡ä»¶å°±åƒæ˜¯"è¯´æ˜ä¹¦"**ï¼š
```
æƒ³è±¡ä½ ä¹°äº†ä¸ªæ™ºèƒ½è®¾å¤‡ï¼š
1. è®¾å¤‡åç§°ï¼ˆåº”ç”¨åï¼‰
2. è¿æ¥æ§åˆ¶ä¸­å¿ƒï¼ˆdashboardåœ°å€ï¼‰
3. ä¸ŠæŠ¥ç«¯å£ï¼ˆå®¢æˆ·ç«¯ç«¯å£ï¼‰
4. æ˜¯å¦å¼€å¯ä¿æŠ¤ï¼ˆenabledï¼‰
```

### 3.2 å®Œæ•´é…ç½®ç¤ºä¾‹


```yaml
spring:
  application:
    name: order-service  # ä½ çš„æœåŠ¡åç§°ï¼Œåƒèº«ä»½è¯
  
  cloud:
    sentinel:
      # 1. æ§åˆ¶å°é…ç½®ï¼ˆé‡è¦ï¼ï¼‰
      transport:
        dashboard: localhost:8080  # Sentinelæ§åˆ¶å°åœ°å€
        port: 8719                 # å®¢æˆ·ç«¯é€šä¿¡ç«¯å£
        
      # 2. æ˜¯å¦å¼€å¯Sentinelï¼ˆæ€»å¼€å…³ï¼‰
      enabled: true
      
      # 3. é¥¥é¥¿åŠ è½½ï¼ˆæ¨èå¼€å¯ï¼‰
      eager: true
      
      # 4. Webé…ç½®
      servlet:
        block-page: /blocked  # è¢«é™æµåè·³è½¬çš„é¡µé¢
      
      # 5. æ—¥å¿—é…ç½®
      log:
        dir: ./logs/sentinel  # æ—¥å¿—å­˜æ”¾ç›®å½•
        switch-pid: true      # æ—¥å¿—æ–‡ä»¶ååŒ…å«è¿›ç¨‹ID

# æœåŠ¡ç«¯å£
server:
  port: 8001
```

### 3.3 é…ç½®è¯¦è§£


**ğŸ”¸ dashboardé…ç½®**ï¼š
```yaml
transport:
  dashboard: localhost:8080
  
è¿™ä¸ªé…ç½®çš„æ„æ€ï¼š
- å‘Šè¯‰ä½ çš„æœåŠ¡"æ§åˆ¶å°åœ¨å“ªé‡Œ"
- å°±åƒå‘Šè¯‰æ‰‹æœº"è·¯ç”±å™¨çš„IPæ˜¯å¤šå°‘"
- æœåŠ¡å¯åŠ¨åä¼šè‡ªåŠ¨è¿æ¥åˆ°è¿™ä¸ªåœ°å€
```

**ğŸ”¸ porté…ç½®**ï¼š
```yaml
transport:
  port: 8719
  
è¿™ä¸ªé…ç½®çš„æ„æ€ï¼š
- æœåŠ¡ç”¨è¿™ä¸ªç«¯å£æ¥æ”¶æ§åˆ¶å°çš„æŒ‡ä»¤
- å¦‚æœç«¯å£è¢«å ç”¨ï¼Œä¼šè‡ªåŠ¨+1å°è¯•ï¼ˆ8720ã€8721...ï¼‰
- æœ€å¤šå°è¯•3æ¬¡
```

**ğŸ”¸ eageré…ç½®**ï¼š
```yaml
eager: true

é¥¥é¥¿åŠ è½½ vs æ‡’åŠ è½½ï¼š

æ‡’åŠ è½½ï¼ˆfalseï¼‰ï¼š
ç¬¬ä¸€ä¸ªè¯·æ±‚æ¥äº† â†’ æ‰åˆå§‹åŒ–Sentinel â†’ ç¬¬ä¸€æ¬¡ä¼šæ…¢
         
é¥¥é¥¿åŠ è½½ï¼ˆtrueï¼‰ï¼š   
æœåŠ¡å¯åŠ¨ â†’ ç«‹å³åˆå§‹åŒ–Sentinel â†’ ç¬¬ä¸€æ¬¡å°±å¾ˆå¿« âœ…
```

**ğŸ”¸ block-pageé…ç½®**ï¼š
```yaml
servlet:
  block-page: /blocked

ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼š
è¢«é™æµæ—¶çš„è¿”å›ï¼š

ä¸é…ç½® â†’ è¿”å›ï¼šBlocked by Sentinel (flow limiting)
é…ç½®äº† â†’ è·³è½¬åˆ°ï¼š/blockedé¡µé¢ï¼ˆå¯ä»¥è‡ªå®šä¹‰å‹å¥½æç¤ºï¼‰
```

### 3.4 å¤šç¯å¢ƒé…ç½®


**å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸åŒé…ç½®**ï¼š

```yaml
# application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080  # æœ¬åœ°æ§åˆ¶å°
      log:
        dir: ./logs/sentinel

# application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
spring:
  cloud:
    sentinel:
      transport:
        dashboard: sentinel.prod.com:8080  # ç”Ÿäº§æ§åˆ¶å°
      log:
        dir: /var/logs/sentinel
```

---

## 4. ğŸ¯ @SentinelResourceæ³¨è§£è¯¦è§£


### 4.1 æ³¨è§£åŸºæœ¬æ¦‚å¿µ


**@SentinelResource æ˜¯ä»€ä¹ˆï¼Ÿ**

```
é€šä¿—ç†è§£ï¼šç»™æ–¹æ³•è´´ä¸ª"ä¿æŠ¤æ ‡ç­¾"

å°±åƒå•†å“è´´æ¡å½¢ç ï¼š
- å•†å“è´´ç  â†’ å¯ä»¥æ‰«æã€ç»Ÿè®¡ã€ç®¡ç†
- æ–¹æ³•åŠ æ³¨è§£ â†’ å¯ä»¥é™æµã€é™çº§ã€ç›‘æ§
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ·ï¸ **æ ‡è¯†èµ„æº**ï¼šå‘Šè¯‰Sentinelè¿™ä¸ªæ–¹æ³•éœ€è¦ä¿æŠ¤
- ğŸ›¡ï¸ **é…ç½®è§„åˆ™**ï¼šä¸ºè¿™ä¸ªæ–¹æ³•è®¾ç½®é™æµã€é™çº§è§„åˆ™
- ğŸ“Š **ç›‘æ§ç»Ÿè®¡**ï¼šæ”¶é›†è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ•°æ®
- ğŸ”„ **å¼‚å¸¸å¤„ç†**ï¼šå®šä¹‰å‡ºé—®é¢˜æ—¶æ€ä¹ˆåŠ

### 4.2 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


```java
@RestController
@RequestMapping("/order")
public class OrderController {
    
    /**
     * åŸºç¡€ä½¿ç”¨ï¼šåªæ ‡è¯†èµ„æºå
     */
    @GetMapping("/create")
    @SentinelResource("createOrder")  // èµ„æºåç§°
    public String createOrder() {
        return "è®¢å•åˆ›å»ºæˆåŠŸ";
    }
}
```

**è¿™ä¸ªæ³¨è§£åšäº†ä»€ä¹ˆ**ï¼š
```
è®¿é—® /order/create æ—¶ï¼š

1. Sentinelæ‹¦æˆªè¯·æ±‚
2. æ£€æŸ¥"createOrder"èµ„æºçš„è§„åˆ™
3. åˆ¤æ–­æ˜¯å¦é™æµ/é™çº§
4. é€šè¿‡ â†’ æ‰§è¡Œæ–¹æ³• | æ‹’ç» â†’ è¿”å›å¼‚å¸¸
```

### 4.3 blockHandleré™çº§å¤„ç†


**ä»€ä¹ˆæ˜¯blockHandlerï¼Ÿ**

```
é€šä¿—ç†è§£ï¼šè¢«é™æµæ—¶çš„"å¤‡èƒæ–¹æ³•"

æ­£å¸¸æƒ…å†µï¼šç”¨æˆ·è®¿é—® â†’ æ­£å¸¸å¤„ç†
é™æµæ—¶ï¼šç”¨æˆ·è®¿é—® â†’ è°ƒç”¨å¤‡èƒæ–¹æ³• â†’ å‹å¥½æç¤º
```

**å®Œæ•´ç¤ºä¾‹**ï¼š

```java
@RestController
public class OrderController {
    
    /**
     * ä¸»æ–¹æ³•ï¼šæ­£å¸¸ä¸šåŠ¡é€»è¾‘
     */
    @GetMapping("/create")
    @SentinelResource(
        value = "createOrder",           // èµ„æºå
        blockHandler = "createOrderBlock" // é™æµæ—¶è°ƒç”¨çš„æ–¹æ³•
    )
    public String createOrder(String userId) {
        return "è®¢å•åˆ›å»ºæˆåŠŸï¼Œç”¨æˆ·:" + userId;
    }
    
    /**
     * é™æµå¤„ç†æ–¹æ³•ï¼ˆå¤‡èƒæ–¹æ³•ï¼‰
     * 
     * æ³¨æ„äº‹é¡¹ï¼š
     * 1. è¿”å›å€¼å¿…é¡»å’Œä¸»æ–¹æ³•ä¸€æ ·
     * 2. å‚æ•°å¿…é¡»å’Œä¸»æ–¹æ³•ä¸€æ ·ï¼Œæœ€ååŠ BlockException
     * 3. å¿…é¡»æ˜¯public
     * 4. å¿…é¡»æ˜¯staticæˆ–åœ¨åŒä¸€ä¸ªç±»ä¸­
     */
    public String createOrderBlock(String userId, BlockException ex) {
        return "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•";
    }
}
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
è¯·æ±‚åˆ°æ¥
   â†“
æ£€æŸ¥é™æµè§„åˆ™
   â†“
è¶…è¿‡é™åˆ¶ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ è°ƒç”¨createOrderBlock() â†’ è¿”å›"ç³»ç»Ÿç¹å¿™"
   â””â”€ å¦ â†’ è°ƒç”¨createOrder() â†’ è¿”å›"è®¢å•åˆ›å»ºæˆåŠŸ"
```

### 4.4 fallbackå¼‚å¸¸é™çº§


**blockHandler vs fallback çš„åŒºåˆ«**ï¼š

| å¯¹æ¯”é¡¹ | blockHandler | fallback |
|--------|--------------|----------|
| **è§¦å‘æ—¶æœº** | `è¢«Sentinelé™æµ/é™çº§æ—¶` | `ä¸šåŠ¡ä»£ç æŠ›å¼‚å¸¸æ—¶` |
| **å¤„ç†åœºæ™¯** | `æµé‡æ§åˆ¶` | `ä¸šåŠ¡å¼‚å¸¸å…œåº•` |
| **å‚æ•°è¦æ±‚** | `æœ€ååŠ BlockException` | `æœ€ååŠ Throwable` |

**fallbackä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@RestController
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    /**
     * åŒæ—¶é…ç½®blockHandlerå’Œfallback
     */
    @GetMapping("/query")
    @SentinelResource(
        value = "queryOrder",
        blockHandler = "queryOrderBlock",  // é™æµå¤„ç†
        fallback = "queryOrderFallback"     // å¼‚å¸¸å¤„ç†
    )
    public Order queryOrder(Long orderId) {
        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä¸šåŠ¡ä»£ç 
        return orderService.getById(orderId);
    }
    
    /**
     * é™æµæ—¶è°ƒç”¨
     */
    public Order queryOrderBlock(Long orderId, BlockException ex) {
        Order order = new Order();
        order.setMessage("è®¿é—®å¤ªé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
        return order;
    }
    
    /**
     * ä¸šåŠ¡å¼‚å¸¸æ—¶è°ƒç”¨
     */
    public Order queryOrderFallback(Long orderId, Throwable ex) {
        Order order = new Order();
        order.setMessage("è®¢å•æŸ¥è¯¢å¤±è´¥: " + ex.getMessage());
        return order;
    }
}
```

**å®Œæ•´æ‰§è¡Œæµç¨‹**ï¼š
```
è¯·æ±‚è¿›å…¥
   â†“
Sentinelæ£€æŸ¥é™æµè§„åˆ™
   â†“
è§¦å‘é™æµï¼Ÿ
   â”œâ”€ æ˜¯ â†’ è°ƒç”¨blockHandler â†’ è¿”å›é™æµæç¤º
   â””â”€ å¦ â†’ æ‰§è¡Œä¸šåŠ¡æ–¹æ³•
            â†“
         æŠ›å‡ºå¼‚å¸¸ï¼Ÿ
            â”œâ”€ æ˜¯ â†’ è°ƒç”¨fallback â†’ è¿”å›å¼‚å¸¸å…œåº•
            â””â”€ å¦ â†’ æ­£å¸¸è¿”å›ç»“æœ
```

### 4.5 æ³¨è§£å‚æ•°å®Œæ•´è¯´æ˜


```java
@SentinelResource(
    value = "resourceName",              // èµ„æºåç§°ï¼ˆå¿…å¡«ï¼‰
    blockHandler = "handleBlock",        // é™æµé™çº§å¤„ç†æ–¹æ³•
    blockHandlerClass = BlockHandler.class, // å¤„ç†æ–¹æ³•æ‰€åœ¨ç±»
    fallback = "handleFallback",         // å¼‚å¸¸é™çº§å¤„ç†æ–¹æ³•
    fallbackClass = FallbackHandler.class,  // å¼‚å¸¸å¤„ç†æ–¹æ³•æ‰€åœ¨ç±»
    exceptionsToIgnore = {               // å¿½ç•¥çš„å¼‚å¸¸ï¼ˆä¸è§¦å‘fallbackï¼‰
        IllegalArgumentException.class
    }
)
```

**å‚æ•°è¯´æ˜è¡¨**ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `value` | `èµ„æºåç§°ï¼Œå¿…å¡«ï¼Œå…¨å±€å”¯ä¸€` | `"createOrder"` |
| `blockHandler` | `é™æµæ—¶çš„å¤„ç†æ–¹æ³•å` | `"handleBlock"` |
| `fallback` | `å¼‚å¸¸æ—¶çš„é™çº§æ–¹æ³•å` | `"handleFallback"` |
| `exceptionsToIgnore` | `å¿½ç•¥çš„å¼‚å¸¸ç±»å‹` | `IllegalArgumentException.class` |

---

## 5. ğŸ”§ è‡ªåŠ¨é…ç½®åŸç†


### 5.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®


**SpringBootè‡ªåŠ¨é…ç½® - é€šä¿—ç†è§£**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ‰‹åŠ¨é…ç½®ï¼‰ï¼š
ä½ ä¹°äº†æ–°æ‰‹æœº â†’ éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼š
- WiFiè¿æ¥
- é“ƒå£°è®¾ç½®  
- æ˜¾ç¤ºäº®åº¦
- æ¯ä¸ªåŠŸèƒ½éƒ½è¦è‡ªå·±é…

SpringBootæ–¹å¼ï¼ˆè‡ªåŠ¨é…ç½®ï¼‰ï¼š
ä½ ä¹°äº†æ–°æ‰‹æœº â†’ å¼€æœºå°±èƒ½ç”¨ï¼š
- ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹
- è‡ªåŠ¨é…ç½®å¸¸ç”¨è®¾ç½®
- åªéœ€æ”¹ä¸æ»¡æ„çš„
```

### 5.2 Sentinelè‡ªåŠ¨é…ç½®è¿‡ç¨‹


**Sentinelå¯åŠ¨æµç¨‹å›¾**ï¼š

```
åº”ç”¨å¯åŠ¨
   â†“
SpringBootæ£€æµ‹classpath
   â†“
å‘ç°sentinelä¾èµ–ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ åŠ è½½SentinelAutoConfiguration
   |       â†“
   |    è¯»å–application.ymlé…ç½®
   |       â†“
   |    åˆ›å»ºå¿…è¦çš„Bean
   |       â”œâ”€ SentinelResourceAspectï¼ˆAOPæ‹¦æˆªå™¨ï¼‰
   |       â”œâ”€ SentinelWebInterceptorï¼ˆWebæ‹¦æˆªå™¨ï¼‰  
   |       â””â”€ HeartbeatSenderï¼ˆå¿ƒè·³å‘é€å™¨ï¼‰
   |       â†“
   |    è¿æ¥Dashboardæ§åˆ¶å°
   |       â†“
   |    Sentinelå‡†å¤‡å°±ç»ª âœ…
   |
   â””â”€ å¦ â†’ è·³è¿‡Sentinelé…ç½®
```

### 5.3 è‡ªåŠ¨é…ç½®ç±»è¯¦è§£


**æ ¸å¿ƒè‡ªåŠ¨é…ç½®ç±»**ï¼š

| é…ç½®ç±» | ä½œç”¨ | ä½•æ—¶ç”Ÿæ•ˆ |
|--------|------|---------|
| `SentinelAutoConfiguration` | `ä¸»é…ç½®ç±»ï¼Œåˆ›å»ºæ ¸å¿ƒBean` | `å¼•å…¥sentinelä¾èµ–å` |
| `SentinelWebAutoConfiguration` | `Webç›¸å…³é…ç½®` | `æ£€æµ‹åˆ°Webç¯å¢ƒæ—¶` |
| `SentinelAspectConfiguration` | `AOPåˆ‡é¢é…ç½®` | `å¯ç”¨@SentinelResourceæ—¶` |

**è‡ªåŠ¨é…ç½®çš„Bean**ï¼š

```java
// SpringBootè‡ªåŠ¨åˆ›å»ºè¿™äº›Beanï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å†™

@Bean
public SentinelResourceAspect sentinelResourceAspect() {
    // å¤„ç†@SentinelResourceæ³¨è§£çš„åˆ‡é¢
    return new SentinelResourceAspect();
}

@Bean  
public SentinelWebInterceptor sentinelWebInterceptor() {
    // æ‹¦æˆªHTTPè¯·æ±‚çš„æ‹¦æˆªå™¨
    return new SentinelWebInterceptor();
}

@Bean
public HeartbeatSender heartbeatSender() {
    // å®šæ—¶å‘Dashboardå‘é€å¿ƒè·³
    return new HeartbeatSender();
}
```

### 5.4 é…ç½®ç”Ÿæ•ˆæ¡ä»¶


**@ConditionalOnProperty æ¡ä»¶è£…é…**ï¼š

```java
// Sentinelè‡ªåŠ¨é…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶
@Configuration
@ConditionalOnProperty(
    name = "spring.cloud.sentinel.enabled", 
    matchIfMissing = true  // å¦‚æœä¸é…ç½®ï¼Œé»˜è®¤true
)
public class SentinelAutoConfiguration {
    // é…ç½®å†…å®¹
}
```

**æ¡ä»¶è¯´æ˜**ï¼š

```yaml
# æƒ…å†µ1ï¼šä¸é…ç½®ï¼ˆé»˜è®¤å¼€å¯ï¼‰
# spring.cloud.sentinel.enabled ä¸å†™
# ç»“æœï¼šSentinelè‡ªåŠ¨é…ç½®ç”Ÿæ•ˆ âœ…

# æƒ…å†µ2ï¼šæ˜¾å¼å¼€å¯
spring:
  cloud:
    sentinel:
      enabled: true
# ç»“æœï¼šSentinelè‡ªåŠ¨é…ç½®ç”Ÿæ•ˆ âœ…

# æƒ…å†µ3ï¼šæ˜¾å¼å…³é—­
spring:
  cloud:
    sentinel:
      enabled: false
# ç»“æœï¼šSentinelè‡ªåŠ¨é…ç½®ä¸ç”Ÿæ•ˆ âŒ
```

---

## 6. ğŸ¥ å¥åº·æ£€æŸ¥ä¸ç›‘æ§


### 6.1 å¥åº·æ£€æŸ¥æœºåˆ¶


**ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥ï¼Ÿ**

```
é€šä¿—ç†è§£ï¼šå®šæœŸ"ä½“æ£€"ä½ çš„æœåŠ¡

å°±åƒä½“æ£€ä¸­å¿ƒï¼š
- æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥èº«ä½“æŒ‡æ ‡
- å‘ç°é—®é¢˜åŠæ—¶é¢„è­¦
- ä¿æŒå¥åº·çŠ¶æ€

Sentinelå¥åº·æ£€æŸ¥ï¼š
- æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥æœåŠ¡çŠ¶æ€
- å‘ç°å¼‚å¸¸åŠæ—¶ä¸ŠæŠ¥
- ä¿è¯æœåŠ¡å¯ç”¨
```

### 6.2 å¿ƒè·³æœºåˆ¶è¯¦è§£


**å¿ƒè·³å‘é€æµç¨‹**ï¼š

```
ä½ çš„æœåŠ¡                      Sentinel Dashboard
   |                               |
   |---[1]å¯åŠ¨æ—¶å‘é€æ³¨å†Œä¿¡æ¯------â†’|
   |                               |
   |â†--[2]Dashboardç¡®è®¤æ³¨å†Œ--------|
   |                               |
   |---[3]æ¯10ç§’å‘é€å¿ƒè·³----------â†’|
   |   (æˆ‘è¿˜æ´»ç€ï¼)                 |
   |                               |
   |â†--[4]Dashboardè®°å½•å¿ƒè·³--------|
   |                               |
   |   (30ç§’æ²¡å¿ƒè·³ï¼Ÿ)               |
   |                               |
   |                        æ ‡è®°æœåŠ¡ç¦»çº¿ âš ï¸
```

**å¿ƒè·³æ•°æ®å†…å®¹**ï¼š

```json
{
  "app": "order-service",      // åº”ç”¨å
  "ip": "192.168.1.100",       // æœåŠ¡IP
  "port": 8719,                // å®¢æˆ·ç«¯ç«¯å£
  "heartbeatIntervalMs": 10000,// å¿ƒè·³é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  "version": "1.8.6"           // Sentinelç‰ˆæœ¬
}
```

### 6.3 SpringBoot Actuatoré›†æˆ


**æ·»åŠ å¥åº·æ£€æŸ¥ä¾èµ–**ï¼š

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**é…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹**ï¼š

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,sentinel  # æš´éœ²çš„ç«¯ç‚¹
  
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
```

**è®¿é—®å¥åº·æ£€æŸ¥**ï¼š

```bash
# æŸ¥çœ‹æ•´ä½“å¥åº·çŠ¶æ€
curl http://localhost:8001/actuator/health

# è¿”å›ç»“æœç¤ºä¾‹ï¼š
{
  "status": "UP",
  "components": {
    "sentinel": {
      "status": "UP",
      "details": {
        "dashboard": "connected",     // Dashboardè¿æ¥çŠ¶æ€
        "blockedRequests": 156,       // è¢«é™æµçš„è¯·æ±‚æ•°
        "passedRequests": 98544       // é€šè¿‡çš„è¯·æ±‚æ•°
      }
    }
  }
}
```

### 6.4 è‡ªå®šä¹‰å¥åº·æŒ‡æ ‡


**æ·»åŠ è‡ªå®šä¹‰å¥åº·æ£€æŸ¥**ï¼š

```java
@Component
public class SentinelHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        // æ£€æŸ¥Sentinelæ˜¯å¦æ­£å¸¸å·¥ä½œ
        boolean isHealthy = checkSentinelStatus();
        
        if (isHealthy) {
            return Health.up()
                .withDetail("dashboard", "connected")
                .withDetail("rules", getRulesCount())
                .build();
        } else {
            return Health.down()
                .withDetail("error", "Dashboardè¿æ¥å¤±è´¥")
                .build();
        }
    }
    
    private boolean checkSentinelStatus() {
        // æ£€æŸ¥é€»è¾‘
        return true;
    }
    
    private int getRulesCount() {
        // è·å–è§„åˆ™æ•°é‡
        return FlowRuleManager.getRules().size();
    }
}
```

### 6.5 ç›‘æ§æ•°æ®æŸ¥çœ‹


**Dashboardç›‘æ§é¢æ¿**ï¼š

```
å®æ—¶ç›‘æ§æ•°æ®ï¼š

ğŸ“Š QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
   â”œâ”€ é€šè¿‡QPSï¼šæˆåŠŸå¤„ç†çš„è¯·æ±‚
   â”œâ”€ æ‹’ç»QPSï¼šè¢«é™æµçš„è¯·æ±‚
   â””â”€ å¼‚å¸¸QPSï¼šå‡ºé”™çš„è¯·æ±‚

â±ï¸ å“åº”æ—¶é—´
   â”œâ”€ å¹³å‡RTï¼šå¹³å‡å“åº”æ—¶é—´
   â”œâ”€ æœ€å¤§RTï¼šæœ€æ…¢çš„è¯·æ±‚
   â””â”€ æˆåŠŸç‡ï¼šè¯·æ±‚æˆåŠŸæ¯”ä¾‹

ğŸ“ˆ èµ„æºè°ƒç”¨é“¾è·¯
   â”œâ”€ è°ƒç”¨æ¥æº
   â”œâ”€ è°ƒç”¨æ¬¡æ•°
   â””â”€ èµ„æºå…³ç³»
```

**ç›‘æ§æ•°æ®çº§åˆ«**ï¼š

| ç›‘æ§ç»´åº¦ | è¯´æ˜ | ç”¨é€” |
|---------|------|------|
| â­ **ç§’çº§** | `æ¯ç§’ç»Ÿè®¡ä¸€æ¬¡` | `å®æ—¶ç›‘æ§` |
| â­ **åˆ†é’Ÿçº§** | `æ¯åˆ†é’Ÿèšåˆæ•°æ®` | `è¶‹åŠ¿åˆ†æ` |
| â­ **å°æ—¶çº§** | `æ¯å°æ—¶æ±‡æ€»` | `å®¹é‡è§„åˆ’` |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é›†æˆæœ¬è´¨ï¼šç»™SpringBootåº”ç”¨åŠ ä¸ŠSentinelä¿æŠ¤
ğŸ”¸ æ ¸å¿ƒä¾èµ–ï¼šspring-cloud-starter-alibaba-sentinel
ğŸ”¸ é…ç½®è¦ç‚¹ï¼šdashboardåœ°å€ã€ç«¯å£ã€å¼€å…³
ğŸ”¸ @SentinelResourceï¼šæ ‡è¯†éœ€è¦ä¿æŠ¤çš„èµ„æº
ğŸ”¸ è‡ªåŠ¨é…ç½®ï¼šSpringBootè‡ªåŠ¨å®Œæˆ90%çš„é…ç½®
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šé€šè¿‡å¿ƒè·³ä¿æŒè¿æ¥ï¼Œé€šè¿‡ActuatoræŸ¥çœ‹çŠ¶æ€
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¾èµ–çš„ä½œç”¨**
```
spring-cloud-starter-alibaba-sentinelï¼š
- ä¸æ˜¯å•çº¯ä¸€ä¸ªjaråŒ…
- æ˜¯ä¸€æ•´å¥—è§£å†³æ–¹æ¡ˆ
- åŒ…å«æ ¸å¿ƒåŠŸèƒ½+é€‚é…+è‡ªåŠ¨é…ç½®
- åšåˆ°å¼€ç®±å³ç”¨
```

**ğŸ”¹ é…ç½®çš„æœ¬è´¨**
```
application.ymlé…ç½®ï¼š
- å‘Šè¯‰æœåŠ¡"æ§åˆ¶å°åœ¨å“ª"
- å‘Šè¯‰æœåŠ¡"ç”¨å“ªä¸ªç«¯å£é€šä¿¡"  
- å‘Šè¯‰æœåŠ¡"æ˜¯å¦å¼€å¯ä¿æŠ¤"
- å°±åƒç»™è®¾å¤‡å†™ä½¿ç”¨è¯´æ˜ä¹¦
```

**ğŸ”¹ æ³¨è§£çš„ç†è§£**
```
@SentinelResourceæ³¨è§£ï¼š
- ä¸æ˜¯é­”æ³•ï¼Œæ˜¯æ ‡è®°
- æ ‡è®°åæ‰èƒ½è¢«Sentinelç®¡ç†
- blockHandlerå¤„ç†é™æµ
- fallbackå¤„ç†å¼‚å¸¸
- ä¸¤è€…å¯ä»¥åŒæ—¶ä½¿ç”¨
```

**ğŸ”¹ è‡ªåŠ¨é…ç½®çš„ä»·å€¼**
```
è‡ªåŠ¨é…ç½®çš„æ„ä¹‰ï¼š
- å¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡
- æ¡†æ¶è‡ªåŠ¨å®Œæˆé›†æˆ
- çº¦å®šä¼˜äºé…ç½®
- ç‰¹æ®Šéœ€æ±‚æ‰æ‰‹åŠ¨è°ƒæ•´
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é›†æˆæ­¥éª¤checklist**ï¼š
- [ ] æ·»åŠ Mavenä¾èµ–
- [ ] é…ç½®application.yml
- [ ] å¯åŠ¨Sentinel Dashboard
- [ ] åœ¨æ–¹æ³•ä¸ŠåŠ @SentinelResource
- [ ] è®¿é—®DashboardæŸ¥çœ‹æ˜¯å¦è¿æ¥æˆåŠŸ

**âš ï¸ å¸¸è§é—®é¢˜**ï¼š

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| `Dashboardçœ‹ä¸åˆ°æœåŠ¡` | `æœªé…ç½®dashboardåœ°å€` | `æ£€æŸ¥application.ymlé…ç½®` |
| `ç«¯å£å†²çª` | `8719ç«¯å£è¢«å ç”¨` | `ä¿®æ”¹porté…ç½®æˆ–é‡Šæ”¾ç«¯å£` |
| `æ³¨è§£ä¸ç”Ÿæ•ˆ` | `æ²¡æœ‰è®¿é—®è¿‡æ¥å£` | `æ‡’åŠ è½½ï¼Œè®¿é—®ä¸€æ¬¡åç”Ÿæ•ˆ` |
| `blockHandleræ‰¾ä¸åˆ°` | `æ–¹æ³•ç­¾åä¸åŒ¹é…` | `æ£€æŸ¥è¿”å›å€¼å’Œå‚æ•°æ˜¯å¦ä¸€è‡´` |

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š

```java
// âœ… æ¨èå†™æ³•ï¼šç»Ÿä¸€ç®¡ç†é™çº§æ–¹æ³•
@RestController
public class OrderController {
    
    @GetMapping("/create")
    @SentinelResource(
        value = "createOrder",
        blockHandler = "handleBlock",
        fallback = "handleFallback"
    )
    public Result createOrder(OrderDTO dto) {
        return orderService.create(dto);
    }
    
    // é™çº§æ–¹æ³•ç»Ÿä¸€è¿”å›Resultæ ¼å¼
    public Result handleBlock(OrderDTO dto, BlockException ex) {
        return Result.fail("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
    
    public Result handleFallback(OrderDTO dto, Throwable ex) {
        log.error("è®¢å•åˆ›å»ºå¤±è´¥", ex);
        return Result.fail("è®¢å•åˆ›å»ºå¤±è´¥");
    }
}
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Sentinelé›†æˆå°±æ˜¯åŠ ä¾èµ–ã€åŠ é…ç½®ã€åŠ æ³¨è§£
- è‡ªåŠ¨é…ç½®è®©ä¸€åˆ‡å˜ç®€å•ï¼Œä¸éœ€è¦å¤æ‚é…ç½®
- @SentinelResourceæ˜¯æ ¸å¿ƒï¼Œæ ‡è®°èµ„æºæ‰èƒ½ä¿æŠ¤
- Dashboardæ˜¯ç®¡ç†ä¸­å¿ƒï¼Œå®æ—¶æŸ¥çœ‹ç›‘æ§æ•°æ®
- å¥åº·æ£€æŸ¥ä¿è¯æœåŠ¡çŠ¶æ€ï¼Œå¿ƒè·³æœºåˆ¶ä¿æŒè¿æ¥