---
title: 8、监控数据分析
---
## 📚 目录

1. [监控数据概述](#1-监控数据概述)
2. [QPS监控详解](#2-QPS监控详解)
3. [响应时间分析](#3-响应时间分析)
4. [异常统计解读](#4-异常统计解读)
5. [通过率与拒绝率](#5-通过率与拒绝率)
6. [实时数据监控](#6-实时数据监控)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 📊 监控数据概述


### 1.1 什么是Sentinel监控


**通俗理解**：就像给你的服务装了一个"健康监测仪"

```
现实类比：
体检中心的仪表盘          →    Sentinel控制台
├─ 血压、心率数据          →    QPS、响应时间
├─ 异常指标提醒           →    异常统计
└─ 实时健康状态           →    实时监控数据

目的：随时掌握服务的"健康状况"
```

**核心作用**：
- 🔍 **实时观察** - 服务运行情况一目了然
- 📈 **数据分析** - 发现性能瓶颈和异常
- 🛡️ **预警保护** - 提前发现问题，及时干预

### 1.2 监控数据的六大维度


```
监控维度全景图：

客户端请求 → Sentinel → 服务处理
    ↓          ↓          ↓
 [监控采集] [数据统计] [结果展示]
    
六大核心指标：
┌─────────────────────────────────────┐
│ ① QPS          - 每秒请求量         │
│ ② 响应时间      - 处理耗时          │
│ ③ 异常统计      - 错误情况          │
│ ④ 通过率        - 成功比例          │
│ ⑤ 拒绝率        - 限流比例          │
│ ⑥ 实时数据      - 当前状态          │
└─────────────────────────────────────┘
```

---

## 2. ⚡ QPS监控详解


### 2.1 QPS是什么


**QPS = Queries Per Second（每秒查询率）**

**白话解释**：
- 就是统计**一秒钟内有多少个请求**访问你的服务
- 类比：超市收银台一分钟能处理多少个顾客

```
场景示例：

10:00:00 - 10:00:01 这一秒内：
用户A：访问商品详情  ✓
用户B：访问商品详情  ✓
用户C：访问订单列表  ✓
用户D：访问商品详情  ✓
用户E：访问购物车    ✓

QPS = 5（这一秒处理了5个请求）
```

### 2.2 QPS监控的价值


**📊 数据含义对照表**

| QPS数值 | 服务状态 | 说明 | 应对策略 |
|---------|---------|------|----------|
| **0-100** | 🟢 空闲 | 服务压力很小 | 正常运行 |
| **100-500** | 🟡 正常 | 适度负载 | 保持观察 |
| **500-1000** | 🟠 繁忙 | 接近极限 | 准备扩容 |
| **>1000** | 🔴 过载 | 可能崩溃 | 启动限流 |

**实际应用场景**：

```
电商秒杀场景：
正常时段：QPS = 200   → 服务稳定
秒杀开始：QPS = 5000  → 流量暴增
未限流后果：服务宕机  → 全面崩溃

有Sentinel保护：
QPS超过1000  → 触发限流
多余请求排队  → 服务平稳
返回友好提示  → 用户体验好
```

### 2.3 控制台如何查看QPS


**查看步骤**：

```
① 打开Sentinel控制台
   ↓
② 选择应用名称（如：order-service）
   ↓
③ 点击"实时监控"菜单
   ↓
④ 看到QPS曲线图

图表展示：
时间轴 →  10:00  10:01  10:02  10:03
         ────────────────────────
QPS ↑    |     ╱╲    
1000|    |    ╱  ╲   ← 秒杀高峰
 500|   ╱      ╲╱
   0|──────────────────→ 时间
```

**关键观察点**：
- 🔸 **峰值时刻** - QPS突然飙高的时间点
- 🔸 **平均值** - 服务的常态负载
- 🔸 **波动幅度** - 流量是否稳定

---

## 3. ⏱️ 响应时间分析


### 3.1 响应时间的含义


**响应时间（Response Time，RT）**：从发起请求到收到结果的时间

**生活类比**：
```
点外卖的等待时间：
下单时间：12:00:00
送达时间：12:30:00
响应时间 = 30分钟

服务请求的响应时间：
请求发出：10:00:00.100
结果返回：10:00:00.350
响应时间 = 250ms
```

### 3.2 响应时间分级标准


**⏰ 性能分级表**

| 响应时间 | 用户感知 | 服务评级 | 优化建议 |
|----------|---------|---------|----------|
| **< 100ms** | 😊 无感知 | 优秀 | 保持现状 |
| **100-500ms** | 🙂 可接受 | 良好 | 持续优化 |
| **500ms-1s** | 😐 稍慢 | 一般 | 需要优化 |
| **1-3s** | 😣 明显慢 | 较差 | 立即优化 |
| **> 3s** | 😡 难以忍受 | 很差 | 紧急处理 |

### 3.3 响应时间监控实战


**控制台展示说明**：

```
资源名称         平均RT    最大RT    最小RT
────────────────────────────────────────
/api/product     120ms     350ms     80ms
/api/order       450ms     800ms     200ms
/api/pay         2000ms    5000ms    1500ms  ⚠️超时风险

分析结果：
✅ 商品接口：性能优秀
⚠️  订单接口：需要关注  
🔴 支付接口：存在性能问题
```

**优化方向提示**：
- 🔸 **RT < 100ms** → 无需优化
- 🔸 **RT 100-500ms** → 考虑添加缓存
- 🔸 **RT > 500ms** → 检查数据库查询、网络调用

---

## 4. ⚠️ 异常统计解读


### 4.1 异常统计是什么


**通俗说明**：记录服务运行过程中发生的各种错误

```
异常类比 - 快递配送：
正常配送：包裹送达         → 请求成功
地址错误：无法投递         → 业务异常
包裹丢失：配送失败         → 系统异常
超时未送：配送超时         → 超时异常
```

### 4.2 异常类型与含义


**🔍 常见异常分类**

```
异常分类树：
异常统计
├─ 业务异常（40%）
│  ├─ 参数校验失败    → 用户输入错误
│  ├─ 库存不足        → 商品已售罄
│  └─ 账户余额不足    → 支付金额不够
│
├─ 系统异常（30%）  
│  ├─ 数据库连接失败  → DB服务问题
│  ├─ 空指针异常      → 代码bug
│  └─ 网络超时        → 服务调用失败
│
└─ 限流异常（30%）
   ├─ 触发流控规则    → QPS超限
   └─ 触发熔断规则    → 服务降级
```

### 4.3 异常统计数据解读


**控制台展示示例**：

```
时间段：2025-01-15 10:00-11:00
资源：/api/order/create

异常类型              数量    占比    趋势
─────────────────────────────────────────
参数校验异常          150     30%    ↑ 上升
库存不足异常          100     20%    → 平稳
数据库超时异常         50     10%    ↓ 下降
限流异常 (FlowException) 200   40%    ↑ 上升

⚠️ 关键发现：
- 限流异常占比最高 → 流量激增，规则生效
- 参数异常上升 → 可能是恶意请求
- 数据库超时下降 → 优化见效
```

**异常数据的价值**：
- ✅ **发现代码bug** - 系统异常高说明代码有问题
- ✅ **识别攻击行为** - 参数异常激增可能是攻击
- ✅ **验证限流效果** - 限流异常说明保护机制生效

---

## 5. 📊 通过率与拒绝率


### 5.1 核心概念对比


**通过率 vs 拒绝率 - 一体两面**

```
请求处理结果：

总请求量 = 1000
    ↓
┌─────────┬─────────┐
│ 通过：700│ 拒绝：300│
└─────────┴─────────┘
    ↓          ↓
通过率=70%  拒绝率=30%

关系：通过率 + 拒绝率 = 100%
```

**通俗理解**：
- **通过率** = 成功进入服务处理的请求比例
- **拒绝率** = 被限流/熔断拦截的请求比例

### 5.2 数据指标详解


**📈 健康指标对照**

| 通过率 | 拒绝率 | 服务状态 | 说明 |
|--------|--------|---------|------|
| **>95%** | <5% | 🟢 健康 | 服务运行正常 |
| **80-95%** | 5-20% | 🟡 预警 | 开始触发限流 |
| **50-80%** | 20-50% | 🟠 繁忙 | 大量请求被拒 |
| **<50%** | >50% | 🔴 保护 | 强制保护模式 |

### 5.3 实际场景案例


**案例1：秒杀活动监控**

```
活动前（10:00前）：
总请求：100/s
通过率：98% ✅
拒绝率：2%
状态：正常

秒杀开始（10:00:00）：
总请求：5000/s  ↑ 暴增50倍
通过率：20%     ↓ 大幅下降  
拒绝率：80%     ↑ 限流生效
状态：保护模式启动 ✓

说明：
- 限流规则成功保护服务
- 80%请求被拒，避免服务崩溃
- 20%请求正常处理，保证核心功能
```

**案例2：数据异常分析**

```
观察到的数据：
时间     通过率   拒绝率   分析
────────────────────────────────
09:00    95%     5%      正常运行
10:00    85%     15%     ⚠️ 流量上升
11:00    60%     40%     🔴 触发限流
12:00    30%     70%     🚨 保护模式

排查方向：
① 检查是否有营销活动 → 正常流量
② 查看异常请求来源   → 可能攻击
③ 评估限流阈值设置   → 规则调整
```

---

## 6. 📡 实时数据监控


### 6.1 实时监控的意义


**为什么需要实时监控**？

```
传统方式（事后发现）：
服务崩溃 → 用户投诉 → 查日志 → 定位问题
时间：30分钟以上 ❌

实时监控（提前预警）：
数据异常 → 实时告警 → 立即处理 → 避免崩溃  
时间：1-2分钟 ✅

价值：
- 问题发现速度提升 15倍
- 用户体验损失降低 90%
- 运维响应效率提高 80%
```

### 6.2 实时数据面板


**控制台实时视图**：

```
┌─────────────────────────────────────┐
│     订单服务 - 实时监控面板          │
├─────────────────────────────────────┤
│                                     │
│  🔵 当前QPS：  856  ────────────↗   │
│  ⏱️  平均RT：   120ms              │
│  ✅ 通过率：    92%                │
│  ❌ 拒绝率：    8%                 │
│  ⚠️  异常数：    12/min            │
│                                     │
│  资源TOP5：                         │
│  /api/order/list      QPS: 320    │
│  /api/order/detail    QPS: 280    │
│  /api/order/create    QPS: 150    │
│  /api/order/update    QPS: 80     │
│  /api/order/cancel    QPS: 26     │
│                                     │
└─────────────────────────────────────┘

刷新频率：每2秒自动更新
```

### 6.3 实时监控使用技巧


**👀 重点观察指标**

```
监控优先级：

🔴 一级指标（必看）：
- QPS突增突降      → 流量异常
- 响应时间飙升      → 性能问题
- 异常数激增        → 故障征兆

🟡 二级指标（关注）：
- 通过率持续下降    → 限流频繁
- 拒绝率持续上升    → 压力过大

🟢 三级指标（参考）：
- 资源排名变化      → 业务趋势
- 历史数据对比      → 长期规律
```

**实战监控策略**：

| 时间段 | 监控重点 | 预警阈值 | 处理措施 |
|--------|---------|---------|----------|
| **业务高峰期** | QPS、RT | QPS>80%峰值 | 准备限流 |
| **活动期间** | 拒绝率 | 拒绝率>30% | 调整规则 |
| **日常时段** | 异常数 | 异常>100/min | 排查问题 |
| **夜间时段** | 全指标 | 任何异常波动 | 可能攻击 |

### 6.4 告警配置建议


**🚨 告警级别设置**

```
告警规则配置：

P0 紧急告警（立即处理）：
- QPS 突增 > 3倍正常值
- 响应时间 > 3秒
- 异常率 > 50%
→ 短信 + 电话通知

P1 重要告警（10分钟内）：
- QPS 持续高位 > 80%阈值
- 响应时间 > 1秒  
- 拒绝率 > 40%
→ 短信 + 企业微信

P2 一般告警（30分钟内）：
- 拒绝率 > 20%
- 异常数 > 100/min
→ 邮件 + 企业微信

P3 提示告警（当天处理）：
- 数据波动异常
- 资源使用率变化
→ 仅邮件通知
```

---

## 7. 📋 核心要点总结


### 7.1 六大监控指标速查


```
📊 监控指标记忆卡片：

┌──────────────────────────────┐
│ QPS（流量）                   │
│ 含义：每秒请求数              │
│ 作用：判断服务压力            │
│ 告警：突增/突降               │
└──────────────────────────────┘

┌──────────────────────────────┐
│ 响应时间（性能）              │
│ 含义：请求处理耗时            │
│ 作用：评估服务性能            │
│ 告警：>1秒需关注              │
└──────────────────────────────┘

┌──────────────────────────────┐
│ 异常统计（故障）              │
│ 含义：错误发生情况            │
│ 作用：发现代码/配置问题        │
│ 告警：异常率>10%              │
└──────────────────────────────┘

┌──────────────────────────────┐
│ 通过率（成功率）              │
│ 含义：请求成功比例            │
│ 作用：评估服务健康度          │
│ 告警：<80%需处理              │
└──────────────────────────────┘

┌──────────────────────────────┐
│ 拒绝率（限流率）              │
│ 含义：被拦截请求比例          │
│ 作用：验证限流效果            │
│ 告警：>50%检查规则            │
└──────────────────────────────┘

┌──────────────────────────────┐
│ 实时数据（当前状态）          │
│ 含义：服务实时运行情况        │
│ 作用：即时发现问题            │
│ 告警：任何异常波动            │
└──────────────────────────────┘
```

### 7.2 监控数据解读口诀


```
📝 快速判断口诀：

QPS看流量，高低皆异常
响应时间慢，性能出问题
异常数量多，代码要排查
通过率太低，限流在生效
拒绝率过高，规则需调整
实时盯数据，问题早发现
```

### 7.3 实战应用场景


**🎯 典型问题诊断**

```
场景1：服务响应慢
观察数据：
- QPS：正常
- RT：突然升高 ↑
- 异常：无明显增加

诊断：性能瓶颈
处理：① 检查数据库慢查询
     ② 排查外部接口超时
     ③ 分析代码性能问题

场景2：大量请求失败  
观察数据：
- QPS：正常
- RT：正常
- 异常：大量增加 ↑
- 拒绝率：低

诊断：业务逻辑异常
处理：① 查看异常日志
     ② 检查依赖服务
     ③ 验证业务规则

场景3：流量突增
观察数据：
- QPS：暴增 ↑↑↑
- RT：升高
- 拒绝率：大幅上升 ↑

诊断：限流保护生效
处理：① 确认是否正常活动
     ② 评估限流阈值
     ③ 必要时扩容服务
```

### 7.4 监控最佳实践


**✅ 日常运维建议**

```
每日检查清单：
□ 查看昨日峰值QPS，与历史对比
□ 检查响应时间趋势，是否有劣化
□ 统计异常类型分布，重点问题优先
□ 分析通过率/拒绝率，评估规则合理性
□ 关注实时数据，及时发现异常

每周优化任务：
□ 分析一周数据趋势
□ 调整不合理的限流规则  
□ 优化响应时间慢的接口
□ 处理重复出现的异常
□ 准备业务高峰期预案

重大活动前：
□ 提前调整限流阈值
□ 配置多级告警规则
□ 准备应急处理方案
□ 演练故障处理流程
```

**核心记忆要点**：
- 监控数据是服务的"体检报告"
- 六大指标各有侧重，综合分析
- 实时监控比事后排查价值大
- 数据异常要快速定位原因
- 监控+告警+处理形成闭环