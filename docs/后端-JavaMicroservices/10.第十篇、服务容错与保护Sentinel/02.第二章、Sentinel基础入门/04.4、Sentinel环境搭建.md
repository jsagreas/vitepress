---
title: 4、Sentinel环境搭建
---
## 📚 目录导航

1. [Sentinel是什么](#1-sentinel是什么)
2. [环境准备工作](#2-环境准备工作)
3. [方式一：Maven依赖接入](#3-方式一maven依赖接入)
4. [方式二：控制台Dashboard部署](#4-方式二控制台dashboard部署)
5. [连接与配置](#5-连接与配置)
6. [本地测试验证](#6-本地测试验证)
7. [常见问题解决](#7-常见问题解决)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 Sentinel是什么


### 1.1 通俗理解Sentinel


**🌰 生活类比**：想象你家门口有个保安，当人太多时会限制进入人数，防止房子被挤爆。Sentinel就是微服务系统的"保安"。

```
没有Sentinel的情况：
用户请求 ──▶ 服务 ──▶ 💥崩溃（请求太多扛不住）

有Sentinel保护：
用户请求 ──▶ Sentinel检查 ──▶ 服务（安全运行）
              │
              ▼
         超出限制的请求被拦截
```

### 1.2 核心功能说明


**🔸 流量控制（限流）**
- **作用**：控制访问速度，就像高速公路收费站限制通行速度
- **例子**：规定每秒最多处理100个请求

**🔸 熔断降级**
- **作用**：服务出问题时自动切断，防止故障扩散
- **例子**：支付服务挂了，自动提示"系统繁忙"而不是一直等待

**🔸 系统保护**
- **作用**：监控系统负载，过载时自动保护
- **例子**：CPU使用率超80%时拒绝新请求

---

## 2. 🛠️ 环境准备工作


### 2.1 前置条件检查


**📋 需要准备的环境**

| 环境组件 | **版本要求** | **作用说明** | **检查命令** |
|---------|------------|-------------|-------------|
| `JDK` | `1.8+` | Java运行环境 | `java -version` |
| `Maven` | `3.5+` | 项目构建工具 | `mvn -v` |
| `Spring Boot` | `2.0+` | 微服务框架 | `查看pom.xml` |

**🔍 快速检查方式**

打开命令行，依次输入：

```bash
# 检查Java版本

java -version

# 检查Maven版本  

mvn -v
```

> 💡 **新手提示**  
> 如果命令提示"找不到"，说明对应软件还没安装或没配置环境变量，需要先去安装。

### 2.2 Sentinel两种使用方式


```
方式一：代码集成（Maven依赖）
├─ 优点：轻量级，直接在项目中使用
├─ 适合：简单项目，快速上手
└─ 缺点：看不到可视化界面

方式二：控制台Dashboard
├─ 优点：有可视化管理界面，方便配置
├─ 适合：生产环境，团队协作
└─ 需要：额外启动一个控制台程序
```

---

## 3. 📦 方式一：Maven依赖接入


### 3.1 添加核心依赖


**🔸 理解pom.xml**：这是Maven项目的配置文件，就像是告诉Maven"我需要哪些工具包"

在你的项目`pom.xml`文件中添加：

```xml
<dependencies>
    <!-- Sentinel核心库 -->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
        <version>2.2.9.RELEASE</version>
    </dependency>
</dependencies>
```

> 💡 **这段配置的意思**  
> 告诉Maven："帮我下载Sentinel这个保护工具，版本是2.2.9"

### 3.2 配置文件设置


**🔸 理解application.yml**：这是Spring Boot的配置文件，用来告诉程序怎么运行

在`application.yml`中添加基础配置：

```yaml
server:
  port: 8080  # 你的服务端口

spring:
  application:
    name: order-service  # 给你的服务起个名字
  
  cloud:
    sentinel:
      transport:
        port: 8719  # Sentinel监控端口
        dashboard: localhost:8080  # 控制台地址（后面会讲）
```

**📖 配置含义解释**：
- `port: 8719`：Sentinel用这个端口和你的应用通信
- `dashboard: localhost:8080`：控制台在哪里（暂时可以不配）

### 3.3 简单使用示例


**🔸 第一个保护规则**

创建一个Controller测试：

```java
@RestController
public class HelloController {
    
    // @SentinelResource 表示这个方法需要Sentinel保护
    // value = "hello" 是给这个资源起的名字
    @SentinelResource(value = "hello")
    @GetMapping("/hello")
    public String hello() {
        return "Hello Sentinel!";
    }
}
```

> 🧠 **理解@SentinelResource**  
> 就像给这个方法贴了个标签，告诉Sentinel："这个方法需要你保护"

**🔸 添加限流规则（代码方式）**

```java
@PostConstruct  // 程序启动时执行
public void initFlowRules() {
    List<FlowRule> rules = new ArrayList<>();
    
    // 创建一条限流规则
    FlowRule rule = new FlowRule();
    rule.setResource("hello");  // 保护哪个资源
    rule.setGrade(RuleConstant.FLOW_GRADE_QPS);  // 按QPS限流
    rule.setCount(2);  // 每秒最多2个请求
    
    rules.add(rule);
    FlowRuleManager.loadRules(rules);  // 加载规则
}
```

**📊 规则参数说明**：

| 参数 | **含义** | **通俗解释** |
|-----|---------|-------------|
| `Resource` | 资源名称 | 保护谁 |
| `QPS` | 每秒请求数 | 一秒能处理多少请求 |
| `Count` | 阈值 | 限制的数量 |

---

## 4. 🖥️ 方式二：控制台Dashboard部署


### 4.1 为什么需要Dashboard


**🎨 可视化的好处**：

```
没有Dashboard：
├─ 规则要写代码配置
├─ 看不到实时数据
└─ 调试不方便

有了Dashboard：
├─ 网页上点点鼠标就能配置
├─ 实时看到流量监控图表
└─ 规则管理更直观
```

### 4.2 下载控制台


**🔸 方式一：直接下载jar包**

访问官方GitHub：
```
https://github.com/alibaba/Sentinel/releases
```

找到最新版本，下载`sentinel-dashboard-x.x.x.jar`文件

**🔸 方式二：Maven构建（稍复杂，建议方式一）**

```bash
git clone https://github.com/alibaba/Sentinel.git
cd sentinel/sentinel-dashboard
mvn clean package
```

### 4.3 启动控制台


**🚀 启动命令**

打开命令行，进入jar包所在目录：

```bash
java -Dserver.port=8080 -jar sentinel-dashboard-1.8.6.jar
```

**📖 命令解释**：
- `-Dserver.port=8080`：控制台运行在8080端口
- `-jar`：运行jar包的意思
- `sentinel-dashboard-1.8.6.jar`：你下载的文件名

> ⚠️ **端口冲突注意**  
> 如果8080端口被占用，改成其他端口，比如：`-Dserver.port=8888`

**✅ 启动成功标志**

看到这样的日志说明启动成功：

```
[Sentinel] Sentinel dashboard started successfully on port 8080
```

### 4.4 访问控制台


**🌐 打开浏览器访问**

```
http://localhost:8080
```

**🔐 默认登录账号**

```
用户名: sentinel
密码: sentinel
```

**🎨 控制台界面说明**

```
控制台首页
├─ 左侧菜单栏
│   ├─ 簇点链路：看有哪些接口
│   ├─ 流控规则：配置限流
│   ├─ 降级规则：配置熔断
│   └─ 系统规则：系统保护
│
└─ 右侧内容区：显示具体配置和监控数据
```

---

## 5. 🔗 连接与配置


### 5.1 应用连接到Dashboard


**🔸 为什么要连接**

```
你的应用 ←→ Dashboard
    │           │
    │           └─ 可视化界面配置规则
    └─ 执行保护逻辑
```

**🔸 修改application.yml**

```yaml
spring:
  cloud:
    sentinel:
      transport:
        port: 8719              # 本地通信端口
        dashboard: localhost:8080  # Dashboard地址
      
#      # 开启饥饿加载（推荐）
      eager: true
```

**📖 eager配置说明**：
- `true`：程序启动就连接Dashboard
- `false`（默认）：第一次请求时才连接（可能看不到应用）

### 5.2 端口配置说明


**📋 涉及的端口**

| 端口 | **用途** | **配置位置** | **说明** |
|-----|---------|-------------|---------|
| `8080` | 你的应用服务 | `server.port` | 对外提供服务 |
| `8080` | Dashboard控制台 | 启动命令 | 管理界面 |
| `8719` | Sentinel通信 | `transport.port` | 内部通信 |

> 💡 **端口理解**  
> - 8080（应用）：客户访问你的接口
> - 8080（Dashboard）：你访问管理界面  
> - 8719：应用和Dashboard之间对话

**⚠️ 端口冲突解决**

如果Dashboard和应用都用8080会冲突，调整方案：

```yaml
# 应用端口改成8081

server:
  port: 8081

# Dashboard还是8080

# 启动命令：java -Dserver.port=8080 -jar xxx.jar

```

---

## 6. ✅ 本地测试验证


### 6.1 完整测试步骤


**1️⃣ 启动Dashboard**

```bash
java -Dserver.port=8080 -jar sentinel-dashboard-1.8.6.jar
```

**2️⃣ 启动你的应用**

```bash
mvn spring-boot:run
```

**3️⃣ 访问你的接口**

```bash
# 浏览器或命令行访问

curl http://localhost:8081/hello
```

**4️⃣ 查看Dashboard**

打开：`http://localhost:8080`

```
操作流程：
登录 → 左侧菜单"簇点链路" → 看到你的接口
```

### 6.2 配置第一个限流规则


**🔸 在Dashboard界面操作**

```
步骤：
1. 找到你的接口（比如/hello）
2. 点击"流控"按钮
3. 填写配置：
   - 阈值类型：QPS
   - 单机阈值：2
   - 流控模式：直接
4. 点击"新增"
```

**📊 配置表单说明**

| 配置项 | **选择/填写** | **含义** |
|-------|-------------|---------|
| 阈值类型 | QPS | 按每秒请求数限制 |
| 单机阈值 | 2 | 每秒最多2个请求 |
| 流控模式 | 直接 | 直接限流 |
| 流控效果 | 快速失败 | 超过就拒绝 |

### 6.3 测试限流效果


**🧪 快速测试方法**

方式一：浏览器快速刷新
```
狂按F5刷新页面，看是否被限流
```

方式二：使用脚本测试（推荐）
```bash
# Linux/Mac

for i in {1..10}; do curl http://localhost:8081/hello; done

# Windows PowerShell

1..10 | ForEach-Object { Invoke-WebRequest http://localhost:8081/hello }
```

**✅ 预期结果**

```
正常响应: "Hello Sentinel!"
被限流: "Blocked by Sentinel (flow limiting)"
```

---

## 7. ❓ 常见问题解决


### 7.1 Dashboard看不到应用


**🔍 排查步骤**

```
问题检查清单：
□ Dashboard是否启动成功
□ 应用配置的Dashboard地址是否正确
□ 是否开启了eager加载
□ 是否访问过接口（懒加载需要先访问）
□ 端口是否冲突
```

**💡 解决方案**

方式一：开启饥饿加载
```yaml
spring:
  cloud:
    sentinel:
      eager: true  # 加上这个
```

方式二：先访问一次接口
```bash
curl http://localhost:8081/hello
# 然后刷新Dashboard

```

### 7.2 端口被占用


**⚠️ 错误提示**

```
Address already in use: bind
```

**🔧 解决办法**

查看端口占用：
```bash
# Windows

netstat -ano | findstr "8080"

# Linux/Mac

lsof -i:8080
```

更换端口：
```bash
# 改用8888端口启动

java -Dserver.port=8888 -jar sentinel-dashboard-xxx.jar
```

### 7.3 Maven依赖下载失败


**🔍 可能原因**

```
1. 网络问题：访问不了Maven中央仓库
2. 配置问题：没配置阿里云镜像
3. 版本问题：版本号写错了
```

**💊 解决方案**

配置阿里云镜像（在Maven的settings.xml）：

```xml
<mirrors>
    <mirror>
        <id>aliyun</id>
        <mirrorOf>central</mirrorOf>
        <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
</mirrors>
```

---

## 8. 📋 核心要点总结


### 8.1 环境搭建步骤回顾


```
第一步：检查环境
├─ JDK 1.8+
├─ Maven 3.5+
└─ Spring Boot 2.0+

第二步：选择接入方式
├─ 方式一：Maven依赖（简单快速）
└─ 方式二：Dashboard（可视化管理）

第三步：配置连接
├─ application.yml配置
├─ 端口设置
└─ 启动验证

第四步：测试验证
├─ 访问接口
├─ 配置规则
└─ 测试效果
```

### 8.2 关键配置清单


**📋 必备配置项**

```yaml
# 最小化配置

spring:
  cloud:
    sentinel:
      transport:
        port: 8719                    # ✅ 必须配置
        dashboard: localhost:8080     # ✅ 必须配置
      eager: true                     # ⭐ 强烈推荐
```

### 8.3 学习检查清单


**📈 掌握程度自测**

- [x] 理解Sentinel的作用（限流、熔断、保护）
- [x] 会配置Maven依赖
- [x] 能启动Dashboard控制台
- [x] 懂得配置application.yml
- [x] 会在界面上配置简单限流规则
- [ ] 理解各个端口的作用
- [ ] 能独立排查常见问题

### 8.4 下一步学习


**🗺️ 学习路径建议**

```
当前位置: 环境搭建 ✅
    │
    ▼
下一步: 流控规则详解
    │
    ▼
进阶: 熔断降级
    │
    ▼
高级: 系统自适应保护
```

---

**🎯 核心记忆要点**：
- Sentinel是微服务的"保安"，负责限流、熔断和保护
- 两种使用方式：代码依赖（简单）和Dashboard（强大）
- 三个关键端口：应用端口、Dashboard端口、通信端口
- 配置要点：依赖、连接、规则、测试