---
title: 3ã€ç³»ç»Ÿè§„åˆ™é…ç½®
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿä¿æŠ¤çš„æœ¬è´¨ç†è§£](#1-ç³»ç»Ÿä¿æŠ¤çš„æœ¬è´¨ç†è§£)
2. [SystemRuleç³»ç»Ÿè§„åˆ™è¯¦è§£](#2-SystemRuleç³»ç»Ÿè§„åˆ™è¯¦è§£)
3. [ä¿æŠ¤æŒ‡æ ‡æ·±å…¥è§£æ](#3-ä¿æŠ¤æŒ‡æ ‡æ·±å…¥è§£æ)
4. [é˜ˆå€¼è®¾å®šç­–ç•¥](#4-é˜ˆå€¼è®¾å®šç­–ç•¥)
5. [è‡ªé€‚åº”ç®—æ³•åŸç†](#5-è‡ªé€‚åº”ç®—æ³•åŸç†)
6. [ç³»ç»Ÿç›‘æ§ä¸å®è·µ](#6-ç³»ç»Ÿç›‘æ§ä¸å®è·µ)
7. [å•æœºæµæ§é…ç½®](#7-å•æœºæµæ§é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤çš„æœ¬è´¨ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿä¿æŠ¤


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šæƒ³è±¡ä½ æ˜¯ä¸€å®¶é¤å…è€æ¿

```
æ­£å¸¸æƒ…å†µï¼š
é¡¾å®¢æ¥äº† â†’ ç‚¹èœ â†’ åšèœ â†’ ä¸Šèœ â†’ é¡¾å®¢æ»¡æ„

çªç„¶æ¶Œå…¥å¤§é‡é¡¾å®¢ï¼š
100ä¸ªé¡¾å®¢åŒæ—¶è¿›æ¥ â†’ å¨æˆ¿å¿™ä¸è¿‡æ¥ â†’ åé¢é¡¾å®¢ç­‰å¾ˆä¹… â†’ æ‰€æœ‰äººéƒ½ä¸æ»¡æ„

ç³»ç»Ÿä¿æŠ¤çš„åšæ³•ï¼š
ç›‘æµ‹å¨æˆ¿è´Ÿè½½ â†’ è¾¾åˆ°ä¸Šé™æ—¶æš‚åœæ¥å®¢ â†’ ä¿è¯ç°æœ‰é¡¾å®¢ä½“éªŒ â†’ è´Ÿè½½é™ä½å†æ¥æ–°å®¢

è¿™å°±æ˜¯ç³»ç»Ÿä¿æŠ¤çš„æ ¸å¿ƒæ€æƒ³ï¼šå®å¯æ‹’ç»ä¸€éƒ¨åˆ†è¯·æ±‚ï¼Œä¹Ÿè¦ä¿è¯ç³»ç»Ÿç¨³å®šè¿è¡Œ
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> ç³»ç»Ÿä¿æŠ¤æ˜¯ Sentinel çš„"å®‰å…¨é˜€"æœºåˆ¶ï¼Œå½“ç³»ç»Ÿæ•´ä½“è´Ÿè½½è¿‡é«˜æ—¶ï¼Œè‡ªåŠ¨é™æµä¿æŠ¤ï¼Œé˜²æ­¢ç³»ç»Ÿè¢«å‹å®

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç³»ç»Ÿä¿æŠ¤


**ä¼ ç»Ÿé™æµ vs ç³»ç»Ÿä¿æŠ¤å¯¹æ¯”**ï¼š

| å¯¹æ¯”ç»´åº¦ | **ä¼ ç»Ÿé™æµ** | **ç³»ç»Ÿä¿æŠ¤** | **ä½¿ç”¨åœºæ™¯** |
|---------|------------|------------|-------------|
| ä¿æŠ¤å¯¹è±¡ | å•ä¸ªæ¥å£/èµ„æº | æ•´ä¸ªç³»ç»Ÿ | å…¨å±€å…œåº•ä¿æŠ¤ |
| è§¦å‘æ¡ä»¶ | æ¥å£QPSè¶…é™ | ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ | é˜²æ­¢ç³»ç»Ÿå´©æºƒ |
| ä¿æŠ¤ç²’åº¦ | ç»†ç²’åº¦æ§åˆ¶ | ç²—ç²’åº¦ä¿æŠ¤ | æœ€åä¸€é“é˜²çº¿ |
| é€‚ç”¨æƒ…å†µ | å·²çŸ¥çƒ­ç‚¹æ¥å£ | æœªçŸ¥æµé‡æ´ªå³° | åº”æ€¥ä¿æŠ¤æªæ–½ |

**å®é™…ä¸šåŠ¡åœºæ™¯**ï¼š

ğŸ¢ **ç”µå•†ç§’æ€åœºæ™¯**ï¼š
```
é—®é¢˜ï¼šç§’æ€å¼€å§‹ï¼Œç¬é—´10ä¸‡äººæ¶Œå…¥
å½±å“ï¼šä¸ä»…ç§’æ€æ¥å£æ…¢ï¼Œè¿é¦–é¡µã€æœç´¢éƒ½å¡æ­»
ç³»ç»Ÿä¿æŠ¤ï¼šæ£€æµ‹åˆ°CPU 90%ï¼Œè‡ªåŠ¨æ‹’ç»éƒ¨åˆ†è¯·æ±‚
ç»“æœï¼šæ ¸å¿ƒåŠŸèƒ½ä¿æŒå¯ç”¨ï¼Œé¿å…å…¨ç«™ç˜«ç—ª
```

ğŸ“± **APPçƒ­ç‚¹äº‹ä»¶**ï¼š
```
é—®é¢˜ï¼šçƒ­ç‚¹æ–°é—»çªå‘ï¼Œç”¨æˆ·ç–¯ç‹‚åˆ·æ–°
å½±å“ï¼šæ•°æ®åº“è¿æ¥è€—å°½ï¼Œæ‰€æœ‰æ¥å£503
ç³»ç»Ÿä¿æŠ¤ï¼šç›‘æ§åˆ°loadé£™å‡ï¼Œå¯åŠ¨é™æµ
ç»“æœï¼šéƒ¨åˆ†ç”¨æˆ·ç¨ç­‰ï¼Œä½†ç³»ç»Ÿä¸ä¼šå´©æºƒ
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> ç³»ç»Ÿä¿æŠ¤æ˜¯**æœ€åä¸€é“é˜²çº¿**ï¼Œä¸èƒ½æ›¿ä»£æ¥å£çº§é™æµã€‚å°±åƒç«ç¾æŠ¥è­¦å™¨ï¼Œä¸èƒ½ä»£æ›¿æ—¥å¸¸é˜²ç«æªæ–½

### 1.3 ç³»ç»Ÿä¿æŠ¤çš„å·¥ä½œæœºåˆ¶


**ä¿æŠ¤æµç¨‹å›¾ç¤º**ï¼š

```
è¯·æ±‚è¿›æ¥                      ç³»ç»Ÿè´Ÿè½½æ£€æµ‹                    å¤„ç†å†³ç­–
   |                              |                            |
   |                              |                            |
   |---> [Sentinelæ‹¦æˆªå™¨]         |                            |
         |                        â†“                            |
         |                  æ£€æŸ¥ç³»ç»ŸæŒ‡æ ‡                        |
         |                  - CPUä½¿ç”¨ç‡                         |
         |                  - ç³»ç»ŸLoad                          |
         |                  - RTå“åº”æ—¶é—´                        |
         |                  - å…¥å£QPS                          |
         |                  - çº¿ç¨‹æ•°                           |
         |                        â†“                            |
         |                  æŒ‡æ ‡è¶…è¿‡é˜ˆå€¼?                       |
         |                   /        \                        |
         |                 æ˜¯          å¦                       |
         |                /              \                     |
         |               â†“                â†“                    |
         |          [å¿«é€Ÿå¤±è´¥]        [æ”¾è¡Œè¯·æ±‚]               |
         |          æŠ›å‡ºå¼‚å¸¸          æ­£å¸¸å¤„ç†                 |
         |               â†“                â†“                    |
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [è¿”å›å“åº”] <â”€â”€â”€â”€â”€â”€â”˜                     |
                         |                                     |
                         â””â”€â”€â”€â”€> ç”¨æˆ·çœ‹åˆ°é™æµæç¤ºæˆ–æ­£å¸¸ç»“æœ
```

**å…³é”®ç†è§£ç‚¹**ï¼š

ğŸ”¸ **æ£€æµ‹æ—¶æœº**ï¼šæ¯ä¸ªè¯·æ±‚è¿›æ¥æ—¶éƒ½ä¼šæ£€æµ‹
ğŸ”¸ **æ£€æµ‹å¯¹è±¡**ï¼šæ£€æµ‹çš„æ˜¯**æ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€**ï¼Œä¸æ˜¯å•ä¸ªè¯·æ±‚
ğŸ”¸ **å†³ç­–é€Ÿåº¦**ï¼šæ¯«ç§’çº§åˆ¤æ–­ï¼Œä¸å½±å“æ­£å¸¸è¯·æ±‚
ğŸ”¸ **ä¿æŠ¤ç­–ç•¥**ï¼šä¸€æ—¦è§¦å‘ï¼Œç«‹å³æ‹’ç»ï¼Œä¸ç­‰å¾…ä¸é‡è¯•

---

## 2. ğŸ“‹ SystemRuleç³»ç»Ÿè§„åˆ™è¯¦è§£


### 2.1 SystemRuleæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šSystemRule å°±æ˜¯ç³»ç»Ÿä¿æŠ¤çš„"è§„åˆ™é…ç½®å•"

```
ç±»æ¯”ï¼šæ±½è½¦çš„ä»ªè¡¨ç›˜è­¦å‘Šç¯
- æ°´æ¸©è¡¨ï¼šè¶…è¿‡90åº¦äº®çº¢ç¯ï¼ˆç±»æ¯”ï¼šCPUä½¿ç”¨ç‡è§„åˆ™ï¼‰
- æ²¹å‹è¡¨ï¼šä½äºæ ‡å‡†äº®é»„ç¯ï¼ˆç±»æ¯”ï¼šç³»ç»ŸLoadè§„åˆ™ï¼‰
- è½¬é€Ÿè¡¨ï¼šè¶…è¿‡çº¢çº¿åŒºäº®è­¦æŠ¥ï¼ˆç±»æ¯”ï¼šRTå“åº”æ—¶é—´è§„åˆ™ï¼‰

SystemRuleå°±æ˜¯è®¾ç½®è¿™äº›"è­¦æŠ¥çº¿"çš„é…ç½®
```

### 2.2 SystemRuleæ ¸å¿ƒå±æ€§


**å±æ€§è¯¦è§£è¡¨æ ¼**ï¼š

| å±æ€§å | **ç±»å‹** | **å«ä¹‰è¯´æ˜** | **ç¤ºä¾‹å€¼** | **ä½¿ç”¨å»ºè®®** |
|-------|---------|------------|-----------|------------|
| `highestSystemLoad` | double | ç³»ç»Ÿæœ€é«˜Loadå€¼ | 8.0 | ä¸€èˆ¬è®¾ä¸ºCPUæ ¸æ•°Ã—2 |
| `avgRt` | long | å¹³å‡å“åº”æ—¶é—´(ms) | 1000 | æ ¹æ®ä¸šåŠ¡SLAè®¾å®š |
| `maxThread` | long | æœ€å¤§å¹¶å‘çº¿ç¨‹æ•° | 100 | æ ¹æ®å®¹å™¨é…ç½®è®¾å®š |
| `qps` | double | å…¥å£QPSé˜ˆå€¼ | 10000 | æ ¹æ®å‹æµ‹ç»“æœè®¾å®š |
| `highestCpuUsage` | double | CPUä½¿ç”¨ç‡é˜ˆå€¼ | 0.8 | å»ºè®®0.7-0.8ä¹‹é—´ |

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> è¿™äº›å±æ€§**ä¸éœ€è¦å…¨éƒ¨é…ç½®**ï¼Œåªé…ç½®ä½ å…³æ³¨çš„æŒ‡æ ‡å³å¯ã€‚æ¯”å¦‚åªæ‹…å¿ƒCPUï¼Œå°±åªé…ç½® `highestCpuUsage`

### 2.3 SystemRuleé…ç½®ç¤ºä¾‹


**åŸºç¡€é…ç½®ä»£ç **ï¼š

```java
// åˆ›å»ºç³»ç»Ÿè§„åˆ™
SystemRule rule = new SystemRule();

// é…ç½®CPUä¿æŠ¤ï¼ˆæœ€å¸¸ç”¨ï¼‰
rule.setHighestCpuUsage(0.8);  // CPUä½¿ç”¨ç‡è¾¾åˆ°80%è§¦å‘ä¿æŠ¤

// åŠ è½½è§„åˆ™
SystemRuleManager.loadRules(Collections.singletonList(rule));
```

**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š

```java
// å¤šæŒ‡æ ‡ç»¼åˆä¿æŠ¤é…ç½®
SystemRule rule = new SystemRule();

rule.setHighestSystemLoad(8.0);      // â† LoadæŒ‡æ ‡ï¼š8æ ¸æœºå™¨è®¾ä¸º16
rule.setAvgRt(1000);                 // â† RTæŒ‡æ ‡ï¼šå¹³å‡å“åº”è¶…è¿‡1ç§’
rule.setMaxThread(80);               // â† çº¿ç¨‹æ•°ï¼šæœ€å¤š80ä¸ªå¹¶å‘çº¿ç¨‹
rule.setQps(10000);                  // â† QPSæŒ‡æ ‡ï¼šå…¥å£æ¯ç§’1ä¸‡è¯·æ±‚
rule.setHighestCpuUsage(0.75);       // â† CPUæŒ‡æ ‡ï¼šä½¿ç”¨ç‡75%

// æ‰¹é‡åŠ è½½è§„åˆ™
List<SystemRule> rules = new ArrayList<>();
rules.add(rule);
SystemRuleManager.loadRules(rules);
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> å¤šä¸ªæŒ‡æ ‡é…ç½®æ—¶ï¼Œ**åªè¦æœ‰ä¸€ä¸ªæŒ‡æ ‡è¾¾åˆ°é˜ˆå€¼å°±ä¼šè§¦å‘ä¿æŠ¤**ï¼Œä¸æ˜¯æ‰€æœ‰æŒ‡æ ‡éƒ½è¦è¾¾åˆ°

### 2.4 åŠ¨æ€è§„åˆ™é…ç½®


**å®é™…ç”Ÿäº§ç¯å¢ƒ**é€šå¸¸ä½¿ç”¨é…ç½®ä¸­å¿ƒåŠ¨æ€ç®¡ç†ï¼š

```java
// ä»Nacosé…ç½®ä¸­å¿ƒè¯»å–è§„åˆ™ï¼ˆç¤ºä¾‹ï¼‰
@PostConstruct
public void initSystemRule() {
    // ç›‘å¬é…ç½®å˜åŒ–
    configService.addListener("system-rule", new Listener() {
        @Override
        public void receiveConfigInfo(String configInfo) {
            // è§£æJSONé…ç½®
            List<SystemRule> rules = JSON.parseArray(configInfo, SystemRule.class);
            // åŠ¨æ€åŠ è½½è§„åˆ™
            SystemRuleManager.loadRules(rules);
        }
    });
}
```

**é…ç½®ä¸­å¿ƒJSONç¤ºä¾‹**ï¼š

```json
[
  {
    "highestCpuUsage": 0.8,
    "avgRt": 1000,
    "maxThread": 100,
    "qps": 10000
  }
]
```

---

## 3. ğŸ“Š ä¿æŠ¤æŒ‡æ ‡æ·±å…¥è§£æ


### 3.1 äº”å¤§æ ¸å¿ƒæŒ‡æ ‡


**æŒ‡æ ‡å…¨æ™¯å›¾**ï¼š

```
ç³»ç»Ÿä¿æŠ¤äº”å¤§æŒ‡æ ‡
        |
        |â”€â”€ CPUä½¿ç”¨ç‡ (highestCpuUsage) â”€â”€> æœ€ç›´è§‚çš„è´Ÿè½½æŒ‡æ ‡
        |â”€â”€ ç³»ç»ŸLoad (highestSystemLoad) â”€â”€> Linuxç³»ç»Ÿè´Ÿè½½
        |â”€â”€ å¹³å‡RT (avgRt) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> å“åº”æ—¶é—´æŒ‡æ ‡
        |â”€â”€ å…¥å£QPS (qps) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> æµé‡å…¥å£æŒ‡æ ‡
        |â”€â”€ å¹¶å‘çº¿ç¨‹ (maxThread) â”€â”€â”€â”€â”€â”€â”€â”€â”€> çº¿ç¨‹èµ„æºæŒ‡æ ‡
```

### 3.2 CPUä½¿ç”¨ç‡æŒ‡æ ‡


**æœ€å¸¸ç”¨ã€æœ€é‡è¦çš„æŒ‡æ ‡**

ğŸŒ± **å…¥é—¨ç†è§£**ï¼š
```
CPUä½¿ç”¨ç‡ = æ­£åœ¨å·¥ä½œçš„CPUæ¯”ä¾‹
- 0.5 (50%)ï¼šCPUä¸€åŠåœ¨å·¥ä½œï¼Œä¸€åŠåœ¨ä¼‘æ¯
- 0.8 (80%)ï¼šCPUå¾ˆå¿™äº†ï¼Œå¿«åˆ°æé™
- 1.0 (100%)ï¼šCPUæ»¡è´Ÿè·ï¼Œå¤„ç†ä¸è¿‡æ¥äº†
```

ğŸŒ¿ **è¿›é˜¶ç†è§£**ï¼š
```
ä¸ºä»€ä¹ˆè®¾ç½®0.8è€Œä¸æ˜¯1.0ï¼Ÿ
- CPUè¾¾åˆ°100%æ—¶ç³»ç»Ÿå·²ç»å¡æ­»äº†
- 0.8æ—¶è¿˜æœ‰ç¼“å†²ä½™åœ°
- ç±»ä¼¼æ±½è½¦æ²¹è¡¨ï¼Œä¸ä¼šç­‰åˆ°å®Œå…¨æ²¡æ²¹æ‰åŠ æ²¹

å¦‚ä½•è·å–ï¼Ÿ
- Linux: topå‘½ä»¤çœ‹%CPU
- Java: OperatingSystemMXBeanè·å–
- Sentinel: è‡ªåŠ¨é‡‡é›†ï¼Œæ¯ç§’ç»Ÿè®¡ä¸€æ¬¡
```

ğŸŒ³ **ä¸“å®¶ç†è§£**ï¼š
```java
// Sentinelå†…éƒ¨CPUè·å–åŸç†ï¼ˆç®€åŒ–ï¼‰
public class SystemStatusListener {
    private static double currentCpuUsage() {
        // è·å–ç³»ç»ŸCPUä½¿ç”¨ç‡
        OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();
        if (osBean instanceof com.sun.management.OperatingSystemMXBean) {
            return ((com.sun.management.OperatingSystemMXBean) osBean)
                   .getSystemCpuLoad();  // è¿”å›0-1ä¹‹é—´çš„å€¼
        }
        return 0;
    }
}
```

> ğŸ”¥ **é¢è¯•é‡ç‚¹**  
> **é—®**ï¼šä¸ºä»€ä¹ˆCPUä¿æŠ¤é˜ˆå€¼ä¸€èˆ¬è®¾0.7-0.8ï¼Ÿ  
> **ç­”**ï¼šç•™20-30%ç¼“å†²ç©ºé—´ï¼Œç”¨äºå¤„ç†é™æµé€»è¾‘ã€æ—¥å¿—è®°å½•ã€GCç­‰ç³»ç»Ÿå¼€é”€

### 3.3 ç³»ç»ŸLoadæŒ‡æ ‡


**Linuxä¸“å±çš„è´Ÿè½½æŒ‡æ ‡**

ğŸ“– **è®°å¿†å£è¯€**ï¼š
```
Loadå€¼çœ‹æ ¸æ•°ï¼Œ8æ ¸æœºå™¨è®¾16
Load 1.0å•æ ¸æ»¡ï¼Œå¤šæ ¸é™¤æ ¸æ•°ç®—
å¹³å‡è´Ÿè½½çœ‹1åˆ†é’Ÿï¼Œè¶…è¿‡é˜ˆå€¼å°±é™æµ
```

**Loadå€¼å«ä¹‰å¯¹ç…§è¡¨**ï¼š

| æœºå™¨é…ç½® | **å®‰å…¨Load** | **è­¦æˆ’Load** | **å±é™©Load** | **å»ºè®®é˜ˆå€¼** |
|---------|------------|------------|------------|------------|
| 2æ ¸CPU | < 2.0 | 2.0 - 4.0 | > 4.0 | 3.0 |
| 4æ ¸CPU | < 4.0 | 4.0 - 8.0 | > 8.0 | 6.0 |
| 8æ ¸CPU | < 8.0 | 8.0 - 16.0 | > 16.0 | 12.0 |
| 16æ ¸CPU | < 16.0 | 16.0 - 32.0 | > 32.0 | 24.0 |

**é€šä¿—ç±»æ¯”**ï¼š

```
å‡è®¾ä½ æ˜¯æ”¶é“¶å‘˜ï¼ˆCPUï¼‰ï¼Œé¡¾å®¢æ’é˜Ÿå°±æ˜¯Load

2æ ¸CPUï¼ŒLoad 2.0ï¼š
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚æ”¶é“¶å‘˜â”‚  â”‚æ”¶é“¶å‘˜â”‚  ä¸¤ä¸ªæ”¶é“¶å‘˜ï¼Œæ¯äººå‰é¢1ä¸ªé¡¾å®¢ï¼Œæ­£å¸¸
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
   â†‘        â†‘
  é¡¾å®¢     é¡¾å®¢

2æ ¸CPUï¼ŒLoad 6.0ï¼š
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚æ”¶é“¶å‘˜â”‚  â”‚æ”¶é“¶å‘˜â”‚  ä¸¤ä¸ªæ”¶é“¶å‘˜ï¼Œæ¯äººå‰é¢æ’3ä¸ªé¡¾å®¢ï¼Œæ‹¥å µ
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
   â†‘        â†‘
 â†‘â†‘â†‘      â†‘â†‘â†‘
é¡¾å®¢é˜Ÿåˆ—  é¡¾å®¢é˜Ÿåˆ—
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> Windowsç³»ç»Ÿæ²¡æœ‰Loadæ¦‚å¿µï¼Œè¿™ä¸ªæŒ‡æ ‡åªåœ¨Linux/Unixç³»ç»Ÿæœ‰æ•ˆ

### 3.4 å¹³å‡RTå“åº”æ—¶é—´


**è¡¡é‡ç³»ç»Ÿå¤„ç†é€Ÿåº¦çš„æŒ‡æ ‡**

**RTé˜ˆå€¼è®¾å®šå‚è€ƒ**ï¼š

```
ğŸ¯ ä¸šåŠ¡åœºæ™¯å†³å®šé˜ˆå€¼

äº’è”ç½‘åº”ç”¨ï¼š
- æ ¸å¿ƒæ¥å£ï¼šRT < 100ms  ï¼ˆæ”¯ä»˜ã€ç™»å½•ï¼‰
- ä¸€èˆ¬æ¥å£ï¼šRT < 500ms  ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ï¼‰
- æŠ¥è¡¨æŸ¥è¯¢ï¼šRT < 2000ms ï¼ˆç»Ÿè®¡ã€å¯¼å‡ºï¼‰

ç³»ç»Ÿä¿æŠ¤å»ºè®®ï¼š
- avgRt è®¾ä¸ºæ­£å¸¸RTçš„2-3å€
- ä¾‹å¦‚æ­£å¸¸500msï¼Œä¿æŠ¤é˜ˆå€¼è®¾1000-1500ms
```

**å®é™…è®¡ç®—ç¤ºä¾‹**ï¼š

```
å‡è®¾1ç§’å†…æ”¶åˆ°10ä¸ªè¯·æ±‚ï¼š
è¯·æ±‚1: 100ms
è¯·æ±‚2: 200ms
è¯·æ±‚3: 150ms
...
è¯·æ±‚10: 180ms

å¹³å‡RT = (100+200+150+...+180) / 10 = 150ms

å¦‚æœè®¾ç½®avgRt=1000ï¼Œæ­¤æ—¶ä¸è§¦å‘ä¿æŠ¤
å¦‚æœæŸæ—¶åˆ»å¹³å‡RTçªç„¶é£™å‡åˆ°1200msï¼Œè§¦å‘ä¿æŠ¤
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> RTä¿æŠ¤é€‚åˆ**è®¡ç®—å¯†é›†å‹**æœåŠ¡ï¼Œå¯¹äºIOå¯†é›†å‹æœåŠ¡ï¼ŒCPUæˆ–çº¿ç¨‹æ•°æŒ‡æ ‡æ›´æœ‰æ•ˆ

### 3.5 å…¥å£QPSæŒ‡æ ‡


**æ§åˆ¶ç³»ç»Ÿå…¥å£æµé‡çš„æŒ‡æ ‡**

**ä¸æ¥å£é™æµçš„åŒºåˆ«**ï¼š

```
æ¥å£çº§é™æµï¼ˆFlowRuleï¼‰ï¼š
/api/user/login  é™åˆ¶1000 QPS
/api/order/create é™åˆ¶500 QPS
/api/product/list é™åˆ¶2000 QPS

ç³»ç»Ÿçº§QPSï¼ˆSystemRuleï¼‰ï¼š
æ‰€æœ‰å…¥å£è¯·æ±‚æ€»å’Œé™åˆ¶ 10000 QPS
- å½“æ€»QPSè¶…è¿‡10000æ—¶ï¼Œä¸ç®¡æ˜¯å“ªä¸ªæ¥å£éƒ½ä¼šè¢«é™æµ
- æ˜¯æ‰€æœ‰æ¥å£çš„æ€»æµé‡æ§åˆ¶
```

**ä½¿ç”¨åœºæ™¯**ï¼š

ğŸ¢ **åœºæ™¯1ï¼šå¾®æœåŠ¡ç½‘å…³**
```
APIç½‘å…³ï¼š
- åç«¯æœ‰100ä¸ªå¾®æœåŠ¡æ¥å£
- æ¯ä¸ªéƒ½é…é™æµå¤ªéº»çƒ¦
- ç›´æ¥è®¾ç½®ç½‘å…³æ€»QPSä¸Šé™
- ä¾‹å¦‚ï¼šç³»ç»ŸQPS=50000
```

ğŸ“± **åœºæ™¯2ï¼šåº”ç”¨æ€»å®¹é‡é™åˆ¶**
```
APPæœåŠ¡ç«¯ï¼š
- æœºå™¨æ‰¿è½½èƒ½åŠ›æœ‰é™
- ä¸æƒ³ç²¾ç»†é…ç½®æ¯ä¸ªæ¥å£
- ç›´æ¥é™åˆ¶åº”ç”¨æ€»QPS
- ä¾‹å¦‚ï¼š4æ ¸8Gæœºå™¨ï¼Œæ€»QPS=20000
```

### 3.6 å¹¶å‘çº¿ç¨‹æ•°æŒ‡æ ‡


**æ§åˆ¶ç³»ç»ŸåŒæ—¶å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°é‡**

**çº¿ç¨‹æ•°é˜ˆå€¼è®¾å®š**ï¼š

```
çº¿ç¨‹æ•°è®¡ç®—å…¬å¼ï¼š
æœ€å¤§çº¿ç¨‹æ•° = CPUæ ¸æ•° Ã— (1 + ç­‰å¾…æ—¶é—´/è®¡ç®—æ—¶é—´)

ç¤ºä¾‹è®¡ç®—ï¼š
- 8æ ¸CPU
- ä¸šåŠ¡è®¡ç®—è€—æ—¶ï¼š50ms
- IOç­‰å¾…è€—æ—¶ï¼š150ms
- æœ€å¤§çº¿ç¨‹æ•° = 8 Ã— (1 + 150/50) = 8 Ã— 4 = 32

å»ºè®®é…ç½®ï¼š
- Tomcaté»˜è®¤200çº¿ç¨‹ï¼Œç³»ç»Ÿä¿æŠ¤è®¾80-100
- ç•™å‡ºç¼“å†²ï¼Œé¿å…çº¿ç¨‹è€—å°½
```

**çº¿ç¨‹æ•°ä¸QPSçš„å…³ç³»**ï¼š

```
QPS = å¹¶å‘çº¿ç¨‹æ•° / å¹³å‡å“åº”æ—¶é—´(ç§’)

å®ä¾‹ï¼š
- ç³»ç»Ÿå…è®¸100ä¸ªçº¿ç¨‹å¹¶å‘
- å¹³å‡å“åº”æ—¶é—´0.1ç§’
- ç†è®ºQPS = 100 / 0.1 = 1000

åæ¨ï¼š
- ç›®æ ‡QPS=5000
- å¹³å‡RT=0.2ç§’
- éœ€è¦çº¿ç¨‹æ•° = 5000 Ã— 0.2 = 1000ä¸ª
```

> ğŸ”¥ **é¢è¯•é‡ç‚¹**  
> **é—®**ï¼šä¸ºä»€ä¹ˆçº¿ç¨‹æ•°ä¿æŠ¤å’ŒQPSä¿æŠ¤è¦é…åˆä½¿ç”¨ï¼Ÿ  
> **ç­”**ï¼šQPSæ§åˆ¶è¯·æ±‚é‡ï¼Œçº¿ç¨‹æ•°æ§åˆ¶èµ„æºå ç”¨ã€‚ä¸¤è€…é…åˆæ‰èƒ½å…¨é¢ä¿æŠ¤ç³»ç»Ÿ

---

## 4. âš™ï¸ é˜ˆå€¼è®¾å®šç­–ç•¥


### 4.1 é˜ˆå€¼è®¾å®šçš„åŸºæœ¬åŸåˆ™


**é˜ˆå€¼è®¾å®šä¸‰æ­¥æ³•**ï¼š

```
æ­¥éª¤1ï¼šå‹æµ‹è·å–åŸºçº¿
      â†“
   æ­£å¸¸ä¸šåŠ¡å³°å€¼QPS
   æ­£å¸¸ä¸šåŠ¡å¹³å‡RT
   æ­£å¸¸CPUä½¿ç”¨ç‡
      â†“
æ­¥éª¤2ï¼šç•™å‡ºå®‰å…¨ä½™é‡
      â†“
   é˜ˆå€¼ = åŸºçº¿å€¼ Ã— å®‰å…¨ç³»æ•°(0.7-0.8)
      â†“
æ­¥éª¤3ï¼šç°åº¦éªŒè¯è°ƒä¼˜
      â†“
   å°æµé‡è§‚å¯Ÿ â†’ è°ƒæ•´å‚æ•° â†’ å…¨é‡ä¸Šçº¿
```

### 4.2 å®æˆ˜é˜ˆå€¼æ¨èé…ç½®


**ä¸åŒè§„æ¨¡ç³»ç»Ÿçš„æ¨èé…ç½®**ï¼š

| ç³»ç»Ÿè§„æ¨¡ | **æœºå™¨é…ç½®** | **CPUé˜ˆå€¼** | **Loadé˜ˆå€¼** | **QPSé˜ˆå€¼** | **çº¿ç¨‹æ•°é˜ˆå€¼** |
|---------|------------|-----------|------------|-----------|--------------|
| å°å‹åº”ç”¨ | 2æ ¸4G | 0.7 | 3.0 | 5000 | 50 |
| ä¸­å‹åº”ç”¨ | 4æ ¸8G | 0.75 | 6.0 | 15000 | 80 |
| å¤§å‹åº”ç”¨ | 8æ ¸16G | 0.8 | 12.0 | 30000 | 100 |
| è¶…å¤§åº”ç”¨ | 16æ ¸32G | 0.8 | 24.0 | 60000 | 150 |

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> è¿™äº›æ•°å€¼åªæ˜¯å‚è€ƒï¼Œ**å¿…é¡»æ ¹æ®è‡ªå·±çš„å‹æµ‹ç»“æœ**è°ƒæ•´

### 4.3 åŠ¨æ€è°ƒæ•´ç­–ç•¥


**æ ¹æ®æ—¶æ®µåŠ¨æ€è°ƒæ•´**ï¼š

```java
// é«˜å³°æœŸå’Œä½å³°æœŸä¸åŒé…ç½®
@Scheduled(cron = "0 0 9 * * ?")  // æ—©9ç‚¹é«˜å³°æœŸ
public void setHighPeakRule() {
    SystemRule rule = new SystemRule();
    rule.setHighestCpuUsage(0.85);  // é«˜å³°æœŸæ”¾å®½é˜ˆå€¼
    rule.setQps(50000);
    SystemRuleManager.loadRules(Collections.singletonList(rule));
}

@Scheduled(cron = "0 0 2 * * ?")  // å‡Œæ™¨2ç‚¹ä½å³°æœŸ
public void setLowPeakRule() {
    SystemRule rule = new SystemRule();
    rule.setHighestCpuUsage(0.6);   // ä½å³°æœŸæ”¶ç´§é˜ˆå€¼
    rule.setQps(10000);
    SystemRuleManager.loadRules(Collections.singletonList(rule));
}
```

---

## 5. ğŸ¤– è‡ªé€‚åº”ç®—æ³•åŸç†


### 5.1 ä»€ä¹ˆæ˜¯è‡ªé€‚åº”ä¿æŠ¤


**è‡ªé€‚åº” = ç³»ç»Ÿè‡ªå·±ä¼š"çœ‹æƒ…å†µ"è°ƒæ•´**

```
ä¼ ç»Ÿå›ºå®šé˜ˆå€¼ï¼š
è§„åˆ™ï¼šCPU > 80% å°±é™æµ
é—®é¢˜ï¼šCPU 79%æ—¶è¿˜åœ¨ç–¯ç‹‚æ¥å—è¯·æ±‚ï¼Œ80%æ—¶çªç„¶é™æµ

è‡ªé€‚åº”ç®—æ³•ï¼š
è§‚å¯Ÿï¼šCPU 70% â†’ 75% â†’ 78% (è¶‹åŠ¿ä¸Šå‡)
å†³ç­–ï¼šæå‰é™ä½æ¥å—é€Ÿç‡ï¼Œé¿å…çªç ´é˜ˆå€¼
ä¼˜åŠ¿ï¼šæ›´å¹³æ»‘ï¼Œä¸ä¼šçªç„¶å¤§é‡é™æµ
```

### 5.2 BBRè‡ªé€‚åº”ç®—æ³•


**Sentinelå€Ÿé‰´TCP BBRç®—æ³•çš„æ ¸å¿ƒæ€æƒ³**

ğŸ“– **ç®—æ³•åŸç†ç®€è¿°**ï¼š

```
BBRæ ¸å¿ƒé€»è¾‘ï¼š
1. æŒç»­æ¢æµ‹ç³»ç»Ÿæœ€å¤§å¤„ç†èƒ½åŠ›
2. æ ¹æ®å½“å‰è´Ÿè½½åŠ¨æ€è°ƒæ•´æ¥å—é€Ÿç‡
3. åœ¨å®¹é‡è¾¹ç•Œå¤„ä¿æŒç¨³å®š

å®é™…å·¥ä½œè¿‡ç¨‹ï¼š
         ç³»ç»Ÿå®¹é‡
            â†‘
        â”Œâ”€â”€â”€â”´â”€â”€â”€â”
        â”‚  æœ€ä¼˜  â”‚ â† BBRç®—æ³•è®©ç³»ç»Ÿå·¥ä½œåœ¨è¿™é‡Œ
        â”‚  å·¥ä½œç‚¹â”‚
        â””â”€â”€â”€â”¬â”€â”€â”€â”˜
            â†“
    ä¸è¿‡è½½ä¹Ÿä¸æµªè´¹å®¹é‡
```

**è‡ªé€‚åº”è®¡ç®—å…¬å¼ï¼ˆç®€åŒ–ï¼‰**ï¼š

```
æœ€å¤§æ¥å—é€Ÿç‡ = æœ€å°å“åº”æ—¶é—´ Ã— æœ€å¤§å¹¶å‘æ•°

åŠ¨æ€è°ƒæ•´ï¼š
if (å½“å‰RT > æœ€å°RT Ã— 1.5) {
    // RTå˜æ…¢ï¼Œé™ä½æ¥å—é€Ÿç‡
    é™æµé˜ˆå€¼ = é™æµé˜ˆå€¼ Ã— 0.8;
} else if (å½“å‰RT < æœ€å°RT Ã— 1.2) {
    // RTæ­£å¸¸ï¼Œå°è¯•æå‡æ¥å—é€Ÿç‡
    é™æµé˜ˆå€¼ = é™æµé˜ˆå€¼ Ã— 1.1;
}
```

### 5.3 è‡ªé€‚åº”ä¿æŠ¤çš„ä¼˜åŠ¿


**å¯¹æ¯”ä¼ ç»Ÿå›ºå®šé˜ˆå€¼**ï¼š

| ç»´åº¦ | **å›ºå®šé˜ˆå€¼** | **è‡ªé€‚åº”ä¿æŠ¤** |
|-----|------------|--------------|
| çµæ´»æ€§ | âŒ å†™æ­»é…ç½® | âœ… åŠ¨æ€è°ƒæ•´ |
| å‡†ç¡®æ€§ | âŒ å¯èƒ½è¿‡æ—©æˆ–è¿‡æ™šè§¦å‘ | âœ… ç²¾å‡†é¢„æµ‹ |
| ç»´æŠ¤æˆæœ¬ | âŒ éœ€è¦é¢‘ç¹è°ƒä¼˜ | âœ… è‡ªåŠ¨ä¼˜åŒ– |
| é€‚åº”èƒ½åŠ› | âŒ æµé‡æ¨¡å¼å˜åŒ–éœ€é‡æ–°é…ç½® | âœ… è‡ªåŠ¨é€‚åº” |

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> è‡ªé€‚åº”ç®—æ³•æ›´æ™ºèƒ½ï¼Œä½†åˆæœŸå»ºè®®**å…ˆç”¨å›ºå®šé˜ˆå€¼**ï¼Œæ‘¸æ¸…ç³»ç»Ÿç‰¹æ€§åå†å¯ç”¨è‡ªé€‚åº”

---

## 6. ğŸ“ˆ ç³»ç»Ÿç›‘æ§ä¸å®è·µ


### 6.1 ç›‘æ§æŒ‡æ ‡é‡‡é›†


**Sentinelè‡ªåŠ¨é‡‡é›†çš„å…³é”®æŒ‡æ ‡**ï¼š

```
ç›‘æ§æ•°æ®æµè½¬ï¼š
   ç³»ç»Ÿè¿è¡Œ
       â†“
   [æŒ‡æ ‡é‡‡é›†å™¨] (æ¯ç§’ç»Ÿè®¡)
       â†“
   CPUã€Loadã€RTã€QPSã€çº¿ç¨‹æ•°
       â†“
   [æ»‘åŠ¨çª—å£ç»Ÿè®¡] (ä¿ç•™1åˆ†é’Ÿæ•°æ®)
       â†“
   [ä¿æŠ¤å†³ç­–å¼•æ“]
       â†“
   æ˜¯å¦è§¦å‘é™æµ
```

**å®é™…ç›‘æ§ä»£ç **ï¼š

```java
// è·å–ç³»ç»Ÿå®æ—¶æŒ‡æ ‡
public class SystemMonitor {
    
    public SystemMetrics getCurrentMetrics() {
        SystemMetrics metrics = new SystemMetrics();
        
        // CPUä½¿ç”¨ç‡
        metrics.setCpuUsage(SystemStatusListener.getCurrentCpuUsage());
        
        // ç³»ç»ŸLoad
        metrics.setSystemLoad(SystemStatusListener.getCurrentSystemAvgLoad());
        
        // å½“å‰QPSï¼ˆä»ç»Ÿè®¡èŠ‚ç‚¹è·å–ï¼‰
        metrics.setQps(ClusterNode.getAvgQps());
        
        // å½“å‰çº¿ç¨‹æ•°
        metrics.setThreadCount(SystemStatusListener.getCurrentThreadCount());
        
        return metrics;
    }
}
```

### 6.2 ç›‘æ§å¤§ç›˜æ­å»º


**æ¥å…¥Sentinel Dashboard**ï¼š

```yaml
# application.yml é…ç½®
spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080  # Sentinelæ§åˆ¶å°åœ°å€
        port: 8719                 # ä¸æ§åˆ¶å°é€šä¿¡ç«¯å£
      
      # å¼€å¯ç³»ç»Ÿä¿æŠ¤ç›‘æ§
      metric:
        charset: UTF-8
        file-total-count: 6        # ç›‘æ§æ–‡ä»¶æ•°é‡
        file-single-size: 52428800 # å•ä¸ªæ–‡ä»¶å¤§å° 50MB
```

**Dashboardå±•ç¤ºçš„å…³é”®ä¿¡æ¯**ï¼š

```
ç³»ç»Ÿä¿æŠ¤ç›‘æ§é¢æ¿
â”œâ”€â”€ å®æ—¶æŒ‡æ ‡
â”‚   â”œâ”€â”€ CPUä½¿ç”¨ç‡æ›²çº¿å›¾
â”‚   â”œâ”€â”€ Loadå€¼æ›²çº¿å›¾
â”‚   â”œâ”€â”€ RTè¶‹åŠ¿å›¾
â”‚   â””â”€â”€ QPSæµé‡å›¾
â”‚
â”œâ”€â”€ è§„åˆ™é…ç½®
â”‚   â”œâ”€â”€ å½“å‰ç”Ÿæ•ˆè§„åˆ™åˆ—è¡¨
â”‚   â””â”€â”€ åœ¨çº¿ä¿®æ”¹è§„åˆ™åŠŸèƒ½
â”‚
â””â”€â”€ é™æµè®°å½•
    â”œâ”€â”€ è§¦å‘é™æµæ—¶é—´ç‚¹
    â”œâ”€â”€ è§¦å‘åŸå› ï¼ˆå“ªä¸ªæŒ‡æ ‡ï¼‰
    â””â”€â”€ è¢«æ‹’ç»çš„è¯·æ±‚æ•°
```

### 6.3 å‘Šè­¦é…ç½®å®è·µ


**å‘Šè­¦ç­–ç•¥é…ç½®**ï¼š

```java
// è‡ªå®šä¹‰å‘Šè­¦ç›‘å¬
public class SystemProtectionAlertListener implements ProcessorSlot<DefaultNode> {
    
    @Override
    public void entry(Context context, ResourceWrapper resourceWrapper, 
                      DefaultNode node, int count, Object... args) 
                      throws Throwable {
        
        // æ£€æŸ¥æ˜¯å¦è§¦å‘ç³»ç»Ÿä¿æŠ¤
        if (SystemRuleManager.checkSystem(resourceWrapper)) {
            // å‘é€å‘Šè­¦
            sendAlert("ç³»ç»Ÿä¿æŠ¤è§¦å‘", 
                     "CPU:" + getCurrentCpu() + "%, " +
                     "Load:" + getCurrentLoad());
            
            // æŠ›å‡ºé™æµå¼‚å¸¸
            throw new SystemBlockException(resourceWrapper.getName());
        }
    }
    
    private void sendAlert(String title, String content) {
        // å‘é€é’‰é’‰/é‚®ä»¶/çŸ­ä¿¡å‘Šè­¦
        alertService.send(title, content);
    }
}
```

---

## 7. ğŸ”§ å•æœºæµæ§é…ç½®


### 7.1 å•æœºæµæ§çš„æ¦‚å¿µ


**å•æœºæµæ§ = é’ˆå¯¹å•å°æœºå™¨çš„æµé‡æ§åˆ¶**

```
é›†ç¾¤éƒ¨ç½²åœºæ™¯ï¼š
       è´Ÿè½½å‡è¡¡å™¨
          â†“
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â†“           â†“
  æœºå™¨A        æœºå™¨B
  
å•æœºæµæ§ï¼š
- æœºå™¨Açš„ç³»ç»Ÿä¿æŠ¤ï¼šç‹¬ç«‹é…ç½®
- æœºå™¨Bçš„ç³»ç»Ÿä¿æŠ¤ï¼šç‹¬ç«‹é…ç½®
- ä¸¤å°æœºå™¨çš„è§„åˆ™å¯ä»¥ä¸åŒ

é›†ç¾¤æµæ§ï¼š
- æ‰€æœ‰æœºå™¨å…±äº«ä¸€ä¸ªæ€»æµé‡é…é¢
- ä¾‹å¦‚ï¼šæ€»QPS=10000ï¼Œæœºå™¨Aå’ŒBå…±åŒåˆ†æ‹…
```

### 7.2 å•æœºé…ç½®æœ€ä½³å®è·µ


**æ¨èé…ç½®æ–¹æ¡ˆ**ï¼š

```java
@Configuration
public class SentinelSystemConfig {
    
    @PostConstruct
    public void initSystemRule() {
        List<SystemRule> rules = new ArrayList<>();
        
        // ç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½®
        SystemRule rule = new SystemRule();
        
        // ä¸»è¦å…³æ³¨CPUå’ŒQPS
        rule.setHighestCpuUsage(0.8);    // CPUä¿æŠ¤
        rule.setQps(20000);              // QPSä¿æŠ¤
        
        // å¯é€‰é…ç½®
        rule.setAvgRt(1000);             // RTä¿æŠ¤
        rule.setMaxThread(100);          // çº¿ç¨‹ä¿æŠ¤
        
        rules.add(rule);
        SystemRuleManager.loadRules(rules);
        
        log.info("ç³»ç»Ÿä¿æŠ¤è§„åˆ™åŠ è½½å®Œæˆ: {}", rules);
    }
}
```

### 7.3 å¤šç¯å¢ƒé…ç½®ç­–ç•¥


**ä¸åŒç¯å¢ƒçš„é…ç½®å·®å¼‚**ï¼š

```java
// åŸºäºç¯å¢ƒå˜é‡çš„åŠ¨æ€é…ç½®
@Configuration
public class EnvironmentBasedSystemRule {
    
    @Value("${spring.profiles.active}")
    private String env;
    
    @PostConstruct
    public void initRule() {
        SystemRule rule = new SystemRule();
        
        switch (env) {
            case "dev":
                // å¼€å‘ç¯å¢ƒï¼šå®½æ¾é…ç½®
                rule.setHighestCpuUsage(0.9);
                rule.setQps(1000);
                break;
                
            case "test":
                // æµ‹è¯•ç¯å¢ƒï¼šä¸­ç­‰é…ç½®
                rule.setHighestCpuUsage(0.85);
                rule.setQps(5000);
                break;
                
            case "prod":
                // ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼é…ç½®
                rule.setHighestCpuUsage(0.75);
                rule.setQps(20000);
                rule.setAvgRt(1000);
                rule.setMaxThread(100);
                break;
        }
        
        SystemRuleManager.loadRules(Collections.singletonList(rule));
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


âœ… **ç³»ç»Ÿä¿æŠ¤æœ¬è´¨**ï¼šå…¨å±€å…œåº•ä¿æŠ¤ï¼Œé˜²æ­¢ç³»ç»Ÿè¢«å‹å®çš„æœ€åä¸€é“é˜²çº¿

âœ… **SystemRuleé…ç½®**ï¼šé€šè¿‡é…ç½®äº”å¤§æŒ‡æ ‡é˜ˆå€¼ï¼Œæ§åˆ¶ç³»ç»Ÿæ•´ä½“è´Ÿè½½

âœ… **äº”å¤§ä¿æŠ¤æŒ‡æ ‡**ï¼š
- **CPUä½¿ç”¨ç‡**ï¼šæœ€ç›´è§‚ï¼Œç”Ÿäº§æ¨è0.7-0.8
- **ç³»ç»ŸLoad**ï¼šLinuxä¸“ç”¨ï¼Œå»ºè®®è®¾ä¸ºCPUæ ¸æ•°Ã—1.5
- **å¹³å‡RT**ï¼šå“åº”æ—¶é—´ä¿æŠ¤ï¼Œè®¾ä¸ºæ­£å¸¸å€¼2-3å€
- **å…¥å£QPS**ï¼šæ€»æµé‡æ§åˆ¶ï¼Œæ ¹æ®å‹æµ‹ç»“æœè®¾å®š
- **å¹¶å‘çº¿ç¨‹**ï¼šèµ„æºä¿æŠ¤ï¼Œé¿å…çº¿ç¨‹è€—å°½

âœ… **è‡ªé€‚åº”ç®—æ³•**ï¼šå€Ÿé‰´BBRç®—æ³•ï¼ŒåŠ¨æ€è°ƒæ•´é™æµé˜ˆå€¼ï¼Œæ›´æ™ºèƒ½æ›´å¹³æ»‘

âœ… **å•æœºæµæ§**ï¼šæ¯å°æœºå™¨ç‹¬ç«‹é…ç½®ï¼Œä¸é›†ç¾¤æµæ§äº’è¡¥

### 8.2 å®æˆ˜ç»éªŒæ€»ç»“


> ğŸ”¥ **ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**

**é…ç½®ä¼˜å…ˆçº§**ï¼š
```
1. CPUä½¿ç”¨ç‡ï¼ˆå¿…é…ï¼‰â†’ æœ€å‡†ç¡®çš„è´Ÿè½½æŒ‡æ ‡
2. å…¥å£QPSï¼ˆå»ºè®®ï¼‰â†’ æµé‡æ€»é‡æ§åˆ¶
3. å¹³å‡RTï¼ˆå¯é€‰ï¼‰â†’ è®¡ç®—å¯†é›†å‹ä¸šåŠ¡
4. å¹¶å‘çº¿ç¨‹ï¼ˆå¯é€‰ï¼‰â†’ IOå¯†é›†å‹ä¸šåŠ¡
5. ç³»ç»ŸLoadï¼ˆå¯é€‰ï¼‰â†’ Linuxç¯å¢ƒè¡¥å……
```

**å‘Šè­¦ç­–ç•¥**ï¼š
```
- ç³»ç»Ÿä¿æŠ¤è§¦å‘ â†’ ç«‹å³å‘Šè­¦ï¼ˆP1ï¼‰
- CPUæŒç»­>70% â†’ é¢„è­¦é€šçŸ¥ï¼ˆP2ï¼‰
- LoadæŒç»­åé«˜ â†’ å®¹é‡è§„åˆ’ï¼ˆP3ï¼‰
```

**è°ƒä¼˜æ€è·¯**ï¼š
```
1. å…ˆç”¨å›ºå®šé˜ˆå€¼ï¼Œè§‚å¯Ÿ1-2å‘¨
2. æ ¹æ®ç›‘æ§æ•°æ®å¾®è°ƒé˜ˆå€¼
3. ç¨³å®šåè€ƒè™‘å¯ç”¨è‡ªé€‚åº”
4. æŒç»­ç›‘æ§ï¼Œå®šæœŸreview
```

### 8.3 å¸¸è§é—®é¢˜è§£ç­”


â“ **Q1ï¼šç³»ç»Ÿä¿æŠ¤å’Œæ¥å£é™æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

Aï¼š
- æ¥å£é™æµï¼šä¿æŠ¤å•ä¸ªæ¥å£ï¼Œç²¾ç»†æ§åˆ¶
- ç³»ç»Ÿä¿æŠ¤ï¼šä¿æŠ¤æ•´ä¸ªç³»ç»Ÿï¼Œç²—ç²’åº¦å…œåº•
- ä¸¤è€…é…åˆä½¿ç”¨ï¼ŒåŒé‡ä¿é™©

â“ **Q2ï¼šä¸ºä»€ä¹ˆé…ç½®äº†ç³»ç»Ÿä¿æŠ¤è¿˜ä¼šå‡ºç°ç³»ç»Ÿæ•…éšœï¼Ÿ**

Aï¼š
- é˜ˆå€¼è®¾ç½®å¯èƒ½ä¸åˆç†ï¼ˆè¿‡é«˜æˆ–è¿‡ä½ï¼‰
- æ²¡æœ‰é…åˆé™çº§ã€ç†”æ–­ä½¿ç”¨
- ç›‘æ§å‘Šè­¦æ²¡è·Ÿä¸Š
- ç³»ç»Ÿä¿æŠ¤ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œåªæ˜¯å‡å°‘é£é™©

â“ **Q3ï¼šå¤šä¸ªæŒ‡æ ‡éƒ½é…ç½®ï¼Œä¼šä¸ä¼šå¤ªä¸¥æ ¼ï¼Ÿ**

Aï¼š
- **åªè¦æœ‰ä¸€ä¸ªæŒ‡æ ‡è¾¾æ ‡å°±é™æµ**ï¼Œä¸æ˜¯æ‰€æœ‰éƒ½è¦è¾¾æ ‡
- å»ºè®®ï¼šä¸»é…1-2ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼Œå…¶ä»–ä½œä¸ºè¡¥å……
- è¿‡åº¦ä¿æŠ¤ä¹Ÿä¼šå½±å“ä¸šåŠ¡ï¼Œéœ€è¦å¹³è¡¡

### 8.4 è®°å¿†å£è¯€


```
ğŸ“– ç³»ç»Ÿä¿æŠ¤è®°å¿†å£è¯€

ç³»ç»Ÿä¿æŠ¤æ˜¯å…œåº•ï¼Œäº”å¤§æŒ‡æ ‡è¦è®°ç‰¢
CPUä½¿ç”¨æœ€å…³é”®ï¼Œ0.8é˜ˆå€¼åˆšåˆšå¥½
LoadæŒ‡æ ‡çœ‹æ ¸æ•°ï¼Œç¿»å€è®¾ç½®ä¸ä¼šé”™
RTä¿æŠ¤çœ‹ä¸šåŠ¡ï¼Œè®¡ç®—å¯†é›†æ‰éœ€è¦
QPSæ§åˆ¶æ€»æµé‡ï¼Œå‹æµ‹ç»“æœæœ€é è°±
çº¿ç¨‹æ•°é‡è¦æ§åˆ¶ï¼Œèµ„æºè€—å°½ç³»ç»ŸæŒ‚
è‡ªé€‚åº”æ›´æ™ºèƒ½ï¼Œå…ˆç”¨å›ºå®šå†å‡çº§
ç›‘æ§å‘Šè­¦è¦åˆ°ä½ï¼Œæå‰é¢„è­¦æ—©å¤„ç†
```

---

**ğŸ¯ å­¦ä¹ æ£€éªŒæ¸…å•**

- [ ] ç†è§£ç³»ç»Ÿä¿æŠ¤å’Œæ¥å£é™æµçš„åŒºåˆ«
- [ ] æŒæ¡SystemRuleçš„äº”å¤§æŒ‡æ ‡å«ä¹‰
- [ ] èƒ½æ ¹æ®æœºå™¨é…ç½®è®¾å®šåˆç†é˜ˆå€¼
- [ ] äº†è§£è‡ªé€‚åº”ç®—æ³•çš„åŸºæœ¬åŸç†
- [ ] ä¼šé…ç½®å•æœºæµæ§è§„åˆ™
- [ ] èƒ½æ¥å…¥Sentinel Dashboardç›‘æ§
- [ ] ç†è§£ç³»ç»Ÿä¿æŠ¤çš„å±€é™æ€§å’Œä½¿ç”¨åœºæ™¯

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**  
> ç³»ç»Ÿä¿æŠ¤æ˜¯Sentinelçš„é«˜çº§ç‰¹æ€§ï¼Œå»ºè®®ï¼š
> 1. å…ˆæŒæ¡åŸºç¡€çš„é™æµã€é™çº§ã€ç†”æ–­
> 2. åœ¨ç”Ÿäº§ç¯å¢ƒè§‚å¯Ÿç³»ç»Ÿè´Ÿè½½ç‰¹å¾
> 3. ä»CPUä¿æŠ¤å¼€å§‹ï¼Œé€æ­¥å®Œå–„å…¶ä»–æŒ‡æ ‡
> 4. é…åˆç›‘æ§å‘Šè­¦ï¼ŒæŒç»­ä¼˜åŒ–é…ç½®