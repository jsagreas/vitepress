---
title: 1ã€ç³»ç»Ÿä¿æŠ¤æ¦‚å¿µ
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿä¿æŠ¤åŸºç¡€æ¦‚å¿µ](#1-ç³»ç»Ÿä¿æŠ¤åŸºç¡€æ¦‚å¿µ)
2. [ç³»ç»Ÿä¿æŠ¤çš„å·¥ä½œåŸç†](#2-ç³»ç»Ÿä¿æŠ¤çš„å·¥ä½œåŸç†)
3. [ç³»ç»Ÿä¿æŠ¤æŒ‡æ ‡è¯¦è§£](#3-ç³»ç»Ÿä¿æŠ¤æŒ‡æ ‡è¯¦è§£)
4. [ç³»ç»Ÿä¿æŠ¤å®æˆ˜åº”ç”¨](#4-ç³»ç»Ÿä¿æŠ¤å®æˆ˜åº”ç”¨)
5. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#5-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤


**é€šä¿—ç†è§£**ï¼š
æƒ³è±¡ä½ åœ¨ä¸€å®¶é¤å…å·¥ä½œï¼Œå¨æˆ¿åªèƒ½åŒæ—¶å¤„ç†10ä»½è®¢å•ã€‚å¦‚æœåŒæ—¶æ¥äº†20ä¸ªå®¢äººç‚¹é¤ï¼Œå¨æˆ¿è‚¯å®šå¿™ä¸è¿‡æ¥ï¼Œä¸ä»…ä¼šå‡ºé”™ï¼Œè¿˜å¯èƒ½æŠŠå¨æˆ¿æå´©æºƒã€‚

ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤å°±åƒé¤å…çš„æ™ºèƒ½é™æµç³»ç»Ÿï¼š
- **è‡ªåŠ¨æ„ŸçŸ¥**ï¼šå®æ—¶ç›‘æµ‹å¨æˆ¿çš„å¿™ç¢Œç¨‹åº¦ï¼ˆç³»ç»Ÿè´Ÿè½½ï¼‰
- **åŠ¨æ€è°ƒæ•´**ï¼šå½“å¨æˆ¿å¤ªå¿™æ—¶ï¼Œè‡ªåŠ¨æ‹’ç»æ–°è®¢å•ï¼ˆé™æµä¿æŠ¤ï¼‰
- **ä¿æŠ¤å…¨å±€**ï¼šé˜²æ­¢æ•´ä¸ªé¤å…ç˜«ç—ªï¼ˆç³»ç»Ÿé›ªå´©ï¼‰

```
æ™®é€šé™æµ vs ç³»ç»Ÿä¿æŠ¤ï¼š

æ™®é€šé™æµï¼ˆå›ºå®šè§„åˆ™ï¼‰ï¼š
å®¢æˆ· â†’ [æ¯ç§’æœ€å¤š100ä¸ªè¯·æ±‚] â†’ æœåŠ¡
         å›ºå®šé˜ˆå€¼ï¼Œä¸ç®¡æœåŠ¡å™¨çŠ¶æ€

ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ï¼ˆæ™ºèƒ½è°ƒèŠ‚ï¼‰ï¼š
å®¢æˆ· â†’ [æ ¹æ®CPUã€å†…å­˜ã€è´Ÿè½½åŠ¨æ€è°ƒæ•´] â†’ æœåŠ¡
         æœåŠ¡å™¨å¿™æ—¶å°‘æ¥å®¢ï¼Œé—²æ—¶å¤šæ¥å®¢
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç³»ç»Ÿä¿æŠ¤


**æ ¸å¿ƒé—®é¢˜**ï¼š
- âŒ **å•æ¥å£é™æµä¸å¤Ÿ**ï¼šè™½ç„¶é™åˆ¶äº†æŸä¸ªæ¥å£çš„æµé‡ï¼Œä½†å…¶ä»–æ¥å£çš„è¯·æ±‚åŠ èµ·æ¥ä»å¯èƒ½å‹å®ç³»ç»Ÿ
- âŒ **å›ºå®šé˜ˆå€¼ä¸çµæ´»**ï¼šæœåŠ¡å™¨æ€§èƒ½ä¼šæ³¢åŠ¨ï¼Œå›ºå®šå€¼æ— æ³•é€‚åº”å˜åŒ–
- âŒ **èµ„æºç«äº‰**ï¼šå¤šä¸ªæœåŠ¡æŠ¢å CPUã€å†…å­˜ï¼Œå¯èƒ½äº’ç›¸å½±å“

**ç³»ç»Ÿä¿æŠ¤çš„ä»·å€¼**ï¼š
```
åœºæ™¯ç¤ºä¾‹ï¼šç”µå•†ç§’æ€ç³»ç»Ÿ

æ¥å£Aï¼šæŸ¥è¯¢å•†å“ï¼ˆQPS=500ï¼‰   âœ… æœªè¶…é™
æ¥å£Bï¼šä¸‹å•æ¥å£ï¼ˆQPS=300ï¼‰   âœ… æœªè¶…é™  
æ¥å£Cï¼šæ”¯ä»˜æ¥å£ï¼ˆQPS=200ï¼‰   âœ… æœªè¶…é™

ä½†åŠ åœ¨ä¸€èµ·ï¼šCPUä½¿ç”¨ç‡95%ã€å†…å­˜90%ã€å“åº”å˜æ…¢ âŒ

ç³»ç»Ÿä¿æŠ¤ â†’ ç»¼åˆåˆ¤æ–­ â†’ ä¸´æ—¶é™ä½æ€»ä½“æµé‡ â†’ ä¿æŠ¤ç³»ç»Ÿ
```

### 1.3 ç³»ç»Ÿä¿æŠ¤çš„æ ¸å¿ƒç‰¹ç‚¹


**â‘  å…¨å±€ä¿æŠ¤**
```
ä¼ ç»Ÿé™æµï¼š                ç³»ç»Ÿä¿æŠ¤ï¼š
æ¥å£A â”€â”                 â”Œâ”€ ç›‘æ§CPU
æ¥å£B â”€â”¤â†’ å„è‡ªé™æµ        â”œâ”€ ç›‘æ§å†…å­˜
æ¥å£C â”€â”˜                 â”œâ”€ ç›‘æ§è´Ÿè½½    â†’ å…¨å±€é™æµ
                         â””â”€ ç›‘æ§RT
```

**â‘¡ è‡ªé€‚åº”è°ƒèŠ‚**
- ä¸æ˜¯äººå·¥è®¾å®šå›ºå®šå€¼
- æ ¹æ®ç³»ç»Ÿå®æ—¶çŠ¶æ€è‡ªåŠ¨è°ƒæ•´
- ç³»ç»Ÿå¿™å°±æ”¶ç´§ï¼Œç³»ç»Ÿé—²å°±æ”¾æ¾

**â‘¢ åŠ¨æ€è§¦å‘**
- åªåœ¨ç³»ç»Ÿå‹åŠ›å¤§æ—¶æ‰å¯åŠ¨ä¿æŠ¤
- å¹³æ—¶ä¸å½±å“æ­£å¸¸ä¸šåŠ¡
- å‹åŠ›è¿‡åè‡ªåŠ¨æ¢å¤

---

## 2. âš™ï¸ ç³»ç»Ÿä¿æŠ¤çš„å·¥ä½œåŸç†


### 2.1 ä¿æŠ¤è§¦å‘æœºåˆ¶


**å·¥ä½œæµç¨‹**ï¼š
```
è¯·æ±‚åˆ°æ¥
   â†“
æ£€æŸ¥ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€è´Ÿè½½ç­‰ï¼‰
   â†“
æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Ÿ
   â†™        â†˜
  æ˜¯          å¦
   â†“          â†“
æ‹’ç»è¯·æ±‚    æ­£å¸¸å¤„ç†
```

**è§¦å‘æ¡ä»¶ï¼ˆæ»¡è¶³ä»»ä¸€å³è§¦å‘ï¼‰**ï¼š
- âœ“ CPUä½¿ç”¨ç‡è¿‡é«˜
- âœ“ ç³»ç»Ÿè´Ÿè½½è¿‡å¤§
- âœ“ å¹³å‡å“åº”æ—¶é—´è¿‡é•¿
- âœ“ å¹¶å‘çº¿ç¨‹æ•°è¿‡å¤š
- âœ“ å…¥å£QPSè¿‡å¤§

### 2.2 ä¿æŠ¤ç­–ç•¥


**â‘  BBRç®—æ³•ï¼ˆæ‹¥å¡æ§åˆ¶ï¼‰**
```
æ ¸å¿ƒæ€æƒ³ï¼šæ‰¾åˆ°ç³»ç»Ÿçš„æœ€ä½³å·¥ä½œç‚¹

         å¤„ç†èƒ½åŠ›
            â†‘
         æœ€ä½³ç‚¹ â—
           /  \
          /    \
         /      \_____ è¿‡è½½åŒº
        /             ï¼ˆæ‹’ç»éƒ¨åˆ†è¯·æ±‚ï¼‰
       /
      /_____ æ­£å¸¸åŒº
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¯·æ±‚é‡

BBRç­–ç•¥ï¼š
- æŒç»­æ¢æµ‹ç³»ç»Ÿå®¹é‡
- æ‰¾åˆ°æœ€å¤§ååé‡çš„å¹³è¡¡ç‚¹
- è¶…è¿‡å¹³è¡¡ç‚¹å°±é™æµ
```

**â‘¡ è‡ªé€‚åº”é˜ˆå€¼è®¡ç®—**
```
åŠ¨æ€è®¡ç®—å…¬å¼ï¼š
æœ€å¤§å®¹é‡ = å†å²æœ€å¤§ååé‡ Ã— å®‰å…¨ç³»æ•°

ç¤ºä¾‹ï¼š
- å†å²å³°å€¼ååï¼š1000 QPS
- å®‰å…¨ç³»æ•°ï¼š0.8
- åŠ¨æ€é˜ˆå€¼ï¼š800 QPS

å½“å‰QPS > 800 â†’ è§¦å‘ä¿æŠ¤
```

### 2.3 ä¿æŠ¤æ‰§è¡Œè¿‡ç¨‹


**å®Œæ•´æµç¨‹å›¾**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚
     â†“
[å…¥å£æµé‡ç»Ÿè®¡]
     â†“
[é‡‡é›†ç³»ç»ŸæŒ‡æ ‡] â† CPUã€å†…å­˜ã€è´Ÿè½½ã€RT
     â†“
[è®¡ç®—ç³»ç»Ÿå®¹é‡] â† BBRç®—æ³•
     â†“
å½“å‰æµé‡ > ç³»ç»Ÿå®¹é‡ï¼Ÿ
     â†“               â†“
    æ˜¯              å¦
     â†“               â†“
[è§¦å‘ä¿æŠ¤]      [æ­£å¸¸é€šè¿‡]
     â†“               â†“
å¿«é€Ÿå¤±è´¥        ä¸šåŠ¡å¤„ç†
(è¿”å›é™æµå¼‚å¸¸)
```

---

## 3. ğŸ“Š ç³»ç»Ÿä¿æŠ¤æŒ‡æ ‡è¯¦è§£


### 3.1 äº”å¤§ä¿æŠ¤æŒ‡æ ‡


| æŒ‡æ ‡ç±»å‹ | **å«ä¹‰** | **è§¦å‘æ¡ä»¶** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|-------------|-------------|
| **Load** | `ç³»ç»Ÿè´Ÿè½½` | `load1 > CPUæ ¸å¿ƒæ•° Ã— é˜ˆå€¼` | `Linuxç³»ç»Ÿé€šç”¨ä¿æŠ¤` |
| **CPUä½¿ç”¨ç‡** | `CPUå ç”¨ç™¾åˆ†æ¯”` | `ä½¿ç”¨ç‡ > é˜ˆå€¼(å¦‚80%)` | `CPUå¯†é›†å‹æœåŠ¡` |
| **å¹³å‡RT** | `å¹³å‡å“åº”æ—¶é—´` | `RT > é˜ˆå€¼(å¦‚1000ms)` | `å“åº”æ—¶é—´æ•æ„ŸæœåŠ¡` |
| **å¹¶å‘çº¿ç¨‹æ•°** | `æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°` | `çº¿ç¨‹æ•° > é˜ˆå€¼` | `çº¿ç¨‹æ± èµ„æºå—é™` |
| **å…¥å£QPS** | `æ¯ç§’è¯·æ±‚æ•°` | `QPS > é˜ˆå€¼` | `æµé‡æ§åˆ¶` |

### 3.2 Loadç³»ç»Ÿè´Ÿè½½è¯¦è§£


**ä»€ä¹ˆæ˜¯Load**ï¼š
```
é€šä¿—ç†è§£ï¼š
Load = ç­‰å¾…CPUå¤„ç†çš„ä»»åŠ¡æ•°é‡

ç±»æ¯”ï¼šè¶…å¸‚æ”¶é“¶å°
- 1ä¸ªæ”¶é“¶å‘˜ï¼ˆ1æ ¸CPUï¼‰
- Load=1ï¼šåˆšå¥½1ä¸ªäººåœ¨ç»“è´¦ï¼Œæ— ç­‰å¾… âœ…
- Load=2ï¼š1ä¸ªåœ¨ç»“è´¦ï¼Œ1ä¸ªåœ¨æ’é˜Ÿ âš ï¸
- Load=5ï¼š1ä¸ªåœ¨ç»“è´¦ï¼Œ4ä¸ªåœ¨æ’é˜Ÿ âŒ è¿‡è½½ï¼
```

**Loadé˜ˆå€¼è®¾ç½®**ï¼š
```
è®¡ç®—å…¬å¼ï¼š
é˜ˆå€¼ = CPUæ ¸å¿ƒæ•° Ã— ç³»æ•°(é€šå¸¸2.0-2.5)

ç¤ºä¾‹ï¼š
- 4æ ¸CPU
- ç³»æ•° 2.0
- é˜ˆå€¼ = 4 Ã— 2.0 = 8

å½“ load1 > 8 æ—¶è§¦å‘ä¿æŠ¤
```

**é…ç½®ç¤ºä¾‹**ï¼š
```java
// è®¾ç½®Loadä¿æŠ¤è§„åˆ™
SystemRule rule = new SystemRule();
rule.setHighestSystemLoad(8.0);  // Loadé˜ˆå€¼
rule.setAvgRt(1000);             // å¹³å‡RTé˜ˆå€¼(æ¯«ç§’)
SystemRuleManager.loadRules(Collections.singletonList(rule));
```

### 3.3 CPUä½¿ç”¨ç‡ä¿æŠ¤


**å·¥ä½œåŸç†**ï¼š
```
CPUç›‘æ§ï¼š
     100% â”¤                        â— è§¦å‘ç‚¹(80%)
          â”¤                    â—â—â—â—
          â”¤                â—â—â—â—
ä½¿ç”¨ç‡ 50% â”¤            â—â—â—â—
          â”¤        â—â—â—â—           å¼€å§‹é™æµ â†’
          â”¤    â—â—â—â—
       0% â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
            æ—¶é—´çº¿
```

**é…ç½®æ–¹æ³•**ï¼š
```java
SystemRule rule = new SystemRule();
rule.setHighestCpuUsage(0.8);  // CPUä½¿ç”¨ç‡é˜ˆå€¼80%
SystemRuleManager.loadRules(Collections.singletonList(rule));
```

### 3.4 å¹³å‡RTä¿æŠ¤


**RTï¼ˆResponse Timeï¼‰å«ä¹‰**ï¼š
```
RT = å“åº”æ—¶é—´ = è¯·æ±‚å¼€å§‹åˆ°è¿”å›çš„æ—¶é—´

å¿«é€ŸæœåŠ¡ï¼šRT < 100ms   âœ… ä¼˜ç§€
æ­£å¸¸æœåŠ¡ï¼šRT < 500ms   âœ… è‰¯å¥½  
ç¼“æ…¢æœåŠ¡ï¼šRT > 1000ms  âš ï¸ éœ€è¦ä¼˜åŒ–
è¶…æ…¢æœåŠ¡ï¼šRT > 3000ms  âŒ è§¦å‘ä¿æŠ¤
```

**ä¿æŠ¤é€»è¾‘**ï¼š
```
å¹³å‡RTè¶…æ ‡ â†’ è¯´æ˜ç³»ç»Ÿå¤„ç†å˜æ…¢
           â†’ å¯èƒ½å³å°†å´©æºƒ
           â†’ é™åˆ¶æ–°è¯·æ±‚è¿›å…¥
           â†’ è®©ç³»ç»Ÿæ¢å¤
```

**é…ç½®ç¤ºä¾‹**ï¼š
```java
SystemRule rule = new SystemRule();
rule.setAvgRt(1000);  // å¹³å‡RTè¶…è¿‡1ç§’è§¦å‘
SystemRuleManager.loadRules(Collections.singletonList(rule));
```

### 3.5 å¹¶å‘çº¿ç¨‹æ•°ä¿æŠ¤


**çº¿ç¨‹æ•°ç›‘æ§**ï¼š
```
çº¿ç¨‹æ± çŠ¶æ€ï¼š
æœ€å¤§çº¿ç¨‹ï¼š200
æ´»è·ƒçº¿ç¨‹ï¼š180  â† 90%ä½¿ç”¨ç‡ï¼Œå±é™©ï¼
ç­‰å¾…é˜Ÿåˆ—ï¼š50   â† å·²æœ‰ç§¯å‹

è§¦å‘ä¿æŠ¤ â†’ æ‹’ç»æ–°è¯·æ±‚ â†’ é˜²æ­¢çº¿ç¨‹æ± è€—å°½
```

**é…ç½®æ–¹æ³•**ï¼š
```java
SystemRule rule = new SystemRule();
rule.setMaxThread(200);  // æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°
SystemRuleManager.loadRules(Collections.singletonList(rule));
```

---

## 4. ğŸš€ ç³»ç»Ÿä¿æŠ¤å®æˆ˜åº”ç”¨


### 4.1 åŸºç¡€é…ç½®å®æˆ˜


**åœºæ™¯**ï¼šä¿æŠ¤ä¸€ä¸ªè®¢å•æœåŠ¡

```java
@Configuration
public class SentinelSystemConfig {
    
    @PostConstruct
    public void initSystemRule() {
        List<SystemRule> rules = new ArrayList<>();
        
        // åˆ›å»ºç³»ç»Ÿä¿æŠ¤è§„åˆ™
        SystemRule rule = new SystemRule();
        
        // â‘  CPUä¿æŠ¤ï¼šä½¿ç”¨ç‡è¶…80%é™æµ
        rule.setHighestCpuUsage(0.8);
        
        // â‘¡ Loadä¿æŠ¤ï¼š4æ ¸æœåŠ¡å™¨ï¼Œloadè¶…8é™æµ
        rule.setHighestSystemLoad(8.0);
        
        // â‘¢ RTä¿æŠ¤ï¼šå¹³å‡å“åº”è¶…1ç§’é™æµ
        rule.setAvgRt(1000);
        
        // â‘£ çº¿ç¨‹ä¿æŠ¤ï¼šå¹¶å‘è¶…200é™æµ
        rule.setMaxThread(200);
        
        // â‘¤ QPSä¿æŠ¤ï¼šå…¥å£QPSè¶…1000é™æµ
        rule.setQps(1000);
        
        rules.add(rule);
        SystemRuleManager.loadRules(rules);
    }
}
```

### 4.2 ç›‘æ§æŒ‡æ ‡è·å–


**å®æ—¶ç›‘æ§**ï¼š
```java
@RestController
public class SystemMonitorController {
    
    @GetMapping("/system/metrics")
    public Map<String, Object> getSystemMetrics() {
        Map<String, Object> metrics = new HashMap<>();
        
        // è·å–ç³»ç»ŸæŒ‡æ ‡
        metrics.put("cpu", SystemStatusListener.getCurrentCpuUsage());
        metrics.put("load", SystemStatusListener.getCurrentLoad());
        metrics.put("rt", SystemStatusListener.getCurrentAvgRt());
        metrics.put("thread", SystemStatusListener.getCurrentThreadNum());
        metrics.put("qps", SystemStatusListener.getCurrentQps());
        
        return metrics;
    }
}
```

### 4.3 é™çº§å¤„ç†æ–¹æ¡ˆ


**é™æµåçš„ä¼˜é›…å¤„ç†**ï¼š
```java
@RestController
public class OrderController {
    
    @GetMapping("/order/create")
    public Result createOrder(@RequestParam String productId) {
        try {
            // ä¸šåŠ¡é€»è¾‘
            return orderService.create(productId);
            
        } catch (BlockException e) {
            // ç³»ç»Ÿä¿æŠ¤è§¦å‘ï¼Œè¿”å›å‹å¥½æç¤º
            return Result.error("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
        }
    }
}

// å…¨å±€å¼‚å¸¸å¤„ç†
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BlockException.class)
    public Result handleBlockException(BlockException e) {
        
        // åŒºåˆ†é™æµåŸå› 
        if (e instanceof SystemBlockException) {
            return Result.error("ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œè¯·ç¨åå†è¯•");
        }
        
        return Result.error("æœåŠ¡é™æµï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

### 4.4 åŠ¨æ€è§„åˆ™è°ƒæ•´


**Nacosé…ç½®ä¸­å¿ƒé›†æˆ**ï¼š
```java
@Configuration
public class DynamicSystemRuleConfig {
    
    @Value("${nacos.server-addr}")
    private String nacosServer;
    
    @PostConstruct
    public void initDynamicRule() throws Exception {
        // è¿æ¥Nacos
        ConfigService configService = NacosFactory.createConfigService(nacosServer);
        
        // ç›‘å¬é…ç½®å˜åŒ–
        configService.addListener(
            "sentinel-system-rules",  // é…ç½®ID
            "DEFAULT_GROUP",
            new Listener() {
                @Override
                public void receiveConfigInfo(String config) {
                    // è§£ææ–°é…ç½®
                    List<SystemRule> rules = JSON.parseArray(config, SystemRule.class);
                    // æ›´æ–°è§„åˆ™
                    SystemRuleManager.loadRules(rules);
                }
                
                @Override
                public Executor getExecutor() {
                    return null;
                }
            }
        );
    }
}
```

**Nacosé…ç½®ç¤ºä¾‹**ï¼š
```json
[
  {
    "highestCpuUsage": 0.8,
    "highestSystemLoad": 8.0,
    "avgRt": 1000,
    "maxThread": 200,
    "qps": 1000
  }
]
```

### 4.5 å¤šæŒ‡æ ‡ç»„åˆç­–ç•¥


**åœºæ™¯**ï¼šç”µå•†å¤§ä¿ƒä¿æŠ¤ç­–ç•¥

```java
public class PromotionSystemProtection {
    
    public void setupPromotionRules() {
        List<SystemRule> rules = new ArrayList<>();
        
        // ç™½å¤©é«˜å³°æœŸè§„åˆ™(9:00-22:00)
        if (isDayTime()) {
            SystemRule dayRule = new SystemRule();
            dayRule.setHighestCpuUsage(0.7);    // ç™½å¤©CPUé˜ˆå€¼ä½
            dayRule.setAvgRt(500);              // RTè¦æ±‚ä¸¥æ ¼
            dayRule.setQps(1500);               // å…è®¸æ›´é«˜QPS
            rules.add(dayRule);
        } 
        // å¤œé—´è§„åˆ™
        else {
            SystemRule nightRule = new SystemRule();
            nightRule.setHighestCpuUsage(0.85); // å¤œé—´CPUé˜ˆå€¼é«˜
            nightRule.setAvgRt(1000);           // RTè¦æ±‚å®½æ¾
            nightRule.setQps(500);              // QPSé™åˆ¶ä¸¥æ ¼
            rules.add(nightRule);
        }
        
        SystemRuleManager.loadRules(rules);
    }
}
```

### 4.6 å®æˆ˜ä¼˜åŒ–å»ºè®®


**â‘  é˜ˆå€¼è®¾ç½®åŸåˆ™**
```
ğŸ¯ ä¿å®ˆç­–ç•¥ï¼šé˜ˆå€¼è®¾ç½®åä½
- CPU: 60-70%
- Load: æ ¸å¿ƒæ•° Ã— 1.5
- é€‚åˆï¼šæ ¸å¿ƒä¸šåŠ¡ã€ç¨³å®šä¼˜å…ˆ

âš¡ æ¿€è¿›ç­–ç•¥ï¼šé˜ˆå€¼è®¾ç½®åé«˜
- CPU: 80-90%
- Load: æ ¸å¿ƒæ•° Ã— 2.5
- é€‚åˆï¼šä¸´æ—¶æ´»åŠ¨ã€ååä¼˜å…ˆ
```

**â‘¡ ç›‘æ§å‘Šè­¦é…ç½®**
```java
// ç³»ç»ŸæŒ‡æ ‡ç›‘æ§
@Scheduled(fixedRate = 5000)
public void monitorSystem() {
    double cpu = SystemStatusListener.getCurrentCpuUsage();
    double load = SystemStatusListener.getCurrentLoad();
    
    // é¢„è­¦ï¼šCPUè¾¾åˆ°70%
    if (cpu > 0.7) {
        alertService.warn("CPUä½¿ç”¨ç‡è¾¾åˆ°" + cpu);
    }
    
    // å‘Šè­¦ï¼šLoadè¶…è¿‡é˜ˆå€¼
    if (load > 8.0) {
        alertService.error("ç³»ç»Ÿè´Ÿè½½è¿‡é«˜: " + load);
    }
}
```

**â‘¢ é™çº§ç†”æ–­è”åŠ¨**
```
ç³»ç»Ÿä¿æŠ¤è§¦å‘ â†’ ä¸»åŠ¨é™çº§éæ ¸å¿ƒåŠŸèƒ½

ç¤ºä¾‹ï¼š
CPU > 80% â†’ å…³é—­æ¨èæœåŠ¡ã€å¹¿å‘ŠæœåŠ¡
CPU > 90% â†’ åªä¿ç•™æ ¸å¿ƒä¸‹å•ã€æ”¯ä»˜åŠŸèƒ½
```

---

## 5. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 5.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ï¼šæ ¹æ®ç³»ç»Ÿå®æ—¶çŠ¶æ€åŠ¨æ€è°ƒæ•´æµé‡
ğŸ”¸ å…¨å±€è´Ÿè½½ä¿æŠ¤ï¼šç›‘æ§æ•´ä½“ç³»ç»ŸæŒ‡æ ‡ï¼Œè€Œéå•ä¸ªæ¥å£
ğŸ”¸ è‡ªé€‚åº”è§¦å‘ï¼šç³»ç»Ÿå‹åŠ›å¤§æ—¶æ‰å¯åŠ¨ï¼Œå¹³æ—¶ä¸å½±å“
ğŸ”¸ äº”å¤§æŒ‡æ ‡ï¼šLoadã€CPUã€RTã€çº¿ç¨‹æ•°ã€QPS
ğŸ”¸ åŠ¨æ€è°ƒèŠ‚ï¼šè‡ªåŠ¨æ¢æµ‹ç³»ç»Ÿå®¹é‡ï¼Œæ™ºèƒ½é™æµ
```

### 5.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç³»ç»Ÿä¿æŠ¤ vs æ¥å£é™æµçš„åŒºåˆ«**
```
æ¥å£é™æµï¼š
- é’ˆå¯¹å•ä¸ªæ¥å£
- å›ºå®šé˜ˆå€¼
- å±€éƒ¨ä¿æŠ¤

ç³»ç»Ÿä¿æŠ¤ï¼š
- é’ˆå¯¹æ•´ä¸ªç³»ç»Ÿ
- åŠ¨æ€é˜ˆå€¼
- å…¨å±€ä¿æŠ¤
```

**ğŸ”¹ ä½•æ—¶è§¦å‘ç³»ç»Ÿä¿æŠ¤**
```
è§¦å‘æ—¶æœºï¼š
âœ“ CPUæŒç»­é«˜ä½è¿è¡Œ
âœ“ ç³»ç»Ÿè´Ÿè½½è¶…è¿‡æ ¸å¿ƒæ•°
âœ“ å“åº”æ—¶é—´æ˜æ˜¾å˜æ…¢
âœ“ çº¿ç¨‹æ± æ¥è¿‘é¥±å’Œ
âœ“ å…¥å£æµé‡æ¿€å¢

ä»»ä¸€æŒ‡æ ‡è¶…æ ‡ â†’ ç«‹å³ä¿æŠ¤
```

**ğŸ”¹ ä¿æŠ¤ç­–ç•¥é€‰æ‹©**
```
CPUå¯†é›†å‹æœåŠ¡ï¼š
â†’ é‡ç‚¹ç›‘æ§CPUä½¿ç”¨ç‡
â†’ è®¾ç½®CPUé˜ˆå€¼70-80%

IOå¯†é›†å‹æœåŠ¡ï¼š
â†’ é‡ç‚¹ç›‘æ§çº¿ç¨‹æ•°å’ŒRT
â†’ è®¾ç½®çº¿ç¨‹æ•°å’ŒRTé˜ˆå€¼

æ··åˆå‹æœåŠ¡ï¼š
â†’ å¤šæŒ‡æ ‡ç»„åˆä¿æŠ¤
â†’ Load + CPU + RT
```

### 5.3 å®æˆ˜åº”ç”¨æŒ‡å—


**âœ… æ¨èåšæ³•**
- æ ¹æ®å†å²æ•°æ®è®¾ç½®åˆç†é˜ˆå€¼
- å¤šæŒ‡æ ‡ç»„åˆä½¿ç”¨ï¼Œäº’ç›¸è¡¥å……
- é…åˆç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- å®šæœŸå‹æµ‹ï¼ŒéªŒè¯ä¿æŠ¤æ•ˆæœ
- åŠ¨æ€è°ƒæ•´ï¼Œé€‚åº”ä¸šåŠ¡å˜åŒ–

**âŒ é¿å…è¯¯åŒº**
- é˜ˆå€¼è®¾ç½®è¿‡ä½ï¼Œé¢‘ç¹è¯¯æ€æ­£å¸¸æµé‡
- åªè®¾ç½®å•ä¸€æŒ‡æ ‡ï¼Œä¿æŠ¤ä¸å…¨é¢
- æ²¡æœ‰é™çº§æ–¹æ¡ˆï¼Œé™æµåç”¨æˆ·ä½“éªŒå·®
- é™æ€é…ç½®ï¼Œæ— æ³•åº”å¯¹çªå‘æƒ…å†µ

### 5.4 é…ç½®æ¨¡æ¿


**åŸºç¡€æ¨¡æ¿**ï¼š
```java
// é€šç”¨ç³»ç»Ÿä¿æŠ¤é…ç½®
SystemRule rule = new SystemRule();
rule.setHighestCpuUsage(0.8);      // CPU 80%
rule.setHighestSystemLoad(æ ¸å¿ƒæ•°Ã—2); // Load
rule.setAvgRt(1000);               // RT 1ç§’
rule.setMaxThread(200);            // çº¿ç¨‹200
rule.setQps(1000);                 // QPS 1000
```

**é«˜å¹¶å‘æ¨¡æ¿**ï¼š
```java
// å¤§ä¿ƒ/ç§’æ€åœºæ™¯
SystemRule rule = new SystemRule();
rule.setHighestCpuUsage(0.75);     // æ›´ä¸¥æ ¼
rule.setAvgRt(500);                // RTè¦æ±‚é«˜
rule.setMaxThread(300);            // çº¿ç¨‹æ± å¤§
rule.setQps(2000);                 // é«˜QPS
```

### 5.5 æ ¸å¿ƒè®°å¿†


> ğŸ’¡ **ä¸€å¥è¯æ€»ç»“**ï¼š
> ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤æ˜¯å¾®æœåŠ¡çš„"æ™ºèƒ½ä¿é™©ä¸"ï¼Œæ ¹æ®CPUã€Loadã€RTç­‰å®æ—¶æŒ‡æ ‡ï¼ŒåŠ¨æ€é™åˆ¶æµé‡ï¼Œé˜²æ­¢ç³»ç»Ÿå´©æºƒï¼Œä¿éšœæ•´ä½“ç¨³å®šæ€§ã€‚

**è®°å¿†å£è¯€**ï¼š
```
ç³»ç»Ÿä¿æŠ¤çœ‹äº”æ ‡ï¼ŒCPUè´Ÿè½½åŠ RT
çº¿ç¨‹QPSä¹Ÿè¦ç®¡ï¼Œä»»ä¸€è¶…æ ‡å°±é™æµ
åŠ¨æ€è°ƒèŠ‚æ˜¯å…³é”®ï¼Œè‡ªé€‚åº”ä¿æŠ¤çœŸæ™ºèƒ½
å…¨å±€è§†è§’é˜²é›ªå´©ï¼Œå¾®æœåŠ¡ç¨³å®šæœ‰ä¿éšœ
```

**å®æˆ˜è¦ç‚¹**ï¼š
- â‘  ç†è§£ç³»ç»Ÿä¿æŠ¤çš„å…¨å±€è§†è§’
- â‘¡ æŒæ¡äº”å¤§æŒ‡æ ‡çš„å«ä¹‰å’Œè®¾ç½®
- â‘¢ ä¼šé…ç½®åŸºç¡€å’ŒåŠ¨æ€è§„åˆ™
- â‘£ èƒ½è®¾è®¡é™çº§å¤„ç†æ–¹æ¡ˆ
- â‘¤ æ‡‚å¾—ç›‘æ§å’Œä¼˜åŒ–ç­–ç•¥