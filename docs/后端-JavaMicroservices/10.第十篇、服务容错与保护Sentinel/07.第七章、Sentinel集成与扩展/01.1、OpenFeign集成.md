---
title: 1ã€OpenFeigné›†æˆ
---
## ğŸ“š ç›®å½•

1. [OpenFeigné›†æˆæ¦‚è¿°](#1-OpenFeigné›†æˆæ¦‚è¿°)
2. [åŸºç¡€é…ç½®ä¸å¯ç”¨](#2-åŸºç¡€é…ç½®ä¸å¯ç”¨)
3. [é™çº§å¤„ç†æœºåˆ¶](#3-é™çº§å¤„ç†æœºåˆ¶)
4. [å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º](#4-å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º)
5. [é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ](#5-é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ OpenFeigné›†æˆæ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦é›†æˆSentinelï¼Ÿ


**çœŸå®åœºæ™¯ç†è§£**ï¼š
```
æƒ³è±¡ä½ çš„ç³»ç»Ÿåƒä¸€ä¸ªé¤å…ï¼š
- è®¢å•æœåŠ¡ = å‰å°æ¥å¾…
- å•†å“æœåŠ¡ = å¨æˆ¿
- ç”¨æˆ·æœåŠ¡ = ä¼šå‘˜ç®¡ç†

å‰å°æ¥å¾…(è®¢å•æœåŠ¡)éœ€è¦è°ƒç”¨å¨æˆ¿(å•†å“æœåŠ¡)æŸ¥è¯¢èœå“ä¿¡æ¯
å¦‚æœå¨æˆ¿å¤ªå¿™å“åº”æ…¢ï¼Œå‰å°ä¸èƒ½ä¸€ç›´å‚»ç­‰ï¼Œå¦åˆ™é¡¾å®¢æ’é˜Ÿè¶Šæ¥è¶Šé•¿ï¼

Sentinel + OpenFeign = ç»™å‰å°è£…ä¸Š"æ™ºèƒ½ç­‰å¾…ç³»ç»Ÿ"
- å¨æˆ¿å¿™æ—¶ï¼Œç›´æ¥å‘Šè¯‰é¡¾å®¢"èœå“æš‚æ—¶æŸ¥ä¸åˆ°"ï¼ˆé™çº§ï¼‰
- å¨æˆ¿å´©æºƒæ—¶ï¼Œä¸å†å‘é€è¯·æ±‚ï¼ˆç†”æ–­ï¼‰
- ä¿è¯å‰å°æ­£å¸¸æ¥å¾…å…¶ä»–é¡¾å®¢
```

### 1.2 OpenFeignæ˜¯ä»€ä¹ˆï¼Ÿ


**é€šä¿—è§£é‡Š**ï¼š
> ğŸ’¡ OpenFeignæ˜¯å¾®æœåŠ¡ä¹‹é—´æ‰“ç”µè¯çš„å·¥å…·ï¼Œè®©æœåŠ¡è°ƒç”¨åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚

```
ä¼ ç»Ÿæ–¹å¼è°ƒç”¨å…¶ä»–æœåŠ¡ï¼ˆå¤æ‚ï¼‰ï¼š
String url = "http://å•†å“æœåŠ¡/product/123";
RestTemplate restTemplate = new RestTemplate();
Product product = restTemplate.getForObject(url, Product.class);

ä½¿ç”¨OpenFeignï¼ˆç®€å•ï¼‰ï¼š
@FeignClient("å•†å“æœåŠ¡")
interface ProductClient {
    @GetMapping("/product/{id}")
    Product getProduct(@PathVariable Long id);
}

// è°ƒç”¨æ—¶å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•
Product product = productClient.getProduct(123L);
```

### 1.3 é›†æˆæ¶æ„å›¾


```
è®¢å•æœåŠ¡                          å•†å“æœåŠ¡
   â”‚                                â”‚
   â”‚  â‘  è°ƒç”¨getProduct()             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚      OpenFeignå‘èµ·è¯·æ±‚          â”‚
   â”‚                                â”‚
   â”‚  â‘¡ Sentinelæ‹¦æˆªæ£€æŸ¥             â”‚
   â”‚     - æµé‡æ§åˆ¶                  â”‚
   â”‚     - ç†”æ–­åˆ¤æ–­                  â”‚
   â”‚                                â”‚
   â”‚  â‘¢ æ­£å¸¸è¿”å› or é™çº§             â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                â”‚
```

---

## 2. âš™ï¸ åŸºç¡€é…ç½®ä¸å¯ç”¨


### 2.1 æ ¸å¿ƒé…ç½®é¡¹ `feign.sentinel.enabled`


**é…ç½®å«ä¹‰**ï¼š
> è¿™ä¸ªå¼€å…³å°±åƒç»™OpenFeignè£…ä¸Š"å®‰å…¨æ°”å›Š"ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚

**é…ç½®æ–¹å¼**ï¼š

**æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶å¼€å¯**ï¼ˆæ¨èï¼‰
```yaml
# application.yml
feign:
  sentinel:
    enabled: true  # å¼€å¯Sentinelå¯¹OpenFeignçš„æ”¯æŒ
```

**æ–¹å¼äºŒï¼šä»£ç å¼€å¯**
```java
@Configuration
public class FeignConfig {
    @Bean
    public Feign.Builder feignBuilder() {
        return Feign.builder()
            .addCapability(new SentinelFeign.Builder().build());
    }
}
```

### 2.2 å®Œæ•´ä¾èµ–é…ç½®


**Mavenä¾èµ–**ï¼š
```xml
<!-- Sentinelæ ¸å¿ƒ -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>

<!-- OpenFeign -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

### 2.3 é…ç½®éªŒè¯æ–¹æ³•


**å¦‚ä½•ç¡®è®¤é…ç½®ç”Ÿæ•ˆï¼Ÿ**

**æ–¹æ³•ä¸€ï¼šæ—¥å¿—éªŒè¯**
```
å¯åŠ¨åº”ç”¨åçœ‹åˆ°æ—¥å¿—ï¼š
[Sentinel] OpenFeign auto-configuration enabled
```

**æ–¹æ³•äºŒï¼šè°ƒç”¨æµ‹è¯•**
```java
// è®¿é—®Sentinelæ§åˆ¶å°ï¼Œèƒ½çœ‹åˆ°FeignClientçš„èµ„æºç‚¹
// èµ„æºåæ ¼å¼ï¼šGET:http://æœåŠ¡å/æ¥å£è·¯å¾„
```

---

## 3. ğŸ›¡ï¸ é™çº§å¤„ç†æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯é™çº§ï¼Ÿ


**é€šä¿—ç†è§£**ï¼š
```
é™çº§ = å¤‡èƒæ–¹æ¡ˆ

æ­£å¸¸æƒ…å†µï¼šè°ƒç”¨è¿œç¨‹æœåŠ¡è·å–æ•°æ®
é™çº§æƒ…å†µï¼šè¿œç¨‹æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè¿”å›å¤‡ç”¨æ•°æ®æˆ–æç¤ºä¿¡æ¯

å°±åƒï¼š
- æ­£å¸¸ï¼šå»é¤å…ç‚¹å¤–å–
- é™çº§ï¼šé¤å…å…³é—¨äº†ï¼Œåƒæ³¡é¢é¡¶ä¸€ä¸‹
```

### 3.2 fallbacké…ç½®ï¼ˆç®€å•é™çº§ï¼‰


**åŸºæœ¬ç”¨æ³•**ï¼š

**ç¬¬ä¸€æ­¥ï¼šå®šä¹‰FeignClient**
```java
@FeignClient(
    name = "product-service",        // æœåŠ¡å
    fallback = ProductClientFallback.class  // é™çº§ç±»
)
public interface ProductClient {
    
    @GetMapping("/product/{id}")
    Product getProduct(@PathVariable Long id);
    
    @GetMapping("/product/stock/{id}")
    Integer getStock(@PathVariable Long id);
}
```

**ç¬¬äºŒæ­¥ï¼šå®ç°é™çº§ç±»**
```java
@Component
public class ProductClientFallback implements ProductClient {
    
    @Override
    public Product getProduct(Long id) {
        // è¿”å›ä¸€ä¸ªé»˜è®¤å•†å“ä¿¡æ¯
        Product product = new Product();
        product.setId(id);
        product.setName("å•†å“æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
        product.setPrice(0.0);
        return product;
    }
    
    @Override
    public Integer getStock(Long id) {
        // è¿”å›é»˜è®¤åº“å­˜
        return 0;
    }
}
```

**å·¥ä½œæµç¨‹**ï¼š
```
å®¢æˆ·ç«¯è°ƒç”¨                è¿œç¨‹æœåŠ¡               é™çº§å¤„ç†
   â”‚                        â”‚                      â”‚
   â”‚â”€â”€â‘  è°ƒç”¨getProduct()â”€â”€>â”‚                      â”‚
   â”‚                        â”‚                      â”‚
   â”‚                        âœ— æœåŠ¡å¼‚å¸¸/è¶…æ—¶         â”‚
   â”‚                        â”‚                      â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â‘¡ è§¦å‘fallbackâ”€â”€â”€â”€â”€â”€â”¤
   â”‚                                              â”‚
   â””â”€â”€â‘¢ è¿”å›é™çº§æ•°æ®<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 fallbackFactoryé…ç½®ï¼ˆé«˜çº§é™çº§ï¼‰


**ä¸ºä»€ä¹ˆéœ€è¦fallbackFactoryï¼Ÿ**
> ğŸ’¡ **fallbackçš„å±€é™**ï¼šæ— æ³•çŸ¥é“å…·ä½“å¤±è´¥åŸå› 
> 
> **fallbackFactoryçš„ä¼˜åŠ¿**ï¼šå¯ä»¥è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œé’ˆå¯¹ä¸åŒé”™è¯¯åšä¸åŒå¤„ç†

**ä½¿ç”¨æ–¹æ³•**ï¼š

**ç¬¬ä¸€æ­¥ï¼šå®šä¹‰FeignClient**
```java
@FeignClient(
    name = "product-service",
    fallbackFactory = ProductClientFallbackFactory.class
)
public interface ProductClient {
    @GetMapping("/product/{id}")
    Product getProduct(@PathVariable Long id);
}
```

**ç¬¬äºŒæ­¥ï¼šå®ç°FallbackFactory**
```java
@Component
public class ProductClientFallbackFactory 
    implements FallbackFactory<ProductClient> {
    
    @Override
    public ProductClient create(Throwable cause) {
        return new ProductClient() {
            @Override
            public Product getProduct(Long id) {
                // å¯ä»¥æ ¹æ®å¼‚å¸¸ç±»å‹åšä¸åŒå¤„ç†
                if (cause instanceof TimeoutException) {
                    // è¶…æ—¶å¼‚å¸¸
                    return createTimeoutProduct(id);
                } else if (cause instanceof DegradeException) {
                    // é™çº§å¼‚å¸¸ï¼ˆSentinelè§¦å‘ï¼‰
                    return createDegradeProduct(id);
                } else {
                    // å…¶ä»–å¼‚å¸¸
                    return createErrorProduct(id);
                }
            }
        };
    }
    
    private Product createTimeoutProduct(Long id) {
        Product p = new Product();
        p.setId(id);
        p.setName("æœåŠ¡å“åº”è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•");
        return p;
    }
    
    private Product createDegradeProduct(Long id) {
        Product p = new Product();
        p.setId(id);
        p.setName("æœåŠ¡ç¹å¿™ï¼Œå·²å¯ç”¨é™çº§ä¿æŠ¤");
        return p;
    }
    
    private Product createErrorProduct(Long id) {
        Product p = new Product();
        p.setId(id);
        p.setName("æœåŠ¡å¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
        return p;
    }
}
```

### 3.4 fallback vs fallbackFactoryå¯¹æ¯”


| ç‰¹æ€§ | **fallback** | **fallbackFactory** |
|------|-------------|-------------------|
| **å¤æ‚åº¦** | ç®€å•ï¼Œç›´æ¥å®ç°æ¥å£ | ç¨å¤æ‚ï¼Œéœ€è¦å·¥å‚ç±» |
| **å¼‚å¸¸ä¿¡æ¯** | âŒ æ— æ³•è·å– | âœ… å¯ä»¥è·å–å¼‚å¸¸è¯¦æƒ… |
| **çµæ´»æ€§** | æ‰€æœ‰é”™è¯¯ç»Ÿä¸€å¤„ç† | å¯æ ¹æ®å¼‚å¸¸ç±»å‹å·®å¼‚åŒ–å¤„ç† |
| **é€‚ç”¨åœºæ™¯** | ç®€å•é™çº§ï¼Œè¿”å›å›ºå®šå€¼ | å¤æ‚é™çº§ï¼Œéœ€è¦åŒºåˆ†é”™è¯¯ |
| **æ—¥å¿—è®°å½•** | ä¸æ–¹ä¾¿è®°å½•å¼‚å¸¸ | æ–¹ä¾¿è®°å½•å¼‚å¸¸æ—¥å¿— |

**é€‰æ‹©å»ºè®®**ï¼š
```
âœ… ä½¿ç”¨fallbackçš„æƒ…å†µï¼š
- é™çº§é€»è¾‘ç®€å•
- åªéœ€è¿”å›é»˜è®¤å€¼
- ä¸å…³å¿ƒå¤±è´¥åŸå› 

âœ… ä½¿ç”¨fallbackFactoryçš„æƒ…å†µï¼š
- éœ€è¦è®°å½•é”™è¯¯æ—¥å¿—
- ä¸åŒé”™è¯¯è¿”å›ä¸åŒå†…å®¹
- éœ€è¦ç›‘æ§å’Œå‘Šè­¦
```

---

## 4. ğŸ’¼ å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º


### 4.1 å®Œæ•´ä¸šåŠ¡åœºæ™¯


**åœºæ™¯æè¿°**ï¼š
è®¢å•æœåŠ¡è°ƒç”¨å•†å“æœåŠ¡æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼Œéœ€è¦ä¿æŠ¤è®¢å•æœåŠ¡ä¸è¢«å•†å“æœåŠ¡æ‹–å®ã€‚

### 4.2 å•†å“æœåŠ¡æ¥å£ï¼ˆè¢«è°ƒç”¨æ–¹ï¼‰


```java
@RestController
@RequestMapping("/product")
public class ProductController {
    
    @GetMapping("/{id}")
    public Product getProduct(@PathVariable Long id) {
        // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
        Product product = new Product();
        product.setId(id);
        product.setName("åä¸ºæ‰‹æœº");
        product.setPrice(3999.0);
        product.setStock(100);
        return product;
    }
}
```

### 4.3 è®¢å•æœåŠ¡é…ç½®ï¼ˆè°ƒç”¨æ–¹ï¼‰


**ç¬¬ä¸€æ­¥ï¼šé…ç½®æ–‡ä»¶**
```yaml
# application.yml
spring:
  application:
    name: order-service
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080

feign:
  sentinel:
    enabled: true  # å¼€å¯Feignçš„Sentinelæ”¯æŒ
  client:
    config:
      default:
        connectTimeout: 2000  # è¿æ¥è¶…æ—¶2ç§’
        readTimeout: 5000     # è¯»å–è¶…æ—¶5ç§’
```

**ç¬¬äºŒæ­¥ï¼šFeignClientå®šä¹‰**
```java
@FeignClient(
    name = "product-service",
    fallbackFactory = ProductClientFallbackFactory.class
)
public interface ProductClient {
    
    @GetMapping("/product/{id}")
    Product getProductById(@PathVariable("id") Long id);
}
```

**ç¬¬ä¸‰æ­¥ï¼šé™çº§å·¥å‚å®ç°**
```java
@Slf4j
@Component
public class ProductClientFallbackFactory 
    implements FallbackFactory<ProductClient> {
    
    @Override
    public ProductClient create(Throwable cause) {
        log.error("å•†å“æœåŠ¡è°ƒç”¨å¤±è´¥ï¼ŒåŸå› ï¼š{}", cause.getMessage());
        
        return new ProductClient() {
            @Override
            public Product getProductById(Long id) {
                Product fallbackProduct = new Product();
                fallbackProduct.setId(id);
                fallbackProduct.setName("é»˜è®¤å•†å“ï¼ˆé™çº§ï¼‰");
                fallbackProduct.setPrice(0.0);
                fallbackProduct.setStock(0);
                
                log.warn("è¿”å›é™çº§å•†å“æ•°æ®ï¼Œå•†å“IDï¼š{}", id);
                return fallbackProduct;
            }
        };
    }
}
```

**ç¬¬å››æ­¥ï¼šä¸šåŠ¡è°ƒç”¨**
```java
@Service
public class OrderService {
    
    @Autowired
    private ProductClient productClient;
    
    public Order createOrder(Long productId, Integer quantity) {
        // è°ƒç”¨å•†å“æœåŠ¡ï¼ˆå·²è¢«Sentinelä¿æŠ¤ï¼‰
        Product product = productClient.getProductById(productId);
        
        // åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setProductId(productId);
        order.setProductName(product.getName());
        order.setPrice(product.getPrice());
        order.setQuantity(quantity);
        
        return order;
    }
}
```

### 4.4 æµ‹è¯•æ•ˆæœéªŒè¯


**æµ‹è¯•æ­¥éª¤**ï¼š

**â‘  æ­£å¸¸è°ƒç”¨æµ‹è¯•**
```bash
# å•†å“æœåŠ¡æ­£å¸¸è¿è¡Œ
curl http://localhost:8081/order/create?productId=1&quantity=2

# è¿”å›ç»“æœ
{
  "productId": 1,
  "productName": "åä¸ºæ‰‹æœº",
  "price": 3999.0,
  "quantity": 2
}
```

**â‘¡ æœåŠ¡æ•…éšœæµ‹è¯•**
```bash
# åœæ­¢å•†å“æœåŠ¡
# å†æ¬¡è°ƒç”¨è®¢å•æ¥å£

curl http://localhost:8081/order/create?productId=1&quantity=2

# è¿”å›é™çº§ç»“æœ
{
  "productId": 1,
  "productName": "é»˜è®¤å•†å“ï¼ˆé™çº§ï¼‰",
  "price": 0.0,
  "quantity": 2
}

# æ§åˆ¶å°æ—¥å¿—
ERROR - å•†å“æœåŠ¡è°ƒç”¨å¤±è´¥ï¼ŒåŸå› ï¼šConnection refused
WARN  - è¿”å›é™çº§å•†å“æ•°æ®ï¼Œå•†å“IDï¼š1
```

**â‘¢ é™æµæµ‹è¯•**
```bash
# åœ¨Sentinelæ§åˆ¶å°é…ç½®é™æµè§„åˆ™
# èµ„æºåï¼šGET:http://product-service/product/{id}
# QPSé˜ˆå€¼ï¼š10

# ä½¿ç”¨å‹æµ‹å·¥å…·å‘èµ·å¤§é‡è¯·æ±‚
ab -n 1000 -c 50 http://localhost:8081/order/create?productId=1&quantity=2

# è¶…è¿‡é˜ˆå€¼çš„è¯·æ±‚ä¼šè§¦å‘é™çº§
```

---

## 5. ğŸš€ é«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ


### 5.1 èµ„æºåç§°è§„åˆ™


**Sentinelä¸ºFeignClientè‡ªåŠ¨ç”Ÿæˆçš„èµ„æºå**ï¼š
```
æ ¼å¼ï¼šHTTPæ–¹æ³•:http://æœåŠ¡å/æ¥å£è·¯å¾„

ç¤ºä¾‹ï¼š
GET:http://product-service/product/{id}
POST:http://order-service/order/create
```

**åœ¨æ§åˆ¶å°é…ç½®è§„åˆ™**ï¼š
```
1. æ‰“å¼€Sentinel Dashboard
2. é€‰æ‹©order-serviceåº”ç”¨
3. æ‰¾åˆ°èµ„æºç‚¹ï¼šGET:http://product-service/product/{id}
4. é…ç½®æµæ§/é™çº§è§„åˆ™
```

### 5.2 å¸¸è§é…ç½®åœºæ™¯


**åœºæ™¯ä¸€ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´**
```yaml
feign:
  client:
    config:
      product-service:  # é’ˆå¯¹ç‰¹å®šæœåŠ¡
        connectTimeout: 1000
        readTimeout: 3000
      default:  # å…¨å±€é»˜è®¤
        connectTimeout: 2000
        readTimeout: 5000
```

**åœºæ™¯äºŒï¼šç¦ç”¨é‡è¯•**
```yaml
feign:
  client:
    config:
      default:
        retryer: feign.Retryer.NEVER_RETRY  # ç¦ç”¨é‡è¯•
```

**åœºæ™¯ä¸‰ï¼šå¼€å¯è¯·æ±‚å‹ç¼©**
```yaml
feign:
  compression:
    request:
      enabled: true
      mime-types: text/xml,application/json
    response:
      enabled: true
```

### 5.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**ï¼š

**1. æ—¥å¿—è®°å½•å®Œæ•´**
```java
@Slf4j
@Component
public class ProductClientFallbackFactory 
    implements FallbackFactory<ProductClient> {
    
    @Override
    public ProductClient create(Throwable cause) {
        // è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—
        log.error("å•†å“æœåŠ¡è°ƒç”¨å¤±è´¥", cause);
        
        // å‘é€å‘Šè­¦é€šçŸ¥
        alertService.sendAlert("å•†å“æœåŠ¡å¼‚å¸¸", cause.getMessage());
        
        return new ProductClient() {
            // ...é™çº§å®ç°
        };
    }
}
```

**2. é™çº§æ•°æ®æœ‰æ„ä¹‰**
```java
// âŒ ä¸å¥½çš„é™çº§
return null;  // å¯èƒ½å¯¼è‡´ç©ºæŒ‡é’ˆ

// âœ… å¥½çš„é™çº§
Product product = new Product();
product.setId(id);
product.setName("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
product.setAvailable(false);  // æ ‡è¯†ä¸ºä¸å¯ç”¨
return product;
```

**3. åŒºåˆ†é™çº§åŸå› **
```java
if (cause instanceof TimeoutException) {
    return "æœåŠ¡è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•";
} else if (cause instanceof DegradeException) {
    return "æœåŠ¡é™æµä¸­ï¼Œè¯·é™ä½è®¿é—®é¢‘ç‡";
} else {
    return "æœåŠ¡å¼‚å¸¸ï¼Œè¯·è”ç³»å®¢æœ";
}
```

**âŒ é¿å…çš„é™·é˜±**ï¼š

| é—®é¢˜ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| **å¾ªç¯ä¾èµ–** | æœåŠ¡Aè°ƒç”¨Bï¼ŒBåˆè°ƒç”¨A | é‡æ–°è®¾è®¡æœåŠ¡è¾¹ç•Œ |
| **é™çº§æ— é™åˆ¶** | é™çº§æ–¹æ³•ä¹Ÿå¯èƒ½å¼‚å¸¸ | é™çº§æ–¹æ³•ä¿æŒç®€å•ï¼Œä¸è¦æœ‰å¤æ‚é€»è¾‘ |
| **å¿˜è®°å¼€å¯** | feign.sentinel.enabled=false | æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡® |
| **å¼‚å¸¸åå™¬** | é™çº§æ—¶ä¸è®°å½•æ—¥å¿— | å¿…é¡»è®°å½•å¼‚å¸¸ä¿¡æ¯ |

### 5.4 ç›‘æ§ä¸è°ƒä¼˜


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ“Š QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
ğŸ“Š RTï¼ˆå“åº”æ—¶é—´ï¼‰
ğŸ“Š é™çº§æ¬¡æ•°
ğŸ“Š å¼‚å¸¸æ¬¡æ•°
ğŸ“Š æˆåŠŸç‡
```

**è°ƒä¼˜å‚æ•°**ï¼š
```yaml
# æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
feign:
  client:
    config:
      default:
        connectTimeout: 2000  # è¿æ¥è¶…æ—¶
        readTimeout: 5000     # è¯»å–è¶…æ—¶
        
# Sentinelè§„åˆ™
æµæ§é˜ˆå€¼: 100 QPS
ç†”æ–­é˜ˆå€¼: é”™è¯¯ç‡ > 50%
æ¢å¤æ—¶é—´: 10ç§’
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ OpenFeignï¼šå¾®æœåŠ¡é—´è¿œç¨‹è°ƒç”¨çš„å·¥å…·ï¼Œè®©è°ƒç”¨åƒæœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•
ğŸ”¸ feign.sentinel.enabledï¼šå¼€å¯Sentinelå¯¹OpenFeignçš„ä¿æŠ¤ï¼Œé»˜è®¤falseéœ€æ‰‹åŠ¨å¼€å¯
ğŸ”¸ fallbackï¼šç®€å•é™çº§ï¼Œè¿”å›å›ºå®šçš„å¤‡ç”¨æ•°æ®
ğŸ”¸ fallbackFactoryï¼šé«˜çº§é™çº§ï¼Œå¯æ ¹æ®å¼‚å¸¸ç±»å‹è¿”å›ä¸åŒæ•°æ®
ğŸ”¸ èµ„æºåï¼šæ ¼å¼ä¸º HTTPæ–¹æ³•:http://æœåŠ¡å/è·¯å¾„
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦é›†æˆSentinelï¼Ÿ**
```
ç›®çš„ï¼šä¿æŠ¤è°ƒç”¨æ–¹ä¸è¢«è¢«è°ƒç”¨æ–¹æ‹–å®
åŸç†ï¼šåœ¨è¿œç¨‹è°ƒç”¨æ—¶å¢åŠ æµæ§ã€ç†”æ–­ã€é™çº§èƒ½åŠ›
æ•ˆæœï¼šæœåŠ¡æ•…éšœæ—¶ï¼Œè°ƒç”¨æ–¹ä»èƒ½æ­£å¸¸è¿è¡Œï¼ˆè¿”å›é™çº§æ•°æ®ï¼‰
```

**ğŸ”¹ fallbackä¸fallbackFactoryçš„é€‰æ‹©**
```
ç®€å•åœºæ™¯ï¼šä½¿ç”¨fallback
- åªéœ€è¿”å›é»˜è®¤å€¼
- ä¸å…³å¿ƒå¤±è´¥åŸå› 

å¤æ‚åœºæ™¯ï¼šä½¿ç”¨fallbackFactory
- éœ€è¦è®°å½•å¼‚å¸¸æ—¥å¿—
- ä¸åŒé”™è¯¯ä¸åŒå¤„ç†
- éœ€è¦ç›‘æ§å‘Šè­¦
```

**ğŸ”¹ é…ç½®ç”Ÿæ•ˆçš„æ¡ä»¶**
```
1. âœ… æ·»åŠ æ­£ç¡®çš„ä¾èµ–
2. âœ… é…ç½®feign.sentinel.enabled=true
3. âœ… å®ç°fallbackæˆ–fallbackFactory
4. âœ… åœ¨FeignClientä¸­æŒ‡å®šé™çº§ç±»
```

### 6.3 å®é™…åº”ç”¨æŒ‡å—


**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
- **è®¢å•æœåŠ¡** â† è°ƒç”¨ â†’ å•†å“æœåŠ¡
- **è´­ç‰©è½¦æœåŠ¡** â† è°ƒç”¨ â†’ ç”¨æˆ·æœåŠ¡
- **æ”¯ä»˜æœåŠ¡** â† è°ƒç”¨ â†’ è´¦æˆ·æœåŠ¡

**é…ç½®æ¨¡æ¿**ï¼š
```yaml
feign:
  sentinel:
    enabled: true
  client:
    config:
      default:
        connectTimeout: 2000
        readTimeout: 5000
```

**é™çº§æ¨¡æ¿**ï¼š
```java
@FeignClient(
    name = "æœåŠ¡å",
    fallbackFactory = XxxFallbackFactory.class
)
public interface XxxClient {
    // æ¥å£å®šä¹‰
}

@Component
class XxxFallbackFactory implements FallbackFactory<XxxClient> {
    @Override
    public XxxClient create(Throwable cause) {
        log.error("æœåŠ¡è°ƒç”¨å¤±è´¥", cause);
        return new XxxClient() {
            // è¿”å›é™çº§æ•°æ®
        };
    }
}
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Feignè°ƒç”¨è¦ä¿æŠ¤ï¼ŒSentinelé›†æˆæ˜¯æ³•å®
enabledå¼€å…³è¦æ‰“å¼€ï¼Œfallbacké™çº§ä¸èƒ½å°‘
ç®€å•åœºæ™¯ç”¨fallbackï¼Œå¤æ‚éœ€æ±‚Factoryå¥½
æ—¥å¿—ç›‘æ§è¦å®Œå–„ï¼ŒæœåŠ¡æ•…éšœä¸æ…Œå¼ 
```