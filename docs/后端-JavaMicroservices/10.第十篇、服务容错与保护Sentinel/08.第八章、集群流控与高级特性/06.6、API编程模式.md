---
title: 6ã€APIç¼–ç¨‹æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [APIç¼–ç¨‹æ¨¡å¼åŸºç¡€æ¦‚å¿µ](#1-APIç¼–ç¨‹æ¨¡å¼åŸºç¡€æ¦‚å¿µ)
2. [Entryå¯¹è±¡æ ¸å¿ƒæœºåˆ¶](#2-Entryå¯¹è±¡æ ¸å¿ƒæœºåˆ¶)
3. [æ‰‹åŠ¨åŸ‹ç‚¹å®æˆ˜](#3-æ‰‹åŠ¨åŸ‹ç‚¹å®æˆ˜)
4. [èµ„æºå®šä¹‰è¯¦è§£](#4-èµ„æºå®šä¹‰è¯¦è§£)
5. [è§„åˆ™ç®¡ç†ç¼–ç¨‹å®ç°](#5-è§„åˆ™ç®¡ç†ç¼–ç¨‹å®ç°)
6. [ç¼–ç¨‹å¼ä½¿ç”¨æœ€ä½³å®è·µ](#6-ç¼–ç¨‹å¼ä½¿ç”¨æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ APIç¼–ç¨‹æ¨¡å¼åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯APIç¼–ç¨‹æ¨¡å¼


**é€šä¿—ç†è§£**ï¼šå°±åƒä½ è‡ªå·±ç”¨ä»£ç æ¥ç²¾ç¡®æ§åˆ¶Sentinelçš„ä¿æŠ¤é€»è¾‘ï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–æ³¨è§£çš„è‡ªåŠ¨åŒ–

```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š

æ³¨è§£æ¨¡å¼ = è‡ªåŠ¨æŒ¡æ±½è½¦
- ç®€å•æ–¹ä¾¿ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯
- @SentinelResource è‡ªåŠ¨å¤„ç†
- é€‚åˆåˆå­¦è€…

APIç¼–ç¨‹æ¨¡å¼ = æ‰‹åŠ¨æŒ¡æ±½è½¦  
- æ›´ç²¾ç¡®çš„æ§åˆ¶
- è‡ªå·±å†™ä»£ç ç®¡ç†èµ„æº
- é€‚åˆå¤æ‚åœºæ™¯å’Œé«˜çº§éœ€æ±‚
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **ç¼–ç¨‹å¼**ï¼šç”¨Javaä»£ç ç›´æ¥è°ƒç”¨Sentinelçš„APIï¼Œæ‰‹åŠ¨æ§åˆ¶æµæ§é€»è¾‘
- **èµ„æº**ï¼šéœ€è¦ä¿æŠ¤çš„ä»£ç æ®µæˆ–æ¥å£ï¼Œæ¯”å¦‚ä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•ã€ä¸€æ®µä¸šåŠ¡ä»£ç 
- **åŸ‹ç‚¹**ï¼šåœ¨ä»£ç ä¸­æ ‡è®°å“ªäº›åœ°æ–¹éœ€è¦Sentinelä¿æŠ¤

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦APIç¼–ç¨‹æ¨¡å¼


**é€‚ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| åœºæ™¯ç±»å‹ | æ³¨è§£æ¨¡å¼ | APIç¼–ç¨‹æ¨¡å¼ | é€‰æ‹©å»ºè®® |
|---------|---------|------------|---------|
| **æ™®é€šæ¥å£ä¿æŠ¤** | âœ… æ¨è | âšª å¯é€‰ | `ä¼˜å…ˆç”¨æ³¨è§£ï¼Œç®€å•ç›´è§‚` |
| **éSpringæ–¹æ³•** | âŒ ä¸æ”¯æŒ | âœ… å¿…é€‰ | `åªèƒ½ç”¨APIæ¨¡å¼` |
| **åŠ¨æ€èµ„æºåç§°** | âŒ å›°éš¾ | âœ… ç®€å• | `APIæ¨¡å¼æ›´çµæ´»` |
| **å¤æ‚å¼‚å¸¸å¤„ç†** | âš ï¸ å—é™ | âœ… å¼ºå¤§ | `éœ€è¦ç²¾ç»†æ§åˆ¶ç”¨API` |
| **éWebåº”ç”¨** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | `åå°ä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡ç­‰` |

**å®é™…éœ€æ±‚ä¸¾ä¾‹**ï¼š
```
âŒ æ³¨è§£æ¨¡å¼æ— æ³•èƒœä»»çš„åœºæ™¯ï¼š

1. å®šæ—¶ä»»åŠ¡ä¿æŠ¤
   - @Scheduledçš„æ–¹æ³•ä¸æ˜¯HTTPæ¥å£
   - æ³¨è§£æ¨¡å¼ä¸»è¦é’ˆå¯¹Webè¯·æ±‚

2. åŠ¨æ€èµ„æºå‘½å
   - èµ„æºåéœ€è¦æ ¹æ®å‚æ•°å˜åŒ–
   - æ¯”å¦‚ï¼šuser_query_vip, user_query_normal

3. å¤šå±‚åµŒå¥—æ§åˆ¶
   - éœ€è¦åœ¨ä¸€ä¸ªæ–¹æ³•å†…æ§åˆ¶å¤šä¸ªèµ„æº
   - ç²¾ç»†åŒ–çš„æµæ§ç­–ç•¥

4. è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†
   - éœ€è¦å¤æ‚çš„é™çº§é€»è¾‘
   - ä¸åŒå¼‚å¸¸æœ‰ä¸åŒå¤„ç†æ–¹å¼
```

---

## 2. ğŸ”‘ Entryå¯¹è±¡æ ¸å¿ƒæœºåˆ¶


### 2.1 Entryå¯¹è±¡æ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šEntryå°±åƒæ˜¯ä¸€å¼ "é€šè¡Œè¯"ï¼Œä»£è¡¨ä½ æˆåŠŸé€šè¿‡äº†Sentinelçš„æ£€æŸ¥

```
ç°å®ä¸–ç•Œç±»æ¯”ï¼š

æ™¯åŒºé—¨ç¥¨æ£€æŸ¥è¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸¸å®¢åˆ°è¾¾    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€ç¥¨å£éªŒç¥¨  â”‚ â† è¿™å°±æ˜¯ SphU.entry()
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚ éªŒè¯é€šè¿‡ â”‚ â†’ æ‹¿åˆ°é—¨ç¥¨ï¼ˆEntryå¯¹è±¡ï¼‰
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿›å…¥æ™¯åŒº    â”‚ â† æ‰§è¡Œä¸šåŠ¡ä»£ç 
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å½’è¿˜é—¨ç¥¨    â”‚ â† entry.exit()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Entryå¯¹è±¡çš„ä½œç”¨**ï¼š
- âœ… **é€šè¡Œå‡­è¯**ï¼šè¯æ˜ä½ é€šè¿‡äº†Sentinelçš„æ£€æŸ¥
- âœ… **èµ„æºå ç”¨æ ‡è®°**ï¼šè®°å½•ä½ æ­£åœ¨ä½¿ç”¨è¿™ä¸ªèµ„æº
- âœ… **é€€å‡ºæ¸…ç†**ï¼šç”¨å®Œåå¿…é¡»é‡Šæ”¾ï¼Œå¦åˆ™ä¼šé€ æˆèµ„æºæ³„éœ²

### 2.2 Entryå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ


**å®Œæ•´æµç¨‹å›¾ç¤º**ï¼š
```
ç¨‹åºæ‰§è¡Œæµç¨‹                      EntryçŠ¶æ€å˜åŒ–
     
ä»£ç å¼€å§‹æ‰§è¡Œ                     [æ— Entryå¯¹è±¡]
     â†“
è°ƒç”¨ SphU.entry("èµ„æºå")        [å°è¯•è·å–Entry]
     â†“                                â†“
æ£€æŸ¥æ˜¯å¦é™æµï¼Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ˜¯ â†’ æŠ›å‡ºBlockException
     â†“ å¦                         [Entryåˆ›å»ºå¤±è´¥]
åˆ›å»ºEntryå¯¹è±¡                    [Entryå¯¹è±¡å·²åˆ›å»º]
     â†“
æ‰§è¡Œä¸šåŠ¡ä»£ç                      [EntryæŒæœ‰ä¸­]
     â†“
è°ƒç”¨ entry.exit()                [é‡Šæ”¾Entry]
     â†“
Entryå¯¹è±¡é”€æ¯                    [Entryå¯¹è±¡é”€æ¯]
```

### 2.3 Entryçš„åŸºæœ¬ä½¿ç”¨æ¨¡æ¿


**æ ‡å‡†ä½¿ç”¨ä»£ç **ï¼š
```java
// â­ è¿™æ˜¯æœ€åŸºç¡€çš„Entryä½¿ç”¨æ¨¡æ¿ï¼Œä¸€å®šè¦è®°ä½è¿™ä¸ªç»“æ„ï¼
Entry entry = null;
try {
    // ç¬¬ä¸€æ­¥ï¼šå°è¯•è·å–Entryï¼ˆé€šè¡Œè¯ï¼‰
    entry = SphU.entry("èµ„æºå");
    
    // ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œä½ çš„ä¸šåŠ¡ä»£ç 
    // èƒ½æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ²¡æœ‰è¢«é™æµ
    System.out.println("æ­£å¸¸æ‰§è¡Œä¸šåŠ¡é€»è¾‘");
    
} catch (BlockException e) {
    // ç¬¬ä¸‰æ­¥ï¼šè¢«é™æµäº†ï¼Œæ‰§è¡Œé™çº§é€»è¾‘
    System.out.println("è¢«é™æµäº†ï¼Œè¿”å›å‹å¥½æç¤º");
    
} finally {
    // ç¬¬å››æ­¥ï¼šæ— è®ºå¦‚ä½•éƒ½è¦é‡Šæ”¾Entryï¼ˆå½’è¿˜é€šè¡Œè¯ï¼‰
    if (entry != null) {
        entry.exit();
    }
}
```

**ä»£ç å…³é”®ç‚¹è¯´æ˜**ï¼š
- `SphU.entry("èµ„æºå")`ï¼šå‘Sentinelç”³è¯·è®¿é—®èµ„æº
- `BlockException`ï¼šè¢«é™æµæ—¶æŠ›å‡ºçš„å¼‚å¸¸
- `entry.exit()`ï¼šå¿…é¡»åœ¨finallyä¸­é‡Šæ”¾ï¼Œé˜²æ­¢èµ„æºæ³„éœ²

### 2.4 Entryçš„å…³é”®å‚æ•°


**EntryTypeå‚æ•°è§£é‡Š**ï¼š
```java
// EntryType å†³å®šäº†è¿™ä¸ªèµ„æºæ˜¯"å…¥å£"è¿˜æ˜¯"å‡ºå£"

// INï¼šå…¥å£æµé‡ï¼ˆé»˜è®¤å€¼ï¼‰
// å«ä¹‰ï¼šè¯·æ±‚è¿›æ¥çš„æµé‡ï¼Œæ¯”å¦‚HTTPè¯·æ±‚
entry = SphU.entry("èµ„æºå", EntryType.IN);

// OUTï¼šå‡ºå£æµé‡  
// å«ä¹‰ï¼šè¯·æ±‚å‡ºå»çš„æµé‡ï¼Œæ¯”å¦‚è°ƒç”¨å¤–éƒ¨æœåŠ¡
entry = SphU.entry("èµ„æºå", EntryType.OUT);
```

**é€šä¿—ç†è§£**ï¼š
```
å…¬å¸å¤§æ¥¼çš„é—¨ç¦ç³»ç»Ÿç±»æ¯”ï¼š

EntryType.INï¼ˆå…¥å£ï¼‰
- å°±åƒå…¬å¸å‰å°ï¼Œæ§åˆ¶"è¿›æ¥"çš„äººæµ
- å¯¹åº”ï¼šç”¨æˆ·è®¿é—®ä½ çš„æœåŠ¡
- åœºæ™¯ï¼šæ¥å£è¢«è°ƒç”¨ã€ç”¨æˆ·è¯·æ±‚

EntryType.OUTï¼ˆå‡ºå£ï¼‰
- å°±åƒå…¬å¸ä¿å®‰æ£€æŸ¥"å‡ºå»"çš„ç‰©å“
- å¯¹åº”ï¼šä½ è°ƒç”¨å¤–éƒ¨æœåŠ¡
- åœºæ™¯ï¼šè°ƒç”¨æ•°æ®åº“ã€è°ƒç”¨ç¬¬ä¸‰æ–¹API
```

---

## 3. ğŸ› ï¸ æ‰‹åŠ¨åŸ‹ç‚¹å®æˆ˜


### 3.1 ä»€ä¹ˆæ˜¯æ‰‹åŠ¨åŸ‹ç‚¹


**é€šä¿—è§£é‡Š**ï¼šåŸ‹ç‚¹å°±æ˜¯åœ¨ä»£ç ä¸­"åšæ ‡è®°"ï¼Œå‘Šè¯‰Sentinelå“ªäº›ä»£ç éœ€è¦ä¿æŠ¤

```
ç”Ÿæ´»ä¸­çš„åŸ‹ç‚¹ç±»æ¯”ï¼š

è¶…å¸‚çš„é˜²ç›—ç³»ç»Ÿï¼š
1. åœ¨å•†å“ä¸Šè´´é˜²ç›—æ ‡ç­¾ â† è¿™å°±æ˜¯"åŸ‹ç‚¹"
2. å‡ºå£çš„é˜²ç›—é—¨æ£€æµ‹ â† è¿™å°±æ˜¯Sentinelæ£€æŸ¥
3. æŠ¥è­¦æˆ–æ”¾è¡Œ â† è¿™å°±æ˜¯é™æµæˆ–é€šè¿‡
```

**åŸ‹ç‚¹çš„æœ¬è´¨**ï¼š
- å°±æ˜¯åœ¨å…³é”®ä»£ç ä½ç½®è°ƒç”¨ `SphU.entry()`
- æŠŠä»£ç æ®µå®šä¹‰æˆä¸€ä¸ª"èµ„æº"
- è®©SentinelçŸ¥é“è¦ä¿æŠ¤è¿™æ®µä»£ç 

### 3.2 æ‰‹åŠ¨åŸ‹ç‚¹çš„åŸºæœ¬æ­¥éª¤


**ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©åŸ‹ç‚¹ä½ç½®**
```java
public class OrderService {
    
    // âŒ é”™è¯¯ç¤ºä¾‹ï¼šåŸ‹ç‚¹ä½ç½®å¤ªç²—ç³™
    public void processOrder() {
        Entry entry = SphU.entry("order"); // æ•´ä¸ªæ–¹æ³•ä¸€ä¸ªåŸ‹ç‚¹
        // ... å¾ˆå¤šä¸šåŠ¡é€»è¾‘
        entry.exit();
    }
    
    // âœ… æ­£ç¡®ç¤ºä¾‹ï¼šç²¾ç»†åŒ–åŸ‹ç‚¹
    public void processOrder() {
        // åŸ‹ç‚¹1ï¼šæŸ¥è¯¢åº“å­˜
        Entry entry1 = null;
        try {
            entry1 = SphU.entry("order:checkStock");
            checkStock(); // ä¿æŠ¤æŸ¥è¯¢åº“å­˜æ“ä½œ
        } finally {
            if (entry1 != null) entry1.exit();
        }
        
        // åŸ‹ç‚¹2ï¼šæ‰£å‡åº“å­˜
        Entry entry2 = null;
        try {
            entry2 = SphU.entry("order:reduceStock");
            reduceStock(); // ä¿æŠ¤æ‰£å‡åº“å­˜æ“ä½œ
        } finally {
            if (entry2 != null) entry2.exit();
        }
    }
}
```

**ç¬¬äºŒæ­¥ï¼šåˆç†å‘½åèµ„æº**
```java
// èµ„æºå‘½åè§„èŒƒå»ºè®®

// âœ… å¥½çš„å‘½åï¼šæ¸…æ™°ã€æœ‰å±‚æ¬¡
"user:query"              // ç”¨æˆ·æŸ¥è¯¢
"order:create"            // è®¢å•åˆ›å»º
"payment:callback"        // æ”¯ä»˜å›è°ƒ
"cache:redis:get"         // Redisç¼“å­˜è¯»å–

// âŒ ä¸å¥½çš„å‘½åï¼šæ¨¡ç³Šã€éš¾ç†è§£
"method1"                 // çœ‹ä¸å‡ºæ˜¯ä»€ä¹ˆ
"resource"                // å¤ªç¬¼ç»Ÿ
"aaa"                     // æ¯«æ— æ„ä¹‰
```

### 3.3 æ‰‹åŠ¨åŸ‹ç‚¹å®æˆ˜æ¡ˆä¾‹


**åœºæ™¯1ï¼šä¿æŠ¤æ•°æ®åº“æŸ¥è¯¢**
```java
public class UserService {
    
    public User queryUser(Long userId) {
        Entry entry = null;
        try {
            // åŸ‹ç‚¹ï¼šä¿æŠ¤æ•°æ®åº“æŸ¥è¯¢
            entry = SphU.entry("db:user:query");
            
            // æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
            return userMapper.selectById(userId);
            
        } catch (BlockException e) {
            // è¢«é™æµäº†ï¼Œè¿”å›ç¼“å­˜æ•°æ®
            return getUserFromCache(userId);
            
        } finally {
            if (entry != null) {
                entry.exit();
            }
        }
    }
}
```

**åœºæ™¯2ï¼šä¿æŠ¤å¤–éƒ¨APIè°ƒç”¨**
```java
public class PaymentService {
    
    public PayResult callPaymentApi(PayRequest request) {
        Entry entry = null;
        try {
            // åŸ‹ç‚¹ï¼šä¿æŠ¤ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£è°ƒç”¨
            entry = SphU.entry("api:payment:call", EntryType.OUT);
            
            // è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£
            return paymentClient.pay(request);
            
        } catch (BlockException e) {
            // è¢«é™æµï¼Œè¿”å›å‹å¥½æç¤º
            return PayResult.fail("æ”¯ä»˜ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
            
        } finally {
            if (entry != null) {
                entry.exit();
            }
        }
    }
}
```

**åœºæ™¯3ï¼šå¤šå±‚åµŒå¥—åŸ‹ç‚¹**
```java
public class ComplexService {
    
    public void complexOperation() {
        // å¤–å±‚åŸ‹ç‚¹ï¼šæ•´ä½“æ“ä½œä¿æŠ¤
        Entry outerEntry = null;
        try {
            outerEntry = SphU.entry("complex:operation");
            
            // å†…å±‚åŸ‹ç‚¹1ï¼šæ­¥éª¤1ä¿æŠ¤
            Entry step1Entry = null;
            try {
                step1Entry = SphU.entry("complex:step1");
                executeStep1();
            } finally {
                if (step1Entry != null) step1Entry.exit();
            }
            
            // å†…å±‚åŸ‹ç‚¹2ï¼šæ­¥éª¤2ä¿æŠ¤
            Entry step2Entry = null;
            try {
                step2Entry = SphU.entry("complex:step2");
                executeStep2();
            } finally {
                if (step2Entry != null) step2Entry.exit();
            }
            
        } finally {
            if (outerEntry != null) outerEntry.exit();
        }
    }
}
```

---

## 4. ğŸ“¦ èµ„æºå®šä¹‰è¯¦è§£


### 4.1 èµ„æºå®šä¹‰çš„æ ¸å¿ƒæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯èµ„æºï¼Ÿ**
```
é€šä¿—ç†è§£ï¼šèµ„æºå°±æ˜¯ä½ è¦ä¿æŠ¤çš„"ä¸œè¥¿"

ç”Ÿæ´»ç±»æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é“¶è¡ŒæŸœå°ï¼ˆèµ„æºï¼‰    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æŸœå°1ï¼šåŠç†ä¸šåŠ¡    â”‚ â† è¿™æ˜¯ä¸€ä¸ªèµ„æº
â”‚ â€¢ æŸœå°2ï¼šVIPä¸šåŠ¡     â”‚ â† è¿™æ˜¯å¦ä¸€ä¸ªèµ„æº  
â”‚ â€¢ ATMæœºï¼šè‡ªåŠ©æœåŠ¡    â”‚ â† è¿™ä¹Ÿæ˜¯ä¸€ä¸ªèµ„æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸ªæŸœå°æœ‰è‡ªå·±çš„æ’é˜Ÿè§„åˆ™ï¼ˆé™æµè§„åˆ™ï¼‰
```

**èµ„æºçš„ä¸‰è¦ç´ **ï¼š
- **èµ„æºåç§°**ï¼šå”¯ä¸€æ ‡è¯†è¿™ä¸ªèµ„æº
- **èµ„æºç±»å‹**ï¼šINï¼ˆå…¥å£ï¼‰æˆ– OUTï¼ˆå‡ºå£ï¼‰
- **è°ƒç”¨æ¥æº**ï¼šè°åœ¨è°ƒç”¨è¿™ä¸ªèµ„æº

### 4.2 èµ„æºå®šä¹‰çš„æ–¹å¼


**æ–¹å¼1ï¼šé€šè¿‡Entryå®šä¹‰ï¼ˆæœ€å¸¸ç”¨ï¼‰**
```java
// åŸºç¡€å®šä¹‰ï¼šåªæŒ‡å®šèµ„æºå
Entry entry = SphU.entry("resourceName");

// å®Œæ•´å®šä¹‰ï¼šæŒ‡å®šèµ„æºå + ç±»å‹
Entry entry = SphU.entry("resourceName", EntryType.IN);

// é«˜çº§å®šä¹‰ï¼šæŒ‡å®šèµ„æºå + ç±»å‹ + æ•°é‡
Entry entry = SphU.entry("resourceName", EntryType.IN, 1);
```

**æ–¹å¼2ï¼šé€šè¿‡APIå®šä¹‰èµ„æºå±æ€§**
```java
// å®šä¹‰èµ„æºçš„åŒæ—¶è®¾ç½®è°ƒç”¨æ¥æº
Entry entry = SphU.entry(
    "resourceName",           // èµ„æºå
    EntryType.IN,            // å…¥å£ç±»å‹
    1,                       // è¯·æ±‚æ•°é‡
    "æ¥æºæ ‡è¯†"                // è°ƒç”¨æ¥æºï¼ˆå¯é€‰ï¼‰
);
```

### 4.3 èµ„æºå‘½åæœ€ä½³å®è·µ


**å‘½åè§„èŒƒå»ºè®®**ï¼š

| å±‚çº§ | å‘½åæ¨¡å¼ | ç¤ºä¾‹ | è¯´æ˜ |
|-----|---------|------|------|
| **ä¸€çº§** | `æ¨¡å—å` | `user` | `ç”¨æˆ·æ¨¡å—` |
| **äºŒçº§** | `æ¨¡å—:æ“ä½œ` | `user:query` | `ç”¨æˆ·æŸ¥è¯¢` |
| **ä¸‰çº§** | `æ¨¡å—:æ“ä½œ:å­æ“ä½œ` | `user:query:byId` | `æŒ‰IDæŸ¥è¯¢ç”¨æˆ·` |
| **å››çº§** | `æ¨¡å—:æ“ä½œ:å­æ“ä½œ:ç±»å‹` | `user:query:byId:vip` | `VIPç”¨æˆ·æŸ¥è¯¢` |

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```java
public class ResourceNaming {
    
    // âœ… æ¸…æ™°çš„èµ„æºå‘½å
    public void goodNaming() {
        // ç”¨æˆ·æ¨¡å—çš„èµ„æº
        SphU.entry("user:register");        // ç”¨æˆ·æ³¨å†Œ
        SphU.entry("user:login");           // ç”¨æˆ·ç™»å½•
        SphU.entry("user:profile:update");  // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        
        // è®¢å•æ¨¡å—çš„èµ„æº
        SphU.entry("order:create");         // åˆ›å»ºè®¢å•
        SphU.entry("order:query:list");     // æŸ¥è¯¢è®¢å•åˆ—è¡¨
        SphU.entry("order:pay:alipay");     // æ”¯ä»˜å®æ”¯ä»˜
        
        // æ•°æ®åº“èµ„æº
        SphU.entry("db:user:select");       // æ•°æ®åº“æŸ¥è¯¢
        SphU.entry("db:order:insert");      // æ•°æ®åº“æ’å…¥
        
        // å¤–éƒ¨APIèµ„æº  
        SphU.entry("api:wechat:sendMsg");   // å¾®ä¿¡å‘é€æ¶ˆæ¯
        SphU.entry("api:sms:send");         // çŸ­ä¿¡å‘é€
    }
}
```

### 4.4 åŠ¨æ€èµ„æºåç§°


**åœºæ™¯éœ€æ±‚**ï¼šæ ¹æ®ä¸åŒæƒ…å†µä½¿ç”¨ä¸åŒçš„èµ„æºå

```java
public class DynamicResourceExample {
    
    // åœºæ™¯ï¼šVIPç”¨æˆ·å’Œæ™®é€šç”¨æˆ·ä½¿ç”¨ä¸åŒçš„èµ„æº
    public void queryWithUserType(Long userId, boolean isVip) {
        // åŠ¨æ€ç”Ÿæˆèµ„æºå
        String resourceName = isVip ? 
            "user:query:vip" : "user:query:normal";
        
        Entry entry = null;
        try {
            entry = SphU.entry(resourceName);
            // æ‰§è¡ŒæŸ¥è¯¢é€»è¾‘
            doQuery(userId);
        } finally {
            if (entry != null) entry.exit();
        }
    }
    
    // åœºæ™¯ï¼šä¸åŒå•†å“ç±»å‹ç”¨ä¸åŒèµ„æº
    public void queryProduct(String productType) {
        String resourceName = "product:query:" + productType;
        
        Entry entry = null;
        try {
            entry = SphU.entry(resourceName);
            // æ‰§è¡ŒæŸ¥è¯¢é€»è¾‘
            doQueryProduct(productType);
        } finally {
            if (entry != null) entry.exit();
        }
    }
}
```

---

## 5. âš™ï¸ è§„åˆ™ç®¡ç†ç¼–ç¨‹å®ç°


### 5.1 ä»€ä¹ˆæ˜¯è§„åˆ™ç®¡ç†


**é€šä¿—ç†è§£**ï¼šè§„åˆ™å°±æ˜¯å‘Šè¯‰Sentinelæ€ä¹ˆä¿æŠ¤èµ„æºçš„"è¯´æ˜ä¹¦"

```
é¤å…é™æµè§„åˆ™ç±»æ¯”ï¼š

è§„åˆ™1ï¼šé«˜å³°æœŸæ¯æ¡Œæœ€å¤šå6äºº
è§„åˆ™2ï¼šåŒ…å¢éœ€è¦æå‰é¢„è®¢
è§„åˆ™3ï¼šVIPå®¢æˆ·ä¼˜å…ˆå®‰æ’

å¯¹åº”Sentinelï¼š
è§„åˆ™1ï¼šQPSä¸è¶…è¿‡100
è§„åˆ™2ï¼šéœ€è¦é¢„çƒ­5ç§’
è§„åˆ™3ï¼šé‡è¦æ¥å£ä¼˜å…ˆæ”¾è¡Œ
```

**è§„åˆ™çš„æ ¸å¿ƒè¦ç´ **ï¼š
- **èµ„æºå**ï¼šè¿™ä¸ªè§„åˆ™ä¿æŠ¤å“ªä¸ªèµ„æº
- **é™æµé˜ˆå€¼**ï¼šå…è®¸å¤šå°‘è¯·æ±‚é€šè¿‡
- **é™æµæ¨¡å¼**ï¼šæ€ä¹ˆè®¡ç®—å’Œåˆ¤æ–­

### 5.2 æµæ§è§„åˆ™ç¼–ç¨‹å®šä¹‰


**åŸºç¡€æµæ§è§„åˆ™ä»£ç **ï¼š
```java
import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;
import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;

public class FlowRuleConfig {
    
    public static void initFlowRules() {
        // åˆ›å»ºè§„åˆ™åˆ—è¡¨
        List<FlowRule> rules = new ArrayList<>();
        
        // è§„åˆ™1ï¼šuser:query æ¯ç§’æœ€å¤š10ä¸ªè¯·æ±‚
        FlowRule rule1 = new FlowRule();
        rule1.setResource("user:query");      // èµ„æºå
        rule1.setGrade(RuleConstant.FLOW_GRADE_QPS);  // æŒ‰QPSé™æµ
        rule1.setCount(10);                   // QPSé˜ˆå€¼ï¼š10
        rules.add(rule1);
        
        // è§„åˆ™2ï¼šorder:create æ¯ç§’æœ€å¤š5ä¸ªè¯·æ±‚
        FlowRule rule2 = new FlowRule();
        rule2.setResource("order:create");
        rule2.setGrade(RuleConstant.FLOW_GRADE_QPS);
        rule2.setCount(5);
        rules.add(rule2);
        
        // åŠ è½½è§„åˆ™åˆ°Sentinel
        FlowRuleManager.loadRules(rules);
        System.out.println("æµæ§è§„åˆ™åŠ è½½å®Œæˆï¼");
    }
}
```

**è§„åˆ™å‚æ•°è¯¦è§£**ï¼š
```java
FlowRule rule = new FlowRule();

// å¿…å¡«å‚æ•°
rule.setResource("èµ„æºå");              // ä¿æŠ¤å“ªä¸ªèµ„æº
rule.setCount(100);                     // é˜ˆå€¼ï¼šæ¯ç§’100ä¸ªè¯·æ±‚

// é™æµæ¨¡å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ç›´æ¥æ‹’ç»ï¼‰
rule.setGrade(RuleConstant.FLOW_GRADE_QPS);      // QPSæ¨¡å¼
rule.setGrade(RuleConstant.FLOW_GRADE_THREAD);   // å¹¶å‘çº¿ç¨‹æ•°æ¨¡å¼

// æµæ§æ•ˆæœï¼ˆå¯é€‰ï¼‰
rule.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_DEFAULT);       // ç›´æ¥æ‹’ç»
rule.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_WARM_UP);      // é¢„çƒ­
rule.setControlBehavior(RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER); // åŒ€é€Ÿæ’é˜Ÿ
```

### 5.3 é™çº§è§„åˆ™ç¼–ç¨‹å®šä¹‰


**é™çº§è§„åˆ™ä»£ç ç¤ºä¾‹**ï¼š
```java
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeRule;
import com.alibaba.csp.sentinel.slots.block.degrade.DegradeRuleManager;

public class DegradeRuleConfig {
    
    public static void initDegradeRules() {
        List<DegradeRule> rules = new ArrayList<>();
        
        // è§„åˆ™1ï¼šå¼‚å¸¸æ¯”ä¾‹é™çº§
        DegradeRule rule1 = new DegradeRule();
        rule1.setResource("api:payment");           // èµ„æºå
        rule1.setGrade(RuleConstant.DEGRADE_GRADE_EXCEPTION_RATIO);  // å¼‚å¸¸æ¯”ä¾‹
        rule1.setCount(0.5);                        // 50%çš„è¯·æ±‚å¼‚å¸¸å°±é™çº§
        rule1.setTimeWindow(10);                    // é™çº§æŒç»­10ç§’
        rules.add(rule1);
        
        // è§„åˆ™2ï¼šæ…¢è°ƒç”¨æ¯”ä¾‹é™çº§
        DegradeRule rule2 = new DegradeRule();
        rule2.setResource("db:query");
        rule2.setGrade(RuleConstant.DEGRADE_GRADE_RT);  // å“åº”æ—¶é—´
        rule2.setCount(1000);                       // è¶…è¿‡1ç§’ç®—æ…¢è°ƒç”¨
        rule2.setSlowRatioThreshold(0.3);          // 30%çš„è¯·æ±‚æ…¢å°±é™çº§
        rule2.setTimeWindow(10);
        rules.add(rule2);
        
        // åŠ è½½è§„åˆ™
        DegradeRuleManager.loadRules(rules);
    }
}
```

### 5.4 è§„åˆ™åŠ¨æ€æ›´æ–°


**åœ¨è¿è¡Œæ—¶ä¿®æ”¹è§„åˆ™**ï¼š
```java
public class DynamicRuleUpdate {
    
    // æ–¹æ³•1ï¼šå®Œå…¨æ›¿æ¢è§„åˆ™
    public static void updateAllRules() {
        List<FlowRule> newRules = new ArrayList<>();
        
        FlowRule rule = new FlowRule();
        rule.setResource("user:query");
        rule.setCount(20);  // é˜ˆå€¼ä»10æ”¹æˆ20
        newRules.add(rule);
        
        // è¿™ä¼šæ›¿æ¢æ‰æ‰€æœ‰æ—§è§„åˆ™
        FlowRuleManager.loadRules(newRules);
    }
    
    // æ–¹æ³•2ï¼šåœ¨ç°æœ‰è§„åˆ™åŸºç¡€ä¸Šä¿®æ”¹
    public static void modifyExistingRule() {
        // è·å–å½“å‰è§„åˆ™
        List<FlowRule> rules = FlowRuleManager.getRules();
        
        // æ‰¾åˆ°è¦ä¿®æ”¹çš„è§„åˆ™
        for (FlowRule rule : rules) {
            if ("user:query".equals(rule.getResource())) {
                rule.setCount(20);  // ä¿®æ”¹é˜ˆå€¼
            }
        }
        
        // é‡æ–°åŠ è½½
        FlowRuleManager.loadRules(rules);
    }
}
```

---

## 6. ğŸ’» ç¼–ç¨‹å¼ä½¿ç”¨æœ€ä½³å®è·µ


### 6.1 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**å®Œæ•´çš„å¼‚å¸¸å¤„ç†ä»£ç **ï¼š
```java
public class BestPracticeExample {
    
    public String queryUserInfo(Long userId) {
        Entry entry = null;
        try {
            // å°è¯•è·å–Entry
            entry = SphU.entry("user:query");
            
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            String userInfo = doQuery(userId);
            return userInfo;
            
        } catch (BlockException e) {
            // Sentinelé™æµ/é™çº§å¼‚å¸¸
            
            // 1. è®°å½•æ—¥å¿—
            log.warn("è¯·æ±‚è¢«é™æµï¼Œèµ„æºï¼šuser:queryï¼Œç”¨æˆ·ï¼š{}", userId);
            
            // 2. è¿”å›å‹å¥½æç¤º
            return "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•";
            
        } catch (Exception e) {
            // ä¸šåŠ¡å¼‚å¸¸
            log.error("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥", e);
            return "æŸ¥è¯¢å¤±è´¥";
            
        } finally {
            // 3. å¿…é¡»é‡Šæ”¾Entry
            if (entry != null) {
                entry.exit();
            }
        }
    }
}
```

**å¼‚å¸¸å¤„ç†è¦ç‚¹**ï¼š
- âœ… åŒºåˆ† `BlockException`ï¼ˆé™æµå¼‚å¸¸ï¼‰å’Œæ™®é€šä¸šåŠ¡å¼‚å¸¸
- âœ… è®°å½•æ—¥å¿—ï¼Œä¾¿äºç›‘æ§å’Œæ’æŸ¥é—®é¢˜
- âœ… è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·
- âœ… finallyå—å¿…é¡»é‡Šæ”¾Entry

### 6.2 èµ„æºæ¸…ç†æœ€ä½³å®è·µ


**ä½¿ç”¨try-with-resourcesè‡ªåŠ¨æ¸…ç†**ï¼š
```java
// â­ æ¨èå†™æ³•ï¼šä½¿ç”¨Sentinelæä¾›çš„å·¥å…·ç±»
public class AutoCleanupExample {
    
    public void queryWithAutoCleanup() {
        // æ–¹å¼1ï¼šä½¿ç”¨SphU.asyncEntryï¼ˆæ¨èï¼‰
        try (Entry entry = SphU.entry("user:query")) {
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            doSomething();
            
        } catch (BlockException e) {
            // å¤„ç†é™æµ
            handleBlock();
        }
        // entryä¼šè‡ªåŠ¨è°ƒç”¨exit()ï¼Œæ— éœ€æ‰‹åŠ¨é‡Šæ”¾
    }
}
```

### 6.3 APIè°ƒç”¨å°è£…æœ€ä½³å®è·µ


**å°è£…ç»Ÿä¸€çš„èµ„æºä¿æŠ¤å·¥å…·ç±»**ï¼š
```java
public class SentinelHelper {
    
    /**
     * æ‰§è¡Œå—ä¿æŠ¤çš„æ“ä½œ
     * @param resourceName èµ„æºå
     * @param supplier è¦æ‰§è¡Œçš„æ“ä½œ
     * @param fallback é™çº§åçš„æ“ä½œ
     */
    public static <T> T executeWithProtection(
            String resourceName,
            Supplier<T> supplier,
            Supplier<T> fallback) {
        
        Entry entry = null;
        try {
            entry = SphU.entry(resourceName);
            return supplier.get();
            
        } catch (BlockException e) {
            return fallback.get();
            
        } finally {
            if (entry != null) {
                entry.exit();
            }
        }
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public static void main(String[] args) {
        // æŸ¥è¯¢ç”¨æˆ·
        String result = SentinelHelper.executeWithProtection(
            "user:query",
            () -> queryUserFromDB(),           // æ­£å¸¸é€»è¾‘
            () -> "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"          // é™çº§é€»è¾‘
        );
    }
}
```

### 6.4 å®Œæ•´å®æˆ˜ç¤ºä¾‹


**ç»¼åˆæ¡ˆä¾‹ï¼šè®¢å•æœåŠ¡ä¿æŠ¤**ï¼š
```java
@Service
public class OrderService {
    
    // 1. åˆå§‹åŒ–è§„åˆ™
    @PostConstruct
    public void initRules() {
        List<FlowRule> rules = new ArrayList<>();
        
        // åˆ›å»ºè®¢å•ï¼šQPSé™åˆ¶ä¸º10
        FlowRule createRule = new FlowRule();
        createRule.setResource("order:create");
        createRule.setGrade(RuleConstant.FLOW_GRADE_QPS);
        createRule.setCount(10);
        rules.add(createRule);
        
        // æŸ¥è¯¢è®¢å•ï¼šQPSé™åˆ¶ä¸º100
        FlowRule queryRule = new FlowRule();
        queryRule.setResource("order:query");
        queryRule.setGrade(RuleConstant.FLOW_GRADE_QPS);
        queryRule.setCount(100);
        rules.add(queryRule);
        
        FlowRuleManager.loadRules(rules);
    }
    
    // 2. åˆ›å»ºè®¢å•ï¼ˆæ‰‹åŠ¨åŸ‹ç‚¹ï¼‰
    public OrderResult createOrder(OrderRequest request) {
        Entry entry = null;
        try {
            // åŸ‹ç‚¹ä¿æŠ¤
            entry = SphU.entry("order:create");
            
            // æ‰§è¡Œåˆ›å»ºè®¢å•é€»è¾‘
            Order order = doCreateOrder(request);
            return OrderResult.success(order);
            
        } catch (BlockException e) {
            // è¢«é™æµäº†
            log.warn("åˆ›å»ºè®¢å•è¢«é™æµ: {}", request);
            return OrderResult.fail("å½“å‰è®¢å•é‡è¾ƒå¤§ï¼Œè¯·ç¨åé‡è¯•");
            
        } catch (Exception e) {
            // ä¸šåŠ¡å¼‚å¸¸
            log.error("åˆ›å»ºè®¢å•å¤±è´¥", e);
            return OrderResult.fail("åˆ›å»ºè®¢å•å¤±è´¥");
            
        } finally {
            if (entry != null) {
                entry.exit();
            }
        }
    }
    
    // 3. æŸ¥è¯¢è®¢å•ï¼ˆä½¿ç”¨å·¥å…·ç±»ï¼‰
    public OrderResult queryOrder(Long orderId) {
        return SentinelHelper.executeWithProtection(
            "order:query",
            () -> {
                Order order = orderMapper.selectById(orderId);
                return OrderResult.success(order);
            },
            () -> OrderResult.fail("æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
        );
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ APIç¼–ç¨‹æ¨¡å¼ï¼šç”¨ä»£ç ç²¾ç¡®æ§åˆ¶Sentinelï¼Œé€‚åˆå¤æ‚åœºæ™¯
ğŸ”¸ Entryå¯¹è±¡ï¼šä»£è¡¨é€šè¿‡Sentinelæ£€æŸ¥çš„"é€šè¡Œè¯"ï¼Œå¿…é¡»é‡Šæ”¾
ğŸ”¸ æ‰‹åŠ¨åŸ‹ç‚¹ï¼šåœ¨å…³é”®ä»£ç ä½ç½®åšæ ‡è®°ï¼Œå®šä¹‰èµ„æºä¿æŠ¤èŒƒå›´
ğŸ”¸ èµ„æºå®šä¹‰ï¼šæ¸…æ™°å‘½åï¼Œåˆç†åˆ’åˆ†ï¼Œä¾¿äºç®¡ç†å’Œç›‘æ§
ğŸ”¸ è§„åˆ™ç®¡ç†ï¼šç”¨ä»£ç åŠ¨æ€é…ç½®é™æµã€é™çº§è§„åˆ™
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šåŒºåˆ†BlockExceptionå’Œä¸šåŠ¡å¼‚å¸¸ï¼Œæä¾›é™çº§é€»è¾‘
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Entryå¯¹è±¡çš„ä¸‰ä¸ªå…³é”®ç‚¹**
```
1. è·å–Entry = é€šè¿‡æ£€æŸ¥
   - SphU.entry() ä¸æŠ›å¼‚å¸¸å°±æ˜¯é€šè¿‡äº†

2. ä½¿ç”¨Entry = æ‰§è¡Œä¸šåŠ¡
   - åœ¨tryå—ä¸­æ‰§è¡Œå—ä¿æŠ¤çš„ä»£ç 

3. é‡Šæ”¾Entry = å½’è¿˜èµ„æº
   - finallyå—ä¸­å¿…é¡»è°ƒç”¨ entry.exit()
   - å¦åˆ™ä¼šé€ æˆèµ„æºæ³„éœ²
```

**ğŸ”¹ ä½•æ—¶ç”¨APIæ¨¡å¼è€Œä¸æ˜¯æ³¨è§£**
```
é€‰æ‹©APIç¼–ç¨‹æ¨¡å¼çš„åœºæ™¯ï¼š
âœ… éSpringç¯å¢ƒï¼ˆå®šæ—¶ä»»åŠ¡ã€åå°çº¿ç¨‹ï¼‰
âœ… éœ€è¦åŠ¨æ€èµ„æºåç§°
âœ… å¤æ‚çš„å¼‚å¸¸å¤„ç†é€»è¾‘
âœ… å¤šå±‚åµŒå¥—çš„æµæ§ç­–ç•¥
âœ… ç²¾ç»†åŒ–çš„èµ„æºæ§åˆ¶

ç»§ç»­ä½¿ç”¨æ³¨è§£çš„åœºæ™¯ï¼š
âœ… Spring MVCæ¥å£ä¿æŠ¤
âœ… ç®€å•çš„æµæ§éœ€æ±‚
âœ… å¿«é€Ÿæ¥å…¥Sentinel
```

**ğŸ”¹ è§„åˆ™å®šä¹‰çš„æœ€ä½³å®è·µ**
```
è§„åˆ™ç®¡ç†å»ºè®®ï¼š
1. é›†ä¸­é…ç½®
   - ç»Ÿä¸€åœ¨é…ç½®ç±»ä¸­åˆå§‹åŒ–è§„åˆ™
   - ä¾¿äºç®¡ç†å’Œç»´æŠ¤

2. åˆ†ç±»ç®¡ç†
   - æŒ‰æ¨¡å—åˆ’åˆ†è§„åˆ™
   - ç”¨æˆ·æ¨¡å—ã€è®¢å•æ¨¡å—åˆ†å¼€ç®¡ç†

3. åŠ¨æ€æ›´æ–°
   - æ”¯æŒè¿è¡Œæ—¶ä¿®æ”¹è§„åˆ™
   - æ— éœ€é‡å¯æœåŠ¡

4. è§„åˆ™æŒä¹…åŒ–
   - è§„åˆ™ä¿å­˜åˆ°é…ç½®ä¸­å¿ƒ
   - æœåŠ¡é‡å¯è§„åˆ™ä¸ä¸¢å¤±
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **é«˜å¹¶å‘æ¥å£ä¿æŠ¤**ï¼šç”¨APIæ¨¡å¼ç²¾ç¡®æ§åˆ¶æ ¸å¿ƒæ¥å£
- **å¤–éƒ¨ä¾èµ–ä¿æŠ¤**ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æ—¶çš„é™çº§å¤„ç†
- **å®šæ—¶ä»»åŠ¡ä¿æŠ¤**ï¼šåå°ä»»åŠ¡çš„æµæ§å’Œç†”æ–­
- **å¤æ‚ä¸šåŠ¡é€»è¾‘**ï¼šå¤šæ­¥éª¤ä¸šåŠ¡çš„ç²¾ç»†åŒ–ä¿æŠ¤

**ä»£ç è§„èŒƒå»ºè®®**ï¼š
```
âœ… ä½¿ç”¨try-finallyä¿è¯Entryé‡Šæ”¾
âœ… åˆç†å‘½åèµ„æºï¼Œä¾¿äºç›‘æ§
âœ… å°è£…å·¥å…·ç±»ï¼Œå‡å°‘é‡å¤ä»£ç 
âœ… è®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
âœ… æä¾›å‹å¥½çš„é™çº§æç¤º
```

### 7.4 å¸¸è§é—®é¢˜ä¸è§£å†³


| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|------|---------|
| **èµ„æºæ³„éœ²** | `å¿˜è®°è°ƒç”¨entry.exit()` | `åœ¨finallyä¸­é‡Šæ”¾` |
| **è§„åˆ™ä¸ç”Ÿæ•ˆ** | `è§„åˆ™åŠ è½½æ—¶æœºä¸å¯¹` | `åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–` |
| **é™æµè¯¯åˆ¤** | `èµ„æºåä¸ä¸€è‡´` | `ç»Ÿä¸€èµ„æºå‘½åè§„èŒƒ` |
| **æ— æ³•åŠ¨æ€è°ƒæ•´** | `è§„åˆ™å†™æ­»åœ¨ä»£ç ä¸­` | `ä½¿ç”¨é…ç½®ä¸­å¿ƒç®¡ç†` |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- APIç¼–ç¨‹æ›´çµæ´»ï¼Œå¤æ‚åœºæ™¯å®ƒæ¥æ‰›
- Entryè·å–è¦tryï¼Œfinallyé‡Šæ”¾ä¸èƒ½å¿˜
- èµ„æºå‘½åè¦è§„èŒƒï¼Œè§„åˆ™ç®¡ç†è¦é›†ä¸­
- å¼‚å¸¸å¤„ç†è¦å®Œå–„ï¼Œé™çº§é€»è¾‘è¦å‹å¥½