---
title: 1ã€é›†ç¾¤æµæ§åŸç†
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤æµæ§åŸç†](#1-é›†ç¾¤æµæ§åŸç†)
2. [é›†ç¾¤æµæ§æ¶æ„](#2-é›†ç¾¤æµæ§æ¶æ„)
3. [Token Serverä¸Client](#3-token-serverä¸client)
4. [é›†ç¾¤æµæ§å®æˆ˜](#4-é›†ç¾¤æµæ§å®æˆ˜)
5. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#5-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ é›†ç¾¤æµæ§åŸç†


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤æµæ§


ğŸ’­ **å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜**ï¼šå‡è®¾ä½ çš„ç³»ç»Ÿéƒ¨ç½²äº†3å°æœåŠ¡å™¨ï¼Œæ¯å°é™æµ100QPSï¼Œé‚£æ•´ä¸ªé›†ç¾¤èƒ½æ‰¿å—å¤šå°‘æµé‡ï¼Ÿ

**ä¼ ç»Ÿå•æœºæµæ§çš„é—®é¢˜**ï¼š
```
åœºæ™¯ï¼šä¸€ä¸ªæœåŠ¡éƒ¨ç½²3ä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹é™æµ100 QPS

å®ä¾‹Aï¼šé™æµ100 QPS  â”
å®ä¾‹Bï¼šé™æµ100 QPS  â”œâ”€ æ€»å…±æœ€å¤š300 QPS
å®ä¾‹Cï¼šé™æµ100 QPS  â”˜

âŒ é—®é¢˜1ï¼šæµé‡ä¸å‡åŒ€
- å®ä¾‹Aï¼šæ”¶åˆ°150ä¸ªè¯·æ±‚ â†’ 50ä¸ªè¢«æ‹’ç»
- å®ä¾‹Bï¼šæ”¶åˆ°50ä¸ªè¯·æ±‚  â†’ å…¨éƒ¨é€šè¿‡
- å®ä¾‹Cï¼šæ”¶åˆ°100ä¸ªè¯·æ±‚ â†’ å…¨éƒ¨é€šè¿‡
ç»“æœï¼šæ€»å…±åªå¤„ç†äº†250ä¸ªï¼Œä½†å®é™…å¯ä»¥å¤„ç†300ä¸ª

âŒ é—®é¢˜2ï¼šæ‰©å®¹ç¼©å®¹å½±å“å¤§
- æ‰©å®¹åˆ°4ä¸ªå®ä¾‹ â†’ æ€»é™æµå˜æˆ400 QPSï¼ˆå¯èƒ½è¶…å‡ºåç«¯æ‰¿å—èƒ½åŠ›ï¼‰
- ç¼©å®¹åˆ°2ä¸ªå®ä¾‹ â†’ æ€»é™æµå˜æˆ200 QPSï¼ˆæµªè´¹èµ„æºï¼‰
```

ğŸ¯ **é›†ç¾¤æµæ§çš„è§£å†³æ–¹æ¡ˆ**ï¼šæŠŠæ‰€æœ‰å®ä¾‹çœ‹ä½œä¸€ä¸ªæ•´ä½“ï¼Œç»Ÿä¸€æ§åˆ¶æ€»æµé‡

---

### 1.2 é›†ç¾¤æµæ§æ ¸å¿ƒæ€æƒ³


**ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ**ï¼š`é›†ç¾¤æµæ§` = æŠŠé™æµè§„åˆ™ä»"æ¯ä¸ªå®ä¾‹å•ç‹¬é™æµ"å˜æˆ"æ•´ä¸ªé›†ç¾¤ç»Ÿä¸€é™æµ"

**ğŸ·ï¸ ä¸“ä¸šæœ¯è¯­è§£é‡Š**ï¼š
- **Token Server**ï¼ˆä»¤ç‰ŒæœåŠ¡å™¨ï¼‰ï¼šé›†ç¾¤ä¸­çš„"ç®¡ç†å‘˜"ï¼Œè´Ÿè´£å‘æ”¾é€šè¡Œè¯
- **Token Client**ï¼ˆä»¤ç‰Œå®¢æˆ·ç«¯ï¼‰ï¼šé›†ç¾¤ä¸­çš„"å‘˜å·¥"ï¼Œéœ€è¦å‘ç®¡ç†å‘˜ç”³è¯·é€šè¡Œè¯
- **é›†ç¾¤æ€»é‡æ§åˆ¶**ï¼šæ•´ä¸ªé›†ç¾¤åªæœ‰ä¸€ä¸ªæ€»é¢åº¦ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«
- **å•æœºå‡æ‘Š**ï¼šæŠŠæ€»é¢åº¦å¹³å‡åˆ†ç»™æ¯ä¸ªå®ä¾‹

ğŸŒ° **ç”Ÿæ´»åŒ–ä¾‹å­**ï¼š

```
ä¼ ç»Ÿå•æœºé™æµ â‰ˆ æ¯ä¸ªæ”¶é“¶å‘˜å„ç®¡å„çš„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ”¶é“¶å°Aï¼šæ¯å°æ—¶æœåŠ¡100äºº         â”‚
â”‚ æ”¶é“¶å°Bï¼šæ¯å°æ—¶æœåŠ¡100äºº         â”‚
â”‚ æ”¶é“¶å°Cï¼šæ¯å°æ—¶æœåŠ¡100äºº         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†’ å®¢äººåˆ†é…ä¸å‡æ—¶ï¼Œæœ‰çš„æ”¶é“¶å°é—²ç€ï¼Œæœ‰çš„æ’é•¿é˜Ÿ

é›†ç¾¤æµæ§ â‰ˆ è®¾ç«‹ä¸€ä¸ªæ€»è°ƒåº¦ä¸­å¿ƒï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ€»è°ƒåº¦ä¸­å¿ƒï¼ˆToken Serverï¼‰â”‚
â”‚      "æ•´ä¸ªè¶…å¸‚åªæœåŠ¡300äºº/å°æ—¶"  â”‚
â”‚               â†“â†“â†“               â”‚
â”‚    æ”¶é“¶å°A â† æ”¶é“¶å°B â† æ”¶é“¶å°C   â”‚
â”‚    ï¼ˆéƒ½å‘è°ƒåº¦ä¸­å¿ƒç”³è¯·æœåŠ¡èµ„æ ¼ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†’ å“ªä¸ªæ”¶é“¶å°æ¥å®¢äººï¼Œå°±å‘æ€»è°ƒåº¦ç”³è¯·é…é¢
```

---

### 1.3 é›†ç¾¤æµæ§å·¥ä½œåŸç†


**ğŸ“‹ åŸºæœ¬å·¥ä½œæµç¨‹**ï¼š

```
æ­¥éª¤1ï¼šé€‰ä¸¾Token Server
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é›†ç¾¤å¯åŠ¨æ—¶ï¼Œä»å¤šä¸ªå®ä¾‹ä¸­é€‰ä¸€ä¸ªå½“ç®¡ç†å‘˜  â”‚
â”‚                                         â”‚
â”‚  å®ä¾‹A  å®ä¾‹B  å®ä¾‹C                    â”‚
â”‚   â†“      â†“      â†“                      â”‚
â”‚   é€‰ä¸¾æŠ•ç¥¨...                           â”‚
â”‚   â†“                                     â”‚
â”‚  å®ä¾‹B å½“é€‰ä¸º Token Server              â”‚
â”‚  å®ä¾‹Aã€C æˆä¸º Token Client             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šToken Server åˆå§‹åŒ–é…é¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Token Serverï¼ˆå®ä¾‹Bï¼‰                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ€»é…é¢ï¼š300 QPS                 â”‚   â”‚
â”‚  â”‚ å‰©ä½™é…é¢ï¼š300                   â”‚   â”‚
â”‚  â”‚ é…é¢åˆ·æ–°ï¼šæ¯ç§’é‡ç½®              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3ï¼šè¯·æ±‚å¤„ç†æµç¨‹
å®¢æˆ·ç«¯è¯·æ±‚ â†’ Token Client â†’ å‘Token Serverç”³è¯·ä»¤ç‰Œ
                              â†“
                         æœ‰å‰©ä½™é…é¢ï¼Ÿ
                         â†™        â†˜
                      æ˜¯          å¦
                      â†“           â†“
                   è¿”å›é€šè¿‡      è¿”å›æ‹’ç»
                      â†“           â†“
                  å¤„ç†è¯·æ±‚      æ‹’ç»è¯·æ±‚
```

**ğŸ” æ·±å…¥ç†è§£**ï¼š

| å¯¹æ¯”é¡¹ | å•æœºæµæ§ | é›†ç¾¤æµæ§ |
|--------|---------|---------|
| **é…é¢ç®¡ç†** | æ¯ä¸ªå®ä¾‹ç‹¬ç«‹ç®¡ç† | Token Serverç»Ÿä¸€ç®¡ç† |
| **æµé‡å‡è¡¡** | å¯èƒ½ä¸å‡è¡¡ | è‡ªåŠ¨å‡è¡¡ |
| **æ‰©ç¼©å®¹å½±å“** | æ€»é™æµéšå®ä¾‹æ•°å˜åŒ– | æ€»é™æµä¿æŒä¸å˜ |
| **å®ç°å¤æ‚åº¦** | ç®€å• | éœ€è¦é¢å¤–çš„é€šä¿¡æœºåˆ¶ |
| **é€‚ç”¨åœºæ™¯** | å°è§„æ¨¡ã€æµé‡å‡åŒ€ | å¤§è§„æ¨¡ã€æµé‡ä¸å‡ |

---

## 2. ğŸ—ï¸ é›†ç¾¤æµæ§æ¶æ„


### 2.1 æ¶æ„è§’è‰²åˆ’åˆ†


**ğŸ“Š é›†ç¾¤ä¸­çš„ä¸¤ç§è§’è‰²**ï¼š

```
è§’è‰²1ï¼šToken Serverï¼ˆä»¤ç‰ŒæœåŠ¡å™¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Token Server èŒè´£           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ç®¡ç†é›†ç¾¤æ€»é…é¢                     â”‚
â”‚ âœ… æ¥æ”¶Token Clientçš„ä»¤ç‰Œç”³è¯·        â”‚
â”‚ âœ… åˆ†é…æˆ–æ‹’ç»ä»¤ç‰Œ                     â”‚
â”‚ âœ… ç»Ÿè®¡é›†ç¾¤æ€»æµé‡                     â”‚
â”‚ âœ… å®šæ—¶åˆ·æ–°é…é¢                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§’è‰²2ï¼šToken Clientï¼ˆä»¤ç‰Œå®¢æˆ·ç«¯ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Token Client èŒè´£           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æ¥æ”¶å®é™…çš„ä¸šåŠ¡è¯·æ±‚                 â”‚
â”‚ âœ… å‘Token Serverç”³è¯·ä»¤ç‰Œ            â”‚
â”‚ âœ… æ ¹æ®ç”³è¯·ç»“æœå†³å®šæ˜¯å¦æ”¾è¡Œ           â”‚
â”‚ âœ… æœ¬åœ°ä¹Ÿå¯ä»¥ä¿ç•™å°‘é‡é…é¢ï¼ˆé™çº§ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ­ è§’è‰²æ‰®æ¼”ç†è§£**ï¼š

```
Token Server å°±åƒæ˜¯é“¶è¡Œçš„"æ€»è¡Œ"ï¼š
- æŒæ¡æ‰€æœ‰çš„èµ„é‡‘ï¼ˆé…é¢ï¼‰
- å„ä¸ªæ”¯è¡Œï¼ˆToken Clientï¼‰è¦ç”¨é’±å¾—å‘æ€»è¡Œç”³è¯·
- æ€»è¡Œå®æ—¶ç›‘æ§æ‰€æœ‰æ”¯è¡Œçš„ç”¨æ¬¾æƒ…å†µ
- æ€»è¡Œæ¯å¤©ï¼ˆæ¯ç§’ï¼‰ä¼šé‡ç½®å¯ç”¨é¢åº¦

Token Client å°±åƒæ˜¯é“¶è¡Œçš„"æ”¯è¡Œ"ï¼š
- æœ‰å®¢æˆ·æ¥åŠä¸šåŠ¡ï¼ˆè¯·æ±‚ï¼‰
- éœ€è¦å‘æ€»è¡Œç¡®è®¤æ˜¯å¦æœ‰é¢åº¦
- å¾—åˆ°æ‰¹å‡†åæ‰èƒ½åŠç†ä¸šåŠ¡
- é‡åˆ°æ€»è¡Œä¸å¯ç”¨æ—¶ï¼Œå¯ä»¥ç”¨è‡ªå·±çš„å¤‡ç”¨é‡‘ï¼ˆé™çº§ï¼‰
```

---

### 2.2 é€šä¿¡æ¶æ„


**ğŸ”— Token Server ä¸ Token Client é€šä¿¡æ–¹å¼**ï¼š

```
æ–¹å¼ä¸€ï¼šåµŒå…¥å¼ï¼ˆEmbedded Modeï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æŸä¸€ä¸ªåº”ç”¨å®ä¾‹åŒæ—¶æ‰®æ¼”ä¸¤ä¸ªè§’è‰²       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  åº”ç”¨å®ä¾‹Bï¼ˆåŒé‡èº«ä»½ï¼‰              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ä¸šåŠ¡å¤„ç†å±‚â”‚  â”‚ Token Server â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚       â†“              â†‘              â”‚   â”‚
â”‚  â”‚  Token Client    å¤„ç†ä»¤ç‰Œç”³è¯·      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                      â†‘
   å®ä¾‹Aç”³è¯·ä»¤ç‰Œ          å®ä¾‹Cç”³è¯·ä»¤ç‰Œ

âœ… ä¼˜ç‚¹ï¼šéƒ¨ç½²ç®€å•ï¼Œæ— éœ€é¢å¤–æœåŠ¡å™¨
âŒ ç¼ºç‚¹ï¼šServeræŒ‚äº†å½±å“ä¸šåŠ¡

æ–¹å¼äºŒï¼šç‹¬ç«‹éƒ¨ç½²ï¼ˆStandalone Modeï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç‹¬ç«‹çš„ Token Server æœåŠ¡             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚    ä¸“é—¨çš„ Token Server é›†ç¾¤      â”‚      â”‚
â”‚  â”‚  ï¼ˆç‹¬ç«‹éƒ¨ç½²ï¼Œä¸å¤„ç†ä¸šåŠ¡è¯·æ±‚ï¼‰    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†‘           â†‘           â†‘
      å®ä¾‹A       å®ä¾‹B       å®ä¾‹C
   ï¼ˆçº¯Token Clientï¼‰

âœ… ä¼˜ç‚¹ï¼šèŒè´£åˆ†ç¦»ï¼Œç¨³å®šæ€§é«˜
âŒ ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–çš„æœåŠ¡å™¨èµ„æº
```

**ğŸ’¡ é€‰æ‹©å»ºè®®**ï¼š

| åœºæ™¯ | æ¨èæ–¹å¼ | åŸå›  |
|------|---------|------|
| å¼€å‘/æµ‹è¯•ç¯å¢ƒ | åµŒå…¥å¼ | éƒ¨ç½²ç®€å•ï¼Œå¿«é€ŸéªŒè¯ |
| å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ | åµŒå…¥å¼ | èŠ‚çœèµ„æº |
| å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ | ç‹¬ç«‹éƒ¨ç½² | ç¨³å®šå¯é ï¼Œæ˜“äºç®¡ç† |
| å¯¹å¯ç”¨æ€§è¦æ±‚æé«˜ | ç‹¬ç«‹éƒ¨ç½² | Token Serverå¯ä»¥åšé›†ç¾¤ |

---

## 3. ğŸ”‘ Token Serverä¸Clientè¯¦è§£


### 3.1 Token Serveræ ¸å¿ƒæœºåˆ¶


**ğŸ“¦ Token Serverçš„é…é¢ç®¡ç†**ï¼š

```
é…é¢åˆ·æ–°æœºåˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´ï¼šç¬¬1ç§’                           â”‚
â”‚  æ€»é…é¢ï¼š300 QPS                       â”‚
â”‚  å‰©ä½™é…é¢ï¼š300                         â”‚
â”‚                                        â”‚
â”‚  å¤„ç†è¯·æ±‚ï¼š                            â”‚
â”‚  å®ä¾‹Aç”³è¯·10ä¸ª â†’ æ‰¹å‡† â†’ å‰©ä½™290       â”‚
â”‚  å®ä¾‹Bç”³è¯·50ä¸ª â†’ æ‰¹å‡† â†’ å‰©ä½™240       â”‚
â”‚  å®ä¾‹Cç”³è¯·200ä¸ª â†’ æ‰¹å‡† â†’ å‰©ä½™40       â”‚
â”‚  å®ä¾‹Aç”³è¯·100ä¸ª â†’ æ‹’ç»60ä¸ª(åªæ‰¹40)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¶é—´ï¼šç¬¬2ç§’ï¼ˆé…é¢é‡ç½®ï¼‰               â”‚
â”‚  æ€»é…é¢ï¼š300 QPS                       â”‚
â”‚  å‰©ä½™é…é¢ï¼š300ï¼ˆæ¢å¤æ»¡é¢ï¼‰             â”‚
â”‚                                        â”‚
â”‚  æ–°ä¸€è½®ç”³è¯·...                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš™ï¸ é…é¢åˆ†é…ç­–ç•¥**ï¼š

```java
// ç®€åŒ–çš„Token Serveré…é¢åˆ†é…é€»è¾‘
public class TokenServer {
    private long totalQuota = 300;  // æ€»é…é¢
    private long remainingQuota = 300;  // å‰©ä½™é…é¢
    private long lastRefreshTime = System.currentTimeMillis();
    
    // ç”³è¯·ä»¤ç‰Œ
    public TokenResult requestToken(int count) {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ·æ–°é…é¢
        refreshQuotaIfNeeded();
        
        if (remainingQuota >= count) {
            remainingQuota -= count;
            return TokenResult.success(count);
        } else {
            // éƒ¨åˆ†æ»¡è¶³æˆ–å®Œå…¨æ‹’ç»
            int granted = (int) Math.min(remainingQuota, count);
            remainingQuota = 0;
            return granted > 0 ? 
                TokenResult.partial(granted) : 
                TokenResult.reject();
        }
    }
    
    // æ¯ç§’åˆ·æ–°é…é¢
    private void refreshQuotaIfNeeded() {
        long now = System.currentTimeMillis();
        if (now - lastRefreshTime >= 1000) {
            remainingQuota = totalQuota;
            lastRefreshTime = now;
        }
    }
}
```

---

### 3.2 Token Clientç”³è¯·æµç¨‹


**ğŸ”„ Token Clientçš„ä»¤ç‰Œç”³è¯·**ï¼š

```
è¯·æ±‚åˆ°æ¥æ—¶çš„å¤„ç†æµç¨‹ï¼š

æ­¥éª¤1ï¼šæœ¬åœ°é¢„æ£€æŸ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Token Clientæ”¶åˆ°è¯·æ±‚        â”‚
â”‚  â†“                           â”‚
â”‚  æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰é¢„ç•™é…é¢ï¼Ÿ    â”‚
â”‚  â”œâ”€æœ‰ â†’ ç›´æ¥æ”¾è¡Œï¼ˆå¿«é€Ÿè·¯å¾„ï¼‰ â”‚
â”‚  â””â”€æ—  â†’ ç»§ç»­å‘Serverç”³è¯·     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šå‘Serverç”³è¯·
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é€ä»¤ç‰Œç”³è¯·è¯·æ±‚            â”‚
â”‚  â†“                           â”‚
â”‚  Token Serverå“åº”            â”‚
â”‚  â”œâ”€æ‰¹å‡† â†’ æ”¾è¡Œè¯·æ±‚           â”‚
â”‚  â”œâ”€æ‹’ç» â†’ è§¦å‘é™æµ           â”‚
â”‚  â””â”€è¶…æ—¶ â†’ é™çº§å¤„ç†           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3ï¼šé™çº§å¤„ç†ï¼ˆServerä¸å¯ç”¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½¿ç”¨æœ¬åœ°å•æœºæµæ§è§„åˆ™        â”‚
â”‚  â†“                           â”‚
â”‚  å•æœºé™æµ100 QPS             â”‚
â”‚  â†“                           â”‚
â”‚  ä¿è¯åŸºæœ¬æœåŠ¡å¯ç”¨æ€§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ Clientç«¯é…ç½®ç¤ºä¾‹**ï¼š

```java
// Token Clienté…ç½®
@Configuration
public class ClusterConfig {
    
    @Bean
    public void initClusterFlowRules() {
        // å®šä¹‰é›†ç¾¤æµæ§è§„åˆ™
        FlowRule rule = new FlowRule("resourceName")
            .setCount(300)  // é›†ç¾¤æ€»é™æµ300 QPS
            .setClusterMode(true)  // å¼€å¯é›†ç¾¤æ¨¡å¼
            .setClusterConfig(
                new ClusterFlowConfig()
                    .setThresholdType(ClusterRuleConstant.FLOW_THRESHOLD_GLOBAL)
                    .setFallbackToLocalWhenFail(true)  // Serverå¤±è´¥æ—¶é™çº§åˆ°æœ¬åœ°
            );
            
        FlowRuleManager.loadRules(Arrays.asList(rule));
    }
}
```

**ğŸš¨ é™çº§ç­–ç•¥è¯´æ˜**ï¼š

| é™çº§åœºæ™¯ | å¤„ç†æ–¹å¼ | è¯´æ˜ |
|---------|---------|------|
| Token Serverå®•æœº | ä½¿ç”¨æœ¬åœ°å•æœºè§„åˆ™ | æ¯ä¸ªå®ä¾‹ç‹¬ç«‹é™æµï¼Œä¿è¯åŸºæœ¬å¯ç”¨ |
| ç½‘ç»œè¶…æ—¶ | ä½¿ç”¨æœ¬åœ°è§„åˆ™ | é¿å…å› ç½‘ç»œé—®é¢˜å½±å“ä¸šåŠ¡ |
| Serverå“åº”æ…¢ | è®¾ç½®è¶…æ—¶æ—¶é—´ | è¶…æ—¶åç«‹å³é™çº§ |
| Serverè¿‡è½½ | æ‹’ç»éƒ¨åˆ†ç”³è¯· | ä¿æŠ¤Serverè‡ªèº« |

---

## 4. ğŸ› ï¸ é›†ç¾¤æµæ§å®æˆ˜


### 4.1 åµŒå…¥å¼æ¨¡å¼é…ç½®


**ğŸ“‹ å®Œæ•´é…ç½®æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**
```xml
<!-- Sentinelé›†ç¾¤ä¾èµ– -->
<dependency>
    <groupId>com.alibaba.csp</groupId>
    <artifactId>sentinel-cluster-server-default</artifactId>
    <version>1.8.6</version>
</dependency>
<dependency>
    <groupId>com.alibaba.csp</groupId>
    <artifactId>sentinel-cluster-client-default</artifactId>
    <version>1.8.6</version>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®Token Serverï¼ˆé€‰å…¶ä¸­ä¸€ä¸ªå®ä¾‹ï¼‰**
```java
@Configuration
public class TokenServerConfig {
    
    @PostConstruct
    public void initTokenServer() {
        // æŒ‡å®šServerç«¯å£
        ClusterServerConfigManager.loadGlobalTransportConfig(
            new ServerTransportConfig()
                .setPort(9999)  // Token Serverç›‘å¬ç«¯å£
                .setIdleSeconds(600)  // è¿æ¥ç©ºé—²æ—¶é—´
        );
        
        // é…ç½®å‘½åç©ºé—´ï¼ˆå¯ä»¥ä¸ºä¸åŒåº”ç”¨åˆ†ç»„ï¼‰
        ClusterServerConfigManager.loadServerNamespaceSet(
            Collections.singleton("app-demo")
        );
        
        // å¯åŠ¨Token Server
        ClusterTokenServer tokenServer = new SentinelDefaultTokenServer();
        tokenServer.start();
    }
}
```

**æ­¥éª¤3ï¼šé…ç½®Token Clientï¼ˆå…¶ä»–å®ä¾‹ï¼‰**
```java
@Configuration
public class TokenClientConfig {
    
    @PostConstruct
    public void initTokenClient() {
        // é…ç½®Token Serveråœ°å€
        ClusterClientConfigManager.applyNewConfig(
            new ClusterClientConfig()
                .setServerHost("192.168.1.100")  // Token Server IP
                .setServerPort(9999)  // Token Serverç«¯å£
                .setRequestTimeout(2000)  // è¯·æ±‚è¶…æ—¶æ—¶é—´
        );
        
        // å¯åŠ¨Token Client
        ClusterTokenClient tokenClient = new SentinelDefaultTokenClient();
        tokenClient.start();
    }
}
```

**æ­¥éª¤4ï¼šå®šä¹‰é›†ç¾¤æµæ§è§„åˆ™**
```java
@Service
public class ClusterFlowRuleService {
    
    public void initClusterRules() {
        List<FlowRule> rules = new ArrayList<>();
        
        // é›†ç¾¤æµæ§è§„åˆ™
        FlowRule clusterRule = new FlowRule("/api/order")
            .setCount(300)  // é›†ç¾¤æ€»æµé‡300 QPS
            .setGrade(RuleConstant.FLOW_GRADE_QPS)
            .setClusterMode(true)  // é›†ç¾¤æ¨¡å¼
            .setClusterConfig(
                new ClusterFlowConfig()
                    .setThresholdType(ClusterRuleConstant.FLOW_THRESHOLD_GLOBAL)
                    .setFallbackToLocalWhenFail(true)  // é™çº§åˆ°æœ¬åœ°
            );
        
        rules.add(clusterRule);
        FlowRuleManager.loadRules(rules);
    }
}
```

---

### 4.2 å®é™…æ•ˆæœéªŒè¯


**ğŸ§ª æµ‹è¯•åœºæ™¯**ï¼š3ä¸ªå®ä¾‹ï¼Œé›†ç¾¤é™æµ300 QPS

```
æµ‹è¯•1ï¼šæµé‡å‡åŒ€åˆ†å¸ƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»æµé‡ï¼š300 QPS                            â”‚
â”‚                                            â”‚
â”‚ å®ä¾‹Aï¼š100 QPS â†’ Token Serveræ‰¹å‡† â†’ å…¨é€šè¿‡â”‚
â”‚ å®ä¾‹Bï¼š100 QPS â†’ Token Serveræ‰¹å‡† â†’ å…¨é€šè¿‡â”‚
â”‚ å®ä¾‹Cï¼š100 QPS â†’ Token Serveræ‰¹å‡† â†’ å…¨é€šè¿‡â”‚
â”‚                                            â”‚
â”‚ âœ… ç»“æœï¼š300ä¸ªè¯·æ±‚å…¨éƒ¨å¤„ç†                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æµ‹è¯•2ï¼šæµé‡é›†ä¸­åˆ°å®ä¾‹A
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€»æµé‡ï¼š500 QPS                            â”‚
â”‚                                            â”‚
â”‚ å®ä¾‹Aï¼š400 QPS â†’ Token Serveræ‰¹å‡†250ä¸ª    â”‚
â”‚               â†’ æ‹’ç»150ä¸ª                  â”‚
â”‚ å®ä¾‹Bï¼š50 QPS  â†’ Token Serveræ‰¹å‡†50ä¸ª     â”‚
â”‚ å®ä¾‹Cï¼š50 QPS  â†’ Token Serveræ‰¹å‡†0ä¸ª      â”‚
â”‚              ï¼ˆé…é¢å·²ç”¨å®Œï¼‰                â”‚
â”‚                                            â”‚
â”‚ âœ… ç»“æœï¼šç²¾å‡†æ§åˆ¶åœ¨300ä¸ªè¯·æ±‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æµ‹è¯•3ï¼šToken Serverå®•æœº
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Token Serverä¸å¯ç”¨                         â”‚
â”‚                                            â”‚
â”‚ å®ä¾‹Aï¼šé™çº§ä¸ºå•æœº100 QPS                   â”‚
â”‚ å®ä¾‹Bï¼šé™çº§ä¸ºå•æœº100 QPS                   â”‚
â”‚ å®ä¾‹Cï¼šé™çº§ä¸ºå•æœº100 QPS                   â”‚
â”‚                                            â”‚
â”‚ âœ… ç»“æœï¼šè™½ç„¶æ€»é™æµå˜æˆ300ï¼Œä½†ä¿è¯å¯ç”¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4.3 ç‹¬ç«‹éƒ¨ç½²æ¨¡å¼


**ğŸ¢ Token Serverç‹¬ç«‹éƒ¨ç½²æ–¹æ¡ˆ**ï¼š

```
æ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç‹¬ç«‹Token Serveré›†ç¾¤ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Server-1  â”‚  â”‚ Server-2  â”‚ (ä¸»å¤‡)       â”‚
â”‚  â”‚  ç«¯å£9999 â”‚  â”‚  ç«¯å£9999 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘           â†‘
              |           |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”
â”‚å®ä¾‹A   â”‚  â”‚ å®ä¾‹B   â”‚  â”‚ å®ä¾‹C    â”‚
â”‚(Client)â”‚  â”‚(Client) â”‚  â”‚(Client)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®æ–¹å¼**ï¼š

```yaml
# Token Serveré…ç½®ï¼ˆapplication.ymlï¼‰
spring:
  application:
    name: sentinel-token-server
    
server:
  port: 8719  # ä¸šåŠ¡ç«¯å£
  
# Sentinelé…ç½®
sentinel:
  transport:
    port: 9999  # Token Serverç«¯å£
  cluster:
    server:
      port: 9999
      idle-seconds: 600
```

```yaml
# Token Clienté…ç½®ï¼ˆä¸šåŠ¡åº”ç”¨ï¼‰
spring:
  cloud:
    sentinel:
      cluster:
        client:
          server-host: token-server.example.com
          server-port: 9999
          request-timeout: 2000
```

---

## 5. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 5.1 é›†ç¾¤æµæ§å…³é”®ç†è§£


**ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µå›é¡¾**ï¼š

```
âœ… é›†ç¾¤æµæ§ = æŠŠå¤šä¸ªå®ä¾‹å½“ä½œä¸€ä¸ªæ•´ä½“æ¥é™æµ
âœ… Token Server = é›†ç¾¤çš„"é…é¢ç®¡ç†å‘˜"
âœ… Token Client = éœ€è¦å‘ç®¡ç†å‘˜"ç”³è¯·é…é¢"çš„å®ä¾‹
âœ… æ€»é‡æ§åˆ¶ = æ— è®ºæœ‰å¤šå°‘å®ä¾‹,æ€»æµé‡éƒ½æ˜¯å›ºå®šçš„
âœ… é™çº§æœºåˆ¶ = Serverä¸å¯ç”¨æ—¶,è‡ªåŠ¨åˆ‡æ¢åˆ°å•æœºé™æµ
```

**ğŸ’¡ è®¾è®¡æ€æƒ³**ï¼š

| æ–¹é¢ | ä¼ ç»Ÿå•æœºæµæ§ | é›†ç¾¤æµæ§ |
|------|------------|---------|
| **é™æµç²’åº¦** | æ¯ä¸ªå®ä¾‹å„ç®¡å„çš„ | æ•´ä¸ªé›†ç¾¤ç»Ÿä¸€ç®¡ç† |
| **æµé‡é€‚é…** | éœ€è¦æ‰‹åŠ¨ä¼°ç®— | è‡ªåŠ¨é€‚é…æµé‡åˆ†å¸ƒ |
| **æ‰©ç¼©å®¹** | å½±å“æ€»é™æµ | æ€»é™æµä¸å˜ |
| **å®ç°æ–¹å¼** | æœ¬åœ°è®¡æ•° | è¿œç¨‹ç”³è¯·ä»¤ç‰Œ |

---

### 5.2 æŠ€æœ¯é€‰å‹å»ºè®®


**ğŸ¯ ä½•æ—¶ä½¿ç”¨é›†ç¾¤æµæ§**ï¼š

```
âœ… æ¨èä½¿ç”¨åœºæ™¯ï¼š
- å®ä¾‹æ•°è¾ƒå¤šï¼ˆ>=3ä¸ªï¼‰
- æµé‡åˆ†å¸ƒä¸å‡åŒ€
- éœ€è¦ç²¾ç¡®æ§åˆ¶æ€»æµé‡
- é¢‘ç¹æ‰©ç¼©å®¹çš„æœåŠ¡
- å¯¹é™æµç²¾åº¦è¦æ±‚é«˜

âŒ ä¸æ¨èä½¿ç”¨åœºæ™¯ï¼š
- åªæœ‰1-2ä¸ªå®ä¾‹
- æµé‡åˆ†å¸ƒå¾ˆå‡åŒ€
- ç½‘ç»œç¯å¢ƒä¸ç¨³å®š
- å¯¹å»¶è¿Ÿè¦æ±‚æé«˜ï¼ˆæ¯æ¬¡éƒ½è¦è¿œç¨‹è°ƒç”¨ï¼‰
```

**âš–ï¸ éƒ¨ç½²æ¨¡å¼é€‰æ‹©**ï¼š

| éƒ¨ç½²æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|---------|------|------|
| **åµŒå…¥å¼** | å¼€å‘æµ‹è¯•/å°è§„æ¨¡ | éƒ¨ç½²ç®€å•ã€èŠ‚çœèµ„æº | ServeræŒ‚äº†å½±å“ä¸šåŠ¡ |
| **ç‹¬ç«‹éƒ¨ç½²** | ç”Ÿäº§ç¯å¢ƒ/å¤§è§„æ¨¡ | ç¨³å®šå¯é ã€æ˜“æ‰©å±• | éœ€è¦é¢å¤–æœåŠ¡å™¨ |

---

### 5.3 æœ€ä½³å®è·µ


**ğŸ”§ é…ç½®ä¼˜åŒ–å»ºè®®**ï¼š

```
1. è¶…æ—¶æ—¶é—´è®¾ç½®
   requestTimeout: 2000msï¼ˆæ¨èï¼‰
   â†’ å¤ªçŸ­ï¼šå®¹æ˜“è¶…æ—¶é™çº§
   â†’ å¤ªé•¿ï¼šå½±å“å“åº”é€Ÿåº¦

2. é™çº§ç­–ç•¥
   fallbackToLocalWhenFail: trueï¼ˆå¼ºçƒˆæ¨èï¼‰
   â†’ ä¿è¯åœ¨Serveræ•…éšœæ—¶æœåŠ¡å¯ç”¨

3. Token Serveré«˜å¯ç”¨
   â†’ ç”Ÿäº§ç¯å¢ƒå»ºè®®éƒ¨ç½²ç‹¬ç«‹çš„Token Serveré›†ç¾¤
   â†’ ä½¿ç”¨ä¸»å¤‡æ¨¡å¼æˆ–å¤šæ´»æ¨¡å¼

4. ç›‘æ§å‘Šè­¦
   â†’ ç›‘æ§Token Serverçš„å¯ç”¨æ€§
   â†’ ç›‘æ§Clientç”³è¯·ä»¤ç‰Œçš„æˆåŠŸç‡
   â†’ ç›‘æ§é™çº§è§¦å‘é¢‘ç‡
```

**ğŸ“Š æ€§èƒ½è€ƒè™‘**ï¼š

```
é›†ç¾¤æµæ§çš„é¢å¤–å¼€é”€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•æœºæµæ§ï¼šæœ¬åœ°è®¡æ•°ï¼ˆå¾®ç§’çº§ï¼‰     â”‚
â”‚ é›†ç¾¤æµæ§ï¼šç½‘ç»œè¯·æ±‚ï¼ˆæ¯«ç§’çº§ï¼‰     â”‚
â”‚                                  â”‚
â”‚ é¢å¤–è€—æ—¶ï¼š1-5msï¼ˆå±€åŸŸç½‘ï¼‰        â”‚
â”‚           5-20msï¼ˆè·¨æœºæˆ¿ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š
- Token Clientå¯ä»¥æ‰¹é‡ç”³è¯·ä»¤ç‰Œ
- è®¾ç½®åˆç†çš„æœ¬åœ°é¢„ç•™é…é¢
- Serverå’ŒClientå°½é‡éƒ¨ç½²åœ¨åŒä¸€ç½‘ç»œ
```

---

### 5.4 å¿«é€Ÿè®°å¿†


**ğŸ¯ ä¸€å¥è¯æ€»ç»“**ï¼š
> é›†ç¾¤æµæ§å°±æ˜¯è®©ä¸€ä¸ª"ç®¡ç†å‘˜"(Token Server)ç»Ÿä¸€ç®¡ç†æ•´ä¸ªé›†ç¾¤çš„æµé‡é…é¢ï¼Œå…¶ä»–å®ä¾‹(Token Client)éœ€è¦å¤„ç†è¯·æ±‚æ—¶éƒ½è¦å…ˆå‘ç®¡ç†å‘˜ç”³è¯·ï¼Œè¿™æ ·æ— è®ºæµé‡å¦‚ä½•åˆ†å¸ƒï¼Œæ€»é‡éƒ½èƒ½ç²¾ç¡®æ§åˆ¶ã€‚

**ğŸ“ æ ¸å¿ƒè¦ç‚¹**ï¼š
- Token ServeræŒæ¡å…¨å±€é…é¢
- Token Clientè´Ÿè´£ç”³è¯·ä»¤ç‰Œ
- é™çº§ä¿è¯é«˜å¯ç”¨
- ç‹¬ç«‹éƒ¨ç½²æ›´ç¨³å®š

**ğŸ”„ å·¥ä½œæµç¨‹è®°å¿†**ï¼š
```
è¯·æ±‚æ¥äº† â†’ Clientç”³è¯· â†’ Serveræ‰¹å‡†/æ‹’ç» â†’ æ”¾è¡Œ/é™æµ
         â†“ï¼ˆServeræŒ‚äº†ï¼‰
       é™çº§åˆ°æœ¬åœ°å•æœºé™æµ
```