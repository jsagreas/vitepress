---
title: 4ã€æœåŠ¡ç½‘å…³
---
## ğŸ“š ç›®å½•

1. [APIç½‘å…³åŸºç¡€æ¦‚å¿µ](#1-APIç½‘å…³åŸºç¡€æ¦‚å¿µ)
2. [Spring Cloud Gatewayè¯¦è§£](#2-Spring-Cloud-Gatewayè¯¦è§£)
3. [Zuulç½‘å…³ä»‹ç»](#3-Zuulç½‘å…³ä»‹ç»)
4. [è·¯ç”±é…ç½®ä¸æ–­è¨€å·¥å‚](#4-è·¯ç”±é…ç½®ä¸æ–­è¨€å·¥å‚)
5. [è¿‡æ»¤å™¨æœºåˆ¶æ·±å…¥](#5-è¿‡æ»¤å™¨æœºåˆ¶æ·±å…¥)
6. [é™æµæ§åˆ¶å®ç°](#6-é™æµæ§åˆ¶å®ç°)
7. [é‰´æƒè®¤è¯æ–¹æ¡ˆ](#7-é‰´æƒè®¤è¯æ–¹æ¡ˆ)
8. [è·¨åŸŸå¤„ç†é…ç½®](#8-è·¨åŸŸå¤„ç†é…ç½®)
9. [ç½‘å…³ç›‘æ§è¿ç»´](#9-ç½‘å…³ç›‘æ§è¿ç»´)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ APIç½‘å…³åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯APIç½‘å…³


> ğŸ’¡ **é€šä¿—ç†è§£**  
> APIç½‘å…³å°±åƒä¸€æ ‹å¤§æ¥¼çš„å‰å°æ¥å¾…ï¼Œæ‰€æœ‰æƒ³è¿›å…¥å¤§æ¥¼çš„äººéƒ½å¿…é¡»å…ˆåœ¨å‰å°ç™»è®°ï¼Œå‰å°ä¼šå‘Šè¯‰ä½ è¦å»å“ªä¸ªæ¥¼å±‚æ‰¾å“ªä¸ªéƒ¨é—¨ï¼Œè¿™æ ·å°±ä¸ä¼šä¹±è·‘äº†ã€‚

**ğŸ”¸ APIç½‘å…³çš„æœ¬è´¨**
```
ä¼ ç»Ÿæ–¹å¼ï¼šå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨å„ä¸ªæœåŠ¡
å®¢æˆ·ç«¯ â†’ ç”¨æˆ·æœåŠ¡
å®¢æˆ·ç«¯ â†’ è®¢å•æœåŠ¡  
å®¢æˆ·ç«¯ â†’ å•†å“æœåŠ¡

ç½‘å…³æ–¹å¼ï¼šå®¢æˆ·ç«¯ç»Ÿä¸€é€šè¿‡ç½‘å…³è®¿é—®
å®¢æˆ·ç«¯ â†’ APIç½‘å…³ â†’ ç”¨æˆ·æœåŠ¡
           â†“
         è®¢å•æœåŠ¡
           â†“  
         å•†å“æœåŠ¡
```

**ğŸ“‹ ç½‘å…³çš„æ ¸å¿ƒä½œç”¨**
- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰å¤–éƒ¨è¯·æ±‚éƒ½é€šè¿‡ç½‘å…³è¿›å…¥ç³»ç»Ÿ
- **è·¯ç”±è½¬å‘**ï¼šæ ¹æ®è¯·æ±‚è·¯å¾„å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„å¾®æœåŠ¡
- **è´Ÿè½½å‡è¡¡**ï¼šåœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¹‹é—´åˆ†é…è¯·æ±‚
- **å®‰å…¨æ§åˆ¶**ï¼šç»Ÿä¸€å¤„ç†è®¤è¯ã€æˆæƒã€é™æµç­‰å®‰å…¨éœ€æ±‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦APIç½‘å…³


**ğŸ¤” æ²¡æœ‰ç½‘å…³ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

```
é—®é¢˜åœºæ™¯åˆ†æï¼š

1. å®¢æˆ·ç«¯å¤æ‚æ€§ï¼š
   - æ‰‹æœºAppéœ€è¦çŸ¥é“10ä¸ªä¸åŒæœåŠ¡çš„åœ°å€
   - æ¯ä¸ªæœåŠ¡åœ°å€å˜æ›´éƒ½éœ€è¦æ›´æ–°App
   - ä¸åŒæœåŠ¡å¯èƒ½ä½¿ç”¨ä¸åŒçš„åè®®

2. å®‰å…¨æ§åˆ¶åˆ†æ•£ï¼š
   - æ¯ä¸ªæœåŠ¡éƒ½è¦åšç”¨æˆ·è®¤è¯
   - é‡å¤çš„å®‰å…¨ä»£ç åˆ°å¤„éƒ½æ˜¯
   - å®‰å…¨ç­–ç•¥éš¾ä»¥ç»Ÿä¸€ç®¡ç†

3. è·¨åŸŸé—®é¢˜ï¼š
   - å‰ç«¯é¡µé¢æ— æ³•ç›´æ¥è°ƒç”¨ä¸åŒåŸŸåçš„æœåŠ¡
   - æ¯ä¸ªæœåŠ¡éƒ½è¦å¤„ç†è·¨åŸŸé…ç½®
```

**âœ… ä½¿ç”¨ç½‘å…³çš„å¥½å¤„**
- **ç®€åŒ–å®¢æˆ·ç«¯**ï¼šå®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“ä¸€ä¸ªç½‘å…³åœ°å€
- **ç»Ÿä¸€ç®¡ç†**ï¼šè®¤è¯ã€é™æµã€ç›‘æ§ç­‰åŠŸèƒ½é›†ä¸­å¤„ç†
- **æ˜“äºç»´æŠ¤**ï¼šæœåŠ¡åœ°å€å˜æ›´å¯¹å®¢æˆ·ç«¯é€æ˜
- **æå‡å®‰å…¨**ï¼šå†…éƒ¨æœåŠ¡ä¸ç›´æ¥æš´éœ²ç»™å¤–ç½‘

### 1.3 ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½


**ğŸ¯ å¿…å¤‡åŠŸèƒ½åˆ—è¡¨**
| åŠŸèƒ½ç±»åˆ« | å…·ä½“åŠŸèƒ½ | ä½œç”¨è¯´æ˜ |
|---------|---------|---------|
| **è·¯ç”±ç®¡ç†** | `åŠ¨æ€è·¯ç”±` | `æ ¹æ®è§„åˆ™å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”æœåŠ¡` |
| **è´Ÿè½½å‡è¡¡** | `å¤šå®ä¾‹åˆ†å‘` | `åœ¨æœåŠ¡çš„å¤šä¸ªå®ä¾‹é—´åˆ†é…è¯·æ±‚` |
| **å®‰å…¨æ§åˆ¶** | `è®¤è¯æˆæƒ` | `ç»Ÿä¸€éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™` |
| **æµé‡æ§åˆ¶** | `é™æµç†”æ–­` | `ä¿æŠ¤åç«¯æœåŠ¡ä¸è¢«è¿‡è½½` |
| **ç›‘æ§æ—¥å¿—** | `è¯·æ±‚è¿½è¸ª` | `è®°å½•å’Œåˆ†ææ‰€æœ‰é€šè¿‡ç½‘å…³çš„è¯·æ±‚` |

---

## 2. ğŸšª Spring Cloud Gatewayè¯¦è§£


### 2.1 Gatewayç®€ä»‹


> ğŸ¯ **å­¦ä¹ ç›®æ ‡**  
> ç†è§£Spring Cloud Gatewayçš„å·¥ä½œåŸç†ï¼ŒæŒæ¡åŸºæœ¬é…ç½®æ–¹æ³•

**ğŸ”¸ ä»€ä¹ˆæ˜¯Spring Cloud Gateway**
Spring Cloud Gatewayæ˜¯Springå®˜æ–¹æ¨å‡ºçš„æ–°ä¸€ä»£APIç½‘å…³ï¼ŒåŸºäºSpring 5ã€Spring Boot 2å’ŒProject Reactoræ„å»ºã€‚

**ğŸ“Š Gatewayçš„ä¼˜åŠ¿**
```
æŠ€æœ¯ä¼˜åŠ¿ï¼š
âœ… å¼‚æ­¥éé˜»å¡ï¼šåŸºäºNettyå’ŒWebFluxï¼Œæ€§èƒ½æ›´å¥½
âœ… å“åº”å¼ç¼–ç¨‹ï¼šæ”¯æŒå“åº”å¼ç¼–ç¨‹æ¨¡å‹
âœ… å®˜æ–¹æ”¯æŒï¼šSpringå®˜æ–¹ç»´æŠ¤ï¼Œæ›´æ–°åŠæ—¶
âœ… åŠŸèƒ½ä¸°å¯Œï¼šå†…ç½®å¤šç§è¿‡æ»¤å™¨å’Œæ–­è¨€å·¥å‚

ä¸Zuulå¯¹æ¯”ï¼š
Gatewayï¼šå¼‚æ­¥éé˜»å¡ï¼ŒåŸºäºNetty
Zuul 1.xï¼šåŒæ­¥é˜»å¡ï¼ŒåŸºäºServlet
```

### 2.2 Gatewayæ ¸å¿ƒæ¦‚å¿µ


**ğŸ” ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ**

```
1. Routeï¼ˆè·¯ç”±ï¼‰
   - ç½‘å…³çš„åŸºæœ¬æ„å»ºå—
   - åŒ…å«ï¼šIDã€ç›®æ ‡URIã€æ–­è¨€é›†åˆã€è¿‡æ»¤å™¨é›†åˆ

2. Predicateï¼ˆæ–­è¨€ï¼‰  
   - åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆæŸä¸ªè·¯ç”±çš„æ¡ä»¶
   - ä¾‹å¦‚ï¼šè·¯å¾„åŒ¹é…ã€æ—¶é—´åŒ¹é…ã€è¯·æ±‚å¤´åŒ¹é…

3. Filterï¼ˆè¿‡æ»¤å™¨ï¼‰
   - åœ¨è¯·æ±‚è¢«è·¯ç”±å‰åè¿›è¡Œä¿®æ”¹
   - ä¾‹å¦‚ï¼šæ·»åŠ è¯·æ±‚å¤´ã€é™æµã€è®¤è¯
```

**ğŸ”„ Gatewayå·¥ä½œæµç¨‹**
```
è¯·æ±‚å¤„ç†æµç¨‹ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ 
    â†“
Gateway Handler Mappingï¼ˆè·¯ç”±æ˜ å°„ï¼‰
    â†“  
Gateway Web Handlerï¼ˆWebå¤„ç†å™¨ï¼‰
    â†“
PreFilterï¼ˆå‰ç½®è¿‡æ»¤å™¨ï¼‰
    â†“
å¾®æœåŠ¡å¤„ç†
    â†“  
PostFilterï¼ˆåç½®è¿‡æ»¤å™¨ï¼‰
    â†“
è¿”å›å“åº”
```

### 2.3 Gatewayå¿«é€Ÿå¼€å§‹


**ğŸ“¦ ä¾èµ–å¼•å…¥**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>
```

**âš™ï¸ åŸºç¡€é…ç½®ç¤ºä¾‹**
```yaml
server:
  port: 9000

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      routes:
        # ç”¨æˆ·æœåŠ¡è·¯ç”±
        - id: user-service
          uri: http://localhost:8001
          predicates:
            - Path=/user/**
          filters:
            - StripPrefix=1
            
        # è®¢å•æœåŠ¡è·¯ç”±  
        - id: order-service
          uri: http://localhost:8002
          predicates:
            - Path=/order/**
          filters:
            - StripPrefix=1
```

> ğŸ’­ **é…ç½®è§£é‡Š**  
> - `id`: è·¯ç”±çš„å”¯ä¸€æ ‡è¯†ç¬¦
> - `uri`: ç›®æ ‡æœåŠ¡åœ°å€
> - `predicates`: è·¯ç”±åŒ¹é…æ¡ä»¶
> - `filters`: è¯·æ±‚å¤„ç†è¿‡æ»¤å™¨

---

## 3. ğŸŒ‰ Zuulç½‘å…³ä»‹ç»


### 3.1 Zuulæ¦‚è¿°


> âš ï¸ **é‡è¦æé†’**  
> Zuul 1.xå·²ç»åœæ­¢ç»´æŠ¤ï¼Œç°åœ¨ä¸»è¦äº†è§£æ¦‚å¿µå³å¯ï¼Œå®é™…é¡¹ç›®å»ºè®®ä½¿ç”¨Gateway

**ğŸ”¸ Zuulçš„å†å²åœ°ä½**
- Netflixå¼€æºçš„APIç½‘å…³è§£å†³æ–¹æ¡ˆ
- Spring Cloudæ—©æœŸçš„é»˜è®¤ç½‘å…³ç»„ä»¶
- åŸºäºServletçš„åŒæ­¥é˜»å¡æ¨¡å‹

**ğŸ“ˆ Zuulç‰ˆæœ¬å¯¹æ¯”**
| ç‰ˆæœ¬ | æ¶æ„æ¨¡å‹ | æ€§èƒ½ç‰¹ç‚¹ | å½“å‰çŠ¶æ€ |
|------|---------|----------|----------|
| `Zuul 1.x` | `åŒæ­¥é˜»å¡` | `æ€§èƒ½ä¸€èˆ¬` | `å·²åœæ­¢ç»´æŠ¤` |
| `Zuul 2.x` | `å¼‚æ­¥éé˜»å¡` | `æ€§èƒ½æå‡` | `Spring Cloudæœªé›†æˆ` |
| `Gateway` | `å¼‚æ­¥éé˜»å¡` | `æ€§èƒ½ä¼˜ç§€` | `å®˜æ–¹æ¨è` |

### 3.2 ä¸ºä»€ä¹ˆä»Zuulè¿ç§»åˆ°Gateway


**ğŸ”„ æŠ€æœ¯æ¼”è¿›åŸå› **
```
Zuul 1.xçš„é™åˆ¶ï¼š
âŒ åŒæ­¥é˜»å¡ï¼šæ¯ä¸ªè¯·æ±‚å ç”¨ä¸€ä¸ªçº¿ç¨‹
âŒ æ€§èƒ½ç“¶é¢ˆï¼šé«˜å¹¶å‘æ—¶çº¿ç¨‹èµ„æºæ¶ˆè€—å¤§
âŒ ç»´æŠ¤åœæ»ï¼šNetflixä¸å†ç»´æŠ¤1.xç‰ˆæœ¬

Gatewayçš„ä¼˜åŠ¿ï¼š
âœ… å¼‚æ­¥éé˜»å¡ï¼šåŸºäºäº‹ä»¶é©±åŠ¨
âœ… æ›´å¥½æ€§èƒ½ï¼šç›¸åŒç¡¬ä»¶å¤„ç†æ›´å¤šè¯·æ±‚
âœ… å®˜æ–¹æ”¯æŒï¼šSpringå›¢é˜ŸæŒç»­ç»´æŠ¤
```

---

## 4. ğŸ›¤ï¸ è·¯ç”±é…ç½®ä¸æ–­è¨€å·¥å‚


### 4.1 è·¯ç”±é…ç½®è¯¦è§£


**ğŸ”§ è·¯ç”±é…ç½®çš„ä¸‰ç§æ–¹å¼**

**æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶æ–¹å¼**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-route
          uri: http://localhost:8001
          predicates:
            - Path=/api/user/**
            - Method=GET,POST
          filters:
            - AddRequestHeader=X-Gateway, true
```

**æ–¹å¼2ï¼šJavaä»£ç æ–¹å¼**
```java
@Configuration
public class GatewayConfig {
    
    @Bean
    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) {
        return builder.routes()
            .route("user-route", r -> r
                .path("/api/user/**")
                .and()
                .method(HttpMethod.GET, HttpMethod.POST)
                .uri("http://localhost:8001")
                .filters(f -> f.addRequestHeader("X-Gateway", "true"))
            )
            .build();
    }
}
```

**æ–¹å¼3ï¼šåŠ¨æ€è·¯ç”±ï¼ˆç»“åˆæ³¨å†Œä¸­å¿ƒï¼‰**
```yaml
spring:
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true  # å¯ç”¨æœåŠ¡å‘ç°
          lower-case-service-id: true
      routes:
        - id: user-service
          uri: lb://user-service  # lbè¡¨ç¤ºè´Ÿè½½å‡è¡¡
          predicates:
            - Path=/user/**
```

### 4.2 æ–­è¨€å·¥å‚è¯¦è§£


> ğŸ” **æ–­è¨€çš„ä½œç”¨**  
> æ–­è¨€å°±åƒé—¨å«ï¼Œå†³å®šå“ªäº›è¯·æ±‚å¯ä»¥é€šè¿‡è¿™ä¸ªè·¯ç”±ï¼Œå“ªäº›ä¸å¯ä»¥

**ğŸ“‹ å¸¸ç”¨æ–­è¨€å·¥å‚**

**ğŸ• æ—¶é—´ç›¸å…³æ–­è¨€**
```yaml
predicates:
  # æŒ‡å®šæ—¶é—´ä¹‹åçš„è¯·æ±‚
  - After=2023-12-01T00:00:00.000+08:00[Asia/Shanghai]
  
  # æŒ‡å®šæ—¶é—´ä¹‹å‰çš„è¯·æ±‚  
  - Before=2024-12-31T23:59:59.000+08:00[Asia/Shanghai]
  
  # æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„è¯·æ±‚
  - Between=2023-01-01T00:00:00.000+08:00[Asia/Shanghai],2023-12-31T23:59:59.000+08:00[Asia/Shanghai]
```

**ğŸ›£ï¸ è·¯å¾„ç›¸å…³æ–­è¨€**
```yaml
predicates:
  # è·¯å¾„åŒ¹é…ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
  - Path=/api/user/**,/api/order/**
  
  # æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
  - Path=/api/user/{id:\d+}  # åªåŒ¹é…æ•°å­—ID
```

**ğŸ·ï¸ è¯·æ±‚å±æ€§æ–­è¨€**
```yaml
predicates:
  # HTTPæ–¹æ³•åŒ¹é…
  - Method=GET,POST
  
  # è¯·æ±‚å¤´åŒ¹é…
  - Header=X-Request-Id,\d+  # è¯·æ±‚å¤´åŒ…å«æ•°å­—ID
  
  # æŸ¥è¯¢å‚æ•°åŒ¹é…
  - Query=name,zhang.*  # nameå‚æ•°ä»¥zhangå¼€å¤´
  
  # CookieåŒ¹é…
  - Cookie=sessionId,abc123
```

**ğŸ’» å®¢æˆ·ç«¯ç›¸å…³æ–­è¨€**
```yaml
predicates:
  # è¿œç¨‹åœ°å€åŒ¹é…
  - RemoteAddr=192.168.1.1/24
  
  # HoståŒ¹é…
  - Host=**.example.com,**.test.com
```

### 4.3 æ–­è¨€ç»„åˆä½¿ç”¨


**ğŸ”— å¤šä¸ªæ–­è¨€çš„é€»è¾‘å…³ç³»**
```yaml
# æ‰€æœ‰æ–­è¨€éƒ½å¿…é¡»æ»¡è¶³ï¼ˆANDå…³ç³»ï¼‰
routes:
  - id: complex-route
    uri: http://localhost:8001
    predicates:
      - Path=/api/**          # å¿…é¡»æ»¡è¶³è·¯å¾„æ¡ä»¶
      - Method=GET,POST       # å¿…é¡»æ»¡è¶³æ–¹æ³•æ¡ä»¶
      - Header=Authorization  # å¿…é¡»åŒ…å«è®¤è¯å¤´
```

**ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹**
```yaml
spring:
  cloud:
    gateway:
      routes:
        # VIPç”¨æˆ·è·¯ç”±
        - id: vip-user-route
          uri: http://localhost:8001
          predicates:
            - Path=/api/vip/**
            - Header=User-Type,VIP
            - Method=GET,POST
          filters:
            - AddRequestHeader=X-User-Level,VIP
            
        # æ™®é€šç”¨æˆ·è·¯ç”±
        - id: normal-user-route
          uri: http://localhost:8001
          predicates:
            - Path=/api/user/**
            - Method=GET,POST
          filters:
            - AddRequestHeader=X-User-Level,NORMAL
```

---

## 5. ğŸ”§ è¿‡æ»¤å™¨æœºåˆ¶æ·±å…¥


### 5.1 è¿‡æ»¤å™¨åˆ†ç±»


> ğŸ’¡ **ç†è§£è¿‡æ»¤å™¨**  
> è¿‡æ»¤å™¨å°±åƒæµæ°´çº¿ä¸Šçš„å·¥äººï¼Œæ¯ä¸ªå·¥äººè´Ÿè´£å¯¹äº§å“ï¼ˆè¯·æ±‚ï¼‰è¿›è¡Œç‰¹å®šçš„åŠ å·¥å¤„ç†

**ğŸ¨ è¿‡æ»¤å™¨çš„ä¸¤ç§ç±»å‹**

```
æŒ‰æ‰§è¡Œæ—¶æœºåˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pre Filter â”‚â”€â”€â”€â–¶â”‚   Service   â”‚â”€â”€â”€â–¶â”‚ Post Filter â”‚
â”‚  (å‰ç½®è¿‡æ»¤å™¨) â”‚    â”‚   (æœåŠ¡)     â”‚    â”‚  (åç½®è¿‡æ»¤å™¨) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                        â”‚
     â–¼                                        â–¼
   è¯·æ±‚é¢„å¤„ç†                               å“åº”åå¤„ç†
  (è®¤è¯ã€é™æµç­‰)                          (æ—¥å¿—ã€ç»Ÿè®¡ç­‰)
```

**ğŸ“Š è¿‡æ»¤å™¨åˆ†ç±»è¡¨**
| åˆ†ç±»æ–¹å¼ | ç±»å‹ | æ‰§è¡Œæ—¶æœº | å¸¸è§ç”¨é€” |
|---------|------|----------|----------|
| **æ‰§è¡Œæ—¶æœº** | `Pre Filter` | `è¯·æ±‚è½¬å‘å‰` | `è®¤è¯ã€é™æµã€å‚æ•°æ ¡éªŒ` |
| **æ‰§è¡Œæ—¶æœº** | `Post Filter` | `å“åº”è¿”å›å‰` | `æ—¥å¿—è®°å½•ã€å“åº”ä¿®æ”¹` |
| **ä½œç”¨èŒƒå›´** | `Global Filter` | `æ‰€æœ‰è·¯ç”±` | `å…¨å±€è®¤è¯ã€æ—¥å¿—` |
| **ä½œç”¨èŒƒå›´** | `Gateway Filter` | `ç‰¹å®šè·¯ç”±` | `ç‰¹å®šä¸šåŠ¡å¤„ç†` |

### 5.2 å†…ç½®è¿‡æ»¤å™¨ä½¿ç”¨


**ğŸ”§ å¸¸ç”¨å†…ç½®è¿‡æ»¤å™¨**

**ğŸ·ï¸ è¯·æ±‚å¤´æ“ä½œè¿‡æ»¤å™¨**
```yaml
filters:
  # æ·»åŠ è¯·æ±‚å¤´
  - AddRequestHeader=X-Request-Source,Gateway
  - AddRequestHeader=X-User-IP,{ip}  # åŠ¨æ€è·å–IP
  
  # ç§»é™¤è¯·æ±‚å¤´  
  - RemoveRequestHeader=X-Internal-Token
  
  # è®¾ç½®è¯·æ±‚å¤´ï¼ˆå¦‚æœå­˜åœ¨åˆ™è¦†ç›–ï¼‰
  - SetRequestHeader=Authorization,Bearer {token}
```

**ğŸ”— è·¯å¾„æ“ä½œè¿‡æ»¤å™¨**
```yaml
filters:
  # å»é™¤è·¯å¾„å‰ç¼€
  - StripPrefix=1  # /api/user/info â†’ /user/info
  
  # æ·»åŠ è·¯å¾„å‰ç¼€
  - PrefixPath=/v1  # /user/info â†’ /v1/user/info
  
  # è·¯å¾„é‡å†™
  - RewritePath=/api/(?<segment>.*),/${segment}
```

**ğŸ“ å‚æ•°æ“ä½œè¿‡æ»¤å™¨**
```yaml
filters:
  # æ·»åŠ è¯·æ±‚å‚æ•°
  - AddRequestParameter=version,v1
  
  # ç§»é™¤è¯·æ±‚å‚æ•°
  - RemoveRequestParameter=debug
```

**ğŸ”„ é‡å®šå‘è¿‡æ»¤å™¨**
```yaml
filters:
  # ä¸´æ—¶é‡å®šå‘(302)
  - RedirectTo=302,http://www.example.com
  
  # æ°¸ä¹…é‡å®šå‘(301)  
  - RedirectTo=301,https://secure.example.com
```

### 5.3 è‡ªå®šä¹‰è¿‡æ»¤å™¨


**ğŸ“ è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨**
```java
@Component
@Slf4j
public class CustomGlobalFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // è·å–è¯·æ±‚ä¿¡æ¯
        ServerHttpRequest request = exchange.getRequest();
        String path = request.getPath().value();
        String method = request.getMethod().toString();
        
        log.info("è¯·æ±‚è·¯å¾„: {}, è¯·æ±‚æ–¹æ³•: {}", path, method);
        
        // åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ æ—¶é—´æˆ³
        ServerHttpRequest mutatedRequest = request.mutate()
            .header("X-Request-Time", String.valueOf(System.currentTimeMillis()))
            .build();
            
        ServerWebExchange mutatedExchange = exchange.mutate()
            .request(mutatedRequest)
            .build();
        
        // ç»§ç»­æ‰§è¡Œè¿‡æ»¤å™¨é“¾
        return chain.filter(mutatedExchange);
    }
    
    @Override
    public int getOrder() {
        return -100;  // å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    }
}
```

**ğŸ¯ è‡ªå®šä¹‰ç½‘å…³è¿‡æ»¤å™¨å·¥å‚**
```java
@Component
public class CustomGatewayFilterFactory extends AbstractGatewayFilterFactory<CustomGatewayFilterFactory.Config> {
    
    public CustomGatewayFilterFactory() {
        super(Config.class);
    }
    
    @Override
    public GatewayFilter apply(Config config) {
        return (exchange, chain) -> {
            ServerHttpRequest request = exchange.getRequest();
            
            // æ£€æŸ¥ç”¨æˆ·ç­‰çº§
            String userLevel = request.getHeaders().getFirst("User-Level");
            if (config.isRequireVip() && !"VIP".equals(userLevel)) {
                ServerHttpResponse response = exchange.getResponse();
                response.setStatusCode(HttpStatus.FORBIDDEN);
                return response.setComplete();
            }
            
            return chain.filter(exchange);
        };
    }
    
    @Data
    public static class Config {
        private boolean requireVip;
    }
}
```

**âš™ï¸ åœ¨é…ç½®ä¸­ä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨**
```yaml
routes:
  - id: vip-service
    uri: http://localhost:8001
    predicates:
      - Path=/vip/**
    filters:
      - name: Custom
        args:
          require-vip: true
```

---

## 6. ğŸš¦ é™æµæ§åˆ¶å®ç°


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦é™æµ


> ğŸ›¡ï¸ **é™æµçš„é‡è¦æ€§**  
> é™æµå°±åƒæ™¯åŒºçš„é™æµæªæ–½ï¼Œé˜²æ­¢è¿‡å¤šæ¸¸å®¢æ¶Œå…¥é€ æˆæ‹¥æŒ¤ï¼Œä¿æŠ¤æ™¯åŒºè®¾æ–½å’Œæ¸¸å®¢å®‰å…¨

**ğŸ”¥ å¸¸è§çš„æµé‡é—®é¢˜**
```
æµé‡æ´ªå³°åœºæ™¯ï¼š
ğŸ“± ç”µå•†ç§’æ€ï¼šç¬é—´å¤§é‡ç”¨æˆ·æŠ¢è´­
ğŸ« æŠ¢ç¥¨ç³»ç»Ÿï¼šèŠ‚å‡æ—¥ç«è½¦ç¥¨å¼€å”®  
ğŸ“º çƒ­ç‚¹äº‹ä»¶ï¼šçªå‘æ–°é—»å¼•å‘è®¿é—®æ¿€å¢
ğŸ® æ¸¸æˆå¼€æœï¼šæ–°æ¸¸æˆä¸Šçº¿ç”¨æˆ·æ¶Œå…¥

ä¸é™æµçš„åæœï¼š
âŒ æœåŠ¡å´©æºƒï¼šåç«¯æœåŠ¡æ‰¿å—ä¸äº†å‹åŠ›å®•æœº
âŒ é›ªå´©æ•ˆåº”ï¼šä¸€ä¸ªæœåŠ¡å´©æºƒå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨  
âŒ èµ„æºè€—å°½ï¼šæ•°æ®åº“è¿æ¥æ± ã€å†…å­˜ç­‰èµ„æºè€—å°½
âŒ ç”¨æˆ·ä½“éªŒå·®ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨
```

### 6.2 Gatewayé™æµå®ç°


**ğŸ“¦ Redisé™æµä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis-reactive</artifactId>
</dependency>
```

**âš™ï¸ é™æµé…ç½®**
```yaml
spring:
  redis:
    host: localhost
    port: 6379
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: http://localhost:8001
          predicates:
            - Path=/api/user/**
          filters:
            # Redisä»¤ç‰Œæ¡¶é™æµ
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 2    # æ¯ç§’äº§ç”Ÿä»¤ç‰Œæ•°
                redis-rate-limiter.burstCapacity: 5    # ä»¤ç‰Œæ¡¶å®¹é‡
                redis-rate-limiter.requestedTokens: 1  # æ¯æ¬¡è¯·æ±‚æ¶ˆè€—ä»¤ç‰Œæ•°
                key-resolver: "#{@ipKeyResolver}"      # é™æµé”®è§£æå™¨
```

**ğŸ”‘ é™æµé”®è§£æå™¨**
```java
@Component
public class IpKeyResolver implements KeyResolver {
    
    @Override
    public Mono<String> resolve(ServerWebExchange exchange) {
        // æ ¹æ®IPé™æµ
        String ip = exchange.getRequest().getRemoteAddress()
                .getAddress().getHostAddress();
        return Mono.just(ip);
    }
}

@Component
public class UserKeyResolver implements KeyResolver {
    
    @Override  
    public Mono<String> resolve(ServerWebExchange exchange) {
        // æ ¹æ®ç”¨æˆ·IDé™æµ
        String userId = exchange.getRequest().getHeaders()
                .getFirst("User-Id");
        return Mono.just(userId != null ? userId : "anonymous");
    }
}
```

### 6.3 é™æµç®—æ³•è¯¦è§£


**ğŸª£ ä»¤ç‰Œæ¡¶ç®—æ³•**
```
ä»¤ç‰Œæ¡¶å·¥ä½œåŸç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ä»¤ç‰Œæ¡¶    â”‚  â† å›ºå®šé€Ÿç‡äº§ç”Ÿä»¤ç‰Œ
â”‚  â—‹ â—‹ â—‹ â—‹   â”‚    (replenishRate)
â”‚  â—‹ â—‹ â—‹     â”‚  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
   è¯·æ±‚è·å–ä»¤ç‰Œ
   æœ‰ä»¤ç‰Œâ†’å¤„ç†è¯·æ±‚
   æ— ä»¤ç‰Œâ†’æ‹’ç»è¯·æ±‚

å‚æ•°è¯´æ˜ï¼š
â€¢ replenishRate: æ¯ç§’äº§ç”Ÿçš„ä»¤ç‰Œæ•°ï¼ˆæ§åˆ¶å¹³å‡æµé‡ï¼‰
â€¢ burstCapacity: æ¡¶çš„å®¹é‡ï¼ˆæ§åˆ¶çªå‘æµé‡ï¼‰  
â€¢ requestedTokens: æ¯æ¬¡è¯·æ±‚æ¶ˆè€—çš„ä»¤ç‰Œæ•°
```

**ğŸ“Š é™æµå‚æ•°é…ç½®ç¤ºä¾‹**
| åœºæ™¯ç±»å‹ | replenishRate | burstCapacity | è¯´æ˜ |
|---------|---------------|---------------|------|
| `æ™®é€šæ¥å£` | `10` | `20` | `å¹³å‡æ¯ç§’10ä¸ªè¯·æ±‚ï¼Œçªå‘20ä¸ª` |
| `ç§’æ€æ¥å£` | `100` | `200` | `é«˜å¹¶å‘åœºæ™¯é…ç½®` |
| `ç™»å½•æ¥å£` | `5` | `10` | `å®‰å…¨æ•æ„Ÿæ¥å£é™åˆ¶æ›´ä¸¥` |

### 6.4 è‡ªå®šä¹‰é™æµç­–ç•¥


**ğŸ¯ å¤šç»´åº¦é™æµ**
```java
@Component
@Slf4j
public class CustomRateLimitFilter implements GlobalFilter, Ordered {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        String ip = getClientIp(request);
        String uri = request.getURI().getPath();
        
        // ä¸åŒæ¥å£ä¸åŒé™æµç­–ç•¥
        RateLimitConfig config = getRateLimitConfig(uri);
        
        if (!isAllowed(ip, uri, config)) {
            return handleRateLimitExceeded(exchange);
        }
        
        return chain.filter(exchange);
    }
    
    private boolean isAllowed(String ip, String uri, RateLimitConfig config) {
        String key = "rate_limit:" + ip + ":" + uri;
        
        // æ»‘åŠ¨çª—å£é™æµ
        long currentTime = System.currentTimeMillis();
        long windowStart = currentTime - config.getWindowSize();
        
        // æ¸…é™¤è¿‡æœŸçš„è¯·æ±‚è®°å½•
        redisTemplate.opsForZSet().removeRangeByScore(key, 0, windowStart);
        
        // è·å–å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°é‡
        Long requestCount = redisTemplate.opsForZSet().count(key, windowStart, currentTime);
        
        if (requestCount >= config.getMaxRequests()) {
            return false;  // è¶…è¿‡é™æµé˜ˆå€¼
        }
        
        // è®°å½•å½“å‰è¯·æ±‚
        redisTemplate.opsForZSet().add(key, String.valueOf(currentTime), currentTime);
        redisTemplate.expire(key, Duration.ofMillis(config.getWindowSize()));
        
        return true;
    }
}
```

---

## 7. ğŸ” é‰´æƒè®¤è¯æ–¹æ¡ˆ


### 7.1 è®¤è¯ä¸æˆæƒåŸºç¡€


> ğŸ”‘ **è®¤è¯ vs æˆæƒ**  
> è®¤è¯(Authentication)ï¼šä½ æ˜¯è°ï¼ŸéªŒè¯ç”¨æˆ·èº«ä»½  
> æˆæƒ(Authorization)ï¼šä½ èƒ½åšä»€ä¹ˆï¼ŸéªŒè¯ç”¨æˆ·æƒé™

**ğŸ¯ å¸¸è§è®¤è¯æ–¹å¼**
```
è®¤è¯æ–¹å¼å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¼šè¯è®¤è¯   â”‚   Tokenè®¤è¯  â”‚   JWTè®¤è¯   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡å™¨å­˜å‚¨   â”‚  æœåŠ¡å™¨å­˜å‚¨  â”‚  æ— çŠ¶æ€è®¤è¯  â”‚
â”‚ Session/Cookieâ”‚  Tokenå­˜å‚¨   â”‚  è‡ªåŒ…å«ä¿¡æ¯  â”‚
â”‚ é›†ç¾¤åŒæ­¥å¤æ‚ â”‚  éœ€è¦å­˜å‚¨    â”‚  æ— éœ€å­˜å‚¨    â”‚
â”‚ ä¼ ç»ŸWebåº”ç”¨  â”‚  ç§»åŠ¨ç«¯å‹å¥½  â”‚  å¾®æœåŠ¡å‹å¥½  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 JWTè®¤è¯å®ç°


**ğŸ“¦ JWTç›¸å…³ä¾èµ–**
```xml
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.9.1</version>
</dependency>
```

**ğŸ”§ JWTå·¥å…·ç±»**
```java
@Component
@Slf4j
public class JwtUtil {
    
    private String secret = "mySecretKey";
    private int expiration = 3600; // 1å°æ—¶
    
    // ç”ŸæˆJWT Token
    public String generateToken(String username, List<String> roles) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("roles", roles);
        return createToken(claims, username);
    }
    
    private String createToken(Map<String, Object> claims, String subject) {
        return Jwts.builder()
            .setClaims(claims)
            .setSubject(subject)
            .setIssuedAt(new Date(System.currentTimeMillis()))
            .setExpiration(new Date(System.currentTimeMillis() + expiration * 1000))
            .signWith(SignatureAlgorithm.HS512, secret)
            .compact();
    }
    
    // éªŒè¯Token
    public boolean validateToken(String token, String username) {
        try {
            final String tokenUsername = getUsernameFromToken(token);
            return (tokenUsername.equals(username) && !isTokenExpired(token));
        } catch (Exception e) {
            log.error("TokenéªŒè¯å¤±è´¥: {}", e.getMessage());
            return false;
        }
    }
    
    public String getUsernameFromToken(String token) {
        return getClaimFromToken(token, Claims::getSubject);
    }
    
    @SuppressWarnings("unchecked")
    public List<String> getRolesFromToken(String token) {
        return getClaimFromToken(token, claims -> (List<String>) claims.get("roles"));
    }
}
```

**ğŸ›¡ï¸ ç½‘å…³è®¤è¯è¿‡æ»¤å™¨**
```java
@Component
@Slf4j  
public class AuthenticationFilter implements GlobalFilter, Ordered {
    
    @Autowired
    private JwtUtil jwtUtil;
    
    // ä¸éœ€è¦è®¤è¯çš„è·¯å¾„
    private static final List<String> SKIP_AUTH_PATHS = Arrays.asList(
        "/api/auth/login",
        "/api/auth/register", 
        "/api/public"
    );
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        String path = request.getURI().getPath();
        
        // è·³è¿‡ä¸éœ€è¦è®¤è¯çš„è·¯å¾„
        if (isSkipAuth(path)) {
            return chain.filter(exchange);
        }
        
        // è·å–Token
        String token = getTokenFromRequest(request);
        if (token == null) {
            return handleAuthError(exchange, "ç¼ºå°‘è®¤è¯Token");
        }
        
        // éªŒè¯Token
        try {
            String username = jwtUtil.getUsernameFromToken(token);
            if (!jwtUtil.validateToken(token, username)) {
                return handleAuthError(exchange, "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ");
            }
            
            // åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ç”¨æˆ·ä¿¡æ¯
            List<String> roles = jwtUtil.getRolesFromToken(token);
            ServerHttpRequest mutatedRequest = request.mutate()
                .header("X-User-Name", username)
                .header("X-User-Roles", String.join(",", roles))
                .build();
                
            return chain.filter(exchange.mutate().request(mutatedRequest).build());
            
        } catch (Exception e) {
            log.error("Tokenè§£æå¤±è´¥: {}", e.getMessage());
            return handleAuthError(exchange, "Tokenè§£æå¤±è´¥");
        }
    }
    
    private boolean isSkipAuth(String path) {
        return SKIP_AUTH_PATHS.stream()
            .anyMatch(skipPath -> path.startsWith(skipPath));
    }
    
    private String getTokenFromRequest(ServerHttpRequest request) {
        String bearerToken = request.getHeaders().getFirst("Authorization");
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
    
    private Mono<Void> handleAuthError(ServerWebExchange exchange, String message) {
        ServerHttpResponse response = exchange.getResponse();
        response.setStatusCode(HttpStatus.UNAUTHORIZED);
        response.getHeaders().add("Content-Type", "application/json;charset=UTF-8");
        
        String body = "{\"code\":401,\"message\":\"" + message + "\"}";
        DataBuffer buffer = response.bufferFactory().wrap(body.getBytes(StandardCharsets.UTF_8));
        return response.writeWith(Mono.just(buffer));
    }
    
    @Override
    public int getOrder() {
        return -200; // é«˜ä¼˜å…ˆçº§ï¼Œåœ¨å…¶ä»–è¿‡æ»¤å™¨ä¹‹å‰æ‰§è¡Œ
    }
}
```

### 7.3 æƒé™æ§åˆ¶å®ç°


**ğŸ¯ åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶**
```java
@Component
@Slf4j
public class AuthorizationFilter implements GlobalFilter, Ordered {
    
    // æƒé™é…ç½®ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥ä»æ•°æ®åº“è·å–ï¼‰
    private static final Map<String, List<String>> PATH_ROLES = new HashMap<String, List<String>>() {{
        put("/api/admin/**", Arrays.asList("ADMIN"));
        put("/api/user/profile", Arrays.asList("USER", "ADMIN"));  
        put("/api/order/**", Arrays.asList("USER", "ADMIN"));
    }};
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        String path = request.getURI().getPath();
        
        // è·å–ç”¨æˆ·è§’è‰²
        String userRoles = request.getHeaders().getFirst("X-User-Roles");
        if (userRoles == null) {
            return chain.filter(exchange); // å·²é€šè¿‡è®¤è¯ä½†æ— è§’è‰²ä¿¡æ¯ï¼Œæ”¾è¡Œ
        }
        
        List<String> currentUserRoles = Arrays.asList(userRoles.split(","));
        
        // æ£€æŸ¥è·¯å¾„æƒé™
        for (Map.Entry<String, List<String>> entry : PATH_ROLES.entrySet()) {
            String pathPattern = entry.getKey();
            List<String> requiredRoles = entry.getValue();
            
            if (isPathMatch(path, pathPattern)) {
                boolean hasPermission = currentUserRoles.stream()
                    .anyMatch(requiredRoles::contains);
                    
                if (!hasPermission) {
                    return handlePermissionDenied(exchange, "æƒé™ä¸è¶³");
                }
            }
        }
        
        return chain.filter(exchange);
    }
    
    private boolean isPathMatch(String path, String pattern) {
        // ç®€å•çš„é€šé…ç¬¦åŒ¹é…ï¼ˆå®é™…é¡¹ç›®å»ºè®®ä½¿ç”¨AntPathMatcherï¼‰
        if (pattern.endsWith("/**")) {
            String prefix = pattern.substring(0, pattern.length() - 3);
            return path.startsWith(prefix);
        }
        return path.equals(pattern);
    }
    
    @Override
    public int getOrder() {
        return -100; // åœ¨è®¤è¯è¿‡æ»¤å™¨ä¹‹åæ‰§è¡Œ
    }
}
```

---

## 8. ğŸŒ è·¨åŸŸå¤„ç†é…ç½®


### 8.1 è·¨åŸŸé—®é¢˜ç†è§£


> ğŸš« **ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜ï¼Ÿ**  
> æµè§ˆå™¨çš„åŒæºæ”¿ç­–é™åˆ¶äº†ä»ä¸€ä¸ªåŸŸåçš„ç½‘é¡µå»è®¿é—®å¦ä¸€ä¸ªåŸŸåçš„èµ„æºï¼Œè¿™å°±æ˜¯è·¨åŸŸé—®é¢˜

**ğŸ” è·¨åŸŸçš„åˆ¤å®šæ¡ä»¶**
```
åŒæºè¦æ±‚ï¼ˆä»¥ä¸‹ä»»æ„ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼‰ï¼š
âœ… åè®®ç›¸åŒï¼šhttp vs https  
âœ… åŸŸåç›¸åŒï¼šwww.example.com vs api.example.com
âœ… ç«¯å£ç›¸åŒï¼š:8080 vs :9000

è·¨åŸŸç¤ºä¾‹ï¼š
âŒ http://localhost:3000 â†’ http://localhost:8080 (ç«¯å£ä¸åŒ)
âŒ https://www.a.com â†’ http://www.a.com (åè®®ä¸åŒ)  
âŒ http://a.com â†’ http://b.com (åŸŸåä¸åŒ)
```

### 8.2 Gatewayè·¨åŸŸé…ç½®


**âš™ï¸ å…¨å±€è·¨åŸŸé…ç½®**
```yaml
spring:
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':  # å¯¹æ‰€æœ‰è·¯å¾„ç”Ÿæ•ˆ
            allowed-origins: 
              - "http://localhost:3000"
              - "http://localhost:8080"  
              - "https://www.example.com"
            allowed-methods:
              - GET
              - POST
              - PUT  
              - DELETE
              - OPTIONS
            allowed-headers: "*"
            allow-credentials: true
            max-age: 3600  # é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´
```

**ğŸ¯ ç‰¹å®šè·¯ç”±è·¨åŸŸé…ç½®**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: api-route
          uri: http://localhost:8001
          predicates:
            - Path=/api/**
          filters:
            # ä¸ºç‰¹å®šè·¯ç”±é…ç½®è·¨åŸŸ
            - name: Cors
              args:
                allowed-origins: "http://localhost:3000"
                allowed-methods: GET,POST
                allowed-headers: "*"
                allow-credentials: true
```

### 8.3 ä»£ç æ–¹å¼è·¨åŸŸé…ç½®


**ğŸ”§ CorsConfiguration Bean**
```java
@Configuration
public class CorsConfig {
    
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        
        // å…è®¸çš„æº
        configuration.setAllowedOriginPatterns(Arrays.asList(
            "http://localhost:*",
            "https://*.example.com"
        ));
        
        // å…è®¸çš„æ–¹æ³•
        configuration.setAllowedMethods(Arrays.asList(
            "GET", "POST", "PUT", "DELETE", "OPTIONS"
        ));
        
        // å…è®¸çš„è¯·æ±‚å¤´
        configuration.setAllowedHeaders(Arrays.asList("*"));
        
        // å…è®¸æºå¸¦è®¤è¯ä¿¡æ¯
        configuration.setAllowCredentials(true);
        
        // é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´
        configuration.setMaxAge(3600L);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        
        return source;
    }
}
```

**ğŸ›¡ï¸ è‡ªå®šä¹‰è·¨åŸŸè¿‡æ»¤å™¨**
```java
@Component
public class CorsFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        ServerHttpResponse response = exchange.getResponse();
        HttpHeaders headers = response.getHeaders();
        
        // è·å–è¯·æ±‚æ¥æº
        String origin = request.getHeaders().getFirst("Origin");
        
        if (isAllowedOrigin(origin)) {
            headers.add("Access-Control-Allow-Origin", origin);
            headers.add("Access-Control-Allow-Credentials", "true");
            headers.add("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE,OPTIONS");
            headers.add("Access-Control-Allow-Headers", 
                "Content-Type,Authorization,X-Requested-With");
            headers.add("Access-Control-Max-Age", "3600");
        }
        
        // å¤„ç†é¢„æ£€è¯·æ±‚
        if (HttpMethod.OPTIONS.equals(request.getMethod())) {
            response.setStatusCode(HttpStatus.OK);
            return response.setComplete();
        }
        
        return chain.filter(exchange);
    }
    
    private boolean isAllowedOrigin(String origin) {
        if (origin == null) return false;
        
        // å…è®¸çš„åŸŸååˆ—è¡¨
        List<String> allowedOrigins = Arrays.asList(
            "http://localhost:3000",
            "http://localhost:8080",
            "https://www.example.com"
        );
        
        return allowedOrigins.contains(origin) || 
               origin.matches("https://.*\\.example\\.com");
    }
    
    @Override
    public int getOrder() {
        return -300; // æœ€é«˜ä¼˜å…ˆçº§
    }
}
```

### 8.4 è·¨åŸŸé—®é¢˜è°ƒè¯•


**ğŸ” å¸¸è§è·¨åŸŸé”™è¯¯**
```
æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼š

1. "Access to XMLHttpRequest at 'xxx' from origin 'xxx' has been blocked by CORS policy"
   â†’ åç«¯æ²¡æœ‰é…ç½®CORSæˆ–é…ç½®ä¸æ­£ç¡®

2. "Response to preflight request doesn't pass access control check"  
   â†’ é¢„æ£€è¯·æ±‚(OPTIONS)å¤„ç†æœ‰é—®é¢˜

3. "The request client is not a secure context"
   â†’ HTTPSé¡µé¢è®¿é—®HTTPæ¥å£çš„å®‰å…¨ç­–ç•¥é—®é¢˜
```

**ğŸ› ï¸ è°ƒè¯•æ­¥éª¤**
```
è·¨åŸŸé—®é¢˜æ’æŸ¥ï¼š
1. æ£€æŸ¥æµè§ˆå™¨ç½‘ç»œé¢æ¿çš„OPTIONSè¯·æ±‚
2. ç¡®è®¤å“åº”å¤´æ˜¯å¦åŒ…å«æ­£ç¡®çš„CORSå¤´
3. æ£€æŸ¥allowed-originsé…ç½®æ˜¯å¦åŒ…å«è¯·æ±‚æº
4. éªŒè¯allowed-methodsæ˜¯å¦åŒ…å«è¯·æ±‚æ–¹æ³•
5. ç¡®è®¤allowed-headersæ˜¯å¦åŒ…å«è‡ªå®šä¹‰è¯·æ±‚å¤´
```

---

## 9. ğŸ“Š ç½‘å…³ç›‘æ§è¿ç»´


### 9.1 ç›‘æ§æŒ‡æ ‡ä½“ç³»


> ğŸ“ˆ **ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Ÿ**  
> ç½‘å…³æ˜¯æµé‡å…¥å£ï¼Œç›‘æ§ç½‘å…³å°±èƒ½äº†è§£æ•´ä¸ªç³»ç»Ÿçš„å¥åº·çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜

**ğŸ¯ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**
```
æ€§èƒ½æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   QPS/TPS   â”‚   å“åº”æ—¶é—´   â”‚   é”™è¯¯ç‡    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¯ç§’è¯·æ±‚æ•°   â”‚ å¹³å‡å“åº”æ—¶é—´ â”‚ 4xx/5xxæ¯”ä¾‹ â”‚
â”‚ ååé‡æŒ‡æ ‡   â”‚ 99%åˆ†ä½æ•°   â”‚ è¶…æ—¶è¯·æ±‚    â”‚
â”‚ å¹¶å‘è¿æ¥æ•°   â”‚ æœ€å¤§å“åº”æ—¶é—´ â”‚ ç†”æ–­æ¬¡æ•°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸šåŠ¡æŒ‡æ ‡ï¼š
â€¢ å„æœåŠ¡è°ƒç”¨é‡åˆ†å¸ƒ  
â€¢ çƒ­ç‚¹APIç»Ÿè®¡
â€¢ ç”¨æˆ·è¡Œä¸ºåˆ†æ
â€¢ åœ°åŸŸè®¿é—®åˆ†å¸ƒ
```

### 9.2 Spring Boot Actuatorç›‘æ§


**ğŸ“¦ ç›‘æ§ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

**âš™ï¸ Actuatoré…ç½®**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,gateway
  endpoint:
    health:
      show-details: always
    gateway:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
```

**ğŸ“Š å…³é”®ç›‘æ§ç«¯ç‚¹**
```
ç›‘æ§ç«¯ç‚¹è¯´æ˜ï¼š
/actuator/health      â†’ æœåŠ¡å¥åº·æ£€æŸ¥
/actuator/metrics     â†’ æŒ‡æ ‡æ•°æ®  
/actuator/prometheus  â†’ Prometheusæ ¼å¼æŒ‡æ ‡
/actuator/gateway/routes â†’ è·¯ç”±ä¿¡æ¯
/actuator/gateway/filters â†’ è¿‡æ»¤å™¨ä¿¡æ¯
```

### 9.3 è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†


**ğŸ“ˆ è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡**
```java
@Component
@Slf4j
public class GatewayMetricsFilter implements GlobalFilter, Ordered {
    
    private final Counter requestCounter;
    private final Timer requestTimer;
    
    public GatewayMetricsFilter(MeterRegistry meterRegistry) {
        this.requestCounter = Counter.builder("gateway_requests_total")
            .description("Total number of requests")
            .tag("application", "api-gateway")
            .register(meterRegistry);
            
        this.requestTimer = Timer.builder("gateway_request_duration")
            .description("Request duration in seconds")
            .tag("application", "api-gateway")  
            .register(meterRegistry);
    }
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        long startTime = System.currentTimeMillis();
        
        return chain.filter(exchange)
            .doFinally(signalType -> {
                // è®°å½•è¯·æ±‚æŒ‡æ ‡
                ServerHttpRequest request = exchange.getRequest();
                ServerHttpResponse response = exchange.getResponse();
                
                String method = request.getMethod().toString();
                String path = request.getURI().getPath();
                String status = response.getStatusCode().toString();
                
                // è®¡æ•°å™¨å¢åŠ 
                requestCounter.increment(
                    Tags.of(
                        "method", method,
                        "path", normalizePath(path),
                        "status", status
                    )
                );
                
                // è®°å½•å“åº”æ—¶é—´
                long duration = System.currentTimeMillis() - startTime;
                requestTimer.record(Duration.ofMillis(duration),
                    Tags.of(
                        "method", method,
                        "path", normalizePath(path)
                    )
                );
            });
    }
    
    private String normalizePath(String path) {
        // å°†è·¯å¾„ä¸­çš„IDç­‰å‚æ•°ç»Ÿä¸€åŒ–ï¼Œé¿å…æŒ‡æ ‡ç»´åº¦çˆ†ç‚¸
        return path.replaceAll("/\\d+", "/{id}")
                  .replaceAll("/[a-f0-9-]{36}", "/{uuid}");
    }
    
    @Override
    public int getOrder() {
        return Ordered.HIGHEST_PRECEDENCE;
    }
}
```

### 9.4 æ—¥å¿—ç®¡ç†


**ğŸ“ ç»“æ„åŒ–æ—¥å¿—é…ç½®**
```xml
<!-- logback-spring.xml -->
<configuration>
    <springProfile name="!dev">
        <!-- ç”Ÿäº§ç¯å¢ƒJSONæ ¼å¼æ—¥å¿— -->
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <logLevel/>
                <loggerName/>
                <message/>
                <mdc/>
                <arguments/>
            </providers>
        </encoder>
    </springProfile>
    
    <springProfile name="dev">
        <!-- å¼€å‘ç¯å¢ƒæ™®é€šæ ¼å¼æ—¥å¿— -->
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </springProfile>
</configuration>
```

**ğŸ“Š è®¿é—®æ—¥å¿—è¿‡æ»¤å™¨**
```java
@Component
@Slf4j
public class AccessLogFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        long startTime = System.currentTimeMillis();
        
        return chain.filter(exchange)
            .doFinally(signalType -> {
                ServerHttpResponse response = exchange.getResponse();
                long duration = System.currentTimeMillis() - startTime;
                
                // è®°å½•è®¿é—®æ—¥å¿—
                log.info("Gateway Access Log - " +
                    "Method: {}, " +
                    "Path: {}, " + 
                    "Status: {}, " +
                    "Duration: {}ms, " +
                    "Remote IP: {}, " +
                    "User-Agent: {}",
                    request.getMethod(),
                    request.getURI().getPath(),
                    response.getStatusCode(),
                    duration,
                    getClientIp(request),
                    request.getHeaders().getFirst("User-Agent")
                );
            });
    }
    
    private String getClientIp(ServerHttpRequest request) {
        String xForwardedFor = request.getHeaders().getFirst("X-Forwarded-For");
        if (xForwardedFor != null && !xForwardedFor.isEmpty()) {
            return xForwardedFor.split(",")[0].trim();
        }
        
        String xRealIp = request.getHeaders().getFirst("X-Real-IP");
        if (xRealIp != null && !xRealIp.isEmpty()) {
            return xRealIp;
        }
        
        return request.getRemoteAddress().getAddress().getHostAddress();
    }
    
    @Override
    public int getOrder() {
        return Ordered.HIGHEST_PRECEDENCE + 1;
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ APIç½‘å…³æœ¬è´¨ï¼šå¾®æœåŠ¡æ¶æ„ä¸­çš„ç»Ÿä¸€å…¥å£å’Œæµé‡æ§åˆ¶ä¸­å¿ƒ
ğŸ”¸ Gatewayä¸‰è¦ç´ ï¼šRoute(è·¯ç”±)ã€Predicate(æ–­è¨€)ã€Filter(è¿‡æ»¤å™¨)
ğŸ”¸ é™æµé‡è¦æ€§ï¼šä¿æŠ¤åç«¯æœåŠ¡ï¼Œé˜²æ­¢æµé‡æ´ªå³°é€ æˆç³»ç»Ÿå´©æºƒ
ğŸ”¸ è®¤è¯æˆæƒï¼šç»Ÿä¸€çš„å®‰å…¨æ§åˆ¶ï¼ŒJWTæ— çŠ¶æ€è®¤è¯æ–¹æ¡ˆ
ğŸ”¸ è·¨åŸŸå¤„ç†ï¼šè§£å†³å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­çš„æµè§ˆå™¨è·¨åŸŸé™åˆ¶
ğŸ”¸ ç›‘æ§è¿ç»´ï¼šå®æ—¶æŒæ¡ç½‘å…³å¥åº·çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Gateway vs Zuulé€‰æ‹©**
```
æŠ€æœ¯é€‰å‹å»ºè®®ï¼š
âœ… æ–°é¡¹ç›®ï¼šé¦–é€‰Spring Cloud Gateway
  - å¼‚æ­¥éé˜»å¡ï¼Œæ€§èƒ½æ›´å¥½
  - Springå®˜æ–¹ç»´æŠ¤ï¼ŒåŠŸèƒ½æ›´ä¸°å¯Œ
  - ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„

âŒ è€é¡¹ç›®ï¼šZuul 1.xç»´æŠ¤çŠ¶æ€
  - å·²åœæ­¢ç»´æŠ¤ï¼Œä¸å»ºè®®æ–°é¡¹ç›®ä½¿ç”¨
  - å¦‚æœå·²åœ¨ä½¿ç”¨ï¼Œå»ºè®®é€æ­¥è¿ç§»åˆ°Gateway
```

**ğŸ”¹ è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº**
```
è¿‡æ»¤å™¨æ‰§è¡Œé“¾ï¼š
Global Pre Filter (order=-200)
    â†“
Gateway Filter (order=-100) 
    â†“
å¾®æœåŠ¡å¤„ç†
    â†“
Gateway Filter (order=-100)
    â†“
Global Post Filter (order=-200)

è®°å¿†è¦ç‚¹ï¼š
â€¢ Orderå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
â€¢ Pre FilteræŒ‰orderå‡åºæ‰§è¡Œ
â€¢ Post FilteræŒ‰orderé™åºæ‰§è¡Œ
```

**ğŸ”¹ é™æµç­–ç•¥é€‰æ‹©**
```
é™æµç»´åº¦é€‰æ‹©ï¼š
IPé™æµï¼šé˜²æ­¢å•ä¸ªIPæ¶æ„è¯·æ±‚
ç”¨æˆ·é™æµï¼šå…¬å¹³ä½¿ç”¨èµ„æº
æ¥å£é™æµï¼šä¿æŠ¤ç‰¹å®šæ•æ„Ÿæ¥å£
å…¨å±€é™æµï¼šä¿æŠ¤æ•´ä½“ç³»ç»Ÿå®¹é‡

ç®—æ³•é€‰æ‹©ï¼š
ä»¤ç‰Œæ¡¶ï¼šå…è®¸çªå‘æµé‡ï¼Œé€‚åˆå¤§éƒ¨åˆ†åœºæ™¯
æ»‘åŠ¨çª—å£ï¼šæ›´ç²¾ç¡®çš„é™æµæ§åˆ¶
å›ºå®šçª—å£ï¼šå®ç°ç®€å•ï¼Œä½†æœ‰ä¸´ç•Œé—®é¢˜
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç½‘å…³éƒ¨ç½²æ¶æ„**
```
ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
è´Ÿè½½å‡è¡¡å™¨ â†’ å¤šä¸ªGatewayå®ä¾‹ â†’ å¾®æœåŠ¡é›†ç¾¤

Gatewayé›†ç¾¤ï¼š
â€¢ è‡³å°‘2ä¸ªå®ä¾‹ä¿è¯é«˜å¯ç”¨
â€¢ ä½¿ç”¨ç›¸åŒçš„é…ç½®å’Œè¿‡æ»¤å™¨
â€¢ æ— çŠ¶æ€è®¾è®¡ï¼Œä¾¿äºæ°´å¹³æ‰©å±•

é…ç½®ç®¡ç†ï¼š
â€¢ ä½¿ç”¨é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†è·¯ç”±é…ç½®
â€¢ æ”¯æŒåŠ¨æ€åˆ·æ–°ï¼Œæ— éœ€é‡å¯
â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼Œä¾¿äºå›æ»š
```

**ğŸ› ï¸ å¸¸è§é—®é¢˜å¤„ç†**
```
æ€§èƒ½è°ƒä¼˜ï¼š
â€¢ åˆç†è®¾ç½®è¿æ¥æ± å‚æ•°
â€¢ å¯ç”¨HTTP/2æå‡ä¼ è¾“æ•ˆç‡  
â€¢ ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—

æ•…éšœæ’æŸ¥ï¼š
â€¢ æŸ¥çœ‹Gatewayæ—¥å¿—å®šä½é—®é¢˜
â€¢ æ£€æŸ¥è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®
â€¢ éªŒè¯åç«¯æœåŠ¡æ˜¯å¦å¯ç”¨
â€¢ ç¡®è®¤è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº

å®‰å…¨åŠ å›ºï¼š
â€¢ éšè—å†…éƒ¨æœåŠ¡åœ°å€
â€¢ å®æ–½ä¸¥æ ¼çš„è®¤è¯æˆæƒ
â€¢ å®šæœŸæ›´æ–°ä¾èµ–ç‰ˆæœ¬
â€¢ ç›‘æ§å¼‚å¸¸æµé‡æ¨¡å¼
```

### 10.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
å­¦ä¹ è¿›é˜¶è·¯å¾„ï¼š
ğŸ“š åŸºç¡€é˜¶æ®µï¼š
   1. ç†è§£å¾®æœåŠ¡ç½‘å…³æ¦‚å¿µå’Œä½œç”¨
   2. æŒæ¡GatewayåŸºæœ¬é…ç½®å’Œè·¯ç”±è§„åˆ™
   3. å­¦ä¼šä½¿ç”¨å†…ç½®æ–­è¨€å·¥å‚å’Œè¿‡æ»¤å™¨

ğŸ”§ è¿›é˜¶é˜¶æ®µï¼š
   1. å®ç°è‡ªå®šä¹‰è¿‡æ»¤å™¨å’Œæ–­è¨€å·¥å‚
   2. é›†æˆè®¤è¯æˆæƒå’Œé™æµæ§åˆ¶
   3. é…ç½®ç›‘æ§å’Œæ—¥å¿—æ”¶é›†

ğŸš€ é«˜çº§é˜¶æ®µï¼š
   1. ç½‘å…³æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜
   2. é›†ç¾¤éƒ¨ç½²å’Œé«˜å¯ç”¨æ–¹æ¡ˆ
   3. ä¸æœåŠ¡ç½‘æ ¼(Service Mesh)çš„å¯¹æ¯”å’Œé€‰æ‹©
```

**ğŸ’¡ è®°å¿†å£è¯€**
- **ç½‘å…³ä½œç”¨**ï¼šç»Ÿä¸€å…¥å£æ§æµé‡ï¼Œè·¯ç”±è½¬å‘ä¿å®‰å…¨
- **æ ¸å¿ƒä¸‰è¦ç´ **ï¼šè·¯ç”±æ–­è¨€åŠ è¿‡æ»¤ï¼ŒGatewayæ¶æ„è¦ç‰¢è®°  
- **è¿‡æ»¤å™¨é“¾**ï¼šå…¨å±€ç‰¹å®šæœ‰é¡ºåºï¼Œå‰ç½®åç½®è¦åˆ†æ¸…
- **é™æµè®¤è¯**ï¼šä»¤ç‰Œæ¡¶ç®—æ³•JWTï¼Œä¿æŠ¤æœåŠ¡é˜²æ”»å‡»

**ğŸ¯ å®è·µå»ºè®®**
é€šè¿‡æ­å»ºä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡é¡¹ç›®æ¥å®è·µGatewayçš„å„ç§åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€å•†å“æŸ¥è¯¢ã€è®¢å•å¤„ç†ç­‰å¤šä¸ªæœåŠ¡ï¼Œä½“éªŒç½‘å…³åœ¨å®é™…é¡¹ç›®ä¸­çš„ä»·å€¼å’Œä½œç”¨ã€‚