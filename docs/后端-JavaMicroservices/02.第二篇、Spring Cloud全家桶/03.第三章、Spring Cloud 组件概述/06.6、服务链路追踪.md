---
title: 6ã€æœåŠ¡é“¾è·¯è¿½è¸ª
---
## ğŸ“š ç›®å½•


1. [æœåŠ¡é“¾è·¯è¿½è¸ªåŸºç¡€æ¦‚å¿µ](#1-æœåŠ¡é“¾è·¯è¿½è¸ªåŸºç¡€æ¦‚å¿µ)
2. [åˆ†å¸ƒå¼è¿½è¸ªåŸç†](#2-åˆ†å¸ƒå¼è¿½è¸ªåŸç†)
3. [Micrometer Tracingå®ç°](#3-micrometer-tracingå®ç°)
4. [Spring Cloud Sleuthè¯¦è§£](#4-spring-cloud-sleuthè¯¦è§£)
5. [OpenTelemetryæ ‡å‡†](#5-opentelemetryæ ‡å‡†)
6. [Braveè¿½è¸ªç»„ä»¶](#6-braveè¿½è¸ªç»„ä»¶)
7. [Zipkinå¯è§†åŒ–è¿½è¸ª](#7-zipkinå¯è§†åŒ–è¿½è¸ª)
8. [SkyWalking APMç›‘æ§](#8-skywalking-apmç›‘æ§)
9. [Jaegerè¿½è¸ªç³»ç»Ÿ](#9-jaegerè¿½è¸ªç³»ç»Ÿ)
10. [é“¾è·¯æ•°æ®æ”¶é›†ä¸åˆ†æ](#10-é“¾è·¯æ•°æ®æ”¶é›†ä¸åˆ†æ)
11. [æ€§èƒ½åˆ†æä¸ä¼˜åŒ–](#11-æ€§èƒ½åˆ†æä¸ä¼˜åŒ–)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šå¾®æœåŠ¡åŸºç¡€ã€Spring Bootã€HTTPé€šä¿¡ â†’ **å½“å‰å†…å®¹**ï¼šæœåŠ¡é“¾è·¯è¿½è¸ª â†’ **åç»­å­¦ä¹ **ï¼šå¾®æœåŠ¡ç›‘æ§ã€æ—¥å¿—èšåˆ

â±ï¸ **å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡90åˆ†é’Ÿ | å®è·µæ“ä½œ60åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**ï¼š`#åˆ†å¸ƒå¼è¿½è¸ª` `#å¾®æœåŠ¡ç›‘æ§` `#æ€§èƒ½åˆ†æ` `#Spring Cloud`

---

## 1. ğŸ•µï¸ æœåŠ¡é“¾è·¯è¿½è¸ªåŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡é“¾è·¯è¿½è¸ª



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
æœåŠ¡é“¾è·¯è¿½è¸ªï¼šè®°å½•ç”¨æˆ·è¯·æ±‚åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„å®Œæ•´è°ƒç”¨è·¯å¾„
ç›®çš„ï¼šå¸®åŠ©å¼€å‘è€…ç†è§£è¯·æ±‚å¦‚ä½•åœ¨å„ä¸ªæœåŠ¡é—´æµè½¬
ä½œç”¨ï¼šå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆå’Œæ•…éšœæ ¹å› 
```

**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**
æƒ³è±¡ä½ åœ¨ä¸€å®¶å¤§å‹å•†åœºè´­ç‰©ï¼š
- **ä¼ ç»Ÿæ–¹å¼**ï¼šä½ ä¸çŸ¥é“å•†å“ä»å“ªä¸ªä»“åº“æ¥ï¼Œç»è¿‡äº†å“ªäº›ç¯èŠ‚
- **é“¾è·¯è¿½è¸ª**ï¼šå°±åƒç»™æ¯ä»¶å•†å“è´´ä¸Šæ¡å½¢ç ï¼Œè®°å½•å®ƒçš„å®Œæ•´æµè½¬è·¯å¾„

**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**
- ğŸ˜µ **è¯·æ±‚è¿·è·¯**ï¼šä¸çŸ¥é“è¯·æ±‚åˆ°åº•è°ƒç”¨äº†å“ªäº›æœåŠ¡
- ğŸŒ **æ€§èƒ½ç“¶é¢ˆ**ï¼šä¸æ¸…æ¥šå“ªä¸ªç¯èŠ‚æœ€è€—æ—¶
- ğŸ”¥ **æ•…éšœæ’æŸ¥**ï¼šå‡ºé”™äº†ä¸çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªä¸ªæœåŠ¡
- ğŸ“Š **ä¾èµ–å…³ç³»**ï¼šæä¸æ¸…æ¥šæœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»

### 1.2 å¾®æœåŠ¡ç¯å¢ƒä¸‹çš„è¿½è¸ªæŒ‘æˆ˜



**ğŸŒ å¤æ‚è°ƒç”¨é“¾ç¤ºä¾‹**
```
ç”¨æˆ·ä¸‹å•æµç¨‹è¿½è¸ªï¼š
ç”¨æˆ·è¯·æ±‚ â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡ â†’ é€šçŸ¥æœåŠ¡
         â†˜ ç”¨æˆ·æœåŠ¡ â†—  â†˜ ç§¯åˆ†æœåŠ¡ â†—
```

**âš ï¸ å¸¸è§è¿½è¸ªéš¾é¢˜**
- **è°ƒç”¨é“¾å¤æ‚**ï¼šä¸€ä¸ªè¯·æ±‚å¯èƒ½æ¶‰åŠåå‡ ä¸ªæœåŠ¡
- **å¼‚æ­¥å¤„ç†**ï¼šæ¶ˆæ¯é˜Ÿåˆ—ã€å¼‚æ­¥è°ƒç”¨éš¾ä»¥è¿½è¸ª
- **æ€§èƒ½å½±å“**ï¼šè¿½è¸ªç³»ç»Ÿæœ¬èº«ä¸èƒ½å½±å“ä¸šåŠ¡æ€§èƒ½
- **æ•°æ®é‡å¤§**ï¼šå¤§é‡è¿½è¸ªæ•°æ®éœ€è¦é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥è¯¢

### 1.3 è¿½è¸ªç³»ç»Ÿçš„ä»·å€¼



| **åº”ç”¨åœºæ™¯** | **è§£å†³é—®é¢˜** | **ä»·å€¼æ”¶ç›Š** |
|-------------|-------------|-------------|
| **æ•…éšœæ’æŸ¥** | å¿«é€Ÿå®šä½å‡ºé”™æœåŠ¡ | ğŸ”¥ æ•…éšœæ¢å¤æ—¶é—´ç¼©çŸ­80% |
| **æ€§èƒ½ä¼˜åŒ–** | è¯†åˆ«æ…¢è°ƒç”¨ç¯èŠ‚ | âš¡ å“åº”æ—¶é—´ä¼˜åŒ–30-50% |
| **æ¶æ„åˆ†æ** | äº†è§£æœåŠ¡ä¾èµ–å…³ç³» | ğŸ“Š æ¶æ„å†³ç­–æ•°æ®åŒ– |
| **å®¹é‡è§„åˆ’** | åˆ†ææœåŠ¡è°ƒç”¨é‡ | ğŸ’° èµ„æºåˆ©ç”¨ç‡æå‡ |

---

## 2. ğŸ” åˆ†å¸ƒå¼è¿½è¸ªåŸç†



### 2.1 è¿½è¸ªçš„æ ¸å¿ƒæ¦‚å¿µ



**ğŸ“ åŸºç¡€æœ¯è¯­è§£é‡Š**
- **Traceï¼ˆè¿½è¸ªï¼‰**ï¼šä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è°ƒç”¨é“¾è·¯
- **Spanï¼ˆè·¨åº¦ï¼‰**ï¼šè°ƒç”¨é“¾ä¸­çš„ä¸€ä¸ªæ“ä½œå•å…ƒï¼Œæ¯”å¦‚ä¸€æ¬¡HTTPè°ƒç”¨
- **TraceIdï¼ˆè¿½è¸ªIDï¼‰**ï¼šæ ‡è¯†æ•´ä¸ªè°ƒç”¨é“¾çš„å”¯ä¸€ID
- **SpanIdï¼ˆè·¨åº¦IDï¼‰**ï¼šæ ‡è¯†å•ä¸ªæ“ä½œçš„å”¯ä¸€ID

**ğŸŒ³ è¿½è¸ªæ ‘çŠ¶ç»“æ„**
```
Trace: ç”¨æˆ·ä¸‹å• (TraceId: abc123)
â”œâ”€ Span: è®¢å•æœåŠ¡å¤„ç† (SpanId: span-1, Duration: 200ms)
â”‚  â”œâ”€ Span: æ£€æŸ¥åº“å­˜ (SpanId: span-2, Duration: 50ms)
â”‚  â”œâ”€ Span: è®¡ç®—ä»·æ ¼ (SpanId: span-3, Duration: 30ms)
â”‚  â””â”€ Span: åˆ›å»ºè®¢å• (SpanId: span-4, Duration: 120ms)
â””â”€ Span: å‘é€é€šçŸ¥ (SpanId: span-5, Duration: 40ms)
```

### 2.2 è¿½è¸ªæ•°æ®ä¼ æ’­æœºåˆ¶



**ğŸ”„ TraceContextä¼ æ’­è¿‡ç¨‹**
```
HTTPè¯·æ±‚å¤´ä¼ æ’­ç¤ºä¾‹ï¼š
è¯·æ±‚1: GET /order
Headers: X-Trace-Id: abc123, X-Span-Id: span-1

æœåŠ¡Aè°ƒç”¨æœåŠ¡B:
POST /inventory/check
Headers: X-Trace-Id: abc123, X-Parent-Span-Id: span-1, X-Span-Id: span-2

æœåŠ¡Bè°ƒç”¨æœåŠ¡C:
GET /user/info  
Headers: X-Trace-Id: abc123, X-Parent-Span-Id: span-2, X-Span-Id: span-3
```

**âš¡ è‡ªåŠ¨æ³¨å…¥æœºåˆ¶**
ç°ä»£è¿½è¸ªæ¡†æ¶ä¼šè‡ªåŠ¨åœ¨ä»¥ä¸‹ç»„ä»¶ä¸­æ³¨å…¥è¿½è¸ªä¿¡æ¯ï¼š
- **HTTPå®¢æˆ·ç«¯**ï¼šRestTemplateã€Feignã€WebClient
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQã€Kafkaæ¶ˆæ¯
- **æ•°æ®åº“è®¿é—®**ï¼šJDBCã€JPAæŸ¥è¯¢
- **å®šæ—¶ä»»åŠ¡**ï¼š@Scheduledæ–¹æ³•

### 2.3 é‡‡æ ·ç­–ç•¥



**ğŸ² ä¸ºä»€ä¹ˆéœ€è¦é‡‡æ ·**
æƒ³è±¡ä¸€ä¸ªç”µå•†ç½‘ç«™æ¯ç§’å¤„ç†1ä¸‡ä¸ªè¯·æ±‚ï¼š
- **å…¨é‡è¿½è¸ª**ï¼šæ¯ç§’äº§ç”Ÿ1ä¸‡ä¸ªTraceï¼Œå­˜å‚¨å’Œç½‘ç»œå‹åŠ›å·¨å¤§
- **é‡‡æ ·è¿½è¸ª**ï¼šåªè¿½è¸ªå…¶ä¸­1%ï¼ˆ100ä¸ªï¼‰ï¼Œæ—¢èƒ½å‘ç°é—®é¢˜åˆä¸å½±å“æ€§èƒ½

**ğŸ“Š å¸¸è§é‡‡æ ·ç­–ç•¥**

| **é‡‡æ ·ç±»å‹** | **é€‚ç”¨åœºæ™¯** | **é‡‡æ ·ç‡å»ºè®®** | **ä¼˜ç¼ºç‚¹** |
|-------------|-------------|---------------|-----------|
| **å›ºå®šé‡‡æ ·** | å¼€å‘æµ‹è¯•ç¯å¢ƒ | 100% | âœ… æ•°æ®å®Œæ•´ âŒ æ€§èƒ½å½±å“å¤§ |
| **æ¦‚ç‡é‡‡æ ·** | ç”Ÿäº§ç¯å¢ƒ | 1-10% | âœ… æ€§èƒ½å¥½ âŒ å¯èƒ½ä¸¢å¤±é‡è¦ä¿¡æ¯ |
| **é™æµé‡‡æ ·** | é«˜å¹¶å‘åœºæ™¯ | æ¯ç§’100ä¸ª | âœ… å¯æ§åˆ¶é‡ âŒ åˆ†å¸ƒä¸å‡ |
| **æ™ºèƒ½é‡‡æ ·** | å¤æ‚ä¸šåŠ¡ | åŠ¨æ€è°ƒæ•´ | âœ… çµæ´» âŒ å®ç°å¤æ‚ |

---

## 3. ğŸ“ Micrometer Tracingå®ç°



### 3.1 Micrometer Tracingç®€ä»‹



**ğŸ”¸ ä»€ä¹ˆæ˜¯Micrometer Tracing**
Micrometer Tracingæ˜¯Springå®˜æ–¹æ¨å‡ºçš„æ–°ä¸€ä»£è¿½è¸ªæŠ½è±¡å±‚ï¼Œå°±åƒMicrometer Metricsç»Ÿä¸€äº†æŒ‡æ ‡æ”¶é›†ä¸€æ ·ï¼Œå®ƒç»Ÿä¸€äº†åˆ†å¸ƒå¼è¿½è¸ªã€‚

**ğŸ’¡ ç±»æ¯”ç†è§£**
æŠŠMicrometer Tracingæƒ³è±¡æˆ**ç¿»è¯‘å™¨**ï¼š
- ä½ çš„åº”ç”¨åªéœ€è¦è¯´"æ ‡å‡†è¯"ï¼ˆMicrometer APIï¼‰
- ç¿»è¯‘å™¨è‡ªåŠ¨ç¿»è¯‘æˆå„ç§"æ–¹è¨€"ï¼ˆZipkinã€Jaegerç­‰æ ¼å¼ï¼‰

### 3.2 å¿«é€Ÿä¸Šæ‰‹é…ç½®



**ğŸš€ Mavenä¾èµ–é…ç½®**
```xml
<!-- Spring Boot 3.x å†…ç½®Micrometer Tracing -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>

<!-- ZipkinæŠ¥å‘Šå™¨ -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-tracing-bridge-brave</artifactId>
</dependency>

<!-- Zipkinå‘é€å™¨ -->
<dependency>
    <groupId>io.zipkin.reporter2</groupId>
    <artifactId>zipkin-reporter-brave</artifactId>
</dependency>
```

**âš™ï¸ åŸºç¡€é…ç½®**
```yaml
# application.yml

management:
  tracing:
    sampling:
      probability: 0.1  # 10%é‡‡æ ·ç‡
  zipkin:
    tracing:
      endpoint: http://localhost:9411/api/v2/spans

logging:
  pattern:
    console: "[%X{traceId:-},%X{spanId:-}] %-5level %logger{36} - %msg%n"
```

### 3.3 æ‰‹åŠ¨åˆ›å»ºSpan



**âœï¸ è‡ªå®šä¹‰è¿½è¸ªç‚¹**
```java
@Service
public class OrderService {
    
    private final Tracer tracer;
    
    public OrderService(Tracer tracer) {
        this.tracer = tracer;
    }
    
    public Order createOrder(OrderRequest request) {
        // åˆ›å»ºè‡ªå®šä¹‰Span
        Span span = tracer.nextSpan()
            .name("create-order")
            .tag("order.type", request.getType())
            .tag("user.id", request.getUserId())
            .start();
            
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(span)) {
            // ä¸šåŠ¡é€»è¾‘
            Order order = processOrder(request);
            
            // è®°å½•æˆåŠŸæ ‡ç­¾
            span.tag("order.id", order.getId());
            span.tag("order.status", "success");
            
            return order;
        } catch (Exception e) {
            // è®°å½•é”™è¯¯
            span.tag("error", e.getMessage());
            throw e;
        } finally {
            span.end();
        }
    }
}
```

---

## 4. ğŸŒ™ Spring Cloud Sleuthè¯¦è§£



### 4.1 Sleuthæ ¸å¿ƒç‰¹æ€§



**ğŸ”¸ Sleuthæ˜¯ä»€ä¹ˆ**
Spring Cloud Sleuthæ˜¯Spring Cloudç”Ÿæ€ä¸­çš„åˆ†å¸ƒå¼è¿½è¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒå°±åƒä¸€ä¸ª**è‡ªåŠ¨è®°å½•å‘˜**ï¼Œé»˜é»˜è®°å½•è¯·æ±‚åœ¨å¾®æœåŠ¡é—´çš„æµè½¬è¿‡ç¨‹ã€‚

**âœ¨ æ ¸å¿ƒä¼˜åŠ¿**
- **é›¶ä»£ç ä¾µå…¥**ï¼šå¼•å…¥ä¾èµ–å³å¯è‡ªåŠ¨è¿½è¸ª
- **å…¨é“¾è·¯è¦†ç›–**ï¼šHTTPã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“å…¨æ”¯æŒ
- **æ—¥å¿—é›†æˆ**ï¼šè¿½è¸ªä¿¡æ¯è‡ªåŠ¨æ³¨å…¥åˆ°æ—¥å¿—ä¸­

### 4.2 è‡ªåŠ¨è¿½è¸ªèŒƒå›´



**ğŸ“‹ Sleuthè‡ªåŠ¨è¿½è¸ªçš„ç»„ä»¶**

| **ç»„ä»¶ç±»å‹** | **å…·ä½“æŠ€æœ¯** | **è¿½è¸ªå†…å®¹** |
|-------------|-------------|-------------|
| **HTTPå®¢æˆ·ç«¯** | RestTemplateã€Feignã€WebClient | è¯·æ±‚URLã€å“åº”æ—¶é—´ã€çŠ¶æ€ç  |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RabbitMQã€Kafka | æ¶ˆæ¯å‘é€ã€æ¥æ”¶æ—¶é—´ |
| **æ•°æ®åº“** | JDBCã€JPA | SQLæ‰§è¡Œæ—¶é—´ |
| **å®šæ—¶ä»»åŠ¡** | @Scheduled | ä»»åŠ¡æ‰§è¡Œæ—¶é—´ |
| **å¼‚æ­¥ä»»åŠ¡** | @Async | å¼‚æ­¥æ–¹æ³•è°ƒç”¨ |

### 4.3 æ—¥å¿—è¿½è¸ªé›†æˆ



**ğŸ“ è¿½è¸ªä¿¡æ¯è‡ªåŠ¨æ³¨å…¥**
```
æ™®é€šæ—¥å¿—ï¼š
2023-09-22 10:30:15 INFO  OrderService - åˆ›å»ºè®¢å•æˆåŠŸ

Sleuthå¢å¼ºåï¼š
2023-09-22 10:30:15 INFO [order-service,abc123,def456] OrderService - åˆ›å»ºè®¢å•æˆåŠŸ
                          [æœåŠ¡å,TraceId,SpanId]
```

**ğŸ¯ æ—¥å¿—æŸ¥è¯¢ä¼˜åŠ¿**
æœ‰äº†TraceIdï¼Œä½ å¯ä»¥ï¼š
- åœ¨ELKä¸­æœç´¢ `traceId:abc123` æŸ¥çœ‹å®Œæ•´è°ƒç”¨é“¾æ—¥å¿—
- å¿«é€Ÿå®šä½é”™è¯¯å‘ç”Ÿåœ¨å“ªä¸ªæœåŠ¡çš„å“ªä¸ªæ–¹æ³•
- åˆ†æè¯·æ±‚çš„å®Œæ•´æ‰§è¡Œæµç¨‹

### 4.4 è‡ªå®šä¹‰é‡‡æ ·è§„åˆ™



**ğŸ² ç²¾ç»†åŒ–é‡‡æ ·æ§åˆ¶**
```java
@Bean
public ProbabilityBasedSampler defaultSampler() {
    // æ ¹æ®ä¸åŒè·¯å¾„è®¾ç½®ä¸åŒé‡‡æ ·ç‡
    return new ProbabilityBasedSampler() {
        @Override
        public Decision sample(TraceContext traceContext) {
            String operation = traceContext.span().getRemoteServiceName();
            
            if (operation.contains("health")) {
                return Decision.NOT_SAMPLED;  // å¥åº·æ£€æŸ¥ä¸é‡‡æ ·
            } else if (operation.contains("order")) {
                return Decision.SAMPLED;      // è®¢å•ç›¸å…³å…¨é‡‡æ ·
            } else {
                return Math.random() < 0.1 ? Decision.SAMPLED : Decision.NOT_SAMPLED;
            }
        }
    };
}
```

---

## 5. ğŸŒ OpenTelemetryæ ‡å‡†



### 5.1 OpenTelemetryæ¦‚è¿°



**ğŸ”¸ ä»€ä¹ˆæ˜¯OpenTelemetry**
OpenTelemetryæ˜¯äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼ˆCNCFï¼‰æ¨å‡ºçš„**å¯è§‚æµ‹æ€§æ ‡å‡†**ï¼Œå°±åƒåˆ¶å®šäº†ä¸€å¥—"é€šç”¨è¯­è¨€"ï¼Œè®©ä¸åŒçš„è¿½è¸ªç³»ç»Ÿèƒ½å¤Ÿäº’ç›¸ç†è§£ã€‚

**ğŸ’¡ æ ‡å‡†åŒ–çš„ä»·å€¼**
æƒ³è±¡äº’è”ç½‘æ—©æœŸå„å®¶æµè§ˆå™¨éƒ½æœ‰è‡ªå·±çš„æ ‡å‡†ï¼š
- **æ²¡æœ‰æ ‡å‡†**ï¼šç½‘ç«™è¦é€‚é…å„ç§æµè§ˆå™¨ï¼Œå¼€å‘æˆæœ¬é«˜
- **æœ‰äº†æ ‡å‡†**ï¼šæŒ‰HTML/CSSæ ‡å‡†å¼€å‘ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º

OpenTelemetryå°±æ˜¯è¿½è¸ªé¢†åŸŸçš„"HTMLæ ‡å‡†"ã€‚

### 5.2 OpenTelemetryæ¶æ„



**ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶æ¶æ„**
```
åº”ç”¨ç¨‹åº
    â†“
OpenTelemetry SDK (æ•°æ®æ”¶é›†)
    â†“  
OpenTelemetry Collector (æ•°æ®å¤„ç†)
    â†“
åç«¯ç³»ç»Ÿ (Zipkin/Jaeger/Prometheus)
```

**ğŸ”§ Spring Booté›†æˆ**
```xml
<!-- OpenTelemetryè‡ªåŠ¨é…ç½® -->
<dependency>
    <groupId>io.opentelemetry.instrumentation</groupId>
    <artifactId>opentelemetry-spring-boot-starter</artifactId>
</dependency>
```

```yaml
# é…ç½®OpenTelemetry

otel:
  service:
    name: order-service
  exporter:
    otlp:
      endpoint: http://localhost:4317
  resource:
    attributes:
      service.version: "1.0.0"
      deployment.environment: "production"
```

### 5.3 è¯­ä¹‰çº¦å®š



**ğŸ“‹ æ ‡å‡†åŒ–æ ‡ç­¾è§„èŒƒ**
OpenTelemetryå®šä¹‰äº†æ ‡å‡†çš„æ ‡ç­¾å‘½åï¼Œå°±åƒåˆ¶å®šäº†"è¯å…¸"ï¼š

| **æ ‡ç­¾ç±»å‹** | **æ ‡å‡†åç§°** | **ç¤ºä¾‹å€¼** | **è¯´æ˜** |
|-------------|-------------|-----------|---------|
| **HTTP** | `http.method` | GETã€POST | HTTPè¯·æ±‚æ–¹æ³• |
| **HTTP** | `http.status_code` | 200ã€404 | HTTPçŠ¶æ€ç  |
| **æ•°æ®åº“** | `db.system` | mysqlã€redis | æ•°æ®åº“ç±»å‹ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | `messaging.system` | rabbitmq | æ¶ˆæ¯ç³»ç»Ÿ |

**ğŸ’¡ ä½¿ç”¨æ ‡å‡†æ ‡ç­¾çš„å¥½å¤„**
- ä¸åŒå›¢é˜Ÿçš„è¿½è¸ªæ•°æ®æ ¼å¼ç»Ÿä¸€
- ç›‘æ§å¤§ç›˜å¯ä»¥æ ‡å‡†åŒ–
- åˆ‡æ¢è¿½è¸ªåç«¯æ— éœ€ä¿®æ”¹åº”ç”¨ä»£ç 

---

## 6. ğŸ­ Braveè¿½è¸ªç»„ä»¶



### 6.1 Braveæ ¸å¿ƒæ¦‚å¿µ



**ğŸ”¸ Braveæ˜¯ä»€ä¹ˆ**
Braveæ˜¯Twitterå¼€æºçš„Javaåˆ†å¸ƒå¼è¿½è¸ªåº“ï¼Œå°±åƒä¸€ä¸ª**ä¸“ä¸šæ‘„å½±å¸ˆ**ï¼Œä¸“é—¨è´Ÿè´£æ•æ‰å’Œè®°å½•è¯·æ±‚åœ¨ç³»ç»Ÿä¸­çš„"æ¯ä¸€ä¸ªç¬é—´"ã€‚

**âš¡ Braveçš„ç‰¹ç‚¹**
- **æ€§èƒ½ä¼˜å¼‚**ï¼šä¸“ä¸ºé«˜æ€§èƒ½åœºæ™¯è®¾è®¡
- **å†…å­˜å‹å¥½**ï¼šè¿½è¸ªæ•°æ®å ç”¨å†…å­˜å°
- **é›†æˆå¹¿æ³›**ï¼šæ”¯æŒä¸»æµJavaæ¡†æ¶

### 6.2 æ ¸å¿ƒAPIä½¿ç”¨



**ğŸ¯ åŸºç¡€è¿½è¸ªæ“ä½œ**
```java
@Component
public class PaymentTracer {
    
    private final Tracing tracing;
    private final Tracer tracer;
    
    public PaymentTracer(Tracing tracing) {
        this.tracing = tracing;
        this.tracer = tracing.tracer();
    }
    
    public PaymentResult processPayment(PaymentRequest request) {
        Span span = tracer.nextSpan()
            .name("payment-process")
            .tag("payment.method", request.getMethod())
            .tag("payment.amount", request.getAmount().toString())
            .start();
            
        try (SpanInScope scope = tracer.withSpanInScope(span)) {
            // æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†
            Thread.sleep(100);
            
            PaymentResult result = doPayment(request);
            span.tag("payment.result", result.getStatus());
            
            return result;
        } catch (Exception e) {
            span.tag("error", e.getMessage());
            throw new PaymentException("æ”¯ä»˜å¤±è´¥", e);
        } finally {
            span.finish();
        }
    }
}
```

### 6.3 è‡ªå®šä¹‰é‡‡æ ·å™¨



**ğŸ² ä¸šåŠ¡ç›¸å…³çš„é‡‡æ ·ç­–ç•¥**
```java
@Configuration
public class TracingConfiguration {
    
    @Bean
    public Sampler customSampler() {
        return new Sampler() {
            @Override
            public Decision sample(TraceContext traceContext) {
                String serviceName = traceContext.localServiceName();
                
                // VIPç”¨æˆ·è¯·æ±‚å…¨éƒ¨é‡‡æ ·
                if (isVipUser(traceContext)) {
                    return Decision.SAMPLED;
                }
                
                // é”™è¯¯è¯·æ±‚å…¨éƒ¨é‡‡æ ·
                if (hasError(traceContext)) {
                    return Decision.SAMPLED;
                }
                
                // å…¶ä»–è¯·æ±‚10%é‡‡æ ·
                return Math.random() < 0.1 ? Decision.SAMPLED : Decision.NOT_SAMPLED;
            }
        };
    }
}
```

---

## 7. ğŸ“Š Zipkinå¯è§†åŒ–è¿½è¸ª



### 7.1 Zipkinç³»ç»Ÿä»‹ç»



**ğŸ”¸ Zipkinæ˜¯ä»€ä¹ˆ**
Zipkinæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œå°±åƒä¸€ä¸ª**ä¸“ä¸šçš„ä¾¦æ¢**ï¼Œå¸®ä½ æŸ¥çœ‹è¯·æ±‚çš„"ä½œæ¡ˆè¿‡ç¨‹"å’Œ"æ—¶é—´çº¿"ã€‚

**ğŸ¯ Zipkinçš„æ ¸å¿ƒåŠŸèƒ½**
- **é“¾è·¯å¯è§†åŒ–**ï¼šä»¥æ—¶é—´è½´å½¢å¼å±•ç¤ºè°ƒç”¨é“¾è·¯
- **æ€§èƒ½åˆ†æ**ï¼šè¯†åˆ«è€—æ—¶æœ€é•¿çš„æœåŠ¡è°ƒç”¨
- **ä¾èµ–å…³ç³»å›¾**ï¼šå±•ç¤ºæœåŠ¡é—´çš„ä¾èµ–å…³ç³»
- **é”™è¯¯è¿½è¸ª**ï¼šå¿«é€Ÿå®šä½å¼‚å¸¸å‘ç”Ÿä½ç½®

### 7.2 Zipkinå®‰è£…éƒ¨ç½²



**ğŸ³ Dockerå¿«é€Ÿå¯åŠ¨**
```bash
# å¯åŠ¨ZipkinæœåŠ¡å™¨

docker run -d -p 9411:9411 openzipkin/zipkin

# è®¿é—®Webç•Œé¢

http://localhost:9411
```

**âš™ï¸ åº”ç”¨è¿æ¥é…ç½®**
```yaml
spring:
  sleuth:
    zipkin:
      base-url: http://localhost:9411
    sampler:
      probability: 1.0  # å¼€å‘ç¯å¢ƒ100%é‡‡æ ·
```

### 7.3 Zipkinç•Œé¢åŠŸèƒ½



**ğŸ–¥ï¸ Webç•Œé¢ä¸»è¦åŠŸèƒ½**

| **åŠŸèƒ½é¡µé¢** | **ç”¨é€”** | **å…³é”®ä¿¡æ¯** |
|-------------|---------|-------------|
| **æœç´¢é¡µé¢** | æŸ¥è¯¢ç‰¹å®šæ—¶é—´æ®µçš„Trace | æœåŠ¡åã€è€—æ—¶ã€æ ‡ç­¾è¿‡æ»¤ |
| **é“¾è·¯è¯¦æƒ…** | æŸ¥çœ‹å•ä¸ªTraceçš„è¯¦ç»†è°ƒç”¨é“¾ | æ—¶åºå›¾ã€è€—æ—¶åˆ†æ |
| **ä¾èµ–åˆ†æ** | å±•ç¤ºæœåŠ¡é—´è°ƒç”¨å…³ç³» | ä¾èµ–å›¾ã€è°ƒç”¨é‡ç»Ÿè®¡ |
| **æ€§èƒ½åˆ†æ** | è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ | å¹³å‡è€—æ—¶ã€P99å»¶è¿Ÿ |

**ğŸ” å®ç”¨æŸ¥è¯¢æŠ€å·§**
```
æŸ¥è¯¢è¯­æ³•ç¤ºä¾‹ï¼š
- serviceName=order-service  // æŸ¥è¯¢ç‰¹å®šæœåŠ¡
- minDuration=100ms         // æŸ¥è¯¢è€—æ—¶è¶…è¿‡100msçš„è¯·æ±‚  
- error                     // æŸ¥è¯¢åŒ…å«é”™è¯¯çš„è¯·æ±‚
- tag=userId:12345          // æŸ¥è¯¢ç‰¹å®šç”¨æˆ·çš„è¯·æ±‚
```

---

## 8. ğŸ›°ï¸ SkyWalking APMç›‘æ§



### 8.1 SkyWalkingå¹³å°ä»‹ç»



**ğŸ”¸ SkyWalkingæ˜¯ä»€ä¹ˆ**
SkyWalkingæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¶çº§é¡¹ç›®ï¼Œä¸“ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿå’Œå®¹å™¨åŒ–æ¶æ„è®¾è®¡çš„**APMï¼ˆåº”ç”¨æ€§èƒ½ç›‘æ§ï¼‰å¹³å°**ã€‚

**ğŸ’¡ ä¸Zipkinçš„åŒºåˆ«**
- **Zipkin**ï¼šä¸“æ³¨äºåˆ†å¸ƒå¼è¿½è¸ªï¼Œåƒ"æ”¾å¤§é•œ"
- **SkyWalking**ï¼šå…¨æ–¹ä½APMå¹³å°ï¼Œåƒ"ä½“æ£€ä¸­å¿ƒ"

**ğŸŒŸ SkyWalkingä¼˜åŠ¿**
- **æ— ä¾µå…¥éƒ¨ç½²**ï¼šJava Agentæ–¹å¼ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šJavaã€.NETã€Pythonã€Goã€PHP
- **ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡**ï¼šé™¤äº†é“¾è·¯è¿½è¸ªè¿˜æœ‰JVMç›‘æ§ã€æ•°æ®åº“æ€§èƒ½ç­‰

### 8.2 SkyWalkingéƒ¨ç½²



**ğŸš€ å®Œæ•´éƒ¨ç½²ç¤ºä¾‹**
```bash
# 1. å¯åŠ¨Elasticsearchï¼ˆæ•°æ®å­˜å‚¨ï¼‰

docker run -d --name elasticsearch \
  -p 9200:9200 -e "discovery.type=single-node" \
  elasticsearch:7.15.0

# 2. å¯åŠ¨SkyWalking OAPï¼ˆæ•°æ®å¤„ç†ï¼‰

docker run -d --name skywalking-oap \
  -e SW_STORAGE=elasticsearch \
  -e SW_STORAGE_ES_CLUSTER_NODES=localhost:9200 \
  -p 11800:11800 -p 12800:12800 \
  apache/skywalking-oap-server:8.9.1

# 3. å¯åŠ¨SkyWalking UIï¼ˆWebç•Œé¢ï¼‰

docker run -d --name skywalking-ui \
  -e SW_OAP_ADDRESS=http://localhost:12800 \
  -p 8080:8080 \
  apache/skywalking-ui:8.9.1
```

### 8.3 Javaåº”ç”¨æ¥å…¥



**ğŸ“ Agentæ–¹å¼æ¥å…¥**
```bash
# 1. ä¸‹è½½SkyWalking Agent

wget https://downloads.apache.org/skywalking/8.9.1/apache-skywalking-apm-8.9.1.tar.gz

# 2. å¯åŠ¨åº”ç”¨æ—¶æ·»åŠ Agentå‚æ•°

java -javaagent:/path/to/skywalking-agent.jar \
     -Dskywalking.agent.service_name=order-service \
     -Dskywalking.collector.backend_service=localhost:11800 \
     -jar order-service.jar
```

**âš™ï¸ Agenté…ç½®æ–‡ä»¶**
```properties
# agent/config/agent.config

agent.service_name=order-service
collector.backend_service=localhost:11800

# é‡‡æ ·é…ç½®

agent.sample_n_per_3_secs=9
```

---

## 9. ğŸ”¬ Jaegerè¿½è¸ªç³»ç»Ÿ



### 9.1 Jaegerç³»ç»Ÿç‰¹ç‚¹



**ğŸ”¸ Jaegeræ˜¯ä»€ä¹ˆ**
Jaegeræ˜¯Uberå¼€æºçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œç°åœ¨æ˜¯CNCFçš„æ¯•ä¸šé¡¹ç›®ï¼Œå°±åƒä¸€ä¸ª**ä¸“ä¸šçš„æ•°æ®åˆ†æå¸ˆ**ï¼Œå¸®ä½ åˆ†æç³»ç»Ÿçš„è°ƒç”¨æ¨¡å¼ã€‚

**â­ Jaegerçš„ä¼˜åŠ¿**
- **äº‘åŸç”Ÿè®¾è®¡**ï¼šä¸ºKubernetesç¯å¢ƒä¼˜åŒ–
- **å¼ºå¤§çš„æŸ¥è¯¢åŠŸèƒ½**ï¼šæ”¯æŒå¤æ‚çš„æœç´¢å’Œè¿‡æ»¤
- **é«˜å¯ç”¨æ¶æ„**ï¼šæ”¯æŒé›†ç¾¤éƒ¨ç½²
- **OpenTelemetryå…¼å®¹**ï¼šå®Œå…¨æ”¯æŒOpenTelemetryæ ‡å‡†

### 9.2 Jaegeræ¶æ„ç»„ä»¶



**ğŸ—ï¸ Jaegerå®Œæ•´æ¶æ„**
```
åº”ç”¨ç¨‹åº â†’ Jaeger Client â†’ Jaeger Agent â†’ Jaeger Collector â†’ å­˜å‚¨åç«¯ â†’ Jaeger Query UI
                            â†“
                       Jaeger Ingester (Kafkaå¯é€‰)
```

**ğŸ“‹ ç»„ä»¶è¯´æ˜**

| **ç»„ä»¶åç§°** | **ä½œç”¨** | **éƒ¨ç½²ä½ç½®** |
|-------------|---------|-------------|
| **Jaeger Client** | ç”Ÿæˆè¿½è¸ªæ•°æ® | åº”ç”¨ç¨‹åºå†… |
| **Jaeger Agent** | æ”¶é›†æœ¬æœºè¿½è¸ªæ•°æ® | æ¯å°ä¸»æœº |
| **Jaeger Collector** | èšåˆå¤„ç†è¿½è¸ªæ•°æ® | é›†ä¸­éƒ¨ç½² |
| **å­˜å‚¨åç«¯** | æŒä¹…åŒ–è¿½è¸ªæ•°æ® | Elasticsearchã€Cassandra |

### 9.3 Spring Booté›†æˆJaeger



**ğŸš€ å¿«é€Ÿé›†æˆé…ç½®**
```xml
<!-- Jaegerå®¢æˆ·ç«¯ -->
<dependency>
    <groupId>io.jaegertracing</groupId>
    <artifactId>jaeger-client</artifactId>
</dependency>
```

```yaml
# application.yml

opentracing:
  jaeger:
    service-name: order-service
    sampler:
      type: const
      param: 1  # 100%é‡‡æ ·
    reporter:
      log-spans: false
      sender:
        agent-host: localhost
        agent-port: 6831
```

**ğŸ”§ ç¨‹åºåŒ–é…ç½®**
```java
@Configuration
public class JaegerConfig {
    
    @Bean
    public JaegerTracer jaegerTracer() {
        return Configuration.fromEnv("order-service")
            .withSampler(Configuration.SamplerConfiguration.fromEnv()
                .withType(ConstSampler.TYPE)
                .withParam(1))
            .withReporter(Configuration.ReporterConfiguration.fromEnv()
                .withLogSpans(true)
                .withFlushInterval(1000)
                .withMaxQueueSize(10000))
            .getTracer();
    }
}
```

---

## 10. ğŸ“ˆ é“¾è·¯æ•°æ®æ”¶é›†ä¸åˆ†æ



### 10.1 æ•°æ®æ”¶é›†ç­–ç•¥



**ğŸ“Š å¤šç»´åº¦æ•°æ®æ”¶é›†**
ç°ä»£å¾®æœåŠ¡è¿½è¸ªä¸åªæ˜¯è®°å½•è°ƒç”¨è·¯å¾„ï¼Œè¿˜è¦æ”¶é›†ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

**ğŸ¯ å…³é”®æ•°æ®ç»´åº¦**
- **æ—¶é—´ç»´åº¦**ï¼šå¼€å§‹æ—¶é—´ã€æŒç»­æ—¶é—´ã€ç»“æŸæ—¶é—´
- **ç©ºé—´ç»´åº¦**ï¼šæœåŠ¡åã€ä¸»æœºåã€å®¹å™¨ID
- **ä¸šåŠ¡ç»´åº¦**ï¼šç”¨æˆ·IDã€è®¢å•IDã€ä¸šåŠ¡ç±»å‹
- **æŠ€æœ¯ç»´åº¦**ï¼šHTTPçŠ¶æ€ç ã€æ•°æ®åº“ç±»å‹ã€æ¶ˆæ¯é˜Ÿåˆ—

**ğŸ’¡ æ•°æ®æ”¶é›†æœ€ä½³å®è·µ**
```java
// ä¸°å¯Œçš„æ ‡ç­¾ä¿¡æ¯æ”¶é›†
@Component
public class OrderTraceEnricher {
    
    public void enrichTrace(Span span, OrderContext context) {
        // ä¸šåŠ¡æ ‡ç­¾
        span.setTag("business.user_id", context.getUserId());
        span.setTag("business.order_type", context.getOrderType());
        span.setTag("business.amount", context.getAmount().toString());
        
        // æŠ€æœ¯æ ‡ç­¾  
        span.setTag("service.version", getServiceVersion());
        span.setTag("deployment.env", getEnvironment());
        span.setTag("instance.id", getInstanceId());
        
        // æ€§èƒ½æ ‡ç­¾
        span.setTag("performance.cpu_usage", getCpuUsage());
        span.setTag("performance.memory_usage", getMemoryUsage());
    }
}
```

### 10.2 é“¾è·¯æ•°æ®åˆ†ææ–¹æ³•



**ğŸ” å¸¸è§åˆ†æç»´åº¦**

| **åˆ†æç±»å‹** | **åˆ†æç›®æ ‡** | **å…³é”®æŒ‡æ ‡** | **åº”ç”¨ä»·å€¼** |
|-------------|-------------|-------------|-------------|
| **æ€§èƒ½åˆ†æ** | è¯†åˆ«æ…¢è°ƒç”¨ | P95ã€P99å»¶è¿Ÿ | ğŸš€ æ€§èƒ½ä¼˜åŒ– |
| **é”™è¯¯åˆ†æ** | å®šä½æ•…éšœç‚¹ | é”™è¯¯ç‡ã€é”™è¯¯åˆ†å¸ƒ | ğŸ”¥ æ•…éšœå¤„ç† |
| **å®¹é‡åˆ†æ** | è¯„ä¼°ç³»ç»Ÿè´Ÿè½½ | QPSã€å¹¶å‘æ•° | ğŸ“Š å®¹é‡è§„åˆ’ |
| **ä¾èµ–åˆ†æ** | ç†è§£æœåŠ¡å…³ç³» | è°ƒç”¨é¢‘æ¬¡ã€ä¾èµ–æ·±åº¦ | ğŸ—ï¸ æ¶æ„ä¼˜åŒ– |

**ğŸ“ˆ å®ç”¨åˆ†ææŸ¥è¯¢**
```sql
-- æŸ¥è¯¢æœ€æ…¢çš„10ä¸ªæœåŠ¡è°ƒç”¨ï¼ˆä»¥Zipkinä¸ºä¾‹ï¼‰
SELECT 
    serviceName,
    operationName,
    AVG(duration) as avg_duration,
    COUNT(*) as call_count
FROM spans 
WHERE timestamp > DATE_SUB(NOW(), INTERVAL 1 HOUR)
GROUP BY serviceName, operationName
ORDER BY avg_duration DESC
LIMIT 10;

-- æŸ¥è¯¢é”™è¯¯ç‡æœ€é«˜çš„æœåŠ¡
SELECT 
    serviceName,
    COUNT(CASE WHEN tags LIKE '%error%' THEN 1 END) * 100.0 / COUNT(*) as error_rate
FROM spans
WHERE timestamp > DATE_SUB(NOW(), INTERVAL 1 HOUR)
GROUP BY serviceName
ORDER BY error_rate DESC;
```

### 10.3 å®æ—¶æ•°æ®æµå¤„ç†



**âš¡ æµå¼æ•°æ®å¤„ç†æ¶æ„**
```
è¿½è¸ªæ•°æ® â†’ Kafka â†’ Streamå¤„ç† â†’ å®æ—¶æŒ‡æ ‡ â†’ å‘Šè­¦ç³»ç»Ÿ
                     â†“
                  æŒä¹…åŒ–å­˜å‚¨ â†’ æ‰¹é‡åˆ†æ â†’ æŠ¥è¡¨ç³»ç»Ÿ
```

**ğŸ”§ å®æ—¶å¤„ç†ç¤ºä¾‹**
```java
@Component
public class TraceStreamProcessor {
    
    @StreamListener("trace-input")
    public void processTraceData(TraceData trace) {
        // å®æ—¶è®¡ç®—æœåŠ¡å“åº”æ—¶é—´
        if (trace.getDuration() > Duration.ofMillis(1000)) {
            alertService.sendSlowCallAlert(trace);
        }
        
        // å®æ—¶æ›´æ–°æœåŠ¡å¥åº·åº¦
        serviceHealthService.updateHealth(
            trace.getServiceName(), 
            trace.isSuccess()
        );
        
        // å®æ—¶ç»Ÿè®¡è°ƒç”¨é‡
        metricsService.incrementCounter(
            "service.calls.total",
            "service", trace.getServiceName()
        );
    }
}
```

---

## 11. ğŸ¯ æ€§èƒ½åˆ†æä¸ä¼˜åŒ–



### 11.1 æ€§èƒ½ç“¶é¢ˆè¯†åˆ«



**ğŸ” å¸¸è§æ€§èƒ½ç“¶é¢ˆç±»å‹**

| **ç“¶é¢ˆç±»å‹** | **å…¸å‹ç‰¹å¾** | **è¯†åˆ«æ–¹æ³•** | **ä¼˜åŒ–æ–¹å‘** |
|-------------|-------------|-------------|-------------|
| **ç½‘ç»œå»¶è¿Ÿ** | è·¨åœ°åŸŸè°ƒç”¨æ…¢ | åœ°ç†ä½ç½®åˆ†æ | ğŸŒ CDNã€å°±è¿‘éƒ¨ç½² |
| **æ•°æ®åº“æ…¢æŸ¥è¯¢** | DBæ“ä½œè€—æ—¶é•¿ | SQLæ‰§è¡Œæ—¶é—´åˆ†æ | ğŸ—ƒï¸ ç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ– |
| **ä¸²è¡Œè°ƒç”¨** | æ€»æ—¶é—´=å„ç¯èŠ‚æ—¶é—´ä¹‹å’Œ | è°ƒç”¨æ—¶åºåˆ†æ | âš¡ å¹¶è¡ŒåŒ–æ”¹é€  |
| **èµ„æºç«äº‰** | é«˜å¹¶å‘ä¸‹å“åº”æ…¢ | å¹¶å‘æ•°vså“åº”æ—¶é—´ | ğŸ”„ æ± åŒ–ã€å¼‚æ­¥åŒ– |

**ğŸ“Š æ€§èƒ½åˆ†æå®æˆ˜**
```java
@Service
public class PerformanceAnalyzer {
    
    public PerformanceReport analyzeService(String serviceName, Duration period) {
        List<Span> spans = traceRepository.findByServiceAndPeriod(serviceName, period);
        
        return PerformanceReport.builder()
            .serviceName(serviceName)
            .totalCalls(spans.size())
            .averageLatency(calculateAverageLatency(spans))
            .p95Latency(calculatePercentile(spans, 95))
            .p99Latency(calculatePercentile(spans, 99))
            .errorRate(calculateErrorRate(spans))
            .topSlowOperations(findSlowOperations(spans, 10))
            .build();
    }
    
    private List<SlowOperation> findSlowOperations(List<Span> spans, int limit) {
        return spans.stream()
            .collect(Collectors.groupingBy(
                span -> span.getOperationName(),
                Collectors.averagingLong(Span::getDuration)
            ))
            .entrySet().stream()
            .sorted(Map.Entry.<String, Double>comparingByValue().reversed())
            .limit(limit)
            .map(entry -> new SlowOperation(entry.getKey(), entry.getValue()))
            .collect(Collectors.toList());
    }
}
```

### 11.2 ä¼˜åŒ–ç­–ç•¥å®æ–½



**ğŸš€ åˆ†å±‚ä¼˜åŒ–ç­–ç•¥**

**1ï¸âƒ£ åº”ç”¨å±‚ä¼˜åŒ–**
```java
// å¹¶è¡Œè°ƒç”¨ä¼˜åŒ–
@Service  
public class OrderService {
    
    public OrderDTO createOrder(OrderRequest request) {
        // ä¸²è¡Œè°ƒç”¨ - ä¼˜åŒ–å‰
        // UserInfo user = userService.getUser(request.getUserId());      // 100ms
        // ProductInfo product = productService.getProduct(request.getProductId()); // 150ms
        // InventoryInfo inventory = inventoryService.checkInventory(request.getProductId()); // 80ms
        // æ€»è€—æ—¶ï¼š330ms
        
        // å¹¶è¡Œè°ƒç”¨ - ä¼˜åŒ–å
        CompletableFuture<UserInfo> userFuture = CompletableFuture.supplyAsync(
            () -> userService.getUser(request.getUserId())
        );
        
        CompletableFuture<ProductInfo> productFuture = CompletableFuture.supplyAsync(
            () -> productService.getProduct(request.getProductId())
        );
        
        CompletableFuture<InventoryInfo> inventoryFuture = CompletableFuture.supplyAsync(
            () -> inventoryService.checkInventory(request.getProductId())
        );
        
        // ç­‰å¾…æ‰€æœ‰è°ƒç”¨å®Œæˆï¼Œæ€»è€—æ—¶ï¼š150msï¼ˆæœ€æ…¢çš„é‚£ä¸ªï¼‰
        CompletableFuture.allOf(userFuture, productFuture, inventoryFuture).join();
        
        return buildOrder(userFuture.get(), productFuture.get(), inventoryFuture.get());
    }
}
```

**2ï¸âƒ£ ç¼“å­˜å±‚ä¼˜åŒ–**
```java
@Service
public class ProductService {
    
    @Cacheable(value = "products", key = "#productId")
    public ProductInfo getProduct(Long productId) {
        // è¿½è¸ªç¼“å­˜å‘½ä¸­æƒ…å†µ
        Span span = tracer.nextSpan().name("get-product-from-db").start();
        try {
            return productRepository.findById(productId);
        } finally {
            span.tag("cache.hit", "false");  // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
            span.end();
        }
    }
}
```

**3ï¸âƒ£ æ•°æ®åº“å±‚ä¼˜åŒ–**
```java
// æ‰¹é‡æ“ä½œä¼˜åŒ–
@Repository
public class OrderRepository {
    
    // ä¼˜åŒ–å‰ï¼šN+1æŸ¥è¯¢é—®é¢˜
    public List<OrderInfo> getOrdersWithDetails(List<Long> orderIds) {
        return orderIds.stream()
            .map(this::findOrderWithDetails)  // æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“
            .collect(Collectors.toList());
    }
    
    // ä¼˜åŒ–åï¼šæ‰¹é‡æŸ¥è¯¢
    public List<OrderInfo> getOrdersWithDetailsBatch(List<Long> orderIds) {
        Span span = tracer.nextSpan().name("batch-query-orders").start();
        try {
            // ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰è®¢å•
            List<Order> orders = orderRepository.findAllById(orderIds);
            List<Long> allDetailIds = orders.stream()
                .flatMap(order -> order.getDetailIds().stream())
                .collect(Collectors.toList());
                
            // ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰è¯¦æƒ…
            List<OrderDetail> details = orderDetailRepository.findAllById(allDetailIds);
            
            return buildOrderInfos(orders, details);
        } finally {
            span.tag("batch.size", String.valueOf(orderIds.size()));
            span.end();
        }
    }
}
```

### 11.3 æŒç»­æ€§èƒ½ç›‘æ§



**ğŸ“Š å»ºç«‹æ€§èƒ½åŸºçº¿**
```java
@Component
public class PerformanceBaseline {
    
    @Scheduled(fixedRate = 300000)  // æ¯5åˆ†é’Ÿæ”¶é›†ä¸€æ¬¡åŸºçº¿æ•°æ®
    public void collectPerformanceBaseline() {
        Map<String, ServiceMetrics> currentMetrics = collectCurrentMetrics();
        
        for (Map.Entry<String, ServiceMetrics> entry : currentMetrics.entrySet()) {
            String serviceName = entry.getKey();
            ServiceMetrics metrics = entry.getValue();
            
            // ä¸å†å²åŸºçº¿å¯¹æ¯”
            ServiceBaseline baseline = baselineRepository.findByServiceName(serviceName);
            if (baseline != null) {
                double latencyIncrease = (metrics.getAvgLatency() - baseline.getAvgLatency()) 
                    / baseline.getAvgLatency();
                    
                // æ€§èƒ½ä¸‹é™è¶…è¿‡30%åˆ™å‘Šè­¦
                if (latencyIncrease > 0.3) {
                    alertService.sendPerformanceAlert(
                        serviceName, 
                        "å¹³å‡å»¶è¿Ÿå¢åŠ " + (latencyIncrease * 100) + "%"
                    );
                }
            }
            
            // æ›´æ–°åŸºçº¿æ•°æ®
            updateBaseline(serviceName, metrics);
        }
    }
}
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 12.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ é“¾è·¯è¿½è¸ªæœ¬è´¨ï¼šè®°å½•è¯·æ±‚åœ¨å¾®æœåŠ¡é—´çš„å®Œæ•´æµè½¬è·¯å¾„
ğŸ”¸ Traceå’ŒSpanï¼šTraceæ˜¯æ•´æ¡é“¾è·¯ï¼ŒSpanæ˜¯å•ä¸ªæ“ä½œ
ğŸ”¸ TraceIdä¼ æ’­ï¼šé€šè¿‡HTTPå¤´ç­‰æ–¹å¼åœ¨æœåŠ¡é—´ä¼ é€’è¿½è¸ªä¿¡æ¯
ğŸ”¸ é‡‡æ ·ç­–ç•¥ï¼šå¹³è¡¡è¿½è¸ªå®Œæ•´æ€§å’Œç³»ç»Ÿæ€§èƒ½çš„å…³é”®æœºåˆ¶
ğŸ”¸ æ ‡ç­¾æ ‡å‡†åŒ–ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ ‡ç­¾è§„èŒƒä¾¿äºåˆ†æå’ŒæŸ¥è¯¢
```

### 12.2 å…³é”®æŠ€æœ¯é€‰å‹å¯¹æ¯”



| **æŠ€æœ¯æ–¹æ¡ˆ** | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** |
|-------------|-------------|---------|---------|
| **Sleuth + Zipkin** | Spring Cloudå¾®æœåŠ¡ | âœ… é›¶ä¾µå…¥ã€æ˜“ä¸Šæ‰‹ | âŒ åŠŸèƒ½ç›¸å¯¹åŸºç¡€ |
| **SkyWalking** | ä¼ä¸šçº§APMéœ€æ±‚ | âœ… åŠŸèƒ½å…¨é¢ã€æ— ä¾µå…¥ | âŒ èµ„æºæ¶ˆè€—è¾ƒå¤§ |
| **Jaeger** | äº‘åŸç”Ÿç¯å¢ƒ | âœ… æŸ¥è¯¢å¼ºå¤§ã€å¯æ‰©å±• | âŒ é…ç½®å¤æ‚ |
| **OpenTelemetry** | å¤šå‚å•†å…¼å®¹ | âœ… æ ‡å‡†åŒ–ã€æœªæ¥è¶‹åŠ¿ | âŒ ç”Ÿæ€è¿˜åœ¨å®Œå–„ |

### 12.3 å®æ–½æœ€ä½³å®è·µ



**ğŸ¯ è¿½è¸ªç³»ç»Ÿå»ºè®¾è·¯å¾„**
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå¼•å…¥Sleuthï¼Œå®ç°åŸºç¡€é“¾è·¯è¿½è¸ª
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šéƒ¨ç½²Zipkinï¼Œè·å¾—å¯è§†åŒ–èƒ½åŠ›
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šä¼˜åŒ–é‡‡æ ·ç­–ç•¥ï¼Œå¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®Œæ•´æ€§
4. **ç¬¬å››é˜¶æ®µ**ï¼šå»ºç«‹ç›‘æ§å‘Šè­¦ï¼Œå®ç°ä¸»åŠ¨è¿ç»´

**âš ï¸ å¸¸è§é”™è¯¯é¿å…**
- **è¿‡åº¦é‡‡æ ·**ï¼šç”Ÿäº§ç¯å¢ƒä¸è¦100%é‡‡æ ·ï¼Œå»ºè®®1-10%
- **æ ‡ç­¾æ»¥ç”¨**ï¼šé¿å…åœ¨æ ‡ç­¾ä¸­æ”¾å…¥é«˜åŸºæ•°å€¼ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰
- **åŒæ­¥å‘é€**ï¼šè¿½è¸ªæ•°æ®åº”å¼‚æ­¥å‘é€ï¼Œé¿å…å½±å“ä¸šåŠ¡å“åº”
- **å¿½ç•¥æ€§èƒ½**ï¼šè¿½è¸ªç³»ç»Ÿæœ¬èº«ä¹Ÿè¦ç›‘æ§ï¼Œé¿å…æˆä¸ºæ€§èƒ½ç“¶é¢ˆ

### 12.4 å­¦ä¹ è¿›é˜¶è·¯çº¿



**ğŸ“š æ¨èå­¦ä¹ é¡ºåº**
1. **åŸºç¡€ç†è§£**ï¼šåˆ†å¸ƒå¼è¿½è¸ªåŸç†å’Œæ ¸å¿ƒæ¦‚å¿µ
2. **åŠ¨æ‰‹å®è·µ**ï¼šæ­å»ºSleuth + Zipkinç¯å¢ƒ
3. **æ·±å…¥åº”ç”¨**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨é“¾è·¯è¿½è¸ª
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå­¦ä¹ é‡‡æ ·ç­–ç•¥å’Œæ€§èƒ½è°ƒä¼˜
5. **è¿ç»´ç›‘æ§**ï¼šå»ºç«‹è¿½è¸ªç³»ç»Ÿçš„ç›‘æ§å’Œå‘Šè­¦

**ğŸ”§ å®è·µé¡¹ç›®å»ºè®®**
```
é¡¹ç›®1ï¼šç”µå•†ä¸‹å•é“¾è·¯è¿½è¸ª
æ¶‰åŠæœåŠ¡ï¼šç”¨æˆ·æœåŠ¡ã€å•†å“æœåŠ¡ã€åº“å­˜æœåŠ¡ã€è®¢å•æœåŠ¡ã€æ”¯ä»˜æœåŠ¡
å­¦ä¹ é‡ç‚¹ï¼šå¤šæœåŠ¡è°ƒç”¨é“¾åˆ†æã€æ€§èƒ½ç“¶é¢ˆè¯†åˆ«

é¡¹ç›®2ï¼šç§’æ€ç³»ç»Ÿè¿½è¸ª
æ¶‰åŠæŠ€æœ¯ï¼šé«˜å¹¶å‘ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—
å­¦ä¹ é‡ç‚¹ï¼šé«˜QPSåœºæ™¯ä¸‹çš„é‡‡æ ·ç­–ç•¥ã€å¼‚æ­¥è°ƒç”¨è¿½è¸ª

é¡¹ç›®3ï¼šå¤šè¯­è¨€å¾®æœåŠ¡è¿½è¸ª
æ¶‰åŠæŠ€æœ¯ï¼šJavaã€Pythonã€Goå¾®æœåŠ¡æ··åˆ
å­¦ä¹ é‡ç‚¹ï¼šOpenTelemetryæ ‡å‡†åŒ–è¿½è¸ª
```

### 12.5 æ ¸å¿ƒå­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ¯ åŸºç¡€èƒ½åŠ›æ£€æŸ¥**
- [ ] ç†è§£Traceã€Spanã€TraceIdç­‰æ ¸å¿ƒæ¦‚å¿µ
- [ ] èƒ½å¤Ÿé…ç½®Spring Bootåº”ç”¨çš„é“¾è·¯è¿½è¸ª
- [ ] ä¼šä½¿ç”¨Zipkinç•Œé¢è¿›è¡Œé“¾è·¯æŸ¥è¯¢å’Œåˆ†æ
- [ ] äº†è§£ä¸åŒé‡‡æ ·ç­–ç•¥çš„é€‚ç”¨åœºæ™¯

**ğŸš€ è¿›é˜¶èƒ½åŠ›æ£€æŸ¥**
- [ ] èƒ½å¤Ÿè®¾è®¡åˆç†çš„é‡‡æ ·ç­–ç•¥
- [ ] ä¼šåˆ†æé“¾è·¯æ•°æ®è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- [ ] èƒ½å¤Ÿå»ºç«‹è¿½è¸ªç³»ç»Ÿçš„ç›‘æ§å‘Šè­¦
- [ ] äº†è§£OpenTelemetryæ ‡å‡†å’Œæœ€ä½³å®è·µ

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> é“¾è·¯è¿½è¸ªè§‚å…¨å±€ï¼ŒTraceIdè´¯ç©¿å§‹å’Œç»ˆ
> Spanè®°å½•æ¯æ“ä½œï¼Œæ ‡ç­¾ä¸°å¯Œä¾¿åˆ†æ  
> é‡‡æ ·ç­–ç•¥è¦åˆç†ï¼Œæ€§èƒ½ç›‘æ§ä¸èƒ½å¿˜
> å·¥å…·é€‰æ‹©çœ‹åœºæ™¯ï¼Œæ ‡å‡†å…¼å®¹æ˜¯è¶‹åŠ¿

**ğŸ’¡ å­¦ä¹ å»ºè®®**
- å…ˆç†è§£æ¦‚å¿µï¼Œå†åŠ¨æ‰‹å®è·µ
- ä»ç®€å•åœºæ™¯å¼€å§‹ï¼Œé€æ­¥å¤æ‚åŒ–
- é‡è§†æ€§èƒ½å½±å“ï¼Œè¿½è¸ªä¸èƒ½æ‹–å®ä¸šåŠ¡
- å…³æ³¨æ–°æŠ€æœ¯å‘å±•ï¼ŒOpenTelemetryæ˜¯æœªæ¥æ–¹å‘