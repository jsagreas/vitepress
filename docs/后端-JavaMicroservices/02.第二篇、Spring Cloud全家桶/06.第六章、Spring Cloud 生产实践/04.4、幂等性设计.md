---
title: 4ã€å¹‚ç­‰æ€§è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [å¹‚ç­‰æ€§åŸºç¡€æ¦‚å¿µ](#1-å¹‚ç­‰æ€§åŸºç¡€æ¦‚å¿µ)
2. [å¹‚ç­‰æ€§åŸç†ä¸å¿…è¦æ€§](#2-å¹‚ç­‰æ€§åŸç†ä¸å¿…è¦æ€§)
3. [Tokenä»¤ç‰Œæœºåˆ¶](#3-Tokenä»¤ç‰Œæœºåˆ¶)
4. [æ•°æ®åº“å”¯ä¸€ç´¢å¼•æ–¹æ¡ˆ](#4-æ•°æ®åº“å”¯ä¸€ç´¢å¼•æ–¹æ¡ˆ)
5. [Redisåˆ†å¸ƒå¼é”å®ç°](#5-Redisåˆ†å¸ƒå¼é”å®ç°)
6. [çŠ¶æ€æœºè®¾è®¡](#6-çŠ¶æ€æœºè®¾è®¡)
7. [ä¸šåŠ¡å¹‚ç­‰ç­–ç•¥](#7-ä¸šåŠ¡å¹‚ç­‰ç­–ç•¥)
8. [æ¥å£å¹‚ç­‰å®ç°](#8-æ¥å£å¹‚ç­‰å®ç°)
9. [å¹‚ç­‰æ€§æµ‹è¯•](#9-å¹‚ç­‰æ€§æµ‹è¯•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¹‚ç­‰æ€§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§


**ğŸ’¡ é€šä¿—ç†è§£**ï¼šå¹‚ç­‰æ€§å°±åƒæŒ‰ç”µæ¢¯æŒ‰é’®ä¸€æ ·ï¼Œæ— è®ºä½ æŒ‰1æ¬¡è¿˜æ˜¯æŒ‰10æ¬¡ï¼Œç”µæ¢¯éƒ½åªä¼šæ¥1æ¬¡ã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œæ— è®ºè°ƒç”¨æ¥å£å¤šå°‘æ¬¡ï¼Œäº§ç”Ÿçš„ä¸šåŠ¡ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚

**ğŸ”¸ æ•°å­¦å®šä¹‰**ï¼šå¯¹äºå‡½æ•°fï¼Œå¦‚æœf(f(x)) = f(x)ï¼Œé‚£ä¹ˆå‡½æ•°få°±æ˜¯å¹‚ç­‰çš„ã€‚

**ğŸ”¸ HTTPä¸­çš„å¹‚ç­‰æ€§**ï¼š
```
GET    /api/users/123     â† å¹‚ç­‰ï¼šæŸ¥è¯¢å¤šæ¬¡ç»“æœç›¸åŒ
POST   /api/users         â† éå¹‚ç­‰ï¼šæ¯æ¬¡åˆ›å»ºæ–°ç”¨æˆ·
PUT    /api/users/123     â† å¹‚ç­‰ï¼šæ›´æ–°æ“ä½œå¯é‡å¤
DELETE /api/users/123     â† å¹‚ç­‰ï¼šåˆ é™¤å¤šæ¬¡æ•ˆæœç›¸åŒ
```

### 1.2 å¾®æœåŠ¡ä¸­çš„å¹‚ç­‰æ€§æŒ‘æˆ˜


**ğŸš¨ å¸¸è§é—®é¢˜åœºæ™¯**ï¼š
- **ç½‘ç»œè¶…æ—¶é‡è¯•**ï¼šç”¨æˆ·ç‚¹å‡»æäº¤æŒ‰é’®åï¼Œé¡µé¢æ— å“åº”ï¼Œç”¨æˆ·å¤šæ¬¡ç‚¹å‡»
- **æ¶ˆæ¯é‡å¤æ¶ˆè´¹**ï¼šMQæ¶ˆè´¹è€…å› ç½‘ç»œæŠ–åŠ¨é‡å¤æ¥æ”¶åŒä¸€æ¡æ¶ˆæ¯
- **æ¥å£é‡å¤è°ƒç”¨**ï¼šå‰ç«¯å› ç½‘ç»œé—®é¢˜é‡å¤å‘é€åŒä¸€ä¸ªè¯·æ±‚
- **å®šæ—¶ä»»åŠ¡é‡å¤æ‰§è¡Œ**ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®šæ—¶ä»»åŠ¡å¯èƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹åŒæ—¶è§¦å‘

**ğŸ“Š ä¸šåŠ¡å½±å“åˆ†æ**ï¼š

| åœºæ™¯ | ä¸åšå¹‚ç­‰çš„åæœ | ä¸šåŠ¡å½±å“ |
|------|----------------|----------|
| ğŸ›’ **è®¢å•æäº¤** | åˆ›å»ºå¤šä¸ªé‡å¤è®¢å• | ç”¨æˆ·è¢«å¤šæ¬¡æ‰£æ¬¾ |
| ğŸ’° **è½¬è´¦æ“ä½œ** | é‡å¤è½¬è´¦ | èµ„é‡‘æŸå¤± |
| ğŸ“§ **çŸ­ä¿¡å‘é€** | é‡å¤å‘é€éªŒè¯ç  | ç”¨æˆ·ä½“éªŒå·®ï¼Œæˆæœ¬å¢åŠ  |
| ğŸ“¦ **åº“å­˜æ‰£å‡** | é‡å¤æ‰£å‡åº“å­˜ | æ•°æ®ä¸ä¸€è‡´ |

---

## 2. ğŸ”§ å¹‚ç­‰æ€§åŸç†ä¸å¿…è¦æ€§


### 2.1 å¾®æœåŠ¡ç¯å¢ƒçš„å¤æ‚æ€§


**ğŸŒ åˆ†å¸ƒå¼ç³»ç»Ÿç‰¹ç‚¹**ï¼š
```
ç”¨æˆ·ç«¯ â†’ ç½‘å…³ â†’ æœåŠ¡A â†’ æœåŠ¡B â†’ æ•°æ®åº“
  â†‘        â†‘       â†‘        â†‘        â†‘
ç½‘ç»œå¯èƒ½  è´Ÿè½½å‡è¡¡  æœåŠ¡é‡å¯  è°ƒç”¨å¤±è´¥  äº‹åŠ¡å›æ»š
è¶…æ—¶     é‡è¯•æœºåˆ¶   é‡å¤è¯·æ±‚  ç½‘ç»œæŠ–åŠ¨  æ•°æ®ä¸ä¸€è‡´
```

**ğŸ’¡ æ ¸å¿ƒé—®é¢˜**ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæ— æ³•ä¿è¯ç½‘ç»œçš„ç»å¯¹å¯é ï¼Œä»»ä½•ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½å‡ºç°é‡è¯•ï¼Œå¯¼è‡´é‡å¤æ“ä½œã€‚

### 2.2 å¹‚ç­‰æ€§è®¾è®¡åŸåˆ™


**ğŸ¯ è®¾è®¡åŸåˆ™**ï¼š

1. **ğŸ”¸ è¯†åˆ«å”¯ä¸€æ€§**ï¼šæ¯ä¸ªæ“ä½œéƒ½è¦æœ‰å”¯ä¸€æ ‡è¯†
2. **ğŸ”¸ çŠ¶æ€ç®¡ç†**ï¼šé€šè¿‡çŠ¶æ€æ¥åˆ¤æ–­æ“ä½œæ˜¯å¦å·²æ‰§è¡Œ
3. **ğŸ”¸ åŸå­æ“ä½œ**ï¼šå¹‚ç­‰æ£€æŸ¥å’Œä¸šåŠ¡æ“ä½œè¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­
4. **ğŸ”¸ æ€§èƒ½è€ƒè™‘**ï¼šå¹‚ç­‰æ€§æ£€æŸ¥ä¸èƒ½ä¸¥é‡å½±å“æ€§èƒ½

**âš¡ å¹‚ç­‰æ€§å®ç°æ€è·¯**ï¼š
```
è¯·æ±‚åˆ°è¾¾ â†’ ç”Ÿæˆ/æå–å¹‚ç­‰æ ‡è¯† â†’ æ£€æŸ¥æ˜¯å¦å·²å¤„ç† 
    â†“
å·²å¤„ç† â†’ ç›´æ¥è¿”å›ä¹‹å‰çš„ç»“æœ
    â†“  
æœªå¤„ç† â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘ â†’ è®°å½•å¤„ç†çŠ¶æ€ â†’ è¿”å›ç»“æœ
```

---

## 3. ğŸ« Tokenä»¤ç‰Œæœºåˆ¶


### 3.1 Tokenæœºåˆ¶åŸç†


**ğŸ’¡ æ ¸å¿ƒæ€è·¯**ï¼šåœ¨æ‰§è¡Œæ“ä½œå‰å…ˆè·å–ä¸€ä¸ªå”¯ä¸€çš„tokenï¼Œæ“ä½œæ—¶æºå¸¦è¿™ä¸ªtokenï¼Œç³»ç»Ÿé€šè¿‡tokenæ¥è¯†åˆ«æ˜¯å¦ä¸ºé‡å¤æ“ä½œã€‚

**ğŸ”„ æµç¨‹å›¾è§£**ï¼š
```
å‰ç«¯é¡µé¢åŠ è½½
    â†“
è°ƒç”¨è·å–tokenæ¥å£
    â†“
åç«¯ç”Ÿæˆå”¯ä¸€tokenå­˜å‚¨åˆ°Redis
    â†“
å‰ç«¯æ”¶åˆ°tokenï¼Œå­˜å‚¨åœ¨è¡¨å•ä¸­
    â†“
ç”¨æˆ·æäº¤è¡¨å•æ—¶æºå¸¦token
    â†“
åç«¯éªŒè¯tokenæ˜¯å¦å­˜åœ¨
    â†“
å­˜åœ¨ï¼šåˆ é™¤tokenå¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘
ä¸å­˜åœ¨ï¼šè¿”å›é‡å¤æäº¤é”™è¯¯
```

### 3.2 Tokenæœºåˆ¶å®ç°


**ğŸ”§ è·å–Tokenæ¥å£**ï¼š
```java
@RestController
public class TokenController {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    // è·å–å¹‚ç­‰token
    @GetMapping("/api/token")
    public Result<String> getToken() {
        String token = UUID.randomUUID().toString();
        String key = "idempotent_token:" + token;
        
        // token 5åˆ†é’Ÿæœ‰æ•ˆæœŸ
        redisTemplate.opsForValue().set(key, "1", 5, TimeUnit.MINUTES);
        
        return Result.success(token);
    }
}
```

**ğŸ¯ TokenéªŒè¯é€»è¾‘**ï¼š
```java
@Component
public class IdempotentAspect {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean validateToken(String token) {
        if (StringUtils.isEmpty(token)) {
            throw new BusinessException("tokenä¸èƒ½ä¸ºç©º");
        }
        
        String key = "idempotent_token:" + token;
        
        // ä½¿ç”¨luaè„šæœ¬ä¿è¯åŸå­æ“ä½œ
        String luaScript = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('del', KEYS[1]) " +
            "else " +
            "    return 0 " +
            "end";
            
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            Collections.singletonList(key),
            "1"
        );
        
        return result != null && result > 0;
    }
}
```

**ğŸ“ ä¸šåŠ¡æ¥å£ä½¿ç”¨**ï¼š
```java
@PostMapping("/api/orders")
public Result<Order> createOrder(@RequestBody OrderRequest request) {
    // éªŒè¯token
    if (!idempotentAspect.validateToken(request.getToken())) {
        return Result.error("è¯·å‹¿é‡å¤æäº¤");
    }
    
    // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    Order order = orderService.createOrder(request);
    return Result.success(order);
}
```

### 3.3 Tokenæœºåˆ¶çš„ä¼˜ç¼ºç‚¹


**âœ… ä¼˜ç‚¹**ï¼š
- å®ç°ç®€å•ï¼Œç†è§£å®¹æ˜“
- å¯¹ä¸šåŠ¡ä»£ç ä¾µå…¥æ€§å°
- å¯ä»¥é˜²æ­¢è¡¨å•é‡å¤æäº¤

**âŒ ç¼ºç‚¹**ï¼š
- éœ€è¦å‰ç«¯é…åˆï¼Œå¢åŠ ä¸€æ¬¡ç½‘ç»œè¯·æ±‚
- tokenæœ‰è¿‡æœŸæ—¶é—´ï¼Œç”¨æˆ·æ“ä½œå¤ªæ…¢ä¼šå¤±æ•ˆ
- ä¸é€‚åˆç³»ç»Ÿé—´è°ƒç”¨çš„å¹‚ç­‰æ€§

---

## 4. ğŸ—„ï¸ æ•°æ®åº“å”¯ä¸€ç´¢å¼•æ–¹æ¡ˆ


### 4.1 å”¯ä¸€ç´¢å¼•åŸç†


**ğŸ’¡ æ ¸å¿ƒæ€è·¯**ï¼šåˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•çš„ç‰¹æ€§ï¼Œè®©æ•°æ®åº“æ¥ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§ï¼Œé‡å¤æ’å…¥ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

**ğŸ”¸ é€‚ç”¨åœºæ™¯**ï¼š
- è®¢å•å·å”¯ä¸€æ€§
- ç”¨æˆ·åå”¯ä¸€æ€§  
- ä¸šåŠ¡æµæ°´å·å”¯ä¸€æ€§

### 4.2 è®¢å•å¹‚ç­‰æ€§å®ç°


**ğŸ“‹ æ•°æ®åº“è¡¨è®¾è®¡**ï¼š
```sql
-- è®¢å•è¡¨
CREATE TABLE t_order (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_no VARCHAR(64) NOT NULL COMMENT 'è®¢å•å·',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    amount DECIMAL(10,2) NOT NULL COMMENT 'é‡‘é¢',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€:0-å¾…æ”¯ä»˜,1-å·²æ”¯ä»˜',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    -- å”¯ä¸€ç´¢å¼•ä¿è¯è®¢å•å·å”¯ä¸€
    UNIQUE KEY uk_order_no (order_no),
    KEY idx_user_id (user_id)
);
```

**ğŸ”§ ä¸šåŠ¡ä»£ç å®ç°**ï¼š
```java
@Service
public class OrderService {
    
    @Autowired
    private OrderMapper orderMapper;
    
    @Transactional
    public Order createOrder(OrderRequest request) {
        try {
            // ç”Ÿæˆå”¯ä¸€è®¢å•å·
            String orderNo = generateOrderNo(request.getUserId());
            
            Order order = new Order();
            order.setOrderNo(orderNo);
            order.setUserId(request.getUserId());
            order.setAmount(request.getAmount());
            
            // æ’å…¥æ•°æ®åº“ï¼Œå¦‚æœè®¢å•å·é‡å¤ä¼šæŠ›å‡ºå¼‚å¸¸
            orderMapper.insert(order);
            
            return order;
            
        } catch (DuplicateKeyException e) {
            // æ•è·é‡å¤é”®å¼‚å¸¸ï¼Œè¯´æ˜å·²ç»åˆ›å»ºè¿‡äº†
            log.warn("è®¢å•å·²å­˜åœ¨ï¼Œç”¨æˆ·ID: {}", request.getUserId());
            
            // æŸ¥è¯¢å·²å­˜åœ¨çš„è®¢å•è¿”å›
            return orderMapper.selectByOrderNo(orderNo);
        }
    }
    
    private String generateOrderNo(Long userId) {
        // è®¢å•å·è§„åˆ™ï¼šç”¨æˆ·ID + æ—¶é—´æˆ³ + éšæœºæ•°
        return userId + "_" + System.currentTimeMillis() + "_" + 
               RandomUtils.nextInt(1000, 9999);
    }
}
```

### 4.3 å¹‚ç­‰æ€§è®°å½•è¡¨æ–¹æ¡ˆ


**ğŸ“Š ä¸“é—¨çš„å¹‚ç­‰æ€§è®°å½•è¡¨**ï¼š
```sql
CREATE TABLE t_idempotent_record (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    business_type VARCHAR(32) NOT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    business_key VARCHAR(128) NOT NULL COMMENT 'ä¸šåŠ¡å”¯ä¸€é”®',
    request_data TEXT COMMENT 'è¯·æ±‚æ•°æ®',
    response_data TEXT COMMENT 'å“åº”æ•°æ®',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€:0-å¤„ç†ä¸­,1-æˆåŠŸ,2-å¤±è´¥',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_business (business_type, business_key)
);
```

**ğŸ¯ é€šç”¨å¹‚ç­‰æ€§å¤„ç†**ï¼š
```java
@Component
public class IdempotentHandler {
    
    @Autowired
    private IdempotentRecordMapper recordMapper;
    
    @Transactional
    public <T> T handleIdempotent(String businessType, String businessKey, 
                                  Supplier<T> businessLogic) {
        try {
            // æ’å…¥å¹‚ç­‰æ€§è®°å½•
            IdempotentRecord record = new IdempotentRecord();
            record.setBusinessType(businessType);
            record.setBusinessKey(businessKey);
            record.setStatus(0); // å¤„ç†ä¸­
            
            recordMapper.insert(record);
            
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            T result = businessLogic.get();
            
            // æ›´æ–°ä¸ºæˆåŠŸçŠ¶æ€
            record.setStatus(1);
            record.setResponseData(JSON.toJSONString(result));
            recordMapper.updateById(record);
            
            return result;
            
        } catch (DuplicateKeyException e) {
            // é‡å¤è¯·æ±‚ï¼ŒæŸ¥è¯¢ä¹‹å‰çš„ç»“æœ
            IdempotentRecord existRecord = recordMapper.selectByBusinessKey(
                businessType, businessKey);
                
            if (existRecord.getStatus() == 1) {
                // ä¹‹å‰å¤„ç†æˆåŠŸï¼Œè¿”å›ç»“æœ
                return JSON.parseObject(existRecord.getResponseData(), 
                                      (Type) businessLogic.getClass());
            } else {
                throw new BusinessException("è¯·æ±‚æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨åå†è¯•");
            }
        }
    }
}
```

---

## 5. ğŸ” Redisåˆ†å¸ƒå¼é”å®ç°


### 5.1 åˆ†å¸ƒå¼é”åŸç†


**ğŸ’¡ æ ¸å¿ƒæ€è·¯**ï¼šä½¿ç”¨Redisçš„`SET NX EX`å‘½ä»¤æ¥è·å–åˆ†å¸ƒå¼é”ï¼Œåªæœ‰è·å–åˆ°é”çš„è¯·æ±‚æ‰èƒ½æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚

**ğŸ”„ æ‰§è¡Œæµç¨‹**ï¼š
```
è¯·æ±‚1åˆ°è¾¾ â†’ å°è¯•è·å–é”key1 â†’ æˆåŠŸè·å– â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘ â†’ é‡Šæ”¾é”
è¯·æ±‚2åˆ°è¾¾ â†’ å°è¯•è·å–é”key1 â†’ è·å–å¤±è´¥ â†’ è¿”å›æ­£åœ¨å¤„ç†ä¸­
è¯·æ±‚3åˆ°è¾¾ â†’ å°è¯•è·å–é”key1 â†’ è·å–å¤±è´¥ â†’ è¿”å›æ­£åœ¨å¤„ç†ä¸­
```

### 5.2 Redisé”å®ç°


**ğŸ”§ åˆ†å¸ƒå¼é”å·¥å…·ç±»**ï¼š
```java
@Component
public class RedisLock {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    private static final String LOCK_PREFIX = "idempotent_lock:";
    
    /**
     * è·å–é”
     * @param key é”çš„key
     * @param value é”çš„å€¼(é€šå¸¸ç”¨UUID)
     * @param expireTime è¿‡æœŸæ—¶é—´(ç§’)
     * @return æ˜¯å¦è·å–æˆåŠŸ
     */
    public boolean tryLock(String key, String value, int expireTime) {
        String lockKey = LOCK_PREFIX + key;
        Boolean result = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, value, expireTime, TimeUnit.SECONDS);
        return Boolean.TRUE.equals(result);
    }
    
    /**
     * é‡Šæ”¾é”
     */
    public boolean releaseLock(String key, String value) {
        String lockKey = LOCK_PREFIX + key;
        
        // ä½¿ç”¨luaè„šæœ¬ä¿è¯åŸå­æ€§
        String luaScript = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('del', KEYS[1]) " +
            "else " +
            "    return 0 " +
            "end";
            
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            Collections.singletonList(lockKey),
            value
        );
        
        return result != null && result > 0;
    }
}
```

**ğŸ¯ ä¸šåŠ¡ä¸­ä½¿ç”¨åˆ†å¸ƒå¼é”**ï¼š
```java
@Service
public class PaymentService {
    
    @Autowired
    private RedisLock redisLock;
    
    public Result<Payment> processPayment(PaymentRequest request) {
        // ä½¿ç”¨è®¢å•å·ä½œä¸ºé”çš„key
        String lockKey = "payment:" + request.getOrderNo();
        String lockValue = UUID.randomUUID().toString();
        
        // å°è¯•è·å–é”ï¼Œ30ç§’è¿‡æœŸ
        if (!redisLock.tryLock(lockKey, lockValue, 30)) {
            return Result.error("æ”¯ä»˜æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨åå†è¯•");
        }
        
        try {
            // æ£€æŸ¥è®¢å•çŠ¶æ€
            Order order = orderService.getByOrderNo(request.getOrderNo());
            if (order.getStatus() == OrderStatus.PAID) {
                return Result.error("è®¢å•å·²æ”¯ä»˜ï¼Œè¯·å‹¿é‡å¤æ”¯ä»˜");
            }
            
            // æ‰§è¡Œæ”¯ä»˜é€»è¾‘
            Payment payment = doPayment(request);
            
            return Result.success(payment);
            
        } finally {
            // é‡Šæ”¾é”
            redisLock.releaseLock(lockKey, lockValue);
        }
    }
}
```

### 5.3 Redissonå®ç°åˆ†å¸ƒå¼é”


**ğŸ“¦ å¼•å…¥Redissonä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.redisson</groupId>
    <artifactId>redisson-spring-boot-starter</artifactId>
    <version>3.17.7</version>
</dependency>
```

**ğŸ”§ ä½¿ç”¨Redissoné”**ï¼š
```java
@Service
public class OrderService {
    
    @Autowired
    private RedissonClient redissonClient;
    
    public Order createOrder(OrderRequest request) {
        String lockKey = "order_create:" + request.getUserId();
        RLock lock = redissonClient.getLock(lockKey);
        
        try {
            // å°è¯•è·å–é”ï¼Œæœ€å¤šç­‰å¾…3ç§’ï¼Œé”10ç§’åè‡ªåŠ¨é‡Šæ”¾
            if (lock.tryLock(3, 10, TimeUnit.SECONDS)) {
                
                // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                return doCreateOrder(request);
                
            } else {
                throw new BusinessException("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
            }
            
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new BusinessException("æ“ä½œè¢«ä¸­æ–­");
            
        } finally {
            if (lock.isLocked() && lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }
}
```

---

## 6. ğŸ”„ çŠ¶æ€æœºè®¾è®¡


### 6.1 çŠ¶æ€æœºåŸç†


**ğŸ’¡ æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡ç»´æŠ¤ä¸šåŠ¡å¯¹è±¡çš„çŠ¶æ€ï¼Œåªæœ‰åœ¨ç‰¹å®šçŠ¶æ€ä¸‹æ‰èƒ½æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œä»è€Œä¿è¯æ“ä½œçš„å¹‚ç­‰æ€§ã€‚

**ğŸ“Š è®¢å•çŠ¶æ€æœºç¤ºä¾‹**ï¼š
```
å¾…æ”¯ä»˜ â”€â”€payâ”€â”€â†’ å·²æ”¯ä»˜ â”€â”€shipâ”€â”€â†’ å·²å‘è´§ â”€â”€receiveâ”€â”€â†’ å·²å®Œæˆ
  â†“                â†“                â†“
cancel           cancel           cancel
  â†“                â†“                â†“  
å·²å–æ¶ˆ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å·²å–æ¶ˆ â†â”€â”€â”€â”€ å·²å–æ¶ˆ
```

**ğŸ¯ çŠ¶æ€è½¬æ¢è§„åˆ™**ï¼š
- å¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ï¼šåªèƒ½æ‰§è¡Œä¸€æ¬¡æ”¯ä»˜
- å·²æ”¯ä»˜ â†’ å·²å‘è´§ï¼šåªèƒ½æ‰§è¡Œä¸€æ¬¡å‘è´§  
- æ¯ä¸ªçŠ¶æ€éƒ½æœ‰æ˜ç¡®çš„å‰ç½®æ¡ä»¶

### 6.2 çŠ¶æ€æœºå®ç°


**ğŸ“‹ è®¢å•çŠ¶æ€æšä¸¾**ï¼š
```java
public enum OrderStatus {
    PENDING(0, "å¾…æ”¯ä»˜"),
    PAID(1, "å·²æ”¯ä»˜"), 
    SHIPPED(2, "å·²å‘è´§"),
    COMPLETED(3, "å·²å®Œæˆ"),
    CANCELLED(-1, "å·²å–æ¶ˆ");
    
    private final int code;
    private final String desc;
    
    // å®šä¹‰çŠ¶æ€è½¬æ¢è§„åˆ™
    public static final Map<OrderStatus, List<OrderStatus>> TRANSITION_MAP = 
        Map.of(
            PENDING, Arrays.asList(PAID, CANCELLED),
            PAID, Arrays.asList(SHIPPED, CANCELLED),
            SHIPPED, Arrays.asList(COMPLETED, CANCELLED)
        );
    
    public boolean canTransitionTo(OrderStatus target) {
        List<OrderStatus> allowedStates = TRANSITION_MAP.get(this);
        return allowedStates != null && allowedStates.contains(target);
    }
}
```

**ğŸ”§ çŠ¶æ€æœºæœåŠ¡å®ç°**ï¼š
```java
@Service
public class OrderStateMachine {
    
    @Autowired
    private OrderMapper orderMapper;
    
    @Transactional
    public boolean payOrder(String orderNo) {
        Order order = orderMapper.selectByOrderNo(orderNo);
        
        if (order == null) {
            throw new BusinessException("è®¢å•ä¸å­˜åœ¨");
        }
        
        OrderStatus currentStatus = OrderStatus.fromCode(order.getStatus());
        
        // æ£€æŸ¥çŠ¶æ€è½¬æ¢æ˜¯å¦åˆæ³•
        if (!currentStatus.canTransitionTo(OrderStatus.PAID)) {
            log.warn("è®¢å•çŠ¶æ€ä¸å…è®¸æ”¯ä»˜ï¼Œå½“å‰çŠ¶æ€: {}, è®¢å•å·: {}", 
                     currentStatus, orderNo);
            return false; // å¹‚ç­‰å¤„ç†ï¼šå·²æ”¯ä»˜æˆ–å·²å–æ¶ˆ
        }
        
        // æ›´æ–°çŠ¶æ€ï¼Œä½¿ç”¨ä¹è§‚é”
        int updated = orderMapper.updateStatusWithVersion(
            orderNo, OrderStatus.PAID.getCode(), order.getVersion());
            
        if (updated == 0) {
            // ç‰ˆæœ¬å·ä¸åŒ¹é…ï¼Œè¯´æ˜å¹¶å‘æ›´æ–°äº†
            throw new BusinessException("è®¢å•çŠ¶æ€å·²å˜æ›´ï¼Œè¯·åˆ·æ–°é‡è¯•");
        }
        
        // æ‰§è¡Œæ”¯ä»˜ç›¸å…³ä¸šåŠ¡é€»è¾‘
        processPayment(order);
        
        return true;
    }
}
```

**ğŸ“ æ•°æ®åº“æ”¯æŒä¹è§‚é”**ï¼š
```sql
-- è®¢å•è¡¨å¢åŠ ç‰ˆæœ¬å·å­—æ®µ
ALTER TABLE t_order ADD COLUMN version INT DEFAULT 1;

-- æ›´æ–°è¯­å¥å¸¦ç‰ˆæœ¬å·åˆ¤æ–­
UPDATE t_order 
SET status = ?, version = version + 1 
WHERE order_no = ? AND version = ?
```

---

## 7. ğŸ’¼ ä¸šåŠ¡å¹‚ç­‰ç­–ç•¥


### 7.1 ä¸åŒä¸šåŠ¡çš„å¹‚ç­‰ç­–ç•¥


**ğŸ“Š ä¸šåŠ¡åœºæ™¯åˆ†ç±»**ï¼š

| ä¸šåŠ¡ç±»å‹ | å¹‚ç­‰ç­–ç•¥ | å®ç°æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|----------|
| ğŸ›’ **è®¢å•åˆ›å»º** | å”¯ä¸€ç´¢å¼• | è®¢å•å·å”¯ä¸€çº¦æŸ | é˜²æ­¢é‡å¤ä¸‹å• |
| ğŸ’° **æ”¯ä»˜å¤„ç†** | çŠ¶æ€æœº+åˆ†å¸ƒå¼é” | çŠ¶æ€æ§åˆ¶+é”æœºåˆ¶ | é˜²æ­¢é‡å¤æ‰£æ¬¾ |
| ğŸ“¦ **åº“å­˜æ‰£å‡** | åˆ†å¸ƒå¼é”+ç‰ˆæœ¬å· | ä¹è§‚é”æ§åˆ¶ | é˜²æ­¢è¶…å– |
| ğŸ“§ **æ¶ˆæ¯å‘é€** | è®°å½•è¡¨ | å‘é€è®°å½•å»é‡ | é˜²æ­¢é‡å¤æ¨é€ |

### 7.2 è½¬è´¦ä¸šåŠ¡å¹‚ç­‰è®¾è®¡


**ğŸ”„ è½¬è´¦æµç¨‹è®¾è®¡**ï¼š
```
å‘èµ·è½¬è´¦è¯·æ±‚
    â†“
ç”Ÿæˆè½¬è´¦å•å·ï¼ˆå¹‚ç­‰æ ‡è¯†ï¼‰
    â†“
æ£€æŸ¥è½¬è´¦å•æ˜¯å¦å·²å­˜åœ¨
    â†“
å­˜åœ¨ï¼šè¿”å›è½¬è´¦ç»“æœ
ä¸å­˜åœ¨ï¼šæ‰§è¡Œè½¬è´¦é€»è¾‘
    â†“
æ‰£å‡è½¬å‡ºæ–¹ä½™é¢
    â†“
å¢åŠ è½¬å…¥æ–¹ä½™é¢  
    â†“
æ›´æ–°è½¬è´¦å•çŠ¶æ€
```

**ğŸ”§ è½¬è´¦æœåŠ¡å®ç°**ï¼š
```java
@Service
public class TransferService {
    
    @Autowired
    private AccountService accountService;
    @Autowired
    private TransferRecordMapper transferMapper;
    
    @Transactional
    public TransferResult transfer(TransferRequest request) {
        // ç”Ÿæˆå¹‚ç­‰æ€§è½¬è´¦å•å·
        String transferNo = generateTransferNo(request);
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡
        TransferRecord existRecord = transferMapper.selectByTransferNo(transferNo);
        if (existRecord != null) {
            return TransferResult.fromRecord(existRecord);
        }
        
        // åˆ›å»ºè½¬è´¦è®°å½•
        TransferRecord record = new TransferRecord();
        record.setTransferNo(transferNo);
        record.setFromAccount(request.getFromAccount());
        record.setToAccount(request.getToAccount());
        record.setAmount(request.getAmount());
        record.setStatus(TransferStatus.PROCESSING);
        
        try {
            transferMapper.insert(record);
        } catch (DuplicateKeyException e) {
            // å¹¶å‘æƒ…å†µä¸‹é‡å¤æ’å…¥ï¼ŒæŸ¥è¯¢ç»“æœè¿”å›
            existRecord = transferMapper.selectByTransferNo(transferNo);
            return TransferResult.fromRecord(existRecord);
        }
        
        try {
            // æ‰§è¡Œè½¬è´¦ä¸šåŠ¡
            accountService.deductBalance(request.getFromAccount(), 
                                       request.getAmount());
            accountService.addBalance(request.getToAccount(), 
                                    request.getAmount());
            
            // æ›´æ–°è½¬è´¦çŠ¶æ€ä¸ºæˆåŠŸ
            record.setStatus(TransferStatus.SUCCESS);
            transferMapper.updateById(record);
            
            return TransferResult.success(record);
            
        } catch (Exception e) {
            // è½¬è´¦å¤±è´¥ï¼Œæ›´æ–°çŠ¶æ€
            record.setStatus(TransferStatus.FAILED);
            record.setFailReason(e.getMessage());
            transferMapper.updateById(record);
            
            throw new BusinessException("è½¬è´¦å¤±è´¥: " + e.getMessage());
        }
    }
    
    private String generateTransferNo(TransferRequest request) {
        // åŸºäºè¯·æ±‚å‚æ•°ç”Ÿæˆå”¯ä¸€æ ‡è¯†
        String source = request.getFromAccount() + "_" + 
                       request.getToAccount() + "_" + 
                       request.getAmount() + "_" + 
                       request.getRequestId();
        return DigestUtils.md5DigestAsHex(source.getBytes());
    }
}
```

---

## 8. ğŸ”Œ æ¥å£å¹‚ç­‰å®ç°


### 8.1 æ³¨è§£æ–¹å¼å®ç°å¹‚ç­‰


**ğŸ¯ è‡ªå®šä¹‰å¹‚ç­‰æ³¨è§£**ï¼š
```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Idempotent {
    
    /**
     * å¹‚ç­‰keyçš„SpELè¡¨è¾¾å¼
     */
    String key() default "";
    
    /**
     * è¿‡æœŸæ—¶é—´(ç§’)
     */
    int expireTime() default 300;
    
    /**
     * æç¤ºä¿¡æ¯
     */
    String message() default "è¯·å‹¿é‡å¤æ“ä½œ";
}
```

**ğŸ”§ AOPåˆ‡é¢å®ç°**ï¼š
```java
@Aspect
@Component
public class IdempotentAspect {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    private final SpelExpressionParser parser = new SpelExpressionParser();
    
    @Around("@annotation(idempotent)")
    public Object around(ProceedingJoinPoint joinPoint, 
                        Idempotent idempotent) throws Throwable {
        
        // ç”Ÿæˆå¹‚ç­‰key
        String idempotentKey = generateKey(joinPoint, idempotent);
        
        // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
        String lockKey = "idempotent:" + idempotentKey;
        Boolean lockResult = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "1", idempotent.expireTime(), TimeUnit.SECONDS);
            
        if (!Boolean.TRUE.equals(lockResult)) {
            throw new BusinessException(idempotent.message());
        }
        
        try {
            // æ‰§è¡Œä¸šåŠ¡æ–¹æ³•
            return joinPoint.proceed();
            
        } catch (Exception e) {
            // å¤±è´¥æ—¶åˆ é™¤keyï¼Œå…è®¸é‡è¯•
            redisTemplate.delete(lockKey);
            throw e;
        }
    }
    
    private String generateKey(ProceedingJoinPoint joinPoint, 
                             Idempotent idempotent) {
        String keyExpression = idempotent.key();
        
        if (StringUtils.isEmpty(keyExpression)) {
            // é»˜è®¤ä½¿ç”¨æ–¹æ³•ç­¾å+å‚æ•°hash
            return joinPoint.getSignature().toString() + "#" + 
                   Arrays.hashCode(joinPoint.getArgs());
        }
        
        // ä½¿ç”¨SpELè¡¨è¾¾å¼è§£ækey
        EvaluationContext context = new StandardEvaluationContext();
        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
        String[] paramNames = signature.getParameterNames();
        Object[] args = joinPoint.getArgs();
        
        for (int i = 0; i < paramNames.length; i++) {
            context.setVariable(paramNames[i], args[i]);
        }
        
        return parser.parseExpression(keyExpression).getValue(context, String.class);
    }
}
```

**ğŸ“ ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@RestController
public class OrderController {
    
    // åŸºäºç”¨æˆ·IDå’Œé‡‘é¢ç”Ÿæˆå¹‚ç­‰key
    @Idempotent(key = "#request.userId + '_' + #request.amount", 
                expireTime = 60,
                message = "è®¢å•åˆ›å»ºä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤")
    @PostMapping("/orders")
    public Result<Order> createOrder(@RequestBody OrderRequest request) {
        Order order = orderService.createOrder(request);
        return Result.success(order);
    }
    
    // åŸºäºè®¢å•å·ç”Ÿæˆå¹‚ç­‰key
    @Idempotent(key = "'pay_' + #orderNo")
    @PostMapping("/orders/{orderNo}/pay")
    public Result<Payment> payOrder(@PathVariable String orderNo,
                                   @RequestBody PayRequest request) {
        Payment payment = paymentService.pay(orderNo, request);
        return Result.success(payment);
    }
}
```

### 8.2 ç½‘å…³å±‚å¹‚ç­‰å¤„ç†


**ğŸŒ Gatewayå¹‚ç­‰è¿‡æ»¤å™¨**ï¼š
```java
@Component
public class IdempotentGatewayFilter implements GlobalFilter, Ordered {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    private static final String IDEMPOTENT_HEADER = "X-Idempotent-Token";
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, 
                            GatewayFilterChain chain) {
        
        ServerHttpRequest request = exchange.getRequest();
        
        // åªå¤„ç†POST/PUT/PATCHè¯·æ±‚
        if (!isIdempotentMethod(request.getMethod())) {
            return chain.filter(exchange);
        }
        
        String token = request.getHeaders().getFirst(IDEMPOTENT_HEADER);
        if (StringUtils.isEmpty(token)) {
            return handleError(exchange, "ç¼ºå°‘å¹‚ç­‰token");
        }
        
        // éªŒè¯token
        String key = "gateway_idempotent:" + token;
        Boolean result = redisTemplate.opsForValue()
            .setIfAbsent(key, "1", 5, TimeUnit.MINUTES);
            
        if (!Boolean.TRUE.equals(result)) {
            return handleError(exchange, "è¯·å‹¿é‡å¤æäº¤");
        }
        
        return chain.filter(exchange);
    }
    
    private boolean isIdempotentMethod(HttpMethod method) {
        return method == HttpMethod.POST || 
               method == HttpMethod.PUT || 
               method == HttpMethod.PATCH;
    }
    
    @Override
    public int getOrder() {
        return -100; // é«˜ä¼˜å…ˆçº§
    }
}
```

---

## 9. ğŸ§ª å¹‚ç­‰æ€§æµ‹è¯•


### 9.1 æµ‹è¯•ç­–ç•¥


**ğŸ¯ æµ‹è¯•é‡ç‚¹**ï¼š
- **å¹¶å‘æµ‹è¯•**ï¼šå¤šçº¿ç¨‹åŒæ—¶è¯·æ±‚åŒä¸€æ¥å£
- **ç½‘ç»œé‡è¯•æµ‹è¯•**ï¼šæ¨¡æ‹Ÿç½‘ç»œå¼‚å¸¸é‡è¯•åœºæ™¯  
- **å¼‚å¸¸åœºæ™¯æµ‹è¯•**ï¼šä¸šåŠ¡æ‰§è¡Œå¤±è´¥æ—¶çš„å¹‚ç­‰æ€§
- **æ€§èƒ½æµ‹è¯•**ï¼šå¹‚ç­‰æœºåˆ¶å¯¹æ€§èƒ½çš„å½±å“

### 9.2 å¹¶å‘æµ‹è¯•å®ç°


**ğŸ”§ JUnit + CountDownLatchæµ‹è¯•**ï¼š
```java
@SpringBootTest
class IdempotentTest {
    
    @Autowired
    private OrderService orderService;
    
    @Test
    void testConcurrentCreateOrder() throws InterruptedException {
        int threadCount = 10;
        CountDownLatch latch = new CountDownLatch(threadCount);
        AtomicInteger successCount = new AtomicInteger(0);
        AtomicInteger duplicateCount = new AtomicInteger(0);
        
        OrderRequest request = new OrderRequest();
        request.setUserId(123L);
        request.setAmount(new BigDecimal("100"));
        
        // åˆ›å»ºå¤šä¸ªçº¿ç¨‹å¹¶å‘åˆ›å»ºè®¢å•
        for (int i = 0; i < threadCount; i++) {
            new Thread(() -> {
                try {
                    Order order = orderService.createOrder(request);
                    successCount.incrementAndGet();
                    
                } catch (BusinessException e) {
                    if (e.getMessage().contains("é‡å¤")) {
                        duplicateCount.incrementAndGet();
                    }
                } finally {
                    latch.countDown();
                }
            }).start();
        }
        
        latch.await(10, TimeUnit.SECONDS);
        
        // éªŒè¯ç»“æœï¼šåªæœ‰ä¸€ä¸ªæˆåŠŸï¼Œå…¶ä»–éƒ½æ˜¯é‡å¤
        assertEquals(1, successCount.get());
        assertEquals(threadCount - 1, duplicateCount.get());
    }
}
```

### 9.3 æ€§èƒ½åŸºå‡†æµ‹è¯•


**ğŸ“Š JMeteræµ‹è¯•é…ç½®**ï¼š
```xml
<!-- æµ‹è¯•è®¡åˆ’é…ç½® -->
<TestPlan>
    <ThreadGroup>
        <threads>100</threads>
        <rampUp>10</rampUp>
        <loops>10</loops>
    </ThreadGroup>
    
    <!-- HTTPè¯·æ±‚é…ç½® -->
    <HTTPSampler>
        <domain>localhost</domain>
        <port>8080</port>
        <path>/api/orders</path>
        <method>POST</method>
    </HTTPSampler>
</TestPlan>
```

**ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”**ï¼š

| æµ‹è¯•åœºæ™¯ | å¹³å‡å“åº”æ—¶é—´ | 99%å“åº”æ—¶é—´ | TPS | é”™è¯¯ç‡ |
|----------|-------------|-------------|-----|--------|
| æ— å¹‚ç­‰æœºåˆ¶ | 50ms | 80ms | 2000 | 0% |
| Tokenæœºåˆ¶ | 65ms | 100ms | 1800 | 0% |
| Redisé”æœºåˆ¶ | 70ms | 120ms | 1600 | 0% |
| æ•°æ®åº“å”¯ä¸€ç´¢å¼• | 60ms | 90ms | 1900 | 0% |

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å¹‚ç­‰æ€§å®šä¹‰**ï¼šå¤šæ¬¡æ‰§è¡Œç›¸åŒæ“ä½œäº§ç”Ÿç›¸åŒç»“æœçš„ç‰¹æ€§
**ğŸ”¸ æ ¸å¿ƒåŸç†**ï¼šé€šè¿‡å”¯ä¸€æ ‡è¯†æ¥è¯†åˆ«å’Œå»é‡é‡å¤æ“ä½œ
**ğŸ”¸ å®ç°æ–¹å¼**ï¼šTokenæœºåˆ¶ã€æ•°æ®åº“çº¦æŸã€åˆ†å¸ƒå¼é”ã€çŠ¶æ€æœº
**ğŸ”¸ é€‰æ‹©æ ‡å‡†**ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹å’Œæ€§èƒ½è¦æ±‚é€‰æ‹©åˆé€‚æ–¹æ¡ˆ

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦å¹‚ç­‰æ€§**ï¼š
- åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç½‘ç»œä¸å¯é å¯¼è‡´é‡å¤è¯·æ±‚
- ç”¨æˆ·æ“ä½œä¹ æƒ¯å¯èƒ½å¯¼è‡´é‡å¤æäº¤
- ç³»ç»Ÿé—´è°ƒç”¨å¯èƒ½å› è¶…æ—¶è€Œé‡è¯•

**ğŸ”¹ ä¸åŒæ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯**ï¼š
```
Tokenæœºåˆ¶ï¼šé€‚åˆç”¨æˆ·æ“ä½œï¼Œéœ€è¦å‰ç«¯é…åˆ
æ•°æ®åº“çº¦æŸï¼šé€‚åˆæœ‰å¤©ç„¶å”¯ä¸€é”®çš„ä¸šåŠ¡
åˆ†å¸ƒå¼é”ï¼šé€‚åˆå¹¶å‘æ§åˆ¶è¦æ±‚é«˜çš„åœºæ™¯
çŠ¶æ€æœºï¼šé€‚åˆæœ‰æ˜ç¡®ä¸šåŠ¡çŠ¶æ€çš„åœºæ™¯
```

**ğŸ”¹ å®ç°æ—¶çš„æ³¨æ„äº‹é¡¹**ï¼š
- å¹‚ç­‰æ£€æŸ¥å’Œä¸šåŠ¡æ“ä½œè¦ä¿è¯åŸå­æ€§
- è€ƒè™‘å¼‚å¸¸æƒ…å†µä¸‹çš„å¤„ç†é€»è¾‘
- å¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§è¦æ±‚

### 10.3 æœ€ä½³å®è·µå»ºè®®


**âœ… è®¾è®¡åŸåˆ™**ï¼š
- å°½æ—©è¯†åˆ«ï¼šåœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µè€ƒè™‘å¹‚ç­‰æ€§
- é€‰æ‹©åˆé€‚ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©å®ç°æ–¹æ¡ˆ
- æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…å¹‚ç­‰æœºåˆ¶æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
- å¼‚å¸¸å¤„ç†ï¼šè€ƒè™‘å„ç§è¾¹ç•Œæƒ…å†µ

**ğŸ”§ å·¥ç¨‹å®è·µ**ï¼š
- å»ºç«‹ç»Ÿä¸€çš„å¹‚ç­‰å¤„ç†æ¡†æ¶
- åˆ¶å®šå¹‚ç­‰keyçš„å‘½åè§„èŒƒ
- å®Œå–„ç›‘æ§å’ŒæŠ¥è­¦æœºåˆ¶
- åšå¥½å……åˆ†çš„æµ‹è¯•éªŒè¯

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¹‚ç­‰æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬è¦æ±‚
- å®ç°æ–¹æ¡ˆè¦æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©
- åŸå­æ€§æ˜¯å¹‚ç­‰æ€§å®ç°çš„å…³é”®
- æµ‹è¯•å’Œç›‘æ§ä¸å¯ç¼ºå°‘

---

> ğŸ’¡ **å­¦ä¹ æç¤º**ï¼šå¹‚ç­‰æ€§æ˜¯å¾®æœåŠ¡å¼€å‘ä¸­çš„é‡è¦æ¦‚å¿µï¼Œç†è§£å…¶åŸç†æ¯”è®°ä½å…·ä½“å®ç°æ›´é‡è¦ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€éœ€è¦ç»“åˆå¤šç§æ–¹æ¡ˆæ¥è§£å†³ä¸åŒåœºæ™¯çš„å¹‚ç­‰æ€§é—®é¢˜ã€‚