---
title: 6ã€æ€§èƒ½ä¼˜åŒ–ä¸è°ƒä¼˜
---
## ğŸ“š ç›®å½•

1. [æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°](#1-æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°)
2. [å¯åŠ¨æ€§èƒ½ä¼˜åŒ–](#2-å¯åŠ¨æ€§èƒ½ä¼˜åŒ–)
3. [å†…å­˜ä½¿ç”¨ä¼˜åŒ–](#3-å†…å­˜ä½¿ç”¨ä¼˜åŒ–)
4. [ç½‘ç»œé€šä¿¡ä¼˜åŒ–](#4-ç½‘ç»œé€šä¿¡ä¼˜åŒ–)
5. [æ•°æ®åº“è¿æ¥ä¼˜åŒ–](#5-æ•°æ®åº“è¿æ¥ä¼˜åŒ–)
6. [JVMå‚æ•°è°ƒä¼˜](#6-JVMå‚æ•°è°ƒä¼˜)
7. [ä»£ç å±‚é¢ä¼˜åŒ–](#7-ä»£ç å±‚é¢ä¼˜åŒ–)
8. [ç¼“å­˜ä½¿ç”¨ä¼˜åŒ–](#8-ç¼“å­˜ä½¿ç”¨ä¼˜åŒ–)
9. [å¼‚æ­¥å¤„ç†ä¼˜åŒ–](#9-å¼‚æ­¥å¤„ç†ä¼˜åŒ–)
10. [æ€§èƒ½æµ‹è¯•æ–¹æ³•](#10-æ€§èƒ½æµ‹è¯•æ–¹æ³•)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ€§èƒ½ä¼˜åŒ–


**é€šä¿—è§£é‡Š**ï¼šå°±åƒç»™æ±½è½¦åšä¿å…»ä¸€æ ·ï¼Œå¾®æœåŠ¡æ€§èƒ½ä¼˜åŒ–å°±æ˜¯è®©ä½ çš„åº”ç”¨ç¨‹åº"è·‘å¾—æ›´å¿«ã€ç”¨å¾—æ›´å°‘ã€æ›´ç¨³å®š"ã€‚

```
å¾®æœåŠ¡æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒç›®æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å“åº”æ›´å¿«   â”‚    â”‚  èµ„æºæ›´çœ   â”‚    â”‚  æ›´åŠ ç¨³å®š   â”‚
â”‚ é™ä½å»¶è¿Ÿ    â”‚    â”‚ èŠ‚çœå†…å­˜    â”‚    â”‚ å‡å°‘æ•…éšœ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ€§èƒ½ä¼˜åŒ–


**ç°å®åœºæ™¯**ï¼š
- ğŸš— **å¯åŠ¨æ…¢**ï¼šæœåŠ¡å¯åŠ¨è¦1åˆ†é’Ÿï¼Œç”¨æˆ·ç­‰ä¸èµ·
- ğŸŒ **å“åº”æ…¢**ï¼šç‚¹å‡»æŒ‰é’®ç­‰3ç§’æ‰æœ‰ååº”
- ğŸ’° **æˆæœ¬é«˜**ï¼šæœåŠ¡å™¨å†…å­˜å ç”¨å¤ªå¤§ï¼Œäº‘æœåŠ¡è´¹ç”¨é«˜
- ğŸ“± **ç”¨æˆ·æµå¤±**ï¼šé¡µé¢åŠ è½½æ…¢ï¼Œç”¨æˆ·ç›´æ¥å…³é—­

### 1.3 æ€§èƒ½ä¼˜åŒ–çš„åŸºæœ¬æ€è·¯


```
æ€§èƒ½ä¼˜åŒ–é‡‘å­—å¡”ï¼š
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ä»£ç ä¼˜åŒ–   â”‚ â† æœ€ä¸Šå±‚ï¼šç²¾ç»†è°ƒä¼˜
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  æ¡†æ¶é…ç½®   â”‚ â† ä¸­é—´å±‚ï¼šåˆç†é…ç½®
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  ç³»ç»Ÿæ¶æ„   â”‚ â† åº•å±‚ï¼šæ¶æ„è®¾è®¡
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŒ–é¡ºåº**ï¼š
1. **æ¶æ„å±‚é¢**ï¼šå…ˆè§£å†³è®¾è®¡é—®é¢˜
2. **é…ç½®å±‚é¢**ï¼šå†ä¼˜åŒ–é…ç½®å‚æ•°
3. **ä»£ç å±‚é¢**ï¼šæœ€åç²¾ç»†åŒ–è°ƒä¼˜

---

## 2. ğŸš€ å¯åŠ¨æ€§èƒ½ä¼˜åŒ–


### 2.1 å¯åŠ¨æ…¢çš„å¸¸è§åŸå› 


**é€šä¿—ç†è§£**ï¼šå°±åƒå¼€è½¦å‰è¦åšçš„å‡†å¤‡å·¥ä½œå¤ªå¤šï¼Œå¯¼è‡´å‡ºå‘æ—¶é—´å¾ˆé•¿ã€‚

```
å¯åŠ¨è¿‡ç¨‹åˆ†æï¼š
åº”ç”¨å¯åŠ¨ â†’ æ‰«æç»„ä»¶ â†’ åˆå§‹åŒ–Bean â†’ å»ºç«‹è¿æ¥ â†’ å¥åº·æ£€æŸ¥ â†’ æœåŠ¡å°±ç»ª
   â†“         â†“         â†“         â†“         â†“         â†“
 æ…¢çš„åŸå› ï¼š
- æ‰«æè·¯å¾„å¤ªå¹¿  - Beanå¤ªå¤š    - è¿æ¥è¶…æ—¶   - æ£€æŸ¥é¡¹å¤š   - ä¾èµ–ç­‰å¾…
```

### 2.2 å‡å°‘ç»„ä»¶æ‰«æèŒƒå›´


**é—®é¢˜**ï¼šé»˜è®¤æ‰«ææ•´ä¸ªåŒ…ï¼ŒåŒ…å«å¾ˆå¤šä¸éœ€è¦çš„ç±»ã€‚

```java
// âŒ æ‰«æèŒƒå›´å¤ªå¤§ - ä¼šæ‰«ææ•´ä¸ª com.example åŒ…
@SpringBootApplication
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}

// âœ… ç²¾ç¡®æŒ‡å®šæ‰«æåŒ… - åªæ‰«æéœ€è¦çš„åŒ…
@SpringBootApplication(scanBasePackages = {
    "com.example.user.controller",
    "com.example.user.service",
    "com.example.user.config"
})
public class UserServiceApplication {
    // ...
}
```

### 2.3 æ‡’åŠ è½½é…ç½®


**ä»€ä¹ˆæ˜¯æ‡’åŠ è½½**ï¼šå°±åƒ"ç”¨åˆ°æ‰ä¹°"ï¼ŒBeanåªæœ‰çœŸæ­£ä½¿ç”¨æ—¶æ‰åˆ›å»ºã€‚

```yaml
# application.yml
spring:
  main:
    lazy-initialization: true  # å¼€å¯å…¨å±€æ‡’åŠ è½½
  
  # æˆ–è€…åªå¯¹ç‰¹å®šæœåŠ¡å¼€å¯
  cloud:
    loadbalancer:
      eager-load:
        enabled: false  # ç¦ç”¨è´Ÿè½½å‡è¡¡å™¨é¢„åŠ è½½
```

**æ‡’åŠ è½½ä¼˜åŠ£å¯¹æ¯”**ï¼š

| æ–¹é¢ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| **å¯åŠ¨é€Ÿåº¦** | âš¡ å¯åŠ¨å¿«50%ä»¥ä¸Š | âŒ é¦–æ¬¡è°ƒç”¨å¯èƒ½æ…¢ |
| **å†…å­˜ä½¿ç”¨** | ğŸ’¾ åˆå§‹å†…å­˜å ç”¨å°‘ | âŒ è¿è¡Œæ—¶å¯èƒ½å‡ºé”™ |
| **é€‚ç”¨åœºæ™¯** | âœ… å¼€å‘ç¯å¢ƒå¾ˆå¥½ç”¨ | âš ï¸ ç”Ÿäº§ç¯å¢ƒéœ€è°¨æ… |

### 2.4 ç¦ç”¨ä¸å¿…è¦çš„è‡ªåŠ¨é…ç½®


```java
// æ’é™¤ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®
@SpringBootApplication(exclude = {
    DataSourceAutoConfiguration.class,      // å¦‚æœä¸ç”¨æ•°æ®åº“
    RedisAutoConfiguration.class,           // å¦‚æœä¸ç”¨Redis
    SecurityAutoConfiguration.class         // å¦‚æœä¸éœ€è¦Security
})
public class UserServiceApplication {
    // ...
}
```

### 2.5 å¯åŠ¨æ€§èƒ½ç›‘æ§


```yaml
# å¼€å¯å¯åŠ¨æ€§èƒ½åˆ†æ
spring:
  application:
    name: user-service
  profiles:
    active: dev
    
# æ·»åŠ å¯åŠ¨æ—¶é—´ç›‘æ§
management:
  endpoints:
    web:
      exposure:
        include: startup
```

**æŸ¥çœ‹å¯åŠ¨åˆ†æ**ï¼š
```bash
# å¯åŠ¨å®Œæˆåè®¿é—®
curl http://localhost:8080/actuator/startup
```

---

## 3. ğŸ’¾ å†…å­˜ä½¿ç”¨ä¼˜åŒ–


### 3.1 å†…å­˜æ³„æ¼çš„å¸¸è§åœºæ™¯


**é€šä¿—ç†è§£**ï¼šå°±åƒæˆ¿é—´é‡Œçš„åƒåœ¾ä¸æ¸…ç†ï¼Œè¶Šç§¯è¶Šå¤šï¼Œæœ€ç»ˆæˆ¿é—´è£…ä¸ä¸‹ã€‚

```
å†…å­˜ä½¿ç”¨åˆ†å¸ƒå›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 100% å†…å­˜
â”‚                                          â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ ä¸šåŠ¡å¯¹è±¡ (40%)             â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Spring Context (20%)             â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ è¿æ¥æ±  (15%)                      â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆ ç¼“å­˜ (12%)                         â”‚
â”‚  â–ˆâ–ˆâ–ˆ å…¶ä»– (13%)                          â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è¿æ¥æ± ä¼˜åŒ–


**æ•°æ®åº“è¿æ¥æ± è°ƒä¼˜**ï¼š

```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10        # æœ€å¤§è¿æ¥æ•°ï¼ˆä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼‰
      minimum-idle: 2              # æœ€å°ç©ºé—²è¿æ¥
      connection-timeout: 20000    # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      idle-timeout: 300000         # ç©ºé—²è¶…æ—¶æ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰
      max-lifetime: 1200000        # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼ˆ20åˆ†é’Ÿï¼‰
      
      # è¿æ¥æ± åç§°ï¼Œä¾¿äºç›‘æ§
      pool-name: "UserService-HikariCP"
```

> ğŸ’¡ **ç»éªŒåˆ†äº«**ï¼šè¿æ¥æ± å¤§å°ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼ä¸€èˆ¬è®¾ç½®ä¸º `CPUæ ¸å¿ƒæ•° Ã— 2` æ¯”è¾ƒåˆé€‚ã€‚

**HTTPè¿æ¥æ± è°ƒä¼˜**ï¼š

```yaml
# Feign HTTPè¿æ¥æ± é…ç½®
feign:
  httpclient:
    enabled: true
    max-connections: 200           # æœ€å¤§è¿æ¥æ•°
    max-connections-per-route: 20  # æ¯ä¸ªè·¯ç”±æœ€å¤§è¿æ¥æ•°
    connection-timeout: 2000       # è¿æ¥è¶…æ—¶
    socket-timeout: 5000          # è¯»å–è¶…æ—¶
```

### 3.3 ç¼“å­˜åˆç†ä½¿ç”¨


```java
// âœ… æ­£ç¡®çš„ç¼“å­˜ä½¿ç”¨ - è®¾ç½®è¿‡æœŸæ—¶é—´
@Service
public class UserService {
    
    @Cacheable(value = "userCache", key = "#userId")
    @CacheEvict(value = "userCache", key = "#userId", 
                condition = "#result != null")
    public User getUserById(Long userId) {
        return userRepository.findById(userId);
    }
}
```

```yaml
# Redisç¼“å­˜é…ç½®
spring:
  redis:
    timeout: 2000
    lettuce:
      pool:
        max-active: 8      # æœ€å¤§è¿æ¥æ•°
        max-idle: 8        # æœ€å¤§ç©ºé—²è¿æ¥æ•°
        min-idle: 0        # æœ€å°ç©ºé—²è¿æ¥æ•°
    
  cache:
    redis:
      time-to-live: 600000  # é»˜è®¤è¿‡æœŸæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰
```

### 3.4 å†…å­˜ç›‘æ§æŒ‡æ ‡


**é‡è¦ç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡åç§° | æ­£å¸¸èŒƒå›´ | å¼‚å¸¸è¡¨ç° | è§£å†³æ–¹æ³• |
|----------|----------|----------|----------|
| **å †å†…å­˜ä½¿ç”¨ç‡** | < 70% | > 85% | å¢åŠ å†…å­˜æˆ–ä¼˜åŒ–ä»£ç  |
| **GCé¢‘ç‡** | < 1æ¬¡/åˆ†é’Ÿ | > 5æ¬¡/åˆ†é’Ÿ | è°ƒæ•´GCå‚æ•° |
| **è¿æ¥æ•°** | < æœ€å¤§å€¼80% | æ¥è¿‘æœ€å¤§å€¼ | ä¼˜åŒ–è¿æ¥æ± é…ç½® |

---

## 4. ğŸŒ ç½‘ç»œé€šä¿¡ä¼˜åŒ–


### 4.1 æœåŠ¡é—´è°ƒç”¨ä¼˜åŒ–


**é€šä¿—ç†è§£**ï¼šå°±åƒæ‰“ç”µè¯ï¼Œè¦é€‰æ‹©ä¿¡å·å¥½çš„ç½‘ç»œï¼Œè¿˜è¦è¯´è¯ç®€æ´æ˜äº†ã€‚

```
æœåŠ¡è°ƒç”¨ä¼˜åŒ–ç­–ç•¥ï¼š
å®¢æˆ·ç«¯ â”€â”€â”€â”€â”
          â”œâ”€â†’ è´Ÿè½½å‡è¡¡ â”€â†’ æœåŠ¡A â”
          â”‚                   â”œâ”€â†’ å“åº”åˆå¹¶
          â””â”€â†’ è¿æ¥å¤ç”¨ â”€â†’ æœåŠ¡B â”˜
```

### 4.2 HTTP/2 å¯ç”¨


```yaml
# å¯ç”¨ HTTP/2
server:
  port: 8080
  http2:
    enabled: true
  ssl:
    enabled: false  # å¼€å‘ç¯å¢ƒå¯ä»¥å…³é—­SSL
```

**HTTP/2 ä¼˜åŠ¿**ï¼š
- ğŸš€ **å¤šè·¯å¤ç”¨**ï¼šä¸€ä¸ªè¿æ¥å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚
- ğŸ“¦ **å¤´éƒ¨å‹ç¼©**ï¼šå‡å°‘ç½‘ç»œä¼ è¾“æ•°æ®é‡
- âš¡ **æœåŠ¡å™¨æ¨é€**ï¼šä¸»åŠ¨æ¨é€èµ„æº

### 4.3 Feignå®¢æˆ·ç«¯ä¼˜åŒ–


```java
// Feign è¶…æ—¶é…ç½®
@Configuration
public class FeignConfig {
    
    @Bean
    public Request.Options requestOptions() {
        return new Request.Options(
            2000,  // è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            5000   // è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        );
    }
    
    // å¯ç”¨è¯·æ±‚å‹ç¼©
    @Bean
    public FeignLoggerLevel feignLoggerLevel() {
        return FeignLoggerLevel.BASIC;
    }
}
```

```yaml
# Feign å‹ç¼©é…ç½®
feign:
  compression:
    request:
      enabled: true
      mime-types: text/plain,application/json
      min-request-size: 2048  # è¶…è¿‡2KBæ‰å‹ç¼©
    response:
      enabled: true
```

### 4.4 æ‰¹é‡æ“ä½œä¼˜åŒ–


```java
// âŒ é¿å…N+1é—®é¢˜ - ä¸€ä¸ªä¸ªæŸ¥è¯¢
public List<UserDetail> getUserDetails(List<Long> userIds) {
    List<UserDetail> details = new ArrayList<>();
    for (Long userId : userIds) {
        UserDetail detail = userService.getUserDetail(userId);  // Næ¬¡è¿œç¨‹è°ƒç”¨
        details.add(detail);
    }
    return details;
}

// âœ… æ‰¹é‡æŸ¥è¯¢ - ä¸€æ¬¡è·å–å¤šä¸ª
public List<UserDetail> getUserDetails(List<Long> userIds) {
    return userService.batchGetUserDetails(userIds);  // 1æ¬¡è¿œç¨‹è°ƒç”¨
}
```

---

## 5. ğŸ—ƒï¸ æ•°æ®åº“è¿æ¥ä¼˜åŒ–


### 5.1 è¿æ¥æ± å‚æ•°è°ƒä¼˜


**é€šä¿—ç†è§£**ï¼šæ•°æ®åº“è¿æ¥æ± å°±åƒåœè½¦åœºï¼Œè¦åˆç†è§„åˆ’è½¦ä½æ•°é‡ã€‚

```
è¿æ¥æ± å·¥ä½œåŸç†ï¼š
åº”ç”¨è¯·æ±‚ â†’ è¿æ¥æ±  â†’ æ•°æ®åº“
    â†“         â†“        â†“
 å¹¶å‘è¯·æ±‚   å¤ç”¨è¿æ¥   å‡å°‘åˆ›å»ºé”€æ¯æˆæœ¬
```

### 5.2 HikariCP æœ€ä½³é…ç½®


```yaml
spring:
  datasource:
    hikari:
      # æ ¸å¿ƒé…ç½®
      maximum-pool-size: 20        # æœ€å¤§è¿æ¥æ•° = CPUæ ¸å¿ƒæ•° Ã— 2
      minimum-idle: 5              # æœ€å°ç©ºé—²è¿æ¥ = maximum-pool-size / 4
      
      # è¶…æ—¶é…ç½®
      connection-timeout: 30000    # è·å–è¿æ¥è¶…æ—¶ï¼ˆ30ç§’ï¼‰
      validation-timeout: 5000     # è¿æ¥éªŒè¯è¶…æ—¶ï¼ˆ5ç§’ï¼‰
      idle-timeout: 600000         # ç©ºé—²è¶…æ—¶ï¼ˆ10åˆ†é’Ÿï¼‰
      max-lifetime: 1800000        # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰
      
      # è¿æ¥æµ‹è¯•
      connection-test-query: SELECT 1
      
      # æ€§èƒ½ä¼˜åŒ–
      auto-commit: true
      read-only: false
      isolation-level: TRANSACTION_READ_COMMITTED
```

> âš ï¸ **é‡è¦æé†’**ï¼š`max-lifetime` åº”è¯¥æ¯”æ•°æ®åº“çš„ `wait_timeout` å°å‡ åˆ†é’Ÿã€‚

### 5.3 SQLæŸ¥è¯¢ä¼˜åŒ–


```java
// âœ… ä½¿ç”¨ç´¢å¼•å‹å¥½çš„æŸ¥è¯¢
@Query("SELECT u FROM User u WHERE u.status = :status AND u.createTime >= :startTime")
List<User> findActiveUsers(@Param("status") String status, 
                          @Param("startTime") LocalDateTime startTime);

// âœ… åˆ†é¡µæŸ¥è¯¢é¿å…å…¨è¡¨æ‰«æ
@Query(value = "SELECT * FROM user u WHERE u.department_id = ?1 ORDER BY u.id LIMIT ?2 OFFSET ?3", 
       nativeQuery = true)
List<User> findUsersByDepartment(Long departmentId, int limit, int offset);
```

### 5.4 æ•°æ®åº“ç›‘æ§æŒ‡æ ‡


| ç›‘æ§é¡¹ | å¥åº·å€¼ | è­¦å‘Šå€¼ | è¯´æ˜ |
|--------|--------|--------|------|
| **è¿æ¥æ± ä½¿ç”¨ç‡** | < 60% | > 80% | è¿æ¥æ•°ä¸å¤Ÿç”¨äº† |
| **å¹³å‡å“åº”æ—¶é—´** | < 100ms | > 500ms | SQLæ‰§è¡Œå¤ªæ…¢ |
| **æ´»è·ƒè¿æ¥æ•°** | æ­£å¸¸æ³¢åŠ¨ | æŒç»­é«˜ä½ | å¯èƒ½æœ‰æ…¢SQL |

---

## 6. â˜• JVMå‚æ•°è°ƒä¼˜


### 6.1 JVMå†…å­˜æ¨¡å‹ç®€ä»‹


**é€šä¿—è§£é‡Š**ï¼šJVMå°±åƒä¸€ä¸ªå·¥å‚ï¼Œæœ‰ä¸åŒçš„è½¦é—´ï¼ˆå†…å­˜åŒºåŸŸï¼‰è´Ÿè´£ä¸åŒå·¥ä½œã€‚

```
JVMå†…å­˜ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                å †å†…å­˜               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   å¹´è½»ä»£    â”‚ â”‚   è€å¹´ä»£    â”‚   â”‚
â”‚  â”‚ Eden | S0|S1â”‚ â”‚             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              éå †å†…å­˜               â”‚
â”‚  æ–¹æ³•åŒº  â”‚  ç›´æ¥å†…å­˜  â”‚  æ ˆå†…å­˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ç”Ÿäº§ç¯å¢ƒJVMå‚æ•°æ¨¡æ¿


```bash
# 8GBå†…å­˜æœåŠ¡å™¨çš„JVMå‚æ•°é…ç½®
java -jar your-app.jar \
  # å†…å­˜è®¾ç½®
  -Xms4g \                      # åˆå§‹å †å†…å­˜4GB
  -Xmx4g \                      # æœ€å¤§å †å†…å­˜4GB
  -Xmn1g \                      # å¹´è½»ä»£1GB
  -XX:MetaspaceSize=256m \      # æ–¹æ³•åŒºåˆå§‹å¤§å°
  -XX:MaxMetaspaceSize=512m \   # æ–¹æ³•åŒºæœ€å¤§å¤§å°
  
  # GCè®¾ç½®ï¼ˆæ¨èG1GCï¼‰
  -XX:+UseG1GC \                # ä½¿ç”¨G1åƒåœ¾æ”¶é›†å™¨
  -XX:MaxGCPauseMillis=100 \    # GCæœ€å¤§æš‚åœæ—¶é—´100ms
  -XX:G1HeapRegionSize=16m \    # G1åŒºåŸŸå¤§å°
  
  # æ€§èƒ½ç›‘æ§
  -XX:+PrintGCDetails \         # æ‰“å°GCè¯¦æƒ…
  -XX:+PrintGCTimeStamps \      # æ‰“å°GCæ—¶é—´æˆ³
  -Xloggc:/var/log/gc.log \     # GCæ—¥å¿—æ–‡ä»¶
  
  # æ•…éšœæ’æŸ¥
  -XX:+HeapDumpOnOutOfMemoryError \     # OOMæ—¶ç”Ÿæˆå †è½¬å‚¨
  -XX:HeapDumpPath=/var/log/heapdump/   # å †è½¬å‚¨æ–‡ä»¶è·¯å¾„
```

### 6.3 ä¸åŒåœºæ™¯çš„JVMé…ç½®


**å°å†…å­˜æœåŠ¡å™¨ï¼ˆ2GBï¼‰**ï¼š
```bash
-Xms1g -Xmx1g -Xmn256m -XX:MetaspaceSize=128m
```

**å¤§å†…å­˜æœåŠ¡å™¨ï¼ˆ16GBï¼‰**ï¼š
```bash
-Xms8g -Xmx8g -Xmn2g -XX:MetaspaceSize=512m
```

### 6.4 JVMæ€§èƒ½ç›‘æ§


```yaml
# application.yml - JVMç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: metrics, health, info
  metrics:
    export:
      prometheus:
        enabled: true
```

**å…³é”®JVMç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | æè¿° | æ­£å¸¸å€¼ |
|------|------|---------|
| `jvm.memory.used` | å†…å­˜ä½¿ç”¨é‡ | < 80% |
| `jvm.gc.pause` | GCæš‚åœæ—¶é—´ | < 100ms |
| `jvm.gc.memory.allocated` | GCå‰åå†…å­˜åˆ†é… | å¹³ç¨³å¢é•¿ |

---

## 7. ğŸ’» ä»£ç å±‚é¢ä¼˜åŒ–


### 7.1 é¿å…å¸¸è§æ€§èƒ½é™·é˜±


**é€šä¿—ç†è§£**ï¼šå°±åƒå¼€è½¦è¦é¿å¼€å µè½¦è·¯æ®µï¼Œä»£ç ä¹Ÿè¦é¿å¼€æ€§èƒ½"å µç‚¹"ã€‚

### 7.2 å­—ç¬¦ä¸²æ“ä½œä¼˜åŒ–


```java
// âŒ å¤§é‡å­—ç¬¦ä¸²æ‹¼æ¥ - åˆ›å»ºå¾ˆå¤šä¸´æ—¶å¯¹è±¡
public String buildMessage(List<String> items) {
    String message = "";
    for (String item : items) {
        message = message + item + ",";  // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å­—ç¬¦ä¸²
    }
    return message;
}

// âœ… ä½¿ç”¨StringBuilder - é«˜æ•ˆæ‹¼æ¥
public String buildMessage(List<String> items) {
    StringBuilder sb = new StringBuilder();
    for (String item : items) {
        sb.append(item).append(",");
    }
    return sb.toString();
}

// âœ… æ›´ç®€æ´çš„å†™æ³• - ä½¿ç”¨Stream API
public String buildMessage(List<String> items) {
    return String.join(",", items);
}
```

### 7.3 é›†åˆæ“ä½œä¼˜åŒ–


```java
// âœ… é¢„è®¾é›†åˆå¤§å° - é¿å…æ‰©å®¹
public List<User> processUsers(int expectedSize) {
    List<User> users = new ArrayList<>(expectedSize);  // é¢„è®¾å®¹é‡
    // å¤„ç†é€»è¾‘...
    return users;
}

// âœ… é€‰æ‹©åˆé€‚çš„é›†åˆç±»å‹
public class UserService {
    // éœ€è¦å¿«é€ŸæŸ¥æ‰¾ - ä½¿ç”¨HashMap
    private Map<Long, User> userCache = new HashMap<>();
    
    // éœ€è¦æœ‰åº - ä½¿ç”¨LinkedHashMap
    private Map<String, String> orderedConfig = new LinkedHashMap<>();
    
    // éœ€è¦çº¿ç¨‹å®‰å…¨ - ä½¿ç”¨ConcurrentHashMap
    private Map<String, Object> threadSafeCache = new ConcurrentHashMap<>();
}
```

### 7.4 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–


```java
@Service
public class UserService {
    
    // âœ… æ‰¹é‡æŸ¥è¯¢æ›¿ä»£å•ä¸ªæŸ¥è¯¢
    public List<UserDetail> getUserDetails(List<Long> userIds) {
        // ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        List<User> users = userRepository.findAllById(userIds);
        
        // ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰ç”¨æˆ·è¯¦æƒ…
        List<UserProfile> profiles = profileRepository.findByUserIdIn(userIds);
        
        // åœ¨å†…å­˜ä¸­ç»„åˆæ•°æ®
        return combineUserAndProfile(users, profiles);
    }
    
    // âœ… ä½¿ç”¨åˆ†é¡µé¿å…å¤§ç»“æœé›†
    @Transactional(readOnly = true)
    public Page<User> getUsersByDepartment(Long departmentId, Pageable pageable) {
        return userRepository.findByDepartmentId(departmentId, pageable);
    }
}
```

### 7.5 å¯¹è±¡åˆ›å»ºä¼˜åŒ–


```java
// âœ… å¯¹è±¡æ± æ¨¡å¼ - é‡ç”¨å¯¹è±¡
@Component
public class ObjectPoolExample {
    
    private final Queue<ExpensiveObject> objectPool = new ConcurrentLinkedQueue<>();
    
    public ExpensiveObject borrowObject() {
        ExpensiveObject obj = objectPool.poll();
        if (obj == null) {
            obj = new ExpensiveObject();
        }
        return obj;
    }
    
    public void returnObject(ExpensiveObject obj) {
        obj.reset();  // é‡ç½®å¯¹è±¡çŠ¶æ€
        objectPool.offer(obj);
    }
}
```

---

## 8. âš¡ ç¼“å­˜ä½¿ç”¨ä¼˜åŒ–


### 8.1 ç¼“å­˜å±‚çº§è®¾è®¡


**é€šä¿—ç†è§£**ï¼šç¼“å­˜å°±åƒæŠŠå¸¸ç”¨çš„ä¸œè¥¿æ”¾åœ¨æ‰‹è¾¹ï¼Œç”¨çš„æ—¶å€™ä¸ç”¨è·‘è¿œè·¯å»æ‹¿ã€‚

```
å¤šçº§ç¼“å­˜æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬åœ°ç¼“å­˜   â”‚ â†’  â”‚ åˆ†å¸ƒå¼ç¼“å­˜  â”‚ â†’  â”‚   æ•°æ®åº“    â”‚
â”‚ (å†…å­˜ä¸­)    â”‚    â”‚  (Redis)   â”‚    â”‚  (MySQL)   â”‚
â”‚ æ¯«ç§’çº§è®¿é—®  â”‚    â”‚ ç½‘ç»œè®¿é—®    â”‚    â”‚  ç£ç›˜è®¿é—®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     å¿«                ä¸­ç­‰              æ…¢
```

### 8.2 æœ¬åœ°ç¼“å­˜é…ç½®


```java
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public CacheManager cacheManager() {
        CaffeineCacheManager cacheManager = new CaffeineCacheManager();
        cacheManager.setCaffeine(Caffeine.newBuilder()
            .maximumSize(1000)                    // æœ€å¤§1000ä¸ªæ¡ç›®
            .expireAfterWrite(10, TimeUnit.MINUTES)  // å†™å…¥å10åˆ†é’Ÿè¿‡æœŸ
            .expireAfterAccess(5, TimeUnit.MINUTES)  // è®¿é—®å5åˆ†é’Ÿè¿‡æœŸ
            .recordStats());                      // å¯ç”¨ç»Ÿè®¡
        return cacheManager;
    }
}
```

### 8.3 Redisç¼“å­˜ä¼˜åŒ–


```yaml
# Redis é…ç½®ä¼˜åŒ–
spring:
  redis:
    host: localhost
    port: 6379
    timeout: 2000ms
    
    # è¿æ¥æ± é…ç½®
    lettuce:
      pool:
        max-active: 8       # æœ€å¤§è¿æ¥æ•°
        max-wait: -1ms      # è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´
        max-idle: 8         # æœ€å¤§ç©ºé—²è¿æ¥
        min-idle: 0         # æœ€å°ç©ºé—²è¿æ¥
    
    # ç¼“å­˜é…ç½®
  cache:
    type: redis
    redis:
      time-to-live: 600000    # é»˜è®¤10åˆ†é’Ÿè¿‡æœŸ
      cache-null-values: false # ä¸ç¼“å­˜nullå€¼
```

### 8.4 ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ


```java
@Service
public class ProductService {
    
    // âœ… è®¾ç½®åˆç†çš„ç¼“å­˜Keyå’Œè¿‡æœŸæ—¶é—´
    @Cacheable(value = "products", key = "#productId", 
               condition = "#productId != null")
    public Product getProduct(Long productId) {
        return productRepository.findById(productId)
                .orElse(null);
    }
    
    // âœ… æ›´æ–°æ—¶æ¸…é™¤ç¼“å­˜
    @CacheEvict(value = "products", key = "#product.id")
    public Product updateProduct(Product product) {
        return productRepository.save(product);
    }
    
    // âœ… æ‰¹é‡æ¸…é™¤ç¼“å­˜
    @CacheEvict(value = "products", allEntries = true)
    public void clearAllProductCache() {
        // æ¸…é™¤æ‰€æœ‰äº§å“ç¼“å­˜
    }
    
    // âœ… ç¼“å­˜ç©¿é€é˜²æŠ¤
    @Cacheable(value = "products", key = "#productId", 
               unless = "#result == null")  // ç»“æœä¸ºnullæ—¶ä¸ç¼“å­˜
    public Product getProductSafely(Long productId) {
        if (productId == null || productId <= 0) {
            return null;  // æ— æ•ˆIDç›´æ¥è¿”å›
        }
        return productRepository.findById(productId).orElse(null);
    }
}
```

### 8.5 ç¼“å­˜ç›‘æ§å’Œé—®é¢˜æ’æŸ¥


```java
// ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
@RestController
public class CacheStatsController {
    
    @Autowired
    private CacheManager cacheManager;
    
    @GetMapping("/cache/stats")
    public Map<String, Object> getCacheStats() {
        Map<String, Object> stats = new HashMap<>();
        
        if (cacheManager instanceof CaffeineCacheManager) {
            CaffeineCacheManager caffeineCacheManager = (CaffeineCacheManager) cacheManager;
            Collection<String> cacheNames = caffeineCacheManager.getCacheNames();
            
            for (String cacheName : cacheNames) {
                Cache cache = caffeineCacheManager.getCache(cacheName);
                if (cache instanceof CaffeineCache) {
                    com.github.benmanes.caffeine.cache.Cache<Object, Object> nativeCache = 
                        ((CaffeineCache) cache).getNativeCache();
                    stats.put(cacheName, nativeCache.stats());
                }
            }
        }
        
        return stats;
    }
}
```

---

## 9. ğŸ”„ å¼‚æ­¥å¤„ç†ä¼˜åŒ–


### 9.1 ä¸ºä»€ä¹ˆè¦ç”¨å¼‚æ­¥å¤„ç†


**é€šä¿—ç†è§£**ï¼šå°±åƒé¤å…ç‚¹èœï¼Œä¸ç”¨ç­‰ç¬¬ä¸€é“èœåšå®Œå†åšç¬¬äºŒé“èœï¼Œå¯ä»¥åŒæ—¶å‡†å¤‡å¤šé“èœã€‚

```
åŒæ­¥å¤„ç† vs å¼‚æ­¥å¤„ç†ï¼š

åŒæ­¥å¤„ç†ï¼š
è¯·æ±‚ â†’ å¤„ç†1 â†’ å¤„ç†2 â†’ å¤„ç†3 â†’ å“åº”
      (æ…¢)   (æ…¢)   (æ…¢)    æ€»æ—¶é—´ = 1+2+3

å¼‚æ­¥å¤„ç†ï¼š
è¯·æ±‚ â†’ å¤„ç†1 â”
       å¤„ç†2 â”œâ†’ ç­‰å¾…æœ€æ…¢çš„å®Œæˆ â†’ å“åº”
       å¤„ç†3 â”˜    æ€»æ—¶é—´ = max(1,2,3)
```

### 9.2 Springå¼‚æ­¥é…ç½®


```java
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean("taskExecutor")
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        
        // æ ¸å¿ƒçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•°
        executor.setCorePoolSize(Runtime.getRuntime().availableProcessors());
        
        // æœ€å¤§çº¿ç¨‹æ•° = æ ¸å¿ƒçº¿ç¨‹æ•° * 2
        executor.setMaxPoolSize(Runtime.getRuntime().availableProcessors() * 2);
        
        // é˜Ÿåˆ—å¤§å°
        executor.setQueueCapacity(100);
        
        // çº¿ç¨‹åå‰ç¼€
        executor.setThreadNamePrefix("async-task-");
        
        // æ‹’ç»ç­–ç•¥ï¼šç”±è°ƒç”¨è€…æ‰§è¡Œ
        executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
        
        executor.initialize();
        return executor;
    }
}
```

### 9.3 å¼‚æ­¥æ–¹æ³•ä½¿ç”¨


```java
@Service
public class OrderService {
    
    // âœ… å¼‚æ­¥å‘é€é€šçŸ¥ - ä¸é˜»å¡ä¸»æµç¨‹
    @Async("taskExecutor")
    public CompletableFuture<Void> sendOrderNotification(Order order) {
        try {
            // å‘é€é‚®ä»¶é€šçŸ¥
            emailService.sendOrderConfirmation(order);
            // å‘é€çŸ­ä¿¡é€šçŸ¥
            smsService.sendOrderSms(order);
            
            return CompletableFuture.completedFuture(null);
        } catch (Exception e) {
            return CompletableFuture.failedFuture(e);
        }
    }
    
    // âœ… å¼‚æ­¥æ•°æ®å¤„ç†
    @Async("taskExecutor")
    public CompletableFuture<String> processOrderData(Order order) {
        // è€—æ—¶çš„æ•°æ®å¤„ç†é€»è¾‘
        String result = heavyDataProcessing(order);
        return CompletableFuture.completedFuture(result);
    }
    
    // âœ… ä¸»ä¸šåŠ¡æ–¹æ³• - åŒæ­¥+å¼‚æ­¥ç»“åˆ
    public Order createOrder(OrderRequest request) {
        // 1. åŒæ­¥åˆ›å»ºè®¢å•ï¼ˆå¿…é¡»å®Œæˆï¼‰
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setAmount(request.getAmount());
        order = orderRepository.save(order);
        
        // 2. å¼‚æ­¥å‘é€é€šçŸ¥ï¼ˆä¸å½±å“è®¢å•åˆ›å»ºï¼‰
        sendOrderNotification(order);
        
        // 3. å¼‚æ­¥æ•°æ®å¤„ç†ï¼ˆåå°è¿›è¡Œï¼‰
        processOrderData(order);
        
        return order;
    }
}
```

### 9.4 CompletableFutureé«˜çº§ç”¨æ³•


```java
@Service
public class UserService {
    
    public UserDetailVO getUserDetail(Long userId) {
        // å¹¶è¡Œè·å–ç”¨æˆ·çš„å¤šä¸ªä¿¡æ¯
        CompletableFuture<User> userFuture = 
            CompletableFuture.supplyAsync(() -> getUserBasicInfo(userId));
            
        CompletableFuture<List<Order>> ordersFuture = 
            CompletableFuture.supplyAsync(() -> getUserOrders(userId));
            
        CompletableFuture<UserProfile> profileFuture = 
            CompletableFuture.supplyAsync(() -> getUserProfile(userId));
        
        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œç»„åˆç»“æœ
        CompletableFuture<UserDetailVO> resultFuture = 
            userFuture.thenCombine(ordersFuture, (user, orders) -> {
                UserDetailVO vo = new UserDetailVO();
                vo.setUser(user);
                vo.setOrders(orders);
                return vo;
            }).thenCombine(profileFuture, (vo, profile) -> {
                vo.setProfile(profile);
                return vo;
            });
        
        try {
            // æœ€å¤šç­‰å¾…5ç§’
            return resultFuture.get(5, TimeUnit.SECONDS);
        } catch (Exception e) {
            throw new RuntimeException("è·å–ç”¨æˆ·è¯¦æƒ…å¤±è´¥", e);
        }
    }
}
```

### 9.5 æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†


```java
// RabbitMQå¼‚æ­¥æ¶ˆæ¯å¤„ç†
@Component
public class OrderMessageHandler {
    
    // å¼‚æ­¥å¤„ç†è®¢å•åˆ›å»ºåçš„ä¸šåŠ¡
    @RabbitListener(queues = "order.created")
    public void handleOrderCreated(OrderCreatedEvent event) {
        try {
            // æ›´æ–°åº“å­˜
            inventoryService.updateInventory(event.getOrderId());
            
            // ç”Ÿæˆå‘ç¥¨
            invoiceService.generateInvoice(event.getOrderId());
            
            // è®°å½•æ—¥å¿—
            auditService.logOrderCreated(event);
            
        } catch (Exception e) {
            // å¼‚å¸¸å¤„ç†ï¼Œå¯ä»¥è€ƒè™‘é‡è¯•æœºåˆ¶
            log.error("å¤„ç†è®¢å•åˆ›å»ºäº‹ä»¶å¤±è´¥", e);
        }
    }
}
```

---

## 10. ğŸ§ª æ€§èƒ½æµ‹è¯•æ–¹æ³•


### 10.1 æ€§èƒ½æµ‹è¯•çš„é‡è¦æ€§


**é€šä¿—ç†è§£**ï¼šå°±åƒæ±½è½¦å‡ºå‚å‰è¦è·‘æµ‹è¯•ï¼Œè½¯ä»¶ä¹Ÿè¦åšæ€§èƒ½æµ‹è¯•ç¡®ä¿èƒ½æ‰¿å—é¢„æœŸè´Ÿè½½ã€‚

```
æ€§èƒ½æµ‹è¯•ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è´Ÿè½½æµ‹è¯•   â”‚  â”‚  å‹åŠ›æµ‹è¯•   â”‚  â”‚  ç¨³å®šæ€§æµ‹è¯• â”‚
â”‚ æ­£å¸¸è´Ÿè½½ä¸‹  â”‚  â”‚ è¶…è´Ÿè·æƒ…å†µ  â”‚  â”‚ é•¿æ—¶é—´è¿è¡Œ  â”‚
â”‚ å“åº”æ—¶é—´    â”‚  â”‚ ç³»ç»Ÿæé™    â”‚  â”‚ å†…å­˜æ³„æ¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 JMeteræ€§èƒ½æµ‹è¯•


**æµ‹è¯•è„šæœ¬ç¤ºä¾‹**ï¼š

```xml
<!-- JMeter æµ‹è¯•è®¡åˆ’é…ç½® -->
<TestPlan>
  <ThreadGroup>
    <name>ç”¨æˆ·æœåŠ¡è´Ÿè½½æµ‹è¯•</name>
    <num_threads>100</num_threads>      <!-- 100ä¸ªå¹¶å‘ç”¨æˆ· -->
    <ramp_time>30</ramp_time>           <!-- 30ç§’å†…å¯åŠ¨æ‰€æœ‰çº¿ç¨‹ -->
    <duration>300</duration>            <!-- è¿è¡Œ5åˆ†é’Ÿ -->
  </ThreadGroup>
  
  <HTTPSampler>
    <name>è·å–ç”¨æˆ·ä¿¡æ¯</name>
    <domain>localhost</domain>
    <port>8080</port>
    <path>/api/users/${userId}</path>
    <method>GET</method>
  </HTTPSampler>
</TestPlan>
```

### 10.3 æ€§èƒ½æµ‹è¯•æŒ‡æ ‡


**å…³é”®æŒ‡æ ‡è§£è¯»**ï¼š

| æŒ‡æ ‡åç§° | è¯´æ˜ | ä¼˜ç§€ | è‰¯å¥½ | éœ€è¦æ”¹è¿› |
|----------|------|------|------|----------|
| **å“åº”æ—¶é—´(RT)** | å•ä¸ªè¯·æ±‚å¤„ç†æ—¶é—´ | <100ms | <300ms | >500ms |
| **ååé‡(TPS)** | æ¯ç§’å¤„ç†è¯·æ±‚æ•° | >1000 | >500 | <200 |
| **é”™è¯¯ç‡** | å¤±è´¥è¯·æ±‚æ¯”ä¾‹ | <0.1% | <1% | >5% |
| **CPUä½¿ç”¨ç‡** | æœåŠ¡å™¨CPUå ç”¨ | <60% | <80% | >90% |
| **å†…å­˜ä½¿ç”¨ç‡** | JVMå†…å­˜å ç”¨ | <70% | <85% | >90% |

### 10.4 Spring Bootæ€§èƒ½ç›‘æ§


```yaml
# åº”ç”¨ç›‘æ§é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: "*"  # å¼€æ”¾æ‰€æœ‰ç›‘æ§ç«¯ç‚¹
  endpoint:
    health:
      show-details: always
    metrics:
      enabled: true
  
  # Micrometerç›‘æ§é…ç½®
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles:
        http.server.requests: 0.5, 0.9, 0.95, 0.99
```

### 10.5 å®é™…æ€§èƒ½æµ‹è¯•æµç¨‹


```bash
# 1. å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
docker-compose up -d  # å¯åŠ¨æ•°æ®åº“ã€Redisç­‰ä¾èµ–

# 2. å¯åŠ¨åº”ç”¨
java -jar -Xms2g -Xmx2g your-app.jar

# 3. é¢„çƒ­åº”ç”¨
for i in {1..100}; do
  curl http://localhost:8080/api/users/1
done

# 4. æ‰§è¡Œæ€§èƒ½æµ‹è¯•
jmeter -n -t load-test.jmx -l results.jtl

# 5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
jmeter -g results.jtl -o performance-report/
```

**æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ**ï¼š
- âœ… **é€æ­¥å¢åŠ è´Ÿè½½**ï¼šä»å°è´Ÿè½½å¼€å§‹ï¼Œé€æ­¥å¢åŠ 
- âœ… **çœŸå®æ•°æ®æµ‹è¯•**ï¼šä½¿ç”¨ç”Ÿäº§ç¯å¢ƒç›¸ä¼¼çš„æ•°æ®
- âœ… **å¤šè½®æµ‹è¯•éªŒè¯**ï¼šå¤šæ¬¡è¿è¡Œç¡®ä¿ç»“æœç¨³å®š
- âœ… **ç›‘æ§ç³»ç»Ÿèµ„æº**ï¼šCPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜IO

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™


```
æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆçº§ï¼š
ğŸ¥‡ æ¶æ„è®¾è®¡ > ğŸ¥ˆ é…ç½®è°ƒä¼˜ > ğŸ¥‰ ä»£ç ä¼˜åŒ–

åŸåˆ™ï¼š
âœ… å…ˆæµ‹é‡ï¼Œåä¼˜åŒ–ï¼ˆä¸è¦å‡­æ„Ÿè§‰ä¼˜åŒ–ï¼‰
âœ… è§£å†³ç“¶é¢ˆï¼Œè€Œéæ‰€æœ‰é—®é¢˜
âœ… æƒè¡¡æ€§èƒ½å’Œç»´æŠ¤æ€§
âœ… æŒç»­ç›‘æ§å’Œè°ƒä¼˜
```

### 11.2 æ–°æ‰‹å¸¸è§è¯¯åŒº


| è¯¯åŒº | æ­£ç¡®åšæ³• | è¯´æ˜ |
|------|----------|------|
| **è¿‡æ—©ä¼˜åŒ–** | å…ˆå®ç°åŠŸèƒ½ï¼Œå†æ€§èƒ½è°ƒä¼˜ | é¿å…ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ– |
| **å‚æ•°è¶Šå¤§è¶Šå¥½** | æ ¹æ®å®é™…åœºæ™¯è°ƒæ•´ | è¿æ¥æ± ä¸æ˜¯è¶Šå¤§è¶Šå¥½ |
| **å¿½ç•¥ç›‘æ§** | å»ºç«‹å®Œå–„ç›‘æ§ä½“ç³» | æ²¡æœ‰ç›‘æ§å°±æ˜¯ç›²ç›®ä¼˜åŒ– |
| **å•ç‚¹ä¼˜åŒ–** | ç³»ç»Ÿæ€§åœ°åˆ†æå’Œä¼˜åŒ– | æœ¨æ¡¶æ•ˆåº”ï¼Œè¦æ‰¾æœ€çŸ­æ¿ |

### 11.3 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•


**ğŸš€ å¯åŠ¨ä¼˜åŒ–**ï¼š
- [ ] å‡å°‘ç»„ä»¶æ‰«æèŒƒå›´
- [ ] å¯ç”¨æ‡’åŠ è½½ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- [ ] æ’é™¤ä¸å¿…è¦çš„è‡ªåŠ¨é…ç½®
- [ ] ç›‘æ§å¯åŠ¨æ—¶é—´

**ğŸ’¾ å†…å­˜ä¼˜åŒ–**ï¼š
- [ ] åˆç†é…ç½®è¿æ¥æ± å¤§å°
- [ ] è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´
- [ ] ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- [ ] å®šæœŸåˆ†æå†…å­˜æ³„æ¼

**ğŸŒ ç½‘ç»œä¼˜åŒ–**ï¼š
- [ ] å¯ç”¨HTTP/2
- [ ] é…ç½®è¯·æ±‚å‹ç¼©
- [ ] ä¼˜åŒ–è¶…æ—¶è®¾ç½®
- [ ] é¿å…N+1æŸ¥è¯¢é—®é¢˜

**â˜• JVMè°ƒä¼˜**ï¼š
- [ ] è®¾ç½®åˆé€‚çš„å †å†…å­˜å¤§å°
- [ ] é€‰æ‹©åˆé€‚çš„GCç®—æ³•
- [ ] é…ç½®GCå‚æ•°
- [ ] ç›‘æ§GCæ€§èƒ½

**ğŸ’» ä»£ç ä¼˜åŒ–**ï¼š
- [ ] é¿å…å­—ç¬¦ä¸²é¢‘ç¹æ‹¼æ¥
- [ ] é€‰æ‹©åˆé€‚çš„é›†åˆç±»å‹
- [ ] ä½¿ç”¨å¯¹è±¡æ± é‡ç”¨å¯¹è±¡
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

**âš¡ ç¼“å­˜ä¼˜åŒ–**ï¼š
- [ ] è®¾è®¡å¤šçº§ç¼“å­˜æ¶æ„
- [ ] åˆç†è®¾ç½®ç¼“å­˜å¤§å°å’Œè¿‡æœŸæ—¶é—´
- [ ] é˜²æ­¢ç¼“å­˜ç©¿é€å’Œé›ªå´©
- [ ] ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡

**ğŸ”„ å¼‚æ­¥ä¼˜åŒ–**ï¼š
- [ ] åˆç†é…ç½®çº¿ç¨‹æ± 
- [ ] è¯†åˆ«å¯å¼‚æ­¥å¤„ç†çš„ä¸šåŠ¡
- [ ] ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦
- [ ] å¤„ç†å¼‚æ­¥å¼‚å¸¸æƒ…å†µ

**ğŸ§ª æµ‹è¯•ç›‘æ§**ï¼š
- [ ] å»ºç«‹æ€§èƒ½åŸºçº¿
- [ ] å®šæœŸæ‰§è¡Œå‹åŠ›æµ‹è¯•
- [ ] ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
- [ ] å»ºç«‹å‘Šè­¦æœºåˆ¶

### 11.4 å®æˆ˜ç»éªŒåˆ†äº«


> ğŸ’¡ **ç»éªŒ1**ï¼šä¸è¦ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–ï¼Œå…ˆç”¨ç›‘æ§å·¥å…·æ‰¾åˆ°çœŸæ­£çš„æ€§èƒ½ç“¶é¢ˆã€‚

> ğŸ’¡ **ç»éªŒ2**ï¼šè¿æ¥æ± å¤§å°é€šå¸¸è®¾ç½®ä¸ºCPUæ ¸å¿ƒæ•°çš„2å€æ¯”è¾ƒåˆé€‚ï¼Œä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚

> ğŸ’¡ **ç»éªŒ3**ï¼šç¼“å­˜æ˜¯åŒåˆƒå‰‘ï¼Œä½¿ç”¨ä¸å½“åè€Œä¼šå½±å“æ€§èƒ½ï¼Œä¸€å®šè¦è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ã€‚

> ğŸ’¡ **ç»éªŒ4**ï¼šå¼‚æ­¥å¤„ç†è¦æ³¨æ„å¼‚å¸¸å¤„ç†ï¼Œé¿å…å¼‚æ­¥ä»»åŠ¡é™é»˜å¤±è´¥ã€‚

> ğŸ’¡ **ç»éªŒ5**ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯æŒç»­è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œè¦å»ºç«‹é•¿æœŸç›‘æ§æœºåˆ¶ã€‚

**æ ¸å¿ƒè®°å¿†**ï¼š
- ğŸ¯ **å…ˆæµ‹é‡åä¼˜åŒ–**ï¼šç”¨æ•°æ®è¯´è¯ï¼Œä¸å‡­æ„Ÿè§‰
- âš–ï¸ **å¹³è¡¡æ€§èƒ½ä¸å¤æ‚åº¦**ï¼šä¸è¿‡åº¦è¿½æ±‚æ€§èƒ½
- ğŸ“Š **å»ºç«‹ç›‘æ§ä½“ç³»**ï¼šæŒç»­è·Ÿè¸ªæ€§èƒ½æŒ‡æ ‡
- ğŸ”§ **ç³»ç»Ÿæ€§ä¼˜åŒ–**ï¼šä»æ¶æ„åˆ°ä»£ç å…¨æ–¹ä½è€ƒè™‘
- ğŸ‘¥ **å›¢é˜Ÿåä½œ**ï¼šæ€§èƒ½ä¼˜åŒ–éœ€è¦å¼€å‘å’Œè¿ç»´é…åˆ