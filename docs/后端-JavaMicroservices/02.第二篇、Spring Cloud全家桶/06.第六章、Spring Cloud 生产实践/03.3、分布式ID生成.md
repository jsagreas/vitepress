---
title: 3ã€åˆ†å¸ƒå¼IDç”Ÿæˆ
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼IDåŸºç¡€æ¦‚å¿µ](#1-åˆ†å¸ƒå¼IDåŸºç¡€æ¦‚å¿µ)
2. [é›ªèŠ±ç®—æ³•Snowflakeè¯¦è§£](#2-é›ªèŠ±ç®—æ³•Snowflakeè¯¦è§£)
3. [æ•°æ®åº“è‡ªå¢åºåˆ—æ–¹æ¡ˆ](#3-æ•°æ®åº“è‡ªå¢åºåˆ—æ–¹æ¡ˆ)
4. [UUIDé€šç”¨æ–¹æ¡ˆ](#4-UUIDé€šç”¨æ–¹æ¡ˆ)
5. [Redisè®¡æ•°å™¨æ–¹æ¡ˆ](#5-Redisè®¡æ•°å™¨æ–¹æ¡ˆ)
6. [Leafåˆ†å¸ƒå¼IDæ¡†æ¶](#6-Leafåˆ†å¸ƒå¼IDæ¡†æ¶)
7. [TinyIDè§£å†³æ–¹æ¡ˆ](#7-TinyIDè§£å†³æ–¹æ¡ˆ)
8. [å·æ®µæ¨¡å¼è¯¦è§£](#8-å·æ®µæ¨¡å¼è¯¦è§£)
9. [IDç”Ÿæˆæ€§èƒ½ä¼˜åŒ–](#9-IDç”Ÿæˆæ€§èƒ½ä¼˜åŒ–)
10. [æ–¹æ¡ˆé€‰æ‹©ä¸å¯¹æ¯”](#10-æ–¹æ¡ˆé€‰æ‹©ä¸å¯¹æ¯”)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åˆ†å¸ƒå¼IDåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ID


**ç®€å•ç†è§£**ï¼šåˆ†å¸ƒå¼IDå°±æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºæ¯æ¡æ•°æ®ç”Ÿæˆä¸€ä¸ª**å…¨å±€å”¯ä¸€**çš„æ ‡è¯†ç¬¦ã€‚

```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ å¼€äº†3å®¶åˆ†åº—ï¼ˆ3ä¸ªæ•°æ®åº“ï¼‰ï¼Œæ¯å®¶åº—éƒ½è¦ç»™é¡¾å®¢ç¼–å·
å¦‚æœå„åº—ç‹¬ç«‹ç¼–å·ï¼šåº—A(1,2,3) åº—B(1,2,3) åº—C(1,2,3)
é—®é¢˜ï¼šç¼–å·é‡å¤äº†ï¼

è§£å†³æ–¹æ¡ˆï¼šç»Ÿä¸€ç¼–å·ç³»ç»Ÿ
åº—A(10001,10002,10003) åº—B(20001,20002,20003) åº—C(30001,30002,30003)
è¿™å°±æ˜¯åˆ†å¸ƒå¼IDçš„æ ¸å¿ƒæ€æƒ³
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼ID


**ä¼ ç»Ÿå•æœºé—®é¢˜**ï¼š
```
å•æœºç³»ç»Ÿï¼šä¸€ä¸ªæ•°æ®åº“è‡ªå¢ID
ç”¨æˆ·è¡¨ï¼šid=1,2,3,4,5...
è®¢å•è¡¨ï¼šid=1,2,3,4,5...
âœ… ç®€å•æœ‰æ•ˆ

åˆ†å¸ƒå¼ç³»ç»Ÿï¼šå¤šä¸ªæ•°æ®åº“
æ•°æ®åº“Aï¼šid=1,2,3...
æ•°æ®åº“Bï¼šid=1,2,3...  âŒ IDå†²çªï¼
æ•°æ®åº“Cï¼šid=1,2,3...
```

**ğŸ”¸ æ ¸å¿ƒéœ€æ±‚**
- **å…¨å±€å”¯ä¸€æ€§**ï¼šæ•´ä¸ªç³»ç»Ÿä¸­IDä¸é‡å¤
- **é«˜å¯ç”¨æ€§**ï¼šIDç”ŸæˆæœåŠ¡ä¸èƒ½æŒ‚æ‰
- **é«˜æ€§èƒ½**ï¼šæ¯ç§’ç”Ÿæˆå¤§é‡ID
- **è¶‹åŠ¿é€’å¢**ï¼šæ–°IDæ¯”è€IDå¤§ï¼ˆä¾¿äºæ’åºå’Œç´¢å¼•ï¼‰

### 1.3 åˆ†å¸ƒå¼IDåº”ç”¨åœºæ™¯


**ğŸ“‹ å…¸å‹åº”ç”¨**
```
ğŸ›’ ç”µå•†ç³»ç»Ÿï¼š
- è®¢å•IDï¼šä¿è¯å…¨å±€è®¢å•å·å”¯ä¸€
- å•†å“IDï¼šå¤šåº—é“ºå•†å“æ ‡è¯†
- ç”¨æˆ·IDï¼šè·¨å¹³å°ç”¨æˆ·è¯†åˆ«

ğŸ¦ é‡‘èç³»ç»Ÿï¼š
- äº¤æ˜“æµæ°´å·ï¼šæ¯ç¬”äº¤æ˜“å”¯ä¸€æ ‡è¯†
- è´¦æˆ·IDï¼šåˆ†å¸ƒå¼è´¦æˆ·ç®¡ç†
- é£æ§äº‹ä»¶IDï¼šå®‰å…¨äº‹ä»¶è¿½è¸ª

ğŸ“± ç¤¾äº¤ç³»ç»Ÿï¼š
- æ¶ˆæ¯IDï¼šèŠå¤©è®°å½•æ ‡è¯†
- åŠ¨æ€IDï¼šæœ‹å‹åœˆå†…å®¹æ ‡è¯†
- ç”¨æˆ·å…³ç³»IDï¼šå¥½å‹å…³ç³»æ ‡è¯†
```

---

## 2. â„ï¸ é›ªèŠ±ç®—æ³•Snowflakeè¯¦è§£


### 2.1 é›ªèŠ±ç®—æ³•æ ¸å¿ƒåŸç†


**ğŸ”¸ ç®—æ³•æ¥æº**ï¼šTwitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œå› ä¸ºç”Ÿæˆçš„IDåƒé›ªèŠ±ä¸€æ ·ç‹¬ç‰¹è€Œå¾—åã€‚

**ç®—æ³•ç»“æ„å›¾**ï¼š
```
64ä½é•¿æ•´å‹IDç»“æ„ï¼š
â”Œâ”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚0â”‚              41ä½æ—¶é—´æˆ³                      â”‚ 10ä½æœºå™¨ç  â”‚  12ä½åºåˆ—å·  â”‚
â”‚ â”‚     (ç›¸å¯¹äºæŸä¸ªèµ·å§‹æ—¶é—´çš„æ¯«ç§’æ•°)                â”‚(æ•°æ®ä¸­å¿ƒ+æœºå™¨)â”‚  (åŒæ¯«ç§’å†…)  â”‚
â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…·ä½“åˆ†é…ï¼š
- 1ä½ï¼šç¬¦å·ä½ï¼Œå›ºå®šä¸º0ï¼ˆä¿è¯ç”Ÿæˆçš„IDä¸ºæ­£æ•°ï¼‰
- 41ä½ï¼šæ—¶é—´æˆ³ï¼ˆå¯ç”¨69å¹´ï¼‰
- 10ä½ï¼šæœºå™¨æ ‡è¯†ï¼ˆæ”¯æŒ1024å°æœºå™¨ï¼‰
- 12ä½ï¼šåºåˆ—å·ï¼ˆæ¯æ¯«ç§’å¯ç”Ÿæˆ4096ä¸ªIDï¼‰
```

### 2.2 æ—¶é—´æˆ³éƒ¨åˆ†è¯¦è§£


**â° æ—¶é—´æˆ³è®¡ç®—**
```java
// è®¾å®šä¸€ä¸ªèµ·å§‹æ—¶é—´ï¼ˆepochï¼‰
private final long twepoch = 1609459200000L; // 2021-01-01 00:00:00

// å½“å‰æ—¶é—´æˆ³è®¡ç®—
long timestamp = System.currentTimeMillis();
long offsetTimestamp = timestamp - twepoch;

// 41ä½å¯è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´
æœ€å¤§æ—¶é—´ = 2^41 / (365 * 24 * 3600 * 1000) â‰ˆ 69å¹´
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- å°±åƒç»™æ¯ä¸ªæ—¶é—´ç‚¹æ‰“ä¸Šæ ‡è®°
- 2021å¹´1æœˆ1æ—¥ä½œä¸ºèµ·ç‚¹ï¼ˆç¬¬0æ¯«ç§’ï¼‰
- ä¹‹åæ¯ä¸€æ¯«ç§’éƒ½æœ‰è‡ªå·±çš„ç¼–å·
- 41ä½å¯ä»¥ç”¨69å¹´ï¼Œå¤Ÿç”¨äº†

### 2.3 æœºå™¨æ ‡è¯†éƒ¨åˆ†è¯¦è§£


**ğŸ­ æœºå™¨ç ç»„æˆ**
```
10ä½æœºå™¨æ ‡è¯† = 5ä½æ•°æ®ä¸­å¿ƒID + 5ä½æœºå™¨ID

æ•°æ®ä¸­å¿ƒIDï¼šæ ‡è¯†ä¸åŒçš„æœºæˆ¿
- åŒ—äº¬æœºæˆ¿ï¼šdatacenter = 0
- ä¸Šæµ·æœºæˆ¿ï¼šdatacenter = 1
- å¹¿å·æœºæˆ¿ï¼šdatacenter = 2

æœºå™¨IDï¼šæ ‡è¯†æœºæˆ¿å†…çš„å…·ä½“æœºå™¨
- æœåŠ¡å™¨1ï¼šworker = 0
- æœåŠ¡å™¨2ï¼šworker = 1
- æœåŠ¡å™¨3ï¼šworker = 2

æœ€ç»ˆæœºå™¨æ ‡è¯† = (datacenter << 5) | worker
```

### 2.4 åºåˆ—å·éƒ¨åˆ†è¯¦è§£


**ğŸ”¢ åºåˆ—å·æœºåˆ¶**
```java
private long sequence = 0L; // åºåˆ—å·ä»0å¼€å§‹

// åŒä¸€æ¯«ç§’å†…çš„å¤„ç†é€»è¾‘
if (timestamp == lastTimestamp) {
    // åŒä¸€æ¯«ç§’ï¼Œåºåˆ—å·é€’å¢
    sequence = (sequence + 1) & sequenceMask; // sequenceMask = 4095
    if (sequence == 0) {
        // åºåˆ—å·ç”¨å®Œï¼Œç­‰å¾…ä¸‹ä¸€æ¯«ç§’
        timestamp = waitNextMillis(lastTimestamp);
    }
} else {
    // æ–°çš„æ¯«ç§’ï¼Œåºåˆ—å·é‡ç½®ä¸º0
    sequence = 0L;
}
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- æ¯æ¯«ç§’æœ€å¤šç”Ÿæˆ4096ä¸ªID
- å¦‚æœ1æ¯«ç§’å†…è¯·æ±‚è¶…è¿‡4096æ¬¡ï¼Œå°±ç­‰ä¸‹ä¸€æ¯«ç§’
- æ–°æ¯«ç§’å¼€å§‹ï¼Œåºåˆ—å·é‡æ–°ä»0è®¡æ•°

### 2.5 é›ªèŠ±ç®—æ³•å®ç°


```java
public class SnowflakeIdGenerator {
    // èµ·å§‹æ—¶é—´æˆ³
    private final long twepoch = 1609459200000L;
    
    // æœºå™¨æ ‡è¯†ä½æ•°
    private final long workerIdBits = 5L;
    private final long datacenterIdBits = 5L;
    private final long sequenceBits = 12L;
    
    // æœ€å¤§å€¼è®¡ç®—
    private final long maxWorkerId = -1L ^ (-1L << workerIdBits);
    private final long maxDatacenterId = -1L ^ (-1L << datacenterIdBits);
    private final long sequenceMask = -1L ^ (-1L << sequenceBits);
    
    // ä½ç§»é‡
    private final long workerIdShift = sequenceBits;
    private final long datacenterIdShift = sequenceBits + workerIdBits;
    private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits;
    
    private long workerId;
    private long datacenterId;
    private long sequence = 0L;
    private long lastTimestamp = -1L;
    
    public SnowflakeIdGenerator(long workerId, long datacenterId) {
        this.workerId = workerId;
        this.datacenterId = datacenterId;
    }
    
    public synchronized long nextId() {
        long timestamp = timeGen();
        
        // æ—¶é’Ÿå›æ‹¨æ£€æŸ¥
        if (timestamp < lastTimestamp) {
            throw new RuntimeException("æ—¶é’Ÿå›æ‹¨ï¼Œæ‹’ç»ç”ŸæˆID");
        }
        
        if (lastTimestamp == timestamp) {
            // åŒä¸€æ¯«ç§’å†…ï¼Œåºåˆ—å·é€’å¢
            sequence = (sequence + 1) & sequenceMask;
            if (sequence == 0) {
                // ç­‰å¾…ä¸‹ä¸€æ¯«ç§’
                timestamp = tilNextMillis(lastTimestamp);
            }
        } else {
            // æ–°æ¯«ç§’ï¼Œåºåˆ—å·é‡ç½®
            sequence = 0L;
        }
        
        lastTimestamp = timestamp;
        
        // ç»„è£…ID
        return ((timestamp - twepoch) << timestampLeftShift) |
               (datacenterId << datacenterIdShift) |
               (workerId << workerIdShift) |
               sequence;
    }
    
    private long tilNextMillis(long lastTimestamp) {
        long timestamp = timeGen();
        while (timestamp <= lastTimestamp) {
            timestamp = timeGen();
        }
        return timestamp;
    }
    
    private long timeGen() {
        return System.currentTimeMillis();
    }
}
```

### 2.6 é›ªèŠ±ç®—æ³•ä¼˜ç¼ºç‚¹


| æ–¹é¢ | **ä¼˜åŠ¿** | **åŠ£åŠ¿** |
|------|---------|---------|
| ğŸ¯ **æ€§èƒ½** | `å•æœºQPSå¯è¾¾400ä¸‡+` | `éœ€è¦è§£å†³æ—¶é’Ÿå›æ‹¨é—®é¢˜` |
| ğŸ“Š **å­˜å‚¨** | `64ä½é•¿æ•´å‹ï¼Œå­˜å‚¨é«˜æ•ˆ` | `å ç”¨8å­—èŠ‚ï¼Œæ¯”è‡ªå¢IDå¤§` |
| ğŸ”— **ä¾èµ–** | `æ— å¤–éƒ¨ä¾èµ–ï¼Œæœ¬åœ°ç”Ÿæˆ` | `ä¾èµ–ç³»ç»Ÿæ—¶é’Ÿå‡†ç¡®æ€§` |
| ğŸŒŠ **è¶‹åŠ¿** | `å¤©ç„¶æ—¶é—´æœ‰åº` | `æœºå™¨IDéœ€è¦äººå·¥åˆ†é…` |
| ğŸ“ˆ **æ‰©å±•** | `ç†è®ºæ”¯æŒ1024å°æœºå™¨` | `è¾¾åˆ°ä¸Šé™éœ€è¦æ”¹ç®—æ³•` |

---

## 3. ğŸ—„ï¸ æ•°æ®åº“è‡ªå¢åºåˆ—æ–¹æ¡ˆ


### 3.1 å•æœºè‡ªå¢çš„é—®é¢˜


**ä¼ ç»Ÿåšæ³•**ï¼š
```sql
-- å•æœºæ•°æ®åº“è¡¨
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_no VARCHAR(32),
    user_id BIGINT
);

-- æ’å…¥æ•°æ®è‡ªåŠ¨ç”ŸæˆID
INSERT INTO orders (order_no, user_id) VALUES ('ORD001', 12345);
-- è‡ªåŠ¨ç”Ÿæˆ id = 1
```

**åˆ†å¸ƒå¼ç¯å¢ƒé—®é¢˜**ï¼š
```
æ•°æ®åº“Aï¼šid = 1, 2, 3, 4, 5...
æ•°æ®åº“Bï¼šid = 1, 2, 3, 4, 5...  âŒ é‡å¤äº†ï¼
æ•°æ®åº“Cï¼šid = 1, 2, 3, 4, 5...
```

### 3.2 æ­¥é•¿åˆ†é…æ–¹æ¡ˆ


**ğŸ”¸ åŸºæœ¬æ€è·¯**ï¼šè®©æ¯ä¸ªæ•°æ®åº“æŒ‰ä¸åŒæ­¥é•¿è‡ªå¢ï¼Œé¿å…å†²çªã€‚

```sql
-- æ•°æ®åº“Aé…ç½®
SET $$auto_increment_increment = 3;  -- æ­¥é•¿ä¸º3
SET $$auto_increment_offset = 1;     -- èµ·å§‹å€¼ä¸º1
-- ç”ŸæˆIDï¼š1, 4, 7, 10, 13...

-- æ•°æ®åº“Bé…ç½®  
SET $$auto_increment_increment = 3;  -- æ­¥é•¿ä¸º3
SET $$auto_increment_offset = 2;     -- èµ·å§‹å€¼ä¸º2
-- ç”ŸæˆIDï¼š2, 5, 8, 11, 14...

-- æ•°æ®åº“Cé…ç½®
SET $$auto_increment_increment = 3;  -- æ­¥é•¿ä¸º3
SET $$auto_increment_offset = 3;     -- èµ·å§‹å€¼ä¸º3
-- ç”ŸæˆIDï¼š3, 6, 9, 12, 15...
```

**ç»“æœå±•ç¤º**ï¼š
```
æ—¶é—´çº¿ï¼š1  2  3  4  5  6  7  8  9  10 11 12 13 14 15...
æ•°æ®åº“Aï¼š1     4     7     10    13
æ•°æ®åº“Bï¼š   2     5     8     11    14  
æ•°æ®åº“Cï¼š      3     6     9     12    15

âœ… æ‰€æœ‰IDéƒ½ä¸é‡å¤ï¼
```

### 3.3 ä¸“ç”¨IDç”Ÿæˆè¡¨


**ğŸ”¸ è®¾è®¡æ€è·¯**ï¼šä¸“é—¨å»ºä¸€å¼ è¡¨ï¼Œåªç”¨æ¥ç”ŸæˆIDã€‚

```sql
-- åˆ›å»ºIDç”Ÿæˆè¡¨
CREATE TABLE id_generator (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    business_type VARCHAR(50) NOT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ä¸ºä¸åŒä¸šåŠ¡ç”ŸæˆID
INSERT INTO id_generator (business_type) VALUES ('order');    -- ç”Ÿæˆè®¢å•ID
INSERT INTO id_generator (business_type) VALUES ('user');     -- ç”Ÿæˆç”¨æˆ·ID
INSERT INTO id_generator (business_type) VALUES ('product');  -- ç”Ÿæˆå•†å“ID
```

**Javaä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
public class DbIdGenerator {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public Long generateId(String businessType) {
        // æ’å…¥ä¸€æ¡è®°å½•è·å–è‡ªå¢ID
        String sql = "INSERT INTO id_generator (business_type) VALUES (?)";
        
        KeyHolder keyHolder = new GeneratedKeyHolder();
        jdbcTemplate.update(connection -> {
            PreparedStatement ps = connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
            ps.setString(1, businessType);
            return ps;
        }, keyHolder);
        
        return keyHolder.getKey().longValue();
    }
}
```

### 3.4 æ•°æ®åº“æ–¹æ¡ˆä¼˜ç¼ºç‚¹


**âœ… ä¼˜åŠ¿**
```
ğŸ¯ ç®€å•æ˜“æ‡‚ï¼šåˆ©ç”¨æ•°æ®åº“ç°æœ‰ç‰¹æ€§
ğŸ”’ å¼ºä¸€è‡´æ€§ï¼šæ•°æ®åº“ACIDä¿è¯
ğŸ“ˆ è‡ªç„¶é€’å¢ï¼šå¤©ç„¶æœ‰åºï¼Œåˆ©äºç´¢å¼•
ğŸ› ï¸ æ˜“ç»´æŠ¤ï¼šä¸éœ€è¦é¢å¤–ç»„ä»¶
```

**âŒ åŠ£åŠ¿**  
```
âš¡ æ€§èƒ½ç“¶é¢ˆï¼šæ•°æ®åº“è¯»å†™æ˜¯ç“¶é¢ˆ
ğŸ”§ æ‰©å±•å›°éš¾ï¼šå¢åŠ èŠ‚ç‚¹éœ€è¦é‡æ–°é…ç½®
ğŸ“Š å•ç‚¹é£é™©ï¼šæ•°æ®åº“æŒ‚äº†å°±æ— æ³•ç”ŸæˆID
ğŸŒ ç½‘ç»œä¾èµ–ï¼šæ¯æ¬¡ç”Ÿæˆéƒ½è¦è®¿é—®æ•°æ®åº“
```

---

## 4. ğŸ†” UUIDé€šç”¨æ–¹æ¡ˆ


### 4.1 UUIDåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯UUID**ï¼šUUIDï¼ˆUniversally Unique Identifierï¼‰é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼Œæ˜¯ä¸€ä¸ª128ä½çš„æ ‡è¯†ç¬¦ã€‚

**æ ‡å‡†æ ¼å¼**ï¼š
```
UUIDç¤ºä¾‹ï¼š550e8400-e29b-41d4-a716-446655440000
æ ¼å¼è¯´æ˜ï¼š8-4-4-4-12 (32ä¸ª16è¿›åˆ¶å­—ç¬¦ï¼Œç”¨è¿å­—ç¬¦åˆ†éš”)

ä½æ•°ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   32ä½     â”‚ 16ä½ â”‚ 16ä½ â”‚ 16ä½ â”‚    48ä½      â”‚
â”‚  æ—¶é—´æˆ³ä½ä½  â”‚æ—¶é—´æˆ³ä¸­â”‚ç‰ˆæœ¬+æ—¶â”‚å˜ä½“+ â”‚   èŠ‚ç‚¹æ ‡è¯†    â”‚
â”‚           â”‚  ä½  â”‚æˆ³é«˜ä½ â”‚ æ—¶é’Ÿ  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 UUIDç‰ˆæœ¬ç±»å‹


**ğŸ“‹ å¸¸ç”¨ç‰ˆæœ¬**

**Version 1 (åŸºäºæ—¶é—´)**ï¼š
```java
// åŸºäºMACåœ°å€å’Œæ—¶é—´æˆ³
UUID uuid1 = Generators.timeBasedGenerator().generate();
System.out.println(uuid1); // 550e8400-e29b-41d4-a716-446655440000

ç‰¹ç‚¹ï¼š
âœ… åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œå¯æ’åº
âŒ æš´éœ²MACåœ°å€ï¼Œæœ‰éšç§é—®é¢˜
```

**Version 4 (éšæœºæ•°)**ï¼š
```java
// åŸºäºéšæœºæ•°ç”Ÿæˆï¼ˆæœ€å¸¸ç”¨ï¼‰
UUID uuid4 = UUID.randomUUID();
System.out.println(uuid4); // 123e4567-e89b-12d3-a456-426614174000

ç‰¹ç‚¹ï¼š
âœ… å®Œå…¨éšæœºï¼Œéšç§æ€§å¥½
âŒ æ— æ³•æ’åºï¼Œæ€§èƒ½ç¨å·®
```

### 4.3 Javaä¸­ä½¿ç”¨UUID


```java
public class UuidGenerator {
    
    // ç”ŸæˆéšæœºUUID
    public String generateRandomId() {
        return UUID.randomUUID().toString();
    }
    
    // ç”Ÿæˆæ— è¿å­—ç¬¦çš„UUID
    public String generateSimpleId() {
        return UUID.randomUUID().toString().replace("-", "");
    }
    
    // æ‰¹é‡ç”ŸæˆUUID
    public List<String> generateBatch(int count) {
        return IntStream.range(0, count)
                .mapToObj(i -> UUID.randomUUID().toString())
                .collect(Collectors.toList());
    }
    
    public static void main(String[] args) {
        UuidGenerator generator = new UuidGenerator();
        
        // ç”Ÿæˆ10ä¸ªUUID
        List<String> ids = generator.generateBatch(10);
        ids.forEach(System.out::println);
    }
}
```

### 4.4 UUIDä¼˜åŒ–æ–¹æ¡ˆ


**ğŸ”¸ å‹ç¼©UUIDé•¿åº¦**
```java
public class CompactUuid {
    
    // å°†UUIDè½¬ä¸ºBase64ç¼–ç ï¼ˆ22å­—ç¬¦ï¼‰
    public static String compactUuid() {
        UUID uuid = UUID.randomUUID();
        ByteBuffer bb = ByteBuffer.wrap(new byte[16]);
        bb.putLong(uuid.getMostSignificantBits());
        bb.putLong(uuid.getLeastSignificantBits());
        
        return Base64.getUrlEncoder()
                .withoutPadding()
                .encodeToString(bb.array());
    }
    
    public static void main(String[] args) {
        // æ ‡å‡†UUIDï¼š36å­—ç¬¦
        String standard = UUID.randomUUID().toString();
        System.out.println("æ ‡å‡†UUID: " + standard);
        
        // å‹ç¼©UUIDï¼š22å­—ç¬¦  
        String compact = compactUuid();
        System.out.println("å‹ç¼©UUID: " + compact);
    }
}
```

### 4.5 UUIDæ–¹æ¡ˆç‰¹ç‚¹


| æ–¹é¢ | **æè¿°** | **è¯„åˆ†** |
|------|---------|---------|
| ğŸ¯ **å”¯ä¸€æ€§** | `å…¨çƒå”¯ä¸€ï¼Œå†²çªæ¦‚ç‡æä½` | â­â­â­â­â­ |
| âš¡ **æ€§èƒ½** | `æœ¬åœ°ç”Ÿæˆï¼Œæ— ç½‘ç»œè°ƒç”¨` | â­â­â­â­â˜† |
| ğŸ“Š **å­˜å‚¨** | `128ä½ï¼Œå ç”¨16å­—èŠ‚` | â­â­â˜†â˜†â˜† |
| ğŸ“ˆ **æœ‰åºæ€§** | `éšæœºç”Ÿæˆï¼Œæ— æ³•æ’åº` | â­â˜†â˜†â˜†â˜† |
| ğŸ› ï¸ **å¤æ‚åº¦** | `ä½¿ç”¨ç®€å•ï¼Œæ— éœ€é…ç½®` | â­â­â­â­â­ |

**é€‚ç”¨åœºæ™¯**ï¼š
```
âœ… é€‚ç”¨äºï¼š
- å¯¹IDé•¿åº¦ä¸æ•æ„Ÿçš„åœºæ™¯
- ä¸éœ€è¦IDæœ‰åºçš„ä¸šåŠ¡
- å¿«é€Ÿå¼€å‘å’ŒåŸå‹éªŒè¯

âŒ ä¸é€‚ç”¨äºï¼š
- å¯¹å­˜å‚¨ç©ºé—´æ•æ„Ÿçš„å¤§æ•°æ®åœºæ™¯
- éœ€è¦IDæœ‰åºçš„æ’åºæŸ¥è¯¢
- å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
```

---

## 5. ğŸ”¢ Redisè®¡æ•°å™¨æ–¹æ¡ˆ


### 5.1 Redisè®¡æ•°å™¨åŸºæœ¬åŸç†


**ğŸ”¸ æ ¸å¿ƒæ€æƒ³**ï¼šåˆ©ç”¨Redisçš„åŸå­æ€§æ“ä½œï¼Œå®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è®¡æ•°å™¨ã€‚

```
Redisè®¡æ•°å™¨æµç¨‹ï¼š
å®¢æˆ·ç«¯A  â”€â”€â”
å®¢æˆ·ç«¯B  â”€â”€â”¼â”€â”€â†’ RedisæœåŠ¡å™¨ â”€â”€â†’ INCR counter â”€â”€â†’ è¿”å›å”¯ä¸€ID
å®¢æˆ·ç«¯C  â”€â”€â”˜

æ¯æ¬¡è¯·æ±‚Redisæ‰§è¡ŒINCRæ“ä½œï¼š
ç¬¬1æ¬¡è¯·æ±‚ï¼šINCR id_counter â†’ è¿”å› 1
ç¬¬2æ¬¡è¯·æ±‚ï¼šINCR id_counter â†’ è¿”å› 2  
ç¬¬3æ¬¡è¯·æ±‚ï¼šINCR id_counter â†’ è¿”å› 3
...
```

### 5.2 åŸºç¡€å®ç°æ–¹å¼


```java
@Component
public class RedisIdGenerator {
    
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    // ç”Ÿæˆå…¨å±€å”¯ä¸€ID
    public Long generateId() {
        String key = "global_id_counter";
        return redisTemplate.opsForValue().increment(key);
    }
    
    // æŒ‰ä¸šåŠ¡ç±»å‹ç”ŸæˆID
    public Long generateId(String businessType) {
        String key = "id_counter:" + businessType;
        return redisTemplate.opsForValue().increment(key);
    }
    
    // æ‰¹é‡ç”ŸæˆID
    public List<Long> generateBatch(String businessType, int count) {
        String key = "id_counter:" + businessType;
        Long startId = redisTemplate.opsForValue().increment(key, count);
        
        List<Long> ids = new ArrayList<>();
        for (int i = count; i >= 1; i--) {
            ids.add(startId - i + 1);
        }
        return ids;
    }
}
```

### 5.3 å¢å¼ºç‰ˆå®ç°


**ğŸ”¸ å¸¦è¿‡æœŸæ—¶é—´çš„è®¡æ•°å™¨**
```java
@Service
public class EnhancedRedisIdGenerator {
    
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    // æŒ‰å¤©é‡ç½®çš„IDè®¡æ•°å™¨
    public String generateDailyId(String prefix) {
        String date = LocalDate.now().format(DateTimeFormatter.ofPattern("yyyyMMdd"));
        String key = prefix + ":" + date;
        
        // è·å–å½“å¤©çš„è®¡æ•°
        Long counter = redisTemplate.opsForValue().increment(key);
        
        // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç¬¬äºŒå¤©å‡Œæ™¨è¿‡æœŸï¼‰
        if (counter == 1) {
            redisTemplate.expireAt(key, LocalDateTime.now().plusDays(1).withHour(0).withMinute(0).withSecond(0));
        }
        
        // æ ¼å¼åŒ–IDï¼šORDER20240922000001
        return String.format("%s%s%06d", prefix, date, counter);
    }
    
    // åˆ†æ®µIDç”Ÿæˆï¼ˆé¿å…è¿ç»­ï¼‰
    public Long generateSegmentId(String businessType) {
        String key = "segment:" + businessType;
        
        // æ¯æ¬¡é€’å¢ä¸€ä¸ªéšæœºæ•°ï¼ˆ100-999ï¼‰
        int increment = ThreadLocalRandom.current().nextInt(100, 1000);
        return redisTemplate.opsForValue().increment(key, increment);
    }
}
```

### 5.4 é«˜å¯ç”¨æ–¹æ¡ˆ


**ğŸ”¸ Redisé›†ç¾¤æ”¯æŒ**
```java
@Configuration
public class RedisIdConfig {
    
    // Redisä¸»ä»é…ç½®
    @Bean
    public RedisConnectionFactory redisConnectionFactory() {
        LettuceConnectionFactory factory = new LettuceConnectionFactory();
        // é…ç½®ä¸»ä»å¤åˆ¶ï¼Œæé«˜å¯ç”¨æ€§
        return factory;
    }
    
    // å¸¦é‡è¯•çš„IDç”Ÿæˆå™¨
    @Bean
    public RetryTemplate retryTemplate() {
        return RetryTemplate.builder()
                .maxAttempts(3)
                .fixedBackoff(100)
                .retryOn(RedisConnectionFailureException.class)
                .build();
    }
}

@Service
public class HighAvailabilityIdGenerator {
    
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    @Autowired
    private RetryTemplate retryTemplate;
    
    public Long generateIdWithRetry(String businessType) {
        return retryTemplate.execute(context -> {
            String key = "ha_id:" + businessType;
            return redisTemplate.opsForValue().increment(key);
        });
    }
}
```

### 5.5 Redisæ–¹æ¡ˆç‰¹ç‚¹


**âœ… ä¼˜åŠ¿**
```
âš¡ é«˜æ€§èƒ½ï¼šRediså†…å­˜æ“ä½œï¼Œé€Ÿåº¦æå¿«
ğŸ”„ åŸå­æ€§ï¼šINCRæ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨
ğŸ“ˆ è‡ªç„¶é€’å¢ï¼šç”Ÿæˆçš„IDå¤©ç„¶æœ‰åº
ğŸ› ï¸ ç®€å•æ˜“ç”¨ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿
ğŸŒ åˆ†å¸ƒå¼ï¼šå¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼ç¯å¢ƒ
```

**âŒ åŠ£åŠ¿**
```
ğŸ“Š å¤–éƒ¨ä¾èµ–ï¼šä¾èµ–RedisæœåŠ¡å¯ç”¨æ€§
ğŸ’¾ æŒä¹…åŒ–ï¼šéœ€è¦é…ç½®RedisæŒä¹…åŒ–é˜²æ­¢æ•°æ®ä¸¢å¤±
ğŸ”§ å•ç‚¹é£é™©ï¼šRedisæŒ‚æ‰æ— æ³•ç”ŸæˆID
ğŸ¯ é‡å¤é£é™©ï¼šRedisæ•°æ®ä¸¢å¤±å¯èƒ½å¯¼è‡´IDé‡å¤
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**
```
âœ… æ¨èä½¿ç”¨ï¼š
- å·²æœ‰RedisåŸºç¡€è®¾æ–½
- å¯¹æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯
- éœ€è¦æœ‰åºIDçš„ä¸šåŠ¡
- ä¸­å°è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿ

âš ï¸ è°¨æ…ä½¿ç”¨ï¼š
- å¯¹å¯ç”¨æ€§è¦æ±‚æé«˜çš„æ ¸å¿ƒä¸šåŠ¡
- æ— Redisè¿ç»´ç»éªŒçš„å›¢é˜Ÿ
- ç½‘ç»œä¸ç¨³å®šçš„ç¯å¢ƒ
```

---

## 6. ğŸŒ¿ Leafåˆ†å¸ƒå¼IDæ¡†æ¶


### 6.1 Leafæ¡†æ¶ä»‹ç»


**ğŸ”¸ ä»€ä¹ˆæ˜¯Leaf**ï¼šç¾å›¢å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆæ¡†æ¶ï¼Œæä¾›äº†ä¸¤ç§IDç”Ÿæˆæ–¹å¼ï¼š
- **Leaf-segment**ï¼šæ•°æ®åº“å·æ®µæ¨¡å¼
- **Leaf-snowflake**ï¼šé›ªèŠ±ç®—æ³•æ¨¡å¼

```
Leafæ¶æ„å›¾ï¼š
                    å®¢æˆ·ç«¯åº”ç”¨
                        â”‚
                        â–¼
                   Leaf-Server
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   è·¯ç”±å±‚     â”‚
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚ Segmentæ¨¡å¼  â”‚ â† æ•°æ®åº“å·æ®µ
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
                   â”‚Snowflakeæ¨¡å¼â”‚ â† é›ªèŠ±ç®—æ³•
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                   â–¼         â–¼
                æ•°æ®åº“    ZooKeeper
```

### 6.2 å¿«é€Ÿé›†æˆLeaf


**Mavenä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.sankuai.inf.leaf</groupId>
    <artifactId>leaf-boot-starter</artifactId>
    <version>1.0.1</version>
</dependency>
```

**é…ç½®æ–‡ä»¶**ï¼š
```yaml
leaf:
  name: com.company.leaf
  segment:
    enable: true
    url: jdbc:mysql://localhost:3306/leaf
    username: root
    password: password
  snowflake:
    enable: true
    zk:
      address: localhost:2181
      port: 2181
```

### 6.3 Leaf-Segmentä½¿ç”¨


**ğŸ”¸ æ•°æ®åº“è¡¨ç»“æ„**
```sql
CREATE TABLE leaf_alloc (
    biz_tag VARCHAR(128) NOT NULL DEFAULT '' COMMENT 'ä¸šåŠ¡æ ‡è¯†',
    max_id BIGINT(20) NOT NULL DEFAULT '1' COMMENT 'å½“å‰æœ€å¤§ID', 
    step INT(11) NOT NULL DEFAULT '1000' COMMENT 'æ­¥é•¿',
    description VARCHAR(256) DEFAULT NULL COMMENT 'æè¿°',
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (biz_tag)
);

-- æ’å…¥ä¸šåŠ¡é…ç½®
INSERT INTO leaf_alloc (biz_tag, max_id, step, description) 
VALUES ('order', 1, 2000, 'è®¢å•ID');

INSERT INTO leaf_alloc (biz_tag, max_id, step, description) 
VALUES ('user', 1, 1000, 'ç”¨æˆ·ID');
```

**Javaä»£ç ä½¿ç”¨**ï¼š
```java
@RestController
public class IdController {
    
    @Autowired
    private SegmentService segmentService;
    
    // è·å–è®¢å•ID
    @GetMapping("/api/segment/get/order")
    public Result getOrderId() {
        return segmentService.getId("order");
    }
    
    // è·å–ç”¨æˆ·ID
    @GetMapping("/api/segment/get/user") 
    public Result getUserId() {
        return segmentService.getId("user");
    }
}

// ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨
@Service
public class OrderService {
    
    @Autowired
    private SegmentService segmentService;
    
    public void createOrder() {
        // ç”Ÿæˆè®¢å•ID
        Result result = segmentService.getId("order");
        if (result.getStatus() == Status.SUCCESS) {
            Long orderId = result.getId();
            // ä½¿ç”¨è®¢å•IDåˆ›å»ºè®¢å•
            System.out.println("ç”Ÿæˆè®¢å•ID: " + orderId);
        }
    }
}
```

### 6.4 Leaf-Snowflakeä½¿ç”¨


```java
@RestController
public class SnowflakeController {
    
    @Autowired
    private SnowflakeService snowflakeService;
    
    // è·å–é›ªèŠ±ç®—æ³•ID
    @GetMapping("/api/snowflake/get/{key}")
    public Result getSnowflakeId(@PathVariable("key") String key) {
        return snowflakeService.getId(key);
    }
}

// ä¸šåŠ¡ä½¿ç”¨ç¤ºä¾‹
@Service
public class MessageService {
    
    @Autowired  
    private SnowflakeService snowflakeService;
    
    public void sendMessage(String content) {
        // ç”Ÿæˆæ¶ˆæ¯ID
        Result result = snowflakeService.getId("message");
        if (result.getStatus() == Status.SUCCESS) {
            Long messageId = result.getId();
            // å‘é€æ¶ˆæ¯
            System.out.println("æ¶ˆæ¯ID: " + messageId + ", å†…å®¹: " + content);
        }
    }
}
```

### 6.5 Leafæ¡†æ¶ç‰¹ç‚¹


**âœ… æ ¸å¿ƒä¼˜åŠ¿**
```
ğŸ­ åŒæ¨¡å¼æ”¯æŒï¼šSegment + Snowflakeï¼Œå¯æŒ‰éœ€é€‰æ‹©
ğŸ”„ é«˜å¯ç”¨æ€§ï¼šæ”¯æŒå®¹ç¾å’Œæ•…éšœè½¬ç§»
âš¡ é«˜æ€§èƒ½ï¼šSegmentæ¨¡å¼å¯è¾¾5ä¸‡QPS+
ğŸ› ï¸ æ˜“éƒ¨ç½²ï¼šæä¾›HTTPæœåŠ¡ï¼Œè¯­è¨€æ— å…³
ğŸ“Š ç›‘æ§å®Œå–„ï¼šæä¾›è¯¦ç»†çš„ç›‘æ§æŒ‡æ ‡
ğŸ”§ é…ç½®çµæ´»ï¼šæ”¯æŒåŠ¨æ€è°ƒæ•´æ­¥é•¿ç­‰å‚æ•°
```

**ğŸ¯ ä½¿ç”¨å»ºè®®**
```
é€‰æ‹©Segmentæ¨¡å¼ï¼š
âœ… éœ€è¦è¿ç»­é€’å¢çš„ID
âœ… å¯¹IDæ€§èƒ½è¦æ±‚ä¸æ˜¯æè‡´
âœ… æœ‰æ•°æ®åº“åŸºç¡€è®¾æ–½

é€‰æ‹©Snowflakeæ¨¡å¼ï¼š  
âœ… å¯¹æ€§èƒ½è¦æ±‚æé«˜
âœ… å¯æ¥å—IDä¸å®Œå…¨è¿ç»­
âœ… æœ‰ZooKeeperç¯å¢ƒ
```

---

## 7. ğŸ”§ TinyIDè§£å†³æ–¹æ¡ˆ


### 7.1 TinyIDæ¡†æ¶ä»‹ç»  


**ğŸ”¸ ä»€ä¹ˆæ˜¯TinyID**ï¼šæ»´æ»´å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆæ¡†æ¶ï¼Œä¸“æ³¨äº**è½»é‡çº§**å’Œ**é«˜æ€§èƒ½**ã€‚

```
TinyIDç‰¹ç‚¹ï¼š
- åŸºäºæ•°æ®åº“å·æ®µæ¨¡å¼
- æ”¯æŒå¤šä¸šåŠ¡çº¿éš”ç¦»  
- æä¾›SDKå’ŒHTTPä¸¤ç§æ¥å…¥æ–¹å¼
- å†…ç½®ç®¡ç†åå°
- æ”¯æŒIDå·æ®µé¢„åŠ è½½
```

**æ¶æ„å¯¹æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹æ¡ˆï¼šæ¯æ¬¡è¯·æ±‚ â†’ æ•°æ®åº“ â†’ è·å–ID
æ€§èƒ½ç“¶é¢ˆï¼šæ•°æ®åº“æˆä¸ºç“¶é¢ˆ

TinyIDæ–¹æ¡ˆï¼šæ‰¹é‡è·å– â†’ æœ¬åœ°ç¼“å­˜ â†’ å¿«é€Ÿåˆ†å‘
æ€§èƒ½æå‡ï¼šå‡å°‘90%æ•°æ®åº“è®¿é—®
```

### 7.2 TinyIDå¿«é€Ÿæ¥å…¥


**ğŸ”¸ Mavenä¾èµ–**
```xml
<dependency>
    <groupId>com.xiaoju.uemc.tinyid</groupId>
    <artifactId>tinyid-client</artifactId>
    <version>0.1.0</version>
</dependency>
```

**ğŸ”¸ é…ç½®æ–‡ä»¶**
```properties
# TinyIDæœåŠ¡åœ°å€
tinyid.server=http://localhost:9999/tinyid/
# ä»¤ç‰Œï¼ˆç”¨äºé‰´æƒï¼‰
tinyid.token=your-token-here
# å·æ®µé¢„åŠ è½½å¤§å°
tinyid.batch.size=1000
```

### 7.3 TinyIDä½¿ç”¨ç¤ºä¾‹


```java
// 1. åŸºç¡€ä½¿ç”¨æ–¹å¼
@Service
public class TinyIdService {
    
    // ç”Ÿæˆé»˜è®¤ä¸šåŠ¡ID
    public Long generateId() {
        return TinyId.nextId("default");
    }
    
    // æŒ‰ä¸šåŠ¡ç±»å‹ç”ŸæˆID
    public Long generateOrderId() {
        return TinyId.nextId("order");
    }
    
    public Long generateUserId() {
        return TinyId.nextId("user");
    }
    
    // æ‰¹é‡ç”ŸæˆID
    public List<Long> generateBatchIds(String bizType, int count) {
        return TinyId.nextId(bizType, count);
    }
}

// 2. å®é™…ä¸šåŠ¡ä½¿ç”¨
@Service
public class BusinessService {
    
    public void createOrder(OrderRequest request) {
        // ç”Ÿæˆè®¢å•ID
        Long orderId = TinyId.nextId("order");
        
        Order order = new Order();
        order.setId(orderId);
        order.setUserId(request.getUserId());
        order.setAmount(request.getAmount());
        
        // ä¿å­˜è®¢å•
        orderRepository.save(order);
        
        log.info("åˆ›å»ºè®¢å•æˆåŠŸï¼Œè®¢å•ID: {}", orderId);
    }
    
    public void createUser(UserRequest request) {
        // ç”Ÿæˆç”¨æˆ·ID  
        Long userId = TinyId.nextId("user");
        
        User user = new User();
        user.setId(userId);
        user.setUsername(request.getUsername());
        user.setEmail(request.getEmail());
        
        // ä¿å­˜ç”¨æˆ·
        userRepository.save(user);
        
        log.info("åˆ›å»ºç”¨æˆ·æˆåŠŸï¼Œç”¨æˆ·ID: {}", userId);
    }
}
```

### 7.4 TinyIDç®¡ç†é…ç½®


**ğŸ”¸ æ•°æ®åº“è¡¨ç»“æ„**
```sql
-- ä¸šåŠ¡é…ç½®è¡¨
CREATE TABLE tiny_id_info (
    id BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ä¸»é”®',
    biz_type VARCHAR(63) NOT NULL DEFAULT '' COMMENT 'ä¸šåŠ¡ç±»å‹',
    begin_id BIGINT(20) NOT NULL DEFAULT '0' COMMENT 'å¼€å§‹id',
    max_id BIGINT(20) NOT NULL DEFAULT '0' COMMENT 'å½“å‰æœ€å¤§id', 
    step INT(11) DEFAULT '0' COMMENT 'æ­¥é•¿',
    delta INT(11) NOT NULL DEFAULT '1' COMMENT 'æ¯æ¬¡idå¢é‡',
    remainder INT(11) NOT NULL DEFAULT '0' COMMENT 'ä½™æ•°',
    create_time TIMESTAMP NOT NULL DEFAULT '2018-07-21 23:52:58' COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time TIMESTAMP NOT NULL DEFAULT '2018-07-22 23:52:58' COMMENT 'æ›´æ–°æ—¶é—´',
    version BIGINT(20) NOT NULL DEFAULT '0' COMMENT 'ç‰ˆæœ¬å·',
    PRIMARY KEY (id),
    UNIQUE KEY uniq_biz_type (biz_type)
);

-- æ’å…¥ä¸šåŠ¡é…ç½®
INSERT INTO tiny_id_info (biz_type, begin_id, max_id, step, delta, remainder) 
VALUES ('order', 1, 1, 100000, 1, 0);

INSERT INTO tiny_id_info (biz_type, begin_id, max_id, step, delta, remainder) 
VALUES ('user', 1, 1, 50000, 1, 0);
```

### 7.5 TinyIDé«˜çº§ç‰¹æ€§


**ğŸ”¸ é¢„åŠ è½½æœºåˆ¶**
```java
// TinyIDå†…éƒ¨é¢„åŠ è½½é€»è¾‘ç¤ºä¾‹
public class SegmentBuffer {
    private Segment current;    // å½“å‰ä½¿ç”¨çš„å·æ®µ
    private Segment next;       // é¢„åŠ è½½çš„å·æ®µ
    private volatile boolean nextReady = false;
    
    public Long getId() {
        // å½“å‰å·æ®µç”¨å®Œ60%æ—¶ï¼Œå¼‚æ­¥åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µ
        if (current.getUsagePercent() > 0.6 && !nextReady) {
            loadNextSegment();
        }
        
        // å½“å‰å·æ®µç”¨å®Œï¼Œåˆ‡æ¢åˆ°next
        if (current.isEmpty() && nextReady) {
            switchSegment();
        }
        
        return current.nextId();
    }
}
```

**ğŸ”¸ å®¹ç¾æœºåˆ¶**
```java
@Configuration
public class TinyIdConfig {
    
    // é…ç½®å¤šä¸ªTinyIDæœåŠ¡åœ°å€
    @Bean
    public TinyIdClient tinyIdClient() {
        List<String> serverList = Arrays.asList(
            "http://tinyid-server1:9999/tinyid/",
            "http://tinyid-server2:9999/tinyid/",
            "http://tinyid-server3:9999/tinyid/"
        );
        
        return TinyIdClient.builder()
                .serverList(serverList)
                .token("your-token")
                .timeout(5000)
                .build();
    }
}
```

### 7.6 TinyIDæ–¹æ¡ˆè¯„ä¼°


| ç‰¹æ€§ | **è¡¨ç°** | **è¯´æ˜** |
|------|---------|---------|
| ğŸ¯ **æ€§èƒ½** | â­â­â­â­â­ | `æœ¬åœ°ç¼“å­˜ï¼ŒQPSå¯è¾¾100ä¸‡+` |
| ğŸ”§ **å¤æ‚åº¦** | â­â­â­â˜†â˜† | `éœ€è¦éƒ¨ç½²TinyIDæœåŠ¡å™¨` |
| ğŸ“Š **å­˜å‚¨** | â­â­â­â­â˜† | `64ä½é•¿æ•´å‹ï¼Œå­˜å‚¨é«˜æ•ˆ` |
| ğŸŒŠ **æœ‰åºæ€§** | â­â­â­â­â­ | `ä¸¥æ ¼é€’å¢ï¼Œä¾¿äºæ’åº` |
| ğŸ› ï¸ **è¿ç»´** | â­â­â­â˜†â˜† | `æä¾›ç®¡ç†åå°ï¼Œç›¸å¯¹å‹å¥½` |

**ğŸ¯ é€‚ç”¨åœºæ™¯æ¨è**
```
âœ… å¼ºçƒˆæ¨èï¼š
- å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ
- å¯¹IDè¿ç»­æ€§æœ‰è¦æ±‚
- æœ‰ä¸“é—¨è¿ç»´å›¢é˜Ÿ
- QPSè¦æ±‚è¾ƒé«˜(>10ä¸‡)

âš ï¸ è°¨æ…è€ƒè™‘ï¼š
- å°å‹é¡¹ç›®(æ€é¸¡ç”¨ç‰›åˆ€)
- è¿ç»´èƒ½åŠ›æœ‰é™çš„å›¢é˜Ÿ
- å¯¹éƒ¨ç½²å¤æ‚åº¦æ•æ„Ÿçš„åœºæ™¯
```

---

## 8. ğŸ“Š å·æ®µæ¨¡å¼è¯¦è§£


### 8.1 å·æ®µæ¨¡å¼åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å·æ®µæ¨¡å¼**ï¼šä»æ•°æ®åº“æ‰¹é‡è·å–ä¸€æ®µè¿ç»­çš„IDå·ç ï¼Œç„¶ååœ¨åº”ç”¨å†…å­˜ä¸­åˆ†å‘ï¼Œç”¨å®Œåå†è·å–ä¸‹ä¸€ä¸ªå·æ®µã€‚

```
å·æ®µæ¨¡å¼å·¥ä½œæµç¨‹ï¼š

æ­¥éª¤1ï¼šåº”ç”¨å¯åŠ¨æ—¶ç”³è¯·å·æ®µ
æ•°æ®åº“ï¼šmax_id = 1000, step = 100
è¿”å›å·æ®µï¼š[1001, 1100]

æ­¥éª¤2ï¼šåº”ç”¨æœ¬åœ°åˆ†å‘ID  
åˆ†å‘ï¼š1001, 1002, 1003, ..., 1100

æ­¥éª¤3ï¼šå·æ®µç”¨å®Œï¼Œç”³è¯·æ–°å·æ®µ
æ•°æ®åº“ï¼šmax_id = 1100, step = 100  
è¿”å›å·æ®µï¼š[1101, 1200]

æ­¥éª¤4ï¼šç»§ç»­æœ¬åœ°åˆ†å‘
åˆ†å‘ï¼š1101, 1102, 1103, ..., 1200
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- å°±åƒé“¶è¡Œå–å·æœºåˆ¶
- ä¸æ˜¯æ¯ä¸ªäººéƒ½è¦å»æŸœå°åŠç†
- å–å·æœºä¸€æ¬¡æ€§å‡†å¤‡100ä¸ªå·ç 
- å‘å®Œäº†å†å»åå°ç”³è¯·ä¸‹ä¸€æ‰¹

### 8.2 å·æ®µæ¨¡å¼æ ¸å¿ƒç»„ä»¶


**ğŸ”¸ æ•°æ®åº“è®¾è®¡**
```sql
CREATE TABLE id_segment (
    biz_type VARCHAR(50) NOT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    max_id BIGINT NOT NULL DEFAULT 0 COMMENT 'å½“å‰æœ€å¤§ID',
    step INT NOT NULL DEFAULT 1000 COMMENT 'å·æ®µæ­¥é•¿',
    description VARCHAR(200) COMMENT 'æè¿°',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (biz_type)
);

-- åˆå§‹åŒ–ä¸šåŠ¡é…ç½®
INSERT INTO id_segment (biz_type, max_id, step, description) VALUES 
('order', 0, 1000, 'è®¢å•ä¸šåŠ¡'),
('user', 0, 500, 'ç”¨æˆ·ä¸šåŠ¡'),
('product', 0, 2000, 'å•†å“ä¸šåŠ¡');
```

**ğŸ”¸ å·æ®µè·å–é€»è¾‘**
```java
@Component
public class SegmentIdGenerator {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    // çº¿ç¨‹å®‰å…¨çš„å·æ®µç¼“å­˜
    private final ConcurrentHashMap<String, Segment> segmentCache = new ConcurrentHashMap<>();
    
    public Long nextId(String bizType) {
        Segment segment = segmentCache.get(bizType);
        
        // é¦–æ¬¡è·å–æˆ–å·æ®µç”¨å®Œ
        if (segment == null || segment.isEmpty()) {
            segment = getNextSegment(bizType);
            segmentCache.put(bizType, segment);
        }
        
        return segment.nextId();
    }
    
    private Segment getNextSegment(String bizType) {
        // åŸå­æ€§æ›´æ–°max_idå¹¶è¿”å›å·æ®µ
        String sql = "UPDATE id_segment SET max_id = max_id + step WHERE biz_type = ?";
        jdbcTemplate.update(sql, bizType);
        
        String querySql = "SELECT max_id, step FROM id_segment WHERE biz_type = ?";
        return jdbcTemplate.queryForObject(querySql, (rs, rowNum) -> {
            long maxId = rs.getLong("max_id");
            int step = rs.getInt("step");
            return new Segment(maxId - step + 1, maxId);
        }, bizType);
    }
}
```

### 8.3 å·æ®µå†…å­˜ç®¡ç†


**ğŸ”¸ Segmentç±»è®¾è®¡**
```java
public class Segment {
    private final long startId;      // å·æ®µå¼€å§‹ID
    private final long endId;        // å·æ®µç»“æŸID  
    private final AtomicLong current; // å½“å‰åˆ†é…åˆ°çš„ID
    
    public Segment(long startId, long endId) {
        this.startId = startId;
        this.endId = endId;
        this.current = new AtomicLong(startId - 1);
    }
    
    // è·å–ä¸‹ä¸€ä¸ªID
    public Long nextId() {
        long next = current.incrementAndGet();
        if (next > endId) {
            return null; // å·æ®µç”¨å®Œ
        }
        return next;
    }
    
    // æ£€æŸ¥å·æ®µæ˜¯å¦ç”¨å®Œ
    public boolean isEmpty() {
        return current.get() >= endId;
    }
    
    // è·å–ä½¿ç”¨ç™¾åˆ†æ¯”
    public double getUsagePercent() {
        long used = current.get() - startId + 1;
        long total = endId - startId + 1;
        return (double) used / total;
    }
    
    // å‰©ä½™IDæ•°é‡
    public long remainingCount() {
        return Math.max(0, endId - current.get());
    }
}
```

### 8.4 åŒBufferä¼˜åŒ–


**ğŸ”¸ é¢„åŠ è½½æœºåˆ¶**ï¼šå½“å‰å·æ®µä½¿ç”¨åˆ°ä¸€å®šæ¯”ä¾‹æ—¶ï¼Œå¼‚æ­¥åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µã€‚

```java
public class DoubleBufferSegmentGenerator {
    
    private volatile Segment current;     // å½“å‰ä½¿ç”¨çš„å·æ®µ
    private volatile Segment next;        // é¢„åŠ è½½çš„å·æ®µ
    private volatile boolean nextReady = false;
    private final Object lock = new Object();
    
    public Long nextId(String bizType) {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦é¢„åŠ è½½
        if (current.getUsagePercent() > 0.6 && !nextReady) {
            loadNextSegmentAsync(bizType);
        }
        
        Long id = current.nextId();
        if (id == null) {
            // å½“å‰å·æ®µç”¨å®Œï¼Œåˆ‡æ¢åˆ°next
            switchToNext(bizType);
            return current.nextId();
        }
        
        return id;
    }
    
    private void loadNextSegmentAsync(String bizType) {
        CompletableFuture.runAsync(() -> {
            synchronized (lock) {
                if (!nextReady) {
                    next = getNextSegment(bizType);
                    nextReady = true;
                }
            }
        });
    }
    
    private void switchToNext(String bizType) {
        synchronized (lock) {
            if (nextReady) {
                current = next;
                next = null;
                nextReady = false;
            } else {
                // æ²¡æœ‰é¢„åŠ è½½æˆåŠŸï¼ŒåŒæ­¥è·å–
                current = getNextSegment(bizType);
            }
        }
    }
}
```

### 8.5 å·æ®µæ¨¡å¼ä¼˜åŠ¿åˆ†æ


**âš¡ æ€§èƒ½ä¼˜åŠ¿**
```
å¯¹æ¯”æ•°æ®ï¼š
- ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªIDéœ€è¦1æ¬¡æ•°æ®åº“è®¿é—®
- å·æ®µæ¨¡å¼ï¼š1000ä¸ªIDåªéœ€è¦1æ¬¡æ•°æ®åº“è®¿é—®
- æ€§èƒ½æå‡ï¼š1000å€å‡å°‘æ•°æ®åº“å‹åŠ›

QPSå¯¹æ¯”ï¼š
- æ•°æ®åº“ç›´è¿ï¼šçº¦1000 QPS
- å·æ®µæ¨¡å¼ï¼šçº¦100ä¸‡ QPS  
- åŒBufferä¼˜åŒ–ï¼šçº¦200ä¸‡ QPS
```

**ğŸ”„ æ‰©å±•æ€§ä¼˜åŠ¿**
```
æ°´å¹³æ‰©å±•ï¼š
- å¤šä¸ªåº”ç”¨å®ä¾‹åŒæ—¶è·å–å·æ®µ
- æ¯ä¸ªå®ä¾‹ç‹¬ç«‹åˆ†å‘ID
- æ•°æ®åº“å‹åŠ›æ’å®šä¸å˜

å‚ç›´æ‰©å±•ï¼š
- è°ƒæ•´stepå‚æ•°æ§åˆ¶å·æ®µå¤§å°
- ä¸šåŠ¡é«˜å³°æœŸå¯ä¸´æ—¶å¢å¤§step
- çµæ´»åº”å¯¹æµé‡å˜åŒ–
```

**ğŸ› ï¸ è¿ç»´ä¼˜åŠ¿**
```
ç›‘æ§æŒ‡æ ‡ï¼š
- å·æ®µä½¿ç”¨ç‡ï¼šcurrent.getUsagePercent()  
- å·æ®µå‰©ä½™æ•°ï¼šcurrent.remainingCount()
- è·å–é¢‘ç‡ï¼šæ¯å°æ—¶è·å–å·æ®µæ¬¡æ•°

æ•…éšœæ¢å¤ï¼š
- åº”ç”¨é‡å¯ä¸å½±å“IDè¿ç»­æ€§
- æ•°æ®åº“æ¢å¤åè‡ªåŠ¨ç»§ç»­æœåŠ¡
- æ”¯æŒå¤šæœºæˆ¿éƒ¨ç½²
```

---

## 9. ğŸš€ IDç”Ÿæˆæ€§èƒ½ä¼˜åŒ–


### 9.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ


**ğŸ” å¸¸è§æ€§èƒ½ç“¶é¢ˆ**

```
æ€§èƒ½ç“¶é¢ˆåˆ†æï¼š

1ï¸âƒ£ æ•°æ®åº“ç“¶é¢ˆï¼š
é—®é¢˜ï¼šæ¯æ¬¡ç”ŸæˆIDéƒ½è¦è®¿é—®æ•°æ®åº“
å½±å“ï¼šæ•°æ®åº“æˆä¸ºå•ç‚¹ç“¶é¢ˆï¼ŒQPSå—é™
è§£å†³ï¼šä½¿ç”¨ç¼“å­˜ã€é¢„åŠ è½½ã€æ‰¹é‡è·å–

2ï¸âƒ£ ç½‘ç»œå»¶è¿Ÿï¼š
é—®é¢˜ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç½‘ç»œè°ƒç”¨å¼€é”€å¤§
å½±å“ï¼šIDç”Ÿæˆå»¶è¿Ÿå¢åŠ ï¼Œç”¨æˆ·ä½“éªŒä¸‹é™  
è§£å†³ï¼šæœ¬åœ°ç¼“å­˜ã€å°±è¿‘éƒ¨ç½²

3ï¸âƒ£ é”ç«äº‰ï¼š
é—®é¢˜ï¼šå¤šçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«èµ„æº
å½±å“ï¼šCPUåˆ©ç”¨ç‡ä¸‹é™ï¼Œååé‡å—é™
è§£å†³ï¼šæ— é”ç®—æ³•ã€åˆ†æ®µåŠ é”

4ï¸âƒ£ å†…å­˜åˆ†é…ï¼š
é—®é¢˜ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡å¯¼è‡´GCå‹åŠ›
å½±å“ï¼šç³»ç»Ÿåœé¡¿ï¼Œå“åº”æ—¶é—´ä¸ç¨³å®š
è§£å†³ï¼šå¯¹è±¡æ± ã€é¢„åˆ†é…
```

### 9.2 ç¼“å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ å¤šçº§ç¼“å­˜æ¶æ„**
```java
@Component
public class MultiLevelCacheIdGenerator {
    
    // L1ç¼“å­˜ï¼šJVMå †å†…ç¼“å­˜ï¼ˆæœ€å¿«ï¼‰
    private final Cache<String, Queue<Long>> l1Cache = Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(10, TimeUnit.MINUTES)
            .build();
    
    // L2ç¼“å­˜ï¼šRedisåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆè¾ƒå¿«ï¼‰
    @Autowired
    private StringRedisTemplate redisTemplate;
    
    // L3å­˜å‚¨ï¼šæ•°æ®åº“ï¼ˆè¾ƒæ…¢ï¼‰
    @Autowired
    private SegmentService segmentService;
    
    public Long generateId(String bizType) {
        // å…ˆå°è¯•L1ç¼“å­˜
        Queue<Long> l1Queue = l1Cache.getIfPresent(bizType);
        if (l1Queue != null && !l1Queue.isEmpty()) {
            return l1Queue.poll();
        }
        
        // å†å°è¯•L2ç¼“å­˜
        Long id = tryGetFromRedis(bizType);
        if (id != null) {
            // æ‰¹é‡é¢„åŠ è½½åˆ°L1ç¼“å­˜
            preloadToL1Cache(bizType);
            return id;
        }
        
        // æœ€åä»æ•°æ®åº“è·å–
        return segmentService.getId(bizType).getId();
    }
    
    private void preloadToL1Cache(String bizType) {
        // ä»Redisæ‰¹é‡è·å–100ä¸ªIDåˆ°æœ¬åœ°ç¼“å­˜
        List<Long> ids = batchGetFromRedis(bizType, 100);
        Queue<Long> queue = new ConcurrentLinkedQueue<>(ids);
        l1Cache.put(bizType, queue);
    }
}
```

### 9.3 æ— é”å¹¶å‘ä¼˜åŒ–  


**ğŸ”¸ åŸå­æ“ä½œä¼˜åŒ–**
```java
public class LockFreeSegment {
    
    private final long startId;
    private final long endId;
    private final AtomicLong current;
    
    public LockFreeSegment(long startId, long endId) {
        this.startId = startId;
        this.endId = endId;
        this.current = new AtomicLong(startId);
    }
    
    // æ— é”è·å–ID
    public Long nextId() {
        while (true) {
            long currentValue = current.get();
            
            if (currentValue > endId) {
                return null; // å·æ®µç”¨å®Œ
            }
            
            // CASæ“ä½œï¼Œé¿å…é”ç«äº‰
            if (current.compareAndSet(currentValue, currentValue + 1)) {
                return currentValue;
            }
            
            // CASå¤±è´¥ï¼Œé‡è¯•ï¼ˆè‡ªæ—‹ï¼‰
        }
    }
}
```

**ğŸ”¸ åˆ†æ®µé”ä¼˜åŒ–**
```java  
public class SegmentedIdGenerator {
    
    private final int segmentCount = 16; // åˆ†16ä¸ªæ®µ
    private final Segment[] segments = new Segment[segmentCount];
    private final Object[] locks = new Object[segmentCount];
    
    public SegmentedIdGenerator() {
        for (int i = 0; i < segmentCount; i++) {
            segments[i] = new Segment(i * 1000000L, (i + 1) * 1000000L - 1);
            locks[i] = new Object();
        }
    }
    
    public Long nextId() {
        // æ ¹æ®çº¿ç¨‹IDé€‰æ‹©æ®µï¼Œå‡å°‘é”ç«äº‰
        int segmentIndex = (int) (Thread.currentThread().getId() % segmentCount);
        
        synchronized (locks[segmentIndex]) {
            return segments[segmentIndex].nextId();
        }
    }
}
```

### 9.4 å†…å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ å¯¹è±¡æ± ä¼˜åŒ–**
```java
public class PooledIdGenerator {
    
    // IDå¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºLongå¯¹è±¡
    private final GenericObjectPool<IdWrapper> objectPool;
    
    public PooledIdGenerator() {
        GenericObjectPoolConfig<IdWrapper> config = new GenericObjectPoolConfig<>();
        config.setMaxTotal(1000);
        config.setMaxIdle(100);
        
        this.objectPool = new GenericObjectPool<>(new IdWrapperFactory(), config);
    }
    
    public IdWrapper generateId(String bizType) {
        try {
            IdWrapper wrapper = objectPool.borrowObject();
            wrapper.setValue(generateRawId(bizType));
            return wrapper;
        } catch (Exception e) {
            // é™çº§å¤„ç†
            return new IdWrapper(generateRawId(bizType));
        }
    }
    
    public void returnId(IdWrapper wrapper) {
        try {
            objectPool.returnObject(wrapper);
        } catch (Exception e) {
            // å¿½ç•¥å¼‚å¸¸
        }
    }
}
```

### 9.5 æ‰¹é‡å¤„ç†ä¼˜åŒ–


**ğŸ”¸ æ‰¹é‡ç”Ÿæˆç­–ç•¥**
```java
@Service  
public class BatchIdGenerator {
    
    @Autowired
    private SegmentService segmentService;
    
    // æ‰¹é‡ç”ŸæˆIDï¼Œæé«˜ååé‡
    public List<Long> generateBatch(String bizType, int count) {
        List<Long> result = new ArrayList<>(count);
        
        // è®¡ç®—éœ€è¦å¤šå°‘ä¸ªå·æ®µ
        int segmentSize = getSegmentSize(bizType);
        int segmentCount = (count + segmentSize - 1) / segmentSize;
        
        // æ‰¹é‡è·å–å·æ®µ
        List<Segment> segments = batchGetSegments(bizType, segmentCount);
        
        // ä»å·æ®µä¸­æå–ID
        for (Segment segment : segments) {
            while (result.size() < count && !segment.isEmpty()) {
                result.add(segment.nextId());
            }
            if (result.size() >= count) break;
        }
        
        return result;
    }
    
    // å¼‚æ­¥é¢„çƒ­ç¼“å­˜
    @Async
    public void preheatCache(String bizType) {
        CompletableFuture.runAsync(() -> {
            // é¢„ç”Ÿæˆ10000ä¸ªIDåˆ°ç¼“å­˜
            generateBatch(bizType, 10000);
        });
    }
}
```

### 9.6 æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜


**ğŸ”¸ æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```java
@Component
public class IdGeneratorMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Timer generateTimer;
    private final Counter successCounter;
    private final Counter failCounter;
    
    public IdGeneratorMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.generateTimer = Timer.builder("id.generate.time")
                .description("IDç”Ÿæˆè€—æ—¶")
                .register(meterRegistry);
        this.successCounter = Counter.builder("id.generate.success")
                .description("IDç”ŸæˆæˆåŠŸæ¬¡æ•°")
                .register(meterRegistry);
        this.failCounter = Counter.builder("id.generate.fail")
                .description("IDç”Ÿæˆå¤±è´¥æ¬¡æ•°") 
                .register(meterRegistry);
    }
    
    public Long generateIdWithMetrics(String bizType) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            Long id = doGenerateId(bizType);
            successCounter.increment();
            return id;
        } catch (Exception e) {
            failCounter.increment();
            throw e;
        } finally {
            sample.stop(generateTimer);
        }
    }
}
```

**ğŸ“Š æ€§èƒ½è°ƒä¼˜å‚æ•°**

| å‚æ•° | **æ¨èå€¼** | **è¯´æ˜** |
|------|-----------|---------|
| ğŸ”¢ **å·æ®µå¤§å°** | `1000-10000` | `æ ¹æ®QPSè°ƒæ•´ï¼ŒQPSè¶Šé«˜è®¾ç½®è¶Šå¤§` |
| â° **é¢„åŠ è½½é˜ˆå€¼** | `60-80%` | `å·æ®µä½¿ç”¨åˆ°æ­¤æ¯”ä¾‹æ—¶é¢„åŠ è½½ä¸‹ä¸€æ®µ` |
| ğŸ’¾ **æœ¬åœ°ç¼“å­˜å¤§å°** | `10000-50000` | `æ ¹æ®å†…å­˜æƒ…å†µè°ƒæ•´` |
| ğŸ”„ **æ‰¹é‡è·å–å¤§å°** | `100-1000` | `å¹³è¡¡ç½‘ç»œè°ƒç”¨æ¬¡æ•°å’Œå†…å­˜å ç”¨` |
| âš¡ **çº¿ç¨‹æ± å¤§å°** | `CPUæ ¸å¿ƒæ•°*2` | `å¼‚æ­¥å¤„ç†çš„çº¿ç¨‹æ± å¤§å°` |

---

## 10. âš–ï¸ æ–¹æ¡ˆé€‰æ‹©ä¸å¯¹æ¯”


### 10.1 å…¨æ–¹æ¡ˆå¯¹æ¯”è¡¨


| æ–¹æ¡ˆ | **æ€§èƒ½(QPS)** | **å¤æ‚åº¦** | **å­˜å‚¨æ•ˆç‡** | **æœ‰åºæ€§** | **å¯ç”¨æ€§** | **é€‚ç”¨åœºæ™¯** |
|------|-------------|-----------|------------|-----------|-----------|------------|
| ğŸ—„ï¸ **æ•°æ®åº“è‡ªå¢** | `1K-5K` | â­â˜†â˜†â˜†â˜† | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â˜†â˜†â˜† | `å°å‹é¡¹ç›®` |
| â„ï¸ **é›ªèŠ±ç®—æ³•** | `400W+` | â­â­â­â˜†â˜† | â­â­â­â­â˜† | â­â­â­â­â˜† | â­â­â­â­â­ | `é«˜å¹¶å‘ç³»ç»Ÿ` |
| ğŸ†” **UUID** | `100W+` | â­â˜†â˜†â˜†â˜† | â­â­â˜†â˜†â˜† | â­â˜†â˜†â˜†â˜† | â­â­â­â­â­ | `å¿«é€Ÿå¼€å‘` |
| ğŸ”¢ **Redisè®¡æ•°** | `10W+` | â­â­â˜†â˜†â˜† | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â˜†â˜† | `ä¸­å‹é¡¹ç›®` |
| ğŸŒ¿ **Leafæ¡†æ¶** | `10W+` | â­â­â­â­â˜† | â­â­â­â­â˜† | â­â­â­â­â­ | â­â­â­â­â˜† | `ä¼ä¸šçº§åº”ç”¨` |
| ğŸ”§ **TinyID** | `100W+` | â­â­â­â­â˜† | â­â­â­â­â˜† | â­â­â­â­â­ | â­â­â­â­â˜† | `å¤§å‹åˆ†å¸ƒå¼` |
| ğŸ“Š **å·æ®µæ¨¡å¼** | `200W+` | â­â­â­â˜†â˜† | â­â­â­â­â˜† | â­â­â­â­â­ | â­â­â­â­â˜† | `è‡ªç ”ç³»ç»Ÿ` |

### 10.2 æŒ‰ä¸šåŠ¡åœºæ™¯é€‰æ‹©


**ğŸª ç”µå•†ç³»ç»Ÿæ¨è**
```
è®¢å•IDç”Ÿæˆï¼š
é¦–é€‰ï¼šTinyID + å·æ®µæ¨¡å¼
- è®¢å•éœ€è¦ä¸¥æ ¼é€’å¢
- ä¾¿äºæŒ‰æ—¶é—´æ’åºæŸ¥è¯¢  
- QPSè¦æ±‚è¾ƒé«˜

å¤‡é€‰ï¼šé›ªèŠ±ç®—æ³•
- æ€§èƒ½æ›´é«˜
- å¯æ¥å—è½»å¾®ä¹±åº

å•†å“IDç”Ÿæˆï¼š
é¦–é€‰ï¼šé›ªèŠ±ç®—æ³•
- å•†å“åˆ›å»ºé¢‘ç‡ç›¸å¯¹è¾ƒä½
- å¯¹é¡ºåºè¦æ±‚ä¸ä¸¥æ ¼
- éœ€è¦å…¨å±€å”¯ä¸€

ç”¨æˆ·IDç”Ÿæˆï¼š
é¦–é€‰ï¼šRedisè®¡æ•°å™¨
- ç”¨æˆ·æ³¨å†Œé¢‘ç‡é€‚ä¸­
- éœ€è¦è¿ç»­é€’å¢çš„ç”¨æˆ·ç¼–å·
- ä¾¿äºç”¨æˆ·ä½“éªŒ
```

**ğŸ¦ é‡‘èç³»ç»Ÿæ¨è**
```
äº¤æ˜“æµæ°´å·ï¼š
é¦–é€‰ï¼šé›ªèŠ±ç®—æ³•
- äº¤æ˜“å¹¶å‘é‡æé«˜
- éœ€è¦ç»å¯¹å”¯ä¸€æ€§
- æ—¶é—´æœ‰åºä¾¿äºå®¡è®¡

å¤‡é€‰ï¼šTinyID
- ä¸¥æ ¼é€’å¢åºåˆ—
- ä¾¿äºå¯¹è´¦å’Œæ’æŸ¥

è´¦æˆ·IDç”Ÿæˆï¼š
é¦–é€‰ï¼šæ•°æ®åº“è‡ªå¢ + åˆ†åº“åˆ†è¡¨
- è´¦æˆ·å¼€æˆ·é¢‘ç‡ä¸é«˜
- éœ€è¦ç»å¯¹å¯é 
- ä¾¿äºç›‘ç®¡è¦æ±‚

é£æ§äº‹ä»¶IDï¼š
é¦–é€‰ï¼šUUID
- äº‹ä»¶å‘ç”Ÿéšæœºæ€§å¼º
- å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜
- å…¨å±€å”¯ä¸€å³å¯
```

**ğŸ“± ç¤¾äº¤ç³»ç»Ÿæ¨è**
```
æ¶ˆæ¯IDç”Ÿæˆï¼š
é¦–é€‰ï¼šé›ªèŠ±ç®—æ³•
- æ¶ˆæ¯å‘é€é¢‘ç‡æé«˜
- éœ€è¦æ—¶é—´æœ‰åº
- ä¾¿äºæ¶ˆæ¯æ’åºå±•ç¤º

ç”¨æˆ·å…³ç³»IDï¼š
é¦–é€‰ï¼šRedisè®¡æ•°å™¨
- å…³æ³¨/å–å…³æ“ä½œé€‚ä¸­
- éœ€è¦å”¯ä¸€æ ‡è¯†
- å¯æ¥å—ä¸€å®šå»¶è¿Ÿ

åŠ¨æ€å†…å®¹IDï¼š
é¦–é€‰ï¼šå·æ®µæ¨¡å¼
- å†…å®¹å‘å¸ƒé¢‘ç‡é«˜
- éœ€è¦ä¾¿äºæ’åº
- è‡ªç ”å¯æ§æ€§å¼º
```

### 10.3 æŠ€æœ¯é€‰æ‹©å†³ç­–æ ‘


```
IDç”Ÿæˆæ–¹æ¡ˆé€‰æ‹©å†³ç­–æ ‘ï¼š

å¼€å§‹
â”œâ”€ QPSéœ€æ±‚ > 100ä¸‡ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ é›ªèŠ±ç®—æ³• / å·æ®µæ¨¡å¼
â”‚  â””â”€ å¦ â†“
â”œâ”€ éœ€è¦ä¸¥æ ¼é€’å¢ï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ Redisè®¡æ•° / TinyID / Leaf
â”‚  â””â”€ å¦ â†’ UUID
â”œâ”€ æœ‰è¿ç»´å›¢é˜Ÿï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ TinyID / Leaf
â”‚  â””â”€ å¦ â†’ Redisè®¡æ•° / é›ªèŠ±ç®—æ³•
â”œâ”€ å¯¹å­˜å‚¨æ•æ„Ÿï¼Ÿ
â”‚  â”œâ”€ æ˜¯ â†’ æ•°æ®åº“è‡ªå¢ / Redisè®¡æ•°
â”‚  â””â”€ å¦ â†’ UUID / é›ªèŠ±ç®—æ³•
â””â”€ å¿«é€Ÿä¸Šçº¿ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ UUID / Redisè®¡æ•°
   â””â”€ å¦ â†’ æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©
```

### 10.4 æ··åˆæ–¹æ¡ˆæ¨è


**ğŸ”¸ å¤§å‹ç”µå•†ç³»ç»Ÿæ¶æ„**
```
æ··åˆIDç”Ÿæˆæ¶æ„ï¼š

æ ¸å¿ƒä¸šåŠ¡IDï¼ˆè®¢å•ã€æ”¯ä»˜ï¼‰ï¼š
â”œâ”€ ä¸»æ–¹æ¡ˆï¼šTinyIDé›†ç¾¤
â”œâ”€ å¤‡ä»½æ–¹æ¡ˆï¼šé›ªèŠ±ç®—æ³•
â””â”€ é™çº§æ–¹æ¡ˆï¼šRedisè®¡æ•°å™¨

ä¸€èˆ¬ä¸šåŠ¡IDï¼ˆå•†å“ã€è¯„è®ºï¼‰ï¼š
â”œâ”€ ä¸»æ–¹æ¡ˆï¼šé›ªèŠ±ç®—æ³•
â””â”€ é™çº§æ–¹æ¡ˆï¼šUUID

ä¸´æ—¶ä¸šåŠ¡IDï¼ˆæœç´¢ã€æ—¥å¿—ï¼‰ï¼š
â””â”€ æ–¹æ¡ˆï¼šUUID

æ¶æ„ä¼˜åŠ¿ï¼š
âœ… å¤šå±‚ä¿éšœï¼Œé«˜å¯ç”¨æ€§
âœ… æŒ‰ä¸šåŠ¡é‡è¦æ€§åˆ†çº§å¤„ç†
âœ… é™çº§æ–¹æ¡ˆä¿è¯æœåŠ¡ä¸ä¸­æ–­
```

### 10.5 æˆæœ¬æ•ˆç›Šåˆ†æ


**ğŸ’° å¼€å‘æˆæœ¬å¯¹æ¯”**

| æ–¹æ¡ˆ | **å¼€å‘æ—¶é—´** | **å­¦ä¹ æˆæœ¬** | **ç»´æŠ¤æˆæœ¬** | **ç¡¬ä»¶æˆæœ¬** |
|------|------------|------------|------------|------------|
| ğŸ—„ï¸ **æ•°æ®åº“è‡ªå¢** | `1å¤©` | `å¾ˆä½` | `ä½` | `ä½` |
| â„ï¸ **é›ªèŠ±ç®—æ³•** | `3-5å¤©` | `ä¸­ç­‰` | `ä¸­` | `å¾ˆä½` |
| ğŸ†” **UUID** | `åŠå¤©` | `å¾ˆä½` | `å¾ˆä½` | `å¾ˆä½` |
| ğŸ”¢ **Redisè®¡æ•°** | `2å¤©` | `ä½` | `ä¸­` | `ä½` |
| ğŸŒ¿ **Leafæ¡†æ¶** | `5-7å¤©` | `ä¸­ç­‰` | `ä¸­` | `ä¸­` |
| ğŸ”§ **TinyID** | `5-7å¤©` | `ä¸­ç­‰` | `ä¸­` | `ä¸­` |
| ğŸ“Š **å·æ®µæ¨¡å¼** | `7-10å¤©` | `é«˜` | `é«˜` | `ä½` |

**ğŸ“Š ROIæŠ•èµ„å›æŠ¥åˆ†æ**
```
å°å‹é¡¹ç›®ï¼ˆQPS < 1ä¸‡ï¼‰ï¼š
æ¨èï¼šUUID / Redisè®¡æ•°å™¨
æŠ•èµ„ï¼šâ˜…â˜†â˜†â˜†â˜†  å›æŠ¥ï¼šâ˜…â˜…â˜…â˜†â˜†
ç†ç”±ï¼šå¼€å‘å¿«ï¼Œå¤Ÿç”¨å°±å¥½

ä¸­å‹é¡¹ç›®ï¼ˆQPS 1ä¸‡-10ä¸‡ï¼‰ï¼š
æ¨èï¼šé›ªèŠ±ç®—æ³• / Leaf
æŠ•èµ„ï¼šâ˜…â˜…â˜…â˜†â˜†  å›æŠ¥ï¼šâ˜…â˜…â˜…â˜…â˜†
ç†ç”±ï¼šæ€§èƒ½å’Œå¤æ‚åº¦å¹³è¡¡

å¤§å‹é¡¹ç›®ï¼ˆQPS > 10ä¸‡ï¼‰ï¼š
æ¨èï¼šTinyID / è‡ªç ”å·æ®µ
æŠ•èµ„ï¼šâ˜…â˜…â˜…â˜…â˜†  å›æŠ¥ï¼šâ˜…â˜…â˜…â˜…â˜…
ç†ç”±ï¼šé«˜æ€§èƒ½ï¼Œå€¼å¾—æŠ•èµ„
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†å¸ƒå¼IDæœ¬è´¨ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”Ÿæˆå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦
ğŸ”¸ æ ¸å¿ƒè¦æ±‚ï¼šå…¨å±€å”¯ä¸€æ€§ã€é«˜å¯ç”¨æ€§ã€é«˜æ€§èƒ½ã€è¶‹åŠ¿é€’å¢
ğŸ”¸ ä¸»æµæ–¹æ¡ˆï¼šé›ªèŠ±ç®—æ³•ã€UUIDã€Redisè®¡æ•°ã€å·æ®µæ¨¡å¼ã€å¼€æºæ¡†æ¶
ğŸ”¸ é€‰æ‹©åŸåˆ™ï¼šæ ¹æ®QPSã€å­˜å‚¨ã€æœ‰åºæ€§ã€å¤æ‚åº¦ç­‰å› ç´ ç»¼åˆè€ƒè™‘
ğŸ”¸ ä¼˜åŒ–ç­–ç•¥ï¼šç¼“å­˜ã€æ‰¹é‡ã€é¢„åŠ è½½ã€æ— é”ã€ç›‘æ§
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼ID**
```
æ ¹æœ¬é—®é¢˜ï¼š
- å•æœºè‡ªå¢IDåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¼šé‡å¤
- ä¸šåŠ¡å‘å±•éœ€è¦å…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦
- ä¼ ç»ŸUUIDè™½ç„¶å”¯ä¸€ä½†æ€§èƒ½å’Œå­˜å‚¨æœ‰é—®é¢˜

è§£å†³æ€è·¯ï¼š
- æ—¶é—´ç»´åº¦ï¼šé›ªèŠ±ç®—æ³•åˆ©ç”¨æ—¶é—´æˆ³ä¿è¯å”¯ä¸€
- ç©ºé—´ç»´åº¦ï¼šæœºå™¨ç åŒºåˆ†ä¸åŒèŠ‚ç‚¹
- æ‰¹é‡ç»´åº¦ï¼šå·æ®µæ¨¡å¼å‡å°‘æ•°æ®åº“è®¿é—®
- ç¼“å­˜ç»´åº¦ï¼šæœ¬åœ°ç¼“å­˜æå‡æ€§èƒ½
```

**ğŸ”¹ å„æ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯**
```
æ€§èƒ½å¯¼å‘ï¼šé›ªèŠ±ç®—æ³•ã€å·æ®µæ¨¡å¼
- é€‚åˆï¼šé«˜å¹¶å‘ã€ä½å»¶è¿Ÿè¦æ±‚
- ç‰¹ç‚¹ï¼šQPSé«˜ï¼Œæœ¬åœ°ç”Ÿæˆ

ç®€å•å¯¼å‘ï¼šUUIDã€Redisè®¡æ•°
- é€‚åˆï¼šå¿«é€Ÿå¼€å‘ã€ä¸­å°è§„æ¨¡
- ç‰¹ç‚¹ï¼šå®ç°ç®€å•ï¼Œä¾èµ–å°‘

ç¨³å®šå¯¼å‘ï¼šTinyIDã€Leafæ¡†æ¶
- é€‚åˆï¼šä¼ä¸šçº§åº”ç”¨ï¼Œé•¿æœŸç»´æŠ¤
- ç‰¹ç‚¹ï¼šåŠŸèƒ½å®Œå–„ï¼Œç”Ÿäº§å°±ç»ª

æˆæœ¬å¯¼å‘ï¼šæ•°æ®åº“è‡ªå¢
- é€‚åˆï¼šä¼ ç»Ÿé¡¹ç›®æ”¹é€ ï¼Œèµ„æºæœ‰é™
- ç‰¹ç‚¹ï¼šæˆæœ¬ä½ï¼Œæ”¹åŠ¨å°
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒæ€æƒ³**
```
å‡å°‘ä¾èµ–ï¼šæœ¬åœ°ç”Ÿæˆ > è¿œç¨‹è°ƒç”¨
æ‰¹é‡å¤„ç†ï¼šæ‰¹é‡è·å– > å•ä¸ªè·å–  
é¢„åŠ è½½ï¼šæå‰å‡†å¤‡ > ä¸´æ—¶ç”³è¯·
æ— é”åŒ–ï¼šåŸå­æ“ä½œ > åŒæ­¥é”
ç›‘æ§åŒ–ï¼šåŠæ—¶å‘ç° > è¢«åŠ¨ç­‰å¾…
```

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æŠ€æœ¯é€‰å‹æ­¥éª¤**
```
æ­¥éª¤1ï¸âƒ£ï¼šè¯„ä¼°ä¸šåŠ¡éœ€æ±‚
- QPSå³°å€¼æ˜¯å¤šå°‘ï¼Ÿ
- æ˜¯å¦éœ€è¦ä¸¥æ ¼é€’å¢ï¼Ÿ  
- å¯¹å­˜å‚¨å¤§å°æ˜¯å¦æ•æ„Ÿï¼Ÿ
- å¯æ¥å—çš„å¤æ‚åº¦ï¼Ÿ

æ­¥éª¤2ï¸âƒ£ï¼šåˆ†ææŠ€æœ¯çº¦æŸ  
- ç°æœ‰æŠ€æœ¯æ ˆæƒ…å†µ
- è¿ç»´å›¢é˜Ÿèƒ½åŠ›
- å¼€å‘æ—¶é—´è¦æ±‚
- ç¡¬ä»¶èµ„æºé¢„ç®—

æ­¥éª¤3ï¸âƒ£ï¼šåˆ¶å®šæ–¹æ¡ˆ
- é€‰æ‹©ä¸»æ–¹æ¡ˆ
- è®¾è®¡é™çº§æ–¹æ¡ˆ
- è§„åˆ’ç›‘æ§ä½“ç³»
- åˆ¶å®šæ‰©å®¹è®¡åˆ’

æ­¥éª¤4ï¸âƒ£ï¼šéªŒè¯å’Œä¼˜åŒ–
- å‹åŠ›æµ‹è¯•éªŒè¯æ€§èƒ½
- ç›‘æ§æŒ‡æ ‡è°ƒä¼˜å‚æ•°
- åˆ¶å®šåº”æ€¥é¢„æ¡ˆ
- æŒç»­æ”¹è¿›ä¼˜åŒ–
```

**ğŸ› ï¸ ç”Ÿäº§å®è·µè¦ç‚¹**
```
éƒ¨ç½²æ³¨æ„äº‹é¡¹ï¼š
âœ… æœºå™¨æ—¶é’ŸåŒæ­¥ï¼ˆé›ªèŠ±ç®—æ³•ï¼‰
âœ… æœºå™¨IDåˆ†é…ç®¡ç†
âœ… æ•°æ®åº“è¿æ¥æ± é…ç½®
âœ… RedisæŒä¹…åŒ–é…ç½®
âœ… ç›‘æ§å‘Šè­¦è®¾ç½®

è¿ç»´æ³¨æ„äº‹é¡¹ï¼š
âœ… IDç”ŸæˆQPSç›‘æ§
âœ… é”™è¯¯ç‡å‘Šè­¦
âœ… æ€§èƒ½è¶‹åŠ¿åˆ†æ
âœ… å®¹é‡è§„åˆ’
âœ… æ•…éšœåº”æ€¥é¢„æ¡ˆ

å¼€å‘æ³¨æ„äº‹é¡¹ï¼š
âœ… çº¿ç¨‹å®‰å…¨è€ƒè™‘
âœ… å¼‚å¸¸å¤„ç†æœºåˆ¶
âœ… é™çº§æ–¹æ¡ˆå®ç°
âœ… å•å…ƒæµ‹è¯•è¦†ç›–
âœ… å‹åŠ›æµ‹è¯•éªŒè¯
```

### 11.4 å¸¸è§é—®é¢˜è§£ç­”


**â“ å¸¸è§é—®é¢˜FAQ**

**Q1: é›ªèŠ±ç®—æ³•æ—¶é’Ÿå›æ‹¨æ€ä¹ˆåŠï¼Ÿ**
```
A: ä¸‰ç§å¤„ç†æ–¹å¼ï¼š
1. æ‹’ç»æœåŠ¡ï¼šæŠ›å¼‚å¸¸ï¼Œç­‰å¾…æ—¶é’Ÿè¿½ä¸Š
2. ç­‰å¾…è¿½èµ¶ï¼šThread.sleepç­‰å¾…æ—¶é’Ÿè¿½ä¸Š  
3. å¤‡ç”¨æ–¹æ¡ˆï¼šåˆ‡æ¢åˆ°UUIDæˆ–å…¶ä»–æ–¹æ¡ˆ
æ¨èç¬¬1ç§ï¼Œä¿è¯IDå”¯ä¸€æ€§
```

**Q2: UUIDæ€§èƒ½çœŸçš„å·®å—ï¼Ÿ**
```
A: ç›¸å¯¹è€Œè¨€ç¡®å®æœ‰åŠ£åŠ¿ï¼š
- ç”Ÿæˆæ€§èƒ½ï¼šæ¯”é›ªèŠ±ç®—æ³•æ…¢3-5å€
- å­˜å‚¨ç©ºé—´ï¼šå ç”¨16å­—èŠ‚ vs 8å­—èŠ‚
- ç´¢å¼•æ•ˆç‡ï¼šéšæœºæ€§å¯¼è‡´B+æ ‘åˆ†è£‚é¢‘ç¹
ä½†å¯¹äºQPSä¸é«˜çš„åœºæ™¯å®Œå…¨å¤Ÿç”¨
```

**Q3: RedisæŒ‚äº†IDç”Ÿæˆæ€ä¹ˆåŠï¼Ÿ**
```
A: å¤šç§é™çº§ç­–ç•¥ï¼š
1. Redisä¸»ä»ï¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä»åº“
2. æœ¬åœ°ç¼“å­˜ï¼šä½¿ç”¨æœ¬åœ°é¢„å­˜çš„ID
3. å¤‡ç”¨æ–¹æ¡ˆï¼šä¸´æ—¶åˆ‡æ¢åˆ°UUID
4. æ•°æ®åº“ï¼šé™çº§åˆ°æ•°æ®åº“è‡ªå¢
å»ºè®®è®¾è®¡å¤šçº§é™çº§æ–¹æ¡ˆ
```

**Q4: å·æ®µç”¨å®Œäº†æ€ä¹ˆåŠï¼Ÿ**
```
A: é¢„é˜²å’Œå¤„ç†å¹¶é‡ï¼š
é¢„é˜²ï¼šè®¾ç½®åˆç†çš„é¢„åŠ è½½é˜ˆå€¼
å¤„ç†ï¼šåŒæ­¥è·å–æ–°å·æ®µï¼ˆä¼šæœ‰çŸ­æš‚é˜»å¡ï¼‰
ä¼˜åŒ–ï¼šåŒBufferé¢„åŠ è½½æœºåˆ¶
ç›‘æ§ï¼šå·æ®µä½¿ç”¨ç‡å‘Šè­¦
```

### 11.5 å‘å±•è¶‹åŠ¿å±•æœ›


**ğŸš€ æŠ€æœ¯å‘å±•è¶‹åŠ¿**
```
äº‘åŸç”ŸåŒ–ï¼š
- Kuberneteséƒ¨ç½²
- å®¹å™¨åŒ–äº¤ä»˜
- æœåŠ¡ç½‘æ ¼é›†æˆ

æ™ºèƒ½åŒ–è¿ç»´ï¼š
- AIé¢„æµ‹æµé‡å³°å€¼
- è‡ªåŠ¨æ‰©ç¼©å®¹
- æ™ºèƒ½å‚æ•°è°ƒä¼˜

ç¡¬ä»¶åŠ é€Ÿï¼š
- GPUå¹¶è¡Œç”Ÿæˆ
- FPGAä¸“ç”¨èŠ¯ç‰‡
- å†…å­˜è®¡ç®—ä¼˜åŒ–

æ ‡å‡†åŒ–ï¼š
- ç»Ÿä¸€IDæ ¼å¼è§„èŒƒ
- è·¨ç³»ç»ŸIDæ˜ å°„
- ç›‘æ§æŒ‡æ ‡æ ‡å‡†åŒ–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
åˆ†å¸ƒå¼IDé€‰æ‹©æœ‰é—¨é“ï¼Œ
æ€§èƒ½è¦æ±‚æ˜¯é¦–è¦è€ƒé‡ã€‚
é›ªèŠ±ç®—æ³•é€Ÿåº¦å¿«ï¼Œ
å·æ®µæ¨¡å¼æ•°æ®åº“å‹å¥½ã€‚
UUIDç®€å•ä½†å ç©ºé—´ï¼Œ
Redisè®¡æ•°è¦è€ƒè™‘å¯ç”¨æ€§ã€‚
TinyIDå’ŒLeafå¾ˆæˆç†Ÿï¼Œ
æ ¹æ®åœºæ™¯åšé€‰æ‹©æœ€é‡è¦ã€‚
```