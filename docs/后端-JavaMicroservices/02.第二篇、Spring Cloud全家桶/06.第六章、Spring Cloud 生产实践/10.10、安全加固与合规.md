---
title: 10ã€å®‰å…¨åŠ å›ºä¸åˆè§„
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡å®‰å…¨åŸºç¡€æ¦‚å¿µ](#1-å¾®æœåŠ¡å®‰å…¨åŸºç¡€æ¦‚å¿µ)
2. [ç½‘ç»œå®‰å…¨åŠ å›º](#2-ç½‘ç»œå®‰å…¨åŠ å›º)
3. [åº”ç”¨å®‰å…¨åŠ å›º](#3-åº”ç”¨å®‰å…¨åŠ å›º)
4. [æ•°æ®å®‰å…¨ä¿æŠ¤](#4-æ•°æ®å®‰å…¨ä¿æŠ¤)
5. [è®¿é—®æ§åˆ¶ç­–ç•¥](#5-è®¿é—®æ§åˆ¶ç­–ç•¥)
6. [å®‰å…¨å®¡è®¡æ—¥å¿—](#6-å®‰å…¨å®¡è®¡æ—¥å¿—)
7. [æ¼æ´æ‰«ææ£€æµ‹](#7-æ¼æ´æ‰«ææ£€æµ‹)
8. [å®‰å…¨åˆè§„è¦æ±‚](#8-å®‰å…¨åˆè§„è¦æ±‚)
9. [æ•°æ®è„±æ•ä¸åŠ å¯†ä¼ è¾“](#9-æ•°æ®è„±æ•ä¸åŠ å¯†ä¼ è¾“)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ å¾®æœåŠ¡å®‰å…¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡å®‰å…¨


**ç®€å•ç†è§£**ï¼šå°±åƒä¿æŠ¤ä¸€ä¸ªå¤§å‹è´­ç‰©ä¸­å¿ƒä¸€æ ·ï¼Œå¾®æœåŠ¡å®‰å…¨å°±æ˜¯ä¿æŠ¤ç”±å¾ˆå¤šå°å•†é“ºç»„æˆçš„æœåŠ¡ç¾¤

```
ä¼ ç»Ÿå•ä½“åº”ç”¨å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ä¸€ä¸ªå¤§å•†åœº        â”‚  â† åªéœ€è¦åœ¨é—¨å£è®¾ä¸€ä¸ªä¿å®‰
â”‚  â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â”   â”‚
â”‚  â”‚Aâ”‚ â”‚Bâ”‚ â”‚Câ”‚ â”‚Dâ”‚   â”‚
â”‚  â””â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¾®æœåŠ¡å®‰å…¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚  A  â”‚  â”‚  B  â”‚  â”‚  C  â”‚  â”‚  D  â”‚  â† æ¯ä¸ªå°åº—éƒ½éœ€è¦ç‹¬ç«‹ä¿æŠ¤
â”‚ ğŸ”’  â”‚  â”‚ ğŸ”’  â”‚  â”‚ ğŸ”’  â”‚  â”‚ ğŸ”’  â”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
    â†•        â†•        â†•        â†•
   ç½‘ç»œ     ç½‘ç»œ     ç½‘ç»œ     ç½‘ç»œ     â† è¿æ¥ä¹Ÿéœ€è¦ä¿æŠ¤
```

### 1.2 å¾®æœåŠ¡å®‰å…¨æŒ‘æˆ˜


**ğŸ”¸ å®‰å…¨è¾¹ç•Œæ‰©æ•£**
- **å•ä½“åº”ç”¨**ï¼šåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œå®‰å…¨é˜²æŠ¤ç›¸å¯¹ç®€å•
- **å¾®æœåŠ¡**ï¼šæ¯ä¸ªæœåŠ¡éƒ½æ˜¯æ½œåœ¨å…¥å£ï¼Œå®‰å…¨è¾¹ç•Œå¤§å¤§å¢åŠ 

**ğŸ”¸ æœåŠ¡é—´é€šä¿¡å®‰å…¨**
```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ· â†’ ç½‘å…³ â†’ ç”¨æˆ·æœåŠ¡ â†’ è®¢å•æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡ â†’ åº“å­˜æœåŠ¡

æ¯ä¸€ä¸ªç®­å¤´éƒ½æ˜¯æ½œåœ¨çš„å®‰å…¨é£é™©ç‚¹ï¼š
â€¢ ç”¨æˆ·èº«ä»½æ˜¯å¦å¯ä¿¡ï¼Ÿ
â€¢ ç½‘å…³æ˜¯å¦è¢«ç»•è¿‡ï¼Ÿ
â€¢ æœåŠ¡é—´è°ƒç”¨æ˜¯å¦è¢«åŠ«æŒï¼Ÿ
â€¢ æ•°æ®ä¼ è¾“æ˜¯å¦è¢«çªƒå–ï¼Ÿ
```

**ğŸ”¸ åˆ†å¸ƒå¼èº«ä»½è®¤è¯**
- **é—®é¢˜**ï¼šç”¨æˆ·ç™»å½•ä¸€æ¬¡ï¼Œå¦‚ä½•åœ¨æ‰€æœ‰æœåŠ¡ä¸­éƒ½çŸ¥é“ç”¨æˆ·èº«ä»½ï¼Ÿ
- **è§£å†³**ï¼šç»Ÿä¸€çš„èº«ä»½è®¤è¯å’Œæˆæƒæœºåˆ¶

### 1.3 å®‰å…¨åŠ å›ºçš„é‡è¦æ€§


**ğŸ’¡ ä¸ºä»€ä¹ˆè¦åšå®‰å…¨åŠ å›ºï¼Ÿ**

**æ•°æ®æ³„éœ²é£é™©**ï¼š
- ç”¨æˆ·ä¸ªäººä¿¡æ¯
- å•†ä¸šæœºå¯†æ•°æ®
- è´¢åŠ¡äº¤æ˜“è®°å½•

**ä¸šåŠ¡ä¸­æ–­é£é™©**ï¼š
- DDoSæ”»å‡»å¯¼è‡´æœåŠ¡ä¸å¯ç”¨
- æ¶æ„æ”»å‡»ç ´åç³»ç»ŸåŠŸèƒ½

**æ³•å¾‹åˆè§„é£é™©**ï¼š
- GDPRï¼ˆæ¬§ç›Ÿæ•°æ®ä¿æŠ¤æ¡ä¾‹ï¼‰
- ç­‰ä¿è¦æ±‚ï¼ˆå›½å†…ä¿¡æ¯å®‰å…¨ç­‰çº§ä¿æŠ¤ï¼‰
- è¡Œä¸šç‰¹æ®Šè¦æ±‚ï¼ˆé‡‘èã€åŒ»ç–—ç­‰ï¼‰

---

## 2. ğŸŒ ç½‘ç»œå®‰å…¨åŠ å›º


### 2.1 ç½‘ç»œéš”ç¦»ç­–ç•¥


**ğŸ”¸ ç½‘ç»œåˆ†å±‚éš”ç¦»**

```
ç½‘ç»œå®‰å…¨æ¶æ„ï¼š

Internet (å…¬ç½‘)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DMZåŒºåŸŸ       â”‚  â† å¯¹å¤–æœåŠ¡åŒºï¼ˆWebæœåŠ¡å™¨ã€åå‘ä»£ç†ï¼‰
â”‚   ç½‘å…³æœåŠ¡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ é˜²ç«å¢™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨æœåŠ¡åŒº      â”‚  â† ä¸šåŠ¡æœåŠ¡åŒºï¼ˆå¾®æœåŠ¡ç¾¤ï¼‰
â”‚  ç”¨æˆ·æœåŠ¡        â”‚
â”‚  è®¢å•æœåŠ¡        â”‚
â”‚  æ”¯ä»˜æœåŠ¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ é˜²ç«å¢™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®å­˜å‚¨åŒº      â”‚  â† æ•°æ®åº“åŒºï¼ˆæœ€æ ¸å¿ƒæ•°æ®ï¼‰
â”‚  MySQL          â”‚
â”‚  Redis          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ ç½‘ç»œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰**

| æºåŒºåŸŸ | ç›®æ ‡åŒºåŸŸ | å…è®¸ç«¯å£ | è¯´æ˜ |
|-------|---------|---------|------|
| å…¬ç½‘ | DMZ | 80,443 | HTTP/HTTPSè®¿é—® |
| DMZ | åº”ç”¨åŒº | 8080-8090 | å¾®æœåŠ¡è°ƒç”¨ |
| åº”ç”¨åŒº | æ•°æ®åŒº | 3306,6379 | æ•°æ®åº“è®¿é—® |
| åº”ç”¨åŒº | åº”ç”¨åŒº | 8080-8090 | æœåŠ¡é—´è°ƒç”¨ |

### 2.2 VPCç§æœ‰ç½‘ç»œ


**ğŸ”¸ ä»€ä¹ˆæ˜¯VPCï¼Ÿ**
- **Virtual Private Cloud**ï¼šè™šæ‹Ÿç§æœ‰äº‘
- **ç®€å•ç†è§£**ï¼šåœ¨å…¬æœ‰äº‘ä¸Šåˆ’å‡ºä¸€å—ä¸“å±äºä½ çš„ç½‘ç»œç©ºé—´ï¼Œå°±åƒåœ¨å…¬å…±åŒºåŸŸå»ºäº†ä¸€ä¸ªç§äººåˆ«å¢…åŒº

**ğŸ”¸ VPCç½‘ç»œé…ç½®**
```yaml
# ç¤ºä¾‹VPCé…ç½®
vpc_config:
  cidr_block: "10.0.0.0/16"  # ç§æœ‰ç½‘ç»œåœ°å€æ®µ
  
  # å­ç½‘åˆ’åˆ†
  subnets:
    public_subnet:    "10.0.1.0/24"  # å…¬ç½‘å­ç½‘ï¼ˆæ”¾ç½‘å…³ï¼‰
    private_subnet:   "10.0.2.0/24"  # ç§ç½‘å­ç½‘ï¼ˆæ”¾å¾®æœåŠ¡ï¼‰
    database_subnet:  "10.0.3.0/24"  # æ•°æ®åº“å­ç½‘
    
  # å®‰å…¨ç»„è§„åˆ™
  security_groups:
    web_sg:    # Webå±‚å®‰å…¨ç»„
      - protocol: tcp
        port: 80,443
        source: 0.0.0.0/0
    app_sg:    # åº”ç”¨å±‚å®‰å…¨ç»„  
      - protocol: tcp
        port: 8080-8090
        source: web_sg
```

### 2.3 æœåŠ¡ç½‘æ ¼å®‰å…¨


**ğŸ”¸ Istioç½‘æ ¼å®‰å…¨**

**mTLSåŒå‘è®¤è¯**ï¼š
```
ä¼ ç»ŸHTTPè°ƒç”¨ï¼š
æœåŠ¡A â”€â”€â”€â”€â†’ æœåŠ¡B  (æ˜æ–‡ä¼ è¾“ï¼Œä¸å®‰å…¨)

Istio mTLSï¼š
æœåŠ¡A â”€[è¯ä¹¦A]â†’ â”€[è¯ä¹¦B]â”€ æœåŠ¡B
       â†[éªŒè¯]â”€   â”€[éªŒè¯]â†
       
æ¯ä¸ªæœåŠ¡éƒ½æœ‰æ•°å­—èº«ä»½è¯ï¼Œäº’ç›¸éªŒè¯èº«ä»½åæ‰é€šä¿¡
```

**æµé‡åŠ å¯†é…ç½®**ï¼š
```yaml
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
spec:
  mtls:
    mode: STRICT  # å¼ºåˆ¶æ‰€æœ‰æœåŠ¡é—´é€šä¿¡ä½¿ç”¨mTLS
```

---

## 3. ğŸ›¡ï¸ åº”ç”¨å®‰å…¨åŠ å›º


### 3.1 Spring Securityé›†æˆ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Spring Securityï¼Ÿ**
- **ç®€å•ç†è§£**ï¼šå°±åƒç»™ä½ çš„åº”ç”¨é…äº†ä¸€ä¸ªä¸“ä¸šä¿å®‰ï¼Œè´Ÿè´£æ£€æŸ¥æ¯ä¸ªè®¿é—®è€…çš„èº«ä»½å’Œæƒé™

**ğŸ”¸ åŸºç¡€å®‰å…¨é…ç½®**
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            // é…ç½®å“ªäº›URLéœ€è¦ä»€ä¹ˆæƒé™
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll()      // å…¬å¼€æ¥å£
                .requestMatchers("/admin/**").hasRole("ADMIN")  // ç®¡ç†å‘˜æ¥å£
                .anyRequest().authenticated()                   // å…¶ä»–éƒ½éœ€è¦ç™»å½•
            )
            // é…ç½®JWTè®¤è¯
            .oauth2ResourceServer(oauth2 -> oauth2
                .jwt(jwt -> jwt.jwtDecoder(jwtDecoder()))
            );
            
        return http.build();
    }
}
```

**ğŸ”¸ æƒé™æ³¨è§£ä½¿ç”¨**
```java
@RestController
public class UserController {
    
    // åªæœ‰ADMINè§’è‰²æ‰èƒ½åˆ é™¤ç”¨æˆ·
    @PreAuthorize("hasRole('ADMIN')")  
    @DeleteMapping("/users/{id}")
    public void deleteUser(@PathVariable String id) {
        userService.deleteUser(id);
    }
    
    // åªæœ‰ç”¨æˆ·æœ¬äººæˆ–ADMINæ‰èƒ½æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
    @PreAuthorize("hasRole('ADMIN') or #id == authentication.name")
    @GetMapping("/users/{id}")
    public User getUserInfo(@PathVariable String id) {
        return userService.getUser(id);
    }
}
```

### 3.2 JWTä»¤ç‰Œå®‰å…¨


**ğŸ”¸ JWTæ˜¯ä»€ä¹ˆï¼Ÿ**
- **JSON Web Token**ï¼šä¸€ç§æ•°å­—ä»¤ç‰Œï¼Œå°±åƒç”µå­èº«ä»½è¯
- **åŒ…å«ä¿¡æ¯**ï¼šç”¨æˆ·èº«ä»½ã€æƒé™ã€è¿‡æœŸæ—¶é—´ç­‰

**JWTç»“æ„è§£æ**ï¼š
```
JWTä»¤ç‰Œæ ¼å¼ï¼šxxxxx.yyyyy.zzzzz

Headerï¼ˆå¤´éƒ¨ï¼‰:     {"alg":"HS256","typ":"JWT"}
Payloadï¼ˆè½½è·ï¼‰:    {"userId":"123","role":"USER","exp":1234567890}
Signatureï¼ˆç­¾åï¼‰:   ç”¨å¯†é’¥åŠ å¯†å‰é¢ä¸¤éƒ¨åˆ†çš„ç»“æœ

ä¼˜ç‚¹ï¼š
âœ… æ— çŠ¶æ€ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä¼šè¯ä¿¡æ¯
âœ… è·¨æœåŠ¡ï¼šæ‰€æœ‰å¾®æœåŠ¡éƒ½èƒ½éªŒè¯åŒä¸€ä¸ªä»¤ç‰Œ
âœ… ä¿¡æ¯å®Œæ•´ï¼šä»¤ç‰Œä¸­åŒ…å«å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯
```

**ğŸ”¸ JWTå®‰å…¨æœ€ä½³å®è·µ**
```java
@Component
public class JwtUtils {
    
    // ä½¿ç”¨å¼ºå¯†é’¥
    @Value("${jwt.secret}")
    private String jwtSecret;  // è‡³å°‘256ä½çš„éšæœºå­—ç¬¦ä¸²
    
    // è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
    @Value("${jwt.expiration}")
    private int jwtExpiration = 3600; // 1å°æ—¶è¿‡æœŸ
    
    public String generateToken(UserDetails userDetails) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("role", userDetails.getAuthorities());
        
        return Jwts.builder()
            .setClaims(claims)
            .setSubject(userDetails.getUsername())
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + jwtExpiration * 1000))
            .signWith(SignatureAlgorithm.HS512, jwtSecret)  // ä½¿ç”¨å¼ºç­¾åç®—æ³•
            .compact();
    }
}
```

### 3.3 APIæ¥å£å®‰å…¨


**ğŸ”¸ æ¥å£é™æµé˜²æŠ¤**
```java
// ä½¿ç”¨Rediså®ç°æ¥å£é™æµ
@Component
public class RateLimiter {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    // é™åˆ¶æ¯ä¸ªIPæ¯åˆ†é’Ÿæœ€å¤š100æ¬¡è¯·æ±‚
    public boolean isAllowed(String clientIp) {
        String key = "rate_limit:" + clientIp;
        String count = redisTemplate.opsForValue().get(key);
        
        if (count == null) {
            // ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œè®¾ç½®è®¡æ•°ä¸º1ï¼Œè¿‡æœŸæ—¶é—´60ç§’
            redisTemplate.opsForValue().set(key, "1", Duration.ofSeconds(60));
            return true;
        }
        
        int currentCount = Integer.parseInt(count);
        if (currentCount >= 100) {
            return false;  // è¶…è¿‡é™åˆ¶
        }
        
        // è®¡æ•°åŠ 1
        redisTemplate.opsForValue().increment(key);
        return true;
    }
}
```

**ğŸ”¸ è¾“å…¥å‚æ•°éªŒè¯**
```java
@RestController
public class UserController {
    
    @PostMapping("/users")
    public User createUser(@Valid @RequestBody CreateUserRequest request) {
        return userService.createUser(request);
    }
}

// è¯·æ±‚å‚æ•°éªŒè¯
public class CreateUserRequest {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20å­—ç¬¦ä¹‹é—´")
    private String username;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Pattern(regexp = "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}$", 
             message = "å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼Œè‡³å°‘8ä½")
    private String password;
}
```

---

## 4. ğŸ” æ•°æ®å®‰å…¨ä¿æŠ¤


### 4.1 æ•°æ®åˆ†ç±»ä¸åˆ†çº§


**ğŸ”¸ æ•°æ®å®‰å…¨åˆ†çº§**

| æ•°æ®çº§åˆ« | æ•°æ®ç±»å‹ | ä¿æŠ¤è¦æ±‚ | ç¤ºä¾‹ |
|---------|---------|---------|------|
| **ğŸ”´ ææœºå¯†** | æ ¸å¿ƒå•†ä¸šæœºå¯† | æœ€é«˜çº§åŠ å¯†+è®¿é—®å®¡è®¡ | ç®—æ³•æ¨¡å‹ã€è´¢åŠ¡æ•°æ® |
| **ğŸŸ¡ æœºå¯†** | ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ | åŠ å¯†å­˜å‚¨+è„±æ•å±•ç¤º | èº«ä»½è¯å·ã€é“¶è¡Œå¡å· |
| **ğŸŸ¢ å†…éƒ¨** | ä¸€èˆ¬ä¸šåŠ¡æ•°æ® | è®¿é—®æ§åˆ¶ | è®¢å•ä¿¡æ¯ã€å•†å“ä¿¡æ¯ |
| **âšª å…¬å¼€** | å…¬å¼€ä¿¡æ¯ | æ— ç‰¹æ®Šè¦æ±‚ | å•†å“å±•ç¤ºã€å…¬å‘Šä¿¡æ¯ |

### 4.2 æ•°æ®åº“å®‰å…¨åŠ å›º


**ğŸ”¸ æ•°æ®åº“è®¿é—®æ§åˆ¶**
```sql
-- åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·ï¼Œä¸ä½¿ç”¨root
CREATE USER 'app_user'@'%' IDENTIFIED BY 'StrongPassword123!';

-- åªæˆäºˆå¿…è¦æƒé™
GRANT SELECT, INSERT, UPDATE ON app_db.users TO 'app_user'@'%';
GRANT SELECT, INSERT, UPDATE ON app_db.orders TO 'app_user'@'%';

-- ç¦ç”¨å±é™©æƒé™
-- ä¸è¦ç»™åº”ç”¨ç”¨æˆ· DROP, ALTER, GRANT ç­‰ç®¡ç†æƒé™
```

**ğŸ”¸ æ•°æ®åº“è¿æ¥å®‰å…¨**
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/app_db?useSSL=true&requireSSL=true
    username: app_user
    password: ${DB_PASSWORD}  # ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œä¸å†™åœ¨ä»£ç é‡Œ
    
    # è¿æ¥æ± å®‰å…¨é…ç½®
    hikari:
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

### 4.3 æ•æ„Ÿæ•°æ®åŠ å¯†


**ğŸ”¸ å­—æ®µçº§åŠ å¯†**
```java
@Entity
public class User {
    
    @Id
    private String id;
    
    private String username;  // æ™®é€šå­—æ®µï¼Œä¸éœ€è¦åŠ å¯†
    
    @Convert(converter = EncryptedStringConverter.class)
    private String phone;     // æ‰‹æœºå·åŠ å¯†å­˜å‚¨
    
    @Convert(converter = EncryptedStringConverter.class) 
    private String idCard;    // èº«ä»½è¯å·åŠ å¯†å­˜å‚¨
}

// è‡ªå®šä¹‰åŠ å¯†è½¬æ¢å™¨
@Component
public class EncryptedStringConverter implements AttributeConverter<String, String> {
    
    @Autowired
    private AESUtil aesUtil;
    
    @Override
    public String convertToDatabaseColumn(String attribute) {
        return attribute == null ? null : aesUtil.encrypt(attribute);
    }
    
    @Override
    public String convertToEntityAttribute(String dbData) {
        return dbData == null ? null : aesUtil.decrypt(dbData);
    }
}
```

---

## 5. ğŸ‘¥ è®¿é—®æ§åˆ¶ç­–ç•¥


### 5.1 RBACæƒé™æ¨¡å‹


**ğŸ”¸ ä»€ä¹ˆæ˜¯RBACï¼Ÿ**
- **Role-Based Access Control**ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **ç®€å•ç†è§£**ï¼šå°±åƒå…¬å¸çš„èŒä½ä½“ç³»ï¼Œä¸åŒèŒä½æœ‰ä¸åŒçš„æƒé™

```
RBACæ¨¡å‹ç»“æ„ï¼š
ç”¨æˆ· â† åˆ†é…è§’è‰² â†’ è§’è‰² â† åˆ†é…æƒé™ â†’ æƒé™

å®é™…ä¾‹å­ï¼š
å¼ ä¸‰(ç”¨æˆ·) â†’ è®¢å•ç®¡ç†å‘˜(è§’è‰²) â†’ æŸ¥çœ‹è®¢å•ã€ä¿®æ”¹è®¢å•çŠ¶æ€(æƒé™)
æå››(ç”¨æˆ·) â†’ ç³»ç»Ÿç®¡ç†å‘˜(è§’è‰²) â†’ ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿé…ç½®(æƒé™)
ç‹äº”(ç”¨æˆ·) â†’ è´¢åŠ¡äººå‘˜(è§’è‰²) â†’ æŸ¥çœ‹è´¢åŠ¡æŠ¥è¡¨ã€å¯¼å‡ºæ•°æ®(æƒé™)
```

**ğŸ”¸ æƒé™æ•°æ®æ¨¡å‹**
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id VARCHAR(32) PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL,
    status TINYINT DEFAULT 1  -- 1å¯ç”¨ 0ç¦ç”¨
);

-- è§’è‰²è¡¨
CREATE TABLE roles (
    id VARCHAR(32) PRIMARY KEY,
    role_name VARCHAR(50) NOT NULL,
    description VARCHAR(200)
);

-- æƒé™è¡¨
CREATE TABLE permissions (
    id VARCHAR(32) PRIMARY KEY, 
    permission_name VARCHAR(100) NOT NULL,
    resource VARCHAR(100),      -- èµ„æºæ ‡è¯†
    action VARCHAR(50)          -- æ“ä½œç±»å‹ï¼šread,write,delete
);

-- ç”¨æˆ·è§’è‰²å…³ç³»è¡¨
CREATE TABLE user_roles (
    user_id VARCHAR(32),
    role_id VARCHAR(32),
    PRIMARY KEY (user_id, role_id)
);

-- è§’è‰²æƒé™å…³ç³»è¡¨  
CREATE TABLE role_permissions (
    role_id VARCHAR(32),
    permission_id VARCHAR(32), 
    PRIMARY KEY (role_id, permission_id)
);
```

### 5.2 OAuth2.0æˆæƒ


**ğŸ”¸ OAuth2.0æ˜¯ä»€ä¹ˆï¼Ÿ**
- **ç®€å•ç†è§£**ï¼šå°±åƒé…’åº—çš„æˆ¿å¡ç³»ç»Ÿï¼Œä½ å¯ä»¥æˆæƒåˆ«äººä»£è¡¨ä½ å»æŸäº›åœ°æ–¹ï¼Œä½†ä¸ç”¨æŠŠæˆ¿é—´é’¥åŒ™ç»™ä»–

**OAuth2.0æˆæƒæµç¨‹**ï¼š
```
ç¬¬ä¸‰æ–¹åº”ç”¨æƒ³è¦è®¿é—®ä½ çš„å¾®ä¿¡ä¿¡æ¯ï¼š

1. ç”¨æˆ· â†’ ç¬¬ä¸‰æ–¹åº”ç”¨ï¼šæˆ‘è¦ç™»å½•
2. ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ å¾®ä¿¡ï¼šè¯·æ±‚ç”¨æˆ·æˆæƒ  
3. å¾®ä¿¡ â†’ ç”¨æˆ·ï¼šæ˜¯å¦å…è®¸XXåº”ç”¨è®¿é—®ä½ çš„åŸºæœ¬ä¿¡æ¯ï¼Ÿ
4. ç”¨æˆ· â†’ å¾®ä¿¡ï¼šåŒæ„
5. å¾®ä¿¡ â†’ ç¬¬ä¸‰æ–¹åº”ç”¨ï¼šç»™ä½ ä¸€ä¸ªæˆæƒç 
6. ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ å¾®ä¿¡ï¼šç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
7. å¾®ä¿¡ â†’ ç¬¬ä¸‰æ–¹åº”ç”¨ï¼šç»™ä½ è®¿é—®ä»¤ç‰Œ
8. ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ å¾®ä¿¡APIï¼šç”¨ä»¤ç‰Œè·å–ç”¨æˆ·ä¿¡æ¯
9. å¾®ä¿¡API â†’ ç¬¬ä¸‰æ–¹åº”ç”¨ï¼šè¿”å›ç”¨æˆ·ä¿¡æ¯
```

**ğŸ”¸ Spring Security OAuth2é…ç½®**
```java
@Configuration
@EnableAuthorizationServer  
public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {
    
    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        clients.inMemory()
            .withClient("mobile-client")      // å®¢æˆ·ç«¯ID
            .secret("{noop}mobile-secret")   // å®¢æˆ·ç«¯å¯†é’¥
            .scopes("read", "write")         // æˆæƒèŒƒå›´
            .authorizedGrantTypes(
                "authorization_code",        // æˆæƒç æ¨¡å¼
                "refresh_token"             // åˆ·æ–°ä»¤ç‰Œ
            )
            .redirectUris("http://localhost:8080/callback");  // å›è°ƒåœ°å€
    }
}
```

### 5.3 ç½‘å…³ç»Ÿä¸€è®¤è¯


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦åœ¨ç½‘å…³åšè®¤è¯ï¼Ÿ**
- **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰è¯·æ±‚éƒ½å…ˆç»è¿‡ç½‘å…³ï¼Œç»Ÿä¸€éªŒè¯èº«ä»½
- **å‡è½»è´Ÿæ‹…**ï¼šå„ä¸ªå¾®æœåŠ¡ä¸ç”¨é‡å¤å†™è®¤è¯é€»è¾‘
- **å®‰å…¨é˜²æŠ¤**ï¼šåœ¨è¾¹ç•Œå°±æ‹¦æˆªéæ³•è¯·æ±‚

```
è¯·æ±‚æµç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ ç½‘å…³(éªŒè¯JWT) â†’ å¾®æœåŠ¡(ç›´æ¥å¤„ç†ä¸šåŠ¡)

å¦‚æœæ²¡æœ‰ç½‘å…³ç»Ÿä¸€è®¤è¯ï¼š
å®¢æˆ·ç«¯ â†’ ç”¨æˆ·æœåŠ¡(éªŒè¯JWT) â†’ å¤„ç†ä¸šåŠ¡
å®¢æˆ·ç«¯ â†’ è®¢å•æœåŠ¡(éªŒè¯JWT) â†’ å¤„ç†ä¸šåŠ¡  
å®¢æˆ·ç«¯ â†’ æ”¯ä»˜æœåŠ¡(éªŒè¯JWT) â†’ å¤„ç†ä¸šåŠ¡
â†‘ æ¯ä¸ªæœåŠ¡éƒ½è¦é‡å¤åšè®¤è¯ï¼Œä»£ç é‡å¤ä¸”å®¹æ˜“å‡ºé”™
```

**ğŸ”¸ Gatewayè®¤è¯è¿‡æ»¤å™¨**
```java
@Component
public class AuthGatewayFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºå…¬å¼€APIï¼Œä¸éœ€è¦è®¤è¯
        if (isPublicApi(request.getPath().value())) {
            return chain.filter(exchange);
        }
        
        // ä»è¯·æ±‚å¤´è·å–JWTä»¤ç‰Œ
        String token = request.getHeaders().getFirst("Authorization");
        if (token == null || !token.startsWith("Bearer ")) {
            return unauthorizedResponse(exchange);
        }
        
        // éªŒè¯JWTä»¤ç‰Œ
        try {
            String jwt = token.substring(7);
            Claims claims = jwtUtil.parseToken(jwt);
            
            // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¤´ï¼Œä¼ é€’ç»™ä¸‹æ¸¸æœåŠ¡
            ServerHttpRequest modifiedRequest = request.mutate()
                .header("X-User-Id", claims.getSubject())
                .header("X-User-Role", claims.get("role", String.class))
                .build();
            
            return chain.filter(exchange.mutate().request(modifiedRequest).build());
            
        } catch (Exception e) {
            return unauthorizedResponse(exchange);
        }
    }
    
    @Override
    public int getOrder() {
        return -100;  // ä¼˜å…ˆçº§é«˜ï¼Œå…ˆæ‰§è¡Œè®¤è¯
    }
}
```

---

## 6. ğŸ“Š å®‰å…¨å®¡è®¡æ—¥å¿—


### 6.1 å®¡è®¡æ—¥å¿—çš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡æ—¥å¿—ï¼Ÿ**
- **äº‹åè¿½æº¯**ï¼šå‡ºç°å®‰å…¨äº‹æ•…æ—¶ï¼Œèƒ½è¿½æŸ¥æ˜¯è°åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆæ“ä½œ
- **åˆè§„è¦æ±‚**ï¼šå¾ˆå¤šè¡Œä¸šæ ‡å‡†éƒ½è¦æ±‚ä¿ç•™æ“ä½œæ—¥å¿—
- **å¼‚å¸¸å‘ç°**ï¼šé€šè¿‡æ—¥å¿—åˆ†æå‘ç°å¼‚å¸¸è¡Œä¸º

**å®¡è®¡æ—¥å¿—åº”è¯¥è®°å½•ä»€ä¹ˆ**ï¼š
```
WHOï¼ˆè°ï¼‰ï¼šç”¨æˆ·IDã€ç”¨æˆ·åã€IPåœ°å€
WHENï¼ˆä½•æ—¶ï¼‰ï¼šæ“ä½œæ—¶é—´æˆ³
WHEREï¼ˆå“ªé‡Œï¼‰ï¼šå“ªä¸ªæœåŠ¡ã€å“ªä¸ªæ¥å£
WHATï¼ˆä»€ä¹ˆï¼‰ï¼šå…·ä½“æ“ä½œå†…å®¹
RESULTï¼ˆç»“æœï¼‰ï¼šæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå¤±è´¥åŸå› 
```

### 6.2 æ“ä½œæ—¥å¿—è®°å½•


**ğŸ”¸ å…³é”®æ“ä½œè‡ªåŠ¨è®°å½•**
```java
// ä½¿ç”¨AOPè‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—
@Aspect
@Component
public class AuditLogAspect {
    
    @Autowired
    private AuditLogService auditLogService;
    
    // æ‹¦æˆªæ‰€æœ‰æ ‡æ³¨äº†@AuditLogçš„æ–¹æ³•
    @Around("@annotation(auditLog)")
    public Object logAudit(ProceedingJoinPoint joinPoint, AuditLog auditLog) throws Throwable {
        
        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        String userId = SecurityContextHolder.getContext()
            .getAuthentication().getName();
        String clientIp = getClientIp();
        
        // è®°å½•æ“ä½œå¼€å§‹
        long startTime = System.currentTimeMillis();
        
        try {
            Object result = joinPoint.proceed();
            
            // æ“ä½œæˆåŠŸï¼Œè®°å½•æ—¥å¿—
            auditLogService.logSuccess(AuditLogEntry.builder()
                .userId(userId)
                .clientIp(clientIp) 
                .operation(auditLog.operation())
                .resource(auditLog.resource())
                .details(getMethodDetails(joinPoint))
                .duration(System.currentTimeMillis() - startTime)
                .build());
                
            return result;
            
        } catch (Exception e) {
            // æ“ä½œå¤±è´¥ï¼Œè®°å½•é”™è¯¯æ—¥å¿—
            auditLogService.logFailure(AuditLogEntry.builder()
                .userId(userId)
                .clientIp(clientIp)
                .operation(auditLog.operation())
                .resource(auditLog.resource()) 
                .errorMessage(e.getMessage())
                .duration(System.currentTimeMillis() - startTime)
                .build());
                
            throw e;
        }
    }
}

// ä½¿ç”¨æ³¨è§£æ ‡è®°éœ€è¦å®¡è®¡çš„æ–¹æ³•
@RestController
public class UserController {
    
    @AuditLog(operation = "DELETE_USER", resource = "USER")
    @DeleteMapping("/users/{id}")
    public void deleteUser(@PathVariable String id) {
        userService.deleteUser(id);
    }
    
    @AuditLog(operation = "UPDATE_USER_ROLE", resource = "USER")  
    @PutMapping("/users/{id}/role")
    public void updateUserRole(@PathVariable String id, @RequestBody String role) {
        userService.updateUserRole(id, role);
    }
}
```

### 6.3 æ—¥å¿—å®‰å…¨å­˜å‚¨


**ğŸ”¸ æ—¥å¿—é˜²ç¯¡æ”¹**
```java
// æ—¥å¿—æ•°å­—ç­¾åï¼Œé˜²æ­¢ç¯¡æ”¹
@Service
public class SecureAuditLogService {
    
    @Autowired
    private DigitalSignatureUtil signatureUtil;
    
    public void saveAuditLog(AuditLogEntry entry) {
        // 1. åºåˆ—åŒ–æ—¥å¿—å†…å®¹
        String logContent = JSON.toJSONString(entry);
        
        // 2. è®¡ç®—æ—¥å¿—æ‘˜è¦å¹¶ç­¾å
        String digest = DigestUtils.sha256Hex(logContent);
        String signature = signatureUtil.sign(digest);
        
        // 3. ä¿å­˜åˆ°æ•°æ®åº“
        AuditLog auditLog = new AuditLog();
        auditLog.setContent(logContent);
        auditLog.setDigest(digest); 
        auditLog.setSignature(signature);
        auditLog.setCreateTime(new Date());
        
        auditLogRepository.save(auditLog);
        
        // 4. åŒæ—¶å‘é€åˆ°æ—¥å¿—ä¸­å¿ƒ
        logCenterService.sendLog(auditLog);
    }
    
    // éªŒè¯æ—¥å¿—å®Œæ•´æ€§
    public boolean verifyLogIntegrity(AuditLog log) {
        String computedDigest = DigestUtils.sha256Hex(log.getContent());
        return signatureUtil.verify(computedDigest, log.getSignature());
    }
}
```

---

## 7. ğŸ” æ¼æ´æ‰«ææ£€æµ‹


### 7.1 å¸¸è§å®‰å…¨æ¼æ´


**ğŸ”¸ OWASP Top 10å®‰å…¨é£é™©**

| æ’å | æ¼æ´ç±»å‹ | è¯´æ˜ | é˜²æŠ¤æªæ–½ |
|-----|---------|------|---------|
| **1** | **æ³¨å…¥æ”»å‡»** | SQLæ³¨å…¥ã€å‘½ä»¤æ³¨å…¥ç­‰ | å‚æ•°åŒ–æŸ¥è¯¢ã€è¾“å…¥éªŒè¯ |
| **2** | **å¤±æ•ˆçš„èº«ä»½è®¤è¯** | å¼±å¯†ç ã€ä¼šè¯ç®¡ç†ç¼ºé™· | å¼ºè®¤è¯ã€JWTä»¤ç‰Œ |
| **3** | **æ•æ„Ÿæ•°æ®æ³„éœ²** | æ•°æ®æœªåŠ å¯†ä¼ è¾“å­˜å‚¨ | HTTPSã€æ•°æ®åº“åŠ å¯† |
| **4** | **XMLå¤–éƒ¨å®ä½“æ³¨å…¥** | XMLè§£æå™¨å®‰å…¨ç¼ºé™· | ç¦ç”¨å¤–éƒ¨å®ä½“è§£æ |
| **5** | **å¤±æ•ˆçš„è®¿é—®æ§åˆ¶** | æƒé™æ§åˆ¶ä¸å½“ | RBACã€æœ€å°æƒé™åŸåˆ™ |

### 7.2 è‡ªåŠ¨åŒ–å®‰å…¨æ‰«æ


**ğŸ”¸ ä»£ç é™æ€åˆ†æ**
```yaml
# ä½¿ç”¨SonarQubeè¿›è¡Œä»£ç å®‰å…¨æ‰«æ
version: '3'
services:
  sonarqube:
    image: sonarqube:latest
    ports:
      - "9000:9000"
    environment:
      - SONAR_JDBC_URL=jdbc:postgresql://db:5432/sonar
    volumes:
      - sonarqube_data:/opt/sonarqube/data

# Mavenæ’ä»¶é…ç½®
<plugin>
    <groupId>org.sonarsource.scanner.maven</groupId>
    <artifactId>sonar-maven-plugin</artifactId>
    <version>3.9.1.2184</version>
</plugin>

# è¿è¡Œå®‰å…¨æ‰«æ
mvn sonar:sonar \
  -Dsonar.projectKey=my-microservice \
  -Dsonar.host.url=http://localhost:9000 \
  -Dsonar.login=admin
```

**ğŸ”¸ ä¾èµ–æ¼æ´æ‰«æ**
```xml
<!-- ä½¿ç”¨OWASP dependency-checkæ’ä»¶ -->
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <version>8.4.2</version>
    <executions>
        <execution>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
    <configuration>
        <format>HTML</format>
        <failBuildOnAnyVulnerability>true</failBuildOnAnyVulnerability>
    </configuration>
</plugin>
```

### 7.3 è¿è¡Œæ—¶å®‰å…¨ç›‘æ§


**ğŸ”¸ å¼‚å¸¸è¡Œä¸ºæ£€æµ‹**
```java
@Component
public class SecurityMonitor {
    
    // ç›‘æ§ç™»å½•å¼‚å¸¸
    @EventListener
    public void handleFailedLogin(AuthenticationFailedEvent event) {
        String clientIp = event.getClientIp();
        String username = event.getUsername();
        
        // è®°å½•å¤±è´¥æ¬¡æ•°
        int failCount = loginAttemptService.recordFailedAttempt(clientIp, username);
        
        if (failCount >= 5) {
            // 5æ¬¡å¤±è´¥åé”å®šè´¦æˆ·30åˆ†é’Ÿ
            accountLockService.lockAccount(username, Duration.ofMinutes(30));
            
            // å‘é€å®‰å…¨å‘Šè­¦
            securityAlertService.sendAlert("è´¦æˆ·æš´åŠ›ç ´è§£å‘Šè­¦", 
                "ç”¨æˆ·" + username + "åœ¨IP" + clientIp + "ä¸Šè¿ç»­ç™»å½•å¤±è´¥" + failCount + "æ¬¡");
        }
    }
    
    // ç›‘æ§å¼‚å¸¸APIè®¿é—®
    @EventListener  
    public void handleSuspiciousApiAccess(SuspiciousApiAccessEvent event) {
        if (event.getRequestCount() > 1000) {  // 1åˆ†é’Ÿå†…è¶…è¿‡1000æ¬¡è¯·æ±‚
            // ä¸´æ—¶å°ç¦IP
            ipBlacklistService.addToBlacklist(event.getClientIp(), Duration.ofHours(1));
            
            securityAlertService.sendAlert("å¯ç–‘APIè®¿é—®å‘Šè­¦",
                "IP" + event.getClientIp() + "åœ¨1åˆ†é’Ÿå†…è¯·æ±‚" + event.getRequestCount() + "æ¬¡");
        }
    }
}
```

---

## 8. âš–ï¸ å®‰å…¨åˆè§„è¦æ±‚


### 8.1 ç­‰ä¿åˆè§„


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç­‰ä¿ï¼Ÿ**
- **ä¿¡æ¯å®‰å…¨ç­‰çº§ä¿æŠ¤**ï¼šå›½å®¶å¯¹ä¿¡æ¯ç³»ç»Ÿå®‰å…¨çš„åˆ†çº§ä¿æŠ¤åˆ¶åº¦
- **åˆ†ä¸º5çº§**ï¼šç­‰ä¿ä¸€çº§åˆ°äº”çº§ï¼Œçº§åˆ«è¶Šé«˜è¦æ±‚è¶Šä¸¥æ ¼

**ç­‰ä¿ä¸‰çº§å¸¸è§è¦æ±‚**ï¼š
```
æŠ€æœ¯è¦æ±‚ï¼š
âœ… èº«ä»½é‰´åˆ«ï¼šå¤šå› å­è®¤è¯ã€å¯†ç å¤æ‚åº¦è¦æ±‚
âœ… è®¿é—®æ§åˆ¶ï¼šæœ€å°æƒé™åŸåˆ™ã€å¼ºåˆ¶è®¿é—®æ§åˆ¶  
âœ… å®‰å…¨å®¡è®¡ï¼šæ“ä½œæ—¥å¿—ã€å®¡è®¡åˆ†æ
âœ… é€šä¿¡å®Œæ•´æ€§ï¼šæ•°æ®ä¼ è¾“åŠ å¯†
âœ… é€šä¿¡ä¿å¯†æ€§ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
âœ… è½¯ä»¶å®¹é”™ï¼šå¼‚å¸¸å¤„ç†ã€æ•…éšœæ¢å¤
âœ… èµ„æºæ§åˆ¶ï¼šé˜²DOSæ”»å‡»ã€èµ„æºé…é¢

ç®¡ç†è¦æ±‚ï¼š
âœ… å®‰å…¨ç®¡ç†åˆ¶åº¦ï¼šå»ºç«‹å®‰å…¨ç®¡ç†ä½“ç³»
âœ… å®‰å…¨ç®¡ç†æœºæ„ï¼šè®¾ç½®å®‰å…¨ç®¡ç†å²—ä½
âœ… äººå‘˜å®‰å…¨ç®¡ç†ï¼šå®‰å…¨æ„è¯†åŸ¹è®­
âœ… ç³»ç»Ÿå»ºè®¾ç®¡ç†ï¼šå®‰å…¨è®¾è®¡ã€æµ‹è¯•
âœ… ç³»ç»Ÿè¿ç»´ç®¡ç†ï¼šå˜æ›´ç®¡ç†ã€åº”æ€¥å“åº”
```

### 8.2 GDPRæ•°æ®ä¿æŠ¤


**ğŸ”¸ GDPRæ˜¯ä»€ä¹ˆï¼Ÿ**
- **General Data Protection Regulation**ï¼šæ¬§ç›Ÿé€šç”¨æ•°æ®ä¿æŠ¤æ¡ä¾‹
- **é€‚ç”¨èŒƒå›´**ï¼šå¤„ç†æ¬§ç›Ÿå±…æ°‘ä¸ªäººæ•°æ®çš„æ‰€æœ‰ç»„ç»‡

**GDPRå…³é”®è¦æ±‚**ï¼š
```java
// æ•°æ®æœ€å°åŒ–åŸåˆ™ - åªæ”¶é›†å¿…è¦çš„æ•°æ®
@Entity
public class UserProfile {
    @Column(nullable = false)
    private String userId;        // å¿…éœ€ï¼šç”¨æˆ·æ ‡è¯†
    
    @Column(nullable = false) 
    private String email;         // å¿…éœ€ï¼šè”ç³»æ–¹å¼
    
    // ä»¥ä¸‹å­—æ®µéœ€è¦ç”¨æˆ·æ˜ç¡®åŒæ„æ‰èƒ½æ”¶é›†
    @Column
    private String phone;         // å¯é€‰ï¼šç”µè¯å·ç 
    
    @Column
    private Date birthday;        // å¯é€‰ï¼šç”Ÿæ—¥
    
    @Column 
    private String address;       // å¯é€‰ï¼šåœ°å€ä¿¡æ¯
    
    // è®°å½•ç”¨æˆ·åŒæ„æƒ…å†µ
    @OneToMany(mappedBy = "userId")
    private List<ConsentRecord> consents;
}

// åŒæ„è®°å½•è¡¨
@Entity
public class ConsentRecord {
    private String userId;
    private String dataType;      // æ•°æ®ç±»å‹ï¼šphone, birthday, address
    private boolean consented;    // æ˜¯å¦åŒæ„
    private Date consentTime;     // åŒæ„æ—¶é—´
    private String consentVersion; // éšç§æ”¿ç­–ç‰ˆæœ¬
}
```

**æ•°æ®ä¸»ä½“æƒåˆ©å®ç°**ï¼š
```java
@RestController
public class GdprController {
    
    // æ•°æ®å¯æºå¸¦æƒ - ç”¨æˆ·å¯ä»¥å¯¼å‡ºè‡ªå·±çš„æ•°æ®
    @GetMapping("/users/{id}/data-export")
    public ResponseEntity<byte[]> exportUserData(@PathVariable String id) {
        // éªŒè¯ç”¨æˆ·èº«ä»½
        if (!isCurrentUser(id)) {
            return ResponseEntity.status(403).build();
        }
        
        // å¯¼å‡ºç”¨æˆ·æ‰€æœ‰æ•°æ®
        UserDataExport export = gdprService.exportUserData(id);
        byte[] zipData = export.toZipBytes();
        
        return ResponseEntity.ok()
            .header("Content-Disposition", "attachment; filename=user-data.zip")
            .contentType(MediaType.APPLICATION_OCTET_STREAM)
            .body(zipData);
    }
    
    // é—å¿˜æƒ - ç”¨æˆ·å¯ä»¥è¦æ±‚åˆ é™¤è‡ªå·±çš„æ•°æ®
    @DeleteMapping("/users/{id}/gdpr-delete")
    public ResponseEntity<Void> deleteUserDataForGdpr(@PathVariable String id) {
        // éªŒè¯ç”¨æˆ·èº«ä»½å’Œåˆ é™¤æƒé™
        if (!isCurrentUser(id)) {
            return ResponseEntity.status(403).build();
        }
        
        // æ‰§è¡ŒGDPRåˆ é™¤ï¼ˆä¿ç•™æ³•å¾‹è¦æ±‚çš„æœ€å°æ•°æ®ï¼‰
        gdprService.deleteUserDataForGdpr(id);
        
        return ResponseEntity.ok().build();
    }
}
```

---

## 9. ğŸ”’ æ•°æ®è„±æ•ä¸åŠ å¯†ä¼ è¾“


### 9.1 æ•°æ®è„±æ•æŠ€æœ¯


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•ï¼Ÿ**
- **ç®€å•ç†è§£**ï¼šç»™æ•æ„Ÿæ•°æ®"æ‰“é©¬èµ›å…‹"ï¼Œè®©ä½ èƒ½çœ‹åˆ°æ•°æ®æ ¼å¼ï¼Œä½†çœ‹ä¸åˆ°çœŸå®å†…å®¹
- **åº”ç”¨åœºæ™¯**ï¼šå¼€å‘æµ‹è¯•ç¯å¢ƒã€æ•°æ®å±•ç¤ºã€æ—¥å¿—è®°å½•

**å¸¸è§è„±æ•æ–¹æ³•**ï¼š
```java
@Component
public class DataMaskingUtil {
    
    // æ‰‹æœºå·è„±æ•ï¼š138****8888
    public String maskPhone(String phone) {
        if (phone == null || phone.length() < 7) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
    
    // èº«ä»½è¯è„±æ•ï¼š110101********1234
    public String maskIdCard(String idCard) {
        if (idCard == null || idCard.length() < 10) {
            return idCard;
        }
        return idCard.substring(0, 6) + "********" + idCard.substring(14);
    }
    
    // é‚®ç®±è„±æ•ï¼šabc***@example.com
    public String maskEmail(String email) {
        if (email == null || !email.contains("@")) {
            return email;
        }
        String[] parts = email.split("@");
        String username = parts[0];
        if (username.length() <= 3) {
            return email;
        }
        return username.substring(0, 3) + "***@" + parts[1];
    }
    
    // é“¶è¡Œå¡è„±æ•ï¼š6222 **** **** 1234
    public String maskBankCard(String bankCard) {
        if (bankCard == null || bankCard.length() < 8) {
            return bankCard;
        }
        return bankCard.substring(0, 4) + " **** **** " + 
               bankCard.substring(bankCard.length() - 4);
    }
}
```

**ğŸ”¸ è¿”å›æ•°æ®è‡ªåŠ¨è„±æ•**
```java
// ä½¿ç”¨Jacksonè‡ªå®šä¹‰åºåˆ—åŒ–å™¨å®ç°è‡ªåŠ¨è„±æ•
public class MaskingSerializer extends JsonSerializer<String> {
    
    private final MaskingType maskingType;
    
    public MaskingSerializer(MaskingType maskingType) {
        this.maskingType = maskingType;
    }
    
    @Override
    public void serialize(String value, JsonGenerator gen, SerializerProvider serializers) 
            throws IOException {
        if (value == null) {
            gen.writeNull();
            return;
        }
        
        String maskedValue = switch (maskingType) {
            case PHONE -> dataMaskingUtil.maskPhone(value);
            case ID_CARD -> dataMaskingUtil.maskIdCard(value);
            case EMAIL -> dataMaskingUtil.maskEmail(value);
            case BANK_CARD -> dataMaskingUtil.maskBankCard(value);
            default -> value;
        };
        
        gen.writeString(maskedValue);
    }
}

// åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨è„±æ•æ³¨è§£
public class UserVO {
    private String id;
    private String username;
    
    @JsonSerialize(using = MaskingSerializer.class)
    @MaskingType(MaskingType.PHONE)
    private String phone;
    
    @JsonSerialize(using = MaskingSerializer.class) 
    @MaskingType(MaskingType.ID_CARD)
    private String idCard;
}
```

### 9.2 HTTPSåŠ å¯†ä¼ è¾“


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦ç”¨HTTPSï¼Ÿ**
- **HTTPé—®é¢˜**ï¼šæ•°æ®æ˜æ–‡ä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå¬å’Œç¯¡æ”¹
- **HTTPSä¼˜åŠ¿**ï¼šSSL/TLSåŠ å¯†ï¼Œä¿è¯æ•°æ®ä¼ è¾“å®‰å…¨

```
HTTPä¼ è¾“ï¼ˆä¸å®‰å…¨ï¼‰ï¼š
å®¢æˆ·ç«¯ ----[ç”¨æˆ·å:admin,å¯†ç :123456]----> æœåŠ¡å™¨
       â†‘ é»‘å®¢å¯ä»¥æˆªè·å¹¶çœ‹åˆ°æ˜æ–‡å¯†ç  â†‘

HTTPSä¼ è¾“ï¼ˆå®‰å…¨ï¼‰ï¼š
å®¢æˆ·ç«¯ ----[åŠ å¯†æ•°æ®:x9k2m...]----> æœåŠ¡å™¨  
       â†‘ é»‘å®¢æˆªè·ä¹Ÿæ˜¯å¯†æ–‡ï¼Œæ— æ³•è§£è¯» â†‘
```

**ğŸ”¸ Spring Booté…ç½®HTTPS**
```yaml
# application.yml
server:
  port: 8443
  ssl:
    enabled: true
    key-store: classpath:keystore.p12      # è¯ä¹¦æ–‡ä»¶è·¯å¾„
    key-store-type: PKCS12                 # è¯ä¹¦æ ¼å¼
    key-store-password: ${SSL_PASSWORD}    # è¯ä¹¦å¯†ç 
    key-alias: myapp                       # è¯ä¹¦åˆ«å
    
    # å®‰å…¨åè®®é…ç½®
    protocol: TLS
    enabled-protocols: TLSv1.2,TLSv1.3    # åªæ”¯æŒå®‰å…¨çš„TLSç‰ˆæœ¬
    ciphers: 
      - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
      - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
```

### 9.3 æœåŠ¡é—´åŠ å¯†é€šä¿¡


**ğŸ”¸ å¾®æœåŠ¡å†…éƒ¨é€šä¿¡åŠ å¯†**
```java
// é…ç½®RestTemplateä½¿ç”¨HTTPS
@Configuration
public class HttpsClientConfig {
    
    @Bean
    public RestTemplate httpsRestTemplate() throws Exception {
        // åˆ›å»ºSSLä¸Šä¸‹æ–‡
        SSLContext sslContext = SSLContexts.custom()
            .loadTrustMaterial(null, (chain, authType) -> true)  // ä¿¡ä»»æ‰€æœ‰è¯ä¹¦ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
            .build();
            
        // é…ç½®è¿æ¥ç®¡ç†å™¨
        PoolingHttpClientConnectionManager connectionManager = 
            PoolingHttpClientConnectionManagerBuilder.create()
                .setSSLSocketFactory(SSLConnectionSocketFactoryBuilder.create()
                    .setSslContext(sslContext)
                    .setHostnameVerifier(NoopHostnameVerifier.INSTANCE)
                    .build())
                .build();
                
        // åˆ›å»ºHttpClient
        CloseableHttpClient httpClient = HttpClients.custom()
            .setConnectionManager(connectionManager)
            .build();
            
        return new RestTemplate(new HttpComponentsClientHttpRequestFactory(httpClient));
    }
}

// æœåŠ¡è°ƒç”¨æ—¶ä½¿ç”¨HTTPS
@Service
public class OrderService {
    
    @Autowired
    @Qualifier("httpsRestTemplate") 
    private RestTemplate restTemplate;
    
    public PaymentResult callPaymentService(PaymentRequest request) {
        String url = "https://payment-service:8443/api/payments";
        return restTemplate.postForObject(url, request, PaymentResult.class);
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å®‰å…¨åŠ å›ºå¿…çŸ¥è¦ç‚¹


**ğŸ”¸ ç½‘ç»œå®‰å…¨åŸºç¡€**
```
âœ… VPCç½‘ç»œéš”ç¦»ï¼šDMZåŒºâ†’åº”ç”¨åŒºâ†’æ•°æ®åŒºåˆ†å±‚é˜²æŠ¤
âœ… å®‰å…¨ç»„é…ç½®ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£
âœ… mTLSè®¤è¯ï¼šæœåŠ¡é—´é€šä¿¡åŒå‘è¯ä¹¦éªŒè¯
âœ… æµé‡åŠ å¯†ï¼šæ‰€æœ‰æ•æ„Ÿé€šä¿¡éƒ½è¦åŠ å¯†ä¼ è¾“
```

**ğŸ”¸ åº”ç”¨å®‰å…¨æ ¸å¿ƒ**
```
âœ… Spring Securityï¼šç»Ÿä¸€çš„è®¤è¯æˆæƒæ¡†æ¶
âœ… JWTä»¤ç‰Œï¼šæ— çŠ¶æ€çš„èº«ä»½è®¤è¯æ–¹å¼
âœ… æ¥å£é™æµï¼šé˜²æ­¢æš´åŠ›æ”»å‡»å’Œæ¶æ„è¯·æ±‚
âœ… å‚æ•°éªŒè¯ï¼šæ‰€æœ‰è¾“å…¥éƒ½è¦è¿›è¡Œå®‰å…¨éªŒè¯
```

**ğŸ”¸ æ•°æ®å®‰å…¨ä¿æŠ¤**
```
âœ… æ•°æ®åˆ†çº§ï¼šæŒ‰æ•æ„Ÿçº§åˆ«åˆ¶å®šä¸åŒä¿æŠ¤ç­–ç•¥
âœ… åŠ å¯†å­˜å‚¨ï¼šæ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†ä¿å­˜
âœ… è®¿é—®æ§åˆ¶ï¼šæ•°æ®åº“è´¦æˆ·æœ€å°æƒé™åŸåˆ™
âœ… æ•°æ®è„±æ•ï¼šéç”Ÿäº§ç¯å¢ƒä½¿ç”¨è„±æ•æ•°æ®
```

### 10.2 æƒé™æ§åˆ¶è¦ç‚¹


**ğŸ”¸ RBACæƒé™æ¨¡å‹**
```
ç”¨æˆ· â†’ è§’è‰² â†’ æƒé™ ä¸‰çº§æˆæƒä½“ç³»
â€¢ èŒè´£åˆ†ç¦»ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²
â€¢ æƒé™ç»§æ‰¿ï¼šè§’è‰²å¯ä»¥ç»§æ‰¿å…¶ä»–è§’è‰²çš„æƒé™
â€¢ åŠ¨æ€æˆæƒï¼šæƒé™å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦è°ƒæ•´
```

**ğŸ”¸ OAuth2.0é›†æˆ**
```
æˆæƒæœåŠ¡å™¨ â†’ èµ„æºæœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯åº”ç”¨
â€¢ æ ‡å‡†åè®®ï¼šè¡Œä¸šé€šç”¨çš„æˆæƒåè®®
â€¢ å®‰å…¨å¯é ï¼šæˆç†Ÿçš„å®‰å…¨æœºåˆ¶
â€¢ æ˜“äºé›†æˆï¼šSpring SecurityåŸç”Ÿæ”¯æŒ
```

### 10.3 ç›‘æ§å®¡è®¡è¦ç‚¹


**ğŸ”¸ å®‰å…¨å®¡è®¡æ—¥å¿—**
```
è®°å½•è¦ç´ ï¼šWHO + WHEN + WHERE + WHAT + RESULT
â€¢ æ“ä½œè¿½æº¯ï¼šèƒ½å¤Ÿè¿½æŸ¥ä»»ä½•æ“ä½œçš„æ¥é¾™å»è„‰
â€¢ å¼‚å¸¸å‘ç°ï¼šé€šè¿‡æ—¥å¿—åˆ†æå‘ç°å¯ç–‘è¡Œä¸º
â€¢ åˆè§„è¦æ±‚ï¼šæ»¡è¶³ç­‰ä¿å’ŒGDPRç­‰æ³•è§„è¦æ±‚
```

**ğŸ”¸ æ¼æ´æ‰«ææ£€æµ‹**
```
é™æ€æ‰«æ + åŠ¨æ€ç›‘æ§ + ä¾èµ–æ£€æŸ¥
â€¢ ä»£ç æ‰«æï¼šSonarQubeç­‰å·¥å…·è‡ªåŠ¨æ£€æŸ¥ä»£ç æ¼æ´
â€¢ ä¾èµ–æ£€æŸ¥ï¼šOWASPå·¥å…·æ£€æŸ¥ç¬¬ä¸‰æ–¹åº“æ¼æ´
â€¢ è¿è¡Œç›‘æ§ï¼šå®æ—¶ç›‘æ§å¼‚å¸¸è¡Œä¸ºå’Œæ”»å‡»å°è¯•
```

### 10.4 åˆè§„å®‰å…¨è¦ç‚¹


**ğŸ”¸ ç­‰ä¿åˆè§„**
```
æŠ€æœ¯æªæ–½ + ç®¡ç†åˆ¶åº¦ åŒé‡ä¿éšœ
â€¢ æŠ€æœ¯å®ç°ï¼šèº«ä»½è®¤è¯ã€è®¿é—®æ§åˆ¶ã€å®‰å…¨å®¡è®¡
â€¢ ç®¡ç†åˆ¶åº¦ï¼šå®‰å…¨åˆ¶åº¦ã€äººå‘˜ç®¡ç†ã€åº”æ€¥å“åº”
â€¢ æŒç»­æ”¹è¿›ï¼šå®šæœŸè¯„ä¼°å’Œä¼˜åŒ–å®‰å…¨æªæ–½
```

**ğŸ”¸ æ•°æ®ä¿æŠ¤åˆè§„**
```
æ•°æ®æœ€å°åŒ– + ç”¨æˆ·æƒåˆ© + å®‰å…¨æªæ–½
â€¢ æ”¶é›†æœ€å°ï¼šåªæ”¶é›†ä¸šåŠ¡å¿…éœ€çš„æ•°æ®
â€¢ ç”¨æˆ·æƒåˆ©ï¼šæ”¯æŒæ•°æ®å¯¼å‡ºã€ä¿®æ­£ã€åˆ é™¤
â€¢ å®‰å…¨å­˜å‚¨ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
```

### 10.5 å®è·µå»ºè®®


**ğŸ¯ å®‰å…¨åŠ å›ºä¼˜å…ˆçº§**
```
é«˜ä¼˜å…ˆçº§ï¼š
ğŸ”´ ç½‘ç»œéš”ç¦»å’Œè®¿é—®æ§åˆ¶
ğŸ”´ èº«ä»½è®¤è¯å’Œæˆæƒæœºåˆ¶  
ğŸ”´ HTTPSåŠ å¯†é€šä¿¡
ğŸ”´ æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨

ä¸­ä¼˜å…ˆçº§ï¼š
ğŸŸ¡ å®¡è®¡æ—¥å¿—å’Œç›‘æ§å‘Šè­¦
ğŸŸ¡ è¾“å…¥éªŒè¯å’ŒSQLæ³¨å…¥é˜²æŠ¤
ğŸŸ¡ æ¥å£é™æµå’ŒDOSé˜²æŠ¤

ä½ä¼˜å…ˆçº§ï¼š
ğŸŸ¢ ä»£ç é™æ€å®‰å…¨æ‰«æ
ğŸŸ¢ ä¾èµ–æ¼æ´æ£€æŸ¥
ğŸŸ¢ æ•°æ®è„±æ•å±•ç¤º
```

**ğŸ’¡ è®°å¿†å£è¯€**
```
ç½‘ç»œéš”ç¦»é˜²å¤–æ•Œï¼Œè®¤è¯æˆæƒæ§å†…éƒ¨
æ•°æ®åŠ å¯†ä¿æœºå¯†ï¼Œå®¡è®¡æ—¥å¿—å¯è¿½æº¯
æ¼æ´æ‰«æå¸¸ä½“æ£€ï¼Œåˆè§„è¦æ±‚è¦ç‰¢è®°
å®‰å…¨ç¬¬ä¸€æ— å°äº‹ï¼ŒæŒç»­æ”¹è¿›æ˜¯ç‹é“
```

> ğŸ’­ **æ€è€ƒå»¶ä¼¸**ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªä½“ç³»å·¥ç¨‹ï¼Œä¸æ˜¯å•ç‚¹æŠ€æœ¯ã€‚è¦ä»ç½‘ç»œã€åº”ç”¨ã€æ•°æ®ã€ç®¡ç†ç­‰å¤šä¸ªç»´åº¦ç»¼åˆè€ƒè™‘ï¼Œå»ºç«‹çºµæ·±é˜²å¾¡ä½“ç³»ã€‚

> ğŸ” **æ·±å…¥å­¦ä¹ **ï¼šå¯ä»¥æ·±å…¥å­¦ä¹ OAuth2.0åè®®åŸç†ã€JWTä»¤ç‰Œæœºåˆ¶ã€åŠ å¯†ç®—æ³•åŸç†ç­‰ï¼Œè¿™äº›æ˜¯æ„å»ºå®‰å…¨ç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†ã€‚