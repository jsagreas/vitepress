---
title: 3ã€è¿›é˜¶å®è·µè·¯å¾„
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡æ¶æ„åŸºç¡€æ¦‚å¿µ](#1-å¾®æœåŠ¡æ¶æ„åŸºç¡€æ¦‚å¿µ)
2. [Spring Cloudæ ¸å¿ƒç»„ä»¶](#2-spring-cloudæ ¸å¿ƒç»„ä»¶)
3. [æœåŠ¡æ³¨å†Œä¸å‘ç°](#3-æœåŠ¡æ³¨å†Œä¸å‘ç°)
4. [è´Ÿè½½å‡è¡¡ä¸æœåŠ¡è°ƒç”¨](#4-è´Ÿè½½å‡è¡¡ä¸æœåŠ¡è°ƒç”¨)
5. [æœåŠ¡ç½‘å…³Gateway](#5-æœåŠ¡ç½‘å…³gateway)
6. [é…ç½®ç®¡ç†Config](#6-é…ç½®ç®¡ç†config)
7. [æ–­è·¯å™¨ä¸å®¹é”™](#7-æ–­è·¯å™¨ä¸å®¹é”™)
8. [è¿›é˜¶å®è·µåº”ç”¨](#8-è¿›é˜¶å®è·µåº”ç”¨)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„


**ç®€å•ç†è§£**ï¼šæŠŠä¸€ä¸ªå¤§å‹åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå°å‹ç‹¬ç«‹æœåŠ¡çš„æ¶æ„æ–¹å¼

```
ä¼ ç»Ÿå•ä½“åº”ç”¨å°±åƒä¸€æ ‹å¤§æ¥¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å•ä½“åº”ç”¨å¤§æ¥¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ç”¨æˆ· â”‚å•†å“ â”‚è®¢å• â”‚æ”¯ä»˜ â”‚  â”‚  â† æ‰€æœ‰åŠŸèƒ½åœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œ
â”‚  â”‚ç®¡ç† â”‚ç®¡ç† â”‚ç®¡ç† â”‚ç®¡ç† â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¾®æœåŠ¡æ¶æ„å°±åƒç‹¬ç«‹çš„å°æˆ¿å­ï¼š
â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ· â”‚  â”‚å•†å“ â”‚  â”‚è®¢å• â”‚  â”‚æ”¯ä»˜ â”‚  â† æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„æœåŠ¡
â”‚æœåŠ¡ â”‚  â”‚æœåŠ¡ â”‚  â”‚æœåŠ¡ â”‚  â”‚æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜
    â”‚        â”‚        â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ç½‘ç»œé€šä¿¡â”‚
```

### 1.2 å¾®æœåŠ¡çš„æ ¸å¿ƒç‰¹ç‚¹


**ğŸ”¸ æœåŠ¡ç‹¬ç«‹æ€§**
- æ¯ä¸ªæœåŠ¡å¯ä»¥**ç‹¬ç«‹å¼€å‘**ã€**ç‹¬ç«‹éƒ¨ç½²**ã€**ç‹¬ç«‹æ‰©å±•**
- å°±åƒæ­ç§¯æœ¨ï¼Œæ¯å—ç§¯æœ¨éƒ½å¯ä»¥å•ç‹¬åˆ¶ä½œå’Œæ›¿æ¢

**ğŸ”¸ ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°**
- ä¸€ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
- æ¯”å¦‚ç”¨æˆ·æœåŠ¡åªç®¡ç”¨æˆ·ç›¸å…³åŠŸèƒ½ï¼Œä¸ç®¡è®¢å•

**ğŸ”¸ æŠ€æœ¯æ ˆè‡ªç”±**
- ç”¨æˆ·æœåŠ¡å¯ä»¥ç”¨Javaï¼Œå•†å“æœåŠ¡å¯ä»¥ç”¨Python
- åªè¦èƒ½é€šè¿‡ç½‘ç»œé€šä¿¡å°±è¡Œ

### 1.3 å¾®æœåŠ¡æ¶æ„çš„ä¼˜åŠ¿ä¸æŒ‘æˆ˜


| **ä¼˜åŠ¿** | **è¯´æ˜** | **æŒ‘æˆ˜** | **è¯´æ˜** |
|---------|---------|---------|---------|
| **ç‹¬ç«‹éƒ¨ç½²** | ä¿®æ”¹ä¸€ä¸ªæœåŠ¡ä¸å½±å“å…¶ä»–æœåŠ¡ | **æœåŠ¡é—´é€šä¿¡** | ç½‘ç»œè°ƒç”¨æ¯”æœ¬åœ°è°ƒç”¨å¤æ‚ |
| **æŠ€æœ¯çµæ´»** | æ¯ä¸ªå›¢é˜Ÿå¯é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯ | **æ•°æ®ä¸€è‡´æ€§** | å¤šä¸ªæ•°æ®åº“çš„æ•°æ®åŒæ­¥é—®é¢˜ |
| **å®¹é”™éš”ç¦»** | ä¸€ä¸ªæœåŠ¡æŒ‚äº†ä¸ä¼šå½±å“å…¨éƒ¨ | **è¿ç»´å¤æ‚** | éœ€è¦ç®¡ç†æ›´å¤šçš„æœåŠ¡å®ä¾‹ |
| **å›¢é˜Ÿç‹¬ç«‹** | å°å›¢é˜Ÿè´Ÿè´£å°æœåŠ¡ï¼Œæ•ˆç‡é«˜ | **åˆ†å¸ƒå¼éš¾é¢˜** | ç½‘ç»œå»¶è¿Ÿã€æœåŠ¡å‘ç°ç­‰é—®é¢˜ |

---

## 2. â˜ï¸ Spring Cloudæ ¸å¿ƒç»„ä»¶


### 2.1 Spring Cloudå…¨å®¶æ¡¶æ¦‚è§ˆ


**Spring Cloud**å°±åƒæ˜¯å¾®æœåŠ¡æ¶æ„çš„**å·¥å…·ç®±**ï¼Œé‡Œé¢æœ‰å„ç§è§£å†³å¾®æœåŠ¡é—®é¢˜çš„å·¥å…·

```
Spring Cloud å·¥å…·ç®±ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Spring Cloud               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡å‘ç°    â”‚ è´Ÿè½½å‡è¡¡    â”‚ æœåŠ¡ç½‘å…³    â”‚
â”‚ Eureka      â”‚ Ribbon      â”‚ Gateway     â”‚
â”‚ Consul      â”‚ LoadBalancerâ”‚ Zuul        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é…ç½®ç®¡ç†    â”‚ æ–­è·¯å™¨      â”‚ é“¾è·¯è¿½è¸ª    â”‚
â”‚ Config      â”‚ Hystrix     â”‚ Sleuth      â”‚
â”‚ Nacos       â”‚ Resilience4jâ”‚ Zipkin      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¶ˆæ¯é©±åŠ¨    â”‚ å®‰å…¨è®¤è¯    â”‚ ç›‘æ§ç®¡ç†    â”‚
â”‚ Stream      â”‚ Security    â”‚ Actuator    â”‚
â”‚ Bus         â”‚ OAuth2      â”‚ Admin       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç‰ˆæœ¬é€‰æ‹©ä¸å…¼å®¹æ€§


**ç‰ˆæœ¬å‘½åè§„åˆ™**ï¼šSpring Cloudä½¿ç”¨**è‹±å›½åœ°é“ç«™å**ä½œä¸ºç‰ˆæœ¬å·

| **Spring Bootç‰ˆæœ¬** | **Spring Cloudç‰ˆæœ¬** | **å‘å¸ƒæ—¶é—´** | **æ¨èä½¿ç”¨** |
|-------------------|---------------------|-------------|-------------|
| 2.6.x | 2021.0.x (Jubilee) | 2021å¹´12æœˆ | âœ… ç¨³å®šæ¨è |
| 2.7.x | 2021.0.x (Jubilee) | 2022å¹´5æœˆ | âœ… å½“å‰ä¸»æµ |
| 3.0.x | 2022.0.x (Kilburn) | 2022å¹´11æœˆ | ğŸ”¶ è¾ƒæ–°ç‰ˆæœ¬ |

**ğŸ’¡ é€‰æ‹©å»ºè®®**
- **æ–°é¡¹ç›®**ï¼šé€‰æ‹©æœ€æ–°ç¨³å®šç‰ˆæœ¬
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€‰æ‹©ç»è¿‡å……åˆ†éªŒè¯çš„ç‰ˆæœ¬
- **å­¦ä¹ é˜¶æ®µ**ï¼šé€‰æ‹©èµ„æ–™æœ€å¤šçš„ä¸»æµç‰ˆæœ¬

### 2.3 å¿«é€Ÿæ­å»ºå¼€å‘ç¯å¢ƒ


**åŸºç¡€é¡¹ç›®ç»“æ„**
```
microservice-demo/
â”œâ”€â”€ eureka-server/          â† æ³¨å†Œä¸­å¿ƒ
â”œâ”€â”€ config-server/          â† é…ç½®ä¸­å¿ƒ
â”œâ”€â”€ gateway-server/         â† ç½‘å…³æœåŠ¡
â”œâ”€â”€ user-service/           â† ç”¨æˆ·æœåŠ¡
â”œâ”€â”€ product-service/        â† å•†å“æœåŠ¡
â””â”€â”€ order-service/          â† è®¢å•æœåŠ¡
```

**çˆ¶å·¥ç¨‹POMé…ç½®è¦ç‚¹**
```xml
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.7.2</version>
</parent>

<properties>
    <spring-cloud.version>2021.0.3</spring-cloud.version>
</properties>

<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>${spring-cloud.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

---

## 3. ğŸ¯ æœåŠ¡æ³¨å†Œä¸å‘ç°


### 3.1 æœåŠ¡æ³¨å†Œä¸å‘ç°çš„ä½œç”¨


**é—®é¢˜åœºæ™¯**ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¹‹é—´éœ€è¦ç›¸äº’è°ƒç”¨ï¼Œä½†æ˜¯ï¼š
- æœåŠ¡çš„IPåœ°å€å¯èƒ½ä¼šå˜åŒ–
- æœåŠ¡å¯èƒ½æœ‰å¤šä¸ªå®ä¾‹
- æœåŠ¡å®ä¾‹å¯èƒ½ä¼šå®•æœº

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨**æœåŠ¡æ³¨å†Œä¸­å¿ƒ**

```
æ²¡æœ‰æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µï¼š
è®¢å•æœåŠ¡ â”€â”€ç›´æ¥è°ƒç”¨â”€â”€> ç”¨æˆ·æœåŠ¡(192.168.1.10:8080)
                    â†‘
                   å†™æ­»IPåœ°å€ï¼ŒæœåŠ¡é‡å¯åå¯èƒ½å¤±æ•ˆ

æœ‰æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µï¼š
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æ³¨å†Œä¸­å¿ƒ    â”‚  â† æ‰€æœ‰æœåŠ¡ä¿¡æ¯çš„ç”µè¯ç°¿
    â”‚   Eureka    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘    â†‘
    â”Œâ”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”
    â”‚æ³¨å†Œ        æŸ¥è¯¢â”‚
    â†“              â†“
ç”¨æˆ·æœåŠ¡        è®¢å•æœåŠ¡
```

### 3.2 Eurekaæ³¨å†Œä¸­å¿ƒå®æˆ˜


#### ğŸ”§ æ­å»ºEureka Server


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
</dependency>
```

**å¯åŠ¨ç±»é…ç½®**
```java
@SpringBootApplication
@EnableEurekaServer  // å¼€å¯EurekaæœåŠ¡ç«¯åŠŸèƒ½
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

**æ ¸å¿ƒé…ç½®è¯´æ˜**
```yaml
server:
  port: 8761  # Eurekaé»˜è®¤ç«¯å£

eureka:
  instance:
    hostname: localhost  # æœåŠ¡å™¨ä¸»æœºå
  client:
    register-with-eureka: false    # ä¸å‘è‡ªå·±æ³¨å†Œ
    fetch-registry: false          # ä¸ä»è‡ªå·±è·å–æ³¨å†Œä¿¡æ¯
    service-url:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/
```

#### ğŸ”§ é…ç½®Eureka Client


**æœåŠ¡æä¾›è€…é…ç½®**
```yaml
spring:
  application:
    name: user-service  # æœåŠ¡åç§°ï¼Œå…¶ä»–æœåŠ¡é€šè¿‡è¿™ä¸ªåç§°è°ƒç”¨

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/  # æ³¨å†Œä¸­å¿ƒåœ°å€
  instance:
    prefer-ip-address: true  # ä½¿ç”¨IPåœ°å€æ³¨å†Œ
```

**å¯åŠ¨ç±»æ·»åŠ æ³¨è§£**
```java
@SpringBootApplication
@EnableEurekaClient  // å¼€å¯Eurekaå®¢æˆ·ç«¯åŠŸèƒ½
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

### 3.3 æœåŠ¡å‘ç°çš„å·¥ä½œåŸç†


**æœåŠ¡æ³¨å†Œæµç¨‹**
```
1. æœåŠ¡å¯åŠ¨
   â†“
2. å‘Eureka Serverå‘é€æ³¨å†Œè¯·æ±‚
   â†“
3. Eureka Serverä¿å­˜æœåŠ¡ä¿¡æ¯
   â†“
4. å®šæœŸå‘é€å¿ƒè·³ç»´æŒæ³¨å†ŒçŠ¶æ€

æœåŠ¡Aå¯åŠ¨ â”€â”€æ³¨å†Œâ”€â”€> Eureka Server <â”€â”€æ³¨å†Œâ”€â”€ æœåŠ¡Bå¯åŠ¨
    â”‚                   â”‚                 â”‚
    â””â”€â”€å¿ƒè·³ç»­çº¦â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€å¿ƒè·³ç»­çº¦â”€â”€â”˜
```

**æœåŠ¡å‘ç°æµç¨‹**
```
1. æœåŠ¡Aéœ€è¦è°ƒç”¨æœåŠ¡B
   â†“
2. å‘Eureka ServeræŸ¥è¯¢æœåŠ¡Bçš„å®ä¾‹åˆ—è¡¨
   â†“
3. è·å–æœåŠ¡Bçš„IPå’Œç«¯å£ä¿¡æ¯
   â†“
4. ç›´æ¥è°ƒç”¨æœåŠ¡B

è®¢å•æœåŠ¡ â”€â”€æŸ¥è¯¢ç”¨æˆ·æœåŠ¡åœ°å€â”€â”€> Eureka Server
    â”‚                         â”‚
    â”‚<â”€â”€è¿”å›ï¼š192.168.1.10:8080â”€â”€â”‚
    â”‚
    â””â”€â”€ç›´æ¥HTTPè°ƒç”¨â”€â”€> ç”¨æˆ·æœåŠ¡(192.168.1.10:8080)
```

### 3.4 Eurekaçš„é«˜å¯ç”¨é…ç½®


**å¤šèŠ‚ç‚¹Eurekaé›†ç¾¤**
```
èŠ‚ç‚¹1é…ç½®ï¼š
eureka:
  instance:
    hostname: eureka1
  client:
    service-url:
      defaultZone: http://eureka2:8762/eureka/,http://eureka3:8763/eureka/

èŠ‚ç‚¹2é…ç½®ï¼š
eureka:
  instance:
    hostname: eureka2
  client:
    service-url:
      defaultZone: http://eureka1:8761/eureka/,http://eureka3:8763/eureka/
```

**é›†ç¾¤æ¶æ„å›¾**
```
å®¢æˆ·ç«¯æœåŠ¡
    â”‚
    â”œâ”€æ³¨å†Œâ”€> Eureka1 <â”€åŒæ­¥â”€> Eureka2 <â”€åŒæ­¥â”€> Eureka3
    â”œâ”€æ³¨å†Œâ”€> Eureka2     â†‘                    â†‘
    â””â”€æ³¨å†Œâ”€> Eureka3     â””â”€â”€â”€â”€â”€â”€â”€â”€åŒæ­¥â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
æ¯ä¸ªEurekaèŠ‚ç‚¹éƒ½ä¿å­˜å®Œæ•´çš„æœåŠ¡æ³¨å†Œä¿¡æ¯
ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å®•æœºï¼Œå…¶ä»–èŠ‚ç‚¹ä»å¯æ­£å¸¸å·¥ä½œ
```

---

## 4. âš–ï¸ è´Ÿè½½å‡è¡¡ä¸æœåŠ¡è°ƒç”¨


### 4.1 è´Ÿè½½å‡è¡¡çš„å¿…è¦æ€§


**åœºæ™¯è¯´æ˜**ï¼šå½“ä¸€ä¸ªæœåŠ¡æœ‰å¤šä¸ªå®ä¾‹æ—¶ï¼Œè°ƒç”¨æ–¹å¦‚ä½•é€‰æ‹©ï¼Ÿ

```
è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼š

ç”¨æˆ·æœåŠ¡å®ä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æœåŠ¡1   â”‚  â”‚ ç”¨æˆ·æœåŠ¡2   â”‚  â”‚ ç”¨æˆ·æœåŠ¡3   â”‚
â”‚ 8080ç«¯å£    â”‚  â”‚ 8081ç«¯å£    â”‚  â”‚ 8082ç«¯å£    â”‚
â”‚ è´Ÿè½½ï¼šé«˜    â”‚  â”‚ è´Ÿè½½ï¼šä½    â”‚  â”‚ è´Ÿè½½ï¼šä¸­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘              â†‘              â†‘
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            è´Ÿè½½å‡è¡¡å™¨å†³å®šè°ƒç”¨å“ªä¸ª
                       â”‚
                   è®¢å•æœåŠ¡
```

### 4.2 Ribbonè´Ÿè½½å‡è¡¡ç»„ä»¶


**Ribbonçš„ä½œç”¨**ï¼šåœ¨å®¢æˆ·ç«¯å®ç°è´Ÿè½½å‡è¡¡ï¼Œè‡ªåŠ¨åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹é—´åˆ†é…è¯·æ±‚

#### ğŸ”§ é›†æˆRibbon


**ä¾èµ–é…ç½®**
```xml
<!-- Spring Cloud 2020ç‰ˆæœ¬åï¼Œé»˜è®¤ä¸åŒ…å«Ribbon -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>
</dependency>
```

**RestTemplateé…ç½®**
```java
@Configuration
public class RestTemplateConfig {
    
    @Bean
    @LoadBalanced  // å¼€å¯è´Ÿè½½å‡è¡¡åŠŸèƒ½
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```java
@Service
public class OrderService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public User getUserById(Long userId) {
        // ç›´æ¥ä½¿ç”¨æœåŠ¡åç§°ï¼ŒRibbonä¼šè‡ªåŠ¨é€‰æ‹©å®ä¾‹
        String url = "http://user-service/users/" + userId;
        return restTemplate.getForObject(url, User.class);
    }
}
```

#### ğŸ¯ è´Ÿè½½å‡è¡¡ç­–ç•¥


| **ç­–ç•¥åç§°** | **è¯´æ˜** | **é€‚ç”¨åœºæ™¯** |
|-------------|----------|-------------|
| **RoundRobinRule** | è½®è¯¢ç­–ç•¥ï¼Œä¾æ¬¡è°ƒç”¨æ¯ä¸ªå®ä¾‹ | **é»˜è®¤ç­–ç•¥**ï¼Œé€‚åˆå®ä¾‹æ€§èƒ½ç›¸è¿‘çš„æƒ…å†µ |
| **RandomRule** | éšæœºé€‰æ‹©å®ä¾‹ | ç®€å•åœºæ™¯ï¼Œæ— ç‰¹æ®Šè¦æ±‚ |
| **WeightedResponseTimeRule** | æ ¹æ®å“åº”æ—¶é—´åˆ†é…æƒé‡ | å®ä¾‹æ€§èƒ½å·®å¼‚è¾ƒå¤§æ—¶ |
| **BestAvailableRule** | é€‰æ‹©å¹¶å‘é‡æœ€å°çš„å®ä¾‹ | å¤„ç†èƒ½åŠ›å·®å¼‚è¾ƒå¤§æ—¶ |

**è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥**
```java
@Configuration
public class RibbonConfig {
    
    @Bean
    public IRule ribbonRule() {
        return new RandomRule();  // ä½¿ç”¨éšæœºç­–ç•¥
    }
}
```

### 4.3 Spring Cloud LoadBalancer


**æ–°ä¸€ä»£è´Ÿè½½å‡è¡¡å™¨**ï¼šSpring Cloud 2020ç‰ˆæœ¬åæ¨èä½¿ç”¨LoadBalanceræ›¿ä»£Ribbon

#### ğŸ”§ LoadBalanceråŸºç¡€ä½¿ç”¨


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-loadbalancer</artifactId>
</dependency>
```

**é…ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥**
```java
@Configuration
public class LoadBalancerConfig {
    
    @Bean
    public ReactorLoadBalancer<ServiceInstance> randomLoadBalancer(
            Environment environment, LoadBalancerClientFactory loadBalancerClientFactory) {
        String name = environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);
        return new RandomLoadBalancer(
                loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class),
                name);
    }
}
```

### 4.4 OpenFeignå£°æ˜å¼æœåŠ¡è°ƒç”¨


**OpenFeignçš„ä¼˜åŠ¿**ï¼šè®©è¿œç¨‹æœåŠ¡è°ƒç”¨åƒæœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·ç®€å•

#### ğŸ”§ OpenFeignå¿«é€Ÿä¸Šæ‰‹


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

**å¯ç”¨Feign**
```java
@SpringBootApplication
@EnableFeignClients  // å¼€å¯Feignå®¢æˆ·ç«¯æ‰«æ
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

**å®šä¹‰Feignæ¥å£**
```java
@FeignClient("user-service")  // æŒ‡å®šè¦è°ƒç”¨çš„æœåŠ¡å
public interface UserFeignClient {
    
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    @PostMapping("/users")
    User createUser(@RequestBody User user);
}
```

**ä½¿ç”¨Feignå®¢æˆ·ç«¯**
```java
@Service
public class OrderService {
    
    @Autowired
    private UserFeignClient userFeignClient;
    
    public Order createOrder(CreateOrderRequest request) {
        // åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡
        User user = userFeignClient.getUserById(request.getUserId());
        
        Order order = new Order();
        order.setUser(user);
        // ... å…¶ä»–é€»è¾‘
        return order;
    }
}
```

#### âš™ï¸ Feigné«˜çº§é…ç½®


**è¶…æ—¶é…ç½®**
```yaml
feign:
  client:
    config:
      user-service:  # é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„é…ç½®
        connect-timeout: 5000    # è¿æ¥è¶…æ—¶5ç§’
        read-timeout: 10000      # è¯»å–è¶…æ—¶10ç§’
      default:       # å…¨å±€é»˜è®¤é…ç½®
        connect-timeout: 2000
        read-timeout: 5000
```

**æ—¥å¿—çº§åˆ«é…ç½®**
```java
@Configuration
public class FeignConfig {
    
    @Bean
    public Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;  // è®°å½•å®Œæ•´çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯
    }
}
```

**è‡ªå®šä¹‰æ‹¦æˆªå™¨**
```java
@Component
public class FeignRequestInterceptor implements RequestInterceptor {
    
    @Override
    public void apply(RequestTemplate template) {
        // æ·»åŠ é€šç”¨è¯·æ±‚å¤´
        template.header("Authorization", "Bearer " + getToken());
        template.header("Content-Type", "application/json");
    }
    
    private String getToken() {
        // è·å–è®¤è¯Tokençš„é€»è¾‘
        return "your-token";
    }
}
```

---

## 5. ğŸšª æœåŠ¡ç½‘å…³Gateway


### 5.1 ç½‘å…³çš„ä½œç”¨ä¸ä»·å€¼


**ç½‘å…³å°±åƒå°åŒºçš„é—¨å«**ï¼šæ‰€æœ‰è¿›å‡ºå°åŒºçš„äººéƒ½è¦ç»è¿‡é—¨å«æ£€æŸ¥

```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š

æ²¡æœ‰ç½‘å…³ï¼š
ç§»åŠ¨ç«¯ â”€â”€â”€â”€> ç”¨æˆ·æœåŠ¡(8081)
       â”œâ”€â”€> å•†å“æœåŠ¡(8082)  
       â”œâ”€â”€> è®¢å•æœåŠ¡(8083)
       â””â”€â”€> æ”¯ä»˜æœåŠ¡(8084)
é—®é¢˜ï¼šå®¢æˆ·ç«¯éœ€è¦è®°ä½æ‰€æœ‰æœåŠ¡çš„åœ°å€ï¼Œå®‰å…¨æ§åˆ¶åˆ†æ•£

æœ‰ç½‘å…³ï¼š
ç§»åŠ¨ç«¯ â”€â”€â”€â”€> ç½‘å…³(80) â”€â”€â”€â”€â”¬â”€â”€> ç”¨æˆ·æœåŠ¡(8081)
                        â”œâ”€â”€> å•†å“æœåŠ¡(8082)
                        â”œâ”€â”€> è®¢å•æœåŠ¡(8083)
                        â””â”€â”€> æ”¯ä»˜æœåŠ¡(8084)
ä¼˜åŠ¿ï¼šç»Ÿä¸€å…¥å£ï¼Œé›†ä¸­ç®¡ç†è®¤è¯ã€é™æµã€ç›‘æ§ç­‰
```

**ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½**
- **ğŸšª ç»Ÿä¸€å…¥å£**ï¼šå®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“ç½‘å…³åœ°å€
- **ğŸ” å®‰å…¨è®¤è¯**ï¼šç»Ÿä¸€å¤„ç†ç”¨æˆ·ç™»å½•éªŒè¯
- **âš¡ é™æµæ§åˆ¶**ï¼šé˜²æ­¢ç³»ç»Ÿè¢«å¤§é‡è¯·æ±‚å‹å®
- **ğŸ“Š ç›‘æ§æ—¥å¿—**ï¼šç»Ÿä¸€è®°å½•æ‰€æœ‰è¯·æ±‚ä¿¡æ¯
- **ğŸ”„ è´Ÿè½½å‡è¡¡**ï¼šæ™ºèƒ½åˆ†å‘è¯·æ±‚åˆ°ä¸åŒæœåŠ¡å®ä¾‹

### 5.2 Spring Cloud Gatewayå®æˆ˜


#### ğŸ”§ GatewayåŸºç¡€é…ç½®


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>
```

**è·¯ç”±é…ç½®**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service-route        # è·¯ç”±IDï¼Œå”¯ä¸€æ ‡è¯†
          uri: lb://user-service        # lbä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œuser-serviceæ˜¯æœåŠ¡å
          predicates:                   # è·¯ç”±æ¡ä»¶
            - Path=/api/users/**        # åŒ¹é…è·¯å¾„
        - id: product-service-route
          uri: lb://product-service
          predicates:
            - Path=/api/products/**
        - id: order-service-route
          uri: lb://order-service
          predicates:
            - Path=/api/orders/**
      discovery:
        locator:
          enabled: true                 # å¼€å¯æœåŠ¡å‘ç°
          lower-case-service-id: true   # æœåŠ¡åè½¬å°å†™
```

#### ğŸ¯ è·¯ç”±æ–­è¨€(Predicates)


**è·¯ç”±æ–­è¨€å°±åƒæ˜¯äº¤é€šæŒ‡ç¤ºç‰Œ**ï¼Œå‘Šè¯‰è¯·æ±‚è¯¥èµ°å“ªæ¡è·¯

| **æ–­è¨€ç±»å‹** | **è¯´æ˜** | **ç¤ºä¾‹** |
|-------------|----------|----------|
| **Path** | è·¯å¾„åŒ¹é… | `Path=/api/users/**` |
| **Method** | HTTPæ–¹æ³•åŒ¹é… | `Method=GET,POST` |
| **Header** | è¯·æ±‚å¤´åŒ¹é… | `Header=Authorization,Bearer.*` |
| **Query** | æŸ¥è¯¢å‚æ•°åŒ¹é… | `Query=version,v2` |
| **Host** | ä¸»æœºååŒ¹é… | `Host=**.example.com` |

**å¤åˆæ¡ä»¶ç¤ºä¾‹**
```yaml
- id: admin-route
  uri: lb://admin-service
  predicates:
    - Path=/admin/**           # è·¯å¾„å¿…é¡»æ˜¯/adminå¼€å¤´
    - Method=GET,POST          # æ–¹æ³•å¿…é¡»æ˜¯GETæˆ–POST
    - Header=Role,admin        # è¯·æ±‚å¤´Roleå¿…é¡»æ˜¯admin
    - Query=version,v2         # æŸ¥è¯¢å‚æ•°versionå¿…é¡»æ˜¯v2
```

#### ğŸ”„ è·¯ç”±è¿‡æ»¤å™¨(Filters)


**è¿‡æ»¤å™¨å°±åƒæ˜¯åŠ å·¥å‚çš„æµæ°´çº¿**ï¼Œå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œå¤„ç†

**å†…ç½®è¿‡æ»¤å™¨ç¤ºä¾‹**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - StripPrefix=1              # å»æ‰ç¬¬ä¸€å±‚è·¯å¾„å‰ç¼€
            - AddRequestHeader=X-Request-Source,gateway  # æ·»åŠ è¯·æ±‚å¤´
            - AddResponseHeader=X-Response-Time,#{T(System).currentTimeMillis()}
            - SetPath=/users/{segment}   # é‡å†™è·¯å¾„
```

**è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨**
```java
@Component
public class AuthGlobalFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest request = exchange.getRequest();
        
        // è·å–è¯·æ±‚è·¯å¾„
        String path = request.getURI().getPath();
        
        // æ’é™¤ä¸éœ€è¦è®¤è¯çš„è·¯å¾„
        if (path.startsWith("/api/public/")) {
            return chain.filter(exchange);
        }
        
        // æ£€æŸ¥Authorizationå¤´
        String token = request.getHeaders().getFirst("Authorization");
        if (token == null || !isValidToken(token)) {
            ServerHttpResponse response = exchange.getResponse();
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }
        
        return chain.filter(exchange);
    }
    
    @Override
    public int getOrder() {
        return -1;  // ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    }
    
    private boolean isValidToken(String token) {
        // éªŒè¯tokençš„é€»è¾‘
        return token.startsWith("Bearer ");
    }
}
```

### 5.3 Gatewayé«˜çº§ç‰¹æ€§


#### ğŸ” è®¤è¯é›†æˆ


**é›†æˆJWTè®¤è¯**
```java
@Component
public class JwtAuthFilter implements GlobalFilter {
    
    @Autowired
    private JwtTokenUtil jwtTokenUtil;
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String token = extractToken(exchange.getRequest());
        
        if (token != null && jwtTokenUtil.validateToken(token)) {
            String username = jwtTokenUtil.getUsernameFromToken(token);
            // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­
            ServerHttpRequest mutatedRequest = exchange.getRequest().mutate()
                .header("X-User-Name", username)
                .build();
            return chain.filter(exchange.mutate().request(mutatedRequest).build());
        }
        
        return unauthorizedResponse(exchange);
    }
}
```

#### âš¡ é™æµæ§åˆ¶


**Redisé™æµé…ç½®**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10    # æ¯ç§’è¡¥å……çš„ä»¤ç‰Œæ•°
                redis-rate-limiter.burstCapacity: 20    # æ¡¶å®¹é‡
                key-resolver: "#{@ipKeyResolver}"       # é™æµkeyç”Ÿæˆå™¨
```

**è‡ªå®šä¹‰Keyç”Ÿæˆå™¨**
```java
@Bean
public KeyResolver ipKeyResolver() {
    return exchange -> Mono.just(
        exchange.getRequest().getRemoteAddress().getAddress().getHostAddress()
    );
}
```

---

## 6. âš™ï¸ é…ç½®ç®¡ç†Config


### 6.1 é…ç½®ç®¡ç†çš„æŒ‘æˆ˜


**ä¼ ç»Ÿé…ç½®ç®¡ç†çš„é—®é¢˜**ï¼š
- é…ç½®æ–‡ä»¶åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡ä¸­
- ä¿®æ”¹é…ç½®éœ€è¦é‡å¯æœåŠ¡
- ä¸åŒç¯å¢ƒçš„é…ç½®ç®¡ç†å¤æ‚

**Spring Cloud Configçš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
é›†ä¸­å¼é…ç½®ç®¡ç†ï¼š

Gitä»“åº“ï¼ˆé…ç½®å­˜å‚¨ï¼‰
â”œâ”€â”€ application.yml          # å…¨å±€é…ç½®
â”œâ”€â”€ user-service.yml         # ç”¨æˆ·æœåŠ¡é…ç½®
â”œâ”€â”€ product-service.yml      # å•†å“æœåŠ¡é…ç½®
â””â”€â”€ order-service.yml        # è®¢å•æœåŠ¡é…ç½®
        â”‚
        â†“ é…ç½®æœåŠ¡å™¨ä»Gitæ‹‰å–é…ç½®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Config Server  â”‚  â† é…ç½®ä¸­å¿ƒæœåŠ¡
â”‚    (8888)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¤ å„ä¸ªæœåŠ¡ä»é…ç½®ä¸­å¿ƒè·å–é…ç½®
    â†“   â†“   â†“
ç”¨æˆ·æœåŠ¡ å•†å“æœåŠ¡ è®¢å•æœåŠ¡
```

### 6.2 Config Serveræ­å»º


#### ğŸ”§ é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-config-server</artifactId>
</dependency>
```

**å¯åŠ¨ç±»é…ç½®**
```java
@SpringBootApplication
@EnableConfigServer  // å¼€å¯é…ç½®æœåŠ¡å™¨åŠŸèƒ½
public class ConfigServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(ConfigServerApplication.class, args);
    }
}
```

**æœåŠ¡ç«¯é…ç½®**
```yaml
server:
  port: 8888

spring:
  application:
    name: config-server
  cloud:
    config:
      server:
        git:
          uri: https://github.com/your-username/config-repo.git  # Gitä»“åº“åœ°å€
          default-label: main    # é»˜è®¤åˆ†æ”¯
          search-paths: config   # é…ç½®æ–‡ä»¶æœç´¢è·¯å¾„
```

#### ğŸ“ Gité…ç½®ä»“åº“ç»“æ„


**é…ç½®ä»“åº“ç›®å½•ç»“æ„**
```
config-repo/
â”œâ”€â”€ application.yml                    # å…¨å±€é»˜è®¤é…ç½®
â”œâ”€â”€ application-dev.yml                # å¼€å‘ç¯å¢ƒå…¨å±€é…ç½®
â”œâ”€â”€ application-prod.yml               # ç”Ÿäº§ç¯å¢ƒå…¨å±€é…ç½®
â”œâ”€â”€ user-service.yml                   # ç”¨æˆ·æœåŠ¡é»˜è®¤é…ç½®
â”œâ”€â”€ user-service-dev.yml               # ç”¨æˆ·æœåŠ¡å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ user-service-prod.yml              # ç”¨æˆ·æœåŠ¡ç”Ÿäº§ç¯å¢ƒé…ç½®
â””â”€â”€ product-service.yml                # å•†å“æœåŠ¡é…ç½®
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**
```yaml
# user-service-dev.yml
server:
  port: 8081

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/user_dev
    username: dev_user
    password: dev_password
  
logging:
  level:
    com.example.user: DEBUG

# è‡ªå®šä¹‰ä¸šåŠ¡é…ç½®
user:
  service:
    max-login-attempts: 3
    cache-expire-time: 3600
```

### 6.3 Config Clienté…ç½®


#### ğŸ”§ å®¢æˆ·ç«¯é…ç½®


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>
```

**bootstrap.ymlé…ç½®**
```yaml
spring:
  application:
    name: user-service         # åº”ç”¨åç§°ï¼Œå¯¹åº”é…ç½®æ–‡ä»¶åå‰ç¼€
  profiles:
    active: dev                # ç¯å¢ƒæ ‡è¯†
  cloud:
    config:
      uri: http://localhost:8888    # é…ç½®æœåŠ¡å™¨åœ°å€
      label: main                   # Gitåˆ†æ”¯
      fail-fast: true               # é…ç½®æœåŠ¡å™¨è¿æ¥å¤±è´¥æ—¶å¿«é€Ÿå¤±è´¥
      retry:
        initial-interval: 1000      # é‡è¯•é—´éš”
        max-attempts: 6             # æœ€å¤§é‡è¯•æ¬¡æ•°
```

#### ğŸ”„ åŠ¨æ€é…ç½®åˆ·æ–°


**æ·»åŠ åˆ·æ–°ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**é…ç½®åˆ·æ–°ç«¯ç‚¹**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: refresh,health  # æš´éœ²refreshç«¯ç‚¹
```

**ä½¿ç”¨@RefreshScopeæ³¨è§£**
```java
@RestController
@RefreshScope  // æ”¯æŒé…ç½®çƒ­åˆ·æ–°
public class UserController {
    
    @Value("${user.service.max-login-attempts:5}")
    private int maxLoginAttempts;
    
    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        Map<String, Object> config = new HashMap<>();
        config.put("maxLoginAttempts", maxLoginAttempts);
        return config;
    }
}
```

**æ‰‹åŠ¨åˆ·æ–°é…ç½®**
```bash
# POSTè¯·æ±‚è§¦å‘é…ç½®åˆ·æ–°
curl -X POST http://localhost:8081/actuator/refresh
```

### 6.4 é…ç½®åŠ å¯†ä¸å®‰å…¨


#### ğŸ” æ•æ„Ÿä¿¡æ¯åŠ å¯†


**å¯¹ç§°åŠ å¯†é…ç½®**
```yaml
# åœ¨é…ç½®æœåŠ¡å™¨ä¸­è®¾ç½®åŠ å¯†å¯†é’¥
encrypt:
  key: my-secret-key
```

**åŠ å¯†æ•æ„Ÿé…ç½®**
```bash
# é€šè¿‡é…ç½®æœåŠ¡å™¨åŠ å¯†æ¥å£åŠ å¯†å¯†ç 
curl -X POST http://localhost:8888/encrypt -d "my-secret-password"
# è¿”å›ï¼š{cipher}AQA1234567890abcdef...
```

**ä½¿ç”¨åŠ å¯†é…ç½®**
```yaml
# user-service-prod.yml
spring:
  datasource:
    username: prod_user
    password: '{cipher}AQA1234567890abcdef...'  # åŠ å¯†åçš„å¯†ç 
```

---

## 7. ğŸ”§ æ–­è·¯å™¨ä¸å®¹é”™


### 7.1 å¾®æœåŠ¡å®¹é”™çš„é‡è¦æ€§


**æœåŠ¡é›ªå´©é—®é¢˜**ï¼šä¸€ä¸ªæœåŠ¡çš„æ•…éšœå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿç˜«ç—ª

```
æœåŠ¡è°ƒç”¨é“¾è·¯ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡ â†’ åº“å­˜æœåŠ¡
                   â†“
               ä»·æ ¼æœåŠ¡ï¼ˆè¶…æ—¶/æ•…éšœï¼‰

æ²¡æœ‰å®¹é”™æœºåˆ¶çš„åæœï¼š
1. ä»·æ ¼æœåŠ¡å“åº”æ…¢/å®•æœº
2. å•†å“æœåŠ¡ç­‰å¾…ä»·æ ¼æœåŠ¡å“åº”ï¼Œçº¿ç¨‹é˜»å¡
3. è®¢å•æœåŠ¡ç­‰å¾…å•†å“æœåŠ¡å“åº”ï¼Œçº¿ç¨‹é˜»å¡  
4. å¤§é‡è¯·æ±‚ç§¯å‹ï¼Œæ•´ä¸ªç³»ç»Ÿå´©æºƒ

é›ªå´©æ•ˆåº”ï¼š
ä»·æ ¼æœåŠ¡æ•…éšœ â†’ å•†å“æœåŠ¡é˜»å¡ â†’ è®¢å•æœåŠ¡é˜»å¡ â†’ æ•´ä½“ç³»ç»Ÿç˜«ç—ª
```

**æ–­è·¯å™¨æ¨¡å¼**ï¼šå°±åƒå®¶é‡Œçš„ä¿é™©ä¸ï¼Œå½“ç”µæµè¿‡å¤§æ—¶è‡ªåŠ¨æ–­å¼€ä¿æŠ¤ç”µè·¯

```
æ–­è·¯å™¨çš„ä¸‰ç§çŠ¶æ€ï¼š

å…³é—­çŠ¶æ€ï¼ˆæ­£å¸¸ï¼‰ï¼š
è¯·æ±‚ â†’ æ–­è·¯å™¨ â†’ ç›®æ ‡æœåŠ¡ â†’ æ­£å¸¸å“åº”

å¼€å¯çŠ¶æ€ï¼ˆæ•…éšœï¼‰ï¼š
è¯·æ±‚ â†’ æ–­è·¯å™¨ â†’ å¿«é€Ÿå¤±è´¥ï¼ˆä¸è°ƒç”¨ç›®æ ‡æœåŠ¡ï¼‰

åŠå¼€çŠ¶æ€ï¼ˆè¯•æ¢ï¼‰ï¼š
è¯·æ±‚ â†’ æ–­è·¯å™¨ â†’ å…è®¸å°‘é‡è¯·æ±‚æµ‹è¯•ç›®æ ‡æœåŠ¡æ˜¯å¦æ¢å¤
```

### 7.2 Hystrixæ–­è·¯å™¨å®æˆ˜


#### ğŸ”§ HystrixåŸºç¡€é…ç½®


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>
</dependency>
```

**å¯ç”¨Hystrix**
```java
@SpringBootApplication
@EnableHystrix  // å¼€å¯Hystrixæ–­è·¯å™¨åŠŸèƒ½
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

**åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹**
```java
@Service
public class ProductService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @HystrixCommand(fallbackMethod = "getProductFallback",
                   commandProperties = {
                       @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "2000")
                   })
    public Product getProductById(Long productId) {
        String url = "http://product-service/products/" + productId;
        return restTemplate.getForObject(url, Product.class);
    }
    
    // é™çº§æ–¹æ³•ï¼šå½“ä¸»æ–¹æ³•å¤±è´¥æ—¶è°ƒç”¨
    public Product getProductFallback(Long productId) {
        Product fallbackProduct = new Product();
        fallbackProduct.setId(productId);
        fallbackProduct.setName("å•†å“æš‚æ—¶ä¸å¯ç”¨");
        fallbackProduct.setPrice(BigDecimal.ZERO);
        return fallbackProduct;
    }
}
```

#### âš™ï¸ Hystrixæ ¸å¿ƒé…ç½®


**è¶…æ—¶é…ç½®**
```yaml
hystrix:
  command:
    default:                                    # å…¨å±€é»˜è®¤é…ç½®
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 3000         # è¶…æ—¶æ—¶é—´3ç§’
    ProductService#getProductById(Long):        # ç‰¹å®šæ–¹æ³•é…ç½®  
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 5000         # ç‰¹å®šæ–¹æ³•è¶…æ—¶5ç§’
```

**æ–­è·¯å™¨å‚æ•°é…ç½®**
```yaml
hystrix:
  command:
    default:
      circuitBreaker:
        enabled: true                           # å¼€å¯æ–­è·¯å™¨
        requestVolumeThreshold: 20              # è§¦å‘æ–­è·¯å™¨çš„æœ€å°è¯·æ±‚æ•°
        errorThresholdPercentage: 50            # é”™è¯¯ç‡è¾¾åˆ°50%æ—¶æ‰“å¼€æ–­è·¯å™¨
        sleepWindowInMilliseconds: 5000         # æ–­è·¯å™¨æ‰“å¼€åç­‰å¾…5ç§’å†å°è¯•åŠå¼€
```

#### ğŸ“Š Hystrix Dashboardç›‘æ§


**ç›‘æ§ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>
</dependency>
```

**å¯ç”¨Dashboard**
```java
@SpringBootApplication
@EnableHystrixDashboard  // å¼€å¯Hystrixç›‘æ§é¢æ¿
public class MonitorApplication {
    public static void main(String[] args) {
        SpringApplication.run(MonitorApplication.class, args);
    }
}
```

**ç›‘æ§æ•°æ®æš´éœ²**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: hystrix.stream  # æš´éœ²Hystrixç›‘æ§æµ
```

### 7.3 Resilience4jç°ä»£åŒ–å®¹é”™è§£å†³æ–¹æ¡ˆ


**Resilience4j**æ˜¯æ–°ä¸€ä»£çš„å®¹é”™åº“ï¼Œæ¯”Hystrixæ›´è½»é‡ã€æ›´ç°ä»£

#### ğŸ”§ Resilience4jå¿«é€Ÿä¸Šæ‰‹


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-circuitbreaker-resilience4j</artifactId>
</dependency>
```

**æ–­è·¯å™¨ä½¿ç”¨**
```java
@Service
public class UserService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @CircuitBreaker(name = "user-service", fallbackMethod = "getUserFallback")
    @TimeLimiter(name = "user-service")
    @Retry(name = "user-service")
    public CompletableFuture<User> getUserById(Long userId) {
        String url = "http://user-service/users/" + userId;
        User user = restTemplate.getForObject(url, User.class);
        return CompletableFuture.completedFuture(user);
    }
    
    public CompletableFuture<User> getUserFallback(Long userId, Exception ex) {
        User defaultUser = new User();
        defaultUser.setId(userId);
        defaultUser.setName("é»˜è®¤ç”¨æˆ·");
        return CompletableFuture.completedFuture(defaultUser);
    }
}
```

**é…ç½®æ–‡ä»¶**
```yaml
resilience4j:
  circuitbreaker:
    instances:
      user-service:
        sliding-window-size: 10                 # æ»‘åŠ¨çª—å£å¤§å°
        failure-rate-threshold: 60              # å¤±è´¥ç‡é˜ˆå€¼60%
        wait-duration-in-open-state: 30s        # æ–­è·¯å™¨å¼€å¯çŠ¶æ€ç­‰å¾…æ—¶é—´
        permitted-number-of-calls-in-half-open-state: 3  # åŠå¼€çŠ¶æ€å…è®¸çš„è°ƒç”¨æ•°
  retry:
    instances:
      user-service:
        max-attempts: 3                         # æœ€å¤§é‡è¯•æ¬¡æ•°
        wait-duration: 1s                       # é‡è¯•é—´éš”
  timelimiter:
    instances:
      user-service:
        timeout-duration: 2s                    # è¶…æ—¶æ—¶é—´
```

### 7.4 å®¹é”™æ¨¡å¼æœ€ä½³å®è·µ


#### ğŸ¯ åˆç†çš„é™çº§ç­–ç•¥


**é™çº§ç­–ç•¥åˆ†ç±»**
```java
@Service  
public class RecommendationService {
    
    // 1. è¿”å›ç¼“å­˜æ•°æ®
    @CircuitBreaker(name = "recommendation", fallbackMethod = "getCachedRecommendations")
    public List<Product> getPersonalizedRecommendations(Long userId) {
        return callRecommendationService(userId);
    }
    
    public List<Product> getCachedRecommendations(Long userId, Exception ex) {
        return cacheService.getCachedRecommendations(userId);
    }
    
    // 2. è¿”å›é»˜è®¤æ•°æ®
    @CircuitBreaker(name = "hot-products", fallbackMethod = "getDefaultHotProducts")
    public List<Product> getHotProducts() {
        return callProductService();
    }
    
    public List<Product> getDefaultHotProducts(Exception ex) {
        return Arrays.asList(
            new Product(1L, "çƒ­é”€å•†å“1"),
            new Product(2L, "çƒ­é”€å•†å“2")
        );
    }
    
    // 3. åŠŸèƒ½é™çº§
    @CircuitBreaker(name = "points", fallbackMethod = "skipPointsCalculation")
    public OrderResult createOrderWithPoints(Order order) {
        calculateAndDeductPoints(order);
        return saveOrder(order);
    }
    
    public OrderResult skipPointsCalculation(Order order, Exception ex) {
        // è·³è¿‡ç§¯åˆ†è®¡ç®—ï¼Œä½†è®¢å•æ­£å¸¸åˆ›å»º
        log.warn("ç§¯åˆ†æœåŠ¡ä¸å¯ç”¨ï¼Œè·³è¿‡ç§¯åˆ†è®¡ç®—ï¼Œè®¢å•ï¼š{}", order.getId());
        return saveOrder(order);
    }
}
```

---

## 8. ğŸš€ è¿›é˜¶å®è·µåº”ç”¨


### 8.1 é“¾è·¯è¿½è¸ªä¸ç›‘æ§


**åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª**ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­è¿½è¸ªä¸€ä¸ªè¯·æ±‚çš„å®Œæ•´è°ƒç”¨è·¯å¾„

```
ç”¨æˆ·ä¸‹å•è¯·æ±‚çš„è°ƒç”¨é“¾è·¯ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ 
    â†“ [Trace ID: abc123]
ç½‘å…³æœåŠ¡ 
    â†“ [Trace ID: abc123, Span ID: span1]  
è®¢å•æœåŠ¡
    â”œâ”€â†’ ç”¨æˆ·æœåŠ¡ [Trace ID: abc123, Span ID: span2]
    â”œâ”€â†’ å•†å“æœåŠ¡ [Trace ID: abc123, Span ID: span3]  
    â””â”€â†’ åº“å­˜æœåŠ¡ [Trace ID: abc123, Span ID: span4]
```

#### ğŸ”§ Spring Cloud Sleuthé›†æˆ


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-sleuth</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-sleuth-zipkin</artifactId>
</dependency>
```

**é“¾è·¯è¿½è¸ªé…ç½®**
```yaml
spring:
  sleuth:
    sampler:
      probability: 1.0      # é‡‡æ ·ç‡100%ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®0.1ï¼‰
    zipkin:
      base-url: http://localhost:9411  # ZipkinæœåŠ¡å™¨åœ°å€
    web:
      skip-pattern: /actuator/**       # è·³è¿‡å¥åº·æ£€æŸ¥æ¥å£
```

**è‡ªå®šä¹‰Span**
```java
@Service
public class OrderService {
    
    @Autowired
    private Tracer tracer;
    
    public Order processOrder(CreateOrderRequest request) {
        
        // åˆ›å»ºè‡ªå®šä¹‰Span
        Span customSpan = tracer.nextSpan()
            .name("order-validation")
            .tag("order.user.id", request.getUserId().toString())
            .start();
            
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(customSpan)) {
            // ä¸šåŠ¡é€»è¾‘
            validateOrderRequest(request);
            return createOrder(request);
        } finally {
            customSpan.end();
        }
    }
}
```

### 8.2 æ¶ˆæ¯é©±åŠ¨æ¶æ„


**æ¶ˆæ¯é©±åŠ¨çš„ä¼˜åŠ¿**ï¼šè§£è€¦æœåŠ¡ä¹‹é—´çš„ç›´æ¥ä¾èµ–ï¼Œæé«˜ç³»ç»Ÿçš„å¼¹æ€§å’Œå¯æ‰©å±•æ€§

```
è®¢å•åˆ›å»ºçš„æ¶ˆæ¯æµï¼š
è®¢å•æœåŠ¡ â”€â”€å‘å¸ƒâ”€â”€> [è®¢å•åˆ›å»ºäº‹ä»¶] â”€â”€è®¢é˜…â”€â”€> åº“å­˜æœåŠ¡ï¼ˆæ‰£å‡åº“å­˜ï¼‰
                                   â”œâ”€â”€è®¢é˜…â”€â”€> ç§¯åˆ†æœåŠ¡ï¼ˆå¢åŠ ç§¯åˆ†ï¼‰  
                                   â”œâ”€â”€è®¢é˜…â”€â”€> é€šçŸ¥æœåŠ¡ï¼ˆå‘é€é€šçŸ¥ï¼‰
                                   â””â”€â”€è®¢é˜…â”€â”€> æŠ¥è¡¨æœåŠ¡ï¼ˆæ›´æ–°ç»Ÿè®¡ï¼‰
```

#### ğŸ”§ Spring Cloud Streamå®æˆ˜


**ä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-stream-rabbit</artifactId>
</dependency>
```

**æ¶ˆæ¯å‘å¸ƒè€…**
```java
@Service
public class OrderService {
    
    @Autowired
    private StreamBridge streamBridge;
    
    public Order createOrder(CreateOrderRequest request) {
        Order order = buildOrder(request);
        orderRepository.save(order);
        
        // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent(
            order.getId(), 
            order.getUserId(),
            order.getTotalAmount()
        );
        
        streamBridge.send("order-created-out-0", event);
        return order;
    }
}
```

**æ¶ˆæ¯æ¶ˆè´¹è€…**
```java
@Component
public class InventoryEventHandler {
    
    @Autowired
    private InventoryService inventoryService;
    
    @Bean
    public Consumer<OrderCreatedEvent> handleOrderCreated() {
        return event -> {
            log.info("æ”¶åˆ°è®¢å•åˆ›å»ºäº‹ä»¶ï¼š{}", event.getOrderId());
            inventoryService.deductInventory(event.getOrderId());
        };
    }
}
```

**Streamé…ç½®**
```yaml
spring:
  cloud:
    stream:
      bindings:
        order-created-out-0:              # è¾“å‡ºç»‘å®š
          destination: order.created      # æ¶ˆæ¯ä¸»é¢˜
          content-type: application/json
        handleOrderCreated-in-0:          # è¾“å…¥ç»‘å®š  
          destination: order.created
          group: inventory-service        # æ¶ˆè´¹è€…ç»„
          content-type: application/json
      rabbit:
        bindings:
          handleOrderCreated-in-0:
            consumer:
              auto-bind-dlq: true         # è‡ªåŠ¨åˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—
```

### 8.3 åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†


**åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜**ï¼šä¸€ä¸ªä¸šåŠ¡æ“ä½œæ¶‰åŠå¤šä¸ªæœåŠ¡çš„æ•°æ®ä¿®æ”¹ï¼Œå¦‚ä½•ä¿è¯ä¸€è‡´æ€§ï¼Ÿ

#### ğŸ”§ Seataåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ


**Seataæ¶æ„å›¾**
```
                     Seata Server (TC)
                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     â”‚                     â”‚
è®¢å•æœåŠ¡(TM)          åº“å­˜æœåŠ¡(RM)          ç§¯åˆ†æœåŠ¡(RM)
    â”‚                     â”‚                     â”‚
è®¢å•æ•°æ®åº“            åº“å­˜æ•°æ®åº“            ç§¯åˆ†æ•°æ®åº“

TC: äº‹åŠ¡åè°ƒè€…   TM: äº‹åŠ¡ç®¡ç†å™¨   RM: èµ„æºç®¡ç†å™¨
```

**Seataä¾èµ–é…ç½®**
```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-seata</artifactId>
</dependency>
```

**å…¨å±€äº‹åŠ¡ä½¿ç”¨**
```java
@Service
public class OrderService {
    
    @Autowired
    private InventoryFeignClient inventoryClient;
    @Autowired
    private PointsFeignClient pointsClient;
    
    @GlobalTransactional  // å¼€å¯å…¨å±€äº‹åŠ¡
    public void createOrder(CreateOrderRequest request) {
        
        // 1. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        orderRepository.save(order);
        
        // 2. æ‰£å‡åº“å­˜ï¼ˆè¿œç¨‹è°ƒç”¨ï¼‰
        inventoryClient.deductInventory(
            request.getProductId(), 
            request.getQuantity()
        );
        
        // 3. å¢åŠ ç§¯åˆ†ï¼ˆè¿œç¨‹è°ƒç”¨ï¼‰  
        pointsClient.addPoints(
            request.getUserId(),
            calculatePoints(order.getTotalAmount())
        );
        
        // ä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½ä¼šè§¦å‘å…¨å±€å›æ»š
    }
}
```

### 8.4 å®‰å…¨è®¤è¯æˆæƒ


#### ğŸ” OAuth2 + JWTè®¤è¯æ¶æ„


**è®¤è¯æœåŠ¡æ¶æ„**
```
å®¢æˆ·ç«¯åº”ç”¨
    â”‚
    â”œâ”€â”€â”€ è¯·æ±‚æˆæƒç  â”€â”€â”€â”€â†’ è®¤è¯æœåŠ¡å™¨ â†â”€â”€â”€â”€ ç”¨æˆ·ç™»å½•éªŒè¯
    â”‚                      â”‚
    â”œâ”€â”€â”€ æˆæƒç æ¢Token â”€â”€â”€â”€â”€â”˜
    â”‚                      
    â””â”€â”€â”€ æºå¸¦Tokenè¯·æ±‚ â”€â”€â”€â”€â†’ èµ„æºæœåŠ¡å™¨ â”€â”€â”€â†’ éªŒè¯Tokenå¹¶è¿”å›èµ„æº
                              â”‚
                              â””â”€â”€â”€â”€â”€â†’ ä¸šåŠ¡æœåŠ¡
```

**è®¤è¯æœåŠ¡å™¨é…ç½®**
```java
@Configuration
@EnableAuthorizationServer
public class AuthServerConfig extends AuthorizationServerConfigurerAdapter {
    
    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        clients.inMemory()
            .withClient("order-service")
            .secret(passwordEncoder().encode("order-secret"))
            .authorizedGrantTypes("authorization_code", "refresh_token")
            .scopes("read", "write")
            .redirectUris("http://localhost:8083/callback");
    }
    
    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) {
        endpoints
            .tokenStore(jwtTokenStore())
            .accessTokenConverter(jwtAccessTokenConverter())
            .userDetailsService(userDetailsService);
    }
}
```

### 8.5 æ€§èƒ½ä¼˜åŒ–è°ƒä¼˜


#### ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**å…³é”®æ€§èƒ½æŒ‡æ ‡**
```
åº”ç”¨å±‚æŒ‡æ ‡ï¼š
- å“åº”æ—¶é—´ï¼šP95, P99å“åº”æ—¶é—´
- QPS/TPSï¼šæ¯ç§’è¯·æ±‚/äº‹åŠ¡æ•°
- é”™è¯¯ç‡ï¼š4xx, 5xxé”™è¯¯æ¯”ä¾‹

ç³»ç»Ÿå±‚æŒ‡æ ‡ï¼š  
- CPUä½¿ç”¨ç‡ï¼š<70%ä¸ºå¥åº·çŠ¶æ€
- å†…å­˜ä½¿ç”¨ç‡ï¼š<80%ä¸ºå¥åº·çŠ¶æ€
- ç½‘ç»œIOï¼šå¸¦å®½ä½¿ç”¨æƒ…å†µ

ä¸šåŠ¡å±‚æŒ‡æ ‡ï¼š
- ä¸šåŠ¡æˆåŠŸç‡ï¼šè®¢å•æˆåŠŸç‡ã€æ”¯ä»˜æˆåŠŸç‡
- ç”¨æˆ·ä½“éªŒï¼šé¡µé¢åŠ è½½æ—¶é—´ã€æ¥å£å“åº”æ—¶é—´
```

**æ€§èƒ½è°ƒä¼˜é…ç½®**
```yaml
# JVMä¼˜åŒ–å‚æ•°
JAVA_OPTS: >
  -server
  -Xms2g -Xmx2g
  -XX:+UseG1GC
  -XX:MaxGCPauseMillis=100
  -XX:+UseStringDeduplication

# è¿æ¥æ± ä¼˜åŒ–
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 20000
      idle-timeout: 300000
      
# HTTPå®¢æˆ·ç«¯ä¼˜åŒ–
feign:
  httpclient:
    enabled: true
    max-connections: 200
    max-connections-per-route: 50
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 Spring Cloudæ ¸å¿ƒç»„ä»¶å…³ç³»å›¾


```
å¾®æœåŠ¡ç”Ÿæ€å…¨æ™¯å›¾ï¼š

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ç”¨æˆ·è¯·æ±‚   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Gatewayç½‘å…³  â”‚ â† ç»Ÿä¸€å…¥å£ã€è·¯ç”±ã€è®¤è¯
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç”¨æˆ·æœåŠ¡     â”‚  â”‚  å•†å“æœåŠ¡     â”‚  â”‚  è®¢å•æœåŠ¡     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚                 â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Eurekaæ³¨å†Œä¸­å¿ƒâ”‚ â† æœåŠ¡å‘ç°
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
                    â”‚ Configé…ç½®ä¸­å¿ƒâ”‚ â† ç»Ÿä¸€é…ç½®ç®¡ç†
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 æŠ€æœ¯é€‰å‹å»ºè®®


| **åœºæ™¯** | **æ¨èç»„ä»¶** | **ç†ç”±** |
|---------|-------------|---------|
| **æœåŠ¡æ³¨å†Œå‘ç°** | Eureka / Nacos | Eurekaæˆç†Ÿç¨³å®šï¼ŒNacosåŠŸèƒ½æ›´ä¸°å¯Œ |
| **è´Ÿè½½å‡è¡¡** | LoadBalancer | å®˜æ–¹æ¨èï¼Œæ›¿ä»£Ribbon |
| **æœåŠ¡è°ƒç”¨** | OpenFeign | å£°æ˜å¼è°ƒç”¨ï¼Œä½¿ç”¨ç®€å• |
| **APIç½‘å…³** | Gateway | å“åº”å¼æ¶æ„ï¼Œæ€§èƒ½æ›´å¥½ |
| **é…ç½®ç®¡ç†** | Config / Nacos | Configé€‚åˆGitç®¡ç†ï¼ŒNacosæ›´ä¾¿æ· |
| **æ–­è·¯å™¨** | Resilience4j | è½»é‡ç°ä»£ï¼Œæ›¿ä»£Hystrix |
| **åˆ†å¸ƒå¼äº‹åŠ¡** | Seata | é˜¿é‡Œå¼€æºï¼Œæ”¯æŒå¤šç§äº‹åŠ¡æ¨¡å¼ |

### 9.3 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ¯ æ–°æ‰‹å­¦ä¹ é¡ºåº**
1. **åŸºç¡€æ­å»º**ï¼šEureka + ç®€å•æœåŠ¡è°ƒç”¨
2. **æœåŠ¡é€šä¿¡**ï¼šOpenFeign + LoadBalancer
3. **ç½‘å…³å…¥é—¨**ï¼šGatewayåŸºç¡€è·¯ç”±
4. **é…ç½®ç®¡ç†**ï¼šConfig ServeråŸºæœ¬ä½¿ç”¨
5. **å®¹é”™å¤„ç†**ï¼šResilience4jæ–­è·¯å™¨
6. **è¿›é˜¶å®è·µ**ï¼šç›‘æ§ã€æ¶ˆæ¯ã€å®‰å…¨ç­‰

**ğŸ’¡ å®è·µå»ºè®®**
- **å¾ªåºæ¸è¿›**ï¼šå…ˆæŒæ¡æ ¸å¿ƒç»„ä»¶å†å­¦é«˜çº§ç‰¹æ€§
- **åŠ¨æ‰‹å®è·µ**ï¼šæ¯ä¸ªç»„ä»¶éƒ½è¦å†™ä»£ç éªŒè¯
- **ç†è§£åŸç†**ï¼šçŸ¥å…¶ç„¶ä¹Ÿè¦çŸ¥å…¶æ‰€ä»¥ç„¶
- **å…³æ³¨ç‰ˆæœ¬**ï¼šé€‰æ‹©ç¨³å®šç‰ˆæœ¬ï¼Œæ³¨æ„å…¼å®¹æ€§

### 9.4 ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹


**ğŸ”’ å®‰å…¨æ–¹é¢**
- å¯ç”¨HTTPSï¼Œä¿æŠ¤æ•°æ®ä¼ è¾“å®‰å…¨
- å®æ–½OAuth2è®¤è¯ï¼Œä¿æŠ¤APIæ¥å£
- é…ç½®é˜²ç«å¢™ï¼Œé™åˆ¶ç½‘ç»œè®¿é—®æƒé™
- æ•æ„Ÿé…ç½®åŠ å¯†ï¼Œé¿å…æ˜æ–‡å­˜å‚¨

**âš¡ æ€§èƒ½æ–¹é¢**  
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´å’Œé‡è¯•ç­–ç•¥
- é…ç½®è¿æ¥æ± ï¼Œå¤ç”¨ç½‘ç»œè¿æ¥
- å¯ç”¨ç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—
- ç›‘æ§å…³é”®æŒ‡æ ‡ï¼ŒåŠæ—¶å‘ç°ç“¶é¢ˆ

**ğŸ› ï¸ è¿ç»´æ–¹é¢**
- ç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- å®Œå–„ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸
- åˆ¶å®šå‘å¸ƒç­–ç•¥ï¼Œé™ä½å‘å¸ƒé£é™©
- å»ºç«‹åº”æ€¥é¢„æ¡ˆï¼Œå¿«é€Ÿå“åº”æ•…éšœ

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- **Spring Cloud = å¾®æœåŠ¡å·¥å…·ç®±**ï¼Œæä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ
- **æœåŠ¡æ³¨å†Œå‘ç°æ˜¯åŸºç¡€**ï¼Œæ‰€æœ‰æœåŠ¡é€šä¿¡çš„å‰æ
- **ç½‘å…³æ˜¯ç»Ÿä¸€å…¥å£**ï¼Œæ‰¿æ‹…è·¯ç”±ã€è®¤è¯ã€é™æµç­‰èŒè´£  
- **é…ç½®ä¸­å¿ƒå®ç°é›†ä¸­ç®¡ç†**ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°
- **å®¹é”™æœºåˆ¶ä¿éšœå¯ç”¨æ€§**ï¼Œé˜²æ­¢æœåŠ¡é›ªå´©
- **ç›‘æ§è¿ç»´ä¸å¯ç¼º**ï¼Œä¿éšœç³»ç»Ÿç¨³å®šè¿è¡Œ