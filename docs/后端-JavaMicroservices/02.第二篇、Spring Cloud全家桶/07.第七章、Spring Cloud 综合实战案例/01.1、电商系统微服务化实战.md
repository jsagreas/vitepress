---
title: 1ã€ç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åŒ–å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [ä¸šåŠ¡åˆ†æä¸æœåŠ¡æ‹†åˆ†](#1-ä¸šåŠ¡åˆ†æä¸æœåŠ¡æ‹†åˆ†)
2. [ç”¨æˆ·æœåŠ¡è®¾è®¡å®ç°](#2-ç”¨æˆ·æœåŠ¡è®¾è®¡å®ç°)
3. [å•†å“æœåŠ¡è®¾è®¡å®ç°](#3-å•†å“æœåŠ¡è®¾è®¡å®ç°)
4. [è®¢å•æœåŠ¡è®¾è®¡å®ç°](#4-è®¢å•æœåŠ¡è®¾è®¡å®ç°)
5. [æ”¯ä»˜æœåŠ¡è®¾è®¡å®ç°](#5-æ”¯ä»˜æœåŠ¡è®¾è®¡å®ç°)
6. [åº“å­˜æœåŠ¡è®¾è®¡å®ç°](#6-åº“å­˜æœåŠ¡è®¾è®¡å®ç°)
7. [è´­ç‰©è½¦æœåŠ¡è®¾è®¡](#7-è´­ç‰©è½¦æœåŠ¡è®¾è®¡)
8. [æœåŠ¡é—´è°ƒç”¨é“¾è·¯](#8-æœåŠ¡é—´è°ƒç”¨é“¾è·¯)
9. [æ•°æ®ä¸€è‡´æ€§ä¿è¯](#9-æ•°æ®ä¸€è‡´æ€§ä¿è¯)
10. [ç³»ç»Ÿå‹åŠ›æµ‹è¯•](#10-ç³»ç»Ÿå‹åŠ›æµ‹è¯•)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ä¸šåŠ¡åˆ†æä¸æœåŠ¡æ‹†åˆ†


### 1.1 ä»€ä¹ˆæ˜¯æœåŠ¡æ‹†åˆ†


**é€šä¿—è§£é‡Š**ï¼šå°±åƒæŠŠä¸€ä¸ªå¤§å‹è¶…å¸‚æ‹†åˆ†æˆå¤šä¸ªä¸“é—¨çš„å°åº—
- ä»¥å‰ï¼šä¸€ä¸ªå¤§åº”ç”¨åŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼Œå°±åƒå¤§å‹è¶…å¸‚ä»€ä¹ˆéƒ½å–
- ç°åœ¨ï¼šæŒ‰ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†ï¼Œå°±åƒæœè£…åº—ã€é£Ÿå“åº—ã€ç”µå­äº§å“åº—å„å¸å…¶èŒ

```
ä¼ ç»Ÿå•ä½“æ¶æ„ï¼š          å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚      â”‚ç”¨æˆ·æœåŠ¡â”‚  â”‚å•†å“æœåŠ¡â”‚  â”‚è®¢å•æœåŠ¡â”‚
â”‚  ç”µå•†å¤§ç³»ç»Ÿ      â”‚  â†’   â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (æ‰€æœ‰åŠŸèƒ½)      â”‚      â”‚æ”¯ä»˜æœåŠ¡â”‚  â”‚åº“å­˜æœåŠ¡â”‚  â”‚è´­ç‰©è½¦ â”‚
â”‚                 â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç”µå•†ç³»ç»Ÿæ ¸å¿ƒä¸šåŠ¡åˆ†æ


**æ ¸å¿ƒä¸šåŠ¡æµç¨‹**ï¼š
```
ç”¨æˆ·æ³¨å†Œç™»å½• â†’ æµè§ˆå•†å“ â†’ åŠ å…¥è´­ç‰©è½¦ â†’ ä¸‹å• â†’ æ”¯ä»˜ â†’ åº“å­˜æ‰£å‡ â†’ å‘è´§
    â†“           â†“          â†“        â†“      â†“        â†“        â†“
  ç”¨æˆ·æœåŠ¡   å•†å“æœåŠ¡   è´­ç‰©è½¦æœåŠ¡  è®¢å•æœåŠ¡ æ”¯ä»˜æœåŠ¡  åº“å­˜æœåŠ¡  ç‰©æµæœåŠ¡
```

### 1.3 æœåŠ¡æ‹†åˆ†åŸåˆ™


**ğŸ”¸ æŒ‰ä¸šåŠ¡è¾¹ç•Œæ‹†åˆ†**
- **ç”¨æˆ·åŸŸ**ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ç®¡ç†
- **å•†å“åŸŸ**ï¼šå•†å“ä¿¡æ¯ã€åˆ†ç±»ã€æœç´¢ã€æ¨è
- **äº¤æ˜“åŸŸ**ï¼šè´­ç‰©è½¦ã€è®¢å•ã€æ”¯ä»˜
- **åº“å­˜åŸŸ**ï¼šåº“å­˜ç®¡ç†ã€é¢„å ã€é‡Šæ”¾
- **è¥é”€åŸŸ**ï¼šä¼˜æƒ åˆ¸ã€æ´»åŠ¨ã€æ¨å¹¿

**ğŸ”¸ æ‹†åˆ†åçš„å¥½å¤„**
```
å•ä¸€èŒè´£ï¼šæ¯ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹ï¼Œåšå¥½ä¸€ä»¶äº‹
ç‹¬ç«‹éƒ¨ç½²ï¼šæŸä¸ªåŠŸèƒ½æœ‰é—®é¢˜ä¸å½±å“å…¶ä»–åŠŸèƒ½
æŠ€æœ¯é€‰å‹ï¼šä¸åŒæœåŠ¡å¯ä»¥ç”¨ä¸åŒæŠ€æœ¯
å›¢é˜Ÿåä½œï¼šä¸åŒå›¢é˜Ÿå¯ä»¥å¹¶è¡Œå¼€å‘
æ‰©å±•çµæ´»ï¼šçƒ­é—¨åŠŸèƒ½å¯ä»¥å•ç‹¬æ‰©å®¹
```

### 1.4 æœåŠ¡åˆ’åˆ†ç»“æœ


| æœåŠ¡åç§° | æ ¸å¿ƒèŒè´£ | ä¸»è¦åŠŸèƒ½ | æ•°æ®å­˜å‚¨ |
|----------|----------|----------|----------|
| ğŸ§‘â€ğŸ’¼ **ç”¨æˆ·æœåŠ¡** | `ç”¨æˆ·ç®¡ç†` | æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç»´æŠ¤ | `MySQL` |
| ğŸ“¦ **å•†å“æœåŠ¡** | `å•†å“ç®¡ç†` | å•†å“ä¿¡æ¯ã€åˆ†ç±»ã€æœç´¢ | `MySQL + Redis` |
| ğŸ›’ **è´­ç‰©è½¦æœåŠ¡** | `è´­ç‰©ç®¡ç†` | æ·»åŠ å•†å“ã€æ•°é‡ç®¡ç† | `Redis` |
| ğŸ“ **è®¢å•æœåŠ¡** | `è®¢å•ç®¡ç†` | åˆ›å»ºè®¢å•ã€çŠ¶æ€è·Ÿè¸ª | `MySQL` |
| ğŸ’° **æ”¯ä»˜æœåŠ¡** | `æ”¯ä»˜å¤„ç†` | æ”¯ä»˜ã€é€€æ¬¾ã€å¯¹è´¦ | `MySQL` |
| ğŸ“Š **åº“å­˜æœåŠ¡** | `åº“å­˜ç®¡ç†` | åº“å­˜æŸ¥è¯¢ã€æ‰£å‡ã€è¡¥å…… | `MySQL + Redis` |

---

## 2. ğŸ§‘â€ğŸ’¼ ç”¨æˆ·æœåŠ¡è®¾è®¡å®ç°


### 2.1 ç”¨æˆ·æœåŠ¡çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒå•†åœºçš„ä¼šå‘˜å¡ç³»ç»Ÿ
- è´Ÿè´£ç”¨æˆ·çš„èº«ä»½è®¤è¯ï¼šä½ æ˜¯è°ï¼Ÿ
- ç®¡ç†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼šä½ çš„åŸºæœ¬èµ„æ–™
- æä¾›æƒé™éªŒè¯ï¼šä½ èƒ½åšä»€ä¹ˆï¼Ÿ

### 2.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—


**ğŸ”¸ ç”¨æˆ·æ³¨å†Œæµç¨‹**
```
ç”¨æˆ·å¡«å†™ä¿¡æ¯ â†’ éªŒè¯æ‰‹æœºå·/é‚®ç®± â†’ å¯†ç åŠ å¯† â†’ å­˜å‚¨æ•°æ® â†’ è¿”å›ç»“æœ
```

**ğŸ”¸ ç”¨æˆ·ç™»å½•éªŒè¯**
```java
@RestController
public class UserController {
    
    // ç”¨æˆ·ç™»å½• - ç®€åŒ–ç‰ˆæœ¬
    @PostMapping("/login")
    public Result login(@RequestBody LoginRequest request) {
        // 1. éªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.validateUser(request.getUsername(), request.getPassword());
        if (user == null) {
            return Result.error("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
        
        // 2. ç”ŸæˆJWTä»¤ç‰Œ
        String token = jwtUtils.generateToken(user.getId());
        
        // 3. è¿”å›ç™»å½•ç»“æœ
        return Result.success("ç™»å½•æˆåŠŸ", token);
    }
}
```

### 2.3 æ•°æ®åº“è®¾è®¡


**ç”¨æˆ·è¡¨ç»“æ„**ï¼š
```sql
-- ç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨
CREATE TABLE t_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    password VARCHAR(100) NOT NULL COMMENT 'å¯†ç (åŠ å¯†)',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    nickname VARCHAR(50) COMMENT 'æ˜µç§°',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1æ­£å¸¸,0ç¦ç”¨',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2.4 JWTä»¤ç‰Œæœºåˆ¶


**ä»€ä¹ˆæ˜¯JWTï¼Ÿ**
- **é€šä¿—è§£é‡Š**ï¼šå°±åƒé“¶è¡Œç»™ä½ çš„å­˜æŠ˜ï¼Œä¸Šé¢è®°å½•äº†ä½ çš„èº«ä»½ä¿¡æ¯
- **æŠ€æœ¯è§£é‡Š**ï¼šJSON Web Tokenï¼Œä¸€ç§æ— çŠ¶æ€çš„èº«ä»½è®¤è¯æ–¹å¼

```
JWTä»¤ç‰Œç»“æ„ï¼š
Header.Payload.Signature
å¤´éƒ¨ä¿¡æ¯.è½½è·æ•°æ®.ç­¾åéªŒè¯

ç¤ºä¾‹ï¼š
eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEyMzR9.signature_part
```

**ğŸ”¸ JWTä½¿ç”¨æµç¨‹**
```
ç™»å½•æˆåŠŸ â†’ æœåŠ¡å™¨ç”ŸæˆJWT â†’ è¿”å›ç»™å®¢æˆ·ç«¯ â†’ å®¢æˆ·ç«¯ä¿å­˜
åç»­è¯·æ±‚ â†’ æºå¸¦JWT â†’ æœåŠ¡å™¨éªŒè¯ â†’ å…è®¸è®¿é—®
```

### 2.5 å®‰å…¨æ€§è€ƒè™‘


**ğŸ›¡ï¸ å¯†ç åŠ å¯†å­˜å‚¨**
```java
@Service
public class UserService {
    
    // æ³¨å†Œæ—¶åŠ å¯†å¯†ç 
    public void registerUser(String username, String password) {
        // ä½¿ç”¨BCryptåŠ å¯†å¯†ç 
        String encodedPassword = BCrypt.hashpw(password, BCrypt.gensalt());
        
        User user = new User();
        user.setUsername(username);
        user.setPassword(encodedPassword);
        userMapper.insert(user);
    }
    
    // ç™»å½•æ—¶éªŒè¯å¯†ç 
    public boolean validatePassword(String rawPassword, String encodedPassword) {
        return BCrypt.checkpw(rawPassword, encodedPassword);
    }
}
```

---

## 3. ğŸ“¦ å•†å“æœåŠ¡è®¾è®¡å®ç°


### 3.1 å•†å“æœåŠ¡çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒå•†åœºçš„å•†å“å±•ç¤ºç³»ç»Ÿ
- å±•ç¤ºæ‰€æœ‰å•†å“ä¿¡æ¯ï¼šå•†å“è¯¦æƒ…ã€å›¾ç‰‡ã€ä»·æ ¼
- æä¾›æœç´¢åŠŸèƒ½ï¼šå¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å•†å“
- ç®¡ç†å•†å“åˆ†ç±»ï¼šä¸åŒç±»åˆ«çš„å•†å“åˆ†é—¨åˆ«ç±»

### 3.2 æ ¸å¿ƒæ•°æ®æ¨¡å‹


**ğŸ”¸ å•†å“ä¿¡æ¯è®¾è®¡**
```
å•†å“åŸºæœ¬ä¿¡æ¯ï¼š
- å•†å“IDã€åç§°ã€æè¿°
- ä»·æ ¼ã€å›¾ç‰‡ã€åˆ†ç±»
- å“ç‰Œã€è§„æ ¼å‚æ•°

å•†å“åˆ†ç±»ä½“ç³»ï¼š
- ä¸‰çº§åˆ†ç±»ï¼šæ‰‹æœº > æ™ºèƒ½æ‰‹æœº > iPhone
- æ–¹ä¾¿ç”¨æˆ·æŸ¥æ‰¾å’Œç®¡ç†
```

**å•†å“è¡¨ç»“æ„**ï¼š
```sql
-- å•†å“ä¿¡æ¯è¡¨
CREATE TABLE t_product (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL COMMENT 'å•†å“åç§°',
    category_id BIGINT NOT NULL COMMENT 'åˆ†ç±»ID',
    price DECIMAL(10,2) NOT NULL COMMENT 'ä»·æ ¼',
    description TEXT COMMENT 'å•†å“æè¿°',
    image_url VARCHAR(500) COMMENT 'ä¸»å›¾ç‰‡URL',
    stock INT DEFAULT 0 COMMENT 'åº“å­˜æ•°é‡',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€:1ä¸Šæ¶,0ä¸‹æ¶'
);

-- å•†å“åˆ†ç±»è¡¨  
CREATE TABLE t_category (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL COMMENT 'åˆ†ç±»åç§°',
    parent_id BIGINT DEFAULT 0 COMMENT 'çˆ¶åˆ†ç±»ID',
    level TINYINT COMMENT 'åˆ†ç±»çº§åˆ«:1,2,3'
);
```

### 3.3 å•†å“æŸ¥è¯¢ä¸æœç´¢


**ğŸ”¸ åŸºç¡€æŸ¥è¯¢æ¥å£**
```java
@RestController
public class ProductController {
    
    // æ ¹æ®åˆ†ç±»æŸ¥è¯¢å•†å“
    @GetMapping("/products/category/{categoryId}")
    public Result getProductsByCategory(@PathVariable Long categoryId) {
        List<Product> products = productService.findByCategory(categoryId);
        return Result.success(products);
    }
    
    // å•†å“æœç´¢ - æ”¯æŒåç§°æ¨¡ç³Šæœç´¢
    @GetMapping("/products/search")
    public Result searchProducts(@RequestParam String keyword) {
        List<Product> products = productService.searchByKeyword(keyword);
        return Result.success(products);
    }
}
```

### 3.4 ç¼“å­˜ä¼˜åŒ–ç­–ç•¥


**ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ**
- å•†å“ä¿¡æ¯è¯»å¤šå†™å°‘ï¼Œè®¿é—®é¢‘ç¹
- æ•°æ®åº“æŸ¥è¯¢å‹åŠ›å¤§ï¼Œå“åº”é€Ÿåº¦æ…¢
- ç”¨Redisç¼“å­˜æé«˜æŸ¥è¯¢é€Ÿåº¦

**ğŸ”¸ ç¼“å­˜å®ç°æ–¹æ¡ˆ**
```java
@Service
public class ProductService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // è·å–å•†å“è¯¦æƒ… - å¸¦ç¼“å­˜
    public Product getProductDetail(Long productId) {
        String cacheKey = "product:" + productId;
        
        // 1. å…ˆæŸ¥ç¼“å­˜
        Product product = (Product) redisTemplate.opsForValue().get(cacheKey);
        if (product != null) {
            return product; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        product = productMapper.selectById(productId);
        if (product != null) {
            // 3. å­˜å…¥ç¼“å­˜ï¼Œè®¾ç½®30åˆ†é’Ÿè¿‡æœŸ
            redisTemplate.opsForValue().set(cacheKey, product, 30, TimeUnit.MINUTES);
        }
        
        return product;
    }
}
```

### 3.5 å•†å“åˆ†ç±»æ ‘å½¢ç»“æ„


**åˆ†ç±»å±‚çº§å…³ç³»**ï¼š
```
ç”µå­äº§å“
â”œâ”€â”€ æ‰‹æœºé€šè®¯
â”‚   â”œâ”€â”€ æ™ºèƒ½æ‰‹æœº
â”‚   â”œâ”€â”€ è€äººæœº
â”‚   â””â”€â”€ æ‰‹æœºé…ä»¶
â”œâ”€â”€ ç”µè„‘åŠå…¬
â”‚   â”œâ”€â”€ ç¬”è®°æœ¬
â”‚   â”œâ”€â”€ å°å¼æœº
â”‚   â””â”€â”€ ç”µè„‘é…ä»¶
â””â”€â”€ å®¶ç”¨ç”µå™¨
    â”œâ”€â”€ å¤§å®¶ç”µ
    â””â”€â”€ å°å®¶ç”µ
```

**æ„å»ºåˆ†ç±»æ ‘çš„æ–¹æ³•**ï¼š
```java
@Service
public class CategoryService {
    
    // æ„å»ºåˆ†ç±»æ ‘
    public List<CategoryTree> buildCategoryTree() {
        // 1. æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»
        List<Category> allCategories = categoryMapper.selectAll();
        
        // 2. è½¬æ¢ä¸ºæ ‘å½¢ç»“æ„
        return allCategories.stream()
            .filter(category -> category.getParentId() == 0) // æ‰¾æ ¹èŠ‚ç‚¹
            .map(this::buildTree) // é€’å½’æ„å»ºå­æ ‘
            .collect(Collectors.toList());
    }
    
    private CategoryTree buildTree(Category parent) {
        CategoryTree tree = new CategoryTree();
        tree.setId(parent.getId());
        tree.setName(parent.getName());
        
        // é€’å½’æŸ¥æ‰¾å­åˆ†ç±»
        List<Category> children = findChildren(parent.getId());
        tree.setChildren(children.stream().map(this::buildTree).collect(Collectors.toList()));
        
        return tree;
    }
}
```

---

## 4. ğŸ“ è®¢å•æœåŠ¡è®¾è®¡å®ç°


### 4.1 è®¢å•æœåŠ¡çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒé¤å…çš„ç‚¹èœå•ç³»ç»Ÿ
- è®°å½•ç”¨æˆ·ä¹°äº†ä»€ä¹ˆï¼šå•†å“æ¸…å•ã€æ•°é‡ã€ä»·æ ¼
- è·Ÿè¸ªè®¢å•çŠ¶æ€ï¼šå·²ä¸‹å•ã€å·²æ”¯ä»˜ã€å·²å‘è´§ã€å·²å®Œæˆ
- å¤„ç†è®¢å•æµç¨‹ï¼šåˆ›å»ºâ†’æ”¯ä»˜â†’å‘è´§â†’ç¡®è®¤æ”¶è´§

### 4.2 è®¢å•çŠ¶æ€æµè½¬


**è®¢å•ç”Ÿå‘½å‘¨æœŸ**ï¼š
```
å¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ â†’ å·²å‘è´§ â†’ å·²å®Œæˆ
  â†“        â†“        â†“
å·²å–æ¶ˆ   é€€æ¬¾ä¸­   å·²é€€æ¬¾
```

**è®¢å•çŠ¶æ€è¯¦è§£**ï¼š
- **å¾…æ”¯ä»˜**ï¼šè®¢å•åˆšåˆ›å»ºï¼Œç­‰å¾…ç”¨æˆ·ä»˜æ¬¾
- **å·²æ”¯ä»˜**ï¼šç”¨æˆ·å·²ä»˜æ¬¾ï¼Œç­‰å¾…å•†å®¶å‘è´§
- **å·²å‘è´§**ï¼šå•†å“å·²å‘å‡ºï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
- **å·²å®Œæˆ**ï¼šç”¨æˆ·ç¡®è®¤æ”¶è´§ï¼Œäº¤æ˜“ç»“æŸ
- **å·²å–æ¶ˆ**ï¼šè®¢å•è¢«å–æ¶ˆï¼Œåº“å­˜é‡Šæ”¾

### 4.3 è®¢å•æ•°æ®æ¨¡å‹


**ğŸ”¸ è®¢å•è¡¨è®¾è®¡**
```sql
-- è®¢å•ä¸»è¡¨
CREATE TABLE t_order (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_no VARCHAR(32) UNIQUE NOT NULL COMMENT 'è®¢å•ç¼–å·',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    total_amount DECIMAL(10,2) NOT NULL COMMENT 'è®¢å•æ€»é‡‘é¢',
    status TINYINT DEFAULT 1 COMMENT 'è®¢å•çŠ¶æ€',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- è®¢å•æ˜ç»†è¡¨
CREATE TABLE t_order_item (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_id BIGINT NOT NULL COMMENT 'è®¢å•ID',
    product_id BIGINT NOT NULL COMMENT 'å•†å“ID',
    product_name VARCHAR(200) COMMENT 'å•†å“åç§°',
    price DECIMAL(10,2) NOT NULL COMMENT 'å•†å“å•ä»·',
    quantity INT NOT NULL COMMENT 'è´­ä¹°æ•°é‡',
    subtotal DECIMAL(10,2) NOT NULL COMMENT 'å°è®¡é‡‘é¢'
);
```

### 4.4 åˆ›å»ºè®¢å•æµç¨‹


**ğŸ”¸ è®¢å•åˆ›å»ºæ­¥éª¤**
```
1. éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
2. æ ¡éªŒå•†å“ä¿¡æ¯å’Œä»·æ ¼
3. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³  
4. è®¡ç®—è®¢å•æ€»é‡‘é¢
5. ç”Ÿæˆå”¯ä¸€è®¢å•å·
6. é¢„å å•†å“åº“å­˜
7. åˆ›å»ºè®¢å•è®°å½•
8. æ¸…ç©ºè´­ç‰©è½¦
```

**è®¢å•åˆ›å»ºæ ¸å¿ƒä»£ç **ï¼š
```java
@Service
@Transactional
public class OrderService {
    
    // åˆ›å»ºè®¢å•
    public String createOrder(Long userId, List<OrderItemRequest> items) {
        // 1. ç”Ÿæˆè®¢å•å·
        String orderNo = generateOrderNo();
        
        // 2. è®¡ç®—æ€»é‡‘é¢
        BigDecimal totalAmount = BigDecimal.ZERO;
        List<OrderItem> orderItems = new ArrayList<>();
        
        for (OrderItemRequest item : items) {
            // éªŒè¯å•†å“ä¿¡æ¯
            Product product = productService.getProduct(item.getProductId());
            if (product == null) {
                throw new BusinessException("å•†å“ä¸å­˜åœ¨");
            }
            
            // æ£€æŸ¥åº“å­˜
            if (!stockService.checkStock(item.getProductId(), item.getQuantity())) {
                throw new BusinessException("åº“å­˜ä¸è¶³");
            }
            
            // è®¡ç®—é‡‘é¢
            BigDecimal subtotal = product.getPrice().multiply(new BigDecimal(item.getQuantity()));
            totalAmount = totalAmount.add(subtotal);
            
            // æ„å»ºè®¢å•é¡¹
            OrderItem orderItem = new OrderItem();
            orderItem.setProductId(item.getProductId());
            orderItem.setPrice(product.getPrice());
            orderItem.setQuantity(item.getQuantity());
            orderItem.setSubtotal(subtotal);
            orderItems.add(orderItem);
        }
        
        // 3. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setOrderNo(orderNo);
        order.setUserId(userId);
        order.setTotalAmount(totalAmount);
        order.setStatus(OrderStatus.PENDING_PAYMENT);
        
        orderMapper.insert(order);
        
        // 4. åˆ›å»ºè®¢å•æ˜ç»†
        orderItems.forEach(item -> {
            item.setOrderId(order.getId());
            orderItemMapper.insert(item);
        });
        
        // 5. é¢„å åº“å­˜
        stockService.lockStock(orderItems);
        
        return orderNo;
    }
    
    // ç”Ÿæˆå”¯ä¸€è®¢å•å·
    private String generateOrderNo() {
        return "ORDER" + System.currentTimeMillis() + RandomUtil.randomNumbers(4);
    }
}
```

### 4.5 è®¢å•æŸ¥è¯¢ä¸ç®¡ç†


**ğŸ”¸ å¸¸ç”¨æŸ¥è¯¢åŠŸèƒ½**
```java
@RestController
public class OrderController {
    
    // æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
    @GetMapping("/orders")
    public Result getUserOrders(@RequestParam Long userId, 
                               @RequestParam(defaultValue = "1") int page) {
        PageHelper.startPage(page, 10);
        List<Order> orders = orderService.getUserOrders(userId);
        return Result.success(orders);
    }
    
    // è®¢å•è¯¦æƒ…æŸ¥è¯¢
    @GetMapping("/orders/{orderNo}")
    public Result getOrderDetail(@PathVariable String orderNo) {
        OrderDetail detail = orderService.getOrderDetail(orderNo);
        return Result.success(detail);
    }
    
    // å–æ¶ˆè®¢å•
    @PostMapping("/orders/{orderNo}/cancel")
    public Result cancelOrder(@PathVariable String orderNo) {
        orderService.cancelOrder(orderNo);
        return Result.success("è®¢å•å·²å–æ¶ˆ");
    }
}
```

---

## 5. ğŸ’° æ”¯ä»˜æœåŠ¡è®¾è®¡å®ç°


### 5.1 æ”¯ä»˜æœåŠ¡çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒå•†åœºçš„æ”¶é“¶å°
- å¤„ç†ç”¨æˆ·ä»˜æ¬¾ï¼šæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œå¡ç­‰
- ç¡®è®¤æ”¯ä»˜ç»“æœï¼šæˆåŠŸã€å¤±è´¥ã€å¤„ç†ä¸­
- å¤„ç†é€€æ¬¾ï¼šè®¢å•å–æ¶ˆæ—¶é€€è¿˜é‡‘é¢
- è®°å½•èµ„é‡‘æµæ°´ï¼šæ¯ç¬”äº¤æ˜“éƒ½æœ‰è®°å½•

### 5.2 æ”¯ä»˜æµç¨‹è®¾è®¡


**ğŸ”¸ æ”¯ä»˜å®Œæ•´æµç¨‹**
```
ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜ â†’ åˆ›å»ºæ”¯ä»˜è®¢å• â†’ è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜ â†’ ç”¨æˆ·å®Œæˆä»˜æ¬¾
     â†“              â†“              â†“              â†“
æ”¯ä»˜é¡µé¢å±•ç¤º    ç”Ÿæˆæ”¯ä»˜å‚æ•°    è·³è½¬æ”¯ä»˜é¡µé¢    æ”¯ä»˜ç»“æœé€šçŸ¥
     â†“              â†“              â†“              â†“
é€‰æ‹©æ”¯ä»˜æ–¹å¼    ä¿å­˜æ”¯ä»˜è®°å½•    ç­‰å¾…æ”¯ä»˜ç»“æœ    æ›´æ–°è®¢å•çŠ¶æ€
```

### 5.3 æ”¯ä»˜æ•°æ®æ¨¡å‹


**æ”¯ä»˜è®¢å•è¡¨**ï¼š
```sql
-- æ”¯ä»˜è®¢å•è¡¨
CREATE TABLE t_payment (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    payment_no VARCHAR(32) UNIQUE NOT NULL COMMENT 'æ”¯ä»˜å•å·',
    order_no VARCHAR(32) NOT NULL COMMENT 'ä¸šåŠ¡è®¢å•å·',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    amount DECIMAL(10,2) NOT NULL COMMENT 'æ”¯ä»˜é‡‘é¢',
    payment_method VARCHAR(20) COMMENT 'æ”¯ä»˜æ–¹å¼:ALIPAY,WECHAT',
    status TINYINT DEFAULT 1 COMMENT 'æ”¯ä»˜çŠ¶æ€:1å¾…æ”¯ä»˜,2å·²æ”¯ä»˜,3å·²é€€æ¬¾',
    third_party_no VARCHAR(64) COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“å·',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    pay_time TIMESTAMP NULL COMMENT 'æ”¯ä»˜å®Œæˆæ—¶é—´'
);
```

### 5.4 æ”¯ä»˜æ¥å£å®ç°


**ğŸ”¸ åˆ›å»ºæ”¯ä»˜è®¢å•**
```java
@RestController
public class PaymentController {
    
    // åˆ›å»ºæ”¯ä»˜è®¢å•
    @PostMapping("/payments/create")
    public Result createPayment(@RequestBody PaymentRequest request) {
        // 1. éªŒè¯è®¢å•çŠ¶æ€
        Order order = orderService.getOrderByNo(request.getOrderNo());
        if (order.getStatus() != OrderStatus.PENDING_PAYMENT) {
            return Result.error("è®¢å•çŠ¶æ€ä¸æ­£ç¡®");
        }
        
        // 2. åˆ›å»ºæ”¯ä»˜è®°å½•
        Payment payment = paymentService.createPayment(order, request.getPaymentMethod());
        
        // 3. ç”Ÿæˆæ”¯ä»˜å‚æ•°
        PaymentInfo paymentInfo = paymentService.generatePaymentInfo(payment);
        
        return Result.success("æ”¯ä»˜è®¢å•åˆ›å»ºæˆåŠŸ", paymentInfo);
    }
    
    // æ”¯ä»˜ç»“æœé€šçŸ¥æ¥å£
    @PostMapping("/payments/notify")
    public String paymentNotify(HttpServletRequest request) {
        try {
            // 1. éªŒè¯é€šçŸ¥ç­¾å
            if (!paymentService.verifyNotify(request)) {
                return "FAIL";
            }
            
            // 2. è§£æé€šçŸ¥å‚æ•°
            PaymentNotify notify = paymentService.parseNotify(request);
            
            // 3. å¤„ç†æ”¯ä»˜ç»“æœ
            paymentService.handlePaymentResult(notify);
            
            return "SUCCESS";
        } catch (Exception e) {
            logger.error("æ”¯ä»˜é€šçŸ¥å¤„ç†å¤±è´¥", e);
            return "FAIL";
        }
    }
}
```

### 5.5 ç¬¬ä¸‰æ–¹æ”¯ä»˜é›†æˆ


**ğŸ”¸ æ”¯ä»˜å®æ”¯ä»˜ç¤ºä¾‹**
```java
@Service
public class AlipayService {
    
    // ç”Ÿæˆæ”¯ä»˜å®æ”¯ä»˜å‚æ•°
    public String generatePaymentParams(Payment payment) {
        AlipayTradePagePayRequest request = new AlipayTradePagePayRequest();
        
        // è®¾ç½®å›è°ƒåœ°å€
        request.setReturnUrl("http://your-domain.com/payment/return");
        request.setNotifyUrl("http://your-domain.com/payment/notify");
        
        // è®¾ç½®ä¸šåŠ¡å‚æ•°
        JSONObject bizContent = new JSONObject();
        bizContent.put("out_trade_no", payment.getPaymentNo());
        bizContent.put("total_amount", payment.getAmount());
        bizContent.put("subject", "è®¢å•æ”¯ä»˜");
        bizContent.put("product_code", "FAST_INSTANT_TRADE_PAY");
        
        request.setBizContent(bizContent.toString());
        
        try {
            // ç”Ÿæˆæ”¯ä»˜URL
            return alipayClient.pageExecute(request).getBody();
        } catch (AlipayApiException e) {
            throw new BusinessException("ç”Ÿæˆæ”¯ä»˜å‚æ•°å¤±è´¥", e);
        }
    }
}
```

### 5.6 æ”¯ä»˜å®‰å…¨è€ƒè™‘


**ğŸ›¡ï¸ å®‰å…¨æªæ–½**
- **ç­¾åéªŒè¯**ï¼šé˜²æ­¢é€šçŸ¥æ•°æ®è¢«ç¯¡æ”¹
- **å¹‚ç­‰æ€§å¤„ç†**ï¼šé˜²æ­¢é‡å¤å¤„ç†æ”¯ä»˜é€šçŸ¥
- **é‡‘é¢æ ¡éªŒ**ï¼šç¡®ä¿æ”¯ä»˜é‡‘é¢ä¸è®¢å•é‡‘é¢ä¸€è‡´
- **çŠ¶æ€æ£€æŸ¥**ï¼šé˜²æ­¢é‡å¤æ”¯ä»˜æˆ–æ¶æ„æ“ä½œ

```java
@Service
public class PaymentService {
    
    // å¤„ç†æ”¯ä»˜ç»“æœ - å¸¦å®‰å…¨æ£€æŸ¥
    @Transactional
    public void handlePaymentResult(PaymentNotify notify) {
        // 1. æŸ¥è¯¢æ”¯ä»˜è®°å½•
        Payment payment = paymentMapper.selectByNo(notify.getOutTradeNo());
        if (payment == null) {
            throw new BusinessException("æ”¯ä»˜è®°å½•ä¸å­˜åœ¨");
        }
        
        // 2. æ£€æŸ¥æ”¯ä»˜çŠ¶æ€ - é˜²æ­¢é‡å¤å¤„ç†
        if (payment.getStatus() == PaymentStatus.PAID) {
            logger.info("æ”¯ä»˜å·²å¤„ç†ï¼Œå¿½ç•¥é‡å¤é€šçŸ¥: {}", notify.getOutTradeNo());
            return;
        }
        
        // 3. éªŒè¯é‡‘é¢ - é˜²æ­¢é‡‘é¢ç¯¡æ”¹
        if (!payment.getAmount().equals(notify.getTotalAmount())) {
            throw new BusinessException("æ”¯ä»˜é‡‘é¢ä¸åŒ¹é…");
        }
        
        // 4. æ›´æ–°æ”¯ä»˜çŠ¶æ€
        payment.setStatus(PaymentStatus.PAID);
        payment.setThirdPartyNo(notify.getTradeNo());
        payment.setPayTime(notify.getPayTime());
        paymentMapper.updateById(payment);
        
        // 5. é€šçŸ¥è®¢å•æœåŠ¡æ›´æ–°è®¢å•çŠ¶æ€
        orderService.handlePaymentSuccess(payment.getOrderNo());
    }
}
```

---

## 6. ğŸ“Š åº“å­˜æœåŠ¡è®¾è®¡å®ç°


### 6.1 åº“å­˜æœåŠ¡çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒä»“åº“ç®¡ç†ç³»ç»Ÿ
- ç®¡ç†å•†å“æ•°é‡ï¼šæ¯ç§å•†å“è¿˜æœ‰å¤šå°‘åº“å­˜
- å¤„ç†åº“å­˜æ‰£å‡ï¼šç”¨æˆ·ä¸‹å•åå‡å°‘åº“å­˜
- å¤„ç†åº“å­˜é‡Šæ”¾ï¼šè®¢å•å–æ¶ˆåæ¢å¤åº“å­˜
- é˜²æ­¢è¶…å–ï¼šç¡®ä¿ä¸ä¼šå–å‡ºè¶…è¿‡åº“å­˜çš„å•†å“

### 6.2 åº“å­˜ç®¡ç†æ¨¡å‹


**ğŸ”¸ åº“å­˜è¡¨è®¾è®¡**
```sql
-- å•†å“åº“å­˜è¡¨
CREATE TABLE t_stock (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNIQUE NOT NULL COMMENT 'å•†å“ID',
    available_stock INT NOT NULL DEFAULT 0 COMMENT 'å¯ç”¨åº“å­˜',
    locked_stock INT NOT NULL DEFAULT 0 COMMENT 'é”å®šåº“å­˜',
    total_stock INT NOT NULL DEFAULT 0 COMMENT 'æ€»åº“å­˜',
    version INT DEFAULT 0 COMMENT 'ç‰ˆæœ¬å·(ä¹è§‚é”)',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- åº“å­˜æµæ°´è¡¨ - è®°å½•æ‰€æœ‰åº“å­˜å˜åŠ¨
CREATE TABLE t_stock_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT NOT NULL COMMENT 'å•†å“ID',
    order_no VARCHAR(32) COMMENT 'å…³è”è®¢å•å·',
    operation_type VARCHAR(20) NOT NULL COMMENT 'æ“ä½œç±»å‹:LOCK,UNLOCK,DEDUCT',
    quantity INT NOT NULL COMMENT 'å˜åŠ¨æ•°é‡',
    before_stock INT COMMENT 'æ“ä½œå‰åº“å­˜',
    after_stock INT COMMENT 'æ“ä½œååº“å­˜',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 6.3 åº“å­˜æ‰£å‡ç­–ç•¥


**ä»€ä¹ˆæ˜¯åº“å­˜é¢„å ï¼Ÿ**
- **é—®é¢˜åœºæ™¯**ï¼šç”¨æˆ·ä¸‹å•åä¸ç«‹å³æ”¯ä»˜ï¼Œä½†å•†å“å·²ç»"é¢„å®š"ç»™ä»–
- **è§£å†³æ–¹æ¡ˆ**ï¼šå…ˆé”å®šåº“å­˜ï¼ˆé¢„å ï¼‰ï¼Œæ”¯ä»˜æˆåŠŸåçœŸæ­£æ‰£å‡ï¼Œè¶…æ—¶æœªæ”¯ä»˜åˆ™é‡Šæ”¾

**ğŸ”¸ åº“å­˜æ“ä½œæµç¨‹**
```
ç”¨æˆ·ä¸‹å• â†’ é”å®šåº“å­˜ â†’ ç­‰å¾…æ”¯ä»˜ â†’ æ”¯ä»˜æˆåŠŸ â†’ æ‰£å‡åº“å­˜
                              â†“
                         æ”¯ä»˜è¶…æ—¶ â†’ é‡Šæ”¾åº“å­˜
```

### 6.4 æ ¸å¿ƒåº“å­˜æ“ä½œ


**ğŸ”¸ åº“å­˜æ£€æŸ¥ä¸é”å®š**
```java
@Service
public class StockService {
    
    // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    public boolean checkStock(Long productId, int quantity) {
        Stock stock = stockMapper.selectByProductId(productId);
        return stock != null && stock.getAvailableStock() >= quantity;
    }
    
    // é”å®šåº“å­˜ - ä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘é—®é¢˜
    @Transactional
    public boolean lockStock(Long productId, int quantity, String orderNo) {
        // 1. æŸ¥è¯¢å½“å‰åº“å­˜
        Stock stock = stockMapper.selectByProductId(productId);
        if (stock.getAvailableStock() < quantity) {
            return false; // åº“å­˜ä¸è¶³
        }
        
        // 2. ä½¿ç”¨ä¹è§‚é”æ›´æ–°åº“å­˜
        int updatedRows = stockMapper.lockStock(productId, quantity, stock.getVersion());
        if (updatedRows == 0) {
            // å¹¶å‘å†²çªï¼Œé‡è¯•
            return lockStock(productId, quantity, orderNo);
        }
        
        // 3. è®°å½•åº“å­˜æµæ°´
        StockLog log = new StockLog();
        log.setProductId(productId);
        log.setOrderNo(orderNo);
        log.setOperationType("LOCK");
        log.setQuantity(quantity);
        log.setBeforeStock(stock.getAvailableStock());
        log.setAfterStock(stock.getAvailableStock() - quantity);
        stockLogMapper.insert(log);
        
        return true;
    }
    
    // æ‰£å‡åº“å­˜ - æ”¯ä»˜æˆåŠŸåè°ƒç”¨
    @Transactional
    public void deductStock(String orderNo) {
        // 1. æŸ¥è¯¢è®¢å•é”å®šçš„åº“å­˜
        List<StockLog> lockLogs = stockLogMapper.selectByOrderNo(orderNo, "LOCK");
        
        for (StockLog lockLog : lockLogs) {
            // 2. å°†é”å®šåº“å­˜è½¬ä¸ºå·²æ‰£å‡
            stockMapper.deductStock(lockLog.getProductId(), lockLog.getQuantity());
            
            // 3. è®°å½•æ‰£å‡æµæ°´
            StockLog deductLog = new StockLog();
            deductLog.setProductId(lockLog.getProductId());
            deductLog.setOrderNo(orderNo);
            deductLog.setOperationType("DEDUCT");
            deductLog.setQuantity(lockLog.getQuantity());
            stockLogMapper.insert(deductLog);
        }
    }
}
```

### 6.5 åº“å­˜æ•°æ®ä¸€è‡´æ€§


**ä¹è§‚é”å®ç°**ï¼š
```sql
-- ä½¿ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”
UPDATE t_stock 
SET available_stock = available_stock - #{quantity},
    locked_stock = locked_stock + #{quantity},
    version = version + 1
WHERE product_id = #{productId} 
  AND available_stock >= #{quantity}
  AND version = #{version}
```

**ä¸ºä»€ä¹ˆç”¨ä¹è§‚é”ï¼Ÿ**
- **æ‚²è§‚é”**ï¼šæ¯æ¬¡æ“ä½œéƒ½åŠ é”ï¼Œå¹¶å‘æ€§èƒ½å·®
- **ä¹è§‚é”**ï¼šåªåœ¨æ›´æ–°æ—¶æ£€æŸ¥å†²çªï¼Œæ€§èƒ½æ›´å¥½
- **é€‚ç”¨åœºæ™¯**ï¼šåº“å­˜æ›´æ–°å†²çªæ¦‚ç‡ä¸é«˜ï¼Œä¹è§‚é”æ›´åˆé€‚

### 6.6 åº“å­˜é¢„è­¦æœºåˆ¶


**ğŸ”¸ åº“å­˜ç›‘æ§**
```java
@Component
public class StockMonitor {
    
    // å®šæ—¶æ£€æŸ¥åº“å­˜é¢„è­¦
    @Scheduled(fixedRate = 300000) // 5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void checkStockAlert() {
        List<Stock> lowStockProducts = stockMapper.selectLowStock(10); // åº“å­˜ä½äº10çš„å•†å“
        
        for (Stock stock : lowStockProducts) {
            // å‘é€åº“å­˜é¢„è­¦é€šçŸ¥
            alertService.sendStockAlert(stock.getProductId(), stock.getAvailableStock());
            
            // è®°å½•é¢„è­¦æ—¥å¿—
            logger.warn("å•†å“åº“å­˜ä¸è¶³: productId={}, stock={}", 
                       stock.getProductId(), stock.getAvailableStock());
        }
    }
}
```

---

## 7. ğŸ›’ è´­ç‰©è½¦æœåŠ¡è®¾è®¡


### 7.1 è´­ç‰©è½¦æœåŠ¡çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒè¶…å¸‚çš„è´­ç‰©è½¦
- ä¸´æ—¶å­˜å‚¨ï¼šç”¨æˆ·é€‰æ‹©çš„å•†å“æš‚æ—¶æ”¾åœ¨è¿™é‡Œ
- éšæ—¶ä¿®æ”¹ï¼šå¯ä»¥å¢åŠ ã€å‡å°‘ã€åˆ é™¤å•†å“
- æ‰¹é‡ç»“ç®—ï¼šä¸€æ¬¡æ€§è´­ä¹°è´­ç‰©è½¦ä¸­çš„æ‰€æœ‰å•†å“
- æŒä¹…ä¿å­˜ï¼šç”¨æˆ·ä¸‹æ¬¡ç™»å½•æ—¶è´­ç‰©è½¦å†…å®¹è¿˜åœ¨

### 7.2 è´­ç‰©è½¦å­˜å‚¨æ–¹æ¡ˆ


**ä¸ºä»€ä¹ˆç”¨Rediså­˜å‚¨ï¼Ÿ**
- **è®¿é—®é¢‘ç¹**ï¼šç”¨æˆ·ä¼šé¢‘ç¹æŸ¥çœ‹å’Œä¿®æ”¹è´­ç‰©è½¦
- **ä¸´æ—¶æ€§å¼º**ï¼šå¤§éƒ¨åˆ†è´­ç‰©è½¦å†…å®¹æœ€ç»ˆä¼šè¢«æ¸…ç©ºæˆ–ä¸‹å•
- **æ€§èƒ½è¦æ±‚é«˜**ï¼šéœ€è¦å¿«é€Ÿå“åº”ç”¨æˆ·æ“ä½œ
- **æ•°æ®ç®€å•**ï¼šè´­ç‰©è½¦æ•°æ®ç»“æ„ç›¸å¯¹ç®€å•

**ğŸ”¸ Redisæ•°æ®ç»“æ„è®¾è®¡**
```
Redis Hash ç»“æ„ï¼š
Key: cart:user:{userId}
Field: product:{productId}
Value: {
  "productId": 123,
  "productName": "iPhone 14",
  "price": 5999.00,
  "quantity": 2,
  "addTime": "2024-01-01 10:00:00"
}

ç¤ºä¾‹ï¼š
cart:user:1001
â”œâ”€â”€ product:123 â†’ {"productId":123,"quantity":2,...}
â”œâ”€â”€ product:456 â†’ {"productId":456,"quantity":1,...}
â””â”€â”€ product:789 â†’ {"productId":789,"quantity":3,...}
```

### 7.3 è´­ç‰©è½¦æ ¸å¿ƒåŠŸèƒ½


**ğŸ”¸ æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦**
```java
@Service
public class CartService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    public void addToCart(Long userId, Long productId, int quantity) {
        // 1. è·å–å•†å“ä¿¡æ¯
        Product product = productService.getProduct(productId);
        if (product == null) {
            throw new BusinessException("å•†å“ä¸å­˜åœ¨");
        }
        
        // 2. æ£€æŸ¥åº“å­˜
        if (!stockService.checkStock(productId, quantity)) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // 3. æ„å»ºè´­ç‰©è½¦é¡¹
        CartItem cartItem = new CartItem();
        cartItem.setProductId(productId);
        cartItem.setProductName(product.getName());
        cartItem.setPrice(product.getPrice());
        cartItem.setQuantity(quantity);
        cartItem.setAddTime(new Date());
        
        // 4. å­˜å‚¨åˆ°Redis
        String cartKey = "cart:user:" + userId;
        String field = "product:" + productId;
        
        // å¦‚æœå•†å“å·²å­˜åœ¨ï¼Œåˆ™ç´¯åŠ æ•°é‡
        CartItem existingItem = (CartItem) redisTemplate.opsForHash().get(cartKey, field);
        if (existingItem != null) {
            cartItem.setQuantity(existingItem.getQuantity() + quantity);
        }
        
        redisTemplate.opsForHash().put(cartKey, field, cartItem);
        
        // 5. è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ30å¤©ï¼‰
        redisTemplate.expire(cartKey, 30, TimeUnit.DAYS);
    }
}
```

**ğŸ”¸ è´­ç‰©è½¦æŸ¥è¯¢ä¸ç®¡ç†**
```java
@RestController
public class CartController {
    
    // æŸ¥çœ‹è´­ç‰©è½¦
    @GetMapping("/cart")
    public Result getCart(@RequestParam Long userId) {
        List<CartItem> cartItems = cartService.getCartItems(userId);
        
        // è®¡ç®—æ€»ä»·
        BigDecimal totalAmount = cartItems.stream()
            .map(item -> item.getPrice().multiply(new BigDecimal(item.getQuantity())))
            .reduce(BigDecimal.ZERO, BigDecimal::add);
            
        CartInfo cartInfo = new CartInfo();
        cartInfo.setItems(cartItems);
        cartInfo.setTotalAmount(totalAmount);
        cartInfo.setTotalQuantity(cartItems.size());
        
        return Result.success(cartInfo);
    }
    
    // ä¿®æ”¹å•†å“æ•°é‡
    @PostMapping("/cart/update")
    public Result updateQuantity(@RequestBody UpdateCartRequest request) {
        cartService.updateQuantity(request.getUserId(), 
                                  request.getProductId(), 
                                  request.getQuantity());
        return Result.success("æ›´æ–°æˆåŠŸ");
    }
    
    // åˆ é™¤è´­ç‰©è½¦å•†å“
    @DeleteMapping("/cart/{userId}/{productId}")
    public Result removeFromCart(@PathVariable Long userId, @PathVariable Long productId) {
        cartService.removeFromCart(userId, productId);
        return Result.success("åˆ é™¤æˆåŠŸ");
    }
    
    // æ¸…ç©ºè´­ç‰©è½¦
    @DeleteMapping("/cart/{userId}")
    public Result clearCart(@PathVariable Long userId) {
        cartService.clearCart(userId);
        return Result.success("è´­ç‰©è½¦å·²æ¸…ç©º");
    }
}
```

### 7.4 è´­ç‰©è½¦ä¸è®¢å•å…³è”


**ä»è´­ç‰©è½¦åˆ°è®¢å•çš„æµç¨‹**ï¼š
```
ç”¨æˆ·é€‰æ‹©å•†å“ â†’ ç‚¹å‡»ç»“ç®— â†’ åˆ›å»ºè®¢å• â†’ æ¸…ç©ºå·²ä¸‹å•å•†å“
```

```java
@Service
public class CartService {
    
    // è·å–é€‰ä¸­çš„å•†å“ç”¨äºä¸‹å•
    public List<CartItem> getSelectedItems(Long userId, List<Long> productIds) {
        String cartKey = "cart:user:" + userId;
        
        List<CartItem> selectedItems = new ArrayList<>();
        for (Long productId : productIds) {
            String field = "product:" + productId;
            CartItem item = (CartItem) redisTemplate.opsForHash().get(cartKey, field);
            if (item != null) {
                selectedItems.add(item);
            }
        }
        
        return selectedItems;
    }
    
    // ä¸‹å•æˆåŠŸåæ¸…ç©ºå¯¹åº”å•†å“
    public void removeOrderedItems(Long userId, List<Long> productIds) {
        String cartKey = "cart:user:" + userId;
        
        String[] fields = productIds.stream()
            .map(id -> "product:" + id)
            .toArray(String[]::new);
            
        redisTemplate.opsForHash().delete(cartKey, fields);
    }
}
```

---

## 8. ğŸ”„ æœåŠ¡é—´è°ƒç”¨é“¾è·¯


### 8.1 å¾®æœåŠ¡è°ƒç”¨å…³ç³»


**é€šä¿—ç†è§£**ï¼šå°±åƒä¸åŒéƒ¨é—¨ä¹‹é—´çš„åä½œ
- è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡éªŒè¯ç”¨æˆ·èº«ä»½
- è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨å•†å“æœåŠ¡è·å–å•†å“ä¿¡æ¯  
- è®¢å•æœåŠ¡éœ€è¦è°ƒç”¨åº“å­˜æœåŠ¡é”å®šåº“å­˜
- æ”¯ä»˜æœåŠ¡éœ€è¦è°ƒç”¨è®¢å•æœåŠ¡æ›´æ–°çŠ¶æ€

**ğŸ”¸ æœåŠ¡è°ƒç”¨å…³ç³»å›¾**
```
ç”¨æˆ·ä¸‹å•å®Œæ•´è°ƒç”¨é“¾è·¯ï¼š

å®¢æˆ·ç«¯
  â†“
è®¢å•æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡(éªŒè¯ç”¨æˆ·)
  â†“
è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡(è·å–å•†å“ä¿¡æ¯)
  â†“  
è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡(é”å®šåº“å­˜)
  â†“
è®¢å•æœåŠ¡ â†’ è´­ç‰©è½¦æœåŠ¡(æ¸…ç©ºè´­ç‰©è½¦)
  â†“
æ”¯ä»˜æœåŠ¡ â† è®¢å•æœåŠ¡(åˆ›å»ºæ”¯ä»˜è®¢å•)
  â†“
æ”¯ä»˜æœåŠ¡ â†’ è®¢å•æœåŠ¡(æ›´æ–°è®¢å•çŠ¶æ€)
  â†“
åº“å­˜æœåŠ¡ â† è®¢å•æœåŠ¡(æ‰£å‡åº“å­˜)
```

### 8.2 ä½¿ç”¨OpenFeignè¿›è¡ŒæœåŠ¡è°ƒç”¨


**ä»€ä¹ˆæ˜¯OpenFeignï¼Ÿ**
- **é€šä¿—è§£é‡Š**ï¼šå°±åƒæ‰“ç”µè¯ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ–¹æ³•
- **æŠ€æœ¯è§£é‡Š**ï¼šå£°æ˜å¼çš„HTTPå®¢æˆ·ç«¯ï¼Œè®©æœåŠ¡é—´è°ƒç”¨åƒæœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·ç®€å•

**ğŸ”¸ å®šä¹‰æœåŠ¡æ¥å£**
```java
// ç”¨æˆ·æœåŠ¡æ¥å£
@FeignClient(name = "user-service", path = "/api/users")
public interface UserServiceClient {
    
    @GetMapping("/{userId}")
    Result<User> getUserById(@PathVariable Long userId);
    
    @PostMapping("/validate")
    Result<Boolean> validateUser(@RequestParam String token);
}

// å•†å“æœåŠ¡æ¥å£
@FeignClient(name = "product-service", path = "/api/products")
public interface ProductServiceClient {
    
    @GetMapping("/{productId}")
    Result<Product> getProductById(@PathVariable Long productId);
    
    @PostMapping("/batch")
    Result<List<Product>> getProductsByIds(@RequestBody List<Long> productIds);
}

// åº“å­˜æœåŠ¡æ¥å£
@FeignClient(name = "stock-service", path = "/api/stock")
public interface StockServiceClient {
    
    @PostMapping("/check")
    Result<Boolean> checkStock(@RequestParam Long productId, @RequestParam int quantity);
    
    @PostMapping("/lock")
    Result<Boolean> lockStock(@RequestParam Long productId, 
                             @RequestParam int quantity, 
                             @RequestParam String orderNo);
}
```

### 8.3 æœåŠ¡è°ƒç”¨å®ç°


**ğŸ”¸ åœ¨è®¢å•æœåŠ¡ä¸­è°ƒç”¨å…¶ä»–æœåŠ¡**
```java
@Service
public class OrderService {
    
    @Autowired
    private UserServiceClient userServiceClient;
    
    @Autowired 
    private ProductServiceClient productServiceClient;
    
    @Autowired
    private StockServiceClient stockServiceClient;
    
    // åˆ›å»ºè®¢å•æ—¶çš„æœåŠ¡è°ƒç”¨
    @Transactional
    public String createOrder(String token, List<OrderItemRequest> items) {
        // 1. éªŒè¯ç”¨æˆ·èº«ä»½
        Result<Boolean> userValidation = userServiceClient.validateUser(token);
        if (!userValidation.isSuccess() || !userValidation.getData()) {
            throw new BusinessException("ç”¨æˆ·èº«ä»½éªŒè¯å¤±è´¥");
        }
        
        // 2. æ‰¹é‡è·å–å•†å“ä¿¡æ¯
        List<Long> productIds = items.stream()
            .map(OrderItemRequest::getProductId)
            .collect(Collectors.toList());
            
        Result<List<Product>> productsResult = productServiceClient.getProductsByIds(productIds);
        if (!productsResult.isSuccess()) {
            throw new BusinessException("è·å–å•†å“ä¿¡æ¯å¤±è´¥");
        }
        
        Map<Long, Product> productMap = productsResult.getData().stream()
            .collect(Collectors.toMap(Product::getId, Function.identity()));
        
        // 3. éªŒè¯åº“å­˜å¹¶é”å®š
        String orderNo = generateOrderNo();
        for (OrderItemRequest item : items) {
            Product product = productMap.get(item.getProductId());
            if (product == null) {
                throw new BusinessException("å•†å“ä¸å­˜åœ¨: " + item.getProductId());
            }
            
            // æ£€æŸ¥å¹¶é”å®šåº“å­˜
            Result<Boolean> stockResult = stockServiceClient.lockStock(
                item.getProductId(), item.getQuantity(), orderNo);
                
            if (!stockResult.isSuccess() || !stockResult.getData()) {
                throw new BusinessException("åº“å­˜ä¸è¶³: " + product.getName());
            }
        }
        
        // 4. åˆ›å»ºè®¢å•è®°å½•
        // ... è®¢å•åˆ›å»ºé€»è¾‘
        
        return orderNo;
    }
}
```

### 8.4 æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸å¤„ç†


**ğŸ”¸ Feignå¼‚å¸¸å¤„ç†**
```java
@Component
public class FeignErrorDecoder implements ErrorDecoder {
    
    @Override
    public Exception decode(String methodKey, Response response) {
        String message = "æœåŠ¡è°ƒç”¨å¤±è´¥";
        
        try {
            // è¯»å–å“åº”å†…å®¹
            String body = Util.toString(response.body().asReader(StandardCharsets.UTF_8));
            JSONObject json = JSON.parseObject(body);
            message = json.getString("message");
        } catch (Exception e) {
            // è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ¶ˆæ¯
        }
        
        // æ ¹æ®çŠ¶æ€ç è¿”å›ä¸åŒå¼‚å¸¸
        switch (response.status()) {
            case 400:
                return new BusinessException("è¯·æ±‚å‚æ•°é”™è¯¯: " + message);
            case 404:
                return new BusinessException("æœåŠ¡ä¸å­˜åœ¨: " + message);
            case 500:
                return new BusinessException("æœåŠ¡å†…éƒ¨é”™è¯¯: " + message);
            default:
                return new BusinessException("æœåŠ¡è°ƒç”¨å¤±è´¥: " + message);
        }
    }
}
```

### 8.5 æœåŠ¡é™çº§ä¸ç†”æ–­


**ä»€ä¹ˆæ˜¯æœåŠ¡é™çº§ï¼Ÿ**
- **é—®é¢˜åœºæ™¯**ï¼šå½“æŸä¸ªæœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯ä¼šä¸­æ–­
- **è§£å†³æ–¹æ¡ˆ**ï¼šæä¾›å¤‡ç”¨æ–¹æ¡ˆï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨

**ğŸ”¸ ä½¿ç”¨Hystrixå®ç°é™çº§**
```java
@Service
public class OrderService {
    
    @Autowired
    private ProductServiceClient productServiceClient;
    
    // è·å–å•†å“ä¿¡æ¯ï¼Œå¸¦é™çº§å¤„ç†
    @HystrixCommand(fallbackMethod = "getProductFallback")
    public Product getProductWithFallback(Long productId) {
        Result<Product> result = productServiceClient.getProductById(productId);
        if (result.isSuccess()) {
            return result.getData();
        }
        throw new BusinessException("è·å–å•†å“ä¿¡æ¯å¤±è´¥");
    }
    
    // é™çº§æ–¹æ³• - å½“ä¸»æ–¹æ³•å¤±è´¥æ—¶è°ƒç”¨
    public Product getProductFallback(Long productId) {
        logger.warn("å•†å“æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ: productId={}", productId);
        
        // è¿”å›é»˜è®¤å•†å“ä¿¡æ¯
        Product defaultProduct = new Product();
        defaultProduct.setId(productId);
        defaultProduct.setName("å•†å“ä¿¡æ¯æš‚æ—¶ä¸å¯ç”¨");
        defaultProduct.setPrice(BigDecimal.ZERO);
        
        return defaultProduct;
    }
}
```

---

## 9. ğŸ”„ æ•°æ®ä¸€è‡´æ€§ä¿è¯


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®ä¸€è‡´æ€§


**é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡Œè½¬è´¦ä¸€æ ·
- Aè´¦æˆ·æ‰£é’±äº†ï¼ŒBè´¦æˆ·ä¹Ÿå¿…é¡»æ”¶åˆ°é’±
- ä¸èƒ½å‡ºç°Aæ‰£äº†é’±ä½†Bæ²¡æ”¶åˆ°çš„æƒ…å†µ
- åœ¨å¾®æœåŠ¡ä¸­ï¼Œå¤šä¸ªæœåŠ¡çš„æ•°æ®ä¹Ÿéœ€è¦ä¿æŒä¸€è‡´

**å¾®æœåŠ¡ä¸­çš„ä¸€è‡´æ€§é—®é¢˜**ï¼š
```
ç”¨æˆ·ä¸‹å•åœºæ™¯ï¼š
1. è®¢å•æœåŠ¡ï¼šåˆ›å»ºè®¢å• âœ…
2. åº“å­˜æœåŠ¡ï¼šæ‰£å‡åº“å­˜ âŒ (ç½‘ç»œå¼‚å¸¸å¤±è´¥)
3. æ”¯ä»˜æœåŠ¡ï¼šåˆ›å»ºæ”¯ä»˜å• âœ…

ç»“æœï¼šè®¢å•åˆ›å»ºæˆåŠŸï¼Œä½†åº“å­˜æ²¡æ‰£å‡ â†’ æ•°æ®ä¸ä¸€è‡´ï¼
```

### 9.2 åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ


**ğŸ”¸ å¸¸è§è§£å†³æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **ä¸¤é˜¶æ®µæäº¤(2PC)** | å¼ºä¸€è‡´æ€§ | æ€§èƒ½å·®ï¼Œå•ç‚¹æ•…éšœ | å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜ |
| **TCCè¡¥å¿æœºåˆ¶** | æ€§èƒ½è¾ƒå¥½ | å®ç°å¤æ‚ | æ ¸å¿ƒä¸šåŠ¡åœºæ™¯ |
| **å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§** | å®ç°ç®€å•ï¼Œæ€§èƒ½å¥½ | åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´ | å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ |
| **æœ€å¤§åŠªåŠ›é€šçŸ¥** | å®ç°ç®€å• | ä¸ä¿è¯ä¸€å®šæˆåŠŸ | å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ |

### 9.3 ä½¿ç”¨TCCæ¨¡å¼ä¿è¯ä¸€è‡´æ€§


**ä»€ä¹ˆæ˜¯TCCï¼Ÿ**
- **Try**ï¼šå°è¯•æ‰§è¡Œï¼Œé¢„ç•™èµ„æº
- **Confirm**ï¼šç¡®è®¤æ‰§è¡Œï¼Œæäº¤äº‹åŠ¡  
- **Cancel**ï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾èµ„æº

**ğŸ”¸ TCCå®ç°ç¤ºä¾‹**
```java
// è®¢å•æœåŠ¡çš„TCCå®ç°
@Service
public class OrderTccService {
    
    // Tryé˜¶æ®µï¼šåˆ›å»ºé¢„è®¢å•
    @Transactional
    public boolean tryCreateOrder(String orderNo, OrderRequest request) {
        try {
            // 1. åˆ›å»ºé¢„è®¢å•ï¼ˆçŠ¶æ€ä¸ºTRYï¼‰
            Order order = new Order();
            order.setOrderNo(orderNo);
            order.setStatus(OrderStatus.TRY);
            // ... è®¾ç½®å…¶ä»–å­—æ®µ
            orderMapper.insert(order);
            
            // 2. è°ƒç”¨å…¶ä»–æœåŠ¡çš„Tryæ–¹æ³•
            boolean stockTryResult = stockTccService.tryLockStock(orderNo, request.getItems());
            boolean paymentTryResult = paymentTccService.tryCreatePayment(orderNo, order.getTotalAmount());
            
            if (stockTryResult && paymentTryResult) {
                return true;
            } else {
                // Tryå¤±è´¥ï¼Œéœ€è¦è°ƒç”¨Cancel
                throw new RuntimeException("Tryé˜¶æ®µå¤±è´¥");
            }
            
        } catch (Exception e) {
            logger.error("è®¢å•Tryé˜¶æ®µå¤±è´¥: {}", orderNo, e);
            return false;
        }
    }
    
    // Confirmé˜¶æ®µï¼šç¡®è®¤è®¢å•
    @Transactional
    public boolean confirmCreateOrder(String orderNo) {
        try {
            // 1. æ›´æ–°è®¢å•çŠ¶æ€
            Order order = orderMapper.selectByOrderNo(orderNo);
            order.setStatus(OrderStatus.PENDING_PAYMENT);
            orderMapper.updateById(order);
            
            // 2. è°ƒç”¨å…¶ä»–æœåŠ¡çš„Confirmæ–¹æ³•
            stockTccService.confirmLockStock(orderNo);
            paymentTccService.confirmCreatePayment(orderNo);
            
            return true;
        } catch (Exception e) {
            logger.error("è®¢å•Confirmé˜¶æ®µå¤±è´¥: {}", orderNo, e);
            return false;
        }
    }
    
    // Cancelé˜¶æ®µï¼šå–æ¶ˆè®¢å•
    @Transactional
    public boolean cancelCreateOrder(String orderNo) {
        try {
            // 1. åˆ é™¤é¢„è®¢å•æˆ–æ›´æ–°çŠ¶æ€
            orderMapper.deleteByOrderNo(orderNo);
            
            // 2. è°ƒç”¨å…¶ä»–æœåŠ¡çš„Cancelæ–¹æ³•
            stockTccService.cancelLockStock(orderNo);
            paymentTccService.cancelCreatePayment(orderNo);
            
            return true;
        } catch (Exception e) {
            logger.error("è®¢å•Cancelé˜¶æ®µå¤±è´¥: {}", orderNo, e);
            return false;
        }
    }
}
```

### 9.4 ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æœ€ç»ˆä¸€è‡´æ€§


**åŸºäºæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ**ï¼š
```
æœ¬åœ°äº‹åŠ¡ + æ¶ˆæ¯å‘é€ + æ¶ˆè´¹è€…å¤„ç† = æœ€ç»ˆä¸€è‡´æ€§
```

**ğŸ”¸ å¯é æ¶ˆæ¯å‘é€**
```java
@Service
@Transactional
public class OrderService {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    // åˆ›å»ºè®¢å• - ä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨ä¿è¯å¯é å‘é€
    public String createOrder(OrderRequest request) {
        // 1. å¼€å¯æœ¬åœ°äº‹åŠ¡
        String orderNo = generateOrderNo();
        
        try {
            // 2. åˆ›å»ºè®¢å•
            Order order = buildOrder(orderNo, request);
            orderMapper.insert(order);
            
            // 3. ä¿å­˜å¾…å‘é€æ¶ˆæ¯åˆ°æœ¬åœ°æ¶ˆæ¯è¡¨
            OutboxMessage message = new OutboxMessage();
            message.setAggregateId(orderNo);
            message.setEventType("ORDER_CREATED");
            message.setPayload(JSON.toJSONString(order));
            message.setStatus(MessageStatus.PENDING);
            outboxMessageMapper.insert(message);
            
            // 4. æäº¤æœ¬åœ°äº‹åŠ¡
            return orderNo;
            
        } catch (Exception e) {
            // äº‹åŠ¡å›æ»š
            throw new BusinessException("åˆ›å»ºè®¢å•å¤±è´¥", e);
        }
    }
}

// å®šæ—¶ä»»åŠ¡å‘é€æ¶ˆæ¯
@Component
public class MessageSender {
    
    // å®šæ—¶å‘é€æœªå‘é€çš„æ¶ˆæ¯
    @Scheduled(fixedDelay = 5000) // 5ç§’æ‰§è¡Œä¸€æ¬¡
    public void sendPendingMessages() {
        List<OutboxMessage> pendingMessages = outboxMessageMapper.selectPending();
        
        for (OutboxMessage message : pendingMessages) {
            try {
                // å‘é€æ¶ˆæ¯åˆ°MQ
                rabbitTemplate.convertAndSend("order.exchange", "order.created", message.getPayload());
                
                // æ›´æ–°æ¶ˆæ¯çŠ¶æ€
                message.setStatus(MessageStatus.SENT);
                outboxMessageMapper.updateById(message);
                
            } catch (Exception e) {
                logger.error("å‘é€æ¶ˆæ¯å¤±è´¥: messageId={}", message.getId(), e);
            }
        }
    }
}
```

### 9.5 æ¶ˆæ¯æ¶ˆè´¹ä¸å¹‚ç­‰æ€§ä¿è¯


**ğŸ”¸ åº“å­˜æœåŠ¡æ¶ˆè´¹è®¢å•æ¶ˆæ¯**
```java
@RabbitListener(queues = "stock.order.queue")
@Service
public class StockMessageConsumer {
    
    // æ¶ˆè´¹è®¢å•åˆ›å»ºæ¶ˆæ¯
    public void handleOrderCreated(@Payload String messageBody, 
                                  @Header Map<String, Object> headers,
                                  Channel channel,
                                  @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        try {
            // 1. è§£ææ¶ˆæ¯
            Order order = JSON.parseObject(messageBody, Order.class);
            
            // 2. å¹‚ç­‰æ€§æ£€æŸ¥ - é˜²æ­¢é‡å¤å¤„ç†
            String idempotentKey = "stock_deduct:" + order.getOrderNo();
            Boolean processed = redisTemplate.opsForValue().setIfAbsent(idempotentKey, "1", 10, TimeUnit.MINUTES);
            
            if (!processed) {
                logger.info("è®¢å•åº“å­˜æ‰£å‡å·²å¤„ç†ï¼Œè·³è¿‡: {}", order.getOrderNo());
                channel.basicAck(deliveryTag, false); // ç¡®è®¤æ¶ˆæ¯
                return;
            }
            
            // 3. æ‰§è¡Œåº“å­˜æ‰£å‡
            boolean success = stockService.deductStock(order.getOrderNo());
            
            if (success) {
                // 4. ç¡®è®¤æ¶ˆæ¯
                channel.basicAck(deliveryTag, false);
                logger.info("è®¢å•åº“å­˜æ‰£å‡æˆåŠŸ: {}", order.getOrderNo());
            } else {
                // 5. æ‹’ç»æ¶ˆæ¯ï¼Œé‡æ–°å…¥é˜Ÿ
                channel.basicNack(deliveryTag, false, true);
                logger.error("è®¢å•åº“å­˜æ‰£å‡å¤±è´¥: {}", order.getOrderNo());
            }
            
        } catch (Exception e) {
            logger.error("å¤„ç†è®¢å•æ¶ˆæ¯å¤±è´¥: {}", messageBody, e);
            try {
                // æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œæ‹’ç»å¹¶é‡æ–°å…¥é˜Ÿ
                channel.basicNack(deliveryTag, false, true);
            } catch (IOException ioException) {
                logger.error("æ‹’ç»æ¶ˆæ¯å¤±è´¥", ioException);
            }
        }
    }
}
```

---

## 10. ğŸ“Š ç³»ç»Ÿå‹åŠ›æµ‹è¯•


### 10.1 ä¸ºä»€ä¹ˆéœ€è¦å‹åŠ›æµ‹è¯•


**é€šä¿—ç†è§£**ï¼šå°±åƒæµ‹è¯•æ¡¥æ¢çš„æ‰¿é‡èƒ½åŠ›
- ç³»ç»Ÿåœ¨é«˜å¹¶å‘ä¸‹ä¼šä¸ä¼šå´©æºƒï¼Ÿ
- å“åº”æ—¶é—´æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Ÿ
- å“ªäº›ç»„ä»¶æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Ÿ
- ç³»ç»Ÿæœ€å¤§èƒ½æ”¯æŒå¤šå°‘ç”¨æˆ·ï¼Ÿ

### 10.2 å‹åŠ›æµ‹è¯•å·¥å…·ä¸ç¯å¢ƒ


**ğŸ”¸ æµ‹è¯•å·¥å…·é€‰æ‹©**
```
JMeterï¼š
âœ… åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤šç§åè®®
âœ… å¯è§†åŒ–ç•Œé¢ï¼Œå®¹æ˜“ä¸Šæ‰‹
âœ… æ”¯æŒåˆ†å¸ƒå¼æµ‹è¯•

Apache Bench (ab)ï¼š
âœ… è½»é‡ç®€å•ï¼Œå‘½ä»¤è¡Œæ“ä½œ
âœ… å¿«é€Ÿæµ‹è¯•å•ä¸ªæ¥å£
âŒ åŠŸèƒ½ç›¸å¯¹ç®€å•

Gatlingï¼š  
âœ… æ€§èƒ½æ›´å¥½ï¼Œèµ„æºå ç”¨å°‘
âœ… æµ‹è¯•æŠ¥å‘Šè¯¦ç»†ç¾è§‚
âŒ å­¦ä¹ æˆæœ¬è¾ƒé«˜
```

**ğŸ”¸ æµ‹è¯•ç¯å¢ƒå‡†å¤‡**
```
ç¯å¢ƒé…ç½®ï¼š
- åº”ç”¨æœåŠ¡å™¨ï¼š4æ ¸8Gå†…å­˜ï¼Œ3ä¸ªå®ä¾‹
- æ•°æ®åº“ï¼š8æ ¸16Gå†…å­˜ï¼Œä¸»ä»éƒ¨ç½²
- Redisï¼š4æ ¸8Gå†…å­˜ï¼Œé›†ç¾¤æ¨¡å¼
- è´Ÿè½½å‡è¡¡ï¼šNginxåå‘ä»£ç†
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQé›†ç¾¤

ç½‘ç»œç¯å¢ƒï¼š
- æµ‹è¯•æœºä¸è¢«æµ‹ç³»ç»Ÿåœ¨åŒä¸€ç½‘æ®µ
- æ’é™¤ç½‘ç»œå»¶è¿Ÿå¯¹ç»“æœçš„å½±å“
```

### 10.3 æ ¸å¿ƒæ¥å£å‹åŠ›æµ‹è¯•


**ğŸ”¸ ç”¨æˆ·ç™»å½•æ¥å£æµ‹è¯•**
```javascript
// JMeteræµ‹è¯•è®¡åˆ’
Thread Group {
    çº¿ç¨‹æ•°: 1000
    Ramp-Upæ—¶é—´: 60ç§’ (1åˆ†é’Ÿå†…å¯åŠ¨1000ä¸ªçº¿ç¨‹)
    å¾ªç¯æ¬¡æ•°: 10
}

HTTPè¯·æ±‚ {
    æœåŠ¡å™¨: api.ecommerce.com
    ç«¯å£: 80
    è·¯å¾„: /api/users/login
    æ–¹æ³•: POST
    å‚æ•°: {
        "username": "user${__threadNum}",
        "password": "123456"
    }
}

æ–­è¨€ {
    å“åº”ä»£ç : 200
    å“åº”æ—¶é—´: < 500ms
    å“åº”å†…å®¹åŒ…å«: "success"
}
```

**æµ‹è¯•ç»“æœåˆ†æ**ï¼š
```
ç™»å½•æ¥å£æµ‹è¯•ç»“æœï¼š
å¹¶å‘ç”¨æˆ·æ•°: 1000
æ€»è¯·æ±‚æ•°: 10000
æˆåŠŸç‡: 99.8%
å¹³å‡å“åº”æ—¶é—´: 245ms
90%å“åº”æ—¶é—´: 380ms
95%å“åº”æ—¶é—´: 450ms
æœ€å¤§å“åº”æ—¶é—´: 1200ms
TPS: 2000/ç§’
```

### 10.4 ä¸‹å•æµç¨‹å‹åŠ›æµ‹è¯•


**ğŸ”¸ ä¸‹å•æ¥å£æµ‹è¯•è„šæœ¬**
```java
// æ¨¡æ‹ŸçœŸå®ä¸‹å•æµç¨‹çš„æµ‹è¯•è„šæœ¬
@Test
public class OrderLoadTest {
    
    @Test
    public void testCreateOrder() throws Exception {
        // 1. ç”¨æˆ·ç™»å½•è·å–token
        String token = loginAndGetToken("testuser", "password");
        
        // 2. æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
        addToCart(token, 123L, 2);
        addToCart(token, 456L, 1);
        
        // 3. åˆ›å»ºè®¢å•
        long startTime = System.currentTimeMillis();
        String orderNo = createOrder(token, getCartItems());
        long endTime = System.currentTimeMillis();
        
        // 4. éªŒè¯ç»“æœ
        assertTrue("è®¢å•åˆ›å»ºå¤±è´¥", orderNo != null);
        assertTrue("å“åº”æ—¶é—´è¶…è¿‡1ç§’", (endTime - startTime) < 1000);
        
        // 5. éªŒè¯åº“å­˜æ˜¯å¦æ­£ç¡®æ‰£å‡
        verifyStockDeduction(123L, 2);
        verifyStockDeduction(456L, 1);
    }
}
```

### 10.5 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–


**ğŸ”¸ æ…¢æŸ¥è¯¢åˆ†æ**
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 1;
SET GLOBAL long_query_time = 0.5; -- æŸ¥è¯¢æ—¶é—´è¶…è¿‡0.5ç§’è®°å½•

-- åˆ†ææ…¢æŸ¥è¯¢
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM mysql.slow_log 
ORDER BY query_time DESC 
LIMIT 10;

-- å¸¸è§çš„æ…¢æŸ¥è¯¢ä¼˜åŒ–
-- 1. è®¢å•æŸ¥è¯¢æ·»åŠ ç´¢å¼•
CREATE INDEX idx_user_create_time ON t_order(user_id, create_time);

-- 2. å•†å“æœç´¢æ·»åŠ å…¨æ–‡ç´¢å¼•
ALTER TABLE t_product ADD FULLTEXT(name, description);

-- 3. åº“å­˜æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_product_stock ON t_stock(product_id, available_stock);
```

**ğŸ”¸ æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–**
```yaml
# æ•°æ®åº“è¿æ¥æ± é…ç½®
spring:
  datasource:
    hikari:
      maximum-pool-size: 50        # æœ€å¤§è¿æ¥æ•°
      minimum-idle: 10             # æœ€å°ç©ºé—²è¿æ¥æ•°
      connection-timeout: 30000    # è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)
      idle-timeout: 600000         # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´
      max-lifetime: 1800000        # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´
      leak-detection-threshold: 60000 # è¿æ¥æ³„éœ²æ£€æµ‹é˜ˆå€¼
```

### 10.6 ç¼“å­˜æ€§èƒ½æµ‹è¯•


**ğŸ”¸ Redisç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•**
```java
@Component
public class CachePerformanceMonitor {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
    public void monitorCacheHitRate() {
        RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();
        
        // è·å–Redisç»Ÿè®¡ä¿¡æ¯
        Properties info = connection.info("stats");
        
        long keyspaceHits = Long.parseLong(info.getProperty("keyspace_hits"));
        long keyspaceMisses = Long.parseLong(info.getProperty("keyspace_misses"));
        
        double hitRate = (double) keyspaceHits / (keyspaceHits + keyspaceMisses) * 100;
        
        logger.info("Redisç¼“å­˜å‘½ä¸­ç‡: {:.2f}%", hitRate);
        logger.info("ç¼“å­˜å‘½ä¸­æ¬¡æ•°: {}, ç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°: {}", keyspaceHits, keyspaceMisses);
        
        // å‘½ä¸­ç‡ä½äº80%éœ€è¦ä¼˜åŒ–
        if (hitRate < 80) {
            logger.warn("ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½ï¼Œéœ€è¦ä¼˜åŒ–ç¼“å­˜ç­–ç•¥");
        }
    }
}
```

### 10.7 ç³»ç»Ÿç›‘æ§ä¸å‘Šè­¦


**ğŸ”¸ JVMæ€§èƒ½ç›‘æ§**
```java
@Component
public class SystemMonitor {
    
    private final MeterRegistry meterRegistry;
    
    public SystemMonitor(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        
        // æ³¨å†ŒJVMç›‘æ§æŒ‡æ ‡
        new JvmMemoryMetrics().bindTo(meterRegistry);
        new JvmGcMetrics().bindTo(meterRegistry);
        new JvmThreadMetrics().bindTo(meterRegistry);
    }
    
    // è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
    @EventListener
    public void onOrderCreated(OrderCreatedEvent event) {
        // è®¢å•åˆ›å»ºæ¬¡æ•°è®¡æ•°
        meterRegistry.counter("orders.created.count").increment();
        
        // è®¢å•é‡‘é¢ç»Ÿè®¡
        meterRegistry.counter("orders.amount.total").increment(event.getAmount().doubleValue());
    }
    
    // æ¥å£å“åº”æ—¶é—´ç›‘æ§
    @Around("@annotation(org.springframework.web.bind.annotation.RequestMapping)")
    public Object monitorApiResponse(ProceedingJoinPoint joinPoint) throws Throwable {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            Object result = joinPoint.proceed();
            
            // è®°å½•æˆåŠŸè¯·æ±‚
            sample.stop(Timer.builder("api.response.time")
                .tag("method", joinPoint.getSignature().getName())
                .tag("status", "success")
                .register(meterRegistry));
                
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥è¯·æ±‚
            sample.stop(Timer.builder("api.response.time")
                .tag("method", joinPoint.getSignature().getName())
                .tag("status", "error")
                .register(meterRegistry));
                
            throw e;
        }
    }
}
```

### 10.8 æ€§èƒ½æµ‹è¯•ç»“æœä¸ä¼˜åŒ–å»ºè®®


**ğŸ”¸ å‹åŠ›æµ‹è¯•ç»¼åˆç»“æœ**

| æ¥å£åç§° | å¹¶å‘æ•° | TPS | å¹³å‡å“åº”æ—¶é—´ | 95%å“åº”æ—¶é—´ | æˆåŠŸç‡ | ä¼˜åŒ–å»ºè®® |
|---------|-------|-----|-------------|------------|--------|----------|
| **ç”¨æˆ·ç™»å½•** | `1000` | `2000` | `245ms` | `450ms` | `99.8%` | âœ… æ€§èƒ½è‰¯å¥½ |
| **å•†å“æœç´¢** | `800` | `1500` | `180ms` | `320ms` | `99.9%` | âœ… æ€§èƒ½è‰¯å¥½ |
| **æ·»åŠ è´­ç‰©è½¦** | `1200` | `3000` | `85ms` | `150ms` | `99.9%` | âœ… æ€§èƒ½è‰¯å¥½ |
| **åˆ›å»ºè®¢å•** | `500` | `800` | `680ms` | `1200ms` | `98.5%` | âš ï¸ éœ€è¦ä¼˜åŒ– |
| **æ”¯ä»˜æ¥å£** | `300` | `600` | `450ms` | `800ms` | `99.2%` | âœ… å¯æ¥å— |

**ğŸ”¸ æ€§èƒ½ç“¶é¢ˆåˆ†æ**
```
ä¸»è¦ç“¶é¢ˆï¼š
1. åˆ›å»ºè®¢å•æ¥å£å“åº”æ—¶é—´è¿‡é•¿
   åŸå› ï¼šæ¶‰åŠå¤šä¸ªæœåŠ¡è°ƒç”¨ï¼Œæ•°æ®åº“äº‹åŠ¡è¾ƒå¤æ‚
   ä¼˜åŒ–ï¼šå¼‚æ­¥å¤„ç†ã€ç¼“å­˜é¢„çƒ­ã€ç´¢å¼•ä¼˜åŒ–

2. æ•°æ®åº“è¿æ¥æ± æ»¡
   åŸå› ï¼šé«˜å¹¶å‘ä¸‹è¿æ¥æ•°ä¸å¤Ÿ
   ä¼˜åŒ–ï¼šå¢åŠ è¿æ¥æ± å¤§å°ï¼Œä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡

3. Rediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
   åŸå› ï¼šç¼“å­˜æ•°æ®è¿‡å¤šï¼Œæ¸…ç†ç­–ç•¥ä¸åˆç†
   ä¼˜åŒ–ï¼šè°ƒæ•´è¿‡æœŸæ—¶é—´ï¼Œå®ç°LRUæ·˜æ±°
```

**ğŸ”¸ ç³»ç»Ÿä¼˜åŒ–å»ºè®®**

**æ•°æ®åº“ä¼˜åŒ–**ï¼š
```sql
-- åˆ†è¡¨ç­–ç•¥ï¼šè®¢å•è¡¨æŒ‰æœˆåˆ†è¡¨
CREATE TABLE t_order_202401 LIKE t_order;
CREATE TABLE t_order_202402 LIKE t_order;

-- è¯»å†™åˆ†ç¦»ï¼šæŸ¥è¯¢èµ°ä»åº“
@Transactional(readOnly = true)
public List<Order> getUserOrders(Long userId) {
    // è‡ªåŠ¨è·¯ç”±åˆ°ä»åº“
    return orderMapper.selectByUserId(userId);
}
```

**ç¼“å­˜ä¼˜åŒ–**ï¼š
```java
// å¤šçº§ç¼“å­˜ç­–ç•¥
@Service
public class ProductService {
    
    // L1ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜(Caffeine)
    @Cacheable(value = "products", key = "#productId")
    public Product getProduct(Long productId) {
        // L2ç¼“å­˜ï¼šRedisç¼“å­˜
        Product product = redisTemplate.opsForValue().get("product:" + productId);
        if (product == null) {
            // L3ç¼“å­˜ï¼šæ•°æ®åº“
            product = productMapper.selectById(productId);
            redisTemplate.opsForValue().set("product:" + productId, product, 30, TimeUnit.MINUTES);
        }
        return product;
    }
}
```

**å¼‚æ­¥å¤„ç†ä¼˜åŒ–**ï¼š
```java
// è®¢å•åˆ›å»ºå¼‚æ­¥åŒ–
@Service
public class OrderService {
    
    @Async("orderExecutor")
    public CompletableFuture<Void> processOrderAsync(String orderNo) {
        // å¼‚æ­¥å¤„ç†åº“å­˜æ‰£å‡
        CompletableFuture<Void> stockFuture = CompletableFuture.runAsync(() -> {
            stockService.deductStock(orderNo);
        });
        
        // å¼‚æ­¥å‘é€é€šçŸ¥
        CompletableFuture<Void> notifyFuture = CompletableFuture.runAsync(() -> {
            notificationService.sendOrderNotification(orderNo);
        });
        
        // ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆ
        return CompletableFuture.allOf(stockFuture, notifyFuture);
    }
}
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### ğŸ¯ å¾®æœåŠ¡æ‹†åˆ†æ ¸å¿ƒåŸåˆ™

```
ä¸šåŠ¡è¾¹ç•Œæ¸…æ™°ï¼šæ¯ä¸ªæœåŠ¡è´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
æ•°æ®ç‹¬ç«‹ï¼šæ¯ä¸ªæœåŠ¡æœ‰è‡ªå·±çš„æ•°æ®åº“
æ¥å£æ ‡å‡†ï¼šæœåŠ¡é—´é€šè¿‡æ ‡å‡†APIé€šä¿¡
å¯ç‹¬ç«‹éƒ¨ç½²ï¼šå•ä¸ªæœåŠ¡çš„ä¿®æ”¹ä¸å½±å“å…¶ä»–æœåŠ¡
å›¢é˜Ÿè‡ªæ²»ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥ç”±ç‹¬ç«‹å›¢é˜Ÿç»´æŠ¤
```

### ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

```
æœåŠ¡æ³¨å†Œå‘ç°ï¼šä½¿ç”¨Eurekaå®ç°æœåŠ¡è‡ªåŠ¨å‘ç°
æœåŠ¡è°ƒç”¨ï¼šä½¿ç”¨OpenFeignç®€åŒ–HTTPè°ƒç”¨
è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨Ribbonå®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡
æ–­è·¯å™¨ï¼šä½¿ç”¨Hystrixå®ç°æœåŠ¡å®¹é”™
é…ç½®ç®¡ç†ï¼šä½¿ç”¨Config Serveré›†ä¸­ç®¡ç†é…ç½®
é“¾è·¯è¿½è¸ªï¼šä½¿ç”¨Sleuth + Zipkinè¿½è¸ªè°ƒç”¨é“¾
```

### ğŸ’¡ æ•°æ®ä¸€è‡´æ€§ä¿éšœ

```
å¼ºä¸€è‡´æ€§ï¼šTCCä¸¤é˜¶æ®µæäº¤ï¼Œé€‚ç”¨äºæ ¸å¿ƒä¸šåŠ¡
æœ€ç»ˆä¸€è‡´æ€§ï¼šæ¶ˆæ¯é˜Ÿåˆ— + æœ¬åœ°æ¶ˆæ¯è¡¨ï¼Œé€‚ç”¨äºå¤§éƒ¨åˆ†åœºæ™¯
è¡¥å¿æœºåˆ¶ï¼šä¸šåŠ¡é€»è¾‘è¡¥å¿ï¼Œå¤„ç†å¼‚å¸¸æƒ…å†µ
å¹‚ç­‰æ€§ï¼šé˜²æ­¢é‡å¤å¤„ç†ï¼Œä½¿ç”¨å”¯ä¸€æ ‡è¯†
```

### ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```
ç¼“å­˜ç­–ç•¥ï¼šå¤šçº§ç¼“å­˜ï¼ŒRedis + æœ¬åœ°ç¼“å­˜
æ•°æ®åº“ä¼˜åŒ–ï¼šç´¢å¼•ä¼˜åŒ–ã€åˆ†è¡¨åˆ†åº“ã€è¯»å†™åˆ†ç¦»
å¼‚æ­¥å¤„ç†ï¼šæ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥åŒ–å¤„ç†è€—æ—¶æ“ä½œ
è¿æ¥æ± ä¼˜åŒ–ï¼šåˆç†é…ç½®æ•°æ®åº“å’ŒRedisè¿æ¥æ± 
ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
```

### ğŸ” å®é™…é¡¹ç›®ç»éªŒ

```
æœåŠ¡æ‹†åˆ†ä¸è¦è¿‡åº¦ï¼šé¿å…å¾®æœåŠ¡è¿‡å¤šå¯¼è‡´ç®¡ç†å¤æ‚
æ•°æ®ä¸€è‡´æ€§æƒè¡¡ï¼šæ ¹æ®ä¸šåŠ¡é‡è¦æ€§é€‰æ‹©åˆé€‚æ–¹æ¡ˆ
æ€§èƒ½æµ‹è¯•å¿…è¦ï¼šä¸Šçº¿å‰å¿…é¡»è¿›è¡Œå……åˆ†çš„å‹åŠ›æµ‹è¯•
ç›‘æ§ä½“ç³»å®Œå–„ï¼šå»ºç«‹å®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
å›¢é˜Ÿåä½œè§„èŒƒï¼šåˆ¶å®šæ¸…æ™°çš„æœåŠ¡é—´åä½œè§„èŒƒ
```

**è®°å¿†è¦ç‚¹**ï¼š
- å¾®æœåŠ¡æ¶æ„ = ä¸šåŠ¡æ‹†åˆ† + æŠ€æœ¯ç»„åˆ
- æ•°æ®ä¸€è‡´æ€§ = ä¸šåŠ¡éœ€æ±‚ + æŠ€æœ¯æƒè¡¡  
- æ€§èƒ½ä¼˜åŒ– = å¤šç»´åº¦ä¼˜åŒ– + æŒç»­ç›‘æ§
- å®é™…åº”ç”¨ = ç†è®ºå­¦ä¹  + é¡¹ç›®å®è·µ