---
title: 4ã€refè½¬å‘ä¸é«˜çº§é€šä¿¡
---
## ğŸ“š ç›®å½•

1. [refè½¬å‘åŸºç¡€æ¦‚å¿µ](#1-refè½¬å‘åŸºç¡€æ¦‚å¿µ)
2. [forwardRefè¯¦è§£ä¸åº”ç”¨](#2-forwardRefè¯¦è§£ä¸åº”ç”¨)
3. [useImperativeHandleé«˜çº§æ§åˆ¶](#3-useImperativeHandleé«˜çº§æ§åˆ¶)
4. [çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•](#4-çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•)
5. [äº‹ä»¶æ€»çº¿é€šä¿¡æœºåˆ¶](#5-äº‹ä»¶æ€»çº¿é€šä¿¡æœºåˆ¶)
6. [é«˜é˜¶ç»„ä»¶é€šä¿¡æ¨¡å¼](#6-é«˜é˜¶ç»„ä»¶é€šä¿¡æ¨¡å¼)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ refè½¬å‘åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯refè½¬å‘ï¼Ÿ


**é€šä¿—ç†è§£**ï¼šrefè½¬å‘å°±åƒæ˜¯**"ä¼ å£°ç­’"**ï¼Œè®©çˆ·çˆ·èƒ½ç›´æ¥å’Œå­™å­è¯´è¯ï¼Œä¸ç”¨é€šè¿‡çˆ¸çˆ¸ä¸­è½¬ã€‚

```
æ­£å¸¸æƒ…å†µï¼šçˆ·çˆ· â†’ çˆ¸çˆ¸ â†’ å­™å­
refè½¬å‘ï¼šçˆ·çˆ· â†’ â†’ â†’ å­™å­ï¼ˆè·³è¿‡çˆ¸çˆ¸ï¼‰
```

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šrefè½¬å‘å…è®¸çˆ¶ç»„ä»¶ç›´æ¥è®¿é—®å­™å­ç»„ä»¶çš„DOMå…ƒç´ æˆ–å®ä¾‹ï¼Œè·³è¿‡ä¸­é—´çš„å­ç»„ä»¶ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦refè½¬å‘ï¼Ÿ


**é—®é¢˜åœºæ™¯**ï¼š
```
Appç»„ä»¶æƒ³è¦æ§åˆ¶Inputç»„ä»¶é‡Œé¢çš„inputæ ‡ç­¾
App â†’ MyButton â†’ inputæ ‡ç­¾
```

**ä¼ ç»Ÿæ–¹å¼çš„é™åˆ¶**ï¼š
- âœ… Appå¯ä»¥æ‹¿åˆ°MyButtonçš„ref
- âŒ Appæ— æ³•æ‹¿åˆ°MyButtonå†…éƒ¨inputçš„ref
- ğŸ˜• éœ€è¦å±‚å±‚ä¼ é€’ï¼Œå¾ˆéº»çƒ¦

**refè½¬å‘çš„ä¼˜åŠ¿**ï¼š
- ğŸ¯ **ç›´æ¥è®¿é—®**ï¼šè·³è¿‡ä¸­é—´ç»„ä»¶ï¼Œç›´è¾¾ç›®æ ‡
- ğŸ”§ **ç®€åŒ–æ“ä½œ**ï¼šä¸ç”¨å†™é¢å¤–çš„ä¼ é€’é€»è¾‘
- ğŸ¨ **æ›´æ¸…æ™°**ï¼šä»£ç æ„å›¾æ›´æ˜ç¡®

### 1.3 refè½¬å‘çš„å·¥ä½œåŸç†


```
æ™®é€šæƒ…å†µä¸‹çš„refæµåŠ¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ref    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çˆ¶ç»„ä»¶   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ å­ç»„ä»¶    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                      æ— æ³•ç»§ç»­å‘ä¸‹ä¼ é€’

ä½¿ç”¨forwardRefåçš„refæµåŠ¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ref    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ref    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çˆ¶ç»„ä»¶   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ å­ç»„ä»¶    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ DOMå…ƒç´    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ forwardRefè¯¦è§£ä¸åº”ç”¨


### 2.1 forwardRefåŸºç¡€è¯­æ³•


**è¯­æ³•ç»“æ„**ï¼š
```jsx
const MyComponent = forwardRef((props, ref) => {
  // è¿™é‡Œçš„refå°±æ˜¯ä»çˆ¶ç»„ä»¶ä¼ ä¸‹æ¥çš„
  return <input ref={ref} />;
});
```

> ğŸ“ **å…³é”®ç†è§£**ï¼š`forwardRef`æŠŠç»„ä»¶åŒ…è£…ä¸€ä¸‹ï¼Œè®©å®ƒèƒ½æ¥æ”¶å¹¶è½¬å‘refå‚æ•°ã€‚

### 2.2 æœ€ç®€å•çš„refè½¬å‘ç¤ºä¾‹


```jsx
import { forwardRef, useRef } from 'react';

// ğŸ”¸ å­ç»„ä»¶ï¼šä½¿ç”¨forwardRefåŒ…è£…
const FancyInput = forwardRef((props, ref) => {
  return (
    <div>
      <label>ç”¨æˆ·åï¼š</label>
      <input ref={ref} type="text" />
    </div>
  );
});

// ğŸ”¸ çˆ¶ç»„ä»¶ï¼šæ­£å¸¸ä½¿ç”¨ref
function App() {
  const inputRef = useRef();
  
  const focusInput = () => {
    inputRef.current.focus(); // ç›´æ¥æ“ä½œinputå…ƒç´ 
  };
  
  return (
    <div>
      <FancyInput ref={inputRef} />
      <button onClick={focusInput}>èšç„¦è¾“å…¥æ¡†</button>
    </div>
  );
}
```

**å·¥ä½œæµç¨‹**ï¼š
1. âœ… Appç»„ä»¶åˆ›å»ºref
2. âœ… æŠŠrefä¼ ç»™FancyInput
3. âœ… FancyInputé€šè¿‡forwardRefæ¥æ”¶ref
4. âœ… FancyInputæŠŠrefè½¬å‘ç»™å†…éƒ¨çš„input
5. âœ… Appå¯ä»¥ç›´æ¥æ§åˆ¶inputå…ƒç´ 

### 2.3 å¸¦æ ·å¼çš„ç»„ä»¶refè½¬å‘


```jsx
const StyledButton = forwardRef(({ children, className, ...props }, ref) => {
  return (
    <button 
      ref={ref}
      className={`btn ${className || ''}`}
      {...props}
    >
      {children}
    </button>
  );
});

function App() {
  const btnRef = useRef();
  
  const changeButtonText = () => {
    btnRef.current.textContent = 'å·²ç‚¹å‡»ï¼';
  };
  
  return (
    <div>
      <StyledButton ref={btnRef} onClick={changeButtonText}>
        ç‚¹å‡»æˆ‘
      </StyledButton>
    </div>
  );
}
```

---

## 3. ğŸ›ï¸ useImperativeHandleé«˜çº§æ§åˆ¶


### 3.1 ä»€ä¹ˆæ˜¯useImperativeHandleï¼Ÿ


**é€šä¿—ç†è§£**ï¼š`useImperativeHandle`å°±åƒæ˜¯**"å®šåˆ¶é¥æ§å™¨"**ï¼Œå­ç»„ä»¶å†³å®šç»™çˆ¶ç»„ä»¶å“ªäº›æŒ‰é’®ï¼Œè€Œä¸æ˜¯æŠŠæ•´ä¸ªè®¾å¤‡éƒ½äº¤å‡ºå»ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼š`useImperativeHandle`è®©å­ç»„ä»¶è‡ªå®šä¹‰é€šè¿‡refæš´éœ²ç»™çˆ¶ç»„ä»¶çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ç›´æ¥æš´éœ²DOMå…ƒç´ ã€‚

### 3.2 ä¸ºä»€ä¹ˆéœ€è¦useImperativeHandleï¼Ÿ


**é—®é¢˜**ï¼šæ™®é€šrefè½¬å‘ä¼šæš´éœ²æ•´ä¸ªDOMå…ƒç´ 
```jsx
// çˆ¶ç»„ä»¶å¯ä»¥åšä»»ä½•äº‹æƒ…
inputRef.current.value = 'hack'; // ä¸å®‰å…¨
inputRef.current.style.display = 'none'; // å¯èƒ½ç ´åå¸ƒå±€
```

**è§£å†³æ–¹æ¡ˆ**ï¼šåªæš´éœ²éœ€è¦çš„æ–¹æ³•
```jsx
// åªèƒ½è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•
inputRef.current.focus(); // âœ… å…è®¸
inputRef.current.clear(); // âœ… å…è®¸  
inputRef.current.value;   // âŒ æ— æ³•ç›´æ¥è®¿é—®
```

### 3.3 useImperativeHandleåŸºç¡€ç”¨æ³•


```jsx
import { forwardRef, useImperativeHandle, useRef, useState } from 'react';

const CustomInput = forwardRef((props, ref) => {
  const inputRef = useRef();
  const [value, setValue] = useState('');
  
  // ğŸ¯ å®šåˆ¶æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ¥å£
  useImperativeHandle(ref, () => ({
    // åªæš´éœ²è¿™äº›æ–¹æ³•
    focus: () => {
      inputRef.current.focus();
    },
    clear: () => {
      setValue('');
      inputRef.current.value = '';
    },
    getValue: () => {
      return value;
    }
  }));
  
  return (
    <input 
      ref={inputRef}
      value={value}
      onChange={(e) => setValue(e.target.value)}
      placeholder="è¾“å…¥å†…å®¹..."
    />
  );
});

function App() {
  const customInputRef = useRef();
  
  return (
    <div>
      <CustomInput ref={customInputRef} />
      <div>
        <button onClick={() => customInputRef.current.focus()}>
          èšç„¦
        </button>
        <button onClick={() => customInputRef.current.clear()}>
          æ¸…ç©º
        </button>
        <button onClick={() => {
          const value = customInputRef.current.getValue();
          alert(`å½“å‰å€¼ï¼š${value}`);
        }}>
          è·å–å€¼
        </button>
      </div>
    </div>
  );
}
```

### 3.4 å®ç”¨çš„è¡¨å•ç»„ä»¶ç¤ºä¾‹


```jsx
const FormField = forwardRef(({ label, type = 'text' }, ref) => {
  const [value, setValue] = useState('');
  const [error, setError] = useState('');
  const inputRef = useRef();
  
  useImperativeHandle(ref, () => ({
    // ğŸ”¸ éªŒè¯æ–¹æ³•
    validate: () => {
      if (!value.trim()) {
        setError('æ­¤å­—æ®µä¸èƒ½ä¸ºç©º');
        return false;
      }
      setError('');
      return true;
    },
    
    // ğŸ”¸ è·å–æ•°æ®
    getValue: () => value,
    
    // ğŸ”¸ é‡ç½®å­—æ®µ
    reset: () => {
      setValue('');
      setError('');
    },
    
    // ğŸ”¸ èšç„¦
    focus: () => {
      inputRef.current.focus();
    }
  }));
  
  return (
    <div>
      <label>{label}</label>
      <input 
        ref={inputRef}
        type={type}
        value={value}
        onChange={(e) => setValue(e.target.value)}
      />
      {error && <span style={{color: 'red'}}>{error}</span>}
    </div>
  );
});

function App() {
  const nameRef = useRef();
  const emailRef = useRef();
  
  const handleSubmit = () => {
    const nameValid = nameRef.current.validate();
    const emailValid = emailRef.current.validate();
    
    if (nameValid && emailValid) {
      const formData = {
        name: nameRef.current.getValue(),
        email: emailRef.current.getValue()
      };
      console.log('æäº¤æ•°æ®ï¼š', formData);
    }
  };
  
  return (
    <form>
      <FormField ref={nameRef} label="å§“å" />
      <FormField ref={emailRef} label="é‚®ç®±" type="email" />
      <button type="button" onClick={handleSubmit}>æäº¤</button>
    </form>
  );
}
```

---

## 4. ğŸ“ çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•


### 4.1 è°ƒç”¨æ¨¡å¼å¯¹æ¯”


| æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|-------------|---------|---------|
| **Propså›è°ƒ** | `ç®€å•çš„äº‹ä»¶é€šçŸ¥` | `ç¬¦åˆReactç†å¿µ` | `åªèƒ½å‘ä¸Šä¼ é€’` |
| **refè°ƒç”¨** | `éœ€è¦æ§åˆ¶å­ç»„ä»¶è¡Œä¸º` | `ç›´æ¥è°ƒç”¨æ–¹ä¾¿` | `æ‰“ç ´å•å‘æ•°æ®æµ` |
| **Context** | `æ·±å±‚ç»„ä»¶é€šä¿¡` | `é¿å…propsé’»äº•` | `å¯èƒ½è¿‡åº¦ä½¿ç”¨` |

### 4.2 å®é™…åº”ç”¨ï¼šæ¨¡æ€æ¡†æ§åˆ¶


```jsx
const Modal = forwardRef(({ children }, ref) => {
  const [isOpen, setIsOpen] = useState(false);
  
  useImperativeHandle(ref, () => ({
    open: () => setIsOpen(true),
    close: () => setIsOpen(false),
    toggle: () => setIsOpen(!isOpen)
  }));
  
  if (!isOpen) return null;
  
  return (
    <div className="modal-overlay" onClick={() => setIsOpen(false)}>
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        {children}
        <button onClick={() => setIsOpen(false)}>å…³é—­</button>
      </div>
    </div>
  );
});

function App() {
  const modalRef = useRef();
  
  return (
    <div>
      <button onClick={() => modalRef.current.open()}>
        æ‰“å¼€æ¨¡æ€æ¡†
      </button>
      
      <Modal ref={modalRef}>
        <h2>è¿™æ˜¯æ¨¡æ€æ¡†å†…å®¹</h2>
        <p>å¯ä»¥æ”¾ä»»ä½•å†…å®¹</p>
      </Modal>
    </div>
  );
}
```

### 4.3 è®¡æ•°å™¨ç»„ä»¶æ§åˆ¶ç¤ºä¾‹


```jsx
const Counter = forwardRef((props, ref) => {
  const [count, setCount] = useState(0);
  
  useImperativeHandle(ref, () => ({
    increment: () => setCount(c => c + 1),
    decrement: () => setCount(c => c - 1),
    reset: () => setCount(0),
    getCount: () => count
  }));
  
  return (
    <div>
      <h3>è®¡æ•°ï¼š{count}</h3>
    </div>
  );
});

function App() {
  const counterRef = useRef();
  
  return (
    <div>
      <Counter ref={counterRef} />
      <div>
        <button onClick={() => counterRef.current.increment()}>+1</button>
        <button onClick={() => counterRef.current.decrement()}>-1</button>
        <button onClick={() => counterRef.current.reset()}>é‡ç½®</button>
        <button onClick={() => {
          const count = counterRef.current.getCount();
          alert(`å½“å‰è®¡æ•°ï¼š${count}`);
        }}>è·å–å€¼</button>
      </div>
    </div>
  );
}
```

---

## 5. ğŸšŒ äº‹ä»¶æ€»çº¿é€šä¿¡æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯äº‹ä»¶æ€»çº¿ï¼Ÿ


**é€šä¿—ç†è§£**ï¼šäº‹ä»¶æ€»çº¿å°±åƒ**"å¹¿æ’­ç”µå°"**ï¼Œä»»ä½•ç»„ä»¶éƒ½å¯ä»¥å‘é€æ¶ˆæ¯ï¼Œä»»ä½•ç»„ä»¶éƒ½å¯ä»¥æ”¶å¬æ¶ˆæ¯ã€‚

```
ä¼ ç»Ÿç»„ä»¶é€šä¿¡ï¼š
Aç»„ä»¶ â†’ çˆ¶ç»„ä»¶ â†’ ç¥–çˆ¶ç»„ä»¶ â†’ çˆ¶ç»„ä»¶ â†’ Bç»„ä»¶

äº‹ä»¶æ€»çº¿é€šä¿¡ï¼š
Aç»„ä»¶ â†’ äº‹ä»¶æ€»çº¿ â†’ Bç»„ä»¶
```

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šäº‹ä»¶æ€»çº¿æ˜¯ä¸€ä¸ªå…¨å±€çš„æ¶ˆæ¯ä¸­å¿ƒï¼Œç»„ä»¶å¯ä»¥å‘å¸ƒäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥è®¢é˜…äº‹ä»¶ï¼Œå®ç°ä»»æ„ç»„ä»¶é—´çš„é€šä¿¡ã€‚

### 5.2 ç®€æ˜“äº‹ä»¶æ€»çº¿å®ç°


```jsx
// ğŸ”¸ åˆ›å»ºäº‹ä»¶æ€»çº¿ç±»
class EventBus {
  constructor() {
    this.events = {}; // å­˜å‚¨æ‰€æœ‰äº‹ä»¶
  }
  
  // è®¢é˜…äº‹ä»¶ï¼ˆç›‘å¬ï¼‰
  on(eventName, callback) {
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    this.events[eventName].push(callback);
  }
  
  // å‘å¸ƒäº‹ä»¶ï¼ˆè§¦å‘ï¼‰
  emit(eventName, data) {
    if (this.events[eventName]) {
      this.events[eventName].forEach(callback => {
        callback(data);
      });
    }
  }
  
  // å–æ¶ˆè®¢é˜…
  off(eventName, callback) {
    if (this.events[eventName]) {
      this.events[eventName] = this.events[eventName].filter(
        cb => cb !== callback
      );
    }
  }
}

// ğŸ”¸ åˆ›å»ºå…¨å±€äº‹ä»¶æ€»çº¿å®ä¾‹
const eventBus = new EventBus();
export default eventBus;
```

### 5.3 äº‹ä»¶æ€»çº¿ä½¿ç”¨ç¤ºä¾‹


```jsx
import { useState, useEffect } from 'react';
import eventBus from './eventBus';

// ğŸ”¸ å‘é€æ¶ˆæ¯çš„ç»„ä»¶
function Sender() {
  const [message, setMessage] = useState('');
  
  const sendMessage = () => {
    if (message.trim()) {
      eventBus.emit('message', {
        text: message,
        time: new Date().toLocaleTimeString()
      });
      setMessage('');
    }
  };
  
  return (
    <div>
      <h3>å‘é€æ–¹</h3>
      <input 
        value={message}
        onChange={(e) => setMessage(e.target.value)}
        placeholder="è¾“å…¥æ¶ˆæ¯..."
      />
      <button onClick={sendMessage}>å‘é€</button>
    </div>
  );
}

// ğŸ”¸ æ¥æ”¶æ¶ˆæ¯çš„ç»„ä»¶
function Receiver() {
  const [messages, setMessages] = useState([]);
  
  useEffect(() => {
    // è®¢é˜…æ¶ˆæ¯äº‹ä»¶
    const handleMessage = (data) => {
      setMessages(prev => [...prev, data]);
    };
    
    eventBus.on('message', handleMessage);
    
    // æ¸…ç†è®¢é˜…
    return () => {
      eventBus.off('message', handleMessage);
    };
  }, []);
  
  return (
    <div>
      <h3>æ¥æ”¶æ–¹</h3>
      <div>
        {messages.map((msg, index) => (
          <div key={index}>
            <strong>{msg.time}</strong>: {msg.text}
          </div>
        ))}
      </div>
    </div>
  );
}

// ğŸ”¸ ä¸»åº”ç”¨
function App() {
  return (
    <div>
      <Sender />
      <hr />
      <Receiver />
    </div>
  );
}
```

### 5.4 è´­ç‰©è½¦äº‹ä»¶æ€»çº¿ç¤ºä¾‹


```jsx
// ğŸ”¸ å•†å“ç»„ä»¶
function Product({ id, name, price }) {
  const addToCart = () => {
    eventBus.emit('addToCart', { id, name, price });
  };
  
  return (
    <div className="product">
      <h4>{name}</h4>
      <p>ä»·æ ¼ï¼šÂ¥{price}</p>
      <button onClick={addToCart}>åŠ å…¥è´­ç‰©è½¦</button>
    </div>
  );
}

// ğŸ”¸ è´­ç‰©è½¦ç»„ä»¶  
function Cart() {
  const [items, setItems] = useState([]);
  
  useEffect(() => {
    const handleAddToCart = (product) => {
      setItems(prev => {
        const existing = prev.find(item => item.id === product.id);
        if (existing) {
          return prev.map(item => 
            item.id === product.id 
              ? { ...item, quantity: item.quantity + 1 }
              : item
          );
        }
        return [...prev, { ...product, quantity: 1 }];
      });
    };
    
    eventBus.on('addToCart', handleAddToCart);
    return () => eventBus.off('addToCart', handleAddToCart);
  }, []);
  
  const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  
  return (
    <div>
      <h3>è´­ç‰©è½¦</h3>
      {items.map(item => (
        <div key={item.id}>
          {item.name} x {item.quantity} = Â¥{item.price * item.quantity}
        </div>
      ))}
      <strong>æ€»è®¡ï¼šÂ¥{total}</strong>
    </div>
  );
}

function App() {
  return (
    <div>
      <div style={{ display: 'flex', gap: '20px' }}>
        <div>
          <h2>å•†å“åˆ—è¡¨</h2>
          <Product id={1} name="iPhone" price={5999} />
          <Product id={2} name="iPad" price={3999} />
        </div>
        <Cart />
      </div>
    </div>
  );
}
```

---

## 6. ğŸ”— é«˜é˜¶ç»„ä»¶é€šä¿¡æ¨¡å¼


### 6.1 ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ï¼Ÿ


**é€šä¿—ç†è§£**ï¼šé«˜é˜¶ç»„ä»¶å°±åƒ**"è£…é¥°å™¨"**ï¼Œç»™åŸæ¥çš„ç»„ä»¶æ·»åŠ æ–°åŠŸèƒ½ï¼Œå°±åƒç»™æ‰‹æœºè´´è†œã€åŠ å£³ä¸€æ ·ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šé«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¢å¼ºåçš„æ–°ç»„ä»¶ã€‚

### 6.2 é«˜é˜¶ç»„ä»¶åŸºç¡€æ¨¡å¼


```jsx
// ğŸ”¸ é«˜é˜¶ç»„ä»¶ï¼šæ·»åŠ åŠ è½½çŠ¶æ€
function withLoading(WrappedComponent) {
  return function LoadingComponent(props) {
    const [loading, setLoading] = useState(false);
    
    // å¢å¼ºçš„æ–¹æ³•
    const showLoading = () => setLoading(true);
    const hideLoading = () => setLoading(false);
    
    if (loading) {
      return <div>åŠ è½½ä¸­...</div>;
    }
    
    // æŠŠå¢å¼ºçš„æ–¹æ³•ä¼ ç»™åŸç»„ä»¶
    return (
      <WrappedComponent 
        {...props}
        showLoading={showLoading}
        hideLoading={hideLoading}
      />
    );
  };
}

// ğŸ”¸ ä½¿ç”¨é«˜é˜¶ç»„ä»¶
const UserList = withLoading(({ users, showLoading, hideLoading }) => {
  const loadUsers = async () => {
    showLoading();
    // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
    setTimeout(() => {
      hideLoading();
    }, 2000);
  };
  
  return (
    <div>
      <button onClick={loadUsers}>åŠ è½½ç”¨æˆ·</button>
      <div>ç”¨æˆ·åˆ—è¡¨å†…å®¹...</div>
    </div>
  );
});
```

### 6.3 æƒé™æ§åˆ¶é«˜é˜¶ç»„ä»¶


```jsx
// ğŸ”¸ æƒé™æ£€æŸ¥HOC
function withAuth(WrappedComponent, requiredRole = 'user') {
  return function AuthComponent(props) {
    const [user, setUser] = useState({ role: 'guest' });
    
    const login = (role) => {
      setUser({ role });
    };
    
    const logout = () => {
      setUser({ role: 'guest' });
    };
    
    // æƒé™æ£€æŸ¥
    const hasPermission = user.role === requiredRole || user.role === 'admin';
    
    if (!hasPermission) {
      return (
        <div>
          <p>éœ€è¦ {requiredRole} æƒé™æ‰èƒ½è®¿é—®</p>
          <button onClick={() => login('user')}>ç™»å½•ä¸ºç”¨æˆ·</button>
          <button onClick={() => login('admin')}>ç™»å½•ä¸ºç®¡ç†å‘˜</button>
        </div>
      );
    }
    
    return (
      <WrappedComponent 
        {...props}
        user={user}
        logout={logout}
      />
    );
  };
}

// ğŸ”¸ å—ä¿æŠ¤çš„ç»„ä»¶
const AdminPanel = withAuth(({ user, logout }) => {
  return (
    <div>
      <h2>ç®¡ç†å‘˜é¢æ¿</h2>
      <p>æ¬¢è¿ {user.role}</p>
      <button onClick={logout}>é€€å‡ºç™»å½•</button>
    </div>
  );
}, 'admin');

const UserDashboard = withAuth(({ user, logout }) => {
  return (
    <div>
      <h2>ç”¨æˆ·ä»ªè¡¨æ¿</h2>
      <p>æ¬¢è¿ {user.role}</p>
      <button onClick={logout}>é€€å‡ºç™»å½•</button>
    </div>
  );
}, 'user');
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 é€šä¿¡æ–¹å¼é€‰æ‹©æŒ‡å—


| é€šä¿¡åœºæ™¯ | **æ¨èæ–¹å¼** | **ä¼˜åŠ¿** | **æ³¨æ„ç‚¹** |
|---------|-------------|---------|----------|
| **çˆ¶â†’å­ä¼ å€¼** | `Props` | `ç®€å•ç›´æ¥` | `å•å‘æ•°æ®æµ` |
| **å­â†’çˆ¶ä¼ å€¼** | `å›è°ƒå‡½æ•°` | `ç¬¦åˆReactç†å¿µ` | `å±‚çº§ä¸èƒ½å¤ªæ·±` |
| **çˆ¶æ“ä½œå­DOM** | `ref + forwardRef` | `ç›´æ¥æ“ä½œ` | `å°‘ç”¨ï¼Œç ´åå°è£…` |
| **çˆ¶è°ƒç”¨å­æ–¹æ³•** | `useImperativeHandle` | `å®‰å…¨å¯æ§` | `å®šä¹‰æ¸…æ™°æ¥å£` |
| **è·¨ç»„ä»¶é€šä¿¡** | `äº‹ä»¶æ€»çº¿` | `ç®€å•çµæ´»` | `æ³¨æ„æ¸…ç†è®¢é˜…` |
| **æ·±å±‚åµŒå¥—é€šä¿¡** | `Context` | `é¿å…propsé’»äº•` | `ä¸è¦æ»¥ç”¨` |

### 7.2 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ refè½¬å‘ï¼šè®©çˆ¶ç»„ä»¶è·¨è¿‡å­ç»„ä»¶ç›´æ¥è®¿é—®DOM
ğŸ”¸ forwardRefï¼šå®ç°refè½¬å‘çš„æ ¸å¿ƒAPI
ğŸ”¸ useImperativeHandleï¼šè‡ªå®šä¹‰refæš´éœ²çš„æ¥å£
ğŸ”¸ äº‹ä»¶æ€»çº¿ï¼šå…¨å±€æ¶ˆæ¯é€šä¿¡æœºåˆ¶
ğŸ”¸ é«˜é˜¶ç»„ä»¶ï¼šå¢å¼ºç»„ä»¶åŠŸèƒ½çš„è®¾è®¡æ¨¡å¼
```

### 7.3 æœ€ä½³å®è·µè¦ç‚¹


**ğŸ”¹ refä½¿ç”¨åŸåˆ™**ï¼š
- âœ… **èšç„¦ã€æ»šåŠ¨ã€åŠ¨ç”»**ï¼šé€‚åˆç”¨ref
- âœ… **ç¬¬ä¸‰æ–¹DOMåº“é›†æˆ**ï¼šå¿…é¡»ç”¨ref
- âŒ **æ•°æ®ä¼ é€’**ï¼šåº”è¯¥ç”¨props
- âŒ **é¢‘ç¹ä½¿ç”¨**ï¼šå¯èƒ½è®¾è®¡æœ‰é—®é¢˜

**ğŸ”¹ äº‹ä»¶æ€»çº¿æ³¨æ„äº‹é¡¹**ï¼š
- ğŸ¯ **è®¢é˜…è¦æ¸…ç†**ï¼šé¿å…å†…å­˜æ³„æ¼
- ğŸ¯ **äº‹ä»¶åè¦è§„èŒƒ**ï¼šé¿å…å†²çª
- ğŸ¯ **ä¸è¦æ»¥ç”¨**ï¼šç®€å•é€šä¿¡ç”¨props

**ğŸ”¹ é«˜é˜¶ç»„ä»¶è¦ç‚¹**ï¼š
- ğŸ’¡ **ä¿æŒåŸç»„ä»¶props**ï¼šé€ä¼ æ‰€æœ‰props
- ğŸ’¡ **å‘½åè¦æ¸…æ™°**ï¼šä¾¿äºè°ƒè¯•
- ğŸ’¡ **é¿å…è¿‡åº¦åµŒå¥—**ï¼šå½±å“æ€§èƒ½

### 7.4 å®é™…åº”ç”¨åœºæ™¯


- **ğŸ¬ æ¨¡æ€æ¡†æ§åˆ¶**ï¼šçˆ¶ç»„ä»¶æ§åˆ¶æ¨¡æ€æ¡†å¼€å…³
- **ğŸ“ è¡¨å•éªŒè¯**ï¼šçˆ¶ç»„ä»¶è§¦å‘å­ç»„ä»¶éªŒè¯  
- **ğŸ›’ è´­ç‰©è½¦æ›´æ–°**ï¼šå•†å“ç»„ä»¶é€šçŸ¥è´­ç‰©è½¦ç»„ä»¶
- **ğŸ” æƒé™æ§åˆ¶**ï¼šé«˜é˜¶ç»„ä»¶åŒ…è£…éœ€è¦æƒé™çš„é¡µé¢
- **ğŸ“± å…¨å±€é€šçŸ¥**ï¼šä»»ä½•ç»„ä»¶éƒ½èƒ½å‘é€é€šçŸ¥æ¶ˆæ¯

**æ ¸å¿ƒè®°å¿†**ï¼š
- refè½¬å‘å°±æ˜¯ä¼ å£°ç­’ï¼Œè·³è¿‡ä¸­é—´å±‚ç›´è¾¾ç›®æ ‡
- useImperativeHandleæ˜¯å®šåˆ¶é¥æ§å™¨ï¼Œåªæš´éœ²éœ€è¦çš„æŒ‰é’®
- äº‹ä»¶æ€»çº¿æ˜¯å¹¿æ’­ç”µå°ï¼Œä»»ä½•ç»„ä»¶éƒ½èƒ½å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
- é«˜é˜¶ç»„ä»¶æ˜¯è£…é¥°å™¨ï¼Œç»™åŸç»„ä»¶æ·»åŠ æ–°åŠŸèƒ½ä¸æ”¹å˜åŸæœ‰é€»è¾‘