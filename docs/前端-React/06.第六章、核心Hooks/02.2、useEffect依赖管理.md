---
title: 2ã€useEffectä¾èµ–ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [useEffectåŸºç¡€æ¦‚å¿µ](#1-useEffectåŸºç¡€æ¦‚å¿µ)
2. [ä¾èµ–æ•°ç»„è¯¦è§£](#2-ä¾èµ–æ•°ç»„è¯¦è§£)
3. [ä¸‰ç§æ‰§è¡Œæ¨¡å¼](#3-ä¸‰ç§æ‰§è¡Œæ¨¡å¼)
4. [ä¾èµ–é™·é˜±ä¸é—­åŒ…é—®é¢˜](#4-ä¾èµ–é™·é˜±ä¸é—­åŒ…é—®é¢˜)
5. [å¼‚æ­¥è¯·æ±‚å¤„ç†](#5-å¼‚æ­¥è¯·æ±‚å¤„ç†)
6. [æ¸…ç†å‰¯ä½œç”¨](#6-æ¸…ç†å‰¯ä½œç”¨)
7. [å¸¸è§é”™è¯¯ä¸æœ€ä½³å®è·µ](#7-å¸¸è§é”™è¯¯ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ useEffectåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯useEffect

**ç®€å•ç†è§£**ï¼šuseEffectå°±æ˜¯Reactçš„"å‰¯ä½œç”¨å¤„ç†å™¨"ï¼Œç”¨æ¥å¤„ç†ç»„ä»¶ä¸­çš„"é¢å¤–å·¥ä½œ"ã€‚

```
ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»è¦ä½œç”¨ï¼šæ¸²æŸ“UIï¼ˆæ˜¾ç¤ºé¡µé¢å†…å®¹ï¼‰      â”‚
â”‚ å‰¯ä½œç”¨ï¼šå…¶ä»–é¢å¤–å·¥ä½œ                â”‚
â”‚ â€¢ å‘é€ç½‘ç»œè¯·æ±‚                      â”‚
â”‚ â€¢ æ“ä½œDOMå…ƒç´                        â”‚
â”‚ â€¢ è®¾ç½®å®šæ—¶å™¨                        â”‚
â”‚ â€¢ è®¢é˜…äº‹ä»¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦useEffect

**ğŸ¤” é—®é¢˜åœºæ™¯**ï¼š
```javascript
function UserProfile() {
  const [user, setUser] = useState(null);
  
  // âŒ é”™è¯¯ï¼šç›´æ¥åœ¨ç»„ä»¶ä¸­å‘è¯·æ±‚
  fetch('/api/user').then(data => setUser(data));
  
  return <div>{user?.name}</div>;
}
```

**âŒ é—®é¢˜**ï¼šæ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“éƒ½ä¼šå‘é€è¯·æ±‚ï¼Œé€ æˆæ— é™å¾ªç¯ï¼

**âœ… æ­£ç¡®åšæ³•**ï¼š
```javascript
function UserProfile() {
  const [user, setUser] = useState(null);
  
  // âœ… ä½¿ç”¨useEffectå¤„ç†å‰¯ä½œç”¨
  useEffect(() => {
    fetch('/api/user').then(data => setUser(data));
  }, []); // åªåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œ
  
  return <div>{user?.name}</div>;
}
```

### 1.3 useEffectåŸºæœ¬è¯­æ³•

```javascript
useEffect(å‰¯ä½œç”¨å‡½æ•°, ä¾èµ–æ•°ç»„);
```

**å‚æ•°è¯´æ˜**ï¼š
- **å‰¯ä½œç”¨å‡½æ•°**ï¼šè¦æ‰§è¡Œçš„é¢å¤–å·¥ä½œ
- **ä¾èµ–æ•°ç»„**ï¼šæ§åˆ¶ä½•æ—¶æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆ**æ ¸å¿ƒé‡ç‚¹**ï¼‰

---

## 2. ğŸ“‹ ä¾èµ–æ•°ç»„è¯¦è§£


### 2.1 ä¾èµ–æ•°ç»„çš„æ¦‚å¿µ

**ğŸ”¸ ä¾èµ–æ•°ç»„**ï¼šå‘Šè¯‰Reactä½•æ—¶é‡æ–°æ‰§è¡ŒuseEffectçš„"æ§åˆ¶å™¨"

```
ä¾èµ–æ•°ç»„çš„ä½œç”¨æœºåˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reactæ£€æŸ¥ä¾èµ–é¡¹æ˜¯å¦å‘ç”Ÿå˜åŒ–      â”‚
â”‚ â†“                              â”‚
â”‚ å˜åŒ–äº† â†’ é‡æ–°æ‰§è¡ŒuseEffect      â”‚
â”‚ æ²¡å˜åŒ– â†’ è·³è¿‡æ‰§è¡Œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¾èµ–é¡¹æ¯”è¾ƒè§„åˆ™

**ğŸ”¸ æµ…æ¯”è¾ƒ**ï¼šReactä½¿ç”¨`Object.is()`æ¯”è¾ƒä¾èµ–é¡¹

```javascript
// åŸºæœ¬ç±»å‹ï¼šç›´æ¥æ¯”è¾ƒå€¼
const [count, setCount] = useState(0);
useEffect(() => {
  console.log('countå˜åŒ–äº†');
}, [count]); // countä»0å˜ä¸º1æ—¶ä¼šæ‰§è¡Œ

// å¼•ç”¨ç±»å‹ï¼šæ¯”è¾ƒå¼•ç”¨åœ°å€
const [user, setUser] = useState({name: 'Tom'});
useEffect(() => {
  console.log('userå˜åŒ–äº†');
}, [user]); // åªæœ‰userå¯¹è±¡å¼•ç”¨å˜åŒ–æ—¶æ‰æ‰§è¡Œ
```

**âš ï¸ é‡è¦æé†’**ï¼š
```javascript
// âŒ æ¯æ¬¡éƒ½æ˜¯æ–°å¯¹è±¡ï¼Œæ€»æ˜¯æ‰§è¡Œ
useEffect(() => {
  console.log('æ€»æ˜¯æ‰§è¡Œ');
}, [{name: 'Tom'}]); // æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡

// âœ… ä½¿ç”¨stateä¸­çš„å¯¹è±¡
const [user] = useState({name: 'Tom'});
useEffect(() => {
  console.log('åªåœ¨userå˜åŒ–æ—¶æ‰§è¡Œ');
}, [user]);
```

---

## 3. ğŸ”„ ä¸‰ç§æ‰§è¡Œæ¨¡å¼


### 3.1 æ¨¡å¼å¯¹æ¯”è¡¨æ ¼


| **ä¾èµ–æ•°ç»„** | **æ‰§è¡Œæ—¶æœº** | **ä½¿ç”¨åœºæ™¯** | **ä»£ç ç¤ºä¾‹** |
|-------------|-------------|-------------|-------------|
| `[]` | åªæ‰§è¡Œä¸€æ¬¡ï¼ˆé¦–æ¬¡æ¸²æŸ“åï¼‰ | åˆå§‹åŒ–æ•°æ®ã€ä¸€æ¬¡æ€§è®¾ç½® | `useEffect(() => {}, [])` |
| `[ä¾èµ–é¡¹]` | ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰§è¡Œ | å“åº”çŠ¶æ€å˜åŒ–ã€å®æ—¶æ›´æ–° | `useEffect(() => {}, [count])` |
| **æ— ä¾èµ–æ•°ç»„** | æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ | è°ƒè¯•ã€ç‰¹æ®Šéœ€æ±‚ | `useEffect(() => {})` |

### 3.2 æ¨¡å¼ä¸€ï¼šç©ºä¾èµ–æ•°ç»„ []


**ğŸ’¡ å«ä¹‰**ï¼šå‘Šè¯‰React"æˆ‘ä¸ä¾èµ–ä»»ä½•ä¸œè¥¿ï¼Œåªæ‰§è¡Œä¸€æ¬¡"

```javascript
function App() {
  const [data, setData] = useState(null);
  
  // ğŸ¯ åªåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡
  useEffect(() => {
    console.log('ç»„ä»¶æŒ‚è½½äº†ï¼Œè·å–åˆå§‹æ•°æ®');
    fetch('/api/data')
      .then(response => response.json())
      .then(data => setData(data));
  }, []); // ç©ºæ•°ç»„ = æ— ä¾èµ– = åªæ‰§è¡Œä¸€æ¬¡
  
  return <div>{data ? 'æ•°æ®å·²åŠ è½½' : 'åŠ è½½ä¸­...'}</div>;
}
```

**ğŸ¯ å…¸å‹ç”¨é€”**ï¼š
- è·å–åˆå§‹æ•°æ®
- è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
- åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“

### 3.3 æ¨¡å¼äºŒï¼šæœ‰ä¾èµ–æ•°ç»„ [ä¾èµ–é¡¹]


**ğŸ’¡ å«ä¹‰**ï¼šå‘Šè¯‰React"å½“è¿™äº›å€¼å˜åŒ–æ—¶ï¼Œé‡æ–°æ‰§è¡Œ"

```javascript
function SearchResults() {
  const [keyword, setKeyword] = useState('');
  const [results, setResults] = useState([]);
  
  // ğŸ¯ å½“keywordå˜åŒ–æ—¶æ‰§è¡Œ
  useEffect(() => {
    if (keyword) {
      console.log(`æœç´¢ï¼š${keyword}`);
      fetch(`/api/search?q=${keyword}`)
        .then(response => response.json())
        .then(data => setResults(data));
    }
  }, [keyword]); // keywordå˜åŒ–æ—¶æ‰§è¡Œ
  
  return (
    <div>
      <input 
        value={keyword}
        onChange={(e) => setKeyword(e.target.value)}
        placeholder="è¾“å…¥æœç´¢å…³é”®è¯"
      />
      <div>æ‰¾åˆ° {results.length} ä¸ªç»“æœ</div>
    </div>
  );
}
```

**ğŸ¯ å…¸å‹ç”¨é€”**ï¼š
- æ ¹æ®ç”¨æˆ·è¾“å…¥æœç´¢
- æ ¹æ®çŠ¶æ€æ›´æ–°UI
- ç›‘å¬propså˜åŒ–

### 3.4 æ¨¡å¼ä¸‰ï¼šæ— ä¾èµ–æ•°ç»„


**ğŸ’¡ å«ä¹‰**ï¼šå‘Šè¯‰React"æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ"

```javascript
function DebugComponent() {
  const [count, setCount] = useState(0);
  
  // âš ï¸ æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œï¼ˆä¸€èˆ¬ä¸æ¨èï¼‰
  useEffect(() => {
    console.log('ç»„ä»¶é‡æ–°æ¸²æŸ“äº†ï¼Œcount =', count);
  }); // æ²¡æœ‰ä¾èµ–æ•°ç»„
  
  return (
    <button onClick={() => setCount(count + 1)}>
      ç‚¹å‡»æ¬¡æ•°: {count}
    </button>
  );
}
```

**âš ï¸ ä½¿ç”¨åœºæ™¯**ï¼š
- è°ƒè¯•ç»„ä»¶æ¸²æŸ“
- ç‰¹æ®Šçš„æ€§èƒ½ç›‘æ§
- **ä¸€èˆ¬ä¸æ¨èä½¿ç”¨**

---

## 4. ğŸ•³ï¸ ä¾èµ–é™·é˜±ä¸é—­åŒ…é—®é¢˜


### 4.1 ç»å…¸é—­åŒ…é™·é˜±

**ğŸ› é—®é¢˜ä»£ç **ï¼š
```javascript
function Counter() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    const timer = setInterval(() => {
      // âŒ é™·é˜±ï¼šæ€»æ˜¯ä½¿ç”¨åˆå§‹å€¼0
      console.log('å½“å‰count:', count); // æ€»æ˜¯0
      setCount(count + 1); // æ€»æ˜¯ 0 + 1 = 1
    }, 1000);
    
    return () => clearInterval(timer);
  }, []); // ç©ºä¾èµ–æ•°ç»„å¯¼è‡´é—­åŒ…é™·é˜±
  
  return <div>Count: {count}</div>;
}
```

**ğŸ” é—®é¢˜åˆ†æ**ï¼š
```
é—­åŒ…é™·é˜±æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. useEffectåªæ‰§è¡Œä¸€æ¬¡          â”‚
â”‚ 2. å®šæ—¶å™¨å‡½æ•°æ•è·åˆå§‹count=0    â”‚
â”‚ 3. countå˜åŒ–ï¼Œä½†å®šæ—¶å™¨è¿˜æ˜¯ç”¨æ—§å€¼ â”‚
â”‚ 4. ç»“æœï¼šcountæ°¸è¿œæ˜¯1           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è§£å†³æ–¹æ¡ˆ


**âœ… æ–¹æ¡ˆ1ï¼šæ·»åŠ ä¾èµ–é¡¹**
```javascript
useEffect(() => {
  const timer = setInterval(() => {
    console.log('å½“å‰count:', count);
    setCount(count + 1);
  }, 1000);
  
  return () => clearInterval(timer);
}, [count]); // æ·»åŠ countä¾èµ–
```

**âœ… æ–¹æ¡ˆ2ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°ï¼ˆæ¨èï¼‰**
```javascript
useEffect(() => {
  const timer = setInterval(() => {
    setCount(prevCount => {
      console.log('å½“å‰count:', prevCount);
      return prevCount + 1; // ä½¿ç”¨æœ€æ–°å€¼
    });
  }, 1000);
  
  return () => clearInterval(timer);
}, []); // å¯ä»¥ä¿æŒç©ºä¾èµ–æ•°ç»„
```

### 4.3 ä¾èµ–é¡¹é—æ¼æ£€æµ‹

**ğŸ”¸ ESLintè§„åˆ™**ï¼š`react-hooks/exhaustive-deps`

```javascript
function UserInfo() {
  const [userId, setUserId] = useState(1);
  const [userInfo, setUserInfo] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`) // ä½¿ç”¨äº†userId
      .then(response => response.json())
      .then(data => setUserInfo(data));
  }, []); // âš ï¸ ESLintè­¦å‘Šï¼šç¼ºå°‘userIdä¾èµ–
  
  // âœ… æ­£ç¡®å†™æ³•
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(response => response.json())
      .then(data => setUserInfo(data));
  }, [userId]); // æ·»åŠ userIdä¾èµ–
}
```

---

## 5. ğŸŒ å¼‚æ­¥è¯·æ±‚å¤„ç†


### 5.1 åŸºç¡€å¼‚æ­¥è¯·æ±‚

```javascript
function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    // ğŸ¯ ç»„ä»¶æŒ‚è½½æ—¶è·å–ç”¨æˆ·åˆ—è¡¨
    async function fetchUsers() {
      try {
        setLoading(true);
        const response = await fetch('/api/users');
        const data = await response.json();
        setUsers(data);
      } catch (error) {
        console.error('è·å–ç”¨æˆ·å¤±è´¥:', error);
      } finally {
        setLoading(false);
      }
    }
    
    fetchUsers();
  }, []);
  
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

### 5.2 é˜²æ­¢å†…å­˜æ³„æ¼

**ğŸ› é—®é¢˜**ï¼šç»„ä»¶å¸è½½åï¼Œå¼‚æ­¥è¯·æ±‚ä»åœ¨æ‰§è¡Œï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

```javascript
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    let cancelled = false; // ğŸ¯ å–æ¶ˆæ ‡å¿—
    
    async function fetchUser() {
      try {
        const response = await fetch(`/api/users/${userId}`);
        const userData = await response.json();
        
        // âœ… æ£€æŸ¥ç»„ä»¶æ˜¯å¦å·²å¸è½½
        if (!cancelled) {
          setUser(userData);
        }
      } catch (error) {
        if (!cancelled) {
          console.error('è·å–ç”¨æˆ·å¤±è´¥:', error);
        }
      }
    }
    
    fetchUser();
    
    // ğŸ§¹ æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
    return () => {
      cancelled = true;
    };
  }, [userId]);
  
  return user ? <div>{user.name}</div> : <div>åŠ è½½ä¸­...</div>;
}
```

### 5.3 ä½¿ç”¨AbortControllerï¼ˆç°ä»£æ–¹æ¡ˆï¼‰

```javascript
function DataFetcher({ apiUrl }) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    const abortController = new AbortController();
    
    async function fetchData() {
      try {
        const response = await fetch(apiUrl, {
          signal: abortController.signal // ğŸ¯ ä¼ å…¥å–æ¶ˆä¿¡å·
        });
        const result = await response.json();
        setData(result);
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('è¯·æ±‚å¤±è´¥:', error);
        }
      }
    }
    
    fetchData();
    
    // ğŸ§¹ ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
    return () => {
      abortController.abort();
    };
  }, [apiUrl]);
  
  return data ? <div>{JSON.stringify(data)}</div> : <div>Loading...</div>;
}
```

---

## 6. ğŸ§¹ æ¸…ç†å‰¯ä½œç”¨


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦æ¸…ç†

**ğŸ”¸ å¸¸è§éœ€è¦æ¸…ç†çš„å‰¯ä½œç”¨**ï¼š
- å®šæ—¶å™¨ï¼ˆsetTimeoutã€setIntervalï¼‰
- äº‹ä»¶ç›‘å¬å™¨
- ç½‘ç»œè¯·æ±‚
- è®¢é˜…ï¼ˆWebSocketã€ç¬¬ä¸‰æ–¹åº“ï¼‰

```
ä¸æ¸…ç†çš„åæœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ å†…å­˜æ³„æ¼                      â”‚
â”‚ â€¢ å®šæ—¶å™¨ç»§ç»­è¿è¡Œ                â”‚
â”‚ â€¢ äº‹ä»¶ç›‘å¬å™¨ç´¯ç§¯                â”‚
â”‚ â€¢ ç½‘ç»œè¯·æ±‚æµªè´¹                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ¸…ç†å®šæ—¶å™¨

```javascript
function Timer() {
  const [seconds, setSeconds] = useState(0);
  
  useEffect(() => {
    console.log('å¯åŠ¨å®šæ—¶å™¨');
    const timer = setInterval(() => {
      setSeconds(prev => prev + 1);
    }, 1000);
    
    // ğŸ§¹ æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
    return () => {
      console.log('æ¸…ç†å®šæ—¶å™¨');
      clearInterval(timer);
    };
  }, []);
  
  return <div>è¿è¡Œæ—¶é—´: {seconds}ç§’</div>;
}
```

### 6.3 æ¸…ç†äº‹ä»¶ç›‘å¬å™¨

```javascript
function WindowSize() {
  const [windowSize, setWindowSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });
  
  useEffect(() => {
    function handleResize() {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    }
    
    // ğŸ¯ æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
    window.addEventListener('resize', handleResize);
    
    // ğŸ§¹ æ¸…ç†å‡½æ•°ï¼šç§»é™¤äº‹ä»¶ç›‘å¬å™¨
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);
  
  return <div>çª—å£å¤§å°: {windowSize.width} Ã— {windowSize.height}</div>;
}
```

### 6.4 æ¸…ç†WebSocketè¿æ¥

```javascript
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  
  useEffect(() => {
    // ğŸ¯ å»ºç«‹WebSocketè¿æ¥
    const ws = new WebSocket(`ws://localhost:8080/chat/${roomId}`);
    
    ws.onmessage = (event) => {
      const message = JSON.parse(event.data);
      setMessages(prev => [...prev, message]);
    };
    
    ws.onopen = () => {
      console.log(`è¿æ¥åˆ°æˆ¿é—´ ${roomId}`);
    };
    
    // ğŸ§¹ æ¸…ç†å‡½æ•°ï¼šå…³é—­WebSocketè¿æ¥
    return () => {
      console.log(`æ–­å¼€æˆ¿é—´ ${roomId} è¿æ¥`);
      ws.close();
    };
  }, [roomId]); // roomIdå˜åŒ–æ—¶é‡æ–°è¿æ¥
  
  return (
    <div>
      <h3>æˆ¿é—´ {roomId}</h3>
      {messages.map((msg, index) => (
        <div key={index}>{msg.text}</div>
      ))}
    </div>
  );
}
```

---

## 7. âš ï¸ å¸¸è§é”™è¯¯ä¸æœ€ä½³å®è·µ


### 7.1 æ— é™å¾ªç¯é”™è¯¯

**ğŸ› é”™è¯¯1ï¼šä¾èµ–é¡¹æ€»æ˜¯å˜åŒ–**
```javascript
function BadExample() {
  const [count, setCount] = useState(0);
  
  // âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
  useEffect(() => {
    console.log('æ‰§è¡Œäº†');
  }, [{ count }]); // æ–°å¯¹è±¡å¯¼è‡´æ— é™å¾ªç¯
  
  // âœ… æ­£ç¡®å†™æ³•
  useEffect(() => {
    console.log('æ‰§è¡Œäº†');
  }, [count]); // ç›´æ¥ä½¿ç”¨åŸºæœ¬ç±»å‹
}
```

**ğŸ› é”™è¯¯2ï¼šåœ¨Effectä¸­æ›´æ–°ä¾èµ–é¡¹**
```javascript
function BadCounter() {
  const [count, setCount] = useState(0);
  
  // âŒ æ— é™å¾ªç¯ï¼šcountå˜åŒ– â†’ Effectæ‰§è¡Œ â†’ æ›´æ–°count â†’ countå˜åŒ–...
  useEffect(() => {
    setCount(count + 1);
  }, [count]);
  
  // âœ… æ­£ç¡®å†™æ³•ï¼šç§»é™¤ä¾èµ–æˆ–ä½¿ç”¨æ¡ä»¶
  useEffect(() => {
    if (count < 10) {
      setCount(count + 1);
    }
  }, [count]);
}
```

### 7.2 æ¡ä»¶æ‰§è¡Œæœ€ä½³å®è·µ

```javascript
function ConditionalEffect() {
  const [user, setUser] = useState(null);
  const [shouldFetch, setShouldFetch] = useState(false);
  
  // âœ… æ–¹æ¡ˆ1ï¼šåœ¨Effectå†…éƒ¨åˆ¤æ–­
  useEffect(() => {
    if (shouldFetch) {
      fetch('/api/user')
        .then(response => response.json())
        .then(data => setUser(data));
    }
  }, [shouldFetch]);
  
  // âœ… æ–¹æ¡ˆ2ï¼šä½¿ç”¨å¤šä¸ªEffect
  useEffect(() => {
    if (user) {
      document.title = `ç”¨æˆ·ï¼š${user.name}`;
    }
  }, [user]);
  
  return (
    <div>
      <button onClick={() => setShouldFetch(true)}>
        è·å–ç”¨æˆ·ä¿¡æ¯
      </button>
      {user && <div>æ¬¢è¿ï¼Œ{user.name}!</div>}
    </div>
  );
}
```

### 7.3 ä¾èµ–æ•°ç»„æœ€ä½³å®è·µ


**ğŸ¯ è§„åˆ™æ€»ç»“**ï¼š

| **åœºæ™¯** | **æ¨èåšæ³•** | **è¯´æ˜** |
|---------|-------------|---------|
| åªæ‰§è¡Œä¸€æ¬¡ | `useEffect(() => {}, [])` | ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ |
| å“åº”çŠ¶æ€å˜åŒ– | `useEffect(() => {}, [state])` | çŠ¶æ€å˜åŒ–æ—¶æ‰§è¡Œ |
| é¿å…é—­åŒ…é™·é˜± | ä½¿ç”¨å‡½æ•°å¼æ›´æ–° | `setState(prev => prev + 1)` |
| å¤æ‚ä¾èµ– | æ‹†åˆ†å¤šä¸ªEffect | æ¯ä¸ªEffectè´Ÿè´£ä¸€ä»¶äº‹ |

```javascript
// âœ… å¥½çš„åšæ³•ï¼šæ¯ä¸ªEffectèŒè´£å•ä¸€
function UserDashboard({ userId }) {
  const [user, setUser] = useState(null);
  const [posts, setPosts] = useState([]);
  
  // Effect 1ï¼šè·å–ç”¨æˆ·ä¿¡æ¯
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(response => response.json())
      .then(data => setUser(data));
  }, [userId]);
  
  // Effect 2ï¼šè·å–ç”¨æˆ·æ–‡ç« 
  useEffect(() => {
    fetch(`/api/users/${userId}/posts`)
      .then(response => response.json())
      .then(data => setPosts(data));
  }, [userId]);
  
  // Effect 3ï¼šæ›´æ–°é¡µé¢æ ‡é¢˜
  useEffect(() => {
    if (user) {
      document.title = `${user.name}çš„ä¸»é¡µ`;
    }
  }, [user]);
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ useEffectä½œç”¨ï¼šå¤„ç†ç»„ä»¶çš„å‰¯ä½œç”¨ï¼ˆé¢å¤–å·¥ä½œï¼‰
ğŸ”¸ ä¾èµ–æ•°ç»„ï¼šæ§åˆ¶Effectæ‰§è¡Œæ—¶æœºçš„"å¼€å…³"
ğŸ”¸ ä¸‰ç§æ¨¡å¼ï¼š[] ä¸€æ¬¡ã€[deps] å“åº”å˜åŒ–ã€æ— æ•°ç»„ æ¯æ¬¡
ğŸ”¸ æ¸…ç†å‡½æ•°ï¼šé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œç»„ä»¶å¸è½½æ—¶æ‰§è¡Œ
ğŸ”¸ é—­åŒ…é™·é˜±ï¼šä¾èµ–é¡¹é—æ¼å¯¼è‡´ä½¿ç”¨è¿‡æœŸå€¼
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¾èµ–æ•°ç»„çš„æœ¬è´¨**
```
ä¾èµ–æ•°ç»„ = é‡æ–°æ‰§è¡Œçš„æ¡ä»¶
â€¢ [] â†’ æ°¸ä¸é‡æ–°æ‰§è¡Œ
â€¢ [a, b] â†’ aæˆ–bå˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ  
â€¢ æ— æ•°ç»„ â†’ æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°æ‰§è¡Œ
```

**ğŸ”¹ æ¸…ç†çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆè¦æ¸…ç†ï¼Ÿ
â€¢ é˜²æ­¢å†…å­˜æ³„æ¼
â€¢ é¿å…é‡å¤è®¢é˜…
â€¢ æ¸…ç†å®šæ—¶å™¨
â€¢ å–æ¶ˆç½‘ç»œè¯·æ±‚
```

**ğŸ”¹ å¼‚æ­¥å¤„ç†è¦ç‚¹**
```
å¼‚æ­¥è¯·æ±‚æ³¨æ„äº‹é¡¹ï¼š
â€¢ ç»„ä»¶å¸è½½åä¸è¦æ›´æ–°çŠ¶æ€
â€¢ ä½¿ç”¨å–æ¶ˆæ ‡å¿—æˆ–AbortController
â€¢ åœ¨æ¸…ç†å‡½æ•°ä¸­å–æ¶ˆè¯·æ±‚
```

### 8.3 å®ç”¨è®°å¿†å£è¯€

```
useEffectç”¨æ³•ä¸‰è¦ç´ ï¼š
å‰¯ä½œç”¨å‡½æ•°å†™é€»è¾‘ï¼Œ
ä¾èµ–æ•°ç»„æ§æ—¶æœºï¼Œ
æ¸…ç†å‡½æ•°é˜²æ³„æ¼ã€‚

ä¾èµ–æ•°ç»„è®°å£è¯€ï¼š
ç©ºæ•°ç»„åªæ‰§è¡Œä¸€æ¬¡ï¼Œ
æœ‰ä¾èµ–å“åº”å˜åŒ–ï¼Œ  
æ— æ•°ç»„æ¯æ¬¡éƒ½è·‘ã€‚
```

### 8.4 å¿«é€Ÿæ£€æŸ¥æ¸…å•


**â˜‘ï¸ Effectç¼–å†™æ£€æŸ¥æ¸…å•**ï¼š
- [ ] æ˜¯å¦éœ€è¦æ¸…ç†å‰¯ä½œç”¨ï¼Ÿ
- [ ] ä¾èµ–æ•°ç»„æ˜¯å¦åŒ…å«æ‰€æœ‰ä½¿ç”¨çš„å˜é‡ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†æ— é™å¾ªç¯ï¼Ÿ
- [ ] å¼‚æ­¥æ“ä½œæ˜¯å¦å¤„ç†äº†ç»„ä»¶å¸è½½ï¼Ÿ
- [ ] æ˜¯å¦æ‹†åˆ†äº†å¤æ‚çš„Effectï¼Ÿ

**ğŸ¯ æœ€ä½³å®è·µæ€»ç»“**ï¼š
- ä¸€ä¸ªEffectåªåšä¸€ä»¶äº‹
- æ‰€æœ‰ä½¿ç”¨çš„å˜é‡éƒ½è¦åŠ å…¥ä¾èµ–æ•°ç»„
- éœ€è¦æ¸…ç†çš„å‰¯ä½œç”¨ä¸€å®šè¦æ¸…ç†
- å¤æ‚é€»è¾‘æ‹†åˆ†æˆå¤šä¸ªEffect
- ä½¿ç”¨ESLintè§„åˆ™æ£€æŸ¥ä¾èµ–é¡¹