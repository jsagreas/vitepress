---
title: 1ã€useEffectå‰¯ä½œç”¨åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨](#1-ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨)
2. [useEffectåŸºç¡€è¯­æ³•](#2-useeffectåŸºç¡€è¯­æ³•)
3. [useEffectæ‰§è¡Œæ—¶æœº](#3-useeffectæ‰§è¡Œæ—¶æœº)
4. [æ¨¡æ‹Ÿç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ](#4-æ¨¡æ‹Ÿç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ)
5. [æ¸…ç†å‡½æ•°è¯¦è§£](#5-æ¸…ç†å‡½æ•°è¯¦è§£)
6. [å‰¯ä½œç”¨æ¸…ç†å®æˆ˜](#6-å‰¯ä½œç”¨æ¸…ç†å®æˆ˜)
7. [å¼‚æ­¥æ“ä½œå¤„ç†](#7-å¼‚æ­¥æ“ä½œå¤„ç†)
8. [å†…å­˜æ³„æ¼é˜²æ­¢](#8-å†…å­˜æ³„æ¼é˜²æ­¢)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨


### 1.1 å‰¯ä½œç”¨çš„é€šä¿—ç†è§£


**å‰¯ä½œç”¨ï¼ˆSide Effectï¼‰** å°±åƒæ˜¯"ä¸»è¦å·¥ä½œä¹‹å¤–çš„é¢å¤–æ“ä½œ"ã€‚

```
ğŸ  ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
åšé¥­ï¼ˆä¸»è¦å·¥ä½œï¼‰ + æ´—ç¢—ï¼ˆå‰¯ä½œç”¨ï¼‰
å¼€è½¦ï¼ˆä¸»è¦å·¥ä½œï¼‰ + æ’­æ”¾éŸ³ä¹ï¼ˆå‰¯ä½œç”¨ï¼‰

ğŸ’» Reactä¸­çš„ä¾‹å­ï¼š
æ¸²æŸ“ç»„ä»¶ï¼ˆä¸»è¦å·¥ä½œï¼‰ + å‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå‰¯ä½œç”¨ï¼‰
æ˜¾ç¤ºæ•°æ®ï¼ˆä¸»è¦å·¥ä½œï¼‰ + è®¾ç½®é¡µé¢æ ‡é¢˜ï¼ˆå‰¯ä½œç”¨ï¼‰
```

### 1.2 Reactä¸­çš„å‰¯ä½œç”¨


> ğŸ’¡ **ç®€å•ç†è§£**ï¼šå‰¯ä½œç”¨å°±æ˜¯é™¤äº†æ¸²æŸ“UIä¹‹å¤–çš„æ‰€æœ‰æ“ä½œ

**å¸¸è§çš„å‰¯ä½œç”¨æ“ä½œ**ï¼š
- ğŸŒ **ç½‘ç»œè¯·æ±‚**ï¼šè·å–æ•°æ®ã€æäº¤è¡¨å•
- ğŸ“ **DOMæ“ä½œ**ï¼šä¿®æ”¹é¡µé¢æ ‡é¢˜ã€è®¾ç½®ç„¦ç‚¹
- â° **å®šæ—¶å™¨**ï¼šsetTimeoutã€setInterval
- ğŸ‘‚ **äº‹ä»¶ç›‘å¬**ï¼šç›‘å¬æ»šåŠ¨ã€é”®ç›˜äº‹ä»¶
- ğŸ”— **è®¢é˜…**ï¼šWebSocketè¿æ¥ã€ç¬¬ä¸‰æ–¹åº“

```javascript
// âŒ é”™è¯¯ï¼šåœ¨ç»„ä»¶æ¸²æŸ“ä¸­ç›´æ¥æ“ä½œå‰¯ä½œç”¨
function UserProfile() {
  // è¿™æ ·å†™ä¼šæœ‰é—®é¢˜ï¼æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šå‘è¯·æ±‚
  fetch('/api/user').then(data => console.log(data));
  
  return <div>ç”¨æˆ·ä¿¡æ¯</div>;
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨useEffectå¤„ç†å‰¯ä½œç”¨
function UserProfile() {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    // åœ¨è¿™é‡Œå¤„ç†å‰¯ä½œç”¨
    fetch('/api/user').then(data => setUser(data));
  }, []); // åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
  
  return <div>{user?.name}</div>;
}
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦useEffect


**é—®é¢˜**ï¼šReactç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Œå¦‚æœç›´æ¥åœ¨ç»„ä»¶ä¸­å†™å‰¯ä½œç”¨ä»£ç ä¼šå¯¼è‡´ï¼š

```
æ¸²æŸ“å¾ªç¯é—®é¢˜ï¼š
ç»„ä»¶æ¸²æŸ“ â†’ æ‰§è¡Œå‰¯ä½œç”¨ â†’ çŠ¶æ€æ›´æ–° â†’ ç»„ä»¶é‡æ–°æ¸²æŸ“ â†’ åˆæ‰§è¡Œå‰¯ä½œç”¨ â†’ æ— é™å¾ªç¯
```

**è§£å†³æ–¹æ¡ˆ**ï¼šuseEffectè®©æˆ‘ä»¬å¯ä»¥æ§åˆ¶å‰¯ä½œç”¨çš„æ‰§è¡Œæ—¶æœº

---

## 2. ğŸ“ useEffectåŸºç¡€è¯­æ³•


### 2.1 åŸºæœ¬è¯­æ³•ç»“æ„


```javascript
useEffect(å‰¯ä½œç”¨å‡½æ•°, ä¾èµ–æ•°ç»„);
```

**ä¸¤ä¸ªå‚æ•°è¯¦è§£**ï¼š

```javascript
useEffect(
  () => {
    // å‚æ•°1ï¼šå‰¯ä½œç”¨å‡½æ•°
    // åœ¨è¿™é‡Œå†™å‰¯ä½œç”¨ä»£ç 
    console.log('ç»„ä»¶æ¸²æŸ“å®Œæˆ');
    
    // å¯é€‰ï¼šè¿”å›æ¸…ç†å‡½æ•°
    return () => {
      console.log('æ¸…ç†å‰¯ä½œç”¨');
    };
  },
  [] // å‚æ•°2ï¼šä¾èµ–æ•°ç»„ï¼ˆå¯é€‰ï¼‰
);
```

### 2.2 ä¸‰ç§ä½¿ç”¨å½¢å¼


```javascript
// ğŸ“Œ å½¢å¼1ï¼šæ— ä¾èµ–æ•°ç»„ - æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ
useEffect(() => {
  console.log('æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ');
});

// ğŸ“Œ å½¢å¼2ï¼šç©ºä¾èµ–æ•°ç»„ - åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
useEffect(() => {
  console.log('åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ');
}, []);

// ğŸ“Œ å½¢å¼3ï¼šæœ‰ä¾èµ–æ•°ç»„ - ä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ
useEffect(() => {
  console.log('countå˜åŒ–æ—¶æ‰§è¡Œ');
}, [count]);
```

### 2.3 ç®€å•ç¤ºä¾‹


```javascript
function Timer() {
  const [count, setCount] = useState(0);
  
  // æ¯ç§’è‡ªåŠ¨åŠ 1
  useEffect(() => {
    const timer = setInterval(() => {
      setCount(c => c + 1);
    }, 1000);
    
    // æ¸…ç†å®šæ—¶å™¨
    return () => clearInterval(timer);
  }, []); // ç©ºæ•°ç»„ï¼šåªåœ¨æŒ‚è½½æ—¶è®¾ç½®ä¸€æ¬¡å®šæ—¶å™¨
  
  return <div>è®¡æ—¶å™¨: {count}ç§’</div>;
}
```

---

## 3. â° useEffectæ‰§è¡Œæ—¶æœº


### 3.1 æ‰§è¡Œæ—¶æœºå›¾è§£


```
ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼š

æŒ‚è½½é˜¶æ®µï¼š
ç»„ä»¶åˆ›å»º â†’ é¦–æ¬¡æ¸²æŸ“ â†’ DOMæ›´æ–°å®Œæˆ â†’ useEffectæ‰§è¡Œ

æ›´æ–°é˜¶æ®µï¼š
çŠ¶æ€æ”¹å˜ â†’ é‡æ–°æ¸²æŸ“ â†’ DOMæ›´æ–°å®Œæˆ â†’ useEffectæ‰§è¡Œï¼ˆå¦‚æœä¾èµ–å˜åŒ–ï¼‰

å¸è½½é˜¶æ®µï¼š
ç»„ä»¶å¸è½½ â†’ æ¸…ç†å‡½æ•°æ‰§è¡Œ
```

### 3.2 æ¸²æŸ“åæ‰§è¡Œçš„å«ä¹‰


> ğŸ” **å…³é”®ç†è§£**ï¼šuseEffectæ€»æ˜¯åœ¨DOMæ›´æ–°**ä¹‹å**æ‰§è¡Œ

```javascript
function Example() {
  const [count, setCount] = useState(0);
  
  console.log('1. ç»„ä»¶å‡½æ•°æ‰§è¡Œ'); // æ¸²æŸ“æ—¶æ‰§è¡Œ
  
  useEffect(() => {
    console.log('3. useEffectæ‰§è¡Œ'); // DOMæ›´æ–°åæ‰§è¡Œ
  });
  
  console.log('2. è¿”å›JSXå‰'); // æ¸²æŸ“æ—¶æ‰§è¡Œ
  
  return <div>{count}</div>;
}

// è¾“å‡ºé¡ºåºï¼š
// 1. ç»„ä»¶å‡½æ•°æ‰§è¡Œ
// 2. è¿”å›JSXå‰
// 3. useEffectæ‰§è¡Œ
```

### 3.3 ä¸ç”¨æˆ·äº¤äº’çš„å…³ç³»


```javascript
function ClickCounter() {
  const [clicks, setClicks] = useState(0);
  
  useEffect(() => {
    // ç”¨æˆ·çœ‹åˆ°æ–°çš„countå€¼åï¼Œè¿™é‡Œæ‰æ‰§è¡Œ
    document.title = `ç‚¹å‡»äº†${clicks}æ¬¡`;
  }, [clicks]);
  
  return (
    <button onClick={() => setClicks(clicks + 1)}>
      ç‚¹å‡»æ¬¡æ•°: {clicks}
    </button>
  );
}
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. ç”¨æˆ·ç‚¹å‡»æŒ‰é’®
2. setClicksæ›´æ–°çŠ¶æ€
3. ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç¤ºæ–°çš„countå€¼
4. ç”¨æˆ·çœ‹åˆ°æ›´æ–°åçš„ç•Œé¢
5. useEffectæ‰§è¡Œï¼Œæ›´æ–°é¡µé¢æ ‡é¢˜

---

## 4. ğŸ”„ æ¨¡æ‹Ÿç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ


### 4.1 componentDidMountï¼ˆç»„ä»¶æŒ‚è½½ï¼‰


> ğŸ’¡ **ç†è§£**ï¼šç»„ä»¶ç¬¬ä¸€æ¬¡å‡ºç°åœ¨é¡µé¢ä¸Šæ—¶æ‰§è¡Œä¸€æ¬¡

```javascript
// ç±»ç»„ä»¶å†™æ³•
class OldComponent extends Component {
  componentDidMount() {
    console.log('ç»„ä»¶æŒ‚è½½å®Œæˆ');
    this.fetchData();
  }
}

// Hookå†™æ³•ï¼šç©ºä¾èµ–æ•°ç»„
function NewComponent() {
  useEffect(() => {
    console.log('ç»„ä»¶æŒ‚è½½å®Œæˆ');
    fetchData();
  }, []); // ğŸ”‘ ç©ºæ•°ç»„æ˜¯å…³é”®
  
  return <div>å†…å®¹</div>;
}
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```javascript
function UserProfile() {
  const [user, setUser] = useState(null);
  
  // ç»„ä»¶æŒ‚è½½æ—¶è·å–ç”¨æˆ·æ•°æ®
  useEffect(() => {
    async function fetchUser() {
      const response = await fetch('/api/user');
      const userData = await response.json();
      setUser(userData);
    }
    
    fetchUser();
  }, []); // åªæ‰§è¡Œä¸€æ¬¡
  
  return user ? <div>æ¬¢è¿ï¼Œ{user.name}</div> : <div>åŠ è½½ä¸­...</div>;
}
```

### 4.2 componentDidUpdateï¼ˆç»„ä»¶æ›´æ–°ï¼‰


> ğŸ’¡ **ç†è§£**ï¼šå½“ç‰¹å®šæ•°æ®å˜åŒ–æ—¶æ‰§è¡Œ

```javascript
// ç±»ç»„ä»¶å†™æ³•
class OldComponent extends Component {
  componentDidUpdate(prevProps) {
    if (prevProps.userId !== this.props.userId) {
      this.fetchUserData(this.props.userId);
    }
  }
}

// Hookå†™æ³•ï¼šæœ‰ä¾èµ–æ•°ç»„
function NewComponent({ userId }) {
  useEffect(() => {
    fetchUserData(userId);
  }, [userId]); // ğŸ”‘ userIdå˜åŒ–æ—¶æ‰§è¡Œ
  
  return <div>ç”¨æˆ·ä¿¡æ¯</div>;
}
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```javascript
function SearchResults({ keyword }) {
  const [results, setResults] = useState([]);
  
  // æœç´¢å…³é”®è¯å˜åŒ–æ—¶é‡æ–°æœç´¢
  useEffect(() => {
    if (keyword) {
      search(keyword).then(setResults);
    }
  }, [keyword]); // keywordå˜åŒ–æ—¶æ‰§è¡Œ
  
  return (
    <div>
      {results.map(item => <div key={item.id}>{item.title}</div>)}
    </div>
  );
}
```

### 4.3 componentWillUnmountï¼ˆç»„ä»¶å¸è½½ï¼‰


> ğŸ’¡ **ç†è§£**ï¼šç»„ä»¶ä»é¡µé¢ä¸Šæ¶ˆå¤±å‰æ‰§è¡Œæ¸…ç†å·¥ä½œ

```javascript
// ç±»ç»„ä»¶å†™æ³•
class OldComponent extends Component {
  componentWillUnmount() {
    clearInterval(this.timer);
    window.removeEventListener('resize', this.handleResize);
  }
}

// Hookå†™æ³•ï¼šè¿”å›æ¸…ç†å‡½æ•°
function NewComponent() {
  useEffect(() => {
    const timer = setInterval(() => {
      console.log('å®šæ—¶æ‰§è¡Œ');
    }, 1000);
    
    // ğŸ”‘ è¿”å›æ¸…ç†å‡½æ•°
    return () => {
      clearInterval(timer);
    };
  }, []);
  
  return <div>ç»„ä»¶å†…å®¹</div>;
}
```

---

## 5. ğŸ§¹ æ¸…ç†å‡½æ•°è¯¦è§£


### 5.1 ä»€ä¹ˆæ˜¯æ¸…ç†å‡½æ•°


> ğŸ’¡ **ç®€å•ç†è§£**ï¼šæ¸…ç†å‡½æ•°å°±æ˜¯"æ”¶æ‹¾æ®‹å±€"çš„å‡½æ•°

```javascript
useEffect(() => {
  // è®¾ç½®å‰¯ä½œç”¨
  const timer = setInterval(() => {
    console.log('å®šæ—¶å™¨æ‰§è¡Œ');
  }, 1000);
  
  // è¿”å›æ¸…ç†å‡½æ•°
  return () => {
    console.log('æ¸…ç†å®šæ—¶å™¨');
    clearInterval(timer); // æ”¶æ‹¾æ®‹å±€
  };
}, []);
```

### 5.2 æ¸…ç†å‡½æ•°æ‰§è¡Œæ—¶æœº


```
æ¸…ç†å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼š

1. ç»„ä»¶å¸è½½æ—¶
   ç»„ä»¶æ¶ˆå¤± â†’ æ‰§è¡Œæ¸…ç†å‡½æ•°

2. useEffecté‡æ–°æ‰§è¡Œå‰
   ä¾èµ–å˜åŒ– â†’ å…ˆæ‰§è¡Œæ¸…ç†å‡½æ•° â†’ å†æ‰§è¡Œæ–°çš„useEffect

3. ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ˆæ— ä¾èµ–æ•°ç»„çš„æƒ…å†µï¼‰
   é‡æ–°æ¸²æŸ“ â†’ å…ˆæ¸…ç†ä¸Šæ¬¡çš„å‰¯ä½œç”¨ â†’ å†æ‰§è¡Œæ–°çš„å‰¯ä½œç”¨
```

### 5.3 æ¸…ç†å‡½æ•°ç¤ºä¾‹


```javascript
function ScrollListener() {
  const [scrollY, setScrollY] = useState(0);
  
  useEffect(() => {
    // è®¾ç½®äº‹ä»¶ç›‘å¬
    function handleScroll() {
      setScrollY(window.scrollY);
    }
    
    console.log('æ·»åŠ æ»šåŠ¨ç›‘å¬');
    window.addEventListener('scroll', handleScroll);
    
    // æ¸…ç†å‡½æ•°
    return () => {
      console.log('ç§»é™¤æ»šåŠ¨ç›‘å¬');
      window.removeEventListener('scroll', handleScroll);
    };
  }, []); // åªåœ¨æŒ‚è½½/å¸è½½æ—¶æ‰§è¡Œ
  
  return <div>æ»šåŠ¨ä½ç½®: {scrollY}px</div>;
}
```

---

## 6. ğŸ› ï¸ å‰¯ä½œç”¨æ¸…ç†å®æˆ˜


### 6.1 å®šæ—¶å™¨æ¸…ç†


```javascript
function CountdownTimer({ seconds }) {
  const [timeLeft, setTimeLeft] = useState(seconds);
  
  useEffect(() => {
    // å€’è®¡æ—¶ç»“æŸï¼Œä¸éœ€è¦å®šæ—¶å™¨
    if (timeLeft <= 0) return;
    
    const timer = setInterval(() => {
      setTimeLeft(prev => prev - 1);
    }, 1000);
    
    // ğŸ”‘ æ¸…ç†å®šæ—¶å™¨
    return () => clearInterval(timer);
  }, [timeLeft]); // timeLeftå˜åŒ–æ—¶é‡æ–°è®¾ç½®å®šæ—¶å™¨
  
  return (
    <div>
      {timeLeft > 0 ? `å€’è®¡æ—¶: ${timeLeft}ç§’` : 'æ—¶é—´åˆ°ï¼'}
    </div>
  );
}
```

### 6.2 äº‹ä»¶ç›‘å¬æ¸…ç†


```javascript
function WindowSizeTracker() {
  const [windowSize, setWindowSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight
  });
  
  useEffect(() => {
    function handleResize() {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight
      });
    }
    
    // æ·»åŠ äº‹ä»¶ç›‘å¬
    window.addEventListener('resize', handleResize);
    
    // ğŸ”‘ æ¸…ç†äº‹ä»¶ç›‘å¬
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []); // åªåœ¨æŒ‚è½½æ—¶æ·»åŠ ï¼Œå¸è½½æ—¶ç§»é™¤
  
  return (
    <div>
      çª—å£å¤§å°: {windowSize.width} x {windowSize.height}
    </div>
  );
}
```

### 6.3 è®¢é˜…æ¸…ç†


```javascript
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  
  useEffect(() => {
    // è®¢é˜…èŠå¤©å®¤æ¶ˆæ¯
    const unsubscribe = chatService.subscribe(roomId, (newMessage) => {
      setMessages(prev => [...prev, newMessage]);
    });
    
    // ğŸ”‘ æ¸…ç†è®¢é˜…
    return () => {
      unsubscribe(); // å–æ¶ˆè®¢é˜…
    };
  }, [roomId]); // roomIdå˜åŒ–æ—¶é‡æ–°è®¢é˜…
  
  return (
    <div>
      {messages.map(msg => (
        <div key={msg.id}>{msg.text}</div>
      ))}
    </div>
  );
}
```

---

## 7. ğŸŒ å¼‚æ­¥æ“ä½œå¤„ç†


### 7.1 å¼‚æ­¥æ“ä½œçš„é—®é¢˜


> âš ï¸ **æ³¨æ„**ï¼šuseEffectçš„å›è°ƒå‡½æ•°ä¸èƒ½ç›´æ¥æ˜¯asyncå‡½æ•°

```javascript
// âŒ é”™è¯¯å†™æ³•
useEffect(async () => {
  const data = await fetch('/api/data');
  setData(data);
}, []);

// âœ… æ­£ç¡®å†™æ³•
useEffect(() => {
  async function fetchData() {
    const data = await fetch('/api/data');
    setData(data);
  }
  
  fetchData();
}, []);
```

### 7.2 å¤„ç†ç½‘ç»œè¯·æ±‚


```javascript
function UserList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    let cancelled = false; // é˜²æ­¢ç»„ä»¶å¸è½½åè®¾ç½®çŠ¶æ€
    
    async function fetchUsers() {
      try {
        setLoading(true);
        const response = await fetch('/api/users');
        const data = await response.json();
        
        // ç»„ä»¶å¯èƒ½å·²ç»å¸è½½ï¼Œæ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ
        if (!cancelled) {
          setUsers(data);
          setError(null);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err.message);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    }
    
    fetchUsers();
    
    // æ¸…ç†å‡½æ•°ï¼šæ ‡è®°è¯·æ±‚å·²å–æ¶ˆ
    return () => {
      cancelled = true;
    };
  }, []);
  
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error}</div>;
  
  return (
    <div>
      {users.map(user => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

### 7.3 AbortControllerå–æ¶ˆè¯·æ±‚


```javascript
function DataFetcher({ url }) {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    const controller = new AbortController();
    
    async function fetchData() {
      try {
        const response = await fetch(url, {
          signal: controller.signal // æ”¯æŒå–æ¶ˆçš„ä¿¡å·
        });
        const result = await response.json();
        setData(result);
      } catch (error) {
        if (error.name !== 'AbortError') {
          console.error('è¯·æ±‚å¤±è´¥:', error);
        }
      }
    }
    
    fetchData();
    
    // æ¸…ç†ï¼šå–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚
    return () => {
      controller.abort();
    };
  }, [url]); // urlå˜åŒ–æ—¶å–æ¶ˆä¸Šæ¬¡è¯·æ±‚ï¼Œå‘èµ·æ–°è¯·æ±‚
  
  return data ? <div>{JSON.stringify(data)}</div> : <div>åŠ è½½ä¸­...</div>;
}
```

---

## 8. ğŸš« å†…å­˜æ³„æ¼é˜²æ­¢


### 8.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼


> ğŸ’¡ **ç®€å•ç†è§£**ï¼šå†…å­˜æ³„æ¼å°±æ˜¯"åƒåœ¾æ²¡æœ‰è¢«å›æ”¶"ï¼Œå¯¼è‡´å†…å­˜å ç”¨è¶Šæ¥è¶Šå¤š

**Reactä¸­å¸¸è§çš„å†…å­˜æ³„æ¼**ï¼š
- ç»„ä»¶å¸è½½åä»ç„¶æœ‰å®šæ—¶å™¨åœ¨è¿è¡Œ
- ç»„ä»¶å¸è½½åä»ç„¶æœ‰äº‹ä»¶ç›‘å¬å™¨
- ç»„ä»¶å¸è½½åå¼‚æ­¥æ“ä½œä»åœ¨æ‰§è¡Œå¹¶å°è¯•æ›´æ–°çŠ¶æ€

### 8.2 å†…å­˜æ³„æ¼ç¤ºä¾‹


```javascript
// âŒ æœ‰å†…å­˜æ³„æ¼çš„ä»£ç 
function BadComponent() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    setInterval(() => {
      setCount(c => c + 1); // ç»„ä»¶å¸è½½åä»åœ¨æ‰§è¡Œï¼
    }, 1000);
    // ç¼ºå°‘æ¸…ç†å‡½æ•°ï¼Œå®šæ—¶å™¨æ°¸è¿œä¸ä¼šè¢«æ¸…é™¤
  }, []);
  
  return <div>{count}</div>;
}

// âœ… æ­£ç¡®çš„ä»£ç 
function GoodComponent() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    const timer = setInterval(() => {
      setCount(c => c + 1);
    }, 1000);
    
    // ğŸ”‘ æ¸…ç†å®šæ—¶å™¨
    return () => clearInterval(timer);
  }, []);
  
  return <div>{count}</div>;
}
```

### 8.3 é˜²æ­¢å†…å­˜æ³„æ¼çš„æœ€ä½³å®è·µ


```javascript
function SafeComponent() {
  const [data, setData] = useState(null);
  const [isVisible, setIsVisible] = useState(true);
  
  useEffect(() => {
    let isMounted = true; // æ ‡è®°ç»„ä»¶æ˜¯å¦è¿˜åœ¨
    
    // å¼‚æ­¥æ“ä½œ
    async function loadData() {
      try {
        const result = await fetchSomeData();
        // åªæœ‰ç»„ä»¶è¿˜åœ¨æ—¶æ‰æ›´æ–°çŠ¶æ€
        if (isMounted) {
          setData(result);
        }
      } catch (error) {
        if (isMounted) {
          console.error(error);
        }
      }
    }
    
    // å®šæ—¶å™¨
    const timer = setInterval(() => {
      if (isMounted) {
        loadData();
      }
    }, 5000);
    
    // äº‹ä»¶ç›‘å¬
    function handleVisibilityChange() {
      if (isMounted) {
        setIsVisible(!document.hidden);
      }
    }
    
    document.addEventListener('visibilitychange', handleVisibilityChange);
    
    // åˆå§‹åŠ è½½
    loadData();
    
    // ğŸ”‘ æ¸…ç†æ‰€æœ‰å‰¯ä½œç”¨
    return () => {
      isMounted = false; // æ ‡è®°ç»„ä»¶å·²å¸è½½
      clearInterval(timer); // æ¸…ç†å®šæ—¶å™¨
      document.removeEventListener('visibilitychange', handleVisibilityChange); // æ¸…ç†äº‹ä»¶ç›‘å¬
    };
  }, []);
  
  return (
    <div>
      {data ? JSON.stringify(data) : 'åŠ è½½ä¸­...'}
      <div>é¡µé¢å¯è§: {isVisible ? 'æ˜¯' : 'å¦'}</div>
    </div>
  );
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‰¯ä½œç”¨å®šä¹‰ï¼šé™¤äº†æ¸²æŸ“UIä¹‹å¤–çš„æ‰€æœ‰æ“ä½œï¼ˆç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ç­‰ï¼‰
ğŸ”¸ useEffectè¯­æ³•ï¼šuseEffect(å‰¯ä½œç”¨å‡½æ•°, ä¾èµ–æ•°ç»„)
ğŸ”¸ æ‰§è¡Œæ—¶æœºï¼šDOMæ›´æ–°å®Œæˆä¹‹åæ‰§è¡Œï¼Œç”¨æˆ·èƒ½çœ‹åˆ°ç•Œé¢æ›´æ–°åæ‰æ‰§è¡Œ
ğŸ”¸ ä¸‰ç§æ¨¡å¼ï¼šæ— ä¾èµ–ï¼ˆæ¯æ¬¡æ‰§è¡Œï¼‰ã€ç©ºä¾èµ–ï¼ˆä¸€æ¬¡æ‰§è¡Œï¼‰ã€æœ‰ä¾èµ–ï¼ˆæ¡ä»¶æ‰§è¡Œï¼‰
ğŸ”¸ æ¸…ç†å‡½æ•°ï¼šè¿”å›å‡½æ•°æ¥æ¸…ç†å‰¯ä½œç”¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
```

### 9.2 ç”Ÿå‘½å‘¨æœŸå¯¹åº”å…³ç³»


| **ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ** | **useEffectå†™æ³•** | **ç”¨é€”** |
|-------------------|------------------|----------|
| `componentDidMount` | `useEffect(() => {}, [])` | ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ |
| `componentDidUpdate` | `useEffect(() => {}, [deps])` | ä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ |
| `componentWillUnmount` | `useEffect(() => { return cleanup; }, [])` | ç»„ä»¶å¸è½½æ—¶æ¸…ç† |

### 9.3 æœ€ä½³å®è·µè¦ç‚¹


```
âœ… æ€»æ˜¯æä¾›ä¾èµ–æ•°ç»„ï¼Œæ˜ç¡®useEffectçš„æ‰§è¡Œæ—¶æœº
âœ… æœ‰å‰¯ä½œç”¨å°±è¦æœ‰æ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
âœ… å¼‚æ­¥æ“ä½œè¦è€ƒè™‘ç»„ä»¶å¸è½½çš„æƒ…å†µ
âœ… ä¸€ä¸ªuseEffectä¸“æ³¨åšä¸€ä»¶äº‹ï¼Œä¸è¦æ··åˆå¤šç§å‰¯ä½œç”¨
âœ… ä½¿ç”¨ESLintçš„react-hooks/exhaustive-depsè§„åˆ™æ£€æŸ¥ä¾èµ–
```

### 9.4 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


```
ğŸ¤” é—®é¢˜ï¼šuseEffectæ— é™å¾ªç¯æ‰§è¡Œ
ğŸ’¡ è§£å†³ï¼šæ£€æŸ¥ä¾èµ–æ•°ç»„ï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡

ğŸ¤” é—®é¢˜ï¼šç»„ä»¶å¸è½½åæŠ¥é”™"æ— æ³•åœ¨å·²å¸è½½ç»„ä»¶ä¸Šè®¾ç½®çŠ¶æ€"
ğŸ’¡ è§£å†³ï¼šä½¿ç”¨æ¸…ç†å‡½æ•°æˆ–isMountedæ ‡è®°é˜²æ­¢

ğŸ¤” é—®é¢˜ï¼šuseEffectä¸æ‰§è¡Œ
ğŸ’¡ è§£å†³ï¼šæ£€æŸ¥ä¾èµ–æ•°ç»„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ä¾èµ–çœŸçš„å‘ç”Ÿäº†å˜åŒ–

ğŸ¤” é—®é¢˜ï¼šå®šæ—¶å™¨æˆ–äº‹ä»¶ç›‘å¬æ²¡æœ‰æ¸…ç†
ğŸ’¡ è§£å†³ï¼šå§‹ç»ˆåœ¨useEffectä¸­è¿”å›æ¸…ç†å‡½æ•°
```

### 9.5 è®°å¿†å£è¯€


```
ğŸ§  useEffectè®°å¿†è¦ç‚¹ï¼š
å‰¯ä½œç”¨å¤„ç†æ‰¾useEffectï¼Œ
æ¸²æŸ“ä¹‹åå†æ‰§è¡Œï¼Œ
ç©ºæ•°ç»„æŒ‚è½½ä¸€æ¬¡è¡Œï¼Œ
æœ‰ä¾èµ–å˜åŒ–æ‰è¿è¡Œï¼Œ
æ¸…ç†å‡½æ•°è¦è¿”å›ï¼Œ
å†…å­˜æ³„æ¼è¦é˜²æŠ¤ã€‚
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- useEffect = å‰¯ä½œç”¨ç®¡ç†å™¨
- ä¾èµ–æ•°ç»„ = æ‰§è¡Œæ¡ä»¶
- æ¸…ç†å‡½æ•° = å–„åå·¥ä½œ
- é˜²æ­¢æ³„æ¼ = å¿…åšåŠŸè¯¾