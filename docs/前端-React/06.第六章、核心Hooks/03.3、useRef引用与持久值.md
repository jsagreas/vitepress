---
title: 3ã€useRefå¼•ç”¨ä¸æŒä¹…å€¼
---
## ğŸ“š ç›®å½•

1. [useRefåŸºæœ¬æ¦‚å¿µ](#1-useRefåŸºæœ¬æ¦‚å¿µ)
2. [DOMå…ƒç´ å¼•ç”¨ä¸æ§åˆ¶](#2-DOMå…ƒç´ å¼•ç”¨ä¸æ§åˆ¶)
3. [æŒä¹…å˜é‡å­˜å‚¨](#3-æŒä¹…å˜é‡å­˜å‚¨)
4. [useRefä¸useStateçš„åŒºåˆ«](#4-useRefä¸useStateçš„åŒºåˆ«)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ useRefåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯useRef


**ç®€å•ç†è§£**ï¼šuseRefå°±åƒæ˜¯Reactç»™ä½ çš„ä¸€ä¸ª"ç›’å­"ï¼Œè¿™ä¸ªç›’å­å¯ä»¥è£…ä»»ä½•ä¸œè¥¿ï¼Œè€Œä¸”è£…çš„ä¸œè¥¿ä¸ä¼šå½±å“ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

```jsx
import { useRef } from 'react';

function MyComponent() {
  // åˆ›å»ºä¸€ä¸ªref"ç›’å­"
  const myRef = useRef(null);
  
  // myRefç°åœ¨æ˜¯ï¼š{ current: null }
  return <div>Hello World</div>;
}
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**
- ğŸ“¦ **å®¹å™¨æ¦‚å¿µ**ï¼šåƒä¸€ä¸ªä¸å˜çš„ç›’å­ï¼Œé‡Œé¢çš„`current`å±æ€§å¯ä»¥æ”¾ä»»ä½•å€¼
- ğŸ”„ **æŒä¹…å­˜åœ¨**ï¼šç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œrefå¯¹è±¡å§‹ç»ˆæ˜¯åŒä¸€ä¸ª
- ğŸš« **ä¸è§¦å‘æ›´æ–°**ï¼šæ”¹å˜refçš„å€¼ä¸ä¼šè®©ç»„ä»¶é‡æ–°æ¸²æŸ“

### 1.2 refå¯¹è±¡çš„ç»“æ„


```jsx
const myRef = useRef(åˆå§‹å€¼);

// myRefçš„ç»“æ„ï¼š
{
  current: åˆå§‹å€¼  // è¿™ä¸ªcurrentå±æ€§å­˜æ”¾å®é™…çš„å€¼
}

// ä½¿ç”¨æ–¹å¼ï¼š
myRef.current = 'æ–°çš„å€¼';           // è®¾ç½®å€¼
console.log(myRef.current);        // è·å–å€¼
```

> ğŸ’¡ **è®°å¿†æŠ€å·§**  
> æŠŠuseRefæƒ³è±¡æˆä¸€ä¸ªå¸¦æ ‡ç­¾çš„ç›’å­ï¼Œæ ‡ç­¾å°±æ˜¯å˜é‡å(myRef)ï¼Œç›’å­é‡Œçš„ä¸œè¥¿å°±æ˜¯currentå±æ€§ã€‚

---

## 2. ğŸ® DOMå…ƒç´ å¼•ç”¨ä¸æ§åˆ¶


### 2.1 è·å–DOMå…ƒç´ 


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šé€šè¿‡refå¯ä»¥ç›´æ¥"æŠ“ä½"é¡µé¢ä¸Šçš„HTMLå…ƒç´ ï¼Œå°±åƒç”¨æ‰‹æŒ‡æŒ‡å‘å±å¹•ä¸Šçš„æŒ‰é’®ä¸€æ ·ã€‚

```jsx
function FocusInput() {
  const inputRef = useRef(null);
  
  const handleFocus = () => {
    // ç›´æ¥æ“ä½œDOMå…ƒç´ 
    inputRef.current.focus();  // è®©è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
  };
  
  return (
    <div>
      {/* æŠŠè¾“å…¥æ¡†"ç»‘å®š"åˆ°refä¸Š */}
      <input ref={inputRef} type="text" />
      <button onClick={handleFocus}>ç‚¹å‡»èšç„¦è¾“å…¥æ¡†</button>
    </div>
  );
}
```

**ğŸ” æ‰§è¡Œè¿‡ç¨‹è§£æ**
```
1. ç»„ä»¶æ¸²æŸ“æ—¶ï¼šinputRef.current = null
2. DOMåˆ›å»ºåï¼šinputRef.current = å®é™…çš„inputå…ƒç´ 
3. ç‚¹å‡»æŒ‰é’®æ—¶ï¼šç›´æ¥è°ƒç”¨inputå…ƒç´ çš„focus()æ–¹æ³•
```

### 2.2 æ»šåŠ¨æ§åˆ¶ç¤ºä¾‹


```jsx
function ScrollToTop() {
  const topRef = useRef(null);
  
  const scrollToTop = () => {
    // æ»šåŠ¨åˆ°æŒ‡å®šå…ƒç´ ä½ç½®
    topRef.current.scrollIntoView({ 
      behavior: 'smooth'  // å¹³æ»‘æ»šåŠ¨
    });
  };
  
  return (
    <div>
      <div ref={topRef}>é¡µé¢é¡¶éƒ¨</div>
      {/* å¾ˆå¤šå†…å®¹... */}
      <div style={{ height: '1000px' }}>é•¿å†…å®¹åŒºåŸŸ</div>
      <button onClick={scrollToTop}>å›åˆ°é¡¶éƒ¨</button>
    </div>
  );
}
```

### 2.3 å¸¸ç”¨DOMæ“ä½œ


```jsx
function DOMOperations() {
  const elementRef = useRef(null);
  
  const handleOperations = () => {
    const element = elementRef.current;
    
    // å¸¸è§æ“ä½œ
    element.focus();                    // è·å–ç„¦ç‚¹
    element.click();                    // æ¨¡æ‹Ÿç‚¹å‡»
    element.scrollIntoView();          // æ»šåŠ¨åˆ°è§†å›¾
    element.style.backgroundColor = 'red'; // ä¿®æ”¹æ ·å¼
    
    // è·å–å…ƒç´ ä¿¡æ¯
    console.log(element.offsetHeight);  // å…ƒç´ é«˜åº¦
    console.log(element.value);         // è¾“å…¥æ¡†çš„å€¼
  };
  
  return <input ref={elementRef} />;
}
```

---

## 3. ğŸ’¾ æŒä¹…å˜é‡å­˜å‚¨


### 3.1 ä»€ä¹ˆæ˜¯æŒä¹…å˜é‡


**é€šä¿—è§£é‡Š**ï¼šå°±æ˜¯éœ€è¦åœ¨ç»„ä»¶é‡Œ"è®°ä½"æŸäº›å€¼ï¼Œä½†è¿™äº›å€¼å˜åŒ–æ—¶ä¸éœ€è¦é‡æ–°æ¸²æŸ“é¡µé¢ã€‚

```jsx
function Timer() {
  const [count, setCount] = useState(0);
  const timerRef = useRef(null);  // å­˜å‚¨å®šæ—¶å™¨ID
  
  const startTimer = () => {
    // æŠŠå®šæ—¶å™¨IDå­˜åœ¨refé‡Œ
    timerRef.current = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
  };
  
  const stopTimer = () => {
    // ä½¿ç”¨å­˜å‚¨çš„å®šæ—¶å™¨IDæ¥æ¸…é™¤å®šæ—¶å™¨
    clearInterval(timerRef.current);
  };
  
  return (
    <div>
      <p>è®¡æ•°: {count}</p>
      <button onClick={startTimer}>å¼€å§‹</button>
      <button onClick={stopTimer}>åœæ­¢</button>
    </div>
  );
}
```

**ğŸ”¸ ä¸ºä»€ä¹ˆä¸ç”¨æ™®é€šå˜é‡ï¼Ÿ**
```jsx
// âŒ é”™è¯¯åšæ³•ï¼šæ™®é€šå˜é‡ä¼šä¸¢å¤±
function BadTimer() {
  let timerId;  // ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¼šé‡ç½®ä¸ºundefined
  
  const startTimer = () => {
    timerId = setInterval(() => {}, 1000);
  };
}

// âœ… æ­£ç¡®åšæ³•ï¼šrefå˜é‡æŒä¹…ä¿å­˜
function GoodTimer() {
  const timerRef = useRef(null);  // é‡æ–°æ¸²æŸ“æ—¶ä¿æŒå€¼ä¸å˜
}
```

### 3.2 å­˜å‚¨ä»»æ„æ•°æ®


```jsx
function DataStorage() {
  const dataRef = useRef({
    clickCount: 0,
    lastClickTime: null,
    userPreferences: {}
  });
  
  const handleClick = () => {
    // æ›´æ–°å­˜å‚¨çš„æ•°æ®ï¼ˆä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼‰
    dataRef.current.clickCount += 1;
    dataRef.current.lastClickTime = Date.now();
    
    // åªæœ‰æ‰‹åŠ¨è°ƒç”¨setStateæ‰ä¼šé‡æ–°æ¸²æŸ“
    if (dataRef.current.clickCount % 5 === 0) {
      alert(`ä½ å·²ç»ç‚¹å‡»äº† ${dataRef.current.clickCount} æ¬¡ï¼`);
    }
  };
  
  return <button onClick={handleClick}>ç‚¹å‡»æˆ‘</button>;
}
```

---

## 4. âš–ï¸ useRefä¸useStateçš„åŒºåˆ«


### 4.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”


| ç‰¹æ€§ | **useState** | **useRef** |
|------|-------------|-----------|
| ğŸ”„ **æ›´æ–°è§¦å‘æ¸²æŸ“** | `ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶` | `ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶` |
| ğŸ“¦ **æ•°æ®å­˜å‚¨** | `çŠ¶æ€å€¼` | `currentå±æ€§` |
| ğŸ¯ **ä¸»è¦ç”¨é€”** | `é¡µé¢æ˜¾ç¤ºçš„æ•°æ®` | `å¹•åå·¥ä½œçš„æ•°æ®` |
| ğŸ’¡ **æ›´æ–°æ–¹å¼** | `setStateå‡½æ•°` | `ç›´æ¥èµ‹å€¼ç»™current` |

### 4.2 å®é™…å¯¹æ¯”ç¤ºä¾‹


```jsx
function StateVsRef() {
  const [stateCount, setStateCount] = useState(0);
  const refCount = useRef(0);
  
  const updateState = () => {
    setStateCount(prev => prev + 1);  // ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
    console.log('ç»„ä»¶é‡æ–°æ¸²æŸ“äº†ï¼');
  };
  
  const updateRef = () => {
    refCount.current += 1;  // ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
    console.log('refå€¼å˜äº†ï¼Œä½†ç»„ä»¶æ²¡æœ‰é‡æ–°æ¸²æŸ“');
  };
  
  return (
    <div>
      <p>çŠ¶æ€è®¡æ•°: {stateCount}</p>
      <p>refè®¡æ•°: {refCount.current}</p>
      <button onClick={updateState}>æ›´æ–°çŠ¶æ€</button>
      <button onClick={updateRef}>æ›´æ–°ref</button>
    </div>
  );
}
```

### 4.3 é€‰æ‹©ä½¿ç”¨åŸåˆ™


```
ä»€ä¹ˆæ—¶å€™ç”¨useStateï¼Ÿ
âœ… æ•°æ®éœ€è¦æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
âœ… æ•°æ®å˜åŒ–æ—¶é¡µé¢è¦æ›´æ–°
âœ… ç”¨æˆ·äº¤äº’éœ€è¦ç«‹å³åé¦ˆ

ä»€ä¹ˆæ—¶å€™ç”¨useRefï¼Ÿ
âœ… å­˜å‚¨DOMå…ƒç´ å¼•ç”¨
âœ… å­˜å‚¨å®šæ—¶å™¨ã€ç›‘å¬å™¨ID
âœ… ç¼“å­˜è®¡ç®—ç»“æœ
âœ… å­˜å‚¨ç¬¬ä¸‰æ–¹åº“å®ä¾‹
âœ… è®°å½•ä¸Šä¸€æ¬¡çš„å€¼
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 5.1 ç„¦ç‚¹ç®¡ç†


```jsx
function LoginForm() {
  const usernameRef = useRef(null);
  const passwordRef = useRef(null);
  
  const handleSubmit = (e) => {
    e.preventDefault();
    
    // éªŒè¯ç”¨æˆ·å
    if (!usernameRef.current.value) {
      usernameRef.current.focus();  // èšç„¦åˆ°ç”¨æˆ·åè¾“å…¥æ¡†
      alert('è¯·è¾“å…¥ç”¨æˆ·å');
      return;
    }
    
    // éªŒè¯å¯†ç 
    if (!passwordRef.current.value) {
      passwordRef.current.focus();  // èšç„¦åˆ°å¯†ç è¾“å…¥æ¡†
      alert('è¯·è¾“å…¥å¯†ç ');
      return;
    }
    
    // æäº¤è¡¨å•...
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input ref={usernameRef} placeholder="ç”¨æˆ·å" />
      <input ref={passwordRef} type="password" placeholder="å¯†ç " />
      <button type="submit">ç™»å½•</button>
    </form>
  );
}
```

### 5.2 ç¬¬ä¸‰æ–¹åº“é›†æˆ


```jsx
function ChartComponent() {
  const chartRef = useRef(null);
  const chartInstanceRef = useRef(null);
  
  useEffect(() => {
    // åˆ›å»ºå›¾è¡¨å®ä¾‹å¹¶ä¿å­˜åˆ°refä¸­
    chartInstanceRef.current = new Chart(chartRef.current, {
      type: 'bar',
      data: { /* å›¾è¡¨æ•°æ® */ }
    });
    
    // æ¸…ç†å‡½æ•°
    return () => {
      if (chartInstanceRef.current) {
        chartInstanceRef.current.destroy();
      }
    };
  }, []);
  
  const updateChart = () => {
    // ä½¿ç”¨ä¿å­˜çš„å›¾è¡¨å®ä¾‹æ›´æ–°æ•°æ®
    chartInstanceRef.current.data.datasets[0].data = [1, 2, 3, 4];
    chartInstanceRef.current.update();
  };
  
  return (
    <div>
      <canvas ref={chartRef}></canvas>
      <button onClick={updateChart}>æ›´æ–°å›¾è¡¨</button>
    </div>
  );
}
```

### 5.3 é˜²æŠ–å¤„ç†


```jsx
function SearchInput() {
  const [query, setQuery] = useState('');
  const timeoutRef = useRef(null);
  
  const handleSearch = (value) => {
    setQuery(value);
    
    // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    
    // è®¾ç½®æ–°çš„å®šæ—¶å™¨
    timeoutRef.current = setTimeout(() => {
      console.log('æ‰§è¡Œæœç´¢:', value);
      // å®é™…çš„æœç´¢é€»è¾‘...
    }, 500);
  };
  
  return (
    <input 
      value={query}
      onChange={(e) => handleSearch(e.target.value)}
      placeholder="è¾“å…¥å…³é”®è¯æœç´¢..."
    />
  );
}
```

### 5.4 æ»šåŠ¨ä½ç½®è®°å½•


```jsx
function ScrollManager() {
  const containerRef = useRef(null);
  const scrollPositionRef = useRef(0);
  
  const saveScrollPosition = () => {
    scrollPositionRef.current = containerRef.current.scrollTop;
  };
  
  const restoreScrollPosition = () => {
    containerRef.current.scrollTop = scrollPositionRef.current;
  };
  
  return (
    <div>
      <button onClick={saveScrollPosition}>ä¿å­˜æ»šåŠ¨ä½ç½®</button>
      <button onClick={restoreScrollPosition}>æ¢å¤æ»šåŠ¨ä½ç½®</button>
      
      <div 
        ref={containerRef}
        style={{ height: '200px', overflow: 'auto' }}
      >
        {/* å¾ˆå¤šå†…å®¹... */}
        {Array.from({length: 100}, (_, i) => (
          <p key={i}>å†…å®¹è¡Œ {i + 1}</p>
        ))}
      </div>
    </div>
  );
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 useRefçš„æœ¬è´¨ç†è§£


```
ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼š
â€¢ useRef = ä¸€ä¸ªæŒä¹…çš„"ç›’å­"ï¼Œè£…ç€currentå±æ€§
â€¢ ä¸»è¦ä½œç”¨ï¼šè®¿é—®DOM + å­˜å‚¨ä¸è§¦å‘æ¸²æŸ“çš„æ•°æ®
â€¢ å…³é”®ç‰¹ç‚¹ï¼šå€¼å˜åŒ–ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶

ğŸ”§ ä¸¤å¤§ç”¨é€”ï¼š
1. DOMæ“ä½œï¼šè·å–å…ƒç´ ã€æ§åˆ¶ç„¦ç‚¹ã€æ»šåŠ¨ç­‰
2. æ•°æ®å­˜å‚¨ï¼šå®šæ—¶å™¨IDã€å®ä¾‹å¯¹è±¡ã€ç¼“å­˜å€¼ç­‰
```

### 6.2 å¸¸ç”¨åœºæ™¯è®°å¿†


| åœºæ™¯ç±»å‹ | **å…·ä½“ç”¨é€”** | **æ ¸å¿ƒä»·å€¼** |
|---------|------------|-------------|
| ğŸ® **DOMæ§åˆ¶** | `ç„¦ç‚¹ç®¡ç†ã€æ»šåŠ¨æ§åˆ¶ã€å…ƒç´ æ“ä½œ` | `ç›´æ¥æ“ä½œé¡µé¢å…ƒç´ ` |
| â° **å®šæ—¶ç®¡ç†** | `å®šæ—¶å™¨IDã€å»¶è¿Ÿæ‰§è¡Œã€é˜²æŠ–èŠ‚æµ` | `æ§åˆ¶å¼‚æ­¥æ“ä½œ` |
| ğŸ“¦ **æ•°æ®ç¼“å­˜** | `è®¡ç®—ç»“æœã€ä¸Šæ¬¡å€¼ã€é…ç½®ä¿¡æ¯` | `é¿å…é‡å¤è®¡ç®—` |
| ğŸ”Œ **ç¬¬ä¸‰æ–¹é›†æˆ** | `å›¾è¡¨åº“ã€åœ°å›¾åº“ã€ç¼–è¾‘å™¨` | `ä¿å­˜å¤–éƒ¨å®ä¾‹` |

### 6.3 ä½¿ç”¨æ³¨æ„äº‹é¡¹


> âœ… **æ¨èåšæ³•**
> - ç”¨äºDOMæ“ä½œå’Œä¸éœ€è¦è§¦å‘æ¸²æŸ“çš„æ•°æ®
> - å­˜å‚¨å®šæ—¶å™¨ã€ç›‘å¬å™¨ID
> - ç¼“å­˜ç¬¬ä¸‰æ–¹åº“å®ä¾‹

> âš ï¸ **é¿å…åšæ³•**  
> - ä¸è¦æŠŠéœ€è¦æ˜¾ç¤ºçš„æ•°æ®æ”¾åœ¨refä¸­
> - ä¸è¦ç”¨refä»£æ›¿stateæ¥å­˜å‚¨ç»„ä»¶çŠ¶æ€
> - ä¿®æ”¹ref.currentåä¸ä¼šè‡ªåŠ¨æ›´æ–°UI

### 6.4 è®°å¿†å£è¯€


```
ğŸ§  useRefè®°å¿†æ³•ï¼š
"refæ˜¯ç›’å­è£…currentï¼ŒDOMæ“ä½œç¬¬ä¸€é€‰
 å€¼å˜ä¸ä¼šé‡æ¸²æŸ“ï¼Œå®šæ—¶å™¨IDæœ€å¸¸è§
 ç„¦ç‚¹æ»šåŠ¨æ ·æ ·è¡Œï¼Œç¬¬ä¸‰æ–¹åº“ä¹Ÿèƒ½è¿"
```

**ğŸ¯ å®æˆ˜è¦ç‚¹**
- **DOMå¼•ç”¨**ï¼š`<input ref={myRef} />` â†’ `myRef.current.focus()`
- **æŒä¹…å­˜å‚¨**ï¼š`const dataRef = useRef(åˆå§‹å€¼)` â†’ `dataRef.current = æ–°å€¼`
- **ä¸è§¦å‘æ¸²æŸ“**ï¼šæ”¹å˜refå€¼ä¸ä¼šè®©ç»„ä»¶é‡æ–°æ¸²æŸ“
- **å¸¸è§ç”¨é€”**ï¼šç„¦ç‚¹æ§åˆ¶ã€æ»šåŠ¨ç®¡ç†ã€å®šæ—¶å™¨ã€ç¬¬ä¸‰æ–¹åº“é›†æˆ