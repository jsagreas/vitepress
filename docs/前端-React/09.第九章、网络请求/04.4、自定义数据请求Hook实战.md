---
title: 4ã€è‡ªå®šä¹‰æ•°æ®è¯·æ±‚Hookå®æˆ˜
---
## ğŸ“š ç›®å½•

1. [è‡ªå®šä¹‰è¯·æ±‚Hookçš„å¿…è¦æ€§](#1-è‡ªå®šä¹‰è¯·æ±‚Hookçš„å¿…è¦æ€§)
2. [useFetchåŸºç¡€å®ç°](#2-useFetchåŸºç¡€å®ç°)
3. [è¯·æ±‚çŠ¶æ€ç®¡ç†](#3-è¯·æ±‚çŠ¶æ€ç®¡ç†)
4. [é”™è¯¯å¤„ç†æœºåˆ¶](#4-é”™è¯¯å¤„ç†æœºåˆ¶)
5. [æ•°æ®ç¼“å­˜ç­–ç•¥](#5-æ•°æ®ç¼“å­˜ç­–ç•¥)
6. [React Queryå®æˆ˜å¯¹æ¯”](#6-React-Queryå®æˆ˜å¯¹æ¯”)
7. [æœ€ä½³å®è·µæ€»ç»“](#7-æœ€ä½³å®è·µæ€»ç»“)

---

## 1. ğŸ¯ è‡ªå®šä¹‰è¯·æ±‚Hookçš„å¿…è¦æ€§


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰è¯·æ±‚Hook


**ç—›ç‚¹é—®é¢˜**ï¼š
```
åœ¨ç»„ä»¶ä¸­ç›´æ¥å†™è¯·æ±‚ä»£ç çš„é—®é¢˜ï¼š
- æ¯ä¸ªç»„ä»¶éƒ½è¦é‡å¤å†™loadingçŠ¶æ€
- é”™è¯¯å¤„ç†ä»£ç åˆ°å¤„éƒ½æ˜¯
- è¯·æ±‚é€»è¾‘æ— æ³•å¤ç”¨
- ç»„ä»¶ä»£ç å˜å¾—è‡ƒè‚¿éš¾ç»´æŠ¤
```

**ç”Ÿæ´»åŒ–ç±»æ¯”**ï¼š
> å°±åƒæ¯æ¬¡åšé¥­éƒ½è¦é‡æ–°å‡†å¤‡é”…ç¢—ç“¢ç›†ä¸€æ ·éº»çƒ¦ï¼Œå¦‚æœæœ‰ä¸ª"åšé¥­å·¥å…·åŒ…"ï¼Œæ¯æ¬¡ç›´æ¥æ‹¿æ¥ç”¨å°±æ–¹ä¾¿å¤šäº†

### 1.2 Hookè§£å†³çš„æ ¸å¿ƒé—®é¢˜


```
ä¼ ç»Ÿæ–¹å¼ vs Hookæ–¹å¼ï¼š

âŒ ä¼ ç»Ÿæ–¹å¼ï¼ˆé‡å¤åŠ³åŠ¨ï¼‰ï¼š
- æ¯ä¸ªç»„ä»¶éƒ½å†™ useState(loading)
- æ¯ä¸ªç»„ä»¶éƒ½å†™ useState(data)  
- æ¯ä¸ªç»„ä»¶éƒ½å†™ useState(error)
- æ¯ä¸ªç»„ä»¶éƒ½å†™ try-catch

âœ… Hookæ–¹å¼ï¼ˆä¸€æ¬¡å°è£…ï¼Œåˆ°å¤„å¤ç”¨ï¼‰ï¼š
- const { data, loading, error } = useFetch(url)
- è‡ªåŠ¨å¤„ç†æ‰€æœ‰çŠ¶æ€
- è‡ªåŠ¨å¤„ç†é”™è¯¯
- ä»£ç ç®€æ´ä¼˜é›…
```

### 1.3 Hookçš„æ ¸å¿ƒä»·å€¼


| **ä»·å€¼** | **å…·ä½“ä½“ç°** | **å®é™…æ•ˆæœ** |
|---------|-------------|-------------|
| **ğŸ”„ å¤ç”¨æ€§** | `ä¸€æ¬¡ç¼–å†™ï¼Œå¤šå¤„ä½¿ç”¨` | `å‡å°‘90%é‡å¤ä»£ç ` |
| **ğŸ›¡ï¸ å¯é æ€§** | `ç»Ÿä¸€çš„é”™è¯¯å¤„ç†` | `é¿å…é—æ¼å¼‚å¸¸æƒ…å†µ` |
| **ğŸ“Š çŠ¶æ€ç®¡ç†** | `è‡ªåŠ¨ç®¡ç†loading/error` | `ç”¨æˆ·ä½“éªŒæ›´å¥½` |
| **ğŸ§¹ ä»£ç æ•´æ´** | `ä¸šåŠ¡é€»è¾‘ä¸UIåˆ†ç¦»` | `ç»„ä»¶æ›´åŠ çº¯ç²¹` |

---

## 2. ğŸ”§ useFetchåŸºç¡€å®ç°


### 2.1 æœ€ç®€å•çš„useFetch


```javascript
// åŸºç¡€ç‰ˆæœ¬ - æ ¸å¿ƒæ€è·¯
function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    // å¼€å§‹è¯·æ±‚
    setLoading(true);
    setError(null);
    
    fetch(url)
      .then(response => response.json())
      .then(data => {
        setData(data);
        setLoading(false);
      })
      .catch(err => {
        setError(err.message);
        setLoading(false);
      });
  }, [url]);

  return { data, loading, error };
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
function UserList() {
  const { data, loading, error } = useFetch('/api/users');

  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>å‡ºé”™äº†: {error}</div>;
  
  return (
    <ul>
      {data?.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

### 2.2 æ”¹è¿›ç‰ˆuseFetch


```javascript
// æ”¹è¿›ç‰ˆ - æ·»åŠ è¯·æ±‚å–æ¶ˆå’Œæ›´å¥½çš„é”™è¯¯å¤„ç†
function useFetch(url, options = {}) {
  const [state, setState] = useState({
    data: null,
    loading: true,
    error: null
  });

  useEffect(() => {
    // åˆ›å»ºAbortControllerç”¨äºå–æ¶ˆè¯·æ±‚
    const controller = new AbortController();
    
    const fetchData = async () => {
      try {
        setState(prev => ({ ...prev, loading: true, error: null }));
        
        const response = await fetch(url, {
          ...options,
          signal: controller.signal // æ”¯æŒè¯·æ±‚å–æ¶ˆ
        });
        
        if (!response.ok) {
          throw new Error(`HTTP Error: ${response.status}`);
        }
        
        const data = await response.json();
        
        setState({
          data,
          loading: false,
          error: null
        });
      } catch (err) {
        // å¦‚æœæ˜¯ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆï¼Œä¸ç®—é”™è¯¯
        if (err.name !== 'AbortError') {
          setState(prev => ({
            ...prev,
            loading: false,
            error: err.message
          }));
        }
      }
    };

    fetchData();

    // æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
    return () => controller.abort();
  }, [url]);

  return state;
}
```

**ğŸ“‹ æ”¹è¿›è¦ç‚¹è¯´æ˜**ï¼š
- **è¯·æ±‚å–æ¶ˆ**ï¼šé˜²æ­¢ç»„ä»¶å¸è½½åè¿˜åœ¨æ›´æ–°çŠ¶æ€
- **HTTPçŠ¶æ€æ£€æŸ¥**ï¼šåŒºåˆ†ç½‘ç»œé”™è¯¯å’ŒHTTPé”™è¯¯
- **ç»Ÿä¸€çŠ¶æ€ç®¡ç†**ï¼šç”¨ä¸€ä¸ªå¯¹è±¡ç®¡ç†æ‰€æœ‰çŠ¶æ€

---

## 3. ğŸ“Š è¯·æ±‚çŠ¶æ€ç®¡ç†


### 3.1 å®Œæ•´çš„çŠ¶æ€ç”Ÿå‘½å‘¨æœŸ


```
è¯·æ±‚çŠ¶æ€æµè½¬å›¾ï¼š

åˆå§‹çŠ¶æ€          å¼€å§‹è¯·æ±‚           è¯·æ±‚æˆåŠŸ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚loading: â”‚ â”€â”€â”€> â”‚loading: â”‚ â”€â”€â”€>  â”‚loading: â”‚
â”‚  false  â”‚      â”‚  true   â”‚       â”‚  false  â”‚
â”‚data: null      â”‚data: null       â”‚data: å®é™…æ•°æ®
â”‚error: null     â”‚error: null      â”‚error: null
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                   
     â”‚           è¯·æ±‚å¤±è´¥                    
     â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                
     â””â”€â”€â”€â”€â”€â”€â”€â”€> â”‚loading: â”‚                
                â”‚  false  â”‚                
                â”‚data: null                
                â”‚error: é”™è¯¯ä¿¡æ¯             
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                
```

### 3.2 çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ


```javascript
// å®Œæ•´çŠ¶æ€ç®¡ç†ç‰ˆæœ¬
function useFetch(url, options = {}) {
  const [state, setState] = useState({
    data: null,
    loading: false,  // åˆå§‹ä¸åŠ è½½
    error: null,
    isFirstLoad: true // åŒºåˆ†é¦–æ¬¡åŠ è½½å’Œé‡æ–°åŠ è½½
  });

  // æ‰‹åŠ¨è§¦å‘è¯·æ±‚çš„å‡½æ•°
  const refetch = useCallback(async () => {
    const controller = new AbortController();
    
    try {
      setState(prev => ({
        ...prev,
        loading: true,
        error: null,
        isFirstLoad: false
      }));

      const response = await fetch(url, {
        ...options,
        signal: controller.signal
      });

      if (!response.ok) {
        throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status}`);
      }

      const data = await response.json();
      
      setState(prev => ({
        ...prev,
        data,
        loading: false,
        error: null
      }));

    } catch (err) {
      if (err.name !== 'AbortError') {
        setState(prev => ({
          ...prev,
          loading: false,
          error: err.message
        }));
      }
    }

    return controller;
  }, [url, options]);

  // è‡ªåŠ¨è¯·æ±‚
  useEffect(() => {
    const controller = refetch();
    return () => controller?.abort?.();
  }, [refetch]);

  return {
    ...state,
    refetch // æš´éœ²æ‰‹åŠ¨åˆ·æ–°æ–¹æ³•
  };
}
```

**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| **çŠ¶æ€** | **UIè¡¨ç°** | **ç”¨æˆ·æ“ä½œ** |
|---------|-----------|-------------|
| `isFirstLoad: true` | `éª¨æ¶å±/å ä½ç¬¦` | `ç­‰å¾…å†…å®¹å‡ºç°` |
| `loading: true` | `åŠ è½½æŒ‡ç¤ºå™¨` | `å¯ä»¥å–æ¶ˆæ“ä½œ` |
| `error: å­˜åœ¨` | `é”™è¯¯æç¤º + é‡è¯•æŒ‰é’®` | `ç‚¹å‡»é‡è¯•` |
| `data: å­˜åœ¨` | `æ­£å¸¸æ˜¾ç¤ºå†…å®¹` | `æ­£å¸¸äº¤äº’` |

---

## 4. ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶


### 4.1 é”™è¯¯åˆ†ç±»å’Œå¤„ç†


**é”™è¯¯ç±»å‹åˆ†æ**ï¼š
```
ç½‘ç»œè¯·æ±‚å¯èƒ½é‡åˆ°çš„é”™è¯¯ï¼š

ğŸŒ ç½‘ç»œé”™è¯¯
â”œâ”€â”€ æ–­ç½‘ (Network Error)
â”œâ”€â”€ è¶…æ—¶ (Timeout)  
â””â”€â”€ DNSè§£æå¤±è´¥

ğŸ“¡ HTTPé”™è¯¯
â”œâ”€â”€ 404 (èµ„æºä¸å­˜åœ¨)
â”œâ”€â”€ 401 (æœªæˆæƒ)
â”œâ”€â”€ 403 (ç¦æ­¢è®¿é—®)
â”œâ”€â”€ 500 (æœåŠ¡å™¨é”™è¯¯)
â””â”€â”€ 503 (æœåŠ¡ä¸å¯ç”¨)

ğŸ“„ æ•°æ®é”™è¯¯
â”œâ”€â”€ JSONè§£æå¤±è´¥
â”œâ”€â”€ æ•°æ®æ ¼å¼ä¸ç¬¦åˆé¢„æœŸ
â””â”€â”€ ç©ºæ•°æ®å¤„ç†
```

### 4.2 ç»Ÿä¸€é”™è¯¯å¤„ç†å®ç°


```javascript
// å¸¦é”™è¯¯å¤„ç†çš„useFetch
function useFetch(url, options = {}) {
  const [state, setState] = useState({
    data: null,
    loading: false,
    error: null,
    errorType: null // é”™è¯¯ç±»å‹
  });

  const handleError = (error) => {
    let errorType = 'unknown';
    let userMessage = 'å‡ºé”™äº†ï¼Œè¯·ç¨åé‡è¯•';

    // æ ¹æ®é”™è¯¯ç±»å‹ç»™å‡ºç”¨æˆ·å‹å¥½çš„æç¤º
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
      errorType = 'network';
      userMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
    } else if (error.message.includes('404')) {
      errorType = 'notFound';
      userMessage = 'è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨';
    } else if (error.message.includes('401')) {
      errorType = 'unauthorized';
      userMessage = 'éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®';
    } else if (error.message.includes('500')) {
      errorType = 'serverError';
      userMessage = 'æœåŠ¡å™¨å‡ºé”™äº†ï¼Œè¯·ç¨åé‡è¯•';
    }

    return { errorType, userMessage };
  };

  const fetchData = async () => {
    try {
      setState(prev => ({ ...prev, loading: true, error: null }));

      const response = await fetch(url, {
        timeout: 10000, // 10ç§’è¶…æ—¶
        ...options
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      const data = await response.json();
      
      setState({
        data,
        loading: false,
        error: null,
        errorType: null
      });

    } catch (err) {
      const { errorType, userMessage } = handleError(err);
      
      setState(prev => ({
        ...prev,
        loading: false,
        error: userMessage,
        errorType
      }));
    }
  };

  return {
    ...state,
    retry: fetchData // é‡è¯•æ–¹æ³•
  };
}
```

### 4.3 é”™è¯¯UIç»„ä»¶


```javascript
// é”™è¯¯å¤„ç†ç»„ä»¶
function ErrorDisplay({ error, errorType, onRetry }) {
  const getErrorConfig = (errorType) => {
    switch (errorType) {
      case 'network':
        return {
          icon: 'ğŸŒ',
          title: 'ç½‘ç»œè¿æ¥å¤±è´¥',
          action: 'æ£€æŸ¥ç½‘ç»œåé‡è¯•'
        };
      case 'unauthorized':
        return {
          icon: 'ğŸ”',
          title: 'éœ€è¦ç™»å½•',
          action: 'å»ç™»å½•'
        };
      case 'notFound':
        return {
          icon: 'ğŸ”',
          title: 'å†…å®¹ä¸å­˜åœ¨',
          action: 'è¿”å›é¦–é¡µ'
        };
      default:
        return {
          icon: 'âš ï¸',
          title: 'å‡ºé”™äº†',
          action: 'é‡è¯•'
        };
    }
  };

  const config = getErrorConfig(errorType);

  return (
    <div className="error-container">
      <div className="error-icon">{config.icon}</div>
      <h3>{config.title}</h3>
      <p>{error}</p>
      <button onClick={onRetry}>{config.action}</button>
    </div>
  );
}
```

---

## 5. ğŸ’¾ æ•°æ®ç¼“å­˜ç­–ç•¥


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜


**å®é™…åœºæ™¯**ï¼š
```
ç”¨æˆ·è¡Œä¸ºåˆ†æï¼š
ç”¨æˆ·è®¿é—®é¡µé¢A â†’ æŸ¥çœ‹é¡µé¢B â†’ è¿”å›é¡µé¢A

âŒ æ— ç¼“å­˜ï¼š
- æ¯æ¬¡éƒ½é‡æ–°è¯·æ±‚
- ç”¨æˆ·çœ‹åˆ°loading
- æµªè´¹ç½‘ç»œèµ„æº
- ç”¨æˆ·ä½“éªŒå·®

âœ… æœ‰ç¼“å­˜ï¼š
- ç«‹å³æ˜¾ç¤ºä¸Šæ¬¡çš„æ•°æ®
- åå°åˆ·æ–°æ•°æ®
- èŠ‚çœç½‘ç»œèµ„æº
- ç”¨æˆ·ä½“éªŒå¥½
```

### 5.2 ç®€å•ç¼“å­˜å®ç°


```javascript
// å…¨å±€ç¼“å­˜å¯¹è±¡
const cache = new Map();

function useFetchWithCache(url, options = {}) {
  const cacheKey = `${url}_${JSON.stringify(options)}`;
  const [state, setState] = useState({
    data: cache.get(cacheKey) || null, // åˆå§‹ä»ç¼“å­˜è¯»å–
    loading: !cache.has(cacheKey),     // æœ‰ç¼“å­˜å°±ä¸æ˜¾ç¤ºloading
    error: null
  });

  useEffect(() => {
    const fetchData = async () => {
      try {
        // å¦‚æœæœ‰ç¼“å­˜ï¼Œåå°æ›´æ–°ï¼›æ²¡æœ‰ç¼“å­˜ï¼Œæ˜¾ç¤ºloading
        if (!cache.has(cacheKey)) {
          setState(prev => ({ ...prev, loading: true }));
        }

        const response = await fetch(url, options);
        const data = await response.json();

        // æ›´æ–°ç¼“å­˜
        cache.set(cacheKey, data);
        
        setState({
          data,
          loading: false,
          error: null
        });

      } catch (err) {
        setState(prev => ({
          ...prev,
          loading: false,
          error: err.message
        }));
      }
    };

    fetchData();
  }, [url, cacheKey]);

  return state;
}
```

### 5.3 å¸¦è¿‡æœŸæ—¶é—´çš„ç¼“å­˜


```javascript
// å¢å¼ºç‰ˆç¼“å­˜ - æ”¯æŒè¿‡æœŸæ—¶é—´
class CacheManager {
  constructor() {
    this.cache = new Map();
  }

  set(key, data, ttl = 5 * 60 * 1000) { // é»˜è®¤5åˆ†é’Ÿè¿‡æœŸ
    const expireTime = Date.now() + ttl;
    this.cache.set(key, { data, expireTime });
  }

  get(key) {
    const item = this.cache.get(key);
    if (!item) return null;

    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if (Date.now() > item.expireTime) {
      this.cache.delete(key);
      return null;
    }

    return item.data;
  }

  has(key) {
    return this.get(key) !== null;
  }
}

const cacheManager = new CacheManager();

function useFetchWithSmartCache(url, options = {}) {
  const cacheKey = `${url}_${JSON.stringify(options)}`;
  const cachedData = cacheManager.get(cacheKey);
  
  const [state, setState] = useState({
    data: cachedData,
    loading: !cachedData,
    error: null,
    isStale: false // æ•°æ®æ˜¯å¦è¿‡æ—¶
  });

  useEffect(() => {
    const fetchData = async () => {
      try {
        // æœ‰ç¼“å­˜æ—¶ï¼Œå…ˆæ˜¾ç¤ºç¼“å­˜æ•°æ®ï¼Œæ ‡è®°ä¸ºå¯èƒ½è¿‡æ—¶
        if (cachedData) {
          setState(prev => ({ ...prev, isStale: true }));
        } else {
          setState(prev => ({ ...prev, loading: true }));
        }

        const response = await fetch(url, options);
        const data = await response.json();

        // æ›´æ–°ç¼“å­˜
        cacheManager.set(cacheKey, data);
        
        setState({
          data,
          loading: false,
          error: null,
          isStale: false
        });

      } catch (err) {
        setState(prev => ({
          ...prev,
          loading: false,
          error: err.message,
          isStale: false
        }));
      }
    };

    fetchData();
  }, [url, cacheKey]);

  return state;
}
```

**ç¼“å­˜ç­–ç•¥å¯¹æ¯”**ï¼š

| **ç­–ç•¥** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **æ— ç¼“å­˜** | `æ•°æ®æœ€æ–°` | `æ¯æ¬¡éƒ½è¯·æ±‚ï¼Œæ…¢` | `å®æ—¶æ€§è¦æ±‚æé«˜` |
| **æ°¸ä¹…ç¼“å­˜** | `é€Ÿåº¦å¿«` | `æ•°æ®å¯èƒ½è¿‡æ—¶` | `é™æ€å†…å®¹` |
| **TTLç¼“å­˜** | `å¹³è¡¡æ€§èƒ½å’Œæ–°é²œåº¦` | `å®ç°å¤æ‚` | `å¤§å¤šæ•°åœºæ™¯` |
| **SWRç­–ç•¥** | `ç”¨æˆ·ä½“éªŒæœ€å¥½` | `å¯èƒ½æ˜¾ç¤ºè¿‡æ—¶æ•°æ®` | `ç”¨æˆ·äº¤äº’é¢‘ç¹` |

---

## 6. ğŸš€ React Queryå®æˆ˜å¯¹æ¯”


### 6.1 React Queryç®€ä»‹


**ä»€ä¹ˆæ˜¯React Query**ï¼š
> React Queryæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ•°æ®è·å–çš„åº“ï¼Œå®ƒæŠŠæ•°æ®è¯·æ±‚ã€ç¼“å­˜ã€åŒæ­¥ç­‰å¤æ‚æ“ä½œéƒ½å°è£…å¥½äº†ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘

**æ ¸å¿ƒç‰¹æ€§**ï¼š
```
ğŸ”¥ æ ¸å¿ƒèƒ½åŠ›ï¼š
- è‡ªåŠ¨ç¼“å­˜ç®¡ç†
- åå°æ•°æ®åŒæ­¥
- ä¹è§‚æ›´æ–°
- ç¦»çº¿æ”¯æŒ
- è¯·æ±‚å»é‡
- è‡ªåŠ¨é‡è¯•
```

### 6.2 React Query vs è‡ªå®šä¹‰Hook


```javascript
// è‡ªå®šä¹‰Hookæ–¹å¼
function UserProfile({ userId }) {
  const { data, loading, error } = useFetch(`/api/users/${userId}`);
  
  if (loading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error}</div>;
  
  return <div>{data?.name}</div>;
}

// React Queryæ–¹å¼
import { useQuery } from 'react-query';

function UserProfile({ userId }) {
  const { data, isLoading, error } = useQuery(
    ['user', userId], 
    () => fetch(`/api/users/${userId}`).then(res => res.json())
  );
  
  if (isLoading) return <div>åŠ è½½ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error.message}</div>;
  
  return <div>{data?.name}</div>;
}
```

### 6.3 åŠŸèƒ½å¯¹æ¯”è¡¨


| **åŠŸèƒ½** | **è‡ªå®šä¹‰Hook** | **React Query** | **è¯´æ˜** |
|---------|---------------|-----------------|---------|
| **åŸºç¡€è¯·æ±‚** | âœ… `æ‰‹åŠ¨å®ç°` | âœ… `å¼€ç®±å³ç”¨` | `RQæ›´ç®€å•` |
| **è‡ªåŠ¨ç¼“å­˜** | âš ï¸ `éœ€è¦æ‰‹åŠ¨å®ç°` | âœ… `è‡ªåŠ¨å¤„ç†` | `RQèƒœå‡º` |
| **è¯·æ±‚å»é‡** | âŒ `éœ€è¦è‡ªå·±å®ç°` | âœ… `è‡ªåŠ¨å»é‡` | `RQé˜²æ­¢é‡å¤è¯·æ±‚` |
| **åå°åˆ·æ–°** | âš ï¸ `æ‰‹åŠ¨å®ç°` | âœ… `è‡ªåŠ¨åˆ·æ–°` | `RQç”¨æˆ·ä½“éªŒæ›´å¥½` |
| **ç¦»çº¿æ”¯æŒ** | âŒ `ä¸æ”¯æŒ` | âœ… `æ”¯æŒ` | `RQåŠŸèƒ½æ›´å¼º` |
| **åŒ…å¤§å°** | âœ… `å¾ˆå°` | âš ï¸ `ç›¸å¯¹è¾ƒå¤§` | `è‡ªå®šä¹‰Hookèƒœå‡º` |
| **å­¦ä¹ æˆæœ¬** | âœ… `ç®€å•ç›´æ¥` | âš ï¸ `éœ€è¦å­¦ä¹ API` | `è‡ªå®šä¹‰Hookæ›´ç›´è§‚` |

### 6.4 é€‰æ‹©å»ºè®®


```
ğŸ¯ é€‰æ‹©æŒ‡å—ï¼š

é€‰æ‹©è‡ªå®šä¹‰Hookçš„æƒ…å†µï¼š
âœ… é¡¹ç›®ç®€å•ï¼Œè¯·æ±‚ä¸å¤š
âœ… å¯¹åŒ…å¤§å°æ•æ„Ÿ
âœ… å›¢é˜Ÿå¯¹ç¬¬ä¸‰æ–¹åº“æœ‰é™åˆ¶
âœ… è¯·æ±‚é€»è¾‘ç®€å•ä¸”å›ºå®š

é€‰æ‹©React Queryçš„æƒ…å†µï¼š
âœ… é¡¹ç›®å¤æ‚ï¼Œæ•°æ®äº¤äº’å¤š
âœ… éœ€è¦å¤æ‚çš„ç¼“å­˜ç­–ç•¥
âœ… ç”¨æˆ·ä½“éªŒè¦æ±‚é«˜
âœ… å›¢é˜Ÿå¯ä»¥æ¥å—å­¦ä¹ æˆæœ¬
```

---

## 7. ğŸ“‹ æœ€ä½³å®è·µæ€»ç»“


### 7.1 Hookè®¾è®¡åŸåˆ™


**ğŸ¯ è®¾è®¡è¦ç‚¹**ï¼š
```
å•ä¸€èŒè´£ï¼š
- ä¸€ä¸ªHookåªåšä¸€ä»¶äº‹
- useFetchä¸“é—¨è´Ÿè´£æ•°æ®è·å–
- ä¸è¦æŠŠUIé€»è¾‘æ··è¿›æ¥

APIç®€æ´ï¼š
- è¿”å›å€¼è¦ç›´è§‚ { data, loading, error }
- å‚æ•°è¦ç®€å•ï¼Œå¸¸ç”¨çš„æ”¾å‰é¢
- æä¾›åˆç†çš„é»˜è®¤å€¼

é”™è¯¯å¤„ç†ï¼š
- æ°¸è¿œä¸è¦è®©é”™è¯¯æ‚„æ‚„å‘ç”Ÿ
- ç»™ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- æä¾›é‡è¯•æœºåˆ¶
```

### 7.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


```javascript
// âš¡ æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
function useFetch(url, options = {}) {
  // 1. ä½¿ç”¨useCallbacké¿å…æ— é™å¾ªç¯
  const fetchData = useCallback(async () => {
    // è¯·æ±‚é€»è¾‘
  }, [url, JSON.stringify(options)]);

  // 2. é˜²æŠ–å¤„ç† - é¿å…é¢‘ç¹è¯·æ±‚
  const debouncedFetch = useDebounce(fetchData, 300);

  // 3. è¯·æ±‚å»é‡ - ç›¸åŒè¯·æ±‚åªå‘ä¸€æ¬¡
  const requestId = useMemo(() => 
    `${url}_${JSON.stringify(options)}`, [url, options]
  );

  useEffect(() => {
    debouncedFetch();
  }, [debouncedFetch]);

  return state;
}

// é˜²æŠ–Hook
function useDebounce(callback, delay) {
  const timeoutRef = useRef();
  
  return useCallback((...args) => {
    clearTimeout(timeoutRef.current);
    timeoutRef.current = setTimeout(() => callback(...args), delay);
  }, [callback, delay]);
}
```

### 7.3 å¸¸è§é—®é¢˜è§£å†³


**ğŸ”§ é—®é¢˜æ’æŸ¥æ¸…å•**ï¼š

| **é—®é¢˜** | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| `æ— é™è¯·æ±‚` | `ä¾èµ–é¡¹å˜åŒ–` | `æ£€æŸ¥useEffectä¾èµ–` |
| `å†…å­˜æ³„æ¼` | `ç»„ä»¶å¸è½½åæ›´æ–°çŠ¶æ€` | `æ·»åŠ æ¸…ç†å‡½æ•°` |
| `è¯·æ±‚ä¸å‘é€` | `URLä¸ºç©ºæˆ–undefined` | `æ·»åŠ URLæœ‰æ•ˆæ€§æ£€æŸ¥` |
| `ç¼“å­˜ä¸ç”Ÿæ•ˆ` | `ç¼“å­˜keyè®¡ç®—é”™è¯¯` | `æ£€æŸ¥ç¼“å­˜keyé€»è¾‘` |
| `é”™è¯¯å¤„ç†å¤±æ•ˆ` | `catchå—ç¼ºå¤±` | `å®Œå–„é”™è¯¯æ•è·` |

### 7.4 å®æˆ˜åº”ç”¨æ¨¡å¼


```javascript
// ğŸ† ç”Ÿäº§çº§åˆ«çš„useFetch Hook
export function useFetch(url, options = {}) {
  const {
    method = 'GET',
    headers = {},
    body = null,
    cache = true,
    retry = 3,
    timeout = 10000
  } = options;

  const [state, setState] = useState({
    data: null,
    loading: false,
    error: null,
    isValidating: false
  });

  // å®Œæ•´çš„è¯·æ±‚é€»è¾‘...
  
  return {
    ...state,
    refetch: () => fetchData(),
    mutate: (newData) => setState(prev => ({ ...prev, data: newData }))
  };
}

// ä½¿ç”¨ç¤ºä¾‹
function ProductList() {
  const { data: products, loading, error, refetch } = useFetch('/api/products');
  
  return (
    <div>
      {loading && <LoadingSpinner />}
      {error && <ErrorMessage error={error} onRetry={refetch} />}
      {products && <ProductGrid products={products} />}
    </div>
  );
}
```

### 7.5 æ ¸å¿ƒè¦ç‚¹è®°å¿†


**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
è¯·æ±‚å°è£…ä¸‰ä»¶äº‹ï¼š
çŠ¶æ€ç®¡ç†è¦å®Œæ•´ï¼Œé”™è¯¯å¤„ç†è¦å‹å¥½ï¼Œç¼“å­˜ç­–ç•¥è¦åˆç†

Hookè®¾è®¡äº”åŸåˆ™ï¼š
èŒè´£å•ä¸€ã€APIç®€æ´ã€æ€§èƒ½ä¼˜å…ˆã€é”™è¯¯å®‰å…¨ã€ç”¨æˆ·å‹å¥½
```

**ğŸ¯ å…³é”®ç†è§£**ï¼š
- **è‡ªå®šä¹‰Hook** = æŠŠé‡å¤çš„é€»è¾‘æŠ½å–å‡ºæ¥ï¼Œè®©ç»„ä»¶æ›´å¹²å‡€
- **çŠ¶æ€ç®¡ç†** = loadingã€dataã€errorä¸‰ä¸ªçŠ¶æ€ç¼ºä¸€ä¸å¯  
- **é”™è¯¯å¤„ç†** = è¦ç»™ç”¨æˆ·æ˜ç¡®çš„æç¤ºå’Œè§£å†³æ–¹æ¡ˆ
- **ç¼“å­˜ç­–ç•¥** = å¹³è¡¡æ•°æ®æ–°é²œåº¦å’Œç”¨æˆ·ä½“éªŒ
- **æ€§èƒ½ä¼˜åŒ–** = é˜²æ­¢æ— é™å¾ªç¯å’Œä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

---

> ğŸ’¡ **å­¦ä¹ æç¤º**ï¼šè‡ªå®šä¹‰è¯·æ±‚Hookæ˜¯Reactè¿›é˜¶çš„é‡è¦æŠ€èƒ½ã€‚å…ˆæŒæ¡åŸºç¡€ç‰ˆæœ¬ï¼Œå†é€æ­¥æ·»åŠ ç¼“å­˜ã€é”™è¯¯å¤„ç†ç­‰é«˜çº§ç‰¹æ€§ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®å…ˆå°è¯•è‡ªå·±å®ç°ï¼Œç†è§£åŸç†åå†è€ƒè™‘ä½¿ç”¨React Queryç­‰æˆç†Ÿåº“ã€‚