---
title: 2ã€Reactä¸­çš„æ•°æ®è·å–
---
## ğŸ“š ç›®å½•

1. [æ•°æ®è·å–åŸºæœ¬æ¦‚å¿µ](#1-æ•°æ®è·å–åŸºæœ¬æ¦‚å¿µ)
2. [useEffectä¸­å‘é€è¯·æ±‚](#2-useeffectä¸­å‘é€è¯·æ±‚)
3. [è¯·æ±‚çŠ¶æ€ç®¡ç†ä¸‰ä»¶å¥—](#3-è¯·æ±‚çŠ¶æ€ç®¡ç†ä¸‰ä»¶å¥—)
4. [è¯·æ±‚å–æ¶ˆä¸å†…å­˜æ³„æ¼](#4-è¯·æ±‚å–æ¶ˆä¸å†…å­˜æ³„æ¼)
5. [è‡ªå®šä¹‰Hookå°è£…](#5-è‡ªå®šä¹‰hookå°è£…)
6. [Axiosé›†æˆä¸æ¥å£æŠ½ç¦»](#6-axiosé›†æˆä¸æ¥å£æŠ½ç¦»)
7. [é«˜çº§è¯·æ±‚å¤„ç†](#7-é«˜çº§è¯·æ±‚å¤„ç†)
8. [ç¬¬ä¸‰æ–¹æ•°æ®è¯·æ±‚åº“](#8-ç¬¬ä¸‰æ–¹æ•°æ®è¯·æ±‚åº“)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ æ•°æ®è·å–åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®è·å–

**ç®€å•ç†è§£**ï¼šå°±æ˜¯ä»æœåŠ¡å™¨æˆ–APIæ¥å£æ‹¿æ•°æ®åˆ°æˆ‘ä»¬çš„Reactåº”ç”¨ä¸­æ˜¾ç¤º

```
ç”¨æˆ·æ‰“å¼€é¡µé¢ â†’ Reactç»„ä»¶éœ€è¦æ•°æ® â†’ å‘è¯·æ±‚åˆ°æœåŠ¡å™¨ â†’ æ‹¿åˆ°æ•°æ® â†’ æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š

å°±åƒå»é¤å…ç‚¹èœï¼š
ä½ ï¼ˆç”¨æˆ·ï¼‰ â†’ æœåŠ¡å‘˜ï¼ˆReactç»„ä»¶ï¼‰ â†’ å¨æˆ¿ï¼ˆæœåŠ¡å™¨ï¼‰ â†’ èœå“ï¼ˆæ•°æ®ï¼‰ â†’ ç«¯åˆ°æ¡Œä¸Šï¼ˆæ˜¾ç¤ºï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆè¦ç”¨useEffect

**ğŸ¤” ä¸ºä»€ä¹ˆä¸ç›´æ¥åœ¨ç»„ä»¶é‡Œå‘è¯·æ±‚ï¼Ÿ**

```jsx
// âŒ é”™è¯¯åšæ³• - ç›´æ¥åœ¨ç»„ä»¶é‡Œå‘è¯·æ±‚
function UserList() {
  const [users, setUsers] = useState([])
  
  // æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“éƒ½ä¼šå‘è¯·æ±‚ï¼æ— é™å¾ªç¯ï¼
  fetch('/api/users').then(res => res.json()).then(setUsers)
  
  return <div>{/* æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ */}</div>
}
```

**âœ… æ­£ç¡®åšæ³• - ç”¨useEffect**
```jsx
function UserList() {
  const [users, setUsers] = useState([])
  
  useEffect(() => {
    // åªåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡åŠ è½½æ—¶å‘è¯·æ±‚
    fetch('/api/users').then(res => res.json()).then(setUsers)
  }, []) // ç©ºä¾èµ–æ•°ç»„ï¼Œåªæ‰§è¡Œä¸€æ¬¡
  
  return <div>{/* æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ */}</div>
}
```

**ğŸ’¡ æ ¸å¿ƒç†è§£**ï¼š
- **useEffect** = "ç»„ä»¶åŠ è½½å®ŒæˆååšæŸäº‹"
- **ç©ºä¾èµ–æ•°ç»„[]** = "åªæ‰§è¡Œä¸€æ¬¡"
- **æœ‰ä¾èµ–æ•°ç»„[id]** = "ä¾èµ–å˜åŒ–æ—¶æ‰§è¡Œ"

---

## 2. âš¡ useEffectä¸­å‘é€è¯·æ±‚


### 2.1 åŸºæœ¬è¯·æ±‚å†™æ³•


**ğŸ”¸ æœ€ç®€å•çš„æ•°æ®è·å–**
```jsx
import { useState, useEffect } from 'react'

function UserProfile({ userId }) {
  const [user, setUser] = useState(null)
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(response => response.json())
      .then(userData => setUser(userData))
  }, [userId]) // userIdå˜åŒ–æ—¶é‡æ–°è¯·æ±‚
  
  if (!user) return <div>åŠ è½½ä¸­...</div>
  
  return (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
    </div>
  )
}
```

### 2.2 async/awaitçš„æ­£ç¡®å†™æ³•


**âŒ é”™è¯¯å†™æ³• - useEffectä¸èƒ½ç›´æ¥async**
```jsx
// è¿™æ ·å†™ä¼šæŠ¥é”™ï¼
useEffect(async () => {
  const response = await fetch('/api/users')
  const data = await response.json()
  setUsers(data)
}, [])
```

**âœ… æ­£ç¡®å†™æ³• - å†…éƒ¨å®šä¹‰asyncå‡½æ•°**
```jsx
useEffect(() => {
  // åœ¨useEffectå†…éƒ¨å®šä¹‰asyncå‡½æ•°
  const fetchUsers = async () => {
    try {
      const response = await fetch('/api/users')
      const data = await response.json()
      setUsers(data)
    } catch (error) {
      console.error('è¯·æ±‚å¤±è´¥:', error)
    }
  }
  
  fetchUsers() // è°ƒç”¨è¿™ä¸ªå‡½æ•°
}, [])
```

**ğŸ¯ è®°å¿†æ–¹æ³•**ï¼š
- useEffecté‡Œé¢**ä¸èƒ½**ç›´æ¥å†™async
- è¦**å…ˆå®šä¹‰**asyncå‡½æ•°ï¼Œ**å†è°ƒç”¨**

---

## 3. ğŸ“Š è¯·æ±‚çŠ¶æ€ç®¡ç†ä¸‰ä»¶å¥—


### 3.1 ä¸‰ç§çŠ¶æ€çš„å«ä¹‰


**ğŸ’­ æƒ³è±¡ä¸€ä¸‹ç½‘è´­çš„è¿‡ç¨‹**ï¼š
```
ä¸‹å•(loading) â†’ ç­‰å¾…é…é€(loading) â†’ æ”¶åˆ°è´§ç‰©(data) æˆ– é…é€å¤±è´¥(error)
```

**ğŸ”¸ Reactä¸­çš„ä¸‰ç§çŠ¶æ€**ï¼š
- **loading** - æ­£åœ¨åŠ è½½ä¸­
- **data** - æˆåŠŸæ‹¿åˆ°çš„æ•°æ®  
- **error** - å‡ºé”™äº†çš„ä¿¡æ¯

### 3.2 å®Œæ•´çš„çŠ¶æ€ç®¡ç†ç¤ºä¾‹


```jsx
function ProductList() {
  const [products, setProducts] = useState([])      // æ•°æ®
  const [loading, setLoading] = useState(false)     // åŠ è½½çŠ¶æ€
  const [error, setError] = useState(null)          // é”™è¯¯ä¿¡æ¯
  
  useEffect(() => {
    const fetchProducts = async () => {
      setLoading(true)    // å¼€å§‹åŠ è½½
      setError(null)      // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
      
      try {
        const response = await fetch('/api/products')
        if (!response.ok) {
          throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥')
        }
        const data = await response.json()
        setProducts(data)
      } catch (err) {
        setError(err.message)
      } finally {
        setLoading(false)  // ä¸ç®¡æˆåŠŸå¤±è´¥éƒ½ç»“æŸåŠ è½½
      }
    }
    
    fetchProducts()
  }, [])
  
  // æ ¹æ®ä¸åŒçŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹
  if (loading) return <div>â³ æ­£åœ¨åŠ è½½å•†å“...</div>
  if (error) return <div>âŒ å‡ºé”™äº†: {error}</div>
  
  return (
    <div>
      <h2>å•†å“åˆ—è¡¨</h2>
      {products.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  )
}
```

### 3.3 çŠ¶æ€å˜åŒ–æµç¨‹å›¾


```
åˆå§‹çŠ¶æ€ï¼šloading=false, data=[], error=null
    â†“
å¼€å§‹è¯·æ±‚ï¼šloading=true, error=null  
    â†“
è¯·æ±‚æˆåŠŸï¼šloading=false, data=ç»“æœ, error=null
    æˆ–
è¯·æ±‚å¤±è´¥ï¼šloading=false, data=[], error=é”™è¯¯ä¿¡æ¯
```

---

## 4. ğŸš« è¯·æ±‚å–æ¶ˆä¸å†…å­˜æ³„æ¼


### 4.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼é—®é¢˜


**ğŸ¤” åœºæ™¯**ï¼šç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ªé¡µé¢ï¼Œå‘é€è¯·æ±‚ï¼Œä½†åœ¨è¯·æ±‚è¿˜æ²¡å®Œæˆå‰ç”¨æˆ·å°±è·³è½¬åˆ°å…¶ä»–é¡µé¢äº†

```
ç”¨æˆ·æ“ä½œï¼šç‚¹å‡»Aé¡µé¢ â†’ å‘é€è¯·æ±‚ â†’ ç«‹å³è·³è½¬åˆ°Bé¡µé¢
é—®é¢˜ï¼šAé¡µé¢çš„è¯·æ±‚è¿˜åœ¨ç»§ç»­ï¼Œå›æ¥åè¦æ›´æ–°å·²ç»ä¸å­˜åœ¨çš„ç»„ä»¶çŠ¶æ€
ç»“æœï¼šReactè­¦å‘Š "å†…å­˜æ³„æ¼" 
```

### 4.2 AbortControllerè§£å†³æ–¹æ¡ˆ


```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null)
  const [loading, setLoading] = useState(false)
  
  useEffect(() => {
    // åˆ›å»ºä¸€ä¸ªå–æ¶ˆæ§åˆ¶å™¨
    const controller = new AbortController()
    
    const fetchUser = async () => {
      setLoading(true)
      try {
        const response = await fetch(`/api/users/${userId}`, {
          signal: controller.signal  // ä¼ å…¥å–æ¶ˆä¿¡å·
        })
        const userData = await response.json()
        setUser(userData)
      } catch (error) {
        // å¦‚æœæ˜¯å–æ¶ˆå¯¼è‡´çš„é”™è¯¯ï¼Œä¸å¤„ç†
        if (error.name !== 'AbortError') {
          console.error('è¯·æ±‚å¤±è´¥:', error)
        }
      } finally {
        setLoading(false)
      }
    }
    
    fetchUser()
    
    // æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚
    return () => {
      controller.abort()
    }
  }, [userId])
  
  return user ? <div>{user.name}</div> : <div>åŠ è½½ä¸­...</div>
}
```

**ğŸ’¡ æ ¸å¿ƒç†è§£**ï¼š
- **AbortController** = "è¯·æ±‚çš„é¥æ§å™¨"
- **signal** = "å–æ¶ˆä¿¡å·"  
- **returnå‡½æ•°** = "ç»„ä»¶èµ°çš„æ—¶å€™æ‰§è¡Œçš„æ¸…ç†å·¥ä½œ"

### 4.3 ç®€åŒ–çš„flagæ–¹æ¡ˆ


```jsx
function UserList() {
  const [users, setUsers] = useState([])
  
  useEffect(() => {
    let isMounted = true  // æ ‡è®°ç»„ä»¶æ˜¯å¦è¿˜åœ¨
    
    const fetchUsers = async () => {
      const response = await fetch('/api/users')
      const data = await response.json()
      
      // åªæœ‰ç»„ä»¶è¿˜åœ¨æ—¶æ‰æ›´æ–°çŠ¶æ€
      if (isMounted) {
        setUsers(data)
      }
    }
    
    fetchUsers()
    
    return () => {
      isMounted = false  // ç»„ä»¶å¸è½½æ—¶æ ‡è®°ä¸ºfalse
    }
  }, [])
  
  return <div>{/* æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ */}</div>
}
```

---

## 5. ğŸ£ è‡ªå®šä¹‰Hookå°è£…


### 5.1 ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰Hook


**ç®€å•ç†è§£**ï¼šæŠŠé‡å¤çš„è¯·æ±‚é€»è¾‘å°è£…æˆä¸€ä¸ªå¯å¤ç”¨çš„å‡½æ•°

```
å°±åƒåšèœçš„è°ƒæ–™åŒ…ï¼š
æ™®é€šåšæ³•ï¼šæ¯æ¬¡ç‚’èœéƒ½è¦å‡†å¤‡ç›ã€ç³–ã€ç”ŸæŠ½ã€è€æŠ½...
è°ƒæ–™åŒ…ï¼šä¸€åŒ…æå®šï¼Œæƒ³ç‚’ä»€ä¹ˆèœéƒ½èƒ½ç”¨

è‡ªå®šä¹‰Hookï¼šæŠŠè¯·æ±‚é€»è¾‘æ‰“åŒ…ï¼Œå“ªä¸ªç»„ä»¶éœ€è¦æ•°æ®å°±ç”¨ä¸€ä¸‹
```

### 5.2 åŸºç¡€ç‰ˆuseFetch


```jsx
// è‡ªå®šä¹‰Hookï¼šä¸“é—¨å¤„ç†æ•°æ®è¯·æ±‚
function useFetch(url) {
  const [data, setData] = useState(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)
  
  useEffect(() => {
    if (!url) return  // æ²¡æœ‰urlå°±ä¸è¯·æ±‚
    
    const fetchData = async () => {
      setLoading(true)
      setError(null)
      
      try {
        const response = await fetch(url)
        if (!response.ok) throw new Error('è¯·æ±‚å¤±è´¥')
        const result = await response.json()
        setData(result)
      } catch (err) {
        setError(err.message)
      } finally {
        setLoading(false)
      }
    }
    
    fetchData()
  }, [url])
  
  return { data, loading, error }
}
```

### 5.3 åœ¨ç»„ä»¶ä¸­ä½¿ç”¨useFetch


```jsx
// ä½¿ç”¨è‡ªå®šä¹‰Hook - è¶…çº§ç®€å•ï¼
function UserProfile({ userId }) {
  const { data: user, loading, error } = useFetch(`/api/users/${userId}`)
  
  if (loading) return <div>åŠ è½½ä¸­...</div>
  if (error) return <div>é”™è¯¯: {error}</div>
  if (!user) return <div>ç”¨æˆ·ä¸å­˜åœ¨</div>
  
  return (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
    </div>
  )
}

// åœ¨å¦ä¸€ä¸ªç»„ä»¶ä¸­ä¹Ÿèƒ½ç”¨
function ProductList() {
  const { data: products, loading, error } = useFetch('/api/products')
  
  if (loading) return <div>åŠ è½½å•†å“ä¸­...</div>
  if (error) return <div>åŠ è½½å¤±è´¥: {error}</div>
  
  return (
    <div>
      {products?.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  )
}
```

### 5.4 å¢å¼ºç‰ˆuseRequest


```jsx
function useRequest(url, options = {}) {
  const [data, setData] = useState(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)
  
  // æ‰‹åŠ¨è§¦å‘è¯·æ±‚çš„å‡½æ•°
  const execute = async (customUrl = url, customOptions = options) => {
    setLoading(true)
    setError(null)
    
    try {
      const response = await fetch(customUrl, customOptions)
      if (!response.ok) throw new Error('è¯·æ±‚å¤±è´¥')
      const result = await response.json()
      setData(result)
      return result
    } catch (err) {
      setError(err.message)
      throw err
    } finally {
      setLoading(false)
    }
  }
  
  // é‡ç½®æ‰€æœ‰çŠ¶æ€
  const reset = () => {
    setData(null)
    setError(null)
    setLoading(false)
  }
  
  return {
    data,
    loading, 
    error,
    execute,    // æ‰‹åŠ¨æ‰§è¡Œè¯·æ±‚
    reset       // é‡ç½®çŠ¶æ€
  }
}
```

**ä½¿ç”¨å¢å¼ºç‰ˆHook**ï¼š
```jsx
function CreateUser() {
  const { loading, error, execute } = useRequest()
  
  const handleSubmit = async (userData) => {
    try {
      await execute('/api/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
      })
      alert('ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼')
    } catch (err) {
      // é”™è¯¯å·²ç»åœ¨Hookä¸­å¤„ç†äº†
    }
  }
  
  return (
    <form onSubmit={handleSubmit}>
      {error && <div>é”™è¯¯: {error}</div>}
      <button disabled={loading}>
        {loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºç”¨æˆ·'}
      </button>
    </form>
  )
}
```

---

## 6. ğŸ”Œ Axiosé›†æˆä¸æ¥å£æŠ½ç¦»


### 6.1 ä¸ºä»€ä¹ˆç”¨Axios


**ğŸ¤” fetch vs axioså¯¹æ¯”**ï¼š

| ç‰¹æ€§ | **fetch** | **axios** |
|------|-----------|-----------|
| ğŸ”¸ **è‡ªå¸¦** | `æµè§ˆå™¨åŸç”Ÿ` | `éœ€è¦å®‰è£…` |
| ğŸ”¸ **JSONå¤„ç†** | `éœ€è¦æ‰‹åŠ¨.json()` | `è‡ªåŠ¨å¤„ç†` |
| ğŸ”¸ **é”™è¯¯å¤„ç†** | `404ä¸ç®—é”™è¯¯` | `4xx/5xxéƒ½æ˜¯é”™è¯¯` |
| ğŸ”¸ **è¯·æ±‚æ‹¦æˆª** | `ä¸æ”¯æŒ` | `æ”¯æŒ` |
| ğŸ”¸ **è¶…æ—¶è®¾ç½®** | `éœ€è¦é…åˆAbortController` | `ç›´æ¥é…ç½®` |

**ç®€å•ç†è§£**ï¼šaxioså°±æ˜¯å¢å¼ºç‰ˆçš„fetchï¼Œç”¨èµ·æ¥æ›´æ–¹ä¾¿

### 6.2 AxiosåŸºæœ¬é…ç½®


```jsx
// api/config.js - é…ç½®axios
import axios from 'axios'

// åˆ›å»ºaxioså®ä¾‹
const api = axios.create({
  baseURL: 'https://api.example.com',  // åŸºç¡€URL
  timeout: 10000,                      // 10ç§’è¶…æ—¶
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨ï¼šè‡ªåŠ¨æ·»åŠ token
api.interceptors.request.use(
  config => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => Promise.reject(error)
)

// å“åº”æ‹¦æˆªå™¨ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†
api.interceptors.response.use(
  response => response.data,  // ç›´æ¥è¿”å›æ•°æ®éƒ¨åˆ†
  error => {
    if (error.response?.status === 401) {
      // tokenè¿‡æœŸï¼Œè·³è½¬ç™»å½•
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)

export default api
```

### 6.3 æ¥å£æŠ½ç¦»ç®¡ç†


```jsx
// api/userApi.js - ç”¨æˆ·ç›¸å…³æ¥å£
import api from './config'

export const userAPI = {
  // è·å–ç”¨æˆ·åˆ—è¡¨
  getUsers: () => api.get('/users'),
  
  // è·å–å•ä¸ªç”¨æˆ·
  getUser: (id) => api.get(`/users/${id}`),
  
  // åˆ›å»ºç”¨æˆ·
  createUser: (userData) => api.post('/users', userData),
  
  // æ›´æ–°ç”¨æˆ·
  updateUser: (id, userData) => api.put(`/users/${id}`, userData),
  
  // åˆ é™¤ç”¨æˆ·
  deleteUser: (id) => api.delete(`/users/${id}`)
}

// api/productApi.js - å•†å“ç›¸å…³æ¥å£
import api from './config'

export const productAPI = {
  getProducts: (params) => api.get('/products', { params }),
  getProduct: (id) => api.get(`/products/${id}`),
  searchProducts: (keyword) => api.get(`/products/search?q=${keyword}`)
}
```

### 6.4 é…åˆè‡ªå®šä¹‰Hookä½¿ç”¨


```jsx
// hooks/useApi.js
import { useState, useEffect } from 'react'

function useApi(apiCall, dependencies = []) {
  const [data, setData] = useState(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)
  
  useEffect(() => {
    let cancelled = false
    
    const fetchData = async () => {
      setLoading(true)
      setError(null)
      
      try {
        const result = await apiCall()
        if (!cancelled) {
          setData(result)
        }
      } catch (err) {
        if (!cancelled) {
          setError(err.message || 'è¯·æ±‚å¤±è´¥')
        }
      } finally {
        if (!cancelled) {
          setLoading(false)
        }
      }
    }
    
    fetchData()
    
    return () => {
      cancelled = true
    }
  }, dependencies)
  
  return { data, loading, error }
}

export default useApi
```

**åœ¨ç»„ä»¶ä¸­ä½¿ç”¨**ï¼š
```jsx
import useApi from '../hooks/useApi'
import { userAPI } from '../api/userApi'

function UserProfile({ userId }) {
  // è¶…çº§ç®€æ´çš„æ•°æ®è·å–
  const { data: user, loading, error } = useApi(
    () => userAPI.getUser(userId),
    [userId]
  )
  
  if (loading) return <div>åŠ è½½ä¸­...</div>
  if (error) return <div>é”™è¯¯: {error}</div>
  
  return user && (
    <div>
      <h2>{user.name}</h2>
      <p>{user.email}</p>
    </div>
  )
}
```

---

## 7. ğŸš€ é«˜çº§è¯·æ±‚å¤„ç†


### 7.1 ç«æ€æ¡ä»¶å¤„ç†


**ğŸ¤” ä»€ä¹ˆæ˜¯ç«æ€æ¡ä»¶ï¼Ÿ**

```
åœºæ™¯ï¼šç”¨æˆ·å¿«é€Ÿè¾“å…¥æœç´¢å…³é”®è¯
ç”¨æˆ·è¾“å…¥ï¼ša â†’ ab â†’ abc
å‘é€è¯·æ±‚ï¼šè¯·æ±‚a â†’ è¯·æ±‚ab â†’ è¯·æ±‚abc
è¿”å›é¡ºåºï¼šabcè¿”å› â†’ abè¿”å› â†’ aè¿”å›ï¼ˆæœ€æ…¢ï¼‰
ç»“æœï¼šæ˜¾ç¤ºçš„æ˜¯"a"çš„æœç´¢ç»“æœï¼Œä½†ç”¨æˆ·è¦çš„æ˜¯"abc"çš„ç»“æœ
```

**è§£å†³æ–¹æ¡ˆï¼šè¯·æ±‚åºå·ç®¡ç†**
```jsx
function SearchResults({ keyword }) {
  const [results, setResults] = useState([])
  const [loading, setLoading] = useState(false)
  
  useEffect(() => {
    if (!keyword) {
      setResults([])
      return
    }
    
    let requestId = Date.now()  // ç»™æ¯ä¸ªè¯·æ±‚ä¸€ä¸ªID
    
    const search = async () => {
      setLoading(true)
      
      try {
        const response = await fetch(`/api/search?q=${keyword}`)
        const data = await response.json()
        
        // åªæœ‰æœ€æ–°çš„è¯·æ±‚ç»“æœæ‰æ›´æ–°ç•Œé¢
        if (requestId === Date.now()) {
          setResults(data)
        }
      } finally {
        setLoading(false)
      }
    }
    
    search()
  }, [keyword])
  
  return (
    <div>
      {loading && <div>æœç´¢ä¸­...</div>}
      {results.map(item => <div key={item.id}>{item.title}</div>)}
    </div>
  )
}
```

### 7.2 é˜²æŠ–æœç´¢


```jsx
// hooks/useDebounce.js
import { useState, useEffect } from 'react'

function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value)
  
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value)
    }, delay)
    
    return () => clearTimeout(timer)
  }, [value, delay])
  
  return debouncedValue
}

// ä½¿ç”¨é˜²æŠ–æœç´¢
function SearchBox() {
  const [keyword, setKeyword] = useState('')
  const debouncedKeyword = useDebounce(keyword, 500)  // 500msé˜²æŠ–
  
  const { data: results, loading } = useFetch(
    debouncedKeyword ? `/api/search?q=${debouncedKeyword}` : null
  )
  
  return (
    <div>
      <input 
        value={keyword}
        onChange={(e) => setKeyword(e.target.value)}
        placeholder="æœç´¢..."
      />
      {loading && <div>æœç´¢ä¸­...</div>}
      {results?.map(item => <div key={item.id}>{item.title}</div>)}
    </div>
  )
}
```

### 7.3 æ•°æ®ç¼“å­˜ç­–ç•¥


```jsx
// ç®€å•çš„å†…å­˜ç¼“å­˜
const cache = new Map()

function useCachedFetch(url, options = {}) {
  const [data, setData] = useState(null)
  const [loading, setLoading] = useState(false)
  const { cacheTime = 5 * 60 * 1000 } = options  // é»˜è®¤ç¼“å­˜5åˆ†é’Ÿ
  
  useEffect(() => {
    if (!url) return
    
    // æ£€æŸ¥ç¼“å­˜
    const cached = cache.get(url)
    if (cached && Date.now() - cached.timestamp < cacheTime) {
      setData(cached.data)
      return
    }
    
    // ç¼“å­˜è¿‡æœŸæˆ–æ²¡æœ‰ç¼“å­˜ï¼Œé‡æ–°è¯·æ±‚
    const fetchData = async () => {
      setLoading(true)
      try {
        const response = await fetch(url)
        const result = await response.json()
        
        // å­˜å…¥ç¼“å­˜
        cache.set(url, {
          data: result,
          timestamp: Date.now()
        })
        
        setData(result)
      } finally {
        setLoading(false)
      }
    }
    
    fetchData()
  }, [url, cacheTime])
  
  return { data, loading }
}
```

---

## 8. ğŸ“¦ ç¬¬ä¸‰æ–¹æ•°æ®è¯·æ±‚åº“


### 8.1 React Queryç®€ä»‹


**ä»€ä¹ˆæ˜¯React Queryï¼Ÿ**
> ä¸“é—¨ä¸ºReactè®¾è®¡çš„æ•°æ®è¯·æ±‚å’Œç¼“å­˜åº“ï¼Œè‡ªåŠ¨å¤„ç†ç¼“å­˜ã€åå°åˆ·æ–°ã€é”™è¯¯é‡è¯•ç­‰å¤æ‚é€»è¾‘

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- ğŸ”„ **è‡ªåŠ¨ç¼“å­˜**ï¼šç›¸åŒè¯·æ±‚è‡ªåŠ¨å¤ç”¨ç¼“å­˜
- ğŸ”„ **åå°åˆ·æ–°**ï¼šæ•°æ®è¿‡æœŸæ—¶è‡ªåŠ¨é‡æ–°è¯·æ±‚  
- ğŸ”„ **é”™è¯¯é‡è¯•**ï¼šè¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯•
- ğŸ”„ **ä¹è§‚æ›´æ–°**ï¼šå…ˆæ›´æ–°ç•Œé¢ï¼Œå†åŒæ­¥æœåŠ¡å™¨

```jsx
// å®‰è£…ï¼šnpm install @tanstack/react-query

import { useQuery } from '@tanstack/react-query'

function UserProfile({ userId }) {
  // React Queryçš„åŸºæœ¬ç”¨æ³•
  const { 
    data: user, 
    isLoading, 
    error,
    refetch  // æ‰‹åŠ¨åˆ·æ–°
  } = useQuery({
    queryKey: ['user', userId],           // ç¼“å­˜é”®
    queryFn: () => userAPI.getUser(userId), // è¯·æ±‚å‡½æ•°
    staleTime: 5 * 60 * 1000,            // 5åˆ†é’Ÿå†…è®¤ä¸ºæ•°æ®æ–°é²œ
    cacheTime: 10 * 60 * 1000,           // ç¼“å­˜ä¿ç•™10åˆ†é’Ÿ
  })
  
  if (isLoading) return <div>åŠ è½½ä¸­...</div>
  if (error) return <div>é”™è¯¯: {error.message}</div>
  
  return (
    <div>
      <h2>{user.name}</h2>
      <button onClick={refetch}>åˆ·æ–°</button>
    </div>
  )
}
```

### 8.2 SWRç®€ä»‹


**ä»€ä¹ˆæ˜¯SWRï¼Ÿ**
> "stale-while-revalidate"ç­–ç•¥çš„å®ç°ï¼Œå…ˆæ˜¾ç¤ºç¼“å­˜æ•°æ®ï¼ŒåŒæ—¶åœ¨åå°åˆ·æ–°

```jsx
// å®‰è£…ï¼šnpm install swr

import useSWR from 'swr'

// å®šä¹‰fetcherå‡½æ•°
const fetcher = (url) => fetch(url).then(res => res.json())

function UserList() {
  const { data: users, error, isLoading } = useSWR('/api/users', fetcher)
  
  if (error) return <div>åŠ è½½å¤±è´¥</div>
  if (isLoading) return <div>åŠ è½½ä¸­...</div>
  
  return (
    <div>
      {users.map(user => <div key={user.id}>{user.name}</div>)}
    </div>
  )
}
```

### 8.3 é€‰æ‹©å»ºè®®


```
é¡¹ç›®è§„æ¨¡é€‰æ‹©ï¼š

ğŸ”¸ å°é¡¹ç›®/å­¦ä¹ é¡¹ç›®ï¼š
â†’ è‡ªå®šä¹‰Hook (useFetch/useRequest)
â†’ ç®€å•å¤Ÿç”¨ï¼Œå®¹æ˜“ç†è§£

ğŸ”¸ ä¸­å‹é¡¹ç›®ï¼š
â†’ SWR 
â†’ è½»é‡çº§ï¼ŒAPIç®€å•

ğŸ”¸ å¤§å‹é¡¹ç›®/å¤æ‚æ•°æ®æµï¼š
â†’ React Query
â†’ åŠŸèƒ½æœ€å…¨é¢ï¼Œç”Ÿæ€æœ€ä¸°å¯Œ
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®è·å–æ—¶æœºï¼šuseEffect + ç©ºä¾èµ–æ•°ç»„ = ç»„ä»¶åŠ è½½æ—¶è¯·æ±‚
ğŸ”¸ çŠ¶æ€ç®¡ç†ä¸‰ä»¶å¥—ï¼šloading(åŠ è½½ä¸­) + data(æ•°æ®) + error(é”™è¯¯)
ğŸ”¸ è¯·æ±‚å–æ¶ˆï¼šAbortController é˜²æ­¢å†…å­˜æ³„æ¼
ğŸ”¸ è‡ªå®šä¹‰Hookï¼šæŠŠè¯·æ±‚é€»è¾‘å°è£…æˆå¯å¤ç”¨å‡½æ•°
ğŸ”¸ å¼‚æ­¥å‡½æ•°ï¼šuseEffectå†…éƒ¨å®šä¹‰asyncå‡½æ•°ï¼Œä¸èƒ½ç›´æ¥async
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†**
```
ç”¨æˆ·ä½“éªŒè€ƒè™‘ï¼š
- loadingï¼šè®©ç”¨æˆ·çŸ¥é“"æ­£åœ¨å¤„ç†"
- errorï¼šè®©ç”¨æˆ·çŸ¥é“"å‡ºäº†ä»€ä¹ˆé—®é¢˜"  
- dataï¼šæ˜¾ç¤º"æœ€ç»ˆç»“æœ"

å°±åƒç”µæ¢¯ï¼š
- æŒ‰é’®äº®èµ·(loading) â†’ ç”µæ¢¯è¿è¡Œä¸­
- æ˜¾ç¤ºæ¥¼å±‚(data) â†’ åˆ°è¾¾ç›®æ ‡
- æ•…éšœæç¤º(error) â†’ å‡ºç°é—®é¢˜
```

**ğŸ”¹ è‡ªå®šä¹‰Hookçš„ä»·å€¼**
```
å¤ç”¨é€»è¾‘ï¼š
- 10ä¸ªç»„ä»¶éƒ½è¦è¯·æ±‚æ•°æ®
- ä¸ç”¨å†™10éç›¸åŒçš„useStateå’ŒuseEffect
- ä¸€ä¸ªuseFetchæå®šæ‰€æœ‰

ç»´æŠ¤æ–¹ä¾¿ï¼š
- è¯·æ±‚é€»è¾‘æœ‰é—®é¢˜åªæ”¹ä¸€ä¸ªåœ°æ–¹
- è¦åŠ æ–°åŠŸèƒ½ï¼ˆæ¯”å¦‚ç¼“å­˜ï¼‰æ‰€æœ‰ç»„ä»¶è‡ªåŠ¨è·å¾—
```

**ğŸ”¹ ä½•æ—¶é€‰æ‹©ç¬¬ä¸‰æ–¹åº“**
```
åˆ¤æ–­æ ‡å‡†ï¼š
- é¡¹ç›®ç®€å• â†’ è‡ªå·±å†™useFetchå¤Ÿç”¨
- éœ€è¦ç¼“å­˜ã€é‡è¯•ç­‰é«˜çº§åŠŸèƒ½ â†’ è€ƒè™‘React Query
- å›¢é˜Ÿç†Ÿæ‚‰ç¨‹åº¦å’Œå­¦ä¹ æˆæœ¬ä¹Ÿè¦è€ƒè™‘
```

### 9.3 å®é™…å¼€å‘å»ºè®®


**ğŸ¯ æ–°æ‰‹å­¦ä¹ è·¯å¾„**
```
ç¬¬1æ­¥ï¼šæŒæ¡åŸºæœ¬çš„fetch + useEffect
ç¬¬2æ­¥ï¼šç†è§£loading/errorçŠ¶æ€ç®¡ç†
ç¬¬3æ­¥ï¼šå­¦ä¼šå°è£…useFetchè‡ªå®šä¹‰Hook  
ç¬¬4æ­¥ï¼šäº†è§£axioså’Œæ¥å£æŠ½ç¦»
ç¬¬5æ­¥ï¼šæ ¹æ®é¡¹ç›®éœ€è¦é€‰æ‹©æ˜¯å¦ç”¨ç¬¬ä¸‰æ–¹åº“
```

**ğŸ”§ æœ€ä½³å®è·µ**
```
âœ… æ¨èåšæ³•ï¼š
- æ€»æ˜¯å¤„ç†loadingå’ŒerrorçŠ¶æ€
- ä½¿ç”¨AbortControlleré˜²æ­¢å†…å­˜æ³„æ¼
- æŠŠæ¥å£è°ƒç”¨æŠ½ç¦»åˆ°å•ç‹¬æ–‡ä»¶
- è‡ªå®šä¹‰Hookå°è£…é‡å¤é€»è¾‘

âŒ é¿å…é”™è¯¯ï¼š
- ä¸è¦åœ¨useEffectå¤–å±‚ç›´æ¥å‘è¯·æ±‚
- ä¸è¦å¿˜è®°ä¾èµ–æ•°ç»„å¯¼è‡´æ— é™è¯·æ±‚
- ä¸è¦å¿½ç•¥é”™è¯¯å¤„ç†
- ä¸è¦è®©ç»„ä»¶å¸è½½åè¿˜æ›´æ–°çŠ¶æ€
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- **useEffectæ˜¯è¯·æ±‚çš„å®¶** - ç»„ä»¶åŠ è½½å®Œæˆåå‘è¯·æ±‚
- **ä¸‰çŠ¶æ€ç®¡ç†ç”¨æˆ·ä½“éªŒ** - loadingç­‰å¾…ï¼Œdataæ˜¾ç¤ºï¼Œerroræç¤º  
- **Hookå°è£…å¯å¤ç”¨** - ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„ä½¿ç”¨
- **å–æ¶ˆè¯·æ±‚é˜²æ³„æ¼** - ç»„ä»¶èµ°äº†è¯·æ±‚ä¹Ÿè¦åœ