---
title: 1ã€ç”¨æˆ·è®¤è¯ç³»ç»Ÿå®æˆ˜
---
## ğŸ“š ç›®å½•

1. [è®¤è¯ç³»ç»Ÿæ¦‚å¿µç†è§£](#1-è®¤è¯ç³»ç»Ÿæ¦‚å¿µç†è§£)
2. [ç”¨æˆ·ç™»å½•å®Œæ•´æµç¨‹](#2-ç”¨æˆ·ç™»å½•å®Œæ•´æµç¨‹)
3. [ç™»å½•è¡¨å•å®ç°](#3-ç™»å½•è¡¨å•å®ç°)
4. [Tokenä»¤ç‰Œç®¡ç†](#4-Tokenä»¤ç‰Œç®¡ç†)
5. [ç™»å½•çŠ¶æ€ç»´æŠ¤](#5-ç™»å½•çŠ¶æ€ç»´æŠ¤)
6. [è‡ªåŠ¨ç™»å½•æœºåˆ¶](#6-è‡ªåŠ¨ç™»å½•æœºåˆ¶)
7. [é€€å‡ºç™»å½•å®ç°](#7-é€€å‡ºç™»å½•å®ç°)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è®¤è¯ç³»ç»Ÿæ¦‚å¿µç†è§£


### 1.1 ä»€ä¹ˆæ˜¯ç”¨æˆ·è®¤è¯ç³»ç»Ÿ


**ğŸ” é€šä¿—ç†è§£**
```
å°±åƒè¿›å…¥å°åŒºéœ€è¦é—¨ç¦å¡ä¸€æ ·ï¼š

è¿›å°åŒºæµç¨‹ï¼š
1. åˆ·é—¨ç¦å¡ â†’ éªŒè¯èº«ä»½
2. ç³»ç»Ÿç¡®è®¤ â†’ å…è®¸è¿›å…¥  
3. åœ¨å°åŒºå†… â†’ å¯ä»¥æ­£å¸¸æ´»åŠ¨
4. ç¦»å¼€æ—¶   â†’ åˆ·å¡é€€å‡º

ç½‘ç«™ç™»å½•æµç¨‹ï¼š
1. è¾“å…¥è´¦å·å¯†ç  â†’ éªŒè¯èº«ä»½
2. æœåŠ¡å™¨ç¡®è®¤   â†’ è¿”å›Tokenä»¤ç‰Œ
3. æµè§ˆç½‘ç«™     â†’ æºå¸¦Tokenè®¿é—®
4. é€€å‡ºç™»å½•     â†’ æ¸…é™¤Token
```

**ğŸ”¸ è®¤è¯ vs æˆæƒçš„åŒºåˆ«**
```
è®¤è¯(Authentication)ï¼šä½ æ˜¯è°ï¼Ÿ
â†’ å°±åƒéªŒè¯ä½ çš„èº«ä»½è¯ï¼Œç¡®è®¤ä½ å°±æ˜¯å¼ ä¸‰

æˆæƒ(Authorization)ï¼šä½ èƒ½åšä»€ä¹ˆï¼Ÿ  
â†’ å°±åƒç¡®è®¤ä½ æœ‰VIPæƒé™ï¼Œå¯ä»¥è¿›å…¥è´µå®¾å®¤

å®é™…ä¾‹å­ï¼š
è®¤è¯ï¼šè¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç  âœ“
æˆæƒï¼šæ£€æŸ¥ä½ æ˜¯å¦æœ‰åˆ é™¤æ–‡ç« çš„æƒé™ âœ“
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è®¤è¯ç³»ç»Ÿ


**ğŸšª ä¿æŠ¤ç§æœ‰å†…å®¹**
- ä¸ªäººä¿¡æ¯ã€è®¢å•è®°å½•åªèƒ½æœ¬äººæŸ¥çœ‹
- é˜²æ­¢æœªæˆæƒç”¨æˆ·è®¿é—®æ•æ„Ÿé¡µé¢
- ç¡®ä¿æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤

**ğŸ¯ ä¸ªæ€§åŒ–ä½“éªŒ**
- æ ¹æ®ç”¨æˆ·èº«ä»½æ˜¾ç¤ºå®šåˆ¶å†…å®¹
- ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®
- æä¾›ä¸“å±åŠŸèƒ½å’ŒæœåŠ¡

---

## 2. ğŸ”„ ç”¨æˆ·ç™»å½•å®Œæ•´æµç¨‹


### 2.1 ç™»å½•æµç¨‹å›¾è§£


```
ç”¨æˆ·ç«¯                    å‰ç«¯é¡µé¢                  åç«¯æœåŠ¡å™¨
  |                         |                         |
  |--[1]æ‰“å¼€ç™»å½•é¡µ--------->|                         |
  |                         |                         |
  |--[2]è¾“å…¥è´¦å·å¯†ç ------->|                         |
  |                         |--[3]å‘é€ç™»å½•è¯·æ±‚------->|
  |                         |   (username+password)   |
  |                         |                         |--[4]éªŒè¯ç”¨æˆ·ä¿¡æ¯
  |                         |                         |   (æ•°æ®åº“æŸ¥è¯¢)
  |                         |                         |
  |                         |<--[5]è¿”å›Token+ç”¨æˆ·ä¿¡æ¯-|
  |<--[6]æ˜¾ç¤ºç™»å½•æˆåŠŸ-------|                         |
  |                         |--[7]å­˜å‚¨Token--------->|æœ¬åœ°å­˜å‚¨
  |                         |                         |
  |--[8]è®¿é—®å—ä¿æŠ¤é¡µé¢---->|                         |
  |                         |--[9]æºå¸¦Tokenè¯·æ±‚----->|
  |                         |                         |--[10]éªŒè¯Token
  |                         |<--[11]è¿”å›é¡µé¢æ•°æ®-----|
  |<--[12]æ˜¾ç¤ºé¡µé¢å†…å®¹-----|                         |
```

### 2.2 å…³é”®æ­¥éª¤è¯¦è§£


**ğŸ”¸ æ­¥éª¤1-2ï¼šç”¨æˆ·è¾“å…¥**
```html
<!-- ç®€å•çš„ç™»å½•è¡¨å• -->
<form id="loginForm">
  <input type="text" name="username" placeholder="ç”¨æˆ·å" required>
  <input type="password" name="password" placeholder="å¯†ç " required>  
  <button type="submit">ç™»å½•</button>
</form>
```

**ğŸ”¸ æ­¥éª¤3ï¼šå‘é€ç™»å½•è¯·æ±‚**
```javascript
// æ”¶é›†è¡¨å•æ•°æ®å¹¶å‘é€
const formData = {
  username: 'ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·å',
  password: 'ç”¨æˆ·è¾“å…¥çš„å¯†ç '
}

// å‘æœåŠ¡å™¨å‘é€ç™»å½•è¯·æ±‚
fetch('/api/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(formData)
})
```

**ğŸ”¸ æ­¥éª¤4-5ï¼šæœåŠ¡å™¨éªŒè¯**
```javascript
// æœåŠ¡å™¨ç«¯çš„å¤„ç†é€»è¾‘ï¼ˆç¤ºæ„ï¼‰
// 1. æ¥æ”¶ç”¨æˆ·åå¯†ç 
// 2. æŸ¥è¯¢æ•°æ®åº“éªŒè¯
// 3. ç”ŸæˆTokenä»¤ç‰Œ
// 4. è¿”å›ç»“æœ

// æˆåŠŸè¿”å›çš„æ•°æ®æ ¼å¼
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",  
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 123,
    "username": "zhangsan",
    "nickname": "å¼ ä¸‰"
  }
}
```

---

## 3. ğŸ“ ç™»å½•è¡¨å•å®ç°


### 3.1 è¡¨å•æ•°æ®æ”¶é›†


**ğŸ“‹ åŸºç¡€è¡¨å•HTML**
```html
<div class="login-container">
  <form id="loginForm">
    <div class="form-group">
      <label>ç”¨æˆ·åï¼š</label>
      <input type="text" id="username" name="username" required>
    </div>
    
    <div class="form-group">  
      <label>å¯†ç ï¼š</label>
      <input type="password" id="password" name="password" required>
    </div>
    
    <div class="form-group">
      <label>
        <input type="checkbox" id="remember"> è®°ä½ç™»å½•çŠ¶æ€
      </label>
    </div>
    
    <button type="submit">ç™»å½•</button>
  </form>
</div>
```

### 3.2 è¡¨å•éªŒè¯å’Œæäº¤


**âœ… å‰ç«¯éªŒè¯é€»è¾‘**
```javascript
const loginForm = document.getElementById('loginForm');

loginForm.addEventListener('submit', async function(e) {
  e.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤
  
  // 1. è·å–è¡¨å•æ•°æ®
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  const remember = document.getElementById('remember').checked;
  
  // 2. ç®€å•éªŒè¯
  if (!username) {
    alert('è¯·è¾“å…¥ç”¨æˆ·å');
    return;
  }
  
  if (!password) {
    alert('è¯·è¾“å…¥å¯†ç ');
    return;
  }
  
  // 3. å‘é€ç™»å½•è¯·æ±‚
  try {
    await handleLogin(username, password, remember);
  } catch (error) {
    alert('ç™»å½•å¤±è´¥ï¼š' + error.message);
  }
});
```

### 3.3 ç™»å½•è¯·æ±‚å¤„ç†


**ğŸš€ æ ¸å¿ƒç™»å½•å‡½æ•°**
```javascript
async function handleLogin(username, password, remember) {
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  const submitBtn = document.querySelector('button[type="submit"]');
  submitBtn.textContent = 'ç™»å½•ä¸­...';
  submitBtn.disabled = true;
  
  try {
    const response = await fetch('/api/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        username: username,
        password: password
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      // ç™»å½•æˆåŠŸå¤„ç†
      handleLoginSuccess(result, remember);
    } else {
      // ç™»å½•å¤±è´¥å¤„ç†  
      throw new Error(result.message || 'ç™»å½•å¤±è´¥');
    }
    
  } finally {
    // æ¢å¤æŒ‰é’®çŠ¶æ€
    submitBtn.textContent = 'ç™»å½•';
    submitBtn.disabled = false;
  }
}
```

---

## 4. ğŸ« Tokenä»¤ç‰Œç®¡ç†


### 4.1 ä»€ä¹ˆæ˜¯Token


**ğŸ”‘ Tokenä»¤ç‰Œæ¦‚å¿µ**
```
Tokenå°±åƒæ˜¯ä¸€å¼ "ä¸´æ—¶é€šè¡Œè¯"ï¼š

ç°å®ä¸­çš„ä¾‹å­ï¼š
æ¸¸ä¹å›­æ‰‹ç¯ â†’ è¯æ˜ä½ å·²ä»˜è´¹ï¼Œå¯ä»¥ç©æ‰€æœ‰é¡¹ç›®
ç”µå½±ç¥¨     â†’ è¯æ˜ä½ æœ‰æƒè§‚çœ‹ç‰¹å®šåœºæ¬¡
ä¼šå‘˜å¡     â†’ è¯æ˜ä½ çš„ä¼šå‘˜èº«ä»½å’Œæƒé™

ç½‘ç«™ä¸­çš„Tokenï¼š
åŒ…å«ç”¨æˆ·èº«ä»½ä¿¡æ¯çš„åŠ å¯†å­—ç¬¦ä¸²
è¯æ˜ç”¨æˆ·å·²ç»ç™»å½•è¿‡
æºå¸¦Tokenè®¿é—®å—ä¿æŠ¤çš„é¡µé¢/æ¥å£
```

**ğŸ”¸ Tokençš„ç‰¹ç‚¹**
- âœ… **æœ‰æ—¶æ•ˆæ€§**ï¼šä¼šè¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•
- âœ… **åŒ…å«ä¿¡æ¯**ï¼šç”¨æˆ·IDã€æƒé™ã€è¿‡æœŸæ—¶é—´ç­‰
- âœ… **å®‰å…¨æ€§**ï¼šåŠ å¯†å­˜å‚¨ï¼Œéš¾ä»¥ä¼ªé€ 
- âœ… **æ— çŠ¶æ€**ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨session

### 4.2 Tokenå­˜å‚¨æ–¹å¼


**ğŸ“¦ å­˜å‚¨ä½ç½®å¯¹æ¯”**

| å­˜å‚¨æ–¹å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | å®‰å…¨æ€§ |
|---------|------|----------|--------|
| `localStorage` | æŒä¹…å­˜å‚¨ï¼Œåˆ·æ–°ä¸ä¸¢å¤± | é•¿æœŸç™»å½• | â­â­â­ |
| `sessionStorage` | é¡µé¢å…³é—­å°±æ¸…é™¤ | ä¸´æ—¶ç™»å½• | â­â­â­â­ |
| `Cookie` | è‡ªåŠ¨æºå¸¦ï¼Œå¯è®¾ç½®è¿‡æœŸ | è‡ªåŠ¨ç™»å½• | â­â­â­â­â­ |

**ğŸ’¾ Tokenå­˜å‚¨å®ç°**
```javascript
// Tokenç®¡ç†å·¥å…·ç±»
class TokenManager {
  // ä¿å­˜Token
  static saveToken(token, remember = false) {
    if (remember) {
      // è®°ä½ç™»å½•ï¼šä½¿ç”¨localStorageé•¿æœŸå­˜å‚¨
      localStorage.setItem('authToken', token);
      localStorage.setItem('loginTime', Date.now().toString());
    } else {
      // ä¸´æ—¶ç™»å½•ï¼šä½¿ç”¨sessionStorage
      sessionStorage.setItem('authToken', token);
    }
  }
  
  // è·å–Token
  static getToken() {
    // å…ˆæ£€æŸ¥sessionStorageï¼Œå†æ£€æŸ¥localStorage
    return sessionStorage.getItem('authToken') || 
           localStorage.getItem('authToken');
  }
  
  // æ¸…é™¤Token
  static clearToken() {
    sessionStorage.removeItem('authToken');
    localStorage.removeItem('authToken');
    localStorage.removeItem('loginTime');
  }
  
  // æ£€æŸ¥Tokenæ˜¯å¦å­˜åœ¨
  static hasToken() {
    return !!this.getToken();
  }
}
```

### 4.3 Tokenä½¿ç”¨æ–¹å¼


**ğŸ” åœ¨è¯·æ±‚ä¸­æºå¸¦Token**
```javascript
// å°è£…å¸¦Tokençš„è¯·æ±‚å‡½æ•°
async function fetchWithAuth(url, options = {}) {
  const token = TokenManager.getToken();
  
  if (!token) {
    throw new Error('æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•');
  }
  
  // åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ Token
  const headers = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`, // æ ‡å‡†æ ¼å¼
    ...options.headers
  };
  
  const response = await fetch(url, {
    ...options,
    headers
  });
  
  // æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
  if (response.status === 401) {
    TokenManager.clearToken();
    alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
    window.location.href = '/login';
    return;
  }
  
  return response;
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  const response = await fetchWithAuth('/api/user/profile');
  const userInfo = await response.json();
  console.log('ç”¨æˆ·ä¿¡æ¯ï¼š', userInfo);
} catch (error) {
  console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼š', error);
}
```

---

## 5. ğŸ”„ ç™»å½•çŠ¶æ€ç»´æŠ¤


### 5.1 ç™»å½•æˆåŠŸåçš„å¤„ç†


**âœ… å®Œæ•´çš„ç™»å½•æˆåŠŸå¤„ç†**
```javascript
function handleLoginSuccess(result, remember) {
  // 1. ä¿å­˜Token
  TokenManager.saveToken(result.token, remember);
  
  // 2. ä¿å­˜ç”¨æˆ·ä¿¡æ¯
  const userInfo = {
    id: result.user.id,
    username: result.user.username,
    nickname: result.user.nickname
  };
  
  if (remember) {
    localStorage.setItem('userInfo', JSON.stringify(userInfo));
  } else {
    sessionStorage.setItem('userInfo', JSON.stringify(userInfo));
  }
  
  // 3. æ˜¾ç¤ºæˆåŠŸæç¤º
  alert('ç™»å½•æˆåŠŸï¼');
  
  // 4. è·³è½¬åˆ°ç›®æ ‡é¡µé¢
  const returnUrl = new URLSearchParams(window.location.search).get('return');
  window.location.href = returnUrl || '/dashboard';
}
```

### 5.2 é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€


**ğŸ” è‡ªåŠ¨æ£€æŸ¥ç™»å½•çŠ¶æ€**
```javascript
// é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
document.addEventListener('DOMContentLoaded', function() {
  checkLoginStatus();
});

async function checkLoginStatus() {
  const token = TokenManager.getToken();
  
  if (!token) {
    // æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢
    showLoginPage();
    return;
  }
  
  try {
    // éªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ
    const response = await fetchWithAuth('/api/user/check');
    
    if (response.ok) {
      // Tokenæœ‰æ•ˆï¼Œæ˜¾ç¤ºç”¨æˆ·ç•Œé¢
      showUserInterface();
    } else {
      // Tokenæ— æ•ˆï¼Œæ¸…é™¤å¹¶æ˜¾ç¤ºç™»å½•é¡µé¢
      TokenManager.clearToken();
      showLoginPage();
    }
  } catch (error) {
    console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥ï¼š', error);
    showLoginPage();
  }
}

function showUserInterface() {
  // æ˜¾ç¤ºå·²ç™»å½•çš„ç•Œé¢
  document.getElementById('loginSection').style.display = 'none';
  document.getElementById('userSection').style.display = 'block';
  
  // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
  const userInfo = JSON.parse(
    sessionStorage.getItem('userInfo') || 
    localStorage.getItem('userInfo') || 
    '{}'
  );
  
  if (userInfo.nickname) {
    document.getElementById('userName').textContent = userInfo.nickname;
  }
}

function showLoginPage() {
  // æ˜¾ç¤ºç™»å½•ç•Œé¢
  document.getElementById('loginSection').style.display = 'block';
  document.getElementById('userSection').style.display = 'none';
}
```

### 5.3 å—ä¿æŠ¤é¡µé¢çš„è®¿é—®æ§åˆ¶


**ğŸšª é¡µé¢è®¿é—®æƒé™æ£€æŸ¥**
```javascript
// åœ¨éœ€è¦ç™»å½•çš„é¡µé¢é¡¶éƒ¨è°ƒç”¨
function requireLogin() {
  if (!TokenManager.hasToken()) {
    // è®°ä½å½“å‰é¡µé¢ï¼Œç™»å½•åè·³è½¬å›æ¥
    const currentUrl = window.location.href;
    window.location.href = `/login?return=${encodeURIComponent(currentUrl)}`;
    return false;
  }
  return true;
}

// ä½¿ç”¨ç¤ºä¾‹
if (!requireLogin()) {
  // å¦‚æœæœªç™»å½•ï¼Œä¼šè·³è½¬åˆ°ç™»å½•é¡µï¼Œåç»­ä»£ç ä¸ä¼šæ‰§è¡Œ
}

// ç»§ç»­æ‰§è¡Œéœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„åŠŸèƒ½
loadUserData();
```

---

## 6. ğŸ”„ è‡ªåŠ¨ç™»å½•æœºåˆ¶


### 6.1 è‡ªåŠ¨ç™»å½•çš„åŸç†


**âš¡ è‡ªåŠ¨ç™»å½•æµç¨‹**
```
ç”¨æˆ·è®¿é—®ç½‘ç«™
       â†“
æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰Token
       â†“
    æœ‰Token?
    â†™      â†˜
   æ˜¯        å¦
   â†“         â†“
éªŒè¯Token   æ˜¾ç¤ºç™»å½•é¡µ
   â†“
Tokenæœ‰æ•ˆ?
  â†™    â†˜
 æ˜¯      å¦
 â†“       â†“
è‡ªåŠ¨ç™»å½•  æ¸…é™¤Token
æ˜¾ç¤ºç•Œé¢  æ˜¾ç¤ºç™»å½•é¡µ
```

### 6.2 è®°ä½ç™»å½•çŠ¶æ€å®ç°


**ğŸ’¾ å®Œæ•´çš„è®°ä½ç™»å½•åŠŸèƒ½**
```javascript
class AutoLogin {
  // è®¾ç½®è‡ªåŠ¨ç™»å½•
  static enableAutoLogin(token, userInfo) {
    // ä½¿ç”¨localStorageå®ç°æŒä¹…å­˜å‚¨
    localStorage.setItem('authToken', token);
    localStorage.setItem('userInfo', JSON.stringify(userInfo));
    localStorage.setItem('loginTime', Date.now().toString());
    
    // å¯é€‰ï¼šè®¾ç½®7å¤©è¿‡æœŸ
    const expireTime = Date.now() + (7 * 24 * 60 * 60 * 1000);
    localStorage.setItem('tokenExpire', expireTime.toString());
  }
  
  // æ£€æŸ¥è‡ªåŠ¨ç™»å½•
  static async checkAutoLogin() {
    const token = localStorage.getItem('authToken');
    const expireTime = localStorage.getItem('tokenExpire');
    
    if (!token) {
      return false; // æ²¡æœ‰ä¿å­˜çš„Token
    }
    
    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    if (expireTime && Date.now() > parseInt(expireTime)) {
      this.clearAutoLogin();
      return false; // Tokenå·²è¿‡æœŸ
    }
    
    try {
      // éªŒè¯Tokenæ˜¯å¦ä»ç„¶æœ‰æ•ˆ
      const response = await fetch('/api/user/check', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.ok) {
        // Tokenæœ‰æ•ˆï¼Œæ¢å¤ç™»å½•çŠ¶æ€
        const userInfo = localStorage.getItem('userInfo');
        if (userInfo) {
          sessionStorage.setItem('authToken', token);
          sessionStorage.setItem('userInfo', userInfo);
        }
        return true;
      } else {
        // Tokenæ— æ•ˆï¼Œæ¸…é™¤ä¿å­˜çš„ä¿¡æ¯
        this.clearAutoLogin();
        return false;
      }
    } catch (error) {
      console.error('è‡ªåŠ¨ç™»å½•æ£€æŸ¥å¤±è´¥ï¼š', error);
      return false;
    }
  }
  
  // æ¸…é™¤è‡ªåŠ¨ç™»å½•ä¿¡æ¯
  static clearAutoLogin() {
    localStorage.removeItem('authToken');
    localStorage.removeItem('userInfo');
    localStorage.removeItem('loginTime');
    localStorage.removeItem('tokenExpire');
  }
}
```

### 6.3 é¡µé¢åˆå§‹åŒ–æ—¶çš„è‡ªåŠ¨ç™»å½•


**ğŸš€ å¯åŠ¨æ—¶è‡ªåŠ¨ç™»å½•æ£€æŸ¥**
```javascript
// åº”ç”¨åˆå§‹åŒ–å‡½æ•°
async function initApp() {
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  showLoading();
  
  try {
    // æ£€æŸ¥è‡ªåŠ¨ç™»å½•
    const autoLoginSuccess = await AutoLogin.checkAutoLogin();
    
    if (autoLoginSuccess) {
      console.log('è‡ªåŠ¨ç™»å½•æˆåŠŸ');
      showUserInterface();
    } else {
      console.log('éœ€è¦æ‰‹åŠ¨ç™»å½•');
      showLoginPage();
    }
  } catch (error) {
    console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥ï¼š', error);
    showLoginPage();
  } finally {
    hideLoading();
  }
}

function showLoading() {
  document.getElementById('loadingSpinner').style.display = 'block';
}

function hideLoading() {
  document.getElementById('loadingSpinner').style.display = 'none';
}

// é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
document.addEventListener('DOMContentLoaded', initApp);
```

---

## 7. ğŸšª é€€å‡ºç™»å½•å®ç°


### 7.1 é€€å‡ºç™»å½•çš„æµç¨‹


**ğŸ“¤ é€€å‡ºç™»å½•æ­¥éª¤**
```
ç”¨æˆ·ç‚¹å‡»é€€å‡º
      â†“
ç¡®è®¤æ˜¯å¦é€€å‡º
      â†“
æ¸…é™¤æœ¬åœ°Token
      â†“
é€šçŸ¥æœåŠ¡å™¨ç™»å‡º
      â†“
è·³è½¬åˆ°ç™»å½•é¡µé¢
      â†“
æ˜¾ç¤ºé€€å‡ºæˆåŠŸ
```

### 7.2 å®Œæ•´çš„é€€å‡ºç™»å½•å®ç°


**ğŸšª é€€å‡ºç™»å½•å‡½æ•°**
```javascript
async function handleLogout() {
  // 1. ç¡®è®¤é€€å‡º
  if (!confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
    return;
  }
  
  try {
    // 2. è·å–å½“å‰Token
    const token = TokenManager.getToken();
    
    // 3. é€šçŸ¥æœåŠ¡å™¨ç”¨æˆ·ç™»å‡ºï¼ˆå¯é€‰ï¼‰
    if (token) {
      try {
        await fetch('/api/logout', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
      } catch (error) {
        // æœåŠ¡å™¨é€šçŸ¥å¤±è´¥ä¸å½±å“æœ¬åœ°é€€å‡º
        console.warn('æœåŠ¡å™¨ç™»å‡ºé€šçŸ¥å¤±è´¥ï¼š', error);
      }
    }
    
    // 4. æ¸…é™¤æœ¬åœ°æ‰€æœ‰ç™»å½•ä¿¡æ¯
    TokenManager.clearToken(); // æ¸…é™¤Token
    AutoLogin.clearAutoLogin(); // æ¸…é™¤è‡ªåŠ¨ç™»å½•
    
    // æ¸…é™¤ç”¨æˆ·ä¿¡æ¯
    sessionStorage.removeItem('userInfo');
    localStorage.removeItem('userInfo');
    
    // 5. æ˜¾ç¤ºé€€å‡ºæˆåŠŸ
    alert('é€€å‡ºç™»å½•æˆåŠŸï¼');
    
    // 6. è·³è½¬åˆ°ç™»å½•é¡µé¢
    window.location.href = '/login';
    
  } catch (error) {
    console.error('é€€å‡ºç™»å½•å¤±è´¥ï¼š', error);
    alert('é€€å‡ºç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
}

// ç»‘å®šé€€å‡ºæŒ‰é’®
document.getElementById('logoutBtn').addEventListener('click', handleLogout);
```

### 7.3 é€€å‡ºç™»å½•çš„UIå¤„ç†


**ğŸ¨ é€€å‡ºç¡®è®¤ç•Œé¢**
```html
<!-- é€€å‡ºç¡®è®¤å¯¹è¯æ¡† -->
<div id="logoutModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>ç¡®è®¤é€€å‡º</h3>
    <p>æ‚¨ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ</p>
    <div class="modal-buttons">
      <button id="confirmLogout" class="btn-primary">ç¡®å®šé€€å‡º</button>
      <button id="cancelLogout" class="btn-secondary">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
<div id="userSection">
  <span>æ¬¢è¿ï¼Œ<span id="userName">ç”¨æˆ·</span>!</span>
  <button id="logoutBtn">é€€å‡ºç™»å½•</button>
</div>
```

```javascript
// ä¼˜é›…çš„é€€å‡ºç¡®è®¤
function showLogoutConfirm() {
  const modal = document.getElementById('logoutModal');
  modal.style.display = 'block';
  
  // ç¡®å®šé€€å‡º
  document.getElementById('confirmLogout').onclick = function() {
    modal.style.display = 'none';
    handleLogout();
  };
  
  // å–æ¶ˆé€€å‡º
  document.getElementById('cancelLogout').onclick = function() {
    modal.style.display = 'none';
  };
}

// ç»‘å®šé€€å‡ºæŒ‰é’®
document.getElementById('logoutBtn').addEventListener('click', showLogoutConfirm);
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è®¤è¯ç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µ


> ğŸ’¡ **å…³é”®ç†è§£**
> 
> **è®¤è¯ç³»ç»Ÿå°±åƒé—¨ç¦ç³»ç»Ÿ**ï¼šéªŒè¯èº«ä»½ã€å‘æ”¾é€šè¡Œè¯ã€æ£€æŸ¥æƒé™ã€å®‰å…¨é€€å‡º

```
æ ¸å¿ƒæµç¨‹ï¼šç™»å½• â†’ è·å–Token â†’ æºå¸¦Tokenè®¿é—® â†’ é€€å‡ºæ¸…é™¤
å…³é”®æŠ€æœ¯ï¼šè¡¨å•éªŒè¯ + Fetchè¯·æ±‚ + Tokenå­˜å‚¨ + çŠ¶æ€ç®¡ç†
```

### 8.2 å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹


**ğŸ”¸ ç™»å½•æµç¨‹å®ç°**
- âœ… è¡¨å•æ•°æ®æ”¶é›†å’ŒéªŒè¯
- âœ… å‘é€ç™»å½•è¯·æ±‚åˆ°æœåŠ¡å™¨
- âœ… å¤„ç†ç™»å½•æˆåŠŸ/å¤±è´¥çš„å“åº”
- âœ… ä¿å­˜Tokenå’Œç”¨æˆ·ä¿¡æ¯

**ğŸ”¸ Tokenä»¤ç‰Œç®¡ç†**
- âœ… ç†è§£Tokençš„ä½œç”¨å’Œç‰¹ç‚¹
- âœ… é€‰æ‹©åˆé€‚çš„å­˜å‚¨æ–¹å¼
- âœ… åœ¨è¯·æ±‚ä¸­æ­£ç¡®æºå¸¦Token
- âœ… å¤„ç†Tokenè¿‡æœŸçš„æƒ…å†µ

**ğŸ”¸ ç™»å½•çŠ¶æ€ç»´æŠ¤**
- âœ… é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
- âœ… æ§åˆ¶å—ä¿æŠ¤é¡µé¢çš„è®¿é—®
- âœ… å®ç°è‡ªåŠ¨ç™»å½•åŠŸèƒ½
- âœ… å®Œæ•´çš„é€€å‡ºç™»å½•æµç¨‹

### 8.3 å®æˆ˜å¼€å‘å»ºè®®


**ğŸ“‹ å¼€å‘æ¸…å•**
- [ ] è®¾è®¡ç®€æ´çš„ç™»å½•è¡¨å•
- [ ] å®ç°å‰ç«¯è¡¨å•éªŒè¯
- [ ] å°è£…é€šç”¨çš„è¯·æ±‚å‡½æ•°
- [ ] åˆ›å»ºTokenç®¡ç†å·¥å…·ç±»
- [ ] æ·»åŠ ç™»å½•çŠ¶æ€æ£€æŸ¥
- [ ] å®ç°è®°ä½ç™»å½•åŠŸèƒ½
- [ ] å®Œå–„é€€å‡ºç™»å½•æµç¨‹

**âš ï¸ å¸¸è§é—®é¢˜é¿å…**
```
é—®é¢˜1ï¼šTokenå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
å»ºè®®ï¼šsessionStorage(ä¸´æ—¶) + localStorage(è®°ä½ç™»å½•)

é—®é¢˜2ï¼šå¦‚ä½•å¤„ç†Tokenè¿‡æœŸï¼Ÿ
å»ºè®®ï¼šæ£€æŸ¥å“åº”çŠ¶æ€ç 401ï¼Œè‡ªåŠ¨æ¸…é™¤Tokenå¹¶è·³è½¬ç™»å½•

é—®é¢˜3ï¼šé€€å‡ºç™»å½•è¦åšä»€ä¹ˆï¼Ÿ
å»ºè®®ï¼šæ¸…é™¤æ‰€æœ‰æœ¬åœ°å­˜å‚¨ + é€šçŸ¥æœåŠ¡å™¨ + è·³è½¬ç™»å½•é¡µ

é—®é¢˜4ï¼šå¦‚ä½•å®ç°è‡ªåŠ¨ç™»å½•ï¼Ÿ
å»ºè®®ï¼šé¡µé¢åŠ è½½æ—¶æ£€æŸ¥localStorageä¸­çš„Tokenæ˜¯å¦æœ‰æ•ˆ
```

### 8.4 å®‰å…¨æ³¨æ„äº‹é¡¹


> ğŸ”’ **å®‰å…¨æé†’**
> 
> - Tokenåº”è¯¥æœ‰åˆç†çš„è¿‡æœŸæ—¶é—´
> - æ•æ„Ÿæ“ä½œéœ€è¦é‡æ–°éªŒè¯å¯†ç 
> - HTTPSç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œé¿å…Tokenæ³„éœ²
> - å®šæœŸæ›´æ–°Tokenï¼Œæé«˜å®‰å…¨æ€§

**æ ¸å¿ƒè®°å¿†**ï¼š
- è®¤è¯ç³»ç»Ÿ = èº«ä»½éªŒè¯ + Tokenç®¡ç† + çŠ¶æ€ç»´æŠ¤
- ç™»å½•æµç¨‹ = è¡¨å•æäº¤ â†’ æœåŠ¡å™¨éªŒè¯ â†’ è¿”å›Token â†’ æœ¬åœ°å­˜å‚¨
- Tokenä½¿ç”¨ = è¯·æ±‚æºå¸¦ + è¿‡æœŸå¤„ç† + æƒé™æ£€æŸ¥
- å®Œæ•´ä½“éªŒ = è‡ªåŠ¨ç™»å½• + çŠ¶æ€åŒæ­¥ + å®‰å…¨é€€å‡º