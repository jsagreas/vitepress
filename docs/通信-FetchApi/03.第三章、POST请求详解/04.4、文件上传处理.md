---
title: 4ã€æ–‡ä»¶ä¸Šä¼ å¤„ç†
---
## ğŸ“š ç›®å½•

1. [æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ)
2. [æ ¸å¿ƒå¯¹è±¡è¯¦è§£](#2-æ ¸å¿ƒå¯¹è±¡è¯¦è§£)
3. [å•æ–‡ä»¶ä¸Šä¼ å®ç°](#3-å•æ–‡ä»¶ä¸Šä¼ å®ç°)
4. [å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†](#4-å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†)
5. [æ–‡ä»¶éªŒè¯ä¸å®‰å…¨](#5-æ–‡ä»¶éªŒè¯ä¸å®‰å…¨)
6. [ä¸Šä¼ è¿›åº¦ç›‘æ§](#6-ä¸Šä¼ è¿›åº¦ç›‘æ§)
7. [å›¾ç‰‡é¢„è§ˆåŠŸèƒ½](#7-å›¾ç‰‡é¢„è§ˆåŠŸèƒ½)
8. [å®Œæ•´ä¸Šä¼ æµç¨‹](#8-å®Œæ•´ä¸Šä¼ æµç¨‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¤ æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ 


**ğŸ”¸ ç®€å•ç†è§£**
æ–‡ä»¶ä¸Šä¼ å°±æ˜¯æŠŠä½ ç”µè„‘é‡Œçš„æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰å‘é€åˆ°æœåŠ¡å™¨ä¸Šä¿å­˜èµ·æ¥ï¼Œå°±åƒæŠŠæ–‡ä»¶ä»ä½ å®¶æ¬åˆ°ä»“åº“ä¸€æ ·ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
ä½ çš„ç”µè„‘ ğŸ“± â†’ å¿«é€’æ‰“åŒ… ğŸ“¦ â†’ ç½‘ç»œä¼ è¾“ ğŸšš â†’ æœåŠ¡å™¨å­˜å‚¨ ğŸ¢

ç½‘é¡µæ–‡ä»¶ä¸Šä¼ ï¼š
é€‰æ‹©æ–‡ä»¶ ğŸ“ â†’ æ•°æ®å°è£… ğŸ“¦ â†’ HTTPè¯·æ±‚ ğŸŒ â†’ æœåŠ¡å™¨ä¿å­˜ ğŸ’¾
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦ç‰¹æ®Šå¤„ç†**
- **æ™®é€šæ–‡æœ¬**ï¼šå¯ä»¥ç›´æ¥å‘é€ï¼Œåƒå‘çŸ­ä¿¡ä¸€æ ·
- **æ–‡ä»¶æ•°æ®**ï¼šæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œéœ€è¦ç‰¹æ®Šçš„"åŒ…è£…"æ–¹å¼
- **å¤šç§æ ¼å¼**ï¼šå›¾ç‰‡ã€è§†é¢‘ã€æ–‡æ¡£ç­‰ä¸åŒç±»å‹éœ€è¦ç»Ÿä¸€å¤„ç†

### 1.2 æ–‡ä»¶ä¸Šä¼ çš„å·¥ä½œåŸç†


```
ç”¨æˆ·æ“ä½œæµç¨‹ï¼š
â‘ ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ â†’ â‘¡æµè§ˆå™¨è¯»å–æ–‡ä»¶ â†’ â‘¢å°è£…æˆFormData â†’ â‘£å‘é€POSTè¯·æ±‚

æŠ€æœ¯å®ç°æµç¨‹ï¼š
<input type="file"> â†’ Fileå¯¹è±¡ â†’ FormDataå¯¹è±¡ â†’ fetchå‘é€ â†’ æœåŠ¡å™¨æ¥æ”¶
```

**ğŸ”¸ å…³é”®æŠ€æœ¯ç‚¹**
- **`multipart/form-data`** - ä¸“é—¨ç”¨äºæ–‡ä»¶ä¸Šä¼ çš„æ•°æ®æ ¼å¼
- **`FormData`** - æµè§ˆå™¨æä¾›çš„æ–‡ä»¶å°è£…å·¥å…·
- **`Fileå¯¹è±¡`** - è¡¨ç¤ºç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶
- **`Blobå¯¹è±¡`** - è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®

---

## 2. ğŸ§© æ ¸å¿ƒå¯¹è±¡è¯¦è§£


### 2.1 Fileå¯¹è±¡ - æ–‡ä»¶çš„ä»£è¡¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯Fileå¯¹è±¡**
Fileå¯¹è±¡å°±æ˜¯æµè§ˆå™¨ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶çš„"èº«ä»½è¯"ï¼ŒåŒ…å«äº†æ–‡ä»¶çš„æ‰€æœ‰åŸºæœ¬ä¿¡æ¯ã€‚

```javascript
// å½“ç”¨æˆ·é€‰æ‹©æ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨è‡ªåŠ¨åˆ›å»ºFileå¯¹è±¡
const fileInput = document.querySelector('input[type="file"]');
fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0]; // è¿™å°±æ˜¯Fileå¯¹è±¡
    
    // Fileå¯¹è±¡åŒ…å«çš„ä¿¡æ¯
    console.log('æ–‡ä»¶å:', file.name);       // "avatar.jpg"
    console.log('æ–‡ä»¶å¤§å°:', file.size);     // 1024000 (å­—èŠ‚)
    console.log('æ–‡ä»¶ç±»å‹:', file.type);     // "image/jpeg"
    console.log('æœ€åä¿®æ”¹:', file.lastModified); // æ—¶é—´æˆ³
});
```

**ğŸ”¸ Fileå¯¹è±¡çš„å¸¸ç”¨å±æ€§**

| å±æ€§ | å«ä¹‰ | ç¤ºä¾‹å€¼ |
|------|------|--------|
| `name` | æ–‡ä»¶å | `"å¤´åƒ.jpg"` |
| `size` | æ–‡ä»¶å¤§å°(å­—èŠ‚) | `1024000` |
| `type` | æ–‡ä»¶MIMEç±»å‹ | `"image/jpeg"` |
| `lastModified` | æœ€åä¿®æ”¹æ—¶é—´ | `1672531200000` |

### 2.2 Blobå¯¹è±¡ - äºŒè¿›åˆ¶æ•°æ®å®¹å™¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯Blobå¯¹è±¡**
Blobå°±åƒä¸€ä¸ª"æ•°æ®ç›’å­"ï¼Œå¯ä»¥è£…ä»»ä½•ç±»å‹çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€æ–‡ä»¶ç­‰ï¼‰ã€‚

```javascript
// åˆ›å»ºä¸€ä¸ªç®€å•çš„Blobå¯¹è±¡
const textBlob = new Blob(['Hello World'], { type: 'text/plain' });

// åˆ›å»ºä¸€ä¸ªå›¾ç‰‡Blobï¼ˆå‡è®¾æœ‰imageDataï¼‰
const imageBlob = new Blob([imageData], { type: 'image/png' });

console.log('Blobå¤§å°:', textBlob.size);  // 11
console.log('Blobç±»å‹:', textBlob.type);  // "text/plain"
```

**ğŸ”¸ Fileä¸Blobçš„å…³ç³»**
- **Fileå¯¹è±¡** = **Blobå¯¹è±¡** + **æ–‡ä»¶ä¿¡æ¯**ï¼ˆåç§°ã€ä¿®æ”¹æ—¶é—´ç­‰ï¼‰
- Fileå¯¹è±¡ç»§æ‰¿äº†Blobçš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿˜å¢åŠ äº†æ–‡ä»¶ç‰¹æœ‰çš„å±æ€§

```
Blobå¯¹è±¡ï¼šçº¯æ•°æ®å®¹å™¨
    â†“ ç»§æ‰¿å¹¶æ‰©å±•
Fileå¯¹è±¡ï¼šæ–‡ä»¶æ•°æ® + æ–‡ä»¶ä¿¡æ¯
```

### 2.3 FormDataå¯¹è±¡ - è¡¨å•æ•°æ®å°è£…å™¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯FormDataå¯¹è±¡**
FormDataå°±åƒä¸€ä¸ª"è¡¨å•æ‰“åŒ…å™¨"ï¼Œå¯ä»¥æŠŠæ–‡ä»¶ã€æ–‡æœ¬ç­‰å„ç§æ•°æ®æ‰“åŒ…æˆä¸€ä¸ªåŒ…è£¹ï¼Œæ–¹ä¾¿ä¸€æ¬¡æ€§å‘é€ã€‚

```javascript
// åˆ›å»ºFormDataå¯¹è±¡
const formData = new FormData();

// æ·»åŠ æ–‡æœ¬æ•°æ®
formData.append('username', 'xiaoming');
formData.append('age', '25');

// æ·»åŠ æ–‡ä»¶æ•°æ®
const fileInput = document.querySelector('#avatar');
const file = fileInput.files[0];
formData.append('avatar', file);

// ç°åœ¨formDataåŒ…å«äº†æ–‡æœ¬å’Œæ–‡ä»¶ï¼Œå¯ä»¥ä¸€èµ·å‘é€
```

**ğŸ”¸ FormDataçš„æ ¸å¿ƒæ–¹æ³•**

```javascript
const formData = new FormData();

// æ·»åŠ æ•°æ®
formData.append('key', 'value');    // æ·»åŠ æ–‡æœ¬
formData.append('file', fileObject); // æ·»åŠ æ–‡ä»¶

// è·å–æ•°æ®
formData.get('key');                // è·å–å€¼
formData.has('key');                // æ£€æŸ¥æ˜¯å¦å­˜åœ¨

// åˆ é™¤æ•°æ®
formData.delete('key');             // åˆ é™¤æŒ‡å®šé¡¹
```

---

## 3. ğŸ“ å•æ–‡ä»¶ä¸Šä¼ å®ç°


### 3.1 åŸºç¡€HTMLç»“æ„


```html
<!-- æ–‡ä»¶é€‰æ‹©å™¨ -->
<input type="file" id="fileInput" accept="image/*">
<button onclick="uploadFile()">ä¸Šä¼ æ–‡ä»¶</button>

<!-- æ˜¾ç¤ºä¸Šä¼ ç»“æœ -->
<div id="result"></div>
```

**ğŸ”¸ inputå±æ€§è¯´æ˜**
- `type="file"` - åˆ›å»ºæ–‡ä»¶é€‰æ‹©å™¨
- `accept="image/*"` - åªå…è®¸é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
- `accept=".jpg,.png,.pdf"` - æŒ‡å®šå…·ä½“æ–‡ä»¶ç±»å‹

### 3.2 å•æ–‡ä»¶ä¸Šä¼ å®Œæ•´ä»£ç 


```javascript
async function uploadFile() {
    // â‘ è·å–ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    // â‘¡æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶
    if (!file) {
        alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    // â‘¢åˆ›å»ºFormDataå¹¶æ·»åŠ æ–‡ä»¶
    const formData = new FormData();
    formData.append('file', file);
    formData.append('description', 'ç”¨æˆ·å¤´åƒ'); // å¯ä»¥åŒæ—¶å‘é€å…¶ä»–æ•°æ®
    
    try {
        // â‘£å‘é€æ–‡ä»¶åˆ°æœåŠ¡å™¨
        const response = await fetch('/api/upload', {
            method: 'POST',
            body: formData
            // æ³¨æ„ï¼šä¸è¦æ‰‹åŠ¨è®¾ç½®Content-Typeï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®
        });
        
        // â‘¤å¤„ç†æœåŠ¡å™¨å“åº”
        if (response.ok) {
            const result = await response.json();
            document.getElementById('result').innerHTML = 
                `<p style="color: green;">ä¸Šä¼ æˆåŠŸï¼æ–‡ä»¶åœ°å€ï¼š${result.url}</p>`;
        } else {
            throw new Error('ä¸Šä¼ å¤±è´¥');
        }
        
    } catch (error) {
        document.getElementById('result').innerHTML = 
            `<p style="color: red;">ä¸Šä¼ å‡ºé”™ï¼š${error.message}</p>`;
    }
}
```

### 3.3 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¸ ä¸ºä»€ä¹ˆä¸è®¾ç½®Content-Type**
```javascript
// âŒ é”™è¯¯å†™æ³• - ä¸è¦æ‰‹åŠ¨è®¾ç½®
const response = await fetch('/api/upload', {
    method: 'POST',
    headers: {
        'Content-Type': 'multipart/form-data'  // è¿™æ ·ä¼šå‡ºé”™ï¼
    },
    body: formData
});

// âœ… æ­£ç¡®å†™æ³• - è®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®
const response = await fetch('/api/upload', {
    method: 'POST',
    body: formData  // æµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„Content-Type
});
```

**ğŸ”¸ åŸå› è§£é‡Š**
æµè§ˆå™¨éœ€è¦åœ¨`multipart/form-data`åé¢æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„`boundary`å‚æ•°ï¼Œæ‰‹åŠ¨è®¾ç½®ä¼šä¸¢å¤±è¿™ä¸ªå‚æ•°ã€‚

---

## 4. ğŸ“ å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†


### 4.1 å¤šæ–‡ä»¶é€‰æ‹©HTML


```html
<!-- å…è®¸é€‰æ‹©å¤šä¸ªæ–‡ä»¶ -->
<input type="file" id="multiFileInput" multiple accept="image/*">
<button onclick="uploadMultipleFiles()">ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</button>

<!-- æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ -->
<div id="uploadProgress"></div>
```

### 4.2 å¤šæ–‡ä»¶ä¸Šä¼ å®ç°


```javascript
async function uploadMultipleFiles() {
    const fileInput = document.getElementById('multiFileInput');
    const files = fileInput.files; // è¿™æ˜¯ä¸€ä¸ªFileListå¯¹è±¡
    
    if (files.length === 0) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    // æ–¹æ³•ä¸€ï¼šä¸€æ¬¡æ€§ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
    await uploadAllAtOnce(files);
    
    // æ–¹æ³•äºŒï¼šé€ä¸ªä¸Šä¼ æ–‡ä»¶ï¼ˆæ¨èï¼‰
    // await uploadOneByOne(files);
}

// æ–¹æ³•ä¸€ï¼šä¸€æ¬¡æ€§ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
async function uploadAllAtOnce(files) {
    const formData = new FormData();
    
    // å°†æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°FormData
    for (let i = 0; i < files.length; i++) {
        formData.append('files', files[i]); // æ³¨æ„ï¼šéƒ½ç”¨åŒä¸€ä¸ªkey
    }
    
    try {
        const response = await fetch('/api/upload-multiple', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        console.log('æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ:', result);
    } catch (error) {
        console.error('ä¸Šä¼ å¤±è´¥:', error);
    }
}

// æ–¹æ³•äºŒï¼šé€ä¸ªä¸Šä¼ æ–‡ä»¶ï¼ˆæ¨èç”¨äºå¤§æ–‡ä»¶ï¼‰
async function uploadOneByOne(files) {
    const progressDiv = document.getElementById('uploadProgress');
    
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        progressDiv.innerHTML = `æ­£åœ¨ä¸Šä¼ ç¬¬${i + 1}ä¸ªæ–‡ä»¶ï¼š${file.name}`;
        
        const formData = new FormData();
        formData.append('file', file);
        
        try {
            const response = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                console.log(`æ–‡ä»¶${file.name}ä¸Šä¼ æˆåŠŸ`);
            }
        } catch (error) {
            console.error(`æ–‡ä»¶${file.name}ä¸Šä¼ å¤±è´¥:`, error);
        }
    }
    
    progressDiv.innerHTML = 'æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼';
}
```

### 4.3 å¤šæ–‡ä»¶ä¸Šä¼ ç­–ç•¥å¯¹æ¯”


| ç­–ç•¥ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| **ä¸€æ¬¡æ€§ä¸Šä¼ ** | `ç®€å•å¿«é€Ÿ` | `å¤±è´¥é‡ä¼ å›°éš¾ï¼Œå ç”¨å†…å­˜å¤§` | `å°æ–‡ä»¶æ‰¹é‡ä¸Šä¼ ` |
| **é€ä¸ªä¸Šä¼ ** | `å¯æ§æ€§å¼ºï¼Œå¤±è´¥å¯é‡è¯•` | `è€—æ—¶è¾ƒé•¿ï¼Œè¯·æ±‚æ¬¡æ•°å¤š` | `å¤§æ–‡ä»¶æˆ–éœ€è¦è¿›åº¦æ˜¾ç¤º` |

---

## 5. ğŸ”’ æ–‡ä»¶éªŒè¯ä¸å®‰å…¨


### 5.1 æ–‡ä»¶ç±»å‹éªŒè¯


```javascript
function validateFile(file) {
    // â‘ æ£€æŸ¥æ–‡ä»¶ç±»å‹
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
    if (!allowedTypes.includes(file.type)) {
        alert('åªå…è®¸ä¸Šä¼  JPGã€PNGã€GIF æ ¼å¼çš„å›¾ç‰‡');
        return false;
    }
    
    // â‘¡æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ2MBé™åˆ¶ï¼‰
    const maxSize = 2 * 1024 * 1024; // 2MB
    if (file.size > maxSize) {
        alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MB');
        return false;
    }
    
    // â‘¢æ£€æŸ¥æ–‡ä»¶å
    if (file.name.length > 100) {
        alert('æ–‡ä»¶åè¿‡é•¿');
        return false;
    }
    
    return true;
}

// ä½¿ç”¨éªŒè¯
async function safeUploadFile() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    // éªŒè¯æ–‡ä»¶
    if (!validateFile(file)) {
        return; // éªŒè¯å¤±è´¥ï¼Œåœæ­¢ä¸Šä¼ 
    }
    
    // éªŒè¯é€šè¿‡ï¼Œç»§ç»­ä¸Šä¼ 
    const formData = new FormData();
    formData.append('file', file);
    
    // ... ä¸Šä¼ ä»£ç 
}
```

### 5.2 å¸¸è§æ–‡ä»¶ç±»å‹MIMEå¯¹ç…§


```javascript
const mimeTypes = {
    // å›¾ç‰‡ç±»å‹
    'image/jpeg': ['.jpg', '.jpeg'],
    'image/png': ['.png'],
    'image/gif': ['.gif'],
    'image/webp': ['.webp'],
    
    // æ–‡æ¡£ç±»å‹
    'application/pdf': ['.pdf'],
    'text/plain': ['.txt'],
    'application/msword': ['.doc'],
    
    // å‹ç¼©æ–‡ä»¶
    'application/zip': ['.zip'],
    'application/x-rar-compressed': ['.rar']
};

// æ£€æŸ¥æ–‡ä»¶ç±»å‹çš„å‡½æ•°
function isValidFileType(file, allowedTypes) {
    return allowedTypes.includes(file.type);
}
```

### 5.3 æ–‡ä»¶å¤§å°å‹å¥½æ˜¾ç¤º


```javascript
function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    
    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
}

// ä½¿ç”¨ç¤ºä¾‹
const file = fileInput.files[0];
console.log(`æ–‡ä»¶å¤§å°: ${formatFileSize(file.size)}`); // "æ–‡ä»¶å¤§å°: 1.5 MB"
```

---

## 6. ğŸ“Š ä¸Šä¼ è¿›åº¦ç›‘æ§


### 6.1 ä¸ºä»€ä¹ˆFetch APIæ— æ³•ç›‘æ§è¿›åº¦


**ğŸ”¸ æŠ€æœ¯é™åˆ¶è¯´æ˜**
Fetch APIç›®å‰ä¸æ”¯æŒä¸Šä¼ è¿›åº¦ç›‘æ§ï¼Œè¿™æ˜¯å®ƒçš„ä¸€ä¸ªå±€é™æ€§ã€‚å¦‚æœéœ€è¦è¿›åº¦ç›‘æ§ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š

### 6.2 ä½¿ç”¨XMLHttpRequestç›‘æ§è¿›åº¦


```javascript
function uploadWithProgress(file) {
    return new Promise((resolve, reject) => {
        const formData = new FormData();
        formData.append('file', file);
        
        const xhr = new XMLHttpRequest();
        
        // ç›‘å¬ä¸Šä¼ è¿›åº¦
        xhr.upload.addEventListener('progress', (e) => {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                updateProgressBar(percentComplete);
            }
        });
        
        // ç›‘å¬å®Œæˆäº‹ä»¶
        xhr.addEventListener('load', () => {
            if (xhr.status === 200) {
                resolve(JSON.parse(xhr.responseText));
            } else {
                reject(new Error('ä¸Šä¼ å¤±è´¥'));
            }
        });
        
        // ç›‘å¬é”™è¯¯äº‹ä»¶
        xhr.addEventListener('error', () => {
            reject(new Error('ç½‘ç»œé”™è¯¯'));
        });
        
        // å‘é€è¯·æ±‚
        xhr.open('POST', '/api/upload');
        xhr.send(formData);
    });
}

// æ›´æ–°è¿›åº¦æ¡æ˜¾ç¤º
function updateProgressBar(percent) {
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    progressBar.style.width = percent + '%';
    progressText.textContent = Math.round(percent) + '%';
}
```

### 6.3 ç®€æ˜“è¿›åº¦æ¡HTML


```html
<div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
    <span class="progress-text" id="progressText">0%</span>
</div>

<style>
.progress-container {
    width: 100%;
    background-color: #f0f0f0;
    border-radius: 4px;
    position: relative;
}

.progress-bar {
    height: 20px;
    background-color: #4CAF50;
    border-radius: 4px;
    width: 0%;
    transition: width 0.3s;
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
}
</style>
```

### 6.4 æ¨¡æ‹Ÿè¿›åº¦æ˜¾ç¤ºï¼ˆFetchç‰ˆæœ¬ï¼‰


```javascript
// å¦‚æœå¿…é¡»ä½¿ç”¨Fetchï¼Œå¯ä»¥æ¨¡æ‹Ÿè¿›åº¦æ˜¾ç¤º
async function uploadWithFakeProgress(file) {
    const progressDiv = document.getElementById('uploadProgress');
    
    // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
    const fakeProgress = setInterval(() => {
        const currentWidth = parseInt(progressDiv.style.width) || 0;
        if (currentWidth < 90) {
            progressDiv.style.width = (currentWidth + 10) + '%';
            progressDiv.textContent = (currentWidth + 10) + '%';
        }
    }, 200);
    
    try {
        const formData = new FormData();
        formData.append('file', file);
        
        const response = await fetch('/api/upload', {
            method: 'POST',
            body: formData
        });
        
        // ä¸Šä¼ å®Œæˆï¼Œè¿›åº¦è®¾ä¸º100%
        clearInterval(fakeProgress);
        progressDiv.style.width = '100%';
        progressDiv.textContent = '100%';
        
        return await response.json();
    } catch (error) {
        clearInterval(fakeProgress);
        throw error;
    }
}
```

---

## 7. ğŸ–¼ï¸ å›¾ç‰‡é¢„è§ˆåŠŸèƒ½


### 7.1 åŸºç¡€å›¾ç‰‡é¢„è§ˆ


```javascript
function previewImage(file) {
    // æ£€æŸ¥æ˜¯å¦æ˜¯å›¾ç‰‡æ–‡ä»¶
    if (!file.type.startsWith('image/')) {
        alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
        return;
    }
    
    // åˆ›å»ºFileReaderå¯¹è±¡
    const reader = new FileReader();
    
    // æ–‡ä»¶è¯»å–å®Œæˆåçš„å¤„ç†
    reader.onload = function(e) {
        const img = document.getElementById('preview');
        img.src = e.target.result; // è®¾ç½®å›¾ç‰‡æºä¸ºè¯»å–çš„æ•°æ®
        img.style.display = 'block';
    };
    
    // å¼€å§‹è¯»å–æ–‡ä»¶ï¼ˆè½¬ä¸ºbase64æ ¼å¼ï¼‰
    reader.readAsDataURL(file);
}

// HTMLç»“æ„
// <input type="file" accept="image/*" onchange="previewImage(this.files[0])">
// <img id="preview" style="display: none; max-width: 300px;">
```

### 7.2 å¤šå›¾ç‰‡é¢„è§ˆ


```javascript
function previewMultipleImages(files) {
    const previewContainer = document.getElementById('previewContainer');
    previewContainer.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„é¢„è§ˆ
    
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                // åˆ›å»ºå›¾ç‰‡é¢„è§ˆå…ƒç´ 
                const imgDiv = document.createElement('div');
                imgDiv.className = 'preview-item';
                imgDiv.innerHTML = `
                    <img src="${e.target.result}" alt="${file.name}">
                    <p>${file.name}</p>
                    <p>${formatFileSize(file.size)}</p>
                `;
                
                previewContainer.appendChild(imgDiv);
            };
            
            reader.readAsDataURL(file);
        }
    }
}
```

### 7.3 é¢„è§ˆæ ·å¼CSS


```css
.preview-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
}

.preview-item {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    background: #f9f9f9;
}

.preview-item img {
    max-width: 150px;
    max-height: 150px;
    object-fit: cover;
    border-radius: 4px;
}

.preview-item p {
    margin: 5px 0;
    font-size: 12px;
    color: #666;
}
```

---

## 8. ğŸ”„ å®Œæ•´ä¸Šä¼ æµç¨‹


### 8.1 å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶


```javascript
class FileUploader {
    constructor(options) {
        this.options = {
            maxSize: 2 * 1024 * 1024, // 2MB
            allowedTypes: ['image/jpeg', 'image/png', 'image/gif'],
            uploadUrl: '/api/upload',
            ...options
        };
        
        this.files = [];
        this.init();
    }
    
    init() {
        this.createHTML();
        this.bindEvents();
    }
    
    createHTML() {
        const container = document.getElementById(this.options.containerId);
        container.innerHTML = `
            <div class="upload-area">
                <input type="file" id="fileInput" multiple accept="image/*" hidden>
                <button onclick="document.getElementById('fileInput').click()">
                    é€‰æ‹©æ–‡ä»¶
                </button>
                <div class="drag-area">æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
            </div>
            <div id="fileList"></div>
            <button id="uploadBtn" style="display:none;">å¼€å§‹ä¸Šä¼ </button>
            <div id="result"></div>
        `;
    }
    
    bindEvents() {
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        
        fileInput.addEventListener('change', (e) => {
            this.handleFiles(e.target.files);
        });
        
        uploadBtn.addEventListener('click', () => {
            this.uploadFiles();
        });
    }
    
    handleFiles(files) {
        this.files = Array.from(files).filter(file => {
            return this.validateFile(file);
        });
        
        if (this.files.length > 0) {
            this.showFileList();
            document.getElementById('uploadBtn').style.display = 'block';
        }
    }
    
    validateFile(file) {
        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        if (!this.options.allowedTypes.includes(file.type)) {
            alert(`æ–‡ä»¶${file.name}æ ¼å¼ä¸æ”¯æŒ`);
            return false;
        }
        
        // æ£€æŸ¥æ–‡ä»¶å¤§å°
        if (file.size > this.options.maxSize) {
            alert(`æ–‡ä»¶${file.name}è¶…å‡ºå¤§å°é™åˆ¶`);
            return false;
        }
        
        return true;
    }
    
    showFileList() {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = '<h3>å¾…ä¸Šä¼ æ–‡ä»¶ï¼š</h3>';
        
        this.files.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.innerHTML = `
                <p>${file.name} (${formatFileSize(file.size)})</p>
            `;
            fileList.appendChild(fileItem);
        });
    }
    
    async uploadFiles() {
        const result = document.getElementById('result');
        result.innerHTML = 'æ­£åœ¨ä¸Šä¼ ...';
        
        try {
            const formData = new FormData();
            this.files.forEach(file => {
                formData.append('files', file);
            });
            
            const response = await fetch(this.options.uploadUrl, {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const data = await response.json();
                result.innerHTML = '<p style="color: green;">ä¸Šä¼ æˆåŠŸï¼</p>';
                console.log('ä¸Šä¼ ç»“æœ:', data);
            } else {
                throw new Error('ä¸Šä¼ å¤±è´¥');
            }
        } catch (error) {
            result.innerHTML = `<p style="color: red;">ä¸Šä¼ å¤±è´¥: ${error.message}</p>`;
        }
    }
}

// ä½¿ç”¨æ–¹å¼
const uploader = new FileUploader({
    containerId: 'uploadContainer',
    maxSize: 5 * 1024 * 1024, // 5MB
    uploadUrl: '/api/upload'
});
```

### 8.2 æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½


```javascript
function enableDragUpload() {
    const dragArea = document.querySelector('.drag-area');
    
    // é˜»æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dragArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        });
    });
    
    // æ‹–æ‹½è¿›å…¥
    dragArea.addEventListener('dragenter', () => {
        dragArea.classList.add('drag-over');
    });
    
    // æ‹–æ‹½ç¦»å¼€
    dragArea.addEventListener('dragleave', () => {
        dragArea.classList.remove('drag-over');
    });
    
    // æ–‡ä»¶æ”¾ä¸‹
    dragArea.addEventListener('drop', (e) => {
        dragArea.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        handleFiles(files);
    });
}

// CSSæ ·å¼
.drag-area {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    margin: 10px 0;
    cursor: pointer;
}

.drag-area.drag-over {
    border-color: #007bff;
    background-color: #f0f8ff;
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ–‡ä»¶ä¸Šä¼ æœ¬è´¨ï¼šæŠŠæœ¬åœ°æ–‡ä»¶é€šè¿‡HTTPè¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨
ğŸ”¸ æ ¸å¿ƒå¯¹è±¡ï¼šFileå¯¹è±¡(æ–‡ä»¶ä¿¡æ¯) + FormDataå¯¹è±¡(æ•°æ®å°è£…)
ğŸ”¸ è¯·æ±‚æ ¼å¼ï¼šmultipart/form-dataï¼Œæµè§ˆå™¨è‡ªåŠ¨è®¾ç½®
ğŸ”¸ éªŒè¯æœºåˆ¶ï¼šæ–‡ä»¶ç±»å‹ã€å¤§å°ã€å®‰å…¨æ€§æ£€æŸ¥
ğŸ”¸ é¢„è§ˆåŠŸèƒ½ï¼šFileReaderè¯»å–æ–‡ä»¶å†…å®¹æ˜¾ç¤º
ğŸ”¸ è¿›åº¦ç›‘æ§ï¼šFetchä¸æ”¯æŒï¼Œéœ€è¦XMLHttpRequest
```

### 9.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ FormDataä½¿ç”¨è¦ç‚¹**
```javascript
const formData = new FormData();
formData.append('file', fileObject);     // æ·»åŠ æ–‡ä»¶
formData.append('description', 'text');  // æ·»åŠ æ–‡æœ¬

// âœ… æ­£ç¡®ï¼šè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®Content-Type
fetch('/upload', { method: 'POST', body: formData });

// âŒ é”™è¯¯ï¼šæ‰‹åŠ¨è®¾ç½®ä¼šç ´åboundaryå‚æ•°
fetch('/upload', { 
    headers: { 'Content-Type': 'multipart/form-data' }, 
    method: 'POST', 
    body: formData 
});
```

**ğŸ”¹ æ–‡ä»¶éªŒè¯æœ€ä½³å®è·µ**
```javascript
function validateFile(file) {
    // å‰ç«¯éªŒè¯ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
    const checks = [
        () => file.size <= maxSize,           // å¤§å°æ£€æŸ¥
        () => allowedTypes.includes(file.type), // ç±»å‹æ£€æŸ¥
        () => file.name.length <= 100           // åç§°é•¿åº¦
    ];
    
    return checks.every(check => check());
}
// æ³¨æ„ï¼šåç«¯ä¹Ÿå¿…é¡»è¿›è¡Œç›¸åŒéªŒè¯ï¼ˆå®‰å…¨æ€§ï¼‰
```

**ğŸ”¹ å¤šæ–‡ä»¶ä¸Šä¼ ç­–ç•¥**
```
å°æ–‡ä»¶æ‰¹é‡ï¼šä¸€æ¬¡æ€§ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
å¤§æ–‡ä»¶åœºæ™¯ï¼šé€ä¸ªä¸Šä¼ ï¼Œä¾¿äºé”™è¯¯å¤„ç†
éœ€è¦è¿›åº¦ï¼šä½¿ç”¨XMLHttpRequestæ›¿ä»£Fetch
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¸¸è§åº”ç”¨åœºæ™¯**
- **å¤´åƒä¸Šä¼ **ï¼šå•æ–‡ä»¶ï¼Œå›¾ç‰‡é¢„è§ˆï¼Œå¤§å°é™åˆ¶
- **ç›¸å†Œä¸Šä¼ **ï¼šå¤šæ–‡ä»¶ï¼Œæ‰¹é‡é¢„è§ˆï¼Œè¿›åº¦æ˜¾ç¤º
- **æ–‡æ¡£ä¸Šä¼ **ï¼šå„ç§æ ¼å¼ï¼Œæ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
- **æ‹–æ‹½ä¸Šä¼ **ï¼šæå‡ç”¨æˆ·ä½“éªŒ

**ğŸ”§ å¼€å‘å»ºè®®**
- **æ€»æ˜¯è¿›è¡Œæ–‡ä»¶éªŒè¯**ï¼šå‰ç«¯éªŒè¯æå‡ä½“éªŒï¼Œåç«¯éªŒè¯ä¿è¯å®‰å…¨
- **åˆç†è®¾ç½®å¤§å°é™åˆ¶**ï¼šæ ¹æ®æœåŠ¡å™¨å’Œç½‘ç»œæƒ…å†µè°ƒæ•´
- **æä¾›ä¸Šä¼ åé¦ˆ**ï¼šè¿›åº¦æ˜¾ç¤ºæˆ–çŠ¶æ€æç¤º
- **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸ã€æ–‡ä»¶æ ¼å¼é”™è¯¯ç­‰æƒ…å†µ

**âš ï¸ æ³¨æ„äº‹é¡¹**
- FormDataå‘é€æ—¶ä¸è¦æ‰‹åŠ¨è®¾ç½®Content-Type
- Fileå¯¹è±¡åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ³¨æ„éšç§ä¿æŠ¤
- å¤§æ–‡ä»¶ä¸Šä¼ è€ƒè™‘åˆ†ç‰‡ä¸Šä¼ æŠ€æœ¯
- ç§»åŠ¨ç«¯æ³¨æ„æ–‡ä»¶é€‰æ‹©å™¨çš„å…¼å®¹æ€§

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ–‡ä»¶ä¸Šä¼ ä¸‰æ­¥èµ°ï¼šé€‰æ‹©æ–‡ä»¶ï¼ŒFormDataå°è£…ï¼Œfetchå‘é€
- éªŒè¯æ–‡ä»¶åŒä¿é™©ï¼šå‰ç«¯ä½“éªŒï¼Œåç«¯å®‰å…¨
- è¿›åº¦ç›‘æ§ç”¨XMLHttpRequestï¼Œé¢„è§ˆåŠŸèƒ½ç”¨FileReader
- Content-Typeè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®ï¼Œæ‰‹åŠ¨è®¾ç½®ä¼šå‡ºé”™