---
title: 1ã€REST APIå®‰å…¨
---
## ğŸ“š ç›®å½•

1. [REST APIå®‰å…¨åŸºç¡€](#1-REST-APIå®‰å…¨åŸºç¡€)
2. [APIè¶Šæƒè®¿é—®æ”»å‡»ä¸é˜²æŠ¤](#2-APIè¶Šæƒè®¿é—®æ”»å‡»ä¸é˜²æŠ¤)
3. [å‚æ•°æ±¡æŸ“ä¸è´¨é‡æ£€æµ‹ç»•è¿‡](#3-å‚æ•°æ±¡æŸ“ä¸è´¨é‡æ£€æµ‹ç»•è¿‡)
4. [æ¥å£é‰´æƒä¸ç­¾åæœºåˆ¶](#4-æ¥å£é‰´æƒä¸ç­¾åæœºåˆ¶)
5. [APIé™æµä¸ç†”æ–­ä¿æŠ¤](#5-APIé™æµä¸ç†”æ–­ä¿æŠ¤)
6. [æ¥å£ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§](#6-æ¥å£ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§)
7. [æ¥å£æœªæˆæƒè®¿é—®é˜²æŠ¤](#7-æ¥å£æœªæˆæƒè®¿é—®é˜²æŠ¤)
8. [èµ„æºéš”ç¦»ç­–ç•¥](#8-èµ„æºéš”ç¦»ç­–ç•¥)
9. [è§’è‰²æƒé™æ ¡éªŒæœºåˆ¶](#9-è§’è‰²æƒé™æ ¡éªŒæœºåˆ¶)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” REST APIå®‰å…¨åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯REST API


**ç®€å•ç†è§£**ï¼šREST APIå°±åƒé¤å…çš„èœå•å’Œç‚¹é¤ç³»ç»Ÿ

```
ä¼ ç»Ÿç¨‹åºè°ƒç”¨ï¼š          REST APIè°ƒç”¨ï¼š
å¨å¸ˆç›´æ¥åšèœ             å®¢æˆ·çœ‹èœå•ç‚¹é¤
â†“                      â†“
é¡¾å®¢ç›´æ¥åƒ              æœåŠ¡å‘˜ä¼ è¾¾éœ€æ±‚
                       â†“
                       å¨å¸ˆæŒ‰èœå•åšèœ
                       â†“
                       æœåŠ¡å‘˜ä¸Šèœç»™é¡¾å®¢
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ½ï¸ **ç»Ÿä¸€æ¥å£**ï¼šå°±åƒæ ‡å‡†åŒ–çš„èœå•ï¼Œæ¯é“èœéƒ½æœ‰å›ºå®šçš„ç¼–å·å’Œåšæ³•
- ğŸ“‹ **æ— çŠ¶æ€**ï¼šæ¯æ¬¡ç‚¹é¤éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸è®°ä½ä½ ä¸Šæ¬¡ç‚¹äº†ä»€ä¹ˆ
- ğŸ¯ **èµ„æºå¯¼å‘**ï¼šæŠŠæ•°æ®çœ‹ä½œèµ„æºï¼Œç”¨URLåœ°å€æ¥è®¿é—®
- ğŸ”„ **æ ‡å‡†æ“ä½œ**ï¼šå¢åˆ æ”¹æŸ¥å¯¹åº”GETã€POSTã€PUTã€DELETE

### 1.2 REST APIçš„å®‰å…¨æŒ‘æˆ˜


**ä¸ºä»€ä¹ˆAPIç‰¹åˆ«å®¹æ˜“è¢«æ”»å‡»**ï¼š

```
Webé¡µé¢å®‰å…¨ï¼š               APIå®‰å…¨ï¼š
ç”¨æˆ· â†’ æµè§ˆå™¨ â†’ æœåŠ¡å™¨        ç¨‹åº â†’ ç›´æ¥è°ƒç”¨ â†’ æœåŠ¡å™¨
  â†‘                          â†‘
æœ‰äººå·¥åˆ¤æ–­                   çº¯è‡ªåŠ¨åŒ–æ‰§è¡Œ
ååº”è¾ƒæ…¢                     æ‰§è¡Œé€Ÿåº¦æå¿«
```

**ä¸»è¦å®‰å…¨é£é™©**ï¼š
- ğŸšª **æš´éœ²é¢å¤§**ï¼šAPIæ¥å£é€šå¸¸ç›´æ¥æš´éœ²åœ¨ç½‘ç»œä¸Š
- ğŸ¤– **è‡ªåŠ¨åŒ–æ”»å‡»**ï¼šæ”»å‡»è€…å¯ä»¥ç”¨ç¨‹åºæ‰¹é‡æ”»å‡»
- ğŸ” **éš¾ä»¥ç›‘æ§**ï¼šAPIè°ƒç”¨ä¸åƒç½‘é¡µè®¿é—®é‚£ä¹ˆå®¹æ˜“è¢«å‘ç°
- ğŸ’¾ **æ•°æ®ç›´è¾¾**ï¼šæˆåŠŸæ”»å‡»å¯ä»¥ç›´æ¥è·å–æ•°æ®åº“æ•°æ®

---

## 2. ğŸ”“ APIè¶Šæƒè®¿é—®æ”»å‡»ä¸é˜²æŠ¤


### 2.1 ä»€ä¹ˆæ˜¯APIè¶Šæƒè®¿é—®


**é€šä¿—è§£é‡Š**ï¼šå°±åƒæ‹¿ç€æ™®é€šæˆ¿å¡å´èƒ½æ‰“å¼€VIPæˆ¿é—´çš„é—¨

**BOLAï¼ˆå¤±æ•ˆçš„å¯¹è±¡çº§æˆæƒï¼‰**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
ç”¨æˆ·A è¯·æ±‚ â†’ /api/user/123/profile â†’ è¿”å›ç”¨æˆ·Açš„ä¿¡æ¯ âœ…

è¶Šæƒæ”»å‡»ï¼š
ç”¨æˆ·A è¯·æ±‚ â†’ /api/user/456/profile â†’ è¿”å›ç”¨æˆ·Bçš„ä¿¡æ¯ âŒ
```

**BFLAï¼ˆå¤±æ•ˆçš„åŠŸèƒ½çº§æˆæƒï¼‰**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
æ™®é€šç”¨æˆ· â†’ /api/user/update â†’ æ›´æ–°è‡ªå·±ä¿¡æ¯ âœ…

è¶Šæƒæ”»å‡»ï¼š
æ™®é€šç”¨æˆ· â†’ /api/admin/delete â†’ æ‰§è¡Œç®¡ç†å‘˜æ“ä½œ âŒ
```

### 2.2 è¶Šæƒæ”»å‡»çš„å¸¸è§åœºæ™¯


**ğŸ“‹ å¯¹è±¡çº§è¶Šæƒç¤ºä¾‹**ï¼š
```bash
# æ”»å‡»è€…å°è¯•è®¿é—®å…¶ä»–ç”¨æˆ·çš„è®¢å•
GET /api/orders/12345
Authorization: Bearer user_token

# æ”»å‡»è€…éå†å…¶ä»–ç”¨æˆ·ID
GET /api/users/1/documents
GET /api/users/2/documents  
GET /api/users/3/documents
```

**âš¡ åŠŸèƒ½çº§è¶Šæƒç¤ºä¾‹**ï¼š
```bash
# æ™®é€šç”¨æˆ·å°è¯•ç®¡ç†å‘˜åŠŸèƒ½
POST /api/admin/users
DELETE /api/system/config
PUT /api/roles/permissions
```

### 2.3 è¶Šæƒæ”»å‡»é˜²æŠ¤ç­–ç•¥


**ğŸ›¡ï¸ æ ¸å¿ƒé˜²æŠ¤åŸåˆ™**ï¼š

```
é˜²æŠ¤å±‚æ¬¡å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç”¨æˆ·èº«ä»½éªŒè¯å±‚         â”‚ â† ç¡®è®¤"ä½ æ˜¯è°"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æƒé™æˆæƒæ£€æŸ¥å±‚         â”‚ â† ç¡®è®¤"ä½ èƒ½åšä»€ä¹ˆ"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚    èµ„æºå½’å±éªŒè¯å±‚         â”‚ â† ç¡®è®¤"è¿™æ˜¯ä½ çš„å—"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ“ä½œåˆæ³•æ€§æ£€æŸ¥å±‚       â”‚ â† ç¡®è®¤"è¿™æ ·åšå¯¹å—"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç”¨é˜²æŠ¤æªæ–½**ï¼š

```python
# èµ„æºå½’å±æ£€æŸ¥ç¤ºä¾‹
def get_user_order(user_id, order_id):
    # 1. éªŒè¯ç”¨æˆ·èº«ä»½
    if not verify_user_token(user_id):
        return "èº«ä»½éªŒè¯å¤±è´¥"
    
    # 2. æ£€æŸ¥è®¢å•å½’å±
    order = get_order(order_id)
    if order.user_id != user_id:
        return "æ— æƒè®¿é—®æ­¤è®¢å•"
    
    # 3. è¿”å›æ•°æ®
    return order

# åŠŸèƒ½æƒé™æ£€æŸ¥ç¤ºä¾‹  
def delete_user(operator_id, target_user_id):
    # 1. æ£€æŸ¥æ“ä½œè€…æƒé™
    if not has_admin_role(operator_id):
        return "æƒé™ä¸è¶³"
    
    # 2. æ£€æŸ¥æ“ä½œåˆæ³•æ€§
    if target_user_id == operator_id:
        return "ä¸èƒ½åˆ é™¤è‡ªå·±"
        
    # 3. æ‰§è¡Œæ“ä½œ
    return delete_user_account(target_user_id)
```

---

## 3. ğŸ§ª å‚æ•°æ±¡æŸ“ä¸è´¨é‡æ£€æµ‹ç»•è¿‡


### 3.1 ä»€ä¹ˆæ˜¯å‚æ•°æ±¡æŸ“


**å½¢è±¡æ¯”å–»**ï¼šå°±åƒåœ¨ç‚¹é¤æ—¶æ•…æ„è¯´æ··ä¹±çš„è¯ï¼Œè®©æœåŠ¡å‘˜æé”™è®¢å•

**å‚æ•°æ±¡æŸ“åŸç†**ï¼š
```
æ­£å¸¸è¯·æ±‚ï¼š
POST /api/transfer
amount=100&to_account=12345

æ±¡æŸ“æ”»å‡»ï¼š
POST /api/transfer  
amount=100&amount=999999&to_account=12345
```

**æœåŠ¡å™¨å¤„ç†æ··ä¹±**ï¼š
- æœ‰çš„æœåŠ¡å™¨å–ç¬¬ä¸€ä¸ªå€¼ï¼šamount=100
- æœ‰çš„æœåŠ¡å™¨å–æœ€åå€¼ï¼šamount=999999  
- æœ‰çš„æœåŠ¡å™¨åˆå¹¶å€¼ï¼šamount=100999999

### 3.2 è´¨é‡æ£€æµ‹ç»•è¿‡æŠ€å·§


**ğŸ­ å¸¸è§ç»•è¿‡æ‰‹æ³•**ï¼š

```bash
# 1. ç¼–ç ç»•è¿‡
åŸå§‹æ”»å‡»: <script>alert(1)</script>
URLç¼–ç :  %3Cscript%3Ealert(1)%3C/script%3E
åŒé‡ç¼–ç : %253Cscript%253E

# 2. å¤§å°å†™ç»•è¿‡
åŸå§‹: DELETE /api/users
ç»•è¿‡: delete /api/users
æ··åˆ: DeLeTe /api/users

# 3. å‚æ•°åå˜å½¢
åŸå§‹: admin=true
ç»•è¿‡: Admin=true, ADMIN=true, admin[]=true
```

**ğŸ” æ£€æµ‹é€»è¾‘ç»•è¿‡ç¤ºä¾‹**ï¼š
```python
# è„†å¼±çš„æ£€æµ‹ä»£ç 
def check_sql_injection(input_str):
    dangerous_words = ['select', 'union', 'drop']
    for word in dangerous_words:
        if word in input_str.lower():
            return False
    return True

# ç»•è¿‡æ–¹æ³•
bypass_payload = "SeLeCt * from users"  # å¤§å°å†™æ··åˆ
bypass_payload = "sel/**/ect * from users"  # æ³¨é‡Šåˆ†å‰²
bypass_payload = "se'+'lect * from users"  # å­—ç¬¦ä¸²æ‹¼æ¥
```

### 3.3 å‚æ•°æ±¡æŸ“é˜²æŠ¤æ–¹æ¡ˆ


**ğŸ›¡ï¸ æ ‡å‡†åŒ–å¤„ç†æµç¨‹**ï¼š

```
è¯·æ±‚å‚æ•°å¤„ç†ç®¡é“ï¼š
åŸå§‹è¯·æ±‚ â†’ å‚æ•°è§£æ â†’ é‡å¤æ£€æŸ¥ â†’ æ ¼å¼éªŒè¯ â†’ ä¸šåŠ¡å¤„ç†
    â†“         â†“         â†“         â†“         â†“
  GET/POST   æ•°ç»„åŒ–    å»é‡å¤„ç†   ç±»å‹æ£€æŸ¥   é€»è¾‘æ‰§è¡Œ
```

**å®ç”¨é˜²æŠ¤ä»£ç **ï¼š
```python
def sanitize_parameters(request_params):
    cleaned_params = {}
    
    for key, values in request_params.items():
        # 1. æ£€æŸ¥é‡å¤å‚æ•°
        if isinstance(values, list):
            if len(values) > 1:
                log_warning(f"å‘ç°é‡å¤å‚æ•°: {key}")
                return None
            value = values[0]
        else:
            value = values
            
        # 2. å‚æ•°åè§„èŒƒåŒ–
        clean_key = key.lower().strip()
        
        # 3. å€¼çš„æ¸…ç†å’ŒéªŒè¯
        clean_value = html.escape(value.strip())
        
        cleaned_params[clean_key] = clean_value
    
    return cleaned_params
```

---

## 4. ğŸ”‘ æ¥å£é‰´æƒä¸ç­¾åæœºåˆ¶


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦APIé‰´æƒ


**ç”Ÿæ´»ç±»æ¯”**ï¼šAPIé‰´æƒå°±åƒé“¶è¡Œçš„å¯†ç +Uç›¾åŒé‡éªŒè¯

```
ä¼ ç»Ÿç™»å½•ï¼š                  APIé‰´æƒï¼š
è¾“å…¥ç”¨æˆ·åå¯†ç                ä¼ é€’è®¿é—®ä»¤ç‰Œ
    â†“                         â†“  
æµè§ˆå™¨è®°ä½ç™»å½•çŠ¶æ€           æ¯æ¬¡è¯·æ±‚éƒ½éªŒè¯èº«ä»½
    â†“                         â†“
ä¸€æ¬¡ç™»å½•å¤šæ¬¡ä½¿ç”¨             æ— çŠ¶æ€ç‹¬ç«‹éªŒè¯
```

### 4.2 å¸¸ç”¨é‰´æƒæœºåˆ¶å¯¹æ¯”


| é‰´æƒæ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **å®‰å…¨çº§åˆ«** | **å®ç°å¤æ‚åº¦** | **æ€§èƒ½å½±å“** |
|---------|-------------|-------------|---------------|-------------|
| ğŸ” **API Key** | `å†…éƒ¨ç³»ç»Ÿè°ƒç”¨` | â­â­ | ğŸŸ¢ ç®€å• | ğŸŸ¢ å¾ˆä½ |
| ğŸ« **JWT Token** | `å‰åç«¯åˆ†ç¦»` | â­â­â­ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¡ ä¸­ç­‰ |
| âœï¸ **æ•°å­—ç­¾å** | `é‡‘èæ”¯ä»˜æ¥å£` | â­â­â­â­â­ | ğŸ”´ å¤æ‚ | ğŸ”´ è¾ƒé«˜ |
| ğŸ”„ **OAuth 2.0** | `ç¬¬ä¸‰æ–¹æˆæƒ` | â­â­â­â­ | ğŸ”´ å¤æ‚ | ğŸŸ¡ ä¸­ç­‰ |

### 4.3 æ•°å­—ç­¾åæœºåˆ¶è¯¦è§£


**ç­¾ååŸç†å›¾ç¤º**ï¼š
```
å®¢æˆ·ç«¯ç­¾åè¿‡ç¨‹ï¼š                    æœåŠ¡ç«¯éªŒè¯è¿‡ç¨‹ï¼š
è¯·æ±‚å‚æ•° + å¯†é’¥ â†’ ç”Ÿæˆç­¾å â†’ å‘é€è¯·æ±‚ â†’ æ¥æ”¶è¯·æ±‚ â†’ ç”¨ç›¸åŒæ–¹å¼è®¡ç®— â†’ å¯¹æ¯”ç­¾å
    â†“              â†“                              â†“           â†“
timestamp=123   sign=abc123         æ”¶åˆ°sign=abc123    è®¡ç®—å¾—åˆ°abc123 â†’ âœ…éªŒè¯é€šè¿‡
amount=100      
```

**å®ç”¨ç­¾åå®ç°**ï¼š
```python
import hashlib
import hmac
import time

def generate_signature(params, secret_key):
    """ç”ŸæˆAPIç­¾å"""
    # 1. å‚æ•°æ’åºï¼ˆä¿è¯ä¸€è‡´æ€§ï¼‰
    sorted_params = sorted(params.items())
    
    # 2. æ„å»ºç­¾åå­—ç¬¦ä¸²
    sign_string = ""
    for key, value in sorted_params:
        sign_string += f"{key}={value}&"
    
    # 3. æ·»åŠ æ—¶é—´æˆ³é˜²é‡æ”¾
    timestamp = int(time.time())
    sign_string += f"timestamp={timestamp}&"
    
    # 4. æ·»åŠ å¯†é’¥
    sign_string += f"key={secret_key}"
    
    # 5. ç”Ÿæˆç­¾å
    signature = hmac.new(
        secret_key.encode(), 
        sign_string.encode(), 
        hashlib.sha256
    ).hexdigest()
    
    return signature, timestamp

# ä½¿ç”¨ç¤ºä¾‹
params = {"amount": "100", "to_account": "12345"}
secret = "my_secret_key"
sign, ts = generate_signature(params, secret)

print(f"ç­¾å: {sign}")
print(f"æ—¶é—´æˆ³: {ts}")
```

---

## 5. ğŸš¦ APIé™æµä¸ç†”æ–­ä¿æŠ¤


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦é™æµ


**ç”Ÿæ´»æ¯”å–»**ï¼šé™æµå°±åƒé«˜é€Ÿè·¯çš„æ”¶è´¹ç«™ï¼Œæ§åˆ¶è½¦æµé˜²æ­¢æ‹¥å µ

```
æ— é™æµæƒ…å†µï¼š                    æœ‰é™æµæƒ…å†µï¼š
å¤§é‡è¯·æ±‚ â†’ æœåŠ¡å™¨ â†’ å´©æºƒ         å¤§é‡è¯·æ±‚ â†’ é™æµå™¨ â†’ éƒ¨åˆ†é€šè¿‡ â†’ æœåŠ¡å™¨æ­£å¸¸
    â†“                              â†“           â†“
å…¨éƒ¨ç”¨æˆ·æ— æ³•ä½¿ç”¨                   ä¼˜å…ˆä¿è¯æ­£å¸¸ç”¨æˆ·
```

### 5.2 å¸¸è§é™æµç®—æ³•


**ğŸª£ ä»¤ç‰Œæ¡¶ç®—æ³•**ï¼š
```
ä»¤ç‰Œæ¡¶å·¥ä½œåŸç†ï¼š
  å®šæ—¶æ”¾å…¥ä»¤ç‰Œ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è¯·æ±‚æ¥äº†æ‹¿ä»¤ç‰Œ
â”‚ ğŸª™ğŸª™ğŸª™ğŸª™ğŸª™   â”‚ â†â”€â”€ æœ‰ä»¤ç‰Œ â†’ é€šè¿‡
â”‚    ä»¤ç‰Œæ¡¶      â”‚     æ— ä»¤ç‰Œ â†’ æ‹’ç»  
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**â° æ»‘åŠ¨çª—å£ç®—æ³•**ï¼š
```
æ—¶é—´çª—å£ç¤ºæ„ï¼š
09:00-09:01  09:01-09:02  09:02-09:03
  100æ¬¡è¯·æ±‚   150æ¬¡è¯·æ±‚    80æ¬¡è¯·æ±‚
     â†“           â†“           â†“
   å…è®¸é€šè¿‡     è¶…å‡ºé™åˆ¶     å…è®¸é€šè¿‡
```

**å®ç”¨é™æµå®ç°**ï¼š
```python
import time
from collections import defaultdict

class RateLimiter:
    def __init__(self, max_requests=100, time_window=60):
        self.max_requests = max_requests  # æœ€å¤§è¯·æ±‚æ•°
        self.time_window = time_window    # æ—¶é—´çª—å£(ç§’)
        self.requests = defaultdict(list) # å­˜å‚¨è¯·æ±‚è®°å½•
    
    def is_allowed(self, user_id):
        now = time.time()
        
        # æ¸…ç†è¿‡æœŸè®°å½•
        user_requests = self.requests[user_id]
        while user_requests and user_requests[0] < now - self.time_window:
            user_requests.pop(0)
        
        # æ£€æŸ¥æ˜¯å¦è¶…é™
        if len(user_requests) >= self.max_requests:
            return False
        
        # è®°å½•æ–°è¯·æ±‚
        user_requests.append(now)
        return True

# ä½¿ç”¨ç¤ºä¾‹
limiter = RateLimiter(max_requests=10, time_window=60)

def api_endpoint(user_id):
    if not limiter.is_allowed(user_id):
        return {"error": "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"}
    
    # æ­£å¸¸ä¸šåŠ¡é€»è¾‘
    return {"success": "æ“ä½œæˆåŠŸ"}
```

### 5.3 ç†”æ–­æœºåˆ¶


**ğŸ”Œ ç†”æ–­å™¨å·¥ä½œåŸç†**ï¼š
```
æœåŠ¡çŠ¶æ€è½¬æ¢ï¼š
æ­£å¸¸çŠ¶æ€ â†’ é”™è¯¯ç‡ä¸Šå‡ â†’ åŠå¼€çŠ¶æ€ â†’ æµ‹è¯•é€šè¿‡ â†’ æ­£å¸¸çŠ¶æ€
   â†“           â†“           â†“          â†“
å…è®¸æ‰€æœ‰     ç›‘æ§é”™è¯¯     å°‘é‡è¯•æ¢    æ¢å¤æœåŠ¡
è¯·æ±‚é€šè¿‡     è¯·æ±‚æ•°é‡     è¯·æ±‚       
   â†“           â†“           â†“
æ­£å¸¸å“åº”     è¾¾åˆ°é˜ˆå€¼     å¦‚æœä»å¤±è´¥
           â†“           â†“
        ç†”æ–­å¼€å¯ â†â”€â”€ ç»§ç»­ç†”æ–­
```

**ç®€å•ç†”æ–­å®ç°**ï¼š
```python
class CircuitBreaker:
    def __init__(self, failure_threshold=5, timeout=60):
        self.failure_threshold = failure_threshold  # å¤±è´¥é˜ˆå€¼
        self.timeout = timeout                      # ç†”æ–­æ—¶é—´
        self.failure_count = 0                      # å¤±è´¥è®¡æ•°
        self.last_failure_time = 0                  # æœ€åå¤±è´¥æ—¶é—´
        self.state = "CLOSED"                       # ç†”æ–­å™¨çŠ¶æ€
    
    def call(self, func, *args, **kwargs):
        if self.state == "OPEN":
            # æ£€æŸ¥æ˜¯å¦å¯ä»¥å°è¯•æ¢å¤
            if time.time() - self.last_failure_time > self.timeout:
                self.state = "HALF_OPEN"
            else:
                raise Exception("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨")
        
        try:
            result = func(*args, **kwargs)
            # è°ƒç”¨æˆåŠŸï¼Œé‡ç½®è®¡æ•°
            if self.state == "HALF_OPEN":
                self.state = "CLOSED"
            self.failure_count = 0
            return result
            
        except Exception as e:
            # è°ƒç”¨å¤±è´¥ï¼Œå¢åŠ è®¡æ•°
            self.failure_count += 1
            self.last_failure_time = time.time()
            
            if self.failure_count >= self.failure_threshold:
                self.state = "OPEN"
            
            raise e
```

---

## 6. ğŸ“‹ æ¥å£ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†


**ç°å®é—®é¢˜**ï¼šå°±åƒæ‰‹æœºAPPæ›´æ–°ï¼Œæ–°ç‰ˆæœ¬ä¸èƒ½è®©è€ç‰ˆæœ¬å®Œå…¨ä¸èƒ½ç”¨

```
ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼š
è€å®¢æˆ·ç«¯(v1.0) â†’ è°ƒç”¨æ—§æ¥å£ â†’ æœåŠ¡å™¨åªæœ‰æ–°æ¥å£ â†’ è°ƒç”¨å¤±è´¥
æ–°å®¢æˆ·ç«¯(v2.0) â†’ è°ƒç”¨æ–°æ¥å£ â†’ æœåŠ¡å™¨æ­£å¸¸å“åº” â†’ è°ƒç”¨æˆåŠŸ
```

### 6.2 å¸¸è§ç‰ˆæœ¬ç®¡ç†ç­–ç•¥


**ğŸ”— URLè·¯å¾„ç‰ˆæœ¬**ï¼š
```bash
# ç‰ˆæœ¬åœ¨URLä¸­æ˜ç¡®æ ‡è¯†
GET /api/v1/users/123
GET /api/v2/users/123
GET /api/v3/users/123
```

**ğŸ“‹ è¯·æ±‚å¤´ç‰ˆæœ¬**ï¼š
```bash
# ç‰ˆæœ¬ä¿¡æ¯åœ¨HTTPå¤´ä¸­
GET /api/users/123
Accept: application/vnd.api+json;version=1
```

**âš™ï¸ å‚æ•°ç‰ˆæœ¬**ï¼š
```bash
# ç‰ˆæœ¬ä½œä¸ºæŸ¥è¯¢å‚æ•°
GET /api/users/123?version=v2
```

### 6.3 å…¼å®¹æ€§å¤„ç†ç­–ç•¥


**å‘åå…¼å®¹å¤„ç†**ï¼š
```python
def get_user_info(user_id, api_version="v1"):
    user = get_user_from_db(user_id)
    
    if api_version == "v1":
        # è€ç‰ˆæœ¬è¿”å›æ ¼å¼
        return {
            "id": user.id,
            "name": user.name,
            "email": user.email
        }
    elif api_version == "v2":
        # æ–°ç‰ˆæœ¬è¿”å›æ ¼å¼  
        return {
            "id": user.id,
            "profile": {
                "name": user.name,
                "email": user.email,
                "phone": user.phone,  # æ–°å¢å­—æ®µ
                "avatar": user.avatar # æ–°å¢å­—æ®µ
            },
            "metadata": {
                "created_at": user.created_at,
                "updated_at": user.updated_at
            }
        }
    else:
        # ä¸æ”¯æŒçš„ç‰ˆæœ¬
        return {"error": "ä¸æ”¯æŒçš„APIç‰ˆæœ¬"}
```

---

## 7. ğŸš« æ¥å£æœªæˆæƒè®¿é—®é˜²æŠ¤


### 7.1 æœªæˆæƒè®¿é—®çš„å¸¸è§å½¢å¼


**ğŸ” å…¸å‹æ”»å‡»åœºæ™¯**ï¼š
```
æ”»å‡»è·¯å¾„åˆ†æï¼š
å‘ç°APIæ¥å£ â†’ æµ‹è¯•è®¿é—®æƒé™ â†’ ç»•è¿‡éªŒè¯ â†’ éæ³•è®¿é—®æ•°æ®
    â†“             â†“            â†“           â†“
æ¥å£æ–‡æ¡£æ³„éœ²    ç¼ºå°‘é‰´æƒ        å¼±éªŒè¯      æ•æ„Ÿæ•°æ®æ³„éœ²
ç›®å½•éå†       é»˜è®¤é…ç½®        é€»è¾‘ç¼ºé™·    æƒé™æå‡
```

### 7.2 æ¥å£å‘ç°ä¸é˜²æŠ¤


**å¸¸è§æ¥å£æš´éœ²é€”å¾„**ï¼š
- ğŸ“„ **APIæ–‡æ¡£æ³„éœ²**ï¼šSwaggeræ–‡æ¡£æœªåŠ å¯†
- ğŸ” **ç›®å½•éå†**ï¼š/api/, /admin/, /debug/
- ğŸ“± **ç§»åŠ¨åº”ç”¨é€†å‘**ï¼šAPPä¸­ç¡¬ç¼–ç çš„æ¥å£åœ°å€
- ğŸŒ **å‰ç«¯ä»£ç æ³„éœ²**ï¼šJavaScriptä¸­çš„APIè°ƒç”¨

**é˜²æŠ¤ç­–ç•¥**ï¼š
```python
# æ¥å£è®¿é—®æ§åˆ¶è£…é¥°å™¨
def require_auth(roles=None):
    def decorator(func):
        def wrapper(*args, **kwargs):
            # 1. æ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®ä»¤ç‰Œ
            token = get_token_from_request()
            if not token:
                return {"error": "ç¼ºå°‘è®¿é—®ä»¤ç‰Œ"}, 401
            
            # 2. éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
            user = verify_token(token)
            if not user:
                return {"error": "æ— æ•ˆçš„è®¿é—®ä»¤ç‰Œ"}, 401
            
            # 3. æ£€æŸ¥è§’è‰²æƒé™
            if roles and user.role not in roles:
                return {"error": "æƒé™ä¸è¶³"}, 403
            
            # 4. æ‰§è¡ŒåŸå‡½æ•°
            return func(user, *args, **kwargs)
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@require_auth(roles=['admin', 'moderator'])
def delete_user(current_user, user_id):
    return delete_user_account(user_id)
```

---

## 8. ğŸ  èµ„æºéš”ç¦»ç­–ç•¥


### 8.1 ä»€ä¹ˆæ˜¯èµ„æºéš”ç¦»


**å½¢è±¡æ¯”å–»**ï¼šå°±åƒé“¶è¡Œçš„ä¿é™©ç®±ï¼Œæ¯ä¸ªå®¢æˆ·åªèƒ½æ‰“å¼€è‡ªå·±çš„ç®±å­

```
èµ„æºéš”ç¦»æ¨¡å‹ï¼š
ç§Ÿæˆ·Açš„æ•°æ® â† éš”ç¦»å¢™ â†’ ç§Ÿæˆ·Bçš„æ•°æ®
     â†“                      â†“  
åªèƒ½è®¿é—®A                åªèƒ½è®¿é—®B
ä¸èƒ½è®¿é—®B                ä¸èƒ½è®¿é—®A
```

### 8.2 å¤šå±‚éš”ç¦»ç­–ç•¥


**ğŸ—ï¸ éš”ç¦»å±‚æ¬¡ç»“æ„**ï¼š
```
åº”ç”¨å±‚éš”ç¦»ï¼šä¸åŒç”¨æˆ·çœ‹åˆ°ä¸åŒç•Œé¢
     â†“
ä¸šåŠ¡å±‚éš”ç¦»ï¼šä¸åŒæƒé™æ‰§è¡Œä¸åŒé€»è¾‘  
     â†“
æ•°æ®å±‚éš”ç¦»ï¼šä¸åŒæ•°æ®åº“æˆ–è¡¨åˆ†ç¦»
     â†“
ç½‘ç»œå±‚éš”ç¦»ï¼šä¸åŒç½‘ç»œæ®µç‰©ç†åˆ†ç¦»
```

**å®ç”¨éš”ç¦»å®ç°**ï¼š
```python
class TenantIsolation:
    def __init__(self, tenant_id):
        self.tenant_id = tenant_id
    
    def get_user_data(self, user_id):
        # ç¡®ä¿åªèƒ½è®¿é—®åŒç§Ÿæˆ·çš„æ•°æ®
        query = """
        SELECT * FROM users 
        WHERE id = %s AND tenant_id = %s
        """
        return db.execute(query, (user_id, self.tenant_id))
    
    def list_documents(self, user_id):
        # å¤šé‡éš”ç¦»æ£€æŸ¥
        query = """
        SELECT d.* FROM documents d
        JOIN users u ON d.owner_id = u.id
        WHERE u.id = %s 
        AND u.tenant_id = %s
        AND d.tenant_id = %s
        """
        return db.execute(query, (user_id, self.tenant_id, self.tenant_id))

# ä¸­é—´ä»¶è‡ªåŠ¨æ³¨å…¥ç§Ÿæˆ·ä¿¡æ¯
def tenant_middleware(request):
    tenant_id = extract_tenant_from_token(request.headers.get('Authorization'))
    request.tenant = TenantIsolation(tenant_id)
```

---

## 9. ğŸ‘¥ è§’è‰²æƒé™æ ¡éªŒæœºåˆ¶


### 9.1 RBACæƒé™æ¨¡å‹


**åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶**ï¼š
```
æƒé™åˆ†é…é“¾è·¯ï¼š
ç”¨æˆ· â†’ åˆ†é…è§’è‰² â†’ è§’è‰²æ‹¥æœ‰æƒé™ â†’ æƒé™æ§åˆ¶èµ„æº
 â†“        â†“          â†“           â†“
å¼ ä¸‰    é”€å”®å‘˜      æŸ¥çœ‹å®¢æˆ·     å®¢æˆ·æ•°æ®åº“
æå››    é”€å”®ç»ç†    ç®¡ç†å®¢æˆ·     å®¢æˆ·æ•°æ®åº“  
ç‹äº”    ç³»ç»Ÿç®¡ç†å‘˜  æ‰€æœ‰æƒé™     å…¨éƒ¨èµ„æº
```

### 9.2 æƒé™ç²’åº¦æ§åˆ¶


**ğŸ¯ æƒé™è®¾è®¡å±‚æ¬¡**ï¼š
```
åŠŸèƒ½æƒé™ï¼šèƒ½ä¸èƒ½åšï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
æ•°æ®æƒé™ï¼šèƒ½çœ‹ä»€ä¹ˆï¼ˆåªçœ‹è‡ªå·±çš„ï¼Œè¿˜æ˜¯çœ‹éƒ¨é—¨çš„ï¼‰
å­—æ®µæƒé™ï¼šèƒ½çœ‹å“ªäº›å­—æ®µï¼ˆæ™®é€šç”¨æˆ·çœ‹ä¸åˆ°è–ªèµ„ï¼‰
æ“ä½œæƒé™ï¼šä»€ä¹ˆæ—¶å€™èƒ½åšï¼ˆå·¥ä½œæ—¶é—´æ‰èƒ½æ“ä½œï¼‰
```

**å®ç”¨æƒé™æ£€æŸ¥**ï¼š
```python
class PermissionChecker:
    def __init__(self, user):
        self.user = user
        self.permissions = self.load_user_permissions(user)
    
    def can_access_resource(self, resource_type, resource_id, action):
        # 1. æ£€æŸ¥åŠŸèƒ½æƒé™
        if not self.has_permission(f"{resource_type}:{action}"):
            return False
        
        # 2. æ£€æŸ¥æ•°æ®æƒé™
        if not self.can_access_data(resource_type, resource_id):
            return False
        
        # 3. æ£€æŸ¥æ—¶é—´æƒé™
        if not self.is_operation_time_allowed():
            return False
        
        return True
    
    def has_permission(self, permission_key):
        return permission_key in self.permissions
    
    def can_access_data(self, resource_type, resource_id):
        if resource_type == "order":
            # æ™®é€šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„è®¢å•
            if self.user.role == "user":
                order = get_order(resource_id)
                return order.user_id == self.user.id
            # ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰è®¢å•
            elif self.user.role == "admin":
                return True
        return False

# APIä¸­ä½¿ç”¨æƒé™æ£€æŸ¥
def get_order_detail(user, order_id):
    checker = PermissionChecker(user)
    
    if not checker.can_access_resource("order", order_id, "read"):
        return {"error": "æƒé™ä¸è¶³"}, 403
    
    return get_order_data(order_id)
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 APIå®‰å…¨æ ¸å¿ƒåŸåˆ™


```
ğŸ” èº«ä»½è®¤è¯ï¼šç¡®è®¤"ä½ æ˜¯è°"
ğŸ›¡ï¸ æˆæƒæ§åˆ¶ï¼šç¡®è®¤"ä½ èƒ½åšä»€ä¹ˆ"  
ğŸ” è¾“å…¥éªŒè¯ï¼šç¡®è®¤"æ•°æ®åˆæ³•æ€§"
ğŸš¦ æµé‡æ§åˆ¶ï¼šç¡®è®¤"è®¿é—®é¢‘ç‡åˆç†"
ğŸ“Š ç›‘æ§å®¡è®¡ï¼šç¡®è®¤"æ“ä½œå¯è¿½æº¯"
```

### 10.2 å¸¸è§æ”»å‡»ä¸é˜²æŠ¤å¯¹ç…§


| æ”»å‡»ç±»å‹ | **æ”»å‡»æ‰‹æ³•** | **æ ¸å¿ƒé˜²æŠ¤** | **å®ç°è¦ç‚¹** |
|---------|-------------|-------------|-------------|
| ğŸ”“ **è¶Šæƒè®¿é—®** | `ä¿®æ”¹å‚æ•°è®¿é—®ä»–äººæ•°æ®` | `èµ„æºå½’å±éªŒè¯` | `æ¯æ¬¡éƒ½æ£€æŸ¥æ•°æ®å½’å±` |
| ğŸ§ª **å‚æ•°æ±¡æŸ“** | `é‡å¤å‚æ•°æ··æ·†é€»è¾‘` | `å‚æ•°æ ‡å‡†åŒ–` | `å»é‡+éªŒè¯+æ¸…ç†` |
| ğŸšª **æœªæˆæƒè®¿é—®** | `ç›´æ¥è°ƒç”¨å†…éƒ¨æ¥å£` | `ç»Ÿä¸€é‰´æƒä¸­é—´ä»¶` | `æ‰€æœ‰æ¥å£éƒ½è¦éªŒè¯` |
| ğŸŒŠ **æ´ªæ°´æ”»å‡»** | `å¤§é‡è¯·æ±‚å‹å®æœåŠ¡` | `é™æµç†”æ–­æœºåˆ¶` | `å¤šå±‚é™æµ+è‡ªåŠ¨æ¢å¤` |
| ğŸ” **æ¥å£æšä¸¾** | `éå†æ¥å£å‘ç°æ¼æ´` | `æ¥å£è®¿é—®æ§åˆ¶` | `éšè—+é‰´æƒ+ç›‘æ§` |

### 10.3 å®‰å…¨å¼€å‘æœ€ä½³å®è·µ


**ğŸ¯ å¼€å‘é˜¶æ®µ**ï¼š
- âœ… **è®¾è®¡å®‰å…¨**ï¼šAPIè®¾è®¡æ—¶å°±è€ƒè™‘å®‰å…¨æ€§
- âœ… **é»˜è®¤æ‹’ç»**ï¼šæ²¡æœ‰æ˜ç¡®æˆæƒçš„éƒ½æ‹’ç»è®¿é—®
- âœ… **æœ€å°æƒé™**ï¼šåªç»™å¿…è¦çš„æœ€å°æƒé™
- âœ… **æ·±åº¦é˜²å¾¡**ï¼šå¤šå±‚é˜²æŠ¤ä¸ä¾èµ–å•ç‚¹

**ğŸ”§ è¿ç»´é˜¶æ®µ**ï¼š  
- ğŸ“Š **å®æ—¶ç›‘æ§**ï¼šå¼‚å¸¸è®¿é—®æ¨¡å¼å‘Šè­¦
- ğŸ“ **æ“ä½œå®¡è®¡**ï¼šæ‰€æœ‰æ•æ„Ÿæ“ä½œè®°å½•æ—¥å¿—
- ğŸ”„ **å®šæœŸè¯„ä¼°**ï¼šå®šæœŸæ£€æŸ¥æƒé™é…ç½®åˆç†æ€§
- ğŸš¨ **åº”æ€¥å“åº”**ï¼šå‘ç°æ”»å‡»æ—¶çš„å¿«é€Ÿå¤„ç½®æµç¨‹

**ğŸ’¡ è®°å¿†è¦ç‚¹**ï¼š
- APIå®‰å…¨çš„æ ¸å¿ƒæ˜¯"éªŒè¯ä¸€åˆ‡ï¼Œä¿¡ä»»æ— äºº"
- è¶Šæƒæ”»å‡»é˜²æŠ¤é‡ç‚¹æ˜¯"æ•°æ®å½’å±+åŠŸèƒ½æƒé™"åŒé‡æ£€æŸ¥
- å‚æ•°æ±¡æŸ“é˜²æŠ¤å…³é”®æ˜¯æ ‡å‡†åŒ–å¤„ç†å’Œä¸¥æ ¼éªŒè¯
- é™æµç†”æ–­æ˜¯ä¿æŠ¤æœåŠ¡å¯ç”¨æ€§çš„é‡è¦æ‰‹æ®µ
- æƒé™æ§åˆ¶è¦åšåˆ°åŠŸèƒ½æƒé™+æ•°æ®æƒé™å…¨è¦†ç›–

**ğŸ”¥ å®æˆ˜å»ºè®®**ï¼š
1. **ä»æ”»å‡»è€…è§’åº¦æ€è€ƒ**ï¼šå‡è®¾è‡ªå·±æ˜¯æ”»å‡»è€…ä¼šæ€ä¹ˆæ”»å‡»
2. **å»ºç«‹å®‰å…¨æ£€æŸ¥æ¸…å•**ï¼šæ¯ä¸ªAPIä¸Šçº¿å‰éƒ½è¦è¿‡å®‰å…¨æ£€æŸ¥
3. **é‡è§†æ—¥å¿—ç›‘æ§**ï¼šå¼‚å¸¸æ¨¡å¼å¾€å¾€æ˜¯æ”»å‡»çš„å‰å…†
4. **å®šæœŸå®‰å…¨æµ‹è¯•**ï¼šç”¨è‡ªåŠ¨åŒ–å·¥å…·å®šæœŸæ‰«æAPIå®‰å…¨æ¼æ´