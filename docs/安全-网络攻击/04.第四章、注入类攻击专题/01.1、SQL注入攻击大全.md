---
title: 1ã€SQLæ³¨å…¥æ”»å‡»å¤§å…¨
---
## ğŸ“š ç›®å½•

1. [SQLæ³¨å…¥åŸºç¡€æ¦‚å¿µ](#1-SQLæ³¨å…¥åŸºç¡€æ¦‚å¿µ)
2. [SQLæ³¨å…¥åŸç†æ·±åº¦è§£æ](#2-SQLæ³¨å…¥åŸç†æ·±åº¦è§£æ)
3. [ä¸»æµSQLæ³¨å…¥æ”»å‡»ç±»å‹](#3-ä¸»æµSQLæ³¨å…¥æ”»å‡»ç±»å‹)
4. [NoSQLæ³¨å…¥æ”»å‡»è¯¦è§£](#4-NoSQLæ³¨å…¥æ”»å‡»è¯¦è§£)
5. [SQLæ³¨å…¥é˜²æŠ¤æ ¸å¿ƒæŠ€æœ¯](#5-SQLæ³¨å…¥é˜²æŠ¤æ ¸å¿ƒæŠ€æœ¯)
6. [æ•°æ®åº“å®‰å…¨é…ç½®å®è·µ](#6-æ•°æ®åº“å®‰å…¨é…ç½®å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ SQLæ³¨å…¥åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SQLæ³¨å…¥

**ç®€å•ç†è§£**ï¼šSQLæ³¨å…¥å°±åƒæ˜¯é’»äº†ç¨‹åºçš„"ç©ºå­"ï¼Œè®©æ¶æ„çš„SQLä»£ç æ··è¿›äº†æ­£å¸¸çš„æŸ¥è¯¢ä¸­ã€‚

```
æ­£å¸¸æƒ…å†µï¼š
ç”¨æˆ·è¾“å…¥ï¼šadmin
SQLè¯­å¥ï¼šSELECT * FROM users WHERE username = 'admin'

SQLæ³¨å…¥ï¼š
ç”¨æˆ·è¾“å…¥ï¼šadmin' OR '1'='1
SQLè¯­å¥ï¼šSELECT * FROM users WHERE username = 'admin' OR '1'='1'
ç»“æœï¼šç»•è¿‡äº†ç”¨æˆ·åéªŒè¯ï¼
```

**æ ¸å¿ƒé—®é¢˜**ï¼šç¨‹åºç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥åˆ°SQLè¯­å¥ä¸­ï¼Œæ²¡æœ‰è¿‡æ»¤å’Œæ£€æŸ¥ã€‚

### 1.2 SQLæ³¨å…¥çš„çœŸå®å±å®³


**ğŸ”¸ æ•°æ®æ³„éœ²é£é™©**
```
æ”»å‡»è€…å¯ä»¥ï¼š
â€¢ è·å–æ‰€æœ‰ç”¨æˆ·è´¦å·å¯†ç 
â€¢ ä¸‹è½½æ•´ä¸ªæ•°æ®åº“å†…å®¹
â€¢ æŸ¥çœ‹å•†ä¸šæœºå¯†æ•°æ®
â€¢ è·å–å®¢æˆ·ä¸ªäººä¿¡æ¯

çœŸå®æ¡ˆä¾‹ï¼šæŸè´­ç‰©ç½‘ç«™å› SQLæ³¨å…¥æ³„éœ²500ä¸‡ç”¨æˆ·ä¿¡æ¯
```

**ğŸ”¸ æ•°æ®ç ´åé£é™©**
```
æ›´ä¸¥é‡çš„æ˜¯ï¼š
â€¢ åˆ é™¤æ•´ä¸ªæ•°æ®åº“
â€¢ ä¿®æ”¹å…³é”®ä¸šåŠ¡æ•°æ®
â€¢ æ’å…¥æ¶æ„æ•°æ®
â€¢ ç ´åæ•°æ®å®Œæ•´æ€§

æƒ³è±¡ä¸€ä¸‹ï¼šé“¶è¡Œè´¦æˆ·ä½™é¢è¢«æ¶æ„ä¿®æ”¹...
```

### 1.3 SQLæ³¨å…¥å½¢æˆçš„æ ¹æœ¬åŸå› 


**é—®é¢˜ä»£ç ç¤ºä¾‹**ï¼š
```java
// âŒ å±é™©çš„ä»£ç  - ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥
String username = request.getParameter("username");
String sql = "SELECT * FROM users WHERE username = '" + username + "'";
Statement stmt = connection.createStatement();
ResultSet rs = stmt.executeQuery(sql);
```

**ä¸ºä»€ä¹ˆè¿™æ ·å±é™©ï¼Ÿ**
```
ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¢«å½“ä½œSQLä»£ç æ‰§è¡Œäº†ï¼

ç”¨æˆ·è¾“å…¥ï¼šadmin'; DROP TABLE users; --
æœ€ç»ˆSQLï¼šSELECT * FROM users WHERE username = 'admin'; DROP TABLE users; --'

ç»“æœï¼šç”¨æˆ·è¡¨è¢«åˆ é™¤äº†ï¼
```

---

## 2. ğŸ” SQLæ³¨å…¥åŸç†æ·±åº¦è§£æ


### 2.1 SQLæ³¨å…¥çš„æ‰§è¡Œæµç¨‹


**æ”»å‡»è¿‡ç¨‹å›¾ç¤º**ï¼š
```
æ”»å‡»è€… â†’ Webåº”ç”¨ â†’ æ•°æ®åº“
   â†“        â†“        â†“
[æ¶æ„è¾“å…¥] [æ‹¼æ¥SQL] [æ‰§è¡ŒæŸ¥è¯¢]
   â†“        â†“        â†“
[ç»•è¿‡éªŒè¯] [è¿”å›æ•°æ®] [è·å–ä¿¡æ¯]
```

**è¯¦ç»†æ‰§è¡Œæ­¥éª¤**ï¼š
1. **å‘ç°æ³¨å…¥ç‚¹**ï¼šå¯»æ‰¾æ¥å—ç”¨æˆ·è¾“å…¥çš„åœ°æ–¹
2. **æµ‹è¯•æ³¨å…¥**ï¼šå°è¯•æ’å…¥ç‰¹æ®Šå­—ç¬¦
3. **æ„é€ è¯­å¥**ï¼šè®¾è®¡æ¶æ„SQLä»£ç 
4. **æ‰§è¡Œæ”»å‡»**ï¼šæäº¤æ¶æ„è¾“å…¥
5. **è·å–ç»“æœ**ï¼šæ”¶é›†è¿”å›çš„æ•æ„Ÿä¿¡æ¯

### 2.2 å¸¸è§çš„æ³¨å…¥ç‚¹ä½ç½®


**ğŸ”¸ ç”¨æˆ·ç™»å½•é¡µé¢**
```php
// ç™»å½•éªŒè¯ - æœ€å¸¸è§çš„æ³¨å…¥ç‚¹
$username = $_POST['username'];
$password = $_POST['password'];
$sql = "SELECT * FROM users WHERE username='$username' AND password='$password'";
```

**ğŸ”¸ æœç´¢åŠŸèƒ½**
```java
// å•†å“æœç´¢
String keyword = request.getParameter("keyword");
String sql = "SELECT * FROM products WHERE name LIKE '%" + keyword + "%'";
```

**ğŸ”¸ æ•°æ®æŸ¥çœ‹é¡µé¢**
```sql
-- ç”¨æˆ·è¯¦æƒ…é¡µé¢
SELECT * FROM user_info WHERE user_id = [ç”¨æˆ·è¾“å…¥çš„ID]
```

### 2.3 SQLæ³¨å…¥æ£€æµ‹æ–¹æ³•


**æ‰‹å·¥æ£€æµ‹æŠ€å·§**ï¼š
```
1. å•å¼•å·æµ‹è¯•ï¼šåœ¨è¾“å…¥æ¡†è¾“å…¥ '
   - å¦‚æœå‡ºç°SQLé”™è¯¯ï¼Œè¯´æ˜å¯èƒ½å­˜åœ¨æ³¨å…¥

2. é€»è¾‘æµ‹è¯•ï¼šè¾“å…¥ 1' OR '1'='1
   - å¦‚æœç™»å½•æˆåŠŸï¼Œè¯´æ˜é€»è¾‘è¢«ç»•è¿‡

3. æ³¨é‡Šæµ‹è¯•ï¼šè¾“å…¥ admin'--
   - å¦‚æœèƒ½ç™»å½•ï¼Œè¯´æ˜åé¢çš„å¯†ç éªŒè¯è¢«æ³¨é‡Šæ‰äº†
```

---

## 3. âš”ï¸ ä¸»æµSQLæ³¨å…¥æ”»å‡»ç±»å‹


### 3.1 Unionæ³¨å…¥æ”»å‡»


**åŸç†è¯´æ˜**ï¼šåˆ©ç”¨UNIONå…³é”®å­—åˆå¹¶æŸ¥è¯¢ç»“æœï¼Œè·å–å…¶ä»–è¡¨çš„æ•°æ®ã€‚

**æ”»å‡»æµç¨‹å›¾**ï¼š
```
æ­£å¸¸æŸ¥è¯¢    UNION    æ¶æ„æŸ¥è¯¢
    â†“         +         â†“
[å•†å“ä¿¡æ¯]  åˆå¹¶â†’   [ç”¨æˆ·å¯†ç ]
    â†“                   â†“
   ä¸€èµ·è¿”å›ç»™æ”»å‡»è€…
```

**å®æˆ˜ç¤ºä¾‹**ï¼š
```sql
-- åŸå§‹æŸ¥è¯¢
SELECT name, price FROM products WHERE id = 1

-- æ³¨å…¥æ”»å‡»
SELECT name, price FROM products WHERE id = 1 
UNION SELECT username, password FROM users

-- ç»“æœï¼šæ—¢æ˜¾ç¤ºå•†å“ä¿¡æ¯ï¼Œåˆæ³„éœ²äº†ç”¨æˆ·è´¦å¯†
```

**Unionæ³¨å…¥çš„å…³é”®æ¡ä»¶**ï¼š
- ä¸¤ä¸ªæŸ¥è¯¢çš„**åˆ—æ•°å¿…é¡»ç›¸åŒ**
- å¯¹åº”åˆ—çš„**æ•°æ®ç±»å‹è¦å…¼å®¹**

### 3.2 Booleanç›²æ³¨æ”»å‡»


**ä»€ä¹ˆæ˜¯ç›²æ³¨ï¼Ÿ**
é¡µé¢ä¸æ˜¾ç¤ºæ•°æ®åº“é”™è¯¯ä¿¡æ¯ï¼Œä½†ä¼šæ ¹æ®æŸ¥è¯¢ç»“æœæ˜¾ç¤ºä¸åŒå†…å®¹ã€‚

**æ”»å‡»åŸç†**ï¼š
```
é€šè¿‡æ„é€ True/FalseæŸ¥è¯¢ï¼Œæ ¹æ®é¡µé¢ååº”åˆ¤æ–­ä¿¡æ¯

TrueæŸ¥è¯¢ï¼šé¡µé¢æ­£å¸¸æ˜¾ç¤º
FalseæŸ¥è¯¢ï¼šé¡µé¢æ˜¾ç¤ºå¼‚å¸¸æˆ–ç©ºç™½

ä¸€ç‚¹ä¸€ç‚¹"çŒœ"å‡ºæ•°æ®åº“ä¿¡æ¯
```

**å®é™…æ”»å‡»è¿‡ç¨‹**ï¼š
```sql
-- çŒœæµ‹æ•°æ®åº“åé•¿åº¦
1' AND (SELECT LENGTH(DATABASE())) = 8 --

-- çŒœæµ‹æ•°æ®åº“åç¬¬ä¸€ä¸ªå­—ç¬¦
1' AND (SELECT SUBSTRING(DATABASE(),1,1)) = 't' --

-- çŒœæµ‹ç”¨æˆ·è¡¨æ˜¯å¦å­˜åœ¨
1' AND (SELECT COUNT(*) FROM users) > 0 --
```

**Booleanç›²æ³¨ç‰¹ç‚¹**ï¼š
- é€Ÿåº¦æ…¢ï¼Œéœ€è¦é€å­—ç¬¦çŒœæµ‹
- éšè”½æ€§å¼ºï¼Œæ—¥å¿—ä¸­ä¸æ˜æ˜¾
- é€‚ç”¨äºå¤§å¤šæ•°SQLæ³¨å…¥åœºæ™¯

### 3.3 Time-basedç›²æ³¨æ”»å‡»


**æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡å»¶æ—¶å‡½æ•°ï¼Œæ ¹æ®å“åº”æ—¶é—´åˆ¤æ–­æŸ¥è¯¢ç»“æœã€‚

**å»¶æ—¶å‡½æ•°å¯¹æ¯”**ï¼š
| æ•°æ®åº“ | å»¶æ—¶å‡½æ•° | ç¤ºä¾‹ |
|--------|----------|------|
| **MySQL** | `SLEEP()` | `SELECT SLEEP(5)` |
| **SQL Server** | `WAITFOR` | `WAITFOR DELAY '00:00:05'` |
| **PostgreSQL** | `pg_sleep()` | `SELECT pg_sleep(5)` |
| **Oracle** | `DBMS_LOCK` | `DBMS_LOCK.sleep(5)` |

**æ”»å‡»ç¤ºä¾‹**ï¼š
```sql
-- å¦‚æœæ•°æ®åº“åæ˜¯'testdb'ï¼Œåˆ™å»¶æ—¶5ç§’
1' AND IF((SELECT DATABASE())='testdb', SLEEP(5), 0) --

-- å¦‚æœç®¡ç†å‘˜ç”¨æˆ·å­˜åœ¨ï¼Œåˆ™å»¶æ—¶5ç§’  
1' AND IF((SELECT COUNT(*) FROM users WHERE role='admin')>0, SLEEP(5), 0) --
```

**æ—¶é—´ç›²æ³¨çš„ä¼˜åŠ¿**ï¼š
- ä¸ä¾èµ–é¡µé¢å†…å®¹å˜åŒ–
- å³ä½¿åœ¨å®Œå…¨é»‘ç›’æƒ…å†µä¸‹ä¹Ÿèƒ½ä½¿ç”¨
- å¯ä»¥ç»•è¿‡å¤§éƒ¨åˆ†WAF

### 3.4 Error-basedæ³¨å…¥æ”»å‡»


**åŸç†**ï¼šæ•…æ„è§¦å‘æ•°æ®åº“é”™è¯¯ï¼Œä»é”™è¯¯ä¿¡æ¯ä¸­è·å–æ•æ„Ÿæ•°æ®ã€‚

**å¸¸ç”¨é”™è¯¯å‡½æ•°**ï¼š
```sql
-- MySQLä¸­çš„extractvalueå‡½æ•°
SELECT extractvalue(1, concat(0x7e, (SELECT DATABASE()), 0x7e))

-- ä¼šäº§ç”Ÿé”™è¯¯ï¼šXPATH syntax error: '~testdb~'
-- ä»è€Œæ³„éœ²æ•°æ®åº“å
```

**å®é™…æ”»å‡»æ¡ˆä¾‹**ï¼š
```sql
-- è·å–æ•°æ®åº“ç‰ˆæœ¬
1' AND extractvalue(1, concat(0x7e, version(), 0x7e)) --

-- è·å–å½“å‰ç”¨æˆ·
1' AND extractvalue(1, concat(0x7e, user(), 0x7e)) --

-- è·å–è¡¨å
1' AND extractvalue(1, concat(0x7e, (SELECT table_name FROM information_schema.tables LIMIT 1), 0x7e)) --
```

**Error-basedæ³¨å…¥ä¼˜ç‚¹**ï¼š
- æ•ˆç‡é«˜ï¼Œä¸€æ¬¡æŸ¥è¯¢è·å–å¤§é‡ä¿¡æ¯
- ä¸éœ€è¦çŒœæµ‹ï¼Œç›´æ¥æ˜¾ç¤ºç»“æœ
- ç»•è¿‡äº†ä¼ ç»Ÿçš„è¿‡æ»¤æœºåˆ¶

---

## 4. ğŸ—„ï¸ NoSQLæ³¨å…¥æ”»å‡»è¯¦è§£


### 4.1 NoSQLæ³¨å…¥ä¸ä¼ ç»ŸSQLæ³¨å…¥çš„åŒºåˆ«


**ä¼ ç»ŸSQLæ³¨å…¥**ï¼š
```sql
-- é’ˆå¯¹å…³ç³»å‹æ•°æ®åº“
SELECT * FROM users WHERE username = 'admin' OR '1'='1'
```

**NoSQLæ³¨å…¥**ï¼š
```javascript
// é’ˆå¯¹MongoDBç­‰æ–‡æ¡£æ•°æ®åº“
db.users.find({username: admin, password: {$ne: null}})
```

**å…³é”®å·®å¼‚**ï¼š
- NoSQLä½¿ç”¨**æ–‡æ¡£æŸ¥è¯¢è¯­æ³•**è€ŒéSQLè¯­å¥
- æ³¨å…¥ç‚¹åœ¨**JSONå¯¹è±¡**æˆ–**æŸ¥è¯¢æ“ä½œç¬¦**ä¸­
- éœ€è¦äº†è§£ä¸åŒNoSQLæ•°æ®åº“çš„**ç‰¹å®šè¯­æ³•**

### 4.2 MongoDBæ³¨å…¥æ”»å‡»è¯¦è§£


**MongoDBæŸ¥è¯¢æ³¨å…¥**ï¼š
```javascript
// æ­£å¸¸æŸ¥è¯¢
db.users.find({username: "admin", password: "123456"})

// æ³¨å…¥æ”»å‡» - ç»•è¿‡å¯†ç éªŒè¯
db.users.find({username: "admin", password: {$ne: ""}})
// $neè¡¨ç¤º"ä¸ç­‰äº"ï¼Œå¯†ç ä¸ç­‰äºç©ºå­—ç¬¦ä¸²ï¼ŒåŸºæœ¬æ‰€æœ‰å¯†ç éƒ½æ»¡è¶³
```

**Webåº”ç”¨ä¸­çš„MongoDBæ³¨å…¥**ï¼š
```javascript
// å±é™©çš„ä»£ç 
app.post('/login', (req, res) => {
    const username = req.body.username;
    const password = req.body.password;
    
    // ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥æ„é€ æŸ¥è¯¢
    db.users.findOne({
        username: username,
        password: password
    }, callback);
});
```

**æ”»å‡»è½½è·ç¤ºä¾‹**ï¼š
```json
POST /login
{
    "username": "admin",
    "password": {"$ne": null}
}
```

### 4.3 Redisæ³¨å…¥æ”»å‡»


**Redisæ³¨å…¥åœºæ™¯**ï¼š
```python
# å±é™©çš„Redisæ“ä½œ
user_input = request.get('key')
redis_client.get(f"user:{user_input}")

# å¦‚æœç”¨æˆ·è¾“å…¥åŒ…å«Rediså‘½ä»¤...
# è¾“å…¥ï¼štest; FLUSHALL
# ç»“æœï¼šæ¸…ç©ºæ•´ä¸ªRedisæ•°æ®åº“ï¼
```

**Redisæ³¨å…¥é˜²æŠ¤**ï¼š
```python
# âœ… å®‰å…¨çš„åšæ³•
import redis
import re

def safe_redis_get(key):
    # éªŒè¯è¾“å…¥æ ¼å¼
    if not re.match(r'^[a-zA-Z0-9_-]+$', key):
        raise ValueError("Invalid key format")
    
    return redis_client.get(f"user:{key}")
```

### 4.4 NoSQLæ³¨å…¥é˜²æŠ¤ç­–ç•¥


**è¾“å…¥éªŒè¯ä¸è¿‡æ»¤**ï¼š
```javascript
// MongoDBå®‰å…¨æŸ¥è¯¢
const safeFind = (username, password) => {
    // ç¡®ä¿è¾“å…¥æ˜¯å­—ç¬¦ä¸²ç±»å‹
    if (typeof username !== 'string' || typeof password !== 'string') {
        throw new Error('Invalid input type');
    }
    
    return db.users.findOne({
        username: username,
        password: password
    });
};
```

**ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢**ï¼š
```javascript
// ä½¿ç”¨MongoDBé©±åŠ¨çš„å®‰å…¨æ–¹æ³•
const user = await collection.findOne({
    username: {$eq: req.body.username},
    password: {$eq: req.body.password}
});
```

---

## 5. ğŸ›¡ï¸ SQLæ³¨å…¥é˜²æŠ¤æ ¸å¿ƒæŠ€æœ¯


### 5.1 é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰é˜²æŠ¤


**é¢„ç¼–è¯‘çš„å·¥ä½œåŸç†**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼šSQL + æ•°æ® â†’ è§£ææ‰§è¡Œ
é¢„ç¼–è¯‘ï¼šSQLæ¨¡æ¿ â†’ é¢„ç¼–è¯‘ â†’ å¡«å…¥æ•°æ® â†’ æ‰§è¡Œ

å…³é”®ï¼šæ•°æ®å’Œä»£ç å®Œå…¨åˆ†ç¦»ï¼
```

**Javaé¢„ç¼–è¯‘ç¤ºä¾‹**ï¼š
```java
// âœ… å®‰å…¨çš„é¢„ç¼–è¯‘è¯­å¥
String sql = "SELECT * FROM users WHERE username = ? AND password = ?";
PreparedStatement pstmt = connection.prepareStatement(sql);

// è®¾ç½®å‚æ•° - è¿™é‡Œçš„æ•°æ®ä¸ä¼šè¢«å½“ä½œSQLä»£ç 
pstmt.setString(1, username);  // ç¬¬1ä¸ª?å·ä½ç½®
pstmt.setString(2, password);  // ç¬¬2ä¸ª?å·ä½ç½®

ResultSet rs = pstmt.executeQuery();
```

**ä¸ºä»€ä¹ˆé¢„ç¼–è¯‘èƒ½é˜²æ³¨å…¥ï¼Ÿ**
```
å³ä½¿ç”¨æˆ·è¾“å…¥ï¼šadmin'; DROP TABLE users; --

é¢„ç¼–è¯‘ä¼šæŠŠæ•´ä¸ªå­—ç¬¦ä¸²å½“ä½œç”¨æˆ·åï¼š
username = "admin'; DROP TABLE users; --"

è€Œä¸æ˜¯å½“ä½œSQLä»£ç æ‰§è¡Œï¼
```

**PHPé¢„ç¼–è¯‘ç¤ºä¾‹**ï¼š
```php
// âœ… PDOé¢„ç¼–è¯‘è¯­å¥
$sql = "SELECT * FROM users WHERE username = :username AND password = :password";
$stmt = $pdo->prepare($sql);

// ç»‘å®šå‚æ•°
$stmt->bindParam(':username', $username);
$stmt->bindParam(':password', $password);

$stmt->execute();
```

### 5.2 ORMæ¡†æ¶é˜²æ³¨å…¥æœºåˆ¶


**ä»€ä¹ˆæ˜¯ORMï¼Ÿ**
ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æŠŠæ•°æ®åº“æ“ä½œè½¬æ¢æˆé¢å‘å¯¹è±¡çš„æ“ä½œï¼Œå¤©ç„¶å…·å¤‡é˜²æ³¨å…¥èƒ½åŠ›ã€‚

**Hibernateé˜²æ³¨å…¥ç¤ºä¾‹**ï¼š
```java
// âœ… ä½¿ç”¨HQLæŸ¥è¯¢ï¼ˆç±»ä¼¼SQLä½†æ›´å®‰å…¨ï¼‰
String hql = "FROM User WHERE username = :username AND password = :password";
Query query = session.createQuery(hql);
query.setParameter("username", username);
query.setParameter("password", password);
List<User> users = query.list();
```

**Django ORMé˜²æ³¨å…¥**ï¼š
```python
# âœ… Djangoçš„å®‰å…¨æŸ¥è¯¢
from myapp.models import User

# ORMè‡ªåŠ¨å¤„ç†SQLæ³¨å…¥é˜²æŠ¤
user = User.objects.filter(
    username=username,
    password=password
).first()

# å³ä½¿usernameåŒ…å«æ¶æ„ä»£ç ï¼Œä¹Ÿä¼šè¢«å½“ä½œæ™®é€šå­—ç¬¦ä¸²å¤„ç†
```

**MyBatisé˜²æ³¨å…¥é…ç½®**ï¼š
```xml
<!-- âœ… ä½¿ç”¨#{}å‚æ•°ç»‘å®šï¼ˆå®‰å…¨ï¼‰ -->
<select id="findUser" resultType="User">
    SELECT * FROM users 
    WHERE username = #{username} AND password = #{password}
</select>

<!-- âŒ é¿å…ä½¿ç”¨${}å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆå±é™©ï¼‰ -->
<select id="findUserDangerous" resultType="User">
    SELECT * FROM users 
    WHERE username = '${username}' AND password = '${password}'
</select>
```

### 5.3 è¾“å…¥éªŒè¯ä¸è¿‡æ»¤æŠ€æœ¯


**ç™½åå•éªŒè¯ç­–ç•¥**ï¼š
```java
public boolean isValidUsername(String username) {
    // åªå…è®¸å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œé•¿åº¦3-20ä½
    Pattern pattern = Pattern.compile("^[a-zA-Z0-9_]{3,20}$");
    return pattern.matcher(username).matches();
}

public boolean isValidEmail(String email) {
    // ä¸¥æ ¼çš„é‚®ç®±æ ¼å¼éªŒè¯
    Pattern pattern = Pattern.compile("^[\\w.-]+@[\\w.-]+\\.[a-zA-Z]{2,}$");
    return pattern.matcher(email).matches();
}
```

**æ•°æ®ç±»å‹éªŒè¯**ï¼š
```java
// ç¡®ä¿IDæ˜¯æ•´æ•°
public User getUserById(String idStr) {
    try {
        int id = Integer.parseInt(idStr);
        if (id <= 0) {
            throw new IllegalArgumentException("IDå¿…é¡»ä¸ºæ­£æ•´æ•°");
        }
        return userDao.findById(id);
    } catch (NumberFormatException e) {
        throw new IllegalArgumentException("æ— æ•ˆçš„IDæ ¼å¼");
    }
}
```

**SQLå…³é”®å­—è¿‡æ»¤**ï¼š
```java
public String filterSqlKeywords(String input) {
    // è¿‡æ»¤å¸¸è§çš„SQLæ³¨å…¥å…³é”®å­—
    String[] sqlKeywords = {
        "SELECT", "INSERT", "UPDATE", "DELETE", "DROP", 
        "UNION", "OR", "AND", "--", "/*", "*/"
    };
    
    String filtered = input;
    for (String keyword : sqlKeywords) {
        filtered = filtered.replaceAll("(?i)" + keyword, "");
    }
    
    return filtered;
}
```

### 5.4 Webåº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰é…ç½®


**ModSecurityè§„åˆ™ç¤ºä¾‹**ï¼š
```apache
# æ£€æµ‹SQLæ³¨å…¥æ”»å‡»
SecRule ARGS "@detectSQLi" \
    "id:1001,\
    phase:2,\
    block,\
    msg:'SQL Injection Attack Detected',\
    logdata:'Matched Data: %{MATCHED_VAR} found within %{MATCHED_VAR_NAME}'"

# æ£€æµ‹å¸¸è§SQLæ³¨å…¥å­—ç¬¦
SecRule ARGS "@contains union" \
    "id:1002,\
    phase:2,\
    block,\
    msg:'UNION SQL Injection'"
```

**äº‘WAFé…ç½®è¦ç‚¹**ï¼š
```
ğŸ”¸ å¯ç”¨SQLæ³¨å…¥é˜²æŠ¤è§„åˆ™
ğŸ”¸ è®¾ç½®åˆé€‚çš„é˜²æŠ¤ç­‰çº§ï¼ˆé¿å…è¯¯æŠ¥ï¼‰
ğŸ”¸ é…ç½®ç™½åå•ï¼ˆå…è®¸åˆæ³•è¯·æ±‚ï¼‰
ğŸ”¸ ç›‘æ§å’Œåˆ†ææ”»å‡»æ—¥å¿—
ğŸ”¸ å®šæœŸæ›´æ–°é˜²æŠ¤è§„åˆ™
```

---

## 6. âš™ï¸ æ•°æ®åº“å®‰å…¨é…ç½®å®è·µ


### 6.1 æ•°æ®åº“è´¦æˆ·æƒé™æœ€å°åŒ–


**æƒé™åˆ†ç¦»åŸåˆ™**ï¼š
```sql
-- âŒ é”™è¯¯ï¼šåº”ç”¨ä½¿ç”¨rootè´¦æˆ·
GRANT ALL PRIVILEGES ON *.* TO 'app_user'@'%';

-- âœ… æ­£ç¡®ï¼šåº”ç”¨åªè·å¾—å¿…è¦æƒé™
-- åˆ›å»ºä¸“ç”¨åº”ç”¨è´¦æˆ·
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'strong_password';

-- åªæˆäºˆå¿…è¦çš„æ•°æ®åº“æƒé™
GRANT SELECT, INSERT, UPDATE ON app_database.* TO 'app_user'@'localhost';

-- ç¦æ­¢åˆ é™¤è¡¨å’Œä¿®æ”¹ç»“æ„
-- ä¸æˆäºˆDROP, ALTER, CREATEç­‰å±é™©æƒé™
```

**è´¦æˆ·æƒé™å±‚çº§è®¾è®¡**ï¼š
```
ğŸ“Š æƒé™å±‚çº§æ¶æ„ï¼š

ğŸ”´ DBAè´¦æˆ·ï¼ˆç”Ÿäº§ç¯å¢ƒç¦ç”¨ï¼‰
â”œâ”€â”€ æ•°æ®åº“ç®¡ç†å‘˜
â”œâ”€â”€ ç»“æ„ä¿®æ”¹æƒé™
â””â”€â”€ å®Œå…¨æ§åˆ¶æƒé™

ğŸŸ¡ åº”ç”¨è´¦æˆ·ï¼ˆæ—¥å¸¸ä½¿ç”¨ï¼‰
â”œâ”€â”€ ä¸šåŠ¡æ•°æ®è¯»å†™
â”œâ”€â”€ å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œ
â””â”€â”€ ç‰¹å®šè¡¨æ“ä½œ

ğŸŸ¢ åªè¯»è´¦æˆ·ï¼ˆæŠ¥è¡¨æŸ¥è¯¢ï¼‰
â”œâ”€â”€ æŸ¥è¯¢ç»Ÿè®¡æ•°æ®
â”œâ”€â”€ ç”Ÿæˆä¸šåŠ¡æŠ¥è¡¨
â””â”€â”€ æ•°æ®åˆ†ææƒé™

ğŸ”µ å¤‡ä»½è´¦æˆ·ï¼ˆç³»ç»Ÿä»»åŠ¡ï¼‰
â”œâ”€â”€ æ•°æ®å¤‡ä»½æƒé™
â”œâ”€â”€ æ—¥å¿—æ¸…ç†æƒé™
â””â”€â”€ ç»´æŠ¤ä»»åŠ¡æƒé™
```

### 6.2 æ•°æ®åº“ç½‘ç»œå®‰å…¨é…ç½®


**ç½‘ç»œè®¿é—®æ§åˆ¶**ï¼š
```sql
-- é™åˆ¶æ•°æ®åº“è®¿é—®æ¥æº
-- åªå…è®¸åº”ç”¨æœåŠ¡å™¨è®¿é—®
CREATE USER 'app_user'@'192.168.1.100' IDENTIFIED BY 'password';
CREATE USER 'app_user'@'192.168.1.101' IDENTIFIED BY 'password';

-- ç¦æ­¢ä»ä»»æ„åœ°å€è®¿é—®
-- é¿å…ä½¿ç”¨ '@%' é€šé…ç¬¦
```

**MySQLå®‰å…¨é…ç½®ç¤ºä¾‹**ï¼š
```ini
# my.cnf å®‰å…¨é…ç½®
[mysqld]
# ç»‘å®šæœ¬åœ°IPï¼Œç¦æ­¢å¤–ç½‘ç›´æ¥è®¿é—®
bind-address = 127.0.0.1

# ç¦ç”¨ä¸å®‰å…¨çš„åŠŸèƒ½
skip-symbolic-links
local-infile = 0

# è®¾ç½®è¿æ¥è¶…æ—¶
connect_timeout = 10
wait_timeout = 600

# é™åˆ¶è¿æ¥æ•°
max_connections = 100
max_user_connections = 10
```

### 6.3 æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨


**å¯†ç å®‰å…¨å­˜å‚¨**ï¼š
```java
// âœ… ä½¿ç”¨BCryptåŠ å¯†å¯†ç 
public class PasswordUtil {
    private static final BCryptPasswordEncoder encoder = new BCryptPasswordEncoder(12);
    
    // åŠ å¯†å¯†ç 
    public static String encryptPassword(String rawPassword) {
        return encoder.encode(rawPassword);
    }
    
    // éªŒè¯å¯†ç 
    public static boolean verifyPassword(String rawPassword, String encodedPassword) {
        return encoder.matches(rawPassword, encodedPassword);
    }
}

// å­˜å‚¨æ—¶åŠ å¯†
String encryptedPassword = PasswordUtil.encryptPassword(userPassword);
user.setPassword(encryptedPassword);
```

**æ•æ„Ÿå­—æ®µåŠ å¯†**ï¼š
```sql
-- åˆ›å»ºè¡¨æ—¶è€ƒè™‘åŠ å¯†éœ€æ±‚
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,  -- åŠ å¯†åçš„å¯†ç 
    email_encrypted VARBINARY(255),       -- åŠ å¯†çš„é‚®ç®±
    phone_encrypted VARBINARY(255),       -- åŠ å¯†çš„æ‰‹æœºå·
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 6.4 æ•°æ®åº“å®¡è®¡ä¸ç›‘æ§


**å¯ç”¨æ•°æ®åº“å®¡è®¡æ—¥å¿—**ï¼š
```sql
-- MySQLå¯ç”¨å®¡è®¡æ’ä»¶
INSTALL PLUGIN audit_log SONAME 'audit_log.so';

-- è®¾ç½®å®¡è®¡ç­–ç•¥
SET GLOBAL audit_log_policy = ALL;
SET GLOBAL audit_log_format = JSON;
```

**å…³é”®æ“ä½œç›‘æ§**ï¼š
```python
# ç¤ºä¾‹ï¼šç›‘æ§å¼‚å¸¸æŸ¥è¯¢
import logging
import time

class DatabaseMonitor:
    def __init__(self):
        self.logger = logging.getLogger('db_monitor')
        
    def log_query(self, sql, execution_time, user):
        # è®°å½•æ…¢æŸ¥è¯¢
        if execution_time > 5.0:
            self.logger.warning(f"æ…¢æŸ¥è¯¢è­¦å‘Š: {sql} | ç”¨æˆ·: {user} | è€—æ—¶: {execution_time}s")
        
        # æ£€æµ‹å¯ç–‘SQLæ¨¡å¼
        suspicious_patterns = ['UNION', 'DROP', 'DELETE', '--', '/*']
        if any(pattern.upper() in sql.upper() for pattern in suspicious_patterns):
            self.logger.error(f"å¯ç–‘SQLæ£€æµ‹: {sql} | ç”¨æˆ·: {user}")
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„é˜²æŠ¤æŠ€æœ¯


```
ğŸ”¸ é¢„ç¼–è¯‘è¯­å¥ï¼šæœ€æœ‰æ•ˆçš„SQLæ³¨å…¥é˜²æŠ¤æ‰‹æ®µ
ğŸ”¸ è¾“å…¥éªŒè¯ï¼šç™½åå•ç­–ç•¥ï¼Œä¸¥æ ¼éªŒè¯æ•°æ®ç±»å‹å’Œæ ¼å¼
ğŸ”¸ æƒé™æœ€å°åŒ–ï¼šæ•°æ®åº“è´¦æˆ·åªè·å¾—å¿…è¦æƒé™
ğŸ”¸ ORMæ¡†æ¶ï¼šåˆ©ç”¨æ¡†æ¶çš„å†…ç½®å®‰å…¨æœºåˆ¶
ğŸ”¸ WAFé˜²æŠ¤ï¼šWebåº”ç”¨é˜²ç«å¢™ä½œä¸ºå¤–å±‚é˜²çº¿
```

### 7.2 SQLæ³¨å…¥æ”»å‡»ç±»å‹è®°å¿†


```
ğŸ’¡ è®°å¿†å£è¯€ï¼š
Unionè”åˆæŸ¥è¯¢æŠŠæ•°æ®å·
Booleanç›²æ³¨é é€»è¾‘æ¥çŒœ
Timeæ—¶é—´ç›²æ³¨ç­‰å»¶æ—¶
Erroré”™è¯¯æ³¨å…¥çœ‹æŠ¥é”™
NoSQLæ–‡æ¡£åº“ä¹Ÿè¦é˜²
```

### 7.3 å®æˆ˜é˜²æŠ¤æ£€æŸ¥æ¸…å•


**å¼€å‘é˜¶æ®µ**ï¼š
- âœ… æ‰€æœ‰SQLæŸ¥è¯¢ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥
- âœ… ä¸¥æ ¼éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
- âœ… ä½¿ç”¨ORMæ¡†æ¶çš„å®‰å…¨ç‰¹æ€§
- âœ… é¿å…ç›´æ¥æ‹¼æ¥SQLå­—ç¬¦ä¸²

**éƒ¨ç½²é˜¶æ®µ**ï¼š
- âœ… é…ç½®æ•°æ®åº“è´¦æˆ·æœ€å°æƒé™
- âœ… å¯ç”¨WAF SQLæ³¨å…¥é˜²æŠ¤
- âœ… è®¾ç½®æ•°æ®åº“ç½‘ç»œè®¿é—®æ§åˆ¶
- âœ… å¼€å¯æ•°æ®åº“å®¡è®¡æ—¥å¿—

**è¿ç»´é˜¶æ®µ**ï¼š
- âœ… å®šæœŸæ£€æŸ¥å’Œæ›´æ–°é˜²æŠ¤è§„åˆ™
- âœ… ç›‘æ§å¼‚å¸¸æ•°æ®åº“æŸ¥è¯¢
- âœ… åŠæ—¶å¤„ç†å®‰å…¨å‘Šè­¦
- âœ… å®šæœŸè¿›è¡Œå®‰å…¨æµ‹è¯•

### 7.4 åº”æ€¥å“åº”æµç¨‹


**å‘ç°SQLæ³¨å…¥æ”»å‡»æ—¶**ï¼š
```
ç¬¬1æ­¥ï¼šç«‹å³éš”ç¦»
â”œâ”€â”€ æš‚åœå¯ç–‘åº”ç”¨åŠŸèƒ½
â”œâ”€â”€ åˆ†ææ”»å‡»æ—¥å¿—
â””â”€â”€ ç¡®å®šå½±å“èŒƒå›´

ç¬¬2æ­¥ï¼šæŸå¤±è¯„ä¼°
â”œâ”€â”€ æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«çªƒå–
â”œâ”€â”€ ç¡®è®¤æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹
â””â”€â”€ è¯„ä¼°ä¸šåŠ¡å½±å“ç¨‹åº¦

ç¬¬3æ­¥ï¼šä¿®å¤åŠ å›º
â”œâ”€â”€ ä¿®å¤ä»£ç ä¸­çš„æ³¨å…¥æ¼æ´
â”œâ”€â”€ æ›´æ–°æ•°æ®åº“å®‰å…¨é…ç½®
â””â”€â”€ åŠ å¼ºè¾“å…¥éªŒè¯æœºåˆ¶

ç¬¬4æ­¥ï¼šæ¢å¤æœåŠ¡
â”œâ”€â”€ éªŒè¯ä¿®å¤æ•ˆæœ
â”œâ”€â”€ é€æ­¥æ¢å¤ä¸šåŠ¡åŠŸèƒ½
â””â”€â”€ æŒç»­ç›‘æ§ç³»ç»ŸçŠ¶æ€
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- SQLæ³¨å…¥æœ¬è´¨æ˜¯ä»£ç å’Œæ•°æ®æ··æ·†
- é¢„ç¼–è¯‘è¯­å¥æ˜¯æœ€å¯é çš„é˜²æŠ¤æ–¹æ³•
- å¤šå±‚é˜²æŠ¤æ¯”å•ä¸€é˜²æŠ¤æ›´å®‰å…¨
- å®šæœŸæµ‹è¯•å’Œæ›´æ–°é˜²æŠ¤æªæ–½
- å‘ç°é—®é¢˜è¦å¿«é€Ÿå“åº”å’Œä¿®å¤