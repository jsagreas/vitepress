---
title: 9ã€å¹¶å‘ä¼˜åŒ–æŠ€æœ¯
---
## ğŸ“š ç›®å½•

1. [å¹¶å‘ä¼˜åŒ–åŸºç¡€ç†è§£](#1-å¹¶å‘ä¼˜åŒ–åŸºç¡€ç†è§£)
2. [çº¿ç¨‹æ± é…ç½®ä¼˜åŒ–](#2-çº¿ç¨‹æ± é…ç½®ä¼˜åŒ–)
3. [æ‰¹é‡å¤„ç†ç­–ç•¥](#3-æ‰¹é‡å¤„ç†ç­–ç•¥)
4. [æµæ°´çº¿å¹¶è¡Œå¤„ç†](#4-æµæ°´çº¿å¹¶è¡Œå¤„ç†)
5. [æ— é”æ•°æ®ç»“æ„](#5-æ— é”æ•°æ®ç»“æ„)
6. [æ‰¹é‡ä¸åˆå¹¶æ“ä½œ](#6-æ‰¹é‡ä¸åˆå¹¶æ“ä½œ)
7. [çƒ­ç‚¹æ•°æ®ä¼˜åŒ–](#7-çƒ­ç‚¹æ•°æ®ä¼˜åŒ–)
8. [å¹¶å‘æ€§èƒ½ä¼˜åŒ–](#8-å¹¶å‘æ€§èƒ½ä¼˜åŒ–)
9. [å¼‚æ­¥å¤„ç†æ€ç»´](#9-å¼‚æ­¥å¤„ç†æ€ç»´)
10. [é™æµæ§åˆ¶æ€ç»´](#10-é™æµæ§åˆ¶æ€ç»´)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¹¶å‘ä¼˜åŒ–åŸºç¡€ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯å¹¶å‘ä¼˜åŒ–


**é€šä¿—ç†è§£**ï¼šå¹¶å‘ä¼˜åŒ–å°±åƒç®¡ç†ä¸€ä¸ªç¹å¿™çš„é¤å…

```
å•çº¿ç¨‹å¤„ç†ï¼ˆä¸€ä¸ªæœåŠ¡å‘˜ï¼‰ï¼š
å®¢æˆ·Aç‚¹é¤ â†’ åšèœ â†’ ä¸Šèœ â†’ å®¢æˆ·Bç‚¹é¤ â†’ åšèœ â†’ ä¸Šèœ
é—®é¢˜ï¼šå®¢æˆ·æ’é•¿é˜Ÿï¼Œæ•ˆç‡ä½

å¹¶å‘å¤„ç†ï¼ˆå¤šä¸ªæœåŠ¡å‘˜ï¼‰ï¼š
æœåŠ¡å‘˜1ï¼šå®¢æˆ·Aç‚¹é¤ â†’ å®¢æˆ·Cç‚¹é¤ â†’ å®¢æˆ·Eç‚¹é¤
æœåŠ¡å‘˜2ï¼šå®¢æˆ·Bç‚¹é¤ â†’ å®¢æˆ·Dç‚¹é¤ â†’ å®¢æˆ·Fç‚¹é¤
å¨å¸ˆï¼šåŒæ—¶åšå¤šé“èœ
æ•ˆæœï¼šåŒæ—¶æœåŠ¡å¤šä¸ªå®¢æˆ·ï¼Œæ•ˆç‡é«˜
```

### 1.2 å¹¶å‘ä¼˜åŒ–çš„æ ¸å¿ƒç›®æ ‡


**ğŸ¯ ä¸»è¦ç›®æ ‡**
- **æå‡ååé‡**ï¼šå•ä½æ—¶é—´å¤„ç†æ›´å¤šä»»åŠ¡
- **é™ä½å»¶è¿Ÿ**ï¼šå‡å°‘ä»»åŠ¡ç­‰å¾…æ—¶é—´
- **èµ„æºåˆ©ç”¨ç‡**ï¼šå……åˆ†åˆ©ç”¨CPUã€å†…å­˜ã€IOç­‰èµ„æº
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šé¿å…å› å¹¶å‘å¯¼è‡´çš„ç³»ç»Ÿå´©æºƒ

### 1.3 å¹¶å‘ä¼˜åŒ–çš„åŸºæœ¬åŸåˆ™


```
åŸåˆ™1ï¼šåˆç†åˆ†å·¥
â€¢ ä¸åŒç±»å‹çš„ä»»åŠ¡åˆ†é…ç»™ä¸“é—¨çš„çº¿ç¨‹å¤„ç†
â€¢ é¿å…æ‰€æœ‰ä»»åŠ¡æŒ¤åœ¨ä¸€èµ·

åŸåˆ™2ï¼šå‡å°‘ç­‰å¾…
â€¢ å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
â€¢ æ‰¹é‡å¤„ç†å‡å°‘IOæ¬¡æ•°

åŸåˆ™3ï¼šé¿å…ç«äº‰
â€¢ å‡å°‘å…±äº«èµ„æºçš„äº‰æŠ¢
â€¢ ä½¿ç”¨æ— é”æ•°æ®ç»“æ„

åŸåˆ™4ï¼šæ§åˆ¶èµ„æº
â€¢ é™åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…èµ„æºè€—å°½
â€¢ åˆç†é…ç½®çº¿ç¨‹æ± å¤§å°
```

---

## 2. ğŸ”§ çº¿ç¨‹æ± é…ç½®ä¼˜åŒ–


### 2.1 çº¿ç¨‹æ± çš„ä½œç”¨


**ç®€å•ç†è§£**ï¼šçº¿ç¨‹æ± å°±åƒå·¥å‚é‡Œçš„å·¥äººç­ç»„

```
æ²¡æœ‰çº¿ç¨‹æ± ï¼ˆä¸´æ—¶é›‡å·¥ï¼‰ï¼š
ä»»åŠ¡æ¥äº† â†’ æ‹›è˜å·¥äºº â†’ åŸ¹è®­å·¥äºº â†’ å·¥ä½œ â†’ è§£é›‡å·¥äºº
é—®é¢˜ï¼šæ‹›è˜å’ŒåŸ¹è®­æˆæœ¬é«˜ï¼Œæ•ˆç‡ä½

æœ‰çº¿ç¨‹æ± ï¼ˆå›ºå®šå‘˜å·¥ï¼‰ï¼š
é¢„å…ˆå‡†å¤‡å¥½å·¥äºº â†’ ä»»åŠ¡æ¥äº†ç›´æ¥åˆ†é… â†’ å·¥ä½œ â†’ ç­‰å¾…ä¸‹ä¸ªä»»åŠ¡
ä¼˜åŠ¿ï¼šæ²¡æœ‰æ‹›è˜æˆæœ¬ï¼Œå“åº”å¿«
```

### 2.2 çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°


**âš™ï¸ å…³é”®é…ç½®å‚æ•°**

| å‚æ•° | å«ä¹‰ | ç±»æ¯” | é…ç½®å»ºè®® |
|------|------|------|----------|
| **corePoolSize** | `æ ¸å¿ƒçº¿ç¨‹æ•°` | `æ­£å¼å‘˜å·¥æ•°é‡` | `CPUå¯†é›†å‹ï¼šCPUæ ¸æ•°+1` |
| **maximumPoolSize** | `æœ€å¤§çº¿ç¨‹æ•°` | `æœ€å¤šå‘˜å·¥æ•°ï¼ˆå«ä¸´æ—¶å·¥ï¼‰` | `IOå¯†é›†å‹ï¼šCPUæ ¸æ•°Ã—2` |
| **keepAliveTime** | `çº¿ç¨‹å­˜æ´»æ—¶é—´` | `ä¸´æ—¶å·¥åˆåŒæœŸé™` | `30-60ç§’` |
| **workQueue** | `ä»»åŠ¡é˜Ÿåˆ—` | `ä»»åŠ¡å¾…åŠç®±` | `æ ¹æ®åœºæ™¯é€‰æ‹©é˜Ÿåˆ—ç±»å‹` |

### 2.3 çº¿ç¨‹æ± é…ç½®å®ä¾‹


```java
// CPUå¯†é›†å‹ä»»åŠ¡é…ç½®ï¼ˆè®¡ç®—ç±»ä»»åŠ¡ï¼‰
ThreadPoolExecutor cpuPool = new ThreadPoolExecutor(
    Runtime.getRuntime().availableProcessors(),     // æ ¸å¿ƒçº¿ç¨‹æ•°=CPUæ ¸æ•°
    Runtime.getRuntime().availableProcessors(),     // æœ€å¤§çº¿ç¨‹æ•°=CPUæ ¸æ•°
    0L, TimeUnit.MILLISECONDS,                      // æ— éœ€å­˜æ´»æ—¶é—´
    new LinkedBlockingQueue<>(100)                  // æœ‰ç•Œé˜Ÿåˆ—é˜²æ­¢å†…å­˜æº¢å‡º
);

// IOå¯†é›†å‹ä»»åŠ¡é…ç½®ï¼ˆç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ï¼‰
ThreadPoolExecutor ioPool = new ThreadPoolExecutor(
    10,                                             // æ ¸å¿ƒçº¿ç¨‹æ•°
    50,                                             // æœ€å¤§çº¿ç¨‹æ•°ï¼ˆIOç­‰å¾…æ—¶å¯ä»¥æ›´å¤šï¼‰
    60L, TimeUnit.SECONDS,                          // 60ç§’å­˜æ´»æ—¶é—´
    new LinkedBlockingQueue<>(200)                  // è¾ƒå¤§é˜Ÿåˆ—å®¹çº³æ›´å¤šä»»åŠ¡
);
```

### 2.4 é…ç½®ä¼˜åŒ–ç­–ç•¥


**ğŸ“Š ä¸åŒåœºæ™¯çš„é…ç½®ç­–ç•¥**

```
è®¡ç®—å¯†é›†å‹ï¼ˆå¦‚å›¾åƒå¤„ç†ï¼‰ï¼š
çº¿ç¨‹æ•° = CPUæ ¸æ•°
åŸå› ï¼šCPUæ»¡è´Ÿè·è¿è½¬ï¼Œå¤šäº†ä¹Ÿæ²¡ç”¨ï¼Œè¿˜ä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€

IOå¯†é›†å‹ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ï¼š
çº¿ç¨‹æ•° = CPUæ ¸æ•° Ã— 2~4
åŸå› ï¼šçº¿ç¨‹ç»å¸¸ç­‰å¾…IOï¼Œå¯ä»¥æœ‰æ›´å¤šçº¿ç¨‹

æ··åˆå‹ï¼ˆè®¡ç®—+IOï¼‰ï¼š
çº¿ç¨‹æ•° = CPUæ ¸æ•° Ã— 1.5~2
åŸå› ï¼šåœ¨è®¡ç®—å’Œç­‰å¾…ä¹‹é—´æ‰¾å¹³è¡¡

å®æ—¶å“åº”ï¼ˆå¦‚Webè¯·æ±‚ï¼‰ï¼š
ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼šSynchronousQueue
åŸå› ï¼šä»»åŠ¡ç«‹å³æ‰§è¡Œï¼Œä¸æ’é˜Ÿç­‰å¾…
```

---

## 3. ğŸ“¦ æ‰¹é‡å¤„ç†ç­–ç•¥


### 3.1 æ‰¹é‡å¤„ç†çš„åŸºæœ¬æ¦‚å¿µ


**ç”Ÿæ´»ä¾‹å­**ï¼šæ‰¹é‡å¤„ç†å°±åƒå»è¶…å¸‚è´­ç‰©

```
éæ‰¹é‡å¤„ç†ï¼ˆé¢‘ç¹è·‘è…¿ï¼‰ï¼š
éœ€è¦è‹¹æœ â†’ å»è¶…å¸‚ä¹°è‹¹æœ â†’ å›å®¶
éœ€è¦ç‰›å¥¶ â†’ å»è¶…å¸‚ä¹°ç‰›å¥¶ â†’ å›å®¶
éœ€è¦é¢åŒ… â†’ å»è¶…å¸‚ä¹°é¢åŒ… â†’ å›å®¶
é—®é¢˜ï¼šè·‘äº†3æ¬¡ï¼Œæµªè´¹æ—¶é—´å’Œæ²¹è´¹

æ‰¹é‡å¤„ç†ï¼ˆä¸€æ¬¡è´­é½ï¼‰ï¼š
åˆ—æ¸…å•ï¼šè‹¹æœã€ç‰›å¥¶ã€é¢åŒ… â†’ å»è¶…å¸‚ä¸€æ¬¡ä¹°é½ â†’ å›å®¶
ä¼˜åŠ¿ï¼šåªè·‘1æ¬¡ï¼Œæ•ˆç‡é«˜ï¼Œæˆæœ¬ä½
```

### 3.2 æ‰¹é‡å¤„ç†çš„åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**

```java
// åœºæ™¯1ï¼šæ‰¹é‡æ•°æ®åº“æ“ä½œ
// âŒ ä½æ•ˆæ–¹å¼ï¼šé€æ¡æ’å…¥
for (User user : users) {
    userDao.insert(user);  // æ¯æ¬¡éƒ½è¦è¿æ¥æ•°æ®åº“
}

// âœ… é«˜æ•ˆæ–¹å¼ï¼šæ‰¹é‡æ’å…¥
userDao.batchInsert(users);  // ä¸€æ¬¡æ€§æ’å…¥æ‰€æœ‰æ•°æ®

// åœºæ™¯2ï¼šæ‰¹é‡APIè°ƒç”¨
// âŒ ä½æ•ˆæ–¹å¼ï¼šé€ä¸ªè°ƒç”¨
for (String id : ids) {
    apiService.getUserInfo(id);  // æ¯æ¬¡éƒ½è¦å»ºç«‹ç½‘ç»œè¿æ¥
}

// âœ… é«˜æ•ˆæ–¹å¼ï¼šæ‰¹é‡è°ƒç”¨
apiService.getBatchUserInfo(ids);  // ä¸€æ¬¡è¯·æ±‚è·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
```

### 3.3 æ‰¹é‡å¤„ç†ç­–ç•¥è®¾è®¡


**ğŸ“‹ æ‰¹é‡ç­–ç•¥çš„å…³é”®è¦ç´ **

```
æ‰¹é‡å¤§å°ï¼ˆBatch Sizeï¼‰ï¼š
â€¢ å¤ªå°ï¼šæ‰¹é‡æ•ˆæœä¸æ˜æ˜¾
â€¢ å¤ªå¤§ï¼šå†…å­˜å ç”¨è¿‡å¤šï¼Œå¯èƒ½è¶…æ—¶
â€¢ å»ºè®®ï¼š100-1000æ¡è®°å½•ä¸ºä¸€æ‰¹

æ‰¹é‡è¶…æ—¶ï¼ˆBatch Timeoutï¼‰ï¼š
â€¢ ä½œç”¨ï¼šé˜²æ­¢ç­‰å¾…æ—¶é—´è¿‡é•¿
â€¢ åœºæ™¯ï¼šæ•°æ®é‡ä¸å¤Ÿä¸€æ‰¹æ—¶ï¼Œå®šæ—¶è§¦å‘
â€¢ å»ºè®®ï¼š5-30ç§’

æ‰¹é‡è§¦å‘æ¡ä»¶ï¼š
â€¢ æ•°é‡è§¦å‘ï¼šè¾¾åˆ°æŒ‡å®šæ•°é‡ç«‹å³å¤„ç†
â€¢ æ—¶é—´è§¦å‘ï¼šè¶…è¿‡æŒ‡å®šæ—¶é—´ç«‹å³å¤„ç†
â€¢ æ··åˆè§¦å‘ï¼šä¸¤ä¸ªæ¡ä»¶ä»»ä¸€æ»¡è¶³å³å¤„ç†
```

### 3.4 æ‰¹é‡å¤„ç†å®ç°ç¤ºä¾‹


```java
// æ‰¹é‡å¤„ç†å™¨å®ç°
public class BatchProcessor<T> {
    private final List<T> batch = new ArrayList<>();
    private final int batchSize;
    private final long timeoutMs;
    private volatile long lastAddTime;
    
    public BatchProcessor(int batchSize, long timeoutMs) {
        this.batchSize = batchSize;
        this.timeoutMs = timeoutMs;
        
        // å®šæ—¶æ£€æŸ¥è¶…æ—¶çš„æ‰¹æ¬¡
        ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();
        scheduler.scheduleAtFixedRate(this::checkTimeout, timeoutMs, timeoutMs, TimeUnit.MILLISECONDS);
    }
    
    public synchronized void add(T item) {
        batch.add(item);
        lastAddTime = System.currentTimeMillis();
        
        // æ•°é‡è¾¾åˆ°é˜ˆå€¼ï¼Œç«‹å³å¤„ç†
        if (batch.size() >= batchSize) {
            processBatch();
        }
    }
    
    private void checkTimeout() {
        synchronized (this) {
            // è¶…æ—¶ä¸”æœ‰æ•°æ®ï¼Œç«‹å³å¤„ç†
            if (!batch.isEmpty() && 
                System.currentTimeMillis() - lastAddTime > timeoutMs) {
                processBatch();
            }
        }
    }
    
    private void processBatch() {
        if (batch.isEmpty()) return;
        
        List<T> currentBatch = new ArrayList<>(batch);
        batch.clear();
        
        // å®é™…çš„æ‰¹é‡å¤„ç†é€»è¾‘
        handleBatch(currentBatch);
    }
    
    protected void handleBatch(List<T> items) {
        // å­ç±»å®ç°å…·ä½“çš„æ‰¹é‡å¤„ç†é€»è¾‘
    }
}
```

---

## 4. ğŸ”„ æµæ°´çº¿å¹¶è¡Œå¤„ç†


### 4.1 æµæ°´çº¿å¤„ç†çš„æ¦‚å¿µ


**å·¥å‚æµæ°´çº¿ç±»æ¯”**ï¼š

```
ä¼ ç»Ÿç”Ÿäº§æ–¹å¼ï¼ˆä¸²è¡Œï¼‰ï¼š
å·¥äººAï¼šåˆ¶ä½œæ•´ä¸ªäº§å“ï¼ˆ10åˆ†é’Ÿï¼‰
å·¥äººBï¼šç­‰å¾…å·¥äººAå®Œæˆåï¼Œåˆ¶ä½œä¸‹ä¸€ä¸ªäº§å“ï¼ˆ10åˆ†é’Ÿï¼‰
ç»“æœï¼šç”Ÿäº§2ä¸ªäº§å“éœ€è¦20åˆ†é’Ÿ

æµæ°´çº¿ç”Ÿäº§ï¼ˆå¹¶è¡Œï¼‰ï¼š
å·¥äººAï¼šä¸“é—¨è´Ÿè´£ç¬¬1é“å·¥åºï¼ˆ3åˆ†é’Ÿï¼‰
å·¥äººBï¼šä¸“é—¨è´Ÿè´£ç¬¬2é“å·¥åºï¼ˆ4åˆ†é’Ÿï¼‰  
å·¥äººCï¼šä¸“é—¨è´Ÿè´£ç¬¬3é“å·¥åºï¼ˆ3åˆ†é’Ÿï¼‰

æ—¶é—´è½´ï¼š
0-3åˆ†é’Ÿï¼šå·¥äººAåšäº§å“1æ­¥éª¤1
3-7åˆ†é’Ÿï¼šå·¥äººAåšäº§å“2æ­¥éª¤1ï¼Œå·¥äººBåšäº§å“1æ­¥éª¤2
7-10åˆ†é’Ÿï¼šå·¥äººAåšäº§å“3æ­¥éª¤1ï¼Œå·¥äººBåšäº§å“2æ­¥éª¤2ï¼Œå·¥äººCåšäº§å“1æ­¥éª¤3
ç»“æœï¼šæ¯4åˆ†é’Ÿå°±èƒ½å®Œæˆä¸€ä¸ªäº§å“ï¼
```

### 4.2 æµæ°´çº¿å¹¶è¡Œçš„è®¾è®¡æ¨¡å¼


**ğŸ”§ ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼**

```java
// æ•°æ®å¤„ç†æµæ°´çº¿ç¤ºä¾‹
public class DataPipeline {
    
    // ç¬¬1é˜¶æ®µï¼šæ•°æ®è¯»å–
    class DataReader implements Runnable {
        private BlockingQueue<RawData> queue;
        
        public void run() {
            while (true) {
                RawData data = readFromSource();  // ä»æ•°æ®æºè¯»å–
                queue.put(data);                  // æ”¾å…¥é˜Ÿåˆ—ç»™ä¸‹ä¸€é˜¶æ®µ
            }
        }
    }
    
    // ç¬¬2é˜¶æ®µï¼šæ•°æ®æ¸…æ´—
    class DataCleaner implements Runnable {
        private BlockingQueue<RawData> inputQueue;
        private BlockingQueue<CleanData> outputQueue;
        
        public void run() {
            while (true) {
                RawData raw = inputQueue.take();    // ä»ä¸Šä¸€é˜¶æ®µè·å–æ•°æ®
                CleanData clean = cleanData(raw);   // æ¸…æ´—æ•°æ®
                outputQueue.put(clean);             // ä¼ é€’ç»™ä¸‹ä¸€é˜¶æ®µ
            }
        }
    }
    
    // ç¬¬3é˜¶æ®µï¼šæ•°æ®åˆ†æ
    class DataAnalyzer implements Runnable {
        private BlockingQueue<CleanData> inputQueue;
        private BlockingQueue<AnalysisResult> outputQueue;
        
        public void run() {
            while (true) {
                CleanData clean = inputQueue.take();        // è·å–æ¸…æ´—åçš„æ•°æ®
                AnalysisResult result = analyze(clean);     // åˆ†ææ•°æ®
                outputQueue.put(result);                    // è¾“å‡ºç»“æœ
            }
        }
    }
}
```

### 4.3 æµæ°´çº¿æ€§èƒ½ä¼˜åŒ–


**âš¡ ä¼˜åŒ–ç­–ç•¥**

```
ç“¶é¢ˆè¯†åˆ«ï¼š
â€¢ æ‰¾å‡ºå¤„ç†æœ€æ…¢çš„é˜¶æ®µï¼ˆæœ¨æ¡¶çŸ­æ¿æ•ˆåº”ï¼‰
â€¢ ç›‘æ§å„é˜¶æ®µçš„é˜Ÿåˆ—é•¿åº¦
â€¢ é˜Ÿåˆ—å †ç§¯è¯´æ˜è¯¥é˜¶æ®µå¤„ç†èƒ½åŠ›ä¸è¶³

è´Ÿè½½å‡è¡¡ï¼š
â€¢ æ…¢é˜¶æ®µå¢åŠ æ›´å¤šå·¥ä½œçº¿ç¨‹
â€¢ åŠ¨æ€è°ƒæ•´å„é˜¶æ®µçš„çº¿ç¨‹æ•°é‡
â€¢ ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—åˆ†æ•£è´Ÿè½½

ç¼“å†²åŒºä¼˜åŒ–ï¼š
â€¢ é˜Ÿåˆ—å¤§å°é€‚ä¸­ï¼Œé¿å…å†…å­˜æº¢å‡º
â€¢ ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—é˜²æ­¢æ— é™å †ç§¯
â€¢ èƒŒå‹æœºåˆ¶ï¼šä¸‹æ¸¸å¤„ç†ä¸è¿‡æ¥æ—¶ï¼Œä¸Šæ¸¸æš‚åœ
```

---

## 5. ğŸš€ æ— é”æ•°æ®ç»“æ„


### 5.1 é”çš„é—®é¢˜


**åœè½¦åœºç±»æ¯”**ï¼š

```
æœ‰é”åœè½¦ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š
åªæœ‰ä¸€ä¸ªå…¥å£ï¼Œæœ‰ä¿å®‰æŠŠå®ˆ
æ¯æ¬¡åªèƒ½è¿›ä¸€è¾†è½¦ï¼Œå…¶ä»–è½¦æ’é˜Ÿç­‰å¾…
é—®é¢˜ï¼šæ’é˜Ÿæ—¶é—´é•¿ï¼Œä¿å®‰æˆæœ¬é«˜ï¼Œå®¹æ˜“å µå¡

æ— é”åœè½¦ï¼ˆCASæ–¹å¼ï¼‰ï¼š
å¤šä¸ªå…¥å£ï¼Œæ¯ä¸ªä½ç½®æœ‰æ„Ÿåº”å™¨
è½¦è¾†è‡ªå·±æ‰¾ç©ºä½ï¼Œå‘ç°è¢«å ç”¨å°±æ¢ä¸ªä½ç½®
ä¼˜åŠ¿ï¼šæ²¡æœ‰æ’é˜Ÿï¼Œæ•ˆç‡é«˜ï¼Œä½†éœ€è¦é‡è¯•æœºåˆ¶
```

### 5.2 CASï¼ˆCompare-And-Swapï¼‰åŸç†


**ğŸ”§ CASå·¥ä½œæœºåˆ¶**

```java
// CASçš„åŸºæœ¬æ€æƒ³
public class CASExample {
    private volatile int value = 0;
    
    // ä¼ ç»ŸåŠ é”æ–¹å¼
    public synchronized void incrementWithLock() {
        value++;  // éœ€è¦è·å–é”ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…
    }
    
    // CASæ— é”æ–¹å¼
    public void incrementWithCAS() {
        while (true) {
            int current = value;              // 1. è¯»å–å½“å‰å€¼
            int newValue = current + 1;       // 2. è®¡ç®—æ–°å€¼
            
            // 3. åŸå­æ€§åœ°æ¯”è¾ƒå¹¶äº¤æ¢
            if (compareAndSwap(current, newValue)) {
                break;  // æˆåŠŸï¼Œé€€å‡ºå¾ªç¯
            }
            // å¤±è´¥ï¼Œé‡è¯•ï¼ˆæœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†valueï¼‰
        }
    }
    
    // æ¨¡æ‹ŸCASæ“ä½œï¼ˆå®é™…ç”±CPUæŒ‡ä»¤å®ç°ï¼‰
    private boolean compareAndSwap(int expected, int newValue) {
        if (value == expected) {
            value = newValue;
            return true;   // æˆåŠŸ
        }
        return false;      // å¤±è´¥ï¼Œvalueè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†
    }
}
```

### 5.3 å¸¸ç”¨æ— é”æ•°æ®ç»“æ„


**ğŸ“Š Javaä¸­çš„æ— é”å®¹å™¨**

| å®¹å™¨ç±»å‹ | æ— é”å®ç° | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|----------|----------|----------|------|
| **è®¡æ•°å™¨** | `AtomicInteger` | `ç»Ÿè®¡ã€IDç”Ÿæˆ` | `é«˜å¹¶å‘è®¡æ•°ï¼Œæ€§èƒ½å¥½` |
| **å¼•ç”¨** | `AtomicReference` | `çŠ¶æ€æ ‡è®°ã€ç¼“å­˜` | `åŸå­æ€§æ›´æ–°å¯¹è±¡å¼•ç”¨` |
| **æ•°ç»„** | `AtomicIntegerArray` | `å¹¶å‘ç»Ÿè®¡æ•°ç»„` | `æ•°ç»„å…ƒç´ çš„åŸå­æ“ä½œ` |
| **é˜Ÿåˆ—** | `ConcurrentLinkedQueue` | `ç”Ÿäº§è€…æ¶ˆè´¹è€…` | `æ— ç•Œé˜Ÿåˆ—ï¼Œé«˜ååé‡` |
| **æ ˆ** | `ConcurrentLinkedDeque` | `ä»»åŠ¡è°ƒåº¦` | `åŒç«¯é˜Ÿåˆ—ï¼Œæ”¯æŒæ ˆæ“ä½œ` |

### 5.4 æ— é”ç¼–ç¨‹æ³¨æ„äº‹é¡¹


**âš ï¸ ä½¿ç”¨è¦ç‚¹**

```
ABAé—®é¢˜ï¼š
é—®é¢˜ï¼šå€¼ä»Aå˜æˆBå†å˜å›Aï¼ŒCASè®¤ä¸ºæ²¡å˜åŒ–
è§£å†³ï¼šä½¿ç”¨ç‰ˆæœ¬å·ï¼ˆAtomicStampedReferenceï¼‰

å†…å­˜åºé—®é¢˜ï¼š
é—®é¢˜ï¼šæŒ‡ä»¤é‡æ’åºå¯èƒ½å¯¼è‡´å¯è§æ€§é—®é¢˜
è§£å†³ï¼šä½¿ç”¨volatileå…³é”®å­—ä¿è¯å¯è§æ€§

é€‚ç”¨åœºæ™¯ï¼š
âœ… ç«äº‰ä¸æ¿€çƒˆçš„åœºæ™¯ï¼ˆé‡è¯•æ¬¡æ•°å°‘ï¼‰
âœ… ç®€å•çš„åŸå­æ“ä½œï¼ˆåŠ å‡ã€èµ‹å€¼ï¼‰
âŒ å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå®¹æ˜“å‡ºç°æ´»é”ï¼‰
âŒ é«˜ç«äº‰åœºæ™¯ï¼ˆé‡è¯•æ¬¡æ•°å¤šï¼Œåè€Œæ›´æ…¢ï¼‰
```

---

## 6. ğŸ”— æ‰¹é‡ä¸åˆå¹¶æ“ä½œ


### 6.1 æ‰¹é‡SQLä¼˜åŒ–


**æ•°æ®åº“æ“ä½œä¼˜åŒ–**ï¼š

```sql
-- âŒ ä½æ•ˆæ–¹å¼ï¼šé€æ¡æ’å…¥
INSERT INTO users (name, email) VALUES ('å¼ ä¸‰', 'zhang@qq.com');
INSERT INTO users (name, email) VALUES ('æå››', 'li@qq.com');
INSERT INTO users (name, email) VALUES ('ç‹äº”', 'wang@qq.com');
-- æ‰§è¡Œ3æ¬¡SQLï¼Œ3æ¬¡ç½‘ç»œå¾€è¿”

-- âœ… é«˜æ•ˆæ–¹å¼ï¼šæ‰¹é‡æ’å…¥
INSERT INTO users (name, email) VALUES 
    ('å¼ ä¸‰', 'zhang@qq.com'),
    ('æå››', 'li@qq.com'),
    ('ç‹äº”', 'wang@qq.com');
-- æ‰§è¡Œ1æ¬¡SQLï¼Œ1æ¬¡ç½‘ç»œå¾€è¿”
```

```java
// Javaæ‰¹é‡æ“ä½œç¤ºä¾‹
public class BatchSQLExample {
    
    // æ‰¹é‡æ’å…¥ç”¨æˆ·
    public void batchInsertUsers(List<User> users) {
        String sql = "INSERT INTO users (name, email, age) VALUES (?, ?, ?)";
        
        try (PreparedStatement pstmt = connection.prepareStatement(sql)) {
            for (User user : users) {
                pstmt.setString(1, user.getName());
                pstmt.setString(2, user.getEmail());
                pstmt.setInt(3, user.getAge());
                pstmt.addBatch();  // æ·»åŠ åˆ°æ‰¹æ¬¡
                
                // æ¯1000æ¡æ‰§è¡Œä¸€æ¬¡ï¼Œé¿å…å†…å­˜æº¢å‡º
                if (users.indexOf(user) % 1000 == 0) {
                    pstmt.executeBatch();
                    pstmt.clearBatch();
                }
            }
            pstmt.executeBatch();  // æ‰§è¡Œå‰©ä½™çš„
        }
    }
}
```

### 6.2 åˆå¹¶è¯·æ±‚ä¼˜åŒ–


**ç½‘ç»œè¯·æ±‚åˆå¹¶**ï¼š

```java
// è¯·æ±‚åˆå¹¶å™¨
public class RequestMerger<K, V> {
    private final Map<K, CompletableFuture<V>> pendingRequests = new ConcurrentHashMap<>();
    private final ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();
    
    public CompletableFuture<V> get(K key) {
        return pendingRequests.computeIfAbsent(key, k -> {
            // å»¶è¿Ÿ50msæ‰§è¡Œï¼ŒæœŸé—´æ”¶é›†æ›´å¤šè¯·æ±‚
            CompletableFuture<V> future = new CompletableFuture<>();
            
            scheduler.schedule(() -> {
                // æ”¶é›†æ‰€æœ‰å¾…å¤„ç†çš„key
                Set<K> keys = new HashSet<>(pendingRequests.keySet());
                Map<K, CompletableFuture<V>> futures = new HashMap<>();
                
                // æ¸…ç©ºå¾…å¤„ç†åˆ—è¡¨
                for (K pendingKey : keys) {
                    futures.put(pendingKey, pendingRequests.remove(pendingKey));
                }
                
                // æ‰¹é‡è·å–æ•°æ®
                Map<K, V> results = batchFetchData(keys);
                
                // åˆ†å‘ç»“æœç»™å„ä¸ªè¯·æ±‚
                results.forEach((resultKey, value) -> {
                    CompletableFuture<V> resultFuture = futures.get(resultKey);
                    if (resultFuture != null) {
                        resultFuture.complete(value);
                    }
                });
                
            }, 50, TimeUnit.MILLISECONDS);
            
            return future;
        });
    }
    
    // æ‰¹é‡è·å–æ•°æ®çš„æ–¹æ³•
    private Map<K, V> batchFetchData(Set<K> keys) {
        // å®é™…çš„æ‰¹é‡æ•°æ®è·å–é€»è¾‘
        return new HashMap<>();
    }
}
```

### 6.3 æ‰¹é‡æ“ä½œçš„æ€§èƒ½æ”¶ç›Š


**ğŸ“ˆ æ€§èƒ½å¯¹æ¯”åˆ†æ**

```
åœºæ™¯ï¼šæ’å…¥10000æ¡ç”¨æˆ·æ•°æ®

é€æ¡æ’å…¥ï¼š
â€¢ æ‰§è¡Œæ—¶é—´ï¼š10000æ¬¡ Ã— 5ms = 50ç§’
â€¢ ç½‘ç»œå¾€è¿”ï¼š10000æ¬¡
â€¢ æ•°æ®åº“è¿æ¥ï¼šé«˜é¢‘ä½¿ç”¨

æ‰¹é‡æ’å…¥ï¼ˆæ¯æ‰¹1000æ¡ï¼‰ï¼š
â€¢ æ‰§è¡Œæ—¶é—´ï¼š10æ¬¡ Ã— 100ms = 1ç§’
â€¢ ç½‘ç»œå¾€è¿”ï¼š10æ¬¡
â€¢ æ€§èƒ½æå‡ï¼š50å€

åˆå¹¶è¯·æ±‚ï¼ˆ50msçª—å£ï¼‰ï¼š
â€¢ åŸæœ¬ï¼š100ä¸ªç‹¬ç«‹è¯·æ±‚ Ã— 20ms = 2ç§’
â€¢ åˆå¹¶ï¼š1ä¸ªæ‰¹é‡è¯·æ±‚ Ã— 100ms = 0.1ç§’  
â€¢ æ€§èƒ½æå‡ï¼š20å€
```

---

## 7. ğŸ”¥ çƒ­ç‚¹æ•°æ®ä¼˜åŒ–


### 7.1 çƒ­ç‚¹æ•°æ®çš„è¯†åˆ«


**ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®**ï¼š

```
ç”µå•†ç½‘ç«™ç¤ºä¾‹ï¼š
æ™®é€šå•†å“ï¼šæ¯åˆ†é’Ÿè¢«è®¿é—®10æ¬¡
çƒ­é—¨å•†å“ï¼šæ¯åˆ†é’Ÿè¢«è®¿é—®10000æ¬¡ â† è¿™å°±æ˜¯çƒ­ç‚¹æ•°æ®

é—®é¢˜ï¼š
â€¢ çƒ­ç‚¹æ•°æ®è®¿é—®é¢‘ç‡è¿œé«˜äºæ™®é€šæ•°æ®
â€¢ å®¹æ˜“æˆä¸ºç³»ç»Ÿç“¶é¢ˆ
â€¢ æ•°æ®åº“å‹åŠ›é›†ä¸­åœ¨å°‘æ•°è®°å½•ä¸Š
```

**ğŸ¯ çƒ­ç‚¹è¯†åˆ«æ–¹æ³•**

```java
// çƒ­ç‚¹æ•°æ®ç›‘æ§å™¨
public class HotDataMonitor {
    private final Map<String, AtomicLong> accessCount = new ConcurrentHashMap<>();
    private final ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();
    
    public HotDataMonitor() {
        // æ¯åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡çƒ­ç‚¹æ•°æ®
        scheduler.scheduleAtFixedRate(this::reportHotData, 1, 1, TimeUnit.MINUTES);
    }
    
    // è®°å½•æ•°æ®è®¿é—®
    public void recordAccess(String dataKey) {
        accessCount.computeIfAbsent(dataKey, k -> new AtomicLong(0))
                   .incrementAndGet();
    }
    
    // è·å–çƒ­ç‚¹æ•°æ®ï¼ˆè®¿é—®æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼‰
    public Set<String> getHotData(int threshold) {
        return accessCount.entrySet().stream()
                .filter(entry -> entry.getValue().get() > threshold)
                .map(Map.Entry::getKey)
                .collect(Collectors.toSet());
    }
    
    private void reportHotData() {
        Set<String> hotKeys = getHotData(100);  // æ¯åˆ†é’Ÿè®¿é—®è¶…è¿‡100æ¬¡çš„æ•°æ®
        System.out.println("çƒ­ç‚¹æ•°æ®ï¼š" + hotKeys);
        
        // æ¸…ç©ºè®¡æ•°å™¨ï¼Œé‡æ–°ç»Ÿè®¡
        accessCount.clear();
    }
}
```

### 7.2 åˆ†ç‰‡ç­–ç•¥


**æ•°æ®åˆ†ç‰‡è§£å†³çƒ­ç‚¹é—®é¢˜**ï¼š

```
çƒ­ç‚¹å•†å“åˆ†ç‰‡ç­–ç•¥ï¼š

åŸå§‹æƒ…å†µï¼š
å•†å“ID: product_123456 â†’ æ•°æ®åº“è¡¨: products
é—®é¢˜ï¼šæ‰€æœ‰å¯¹è¯¥å•†å“çš„è®¿é—®éƒ½é›†ä¸­åœ¨ä¸€æ¡è®°å½•ä¸Š

åˆ†ç‰‡åï¼š
å•†å“ID: product_123456_0 â†’ åº“å­˜ï¼š100
å•†å“ID: product_123456_1 â†’ åº“å­˜ï¼š100  
å•†å“ID: product_123456_2 â†’ åº“å­˜ï¼š100
å•†å“ID: product_123456_3 â†’ åº“å­˜ï¼š100
æ€»åº“å­˜ï¼š400ï¼Œåˆ†æ•£åœ¨4ä¸ªåˆ†ç‰‡ä¸Š

è®¿é—®æ—¶éšæœºé€‰æ‹©åˆ†ç‰‡ï¼š
ç”¨æˆ·Aè®¿é—® â†’ product_123456_2
ç”¨æˆ·Bè®¿é—® â†’ product_123456_1  
ç”¨æˆ·Cè®¿é—® â†’ product_123456_0
ç»“æœï¼šå‹åŠ›åˆ†æ•£åˆ°4ä¸ªåˆ†ç‰‡ï¼Œå•ä¸ªåˆ†ç‰‡å‹åŠ›å‡å°‘75%
```

```java
// çƒ­ç‚¹æ•°æ®åˆ†ç‰‡å¤„ç†
public class HotDataSharding {
    private final int shardCount;
    private final Random random = new Random();
    
    public HotDataSharding(int shardCount) {
        this.shardCount = shardCount;
    }
    
    // è·å–åˆ†ç‰‡key
    public String getShardKey(String originalKey) {
        int shardIndex = random.nextInt(shardCount);
        return originalKey + "_shard_" + shardIndex;
    }
    
    // è·å–æ‰€æœ‰åˆ†ç‰‡key
    public List<String> getAllShardKeys(String originalKey) {
        List<String> shardKeys = new ArrayList<>();
        for (int i = 0; i < shardCount; i++) {
            shardKeys.add(originalKey + "_shard_" + i);
        }
        return shardKeys;
    }
    
    // èšåˆåˆ†ç‰‡æ•°æ®ï¼ˆå¦‚åº“å­˜æ±‚å’Œï¼‰
    public int aggregateShardData(String originalKey) {
        int total = 0;
        for (String shardKey : getAllShardKeys(originalKey)) {
            total += getDataFromCache(shardKey);
        }
        return total;
    }
}
```

### 7.3 é¢„çƒ­ç­–ç•¥


**ç¼“å­˜é¢„çƒ­æœºåˆ¶**ï¼š

```java
// ç¼“å­˜é¢„çƒ­ç®¡ç†å™¨
public class CacheWarmupManager {
    private final RedisTemplate<String, Object> redisTemplate;
    private final ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(5);
    
    // ç³»ç»Ÿå¯åŠ¨æ—¶é¢„çƒ­çƒ­ç‚¹æ•°æ®
    @PostConstruct
    public void warmupOnStartup() {
        scheduler.execute(() -> {
            // é¢„çƒ­å•†å“ä¿¡æ¯
            warmupProductData();
            // é¢„çƒ­ç”¨æˆ·ä¿¡æ¯  
            warmupUserData();
            // é¢„çƒ­é…ç½®ä¿¡æ¯
            warmupConfigData();
        });
    }
    
    private void warmupProductData() {
        // æŸ¥è¯¢çƒ­é—¨å•†å“åˆ—è¡¨
        List<String> hotProducts = getHotProductIds();
        
        for (String productId : hotProducts) {
            try {
                // ä»æ•°æ®åº“åŠ è½½å•†å“ä¿¡æ¯
                Product product = productService.getById(productId);
                
                // å­˜å…¥ç¼“å­˜ï¼Œè®¾ç½®è¾ƒé•¿è¿‡æœŸæ—¶é—´
                String cacheKey = "product:" + productId;
                redisTemplate.opsForValue().set(cacheKey, product, 1, TimeUnit.HOURS);
                
                System.out.println("é¢„çƒ­å•†å“ï¼š" + productId);
                
                // é¿å…æ•°æ®åº“å‹åŠ›è¿‡å¤§
                Thread.sleep(10);
                
            } catch (Exception e) {
                System.err.println("é¢„çƒ­å•†å“å¤±è´¥ï¼š" + productId + ", é”™è¯¯ï¼š" + e.getMessage());
            }
        }
    }
    
    // å®šæœŸé¢„çƒ­ï¼ˆæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
    @Scheduled(fixedRate = 3600000)
    public void scheduledWarmup() {
        warmupOnStartup();
    }
}
```

### 7.4 å°±è¿‘è®¿é—®ç­–ç•¥


**åœ°ç†ä½ç½®å°±è¿‘è®¿é—®**ï¼š

```
CDNå°±è¿‘è®¿é—®ç¤ºä¾‹ï¼š

ç”¨æˆ·åœ°ç†ä½ç½®ï¼šåŒ—äº¬
æ•°æ®ä¸­å¿ƒåˆ†å¸ƒï¼š
â€¢ åŒ—äº¬æœºæˆ¿ï¼šå»¶è¿Ÿ5ms
â€¢ ä¸Šæµ·æœºæˆ¿ï¼šå»¶è¿Ÿ30ms  
â€¢ æ·±åœ³æœºæˆ¿ï¼šå»¶è¿Ÿ50ms
â€¢ ç¾å›½æœºæˆ¿ï¼šå»¶è¿Ÿ200ms

æ™ºèƒ½è·¯ç”±ç­–ç•¥ï¼š
1. æ£€æµ‹ç”¨æˆ·IPåœ°ç†ä½ç½®
2. è®¡ç®—åˆ°å„æœºæˆ¿çš„ç½‘ç»œå»¶è¿Ÿ
3. é€‰æ‹©å»¶è¿Ÿæœ€å°çš„æœºæˆ¿
4. å°†è¯·æ±‚è·¯ç”±åˆ°åŒ—äº¬æœºæˆ¿

ç»“æœï¼šç”¨æˆ·è·å¾—æœ€å¿«çš„å“åº”é€Ÿåº¦
```

```java
// å°±è¿‘è®¿é—®è·¯ç”±å™¨
public class ProximityRouter {
    private final Map<String, DataCenter> dataCenters = new HashMap<>();
    
    static class DataCenter {
        String region;
        String endpoint;
        int latencyMs;
        
        public DataCenter(String region, String endpoint, int latencyMs) {
            this.region = region;
            this.endpoint = endpoint;
            this.latencyMs = latencyMs;
        }
    }
    
    public ProximityRouter() {
        // åˆå§‹åŒ–æ•°æ®ä¸­å¿ƒä¿¡æ¯
        dataCenters.put("beijing", new DataCenter("åŒ—äº¬", "bj.api.com", 5));
        dataCenters.put("shanghai", new DataCenter("ä¸Šæµ·", "sh.api.com", 30));
        dataCenters.put("shenzhen", new DataCenter("æ·±åœ³", "sz.api.com", 50));
    }
    
    // æ ¹æ®ç”¨æˆ·IPé€‰æ‹©æœ€è¿‘çš„æ•°æ®ä¸­å¿ƒ
    public DataCenter selectNearestDataCenter(String userIp) {
        String userRegion = getRegionByIp(userIp);
        
        // ä¼˜å…ˆé€‰æ‹©åŒåœ°åŒºçš„æ•°æ®ä¸­å¿ƒ
        DataCenter localDC = dataCenters.get(userRegion);
        if (localDC != null) {
            return localDC;
        }
        
        // å¦‚æœæ²¡æœ‰æœ¬åœ°æ•°æ®ä¸­å¿ƒï¼Œé€‰æ‹©å»¶è¿Ÿæœ€å°çš„
        return dataCenters.values().stream()
                .min(Comparator.comparingInt(dc -> dc.latencyMs))
                .orElse(dataCenters.get("beijing"));  // é»˜è®¤åŒ—äº¬
    }
    
    private String getRegionByIp(String ip) {
        // å®é™…å®ç°ä¼šæŸ¥è¯¢IPåœ°ç†ä½ç½®æ•°æ®åº“
        // è¿™é‡Œç®€åŒ–å¤„ç†
        if (ip.startsWith("1.")) return "beijing";
        if (ip.startsWith("2.")) return "shanghai";
        return "beijing";  // é»˜è®¤
    }
}
```

---

## 8. âš¡ å¹¶å‘æ€§èƒ½ä¼˜åŒ–


### 8.1 è¿æ¥æ± ä¼˜åŒ–


**æ•°æ®åº“è¿æ¥æ± **ï¼š

```
è¿æ¥æ± çš„ä½œç”¨ï¼ˆé¤å…åŒ…é—´ç±»æ¯”ï¼‰ï¼š

æ²¡æœ‰è¿æ¥æ± ï¼š
å®¢æˆ·æ¥äº† â†’ ç°åœºè£…ä¿®åŒ…é—´ â†’ ç”¨é¤ â†’ æ‹†é™¤åŒ…é—´
é—®é¢˜ï¼šè£…ä¿®å’Œæ‹†é™¤æµªè´¹æ—¶é—´ï¼Œæˆæœ¬é«˜

æœ‰è¿æ¥æ± ï¼š
æå‰å‡†å¤‡å¥½åŒ…é—´ â†’ å®¢æˆ·æ¥äº†ç›´æ¥ç”¨é¤ â†’ ç”¨å®Œå½’è¿˜ç»™ä¸‹ä¸€ä½å®¢æˆ·
ä¼˜åŠ¿ï¼šæ²¡æœ‰è£…ä¿®æ—¶é—´ï¼Œå“åº”å¿«ï¼Œæˆæœ¬ä½
```

```java
// è¿æ¥æ± é…ç½®ä¼˜åŒ–
@Configuration
public class DataSourceConfig {
    
    @Bean
    public DataSource dataSource() {
        HikariConfig config = new HikariConfig();
        
        // åŸºæœ¬è¿æ¥ä¿¡æ¯
        config.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        config.setUsername("user");
        config.setPassword("password");
        
        // è¿æ¥æ± ä¼˜åŒ–é…ç½®
        config.setMinimumIdle(10);              // æœ€å°ç©ºé—²è¿æ¥æ•°
        config.setMaximumPoolSize(50);          // æœ€å¤§è¿æ¥æ•°
        config.setConnectionTimeout(30000);     // è¿æ¥è¶…æ—¶30ç§’
        config.setIdleTimeout(600000);          // ç©ºé—²è¿æ¥10åˆ†é’Ÿåå›æ”¶
        config.setMaxLifetime(1800000);         // è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´30åˆ†é’Ÿ
        config.setLeakDetectionThreshold(60000); // è¿æ¥æ³„æ¼æ£€æµ‹1åˆ†é’Ÿ
        
        // æ€§èƒ½ä¼˜åŒ–é…ç½®
        config.setCachePrepStmts(true);         // ç¼“å­˜é¢„ç¼–è¯‘è¯­å¥
        config.setPrepStmtCacheSize(250);       // é¢„ç¼–è¯‘è¯­å¥ç¼“å­˜å¤§å°
        config.setPrepStmtCacheSqlLimit(2048);  // é¢„ç¼–è¯‘è¯­å¥æœ€å¤§é•¿åº¦
        
        return new HikariDataSource(config);
    }
}
```

### 8.2 çº¿ç¨‹æ± ç®¡ç†


**çº¿ç¨‹æ± æœ€ä½³å®è·µ**ï¼š

```java
// çº¿ç¨‹æ± ç®¡ç†å™¨
@Component
public class ThreadPoolManager {
    
    // å¿«é€Ÿå“åº”ä»»åŠ¡æ± ï¼ˆå¦‚Webè¯·æ±‚å¤„ç†ï¼‰
    @Bean("fastPool")
    public ThreadPoolExecutor fastResponsePool() {
        return new ThreadPoolExecutor(
            20,                                    // æ ¸å¿ƒçº¿ç¨‹æ•°
            50,                                    // æœ€å¤§çº¿ç¨‹æ•°
            60L, TimeUnit.SECONDS,                 // å­˜æ´»æ—¶é—´
            new SynchronousQueue<>(),              // æ— ç¼“å†²é˜Ÿåˆ—ï¼Œç«‹å³æ‰§è¡Œ
            new ThreadFactory() {
                private final AtomicInteger threadNumber = new AtomicInteger(1);
                public Thread newThread(Runnable r) {
                    Thread t = new Thread(r, "fast-pool-" + threadNumber.getAndIncrement());
                    t.setDaemon(false);
                    return t;
                }
            },
            new ThreadPoolExecutor.CallerRunsPolicy()  // æ‹’ç»ç­–ç•¥ï¼šè°ƒç”¨è€…æ‰§è¡Œ
        );
    }
    
    // æ‰¹é‡å¤„ç†ä»»åŠ¡æ± ï¼ˆå¦‚æ•°æ®å¤„ç†ï¼‰
    @Bean("batchPool")
    public ThreadPoolExecutor batchProcessPool() {
        return new ThreadPoolExecutor(
            5,                                     // æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆè¾ƒå°‘ï¼‰
            20,                                    // æœ€å¤§çº¿ç¨‹æ•°
            300L, TimeUnit.SECONDS,                // è¾ƒé•¿å­˜æ´»æ—¶é—´
            new LinkedBlockingQueue<>(1000),       // å¤§å®¹é‡é˜Ÿåˆ—
            r -> new Thread(r, "batch-pool-" + System.currentTimeMillis()),
            new ThreadPoolExecutor.AbortPolicy()   // æ‹’ç»ç­–ç•¥ï¼šæŠ›å‡ºå¼‚å¸¸
        );
    }
    
    // ç›‘æ§çº¿ç¨‹æ± çŠ¶æ€
    @Scheduled(fixedRate = 30000)  // æ¯30ç§’ç›‘æ§ä¸€æ¬¡
    public void monitorThreadPools() {
        monitorPool("fastPool", fastResponsePool());
        monitorPool("batchPool", batchProcessPool());
    }
    
    private void monitorPool(String poolName, ThreadPoolExecutor pool) {
        System.out.printf("%sçŠ¶æ€ - æ´»è·ƒçº¿ç¨‹:%d, é˜Ÿåˆ—ä»»åŠ¡:%d, å®Œæˆä»»åŠ¡:%d%n",
            poolName, 
            pool.getActiveCount(),
            pool.getQueue().size(),
            pool.getCompletedTaskCount()
        );
        
        // å‘Šè­¦ï¼šé˜Ÿåˆ—å †ç§¯è¿‡å¤š
        if (pool.getQueue().size() > 500) {
            System.err.println("è­¦å‘Šï¼š" + poolName + "ä»»åŠ¡é˜Ÿåˆ—å †ç§¯ä¸¥é‡ï¼");
        }
        
        // å‘Šè­¦ï¼šçº¿ç¨‹ä½¿ç”¨ç‡è¿‡é«˜
        if (pool.getActiveCount() > pool.getCorePoolSize() * 0.8) {
            System.err.println("è­¦å‘Šï¼š" + poolName + "çº¿ç¨‹ä½¿ç”¨ç‡è¿‡é«˜ï¼");
        }
    }
}
```

### 8.3 æ— é”æ•°æ®ç»“æ„åº”ç”¨


**é«˜å¹¶å‘è®¡æ•°å™¨**ï¼š

```java
// é«˜æ€§èƒ½è®¡æ•°å™¨æœåŠ¡
@Service
public class HighPerformanceCounterService {
    
    // ä½¿ç”¨æ— é”è®¡æ•°å™¨æ›¿ä»£synchronized
    private final Map<String, AtomicLong> counters = new ConcurrentHashMap<>();
    
    // å¢åŠ è®¡æ•°
    public long increment(String key) {
        return counters.computeIfAbsent(key, k -> new AtomicLong(0))
                      .incrementAndGet();
    }
    
    // å¢åŠ æŒ‡å®šæ•°é‡
    public long addAndGet(String key, long delta) {
        return counters.computeIfAbsent(key, k -> new AtomicLong(0))
                      .addAndGet(delta);
    }
    
    // è·å–å½“å‰å€¼
    public long get(String key) {
        AtomicLong counter = counters.get(key);
        return counter != null ? counter.get() : 0L;
    }
    
    // æ‰¹é‡è·å–è®¡æ•°ï¼ˆé¿å…å¤šæ¬¡mapæŸ¥æ‰¾ï¼‰
    public Map<String, Long> batchGet(Collection<String> keys) {
        Map<String, Long> results = new HashMap<>();
        
        for (String key : keys) {
            AtomicLong counter = counters.get(key);
            results.put(key, counter != null ? counter.get() : 0L);
        }
        
        return results;
    }
    
    // å®šæœŸæŒä¹…åŒ–è®¡æ•°æ•°æ®
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’ŸæŒä¹…åŒ–ä¸€æ¬¡
    public void persistCounters() {
        Map<String, Long> snapshot = new HashMap<>();
        
        // è·å–å½“å‰æ‰€æœ‰è®¡æ•°çš„å¿«ç…§
        counters.forEach((key, atomicValue) -> {
            snapshot.put(key, atomicValue.get());
        });
        
        // å¼‚æ­¥æŒä¹…åŒ–åˆ°æ•°æ®åº“
        CompletableFuture.runAsync(() -> {
            saveCountersToDatabase(snapshot);
        });
    }
    
    private void saveCountersToDatabase(Map<String, Long> snapshot) {
        // æ‰¹é‡æ›´æ–°æ•°æ®åº“
        // å®é™…å®ç°ä¼šä½¿ç”¨æ‰¹é‡SQLæ“ä½œ
    }
}
```

---

## 9. ğŸ”„ å¼‚æ­¥å¤„ç†æ€ç»´


### 9.1 å¼‚æ­¥è°ƒç”¨çš„åŸºæœ¬æ¦‚å¿µ


**åŒæ­¥vså¼‚æ­¥**ï¼ˆå¿«é€’é…é€ç±»æ¯”ï¼‰ï¼š

```
åŒæ­¥è°ƒç”¨ï¼ˆäº²è‡ªå–å¿«é€’ï¼‰ï¼š
ä¸‹å• â†’ ç­‰å¾…åˆ¶ä½œ â†’ ç­‰å¾…é…é€ â†’ äº²è‡ªå»å– â†’ å®Œæˆ
ç‰¹ç‚¹ï¼šæ¯ä¸ªæ­¥éª¤éƒ½è¦ç­‰å¾…ï¼Œæ€»æ—¶é—´å¾ˆé•¿

å¼‚æ­¥è°ƒç”¨ï¼ˆå¿«é€’é€è´§ä¸Šé—¨ï¼‰ï¼š
ä¸‹å• â†’ ç«‹å³è¿”å›è®¢å•å· â†’ ç»§ç»­åšå…¶ä»–äº‹
åˆ¶ä½œå’Œé…é€åœ¨åå°è¿›è¡Œï¼Œå®Œæˆåé€šçŸ¥ä½ 
ç‰¹ç‚¹ï¼šä¸ç”¨ç­‰å¾…ï¼Œå¯ä»¥åŒæ—¶åšå…¶ä»–äº‹æƒ…
```

### 9.2 å¼‚æ­¥æ‰§è¡Œå®ç°


```java
// å¼‚æ­¥æœåŠ¡ç¤ºä¾‹
@Service
public class AsyncProcessingService {
    
    // å¼‚æ­¥æ‰§è¡Œè€—æ—¶æ“ä½œ
    @Async("taskPool")
    public CompletableFuture<String> processLongRunningTask(String data) {
        try {
            // æ¨¡æ‹Ÿè€—æ—¶å¤„ç†ï¼ˆå¦‚è°ƒç”¨å¤–éƒ¨APIã€å¤æ‚è®¡ç®—ç­‰ï¼‰
            Thread.sleep(5000);
            
            String result = "å¤„ç†å®Œæˆï¼š" + data;
            return CompletableFuture.completedFuture(result);
            
        } catch (InterruptedException e) {
            return CompletableFuture.failedFuture(e);
        }
    }
    
    // æ‰¹é‡å¼‚æ­¥å¤„ç†
    public CompletableFuture<List<String>> processBatch(List<String> dataList) {
        List<CompletableFuture<String>> futures = dataList.stream()
            .map(this::processLongRunningTask)
            .collect(Collectors.toList());
        
        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        CompletableFuture<Void> allOf = CompletableFuture.allOf(
            futures.toArray(new CompletableFuture[0])
        );
        
        // æ”¶é›†æ‰€æœ‰ç»“æœ
        return allOf.thenApply(v -> 
            futures.stream()
                   .map(CompletableFuture::join)
                   .collect(Collectors.toList())
        );
    }
}

// æ§åˆ¶å™¨ä¸­çš„ä½¿ç”¨
@RestController
public class AsyncController {
    
    @Autowired
    private AsyncProcessingService asyncService;
    
    // å¼‚æ­¥æ¥å£
    @PostMapping("/async-process")
    public ResponseEntity<String> startAsyncProcess(@RequestBody String data) {
        // ç«‹å³è¿”å›ä»»åŠ¡IDï¼Œä¸ç­‰å¾…å¤„ç†å®Œæˆ
        String taskId = UUID.randomUUID().toString();
        
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
        asyncService.processLongRunningTask(data)
                   .thenAccept(result -> {
                       // å¤„ç†å®Œæˆåçš„å›è°ƒæ“ä½œ
                       notifyTaskComplete(taskId, result);
                   });
        
        return ResponseEntity.ok("ä»»åŠ¡å·²å¯åŠ¨ï¼Œä»»åŠ¡IDï¼š" + taskId);
    }
    
    private void notifyTaskComplete(String taskId, String result) {
        // ä»»åŠ¡å®Œæˆé€šçŸ¥ï¼ˆå¦‚å‘é€é‚®ä»¶ã€æ›´æ–°æ•°æ®åº“ã€æ¨é€æ¶ˆæ¯ç­‰ï¼‰
        System.out.println("ä»»åŠ¡å®Œæˆé€šçŸ¥ - ID: " + taskId + ", ç»“æœ: " + result);
    }
}
```

### 9.3 æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦


**æ¶ˆæ¯é˜Ÿåˆ—çš„ä½œç”¨**ï¼ˆé‚®å±€ç±»æ¯”ï¼‰ï¼š

```
ç›´æ¥é€šä¿¡ï¼ˆé¢å¯¹é¢äº¤æµï¼‰ï¼š
å‘é€è€… â€”â€”ç›´æ¥ä¼ é€’â€”â€”> æ¥æ”¶è€…
é—®é¢˜ï¼š
â€¢ æ¥æ”¶è€…ä¸åœ¨çº¿ï¼Œæ¶ˆæ¯ä¸¢å¤±
â€¢ å‘é€è€…éœ€è¦ç­‰å¾…æ¥æ”¶è€…å¤„ç†å®Œæˆ
â€¢ ä¸¤è€…ç´§å¯†è€¦åˆï¼Œä¸€ä¸ªå‡ºé—®é¢˜å½±å“å¦ä¸€ä¸ª

æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆé‚®å±€ç³»ç»Ÿï¼‰ï¼š
å‘é€è€… â€”â€”æŠ•é€’åˆ°é‚®å±€â€”â€”> é‚®å±€ â€”â€”æ´¾é€â€”â€”> æ¥æ”¶è€…
ä¼˜åŠ¿ï¼š
â€¢ æ¥æ”¶è€…ä¸åœ¨çº¿ï¼Œé‚®å±€ä¿å­˜æ¶ˆæ¯
â€¢ å‘é€è€…æŠ•é€’åç«‹å³è¿”å›ï¼Œæ— éœ€ç­‰å¾…
â€¢ å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ï¼Œç‹¬ç«‹å·¥ä½œ
```

```java
// æ¶ˆæ¯ç”Ÿäº§è€…
@Component
public class MessageProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    // å‘é€è®¢å•å¤„ç†æ¶ˆæ¯
    public void sendOrderMessage(Order order) {
        OrderMessage message = new OrderMessage();
        message.setOrderId(order.getId());
        message.setUserId(order.getUserId());
        message.setAmount(order.getAmount());
        message.setCreateTime(System.currentTimeMillis());
        
        // å‘é€åˆ°è®¢å•å¤„ç†é˜Ÿåˆ—
        rabbitTemplate.convertAndSend("order.exchange", "order.created", message);
        
        System.out.println("è®¢å•æ¶ˆæ¯å·²å‘é€ï¼š" + order.getId());
    }
    
    // å‘é€é‚®ä»¶é€šçŸ¥æ¶ˆæ¯
    public void sendEmailMessage(String email, String subject, String content) {
        EmailMessage message = new EmailMessage(email, subject, content);
        
        // å‘é€åˆ°é‚®ä»¶é˜Ÿåˆ—
        rabbitTemplate.convertAndSend("email.queue", message);
        
        System.out.println("é‚®ä»¶æ¶ˆæ¯å·²å‘é€ï¼š" + email);
    }
}

// æ¶ˆæ¯æ¶ˆè´¹è€…
@Component
public class MessageConsumer {
    
    // å¤„ç†è®¢å•æ¶ˆæ¯
    @RabbitListener(queues = "order.queue")
    public void handleOrderMessage(OrderMessage message) {
        try {
            // è®¢å•å¤„ç†ä¸šåŠ¡é€»è¾‘
            processOrder(message.getOrderId());
            
            // å‘é€åº“å­˜æ‰£å‡æ¶ˆæ¯
            sendInventoryMessage(message.getOrderId());
            
            // å‘é€æ”¯ä»˜æ¶ˆæ¯
            sendPaymentMessage(message);
            
            System.out.println("è®¢å•å¤„ç†å®Œæˆï¼š" + message.getOrderId());
            
        } catch (Exception e) {
            System.err.println("è®¢å•å¤„ç†å¤±è´¥ï¼š" + message.getOrderId() + ", é”™è¯¯ï¼š" + e.getMessage());
            // å¯ä»¥é‡æ–°æ”¾å…¥é˜Ÿåˆ—é‡è¯•ï¼Œæˆ–è€…æ”¾å…¥æ­»ä¿¡é˜Ÿåˆ—
        }
    }
    
    // å¤„ç†é‚®ä»¶æ¶ˆæ¯
    @RabbitListener(queues = "email.queue")
    public void handleEmailMessage(EmailMessage message) {
        try {
            // å‘é€é‚®ä»¶
            emailService.sendEmail(message.getEmail(), message.getSubject(), message.getContent());
            
            System.out.println("é‚®ä»¶å‘é€æˆåŠŸï¼š" + message.getEmail());
            
        } catch (Exception e) {
            System.err.println("é‚®ä»¶å‘é€å¤±è´¥ï¼š" + message.getEmail() + ", é”™è¯¯ï¼š" + e.getMessage());
        }
    }
}
```

### 9.4 å›è°ƒå¤„ç†æ–¹å¼


**å›è°ƒæ¨¡å¼å®ç°**ï¼š

```java
// å›è°ƒæ¥å£å®šä¹‰
public interface ProcessCallback<T> {
    void onSuccess(T result);           // æˆåŠŸå›è°ƒ
    void onFailure(Exception error);    // å¤±è´¥å›è°ƒ
    void onProgress(int progress);      // è¿›åº¦å›è°ƒï¼ˆå¯é€‰ï¼‰
}

// å¼‚æ­¥å¤„ç†å™¨
public class AsyncProcessor {
    private final ExecutorService executor = Executors.newFixedThreadPool(10);
    
    // å¼‚æ­¥å¤„ç†æ–‡ä»¶ä¸Šä¼ 
    public void processFileUpload(MultipartFile file, ProcessCallback<String> callback) {
        executor.submit(() -> {
            try {
                // æ­¥éª¤1ï¼šä¿å­˜æ–‡ä»¶
                callback.onProgress(25);
                String filePath = saveFile(file);
                
                // æ­¥éª¤2ï¼šç—…æ¯’æ‰«æ
                callback.onProgress(50);
                scanVirus(filePath);
                
                // æ­¥éª¤3ï¼šç”Ÿæˆç¼©ç•¥å›¾
                callback.onProgress(75);
                generateThumbnail(filePath);
                
                // æ­¥éª¤4ï¼šå®Œæˆå¤„ç†
                callback.onProgress(100);
                callback.onSuccess(filePath);
                
            } catch (Exception e) {
                callback.onFailure(e);
            }
        });
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public void uploadExample() {
        MultipartFile file = getUploadedFile();
        
        processFileUpload(file, new ProcessCallback<String>() {
            @Override
            public void onSuccess(String filePath) {
                System.out.println("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼š" + filePath);
                // æ›´æ–°æ•°æ®åº“ã€å‘é€é€šçŸ¥ç­‰
            }
            
            @Override
            public void onFailure(Exception error) {
                System.err.println("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š" + error.getMessage());
                // æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€è®°å½•é”™è¯¯æ—¥å¿—ç­‰
            }
            
            @Override
            public void onProgress(int progress) {
                System.out.println("ä¸Šä¼ è¿›åº¦ï¼š" + progress + "%");
                // æ›´æ–°å‰ç«¯è¿›åº¦æ¡
            }
        });
        
        System.out.println("æ–‡ä»¶ä¸Šä¼ å·²å¯åŠ¨ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œ...");
    }
}
```

---

## 10. ğŸ›¡ï¸ é™æµæ§åˆ¶æ€ç»´


### 10.1 é™æµçš„åŸºæœ¬æ¦‚å¿µ


**é™æµçš„ä½œç”¨**ï¼ˆé«˜é€Ÿå…¬è·¯æ”¶è´¹ç«™ç±»æ¯”ï¼‰ï¼š

```
æ²¡æœ‰é™æµï¼ˆæ— æ”¶è´¹ç«™ï¼‰ï¼š
æ‰€æœ‰è½¦è¾†åŒæ—¶æ¶Œå…¥é«˜é€Ÿå…¬è·¯
ç»“æœï¼šäº¤é€šå µå¡ï¼Œæ•´ä¸ªç³»ç»Ÿç˜«ç—ª

æœ‰é™æµï¼ˆæ”¶è´¹ç«™æ§åˆ¶ï¼‰ï¼š
è®¾ç½®æ”¶è´¹ç«™ï¼Œæ§åˆ¶è½¦è¾†è¿›å…¥é€Ÿåº¦
æ¯ç§’åªå…è®¸ä¸€å®šæ•°é‡çš„è½¦è¾†é€šè¿‡
ç»“æœï¼šè™½ç„¶æœ‰æ’é˜Ÿï¼Œä½†æ•´ä½“æµç•…

ç³»ç»Ÿé™æµåŒç†ï¼š
â€¢ æ§åˆ¶è¯·æ±‚çš„è¿›å…¥é€Ÿåº¦
â€¢ ä¿æŠ¤ç³»ç»Ÿä¸è¢«å‹å®
â€¢ ä¿è¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿è¡Œ
```

### 10.2 æ¥å£é™æµå®ç°


```java
// æ¥å£é™æµæ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RateLimit {
    int limit() default 100;        // æ¯ç§’æœ€å¤§è¯·æ±‚æ•°
    int window() default 1;         // æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
    String key() default "";        // é™æµkeyï¼ˆé»˜è®¤ä½¿ç”¨æ–¹æ³•åï¼‰
    String message() default "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•";
}

// é™æµæ‹¦æˆªå™¨
@Component
public class RateLimitInterceptor {
    private final RedisTemplate<String, String> redisTemplate;
    
    // æ»‘åŠ¨çª—å£é™æµç®—æ³•
    public boolean isAllowed(String key, int limit, int windowSeconds) {
        long currentTime = System.currentTimeMillis();
        long windowStart = currentTime - windowSeconds * 1000L;
        
        // æ¸…ç†è¿‡æœŸçš„è®°å½•
        redisTemplate.opsForZSet().removeRangeByScore(key, 0, windowStart);
        
        // è·å–å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°
        Long currentCount = redisTemplate.opsForZSet().count(key, windowStart, currentTime);
        
        if (currentCount < limit) {
            // è®°å½•å½“å‰è¯·æ±‚
            redisTemplate.opsForZSet().add(key, UUID.randomUUID().toString(), currentTime);
            redisTemplate.expire(key, windowSeconds, TimeUnit.SECONDS);
            return true;
        }
        
        return false;
    }
    
    // ä»¤ç‰Œæ¡¶é™æµç®—æ³•
    public boolean isAllowedByTokenBucket(String key, int limit, int refillRate) {
        String script = 
            "local key = KEYS[1] " +
            "local limit = tonumber(ARGV[1]) " +
            "local refillRate = tonumber(ARGV[2]) " +
            "local now = tonumber(ARGV[3]) " +
            
            "local bucket = redis.call('HMGET', key, 'tokens', 'lastRefill') " +
            "local tokens = tonumber(bucket[1]) or limit " +
            "local lastRefill = tonumber(bucket[2]) or now " +
            
            "-- è®¡ç®—éœ€è¦è¡¥å……çš„ä»¤ç‰Œæ•° " +
            "local tokensToAdd = math.floor((now - lastRefill) / 1000 * refillRate) " +
            "tokens = math.min(limit, tokens + tokensToAdd) " +
            
            "if tokens >= 1 then " +
                "tokens = tokens - 1 " +
                "redis.call('HMSET', key, 'tokens', tokens, 'lastRefill', now) " +
                "redis.call('EXPIRE', key, 3600) " +
                "return 1 " +
            "else " +
                "redis.call('HMSET', key, 'tokens', tokens, 'lastRefill', now) " +
                "redis.call('EXPIRE', key, 3600) " +
                "return 0 " +
            "end";
        
        Long result = redisTemplate.execute(new DefaultRedisScript<>(script, Long.class), 
                                          Collections.singletonList(key),
                                          String.valueOf(limit),
                                          String.valueOf(refillRate),
                                          String.valueOf(System.currentTimeMillis()));
        
        return result != null && result == 1L;
    }
}

// ä½¿ç”¨é™æµçš„æ§åˆ¶å™¨
@RestController
public class ApiController {
    
    // æ™®é€šæ¥å£é™æµï¼šæ¯ç§’æœ€å¤š100ä¸ªè¯·æ±‚
    @RateLimit(limit = 100)
    @GetMapping("/api/data")
    public ResponseEntity<String> getData() {
        return ResponseEntity.ok("æ•°æ®è·å–æˆåŠŸ");
    }
    
    // æ•æ„Ÿæ¥å£é™æµï¼šæ¯ç§’æœ€å¤š10ä¸ªè¯·æ±‚
    @RateLimit(limit = 10, message = "ç™»å½•è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•")
    @PostMapping("/api/login")
    public ResponseEntity<String> login(@RequestBody LoginRequest request) {
        // ç™»å½•é€»è¾‘
        return ResponseEntity.ok("ç™»å½•æˆåŠŸ");
    }
    
    // ä¸‹è½½æ¥å£é™æµï¼šæ¯ç§’æœ€å¤š5ä¸ªè¯·æ±‚
    @RateLimit(limit = 5, window = 1, message = "ä¸‹è½½è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•")
    @GetMapping("/api/download")
    public ResponseEntity<Resource> downloadFile() {
        // æ–‡ä»¶ä¸‹è½½é€»è¾‘
        return ResponseEntity.ok().build();
    }
}
```

### 10.3 ç”¨æˆ·é™æµç­–ç•¥


```java
// ç”¨æˆ·çº§åˆ«é™æµ
@Service
public class UserRateLimitService {
    private final RedisTemplate<String, String> redisTemplate;
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¶…è¿‡é™åˆ¶
    public boolean checkUserLimit(String userId, String action, int limit, int windowMinutes) {
        String key = String.format("user_limit:%s:%s", userId, action);
        return isAllowedInWindow(key, limit, windowMinutes * 60);
    }
    
    // ä¸åŒç”¨æˆ·ç­‰çº§çš„é™æµç­–ç•¥
    public boolean checkUserLimitByLevel(String userId, String action) {
        UserLevel level = getUserLevel(userId);
        
        switch (level) {
            case VIP:
                return checkUserLimit(userId, action, 1000, 1);  // VIPç”¨æˆ·ï¼šæ¯åˆ†é’Ÿ1000æ¬¡
            case PREMIUM:
                return checkUserLimit(userId, action, 500, 1);   // é«˜çº§ç”¨æˆ·ï¼šæ¯åˆ†é’Ÿ500æ¬¡
            case NORMAL:
                return checkUserLimit(userId, action, 100, 1);   // æ™®é€šç”¨æˆ·ï¼šæ¯åˆ†é’Ÿ100æ¬¡
            case BASIC:
                return checkUserLimit(userId, action, 50, 1);    // åŸºç¡€ç”¨æˆ·ï¼šæ¯åˆ†é’Ÿ50æ¬¡
            default:
                return checkUserLimit(userId, action, 10, 1);    // æœªè®¤è¯ç”¨æˆ·ï¼šæ¯åˆ†é’Ÿ10æ¬¡
        }
    }
    
    // ç”¨æˆ·è¡Œä¸ºé™æµï¼ˆé˜²æ­¢æ¶æ„æ“ä½œï¼‰
    public void limitUserActions(String userId) {
        Map<String, Integer> actionLimits = Map.of(
            "search", 200,        // æœç´¢ï¼šæ¯åˆ†é’Ÿ200æ¬¡
            "comment", 10,        // è¯„è®ºï¼šæ¯åˆ†é’Ÿ10æ¬¡
            "upload", 5,          // ä¸Šä¼ ï¼šæ¯åˆ†é’Ÿ5æ¬¡
            "download", 20,       // ä¸‹è½½ï¼šæ¯åˆ†é’Ÿ20æ¬¡
            "login_attempt", 5    // ç™»å½•å°è¯•ï¼šæ¯åˆ†é’Ÿ5æ¬¡
        );
        
        actionLimits.forEach((action, limit) -> {
            String key = String.format("user_action:%s:%s", userId, action);
            
            if (!isAllowedInWindow(key, limit, 60)) {
                throw new RateLimitException("ç”¨æˆ·æ“ä½œè¿‡äºé¢‘ç¹ï¼š" + action);
            }
        });
    }
    
    private boolean isAllowedInWindow(String key, int limit, int windowSeconds) {
        // å®ç°å…·ä½“çš„é™æµé€»è¾‘ï¼ˆå¯ä»¥å¤ç”¨ä¹‹å‰çš„æ–¹æ³•ï¼‰
        return true;
    }
}
```

### 10.4 ç³»ç»Ÿä¿æŠ¤æœºåˆ¶


```java
// ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤
@Component
public class SystemProtector {
    
    private volatile boolean systemOverloaded = false;
    private final AtomicLong requestCount = new AtomicLong(0);
    private final AtomicLong successCount = new AtomicLong(0);
    
    // ç³»ç»Ÿè´Ÿè½½ç›‘æ§
    @Scheduled(fixedRate = 5000)  // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
    public void monitorSystemLoad() {
        // 1. CPUä½¿ç”¨ç‡æ£€æŸ¥
        double cpuUsage = getCpuUsage();
        
        // 2. å†…å­˜ä½¿ç”¨ç‡æ£€æŸ¥
        double memoryUsage = getMemoryUsage();
        
        // 3. å“åº”æ—¶é—´æ£€æŸ¥
        double avgResponseTime = getAverageResponseTime();
        
        // 4. æˆåŠŸç‡æ£€æŸ¥
        double successRate = calculateSuccessRate();
        
        // ç³»ç»Ÿä¿æŠ¤åˆ¤æ–­
        boolean shouldProtect = cpuUsage > 80.0          // CPUè¶…è¿‡80%
                             || memoryUsage > 85.0        // å†…å­˜è¶…è¿‡85%  
                             || avgResponseTime > 1000    // å“åº”æ—¶é—´è¶…è¿‡1ç§’
                             || successRate < 0.95;       // æˆåŠŸç‡ä½äº95%
        
        if (shouldProtect != systemOverloaded) {
            systemOverloaded = shouldProtect;
            
            if (systemOverloaded) {
                System.err.println("âš ï¸ ç³»ç»Ÿä¿æŠ¤æ¨¡å¼å·²å¯åŠ¨ï¼");
                activateProtectionMode();
            } else {
                System.out.println("âœ… ç³»ç»Ÿä¿æŠ¤æ¨¡å¼å·²å…³é—­");
                deactivateProtectionMode();
            }
        }
    }
    
    // å¯åŠ¨ä¿æŠ¤æ¨¡å¼
    private void activateProtectionMode() {
        // 1. é™ä½æ¥å£é™æµé˜ˆå€¼
        reduceRateLimits();
        
        // 2. æ‹’ç»éæ ¸å¿ƒæ¥å£è¯·æ±‚
        blockNonEssentialApis();
        
        // 3. å¯ç”¨å¿«é€Ÿå¤±è´¥æ¨¡å¼
        enableFailFast();
        
        // 4. å‘é€å‘Šè­¦é€šçŸ¥
        sendAlert("ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œå·²å¯åŠ¨ä¿æŠ¤æ¨¡å¼");
    }
    
    // å…³é—­ä¿æŠ¤æ¨¡å¼
    private void deactivateProtectionMode() {
        // æ¢å¤æ­£å¸¸é…ç½®
        restoreNormalLimits();
        enableAllApis();
        disableFailFast();
    }
    
    // è¯·æ±‚æ‹¦æˆªæ£€æŸ¥
    public boolean shouldRejectRequest(String path, String userId) {
        if (!systemOverloaded) {
            recordRequest(true);
            return false;  // ç³»ç»Ÿæ­£å¸¸ï¼Œå…è®¸è¯·æ±‚
        }
        
        // ç³»ç»Ÿä¿æŠ¤æ¨¡å¼ä¸‹çš„ç­–ç•¥
        
        // 1. ä¼˜å…ˆä¿æŠ¤æ ¸å¿ƒåŠŸèƒ½
        if (isCoreApi(path)) {
            recordRequest(true);
            return false;  // æ ¸å¿ƒæ¥å£ä¼˜å…ˆå¤„ç†
        }
        
        // 2. VIPç”¨æˆ·ä¼˜å…ˆé€šè¡Œ
        if (isVipUser(userId)) {
            recordRequest(true);
            return false;  // VIPç”¨æˆ·ä¼˜å…ˆ
        }
        
        // 3. éšæœºä¸¢å¼ƒéƒ¨åˆ†è¯·æ±‚ï¼ˆä¿æŒéƒ¨åˆ†æœåŠ¡èƒ½åŠ›ï¼‰
        if (Math.random() < 0.7) {  // 70%çš„æ¦‚ç‡æ‹’ç»
            recordRequest(false);
            return true;
        }
        
        recordRequest(true);
        return false;
    }
    
    private boolean isCoreApi(String path) {
        // å®šä¹‰æ ¸å¿ƒæ¥å£åˆ—è¡¨
        List<String> coreApis = Arrays.asList(
            "/api/user/profile",    // ç”¨æˆ·ä¿¡æ¯
            "/api/order/create",    // è®¢å•åˆ›å»º
            "/api/payment/pay"      // æ”¯ä»˜æ¥å£
        );
        
        return coreApis.stream().anyMatch(path::startsWith);
    }
    
    private void recordRequest(boolean success) {
        requestCount.incrementAndGet();
        if (success) {
            successCount.incrementAndGet();
        }
    }
    
    private double calculateSuccessRate() {
        long total = requestCount.get();
        long success = successCount.get();
        
        if (total == 0) return 1.0;
        return (double) success / total;
    }
    
    // è·å–ç³»ç»ŸæŒ‡æ ‡çš„æ–¹æ³•ï¼ˆç®€åŒ–å®ç°ï¼‰
    private double getCpuUsage() {
        return ManagementFactory.getOperatingSystemMXBean().getProcessCpuLoad() * 100;
    }
    
    private double getMemoryUsage() {
        MemoryMXBean memoryBean = ManagementFactory.getMemoryMXBean();
        long used = memoryBean.getHeapMemoryUsage().getUsed();
        long max = memoryBean.getHeapMemoryUsage().getMax();
        return (double) used / max * 100;
    }
}
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¹¶å‘ä¼˜åŒ–æœ¬è´¨ï¼šé€šè¿‡åˆç†çš„å¹¶è¡Œå¤„ç†æå‡ç³»ç»Ÿæ€§èƒ½å’Œååé‡
ğŸ”¸ çº¿ç¨‹æ± é…ç½®ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹ï¼ˆCPUå¯†é›†å‹vs IOå¯†é›†å‹ï¼‰é€‰æ‹©åˆé€‚å‚æ•°
ğŸ”¸ æ‰¹é‡å¤„ç†ç­–ç•¥ï¼šé€šè¿‡æ‰¹é‡æ“ä½œå‡å°‘IOæ¬¡æ•°ï¼Œæå‡å¤„ç†æ•ˆç‡
ğŸ”¸ æµæ°´çº¿å¤„ç†ï¼šå°†å¤æ‚ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªé˜¶æ®µï¼Œå®ç°å¹¶è¡Œæµæ°´çº¿
ğŸ”¸ æ— é”æ•°æ®ç»“æ„ï¼šä½¿ç”¨CASæœºåˆ¶é¿å…é”ç«äº‰ï¼Œæå‡å¹¶å‘æ€§èƒ½
ğŸ”¸ çƒ­ç‚¹æ•°æ®ä¼˜åŒ–ï¼šé€šè¿‡åˆ†ç‰‡ã€é¢„çƒ­ã€å°±è¿‘è®¿é—®è§£å†³çƒ­ç‚¹é—®é¢˜
ğŸ”¸ å¼‚æ­¥å¤„ç†æ€ç»´ï¼šè€—æ—¶æ“ä½œå¼‚æ­¥åŒ–ï¼Œæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦
ğŸ”¸ é™æµæ§åˆ¶ï¼šé€šè¿‡é™æµæœºåˆ¶ä¿æŠ¤ç³»ç»Ÿï¼Œé¿å…è¿‡è½½å´©æºƒ
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¹¶å‘ä¼˜åŒ–çš„æ ¸å¿ƒåŸåˆ™**
```
åˆ†è€Œæ²»ä¹‹ï¼š
â€¢ å°†å¤§ä»»åŠ¡åˆ†è§£æˆå°ä»»åŠ¡å¹¶è¡Œå¤„ç†
â€¢ æ¯ä¸ªçº¿ç¨‹è´Ÿè´£è‡ªå·±çš„å·¥ä½œï¼Œå‡å°‘ä¾èµ–

å‡å°‘ç­‰å¾…ï¼š
â€¢ å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
â€¢ æ‰¹é‡å¤„ç†å‡å°‘IOå¼€é”€
â€¢ ç¼“å­˜çƒ­ç‚¹æ•°æ®å‡å°‘é‡å¤è®¡ç®—

é¿å…ç«äº‰ï¼š
â€¢ ä½¿ç”¨æ— é”æ•°æ®ç»“æ„
â€¢ åˆç†è®¾è®¡å…±äº«èµ„æºçš„è®¿é—®æ–¹å¼
â€¢ åˆ†ç‰‡æŠ€æœ¯åˆ†æ•£è®¿é—®å‹åŠ›

ä¿æŠ¤ç³»ç»Ÿï¼š
â€¢ é™æµé˜²æ­¢ç³»ç»Ÿè¿‡è½½
â€¢ ç†”æ–­å™¨å¿«é€Ÿå¤±è´¥
â€¢ é™çº§ä¿è¯æ ¸å¿ƒåŠŸèƒ½
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å±‚æ¬¡ç»“æ„**
```
åº”ç”¨å±‚ä¼˜åŒ–ï¼š
â€¢ å¼‚æ­¥å¤„ç†ã€æ‰¹é‡æ“ä½œ
â€¢ ç¼“å­˜ç­–ç•¥ã€è¿æ¥æ± å¤ç”¨

æ•°æ®å±‚ä¼˜åŒ–ï¼š
â€¢ æ— é”æ•°æ®ç»“æ„ã€åˆ†ç‰‡ç­–ç•¥
â€¢ æ‰¹é‡SQLã€ç´¢å¼•ä¼˜åŒ–

ç³»ç»Ÿå±‚ä¼˜åŒ–ï¼š
â€¢ çº¿ç¨‹æ± é…ç½®ã€GCè°ƒä¼˜
â€¢ ç½‘ç»œå‚æ•°ã€ç£ç›˜IOä¼˜åŒ–

æ¶æ„å±‚ä¼˜åŒ–ï¼š
â€¢ å¾®æœåŠ¡è§£è€¦ã€è´Ÿè½½å‡è¡¡
â€¢ CDNåŠ é€Ÿã€è¯»å†™åˆ†ç¦»
```

**ğŸ”¹ ä¸åŒåœºæ™¯çš„ä¼˜åŒ–ç­–ç•¥**
```
é«˜å¹¶å‘è¯»å–ï¼š
âœ… ç¼“å­˜é¢„çƒ­ã€CDNåˆ†å‘
âœ… è¯»å†™åˆ†ç¦»ã€æ•°æ®åˆ†ç‰‡
âœ… æ— é”æ•°æ®ç»“æ„

é«˜å¹¶å‘å†™å…¥ï¼š
âœ… æ‰¹é‡å†™å…¥ã€å¼‚æ­¥å¤„ç†
âœ… æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²ã€åˆ†åº“åˆ†è¡¨
âœ… å†™å…¥ä¼˜åŒ–çš„æ•°æ®ç»“æ„

å®æ—¶å“åº”ï¼š
âœ… è¿æ¥æ± å¤ç”¨ã€å¼‚æ­¥è°ƒç”¨
âœ… å°±è¿‘è®¿é—®ã€è¾¹ç¼˜è®¡ç®—
âœ… é™æµä¿æŠ¤ã€å¿«é€Ÿå¤±è´¥

å¤§æ•°æ®å¤„ç†ï¼š
âœ… æµæ°´çº¿å¹¶è¡Œã€æ‰¹é‡å¤„ç†
âœ… åˆ†å¸ƒå¼è®¡ç®—ã€å†…å­˜è®¡ç®—
âœ… æ•°æ®å‹ç¼©ã€å¢é‡æ›´æ–°
```

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```
ç³»ç»Ÿçº§æŒ‡æ ‡ï¼š
â€¢ CPUä½¿ç”¨ç‡ï¼š< 80%
â€¢ å†…å­˜ä½¿ç”¨ç‡ï¼š< 85%
â€¢ ç£ç›˜IOç­‰å¾…ï¼š< 10%
â€¢ ç½‘ç»œå¸¦å®½ä½¿ç”¨ï¼š< 70%

åº”ç”¨çº§æŒ‡æ ‡ï¼š
â€¢ å“åº”æ—¶é—´ï¼šP95 < 1000ms
â€¢ ååé‡ï¼šQPS > é¢„æœŸå€¼
â€¢ é”™è¯¯ç‡ï¼š< 0.1%
â€¢ å¯ç”¨æ€§ï¼š> 99.9%

çº¿ç¨‹æ± æŒ‡æ ‡ï¼š
â€¢ æ´»è·ƒçº¿ç¨‹æ•°
â€¢ é˜Ÿåˆ—å †ç§¯æ•°é‡
â€¢ ä»»åŠ¡å®Œæˆæ•°é‡
â€¢ æ‹’ç»ä»»åŠ¡æ•°é‡
```

**ğŸ¯ ä¼˜åŒ–å®æ–½æ­¥éª¤**
```
ç¬¬1æ­¥ï¼šæ€§èƒ½åŸºçº¿æµ‹è¯•
â€¢ è®°å½•å½“å‰ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
â€¢ è¯†åˆ«æ€§èƒ½ç“¶é¢ˆç‚¹
â€¢ ç¡®å®šä¼˜åŒ–ç›®æ ‡

ç¬¬2æ­¥ï¼šåˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
â€¢ é€‰æ‹©åˆé€‚çš„ä¼˜åŒ–æŠ€æœ¯
â€¢ è¯„ä¼°ä¼˜åŒ–æˆæœ¬å’Œæ”¶ç›Š
â€¢ åˆ¶å®šå®æ–½è®¡åˆ’

ç¬¬3æ­¥ï¼šé€æ­¥å®æ–½ä¼˜åŒ–
â€¢ ä¼˜å…ˆè§£å†³æœ€å¤§ç“¶é¢ˆ
â€¢ å°æ­¥å¿«è·‘ï¼Œé€æ­¥éªŒè¯
â€¢ ç›‘æ§ä¼˜åŒ–æ•ˆæœ

ç¬¬4æ­¥ï¼šæŒç»­ç›‘æ§è°ƒä¼˜
â€¢ å»ºç«‹æ€§èƒ½ç›‘æ§ä½“ç³»
â€¢ å®šæœŸåˆ†ææ€§èƒ½è¶‹åŠ¿
â€¢ æ ¹æ®ä¸šåŠ¡å‘å±•è°ƒæ•´ç­–ç•¥
```

### 11.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**âš ï¸ å¹¶å‘ç¼–ç¨‹å¸¸è§é™·é˜±**
```
è¿‡åº¦ä¼˜åŒ–ï¼š
é—®é¢˜ï¼šä¸ºäº†æ€§èƒ½ç‰ºç‰²ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§
è§£å†³ï¼šåœ¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ä¹‹é—´æ‰¾å¹³è¡¡

èµ„æºç«äº‰ï¼š
é—®é¢˜ï¼šå¤šçº¿ç¨‹äº‰æŠ¢å…±äº«èµ„æºå¯¼è‡´æ­»é”
è§£å†³ï¼šå‡å°‘å…±äº«èµ„æºï¼Œä½¿ç”¨æ— é”ç»“æ„

å†…å­˜æ³„æ¼ï¼š
é—®é¢˜ï¼šçº¿ç¨‹æ± ã€è¿æ¥æ± é…ç½®ä¸å½“å¯¼è‡´èµ„æºæ³„æ¼
è§£å†³ï¼šåˆç†é…ç½®æ± å¤§å°ï¼ŒåŠæ—¶é‡Šæ”¾èµ„æº

çº§è”å¤±è´¥ï¼š
é—®é¢˜ï¼šä¸€ä¸ªæœåŠ¡æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒ
è§£å†³ï¼šç†”æ–­å™¨ã€é™æµã€é™çº§æœºåˆ¶
```

**ğŸ”§ è°ƒä¼˜æœ€ä½³å®è·µ**
```
æµ‹è¯•é©±åŠ¨ï¼š
â€¢ å…ˆæµ‹è¯•å†ä¼˜åŒ–ï¼Œé¿å…ç›²ç›®ä¼˜åŒ–
â€¢ ä½¿ç”¨å‹æµ‹å·¥å…·éªŒè¯æ•ˆæœ
â€¢ A/Bæµ‹è¯•å¯¹æ¯”ä¼˜åŒ–å‰å

ç›‘æ§é©±åŠ¨ï¼š
â€¢ å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
â€¢ åŸºäºæ•°æ®åšä¼˜åŒ–å†³ç­–
â€¢ å‘Šè­¦æœºåˆ¶åŠæ—¶å‘ç°é—®é¢˜

æ¸è¿›å¼ä¼˜åŒ–ï¼š
â€¢ å…ˆè§£å†³æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
â€¢ é€æ­¥æ·±å…¥ç»†èŠ‚ä¼˜åŒ–
â€¢ é¿å…è¿‡æ—©ä¼˜åŒ–

æ–‡æ¡£è®°å½•ï¼š
â€¢ è®°å½•ä¼˜åŒ–å‰åçš„æ€§èƒ½æ•°æ®
â€¢ æ–‡æ¡£åŒ–é…ç½®å‚æ•°çš„é€‰æ‹©åŸå› 
â€¢ å»ºç«‹æ€§èƒ½ä¼˜åŒ–çŸ¥è¯†åº“
```

### 11.5 æŠ€æœ¯å‘å±•è¶‹åŠ¿


**ğŸš€ æ–°å…´ä¼˜åŒ–æŠ€æœ¯**
```
å“åº”å¼ç¼–ç¨‹ï¼š
â€¢ å¼‚æ­¥éé˜»å¡ç¼–ç¨‹æ¨¡å‹
â€¢ èƒŒå‹å¤„ç†ã€æµå¼è®¡ç®—
â€¢ ä»£è¡¨æŠ€æœ¯ï¼šReactive Streamsã€RxJava

äº‘åŸç”Ÿä¼˜åŒ–ï¼š
â€¢ å®¹å™¨åŒ–éƒ¨ç½²ã€å¾®æœåŠ¡æ¶æ„
â€¢ è‡ªåŠ¨æ‰©ç¼©å®¹ã€æœåŠ¡ç½‘æ ¼
â€¢ ä»£è¡¨æŠ€æœ¯ï¼šKubernetesã€Istio

æœºå™¨å­¦ä¹ ä¼˜åŒ–ï¼š
â€¢ æ™ºèƒ½é¢„æµ‹ã€è‡ªé€‚åº”è°ƒä¼˜
â€¢ å¼‚å¸¸æ£€æµ‹ã€å®¹é‡è§„åˆ’
â€¢ ä»£è¡¨æŠ€æœ¯ï¼šAIOpsã€AutoML

ç¡¬ä»¶åŠ é€Ÿï¼š
â€¢ GPUå¹¶è¡Œè®¡ç®—ã€FPGAåŠ é€Ÿ
â€¢ å†…å­˜æ•°æ®åº“ã€NVMeå­˜å‚¨
â€¢ ä»£è¡¨æŠ€æœ¯ï¼šCUDAã€Redisã€SSD
```

### 11.6 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ é˜¶æ®µè§„åˆ’**
```
åŸºç¡€é˜¶æ®µï¼ˆ1-3ä¸ªæœˆï¼‰ï¼š
â€¢ æŒæ¡å¤šçº¿ç¨‹åŸºç¡€æ¦‚å¿µ
â€¢ ç†è§£é”æœºåˆ¶å’Œå¹¶å‘å®‰å…¨
â€¢ å­¦ä¹ çº¿ç¨‹æ± å’Œè¿æ¥æ± é…ç½®
â€¢ å®è·µç®€å•çš„å¼‚æ­¥å¤„ç†

è¿›é˜¶é˜¶æ®µï¼ˆ3-6ä¸ªæœˆï¼‰ï¼š
â€¢ æ·±å…¥å­¦ä¹ æ— é”ç¼–ç¨‹
â€¢ æŒæ¡æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨
â€¢ å­¦ä¹ ç¼“å­˜å’Œæ‰¹é‡å¤„ç†ç­–ç•¥
â€¢ å®è·µæµæ°´çº¿å¹¶è¡Œå¤„ç†

é«˜çº§é˜¶æ®µï¼ˆ6-12ä¸ªæœˆï¼‰ï¼š
â€¢ ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜å®æˆ˜
â€¢ åˆ†å¸ƒå¼å¹¶å‘å¤„ç†
â€¢ æ¶æ„çº§æ€§èƒ½ä¼˜åŒ–
â€¢ æ–°æŠ€æœ¯è·Ÿè¸ªå’Œåº”ç”¨

ä¸“å®¶é˜¶æ®µï¼ˆæŒç»­å­¦ä¹ ï¼‰ï¼š
â€¢ æ·±å…¥ç†è§£åº•å±‚åŸç†
â€¢ è®¾è®¡é«˜æ€§èƒ½æ¶æ„
â€¢ æŒ‡å¯¼å›¢é˜Ÿæ€§èƒ½ä¼˜åŒ–
â€¢ æŠ€æœ¯åˆ†äº«å’Œåˆ›æ–°
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¹¶å‘ä¼˜åŒ–å››å¤§æ³•å®ï¼šå¼‚æ­¥æ‰¹é‡æ± æ— é”
æ€§èƒ½è°ƒä¼˜ä¸‰æ­¥èµ°ï¼šæµ‹é‡åˆ†æå†ä¼˜åŒ–  
ç³»ç»Ÿä¿æŠ¤ä¸‰é“å…³ï¼šé™æµç†”æ–­å’Œé™çº§
æ¶æ„è®¾è®¡è¦è®°ä½ï¼šè§£è€¦åˆ†å±‚å¯æ‰©å±•
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šæ›´å¿«çš„å“åº”é€Ÿåº¦ï¼Œæ›´æµç•…çš„æ“ä½œ
- **é™ä½è¿è¥æˆæœ¬**ï¼šæ›´é«˜çš„èµ„æºåˆ©ç”¨ç‡ï¼Œæ›´å°‘çš„æœåŠ¡å™¨
- **å¢å¼ºç³»ç»Ÿç¨³å®šæ€§**ï¼šæ›´å¥½çš„å®¹é”™èƒ½åŠ›ï¼Œæ›´é«˜çš„å¯ç”¨æ€§
- **æ”¯æ’‘ä¸šåŠ¡å¢é•¿**ï¼šæ›´å¼ºçš„æ‰©å±•èƒ½åŠ›ï¼Œæ›´çµæ´»çš„æ¶æ„