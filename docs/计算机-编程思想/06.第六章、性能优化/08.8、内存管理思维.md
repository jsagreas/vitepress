---
title: 8ã€å†…å­˜ç®¡ç†æ€ç»´
---
## ğŸ“š ç›®å½•

1. [å†…å­˜ç®¡ç†æ ¸å¿ƒæ¦‚å¿µ](#1-å†…å­˜ç®¡ç†æ ¸å¿ƒæ¦‚å¿µ)
2. [å†…å­˜å¸ƒå±€ç†è§£](#2-å†…å­˜å¸ƒå±€ç†è§£)
3. [å†…å­˜åˆ†é…é‡Šæ”¾ç­–ç•¥](#3-å†…å­˜åˆ†é…é‡Šæ”¾ç­–ç•¥)
4. [åƒåœ¾å›æ”¶æœºåˆ¶](#4-åƒåœ¾å›æ”¶æœºåˆ¶)
5. [å†…å­˜æ³„æ¼é¢„é˜²](#5-å†…å­˜æ³„æ¼é¢„é˜²)
6. [çº¿ç¨‹å®‰å…¨æ€ç»´](#6-çº¿ç¨‹å®‰å…¨æ€ç»´)
7. [æ•°æ®åº“è¿æ¥ä¼˜åŒ–](#7-æ•°æ®åº“è¿æ¥ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§  å†…å­˜ç®¡ç†æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å†…å­˜ç®¡ç†


**ç®€å•ç†è§£**ï¼šå†…å­˜ç®¡ç†å°±åƒç®¡ç†ä½ çš„é’±åŒ…
- ğŸ’° **æœ‰å¤šå°‘é’±**ï¼ˆå†…å­˜å¤§å°ï¼‰
- ğŸ’¸ **æ€ä¹ˆèŠ±é’±**ï¼ˆå†…å­˜åˆ†é…ï¼‰
- ğŸ”„ **é’±ç”¨å®Œäº†æ€ä¹ˆåŠ**ï¼ˆåƒåœ¾å›æ”¶ï¼‰
- ğŸ›¡ï¸ **é˜²æ­¢è¢«å·**ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰

```
ç°å®ç”Ÿæ´»ä¸­çš„é’±åŒ…ç®¡ç†ï¼š
é’±åŒ…å®¹é‡æœ‰é™ â†’ å†…å­˜ç©ºé—´æœ‰é™
åˆç†åˆ†é…å¼€æ”¯ â†’ åˆç†åˆ†é…å†…å­˜
åŠæ—¶æ¸…ç†æ”¶æ® â†’ åŠæ—¶å›æ”¶åƒåœ¾
é˜²æ­¢å¤šäººåŒæ—¶æ‹¿é’± â†’ é˜²æ­¢å¤šçº¿ç¨‹å†²çª
```

### 1.2 ä¸ºä»€ä¹ˆè¦å­¦å†…å­˜ç®¡ç†


**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸš€ **æå‡æ€§èƒ½**ï¼šç¨‹åºè¿è¡Œæ›´å¿«
- ğŸ’ª **é¿å…å´©æºƒ**ï¼šé˜²æ­¢å†…å­˜æº¢å‡º
- ğŸ”’ **ä¿è¯å®‰å…¨**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®å®‰å…¨
- ğŸ’¡ **å†™å‡ºå¥½ä»£ç **ï¼šæˆä¸ºæ›´å¥½çš„ç¨‹åºå‘˜

---

## 2. ğŸ—ï¸ å†…å­˜å¸ƒå±€ç†è§£


### 2.1 æ ˆå†…å­˜ vs å †å†…å­˜çš„æœ¬è´¨å·®å¼‚


**å½¢è±¡æ¯”å–»**ï¼šæ ˆå†…å­˜åƒ**ä¹¦æ¡Œ**ï¼Œå †å†…å­˜åƒ**ä»“åº“**

```
æ ˆå†…å­˜ï¼ˆStackï¼‰- ä¹¦æ¡Œï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å±€éƒ¨å˜é‡c     â”‚ â† æœ€åæ”¾çš„ï¼Œæœ€å…ˆæ‹¿èµ°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å±€éƒ¨å˜é‡b     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   å±€éƒ¨å˜é‡a     â”‚ â† æœ€å…ˆæ”¾çš„ï¼Œæœ€åæ‹¿èµ°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å †å†…å­˜ï¼ˆHeapï¼‰- ä»“åº“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¹è±¡A    å¯¹è±¡B         å¯¹è±¡C    â”‚ â† éšæ„å­˜æ”¾
â”‚      å¯¹è±¡D    å¯¹è±¡E              â”‚
â”‚           å¯¹è±¡F                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è¯¦ç»†å¯¹æ¯”


| ç‰¹æ€§ | **æ ˆå†…å­˜** | **å †å†…å­˜** |
|------|-----------|-----------|
| ğŸƒ **é€Ÿåº¦** | `æå¿«` | `è¾ƒæ…¢` |
| ğŸ“ **å¤§å°** | `å°ï¼ˆå‡ MBï¼‰` | `å¤§ï¼ˆå‡ GBï¼‰` |
| ğŸ¯ **ç”¨é€”** | `å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°` | `å¯¹è±¡å®ä¾‹ã€æ•°ç»„` |
| ğŸ”„ **ç®¡ç†** | `è‡ªåŠ¨ç®¡ç†` | `éœ€è¦åƒåœ¾å›æ”¶` |
| ğŸ—ï¸ **ç»“æ„** | `æœ‰åºæ ˆç»“æ„` | `æ— åºå †ç»“æ„` |

### 2.3 å®é™…ä¾‹å­


```java
public void example() {
    // æ ˆå†…å­˜ï¼šå­˜å‚¨åŸºæœ¬ç±»å‹å’Œå¼•ç”¨
    int age = 25;           // ageå­˜åœ¨æ ˆä¸­
    String name;            // nameå¼•ç”¨å­˜åœ¨æ ˆä¸­
    
    // å †å†…å­˜ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹
    name = new String("å¼ ä¸‰"); // "å¼ ä¸‰"å¯¹è±¡å­˜åœ¨å †ä¸­
    Person person = new Person(); // Personå¯¹è±¡å­˜åœ¨å †ä¸­
    
    // å½“æ–¹æ³•ç»“æŸæ—¶ï¼š
    // æ ˆå†…å­˜è‡ªåŠ¨æ¸…ç†ï¼šageã€nameå¼•ç”¨æ¶ˆå¤±
    // å †å†…å­˜ç­‰å¾…GCï¼šStringå¯¹è±¡ã€Personå¯¹è±¡ç­‰å¾…å›æ”¶
}
```

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼šæ ˆå¿«å †å¤§ï¼Œæ ˆè‡ªåŠ¨å †è¦æ”¶

---

## 3. ğŸ’¾ å†…å­˜åˆ†é…é‡Šæ”¾ç­–ç•¥


### 3.1 å†…å­˜åˆ†é…çš„ç®¡ç†ç­–ç•¥


**æ ¸å¿ƒæ€æƒ³**ï¼šåƒåˆ†é…å·¥ä½œä»»åŠ¡ä¸€æ ·åˆ†é…å†…å­˜

```
å†…å­˜åˆ†é…ç­–ç•¥ï¼š

ğŸ”¸ æŒ‰éœ€åˆ†é…ï¼š
ç”¨å¤šå°‘ç”³è¯·å¤šå°‘ï¼Œé¿å…æµªè´¹
StringBuilder sb = new StringBuilder(100); // é¢„ä¼°å¤§å°

ğŸ”¸ æ‰¹é‡åˆ†é…ï¼š
ä¸€æ¬¡åˆ†é…å¤šä¸ªï¼Œå‡å°‘å¼€é”€
List<String> list = new ArrayList<>(1000); // é¢„è®¾å®¹é‡

ğŸ”¸ åˆ†çº§åˆ†é…ï¼š
ä¸åŒå¤§å°çš„å¯¹è±¡ç”¨ä¸åŒç­–ç•¥
å°å¯¹è±¡ â†’ æ ˆå†…å­˜æˆ–å°å †åŒº
å¤§å¯¹è±¡ â†’ ä¸“é—¨çš„å¤§å¯¹è±¡åŒº
```

### 3.2 é‡Šæ”¾ç­–ç•¥


**è‡ªåŠ¨é‡Šæ”¾ vs æ‰‹åŠ¨é‡Šæ”¾**ï¼š

```java
// è‡ªåŠ¨é‡Šæ”¾ï¼ˆæ¨èï¼‰
public void autoRelease() {
    List<String> list = new ArrayList<>();
    // ... ä½¿ç”¨list
    // æ–¹æ³•ç»“æŸåï¼Œlistè‡ªåŠ¨ç­‰å¾…GCå›æ”¶
}

// æ‰‹åŠ¨ååŠ©é‡Šæ”¾
public void manualHelp() {
    List<String> list = new ArrayList<>();
    try {
        // ... ä½¿ç”¨list
    } finally {
        list.clear(); // æ¸…ç©ºå†…å®¹ï¼Œå¸®åŠ©GC
        list = null;  // æ–­å¼€å¼•ç”¨
    }
}
```

### 3.3 æœ€ä½³å®è·µ


```java
ğŸ”¸ å¯¹è±¡æ± æ¨¡å¼ï¼šå¤ç”¨æ˜‚è´µå¯¹è±¡
private static final ObjectPool<Connection> pool = new ObjectPool<>();

ğŸ”¸ åŠæ—¶æ–­å¼€å¼•ç”¨ï¼š
listener = null;  // é¿å…ç›‘å¬å™¨å†…å­˜æ³„æ¼

ğŸ”¸ ä½¿ç”¨try-with-resourcesï¼š
try (FileInputStream fis = new FileInputStream("file.txt")) {
    // è‡ªåŠ¨å…³é—­èµ„æº
}
```

---

## 4. ğŸ—‘ï¸ åƒåœ¾å›æ”¶æœºåˆ¶


### 4.1 GCåŸç†ç®€å•ç†è§£


**åƒåœ¾å›æ”¶å°±åƒæ‰“æ‰«æˆ¿é—´**ï¼š

```
åƒåœ¾è¯†åˆ«ï¼ˆä»€ä¹ˆæ˜¯åƒåœ¾ï¼‰ï¼š
ğŸ” æ²¡æœ‰ä»»ä½•å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ = åƒåœ¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å˜é‡a  â”‚â”€â”€â”€â–¶â”‚ å¯¹è±¡A   â”‚  â† ä¸æ˜¯åƒåœ¾ï¼Œaè¿˜æŒ‡å‘å®ƒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ å¯¹è±¡B   â”‚  â† æ˜¯åƒåœ¾ï¼Œæ²¡äººæŒ‡å‘å®ƒ
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åƒåœ¾æ¸…ç†ï¼ˆæ€ä¹ˆæ¸…ç†ï¼‰ï¼š
ğŸ—‘ï¸ æ ‡è®°ï¼šæ‰¾å‡ºæ‰€æœ‰åƒåœ¾å¯¹è±¡
ğŸ§¹ æ¸…é™¤ï¼šé‡Šæ”¾åƒåœ¾å¯¹è±¡å ç”¨çš„å†…å­˜
ğŸ“¦ æ•´ç†ï¼šæŠŠå‰©ä½™å¯¹è±¡æ•´ç†åˆ°ä¸€èµ·
```

### 4.2 GCè°ƒä¼˜æ–¹æ³•


**è°ƒä¼˜æ€è·¯**ï¼šè®©GCæ›´èªæ˜åœ°å·¥ä½œ

```
ğŸ”¸ å‡å°‘åƒåœ¾äº§ç”Ÿï¼š
// é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡
StringBuilder sb = new StringBuilder(); // å¾ªç¯å¤–åˆ›å»º
for (int i = 0; i < 1000; i++) {
    sb.append("data").append(i); // å¤ç”¨StringBuilder
}

ğŸ”¸ é€‰æ‹©åˆé€‚çš„GCç®—æ³•ï¼š
å¹´è½»ä»£ï¼šParNewï¼ˆå¹¶è¡Œæ”¶é›†ï¼‰
è€å¹´ä»£ï¼šCMSï¼ˆå¹¶å‘æ ‡è®°æ¸…é™¤ï¼‰

ğŸ”¸ è°ƒæ•´å †å†…å­˜å¤§å°ï¼š
-Xms2g -Xmx4g  // åˆå§‹2Gï¼Œæœ€å¤§4G
```

### 4.3 ç›‘æ§GCæ€§èƒ½


```bash
# æŸ¥çœ‹GCæƒ…å†µ
jstat -gc [è¿›ç¨‹ID] 1s 10  # æ¯ç§’æ‰“å°GCçŠ¶æ€ï¼Œå…±10æ¬¡

# GCæ—¥å¿—åˆ†æ
-XX:+PrintGCDetails -XX:+PrintGCTimeStamps
```

> âš ï¸ **æ³¨æ„**ï¼šGCè°ƒä¼˜æ˜¯é«˜çº§è¯é¢˜ï¼Œåˆå­¦è€…é‡ç‚¹ç†è§£åŸç†å³å¯

---

## 5. ğŸ›¡ï¸ å†…å­˜æ³„æ¼é¢„é˜²


### 5.1 å†…å­˜æ³„æ¼çš„è¯†åˆ«


**ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼**ï¼šè¯¥å›æ”¶çš„å†…å­˜æ²¡æœ‰è¢«å›æ”¶

```
å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯ï¼š

ğŸ”¸ ç›‘å¬å™¨æ²¡æœ‰ç§»é™¤ï¼š
button.addActionListener(listener);
// å¿˜è®°ç§»é™¤ â†’ button.removeActionListener(listener);

ğŸ”¸ é™æ€é›†åˆæŒæœ‰å¯¹è±¡ï¼š
private static List<Object> cache = new ArrayList<>();
cache.add(object); // å¯¹è±¡æ°¸è¿œä¸ä¼šè¢«å›æ”¶

ğŸ”¸ å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼š
public class Outer {
    private List<String> data = new ArrayList<>();
    
    // éé™æ€å†…éƒ¨ç±»è‡ªåŠ¨æŒæœ‰Outerå¼•ç”¨
    class Inner {
        // å¦‚æœInnerè¢«é•¿æœŸæŒæœ‰ï¼ŒOuterä¹Ÿä¸ä¼šè¢«å›æ”¶
    }
}
```

### 5.2 é¢„é˜²æªæ–½


```java
ğŸ”¸ åŠæ—¶ç§»é™¤ç›‘å¬å™¨ï¼š
public class MyComponent {
    private ActionListener listener;
    
    public void destroy() {
        if (listener != null) {
            button.removeActionListener(listener);
            listener = null;
        }
    }
}

ğŸ”¸ ä½¿ç”¨å¼±å¼•ç”¨ï¼š
import java.lang.ref.WeakReference;

WeakReference<Object> weakRef = new WeakReference<>(object);
// å½“æ²¡æœ‰å¼ºå¼•ç”¨æ—¶ï¼Œå¯¹è±¡å¯ä»¥è¢«GCå›æ”¶

ğŸ”¸ é™æ€å†…éƒ¨ç±»ï¼š
static class Inner {
    // ä¸ä¼šè‡ªåŠ¨æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨
}
```

### 5.3 æ£€æµ‹å·¥å…·


```
ğŸ”§ å†…å­˜åˆ†æå·¥å…·ï¼š
- MATï¼ˆMemory Analyzer Toolï¼‰
- JProfiler
- VisualVM

ğŸ“Š ç®€å•æ£€æµ‹å‘½ä»¤ï¼š
jmap -histo [è¿›ç¨‹ID]  # æŸ¥çœ‹å¯¹è±¡æ•°é‡
jmap -dump:format=b,file=heap.hprof [è¿›ç¨‹ID]  # ç”Ÿæˆå †è½¬å‚¨
```

---

## 6. ğŸ”’ çº¿ç¨‹å®‰å…¨æ€ç»´


### 6.1 å…±äº«æ•°æ®ä¿æŠ¤


**æ ¸å¿ƒé—®é¢˜**ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®ä¼šå‡ºä¹±å­

```
é—®é¢˜åœºæ™¯ï¼ˆé“¶è¡Œè½¬è´¦ï¼‰ï¼š
è´¦æˆ·ä½™é¢ï¼š1000å…ƒ

çº¿ç¨‹Aï¼šè½¬å‡º500å…ƒ    çº¿ç¨‹Bï¼šè½¬å‡º600å…ƒ
1. è¯»å–ä½™é¢ï¼š1000   1. è¯»å–ä½™é¢ï¼š1000  
2. è®¡ç®—ï¼š1000-500   2. è®¡ç®—ï¼š1000-600
3. å†™å…¥ï¼š500       3. å†™å…¥ï¼š400

ç»“æœï¼šè´¦æˆ·ä½™é¢400å…ƒï¼ˆé”™è¯¯ï¼åº”è¯¥æ˜¯-100æˆ–æç¤ºä½™é¢ä¸è¶³ï¼‰
```

### 6.2 é”æœºåˆ¶é€‰æ‹©


**ä¸‰ç§ä¸»è¦é”çš„é€‰æ‹©ç­–ç•¥**ï¼š

| é”ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½** | **ç‰¹ç‚¹** |
|-------|------------|---------|---------|
| ğŸ”’ **synchronized** | `ç®€å•åœºæ™¯` | `ä¸­ç­‰` | `JVMå†…ç½®ï¼Œä½¿ç”¨ç®€å•` |
| âš¡ **ReentrantLock** | `å¤æ‚åœºæ™¯` | `é«˜` | `åŠŸèƒ½ä¸°å¯Œï¼Œå¯ä¸­æ–­` |
| ğŸš€ **CASä¹è§‚é”** | `é«˜å¹¶å‘è¯»å¤šå†™å°‘` | `æœ€é«˜` | `æ— é”ï¼Œä½†å¯èƒ½é‡è¯•` |

### 6.3 è¯¦ç»†å¯¹æ¯”


**synchronizedï¼ˆå†…ç½®é”ï¼‰**ï¼š
```java
// æ–¹æ³•çº§åˆ«
public synchronized void deposit(int amount) {
    balance += amount;
}

// ä»£ç å—çº§åˆ«
public void withdraw(int amount) {
    synchronized(this) {
        if (balance >= amount) {
            balance -= amount;
        }
    }
}
```

**ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰**ï¼š
```java
private final ReentrantLock lock = new ReentrantLock();

public void transfer(int amount) {
    lock.lock();
    try {
        // ä¸šåŠ¡é€»è¾‘
        balance -= amount;
    } finally {
        lock.unlock(); // å¿…é¡»åœ¨finallyä¸­é‡Šæ”¾
    }
}
```

**CASä¹è§‚é”**ï¼š
```java
private AtomicInteger balance = new AtomicInteger(1000);

public void deposit(int amount) {
    balance.addAndGet(amount); // åŸå­æ“ä½œï¼Œæ— éœ€æ˜¾å¼åŠ é”
}
```

### 6.4 æ— é”ç¼–ç¨‹æŠ€æœ¯


**ThreadLocalåº”ç”¨**ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å‰¯æœ¬

```java
// é—®é¢˜ï¼šSimpleDateFormatä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
private static final SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");

// è§£å†³ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„SimpleDateFormat
private static final ThreadLocal<SimpleDateFormat> localSdf = 
    ThreadLocal.withInitial(() -> new SimpleDateFormat("yyyy-MM-dd"));

public String formatDate(Date date) {
    return localSdf.get().format(date); // çº¿ç¨‹å®‰å…¨
}
```

### 6.5 çº¿ç¨‹å®‰å…¨æ·±åŒ–ç†è§£


**æ— çŠ¶æ€è®¾è®¡**ï¼šæœ€å®‰å…¨çš„çº¿ç¨‹å®‰å…¨

```java
// æœ‰çŠ¶æ€ï¼ˆä¸å®‰å…¨ï¼‰
public class StatefulService {
    private int count = 0; // å…±äº«çŠ¶æ€
    
    public int process() {
        count++; // å¤šçº¿ç¨‹ä¸å®‰å…¨
        return count;
    }
}

// æ— çŠ¶æ€ï¼ˆå®‰å…¨ï¼‰
public class StatelessService {
    public int process(int input) {
        int result = input * 2; // åªç”¨å±€éƒ¨å˜é‡
        return result; // å¤©ç„¶çº¿ç¨‹å®‰å…¨
    }
}
```

---

## 7. ğŸ—„ï¸ æ•°æ®åº“è¿æ¥ä¼˜åŒ–


### 7.1 è¿æ¥æ± é…ç½®


**è¿æ¥æ± å°±åƒå…±äº«å•è½¦**ï¼š

```
æ²¡æœ‰è¿æ¥æ± çš„é—®é¢˜ï¼š
æ¯æ¬¡ç”¨è½¦éƒ½è¦ä¹°ä¸€è¾†æ–°è½¦ â†’ æ¯æ¬¡æŸ¥è¯¢éƒ½è¦å»ºç«‹æ–°è¿æ¥
ç”¨å®Œå°±æ‰”æ‰ â†’ æŸ¥è¯¢å®Œå°±å…³é—­è¿æ¥
å¤ªæµªè´¹äº†ï¼ â†’ æ€§èƒ½å¾ˆå·®ï¼

æœ‰è¿æ¥æ± çš„å¥½å¤„ï¼š
å‡†å¤‡ä¸€æ‰¹å…±äº«å•è½¦ â†’ é¢„å…ˆå»ºç«‹ä¸€æ‰¹è¿æ¥
ç”¨å®Œå½’è¿˜ç»™åˆ«äººç”¨ â†’ è¿æ¥å¤ç”¨
æ•ˆç‡é«˜æˆæœ¬ä½ â†’ æ€§èƒ½å¥½èµ„æºçœ
```

### 7.2 åˆç†è®¾ç½®è¿æ¥æ± å¤§å°


**é…ç½®ç­–ç•¥**ï¼š

```java
// HikariCPè¿æ¥æ± é…ç½®ç¤ºä¾‹
HikariConfig config = new HikariConfig();

// åŸºç¡€è®¾ç½®
config.setMaximumPoolSize(20);      // æœ€å¤§è¿æ¥æ•°
config.setMinimumIdle(5);           // æœ€å°ç©ºé—²è¿æ¥
config.setConnectionTimeout(3000);  // è·å–è¿æ¥è¶…æ—¶æ—¶é—´

// ç»éªŒæ³•åˆ™ï¼š
// æœ€å¤§è¿æ¥æ•° = CPUæ ¸æ•° Ã— 2 + ç£ç›˜æ•°é‡
// å¯¹äº4æ ¸CPU + 1ä¸ªç£ç›˜ï¼š4 Ã— 2 + 1 = 9ä¸ªè¿æ¥

// ä½†è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼š
// - æŸ¥è¯¢ç®€å• â†’ è¿æ¥æ•°å¯ä»¥å¤šä¸€äº›
// - æŸ¥è¯¢å¤æ‚ â†’ è¿æ¥æ•°è¦å°‘ä¸€äº›
// - ç›‘æ§è¿æ¥ä½¿ç”¨ç‡ï¼Œè°ƒæ•´åˆ°æœ€ä½³çŠ¶æ€
```

### 7.3 è¿æ¥å¤ç”¨ç­–ç•¥


```java
// é”™è¯¯åšæ³•ï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°è¿æ¥
public void badPractice() {
    for (int i = 0; i < 100; i++) {
        Connection conn = DriverManager.getConnection(url);
        // æ‰§è¡ŒæŸ¥è¯¢
        conn.close(); // é¢‘ç¹åˆ›å»ºé”€æ¯ï¼Œæ€§èƒ½å·®
    }
}

// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨è¿æ¥æ± 
private DataSource dataSource = new HikariDataSource(config);

public void goodPractice() {
    for (int i = 0; i < 100; i++) {
        try (Connection conn = dataSource.getConnection()) {
            // æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿æ¥è‡ªåŠ¨å½’è¿˜ç»™æ± 
        }
    }
}
```

### 7.4 è¶…æ—¶è®¾ç½®


**ä¸‰ç§é‡è¦çš„è¶…æ—¶è®¾ç½®**ï¼š

```java
ğŸ”¸ è¿æ¥è¶…æ—¶ï¼šè·å–è¿æ¥çš„æœ€é•¿ç­‰å¾…æ—¶é—´
config.setConnectionTimeout(3000); // 3ç§’

ğŸ”¸ æŸ¥è¯¢è¶…æ—¶ï¼šSQLæ‰§è¡Œçš„æœ€é•¿æ—¶é—´  
statement.setQueryTimeout(30); // 30ç§’

ğŸ”¸ ç©ºé—²è¶…æ—¶ï¼šè¿æ¥ç©ºé—²å¤šä¹…åå›æ”¶
config.setIdleTimeout(600000); // 10åˆ†é’Ÿ
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å†…å­˜å¸ƒå±€ï¼šæ ˆå¿«å †å¤§ï¼Œæ ˆè‡ªåŠ¨å †è¦æ”¶
ğŸ”¸ GCæœºåˆ¶ï¼šæ ‡è®°-æ¸…é™¤-æ•´ç†ï¼Œå‡å°‘åƒåœ¾äº§ç”Ÿ
ğŸ”¸ å†…å­˜æ³„æ¼ï¼šåŠæ—¶æ–­å¼€å¼•ç”¨ï¼Œç§»é™¤ç›‘å¬å™¨
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼šå…±äº«æ•°æ®è¦ä¿æŠ¤ï¼Œæ— çŠ¶æ€è®¾è®¡æœ€å®‰å…¨
ğŸ”¸ æ•°æ®åº“ä¼˜åŒ–ï¼šè¿æ¥æ± å¤ç”¨ï¼Œåˆç†è®¾ç½®è¶…æ—¶
```

### 8.2 å®é™…åº”ç”¨æŒ‡å¯¼


**å†…å­˜ä¼˜åŒ–æ£€æŸ¥æ¸…å•**ï¼š
- âœ… å¯¹è±¡æ˜¯å¦åŠæ—¶é‡Šæ”¾å¼•ç”¨ï¼Ÿ
- âœ… é›†åˆæ˜¯å¦ä¼šæ— é™å¢é•¿ï¼Ÿ
- âœ… ç›‘å¬å™¨æ˜¯å¦æ­£ç¡®ç§»é™¤ï¼Ÿ
- âœ… çº¿ç¨‹å±€éƒ¨å˜é‡æ˜¯å¦æ¸…ç†ï¼Ÿ
- âœ… æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£ç¡®å…³é—­ï¼Ÿ

**æ€§èƒ½ä¼˜åŒ–æ€è·¯**ï¼š
- ğŸ¯ **é¢„é˜²ä¸ºä¸»**ï¼šå†™ä»£ç æ—¶å°±è€ƒè™‘å†…å­˜ä½¿ç”¨
- ğŸ” **ç›‘æ§å‘ç°**ï¼šä½¿ç”¨å·¥å…·ç›‘æ§å†…å­˜çŠ¶æ€  
- ğŸ› ï¸ **é’ˆå¯¹ä¼˜åŒ–**ï¼šæ ¹æ®ç›‘æ§ç»“æœæœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–
- ğŸ“ˆ **æŒç»­æ”¹è¿›**ï¼šæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­è¿‡ç¨‹

### 8.3 è¿›é˜¶å­¦ä¹ è·¯å¾„


```
ğŸ”° å…¥é—¨é˜¶æ®µï¼š
ç†è§£æ ˆå †å·®å¼‚ â†’ å­¦ä¼šåŸºæœ¬çš„å†…å­˜åˆ†æ â†’ æŒæ¡ç®€å•çš„çº¿ç¨‹å®‰å…¨

ğŸ”¥ è¿›é˜¶é˜¶æ®µï¼š  
æ·±å…¥GCåŸç† â†’ å­¦ä¼šæ€§èƒ½è°ƒä¼˜ â†’ æŒæ¡é«˜çº§å¹¶å‘æŠ€æœ¯

ğŸš€ é«˜çº§é˜¶æ®µï¼š
JVMæºç åˆ†æ â†’ è‡ªå®šä¹‰åƒåœ¾æ”¶é›†å™¨ â†’ æè‡´æ€§èƒ½ä¼˜åŒ–
```

> ğŸ’¡ **è®°å¿†å£è¯€**ï¼šå†…å­˜ç®¡ç†è¦ç”¨å¿ƒï¼Œæ ˆå †åˆ†æ˜çº¿ç¨‹å®‰å…¨ï¼Œè¿æ¥å¤ç”¨GCè°ƒä¼˜ï¼Œé¢„é˜²æ³„æ¼æ€§èƒ½ä½³

**æ ¸å¿ƒæ€ç»´è½¬å˜**ï¼š
- ä»"èƒ½è·‘å°±è¡Œ"åˆ°"é«˜æ•ˆç¨³å®š"
- ä»"äº‹åè¡¥æ•‘"åˆ°"äº‹å‰é¢„é˜²"  
- ä»"å•çº¿ç¨‹æ€ç»´"åˆ°"å¹¶å‘å®‰å…¨æ€ç»´"
- ä»"åŠŸèƒ½å®ç°"åˆ°"æ€§èƒ½ä¼˜åŒ–"