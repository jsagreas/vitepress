---
title: 11ã€å‡½æ•°å¼è®¾è®¡æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [å‡½æ•°å¼è®¾è®¡æ¨¡å¼æ¦‚è¿°](#1-å‡½æ•°å¼è®¾è®¡æ¨¡å¼æ¦‚è¿°)
2. [Maybe/Optionæ¨¡å¼ï¼šä¼˜é›…å¤„ç†ç©ºå€¼](#2-mayoptionæ¨¡å¼ä¼˜é›…å¤„ç†ç©ºå€¼)
3. [Eitheræ¨¡å¼ï¼šå‡½æ•°å¼é”™è¯¯å¤„ç†](#3-eitheræ¨¡å¼å‡½æ•°å¼é”™è¯¯å¤„ç†)
4. [å‡½å­æ¦‚å¿µï¼šå‡½æ•°å¼ç¼–ç¨‹åŸºç¡€](#4-å‡½å­æ¦‚å¿µå‡½æ•°å¼ç¼–ç¨‹åŸºç¡€)
5. [å•å­æ¨¡å¼ï¼šå‡½æ•°å¼é«˜çº§æŠ½è±¡](#5-å•å­æ¨¡å¼å‡½æ•°å¼é«˜çº§æŠ½è±¡)
6. [å‡½æ•°å¼é”™è¯¯å¤„ç†æœºåˆ¶](#6-å‡½æ•°å¼é”™è¯¯å¤„ç†æœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å‡½æ•°å¼è®¾è®¡æ¨¡å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å‡½æ•°å¼è®¾è®¡æ¨¡å¼


**æ ¸å¿ƒç†å¿µ**ï¼šå‡½æ•°å¼è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—ç”¨äºå¤„ç†æ•°æ®æµè½¬ã€é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†çš„æ€ç»´æ–¹å¼ã€‚

```
ä¼ ç»Ÿé¢å‘å¯¹è±¡æ€ç»´ï¼š          å‡½æ•°å¼æ€ç»´ï¼š
å¯¹è±¡.æ–¹æ³•()                 å‡½æ•°(æ•°æ®) -> æ–°æ•°æ®
ä¿®æ”¹çŠ¶æ€                    åˆ›å»ºæ–°çŠ¶æ€
å¼‚å¸¸å¤„ç†                    æ•°æ®åŒ…è£…å¤„ç†
```

**ğŸ’¡ æ ¸å¿ƒä»·å€¼**ï¼š
- **é¿å…nullå¼•ç”¨**ï¼šç”¨ç±»å‹ç³»ç»Ÿä¿è¯å®‰å…¨
- **ä¼˜é›…é”™è¯¯å¤„ç†**ï¼šç”¨æ•°æ®ç»“æ„è¡¨ç¤ºæˆåŠŸæˆ–å¤±è´¥
- **æ•°æ®ä¸å¯å˜**ï¼šé¿å…æ„å¤–çš„çŠ¶æ€ä¿®æ”¹
- **ç»„åˆæ€§å¼º**ï¼šå°å‡½æ•°ç»„åˆæˆå¤æ‚é€»è¾‘

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å‡½æ•°å¼è®¾è®¡æ¨¡å¼


**ç°å®é—®é¢˜**ï¼š
```java
// ä¼ ç»Ÿä»£ç çš„ç—›ç‚¹
String result = getData();
if (result != null) {
    String processed = process(result);
    if (processed != null) {
        String final = transform(processed);
        if (final != null) {
            return final;
        }
    }
}
return "default";
```

**å‡½æ•°å¼è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// å‡½æ•°å¼é“¾å¼è°ƒç”¨
Optional.ofNullable(getData())
    .map(this::process)
    .map(this::transform)
    .orElse("default");
```

---

## 2. ğŸ›¡ï¸ Maybe/Optionæ¨¡å¼ï¼šä¼˜é›…å¤„ç†ç©ºå€¼


### 2.1 ä»€ä¹ˆæ˜¯Maybe/Optionæ¨¡å¼


**æ ¸å¿ƒæ€æƒ³**ï¼šç”¨ä¸€ä¸ªå®¹å™¨æ¥åŒ…è£…å¯èƒ½ä¸ºç©ºçš„å€¼ï¼Œé¿å…ç›´æ¥ä½¿ç”¨nullã€‚

```
æ¦‚å¿µç†è§£ï¼š
Maybeæ˜¯ä¸€ä¸ªç›’å­ï¼Œé‡Œé¢è¦ä¹ˆæœ‰å€¼ï¼Œè¦ä¹ˆæ²¡æœ‰å€¼
ä¸æ˜¯nullï¼Œè€Œæ˜¯"ç©ºç›’å­"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Maybe<User> â”‚  æˆ–  â”‚ Maybe<User> â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚             â”‚
â”‚ â”‚  User   â”‚ â”‚      â”‚   Nothing   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  æœ‰å€¼çš„ç›’å­            ç©ºç›’å­
```

### 2.2 åŸºæœ¬å®ç°å’Œä½¿ç”¨


**ğŸ”¸ ç®€å•Maybeå®ç°**ï¼š
```java
public abstract class Maybe<T> {
    // åˆ›å»ºæœ‰å€¼çš„Maybe
    public static <T> Maybe<T> of(T value) {
        return value != null ? new Some<>(value) : new None<>();
    }
    
    // åˆ›å»ºç©ºMaybe
    public static <T> Maybe<T> none() {
        return new None<>();
    }
    
    // è½¬æ¢æ“ä½œ
    public abstract <U> Maybe<U> map(Function<T, U> mapper);
    
    // è·å–å€¼æˆ–é»˜è®¤å€¼
    public abstract T orElse(T defaultValue);
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å€¼
    public abstract boolean isPresent();
}

// æœ‰å€¼çš„æƒ…å†µ
class Some<T> extends Maybe<T> {
    private final T value;
    
    Some(T value) { this.value = value; }
    
    public <U> Maybe<U> map(Function<T, U> mapper) {
        return Maybe.of(mapper.apply(value));
    }
    
    public T orElse(T defaultValue) { return value; }
    public boolean isPresent() { return true; }
}

// ç©ºå€¼çš„æƒ…å†µ
class None<T> extends Maybe<T> {
    public <U> Maybe<U> map(Function<T, U> mapper) {
        return new None<>();
    }
    
    public T orElse(T defaultValue) { return defaultValue; }
    public boolean isPresent() { return false; }
}
```

**ğŸ”¸ å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// æŸ¥æ‰¾ç”¨æˆ·ç¤ºä¾‹
public Maybe<User> findUser(String id) {
    User user = database.findById(id);
    return Maybe.of(user);  // è‡ªåŠ¨å¤„ç†nullæƒ…å†µ
}

// é“¾å¼è°ƒç”¨å¤„ç†
String result = findUser("123")
    .map(User::getName)           // å¦‚æœç”¨æˆ·å­˜åœ¨ï¼Œè·å–å§“å
    .map(String::toUpperCase)     // è½¬å¤§å†™
    .orElse("Unknown User");      // å¦‚æœä»»ä½•ç¯èŠ‚ä¸ºç©ºï¼Œè¿”å›é»˜è®¤å€¼

// å¯¹æ¯”ä¼ ç»Ÿå†™æ³•
User user = database.findById("123");
String result;
if (user != null) {
    String name = user.getName();
    if (name != null) {
        result = name.toUpperCase();
    } else {
        result = "Unknown User";
    }
} else {
    result = "Unknown User";
}
```

### 2.3 Maybeæ¨¡å¼çš„ä¼˜åŠ¿


**âœ… ç±»å‹å®‰å…¨**ï¼š
```java
// ç¼–è¯‘æ—¶å°±çŸ¥é“å¯èƒ½ä¸ºç©º
Maybe<String> maybeValue = getValue();
// å¼ºåˆ¶å¤„ç†ç©ºå€¼æƒ…å†µï¼Œä¸ä¼šå¿˜è®°æ£€æŸ¥null
```

**âœ… é“¾å¼æ“ä½œ**ï¼š
```java
// ä¼˜é›…çš„é“¾å¼è°ƒç”¨
Maybe.of(user)
    .map(User::getAddress)
    .map(Address::getCity)
    .map(City::getName)
    .orElse("Unknown City");
```

**âœ… è¯­ä¹‰æ¸…æ™°**ï¼š
```java
// æ–¹æ³•ç­¾åå°±å‘Šè¯‰ä½ å¯èƒ½è¿”å›ç©ºå€¼
public Maybe<User> findUser(String id);  // æ˜ç¡®å¯èƒ½æ‰¾ä¸åˆ°ç”¨æˆ·
public User getUser(String id);          // æš—ç¤ºä¸€å®šæœ‰ç”¨æˆ·
```

---

## 3. âš¡ Eitheræ¨¡å¼ï¼šå‡½æ•°å¼é”™è¯¯å¤„ç†


### 3.1 Eitheræ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³


**æ¦‚å¿µç†è§£**ï¼šEitheræ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢è¦ä¹ˆæ˜¯æˆåŠŸç»“æœï¼Œè¦ä¹ˆæ˜¯é”™è¯¯ä¿¡æ¯ã€‚

```
Eitherçš„ä¸¤ç§çŠ¶æ€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Either<E,T>  â”‚  æˆ–  â”‚Either<E,T>  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Error E â”‚ â”‚      â”‚ â”‚ Value T â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Left(é”™è¯¯)           Right(æ­£ç¡®)
```

**ğŸ’¡ ä¸ºä»€ä¹ˆå«Leftå’ŒRight**ï¼š
- **Left**ï¼šé”™è¯¯æƒ…å†µï¼Œ"èµ°å·¦è¾¹"è¡¨ç¤ºå‡ºé—®é¢˜äº†
- **Right**ï¼šæ­£ç¡®æƒ…å†µï¼Œ"èµ°å³è¾¹"è¡¨ç¤ºæ­£ç¡®çš„é“è·¯

### 3.2 Eitherçš„åŸºæœ¬å®ç°


**ğŸ”¸ EitheræŠ½è±¡ç±»**ï¼š
```java
public abstract class Either<L, R> {
    // åˆ›å»ºé”™è¯¯ç»“æœ
    public static <L, R> Either<L, R> left(L error) {
        return new Left<>(error);
    }
    
    // åˆ›å»ºæˆåŠŸç»“æœ
    public static <L, R> Either<L, R> right(R value) {
        return new Right<>(value);
    }
    
    // è½¬æ¢æˆåŠŸå€¼
    public abstract <T> Either<L, T> map(Function<R, T> mapper);
    
    // æ£€æŸ¥æ˜¯å¦æˆåŠŸ
    public abstract boolean isRight();
    public abstract boolean isLeft();
    
    // è·å–å€¼ï¼ˆä»…æˆåŠŸæ—¶ï¼‰
    public abstract R getRight();
    public abstract L getLeft();
}

// é”™è¯¯æƒ…å†µ
class Left<L, R> extends Either<L, R> {
    private final L error;
    
    Left(L error) { this.error = error; }
    
    public <T> Either<L, T> map(Function<R, T> mapper) {
        return new Left<>(error);  // é”™è¯¯æƒ…å†µä¸æ‰§è¡Œè½¬æ¢
    }
    
    public boolean isRight() { return false; }
    public boolean isLeft() { return true; }
    public L getLeft() { return error; }
    public R getRight() { throw new RuntimeException("No right value"); }
}

// æˆåŠŸæƒ…å†µ
class Right<L, R> extends Either<L, R> {
    private final R value;
    
    Right(R value) { this.value = value; }
    
    public <T> Either<L, T> map(Function<R, T> mapper) {
        return Either.right(mapper.apply(value));
    }
    
    public boolean isRight() { return true; }
    public boolean isLeft() { return false; }
    public R getRight() { return value; }
    public L getLeft() { throw new RuntimeException("No left value"); }
}
```

### 3.3 Eitherçš„å®é™…åº”ç”¨


**ğŸ”¸ æ–‡ä»¶æ“ä½œç¤ºä¾‹**ï¼š
```java
// è¯»å–æ–‡ä»¶çš„å‡½æ•°å¼ç‰ˆæœ¬
public Either<String, String> readFile(String filename) {
    try {
        String content = Files.readString(Paths.get(filename));
        return Either.right(content);
    } catch (IOException e) {
        return Either.left("æ— æ³•è¯»å–æ–‡ä»¶: " + e.getMessage());
    }
}

// å¤„ç†æ–‡ä»¶å†…å®¹
public Either<String, Integer> countWords(String content) {
    if (content.trim().isEmpty()) {
        return Either.left("æ–‡ä»¶å†…å®¹ä¸ºç©º");
    }
    int wordCount = content.split("\\s+").length;
    return Either.right(wordCount);
}

// é“¾å¼è°ƒç”¨å¤„ç†
String result = readFile("test.txt")
    .map(String::trim)                    // å¦‚æœè¯»å–æˆåŠŸï¼Œå»é™¤ç©ºç™½
    .flatMap(this::countWords)            // ç„¶åç»Ÿè®¡è¯æ•°
    .map(count -> "è¯æ•°: " + count)       // æ ¼å¼åŒ–ç»“æœ
    .fold(
        error -> "é”™è¯¯: " + error,        // å¤„ç†é”™è¯¯
        success -> success                // è¿”å›æˆåŠŸç»“æœ
    );
```

**ğŸ”¸ æ•°æ®éªŒè¯ç¤ºä¾‹**ï¼š
```java
// éªŒè¯ç”¨æˆ·è¾“å…¥
public Either<String, User> validateUser(String name, int age) {
    if (name == null || name.trim().isEmpty()) {
        return Either.left("å§“åä¸èƒ½ä¸ºç©º");
    }
    if (age < 0 || age > 150) {
        return Either.left("å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´");
    }
    return Either.right(new User(name, age));
}

// ä½¿ç”¨éªŒè¯
Either<String, User> result = validateUser("å¼ ä¸‰", 25);
if (result.isRight()) {
    User user = result.getRight();
    System.out.println("ç”¨æˆ·åˆ›å»ºæˆåŠŸ: " + user);
} else {
    System.out.println("éªŒè¯å¤±è´¥: " + result.getLeft());
}
```

---

## 4. ğŸ“¦ å‡½å­æ¦‚å¿µï¼šå‡½æ•°å¼ç¼–ç¨‹åŸºç¡€


### 4.1 ä»€ä¹ˆæ˜¯å‡½å­(Functor)


**é€šä¿—ç†è§£**ï¼šå‡½å­å°±æ˜¯ä¸€ä¸ª"å¯ä»¥è¢«æ˜ å°„"çš„å®¹å™¨ã€‚

```
å‡½å­çš„æœ¬è´¨ï¼š
å®¹å™¨ + mapæ–¹æ³• = å‡½å­

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    map(f)     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›’å­<A>   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚   ç›’å­<B>   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚    A    â”‚ â”‚               â”‚ â”‚    B    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸æ”¹å˜å®¹å™¨ç»“æ„ï¼Œåªæ”¹å˜å†…å®¹
```

**ğŸ’¡ å‡½å­çš„æ ¸å¿ƒç‰¹å¾**ï¼š
- **æœ‰ä¸€ä¸ªç±»å‹å‚æ•°**ï¼š`F<T>`
- **æœ‰mapæ–¹æ³•**ï¼š`map(f: T -> U): F<U>`
- **ä¿æŒç»“æ„ä¸å˜**ï¼šå®¹å™¨çš„"å½¢çŠ¶"ä¸å˜ï¼Œåªæ”¹å˜å†…å®¹

### 4.2 å‡½å­çš„åŸºæœ¬è§„å¾‹


**ğŸ”¸ æ’ç­‰å®šå¾‹**ï¼š
```java
// mapä¸€ä¸ªæ’ç­‰å‡½æ•°ï¼Œç»“æœä¸å˜
functor.map(x -> x) == functor
```

**ğŸ”¸ ç»„åˆå®šå¾‹**ï¼š
```java
// ä¸¤æ¬¡mapç­‰äºmapä¸€æ¬¡ç»„åˆå‡½æ•°
functor.map(f).map(g) == functor.map(x -> g(f(x)))
```

### 4.3 å¸¸è§çš„å‡½å­å®ä¾‹


**ğŸ”¸ Maybeå‡½å­**ï¼š
```java
Maybe<Integer> maybe = Maybe.of(5);
Maybe<String> result = maybe.map(x -> "å€¼æ˜¯: " + x);
// Maybe("å€¼æ˜¯: 5")
```

**ğŸ”¸ Listå‡½å­**ï¼š
```java
List<Integer> numbers = Arrays.asList(1, 2, 3);
List<String> strings = numbers.stream()
    .map(x -> "æ•°å­—: " + x)
    .collect(toList());
// ["æ•°å­—: 1", "æ•°å­—: 2", "æ•°å­—: 3"]
```

**ğŸ”¸ Eitherå‡½å­**ï¼š
```java
Either<String, Integer> either = Either.right(10);
Either<String, String> result = either.map(x -> "å€¼æ˜¯: " + x);
// Right("å€¼æ˜¯: 10")
```

### 4.4 å‡½å­çš„å®é™…ä»·å€¼


**âœ… ç»Ÿä¸€çš„æ“ä½œæ–¹å¼**ï¼š
```java
// ä¸ç®¡æ˜¯ä»€ä¹ˆå®¹å™¨ï¼Œéƒ½ç”¨mapæ“ä½œ
Maybe.of(5).map(x -> x * 2);
List.of(1,2,3).stream().map(x -> x * 2);
Either.right(5).map(x -> x * 2);
```

**âœ… å®‰å…¨çš„æ•°æ®è½¬æ¢**ï¼š
```java
// ä¸ç”¨æ‹…å¿ƒnullæˆ–é”™è¯¯ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å¤„ç†
Maybe<String> name = getUser().map(User::getName);
// å¦‚æœgetUser()è¿”å›ç©ºï¼Œæ•´ä¸ªé“¾è·¯éƒ½æ˜¯å®‰å…¨çš„
```

---

## 5. ğŸ­ å•å­æ¨¡å¼ï¼šå‡½æ•°å¼é«˜çº§æŠ½è±¡


### 5.1 ä»€ä¹ˆæ˜¯å•å­(Monad)


**é€šä¿—ç†è§£**ï¼šå•å­æ˜¯"å¯ä»¥è¢«æ‰å¹³åŒ–"çš„å‡½å­ã€‚

```
å•å­ = å‡½å­ + flatMapæ–¹æ³•

æ™®é€šmapçš„é—®é¢˜ï¼š           flatMapçš„è§£å†³ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Maybe<      â”‚           â”‚   Maybe<    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Maybe<T> â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ â”‚    T    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  åµŒå¥—å®¹å™¨                  æ‰å¹³åŒ–å®¹å™¨
```

**ğŸ’¡ å•å­è§£å†³çš„é—®é¢˜**ï¼š
- **é¿å…åµŒå¥—**ï¼š`Maybe<Maybe<T>>` â†’ `Maybe<T>`
- **é“¾å¼è°ƒç”¨**ï¼šå¤šä¸ªå¯èƒ½å¤±è´¥çš„æ“ä½œä¸²è”
- **ä¸Šä¸‹æ–‡ä¿æŒ**ï¼šä¿æŒè®¡ç®—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

### 5.2 å•å­çš„ä¸‰ä¸ªåŸºæœ¬æ“ä½œ


**ğŸ”¸ Unitæ“ä½œï¼ˆåŒ…è£…ï¼‰**ï¼š
```java
// æŠŠæ™®é€šå€¼åŒ…è£…æˆå•å­
Maybe<Integer> maybe = Maybe.of(5);
```

**ğŸ”¸ FlatMapæ“ä½œï¼ˆæ‰å¹³åŒ–æ˜ å°„ï¼‰**ï¼š
```java
public abstract <U> Maybe<U> flatMap(Function<T, Maybe<U>> mapper);
```

**ğŸ”¸ å•å­è§„å¾‹**ï¼š
```java
// å·¦å•ä½å¾‹ï¼šunit(a).flatMap(f) == f(a)
// å³å•ä½å¾‹ï¼šm.flatMap(unit) == m  
// ç»“åˆå¾‹ï¼šm.flatMap(f).flatMap(g) == m.flatMap(x -> f(x).flatMap(g))
```

### 5.3 å•å­çš„å®é™…åº”ç”¨


**ğŸ”¸ Maybeå•å­çš„flatMapå®ç°**ï¼š
```java
// Maybeç±»ä¸­æ·»åŠ flatMapæ–¹æ³•
public abstract <U> Maybe<U> flatMap(Function<T, Maybe<U>> mapper);

// Someç±»çš„å®ç°
public <U> Maybe<U> flatMap(Function<T, Maybe<U>> mapper) {
    return mapper.apply(value);
}

// Noneç±»çš„å®ç°  
public <U> Maybe<U> flatMap(Function<T, Maybe<U>> mapper) {
    return new None<>();
}
```

**ğŸ”¸ å¤æ‚æ“ä½œé“¾ç¤ºä¾‹**ï¼š
```java
// æŸ¥æ‰¾ç”¨æˆ·çš„æœ‹å‹çš„åœ°å€
public Maybe<String> getUserFriendAddress(String userId) {
    return findUser(userId)                    // Maybe<User>
        .flatMap(user -> findFriend(user))     // Maybe<User>
        .flatMap(friend -> getAddress(friend)) // Maybe<Address>
        .map(Address::getStreet);              // Maybe<String>
}

// å¦‚æœä»»ä½•ä¸€æ­¥è¿”å›ç©ºï¼Œæ•´ä¸ªé“¾è·¯å®‰å…¨å¤±è´¥
// ä¸ä¼šæœ‰NullPointerException
```

**ğŸ”¸ Eitherå•å­ç¤ºä¾‹**ï¼š
```java
// è´¦æˆ·è½¬è´¦æ“ä½œ
public Either<String, Account> transfer(String fromId, String toId, double amount) {
    return validateAmount(amount)                     // Either<String, Double>
        .flatMap(amt -> findAccount(fromId)           // Either<String, Account>
        .flatMap(from -> findAccount(toId)            // Either<String, Account>
        .flatMap(to -> performTransfer(from, to, amt)))); // Either<String, Account>
}

// ä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œéƒ½ä¼šè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šç»§ç»­æ‰§è¡Œ
```

### 5.4 å•å­çš„å®é™…ä»·å€¼


**âœ… é”™è¯¯å¤„ç†ç®€åŒ–**ï¼š
```java
// ä¼ ç»Ÿé”™è¯¯å¤„ç†
try {
    User user = findUser(id);
    if (user == null) return error("ç”¨æˆ·ä¸å­˜åœ¨");
    
    Address addr = getAddress(user);
    if (addr == null) return error("åœ°å€ä¸å­˜åœ¨");
    
    return success(addr.getStreet());
} catch (Exception e) {
    return error(e.getMessage());
}

// å•å­ç‰ˆæœ¬
return findUser(id)
    .flatMap(this::getAddress)
    .map(Address::getStreet)
    .fold(error -> error, success -> success);
```

**âœ… å¼‚æ­¥æ“ä½œä¸²è”**ï¼š
```java
// Promise/Futureä¹Ÿæ˜¯å•å­
fetchUser(id)
    .flatMap(user -> fetchProfile(user.getId()))
    .flatMap(profile -> fetchPreferences(profile.getId()))
    .map(prefs -> renderPage(prefs));
```

---

## 6. ğŸ”§ å‡½æ•°å¼é”™è¯¯å¤„ç†æœºåˆ¶


### 6.1 å‡½æ•°å¼é”™è¯¯å¤„ç†çš„æ ¸å¿ƒæ€æƒ³


**ä¼ ç»Ÿvså‡½æ•°å¼é”™è¯¯å¤„ç†**ï¼š

```
ä¼ ç»Ÿå¼‚å¸¸å¤„ç†ï¼š                å‡½æ•°å¼é”™è¯¯å¤„ç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ­£å¸¸æµç¨‹   â”‚              â”‚   æ•°æ®æµç¨‹   â”‚
â”‚     â†“       â”‚              â”‚     â†“       â”‚
â”‚   å¼‚å¸¸ï¼     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚ é”™è¯¯æ•°æ®ç±»å‹  â”‚
â”‚   ä¸­æ–­æµç¨‹   â”‚              â”‚ ç»§ç»­æµç¨‹     â”‚
â”‚   try/catch  â”‚              â”‚   å¤„ç†åˆ†æ”¯   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å‡½æ•°å¼é”™è¯¯å¤„ç†ä¼˜åŠ¿**ï¼š
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶çŸ¥é“å¯èƒ½çš„é”™è¯¯
- **å¼ºåˆ¶å¤„ç†**ï¼šå¿…é¡»å¤„ç†é”™è¯¯æƒ…å†µ
- **ç»„åˆæ€§å¥½**ï¼šé”™è¯¯å¤„ç†é€»è¾‘å¯ä»¥ç»„åˆ
- **æµ‹è¯•å‹å¥½**ï¼šé”™è¯¯æƒ…å†µæ›´å®¹æ˜“æµ‹è¯•

### 6.2 å¤šç§é”™è¯¯å¤„ç†æ¨¡å¼å¯¹æ¯”


| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| **Maybe/Option** | ç®€å•çš„æœ‰/æ— å€¼æƒ…å†µ | ç®€å•æ˜“ç”¨ï¼Œé¿å…null | é”™è¯¯ä¿¡æ¯ä¸æ˜ç¡® |
| **Either** | éœ€è¦é”™è¯¯è¯¦æƒ…çš„æƒ…å†µ | é”™è¯¯ä¿¡æ¯ä¸°å¯Œ | åªèƒ½è¡¨ç¤ºä¸€ç§é”™è¯¯ç±»å‹ |
| **Try** | å¯èƒ½æŠ›å¼‚å¸¸çš„æ“ä½œ | å…¼å®¹ç°æœ‰å¼‚å¸¸ä»£ç  | æ€§èƒ½å¼€é”€è¾ƒå¤§ |
| **Validation** | å¤šä¸ªéªŒè¯è§„åˆ™ | æ”¶é›†æ‰€æœ‰é”™è¯¯ | å¤æ‚åº¦è¾ƒé«˜ |

### 6.3 Tryæ¨¡å¼ï¼šå¤„ç†å¼‚å¸¸çš„å‡½æ•°å¼æ–¹æ³•


**ğŸ”¸ Tryçš„åŸºæœ¬å®ç°**ï¼š
```java
public abstract class Try<T> {
    public static <T> Try<T> of(Supplier<T> supplier) {
        try {
            return new Success<>(supplier.get());
        } catch (Exception e) {
            return new Failure<>(e);
        }
    }
    
    public abstract <U> Try<U> map(Function<T, U> mapper);
    public abstract <U> Try<U> flatMap(Function<T, Try<U>> mapper);
    public abstract T getOrElse(T defaultValue);
    public abstract boolean isSuccess();
}

class Success<T> extends Try<T> {
    private final T value;
    
    Success(T value) { this.value = value; }
    
    public <U> Try<U> map(Function<T, U> mapper) {
        return Try.of(() -> mapper.apply(value));
    }
    
    public T getOrElse(T defaultValue) { return value; }
    public boolean isSuccess() { return true; }
}

class Failure<T> extends Try<T> {
    private final Exception exception;
    
    Failure(Exception exception) { this.exception = exception; }
    
    public <U> Try<U> map(Function<T, U> mapper) {
        return new Failure<>(exception);
    }
    
    public T getOrElse(T defaultValue) { return defaultValue; }
    public boolean isSuccess() { return false; }
}
```

**ğŸ”¸ Tryçš„ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// åŒ…è£…å¯èƒ½æŠ›å¼‚å¸¸çš„æ“ä½œ
Try<String> content = Try.of(() -> Files.readString(Paths.get("file.txt")));

// é“¾å¼å¤„ç†
String result = content
    .map(String::trim)
    .map(String::toUpperCase)
    .getOrElse("è¯»å–å¤±è´¥");

// å¤æ‚çš„å¼‚å¸¸å¤„ç†é“¾
Try<User> user = Try.of(() -> parseJson(jsonString))
    .flatMap(json -> Try.of(() -> validateUser(json)))
    .flatMap(validJson -> Try.of(() -> createUser(validJson)));
```

### 6.4 Validationæ¨¡å¼ï¼šæ”¶é›†å¤šä¸ªé”™è¯¯


**ğŸ”¸ Validationçš„åº”ç”¨åœºæ™¯**ï¼š
```java
// è¡¨å•éªŒè¯ï¼šéœ€è¦æ”¶é›†æ‰€æœ‰é”™è¯¯
public class UserValidation {
    public Validation<List<String>, User> validateUser(String name, String email, int age) {
        List<String> errors = new ArrayList<>();
        
        if (name == null || name.trim().isEmpty()) {
            errors.add("å§“åä¸èƒ½ä¸ºç©º");
        }
        
        if (!isValidEmail(email)) {
            errors.add("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
        }
        
        if (age < 18 || age > 100) {
            errors.add("å¹´é¾„å¿…é¡»åœ¨18-100ä¹‹é—´");
        }
        
        if (errors.isEmpty()) {
            return Validation.valid(new User(name, email, age));
        } else {
            return Validation.invalid(errors);
        }
    }
}

// ä½¿ç”¨éªŒè¯
Validation<List<String>, User> result = validateUser("", "invalid-email", 15);
if (result.isValid()) {
    User user = result.getValue();
    // å¤„ç†æœ‰æ•ˆç”¨æˆ·
} else {
    List<String> errors = result.getErrors();
    // æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ï¼š["å§“åä¸èƒ½ä¸ºç©º", "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®", "å¹´é¾„å¿…é¡»åœ¨18-100ä¹‹é—´"]
}
```

### 6.5 å‡½æ•°å¼é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


**ğŸ”¸ é€‰æ‹©åˆé€‚çš„æ¨¡å¼**ï¼š
```java
// ç®€å•çš„å¯é€‰å€¼
public Maybe<User> findUser(String id) { ... }

// éœ€è¦é”™è¯¯ä¿¡æ¯çš„æ“ä½œ
public Either<String, User> createUser(UserData data) { ... }

// å¤„ç†ç°æœ‰å¼‚å¸¸ä»£ç 
public Try<String> readFile(String path) { ... }

// å¤šä¸ªéªŒè¯è§„åˆ™
public Validation<List<String>, User> validateUser(UserForm form) { ... }
```

**ğŸ”¸ é”™è¯¯ä¿¡æ¯çš„å±‚æ¬¡åŒ–**ï¼š
```java
// å®šä¹‰é”™è¯¯ç±»å‹å±‚æ¬¡
public abstract class AppError {
    public abstract String getMessage();
}

public class ValidationError extends AppError {
    private final String field;
    private final String message;
    
    public String getMessage() {
        return field + ": " + message;
    }
}

public class DatabaseError extends AppError {
    private final String operation;
    private final Exception cause;
    
    public String getMessage() {
        return "æ•°æ®åº“æ“ä½œå¤±è´¥ [" + operation + "]: " + cause.getMessage();
    }
}

// ä½¿ç”¨ç±»å‹åŒ–é”™è¯¯
Either<AppError, User> result = createUser(userData);
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Maybe/Optionæ¨¡å¼ï¼šä¼˜é›…å¤„ç†å¯èƒ½ä¸ºç©ºçš„å€¼ï¼Œé¿å…nullå¼•ç”¨å¼‚å¸¸
ğŸ”¸ Eitheræ¨¡å¼ï¼šå‡½æ•°å¼é”™è¯¯å¤„ç†ï¼Œç”¨ç±»å‹è¡¨ç¤ºæˆåŠŸæˆ–å¤±è´¥
ğŸ”¸ å‡½å­æ¦‚å¿µï¼šå¯æ˜ å°„çš„å®¹å™¨ï¼Œæä¾›ç»Ÿä¸€çš„è½¬æ¢æ“ä½œ
ğŸ”¸ å•å­æ¨¡å¼ï¼šå¯æ‰å¹³åŒ–çš„å‡½å­ï¼Œæ”¯æŒå¤æ‚çš„é“¾å¼æ“ä½œ
ğŸ”¸ å‡½æ•°å¼é”™è¯¯å¤„ç†ï¼šç”¨æ•°æ®ç»“æ„è€Œéå¼‚å¸¸æ¥è¡¨ç¤ºé”™è¯¯çŠ¶æ€
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®¹å™¨æ€ç»´çš„è½¬å˜**ï¼š
```
ä¼ ç»Ÿæ€ç»´ï¼šç›´æ¥æ“ä½œæ•°æ®ï¼Œæ‹…å¿ƒå¼‚å¸¸æƒ…å†µ
å‡½æ•°å¼æ€ç»´ï¼šæŠŠæ•°æ®æ”¾åœ¨å®¹å™¨ä¸­ï¼Œè®©å®¹å™¨å¤„ç†å¼‚å¸¸æƒ…å†µ

ä¼ ç»Ÿï¼šif (user != null) { ... }
å‡½æ•°å¼ï¼šMaybe.of(user).map(...)
```

**ğŸ”¹ ç±»å‹å®‰å…¨çš„ä»·å€¼**ï¼š
```
ç¼–è¯‘æ—¶ä¿è¯ï¼š
- Maybe<T>æ˜ç¡®å‘Šè¯‰ä½ å¯èƒ½ä¸ºç©º
- Either<E,T>æ˜ç¡®å‘Šè¯‰ä½ å¯èƒ½å‡ºé”™
- å¼ºåˆ¶ä½ å¤„ç†è¿™äº›æƒ…å†µï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
```

**ğŸ”¹ ç»„åˆæ€§çš„å¨åŠ›**ï¼š
```
å°çš„å‡½æ•°å¼æ„å»ºå—ï¼š
Maybe.map() + Either.flatMap() + Try.of()
ç»„åˆæˆå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼š
å®‰å…¨ã€æ¸…æ™°ã€å¯æµ‹è¯•
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Maybe**ï¼š
- æŸ¥è¯¢æ“ä½œå¯èƒ½æ‰¾ä¸åˆ°ç»“æœ
- é…ç½®å€¼å¯èƒ½ä¸å­˜åœ¨
- è§£ææ“ä½œå¯èƒ½å¤±è´¥ä½†ä¸éœ€è¦è¯¦ç»†é”™è¯¯ä¿¡æ¯

**âœ… ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Either**ï¼š
- éªŒè¯æ“ä½œéœ€è¦è¿”å›å…·ä½“é”™è¯¯ä¿¡æ¯
- ä¸šåŠ¡æ“ä½œå¯èƒ½å› å¤šç§åŸå› å¤±è´¥
- éœ€è¦åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯

**âœ… ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Try**ï¼š
- åŒ…è£…ç°æœ‰çš„å¯èƒ½æŠ›å¼‚å¸¸çš„ä»£ç 
- æ–‡ä»¶IOã€ç½‘ç»œæ“ä½œç­‰ç³»ç»Ÿè°ƒç”¨
- é€æ­¥è¿ç§»ä¼ ç»Ÿå¼‚å¸¸å¤„ç†ä»£ç 

### 7.4 å­¦ä¹ å»ºè®®


**ğŸ¯ æ¸è¿›å¼å­¦ä¹ è·¯å¾„**ï¼š
```
1. å…ˆæŒæ¡Maybeï¼Œç†è§£å®¹å™¨æ€ç»´
2. å­¦ä¹ Eitherï¼ŒæŒæ¡é”™è¯¯å¤„ç†
3. ç†è§£å‡½å­æ¦‚å¿µï¼Œçœ‹åˆ°ç»Ÿä¸€æ¨¡å¼
4. æŒæ¡å•å­ï¼Œå­¦ä¼šå¤æ‚ç»„åˆ
5. å®è·µä¸­é€‰æ‹©åˆé€‚çš„æ¨¡å¼
```

**ğŸ”§ å®è·µå»ºè®®**ï¼š
```
- ä»ç®€å•çš„å·¥å…·æ–¹æ³•å¼€å§‹ä½¿ç”¨
- ä¸è¦ä¸€å¼€å§‹å°±é‡æ„æ•´ä¸ªé¡¹ç›®
- é‡ç‚¹å…³æ³¨nullå®‰å…¨å’Œé”™è¯¯å¤„ç†
- å›¢é˜Ÿè¦æœ‰ç»Ÿä¸€çš„ä½¿ç”¨çº¦å®š
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å‡½æ•°å¼è®¾è®¡æ¨¡å¼ç”¨**ç±»å‹ç³»ç»Ÿ**ä¿è¯å®‰å…¨
- **Maybe**è§£å†³nullé—®é¢˜ï¼Œ**Either**è§£å†³é”™è¯¯é—®é¢˜
- **å‡½å­**æä¾›ç»Ÿä¸€è½¬æ¢ï¼Œ**å•å­**æ”¯æŒå¤æ‚ç»„åˆ
- é‡ç‚¹æ˜¯**æ€ç»´è½¬å˜**ï¼šç”¨**æ•°æ®ç»“æ„**è¡¨ç¤º**çŠ¶æ€**