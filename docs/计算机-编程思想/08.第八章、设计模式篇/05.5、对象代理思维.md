---
title: 5ã€å¯¹è±¡ä»£ç†æ€ç»´
---
## ğŸ“š ç›®å½•

1. [ä»£ç†æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ](#1-ä»£ç†æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ)
2. [ä»£ç†æ¨¡å¼å®ç°æ–¹å¼](#2-ä»£ç†æ¨¡å¼å®ç°æ–¹å¼)
3. [è™šæ‹Ÿä»£ç†ï¼šå»¶è¿ŸåŠ è½½](#3-è™šæ‹Ÿä»£ç†å»¶è¿ŸåŠ è½½)
4. [ä¿æŠ¤ä»£ç†ï¼šè®¿é—®æ§åˆ¶](#4-ä¿æŠ¤ä»£ç†è®¿é—®æ§åˆ¶)
5. [æ™ºèƒ½ä»£ç†ï¼šå¢å¼ºåŠŸèƒ½](#5-æ™ºèƒ½ä»£ç†å¢å¼ºåŠŸèƒ½)
6. [ä»£ç†vsè£…é¥°å™¨æ¨¡å¼](#6-ä»£ç†vsè£…é¥°å™¨æ¨¡å¼)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»£ç†æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼


**ğŸ”¸ ä»£ç†æ¨¡å¼çš„æœ¬è´¨**
ä»£ç†æ¨¡å¼å°±åƒç°å®ç”Ÿæ´»ä¸­çš„ä»£ç†äººä¸€æ ·ã€‚ä½ æƒ³ä¹°æˆ¿ï¼Œä½†æ˜¯è‡ªå·±æ²¡æ—¶é—´æˆ–è€…ä¸ä¸“ä¸šï¼Œå°±æ‰¾ä¸€ä¸ªæˆ¿äº§ä»£ç†å¸®ä½ å¤„ç†ã€‚ä»£ç†æœ‰ä½ çš„æˆæƒï¼Œèƒ½ä»£è¡¨ä½ å»åšè¿™ä»¶äº‹ï¼Œä½†åŒæ—¶ä¹Ÿå¯èƒ½åŠ ä¸Šè‡ªå·±çš„ä¸€äº›é¢å¤–æœåŠ¡ã€‚

```
ç°å®ä¸­çš„ä»£ç†å…³ç³»ï¼š
ä½  â†’ æˆ¿äº§ä»£ç† â†’ æˆ¿ä¸œ
   (å§”æ‰˜)    (ä»£è¡¨ä½ è°ˆåˆ¤)

ç¼–ç¨‹ä¸­çš„ä»£ç†å…³ç³»ï¼š
å®¢æˆ·ç«¯ â†’ ä»£ç†å¯¹è±¡ â†’ çœŸå®å¯¹è±¡
      (è°ƒç”¨)    (æ§åˆ¶è®¿é—®)
```

**ğŸ’¡ ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³**
- **æ§åˆ¶è®¿é—®**ï¼šä»£ç†æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®
- **å¢å¼ºåŠŸèƒ½**ï¼šåœ¨ä¸æ”¹å˜åŸå¯¹è±¡çš„åŸºç¡€ä¸Šæ·»åŠ æ–°åŠŸèƒ½
- **å»¶è¿Ÿæ“ä½œ**ï¼šæ¨è¿ŸçœŸå®å¯¹è±¡çš„åˆ›å»ºæˆ–æ“ä½œ
- **ä¿æŠ¤æœºåˆ¶**ï¼šå¯¹çœŸå®å¯¹è±¡è¿›è¡Œä¿æŠ¤å’Œæƒé™æ§åˆ¶

### 1.2 ä»£ç†æ¨¡å¼çš„åŸºæœ¬ç»“æ„


```
ä»£ç†æ¨¡å¼ç»“æ„å›¾ï¼š

     å®¢æˆ·ç«¯
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ä»£ç†   â”‚ â†â”€â”€ å®ç°ç›¸åŒæ¥å£
    â”‚ Proxy   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“ æŒæœ‰å¼•ç”¨
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ çœŸå®å¯¹è±¡ â”‚
    â”‚RealObj  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ åŸºæœ¬ä»£ç ç»“æ„**
```java
// å…±åŒæ¥å£
interface Subject {
    void request();
}

// çœŸå®å¯¹è±¡
class RealSubject implements Subject {
    public void request() {
        System.out.println("æ‰§è¡ŒçœŸå®æ“ä½œ");
    }
}

// ä»£ç†å¯¹è±¡
class Proxy implements Subject {
    private RealSubject realSubject;
    
    public void request() {
        // ä»£ç†å¯ä»¥åœ¨è°ƒç”¨å‰åæ·»åŠ é€»è¾‘
        beforeRequest();
        getRealSubject().request();
        afterRequest();
    }
    
    private RealSubject getRealSubject() {
        if (realSubject == null) {
            realSubject = new RealSubject();
        }
        return realSubject;
    }
    
    private void beforeRequest() {
        System.out.println("ä»£ç†ï¼šå‡†å¤‡å·¥ä½œ");
    }
    
    private void afterRequest() {
        System.out.println("ä»£ç†ï¼šæ”¶å°¾å·¥ä½œ");
    }
}
```

### 1.3 ä»£ç†æ¨¡å¼è§£å†³çš„é—®é¢˜


**ğŸ¯ ä¸»è¦åº”ç”¨åœºæ™¯**
```
æ€§èƒ½é—®é¢˜ï¼š
â€¢ åˆ›å»ºå¯¹è±¡å¼€é”€å¤§ â†’ å»¶è¿Ÿåˆ›å»º
â€¢ ç½‘ç»œä¼ è¾“æ…¢ â†’ ç¼“å­˜ç»“æœ
â€¢ è®¡ç®—å¤æ‚ â†’ ç¼“å­˜è®¡ç®—ç»“æœ

å®‰å…¨é—®é¢˜ï¼š
â€¢ æƒé™æ§åˆ¶ â†’ ä»£ç†æ£€æŸ¥æƒé™
â€¢ è®¿é—®æ§åˆ¶ â†’ é™åˆ¶è®¿é—®é¢‘ç‡
â€¢ æ—¥å¿—è®°å½• â†’ è®°å½•æ“ä½œæ—¥å¿—

åŠŸèƒ½å¢å¼ºï¼š
â€¢ æ·»åŠ ç¼“å­˜ â†’ æé«˜æ€§èƒ½
â€¢ æ·»åŠ æ—¥å¿— â†’ æ–¹ä¾¿è°ƒè¯•
â€¢ æ·»åŠ ç›‘æ§ â†’ ç»Ÿè®¡ä¿¡æ¯
```

---

## 2. ğŸ”§ ä»£ç†æ¨¡å¼å®ç°æ–¹å¼


### 2.1 é™æ€ä»£ç†å®ç°


**ğŸ“ ä»€ä¹ˆæ˜¯é™æ€ä»£ç†**
é™æ€ä»£ç†å°±æ˜¯åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šå¥½ä»£ç†å…³ç³»çš„ä»£ç†æ–¹å¼ã€‚ä»£ç†ç±»æ˜¯æˆ‘ä»¬æ‰‹å·¥ç¼–å†™çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šäº†ä»£ç†ç±»çš„ä»£ç ã€‚

**ğŸ’» é™æ€ä»£ç†ç¤ºä¾‹**
```java
// æœåŠ¡æ¥å£
interface UserService {
    void login(String username, String password);
    void logout(String username);
}

// çœŸå®æœåŠ¡å®ç°
class UserServiceImpl implements UserService {
    public void login(String username, String password) {
        System.out.println("ç”¨æˆ· " + username + " ç™»å½•æˆåŠŸ");
    }
    
    public void logout(String username) {
        System.out.println("ç”¨æˆ· " + username + " é€€å‡ºç™»å½•");
    }
}

// ä»£ç†ç±» - æ·»åŠ æ—¥å¿—åŠŸèƒ½
class UserServiceProxy implements UserService {
    private UserService userService;
    
    public UserServiceProxy() {
        this.userService = new UserServiceImpl();
    }
    
    public void login(String username, String password) {
        System.out.println("æ—¥å¿—ï¼šå¼€å§‹ç™»å½•éªŒè¯");
        long startTime = System.currentTimeMillis();
        
        userService.login(username, password);
        
        long endTime = System.currentTimeMillis();
        System.out.println("æ—¥å¿—ï¼šç™»å½•è€—æ—¶ " + (endTime - startTime) + "ms");
    }
    
    public void logout(String username) {
        System.out.println("æ—¥å¿—ï¼šå¼€å§‹é€€å‡ºç™»å½•");
        userService.logout(username);
        System.out.println("æ—¥å¿—ï¼šé€€å‡ºç™»å½•å®Œæˆ");
    }
}
```

**âš¡ é™æ€ä»£ç†çš„ç‰¹ç‚¹**
```
ä¼˜ç‚¹ï¼š
âœ… ç®€å•ç›´è§‚ï¼Œå®¹æ˜“ç†è§£
âœ… ç¼–è¯‘æ—¶ç¡®å®šï¼Œæ€§èƒ½å¥½
âœ… å¯ä»¥å¯¹ç‰¹å®šæ–¹æ³•ç²¾ç¡®æ§åˆ¶

ç¼ºç‚¹ï¼š
âŒ ä»£ç é‡å¤ï¼Œæ¯ä¸ªç±»éƒ½è¦å†™ä»£ç†
âŒ ä¸å¤Ÿçµæ´»ï¼Œä¿®æ”¹å›°éš¾
âŒ è¿èƒŒå¼€é—­åŸåˆ™
```

### 2.2 åŠ¨æ€ä»£ç†å®ç°


**ğŸ“ ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†**
åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„æŠ€æœ¯ã€‚ä¸éœ€è¦æ‰‹å·¥ç¼–å†™ä»£ç†ç±»ï¼Œè€Œæ˜¯é€šè¿‡åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡ã€‚

**ğŸ’» JDKåŠ¨æ€ä»£ç†ç¤ºä¾‹**
```java
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

// é€šç”¨çš„æ—¥å¿—ä»£ç†å¤„ç†å™¨
class LoggingHandler implements InvocationHandler {
    private Object target; // è¢«ä»£ç†çš„å¯¹è±¡
    
    public LoggingHandler(Object target) {
        this.target = target;
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // æ–¹æ³•è°ƒç”¨å‰çš„å¤„ç†
        System.out.println("è°ƒç”¨æ–¹æ³•ï¼š" + method.getName());
        long startTime = System.currentTimeMillis();
        
        // è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•
        Object result = method.invoke(target, args);
        
        // æ–¹æ³•è°ƒç”¨åçš„å¤„ç†
        long endTime = System.currentTimeMillis();
        System.out.println("æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶ï¼š" + (endTime - startTime) + "ms");
        
        return result;
    }
}

// ä½¿ç”¨åŠ¨æ€ä»£ç†
public class ProxyExample {
    public static void main(String[] args) {
        // åˆ›å»ºçœŸå®å¯¹è±¡
        UserService userService = new UserServiceImpl();
        
        // åˆ›å»ºä»£ç†å¯¹è±¡
        UserService proxy = (UserService) Proxy.newProxyInstance(
            userService.getClass().getClassLoader(),    // ç±»åŠ è½½å™¨
            userService.getClass().getInterfaces(),     // æ¥å£æ•°ç»„
            new LoggingHandler(userService)             // è°ƒç”¨å¤„ç†å™¨
        );
        
        // ä½¿ç”¨ä»£ç†å¯¹è±¡
        proxy.login("å¼ ä¸‰", "123456");
        proxy.logout("å¼ ä¸‰");
    }
}
```

**âš¡ åŠ¨æ€ä»£ç†çš„ç‰¹ç‚¹**
```
ä¼˜ç‚¹ï¼š
âœ… ä¸€ä¸ªä»£ç†å¤„ç†å™¨å¯ä»¥ä»£ç†å¤šä¸ªç±»
âœ… ä»£ç å¤ç”¨æ€§å¥½
âœ… æ›´åŠ çµæ´»ï¼Œæ˜“äºç»´æŠ¤

ç¼ºç‚¹ï¼š
âŒ åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»
âŒ è¿è¡Œæ—¶åˆ›å»ºï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½
âŒ è°ƒè¯•ç›¸å¯¹å¤æ‚
```

### 2.3 CGLIBä»£ç†å®ç°


**ğŸ“ ä»€ä¹ˆæ˜¯CGLIBä»£ç†**
CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªåŸºäºASMçš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚CGLIBå¯ä»¥ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ã€‚

```java
import net.sf.cglib.proxy.Enhancer;
import net.sf.cglib.proxy.MethodInterceptor;
import net.sf.cglib.proxy.MethodProxy;
import java.lang.reflect.Method;

// æ²¡æœ‰å®ç°æ¥å£çš„æœåŠ¡ç±»
class OrderService {
    public void createOrder(String orderId) {
        System.out.println("åˆ›å»ºè®¢å•ï¼š" + orderId);
    }
    
    public void cancelOrder(String orderId) {
        System.out.println("å–æ¶ˆè®¢å•ï¼š" + orderId);
    }
}

// CGLIBæ–¹æ³•æ‹¦æˆªå™¨
class OrderServiceInterceptor implements MethodInterceptor {
    @Override
    public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable {
        System.out.println("CGLIBä»£ç†ï¼šè°ƒç”¨æ–¹æ³• " + method.getName());
        
        // è°ƒç”¨åŸå§‹æ–¹æ³•
        Object result = proxy.invokeSuper(obj, args);
        
        System.out.println("CGLIBä»£ç†ï¼šæ–¹æ³•è°ƒç”¨å®Œæˆ");
        return result;
    }
}

// ä½¿ç”¨CGLIBåˆ›å»ºä»£ç†
public class CglibProxyExample {
    public static void main(String[] args) {
        // åˆ›å»ºå¢å¼ºå™¨
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(OrderService.class);
        enhancer.setCallback(new OrderServiceInterceptor());
        
        // åˆ›å»ºä»£ç†å¯¹è±¡
        OrderService proxy = (OrderService) enhancer.create();
        
        // ä½¿ç”¨ä»£ç†å¯¹è±¡
        proxy.createOrder("ORDER001");
        proxy.cancelOrder("ORDER001");
    }
}
```

### 2.4 ä»£ç†å®ç°æ–¹å¼å¯¹æ¯”


| **ä»£ç†æ–¹å¼** | **å®ç°åŸç†** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-------------|-------------|-------------|----------|----------|
| **é™æ€ä»£ç†** | `æ‰‹å·¥ç¼–å†™ä»£ç†ç±»` | `ç®€å•å›ºå®šçš„ä»£ç†éœ€æ±‚` | `æ€§èƒ½å¥½ï¼Œç›´è§‚` | `ä»£ç é‡å¤ï¼Œä¸çµæ´»` |
| **JDKåŠ¨æ€ä»£ç†** | `åå°„+æ¥å£å®ç°` | `åŸºäºæ¥å£çš„ä»£ç†` | `çµæ´»ï¼Œä»£ç å¤ç”¨` | `åªèƒ½ä»£ç†æ¥å£` |
| **CGLIBä»£ç†** | `å­—èŠ‚ç ç”Ÿæˆ` | `ç±»ä»£ç†ï¼Œæ— æ¥å£` | `å¯ä»£ç†æ™®é€šç±»` | `æ€§èƒ½å¼€é”€ï¼Œä¾èµ–åº“` |

---

## 3. ğŸ• è™šæ‹Ÿä»£ç†ï¼šå»¶è¿ŸåŠ è½½


### 3.1 è™šæ‹Ÿä»£ç†çš„æ¦‚å¿µ


**ğŸ“ ä»€ä¹ˆæ˜¯è™šæ‹Ÿä»£ç†**
è™šæ‹Ÿä»£ç†æ˜¯ä¸€ç§å»¶è¿ŸåŠ è½½çš„ä»£ç†æ¨¡å¼ã€‚å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„å¼€é”€å¾ˆå¤§æ—¶ï¼Œè™šæ‹Ÿä»£ç†å¯ä»¥æ¨è¿Ÿå¯¹è±¡çš„åˆ›å»ºï¼Œç›´åˆ°çœŸæ­£éœ€è¦ä½¿ç”¨æ—¶æ‰åˆ›å»ºçœŸå®å¯¹è±¡ã€‚

```
è™šæ‹Ÿä»£ç†å·¥ä½œæµç¨‹ï¼š

å®¢æˆ·ç«¯è¯·æ±‚ â†’ ä»£ç†æ£€æŸ¥ â†’ çœŸå®å¯¹è±¡å­˜åœ¨ï¼Ÿ
                          â†“ No
                      åˆ›å»ºçœŸå®å¯¹è±¡
                          â†“ Yes
                      è°ƒç”¨çœŸå®å¯¹è±¡
```

**ğŸ¯ è™šæ‹Ÿä»£ç†è§£å†³çš„é—®é¢˜**
- **å‡å°‘å†…å­˜å ç”¨**ï¼šä¸ç«‹å³åˆ›å»ºå¤§å¯¹è±¡
- **æé«˜å¯åŠ¨é€Ÿåº¦**ï¼šå»¶è¿Ÿåˆå§‹åŒ–è€—æ—¶æ“ä½œ
- **èŠ‚çœç³»ç»Ÿèµ„æº**ï¼šæŒ‰éœ€åˆ†é…èµ„æº

### 3.2 å›¾ç‰‡å»¶è¿ŸåŠ è½½ç¤ºä¾‹


**ğŸ’» è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡å»¶è¿ŸåŠ è½½**
```java
// å›¾ç‰‡æ¥å£
interface Image {
    void display();
    int getWidth();
    int getHeight();
}

// çœŸå®å›¾ç‰‡ç±» - åŠ è½½è€—æ—¶
class RealImage implements Image {
    private String filename;
    private int width;
    private int height;
    
    public RealImage(String filename) {
        this.filename = filename;
        loadImageFromDisk(); // æ¨¡æ‹Ÿè€—æ—¶çš„åŠ è½½è¿‡ç¨‹
    }
    
    private void loadImageFromDisk() {
        System.out.println("æ­£åœ¨ä»ç£ç›˜åŠ è½½å›¾ç‰‡ï¼š" + filename);
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        try {
            Thread.sleep(2000); // å‡è®¾åŠ è½½éœ€è¦2ç§’
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        this.width = 800;
        this.height = 600;
        System.out.println("å›¾ç‰‡åŠ è½½å®Œæˆï¼š" + filename);
    }
    
    public void display() {
        System.out.println("æ˜¾ç¤ºå›¾ç‰‡ï¼š" + filename + " (" + width + "x" + height + ")");
    }
    
    public int getWidth() { return width; }
    public int getHeight() { return height; }
}

// è™šæ‹Ÿä»£ç† - å»¶è¿ŸåŠ è½½
class ImageProxy implements Image {
    private String filename;
    private RealImage realImage; // å»¶è¿Ÿåˆ›å»º
    
    public ImageProxy(String filename) {
        this.filename = filename;
        // æ³¨æ„ï¼šè¿™é‡Œä¸åˆ›å»ºçœŸå®å›¾ç‰‡å¯¹è±¡
    }
    
    public void display() {
        // åªæœ‰åœ¨çœŸæ­£éœ€è¦æ˜¾ç¤ºæ—¶æ‰åˆ›å»ºçœŸå®å¯¹è±¡
        if (realImage == null) {
            realImage = new RealImage(filename);
        }
        realImage.display();
    }
    
    public int getWidth() {
        // å¯ä»¥è¿”å›é»˜è®¤å€¼æˆ–ä»ç¼“å­˜è·å–
        return realImage != null ? realImage.getWidth() : 0;
    }
    
    public int getHeight() {
        return realImage != null ? realImage.getHeight() : 0;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class VirtualProxyExample {
    public static void main(String[] args) {
        System.out.println("åˆ›å»ºå›¾ç‰‡ä»£ç†å¯¹è±¡...");
        Image image1 = new ImageProxy("photo1.jpg");
        Image image2 = new ImageProxy("photo2.jpg");
        Image image3 = new ImageProxy("photo3.jpg");
        
        System.out.println("ä»£ç†å¯¹è±¡åˆ›å»ºå®Œæˆï¼Œç”¨æ—¶å‡ ä¹ä¸º0");
        System.out.println();
        
        System.out.println("ç°åœ¨æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡ï¼š");
        image1.display(); // è¿™æ—¶æ‰çœŸæ­£åŠ è½½å›¾ç‰‡
        
        System.out.println("\nå†æ¬¡æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡ï¼š");
        image1.display(); // ä¸éœ€è¦é‡æ–°åŠ è½½
    }
}
```

### 3.3 æ•°æ®åº“è¿æ¥æ± è™šæ‹Ÿä»£ç†


**ğŸ’» è™šæ‹Ÿä»£ç†å®ç°æ•°æ®åº“è¿æ¥å»¶è¿Ÿåˆ›å»º**
```java
// æ•°æ®åº“è¿æ¥æ¥å£
interface DatabaseConnection {
    void connect();
    void executeQuery(String sql);
    void close();
}

// çœŸå®æ•°æ®åº“è¿æ¥
class RealDatabaseConnection implements DatabaseConnection {
    private String url;
    private boolean connected = false;
    
    public RealDatabaseConnection(String url) {
        this.url = url;
        establishConnection(); // è€—æ—¶çš„è¿æ¥è¿‡ç¨‹
    }
    
    private void establishConnection() {
        System.out.println("æ­£åœ¨è¿æ¥æ•°æ®åº“ï¼š" + url);
        try {
            Thread.sleep(3000); // æ¨¡æ‹Ÿè¿æ¥è€—æ—¶
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        connected = true;
        System.out.println("æ•°æ®åº“è¿æ¥æˆåŠŸ");
    }
    
    public void connect() {
        if (!connected) {
            establishConnection();
        }
    }
    
    public void executeQuery(String sql) {
        if (connected) {
            System.out.println("æ‰§è¡ŒæŸ¥è¯¢ï¼š" + sql);
        }
    }
    
    public void close() {
        if (connected) {
            System.out.println("å…³é—­æ•°æ®åº“è¿æ¥");
            connected = false;
        }
    }
}

// æ•°æ®åº“è¿æ¥è™šæ‹Ÿä»£ç†
class DatabaseConnectionProxy implements DatabaseConnection {
    private String url;
    private RealDatabaseConnection realConnection;
    
    public DatabaseConnectionProxy(String url) {
        this.url = url;
        // ä¸ç«‹å³åˆ›å»ºçœŸå®è¿æ¥
    }
    
    public void connect() {
        getRealConnection().connect();
    }
    
    public void executeQuery(String sql) {
        // åªæœ‰åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰åˆ›å»ºçœŸå®è¿æ¥
        getRealConnection().executeQuery(sql);
    }
    
    public void close() {
        if (realConnection != null) {
            realConnection.close();
        }
    }
    
    private RealDatabaseConnection getRealConnection() {
        if (realConnection == null) {
            realConnection = new RealDatabaseConnection(url);
        }
        return realConnection;
    }
}
```

**âš¡ è™šæ‹Ÿä»£ç†çš„ä¼˜åŠ¿**
```
æ€§èƒ½æå‡ï¼š
â€¢ å¯åŠ¨æ—¶é—´å‡å°‘ â†’ ä¸ç«‹å³åˆ›å»ºé‡å¯¹è±¡
â€¢ å†…å­˜ä½¿ç”¨ä¼˜åŒ– â†’ æŒ‰éœ€åˆ†é…å†…å­˜
â€¢ å“åº”é€Ÿåº¦æå‡ â†’ å»¶è¿Ÿè€—æ—¶æ“ä½œ

ç”¨æˆ·ä½“éªŒï¼š
â€¢ ç•Œé¢å¿«é€Ÿå“åº” â†’ ä¸é˜»å¡ç”¨æˆ·æ“ä½œ
â€¢ æŒ‰éœ€åŠ è½½ â†’ ç”¨æˆ·å…³å¿ƒçš„å†…å®¹ä¼˜å…ˆ
â€¢ èŠ‚çœæµé‡ â†’ ç½‘ç»œèµ„æºæŒ‰éœ€è·å–
```

---

## 4. ğŸ›¡ï¸ ä¿æŠ¤ä»£ç†ï¼šè®¿é—®æ§åˆ¶


### 4.1 ä¿æŠ¤ä»£ç†çš„æ¦‚å¿µ


**ğŸ“ ä»€ä¹ˆæ˜¯ä¿æŠ¤ä»£ç†**
ä¿æŠ¤ä»£ç†ç”¨äºæ§åˆ¶å¯¹åŸå§‹å¯¹è±¡çš„è®¿é—®æƒé™ã€‚å®ƒå……å½“ä¸€ä¸ªå®ˆé—¨å‘˜çš„è§’è‰²ï¼Œæ£€æŸ¥è®¿é—®è€…æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸä¸ªæ“ä½œï¼Œåªæœ‰é€šè¿‡æƒé™éªŒè¯çš„è¯·æ±‚æ‰èƒ½è®¿é—®çœŸå®å¯¹è±¡ã€‚

```
ä¿æŠ¤ä»£ç†å·¥ä½œæµç¨‹ï¼š

å®¢æˆ·ç«¯è¯·æ±‚ â†’ ä»£ç†æƒé™æ£€æŸ¥ â†’ æƒé™éªŒè¯é€šè¿‡ï¼Ÿ
                           â†“ No
                       æŠ›å‡ºæƒé™å¼‚å¸¸
                           â†“ Yes
                       è°ƒç”¨çœŸå®å¯¹è±¡
```

**ğŸ¯ ä¿æŠ¤ä»£ç†çš„åº”ç”¨åœºæ™¯**
- **ç”¨æˆ·æƒé™æ§åˆ¶**ï¼šä¸åŒç”¨æˆ·æœ‰ä¸åŒçš„æ“ä½œæƒé™
- **è®¿é—®é¢‘ç‡é™åˆ¶**ï¼šé˜²æ­¢æ¶æ„é¢‘ç¹è®¿é—®
- **æ•æ„Ÿæ“ä½œä¿æŠ¤**ï¼šé‡è¦æ“ä½œéœ€è¦ç‰¹æ®Šæƒé™
- **èµ„æºè®¿é—®æ§åˆ¶**ï¼šé™åˆ¶å¯¹ç³»ç»Ÿèµ„æºçš„è®¿é—®

### 4.2 ç”¨æˆ·æƒé™ä¿æŠ¤ä»£ç†


**ğŸ’» æ–‡ä»¶ç³»ç»Ÿæƒé™æ§åˆ¶ç¤ºä¾‹**
```java
// ç”¨æˆ·ä¿¡æ¯
class User {
    private String username;
    private String role; // admin, user, guest
    
    public User(String username, String role) {
        this.username = username;
        this.role = role;
    }
    
    public String getUsername() { return username; }
    public String getRole() { return role; }
}

// æ–‡ä»¶æ“ä½œæ¥å£
interface FileSystem {
    void readFile(String filename);
    void writeFile(String filename, String content);
    void deleteFile(String filename);
}

// çœŸå®æ–‡ä»¶ç³»ç»Ÿ
class RealFileSystem implements FileSystem {
    public void readFile(String filename) {
        System.out.println("è¯»å–æ–‡ä»¶ï¼š" + filename);
    }
    
    public void writeFile(String filename, String content) {
        System.out.println("å†™å…¥æ–‡ä»¶ï¼š" + filename + "ï¼Œå†…å®¹ï¼š" + content);
    }
    
    public void deleteFile(String filename) {
        System.out.println("åˆ é™¤æ–‡ä»¶ï¼š" + filename);
    }
}

// ä¿æŠ¤ä»£ç† - æƒé™æ§åˆ¶
class ProtectedFileSystem implements FileSystem {
    private RealFileSystem realFileSystem;
    private User currentUser;
    
    public ProtectedFileSystem(User user) {
        this.currentUser = user;
        this.realFileSystem = new RealFileSystem();
    }
    
    public void readFile(String filename) {
        if (hasReadPermission()) {
            System.out.println("æƒé™æ£€æŸ¥é€šè¿‡ï¼š" + currentUser.getUsername() + " å¯ä»¥è¯»å–æ–‡ä»¶");
            realFileSystem.readFile(filename);
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼šæ— æ³•è¯»å–æ–‡ä»¶");
        }
    }
    
    public void writeFile(String filename, String content) {
        if (hasWritePermission()) {
            System.out.println("æƒé™æ£€æŸ¥é€šè¿‡ï¼š" + currentUser.getUsername() + " å¯ä»¥å†™å…¥æ–‡ä»¶");
            realFileSystem.writeFile(filename, content);
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼šæ— æ³•å†™å…¥æ–‡ä»¶");
        }
    }
    
    public void deleteFile(String filename) {
        if (hasDeletePermission()) {
            System.out.println("æƒé™æ£€æŸ¥é€šè¿‡ï¼š" + currentUser.getUsername() + " å¯ä»¥åˆ é™¤æ–‡ä»¶");
            realFileSystem.deleteFile(filename);
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼šæ— æ³•åˆ é™¤æ–‡ä»¶");
        }
    }
    
    private boolean hasReadPermission() {
        // æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è¯»å–
        return true;
    }
    
    private boolean hasWritePermission() {
        // åªæœ‰adminå’Œuserå¯ä»¥å†™å…¥
        return "admin".equals(currentUser.getRole()) || 
               "user".equals(currentUser.getRole());
    }
    
    private boolean hasDeletePermission() {
        // åªæœ‰adminå¯ä»¥åˆ é™¤
        return "admin".equals(currentUser.getRole());
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class ProtectionProxyExample {
    public static void main(String[] args) {
        // åˆ›å»ºä¸åŒæƒé™çš„ç”¨æˆ·
        User admin = new User("ç®¡ç†å‘˜", "admin");
        User normalUser = new User("æ™®é€šç”¨æˆ·", "user");
        User guest = new User("è®¿å®¢", "guest");
        
        // æµ‹è¯•ç®¡ç†å‘˜æƒé™
        System.out.println("=== ç®¡ç†å‘˜æ“ä½œ ===");
        FileSystem adminFS = new ProtectedFileSystem(admin);
        adminFS.readFile("config.txt");
        adminFS.writeFile("log.txt", "ç³»ç»Ÿæ—¥å¿—");
        adminFS.deleteFile("temp.txt");
        
        // æµ‹è¯•æ™®é€šç”¨æˆ·æƒé™
        System.out.println("\n=== æ™®é€šç”¨æˆ·æ“ä½œ ===");
        FileSystem userFS = new ProtectedFileSystem(normalUser);
        userFS.readFile("data.txt");
        userFS.writeFile("user_data.txt", "ç”¨æˆ·æ•°æ®");
        try {
            userFS.deleteFile("important.txt"); // è¿™ä¼šæŠ›å‡ºå¼‚å¸¸
        } catch (SecurityException e) {
            System.out.println("å¼‚å¸¸ï¼š" + e.getMessage());
        }
        
        // æµ‹è¯•è®¿å®¢æƒé™
        System.out.println("\n=== è®¿å®¢æ“ä½œ ===");
        FileSystem guestFS = new ProtectedFileSystem(guest);
        guestFS.readFile("public.txt");
        try {
            guestFS.writeFile("hack.txt", "æ¶æ„å†…å®¹"); // è¿™ä¼šæŠ›å‡ºå¼‚å¸¸
        } catch (SecurityException e) {
            System.out.println("å¼‚å¸¸ï¼š" + e.getMessage());
        }
    }
}
```

### 4.3 è®¿é—®é¢‘ç‡æ§åˆ¶ä»£ç†


**ğŸ’» APIè°ƒç”¨é¢‘ç‡é™åˆ¶ç¤ºä¾‹**
```java
import java.util.HashMap;
import java.util.Map;

// APIæœåŠ¡æ¥å£
interface ApiService {
    String getData(String userId);
    void updateData(String userId, String data);
}

// çœŸå®APIæœåŠ¡
class RealApiService implements ApiService {
    public String getData(String userId) {
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        return "ç”¨æˆ· " + userId + " çš„æ•°æ®";
    }
    
    public void updateData(String userId, String data) {
        System.out.println("æ›´æ–°ç”¨æˆ· " + userId + " çš„æ•°æ®ï¼š" + data);
    }
}

// é¢‘ç‡é™åˆ¶ä»£ç†
class RateLimitProxy implements ApiService {
    private RealApiService realService;
    private Map<String, Long> lastAccessTime;
    private Map<String, Integer> accessCount;
    private static final int MAX_REQUESTS_PER_MINUTE = 10;
    private static final long MINUTE_IN_MILLIS = 60 * 1000;
    
    public RateLimitProxy() {
        this.realService = new RealApiService();
        this.lastAccessTime = new HashMap<>();
        this.accessCount = new HashMap<>();
    }
    
    public String getData(String userId) {
        if (checkRateLimit(userId)) {
            System.out.println("é¢‘ç‡æ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡ŒgetData");
            return realService.getData(userId);
        } else {
            throw new RuntimeException("è®¿é—®é¢‘ç‡è¶…é™ï¼šè¯·ç¨åå†è¯•");
        }
    }
    
    public void updateData(String userId, String data) {
        if (checkRateLimit(userId)) {
            System.out.println("é¢‘ç‡æ£€æŸ¥é€šè¿‡ï¼Œæ‰§è¡ŒupdateData");
            realService.updateData(userId, data);
        } else {
            throw new RuntimeException("è®¿é—®é¢‘ç‡è¶…é™ï¼šè¯·ç¨åå†è¯•");
        }
    }
    
    private boolean checkRateLimit(String userId) {
        long currentTime = System.currentTimeMillis();
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„æ—¶é—´çª—å£
        Long lastTime = lastAccessTime.get(userId);
        if (lastTime == null || (currentTime - lastTime) > MINUTE_IN_MILLIS) {
            // æ–°çš„æ—¶é—´çª—å£ï¼Œé‡ç½®è®¡æ•°
            accessCount.put(userId, 1);
            lastAccessTime.put(userId, currentTime);
            return true;
        }
        
        // åœ¨åŒä¸€æ—¶é—´çª—å£å†…ï¼Œæ£€æŸ¥è®¿é—®æ¬¡æ•°
        int count = accessCount.getOrDefault(userId, 0);
        if (count < MAX_REQUESTS_PER_MINUTE) {
            accessCount.put(userId, count + 1);
            return true;
        }
        
        return false; // è¶…è¿‡é¢‘ç‡é™åˆ¶
    }
}
```

**âš¡ ä¿æŠ¤ä»£ç†çš„ä¼˜åŠ¿**
```
å®‰å…¨ä¿éšœï¼š
â€¢ æƒé™æ§åˆ¶ â†’ é˜²æ­¢æœªæˆæƒè®¿é—®
â€¢ é¢‘ç‡é™åˆ¶ â†’ é˜²æ­¢æ¶æ„æ”»å‡»
â€¢ æ“ä½œå®¡è®¡ â†’ è®°å½•æ•æ„Ÿæ“ä½œ

ç³»ç»Ÿç¨³å®šï¼š
â€¢ èµ„æºä¿æŠ¤ â†’ é¿å…èµ„æºæ»¥ç”¨
â€¢ è´Ÿè½½æ§åˆ¶ â†’ é˜²æ­¢ç³»ç»Ÿè¿‡è½½
â€¢ ä¼˜é›…é™çº§ â†’ è¶…é™æ—¶å‹å¥½æç¤º
```

---

## 5. ğŸ§  æ™ºèƒ½ä»£ç†ï¼šå¢å¼ºåŠŸèƒ½


### 5.1 æ™ºèƒ½ä»£ç†çš„æ¦‚å¿µ


**ğŸ“ ä»€ä¹ˆæ˜¯æ™ºèƒ½ä»£ç†**
æ™ºèƒ½ä»£ç†ä¸ä»…ä»…æ˜¯ç®€å•åœ°è½¬å‘è¯·æ±‚ï¼Œè€Œæ˜¯åœ¨è®¿é—®çœŸå®å¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œå¢åŠ é¢å¤–çš„æ™ºèƒ½åŠŸèƒ½ï¼Œæ¯”å¦‚ç¼“å­˜ã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€è‡ªåŠ¨é‡è¯•ç­‰ã€‚

```
æ™ºèƒ½ä»£ç†åŠŸèƒ½å±‚æ¬¡ï¼š

åŸºç¡€ä»£ç†ï¼šå®¢æˆ·ç«¯ â†’ ä»£ç† â†’ çœŸå®å¯¹è±¡
æ™ºèƒ½ä»£ç†ï¼šå®¢æˆ·ç«¯ â†’ ä»£ç†(ç¼“å­˜+æ—¥å¿—+ç›‘æ§+é‡è¯•) â†’ çœŸå®å¯¹è±¡
```

**ğŸ¯ æ™ºèƒ½ä»£ç†çš„å¸¸è§åŠŸèƒ½**
- **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜ç»“æœï¼Œæé«˜æ€§èƒ½
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ“ä½œæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- **æ€§èƒ½ç›‘æ§**ï¼šç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´
- **è‡ªåŠ¨é‡è¯•**ï¼šå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
- **ç»“æœè½¬æ¢**ï¼šå¯¹ç»“æœè¿›è¡Œæ ¼å¼è½¬æ¢
- **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†é€»è¾‘

### 5.2 ç¼“å­˜ä»£ç†å®ç°


**ğŸ’» æ™ºèƒ½ç¼“å­˜ä»£ç†ç¤ºä¾‹**
```java
import java.util.HashMap;
import java.util.Map;

// æ•°æ®æœåŠ¡æ¥å£
interface DataService {
    String fetchUserData(String userId);
    String fetchProductData(String productId);
}

// çœŸå®æ•°æ®æœåŠ¡ - æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
class RealDataService implements DataService {
    public String fetchUserData(String userId) {
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ
        try {
            Thread.sleep(1000); // 1ç§’å»¶è¿Ÿ
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return "User-" + userId + "-Data";
    }
    
    public String fetchProductData(String productId) {
        try {
            Thread.sleep(800); // 0.8ç§’å»¶è¿Ÿ
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return "Product-" + productId + "-Data";
    }
}

// æ™ºèƒ½ç¼“å­˜ä»£ç†
class CachingDataProxy implements DataService {
    private RealDataService realService;
    private Map<String, String> cache;
    private Map<String, Long> cacheTime;
    private static final long CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é’Ÿç¼“å­˜
    
    public CachingDataProxy() {
        this.realService = new RealDataService();
        this.cache = new HashMap<>();
        this.cacheTime = new HashMap<>();
    }
    
    public String fetchUserData(String userId) {
        String cacheKey = "user:" + userId;
        String cachedData = getFromCache(cacheKey);
        
        if (cachedData != null) {
            System.out.println("ç¼“å­˜å‘½ä¸­ï¼šè¿”å›ç”¨æˆ·æ•°æ® " + userId);
            return cachedData;
        }
        
        System.out.println("ç¼“å­˜æœªå‘½ä¸­ï¼šä»æ•°æ®åº“è·å–ç”¨æˆ·æ•°æ® " + userId);
        String data = realService.fetchUserData(userId);
        putToCache(cacheKey, data);
        return data;
    }
    
    public String fetchProductData(String productId) {
        String cacheKey = "product:" + productId;
        String cachedData = getFromCache(cacheKey);
        
        if (cachedData != null) {
            System.out.println("ç¼“å­˜å‘½ä¸­ï¼šè¿”å›äº§å“æ•°æ® " + productId);
            return cachedData;
        }
        
        System.out.println("ç¼“å­˜æœªå‘½ä¸­ï¼šä»æ•°æ®åº“è·å–äº§å“æ•°æ® " + productId);
        String data = realService.fetchProductData(productId);
        putToCache(cacheKey, data);
        return data;
    }
    
    private String getFromCache(String key) {
        Long timeStored = cacheTime.get(key);
        if (timeStored != null) {
            long currentTime = System.currentTimeMillis();
            if ((currentTime - timeStored) < CACHE_DURATION) {
                return cache.get(key);
            } else {
                // ç¼“å­˜è¿‡æœŸï¼Œæ¸…ç†
                cache.remove(key);
                cacheTime.remove(key);
            }
        }
        return null;
    }
    
    private void putToCache(String key, String data) {
        cache.put(key, data);
        cacheTime.put(key, System.currentTimeMillis());
    }
}
```

### 5.3 ç»¼åˆæ™ºèƒ½ä»£ç†å®ç°


**ğŸ’» å¤šåŠŸèƒ½æ™ºèƒ½ä»£ç†ç¤ºä¾‹**
```java
import java.util.concurrent.TimeUnit;

// æ™ºèƒ½ä»£ç† - é›†æˆå¤šç§åŠŸèƒ½
class SmartProxy implements DataService {
    private RealDataService realService;
    private Map<String, String> cache;
    private Map<String, Long> cacheTime;
    
    public SmartProxy() {
        this.realService = new RealDataService();
        this.cache = new HashMap<>();
        this.cacheTime = new HashMap<>();
    }
    
    public String fetchUserData(String userId) {
        return executeWithEnhancements("fetchUserData", userId, 
            () -> realService.fetchUserData(userId));
    }
    
    public String fetchProductData(String productId) {
        return executeWithEnhancements("fetchProductData", productId,
            () -> realService.fetchProductData(productId));
    }
    
    // å¸¦å¢å¼ºåŠŸèƒ½çš„æ‰§è¡Œæ–¹æ³•
    private String executeWithEnhancements(String methodName, String param, 
                                         DataSupplier supplier) {
        // 1. æ—¥å¿—è®°å½• - å¼€å§‹
        long startTime = System.currentTimeMillis();
        System.out.println("[LOG] å¼€å§‹æ‰§è¡Œ " + methodName + "ï¼Œå‚æ•°ï¼š" + param);
        
        // 2. ç¼“å­˜æ£€æŸ¥
        String cacheKey = methodName + ":" + param;
        String cachedResult = getFromCache(cacheKey);
        if (cachedResult != null) {
            System.out.println("[CACHE] ç¼“å­˜å‘½ä¸­");
            logCompletion(methodName, startTime, true);
            return cachedResult;
        }
        
        // 3. è‡ªåŠ¨é‡è¯•æœºåˆ¶
        String result = null;
        int retryCount = 0;
        int maxRetries = 3;
        
        while (retryCount <= maxRetries) {
            try {
                result = supplier.get();
                break; // æˆåŠŸï¼Œé€€å‡ºé‡è¯•å¾ªç¯
            } catch (Exception e) {
                retryCount++;
                System.out.println("[RETRY] ç¬¬" + retryCount + "æ¬¡é‡è¯•ï¼ŒåŸå› ï¼š" + e.getMessage());
                
                if (retryCount > maxRetries) {
                    System.out.println("[ERROR] é‡è¯•æ¬¡æ•°è¶…é™ï¼Œæ‰§è¡Œå¤±è´¥");
                    throw new RuntimeException("æ‰§è¡Œå¤±è´¥ï¼Œå·²é‡è¯•" + maxRetries + "æ¬¡", e);
                }
                
                // é‡è¯•å»¶è¿Ÿ
                try {
                    TimeUnit.SECONDS.sleep(1);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("é‡è¯•è¢«ä¸­æ–­", ie);
                }
            }
        }
        
        // 4. ç»“æœç¼“å­˜
        if (result != null) {
            putToCache(cacheKey, result);
        }
        
        // 5. æ—¥å¿—è®°å½• - å®Œæˆ
        logCompletion(methodName, startTime, false);
        
        return result;
    }
    
    // æ—¥å¿—è®°å½•æ–¹æ³•
    private void logCompletion(String methodName, long startTime, boolean fromCache) {
        long duration = System.currentTimeMillis() - startTime;
        String source = fromCache ? "ç¼“å­˜" : "æ•°æ®æº";
        System.out.println("[LOG] " + methodName + " æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶ï¼š" + duration + "msï¼Œæ¥æºï¼š" + source);
    }
    
    // ç¼“å­˜ç›¸å…³æ–¹æ³•
    private String getFromCache(String key) {
        Long timeStored = cacheTime.get(key);
        if (timeStored != null) {
            long currentTime = System.currentTimeMillis();
            if ((currentTime - timeStored) < 300000) { // 5åˆ†é’Ÿç¼“å­˜
                return cache.get(key);
            } else {
                cache.remove(key);
                cacheTime.remove(key);
            }
        }
        return null;
    }
    
    private void putToCache(String key, String data) {
        cache.put(key, data);
        cacheTime.put(key, System.currentTimeMillis());
    }
}

// å‡½æ•°å¼æ¥å£ï¼Œç”¨äºé‡è¯•æœºåˆ¶
@FunctionalInterface
interface DataSupplier {
    String get() throws Exception;
}

// ä½¿ç”¨ç¤ºä¾‹
public class SmartProxyExample {
    public static void main(String[] args) {
        DataService smartService = new SmartProxy();
        
        System.out.println("=== ç¬¬ä¸€æ¬¡è°ƒç”¨ ===");
        String userData = smartService.fetchUserData("123");
        System.out.println("ç»“æœï¼š" + userData);
        
        System.out.println("\n=== ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆåº”è¯¥ä½¿ç”¨ç¼“å­˜ï¼‰===");
        userData = smartService.fetchUserData("123");
        System.out.println("ç»“æœï¼š" + userData);
    }
}
```

**âš¡ æ™ºèƒ½ä»£ç†çš„ä¼˜åŠ¿**
```
æ€§èƒ½æå‡ï¼š
â€¢ ç¼“å­˜æœºåˆ¶ â†’ å‡å°‘é‡å¤è®¡ç®—
â€¢ é¢„å–ç­–ç•¥ â†’ æå‰åŠ è½½æ•°æ®
â€¢ æ‰¹é‡å¤„ç† â†’ ä¼˜åŒ–ç½‘ç»œè°ƒç”¨

å¯é æ€§å¢å¼ºï¼š
â€¢ è‡ªåŠ¨é‡è¯• â†’ å¤„ç†ä¸´æ—¶æ•…éšœ
â€¢ é™çº§ç­–ç•¥ â†’ æœåŠ¡ä¸å¯ç”¨æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ
â€¢ å¼‚å¸¸å¤„ç† â†’ ç»Ÿä¸€é”™è¯¯å¤„ç†

è¿ç»´ä¾¿åˆ©ï¼š
â€¢ æ—¥å¿—è®°å½• â†’ ä¾¿äºé—®é¢˜æ’æŸ¥
â€¢ ç›‘æ§æŒ‡æ ‡ â†’ æ€§èƒ½åˆ†æ
â€¢ ç»Ÿè®¡ä¿¡æ¯ â†’ ä¸šåŠ¡åˆ†æ
```

---

## 6. ğŸ”„ ä»£ç†vsè£…é¥°å™¨æ¨¡å¼


### 6.1 æ¨¡å¼å¯¹æ¯”æ¦‚è¿°


**ğŸ“ ç›¸ä¼¼ç‚¹ä¸ä¸åŒç‚¹**

```
ç›¸ä¼¼ç‚¹ï¼š
â€¢ éƒ½æŒæœ‰å¯¹åŸå¯¹è±¡çš„å¼•ç”¨
â€¢ éƒ½å¯ä»¥åœ¨è°ƒç”¨å‰åæ·»åŠ åŠŸèƒ½
â€¢ éƒ½å®ç°äº†ç›¸åŒçš„æ¥å£
â€¢ éƒ½æ˜¯ç»“æ„å‹è®¾è®¡æ¨¡å¼

å…³é”®ä¸åŒï¼š
ä»£ç†æ¨¡å¼ï¼šæ§åˆ¶è®¿é—®ï¼Œç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ
è£…é¥°å™¨æ¨¡å¼ï¼šå¢å¼ºåŠŸèƒ½ï¼Œä¸æ”¹å˜å¯¹è±¡æ¥å£
```

### 6.2 æ„å›¾å’Œç›®çš„å¯¹æ¯”


| **å¯¹æ¯”ç»´åº¦** | **ä»£ç†æ¨¡å¼** | **è£…é¥°å™¨æ¨¡å¼** |
|-------------|-------------|----------------|
| **ä¸»è¦ç›®çš„** | `æ§åˆ¶å¯¹è±¡è®¿é—®` | `å¢å¼ºå¯¹è±¡åŠŸèƒ½` |
| **å…³æ³¨ç‚¹** | `è®¿é—®æ§åˆ¶ã€å»¶è¿ŸåŠ è½½ã€æƒé™ç®¡ç†` | `åŠŸèƒ½æ‰©å±•ã€è¡Œä¸ºå¢å¼º` |
| **å¯¹è±¡å…³ç³»** | `ä»£ç†"ä»£è¡¨"çœŸå®å¯¹è±¡` | `è£…é¥°å™¨"åŒ…è£…"åŸå¯¹è±¡` |
| **åˆ›å»ºæ—¶æœº** | `é€šå¸¸åœ¨å®¢æˆ·ç«¯ä¸çŸ¥æƒ…ä¸‹åˆ›å»º` | `å®¢æˆ·ç«¯ä¸»åŠ¨é€‰æ‹©è£…é¥°` |

### 6.3 å…·ä½“å®ç°å¯¹æ¯”


**ğŸ’» ä»£ç†æ¨¡å¼ç¤ºä¾‹**
```java
// ä»£ç†æ¨¡å¼ï¼šé‡ç‚¹æ˜¯æ§åˆ¶è®¿é—®
class ImageProxy implements Image {
    private String filename;
    private RealImage realImage;
    
    public ImageProxy(String filename) {
        this.filename = filename;
        // ä»£ç†æ§åˆ¶ä½•æ—¶åˆ›å»ºçœŸå®å¯¹è±¡
    }
    
    public void display() {
        // ä»£ç†å†³å®šæ˜¯å¦å…è®¸è®¿é—®
        if (checkPermission()) {
            if (realImage == null) {
                realImage = new RealImage(filename); // å»¶è¿Ÿåˆ›å»º
            }
            realImage.display();
        } else {
            System.out.println("æƒé™ä¸è¶³ï¼Œæ— æ³•æ˜¾ç¤ºå›¾ç‰‡");
        }
    }
    
    private boolean checkPermission() {
        // ä»£ç†çš„æ ¸å¿ƒï¼šè®¿é—®æ§åˆ¶
        return true; // ç®€åŒ–çš„æƒé™æ£€æŸ¥
    }
}
```

**ğŸ’» è£…é¥°å™¨æ¨¡å¼ç¤ºä¾‹**
```java
// è£…é¥°å™¨æ¨¡å¼ï¼šé‡ç‚¹æ˜¯åŠŸèƒ½å¢å¼º
class BorderDecorator implements Image {
    private Image image;
    
    public BorderDecorator(Image image) {
        this.image = image; // è£…é¥°å·²å­˜åœ¨çš„å¯¹è±¡
    }
    
    public void display() {
        addBorder(); // è£…é¥°å™¨æ·»åŠ æ–°åŠŸèƒ½
        image.display(); // ä¿æŒåŸæœ‰åŠŸèƒ½
        addBorder();
    }
    
    private void addBorder() {
        System.out.println("----è¾¹æ¡†----");
    }
}

// å¯ä»¥å¤šå±‚è£…é¥°
class ShadowDecorator implements Image {
    private Image image;
    
    public ShadowDecorator(Image image) {
        this.image = image;
    }
    
    public void display() {
        image.display();
        addShadow(); // æ·»åŠ é˜´å½±æ•ˆæœ
    }
    
    private void addShadow() {
        System.out.println("æ·»åŠ é˜´å½±æ•ˆæœ");
    }
}

// ä½¿ç”¨è£…é¥°å™¨
public class DecoratorExample {
    public static void main(String[] args) {
        Image image = new RealImage("photo.jpg");
        
        // å¯ä»¥è‡ªç”±ç»„åˆè£…é¥°å™¨
        Image decoratedImage = new ShadowDecorator(
            new BorderDecorator(image)
        );
        
        decoratedImage.display();
    }
}
```

### 6.4 ä½¿ç”¨åœºæ™¯å¯¹æ¯”


**ğŸ¯ ä»£ç†æ¨¡å¼é€‚ç”¨åœºæ™¯**
```
è®¿é—®æ§åˆ¶åœºæ™¯ï¼š
â€¢ æƒé™éªŒè¯ï¼šç”¨æˆ·æƒé™æ£€æŸ¥
â€¢ é¢‘ç‡é™åˆ¶ï¼šAPIè°ƒç”¨é™åˆ¶
â€¢ å®‰å…¨ä¿æŠ¤ï¼šæ•æ„Ÿæ“ä½œä¿æŠ¤

æ€§èƒ½ä¼˜åŒ–åœºæ™¯ï¼š
â€¢ å»¶è¿ŸåŠ è½½ï¼šå¤§å¯¹è±¡å»¶è¿Ÿåˆ›å»º
â€¢ ç¼“å­˜ä»£ç†ï¼šç»“æœç¼“å­˜
â€¢ è¿œç¨‹ä»£ç†ï¼šç½‘ç»œè°ƒç”¨ä¼˜åŒ–

èµ„æºç®¡ç†åœºæ™¯ï¼š
â€¢ è¿æ¥æ± ï¼šæ•°æ®åº“è¿æ¥ç®¡ç†
â€¢ å¯¹è±¡æ± ï¼šé‡é‡çº§å¯¹è±¡å¤ç”¨
â€¢ ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šå¯¹è±¡åˆ›å»ºé”€æ¯æ§åˆ¶
```

**ğŸ¯ è£…é¥°å™¨æ¨¡å¼é€‚ç”¨åœºæ™¯**
```
åŠŸèƒ½å¢å¼ºåœºæ™¯ï¼š
â€¢ UIç»„ä»¶ï¼šè¾¹æ¡†ã€æ»šåŠ¨æ¡ã€é˜´å½±
â€¢ æ•°æ®å¤„ç†ï¼šåŠ å¯†ã€å‹ç¼©ã€æ ¼å¼åŒ–
â€¢ æµå¤„ç†ï¼šBufferedReaderã€GZIPInputStream

è¡Œä¸ºæ‰©å±•åœºæ™¯ï¼š
â€¢ æ—¥å¿—è®°å½•ï¼šæ–¹æ³•è°ƒç”¨æ—¥å¿—
â€¢ æ€§èƒ½ç›‘æ§ï¼šæ‰§è¡Œæ—¶é—´ç»Ÿè®¡
â€¢ äº‹åŠ¡å¤„ç†ï¼šæ•°æ®åº“äº‹åŠ¡åŒ…è£…

å¤šæ ·åŒ–ç»„åˆåœºæ™¯ï¼š
â€¢ å’–å•¡è®¢å•ï¼šå„ç§é…æ–™ç»„åˆ
â€¢ æ–‡æœ¬å¤„ç†ï¼šå„ç§æ ¼å¼åŒ–ç»„åˆ
â€¢ å›¾ç‰‡å¤„ç†ï¼šå„ç§æ»¤é•œç»„åˆ
```

### 6.5 é€‰æ‹©æŒ‡å¯¼åŸåˆ™


**ğŸ“‹ å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¨¡å¼**

```java
// åˆ¤æ–­æ ‡å‡†ï¼š
if (ç›®çš„æ˜¯æ§åˆ¶è®¿é—® || ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ) {
    ä½¿ç”¨ä»£ç†æ¨¡å¼;
    /*
     * å…³é”®è¯ï¼šæ§åˆ¶ã€ç®¡ç†ã€ä¿æŠ¤ã€å»¶è¿Ÿ
     * ä¾‹å¦‚ï¼šæƒé™æ£€æŸ¥ã€å»¶è¿ŸåŠ è½½ã€ç¼“å­˜æ§åˆ¶
     */
} else if (ç›®çš„æ˜¯å¢å¼ºåŠŸèƒ½ || ç»„åˆè¡Œä¸º) {
    ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼;
    /*
     * å…³é”®è¯ï¼šå¢å¼ºã€è£…é¥°ã€ç»„åˆã€æ‰©å±•
     * ä¾‹å¦‚ï¼šæ·»åŠ è¾¹æ¡†ã€å¢åŠ åŠŸèƒ½ã€ç»„åˆæ•ˆæœ
     */
}
```

**âš¡ å®é™…é€‰æ‹©å»ºè®®**
```
ä»£ç†æ¨¡å¼é€‰æ‹©æ—¶æœºï¼š
â€¢ éœ€è¦æ§åˆ¶å¯¹è±¡çš„è®¿é—®æƒé™
â€¢ éœ€è¦å»¶è¿Ÿå¯¹è±¡çš„åˆ›å»ºæˆ–åˆå§‹åŒ–
â€¢ éœ€è¦åœ¨è®¿é—®å¯¹è±¡å‰åæ·»åŠ æ§åˆ¶é€»è¾‘
â€¢ å®¢æˆ·ç«¯ä¸åº”è¯¥ç›´æ¥è®¿é—®çœŸå®å¯¹è±¡

è£…é¥°å™¨æ¨¡å¼é€‰æ‹©æ—¶æœºï¼š
â€¢ éœ€è¦åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½
â€¢ éœ€è¦å¤šç§åŠŸèƒ½çš„è‡ªç”±ç»„åˆ
â€¢ ä¸æƒ³é€šè¿‡ç»§æ‰¿æ¥æ‰©å±•åŠŸèƒ½
â€¢ å¸Œæœ›ä¿æŒæ¥å£çš„ä¸€è‡´æ€§
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä»£ç†æ¨¡å¼æœ¬è´¨ï¼šæ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼Œå……å½“ä¸­ä»‹è§’è‰²
ğŸ”¸ ä¸‰ç§ä»£ç†ç±»å‹ï¼šè™šæ‹Ÿä»£ç†ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰ã€ä¿æŠ¤ä»£ç†ï¼ˆè®¿é—®æ§åˆ¶ï¼‰ã€æ™ºèƒ½ä»£ç†ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰
ğŸ”¸ å®ç°æ–¹å¼ï¼šé™æ€ä»£ç†ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰ã€åŠ¨æ€ä»£ç†ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
ğŸ”¸ æ ¸å¿ƒä»·å€¼ï¼šåœ¨ä¸æ”¹å˜åŸå¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œå¢åŠ æ§åˆ¶å’Œå¢å¼ºåŠŸèƒ½
ğŸ”¸ ä¸è£…é¥°å™¨åŒºåˆ«ï¼šä»£ç†é‡åœ¨æ§åˆ¶è®¿é—®ï¼Œè£…é¥°å™¨é‡åœ¨åŠŸèƒ½å¢å¼º
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³**
```
æ§åˆ¶è®¿é—®çš„è‰ºæœ¯ï¼š
â€¢ ä¸æ˜¯ç®€å•çš„æ–¹æ³•è½¬å‘
â€¢ è€Œæ˜¯åœ¨è½¬å‘è¿‡ç¨‹ä¸­åŠ å…¥æ§åˆ¶é€»è¾‘
â€¢ å¯ä»¥å†³å®šæ˜¯å¦ã€ä½•æ—¶ã€å¦‚ä½•è®¿é—®çœŸå®å¯¹è±¡

ä¸­ä»‹è€…çš„ä»·å€¼ï¼š
â€¢ å®¢æˆ·ç«¯ä¸çœŸå®å¯¹è±¡ä¹‹é—´çš„ç¼“å†²å±‚
â€¢ å¯ä»¥é€æ˜åœ°æ·»åŠ å„ç§åŠŸèƒ½
â€¢ ä¿æŠ¤çœŸå®å¯¹è±¡ä¸è¢«ç›´æ¥è®¿é—®
```

**ğŸ”¹ ä¸åŒä»£ç†ç±»å‹çš„åº”ç”¨**
```
è™šæ‹Ÿä»£ç† â†’ æ€§èƒ½ä¼˜åŒ–ï¼š
â€¢ å»¶è¿Ÿåˆ›å»ºé‡é‡çº§å¯¹è±¡
â€¢ æŒ‰éœ€åŠ è½½èµ„æº
â€¢ æé«˜ç¨‹åºå¯åŠ¨é€Ÿåº¦

ä¿æŠ¤ä»£ç† â†’ å®‰å…¨æ§åˆ¶ï¼š
â€¢ æƒé™éªŒè¯å’Œè®¿é—®æ§åˆ¶
â€¢ é¢‘ç‡é™åˆ¶å’Œé˜²æŠ¤
â€¢ æ•æ„Ÿæ“ä½œä¿æŠ¤

æ™ºèƒ½ä»£ç† â†’ åŠŸèƒ½å¢å¼ºï¼š
â€¢ ç¼“å­˜ã€æ—¥å¿—ã€ç›‘æ§
â€¢ è‡ªåŠ¨é‡è¯•å’Œé™çº§
â€¢ ç»Ÿä¸€å¼‚å¸¸å¤„ç†
```

**ğŸ”¹ å®ç°æ–¹å¼çš„é€‰æ‹©**
```
é™æ€ä»£ç†ï¼š
â€¢ ç®€å•ç›´æ¥ï¼Œæ€§èƒ½å¥½
â€¢ é€‚åˆå›ºå®šçš„ä»£ç†éœ€æ±‚
â€¢ ä»£ç ç›¸å¯¹å†—ä½™

åŠ¨æ€ä»£ç†ï¼š
â€¢ çµæ´»é€šç”¨ï¼Œä»£ç å¤ç”¨
â€¢ é€‚åˆé€šç”¨çš„ä»£ç†é€»è¾‘
â€¢ è¿è¡Œæ—¶ç”Ÿæˆï¼Œæ€§èƒ½ç•¥ä½
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨**
- **Webå¼€å‘**ï¼šAOPåˆ‡é¢ç¼–ç¨‹ã€æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•
- **ç¼“å­˜ç³»ç»Ÿ**ï¼šæ•°æ®ç¼“å­˜ã€ç»“æœç¼“å­˜ã€æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- **æ•°æ®åº“è®¿é—®**ï¼šè¿æ¥æ± ç®¡ç†ã€äº‹åŠ¡æ§åˆ¶ã€æŸ¥è¯¢ä¼˜åŒ–
- **ç½‘ç»œç¼–ç¨‹**ï¼šè¿œç¨‹è°ƒç”¨ä»£ç†ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœè½¬ç§»
- **å®‰å…¨ç³»ç»Ÿ**ï¼šè®¿é—®æ§åˆ¶ã€å®¡è®¡æ—¥å¿—ã€æƒé™éªŒè¯

**ğŸ”§ å·¥ç¨‹å®è·µæŠ€å·§**
```
è®¾è®¡åŸåˆ™ï¼š
â€¢ ä¿æŒæ¥å£ä¸€è‡´æ€§
â€¢ æœ€å°åŒ–ä»£ç†å¼€é”€
â€¢ åˆç†é€‰æ‹©ä»£ç†ç±»å‹
â€¢ è€ƒè™‘çº¿ç¨‹å®‰å…¨

æ€§èƒ½è€ƒè™‘ï¼š
â€¢ é¿å…è¿‡åº¦ä»£ç†
â€¢ åˆç†ä½¿ç”¨ç¼“å­˜
â€¢ æ³¨æ„å†…å­˜æ³„æ¼
â€¢ ç›‘æ§ä»£ç†æ€§èƒ½

ä»£ç è´¨é‡ï¼š
â€¢ ä¿æŒä»£ç†é€»è¾‘ç®€å•
â€¢ é¿å…å¾ªç¯ä¾èµ–
â€¢ ç»Ÿä¸€å¼‚å¸¸å¤„ç†
â€¢ è‰¯å¥½çš„æ—¥å¿—è®°å½•
```

### 7.4 å­¦ä¹ å»ºè®®


**ğŸ“š æŒæ¡è·¯å¾„**
1. **ç†è§£æ¦‚å¿µ**ï¼šæ˜ç¡®ä»£ç†æ¨¡å¼çš„æœ¬è´¨å’Œç›®çš„
2. **åŒºåˆ†ç±»å‹**ï¼šæŒæ¡ä¸‰ç§ä»£ç†ç±»å‹çš„ç‰¹ç‚¹å’Œåº”ç”¨
3. **å®ç°æ–¹å¼**ï¼šç†Ÿç»ƒæŒæ¡é™æ€å’ŒåŠ¨æ€ä»£ç†çš„å®ç°
4. **å¯¹æ¯”å­¦ä¹ **ï¼šç†è§£ä¸è£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«
5. **å®è·µåº”ç”¨**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­è¿ç”¨ä»£ç†æ¨¡å¼

**ğŸ’¡ è®°å¿†è¦ç‚¹**
- **ä»£ç†æ¨¡å¼**ï¼šæˆ‘æ˜¯ä½ çš„ä»£ç†äººï¼Œæˆ‘æ¥æ§åˆ¶å¯¹ä½ çš„è®¿é—®
- **è™šæ‹Ÿä»£ç†**ï¼šéœ€è¦æ—¶å†åˆ›å»ºï¼ŒèŠ‚çœèµ„æºææ€§èƒ½
- **ä¿æŠ¤ä»£ç†**ï¼šæˆ‘æ˜¯å®ˆé—¨å‘˜ï¼Œæ£€æŸ¥æƒé™å†æ”¾è¡Œ
- **æ™ºèƒ½ä»£ç†**ï¼šä¸ä»…ä»£ç†è®¿é—®ï¼Œè¿˜èƒ½å¢å¼ºåŠŸèƒ½
- **vsè£…é¥°å™¨**ï¼šæˆ‘æ§åˆ¶è®¿é—®ï¼Œè£…é¥°å™¨å¢å¼ºåŠŸèƒ½

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä»£ç†æ¨¡å¼æ§è®¿é—®ï¼Œä¸­ä»‹ä½œç”¨å¾ˆé‡è¦
- è™šæ‹Ÿä»£ç†å»¶è¿Ÿåˆ›ï¼Œä¿æŠ¤ä»£ç†æ§æƒé™
- æ™ºèƒ½ä»£ç†èƒ½å¢å¼ºï¼Œè£…é¥°æ¨¡å¼åŠŸèƒ½æ·»
- é™æ€ç¼–è¯‘æ—¶ç¡®å®šï¼ŒåŠ¨æ€è¿è¡Œæ—¶ç”Ÿæˆ