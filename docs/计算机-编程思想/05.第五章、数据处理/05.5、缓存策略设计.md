---
title: 5ã€ç¼“å­˜ç­–ç•¥è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜æ˜¯ä»€ä¹ˆ](#1-ç¼“å­˜æ˜¯ä»€ä¹ˆ)
2. [ç¼“å­˜ä½¿ç”¨åœºæ™¯åˆ†æ](#2-ç¼“å­˜ä½¿ç”¨åœºæ™¯åˆ†æ)
3. [Cache-Asideæ¨¡å¼è¯¦è§£](#3-Cache-Asideæ¨¡å¼è¯¦è§£)
4. [ç¼“å­˜æ›´æ–°ç­–ç•¥](#4-ç¼“å­˜æ›´æ–°ç­–ç•¥)
5. [ç¼“å­˜å±‚æ¬¡è®¾è®¡](#5-ç¼“å­˜å±‚æ¬¡è®¾è®¡)
6. [ç¼“å­˜ä¼˜å…ˆç­–ç•¥å®æˆ˜](#6-ç¼“å­˜ä¼˜å…ˆç­–ç•¥å®æˆ˜)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¾ ç¼“å­˜æ˜¯ä»€ä¹ˆ


### 1.1 ç¼“å­˜çš„æœ¬è´¨ç†è§£


> **ç¼“å­˜å°±åƒä¹¦æ¡Œä¸Šçš„å¸¸ç”¨ç‰©å“**ï¼šä½ æŠŠç»å¸¸ç”¨çš„ç¬”ã€è®¡ç®—å™¨æ”¾åœ¨æ‰‹è¾¹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½å»æŸœå­é‡Œç¿»æ‰¾ã€‚

**ğŸ”¸ ç¼“å­˜çš„æ ¸å¿ƒæ¦‚å¿µ**
```
ç¼“å­˜ = ä¸´æ—¶å­˜å‚¨ + å¿«é€Ÿè®¿é—® + å‡å°‘é‡å¤å·¥ä½œ

ç”Ÿæ´»ç±»æ¯”ï¼š
å’–å•¡æœºæ—çš„ç³–åŒ…ç›’  â†’  ä¸ç”¨æ¯æ¬¡å»å¨æˆ¿æ‹¿ç³–
æ‰‹æœºé‡Œçš„è”ç³»äºº    â†’  ä¸ç”¨æ¯æ¬¡æŸ¥ç”µè¯ç°¿  
æµè§ˆå™¨çš„ç½‘é¡µç¼“å­˜  â†’  ä¸ç”¨é‡å¤ä¸‹è½½å›¾ç‰‡
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜**

```
é—®é¢˜åœºæ™¯ï¼šç”µå•†ç½‘ç«™å•†å“è¯¦æƒ…é¡µ

æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ è¿”å›ç»“æœ
æ¯æ¬¡éƒ½è¦ï¼šè¿æ¥æ•°æ®åº“ + æ‰§è¡ŒSQL + ç½‘ç»œä¼ è¾“ = æ…¢ï¼

æœ‰ç¼“å­˜çš„æƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ ç¼“å­˜ä¸­ç›´æ¥å– â†’ è¿”å›ç»“æœ  
åªéœ€è¦ï¼šå†…å­˜è¯»å– = å¿«ï¼
```

### 1.2 ç¼“å­˜çš„å·¥ä½œåŸç†


**ğŸ”„ ç¼“å­˜å·¥ä½œæµç¨‹å›¾**

```
ç¼“å­˜å·¥ä½œæµç¨‹ï¼š

è¯·æ±‚æ•°æ®
    â†“
æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨
    â†“
â”Œâ”€å­˜åœ¨(ç¼“å­˜å‘½ä¸­)â”€â†’ ç›´æ¥è¿”å›ç¼“å­˜æ•°æ® âœ… å¿«é€Ÿå“åº”
â”‚
â””â”€ä¸å­˜åœ¨(ç¼“å­˜æœªå‘½ä¸­)
    â†“
ä»æ•°æ®æºè·å–æ•°æ®
    â†“
å°†æ•°æ®å­˜å…¥ç¼“å­˜
    â†“
è¿”å›æ•°æ®ç»™ç”¨æˆ·
```

**âš¡ ç¼“å­˜çš„æ ¸å¿ƒä¼˜åŠ¿**

| **ä¼˜åŠ¿** | **å…·ä½“è¡¨ç°** | **å®é™…æ”¶ç›Š** |
|---------|-------------|-------------|
| **é€Ÿåº¦å¿«** | `å†…å­˜è®¿é—® vs ç£ç›˜è®¿é—®` | `æ¯«ç§’çº§ vs ç§’çº§å“åº”` |
| **å‡è´Ÿè½½** | `å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°` | `æ•°æ®åº“å‹åŠ›é™ä½80%+` |
| **é«˜å¹¶å‘** | `ç¼“å­˜å¯æ‰¿å—æ›´é«˜QPS` | `æ”¯æŒæ›´å¤šç”¨æˆ·è®¿é—®` |
| **èŠ‚çº¦æˆæœ¬** | `å‡å°‘ç¡¬ä»¶èµ„æºæ¶ˆè€—` | `é™ä½æœåŠ¡å™¨æˆæœ¬` |

---

## 2. ğŸ¯ ç¼“å­˜ä½¿ç”¨åœºæ™¯åˆ†æ


### 2.1 çƒ­ç‚¹æ•°æ®ç¼“å­˜


**ğŸ”¥ ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®**

> **çƒ­ç‚¹æ•°æ®**ï¼šå°±åƒå•†åœºé‡Œçš„çƒ­é”€å•†å“ï¼Œå¤§å®¶éƒ½æƒ³è¦ï¼Œè¢«é¢‘ç¹è®¿é—®çš„æ•°æ®ã€‚

**å…¸å‹çƒ­ç‚¹æ•°æ®åœºæ™¯ï¼š**

```java
// ç”µå•†ç½‘ç«™çƒ­ç‚¹æ•°æ®ç¤ºä¾‹
class HotDataExamples {
    
    // 1. å•†å“ä¿¡æ¯ - çˆ†æ¬¾å•†å“è¢«å¤§é‡ç”¨æˆ·æµè§ˆ
    Product getPopularProduct(String productId) {
        // iPhoneæ–°æ¬¾ã€ç½‘çº¢å•†å“ç­‰
        return cacheService.get("product:" + productId);
    }
    
    // 2. ç”¨æˆ·ä¿¡æ¯ - æ´»è·ƒç”¨æˆ·é¢‘ç¹æ“ä½œ
    User getActiveUser(String userId) {
        // å¤§Vç”¨æˆ·ã€é¢‘ç¹è´­ä¹°çš„ç”¨æˆ·
        return cacheService.get("user:" + userId);
    }
    
    // 3. é…ç½®ä¿¡æ¯ - ç³»ç»Ÿé…ç½®è¢«åå¤è¯»å–
    Config getSystemConfig(String configKey) {
        // ç³»ç»Ÿè®¾ç½®ã€ä¸šåŠ¡è§„åˆ™ç­‰
        return cacheService.get("config:" + configKey);
    }
}
```

**ğŸ† çƒ­ç‚¹æ•°æ®ç¼“å­˜ç­–ç•¥**

```
çƒ­ç‚¹æ•°æ®è¯†åˆ«æ–¹æ³•ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è®¿é—®é¢‘ç‡ç»Ÿè®¡   â”‚     ç”¨æˆ·è¡Œä¸º     â”‚     ä¸šåŠ¡é¢„æœŸ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ QPSç›‘æ§       â”‚ â€¢ æœç´¢æ’è¡Œ      â”‚ â€¢ ä¿ƒé”€å•†å“      â”‚
â”‚ â€¢ è®¿é—®æ¬¡æ•°      â”‚ â€¢ ç‚¹å‡»çƒ­åº¦      â”‚ â€¢ é¦–é¡µæ¨è      â”‚  
â”‚ â€¢ æ—¶é—´æ®µåˆ†æ    â”‚ â€¢ è´­ä¹°è½¬åŒ–      â”‚ â€¢ æ–°å“å‘å¸ƒ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è®¡ç®—ç»“æœç¼“å­˜


**ğŸ§® å¤æ‚è®¡ç®—çš„ç—›ç‚¹**

```java
// å¤æ‚è®¡ç®—ç¤ºä¾‹ - ç»Ÿè®¡æŠ¥è¡¨
class ExpensiveCalculation {
    
    // è€—æ—¶çš„ç»Ÿè®¡è®¡ç®—
    public SalesReport generateSalesReport(String date) {
        // è¿™ä¸ªè®¡ç®—å¯èƒ½éœ€è¦å‡ ç§’ç”šè‡³å‡ åˆ†é’Ÿ
        // 1. æŸ¥è¯¢æ‰€æœ‰è®¢å•æ•°æ®
        // 2. æŒ‰å•†å“åˆ†ç±»ç»Ÿè®¡
        // 3. è®¡ç®—å„ç§æŒ‡æ ‡
        // 4. ç”Ÿæˆå›¾è¡¨æ•°æ®
        
        List<Order> orders = orderService.getOrdersByDate(date);
        return expensiveCalculation(orders); // è€—æ—¶æ“ä½œ
    }
    
    // ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–å
    public SalesReport getSalesReportWithCache(String date) {
        String cacheKey = "sales_report:" + date;
        
        // å…ˆæŸ¥ç¼“å­˜
        SalesReport cached = redis.get(cacheKey);
        if (cached != null) {
            return cached; // ç›´æ¥è¿”å›ï¼Œç§’çº§å“åº”
        }
        
        // ç¼“å­˜æ²¡æœ‰æ‰è®¡ç®—
        SalesReport result = generateSalesReport(date);
        redis.setex(cacheKey, 3600, result); // ç¼“å­˜1å°æ—¶
        return result;
    }
}
```

**ğŸ“Š é€‚åˆç¼“å­˜çš„è®¡ç®—ç±»å‹**

| **è®¡ç®—ç±»å‹** | **ç‰¹ç‚¹** | **ç¼“å­˜æ”¶ç›Š** | **å®é™…ä¾‹å­** |
|-------------|---------|-------------|-------------|
| **èšåˆç»Ÿè®¡** | `å¤§é‡æ•°æ®æ±‡æ€»` | `â­â­â­â­â­` | `é”€å”®æŠ¥è¡¨ã€ç”¨æˆ·ç»Ÿè®¡` |
| **å¤æ‚æŸ¥è¯¢** | `å¤šè¡¨å…³è”æŸ¥è¯¢` | `â­â­â­â­` | `å•†å“æ¨èã€æœç´¢ç»“æœ` |
| **ç®—æ³•è¿ç®—** | `CPUå¯†é›†å‹è®¡ç®—` | `â­â­â­â­â­` | `æ¨èç®—æ³•ã€é£æ§è®¡ç®—` |
| **å¤–éƒ¨æ¥å£** | `ç¬¬ä¸‰æ–¹APIè°ƒç”¨` | `â­â­â­â­` | `åœ°å›¾æœåŠ¡ã€æ”¯ä»˜æŸ¥è¯¢` |

### 2.3 ä¼šè¯ç¼“å­˜


**ğŸ‘¤ ä¼šè¯ä¿¡æ¯çš„ç‰¹ç‚¹**

> **ä¼šè¯ç¼“å­˜**ï¼šå°±åƒé¤å…çš„ä¼šå‘˜å¡ï¼Œè®°ä½ä½ çš„èº«ä»½å’Œåå¥½ï¼Œä¸‹æ¬¡æ¥ä¸ç”¨é‡æ–°ä»‹ç»è‡ªå·±ã€‚

```java
// ä¼šè¯ç¼“å­˜å®ç°
class SessionCache {
    
    // ç”¨æˆ·ç™»å½•åçš„ä¼šè¯ä¿¡æ¯
    class UserSession {
        private String userId;
        private String username;
        private List<String> permissions; // ç”¨æˆ·æƒé™
        private String token;
        private long loginTime;
    }
    
    // ä¿å­˜ç”¨æˆ·ä¼šè¯
    public void saveSession(String sessionId, UserSession session) {
        // è®¾ç½®30åˆ†é’Ÿè¿‡æœŸ
        redis.setex("session:" + sessionId, 1800, session);
    }
    
    // è·å–ç”¨æˆ·ä¼šè¯
    public UserSession getSession(String sessionId) {
        return redis.get("session:" + sessionId);
    }
    
    // æ£€æŸ¥ç”¨æˆ·æƒé™
    public boolean hasPermission(String sessionId, String permission) {
        UserSession session = getSession(sessionId);
        if (session == null) {
            return false; // ä¼šè¯è¿‡æœŸ
        }
        return session.getPermissions().contains(permission);
    }
}
```

**ğŸ” ä¼šè¯ç¼“å­˜çš„ä»·å€¼**

```
ä¼šè¯ç¼“å­˜è§£å†³çš„é—®é¢˜ï¼š

æ— ä¼šè¯ç¼“å­˜ï¼š
æ¯æ¬¡è¯·æ±‚ â†’ æŸ¥æ•°æ®åº“éªŒè¯ç”¨æˆ· â†’ æŸ¥æ•°æ®åº“è·å–æƒé™ â†’ å¤„ç†è¯·æ±‚
é—®é¢˜ï¼šæ•°æ®åº“å‹åŠ›å¤§ï¼Œå“åº”æ…¢

æœ‰ä¼šè¯ç¼“å­˜ï¼š
æ¯æ¬¡è¯·æ±‚ â†’ ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ â†’ ç›´æ¥å¤„ç†è¯·æ±‚
ä¼˜åŠ¿ï¼šå“åº”å¿«ï¼Œæ•°æ®åº“å‹åŠ›å°
```

---

## 3. ğŸ¨ Cache-Asideæ¨¡å¼è¯¦è§£


### 3.1 Cache-Asideæ¨¡å¼æ˜¯ä»€ä¹ˆ


> **Cache-Aside**ï¼šå°±åƒä½ è‡ªå·±ç®¡ç†ä¹¦æ¡Œï¼Œéœ€è¦ä»€ä¹ˆä¹¦å°±è‡ªå·±å»ä¹¦æ¶æ‹¿ï¼Œç”¨å®Œäº†è‡ªå·±æ”¾å›å»ã€‚

**ğŸ”¸ Cache-Asideæ¨¡å¼ç‰¹ç‚¹**

```
Cache-Asideæ¨¡å¼ = åº”ç”¨ç¨‹åºè‡ªå·±è´Ÿè´£ç¼“å­˜ç®¡ç†

è§’è‰²åˆ†å·¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     åº”ç”¨ç¨‹åº     â”‚      ç¼“å­˜       â”‚     æ•°æ®åº“      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å†³å®šä½•æ—¶è¯»ç¼“å­˜ â”‚ â€¢ å­˜å‚¨çƒ­ç‚¹æ•°æ®  â”‚ â€¢ å­˜å‚¨å®Œæ•´æ•°æ®  â”‚
â”‚ â€¢ å†³å®šä½•æ—¶å†™ç¼“å­˜ â”‚ â€¢ æä¾›å¿«é€Ÿè®¿é—®  â”‚ â€¢ ä¿è¯æ•°æ®æŒä¹…  â”‚
â”‚ â€¢ å¤„ç†ç¼“å­˜å¤±æ•ˆ  â”‚ â€¢ ä¸´æ—¶å­˜å‚¨     â”‚ â€¢ æ•°æ®ä¸€è‡´æ€§    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Cache-Asideè¯»å–æµç¨‹


**ğŸ“– è¯»å–æ•°æ®çš„æ­¥éª¤**

```java
// Cache-Aside è¯»å–æ¨¡å¼
class CacheAsideRead {
    
    public User getUser(String userId) {
        // æ­¥éª¤1ï¼šå…ˆæŸ¥ç¼“å­˜
        User user = cache.get("user:" + userId);
        
        if (user != null) {
            // æ­¥éª¤2aï¼šç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
            System.out.println("ç¼“å­˜å‘½ä¸­ï¼å¿«é€Ÿè¿”å›");
            return user;
        }
        
        // æ­¥éª¤2bï¼šç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        System.out.println("ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“");
        user = database.findUser(userId);
        
        if (user != null) {
            // æ­¥éª¤3ï¼šå°†æ•°æ®æ”¾å…¥ç¼“å­˜
            cache.put("user:" + userId, user, 300); // ç¼“å­˜5åˆ†é’Ÿ
        }
        
        return user;
    }
}
```

**ğŸ”„ è¯»å–æµç¨‹å›¾**

```
Cache-Aside è¯»å–æµç¨‹ï¼š

ç”¨æˆ·è¯·æ±‚æ•°æ®
    â†“
æŸ¥è¯¢ç¼“å­˜
    â†“
ç¼“å­˜ä¸­æœ‰æ•°æ®å—ï¼Ÿ
    â”œâ”€ æœ‰ â†’ è¿”å›ç¼“å­˜æ•°æ® âœ… (ç¼“å­˜å‘½ä¸­)
    â”‚
    â””â”€ æ²¡æœ‰ â†’ æŸ¥è¯¢æ•°æ®åº“
                â†“
            æ•°æ®åº“æœ‰æ•°æ®å—ï¼Ÿ
                â”œâ”€ æœ‰ â†’ 1.è¿”å›æ•°æ®ç»™ç”¨æˆ·
                â”‚       2.å°†æ•°æ®å­˜å…¥ç¼“å­˜
                â”‚
                â””â”€ æ²¡æœ‰ â†’ è¿”å›ç©ºç»“æœ
```

### 3.3 Cache-Asideå†™å…¥æµç¨‹


**âœï¸ æ›´æ–°æ•°æ®çš„æ­¥éª¤**

```java
// Cache-Aside å†™å…¥æ¨¡å¼
class CacheAsideWrite {
    
    public boolean updateUser(User user) {
        try {
            // æ­¥éª¤1ï¼šå…ˆæ›´æ–°æ•°æ®åº“
            boolean success = database.updateUser(user);
            
            if (success) {
                // æ­¥éª¤2ï¼šåˆ é™¤ç¼“å­˜ä¸­çš„æ—§æ•°æ®
                cache.delete("user:" + user.getId());
                System.out.println("æ•°æ®åº“æ›´æ–°æˆåŠŸï¼Œç¼“å­˜å·²æ¸…é™¤");
                return true;
            }
            
            return false;
            
        } catch (Exception e) {
            System.out.println("æ›´æ–°å¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
}
```

> **ğŸ’¡ ä¸ºä»€ä¹ˆåˆ é™¤ç¼“å­˜è€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ**
> 
> å°±åƒå®¶é‡Œçš„é£Ÿç‰©è¿‡æœŸäº†ï¼Œä½ æ˜¯ç›´æ¥æ‰”æ‰è®©ä¸‹æ¬¡é‡æ–°ä¹°æ–°é²œçš„ï¼Œè¿˜æ˜¯å°è¯•"ç¿»æ–°"æ—§é£Ÿç‰©ï¼Ÿåˆ é™¤ç¼“å­˜æ›´å®‰å…¨ï¼Œä¸‹æ¬¡è¯»å–æ—¶ä¼šè‡ªåŠ¨ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®ã€‚

**ğŸ“ å†™å…¥æµç¨‹å›¾**

```
Cache-Aside å†™å…¥æµç¨‹ï¼š

ç”¨æˆ·æ›´æ–°æ•°æ®
    â†“
æ›´æ–°æ•°æ®åº“
    â†“
æ•°æ®åº“æ›´æ–°æˆåŠŸï¼Ÿ
    â”œâ”€ æˆåŠŸ â†’ åˆ é™¤å¯¹åº”çš„ç¼“å­˜æ•°æ® âœ…
    â”‚        (è®©ä¸‹æ¬¡è¯»å–æ—¶é‡æ–°åŠ è½½æ–°æ•°æ®)
    â”‚
    â””â”€ å¤±è´¥ â†’ ä¸åŠ¨ç¼“å­˜ âŒ
             (ä¿æŒæ•°æ®ä¸€è‡´æ€§)
```

---

## 4. ğŸ”„ ç¼“å­˜æ›´æ–°ç­–ç•¥


### 4.1 Cache Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰


**ğŸš¶ Cache Asideç‰¹ç‚¹**

> **Cache Aside**ï¼šåº”ç”¨ç¨‹åºå½“"ç®¡å®¶"ï¼Œè‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™è¯»ç¼“å­˜ã€ä»€ä¹ˆæ—¶å€™æ›´æ–°ç¼“å­˜ã€‚

```java
// Cache Aside å®Œæ•´å®ç°
class CacheAsideStrategy {
    
    // è¯»å–æ•°æ®
    public Product getProduct(String id) {
        // åº”ç”¨ç¨‹åºæ§åˆ¶æ•´ä¸ªæµç¨‹
        Product product = cache.get("product:" + id);
        
        if (product == null) {
            // ç¼“å­˜æ²¡æœ‰ï¼Œå»æ•°æ®åº“æ‹¿
            product = database.selectProduct(id);
            if (product != null) {
                // ä¸»åŠ¨æ”¾å…¥ç¼“å­˜
                cache.put("product:" + id, product);
            }
        }
        
        return product;
    }
    
    // æ›´æ–°æ•°æ®
    public void updateProduct(Product product) {
        // å…ˆæ›´æ–°æ•°æ®åº“
        database.updateProduct(product);
        // ç„¶ååˆ é™¤ç¼“å­˜
        cache.delete("product:" + product.getId());
    }
}
```

**âœ… Cache Asideä¼˜ç¼ºç‚¹**

| **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|---------|
| âœ… `åº”ç”¨ç¨‹åºå®Œå…¨æ§åˆ¶ç¼“å­˜é€»è¾‘` | âŒ `ä»£ç å¤æ‚åº¦å¢åŠ ` |
| âœ… `ç¼“å­˜ç­–ç•¥çµæ´»å¯å®šåˆ¶` | âŒ `éœ€è¦å¤„ç†ç¼“å­˜ä¸€è‡´æ€§` |
| âœ… `é€‚åˆè¯»å¤šå†™å°‘åœºæ™¯` | âŒ `å¯èƒ½å‡ºç°ç¼“å­˜é›ªå´©` |

### 4.2 Write Throughï¼ˆå†™ç©¿é€ï¼‰


**ğŸ“ Write Throughç‰¹ç‚¹**

> **Write Through**ï¼šå°±åƒæœ‰ä¸ªåŠ©æ‰‹ï¼Œä½ å‘Šè¯‰ä»–æ›´æ–°æ•°æ®ï¼Œä»–åŒæ—¶å¸®ä½ æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜ï¼Œä¿è¯ä¸¤è¾¹æ€»æ˜¯ä¸€è‡´çš„ã€‚

```java
// Write Through å®ç°
class WriteThroughStrategy {
    
    // è¯»å–æ•°æ®ï¼ˆç®€å•ï¼‰
    public User getUser(String id) {
        User user = cache.get("user:" + id);
        
        if (user == null) {
            user = database.selectUser(id);
            // æ³¨æ„ï¼šWrite Throughåœ¨å†™å…¥æ—¶ç»´æŠ¤ç¼“å­˜
            // è¯»å–æ—¶å¦‚æœç¼“å­˜æ²¡æœ‰ï¼Œåªä»æ•°æ®åº“è¯»å–
        }
        
        return user;
    }
    
    // æ›´æ–°æ•°æ®ï¼ˆå…³é”®ï¼‰
    public void updateUser(User user) {
        // åŒæ—¶å†™æ•°æ®åº“å’Œç¼“å­˜
        database.updateUser(user);        // å†™æ•°æ®åº“
        cache.put("user:" + user.getId(), user); // å†™ç¼“å­˜
        
        // ä¿è¯ä¸¤è¾¹æ•°æ®ä¸€è‡´
        System.out.println("æ•°æ®åº“å’Œç¼“å­˜åŒæ—¶æ›´æ–°å®Œæˆ");
    }
}
```

**ğŸ”„ Write Throughæµç¨‹**

```
Write Through æµç¨‹ï¼š

ç”¨æˆ·å†™å…¥æ•°æ®
    â†“
åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š
â”œâ”€ å†™å…¥æ•°æ®åº“
â””â”€ å†™å…¥ç¼“å­˜
    â†“
ä¸¤ä¸ªæ“ä½œéƒ½æˆåŠŸæ‰ç®—æˆåŠŸ
```

### 4.3 Write Behindï¼ˆå†™å›ï¼‰


**â° Write Behindç‰¹ç‚¹**

> **Write Behind**ï¼šå°±åƒé“¶è¡Œçš„æ‰¹é‡è½¬è´¦ï¼Œå…ˆè®°å½•åœ¨æœ¬å­ä¸Šï¼Œç„¶åå®šæœŸç»Ÿä¸€å¤„ç†ï¼Œæé«˜æ•ˆç‡ã€‚

```java
// Write Behind å®ç°
class WriteBehindStrategy {
    private Queue<User> writeQueue = new LinkedBlockingQueue<>();
    
    // è¯»å–æ•°æ®
    public User getUser(String id) {
        // ä¼˜å…ˆä»ç¼“å­˜è¯»å–
        User user = cache.get("user:" + id);
        
        if (user == null) {
            // ç¼“å­˜æ²¡æœ‰æ‰æŸ¥æ•°æ®åº“
            user = database.selectUser(id);
            if (user != null) {
                cache.put("user:" + id, user);
            }
        }
        
        return user;
    }
    
    // æ›´æ–°æ•°æ®
    public void updateUser(User user) {
        // ç«‹å³æ›´æ–°ç¼“å­˜
        cache.put("user:" + user.getId(), user);
        
        // å¼‚æ­¥æ›´æ–°æ•°æ®åº“
        writeQueue.offer(user);
        System.out.println("ç¼“å­˜ç«‹å³æ›´æ–°ï¼Œæ•°æ®åº“ç¨åæ›´æ–°");
    }
    
    // åå°çº¿ç¨‹å®šæœŸæ‰¹é‡å†™æ•°æ®åº“
    @Scheduled(fixedDelay = 5000) // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡
    public void flushToDatabase() {
        List<User> batch = new ArrayList<>();
        
        // æ‰¹é‡è·å–å¾…å†™å…¥çš„æ•°æ®
        while (!writeQueue.isEmpty() && batch.size() < 100) {
            batch.add(writeQueue.poll());
        }
        
        if (!batch.isEmpty()) {
            // æ‰¹é‡å†™å…¥æ•°æ®åº“
            database.batchUpdateUsers(batch);
            System.out.println("æ‰¹é‡å†™å…¥æ•°æ®åº“ï¼š" + batch.size() + "æ¡è®°å½•");
        }
    }
}
```

**âš¡ Write Behindä¼˜åŠ¿**

```
Write Behind çš„ä»·å€¼ï¼š

æ™®é€šå†™å…¥ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ å†™æ•°æ®åº“(æ…¢) â†’ å†™ç¼“å­˜ â†’ è¿”å›ç»“æœ
å“åº”æ—¶é—´ = æ•°æ®åº“å†™å…¥æ—¶é—´ + ç¼“å­˜å†™å…¥æ—¶é—´

Write Behindï¼š
ç”¨æˆ·è¯·æ±‚ â†’ å†™ç¼“å­˜(å¿«) â†’ è¿”å›ç»“æœ
         â†“
    åå°å¼‚æ­¥å†™æ•°æ®åº“
å“åº”æ—¶é—´ = ç¼“å­˜å†™å…¥æ—¶é—´ (å¿«å¾ˆå¤š!)
```

### 4.4 ä¸‰ç§ç­–ç•¥å¯¹æ¯”


| **ç­–ç•¥** | **å†™å…¥æ–¹å¼** | **å“åº”é€Ÿåº¦** | **æ•°æ®ä¸€è‡´æ€§** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|---------------|-------------|
| **Cache Aside** | `å…ˆæ•°æ®åº“ååˆ ç¼“å­˜` | â­â­â­ | â­â­â­â­ | `è¯»å¤šå†™å°‘` |
| **Write Through** | `åŒæ—¶å†™æ•°æ®åº“å’Œç¼“å­˜` | â­â­ | â­â­â­â­â­ | `å¼ºä¸€è‡´æ€§è¦æ±‚` |
| **Write Behind** | `å…ˆç¼“å­˜åå¼‚æ­¥æ•°æ®åº“` | â­â­â­â­â­ | â­â­ | `é«˜å¹¶å‘å†™å…¥` |

---

## 5. ğŸ—ï¸ ç¼“å­˜å±‚æ¬¡è®¾è®¡


### 5.1 å¤šçº§ç¼“å­˜æ¶æ„


**ğŸ¢ ç¼“å­˜å±‚æ¬¡å°±åƒå…¬å¸ç»„ç»‡æ¶æ„**

> ä¸€çº§ç¼“å­˜åƒéƒ¨é—¨ç»ç†ï¼ˆå°±è¿‘å¤„ç†ï¼‰ï¼ŒäºŒçº§ç¼“å­˜åƒæ€»ç›‘ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰ï¼Œæ•°æ®åº“åƒCEOï¼ˆæœ€ç»ˆå†³ç­–ï¼‰ã€‚

```
å¤šçº§ç¼“å­˜æ¶æ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·è¯·æ±‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸€çº§ç¼“å­˜ (æœ¬åœ°ç¼“å­˜)                         â”‚
â”‚              â€¢ JVMå †å†…å­˜                                â”‚
â”‚              â€¢ å“åº”æœ€å¿« (å¾®ç§’çº§)                         â”‚  
â”‚              â€¢ å®¹é‡æœ‰é™                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ (ç¼“å­˜æœªå‘½ä¸­)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              äºŒçº§ç¼“å­˜ (åˆ†å¸ƒå¼ç¼“å­˜)                       â”‚
â”‚              â€¢ Redisé›†ç¾¤                               â”‚
â”‚              â€¢ å“åº”è¾ƒå¿« (æ¯«ç§’çº§)                         â”‚
â”‚              â€¢ å®¹é‡è¾ƒå¤§                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ (ç¼“å­˜æœªå‘½ä¸­)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®æº (æ•°æ®åº“)                            â”‚
â”‚              â€¢ MySQL/PostgreSQL                        â”‚
â”‚              â€¢ å“åº”è¾ƒæ…¢ (ç§’çº§)                          â”‚
â”‚              â€¢ æ•°æ®å®Œæ•´                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å®é™…å±‚æ¬¡ç¼“å­˜å®ç°


```java
// å¤šçº§ç¼“å­˜å®ç°
class MultiLevelCache {
    
    // ä¸€çº§ç¼“å­˜ï¼šæœ¬åœ°å†…å­˜ç¼“å­˜
    private Map<String, Object> localCache = new ConcurrentHashMap<>();
    
    // äºŒçº§ç¼“å­˜ï¼šRedisåˆ†å¸ƒå¼ç¼“å­˜
    private RedisTemplate redisTemplate;
    
    // ä¸‰çº§å­˜å‚¨ï¼šæ•°æ®åº“
    private UserRepository userRepository;
    
    public User getUser(String userId) {
        String key = "user:" + userId;
        
        // ç¬¬ä¸€æ­¥ï¼šæŸ¥æœ¬åœ°ç¼“å­˜
        User user = (User) localCache.get(key);
        if (user != null) {
            System.out.println("æœ¬åœ°ç¼“å­˜å‘½ä¸­ - æœ€å¿«");
            return user;
        }
        
        // ç¬¬äºŒæ­¥ï¼šæŸ¥Redisç¼“å­˜
        user = (User) redisTemplate.opsForValue().get(key);
        if (user != null) {
            System.out.println("Redisç¼“å­˜å‘½ä¸­ - è¾ƒå¿«");
            // åŒæ—¶æ›´æ–°æœ¬åœ°ç¼“å­˜
            localCache.put(key, user);
            return user;
        }
        
        // ç¬¬ä¸‰æ­¥ï¼šæŸ¥æ•°æ®åº“
        user = userRepository.findById(userId);
        if (user != null) {
            System.out.println("æ•°æ®åº“æŸ¥è¯¢ - è¾ƒæ…¢");
            // åŒæ—¶æ›´æ–°ä¸¤çº§ç¼“å­˜
            redisTemplate.opsForValue().set(key, user, 300, TimeUnit.SECONDS);
            localCache.put(key, user);
        }
        
        return user;
    }
}
```

### 5.3 ç¼“å­˜å±‚æ¬¡çš„é€‰æ‹©åŸåˆ™


**ğŸ“Š ä¸åŒå±‚æ¬¡çš„ç‰¹ç‚¹å¯¹æ¯”**

| **ç¼“å­˜çº§åˆ«** | **è®¿é—®é€Ÿåº¦** | **å­˜å‚¨å®¹é‡** | **æ•°æ®èŒƒå›´** | **é€‚ç”¨æ•°æ®** |
|-------------|-------------|-------------|-------------|-------------|
| **æœ¬åœ°ç¼“å­˜** | `å¾®ç§’çº§` | `å‡ åMB` | `å•æœº` | `çƒ­ç‚¹æ•°æ®ã€é¢‘ç¹è®¿é—®` |
| **åˆ†å¸ƒå¼ç¼“å­˜** | `æ¯«ç§’çº§` | `å‡ åGB` | `é›†ç¾¤å…±äº«` | `ä¼šè¯æ•°æ®ã€å…±äº«æ•°æ®` |
| **æ•°æ®åº“** | `ç§’çº§` | `TBçº§` | `æŒä¹…åŒ–` | `å®Œæ•´æ•°æ®ã€å†·æ•°æ®` |

**ğŸ¯ ç¼“å­˜å±‚æ¬¡ä½¿ç”¨ç­–ç•¥**

```java
class CacheStrategy {
    
    // æ ¹æ®æ•°æ®ç‰¹ç‚¹é€‰æ‹©ç¼“å­˜å±‚æ¬¡
    public void cacheDataByCharacteristics() {
        
        // è¶…çƒ­æ•°æ® â†’ æœ¬åœ°ç¼“å­˜
        // ä¾‹ï¼šç³»ç»Ÿé…ç½®ã€å¸¸ç”¨å­—å…¸
        localCache.put("system_config", config);
        
        // çƒ­ç‚¹æ•°æ® â†’ Redisç¼“å­˜  
        // ä¾‹ï¼šç”¨æˆ·ä¿¡æ¯ã€å•†å“è¯¦æƒ…
        redis.set("user:123", user, 600);
        
        // æ™®é€šæ•°æ® â†’ æŒ‰éœ€ç¼“å­˜
        // ä¾‹ï¼šå†å²è®¢å•ã€è¯¦ç»†æ—¥å¿—
        // ä¸ç¼“å­˜ï¼Œç›´æ¥æŸ¥æ•°æ®åº“
    }
}
```

---

## 6. ğŸš€ ç¼“å­˜ä¼˜å…ˆç­–ç•¥å®æˆ˜


### 6.1 Redisç¼“å­˜çƒ­ç‚¹æ•°æ®è®¾è®¡


**ğŸ”¥ çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸ç¼“å­˜**

```java
// Redisçƒ­ç‚¹æ•°æ®ç¼“å­˜å®æˆ˜
@Service
class HotDataCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired  
    private ProductService productService;
    
    /**
     * ç¼“å­˜çƒ­é—¨å•†å“ä¿¡æ¯
     * ç›®æ ‡ï¼šå‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›
     */
    public Product getHotProduct(String productId) {
        String cacheKey = "hot_product:" + productId;
        
        // 1. å…ˆæŸ¥Redisç¼“å­˜
        Product product = (Product) redisTemplate.opsForValue().get(cacheKey);
        
        if (product != null) {
            // ç¼“å­˜å‘½ä¸­ï¼Œè®°å½•è®¿é—®æ¬¡æ•°
            recordCacheHit(productId);
            return product;
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        product = productService.getProductById(productId);
        
        if (product != null) {
            // 3. çƒ­ç‚¹æ•°æ®ç¼“å­˜ç­–ç•¥
            if (isHotProduct(productId)) {
                // çƒ­ç‚¹å•†å“ç¼“å­˜æ›´é•¿æ—¶é—´
                redisTemplate.opsForValue().set(cacheKey, product, 30, TimeUnit.MINUTES);
            } else {
                // æ™®é€šå•†å“ç¼“å­˜è¾ƒçŸ­æ—¶é—´
                redisTemplate.opsForValue().set(cacheKey, product, 5, TimeUnit.MINUTES);
            }
        }
        
        return product;
    }
    
    /**
     * åˆ¤æ–­æ˜¯å¦ä¸ºçƒ­ç‚¹å•†å“
     */
    private boolean isHotProduct(String productId) {
        String countKey = "product_access_count:" + productId;
        Long accessCount = redisTemplate.opsForValue().increment(countKey);
        
        // è®¾ç½®è®¡æ•°å™¨è¿‡æœŸæ—¶é—´ï¼ˆ1å°æ—¶ï¼‰
        if (accessCount == 1) {
            redisTemplate.expire(countKey, 1, TimeUnit.HOURS);
        }
        
        // 1å°æ—¶å†…è®¿é—®è¶…è¿‡100æ¬¡è®¤ä¸ºæ˜¯çƒ­ç‚¹
        return accessCount > 100;
    }
}
```

### 6.2 ç³»ç»Ÿè®¾è®¡å®æˆ˜æ¡ˆä¾‹


**ğŸª ç”µå•†ç³»ç»Ÿç¼“å­˜æ¶æ„è®¾è®¡**

```java
// ç”µå•†ç³»ç»Ÿç»¼åˆç¼“å­˜ç­–ç•¥
@Component
class EcommerceCacheSystem {
    
    /**
     * å•†å“è¯¦æƒ…é¡µç¼“å­˜ç­–ç•¥
     * ç‰¹ç‚¹ï¼šè¯»å¤šå†™å°‘ï¼Œæ•°æ®ç›¸å¯¹ç¨³å®š
     */
    public ProductDetail getProductDetail(String productId) {
        // å¤šçº§ç¼“å­˜ç­–ç•¥
        String cacheKey = "product_detail:" + productId;
        
        // L1: æœ¬åœ°ç¼“å­˜ (1åˆ†é’Ÿ)
        ProductDetail detail = localCache.get(cacheKey);
        if (detail != null) return detail;
        
        // L2: Redisç¼“å­˜ (10åˆ†é’Ÿ)  
        detail = redis.get(cacheKey);
        if (detail != null) {
            localCache.put(cacheKey, detail, 60);
            return detail;
        }
        
        // L3: æ•°æ®åº“æŸ¥è¯¢
        detail = buildProductDetail(productId);
        
        // å›å¡«ç¼“å­˜
        redis.setex(cacheKey, 600, detail);
        localCache.put(cacheKey, detail, 60);
        
        return detail;
    }
    
    /**
     * è´­ç‰©è½¦ç¼“å­˜ç­–ç•¥  
     * ç‰¹ç‚¹ï¼šç”¨æˆ·ç›¸å…³ï¼Œé¢‘ç¹å˜æ›´
     */
    public ShoppingCart getUserCart(String userId) {
        String cacheKey = "cart:" + userId;
        
        // è´­ç‰©è½¦åªç”¨Redisç¼“å­˜ï¼ˆæ”¯æŒåˆ†å¸ƒå¼ä¼šè¯ï¼‰
        ShoppingCart cart = redis.get(cacheKey);
        
        if (cart == null) {
            // ä»æ•°æ®åº“é‡å»ºè´­ç‰©è½¦
            cart = rebuildCartFromDB(userId);
            redis.setex(cacheKey, 1800, cart); // 30åˆ†é’Ÿè¿‡æœŸ
        }
        
        return cart;
    }
    
    /**
     * åº“å­˜ç¼“å­˜ç­–ç•¥
     * ç‰¹ç‚¹ï¼šé«˜å¹¶å‘ï¼Œå¼ºä¸€è‡´æ€§è¦æ±‚
     */
    public boolean checkAndReduceStock(String productId, int quantity) {
        String stockKey = "stock:" + productId;
        
        // ä½¿ç”¨Redisçš„åŸå­æ“ä½œ
        Long remainStock = redis.opsForValue().decrement(stockKey, quantity);
        
        if (remainStock < 0) {
            // åº“å­˜ä¸è¶³ï¼Œå›æ»š
            redis.opsForValue().increment(stockKey, quantity);
            return false;
        }
        
        // å¼‚æ­¥åŒæ­¥åˆ°æ•°æ®åº“
        asyncUpdateStockToDB(productId, quantity);
        return true;
    }
}
```

### 6.3 ç¼“å­˜ä¼˜åŒ–æŠ€å·§


**ğŸ’¡ å®ç”¨çš„ç¼“å­˜ä¼˜åŒ–æ–¹æ³•**

```java
// ç¼“å­˜ä¼˜åŒ–æŠ€å·§é›†åˆ
class CacheOptimization {
    
    /**
     * 1. ç¼“å­˜é¢„çƒ­ - ç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®
     */
    @PostConstruct
    public void preloadCache() {
        System.out.println("å¼€å§‹ç¼“å­˜é¢„çƒ­...");
        
        // é¢„åŠ è½½çƒ­é—¨å•†å“
        List<String> hotProducts = getHotProductIds();
        for (String productId : hotProducts) {
            Product product = productService.getProductById(productId);
            redis.setex("product:" + productId, 1800, product);
        }
        
        System.out.println("ç¼“å­˜é¢„çƒ­å®Œæˆ");
    }
    
    /**
     * 2. ç¼“å­˜é›ªå´©é˜²æŠ¤ - éšæœºè¿‡æœŸæ—¶é—´
     */
    public void setCacheWithRandomExpire(String key, Object value, int baseSeconds) {
        // åŸºç¡€æ—¶é—´ + éšæœºæ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸ
        int randomSeconds = new Random().nextInt(300); // 0-5åˆ†é’Ÿéšæœº
        int expireTime = baseSeconds + randomSeconds;
        
        redis.setex(key, expireTime, value);
    }
    
    /**
     * 3. ç¼“å­˜ç©¿é€é˜²æŠ¤ - ç©ºå€¼ç¼“å­˜
     */
    public User getUserSafely(String userId) {
        String cacheKey = "user:" + userId;
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºç©ºå€¼ç¼“å­˜
        if (redis.hasKey(cacheKey + ":empty")) {
            return null; // é¿å…é‡å¤æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®
        }
        
        User user = redis.get(cacheKey);
        if (user == null) {
            user = userService.getById(userId);
            
            if (user != null) {
                redis.setex(cacheKey, 600, user);
            } else {
                // ç¼“å­˜ç©ºå€¼ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€
                redis.setex(cacheKey + ":empty", 60, "");
            }
        }
        
        return user;
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç¼“å­˜æœ¬è´¨ï¼šä¸´æ—¶å­˜å‚¨ + å¿«é€Ÿè®¿é—®ï¼Œå‡å°‘é‡å¤å·¥ä½œ
ğŸ”¸ ä½¿ç”¨åœºæ™¯ï¼šçƒ­ç‚¹æ•°æ®ã€å¤æ‚è®¡ç®—ã€ä¼šè¯ä¿¡æ¯ä¸‰å¤§å…¸å‹åœºæ™¯  
ğŸ”¸ Cache-Asideï¼šåº”ç”¨ç¨‹åºè‡ªå·±ç®¡ç†ç¼“å­˜çš„è¯»å†™é€»è¾‘
ğŸ”¸ æ›´æ–°ç­–ç•¥ï¼šCache Asideã€Write Throughã€Write Behindå„æœ‰ç‰¹ç‚¹
ğŸ”¸ å±‚æ¬¡è®¾è®¡ï¼šæœ¬åœ°ç¼“å­˜ + åˆ†å¸ƒå¼ç¼“å­˜ + æ•°æ®åº“çš„å¤šçº§æ¶æ„
ğŸ”¸ ä¼˜å…ˆç­–ç•¥ï¼šçƒ­ç‚¹æ•°æ®ä¼˜å…ˆç¼“å­˜ï¼Œåˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç¼“å­˜çš„æ ¸å¿ƒä»·å€¼**
```
ç”¨æˆ·ä½“éªŒï¼šå“åº”é€Ÿåº¦ä»ç§’çº§æå‡åˆ°æ¯«ç§’çº§
ç³»ç»Ÿæ€§èƒ½ï¼šæ•°æ®åº“å‹åŠ›é™ä½80%ä»¥ä¸Š  
æˆæœ¬æ•ˆç›Šï¼šå‡å°‘ç¡¬ä»¶èµ„æºæŠ•å…¥
é«˜å¯ç”¨æ€§ï¼šæ”¯æŒæ›´é«˜å¹¶å‘è®¿é—®
```

**ğŸ”¹ ç¼“å­˜ç­–ç•¥é€‰æ‹©**
```
è¯»å¤šå†™å°‘ â†’ Cache Asideæ¨¡å¼
å¼ºä¸€è‡´æ€§ â†’ Write Throughæ¨¡å¼  
é«˜å¹¶å‘å†™ â†’ Write Behindæ¨¡å¼
å¤šçº§åŠ é€Ÿ â†’ æœ¬åœ° + åˆ†å¸ƒå¼ç¼“å­˜
```

**ğŸ”¹ å¸¸è§é—®é¢˜é¢„é˜²**
```
ç¼“å­˜é›ªå´©ï¼šéšæœºè¿‡æœŸæ—¶é—´ + ç¼“å­˜é¢„çƒ­
ç¼“å­˜ç©¿é€ï¼šç©ºå€¼ç¼“å­˜ + å¸ƒéš†è¿‡æ»¤å™¨
ç¼“å­˜å‡»ç©¿ï¼šäº’æ–¥é” + çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ
æ•°æ®ä¸€è‡´æ€§ï¼šåˆç†çš„æ›´æ–°ç­–ç•¥ + ç›‘æ§å‘Šè­¦
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ ç”µå•†ç³»ç»Ÿç¼“å­˜å®æˆ˜**
- **å•†å“é¡µé¢**ï¼šå¤šçº§ç¼“å­˜ï¼Œçƒ­ç‚¹å•†å“é•¿æ—¶é—´ç¼“å­˜
- **ç”¨æˆ·ä¼šè¯**ï¼šRedisåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡
- **è´­ç‰©è½¦**ï¼šå®æ—¶ç¼“å­˜ï¼Œå®šæœŸåŒæ­¥æ•°æ®åº“
- **åº“å­˜ç®¡ç†**ï¼šRedisåŸå­æ“ä½œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

**ğŸ¯ ç¼“å­˜è®¾è®¡åŸåˆ™**
- **ä¸šåŠ¡ä¼˜å…ˆ**ï¼šæ ¹æ®å®é™…ä¸šåŠ¡ç‰¹ç‚¹è®¾è®¡ç¼“å­˜ç­–ç•¥
- **åˆ†å±‚æ€ç»´**ï¼šä¸åŒå±‚æ¬¡ç¼“å­˜æ‰¿æ‹…ä¸åŒèŒè´£
- **ç›‘æ§ä¸ºç‹**ï¼šå»ºç«‹å®Œå–„çš„ç¼“å­˜ç›‘æ§ä½“ç³»
- **å®¹ç¾é¢„æ¡ˆ**ï¼šè€ƒè™‘ç¼“å­˜å¤±æ•ˆæ—¶çš„é™çº§æ–¹æ¡ˆ

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
- **é¢„çƒ­ç­–ç•¥**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„åŠ è½½çƒ­ç‚¹æ•°æ®
- **æ‰¹é‡æ“ä½œ**ï¼šå‡å°‘ç¼“å­˜ç½‘ç»œäº¤äº’æ¬¡æ•°
- **å‹ç¼©å­˜å‚¨**ï¼šå¤§å¯¹è±¡ä½¿ç”¨å‹ç¼©å‡å°‘å†…å­˜å ç”¨
- **åˆç†é…ç½®**ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´ç¼“å­˜å‚æ•°

### 7.4 å­¦ä¹ è¿›é˜¶å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**
- **Redisè¿›é˜¶**ï¼šé›†ç¾¤éƒ¨ç½²ã€æŒä¹…åŒ–æœºåˆ¶ã€å†…å­˜ä¼˜åŒ–
- **ç¼“å­˜ä¸­é—´ä»¶**ï¼šMemcachedã€Ehcacheç­‰æŠ€æœ¯å¯¹æ¯”
- **åˆ†å¸ƒå¼ç¼“å­˜**ï¼šä¸€è‡´æ€§å“ˆå¸Œã€æ•°æ®åˆ†ç‰‡ç­–ç•¥
- **ç¼“å­˜ç›‘æ§**ï¼šæ€§èƒ½æŒ‡æ ‡ç›‘æ§ã€å®¹é‡è§„åˆ’

**âš ï¸ å¸¸è§è¯¯åŒºé¿å…**
```
è¿‡åº¦ç¼“å­˜ï¼šä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½éœ€è¦ç¼“å­˜
å¿½ç•¥ä¸€è‡´æ€§ï¼šç¼“å­˜æ›´æ–°ç­–ç•¥è¦è€ƒè™‘æ•°æ®ä¸€è‡´æ€§  
ç¼“å­˜é›ªå´©ï¼šè¦æœ‰é¢„é˜²æœºåˆ¶å’Œåº”æ€¥é¢„æ¡ˆ
ç›²ç›®ä¼˜åŒ–ï¼šå…ˆåˆ†æç“¶é¢ˆå†å†³å®šç¼“å­˜ç­–ç•¥
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç¼“å­˜è®¾è®¡ä¸‰è¦ç´ ï¼šåœºæ™¯åˆ†æå®šç­–ç•¥
çƒ­ç‚¹æ•°æ®ä¼˜å…ˆç¼“ï¼Œå¤æ‚è®¡ç®—ç»“æœå­˜
Cache-Asideåº”ç”¨ç®¡ï¼ŒWrite-ThroughåŒæ­¥å†™
å¤šçº§ç¼“å­˜ææ€§èƒ½ï¼Œç›‘æ§é¢„è­¦ä¿ç¨³å®š
```