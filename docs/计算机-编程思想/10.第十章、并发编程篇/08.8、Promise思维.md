---
title: 8ã€Promiseæ€ç»´
---
## ğŸ“š ç›®å½•

1. [PromiseçŠ¶æ€ç®¡ç†](#1-PromiseçŠ¶æ€ç®¡ç†)
2. [é“¾å¼è°ƒç”¨](#2-é“¾å¼è°ƒç”¨)
3. [é”™è¯¯å¤„ç†](#3-é”™è¯¯å¤„ç†)
4. [Promiseç»„åˆ](#4-Promiseç»„åˆ)
5. [å¼‚æ­¥æµç¨‹æ§åˆ¶](#5-å¼‚æ­¥æµç¨‹æ§åˆ¶)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ PromiseçŠ¶æ€ç®¡ç†


### 1.1 ä»€ä¹ˆæ˜¯PromiseçŠ¶æ€


**Promiseæœ¬è´¨ç†è§£**ï¼šæƒ³è±¡Promiseå°±åƒä¸€å¼ **æ¬ æ¡**æˆ–**æ‰¿è¯ºä¹¦**
- ğŸ“ ä½ å€Ÿé’±ç»™æœ‹å‹ï¼Œæœ‹å‹ç»™ä½ å†™äº†å¼ æ¬ æ¡
- â³ åˆšå¼€å§‹ï¼šæœ‹å‹**æ‰¿è¯ºä¼šè¿˜**ï¼ˆpendingçŠ¶æ€ï¼‰
- âœ… åˆ°æœŸåï¼šæœ‹å‹**æˆåŠŸè¿˜é’±**ï¼ˆfulfilledçŠ¶æ€ï¼‰
- âŒ åˆ°æœŸåï¼šæœ‹å‹**æ²¡é’±è¿˜ä¸äº†**ï¼ˆrejectedçŠ¶æ€ï¼‰

```
Promiseå°±æ˜¯ç¼–ç¨‹ä¸–ç•Œé‡Œçš„"æ‰¿è¯ºä¹¦"
ç”¨æ¥å¤„ç†é‚£äº›"ç°åœ¨è¿˜ä¸çŸ¥é“ç»“æœï¼Œä½†å°†æ¥ä¼šæœ‰ç»“æœ"çš„äº‹æƒ…
```

### 1.2 ä¸‰ç§çŠ¶æ€è¯¦è§£


**ğŸ”¸ Pendingï¼ˆç­‰å¾…ä¸­ï¼‰**
```javascript
// å°±åƒç­‰çº¢ç»¿ç¯ï¼Œè¿˜ä¸çŸ¥é“ç»“æœ
const promise = new Promise((resolve, reject) => {
    // è¿™é‡Œæ˜¯pendingçŠ¶æ€ï¼Œè¿˜åœ¨å¤„ç†ä¸­
    console.log('æ­£åœ¨å¤„ç†...');
});
```

**å«ä¹‰è§£é‡Š**ï¼š
- **ç­‰å¾…çŠ¶æ€**ï¼šäº‹æƒ…æ­£åœ¨è¿›è¡Œï¼Œè¿˜æ²¡æœ‰ç»“æœ
- **å¯ä»¥æ”¹å˜**ï¼šå¯ä»¥å˜æˆæˆåŠŸæˆ–å¤±è´¥
- **åªèƒ½æ”¹å˜ä¸€æ¬¡**ï¼šä¸€æ—¦æ”¹å˜å°±ä¸èƒ½å†å˜äº†

**ğŸ”¸ Fulfilledï¼ˆå·²æˆåŠŸï¼‰**
```javascript
const promise = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve('ä»»åŠ¡å®Œæˆï¼'); // è°ƒç”¨resolveï¼ŒçŠ¶æ€å˜ä¸ºfulfilled
    }, 1000);
});
```

**å«ä¹‰è§£é‡Š**ï¼š
- **æˆåŠŸçŠ¶æ€**ï¼šäº‹æƒ…æˆåŠŸå®Œæˆäº†
- **æœ‰è¿”å›å€¼**ï¼šé€šè¿‡resolveä¼ é€’æˆåŠŸçš„ç»“æœ
- **ä¸å¯é€†è½¬**ï¼šä¸€æ—¦æˆåŠŸå°±ä¸èƒ½å†æ”¹å˜

**ğŸ”¸ Rejectedï¼ˆå·²å¤±è´¥ï¼‰**
```javascript
const promise = new Promise((resolve, reject) => {
    setTimeout(() => {
        reject('å‡ºé”™äº†ï¼'); // è°ƒç”¨rejectï¼ŒçŠ¶æ€å˜ä¸ºrejected
    }, 1000);
});
```

**å«ä¹‰è§£é‡Š**ï¼š
- **å¤±è´¥çŠ¶æ€**ï¼šäº‹æƒ…å¤±è´¥äº†
- **æœ‰é”™è¯¯ä¿¡æ¯**ï¼šé€šè¿‡rejectä¼ é€’å¤±è´¥åŸå› 
- **ä¸å¯é€†è½¬**ï¼šä¸€æ—¦å¤±è´¥å°±ä¸èƒ½å†æ”¹å˜

### 1.3 çŠ¶æ€è½¬æ¢æœºåˆ¶


**çŠ¶æ€è½¬æ¢å›¾ç¤º**ï¼š
```
         åˆ›å»ºPromise
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Pending   â”‚ â† åˆå§‹çŠ¶æ€ï¼Œç­‰å¾…ä¸­
        â”‚   (ç­‰å¾…ä¸­)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â†“           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Fulfilled â”‚  â”‚ Rejected  â”‚
  â”‚  (æˆåŠŸ)    â”‚  â”‚  (å¤±è´¥)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“           â†“
     è°ƒç”¨.then()  è°ƒç”¨.catch()
```

**é‡è¦è§„åˆ™**ï¼š
```
âœ… Pending â†’ Fulfilledï¼ˆå¯ä»¥ï¼‰
âœ… Pending â†’ Rejectedï¼ˆå¯ä»¥ï¼‰
âŒ Fulfilled â†’ Rejectedï¼ˆä¸å¯ä»¥ï¼‰
âŒ Rejected â†’ Fulfilledï¼ˆä¸å¯ä»¥ï¼‰
âŒ Fulfilled â†’ Pendingï¼ˆä¸å¯ä»¥ï¼‰
âŒ Rejected â†’ Pendingï¼ˆä¸å¯ä»¥ï¼‰
```

### 1.4 çŠ¶æ€ç®¡ç†å®æˆ˜ç¤ºä¾‹


**æ¨¡æ‹Ÿæ–‡ä»¶ä¸‹è½½**ï¼š
```javascript
function downloadFile(filename) {
    return new Promise((resolve, reject) => {
        console.log(`å¼€å§‹ä¸‹è½½ ${filename}...`); // PendingçŠ¶æ€
        
        // æ¨¡æ‹Ÿä¸‹è½½è¿‡ç¨‹
        setTimeout(() => {
            const success = Math.random() > 0.3; // 70%æˆåŠŸç‡
            
            if (success) {
                resolve(`${filename} ä¸‹è½½å®Œæˆï¼`); // â†’ Fulfilled
            } else {
                reject(`${filename} ä¸‹è½½å¤±è´¥ï¼`); // â†’ Rejected
            }
        }, 2000);
    });
}

// ä½¿ç”¨
downloadFile('é‡è¦æ–‡æ¡£.pdf')
    .then(result => console.log('âœ…', result))
    .catch(error => console.log('âŒ', error));
```

---

## 2. â›“ï¸ é“¾å¼è°ƒç”¨


### 2.1 ä»€ä¹ˆæ˜¯é“¾å¼è°ƒç”¨


**ç”Ÿæ´»ä¸­çš„é“¾å¼æ“ä½œ**ï¼š
```
åšé¥­çš„æ­¥éª¤ï¼š
ä¹°èœ â†’ æ´—èœ â†’ åˆ‡èœ â†’ ç‚’èœ â†’ è£…ç›˜
æ¯ä¸€æ­¥éƒ½è¦ç­‰å‰ä¸€æ­¥å®Œæˆæ‰èƒ½å¼€å§‹
```

**Promiseé“¾å¼è°ƒç”¨**å°±æ˜¯æŠŠå¤šä¸ªå¼‚æ­¥æ“ä½œä¸²è”èµ·æ¥ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼š

```javascript
// ä¼ ç»Ÿçš„å›è°ƒåœ°ç‹±
getData(function(a) {
    getMoreData(a, function(b) {
        getEvenMoreData(b, function(c) {
            // ä»£ç è¶Šæ¥è¶Šæ·±...
        });
    });
});

// Promiseé“¾å¼è°ƒç”¨
getData()
    .then(a => getMoreData(a))
    .then(b => getEvenMoreData(b))
    .then(c => {
        // æ¸…æ™°æ˜äº†
    });
```

### 2.2 é“¾å¼è°ƒç”¨çš„è®¾è®¡åŸç†


**æ ¸å¿ƒæœºåˆ¶**ï¼š`.then()`æ–¹æ³•**æ€»æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„Promise**

```javascript
// æ¯ä¸ª.then()éƒ½è¿”å›æ–°Promise
promise1
    .then(result1 => {
        // è¿™é‡Œreturnçš„å€¼ä¼šåŒ…è£…æˆæ–°Promise
        return result1 + 'å¤„ç†å®Œæˆ';
    })  // â† è¿”å›æ–°Promise
    .then(result2 => {
        // result2å°±æ˜¯ä¸Šé¢returnçš„å€¼
        console.log(result2);
    }); // â† åˆè¿”å›æ–°Promise
```

**é“¾å¼ä¼ é€’ç¤ºä¾‹**ï¼š
```javascript
function step1() {
    return new Promise(resolve => {
        setTimeout(() => resolve('æ­¥éª¤1å®Œæˆ'), 1000);
    });
}

function step2(data) {
    return new Promise(resolve => {
        setTimeout(() => resolve(data + ' â†’ æ­¥éª¤2å®Œæˆ'), 1000);
    });
}

function step3(data) {
    return new Promise(resolve => {
        setTimeout(() => resolve(data + ' â†’ æ­¥éª¤3å®Œæˆ'), 1000);
    });
}

// é“¾å¼æ‰§è¡Œ
step1()
    .then(result1 => {
        console.log(result1); // "æ­¥éª¤1å®Œæˆ"
        return step2(result1); // è¿”å›æ–°Promise
    })
    .then(result2 => {
        console.log(result2); // "æ­¥éª¤1å®Œæˆ â†’ æ­¥éª¤2å®Œæˆ"
        return step3(result2);
    })
    .then(result3 => {
        console.log(result3); // "æ­¥éª¤1å®Œæˆ â†’ æ­¥éª¤2å®Œæˆ â†’ æ­¥éª¤3å®Œæˆ"
    });
```

### 2.3 é“¾å¼è°ƒç”¨çš„è¿”å›å€¼å¤„ç†


**ä¸‰ç§è¿”å›å€¼æƒ…å†µ**ï¼š

**ğŸ”¸ è¿”å›æ™®é€šå€¼**ï¼š
```javascript
promise
    .then(data => {
        return 'æ™®é€šå­—ç¬¦ä¸²'; // è‡ªåŠ¨åŒ…è£…æˆresolved Promise
    })
    .then(result => {
        console.log(result); // "æ™®é€šå­—ç¬¦ä¸²"
    });
```

**ğŸ”¸ è¿”å›Promise**ï¼š
```javascript
promise
    .then(data => {
        return new Promise(resolve => {
            setTimeout(() => resolve('å¼‚æ­¥ç»“æœ'), 1000);
        });
    })
    .then(result => {
        console.log(result); // "å¼‚æ­¥ç»“æœ"ï¼ˆ1ç§’åï¼‰
    });
```

**ğŸ”¸ ä¸è¿”å›ä»»ä½•å€¼**ï¼š
```javascript
promise
    .then(data => {
        console.log('å¤„ç†ä¸­...');
        // æ²¡æœ‰returnï¼Œç›¸å½“äºreturn undefined
    })
    .then(result => {
        console.log(result); // undefined
    });
```

### 2.4 å®é™…åº”ç”¨ï¼šç”¨æˆ·æ³¨å†Œæµç¨‹


```javascript
function registerUser(userInfo) {
    return validateInput(userInfo)          // éªŒè¯è¾“å…¥
        .then(validData => hashPassword(validData))    // åŠ å¯†å¯†ç 
        .then(hashedData => saveToDatabase(hashedData)) // ä¿å­˜æ•°æ®åº“
        .then(savedUser => sendWelcomeEmail(savedUser)) // å‘é€é‚®ä»¶
        .then(emailResult => {
            return {
                success: true,
                message: 'æ³¨å†ŒæˆåŠŸï¼',
                userId: emailResult.userId
            };
        });
}

// ä½¿ç”¨
registerUser({
    username: 'newuser',
    email: 'user@example.com',
    password: '123456'
})
.then(result => console.log('æ³¨å†Œç»“æœ:', result))
.catch(error => console.log('æ³¨å†Œå¤±è´¥:', error));
```

---

## 3. ğŸš¨ é”™è¯¯å¤„ç†


### 3.1 Promiseé”™è¯¯å¤„ç†æœºåˆ¶


**é”™è¯¯å¤„ç†çš„æœ¬è´¨**ï¼šPromiseå°±åƒæœ‰**åŒé‡ä¿é™©**çš„å¿«é€’
- ğŸ“¦ æ­£å¸¸æƒ…å†µï¼šåŒ…è£¹å®Œå¥½é€è¾¾ï¼ˆ.thenå¤„ç†ï¼‰
- ğŸ’¥ å¼‚å¸¸æƒ…å†µï¼šåŒ…è£¹æŸåæˆ–ä¸¢å¤±ï¼ˆ.catchå¤„ç†ï¼‰

```
Promiseé”™è¯¯å¤„ç† = ç¼–ç¨‹ç•Œçš„"ä¿é™©ç†èµ”"
ä¸ç®¡ä»€ä¹ˆæ—¶å€™å‡ºé—®é¢˜ï¼Œéƒ½æœ‰äººå…œåº•
```

### 3.2 é”™è¯¯çš„äº§ç”Ÿæ–¹å¼


**ğŸ”¸ ä¸»åŠ¨reject**ï¼š
```javascript
const promise = new Promise((resolve, reject) => {
    const hasError = true;
    
    if (hasError) {
        reject('ä¸»åŠ¨æŠ›å‡ºçš„é”™è¯¯'); // ä¸»åŠ¨äº§ç”Ÿé”™è¯¯
    } else {
        resolve('æˆåŠŸ');
    }
});
```

**ğŸ”¸ ä»£ç æ‰§è¡Œé”™è¯¯**ï¼š
```javascript
const promise = new Promise((resolve, reject) => {
    // è¿™é‡Œä¼šè‡ªåŠ¨catché”™è¯¯å¹¶reject
    throw new Error('ä»£ç æ‰§è¡Œå‡ºé”™äº†ï¼');
    // ç­‰åŒäº reject(new Error('ä»£ç æ‰§è¡Œå‡ºé”™äº†ï¼'))
});
```

**ğŸ”¸ å¼‚æ­¥æ“ä½œé”™è¯¯**ï¼š
```javascript
function fetchData() {
    return new Promise((resolve, reject) => {
        // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
        setTimeout(() => {
            const networkError = Math.random() < 0.3;
            
            if (networkError) {
                reject('ç½‘ç»œè¿æ¥å¤±è´¥');
            } else {
                resolve('æ•°æ®è·å–æˆåŠŸ');
            }
        }, 1000);
    });
}
```

### 3.3 é”™è¯¯å¤„ç†çš„ä¸¤ç§æ–¹å¼


**ğŸ”¸ ä½¿ç”¨.catch()æ–¹æ³•**ï¼š
```javascript
fetchData()
    .then(data => {
        console.log('æˆåŠŸ:', data);
    })
    .catch(error => {
        console.log('å¤±è´¥:', error); // ç»Ÿä¸€å¤„ç†æ‰€æœ‰é”™è¯¯
    });
```

**ğŸ”¸ ä½¿ç”¨.then()çš„ç¬¬äºŒä¸ªå‚æ•°**ï¼š
```javascript
fetchData()
    .then(
        data => {
            console.log('æˆåŠŸ:', data);
        },
        error => {
            console.log('å¤±è´¥:', error); // åªå¤„ç†è¿™ä¸€æ­¥çš„é”™è¯¯
        }
    );
```

> ğŸ’¡ **æ¨èä½¿ç”¨.catch()**ï¼šæ›´æ¸…æ™°ï¼Œèƒ½æ•è·æ•´ä¸ªé“¾æ¡çš„é”™è¯¯

### 3.4 é“¾å¼è°ƒç”¨ä¸­çš„é”™è¯¯ä¼ æ’­


**é”™è¯¯ä¼ æ’­æœºåˆ¶**ï¼š
```
Promiseé“¾å°±åƒå¤šç±³è¯ºéª¨ç‰Œ
ä¸€ä¸ªç¯èŠ‚å‡ºé”™ï¼Œé”™è¯¯ä¼š"è·³è¿‡"åé¢çš„.then()
ç›´æ¥ä¼ æ’­åˆ°æœ€è¿‘çš„.catch()
```

```javascript
step1()
    .then(result1 => {
        throw new Error('ç¬¬2æ­¥å‡ºé”™äº†ï¼'); // è¿™é‡Œå‡ºé”™
    })
    .then(result2 => {
        console.log('ç¬¬3æ­¥'); // è¿™æ­¥ä¸ä¼šæ‰§è¡Œ
    })
    .then(result3 => {
        console.log('ç¬¬4æ­¥'); // è¿™æ­¥ä¹Ÿä¸ä¼šæ‰§è¡Œ
    })
    .catch(error => {
        console.log('æ•è·é”™è¯¯:', error.message); // ç›´æ¥è·³åˆ°è¿™é‡Œ
    });
```

### 3.5 é”™è¯¯æ¢å¤æœºåˆ¶


**åœ¨catchä¸­æ¢å¤**ï¼š
```javascript
fetchData()
    .then(data => processData(data))
    .catch(error => {
        console.log('å‡ºé”™äº†ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
        return 'é»˜è®¤æ•°æ®'; // é”™è¯¯æ¢å¤ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„.then()
    })
    .then(result => {
        console.log('æœ€ç»ˆç»“æœ:', result); // ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
    });
```

### 3.6 å®æˆ˜ï¼šç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†


```javascript
function safeRequest(url) {
    return fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTPé”™è¯¯: ${response.status}`);
            }
            return response.json();
        })
        .catch(error => {
            if (error.name === 'TypeError') {
                throw new Error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            } else if (error.message.includes('HTTPé”™è¯¯')) {
                throw new Error('æœåŠ¡å™¨å“åº”é”™è¯¯');
            } else {
                throw new Error('æœªçŸ¥é”™è¯¯: ' + error.message);
            }
        });
}

// ä½¿ç”¨
safeRequest('/api/user')
    .then(data => console.log('ç”¨æˆ·æ•°æ®:', data))
    .catch(error => {
        console.log('å‹å¥½é”™è¯¯æç¤º:', error.message);
        // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºé”™è¯¯æç¤ºç»™ç”¨æˆ·
    });
```

---

## 4. ğŸ”— Promiseç»„åˆ


### 4.1 ä»€ä¹ˆæ˜¯Promiseç»„åˆ


**ç”Ÿæ´»ä¸­çš„ç»„åˆæ“ä½œ**ï¼š
```
å‡†å¤‡èšé¤ï¼š
- å°æ˜è´Ÿè´£ä¹°èœ ğŸ¥¬
- å°çº¢è´Ÿè´£ä¹°é¥®æ–™ ğŸ¥¤  
- å°æè´Ÿè´£è®¢è›‹ç³• ğŸ‚

ä¸‰ä¸ªäººåŒæ—¶è¡ŒåŠ¨ï¼Œéƒ½å®Œæˆäº†æ‰èƒ½å¼€å§‹èšé¤
```

**Promiseç»„åˆ**å°±æ˜¯æŠŠå¤šä¸ªç‹¬ç«‹çš„å¼‚æ­¥æ“ä½œ**åˆå¹¶**å¤„ç†ï¼š

### 4.2 Promise.all() - å…¨éƒ¨æˆåŠŸæ‰æˆåŠŸ


**å«ä¹‰**ï¼šç­‰æ‰€æœ‰Promiseéƒ½æˆåŠŸï¼Œæ‰ç®—æˆåŠŸï¼›ä»»ä½•ä¸€ä¸ªå¤±è´¥ï¼Œå°±ç®—å¤±è´¥

```javascript
// æ¨¡æ‹Ÿä¸‰ä¸ªç‹¬ç«‹çš„ä»»åŠ¡
function buyFood() {
    return new Promise(resolve => {
        setTimeout(() => resolve('ğŸ¥¬ ä¹°èœå®Œæˆ'), 2000);
    });
}

function buyDrinks() {
    return new Promise(resolve => {
        setTimeout(() => resolve('ğŸ¥¤ ä¹°é¥®æ–™å®Œæˆ'), 1500);
    });
}

function orderCake() {
    return new Promise(resolve => {
        setTimeout(() => resolve('ğŸ‚ è®¢è›‹ç³•å®Œæˆ'), 3000);
    });
}

// ä½¿ç”¨Promise.allç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
Promise.all([buyFood(), buyDrinks(), orderCake()])
    .then(results => {
        console.log('æ‰€æœ‰ä»»åŠ¡å®Œæˆ:', results);
        // ['ğŸ¥¬ ä¹°èœå®Œæˆ', 'ğŸ¥¤ ä¹°é¥®æ–™å®Œæˆ', 'ğŸ‚ è®¢è›‹ç³•å®Œæˆ']
        console.log('å¯ä»¥å¼€å§‹èšé¤äº†ï¼');
    })
    .catch(error => {
        console.log('æœ‰ä»»åŠ¡å¤±è´¥äº†:', error);
    });
```

**ç‰¹ç‚¹æ€»ç»“**ï¼š
- â±ï¸ **å¹¶è¡Œæ‰§è¡Œ**ï¼šæ‰€æœ‰PromiseåŒæ—¶å¼€å§‹
- âœ… **å…¨éƒ¨æˆåŠŸ**ï¼šæ‰€æœ‰Promiseéƒ½resolveæ‰ç®—æˆåŠŸ
- âŒ **ä¸€ä¸ªå¤±è´¥å…¨å¤±è´¥**ï¼šä»»ä½•ä¸€ä¸ªrejectå°±ç®—å¤±è´¥
- ğŸ“‹ **ç»“æœæŒ‰é¡ºåº**ï¼šè¿”å›æ•°ç»„æŒ‰åŸå§‹é¡ºåºæ’åˆ—

### 4.3 Promise.allSettled() - ç­‰æ‰€æœ‰ç»“æœ


**å«ä¹‰**ï¼šä¸ç®¡æˆåŠŸå¤±è´¥ï¼Œç­‰æ‰€æœ‰Promiseéƒ½æœ‰ç»“æœ

```javascript
function taskA() {
    return new Promise(resolve => {
        setTimeout(() => resolve('ä»»åŠ¡AæˆåŠŸ'), 1000);
    });
}

function taskB() {
    return new Promise((resolve, reject) => {
        setTimeout(() => reject('ä»»åŠ¡Bå¤±è´¥'), 1500);
    });
}

function taskC() {
    return new Promise(resolve => {
        setTimeout(() => resolve('ä»»åŠ¡CæˆåŠŸ'), 2000);
    });
}

Promise.allSettled([taskA(), taskB(), taskC()])
    .then(results => {
        console.log('æ‰€æœ‰ä»»åŠ¡éƒ½æœ‰ç»“æœäº†:');
        results.forEach((result, index) => {
            if (result.status === 'fulfilled') {
                console.log(`ä»»åŠ¡${index + 1} æˆåŠŸ:`, result.value);
            } else {
                console.log(`ä»»åŠ¡${index + 1} å¤±è´¥:`, result.reason);
            }
        });
    });
```

**è¾“å‡ºç»“æœ**ï¼š
```
æ‰€æœ‰ä»»åŠ¡éƒ½æœ‰ç»“æœäº†:
ä»»åŠ¡1 æˆåŠŸ: ä»»åŠ¡AæˆåŠŸ
ä»»åŠ¡2 å¤±è´¥: ä»»åŠ¡Bå¤±è´¥  
ä»»åŠ¡3 æˆåŠŸ: ä»»åŠ¡CæˆåŠŸ
```

### 4.4 Promise.race() - æœ€å¿«çš„è·èƒœ


**å«ä¹‰**ï¼šè°æœ€å…ˆæœ‰ç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰ï¼Œå°±ç”¨è°çš„ç»“æœ

```javascript
function server1() {
    return new Promise(resolve => {
        setTimeout(() => resolve('æœåŠ¡å™¨1å“åº”'), 2000);
    });
}

function server2() {
    return new Promise(resolve => {
        setTimeout(() => resolve('æœåŠ¡å™¨2å“åº”'), 1000); // æ›´å¿«
    });
}

function server3() {
    return new Promise(resolve => {
        setTimeout(() => resolve('æœåŠ¡å™¨3å“åº”'), 3000);
    });
}

// ç«é€Ÿï¼šè°æœ€å¿«ç”¨è°çš„
Promise.race([server1(), server2(), server3()])
    .then(result => {
        console.log('æœ€å¿«çš„æœåŠ¡å™¨:', result); // "æœåŠ¡å™¨2å“åº”"
    });
```

**å®é™…åº”ç”¨ - è¯·æ±‚è¶…æ—¶**ï¼š
```javascript
function requestWithTimeout(url, timeout = 5000) {
    const request = fetch(url);
    
    const timeoutPromise = new Promise((resolve, reject) => {
        setTimeout(() => reject('è¯·æ±‚è¶…æ—¶'), timeout);
    });
    
    return Promise.race([request, timeoutPromise]);
}

// ä½¿ç”¨
requestWithTimeout('/api/data', 3000)
    .then(response => console.log('è¯·æ±‚æˆåŠŸ'))
    .catch(error => console.log('è¯·æ±‚å¤±è´¥:', error));
```

### 4.5 Promise.any() - ä»»ä½•ä¸€ä¸ªæˆåŠŸå°±æˆåŠŸ


**å«ä¹‰**ï¼šä»»ä½•ä¸€ä¸ªæˆåŠŸå°±ç®—æˆåŠŸï¼Œå…¨éƒ¨å¤±è´¥æ‰ç®—å¤±è´¥

```javascript
function unstableServer1() {
    return new Promise((resolve, reject) => {
        setTimeout(() => reject('æœåŠ¡å™¨1å¤±è´¥'), 1000);
    });
}

function unstableServer2() {
    return new Promise(resolve => {
        setTimeout(() => resolve('æœåŠ¡å™¨2æˆåŠŸ'), 2000);
    });
}

function unstableServer3() {
    return new Promise((resolve, reject) => {
        setTimeout(() => reject('æœåŠ¡å™¨3å¤±è´¥'), 1500);
    });
}

Promise.any([unstableServer1(), unstableServer2(), unstableServer3()])
    .then(result => {
        console.log('æœ‰æœåŠ¡å™¨æˆåŠŸäº†:', result); // "æœåŠ¡å™¨2æˆåŠŸ"
    })
    .catch(error => {
        console.log('æ‰€æœ‰æœåŠ¡å™¨éƒ½å¤±è´¥äº†');
    });
```

### 4.6 ç»„åˆæ–¹æ³•å¯¹æ¯”è¡¨æ ¼


| æ–¹æ³• | **æˆåŠŸæ¡ä»¶** | **å¤±è´¥æ¡ä»¶** | **ä½¿ç”¨åœºæ™¯** |
|------|------------|------------|------------|
| `Promise.all()` | `å…¨éƒ¨æˆåŠŸ` | `ä»»ä½•ä¸€ä¸ªå¤±è´¥` | `å¿…é¡»ç­‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆ` |
| `Promise.allSettled()` | `æ€»æ˜¯æˆåŠŸ` | `ä¸ä¼šå¤±è´¥` | `æ”¶é›†æ‰€æœ‰ä»»åŠ¡çš„ç»“æœ` |
| `Promise.race()` | `æœ€å…ˆæˆåŠŸçš„` | `æœ€å…ˆå¤±è´¥çš„` | `è¶…æ—¶æ§åˆ¶ã€ç«é€Ÿé€‰æ‹©` |
| `Promise.any()` | `ä»»ä½•ä¸€ä¸ªæˆåŠŸ` | `å…¨éƒ¨å¤±è´¥` | `å¤‡ç”¨æ–¹æ¡ˆã€å®¹é”™å¤„ç†` |

---

## 5. âš¡ å¼‚æ­¥æµç¨‹æ§åˆ¶


### 5.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥æµç¨‹æ§åˆ¶


**ä¼ ç»ŸåŒæ­¥æµç¨‹**ï¼š
```
ä¹°ç¥¨ â†’ æ£€ç¥¨ â†’ ä¸Šè½¦ â†’ åˆ°ç«™
æ¯ä¸€æ­¥å¿…é¡»ç­‰å‰ä¸€æ­¥å®Œæˆ
```

**å¼‚æ­¥æµç¨‹æ§åˆ¶**ï¼šç®¡ç†é‚£äº›**ä¸æŒ‰é¡ºåºå®Œæˆ**çš„æ“ä½œï¼Œè®©å®ƒä»¬æŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„æ–¹å¼æ‰§è¡Œ

```
å¼‚æ­¥æµç¨‹æ§åˆ¶ = å½“"å¼‚æ­¥æ“ä½œçš„æŒ‡æŒ¥å®¶"
æŒ‡æŒ¥å¤šä¸ª"ä¹å™¨"(å¼‚æ­¥æ“ä½œ)åè°ƒæ¼”å¥
```

### 5.2 ä¸²è¡Œæ‰§è¡Œ - ä¸€ä¸ªæ¥ä¸€ä¸ª


**åœºæ™¯**ï¼šç”¨æˆ·ç™»å½•æµç¨‹å¿…é¡»æŒ‰é¡ºåºè¿›è¡Œ

```javascript
// ä¸²è¡Œæ‰§è¡Œï¼šå¿…é¡»ä¸€æ­¥æ­¥æ¥
function userLogin(credentials) {
    return validateCredentials(credentials)    // ç¬¬1æ­¥ï¼šéªŒè¯å‡­æ®
        .then(validUser => loadUserProfile(validUser))  // ç¬¬2æ­¥ï¼šåŠ è½½ç”¨æˆ·ä¿¡æ¯
        .then(profile => loadUserPermissions(profile))  // ç¬¬3æ­¥ï¼šåŠ è½½æƒé™
        .then(permissions => initializeUserSession(permissions)) // ç¬¬4æ­¥ï¼šåˆå§‹åŒ–ä¼šè¯
        .then(session => {
            console.log('ç™»å½•å®Œæˆ:', session);
            return session;
        });
}

// ä½¿ç”¨
userLogin({ username: 'user', password: 'pass' })
    .then(session => console.log('ç”¨æˆ·å·²ç™»å½•'))
    .catch(error => console.log('ç™»å½•å¤±è´¥:', error));
```

**ä¸²è¡Œæ§åˆ¶å·¥å…·å‡½æ•°**ï¼š
```javascript
// é€šç”¨ä¸²è¡Œæ‰§è¡Œå‡½æ•°
function executeSerially(tasks) {
    return tasks.reduce((prevPromise, currentTask) => {
        return prevPromise.then(results => {
            return currentTask().then(result => [...results, result]);
        });
    }, Promise.resolve([]));
}

// ä½¿ç”¨
const tasks = [
    () => asyncTask1(),
    () => asyncTask2(), 
    () => asyncTask3()
];

executeSerially(tasks)
    .then(results => console.log('æ‰€æœ‰ä»»åŠ¡å®Œæˆ:', results));
```

### 5.3 å¹¶è¡Œæ‰§è¡Œ - åŒæ—¶è¿›è¡Œ


**åœºæ™¯**ï¼šé¡µé¢åˆå§‹åŒ–éœ€è¦åŒæ—¶åŠ è½½å¤šä¸ªç‹¬ç«‹æ•°æ®

```javascript
function initializePage() {
    // å¹¶è¡Œæ‰§è¡Œï¼šåŒæ—¶å¼€å§‹ï¼Œæé«˜æ•ˆç‡
    const userDataPromise = loadUserData();
    const configPromise = loadAppConfig();
    const adsPromise = loadAdvertisements();
    
    return Promise.all([userDataPromise, configPromise, adsPromise])
        .then(([userData, config, ads]) => {
            return {
                user: userData,
                config: config,
                ads: ads,
                loadTime: Date.now()
            };
        });
}

// ä½¿ç”¨
initializePage()
    .then(pageData => {
        console.log('é¡µé¢æ•°æ®åŠ è½½å®Œæˆ:', pageData);
        renderPage(pageData);
    })
    .catch(error => {
        console.log('é¡µé¢åŠ è½½å¤±è´¥:', error);
        showErrorPage();
    });
```

### 5.4 æ¡ä»¶æµç¨‹æ§åˆ¶


**åœºæ™¯**ï¼šæ ¹æ®ç”¨æˆ·ç±»å‹æ‰§è¡Œä¸åŒæµç¨‹

```javascript
function processUser(user) {
    return determineUserType(user)
        .then(userType => {
            if (userType === 'admin') {
                return loadAdminData(user)
                    .then(adminData => setupAdminInterface(adminData));
            } else if (userType === 'premium') {
                return loadPremiumFeatures(user)
                    .then(features => setupPremiumInterface(features));
            } else {
                return setupBasicInterface(user);
            }
        })
        .then(interface => {
            console.log('ç”¨æˆ·ç•Œé¢è®¾ç½®å®Œæˆ');
            return interface;
        });
}
```

### 5.5 å¾ªç¯å¼‚æ­¥æ“ä½œ


**åœºæ™¯**ï¼šæ‰¹é‡å¤„ç†æ•°æ®ï¼Œä½†è¦æ§åˆ¶å¹¶å‘æ•°é‡

```javascript
// åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
async function processBatch(items, batchSize = 3) {
    const results = [];
    
    for (let i = 0; i < items.length; i += batchSize) {
        const batch = items.slice(i, i + batchSize);
        
        // æ¯æ‰¹å¹¶è¡Œå¤„ç†
        const batchPromises = batch.map(item => processItem(item));
        const batchResults = await Promise.all(batchPromises);
        
        results.push(...batchResults);
        
        console.log(`å®Œæˆç¬¬ ${Math.floor(i/batchSize) + 1} æ‰¹å¤„ç†`);
        
        // æ‰¹æ¬¡é—´ç¨ä½œä¼‘æ¯ï¼Œé¿å…å‹å®æœåŠ¡å™¨
        if (i + batchSize < items.length) {
            await new Promise(resolve => setTimeout(resolve, 100));
        }
    }
    
    return results;
}

// ä½¿ç”¨
const largeDataSet = [/* 1000ä¸ªæ•°æ®é¡¹ */];
processBatch(largeDataSet, 5)
    .then(results => console.log('æ‰€æœ‰æ•°æ®å¤„ç†å®Œæˆ:', results.length));
```

### 5.6 é‡è¯•æœºåˆ¶


**åœºæ™¯**ï¼šç½‘ç»œä¸ç¨³å®šæ—¶è‡ªåŠ¨é‡è¯•

```javascript
function requestWithRetry(url, maxRetries = 3) {
    function attempt(retriesLeft) {
        return fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.json();
            })
            .catch(error => {
                if (retriesLeft > 0) {
                    console.log(`è¯·æ±‚å¤±è´¥ï¼Œè¿˜æœ‰ ${retriesLeft} æ¬¡é‡è¯•æœºä¼š`);
                    
                    // å»¶è¿Ÿåé‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
                    const delay = Math.pow(2, maxRetries - retriesLeft) * 1000;
                    return new Promise(resolve => setTimeout(resolve, delay))
                        .then(() => attempt(retriesLeft - 1));
                } else {
                    throw new Error(`è¯·æ±‚æœ€ç»ˆå¤±è´¥: ${error.message}`);
                }
            });
    }
    
    return attempt(maxRetries);
}

// ä½¿ç”¨
requestWithRetry('/api/unreliable-endpoint')
    .then(data => console.log('è¯·æ±‚æˆåŠŸ:', data))
    .catch(error => console.log('è¯·æ±‚å½»åº•å¤±è´¥:', error.message));
```

### 5.7 æµç¨‹æ§åˆ¶æœ€ä½³å®è·µ


**ğŸ”¸ é€‰æ‹©åˆé€‚çš„æ§åˆ¶æ–¹å¼**ï¼š
```
ç‹¬ç«‹ä»»åŠ¡ â†’ å¹¶è¡Œæ‰§è¡Œ (Promise.all)
ä¾èµ–ä»»åŠ¡ â†’ ä¸²è¡Œæ‰§è¡Œ (.thené“¾)
å¯é€‰ä»»åŠ¡ â†’ æ¡ä»¶æ‰§è¡Œ (if/else)
å¤§é‡ä»»åŠ¡ â†’ åˆ†æ‰¹å¤„ç† (æ‰¹å¤„ç†)
ä¸ç¨³å®šä»»åŠ¡ â†’ é‡è¯•æœºåˆ¶ (retry)
```

**ğŸ”¸ é”™è¯¯å¤„ç†è¦å‘¨å…¨**ï¼š
```javascript
function robustAsyncFlow() {
    return step1()
        .then(result1 => step2(result1))
        .then(result2 => step3(result2))
        .catch(error => {
            // è®°å½•é”™è¯¯
            console.error('æµç¨‹æ‰§è¡Œå¤±è´¥:', error);
            
            // æ¸…ç†èµ„æº
            cleanup();
            
            // é‡æ–°æŠ›å‡ºè®©ä¸Šå±‚å¤„ç†
            throw error;
        });
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ PromiseçŠ¶æ€ï¼špending â†’ fulfilled/rejectedï¼ˆä¸å¯é€†è½¬ï¼‰
ğŸ”¸ é“¾å¼è°ƒç”¨ï¼š.then()è¿”å›æ–°Promiseï¼Œæ”¯æŒé“¾å¼æ“ä½œ
ğŸ”¸ é”™è¯¯å¤„ç†ï¼š.catch()æ•è·é”™è¯¯ï¼Œæ”¯æŒé”™è¯¯æ¢å¤
ğŸ”¸ Promiseç»„åˆï¼šall/allSettled/race/anyè§£å†³ä¸åŒåœºæ™¯
ğŸ”¸ æµç¨‹æ§åˆ¶ï¼šä¸²è¡Œã€å¹¶è¡Œã€æ¡ä»¶ã€å¾ªç¯ã€é‡è¯•ç­‰æ¨¡å¼
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Promiseæ€ç»´çš„æœ¬è´¨**
```
Promise = å¼‚æ­¥æ“ä½œçš„"æ‰¿è¯ºä¹¦"
- çŠ¶æ€ç®¡ç†ï¼šæ¸…æ¥šåœ°çŸ¥é“æ“ä½œè¿›å±•
- é“¾å¼è°ƒç”¨ï¼šä¼˜é›…åœ°ç»„ç»‡å¤æ‚æµç¨‹  
- é”™è¯¯å¤„ç†ï¼šå®‰å…¨åœ°å¤„ç†å¼‚å¸¸æƒ…å†µ
- ç»„åˆæ“ä½œï¼šé«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªä»»åŠ¡
- æµç¨‹æ§åˆ¶ï¼šçµæ´»åœ°æ§åˆ¶æ‰§è¡Œé¡ºåº
```

**ğŸ”¹ ä½•æ—¶ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•**
```
éœ€è¦é¡ºåºæ‰§è¡Œ â†’ é“¾å¼.then()
éœ€è¦å¹¶è¡Œç­‰å¾… â†’ Promise.all()
éœ€è¦æ”¶é›†æ‰€æœ‰ç»“æœ â†’ Promise.allSettled()
éœ€è¦æœ€å¿«å“åº” â†’ Promise.race()
éœ€è¦ä»»ä¸€æˆåŠŸ â†’ Promise.any()
éœ€è¦é”™è¯¯æ¢å¤ â†’ .catch()ä¸­return
```

**ğŸ”¹ Promise vs å›è°ƒå‡½æ•°**
```
å›è°ƒå‡½æ•°é—®é¢˜ï¼š
- å›è°ƒåœ°ç‹±ï¼šåµŒå¥—å¤ªæ·±ï¼Œéš¾ä»¥ç»´æŠ¤
- é”™è¯¯å¤„ç†ï¼šæ¯å±‚éƒ½è¦å¤„ç†ï¼Œå®¹æ˜“é—æ¼
- æ§åˆ¶æµç¨‹ï¼šéš¾ä»¥å®ç°å¤æ‚æµç¨‹æ§åˆ¶

Promiseä¼˜åŠ¿ï¼š
- é“¾å¼è°ƒç”¨ï¼šæ‰å¹³åŒ–ä»£ç ç»“æ„
- ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼šä¸€ä¸ª.catch()æå®š
- ä¸°å¯Œçš„ç»„åˆæ–¹æ³•ï¼šæ»¡è¶³å„ç§åœºæ™¯
- æ›´å¥½çš„å¯è¯»æ€§ï¼šä»£ç å³æ–‡æ¡£
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ—¥å¸¸å¼€å‘åº”ç”¨**
- **APIè¯·æ±‚**ï¼šé“¾å¼å¤„ç†è¯·æ±‚â†’è§£æâ†’ä½¿ç”¨æ•°æ®
- **æ–‡ä»¶æ“ä½œ**ï¼šè¯»å–â†’å¤„ç†â†’ä¿å­˜â†’é€šçŸ¥ç”¨æˆ·
- **è¡¨å•æäº¤**ï¼šéªŒè¯â†’æäº¤â†’æ›´æ–°ç•Œé¢â†’æ˜¾ç¤ºç»“æœ
- **æ‰¹é‡å¤„ç†**ï¼šåˆ†æ‰¹â†’å¹¶è¡Œâ†’æ”¶é›†â†’æ±‡æ€»ç»“æœ
- **ç³»ç»Ÿåˆå§‹åŒ–**ï¼šåŠ è½½é…ç½®â†’è¿æ¥æœåŠ¡â†’å‡†å¤‡ç•Œé¢

**ğŸ”§ æœ€ä½³å®è·µå»ºè®®**
```javascript
// âœ… å¥½çš„Promiseä½¿ç”¨
function goodPromiseUsage() {
    return validateInput()
        .then(data => processData(data))
        .then(result => saveResult(result))
        .then(saved => notifyUser(saved))
        .catch(error => {
            logError(error);
            showUserFriendlyMessage(error);
            throw error; // å¦‚æœéœ€è¦ä¸Šå±‚å¤„ç†
        });
}

// âŒ é¿å…çš„å†™æ³•
function badPromiseUsage() {
    return new Promise((resolve, reject) => {
        // ä¸è¦æŠŠPromiseå½“å›è°ƒå‡½æ•°åŒ…è£…å™¨
        validateInput()
            .then(data => {
                processData(data)
                    .then(result => {
                        // åˆå˜æˆå›è°ƒåœ°ç‹±äº†ï¼
                        resolve(result);
                    });
            });
    });
}
```

### 6.4 è®°å¿†è¦è¯€


**PromiseçŠ¶æ€è®°å¿†**ï¼š
- ğŸ• Pendingï¼šæ­£åœ¨è·¯ä¸Šçš„å¿«é€’
- âœ… Fulfilledï¼šæˆåŠŸé€è¾¾çš„å¿«é€’  
- âŒ Rejectedï¼šé…é€å¤±è´¥çš„å¿«é€’

**é“¾å¼è°ƒç”¨è®°å¿†**ï¼š
- ğŸ”— æ¯ä¸ª.then()éƒ½æ˜¯æ–°çš„"æ¥åŠ›æ£’"
- ğŸ“¤ returnçš„å€¼ä¼ ç»™ä¸‹ä¸€æ£’
- ğŸš¨ throwçš„é”™è¯¯è·³åˆ°.catch()

**ç»„åˆæ–¹æ³•è®°å¿†**ï¼š
- ğŸ allï¼šå…¨éƒ¨åˆ°ç»ˆç‚¹æ‰ç®—èµ¢
- ğŸ“Š allSettledï¼šè®°å½•æ‰€æœ‰äººçš„æˆç»©
- ğŸƒ raceï¼šç¬¬ä¸€ä¸ªå†²çº¿çš„è·èƒœ
- ğŸ¯ anyï¼šä»»ä½•ä¸€ä¸ªæˆåŠŸå°±è¡Œ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
PromiseçŠ¶æ€ä¸‰å…„å¼Ÿï¼Œpendingå¼€å§‹fulfilledå¥½ï¼Œ
rejectedé”™è¯¯è¦å¤„ç†ï¼ŒçŠ¶æ€æ”¹å˜ä¸å¯é€†ã€‚
é“¾å¼è°ƒç”¨çœŸä¼˜é›…ï¼Œthenè¿”å›æ–°Promiseï¼Œ
é”™è¯¯å¤„ç†ç”¨catchï¼Œæµç¨‹æ§åˆ¶å¾ˆçµæ´»ã€‚
```