---
title: 4ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æ¦‚è¿°](#1-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æ¦‚è¿°)
2. [æœ‰ç•Œç¼“å†²åŒºè®¾è®¡](#2-æœ‰ç•Œç¼“å†²åŒºè®¾è®¡)
3. [é˜Ÿåˆ—åŒæ­¥æœºåˆ¶](#3-é˜Ÿåˆ—åŒæ­¥æœºåˆ¶)
4. [èƒŒå‹å¤„ç†ç­–ç•¥](#4-èƒŒå‹å¤„ç†ç­–ç•¥)
5. [æµé‡æ§åˆ¶æœºåˆ¶](#5-æµé‡æ§åˆ¶æœºåˆ¶)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ­ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹


**ğŸ¯ ç”Ÿæ´»ä¸­çš„ä¾‹å­**
```
å¿«é¤åº—åœºæ™¯ï¼š
å¨å¸ˆ = ç”Ÿäº§è€…ï¼ˆåˆ¶ä½œæ±‰å ¡ï¼‰
é¡¾å®¢ = æ¶ˆè´¹è€…ï¼ˆè´­ä¹°æ±‰å ¡ï¼‰
ä¿æ¸©æŸœ = ç¼“å†²åŒºï¼ˆæš‚å­˜æ±‰å ¡ï¼‰

é—®é¢˜ï¼š
- å¨å¸ˆåšå¤ªå¿«ï¼Œä¿æ¸©æŸœæ”¾ä¸ä¸‹ â†’ éœ€è¦ç­‰å¾…
- é¡¾å®¢æ¥å¤ªå¤šï¼Œæ±‰å ¡ä¸å¤Ÿå– â†’ éœ€è¦ç­‰å¾…
```

**ğŸ’¡ ç¼–ç¨‹ä¸­çš„å«ä¹‰**
> ğŸ§  **é€šä¿—ç†è§£**
> 
> ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹å°±åƒå·¥å‚æµæ°´çº¿ï¼šä¸€æ–¹ç”Ÿäº§æ•°æ®ï¼Œä¸€æ–¹æ¶ˆè´¹æ•°æ®ï¼Œä¸­é—´ç”¨ç¼“å†²åŒºåè°ƒé€Ÿåº¦å·®å¼‚

**æ ¸å¿ƒè§’è‰²ï¼š**
- **ç”Ÿäº§è€…ï¼ˆProducerï¼‰**ï¼šè´Ÿè´£åˆ›å»ºæ•°æ®çš„çº¿ç¨‹
- **æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰**ï¼šè´Ÿè´£å¤„ç†æ•°æ®çš„çº¿ç¨‹  
- **ç¼“å†²åŒºï¼ˆBufferï¼‰**ï¼šæš‚å­˜æ•°æ®çš„ä¸­é—´å­˜å‚¨

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ¨¡å‹


**ğŸ” è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| **é€Ÿåº¦ä¸åŒ¹é…** | ç”Ÿäº§å¿«æ¶ˆè´¹æ…¢ | ç¼“å†²åŒºæš‚å­˜ |
| **æ—¶é—´è§£è€¦** | ç”Ÿäº§æ¶ˆè´¹æ—¶é—´ä¸åŒæ­¥ | å¼‚æ­¥å¤„ç† |
| **èµ„æºåˆ©ç”¨** | CPUå’ŒIOä¸åŒæ­¥ | å¹¶å‘æ‰§è¡Œ |

**ğŸ“± å®é™…åº”ç”¨åœºæ™¯**
```
æ—¥å¿—ç³»ç»Ÿï¼š
ç”Ÿäº§è€… â†’ ä¸šåŠ¡çº¿ç¨‹äº§ç”Ÿæ—¥å¿—
æ¶ˆè´¹è€… â†’ åå°çº¿ç¨‹å†™å…¥æ–‡ä»¶
ç¼“å†²åŒº â†’ å†…å­˜é˜Ÿåˆ—

ä¸‹è½½ç³»ç»Ÿï¼š
ç”Ÿäº§è€… â†’ ç½‘ç»œçº¿ç¨‹ä¸‹è½½æ•°æ®å—
æ¶ˆè´¹è€… â†’ æ–‡ä»¶çº¿ç¨‹å†™å…¥ç£ç›˜
ç¼“å†²åŒº â†’ å†…å­˜ç¼“å­˜
```

### 1.3 åŸºæœ¬å·¥ä½œæµç¨‹


**ğŸ”„ åä½œæµç¨‹å›¾**
```
ç”Ÿäº§è€…çº¿ç¨‹              ç¼“å†²åŒº              æ¶ˆè´¹è€…çº¿ç¨‹
     |                    |                    |
  [ç”Ÿäº§æ•°æ®]               |                    |
     |----[æ”¾å…¥]---------->|                    |
     |                [å­˜å‚¨ä¸­]                  |
     |                    |----[å–å‡º]---------->|
     |                    |                [å¤„ç†æ•°æ®]
     |                    |                    |
  [ç»§ç»­ç”Ÿäº§]               |                [ç»§ç»­æ¶ˆè´¹]
     |                    |                    |
```

**âš¡ ç®€å•ä»£ç ç¤ºä¾‹**
```java
// åŸºç¡€çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…ç¤ºä¾‹
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.LinkedBlockingQueue;

public class ProducerConsumerDemo {
    private BlockingQueue<String> queue = new LinkedBlockingQueue<>(10);
    
    // ç”Ÿäº§è€…ï¼šåˆ¶ä½œæ•°æ®
    class Producer implements Runnable {
        public void run() {
            for (int i = 0; i < 5; i++) {
                try {
                    String product = "å•†å“-" + i;
                    queue.put(product);  // æ”¾å…¥é˜Ÿåˆ—
                    System.out.println("ç”Ÿäº§ï¼š" + product);
                    Thread.sleep(1000);  // æ¨¡æ‹Ÿç”Ÿäº§æ—¶é—´
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }
    }
    
    // æ¶ˆè´¹è€…ï¼šå¤„ç†æ•°æ®
    class Consumer implements Runnable {
        public void run() {
            for (int i = 0; i < 5; i++) {
                try {
                    String product = queue.take();  // ä»é˜Ÿåˆ—å–å‡º
                    System.out.println("æ¶ˆè´¹ï¼š" + product);
                    Thread.sleep(2000);  // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }
    }
}
```

**ğŸ¯ è¿è¡Œæ•ˆæœ**
```
ç”Ÿäº§ï¼šå•†å“-0
æ¶ˆè´¹ï¼šå•†å“-0
ç”Ÿäº§ï¼šå•†å“-1
ç”Ÿäº§ï¼šå•†å“-2  â† ç”Ÿäº§é€Ÿåº¦æ›´å¿«
æ¶ˆè´¹ï¼šå•†å“-1  â† æ¶ˆè´¹é€Ÿåº¦è¾ƒæ…¢
...
```

---

## 2. ğŸ“¦ æœ‰ç•Œç¼“å†²åŒºè®¾è®¡


### 2.1 ä»€ä¹ˆæ˜¯æœ‰ç•Œç¼“å†²åŒº


**ğŸ¯ æœ‰ç•Œ vs æ— ç•Œå¯¹æ¯”**
```
æœ‰ç•Œç¼“å†²åŒºï¼ˆæ¨èï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å•†å“1][å•†å“2][  ç©º  ][  ç©º  ] â”‚ â† å›ºå®šå¤§å°ï¼Œæ»¡äº†å°±ç­‰å¾…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å®¹é‡ï¼š4ä¸ªä½ç½®

æ— ç•Œç¼“å†²åŒºï¼ˆå±é™©ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
â”‚ [å•†å“1][å•†å“2][å•†å“3][å•†å“4][...] â”‚ â† æ— é™å¢é•¿ï¼Œå¯èƒ½å†…å­˜æº¢å‡º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
å®¹é‡ï¼šç†è®ºæ— é™
```

> ğŸ’¡ **ä¸ºä»€ä¹ˆè¦æœ‰ç•Œï¼Ÿ**
> 
> å°±åƒåœè½¦åœºæœ‰å›ºå®šè½¦ä½ï¼Œé˜²æ­¢æ— é™åˆ¶åœè½¦å¯¼è‡´æ‹¥å µã€‚æœ‰ç•Œç¼“å†²åŒºé˜²æ­¢å†…å­˜æ— é™å¢é•¿

### 2.2 ç¼“å†²åŒºå¤§å°è®¾è®¡è€ƒè™‘


**ğŸ“Š å¤§å°é€‰æ‹©çš„å½±å“**

| ç¼“å†²åŒºå¤§å° | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----------|------|------|----------|
| **å°ç¼“å†²åŒº**<br>`(1-10)` | å†…å­˜å ç”¨å°‘<br>å“åº”å¿« | å®¹æ˜“é˜»å¡<br>ååé‡ä½ | å®æ—¶ç³»ç»Ÿ<br>å†…å­˜ç´§å¼  |
| **ä¸­ç¼“å†²åŒº**<br>`(10-100)` | å¹³è¡¡æ€§å¥½<br>é€‚åº”æ€§å¼º | éœ€è¦è°ƒä¼˜ | ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿ |
| **å¤§ç¼“å†²åŒº**<br>`(100+)` | ååé‡é«˜<br>ä¸æ˜“é˜»å¡ | å†…å­˜å ç”¨å¤š<br>å»¶è¿Ÿé«˜ | æ‰¹å¤„ç†ç³»ç»Ÿ |

**ğŸ”§ å®é™…è®¾è®¡åŸåˆ™**
```
ç»éªŒå…¬å¼ï¼š
ç¼“å†²åŒºå¤§å° = ç”Ÿäº§é€Ÿåº¦ Ã— å¤„ç†æ—¶é—´å·®

ç¤ºä¾‹è®¡ç®—ï¼š
ç”Ÿäº§é€Ÿåº¦ï¼š100æ¡/ç§’
æ¶ˆè´¹é€Ÿåº¦ï¼š80æ¡/ç§’  
å¤„ç†æ—¶é—´å·®ï¼š1ç§’
å»ºè®®ç¼“å†²åŒºï¼š(100-80) Ã— 1 = 20æ¡

å®‰å…¨ç³»æ•°ï¼š20 Ã— 2 = 40æ¡ï¼ˆæ¨èï¼‰
```

### 2.3 æœ‰ç•Œç¼“å†²åŒºå®ç°


**ğŸ› ï¸ ä½¿ç”¨æ•°ç»„å®ç°**
```java
public class BoundedBuffer<T> {
    private final Object[] buffer;
    private final int capacity;
    private int count = 0;     // å½“å‰å…ƒç´ ä¸ªæ•°
    private int putIndex = 0;  // ä¸‹ä¸€ä¸ªæ”¾å…¥ä½ç½®
    private int takeIndex = 0; // ä¸‹ä¸€ä¸ªå–å‡ºä½ç½®
    
    public BoundedBuffer(int capacity) {
        this.capacity = capacity;
        this.buffer = new Object[capacity];
    }
    
    // æ”¾å…¥å…ƒç´ ï¼ˆç”Ÿäº§è€…è°ƒç”¨ï¼‰
    public synchronized void put(T item) throws InterruptedException {
        while (count == capacity) {
            wait();  // ç¼“å†²åŒºæ»¡äº†ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹
        }
        
        buffer[putIndex] = item;
        putIndex = (putIndex + 1) % capacity;  // å¾ªç¯ä½¿ç”¨
        count++;
        
        notifyAll();  // é€šçŸ¥æ¶ˆè´¹è€…æœ‰æ–°æ•°æ®
    }
    
    // å–å‡ºå…ƒç´ ï¼ˆæ¶ˆè´¹è€…è°ƒç”¨ï¼‰
    @SuppressWarnings("unchecked")
    public synchronized T take() throws InterruptedException {
        while (count == 0) {
            wait();  // ç¼“å†²åŒºç©ºäº†ï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§
        }
        
        T item = (T) buffer[takeIndex];
        buffer[takeIndex] = null;  // é˜²æ­¢å†…å­˜æ³„æ¼
        takeIndex = (takeIndex + 1) % capacity;  // å¾ªç¯ä½¿ç”¨
        count--;
        
        notifyAll();  // é€šçŸ¥ç”Ÿäº§è€…æœ‰ç©ºä½
        return item;
    }
}
```

**ğŸ” çŠ¶æ€å˜åŒ–å›¾ç¤º**
```
åˆå§‹çŠ¶æ€ï¼š[  ][  ][  ][  ]  count=0, put=0, take=0

æ”¾å…¥Aåï¼š  [A ][  ][  ][  ]  count=1, put=1, take=0

æ”¾å…¥Båï¼š  [A ][B ][  ][  ]  count=2, put=2, take=0

å–å‡ºAåï¼š  [  ][B ][  ][  ]  count=1, put=2, take=1

æ»¡è½½çŠ¶æ€ï¼š[A ][B ][C ][D ]  count=4, put=0, take=0 â† å¾ªç¯ä½¿ç”¨
```

---

## 3. ğŸ”„ é˜Ÿåˆ—åŒæ­¥æœºåˆ¶


### 3.1 é˜Ÿåˆ—åœ¨å¹¶å‘ä¸­çš„ä½œç”¨


**ğŸ’¡ é˜Ÿåˆ—å°±æ˜¯å¤©ç„¶çš„åè°ƒå™¨**
> ğŸ§  **ç”Ÿæ´»ç±»æ¯”**
> 
> é˜Ÿåˆ—å°±åƒé“¶è¡Œæ’é˜Ÿç³»ç»Ÿï¼šé¡¾å®¢æŒ‰é¡ºåºæ’é˜Ÿï¼ŒæŸœå°æŒ‰é¡ºåºæœåŠ¡ï¼Œå¤©ç„¶ä¿è¯äº†ç§©åº

**ğŸ¯ é˜Ÿåˆ—è§£å†³çš„é—®é¢˜**
```
æ— é˜Ÿåˆ—çš„æ··ä¹±åœºæ™¯ï¼š
ç”Ÿäº§è€…A â”€â”€â”
ç”Ÿäº§è€…B â”€â”€â”¼â”€â”€â†’ æ¶ˆè´¹è€…  â† æ•°æ®å†²çªï¼Œä¸¢å¤±
ç”Ÿäº§è€…C â”€â”€â”˜

æœ‰é˜Ÿåˆ—çš„æœ‰åºåœºæ™¯ï¼š
ç”Ÿäº§è€…A â”€â”€â”
ç”Ÿäº§è€…B â”€â”€â”¼â”€â”€â†’ [é˜Ÿåˆ—] â”€â”€â†’ æ¶ˆè´¹è€…  â† æœ‰åºå¤„ç†
ç”Ÿäº§è€…C â”€â”€â”˜
```

### 3.2 ä¸åŒé˜Ÿåˆ—ç±»å‹çš„ç‰¹ç‚¹


**ğŸ“‹ é˜Ÿåˆ—ç±»å‹å¯¹æ¯”**

| é˜Ÿåˆ—ç±»å‹ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|----------|------|----------|------|
| **FIFOé˜Ÿåˆ—** | å…ˆè¿›å…ˆå‡º | å…¬å¹³å¤„ç† | `LinkedBlockingQueue` |
| **LIFOé˜Ÿåˆ—** | åè¿›å…ˆå‡º | æ ˆå¼å¤„ç† | `LinkedBlockingDeque` |
| **ä¼˜å…ˆé˜Ÿåˆ—** | æŒ‰ä¼˜å…ˆçº§ | é‡è¦ä»»åŠ¡ä¼˜å…ˆ | `PriorityBlockingQueue` |
| **å»¶æ—¶é˜Ÿåˆ—** | å®šæ—¶å¤„ç† | å®šæ—¶ä»»åŠ¡ | `DelayQueue` |

**âš¡ é˜Ÿåˆ—é€‰æ‹©ç¤ºä¾‹**
```java
// FIFOé˜Ÿåˆ—ï¼šæ™®é€šä»»åŠ¡æŒ‰é¡ºåºå¤„ç†
BlockingQueue<Task> fifoQueue = new LinkedBlockingQueue<>();

// ä¼˜å…ˆé˜Ÿåˆ—ï¼šé‡è¦ä»»åŠ¡ä¼˜å…ˆå¤„ç†
BlockingQueue<PriorityTask> priorityQueue = new PriorityBlockingQueue<>();

// å»¶æ—¶é˜Ÿåˆ—ï¼šå®šæ—¶ä»»åŠ¡
BlockingQueue<DelayedTask> delayQueue = new DelayQueue<>();
```

### 3.3 é˜Ÿåˆ—åŒæ­¥çš„æ ¸å¿ƒæœºåˆ¶


**ğŸ”’ é˜»å¡æœºåˆ¶**
```java
public class QueueSyncDemo {
    private BlockingQueue<String> queue = new LinkedBlockingQueue<>(5);
    
    // ç”Ÿäº§è€…ï¼šé˜»å¡å¼æ”¾å…¥
    public void produce(String item) throws InterruptedException {
        queue.put(item);  // é˜Ÿåˆ—æ»¡æ—¶è‡ªåŠ¨é˜»å¡ç­‰å¾…
        System.out.println("âœ… æˆåŠŸæ”¾å…¥ï¼š" + item);
    }
    
    // æ¶ˆè´¹è€…ï¼šé˜»å¡å¼å–å‡º
    public String consume() throws InterruptedException {
        String item = queue.take();  // é˜Ÿåˆ—ç©ºæ—¶è‡ªåŠ¨é˜»å¡ç­‰å¾…
        System.out.println("âœ… æˆåŠŸå–å‡ºï¼š" + item);
        return item;
    }
    
    // éé˜»å¡æ“ä½œ
    public boolean tryProduce(String item) {
        boolean success = queue.offer(item);  // ç«‹å³è¿”å›ï¼Œä¸é˜»å¡
        System.out.println(success ? "âœ… æ”¾å…¥æˆåŠŸ" : "âŒ é˜Ÿåˆ—å·²æ»¡");
        return success;
    }
}
```

**ğŸ“Š é˜Ÿåˆ—çŠ¶æ€ç›‘æ§**
```java
// ç›‘æ§é˜Ÿåˆ—çŠ¶æ€
public void monitorQueue() {
    System.out.println("é˜Ÿåˆ—çŠ¶æ€æŠ¥å‘Šï¼š");
    System.out.println("å½“å‰å¤§å°ï¼š" + queue.size());
    System.out.println("å‰©ä½™å®¹é‡ï¼š" + queue.remainingCapacity());
    System.out.println("æ˜¯å¦ä¸ºç©ºï¼š" + queue.isEmpty());
    
    // çŠ¶æ€å¯è§†åŒ–
    String status = "é˜Ÿåˆ—ï¼š[";
    for (int i = 0; i < queue.size(); i++) {
        status += "â– ";
    }
    for (int i = queue.size(); i < 5; i++) {
        status += "â–¡";
    }
    status += "] " + queue.size() + "/5";
    System.out.println(status);
}
```

---

## 4. ğŸŒŠ èƒŒå‹å¤„ç†ç­–ç•¥


### 4.1 ä»€ä¹ˆæ˜¯èƒŒå‹é—®é¢˜


**ğŸ¯ èƒŒå‹çš„ç›´è§‚ç†è§£**
```
æ°´ç®¡ç±»æ¯”ï¼š
æ°´é¾™å¤´(ç”Ÿäº§è€…) â”€â”€â†’ æ°´ç®¡(ç¼“å†²åŒº) â”€â”€â†’ æ¼æ–—(æ¶ˆè´¹è€…)

èƒŒå‹äº§ç”Ÿï¼š
æ°´é¾™å¤´å‡ºæ°´å¤ªå¿« > æ¼æ–—æ¼æ°´é€Ÿåº¦
ç»“æœï¼šæ°´ç®¡å‹åŠ›å¢å¤§ï¼Œå¯èƒ½çˆ†è£‚ï¼ˆå†…å­˜æº¢å‡ºï¼‰
```

> ğŸ’¡ **èƒŒå‹å®šä¹‰**
> 
> å½“ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®çš„é€Ÿåº¦è¶…è¿‡æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦æ—¶ï¼Œç³»ç»Ÿäº§ç”Ÿçš„å‹åŠ›å°±å«èƒŒå‹

**ğŸ“Š èƒŒå‹äº§ç”Ÿçš„å…¸å‹åœºæ™¯**

| åœºæ™¯ | ç”Ÿäº§é€Ÿåº¦ | æ¶ˆè´¹é€Ÿåº¦ | ç»“æœ |
|------|----------|----------|------|
| **æ­£å¸¸æƒ…å†µ** | 100æ¡/ç§’ | 100æ¡/ç§’ | âœ… å¹³è¡¡ |
| **è½»åº¦èƒŒå‹** | 120æ¡/ç§’ | 100æ¡/ç§’ | âš ï¸ ç¼“æ…¢ç§¯å‹ |
| **é‡åº¦èƒŒå‹** | 200æ¡/ç§’ | 100æ¡/ç§’ | ğŸ”´ å¿«é€Ÿæº¢å‡º |

### 4.2 èƒŒå‹æ£€æµ‹æœºåˆ¶


**ğŸ” ç›‘æ§æŒ‡æ ‡**
```java
public class BackpressureMonitor {
    private final BlockingQueue<Task> queue;
    private final AtomicLong producedCount = new AtomicLong();
    private final AtomicLong consumedCount = new AtomicLong();
    
    // æ£€æµ‹èƒŒå‹ç¨‹åº¦
    public BackpressureLevel checkBackpressure() {
        double queueUsage = (double) queue.size() / queue.remainingCapacity();
        long backlog = producedCount.get() - consumedCount.get();
        
        if (queueUsage > 0.9 || backlog > 1000) {
            return BackpressureLevel.HIGH;      // ğŸ”´ é«˜èƒŒå‹
        } else if (queueUsage > 0.7 || backlog > 500) {
            return BackpressureLevel.MEDIUM;    // ğŸŸ¡ ä¸­èƒŒå‹
        } else {
            return BackpressureLevel.LOW;       // ğŸŸ¢ ä½èƒŒå‹
        }
    }
    
    // å¯è§†åŒ–èƒŒå‹çŠ¶æ€
    public void printBackpressureStatus() {
        BackpressureLevel level = checkBackpressure();
        double usage = (double) queue.size() / queue.remainingCapacity() * 100;
        
        System.out.println("ğŸŒŠ èƒŒå‹çŠ¶æ€ï¼š" + level);
        System.out.println("ğŸ“Š é˜Ÿåˆ—ä½¿ç”¨ç‡ï¼š" + String.format("%.1f%%", usage));
        
        // å‹åŠ›æ¡å¯è§†åŒ–
        String pressureBar = "å‹åŠ›ï¼š[";
        int bars = (int) (usage / 10);
        for (int i = 0; i < bars; i++) {
            pressureBar += "â–ˆ";
        }
        for (int i = bars; i < 10; i++) {
            pressureBar += "â–‘";
        }
        pressureBar += "] " + String.format("%.1f%%", usage);
        System.out.println(pressureBar);
    }
}
```

### 4.3 èƒŒå‹å¤„ç†ç­–ç•¥


**ğŸ› ï¸ å¤„ç†ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|----------|
| **ä¸¢å¼ƒç­–ç•¥** | ä¸¢å¼ƒæ–°æ•°æ® | ç®€å•å¿«é€Ÿ | æ•°æ®ä¸¢å¤± | å®æ—¶ç›‘æ§ |
| **é˜»å¡ç­–ç•¥** | é˜»å¡ç”Ÿäº§è€… | ä¸ä¸¢æ•°æ® | å¯èƒ½æ­»é” | æ•°æ®é‡è¦ |
| **ç¼“å­˜ç­–ç•¥** | ä¸´æ—¶å­˜å‚¨ | å¹³æ»‘å¤„ç† | éœ€è¦é¢å¤–ç©ºé—´ | çªå‘æµé‡ |
| **é™çº§ç­–ç•¥** | é™ä½è´¨é‡ | ä¿æŒæœåŠ¡ | ä½“éªŒä¸‹é™ | åœ¨çº¿æœåŠ¡ |

**âš¡ ç­–ç•¥å®ç°ç¤ºä¾‹**
```java
public class BackpressureHandler {
    private final BlockingQueue<Task> queue;
    private final BackpressureStrategy strategy;
    
    // ä¸¢å¼ƒç­–ç•¥
    public boolean handleWithDiscard(Task task) {
        if (queue.offer(task)) {
            return true;  // æˆåŠŸæ”¾å…¥
        } else {
            System.out.println("âš ï¸ é˜Ÿåˆ—å·²æ»¡ï¼Œä¸¢å¼ƒä»»åŠ¡ï¼š" + task.getId());
            return false; // ä¸¢å¼ƒä»»åŠ¡
        }
    }
    
    // é˜»å¡ç­–ç•¥
    public void handleWithBlock(Task task) throws InterruptedException {
        System.out.println("â³ é˜Ÿåˆ—å·²æ»¡ï¼Œç­‰å¾…ç©ºä½...");
        queue.put(task);  // é˜»å¡ç­‰å¾…
        System.out.println("âœ… ç­‰å¾…ç»“æŸï¼Œä»»åŠ¡å·²æ”¾å…¥");
    }
    
    // ç¼“å­˜ç­–ç•¥
    private final List<Task> overflowCache = new ArrayList<>();
    
    public void handleWithCache(Task task) {
        if (queue.offer(task)) {
            // æ­£å¸¸æ”¾å…¥é˜Ÿåˆ—
            return;
        }
        
        // æ”¾å…¥æº¢å‡ºç¼“å­˜
        synchronized (overflowCache) {
            overflowCache.add(task);
            System.out.println("ğŸ“¦ ä»»åŠ¡æ”¾å…¥æº¢å‡ºç¼“å­˜ï¼Œå½“å‰ç¼“å­˜å¤§å°ï¼š" + overflowCache.size());
        }
    }
    
    // å®šæœŸä»ç¼“å­˜è½¬ç§»åˆ°é˜Ÿåˆ—
    public void transferFromCache() {
        synchronized (overflowCache) {
            Iterator<Task> iterator = overflowCache.iterator();
            while (iterator.hasNext() && queue.remainingCapacity() > 0) {
                Task task = iterator.next();
                if (queue.offer(task)) {
                    iterator.remove();
                    System.out.println("â™»ï¸ ä»ç¼“å­˜è½¬ç§»ä»»åŠ¡åˆ°é˜Ÿåˆ—");
                }
            }
        }
    }
}
```

---

## 5. ğŸš¦ æµé‡æ§åˆ¶æœºåˆ¶


### 5.1 æµé‡æ§åˆ¶çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ¯ ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶**
> ğŸ§  **é«˜é€Ÿå…¬è·¯ç±»æ¯”**
> 
> æµé‡æ§åˆ¶å°±åƒé«˜é€Ÿå…¬è·¯çš„çº¢ç»¿ç¯å’Œé™é€Ÿæ ‡å¿—ï¼Œæ§åˆ¶è½¦æµé€Ÿåº¦é˜²æ­¢æ‹¥å µ

**æ ¸å¿ƒç›®æ ‡ï¼š**
- **é˜²æ­¢è¿‡è½½**ï¼šä¿æŠ¤ç³»ç»Ÿä¸è¢«è¿‡å¤šè¯·æ±‚å‹å®
- **ä¿è¯è´¨é‡**ï¼šç»´æŒæœåŠ¡çš„å“åº”è´¨é‡
- **èµ„æºåˆ†é…**ï¼šåˆç†åˆ†é…ç³»ç»Ÿèµ„æº

### 5.2 é™æµç®—æ³•è¯¦è§£


**ğŸª£ ä»¤ç‰Œæ¡¶ç®—æ³•**
```
ä»¤ç‰Œæ¡¶å·¥ä½œåŸç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»¤ç‰Œæ¡¶ (å®¹é‡=5)  â”‚
â”‚  ğŸª™ğŸª™ğŸª™ğŸª™ğŸª™    â”‚  â† å›ºå®šé€Ÿç‡æ”¾å…¥ä»¤ç‰Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    è¯·æ±‚å¤„ç†
    (æ¶ˆè€—ä»¤ç‰Œ)

è§„åˆ™ï¼š
- æœ‰ä»¤ç‰Œ â†’ å¤„ç†è¯·æ±‚ï¼Œæ¶ˆè€—1ä¸ªä»¤ç‰Œ
- æ— ä»¤ç‰Œ â†’ æ‹’ç»è¯·æ±‚æˆ–ç­‰å¾…
```

**âš¡ ä»¤ç‰Œæ¡¶å®ç°**
```java
public class TokenBucket {
    private final long capacity;          // æ¡¶å®¹é‡
    private final long refillRate;        // ä»¤ç‰Œç”Ÿæˆé€Ÿç‡(ä¸ª/ç§’)
    private long tokens;                  // å½“å‰ä»¤ç‰Œæ•°
    private long lastRefillTime;         // ä¸Šæ¬¡å¡«å……æ—¶é—´
    
    public TokenBucket(long capacity, long refillRate) {
        this.capacity = capacity;
        this.refillRate = refillRate;
        this.tokens = capacity;  // åˆå§‹æ»¡æ¡¶
        this.lastRefillTime = System.currentTimeMillis();
    }
    
    // å°è¯•è·å–ä»¤ç‰Œ
    public synchronized boolean tryAcquire() {
        refillTokens();  // å…ˆè¡¥å……ä»¤ç‰Œ
        
        if (tokens > 0) {
            tokens--;
            System.out.println("âœ… è·å–ä»¤ç‰ŒæˆåŠŸï¼Œå‰©ä½™ï¼š" + tokens);
            return true;
        } else {
            System.out.println("âŒ ä»¤ç‰Œä¸è¶³ï¼Œè¯·æ±‚è¢«é™æµ");
            return false;
        }
    }
    
    // è¡¥å……ä»¤ç‰Œ
    private void refillTokens() {
        long now = System.currentTimeMillis();
        long timePassed = now - lastRefillTime;
        
        if (timePassed > 0) {
            long newTokens = timePassed * refillRate / 1000;  // è®¡ç®—æ–°ä»¤ç‰Œæ•°
            tokens = Math.min(capacity, tokens + newTokens);   // ä¸è¶…è¿‡å®¹é‡
            lastRefillTime = now;
        }
    }
    
    // å¯è§†åŒ–ä»¤ç‰ŒçŠ¶æ€
    public void printStatus() {
        refillTokens();
        String bucket = "ğŸª£ ä»¤ç‰Œæ¡¶ï¼š[";
        for (int i = 0; i < tokens; i++) {
            bucket += "ğŸª™";
        }
        for (int i = (int)tokens; i < capacity; i++) {
            bucket += "  ";
        }
        bucket += "] " + tokens + "/" + capacity;
        System.out.println(bucket);
    }
}
```

**ğŸ”„ æ»‘åŠ¨çª—å£ç®—æ³•**
```java
public class SlidingWindowLimiter {
    private final int windowSize;     // çª—å£å¤§å°(ç§’)
    private final int maxRequests;    // æœ€å¤§è¯·æ±‚æ•°
    private final Queue<Long> requests = new LinkedList<>();
    
    public SlidingWindowLimiter(int windowSize, int maxRequests) {
        this.windowSize = windowSize;
        this.maxRequests = maxRequests;
    }
    
    public synchronized boolean allowRequest() {
        long now = System.currentTimeMillis();
        long windowStart = now - windowSize * 1000L;
        
        // ç§»é™¤è¶…å‡ºçª—å£çš„è¯·æ±‚
        while (!requests.isEmpty() && requests.peek() <= windowStart) {
            requests.poll();
        }
        
        // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
        if (requests.size() < maxRequests) {
            requests.offer(now);
            System.out.println("âœ… è¯·æ±‚é€šè¿‡ï¼Œå½“å‰çª—å£å†…è¯·æ±‚æ•°ï¼š" + requests.size());
            return true;
        } else {
            System.out.println("âŒ è¯·æ±‚è¢«é™æµï¼Œçª—å£å†…è¯·æ±‚å·²è¾¾ä¸Šé™ï¼š" + maxRequests);
            return false;
        }
    }
    
    // å¯è§†åŒ–çª—å£çŠ¶æ€
    public void printWindow() {
        System.out.println("ğŸ“Š æ»‘åŠ¨çª—å£çŠ¶æ€ï¼š" + requests.size() + "/" + maxRequests);
        
        String window = "çª—å£ï¼š[";
        for (int i = 0; i < requests.size(); i++) {
            window += "â–ª";
        }
        for (int i = requests.size(); i < maxRequests; i++) {
            window += "â–¡";
        }
        window += "]";
        System.out.println(window);
    }
}
```

### 5.3 æµé‡æ§åˆ¶ç­–ç•¥


**ğŸšï¸ è‡ªé€‚åº”æµæ§**
```java
public class AdaptiveFlowController {
    private final AtomicInteger activeRequests = new AtomicInteger(0);
    private final AtomicLong totalProcessTime = new AtomicLong(0);
    private final AtomicLong processedRequests = new AtomicLong(0);
    
    private volatile int currentLimit = 100;  // å½“å‰é™åˆ¶
    private final int maxLimit = 1000;        // æœ€å¤§é™åˆ¶
    private final int minLimit = 10;          // æœ€å°é™åˆ¶
    
    public boolean allowRequest() {
        if (activeRequests.get() >= currentLimit) {
            System.out.println("ğŸš« è¾¾åˆ°å½“å‰é™åˆ¶ï¼š" + currentLimit);
            return false;
        }
        
        activeRequests.incrementAndGet();
        return true;
    }
    
    public void requestCompleted(long processTime) {
        activeRequests.decrementAndGet();
        totalProcessTime.addAndGet(processTime);
        processedRequests.incrementAndGet();
        
        // åŠ¨æ€è°ƒæ•´é™åˆ¶
        adjustLimit();
    }
    
    // æ ¹æ®ç³»ç»Ÿè¡¨ç°åŠ¨æ€è°ƒæ•´é™åˆ¶
    private void adjustLimit() {
        if (processedRequests.get() % 100 == 0) {  // æ¯100ä¸ªè¯·æ±‚è°ƒæ•´ä¸€æ¬¡
            double avgProcessTime = (double) totalProcessTime.get() / processedRequests.get();
            
            if (avgProcessTime < 100) {  // å¤„ç†å¾ˆå¿«ï¼Œå¯ä»¥æé«˜é™åˆ¶
                currentLimit = Math.min(maxLimit, (int)(currentLimit * 1.1));
                System.out.println("ğŸ“ˆ æé«˜é™åˆ¶åˆ°ï¼š" + currentLimit);
            } else if (avgProcessTime > 500) {  // å¤„ç†å¾ˆæ…¢ï¼Œé™ä½é™åˆ¶
                currentLimit = Math.max(minLimit, (int)(currentLimit * 0.9));
                System.out.println("ğŸ“‰ é™ä½é™åˆ¶åˆ°ï¼š" + currentLimit);
            }
        }
    }
}
```

**ğŸ“Š æµæ§æ•ˆæœå¯è§†åŒ–**
```java
public class FlowControlVisualizer {
    public void visualizeFlow(List<RequestResult> results) {
        System.out.println("ğŸŒŠ æµé‡æ§åˆ¶æ•ˆæœå›¾ï¼š");
        System.out.println("æ—¶é—´è½´ï¼ˆæ¯ä¸ªç‚¹ä»£è¡¨1ç§’ï¼‰ï¼š");
        
        Map<Long, Integer> timeStats = new HashMap<>();
        Map<Long, Integer> rejectedStats = new HashMap<>();
        
        // ç»Ÿè®¡æ¯ç§’çš„è¯·æ±‚æ•°
        for (RequestResult result : results) {
            long second = result.timestamp / 1000;
            timeStats.merge(second, 1, Integer::sum);
            if (!result.allowed) {
                rejectedStats.merge(second, 1, Integer::sum);
            }
        }
        
        // ç»˜åˆ¶æµé‡å›¾
        for (Map.Entry<Long, Integer> entry : timeStats.entrySet()) {
            Long second = entry.getKey();
            Integer total = entry.getValue();
            Integer rejected = rejectedStats.getOrDefault(second, 0);
            Integer allowed = total - rejected;
            
            String bar = String.format("T+%02d: ", second % 100);
            
            // é€šè¿‡çš„è¯·æ±‚ç”¨ç»¿è‰²è¡¨ç¤º
            for (int i = 0; i < allowed; i++) {
                bar += "ğŸŸ©";
            }
            
            // è¢«æ‹’ç»çš„è¯·æ±‚ç”¨çº¢è‰²è¡¨ç¤º
            for (int i = 0; i < rejected; i++) {
                bar += "ğŸŸ¥";
            }
            
            bar += String.format(" (%dé€šè¿‡/%dæ‹’ç»)", allowed, rejected);
            System.out.println(bar);
        }
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼šç»å…¸çš„å¹¶å‘åä½œæ¨¡å¼ï¼Œè§£å†³é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜
ğŸ”¸ æœ‰ç•Œç¼“å†²åŒºï¼šå›ºå®šå¤§å°çš„ç¼“å†²åŒºï¼Œé˜²æ­¢å†…å­˜æ— é™å¢é•¿
ğŸ”¸ é˜Ÿåˆ—åŒæ­¥ï¼šä½¿ç”¨é˜Ÿåˆ—å¤©ç„¶çš„FIFOç‰¹æ€§å®ç°çº¿ç¨‹åè°ƒ
ğŸ”¸ èƒŒå‹å¤„ç†ï¼šå½“ç”Ÿäº§é€Ÿåº¦è¶…è¿‡æ¶ˆè´¹é€Ÿåº¦æ—¶çš„åº”å¯¹ç­–ç•¥
ğŸ”¸ æµé‡æ§åˆ¶ï¼šé€šè¿‡é™æµç®—æ³•ä¿æŠ¤ç³»ç»Ÿä¸è¢«è¿‡è½½å‹å®
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¨¡å‹çš„æœ¬è´¨ä»·å€¼**
```
è§£è€¦åˆï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ç›´æ¥ä¾èµ–
ç¼“å†²ï¼šåº”å¯¹é€Ÿåº¦å·®å¼‚å’Œçªå‘æµé‡
åè°ƒï¼šé€šè¿‡é˜Ÿåˆ—å®ç°å¤©ç„¶çš„åŒæ­¥æœºåˆ¶
ä¿æŠ¤ï¼šé€šè¿‡é™æµä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§
```

**ğŸ”¹ å®è·µä¸­çš„æƒè¡¡**
```
ç¼“å†²åŒºå¤§å°ï¼šå†…å­˜å ç”¨ vs ååé‡
èƒŒå‹ç­–ç•¥ï¼šæ•°æ®å®Œæ•´æ€§ vs ç³»ç»Ÿç¨³å®šæ€§  
æµæ§ç®—æ³•ï¼šå…¬å¹³æ€§ vs æ•ˆç‡
åŒæ­¥æœºåˆ¶ï¼šå®‰å…¨æ€§ vs æ€§èƒ½
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–æ€è·¯**
```
æ‰¹é‡å¤„ç†ï¼šå‡å°‘é”ç«äº‰ï¼Œæé«˜ååé‡
æ— é”é˜Ÿåˆ—ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æå‡æ€§èƒ½
åˆ†åŒºé˜Ÿåˆ—ï¼šå°†å¤§é˜Ÿåˆ—æ‹†åˆ†ä¸ºå¤šä¸ªå°é˜Ÿåˆ—
ä¼˜å…ˆçº§ï¼šé‡è¦ä»»åŠ¡ä¼˜å…ˆå¤„ç†
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **æ¶ˆæ¯ç³»ç»Ÿ**ï¼šKafkaã€RabbitMQçš„æ ¸å¿ƒæ¨¡å‹
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šå¼‚æ­¥æ—¥å¿—å†™å…¥ï¼Œæå‡åº”ç”¨æ€§èƒ½
- **æ•°æ®å¤„ç†**ï¼šETLæµæ°´çº¿ï¼Œå®ç°æ•°æ®çš„æµå¼å¤„ç†
- **WebæœåŠ¡**ï¼šè¯·æ±‚é˜Ÿåˆ—ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œé™æµ
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šIOç¼“å†²ï¼Œæå‡ç£ç›˜è¯»å†™æ•ˆç‡

**ğŸ”§ å·¥ç¨‹å®è·µ**
- **ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶ç›‘æ§é˜Ÿåˆ—çŠ¶æ€å’ŒèƒŒå‹æƒ…å†µ
- **åŠ¨æ€è°ƒä¼˜**ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´å‚æ•°
- **æ•…éšœæ¢å¤**ï¼šè®¾è®¡é™çº§å’Œç†”æ–­æœºåˆ¶
- **å®¹é‡è§„åˆ’**ï¼šåŸºäºå†å²æ•°æ®é¢„ä¼°ç¼“å†²åŒºå¤§å°

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**
- ç”Ÿäº§æ¶ˆè´¹è¦åè°ƒï¼Œç¼“å†²é˜Ÿåˆ—æ˜¯æ¡¥æ¢
- æœ‰ç•Œè®¾è®¡é˜²æº¢å‡ºï¼ŒèƒŒå‹å¤„ç†ä¿ç¨³å®š  
- æµé‡æ§åˆ¶æŠ¤ç³»ç»Ÿï¼Œä»¤ç‰Œæ¡¶çª—å£æ¥å¸®å¿™
- ç›‘æ§è°ƒä¼˜ä¸å¯å°‘ï¼Œå®è·µä¸­è§çœŸç« 