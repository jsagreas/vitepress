---
title: 7ã€é˜²å¾¡å¼ç¼–ç¨‹
---
## ğŸ“š ç›®å½•

1. [é˜²å¾¡å¼ç¼–ç¨‹æ¦‚è¿°](#1-é˜²å¾¡å¼ç¼–ç¨‹æ¦‚è¿°)
2. [è¾“å…¥éªŒè¯ç­–ç•¥](#2-è¾“å…¥éªŒè¯ç­–ç•¥)
3. [è¾¹ç•Œæ¡ä»¶æ£€æŸ¥](#3-è¾¹ç•Œæ¡ä»¶æ£€æŸ¥)
4. [æ–­è¨€ä½¿ç”¨](#4-æ–­è¨€ä½¿ç”¨)
5. [å¥‘çº¦å¼ç¼–ç¨‹](#5-å¥‘çº¦å¼ç¼–ç¨‹)
6. [å®¹é”™è®¾è®¡](#6-å®¹é”™è®¾è®¡)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ é˜²å¾¡å¼ç¼–ç¨‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é˜²å¾¡å¼ç¼–ç¨‹


**æ ¸å¿ƒç†å¿µ**ï¼šå‡è®¾æ‰€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹éƒ½ä¼šå‡ºé”™ï¼Œæå‰åšå¥½é˜²æŠ¤æªæ–½ã€‚

```
å°±åƒå¼€è½¦æ—¶ç³»å®‰å…¨å¸¦ï¼š
ğŸš— æ­£å¸¸æƒ…å†µï¼šä¸ä¼šå‘ç”Ÿäº‹æ•…
ğŸ›¡ï¸ é˜²å¾¡æ€ç»´ï¼šä¸‡ä¸€å‘ç”Ÿäº‹æ•…ï¼Œå®‰å…¨å¸¦èƒ½ä¿å‘½
ğŸ’¡ ç¼–ç¨‹ç±»æ¯”ï¼šä¸‡ä¸€æ•°æ®å¼‚å¸¸ï¼Œä»£ç èƒ½æ­£å¸¸å¤„ç†
```

**ğŸ“ é€šä¿—è§£é‡Š**ï¼š
- **ä¸ç›¸ä¿¡ä»»ä½•äºº**ï¼šä¸ç›¸ä¿¡ç”¨æˆ·è¾“å…¥ã€ç½‘ç»œæ•°æ®ã€æ–‡ä»¶å†…å®¹
- **ä¸ç›¸ä¿¡ä»»ä½•ä¸œè¥¿**ï¼šä¸ç›¸ä¿¡å‡½æ•°å‚æ•°ã€è¿”å›å€¼ã€ç³»ç»ŸçŠ¶æ€
- **æ€»æ˜¯éªŒè¯**ï¼šåœ¨ä½¿ç”¨æ•°æ®å‰å…ˆæ£€æŸ¥æ˜¯å¦åˆæ³•
- **ä¼˜é›…å¤„ç†**ï¼šå‡ºé”™æ—¶ä¸å´©æºƒï¼Œè€Œæ˜¯ä¼˜é›…åœ°å¤„ç†

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é˜²å¾¡å¼ç¼–ç¨‹


**ğŸ”¥ ç°å®é—®é¢˜**ï¼š
```
ç”¨æˆ·æ€»æ˜¯ä¼šï¼š
âŒ è¾“å…¥ç©ºå­—ç¬¦ä¸²å½“ä½œæ•°å­—
âŒ ä¸Šä¼ 0å­—èŠ‚çš„æ–‡ä»¶
âŒ åœ¨åº”è¯¥è¾“å…¥é‚®ç®±çš„åœ°æ–¹å†™"asdf"
âŒ ç‚¹å‡»100æ¬¡æäº¤æŒ‰é’®

ç³»ç»Ÿæ€»æ˜¯ä¼šï¼š
âŒ ç½‘ç»œçªç„¶æ–­å¼€
âŒ ç£ç›˜ç©ºé—´ä¸è¶³
âŒ å†…å­˜ä¸å¤Ÿç”¨
âŒ ç¬¬ä¸‰æ–¹æœåŠ¡å´©æºƒ
```

**âœ… é˜²å¾¡å¼ç¼–ç¨‹çš„ä»·å€¼**ï¼š
- ğŸ›¡ï¸ **æé«˜ç¨³å®šæ€§**ï¼šç¨‹åºä¸ä¼šå› ä¸ºæ„å¤–è¾“å…¥è€Œå´©æºƒ
- ğŸ”§ **æ˜“äºè°ƒè¯•**ï¼šé—®é¢˜å‡ºç°æ—¶èƒ½å¿«é€Ÿå®šä½
- ğŸ‘¥ **ç”¨æˆ·å‹å¥½**ï¼šç»™ç”¨æˆ·æ¸…æ™°çš„é”™è¯¯æç¤º
- ğŸ’° **é™ä½æˆæœ¬**ï¼šå‡å°‘ç”Ÿäº§ç¯å¢ƒçš„æ•…éšœ

---

## 2. âœ… è¾“å…¥éªŒè¯ç­–ç•¥


### 2.1 è¾“å…¥éªŒè¯çš„åŸºæœ¬åŸåˆ™


**ğŸ¯ æ ¸å¿ƒæ€æƒ³**ï¼šæ°¸è¿œä¸è¦ç›¸ä¿¡å¤–éƒ¨è¾“å…¥

```
è¾“å…¥æ¥æºåˆ†ç±»ï¼š
ğŸ“± ç”¨æˆ·ç•Œé¢è¾“å…¥ï¼šè¡¨å•ã€æŒ‰é’®ã€æ–‡ä»¶ä¸Šä¼ 
ğŸŒ ç½‘ç»œè¯·æ±‚ï¼šAPIè°ƒç”¨ã€URLå‚æ•°
ğŸ“ æ–‡ä»¶ç³»ç»Ÿï¼šé…ç½®æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶
ğŸ’¾ æ•°æ®åº“ï¼šæŸ¥è¯¢ç»“æœï¼ˆå¯èƒ½è¢«æ±¡æŸ“ï¼‰
ğŸ”— ç¬¬ä¸‰æ–¹æœåŠ¡ï¼šAPIå“åº”ã€å›è°ƒæ•°æ®
```

### 2.2 å¸¸è§éªŒè¯ç­–ç•¥


#### ğŸ”¸ ç™½åå•éªŒè¯ï¼ˆæ¨èï¼‰


**å«ä¹‰**ï¼šåªå…è®¸æ˜ç¡®å®‰å…¨çš„è¾“å…¥é€šè¿‡

```java
// éªŒè¯ç”¨æˆ·åï¼šåªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
public boolean isValidUsername(String username) {
    if (username == null || username.isEmpty()) {
        return false;
    }
    
    // ç™½åå•ï¼šåªå…è®¸è¿™äº›å­—ç¬¦
    return username.matches("^[a-zA-Z0-9_]{3,20}$");
}

// éªŒè¯å¹´é¾„ï¼šåªå…è®¸åˆç†èŒƒå›´
public boolean isValidAge(int age) {
    return age >= 0 && age <= 150;
}
```

#### ğŸ”¸ é»‘åå•éªŒè¯ï¼ˆä¸æ¨èï¼‰


**å«ä¹‰**ï¼šç¦æ­¢æ˜ç¡®å±é™©çš„è¾“å…¥ï¼Œå…è®¸å…¶ä»–æ‰€æœ‰è¾“å…¥

```java
// å±é™©ï¼šæ”»å‡»è€…å¯èƒ½æ‰¾åˆ°ç»•è¿‡æ–¹æ³•
public boolean isValidInput(String input) {
    // é»‘åå•ï¼šç¦æ­¢è¿™äº›å±é™©å­—ç¬¦
    String[] dangerous = {"<script>", "DROP TABLE", "'"};
    
    for (String danger : dangerous) {
        if (input.contains(danger)) {
            return false;
        }
    }
    return true; // å…¶ä»–éƒ½å…è®¸ï¼ˆå±é™©ï¼ï¼‰
}
```

> âš ï¸ **ä¸ºä»€ä¹ˆé»‘åå•å±é™©**ï¼šæ”»å‡»è€…æ€»èƒ½æ‰¾åˆ°æ–°çš„ç»•è¿‡æ–¹æ³•ï¼Œæ¯”å¦‚ä½¿ç”¨å¤§å°å†™å˜æ¢ã€ç¼–ç è½¬æ¢ç­‰

### 2.3 å…·ä½“éªŒè¯æ–¹æ³•


#### ğŸ“‹ åŸºç¡€æ•°æ®éªŒè¯


```java
public class InputValidator {
    
    // éªŒè¯é‚®ç®±æ ¼å¼
    public static boolean isValidEmail(String email) {
        if (email == null || email.trim().isEmpty()) {
            return false;
        }
        
        // ç®€å•ä½†å®ç”¨çš„é‚®ç®±éªŒè¯
        String emailPattern = "^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$";
        return email.matches(emailPattern);
    }
    
    // éªŒè¯æ‰‹æœºå·
    public static boolean isValidPhone(String phone) {
        if (phone == null) return false;
        
        // å»é™¤æ‰€æœ‰éæ•°å­—å­—ç¬¦
        String cleanPhone = phone.replaceAll("[^0-9]", "");
        
        // æ£€æŸ¥é•¿åº¦ï¼ˆ11ä½æ‰‹æœºå·ï¼‰
        return cleanPhone.length() == 11 && cleanPhone.startsWith("1");
    }
    
    // éªŒè¯å¯†ç å¼ºåº¦
    public static boolean isStrongPassword(String password) {
        if (password == null || password.length() < 8) {
            return false;
        }
        
        // è‡³å°‘åŒ…å«ï¼šå¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—
        boolean hasUpper = password.matches(".*[A-Z].*");
        boolean hasLower = password.matches(".*[a-z].*");
        boolean hasDigit = password.matches(".*[0-9].*");
        
        return hasUpper && hasLower && hasDigit;
    }
}
```

#### ğŸ”¢ æ•°å€¼èŒƒå›´éªŒè¯


```java
public class NumberValidator {
    
    // éªŒè¯ä»·æ ¼ï¼šä¸èƒ½ä¸ºè´Ÿï¼Œæœ‰ä¸Šé™
    public static boolean isValidPrice(double price) {
        return price >= 0 && price <= 999999.99;
    }
    
    // éªŒè¯æ•°é‡ï¼šå¿…é¡»ä¸ºæ­£æ•´æ•°
    public static boolean isValidQuantity(int quantity) {
        return quantity > 0 && quantity <= 10000;
    }
    
    // éªŒè¯ç™¾åˆ†æ¯”ï¼š0-100ä¹‹é—´
    public static boolean isValidPercentage(double percentage) {
        return percentage >= 0.0 && percentage <= 100.0;
    }
}
```

### 2.4 è¾“å…¥å‡€åŒ–å¤„ç†


**ğŸ’¡ å‡€åŒ–å«ä¹‰**ï¼šå°†potentially dangerous inputè½¬æ¢ä¸ºsafe input

```java
public class InputSanitizer {
    
    // HTMLæ ‡ç­¾å‡€åŒ–ï¼šé˜²æ­¢XSSæ”»å‡»
    public static String sanitizeHtml(String input) {
        if (input == null) return "";
        
        return input
            .replaceAll("<", "&lt;")      // è½¬ä¹‰å°äºå·
            .replaceAll(">", "&gt;")      // è½¬ä¹‰å¤§äºå·
            .replaceAll("\"", "&quot;")   // è½¬ä¹‰å¼•å·
            .replaceAll("'", "&#x27;")    // è½¬ä¹‰å•å¼•å·
            .trim();                      // å»é™¤é¦–å°¾ç©ºç™½
    }
    
    // SQLæ³¨å…¥é˜²æŠ¤ï¼šå‚æ•°åŒ–æŸ¥è¯¢
    public static void safeQuery(String username) {
        // âŒ å±é™©çš„æ‹¼æ¥SQL
        // String sql = "SELECT * FROM users WHERE name = '" + username + "'";
        
        // âœ… å®‰å…¨çš„å‚æ•°åŒ–æŸ¥è¯¢
        String sql = "SELECT * FROM users WHERE name = ?";
        // ä½¿ç”¨PreparedStatementè®¾ç½®å‚æ•°
    }
    
    // æ–‡ä»¶åå‡€åŒ–ï¼šé˜²æ­¢è·¯å¾„éå†
    public static String sanitizeFileName(String fileName) {
        if (fileName == null) return "default.txt";
        
        return fileName
            .replaceAll("[^a-zA-Z0-9._-]", "_")  // åªä¿ç•™å®‰å…¨å­—ç¬¦
            .replaceAll("\\.\\.", "")            // ç§»é™¤çˆ¶ç›®å½•å¼•ç”¨
            .substring(0, Math.min(fileName.length(), 100)); // é™åˆ¶é•¿åº¦
    }
}
```

---

## 3. ğŸ¯ è¾¹ç•Œæ¡ä»¶æ£€æŸ¥


### 3.1 ä»€ä¹ˆæ˜¯è¾¹ç•Œæ¡ä»¶


**ğŸ“ é€šä¿—è§£é‡Š**ï¼šç¨‹åºå¤„ç†æ•°æ®çš„"ä¸´ç•Œç‚¹"ï¼Œæœ€å®¹æ˜“å‡ºé”™çš„åœ°æ–¹

```
ç”Ÿæ´»ä¸­çš„è¾¹ç•Œä¾‹å­ï¼š
ğŸŠâ€â™‚ï¸ æ¸¸æ³³æ± ï¼šæ°´æ·±0ç±³ï¼ˆå²¸è¾¹ï¼‰å’Œ2ç±³ï¼ˆæ·±æ°´åŒºï¼‰æ˜¯è¾¹ç•Œ
ğŸš— åœè½¦åœºï¼šç¬¬1ä¸ªè½¦ä½å’Œæœ€å1ä¸ªè½¦ä½æ˜¯è¾¹ç•Œ
ğŸ“š ä¹¦æ¶ï¼šç¬¬1é¡µå’Œæœ€å1é¡µæ˜¯è¾¹ç•Œ

ç¼–ç¨‹ä¸­çš„è¾¹ç•Œï¼š
ğŸ“Š æ•°ç»„ï¼šindex = 0 å’Œ index = length-1
ğŸ”¢ æ•°å€¼ï¼šæœ€å°å€¼ã€æœ€å¤§å€¼ã€0ã€-1
ğŸ“ å­—ç¬¦ä¸²ï¼šç©ºå­—ç¬¦ä¸²ã€å•å­—ç¬¦ã€è¶…é•¿å­—ç¬¦ä¸²
ğŸ“‹ é›†åˆï¼šç©ºé›†åˆã€å•å…ƒç´ ã€æ»¡å®¹é‡
```

### 3.2 å¸¸è§è¾¹ç•Œæ¡ä»¶ç±»å‹


#### ğŸ”¢ æ•°å€¼è¾¹ç•Œ


```java
public class NumberBoundaryCheck {
    
    // é™¤æ³•è¿ç®—ï¼šæ£€æŸ¥é™¤é›¶
    public static double safeDivide(double a, double b) {
        if (Math.abs(b) < 1e-10) {  // æµ®ç‚¹æ•°çš„é›¶åˆ¤æ–­
            throw new IllegalArgumentException("é™¤æ•°ä¸èƒ½ä¸ºé›¶");
        }
        return a / b;
    }
    
    // æ•°ç»„ç´¢å¼•ï¼šæ£€æŸ¥è¶Šç•Œ
    public static int getArrayElement(int[] array, int index) {
        if (array == null) {
            throw new IllegalArgumentException("æ•°ç»„ä¸èƒ½ä¸ºnull");
        }
        if (index < 0 || index >= array.length) {
            throw new IndexOutOfBoundsException(
                String.format("ç´¢å¼•%dè¶…å‡ºèŒƒå›´[0, %d)", index, array.length)
            );
        }
        return array[index];
    }
    
    // å¹´é¾„è®¡ç®—ï¼šæ£€æŸ¥æ—¥æœŸè¾¹ç•Œ
    public static int calculateAge(LocalDate birthDate) {
        if (birthDate == null) {
            throw new IllegalArgumentException("å‡ºç”Ÿæ—¥æœŸä¸èƒ½ä¸ºnull");
        }
        
        LocalDate now = LocalDate.now();
        if (birthDate.isAfter(now)) {
            throw new IllegalArgumentException("å‡ºç”Ÿæ—¥æœŸä¸èƒ½åœ¨æœªæ¥");
        }
        
        return Period.between(birthDate, now).getYears();
    }
}
```

#### ğŸ“ å­—ç¬¦ä¸²è¾¹ç•Œ


```java
public class StringBoundaryCheck {
    
    // å­—ç¬¦ä¸²æˆªå–ï¼šæ£€æŸ¥é•¿åº¦è¾¹ç•Œ
    public static String safeSubstring(String str, int start, int end) {
        if (str == null) {
            return "";
        }
        
        // ä¿®æ­£è¾¹ç•Œå€¼
        start = Math.max(0, start);
        end = Math.min(str.length(), end);
        start = Math.min(start, end);
        
        return str.substring(start, end);
    }
    
    // æŸ¥æ‰¾å­—ç¬¦ï¼šæ£€æŸ¥ç©ºå­—ç¬¦ä¸²
    public static int safeIndexOf(String str, String target) {
        if (str == null || target == null) {
            return -1;
        }
        if (str.isEmpty() && target.isEmpty()) {
            return 0;  // ç©ºå­—ç¬¦ä¸²åœ¨ç©ºå­—ç¬¦ä¸²ä¸­çš„ä½ç½®æ˜¯0
        }
        return str.indexOf(target);
    }
}
```

#### ğŸ“‹ é›†åˆè¾¹ç•Œ


```java
public class CollectionBoundaryCheck {
    
    // å®‰å…¨è·å–åˆ—è¡¨å…ƒç´ 
    public static <T> T safeGet(List<T> list, int index) {
        if (list == null || list.isEmpty()) {
            return null;
        }
        if (index < 0 || index >= list.size()) {
            return null;  // æˆ–è€…æŠ›å‡ºå¼‚å¸¸ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚
        }
        return list.get(index);
    }
    
    // å®‰å…¨æ·»åŠ å…ƒç´ åˆ°æœ‰å®¹é‡é™åˆ¶çš„é›†åˆ
    public static <T> boolean safeAdd(List<T> list, T element, int maxSize) {
        if (list == null) {
            return false;
        }
        if (list.size() >= maxSize) {
            return false;  // å®¹é‡å·²æ»¡
        }
        return list.add(element);
    }
}
```

### 3.3 è¾¹ç•Œæµ‹è¯•ç­–ç•¥


**ğŸ§ª è¾¹ç•Œå€¼æµ‹è¯•åŸåˆ™**ï¼š

```
æµ‹è¯•ç­–ç•¥ï¼š
ğŸ¯ æ­£å¥½åœ¨è¾¹ç•Œï¼šæµ‹è¯•è¾¹ç•Œå€¼æœ¬èº«
ğŸ“ åˆšå¥½è¶Šç•Œï¼šæµ‹è¯•è¾¹ç•Œå€¼Â±1
ğŸ”„ å¤šé‡è¾¹ç•Œï¼šæµ‹è¯•å¤šä¸ªè¾¹ç•ŒåŒæ—¶è§¦å‘

ç¤ºä¾‹ï¼šæ•°ç»„é•¿åº¦ä¸º10
æµ‹è¯•å€¼ï¼š-1, 0, 1, 9, 10, 11
å…³æ³¨ç‚¹ï¼š
â€¢ -1: è´Ÿæ•°è¶Šç•Œ
â€¢ 0: æœ€å°æœ‰æ•ˆç´¢å¼•  
â€¢ 1: æœ€å°è¾¹ç•Œ+1
â€¢ 9: æœ€å¤§æœ‰æ•ˆç´¢å¼•
â€¢ 10: åˆšå¥½è¶Šç•Œ
â€¢ 11: è¿œè¶…è¾¹ç•Œ
```

---

## 4. ğŸ” æ–­è¨€ä½¿ç”¨


### 4.1 ä»€ä¹ˆæ˜¯æ–­è¨€


**ğŸ“ é€šä¿—è§£é‡Š**ï¼šæ–­è¨€å°±æ˜¯ç¨‹åºä¸­çš„"è‡ªæ£€"ï¼Œç¡®ä¿æŸä¸ªæ¡ä»¶ä¸€å®šæˆç«‹

```
ç”Ÿæ´»ä¸­çš„æ–­è¨€ï¼š
ğŸ  å‡ºé—¨å‰æ£€æŸ¥ï¼šé’¥åŒ™åœ¨åŒ…é‡Œï¼ˆæ–­è¨€é’¥åŒ™å­˜åœ¨ï¼‰
ğŸš— å¼€è½¦å‰æ£€æŸ¥ï¼šæ²¹ç®±æœ‰æ²¹ï¼ˆæ–­è¨€æ²¹é‡å……è¶³ï¼‰
ğŸ’° ä»˜æ¬¾å‰æ£€æŸ¥ï¼šä½™é¢è¶³å¤Ÿï¼ˆæ–­è¨€ä½™é¢å……è¶³ï¼‰

ç¼–ç¨‹ä¸­çš„æ–­è¨€ï¼š
âœ… ç¡®ä¿å˜é‡ä¸ä¸ºnull
âœ… ç¡®ä¿æ•°ç»„ä¸ä¸ºç©º
âœ… ç¡®ä¿è®¡ç®—ç»“æœåœ¨é¢„æœŸèŒƒå›´
âœ… ç¡®ä¿ç¨‹åºçŠ¶æ€æ­£ç¡®
```

### 4.2 æ–­è¨€çš„ä½¿ç”¨åœºæ™¯


#### ğŸ”¸ å‚æ•°æ£€æŸ¥æ–­è¨€


```java
public class ParameterAssertions {
    
    // è®¡ç®—åœ†é¢ç§¯ï¼šç¡®ä¿åŠå¾„ä¸ºæ­£æ•°
    public static double calculateCircleArea(double radius) {
        assert radius > 0 : "åŠå¾„å¿…é¡»ä¸ºæ­£æ•°ï¼Œå½“å‰å€¼ï¼š" + radius;
        
        return Math.PI * radius * radius;
    }
    
    // æ•°ç»„æ’åºï¼šç¡®ä¿æ•°ç»„ä¸ä¸ºnullä¸”ä¸ä¸ºç©º
    public static void sortArray(int[] array) {
        assert array != null : "æ•°ç»„ä¸èƒ½ä¸ºnull";
        assert array.length > 0 : "æ•°ç»„ä¸èƒ½ä¸ºç©º";
        
        Arrays.sort(array);
    }
    
    // ç”¨æˆ·æ³¨å†Œï¼šç¡®ä¿é‚®ç®±æ ¼å¼æ­£ç¡®
    public static void registerUser(String email, String password) {
        assert email != null && email.contains("@") : 
            "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼š" + email;
        assert password != null && password.length() >= 6 : 
            "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½";
        
        // æ³¨å†Œé€»è¾‘...
    }
}
```

#### ğŸ”¸ çŠ¶æ€æ£€æŸ¥æ–­è¨€


```java
public class StateAssertions {
    private boolean isConnected = false;
    private List<String> messageQueue = new ArrayList<>();
    
    // å‘é€æ¶ˆæ¯ï¼šç¡®ä¿è¿æ¥å·²å»ºç«‹
    public void sendMessage(String message) {
        assert isConnected : "å¿…é¡»å…ˆå»ºç«‹è¿æ¥æ‰èƒ½å‘é€æ¶ˆæ¯";
        assert message != null && !message.trim().isEmpty() : 
            "æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º";
        
        messageQueue.add(message);
    }
    
    // è·å–é˜Ÿåˆ—å¤§å°ï¼šç¡®ä¿é˜Ÿåˆ—å·²åˆå§‹åŒ–
    public int getQueueSize() {
        assert messageQueue != null : "æ¶ˆæ¯é˜Ÿåˆ—æœªåˆå§‹åŒ–";
        
        return messageQueue.size();
    }
}
```

#### ğŸ”¸ ç®—æ³•æ­£ç¡®æ€§æ–­è¨€


```java
public class AlgorithmAssertions {
    
    // äºŒåˆ†æŸ¥æ‰¾ï¼šç¡®ä¿æ•°ç»„å·²æ’åº
    public static int binarySearch(int[] array, int target) {
        assert array != null : "æ•°ç»„ä¸èƒ½ä¸ºnull";
        assert isSorted(array) : "æ•°ç»„å¿…é¡»å·²æ’åº";
        
        int left = 0, right = array.length - 1;
        
        while (left <= right) {
            int mid = left + (right - left) / 2;
            
            if (array[mid] == target) {
                return mid;
            } else if (array[mid] < target) {
                left = mid + 1;
            } else {
                right = mid - 1;
            }
        }
        
        return -1;
    }
    
    // æ£€æŸ¥æ•°ç»„æ˜¯å¦å·²æ’åº
    private static boolean isSorted(int[] array) {
        for (int i = 1; i < array.length; i++) {
            if (array[i] < array[i-1]) {
                return false;
            }
        }
        return true;
    }
}
```

### 4.3 æ–­è¨€çš„æœ€ä½³å®è·µ


**âœ… ä½•æ—¶ä½¿ç”¨æ–­è¨€**ï¼š
```
é€‚åˆä½¿ç”¨æ–­è¨€çš„åœºæ™¯ï¼š
ğŸ” è°ƒè¯•æœŸé—´çš„é”™è¯¯æ£€æµ‹
ğŸ§ª å¼€å‘é˜¶æ®µçš„ä»£ç éªŒè¯
ğŸ“Š ç®—æ³•æ­£ç¡®æ€§éªŒè¯
ğŸ”§ å†…éƒ¨APIçš„å‚æ•°æ£€æŸ¥

ä¸é€‚åˆä½¿ç”¨æ–­è¨€çš„åœºæ™¯ï¼š
ğŸŒ å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆåº”è¯¥ç”¨å¼‚å¸¸ï¼‰
ğŸ”— å¤„ç†å¤–éƒ¨ç³»ç»Ÿé”™è¯¯
ğŸ’¾ æ•°æ®éªŒè¯ï¼ˆåº”è¯¥ç”¨æ­£å¸¸æ£€æŸ¥ï¼‰
ğŸš¨ ç”Ÿäº§ç¯å¢ƒé”™è¯¯å¤„ç†
```

**ğŸ¯ æ–­è¨€ç¼–å†™åŸåˆ™**ï¼š

```java
public class AssertionBestPractices {
    
    // âœ… å¥½çš„æ–­è¨€ï¼šç®€å•æ˜ç¡®
    public void goodAssertion(String name) {
        assert name != null : "å§“åä¸èƒ½ä¸ºnull";
        assert name.length() > 0 : "å§“åä¸èƒ½ä¸ºç©ºå­—ç¬¦ä¸²";
    }
    
    // âŒ ä¸å¥½çš„æ–­è¨€ï¼šæœ‰å‰¯ä½œç”¨
    public void badAssertion(List<String> list) {
        // æ–­è¨€ä¸åº”è¯¥ä¿®æ”¹ç¨‹åºçŠ¶æ€
        assert list.add("test") : "æ·»åŠ å¤±è´¥"; // é”™è¯¯ï¼
    }
    
    // âœ… æ­£ç¡®çš„æ–¹å¼
    public void correctAssertion(List<String> list) {
        assert list != null : "åˆ—è¡¨ä¸èƒ½ä¸ºnull";
        assert !list.isEmpty() : "åˆ—è¡¨ä¸èƒ½ä¸ºç©º";
        
        boolean added = list.add("test");
        assert added : "æ·»åŠ æ“ä½œå¤±è´¥";
    }
}
```

---

## 5. ğŸ“‹ å¥‘çº¦å¼ç¼–ç¨‹


### 5.1 ä»€ä¹ˆæ˜¯å¥‘çº¦å¼ç¼–ç¨‹


**ğŸ“ é€šä¿—è§£é‡Š**ï¼šåƒç­¾åˆåŒä¸€æ ·ï¼Œæ˜ç¡®å®šä¹‰å‡½æ•°çš„"æƒåˆ©å’Œä¹‰åŠ¡"

```
ç”Ÿæ´»ä¸­çš„å¥‘çº¦ï¼š
ğŸ  ç§Ÿæˆ¿åˆåŒï¼š
   - å‰ç½®æ¡ä»¶ï¼šç§Ÿå®¢ä»˜æŠ¼é‡‘ï¼Œæˆ¿ä¸œæä¾›é’¥åŒ™
   - åç½®æ¡ä»¶ï¼šç§Ÿå®¢è·å¾—å±…ä½æƒï¼Œæˆ¿ä¸œè·å¾—ç§Ÿé‡‘
   - ä¸å˜é‡ï¼šæˆ¿å±‹ç»“æ„ä¸èƒ½æ”¹å˜

ğŸ“¦ å¿«é€’æœåŠ¡ï¼š
   - å‰ç½®æ¡ä»¶ï¼šåŒ…è£¹å®Œå¥½ï¼Œåœ°å€æ­£ç¡®ï¼Œè¿è´¹å·²ä»˜
   - åç½®æ¡ä»¶ï¼šåŒ…è£¹å®‰å…¨é€è¾¾ï¼Œæä¾›å¿«é€’å•å·
   - ä¸å˜é‡ï¼šåŒ…è£¹å†…å®¹ä¸å˜

ç¼–ç¨‹ä¸­çš„å¥‘çº¦ï¼š
ğŸ“‹ å‡½æ•°å¥‘çº¦ï¼š
   - å‰ç½®æ¡ä»¶ï¼šè°ƒç”¨è€…å¿…é¡»æ»¡è¶³çš„æ¡ä»¶
   - åç½®æ¡ä»¶ï¼šå‡½æ•°ä¿è¯è¾¾æˆçš„ç»“æœ
   - ä¸å˜é‡ï¼šå§‹ç»ˆä¿æŒä¸ºçœŸçš„æ¡ä»¶
```

### 5.2 å‰ç½®æ¡ä»¶ï¼ˆPreconditionsï¼‰


**ğŸ’¡ å«ä¹‰**ï¼šè°ƒç”¨è€…å¿…é¡»ä¿è¯çš„æ¡ä»¶

```java
public class PreconditionExamples {
    
    // é“¶è¡Œè½¬è´¦ï¼šå‰ç½®æ¡ä»¶æ£€æŸ¥
    public static boolean transfer(Account from, Account to, double amount) {
        // å‰ç½®æ¡ä»¶1ï¼šè´¦æˆ·ä¸èƒ½ä¸ºnull
        if (from == null || to == null) {
            throw new IllegalArgumentException("è´¦æˆ·ä¸èƒ½ä¸ºnull");
        }
        
        // å‰ç½®æ¡ä»¶2ï¼šè½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0
        if (amount <= 0) {
            throw new IllegalArgumentException("è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0");
        }
        
        // å‰ç½®æ¡ä»¶3ï¼šä½™é¢å¿…é¡»å……è¶³
        if (from.getBalance() < amount) {
            throw new IllegalArgumentException("ä½™é¢ä¸è¶³");
        }
        
        // å‰ç½®æ¡ä»¶4ï¼šè´¦æˆ·å¿…é¡»å¤„äºæ¿€æ´»çŠ¶æ€
        if (!from.isActive() || !to.isActive()) {
            throw new IllegalArgumentException("è´¦æˆ·æœªæ¿€æ´»");
        }
        
        // æ‰§è¡Œè½¬è´¦é€»è¾‘...
        from.withdraw(amount);
        to.deposit(amount);
        
        return true;
    }
    
    // æ•°ç»„æ’åºï¼šå‰ç½®æ¡ä»¶æ£€æŸ¥
    public static void quickSort(int[] array, int left, int right) {
        // å‰ç½®æ¡ä»¶1ï¼šæ•°ç»„ä¸ä¸ºnull
        if (array == null) {
            throw new IllegalArgumentException("æ•°ç»„ä¸èƒ½ä¸ºnull");
        }
        
        // å‰ç½®æ¡ä»¶2ï¼šç´¢å¼•èŒƒå›´æœ‰æ•ˆ
        if (left < 0 || right >= array.length || left > right) {
            throw new IllegalArgumentException(
                String.format("ç´¢å¼•èŒƒå›´æ— æ•ˆï¼šleft=%d, right=%d, length=%d", 
                             left, right, array.length)
            );
        }
        
        // æ’åºé€»è¾‘...
        if (left < right) {
            int pivot = partition(array, left, right);
            quickSort(array, left, pivot - 1);
            quickSort(array, pivot + 1, right);
        }
    }
}
```

### 5.3 åç½®æ¡ä»¶ï¼ˆPostconditionsï¼‰


**ğŸ’¡ å«ä¹‰**ï¼šå‡½æ•°æ‰§è¡Œå®Œæˆåä¿è¯è¾¾æˆçš„ç»“æœ

```java
public class PostconditionExamples {
    
    // åˆ—è¡¨æ’åºï¼šåç½®æ¡ä»¶éªŒè¯
    public static void sort(List<Integer> list) {
        if (list == null || list.size() <= 1) {
            return;
        }
        
        int originalSize = list.size();  // è®°å½•åŸå§‹å¤§å°
        
        // æ‰§è¡Œæ’åº
        Collections.sort(list);
        
        // åç½®æ¡ä»¶1ï¼šåˆ—è¡¨å¤§å°ä¸å˜
        assert list.size() == originalSize : 
            "æ’åºååˆ—è¡¨å¤§å°æ”¹å˜";
        
        // åç½®æ¡ä»¶2ï¼šåˆ—è¡¨å·²æ’åº
        assert isSorted(list) : 
            "æ’åºååˆ—è¡¨ä»æœªæ’åº";
    }
    
    // æ£€æŸ¥åˆ—è¡¨æ˜¯å¦å·²æ’åº
    private static boolean isSorted(List<Integer> list) {
        for (int i = 1; i < list.size(); i++) {
            if (list.get(i) < list.get(i-1)) {
                return false;
            }
        }
        return true;
    }
    
    // æŸ¥æ‰¾æœ€å¤§å€¼ï¼šåç½®æ¡ä»¶éªŒè¯
    public static int findMax(int[] array) {
        if (array == null || array.length == 0) {
            throw new IllegalArgumentException("æ•°ç»„ä¸èƒ½ä¸ºç©º");
        }
        
        int max = array[0];
        for (int i = 1; i < array.length; i++) {
            if (array[i] > max) {
                max = array[i];
            }
        }
        
        // åç½®æ¡ä»¶ï¼šè¿”å›å€¼ç¡®å®æ˜¯æœ€å¤§å€¼
        assert isMaxValue(array, max) : 
            "è¿”å›å€¼ä¸æ˜¯æœ€å¤§å€¼";
        
        return max;
    }
    
    private static boolean isMaxValue(int[] array, int value) {
        boolean found = false;
        for (int num : array) {
            if (num == value) {
                found = true;
            }
            if (num > value) {
                return false;
            }
        }
        return found;
    }
}
```

### 5.4 ä¸å˜é‡ï¼ˆInvariantsï¼‰


**ğŸ’¡ å«ä¹‰**ï¼šåœ¨æ•´ä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸­å§‹ç»ˆä¿æŒä¸ºçœŸçš„æ¡ä»¶

```java
public class BankAccount {
    private double balance;
    private boolean isActive;
    private final String accountNumber;
    
    public BankAccount(String accountNumber, double initialBalance) {
        if (accountNumber == null || accountNumber.trim().isEmpty()) {
            throw new IllegalArgumentException("è´¦å·ä¸èƒ½ä¸ºç©º");
        }
        if (initialBalance < 0) {
            throw new IllegalArgumentException("åˆå§‹ä½™é¢ä¸èƒ½ä¸ºè´Ÿ");
        }
        
        this.accountNumber = accountNumber;
        this.balance = initialBalance;
        this.isActive = true;
        
        checkInvariant(); // æ„é€ åæ£€æŸ¥ä¸å˜é‡
    }
    
    // å­˜æ¬¾
    public void deposit(double amount) {
        checkInvariant(); // æ“ä½œå‰æ£€æŸ¥
        
        if (amount <= 0) {
            throw new IllegalArgumentException("å­˜æ¬¾é‡‘é¢å¿…é¡»å¤§äº0");
        }
        if (!isActive) {
            throw new IllegalStateException("è´¦æˆ·æœªæ¿€æ´»");
        }
        
        balance += amount;
        
        checkInvariant(); // æ“ä½œåæ£€æŸ¥
    }
    
    // å–æ¬¾
    public void withdraw(double amount) {
        checkInvariant(); // æ“ä½œå‰æ£€æŸ¥
        
        if (amount <= 0) {
            throw new IllegalArgumentException("å–æ¬¾é‡‘é¢å¿…é¡»å¤§äº0");
        }
        if (!isActive) {
            throw new IllegalStateException("è´¦æˆ·æœªæ¿€æ´»");
        }
        if (balance < amount) {
            throw new IllegalArgumentException("ä½™é¢ä¸è¶³");
        }
        
        balance -= amount;
        
        checkInvariant(); // æ“ä½œåæ£€æŸ¥
    }
    
    // ä¸å˜é‡æ£€æŸ¥
    private void checkInvariant() {
        // ä¸å˜é‡1ï¼šä½™é¢ä¸èƒ½ä¸ºè´Ÿ
        assert balance >= 0 : 
            String.format("ä½™é¢ä¸èƒ½ä¸ºè´Ÿï¼š%.2f", balance);
        
        // ä¸å˜é‡2ï¼šè´¦å·ä¸èƒ½ä¸ºnullæˆ–ç©º
        assert accountNumber != null && !accountNumber.trim().isEmpty() : 
            "è´¦å·ä¸èƒ½ä¸ºç©º";
        
        // ä¸å˜é‡3ï¼šä½™é¢ç²¾åº¦æ£€æŸ¥ï¼ˆæœ€å¤š2ä½å°æ•°ï¼‰
        assert Math.round(balance * 100) == balance * 100 : 
            "ä½™é¢ç²¾åº¦è¶…è¿‡2ä½å°æ•°";
    }
    
    public double getBalance() {
        checkInvariant();
        return balance;
    }
    
    public boolean isActive() {
        return isActive;
    }
}
```

### 5.5 å¥‘çº¦å¼ç¼–ç¨‹çš„å®é™…åº”ç”¨


**ğŸ¯ å®ç”¨ç¤ºä¾‹ï¼šè´­ç‰©è½¦ç³»ç»Ÿ**

```java
public class ShoppingCart {
    private List<CartItem> items;
    private double totalAmount;
    private final int maxItems = 100;
    
    public ShoppingCart() {
        this.items = new ArrayList<>();
        this.totalAmount = 0.0;
        checkInvariant();
    }
    
    // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
    public void addItem(String productId, int quantity, double price) {
        // å‰ç½®æ¡ä»¶æ£€æŸ¥
        if (productId == null || productId.trim().isEmpty()) {
            throw new IllegalArgumentException("å•†å“IDä¸èƒ½ä¸ºç©º");
        }
        if (quantity <= 0) {
            throw new IllegalArgumentException("æ•°é‡å¿…é¡»å¤§äº0");
        }
        if (price < 0) {
            throw new IllegalArgumentException("ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿ");
        }
        if (items.size() >= maxItems) {
            throw new IllegalStateException("è´­ç‰©è½¦å·²æ»¡");
        }
        
        checkInvariant(); // æ“ä½œå‰æ£€æŸ¥ä¸å˜é‡
        
        double oldTotal = totalAmount;
        int oldSize = items.size();
        
        // æ‰§è¡Œæ“ä½œ
        CartItem item = new CartItem(productId, quantity, price);
        items.add(item);
        totalAmount += quantity * price;
        
        // åç½®æ¡ä»¶æ£€æŸ¥
        assert items.size() == oldSize + 1 : "å•†å“æ•°é‡æœªæ­£ç¡®å¢åŠ ";
        assert Math.abs(totalAmount - (oldTotal + quantity * price)) < 0.01 : 
            "æ€»é‡‘é¢è®¡ç®—é”™è¯¯";
        
        checkInvariant(); // æ“ä½œåæ£€æŸ¥ä¸å˜é‡
    }
    
    // è´­ç‰©è½¦ä¸å˜é‡
    private void checkInvariant() {
        // ä¸å˜é‡1ï¼šå•†å“åˆ—è¡¨ä¸ä¸ºnull
        assert items != null : "å•†å“åˆ—è¡¨ä¸èƒ½ä¸ºnull";
        
        // ä¸å˜é‡2ï¼šæ€»é‡‘é¢ä¸ä¸ºè´Ÿ
        assert totalAmount >= 0 : "æ€»é‡‘é¢ä¸èƒ½ä¸ºè´Ÿ";
        
        // ä¸å˜é‡3ï¼šå•†å“æ•°é‡ä¸è¶…è¿‡ä¸Šé™
        assert items.size() <= maxItems : "å•†å“æ•°é‡è¶…è¿‡ä¸Šé™";
        
        // ä¸å˜é‡4ï¼šæ€»é‡‘é¢ç­‰äºæ‰€æœ‰å•†å“é‡‘é¢ä¹‹å’Œ
        double calculatedTotal = items.stream()
            .mapToDouble(item -> item.getQuantity() * item.getPrice())
            .sum();
        assert Math.abs(totalAmount - calculatedTotal) < 0.01 : 
            "æ€»é‡‘é¢ä¸è®¡ç®—å€¼ä¸ç¬¦";
    }
}

class CartItem {
    private final String productId;
    private final int quantity;
    private final double price;
    
    public CartItem(String productId, int quantity, double price) {
        this.productId = productId;
        this.quantity = quantity;
        this.price = price;
    }
    
    // getters...
    public String getProductId() { return productId; }
    public int getQuantity() { return quantity; }
    public double getPrice() { return price; }
}
```

---

## 6. ğŸ›¡ï¸ å®¹é”™è®¾è®¡


### 6.1 ä»€ä¹ˆæ˜¯å®¹é”™è®¾è®¡


**ğŸ“ é€šä¿—è§£é‡Š**ï¼šè®©ç¨‹åºåœ¨é‡åˆ°é”™è¯¯æ—¶ä»èƒ½ç»§ç»­è¿è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥å´©æºƒ

```
ç”Ÿæ´»ä¸­çš„å®¹é”™è®¾è®¡ï¼š
ğŸ  æˆ¿å­ï¼šå¤šä¸ªæ”¯æ’‘æŸ±ï¼Œä¸€æ ¹æ–­äº†æˆ¿å­ä¸ä¼šå€’
ğŸš— æ±½è½¦ï¼šå¤‡èƒï¼Œä¸»è½®èƒåäº†è¿˜èƒ½ç»§ç»­è¡Œé©¶
ğŸ”‹ æ‰‹æœºï¼šä½ç”µé‡æ¨¡å¼ï¼Œç”µæ± å¿«æ²¡ç”µæ—¶è‡ªåŠ¨èŠ‚çœç”µé‡
ğŸ’¡ å°ç¯ï¼šå¤šä¸ªç¯æ³¡ï¼Œä¸€ä¸ªåäº†å…¶ä»–è¿˜èƒ½äº®

ç¼–ç¨‹ä¸­çš„å®¹é”™è®¾è®¡ï¼š
ğŸŒ ç½‘ç»œè¯·æ±‚ï¼šå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
ğŸ’¾ æ•°æ®ä¿å­˜ï¼šå¤±è´¥æ—¶ä½¿ç”¨å¤‡ç”¨å­˜å‚¨
ğŸ”„ æœåŠ¡è°ƒç”¨ï¼šä¸»æœåŠ¡æŒ‚äº†åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡
ğŸ“Š æ•°æ®å¤„ç†ï¼šéƒ¨åˆ†æ•°æ®å‡ºé”™ä¸å½±å“å…¶ä»–æ•°æ®
```

### 6.2 å®¹é”™è®¾è®¡åŸåˆ™


#### ğŸ”¸ æ•…éšœéš”ç¦»åŸåˆ™


**å«ä¹‰**ï¼šä¸€ä¸ªç»„ä»¶çš„å¤±è´¥ä¸åº”è¯¥å½±å“å…¶ä»–ç»„ä»¶

```java
public class FailureIsolationExample {
    
    // æ‰¹é‡å¤„ç†ç”¨æˆ·æ•°æ®ï¼šå•ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–
    public List<ProcessResult> processUsers(List<User> users) {
        List<ProcessResult> results = new ArrayList<>();
        
        for (User user : users) {
            try {
                // å¤„ç†å•ä¸ªç”¨æˆ·
                String result = processUser(user);
                results.add(new ProcessResult(user.getId(), true, result, null));
                
            } catch (Exception e) {
                // å•ä¸ªç”¨æˆ·å¤„ç†å¤±è´¥ï¼Œè®°å½•é”™è¯¯ä½†ç»§ç»­å¤„ç†å…¶ä»–ç”¨æˆ·
                String error = "å¤„ç†ç”¨æˆ·å¤±è´¥: " + e.getMessage();
                results.add(new ProcessResult(user.getId(), false, null, error));
                
                // è®°å½•æ—¥å¿—ä½†ä¸æŠ›å‡ºå¼‚å¸¸
                System.err.println("ç”¨æˆ· " + user.getId() + " å¤„ç†å¤±è´¥: " + error);
            }
        }
        
        return results;
    }
    
    // å¤šæ•°æ®æºæŸ¥è¯¢ï¼šä¸€ä¸ªå¤±è´¥æ—¶ä½¿ç”¨å…¶ä»–æ•°æ®æº
    public UserInfo getUserInfo(String userId) {
        UserInfo userInfo = null;
        
        // å°è¯•ä¸»æ•°æ®åº“
        try {
            userInfo = primaryDatabase.getUser(userId);
            if (userInfo != null) {
                return userInfo;
            }
        } catch (Exception e) {
            System.err.println("ä¸»æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: " + e.getMessage());
        }
        
        // å°è¯•ç¼“å­˜
        try {
            userInfo = cacheService.getUser(userId);
            if (userInfo != null) {
                return userInfo;
            }
        } catch (Exception e) {
            System.err.println("ç¼“å­˜æŸ¥è¯¢å¤±è´¥: " + e.getMessage());
        }
        
        // å°è¯•å¤‡ç”¨æ•°æ®åº“
        try {
            userInfo = backupDatabase.getUser(userId);
            if (userInfo != null) {
                return userInfo;
            }
        } catch (Exception e) {
            System.err.println("å¤‡ç”¨æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: " + e.getMessage());
        }
        
        // æ‰€æœ‰æ•°æ®æºéƒ½å¤±è´¥ï¼Œè¿”å›é»˜è®¤å€¼
        return createDefaultUserInfo(userId);
    }
}
```

#### ğŸ”¸ ä¼˜é›…é™çº§åŸåˆ™


**å«ä¹‰**ï¼šå½“ç³»ç»Ÿéƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨æ—¶ï¼Œæä¾›ç®€åŒ–ä½†ä»å¯ç”¨çš„æœåŠ¡

```java
public class GracefulDegradationExample {
    
    private RecommendationService recommendationService;
    private boolean isRecommendationServiceAvailable = true;
    
    // å•†å“æ¨èï¼šæ¨èæœåŠ¡ä¸å¯ç”¨æ—¶ä½¿ç”¨ç®€å•ç­–ç•¥
    public List<Product> getRecommendedProducts(String userId) {
        if (isRecommendationServiceAvailable) {
            try {
                // å°è¯•ä½¿ç”¨æ™ºèƒ½æ¨èæœåŠ¡
                List<Product> smartRecommendations = 
                    recommendationService.getPersonalizedRecommendations(userId);
                
                if (smartRecommendations != null && !smartRecommendations.isEmpty()) {
                    return smartRecommendations;
                }
                
            } catch (Exception e) {
                System.err.println("æ™ºèƒ½æ¨èæœåŠ¡å¤±è´¥: " + e.getMessage());
                isRecommendationServiceAvailable = false;
                
                // å¯ä»¥è®¾ç½®å®šæ—¶å™¨é‡æ–°æ£€æŸ¥æœåŠ¡å¯ç”¨æ€§
                scheduleServiceHealthCheck();
            }
        }
        
        // é™çº§ç­–ç•¥ï¼šè¿”å›çƒ­é—¨å•†å“
        return getPopularProducts();
    }
    
    // ç”¨æˆ·å¤´åƒæ˜¾ç¤ºï¼šå¤´åƒæœåŠ¡ä¸å¯ç”¨æ—¶æ˜¾ç¤ºé»˜è®¤å¤´åƒ
    public String getUserAvatar(String userId) {
        try {
            String avatarUrl = avatarService.getAvatarUrl(userId);
            if (avatarUrl != null && !avatarUrl.isEmpty()) {
                return avatarUrl;
            }
        } catch (Exception e) {
            System.err.println("å¤´åƒæœåŠ¡ä¸å¯ç”¨: " + e.getMessage());
        }
        
        // é™çº§ï¼šè¿”å›é»˜è®¤å¤´åƒ
        return "/images/default-avatar.png";
    }
    
    // æœç´¢åŠŸèƒ½ï¼šæœç´¢æœåŠ¡ä¸å¯ç”¨æ—¶ä½¿ç”¨æœ¬åœ°ç®€å•æœç´¢
    public List<Product> searchProducts(String keyword) {
        try {
            // å°è¯•ä½¿ç”¨é«˜çº§æœç´¢æœåŠ¡ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ã€åŒä¹‰è¯ç­‰ï¼‰
            return advancedSearchService.search(keyword);
            
        } catch (Exception e) {
            System.err.println("é«˜çº§æœç´¢æœåŠ¡å¤±è´¥: " + e.getMessage());
            
            // é™çº§ï¼šä½¿ç”¨ç®€å•çš„å…³é”®è¯åŒ¹é…
            return simpleKeywordSearch(keyword);
        }
    }
}
```

#### ğŸ”¸ è¶…æ—¶å’Œé‡è¯•åŸåˆ™


**å«ä¹‰**ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•

```java
public class TimeoutAndRetryExample {
    
    private static final int MAX_RETRY_ATTEMPTS = 3;
    private static final long RETRY_DELAY_MS = 1000; // 1ç§’
    private static final long TIMEOUT_MS = 5000; // 5ç§’è¶…æ—¶
    
    // ç½‘ç»œè¯·æ±‚ï¼šå¸¦è¶…æ—¶å’Œé‡è¯•
    public String makeHttpRequest(String url) {
        for (int attempt = 1; attempt <= MAX_RETRY_ATTEMPTS; attempt++) {
            try {
                // è®¾ç½®è¶…æ—¶æ—¶é—´
                HttpClient client = HttpClient.newBuilder()
                    .connectTimeout(Duration.ofMillis(TIMEOUT_MS))
                    .build();
                
                HttpRequest request = HttpRequest.newBuilder()
                    .uri(URI.create(url))
                    .timeout(Duration.ofMillis(TIMEOUT_MS))
                    .build();
                
                HttpResponse<String> response = client.send(request, 
                    HttpResponse.BodyHandlers.ofString());
                
                if (response.statusCode() == 200) {
                    return response.body();
                }
                
                throw new RuntimeException("HTTPé”™è¯¯: " + response.statusCode());
                
            } catch (Exception e) {
                System.err.printf("ç¬¬%dæ¬¡è¯·æ±‚å¤±è´¥: %s%n", attempt, e.getMessage());
                
                if (attempt == MAX_RETRY_ATTEMPTS) {
                    // æœ€åä¸€æ¬¡é‡è¯•ä¹Ÿå¤±è´¥äº†
                    throw new RuntimeException("è¯·æ±‚å¤±è´¥ï¼Œå·²é‡è¯•" + MAX_RETRY_ATTEMPTS + "æ¬¡", e);
                }
                
                // ç­‰å¾…åé‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
                try {
                    Thread.sleep(RETRY_DELAY_MS * attempt);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("é‡è¯•è¢«ä¸­æ–­", ie);
                }
            }
        }
        
        return null; // ä¸ä¼šåˆ°è¾¾è¿™é‡Œ
    }
    
    // æ•°æ®åº“è¿æ¥ï¼šå¸¦è¿æ¥æ± å’Œé‡è¯•
    public void executeWithRetry(String sql) {
        for (int attempt = 1; attempt <= MAX_RETRY_ATTEMPTS; attempt++) {
            Connection conn = null;
            try {
                // ä»è¿æ¥æ± è·å–è¿æ¥ï¼ˆå¸¦è¶…æ—¶ï¼‰
                conn = dataSource.getConnection();
                conn.setNetworkTimeout(Executors.newSingleThreadExecutor(), 
                                     (int)TIMEOUT_MS);
                
                try (PreparedStatement stmt = conn.prepareStatement(sql)) {
                    stmt.execute();
                    return; // æˆåŠŸæ‰§è¡Œï¼Œé€€å‡ºé‡è¯•å¾ªç¯
                }
                
            } catch (SQLException e) {
                System.err.printf("ç¬¬%dæ¬¡æ•°æ®åº“æ“ä½œå¤±è´¥: %s%n", attempt, e.getMessage());
                
                if (attempt == MAX_RETRY_ATTEMPTS) {
                    throw new RuntimeException("æ•°æ®åº“æ“ä½œå¤±è´¥", e);
                }
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯å¯é‡è¯•çš„é”™è¯¯
                if (!isRetryableError(e)) {
                    throw new RuntimeException("ä¸å¯é‡è¯•çš„æ•°æ®åº“é”™è¯¯", e);
                }
                
                try {
                    Thread.sleep(RETRY_DELAY_MS);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("é‡è¯•è¢«ä¸­æ–­", ie);
                }
                
            } finally {
                if (conn != null) {
                    try {
                        conn.close();
                    } catch (SQLException e) {
                        System.err.println("å…³é—­è¿æ¥å¤±è´¥: " + e.getMessage());
                    }
                }
            }
        }
    }
    
    // åˆ¤æ–­æ˜¯å¦æ˜¯å¯é‡è¯•çš„é”™è¯¯
    private boolean isRetryableError(SQLException e) {
        int errorCode = e.getErrorCode();
        String sqlState = e.getSQLState();
        
        // ç½‘ç»œç›¸å…³é”™è¯¯é€šå¸¸å¯ä»¥é‡è¯•
        return errorCode == 0 || // è¿æ¥è¶…æ—¶
               sqlState != null && sqlState.startsWith("08"); // è¿æ¥å¼‚å¸¸
    }
}
```

### 6.3 é”™è¯¯å¤„ç†ç­–ç•¥


#### ğŸ”¸ åˆ†å±‚é”™è¯¯å¤„ç†


```java
public class LayeredErrorHandling {
    
    // æ§åˆ¶å™¨å±‚ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥é”™è¯¯
    @RestController
    public class UserController {
        
        public ResponseEntity<ApiResponse> createUser(@RequestBody CreateUserRequest request) {
            try {
                // è¾“å…¥éªŒè¯
                validateUserRequest(request);
                
                // è°ƒç”¨æœåŠ¡å±‚
                User user = userService.createUser(request);
                
                return ResponseEntity.ok(new ApiResponse(true, "ç”¨æˆ·åˆ›å»ºæˆåŠŸ", user));
                
            } catch (ValidationException e) {
                // è¾“å…¥éªŒè¯é”™è¯¯ï¼šè¿”å›400
                return ResponseEntity.badRequest()
                    .body(new ApiResponse(false, e.getMessage(), null));
                
            } catch (BusinessException e) {
                // ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼šè¿”å›422
                return ResponseEntity.unprocessableEntity()
                    .body(new ApiResponse(false, e.getMessage(), null));
                
            } catch (Exception e) {
                // ç³»ç»Ÿé”™è¯¯ï¼šè¿”å›500ï¼Œä¸æš´éœ²å†…éƒ¨é”™è¯¯ä¿¡æ¯
                System.err.println("åˆ›å»ºç”¨æˆ·æ—¶å‘ç”Ÿç³»ç»Ÿé”™è¯¯: " + e.getMessage());
                return ResponseEntity.internalServerError()
                    .body(new ApiResponse(false, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•", null));
            }
        }
    }
    
    // æœåŠ¡å±‚ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘é”™è¯¯
    @Service
    public class UserService {
        
        public User createUser(CreateUserRequest request) throws BusinessException {
            try {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
                if (userRepository.existsByEmail(request.getEmail())) {
                    throw new BusinessException("é‚®ç®±å·²è¢«æ³¨å†Œ");
                }
                
                // è°ƒç”¨æ•°æ®è®¿é—®å±‚
                return userRepository.save(convertToUser(request));
                
            } catch (DataAccessException e) {
                // æ•°æ®è®¿é—®é”™è¯¯ï¼šåŒ…è£…ä¸ºä¸šåŠ¡å¼‚å¸¸
                System.err.println("ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥: " + e.getMessage());
                throw new BusinessException("ç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
            }
        }
    }
    
    // æ•°æ®è®¿é—®å±‚ï¼šå¤„ç†æ•°æ®åº“é”™è¯¯
    @Repository
    public class UserRepository {
        
        public User save(User user) throws DataAccessException {
            try {
                // æ•°æ®åº“æ“ä½œ
                return jdbcTemplate.update(sql, user.getEmail(), user.getName());
                
            } catch (SQLException e) {
                // æ ¹æ®é”™è¯¯ç±»å‹è¿›è¡Œä¸åŒå¤„ç†
                if (e.getErrorCode() == 1062) { // MySQLé‡å¤é”®é”™è¯¯
                    throw new DataAccessException("æ•°æ®é‡å¤", e);
                } else if (e.getErrorCode() == 1046) { // æ•°æ®åº“è¿æ¥é”™è¯¯
                    throw new DataAccessException("æ•°æ®åº“è¿æ¥å¤±è´¥", e);
                } else {
                    throw new DataAccessException("æ•°æ®ä¿å­˜å¤±è´¥", e);
                }
            }
        }
    }
}
```

#### ğŸ”¸ èµ„æºæ¸…ç†ä¿è¯


```java
public class ResourceCleanupExample {
    
    // æ–‡ä»¶å¤„ç†ï¼šç¡®ä¿æ–‡ä»¶æµè¢«æ­£ç¡®å…³é—­
    public String readFileContent(String filePath) {
        FileInputStream fis = null;
        BufferedReader reader = null;
        
        try {
            fis = new FileInputStream(filePath);
            reader = new BufferedReader(new InputStreamReader(fis, "UTF-8"));
            
            StringBuilder content = new StringBuilder();
            String line;
            while ((line = reader.readLine()) != null) {
                content.append(line).append("\n");
            }
            
            return content.toString();
            
        } catch (FileNotFoundException e) {
            System.err.println("æ–‡ä»¶ä¸å­˜åœ¨: " + filePath);
            return "";
            
        } catch (IOException e) {
            System.err.println("è¯»å–æ–‡ä»¶å¤±è´¥: " + e.getMessage());
            return "";
            
        } finally {
            // ç¡®ä¿èµ„æºè¢«é‡Šæ”¾
            if (reader != null) {
                try {
                    reader.close();
                } catch (IOException e) {
                    System.err.println("å…³é—­è¯»å–å™¨å¤±è´¥: " + e.getMessage());
                }
            }
            if (fis != null) {
                try {
                    fis.close();
                } catch (IOException e) {
                    System.err.println("å…³é—­æ–‡ä»¶æµå¤±è´¥: " + e.getMessage());
                }
            }
        }
    }
    
    // æ›´ç®€æ´çš„æ–¹å¼ï¼štry-with-resources
    public String readFileContentSimple(String filePath) {
        try (FileInputStream fis = new FileInputStream(filePath);
             BufferedReader reader = new BufferedReader(
                 new InputStreamReader(fis, "UTF-8"))) {
            
            StringBuilder content = new StringBuilder();
            String line;
            while ((line = reader.readLine()) != null) {
                content.append(line).append("\n");
            }
            
            return content.toString();
            
        } catch (FileNotFoundException e) {
            System.err.println("æ–‡ä»¶ä¸å­˜åœ¨: " + filePath);
            return "";
            
        } catch (IOException e) {
            System.err.println("è¯»å–æ–‡ä»¶å¤±è´¥: " + e.getMessage());
            return "";
        }
        // èµ„æºä¼šè‡ªåŠ¨å…³é—­
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 é˜²å¾¡å¼ç¼–ç¨‹çš„æ ¸å¿ƒä»·å€¼


```
ğŸ›¡ï¸ å®‰å…¨ç¬¬ä¸€ï¼šå‡è®¾æ‰€æœ‰å¤–éƒ¨è¾“å…¥éƒ½ä¸å¯ä¿¡
ğŸ” æå‰éªŒè¯ï¼šåœ¨ä½¿ç”¨æ•°æ®å‰å…ˆéªŒè¯åˆæ³•æ€§
ğŸ¯ æ˜ç¡®å¥‘çº¦ï¼šæ¸…æ¥šå®šä¹‰å‡½æ•°çš„è¾“å…¥è¾“å‡ºè¦æ±‚
âš¡ ä¼˜é›…å¤„ç†ï¼šå‡ºé”™æ—¶ä¸å´©æºƒï¼Œæä¾›å‹å¥½æç¤º
ğŸ”§ èµ„æºç®¡ç†ï¼šç¡®ä¿èµ„æºå¾—åˆ°æ­£ç¡®é‡Šæ”¾
```

### 7.2 å®è·µè¦ç‚¹è®°å¿†


**ğŸ”¸ è¾“å…¥éªŒè¯è®°å¿†å£è¯€**ï¼š
```
å¤–æ¥è¾“å…¥ä¸å¯ä¿¡ï¼ŒéªŒè¯æ¸…ç†è¦ä»”ç»†
ç™½åå•ç­–ç•¥æ›´å®‰å…¨ï¼Œé»‘åå•å®¹æ˜“è¢«ç»•è¿‡
ç©ºå€¼è¾¹ç•Œè¦æ£€æŸ¥ï¼ŒèŒƒå›´æ ¼å¼éƒ½é‡è¦
```

**ğŸ”¸ é”™è¯¯å¤„ç†è®°å¿†å£è¯€**ï¼š
```
åˆ†å±‚å¤„ç†èŒè´£æ¸…ï¼Œå¼‚å¸¸ä¿¡æ¯è¦å‹å¥½
èµ„æºæ¸…ç†æ”¾finallyï¼Œtry-with-resourcesæ›´ç®€æ´
é‡è¯•è¶…æ—¶è¦è®¾é™ï¼Œé™çº§ç­–ç•¥ä¿å¯ç”¨
```

**ğŸ”¸ å¥‘çº¦ç¼–ç¨‹è®°å¿†å£è¯€**ï¼š
```
å‰ç½®æ¡ä»¶è°ƒç”¨æ–¹ï¼Œåç½®æ¡ä»¶å‡½æ•°ä¿
ä¸å˜é‡è¦å§‹ç»ˆçœŸï¼Œæ–­è¨€æ£€æŸ¥åŠ©è°ƒè¯•
```

### 7.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**ï¼š
- ğŸ¯ **ä¼˜å…ˆä½¿ç”¨ç™½åå•éªŒè¯**
- ğŸ” **åœ¨å‡½æ•°å…¥å£å¤„é›†ä¸­éªŒè¯å‚æ•°**
- ğŸ“ **ä½¿ç”¨æ–­è¨€æ£€æŸ¥å†…éƒ¨é€»è¾‘**
- ğŸ›¡ï¸ **ä¸ºé‡è¦æ“ä½œæ·»åŠ å‰åç½®æ¡ä»¶**
- âš¡ **å®ç°è¶…æ—¶å’Œé‡è¯•æœºåˆ¶**
- ğŸ”§ **ä½¿ç”¨try-with-resourcesç®¡ç†èµ„æº**

**âŒ é¿å…åšæ³•**ï¼š
- ğŸš« **ä¾èµ–é»‘åå•è¿›è¡Œå®‰å…¨éªŒè¯**
- ğŸš« **åœ¨æ–­è¨€ä¸­åŒ…å«å‰¯ä½œç”¨**
- ğŸš« **å¿½ç•¥èµ„æºæ¸…ç†**
- ğŸš« **æŠ›å‡ºä¸å‹å¥½çš„é”™è¯¯ä¿¡æ¯**
- ğŸš« **æ— é™é‡è¯•å¯¼è‡´é›ªå´©**

### 7.4 å®é™…åº”ç”¨æŒ‡å¯¼


```
åº”ç”¨å±‚æ¬¡ï¼š
ğŸŒ Webåº”ç”¨ï¼šè¾“å…¥éªŒè¯ã€XSSé˜²æŠ¤ã€SQLæ³¨å…¥é˜²æŠ¤
ğŸ’¾ æ•°æ®å±‚ï¼šäº‹åŠ¡ç®¡ç†ã€è¿æ¥æ± ã€å¤‡ä»½æ¢å¤
ğŸ”§ æœåŠ¡å±‚ï¼šç†”æ–­é™çº§ã€é™æµæ§åˆ¶ã€ç›‘æ§å‘Šè­¦
ğŸ“± å®¢æˆ·ç«¯ï¼šç½‘ç»œé‡è¯•ã€ç¼“å­˜ç­–ç•¥ã€ç¦»çº¿æ¨¡å¼

å›¢é˜Ÿåä½œï¼š
ğŸ“‹ ä»£ç å®¡æŸ¥ï¼šé‡ç‚¹æ£€æŸ¥è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯å¤„ç†
ğŸ“š æ–‡æ¡£è§„èŒƒï¼šæ˜ç¡®APIå¥‘çº¦å’Œå¼‚å¸¸æƒ…å†µ
ğŸ§ª æµ‹è¯•ç­–ç•¥ï¼šå¢åŠ è¾¹ç•Œå€¼æµ‹è¯•å’Œå¼‚å¸¸æµ‹è¯•
ğŸ“Š ç›‘æ§è¿ç»´ï¼šå»ºç«‹å®Œå–„çš„é”™è¯¯ç›‘æ§å’Œå‘Šè­¦
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- é˜²å¾¡å¼ç¼–ç¨‹æ˜¯ä¸€ç§**å®‰å…¨æ„è¯†**ï¼Œä¸æ˜¯æŠ€æœ¯éš¾ç‚¹
- **éªŒè¯ä¸€åˆ‡å¤–éƒ¨è¾“å…¥**ï¼Œ**ä¼˜é›…å¤„ç†æ‰€æœ‰å¼‚å¸¸**
- **å¥‘çº¦æ˜ç¡®è´£ä»»**ï¼Œ**æ–­è¨€ä¿è¯æ­£ç¡®æ€§**
- **å®¹é”™è®¾è®¡è®©ç³»ç»Ÿæ›´å¥å£®**ï¼Œ**åˆ†å±‚å¤„ç†è®©é—®é¢˜æ›´æ¸…æ™°**