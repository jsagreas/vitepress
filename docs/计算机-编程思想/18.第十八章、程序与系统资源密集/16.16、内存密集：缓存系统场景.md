---
title: 16ã€å†…å­˜å¯†é›†ï¼šç¼“å­˜ç³»ç»Ÿåœºæ™¯
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜ç³»ç»ŸåŸºç¡€æ¦‚å¿µ](#1-ç¼“å­˜ç³»ç»ŸåŸºç¡€æ¦‚å¿µ)
2. [åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤æ¶æ„](#2-åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤æ¶æ„)
3. [åº”ç”¨å±‚ç¼“å­˜ç­–ç•¥](#3-åº”ç”¨å±‚ç¼“å­˜ç­–ç•¥)
4. [æ•°æ®åº“æŸ¥è¯¢ç¼“å­˜](#4-æ•°æ®åº“æŸ¥è¯¢ç¼“å­˜)
5. [ä¼šè¯çŠ¶æ€ç¼“å­˜](#5-ä¼šè¯çŠ¶æ€ç¼“å­˜)
6. [å†…å®¹åˆ†å‘ç¼“å­˜](#6-å†…å®¹åˆ†å‘ç¼“å­˜)
7. [ç¼“å­˜ä¸€è‡´æ€§ä¿è¯](#7-ç¼“å­˜ä¸€è‡´æ€§ä¿è¯)
8. [ç¼“å­˜æ·˜æ±°ç®—æ³•LRU](#8-ç¼“å­˜æ·˜æ±°ç®—æ³•lru)
9. [ç¼“å­˜ç©¿é€å‡»ç©¿é›ªå´©](#9-ç¼“å­˜ç©¿é€å‡»ç©¿é›ªå´©)
10. [åˆ†å¸ƒå¼ç¼“å­˜åˆ†ç‰‡](#10-åˆ†å¸ƒå¼ç¼“å­˜åˆ†ç‰‡)
11. [ç¼“å­˜é¢„çƒ­ç­–ç•¥](#11-ç¼“å­˜é¢„çƒ­ç­–ç•¥)
12. [å¤šçº§ç¼“å­˜æ¶æ„](#12-å¤šçº§ç¼“å­˜æ¶æ„)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç¼“å­˜ç³»ç»ŸåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç³»ç»Ÿ


**ç¼“å­˜çš„æœ¬è´¨**ï¼šæŠŠç»å¸¸è®¿é—®çš„æ•°æ®æš‚æ—¶å­˜æ”¾åœ¨æ›´å¿«çš„å­˜å‚¨è®¾å¤‡ä¸­ï¼Œä¸‹æ¬¡éœ€è¦æ—¶ç›´æ¥ä»å¿«å­˜å‚¨ä¸­è·å–ï¼Œé¿å…é‡å¤çš„æ…¢æ“ä½œã€‚

```
ä¼ ç»Ÿè®¿é—®æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“ â†’ è¿”å›ç»“æœï¼ˆæ…¢ï¼‰

ä½¿ç”¨ç¼“å­˜åï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ ç¼“å­˜ â†’ è¿”å›ç»“æœï¼ˆå¿«ï¼‰
                        â†“ï¼ˆç¼“å­˜æœªå‘½ä¸­æ—¶ï¼‰
                      æ•°æ®åº“ â†’ æ›´æ–°ç¼“å­˜ â†’ è¿”å›ç»“æœ
```

**ç¼“å­˜çš„æ ¸å¿ƒä»·å€¼**ï¼š
- **æå‡å“åº”é€Ÿåº¦**ï¼šå†…å­˜è®¿é—®æ¯”ç£ç›˜å¿«1000å€ä»¥ä¸Š
- **å‡è½»æ•°æ®åº“å‹åŠ›**ï¼šé¿å…å¤§é‡é‡å¤æŸ¥è¯¢
- **æé«˜ç³»ç»Ÿååé‡**ï¼šæ›´å¤šè¯·æ±‚èƒ½è¢«å¿«é€Ÿå¤„ç†
- **æ”¹å–„ç”¨æˆ·ä½“éªŒ**ï¼šé¡µé¢åŠ è½½æ›´å¿«

### 1.2 ç¼“å­˜çš„å·¥ä½œåŸç†


**å‘½ä¸­ç‡æ¦‚å¿µ**ï¼š
```
å‘½ä¸­ç‡ = ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„è¯·æ±‚æ•° / æ€»è¯·æ±‚æ•°

ä¾‹å¦‚ï¼š100ä¸ªè¯·æ±‚ä¸­ï¼Œ80ä¸ªä»ç¼“å­˜è·å–ï¼Œ20ä¸ªæŸ¥æ•°æ®åº“
å‘½ä¸­ç‡ = 80/100 = 80%
```

**ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸ**ï¼š
1. **å­˜å‚¨**ï¼šç¬¬ä¸€æ¬¡æŸ¥è¯¢åå°†ç»“æœå­˜å…¥ç¼“å­˜
2. **å‘½ä¸­**ï¼šåç»­ç›¸åŒæŸ¥è¯¢ç›´æ¥ä»ç¼“å­˜è¿”å›
3. **æ›´æ–°**ï¼šæ•°æ®å˜åŒ–æ—¶æ›´æ–°ç¼“å­˜å†…å®¹
4. **å¤±æ•ˆ**ï¼šè¿‡æœŸæ—¶é—´åˆ°è¾¾æˆ–ä¸»åŠ¨åˆ é™¤

---

## 2. ğŸ—ï¸ åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤æ¶æ„


### 2.1 å•æœºç¼“å­˜çš„å±€é™æ€§


**å•æœºç¼“å­˜é—®é¢˜**ï¼š
- **å†…å­˜é™åˆ¶**ï¼šå•å°æœåŠ¡å™¨å†…å­˜æœ‰ä¸Šé™
- **å•ç‚¹æ•…éšœ**ï¼šç¼“å­˜æœåŠ¡å™¨å®•æœºå½±å“å…¨å±€
- **æ•°æ®å­¤ç«‹**ï¼šå¤šå°åº”ç”¨æœåŠ¡å™¨ç¼“å­˜ä¸å…±äº«
- **æ‰©å±•å›°éš¾**ï¼šæ— æ³•æ°´å¹³æ‰©å±•ç¼“å­˜å®¹é‡

### 2.2 åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤æ–¹æ¡ˆ


**é›†ç¾¤æ¶æ„å›¾**ï¼š
```
åº”ç”¨æœåŠ¡å™¨é›†ç¾¤                åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Server1 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Cache Node1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ App Server2 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Cache Node2 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ App Server3 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Cache Node3 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»æµåˆ†å¸ƒå¼ç¼“å­˜äº§å“**ï¼š

| äº§å“ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** |
|------|---------|-------------|---------|
| **Redis Cluster** | `å†…å­˜æ•°æ®åº“ï¼Œæ”¯æŒæŒä¹…åŒ–` | `é«˜å¹¶å‘è¯»å†™` | `æ€§èƒ½æé«˜ï¼ŒåŠŸèƒ½ä¸°å¯Œ` |
| **Memcached** | `çº¯å†…å­˜ç¼“å­˜ï¼Œç®€å•è½»é‡` | `çº¯ç¼“å­˜åœºæ™¯` | `ç®€å•ç¨³å®šï¼Œå†…å­˜åˆ©ç”¨ç‡é«˜` |
| **Hazelcast** | `JavaåŸç”Ÿï¼Œå†…åµŒéƒ¨ç½²` | `Javaåº”ç”¨` | `æ— éœ€é¢å¤–éƒ¨ç½²ï¼Œå¼€å‘ä¾¿åˆ©` |

### 2.3 Redis Clusteræ ¸å¿ƒç‰¹æ€§


**è‡ªåŠ¨åˆ†ç‰‡æœºåˆ¶**ï¼š
```java
// Redis Clusterè‡ªåŠ¨å°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹
// ä½¿ç”¨å“ˆå¸Œæ§½(Hash Slot)æœºåˆ¶
public class RedisClusterExample {
    private JedisCluster jedisCluster;
    
    // æ•°æ®ä¼šè‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”èŠ‚ç‚¹
    public void setCache(String key, String value) {
        jedisCluster.set(key, value);
        // Redisè‡ªåŠ¨è®¡ç®—ï¼šslot = CRC16(key) % 16384
        // ç„¶åè·¯ç”±åˆ°å¯¹åº”çš„èŠ‚ç‚¹
    }
}
```

**é«˜å¯ç”¨ç‰¹æ€§**ï¼š
- **ä¸»ä»å¤åˆ¶**ï¼šæ¯ä¸ªä¸»èŠ‚ç‚¹æœ‰ä»èŠ‚ç‚¹å¤‡ä»½
- **æ•…éšœè½¬ç§»**ï¼šä¸»èŠ‚ç‚¹æ•…éšœæ—¶ä»èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡
- **æ•°æ®ä¸ä¸¢å¤±**ï¼šæŒä¹…åŒ–ä¿è¯æ•°æ®å®‰å…¨

---

## 3. ğŸ“± åº”ç”¨å±‚ç¼“å­˜ç­–ç•¥


### 3.1 ç¼“å­˜ä½¿ç”¨æ¨¡å¼


**Cache-Asideæ¨¡å¼**ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š
```java
public class UserService {
    private UserDAO userDAO;
    private RedisTemplate redisTemplate;
    
    public User getUserById(Long userId) {
        // 1. å…ˆæŸ¥ç¼“å­˜
        String cacheKey = "user:" + userId;
        User user = redisTemplate.opsForValue().get(cacheKey);
        
        if (user != null) {
            return user; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        user = userDAO.findById(userId);
        
        // 3. å°†ç»“æœæ”¾å…¥ç¼“å­˜
        if (user != null) {
            redisTemplate.opsForValue().set(cacheKey, user, 30, TimeUnit.MINUTES);
        }
        
        return user;
    }
}
```

**Write-Throughæ¨¡å¼**ï¼š
```java
public void updateUser(User user) {
    // åŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜
    userDAO.update(user);
    redisTemplate.opsForValue().set("user:" + user.getId(), user);
}
```

**Write-Behindæ¨¡å¼**ï¼š
```java
public void updateUserAsync(User user) {
    // å…ˆæ›´æ–°ç¼“å­˜ï¼Œå¼‚æ­¥æ›´æ–°æ•°æ®åº“
    redisTemplate.opsForValue().set("user:" + user.getId(), user);
    asyncUpdateDatabase(user); // å¼‚æ­¥ä»»åŠ¡
}
```

### 3.2 ç¼“å­˜é”®è®¾è®¡è§„èŒƒ


**å¥½çš„ç¼“å­˜é”®è®¾è®¡**ï¼š
```java
// âœ… è§„èŒƒçš„ç¼“å­˜é”®å‘½å
"user:profile:123456"           // ç”¨æˆ·èµ„æ–™
"product:detail:789012"         // å•†å“è¯¦æƒ…
"order:list:user:123456"        // ç”¨æˆ·è®¢å•åˆ—è¡¨
"config:system:timeout"         // ç³»ç»Ÿé…ç½®

// âŒ ä¸è§„èŒƒçš„ç¼“å­˜é”®å‘½å
"u123"                          // å«ä¹‰ä¸æ˜
"data_789012_info"              // æ ¼å¼æ··ä¹±
"ç”¨æˆ·èµ„æ–™123456"                 // ä¸­æ–‡å­—ç¬¦
```

**ç¼“å­˜é”®è®¾è®¡åŸåˆ™**ï¼š
- **å‘½åæ¸…æ™°**ï¼šèƒ½ä»é”®åçœ‹å‡ºå­˜å‚¨å†…å®¹
- **å±‚çº§ç»“æ„**ï¼šä½¿ç”¨å†’å·åˆ†éš”ä¸åŒå±‚çº§
- **é¿å…å†²çª**ï¼šä¸åŒç±»å‹æ•°æ®ä½¿ç”¨ä¸åŒå‰ç¼€
- **ä¾¿äºæ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ¨¡ç³ŠåŒ¹é…

---

## 4. ğŸ—„ï¸ æ•°æ®åº“æŸ¥è¯¢ç¼“å­˜


### 4.1 æŸ¥è¯¢ç¼“å­˜çš„å¿…è¦æ€§


**æ•°æ®åº“æ€§èƒ½ç“¶é¢ˆ**ï¼š
```
æ•°æ®åº“ç£ç›˜I/Oï¼š     ~10ms
å†…å­˜ç¼“å­˜è®¿é—®ï¼š      ~0.1ms
æ€§èƒ½å·®å¼‚ï¼š         100å€
```

**é€‚åˆç¼“å­˜çš„æŸ¥è¯¢ç±»å‹**ï¼š
- **é¢‘ç¹æŸ¥è¯¢**ï¼šåŒä¸€æŸ¥è¯¢è¢«å¤šæ¬¡æ‰§è¡Œ
- **å¤æ‚æŸ¥è¯¢**ï¼šå¤šè¡¨å…³è”ã€èšåˆè®¡ç®—
- **ç¨³å®šæ•°æ®**ï¼šä¸ç»å¸¸å˜åŒ–çš„æ•°æ®
- **çƒ­ç‚¹æ•°æ®**ï¼šè¢«å¤§é‡ç”¨æˆ·è®¿é—®

### 4.2 æŸ¥è¯¢ç¼“å­˜å®ç°ç­–ç•¥


**SQLæŸ¥è¯¢ç¼“å­˜ç¤ºä¾‹**ï¼š
```java
@Service
public class ProductService {
    
    @Cacheable(value = "productCache", key = "#categoryId + ':' + #page")
    public List<Product> getProductsByCategory(Long categoryId, int page) {
        // å¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢
        return productDAO.findByCategory(categoryId, page);
    }
    
    @CacheEvict(value = "productCache", allEntries = true)
    public void updateProduct(Product product) {
        productDAO.update(product);
        // æ›´æ–°åæ¸…ç©ºç›¸å…³ç¼“å­˜
    }
}
```

**åˆ†é¡µæŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–**ï¼š
```java
public PageResult<Product> getProductPage(int page, int size) {
    String cacheKey = String.format("product:page:%d:%d", page, size);
    
    // æ£€æŸ¥ç¼“å­˜
    PageResult<Product> result = redisTemplate.opsForValue().get(cacheKey);
    if (result != null) {
        return result;
    }
    
    // æŸ¥è¯¢æ•°æ®åº“
    result = productDAO.findPage(page, size);
    
    // ç¼“å­˜ç»“æœï¼ˆè¾ƒçŸ­è¿‡æœŸæ—¶é—´ï¼‰
    redisTemplate.opsForValue().set(cacheKey, result, 5, TimeUnit.MINUTES);
    
    return result;
}
```

### 4.3 æŸ¥è¯¢ç¼“å­˜æœ€ä½³å®è·µ


**ç¼“å­˜ç²’åº¦é€‰æ‹©**ï¼š
- **ç²—ç²’åº¦**ï¼šç¼“å­˜æ•´ä¸ªé¡µé¢æˆ–å¤§å¯¹è±¡ï¼ˆå ç”¨å†…å­˜å¤šï¼Œå‘½ä¸­ç‡ä½ï¼‰
- **ç»†ç²’åº¦**ï¼šç¼“å­˜å•ä¸ªå­—æ®µæˆ–å°å¯¹è±¡ï¼ˆå ç”¨å†…å­˜å°‘ï¼Œå‘½ä¸­ç‡é«˜ï¼‰
- **åˆé€‚ç²’åº¦**ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯å¹³è¡¡å†…å­˜å ç”¨å’Œå‘½ä¸­ç‡

> **ğŸ’¡ å®è·µå»ºè®®**ï¼š
> - ä¼˜å…ˆç¼“å­˜æŸ¥è¯¢é¢‘ç‡é«˜çš„æ•°æ®
> - ä¸ºä¸åŒç±»å‹æ•°æ®è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´
> - ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥

---

## 5. ğŸ” ä¼šè¯çŠ¶æ€ç¼“å­˜


### 5.1 ä¼šè¯ç®¡ç†çš„æŒ‘æˆ˜


**ä¼ ç»Ÿä¼šè¯å­˜å‚¨é—®é¢˜**ï¼š
```
å•æœºå†…å­˜å­˜å‚¨ä¼šè¯ï¼š
Server1 [Session A, Session B]
Server2 [Session C, Session D]

é—®é¢˜ï¼šç”¨æˆ·è¯·æ±‚å¯èƒ½è·¯ç”±åˆ°ä¸åŒæœåŠ¡å™¨ï¼Œä¼šè¯ä¸¢å¤±
```

**åˆ†å¸ƒå¼ç¯å¢ƒéœ€æ±‚**ï¼š
- **ä¼šè¯å…±äº«**ï¼šå¤šå°æœåŠ¡å™¨èƒ½è®¿é—®åŒä¸€ä¼šè¯
- **é«˜å¯ç”¨**ï¼šå•å°æœåŠ¡å™¨æ•…éšœä¸å½±å“ä¼šè¯
- **å¿«é€Ÿè®¿é—®**ï¼šä¼šè¯è¯»å–è¦è¶³å¤Ÿå¿«
- **è‡ªåŠ¨æ¸…ç†**ï¼šè¿‡æœŸä¼šè¯è‡ªåŠ¨åˆ é™¤

### 5.2 Redisä¼šè¯å­˜å‚¨æ–¹æ¡ˆ


**ä¼šè¯å­˜å‚¨å®ç°**ï¼š
```java
@Component
public class RedisSessionManager {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // å­˜å‚¨ä¼šè¯
    public void saveSession(String sessionId, UserSession session) {
        String key = "session:" + sessionId;
        // è®¾ç½®30åˆ†é’Ÿè¿‡æœŸæ—¶é—´
        redisTemplate.opsForValue().set(key, session, 30, TimeUnit.MINUTES);
    }
    
    // è·å–ä¼šè¯
    public UserSession getSession(String sessionId) {
        String key = "session:" + sessionId;
        return (UserSession) redisTemplate.opsForValue().get(key);
    }
    
    // å»¶é•¿ä¼šè¯
    public void refreshSession(String sessionId) {
        String key = "session:" + sessionId;
        // é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´
        redisTemplate.expire(key, 30, TimeUnit.MINUTES);
    }
}
```

**Spring Sessioné›†æˆ**ï¼š
```java
@Configuration
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800)
public class SessionConfig {
    
    @Bean
    public LettuceConnectionFactory connectionFactory() {
        return new LettuceConnectionFactory(
            new RedisStandaloneConfiguration("localhost", 6379)
        );
    }
}
```

### 5.3 ä¼šè¯æ•°æ®ç»“æ„è®¾è®¡


**ç”¨æˆ·ä¼šè¯ä¿¡æ¯**ï¼š
```java
public class UserSession implements Serializable {
    private Long userId;           // ç”¨æˆ·ID
    private String username;       // ç”¨æˆ·å
    private Set<String> roles;     // ç”¨æˆ·è§’è‰²
    private Map<String, Object> attributes; // æ‰©å±•å±æ€§
    private Long lastAccessTime;   // æœ€åè®¿é—®æ—¶é—´
    private String loginIP;        // ç™»å½•IP
}
```

**ä¼šè¯ç¼“å­˜ç­–ç•¥**ï¼š
- **çƒ­ä¼šè¯**ï¼šæ´»è·ƒç”¨æˆ·ä¼šè¯ï¼Œè¾ƒé•¿è¿‡æœŸæ—¶é—´ï¼ˆ30åˆ†é’Ÿï¼‰
- **å†·ä¼šè¯**ï¼šä¸æ´»è·ƒä¼šè¯ï¼Œè¾ƒçŸ­è¿‡æœŸæ—¶é—´ï¼ˆ10åˆ†é’Ÿï¼‰
- **ä¼šè¯é¢„çƒ­**ï¼šç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½é‡è¦ç”¨æˆ·ä¼šè¯

---

## 6. ğŸŒ å†…å®¹åˆ†å‘ç¼“å­˜


### 6.1 CDNç¼“å­˜åŸç†


**å†…å®¹åˆ†å‘ç½‘ç»œæ¶æ„**ï¼š
```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ· â†’ CDNè¾¹ç¼˜èŠ‚ç‚¹ â†’ åŒºåŸŸç¼“å­˜ â†’ æºç«™æœåŠ¡å™¨

ç¼“å­˜å±‚çº§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¾¹ç¼˜ç¼“å­˜   â”‚ â†â†’ â”‚  åŒºåŸŸç¼“å­˜   â”‚ â†â†’ â”‚   æºç«™     â”‚
â”‚ (å°±è¿‘æœåŠ¡)  â”‚    â”‚ (äºŒçº§ç¼“å­˜)  â”‚    â”‚ (åŸå§‹å†…å®¹) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å†…å®¹ç¼“å­˜åˆ†ç±»**ï¼š
- **é™æ€å†…å®¹**ï¼šå›¾ç‰‡ã€CSSã€JSæ–‡ä»¶ï¼ˆç¼“å­˜æ—¶é—´é•¿ï¼‰
- **åŠ¨æ€å†…å®¹**ï¼šAPIå“åº”ã€ç”¨æˆ·æ•°æ®ï¼ˆç¼“å­˜æ—¶é—´çŸ­ï¼‰
- **å‡†é™æ€å†…å®¹**ï¼šå•†å“ä¿¡æ¯ã€æ–‡ç« å†…å®¹ï¼ˆä¸­ç­‰ç¼“å­˜æ—¶é—´ï¼‰

### 6.2 Webåº”ç”¨ç¼“å­˜å®ç°


**HTTPç¼“å­˜å¤´è®¾ç½®**ï¼š
```java
@RestController
public class ContentController {
    
    @GetMapping("/api/products/{id}")
    public ResponseEntity<Product> getProduct(@PathVariable Long id) {
        Product product = productService.findById(id);
        
        return ResponseEntity.ok()
            .cacheControl(CacheControl.maxAge(10, TimeUnit.MINUTES)) // ç¼“å­˜10åˆ†é’Ÿ
            .eTag(String.valueOf(product.getVersion())) // ç‰ˆæœ¬æ§åˆ¶
            .body(product);
    }
    
    @GetMapping("/images/{filename}")
    public ResponseEntity<Resource> getImage(@PathVariable String filename) {
        Resource image = imageService.loadImage(filename);
        
        return ResponseEntity.ok()
            .cacheControl(CacheControl.maxAge(1, TimeUnit.DAYS)) // ç¼“å­˜1å¤©
            .body(image);
    }
}
```

**é¡µé¢ç¼“å­˜ç­–ç•¥**ï¼š
```java
@Controller
public class PageController {
    
    @GetMapping("/news/{id}")
    @Cacheable(value = "pageCache", key = "'news:' + #id")
    public String newsDetail(@PathVariable Long id, Model model) {
        News news = newsService.findById(id);
        model.addAttribute("news", news);
        return "news/detail";
    }
}
```

---

## 7. ğŸ”„ ç¼“å­˜ä¸€è‡´æ€§ä¿è¯


### 7.1 ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜


**æ•°æ®ä¸ä¸€è‡´åœºæ™¯**ï¼š
```
æ—¶é—´çº¿ï¼š
T1: ç¼“å­˜ä¸­ç”¨æˆ·å¹´é¾„ = 25
T2: æ•°æ®åº“ä¸­ç”¨æˆ·å¹´é¾„æ›´æ–°ä¸º 26
T3: ç¼“å­˜æœªæ›´æ–°ï¼Œä»ä¸º 25
T4: ç”¨æˆ·æŸ¥è¯¢å¾—åˆ°é”™è¯¯çš„å¹´é¾„ 25

ç»“æœï¼šç¼“å­˜ä¸æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´
```

**ä¸€è‡´æ€§çº§åˆ«**ï¼š
- **å¼ºä¸€è‡´æ€§**ï¼šç¼“å­˜å’Œæ•°æ®åº“å§‹ç»ˆä¸€è‡´ï¼ˆæ€§èƒ½å·®ï¼‰
- **å¼±ä¸€è‡´æ€§**ï¼šå…è®¸çŸ­æ—¶é—´ä¸ä¸€è‡´ï¼ˆæ€§èƒ½å¥½ï¼‰
- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šä¿è¯æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´ï¼ˆå¹³è¡¡æ–¹æ¡ˆï¼‰

### 7.2 ç¼“å­˜æ›´æ–°ç­–ç•¥


**Cache-Asideæ¨¡å¼**ï¼š
```java
public void updateUser(User user) {
    // æ–¹æ¡ˆ1ï¼šå…ˆåˆ ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“
    redisTemplate.delete("user:" + user.getId());
    userDAO.update(user);
    
    // æ–¹æ¡ˆ2ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ï¼ˆæ¨èï¼‰
    // userDAO.update(user);
    // redisTemplate.delete("user:" + user.getId());
}
```

**Write-Throughæ¨¡å¼**ï¼š
```java
public void updateUserSync(User user) {
    try {
        // åŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜
        userDAO.update(user);
        redisTemplate.opsForValue().set("user:" + user.getId(), user);
    } catch (Exception e) {
        // å‡ºé”™æ—¶å›æ»š
        rollback();
        throw e;
    }
}
```

**å»¶æ—¶åŒåˆ ç­–ç•¥**ï¼š
```java
public void updateUserDelayedDouble(User user) {
    // 1. åˆ é™¤ç¼“å­˜
    redisTemplate.delete("user:" + user.getId());
    
    // 2. æ›´æ–°æ•°æ®åº“
    userDAO.update(user);
    
    // 3. å»¶æ—¶å†åˆ ä¸€æ¬¡ç¼“å­˜
    CompletableFuture.delayedExecutor(1, TimeUnit.SECONDS)
        .execute(() -> redisTemplate.delete("user:" + user.getId()));
}
```

### 7.3 åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†


**åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„æœ€ç»ˆä¸€è‡´æ€§**ï¼š
```java
@Transactional
public void updateUserWithMQ(User user) {
    // 1. æ›´æ–°æ•°æ®åº“
    userDAO.update(user);
    
    // 2. å‘é€ç¼“å­˜æ›´æ–°æ¶ˆæ¯
    CacheUpdateMessage message = new CacheUpdateMessage();
    message.setKey("user:" + user.getId());
    message.setOperation("DELETE");
    
    messageProducer.send("cache-update-topic", message);
    // æ¶ˆæ¯æ¶ˆè´¹è€…ä¼šå¼‚æ­¥åˆ é™¤ç¼“å­˜
}
```

---

## 8. ğŸ”„ ç¼“å­˜æ·˜æ±°ç®—æ³•LRU


### 8.1 LRUç®—æ³•åŸç†


**LRUå«ä¹‰**ï¼šLeast Recently Usedï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰
**æ ¸å¿ƒæ€æƒ³**ï¼šå½“ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°æœ€é•¿æ—¶é—´æœªè¢«è®¿é—®çš„æ•°æ®

**LRUå·¥ä½œæµç¨‹**ï¼š
```
ç¼“å­˜çŠ¶æ€å˜åŒ–ï¼š
åˆå§‹: []
è®¿é—®A: [A]
è®¿é—®B: [B, A]
è®¿é—®C: [C, B, A]
è®¿é—®A: [A, C, B]  // Aç§»åˆ°æœ€å‰é¢
è®¿é—®D: [D, A, C]  // Bè¢«æ·˜æ±°ï¼ˆå®¹é‡æ»¡æ—¶ï¼‰
```

### 8.2 LRUç®—æ³•å®ç°


**åŸºäºHashMap + åŒå‘é“¾è¡¨**ï¼š
```java
public class LRUCache<K, V> {
    private final int capacity;
    private final Map<K, Node<K, V>> cache;
    private final Node<K, V> head, tail;
    
    public LRUCache(int capacity) {
        this.capacity = capacity;
        this.cache = new HashMap<>();
        this.head = new Node<>();
        this.tail = new Node<>();
        head.next = tail;
        tail.prev = head;
    }
    
    public V get(K key) {
        Node<K, V> node = cache.get(key);
        if (node == null) return null;
        
        // ç§»åŠ¨åˆ°å¤´éƒ¨ï¼ˆæ ‡è®°ä¸ºæœ€è¿‘ä½¿ç”¨ï¼‰
        moveToHead(node);
        return node.value;
    }
    
    public void put(K key, V value) {
        Node<K, V> node = cache.get(key);
        
        if (node != null) {
            node.value = value;
            moveToHead(node);
        } else {
            Node<K, V> newNode = new Node<>(key, value);
            
            if (cache.size() >= capacity) {
                // åˆ é™¤å°¾éƒ¨èŠ‚ç‚¹
                Node<K, V> tail = removeTail();
                cache.remove(tail.key);
            }
            
            cache.put(key, newNode);
            addToHead(newNode);
        }
    }
}
```

### 8.3 Redisä¸­çš„LRUå®ç°


**Redis LRUé…ç½®**ï¼š
```bash
# redis.confé…ç½®
maxmemory 256mb                    # æœ€å¤§å†…å­˜é™åˆ¶
maxmemory-policy allkeys-lru       # LRUæ·˜æ±°ç­–ç•¥

# å…¶ä»–æ·˜æ±°ç­–ç•¥ï¼š
# noeviction          # ä¸æ·˜æ±°ï¼Œå†…å­˜æ»¡æ—¶æŠ¥é”™
# allkeys-lru         # å¯¹æ‰€æœ‰keyä½¿ç”¨LRU
# volatile-lru        # å¯¹æœ‰è¿‡æœŸæ—¶é—´çš„keyä½¿ç”¨LRU
# allkeys-random      # éšæœºæ·˜æ±°
# volatile-random     # å¯¹æœ‰è¿‡æœŸæ—¶é—´çš„keyéšæœºæ·˜æ±°
# volatile-ttl        # æ·˜æ±°å³å°†è¿‡æœŸçš„key
```

**Javaä¸­ä½¿ç”¨Redis LRU**ï¼š
```java
@Configuration
public class RedisLRUConfig {
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory());
        
        // è®¾ç½®åºåˆ—åŒ–æ–¹å¼
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        
        return template;
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    @Service
    public class CacheService {
        public void setWithExpire(String key, Object value) {
            // Redisä¼šè‡ªåŠ¨æ ¹æ®LRUç­–ç•¥ç®¡ç†å†…å­˜
            redisTemplate.opsForValue().set(key, value, 1, TimeUnit.HOURS);
        }
    }
}
```

---

## 9. âš ï¸ ç¼“å­˜ç©¿é€å‡»ç©¿é›ªå´©


### 9.1 ç¼“å­˜ç©¿é€é—®é¢˜


**ç¼“å­˜ç©¿é€å®šä¹‰**ï¼šæŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å’Œæ•°æ®åº“éƒ½æ²¡æœ‰ï¼Œä½†æ¯æ¬¡è¯·æ±‚éƒ½è¦æŸ¥è¯¢æ•°æ®åº“

**ç©¿é€åœºæ™¯ç¤ºä¾‹**ï¼š
```
æ¶æ„è¯·æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ·ID = -1çš„ç”¨æˆ·ä¿¡æ¯
æµç¨‹ï¼š
1. æ£€æŸ¥ç¼“å­˜ï¼šæ— æ•°æ®
2. æŸ¥è¯¢æ•°æ®åº“ï¼šæ— æ•°æ®  
3. ä¸ç¼“å­˜nullç»“æœ
4. ä¸‹æ¬¡ç›¸åŒè¯·æ±‚é‡å¤ä¸Šè¿°æµç¨‹

å½±å“ï¼šå¤§é‡æ— æ•ˆè¯·æ±‚æ‰“åˆ°æ•°æ®åº“
```

**è§£å†³æ–¹æ¡ˆ1ï¼šç¼“å­˜ç©ºç»“æœ**ï¼š
```java
public User getUserById(Long userId) {
    String cacheKey = "user:" + userId;
    
    // æ£€æŸ¥ç¼“å­˜ï¼ˆåŒ…æ‹¬nullå€¼ï¼‰
    if (redisTemplate.hasKey(cacheKey)) {
        User user = (User) redisTemplate.opsForValue().get(cacheKey);
        return user; // å¯èƒ½è¿”å›null
    }
    
    // æŸ¥è¯¢æ•°æ®åº“
    User user = userDAO.findById(userId);
    
    // ç¼“å­˜ç»“æœï¼ˆåŒ…æ‹¬nullï¼‰
    redisTemplate.opsForValue().set(cacheKey, user, 5, TimeUnit.MINUTES);
    
    return user;
}
```

**è§£å†³æ–¹æ¡ˆ2ï¼šå¸ƒéš†è¿‡æ»¤å™¨**ï¼š
```java
@Component
public class BloomFilterCache {
    private BloomFilter<Long> userBloomFilter;
    
    @PostConstruct
    public void init() {
        // åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨
        userBloomFilter = BloomFilter.create(Funnels.longFunnel(), 10000000, 0.01);
        
        // å°†æ‰€æœ‰å­˜åœ¨çš„ç”¨æˆ·IDåŠ å…¥è¿‡æ»¤å™¨
        List<Long> userIds = userDAO.getAllUserIds();
        userIds.forEach(userBloomFilter::put);
    }
    
    public User getUserById(Long userId) {
        // å…ˆç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­
        if (!userBloomFilter.mightContain(userId)) {
            return null; // è‚¯å®šä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
        }
        
        // å¯èƒ½å­˜åœ¨ï¼Œæ‰§è¡Œæ­£å¸¸ç¼“å­˜é€»è¾‘
        return getUserFromCacheOrDB(userId);
    }
}
```

### 9.2 ç¼“å­˜å‡»ç©¿é—®é¢˜


**ç¼“å­˜å‡»ç©¿å®šä¹‰**ï¼šçƒ­ç‚¹æ•°æ®çš„ç¼“å­˜è¿‡æœŸï¼Œå¤§é‡å¹¶å‘è¯·æ±‚åŒæ—¶æŸ¥è¯¢æ•°æ®åº“

**å‡»ç©¿åœºæ™¯ç¤ºä¾‹**ï¼š
```
çƒ­é—¨å•†å“è¯¦æƒ…ç¼“å­˜åˆ°æœŸï¼š
T1: ç¼“å­˜è¿‡æœŸ
T2: 1000ä¸ªå¹¶å‘è¯·æ±‚åŒæ—¶åˆ°è¾¾
T3: 1000ä¸ªè¯·æ±‚éƒ½æŸ¥è¯¢æ•°æ®åº“
T4: æ•°æ®åº“å‹åŠ›è¿‡å¤§

é—®é¢˜ï¼šç¬é—´é«˜å¹¶å‘å‹å®æ•°æ®åº“
```

**è§£å†³æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”**ï¼š
```java
public Product getProductById(Long productId) {
    String cacheKey = "product:" + productId;
    String lockKey = "lock:product:" + productId;
    
    // æ£€æŸ¥ç¼“å­˜
    Product product = (Product) redisTemplate.opsForValue().get(cacheKey);
    if (product != null) {
        return product;
    }
    
    // å°è¯•è·å–åˆ†å¸ƒå¼é”
    String lockValue = UUID.randomUUID().toString();
    Boolean locked = redisTemplate.opsForValue()
        .setIfAbsent(lockKey, lockValue, 10, TimeUnit.SECONDS);
    
    if (locked) {
        try {
            // å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼ˆåŒé‡æ£€æŸ¥ï¼‰
            product = (Product) redisTemplate.opsForValue().get(cacheKey);
            if (product != null) {
                return product;
            }
            
            // æŸ¥è¯¢æ•°æ®åº“å¹¶ç¼“å­˜
            product = productDAO.findById(productId);
            redisTemplate.opsForValue().set(cacheKey, product, 30, TimeUnit.MINUTES);
            
            return product;
        } finally {
            // é‡Šæ”¾é”
            releaseLock(lockKey, lockValue);
        }
    } else {
        // è·å–é”å¤±è´¥ï¼Œç¨ç­‰åé‡è¯•
        Thread.sleep(100);
        return getProductById(productId);
    }
}
```

### 9.3 ç¼“å­˜é›ªå´©é—®é¢˜


**ç¼“å­˜é›ªå´©å®šä¹‰**ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“

**é›ªå´©åœºæ™¯ç¤ºä¾‹**ï¼š
```
ç³»ç»Ÿé‡å¯åœºæ™¯ï¼š
1. ç³»ç»Ÿé‡å¯ï¼Œæ‰€æœ‰ç¼“å­˜ä¸¢å¤±
2. ç”¨æˆ·è®¿é—®é«˜å³°æœŸåˆ°æ¥
3. æ‰€æœ‰è¯·æ±‚éƒ½æŸ¥è¯¢æ•°æ®åº“
4. æ•°æ®åº“è´Ÿè½½è¿‡é«˜ï¼Œå“åº”å˜æ…¢
5. æ›´å¤šè¯·æ±‚å †ç§¯ï¼Œç³»ç»Ÿå´©æºƒ
```

**è§£å†³æ–¹æ¡ˆ1ï¼šéšæœºè¿‡æœŸæ—¶é—´**ï¼š
```java
public void setCache(String key, Object value, int baseSeconds) {
    // æ·»åŠ éšæœºæ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸ
    int randomSeconds = new Random().nextInt(300); // 0-5åˆ†é’Ÿéšæœº
    int expireTime = baseSeconds + randomSeconds;
    
    redisTemplate.opsForValue().set(key, value, expireTime, TimeUnit.SECONDS);
}
```

**è§£å†³æ–¹æ¡ˆ2ï¼šå¤šçº§ç¼“å­˜**ï¼š
```java
@Service
public class MultiLevelCacheService {
    
    // L1ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜
    private Cache<String, Object> localCache = CacheBuilder.newBuilder()
        .maximumSize(1000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    // L2ç¼“å­˜ï¼šRedisç¼“å­˜
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    public Object getData(String key) {
        // 1. æŸ¥æœ¬åœ°ç¼“å­˜
        Object data = localCache.getIfPresent(key);
        if (data != null) return data;
        
        // 2. æŸ¥Redisç¼“å­˜
        data = redisTemplate.opsForValue().get(key);
        if (data != null) {
            localCache.put(key, data);
            return data;
        }
        
        // 3. æŸ¥æ•°æ®åº“
        data = loadFromDatabase(key);
        if (data != null) {
            localCache.put(key, data);
            redisTemplate.opsForValue().set(key, data, 30, TimeUnit.MINUTES);
        }
        
        return data;
    }
}
```

---

## 10. ğŸ—‚ï¸ åˆ†å¸ƒå¼ç¼“å­˜åˆ†ç‰‡


### 10.1 ç¼“å­˜åˆ†ç‰‡çš„å¿…è¦æ€§


**å•èŠ‚ç‚¹é™åˆ¶**ï¼š
- **å†…å­˜é™åˆ¶**ï¼šå•æœºå†…å­˜æœ‰ä¸Šé™ï¼ˆé€šå¸¸å‡ åGBï¼‰
- **å¹¶å‘é™åˆ¶**ï¼šå•æœºå¤„ç†èƒ½åŠ›æœ‰ç“¶é¢ˆ
- **å¯é æ€§é£é™©**ï¼šå•ç‚¹æ•…éšœå½±å“å…¨éƒ¨æ•°æ®

**åˆ†ç‰‡è§£å†³æ–¹æ¡ˆ**ï¼š
```
æ•°æ®åˆ†å¸ƒç¤ºä¾‹ï¼š
ç”¨æˆ·æ•°æ®æŒ‰IDåˆ†ç‰‡
Node1: user:1, user:4, user:7, ...  (ID % 3 == 1)
Node2: user:2, user:5, user:8, ...  (ID % 3 == 2)  
Node3: user:3, user:6, user:9, ...  (ID % 3 == 0)
```

### 10.2 åˆ†ç‰‡ç®—æ³•


**å“ˆå¸Œåˆ†ç‰‡**ï¼š
```java
public class HashSharding {
    private List<RedisTemplate> redisNodes;
    
    public RedisTemplate getRedisNode(String key) {
        int hash = key.hashCode();
        int nodeIndex = Math.abs(hash) % redisNodes.size();
        return redisNodes.get(nodeIndex);
    }
    
    public void set(String key, Object value) {
        RedisTemplate redis = getRedisNode(key);
        redis.opsForValue().set(key, value);
    }
    
    public Object get(String key) {
        RedisTemplate redis = getRedisNode(key);
        return redis.opsForValue().get(key);
    }
}
```

**ä¸€è‡´æ€§å“ˆå¸Œåˆ†ç‰‡**ï¼š
```java
public class ConsistentHashSharding {
    private SortedMap<Long, String> ring = new TreeMap<>();
    private List<String> nodes;
    
    public ConsistentHashSharding(List<String> nodes) {
        this.nodes = nodes;
        initRing();
    }
    
    private void initRing() {
        for (String node : nodes) {
            // æ¯ä¸ªèŠ‚ç‚¹åœ¨ç¯ä¸Šæ”¾ç½®å¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹
            for (int i = 0; i < 150; i++) {
                String virtualNode = node + "#" + i;
                long hash = hash(virtualNode);
                ring.put(hash, node);
            }
        }
    }
    
    public String getNode(String key) {
        long hash = hash(key);
        SortedMap<Long, String> tailMap = ring.tailMap(hash);
        
        if (tailMap.isEmpty()) {
            return ring.get(ring.firstKey()); // ç¯å½¢ï¼Œå›åˆ°å¼€å¤´
        }
        
        return tailMap.get(tailMap.firstKey());
    }
}
```

### 10.3 Redis Clusteråˆ†ç‰‡æœºåˆ¶


**å“ˆå¸Œæ§½æœºåˆ¶**ï¼š
```
Redis Clusterä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½ï¼š
- æ¯ä¸ªkeyé€šè¿‡CRC16ç®—æ³•è®¡ç®—æ§½ä½
- slot = CRC16(key) % 16384
- ä¸åŒèŠ‚ç‚¹è´Ÿè´£ä¸åŒçš„æ§½ä½èŒƒå›´

3ä¸ªèŠ‚ç‚¹çš„æ§½ä½åˆ†é…ï¼š
Node1: 0-5461     (5462ä¸ªæ§½)
Node2: 5462-10922 (5461ä¸ªæ§½)  
Node3: 10923-16383(5461ä¸ªæ§½)
```

**Javaå®¢æˆ·ç«¯ä½¿ç”¨**ï¼š
```java
@Configuration
public class RedisClusterConfig {
    
    @Bean
    public JedisCluster jedisCluster() {
        Set<HostAndPort> nodes = new HashSet<>();
        nodes.add(new HostAndPort("192.168.1.1", 7000));
        nodes.add(new HostAndPort("192.168.1.2", 7001));
        nodes.add(new HostAndPort("192.168.1.3", 7002));
        
        return new JedisCluster(nodes);
    }
}

@Service
public class ClusterCacheService {
    @Autowired
    private JedisCluster jedisCluster;
    
    public void setCache(String key, String value) {
        // å®¢æˆ·ç«¯è‡ªåŠ¨è·¯ç”±åˆ°æ­£ç¡®èŠ‚ç‚¹
        jedisCluster.set(key, value);
    }
    
    public String getCache(String key) {
        return jedisCluster.get(key);
    }
}
```

---

## 11. ğŸš€ ç¼“å­˜é¢„çƒ­ç­–ç•¥


### 11.1 ç¼“å­˜é¢„çƒ­çš„é‡è¦æ€§


**å†·å¯åŠ¨é—®é¢˜**ï¼š
```
ç³»ç»Ÿå¯åŠ¨åˆæœŸï¼š
ç¼“å­˜å‘½ä¸­ç‡: 0%
æ•°æ®åº“å‹åŠ›: æé«˜
ç”¨æˆ·ä½“éªŒ: å“åº”æ…¢

é¢„çƒ­åï¼š
ç¼“å­˜å‘½ä¸­ç‡: 80%+
æ•°æ®åº“å‹åŠ›: æ­£å¸¸
ç”¨æˆ·ä½“éªŒ: å“åº”å¿«
```

**é¢„çƒ­æ—¶æœº**ï¼š
- **ç³»ç»Ÿå¯åŠ¨æ—¶**ï¼šåº”ç”¨æœåŠ¡å™¨å¯åŠ¨å
- **ç¼“å­˜æ¸…ç©ºå**ï¼šç»´æŠ¤åé‡æ–°åŠ è½½
- **ä¸šåŠ¡é«˜å³°å‰**ï¼šæå‰å‡†å¤‡çƒ­ç‚¹æ•°æ®
- **æ–°åŠŸèƒ½ä¸Šçº¿å‰**ï¼šé¢„åŠ è½½ç›¸å…³æ•°æ®

### 11.2 é¢„çƒ­ç­–ç•¥å®ç°


**å¯åŠ¨æ—¶é¢„çƒ­**ï¼š
```java
@Component
public class CacheWarmUpService {
    
    @Autowired
    private ProductService productService;
    
    @EventListener
    public void onApplicationReady(ApplicationReadyEvent event) {
        log.info("å¼€å§‹ç¼“å­˜é¢„çƒ­...");
        warmUpProductCache();
        log.info("ç¼“å­˜é¢„çƒ­å®Œæˆ");
    }
    
    private void warmUpProductCache() {
        // é¢„çƒ­çƒ­é—¨å•†å“
        List<Long> hotProductIds = getHotProductIds();
        
        // å¹¶è¡Œé¢„çƒ­ï¼Œæé«˜æ•ˆç‡
        hotProductIds.parallelStream().forEach(productId -> {
            try {
                productService.getProductById(productId);
                log.debug("é¢„çƒ­å•†å“: {}", productId);
            } catch (Exception e) {
                log.error("é¢„çƒ­å•†å“å¤±è´¥: {}", productId, e);
            }
        });
    }
    
    private List<Long> getHotProductIds() {
        // ä»ç»Ÿè®¡æ•°æ®è·å–çƒ­é—¨å•†å“ID
        return analyticsService.getHotProductIds(100);
    }
}
```

**å®šæ—¶é¢„çƒ­**ï¼š
```java
@Component
public class ScheduledWarmUp {
    
    @Scheduled(cron = "0 30 7 * * ?") // æ¯å¤©7:30é¢„çƒ­
    public void dailyWarmUp() {
        warmUpDailyData();
    }
    
    @Scheduled(fixedRate = 3600000) // æ¯å°æ—¶é¢„çƒ­ä¸€æ¬¡
    public void hourlyWarmUp() {
        warmUpHourlyData();
    }
    
    private void warmUpDailyData() {
        // é¢„çƒ­ä»Šæ—¥çƒ­ç‚¹æ•°æ®
        List<String> todayKeys = getTodayHotKeys();
        preloadKeys(todayKeys);
    }
}
```

### 11.3 æ™ºèƒ½é¢„çƒ­ç®—æ³•


**åŸºäºè®¿é—®ç»Ÿè®¡çš„é¢„çƒ­**ï¼š
```java
@Service
public class IntelligentWarmUp {
    
    // è®°å½•è®¿é—®ç»Ÿè®¡
    public void recordAccess(String key) {
        String statsKey = "stats:access:" + key;
        redisTemplate.opsForValue().increment(statsKey);
        redisTemplate.expire(statsKey, 1, TimeUnit.DAYS);
    }
    
    // åŸºäºè®¿é—®é¢‘æ¬¡é¢„çƒ­
    public void warmUpByStats() {
        Set<String> keys = redisTemplate.keys("stats:access:*");
        
        // æŒ‰è®¿é—®æ¬¡æ•°æ’åº
        List<KeyStats> statsList = keys.stream()
            .map(this::getKeyStats)
            .sorted((a, b) -> b.getCount().compareTo(a.getCount()))
            .limit(1000) // å–å‰1000ä¸ªçƒ­ç‚¹
            .collect(Collectors.toList());
        
        // é¢„çƒ­çƒ­ç‚¹æ•°æ®
        statsList.parallelStream().forEach(stats -> {
            String realKey = stats.getKey().replace("stats:access:", "");
            preloadKey(realKey);
        });
    }
}
```

---

## 12. ğŸ¢ å¤šçº§ç¼“å­˜æ¶æ„


### 12.1 å¤šçº§ç¼“å­˜çš„ä»·å€¼


**ç¼“å­˜å±‚æ¬¡ç»“æ„**ï¼š
```
è¯·æ±‚å¤„ç†æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ 
    â†“
L1ç¼“å­˜ (æµè§ˆå™¨ç¼“å­˜) - æœ€å¿«ï¼Œå®¹é‡å°
    â†“
L2ç¼“å­˜ (CDNç¼“å­˜) - å¾ˆå¿«ï¼Œå®¹é‡ä¸­ç­‰
    â†“  
L3ç¼“å­˜ (åº”ç”¨æœ¬åœ°ç¼“å­˜) - å¿«ï¼Œå®¹é‡å°
    â†“
L4ç¼“å­˜ (åˆ†å¸ƒå¼ç¼“å­˜Redis) - è¾ƒå¿«ï¼Œå®¹é‡å¤§
    â†“
æ•°æ®åº“ (æŒä¹…åŒ–å­˜å‚¨) - æ…¢ï¼Œå®¹é‡æœ€å¤§
```

**å„çº§ç¼“å­˜ç‰¹ç‚¹å¯¹æ¯”**ï¼š

| ç¼“å­˜çº§åˆ« | **è®¿é—®é€Ÿåº¦** | **å®¹é‡å¤§å°** | **é€‚ç”¨æ•°æ®** | **å¤±æ•ˆæ—¶é—´** |
|---------|------------|------------|------------|------------|
| **æµè§ˆå™¨ç¼“å­˜** | `æå¿«(1ms)` | `å¾ˆå°(MBçº§)` | `é™æ€èµ„æº` | `é•¿(å¤©/å‘¨)` |
| **CDNç¼“å­˜** | `å¾ˆå¿«(10ms)` | `å¤§(GBçº§)` | `é™æ€+åŠ¨æ€` | `ä¸­(å°æ—¶)` |
| **æœ¬åœ°ç¼“å­˜** | `å¿«(1ms)` | `å°(MB-GB)` | `çƒ­ç‚¹æ•°æ®` | `çŸ­(åˆ†é’Ÿ)` |
| **åˆ†å¸ƒå¼ç¼“å­˜** | `è¾ƒå¿«(1-5ms)` | `å¾ˆå¤§(TBçº§)` | `å…¨å±€æ•°æ®` | `ä¸­(å°æ—¶)` |

### 12.2 å¤šçº§ç¼“å­˜å®ç°


**å®Œæ•´å¤šçº§ç¼“å­˜æ¶æ„**ï¼š
```java
@Service
public class MultiLevelCacheService {
    
    // L1: æœ¬åœ°ç¼“å­˜ (Caffeine)
    private Cache<String, Object> localCache = Caffeine.newBuilder()
        .maximumSize(1000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    // L2: åˆ†å¸ƒå¼ç¼“å­˜ (Redis)
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // L3: æ•°æ®åº“
    @Autowired
    private DataService dataService;
    
    public Object getData(String key) {
        // 1. æŸ¥æœ¬åœ°ç¼“å­˜
        Object data = localCache.getIfPresent(key);
        if (data != null) {
            log.debug("å‘½ä¸­æœ¬åœ°ç¼“å­˜: {}", key);
            return data;
        }
        
        // 2. æŸ¥åˆ†å¸ƒå¼ç¼“å­˜
        data = redisTemplate.opsForValue().get(key);
        if (data != null) {
            log.debug("å‘½ä¸­Redisç¼“å­˜: {}", key);
            // å›å¡«æœ¬åœ°ç¼“å­˜
            localCache.put(key, data);
            return data;
        }
        
        // 3. æŸ¥æ•°æ®åº“
        data = dataService.loadFromDatabase(key);
        if (data != null) {
            log.debug("ä»æ•°æ®åº“åŠ è½½: {}", key);
            
            // å›å¡«ä¸¤çº§ç¼“å­˜
            localCache.put(key, data);
            redisTemplate.opsForValue().set(key, data, 30, TimeUnit.MINUTES);
        }
        
        return data;
    }
    
    // æ›´æ–°æ—¶æ¸…ç†æ‰€æœ‰çº§åˆ«ç¼“å­˜
    public void updateData(String key, Object data) {
        // 1. æ›´æ–°æ•°æ®åº“
        dataService.updateDatabase(key, data);
        
        // 2. æ¸…ç†æœ¬åœ°ç¼“å­˜
        localCache.invalidate(key);
        
        // 3. æ¸…ç†åˆ†å¸ƒå¼ç¼“å­˜
        redisTemplate.delete(key);
        
        // 4. å¯é€‰ï¼šç«‹å³é¢„çƒ­æ–°æ•°æ®
        getData(key);
    }
}
```

### 12.3 ç¼“å­˜åŒæ­¥æœºåˆ¶


**åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„ç¼“å­˜åŒæ­¥**ï¼š
```java
@Component
public class CacheSyncService {
    
    // ç›‘å¬ç¼“å­˜æ›´æ–°æ¶ˆæ¯
    @RabbitListener(queues = "cache.sync.queue")
    public void handleCacheSync(CacheSyncMessage message) {
        switch (message.getOperation()) {
            case "DELETE":
                localCache.invalidate(message.getKey());
                break;
            case "UPDATE":
                localCache.put(message.getKey(), message.getValue());
                break;
            case "CLEAR":
                localCache.invalidateAll();
                break;
        }
        
        log.info("åŒæ­¥ç¼“å­˜æ“ä½œ: {} - {}", message.getOperation(), message.getKey());
    }
    
    // å‘é€ç¼“å­˜åŒæ­¥æ¶ˆæ¯
    public void sendSyncMessage(String key, String operation, Object value) {
        CacheSyncMessage message = new CacheSyncMessage();
        message.setKey(key);
        message.setOperation(operation);
        message.setValue(value);
        message.setTimestamp(System.currentTimeMillis());
        
        rabbitTemplate.convertAndSend("cache.sync.exchange", "cache.sync.routing", message);
    }
}
```

**ç¼“å­˜çº§è”æ›´æ–°ç­–ç•¥**ï¼š
```java
@Service
public class CascadeUpdateService {
    
    public void updateUserProfile(Long userId, UserProfile profile) {
        // 1. æ›´æ–°æ•°æ®åº“
        userDAO.updateProfile(userId, profile);
        
        // 2. çº§è”æ¸…ç†ç›¸å…³ç¼“å­˜
        clearUserRelatedCache(userId);
        
        // 3. é¢„çƒ­æ ¸å¿ƒæ•°æ®
        preloadUserData(userId);
    }
    
    private void clearUserRelatedCache(Long userId) {
        // æ¸…ç†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ç¼“å­˜
        cacheService.delete("user:profile:" + userId);
        
        // æ¸…ç†ç”¨æˆ·æƒé™ç¼“å­˜
        cacheService.delete("user:permissions:" + userId);
        
        // æ¸…ç†ç”¨æˆ·ä¼šè¯ç¼“å­˜
        cacheService.delete("user:session:" + userId);
        
        // æ¸…ç†ç›¸å…³åˆ—è¡¨ç¼“å­˜
        cacheService.deletePattern("userlist:*");
    }
}
```

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 ç¼“å­˜ç³»ç»Ÿè®¾è®¡è¦ç‚¹


```
ğŸ”¸ ç¼“å­˜æœ¬è´¨ï¼šç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½
ğŸ”¸ åˆ†å¸ƒå¼ç¼“å­˜ï¼šè§£å†³å•æœºé™åˆ¶ï¼Œæä¾›é«˜å¯ç”¨æœåŠ¡  
ğŸ”¸ åº”ç”¨ç­–ç•¥ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„ç¼“å­˜æ¨¡å¼
ğŸ”¸ ä¸€è‡´æ€§ä¿è¯ï¼šå¹³è¡¡æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§è¦æ±‚
ğŸ”¸ æ•…éšœå¤„ç†ï¼šåº”å¯¹ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ç­‰é—®é¢˜
ğŸ”¸ å®¹é‡ç®¡ç†ï¼šåˆç†çš„æ·˜æ±°ç­–ç•¥å’Œé¢„çƒ­æœºåˆ¶
ğŸ”¸ æ¶æ„è®¾è®¡ï¼šå¤šçº§ç¼“å­˜æä¾›æœ€ä¼˜æ€§èƒ½
```

### 13.2 ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ


**è®¾è®¡åŸåˆ™**ï¼š
- **è¯»å¤šå†™å°‘**ï¼šç¼“å­˜é€‚åˆè¯»æ“ä½œé¢‘ç¹çš„åœºæ™¯
- **çƒ­ç‚¹æ•°æ®**ï¼šä¼˜å…ˆç¼“å­˜è®¿é—®é¢‘ç‡é«˜çš„æ•°æ®  
- **åˆç†è¿‡æœŸ**ï¼šè®¾ç½®é€‚å½“çš„ç¼“å­˜è¿‡æœŸæ—¶é—´
- **å®¹é‡æ§åˆ¶**ï¼šé¿å…ç¼“å­˜æ— é™åˆ¶å¢é•¿
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- **æ‰¹é‡æ“ä½œ**ï¼šå‡å°‘ç½‘ç»œå¼€é”€
- **ç®¡é“æŠ€æœ¯**ï¼šæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
- **è¿æ¥æ± **ï¼šå¤ç”¨æ•°æ®åº“è¿æ¥
- **å¼‚æ­¥å¤„ç†**ï¼šéå…³é”®è·¯å¾„ä½¿ç”¨å¼‚æ­¥æ›´æ–°

**æ•…éšœé¢„é˜²**ï¼š
- **é™çº§ç­–ç•¥**ï¼šç¼“å­˜ä¸å¯ç”¨æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ
- **ç†”æ–­æœºåˆ¶**ï¼šé˜²æ­¢æ•…éšœæ‰©æ•£
- **é™æµä¿æŠ¤**ï¼šæ§åˆ¶è®¿é—®é¢‘ç‡
- **å¥åº·æ£€æŸ¥**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†æ•…éšœ

### 13.3 æŠ€æœ¯é€‰å‹å»ºè®®


**åœºæ™¯é©±åŠ¨é€‰æ‹©**ï¼š
```
é«˜æ€§èƒ½è¦æ±‚ â†’ Redis/Memcached
æµ·é‡æ•°æ® â†’ Redis Cluster  
ç®€å•åœºæ™¯ â†’ æœ¬åœ°ç¼“å­˜(Caffeine/Guava)
å¤šçº§éœ€æ±‚ â†’ ç»„åˆæ¶æ„
å®æ—¶æ€§è¦æ±‚é«˜ â†’ Write-Throughæ¨¡å¼
æœ€ç»ˆä¸€è‡´æ€§å¯æ¥å— â†’ Cache-Asideæ¨¡å¼
```

**ç›‘æ§æŒ‡æ ‡ä½“ç³»**ï¼š
- **å‘½ä¸­ç‡**ï¼šç¼“å­˜æ•ˆæœçš„æ ¸å¿ƒæŒ‡æ ‡
- **å“åº”æ—¶é—´**ï¼šç¼“å­˜æ€§èƒ½æŒ‡æ ‡
- **å†…å­˜ä½¿ç”¨ç‡**ï¼šå®¹é‡ç®¡ç†æŒ‡æ ‡  
- **é”™è¯¯ç‡**ï¼šç³»ç»Ÿå¯é æ€§æŒ‡æ ‡
- **QPS/TPS**ï¼šç³»ç»Ÿè´Ÿè½½æŒ‡æ ‡

> **ğŸ’¡ æ ¸å¿ƒè®°å¿†**ï¼š
> ç¼“å­˜ç³»ç»Ÿçš„æˆåŠŸåœ¨äºåˆç†çš„æ¶æ„è®¾è®¡ã€æ°å½“çš„ç­–ç•¥é€‰æ‹©å’Œå®Œå–„çš„ç›‘æ§ä½“ç³»ã€‚è¦æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯å¹³è¡¡æ€§èƒ½ã€ä¸€è‡´æ€§å’Œå¤æ‚åº¦ï¼Œå»ºç«‹é€‚åˆè‡ªå·±ç³»ç»Ÿçš„ç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚