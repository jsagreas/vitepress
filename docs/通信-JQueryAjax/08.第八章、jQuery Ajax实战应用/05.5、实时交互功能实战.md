---
title: 5ã€å®æ—¶äº¤äº’åŠŸèƒ½å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å®æ—¶äº¤äº’æ˜¯ä»€ä¹ˆ](#1-å®æ—¶äº¤äº’æ˜¯ä»€ä¹ˆ)
2. [è½®è¯¢æ•°æ®æ›´æ–°æœºåˆ¶](#2-è½®è¯¢æ•°æ®æ›´æ–°æœºåˆ¶)
3. [é•¿è¿æ¥æ¨¡æ‹ŸæŠ€æœ¯](#3-é•¿è¿æ¥æ¨¡æ‹ŸæŠ€æœ¯)
4. [æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿå®ç°](#4-æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿå®ç°)
5. [è¯„è®ºå’Œç‚¹èµåŠŸèƒ½](#5-è¯„è®ºå’Œç‚¹èµåŠŸèƒ½)
6. [åœ¨çº¿çŠ¶æ€æ£€æµ‹](#6-åœ¨çº¿çŠ¶æ€æ£€æµ‹)
7. [æ•°æ®åŒæ­¥æœºåˆ¶](#7-æ•°æ®åŒæ­¥æœºåˆ¶)
8. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–](#8-ç”¨æˆ·ä½“éªŒä¼˜åŒ–)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å®æ—¶äº¤äº’æ˜¯ä»€ä¹ˆ


### 1.1 æ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯å®æ—¶äº¤äº’**
å®æ—¶äº¤äº’å°±åƒæ˜¯**ç½‘é¡µç‰ˆçš„å¾®ä¿¡èŠå¤©**ï¼Œç”¨æˆ·åœ¨é¡µé¢ä¸Šçš„æ“ä½œèƒ½å¤Ÿç«‹å³åæ˜ ç»™å…¶ä»–ç”¨æˆ·ï¼Œå…¶ä»–ç”¨æˆ·çš„æ“ä½œä¹Ÿèƒ½å®æ—¶æ˜¾ç¤ºåœ¨ä½ çš„é¡µé¢ä¸Šã€‚

```
ä¼ ç»Ÿç½‘é¡µï¼šç‚¹å‡»åˆ·æ–°æŒ‰é’® â†’ çœ‹åˆ°æ–°å†…å®¹
å®æ—¶äº¤äº’ï¼šä¸ç”¨åˆ·æ–° â†’ è‡ªåŠ¨çœ‹åˆ°æ–°å†…å®¹

å°±åƒï¼š
- å¾®ä¿¡èŠå¤©ï¼šå¯¹æ–¹å‘æ¶ˆæ¯ä½ ç«‹å³æ”¶åˆ°
- åœ¨çº¿æ–‡æ¡£ï¼šåˆ«äººç¼–è¾‘ä½ å®æ—¶çœ‹åˆ°
- è´­ç‰©ç½‘ç«™ï¼šå•†å“åº“å­˜å®æ—¶æ›´æ–°
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦å®æ—¶äº¤äº’**
- ğŸ’¬ **å³æ—¶æ²Ÿé€š**ï¼šèŠå¤©ã€è¯„è®ºä¸ç”¨æ‰‹åŠ¨åˆ·æ–°
- ğŸ“Š **æ•°æ®æ›´æ–°**ï¼šè‚¡ä»·ã€è®¢å•çŠ¶æ€å®æ—¶å˜åŒ–
- ğŸ® **ç”¨æˆ·ä½“éªŒ**ï¼šæ“ä½œåé¦ˆæ›´åŠæ—¶
- ğŸ”” **æ¶ˆæ¯æé†’**ï¼šæ–°é€šçŸ¥ç«‹å³æ˜¾ç¤º

### 1.2 å®ç°æ–¹å¼å¯¹æ¯”


| æ–¹å¼ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|---------|-------------|
| ğŸ”„ **è½®è¯¢** | `å®šæ—¶å‘é€è¯·æ±‚æ£€æŸ¥æ›´æ–°` | `ç®€å•æ˜“å®ç°` | `æµªè´¹èµ„æº` | `æ•°æ®æ›´æ–°ä¸é¢‘ç¹` |
| â° **é•¿è½®è¯¢** | `æœåŠ¡å™¨ç­‰å¾…æ•°æ®å˜åŒ–æ‰è¿”å›` | `å‡å°‘è¯·æ±‚æ¬¡æ•°` | `å ç”¨è¿æ¥` | `å³æ—¶èŠå¤©` |
| ğŸŒ **WebSocket** | `å»ºç«‹æŒä¹…è¿æ¥` | `çœŸæ­£å®æ—¶` | `å¤æ‚åº¦é«˜` | `é«˜é¢‘å®æ—¶åº”ç”¨` |

---

## 2. ğŸ”„ è½®è¯¢æ•°æ®æ›´æ–°æœºåˆ¶


### 2.1 ä»€ä¹ˆæ˜¯è½®è¯¢


**è½®è¯¢å°±åƒå®šé—¹é’Ÿ**ï¼šæ¯éš”ä¸€æ®µæ—¶é—´å°±é—®æœåŠ¡å™¨"æœ‰æ–°æ•°æ®å—ï¼Ÿ"

```
å®¢æˆ·ç«¯: "æœ‰æ–°æ¶ˆæ¯å—ï¼Ÿ" â†’ æœåŠ¡å™¨: "æ²¡æœ‰"
(ç­‰å¾…5ç§’)
å®¢æˆ·ç«¯: "æœ‰æ–°æ¶ˆæ¯å—ï¼Ÿ" â†’ æœåŠ¡å™¨: "æœ‰ï¼è¿™é‡Œæ˜¯æ–°æ¶ˆæ¯"
(ç­‰å¾…5ç§’)
å®¢æˆ·ç«¯: "æœ‰æ–°æ¶ˆæ¯å—ï¼Ÿ" â†’ æœåŠ¡å™¨: "æ²¡æœ‰"
...å¾ªç¯
```

### 2.2 åŸºç¡€è½®è¯¢å®ç°


**ğŸ”§ ç®€å•æ¶ˆæ¯è½®è¯¢**
```javascript
// è·å–æœ€æ–°æ¶ˆæ¯çš„å‡½æ•°
function getLatestMessages() {
    $.ajax({
        url: '/api/messages',
        method: 'GET',
        success: function(data) {
            // å¦‚æœæœ‰æ–°æ¶ˆæ¯ï¼Œæ›´æ–°é¡µé¢
            if (data.newMessages.length > 0) {
                updateMessageList(data.newMessages);
                showNotification(`æ”¶åˆ° ${data.newMessages.length} æ¡æ–°æ¶ˆæ¯`);
            }
        },
        error: function() {
            console.log('è·å–æ¶ˆæ¯å¤±è´¥');
        }
    });
}

// æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡æ–°æ¶ˆæ¯
setInterval(getLatestMessages, 5000);

// æ›´æ–°æ¶ˆæ¯åˆ—è¡¨
function updateMessageList(messages) {
    messages.forEach(function(msg) {
        $('#messageList').append(`
            <div class="message">
                <strong>${msg.sender}:</strong> ${msg.content}
                <span class="time">${msg.time}</span>
            </div>
        `);
    });
}
```

### 2.3 æ™ºèƒ½è½®è¯¢ä¼˜åŒ–


**ğŸ¯ é¿å…é‡å¤æ•°æ®**
```javascript
let lastMessageId = 0; // è®°å½•æœ€åä¸€æ¡æ¶ˆæ¯ID

function getNewMessages() {
    $.ajax({
        url: '/api/messages',
        data: { since: lastMessageId }, // åªè·å–è¿™ä¸ªIDä¹‹åçš„æ¶ˆæ¯
        success: function(data) {
            if (data.messages.length > 0) {
                // æ›´æ–°æœ€åæ¶ˆæ¯ID
                lastMessageId = data.messages[data.messages.length - 1].id;
                updateMessageList(data.messages);
            }
        }
    });
}
```

**âš¡ åŠ¨æ€è°ƒæ•´è½®è¯¢é¢‘ç‡**
```javascript
let pollInterval = 5000; // åˆå§‹5ç§’
let isUserActive = true;  // ç”¨æˆ·æ˜¯å¦æ´»è·ƒ

function smartPolling() {
    // ç”¨æˆ·ä¸æ´»è·ƒæ—¶é™ä½é¢‘ç‡
    if (!isUserActive) {
        pollInterval = 30000; // 30ç§’
    } else {
        pollInterval = 5000;  // 5ç§’
    }
    
    setTimeout(function() {
        getNewMessages();
        smartPolling(); // é€’å½’è°ƒç”¨
    }, pollInterval);
}

// æ£€æµ‹ç”¨æˆ·æ´»è·ƒçŠ¶æ€
$(document).on('click mousemove keypress', function() {
    isUserActive = true;
});

// ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶æ ‡è®°ä¸ºä¸æ´»è·ƒ
$(window).on('blur', function() {
    isUserActive = false;
});
```

---

## 3. â° é•¿è¿æ¥æ¨¡æ‹ŸæŠ€æœ¯


### 3.1 é•¿è¿æ¥åŸç†


**é•¿è¿æ¥å°±åƒç”µè¯**ï¼šæ‹¨é€šåä¸æŒ‚æ–­ï¼Œä¸€ç›´ç­‰ç€å¯¹æ–¹è¯´è¯ã€‚

```
æ™®é€šè¯·æ±‚ï¼š
å®¢æˆ·ç«¯å‘è¯·æ±‚ â†’ æœåŠ¡å™¨ç«‹å³å›å¤ â†’ è¿æ¥å…³é—­

é•¿è¿æ¥ï¼š
å®¢æˆ·ç«¯å‘è¯·æ±‚ â†’ æœåŠ¡å™¨ç­‰å¾…... â†’ æœ‰æ•°æ®æ—¶æ‰å›å¤ â†’ è¿æ¥å…³é—­
ç«‹å³å‘èµ·æ–°çš„é•¿è¿æ¥è¯·æ±‚ â†’ ç»§ç»­ç­‰å¾…...
```

### 3.2 é•¿è½®è¯¢å®ç°


**ğŸ”„ åŸºç¡€é•¿è½®è¯¢**
```javascript
function startLongPolling() {
    $.ajax({
        url: '/api/longpoll',
        method: 'GET',
        timeout: 30000, // 30ç§’è¶…æ—¶
        success: function(data) {
            // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®
            if (data.type === 'message') {
                displayNewMessage(data.content);
            } else if (data.type === 'notification') {
                showNotification(data.content);
            }
            
            // ç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡é•¿è½®è¯¢
            startLongPolling();
        },
        error: function(xhr) {
            if (xhr.statusText === 'timeout') {
                // è¶…æ—¶æ˜¯æ­£å¸¸çš„ï¼Œé‡æ–°å¼€å§‹
                console.log('é•¿è½®è¯¢è¶…æ—¶ï¼Œé‡æ–°è¿æ¥');
                startLongPolling();
            } else {
                // çœŸæ­£çš„é”™è¯¯ï¼Œç­‰å¾…åé‡è¯•
                console.log('è¿æ¥é”™è¯¯ï¼Œ5ç§’åé‡è¯•');
                setTimeout(startLongPolling, 5000);
            }
        }
    });
}

// é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹é•¿è½®è¯¢
$(document).ready(function() {
    startLongPolling();
});
```

### 3.3 è¿æ¥çŠ¶æ€ç®¡ç†


**ğŸ”— è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨**
```javascript
let connectionStatus = 'disconnected'; // è¿æ¥çŠ¶æ€

function updateConnectionStatus(status) {
    connectionStatus = status;
    const statusElement = $('#connectionStatus');
    
    switch(status) {
        case 'connected':
            statusElement.text('ğŸŸ¢ å·²è¿æ¥').removeClass().addClass('status-connected');
            break;
        case 'connecting':
            statusElement.text('ğŸŸ¡ è¿æ¥ä¸­...').removeClass().addClass('status-connecting');
            break;
        case 'disconnected':
            statusElement.text('ğŸ”´ å·²æ–­å¼€').removeClass().addClass('status-disconnected');
            break;
    }
}

function startLongPolling() {
    updateConnectionStatus('connecting');
    
    $.ajax({
        url: '/api/longpoll',
        success: function(data) {
            updateConnectionStatus('connected');
            handleServerData(data);
            startLongPolling(); // é‡æ–°è¿æ¥
        },
        error: function() {
            updateConnectionStatus('disconnected');
            setTimeout(startLongPolling, 5000);
        }
    });
}
```

---

## 4. ğŸ”” æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿå®ç°


### 4.1 é€šçŸ¥ç±»å‹è®¾è®¡


**ğŸ¯ ä¸åŒç±»å‹çš„é€šçŸ¥**
```javascript
const NotificationTypes = {
    MESSAGE: 'message',     // æ–°æ¶ˆæ¯
    LIKE: 'like',          // ç‚¹èµé€šçŸ¥
    COMMENT: 'comment',     // è¯„è®ºé€šçŸ¥
    SYSTEM: 'system'        // ç³»ç»Ÿé€šçŸ¥
};

function createNotification(type, data) {
    const notification = {
        id: Date.now(),
        type: type,
        title: getNotificationTitle(type, data),
        message: getNotificationMessage(type, data),
        time: new Date(),
        read: false
    };
    
    return notification;
}

function getNotificationTitle(type, data) {
    switch(type) {
        case NotificationTypes.MESSAGE:
            return `${data.sender} å‘æ¥æ¶ˆæ¯`;
        case NotificationTypes.LIKE:
            return `${data.user} èµäº†ä½ çš„å†…å®¹`;
        case NotificationTypes.COMMENT:
            return `${data.user} è¯„è®ºäº†ä½ çš„å†…å®¹`;
        case NotificationTypes.SYSTEM:
            return 'ç³»ç»Ÿé€šçŸ¥';
        default:
            return 'æ–°é€šçŸ¥';
    }
}
```

### 4.2 é€šçŸ¥æ˜¾ç¤ºç»„ä»¶


**ğŸ“± å¼¹å‡ºå¼é€šçŸ¥**
```javascript
function showNotification(notification) {
    const notificationHtml = `
        <div class="notification ${notification.type}" data-id="${notification.id}">
            <div class="notification-header">
                <strong>${notification.title}</strong>
                <button class="close-btn">&times;</button>
            </div>
            <div class="notification-body">
                ${notification.message}
            </div>
            <div class="notification-time">
                ${formatTime(notification.time)}
            </div>
        </div>
    `;
    
    // æ·»åŠ åˆ°é€šçŸ¥å®¹å™¨
    $('#notificationContainer').prepend(notificationHtml);
    
    // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
    setTimeout(function() {
        $(`.notification[data-id="${notification.id}"]`).fadeOut(500, function() {
            $(this).remove();
        });
    }, 3000);
    
    // æ›´æ–°é€šçŸ¥è®¡æ•°
    updateNotificationCount();
}

// å…³é—­é€šçŸ¥
$(document).on('click', '.notification .close-btn', function() {
    $(this).closest('.notification').fadeOut(300, function() {
        $(this).remove();
        updateNotificationCount();
    });
});
```

### 4.3 é€šçŸ¥ä¸­å¿ƒ


**ğŸ“‹ é€šçŸ¥åˆ—è¡¨ç®¡ç†**
```javascript
let notifications = []; // å­˜å‚¨æ‰€æœ‰é€šçŸ¥

function addToNotificationCenter(notification) {
    notifications.unshift(notification); // æ·»åŠ åˆ°å¼€å¤´
    renderNotificationList();
    updateNotificationBadge();
}

function renderNotificationList() {
    const container = $('#notificationList');
    container.empty();
    
    notifications.forEach(function(notif) {
        const item = `
            <div class="notification-item ${notif.read ? 'read' : 'unread'}" 
                 data-id="${notif.id}">
                <div class="notification-content">
                    <h4>${notif.title}</h4>
                    <p>${notif.message}</p>
                    <small>${formatTime(notif.time)}</small>
                </div>
                ${!notif.read ? '<span class="unread-dot"></span>' : ''}
            </div>
        `;
        container.append(item);
    });
}

// ç‚¹å‡»é€šçŸ¥æ ‡è®°ä¸ºå·²è¯»
$(document).on('click', '.notification-item.unread', function() {
    const notifId = $(this).data('id');
    markAsRead(notifId);
});

function markAsRead(notificationId) {
    const notification = notifications.find(n => n.id === notificationId);
    if (notification) {
        notification.read = true;
        renderNotificationList();
        updateNotificationBadge();
    }
}
```

---

## 5. ğŸ’¬ è¯„è®ºå’Œç‚¹èµåŠŸèƒ½


### 5.1 å®æ—¶è¯„è®ºç³»ç»Ÿ


**ğŸ’­ è¯„è®ºå‘å¸ƒå’Œæ˜¾ç¤º**
```javascript
// å‘å¸ƒè¯„è®º
function postComment(postId, content) {
    if (!content.trim()) {
        alert('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º');
        return;
    }
    
    $.ajax({
        url: '/api/comments',
        method: 'POST',
        data: {
            postId: postId,
            content: content
        },
        success: function(response) {
            // æ¸…ç©ºè¾“å…¥æ¡†
            $(`#commentInput-${postId}`).val('');
            
            // ç«‹å³æ˜¾ç¤ºæ–°è¯„è®ºï¼ˆä¹è§‚æ›´æ–°ï¼‰
            addCommentToUI(postId, response.comment);
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showToast('è¯„è®ºå‘å¸ƒæˆåŠŸ');
        },
        error: function() {
            showToast('è¯„è®ºå‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
        }
    });
}

// æ·»åŠ è¯„è®ºåˆ°ç•Œé¢
function addCommentToUI(postId, comment) {
    const commentHtml = `
        <div class="comment-item" data-comment-id="${comment.id}">
            <div class="comment-avatar">
                <img src="${comment.user.avatar}" alt="${comment.user.name}">
            </div>
            <div class="comment-content">
                <div class="comment-header">
                    <strong>${comment.user.name}</strong>
                    <span class="comment-time">${formatTime(comment.createdAt)}</span>
                </div>
                <div class="comment-text">${comment.content}</div>
                <div class="comment-actions">
                    <button class="reply-btn" data-comment-id="${comment.id}">å›å¤</button>
                </div>
            </div>
        </div>
    `;
    
    $(`#commentList-${postId}`).append(commentHtml);
    updateCommentCount(postId);
}

// ç»‘å®šè¯„è®ºæäº¤äº‹ä»¶
$(document).on('click', '.submit-comment', function() {
    const postId = $(this).data('post-id');
    const content = $(`#commentInput-${postId}`).val();
    postComment(postId, content);
});
```

### 5.2 ç‚¹èµåŠŸèƒ½å®ç°


**â¤ï¸ ç‚¹èµ/å–æ¶ˆç‚¹èµ**
```javascript
function toggleLike(postId, button) {
    const isLiked = $(button).hasClass('liked');
    const action = isLiked ? 'unlike' : 'like';
    
    // ç«‹å³æ›´æ–°UIï¼ˆä¹è§‚æ›´æ–°ï¼‰
    updateLikeUI(button, !isLiked);
    
    $.ajax({
        url: `/api/posts/${postId}/${action}`,
        method: 'POST',
        success: function(response) {
            // æ›´æ–°ç‚¹èµæ•°
            $(button).find('.like-count').text(response.likeCount);
        },
        error: function() {
            // å¤±è´¥æ—¶å›æ»šUI
            updateLikeUI(button, isLiked);
            showToast('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
        }
    });
}

function updateLikeUI(button, isLiked) {
    const $button = $(button);
    const $icon = $button.find('.like-icon');
    const $count = $button.find('.like-count');
    
    if (isLiked) {
        $button.addClass('liked');
        $icon.text('â¤ï¸'); // çº¢å¿ƒ
        $button.find('.like-text').text('å·²èµ');
    } else {
        $button.removeClass('liked');
        $icon.text('ğŸ¤'); // ç©ºå¿ƒ
        $button.find('.like-text').text('ç‚¹èµ');
    }
}

// ç»‘å®šç‚¹èµäº‹ä»¶
$(document).on('click', '.like-btn', function(e) {
    e.preventDefault();
    const postId = $(this).data('post-id');
    toggleLike(postId, this);
});
```

### 5.3 å®æ—¶æ›´æ–°ä»–äººæ“ä½œ


**ğŸ‘¥ æ˜¾ç¤ºå…¶ä»–ç”¨æˆ·çš„ç‚¹èµå’Œè¯„è®º**
```javascript
// é€šè¿‡è½®è¯¢è·å–å…¶ä»–ç”¨æˆ·çš„æ“ä½œ
function checkForUpdates() {
    const lastUpdateTime = localStorage.getItem('lastUpdateTime') || 0;
    
    $.ajax({
        url: '/api/updates',
        data: { since: lastUpdateTime },
        success: function(updates) {
            updates.forEach(function(update) {
                switch(update.type) {
                    case 'new_comment':
                        if (update.comment.userId !== currentUserId) {
                            addCommentToUI(update.postId, update.comment);
                            showToast(`${update.comment.user.name} å‘è¡¨äº†æ–°è¯„è®º`);
                        }
                        break;
                        
                    case 'new_like':
                        if (update.userId !== currentUserId) {
                            updateLikeCount(update.postId, update.likeCount);
                            showToast(`${update.user.name} èµäº†è¿™ç¯‡å†…å®¹`);
                        }
                        break;
                }
            });
            
            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            localStorage.setItem('lastUpdateTime', Date.now());
        }
    });
}

// æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡æ›´æ–°
setInterval(checkForUpdates, 10000);
```

---

## 6. ğŸ‘¤ åœ¨çº¿çŠ¶æ€æ£€æµ‹


### 6.1 ç”¨æˆ·åœ¨çº¿çŠ¶æ€æ˜¾ç¤º


**ğŸŸ¢ åœ¨çº¿çŠ¶æ€æŒ‡ç¤ºå™¨**
```javascript
const UserStatus = {
    ONLINE: 'online',
    OFFLINE: 'offline',
    AWAY: 'away'        // ç¦»å¼€
};

function updateUserStatus(userId, status) {
    const statusElement = $(`.user-status[data-user-id="${userId}"]`);
    
    // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
    statusElement.removeClass('online offline away');
    
    // æ·»åŠ æ–°çŠ¶æ€
    statusElement.addClass(status);
    
    // æ›´æ–°çŠ¶æ€æ–‡æœ¬
    const statusText = {
        'online': 'ğŸŸ¢ åœ¨çº¿',
        'offline': 'âš« ç¦»çº¿',
        'away': 'ğŸŸ¡ ç¦»å¼€'
    };
    
    statusElement.text(statusText[status]);
}

// å®šæœŸå‘é€å¿ƒè·³åŒ…
function sendHeartbeat() {
    $.ajax({
        url: '/api/heartbeat',
        method: 'POST',
        success: function(response) {
            // æ›´æ–°å…¶ä»–ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€
            response.userStatuses.forEach(function(user) {
                updateUserStatus(user.id, user.status);
            });
        }
    });
}

// æ¯30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
setInterval(sendHeartbeat, 30000);
```

### 6.2 ç¦»çº¿æ£€æµ‹


**ğŸ“± æ£€æµ‹ç”¨æˆ·æ˜¯å¦ç¦»å¼€é¡µé¢**
```javascript
let isUserActive = true;
let lastActivityTime = Date.now();

// ç›‘å¬ç”¨æˆ·æ´»åŠ¨
$(document).on('mousemove click keypress scroll', function() {
    isUserActive = true;
    lastActivityTime = Date.now();
});

// æ£€æµ‹ç”¨æˆ·æ˜¯å¦é•¿æ—¶é—´æ— æ´»åŠ¨
function checkUserActivity() {
    const now = Date.now();
    const inactiveTime = now - lastActivityTime;
    
    // 5åˆ†é’Ÿæ— æ´»åŠ¨æ ‡è®°ä¸ºç¦»å¼€
    if (inactiveTime > 5 * 60 * 1000) {
        if (isUserActive) {
            isUserActive = false;
            updateMyStatus('away');
        }
    }
}

// æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
setInterval(checkUserActivity, 60000);

// é¡µé¢è·å¾—ç„¦ç‚¹æ—¶æ ‡è®°ä¸ºåœ¨çº¿
$(window).on('focus', function() {
    isUserActive = true;
    lastActivityTime = Date.now();
    updateMyStatus('online');
});

// é¡µé¢å¤±å»ç„¦ç‚¹æ—¶æ ‡è®°ä¸ºç¦»å¼€
$(window).on('blur', function() {
    updateMyStatus('away');
});

function updateMyStatus(status) {
    $.ajax({
        url: '/api/status',
        method: 'POST',
        data: { status: status }
    });
}
```

---

## 7. ğŸ”„ æ•°æ®åŒæ­¥æœºåˆ¶


### 7.1 æ•°æ®ç‰ˆæœ¬æ§åˆ¶


**ğŸ“Š é¿å…æ•°æ®å†²çª**
```javascript
let dataVersion = 0; // æœ¬åœ°æ•°æ®ç‰ˆæœ¬

function syncData() {
    $.ajax({
        url: '/api/sync',
        data: { version: dataVersion },
        success: function(response) {
            if (response.hasUpdates) {
                // æœåŠ¡å™¨æœ‰æ–°æ•°æ®
                applyUpdates(response.updates);
                dataVersion = response.latestVersion;
                
                showToast('æ•°æ®å·²åŒæ­¥');
            }
        }
    });
}

function applyUpdates(updates) {
    updates.forEach(function(update) {
        switch(update.type) {
            case 'post_updated':
                updatePostInUI(update.data);
                break;
            case 'post_deleted':
                removePostFromUI(update.postId);
                break;
            case 'comment_added':
                addCommentToUI(update.postId, update.data);
                break;
        }
    });
}
```

### 7.2 ç¦»çº¿æ•°æ®å¤„ç†


**ğŸ’¾ ç¦»çº¿æ—¶çš„æ•°æ®ç¼“å­˜**
```javascript
let offlineQueue = []; // ç¦»çº¿æ“ä½œé˜Ÿåˆ—

function handleOfflineAction(action) {
    // æ·»åŠ åˆ°ç¦»çº¿é˜Ÿåˆ—
    offlineQueue.push({
        ...action,
        timestamp: Date.now(),
        id: generateId()
    });
    
    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem('offlineQueue', JSON.stringify(offlineQueue));
    
    showToast('æ“ä½œå·²ä¿å­˜ï¼Œå°†åœ¨è¿æ¥æ¢å¤æ—¶åŒæ­¥');
}

// ç½‘ç»œæ¢å¤æ—¶åŒæ­¥ç¦»çº¿æ“ä½œ
function syncOfflineActions() {
    if (offlineQueue.length === 0) return;
    
    showToast('æ­£åœ¨åŒæ­¥ç¦»çº¿æ“ä½œ...');
    
    offlineQueue.forEach(function(action, index) {
        $.ajax({
            url: action.url,
            method: action.method,
            data: action.data,
            success: function() {
                // ç§»é™¤å·²æˆåŠŸçš„æ“ä½œ
                offlineQueue.splice(index, 1);
                localStorage.setItem('offlineQueue', JSON.stringify(offlineQueue));
            }
        });
    });
}

// æ£€æµ‹ç½‘ç»œçŠ¶æ€
$(window).on('online', function() {
    showToast('ç½‘ç»œå·²æ¢å¤');
    syncOfflineActions();
});

$(window).on('offline', function() {
    showToast('ç½‘ç»œå·²æ–­å¼€ï¼Œå°†ç¼“å­˜æ‚¨çš„æ“ä½œ');
});
```

---

## 8. ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–


### 8.1 åŠ è½½çŠ¶æ€æŒ‡ç¤º


**â³ ä¼˜é›…çš„åŠ è½½æç¤º**
```javascript
function showLoading(message = 'åŠ è½½ä¸­...') {
    const loadingHtml = `
        <div class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>${message}</p>
            </div>
        </div>
    `;
    
    $('body').append(loadingHtml);
}

function hideLoading() {
    $('.loading-overlay').fadeOut(300, function() {
        $(this).remove();
    });
}

// åœ¨Ajaxè¯·æ±‚ä¸­ä½¿ç”¨
function loadMessages() {
    showLoading('è·å–æœ€æ–°æ¶ˆæ¯...');
    
    $.ajax({
        url: '/api/messages',
        success: function(data) {
            updateMessageList(data);
            hideLoading();
        },
        error: function() {
            hideLoading();
            showToast('åŠ è½½å¤±è´¥', 'error');
        }
    });
}
```

### 8.2 é˜²æŠ–å’ŒèŠ‚æµ


**ğŸš« é¿å…é¢‘ç¹è¯·æ±‚**
```javascript
// é˜²æŠ–ï¼šå»¶è¿Ÿæ‰§è¡Œï¼Œå¦‚æœå†æ¬¡è§¦å‘åˆ™é‡æ–°è®¡æ—¶
function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
}

// æœç´¢è¾“å…¥é˜²æŠ–
const searchMessages = debounce(function(keyword) {
    if (keyword.length < 2) return;
    
    $.ajax({
        url: '/api/search',
        data: { q: keyword },
        success: function(results) {
            displaySearchResults(results);
        }
    });
}, 300);

$('#searchInput').on('input', function() {
    searchMessages($(this).val());
});

// èŠ‚æµï¼šé™åˆ¶æ‰§è¡Œé¢‘ç‡
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// æ»šåŠ¨åŠ è½½èŠ‚æµ
const handleScroll = throttle(function() {
    if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
        loadMoreContent();
    }
}, 200);

$(window).on('scroll', handleScroll);
```

### 8.3 é”™è¯¯é‡è¯•æœºåˆ¶


**ğŸ”„ æ™ºèƒ½é‡è¯•**
```javascript
function ajaxWithRetry(options, maxRetries = 3) {
    let retryCount = 0;
    
    function makeRequest() {
        $.ajax({
            ...options,
            success: function(data) {
                if (options.success) {
                    options.success(data);
                }
            },
            error: function(xhr) {
                retryCount++;
                
                if (retryCount <= maxRetries && xhr.status !== 404) {
                    // å»¶è¿Ÿé‡è¯•ï¼Œæ¯æ¬¡å»¶è¿Ÿæ—¶é—´é€’å¢
                    const delay = Math.pow(2, retryCount) * 1000;
                    showToast(`è¯·æ±‚å¤±è´¥ï¼Œ${delay/1000}ç§’åé‡è¯•...`);
                    
                    setTimeout(makeRequest, delay);
                } else {
                    // è¶…è¿‡é‡è¯•æ¬¡æ•°æˆ–ä¸å¯é‡è¯•çš„é”™è¯¯
                    if (options.error) {
                        options.error(xhr);
                    }
                    showToast('è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                }
            }
        });
    }
    
    makeRequest();
}

// ä½¿ç”¨ç¤ºä¾‹
ajaxWithRetry({
    url: '/api/important-data',
    method: 'GET',
    success: function(data) {
        processImportantData(data);
    }
}, 3); // æœ€å¤šé‡è¯•3æ¬¡
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®æ—¶äº¤äº’æœ¬è´¨ï¼šè®©ç½‘é¡µåƒæ‰‹æœºAppä¸€æ ·å®æ—¶å“åº”
ğŸ”¸ è½®è¯¢æœºåˆ¶ï¼šå®šæ—¶ä¸»åŠ¨è¯¢é—®æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°æ•°æ®
ğŸ”¸ é•¿è¿æ¥ï¼šä¿æŒè¿æ¥ç­‰å¾…æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ•°æ®
ğŸ”¸ æ¶ˆæ¯é€šçŸ¥ï¼šåŠæ—¶å‘ŠçŸ¥ç”¨æˆ·æ–°çš„åŠ¨æ€å’Œå˜åŒ–
ğŸ”¸ æ•°æ®åŒæ­¥ï¼šç¡®ä¿å¤šä¸ªç”¨æˆ·çœ‹åˆ°çš„æ•°æ®ä¸€è‡´æ€§
ğŸ”¸ ç”¨æˆ·ä½“éªŒï¼šé€šè¿‡åˆç†çš„æç¤ºå’Œåé¦ˆæå‡ä½¿ç”¨æ„Ÿå—
```

### 9.2 æŠ€æœ¯æ–¹æ¡ˆé€‰æ‹©


**ğŸ¯ æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆ**

```
æ•°æ®æ›´æ–°ä¸é¢‘ç¹ï¼ˆå¦‚æ–°é—»ã€å…¬å‘Šï¼‰ï¼š
âœ… ä½¿ç”¨æ™®é€šè½®è¯¢ï¼Œé—´éš”æ—¶é—´é•¿ä¸€äº›ï¼ˆ30ç§’-5åˆ†é’Ÿï¼‰

å³æ—¶èŠå¤©ã€åœ¨çº¿æ¸¸æˆï¼š
âœ… ä½¿ç”¨é•¿è½®è¯¢æˆ–WebSocketï¼Œè¿½æ±‚å®æ—¶æ€§

ç”¨æˆ·çŠ¶æ€æ£€æµ‹ï¼š
âœ… ç»“åˆå¿ƒè·³åŒ… + é¡µé¢äº‹ä»¶ç›‘å¬

å¤§é‡ç”¨æˆ·åŒæ—¶åœ¨çº¿ï¼š
âœ… è€ƒè™‘æœåŠ¡å™¨å‹åŠ›ï¼Œåˆç†è®¾ç½®è½®è¯¢é¢‘ç‡
```

### 9.3 å®é™…å¼€å‘å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µ**

- ğŸ”„ **æ¸è¿›å¢å¼º**ï¼šå…ˆå®ç°åŸºç¡€åŠŸèƒ½ï¼Œå†æ·»åŠ å®æ—¶ç‰¹æ€§
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨é˜²æŠ–èŠ‚æµé¿å…é¢‘ç¹è¯·æ±‚
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸æ—¶çš„é‡è¯•å’Œæç¤ºæœºåˆ¶
- ğŸ’¾ **ç¦»çº¿æ”¯æŒ**ï¼šç¼“å­˜ç”¨æˆ·æ“ä½œï¼Œç½‘ç»œæ¢å¤æ—¶åŒæ­¥
- ğŸ¨ **ç”¨æˆ·ä½“éªŒ**ï¼šæ¸…æ™°çš„çŠ¶æ€æŒ‡ç¤ºå’Œæµç•…çš„åŠ¨ç”»æ•ˆæœ

**ğŸš« å¸¸è§é™·é˜±**

- âŒ è½®è¯¢é¢‘ç‡è¿‡é«˜å¯¼è‡´æœåŠ¡å™¨å‹åŠ›è¿‡å¤§
- âŒ æ²¡æœ‰å¤„ç†ç½‘ç»œå¼‚å¸¸æƒ…å†µ
- âŒ å¿˜è®°æ¸…ç†å®šæ—¶å™¨å¯¼è‡´å†…å­˜æ³„æ¼
- âŒ æ²¡æœ‰è€ƒè™‘ç”¨æˆ·ç¦»å¼€é¡µé¢æ—¶çš„èµ„æºé‡Šæ”¾

**æ ¸å¿ƒè®°å¿†**ï¼š
- å®æ—¶äº¤äº’è®©ç½‘é¡µæ›´åƒAppï¼Œç”¨æˆ·ä½“éªŒæ›´æµç•…
- è½®è¯¢æ˜¯å®šæ—¶è¯¢é—®ï¼Œé•¿è¿æ¥æ˜¯ç­‰å¾…é€šçŸ¥
- åˆç†çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤ºæ˜¯å…³é”®
- æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒéœ€è¦å¹³è¡¡è€ƒè™‘