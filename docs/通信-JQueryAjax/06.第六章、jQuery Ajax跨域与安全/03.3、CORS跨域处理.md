---
title: 3ã€CORSè·¨åŸŸå¤„ç†
---
## ğŸ“š ç›®å½•

1. [è·¨åŸŸé—®é¢˜åŸºç¡€è®¤çŸ¥](#1-è·¨åŸŸé—®é¢˜åŸºç¡€è®¤çŸ¥)
2. [CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ](#2-CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ)
3. [jQuery Ajax CORSé…ç½®](#3-jQuery-Ajax-CORSé…ç½®)
4. [Cookieè·¨åŸŸä¼ é€’](#4-Cookieè·¨åŸŸä¼ é€’)
5. [é¢„æ£€è¯·æ±‚å¤„ç†](#5-é¢„æ£€è¯·æ±‚å¤„ç†)
6. [å¼€å‘ç¯å¢ƒè·¨åŸŸé…ç½®](#6-å¼€å‘ç¯å¢ƒè·¨åŸŸé…ç½®)
7. [ç”Ÿäº§ç¯å¢ƒCORSéƒ¨ç½²](#7-ç”Ÿäº§ç¯å¢ƒCORSéƒ¨ç½²)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è·¨åŸŸé—®é¢˜åŸºç¡€è®¤çŸ¥


### 1.1 ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜


**é€šä¿—ç†è§£**ï¼šæµè§ˆå™¨çš„"å®‰å…¨é—¨å«"ä¸è®©ä½ éšä¾¿è®¿é—®å…¶ä»–ç½‘ç«™çš„æ•°æ®

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
ä½ åœ¨Aå…¬å¸ä¸Šç­ï¼Œæƒ³è¦Bå…¬å¸çš„å†…éƒ¨èµ„æ–™
é—¨å«ä¼šé—®ï¼š"ä½ æœ‰Bå…¬å¸çš„é€šè¡Œè¯å—ï¼Ÿ"
æ²¡æœ‰å°±ä¸è®©è¿› â†’ è¿™å°±æ˜¯è·¨åŸŸé™åˆ¶

ç½‘ç»œåœºæ™¯ï¼š
ä½ çš„ç½‘ç«™ï¼šhttp://localhost:3000
APIæœåŠ¡å™¨ï¼šhttp://api.example.com
æµè§ˆå™¨é—¨å«ï¼šä¸å…è®¸è®¿é—®ï¼
```

**æµè§ˆå™¨åŒæºç­–ç•¥**ï¼šåªå…è®¸è®¿é—®"åŒä¸€æ¥æº"çš„èµ„æº
- **åŒæº** = åè®® + åŸŸå + ç«¯å£ éƒ½ç›¸åŒ
- **è·¨åŸŸ** = ä»»ä½•ä¸€ä¸ªä¸åŒå°±ç®—è·¨åŸŸ

### 1.2 è·¨åŸŸçš„å…·ä½“æƒ…å†µ


```
ä½ çš„ç½‘ç«™åœ¨ï¼šhttp://localhost:3000

è¿™äº›éƒ½æ˜¯è·¨åŸŸï¼š
âŒ https://localhost:3000     (åè®®ä¸åŒ)
âŒ http://localhost:8080      (ç«¯å£ä¸åŒ)  
âŒ http://127.0.0.1:3000      (åŸŸåä¸åŒ)
âŒ http://api.example.com     (åŸŸåå®Œå…¨ä¸åŒ)

è¿™äº›æ˜¯åŒæºï¼š
âœ… http://localhost:3000/api
âœ… http://localhost:3000/user
âœ… http://localhost:3000/login
```

### 1.3 è·¨åŸŸé”™è¯¯é•¿ä»€ä¹ˆæ ·


```javascript
// å½“ä½ å°è¯•è·¨åŸŸè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šæŠ¥é”™ï¼š
// Access to XMLHttpRequest at 'http://api.example.com/users' 
// from origin 'http://localhost:3000' has been blocked by CORS policy
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**
> 
> çœ‹åˆ°è¿™ä¸ªé”™è¯¯ä¸è¦æ…Œï¼è¿™æ˜¯æ­£å¸¸çš„æµè§ˆå™¨ä¿æŠ¤æœºåˆ¶
> æˆ‘ä»¬éœ€è¦è®©æœåŠ¡å™¨"å¼€é—¨"å…è®¸è·¨åŸŸè®¿é—®

---

## 2. ğŸ”“ CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ


### 2.1 CORSæ˜¯ä»€ä¹ˆ


**CORS**ï¼ˆCross-Origin Resource Sharingï¼‰= **è·¨æºèµ„æºå…±äº«**

**é€šä¿—è§£é‡Š**ï¼š
- æµè§ˆå™¨ï¼š"æˆ‘è¦è®¿é—®Bç½‘ç«™çš„æ•°æ®"
- Bç½‘ç«™æœåŠ¡å™¨ï¼š"å¯ä»¥ï¼Œæˆ‘å…è®¸ä½ è®¿é—®"
- æµè§ˆå™¨ï¼š"å¥½çš„ï¼Œé‚£æˆ‘å°±è®¿é—®äº†"

```
å®¢æˆ·ç«¯ï¼ˆä½ çš„ç½‘ç«™ï¼‰              æœåŠ¡å™¨ï¼ˆAPIç½‘ç«™ï¼‰
       |                            |
   [å‘é€è¯·æ±‚] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ [æ£€æŸ¥æ¥æº]
       |                            |
       |                      [è®¾ç½®å…è®¸è®¿é—®]
       |                            |
   [æ”¶åˆ°æ•°æ®] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  [è¿”å›æ•°æ®]
```

### 2.2 æœåŠ¡å™¨å¦‚ä½•"å¼€é—¨"


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šæœåŠ¡å™¨é€šè¿‡HTTPå“åº”å¤´å‘Šè¯‰æµè§ˆå™¨"æˆ‘å…è®¸è°è®¿é—®"

```
æœåŠ¡å™¨è®¾ç½®å…è®¸è®¿é—®çš„å“åº”å¤´ï¼š
Access-Control-Allow-Origin: *              // å…è®¸æ‰€æœ‰ç½‘ç«™è®¿é—®
Access-Control-Allow-Origin: http://localhost:3000  // åªå…è®¸ç‰¹å®šç½‘ç«™
Access-Control-Allow-Methods: GET, POST     // å…è®¸çš„è¯·æ±‚æ–¹æ³•
Access-Control-Allow-Headers: Content-Type  // å…è®¸çš„è¯·æ±‚å¤´
```

### 2.3 å¸¸è§çš„æœåŠ¡å™¨è®¾ç½®


**Node.js Expressç¤ºä¾‹**ï¼š
```javascript
// æœåŠ¡å™¨ç«¯ä»£ç  - å…è®¸è·¨åŸŸ
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE');
  res.header('Access-Control-Allow-Headers', 'Content-Type');
  next();
});
```

**PHPç¤ºä¾‹**ï¼š
```php
<?php
// å…è®¸è·¨åŸŸè®¿é—®
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST');
header('Access-Control-Allow-Headers: Content-Type');
?>
```

---

## 3. âš™ï¸ jQuery Ajax CORSé…ç½®


### 3.1 åŸºç¡€è·¨åŸŸè¯·æ±‚


**jQueryé»˜è®¤æ”¯æŒCORS**ï¼Œé€šå¸¸ä¸éœ€è¦ç‰¹æ®Šé…ç½®ï¼š

```javascript
// æœ€ç®€å•çš„è·¨åŸŸè¯·æ±‚
$.ajax({
  url: 'http://api.example.com/users',
  type: 'GET',
  success: function(data) {
    console.log('è·¨åŸŸè¯·æ±‚æˆåŠŸï¼', data);
  },
  error: function(xhr, status, error) {
    console.log('è·¨åŸŸè¯·æ±‚å¤±è´¥ï¼š', error);
  }
});
```

> ğŸ’¡ **å…³é”®ç†è§£**
> 
> jQueryä¸éœ€è¦åšä»€ä¹ˆç‰¹æ®Šè®¾ç½®ï¼Œå…³é”®æ˜¯**æœåŠ¡å™¨è¦é…ç½®å¥½CORSå“åº”å¤´**

### 3.2 å‘é€è‡ªå®šä¹‰è¯·æ±‚å¤´


å½“éœ€è¦å‘é€è‡ªå®šä¹‰è¯·æ±‚å¤´æ—¶ï¼š

```javascript
$.ajax({
  url: 'http://api.example.com/users',
  type: 'POST',
  headers: {
    'Authorization': 'Bearer your-token',
    'Custom-Header': 'custom-value'
  },
  data: {
    name: 'John',
    age: 25
  },
  success: function(data) {
    console.log('è¯·æ±‚æˆåŠŸ', data);
  }
});
```

**æœåŠ¡å™¨éœ€è¦ç›¸åº”é…ç½®**ï¼š
```javascript
// æœåŠ¡å™¨è¦å…è®¸è¿™äº›è‡ªå®šä¹‰å¤´
res.header('Access-Control-Allow-Headers', 'Authorization, Custom-Header, Content-Type');
```

### 3.3 å¤„ç†è·¨åŸŸé”™è¯¯


```javascript
$.ajax({
  url: 'http://api.example.com/users',
  type: 'GET',
  success: function(data) {
    console.log('æˆåŠŸè·å–æ•°æ®', data);
  },
  error: function(xhr, status, error) {
    if (xhr.status === 0) {
      alert('è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨CORSé…ç½®');
    } else {
      alert('è¯·æ±‚å¤±è´¥ï¼š' + error);
    }
  }
});
```

---

## 4. ğŸª Cookieè·¨åŸŸä¼ é€’


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ä¼ é€’Cookie


**ä½¿ç”¨åœºæ™¯**ï¼šç”¨æˆ·ç™»å½•ä¿¡æ¯å­˜åœ¨Cookieä¸­ï¼Œè·¨åŸŸè¯·æ±‚æ—¶éœ€è¦å¸¦ä¸Š

```
ç”¨æˆ·åœ¨ç½‘ç«™Aç™»å½• â†’ Cookieä¿å­˜ç™»å½•çŠ¶æ€
ç½‘ç«™Aè¯·æ±‚APIæœåŠ¡å™¨B â†’ éœ€è¦å¸¦ä¸ŠCookieè¯æ˜èº«ä»½
APIæœåŠ¡å™¨BéªŒè¯Cookie â†’ è¿”å›ç”¨æˆ·ä¸“å±æ•°æ®
```

### 4.2 é…ç½®withCredentials


**jQueryé…ç½®**ï¼š
```javascript
$.ajax({
  url: 'http://api.example.com/user-info',
  type: 'GET',
  xhrFields: {
    withCredentials: true  // å…³é”®é…ç½®ï¼šå‘é€Cookie
  },
  success: function(data) {
    console.log('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ', data);
  }
});
```

**æœåŠ¡å™¨å¿…é¡»åŒæ—¶é…ç½®**ï¼š
```javascript
// æœåŠ¡å™¨ç«¯è®¾ç½®
res.header('Access-Control-Allow-Credentials', 'true');
res.header('Access-Control-Allow-Origin', 'http://localhost:3000'); // ä¸èƒ½ç”¨ *
```

> âš ï¸ **é‡è¦æ³¨æ„**
> 
> å½“ä½¿ç”¨`withCredentials: true`æ—¶ï¼ŒæœåŠ¡å™¨çš„`Access-Control-Allow-Origin`**ä¸èƒ½è®¾ç½®ä¸º`*`**ï¼Œå¿…é¡»æ˜¯å…·ä½“åŸŸå

### 4.3 å…¨å±€Cookieé…ç½®


```javascript
// å…¨å±€è®¾ç½®æ‰€æœ‰Ajaxè¯·æ±‚éƒ½å¸¦Cookie
$.ajaxSetup({
  xhrFields: {
    withCredentials: true
  }
});

// ä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨å¸¦Cookie
$.get('http://api.example.com/data');
```

---

## 5. ğŸ” é¢„æ£€è¯·æ±‚å¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯é¢„æ£€è¯·æ±‚


**é€šä¿—ç†è§£**ï¼šæµè§ˆå™¨çš„"æå‰æ¢è·¯"æœºåˆ¶

```
å¤æ‚è¯·æ±‚æµç¨‹ï¼š
1. æµè§ˆå™¨ï¼š"æˆ‘è¦å‘ä¸€ä¸ªå¤æ‚è¯·æ±‚ï¼Œå…ˆé—®é—®å¯ä»¥å—ï¼Ÿ" (é¢„æ£€è¯·æ±‚)
2. æœåŠ¡å™¨ï¼š"å¯ä»¥ï¼Œä½ å‘å§" (é¢„æ£€å“åº”)
3. æµè§ˆå™¨ï¼š"å¥½çš„ï¼Œç°åœ¨å‘çœŸæ­£çš„è¯·æ±‚" (å®é™…è¯·æ±‚)
4. æœåŠ¡å™¨ï¼š"è¿™æ˜¯ä½ è¦çš„æ•°æ®" (å®é™…å“åº”)
```

### 5.2 ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘é¢„æ£€


**ç®€å•è¯·æ±‚**ï¼ˆä¸è§¦å‘é¢„æ£€ï¼‰ï¼š
- æ–¹æ³•ï¼šGETã€POSTã€HEAD
- è¯·æ±‚å¤´ï¼šåªåŒ…å«åŸºæœ¬å¤´ï¼ˆå¦‚Content-Type: application/x-www-form-urlencodedï¼‰

**å¤æ‚è¯·æ±‚**ï¼ˆè§¦å‘é¢„æ£€ï¼‰ï¼š
```javascript
// è¿™äº›ä¼šè§¦å‘é¢„æ£€è¯·æ±‚
$.ajax({
  url: 'http://api.example.com/users',
  type: 'PUT',                    // éç®€å•æ–¹æ³•
  contentType: 'application/json', // éç®€å•Content-Type
  headers: {
    'Authorization': 'Bearer token' // è‡ªå®šä¹‰å¤´
  },
  data: JSON.stringify({name: 'John'})
});
```

### 5.3 æœåŠ¡å™¨å¤„ç†é¢„æ£€


```javascript
// æœåŠ¡å™¨å¤„ç†OPTIONSé¢„æ£€è¯·æ±‚
app.options('*', (req, res) => {
  res.header('Access-Control-Allow-Origin', 'http://localhost:3000');
  res.header('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE,OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Content-Type,Authorization');
  res.header('Access-Control-Max-Age', '86400'); // é¢„æ£€ç»“æœç¼“å­˜24å°æ—¶
  res.sendStatus(200);
});
```

---

## 6. ğŸ› ï¸ å¼€å‘ç¯å¢ƒè·¨åŸŸé…ç½®


### 6.1 å¼€å‘æ—¶çš„è·¨åŸŸé—®é¢˜


**å¸¸è§åœºæ™¯**ï¼š
- å‰ç«¯ï¼š`http://localhost:3000`
- åç«¯ï¼š`http://localhost:8080`
- é—®é¢˜ï¼šä¸åŒç«¯å£ = è·¨åŸŸ

### 6.2 Webpackä»£ç†è§£å†³ï¼ˆæ¨èï¼‰


**webpack.config.jsé…ç½®**ï¼š
```javascript
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',  // åç«¯æœåŠ¡å™¨
        changeOrigin: true,               // ä¿®æ”¹è¯·æ±‚å¤´ä¸­çš„host
        pathRewrite: {
          '^/api': ''                     // å»æ‰/apiå‰ç¼€
        }
      }
    }
  }
};
```

**å‰ç«¯è¯·æ±‚**ï¼š
```javascript
// è¯·æ±‚ä¼šè¢«ä»£ç†åˆ° http://localhost:8080/users
$.get('/api/users', function(data) {
  console.log('è·å–ç”¨æˆ·æ•°æ®', data);
});
```

### 6.3 Node.jså¼€å‘æœåŠ¡å™¨


**ç®€å•çš„å¼€å‘æœåŠ¡å™¨**ï¼š
```javascript
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();

// è®¾ç½®ä»£ç†
app.use('/api', createProxyMiddleware({
  target: 'http://localhost:8080',
  changeOrigin: true,
  pathRewrite: {
    '^/api': ''
  }
}));

app.listen(3000);
```

---

## 7. ğŸš€ ç”Ÿäº§ç¯å¢ƒCORSéƒ¨ç½²


### 7.1 ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹


**å®‰å…¨è€ƒè™‘**ï¼š
```javascript
// âŒ ç”Ÿäº§ç¯å¢ƒä¸è¦è¿™æ ·åš
res.header('Access-Control-Allow-Origin', '*');

// âœ… æ˜ç¡®æŒ‡å®šå…è®¸çš„åŸŸå
res.header('Access-Control-Allow-Origin', 'https://yourwebsite.com');
```

### 7.2 Nginxåå‘ä»£ç†


**nginx.confé…ç½®**ï¼š
```nginx
server {
  listen 80;
  server_name yourwebsite.com;
  
  # å‰ç«¯é™æ€æ–‡ä»¶
  location / {
    root /var/www/html;
    try_files $uri $uri/ /index.html;
  }
  
  # APIä»£ç†ï¼Œé¿å…è·¨åŸŸ
  location /api/ {
    proxy_pass http://backend-server:8080/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
}
```

### 7.3 ç”Ÿäº§ç¯å¢ƒCORSé…ç½®


**å®‰å…¨çš„CORSé…ç½®**ï¼š
```javascript
const allowedOrigins = [
  'https://yourwebsite.com',
  'https://www.yourwebsite.com'
];

app.use((req, res, next) => {
  const origin = req.headers.origin;
  
  if (allowedOrigins.includes(origin)) {
    res.header('Access-Control-Allow-Origin', origin);
  }
  
  res.header('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE');
  res.header('Access-Control-Allow-Headers', 'Content-Type,Authorization');
  res.header('Access-Control-Allow-Credentials', 'true');
  
  next();
});
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»ç†è§£çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è·¨åŸŸé—®é¢˜ï¼šæµè§ˆå™¨å®‰å…¨æœºåˆ¶ï¼Œä¸åŒæºä¸èƒ½äº’ç›¸è®¿é—®
ğŸ”¸ CORSè§£å†³æ–¹æ¡ˆï¼šæœåŠ¡å™¨è®¾ç½®å“åº”å¤´å…è®¸è·¨åŸŸè®¿é—®
ğŸ”¸ jQueryæ”¯æŒï¼šåŸç”Ÿæ”¯æŒCORSï¼Œæ— éœ€ç‰¹æ®Šé…ç½®
ğŸ”¸ Cookieä¼ é€’ï¼šéœ€è¦withCredentialsé…ç½®
ğŸ”¸ é¢„æ£€è¯·æ±‚ï¼šå¤æ‚è¯·æ±‚çš„å®‰å…¨æ£€æŸ¥æœºåˆ¶
```

### 8.2 å…³é”®é…ç½®å¯¹ç…§è¡¨


| åœºæ™¯ | jQueryé…ç½® | æœåŠ¡å™¨é…ç½® |
|------|------------|------------|
| **ç®€å•è·¨åŸŸ** | æ— éœ€ç‰¹æ®Šé…ç½® | `Access-Control-Allow-Origin: *` |
| **ä¼ é€’Cookie** | `withCredentials: true` | `Allow-Credentials: true` + å…·ä½“åŸŸå |
| **è‡ªå®šä¹‰å¤´** | `headers: {...}` | `Allow-Headers: è‡ªå®šä¹‰å¤´åç§°` |
| **å¤æ‚è¯·æ±‚** | æ­£å¸¸é…ç½® | å¤„ç†OPTIONSé¢„æ£€è¯·æ±‚ |

### 8.3 å¸¸è§é—®é¢˜å¿«é€Ÿæ’æŸ¥


**ğŸ” é—®é¢˜æ’æŸ¥æ¸…å•**ï¼š
- [ ] æœåŠ¡å™¨æ˜¯å¦è®¾ç½®äº†`Access-Control-Allow-Origin`ï¼Ÿ
- [ ] ä½¿ç”¨Cookieæ—¶æ˜¯å¦è®¾ç½®äº†`withCredentials`ï¼Ÿ
- [ ] è‡ªå®šä¹‰å¤´æ˜¯å¦åœ¨æœåŠ¡å™¨å…è®¸åˆ—è¡¨ä¸­ï¼Ÿ
- [ ] å¤æ‚è¯·æ±‚çš„é¢„æ£€å“åº”æ˜¯å¦æ­£ç¡®ï¼Ÿ

### 8.4 å¼€å‘å»ºè®®


**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
```
å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨ä»£ç†è§£å†³è·¨åŸŸï¼ˆwebpack proxyï¼‰
æµ‹è¯•ç¯å¢ƒï¼šé…ç½®CORSï¼Œæµ‹è¯•çœŸå®è·¨åŸŸåœºæ™¯  
ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼é™åˆ¶å…è®¸çš„åŸŸåï¼Œç¡®ä¿å®‰å…¨
```

**ğŸ”§ è°ƒè¯•æŠ€å·§**ï¼š
```javascript
// åœ¨Networké¢æ¿æŸ¥çœ‹ï¼š
// 1. æ˜¯å¦æœ‰OPTIONSé¢„æ£€è¯·æ±‚
// 2. å“åº”å¤´æ˜¯å¦åŒ…å«Access-Control-*
// 3. è¯·æ±‚æ˜¯å¦æºå¸¦äº†Cookieï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- è·¨åŸŸæ˜¯æµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ï¼ŒæœåŠ¡å™¨è¦"å¼€é—¨"
- jQueryå¤©ç„¶æ”¯æŒCORSï¼Œå…³é”®åœ¨æœåŠ¡å™¨é…ç½®  
- Cookieè·¨åŸŸéœ€è¦åŒæ–¹éƒ½åŒæ„ï¼ˆwithCredentials + Allow-Credentialsï¼‰
- å¼€å‘ç”¨ä»£ç†ï¼Œç”Ÿäº§ç”¨CORSï¼Œå®‰å…¨ç¬¬ä¸€