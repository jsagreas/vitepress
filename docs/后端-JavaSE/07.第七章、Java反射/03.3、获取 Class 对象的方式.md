---
title: 3ã€è·å– Class å¯¹è±¡çš„æ–¹å¼
---
## ğŸ“š ç›®å½•

1. [ç±»å.classæ–¹å¼](#1-ç±»åclassæ–¹å¼)
2. [å¯¹è±¡.getClass()æ–¹å¼](#2-å¯¹è±¡getClassæ–¹å¼)
3. [Class.forName()æ–¹å¼](#3-ClassforNameæ–¹å¼)
4. [é€šè¿‡ç±»åŠ è½½å™¨è·å–](#4-é€šè¿‡ç±»åŠ è½½å™¨è·å–)
5. [å››ç§æ–¹å¼å¯¹æ¯”æ€»ç»“](#5-å››ç§æ–¹å¼å¯¹æ¯”æ€»ç»“)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ ç±»å.classæ–¹å¼


### 1.1 åŸºæœ¬è¯­æ³•


**ğŸ”¸ ç¼–è¯‘æ—¶è·å–ç±»çš„Classå¯¹è±¡**
```java
// âœ… è¯­æ³•æ ¼å¼ï¼š
Class<T> clazz = ç±»å.class;

// ğŸ’¡ ç¤ºä¾‹ï¼š
Class<String> clazz = String.class;
Class<int[]> arrayClazz = int[].class;
Class<Void> voidClazz = void.class;

// â— æ³¨æ„äº‹é¡¹ï¼š
// ä¸ä¼šè§¦å‘é™æ€ä»£ç å—æ‰§è¡Œï¼ˆä¸åˆå§‹åŒ–ç±»ï¼‰
// é€‚åˆç›´æ¥è®¿é—®å·²çŸ¥ç±»å‹çš„Classå¯¹è±¡
```

### 1.2 ç‰¹ç‚¹åˆ†æ


**ğŸ“‹ æ ¸å¿ƒç‰¹æ€§è¡¨**

| ç‰¹æ€§ | **è¯´æ˜** |
|-----|---------|
| **ç¼–è¯‘æœŸç¡®å®š** | ç¼–è¯‘æ—¶å°±å·²ç¡®å®šï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ– |
| **ç±»å‹å®‰å…¨** | ç¼–è¯‘å™¨ä¼šæ ¡éªŒç±»æ˜¯å¦å­˜åœ¨ï¼Œå†™é”™ç±»åä¼šæŠ¥é”™ |
| **å¸¸ç”¨äº** | æ³›å‹ã€æ•°ç»„ç±»å‹åˆ¤æ–­ã€é™æ€åˆå§‹åŒ–åœºæ™¯ |
| **æ€§èƒ½** | æœ€é«˜ï¼Œæ— éœ€åŠ¨æ€è§£æ |

### 1.3 ä¼˜ç¼ºç‚¹åˆ†æ


**âš–ï¸ ä¼˜ç¼ºç‚¹è¯¦è§£**
```
ç›´æ¥ä½¿ç”¨ç±»åï¼ˆå¦‚String.classï¼‰è·å–Classå¯¹è±¡çš„ä¼˜ç¼ºç‚¹
â”œâ”€â”€ ä¸€ã€ä¼˜ç‚¹
â”‚   â”œâ”€â”€ 1. ç®€å•ç›´æ¥
â”‚   â”‚   â””â”€â”€ è¯­æ³•æ¸…æ™°ï¼Œæ˜“äºé˜…è¯»å’Œç»´æŠ¤
â”‚   â”œâ”€â”€ 2. ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨
â”‚   â”‚   â””â”€â”€ ç¼–è¯‘å™¨å¯æ£€æŸ¥ç±»å‹ï¼Œé¿å…æ‹¼å†™é”™è¯¯æˆ–ç±»ä¸å­˜åœ¨é—®é¢˜
â”‚   â”œâ”€â”€ 3. æ€§èƒ½ä¼˜è¶Š
â”‚   â”‚   â””â”€â”€ æ— éœ€é€šè¿‡å­—ç¬¦ä¸²è§£ææˆ–ç±»åŠ è½½å™¨ï¼Œæ•ˆç‡é«˜
â”‚   â””â”€â”€ 4. éåå°„è°ƒç”¨ï¼Œé€‚åˆé™æ€åœºæ™¯ä½¿ç”¨
â”‚
â”œâ”€â”€ äºŒã€ç¼ºç‚¹
â”‚   â”œâ”€â”€ 1. ç¼ºä¹åŠ¨æ€æ€§
â”‚   â”‚   â””â”€â”€ ç±»åå¿…é¡»åœ¨ç¼–è¯‘æ—¶å·²çŸ¥ï¼Œæ— æ³•æ ¹æ®å­—ç¬¦ä¸²æˆ–é…ç½®åŠ¨æ€ç¡®å®š
â”‚   â””â”€â”€ 2. ä¸é€‚åˆåŠ¨æ€åŠ è½½
â”‚       â””â”€â”€ æ— æ³•åº”å¯¹æ’ä»¶ç³»ç»Ÿã€è„šæœ¬è§£æã€é…ç½®é©±åŠ¨åœºæ™¯
â”‚
â””â”€â”€ ä¸‰ã€é€‚ç”¨å»ºè®®
    â”œâ”€â”€ é€‚åˆé™æ€ç¼–ç ã€ç¡®å®šç±»å‹çš„åœºæ™¯
    â””â”€â”€ ä¸é€‚åˆè¿è¡Œæ—¶åŠ¨æ€å†³å®šç±»åçš„æ¡†æ¶å¼€å‘ç­‰åœºæ™¯
```

### 1.4 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨ç¤ºä¾‹**
```java
// ç”¨äºå‚æ•°åŒ–ç±»å‹
public <T> List<T> convertToList(String json, Class<T> targetClass) {
    // ä½¿ç”¨ç±»å¯¹è±¡è¿›è¡Œè½¬æ¢æ“ä½œ
    // å…¸å‹åº”ç”¨å¦‚Jacksonæˆ–Gsonçš„ç±»å‹è½¬æ¢
    return objectMapper.readValue(json, 
        objectMapper.getTypeFactory().constructCollectionType(List.class, targetClass));
}

// è°ƒç”¨æ–¹å¼
List<User> users = convertToList(jsonString, User.class);

// ç”¨äºç±»å‹åˆ¤æ–­
public boolean isStringArray(Object obj) {
    return obj.getClass() == String[].class;
}

// ç”¨äºåå°„å·¥å…·æ–¹æ³•
public static <T> T createInstance(Class<T> clazz) throws Exception {
    return clazz.getDeclaredConstructor().newInstance();
}
```

---

## 2. ğŸ”„ å¯¹è±¡.getClass()æ–¹å¼


### 2.1 åŸºæœ¬è¯­æ³•


**ğŸ”¸ è¿è¡Œæ—¶ä»å¯¹è±¡è·å–Classå¯¹è±¡**
```java
// âœ… è¯­æ³•æ ¼å¼ï¼š
Object obj = new String("abc");
Class<?> clazz = obj.getClass();

// ğŸ’¡ ç¤ºä¾‹ï¼š
Object o1 = new ArrayList<>();
Object o2 = new HashMap<>();

System.out.println(o1.getClass()); // class java.util.ArrayList
System.out.println(o2.getClass()); // class java.util.HashMap

// â— æ³¨æ„äº‹é¡¹ï¼š
// å¿…é¡»å…ˆæœ‰å¯¹è±¡å®ä¾‹
// è¿”å›çš„ç±»å‹æ˜¯è¿è¡Œæ—¶å®é™…ç±»å‹ï¼Œä¸ä¸€å®šæ˜¯å¼•ç”¨å£°æ˜çš„ç±»å‹
```

### 2.2 ç‰¹ç‚¹åˆ†æ


**ğŸ“‹ æ ¸å¿ƒç‰¹æ€§è¡¨**

| ç‰¹æ€§ | **è¯´æ˜** |
|-----|---------|
| **è¿è¡ŒæœŸè·å–** | åœ¨ç¨‹åºè¿è¡Œæ—¶è·å–å®ä¾‹çš„å®é™…ç±»å‹ |
| **å¤šæ€æ”¯æŒ** | å³ä½¿å¼•ç”¨ç±»å‹æ˜¯çˆ¶ç±»ï¼Œè·å–åˆ°çš„æ˜¯å®é™…å­ç±»ç±»å‹ |
| **å¸¸ç”¨äº** | è¿è¡Œæ—¶ç±»å‹åˆ¤æ–­ã€å¯¹è±¡åå°„æ“ä½œç­‰ |
| **åŠ¨æ€æ€§** | æ”¯æŒå¤šæ€å¯¹è±¡çš„çœŸå®ç±»å‹è¯†åˆ« |

### 2.3 ä¼˜ç¼ºç‚¹åˆ†æ


**âš–ï¸ ä¼˜ç¼ºç‚¹è¯¦è§£**
```
é€šè¿‡obj.getClass()è·å–Classå¯¹è±¡çš„ä¼˜ç¼ºç‚¹
â”œâ”€â”€ ä¸€ã€ä¼˜ç‚¹
â”‚   â”œâ”€â”€ 1. è·å–å¯¹è±¡çš„ç¡®åˆ‡è¿è¡Œæ—¶ç±»å‹
â”‚   â”‚   â””â”€â”€ å¯ç”¨äºåˆ¤æ–­å¤šæ€å¯¹è±¡çš„å®é™…ç±»å‹ï¼ˆå¦‚instanceofæ›¿ä»£æ–¹æ¡ˆï¼‰
â”‚   â”œâ”€â”€ 2. é€‚ç”¨äºå¤šæ€åœºæ™¯
â”‚   â”‚   â””â”€â”€ å½“å¼•ç”¨ä¸ºçˆ¶ç±»/æ¥å£æ—¶ï¼Œå¯é€šè¿‡getClass()è·å–å­ç±»å®é™…ç±»å‹
â”‚   â””â”€â”€ 3. ä¸éœ€è¦ç±»å
â”‚       â””â”€â”€ æœ‰å¯¹è±¡å¼•ç”¨å³å¯ï¼Œæ— éœ€ç¡¬ç¼–ç ç±»å
â”‚
â”œâ”€â”€ äºŒã€ç¼ºç‚¹
â”‚   â”œâ”€â”€ 1. å¿…é¡»æœ‰å¯¹è±¡å®ä¾‹
â”‚   â”‚   â””â”€â”€ æ— æ³•åœ¨å°šæœªåˆ›å»ºå¯¹è±¡å‰ä½¿ç”¨
â”‚   â””â”€â”€ 2. ä¸é€‚ç”¨äºåŸºæœ¬æ•°æ®ç±»å‹
â”‚       â””â”€â”€ intã€doubleç­‰å¿…é¡»é€šè¿‡å…¶åŒ…è£…ç±»å®ä¾‹æ¥é—´æ¥è·å–Class
â”‚           â””â”€â”€ å¦‚Integer.valueOf(1).getClass()
â”‚
â””â”€â”€ ä¸‰ã€é€‚ç”¨å»ºè®®
    â”œâ”€â”€ é€‚åˆå¯¹è±¡å·²å­˜åœ¨ä¸”ç±»å‹å¯èƒ½å˜åŒ–çš„è¿è¡Œæ—¶åœºæ™¯
    â””â”€â”€ ä¸é€‚ç”¨äºç±»è¿˜æœªåŠ è½½ã€æˆ–åªçŸ¥é“ç±»åå­—ç¬¦ä¸²çš„åœºæ™¯
```

### 2.4 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨ç¤ºä¾‹**
```java
// ç”¨äºå¤šæ€åˆ¤æ–­
public void processShape(Shape shape) {
    Class<?> shapeClass = shape.getClass();
    
    if (shapeClass == Circle.class) {
        Circle circle = (Circle) shape;
        System.out.println("å¤„ç†åœ†å½¢ï¼ŒåŠå¾„ï¼š" + circle.getRadius());
    } else if (shapeClass == Rectangle.class) {
        Rectangle rect = (Rectangle) shape;
        System.out.println("å¤„ç†çŸ©å½¢ï¼Œé¢ç§¯ï¼š" + rect.getArea());
    }
    
    // æˆ–ä½¿ç”¨instanceofï¼ˆæ›´æ¨èçš„æ–¹å¼ï¼‰
    if (shape instanceof Circle circle) {
        System.out.println("å¤„ç†åœ†å½¢ï¼ŒåŠå¾„ï¼š" + circle.getRadius());
    }
}

// ç”¨äºå¯¹è±¡ä¿¡æ¯æ‰“å°
public String getObjectInfo(Object obj) {
    if (obj == null) return "null";
    
    Class<?> clazz = obj.getClass();
    return String.format("å¯¹è±¡ç±»å‹ï¼š%sï¼ŒåŒ…åï¼š%s", 
        clazz.getSimpleName(), clazz.getPackage().getName());
}

// ç”¨äºåºåˆ—åŒ–æ¡†æ¶ä¸­çš„ç±»å‹è¯†åˆ«
public void serialize(Object obj) throws Exception {
    Class<?> objClass = obj.getClass();
    
    // æ ¹æ®ä¸åŒç±»å‹é‡‡ç”¨ä¸åŒåºåˆ—åŒ–ç­–ç•¥
    if (Collection.class.isAssignableFrom(objClass)) {
        // å¤„ç†é›†åˆç±»å‹
        serializeCollection((Collection<?>) obj);
    } else if (objClass.isArray()) {
        // å¤„ç†æ•°ç»„ç±»å‹
        serializeArray(obj);
    } else {
        // å¤„ç†æ™®é€šå¯¹è±¡
        serializeObject(obj);
    }
}
```

---

## 3. ğŸ”— Class.forName()æ–¹å¼


### 3.1 åŸºæœ¬è¯­æ³•


**ğŸ”¸ é€šè¿‡ç±»åå­—ç¬¦ä¸²åŠ è½½Classå¯¹è±¡**
```java
// âœ… è¯­æ³•æ ¼å¼ï¼š
Class<?> clazz = Class.forName("java.lang.String");

// ğŸ’¡ ç¤ºä¾‹ï¼š
Class<?> clazz = Class.forName("com.example.User");
// åŠ¨æ€åˆ›å»ºå¯¹è±¡
Object obj = clazz.getDeclaredConstructor().newInstance();

// â— æ³¨æ„äº‹é¡¹ï¼š
// ä¼šæŠ›å‡ºClassNotFoundExceptionï¼Œéœ€è¦try-catch
// ç±»åå¿…é¡»ä¸ºå®Œæ•´é™å®šåï¼ˆåŒ…å + ç±»åï¼‰
// ä¼šæ‰§è¡Œé™æ€ä»£ç å—ï¼Œä¾‹å¦‚ï¼š

class A {
    static { System.out.println("Aç±»åˆå§‹åŒ–"); }
}
Class.forName("A"); // ä¼šè¾“å‡ºï¼šAç±»åˆå§‹åŒ–
```

### 3.2 ç‰¹ç‚¹åˆ†æ


**ğŸ“‹ æ ¸å¿ƒç‰¹æ€§è¡¨**

| ç‰¹æ€§ | **è¯´æ˜** |
|-----|---------|
| **åŠ¨æ€åŠ è½½** | ç±»åä½œä¸ºå­—ç¬¦ä¸²ä¼ å…¥ï¼Œè¿è¡Œæ—¶å†³å®šåŠ è½½å“ªä¸ªç±» |
| **åå°„èµ·ç‚¹** | æœ€å¸¸ç”¨äºåå°„ä¸­åŠ è½½ç±»ç»“æ„ |
| **ä¼šè§¦å‘åˆå§‹åŒ–** | ç±»çš„åˆå§‹åŒ–ï¼ˆæ‰§è¡Œé™æ€ä»£ç å—ã€åˆå§‹åŒ–é™æ€å˜é‡ï¼‰ |
| **å¼‚å¸¸å¤„ç†** | éœ€è¦å¤„ç†ClassNotFoundException |

### 3.3 Class.forName()çš„é‡è½½æ–¹æ³•


**ğŸ”§ æ–¹æ³•é‡è½½è¯¦è§£**
```java
// 1. é»˜è®¤æ–¹æ³•ï¼ˆæœ€å¸¸ç”¨ï¼‰
Class<?> clazz1 = Class.forName("com.example.User");
// ç­‰ä»·äºï¼šClass.forName("com.example.User", true, å½“å‰ç±»çš„ç±»åŠ è½½å™¨)

// 2. å®Œæ•´å‚æ•°æ–¹æ³•
Class<?> clazz2 = Class.forName(
    "com.example.User",           // ç±»å
    false,                        // æ˜¯å¦åˆå§‹åŒ–ï¼ˆfalseä¸æ‰§è¡Œé™æ€ä»£ç å—ï¼‰
    Thread.currentThread().getContextClassLoader() // æŒ‡å®šç±»åŠ è½½å™¨
);

// 3. æ¨¡å—åŒ–ç³»ç»Ÿæ–¹æ³•ï¼ˆJava 9+ï¼‰
Class<?> clazz3 = Class.forName(module, "com.example.User");
```

**ğŸ“Š å‚æ•°è¯´æ˜è¡¨**

| å‚æ•° | **ç±»å‹** | **è¯´æ˜** |
|-----|---------|---------|
| `name` | `String` | ç±»çš„å®Œå…¨é™å®šå |
| `initialize` | `boolean` | æ˜¯å¦æ‰§è¡Œç±»åˆå§‹åŒ–ï¼ˆé™æ€ä»£ç å—ï¼‰ |
| `loader` | `ClassLoader` | æŒ‡å®šç”¨äºåŠ è½½ç±»çš„ç±»åŠ è½½å™¨ |

### 3.4 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹ä½¿ç”¨ç¤ºä¾‹**
```java
// JDBCé©±åŠ¨åŠ è½½
public class DatabaseConnection {
    static {
        try {
            // åŠ¨æ€åŠ è½½æ•°æ®åº“é©±åŠ¨
            Class.forName("com.mysql.cj.jdbc.Driver");
            System.out.println("MySQLé©±åŠ¨åŠ è½½æˆåŠŸ");
        } catch (ClassNotFoundException e) {
            System.err.println("æ‰¾ä¸åˆ°MySQLé©±åŠ¨ï¼š" + e.getMessage());
        }
    }
}

// æ’ä»¶ç³»ç»Ÿ
public class PluginManager {
    public Plugin loadPlugin(String pluginClassName) {
        try {
            Class<?> pluginClass = Class.forName(pluginClassName);
            
            // æ£€æŸ¥æ˜¯å¦å®ç°äº†Pluginæ¥å£
            if (Plugin.class.isAssignableFrom(pluginClass)) {
                Constructor<?> constructor = pluginClass.getDeclaredConstructor();
                return (Plugin) constructor.newInstance();
            } else {
                throw new IllegalArgumentException("ç±»ä¸æ˜¯æœ‰æ•ˆçš„æ’ä»¶ï¼š" + pluginClassName);
            }
        } catch (ClassNotFoundException e) {
            System.err.println("æ‰¾ä¸åˆ°æ’ä»¶ç±»ï¼š" + pluginClassName);
        } catch (Exception e) {
            System.err.println("æ’ä»¶åŠ è½½å¤±è´¥ï¼š" + e.getMessage());
        }
        return null;
    }
}

// é…ç½®é©±åŠ¨çš„Beanåˆ›å»º
public class BeanFactory {
    private Map<String, String> beanConfig = new HashMap<>();
    
    public Object createBean(String beanName) {
        String className = beanConfig.get(beanName);
        if (className == null) {
            throw new IllegalArgumentException("æœªæ‰¾åˆ°Beané…ç½®ï¼š" + beanName);
        }
        
        try {
            Class<?> beanClass = Class.forName(className);
            return beanClass.getDeclaredConstructor().newInstance();
        } catch (Exception e) {
            throw new RuntimeException("åˆ›å»ºBeanå¤±è´¥ï¼š" + beanName, e);
        }
    }
}

// åå°„å·¥å…·ç±»
public class ReflectionUtils {
    public static boolean classExists(String className) {
        try {
            Class.forName(className, false, 
                Thread.currentThread().getContextClassLoader());
            return true;
        } catch (ClassNotFoundException e) {
            return false;
        }
    }
}
```

---

## 4. ğŸ”§ é€šè¿‡ç±»åŠ è½½å™¨è·å–


### 4.1 åŸºæœ¬è¯­æ³•


**ğŸ”¸ ä½¿ç”¨ClassLoaderåŠ è½½ç±»**
```java
// æ ¸å¿ƒè¯­æ³•
ClassLoader classLoader = å½“å‰ç±».class.getClassLoader();
Class<?> clazz = classLoader.loadClass("com.example.User");

// è·å–ç±»åŠ è½½å™¨çš„æ–¹å¼
ClassLoader loader = å½“å‰ç±».class.getClassLoader(); // å½“å‰ç±»çš„ç±»åŠ è½½å™¨
// å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆå¸¸ç”¨ï¼‰
ClassLoader contextLoader = Thread.currentThread().getContextClassLoader();
// è·å–åŠ è½½æŸä¸ªç±»çš„ç±»åŠ è½½å™¨
ClassLoader stringLoader = String.class.getClassLoader(); // Bootstrapï¼Œç»“æœä¸ºnull
// ç³»ç»Ÿç±»åŠ è½½å™¨
ClassLoader systemLoader = ClassLoader.getSystemClassLoader();
```

### 4.2 loadClass()æ–¹æ³•è¯¦è§£


**ğŸ“‹ æ–¹æ³•è¯´æ˜è¡¨**

| æ–¹æ³•ç­¾å | `public Class<?> loadClass(String name)` |
|---------|----------------------------------------|
| **å‚æ•°** | ç±»çš„å®Œå…¨é™å®šåï¼Œå¦‚`java.util.ArrayList` |
| **è¿”å›** | åŠ è½½åçš„`Class`å¯¹è±¡ |
| **è§¦å‘** | âŒ ä¸ä¼šæ‰§è¡Œé™æ€ä»£ç å—ï¼Œä¸ä¼šåˆå§‹åŒ–ç±»ï¼ˆåªåŠ è½½ï¼‰ |
| **å¼‚å¸¸** | æŠ›å‡º`ClassNotFoundException` |

### 4.3 ä¸Class.forName()çš„å¯¹æ¯”


**âš–ï¸ è¯¦ç»†å¯¹æ¯”åˆ†æ**

| å¯¹æ¯”ç‚¹ | **ClassLoader.loadClass()** | **Class.forName()** |
|-------|---------------------------|-------------------|
| **æ˜¯å¦åˆå§‹åŒ–ç±»** | âŒ é»˜è®¤ä¸åˆå§‹åŒ–ç±» | âœ… é»˜è®¤ä¼šæ‰§è¡Œé™æ€ä»£ç å— |
| **è¿”å›ç±»å‹** | `Class<?>` | `Class<?>` |
| **å¼‚å¸¸ç±»å‹** | `ClassNotFoundException` | `ClassNotFoundException` |
| **ç”¨é€”** | æ›´åº•å±‚ï¼Œé€šå¸¸æ¡†æ¶ä¸­ä½¿ç”¨ | åå°„æ“ä½œä¸­å¸¸ç”¨ |
| **å¯æ§æ€§** | æ›´å¼ºï¼ˆç»“åˆç±»åŠ è½½å™¨ï¼‰ | ç®€æ´ |
| **ç­‰ä»·å†™æ³•** | `loader.loadClass("X")` | `Class.forName("X", true, loader)` |

### 4.4 ç±»åŠ è½½å™¨ä½“ç³»ç»“æ„


**ğŸ—ï¸ ç±»åŠ è½½å™¨å±‚æ¬¡**
```
Javaç±»åŠ è½½å™¨ä½“ç³»
â”œâ”€â”€ å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰
â”‚   â”œâ”€â”€ åŠ è½½JDKæ ¸å¿ƒç±»ï¼Œå¦‚java.lang.*
â”‚   â”œâ”€â”€ ç”±C++å®ç°ï¼Œåœ¨Javaä¸­è¿”å›null
â”‚   â””â”€â”€ åŠ è½½è·¯å¾„ï¼š$JAVA_HOME/jre/lib/rt.jar
â”‚
â”œâ”€â”€ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰
â”‚   â”œâ”€â”€ åŠ è½½JREæ‰©å±•ç›®å½•ä¸­çš„ç±»
â”‚   â”œâ”€â”€ çˆ¶åŠ è½½å™¨ï¼šBootstrap ClassLoader
â”‚   â””â”€â”€ åŠ è½½è·¯å¾„ï¼š$JAVA_HOME/jre/lib/ext/*.jar
â”‚
â”œâ”€â”€ åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰
â”‚   â”œâ”€â”€ åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸‹çš„ç±»
â”‚   â”œâ”€â”€ çˆ¶åŠ è½½å™¨ï¼šExtension ClassLoader
â”‚   â””â”€â”€ åŠ è½½è·¯å¾„ï¼šSystem.getProperty("java.class.path")
â”‚
â””â”€â”€ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom ClassLoaderï¼‰
    â”œâ”€â”€ ç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘åŠ è½½ç±»
    â”œâ”€â”€ çˆ¶åŠ è½½å™¨ï¼šé€šå¸¸æ˜¯Application ClassLoader
    â””â”€â”€ ç”¨é€”ï¼šçƒ­éƒ¨ç½²ã€æ²™ç®±ã€æ’ä»¶ç³»ç»Ÿç­‰
```

**ğŸ“Š ç±»åŠ è½½å™¨å¯¹æ¯”è¡¨**

| åŠ è½½å™¨åç§° | **ç®€ç§°** | **ä½œç”¨** | **è¿”å›å€¼** |
|----------|---------|---------|-----------|
| **å¼•å¯¼ç±»åŠ è½½å™¨** | Bootstrap | åŠ è½½JDKæ ¸å¿ƒç±»ï¼Œå¦‚`java.lang.*` | è¿”å›null |
| **æ‰©å±•ç±»åŠ è½½å™¨** | ExtClassLoader | åŠ è½½`ext`ç›®å½•ä¸‹çš„ç±» | ExtClassLoaderå®ä¾‹ |
| **åº”ç”¨ç±»åŠ è½½å™¨** | AppClassLoader | åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸‹çš„ç±» | AppClassLoaderå®ä¾‹ |
| **è‡ªå®šä¹‰ç±»åŠ è½½å™¨** | - | ç”¨æˆ·è‡ªå®šä¹‰é€»è¾‘åŠ è½½ç±»ï¼ˆå¦‚çƒ­éƒ¨ç½²ã€æ²™ç®±ï¼‰ | è‡ªå®šä¹‰å®ä¾‹ |

### 4.5 å…¸å‹åº”ç”¨åœºæ™¯


**ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹**
```java
// 1. æ¡†æ¶ä¸­çš„ç±»éš”ç¦»åŠ è½½
public class ModuleLoader {
    private final ClassLoader moduleClassLoader;
    
    public ModuleLoader(String modulePath) {
        try {
            URL[] urls = {new File(modulePath).toURI().toURL()};
            this.moduleClassLoader = new URLClassLoader(urls, 
                Thread.currentThread().getContextClassLoader());
        } catch (Exception e) {
            throw new RuntimeException("æ¨¡å—åŠ è½½å™¨åˆå§‹åŒ–å¤±è´¥", e);
        }
    }
    
    public Class<?> loadModuleClass(String className) throws ClassNotFoundException {
        return moduleClassLoader.loadClass(className);
    }
}

// 2. Springæ¡†æ¶é£æ ¼çš„ç±»åŠ è½½
public class BeanClassLoader {
    public Class<?> loadBeanClass(String className) {
        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();
        try {
            // å…ˆå°è¯•ç”¨ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨
            return contextClassLoader.loadClass(className);
        } catch (ClassNotFoundException e) {
            try {
                // å†å°è¯•ç”¨å½“å‰ç±»çš„ç±»åŠ è½½å™¨
                return getClass().getClassLoader().loadClass(className);
            } catch (ClassNotFoundException ex) {
                // æœ€åå°è¯•ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨
                try {
                    return ClassLoader.getSystemClassLoader().loadClass(className);
                } catch (ClassNotFoundException finalEx) {
                    throw new RuntimeException("æ— æ³•åŠ è½½ç±»ï¼š" + className, finalEx);
                }
            }
        }
    }
}

// 3. çƒ­éƒ¨ç½²åœºæ™¯
public class HotDeployClassLoader extends ClassLoader {
    private final String classPath;
    
    public HotDeployClassLoader(String classPath) {
        super(Thread.currentThread().getContextClassLoader());
        this.classPath = classPath;
    }
    
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        try {
            byte[] classBytes = loadClassBytes(name);
            return defineClass(name, classBytes, 0, classBytes.length);
        } catch (Exception e) {
            throw new ClassNotFoundException("çƒ­éƒ¨ç½²åŠ è½½å¤±è´¥ï¼š" + name, e);
        }
    }
    
    private byte[] loadClassBytes(String className) throws IOException {
        String classFile = classPath + "/" + className.replace('.', '/') + ".class";
        return Files.readAllBytes(Paths.get(classFile));
    }
}
```

---

## 5. ğŸ“Š å››ç§æ–¹å¼å¯¹æ¯”æ€»ç»“


### 5.1 å…¨é¢å¯¹æ¯”è¡¨


**ğŸ“‹ å››ç§æ–¹å¼ç‰¹æ€§å¯¹æ¯”**

| æ–¹å¼ | **æ˜¯å¦éœ€è¦å¯¹è±¡** | **æ˜¯å¦è§¦å‘ç±»åˆå§‹åŒ–** | **ç¼–è¯‘æœŸ/è¿è¡ŒæœŸ** | **æ˜¯å¦æ”¯æŒåŠ¨æ€åŠ è½½** | **æ˜¯å¦ç±»å‹å®‰å…¨** | **é€‚ç”¨åœºæ™¯** |
|-----|----------------|-------------------|-----------------|------------------|----------------|-------------|
| `ç±»å.class` | âŒ å¦ | âŒ å¦ | ç¼–è¯‘æœŸ | âŒ å¦ | âœ… æ˜¯ | å·²çŸ¥ç±»çš„å¸¸é‡å¼•ç”¨ï¼Œæ€§èƒ½æœ€ä½³ |
| `obj.getClass()` | âœ… æ˜¯ | âŒ å¦ | è¿è¡ŒæœŸ | âŒ å¦ | âœ… æ˜¯ | è·å–å¯¹è±¡è¿è¡Œæ—¶å®é™…ç±»å‹ï¼Œé€‚ç”¨äºå¤šæ€åˆ¤æ–­ |
| `Class.forName("ç±»å")` | âŒ å¦ | âœ… æ˜¯ | è¿è¡ŒæœŸ | âœ… æ˜¯ | âŒ å¦ï¼ˆä¾èµ–å­—ç¬¦ä¸²ï¼‰ | æ¡†æ¶/é…ç½®é©±åŠ¨çš„ç±»åŠ¨æ€åŠ è½½ï¼ˆå¦‚JDBCï¼‰ |
| `ClassLoader.loadClass()` | âŒ å¦ | âŒ å¦ | è¿è¡ŒæœŸ | âœ… æ˜¯ | âŒ å¦ï¼ˆä¾èµ–å­—ç¬¦ä¸²ï¼‰ | æ¨¡å—éš”ç¦»ã€è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€çƒ­éƒ¨ç½²/æ’ä»¶æ¶æ„ |

### 5.2 æ€§èƒ½å¯¹æ¯”


**âš¡ æ€§èƒ½æ’åºï¼ˆä»å¿«åˆ°æ…¢ï¼‰**
```
æ€§èƒ½å¯¹æ¯”åˆ†æ
â”œâ”€â”€ 1. ç±»å.classï¼ˆæœ€å¿«ï¼‰
â”‚   â”œâ”€â”€ ç¼–è¯‘æ—¶ç¡®å®šï¼Œæ— è¿è¡Œæ—¶å¼€é”€
â”‚   â””â”€â”€ ç›´æ¥è·å–ï¼Œæ— éœ€å­—ç¬¦ä¸²è§£æ
â”‚
â”œâ”€â”€ 2. obj.getClass()ï¼ˆè¾ƒå¿«ï¼‰
â”‚   â”œâ”€â”€ ç®€å•çš„å¯¹è±¡æ–¹æ³•è°ƒç”¨
â”‚   â””â”€â”€ æ— éœ€ç±»åŠ è½½è¿‡ç¨‹
â”‚
â”œâ”€â”€ 3. ClassLoader.loadClass()ï¼ˆè¾ƒæ…¢ï¼‰
â”‚   â”œâ”€â”€ éœ€è¦å­—ç¬¦ä¸²è§£æå’Œç±»åŠ è½½
â”‚   â””â”€â”€ ä¸è§¦å‘ç±»åˆå§‹åŒ–ï¼Œç›¸å¯¹è¾ƒå¿«
â”‚
â””â”€â”€ 4. Class.forName()ï¼ˆæœ€æ…¢ï¼‰
    â”œâ”€â”€ éœ€è¦å­—ç¬¦ä¸²è§£æå’Œç±»åŠ è½½
    â””â”€â”€ é»˜è®¤è§¦å‘ç±»åˆå§‹åŒ–ï¼Œå¼€é”€æœ€å¤§
```

### 5.3 ä½¿ç”¨åœºæ™¯å†³ç­–æ ‘


**ğŸŒ³ é€‰æ‹©å†³ç­–æµç¨‹**
```
Classå¯¹è±¡è·å–æ–¹å¼é€‰æ‹©å†³ç­–æ ‘
â”œâ”€â”€ æ˜¯å¦å·²çŸ¥å…·ä½“ç±»åï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ ä½¿ç”¨ ç±»å.class
â”‚   â”‚   â””â”€â”€ ä¼˜åŠ¿ï¼šæ€§èƒ½æœ€ä½³ï¼Œç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æœŸæ£€æŸ¥
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­
â”‚
â”œâ”€â”€ æ˜¯å¦å·²æœ‰å¯¹è±¡å®ä¾‹ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ ä½¿ç”¨ obj.getClass()
â”‚   â”‚   â””â”€â”€ ä¼˜åŠ¿ï¼šè·å–è¿è¡Œæ—¶å®é™…ç±»å‹ï¼Œæ”¯æŒå¤šæ€
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­
â”‚
â”œâ”€â”€ æ˜¯å¦éœ€è¦ç±»åˆå§‹åŒ–ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ ä½¿ç”¨ Class.forName()
â”‚   â”‚   â””â”€â”€ é€‚ç”¨ï¼šJDBCé©±åŠ¨åŠ è½½ï¼Œéœ€è¦æ‰§è¡Œé™æ€ä»£ç å—
â”‚   â””â”€â”€ å¦ â†’ ä½¿ç”¨ ClassLoader.loadClass()
â”‚       â””â”€â”€ é€‚ç”¨ï¼šæ¨¡å—åŒ–åŠ è½½ï¼Œé¿å…å‰¯ä½œç”¨
```

### 5.4 å¼‚å¸¸å¤„ç†å¯¹æ¯”


**âš ï¸ å¼‚å¸¸å¤„ç†ç­–ç•¥**

| æ–¹å¼ | **å¯èƒ½çš„å¼‚å¸¸** | **å¤„ç†å»ºè®®** |
|-----|---------------|-------------|
| `ç±»å.class` | æ— ï¼ˆç¼–è¯‘æœŸæ£€æŸ¥ï¼‰ | æ— éœ€å¤„ç† |
| `obj.getClass()` | `NullPointerException` | åˆ¤ç©ºå¤„ç† |
| `Class.forName()` | `ClassNotFoundException` | try-catch + æ—¥å¿—è®°å½• |
| `ClassLoader.loadClass()` | `ClassNotFoundException` | try-catch + é™çº§ç­–ç•¥ |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å››ç§è·å–æ–¹å¼ï¼šç±»å.classã€å¯¹è±¡.getClass()ã€Class.forName()ã€ClassLoader.loadClass()
ğŸ”¸ åˆå§‹åŒ–å·®å¼‚ï¼šåªæœ‰Class.forName()é»˜è®¤ä¼šè§¦å‘ç±»åˆå§‹åŒ–
ğŸ”¸ æ€§èƒ½å·®å¼‚ï¼šç±»å.class > å¯¹è±¡.getClass() > ClassLoader.loadClass() > Class.forName()
ğŸ”¸ åŠ¨æ€æ€§å·®å¼‚ï¼šå‰ä¸¤ç§é™æ€ï¼Œåä¸¤ç§æ”¯æŒåŠ¨æ€å­—ç¬¦ä¸²åŠ è½½
ğŸ”¸ ç±»å‹å®‰å…¨ï¼šå‰ä¸¤ç§ç¼–è¯‘æœŸå®‰å…¨ï¼Œåä¸¤ç§ä¾èµ–å­—ç¬¦ä¸²è¿è¡ŒæœŸæ£€æŸ¥
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç±»åˆå§‹åŒ–çš„é‡è¦æ€§**
```
ç±»åˆå§‹åŒ–å½±å“ï¼š
â€¢ Class.forName()ä¼šæ‰§è¡Œé™æ€ä»£ç å—
â€¢ å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨ï¼ˆå¦‚æ³¨å†Œé©±åŠ¨ã€åˆå§‹åŒ–å•ä¾‹ç­‰ï¼‰
â€¢ ClassLoader.loadClass()ä¸ä¼šåˆå§‹åŒ–ï¼Œæ›´å®‰å…¨
â€¢ æ¡†æ¶å¼€å‘ä¸­éœ€è¦æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹å¼

åˆå§‹åŒ–æ§åˆ¶ï¼š
â€¢ Class.forName(name, false, loader) - ä¸åˆå§‹åŒ–
â€¢ Class.forName(name, true, loader) - å¼ºåˆ¶åˆå§‹åŒ–
â€¢ ClassLoader.loadClass(name) - é»˜è®¤ä¸åˆå§‹åŒ–
```

**ğŸ”¹ ç±»åŠ è½½å™¨çš„é‡è¦ä½œç”¨**
```
ç±»åŠ è½½å™¨çš„ä»·å€¼ï¼š
â€¢ æä¾›ç±»éš”ç¦»æœºåˆ¶ï¼Œé¿å…ç±»å†²çª
â€¢ æ”¯æŒçƒ­éƒ¨ç½²å’Œæ’ä»¶ç³»ç»Ÿ
â€¢ å®ç°è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘
â€¢ æ§åˆ¶ç±»çš„åŠ è½½æ—¶æœºå’Œæ–¹å¼

åŒäº²å§”æ´¾æ¨¡å‹ï¼š
â€¢ ä¿è¯æ ¸å¿ƒç±»çš„å®‰å…¨æ€§
â€¢ é¿å…ç±»çš„é‡å¤åŠ è½½
â€¢ ç»´æŠ¤ç±»åŠ è½½çš„å±‚æ¬¡ç»“æ„
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ é€‰æ‹©åŸåˆ™**
- âœ… **å·²çŸ¥ç±»å‹**ï¼šä¼˜å…ˆä½¿ç”¨`ç±»å.class`ï¼Œæ€§èƒ½æœ€ä½³ä¸”ç±»å‹å®‰å…¨
- âœ… **å¤šæ€åœºæ™¯**ï¼šä½¿ç”¨`obj.getClass()`è·å–è¿è¡Œæ—¶å®é™…ç±»å‹
- âœ… **é…ç½®é©±åŠ¨**ï¼šä½¿ç”¨`Class.forName()`è¿›è¡ŒåŠ¨æ€åŠ è½½
- âœ… **æ¡†æ¶å¼€å‘**ï¼šä½¿ç”¨`ClassLoader.loadClass()`å®ç°æ¨¡å—åŒ–å’Œéš”ç¦»

**ğŸ¯ æœ€ä½³å®è·µ**
```java
// 1. å·¥å…·æ–¹æ³•ä¸­çš„ç±»å‹åˆ¤æ–­
public boolean isInstanceOf(Object obj, Class<?> targetClass) {
    return obj != null && targetClass.isInstance(obj);
}

// 2. å®‰å…¨çš„åŠ¨æ€ç±»åŠ è½½
public Class<?> loadClassSafely(String className) {
    try {
        return Thread.currentThread().getContextClassLoader().loadClass(className);
    } catch (ClassNotFoundException e) {
        try {
            return Class.forName(className);
        } catch (ClassNotFoundException ex) {
            return null; // æˆ–æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸
        }
    }
}

// 3. æ³›å‹å‹å¥½çš„ç±»å¼•ç”¨
public <T> T createInstance(Class<T> clazz) throws Exception {
    return clazz.getDeclaredConstructor().newInstance();
}
```
