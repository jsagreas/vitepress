---
title: 6ã€æ³¨è§£ä½¿ç”¨æ³¨æ„äº‹é¡¹
---
## ğŸ“š ç›®å½•

1. [æ³¨è§£å±æ€§çš„ç±»å‹é™åˆ¶](#1-æ³¨è§£å±æ€§çš„ç±»å‹é™åˆ¶)
2. [æ³¨è§£å…ƒç´ è¯­æ³•é™åˆ¶](#2-æ³¨è§£å…ƒç´ è¯­æ³•é™åˆ¶)
3. [é»˜è®¤å€¼çš„ä½¿ç”¨é™åˆ¶](#3-é»˜è®¤å€¼çš„ä½¿ç”¨é™åˆ¶)
4. [ä¿ç•™ç­–ç•¥ä¸ç”Ÿå‘½å‘¨æœŸ](#4-ä¿ç•™ç­–ç•¥ä¸ç”Ÿå‘½å‘¨æœŸ)
5. [æ³¨è§£é‡å¤å®šä¹‰é—®é¢˜](#5-æ³¨è§£é‡å¤å®šä¹‰é—®é¢˜)
6. [é…ç½®å†²çªä¸ä¼˜å…ˆçº§](#6-é…ç½®å†²çªä¸ä¼˜å…ˆçº§)
7. [è‡ªå®šä¹‰æ³¨è§£æ˜“é”™ç‚¹](#7-è‡ªå®šä¹‰æ³¨è§£æ˜“é”™ç‚¹)
8. [æ€§èƒ½ä¸å®‰å…¨è€ƒè™‘](#8-æ€§èƒ½ä¸å®‰å…¨è€ƒè™‘)
9. [æœ€ä½³å®è·µå»ºè®®](#9-æœ€ä½³å®è·µå»ºè®®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ³¨è§£å±æ€§çš„ç±»å‹é™åˆ¶


### 1.1 æ”¯æŒçš„æ•°æ®ç±»å‹

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataTypeDemo {
    
    // âœ… åŸºæœ¬æ•°æ®ç±»å‹
    int count() default 1;
    boolean enabled() default true;
    float rate() default 0.0f;
    double percentage() default 0.0d;
    char symbol() default 'A';
    byte flag() default 0;
    short level() default 100;
    long timestamp() default 0L;
    
    // âœ… å­—ç¬¦ä¸²ç±»å‹
    String name() default "";
    
    // âœ… æšä¸¾ç±»å‹
    Priority priority() default Priority.MEDIUM;
    
    // âœ… Classç±»å‹
    Class<?> targetClass() default Object.class;
    Class<? extends Exception> exceptionType() default RuntimeException.class;
    
    // âœ… æ³¨è§£ç±»å‹ï¼ˆåµŒå¥—æ³¨è§£ï¼‰
    Range range() default @Range(min = 0, max = 100);
    
    // âœ… æ•°ç»„ç±»å‹
    String[] tags() default {};
    int[] numbers() default {1, 2, 3};
    Priority[] priorities() default {Priority.HIGH, Priority.MEDIUM};
    Class<?>[] classes() default {};
}

enum Priority {
    LOW, MEDIUM, HIGH
}

@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@interface Range {
    int min();
    int max();
}
```

### 1.2 ä¸æ”¯æŒçš„æ•°æ®ç±»å‹

```java
public @interface UnsupportedTypes {
    
    // âŒ é›†åˆç±»å‹
    // List<String> items();           // ç¼–è¯‘é”™è¯¯
    // Map<String, Object> config();   // ç¼–è¯‘é”™è¯¯
    // Set<Integer> numbers();         // ç¼–è¯‘é”™è¯¯
    
    // âŒ è‡ªå®šä¹‰å¯¹è±¡ç±»å‹
    // Date createTime();              // ç¼–è¯‘é”™è¯¯
    // BigDecimal amount();            // ç¼–è¯‘é”™è¯¯
    // StringBuilder buffer();         // ç¼–è¯‘é”™è¯¯
    
    // âŒ æ³›å‹å‚æ•°ç±»å‹
    // List<String> genericList();     // ç¼–è¯‘é”™è¯¯
    // Optional<String> optionalValue(); // ç¼–è¯‘é”™è¯¯
    
    // âŒ æ¥å£ç±»å‹ï¼ˆé™¤æ³¨è§£å¤–ï¼‰
    // Runnable task();                // ç¼–è¯‘é”™è¯¯
    // Serializable data();            // ç¼–è¯‘é”™è¯¯
}
```

### 1.3 ç±»å‹é™åˆ¶å¯¹æ¯”è¡¨


| **ç±»å‹åˆ†ç±»** | **æ”¯æŒæƒ…å†µ** | **ç¤ºä¾‹** | **è¯´æ˜** |
|------------|------------|---------|---------|
| `åŸºæœ¬ç±»å‹` | `âœ… æ”¯æŒ` | `int, boolean, char` | `æ‰€æœ‰8ç§åŸºæœ¬ç±»å‹éƒ½æ”¯æŒ` |
| `String` | `âœ… æ”¯æŒ` | `String name()` | `å­—ç¬¦ä¸²æ˜¯å”¯ä¸€æ”¯æŒçš„å¼•ç”¨ç±»å‹` |
| `æšä¸¾` | `âœ… æ”¯æŒ` | `Priority.HIGH` | `å¿…é¡»æ˜¯å…·ä½“çš„æšä¸¾å€¼` |
| `Class` | `âœ… æ”¯æŒ` | `Class<?> clazz` | `å¯ä»¥ä½¿ç”¨é€šé…ç¬¦å’Œæ³›å‹çº¦æŸ` |
| `æ³¨è§£` | `âœ… æ”¯æŒ` | `@Range(min=1, max=10)` | `æ”¯æŒåµŒå¥—æ³¨è§£` |
| `æ•°ç»„` | `âœ… æ”¯æŒ` | `String[] tags` | `ä¸Šè¿°ç±»å‹çš„æ•°ç»„å½¢å¼` |
| `é›†åˆ` | `âŒ ä¸æ”¯æŒ` | `List<String>` | `Javaæ³¨è§£è®¾è®¡é™åˆ¶` |
| `è‡ªå®šä¹‰å¯¹è±¡` | `âŒ ä¸æ”¯æŒ` | `Date, BigDecimal` | `éç¼–è¯‘æœŸå¸¸é‡` |

---

## 2. ğŸ“ æ³¨è§£å…ƒç´ è¯­æ³•é™åˆ¶


### 2.1 æ–¹æ³•ä½“é™åˆ¶

```java
public @interface SyntaxDemo {
    
    // âœ… æ­£ç¡®ï¼šåªæœ‰æ–¹æ³•ç­¾å
    String value();
    int count() default 1;
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½åŒ…å«æ–¹æ³•ä½“
    /*
    String getName() {
        return "default";  // ç¼–è¯‘é”™è¯¯
    }
    */
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½æŠ›å‡ºå¼‚å¸¸
    /*
    String getData() throws Exception;  // ç¼–è¯‘é”™è¯¯
    */
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½åŒ…å«æ§åˆ¶è¯­å¥
    /*
    default String process() {
        if (condition) {     // ç¼–è¯‘é”™è¯¯
            return "yes";
        }
        return "no";
    }
    */
}
```

### 2.2 å…¶ä»–è¯­æ³•é™åˆ¶

```java
public @interface RestrictionsDemo {
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½å®šä¹‰å­—æ®µ
    // public static final String CONSTANT = "value";  // ç¼–è¯‘é”™è¯¯
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½å®šä¹‰æ„é€ å™¨
    // public RestrictionsDemo() { }  // ç¼–è¯‘é”™è¯¯
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½ç»§æ‰¿å…¶ä»–æ¥å£
    // public @interface RestrictionsDemo extends Serializable { }  // ç¼–è¯‘é”™è¯¯
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½ä½¿ç”¨æ³›å‹
    // public @interface RestrictionsDemo<T> { }  // ç¼–è¯‘é”™è¯¯
    
    // âœ… æ­£ç¡®ï¼šåªèƒ½å®šä¹‰æŠ½è±¡æ–¹æ³•
    String value();
    int level() default 1;
}
```

---

## 3. âš ï¸ é»˜è®¤å€¼çš„ä½¿ç”¨é™åˆ¶


### 3.1 nullå€¼é™åˆ¶

```java
public @interface DefaultValueDemo {
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½ä½¿ç”¨nullä½œä¸ºé»˜è®¤å€¼
    // String name() default null;  // ç¼–è¯‘é”™è¯¯
    
    // âœ… æ­£ç¡®ï¼šä½¿ç”¨ç©ºå­—ç¬¦ä¸²æˆ–ç‰¹æ®Šæ ‡è®°
    String name() default "";
    String description() default "N/A";
    
    // âœ… å¯¹äºæ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ç©ºæ•°ç»„
    String[] tags() default {};
    int[] numbers() default {};
    
    // âœ… å¯¹äºClassç±»å‹ï¼Œä½¿ç”¨Object.classæˆ–void.classä½œä¸ºæ ‡è®°
    Class<?> targetClass() default Object.class;
    Class<?> defaultType() default void.class;  // å¸¸ç”¨ä½œ"æœªæŒ‡å®š"æ ‡è®°
}
```

### 3.2 å¸¸é‡å¼•ç”¨é™åˆ¶

```java
public class Constants {
    public static final int DEFAULT_TIMEOUT = 30;
    public static final String DEFAULT_NAME = "default";
}

public @interface ConstantDemo {
    
    // âŒ é”™è¯¯ï¼šä¸èƒ½å¼•ç”¨å¤–éƒ¨å¸¸é‡
    // int timeout() default Constants.DEFAULT_TIMEOUT;  // ç¼–è¯‘é”™è¯¯
    // String name() default Constants.DEFAULT_NAME;     // ç¼–è¯‘é”™è¯¯
    
    // âœ… æ­£ç¡®ï¼šå¿…é¡»æ˜¯å­—é¢é‡å¸¸é‡
    int timeout() default 30;
    String name() default "default";
    
    // âœ… æ­£ç¡®ï¼šå¯ä»¥ä½¿ç”¨ç¼–è¯‘æœŸå¸¸é‡è¡¨è¾¾å¼
    int maxValue() default Integer.MAX_VALUE;
    long currentTime() default 1000L * 60 * 60 * 24;  // ä¸€å¤©çš„æ¯«ç§’æ•°
}
```

### 3.3 å¤æ‚é»˜è®¤å€¼å¤„ç†

```java
public @interface ComplexDefaultDemo {
    
    // âœ… æ•°ç»„é»˜è®¤å€¼
    String[] permissions() default {"read", "write"};
    int[] sizes() default {10, 20, 30};
    
    // âœ… åµŒå¥—æ³¨è§£é»˜è®¤å€¼
    Range range() default @Range(min = 0, max = 100);
    
    // âœ… æšä¸¾é»˜è®¤å€¼
    Priority priority() default Priority.MEDIUM;
    
    // âœ… Classé»˜è®¤å€¼
    Class<? extends Exception> exceptionType() default RuntimeException.class;
    
    // ğŸ’¡ å»ºè®®ï¼šå¯¹äºå¤æ‚é»˜è®¤å€¼ï¼Œä½¿ç”¨è¾…åŠ©æ–¹æ³•æˆ–å·¥å…·ç±»å¤„ç†
    String config() default "default-config.properties";
}

// å¤„ç†å¤æ‚é»˜è®¤å€¼çš„å·¥å…·ç±»
public class AnnotationDefaults {
    
    public static final String DEFAULT_CONFIG = "application.properties";
    public static final String[] DEFAULT_ROLES = {"user"};
    
    public static boolean isDefaultValue(String value) {
        return "".equals(value) || "N/A".equals(value);
    }
    
    public static boolean isDefaultClass(Class<?> clazz) {
        return Object.class.equals(clazz) || void.class.equals(clazz);
    }
}
```

---

## 4. ğŸ”„ ä¿ç•™ç­–ç•¥ä¸ç”Ÿå‘½å‘¨æœŸ


### 4.1 ä¿ç•™ç­–ç•¥è¯¦è§£

```java
// SOURCEï¼šä»…åœ¨æºç é˜¶æ®µä¿ç•™
@Retention(RetentionPolicy.SOURCE)
@Target(ElementType.METHOD)
public @interface SourceOnly {
    String value();
}

// CLASSï¼šä¿ç•™åˆ°å­—èŠ‚ç ï¼Œä½†è¿è¡Œæ—¶ä¸å¯è§ï¼ˆé»˜è®¤ç­–ç•¥ï¼‰
@Retention(RetentionPolicy.CLASS)
@Target(ElementType.FIELD)
public @interface ClassLevel {
    String value();
}

// RUNTIMEï¼šè¿è¡Œæ—¶å¯é€šè¿‡åå°„è®¿é—®
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface RuntimeAccessible {
    String value();
}
```

### 4.2 ä¿ç•™ç­–ç•¥å¯¹æ¯”

```java
public class RetentionPolicyDemo {
    
    @SourceOnly("æºç æ³¨è§£")
    @ClassLevel("å­—èŠ‚ç æ³¨è§£")
    @RuntimeAccessible("è¿è¡Œæ—¶æ³¨è§£")
    public class TestClass {
        
        @ClassLevel("å­—æ®µæ³¨è§£")
        private String field;
        
        @SourceOnly("æ–¹æ³•æ³¨è§£")
        public void method() {}
    }
    
    public static void testRetentionPolicy() throws Exception {
        Class<TestClass> clazz = TestClass.class;
        
        // åªæœ‰RUNTIMEæ³¨è§£å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–
        RuntimeAccessible runtime = clazz.getAnnotation(RuntimeAccessible.class);
        ClassLevel classLevel = clazz.getAnnotation(ClassLevel.class);
        SourceOnly source = clazz.getAnnotation(SourceOnly.class);
        
        System.out.println("RUNTIMEæ³¨è§£ï¼š" + (runtime != null ? runtime.value() : "null"));     // è¿è¡Œæ—¶æ³¨è§£
        System.out.println("CLASSæ³¨è§£ï¼š" + (classLevel != null ? classLevel.value() : "null")); // null
        System.out.println("SOURCEæ³¨è§£ï¼š" + (source != null ? source.value() : "null"));        // null
    }
}
```

### 4.3 å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

```java
// âŒ å¸¸è§é”™è¯¯ï¼šå¿˜è®°è®¾ç½®ä¿ç•™ç­–ç•¥
public @interface WrongAnnotation {
    String value();
    // é»˜è®¤æ˜¯RetentionPolicy.CLASSï¼Œè¿è¡Œæ—¶æ— æ³•åå°„è®¿é—®
}

// âœ… æ­£ç¡®åšæ³•ï¼šæ˜ç¡®æŒ‡å®šä¿ç•™ç­–ç•¥
@Retention(RetentionPolicy.RUNTIME)  // æ˜ç¡®æŒ‡å®š
public @interface CorrectAnnotation {
    String value();
}

// ä¿ç•™ç­–ç•¥é€‰æ‹©æŒ‡å—
public class RetentionGuide {
    
    /**
     * é€‰æ‹©SOURCEï¼š
     * - ç¼–è¯‘æ£€æŸ¥ï¼ˆå¦‚@Overrideï¼‰
     * - ä»£ç ç”Ÿæˆï¼ˆå¦‚Lombokï¼‰
     * - IDEæç¤ºå’Œè­¦å‘Š
     */
    @Retention(RetentionPolicy.SOURCE)
    public @interface CompileTimeOnly {
        String hint();
    }
    
    /**
     * é€‰æ‹©CLASSï¼š
     * - å­—èŠ‚ç å¢å¼º
     * - APTå¤„ç†å™¨
     * - æ¡†æ¶å¯åŠ¨æ—¶æ‰«æï¼ˆä¸éœ€è¦è¿è¡Œæ—¶è®¿é—®ï¼‰
     */
    @Retention(RetentionPolicy.CLASS)
    public @interface BytecodeProcessing {
        String instruction();
    }
    
    /**
     * é€‰æ‹©RUNTIMEï¼š
     * - åå°„å¤„ç†
     * - AOPåˆ‡é¢
     * - é…ç½®ç»‘å®š
     * - å¤§éƒ¨åˆ†ä¸šåŠ¡æ³¨è§£
     */
    @Retention(RetentionPolicy.RUNTIME)
    public @interface BusinessLogic {
        String operation();
    }
}
```

---

## 5. ğŸ” æ³¨è§£é‡å¤å®šä¹‰é—®é¢˜


### 5.1 Java 8ä¹‹å‰çš„é™åˆ¶

```java
// Java 8ä¹‹å‰ä¸æ”¯æŒé‡å¤æ³¨è§£
public class OldVersionDemo {
    
    // âŒ åœ¨Java 8ä¹‹å‰è¿™æ ·å†™ä¼šç¼–è¯‘é”™è¯¯
    /*
    @Role("admin")
    @Role("user")        // ç¼–è¯‘é”™è¯¯ï¼šé‡å¤æ³¨è§£
    public void method() {}
    */
    
    // âœ… åªèƒ½ä½¿ç”¨å®¹å™¨æ³¨è§£çš„æ–¹å¼
    @Roles({@Role("admin"), @Role("user")})
    public void method() {}
}

@interface Role {
    String value();
}

@interface Roles {
    Role[] value();
}
```

### 5.2 Java 8+é‡å¤æ³¨è§£æ”¯æŒ

```java
// å®šä¹‰å¯é‡å¤æ³¨è§£
@Repeatable(Roles.class)  // æŒ‡å®šå®¹å™¨æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Role {
    String value();
    int priority() default 1;
}

// å®¹å™¨æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Roles {
    Role[] value();
}

// ä½¿ç”¨é‡å¤æ³¨è§£
public class RepeatableDemo {
    
    // âœ… ç°ä»£å†™æ³•ï¼šç›´æ¥é‡å¤ä½¿ç”¨
    @Role("admin")
    @Role("user")
    @Role("guest")
    public void modernSyntax() {}
    
    // âœ… ä¼ ç»Ÿå†™æ³•ï¼šä»ç„¶æ”¯æŒ
    @Roles({
        @Role(value = "admin", priority = 3),
        @Role(value = "user", priority = 2),
        @Role(value = "guest", priority = 1)
    })
    public void traditionalSyntax() {}
    
    // å¤„ç†é‡å¤æ³¨è§£
    public static void processRoles(Method method) {
        // æ–¹å¼1ï¼šè·å–é‡å¤æ³¨è§£
        Role[] roles = method.getAnnotationsByType(Role.class);
        for (Role role : roles) {
            System.out.println("è§’è‰²ï¼š" + role.value() + "ï¼Œä¼˜å…ˆçº§ï¼š" + role.priority());
        }
        
        // æ–¹å¼2ï¼šè·å–å®¹å™¨æ³¨è§£
        Roles rolesContainer = method.getAnnotation(Roles.class);
        if (rolesContainer != null) {
            for (Role role : rolesContainer.value()) {
                System.out.println("å®¹å™¨ä¸­çš„è§’è‰²ï¼š" + role.value());
            }
        }
    }
}
```

### 5.3 é‡å¤æ³¨è§£çš„æ³¨æ„äº‹é¡¹

```java
public class RepeatableIssues {
    
    // âš ï¸ æ³¨æ„ï¼šä¸è¦æ··ç”¨é‡å¤æ³¨è§£å’Œå®¹å™¨æ³¨è§£
    // âŒ é”™è¯¯ç¤ºä¾‹
    /*
    @Role("admin")
    @Roles({@Role("user"), @Role("guest")})  // ä¼šå¯¼è‡´æ··ä¹±
    public void confusingMethod() {}
    */
    
    // âœ… æ­£ç¡®ï¼šä¿æŒä¸€è‡´çš„é£æ ¼
    @Role("admin")
    @Role("user")
    @Role("guest")
    public void consistentMethod() {}
    
    // ğŸ’¡ å¤„ç†é‡å¤æ³¨è§£çš„å®Œæ•´ç¤ºä¾‹
    public static void handleRepeatableAnnotations(Method method) {
        Role[] directRoles = method.getAnnotationsByType(Role.class);
        Roles containerRoles = method.getAnnotation(Roles.class);
        
        if (directRoles.length > 0) {
            System.out.println("æ‰¾åˆ° " + directRoles.length + " ä¸ªè§’è‰²ï¼š");
            for (Role role : directRoles) {
                System.out.println("  - " + role.value() + " (ä¼˜å…ˆçº§: " + role.priority() + ")");
            }
        }
        
        // æ³¨æ„ï¼šå½“ä½¿ç”¨getAnnotationsByTypeæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç†å®¹å™¨æ³¨è§£
        // æ‰€ä»¥é€šå¸¸åªéœ€è¦ä½¿ç”¨getAnnotationsByTypeå³å¯
    }
}
```

---

## 6. âš–ï¸ é…ç½®å†²çªä¸ä¼˜å…ˆçº§


### 6.1 æ³¨è§£ä¸é…ç½®æ–‡ä»¶å†²çª

```java
// é…ç½®å†²çªç¤ºä¾‹
@Component
@Service("userService")  // æ³¨è§£é…ç½®
public class UserService {
    
    @Value("${app.name:DefaultApp}")  // å¤–éƒ¨é…ç½®ä¼˜å…ˆ
    private String appName;
    
    @Autowired
    @Qualifier("primaryDataSource")   // æ³¨è§£æŒ‡å®šå…·ä½“Bean
    private DataSource dataSource;
}

// å¯¹åº”çš„é…ç½®æ–‡ä»¶ application.yml
/*
app:
  name: "MyApplication"  # ä¼šè¦†ç›–æ³¨è§£ä¸­çš„é»˜è®¤å€¼

spring:
  datasource:
    primary:
      url: jdbc:mysql://localhost:3306/primary
    secondary:
      url: jdbc:mysql://localhost:3306/secondary
*/
```

### 6.2 ä¼˜å…ˆçº§è§„åˆ™

```java
public class PriorityRules {
    
    /**
     * Springæ¡†æ¶ä¸­çš„ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
     * 1. å‘½ä»¤è¡Œå‚æ•°
     * 2. ç³»ç»Ÿå±æ€§ï¼ˆSystem.getProperty()ï¼‰
     * 3. æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡
     * 4. application.properties/ymlé…ç½®æ–‡ä»¶
     * 5. @PropertySourceæŒ‡å®šçš„é…ç½®æ–‡ä»¶
     * 6. @Valueæ³¨è§£ä¸­çš„é»˜è®¤å€¼
     */
    
    @Value("${server.port:8080}")  // é»˜è®¤å€¼æœ€ä½ä¼˜å…ˆçº§
    private int serverPort;
    
    // âœ… æ¨èï¼šæ˜ç¡®é…ç½®æ¥æºå’Œä¼˜å…ˆçº§
    @Component
    @ConditionalOnProperty(name = "feature.enabled", havingValue = "true")
    public class FeatureService {
        // åªæœ‰å½“é…ç½®é¡¹feature.enabled=trueæ—¶æ‰ç”Ÿæ•ˆ
    }
    
    // âš ï¸ æ³¨æ„ï¼šé¿å…å¾ªç¯ä¾èµ–
    @Configuration
    public class ConfigDemo {
        
        @Bean
        @Primary  // ä¸»è¦Beanï¼Œä¼˜å…ˆçº§æœ€é«˜
        public DataSource primaryDataSource() {
            return new HikariDataSource();
        }
        
        @Bean
        @Qualifier("secondary")  // å¤‡ç”¨Bean
        public DataSource secondaryDataSource() {
            return new HikariDataSource();
        }
    }
}
```

### 6.3 é…ç½®å†²çªè§£å†³ç­–ç•¥

```java
@Configuration
public class ConflictResolution {
    
    // ç­–ç•¥1ï¼šä½¿ç”¨@ConditionalOn*æ³¨è§£æ§åˆ¶åŠ è½½æ¡ä»¶
    @Bean
    @ConditionalOnMissingBean(DataSource.class)
    public DataSource defaultDataSource() {
        return new EmbeddedDataSource();  // åªæœ‰æ²¡æœ‰å…¶ä»–DataSourceæ—¶æ‰åˆ›å»º
    }
    
    // ç­–ç•¥2ï¼šä½¿ç”¨@Profileç¯å¢ƒé…ç½®
    @Bean
    @Profile("dev")
    public DataSource devDataSource() {
        return new H2DataSource();
    }
    
    @Bean
    @Profile("prod")
    public DataSource prodDataSource() {
        return new MySQLDataSource();
    }
    
    // ç­–ç•¥3ï¼šä½¿ç”¨é…ç½®å±æ€§ç±»ç»Ÿä¸€ç®¡ç†
    @ConfigurationProperties(prefix = "app.datasource")
    @Component
    public class DataSourceProperties {
        private String url;
        private String username;
        private String password;
        
        // getter/setterçœç•¥
    }
    
    // ç­–ç•¥4ï¼šæ˜ç¡®æŒ‡å®šåŠ è½½é¡ºåº
    @Order(1)  // æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    @Component
    public class HighPriorityComponent {
        // é«˜ä¼˜å…ˆçº§ç»„ä»¶
    }
    
    @Order(2)
    @Component
    public class LowPriorityComponent {
        // ä½ä¼˜å…ˆçº§ç»„ä»¶
    }
}
```

---

## 7. ğŸš¨ è‡ªå®šä¹‰æ³¨è§£æ˜“é”™ç‚¹


### 7.1 å‘½åä¸ä½œç”¨åŸŸé—®é¢˜

```java
// âŒ é”™è¯¯ï¼šä¸æ ‡å‡†æ³¨è§£å‘½åå†²çª
/*
public @interface Override {  // ä¸java.lang.Overrideå†²çª
    String value();
}
*/

// âŒ é”™è¯¯ï¼šä½œç”¨åŸŸè®¾ç½®ä¸å½“
@Target(ElementType.TYPE)  // åªèƒ½ç”¨äºç±»
@Retention(RetentionPolicy.RUNTIME)
public @interface MethodOnlyAnnotation {
    String operation();
}

public class WrongUsage {
    // âŒ ç¼–è¯‘é”™è¯¯ï¼šæ³¨è§£åªèƒ½ç”¨äºç±»ï¼Œä¸èƒ½ç”¨äºæ–¹æ³•
    /*
    @MethodOnlyAnnotation("save")
    public void saveUser() {}
    */
}

// âœ… æ­£ç¡®ï¼šæ˜ç¡®å‘½åå’Œä½œç”¨åŸŸ
@Target({ElementType.METHOD, ElementType.TYPE})  // æ˜ç¡®æŒ‡å®šå¯ç”¨ä½ç½®
@Retention(RetentionPolicy.RUNTIME)
public @interface BusinessOperation {
    String value();
    OperationType type() default OperationType.QUERY;
}

enum OperationType {
    QUERY, UPDATE, DELETE, CREATE
}
```

### 7.2 åµŒå¥—å¤æ‚åº¦é—®é¢˜

```java
// âŒ è¿‡åº¦å¤æ‚çš„åµŒå¥—ç»“æ„
public @interface OverComplexAnnotation {
    DatabaseConfig database() default @DatabaseConfig(
        connection = @ConnectionConfig(
            pool = @PoolConfig(
                settings = @PoolSettings(
                    maxSize = 10,
                    minSize = 1,
                    timeout = @TimeoutConfig(
                        connection = 30000,
                        query = 60000
                    )
                )
            )
        )
    );
}

// âœ… æ¨èï¼šç®€åŒ–åµŒå¥—ç»“æ„
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface DatabaseConfig {
    String url() default "";
    int maxConnections() default 10;
    int timeout() default 30000;
}

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface CacheConfig {
    String name() default "";
    int ttl() default 3600;
}

// ä½¿ç”¨å¤šä¸ªç®€å•æ³¨è§£ä»£æ›¿å¤æ‚åµŒå¥—
@DatabaseConfig(url = "jdbc:mysql://localhost:3306/db", maxConnections = 20)
@CacheConfig(name = "userCache", ttl = 1800)
public class UserService {
    // å®ç°
}
```

### 7.3 ç©ºå€¼å’Œè¾¹ç•Œå¤„ç†

```java
public @interface ValidationAnnotation {
    
    // âœ… æ­£ç¡®ï¼šæä¾›åˆç†çš„é»˜è®¤å€¼
    String message() default "éªŒè¯å¤±è´¥";
    int min() default 0;
    int max() default Integer.MAX_VALUE;
    String[] groups() default {};  // ç©ºæ•°ç»„è€Œénull
    
    // âœ… ä½¿ç”¨ç‰¹æ®Šå€¼è¡¨ç¤º"æœªè®¾ç½®"
    Class<?> targetClass() default void.class;  // void.classè¡¨ç¤ºæœªæŒ‡å®š
    String pattern() default "";  // ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ— æ¨¡å¼
}

// å¤„ç†æ³¨è§£é»˜è®¤å€¼çš„å·¥å…·ç±»
public class AnnotationUtils {
    
    public static boolean hasValue(String value) {
        return value != null && !value.isEmpty() && !"".equals(value);
    }
    
    public static boolean isDefaultClass(Class<?> clazz) {
        return void.class.equals(clazz) || Object.class.equals(clazz);
    }
    
    public static boolean hasGroups(String[] groups) {
        return groups != null && groups.length > 0;
    }
    
    // å®‰å…¨è·å–æ³¨è§£å€¼
    public static String getSafeValue(ValidationAnnotation annotation) {
        String value = annotation.message();
        return hasValue(value) ? value : "é»˜è®¤éªŒè¯æ¶ˆæ¯";
    }
}
```

### 7.4 å¤šæ³¨è§£å†²çªå¤„ç†

```java
public class MultiAnnotationConflicts {
    
    // é—®é¢˜ï¼šå¤šä¸ªæ³¨è§£å¯èƒ½äº§ç”Ÿå†²çªé€»è¾‘
    @Transactional
    @CacheEvict(value = "users", allEntries = true)
    @LogExecution("åˆ é™¤ç”¨æˆ·")
    @RequiresRole("ADMIN")
    public void deleteUser(Long userId) {
        // å¤šä¸ªAOPåˆ‡é¢å¯èƒ½äº§ç”Ÿæ‰§è¡Œé¡ºåºé—®é¢˜
    }
    
    // è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨@OrderæŒ‡å®šæ‰§è¡Œé¡ºåº
    @Order(1)
    @Aspect
    public class SecurityAspect {
        @Around("@annotation(RequiresRole)")
        public Object checkRole(ProceedingJoinPoint joinPoint, RequiresRole role) throws Throwable {
            // æƒé™æ£€æŸ¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
            return joinPoint.proceed();
        }
    }
    
    @Order(2)
    @Aspect
    public class TransactionAspect {
        @Around("@annotation(Transactional)")
        public Object handleTransaction(ProceedingJoinPoint joinPoint) throws Throwable {
            // äº‹åŠ¡å¤„ç†ï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰
            return joinPoint.proceed();
        }
    }
    
    @Order(3)
    @Aspect
    public class LoggingAspect {
        @Around("@annotation(LogExecution)")
        public Object logExecution(ProceedingJoinPoint joinPoint, LogExecution log) throws Throwable {
            // æ—¥å¿—è®°å½•ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
            return joinPoint.proceed();
        }
    }
}
```

---

## 8. ğŸ” æ€§èƒ½ä¸å®‰å…¨è€ƒè™‘


### 8.1 åå°„æ€§èƒ½ä¼˜åŒ–

```java
public class PerformanceOptimization {
    
    // âŒ æ€§èƒ½é—®é¢˜ï¼šé¢‘ç¹åå°„è°ƒç”¨
    public void badPerformance(List<Object> objects) {
        for (Object obj : objects) {
            Class<?> clazz = obj.getClass();
            // æ¯æ¬¡å¾ªç¯éƒ½è¿›è¡Œåå°„ï¼Œæ€§èƒ½å¾ˆå·®
            for (Method method : clazz.getDeclaredMethods()) {
                if (method.isAnnotationPresent(LogExecution.class)) {
                    // å¤„ç†...
                }
            }
        }
    }
    
    // âœ… æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ç¼“å­˜
    private static final Map<Class<?>, List<Method>> ANNOTATION_CACHE = new ConcurrentHashMap<>();
    
    public void goodPerformance(List<Object> objects) {
        for (Object obj : objects) {
            Class<?> clazz = obj.getClass();
            
            // ä½¿ç”¨ç¼“å­˜é¿å…é‡å¤åå°„
            List<Method> annotatedMethods = ANNOTATION_CACHE.computeIfAbsent(clazz, k -> {
                return Arrays.stream(k.getDeclaredMethods())
                        .filter(method -> method.isAnnotationPresent(LogExecution.class))
                        .collect(Collectors.toList());
            });
            
            for (Method method : annotatedMethods) {
                // å¤„ç†å·²ç¼“å­˜çš„æ–¹æ³•
            }
        }
    }
    
    // é¢„å¤„ç†æ³¨è§£å…ƒæ•°æ®
    public static class AnnotationMetadata {
        private final Map<Class<?>, Set<Method>> annotatedMethods = new HashMap<>();
        private final Map<Class<?>, Set<Field>> annotatedFields = new HashMap<>();
        
        public void preProcess(Class<?> clazz) {
            // å¯åŠ¨æ—¶é¢„å¤„ç†ï¼Œé¿å…è¿è¡Œæ—¶åå°„
            Set<Method> methods = Arrays.stream(clazz.getDeclaredMethods())
                    .filter(method -> method.getAnnotations().length > 0)
                    .collect(Collectors.toSet());
            annotatedMethods.put(clazz, methods);
            
            Set<Field> fields = Arrays.stream(clazz.getDeclaredFields())
                    .filter(field -> field.getAnnotations().length > 0)
                    .collect(Collectors.toSet());
            annotatedFields.put(clazz, fields);
        }
        
        public Set<Method> getAnnotatedMethods(Class<?> clazz) {
            return annotatedMethods.getOrDefault(clazz, Collections.emptySet());
        }
    }
}
```

### 8.2 å®‰å…¨æ€§è€ƒè™‘

```java
public class SecurityConsiderations {
    
    // âš ï¸ å®‰å…¨é£é™©ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²
    @Target(ElementType.FIELD)
    @Retention(RetentionPolicy.RUNTIME)
    public @interface SensitiveData {
        String encryptionKey() default "";  // âŒ ä¸è¦åœ¨æ³¨è§£ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯
    }
    
    // âœ… å®‰å…¨åšæ³•ï¼šä½¿ç”¨æ ‡è®°å’Œå¤–éƒ¨é…ç½®
    @Target(ElementType.FIELD)
    @Retention(RetentionPolicy.RUNTIME)
    public @interface Encrypted {
        String algorithm() default "AES";    // åªå­˜å‚¨ç®—æ³•åç§°
        boolean required() default true;     // æ ‡è®°æ˜¯å¦å¿…é¡»åŠ å¯†
    }
    
    // å®‰å…¨çš„æ³¨è§£å¤„ç†
    public class SecureAnnotationProcessor {
        
        private final EncryptionService encryptionService;
        
        public SecureAnnotationProcessor(EncryptionService encryptionService) {
            this.encryptionService = encryptionService;
        }
        
        public void processEncryptedFields(Object obj) throws Exception {
            Class<?> clazz = obj.getClass();
            
            for (Field field : clazz.getDeclaredFields()) {
                Encrypted encrypted = field.getAnnotation(Encrypted.class);
                if (encrypted != null) {
                    field.setAccessible(true);
                    Object value = field.get(obj);
                    
                    if (value instanceof String) {
                        // ä»å®‰å…¨çš„é…ç½®æºè·å–å¯†é’¥ï¼Œè€Œéæ³¨è§£
                        String encryptedValue = encryptionService.encrypt(
                            (String) value, 
                            encrypted.algorithm()
                        );
                        field.set(obj, encryptedValue);
                    }
                }
            }
        }
    }
    
    // âš ï¸ æƒé™æ§åˆ¶æ³¨è§£çš„å®‰å…¨ä½¿ç”¨
    @Target(ElementType.METHOD)
    @Retention(RetentionPolicy.RUNTIME)
    public @interface RequiresPermission {
        String value();                    // æƒé™åç§°
        PermissionLevel level() default PermissionLevel.READ;
        boolean allowOwner() default false; // æ˜¯å¦å…è®¸èµ„æºæ‰€æœ‰è€…è®¿é—®
    }
    
    enum PermissionLevel {
        READ, WRITE, DELETE, ADMIN
    }
    
    // å®‰å…¨çš„æƒé™æ£€æŸ¥
    @Aspect
    @Component
    public class SecurityAspect {
        
        @Around("@annotation(permission)")
        public Object checkPermission(ProceedingJoinPoint joinPoint, RequiresPermission permission) throws Throwable {
            // 1. è·å–å½“å‰ç”¨æˆ·
            User currentUser = SecurityContext.getCurrentUser();
            if (currentUser == null) {
                throw new SecurityException("æœªè®¤è¯ç”¨æˆ·");
            }
            
            // 2. æ£€æŸ¥æƒé™
            boolean hasPermission = securityService.hasPermission(
                currentUser, 
                permission.value(), 
                permission.level()
            );
            
            // 3. æ£€æŸ¥èµ„æºæ‰€æœ‰æƒï¼ˆå¦‚æœå…è®¸ï¼‰
            if (!hasPermission && permission.allowOwner()) {
                Object[] args = joinPoint.getArgs();
                hasPermission = securityService.isResourceOwner(currentUser, args);
            }
            
            if (!hasPermission) {
                throw new SecurityException("æƒé™ä¸è¶³");
            }
            
            return joinPoint.proceed();
        }
    }
}
```

---

## 9. ğŸ’¡ æœ€ä½³å®è·µå»ºè®®


### 9.1 è®¾è®¡åŸåˆ™

```java
// âœ… åŸåˆ™1ï¼šèŒè´£å•ä¸€ï¼Œè¯­ä¹‰æ˜ç¡®
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface LogExecution {
    String operation();              // æ˜ç¡®çš„æ“ä½œæè¿°
    LogLevel level() default LogLevel.INFO; // æ—¥å¿—çº§åˆ«
    boolean includeArgs() default false;    // æ˜¯å¦åŒ…å«å‚æ•°
}

// âŒ è¿åå•ä¸€èŒè´£ï¼šä¸€ä¸ªæ³¨è§£æ‰¿æ‹…å¤ªå¤šåŠŸèƒ½
/*
public @interface BusinessAnnotation {
    String logMessage();           // æ—¥å¿—åŠŸèƒ½
    boolean requiresAuth();        // æƒé™åŠŸèƒ½
    String cacheKey();            // ç¼“å­˜åŠŸèƒ½
    int retryTimes();             // é‡è¯•åŠŸèƒ½
    // å¤ªå¤šèŒè´£ï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™
}
*/

// âœ… æ­£ç¡®ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªä¸“é—¨çš„æ³¨è§£
@LogExecution(operation = "è·å–ç”¨æˆ·ä¿¡æ¯")
@RequiresAuth(role = "USER")
@Cacheable(key = "user_#{#id}")
@Retryable(times = 3)
public User getUserById(Long id) {
    return userService.findById(id);
}
```

### 9.2 å‘½åè§„èŒƒ

```java
// âœ… è‰¯å¥½çš„å‘½åå®è·µ
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface ApiOperation {           // æ¸…æ™°è¡¨è¾¾ç”¨é€”
    String value();                        // ä¸»è¦æè¿°
    String notes() default "";             // è¯¦ç»†è¯´æ˜
    ResponseClass response() default ResponseClass.class; // å“åº”ç±»å‹
    String[] tags() default {};            // æ ‡ç­¾åˆ†ç±»
}

@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DatabaseColumn {         // æ˜ç¡®æŒ‡å‘æ•°æ®åº“åˆ—æ˜ å°„
    String name() default "";              // åˆ—å
    boolean nullable() default true;       // æ˜¯å¦å¯ç©º
    int length() default 255;              // é•¿åº¦é™åˆ¶
}

// âŒ ä¸å¥½çš„å‘½å
/*
public @interface Data { }                 // å¤ªæ¨¡ç³Š
public @interface Process { }              // ä¸æ˜ç¡®
public @interface Config { }               // è¿‡äºå®½æ³›
*/
```

### 9.3 æ–‡æ¡£ä¸å…ƒæ³¨è§£

```java
/**
 * æ ‡è®°éœ€è¦è¿›è¡Œæƒé™éªŒè¯çš„æ–¹æ³•
 * 
 * <p>ä½¿ç”¨ç¤ºä¾‹ï¼š
 * <pre>
 * {@code
 * @RequiresPermission(value = "user:read", level = PermissionLevel.READ)
 * public User getUser(Long id) {
 *     return userService.findById(id);
 * }
 * }
 * </pre>
 * 
 * @author yourname
 * @since 1.0.0
 * @see SecurityService#hasPermission(User, String, PermissionLevel)
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Documented                               // åŒ…å«åœ¨JavaDocä¸­
public @interface RequiresPermission {
    /**
     * æƒé™æ ‡è¯†ç¬¦
     * @return æƒé™å­—ç¬¦ä¸²ï¼Œæ ¼å¼ï¼šresource:action
     */
    String value();
    
    /**
     * æƒé™çº§åˆ«
     * @return æ‰€éœ€çš„æƒé™çº§åˆ«ï¼Œé»˜è®¤ä¸ºREAD
     */
    PermissionLevel level() default PermissionLevel.READ;
    
    /**
     * æ˜¯å¦å…è®¸èµ„æºæ‰€æœ‰è€…è®¿é—®
     * @return trueè¡¨ç¤ºèµ„æºæ‰€æœ‰è€…å¯ä»¥ç»•è¿‡æƒé™æ£€æŸ¥
     */
    boolean allowOwner() default false;
}
```

### 9.4 é…åˆåå°„çš„ç¼“å­˜ç­–ç•¥

```java
@Component
public class AnnotationCacheManager {
    
    // ç±»çº§åˆ«æ³¨è§£ç¼“å­˜
    private final Map<Class<?>, Map<Class<? extends Annotation>, Annotation>> classAnnotationCache 
        = new ConcurrentHashMap<>();
    
    // æ–¹æ³•çº§åˆ«æ³¨è§£ç¼“å­˜
    private final Map<Method, Map<Class<? extends Annotation>, Annotation>> methodAnnotationCache 
        = new ConcurrentHashMap<>();
    
    // å­—æ®µçº§åˆ«æ³¨è§£ç¼“å­˜
    private final Map<Field, Map<Class<? extends Annotation>, Annotation>> fieldAnnotationCache 
        = new ConcurrentHashMap<>();
    
    /**
     * è·å–ç±»æ³¨è§£ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */
    @SuppressWarnings("unchecked")
    public <T extends Annotation> T getClassAnnotation(Class<?> clazz, Class<T> annotationType) {
        return (T) classAnnotationCache
            .computeIfAbsent(clazz, k -> new ConcurrentHashMap<>())
            .computeIfAbsent(annotationType, k -> clazz.getAnnotation(annotationType));
    }
    
    /**
     * è·å–æ–¹æ³•æ³¨è§£ï¼ˆå¸¦ç¼“å­˜ï¼‰
     */
    @SuppressWarnings("unchecked")
    public <T extends Annotation> T getMethodAnnotation(Method method, Class<T> annotationType) {
        return (T) methodAnnotationCache
            .computeIfAbsent(method, k -> new ConcurrentHashMap<>())
            .computeIfAbsent(annotationType, k -> method.getAnnotation(annotationType));
    }
    
    /**
     * æ‰¹é‡é¢„åŠ è½½æ³¨è§£
     */
    public void preloadAnnotations(Class<?> clazz, Class<? extends Annotation>... annotationTypes) {
        // é¢„åŠ è½½ç±»æ³¨è§£
        Map<Class<? extends Annotation>, Annotation> classAnns = 
            classAnnotationCache.computeIfAbsent(clazz, k -> new ConcurrentHashMap<>());
        
        for (Class<? extends Annotation> annType : annotationTypes) {
            classAnns.computeIfAbsent(annType, k -> clazz.getAnnotation(annType));
        }
        
        // é¢„åŠ è½½æ–¹æ³•æ³¨è§£
        for (Method method : clazz.getDeclaredMethods()) {
            Map<Class<? extends Annotation>, Annotation> methodAnns = 
                methodAnnotationCache.computeIfAbsent(method, k -> new ConcurrentHashMap<>());
            
            for (Class<? extends Annotation> annType : annotationTypes) {
                methodAnns.computeIfAbsent(annType, k -> method.getAnnotation(annType));
            }
        }
        
        // é¢„åŠ è½½å­—æ®µæ³¨è§£
        for (Field field : clazz.getDeclaredFields()) {
            Map<Class<? extends Annotation>, Annotation> fieldAnns = 
                fieldAnnotationCache.computeIfAbsent(field, k -> new ConcurrentHashMap<>());
            
            for (Class<? extends Annotation> annType : annotationTypes) {
                fieldAnns.computeIfAbsent(annType, k -> field.getAnnotation(annType));
            }
        }
    }
    
    /**
     * æ¸…ç©ºç¼“å­˜
     */
    public void clearCache() {
        classAnnotationCache.clear();
        methodAnnotationCache.clear();
        fieldAnnotationCache.clear();
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 ç±»å‹é™åˆ¶é€Ÿè®°è¡¨

```
âœ… æ”¯æŒçš„ç±»å‹ï¼š
  - åŸºæœ¬ç±»å‹ï¼šint, boolean, char, float, double, byte, short, long
  - Stringç±»å‹ï¼šå­—ç¬¦ä¸²
  - æšä¸¾ç±»å‹ï¼šè‡ªå®šä¹‰æšä¸¾
  - Classç±»å‹ï¼šClass<?>, Class<? extends T>
  - æ³¨è§£ç±»å‹ï¼šåµŒå¥—æ³¨è§£
  - æ•°ç»„ç±»å‹ï¼šä¸Šè¿°ç±»å‹çš„æ•°ç»„

âŒ ä¸æ”¯æŒçš„ç±»å‹ï¼š
  - é›†åˆç±»å‹ï¼šList, Set, Map
  - è‡ªå®šä¹‰å¯¹è±¡ï¼šDate, BigDecimal, è‡ªå®šä¹‰ç±»
  - æ³›å‹ç±»å‹ï¼šList<String>, Optional<T>
  - æ¥å£ç±»å‹ï¼šSerializable, Comparableï¼ˆæ³¨è§£é™¤å¤–ï¼‰
```

### 10.2 å¸¸è§é”™è¯¯æ£€æŸ¥æ¸…å•

```
â–¡ æ˜¯å¦è®¾ç½®äº†æ­£ç¡®çš„@Retentionç­–ç•¥ï¼Ÿ
â–¡ æ˜¯å¦ä¸ºæ‰€æœ‰å±æ€§æä¾›äº†åˆç†çš„é»˜è®¤å€¼ï¼Ÿ
â–¡ æ˜¯å¦é¿å…äº†åœ¨æ³¨è§£ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Ÿ
â–¡ æ˜¯å¦è€ƒè™‘äº†æ³¨è§£çš„ç»§æ‰¿æ€§é—®é¢˜ï¼Ÿ
â–¡ æ˜¯å¦é¿å…äº†è¿‡åº¦å¤æ‚çš„åµŒå¥—ç»“æ„ï¼Ÿ
â–¡ æ˜¯å¦æä¾›äº†æ¸…æ™°çš„æ³¨è§£æ–‡æ¡£ï¼Ÿ
â–¡ æ˜¯å¦è€ƒè™‘äº†æ€§èƒ½å½±å“å¹¶ä½¿ç”¨äº†ç¼“å­˜ï¼Ÿ
â–¡ æ˜¯å¦å¤„ç†äº†å¤šæ³¨è§£çš„å†²çªé—®é¢˜ï¼Ÿ
â–¡ æ˜¯å¦éµå¾ªäº†å‘½åè§„èŒƒï¼Ÿ
â–¡ æ˜¯å¦æ˜ç¡®äº†æ³¨è§£çš„èŒè´£èŒƒå›´ï¼Ÿ
```

### 10.3 æœ€ä½³å®è·µé‡‘å­—å¡”

```
                    ğŸ¯ æ˜ç¡®ç›®æ ‡
                   å•ä¸€èŒè´£åŸåˆ™
                  /            \
              ğŸ“ æ¸…æ™°å‘½å         ğŸ”’ å®‰å…¨è€ƒè™‘
             è¯­ä¹‰åŒ–è®¾è®¡           æƒé™æ§åˆ¶
            /         \         /         \
        ğŸ“‹ å®Œå–„æ–‡æ¡£    âš¡ æ€§èƒ½ä¼˜åŒ–    ğŸ”„ ç”Ÿå‘½å‘¨æœŸ    ğŸ¨ åˆç†é»˜è®¤å€¼
       ä½¿ç”¨ç¤ºä¾‹      åå°„ç¼“å­˜      ä¿ç•™ç­–ç•¥      ç©ºå€¼å¤„ç†
      /       \    /       \    /       \    /        \
   ğŸ—ï¸ æ¶æ„è®¾è®¡  ğŸ“Š ç›‘æ§å‘Šè­¦  ğŸ§ª å•å…ƒæµ‹è¯•  ğŸ”§ å·¥å…·æ”¯æŒ  ğŸ“ˆ ç‰ˆæœ¬å…¼å®¹  ğŸŒŸ ç”¨æˆ·ä½“éªŒ
```

### 10.4 é—®é¢˜æ’æŸ¥æŒ‡å—

```java
// é—®é¢˜1ï¼šæ³¨è§£è¿è¡Œæ—¶è·å–ä¸åˆ°
if (method.getAnnotation(MyAnnotation.class) == null) {
    // æ£€æŸ¥ä¿ç•™ç­–ç•¥æ˜¯å¦ä¸ºRUNTIME
    // æ£€æŸ¥æ³¨è§£æ˜¯å¦æ­£ç¡®åº”ç”¨åˆ°ç›®æ ‡å…ƒç´ 
}

// é—®é¢˜2ï¼šé‡å¤æ³¨è§£ä¸ç”Ÿæ•ˆ
Role[] roles = method.getAnnotationsByType(Role.class);
if (roles.length == 0) {
    // æ£€æŸ¥æ˜¯å¦æ­£ç¡®ä½¿ç”¨@Repeatable
    // æ£€æŸ¥å®¹å™¨æ³¨è§£çš„å®šä¹‰æ˜¯å¦æ­£ç¡®
}

// é—®é¢˜3ï¼šæ€§èƒ½é—®é¢˜
if (isPerformanceCriticalPath()) {
    // ä½¿ç”¨æ³¨è§£ç¼“å­˜
    // é¢„å¤„ç†æ³¨è§£ä¿¡æ¯
    // é¿å…é¢‘ç¹åå°„è°ƒç”¨
}

// é—®é¢˜4ï¼šæ³¨è§£å†²çª
if (hasMultipleAnnotations()) {
    // æ£€æŸ¥AOPåˆ‡é¢çš„æ‰§è¡Œé¡ºåº
    // ä½¿ç”¨@Orderæ§åˆ¶ä¼˜å…ˆçº§
    // æ˜ç¡®æ³¨è§£çš„è¯­ä¹‰è¾¹ç•Œ
}
```

