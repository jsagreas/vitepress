---
title: 2ã€ç±»åŠ è½½æœºåˆ¶ä¸åŒäº²å§”æ´¾
---
## ğŸ“š ç›®å½•

1. [ç±»åŠ è½½ç”Ÿå‘½å‘¨æœŸ](#1-ç±»åŠ è½½ç”Ÿå‘½å‘¨æœŸ)
2. [åŒäº²å§”æ´¾æ¨¡å‹](#2-åŒäº²å§”æ´¾æ¨¡å‹)
3. [è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸å®‰å…¨æœºåˆ¶](#3-è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸å®‰å…¨æœºåˆ¶)

---

## 1. ğŸ”„ ç±»åŠ è½½ç”Ÿå‘½å‘¨æœŸ


### 1.1 ç±»åŠ è½½çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ


**ğŸ¯ ç”Ÿå‘½å‘¨æœŸæ€»è§ˆ**
ç±»ä»è¢«åŠ è½½åˆ°JVMå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹7ä¸ªé˜¶æ®µï¼š

```
åŠ è½½ â†’ éªŒè¯ â†’ å‡†å¤‡ â†’ è§£æ â†’ åˆå§‹åŒ– â†’ ä½¿ç”¨ â†’ å¸è½½
     â””â”€â”€â”€â”€â”€â”€ è¿æ¥ â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š å„é˜¶æ®µè¯¦ç»†å¯¹æ¯”**

| é˜¶æ®µ | **ä¸»è¦å·¥ä½œ** | **æ—¶æœº** | **æ˜¯å¦å¿…é¡»** | **èƒ½å¦äº¤å‰è¿›è¡Œ** |
|------|-------------|---------|-------------|-----------------|
| ğŸ”„ **åŠ è½½** | `è·å–å­—èŠ‚ç ï¼Œåˆ›å»ºClasså¯¹è±¡` | `é¦–æ¬¡ä½¿ç”¨æ—¶` | `å¿…é¡»` | `å¯ä»¥ä¸éªŒè¯ã€å‡†å¤‡äº¤å‰` |
| âœ… **éªŒè¯** | `ç¡®ä¿å­—èŠ‚ç å®‰å…¨åˆæ³•` | `åŠ è½½å` | `å¿…é¡»` | `å¯ä»¥ä¸åŠ è½½äº¤å‰` |
| ğŸ¯ **å‡†å¤‡** | `åˆ†é…å†…å­˜ï¼Œè®¾ç½®é»˜è®¤å€¼` | `éªŒè¯å` | `å¿…é¡»` | `å¯ä»¥ä¸éªŒè¯äº¤å‰` |
| ğŸ”— **è§£æ** | `ç¬¦å·å¼•ç”¨è½¬ç›´æ¥å¼•ç”¨` | `åˆå§‹åŒ–å‰` | `å¯é€‰` | `å¯ä»¥å»¶è¿Ÿåˆ°å®é™…ä½¿ç”¨æ—¶` |
| âš¡ **åˆå§‹åŒ–** | `æ‰§è¡Œç±»æ„é€ å™¨` | `ä¸»åŠ¨ä½¿ç”¨æ—¶` | `å¿…é¡»` | `åŒæ­¥è¿›è¡Œï¼Œä¸å¯äº¤å‰` |
| ğŸƒ **ä½¿ç”¨** | `æ­£å¸¸ä½¿ç”¨ç±»` | `åˆå§‹åŒ–å` | `-` | `-` |
| ğŸ—‘ï¸ **å¸è½½** | `ä»å†…å­˜ä¸­ç§»é™¤` | `ä¸å†è¢«å¼•ç”¨` | `è‡ªåŠ¨` | `-` |

**ğŸ’¡ è§¦å‘ç±»åŠ è½½çš„æ—¶æœº**
```java
// ä»¥ä¸‹6ç§æƒ…å†µä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼ˆä¸»åŠ¨å¼•ç”¨ï¼‰
1. new Student();                    // åˆ›å»ºå¯¹è±¡å®ä¾‹
2. Student.count = 10;               // è®¿é—®é™æ€å­—æ®µ
3. Student.getCount();               // è°ƒç”¨é™æ€æ–¹æ³•
4. Class.forName("Student");         // åå°„åŠ è½½
5. extends Student {...}             // åˆå§‹åŒ–å­ç±»æ—¶
6. public static void main(...)      // å¯åŠ¨ç±»ï¼ˆåŒ…å«mainæ–¹æ³•ï¼‰

// ä»¥ä¸‹æƒ…å†µä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼ˆè¢«åŠ¨å¼•ç”¨ï¼‰
1. Student[] arr = new Student[10];  // åˆ›å»ºæ•°ç»„
2. final String NAME = Student.NAME; // è®¿é—®finalå¸¸é‡
3. SuperClass.value;                 // é€šè¿‡å­ç±»è®¿é—®çˆ¶ç±»é™æ€å­—æ®µ
```

### 1.2 åŠ è½½é˜¶æ®µï¼šè·å–Classæ–‡ä»¶äºŒè¿›åˆ¶æµ


**ğŸ”¸ åŠ è½½é˜¶æ®µçš„æ ¸å¿ƒä»»åŠ¡**
```
1. é€šè¿‡ç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ
2. å°†å­—èŠ‚æµçš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„
3. åœ¨å†…å­˜ä¸­ç”Ÿæˆä»£è¡¨è¯¥ç±»çš„java.lang.Classå¯¹è±¡
```

**ğŸ“‚ è·å–å­—èŠ‚æµçš„å¤šç§æ–¹å¼**
```java
// 1. ä»æ–‡ä»¶ç³»ç»Ÿè¯»å– .class æ–‡ä»¶
MyClass.class  // æœ€å¸¸è§çš„æ–¹å¼

// 2. ä»ç½‘ç»œè·å–ï¼ˆWeb Appletï¼‰
URL classUrl = new URL("http://example.com/MyClass.class");

// 3. ä»ZIP/JARåŒ…è¯»å–
jar tf myapp.jar  // æŸ¥çœ‹JARåŒ…å†…å®¹

// 4. è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼ˆåŠ¨æ€ä»£ç†ï¼‰
Proxy.newProxyInstance(loader, interfaces, handler);

// 5. ä»æ•°æ®åº“è¯»å–
// å°†ç±»çš„å­—èŠ‚ç å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œè¿è¡Œæ—¶è¯»å–

// 6. ä»å†…å­˜åŠ è½½ï¼ˆJSPç¼–è¯‘ï¼‰
// JSPæ–‡ä»¶ç¼–è¯‘åç›´æ¥åœ¨å†…å­˜ä¸­ç”Ÿæˆå­—èŠ‚ç 
```

**ğŸ¯ Classå¯¹è±¡çš„ç‰¹æ®Šæ€§**
```java
// Classå¯¹è±¡çš„åˆ›å»ºå’Œå­˜å‚¨
Class<?> clazz1 = String.class;
Class<?> clazz2 = Class.forName("java.lang.String");
Class<?> clazz3 = "hello".getClass();

// éªŒè¯æ˜¯åŒä¸€ä¸ªClasså¯¹è±¡
System.out.println(clazz1 == clazz2);  // true
System.out.println(clazz1 == clazz3);  // true

// Classå¯¹è±¡å­˜å‚¨ä½ç½®ï¼š
// Java 7-ï¼šå­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰
// Java 8+ï¼šå­˜å‚¨åœ¨å †å†…å­˜ä¸­
```

### 1.3 éªŒè¯é˜¶æ®µï¼šæ–‡ä»¶æ ¼å¼ã€å…ƒæ•°æ®ã€å­—èŠ‚ç ã€ç¬¦å·å¼•ç”¨éªŒè¯


**ğŸ›¡ï¸ éªŒè¯çš„å¿…è¦æ€§**
JVMéœ€è¦éªŒè¯å­—èŠ‚ç çš„å®‰å…¨æ€§ï¼Œå› ä¸ºå­—èŠ‚ç å¯èƒ½æ¥æºäºï¼š
- ç½‘ç»œä¸‹è½½ï¼ˆå¯èƒ½è¢«æ¶æ„ç¯¡æ”¹ï¼‰
- åŠ¨æ€ç”Ÿæˆï¼ˆå¯èƒ½å­˜åœ¨é”™è¯¯ï¼‰  
- ç¬¬ä¸‰æ–¹å·¥å…·ç”Ÿæˆï¼ˆå¯èƒ½ä¸ç¬¦åˆè§„èŒƒï¼‰

**ğŸ“‹ å››ä¸ªéªŒè¯é˜¶æ®µè¯¦è§£**

**é˜¶æ®µ1ï¼šæ–‡ä»¶æ ¼å¼éªŒè¯**
```
éªŒè¯å†…å®¹ï¼š
âœ… é­”æ•°æ£€æŸ¥ï¼šæ˜¯å¦ä»¥0xCAFEBABEå¼€å¤´
âœ… ç‰ˆæœ¬å·éªŒè¯ï¼šä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰JVMå¤„ç†èŒƒå›´å†…
âœ… å¸¸é‡æ± æ£€æŸ¥ï¼šå¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹
âœ… æ–‡ä»¶å®Œæ•´æ€§ï¼šClassæ–‡ä»¶æ˜¯å¦æœ‰è¢«åˆ é™¤æˆ–é™„åŠ çš„å…¶ä»–ä¿¡æ¯

éªŒè¯å¤±è´¥å¼‚å¸¸ï¼š
âŒ java.lang.ClassFormatError
```

**é˜¶æ®µ2ï¼šå…ƒæ•°æ®éªŒè¯**
```java
// éªŒè¯ç¤ºä¾‹
public class Child extends Parent implements Interface1 {
    // éªŒè¯å†…å®¹ï¼š
    // âœ… æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤Objectå¤–ï¼‰
    // âœ… çˆ¶ç±»æ˜¯å¦å…è®¸è¢«ç»§æ‰¿ï¼ˆä¸æ˜¯finalï¼‰
    // âœ… æ˜¯å¦å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•
    // âœ… æ˜¯å¦é‡å†™äº†çˆ¶ç±»çš„finalæ–¹æ³•ï¼ˆä¸å…è®¸ï¼‰
}

// éªŒè¯å¤±è´¥ç¤ºä¾‹
public final class FinalClass {}
public class Child extends FinalClass {}  // âŒ æ— æ³•ç»§æ‰¿finalç±»
```

**é˜¶æ®µ3ï¼šå­—èŠ‚ç éªŒè¯**
```
éªŒè¯å†…å®¹ï¼š
âœ… æ•°æ®æµåˆ†æï¼šç¡®ä¿åœ¨ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤åºåˆ—ä¸€è‡´
âœ… æ§åˆ¶æµåˆ†æï¼šç¡®ä¿ç¨‹åºè·³è½¬ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤
âœ… ç±»å‹æ£€æŸ¥ï¼šç¡®ä¿èµ‹å€¼å…¼å®¹
âœ… æ ˆæ·±åº¦æ£€æŸ¥ï¼šç¡®ä¿æ“ä½œæ•°æ ˆä¸ä¼šæº¢å‡º

ç¤ºä¾‹åˆ†æï¼š
iload_1     // åŠ è½½intå‹å±€éƒ¨å˜é‡åˆ°æ ˆ
iload_2     // åŠ è½½intå‹å±€éƒ¨å˜é‡åˆ°æ ˆ  
iadd        // æ‰§è¡ŒintåŠ æ³•ï¼ˆéœ€è¦ä¸¤ä¸ªintæ“ä½œæ•°ï¼‰
ireturn     // è¿”å›intå€¼
```

**é˜¶æ®µ4ï¼šç¬¦å·å¼•ç”¨éªŒè¯**
```java
// ç¬¦å·å¼•ç”¨éªŒè¯ç¤ºä¾‹
public class ClassA {
    public void methodA() {
        ClassB.methodB();  // ç¬¦å·å¼•ç”¨ï¼šClassB.methodB()
    }
}

// éªŒè¯å†…å®¹ï¼š
// âœ… ClassBæ˜¯å¦å­˜åœ¨
// âœ… methodBæ˜¯å¦å­˜åœ¨ä¸”å¯è®¿é—®
// âœ… å½“å‰ç±»æ˜¯å¦æœ‰æƒé™è°ƒç”¨è¯¥æ–¹æ³•
// âœ… æ–¹æ³•ç­¾åæ˜¯å¦åŒ¹é…
```

### 1.4 å‡†å¤‡é˜¶æ®µï¼šé™æ€å˜é‡å†…å­˜åˆ†é…å’Œé»˜è®¤åˆå§‹åŒ–


**ğŸ¯ å‡†å¤‡é˜¶æ®µçš„æ ¸å¿ƒå·¥ä½œ**
```
ä»…ä¸ºç±»çš„é™æ€å˜é‡ï¼ˆstaticå˜é‡ï¼‰åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼
æ³¨æ„ï¼šè¿™é‡Œçš„åˆå§‹å€¼æ˜¯æ•°æ®ç±»å‹çš„é›¶å€¼ï¼Œä¸æ˜¯ä»£ç ä¸­çš„èµ‹å€¼
```

**ğŸ“Š æ•°æ®ç±»å‹é»˜è®¤åˆå§‹å€¼è¡¨**

| æ•°æ®ç±»å‹ | **é»˜è®¤åˆå§‹å€¼** | **ç¤ºä¾‹è¯´æ˜** |
|---------|---------------|-------------|
| `byte` | `0` | `static byte b;  // 0` |
| `short` | `0` | `static short s; // 0` |
| `int` | `0` | `static int i;   // 0` |
| `long` | `0L` | `static long l;  // 0L` |
| `float` | `0.0f` | `static float f; // 0.0f` |
| `double` | `0.0` | `static double d;// 0.0` |
| `char` | `'\u0000'` | `static char c;  // ç©ºå­—ç¬¦` |
| `boolean` | `false` | `static boolean flag; // false` |
| `reference` | `null` | `static String str;   // null` |

**ğŸ’¡ å‡†å¤‡é˜¶æ®µç¤ºä¾‹åˆ†æ**
```java
public class PrepareExample {
    private static int count = 100;           // å‡†å¤‡é˜¶æ®µï¼šcount = 0
    private static final String NAME = "Tom"; // å‡†å¤‡é˜¶æ®µï¼šNAME = "Tom"
    private int instanceVar = 50;             // ä¸å¤„ç†ï¼Œå®ä¾‹å˜é‡
    
    static {
        count = 200;  // åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œ
    }
}

// å†…å­˜å˜åŒ–è¿‡ç¨‹ï¼š
// å‡†å¤‡é˜¶æ®µï¼šcount = 0,     NAME = "Tom"
// åˆå§‹åŒ–é˜¶æ®µï¼šcount = 100 â†’ count = 200
```

**ğŸ” ç‰¹æ®Šæƒ…å†µï¼šfinalå¸¸é‡**
```java
public class ConstantExample {
    // case 1: ç¼–è¯‘æœŸå¸¸é‡ - å‡†å¤‡é˜¶æ®µç›´æ¥èµ‹å€¼
    private static final int COMPILE_CONSTANT = 100;
    
    // case 2: è¿è¡ŒæœŸå¸¸é‡ - å‡†å¤‡é˜¶æ®µå…ˆèµ‹é»˜è®¤å€¼
    private static final int RUNTIME_CONSTANT = new Random().nextInt();
    
    // case 3: å­—ç¬¦ä¸²å¸¸é‡ - å‡†å¤‡é˜¶æ®µç›´æ¥èµ‹å€¼
    private static final String STR_CONSTANT = "Hello";
}
```

### 1.5 è§£æé˜¶æ®µï¼šç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨


**ğŸ”— å¼•ç”¨ç±»å‹å¯¹æ¯”**
```
ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰ï¼š
â€¢ ç”¨å­—ç¬¦ä¸²æè¿°ç›®æ ‡
â€¢ ä¸å†…å­˜å¸ƒå±€æ— å…³
â€¢ ä¾‹å¦‚ï¼š"com/example/Student.getName()V"

ç›´æ¥å¼•ç”¨ï¼ˆDirect Referenceï¼‰ï¼š
â€¢ ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€åç§»é‡æˆ–å¥æŸ„
â€¢ ä¸å†…å­˜å¸ƒå±€ç›¸å…³
â€¢ ä¾‹å¦‚ï¼šå†…å­˜åœ°å€ 0x12345678
```

**ğŸ“‹ è§£æå¯¹è±¡åˆ†ç±»**

| è§£æå¯¹è±¡ | **ç¬¦å·å¼•ç”¨ç¤ºä¾‹** | **ç›´æ¥å¼•ç”¨ç»“æœ** | **è§£ææ—¶æœº** |
|---------|-----------------|-----------------|-------------|
| ğŸ—ï¸ **ç±»/æ¥å£** | `com/example/Student` | `æ–¹æ³•åŒºä¸­çš„ç±»å‹æ•°æ®æŒ‡é’ˆ` | `é¦–æ¬¡ä½¿ç”¨æ—¶` |
| ğŸ”§ **å­—æ®µ** | `Student.name:Ljava/lang/String;` | `å­—æ®µåœ¨å¯¹è±¡ä¸­çš„åç§»é‡` | `é¦–æ¬¡è®¿é—®æ—¶` |
| ğŸ“ **æ–¹æ³•** | `Student.getName()V` | `æ–¹æ³•åœ¨æ–¹æ³•è¡¨ä¸­çš„å…¥å£åœ°å€` | `é¦–æ¬¡è°ƒç”¨æ—¶` |
| ğŸ¯ **æ¥å£æ–¹æ³•** | `Comparable.compareTo(Object)I` | `æ¥å£æ–¹æ³•è¡¨ä¸­çš„å…¥å£åœ°å€` | `é¦–æ¬¡è°ƒç”¨æ—¶` |

**ğŸ’» è§£æè¿‡ç¨‹ç¤ºä¾‹**
```java
// æºç 
public class Student {
    private String name;
    public String getName() { return name; }
}

public class Test {
    public static void main(String[] args) {
        Student s = new Student();  // è§£æStudentç±»
        String name = s.getName();  // è§£ægetNameæ–¹æ³•
    }
}

// å­—èŠ‚ç ä¸­çš„ç¬¦å·å¼•ç”¨
#2 = Class              #18            // Student
#3 = Methodref          #2.#19         // Student."<init>":()V
#4 = Methodref          #2.#20         // Student.getName:()Ljava/lang/String;

// è§£æåçš„ç›´æ¥å¼•ç”¨ï¼ˆæ¦‚å¿µæ€§ï¼‰
Studentç±» â†’ 0x1A2B3C4D (æ–¹æ³•åŒºåœ°å€)
getNameæ–¹æ³• â†’ 0x2B3C4D5E (æ–¹æ³•è¡¨åç§»é‡)
```

### 1.6 åˆå§‹åŒ–é˜¶æ®µï¼šæ‰§è¡Œç±»æ„é€ å™¨`<clinit>()`æ–¹æ³•


**âš¡ ç±»æ„é€ å™¨`<clinit>()`çš„ç‰¹ç‚¹**
```
<clinit>()æ–¹æ³•æ˜¯ä»€ä¹ˆï¼š
â€¢ ç”±javacç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆ
â€¢ åŒ…å«æ‰€æœ‰é™æ€å˜é‡çš„èµ‹å€¼è¯­å¥
â€¢ åŒ…å«é™æ€ä»£ç å—ä¸­çš„è¯­å¥
â€¢ æŒ‰ç…§æºç ä¸­å‡ºç°çš„é¡ºåºåˆå¹¶ç”Ÿæˆ
```

**ğŸ”„ `<clinit>()`æ–¹æ³•ç”Ÿæˆè§„åˆ™**
```java
// æºç ç¤ºä¾‹
public class InitExample {
    private static int a = 10;        // 1
    
    static {                          // 2
        b = 20;
        System.out.println("static block 1");
    }
    
    private static int b = 30;        // 3
    
    static {                          // 4
        System.out.println("static block 2");
    }
}

// ç¼–è¯‘å™¨ç”Ÿæˆçš„<clinit>()æ–¹æ³•ï¼ˆæ¦‚å¿µæ€§ï¼‰
static <clinit>() {
    a = 10;                          // æŒ‰æºç é¡ºåº
    b = 20;                          // staticå—1
    System.out.println("static block 1");
    b = 30;                          // è¦†ç›–å‰é¢çš„èµ‹å€¼
    System.out.println("static block 2");
}
```

**ğŸ”’ ç±»åˆå§‹åŒ–çš„åŒæ­¥æ€§**
```java
// ç±»åˆå§‹åŒ–çš„çº¿ç¨‹å®‰å…¨ä¿è¯
public class SingletonExample {
    private static class Holder {
        private static final SingletonExample INSTANCE = new SingletonExample();
    }
    
    public static SingletonExample getInstance() {
        return Holder.INSTANCE;  // åˆ©ç”¨ç±»åˆå§‹åŒ–çš„åŒæ­¥ç‰¹æ€§
    }
}

// JVMä¿è¯ï¼š
// âœ… åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç±»çš„<clinit>()æ–¹æ³•
// âœ… å…¶ä»–çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…ç›´åˆ°åˆå§‹åŒ–å®Œæˆ
// âœ… å¦‚æœåˆå§‹åŒ–å‡ºé”™ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šæ”¶åˆ°å¼‚å¸¸
```

**âš ï¸ åˆå§‹åŒ–é˜¶æ®µçš„æ³¨æ„äº‹é¡¹**
```java
// 1. æ¥å£çš„åˆå§‹åŒ–
public interface MyInterface {
    int value = new Random().nextInt();  // æ¥å£ä¹Ÿå¯ä»¥æœ‰<clinit>()
}

// 2. çˆ¶å­ç±»åˆå§‹åŒ–é¡ºåº
class Parent {
    static { System.out.println("Parent static"); }
}
class Child extends Parent {
    static { System.out.println("Child static"); }
}
// æ‰§è¡Œ new Child() è¾“å‡ºï¼š
// Parent static
// Child static

// 3. æ•°ç»„ç±»ä¸ä¼šè§¦å‘åˆå§‹åŒ–
Student[] students = new Student[10];  // ä¸ä¼šåˆå§‹åŒ–Studentç±»
```

---

## 2. ğŸ—ï¸ åŒäº²å§”æ´¾æ¨¡å‹


### 2.1 åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œæœºåˆ¶


**ğŸ”„ åŒäº²å§”æ´¾æ¨¡å‹å®šä¹‰**
```
åŒäº²å§”æ´¾æ¨¡å‹ï¼šå½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½è¯·æ±‚æ—¶ï¼Œ
é¦–å…ˆä¸ä¼šè‡ªå·±å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å®Œæˆã€‚
åªæœ‰å½“çˆ¶åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±åŠ è½½ã€‚
```

**ğŸ›ï¸ ç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„**
```
                Bootstrap ClassLoader (å¯åŠ¨ç±»åŠ è½½å™¨)
                         â†‘ çˆ¶åŠ è½½å™¨
                Extension ClassLoader (æ‰©å±•ç±»åŠ è½½å™¨)
                         â†‘ çˆ¶åŠ è½½å™¨  
               Application ClassLoader (åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)
                         â†‘ çˆ¶åŠ è½½å™¨
                 Custom ClassLoader (è‡ªå®šä¹‰ç±»åŠ è½½å™¨)
```

**âš¡ åŒäº²å§”æ´¾çš„å·¥ä½œæµç¨‹**
```
1. ç±»åŠ è½½è¯·æ±‚åˆ°è¾¾è‡ªå®šä¹‰ç±»åŠ è½½å™¨
   â†“
2. å§”æ´¾ç»™Application ClassLoader
   â†“  
3. å§”æ´¾ç»™Extension ClassLoader
   â†“
4. å§”æ´¾ç»™Bootstrap ClassLoader
   â†“
5. Bootstrapå°è¯•åŠ è½½ï¼Œæ‰¾åˆ°åˆ™è¿”å›ï¼Œæ‰¾ä¸åˆ°è¿”å›null
   â†“
6. Extensionå°è¯•åŠ è½½ï¼Œæ‰¾åˆ°åˆ™è¿”å›ï¼Œæ‰¾ä¸åˆ°è¿”å›null
   â†“
7. Applicationå°è¯•åŠ è½½ï¼Œæ‰¾åˆ°åˆ™è¿”å›ï¼Œæ‰¾ä¸åˆ°è¿”å›null
   â†“
8. è‡ªå®šä¹‰ç±»åŠ è½½å™¨æœ€åå°è¯•åŠ è½½

å¦‚æœéƒ½æ— æ³•åŠ è½½ï¼Œåˆ™æŠ›å‡ºClassNotFoundException
```

**ğŸ’» åŒäº²å§”æ´¾æ ¸å¿ƒä»£ç **
```java
// ClassLoader.loadClass()æ–¹æ³•çš„æ ¸å¿ƒé€»è¾‘
protected Class<?> loadClass(String name, boolean resolve) {
    // 1. æ£€æŸ¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½
    Class<?> c = findLoadedClass(name);
    if (c == null) {
        try {
            // 2. å§”æ´¾ç»™çˆ¶åŠ è½½å™¨
            if (parent != null) {
                c = parent.loadClass(name, false);
            } else {
                // 3. çˆ¶åŠ è½½å™¨ä¸ºnullæ—¶ï¼Œå§”æ´¾ç»™Bootstrap
                c = findBootstrapClassOrNull(name);
            }
        } catch (ClassNotFoundException e) {
            // çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œç»§ç»­ä¸‹é¢çš„é€»è¾‘
        }
        
        if (c == null) {
            // 4. çˆ¶åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œè‡ªå·±å°è¯•åŠ è½½
            c = findClass(name);
        }
    }
    return c;
}
```

### 2.2 Bootstrap ClassLoaderï¼šå¯åŠ¨ç±»åŠ è½½å™¨


**ğŸš€ Bootstrap ClassLoaderç‰¹ç‚¹**
```
å®ç°è¯­è¨€ï¼šC++å®ç°ï¼ˆä¸æ˜¯Javaä»£ç ï¼‰
åŠ è½½å†…å®¹ï¼šJVMæ ¸å¿ƒç±»åº“
åŠ è½½è·¯å¾„ï¼š$JAVA_HOME/jre/lib
çˆ¶åŠ è½½å™¨ï¼šæ— ï¼ˆé¡¶å±‚åŠ è½½å™¨ï¼‰
åœ¨Javaä¸­çš„è¡¨ç¤ºï¼šnull
```

**ğŸ“‚ Bootstrap ClassLoaderåŠ è½½çš„æ ¸å¿ƒç±»åº“**
```bash
# æŸ¥çœ‹Bootstrap ClassLoaderåŠ è½½è·¯å¾„
java -verbose:class HelloWorld 2>&1 | grep "Loaded.*rt.jar"

# ä¸»è¦åŠ è½½çš„JARåŒ…ï¼š
$JAVA_HOME/jre/lib/rt.jar          # æ ¸å¿ƒè¿è¡Œæ—¶ç±»
$JAVA_HOME/jre/lib/resources.jar   # èµ„æºæ–‡ä»¶
$JAVA_HOME/jre/lib/charsets.jar    # å­—ç¬¦é›†
$JAVA_HOME/jre/lib/jce.jar         # åŠ å¯†æ‰©å±•
```

**ğŸ’¡ Bootstrap ClassLoaderéªŒè¯**
```java
// éªŒè¯Bootstrap ClassLoader
Class<?> stringClass = String.class;
ClassLoader loader = stringClass.getClassLoader();
System.out.println("Stringç±»çš„åŠ è½½å™¨: " + loader);  // è¾“å‡º: null

// æ ¸å¿ƒç±»éƒ½ç”±Bootstrap ClassLoaderåŠ è½½
System.out.println(Object.class.getClassLoader());     // null
System.out.println(System.class.getClassLoader());     // null
System.out.println(Thread.class.getClassLoader());     // null
```

### 2.3 Extension ClassLoaderï¼šæ‰©å±•ç±»åŠ è½½å™¨


**ğŸ”§ Extension ClassLoaderç‰¹ç‚¹**
```
å®ç°ç±»ï¼šsun.misc.Launcher$ExtClassLoader
åŠ è½½å†…å®¹ï¼šæ‰©å±•ç±»åº“
åŠ è½½è·¯å¾„ï¼š$JAVA_HOME/jre/lib/ext æˆ– java.ext.dirsç³»ç»Ÿå±æ€§æŒ‡å®šçš„è·¯å¾„
çˆ¶åŠ è½½å™¨ï¼šBootstrap ClassLoader
```

**ğŸ“¦ å¸¸è§çš„æ‰©å±•ç±»åº“**
```bash
# æ‰©å±•ç±»åº“ä½ç½®
$JAVA_HOME/jre/lib/ext/cldrdata.jar    # å›½é™…åŒ–æ•°æ®
$JAVA_HOME/jre/lib/ext/dnsns.jar       # DNSè§£æ
$JAVA_HOME/jre/lib/ext/jaccess.jar     # è¾…åŠ©åŠŸèƒ½
$JAVA_HOME/jre/lib/ext/localedata.jar  # æœ¬åœ°åŒ–æ•°æ®
$JAVA_HOME/jre/lib/ext/nashorn.jar     # JavaScriptå¼•æ“
$JAVA_HOME/jre/lib/ext/sunec.jar       # æ¤­åœ†æ›²çº¿åŠ å¯†
$JAVA_HOME/jre/lib/ext/sunjce_provider.jar # åŠ å¯†æœåŠ¡æä¾›è€…
$JAVA_HOME/jre/lib/ext/sunpkcs11.jar   # PKCS#11åŠ å¯†
$JAVA_HOME/jre/lib/ext/zipfs.jar       # ZIPæ–‡ä»¶ç³»ç»Ÿ
```

**ğŸ’» Extension ClassLoaderéªŒè¯**
```java
// æŸ¥çœ‹Extension ClassLoader
ClassLoader extLoader = ClassLoader.getSystemClassLoader().getParent();
System.out.println("æ‰©å±•ç±»åŠ è½½å™¨: " + extLoader);
// è¾“å‡º: sun.misc.Launcher$ExtClassLoader@xxx

// æ‰©å±•ç±»åº“ä¸­çš„ç±»
try {
    Class<?> clazz = Class.forName("com.sun.crypto.provider.SunJCE");
    System.out.println("SunJCEåŠ è½½å™¨: " + clazz.getClassLoader());
    // è¾“å‡º: sun.misc.Launcher$ExtClassLoader@xxx
} catch (ClassNotFoundException e) {
    System.out.println("ç±»æœªæ‰¾åˆ°");
}
```

### 2.4 Application ClassLoaderï¼šåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨


**ğŸ“± Application ClassLoaderç‰¹ç‚¹**
```
å®ç°ç±»ï¼šsun.misc.Launcher$AppClassLoader
åˆ«åï¼šç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆSystem ClassLoaderï¼‰
åŠ è½½å†…å®¹ï¼šç”¨æˆ·ç±»è·¯å¾„ï¼ˆclasspathï¼‰ä¸Šçš„ç±»
åŠ è½½è·¯å¾„ï¼šjava.class.pathç³»ç»Ÿå±æ€§æŒ‡å®šçš„è·¯å¾„
çˆ¶åŠ è½½å™¨ï¼šExtension ClassLoader
è·å–æ–¹å¼ï¼šClassLoader.getSystemClassLoader()
```

**ğŸ¯ Application ClassLoaderçš„èŒè´£**
```java
// åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½çš„å†…å®¹
1. ç”¨æˆ·ç¼–å†™çš„ç±»
2. ç¬¬ä¸‰æ–¹JARåŒ…ä¸­çš„ç±»  
3. é€šè¿‡-cpæˆ–-classpathæŒ‡å®šçš„ç±»

// éªŒè¯Application ClassLoader
public class MyClass {
    public static void main(String[] args) {
        ClassLoader appLoader = MyClass.class.getClassLoader();
        System.out.println("MyClassåŠ è½½å™¨: " + appLoader);
        // è¾“å‡º: sun.misc.Launcher$AppClassLoader@xxx
        
        // éªŒè¯æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨
        ClassLoader sysLoader = ClassLoader.getSystemClassLoader();
        System.out.println("ç³»ç»Ÿç±»åŠ è½½å™¨: " + sysLoader);
        System.out.println("æ˜¯åŒä¸€ä¸ª: " + (appLoader == sysLoader));  // true
    }
}
```

### 2.5 åŒäº²å§”æ´¾çš„ä¼˜åŠ¿ï¼šé¿å…é‡å¤åŠ è½½ã€ä¿è¯å®‰å…¨æ€§


**ğŸ›¡ï¸ åŒäº²å§”æ´¾çš„æ ¸å¿ƒä¼˜åŠ¿**

**ä¼˜åŠ¿1ï¼šé¿å…ç±»çš„é‡å¤åŠ è½½**
```java
// æ²¡æœ‰åŒäº²å§”æ´¾çš„é—®é¢˜ï¼ˆå‡è®¾ï¼‰
ClassLoader loader1 = new MyClassLoader();
ClassLoader loader2 = new MyClassLoader();
Class<?> class1 = loader1.loadClass("Student");
Class<?> class2 = loader2.loadClass("Student");
// é—®é¢˜ï¼šclass1 != class2ï¼ŒåŒä¸€ä¸ªç±»è¢«åŠ è½½äº†ä¸¤æ¬¡

// æœ‰åŒäº²å§”æ´¾çš„å¥½å¤„
// æ‰€æœ‰åŠ è½½å™¨æœ€ç»ˆéƒ½å§”æ´¾ç»™åŒä¸€ä¸ªçˆ¶åŠ è½½å™¨
// ç¡®ä¿åŒä¸€ä¸ªç±»åªè¢«åŠ è½½ä¸€æ¬¡
System.out.println(class1 == class2);  // true
```

**ä¼˜åŠ¿2ï¼šä¿è¯Javaæ ¸å¿ƒAPIä¸è¢«ç¯¡æ”¹**
```java
// æ¶æ„ä»£ç ç¤ºä¾‹ï¼ˆä¼šè¢«åŒäº²å§”æ´¾é˜»æ­¢ï¼‰
package java.lang;
public class String {  // è¯•å›¾æ›¿æ¢ç³»ç»ŸStringç±»
    public String(java.lang.String str) {
        System.out.println("æ¶æ„Stringè¢«åŠ è½½!");
    }
}

// åŒäº²å§”æ´¾çš„ä¿æŠ¤æœºåˆ¶ï¼š
// 1. è¯·æ±‚åŠ è½½java.lang.String
// 2. å§”æ´¾ç»™Bootstrap ClassLoader
// 3. Bootstrapå‘ç°rt.jarä¸­å·²æœ‰Stringç±»
// 4. ç›´æ¥è¿”å›ç³»ç»ŸStringç±»
// 5. æ¶æ„Stringç±»æ°¸è¿œä¸ä¼šè¢«åŠ è½½
```

**ä¼˜åŠ¿3ï¼šç¡®ä¿ç±»çš„å”¯ä¸€æ€§**
```java
// ç±»çš„å”¯ä¸€æ€§éªŒè¯
public class ClassIdentityTest {
    public static void main(String[] args) {
        // åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„åŒä¸€ä¸ªç±»ï¼ŒClasså¯¹è±¡ç›¸åŒ
        Class<?> c1 = String.class;
        Class<?> c2 = String.class;
        System.out.println(c1 == c2);  // true
        
        // ä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„åŒä¸€ä¸ªç±»ï¼ŒClasså¯¹è±¡ä¸åŒ
        // ï¼ˆéœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ‰èƒ½éªŒè¯ï¼‰
    }
}
```

### 2.6 åŒäº²å§”æ´¾çš„ç ´ååœºæ™¯ï¼šSPIã€OSGIã€çƒ­éƒ¨ç½²


**ğŸ”§ ç ´ååŒäº²å§”æ´¾çš„ä¸‰å¤§åœºæ™¯**

**åœºæ™¯1ï¼šSPIï¼ˆService Provider Interfaceï¼‰**
```java
// SPIæœºåˆ¶çš„é—®é¢˜
// Bootstrap ClassLoaderåŠ è½½çš„æ¥å£ï¼Œéœ€è¦åŠ è½½Application ClassLoaderè·¯å¾„ä¸‹çš„å®ç°ç±»

// è§£å†³æ–¹æ¡ˆï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨
Thread.currentThread().setContextClassLoader(appClassLoader);

// JDBCé©±åŠ¨åŠ è½½ç¤ºä¾‹
public class JDBCExample {
    public static void main(String[] args) {
        // DriverManagerç”±Bootstrap ClassLoaderåŠ è½½
        // ä½†MySQLé©±åŠ¨åœ¨åº”ç”¨ç¨‹åºç±»è·¯å¾„ä¸‹
        try {
            // é€šè¿‡SPIæœºåˆ¶å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è§£å†³
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/test", "user", "pass");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

**åœºæ™¯2ï¼šOSGIï¼ˆåŠ¨æ€æ¨¡å—ç³»ç»Ÿï¼‰**
```java
// OSGIçš„ç±»åŠ è½½æœºåˆ¶
// æ¯ä¸ªæ¨¡å—(Bundle)éƒ½æœ‰è‡ªå·±çš„ç±»åŠ è½½å™¨
// æ¨¡å—é—´å¯ä»¥ç›¸äº’å¯¼å…¥å¯¼å‡ºç±»

// OSGIç±»åŠ è½½é¡ºåºï¼š
// 1. java.*åŒ… â†’ å§”æ´¾ç»™çˆ¶åŠ è½½å™¨
// 2. å¯¼å…¥çš„åŒ… â†’ å§”æ´¾ç»™å¯¼å‡ºè¯¥åŒ…çš„Bundleç±»åŠ è½½å™¨
// 3. å½“å‰Bundleçš„ç±»è·¯å¾„
// 4. Fragment Bundleçš„ç±»è·¯å¾„
// 5. Dynamic Importçš„åŒ…

public class OSGIExample {
    // æ¨¡å—Aå¯¼å‡ºcom.example.serviceåŒ…
    // æ¨¡å—Bå¯¼å…¥com.example.serviceåŒ…
    // æ¨¡å—Bå¯ä»¥ä½¿ç”¨æ¨¡å—Aä¸­çš„ç±»ï¼Œç ´åäº†ä¼ ç»Ÿçš„åŒäº²å§”æ´¾
}
```

**åœºæ™¯3ï¼šçƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰**
```java
// çƒ­éƒ¨ç½²ç±»åŠ è½½å™¨
public class HotDeployClassLoader extends ClassLoader {
    private String classPath;
    
    public HotDeployClassLoader(String classPath) {
        this.classPath = classPath;
    }
    
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        // ç›´æ¥åŠ è½½ï¼Œä¸å§”æ´¾ç»™çˆ¶åŠ è½½å™¨
        byte[] classData = loadClassData(name);
        return defineClass(name, classData, 0, classData.length);
    }
    
    private byte[] loadClassData(String className) {
        // ä»æŒ‡å®šè·¯å¾„åŠ è½½æœ€æ–°çš„classæ–‡ä»¶
        // å®ç°çƒ­æ›´æ–°åŠŸèƒ½
        return null; // ç®€åŒ–ç¤ºä¾‹
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class HotDeployExample {
    public static void main(String[] args) throws Exception {
        while (true) {
            // æ¯æ¬¡åˆ›å»ºæ–°çš„ç±»åŠ è½½å™¨
            HotDeployClassLoader loader = new HotDeployClassLoader("/hot/deploy/path");
            Class<?> clazz = loader.loadClass("com.example.HotClass");
            Object instance = clazz.newInstance();
            
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            clazz.getMethod("execute").invoke(instance);
            
            Thread.sleep(5000);  // ç­‰å¾…5ç§’åé‡æ–°åŠ è½½
        }
    }
}
```

---

## 3. ğŸ”’ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸å®‰å…¨æœºåˆ¶


### 3.1 è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„å®ç°åŸç†


**ğŸ¯ è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åº”ç”¨åœºæ™¯**
```
1. åŠ å¯†çš„Classæ–‡ä»¶ï¼šè§£å¯†åå†åŠ è½½
2. ä»ç½‘ç»œåŠ è½½ç±»ï¼šä»è¿œç¨‹æœåŠ¡å™¨ä¸‹è½½ç±»æ–‡ä»¶
3. åŠ¨æ€ç”Ÿæˆç±»ï¼šè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºç±»çš„å­—èŠ‚ç 
4. éš”ç¦»ä¸åŒç‰ˆæœ¬ï¼šåŒä¸€ä¸ªåº”ç”¨åŠ è½½ä¸åŒç‰ˆæœ¬çš„åŒåç±»
5. çƒ­éƒ¨ç½²åŠŸèƒ½ï¼šä¸é‡å¯åº”ç”¨çš„æƒ…å†µä¸‹æ›´æ–°ç±»
```

**ğŸ”§ è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤**
```java
// æ­¥éª¤1ï¼šç»§æ‰¿ClassLoaderç±»
public class CustomClassLoader extends ClassLoader {
    private String classPath;
    
    public CustomClassLoader(String classPath) {
        this.classPath = classPath;
    }
    
    // æ­¥éª¤2ï¼šé‡å†™findClassæ–¹æ³•ï¼ˆæ¨èï¼‰
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        try {
            // å°†ç±»åè½¬æ¢ä¸ºæ–‡ä»¶è·¯å¾„
            String fileName = name.replace('.', '/') + ".class";
            String fullPath = classPath + "/" + fileName;
            
            // è¯»å–å­—èŠ‚ç æ–‡ä»¶
            byte[] classData = loadClassData(fullPath);
            
            // è°ƒç”¨defineClassæ–¹æ³•ç”ŸæˆClasså¯¹è±¡
            return defineClass(name, classData, 0, classData.length);
        } catch (Exception e) {
            throw new ClassNotFoundException("ç±»æœªæ‰¾åˆ°: " + name, e);
        }
    }
    
    // è¾…åŠ©æ–¹æ³•ï¼šè¯»å–å­—èŠ‚ç 
    private byte[] loadClassData(String path) throws IOException {
        try (FileInputStream fis = new FileInputStream(path);
             ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
            
            byte[] buffer = new byte[1024];
            int length;
            while ((length = fis.read(buffer)) != -1) {
                baos.write(buffer, 0, length);
            }
            return baos.toByteArray();
        }
    }
}
```

**ğŸ’¡ ä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨**
```java
public class CustomLoaderTest {
    public static void main(String[] args) throws Exception {
        // åˆ›å»ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨
        CustomClassLoader loader = new CustomClassLoader("/custom/classes");
        
        // åŠ è½½ç±»
        Class<?> clazz = loader.loadClass("com.example.MyClass");
        
        // åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•
        Object instance = clazz.newInstance();
        Method method = clazz.getMethod("sayHello");
        method.invoke(instance);
        
        // éªŒè¯ç±»åŠ è½½å™¨
        System.out.println("ç±»åŠ è½½å™¨: " + clazz.getClassLoader());
        System.out.println("çˆ¶åŠ è½½å™¨: " + clazz.getClassLoader().getParent());
    }
}
```

### 3.2 ClassLoaderç±»çš„æ ¸å¿ƒæ–¹æ³•


**ğŸ“‹ ClassLoaderæ ¸å¿ƒæ–¹æ³•è¯¦è§£**

| æ–¹æ³• | **ä½œç”¨** | **é‡å†™å»ºè®®** | **è°ƒç”¨æ—¶æœº** |
|------|---------|-------------|-------------|
| `loadClass()` | **åŠ è½½ç±»çš„å…¥å£æ–¹æ³•** | `ä¸€èˆ¬ä¸é‡å†™` | `å¤–éƒ¨è°ƒç”¨æ—¶` |
| `findClass()` | **æŸ¥æ‰¾å¹¶å®šä¹‰ç±»** | **æ¨èé‡å†™** | `loadClass()å§”æ´¾å¤±è´¥æ—¶` |
| `defineClass()` | **å°†å­—èŠ‚ç è½¬æ¢ä¸ºClasså¯¹è±¡** | `ä¸è¦é‡å†™` | `findClass()å†…éƒ¨è°ƒç”¨` |
| `resolveClass()` | **è§£æç±»ï¼ˆé“¾æ¥ï¼‰** | `ä¸€èˆ¬ä¸é‡å†™` | `éœ€è¦æ—¶æ‰‹åŠ¨è°ƒç”¨` |
| `findLoadedClass()` | **æŸ¥æ‰¾å·²åŠ è½½çš„ç±»** | `ä¸è¦é‡å†™` | `loadClass()å¼€å§‹æ—¶` |

**ğŸ’» æ ¸å¿ƒæ–¹æ³•ä½¿ç”¨ç¤ºä¾‹**
```java
public class MethodExampleLoader extends ClassLoader {
    
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        // 1. é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½
        Class<?> loaded = findLoadedClass(name);
        if (loaded != null) {
            return loaded;
        }
        
        // 2. è¯»å–å­—èŠ‚ç 
        byte[] classData = getClassData(name);
        
        // 3. å®šä¹‰ç±»ï¼ˆå…³é”®æ­¥éª¤ï¼‰
        Class<?> clazz = defineClass(name, classData, 0, classData.length);
        
        // 4. å¯é€‰ï¼šè§£æç±»
        resolveClass(clazz);
        
        return clazz;
    }
    
    private byte[] getClassData(String className) {
        // å®é™…çš„å­—èŠ‚ç è·å–é€»è¾‘
        return new byte[0]; // ç®€åŒ–ç¤ºä¾‹
    }
}
```

### 3.3 ç±»åŠ è½½å™¨çš„å‘½åç©ºé—´éš”ç¦»


**ğŸ  å‘½åç©ºé—´éš”ç¦»çš„æ¦‚å¿µ**
```
å‘½åç©ºé—´ï¼šæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´
éš”ç¦»åŸåˆ™ï¼šä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„åŒåç±»è¢«è§†ä¸ºä¸åŒçš„ç±»
åˆ¤æ–­æ ‡å‡†ï¼šClasså¯¹è±¡çš„å”¯ä¸€æ€§ = ç±»çš„å…¨é™å®šå + ç±»åŠ è½½å™¨
```

**ğŸ’¡ å‘½åç©ºé—´éš”ç¦»ç¤ºä¾‹**
```java
public class NamespaceExample {
    public static void main(String[] args) throws Exception {
        // åˆ›å»ºä¸¤ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨
        CustomClassLoader loader1 = new CustomClassLoader("/path1");
        CustomClassLoader loader2 = new CustomClassLoader("/path2");
        
        // åŠ è½½åŒåç±»
        Class<?> class1 = loader1.loadClass("com.example.SameClass");
        Class<?> class2 = loader2.loadClass("com.example.SameClass");
        
        // éªŒè¯éš”ç¦»æ€§
        System.out.println("class1 == class2: " + (class1 == class2));  // false
        System.out.println("class1.getName(): " + class1.getName());    // åŒå
        System.out.println("class2.getName(): " + class2.getName());    // åŒå
        
        // åˆ›å»ºå®ä¾‹
        Object obj1 = class1.newInstance();
        Object obj2 = class2.newInstance();
        
        // ç±»å‹è½¬æ¢å¤±è´¥ï¼ˆé‡è¦ç‰¹æ€§ï¼‰
        try {
            class1.cast(obj2);  // æŠ›å‡ºClassCastException
        } catch (ClassCastException e) {
            System.out.println("ç±»å‹è½¬æ¢å¤±è´¥: " + e.getMessage());
        }
    }
}
```

**ğŸ” å‘½åç©ºé—´çš„å®é™…åº”ç”¨**
```java
// Webåº”ç”¨çš„ç±»éš”ç¦»ç¤ºä¾‹
public class WebAppClassLoader extends ClassLoader {
    private String webAppPath;
    
    public WebAppClassLoader(String webAppPath, ClassLoader parent) {
        super(parent);
        this.webAppPath = webAppPath;
    }
    
    @Override
    protected Class<?> findClass(String name) throws ClassNotFoundException {
        // æ¯ä¸ªWebåº”ç”¨æœ‰ç‹¬ç«‹çš„ç±»åŠ è½½å™¨
        // å®ç°åº”ç”¨é—´çš„ç±»éš”ç¦»
        
        // 1. å…ˆä»WEB-INF/classesåŠ è½½
        // 2. å†ä»WEB-INF/lib/*.jaråŠ è½½
        // 3. æœ€åå§”æ´¾ç»™çˆ¶åŠ è½½å™¨
        
        return super.findClass(name);
    }
}

// Tomcatç±»åŠ è½½å™¨å±‚æ¬¡ç»“æ„
/*
    Bootstrap ClassLoader
           â†‘
    Extension ClassLoader
           â†‘
    System ClassLoader
           â†‘
    Common ClassLoader
           â†‘
    Catalina ClassLoader    Shared ClassLoader
           â†‘                      â†‘
    WebApp1 ClassLoader    WebApp2 ClassLoader
*/
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç±»åŠ è½½åˆ†ä¸º7ä¸ªé˜¶æ®µï¼ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–æ˜¯æ ¸å¿ƒ
- åŒäº²å§”æ´¾ä¿è¯ç±»çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§ï¼Œä½†åœ¨SPIã€OSGIã€çƒ­éƒ¨ç½²åœºæ™¯ä¸‹ä¼šè¢«ç ´å
- è‡ªå®šä¹‰ç±»åŠ è½½å™¨é€šè¿‡é‡å†™findClassæ–¹æ³•å®ç°ç‰¹å®šéœ€æ±‚
- å‘½åç©ºé—´éš”ç¦»ç¡®ä¿ä¸åŒç±»åŠ è½½å™¨çš„ç±»äº’ä¸å¹²æ‰°