---
title: 5ã€NIOä¸å¼‚æ­¥ç¼–ç¨‹
---
## ğŸ“š ç›®å½•

1. [NIOæ˜¯ä»€ä¹ˆ](#1-NIOæ˜¯ä»€ä¹ˆ)
2. [NIOä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ](#2-NIOä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ)
3. [NIOç¼–ç¨‹å®æˆ˜](#3-NIOç¼–ç¨‹å®æˆ˜)
4. [NIO vs ä¼ ç»ŸIOå¯¹æ¯”](#4-NIO-vs-ä¼ ç»ŸIOå¯¹æ¯”)
5. [å¼‚æ­¥ç¼–ç¨‹å…¥é—¨](#5-å¼‚æ­¥ç¼–ç¨‹å…¥é—¨)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ NIOæ˜¯ä»€ä¹ˆ


### 1.1 NIOçš„å®šä¹‰å’Œå«ä¹‰


**ğŸ”¸ NIOçš„å«ä¹‰**
```
NIOå…¨ç§°ï¼šNew Input/Output æˆ– Non-blocking Input/Output
ä¸­æ–‡æ„æ€ï¼šæ–°çš„è¾“å…¥è¾“å‡º æˆ– éé˜»å¡è¾“å…¥è¾“å‡º

ä»€ä¹ˆæ˜¯"æ–°çš„"ï¼Ÿ
ç›¸å¯¹äºä¼ ç»Ÿçš„IOï¼ˆä¹Ÿå«BIOï¼ŒBlocking IOï¼‰ï¼ŒNIOæ˜¯Java 1.4å¼•å…¥çš„æ–°IOæ–¹å¼

ä»€ä¹ˆæ˜¯"éé˜»å¡"ï¼Ÿ
ä¼ ç»ŸIOï¼šç­‰å¾…æ•°æ®æ—¶çº¿ç¨‹ä¼š"å¡ä½"ï¼ˆé˜»å¡ï¼‰
NIOï¼šç­‰å¾…æ•°æ®æ—¶çº¿ç¨‹å¯ä»¥å»åšåˆ«çš„äº‹ï¼ˆéé˜»å¡ï¼‰
```

### 1.2 ç”Ÿæ´»åŒ–ç†è§£NIO


**ğŸ½ï¸ é¤å…æœåŠ¡å‘˜çš„æ¯”å–»**
```
ä¼ ç»ŸIOå°±åƒä¸“èŒæœåŠ¡å‘˜ï¼š
ğŸ§‘â€ğŸ³ ä¼ ç»ŸIOï¼ˆBIOï¼‰               ğŸŒ ç½‘ç»œç¼–ç¨‹
â”œâ”€ ä¸€ä¸ªæœåŠ¡å‘˜åªæœåŠ¡ä¸€æ¡Œå®¢äºº      â”œâ”€ ä¸€ä¸ªçº¿ç¨‹åªå¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯
â”œâ”€ ç­‰å®¢äººç‚¹èœæ—¶å°±ç«™åœ¨æ—è¾¹ç­‰      â”œâ”€ ç­‰å¾…æ•°æ®æ—¶çº¿ç¨‹é˜»å¡
â”œâ”€ å®¢äººåƒå®Œæ‰èƒ½æœåŠ¡ä¸‹ä¸€æ¡Œ        â”œâ”€ å®¢æˆ·ç«¯æ–­å¼€æ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ª
â””â”€ æ•ˆç‡ä½ï¼Œæˆæœ¬é«˜                â””â”€ çº¿ç¨‹å¤šï¼Œå†…å­˜æ¶ˆè€—å¤§

NIOå°±åƒæœºçµçš„æœåŠ¡å‘˜ï¼š
ğŸ§‘â€ğŸ³ NIOï¼ˆéé˜»å¡IOï¼‰            ğŸŒ ç½‘ç»œç¼–ç¨‹
â”œâ”€ ä¸€ä¸ªæœåŠ¡å‘˜åŒæ—¶ç…§çœ‹å¤šæ¡Œ        â”œâ”€ ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯
â”œâ”€ çœ‹å“ªæ¡Œéœ€è¦æœåŠ¡å°±å»å“ªæ¡Œ        â”œâ”€ æ£€æŸ¥å“ªä¸ªè¿æ¥æœ‰æ•°æ®å°±å¤„ç†å“ªä¸ª
â”œâ”€ ä¸ä¼šå‚»ç­‰ï¼Œå››å¤„å·¡è§†            â”œâ”€ ä¸é˜»å¡ï¼Œè½®è¯¢æ£€æŸ¥æ‰€æœ‰è¿æ¥
â””â”€ æ•ˆç‡é«˜ï¼Œä¸€ä¸ªäººé¡¶å¥½å‡ ä¸ª        â””â”€ èµ„æºåˆ©ç”¨ç‡é«˜ï¼Œæ”¯æŒé«˜å¹¶å‘
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦NIO


**âš ï¸ ä¼ ç»ŸIOçš„é—®é¢˜**
```
å‡è®¾ä½ å†™äº†ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ï¼š
â€¢ æœ‰1000ä¸ªç”¨æˆ·åŒæ—¶åœ¨çº¿
â€¢ ä¼ ç»ŸIOéœ€è¦1000ä¸ªçº¿ç¨‹
â€¢ æ¯ä¸ªçº¿ç¨‹å ç”¨çº¦1MBå†…å­˜
â€¢ æ€»å…±éœ€è¦çº¦1GBå†…å­˜ï¼

è€Œä¸”å¤§éƒ¨åˆ†æ—¶é—´ç”¨æˆ·éƒ½ä¸è¯´è¯ï¼š
â€¢ 999ä¸ªçº¿ç¨‹åœ¨å‚»ç­‰ï¼ˆé˜»å¡çŠ¶æ€ï¼‰
â€¢ åªæœ‰1ä¸ªçº¿ç¨‹åœ¨çœŸæ­£å·¥ä½œ
â€¢ èµ„æºæµªè´¹ä¸¥é‡

NIOçš„è§£å†³æ–¹æ¡ˆï¼š
â€¢ åªç”¨1ä¸ªçº¿ç¨‹å°±èƒ½å¤„ç†1000ä¸ªç”¨æˆ·
â€¢ è°æœ‰æ¶ˆæ¯å°±å¤„ç†è°
â€¢ æ²¡æ¶ˆæ¯å°±æ£€æŸ¥ä¸‹ä¸€ä¸ª
â€¢ å†…å­˜å ç”¨åªæœ‰å‡ MBï¼
```

---

## 2. ğŸ§© NIOä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ


### 2.1 Channelï¼ˆé€šé“ï¼‰- æ•°æ®ä¼ è¾“çš„ç®¡é“


**ğŸ”¸ Channelæ˜¯ä»€ä¹ˆ**
```
Channel = æ•°æ®ä¼ è¾“çš„"ç®¡é“"

ä¼ ç»ŸIOï¼š                    NIOï¼š
InputStream  (å•å‘è¯»)       Channel (åŒå‘è¯»å†™)
OutputStream (å•å‘å†™)       ä¸€ä¸ªChannelå°±å¤Ÿäº†

å°±åƒï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦ä¸¤æ ¹æ°´ç®¡ï¼Œä¸€æ ¹è¿›æ°´ï¼Œä¸€æ ¹å‡ºæ°´
NIOæ–¹å¼ï¼šä¸€æ ¹æ°´ç®¡å°±è¡Œï¼Œæ—¢èƒ½è¿›æ°´ä¹Ÿèƒ½å‡ºæ°´
```

**ğŸ”§ å¸¸ç”¨çš„Channelç±»å‹**
```java
// ç½‘ç»œç›¸å…³çš„Channel
ServerSocketChannel  // æœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ç”¨
SocketChannel       // å¤„ç†å…·ä½“çš„å®¢æˆ·ç«¯è¿æ¥ç”¨
DatagramChannel     // UDPé€šä¿¡ç”¨

// æ–‡ä»¶ç›¸å…³çš„Channel  
FileChannel         // æ–‡ä»¶è¯»å†™ç”¨

// ç‰¹ç‚¹ï¼š
âœ… å¯ä»¥åŒæ—¶è¯»å’Œå†™
âœ… å¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
âœ… å¿…é¡»é…åˆBufferä½¿ç”¨
```

### 2.2 Bufferï¼ˆç¼“å†²åŒºï¼‰- æ•°æ®çš„ä¸´æ—¶å­˜æ”¾å¤„


**ğŸ”¸ Bufferæ˜¯ä»€ä¹ˆ**
```
Buffer = æ•°æ®çš„"ä¸­è½¬ç«™"

ä¼ ç»ŸIOï¼š                    NIOï¼š
ç›´æ¥è¯»å†™æµ                  æ•°æ®å…ˆæ”¾Bufferï¼Œå†ä»Bufferæ‹¿

å°±åƒï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šä»æ°´é¾™å¤´ç›´æ¥æ¥æ°´å–
NIOæ–¹å¼ï¼šå…ˆç”¨æ¯å­æ¥æ°´ï¼Œå†ä»æ¯å­é‡Œå–
```

**ğŸ“Š Bufferçš„ä¸‰ä¸ªé‡è¦å±æ€§**
```java
public class BufferDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º10çš„Buffer
        ByteBuffer buffer = ByteBuffer.allocate(10);
        
        System.out.println("=== åˆå§‹çŠ¶æ€ ===");
        printBufferStatus(buffer);
        // capacity=10, position=0, limit=10
        
        // å†™å…¥æ•°æ® "Hello"
        buffer.put("Hello".getBytes());
        System.out.println("=== å†™å…¥Helloå ===");
        printBufferStatus(buffer);
        // capacity=10, position=5, limit=10
        
        // åˆ‡æ¢åˆ°è¯»æ¨¡å¼
        buffer.flip();
        System.out.println("=== åˆ‡æ¢åˆ°è¯»æ¨¡å¼å ===");
        printBufferStatus(buffer);
        // capacity=10, position=0, limit=5
        
        // è¯»å–æ•°æ®
        byte[] data = new byte[buffer.remaining()];
        buffer.get(data);
        System.out.println("è¯»åˆ°çš„æ•°æ®: " + new String(data));
        System.out.println("=== è¯»å–æ•°æ®å ===");
        printBufferStatus(buffer);
        // capacity=10, position=5, limit=5
        
        // æ¸…ç©ºå‡†å¤‡ä¸‹æ¬¡ä½¿ç”¨
        buffer.clear();
        System.out.println("=== æ¸…ç©ºå ===");
        printBufferStatus(buffer);
        // capacity=10, position=0, limit=10
    }
    
    private static void printBufferStatus(ByteBuffer buffer) {
        System.out.printf("capacity=%d, position=%d, limit=%d%n", 
            buffer.capacity(), buffer.position(), buffer.limit());
    }
}
```

**ğŸ“ Bufferä¸‰ä¸ªå±æ€§çš„å«ä¹‰**
```
capacityï¼ˆå®¹é‡ï¼‰ï¼š
â€¢ Bufferçš„æ€»å¤§å°ï¼Œåˆ›å»ºåä¸èƒ½æ”¹å˜
â€¢ å°±åƒæ¯å­çš„å®¹é‡

positionï¼ˆä½ç½®ï¼‰ï¼š
â€¢ å½“å‰è¯»å†™çš„ä½ç½®
â€¢ å°±åƒæ¯å­é‡Œæ°´çš„ä½ç½®æŒ‡é’ˆ

limitï¼ˆç•Œé™ï¼‰ï¼š
â€¢ å¯ä»¥è¯»å†™çš„æœ€å¤§ä½ç½®
â€¢ å†™æ¨¡å¼ï¼šlimit = capacityï¼ˆå¯ä»¥å†™æ»¡ï¼‰
â€¢ è¯»æ¨¡å¼ï¼šlimit = ä¹‹å‰å†™å…¥çš„æ•°æ®é‡ï¼ˆåªèƒ½è¯»åˆ°æœ‰æ•°æ®çš„åœ°æ–¹ï¼‰
```

### 2.3 Selectorï¼ˆé€‰æ‹©å™¨ï¼‰- äº‹ä»¶ç›‘å¬å™¨


**ğŸ”¸ Selectoræ˜¯ä»€ä¹ˆ**
```
Selector = "äº‹ä»¶ç›‘å¬å™¨"

ä¼ ç»ŸIOï¼š                    NIOï¼š
éœ€è¦ä¸æ–­é—®ï¼šæœ‰æ•°æ®å—ï¼Ÿ      Selectorå¸®ä½ ç›‘å¬ï¼Œæœ‰äº‹ä»¶å°±é€šçŸ¥

å°±åƒï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šä¿å®‰æ¯éš”å‡ åˆ†é’Ÿå»æ¯ä¸ªé—¨å£çœ‹çœ‹æœ‰æ²¡æœ‰äºº
NIOæ–¹å¼ï¼šåœ¨æ¯ä¸ªé—¨å£è£…ä¸ªé—¨é“ƒï¼Œæœ‰äººæ¥å°±å“é“ƒé€šçŸ¥ä¿å®‰
```

**ğŸ”” Selectorç›‘å¬çš„äº‹ä»¶ç±»å‹**
```java
// å››ç§åŸºæœ¬äº‹ä»¶ç±»å‹
SelectionKey.OP_ACCEPT   // æœ‰æ–°å®¢æˆ·ç«¯è¦è¿æ¥
SelectionKey.OP_CONNECT  // è¿æ¥å»ºç«‹å®Œæˆ
SelectionKey.OP_READ     // æœ‰æ•°æ®å¯ä»¥è¯»
SelectionKey.OP_WRITE    // å¯ä»¥å†™æ•°æ®

// ä½¿ç”¨ç¤ºä¾‹
Selector selector = Selector.open();

// è®©Channelæ³¨å†Œåˆ°Selectorï¼Œç›‘å¬æŒ‡å®šäº‹ä»¶
serverChannel.register(selector, SelectionKey.OP_ACCEPT); // ç›‘å¬æ–°è¿æ¥
clientChannel.register(selector, SelectionKey.OP_READ);   // ç›‘å¬è¯»äº‹ä»¶
```

---

## 3. ğŸ’» NIOç¼–ç¨‹å®æˆ˜


### 3.1 æœ€ç®€å•çš„NIOå®¢æˆ·ç«¯


**ğŸ“± NIOå®¢æˆ·ç«¯ä»£ç **
```java
import java.net.*;
import java.nio.*;
import java.nio.channels.*;

public class SimpleNIOClient {
    public static void main(String[] args) {
        try {
            // 1. åˆ›å»ºSocketChannel
            SocketChannel channel = SocketChannel.open();
            channel.configureBlocking(false); // è®¾ç½®ä¸ºéé˜»å¡
            
            // 2. è¿æ¥æœåŠ¡å™¨
            boolean connected = channel.connect(new InetSocketAddress("localhost", 8080));
            
            // 3. å¦‚æœæ²¡æœ‰ç«‹å³è¿æ¥æˆåŠŸï¼Œç­‰å¾…è¿æ¥å®Œæˆ
            if (!connected) {
                while (!channel.finishConnect()) {
                    System.out.println("è¿˜åœ¨è¿æ¥ä¸­...");
                    Thread.sleep(100);
                }
            }
            System.out.println("è¿æ¥æˆåŠŸï¼");
            
            // 4. å‘é€æ•°æ®
            String message = "Hello NIO Server!";
            ByteBuffer buffer = ByteBuffer.wrap(message.getBytes());
            channel.write(buffer);
            System.out.println("æ¶ˆæ¯å·²å‘é€: " + message);
            
            // 5. æ¥æ”¶å›å¤
            ByteBuffer readBuffer = ByteBuffer.allocate(1024);
            int bytesRead = channel.read(readBuffer);
            
            if (bytesRead > 0) {
                readBuffer.flip(); // åˆ‡æ¢åˆ°è¯»æ¨¡å¼
                byte[] data = new byte[readBuffer.remaining()];
                readBuffer.get(data);
                System.out.println("æœåŠ¡å™¨å›å¤: " + new String(data));
            }
            
            // 6. å…³é—­è¿æ¥
            channel.close();
            
        } catch (Exception e) {
            System.out.println("å®¢æˆ·ç«¯å‡ºé”™: " + e.getMessage());
        }
    }
}
```

### 3.2 ç®€å•çš„NIOæœåŠ¡å™¨


**ğŸ–¥ï¸ NIOæœåŠ¡å™¨ä»£ç **
```java
import java.net.*;
import java.nio.*;
import java.nio.channels.*;
import java.util.*;

public class SimpleNIOServer {
    public static void main(String[] args) {
        try {
            // 1. åˆ›å»ºServerSocketChannel
            ServerSocketChannel serverChannel = ServerSocketChannel.open();
            serverChannel.configureBlocking(false); // éé˜»å¡
            serverChannel.bind(new InetSocketAddress(8080));
            
            // 2. åˆ›å»ºSelector
            Selector selector = Selector.open();
            serverChannel.register(selector, SelectionKey.OP_ACCEPT);
            
            System.out.println("NIOæœåŠ¡å™¨å¯åŠ¨ï¼Œç«¯å£8080ï¼Œç­‰å¾…è¿æ¥...");
            
            // 3. ä¸»å¾ªç¯ï¼šå¤„ç†äº‹ä»¶
            while (true) {
                // ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼ˆæœ€å¤šç­‰1ç§’ï¼‰
                int eventCount = selector.select(1000);
                
                if (eventCount == 0) {
                    // æ²¡æœ‰äº‹ä»¶ï¼Œç»§ç»­ç­‰å¾…
                    continue;
                }
                
                // 4. å¤„ç†æ‰€æœ‰å°±ç»ªçš„äº‹ä»¶
                Set<SelectionKey> keys = selector.selectedKeys();
                Iterator<SelectionKey> iterator = keys.iterator();
                
                while (iterator.hasNext()) {
                    SelectionKey key = iterator.next();
                    iterator.remove(); // é‡è¦ï¼šå¤„ç†å®Œè¦ç§»é™¤
                    
                    if (key.isAcceptable()) {
                        // æœ‰æ–°å®¢æˆ·ç«¯è¦è¿æ¥
                        handleAccept(key, selector);
                    } else if (key.isReadable()) {
                        // æœ‰æ•°æ®å¯ä»¥è¯»
                        handleRead(key);
                    }
                }
            }
            
        } catch (Exception e) {
            System.out.println("æœåŠ¡å™¨å‡ºé”™: " + e.getMessage());
        }
    }
    
    // å¤„ç†æ–°è¿æ¥
    private static void handleAccept(SelectionKey key, Selector selector) throws Exception {
        ServerSocketChannel serverChannel = (ServerSocketChannel) key.channel();
        SocketChannel clientChannel = serverChannel.accept();
        
        if (clientChannel != null) {
            clientChannel.configureBlocking(false);
            clientChannel.register(selector, SelectionKey.OP_READ);
            System.out.println("æ–°å®¢æˆ·ç«¯è¿æ¥: " + clientChannel.getRemoteAddress());
        }
    }
    
    // å¤„ç†è¯»æ•°æ®
    private static void handleRead(SelectionKey key) throws Exception {
        SocketChannel clientChannel = (SocketChannel) key.channel();
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        
        try {
            int bytesRead = clientChannel.read(buffer);
            
            if (bytesRead > 0) {
                // æœ‰æ•°æ®
                buffer.flip(); // åˆ‡æ¢åˆ°è¯»æ¨¡å¼
                byte[] data = new byte[buffer.remaining()];
                buffer.get(data);
                String message = new String(data);
                System.out.println("æ”¶åˆ°æ¶ˆæ¯: " + message);
                
                // å›å¤æ¶ˆæ¯
                String reply = "Echo: " + message;
                ByteBuffer replyBuffer = ByteBuffer.wrap(reply.getBytes());
                clientChannel.write(replyBuffer);
                
            } else if (bytesRead == -1) {
                // å®¢æˆ·ç«¯æ–­å¼€è¿æ¥
                System.out.println("å®¢æˆ·ç«¯æ–­å¼€: " + clientChannel.getRemoteAddress());
                key.cancel(); // å–æ¶ˆç›‘å¬
                clientChannel.close();
            }
            
        } catch (Exception e) {
            System.out.println("å¤„ç†å®¢æˆ·ç«¯æ•°æ®å‡ºé”™: " + e.getMessage());
            key.cancel();
            clientChannel.close();
        }
    }
}
```

### 3.3 Bufferæ“ä½œè¯¦è§£


**ğŸ“¦ Bufferçš„å¸¸ç”¨æ“ä½œ**
```java
public class BufferOperations {
    public static void main(String[] args) {
        // åˆ›å»ºBufferçš„å‡ ç§æ–¹å¼
        ByteBuffer buffer1 = ByteBuffer.allocate(10);        // å †å†…å­˜
        ByteBuffer buffer2 = ByteBuffer.allocateDirect(10);  // ç›´æ¥å†…å­˜ï¼ˆæ›´å¿«ï¼‰
        ByteBuffer buffer3 = ByteBuffer.wrap("Hello".getBytes()); // åŒ…è£…æ•°ç»„
        
        // åŸºæœ¬æ“ä½œæ¼”ç¤º
        ByteBuffer buffer = ByteBuffer.allocate(10);
        
        // å†™å…¥æ•°æ®
        buffer.put((byte) 'H');
        buffer.put((byte) 'i');
        System.out.println("å†™å…¥Hiå position=" + buffer.position()); // position=2
        
        // æ‰¹é‡å†™å…¥
        buffer.put("NIO".getBytes());
        System.out.println("å†™å…¥NIOå position=" + buffer.position()); // position=5
        
        // åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼ˆé‡è¦ï¼ï¼‰
        buffer.flip();
        System.out.println("flipå position=" + buffer.position() + ", limit=" + buffer.limit());
        // position=0, limit=5
        
        // è¯»å–æ•°æ®
        while (buffer.hasRemaining()) {
            System.out.print((char) buffer.get());
        }
        System.out.println(); // è¾“å‡ºï¼šHiNIO
        
        // é‡æ–°è¯»å–ï¼ˆä»å¤´å¼€å§‹ï¼‰
        buffer.rewind();
        System.out.println("rewindåå¯ä»¥é‡æ–°è¯»å–:");
        while (buffer.hasRemaining()) {
            System.out.print((char) buffer.get());
        }
        System.out.println(); // å†æ¬¡è¾“å‡ºï¼šHiNIO
        
        // æ¸…ç©ºBufferå‡†å¤‡ä¸‹æ¬¡ä½¿ç”¨
        buffer.clear();
        System.out.println("clearå position=" + buffer.position() + ", limit=" + buffer.limit());
        // position=0, limit=10ï¼ˆæ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼‰
    }
}
```

**ğŸ”§ Bufferæ“ä½œè¦ç‚¹**
```
é‡è¦çš„Bufferæ“ä½œï¼š

flip()ï¼šå†™æ¨¡å¼ â†’ è¯»æ¨¡å¼
â€¢ å°†limitè®¾ä¸ºpositionçš„å€¼
â€¢ å°†positionè®¾ä¸º0
â€¢ å‡†å¤‡ä»å¤´å¼€å§‹è¯»å–

clear()ï¼šæ¸…ç©ºBuffer
â€¢ positionè®¾ä¸º0
â€¢ limitè®¾ä¸ºcapacity
â€¢ å‡†å¤‡æ–°çš„å†™å…¥

rewind()ï¼šé‡æ–°è¯»å–
â€¢ positionè®¾ä¸º0
â€¢ limitä¸å˜
â€¢ å¯ä»¥é‡æ–°è¯»å–ç›¸åŒçš„æ•°æ®

è®°ä½ï¼šå†™å®Œæ•°æ®ä¸€å®šè¦flip()ï¼Œå¦åˆ™è¯»ä¸åˆ°æ•°æ®ï¼
```

---

## 4. âš–ï¸ NIO vs ä¼ ç»ŸIOå¯¹æ¯”


### 4.1 ç›´è§‚å¯¹æ¯”


**ğŸ“Š ç‰¹æ€§å¯¹æ¯”è¡¨**

| ç‰¹æ€§ | **ä¼ ç»ŸIOï¼ˆBIOï¼‰** | **NIO** |
|------|------------------|---------|
| ğŸ”— **é˜»å¡æ€§** | `é˜»å¡ï¼ˆçº¿ç¨‹ç­‰å¾…ï¼‰` | `éé˜»å¡ï¼ˆçº¿ç¨‹ä¸ç­‰å¾…ï¼‰` |
| ğŸ§µ **çº¿ç¨‹æ¨¡å‹** | `ä¸€è¿æ¥ä¸€çº¿ç¨‹` | `ä¸€çº¿ç¨‹å¤„ç†å¤šè¿æ¥` |
| ğŸ“Š **æ•°æ®å¤„ç†** | `é¢å‘æµï¼ˆStreamï¼‰` | `é¢å‘ç¼“å†²åŒºï¼ˆBufferï¼‰` |
| ğŸ¯ **é€‰æ‹©å™¨** | `æ— ` | `æœ‰Selectoräº‹ä»¶æœºåˆ¶` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `æ¯çº¿ç¨‹çº¦1MB` | `å›ºå®šå°‘é‡å†…å­˜` |
| ğŸš€ **å¹¶å‘èƒ½åŠ›** | `å‡ ç™¾ä¸ªè¿æ¥` | `å‡ ä¸‡ä¸ªè¿æ¥` |
| ğŸ§  **ç¼–ç¨‹éš¾åº¦** | `ç®€å•æ˜“æ‡‚` | `ç›¸å¯¹å¤æ‚` |

### 4.2 æ€§èƒ½å¯¹æ¯”å®ä¾‹


**âš¡ å¹¶å‘è¿æ¥æ•°å¯¹æ¯”**
```java
public class PerformanceComparison {
    public static void main(String[] args) {
        System.out.println("=== ä¼ ç»ŸIO vs NIO æ€§èƒ½å¯¹æ¯” ===");
        System.out.println();
        
        System.out.println("1000ä¸ªå¹¶å‘è¿æ¥çš„èµ„æºæ¶ˆè€—ï¼š");
        System.out.println("ä¼ ç»ŸIOï¼š");
        System.out.println("  - éœ€è¦1000ä¸ªçº¿ç¨‹");
        System.out.println("  - å†…å­˜æ¶ˆè€—ï¼š1000 Ã— 1MB = 1GB");
        System.out.println("  - CPUï¼šå¤§é‡ä¸Šä¸‹æ–‡åˆ‡æ¢");
        System.out.println();
        
        System.out.println("NIOï¼š");
        System.out.println("  - éœ€è¦1ä¸ªçº¿ç¨‹");
        System.out.println("  - å†…å­˜æ¶ˆè€—ï¼šçº¦10MB");
        System.out.println("  - CPUï¼šäº‹ä»¶é©±åŠ¨ï¼Œæ•ˆç‡é«˜");
        System.out.println();
        
        System.out.println("10000ä¸ªå¹¶å‘è¿æ¥ï¼š");
        System.out.println("ä¼ ç»ŸIOï¼šå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒï¼ˆçº¿ç¨‹å¤ªå¤šï¼‰");
        System.out.println("NIOï¼šè½»æ¾å¤„ç†");
    }
}
```

### 4.3 ä»€ä¹ˆæ—¶å€™ç”¨å“ªç§IO


**ğŸ¤” é€‰æ‹©æŒ‡å—**
```
é€‰æ‹©ä¼ ç»ŸIOï¼ˆBIOï¼‰çš„æƒ…å†µï¼š
âœ… è¿æ¥æ•°é‡å°‘ï¼ˆå°äº100ä¸ªï¼‰
âœ… è¿æ¥æ—¶é—´çŸ­ï¼ˆçŸ­è¿æ¥ï¼‰
âœ… å¼€å‘æ—¶é—´ç´§ï¼ˆBIOæ›´ç®€å•ï¼‰
âœ… å›¢é˜Ÿå¯¹NIOä¸ç†Ÿæ‚‰
âœ… ä¸šåŠ¡é€»è¾‘ç®€å•

ä¾‹å­ï¼šç®€å•çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€å†…éƒ¨ç®¡ç†ç³»ç»Ÿ

é€‰æ‹©NIOçš„æƒ…å†µï¼š
âœ… è¿æ¥æ•°é‡å¤šï¼ˆå¤§äº1000ä¸ªï¼‰
âœ… è¿æ¥æ—¶é—´é•¿ï¼ˆé•¿è¿æ¥ï¼‰
âœ… å¯¹æ€§èƒ½è¦æ±‚é«˜
âœ… éœ€è¦æ”¯æŒå¤§é‡å¹¶å‘
âœ… å®æ—¶æ€§è¦æ±‚é«˜

ä¾‹å­ï¼šèŠå¤©æœåŠ¡å™¨ã€æ¸¸æˆæœåŠ¡å™¨ã€æ¨é€æœåŠ¡ã€é«˜å¹¶å‘WebæœåŠ¡å™¨
```

### 4.4 çœŸå®åœºæ™¯ä¸¾ä¾‹


**ğŸ® æ¸¸æˆæœåŠ¡å™¨åœºæ™¯**
```
ä¼ ç»ŸIOæ–¹æ¡ˆï¼š
â€¢ 1ä¸‡ä¸ªåœ¨çº¿ç©å®¶ = 1ä¸‡ä¸ªçº¿ç¨‹
â€¢ å†…å­˜éœ€æ±‚ï¼š10GB+
â€¢ å¤§éƒ¨åˆ†æ—¶é—´ç©å®¶ä¸æ“ä½œï¼Œçº¿ç¨‹ç©ºé—²
â€¢ ç³»ç»Ÿèµ„æºæµªè´¹ä¸¥é‡
â€¢ å¯èƒ½æ— æ³•æ‰¿è½½è¿™ä¹ˆå¤šç©å®¶

NIOæ–¹æ¡ˆï¼š
â€¢ 1ä¸‡ä¸ªåœ¨çº¿ç©å®¶ = å°‘æ•°å‡ ä¸ªçº¿ç¨‹
â€¢ å†…å­˜éœ€æ±‚ï¼šå‡ åMB
â€¢ äº‹ä»¶é©±åŠ¨ï¼Œæœ‰ç©å®¶æ“ä½œæ‰å¤„ç†
â€¢ èµ„æºåˆ©ç”¨ç‡é«˜
â€¢ è½»æ¾æ”¯æŒæ›´å¤šç©å®¶
```

---

## 5. ğŸš€ å¼‚æ­¥ç¼–ç¨‹å…¥é—¨


### 5.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹


**ğŸ”¸ å¼‚æ­¥çš„å«ä¹‰**
```
åŒæ­¥ï¼ˆSynchronousï¼‰ï¼š
ä½ å»é“¶è¡ŒåŠäº‹ï¼Œæ’é˜Ÿç­‰å¾…ï¼ŒåŠå®Œä¸€ä»¶äº‹æ‰èƒ½åŠä¸‹ä¸€ä»¶äº‹
ç‰¹ç‚¹ï¼šç­‰å¾…ï¼ŒæŒ‰é¡ºåºï¼Œé˜»å¡

å¼‚æ­¥ï¼ˆAsynchronousï¼‰ï¼š
ä½ åœ¨ç½‘ä¸Šæäº¤ç”³è¯·ï¼Œæäº¤åä¸ç”¨ç­‰ï¼Œå¯ä»¥å»åšåˆ«çš„äº‹ï¼Œ
å¤„ç†å®Œäº†é“¶è¡Œä¼šé€šçŸ¥ä½ 
ç‰¹ç‚¹ï¼šä¸ç­‰å¾…ï¼Œå¯å¹¶è¡Œï¼Œéé˜»å¡
```

### 5.2 Javaå¼‚æ­¥ç¼–ç¨‹ç®€å•ç¤ºä¾‹


**ğŸ“ å›è°ƒæ–¹å¼çš„å¼‚æ­¥**
```java
import java.util.concurrent.*;

public class AsyncExample {
    public static void main(String[] args) {
        System.out.println("å¼€å§‹å¼‚æ­¥ä»»åŠ¡...");
        
        // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡
        CompletableFuture<String> future = CompletableFuture.supplyAsync(() -> {
            try {
                Thread.sleep(2000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                return "ä»»åŠ¡å®Œæˆï¼";
            } catch (InterruptedException e) {
                return "ä»»åŠ¡å¤±è´¥ï¼";
            }
        });
        
        // ä»»åŠ¡å®Œæˆåçš„å¤„ç†ï¼ˆå›è°ƒï¼‰
        future.thenAccept(result -> {
            System.out.println("æ”¶åˆ°ç»“æœ: " + result);
        });
        
        // ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹
        System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡...");
        for (int i = 1; i <= 5; i++) {
            System.out.println("ä¸»çº¿ç¨‹å·¥ä½œ: " + i);
            try {
                Thread.sleep(500);
            } catch (InterruptedException e) {
                break;
            }
        }
        
        // ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆ
        try {
            future.get(); // ç­‰å¾…å®Œæˆ
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 5.3 å¼‚æ­¥ç½‘ç»œç¼–ç¨‹ç¤ºä¾‹


**ğŸŒ å¼‚æ­¥æœåŠ¡å™¨ç®€å•ç¤ºä¾‹**
```java
import java.net.*;
import java.nio.*;
import java.nio.channels.*;
import java.util.concurrent.*;

public class SimpleAsyncServer {
    public static void main(String[] args) {
        try {
            // åˆ›å»ºå¼‚æ­¥æœåŠ¡å™¨é€šé“
            AsynchronousServerSocketChannel serverChannel = 
                AsynchronousServerSocketChannel.open();
            serverChannel.bind(new InetSocketAddress(8080));
            
            System.out.println("å¼‚æ­¥æœåŠ¡å™¨å¯åŠ¨ï¼Œç«¯å£8080");
            
            // å¼‚æ­¥æ¥å—è¿æ¥
            serverChannel.accept(null, new CompletionHandler<
                AsynchronousSocketChannel, Void>() {
                
                @Override
                public void completed(AsynchronousSocketChannel clientChannel, Void attachment) {
                    // ç»§ç»­æ¥å—ä¸‹ä¸€ä¸ªè¿æ¥
                    serverChannel.accept(null, this);
                    
                    // å¤„ç†å½“å‰è¿æ¥
                    System.out.println("å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ");
                    handleClient(clientChannel);
                }
                
                @Override
                public void failed(Throwable exc, Void attachment) {
                    System.out.println("æ¥å—è¿æ¥å¤±è´¥: " + exc.getMessage());
                }
            });
            
            // ä¿æŒç¨‹åºè¿è¡Œ
            System.out.println("æŒ‰å›è½¦é”®é€€å‡º...");
            System.in.read();
            
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    private static void handleClient(AsynchronousSocketChannel clientChannel) {
        ByteBuffer buffer = ByteBuffer.allocate(1024);
        
        // å¼‚æ­¥è¯»å–æ•°æ®
        clientChannel.read(buffer, buffer, new CompletionHandler<Integer, ByteBuffer>() {
            @Override
            public void completed(Integer bytesRead, ByteBuffer attachment) {
                if (bytesRead > 0) {
                    attachment.flip();
                    byte[] data = new byte[attachment.remaining()];
                    attachment.get(data);
                    String message = new String(data);
                    System.out.println("æ”¶åˆ°æ¶ˆæ¯: " + message);
                    
                    // å¼‚æ­¥å‘é€å›å¤
                    String reply = "Echo: " + message;
                    ByteBuffer replyBuffer = ByteBuffer.wrap(reply.getBytes());
                    clientChannel.write(replyBuffer, null, new CompletionHandler<Integer, Void>() {
                        @Override
                        public void completed(Integer result, Void attachment) {
                            System.out.println("å›å¤å‘é€å®Œæˆ");
                            try {
                                clientChannel.close();
                            } catch (Exception e) {
                                e.printStackTrace();
                            }
                        }
                        
                        @Override
                        public void failed(Throwable exc, Void attachment) {
                            System.out.println("å›å¤å‘é€å¤±è´¥: " + exc.getMessage());
                        }
                    });
                }
            }
            
            @Override
            public void failed(Throwable exc, Void attachment) {
                System.out.println("è¯»å–æ•°æ®å¤±è´¥: " + exc.getMessage());
            }
        });
    }
}
```

### 5.4 å¼‚æ­¥ç¼–ç¨‹çš„ä¼˜ç¼ºç‚¹


**âœ… å¼‚æ­¥ç¼–ç¨‹çš„å¥½å¤„**
```
æ€§èƒ½ä¼˜åŠ¿ï¼š
â€¢ ä¸é˜»å¡çº¿ç¨‹ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜
â€¢ å¯ä»¥åŒæ—¶å¤„ç†æ›´å¤šä»»åŠ¡
â€¢ å“åº”é€Ÿåº¦å¿«

èµ„æºä¼˜åŠ¿ï¼š
â€¢ å‡å°‘çº¿ç¨‹æ•°é‡
â€¢ é™ä½å†…å­˜æ¶ˆè€—
â€¢ å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢
```

**âŒ å¼‚æ­¥ç¼–ç¨‹çš„éš¾ç‚¹**
```
ç¼–ç¨‹å¤æ‚åº¦ï¼š
â€¢ ä»£ç ä¸å†æ˜¯çº¿æ€§çš„ï¼Œéš¾ä»¥ç†è§£
â€¢ è°ƒè¯•å›°éš¾
â€¢ é”™è¯¯å¤„ç†å¤æ‚

å›è°ƒåœ°ç‹±ï¼š
â€¢ å›è°ƒå¥—å›è°ƒï¼Œä»£ç åµŒå¥—æ·±
â€¢ ç»´æŠ¤å›°éš¾
â€¢ å®¹æ˜“å‡ºé”™

å­¦ä¹ æˆæœ¬ï¼š
â€¢ éœ€è¦æ”¹å˜ç¼–ç¨‹æ€ç»´
â€¢ éœ€è¦ç†è§£å¼‚æ­¥æ¦‚å¿µ
â€¢ æ¡†æ¶å’Œå·¥å…·å¤æ‚
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


```
ğŸ”¸ NIO = æ–°çš„IOæ–¹å¼ï¼Œéé˜»å¡ï¼Œä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¿æ¥
ğŸ”¸ Channel = æ•°æ®ä¼ è¾“ç®¡é“ï¼Œæ—¢èƒ½è¯»åˆèƒ½å†™
ğŸ”¸ Buffer = æ•°æ®ä¸­è½¬ç«™ï¼Œè¯»å†™æ•°æ®éƒ½è¦ç»è¿‡Buffer
ğŸ”¸ Selector = äº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘æ§å¤šä¸ªChannelçš„äº‹ä»¶
ğŸ”¸ éé˜»å¡ = ä¸ç­‰å¾…ï¼Œå¯ä»¥å»åšå…¶ä»–äº‹æƒ…
ğŸ”¸ å¼‚æ­¥ = æäº¤ä»»åŠ¡åä¸ç­‰ç»“æœï¼Œå®Œæˆåé€šè¿‡å›è°ƒé€šçŸ¥
```

### 6.2 é‡è¦æ“ä½œè¦ç‚¹


**ğŸ”¹ Bufferæ“ä½œå¥—è·¯**
```
å†™æ•°æ®çš„å¥—è·¯ï¼š
1. buffer.clear()     // å‡†å¤‡å†™å…¥
2. buffer.put(data)   // å†™å…¥æ•°æ®
3. buffer.flip()      // åˆ‡æ¢åˆ°è¯»æ¨¡å¼

è¯»æ•°æ®çš„å¥—è·¯ï¼š
1. buffer.flip()      // ç¡®ä¿åœ¨è¯»æ¨¡å¼
2. buffer.get(data)   // è¯»å–æ•°æ®
3. buffer.clear()     // å‡†å¤‡ä¸‹æ¬¡å†™å…¥

è®°ä½ï¼šå†™å®Œå¿…é¡»flip()ï¼Œå¦åˆ™è¯»ä¸åˆ°æ•°æ®ï¼
```

**ğŸ”¹ NIOç¼–ç¨‹å¥—è·¯**
```
NIOæœåŠ¡å™¨çš„åŸºæœ¬æµç¨‹ï¼š
1. åˆ›å»ºServerSocketChannelå¹¶è®¾ä¸ºéé˜»å¡
2. åˆ›å»ºSelector
3. å°†ServerSocketChannelæ³¨å†Œåˆ°Selectorç›‘å¬ACCEPTäº‹ä»¶
4. å¾ªç¯è°ƒç”¨selector.select()ç­‰å¾…äº‹ä»¶
5. å¤„ç†å°±ç»ªçš„äº‹ä»¶ï¼ˆACCEPTã€READã€WRITEï¼‰
6. å¤„ç†å®Œäº‹ä»¶åä»selectedKeysä¸­ç§»é™¤

æ³¨æ„ï¼šå¤„ç†å®ŒSelectionKeyä¸€å®šè¦remove()ï¼
```

### 6.3 æŠ€æœ¯é€‰æ‹©æŒ‡å—


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨NIO**
```
âœ… é«˜å¹¶å‘åœºæ™¯ï¼ˆ>1000è¿æ¥ï¼‰
âœ… é•¿è¿æ¥åº”ç”¨ï¼ˆèŠå¤©ã€æ¸¸æˆï¼‰
âœ… å®æ—¶æ€§è¦æ±‚é«˜
âœ… æœåŠ¡å™¨èµ„æºæœ‰é™
âœ… éœ€è¦æ”¯æŒå¤§é‡ç©ºé—²è¿æ¥

ä¾‹å­ï¼šèŠå¤©æœåŠ¡å™¨ã€æ¨é€æœåŠ¡ã€æ¸¸æˆæœåŠ¡å™¨
```

**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨ä¼ ç»ŸIO**
```
âœ… è¿æ¥æ•°é‡å°‘ï¼ˆ<100ï¼‰
âœ… çŸ­è¿æ¥åº”ç”¨
âœ… ç®€å•çš„ä¸šåŠ¡é€»è¾‘
âœ… å¼€å‘æ—¶é—´ç´§å¼ 
âœ… å›¢é˜ŸæŠ€æœ¯æ°´å¹³æœ‰é™

ä¾‹å­ï¼šç®€å•å·¥å…·ã€å†…éƒ¨ç³»ç»Ÿã€æ–‡ä»¶ä¼ è¾“
```


**æ ¸å¿ƒè®°å¿†**ï¼š
- NIOç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¿æ¥ï¼Œæ•ˆç‡é«˜ä½†å¤æ‚
- Bufferæ˜¯æ•°æ®ä¸­è½¬ç«™ï¼Œå†™å®Œè¦flip()æ‰èƒ½è¯»
- Selectorç›‘å¬äº‹ä»¶ï¼Œæœ‰äº‹ä»¶æ‰å¤„ç†ï¼Œæ²¡äº‹ä»¶å°±ç­‰å¾…
- å¼‚æ­¥ç¼–ç¨‹ä¸ç­‰å¾…ç»“æœï¼Œé€šè¿‡å›è°ƒè·å–ç»“æœ
- é«˜å¹¶å‘é€‰NIOï¼Œç®€å•åº”ç”¨é€‰ä¼ ç»ŸIO