---
title: 2ã€TCP Socketç¼–ç¨‹
---
## ğŸ“š ç›®å½•

1. [SocketåŸºç¡€æ¦‚å¿µ](#1-SocketåŸºç¡€æ¦‚å¿µ)
2. [TCPåè®®ç‰¹æ€§](#2-TCPåè®®ç‰¹æ€§)
3. [å®¢æˆ·ç«¯ç¼–ç¨‹å®æˆ˜](#3-å®¢æˆ·ç«¯ç¼–ç¨‹å®æˆ˜)
4. [æœåŠ¡ç«¯ç¼–ç¨‹å®æˆ˜](#4-æœåŠ¡ç«¯ç¼–ç¨‹å®æˆ˜)
5. [è¿æ¥ç®¡ç†ä¸å¼‚å¸¸å¤„ç†](#5-è¿æ¥ç®¡ç†ä¸å¼‚å¸¸å¤„ç†)
6. [æ•°æ®ä¼ è¾“æ¨¡å¼](#6-æ•°æ®ä¼ è¾“æ¨¡å¼)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ SocketåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Socket


**ğŸ”¸ ç”Ÿæ´»åŒ–ç†è§£**
```
Socketå°±åƒç”µè¯é€šè¯ï¼š
â€¢ ç”µè¯å·ç  = IPåœ°å€ + ç«¯å£å·
â€¢ æ‹¨å· = å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨
â€¢ é€šè¯ = æ•°æ®ä¼ è¾“
â€¢ æŒ‚æœº = æ–­å¼€è¿æ¥

ç¨‹åºä¸­çš„Socketï¼š
â€¢ å®¢æˆ·ç«¯Socketï¼šä¸»åŠ¨"æ‰“ç”µè¯"
â€¢ æœåŠ¡å™¨Socketï¼š"æ¥ç”µè¯"
â€¢ ä¸€æ—¦è¿é€šï¼ŒåŒæ–¹å¯ä»¥äº’ç›¸"è¯´è¯"ï¼ˆå‘é€æ•°æ®ï¼‰
```

### 1.2 Socketçš„ä¸¤ç§ä¸»è¦ç±»å‹


**ğŸ“± TCP Socket vs UDP Socket**

| ç‰¹æ€§ | **TCP Socket** | **UDP Socket** |
|------|---------------|---------------|
| ğŸ“ **è¿æ¥æ–¹å¼** | `åƒæ‰“ç”µè¯ï¼Œå…ˆå»ºç«‹è¿æ¥` | `åƒå‘çŸ­ä¿¡ï¼Œç›´æ¥å‘é€` |
| ğŸ”’ **å¯é æ€§** | `ä¿è¯æ•°æ®åˆ°è¾¾ï¼Œæœ‰é¡ºåº` | `ä¸ä¿è¯åˆ°è¾¾ï¼Œå¯èƒ½ä¹±åº` |
| âš¡ **é€Ÿåº¦** | `è¾ƒæ…¢ï¼Œä½†å¯é ` | `å¾ˆå¿«ï¼Œä½†ä¸ä¿è¯` |
| ğŸ¯ **é€‚ç”¨åœºæ™¯** | `æ–‡ä»¶ä¼ è¾“ã€ç½‘é¡µæµè§ˆ` | `è§†é¢‘é€šè¯ã€åœ¨çº¿æ¸¸æˆ` |
| â˜• **Javaç±»** | `Socket/ServerSocket` | `DatagramSocket` |

### 1.3 ç«¯å£å·çš„ä½œç”¨


**ğŸšª ç«¯å£å°±åƒæˆ¿é—´å·**
```
ä¸€å°ç”µè„‘ = ä¸€æ ‹æ¥¼
IPåœ°å€ = æ¥¼çš„åœ°å€  
ç«¯å£å· = æˆ¿é—´å·

ä¾‹å­ï¼š
192.168.1.100:8080
â””â”€ IPåœ°å€ â”€â”˜ â””ç«¯å£â”˜

å¸¸ç”¨ç«¯å£ï¼š
ğŸŒ ç½‘é¡µæœåŠ¡ï¼š80 (HTTP)ã€443 (HTTPS)
ğŸ“§ é‚®ä»¶æœåŠ¡ï¼š25 (SMTP)ã€110 (POP3)
ğŸ—„ï¸ æ•°æ®åº“ï¼š3306 (MySQL)ã€5432 (PostgreSQL)
â˜• Javaåº”ç”¨ï¼š8080 (Tomcat)ã€9000 (è‡ªå®šä¹‰)
```

---

## 2. ğŸŒ TCPåè®®ç‰¹æ€§


### 2.1 TCPçš„ä¸‰å¤§ç‰¹ç‚¹


**ğŸ”— 1. é¢å‘è¿æ¥**
```
TCPå°±åƒæ‰“ç”µè¯ï¼š
â€¢ æ‹¨å·ï¼ˆå»ºç«‹è¿æ¥ï¼‰
â€¢ é€šè¯ï¼ˆä¼ è¾“æ•°æ®ï¼‰  
â€¢ æŒ‚æœºï¼ˆæ–­å¼€è¿æ¥ï¼‰

å¥½å¤„ï¼šé€šè¯è¿‡ç¨‹ä¸­çŸ¥é“å¯¹æ–¹åœ¨ä¸åœ¨
```

**âœ… 2. å¯é ä¼ è¾“**
```
TCPä¿è¯ï¼š
â€¢ æ•°æ®ä¸ä¸¢å¤±ï¼šä¸¢äº†ä¼šé‡å‘
â€¢ æ•°æ®ä¸é‡å¤ï¼šæ”¶åˆ°é‡å¤ä¼šä¸¢å¼ƒ
â€¢ æ•°æ®æœ‰é¡ºåºï¼šä¹±åºä¼šé‡æ–°æ’åˆ—

å°±åƒå¿«é€’ï¼šæœ‰ç­¾æ”¶ã€æœ‰è·Ÿè¸ªã€æŒ‰é¡ºåºé€è¾¾
```

**ğŸ”„ 3. åŒå‘é€šä¿¡**
```
TCPåƒå¯¹è®²æœºï¼š
â€¢ åŒæ–¹éƒ½å¯ä»¥ä¸»åŠ¨è¯´è¯
â€¢ åŒæ—¶å¯ä»¥æ”¶å¬å¯¹æ–¹
â€¢ ä¸ç”¨"æ”¶åˆ°è¯·å›ç­”"
```

### 2.2 TCPè¿æ¥çš„å»ºç«‹ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰


**ğŸ¤ ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹**
```
å®¢æˆ·ç«¯                    æœåŠ¡å™¨
   |                        |
   |--â‘ "æˆ‘è¦è¿æ¥ä½ "--------->|
   |                        |
   |<--â‘¡"å¥½çš„ï¼Œä½ ä¹Ÿè¿æˆ‘"-----|
   |                        |
   |--â‘¢"æ”¶åˆ°ï¼Œå¼€å§‹é€šä¿¡"---->|
   |                        |
   |====== è¿æ¥å»ºç«‹ ========|

ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡ï¼Ÿ
â€¢ ç¡®è®¤åŒæ–¹éƒ½èƒ½è¯´è¯
â€¢ ç¡®è®¤åŒæ–¹éƒ½èƒ½å¬è¯
â€¢ é¿å…å†å²è¿æ¥è¯·æ±‚å¹²æ‰°
```

### 2.3 TCPè¿æ¥çš„æ–­å¼€ï¼ˆå››æ¬¡æŒ¥æ‰‹ï¼‰


**ğŸ‘‹ å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹**
```
å®¢æˆ·ç«¯                    æœåŠ¡å™¨
   |                        |
   |--â‘ "æˆ‘è¯´å®Œäº†"---------->|
   |                        |
   |<--â‘¡"çŸ¥é“äº†"------------|
   |                        |
   |<--â‘¢"æˆ‘ä¹Ÿè¯´å®Œäº†"--------|
   |                        |
   |--â‘£"å¥½çš„ï¼Œå†è§"-------->|
   |                        |
   |====== è¿æ¥å…³é—­ ========|

ä¸ºä»€ä¹ˆè¦å››æ¬¡ï¼Ÿ
â€¢ ä¸€æ–¹è¯´å®Œäº†ï¼Œå¦ä¸€æ–¹å¯èƒ½è¿˜æœ‰è¯è¯´
â€¢ ç¡®ä¿åŒæ–¹éƒ½æ²¡è¯è¯´äº†æ‰æŒ‚æœº
```

---

## 3. ğŸ’» å®¢æˆ·ç«¯ç¼–ç¨‹å®æˆ˜


### 3.1 æœ€ç®€å•çš„TCPå®¢æˆ·ç«¯


**ğŸ“± åŸºç¡€å®¢æˆ·ç«¯ä»£ç **
```java
import java.io.*;
import java.net.*;

public class SimpleClient {
    public static void main(String[] args) {
        try {
            // 1. è¿æ¥æœåŠ¡å™¨ï¼ˆå°±åƒæ‹¨ç”µè¯å·ç ï¼‰
            Socket socket = new Socket("localhost", 8080);
            System.out.println("è¿æ¥æˆåŠŸï¼");
            
            // 2. å‘é€æ¶ˆæ¯
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
            out.println("Hello Server!");
            
            // 3. æ¥æ”¶å›å¤
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            String reply = in.readLine();
            System.out.println("æœåŠ¡å™¨å›å¤: " + reply);
            
            // 4. å…³é—­è¿æ¥
            socket.close();
            
        } catch (Exception e) {
            System.out.println("å‡ºé”™äº†: " + e.getMessage());
        }
    }
}
```

### 3.2 äº¤äº’å¼èŠå¤©å®¢æˆ·ç«¯


**ğŸ’¬ å¯ä»¥æŒç»­èŠå¤©çš„å®¢æˆ·ç«¯**
```java
import java.io.*;
import java.net.*;
import java.util.Scanner;

public class ChatClient {
    public static void main(String[] args) {
        try {
            // è¿æ¥æœåŠ¡å™¨
            Socket socket = new Socket("localhost", 8080);
            System.out.println("å·²è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨");
            System.out.println("è¾“å…¥æ¶ˆæ¯ï¼Œè¾“å…¥'bye'é€€å‡º");
            
            // å‡†å¤‡è¾“å…¥è¾“å‡º
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            Scanner scanner = new Scanner(System.in);
            
            String message;
            while (true) {
                // ç”¨æˆ·è¾“å…¥
                System.out.print("æˆ‘: ");
                message = scanner.nextLine();
                
                // å‘é€æ¶ˆæ¯
                out.println(message);
                
                // å¦‚æœæ˜¯byeå°±é€€å‡º
                if ("bye".equals(message)) {
                    break;
                }
                
                // æ¥æ”¶æœåŠ¡å™¨å›å¤
                String reply = in.readLine();
                System.out.println("æœåŠ¡å™¨: " + reply);
            }
            
            socket.close();
            System.out.println("èŠå¤©ç»“æŸ");
            
        } catch (Exception e) {
            System.out.println("èŠå¤©å‡ºé”™: " + e.getMessage());
        }
    }
}
```

### 3.3 å¸¦é‡è¿åŠŸèƒ½çš„å®¢æˆ·ç«¯


**ğŸ”„ ç½‘ç»œæ–­äº†ä¼šè‡ªåŠ¨é‡è¿**
```java
public class ReliableClient {
    private static final int MAX_RETRY = 3;
    
    public static void main(String[] args) {
        for (int i = 1; i <= MAX_RETRY; i++) {
            try {
                System.out.println("ç¬¬" + i + "æ¬¡å°è¯•è¿æ¥...");
                
                Socket socket = new Socket("localhost", 8080);
                System.out.println("è¿æ¥æˆåŠŸï¼");
                
                // è¿æ¥æˆåŠŸï¼Œå¼€å§‹é€šä¿¡
                doChat(socket);
                
                socket.close();
                break; // æˆåŠŸäº†å°±ä¸é‡è¯•äº†
                
            } catch (Exception e) {
                System.out.println("è¿æ¥å¤±è´¥: " + e.getMessage());
                
                if (i < MAX_RETRY) {
                    System.out.println("2ç§’åé‡è¯•...");
                    try {
                        Thread.sleep(2000); // ç­‰2ç§’
                    } catch (InterruptedException ie) {
                        break;
                    }
                } else {
                    System.out.println("é‡è¯•æ¬¡æ•°ç”¨å®Œï¼Œæ”¾å¼ƒè¿æ¥");
                }
            }
        }
    }
    
    private static void doChat(Socket socket) throws Exception {
        PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
        BufferedReader in = new BufferedReader(
            new InputStreamReader(socket.getInputStream()));
        
        out.println("Hello Server!");
        String reply = in.readLine();
        System.out.println("æœåŠ¡å™¨å›å¤: " + reply);
    }
}
```

---

## 4. ğŸ–¥ï¸ æœåŠ¡ç«¯ç¼–ç¨‹å®æˆ˜


### 4.1 æœ€ç®€å•çš„TCPæœåŠ¡å™¨


**ğŸ  åŸºç¡€æœåŠ¡å™¨ä»£ç **
```java
import java.io.*;
import java.net.*;

public class SimpleServer {
    public static void main(String[] args) {
        try {
            // 1. å¼€é—¨è¥ä¸šï¼ˆç›‘å¬ç«¯å£ï¼‰
            ServerSocket server = new ServerSocket(8080);
            System.out.println("æœåŠ¡å™¨å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...");
            
            // 2. ç­‰å®¢æˆ·ï¼ˆç­‰å¾…è¿æ¥ï¼‰
            Socket client = server.accept();
            System.out.println("å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ: " + client.getRemoteSocketAddress());
            
            // 3. æ¥æ”¶æ¶ˆæ¯
            BufferedReader in = new BufferedReader(
                new InputStreamReader(client.getInputStream()));
            String message = in.readLine();
            System.out.println("æ”¶åˆ°æ¶ˆæ¯: " + message);
            
            // 4. å›å¤æ¶ˆæ¯
            PrintWriter out = new PrintWriter(client.getOutputStream(), true);
            out.println("Hello Client! æˆ‘æ”¶åˆ°äº†: " + message);
            
            // 5. å…³é—¨ï¼ˆå…³é—­è¿æ¥ï¼‰
            client.close();
            server.close();
            
        } catch (Exception e) {
            System.out.println("æœåŠ¡å™¨å‡ºé”™: " + e.getMessage());
        }
    }
}
```

### 4.2 å¾ªç¯æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯


**ğŸ‘¥ å¯ä»¥æœåŠ¡å¤šä¸ªå®¢æˆ·çš„æœåŠ¡å™¨**
```java
import java.io.*;
import java.net.*;

public class MultiClientServer {
    public static void main(String[] args) {
        try {
            ServerSocket server = new ServerSocket(8080);
            System.out.println("èŠå¤©æœåŠ¡å™¨å¯åŠ¨ï¼Œç«¯å£8080");
            
            // ä¸€ç›´è¥ä¸šï¼Œä¸æ‰“çƒŠ
            while (true) {
                System.out.println("ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...");
                
                // æ¥ä¸€ä¸ªå®¢æˆ·å°±æœåŠ¡ä¸€ä¸ª
                Socket client = server.accept();
                System.out.println("æ–°å®¢æˆ·è¿æ¥: " + client.getRemoteSocketAddress());
                
                // å¤„ç†è¿™ä¸ªå®¢æˆ·
                handleClient(client);
            }
            
        } catch (Exception e) {
            System.out.println("æœåŠ¡å™¨å‡ºé”™: " + e.getMessage());
        }
    }
    
    // å¤„ç†å•ä¸ªå®¢æˆ·ç«¯
    private static void handleClient(Socket client) {
        try {
            BufferedReader in = new BufferedReader(
                new InputStreamReader(client.getInputStream()));
            PrintWriter out = new PrintWriter(client.getOutputStream(), true);
            
            String message;
            while ((message = in.readLine()) != null) {
                System.out.println("å®¢æˆ·è¯´: " + message);
                
                // å¦‚æœå®¢æˆ·è¯´byeå°±ç»“æŸ
                if ("bye".equals(message)) {
                    out.println("å†è§ï¼");
                    break;
                }
                
                // å›å¤å®¢æˆ·
                out.println("æ”¶åˆ°: " + message);
            }
            
        } catch (Exception e) {
            System.out.println("å¤„ç†å®¢æˆ·å‡ºé”™: " + e.getMessage());
        } finally {
            try {
                client.close();
                System.out.println("å®¢æˆ·ç«¯æ–­å¼€è¿æ¥");
            } catch (Exception e) {
                // å…³é—­å‡ºé”™ä¹Ÿè¦è®°å½•
            }
        }
    }
}
```

### 4.3 æ™ºèƒ½å›å¤æœåŠ¡å™¨


**ğŸ¤– ä¼šæ ¹æ®æ¶ˆæ¯å†…å®¹æ™ºèƒ½å›å¤**
```java
import java.io.*;
import java.net.*;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;

public class SmartServer {
    public static void main(String[] args) {
        try {
            ServerSocket server = new ServerSocket(8080);
            System.out.println("æ™ºèƒ½èŠå¤©æœåŠ¡å™¨å¯åŠ¨ï¼");
            
            while (true) {
                Socket client = server.accept();
                System.out.println("æ–°å®¢æˆ·è¿æ¥");
                handleClient(client);
            }
            
        } catch (Exception e) {
            System.out.println("æœåŠ¡å™¨é”™è¯¯: " + e.getMessage());
        }
    }
    
    private static void handleClient(Socket client) {
        try {
            BufferedReader in = new BufferedReader(
                new InputStreamReader(client.getInputStream()));
            PrintWriter out = new PrintWriter(client.getOutputStream(), true);
            
            // æ¬¢è¿æ¶ˆæ¯
            out.println("æ¬¢è¿æ¥åˆ°æ™ºèƒ½èŠå¤©å®¤ï¼è¾“å…¥'help'æŸ¥çœ‹å‘½ä»¤");
            
            String message;
            while ((message = in.readLine()) != null) {
                System.out.println("æ”¶åˆ°: " + message);
                
                // æ™ºèƒ½å›å¤
                String reply = getSmartReply(message);
                out.println(reply);
                
                if ("bye".equals(message)) {
                    break;
                }
            }
            
        } catch (Exception e) {
            System.out.println("å¤„ç†å‡ºé”™: " + e.getMessage());
        } finally {
            try {
                client.close();
            } catch (Exception e) {
                // å¿½ç•¥å…³é—­å¼‚å¸¸
            }
        }
    }
    
    // æ™ºèƒ½å›å¤é€»è¾‘
    private static String getSmartReply(String message) {
        String msg = message.toLowerCase();
        
        if (msg.equals("hello") || msg.equals("hi")) {
            return "ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼";
        } else if (msg.equals("time")) {
            return "ç°åœ¨æ—¶é—´æ˜¯: " + LocalTime.now().format(DateTimeFormatter.ofPattern("HH:mm:ss"));
        } else if (msg.equals("help")) {
            return "å‘½ä»¤åˆ—è¡¨: hello(é—®å¥½), time(æ—¶é—´), bye(é€€å‡º)";
        } else if (msg.equals("bye")) {
            return "å†è§ï¼æ¬¢è¿ä¸‹æ¬¡å†æ¥ï¼";
        } else {
            return "æˆ‘æ”¶åˆ°äº†: " + message + " (è¾“å…¥helpæŸ¥çœ‹æ›´å¤šå‘½ä»¤)";
        }
    }
}
```

---

## 5. ğŸ›¡ï¸ è¿æ¥ç®¡ç†ä¸å¼‚å¸¸å¤„ç†


### 5.1 å¸¸è§ç½‘ç»œå¼‚å¸¸


**âš ï¸ ç½‘ç»œç¼–ç¨‹å¸¸è§é—®é¢˜**
```java
public class ErrorHandling {
    public static void main(String[] args) {
        try {
            Socket socket = new Socket("localhost", 8080);
            // æ­£å¸¸æ“ä½œ...
            
        } catch (ConnectException e) {
            // è¿æ¥è¢«æ‹’ç» - é€šå¸¸æ˜¯æœåŠ¡å™¨æ²¡å¯åŠ¨
            System.out.println("è¿æ¥å¤±è´¥ï¼šæœåŠ¡å™¨å¯èƒ½æ²¡æœ‰å¯åŠ¨");
            System.out.println("è§£å†³æ–¹æ³•ï¼šå…ˆå¯åŠ¨æœåŠ¡å™¨ç¨‹åº");
            
        } catch (UnknownHostException e) {
            // æ‰¾ä¸åˆ°ä¸»æœº - é€šå¸¸æ˜¯IPåœ°å€æˆ–åŸŸåé”™è¯¯
            System.out.println("æ‰¾ä¸åˆ°æœåŠ¡å™¨ï¼šè¯·æ£€æŸ¥IPåœ°å€");
            
        } catch (SocketTimeoutException e) {
            // è¶…æ—¶ - ç½‘ç»œå¤ªæ…¢æˆ–æœåŠ¡å™¨æ— å“åº”
            System.out.println("è¿æ¥è¶…æ—¶ï¼šç½‘ç»œå¯èƒ½æœ‰é—®é¢˜");
            
        } catch (IOException e) {
            // å…¶ä»–IOé—®é¢˜
            System.out.println("ç½‘ç»œé”™è¯¯: " + e.getMessage());
        }
    }
}
```

### 5.2 è¶…æ—¶è®¾ç½®


**â° é¿å…ç¨‹åº"å¡æ­»"**
```java
public class TimeoutDemo {
    public static void main(String[] args) {
        try {
            // 1. è¿æ¥è¶…æ—¶è®¾ç½®
            Socket socket = new Socket();
            socket.connect(new InetSocketAddress("localhost", 8080), 5000); // 5ç§’è¶…æ—¶
            
            // 2. è¯»å–è¶…æ—¶è®¾ç½®
            socket.setSoTimeout(10000); // 10ç§’è¯»å–è¶…æ—¶
            
            // ç°åœ¨readæ“ä½œæœ€å¤šç­‰10ç§’
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            String data = in.readLine(); // æœ€å¤šç­‰10ç§’
            
            socket.close();
            
        } catch (SocketTimeoutException e) {
            System.out.println("æ“ä½œè¶…æ—¶");
        } catch (Exception e) {
            System.out.println("å…¶ä»–é”™è¯¯: " + e.getMessage());
        }
    }
}
```

### 5.3 èµ„æºç®¡ç†


**â™»ï¸ æ­£ç¡®å…³é—­èµ„æº**
```java
public class ResourceManagement {
    // æ¨èæ–¹å¼ï¼šè‡ªåŠ¨å…³é—­èµ„æº
    public static void goodWay() {
        try (Socket socket = new Socket("localhost", 8080);
             PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
             BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()))) {
            
            // ä½¿ç”¨è¿æ¥...
            out.println("Hello");
            String reply = in.readLine();
            
        } catch (Exception e) {
            System.out.println("é”™è¯¯: " + e.getMessage());
        }
        // è¿™é‡Œè‡ªåŠ¨å…³é—­æ‰€æœ‰èµ„æºï¼Œå¾ˆå®‰å…¨ï¼
    }
    
    // æ£€æŸ¥è¿æ¥çŠ¶æ€
    public static boolean isConnected(Socket socket) {
        return socket != null && 
               socket.isConnected() && 
               !socket.isClosed();
    }
}
```

---

## 6. ğŸ“Š æ•°æ®ä¼ è¾“æ¨¡å¼


### 6.1 å‘é€æ–‡æœ¬æ¶ˆæ¯


**ğŸ“ æ–‡æœ¬æ•°æ®ä¼ è¾“**
```java
public class TextTransfer {
    // å‘é€æ–‡æœ¬
    public static void sendText(Socket socket, String message) throws Exception {
        PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
        out.println(message); // è‡ªåŠ¨åŠ æ¢è¡Œç¬¦
    }
    
    // æ¥æ”¶æ–‡æœ¬
    public static String receiveText(Socket socket) throws Exception {
        BufferedReader in = new BufferedReader(
            new InputStreamReader(socket.getInputStream()));
        return in.readLine(); // è¯»åˆ°æ¢è¡Œç¬¦ä¸ºæ­¢
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("localhost", 8080);
        
        sendText(socket, "Hello World");
        String reply = receiveText(socket);
        System.out.println("æ”¶åˆ°: " + reply);
        
        socket.close();
    }
}
```

### 6.2 å‘é€æ•°å­—å’ŒäºŒè¿›åˆ¶æ•°æ®


**ğŸ”¢ å‘é€å„ç§ç±»å‹çš„æ•°æ®**
```java
import java.io.*;
import java.net.*;

public class BinaryTransfer {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("localhost", 8080);
        
        // å‘é€äºŒè¿›åˆ¶æ•°æ®
        DataOutputStream out = new DataOutputStream(socket.getOutputStream());
        out.writeInt(123);        // å‘é€æ•´æ•°
        out.writeDouble(3.14);    // å‘é€å°æ•°
        out.writeUTF("Hello");    // å‘é€å­—ç¬¦ä¸²ï¼ˆå¸¦é•¿åº¦ä¿¡æ¯ï¼‰
        out.writeBoolean(true);   // å‘é€å¸ƒå°”å€¼
        
        // æ¥æ”¶äºŒè¿›åˆ¶æ•°æ®ï¼ˆé¡ºåºè¦ä¸€è‡´ï¼‰
        DataInputStream in = new DataInputStream(socket.getInputStream());
        int number = in.readInt();
        double decimal = in.readDouble();
        String text = in.readUTF();
        boolean flag = in.readBoolean();
        
        System.out.println("æ”¶åˆ°: " + number + ", " + decimal + ", " + text + ", " + flag);
        
        socket.close();
    }
}
```

### 6.3 å‘é€æ–‡ä»¶


**ğŸ“ ç®€å•æ–‡ä»¶ä¼ è¾“**
```java
import java.io.*;
import java.net.*;

public class FileTransfer {
    // å‘é€æ–‡ä»¶
    public static void sendFile(Socket socket, String filePath) throws Exception {
        File file = new File(filePath);
        
        DataOutputStream out = new DataOutputStream(socket.getOutputStream());
        FileInputStream fis = new FileInputStream(file);
        
        // å…ˆå‘é€æ–‡ä»¶åå’Œå¤§å°
        out.writeUTF(file.getName());
        out.writeLong(file.length());
        
        // å‘é€æ–‡ä»¶å†…å®¹
        byte[] buffer = new byte[1024];
        int bytesRead;
        while ((bytesRead = fis.read(buffer)) != -1) {
            out.write(buffer, 0, bytesRead);
        }
        
        fis.close();
        System.out.println("æ–‡ä»¶å‘é€å®Œæˆ: " + file.getName());
    }
    
    // æ¥æ”¶æ–‡ä»¶
    public static void receiveFile(Socket socket, String saveDir) throws Exception {
        DataInputStream in = new DataInputStream(socket.getInputStream());
        
        // å…ˆæ¥æ”¶æ–‡ä»¶åå’Œå¤§å°
        String fileName = in.readUTF();
        long fileSize = in.readLong();
        
        // ä¿å­˜æ–‡ä»¶
        File saveFile = new File(saveDir, fileName);
        FileOutputStream fos = new FileOutputStream(saveFile);
        
        byte[] buffer = new byte[1024];
        long totalRead = 0;
        int bytesRead;
        
        while (totalRead < fileSize) {
            bytesRead = in.read(buffer);
            fos.write(buffer, 0, bytesRead);
            totalRead += bytesRead;
        }
        
        fos.close();
        System.out.println("æ–‡ä»¶æ¥æ”¶å®Œæˆ: " + fileName);
    }
}
```

### 6.4 è§£å†³ç²˜åŒ…é—®é¢˜


**ğŸ“¦ ç¡®ä¿æ¶ˆæ¯å®Œæ•´æ¥æ”¶**
```java
public class MessageProtocol {
    // å‘é€æ¶ˆæ¯ï¼ˆå¸¦é•¿åº¦å‰ç¼€ï¼‰
    public static void sendMessage(Socket socket, String message) throws Exception {
        DataOutputStream out = new DataOutputStream(socket.getOutputStream());
        
        byte[] data = message.getBytes("UTF-8");
        out.writeInt(data.length);  // å…ˆå‘é•¿åº¦
        out.write(data);           // å†å‘å†…å®¹
        out.flush();
    }
    
    // æ¥æ”¶æ¶ˆæ¯ï¼ˆæŒ‰é•¿åº¦æ¥æ”¶ï¼‰
    public static String receiveMessage(Socket socket) throws Exception {
        DataInputStream in = new DataInputStream(socket.getInputStream());
        
        int length = in.readInt();    // å…ˆè¯»é•¿åº¦
        byte[] data = new byte[length];
        in.readFully(data);          // è¯»æŒ‡å®šé•¿åº¦çš„æ•°æ®
        
        return new String(data, "UTF-8");
    }
    
    // æµ‹è¯•ç¤ºä¾‹
    public static void main(String[] args) throws Exception {
        // è¿™æ ·å‘é€å’Œæ¥æ”¶ï¼Œå°±ä¸ä¼šæœ‰ç²˜åŒ…é—®é¢˜äº†
        Socket socket = new Socket("localhost", 8080);
        
        sendMessage(socket, "ç¬¬ä¸€æ¡æ¶ˆæ¯");
        sendMessage(socket, "ç¬¬äºŒæ¡æ¶ˆæ¯");
        sendMessage(socket, "ç¬¬ä¸‰æ¡æ¶ˆæ¯");
        
        String msg1 = receiveMessage(socket);
        String msg2 = receiveMessage(socket);
        String msg3 = receiveMessage(socket);
        
        System.out.println(msg1);
        System.out.println(msg2);
        System.out.println(msg3);
        
        socket.close();
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


```
ğŸ”¸ Socket = ç½‘ç»œé€šä¿¡çš„"ç”µè¯"ï¼Œç”¨äºè¿æ¥ä¸åŒç”µè„‘ä¸Šçš„ç¨‹åº
ğŸ”¸ TCPç‰¹ç‚¹ = å¯é ã€æœ‰åºã€é¢å‘è¿æ¥ï¼ˆåƒæ‰“ç”µè¯ï¼‰
ğŸ”¸ å®¢æˆ·ç«¯ = ä¸»åŠ¨è¿æ¥çš„ä¸€æ–¹ï¼ˆSocketç±»ï¼‰
ğŸ”¸ æœåŠ¡ç«¯ = è¢«åŠ¨ç­‰å¾…è¿æ¥çš„ä¸€æ–¹ï¼ˆServerSocketç±»ï¼‰
ğŸ”¸ ç«¯å£å· = ç¨‹åºçš„"é—¨ç‰Œå·"ï¼Œç”¨æ¥æ‰¾åˆ°å…·ä½“çš„ç¨‹åº
```

### 7.2 ç¼–ç¨‹æ¨¡å¼


**ğŸ”¹ å®¢æˆ·ç«¯ç¼–ç¨‹å¥—è·¯**
```
1. new Socket(ä¸»æœº, ç«¯å£) - è¿æ¥æœåŠ¡å™¨
2. è·å–è¾“å…¥è¾“å‡ºæµ - å‡†å¤‡é€šä¿¡
3. å‘é€å’Œæ¥æ”¶æ•°æ® - çœŸæ­£çš„é€šä¿¡
4. socket.close() - å…³é—­è¿æ¥

è®°ä½ï¼šå®¢æˆ·ç«¯æ˜¯ä¸»åŠ¨çš„ä¸€æ–¹
```

**ğŸ”¹ æœåŠ¡ç«¯ç¼–ç¨‹å¥—è·¯**
```
1. new ServerSocket(ç«¯å£) - å¼€é—¨è¥ä¸š
2. accept() - ç­‰å¾…å®¢æˆ·ä¸Šé—¨
3. å¤„ç†å®¢æˆ·è¯·æ±‚ - æ”¶æ¶ˆæ¯ã€å‘å›å¤
4. å…³é—­è¿æ¥ - å®¢æˆ·ç¦»å¼€
5. å›åˆ°ç¬¬2æ­¥ - ç»§ç»­ç­‰ä¸‹ä¸€ä¸ªå®¢æˆ·

è®°ä½ï¼šæœåŠ¡ç«¯æ˜¯è¢«åŠ¨ç­‰å¾…çš„ä¸€æ–¹
```

### 7.3 é‡è¦æ³¨æ„äº‹é¡¹


**ğŸ”¹ å¼‚å¸¸å¤„ç†**
```
âœ… æ€»æ˜¯ç”¨try-catchåŒ…å›´ç½‘ç»œä»£ç 
âœ… è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…ç¨‹åº"å¡æ­»"
âœ… ç”¨try-with-resourcesè‡ªåŠ¨å…³é—­èµ„æº
âŒ ä¸å¤„ç†å¼‚å¸¸ï¼Œç¨‹åºå®¹æ˜“å´©æºƒ
```

**ğŸ”¹ æ•°æ®ä¼ è¾“**
```
âœ… æ–‡æœ¬æ•°æ®ï¼šç”¨PrintWriter/BufferedReader
âœ… äºŒè¿›åˆ¶æ•°æ®ï¼šç”¨DataOutputStream/DataInputStream  
âœ… è§£å†³ç²˜åŒ…ï¼šå…ˆå‘é•¿åº¦ï¼Œå†å‘å†…å®¹
âŒ ç›´æ¥å‘é€å¤šæ¡æ¶ˆæ¯å®¹æ˜“ç²˜åŒ…
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–**
```
âœ… è®¾ç½®åˆé€‚çš„ç¼“å†²åŒºå¤§å°
âœ… æ‰¹é‡å‘é€æ•°æ®ï¼Œå‡å°‘ç½‘ç»œæ¬¡æ•°
âœ… ä½¿ç”¨è¿æ¥æ± å¤ç”¨è¿æ¥
âŒ é¢‘ç¹å»ºç«‹å’Œå…³é—­è¿æ¥å¾ˆæ…¢
```

### 7.4 å­¦ä¹ å»ºè®®


**ğŸ¯ å¾ªåºæ¸è¿›**
```
ç¬¬1æ­¥ï¼šå†™æœ€ç®€å•çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯
ç¬¬2æ­¥ï¼šåŠ ä¸Šå¼‚å¸¸å¤„ç†å’Œè¶…æ—¶è®¾ç½®
ç¬¬3æ­¥ï¼šå®ç°å¾ªç¯æœåŠ¡å’Œæ™ºèƒ½å›å¤
ç¬¬4æ­¥ï¼šå¤„ç†ç²˜åŒ…å’Œæ–‡ä»¶ä¼ è¾“
ç¬¬5æ­¥ï¼šå­¦ä¹ å¤šçº¿ç¨‹å¤„ç†å¤šå®¢æˆ·ç«¯
```

**ğŸ’¡ è°ƒè¯•æŠ€å·§**
```
â€¢ å…ˆåœ¨æœ¬æœºæµ‹è¯•ï¼ˆlocalhostï¼‰
â€¢ ç”¨System.out.println()æ‰“å°å…³é”®ä¿¡æ¯
â€¢ ä¸€æ­¥æ­¥éªŒè¯ï¼šè¿æ¥â†’å‘é€â†’æ¥æ”¶â†’å…³é—­
â€¢ æœåŠ¡ç«¯å…ˆå¯åŠ¨ï¼Œå®¢æˆ·ç«¯åè¿æ¥
â€¢ æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³**
```
è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦å¯åŠ¨ï¼Œç«¯å£æ˜¯å¦æ­£ç¡®
è¯»ä¸åˆ°æ•°æ®ï¼šæ£€æŸ¥å‘é€ç«¯æ˜¯å¦flush()ï¼Œæ¥æ”¶ç«¯æ˜¯å¦é˜»å¡
ç¨‹åºå¡ä½ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´
ä¹±ç é—®é¢˜ï¼šç»Ÿä¸€ä½¿ç”¨UTF-8ç¼–ç 
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- TCP Socketç¼–ç¨‹å°±æ˜¯"æ‰“ç”µè¯"ï¼šå»ºè¿æ¥ã€è¯´è¯ã€æŒ‚æœº
- å®¢æˆ·ç«¯ä¸»åŠ¨è¿æ¥ï¼ŒæœåŠ¡ç«¯è¢«åŠ¨ç­‰å¾…
- å¼‚å¸¸å¤„ç†å¾ˆé‡è¦ï¼Œè¶…æ—¶è®¾ç½®é˜²å¡æ­»
- æ–‡æœ¬ç”¨å­—ç¬¦æµï¼ŒäºŒè¿›åˆ¶ç”¨å­—èŠ‚æµï¼Œç²˜åŒ…ç”¨é•¿åº¦å‰ç¼€
- å…ˆå†™ç®€å•çš„ï¼Œå†é€æ­¥å¢åŠ åŠŸèƒ½