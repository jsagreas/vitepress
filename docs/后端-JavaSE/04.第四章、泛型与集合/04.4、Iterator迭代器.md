---
title: 4ã€Iteratorè¿­ä»£å™¨
---
## ğŸ“š ç›®å½•

1. [IteratoråŸºç¡€æ¦‚å¿µ](#1-IteratoråŸºç¡€æ¦‚å¿µ)
2. [Iteratorä½¿ç”¨æ³¨æ„äº‹é¡¹](#2-Iteratorä½¿ç”¨æ³¨æ„äº‹é¡¹)
3. [ListIteratorè¯¦è§£](#3-ListIteratorè¯¦è§£)
4. [éå†Listé›†åˆ](#4-éå†Listé›†åˆ)
5. [éå†Seté›†åˆ](#5-éå†Seté›†åˆ)
6. [éå†Queueé›†åˆ](#6-éå†Queueé›†åˆ)
7. [éå†Mapé›†åˆ](#7-éå†Mapé›†åˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ IteratoråŸºç¡€æ¦‚å¿µ


### 1.1 Iteratoræ¥å£å®šä¹‰


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
Iteratorï¼šJava é›†åˆæ¡†æ¶æä¾›çš„ç»Ÿä¸€éå†æ¥å£
é€‚ç”¨èŒƒå›´ï¼šCollection çš„å­ç±»ï¼ˆå¦‚ List, Setï¼‰
è®¾è®¡ç›®æ ‡ï¼šç»Ÿä¸€è®¿é—®ä¸åŒç±»å‹é›†åˆçš„å…ƒç´ ï¼Œè€Œæ— éœ€æš´éœ²å…¶å†…éƒ¨ç»“æ„
```

### 1.2 Iteratorå¸¸ç”¨æ–¹æ³•


| æ–¹æ³•å    | è¿”å›ç±»å‹ | è¯´æ˜                                   |
|-----------|----------|----------------------------------------|
| `hasNext()` | `boolean`  | åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´                     |
| `next()`    | `E`        | è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ—¶å°†å†…éƒ¨æ¸¸æ ‡ï¼ˆæŒ‡é’ˆï¼‰å‘åç§»åŠ¨ä¸€ä½      |
| `remove()`  | `void`     | åˆ é™¤å½“å‰å…ƒç´ ï¼ˆå¿…é¡»åœ¨ `next()` ä¹‹åè°ƒç”¨ä¸€æ¬¡ï¼‰ |

### 1.3 Iteratorä¸å…¶ä»–éå†æ–¹å¼æ¯”è¾ƒ


| éå†æ–¹å¼      | ç‰¹ç‚¹              | é€‚ç”¨åœºæ™¯                      |
|---------------|---------------------------------------------------|------------------------------|
| **Iterator**   | è¯­æ³•è¾ƒç¹çï¼Œä½†æ”¯æŒå®‰å…¨ç§»é™¤å…ƒç´         | é€‚ç”¨äºæ‰€æœ‰é›†åˆï¼Œç‰¹åˆ«æ˜¯ `LinkedList`ã€`Set`  |
| **for-each**   | è¯­æ³•ç®€æ´ï¼Œä½†ä¸èƒ½åœ¨éå†è¿‡ç¨‹ä¸­ä¿®æ”¹é›†åˆ      | é€‚ç”¨äº `List`ã€`Set`ï¼Œä¸éœ€è¦ç´¢å¼•è®¿é—®          |
| **for-eachç¼–è¯‘** | `for-each` åœ¨ç¼–è¯‘æ—¶è½¬æ¢ä¸º `Iterator`        | è¿è¡Œæ—¶æœ¬è´¨ä¸Šä»æ˜¯ `Iterator`        |
| **ä¼ ç»Ÿ for**   | é€‚ç”¨äºç´¢å¼•è®¿é—® (`ArrayList`)ï¼Œå¯ç›´æ¥è®¿é—®å…ƒç´    | é€‚ç”¨äº `List`ï¼ˆå°¤å…¶æ˜¯ `ArrayList`ï¼‰     |
| **æ€§èƒ½è€ƒè™‘**   | `ArrayList` ä¸­ä½¿ç”¨ `for` å¯èƒ½æ›´é«˜æ•ˆ    | é€‚ç”¨äºå¤§è§„æ¨¡ `ArrayList` è®¿é—®    |

---

## 2. âš ï¸ Iteratorä½¿ç”¨æ³¨æ„äº‹é¡¹


### 2.1 æ ¸å¿ƒæ³¨æ„äº‹é¡¹


| æ³¨æ„ç‚¹                       | æ­£ç¡®ç”¨æ³•                           | é”™è¯¯åæœ                                |
|------------------------------|------------------------------------|-----------------------------------------|
| **åˆ é™¤å…ƒç´ ç”¨ `it.remove()`**       | âœ… `it.next()` â†’ `it.remove()` | âŒ `ConcurrentModificationException` |
| **`remove()` åªèƒ½åœ¨ `next()` å** | âœ… è°ƒè¿‡ `next()` æ‰èƒ½åˆ              | âŒ `IllegalStateException`           |
| **éå†åä¸èƒ½é‡å¤ä½¿ç”¨ iterator**        | âœ… é‡æ–°è·å–                        | âŒ æ— æ³•å†æ¬¡è¿­ä»£                            |
| **`Set` ä¸æ”¯æŒç´¢å¼•è®¿é—®**             | âœ… è¿­ä»£å™¨éå†                       | âŒ `UnsupportedOperationException`   |
| **`for-each` ä¸èƒ½ä¿®æ”¹é›†åˆç»“æ„**       | âœ… ä½¿ç”¨ iterator                 | âŒ å¿«é€Ÿå¤±è´¥å¼‚å¸¸                            |

### 2.2 å¸¸è§é”™è¯¯å’Œæ­£ç¡®ç”¨æ³•


**ğŸš« åˆ é™¤å…ƒç´ æ—¶çš„é”™è¯¯ç”¨æ³•**
```java
// åˆ é™¤å…ƒç´ æ—¶åªèƒ½ç”¨ it.remove()ï¼Œä¸èƒ½ç”¨é›†åˆæœ¬èº«çš„æ–¹æ³•
List<String> list = new ArrayList<>(List.of("A", "B", "C"));
for (String s : list) {
    if (s.equals("B")) {
        list.remove(s); // âŒ é”™è¯¯ï¼šéå†ä¸­ä¿®æ”¹ç»“æ„
    }
}

// æ­£ç¡®åšæ³•ï¼š
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    if (it.next().equals("B")) {
        it.remove(); // âœ… å®‰å…¨åˆ é™¤
    }
}
```

**ğŸš« remove()è°ƒç”¨æ—¶æœºé”™è¯¯**
```java
// remove() å¿…é¡»åœ¨è°ƒç”¨è¿‡ next() ä¹‹åæ‰èƒ½è°ƒç”¨
Iterator<String> it = list.iterator();
it.remove(); // âŒ IllegalStateExceptionï¼šæ²¡æœ‰ next()

if (it.hasNext()) {
    String s = it.next();
    it.remove(); // âœ… æ­£ç¡®
}
```

**ğŸš« Iteratoré‡å¤ä½¿ç”¨é”™è¯¯**
```java
// Iterator æ˜¯ä¸€æ¬¡æ€§ã€å•å‘çš„ï¼ˆä¸èƒ½é‡å¤ä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½åå‘ï¼‰
Iterator<String> it = list.iterator();
while (it.hasNext()) it.next(); // ç»“æŸå it.hasNext() æ°¸è¿œä¸º false

// æ¯æ¬¡next()ååªèƒ½è°ƒç”¨ä¸€æ¬¡remove()
// é”™è¯¯ç¤ºä¾‹
it.next();
it.remove();
it.remove(); // é”™è¯¯ï¼ä¸èƒ½è¿ç»­è°ƒç”¨ä¸¤æ¬¡remove()

// é‡æ–°éå†éœ€å†æ¬¡è°ƒç”¨ï¼š
it = list.iterator(); // è·å–æ–°çš„è¿­ä»£å™¨
```

### 2.3 fail-fastæœºåˆ¶è¯¦è§£


**ğŸ”¸ fail-fastæœºåˆ¶ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰**
```
å®šä¹‰ï¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé›†åˆç»“æ„è¢«ä¿®æ”¹ï¼ˆå¦‚å¢åˆ å…ƒç´ ï¼‰ï¼Œä¼šæŠ› ConcurrentModificationException
ç‰¹å¾ï¼šå¤šçº¿ç¨‹æˆ– for-each ä¸­ä¿®æ”¹ç»“æ„
```

**âš¡ æ­£ç¡®å¤„ç†æ–¹å¼**
```java
âœ… æ­£ç¡®å¤„ç†ï¼š
ä½¿ç”¨ Iterator.remove() å®‰å…¨ä¿®æ”¹
æˆ–ä½¿ç”¨å¹¶å‘é›†åˆç±»ï¼ˆå¦‚ CopyOnWriteArrayListï¼‰

// è¿­ä»£å™¨ä¸ä¼šè‡ªåŠ¨æ„ŸçŸ¥é›†åˆå˜åŒ–
List<String> list = new ArrayList<>();
Iterator<String> it = list.iterator();
list.add("æ–°å…ƒç´ "); // ä¿®æ”¹äº†é›†åˆ
// æ­¤æ—¶è¿­ä»£å™¨å·²å¤±æ•ˆï¼Œç»§ç»­ä½¿ç”¨ä¼šæŠ›å‡ºå¼‚å¸¸

// æ™®é€šé›†åˆ(ArrayList, HashMapç­‰)çš„è¿­ä»£å™¨åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ä¼šæœ‰é—®é¢˜
List<String> list = new CopyOnWriteArrayList<>(); // å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ 
// æˆ–
Map<String, Integer> map = new ConcurrentHashMap<>();
```

### 2.4 æ¨èä½¿ç”¨æ¨¡å¼


```java
// æ¨èç”¨æ³•ï¼šé…åˆ while (it.hasNext()) é¿å…è¾¹ç•Œå¼‚å¸¸
Iterator<Integer> it = list.iterator();
while (it.hasNext()) {
    Integer val = it.next();
    System.out.println(val);
}

// for-each æœ¬è´¨ä¸Šä½¿ç”¨çš„æ˜¯ Iteratorï¼ˆä¸èƒ½ç”¨æ¥ä¿®æ”¹ï¼‰
for (String s : list) {
    // ç›¸å½“äºï¼š
    // Iterator<String> it = list.iterator();
    // while (it.hasNext()) ...
}
// æ³¨æ„ï¼šä¸èƒ½åœ¨ for-each ä¸­ä½¿ç”¨é›†åˆçš„ remove() æ–¹æ³•ï¼Œä¼šè§¦å‘ fail-fast
```

---

## 3. ğŸ”€ ListIteratorè¯¦è§£


### 3.1 ListIteratoræ¥å£ç‰¹æ€§


**ğŸ”¸ ListIteratorå®šä¹‰**
```
ListIteratorï¼šIteratorçš„å­æ¥å£ï¼Œä¸“é—¨ç”¨äºListé›†åˆ
ç‰¹ç‚¹ï¼šæ”¯æŒåŒå‘éå†ã€æ·»åŠ ã€æ›¿æ¢å…ƒç´ 
é™åˆ¶ï¼šåªèƒ½ç”¨äºListé›†åˆï¼Œä¸èƒ½ç”¨äºSet
```

### 3.2 ListIteratorå¸¸ç”¨æ–¹æ³•


| æ–¹æ³•                | è¿”å›ç±»å‹      | è¯´æ˜                                 |
|---------------------|---------------|-------------------------------------|
| `hasNext()`       | `boolean` | æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´                            |
| `next()`          | `E`       | è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶å‘åç§»åŠ¨                       |
| `hasPrevious()`   | `boolean` | æ˜¯å¦æœ‰ä¸Šä¸€ä¸ªå…ƒç´                            |
| `previous()`      | `E`       | è¿”å›ä¸Šä¸€ä¸ªå…ƒç´ å¹¶å‘å‰ç§»åŠ¨                       |
| `nextIndex()`     | `int`     | è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä½ç½®                       |
| `previousIndex()` | `int`     | è¿”å›ä¸Šä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä½ç½®                       |
| `remove()`        | `void`    | åˆ é™¤æœ€è¿‘ä¸€æ¬¡ `next()` æˆ– `previous()` çš„å…ƒç´  |
| `set(E e)`        | `void`    | æ›¿æ¢æœ€è¿‘ä¸€æ¬¡è¿”å›çš„å…ƒç´                         |
| `add(E e)`        | `void`    | åœ¨å½“å‰ä½ç½®æ’å…¥å…ƒç´ ï¼ˆåœ¨æ¸¸æ ‡ä¹‹å‰ï¼‰                   |

### 3.3 ListIteratorå’Œæ™®é€šIteratorå¯¹æ¯”


| ç‰¹æ€§       | `Iterator` | `ListIterator`  |
|------------|------------|-----------------|
| **æ˜¯å¦æ”¯æŒåŒå‘éå†** | âŒ          | âœ…               |
| **æ”¯æŒæ·»åŠ å…ƒç´ **   | âŒ          | âœ… `add()`       |
| **æ”¯æŒæ›¿æ¢å…ƒç´ **   | âŒ          | âœ… `set()`       |
| **æ”¯æŒç´¢å¼•æ“ä½œ**   | âŒ          | âœ… `nextIndex()` |
| **å¯ç”¨äº Set**  | âœ…          | âŒ               |
| **éå†å®‰å…¨åˆ é™¤**   | âœ…          | âœ…               |

---

## 4. ğŸ“‹ éå†Listé›†åˆ


### 4.1 ArrayListéå†æ–¹å¼å¯¹æ¯”


| éå†æ–¹å¼       | æ˜¯å¦æ”¯æŒåˆ é™¤ | æ˜¯å¦æ”¯æŒç´¢å¼• | æ˜¯å¦é€‚ç”¨ `Set` | ç‰¹ç‚¹            |
|----------------|--------------|--------------|----------------|-----------------|
| **`for` å¾ªç¯**   | âŒ ä¸å®‰å…¨  | âœ… æ”¯æŒ   | âŒ ä¸æ”¯æŒ      | æ§åˆ¶çµæ´»ï¼Œé€‚åˆç´¢å¼•è®¿é—®   |
| **`for-each`** | âŒ ä¸å®‰å…¨  | âŒ ä¸æ”¯æŒ  | âœ… æ”¯æŒ       | ç®€æ´ï¼Œä½†ä¸èƒ½ç»“æ„ä¿®æ”¹    |
| **`Iterator`** | âœ… å®‰å…¨   | âŒ ä¸æ”¯æŒ  | âœ… æ”¯æŒ       | æ¨èç”¨äºå®‰å…¨ä¿®æ”¹å’Œé€šç”¨éå† |

**ğŸ’¡ ArrayListéå†ç¤ºä¾‹**
```java
// === ä¼ ç»Ÿ for å¾ªç¯ ===
List<String> list = List.of("A", "B", "C");
for (int i = 0; i < list.size(); i++) {
    System.out.println(list.get(i));
}
// æ³¨æ„äº‹é¡¹ï¼š
// å¯ä½¿ç”¨ç´¢å¼•è®¿é—®å…ƒç´ ï¼ˆé€‚ç”¨äº Listï¼Œä¸é€‚ç”¨äº Setï¼‰
// å¯éšæœºè®¿é—®ï¼Œä½†ä¸é€‚åˆè¾¹éå†è¾¹åˆ é™¤ï¼ˆå®¹æ˜“ä¸‹æ ‡é”™ä¹±ï¼‰

// === å¢å¼º for-each å¾ªç¯ ===
for (String s : list) {
    System.out.println(s);
}
// æœ¬è´¨ä½¿ç”¨ Iterator å®ç°
// âŒ ä¸æ”¯æŒåœ¨éå†ä¸­ä½¿ç”¨ list.remove() ä¿®æ”¹é›†åˆç»“æ„ï¼Œå¦åˆ™è§¦å‘ fail-fastï¼ˆå¿«é€Ÿå¤±è´¥å¼‚å¸¸ï¼‰

// === ä½¿ç”¨ Iterator ===
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}
// âœ… æ”¯æŒå®‰å…¨åˆ é™¤ï¼ˆä½¿ç”¨ it.remove()ï¼‰
// æ¯æ¬¡è¿­ä»£éƒ½éœ€é‡æ–°è·å– Iterator
// å•å‘è¿­ä»£ï¼Œä¸èƒ½åå‘æˆ–è·³è·ƒè®¿é—®
```

### 4.2 LinkedListéå†æ€§èƒ½åˆ†æ


| éå†æ–¹å¼       | æ—¶é—´å¤æ‚åº¦ï¼ˆæ¯æ¬¡è®¿é—®ï¼‰    | æ˜¯å¦æ”¯æŒåˆ é™¤ | æ˜¯å¦é€‚åˆå¤§æ•°æ®é‡ | ç‰¹ç‚¹             |
|----------------|-------------------------|--------------|------------------|------------------|
| **ä¼ ç»Ÿ `for`**   | âŒ `O(n)`               | âŒ ä¸å®‰å…¨  | âŒ ä¸é€‚åˆ    | æ…¢ã€ä¸æ¨è          |
| **å¢å¼º `for`**   | âœ… `O(1)` ä½¿ç”¨è¿­ä»£å™¨     | âŒ ä¸å®‰å…¨  | âœ… é€‚åˆ     | ç®€æ´ï¼Œä½†ä¸èƒ½æ”¹ç»“æ„      |
| **`Iterator`** | âœ… `O(1)`               | âœ… å®‰å…¨åˆ é™¤ | âœ… æ¨è     | æœ€æ¨èæ–¹å¼ï¼Œæ”¯æŒè¾¹éå†è¾¹ä¿®æ”¹ |

**ğŸ’¡ LinkedListéå†ç¤ºä¾‹**
```java
// === ä¼ ç»Ÿ for å¾ªç¯ ===
List<String> list = new LinkedList<>(List.of("A", "B", "C"));

for (int i = 0; i < list.size(); i++) {
    System.out.println(list.get(i));
}

// æ€§èƒ½ä½ï¼šLinkedList.get(i) æ˜¯ O(n) æ—¶é—´å¤æ‚åº¦ï¼ˆæ¯æ¬¡éƒ½ä»å¤´éå†æ‰¾ç¬¬ i ä¸ªï¼‰
// âœ… é€‚åˆå°æ•°æ®é‡ï¼›å¤§æ•°æ®ä¸å»ºè®®ä½¿ç”¨ç´¢å¼•éå†

// === å¢å¼º for-each å¾ªç¯ ===
for (String s : list) {
    System.out.println(s);
}
// æœ¬è´¨ä½¿ç”¨ Iterator
// âŒ éå†ä¸­ä¸èƒ½è°ƒç”¨ list.remove()ï¼Œå¦åˆ™æŠ›å‡º ConcurrentModificationException

// === ä½¿ç”¨ Iterator ===
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}
// âœ… æ¨èä½¿ç”¨ï¼Œæ€§èƒ½ç¨³å®šã€ç»“æ„å®‰å…¨
// âœ… å¯é…åˆ it.remove() åˆ é™¤å…ƒç´ ï¼ˆéå†è¿‡ç¨‹ä¸­ï¼‰
```

### 4.3 CopyOnWriteArrayListéå†ç‰¹æ€§


| éå†æ–¹å¼          | æ˜¯å¦çº¿ç¨‹å®‰å…¨ | æ˜¯å¦æ”¯æŒä¿®æ”¹ç»“æ„ | æ˜¯å¦å®æ—¶åæ˜ ç»“æ„å˜åŒ– | æ˜¯å¦æ¨è |
|-------------------|--------------|------------------|---------------------|----------|
| **ä¼ ç»Ÿ `for`**      | âœ… æ˜¯    | âœ… æ”¯æŒ     | âŒ å¦ï¼ˆå¿«ç…§ï¼‰    | âœ… å¯ç”¨ |
| **å¢å¼º `for-each`** | âœ… æ˜¯    | âŒ ä¸æ”¯æŒåˆ é™¤  | âŒ å¦ï¼ˆå¿«ç…§ï¼‰    | âœ… æ¨è |
| **`Iterator`**    | âœ… æ˜¯    | âŒ ä¸æ”¯æŒåˆ é™¤  | âŒ å¦ï¼ˆå¿«ç…§ï¼‰    | âœ… æ¨è |

**ğŸ’¡ CopyOnWriteArrayListéå†ç¤ºä¾‹**
```java
// === ä¼ ç»Ÿ for å¾ªç¯ ===
import java.util.concurrent.CopyOnWriteArrayList;

CopyOnWriteArrayList<String> list = new CopyOnWriteArrayList<>(List.of("A", "B", "C"));

for (int i = 0; i < list.size(); i++) {
    System.out.println(list.get(i));
}
// âœ… çº¿ç¨‹å®‰å…¨
// â—è™½ç„¶æ”¯æŒä¿®æ”¹ï¼Œä½†ç»“æ„å˜åŠ¨ä¸å½±å“å½“å‰éå†å†…å®¹ï¼ˆå› ä¸ºå†…éƒ¨æ˜¯å¤åˆ¶æ•°ç»„ï¼‰

// === å¢å¼º for-each å¾ªç¯ ===
for (String s : list) {
    System.out.println(s);
}

// âœ… ä¸ä¼šæŠ› ConcurrentModificationException
// â—éå†çš„æ˜¯ä¸€ä¸ªå¿«ç…§å‰¯æœ¬ï¼Œå³ä½¿ä¸­é€”æ‰§è¡Œäº† list.add() ä¹Ÿä¸ä¼šå½±å“æœ¬æ¬¡å¾ªç¯

// === ä½¿ç”¨ Iterator ===
Iterator<String> it = list.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}
// âœ… ä¸æŠ›å¼‚å¸¸ï¼Œçº¿ç¨‹å®‰å…¨
// â—Iterator.remove() ä¸æ”¯æŒï¼Œä¼šæŠ› UnsupportedOperationException
```

> **ğŸ“Œ æ³¨æ„**ï¼šCopyOnWriteArrayList çš„éå†éƒ½æ˜¯åŸºäºå¿«ç…§å‰¯æœ¬ï¼Œåœ¨é«˜å¹¶å‘è¯»åœºæ™¯éå¸¸å®‰å…¨ã€‚ä½†ç”±äºå…¶ç»“æ„ä¿®æ”¹ä¼šå¯¼è‡´æ•°ç»„å¤åˆ¶ï¼Œæ‰€ä»¥ä¸é€‚åˆé¢‘ç¹å†™å…¥çš„åœºæ™¯ã€‚

---

## 5. ğŸ”— éå†Seté›†åˆ


### 5.1 HashSetéå†æ–¹å¼


| éå†æ–¹å¼          | æ˜¯å¦æ”¯æŒ  | åˆ é™¤æ”¯æŒ  | æ˜¯å¦æ¨è | ç‰¹ç‚¹è¯´æ˜          |
|-------------------|-----------|-----------|----------|-------------------|
| **ä¼ ç»Ÿ `for`**      | âŒ ä¸æ”¯æŒ | âŒ ä¸é€‚ç”¨ | âŒ    | æ— ç´¢å¼•ï¼Œä¸èƒ½ `get(i)` |
| **å¢å¼º `for-each`** | âœ… æ”¯æŒ  | âŒ ä¸å®‰å…¨ | âœ…    | ç®€æ´ï¼Œä¸èƒ½ä¿®æ”¹ç»“æ„     |
| **`Iterator`**    | âœ… æ”¯æŒ  | âœ… å®‰å…¨  | âœ… æ¨è | æ¨èç”¨äºåˆ é™¤ã€ä¿®æ”¹ç»“æ„åœºæ™¯ |

**ğŸ’¡ HashSetéå†ç¤ºä¾‹**
```java
// âŒ ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
// HashSet æ— ç´¢å¼•ï¼Œä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿ for éå†
for (int i = 0; i < set.size(); i++) {
    // set.get(i); âŒ ç¼–è¯‘æŠ¥é”™ï¼šæ—  get() æ–¹æ³•
}
// HashSet æ— åºã€æ— ä¸‹æ ‡ï¼Œä¸æ”¯æŒä¼ ç»Ÿ forï¼ˆâŒ ä¸å¯ä½¿ç”¨ get(i)ï¼‰

// === å¢å¼º for-each å¾ªç¯ï¼ˆæ¨èï¼‰ ===
Set<String> set = new HashSet<>(Set.of("A", "B", "C"));

for (String s : set) {
    System.out.println(s);
}

// âœ… ç®€æ´ã€æœ€å¸¸ç”¨æ–¹å¼
// âŒ éå†ä¸­ä¸èƒ½è°ƒç”¨ set.remove()ï¼Œå¦åˆ™æŠ›å‡º ConcurrentModificationException

// === ä½¿ç”¨ Iteratorï¼ˆæ¨èç”¨äºå¯åˆ é™¤åœºæ™¯ï¼‰ ===
Iterator<String> it = set.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}
// âœ… å¯å®‰å…¨éå†
// âœ… å¯é…åˆ it.remove() åˆ é™¤å½“å‰å…ƒç´ ï¼ˆåˆ é™¤æ—¶çš„å”¯ä¸€å®‰å…¨æ–¹å¼ï¼‰
```

### 5.2 LinkedHashSetéå†ç‰¹æ€§


| éå†æ–¹å¼          | æ˜¯å¦æ”¯æŒ  | æ˜¯å¦èƒ½åˆ é™¤å…ƒç´  | æ˜¯å¦æœ‰é¡ºåº  | æ˜¯å¦æ¨è | ç‰¹ç‚¹è¯´æ˜                |
|-------------------|-----------|----------------|-------------|----------|-------------------------|
| **ä¼ ç»Ÿ `for`**      | âŒ ä¸æ”¯æŒ | âŒ             | âŒ          | âŒ    | æ— ç´¢å¼•è®¿é—®ï¼Œæ— æ³•ä½¿ç”¨ `get(i)` |
| **å¢å¼º `for-each`** | âœ… æ”¯æŒ  | âŒ ä¸å®‰å…¨       | âœ… æ’å…¥é¡ºåº | âœ…    | ç®€æ´å¸¸ç”¨ï¼Œé€‚åˆåªè¯»éå†         |
| **`Iterator`**    | âœ… æ”¯æŒ  | âœ… å®‰å…¨åˆ é™¤     | âœ… æ’å…¥é¡ºåº | âœ… æ¨è | æ¨èç”¨äºè¾¹éå†è¾¹åˆ é™¤æˆ–å¹¶å‘å®‰å…¨æ§åˆ¶   |

**ğŸ’¡ LinkedHashSetéå†ç¤ºä¾‹**
```java
// âŒ ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
LinkedHashSet<String> set = new LinkedHashSet<>(Set.of("A", "B", "C"));

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šæ²¡æœ‰ç´¢å¼•æ–¹æ³•
// for (int i = 0; i < set.size(); i++) {
//     System.out.println(set.get(i)); // ç¼–è¯‘é”™è¯¯
// }
// LinkedHashSet ä¸æ”¯æŒæŒ‰ç´¢å¼•è®¿é—®ï¼Œä¸èƒ½ç”¨ get(i)ï¼Œå› æ­¤ä¼ ç»Ÿ for ä¸é€‚ç”¨

// === å¢å¼º for-eachï¼ˆæœ€å¸¸ç”¨ï¼‰ ===
for (String s : set) {
    System.out.println(s);
}
// âœ… éµå¾ªæ’å…¥é¡ºåºéå†
// âŒ éå†ä¸­ä¸èƒ½ä½¿ç”¨ set.remove()ï¼Œå¦åˆ™æŠ› ConcurrentModificationException

// === ä½¿ç”¨ Iteratorï¼ˆç”¨äºè¾¹éå†è¾¹ä¿®æ”¹ï¼‰ ===
Iterator<String> it = set.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}
// âœ… æ”¯æŒå®‰å…¨åˆ é™¤ï¼šit.remove() âœ…
// âœ… éå†é¡ºåºä¿æŒæ’å…¥é¡ºåº
// âš ï¸ æ¯æ¬¡éå†éœ€é‡æ–°è·å–æ–°çš„ Iterator
```

### 5.3 TreeSetéå†ç‰¹æ€§


| éå†æ–¹å¼          | æ˜¯å¦æ”¯æŒ  | æ˜¯å¦èƒ½åˆ é™¤å…ƒç´  | æ˜¯å¦æ’åº   | æ˜¯å¦æ¨è | ç‰¹ç‚¹è¯´æ˜        |
|-------------------|-----------|----------------|------------|----------|-----------------|
| **ä¼ ç»Ÿ `for`**      | âŒ ä¸æ”¯æŒ | âŒ             | âŒ          | âŒ    | æ— ç´¢å¼•è®¿é—®ï¼Œä¸å¯ä½¿ç”¨  |
| **å¢å¼º `for-each`** | âœ… æ”¯æŒ  | âŒ ä¸å®‰å…¨       | âœ… å‡åºéå† | âœ…    | ç®€æ´ï¼Œæ¨èç”¨äºåªè¯»åœºæ™¯ |
| **`Iterator`**    | âœ… æ”¯æŒ  | âœ… å®‰å…¨åˆ é™¤     | âœ… å‡åºéå† | âœ… æ¨è | æ¨èç”¨äºè¾¹éå†è¾¹åˆ é™¤  |

**ğŸ’¡ TreeSetéå†ç¤ºä¾‹**
```java
// âŒ ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
TreeSet<String> set = new TreeSet<>(Set.of("B", "A", "C"));

// âŒ é”™è¯¯ï¼šTreeSet æ— ç´¢å¼•ï¼Œä¸èƒ½ç”¨ for (int i = 0; i < ...)
// for (int i = 0; i < set.size(); i++) {
//     System.out.println(set.get(i)); // âŒ æŠ¥é”™ï¼Œæ²¡æœ‰ get(i)
// }
// TreeSet æ˜¯åŸºäºçº¢é»‘æ ‘ï¼Œæ— ç´¢å¼•ï¼Œä¸èƒ½ç”¨ get(i)ï¼Œä¸æ”¯æŒä¼ ç»Ÿ for

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (String s : set) {
    System.out.println(s);
}
// âœ… éå†å…ƒç´ æ˜¯å‡åºæ’åº
// âŒ ä¸å…è®¸ç»“æ„ä¿®æ”¹ï¼ˆå¦‚ set.remove()ï¼‰ï¼Œå¦åˆ™æŠ›å‡º ConcurrentModificationException

// === ä½¿ç”¨ Iteratorï¼ˆæ¨èç”¨äºä¿®æ”¹ï¼‰ ===
Iterator<String> it = set.iterator();
while (it.hasNext()) {
    String s = it.next();
    System.out.println(s);
}
// âœ… éå†é¡ºåºæ˜¯è‡ªç„¶å‡åºï¼ˆæˆ– Comparator å®šä¹‰çš„é¡ºåºï¼‰
// âœ… å¯ä½¿ç”¨ it.remove() åˆ é™¤å…ƒç´ ï¼Œé¿å… fail-fast å¼‚å¸¸
// âŒ ä¸æ”¯æŒåå‘éå†ï¼ˆå¦‚ ListIteratorï¼‰
```

### 5.4 CopyOnWriteArraySetéå†ç‰¹æ€§


**ğŸ’¡ CopyOnWriteArraySetéå†ç¤ºä¾‹**
```java
// âŒ ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
CopyOnWriteArraySet<String> set = new CopyOnWriteArraySet<>(Set.of("A", "B", "C"));

// âŒ é”™è¯¯ï¼šCopyOnWriteArraySet æ— ç´¢å¼•è®¿é—®
// for (int i = 0; i < set.size(); i++) {
//     System.out.println(set.get(i)); // ç¼–è¯‘é”™è¯¯ï¼šæ—  get() æ–¹æ³•
// }
// CopyOnWriteArraySet æ˜¯åŸºäºæ•°ç»„çš„ï¼Œä½†ä¸æä¾›ç´¢å¼•æ–¹æ³•ï¼Œå› æ­¤ä¼ ç»Ÿ for ä¸é€‚ç”¨

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (String s : set) {
    System.out.println(s);
}

// âœ… çº¿ç¨‹å®‰å…¨ï¼Œéå†æ—¶ä¸ä¼šæŠ› ConcurrentModificationException
// â— éå†çš„æ˜¯å¿«ç…§å‰¯æœ¬ï¼Œä¿®æ”¹ä¸ä¼šå½±å“å½“å‰éå†

// === ä½¿ç”¨ Iterator ===
Iterator<String> it = set.iterator();
while (it.hasNext()) {
    System.out.println(it.next());
}
// âœ… åŒæ ·çº¿ç¨‹å®‰å…¨
// â— ä¸æ”¯æŒ it.remove()ï¼Œå¦åˆ™æŠ› UnsupportedOperationException
// âœ… å¤šçº¿ç¨‹ä¸‹å¯è¯»ä¸€è‡´ï¼Œä½†ä¸åæ˜ æ–°å¢/åˆ é™¤å†…å®¹
```

---

## 6. ğŸš€ éå†Queueé›†åˆ


### 6.1 PriorityQueueéå†ç‰¹æ€§


| éå†æ–¹å¼          | æ˜¯å¦æ”¯æŒ | æ˜¯å¦é¡ºåºè®¿é—®  | å¯å¦ä¿®æ”¹         | æ˜¯å¦æ¨è | ç‰¹ç‚¹è¯´æ˜             |
|-------------------|----------|---------------|------------------|----------|----------------------|
| **ä¼ ç»Ÿ `for`**      | âŒ å¦  | âŒ æ— æ³•ä½¿ç”¨  | âŒ å¦          | âŒ    | æ—  get(i)ï¼Œä¸æ”¯æŒç´¢å¼•   |
| **å¢å¼º `for-each`** | âœ… æ˜¯  | âŒ éä¼˜å…ˆé¡ºåº | âŒ å¦          | âœ…    | æ–¹ä¾¿ï¼Œä½†é¡ºåºä¸ä¿è¯        |
| **`Iterator`**    | âœ… æ˜¯  | âŒ éä¼˜å…ˆé¡ºåº | âœ…ï¼ˆit.removeï¼‰ | âœ…    | å¯è¾¹éå†è¾¹åˆ é™¤ï¼Œä½†ä»éä¼˜å…ˆé¡ºåº  |
| **`poll()`**      | âœ… æ˜¯  | âœ… ä¼˜å…ˆé¡ºåº  | âœ…            | âœ… æ¨è | æŒ‰ä¼˜å…ˆçº§é¡ºåºé€ä¸ªå‡ºé˜Ÿï¼ˆç ´åç»“æ„ï¼‰ |

**ğŸ’¡ PriorityQueueéå†ç¤ºä¾‹**
```java
// âŒ ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
PriorityQueue<Integer> queue = new PriorityQueue<>(List.of(3, 1, 4));

// âŒ é”™è¯¯ï¼šPriorityQueue æ—  get(i)
// for (int i = 0; i < queue.size(); i++) {
//     System.out.println(queue.get(i)); // ç¼–è¯‘é”™è¯¯
// }
// PriorityQueue åŸºäºå †ç»“æ„ï¼ˆæœ€å°å †ï¼‰ï¼Œä¸æ”¯æŒç´¢å¼•è®¿é—®ï¼Œä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿ for

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (Integer val : queue) {
    System.out.println(val);
}
// âœ… å¯ç”¨
// â— éå†é¡ºåºä¸æ˜¯ä¼˜å…ˆçº§é¡ºåºï¼Œè€Œæ˜¯å †å†…éƒ¨ç»“æ„é¡ºåºï¼ˆå¯èƒ½æ— åºï¼‰

// === ä½¿ç”¨ Iterator ===
Iterator<Integer> it = queue.iterator();
while (it.hasNext()) {
    System.out.println(it.next());
}
// âœ… ä¸å¢å¼º for ä¸€æ ·ï¼Œéå†çš„æ˜¯å†…éƒ¨å †ç»“æ„ï¼Œéä¼˜å…ˆé¡ºåº
// âŒ ä¿®æ”¹æ—¶ä¸èƒ½ä½¿ç”¨ queue.remove()ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸
// âœ… æ¨èç”¨äºéå†ä¸­å®‰å…¨åˆ é™¤ï¼ˆä½¿ç”¨ it.remove()ï¼‰

// === æ­£ç¡®æ–¹å¼ï¼šå‡ºé˜ŸæŸ¥çœ‹ä¼˜å…ˆé¡ºåº ===
while (!queue.isEmpty()) {
    System.out.println(queue.poll()); // æŒ‰ä¼˜å…ˆçº§å‡ºé˜Ÿ
}
```

### 6.2 ArrayDequeéå†ç‰¹æ€§


| éå†æ–¹å¼                   | æ˜¯å¦æ”¯æŒ | æ˜¯å¦èƒ½åˆ é™¤å…ƒç´  | éå†é¡ºåº  | æ˜¯å¦æ¨è | ç‰¹ç‚¹è¯´æ˜         |
|----------------------------|----------|----------------|-----------|----------|------------------|
| **ä¼ ç»Ÿ `for`**               | âŒ å¦  | âŒ å¦     | âŒ ä¸é€‚ç”¨ | âŒ    | æ— ç´¢å¼•è®¿é—®        |
| **å¢å¼º `for-each`**          | âœ… æ˜¯  | âŒ å¦     | å¤´ â†’ å°¾ | âœ…    | ç®€æ´å¸¸ç”¨ï¼Œä¸æ”¯æŒç»“æ„ä¿®æ”¹ |
| **`Iterator`**             | âœ… æ˜¯  | âœ… å®‰å…¨åˆ é™¤  | å¤´ â†’ å°¾ | âœ… æ¨è | å¯è¾¹éå†è¾¹åˆ é™¤      |
| **`descendingIterator()`** | âœ… æ˜¯  | âœ… åˆ é™¤å®‰å…¨  | å°¾ â†’ å¤´ | âœ…    | æ”¯æŒåå‘éå†       |

**ğŸ’¡ ArrayDequeéå†ç¤ºä¾‹**
```java
// âŒ ä¼ ç»Ÿ forï¼ˆä¸æ”¯æŒï¼‰
ArrayDeque<String> deque = new ArrayDeque<>(List.of("A", "B", "C"));

// âŒ é”™è¯¯ï¼šæ²¡æœ‰ get(i) æ–¹æ³•
// for (int i = 0; i < deque.size(); i++) {
//     System.out.println(deque.get(i)); // ç¼–è¯‘é”™è¯¯
// }
// ArrayDeque æ˜¯é˜Ÿåˆ—ç»“æ„ï¼Œæ²¡æœ‰ç´¢å¼•è®¿é—®ï¼Œä¸æ”¯æŒä¼ ç»Ÿ for 

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (String s : deque) {
    System.out.println(s);
}
// âœ… éå†é¡ºåºä¸ºé˜Ÿåˆ—å¤´ â†’ é˜Ÿåˆ—å°¾
// âŒ éå†ä¸­ä¸èƒ½ä½¿ç”¨ deque.remove()ï¼Œå¦åˆ™å¯èƒ½è§¦å‘ ConcurrentModificationException

// === ä½¿ç”¨ Iteratorï¼ˆæ¨èï¼‰ ===
Iterator<String> it = deque.iterator();
while (it.hasNext()) {
    System.out.println(it.next());
}
// âœ… æ”¯æŒå®‰å…¨åˆ é™¤ï¼ˆä½¿ç”¨ it.remove()ï¼‰
// âœ… éå†æ–¹å‘åŒ for-eachï¼šå¤´ â†’ å°¾
// âŒ ä¸æ”¯æŒ ListIteratorï¼ˆä¸èƒ½åå‘éå†ï¼‰

// === æ­£å‘ vs åå‘éå†ï¼ˆå¦‚æœéœ€è¦ï¼‰ ===
// æ­£å‘éå†
for (String s : deque) {
    System.out.println(s);
}

// åå‘éå†ï¼ˆä½¿ç”¨ descendingIteratorï¼‰
Iterator<String> desc = deque.descendingIterator();
while (desc.hasNext()) {
    System.out.println(desc.next());
}
```

---

## 7. ğŸ—ºï¸ éå†Mapé›†åˆ


### 7.1 HashMapéå†æ–¹å¼


| éå†ç›®æ ‡     | æ¨èæ–¹å¼                  | æ˜¯å¦èƒ½å®‰å…¨åˆ é™¤ | æ˜¯å¦é¡ºåºä¿è¯ | æ˜¯å¦æ¨è  |
|--------------|---------------------------|----------------|--------------|-----------|
| **é”®å€¼å¯¹**      | `for-each entrySet()` | âŒ å¦     | âŒ æ— åº   | âœ… æœ€å¸¸ç”¨ |
| **é”®ï¼ˆkeyï¼‰**   | `for-each keySet()`   | âŒ å¦     | âŒ æ— åº   | âœ…     |
| **å€¼ï¼ˆvalueï¼‰** | `for-each values()`   | âŒ å¦     | âŒ æ— åº   | âœ…     |
| **ä¿®æ”¹ç»“æ„éå†**   | `Iterator entrySet()` | âœ… æ˜¯     | âŒ æ— åº   | âœ… å®‰å…¨  |

**ğŸ’¡ HashMapéå†ç¤ºä¾‹**
```java
// ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
Map<String, Integer> map = new HashMap<>(Map.of("A", 1, "B", 2));

// âŒ HashMap æ— ç´¢å¼•ï¼Œä¸èƒ½ä½¿ç”¨ get(i)ï¼Œä¸æ”¯æŒä¼ ç»Ÿ for éå†
// for (int i = 0; i < map.size(); i++) {
//     System.out.println(map.get(i)); // ç¼–è¯‘é”™è¯¯
// }

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (Map.Entry<String, Integer> entry : map.entrySet()) {
    System.out.println(entry.getKey() + ": " + entry.getValue());
}       //  éå†é”®å€¼å¯¹ï¼ˆæœ€å¸¸ç”¨ï¼‰

for (String key : map.keySet()) {
    System.out.println(key);
}   // éå† key

for (Integer value : map.values()) {
    System.out.println(value);
}       // éå† value

// âœ… ç®€æ´è¯­æ³•
// âŒ ä¸å¯ç»“æ„ä¿®æ”¹ï¼ˆä¸èƒ½æ‰§è¡Œ map.remove()ï¼‰ï¼Œå¦åˆ™ä¼šæŠ› ConcurrentModificationException

// === ä½¿ç”¨ Iteratorï¼ˆç”¨äºåˆ é™¤æˆ–ä¿®æ”¹ï¼‰ ===
Iterator<Map.Entry<String, Integer>> it = map.entrySet().iterator();
while (it.hasNext()) {
    Map.Entry<String, Integer> entry = it.next();
    if (entry.getValue() == 2) {
        it.remove(); // âœ… å®‰å…¨åˆ é™¤
    }
}       // éå†å¹¶åˆ é™¤é”®å€¼å¯¹

// éå† key
Iterator<String> keyIt = map.keySet().iterator();
while (keyIt.hasNext()) {
    String key = keyIt.next();
    System.out.println("key = " + key);
}

// éå† value
Iterator<Integer> valueIt = map.values().iterator();
while (valueIt.hasNext()) {
    Integer value = valueIt.next();
    System.out.println("value = " + value);
}

// âœ… æ¨èç”¨äºè¾¹éå†è¾¹ä¿®æ”¹
// âŒ åªèƒ½é€šè¿‡ iterator.remove() åˆ é™¤ï¼Œä¸èƒ½ç”¨ map.remove(key)
```

### 7.2 LinkedHashMapéå†ç‰¹æ€§


| éå†ç›®æ ‡  | å¢å¼º `for-each` | `Iterator`              | é¡ºåºç±»å‹ | æ˜¯å¦æ”¯æŒåˆ é™¤       |
|-----------|-----------------|-------------------------|----------|-------------------|
| **é”®å€¼å¯¹**   | `entrySet()`  | `entrySet().iterator()` | æ’å…¥é¡ºåº | âœ…ï¼ˆit.removeï¼‰ |
| **key**   | `keySet()`    | `keySet().iterator()`   | æ’å…¥é¡ºåº | âœ…ï¼ˆit.removeï¼‰ |
| **value** | `values()`    | `values().iterator()`   | æ’å…¥é¡ºåº | âœ…ï¼ˆit.removeï¼‰ |

**ğŸ’¡ LinkedHashMapéå†ç¤ºä¾‹**
```java
Map<String, Integer> map = new LinkedHashMap<>();
map.put("A", 1);
map.put("B", 2);
map.put("C", 3);

// ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
// âŒ æ— ç´¢å¼•è®¿é—®ï¼Œä¸èƒ½ä½¿ç”¨ map.get(i)

// === å¢å¼º for-each ===
for (Map.Entry<String, Integer> entry : map.entrySet()) {
    System.out.println(entry.getKey() + " = " + entry.getValue());
}  // éå†é”®å€¼å¯¹

for (String key : map.keySet()) {
    System.out.println("key = " + key);
} //  éå† key

for (Integer value : map.values()) {
    System.out.println("value = " + value);
}  // éå† value

// âœ… é¡ºåºä¸º æ’å…¥é¡ºåº
// âŒ ä¸å¯ä½¿ç”¨ map.remove()ï¼Œå¦åˆ™æŠ›å‡º ConcurrentModificationException

// === ä½¿ç”¨ Iterator ===
Iterator<Map.Entry<String, Integer>> it = map.entrySet().iterator();
while (it.hasNext()) {
    Map.Entry<String, Integer> entry = it.next();
    System.out.println(entry.getKey() + " = " + entry.getValue());
}  // éå†é”®å€¼å¯¹

Iterator<String> keyIt = map.keySet().iterator();
while (keyIt.hasNext()) {
    System.out.println("key = " + keyIt.next());
}  // éå† key

Iterator<Integer> valueIt = map.values().iterator();
while (valueIt.hasNext()) {
    System.out.println("value = " + valueIt.next());
}  // éå† value

// âœ… æ’å…¥é¡ºåºä¸€è‡´
// âœ… å¯ä½¿ç”¨ it.remove() å®‰å…¨åˆ é™¤å…ƒç´ 
// âŒ ä¸å¯ä½¿ç”¨ map.remove() ç›´æ¥åˆ é™¤
```

### 7.3 TreeMapéå†ç‰¹æ€§


| éå†ç›®æ ‡  | å¢å¼º `for-each` | `Iterator`   | é¡ºåºç±»å‹   | æ˜¯å¦æ”¯æŒåˆ é™¤       |
|-----------|-----------------|--------------|------------|-------------------|
| **é”®å€¼å¯¹**   | `entrySet()`  | `entrySet().iterator()` | key å‡åº | âœ…ï¼ˆit.removeï¼‰ |
| **key**   | `keySet()`    | `keySet().iterator()`   | key å‡åº | âœ…ï¼ˆit.removeï¼‰ |
| **value** | `values()`    | `values().iterator()`   | key å‡åº | âœ…ï¼ˆit.removeï¼‰ |

**ğŸ’¡ TreeMapéå†ç¤ºä¾‹**
```java
Map<String, Integer> map = new TreeMap<>();
map.put("B", 2);
map.put("A", 1);
map.put("C", 3);
// ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
// âŒ TreeMap æ— ç´¢å¼•è®¿é—®ï¼Œä¸èƒ½ä½¿ç”¨ map.get(i)

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (Map.Entry<String, Integer> entry : map.entrySet()) {
    System.out.println(entry.getKey() + " = " + entry.getValue());
}  // éå†é”®å€¼å¯¹ï¼ˆæŒ‰ key å‡åºï¼‰

for (String key : map.keySet()) {
    System.out.println("key = " + key);
}   // éå† key

for (Integer value : map.values()) {
    System.out.println("value = " + value);
}   // éå† value

// âœ… é»˜è®¤ key å‡åºæ’åºï¼ˆå¯ä¼  Comparator è‡ªå®šä¹‰ï¼‰
// âŒ éå†ä¸­ä¸èƒ½ä½¿ç”¨ map.remove()ï¼ˆä¼šæŠ›å¼‚å¸¸ï¼‰

// === ä½¿ç”¨ Iteratorï¼ˆå¯ä¿®æ”¹ï¼‰ ===
Iterator<Map.Entry<String, Integer>> it = map.entrySet().iterator();
while (it.hasNext()) {
    Map.Entry<String, Integer> entry = it.next();
    System.out.println(entry.getKey() + " = " + entry.getValue());
}   // éå†é”®å€¼å¯¹

Iterator<String> keyIt = map.keySet().iterator();
while (keyIt.hasNext()) {
    System.out.println("key = " + keyIt.next());
}       // éå† key

Iterator<Integer> valIt = map.values().iterator();
while (valIt.hasNext()) {
    System.out.println("value = " + valIt.next());
}       //  éå† value

// âœ… ä¿è¯å‡åº
// âœ… å¯ä½¿ç”¨ it.remove() åˆ é™¤
// âŒ ä¸æ”¯æŒåå‘éå†ï¼ˆé™¤éä½¿ç”¨ NavigableMap.descendingMap()ï¼‰
```

### 7.4 ConcurrentHashMapéå†ç‰¹æ€§


| éå†ç›®æ ‡  | å¢å¼º `for-each` | `Iterator`    | æ˜¯å¦æ”¯æŒå¹¶å‘ä¿®æ”¹ | æ˜¯å¦æ”¯æŒåˆ é™¤ |
|-----------|-----------------|---------------|------------------|--------------|
| **é”®å€¼å¯¹**   | `entrySet()`  | `entrySet().iterator()` | âœ… æ˜¯      | âŒ å¦    |
| **key**   | `keySet()`    | `keySet().iterator()`   | âœ… æ˜¯      | âŒ å¦    |
| **value** | `values()`    | `values().iterator()`   | âœ… æ˜¯      | âŒ å¦    |

**ğŸ’¡ ConcurrentHashMapéå†ç¤ºä¾‹**
```java
Map<String, Integer> map = new ConcurrentHashMap<>();
map.put("A", 1);
map.put("B", 2);
map.put("C", 3);
// ä¼ ç»Ÿ forï¼ˆä¸é€‚ç”¨ï¼‰
// âŒ æ— ç´¢å¼•è®¿é—®ï¼Œä¸æ”¯æŒ map.get(i)

// === å¢å¼º for-eachï¼ˆæ¨èï¼‰ ===
for (Map.Entry<String, Integer> entry : map.entrySet()) {
    System.out.println(entry.getKey() + " = " + entry.getValue());
}  // éå†é”®å€¼å¯¹

for (String key : map.keySet()) {
    System.out.println("key = " + key);
}       // éå† key

for (Integer value : map.values()) {
    System.out.println("value = " + value);
}   // éå† value

// âœ… éå†æ—¶å…è®¸å¹¶å‘ä¿®æ”¹ï¼ˆå¼±ä¸€è‡´æ€§ï¼‰ï¼Œä¸ä¼šæŠ› ConcurrentModificationException
// âœ… å®æ—¶è¯»å–å½“å‰ç»“æ„å¿«ç…§çš„ä¸€éƒ¨åˆ†ï¼ˆé fail-fastï¼‰

// === ä½¿ç”¨ Iteratorï¼ˆæ”¯æŒåˆ é™¤ï¼‰ ===
Iterator<Map.Entry<String, Integer>> it = map.entrySet().iterator();
while (it.hasNext()) {
    Map.Entry<String, Integer> entry = it.next();
    System.out.println(entry.getKey() + " = " + entry.getValue());
}       // éå†é”®å€¼å¯¹

Iterator<String> keyIt = map.keySet().iterator();
while (keyIt.hasNext()) {
    System.out.println("key = " + keyIt.next());
}       // éå† key

Iterator<Integer> valIt = map.values().iterator();
while (valIt.hasNext()) {
    System.out.println("value = " + valIt.next());
}       // éå† value

// âœ… æ”¯æŒè¾¹éå†è¾¹ä¿®æ”¹ï¼ˆä¸æŠ›å¼‚å¸¸ï¼‰
// â— iterator.remove() åœ¨ ConcurrentHashMap ä¸­æ˜¯ ä¸æ”¯æŒçš„ï¼Œä¼šæŠ› UnsupportedOperationException
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Iteratoræœ¬è´¨ï¼šç»Ÿä¸€éå†æ¥å£ï¼Œé€‚ç”¨äºæ‰€æœ‰Collectionå­ç±»
ğŸ”¸ æ ¸å¿ƒæ–¹æ³•ï¼šhasNext()ã€next()ã€remove() ä¸‰ä¸ªåŸºæœ¬æ–¹æ³•
ğŸ”¸ fail-fastæœºåˆ¶ï¼šéå†ä¸­ä¿®æ”¹é›†åˆç»“æ„ä¼šæŠ›ConcurrentModificationException
ğŸ”¸ å®‰å…¨åˆ é™¤ï¼šåªèƒ½ä½¿ç”¨iterator.remove()ï¼Œä¸èƒ½ç”¨é›†åˆçš„remove()
ğŸ”¸ ä¸€æ¬¡æ€§ä½¿ç”¨ï¼šIteratorç”¨å®Œåéœ€é‡æ–°è·å–ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Iterator vs for-eachçš„æœ¬è´¨**
```
for-eachç¼–è¯‘åŸç†ï¼š
- for-eachåœ¨ç¼–è¯‘æ—¶ä¼šè½¬æ¢ä¸ºIterator
- æœ¬è´¨ä¸Šéƒ½æ˜¯ä½¿ç”¨Iteratorè¿›è¡Œéå†
- for-eachåªæ˜¯æä¾›äº†æ›´ç®€æ´çš„è¯­æ³•ç³–
```

**ğŸ”¹ ä¸åŒé›†åˆçš„éå†é€‰æ‹©**
```
Listé›†åˆï¼š
- ArrayListï¼šä¼ ç»Ÿforæ•ˆç‡é«˜ï¼ŒIteratorå®‰å…¨åˆ é™¤
- LinkedListï¼šé¿å…ä¼ ç»Ÿforï¼Œæ¨èIterator
- CopyOnWriteArrayListï¼šæ‰€æœ‰æ–¹å¼éƒ½çº¿ç¨‹å®‰å…¨

Seté›†åˆï¼š
- åªèƒ½ç”¨for-eachæˆ–Iterator
- ä¸æ”¯æŒç´¢å¼•è®¿é—®ï¼Œä¼ ç»Ÿforä¸é€‚ç”¨
- TreeSetè‡ªåŠ¨æ’åºï¼ŒLinkedHashSetä¿æŒæ’å…¥é¡ºåº

Queueé›†åˆï¼š
- ä¸€èˆ¬ç”¨for-eachæˆ–Iteratoréå†
- PriorityQueueç”¨poll()è·å–ä¼˜å…ˆé¡ºåº
- ArrayDequeæ”¯æŒåŒå‘éå†

Mapé›†åˆï¼š
- éå†entrySet()ã€keySet()ã€values()
- TreeMapè‡ªåŠ¨æŒ‰keyæ’åº
- ConcurrentHashMapæ”¯æŒå¹¶å‘ä¿®æ”¹
```

**ğŸ”¹ çº¿ç¨‹å®‰å…¨çš„è€ƒè™‘**
```
æ™®é€šé›†åˆï¼š
- ArrayListã€HashMapç­‰éçº¿ç¨‹å®‰å…¨
- å¤šçº¿ç¨‹ç¯å¢ƒéœ€è¦å¤–éƒ¨åŒæ­¥

å¹¶å‘é›†åˆï¼š
- CopyOnWriteArrayListï¼šè¯»å¤šå†™å°‘åœºæ™¯
- ConcurrentHashMapï¼šé«˜å¹¶å‘Map
- éå†æ—¶éƒ½ä¸ä¼šæŠ›ConcurrentModificationException
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ éå†æ–¹å¼é€‰æ‹©æŒ‡å—**
```
åªè¯»éå†ï¼š
âœ… ä¼˜å…ˆé€‰æ‹©for-eachï¼ˆç®€æ´ã€å¯è¯»æ€§å¥½ï¼‰
âœ… é€‚ç”¨äºå¤§å¤šæ•°æ—¥å¸¸å¼€å‘åœºæ™¯

éœ€è¦åˆ é™¤å…ƒç´ ï¼š
âœ… å¿…é¡»ä½¿ç”¨Iterator.remove()
âœ… é¿å…åœ¨for-eachä¸­ä½¿ç”¨é›†åˆçš„remove()

éœ€è¦ç´¢å¼•è®¿é—®ï¼š
âœ… ArrayListå¯ç”¨ä¼ ç»Ÿfor
âœ… LinkedListé¿å…ä½¿ç”¨ç´¢å¼•è®¿é—®

å¤šçº¿ç¨‹ç¯å¢ƒï¼š
âœ… ä½¿ç”¨å¹¶å‘é›†åˆç±»
âœ… æˆ–æ·»åŠ å¤–éƒ¨åŒæ­¥æœºåˆ¶
```

**âš ï¸ å¸¸è§é™·é˜±å’Œé¿å‘æŒ‡å—**
```
åˆ é™¤é™·é˜±ï¼š
âŒ åœ¨for-eachä¸­è°ƒç”¨list.remove()
âœ… ä½¿ç”¨Iterator.remove()

æ€§èƒ½é™·é˜±ï¼š
âŒ LinkedListä½¿ç”¨get(i)è®¿é—®
âœ… LinkedListä½¿ç”¨Iteratoréå†

çº¿ç¨‹å®‰å…¨é™·é˜±ï¼š
âŒ å¤šçº¿ç¨‹å…±äº«ArrayList
âœ… ä½¿ç”¨CopyOnWriteArrayListæˆ–åŠ é”

Iteratoré‡ç”¨é™·é˜±ï¼š
âŒ Iteratorç”¨å®Œåç»§ç»­ä½¿ç”¨
âœ… æ¯æ¬¡éå†é‡æ–°è·å–Iterator
```

### 8.4 æ€§èƒ½å¯¹æ¯”æ€»ç»“


```
æ—¶é—´å¤æ‚åº¦å¯¹æ¯”ï¼š

ArrayListéå†ï¼š
- ä¼ ç»Ÿforï¼šO(1) æ¯æ¬¡è®¿é—®
- Iteratorï¼šO(1) æ¯æ¬¡è®¿é—®
- for-eachï¼šO(1) æ¯æ¬¡è®¿é—®ï¼ˆæœ¬è´¨Iteratorï¼‰

LinkedListéå†ï¼š
- ä¼ ç»Ÿforï¼šO(n) æ¯æ¬¡è®¿é—®ï¼ˆæ€§èƒ½å·®ï¼‰
- Iteratorï¼šO(1) æ¯æ¬¡è®¿é—®
- for-eachï¼šO(1) æ¯æ¬¡è®¿é—®

Setéå†ï¼š
- åªèƒ½ç”¨Iteratoræˆ–for-each
- HashSetï¼šO(1) å¹³å‡è®¿é—®
- TreeSetï¼šO(log n) è®¿é—®ï¼ˆæœ‰åºï¼‰

Mapéå†ï¼š
- entrySet()éå†ï¼šæœ€é«˜æ•ˆ
- keySet()éå†ï¼šéœ€è¦é¢å¤–get()è°ƒç”¨
- values()éå†ï¼šåªè®¿é—®å€¼
```

### 8.5 æœ€ä½³å®è·µå»ºè®®


```
ä»£ç è§„èŒƒï¼š
ğŸ”¸ ä¼˜å…ˆä½¿ç”¨for-eachï¼Œä»£ç ç®€æ´æ˜“è¯»
ğŸ”¸ éœ€è¦åˆ é™¤æ—¶ä½¿ç”¨Iterator
ğŸ”¸ é¿å…åœ¨éå†ä¸­ä¿®æ”¹é›†åˆç»“æ„
ğŸ”¸ å¤šçº¿ç¨‹ç¯å¢ƒé€‰æ‹©åˆé€‚çš„å¹¶å‘é›†åˆ

æ€§èƒ½ä¼˜åŒ–ï¼š
ğŸ”¸ ArrayListç”¨ä¼ ç»Ÿforè®¿é—®ç´¢å¼•
ğŸ”¸ LinkedListé¿å…ç´¢å¼•è®¿é—®
ğŸ”¸ å¤§æ•°æ®é‡éå†è€ƒè™‘å¹¶è¡Œå¤„ç†
ğŸ”¸ é¢‘ç¹åˆ é™¤è€ƒè™‘ä½¿ç”¨Iterator

å¼‚å¸¸å¤„ç†ï¼š
ğŸ”¸ ç†è§£fail-fastæœºåˆ¶
ğŸ”¸ æ­£ç¡®å¤„ç†ConcurrentModificationException
ğŸ”¸ åœ¨å¹¶å‘ç¯å¢ƒä¸­é€‰æ‹©æ­£ç¡®çš„é›†åˆç±»å‹
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Iteratorç»Ÿä¸€éå†ï¼Œfor-eachç®€æ´ä¼˜é›…
- åˆ é™¤å…ƒç´ ç”¨removeï¼Œé›†åˆæ–¹æ³•è¦é¿å¼€
- Listå¯ç”¨ä¼ ç»Ÿforï¼ŒSetåªèƒ½è¿­ä»£è¿‡
- çº¿ç¨‹å®‰å…¨é€‰å¹¶å‘ï¼Œfail-fastè¦è®°ä½
- ä¸€æ¬¡ä½¿ç”¨éœ€é‡å–ï¼Œæ€§èƒ½é€‰æ‹©è¦åˆé€‚