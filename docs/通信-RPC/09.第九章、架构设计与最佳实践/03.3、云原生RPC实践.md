---
title: 3ã€äº‘åŸç”ŸRPCå®è·µ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯äº‘åŸç”ŸRPC](#1-ä»€ä¹ˆæ˜¯äº‘åŸç”ŸRPC)
2. [å®¹å™¨åŒ–éƒ¨ç½²å®è·µ](#2-å®¹å™¨åŒ–éƒ¨ç½²å®è·µ)
3. [Kubernetesé›†æˆæ–¹æ¡ˆ](#3-Kubernetesé›†æˆæ–¹æ¡ˆ)
4. [æœåŠ¡ç½‘æ ¼æ¶æ„](#4-æœåŠ¡ç½‘æ ¼æ¶æ„)
5. [APIç½‘å…³é›†æˆ](#5-APIç½‘å…³é›†æˆ)
6. [Serverless RPC](#6-Serverless-RPC)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ä»€ä¹ˆæ˜¯äº‘åŸç”ŸRPC


### 1.1 äº‘åŸç”Ÿçš„æ ¸å¿ƒç†å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿï¼Ÿ**
äº‘åŸç”Ÿå°±æ˜¯ä¸“é—¨ä¸ºäº‘ç¯å¢ƒè®¾è®¡çš„åº”ç”¨æ¶æ„ï¼Œå°±åƒä¸ºæ°´è€Œç”Ÿçš„é±¼ä¸€æ ·ï¼Œå¤©ç”Ÿå°±é€‚åˆåœ¨äº‘ç¯å¢ƒä¸­ç”Ÿå­˜å’Œå‘å±•ã€‚

```
ä¼ ç»Ÿåº”ç”¨éƒ¨ç½²ï¼š               äº‘åŸç”Ÿåº”ç”¨éƒ¨ç½²ï¼š
ç‰©ç†æœº â†’ è™šæ‹Ÿæœº â†’ åº”ç”¨       å®¹å™¨ â†’ ç¼–æ’å¹³å° â†’ å¾®æœåŠ¡

ç‰¹ç‚¹å¯¹æ¯”ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šå¤§å•ä½“ã€æ‰‹å·¥éƒ¨ç½²ã€èµ„æºæµªè´¹
äº‘åŸç”Ÿï¼šå¾®æœåŠ¡ã€è‡ªåŠ¨ç¼–æ’ã€å¼¹æ€§ä¼¸ç¼©
```

**ğŸ’¡ äº‘åŸç”ŸRPCçš„æ ¸å¿ƒä»·å€¼**
```
è‡ªåŠ¨åŒ–è¿ç»´ï¼š
- è‡ªåŠ¨éƒ¨ç½²ã€æ‰©ç¼©å®¹ã€æ•…éšœæ¢å¤
- å°±åƒæœ‰äº†æ™ºèƒ½ç®¡å®¶ï¼Œä¸ç”¨äººå·¥å¹²é¢„

å¼¹æ€§ä¼¸ç¼©ï¼š
- æµé‡å¤§æ—¶è‡ªåŠ¨å¢åŠ æœåŠ¡å®ä¾‹
- æµé‡å°æ—¶è‡ªåŠ¨å‡å°‘ï¼ŒèŠ‚çœæˆæœ¬

é«˜å¯ç”¨æ€§ï¼š
- æœåŠ¡æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢
- å¤šå‰¯æœ¬ä¿è¯æœåŠ¡ä¸ä¸­æ–­

è§‚æµ‹æ€§ï¼š
- å®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€
- å¿«é€Ÿå®šä½é—®é¢˜æ ¹æº
```

### 1.2 äº‘åŸç”ŸRPCæ¶æ„å…¨æ™¯å›¾


```
                    å¤–éƒ¨ç”¨æˆ·/ç³»ç»Ÿ
                          |
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  APIç½‘å…³    â”‚ â† ç»Ÿä¸€å…¥å£
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          |
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æœåŠ¡ç½‘æ ¼    â”‚ â† æµé‡ç®¡ç†
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ç”¨æˆ·æœåŠ¡   â”‚    è®¢å•æœåŠ¡    â”‚   æ”¯ä»˜æœåŠ¡   â”‚
    â”‚  (å®¹å™¨åŒ–)   â”‚   (å®¹å™¨åŒ–)    â”‚  (å®¹å™¨åŒ–)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          |
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Kubernetes    â”‚ â† å®¹å™¨ç¼–æ’
                â”‚   é›†ç¾¤ç®¡ç†      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²å®è·µ


### 2.1 Dockeré•œåƒä¼˜åŒ–


**ğŸ”¸ ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–ï¼Ÿ**
å®¹å™¨å°±åƒä¸€ä¸ªæ ‡å‡†åŒ–çš„åŒ…è£…ç›’ï¼ŒæŠŠä½ çš„RPCæœåŠ¡å’Œå®ƒéœ€è¦çš„æ‰€æœ‰ä¸œè¥¿ï¼ˆä»£ç ã€ä¾èµ–ã€é…ç½®ï¼‰éƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ”¾åˆ°ä»»ä½•åœ°æ–¹éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚

**ğŸ“¦ Dockeré•œåƒåˆ†å±‚ä¼˜åŒ–**
```dockerfile
# å¤šé˜¶æ®µæ„å»º - åˆ†ç¦»æ„å»ºå’Œè¿è¡Œç¯å¢ƒ
FROM golang:1.19-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# åªå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œåˆ©ç”¨ç¼“å­˜å±‚
COPY go.mod go.sum ./
RUN go mod download

# å¤åˆ¶æºç å¹¶æ„å»º
COPY . .
RUN CGO_ENABLED=0 go build -o rpc-service ./cmd/server

# è¿è¡Œé˜¶æ®µ - ä½¿ç”¨æœ€å°é•œåƒ
FROM alpine:3.18
RUN apk --no-cache add ca-certificates
WORKDIR /root/

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
COPY --from=builder /app/rpc-service .

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤
CMD ["./rpc-service"]
```

**âš¡ é•œåƒä¼˜åŒ–æŠ€å·§**
```bash
# ä¼˜åŒ–å‰åå¯¹æ¯”
åŸå§‹é•œåƒå¤§å°: 800MB  (åŒ…å«å®Œæ•´Goç¯å¢ƒ)
ä¼˜åŒ–åå¤§å°: 15MB    (åªåŒ…å«äºŒè¿›åˆ¶æ–‡ä»¶)

ä¼˜åŒ–æ‰‹æ®µï¼š
âœ… å¤šé˜¶æ®µæ„å»ºï¼šæ„å»ºå’Œè¿è¡Œåˆ†ç¦»
âœ… åŸºç¡€é•œåƒé€‰æ‹©ï¼šalpineä»£æ›¿ubuntu
âœ… å±‚çº§ç¼“å­˜ï¼šä¾èµ–æ–‡ä»¶å…ˆå¤åˆ¶
âœ… æ¸…ç†ç¼“å­˜ï¼šåˆ é™¤ä¸å¿…è¦æ–‡ä»¶
```

### 2.2 å¥åº·æ£€æŸ¥é…ç½®


**ğŸ©º ä¸ºä»€ä¹ˆéœ€è¦å¥åº·æ£€æŸ¥ï¼Ÿ**
å°±åƒåŒ»ç”Ÿå®šæœŸä½“æ£€ä¸€æ ·ï¼Œå®¹å™¨ä¹Ÿéœ€è¦å®šæœŸæ£€æŸ¥æ˜¯å¦å¥åº·ã€‚ä¸å¥åº·çš„å®¹å™¨ä¼šè¢«è‡ªåŠ¨é‡å¯æˆ–æ›¿æ¢ã€‚

```dockerfile
# Dockerfileä¸­çš„å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8080/health || exit 1
```

```go
// Go RPCæœåŠ¡çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹
func (s *Server) HealthCheck(ctx context.Context, req *pb.HealthCheckRequest) (*pb.HealthCheckResponse, error) {
    // æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if !s.db.Ping() {
        return &pb.HealthCheckResponse{Status: pb.HealthCheckResponse_NOT_SERVING}, nil
    }
    
    // æ£€æŸ¥å…³é”®ä¾èµ–æœåŠ¡
    if !s.checkDependencies() {
        return &pb.HealthCheckResponse{Status: pb.HealthCheckResponse_NOT_SERVING}, nil
    }
    
    return &pb.HealthCheckResponse{Status: pb.HealthCheckResponse_SERVING}, nil
}
```

### 2.3 èµ„æºé™åˆ¶é…ç½®


**ğŸ“Š èµ„æºé™åˆ¶çš„é‡è¦æ€§**
```yaml
# docker-compose.yml èµ„æºé™åˆ¶
services:
  rpc-service:
    image: my-rpc-service:latest
    deploy:
      resources:
        limits:
          cpus: '0.50'      # æœ€å¤šä½¿ç”¨0.5ä¸ªCPUæ ¸å¿ƒ
          memory: 512M      # æœ€å¤šä½¿ç”¨512MBå†…å­˜
        reservations:
          cpus: '0.25'      # ä¿è¯0.25ä¸ªCPUæ ¸å¿ƒ
          memory: 256M      # ä¿è¯256MBå†…å­˜
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦é™åˆ¶èµ„æºï¼Ÿ**
- **é˜²æ­¢èµ„æºç«äº‰**ï¼šé¿å…ä¸€ä¸ªæœåŠ¡å ç”¨è¿‡å¤šèµ„æºå½±å“å…¶ä»–æœåŠ¡
- **æˆæœ¬æ§åˆ¶**ï¼šåˆç†åˆ†é…èµ„æºï¼Œé¿å…æµªè´¹
- **æ€§èƒ½é¢„æµ‹**ï¼šèµ„æºä½¿ç”¨å¯é¢„æœŸï¼Œä¾¿äºæ€§èƒ½è§„åˆ’

---

## 3. â˜¸ï¸ Kubernetesé›†æˆæ–¹æ¡ˆ


### 3.1 ä»€ä¹ˆæ˜¯Kubernetesï¼Ÿ


**ğŸ”¸ Kubernetesç®€ä»‹**
Kubernetesï¼ˆK8sï¼‰å°±åƒä¸€ä¸ªè¶…çº§æ™ºèƒ½çš„å®¹å™¨ç®¡ç†å‘˜ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç®¡ç†æˆåƒä¸Šä¸‡ä¸ªå®¹å™¨ï¼Œè®©å®ƒä»¬ååŒå·¥ä½œã€‚

```
æ²¡æœ‰K8sçš„ä¸–ç•Œï¼š                æœ‰äº†K8sçš„ä¸–ç•Œï¼š
æ‰‹å·¥éƒ¨ç½²å®¹å™¨                   è‡ªåŠ¨åŒ–ç¼–æ’
æ‰‹å·¥ç›‘æ§çŠ¶æ€                   è‡ªåŠ¨å¥åº·æ£€æŸ¥
æ‰‹å·¥æ‰©å®¹ç¼©å®¹                   è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©
æ‰‹å·¥æ•…éšœæ¢å¤                   è‡ªåŠ¨æ•…éšœè½¬ç§»
```

### 3.2 Service Discovery - æœåŠ¡å‘ç°


**ğŸ” ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°ï¼Ÿ**
æœåŠ¡å‘ç°å°±åƒç”µè¯ç°¿ï¼Œå¸®åŠ©æœåŠ¡æ‰¾åˆ°å…¶ä»–æœåŠ¡çš„åœ°å€ã€‚åœ¨K8sä¸­ï¼Œè¿™ä¸ªç”µè¯ç°¿æ˜¯è‡ªåŠ¨ç»´æŠ¤çš„ã€‚

```yaml
# Serviceå®šä¹‰ - åˆ›å»ºæœåŠ¡çš„"ç”µè¯ç°¿"æ¡ç›®
apiVersion: v1
kind: Service
metadata:
  name: user-service
spec:
  selector:
    app: user-service
  ports:
    - port: 8080
      targetPort: 8080
  type: ClusterIP
```

**ğŸ“ æœåŠ¡è°ƒç”¨ç¤ºä¾‹**
```go
// åœ¨K8sä¸­ï¼ŒæœåŠ¡å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥è°ƒç”¨
conn, err := grpc.Dial("user-service:8080", grpc.WithInsecure())
if err != nil {
    log.Fatal("è¿æ¥ç”¨æˆ·æœåŠ¡å¤±è´¥:", err)
}

// K8sä¼šè‡ªåŠ¨å°† "user-service" è§£æä¸ºå®é™…çš„Pod IP
```

**ğŸ’¡ K8sæœåŠ¡å‘ç°çš„ä¼˜åŠ¿**
- **è‡ªåŠ¨æ›´æ–°**ï¼šPodé‡å¯åIPå˜åŒ–ï¼ŒServiceè‡ªåŠ¨æ›´æ–°
- **è´Ÿè½½å‡è¡¡**ï¼šè‡ªåŠ¨åœ¨å¤šä¸ªPodé—´åˆ†é…è¯·æ±‚
- **å¥åº·æ£€æŸ¥**ï¼šåªå‘å¥åº·çš„Podå‘é€è¯·æ±‚

### 3.3 ConfigMap - é…ç½®ç®¡ç†


**âš™ï¸ ä»€ä¹ˆæ˜¯ConfigMapï¼Ÿ**
ConfigMapå°±åƒä¸€ä¸ªé…ç½®æ–‡ä»¶ç®¡ç†å™¨ï¼ŒæŠŠé…ç½®å’Œä»£ç åˆ†ç¦»ï¼Œè®©åŒä¸€ä»½ä»£ç åœ¨ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®ã€‚

```yaml
# ConfigMapå®šä¹‰
apiVersion: v1
kind: ConfigMap
metadata:
  name: rpc-config
data:
  database.yaml: |
    host: postgres.default.svc.cluster.local
    port: 5432
    database: myapp
  app.properties: |
    log.level=info
    grpc.port=8080
    timeout=30s
```

```yaml
# åœ¨Deploymentä¸­ä½¿ç”¨ConfigMap
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rpc-service
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: rpc-service
        image: my-rpc-service:latest
        volumeMounts:
        - name: config-volume
          mountPath: /etc/config
      volumes:
      - name: config-volume
        configMap:
          name: rpc-config
```

**ğŸ”„ çƒ­æ›´æ–°é…ç½®**
```bash
# æ›´æ–°é…ç½®
kubectl patch configmap rpc-config -p '{"data":{"app.properties":"log.level=debug\ngrpc.port=8080"}}'

# é‡å¯Podä½¿é…ç½®ç”Ÿæ•ˆ
kubectl rollout restart deployment/rpc-service
```

### 3.4 Secret - å¯†é’¥ç®¡ç†


**ğŸ” ä»€ä¹ˆæ˜¯Secretï¼Ÿ**
Secretå°±åƒä¿é™©ç®±ï¼Œä¸“é—¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€å¯†é’¥ã€è¯ä¹¦ï¼‰ï¼Œå¹¶ä¸”ä¼šåŠ å¯†å­˜å‚¨ã€‚

```yaml
# Secretå®šä¹‰
apiVersion: v1
kind: Secret
metadata:
  name: db-secret
type: Opaque
data:
  username: dXNlcm5hbWU=  # base64ç¼–ç çš„ "username"
  password: cGFzc3dvcmQ=  # base64ç¼–ç çš„ "password"
```

```go
// åœ¨åº”ç”¨ä¸­è¯»å–Secret
func loadDBConfig() *DBConfig {
    username := os.Getenv("DB_USERNAME")
    password := os.Getenv("DB_PASSWORD")
    
    return &DBConfig{
        Username: username,
        Password: password,
    }
}
```

---

## 4. ğŸ•¸ï¸ æœåŠ¡ç½‘æ ¼æ¶æ„


### 4.1 ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ


**ğŸ”¸ æœåŠ¡ç½‘æ ¼ç®€ä»‹**
æœåŠ¡ç½‘æ ¼å°±åƒåŸå¸‚çš„äº¤é€šç®¡ç†ç³»ç»Ÿï¼Œç®¡ç†æ‰€æœ‰æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œæä¾›è·¯ç”±ã€å®‰å…¨ã€ç›‘æ§ç­‰åŠŸèƒ½ã€‚

```
æ²¡æœ‰æœåŠ¡ç½‘æ ¼ï¼š                    æœ‰äº†æœåŠ¡ç½‘æ ¼ï¼š
æœåŠ¡A â†’ æœåŠ¡B                   æœåŠ¡A â†’ Sidecar â†’ Sidecar â†’ æœåŠ¡B
ç›´æ¥é€šä¿¡                        é€šè¿‡ä»£ç†é€šä¿¡

æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªSidecarä»£ç†ï¼Œè´Ÿè´£ï¼š
- æµé‡è·¯ç”±
- è´Ÿè½½å‡è¡¡  
- å®‰å…¨è®¤è¯
- ç›‘æ§é¥æµ‹
```

### 4.2 Istioæµé‡ç®¡ç†


**ğŸš¦ ä»€ä¹ˆæ˜¯Istioï¼Ÿ**
Istioæ˜¯ç›®å‰æœ€æµè¡Œçš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆï¼Œå°±åƒç»™æœåŠ¡é—´çš„é€šä¿¡åŠ äº†ä¸€å¥—æ™ºèƒ½äº¤é€šç®¡ç†ç³»ç»Ÿã€‚

**ğŸ“ è·¯ç”±æ§åˆ¶**
```yaml
# VirtualService - å®šä¹‰è·¯ç”±è§„åˆ™
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: user-service-route
spec:
  hosts:
  - user-service
  http:
  - match:
    - headers:
        version:
          exact: v2
    route:
    - destination:
        host: user-service
        subset: v2
  - route:
    - destination:
        host: user-service
        subset: v1
```

**âš–ï¸ è´Ÿè½½å‡è¡¡**
```yaml
# DestinationRule - å®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: user-service-destination
spec:
  host: user-service
  trafficPolicy:
    loadBalancer:
      simple: LEAST_CONN  # æœ€å°‘è¿æ¥æ•°è´Ÿè½½å‡è¡¡
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
```

**ğŸ’¥ æ•…éšœæ³¨å…¥æµ‹è¯•**
```yaml
# æ•…éšœæ³¨å…¥ - æµ‹è¯•ç³»ç»ŸéŸ§æ€§
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: fault-injection
spec:
  hosts:
  - payment-service
  http:
  - fault:
      delay:
        percentage:
          value: 10.0      # 10%çš„è¯·æ±‚å»¶è¿Ÿ
        fixedDelay: 5s     # å»¶è¿Ÿ5ç§’
      abort:
        percentage:
          value: 1.0       # 1%çš„è¯·æ±‚è¿”å›é”™è¯¯
        httpStatus: 500    # è¿”å›500é”™è¯¯
    route:
    - destination:
        host: payment-service
```

### 4.3 å®‰å…¨ç­–ç•¥


**ğŸ” ä»€ä¹ˆæ˜¯mTLSï¼Ÿ**
mTLSï¼ˆåŒå‘TLSï¼‰å°±åƒä¸¤ä¸ªäººè§é¢æ—¶äº’ç›¸éªŒè¯èº«ä»½è¯ï¼Œç¡®ä¿é€šä¿¡åŒæ–¹éƒ½æ˜¯å¯ä¿¡çš„ã€‚

```yaml
# PeerAuthentication - å¯ç”¨mTLS
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
spec:
  mtls:
    mode: STRICT  # å¼ºåˆ¶è¦æ±‚mTLS
```

**ğŸ‘¤ è®¤è¯æˆæƒ**
```yaml
# AuthorizationPolicy - è®¿é—®æ§åˆ¶
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: payment-access
spec:
  selector:
    matchLabels:
      app: payment-service
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/default/sa/order-service"]
    to:
    - operation:
        methods: ["POST"]
        paths: ["/payment/*"]
```

### 4.4 é¥æµ‹æ•°æ®


**ğŸ“Š ç›‘æ§æŒ‡æ ‡æ”¶é›†**
Istioä¼šè‡ªåŠ¨æ”¶é›†æœåŠ¡é—´é€šä¿¡çš„å„ç§æŒ‡æ ‡ï¼š

```
è¯·æ±‚æŒ‡æ ‡ï¼š
- è¯·æ±‚æ€»æ•°
- è¯·æ±‚å»¶è¿Ÿåˆ†å¸ƒ
- é”™è¯¯ç‡ç»Ÿè®¡

è¿æ¥æŒ‡æ ‡ï¼š
- TCPè¿æ¥æ•°
- è¿æ¥å»ºç«‹/å…³é—­é€Ÿç‡

èµ„æºæŒ‡æ ‡ï¼š
- CPU/å†…å­˜ä½¿ç”¨ç‡
- ç½‘ç»œå¸¦å®½ä½¿ç”¨
```

---

## 5. ğŸšª APIç½‘å…³é›†æˆ


### 5.1 ä»€ä¹ˆæ˜¯APIç½‘å…³ï¼Ÿ


**ğŸ”¸ APIç½‘å…³çš„ä½œç”¨**
APIç½‘å…³å°±åƒå¤§æ¥¼çš„å‰å°æ¥å¾…ï¼Œæ‰€æœ‰å¤–éƒ¨è®¿é—®éƒ½è¦å…ˆç»è¿‡å®ƒï¼Œå®ƒè´Ÿè´£èº«ä»½éªŒè¯ã€è·¯ç”±åˆ†å‘ã€é™æµç­‰å·¥ä½œã€‚

```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š
ç§»åŠ¨ç«¯/Web â†’ APIç½‘å…³ â†’ å†…éƒ¨RPCæœåŠ¡

APIç½‘å…³çš„èŒè´£ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   APIç½‘å…³       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç»Ÿä¸€è®¤è¯       â”‚
â”‚ â€¢ åè®®è½¬æ¢       â”‚
â”‚ â€¢ é™æµç†”æ–­       â”‚  
â”‚ â€¢ è·¯ç”±åˆ†å‘       â”‚
â”‚ â€¢ ç›‘æ§æ—¥å¿—       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 åè®®è½¬æ¢


**ğŸ”„ HTTPåˆ°gRPCè½¬æ¢**
```yaml
# ä½¿ç”¨grpc-gatewayå®ç°HTTPåˆ°gRPCçš„è½¬æ¢
apiVersion: v1
kind: ConfigMap
metadata:
  name: gateway-config
data:
  nginx.conf: |
    server {
        listen 80;
        location /api/v1/users {
            grpc_pass grpc://user-service:8080;
        }
        location /api/v1/orders {
            grpc_pass grpc://order-service:8080;
        }
    }
```

**ğŸ“ è¯·æ±‚å“åº”è½¬æ¢ç¤ºä¾‹**
```bash
# HTTPè¯·æ±‚
curl -X POST http://gateway.com/api/v1/users \
  -H "Content-Type: application/json" \
  -d '{"name": "å¼ ä¸‰", "email": "zhangsan@example.com"}'

# ç½‘å…³è‡ªåŠ¨è½¬æ¢ä¸ºgRPCè°ƒç”¨
# è°ƒç”¨ user-service çš„ CreateUser æ–¹æ³•
```

### 5.3 ç»Ÿä¸€è®¤è¯


**ğŸ”‘ JWTä»¤ç‰Œè®¤è¯**
```go
// APIç½‘å…³ä¸­çš„è®¤è¯ä¸­é—´ä»¶
func AuthMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // æå–JWTä»¤ç‰Œ
        token := r.Header.Get("Authorization")
        if token == "" {
            http.Error(w, "ç¼ºå°‘è®¤è¯ä»¤ç‰Œ", http.StatusUnauthorized)
            return
        }
        
        // éªŒè¯ä»¤ç‰Œ
        if !isValidToken(token) {
            http.Error(w, "æ— æ•ˆä»¤ç‰Œ", http.StatusUnauthorized)
            return
        }
        
        // æå–ç”¨æˆ·ä¿¡æ¯å¹¶ä¼ é€’ç»™åç«¯æœåŠ¡
        userID := extractUserID(token)
        r.Header.Set("X-User-ID", userID)
        
        next.ServeHTTP(w, r)
    })
}
```

### 5.4 é™æµç†”æ–­


**âš¡ é™æµé…ç½®**
```yaml
# ä½¿ç”¨Istioå®ç°é™æµ
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: rate-limit
spec:
  hosts:
  - api-gateway
  http:
  - match:
    - uri:
        prefix: "/api/v1/"
    route:
    - destination:
        host: backend-service
    fault:
      delay:
        percentage:
          value: 0.1
        fixedDelay: 5s
```

**ğŸ”Œ ç†”æ–­ä¿æŠ¤**
```go
// ä½¿ç”¨hystrix-goå®ç°ç†”æ–­
func CallUserService(userID string) (*User, error) {
    output := make(chan *User, 1)
    errors := hystrix.Go("user_service", func() error {
        user, err := userServiceClient.GetUser(userID)
        if err != nil {
            return err
        }
        output <- user
        return nil
    }, func(err error) error {
        // ç†”æ–­æ—¶çš„é™çº§å¤„ç†
        output <- &User{ID: userID, Name: "é»˜è®¤ç”¨æˆ·"}
        return nil
    })
    
    select {
    case user := <-output:
        return user, nil
    case err := <-errors:
        return nil, err
    }
}
```

---

## 6. âš¡ Serverless RPC


### 6.1 ä»€ä¹ˆæ˜¯Serverlessï¼Ÿ


**ğŸ”¸ Serverlessæ¦‚å¿µ**
Serverlessï¼ˆæ— æœåŠ¡å™¨ï¼‰ä¸æ˜¯çœŸçš„æ²¡æœ‰æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä½ ä¸ç”¨ç®¡æœåŠ¡å™¨ï¼Œå°±åƒæ‰“è½¦ä¸ç”¨ä¹°è½¦ä¸€æ ·ï¼ŒæŒ‰éœ€ä½¿ç”¨ï¼ŒæŒ‰ä½¿ç”¨ä»˜è´¹ã€‚

```
ä¼ ç»ŸæœåŠ¡éƒ¨ç½²ï¼š                  Serverlesséƒ¨ç½²ï¼š
ä¹°æœåŠ¡å™¨ â†’ éƒ¨ç½²åº”ç”¨ â†’ ç»´æŠ¤      å†™å‡½æ•° â†’ ä¸Šä¼  â†’ æŒ‰éœ€æ‰§è¡Œ

æˆæœ¬å¯¹æ¯”ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼š24å°æ—¶è¿è¡Œï¼Œä¸ç®¡æœ‰æ²¡æœ‰è¯·æ±‚
Serverlessï¼šåªåœ¨æœ‰è¯·æ±‚æ—¶è¿è¡Œï¼ŒæŒ‰æ‰§è¡Œæ—¶é—´è®¡è´¹
```

### 6.2 Function as a Service


**âš¡ FaaSçš„ç‰¹ç‚¹**
```
è‡ªåŠ¨æ‰©ç¼©å®¹ï¼š
- æ— è¯·æ±‚æ—¶ç¼©æ”¾åˆ°0ï¼ŒèŠ‚çœæˆæœ¬
- æœ‰è¯·æ±‚æ—¶è‡ªåŠ¨æ‰©å®¹ï¼Œå¤„ç†é«˜å³°

äº‹ä»¶é©±åŠ¨ï¼š
- HTTPè¯·æ±‚è§¦å‘
- æ¶ˆæ¯é˜Ÿåˆ—è§¦å‘  
- å®šæ—¶å™¨è§¦å‘
- æ–‡ä»¶ä¸Šä¼ è§¦å‘
```

**ğŸ“ AWS Lambda RPCå‡½æ•°ç¤ºä¾‹**
```go
// Lambdaå‡½æ•°å¤„ç†gRPCè¯·æ±‚
func HandleRequest(ctx context.Context, request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {
    // è§£ægRPCæ¶ˆæ¯
    var req pb.UserRequest
    if err := proto.Unmarshal([]byte(request.Body), &req); err != nil {
        return events.APIGatewayProxyResponse{
            StatusCode: 400,
            Body: "è¯·æ±‚æ ¼å¼é”™è¯¯",
        }, nil
    }
    
    // å¤„ç†ä¸šåŠ¡é€»è¾‘
    user := processUser(&req)
    
    // è¿”å›å“åº”
    respData, _ := proto.Marshal(user)
    return events.APIGatewayProxyResponse{
        StatusCode: 200,
        Body: string(respData),
        Headers: map[string]string{
            "Content-Type": "application/x-protobuf",
        },
    }, nil
}
```

### 6.3 äº‹ä»¶é©±åŠ¨æ¶æ„


**ğŸ“¨ äº‹ä»¶é©±åŠ¨æ¨¡å¼**
```
ä¼ ç»Ÿè¯·æ±‚-å“åº”æ¨¡å¼ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡A â†’ æœåŠ¡B â†’ å“åº”

äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼š
æœåŠ¡A â†’ å‘å¸ƒäº‹ä»¶ â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ æœåŠ¡Bè®¢é˜…å¤„ç†

ä¼˜åŠ¿ï¼š
âœ… æœåŠ¡è§£è€¦ï¼šæœåŠ¡é—´ä¸ç›´æ¥ä¾èµ–
âœ… å¼‚æ­¥å¤„ç†ï¼šæé«˜å“åº”é€Ÿåº¦  
âœ… å¼¹æ€§ä¼¸ç¼©ï¼šæ ¹æ®äº‹ä»¶é‡è‡ªåŠ¨æ‰©å®¹
```

**ğŸ”” äº‹ä»¶å¤„ç†ç¤ºä¾‹**
```go
// è®¢å•æœåŠ¡å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
func CreateOrder(order *Order) error {
    // åˆ›å»ºè®¢å•
    if err := saveOrder(order); err != nil {
        return err
    }
    
    // å‘å¸ƒäº‹ä»¶
    event := &OrderCreatedEvent{
        OrderID: order.ID,
        UserID:  order.UserID,
        Amount:  order.Amount,
        Timestamp: time.Now(),
    }
    
    return eventBus.Publish("order.created", event)
}

// åº“å­˜æœåŠ¡ç›‘å¬è®¢å•äº‹ä»¶
func HandleOrderCreated(event *OrderCreatedEvent) error {
    // æ‰£å‡åº“å­˜
    return inventoryService.DecrementStock(event.OrderID)
}

// é€šçŸ¥æœåŠ¡ç›‘å¬è®¢å•äº‹ä»¶  
func HandleOrderCreated(event *OrderCreatedEvent) error {
    // å‘é€é€šçŸ¥
    return notificationService.SendOrderConfirmation(event.UserID, event.OrderID)
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‘åŸç”Ÿæœ¬è´¨ï¼šä¸ºäº‘ç¯å¢ƒè®¾è®¡çš„åº”ç”¨æ¶æ„
ğŸ”¸ å®¹å™¨åŒ–éƒ¨ç½²ï¼šæ ‡å‡†åŒ–æ‰“åŒ…ï¼Œéšå¤„è¿è¡Œ
ğŸ”¸ Kubernetesï¼šå®¹å™¨ç¼–æ’å¹³å°ï¼Œè‡ªåŠ¨åŒ–è¿ç»´
ğŸ”¸ æœåŠ¡ç½‘æ ¼ï¼šæœåŠ¡é—´é€šä¿¡çš„åŸºç¡€è®¾æ–½å±‚
ğŸ”¸ APIç½‘å…³ï¼šç»Ÿä¸€å…¥å£ï¼Œåè®®è½¬æ¢å’Œå®‰å…¨è®¤è¯
ğŸ”¸ Serverlessï¼šæŒ‰éœ€æ‰§è¡Œï¼Œäº‹ä»¶é©±åŠ¨æ¶æ„
```

### 7.2 æŠ€æœ¯é€‰æ‹©å»ºè®®


| åœºæ™¯ | **æ¨èæ–¹æ¡ˆ** | **åŸå› ** |
|------|-------------|---------|
| **ä¸­å°å‹åº”ç”¨** | `å®¹å™¨åŒ– + K8s` | `ç®€å•æ˜“ç”¨ï¼Œæˆæœ¬é€‚ä¸­` |
| **å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ** | `æœåŠ¡ç½‘æ ¼ + APIç½‘å…³` | `å¼ºå¤§çš„æ²»ç†èƒ½åŠ›` |
| **é«˜é¢‘çŸ­ä»»åŠ¡** | `Serverless` | `æˆæœ¬ä½ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹` |
| **ä¼ ç»Ÿåº”ç”¨æ”¹é€ ** | `APIç½‘å…³ + å®¹å™¨åŒ–` | `æ¸è¿›å¼æ”¹é€ ï¼Œé£é™©å°` |

### 7.3 å®æ–½æœ€ä½³å®è·µ


**ğŸš€ éƒ¨ç½²ç­–ç•¥**
```
æ¸è¿›å¼æ”¹é€ ï¼š
1. å®¹å™¨åŒ–ç°æœ‰RPCæœåŠ¡
2. å¼•å…¥æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†
3. æ·»åŠ APIç½‘å…³ç»Ÿä¸€å…¥å£
4. æ¥å…¥æœåŠ¡ç½‘æ ¼å¢å¼ºæ²»ç†
5. é€‰æ‹©æ€§ä½¿ç”¨Serverless

ç›‘æ§ä½“ç³»ï¼š
- åŸºç¡€è®¾æ–½ç›‘æ§ï¼šCPUã€å†…å­˜ã€ç½‘ç»œ
- åº”ç”¨ç›‘æ§ï¼šè¯·æ±‚é‡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡  
- ä¸šåŠ¡ç›‘æ§ï¼šç”¨æˆ·é‡ã€äº¤æ˜“é‡ã€è½¬åŒ–ç‡
```

**âš ï¸ å¸¸è§é™·é˜±**
```
è¿‡åº¦å·¥ç¨‹åŒ–ï¼š
âŒ ä¸è¦ä¸€å¼€å§‹å°±ä¸Šå…¨å¥—æŠ€æœ¯æ ˆ
âœ… æ ¹æ®å®é™…éœ€æ±‚é€æ­¥æ¼”è¿›

é…ç½®ç®¡ç†æ··ä¹±ï¼š
âŒ é…ç½®æ•£è½åœ¨å„ä¸ªåœ°æ–¹
âœ… ç»Ÿä¸€ä½¿ç”¨ConfigMapå’ŒSecret

ç›‘æ§ç›²åŒºï¼š
âŒ åªç›‘æ§åŸºç¡€æŒ‡æ ‡
âœ… å»ºç«‹å®Œæ•´çš„å¯è§‚æµ‹æ€§ä½“ç³»
```

### 7.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡ä»·å€¼**
- **é™æœ¬å¢æ•ˆ**ï¼šæŒ‰éœ€ä½¿ç”¨èµ„æºï¼Œé™ä½è¿ç»´æˆæœ¬
- **æå‡ç¨³å®šæ€§**ï¼šè‡ªåŠ¨æ•…éšœæ¢å¤ï¼Œå‡å°‘å®•æœºæ—¶é—´
- **åŠ é€Ÿäº¤ä»˜**ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå¿«é€Ÿä¸Šçº¿æ–°åŠŸèƒ½
- **å¢å¼ºå®‰å…¨**ï¼šç»Ÿä¸€è®¤è¯æˆæƒï¼Œç»†ç²’åº¦è®¿é—®æ§åˆ¶

**ğŸ”§ æŠ€æœ¯ä»·å€¼**
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„éƒ¨ç½²å’Œè¿ç»´æ ‡å‡†
- **å¯è§‚æµ‹æ€§**ï¼šå…¨é“¾è·¯ç›‘æ§å’Œè¿½è¸ª
- **å¼¹æ€§æ¶æ„**ï¼šè‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œåº”å¯¹æµé‡æ³¢åŠ¨
- **å¼€å‘æ•ˆç‡**ï¼šå¼€å‘è€…ä¸“æ³¨ä¸šåŠ¡é€»è¾‘

**æ ¸å¿ƒè®°å¿†**ï¼š
- äº‘åŸç”Ÿè®©RPCæœåŠ¡æ›´æ™ºèƒ½ã€æ›´å¼¹æ€§ã€æ›´æ˜“ç®¡ç†
- å®¹å™¨åŒ–æ˜¯åŸºç¡€ï¼ŒK8sæ˜¯æ ¸å¿ƒï¼ŒæœåŠ¡ç½‘æ ¼æ˜¯å¢å¼º
- APIç½‘å…³ç»Ÿä¸€å…¥å£ï¼ŒServerlessæŒ‰éœ€æ‰§è¡Œ
- æ¸è¿›å¼æ”¹é€ ï¼Œé¿å…ä¸€æ­¥åˆ°ä½çš„æŠ€æœ¯å€ºåŠ¡