---
title: 5ã€RPCä¸æ¶ˆæ¯é˜Ÿåˆ—åä½œ
---
## ğŸ“š ç›®å½•

1. [RPCä¸æ¶ˆæ¯é˜Ÿåˆ—çš„å…³ç³»](#1-RPCä¸æ¶ˆæ¯é˜Ÿåˆ—çš„å…³ç³»)
2. [RPC+æ¶ˆæ¯é˜Ÿåˆ—æ··åˆæ¶æ„](#2-RPC-æ¶ˆæ¯é˜Ÿåˆ—æ··åˆæ¶æ„)
3. [äº‹ä»¶é©±åŠ¨æ¶æ„è¯¦è§£](#3-äº‹ä»¶é©±åŠ¨æ¶æ„è¯¦è§£)
4. [æ¶ˆæ¯é˜Ÿåˆ—åœ¨RPCä¸­çš„åº”ç”¨åœºæ™¯](#4-æ¶ˆæ¯é˜Ÿåˆ—åœ¨RPCä¸­çš„åº”ç”¨åœºæ™¯)
5. [å¯é æ€§ä¿è¯æœºåˆ¶](#5-å¯é æ€§ä¿è¯æœºåˆ¶)
6. [RPCä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é€‰æ‹©æ ‡å‡†](#6-RPCä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é€‰æ‹©æ ‡å‡†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤ RPCä¸æ¶ˆæ¯é˜Ÿåˆ—çš„å…³ç³»


### 1.1 å®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ


**é€šä¿—ç†è§£**ï¼š
- **RPC**ï¼šå°±åƒæ‰“ç”µè¯ ğŸ“ - ä½ æ‰“ç»™æœ‹å‹ï¼Œæœ‹å‹æ¥å¬ï¼Œç«‹å³å›å¤ä½ 
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå°±åƒå‘çŸ­ä¿¡ ğŸ“± - ä½ å‘ç»™æœ‹å‹ï¼Œæœ‹å‹æœ‰ç©ºæ—¶çœ‹åˆ°å›å¤

```
ç°å®ç”Ÿæ´»ä¸­çš„å¯¹æ¯”ï¼š

æ‰“ç”µè¯ï¼ˆRPCï¼‰ï¼š
ä½ ï¼šå–‚ï¼Œç°åœ¨å‡ ç‚¹äº†ï¼Ÿ
æœ‹å‹ï¼šç°åœ¨ä¸‹åˆ3ç‚¹
ä½ ï¼šå¥½çš„ï¼Œè°¢è°¢ï¼
ç‰¹ç‚¹ï¼šå®æ—¶å¯¹è¯ï¼Œç«‹å³å¾—åˆ°ç­”æ¡ˆ

å‘çŸ­ä¿¡ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼š
ä½ ï¼š[çŸ­ä¿¡] ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ
æœ‹å‹ï¼š[1å°æ—¶åå›å¤] ä»Šå¤©æŒºçƒ­çš„
ç‰¹ç‚¹ï¼šå¼‚æ­¥æ²Ÿé€šï¼Œä¸è¦æ±‚ç«‹å³å›å¤
```

### 1.2 ä¸ºä»€ä¹ˆè¦æŠŠå®ƒä»¬ç»“åˆä½¿ç”¨ï¼Ÿ


**å•ç‹¬ä½¿ç”¨çš„é—®é¢˜**ï¼š

```
åªç”¨RPCçš„é—®é¢˜ï¼š
è®¢å•æœåŠ¡ --RPCè°ƒç”¨--> åº“å­˜æœåŠ¡
è®¢å•æœåŠ¡ --RPCè°ƒç”¨--> æ”¯ä»˜æœåŠ¡  
è®¢å•æœåŠ¡ --RPCè°ƒç”¨--> ç‰©æµæœåŠ¡
é—®é¢˜ï¼šå¦‚æœä»»ä½•ä¸€ä¸ªæœåŠ¡æ…¢äº†ï¼Œæ•´ä¸ªè®¢å•æµç¨‹éƒ½å¡ä½

åªç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„é—®é¢˜ï¼š
è®¢å•æœåŠ¡ --æ¶ˆæ¯--> é˜Ÿåˆ— --æ¶ˆæ¯--> åº“å­˜æœåŠ¡
é—®é¢˜ï¼šä¸çŸ¥é“åº“å­˜åˆ°åº•å¤Ÿä¸å¤Ÿï¼Œè®¢å•å¯èƒ½åˆ›å»ºå¤±è´¥
```

**ç»“åˆä½¿ç”¨çš„å¥½å¤„**ï¼š
- ğŸ¯ **å…³é”®æ“ä½œç”¨RPC**ï¼šéœ€è¦ç«‹å³çŸ¥é“ç»“æœ
- ğŸš€ **è¾…åŠ©æ“ä½œç”¨æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå¯ä»¥åç»­å¤„ç†çš„äº‹æƒ…

---

## 2. ğŸ—ï¸ RPC+æ¶ˆæ¯é˜Ÿåˆ—æ··åˆæ¶æ„


### 2.1 æ··åˆæ¶æ„æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ


**æ ¸å¿ƒæ€æƒ³**ï¼šæŠŠä¸šåŠ¡æ“ä½œåˆ†æˆä¸¤ç±»
- **åŒæ­¥æ“ä½œ**ï¼šå¿…é¡»ç«‹å³å®Œæˆå¹¶å¾—åˆ°ç»“æœçš„
- **å¼‚æ­¥æ“ä½œ**ï¼šå¯ä»¥ç¨åå¤„ç†çš„

### 2.2 å…¸å‹çš„ç”µå•†ä¸‹å•åœºæ™¯


```
ç”µå•†è®¢å•å¤„ç†æµç¨‹ï¼š

ç”¨æˆ·ä¸‹å•
    â†“
[åŒæ­¥RPC] æ£€æŸ¥å•†å“åº“å­˜ â† å¿…é¡»ç«‹å³çŸ¥é“æœ‰æ²¡æœ‰è´§
    â†“
[åŒæ­¥RPC] åˆ›å»ºè®¢å•è®°å½• â† å¿…é¡»ç«‹å³æˆåŠŸåˆ›å»º
    â†“
[å¼‚æ­¥æ¶ˆæ¯] å‘é€ç¡®è®¤é‚®ä»¶ â† å¯ä»¥ç¨åå‘é€
[å¼‚æ­¥æ¶ˆæ¯] æ›´æ–°æ¨èç³»ç»Ÿ â† å¯ä»¥ç¨åæ›´æ–°  
[å¼‚æ­¥æ¶ˆæ¯] è®°å½•ç”¨æˆ·è¡Œä¸º â† å¯ä»¥ç¨åè®°å½•
```

### 2.3 å…·ä½“å®ç°ç¤ºä¾‹


**è®¢å•æœåŠ¡çš„å¤„ç†é€»è¾‘**ï¼š
```java
@Service
public class OrderService {
    
    // RPCå®¢æˆ·ç«¯ - åŒæ­¥è°ƒç”¨
    @Autowired
    private InventoryRpcClient inventoryClient;
    
    // æ¶ˆæ¯é˜Ÿåˆ— - å¼‚æ­¥å‘é€
    @Autowired  
    private MessageQueue messageQueue;
    
    public OrderResult createOrder(OrderRequest request) {
        // 1. åŒæ­¥æ£€æŸ¥åº“å­˜ï¼ˆå¿…é¡»ç«‹å³çŸ¥é“ç»“æœï¼‰
        InventoryResult inventory = inventoryClient.checkStock(
            request.getProductId(), 
            request.getQuantity()
        );
        
        if (!inventory.isAvailable()) {
            return OrderResult.fail("åº“å­˜ä¸è¶³");
        }
        
        // 2. åŒæ­¥åˆ›å»ºè®¢å•ï¼ˆå¿…é¡»ç«‹å³å®Œæˆï¼‰
        Order order = createOrderRecord(request);
        
        // 3. å¼‚æ­¥é€šçŸ¥å…¶ä»–æœåŠ¡ï¼ˆå¯ä»¥ç¨åå¤„ç†ï¼‰
        sendAsyncNotifications(order);
        
        return OrderResult.success(order);
    }
    
    private void sendAsyncNotifications(Order order) {
        // å‘é‚®ä»¶é€šçŸ¥
        messageQueue.send("email.queue", 
            new EmailMessage(order.getUserEmail(), "è®¢å•ç¡®è®¤"));
            
        // æ›´æ–°æ¨èç³»ç»Ÿ
        messageQueue.send("recommendation.queue",
            new UserBehaviorMessage(order.getUserId(), "purchase"));
            
        // è®°å½•ç»Ÿè®¡æ•°æ®
        messageQueue.send("analytics.queue",
            new OrderAnalyticsMessage(order));
    }
}
```

### 2.4 æ¶æ„å›¾ç¤º


```
å®¢æˆ·ç«¯è¯·æ±‚æµç¨‹ï¼š

å®¢æˆ·ç«¯
   â†“ HTTPè¯·æ±‚
è®¢å•æœåŠ¡
   â†“ RPCåŒæ­¥è°ƒç”¨ï¼ˆå¿…é¡»ç­‰å¾…ï¼‰
   â”œâ”€â†’ åº“å­˜æœåŠ¡ â† ç«‹å³è¿”å›åº“å­˜çŠ¶æ€
   â”œâ”€â†’ ç”¨æˆ·æœåŠ¡ â† ç«‹å³è¿”å›ç”¨æˆ·ä¿¡æ¯
   â†“
   â”œâ”€â†’ æ¶ˆæ¯é˜Ÿåˆ— â† å¼‚æ­¥å‘é€ï¼ˆä¸ç”¨ç­‰å¾…ï¼‰
       â”œâ”€â†’ é‚®ä»¶æœåŠ¡ï¼ˆç¨åå¤„ç†ï¼‰
       â”œâ”€â†’ æ¨èæœåŠ¡ï¼ˆç¨åå¤„ç†ï¼‰
       â””â”€â†’ åˆ†ææœåŠ¡ï¼ˆç¨åå¤„ç†ï¼‰
   â†“
è¿”å›ç»“æœç»™å®¢æˆ·ç«¯
```

---

## 3. âš¡ äº‹ä»¶é©±åŠ¨æ¶æ„è¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Ÿ


**é€šä¿—ç†è§£**ï¼šå°±åƒå¤šç±³è¯ºéª¨ç‰Œ ğŸ¯
- æ¨å€’ç¬¬ä¸€å—éª¨ç‰Œï¼ˆè§¦å‘äº‹ä»¶ï¼‰
- å…¶ä»–éª¨ç‰Œä¾æ¬¡å€’ä¸‹ï¼ˆå„æœåŠ¡å“åº”äº‹ä»¶ï¼‰
- æ¯å—éª¨ç‰Œä¸çŸ¥é“åé¢è¿˜æœ‰ä»€ä¹ˆï¼ˆæœåŠ¡è§£è€¦ï¼‰

### 3.2 ä¼ ç»Ÿè°ƒç”¨ vs äº‹ä»¶é©±åŠ¨


**ä¼ ç»Ÿæ–¹å¼ï¼ˆç´§è€¦åˆï¼‰**ï¼š
```
è®¢å•æœåŠ¡ç›´æ¥è°ƒç”¨æ‰€æœ‰ç›¸å…³æœåŠ¡ï¼š

è®¢å•æœåŠ¡ {
    createOrder() {
        // ç›´æ¥è°ƒç”¨å„ç§æœåŠ¡
        inventoryService.reduceStock()
        emailService.sendConfirmation()  
        logService.recordOrder()
        recommendationService.updateUserPreference()
        analyticsService.recordSale()
    }
}

é—®é¢˜ï¼š
- è®¢å•æœåŠ¡éœ€è¦çŸ¥é“æ‰€æœ‰ç›¸å…³æœåŠ¡
- ä»»ä½•ä¸€ä¸ªæœåŠ¡æ•…éšœéƒ½å½±å“ä¸‹å•
- æ–°å¢æœåŠ¡éœ€è¦ä¿®æ”¹è®¢å•æœåŠ¡ä»£ç 
```

**äº‹ä»¶é©±åŠ¨æ–¹å¼ï¼ˆæ¾è€¦åˆï¼‰**ï¼š
```
è®¢å•æœåŠ¡åªè´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼š

è®¢å•æœåŠ¡ {
    createOrder() {
        // åªåˆ›å»ºè®¢å•
        Order order = createOrderRecord()
        
        // å‘å¸ƒäº‹ä»¶ï¼Œä¸å…³å¿ƒè°æ¥å¤„ç†
        eventBus.publish("OrderCreated", order)
        
        return order
    }
}

å„æœåŠ¡ç‹¬ç«‹ç›‘å¬æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼š
- åº“å­˜æœåŠ¡ç›‘å¬ "OrderCreated" â†’ å‡åº“å­˜
- é‚®ä»¶æœåŠ¡ç›‘å¬ "OrderCreated" â†’ å‘ç¡®è®¤é‚®ä»¶
- æ¨èæœåŠ¡ç›‘å¬ "OrderCreated" â†’ æ›´æ–°ç”¨æˆ·åå¥½
- åˆ†ææœåŠ¡ç›‘å¬ "OrderCreated" â†’ è®°å½•é”€å”®æ•°æ®
```

### 3.3 äº‹ä»¶é©±åŠ¨çš„å®ç°ç¤ºä¾‹


**äº‹ä»¶å‘å¸ƒè€…ï¼ˆè®¢å•æœåŠ¡ï¼‰**ï¼š
```java
@Service
public class OrderService {
    
    @Autowired
    private EventPublisher eventPublisher;
    
    public Order createOrder(OrderRequest request) {
        // åˆ›å»ºè®¢å•
        Order order = new Order(request);
        orderRepository.save(order);
        
        // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent(
            order.getId(),
            order.getUserId(), 
            order.getProductId(),
            order.getAmount()
        );
        
        eventPublisher.publish("order.created", event);
        
        return order;
    }
}
```

**äº‹ä»¶æ¶ˆè´¹è€…ï¼ˆå„ç§æœåŠ¡ï¼‰**ï¼š
```java
// é‚®ä»¶æœåŠ¡
@EventListener("order.created")
public class EmailService {
    
    public void handleOrderCreated(OrderCreatedEvent event) {
        String userEmail = getUserEmail(event.getUserId());
        sendConfirmationEmail(userEmail, event.getOrderId());
    }
}

// åº“å­˜æœåŠ¡  
@EventListener("order.created")
public class InventoryService {
    
    public void handleOrderCreated(OrderCreatedEvent event) {
        reduceStock(event.getProductId(), event.getQuantity());
    }
}

// æ¨èæœåŠ¡
@EventListener("order.created") 
public class RecommendationService {
    
    public void handleOrderCreated(OrderCreatedEvent event) {
        updateUserPreference(event.getUserId(), event.getProductId());
    }
}
```

---

## 4. ğŸ“‹ æ¶ˆæ¯é˜Ÿåˆ—åœ¨RPCä¸­çš„åº”ç”¨åœºæ™¯


### 4.1 å¼‚æ­¥å¤„ç†ï¼šè€—æ—¶æ“ä½œçš„å¼‚æ­¥åŒ–


**ä»€ä¹ˆæ˜¯å¼‚æ­¥å¤„ç†ï¼Ÿ**
æŠŠè€—æ—¶çš„æ“ä½œæ”¾åˆ°åå°æ…¢æ…¢åšï¼Œç”¨æˆ·ä¸ç”¨ç­‰å¾…ã€‚

**å…¸å‹åœºæ™¯ï¼šç”¨æˆ·ä¸Šä¼ å¤´åƒ**
```
ä¼ ç»ŸåŒæ­¥æ–¹å¼ï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰ï¼š
ç”¨æˆ·ä¸Šä¼ å¤´åƒ 
    â†“ ç­‰å¾…...
å¤„ç†å›¾ç‰‡ï¼ˆå‹ç¼©ã€ç”Ÿæˆç¼©ç•¥å›¾ï¼‰â† è€—æ—¶5ç§’
    â†“ ç»§ç»­ç­‰å¾…...  
ä¿å­˜åˆ°äº‘å­˜å‚¨ â† è€—æ—¶3ç§’
    â†“ è¿˜åœ¨ç­‰å¾…...
æ›´æ–°ç”¨æˆ·ä¿¡æ¯ â† è€—æ—¶1ç§’
    â†“
è¿”å›æˆåŠŸ â† ç”¨æˆ·ç­‰äº†9ç§’ï¼

å¼‚æ­¥æ–¹å¼ï¼ˆç”¨æˆ·ä½“éªŒå¥½ï¼‰ï¼š
ç”¨æˆ·ä¸Šä¼ å¤´åƒ
    â†“
ä¸´æ—¶ä¿å­˜æ–‡ä»¶ â† 0.1ç§’
    â†“
å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ— â† 0.1ç§’  
    â†“
ç«‹å³è¿”å›"ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨å¤„ç†" â† ç”¨æˆ·åªç­‰0.2ç§’ï¼
    
åå°å¼‚æ­¥å¤„ç†ï¼š
æ¶ˆæ¯é˜Ÿåˆ— â†’ å›¾ç‰‡å¤„ç†æœåŠ¡ â†’ æ…¢æ…¢å¤„ç†9ç§’é’Ÿ
å¤„ç†å®Œæˆå â†’ é€šçŸ¥ç”¨æˆ·"å¤´åƒå·²æ›´æ–°"
```

**ä»£ç å®ç°**ï¼š
```java
@Controller
public class UserController {
    
    @PostMapping("/upload-avatar")
    public ResponseEntity<?> uploadAvatar(MultipartFile file) {
        // 1. å¿«é€Ÿä¿å­˜ä¸´æ—¶æ–‡ä»¶
        String tempPath = saveTemporaryFile(file);
        
        // 2. å‘é€å¼‚æ­¥å¤„ç†æ¶ˆæ¯
        AvatarProcessMessage message = new AvatarProcessMessage(
            getCurrentUserId(), 
            tempPath
        );
        messageQueue.send("avatar.process", message);
        
        // 3. ç«‹å³è¿”å›ç»™ç”¨æˆ·
        return ResponseEntity.ok("å¤´åƒä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨å¤„ç†ä¸­...");
    }
}

// åå°å¼‚æ­¥å¤„ç†æœåŠ¡
@MessageListener("avatar.process")
public class AvatarProcessService {
    
    public void processAvatar(AvatarProcessMessage message) {
        // è€—æ—¶æ“ä½œæ”¾åœ¨è¿™é‡Œæ…¢æ…¢åš
        BufferedImage image = loadImage(message.getTempPath());
        BufferedImage compressed = compressImage(image);
        BufferedImage thumbnail = createThumbnail(compressed);
        
        String cloudUrl = uploadToCloud(compressed);
        String thumbnailUrl = uploadToCloud(thumbnail);
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        updateUserAvatar(message.getUserId(), cloudUrl, thumbnailUrl);
        
        // é€šçŸ¥ç”¨æˆ·å¤„ç†å®Œæˆï¼ˆå¯é€‰ï¼‰
        notifyUser(message.getUserId(), "å¤´åƒæ›´æ–°å®Œæˆ");
    }
}
```

### 4.2 å‰Šå³°å¡«è°·ï¼šæµé‡ç¼“å†²å’Œå¹³æ»‘å¤„ç†


**ä»€ä¹ˆæ˜¯å‰Šå³°å¡«è°·ï¼Ÿ**
å°±åƒæ°´åº“ä¸€æ ·ï¼Œæ´ªæ°´æ¥äº†å‚¨å­˜èµ·æ¥ï¼Œæ…¢æ…¢æ”¾æ°´ï¼Œé¿å…ä¸‹æ¸¸è¢«å†²å®ã€‚

**å…¸å‹åœºæ™¯ï¼šç§’æ€æ´»åŠ¨**
```
æ²¡æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç³»ç»Ÿå´©æºƒï¼‰ï¼š
ç§’æ€å¼€å§‹ â†’ 10ä¸‡ç”¨æˆ·åŒæ—¶ä¸‹å• â†’ æ•°æ®åº“ç›´æ¥å´©æºƒ

æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¹³ç¨³å¤„ç†ï¼‰ï¼š
ç§’æ€å¼€å§‹ â†’ 10ä¸‡ä¸ªä¸‹å•è¯·æ±‚è¿›å…¥é˜Ÿåˆ— â†’ ç³»ç»ŸæŒ‰å¤„ç†èƒ½åŠ›æ…¢æ…¢æ¶ˆè´¹
```

**æµé‡å¯¹æ¯”å›¾**ï¼š
```
ç³»ç»Ÿå¤„ç†èƒ½åŠ›åˆ†æï¼š

æ²¡æœ‰å‰Šå³°å¡«è°·ï¼š
è¯·æ±‚é‡  â†‘
       â”‚  /\     â† ç¬é—´10ä¸‡è¯·æ±‚ï¼Œç³»ç»Ÿå´©æºƒ
       â”‚ /  \
       â”‚/    \
       â””â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¶é—´

æœ‰å‰Šå³°å¡«è°·ï¼š
è¯·æ±‚é‡  â†‘
       â”‚â”€â”€â”€â”€     â† é˜Ÿåˆ—ç¼“å­˜è¯·æ±‚ï¼ŒåŒ€é€Ÿå¤„ç†
       â”‚    â”€â”€â”€â”€
       â”‚        â”€â”€â”€â”€
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¶é—´
```

### 4.3 äº‹ä»¶é€šçŸ¥ï¼šçŠ¶æ€å˜æ›´çš„å¹¿æ’­


**ä»€ä¹ˆæ˜¯äº‹ä»¶é€šçŸ¥ï¼Ÿ**
å½“æŸä¸ªé‡è¦äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œå‘Šè¯‰æ‰€æœ‰å…³å¿ƒè¿™ä»¶äº‹çš„æœåŠ¡ã€‚

**å…¸å‹åœºæ™¯ï¼šç”¨æˆ·çŠ¶æ€å˜æ›´**
```
ç”¨æˆ·å‡çº§ä¸ºVIPåéœ€è¦åšçš„äº‹æƒ…ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸€ä¸ªä¸€ä¸ªè°ƒç”¨ï¼‰ï¼š
ç”¨æˆ·æœåŠ¡.å‡çº§VIP() {
    updateUserLevel()           â† æ›´æ–°ç”¨æˆ·ç­‰çº§
    emailService.sendVipEmail() â† å‘é€VIPé‚®ä»¶  
    pointService.giveBonus()    â† èµ é€ç§¯åˆ†
    discountService.enableVip() â† å¼€å¯VIPæŠ˜æ‰£
    reportService.recordVip()   â† è®°å½•VIPç»Ÿè®¡
}

äº‹ä»¶é€šçŸ¥æ–¹å¼ï¼ˆå¹¿æ’­æ¶ˆæ¯ï¼‰ï¼š
ç”¨æˆ·æœåŠ¡.å‡çº§VIP() {
    updateUserLevel()           â† åªæ›´æ–°ç”¨æˆ·ç­‰çº§
    å‘å¸ƒäº‹ä»¶("user.vip.upgraded", userInfo) â† å¹¿æ’­æ¶ˆæ¯
}

å„æœåŠ¡ç‹¬ç«‹å¤„ç†ï¼š
- é‚®ä»¶æœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ å‘VIPé‚®ä»¶
- ç§¯åˆ†æœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ èµ é€ç§¯åˆ†  
- æŠ˜æ‰£æœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ å¼€å¯VIPæŠ˜æ‰£
- æŠ¥è¡¨æœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ è®°å½•ç»Ÿè®¡
```

---

## 5. ğŸ›¡ï¸ å¯é æ€§ä¿è¯æœºåˆ¶


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¯é æ€§ä¿è¯ï¼Ÿ


**ç°å®é—®é¢˜**ï¼š
- ğŸ“± å‘çŸ­ä¿¡æ—¶ç½‘ç»œæ–­äº†ï¼Œæ¶ˆæ¯ä¸¢äº†æ€ä¹ˆåŠï¼Ÿ
- ğŸ’» æœåŠ¡å™¨å¤„ç†æ¶ˆæ¯æ—¶å®•æœºäº†æ€ä¹ˆåŠï¼Ÿ
- ğŸ”„ æ¶ˆæ¯å¤„ç†å¤±è´¥äº†è¦ä¸è¦é‡è¯•ï¼Ÿ

### 5.2 æ¶ˆæ¯ç¡®è®¤æœºåˆ¶


**ä»€ä¹ˆæ˜¯æ¶ˆæ¯ç¡®è®¤ï¼Ÿ**
å°±åƒå¿«é€’ç­¾æ”¶ï¼Œç¡®ä¿æ¶ˆæ¯çœŸçš„è¢«å¤„ç†äº†ã€‚

```
æ¶ˆæ¯ç¡®è®¤æµç¨‹ï¼š

1. å‘é€æ¶ˆæ¯
ç”Ÿäº§è€… â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ "æ¶ˆæ¯å·²æ¥æ”¶" â†’ ç”Ÿäº§è€…

2. æ¶ˆè´¹æ¶ˆæ¯  
æ¶ˆæ¯é˜Ÿåˆ— â†’ æ¶ˆè´¹è€… â†’ "æ¶ˆæ¯å·²å¤„ç†" â†’ æ¶ˆæ¯é˜Ÿåˆ—

3. åˆ é™¤æ¶ˆæ¯
æ¶ˆæ¯é˜Ÿåˆ—æ”¶åˆ°ç¡®è®¤åï¼Œåˆ é™¤æ¶ˆæ¯
```

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// æ¶ˆè´¹è€…æ‰‹åŠ¨ç¡®è®¤
@MessageListener("order.process")
public class OrderProcessor {
    
    public void processOrder(OrderMessage message, MessageChannel channel) {
        try {
            // å¤„ç†è®¢å•é€»è¾‘
            processOrderLogic(message);
            
            // å¤„ç†æˆåŠŸï¼Œå‘é€ç¡®è®¤
            channel.ack(message);
            
        } catch (Exception e) {
            // å¤„ç†å¤±è´¥ï¼Œæ‹’ç»æ¶ˆæ¯ï¼ˆå¯èƒ½é‡æ–°å…¥é˜Ÿï¼‰
            channel.reject(message, true); // trueè¡¨ç¤ºé‡æ–°å…¥é˜Ÿ
        }
    }
}
```

### 5.3 é‡è¯•æœºåˆ¶


**ä»€ä¹ˆæ—¶å€™éœ€è¦é‡è¯•ï¼Ÿ**
- ğŸŒ ç½‘ç»œä¸´æ—¶æ•…éšœ
- ğŸ’¾ æ•°æ®åº“è¿æ¥è¶…æ—¶
- âš¡ æœåŠ¡ä¸´æ—¶ä¸å¯ç”¨

**é‡è¯•ç­–ç•¥**ï¼š
```java
@RetryPolicy(
    maxAttempts = 3,           // æœ€å¤šé‡è¯•3æ¬¡
    backoff = @Backoff(        // é‡è¯•é—´éš”ç­–ç•¥
        delay = 1000,          // åˆå§‹å»¶è¿Ÿ1ç§’
        multiplier = 2         // æ¯æ¬¡ç¿»å€ï¼š1s, 2s, 4s
    )
)
public void processMessage(Message message) {
    // å¤„ç†æ¶ˆæ¯çš„é€»è¾‘
    callExternalService(message);
}
```

**é‡è¯•æ—¶é—´é—´éš”**ï¼š
```
ç¬¬1æ¬¡å¤„ç†å¤±è´¥ â†’ ç­‰å¾…1ç§’ â†’ ç¬¬1æ¬¡é‡è¯•
ç¬¬1æ¬¡é‡è¯•å¤±è´¥ â†’ ç­‰å¾…2ç§’ â†’ ç¬¬2æ¬¡é‡è¯•  
ç¬¬2æ¬¡é‡è¯•å¤±è´¥ â†’ ç­‰å¾…4ç§’ â†’ ç¬¬3æ¬¡é‡è¯•
ç¬¬3æ¬¡é‡è¯•å¤±è´¥ â†’ è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—
```

### 5.4 æ­»ä¿¡é˜Ÿåˆ—


**ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—ï¼Ÿ**
å°±åƒ"é—®é¢˜ä»¶"ç®±å­ï¼Œæ”¾é‚£äº›å¤„ç†ä¸äº†çš„æ¶ˆæ¯ï¼Œç­‰äººå·¥å¤„ç†ã€‚

**æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—çš„æƒ…å†µ**ï¼š
- âœ… é‡è¯•æ¬¡æ•°è¶…è¿‡é™åˆ¶
- âœ… æ¶ˆæ¯è¿‡æœŸäº†
- âœ… é˜Ÿåˆ—æ»¡äº†æ”¾ä¸ä¸‹

```
æ¶ˆæ¯å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼š

æ­£å¸¸æ¶ˆæ¯ â†’ å¤„ç†æˆåŠŸ â†’ åˆ é™¤
    â†“
å¤„ç†å¤±è´¥ â†’ é‡è¯• â†’ æˆåŠŸ â†’ åˆ é™¤
    â†“           â†“
    â†“         å¤±è´¥
    â†“           â†“
    â†“         é‡è¯•
    â†“           â†“
    â†“         å¤±è´¥
    â†“           â†“  
    â†“    é‡è¯•æ¬¡æ•°ç”¨å®Œ
    â†“           â†“
    â””â”€â†’ æ­»ä¿¡é˜Ÿåˆ— â† äººå·¥å¤„ç†
```

---

## 6. ğŸ¯ RPCä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é€‰æ‹©æ ‡å‡†


### 6.1 ä»€ä¹ˆæ—¶å€™ç”¨RPCï¼Ÿ


**é€‰æ‹©RPCçš„åœºæ™¯**ï¼š

| åœºæ™¯ç‰¹å¾ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| **éœ€è¦ç«‹å³å“åº”** | ç”¨æˆ·ç­‰ç€çœ‹ç»“æœ | ç™»å½•éªŒè¯ã€æŸ¥è¯¢ä½™é¢ |
| **å¼ºä¸€è‡´æ€§è¦æ±‚** | æ•°æ®å¿…é¡»å‡†ç¡®æ— è¯¯ | è½¬è´¦æ‰£æ¬¾ã€åº“å­˜æ‰£å‡ |
| **äº‹åŠ¡æ€§æ“ä½œ** | è¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥ | è®¢å•åˆ›å»ºã€æ”¯ä»˜å¤„ç† |
| **è¯·æ±‚-å“åº”æ¨¡å¼** | æœ‰é—®æœ‰ç­”çš„äº¤äº’ | APIæŸ¥è¯¢ã€æ•°æ®è·å– |

**RPCé€‚ç”¨ç¤ºä¾‹**ï¼š
```java
// ç”¨æˆ·ç™»å½• - å¿…é¡»ç«‹å³çŸ¥é“æ˜¯å¦æˆåŠŸ
public LoginResult login(String username, String password) {
    // RPCè°ƒç”¨è®¤è¯æœåŠ¡
    AuthResult auth = authService.authenticate(username, password);
    
    if (auth.isSuccess()) {
        return LoginResult.success(auth.getToken());
    } else {
        return LoginResult.fail("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }
}
```

### 6.2 ä»€ä¹ˆæ—¶å€™ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ


**é€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—çš„åœºæ™¯**ï¼š

| åœºæ™¯ç‰¹å¾ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| **å¯ä»¥å¼‚æ­¥å¤„ç†** | ç”¨æˆ·ä¸ç”¨ç­‰ç»“æœ | å‘é‚®ä»¶ã€æ•°æ®ç»Ÿè®¡ |
| **æœåŠ¡è§£è€¦** | æœåŠ¡é—´ä¸ç›´æ¥ä¾èµ– | äº‹ä»¶é€šçŸ¥ã€çŠ¶æ€å¹¿æ’­ |
| **æµé‡å‰Šå³°** | å¤„ç†çªå‘å¤§é‡è¯·æ±‚ | ç§’æ€ã€æ‰¹é‡å¤„ç† |
| **å¯é æ€§è¦æ±‚** | æ¶ˆæ¯ä¸èƒ½ä¸¢å¤± | è®¢å•é€šçŸ¥ã€æ”¯ä»˜å›è°ƒ |

**æ¶ˆæ¯é˜Ÿåˆ—é€‚ç”¨ç¤ºä¾‹**ï¼š
```java
// ç”¨æˆ·æ³¨å†Œåçš„åç»­å¤„ç† - å¯ä»¥å¼‚æ­¥è¿›è¡Œ
public void handleUserRegistered(UserRegisteredEvent event) {
    // å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œå¼‚æ­¥å¤„ç†
    messageQueue.send("user.welcome", new WelcomeMessage(event.getUserId()));
    messageQueue.send("user.statistics", new UserStatsMessage(event));
    messageQueue.send("user.recommendation", new UserProfileMessage(event));
}
```

### 6.3 åŒæ­¥vså¼‚æ­¥çš„é€‰æ‹©åŸåˆ™


**å†³ç­–æµç¨‹å›¾**ï¼š
```
æ”¶åˆ°ä¸šåŠ¡è¯·æ±‚
    â†“
ç”¨æˆ·æ˜¯å¦éœ€è¦ç«‹å³çœ‹åˆ°ç»“æœï¼Ÿ
    â†“           â†“
   æ˜¯         å¦
    â†“           â†“  
æ“ä½œæ˜¯å¦å½±å“åç»­æµç¨‹ï¼Ÿ    ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—
    â†“           â†“       å¼‚æ­¥å¤„ç†
   æ˜¯         å¦
    â†“           â†“
ä½¿ç”¨RPC      ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—
åŒæ­¥å¤„ç†      å¼‚æ­¥å¤„ç†
```

### 6.4 å®æ—¶æ€§è¦æ±‚å¯¹æ¯”


| å®æ—¶æ€§çº§åˆ« | å“åº”æ—¶é—´è¦æ±‚ | æ¨èæ–¹æ¡ˆ | å…¸å‹åœºæ™¯ |
|-----------|-------------|---------|----------|
| **æé«˜** | < 100ms | RPCåŒæ­¥è°ƒç”¨ | æ”¯ä»˜ç¡®è®¤ã€ç™»å½•éªŒè¯ |
| **é«˜** | < 1s | RPCåŒæ­¥è°ƒç”¨ | æ•°æ®æŸ¥è¯¢ã€çŠ¶æ€æ£€æŸ¥ |
| **ä¸­ç­‰** | < 10s | RPCæˆ–æ¶ˆæ¯é˜Ÿåˆ— | æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®å¯¼å…¥ |
| **ä½** | > 10s | æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥ | é‚®ä»¶å‘é€ã€æŠ¥è¡¨ç”Ÿæˆ |
| **æ— è¦æ±‚** | ä¸é™åˆ¶ | æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥ | æ•°æ®ç»Ÿè®¡ã€æ—¥å¿—åˆ†æ |

### 6.5 æ··åˆä½¿ç”¨çš„æœ€ä½³å®è·µ


**å…¸å‹çš„ç”µå•†è®¢å•åœºæ™¯**ï¼š
```java
@Service
public class OrderService {
    
    public OrderResult createOrder(CreateOrderRequest request) {
        // 1. åŒæ­¥æ£€æŸ¥ï¼ˆRPCï¼‰- ç”¨æˆ·å¿…é¡»ç«‹å³çŸ¥é“èƒ½å¦ä¸‹å•
        StockResult stock = inventoryService.checkStock(request.getProductId());
        if (!stock.isAvailable()) {
            return OrderResult.fail("åº“å­˜ä¸è¶³");
        }
        
        UserResult user = userService.validateUser(request.getUserId());  
        if (!user.isValid()) {
            return OrderResult.fail("ç”¨æˆ·æ— æ•ˆ");
        }
        
        // 2. åŒæ­¥åˆ›å»ºè®¢å•ï¼ˆRPCï¼‰- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        Order order = createOrderRecord(request);
        
        // 3. å¼‚æ­¥åç»­å¤„ç†ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰- è¾…åŠ©åŠŸèƒ½
        publishOrderEvents(order);
        
        return OrderResult.success(order);
    }
    
    private void publishOrderEvents(Order order) {
        // å‘é€ç¡®è®¤é‚®ä»¶
        messageQueue.send("order.email", new OrderEmailEvent(order));
        
        // æ›´æ–°ç”¨æˆ·ç§¯åˆ†
        messageQueue.send("order.points", new OrderPointsEvent(order));
        
        // æ¨èç³»ç»Ÿæ›´æ–°
        messageQueue.send("order.recommendation", new OrderRecommendationEvent(order));
        
        // æ•°æ®åˆ†æ
        messageQueue.send("order.analytics", new OrderAnalyticsEvent(order));
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ··åˆæ¶æ„æœ¬è´¨ï¼šå…³é”®æ“ä½œç”¨RPCï¼ˆåŒæ­¥ï¼‰ï¼Œè¾…åŠ©æ“ä½œç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¼‚æ­¥ï¼‰
ğŸ”¸ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šé€šè¿‡äº‹ä»¶è§£è€¦æœåŠ¡ï¼Œä¸€ä¸ªäº‹ä»¶è§¦å‘å¤šä¸ªå¤„ç†
ğŸ”¸ ä¸‰å¤§åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥å¤„ç†ã€å‰Šå³°å¡«è°·ã€äº‹ä»¶é€šçŸ¥
ğŸ”¸ å¯é æ€§æœºåˆ¶ï¼šæ¶ˆæ¯ç¡®è®¤ã€é‡è¯•ç­–ç•¥ã€æ­»ä¿¡é˜Ÿåˆ—
ğŸ”¸ é€‰æ‹©åŸåˆ™ï¼šå®æ—¶æ€§è¦æ±‚ã€ä¸€è‡´æ€§è¦æ±‚ã€ç”¨æˆ·ä½“éªŒè¦æ±‚
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦æ··åˆä½¿ç”¨ï¼Ÿ**
```
å•ç‹¬ä½¿ç”¨çš„å±€é™æ€§ï¼š
- åªç”¨RPCï¼šç³»ç»Ÿè€¦åˆç´§å¯†ï¼Œæ€§èƒ½ç“¶é¢ˆæ˜æ˜¾
- åªç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ— æ³•å¤„ç†éœ€è¦ç«‹å³å“åº”çš„åœºæ™¯

æ··åˆä½¿ç”¨çš„ä¼˜åŠ¿ï¼š
- å…³é”®è·¯å¾„ç”¨RPCä¿è¯å®æ—¶æ€§
- è¾…åŠ©åŠŸèƒ½ç”¨æ¶ˆæ¯é˜Ÿåˆ—æå‡æ€§èƒ½å’Œè§£è€¦
```

**ğŸ”¹ å¼‚æ­¥å¤„ç†çš„æ ¸å¿ƒä»·å€¼**
```
ç”¨æˆ·ä½“éªŒæå‡ï¼š
- å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚
- é¿å…é•¿æ—¶é—´ç­‰å¾…

ç³»ç»Ÿæ€§èƒ½æå‡ï¼š
- å‰Šå³°å¡«è°·ï¼Œå¹³æ»‘å¤„ç†å‹åŠ›
- æœåŠ¡è§£è€¦ï¼Œç‹¬ç«‹æ‰©å±•
```

**ğŸ”¹ å¯é æ€§ä¿è¯çš„é‡è¦æ€§**
```
æ¶ˆæ¯ä¸èƒ½ä¸¢å¤±ï¼š
- ä¸šåŠ¡é€šçŸ¥å¿…é¡»é€è¾¾
- æ”¯ä»˜å›è°ƒå¿…é¡»å¤„ç†

å¤„ç†å¤±è´¥è¦é‡è¯•ï¼š
- ç½‘ç»œæ•…éšœæ˜¯å¸¸æ€
- æœåŠ¡æš‚æ—¶ä¸å¯ç”¨å¾ˆæ­£å¸¸

æ­»ä¿¡é˜Ÿåˆ—å…œåº•ï¼š
- è‡ªåŠ¨å¤„ç†è§£å†³ä¸äº†çš„é—®é¢˜
- éœ€è¦äººå·¥ä»‹å…¥å¤„ç†
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è®¾è®¡åŸåˆ™**
- **åŒæ­¥å¤„ç†**ï¼šç”¨æˆ·å…³å¿ƒã€å½±å“åç»­æµç¨‹çš„æ“ä½œ
- **å¼‚æ­¥å¤„ç†**ï¼šç”¨æˆ·ä¸å…³å¿ƒã€å¯ä»¥ç¨åå¤„ç†çš„æ“ä½œ
- **å¯é æŠ•é€’**ï¼šé‡è¦çš„ä¸šåŠ¡é€šçŸ¥å’ŒçŠ¶æ€å˜æ›´
- **å¤±è´¥å¤„ç†**ï¼šå®Œå–„çš„é‡è¯•å’Œæ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶

**âš¡ æ€§èƒ½ä¼˜åŒ–**
- **æ‰¹é‡å¤„ç†**ï¼šå°†å¤šä¸ªå°æ¶ˆæ¯åˆå¹¶å¤„ç†
- **å¹¶å‘æ¶ˆè´¹**ï¼šå¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†æ¶ˆæ¯
- **é¢„å–æ§åˆ¶**ï¼šæ§åˆ¶æ¶ˆè´¹è€…é¢„å–æ¶ˆæ¯æ•°é‡
- **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§é˜Ÿåˆ—é•¿åº¦å’Œå¤„ç†å»¶è¿Ÿ

**ğŸ›¡ï¸ è¿ç»´å®è·µ**
- **æ¶ˆæ¯ç›‘æ§**ï¼šç›‘æ§æ¶ˆæ¯ç§¯å‹æƒ…å†µ
- **å¤±è´¥å‘Šè­¦**ï¼šæ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯åŠæ—¶å‘Šè­¦
- **å®¹é‡è§„åˆ’**ï¼šæ ¹æ®ä¸šåŠ¡é‡è§„åˆ’é˜Ÿåˆ—å®¹é‡
- **æ•…éšœæ¢å¤**ï¼šåˆ¶å®šæ•…éšœæƒ…å†µä¸‹çš„æ¢å¤æ–¹æ¡ˆ

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ··åˆæ¶æ„å–é•¿è¡¥çŸ­ï¼ŒRPCå¤„ç†å…³é”®è·¯å¾„ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¤„ç†è¾…åŠ©åŠŸèƒ½
- äº‹ä»¶é©±åŠ¨å®ç°è§£è€¦ï¼Œä¸€ä¸ªäº‹ä»¶è§¦å‘å¤šä¸ªå“åº”
- å¼‚æ­¥å¤„ç†æå‡ä½“éªŒï¼Œå‰Šå³°å¡«è°·ä¿è¯ç¨³å®š
- å¯é æ€§æœºåˆ¶ä¿éšœä¸šåŠ¡ï¼Œç¡®è®¤é‡è¯•åŠ æ­»ä¿¡é˜Ÿåˆ—å…œåº•