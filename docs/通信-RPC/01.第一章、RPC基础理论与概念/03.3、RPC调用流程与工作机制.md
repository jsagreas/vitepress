---
title: 3ã€RPCè°ƒç”¨æµç¨‹ä¸å·¥ä½œæœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [RPCè°ƒç”¨æµç¨‹æ¦‚è¿°](#1-RPCè°ƒç”¨æµç¨‹æ¦‚è¿°)
2. [å®Œæ•´è°ƒç”¨æµç¨‹è¯¦è§£](#2-å®Œæ•´è°ƒç”¨æµç¨‹è¯¦è§£)
3. [Stubå­˜æ ¹æœºåˆ¶æ·±å…¥ç†è§£](#3-Stubå­˜æ ¹æœºåˆ¶æ·±å…¥ç†è§£)
4. [åºåˆ—åŒ–ä¸ååºåˆ—åŒ–è¯¦è§£](#4-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–è¯¦è§£)
5. [RPCä»£ç†æœºåˆ¶ä¸å®ç°](#5-RPCä»£ç†æœºåˆ¶ä¸å®ç°)
6. [åŒæ­¥ä¸å¼‚æ­¥è°ƒç”¨æœºåˆ¶](#6-åŒæ­¥ä¸å¼‚æ­¥è°ƒç”¨æœºåˆ¶)
7. [IOæ¨¡å‹åœ¨RPCä¸­çš„åº”ç”¨](#7-IOæ¨¡å‹åœ¨RPCä¸­çš„åº”ç”¨)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ RPCè°ƒç”¨æµç¨‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯RPCè°ƒç”¨æµç¨‹


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
RPCè°ƒç”¨æµç¨‹ï¼šè¿œç¨‹æ–¹æ³•è°ƒç”¨ä»å‘èµ·åˆ°å®Œæˆçš„å®Œæ•´è¿‡ç¨‹
æœ¬è´¨ç›®æ ‡ï¼šè®©è¿œç¨‹è°ƒç”¨çœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·ç®€å•
æ ¸å¿ƒç†å¿µï¼šéšè—ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§ï¼Œæä¾›é€æ˜çš„è°ƒç”¨ä½“éªŒ
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”ç†è§£**
```
æ‰“ç”µè¯çš„è¿‡ç¨‹ç±»æ¯”ï¼š

æœ¬åœ°é€šè¯ï¼šç›´æ¥é¢å¯¹é¢è¯´è¯
RPCè°ƒç”¨ï¼šé€šè¿‡ç”µè¯ä¸è¿œæ–¹çš„äººå¯¹è¯

ç”µè¯è¿‡ç¨‹ï¼š
1. æ‹¨å·ï¼ˆå¯»æ‰¾æœåŠ¡ï¼‰
2. æ¥é€šï¼ˆå»ºç«‹è¿æ¥ï¼‰  
3. è¯´è¯ï¼ˆå‘é€è¯·æ±‚ï¼‰
4. å¬å›å¤ï¼ˆæ¥æ”¶å“åº”ï¼‰
5. æŒ‚æœºï¼ˆå…³é—­è¿æ¥ï¼‰

RPCä¹Ÿæ˜¯ç±»ä¼¼çš„è¿‡ç¨‹ï¼
```

### 1.2 RPCè°ƒç”¨çš„åŸºæœ¬æ¨¡å‹


**ğŸ“Š ç®€åŒ–è°ƒç”¨æ¨¡å‹**
```
å®¢æˆ·ç«¯åº”ç”¨                                æœåŠ¡ç«¯åº”ç”¨
    |                                         |
   è°ƒç”¨                                     æ‰§è¡Œ
    |                                         |
    â†“                                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç½‘ç»œä¼ è¾“    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å®¢æˆ·ç«¯ä»£ç†â”‚ =============> â”‚æœåŠ¡ç«¯ä»£ç†â”‚
â”‚(Client   â”‚               â”‚(Server   â”‚
â”‚ Stub)    â”‚ <============= â”‚ Stub)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ æ ¸å¿ƒè¦ç´ è¯´æ˜**
- **å®¢æˆ·ç«¯åº”ç”¨**ï¼šå‘èµ·è°ƒç”¨çš„ç¨‹åº
- **æœåŠ¡ç«¯åº”ç”¨**ï¼šæä¾›æœåŠ¡çš„ç¨‹åº
- **Client Stub**ï¼šå®¢æˆ·ç«¯ä»£ç†ï¼Œè´Ÿè´£æ‰“åŒ…è¯·æ±‚
- **Server Stub**ï¼šæœåŠ¡ç«¯ä»£ç†ï¼Œè´Ÿè´£è§£åŒ…è¯·æ±‚
- **ç½‘ç»œä¼ è¾“**ï¼šæ•°æ®åœ¨ç½‘ç»œä¸­çš„ä¼ é€’è¿‡ç¨‹

---

## 2. ğŸ“‹ å®Œæ•´è°ƒç”¨æµç¨‹è¯¦è§£


### 2.1 RPCè°ƒç”¨çš„6ä¸ªæ ¸å¿ƒæ­¥éª¤


**ğŸ”¥ å®Œæ•´æµç¨‹å›¾ç¤º**
```
å®¢æˆ·ç«¯                           ç½‘ç»œ                           æœåŠ¡ç«¯
    |                             |                             |
[1] è°ƒç”¨æœ¬åœ°ä»£ç†æ–¹æ³•              |                             |
    |                             |                             |
[2] åºåˆ—åŒ–è¯·æ±‚æ•°æ®               |                             |
    |                             |                             |
[3] â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”> ç½‘ç»œä¼ è¾“ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”> |
    |                             |                        [4] ååºåˆ—åŒ–è¯·æ±‚
    |                             |                             |
    |                             |                        [5] æ‰§è¡Œä¸šåŠ¡æ–¹æ³•
    |                             |                             |
[6] <â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ç½‘ç»œä¼ è¾“ <â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” åºåˆ—åŒ–å“åº”
æ¥æ”¶å¹¶å¤„ç†å“åº”                   |                             |
```

### 2.2 æ¯ä¸ªæ­¥éª¤çš„è¯¦ç»†è¯´æ˜


**æ­¥éª¤ 1ï¸âƒ£ï¼šå®¢æˆ·ç«¯è°ƒç”¨æœ¬åœ°ä»£ç†æ–¹æ³•**
```java
// å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹
UserService userService = RpcClient.getProxy(UserService.class);
User user = userService.getUserById(12345);  // çœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨ï¼

ğŸ’¡ å…³é”®ç†è§£ï¼š
- å®¢æˆ·ç«¯ä»¥ä¸ºåœ¨è°ƒç”¨æœ¬åœ°æ–¹æ³•
- å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä¸€ä¸ª"å‡"çš„æœ¬åœ°å¯¹è±¡ï¼ˆä»£ç†ï¼‰
- è¿™ä¸ªä»£ç†è´Ÿè´£å¤„ç†æ‰€æœ‰ç½‘ç»œé€šä¿¡çš„è„æ´»ç´¯æ´»
```

**æ­¥éª¤ 2ï¸âƒ£ï¼šåºåˆ—åŒ–è¯·æ±‚æ•°æ®å’Œå‚æ•°**
```java
// å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ï¼ˆå¯¹ç”¨æˆ·é€æ˜ï¼‰
RequestData request = new RequestData();
request.setMethodName("getUserById");
request.setParameters(new Object[]{12345});
request.setParameterTypes(new Class[]{Integer.class});

// æŠŠè¿™äº›ä¿¡æ¯æ‰“åŒ…æˆå­—èŠ‚æµ
byte[] requestBytes = serialize(request);

ğŸ’¡ å…³é”®ç†è§£ï¼š
- æŠŠæ–¹æ³•åã€å‚æ•°ç­‰ä¿¡æ¯æ‰“åŒ…æˆå¯ä¼ è¾“çš„æ ¼å¼
- å°±åƒæŠŠè¦è¯´çš„è¯å†™åœ¨çº¸æ¡ä¸Šå‡†å¤‡é‚®å¯„
- å¸¸ç”¨æ ¼å¼ï¼šJSONã€XMLã€Protobufç­‰
```

**æ­¥éª¤ 3ï¸âƒ£ï¼šç½‘ç»œä¼ è¾“åˆ°æœåŠ¡ç«¯**
```
ä¼ è¾“è¿‡ç¨‹ç¤ºæ„ï¼š
å®¢æˆ·ç«¯ â€”â€”[TCPè¿æ¥]â€”â€”> æœåŠ¡ç«¯
       â€”â€”[HTTPè¯·æ±‚]â€”â€”>
       â€”â€”[è‡ªå®šä¹‰åè®®]â€”â€”>

ğŸ’¡ å…³é”®ç†è§£ï¼š
- é€šè¿‡ç½‘ç»œæŠŠæ‰“åŒ…å¥½çš„æ•°æ®å‘é€å‡ºå»
- å°±åƒæŠŠå†™å¥½çš„çº¸æ¡é€šè¿‡å¿«é€’å¯„å‡ºå»
- å¯èƒ½ä¸¢å¤±ã€å»¶è¿Ÿï¼Œéœ€è¦å¤„ç†å„ç§ç½‘ç»œé—®é¢˜
```

**æ­¥éª¤ 4ï¸âƒ£ï¼šæœåŠ¡ç«¯ååºåˆ—åŒ–è¯·æ±‚**
```java
// æœåŠ¡ç«¯æ¥æ”¶å¹¶è§£åŒ…
byte[] requestBytes = receiveFromNetwork();
RequestData request = deserialize(requestBytes);

String methodName = request.getMethodName();    // "getUserById"
Object[] params = request.getParameters();      // [12345]

ğŸ’¡ å…³é”®ç†è§£ï¼š
- æŠŠæ”¶åˆ°çš„å­—èŠ‚æµè¿˜åŸæˆå¯ç†è§£çš„è¯·æ±‚ä¿¡æ¯
- å°±åƒæ”¶åˆ°çº¸æ¡åæŠŠå†…å®¹è¯»å‡ºæ¥
- è¦çŸ¥é“è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œä¼ å…¥ä»€ä¹ˆå‚æ•°
```

**æ­¥éª¤ 5ï¸âƒ£ï¼šæ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡æ–¹æ³•**
```java
// æœåŠ¡ç«¯å®é™…æ‰§è¡Œä¸šåŠ¡é€»è¾‘
UserService userService = new UserServiceImpl();
User result = userService.getUserById(12345);

ğŸ’¡ å…³é”®ç†è§£ï¼š
- è¿™é‡Œæ˜¯çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
- å°±æ˜¯æ™®é€šçš„æœ¬åœ°æ–¹æ³•è°ƒç”¨
- å¤„ç†å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚
```

**æ­¥éª¤ 6ï¸âƒ£ï¼šåºåˆ—åŒ–å“åº”å¹¶è¿”å›**
```java
// æŠŠæ‰§è¡Œç»“æœæ‰“åŒ…è¿”å›
ResponseData response = new ResponseData();
response.setResult(result);
response.setSuccess(true);

byte[] responseBytes = serialize(response);
sendToNetwork(responseBytes);

ğŸ’¡ å…³é”®ç†è§£ï¼š
- æŠŠæ‰§è¡Œç»“æœæ‰“åŒ…æˆå¯ä¼ è¾“çš„æ ¼å¼
- é€šè¿‡ç½‘ç»œå‘é€å›å®¢æˆ·ç«¯
- å®¢æˆ·ç«¯æ¥æ”¶åè§£åŒ…å¾—åˆ°æœ€ç»ˆç»“æœ
```

### 2.3 å®Œæ•´æ—¶åºå›¾


```
å®¢æˆ·ç«¯åº”ç”¨    Client Stub    ç½‘ç»œå±‚    Server Stub    æœåŠ¡ç«¯åº”ç”¨
    |            |           |           |            |
    |â€”-è°ƒç”¨æ–¹æ³•--->|           |           |            |
    |            |â€”-åºåˆ—åŒ–---->|           |            |
    |            |           |â€”-å‘é€è¯·æ±‚-->|            |
    |            |           |           |â€”-ååºåˆ—åŒ–-->|
    |            |           |           |            |â€”-æ‰§è¡Œæ–¹æ³•
    |            |           |           |            |
    |            |           |           |<â€”-è¿”å›ç»“æœ--|
    |            |           |<â€”-å‘é€å“åº”--|            |
    |            |<â€”-ååºåˆ—åŒ–--|           |            |
    |<â€”-è¿”å›ç»“æœ---|           |           |            |
```

---

## 3. ğŸ”§ Stubå­˜æ ¹æœºåˆ¶æ·±å…¥ç†è§£


### 3.1 ä»€ä¹ˆæ˜¯Stubï¼ˆå­˜æ ¹ï¼‰


**ğŸ”¸ Stubçš„æœ¬è´¨**
```
Stub = æ›¿èº«æ¼”å‘˜çš„æ¦‚å¿µ

ç”µå½±ä¸­çš„æ›¿èº«ï¼š
- è§‚ä¼—ä»¥ä¸ºçœ‹åˆ°çš„æ˜¯æ˜æ˜Ÿæœ¬äºº
- å®é™…ä¸Šæ˜¯æ›¿èº«åœ¨è¡¨æ¼”
- æ›¿èº«å¸®æ˜æ˜Ÿå®Œæˆå±é™©åŠ¨ä½œ

RPCä¸­çš„Stubï¼š
- å®¢æˆ·ç«¯ä»¥ä¸ºè°ƒç”¨çš„æ˜¯è¿œç¨‹æœåŠ¡
- å®é™…ä¸Šè°ƒç”¨çš„æ˜¯æœ¬åœ°Stub
- Stubå¸®å¿™å®Œæˆç½‘ç»œé€šä¿¡çš„å¤æ‚å·¥ä½œ
```

### 3.2 Client Stubï¼ˆå®¢æˆ·ç«¯å­˜æ ¹ï¼‰


**ğŸ”¥ Client Stubçš„èŒè´£**
```
ğŸ“‹ ä¸»è¦å·¥ä½œå†…å®¹ï¼š

1. ğŸ­ ä¼ªè£…æˆçœŸæ­£çš„æœåŠ¡å¯¹è±¡
   - æä¾›ä¸è¿œç¨‹æœåŠ¡ç›¸åŒçš„æ¥å£
   - è®©å®¢æˆ·ç«¯æ„Ÿè§‰åƒè°ƒç”¨æœ¬åœ°å¯¹è±¡

2. ğŸ“¦ å¤„ç†è¯·æ±‚æ•°æ®
   - æ”¶é›†æ–¹æ³•åã€å‚æ•°ã€å‚æ•°ç±»å‹
   - åºåˆ—åŒ–æˆå¯ä¼ è¾“çš„æ ¼å¼

3. ğŸŒ ç®¡ç†ç½‘ç»œé€šä¿¡
   - å»ºç«‹ç½‘ç»œè¿æ¥
   - å‘é€è¯·æ±‚æ•°æ®
   - æ¥æ”¶å“åº”æ•°æ®

4. ğŸ”„ å¤„ç†å“åº”
   - ååºåˆ—åŒ–å“åº”æ•°æ®
   - å¤„ç†å¼‚å¸¸æƒ…å†µ
   - è¿”å›æœ€ç»ˆç»“æœç»™å®¢æˆ·ç«¯
```

**ğŸ’» Client Stub ç¤ºä¾‹ä»£ç **
```java
// è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„Client Stubå®ç°
public class UserServiceClientStub implements UserService {
    private String serverHost;
    private int serverPort;
    
    @Override
    public User getUserById(Integer userId) {
        try {
            // 1. å‡†å¤‡è¯·æ±‚æ•°æ®
            RpcRequest request = new RpcRequest();
            request.setClassName("UserService");
            request.setMethodName("getUserById");
            request.setParameterTypes(new Class[]{Integer.class});
            request.setParameters(new Object[]{userId});
            
            // 2. åºåˆ—åŒ–è¯·æ±‚
            byte[] requestData = JsonUtils.serialize(request);
            
            // 3. ç½‘ç»œä¼ è¾“
            byte[] responseData = networkCall(requestData);
            
            // 4. ååºåˆ—åŒ–å“åº”
            RpcResponse response = JsonUtils.deserialize(responseData, RpcResponse.class);
            
            // 5. è¿”å›ç»“æœ
            return (User) response.getResult();
            
        } catch (Exception e) {
            throw new RpcException("RPCè°ƒç”¨å¤±è´¥", e);
        }
    }
    
    private byte[] networkCall(byte[] requestData) {
        // å®é™…çš„ç½‘ç»œè°ƒç”¨é€»è¾‘
        // ...
    }
}
```

### 3.3 Server Stubï¼ˆæœåŠ¡ç«¯å­˜æ ¹ï¼‰


**ğŸ”¥ Server Stubçš„èŒè´£**
```
ğŸ“‹ ä¸»è¦å·¥ä½œå†…å®¹ï¼š

1. ğŸ‘‚ ç›‘å¬ç½‘ç»œè¯·æ±‚
   - å¯åŠ¨ç½‘ç»œç›‘å¬æœåŠ¡
   - æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚

2. ğŸ“¦ è§£æè¯·æ±‚æ•°æ®
   - ååºåˆ—åŒ–è¯·æ±‚æ•°æ®
   - æå–æ–¹æ³•åå’Œå‚æ•°ä¿¡æ¯

3. ğŸ¯ å®šä½å’Œè°ƒç”¨çœŸå®æœåŠ¡
   - æ ¹æ®ç±»åå’Œæ–¹æ³•åæ‰¾åˆ°å¯¹åº”æœåŠ¡
   - ä½¿ç”¨åå°„è°ƒç”¨çœŸå®çš„ä¸šåŠ¡æ–¹æ³•

4. ğŸ“¤ å¤„ç†å“åº”
   - æ”¶é›†æ‰§è¡Œç»“æœ
   - åºåˆ—åŒ–åå‘é€å›å®¢æˆ·ç«¯
   - å¤„ç†å¼‚å¸¸æƒ…å†µ
```

**ğŸ’» Server Stub ç¤ºä¾‹ä»£ç **
```java
// è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„Server Stubå®ç°
public class RpcServerStub {
    private Map<String, Object> serviceMap = new HashMap<>();
    
    // æ³¨å†ŒæœåŠ¡
    public void registerService(String serviceName, Object serviceImpl) {
        serviceMap.put(serviceName, serviceImpl);
    }
    
    // å¤„ç†RPCè¯·æ±‚
    public byte[] handleRequest(byte[] requestData) {
        try {
            // 1. ååºåˆ—åŒ–è¯·æ±‚
            RpcRequest request = JsonUtils.deserialize(requestData, RpcRequest.class);
            
            // 2. æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å¯¹è±¡
            Object service = serviceMap.get(request.getClassName());
            
            // 3. ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•
            Method method = service.getClass().getMethod(
                request.getMethodName(), 
                request.getParameterTypes()
            );
            Object result = method.invoke(service, request.getParameters());
            
            // 4. å‡†å¤‡å“åº”
            RpcResponse response = new RpcResponse();
            response.setResult(result);
            response.setSuccess(true);
            
            // 5. åºåˆ—åŒ–å¹¶è¿”å›
            return JsonUtils.serialize(response);
            
        } catch (Exception e) {
            // å¼‚å¸¸å¤„ç†
            RpcResponse errorResponse = new RpcResponse();
            errorResponse.setSuccess(false);
            errorResponse.setError(e.getMessage());
            return JsonUtils.serialize(errorResponse);
        }
    }
}
```

### 3.4 Stubçš„é€æ˜æ€§ä½“ç°


**ğŸ¯ é€æ˜æ€§çš„å«ä¹‰**
```
å¯¹å®¢æˆ·ç«¯é€æ˜ï¼š
âœ… ä¸çŸ¥é“æœåŠ¡åœ¨å“ªå°æœºå™¨ä¸Š
âœ… ä¸çŸ¥é“ç”¨ä»€ä¹ˆåè®®é€šä¿¡
âœ… ä¸çŸ¥é“æ•°æ®å¦‚ä½•åºåˆ—åŒ–
âœ… ä¸éœ€è¦å¤„ç†ç½‘ç»œå¼‚å¸¸
âœ… å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•

å¯¹æœåŠ¡ç«¯é€æ˜ï¼š
âœ… ä¸çŸ¥é“è¯·æ±‚æ¥è‡ªå“ªé‡Œ
âœ… ä¸éœ€è¦å¤„ç†ç½‘ç»œé€šä¿¡
âœ… åªéœ€è¦ä¸“æ³¨ä¸šåŠ¡é€»è¾‘
âœ… æ™®é€šçš„æ–¹æ³•è°ƒç”¨å¤„ç†
```

---

## 4. ğŸ“¦ åºåˆ—åŒ–ä¸ååºåˆ—åŒ–è¯¦è§£


### 4.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–


**ğŸ”¸ åºåˆ—åŒ–çš„ç”Ÿæ´»ç±»æ¯”**
```
å¯„å¿«é€’çš„è¿‡ç¨‹ï¼š

1. ç‰©å“æ‰“åŒ…ï¼š
   - æŠŠæ˜“ç¢ç‰©å“ç”¨æ³¡æ²«åŒ…è£…
   - æ”¾è¿›çº¸ç®±ï¼Œè´´ä¸Šæ ‡ç­¾
   - è¿™å°±æ˜¯"åºåˆ—åŒ–"

2. ç‰©å“æ‹†åŒ…ï¼š
   - æ”¶åˆ°å¿«é€’åæ‹†å¼€åŒ…è£…
   - å–å‡ºé‡Œé¢çš„ç‰©å“
   - è¿™å°±æ˜¯"ååºåˆ—åŒ–"

RPCä¸­çš„åºåˆ—åŒ–ï¼š
   - æŠŠå†…å­˜ä¸­çš„å¯¹è±¡"æ‰“åŒ…"æˆå­—èŠ‚æµ
   - é€šè¿‡ç½‘ç»œä¼ è¾“è¿™äº›å­—èŠ‚
   - åœ¨å¦ä¸€ç«¯"æ‹†åŒ…"è¿˜åŸæˆå¯¹è±¡
```

### 4.2 åºåˆ—åŒ–è¿‡ç¨‹è¯¦è§£


**ğŸ“‹ åºåˆ—åŒ–è¦è§£å†³çš„é—®é¢˜**
```
å†…å­˜ä¸­çš„å¯¹è±¡ â†’ ç½‘ç»œä¼ è¾“çš„å­—èŠ‚

æŒ‘æˆ˜ï¼š
1. ğŸ§  å†…å­˜å¯¹è±¡æœ‰å¤æ‚ç»“æ„ï¼ˆåµŒå¥—ã€å¼•ç”¨ï¼‰
2. ğŸŒ ç½‘ç»œåªèƒ½ä¼ è¾“å­—èŠ‚æµ
3. ğŸ”„ ä¸åŒè¯­è¨€ã€å¹³å°è¦èƒ½äº’ç›¸ç†è§£
4. âš¡ è¦è€ƒè™‘æ€§èƒ½å’Œç©ºé—´æ•ˆç‡
```

**ğŸ’» åºåˆ—åŒ–ç¤ºä¾‹**
```java
// è¦åºåˆ—åŒ–çš„å¯¹è±¡
public class User {
    private Integer id;
    private String name;
    private Date birthDate;
    // getters and setters...
}

User user = new User(123, "å¼ ä¸‰", new Date());

// JSONåºåˆ—åŒ–
String json = JsonUtils.toJson(user);
// ç»“æœï¼š{"id":123,"name":"å¼ ä¸‰","birthDate":"2024-01-01T00:00:00Z"}

// äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼ˆå¦‚Protobufï¼‰
byte[] bytes = ProtobufUtils.serialize(user);
// ç»“æœï¼š[0x08, 0x7B, 0x12, 0x06, 0xE5, 0xBC, 0xA0, 0xE4, 0xB8, 0x89, ...]
```

### 4.3 å¸¸è§åºåˆ—åŒ–æ ¼å¼å¯¹æ¯”


| ğŸ†š æ ¼å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ“„ **JSON** | `äººç±»å¯è¯»ï¼Œè·¨è¯­è¨€æ”¯æŒå¥½` | `ä½“ç§¯å¤§ï¼Œè§£ææ…¢` | `Web APIï¼Œè°ƒè¯•å‹å¥½` |
| ğŸ”¢ **XML** | `ç»“æ„åŒ–ï¼Œæ ‡å‡†åŒ–` | `ä½“ç§¯æœ€å¤§ï¼Œè§£ææœ€æ…¢` | `ä¼ä¸šçº§ç³»ç»Ÿï¼Œé…ç½®æ–‡ä»¶` |
| âš¡ **Protobuf** | `ä½“ç§¯å°ï¼Œé€Ÿåº¦å¿«` | `éœ€è¦å®šä¹‰schemaï¼Œä¸å¯è¯»` | `é«˜æ€§èƒ½RPCï¼Œå¾®æœåŠ¡` |
| ğŸš€ **Avro** | `åŠ¨æ€schemaï¼Œå‹ç¼©ç‡é«˜` | `å¤æ‚åº¦é«˜` | `å¤§æ•°æ®å¤„ç†ï¼ŒKafka` |
| ğŸ¯ **MessagePack** | `æ¯”JSONå°ï¼Œæ¯”Protobufç®€å•` | `ç”Ÿæ€ç›¸å¯¹è¾ƒå°` | `æ¸¸æˆå¼€å‘ï¼Œå®æ—¶é€šä¿¡` |

### 4.4 åºåˆ—åŒ–çš„æ€§èƒ½è€ƒé‡


**ğŸ“Š æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹**
```
æ•°æ®å¤§å°å¯¹æ¯”ï¼ˆç›¸åŒå¯¹è±¡ï¼‰:
JSON:        1000 å­—èŠ‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
XML:         1500 å­—èŠ‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 150%
Protobuf:     400 å­—èŠ‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 40%
MessagePack:  600 å­—èŠ‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 60%

åºåˆ—åŒ–é€Ÿåº¦å¯¹æ¯”:
JSON:        100ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
XML:         150ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 150%  
Protobuf:     50ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 50%
MessagePack:  80ms   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80%
```

---

## 5. ğŸ­ RPCä»£ç†æœºåˆ¶ä¸å®ç°


### 5.1 ä»€ä¹ˆæ˜¯RPCä»£ç†


**ğŸ”¸ ä»£ç†æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³**
```
ä»£ç† = ä¸­ä»‹çš„æ¦‚å¿µ

ç”Ÿæ´»ä¸­çš„ä»£ç†ï¼š
ğŸ  æˆ¿äº§ä¸­ä»‹ï¼š
   - ä¹°å®¶ä»¥ä¸ºåœ¨å’Œæˆ¿ä¸»è°ˆ
   - å®é™…ä¸Šåœ¨å’Œä¸­ä»‹è°ˆ
   - ä¸­ä»‹ä»£æ›¿æˆ¿ä¸»å¤„ç†äº¤æ˜“

ğŸ¬ ç»çºªäººï¼š
   - å¯¼æ¼”ä»¥ä¸ºåœ¨å’Œæ˜æ˜Ÿè°ˆ
   - å®é™…ä¸Šåœ¨å’Œç»çºªäººè°ˆ
   - ç»çºªäººä»£æ›¿æ˜æ˜Ÿè°ˆåˆåŒ

RPCä»£ç†ï¼š
   - å®¢æˆ·ç«¯ä»¥ä¸ºåœ¨è°ƒç”¨è¿œç¨‹æœåŠ¡
   - å®é™…ä¸Šåœ¨è°ƒç”¨æœ¬åœ°ä»£ç†
   - ä»£ç†è´Ÿè´£å¤„ç†è¿œç¨‹é€šä¿¡
```

### 5.2 é™æ€ä»£ç† vs åŠ¨æ€ä»£ç†


**ğŸ”§ é™æ€ä»£ç†å®ç°**
```java
// æœåŠ¡æ¥å£
public interface UserService {
    User getUserById(Integer id);
    void saveUser(User user);
}

// æ‰‹åŠ¨ç¼–å†™çš„ä»£ç†ç±»
public class UserServiceProxy implements UserService {
    private RpcClient rpcClient;
    
    @Override
    public User getUserById(Integer id) {
        // æ‰‹åŠ¨ç¼–å†™çš„RPCè°ƒç”¨é€»è¾‘
        RpcRequest request = new RpcRequest();
        request.setInterfaceName("UserService");
        request.setMethodName("getUserById");
        request.setParameters(new Object[]{id});
        
        return (User) rpcClient.call(request);
    }
    
    @Override
    public void saveUser(User user) {
        // æ‰‹åŠ¨ç¼–å†™çš„RPCè°ƒç”¨é€»è¾‘
        RpcRequest request = new RpcRequest();
        request.setInterfaceName("UserService");
        request.setMethodName("saveUser");
        request.setParameters(new Object[]{user});
        
        rpcClient.call(request);
    }
}

âš ï¸ é™æ€ä»£ç†çš„é—®é¢˜ï¼š
âŒ æ¯ä¸ªæ¥å£éƒ½è¦æ‰‹å†™ä»£ç†ç±»
âŒ ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾
âŒ æ¥å£å˜åŒ–æ—¶ä»£ç†ç±»ä¹Ÿè¦ä¿®æ”¹
```

**âš¡ åŠ¨æ€ä»£ç†å®ç°ï¼ˆæ¨èï¼‰**
```java
public class RpcProxyFactory {
    private RpcClient rpcClient;
    
    @SuppressWarnings("unchecked")
    public <T> T getProxy(Class<T> interfaceClass) {
        return (T) Proxy.newProxyInstance(
            interfaceClass.getClassLoader(),
            new Class[]{interfaceClass},
            new RpcInvocationHandler(interfaceClass.getName(), rpcClient)
        );
    }
}

public class RpcInvocationHandler implements InvocationHandler {
    private String interfaceName;
    private RpcClient rpcClient;
    
    public RpcInvocationHandler(String interfaceName, RpcClient rpcClient) {
        this.interfaceName = interfaceName;
        this.rpcClient = rpcClient;
    }
    
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        // æ„å»ºRPCè¯·æ±‚
        RpcRequest request = new RpcRequest();
        request.setInterfaceName(interfaceName);
        request.setMethodName(method.getName());
        request.setParameterTypes(method.getParameterTypes());
        request.setParameters(args);
        
        // æ‰§è¡ŒRPCè°ƒç”¨
        return rpcClient.call(request);
    }
}

âœ… åŠ¨æ€ä»£ç†çš„ä¼˜åŠ¿ï¼š
âœ… ä¸€å¥—ä»£ç å¤„ç†æ‰€æœ‰æ¥å£
âœ… è‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡
âœ… æ¥å£å˜åŒ–æ— éœ€ä¿®æ”¹ä»£ç†ä»£ç 
```

### 5.3 ä»£ç†çš„ä½¿ç”¨æ–¹å¼


**ğŸ’» å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹**
```java
public class RpcClientExample {
    public static void main(String[] args) {
        // 1. åˆ›å»ºRPCå®¢æˆ·ç«¯
        RpcClient rpcClient = new RpcClient("127.0.0.1", 8080);
        
        // 2. åˆ›å»ºä»£ç†å·¥å‚
        RpcProxyFactory proxyFactory = new RpcProxyFactory(rpcClient);
        
        // 3. è·å–æœåŠ¡ä»£ç†ï¼ˆçœ‹èµ·æ¥åƒæœ¬åœ°å¯¹è±¡ï¼ï¼‰
        UserService userService = proxyFactory.getProxy(UserService.class);
        OrderService orderService = proxyFactory.getProxy(OrderService.class);
        
        // 4. åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ä½¿ç”¨ï¼ˆå®é™…ä¸Šæ˜¯è¿œç¨‹è°ƒç”¨ï¼ï¼‰
        User user = userService.getUserById(123);
        System.out.println("ç”¨æˆ·ä¿¡æ¯ï¼š" + user.getName());
        
        Order order = orderService.getOrderById(456);
        System.out.println("è®¢å•é‡‘é¢ï¼š" + order.getAmount());
    }
}

ğŸ’¡ ä½¿ç”¨ä½“éªŒï¼š
âœ… å®Œå…¨é€æ˜çš„è¿œç¨‹è°ƒç”¨
âœ… æ— éœ€å…³å¿ƒç½‘ç»œé€šä¿¡ç»†èŠ‚
âœ… å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•
âœ… å¼‚å¸¸å¤„ç†ä¹Ÿæ˜¯é€æ˜çš„
```

---

## 6. âš¡ åŒæ­¥ä¸å¼‚æ­¥è°ƒç”¨æœºåˆ¶


### 6.1 åŒæ­¥è°ƒç”¨ vs å¼‚æ­¥è°ƒç”¨


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µå¯¹æ¯”**
```
åŒæ­¥è°ƒç”¨ï¼ˆSynchronousï¼‰:
æ‰“ç”µè¯çš„æ–¹å¼ï¼š
ğŸ“ æ‹¨é€šç”µè¯ â†’ ç­‰å¾…å¯¹æ–¹æ¥å¬ â†’ è¯´è¯ â†’ ç­‰å¾…å›å¤ â†’ æŒ‚æœº
ğŸ’­ ç‰¹ç‚¹ï¼šå¿…é¡»ç­‰å¾…å¯¹æ–¹å›å¤åæ‰èƒ½åšä¸‹ä¸€ä»¶äº‹

å¼‚æ­¥è°ƒç”¨ï¼ˆAsynchronousï¼‰:
å‘çŸ­ä¿¡çš„æ–¹å¼ï¼š
ğŸ“± å‘é€çŸ­ä¿¡ â†’ ç»§ç»­åšå…¶ä»–äº‹ â†’ ç¨åæ”¶åˆ°å›å¤ â†’ å¤„ç†å›å¤
ğŸ’­ ç‰¹ç‚¹ï¼šå‘é€åå¯ä»¥ç«‹å³åšå…¶ä»–äº‹æƒ…
```

### 6.2 åŒæ­¥è°ƒç”¨è¯¦è§£


**ğŸ“‹ åŒæ­¥è°ƒç”¨çš„æ‰§è¡Œæµç¨‹**
```
å®¢æˆ·ç«¯çº¿ç¨‹æ‰§è¡Œæ—¶åºï¼š

æ—¶é—´è½´ï¼šâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”>
       |        |              |        |
       å‘èµ·è°ƒç”¨  ç­‰å¾…å“åº”        æ”¶åˆ°å“åº”  ç»§ç»­æ‰§è¡Œ
       
       |<â€”â€”â€”â€”â€”â€”â€” é˜»å¡ç­‰å¾… â€”â€”â€”â€”â€”â€”â€”â€”>|
       
â±ï¸  è€—æ—¶åˆ†æï¼š
æ€»è€—æ—¶ = ç½‘ç»œå»¶è¿Ÿ + æœåŠ¡å¤„ç†æ—¶é—´ + ç½‘ç»œå»¶è¿Ÿ
```

**ğŸ’» åŒæ­¥è°ƒç”¨ä»£ç ç¤ºä¾‹**
```java
public class SyncRpcExample {
    public static void main(String[] args) {
        UserService userService = RpcClient.getProxy(UserService.class);
        
        System.out.println("å¼€å§‹è°ƒç”¨");
        long startTime = System.currentTimeMillis();
        
        // åŒæ­¥è°ƒç”¨ï¼šçº¿ç¨‹ä¼šåœ¨è¿™é‡Œç­‰å¾…
        User user = userService.getUserById(123);  // é˜»å¡ç­‰å¾…
        
        long endTime = System.currentTimeMillis();
        System.out.println("è°ƒç”¨å®Œæˆï¼Œè€—æ—¶ï¼š" + (endTime - startTime) + "ms");
        System.out.println("ç”¨æˆ·ä¿¡æ¯ï¼š" + user.getName());
        
        // åªæœ‰ä¸Šé¢çš„è°ƒç”¨å®Œæˆåï¼Œè¿™è¡Œä»£ç æ‰ä¼šæ‰§è¡Œ
        System.out.println("ç»§ç»­æ‰§è¡Œå…¶ä»–é€»è¾‘");
    }
}

ğŸ• æ‰§è¡Œç»“æœï¼š
å¼€å§‹è°ƒç”¨
è°ƒç”¨å®Œæˆï¼Œè€—æ—¶ï¼š150ms
ç”¨æˆ·ä¿¡æ¯ï¼šå¼ ä¸‰
ç»§ç»­æ‰§è¡Œå…¶ä»–é€»è¾‘
```

### 6.3 å¼‚æ­¥è°ƒç”¨è¯¦è§£


**ğŸ“‹ å¼‚æ­¥è°ƒç”¨çš„æ‰§è¡Œæµç¨‹**
```
å®¢æˆ·ç«¯çº¿ç¨‹æ‰§è¡Œæ—¶åºï¼š

æ—¶é—´è½´ï¼šâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”>
       |    |                    |        |
       å‘èµ·è°ƒç”¨ ç«‹å³è¿”å›           å›è°ƒæ‰§è¡Œ  ç»§ç»­
       
       |<>|                     
       å‡ ä¹ä¸é˜»å¡                 
       
â±ï¸  ä½“éªŒåˆ†æï¼š
è°ƒç”¨è€—æ—¶ â‰ˆ 0ms ï¼ˆç«‹å³è¿”å›ï¼‰
å®é™…å“åº”é€šè¿‡å›è°ƒå¤„ç†
```

**ğŸ’» å¼‚æ­¥è°ƒç”¨ä»£ç ç¤ºä¾‹**
```java
public class AsyncRpcExample {
    public static void main(String[] args) {
        AsyncUserService userService = RpcClient.getAsyncProxy(AsyncUserService.class);
        
        System.out.println("å¼€å§‹å¼‚æ­¥è°ƒç”¨");
        long startTime = System.currentTimeMillis();
        
        // å¼‚æ­¥è°ƒç”¨ï¼šç«‹å³è¿”å›Futureå¯¹è±¡
        CompletableFuture<User> future = userService.getUserByIdAsync(123);
        
        long callTime = System.currentTimeMillis();
        System.out.println("è°ƒç”¨å‘èµ·å®Œæˆï¼Œè€—æ—¶ï¼š" + (callTime - startTime) + "ms");
        
        // å¯ä»¥å…ˆåšå…¶ä»–äº‹æƒ…
        System.out.println("åšå…¶ä»–äº‹æƒ…...");
        doOtherWork();
        
        // éœ€è¦ç»“æœæ—¶å†è·å–
        future.thenAccept(user -> {
            long endTime = System.currentTimeMillis();
            System.out.println("æ”¶åˆ°å“åº”ï¼Œæ€»è€—æ—¶ï¼š" + (endTime - startTime) + "ms");
            System.out.println("ç”¨æˆ·ä¿¡æ¯ï¼š" + user.getName());
        });
        
        // ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ
        System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ");
    }
    
    private static void doOtherWork() {
        System.out.println("æ‰§è¡Œå…¶ä»–ä¸šåŠ¡é€»è¾‘...");
        try {
            Thread.sleep(50); // æ¨¡æ‹Ÿå…¶ä»–å·¥ä½œ
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}

ğŸ• æ‰§è¡Œç»“æœï¼š
å¼€å§‹å¼‚æ­¥è°ƒç”¨
è°ƒç”¨å‘èµ·å®Œæˆï¼Œè€—æ—¶ï¼š2ms
åšå…¶ä»–äº‹æƒ…...
æ‰§è¡Œå…¶ä»–ä¸šåŠ¡é€»è¾‘...
ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ
æ”¶åˆ°å“åº”ï¼Œæ€»è€—æ—¶ï¼š148ms
ç”¨æˆ·ä¿¡æ¯ï¼šå¼ ä¸‰
```

### 6.4 åŒæ­¥ vs å¼‚æ­¥æ€§èƒ½å¯¹æ¯”


**ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ**
```
åœºæ™¯1ï¼šå•ä¸ªRPCè°ƒç”¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åŒæ­¥è°ƒç”¨ï¼š
çº¿ç¨‹1: [â€”â€”â€”â€”â€”â€”â€” ç­‰å¾…RPCå“åº”(150ms) â€”â€”â€”â€”â€”â€”â€”]
æ€»è€—æ—¶: 150msï¼Œçº¿ç¨‹åˆ©ç”¨ç‡: 30%

å¼‚æ­¥è°ƒç”¨ï¼š
çº¿ç¨‹1: [å‘èµ·RPC] [åšå…¶ä»–äº‹æƒ…(100ms)] [å¤„ç†å“åº”]
æ€»è€—æ—¶: 150msï¼Œçº¿ç¨‹åˆ©ç”¨ç‡: 85%

åœºæ™¯2ï¼šå¤šä¸ªRPCè°ƒç”¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

åŒæ­¥è°ƒç”¨ï¼ˆä¸²è¡Œï¼‰ï¼š
è°ƒç”¨1: [â€”â€”â€” 150ms â€”â€”â€”]
è°ƒç”¨2:                [â€”â€”â€” 150ms â€”â€”â€”]  
è°ƒç”¨3:                               [â€”â€”â€” 150ms â€”â€”â€”]
æ€»è€—æ—¶: 450ms

å¼‚æ­¥è°ƒç”¨ï¼ˆå¹¶å‘ï¼‰ï¼š
è°ƒç”¨1: [â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 150ms â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”]
è°ƒç”¨2: [â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 150ms â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”]
è°ƒç”¨3: [â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 150ms â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”]
æ€»è€—æ—¶: 150ms ï¼ˆæå‡3å€æ€§èƒ½ï¼ï¼‰
```

### 6.5 é€‰æ‹©åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ


**ğŸ¯ é€‰æ‹©æŒ‡å¯¼åŸåˆ™**

| åœºæ™¯ | **æ¨èæ–¹å¼** | **ç†ç”±** |
|------|-------------|---------|
| ğŸ”„ **éœ€è¦ç«‹å³ä½¿ç”¨ç»“æœ** | `åŒæ­¥è°ƒç”¨` | `é€»è¾‘ç®€å•ï¼Œä»£ç ç›´è§‚` |
| âš¡ **é«˜å¹¶å‘åœºæ™¯** | `å¼‚æ­¥è°ƒç”¨` | `æé«˜çº¿ç¨‹åˆ©ç”¨ç‡` |
| ğŸ“ **å¤šä¸ªç‹¬ç«‹RPCè°ƒç”¨** | `å¼‚æ­¥è°ƒç”¨` | `å¯ä»¥å¹¶å‘æ‰§è¡Œ` |
| ğŸ¯ **ç®€å•ä¸šåŠ¡é€»è¾‘** | `åŒæ­¥è°ƒç”¨` | `å¼€å‘ç»´æŠ¤æˆæœ¬ä½` |
| ğŸš€ **æ€§èƒ½è¦æ±‚æé«˜** | `å¼‚æ­¥è°ƒç”¨` | `æœ€å¤§åŒ–ç³»ç»Ÿååé‡` |

---

## 7. ğŸ”„ IOæ¨¡å‹åœ¨RPCä¸­çš„åº”ç”¨


### 7.1 é˜»å¡IO vs éé˜»å¡IO


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µç†è§£**
```
é˜»å¡IOï¼ˆBlocking IOï¼‰:
ç­‰å…¬äº¤è½¦çš„ä¾‹å­ï¼š
ğŸšŒ ç«™åœ¨å…¬äº¤ç«™ç­‰è½¦
ğŸ“± ä»€ä¹ˆéƒ½ä¸èƒ½åšï¼Œåªèƒ½ç­‰
â° è½¦æ¥äº†æ‰èƒ½ä¸Šè½¦ç»§ç»­è¡Œç¨‹

éé˜»å¡IOï¼ˆNon-blocking IOï¼‰:
ç­‰å¤–å–çš„ä¾‹å­ï¼š
ğŸ• ç‚¹äº†å¤–å–åç»§ç»­å·¥ä½œ
ğŸ“± å¶å°”çœ‹çœ‹å¤–å–åˆ°äº†æ²¡
â° å¤–å–åˆ°äº†å†å»å–
```

### 7.2 é˜»å¡IOåœ¨RPCä¸­çš„åº”ç”¨


**ğŸ“‹ é˜»å¡IOçš„å·¥ä½œæ–¹å¼**
```java
// é˜»å¡IOçš„RPCå®ç°ç¤ºä¾‹
public class BlockingRpcClient {
    private Socket socket;
    
    public Object call(RpcRequest request) throws IOException {
        // 1. å»ºç«‹è¿æ¥ï¼ˆå¯èƒ½é˜»å¡ï¼‰
        socket = new Socket("127.0.0.1", 8080);
        
        // 2. å‘é€è¯·æ±‚ï¼ˆå¯èƒ½é˜»å¡ï¼‰
        OutputStream out = socket.getOutputStream();
        byte[] requestData = serialize(request);
        out.write(requestData);
        out.flush();
        
        // 3. ç­‰å¾…å“åº”ï¼ˆé˜»å¡ç­‰å¾…ï¼‰
        InputStream in = socket.getInputStream();
        byte[] responseData = new byte[1024];
        int length = in.read(responseData);  // çº¿ç¨‹åœ¨è¿™é‡Œé˜»å¡ï¼
        
        // 4. å¤„ç†å“åº”
        RpcResponse response = deserialize(responseData, length);
        socket.close();
        
        return response.getResult();
    }
}

â±ï¸ çº¿ç¨‹çŠ¶æ€å˜åŒ–ï¼š
è¿è¡Œ â†’ é˜»å¡(ç­‰å¾…ç½‘ç»œ) â†’ è¿è¡Œ â†’ è¿”å›ç»“æœ
```

**ğŸ¯ é˜»å¡IOçš„ç‰¹ç‚¹**
```
âœ… ä¼˜ç‚¹ï¼š
  - ç¼–ç¨‹æ¨¡å‹ç®€å•ç›´è§‚
  - é€»è¾‘æ¸…æ™°æ˜“ç†è§£
  - å¼‚å¸¸å¤„ç†ç®€å•

âŒ ç¼ºç‚¹ï¼š
  - çº¿ç¨‹èµ„æºæµªè´¹ä¸¥é‡
  - å¹¶å‘æ€§èƒ½è¾ƒå·®
  - ä¸€ä¸ªè¯·æ±‚å ç”¨ä¸€ä¸ªçº¿ç¨‹
```

### 7.3 éé˜»å¡IOåœ¨RPCä¸­çš„åº”ç”¨


**ğŸ“‹ éé˜»å¡IOçš„å·¥ä½œæ–¹å¼**
```java
// éé˜»å¡IOçš„RPCå®ç°ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
public class NonBlockingRpcClient {
    private Selector selector;
    private SocketChannel channel;
    
    public void callAsync(RpcRequest request, RpcCallback callback) throws IOException {
        // 1. åˆ›å»ºéé˜»å¡è¿æ¥
        channel = SocketChannel.open();
        channel.configureBlocking(false);  // è®¾ç½®éé˜»å¡
        
        // 2. æ³¨å†Œåˆ°é€‰æ‹©å™¨
        channel.register(selector, SelectionKey.OP_CONNECT);
        
        // 3. å‘èµ·è¿æ¥ï¼ˆç«‹å³è¿”å›ï¼Œä¸é˜»å¡ï¼‰
        channel.connect(new InetSocketAddress("127.0.0.1", 8080));
        
        // 4. åœ¨äº‹ä»¶å¾ªç¯ä¸­å¤„ç†IOäº‹ä»¶
        while (true) {
            selector.select();  // ç­‰å¾…IOäº‹ä»¶
            
            Set<SelectionKey> keys = selector.selectedKeys();
            for (SelectionKey key : keys) {
                if (key.isConnectable()) {
                    handleConnect(key, request);
                } else if (key.isWritable()) {
                    handleWrite(key, request);
                } else if (key.isReadable()) {
                    handleRead(key, callback);
                }
            }
            keys.clear();
        }
    }
    
    private void handleRead(SelectionKey key, RpcCallback callback) {
        // è¯»å–å“åº”æ•°æ®ï¼Œå¤„ç†å®Œæˆåè°ƒç”¨å›è°ƒ
        // ...
        callback.onResponse(response);
    }
}

â±ï¸ çº¿ç¨‹çŠ¶æ€å˜åŒ–ï¼š
è¿è¡Œ â†’ ç»§ç»­è¿è¡Œ(æ£€æŸ¥IOçŠ¶æ€) â†’ å¤„ç†ç»“æœ â†’ ç»§ç»­è¿è¡Œ
```

### 7.4 IOæ¨¡å‹æ€§èƒ½å¯¹æ¯”


**ğŸ“Š å¹¶å‘æ€§èƒ½å¯¹æ¯”**
```
1000ä¸ªå¹¶å‘RPCè°ƒç”¨æ€§èƒ½æµ‹è¯•ï¼š

é˜»å¡IOæ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚çº¿ç¨‹1: [â€”â€”ç­‰å¾…â€”â€”] â”‚ 1ä¸ªè¯·æ±‚ = 1ä¸ªçº¿ç¨‹
â”‚çº¿ç¨‹2: [â€”â€”ç­‰å¾…â€”â€”] â”‚ 1000ä¸ªè¯·æ±‚ = 1000ä¸ªçº¿ç¨‹
â”‚çº¿ç¨‹3: [â€”â€”ç­‰å¾…â€”â€”] â”‚ å†…å­˜æ¶ˆè€—: 1000 Ã— 1MB = 1GB
â”‚  ...            â”‚ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å·¨å¤§
â”‚çº¿ç¨‹1000:[ç­‰å¾…]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éé˜»å¡IOæ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹ä»¶å¾ªç¯çº¿ç¨‹    â”‚ 1000ä¸ªè¯·æ±‚ = 1ä¸ªçº¿ç¨‹  
â”‚ [å¤„ç†äº‹ä»¶1]     â”‚ å†…å­˜æ¶ˆè€—: 1 Ã— 1MB = 1MB
â”‚ [å¤„ç†äº‹ä»¶2]     â”‚ æ— ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€
â”‚ [å¤„ç†äº‹ä»¶3]     â”‚ CPUåˆ©ç”¨ç‡æ›´é«˜
â”‚ ...             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½æå‡ï¼šå†…å­˜ä½¿ç”¨å‡å°‘1000å€ï¼Œæ€§èƒ½æå‡10-100å€
```

### 7.5 å®é™…RPCæ¡†æ¶çš„IOç­–ç•¥


**ğŸ”§ ä¸»æµRPCæ¡†æ¶çš„é€‰æ‹©**

| æ¡†æ¶ | **IOæ¨¡å‹** | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|-----------|---------|-------------|
| ğŸŒ¿ **ä¼ ç»ŸRMI** | `é˜»å¡IO` | `ç®€å•ï¼ŒåŒæ­¥è°ƒç”¨` | `å†…éƒ¨ç³»ç»Ÿï¼Œä½å¹¶å‘` |
| âš¡ **gRPC** | `éé˜»å¡IO` | `HTTP/2ï¼Œé«˜æ€§èƒ½` | `å¾®æœåŠ¡ï¼Œé«˜å¹¶å‘` |
| ğŸš€ **Dubbo** | `éé˜»å¡IO` | `Nettyæ¡†æ¶ï¼Œå¯é…ç½®` | `ä¼ä¸šçº§åº”ç”¨` |
| ğŸ”¥ **Thrift** | `å¤šç§æ¨¡å‹` | `æ”¯æŒå¤šç§IOæ¨¡å‹` | `è·¨è¯­è¨€æœåŠ¡` |

**ğŸ’¡ é€‰æ‹©å»ºè®®**
```
ä½å¹¶å‘åœºæ™¯ï¼ˆ< 100 QPSï¼‰ï¼š
âœ… é˜»å¡IOå°±å¤Ÿç”¨
âœ… å¼€å‘ç®€å•ï¼Œç»´æŠ¤æˆæœ¬ä½

é«˜å¹¶å‘åœºæ™¯ï¼ˆ> 1000 QPSï¼‰ï¼š
ğŸš€ å¿…é¡»ç”¨éé˜»å¡IO
ğŸš€ é…åˆå¼‚æ­¥è°ƒç”¨æ•ˆæœæ›´ä½³
ğŸš€ å¤æ‚åº¦é«˜ä½†æ€§èƒ½æ˜¾è‘—æå‡
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ RPCè°ƒç”¨æµç¨‹ï¼š6ä¸ªæ ¸å¿ƒæ­¥éª¤çš„å®Œæ•´é“¾è·¯ç†è§£
ğŸ”¸ Stubå­˜æ ¹æœºåˆ¶ï¼šClient/Server Stubçš„ä½œç”¨å’Œå®ç°åŸç†
ğŸ”¸ åºåˆ—åŒ–åŸç†ï¼šæ•°æ®æ‰“åŒ…ä¼ è¾“çš„æ ¸å¿ƒæŠ€æœ¯
ğŸ”¸ ä»£ç†æœºåˆ¶ï¼šé€æ˜è¿œç¨‹è°ƒç”¨çš„å®ç°åŸºç¡€
ğŸ”¸ åŒæ­¥å¼‚æ­¥ï¼šä¸åŒè°ƒç”¨æ–¹å¼çš„æ€§èƒ½å½±å“
ğŸ”¸ IOæ¨¡å‹ï¼šé˜»å¡ä¸éé˜»å¡å¯¹å¹¶å‘æ€§èƒ½çš„å†³å®šæ€§å½±å“
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é€æ˜æ€§æ˜¯RPCçš„æ ¸å¿ƒä»·å€¼**
```
è®©è¿œç¨‹è°ƒç”¨åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·ç®€å•ï¼š
âœ… å®¢æˆ·ç«¯æ— éœ€å…³å¿ƒç½‘ç»œç»†èŠ‚
âœ… æœåŠ¡ç«¯æ— éœ€å¤„ç†é€šä¿¡é€»è¾‘  
âœ… å¼€å‘è€…ä¸“æ³¨ä¸šåŠ¡é€»è¾‘
âœ… ç³»ç»Ÿå…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å…³é”®è·¯å¾„**
```
æ€§èƒ½æå‡ç­–ç•¥ï¼š
1. é€‰æ‹©é«˜æ•ˆçš„åºåˆ—åŒ–æ ¼å¼ï¼ˆProtobuf > JSONï¼‰
2. ä½¿ç”¨å¼‚æ­¥è°ƒç”¨ï¼ˆå¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼‰
3. é‡‡ç”¨éé˜»å¡IOï¼ˆæé«˜çº¿ç¨‹åˆ©ç”¨ç‡ï¼‰
4. åˆç†çš„è¿æ¥æ± ç®¡ç†ï¼ˆå‡å°‘è¿æ¥å¼€é”€ï¼‰
```

**ğŸ”¹ å„ç»„ä»¶çš„ååŒå·¥ä½œ**
```
RPC = Stub + åºåˆ—åŒ– + ç½‘ç»œä¼ è¾“ + ä»£ç†
æ¯ä¸ªç»„ä»¶éƒ½ä¸å¯æˆ–ç¼ºï¼š
- Stubæä¾›é€æ˜æ€§
- åºåˆ—åŒ–è§£å†³æ•°æ®ä¼ è¾“
- ç½‘ç»œä¼ è¾“è¿æ¥ä¸¤ç«¯
- ä»£ç†ç®€åŒ–å®¢æˆ·ç«¯ä½¿ç”¨
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æŠ€æœ¯é€‰å‹å»ºè®®**
```
é¡¹ç›®åˆæœŸï¼ˆåŠŸèƒ½ä¼˜å…ˆï¼‰ï¼š
âœ… é€‰æ‹©ç®€å•çš„åŒæ­¥è°ƒç”¨
âœ… ä½¿ç”¨JSONåºåˆ—åŒ–ï¼ˆæ˜“è°ƒè¯•ï¼‰
âœ… é˜»å¡IOæ¨¡å‹ï¼ˆå¼€å‘å¿«é€Ÿï¼‰

é¡¹ç›®å‘å±•æœŸï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼š
ğŸš€ å¼•å…¥å¼‚æ­¥è°ƒç”¨æœºåˆ¶
ğŸš€ é‡‡ç”¨äºŒè¿›åˆ¶åºåˆ—åŒ–æ ¼å¼
ğŸš€ å‡çº§åˆ°éé˜»å¡IOæ¨¡å‹

é¡¹ç›®æˆç†ŸæœŸï¼ˆæè‡´æ€§èƒ½ï¼‰ï¼š
ğŸ’ å…¨å¼‚æ­¥è°ƒç”¨é“¾è·¯
ğŸ’ å®šåˆ¶åŒ–åºåˆ—åŒ–åè®®
ğŸ’ è¿æ¥å¤ç”¨å’Œæ± åŒ–ç®¡ç†
```

**ğŸ”§ å®è·µè¦ç‚¹**
```
å¼€å‘é˜¶æ®µï¼š
- å…ˆå®ç°åŠŸèƒ½ï¼Œå†ä¼˜åŒ–æ€§èƒ½
- ä¿æŒæ¥å£è®¾è®¡çš„ç®€æ´æ€§
- åšå¥½å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•

æµ‹è¯•é˜¶æ®µï¼š
- é‡ç‚¹æµ‹è¯•ç½‘ç»œå¼‚å¸¸æƒ…å†µ
- éªŒè¯åºåˆ—åŒ–çš„å…¼å®¹æ€§
- å‹æµ‹å¹¶å‘æ€§èƒ½è¡¨ç°

è¿ç»´é˜¶æ®µï¼š
- ç›‘æ§RPCè°ƒç”¨çš„æˆåŠŸç‡å’Œå»¶è¿Ÿ
- å…³æ³¨åºåˆ—åŒ–çš„æ€§èƒ½æŒ‡æ ‡
- åŠæ—¶å‘ç°å’Œå¤„ç†è¶…æ—¶é—®é¢˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- *å…­æ­¥æµç¨‹è¦è®°æ¸…ï¼Œè°ƒç”¨åºåˆ—åŒ–ä¼ è¾“è¡Œ*
- *Stubå­˜æ ¹æ˜¯å…³é”®ï¼Œé€æ˜ä»£ç†å¾ˆæ–¹ä¾¿*  
- *åŒæ­¥å¼‚æ­¥çœ‹åœºæ™¯ï¼Œé˜»å¡éé˜»å¡è®ºæ€§èƒ½*
- *åºåˆ—åŒ–é€‰æ‹©å¾ˆé‡è¦ï¼ŒJSONç®€å•Protobufå¿«*