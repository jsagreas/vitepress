---
title: 2ã€æ€§èƒ½æŒ‡æ ‡ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [ç›‘æ§çš„æœ¬è´¨ä¸ä»·å€¼](#1-ç›‘æ§çš„æœ¬è´¨ä¸ä»·å€¼)
2. [å››å¤§é»„é‡‘æŒ‡æ ‡è¯¦è§£](#2-å››å¤§é»„é‡‘æŒ‡æ ‡è¯¦è§£)
3. [RPCæ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡](#3-RPCæ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡)
4. [ç›‘æ§æŒ‡æ ‡é‡‡é›†æ–¹å¼](#4-ç›‘æ§æŒ‡æ ‡é‡‡é›†æ–¹å¼)
5. [ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡](#5-ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡)
6. [æ€§èƒ½åŸºçº¿ä¸æŠ¥è­¦ç­–ç•¥](#6-æ€§èƒ½åŸºçº¿ä¸æŠ¥è­¦ç­–ç•¥)
7. [ç›‘æ§ç³»ç»Ÿæ­å»ºå®è·µ](#7-ç›‘æ§ç³»ç»Ÿæ­å»ºå®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç›‘æ§çš„æœ¬è´¨ä¸ä»·å€¼


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§RPC


**ğŸ¤” æƒ³è±¡ä¸€ä¸ªåœºæ™¯**ï¼š
```
ä½ å¼€äº†ä¸€å®¶å¿«é¤åº—ï¼Œé¡¾å®¢é€šè¿‡ç”µè¯è®¢é¤
- ç”µè¯å¿™ä¸å¿™ï¼Ÿï¼ˆç³»ç»Ÿè´Ÿè½½ï¼‰
- é¡¾å®¢ç­‰å¤šä¹…ï¼Ÿï¼ˆå“åº”æ—¶é—´ï¼‰
- æœ‰æ²¡æœ‰ä¸‹é”™å•ï¼Ÿï¼ˆé”™è¯¯ç‡ï¼‰
- ç”µè¯çº¿å¤Ÿä¸å¤Ÿç”¨ï¼Ÿï¼ˆèµ„æºé¥±å’Œåº¦ï¼‰

RPCç›‘æ§å°±åƒé¤å…çš„"è¿è¥ä»ªè¡¨ç›˜"
å®æ—¶äº†è§£ç³»ç»Ÿå¥åº·çŠ¶å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜
```

**ğŸ¯ ç›‘æ§çš„æ ¸å¿ƒä»·å€¼**ï¼š
- **ğŸ” é—®é¢˜å‘ç°**ï¼šç¬¬ä¸€æ—¶é—´çŸ¥é“å“ªé‡Œå‡ºäº†é—®é¢˜
- **ğŸ“Š æ€§èƒ½åˆ†æ**ï¼šäº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶å†µå’Œç“¶é¢ˆ
- **ğŸš¨ æå‰é¢„è­¦**ï¼šåœ¨é—®é¢˜å½±å“ç”¨æˆ·å‰å‘å‡ºè­¦æŠ¥
- **ğŸ“ˆ å®¹é‡è§„åˆ’**ï¼šæ ¹æ®è¶‹åŠ¿é¢„æµ‹èµ„æºéœ€æ±‚
- **ğŸ”§ ä¼˜åŒ–æŒ‡å¯¼**ï¼šä¸ºæ€§èƒ½è°ƒä¼˜æä¾›æ•°æ®æ”¯æ’‘

### 1.2 ç›‘æ§çš„åŸºæœ¬æ€è·¯


**ğŸ“‹ ç›‘æ§ä¸‰è¦ç´ **ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®é‡‡é›†   â”‚â”€â”€â”€â–¶â”‚   æ•°æ®å­˜å‚¨   â”‚â”€â”€â”€â–¶â”‚   æ•°æ®å±•ç¤º   â”‚
â”‚  (Collect)  â”‚    â”‚   (Store)   â”‚    â”‚ (Visualize) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚
     â–¼                    â–¼                    â–¼
  åŸ‹ç‚¹ä¸ŠæŠ¥              æ—¶åºæ•°æ®åº“           ç›‘æ§å¤§å±
  æ—¥å¿—æ”¶é›†              å…³ç³»æ•°æ®åº“           æŠ¥è­¦é€šçŸ¥
```

**ğŸ”„ ç›‘æ§é—­ç¯**ï¼š
```
ç›‘æ§å‘ç°é—®é¢˜ â†’ åˆ†æé—®é¢˜åŸå›  â†’ è§£å†³é—®é¢˜ â†’ ä¼˜åŒ–ç›‘æ§
      â–²                                        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€å®Œå–„ç›‘æ§ç­–ç•¥â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“Š å››å¤§é»„é‡‘æŒ‡æ ‡è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯å››å¤§é»„é‡‘æŒ‡æ ‡


> **ğŸ’¡ æ ¸å¿ƒç†å¿µ**ï¼šæ— è®ºå¤šå¤æ‚çš„ç³»ç»Ÿï¼Œè¿™å››ä¸ªæŒ‡æ ‡éƒ½èƒ½åæ˜ å‡ºæ ¸å¿ƒå¥åº·çŠ¶å†µ

**ğŸŒŸ å››å¤§é»„é‡‘æŒ‡æ ‡**ï¼š
- **â±ï¸ å»¶è¿Ÿï¼ˆLatencyï¼‰**ï¼šæœåŠ¡å“åº”æ—¶é—´
- **ğŸš€ æµé‡ï¼ˆTrafficï¼‰**ï¼šæœåŠ¡å¤„ç†è¯·æ±‚é‡
- **âŒ é”™è¯¯ï¼ˆErrorsï¼‰**ï¼šæœåŠ¡å¤±è´¥æƒ…å†µ
- **ğŸ”‹ é¥±å’Œåº¦ï¼ˆSaturationï¼‰**ï¼šç³»ç»Ÿèµ„æºä½¿ç”¨ç¨‹åº¦

### 2.2 å»¶è¿Ÿï¼ˆLatencyï¼‰- ç”¨æˆ·ä½“éªŒçš„ç›´æ¥æŒ‡æ ‡


**ğŸ”¸ ä»€ä¹ˆæ˜¯å»¶è¿Ÿ**ï¼š
```
å»¶è¿Ÿ = ç”¨æˆ·å‘å‡ºè¯·æ±‚åˆ°æ”¶åˆ°å“åº”çš„æ—¶é—´

å°±åƒä½ é—®æœ‹å‹ä¸€ä¸ªé—®é¢˜ï¼Œä»è¯´å‡ºå£åˆ°æœ‹å‹å›ç­”ä½ çš„æ—¶é—´é—´éš”
```

**ğŸ“ˆ å»¶è¿Ÿçš„åˆ†å±‚ç†è§£**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿï¼ˆç«¯åˆ°ç«¯ï¼‰                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ç½‘ç»œå»¶è¿Ÿ                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  RPCæœåŠ¡å¤„ç†å»¶è¿Ÿ              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ         â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ å»¶è¿Ÿç›‘æ§æŒ‡æ ‡**ï¼š
- **å¹³å‡å»¶è¿Ÿ**ï¼šæ•´ä½“æ€§èƒ½æ°´å¹³
- **P95å»¶è¿Ÿ**ï¼š95%çš„è¯·æ±‚åœ¨å¤šå°‘æ—¶é—´å†…å®Œæˆ
- **P99å»¶è¿Ÿ**ï¼š99%çš„è¯·æ±‚åœ¨å¤šå°‘æ—¶é—´å†…å®Œæˆ
- **æœ€å¤§å»¶è¿Ÿ**ï¼šæœ€åæƒ…å†µçš„æ€§èƒ½

```
ä¸ºä»€ä¹ˆå…³æ³¨P95ã€P99ï¼Ÿ
å¹³å‡å€¼ä¼šè¢«æç«¯å€¼"æ‹–ç´¯"ï¼Œæ— æ³•åæ˜ å¤§å¤šæ•°ç”¨æˆ·çš„çœŸå®ä½“éªŒ
P95 = 100ms æ„å‘³ç€95%çš„ç”¨æˆ·ä½“éªŒéƒ½å¾ˆå¥½
```

### 2.3 æµé‡ï¼ˆTrafficï¼‰- ç³»ç»Ÿç¹å¿™ç¨‹åº¦


**ğŸ”¸ ä»€ä¹ˆæ˜¯æµé‡**ï¼š
```
æµé‡ = ç³»ç»Ÿå¤„ç†çš„è¯·æ±‚æ•°é‡

å°±åƒé«˜é€Ÿå…¬è·¯çš„è½¦æµé‡ï¼Œåæ˜ ç³»ç»Ÿæœ‰å¤šç¹å¿™
```

**ğŸ“Š æµé‡çš„è¡¡é‡ç»´åº¦**ï¼š
- **QPSï¼ˆQueries Per Secondï¼‰**ï¼šæ¯ç§’æŸ¥è¯¢æ•°
- **TPSï¼ˆTransactions Per Secondï¼‰**ï¼šæ¯ç§’äº‹åŠ¡æ•°
- **RPSï¼ˆRequests Per Secondï¼‰**ï¼šæ¯ç§’è¯·æ±‚æ•°

```java
// ç®€å•çš„QPSè®¡ç®—ç¤ºä¾‹
public class QPSCalculator {
    private AtomicLong requestCount = new AtomicLong(0);
    
    // æ¯æ¬¡è¯·æ±‚è°ƒç”¨
    public void recordRequest() {
        requestCount.incrementAndGet();
    }
    
    // æ¯ç§’ç»Ÿè®¡ä¸€æ¬¡QPS
    public double calculateQPS() {
        long count = requestCount.getAndSet(0);
        return count; // 1ç§’å†…çš„è¯·æ±‚æ•°å°±æ˜¯QPS
    }
}
```

### 2.4 é”™è¯¯ï¼ˆErrorsï¼‰- ç³»ç»Ÿç¨³å®šæ€§æŒ‡æ ‡


**ğŸ”¸ ä»€ä¹ˆæ˜¯é”™è¯¯**ï¼š
```
é”™è¯¯ = ç³»ç»Ÿæ— æ³•æ­£å¸¸å¤„ç†çš„è¯·æ±‚

å°±åƒé¤å…ä¸Šé”™èœçš„æ¯”ä¾‹ï¼Œåæ˜ æœåŠ¡è´¨é‡
```

**âŒ é”™è¯¯çš„åˆ†ç±»**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯é”™è¯¯     â”‚  4xxé”™è¯¯
â”‚   (Client Error) â”‚  ç”¨æˆ·è¾“å…¥é”™è¯¯ã€æƒé™é—®é¢˜ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡ç«¯é”™è¯¯     â”‚  5xxé”™è¯¯  
â”‚   (Server Error) â”‚  ç³»ç»Ÿæ•…éšœã€è¶…æ—¶ã€èµ„æºä¸è¶³ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š é”™è¯¯ç‡è®¡ç®—**ï¼š
```
é”™è¯¯ç‡ = é”™è¯¯è¯·æ±‚æ•° / æ€»è¯·æ±‚æ•° Ã— 100%

ä¾‹å¦‚ï¼š1000ä¸ªè¯·æ±‚ä¸­æœ‰5ä¸ªå¤±è´¥
é”™è¯¯ç‡ = 5/1000 Ã— 100% = 0.5%
```

### 2.5 é¥±å’Œåº¦ï¼ˆSaturationï¼‰- ç³»ç»Ÿè´Ÿè½½æ°´å¹³


**ğŸ”¸ ä»€ä¹ˆæ˜¯é¥±å’Œåº¦**ï¼š
```
é¥±å’Œåº¦ = ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨ç¨‹åº¦

å°±åƒåœè½¦åœºçš„åœè½¦ä½ä½¿ç”¨ç‡ï¼Œåæ˜ ç³»ç»Ÿè¿˜èƒ½æ‰¿å—å¤šå°‘è´Ÿè½½
```

**ğŸ”‹ èµ„æºé¥±å’Œåº¦ç›‘æ§**ï¼š
- **CPUä½¿ç”¨ç‡**ï¼šè®¡ç®—èµ„æºé¥±å’Œåº¦
- **å†…å­˜ä½¿ç”¨ç‡**ï¼šå­˜å‚¨èµ„æºé¥±å’Œåº¦  
- **ç½‘ç»œå¸¦å®½**ï¼šç½‘ç»œèµ„æºé¥±å’Œåº¦
- **è¿æ¥æ•°**ï¼šè¿æ¥æ± é¥±å’Œåº¦

```
é¥±å’Œåº¦çš„å±é™©ä¿¡å·ï¼š
CPU > 80%     ğŸŸ¡ éœ€è¦å…³æ³¨
CPU > 90%     ğŸ”´ é«˜é£é™©
CPU > 95%     ğŸš¨ æåº¦å±é™©
```

---

## 3. ğŸ“ˆ RPCæ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡


### 3.1 QPS - ç³»ç»Ÿååé‡æ ¸å¿ƒæŒ‡æ ‡


**ğŸ”¸ QPSçš„æ·±åº¦ç†è§£**ï¼š
```
QPSï¼ˆQueries Per Secondï¼‰= æ¯ç§’æŸ¥è¯¢æ•°

é€šä¿—ç†è§£ï¼šç³»ç»Ÿæ¯ç§’èƒ½å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚
å°±åƒæ”¶é“¶å‘˜æ¯åˆ†é’Ÿèƒ½ç»“ç®—å¤šå°‘ä¸ªé¡¾å®¢
```

**ğŸ“Š QPSçš„ä¸šåŠ¡æ„ä¹‰**ï¼š
```
ä½QPSåœºæ™¯ï¼š
- ç®¡ç†åå°ï¼šQPS < 100
- ä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼šQPS < 1000

ä¸­ç­‰QPSåœºæ™¯ï¼š
- ç”µå•†å•†å“é¡µï¼šQPS 1000-10000
- æ–°é—»èµ„è®¯ï¼šQPS 5000-50000

é«˜QPSåœºæ™¯ï¼š
- æœç´¢å¼•æ“ï¼šQPS > 100000
- ç¤¾äº¤åª’ä½“ï¼šQPS > 500000
```

**âš¡ QPSç›‘æ§å®ç°**ï¼š
```java
public class QPSMonitor {
    // æ»‘åŠ¨çª—å£ç»Ÿè®¡QPS
    private final LinkedList<Long> timeWindows = new LinkedList<>();
    private long requestCount = 0;
    
    public synchronized void recordRequest() {
        long currentSecond = System.currentTimeMillis() / 1000;
        
        // æ¸…ç†è¿‡æœŸçª—å£
        while (!timeWindows.isEmpty() && 
               timeWindows.peek() < currentSecond - 60) {
            timeWindows.poll();
        }
        
        timeWindows.offer(currentSecond);
        requestCount++;
    }
    
    public double getCurrentQPS() {
        return timeWindows.size() / 60.0; // æœ€è¿‘1åˆ†é’Ÿçš„å¹³å‡QPS
    }
}
```

### 3.2 RT - å“åº”æ—¶é—´æ€§èƒ½æŒ‡æ ‡


**ğŸ”¸ RTçš„æ·±åº¦ç†è§£**ï¼š
```
RTï¼ˆResponse Timeï¼‰= å“åº”æ—¶é—´

é€šä¿—ç†è§£ï¼šä»å‘é€è¯·æ±‚åˆ°æ”¶åˆ°å®Œæ•´å“åº”çš„æ—¶é—´
å°±åƒä½ é—®è·¯åˆ°å¯¹æ–¹å®Œæ•´å›ç­”ä½ çš„æ—¶é—´
```

**â±ï¸ RTçš„åˆ†è§£åˆ†æ**ï¼š
```
æ€»å“åº”æ—¶é—´ = ç½‘ç»œæ—¶é—´ + æœåŠ¡å¤„ç†æ—¶é—´

æœåŠ¡å¤„ç†æ—¶é—´ = æ’é˜Ÿæ—¶é—´ + å®é™…å¤„ç†æ—¶é—´

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç½‘ç»œå»¶è¿Ÿ â”‚â”€â”€â”€â–¶â”‚ æ’é˜Ÿç­‰å¾…  â”‚â”€â”€â”€â–¶â”‚ ä¸šåŠ¡å¤„ç† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    5ms           10ms           20ms
                Total RT = 35ms
```

**ğŸ“Š RTæ€§èƒ½åˆ†çº§**ï¼š
```
ğŸŸ¢ ä¼˜ç§€ï¼šRT < 100ms     ç”¨æˆ·æ— æ„ŸçŸ¥
ğŸŸ¡ è‰¯å¥½ï¼š100ms < RT < 500ms    è½»å¾®æ„ŸçŸ¥
ğŸŸ  ä¸€èˆ¬ï¼š500ms < RT < 1s       æ˜æ˜¾æ„ŸçŸ¥  
ğŸ”´ è¾ƒå·®ï¼š1s < RT < 3s         ä½“éªŒä¸‹é™
ğŸš¨ æå·®ï¼šRT > 3s              ç”¨æˆ·æµå¤±
```

### 3.3 æˆåŠŸç‡ - ç³»ç»Ÿç¨³å®šæ€§æ ¸å¿ƒ


**ğŸ”¸ æˆåŠŸç‡çš„ä¸šåŠ¡å«ä¹‰**ï¼š
```
æˆåŠŸç‡ = æˆåŠŸå¤„ç†çš„è¯·æ±‚æ•° / æ€»è¯·æ±‚æ•° Ã— 100%

é€šä¿—ç†è§£ï¼š100æ¬¡è¯·æ±‚ä¸­æœ‰å¤šå°‘æ¬¡æ˜¯æˆåŠŸçš„
å°±åƒé¤å…100ä¸ªè®¢å•ä¸­æˆåŠŸåˆ¶ä½œäº†å¤šå°‘ä¸ª
```

**âœ… æˆåŠŸç‡çš„åˆ†çº§æ ‡å‡†**ï¼š
```
ğŸ’ äº”ä¸ªä¹ï¼š99.999%   å¹´æ•…éšœæ—¶é—´ < 5åˆ†é’Ÿ
ğŸ’ å››ä¸ªä¹ï¼š99.99%    å¹´æ•…éšœæ—¶é—´ < 53åˆ†é’Ÿ  
ğŸ¥‡ ä¸‰ä¸ªä¹ï¼š99.9%     å¹´æ•…éšœæ—¶é—´ < 9å°æ—¶
ğŸ¥ˆ ä¸¤ä¸ªä¹ï¼š99%       å¹´æ•…éšœæ—¶é—´ < 4å¤©
ğŸ¥‰ ä¸€ä¸ªä¹ï¼š90%       å¹´æ•…éšœæ—¶é—´ < 36å¤©
```

**ğŸ”§ æˆåŠŸç‡ç›‘æ§å®ç°**ï¼š
```java
public class SuccessRateMonitor {
    private AtomicLong totalRequests = new AtomicLong(0);
    private AtomicLong successRequests = new AtomicLong(0);
    
    public void recordSuccess() {
        totalRequests.incrementAndGet();
        successRequests.incrementAndGet();
    }
    
    public void recordFailure() {
        totalRequests.incrementAndGet();
    }
    
    public double getSuccessRate() {
        long total = totalRequests.get();
        if (total == 0) return 100.0;
        
        return (double) successRequests.get() / total * 100;
    }
}
```

### 3.4 å¹¶å‘æ•°ä¸è¿æ¥æ•°


**ğŸ”¸ å¹¶å‘æ•°çš„å«ä¹‰**ï¼š
```
å¹¶å‘æ•° = åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°é‡

é€šä¿—ç†è§£ï¼šé¤å…åŒæ—¶åœ¨åˆ¶ä½œå¤šå°‘ä¸ªè®¢å•
åæ˜ ç³»ç»Ÿå½“å‰çš„è´Ÿè½½æƒ…å†µ
```

**ğŸ”— è¿æ¥æ•°çš„å«ä¹‰**ï¼š
```
è¿æ¥æ•° = å»ºç«‹çš„ç½‘ç»œè¿æ¥æ•°é‡

é€šä¿—ç†è§£ï¼šé¤å…åŒæ—¶æ¥å¬å¤šå°‘ä¸ªç”µè¯
åæ˜ ç³»ç»Ÿçš„è¿æ¥èµ„æºä½¿ç”¨æƒ…å†µ
```

**ğŸ“Š å¹¶å‘ä¸è¿æ¥çš„å…³ç³»**ï¼š
```
è¿æ¥æ± åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚â”€â”€â”€â”€â–¶â”‚   è¿æ¥æ±       â”‚â”€â”€â”€â”€â–¶â”‚   æœåŠ¡ç«¯     â”‚
â”‚ 1000å¹¶å‘è¯·æ±‚ â”‚     â”‚  20ä¸ªè¿æ¥     â”‚     â”‚  å¤„ç†è¯·æ±‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿æ¥å¤ç”¨ï¼šå¤šä¸ªè¯·æ±‚å…±äº«åŒä¸€ä¸ªè¿æ¥
å¹¶å‘æ§åˆ¶ï¼šè¿æ¥æ•°é™åˆ¶äº†æœ€å¤§å¹¶å‘æ•°
```

---

## 4. ğŸ“¡ ç›‘æ§æŒ‡æ ‡é‡‡é›†æ–¹å¼


### 4.1 æ¨æ¨¡å¼ vs æ‹‰æ¨¡å¼


**ğŸ”¸ æ¨æ¨¡å¼ï¼ˆPushï¼‰**ï¼š
```
æœåŠ¡ä¸»åŠ¨ä¸ŠæŠ¥æŒ‡æ ‡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ¨é€æŒ‡æ ‡    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨A   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ç›‘æ§ç³»ç»Ÿ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ¨é€æŒ‡æ ‡           â–²
â”‚  åº”ç”¨B   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šå®æ—¶æ€§å¥½ï¼Œæ•°æ®ä¸ä¸¢å¤±
ç¼ºç‚¹ï¼šç›‘æ§ç³»ç»Ÿå‹åŠ›å¤§ï¼Œéœ€è¦å¤„ç†å¤§é‡æ¨é€
```

**ğŸ”¸ æ‹‰æ¨¡å¼ï¼ˆPullï¼‰**ï¼š
```
ç›‘æ§ç³»ç»Ÿä¸»åŠ¨æ‹‰å–æŒ‡æ ‡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨A   â”‚â—€â”€â”€æ‹‰å–æŒ‡æ ‡â”€â”€â”€â”€â”‚  ç›‘æ§ç³»ç»Ÿ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â–²
â”‚  åº”ç”¨B   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šç›‘æ§ç³»ç»Ÿæ§åˆ¶é‡‡é›†é¢‘ç‡ï¼Œå‹åŠ›å¯æ§
ç¼ºç‚¹ï¼šå¯èƒ½ä¸¢å¤±çŸ­æ—¶é—´çš„å¼‚å¸¸æ•°æ®
```

### 4.2 é‡‡é›†æ–¹å¼çš„é€‰æ‹©ç­–ç•¥


**ğŸ“Š å¯¹æ¯”åˆ†æ**ï¼š

| ç‰¹æ€§ | **æ¨æ¨¡å¼** | **æ‹‰æ¨¡å¼** |
|------|-----------|-----------|
| **å®æ—¶æ€§** | `é«˜ï¼Œç«‹å³ä¸ŠæŠ¥` | `ä¸­ç­‰ï¼Œå®šæ—¶æ‹‰å–` |
| **æ•°æ®å®Œæ•´æ€§** | `é«˜ï¼Œä¸æ˜“ä¸¢å¤±` | `ä¸­ç­‰ï¼Œå¯èƒ½é—æ¼` |
| **ç›‘æ§ç³»ç»Ÿå‹åŠ›** | `é«˜ï¼Œè¢«åŠ¨æ¥æ”¶` | `ä½ï¼Œä¸»åŠ¨æ§åˆ¶` |
| **ç½‘ç»œå¼€é”€** | `ä½ï¼ŒæŒ‰éœ€æ¨é€` | `é«˜ï¼Œå®šæ—¶è½®è¯¢` |
| **é…ç½®å¤æ‚åº¦** | `ä½ï¼Œåº”ç”¨ç«¯é…ç½®` | `é«˜ï¼Œéœ€è¦å‘ç°æœºåˆ¶` |

**ğŸ¯ é€‰æ‹©å»ºè®®**ï¼š
```
é€‰æ‹©æ¨æ¨¡å¼çš„åœºæ™¯ï¼š
âœ… å¯¹å®æ—¶æ€§è¦æ±‚é«˜
âœ… æ•°æ®ä¸èƒ½ä¸¢å¤±  
âœ… æœåŠ¡æ•°é‡ä¸å¤š
âœ… ç½‘ç»œç¯å¢ƒç¨³å®š

é€‰æ‹©æ‹‰æ¨¡å¼çš„åœºæ™¯ï¼š
âœ… æœåŠ¡æ•°é‡å¾ˆå¤š
âœ… éœ€è¦ç»Ÿä¸€çš„é‡‡é›†ç­–ç•¥
âœ… ç›‘æ§ç³»ç»Ÿèµ„æºæœ‰é™
âœ… éœ€è¦çµæ´»çš„é‡‡é›†é¢‘ç‡
```

### 4.3 æ··åˆé‡‡é›†ç­–ç•¥


**ğŸ”„ æœ€ä½³å®è·µ**ï¼š
```
æ ¸å¿ƒæŒ‡æ ‡ç”¨æ¨æ¨¡å¼ï¼š
- é”™è¯¯ç‡å¼‚å¸¸ â†’ ç«‹å³æ¨é€æŠ¥è­¦
- æœåŠ¡å®•æœºäº‹ä»¶ â†’ å®æ—¶é€šçŸ¥

å¸¸è§„æŒ‡æ ‡ç”¨æ‹‰æ¨¡å¼ï¼š
- CPUã€å†…å­˜ä½¿ç”¨ç‡ â†’ å®šæ—¶é‡‡é›†
- QPSã€RTç»Ÿè®¡ â†’ å‘¨æœŸæ€§æ‹‰å–

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨æœåŠ¡    â”‚
â”‚             â”‚  æ¨é€  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼‚å¸¸äº‹ä»¶ â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶â”‚  ç›‘æ§ä¸­å¿ƒ    â”‚
â”‚             â”‚       â”‚             â”‚
â”‚ æ€§èƒ½æŒ‡æ ‡ â—€â”€â”€â”€â”¼â”€â”€â”€æ‹‰å–â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ğŸ—ï¸ ç›‘æ§ç³»ç»Ÿæ¶æ„è®¾è®¡


### 5.1 ç›‘æ§ç³»ç»Ÿçš„åŸºæœ¬æ¶æ„


**ğŸ¢ ç›‘æ§ç³»ç»Ÿå…¨è²Œ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®é‡‡é›†   â”‚â”€â”€â”€â–¶â”‚   æ•°æ®å­˜å‚¨   â”‚â”€â”€â”€â–¶â”‚   æ•°æ®å±•ç¤º   â”‚
â”‚             â”‚    â”‚             â”‚    â”‚             â”‚
â”‚ â€¢ SDKåŸ‹ç‚¹   â”‚    â”‚ â€¢ æ—¶åºæ•°æ®åº“ â”‚    â”‚ â€¢ ç›‘æ§å¤§å±   â”‚
â”‚ â€¢ æ—¥å¿—é‡‡é›†   â”‚    â”‚ â€¢ å…³ç³»æ•°æ®åº“ â”‚    â”‚ â€¢ æŠ¥è­¦é€šçŸ¥   â”‚
â”‚ â€¢ æŒ‡æ ‡æš´éœ²   â”‚    â”‚ â€¢ ç¼“å­˜ç³»ç»Ÿ   â”‚    â”‚ â€¢ æ•°æ®åˆ†æ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                   â–²                   â–²
       â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡åº”ç”¨é›†ç¾¤ â”‚    â”‚ å­˜å‚¨é›†ç¾¤     â”‚    â”‚ å¯è§†åŒ–å¹³å°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Prometheus + Grafana æ–¹æ¡ˆ


**ğŸ”¸ Prometheus çš„ä¼˜åŠ¿**ï¼š
```
Prometheusï¼šæ—¶åºæ•°æ®åº“ + ç›‘æ§ç³»ç»Ÿ

ç‰¹ç‚¹ï¼š
âœ… æ‹‰æ¨¡å¼é‡‡é›†
âœ… å¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€ï¼ˆPromQLï¼‰
âœ… å†…ç½®æŠ¥è­¦ç®¡ç†
âœ… æœåŠ¡å‘ç°æœºåˆ¶
âœ… äº‘åŸç”Ÿè®¾è®¡
```

**ğŸ“Š Prometheus æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPæ‹‰å–    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨æœåŠ¡     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Prometheus  â”‚
â”‚ /metricsç«¯ç‚¹ â”‚               â”‚ æ—¶åºæ•°æ®åº“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                              å­˜å‚¨æŒ‡æ ‡æ•°æ®
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    PromQLæŸ¥è¯¢  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grafana    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ æ—¶åºå­˜å‚¨     â”‚
â”‚ å¯è§†åŒ–å¹³å°   â”‚               â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ ç®€å•çš„ Prometheus é…ç½®**ï¼š
```yaml
# prometheus.yml
global:
  scrape_interval: 15s  # é‡‡é›†é—´éš”

scrape_configs:
  - job_name: 'rpc-service'
    static_configs:
      - targets: ['localhost:8080']  # åº”ç”¨çš„metricsç«¯ç‚¹
    scrape_interval: 5s
    metrics_path: '/metrics'
```

### 5.3 InfluxDB æ–¹æ¡ˆ


**ğŸ”¸ InfluxDB çš„ç‰¹ç‚¹**ï¼š
```
InfluxDBï¼šä¸“ä¸šçš„æ—¶åºæ•°æ®åº“

ä¼˜åŠ¿ï¼š
âœ… é«˜æ€§èƒ½æ—¶åºæ•°æ®å­˜å‚¨
âœ… SQL-likeæŸ¥è¯¢è¯­è¨€
âœ… æ•°æ®å‹ç¼©å’Œä¿ç•™ç­–ç•¥
âœ… æ”¯æŒè¿ç»­æŸ¥è¯¢
```

**ğŸ“Š InfluxDB æ•°æ®æ¨¡å‹**ï¼š
```
measurement,tag1=value1,tag2=value2 field1=value1,field2=value2 timestamp

ç¤ºä¾‹ï¼š
rpc_request,service=user,method=getUserInfo count=100,latency=50ms 1609459200000000000

è§£é‡Šï¼š
- measurement: rpc_requestï¼ˆæŒ‡æ ‡åç§°ï¼‰
- tags: service=user,method=getUserInfoï¼ˆç»´åº¦æ ‡ç­¾ï¼‰
- fields: count=100,latency=50msï¼ˆæŒ‡æ ‡å€¼ï¼‰
- timestamp: æ—¶é—´æˆ³
```

### 5.4 è‡ªå®šä¹‰ç›‘æ§æ–¹æ¡ˆ


**ğŸ”§ è½»é‡çº§è‡ªå®šä¹‰æ–¹æ¡ˆ**ï¼š
```java
// ç®€å•çš„ç›‘æ§æ•°æ®æ”¶é›†å™¨
public class MetricsCollector {
    private final Map<String, AtomicLong> counters = new ConcurrentHashMap<>();
    private final Map<String, Queue<Long>> latencies = new ConcurrentHashMap<>();
    
    // è®°å½•QPS
    public void incrementCounter(String metric) {
        counters.computeIfAbsent(metric, k -> new AtomicLong(0))
                .incrementAndGet();
    }
    
    // è®°å½•å»¶è¿Ÿ
    public void recordLatency(String metric, long latency) {
        latencies.computeIfAbsent(metric, k -> new ConcurrentLinkedQueue<>())
                 .offer(latency);
    }
    
    // è·å–æŒ‡æ ‡å¿«ç…§
    public Map<String, Object> getMetrics() {
        Map<String, Object> metrics = new HashMap<>();
        
        // QPSæŒ‡æ ‡
        counters.forEach((key, counter) -> {
            metrics.put(key + "_qps", counter.getAndSet(0));
        });
        
        // å»¶è¿ŸæŒ‡æ ‡
        latencies.forEach((key, queue) -> {
            if (!queue.isEmpty()) {
                metrics.put(key + "_avg_latency", 
                    queue.stream().mapToLong(Long::longValue).average().orElse(0));
                queue.clear();
            }
        });
        
        return metrics;
    }
}
```

---

## 6. ğŸ“‹ æ€§èƒ½åŸºçº¿ä¸æŠ¥è­¦ç­–ç•¥


### 6.1 ä»€ä¹ˆæ˜¯æ€§èƒ½åŸºçº¿


**ğŸ”¸ æ€§èƒ½åŸºçº¿çš„å«ä¹‰**ï¼š
```
æ€§èƒ½åŸºçº¿ = ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶çš„æ€§èƒ½å‚è€ƒæ ‡å‡†

é€šä¿—ç†è§£ï¼šå°±åƒä½“æ£€æ—¶çš„æ­£å¸¸æŒ‡æ ‡èŒƒå›´
è¡€å‹æ­£å¸¸å€¼ï¼š90-140ï¼Œè¶…å‡ºå°±æ˜¯å¼‚å¸¸
ç³»ç»Ÿæ­£å¸¸QPSï¼š1000-2000ï¼Œè¶…å‡ºéœ€è¦å…³æ³¨
```

**ğŸ“Š åŸºçº¿å»ºç«‹çš„æ­¥éª¤**ï¼š
```
1. æ•°æ®æ”¶é›†é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰
   â””â”€ æ”¶é›†ç³»ç»Ÿåœ¨æ­£å¸¸ä¸šåŠ¡åœºæ™¯ä¸‹çš„å„é¡¹æŒ‡æ ‡

2. æ•°æ®åˆ†æé˜¶æ®µ
   â””â”€ åˆ†ææŒ‡æ ‡çš„åˆ†å¸ƒæƒ…å†µï¼Œç¡®å®šæ­£å¸¸èŒƒå›´

3. åŸºçº¿åˆ¶å®šé˜¶æ®µ  
   â””â”€ è®¾å®šå„é¡¹æŒ‡æ ‡çš„æ­£å¸¸èŒƒå›´å’Œå‘Šè­¦é˜ˆå€¼

4. åŠ¨æ€è°ƒæ•´é˜¶æ®µ
   â””â”€ æ ¹æ®ä¸šåŠ¡å˜åŒ–å®šæœŸè°ƒæ•´åŸºçº¿æ ‡å‡†
```

### 6.2 åŸºçº¿å»ºç«‹æ–¹æ³•


**ğŸ“ˆ ç»Ÿè®¡å­¦æ–¹æ³•**ï¼š
```
ä»¥QPSä¸ºä¾‹å»ºç«‹åŸºçº¿ï¼š

1. æ”¶é›†å†å²æ•°æ®ï¼š
   è¿‡å»30å¤©çš„QPSæ•°æ®ï¼š[800, 1200, 1100, 900, 1300, ...]

2. è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡ï¼š
   å¹³å‡å€¼ï¼š1000 QPS
   æ ‡å‡†å·®ï¼š200 QPS
   P95å€¼ï¼š1400 QPS

3. è®¾å®šåŸºçº¿èŒƒå›´ï¼š
   æ­£å¸¸èŒƒå›´ï¼š600-1400 QPSï¼ˆå‡å€¼ Â± 2å€æ ‡å‡†å·®ï¼‰
   å…³æ³¨é˜ˆå€¼ï¼š1400-1600 QPS
   æŠ¥è­¦é˜ˆå€¼ï¼š> 1600 QPS
```

**âš¡ åŠ¨æ€åŸºçº¿**ï¼š
```java
public class DynamicBaseline {
    private Queue<Double> historicalData = new LinkedList<>();
    private static final int WINDOW_SIZE = 100; // çª—å£å¤§å°
    
    public void addDataPoint(double value) {
        if (historicalData.size() >= WINDOW_SIZE) {
            historicalData.poll(); // ç§»é™¤æœ€è€çš„æ•°æ®
        }
        historicalData.offer(value);
    }
    
    public BaselineResult calculateBaseline() {
        if (historicalData.size() < 10) {
            return null; // æ•°æ®ä¸è¶³
        }
        
        double[] data = historicalData.stream()
                                    .mapToDouble(Double::doubleValue)
                                    .toArray();
        
        double mean = Arrays.stream(data).average().orElse(0);
        double stdDev = calculateStdDev(data, mean);
        
        return new BaselineResult(
            mean - 2 * stdDev,  // ä¸‹ç•Œ
            mean + 2 * stdDev,  // ä¸Šç•Œ
            mean                // æœŸæœ›å€¼
        );
    }
}
```

### 6.3 æŠ¥è­¦ç­–ç•¥è®¾è®¡


**ğŸš¨ å¤šçº§æŠ¥è­¦æœºåˆ¶**ï¼š
```
ğŸŸ¢ æ­£å¸¸çŠ¶æ€ï¼šæŒ‡æ ‡åœ¨åŸºçº¿èŒƒå›´å†…
ğŸŸ¡ å…³æ³¨çº§åˆ«ï¼šæŒ‡æ ‡è½»å¾®åç¦»åŸºçº¿ï¼ˆ1-2å€æ ‡å‡†å·®ï¼‰
ğŸŸ  è­¦å‘Šçº§åˆ«ï¼šæŒ‡æ ‡æ˜æ˜¾å¼‚å¸¸ï¼ˆ2-3å€æ ‡å‡†å·®ï¼‰
ğŸ”´ ä¸¥é‡çº§åˆ«ï¼šæŒ‡æ ‡ä¸¥é‡å¼‚å¸¸ï¼ˆ>3å€æ ‡å‡†å·®ï¼‰
ğŸš¨ ç¾éš¾çº§åˆ«ï¼šæœåŠ¡å®Œå…¨ä¸å¯ç”¨
```

**â° æŠ¥è­¦æŠ‘åˆ¶ç­–ç•¥**ï¼š
```
1. é¢‘ç‡æ§åˆ¶ï¼š
   åŒä¸€ä¸ªæŠ¥è­¦5åˆ†é’Ÿå†…æœ€å¤šå‘é€1æ¬¡

2. å‡çº§æœºåˆ¶ï¼š
   è­¦å‘Šçº§åˆ«æŒç»­10åˆ†é’Ÿ â†’ å‡çº§ä¸ºä¸¥é‡çº§åˆ«

3. é™é»˜æœŸé—´ï¼š
   å·²çŸ¥é—®é¢˜å¤„ç†æœŸé—´æš‚åœç›¸å…³æŠ¥è­¦

4. ç»„åˆæ¡ä»¶ï¼š
   å¤šä¸ªæŒ‡æ ‡åŒæ—¶å¼‚å¸¸æ‰è§¦å‘æŠ¥è­¦
   ä¾‹å¦‚ï¼šQPSä¸‹é™50% AND é”™è¯¯ç‡ä¸Šå‡åˆ°5%
```

**ğŸ“§ æŠ¥è­¦é€šçŸ¥å®ç°**ï¼š
```java
public class AlertManager {
    private final Map<String, Long> lastAlertTime = new ConcurrentHashMap<>();
    private static final long ALERT_INTERVAL = 5 * 60 * 1000; // 5åˆ†é’Ÿ
    
    public void checkAndAlert(String metric, double value, double threshold) {
        if (value > threshold) {
            String alertKey = metric + "_threshold_exceeded";
            long currentTime = System.currentTimeMillis();
            
            // æ£€æŸ¥æ˜¯å¦åœ¨é™é»˜æœŸ
            Long lastAlert = lastAlertTime.get(alertKey);
            if (lastAlert == null || currentTime - lastAlert > ALERT_INTERVAL) {
                
                sendAlert(metric, value, threshold);
                lastAlertTime.put(alertKey, currentTime);
            }
        }
    }
    
    private void sendAlert(String metric, double value, double threshold) {
        String message = String.format(
            "ğŸš¨ æŒ‡æ ‡å¼‚å¸¸æŠ¥è­¦\n" +
            "æŒ‡æ ‡ï¼š%s\n" +
            "å½“å‰å€¼ï¼š%.2f\n" +
            "é˜ˆå€¼ï¼š%.2f\n" +
            "æ—¶é—´ï¼š%s",
            metric, value, threshold, new Date()
        );
        
        // å‘é€åˆ°å¤šä¸ªæ¸ é“
        sendEmail(message);
        sendSMS(message);
        sendToSlack(message);
    }
}
```

---

## 7. ğŸ› ï¸ ç›‘æ§ç³»ç»Ÿæ­å»ºå®è·µ


### 7.1 ç›‘æ§æŒ‡æ ‡åŸ‹ç‚¹


**ğŸ”§ RPCå®¢æˆ·ç«¯åŸ‹ç‚¹**ï¼š
```java
public class RPCClientMonitor {
    private final MetricsCollector metrics = new MetricsCollector();
    
    public <T> T callWithMonitoring(String serviceName, String method, 
                                   Supplier<T> rpcCall) {
        String metricPrefix = serviceName + "." + method;
        long startTime = System.currentTimeMillis();
        
        try {
            // è®°å½•è¯·æ±‚å¼€å§‹
            metrics.incrementCounter(metricPrefix + ".requests");
            
            // æ‰§è¡ŒRPCè°ƒç”¨
            T result = rpcCall.get();
            
            // è®°å½•æˆåŠŸ
            metrics.incrementCounter(metricPrefix + ".success");
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥
            metrics.incrementCounter(metricPrefix + ".errors");
            throw e;
            
        } finally {
            // è®°å½•å“åº”æ—¶é—´
            long duration = System.currentTimeMillis() - startTime;
            metrics.recordLatency(metricPrefix + ".latency", duration);
        }
    }
}
```

**ğŸ”§ RPCæœåŠ¡ç«¯åŸ‹ç‚¹**ï¼š
```java
public class RPCServerMonitor {
    
    // ä½¿ç”¨æ‹¦æˆªå™¨è¿›è¡Œè‡ªåŠ¨åŸ‹ç‚¹
    public class MonitoringInterceptor implements RPCInterceptor {
        
        @Override
        public Object intercept(RPCInvocation invocation) throws Exception {
            String serviceName = invocation.getServiceName();
            String methodName = invocation.getMethodName();
            String metricKey = serviceName + "." + methodName;
            
            long startTime = System.currentTimeMillis();
            
            try {
                // è®°å½•å¹¶å‘æ•°
                ConcurrentGauge.increment(metricKey + ".concurrent");
                
                // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                Object result = invocation.proceed();
                
                // è®°å½•æˆåŠŸ
                Counter.increment(metricKey + ".success");
                return result;
                
            } catch (Exception e) {
                // è®°å½•å¼‚å¸¸
                Counter.increment(metricKey + ".error");
                throw e;
                
            } finally {
                // è®°å½•å“åº”æ—¶é—´å’Œå¹¶å‘æ•°
                long duration = System.currentTimeMillis() - startTime;
                Timer.record(metricKey + ".duration", duration);
                ConcurrentGauge.decrement(metricKey + ".concurrent");
            }
        }
    }
}
```

### 7.2 æŒ‡æ ‡èšåˆä¸å­˜å‚¨


**ğŸ“Š æŒ‡æ ‡èšåˆç­–ç•¥**ï¼š
```java
public class MetricsAggregator {
    
    // æ»‘åŠ¨çª—å£èšåˆ
    public class SlidingWindowAggregator {
        private final CircularBuffer<DataPoint> buffer;
        private final long windowSizeMs;
        
        public AggregateResult aggregate() {
            long currentTime = System.currentTimeMillis();
            
            // è¿‡æ»¤çª—å£å†…çš„æ•°æ®ç‚¹
            List<DataPoint> windowData = buffer.stream()
                .filter(dp -> currentTime - dp.timestamp < windowSizeMs)
                .collect(Collectors.toList());
            
            if (windowData.isEmpty()) {
                return AggregateResult.empty();
            }
            
            // è®¡ç®—èšåˆæŒ‡æ ‡
            double sum = windowData.stream().mapToDouble(dp -> dp.value).sum();
            double avg = sum / windowData.size();
            double max = windowData.stream().mapToDouble(dp -> dp.value).max().orElse(0);
            double min = windowData.stream().mapToDouble(dp -> dp.value).min().orElse(0);
            
            return new AggregateResult(sum, avg, max, min, windowData.size());
        }
    }
}
```

**ğŸ’¾ å­˜å‚¨ä¼˜åŒ–ç­–ç•¥**ï¼š
```
æ•°æ®åˆ†å±‚å­˜å‚¨ï¼š

1. å®æ—¶æ•°æ®ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰ï¼š
   - å­˜å‚¨ç²’åº¦ï¼šç§’çº§
   - å­˜å‚¨ä»‹è´¨ï¼šå†…å­˜ + Redis
   - ç”¨é€”ï¼šå®æ—¶ç›‘æ§å’ŒæŠ¥è­¦

2. è¿‘æœŸæ•°æ®ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰ï¼š
   - å­˜å‚¨ç²’åº¦ï¼šåˆ†é’Ÿçº§
   - å­˜å‚¨ä»‹è´¨ï¼šInfluxDB/Prometheus
   - ç”¨é€”ï¼šé—®é¢˜æ’æŸ¥å’ŒçŸ­æœŸåˆ†æ

3. å†å²æ•°æ®ï¼ˆæœ€è¿‘30å¤©ï¼‰ï¼š
   - å­˜å‚¨ç²’åº¦ï¼šå°æ—¶çº§
   - å­˜å‚¨ä»‹è´¨ï¼šæ—¶åºæ•°æ®åº“
   - ç”¨é€”ï¼šè¶‹åŠ¿åˆ†æå’Œå®¹é‡è§„åˆ’

4. å½’æ¡£æ•°æ®ï¼ˆ30å¤©ä»¥ä¸Šï¼‰ï¼š
   - å­˜å‚¨ç²’åº¦ï¼šå¤©çº§
   - å­˜å‚¨ä»‹è´¨ï¼šå¯¹è±¡å­˜å‚¨ï¼ˆS3/OSSï¼‰
   - ç”¨é€”ï¼šå†å²æŸ¥è¯¢å’Œåˆè§„è¦æ±‚
```

### 7.3 ç›‘æ§å¤§å±æ­å»º


**ğŸ“º Grafana å¤§å±é…ç½®**ï¼š
```json
{
  "dashboard": {
    "title": "RPCæœåŠ¡ç›‘æ§å¤§å±",
    "panels": [
      {
        "title": "æ•´ä½“QPS",
        "type": "stat",
        "targets": [
          {
            "expr": "sum(rate(rpc_requests_total[1m]))",
            "legendFormat": "æ€»QPS"
          }
        ]
      },
      {
        "title": "å¹³å‡å“åº”æ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(rpc_duration_seconds_bucket[5m]))",
            "legendFormat": "P95å»¶è¿Ÿ"
          }
        ]
      },
      {
        "title": "é”™è¯¯ç‡åˆ†å¸ƒ",
        "type": "piechart",
        "targets": [
          {
            "expr": "sum by (service) (rate(rpc_errors_total[5m]))",
            "legendFormat": "{{service}}"
          }
        ]
      }
    ]
  }
}
```

**ğŸ¨ ç›‘æ§å¤§å±å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RPCæœåŠ¡ç›‘æ§å¤§å±                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Šæ€»QPS    ğŸ“ˆP95å»¶è¿Ÿ    âœ…æˆåŠŸç‡    ğŸ”—è¿æ¥æ•°    ğŸ’¾å†…å­˜      â”‚
â”‚   1,205      85ms        99.9%      127        4.2GB       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    QPSè¶‹åŠ¿å›¾        â”‚         é”™è¯¯ç‡åˆ†å¸ƒé¥¼å›¾                 â”‚
â”‚                     â”‚                                       â”‚
â”‚    /\  /\           â”‚     UserService: 0.1%                â”‚
â”‚   /  \/  \          â”‚     OrderService: 0.2%               â”‚
â”‚  /        \         â”‚     PayService: 0.05%                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   çƒ­ç‚¹æœåŠ¡TOP10      â”‚         å“åº”æ—¶é—´åˆ†å¸ƒç›´æ–¹å›¾             â”‚
â”‚                     â”‚                                       â”‚
â”‚ 1. UserService      â”‚    [0-50ms]: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80%           â”‚
â”‚ 2. OrderService     â”‚    [50-100ms]: â–ˆâ–ˆâ–ˆ 15%              â”‚
â”‚ 3. PayService       â”‚    [100-200ms]: â–ˆ 4%                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å››å¤§é»„é‡‘æŒ‡æ ‡ï¼šå»¶è¿Ÿã€æµé‡ã€é”™è¯¯ã€é¥±å’Œåº¦æ˜¯ç›‘æ§çš„æ ¸å¿ƒæ¡†æ¶
ğŸ”¸ RPCæ ¸å¿ƒæŒ‡æ ‡ï¼šQPSï¼ˆååé‡ï¼‰ã€RTï¼ˆå“åº”æ—¶é—´ï¼‰ã€æˆåŠŸç‡ï¼ˆç¨³å®šæ€§ï¼‰
ğŸ”¸ é‡‡é›†æ¨¡å¼ï¼šæ¨æ¨¡å¼å®æ—¶æ€§å¥½ï¼Œæ‹‰æ¨¡å¼å‹åŠ›å¯æ§ï¼Œéœ€è¦æ ¹æ®åœºæ™¯é€‰æ‹©
ğŸ”¸ ç›‘æ§æ¶æ„ï¼šé‡‡é›†â†’å­˜å‚¨â†’å±•ç¤ºâ†’æŠ¥è­¦çš„å®Œæ•´é“¾è·¯è®¾è®¡
ğŸ”¸ æ€§èƒ½åŸºçº¿ï¼šå»ºç«‹æ­£å¸¸è¿è¡Œçš„å‚è€ƒæ ‡å‡†ï¼Œä¸ºå¼‚å¸¸æ£€æµ‹æä¾›ä¾æ®
ğŸ”¸ æŠ¥è­¦ç­–ç•¥ï¼šå¤šçº§æŠ¥è­¦ã€é¢‘ç‡æ§åˆ¶ã€å‡çº§æœºåˆ¶çš„è®¾è®¡åŸåˆ™
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§çš„æœ¬è´¨ä»·å€¼**
```
ä¸æ˜¯ä¸ºäº†ç›‘æ§è€Œç›‘æ§ï¼Œè€Œæ˜¯ï¼š
- åŠæ—¶å‘ç°é—®é¢˜ â†’ å‡å°‘æ•…éšœå½±å“
- äº†è§£ç³»ç»ŸçŠ¶æ€ â†’ æŒ‡å¯¼ä¼˜åŒ–å†³ç­–  
- å»ºç«‹æ€§èƒ½åŸºçº¿ â†’ é‡åŒ–æœåŠ¡è´¨é‡
- æä¾›æ•°æ®æ”¯æ’‘ â†’ è¾…åŠ©å®¹é‡è§„åˆ’
```

**ğŸ”¹ æŒ‡æ ‡é€‰æ‹©çš„æ™ºæ…§**
```
ä¸æ˜¯æŒ‡æ ‡è¶Šå¤šè¶Šå¥½ï¼Œå…³é”®æ˜¯ï¼š
- é€‰æ‹©èƒ½åæ˜ ç”¨æˆ·ä½“éªŒçš„æŒ‡æ ‡ï¼ˆå¦‚P95å»¶è¿Ÿï¼‰
- é€‰æ‹©èƒ½é¢„æµ‹é—®é¢˜çš„æŒ‡æ ‡ï¼ˆå¦‚é¥±å’Œåº¦ï¼‰
- é€‰æ‹©èƒ½å¿«é€Ÿå®šä½é—®é¢˜çš„æŒ‡æ ‡ï¼ˆå¦‚é”™è¯¯åˆ†ç±»ï¼‰
- å¹³è¡¡ç›‘æ§æˆæœ¬ä¸æ”¶ç›Š
```

**ğŸ”¹ æŠ¥è­¦è®¾è®¡çš„å¹³è¡¡**
```
æŠ¥è­¦ä¸æ˜¯è¶Šçµæ•è¶Šå¥½ï¼Œéœ€è¦å¹³è¡¡ï¼š
- åŠæ—¶æ€§ vs å‡†ç¡®æ€§ï¼ˆå‡å°‘è¯¯æŠ¥ï¼‰
- å…¨é¢æ€§ vs ç®€æ´æ€§ï¼ˆé¿å…æŠ¥è­¦ç–²åŠ³ï¼‰
- è‡ªåŠ¨åŒ– vs äººå·¥åˆ¤æ–­ï¼ˆå¤æ‚åœºæ™¯å¤„ç†ï¼‰
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°ç³»ç»Ÿç›‘æ§å»ºè®¾æ­¥éª¤**ï¼š
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç›‘æ§
1. åŸ‹ç‚¹å››å¤§é»„é‡‘æŒ‡æ ‡
2. æ­å»ºåŸºç¡€çš„æ•°æ®é‡‡é›†å’Œå­˜å‚¨
3. å»ºç«‹ç®€å•çš„ç›‘æ§å¤§å±

ç¬¬äºŒé˜¶æ®µï¼šæ™ºèƒ½ç›‘æ§  
1. å»ºç«‹æ€§èƒ½åŸºçº¿å’ŒæŠ¥è­¦è§„åˆ™
2. å®ç°è‡ªåŠ¨åŒ–æŠ¥è­¦å’Œé€šçŸ¥
3. ä¼˜åŒ–ç›‘æ§æ•°æ®çš„èšåˆå’Œå­˜å‚¨

ç¬¬ä¸‰é˜¶æ®µï¼šæ·±åº¦ç›‘æ§
1. å¢åŠ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
2. å®ç°åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
3. å»ºç«‹ç›‘æ§æ•°æ®çš„æ·±åº¦åˆ†æèƒ½åŠ›
```

**ğŸ”§ ç›‘æ§ç³»ç»Ÿé€‰å‹å»ºè®®**ï¼š
```
å°å‹ç³»ç»Ÿï¼ˆ<10ä¸ªæœåŠ¡ï¼‰ï¼š
â†’ è‡ªå®šä¹‰ç®€å•ç›‘æ§ + Grafanaå±•ç¤º

ä¸­å‹ç³»ç»Ÿï¼ˆ10-100ä¸ªæœåŠ¡ï¼‰ï¼š
â†’ Prometheus + Grafana + AlertManager

å¤§å‹ç³»ç»Ÿï¼ˆ>100ä¸ªæœåŠ¡ï¼‰ï¼š
â†’ ä¼ä¸šçº§ç›‘æ§å¹³å°ï¼ˆå¦‚SkyWalkingã€Jaegerï¼‰
â†’ æˆ–è‡ªç ”ç›‘æ§ç³»ç»Ÿ
```

**âš ï¸ å¸¸è§ç›‘æ§é™·é˜±**ï¼š
```
âŒ åªç›‘æ§æŠ€æœ¯æŒ‡æ ‡ï¼Œå¿½ç•¥ä¸šåŠ¡æŒ‡æ ‡
âŒ è®¾ç½®è¿‡å¤šæŠ¥è­¦ï¼Œé€ æˆæŠ¥è­¦ç–²åŠ³
âŒ ç›‘æ§æ•°æ®å­¤å²›ï¼Œç¼ºä¹å…³è”åˆ†æ
âŒ åªæœ‰ç›‘æ§æ²¡æœ‰å“åº”ï¼Œç›‘æ§ä»·å€¼æœ‰é™
âŒ ç›‘æ§ç³»ç»Ÿæœ¬èº«æˆä¸ºå•ç‚¹æ•…éšœ
```

### 8.4 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸ“ˆ ç›‘æ§é¢†åŸŸå‘å±•è¶‹åŠ¿**ï¼š
- **AIOps**ï¼šåŸºäºAIçš„æ™ºèƒ½è¿ç»´å’Œå¼‚å¸¸æ£€æµ‹
- **å¯è§‚æµ‹æ€§**ï¼šMetrics + Logs + Traces ä¸‰ä½ä¸€ä½“
- **äº‘åŸç”Ÿç›‘æ§**ï¼šé€‚é…å®¹å™¨åŒ–å’Œå¾®æœåŠ¡æ¶æ„
- **ä¸šåŠ¡ç›‘æ§**ï¼šä»æŠ€æœ¯ç›‘æ§å‘ä¸šåŠ¡ä»·å€¼ç›‘æ§æ¼”è¿›

**ğŸ“ æ·±å…¥å­¦ä¹ å»ºè®®**ï¼š
- å­¦ä¹ æ—¶åºæ•°æ®åº“çš„åŸç†å’Œä¼˜åŒ–
- æŒæ¡åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæŠ€æœ¯
- äº†è§£ç›‘æ§æ•°æ®çš„æœºå™¨å­¦ä¹ åˆ†ææ–¹æ³•
- å®è·µå¤§è§„æ¨¡ç›‘æ§ç³»ç»Ÿçš„æ¶æ„è®¾è®¡

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å››å¤§æŒ‡æ ‡æ˜¯åŸºç¡€ï¼Œå»¶è¿Ÿæµé‡é”™è¯¯é¥±å’Œåº¦
- QPSå“åº”æ—¶é—´æˆåŠŸç‡ï¼Œæ ¸å¿ƒæŒ‡æ ‡è¦ç‰¢è®°
- æ¨æ‹‰æ¨¡å¼å„æœ‰ä¼˜ï¼Œåœºæ™¯é€‰æ‹©éœ€æƒè¡¡
- åŸºçº¿æŠ¥è­¦æœ‰ç­–ç•¥ï¼Œæ™ºèƒ½ç›‘æ§ä»·å€¼é«˜