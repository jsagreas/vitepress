---
title: 2ã€Dubboç”Ÿäº§çº§åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [Dubboæ˜¯ä»€ä¹ˆ](#1-Dubboæ˜¯ä»€ä¹ˆ)
2. [æ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ](#2-æ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ)
3. [ç¯å¢ƒæ­å»ºå®æˆ˜](#3-ç¯å¢ƒæ­å»ºå®æˆ˜)
4. [æ¶æ„ä¸ç»„ä»¶äº¤äº’](#4-æ¶æ„ä¸ç»„ä»¶äº¤äº’)
5. [æœåŠ¡æä¾›è€…å®ç°](#5-æœåŠ¡æä¾›è€…å®ç°)
6. [æœåŠ¡æ¶ˆè´¹è€…å®ç°](#6-æœåŠ¡æ¶ˆè´¹è€…å®ç°)
7. [é«˜çº§é…ç½®ç‰¹æ€§](#7-é«˜çº§é…ç½®ç‰¹æ€§)
8. [æ‰©å±•æœºåˆ¶è¯¦è§£](#8-æ‰©å±•æœºåˆ¶è¯¦è§£)
9. [é…ç½®æ–¹å¼å¯¹æ¯”](#9-é…ç½®æ–¹å¼å¯¹æ¯”)
10. [è¿ç»´å·¥å…·ä¸ç›‘æ§](#10-è¿ç»´å·¥å…·ä¸ç›‘æ§)
11. [é—®é¢˜è¯Šæ–­æŒ‡å—](#11-é—®é¢˜è¯Šæ–­æŒ‡å—)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Dubboæ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£Dubbo


**ğŸ  ç”Ÿæ´»ç±»æ¯”**ï¼š
æƒ³è±¡ä¸€ä¸ªå¤§å‹è´­ç‰©ä¸­å¿ƒï¼Œé‡Œé¢æœ‰å¾ˆå¤šä¸åŒçš„å•†åº—ï¼ˆæœåŠ¡ï¼‰ï¼š
- **æœè£…åº—**ï¼ˆç”¨æˆ·æœåŠ¡ï¼‰
- **é¤å…**ï¼ˆè®¢å•æœåŠ¡ï¼‰
- **é“¶è¡Œ**ï¼ˆæ”¯ä»˜æœåŠ¡ï¼‰

```
ä¼ ç»Ÿæ–¹å¼ï¼šé¡¾å®¢è¦ä¹°è¡£æœä»˜æ¬¾åƒé¥­ï¼Œéœ€è¦è·‘éæ•´ä¸ªå•†åœº
RPCæ–¹å¼ï¼šé¡¾å®¢æ‰“ç”µè¯ï¼Œå„ä¸ªåº—é“ºç›´æ¥é…é€åˆ°æŒ‡å®šä½ç½®

Dubboå°±æ˜¯è¿™ä¸ª"ç”µè¯ç³»ç»Ÿ"ï¼Œè®©ä¸åŒçš„æœåŠ¡èƒ½å¤Ÿäº’ç›¸"æ‰“ç”µè¯"è°ƒç”¨
```

### 1.2 æŠ€æœ¯å®šä¹‰


**Dubbo**ï¼šé˜¿é‡Œå·´å·´å¼€æºçš„**åˆ†å¸ƒå¼RPCæœåŠ¡æ¡†æ¶**

ğŸ”¸ **RPCå«ä¹‰**ï¼šRemote Procedure Callï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰
- å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡
- éšè—ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§

ğŸ”¸ **åˆ†å¸ƒå¼å«ä¹‰**ï¼šå¤šä¸ªæœåŠ¡éƒ¨ç½²åœ¨ä¸åŒæœºå™¨ä¸Š
- æœåŠ¡Aåœ¨æœºå™¨1ï¼ŒæœåŠ¡Båœ¨æœºå™¨2
- å®ƒä»¬éœ€è¦äº’ç›¸è°ƒç”¨å®Œæˆä¸šåŠ¡

### 1.3 è§£å†³çš„æ ¸å¿ƒé—®é¢˜


| é—®é¢˜åœºæ™¯ | **ä¼ ç»Ÿæ–¹å¼** | **Dubboæ–¹å¼** |
|---------|------------|--------------|
| ğŸ” **æœåŠ¡å‘ç°** | `ç¡¬ç¼–ç IPåœ°å€` | `è‡ªåŠ¨æ³¨å†Œå‘ç°` |
| âš–ï¸ **è´Ÿè½½å‡è¡¡** | `æ‰‹åŠ¨é…ç½®` | `è‡ªåŠ¨è´Ÿè½½å‡è¡¡` |
| ğŸ“Š **æœåŠ¡ç›‘æ§** | `åˆ†æ•£ç›‘æ§` | `ç»Ÿä¸€ç›‘æ§å¹³å°` |
| ğŸ”„ **æœåŠ¡æ²»ç†** | `äººå·¥ç®¡ç†` | `è‡ªåŠ¨åŒ–æ²»ç†` |
| ğŸ“± **æ¥å£è°ƒç”¨** | `HTTP/Socketç¼–ç¨‹` | `åƒè°ƒæœ¬åœ°æ–¹æ³•` |

---

## 2. ğŸ—ï¸ æ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ


### 2.1 å››å¤§æ ¸å¿ƒè§’è‰²


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Dubboæ¶æ„å…¨æ™¯å›¾                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1.æ³¨å†Œ     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Provider   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚    Registry     â”‚              â”‚
â”‚  â”‚ (æœåŠ¡æä¾›è€…)  â”‚               â”‚   (æ³¨å†Œä¸­å¿ƒ)     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                              â†‘                       â”‚
â”‚         â”‚                              â”‚ 2.è®¢é˜…                â”‚
â”‚         â”‚ 3.è°ƒç”¨                        â”‚                       â”‚
â”‚         â†“                              â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Consumer   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    Consumer     â”‚              â”‚
â”‚  â”‚ (æœåŠ¡æ¶ˆè´¹è€…)  â”‚  4.é€šçŸ¥å˜åŒ–    â”‚   (æœåŠ¡æ¶ˆè´¹è€…)   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ 5.ç»Ÿè®¡è°ƒç”¨æ•°æ®                                          â”‚
â”‚         â†“                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚     Monitor     â”‚                                           â”‚
â”‚  â”‚   (ç›‘æ§ä¸­å¿ƒ)     â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å„è§’è‰²è¯¦è§£


**ğŸ­ Providerï¼ˆæœåŠ¡æä¾›è€…ï¼‰**
```
ä½œç”¨ï¼šå¯¹å¤–æä¾›æœåŠ¡çš„åº”ç”¨
ç±»æ¯”ï¼šå•†åº—è€æ¿ï¼Œæä¾›å•†å“å’ŒæœåŠ¡
èŒè´£ï¼š
â€¢ å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
â€¢ æŠŠè‡ªå·±çš„æœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ
â€¢ æ¥æ”¶Consumerçš„è°ƒç”¨è¯·æ±‚å¹¶è¿”å›ç»“æœ
```

**ğŸ›’ Consumerï¼ˆæœåŠ¡æ¶ˆè´¹è€…ï¼‰**
```
ä½œç”¨ï¼šè°ƒç”¨å…¶ä»–æœåŠ¡çš„åº”ç”¨
ç±»æ¯”ï¼šé¡¾å®¢ï¼Œéœ€è¦è´­ä¹°å•†å“å’ŒæœåŠ¡
èŒè´£ï¼š
â€¢ ä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨çš„Provideråˆ—è¡¨
â€¢ é€‰æ‹©åˆé€‚çš„Providerå‘èµ·è°ƒç”¨
â€¢ å¤„ç†è°ƒç”¨ç»“æœ
```

**ğŸ“‹ Registryï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰**
```
ä½œç”¨ï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°çš„ä¸­æ¢
ç±»æ¯”ï¼šå•†åœºå¯¼è´­å°ï¼ŒçŸ¥é“æ¯ä¸ªåº—é“ºçš„ä½ç½®å’Œä¿¡æ¯
èŒè´£ï¼š
â€¢ å­˜å‚¨æ‰€æœ‰Providerçš„åœ°å€ä¿¡æ¯
â€¢ å‘Consumeræ¨é€å¯ç”¨çš„Provideråˆ—è¡¨
â€¢ ç›‘æ§Providerçš„ä¸Šçº¿ä¸‹çº¿çŠ¶æ€
```

**ğŸ“Š Monitorï¼ˆç›‘æ§ä¸­å¿ƒï¼‰**
```
ä½œç”¨ï¼šç»Ÿè®¡å’Œç›‘æ§æœåŠ¡è°ƒç”¨æƒ…å†µ
ç±»æ¯”ï¼šå•†åœºç®¡ç†ä¸­å¿ƒï¼Œç»Ÿè®¡å®¢æµå’Œäº¤æ˜“æ•°æ®
èŒè´£ï¼š
â€¢ æ”¶é›†è°ƒç”¨æ¬¡æ•°ã€å“åº”æ—¶é—´ç­‰ç»Ÿè®¡æ•°æ®
â€¢ æä¾›å¯è§†åŒ–çš„ç›‘æ§ç•Œé¢
â€¢ é¢„è­¦å’ŒæŠ¥è­¦åŠŸèƒ½
```

### 2.3 æ ¸å¿ƒæ¦‚å¿µè§£é‡Š


**ğŸ”¸ æœåŠ¡æ¥å£ï¼ˆInterfaceï¼‰**
```java
// å®šä¹‰æœåŠ¡èƒ½åšä»€ä¹ˆ
public interface UserService {
    User getUserById(Long id);    // è·å–ç”¨æˆ·ä¿¡æ¯
    boolean createUser(User user); // åˆ›å»ºç”¨æˆ·
}

// å°±åƒå•†åº—çš„æœåŠ¡èœå•ï¼Œåˆ—å‡ºèƒ½æä¾›çš„æœåŠ¡é¡¹ç›®
```

**ğŸ”¸ æœåŠ¡å®ç°ï¼ˆImplementationï¼‰**
```java
// å…·ä½“æ€ä¹ˆåšè¿™äº›æœåŠ¡
public class UserServiceImpl implements UserService {
    public User getUserById(Long id) {
        // å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼šæŸ¥æ•°æ®åº“ã€å¤„ç†æ•°æ®ç­‰
        return userDao.findById(id);
    }
}

// å°±åƒå•†åº—å‘˜å·¥çš„å…·ä½“å·¥ä½œæµç¨‹
```

**ğŸ”¸ æœåŠ¡å¼•ç”¨ï¼ˆReferenceï¼‰**
```java
// Consumerç«¯è·å–è¿œç¨‹æœåŠ¡çš„ä»£ç†å¯¹è±¡
@Reference
private UserService userService;  // çœ‹èµ·æ¥åƒæœ¬åœ°å¯¹è±¡ï¼Œå®é™…æ˜¯è¿œç¨‹è°ƒç”¨

// å°±åƒé¡¾å®¢æ‹¿åˆ°çš„"æœåŠ¡ç”µè¯"ï¼Œæ‰“ç”µè¯å°±èƒ½è·å¾—æœåŠ¡
```

---

## 3. âš™ï¸ ç¯å¢ƒæ­å»ºå®æˆ˜


### 3.1 Zookeeperæ³¨å†Œä¸­å¿ƒæ­å»º


**ä¸ºä»€ä¹ˆé€‰æ‹©Zookeeperï¼Ÿ**
```
Zookeeperç‰¹ç‚¹ï¼š
âœ… é«˜å¯ç”¨ï¼šé›†ç¾¤æ¨¡å¼ï¼Œå•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“
âœ… å¼ºä¸€è‡´æ€§ï¼šæ•°æ®å˜æ›´èƒ½åŠæ—¶åŒæ­¥åˆ°æ‰€æœ‰èŠ‚ç‚¹
âœ… ä¸´æ—¶èŠ‚ç‚¹ï¼šProviderä¸‹çº¿æ—¶è‡ªåŠ¨æ¸…ç†æ³¨å†Œä¿¡æ¯
âœ… ç›‘å¬æœºåˆ¶ï¼šProviderå˜åŒ–æ—¶ä¸»åŠ¨é€šçŸ¥Consumer
```

**ğŸ”§ å¿«é€Ÿå®‰è£…é…ç½®**
```bash
# 1. ä¸‹è½½Zookeeper
wget https://downloads.apache.org/zookeeper/zookeeper-3.7.1/apache-zookeeper-3.7.1-bin.tar.gz

# 2. è§£å‹å¯åŠ¨
tar -zxf apache-zookeeper-3.7.1-bin.tar.gz
cd apache-zookeeper-3.7.1-bin

# 3. åˆ›å»ºé…ç½®æ–‡ä»¶
cp conf/zoo_sample.cfg conf/zoo.cfg

# 4. å¯åŠ¨Zookeeper
./bin/zkServer.sh start

# 5. éªŒè¯å¯åŠ¨
./bin/zkCli.sh
```

**ğŸ“ å…³é”®é…ç½®è¯´æ˜**
```properties
# zoo.cfg æ ¸å¿ƒé…ç½®
tickTime=2000          # å¿ƒè·³æ—¶é—´ï¼Œæ¯«ç§’
dataDir=/tmp/zookeeper # æ•°æ®å­˜å‚¨ç›®å½•  
clientPort=2181        # å®¢æˆ·ç«¯è¿æ¥ç«¯å£
maxClientCnxns=60      # æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°

# ç”Ÿäº§ç¯å¢ƒå»ºè®®
dataDir=/var/zookeeper/data    # æŒä¹…åŒ–ç›®å½•
dataLogDir=/var/zookeeper/logs # æ—¥å¿—ç›®å½•
```

### 3.2 é¡¹ç›®ç¯å¢ƒå‡†å¤‡


**ğŸ“¦ Mavenä¾èµ–é…ç½®**
```xml
<!-- çˆ¶é¡¹ç›®pom.xml -->
<properties>
    <dubbo.version>3.2.0</dubbo.version>
    <spring-boot.version>2.7.0</spring-boot.version>
</properties>

<dependencies>
    <!-- Dubboæ ¸å¿ƒ -->
    <dependency>
        <groupId>org.apache.dubbo</groupId>
        <artifactId>dubbo-spring-boot-starter</artifactId>
        <version>${dubbo.version}</version>
    </dependency>
    
    <!-- Zookeeperå®¢æˆ·ç«¯ -->
    <dependency>
        <groupId>org.apache.dubbo</groupId>
        <artifactId>dubbo-dependencies-zookeeper</artifactId>
        <version>${dubbo.version}</version>
        <type>pom</type>
    </dependency>
</dependencies>
```

---

## 4. ğŸ›ï¸ æ¶æ„ä¸ç»„ä»¶äº¤äº’


### 4.1 äº¤äº’æ—¶åºè¯¦è§£


```
å¯åŠ¨æ—¶åºå›¾ï¼š

Providerå¯åŠ¨è¿‡ç¨‹ï¼š
Provider  â”‚  Registry  â”‚  Consumer  â”‚  Monitor
    â”‚     â”‚      â”‚     â”‚      â”‚     â”‚     â”‚
    â”‚ [1] â”‚ æ³¨å†ŒæœåŠ¡ä¿¡æ¯  â”‚      â”‚     â”‚     â”‚
    â”‚â”€â”€â”€â”€â†’â”‚      â”‚     â”‚      â”‚     â”‚     â”‚
    â”‚     â”‚ [2] â”‚ å­˜å‚¨æœåŠ¡åˆ—è¡¨  â”‚     â”‚     â”‚
    â”‚     â”‚â”€â”€â”€â”€â†’â”‚ Zookeeper â”‚     â”‚     â”‚
    â”‚     â”‚     â”‚      â”‚     â”‚     â”‚     â”‚

Consumerå¯åŠ¨è¿‡ç¨‹ï¼š
    â”‚     â”‚     â”‚      â”‚     â”‚     â”‚     â”‚
    â”‚     â”‚     â”‚ [3] â”‚ è®¢é˜…æœåŠ¡  â”‚     â”‚
    â”‚     â”‚     â”‚â”€â”€â”€â”€â†’â”‚      â”‚     â”‚     â”‚
    â”‚     â”‚     â”‚ [4] â”‚ è¿”å›Provideråˆ—è¡¨â”‚
    â”‚     â”‚     â”‚â†â”€â”€â”€â”€â”‚      â”‚     â”‚     â”‚

æœåŠ¡è°ƒç”¨è¿‡ç¨‹ï¼š
    â”‚     â”‚     â”‚      â”‚ [5] â”‚ é€‰æ‹©Provider â”‚
    â”‚ [6] â”‚ ç›´æ¥è°ƒç”¨æœåŠ¡  â”‚â”€â”€â”€â”€â†’â”‚     â”‚     â”‚
    â”‚â†â”€â”€â”€â”€â”‚     â”‚      â”‚     â”‚     â”‚     â”‚
    â”‚ [7] â”‚ è¿”å›ç»“æœ     â”‚     â”‚     â”‚     â”‚
    â”‚â”€â”€â”€â”€â†’â”‚     â”‚      â”‚     â”‚     â”‚     â”‚
    â”‚     â”‚     â”‚      â”‚ [8] â”‚ ä¸ŠæŠ¥è°ƒç”¨æ•°æ® â”‚
    â”‚     â”‚     â”‚      â”‚â”€â”€â”€â”€â†’â”‚     â”‚     â”‚
```

### 4.2 å…³é”®äº¤äº’è¯´æ˜


**ğŸ”„ æœåŠ¡æ³¨å†Œè¿‡ç¨‹**
```java
// Providerå¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
1. Providerè¯»å–é…ç½®ï¼Œè·å–è¦æš´éœ²çš„æœåŠ¡ä¿¡æ¯
2. è¿æ¥Registryï¼ˆZookeeperï¼‰ï¼Œåˆ›å»ºæœåŠ¡èŠ‚ç‚¹
3. å°†æœåŠ¡æ¥å£ã€ç‰ˆæœ¬ã€åœ°å€ç­‰ä¿¡æ¯å†™å…¥èŠ‚ç‚¹
4. åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼ŒProvideræ–­å¼€è¿æ¥æ—¶è‡ªåŠ¨åˆ é™¤
```

**ğŸ” æœåŠ¡å‘ç°è¿‡ç¨‹**
```java
// Consumerå¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
1. Consumerè¿æ¥Registryï¼Œè®¢é˜…éœ€è¦çš„æœåŠ¡
2. Registryè¿”å›å½“å‰å¯ç”¨çš„Provideråˆ—è¡¨
3. Consumeråœ¨æœ¬åœ°ç¼“å­˜Providerä¿¡æ¯
4. ç›‘å¬æœåŠ¡å˜æ›´ï¼Œå®æ—¶æ›´æ–°æœ¬åœ°ç¼“å­˜
```

**ğŸ“ æœåŠ¡è°ƒç”¨è¿‡ç¨‹**
```java
// æ¯æ¬¡è°ƒç”¨æ—¶çš„æµç¨‹
1. Consumerä»æœ¬åœ°ç¼“å­˜é€‰æ‹©ä¸€ä¸ªProvider
2. åºåˆ—åŒ–è°ƒç”¨å‚æ•°ï¼Œå‘é€ç½‘ç»œè¯·æ±‚
3. Provideræ¥æ”¶è¯·æ±‚ï¼Œååºåˆ—åŒ–å‚æ•°
4. æ‰§è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›ç»“æœ
5. åºåˆ—åŒ–è¿”å›å€¼ï¼Œå‘é€ç»™Consumer
6. Consumerååºåˆ—åŒ–ç»“æœï¼Œè¿”å›ç»™è°ƒç”¨æ–¹
```

---

## 5. ğŸ­ æœåŠ¡æä¾›è€…å®ç°


### 5.1 å®šä¹‰æœåŠ¡æ¥å£


```java
/**
 * ç”¨æˆ·æœåŠ¡æ¥å£ - å®šä¹‰èƒ½åšä»€ä¹ˆ
 * è¿™ä¸ªæ¥å£Providerå’ŒConsumeréƒ½éœ€è¦
 */
public interface UserService {
    /**
     * æ ¹æ®IDè·å–ç”¨æˆ·ä¿¡æ¯
     * @param userId ç”¨æˆ·ID
     * @return ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰¾ä¸åˆ°è¿”å›null
     */
    User getUserById(Long userId);
    
    /**
     * åˆ›å»ºæ–°ç”¨æˆ·
     * @param user ç”¨æˆ·ä¿¡æ¯
     * @return æ˜¯å¦åˆ›å»ºæˆåŠŸ
     */
    boolean createUser(User user);
    
    /**
     * æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯
     * @param userIds ç”¨æˆ·IDåˆ—è¡¨
     * @return ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨
     */
    List<User> batchGetUsers(List<Long> userIds);
}
```

### 5.2 å®ç°æœåŠ¡é€»è¾‘


```java
/**
 * ç”¨æˆ·æœåŠ¡å®ç° - å…·ä½“æ€ä¹ˆåš
 * åªåœ¨Providerç«¯å­˜åœ¨
 */
@Service  // Dubboçš„@Serviceæ³¨è§£ï¼Œè¡¨ç¤ºè¦æš´éœ²çš„æœåŠ¡
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Override
    public User getUserById(Long userId) {
        System.out.println("Providerå¤„ç†è¯·æ±‚ï¼šgetUserById = " + userId);
        
        // å‚æ•°æ ¡éªŒ
        if (userId == null || userId <= 0) {
            throw new IllegalArgumentException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©ºæˆ–å°äºç­‰äº0");
        }
        
        // æŸ¥è¯¢æ•°æ®åº“
        User user = userRepository.findById(userId);
        
        // æ—¥å¿—è®°å½•
        System.out.println("æŸ¥è¯¢ç»“æœï¼š" + (user != null ? "æ‰¾åˆ°ç”¨æˆ·" : "ç”¨æˆ·ä¸å­˜åœ¨"));
        
        return user;
    }
    
    @Override
    public boolean createUser(User user) {
        System.out.println("Providerå¤„ç†è¯·æ±‚ï¼šcreateUser = " + user.getName());
        
        // ä¸šåŠ¡é€»è¾‘ï¼šä¿å­˜åˆ°æ•°æ®åº“
        try {
            userRepository.save(user);
            return true;
        } catch (Exception e) {
            System.err.println("åˆ›å»ºç”¨æˆ·å¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
    
    @Override
    public List<User> batchGetUsers(List<Long> userIds) {
        System.out.println("æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·ï¼š" + userIds.size() + "ä¸ª");
        return userRepository.findByIdIn(userIds);
    }
}
```

### 5.3 Provideré…ç½®


```yaml
# application.yml - Provideré…ç½®
dubbo:
  application:
    name: user-provider        # åº”ç”¨åç§°
    qos-enable: false         # å…³é—­QOSç«¯å£ï¼ˆå¯é€‰ï¼‰
  
  registry:
    address: zookeeper://localhost:2181  # æ³¨å†Œä¸­å¿ƒåœ°å€
    timeout: 3000                        # è¿æ¥è¶…æ—¶
  
  protocol:
    name: dubbo               # åè®®åç§°
    port: 20880              # æœåŠ¡ç«¯å£
    threads: 200             # çº¿ç¨‹æ± å¤§å°
  
  provider:
    timeout: 5000            # è°ƒç”¨è¶…æ—¶æ—¶é—´
    retries: 0               # é‡è¯•æ¬¡æ•°ï¼ˆProviderä¸€èˆ¬è®¾ä¸º0ï¼‰
    filter: -exception       # è¿‡æ»¤å™¨é…ç½®

# æ•°æ®åº“ç­‰å…¶ä»–é…ç½®
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/dubbo_demo
    username: root
    password: 123456
```

### 5.4 å¯åŠ¨Provideråº”ç”¨


```java
/**
 * Providerå¯åŠ¨ç±»
 */
@SpringBootApplication
@EnableDubbo  // å¯ç”¨DubboåŠŸèƒ½
public class ProviderApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(ProviderApplication.class, args);
        System.out.println("=================================");
        System.out.println("ç”¨æˆ·æœåŠ¡Providerå¯åŠ¨æˆåŠŸï¼");
        System.out.println("æœåŠ¡åœ°å€ï¼šdubbo://localhost:20880");
        System.out.println("=================================");
        
        // ä¿æŒè¿›ç¨‹ä¸é€€å‡º
        System.in.read();
    }
}
```

---

## 6. ğŸ›’ æœåŠ¡æ¶ˆè´¹è€…å®ç°


### 6.1 å¼•ç”¨è¿œç¨‹æœåŠ¡


```java
/**
 * ç”¨æˆ·æ§åˆ¶å™¨ - Consumerç«¯
 */
@RestController
@RequestMapping("/users")
public class UserController {
    
    /**
     * å¼•ç”¨è¿œç¨‹æœåŠ¡ - æ ¸å¿ƒé…ç½®
     * çœ‹èµ·æ¥åƒæœ¬åœ°å¯¹è±¡ï¼Œå®é™…æ˜¯è¿œç¨‹è°ƒç”¨çš„ä»£ç†
     */
    @Reference(
        timeout = 3000,      // è°ƒç”¨è¶…æ—¶æ—¶é—´
        retries = 2,         // é‡è¯•æ¬¡æ•°
        check = false        // å¯åŠ¨æ—¶ä¸æ£€æŸ¥Provideræ˜¯å¦å­˜åœ¨
    )
    private UserService userService;
    
    /**
     * HTTPæ¥å£ï¼šæ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
     */
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        try {
            System.out.println("Consumeræ¥æ”¶è¯·æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ· " + id);
            
            // è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•
            User user = userService.getUserById(id);
            
            if (user != null) {
                return ResponseEntity.ok(user);
            } else {
                return ResponseEntity.notFound().build();
            }
            
        } catch (Exception e) {
            System.err.println("è°ƒç”¨ç”¨æˆ·æœåŠ¡å¤±è´¥ï¼š" + e.getMessage());
            return ResponseEntity.status(500).build();
        }
    }
    
    /**
     * HTTPæ¥å£ï¼šåˆ›å»ºç”¨æˆ·
     */
    @PostMapping
    public ResponseEntity<String> createUser(@RequestBody User user) {
        try {
            System.out.println("Consumeræ¥æ”¶è¯·æ±‚ï¼šåˆ›å»ºç”¨æˆ· " + user.getName());
            
            // è¿œç¨‹è°ƒç”¨åˆ›å»ºç”¨æˆ·
            boolean success = userService.createUser(user);
            
            if (success) {
                return ResponseEntity.ok("ç”¨æˆ·åˆ›å»ºæˆåŠŸ");
            } else {
                return ResponseEntity.status(500).body("ç”¨æˆ·åˆ›å»ºå¤±è´¥");
            }
            
        } catch (Exception e) {
            return ResponseEntity.status(500).body("æœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼š" + e.getMessage());
        }
    }
}
```

### 6.2 Consumeré…ç½®


```yaml
# application.yml - Consumeré…ç½®
server:
  port: 8080                 # WebæœåŠ¡ç«¯å£

dubbo:
  application:
    name: user-consumer      # åº”ç”¨åç§°
  
  registry:
    address: zookeeper://localhost:2181  # æ³¨å†Œä¸­å¿ƒåœ°å€
    check: false                         # å¯åŠ¨æ—¶ä¸æ£€æŸ¥æ³¨å†Œä¸­å¿ƒè¿æ¥
  
  consumer:
    timeout: 3000            # å…¨å±€è°ƒç”¨è¶…æ—¶
    retries: 2               # å…¨å±€é‡è¯•æ¬¡æ•°
    check: false             # å¯åŠ¨æ—¶ä¸æ£€æŸ¥Provider
    
  # è¿æ¥é…ç½®
  reference:
    check: false             # å¼•ç”¨æœåŠ¡æ—¶ä¸æ£€æŸ¥Provider
    lazy: true              # å»¶è¿Ÿåˆå§‹åŒ–
```

### 6.3 å¯åŠ¨Consumeråº”ç”¨


```java
/**
 * Consumerå¯åŠ¨ç±»
 */
@SpringBootApplication
@EnableDubbo  // å¯ç”¨DubboåŠŸèƒ½
public class ConsumerApplication {
    
    public static void main(String[] args) {
        SpringApplication.run(ConsumerApplication.class, args);
        System.out.println("=================================");
        System.out.println("ç”¨æˆ·æœåŠ¡Consumerå¯åŠ¨æˆåŠŸï¼");
        System.out.println("è®¿é—®åœ°å€ï¼šhttp://localhost:8080");
        System.out.println("æµ‹è¯•æ¥å£ï¼š");
        System.out.println("  GET  /users/1    - æŸ¥è¯¢ç”¨æˆ·");
        System.out.println("  POST /users      - åˆ›å»ºç”¨æˆ·");
        System.out.println("=================================");
    }
}
```

### 6.4 è°ƒç”¨éªŒè¯


**ğŸ§ª æµ‹è¯•è°ƒç”¨è¿‡ç¨‹**
```bash
# 1. æŸ¥è¯¢ç”¨æˆ·æµ‹è¯•
curl http://localhost:8080/users/1

# æ§åˆ¶å°è¾“å‡ºæµç¨‹ï¼š
Consumeræ¥æ”¶è¯·æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ· 1
Providerå¤„ç†è¯·æ±‚ï¼šgetUserById = 1
æŸ¥è¯¢ç»“æœï¼šæ‰¾åˆ°ç”¨æˆ·
HTTPè¿”å›ï¼š{"id":1,"name":"å¼ ä¸‰","email":"zhangsan@example.com"}

# 2. åˆ›å»ºç”¨æˆ·æµ‹è¯•  
curl -X POST http://localhost:8080/users \
     -H "Content-Type: application/json" \
     -d '{"name":"æå››","email":"lisi@example.com"}'

# æ§åˆ¶å°è¾“å‡ºï¼š
Consumeræ¥æ”¶è¯·æ±‚ï¼šåˆ›å»ºç”¨æˆ· æå››
Providerå¤„ç†è¯·æ±‚ï¼šcreateUser = æå››
HTTPè¿”å›ï¼šç”¨æˆ·åˆ›å»ºæˆåŠŸ
```

---

## 7. ğŸ›ï¸ é«˜çº§é…ç½®ç‰¹æ€§


### 7.1 å¤šç‰ˆæœ¬æœåŠ¡


**ğŸ”¸ åœºæ™¯è¯´æ˜**
```
ä¸šåŠ¡åœºæ™¯ï¼šç”¨æˆ·æœåŠ¡éœ€è¦å‡çº§ï¼Œä½†ä¸èƒ½å½±å“çº¿ä¸ŠæœåŠ¡
è§£å†³æ–¹æ¡ˆï¼šåŒæ—¶éƒ¨ç½²v1.0å’Œv2.0ç‰ˆæœ¬ï¼Œé€æ­¥åˆ‡æ¢

ç‰ˆæœ¬éš”ç¦»ï¼š
â€¢ Providerç«¯ï¼šåŒä¸€æœåŠ¡æä¾›å¤šä¸ªç‰ˆæœ¬å®ç°  
â€¢ Consumerç«¯ï¼šæŒ‡å®šè°ƒç”¨ç‰¹å®šç‰ˆæœ¬
â€¢ ç°åº¦å‘å¸ƒï¼šéƒ¨åˆ†æµé‡è°ƒç”¨æ–°ç‰ˆæœ¬æµ‹è¯•
```

**ğŸ”§ Providerå¤šç‰ˆæœ¬é…ç½®**
```java
// ç”¨æˆ·æœåŠ¡V1.0ç‰ˆæœ¬
@Service(version = "1.0")  // æŒ‡å®šæœåŠ¡ç‰ˆæœ¬
public class UserServiceV1 implements UserService {
    
    @Override
    public User getUserById(Long userId) {
        System.out.println("V1.0ç‰ˆæœ¬å¤„ç†è¯·æ±‚ï¼š" + userId);
        // è€ç‰ˆæœ¬çš„ä¸šåŠ¡é€»è¾‘
        return getUserFromCache(userId);  // ä»ç¼“å­˜è·å–
    }
}

// ç”¨æˆ·æœåŠ¡V2.0ç‰ˆæœ¬  
@Service(version = "2.0")  // æ–°ç‰ˆæœ¬
public class UserServiceV2 implements UserService {
    
    @Override
    public User getUserById(Long userId) {
        System.out.println("V2.0ç‰ˆæœ¬å¤„ç†è¯·æ±‚ï¼š" + userId);
        // æ–°ç‰ˆæœ¬çš„ä¸šåŠ¡é€»è¾‘
        return getUserFromDatabase(userId);  // ä»æ•°æ®åº“è·å–æ›´è¯¦ç»†ä¿¡æ¯
    }
}
```

**ğŸ”§ Consumerç‰ˆæœ¬é€‰æ‹©**
```java
@RestController
public class UserController {
    
    // è°ƒç”¨ç¨³å®šçš„1.0ç‰ˆæœ¬
    @Reference(version = "1.0")
    private UserService userServiceV1;
    
    // è°ƒç”¨æ–°çš„2.0ç‰ˆæœ¬  
    @Reference(version = "2.0") 
    private UserService userServiceV2;
    
    // æ ¹æ®è¯·æ±‚å‚æ•°é€‰æ‹©ç‰ˆæœ¬
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id, 
                       @RequestParam(defaultValue = "1.0") String version) {
        
        if ("2.0".equals(version)) {
            return userServiceV2.getUserById(id);  // è°ƒç”¨2.0ç‰ˆæœ¬
        } else {
            return userServiceV1.getUserById(id);  // è°ƒç”¨1.0ç‰ˆæœ¬  
        }
    }
}
```

### 7.2 æœåŠ¡åˆ†ç»„


**ğŸ”¸ åº”ç”¨åœºæ™¯**
```
ä¸šåŠ¡èƒŒæ™¯ï¼šåŒä¸€ä¸ªæ¥å£åœ¨ä¸åŒç¯å¢ƒæˆ–ä¸šåŠ¡çº¿æœ‰ä¸åŒå®ç°
å…¸å‹ä¾‹å­ï¼š
â€¢ æ”¯ä»˜æœåŠ¡ï¼šå¾®ä¿¡æ”¯ä»˜ç»„ã€æ”¯ä»˜å®æ”¯ä»˜ç»„
â€¢ ç”¨æˆ·æœåŠ¡ï¼šå†…éƒ¨ç”¨æˆ·ç»„ã€å¤–éƒ¨ç”¨æˆ·ç»„  
â€¢ æ•°æ®æœåŠ¡ï¼šä¸»åº“ç»„ã€ä»åº“ç»„
```

**ğŸ”§ åˆ†ç»„é…ç½®ç¤ºä¾‹**
```java
// å†…éƒ¨ç”¨æˆ·æœåŠ¡ï¼ˆå‘˜å·¥ã€å†…éƒ¨ç³»ç»Ÿä½¿ç”¨ï¼‰
@Service(group = "internal")
public class InternalUserService implements UserService {
    
    @Override
    public User getUserById(Long userId) {
        System.out.println("å†…éƒ¨ç”¨æˆ·æœåŠ¡å¤„ç†ï¼š" + userId);
        // è¿”å›è¯¦ç»†çš„å†…éƒ¨ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å«æƒé™ã€éƒ¨é—¨ç­‰ï¼‰
        return getFullUserInfo(userId);
    }
}

// å¤–éƒ¨ç”¨æˆ·æœåŠ¡ï¼ˆå®¢æˆ·ã€ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰
@Service(group = "external")  
public class ExternalUserService implements UserService {
    
    @Override
    public User getUserById(Long userId) {
        System.out.println("å¤–éƒ¨ç”¨æˆ·æœåŠ¡å¤„ç†ï¼š" + userId);
        // è¿”å›è„±æ•çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆéšç§ä¿æŠ¤ï¼‰
        return getPublicUserInfo(userId);
    }
}
```

```java
// Consumerç«¯æŒ‰åˆ†ç»„è°ƒç”¨
@RestController
public class UserController {
    
    @Reference(group = "internal")  // è°ƒç”¨å†…éƒ¨ç”¨æˆ·æœåŠ¡
    private UserService internalUserService;
    
    @Reference(group = "external")  // è°ƒç”¨å¤–éƒ¨ç”¨æˆ·æœåŠ¡
    private UserService externalUserService;
    
    // å†…éƒ¨æ¥å£ï¼šè¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯
    @GetMapping("/internal/users/{id}")
    public User getInternalUser(@PathVariable Long id) {
        return internalUserService.getUserById(id);
    }
    
    // å¤–éƒ¨æ¥å£ï¼šè¿”å›è„±æ•ç”¨æˆ·ä¿¡æ¯
    @GetMapping("/api/users/{id}")
    public User getPublicUser(@PathVariable Long id) {
        return externalUserService.getUserById(id);
    }
}
```

### 7.3 æ³›åŒ–è°ƒç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ³›åŒ–è°ƒç”¨**
```
å¸¸è§„è°ƒç”¨ï¼šConsumeréœ€è¦ä¾èµ–Providerçš„æ¥å£JARåŒ…
æ³›åŒ–è°ƒç”¨ï¼šConsumerä¸ä¾èµ–æ¥å£JARï¼Œé€šè¿‡å­—ç¬¦ä¸²å’ŒMapåŠ¨æ€è°ƒç”¨

é€‚ç”¨åœºæ™¯ï¼š
â€¢ ç½‘å…³æœåŠ¡ï¼šä¸å¯èƒ½ä¾èµ–æ‰€æœ‰æœåŠ¡çš„æ¥å£
â€¢ æµ‹è¯•å·¥å…·ï¼šåŠ¨æ€è°ƒç”¨å„ç§æœåŠ¡è¿›è¡Œæµ‹è¯•
â€¢ ç›‘æ§å¹³å°ï¼šé€šç”¨çš„æœåŠ¡è°ƒç”¨èƒ½åŠ›
```

**ğŸ”§ æ³›åŒ–è°ƒç”¨å®ç°**
```java
/**
 * ç½‘å…³æœåŠ¡ï¼šåŠ¨æ€è°ƒç”¨ä»»æ„DubboæœåŠ¡
 */
@RestController
@RequestMapping("/gateway")
public class GatewayController {
    
    @Autowired
    private ApplicationContext applicationContext;
    
    /**
     * é€šç”¨æœåŠ¡è°ƒç”¨æ¥å£
     * POST /gateway/invoke
     * Body: {
     *   "interface": "com.example.UserService",
     *   "method": "getUserById", 
     *   "parameterTypes": ["java.lang.Long"],
     *   "arguments": [123]
     * }
     */
    @PostMapping("/invoke")
    public Object invokeService(@RequestBody Map<String, Object> request) {
        
        // 1. è§£æè¯·æ±‚å‚æ•°
        String interfaceName = (String) request.get("interface");
        String methodName = (String) request.get("method");
        List<String> parameterTypes = (List<String>) request.get("parameterTypes");
        List<Object> arguments = (List<Object>) request.get("arguments");
        
        try {
            // 2. åˆ›å»ºæ³›åŒ–æœåŠ¡å¼•ç”¨
            ReferenceConfig<GenericService> reference = new ReferenceConfig<>();
            reference.setInterface(interfaceName);  // æ¥å£å
            reference.setGeneric(true);             // å¯ç”¨æ³›åŒ–è°ƒç”¨
            reference.setApplication(applicationContext.getBean(ApplicationConfig.class));
            reference.setRegistry(applicationContext.getBean(RegistryConfig.class));
            
            // 3. è·å–æ³›åŒ–æœåŠ¡
            GenericService genericService = reference.get();
            
            // 4. æ‰§è¡Œæ³›åŒ–è°ƒç”¨
            Object result = genericService.$invoke(
                methodName,                              // æ–¹æ³•å
                parameterTypes.toArray(new String[0]),   // å‚æ•°ç±»å‹æ•°ç»„
                arguments.toArray()                      // å‚æ•°å€¼æ•°ç»„
            );
            
            System.out.println("æ³›åŒ–è°ƒç”¨æˆåŠŸï¼š" + interfaceName + "." + methodName);
            return result;
            
        } catch (Exception e) {
            System.err.println("æ³›åŒ–è°ƒç”¨å¤±è´¥ï¼š" + e.getMessage());
            throw new RuntimeException("æœåŠ¡è°ƒç”¨å¤±è´¥", e);
        }
    }
}
```

### 7.4 å›å£°æµ‹è¯•


**ğŸ”¸ å›å£°æµ‹è¯•ç”¨é€”**
```
ç›®çš„ï¼šæ£€æµ‹æœåŠ¡è¿æ¥å’Œé€šä¿¡æ˜¯å¦æ­£å¸¸
åŸç†ï¼šä»»ä½•DubboæœåŠ¡éƒ½è‡ªåŠ¨æ”¯æŒå›å£°æµ‹è¯•
ç”¨æ³•ï¼šè°ƒç”¨$echoæ–¹æ³•ï¼Œä¼ å…¥ä»»æ„å‚æ•°ï¼ŒåŸæ ·è¿”å›

åº”ç”¨åœºæ™¯ï¼š
â€¢ å¥åº·æ£€æŸ¥ï¼šå®šæœŸæ£€æµ‹æœåŠ¡æ˜¯å¦å¯ç”¨
â€¢ ç½‘ç»œè¯Šæ–­ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸  
â€¢ è´Ÿè½½æµ‹è¯•ï¼šæµ‹è¯•æœåŠ¡å“åº”æ€§èƒ½
```

**ğŸ”§ å›å£°æµ‹è¯•å®ç°**
```java
/**
 * æœåŠ¡å¥åº·æ£€æŸ¥å·¥å…·
 */
@Component
public class ServiceHealthChecker {
    
    @Reference
    private UserService userService;
    
    /**
     * æ£€æŸ¥ç”¨æˆ·æœåŠ¡æ˜¯å¦å¥åº·
     */
    public boolean checkUserServiceHealth() {
        try {
            // å›å£°æµ‹è¯•ï¼šä¼ å…¥ä»€ä¹ˆè¿”å›ä»€ä¹ˆ
            EchoService echoService = (EchoService) userService;
            Object result = echoService.$echo("å¥åº·æ£€æŸ¥-" + System.currentTimeMillis());
            
            System.out.println("å›å£°æµ‹è¯•ç»“æœï¼š" + result);
            return result != null;
            
        } catch (Exception e) {
            System.err.println("æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥ï¼š" + e.getMessage());
            return false;
        }
    }
    
    /**
     * æ‰¹é‡æ£€æŸ¥å¤šä¸ªæœåŠ¡å¥åº·çŠ¶æ€
     */
    @Scheduled(fixedRate = 30000)  // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void batchHealthCheck() {
        Map<String, Boolean> healthStatus = new HashMap<>();
        
        // æ£€æŸ¥ç”¨æˆ·æœåŠ¡
        healthStatus.put("UserService", checkUserServiceHealth());
        
        // æ£€æŸ¥å…¶ä»–æœåŠ¡...
        // healthStatus.put("OrderService", checkOrderServiceHealth());
        
        // è¾“å‡ºå¥åº·æŠ¥å‘Š
        System.out.println("=== æœåŠ¡å¥åº·çŠ¶æ€æŠ¥å‘Š ===");
        healthStatus.forEach((service, status) -> {
            System.out.println(service + ": " + (status ? "âœ… å¥åº·" : "âŒ å¼‚å¸¸"));
        });
    }
}
```

---

## 8. ğŸ”§ æ‰©å±•æœºåˆ¶è¯¦è§£


### 8.1 SPIæ‰©å±•åŸç†


**ğŸ”¸ ä»€ä¹ˆæ˜¯SPI**
```
SPIå…¨ç§°ï¼šService Provider Interfaceï¼ˆæœåŠ¡æä¾›å•†æ¥å£ï¼‰
ä½œç”¨ï¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å®ç°ç±»ï¼Œæ”¯æŒæ’ä»¶åŒ–æ‰©å±•

Dubbo SPI vs Java SPIï¼š
Java SPIï¼š
â€¢ ä¸€æ¬¡åŠ è½½æ‰€æœ‰å®ç°ç±»ï¼Œæµªè´¹èµ„æº
â€¢ ä¸æ”¯æŒä¾èµ–æ³¨å…¥
â€¢ æ‰©å±•ç‚¹è·å–æ–¹å¼å•ä¸€

Dubbo SPIï¼š
â€¢ æŒ‰éœ€åŠ è½½ï¼ŒèŠ‚çº¦èµ„æº
â€¢ æ”¯æŒä¾èµ–æ³¨å…¥å’ŒAOP
â€¢ æ”¯æŒæ‰©å±•ç‚¹è‡ªåŠ¨æ¿€æ´»
â€¢ æ›´å¥½çš„å¼‚å¸¸å¤„ç†
```

**ğŸ”¸ æ‰©å±•ç‚¹ç±»å‹**
```
Dubboå†…ç½®æ‰©å±•ç‚¹ï¼š
â€¢ Protocolï¼šé€šä¿¡åè®®ï¼ˆdubboã€httpã€restç­‰ï¼‰
â€¢ Registryï¼šæ³¨å†Œä¸­å¿ƒï¼ˆzookeeperã€redisã€multicastç­‰ï¼‰  
â€¢ Filterï¼šè°ƒç”¨è¿‡æ»¤å™¨ï¼ˆç¼“å­˜ã€ç›‘æ§ã€é™æµç­‰ï¼‰
â€¢ LoadBalanceï¼šè´Ÿè½½å‡è¡¡ï¼ˆéšæœºã€è½®è¯¢ã€æƒé‡ç­‰ï¼‰
â€¢ Routerï¼šè·¯ç”±è§„åˆ™ï¼ˆæ¡ä»¶è·¯ç”±ã€è„šæœ¬è·¯ç”±ç­‰ï¼‰
```

### 8.2 è‡ªå®šä¹‰Filteræ‰©å±•


**ğŸ”¸ åº”ç”¨åœºæ™¯**
```
Filterç”¨é€”ï¼šåœ¨æœåŠ¡è°ƒç”¨å‰åè¿›è¡Œæ‹¦æˆªå¤„ç†
å¸¸è§éœ€æ±‚ï¼š
â€¢ è¯·æ±‚æ—¥å¿—è®°å½•  
â€¢ è°ƒç”¨æ—¶é—´ç»Ÿè®¡
â€¢ å‚æ•°æ ¡éªŒ
â€¢ æƒé™æ£€æŸ¥
â€¢ é™æµæ§åˆ¶
```

**ğŸ”§ å®ç°è‡ªå®šä¹‰Filter**
```java
/**
 * è‡ªå®šä¹‰è°ƒç”¨æ—¶é—´ç»Ÿè®¡Filter
 */
@Activate(group = {CONSUMER, PROVIDER})  // åœ¨Consumerå’ŒProviderç«¯éƒ½ç”Ÿæ•ˆ
public class TimeCountFilter implements Filter {
    
    private static final Logger logger = LoggerFactory.getLogger(TimeCountFilter.class);
    
    @Override
    public Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException {
        
        // è®°å½•å¼€å§‹æ—¶é—´
        long startTime = System.currentTimeMillis();
        
        // è·å–è°ƒç”¨ä¿¡æ¯
        String interfaceName = invoker.getInterface().getSimpleName();
        String methodName = invocation.getMethodName();
        String side = RpcContext.getContext().isProviderSide() ? "Provider" : "Consumer";
        
        logger.info("{}ç«¯å¼€å§‹è°ƒç”¨ï¼š{}.{}", side, interfaceName, methodName);
        
        try {
            // æ‰§è¡Œå®é™…è°ƒç”¨
            Result result = invoker.invoke(invocation);
            
            // è®¡ç®—è°ƒç”¨æ—¶é—´
            long duration = System.currentTimeMillis() - startTime;
            
            // è®°å½•æˆåŠŸè°ƒç”¨
            logger.info("{}ç«¯è°ƒç”¨æˆåŠŸï¼š{}.{} è€—æ—¶{}ms", 
                       side, interfaceName, methodName, duration);
            
            // æ…¢æŸ¥è¯¢å‘Šè­¦ï¼ˆè¶…è¿‡1ç§’ï¼‰
            if (duration > 1000) {
                logger.warn("âš ï¸ æ…¢è°ƒç”¨å‘Šè­¦ï¼š{}.{} è€—æ—¶{}ms", 
                           interfaceName, methodName, duration);
            }
            
            return result;
            
        } catch (Exception e) {
            long duration = System.currentTimeMillis() - startTime;
            logger.error("{}ç«¯è°ƒç”¨å¤±è´¥ï¼š{}.{} è€—æ—¶{}ms é”™è¯¯ï¼š{}", 
                        side, interfaceName, methodName, duration, e.getMessage());
            throw e;
        }
    }
}
```

**ğŸ“ æ³¨å†ŒFilteræ‰©å±•**
```properties
# resources/META-INF/dubbo/org.apache.dubbo.rpc.Filter
timecount=com.example.filter.TimeCountFilter
```

**âš™ï¸ é…ç½®ä½¿ç”¨Filter**
```yaml
# application.yml
dubbo:
  provider:
    filter: timecount,default  # å¯ç”¨è‡ªå®šä¹‰Filterå’Œé»˜è®¤Filter
  consumer:  
    filter: timecount,default
```

### 8.3 è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡æ‰©å±•


**ğŸ”§ å®ç°åŠ æƒéšæœºè´Ÿè½½å‡è¡¡**
```java
/**
 * è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ï¼šæ ¹æ®Providerå“åº”æ—¶é—´åŠ¨æ€è°ƒæ•´æƒé‡
 */
public class ResponseTimeLoadBalance extends AbstractLoadBalance {
    
    public static final String NAME = "responsetime";
    
    private final ConcurrentHashMap<String, Long> responseTimeMap = new ConcurrentHashMap<>();
    
    @Override
    protected <T> Invoker<T> doSelect(List<Invoker<T>> invokers, URL url, Invocation invocation) {
        
        int length = invokers.size();
        if (length == 1) {
            return invokers.get(0);  // åªæœ‰ä¸€ä¸ªProviderç›´æ¥è¿”å›
        }
        
        // è®¡ç®—æƒé‡ï¼šå“åº”æ—¶é—´è¶ŠçŸ­æƒé‡è¶Šé«˜
        int[] weights = new int[length];
        int totalWeight = 0;
        
        for (int i = 0; i < length; i++) {
            Invoker<T> invoker = invokers.get(i);
            String key = invoker.getUrl().getAddress();
            
            // è·å–å¹³å‡å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            Long avgResponseTime = responseTimeMap.getOrDefault(key, 100L);
            
            // æƒé‡è®¡ç®—ï¼š1000ms / å“åº”æ—¶é—´ï¼Œå“åº”æ—¶é—´è¶ŠçŸ­æƒé‡è¶Šå¤§
            int weight = (int) (1000 / Math.max(avgResponseTime, 10));
            weights[i] = weight;
            totalWeight += weight;
        }
        
        // åŠ æƒéšæœºé€‰æ‹©
        if (totalWeight > 0) {
            int randomWeight = ThreadLocalRandom.current().nextInt(totalWeight);
            for (int i = 0; i < length; i++) {
                randomWeight -= weights[i];
                if (randomWeight < 0) {
                    return invokers.get(i);
                }
            }
        }
        
        // å…œåº•ï¼šéšæœºé€‰æ‹©
        return invokers.get(ThreadLocalRandom.current().nextInt(length));
    }
    
    /**
     * æ›´æ–°Providerå“åº”æ—¶é—´ç»Ÿè®¡
     */
    public void updateResponseTime(String address, long responseTime) {
        responseTimeMap.compute(address, (key, oldValue) -> {
            if (oldValue == null) {
                return responseTime;
            }
            // ç§»åŠ¨å¹³å‡ï¼šæ–°å“åº”æ—¶é—´æƒé‡30%ï¼Œå†å²å¹³å‡æƒé‡70%
            return (long) (oldValue * 0.7 + responseTime * 0.3);
        });
    }
}
```

**ğŸ“ æ³¨å†Œè´Ÿè½½å‡è¡¡æ‰©å±•**
```properties
# resources/META-INF/dubbo/org.apache.dubbo.rpc.cluster.LoadBalance
responsetime=com.example.loadbalance.ResponseTimeLoadBalance
```

---

## 9. âš™ï¸ é…ç½®æ–¹å¼å¯¹æ¯”


### 9.1 XMLé…ç½®æ–¹å¼


**ğŸ”¸ é€‚ç”¨åœºæ™¯**ï¼šä¼ ç»ŸSpringé¡¹ç›®ï¼Œé…ç½®é›†ä¸­ç®¡ç†

```xml
<!-- dubbo-provider.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:dubbo="http://dubbo.apache.org/schema/dubbo">
    
    <!-- åº”ç”¨é…ç½® -->
    <dubbo:application name="user-provider" />
    
    <!-- æ³¨å†Œä¸­å¿ƒé…ç½® -->
    <dubbo:registry address="zookeeper://localhost:2181" timeout="3000" />
    
    <!-- åè®®é…ç½® -->
    <dubbo:protocol name="dubbo" port="20880" threads="200" />
    
    <!-- æœåŠ¡æš´éœ² -->
    <dubbo:service interface="com.example.UserService" 
                   ref="userService" 
                   version="1.0"
                   timeout="5000" 
                   retries="0" />
    
    <!-- æœåŠ¡å®ç°Bean -->
    <bean id="userService" class="com.example.UserServiceImpl" />
    
</beans>
```

### 9.2 æ³¨è§£é…ç½®æ–¹å¼


**ğŸ”¸ é€‚ç”¨åœºæ™¯**ï¼šSpring Booté¡¹ç›®ï¼Œé…ç½®åˆ†æ•£åˆ°ä»£ç ä¸­

```java
// Providerç«¯
@Service(version = "1.0", timeout = 5000)
public class UserServiceImpl implements UserService {
    // æœåŠ¡å®ç°
}

// Consumerç«¯  
@Component
public class UserController {
    
    @Reference(version = "1.0", timeout = 3000, retries = 2)
    private UserService userService;
}

// å¯åŠ¨ç±»
@SpringBootApplication
@EnableDubbo(scanBasePackages = "com.example")
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### 9.3 é…ç½®æ–‡ä»¶æ–¹å¼


**ğŸ”¸ é€‚ç”¨åœºæ™¯**ï¼šSpring Booté¡¹ç›®ï¼Œå¤–éƒ¨åŒ–é…ç½®

```yaml
# application.yml
dubbo:
  application:
    name: user-provider
    qos-enable: false
    
  registry:
    address: zookeeper://localhost:2181
    timeout: 3000
    check: false
    
  protocol:
    name: dubbo
    port: 20880
    threads: 200
    
  provider:
    timeout: 5000
    retries: 0
    filter: default,timecount
    
  consumer:
    timeout: 3000  
    retries: 2
    check: false
```

### 9.4 é…ç½®æ–¹å¼é€‰æ‹©


| é…ç½®æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ“‹ **XMLé…ç½®** | `é…ç½®é›†ä¸­ã€ç»“æ„æ¸…æ™°` | `é…ç½®æ–‡ä»¶è¾ƒå¤šã€ç»´æŠ¤å¤æ‚` | `ä¼ ç»ŸSpringé¡¹ç›®` |
| ğŸ¯ **æ³¨è§£é…ç½®** | `é…ç½®å°±è¿‘ã€ä»£ç ç®€æ´` | `é…ç½®åˆ†æ•£ã€ä¸æ˜“ç»Ÿä¸€ç®¡ç†` | `ç®€å•çš„Spring Booté¡¹ç›®` |
| âš™ï¸ **é…ç½®æ–‡ä»¶** | `å¤–éƒ¨åŒ–é…ç½®ã€ç¯å¢ƒéš”ç¦»` | `é…ç½®é¡¹è¾ƒå¤šæ—¶å±‚æ¬¡å¤æ‚` | `å¤æ‚çš„ç”Ÿäº§ç¯å¢ƒ` |
| ğŸ”§ **æ··åˆé…ç½®** | `çµæ´»æ€§æœ€å¥½ã€å„å–æ‰€é•¿` | `å­¦ä¹ æˆæœ¬é«˜ã€è§„èŒƒè¦æ±‚ä¸¥æ ¼` | `å¤§å‹ä¼ä¸šé¡¹ç›®` |

---

## 10. ğŸ“Š è¿ç»´å·¥å…·ä¸ç›‘æ§


### 10.1 Dubbo Adminç®¡ç†æ§åˆ¶å°


**ğŸ”¸ Dubbo AdminåŠŸèƒ½**
```
æœåŠ¡æ²»ç†åŠŸèƒ½ï¼š
âœ… æœåŠ¡æŸ¥è¯¢ï¼šæŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„æœåŠ¡
âœ… æœåŠ¡è¯¦æƒ…ï¼šæŸ¥çœ‹æœåŠ¡çš„Providerå’ŒConsumerä¿¡æ¯
âœ… æœåŠ¡æµ‹è¯•ï¼šåœ¨çº¿æµ‹è¯•æœåŠ¡æ¥å£
âœ… è·¯ç”±è§„åˆ™ï¼šé…ç½®æœåŠ¡è·¯ç”±å’Œè´Ÿè½½å‡è¡¡
âœ… é…ç½®ç®¡ç†ï¼šåŠ¨æ€ä¿®æ”¹æœåŠ¡é…ç½®
âœ… è®¿é—®æ§åˆ¶ï¼šæœåŠ¡çš„é»‘ç™½åå•ç®¡ç†
```

**ğŸ”§ éƒ¨ç½²Dubbo Admin**
```bash
# 1. ä¸‹è½½æºç 
git clone https://github.com/apache/dubbo-admin.git
cd dubbo-admin

# 2. ä¿®æ”¹é…ç½®
vim dubbo-admin-server/src/main/resources/application.properties

# é…ç½®æ³¨å†Œä¸­å¿ƒ
admin.registry.address=zookeeper://localhost:2181
admin.config-center=zookeeper://localhost:2181
admin.metadata-report.address=zookeeper://localhost:2181

# 3. ç¼–è¯‘å¯åŠ¨
mvn clean package -Dmaven.test.skip=true
java -jar dubbo-admin-distribution/target/dubbo-admin-0.5.0.jar

# 4. è®¿é—®æ§åˆ¶å°
# æµè§ˆå™¨æ‰“å¼€ï¼šhttp://localhost:8080
# é»˜è®¤ç”¨æˆ·å/å¯†ç ï¼šroot/root
```

**ğŸ–¥ï¸ æ§åˆ¶å°ä¸»è¦åŠŸèƒ½ç•Œé¢**
```
ä¸»è¦æ¨¡å—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Dubbo Admin                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  é¦–é¡µ     â”‚ ğŸ“Š æœåŠ¡ç»Ÿè®¡æ¦‚è§ˆã€å¥åº·çŠ¶æ€é¢æ¿               â”‚
â”‚ ğŸ” æœåŠ¡æŸ¥è¯¢  â”‚ ğŸ“‹ æœç´¢å’ŒæŸ¥çœ‹æ‰€æœ‰æ³¨å†ŒæœåŠ¡                  â”‚
â”‚ ğŸ§ª æœåŠ¡æµ‹è¯•  â”‚ ğŸ› ï¸ åœ¨çº¿è°ƒç”¨æœåŠ¡æ¥å£è¿›è¡Œæµ‹è¯•                â”‚
â”‚ ğŸ›ï¸ è·¯ç”±è§„åˆ™  â”‚ âš™ï¸ é…ç½®è´Ÿè½½å‡è¡¡å’Œè·¯ç”±ç­–ç•¥                  â”‚
â”‚ ğŸ”§ åŠ¨æ€é…ç½®  â”‚ ğŸ“ è¿è¡Œæ—¶ä¿®æ”¹æœåŠ¡å‚æ•°                      â”‚
â”‚ ğŸ“ˆ ç›‘æ§ä¸­å¿ƒ  â”‚ ğŸ“Š è°ƒç”¨ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç›‘æ§å¹³å°é›†æˆ


**ğŸ”§ æ•´åˆMicrometerç›‘æ§**
```java
/**
 * Dubboç›‘æ§æŒ‡æ ‡æ”¶é›†
 */
@Component
public class DubboMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter successCounter;
    private final Counter errorCounter;
    private final Timer responseTimer;
    
    public DubboMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        
        // åˆ›å»ºç›‘æ§æŒ‡æ ‡
        this.successCounter = Counter.builder("dubbo.calls.success")
                .description("æˆåŠŸè°ƒç”¨æ¬¡æ•°")
                .register(meterRegistry);
                
        this.errorCounter = Counter.builder("dubbo.calls.error")
                .description("å¤±è´¥è°ƒç”¨æ¬¡æ•°")
                .register(meterRegistry);
                
        this.responseTimer = Timer.builder("dubbo.response.time")
                .description("å“åº”æ—¶é—´")
                .register(meterRegistry);
    }
    
    /**
     * è®°å½•æˆåŠŸè°ƒç”¨
     */
    public void recordSuccess(String service, String method, long duration) {
        successCounter.increment(
            Tags.of("service", service, "method", method)
        );
        responseTimer.record(duration, TimeUnit.MILLISECONDS);
    }
    
    /**
     * è®°å½•å¤±è´¥è°ƒç”¨  
     */
    public void recordError(String service, String method, String error) {
        errorCounter.increment(
            Tags.of("service", service, "method", method, "error", error)
        );
    }
}
```

**ğŸ“ˆ Grafanaç›‘æ§é¢æ¿é…ç½®**
```yaml
# prometheus.yml - Prometheusé…ç½®
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'dubbo-provider'
    static_configs:
      - targets: ['localhost:8081']  # Providerç›‘æ§ç«¯ç‚¹
        labels:
          service: 'user-provider'
          
  - job_name: 'dubbo-consumer'  
    static_configs:
      - targets: ['localhost:8080']  # Consumerç›‘æ§ç«¯ç‚¹
        labels:
          service: 'user-consumer'
```

### 10.3 å…³é”®ç›‘æ§æŒ‡æ ‡


**ğŸ“Š æ ¸å¿ƒç›‘æ§ç»´åº¦**
```
æœåŠ¡å¯ç”¨æ€§æŒ‡æ ‡ï¼š
â€¢ æˆåŠŸç‡ï¼šæˆåŠŸè°ƒç”¨æ¬¡æ•° / æ€»è°ƒç”¨æ¬¡æ•°
â€¢ å¤±è´¥ç‡ï¼šå¤±è´¥è°ƒç”¨æ¬¡æ•° / æ€»è°ƒç”¨æ¬¡æ•°  
â€¢ è¶…æ—¶ç‡ï¼šè¶…æ—¶è°ƒç”¨æ¬¡æ•° / æ€»è°ƒç”¨æ¬¡æ•°

æ€§èƒ½æŒ‡æ ‡ï¼š
â€¢ å¹³å‡å“åº”æ—¶é—´ï¼šæ€»å“åº”æ—¶é—´ / æ€»è°ƒç”¨æ¬¡æ•°
â€¢ P95å“åº”æ—¶é—´ï¼š95%çš„è¯·æ±‚å“åº”æ—¶é—´
â€¢ P99å“åº”æ—¶é—´ï¼š99%çš„è¯·æ±‚å“åº”æ—¶é—´
â€¢ QPSï¼šæ¯ç§’æŸ¥è¯¢æ¬¡æ•°

èµ„æºæŒ‡æ ‡ï¼š
â€¢ Provideræ•°é‡ï¼šå¯ç”¨çš„æœåŠ¡æä¾›è€…æ•°é‡
â€¢ Consumeræ•°é‡ï¼šæœåŠ¡æ¶ˆè´¹è€…æ•°é‡
â€¢ è¿æ¥æ•°ï¼šç½‘ç»œè¿æ¥æ•°é‡
â€¢ çº¿ç¨‹æ± ä½¿ç”¨ç‡ï¼šå¤„ç†çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µ
```

**âš ï¸ å‘Šè­¦è§„åˆ™é…ç½®**
```yaml
# alertmanager.yml - å‘Šè­¦è§„åˆ™
groups:
  - name: dubbo-alerts
    rules:
      # æœåŠ¡æˆåŠŸç‡ä½äº95%å‘Šè­¦
      - alert: DubboServiceLowSuccessRate
        expr: dubbo_calls_success_total / (dubbo_calls_success_total + dubbo_calls_error_total) < 0.95
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "DubboæœåŠ¡æˆåŠŸç‡è¿‡ä½"
          description: "æœåŠ¡ {{ $labels.service }} æˆåŠŸç‡ä½äº95%"
      
      # å“åº”æ—¶é—´è¿‡é•¿å‘Šè­¦  
      - alert: DubboServiceSlowResponse
        expr: dubbo_response_time_p95 > 1000
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "DubboæœåŠ¡å“åº”ç¼“æ…¢"
          description: "æœåŠ¡ {{ $labels.service }} P95å“åº”æ—¶é—´è¶…è¿‡1ç§’"
```

---

## 11. ğŸ” é—®é¢˜è¯Šæ–­æŒ‡å—


### 11.1 å¸¸è§é—®é¢˜åˆ†ç±»


**ğŸš¨ è¿æ¥é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
â€¢ Consumerå¯åŠ¨æŠ¥é”™ï¼šNo provider available
â€¢ Providerå¯åŠ¨æ­£å¸¸ï¼ŒConsumerè°ƒç”¨å¤±è´¥
â€¢ é—´æ­‡æ€§è°ƒç”¨å¤±è´¥

æ’æŸ¥æ€è·¯ï¼š
1ï¸âƒ£ æ£€æŸ¥æ³¨å†Œä¸­å¿ƒè¿æ¥
2ï¸âƒ£ éªŒè¯æœåŠ¡æ³¨å†Œæƒ…å†µ  
3ï¸âƒ£ ç¡®è®¤ç½‘ç»œè¿é€šæ€§
4ï¸âƒ£ æ£€æŸ¥é…ç½®ä¸€è‡´æ€§
```

**â° è¶…æ—¶é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
â€¢ è°ƒç”¨ç»å¸¸è¶…æ—¶
â€¢ å“åº”æ—¶é—´ä¸ç¨³å®š
â€¢ ç‰¹å®šæ—¶é—´æ®µè¶…æ—¶å¢å¤š

æ’æŸ¥æ€è·¯ï¼š
1ï¸âƒ£ åˆ†æè¶…æ—¶é…ç½®æ˜¯å¦åˆç†
2ï¸âƒ£ æ£€æŸ¥Providerå¤„ç†èƒ½åŠ›
3ï¸âƒ£ ç›‘æ§ç½‘ç»œå»¶è¿Ÿæƒ…å†µ
4ï¸âƒ£ æ’æŸ¥æ•°æ®åº“ç­‰ä¾èµ–æœåŠ¡
```

### 11.2 è¯Šæ–­å·¥å…·ä½¿ç”¨


**ğŸ”§ ä½¿ç”¨Dubbo QOSè¯Šæ–­**
```bash
# å¼€å¯QOSåŠŸèƒ½
dubbo.application.qos-enable=true
dubbo.application.qos-port=22222
dubbo.application.qos-accept-foreign-ip=false

# å¸¸ç”¨QOSå‘½ä»¤
telnet localhost 22222

# æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
ls

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡è¯¦æƒ…  
ls com.example.UserService

# æŸ¥çœ‹Provideræ•°é‡
count com.example.UserService

# åœ¨çº¿è°ƒç”¨æœåŠ¡
invoke com.example.UserService.getUserById(123L)

# æŸ¥çœ‹çº¿ç¨‹æ± çŠ¶æ€
ps

# æŸ¥çœ‹è°ƒç”¨ç»Ÿè®¡
cd /
count
```

**ğŸ“‹ æ—¥å¿—åˆ†ææŠ€å·§**
```java
// logback-spring.xml - é…ç½®è¯¦ç»†æ—¥å¿—
<configuration>
    <!-- Dubboæ ¸å¿ƒæ—¥å¿— -->
    <logger name="org.apache.dubbo" level="INFO" />
    
    <!-- æ³¨å†Œä¸­å¿ƒç›¸å…³æ—¥å¿— -->
    <logger name="org.apache.dubbo.registry" level="DEBUG" />
    
    <!-- ç½‘ç»œé€šä¿¡æ—¥å¿— -->
    <logger name="org.apache.dubbo.remoting" level="DEBUG" />
    
    <!-- è´Ÿè½½å‡è¡¡æ—¥å¿— -->
    <logger name="org.apache.dubbo.rpc.cluster" level="INFO" />
    
    <!-- è‡ªå®šä¹‰Filteræ—¥å¿— -->
    <logger name="com.example.filter" level="DEBUG" />
</configuration>
```

### 11.3 æ€§èƒ½è°ƒä¼˜æŒ‡å—


**âš¡ Providerç«¯ä¼˜åŒ–**
```yaml
dubbo:
  protocol:
    name: dubbo
    port: 20880
    threads: 500          # å¢åŠ å¤„ç†çº¿ç¨‹æ•°
    iothreads: 4          # IOçº¿ç¨‹æ•°ï¼Œä¸€èˆ¬ä¸ºCPUæ ¸æ•°
    accepts: 1000         # æœ€å¤§è¿æ¥æ•°
    payload: 10485760     # æœ€å¤§è¯·æ±‚å¤§å°10MB
    
  provider:
    timeout: 3000         # åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
    retries: 0           # Providerä¸é‡è¯•ï¼Œé¿å…é‡å¤å¤„ç†
    actives: 200         # æœ€å¤§å¹¶å‘è°ƒç”¨æ•°
    executes: 500        # æœ€å¤§æ‰§è¡Œæ•°
    
    # çº¿ç¨‹æ± é…ç½®
    threadpool: fixed    # å›ºå®šçº¿ç¨‹æ± 
    threads: 500         # çº¿ç¨‹æ•°é‡
    queues: 100          # ä»»åŠ¡é˜Ÿåˆ—å¤§å°
```

**ğŸ” Consumerç«¯ä¼˜åŒ–**
```yaml  
dubbo:
  consumer:
    timeout: 5000        # ç»™Providerè¶³å¤Ÿå¤„ç†æ—¶é—´
    retries: 1           # é€‚å½“é‡è¯•ï¼Œä½†ä¸è¦è¿‡å¤š
    actives: 100         # é™åˆ¶å¹¶å‘æ•°ï¼Œé¿å…å‹å®Provider
    check: false         # å¯åŠ¨æ—¶ä¸æ£€æŸ¥ï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦
    
    # è¿æ¥é…ç½®
    connections: 5       # æ¯ä¸ªProviderçš„è¿æ¥æ•°
    sticky: false        # ä¸ä½¿ç”¨ç²˜æ€§è¿æ¥
    
    # è´Ÿè½½å‡è¡¡
    loadbalance: leastactive  # æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°
```

### 11.4 æ•…éšœæ’æŸ¥æµç¨‹


**ğŸš¨ ç³»ç»Ÿæ€§æ’æŸ¥æ­¥éª¤**

```
æ­¥éª¤1ï¼šå¿«é€Ÿå®šä½é—®é¢˜èŒƒå›´
â”œâ”€ ğŸ” æ£€æŸ¥ç›‘æ§æŒ‡æ ‡ï¼šé”™è¯¯ç‡ã€å“åº”æ—¶é—´ã€QPSå˜åŒ–
â”œâ”€ ğŸ“‹ æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼šå¼‚å¸¸å †æ ˆã€é”™è¯¯é¢‘ç‡
â”œâ”€ ğŸ–¥ï¸ ç¡®è®¤å½±å“èŒƒå›´ï¼šå“ªäº›æœåŠ¡ã€å“ªäº›æ¥å£å—å½±å“
â””â”€ â° åˆ¤æ–­é—®é¢˜èµ·å§‹æ—¶é—´ï¼šä»€ä¹ˆæ—¶å€™å¼€å§‹å‡ºç°é—®é¢˜

æ­¥éª¤2ï¼šæ£€æŸ¥åŸºç¡€ç¯å¢ƒ  
â”œâ”€ ğŸŒ ç½‘ç»œè¿é€šæ€§ï¼špingã€telnetæ£€æŸ¥ç½‘ç»œ
â”œâ”€ ğŸ’¾ æ³¨å†Œä¸­å¿ƒçŠ¶æ€ï¼šZookeeperæ˜¯å¦æ­£å¸¸
â”œâ”€ ğŸ–¥ï¸ æœåŠ¡å™¨èµ„æºï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ
â””â”€ ğŸ“Š ä¾èµ–æœåŠ¡ï¼šæ•°æ®åº“ã€ç¼“å­˜ç­‰æ˜¯å¦æ­£å¸¸

æ­¥éª¤3ï¼šåˆ†æé…ç½®é—®é¢˜
â”œâ”€ âš™ï¸ è¶…æ—¶é…ç½®ï¼šæ˜¯å¦è®¾ç½®è¿‡çŸ­
â”œâ”€ ğŸ”„ é‡è¯•é…ç½®ï¼šæ˜¯å¦è®¾ç½®ä¸å½“
â”œâ”€ âš–ï¸ è´Ÿè½½å‡è¡¡ï¼šç®—æ³•é€‰æ‹©æ˜¯å¦åˆé€‚  
â””â”€ ğŸ›ï¸ çº¿ç¨‹æ± é…ç½®ï¼šå¤§å°æ˜¯å¦åˆé€‚

æ­¥éª¤4ï¼šæ·±å…¥ä»£ç åˆ†æ
â”œâ”€ ğŸ§ª å•å…ƒæµ‹è¯•ï¼šéš”ç¦»æµ‹è¯•æœ‰é—®é¢˜çš„æ–¹æ³•
â”œâ”€ ğŸ” æ€§èƒ½åˆ†æï¼šä½¿ç”¨profilerå·¥å…·åˆ†æ
â”œâ”€ ğŸ“Š SQLåˆ†æï¼šæ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
â””â”€ ğŸ› é€»è¾‘æ£€æŸ¥ï¼šæ£€æŸ¥ä¸šåŠ¡é€»è¾‘æ˜¯å¦æœ‰é—®é¢˜
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ Dubboå››å¤§è§’è‰²ï¼š
â€¢ Providerï¼šæœåŠ¡æä¾›è€…ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘
â€¢ Consumerï¼šæœåŠ¡æ¶ˆè´¹è€…ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡
â€¢ Registryï¼šæ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æ³¨å†Œä¸å‘ç°
â€¢ Monitorï¼šç›‘æ§ä¸­å¿ƒï¼Œç»Ÿè®¡è°ƒç”¨æ•°æ®

ğŸ—ï¸ æ ¸å¿ƒæ¶æ„ç†å¿µï¼š
â€¢ æœåŠ¡æ³¨å†Œï¼šProviderå¯åŠ¨æ—¶æ³¨å†ŒæœåŠ¡ä¿¡æ¯
â€¢ æœåŠ¡å‘ç°ï¼šConsumerè®¢é˜…å¹¶ç¼“å­˜Provideråˆ—è¡¨
â€¢ ç›´è¿è°ƒç”¨ï¼šConsumerç›´æ¥è°ƒç”¨Providerï¼Œæ— éœ€ä»£ç†
â€¢ æ™ºèƒ½å®¹é”™ï¼šè‡ªåŠ¨é‡è¯•ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœè½¬ç§»
```

### 12.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ é…ç½®ä¼˜å…ˆçº§**
```
é…ç½®ä¼˜å…ˆçº§ï¼ˆé«˜åˆ°ä½ï¼‰ï¼š
1. JVMå‚æ•°ï¼š-Ddubbo.protocol.port=20880
2. XML/æ³¨è§£é…ç½®ï¼š<dubbo:protocol port="20880" />  
3. é…ç½®æ–‡ä»¶ï¼šdubbo.protocol.port=20880
4. é»˜è®¤å€¼ï¼šå„ç»„ä»¶çš„é»˜è®¤é…ç½®
```

**ğŸ”¹ è°ƒç”¨æµç¨‹ç†è§£**
```
å®Œæ•´è°ƒç”¨é“¾è·¯ï¼š
Consumer â†’ ä»£ç†å¯¹è±¡ â†’ Filteré“¾ â†’ è´Ÿè½½å‡è¡¡ â†’ 
ç½‘ç»œä¼ è¾“ â†’ Provider Filteré“¾ â†’ ä¸šåŠ¡å®ç° â†’ 
è¿”å›ç»“æœ â†’ Consumerå¤„ç†
```

**ğŸ”¹ å®¹é”™æœºåˆ¶**
```
å†…ç½®å®¹é”™ç­–ç•¥ï¼š
â€¢ fail-fastï¼šå¿«é€Ÿå¤±è´¥ï¼Œç«‹å³æŠ›å¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰
â€¢ fail-safeï¼šå¤±è´¥å®‰å…¨ï¼Œå¿½ç•¥å¼‚å¸¸è¿”å›ç©ºç»“æœ  
â€¢ fail-backï¼šå¤±è´¥å›é€€ï¼Œè®°å½•å¤±è´¥è¯·æ±‚å®šæ—¶é‡è¯•
â€¢ fail-overï¼šå¤±è´¥è½¬ç§»ï¼Œé‡è¯•å…¶ä»–Provider
â€¢ forkingï¼šå¹¶è¡Œè°ƒç”¨ï¼Œåªè¦æœ‰ä¸€ä¸ªæˆåŠŸå³è¿”å›
```

### 12.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**âœ… éƒ¨ç½²è§„èŒƒ**
```
Provideréƒ¨ç½²ï¼š
â€¢ åˆç†è®¾ç½®çº¿ç¨‹æ± å¤§å°ï¼šCPUæ ¸æ•° * 2 + 1
â€¢ å…³é—­é‡è¯•ï¼šretries=0ï¼Œé¿å…é‡å¤å¤„ç†
â€¢ è®¾ç½®åˆç†è¶…æ—¶ï¼šæ ¹æ®ä¸šåŠ¡å¤„ç†æ—¶é—´è®¾å®š
â€¢ é…ç½®ç›‘æ§ï¼šè®°å½•è°ƒç”¨ç»Ÿè®¡å’Œå¼‚å¸¸

Consumeréƒ¨ç½²ï¼š  
â€¢ å¯ç”¨é‡è¯•ï¼šretries=1-2ï¼Œæé«˜æˆåŠŸç‡
â€¢ è®¾ç½®è¶…æ—¶ï¼šæ¯”Providerè¶…æ—¶æ—¶é—´é•¿
â€¢ é™åˆ¶å¹¶å‘ï¼šactiveså‚æ•°é¿å…å‹å®Provider
â€¢ å¯åŠ¨æ£€æŸ¥ï¼šcheck=falseï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦
```

**ğŸ“Š ç›‘æ§æŒ‡æ ‡**
```
å…³é”®æŒ‡æ ‡ç›‘æ§ï¼š
â€¢ å¯ç”¨æ€§ï¼šæˆåŠŸç‡ > 99.9%
â€¢ æ€§èƒ½ï¼šP99å“åº”æ—¶é—´ < 1000ms
â€¢ å®¹é‡ï¼šQPSå³°å€¼ç›‘æ§
â€¢ é”™è¯¯ï¼šå¼‚å¸¸ç±»å‹å’Œé¢‘ç‡ç»Ÿè®¡
```

**ğŸš¨ å‘Šè­¦é…ç½®**
```
å‘Šè­¦é˜ˆå€¼å»ºè®®ï¼š
â€¢ æˆåŠŸç‡ < 95%ï¼šç«‹å³å‘Šè­¦
â€¢ P95å“åº”æ—¶é—´ > 1000msï¼šå‘Šè­¦  
â€¢ QPSéª¤é™ > 50%ï¼šå‘Šè­¦
â€¢ Provideræ•°é‡ < 2ï¼šå‘Šè­¦
```

### 12.4 å¸¸è§å‘ç‚¹é¿å…


**âŒ é…ç½®é™·é˜±**
```
è¶…æ—¶é…ç½®ï¼š
âœ… Consumerè¶…æ—¶ > Providerè¶…æ—¶
âŒ æ‰€æœ‰æœåŠ¡ä½¿ç”¨ç›¸åŒè¶…æ—¶æ—¶é—´

é‡è¯•é…ç½®ï¼š
âœ… Providerè®¾ç½®retries=0  
âŒ æŸ¥è¯¢å’Œæ›´æ–°æ“ä½œä½¿ç”¨ç›¸åŒé‡è¯•ç­–ç•¥

ç‰ˆæœ¬ç®¡ç†ï¼š
âœ… æ–°æ—§ç‰ˆæœ¬å¹¶å­˜ï¼Œç°åº¦å‘å¸ƒ
âŒ ç›´æ¥æ›¿æ¢ç‰ˆæœ¬ï¼Œå½±å“çº¿ä¸ŠæœåŠ¡
```

**âš ï¸ æ€§èƒ½é™·é˜±**
```
çº¿ç¨‹æ± é…ç½®ï¼š
âœ… æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´çº¿ç¨‹æ•°
âŒ ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ± é…ç½®

è¿æ¥æ•°é…ç½®ï¼š
âœ… åˆç†è®¾ç½®connectionså‚æ•°
âŒ æ¯æ¬¡è°ƒç”¨åˆ›å»ºæ–°è¿æ¥

åºåˆ—åŒ–é€‰æ‹©ï¼š
âœ… ä½¿ç”¨é«˜æ•ˆåºåˆ—åŒ–æ–¹å¼ï¼ˆå¦‚hessian2ï¼‰
âŒ ä½¿ç”¨JavaåŸç”Ÿåºåˆ—åŒ–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Dubboå››è§’è‰²ï¼Œæ³¨å†Œä¸­å¿ƒè¿ï¼Œ
Provideræš´éœ²æœåŠ¡ï¼ŒConsumeræ¥è°ƒç”¨ï¼Œ
Monitorç»Ÿè®¡æ•°æ®ï¼ŒAdminç®¡ç†å…¨ï¼Œ
é…ç½®è¦åˆç†ï¼Œç›‘æ§ä¸èƒ½ç¼ºï¼Œ
ç”Ÿäº§ç¯å¢ƒç¨³ï¼Œæ€§èƒ½ä¼˜åŒ–å…ˆï¼
```