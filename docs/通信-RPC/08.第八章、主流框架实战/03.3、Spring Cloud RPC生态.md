---
title: 3ã€Spring Cloud RPCç”Ÿæ€
---
## ğŸ“š ç›®å½•

1. [Spring Cloud RPCæ¦‚è¿°](#1-spring-cloud-rpcæ¦‚è¿°)
2. [OpenFeignå£°æ˜å¼HTTPå®¢æˆ·ç«¯](#2-openfeignå£°æ˜å¼httpå®¢æˆ·ç«¯)
3. [Ribbonè´Ÿè½½å‡è¡¡](#3-ribbonè´Ÿè½½å‡è¡¡)
4. [Hystrixç†”æ–­å™¨](#4-hystrixç†”æ–­å™¨)
5. [æœåŠ¡æ³¨å†Œä¸å‘ç°](#5-æœåŠ¡æ³¨å†Œä¸å‘ç°)
6. [ä¸Spring Bootæ·±åº¦é›†æˆ](#6-ä¸spring-bootæ·±åº¦é›†æˆ)
7. [å¾®æœåŠ¡æ¶æ„æœ€ä½³å®è·µ](#7-å¾®æœåŠ¡æ¶æ„æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Spring Cloud RPCæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Spring Cloud RPC


**ç®€å•ç†è§£**ï¼šSpring Cloud RPCå°±æ˜¯è®©ä¸åŒçš„å¾®æœåŠ¡ä¹‹é—´èƒ½å¤Ÿåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡

```
ä¼ ç»Ÿå•ä½“åº”ç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æœåŠ¡      â”‚
â”‚   è®¢å•æœåŠ¡      â”‚ â† ç›´æ¥è°ƒç”¨ï¼Œç®€å•ï¼
â”‚   æ”¯ä»˜æœåŠ¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç½‘ç»œè°ƒç”¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æœåŠ¡ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ è®¢å•æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“                         â†“
     â†“       ç½‘ç»œè°ƒç”¨           â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ æ”¯ä»˜æœåŠ¡ â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Spring Cloud RPCæ ¸å¿ƒç»„ä»¶


**ä¸‰å¤§æ ¸å¿ƒç»„ä»¶**ï¼š
- ğŸ¯ **OpenFeign** - å£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼ˆè®©è¿œç¨‹è°ƒç”¨åƒæœ¬åœ°è°ƒç”¨ï¼‰
- âš–ï¸ **Ribbon** - è´Ÿè½½å‡è¡¡å™¨ï¼ˆé€‰æ‹©è°ƒç”¨å“ªä¸ªæœåŠ¡å®ä¾‹ï¼‰  
- ğŸ›¡ï¸ **Hystrix** - ç†”æ–­å™¨ï¼ˆæœåŠ¡æ•…éšœæ—¶çš„ä¿æŠ¤æœºåˆ¶ï¼‰

> ğŸ’¡ **é€šä¿—æ¯”å–»**ï¼š
> - OpenFeignåƒ"ç”µè¯" - å¸®ä½ æ‹¨é€šè¿œç¨‹æœåŠ¡
> - Ribbonåƒ"è°ƒåº¦å‘˜" - å¸®ä½ é€‰æ‹©æœ€åˆé€‚çš„æœåŠ¡
> - Hystrixåƒ"ä¿é™©ä¸" - æœåŠ¡å‡ºé—®é¢˜æ—¶è‡ªåŠ¨æ–­å¼€ä¿æŠ¤

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦è¿™å¥—ç”Ÿæ€


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

```
é—®é¢˜1ï¼šè¿œç¨‹è°ƒç”¨å¤æ‚
âŒ ä¼ ç»Ÿæ–¹å¼ï¼š
RestTemplate restTemplate = new RestTemplate();
String url = "http://user-service/users/" + userId;
User user = restTemplate.getForObject(url, User.class);

âœ… OpenFeignæ–¹å¼ï¼š
@FeignClient("user-service")
interface UserService {
    @GetMapping("/users/{userId}")
    User getUser(@PathVariable Long userId);
}
// ç›´æ¥è°ƒç”¨ï¼šUser user = userService.getUser(userId);
```

**é—®é¢˜2ï¼šæœåŠ¡å®ä¾‹é€‰æ‹©å›°éš¾**
```
å‡è®¾ç”¨æˆ·æœåŠ¡æœ‰3ä¸ªå®ä¾‹ï¼š
- user-service-1ï¼š192.168.1.10:8001
- user-service-2ï¼š192.168.1.11:8001  
- user-service-3ï¼š192.168.1.12:8001

âŒ æ²¡æœ‰è´Ÿè½½å‡è¡¡ï¼šæ€»æ˜¯è°ƒç”¨ç¬¬ä¸€ä¸ªï¼Œå…¶ä»–å®ä¾‹é—²ç½®
âœ… æœ‰Ribbonï¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å®ä¾‹è°ƒç”¨
```

---

## 2. ğŸ“ OpenFeignå£°æ˜å¼HTTPå®¢æˆ·ç«¯


### 2.1 OpenFeignæ ¸å¿ƒæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å£°æ˜å¼è°ƒç”¨**ï¼š
- ä¸éœ€è¦å†™å…·ä½“çš„HTTPè°ƒç”¨ä»£ç 
- åªéœ€è¦å®šä¹‰æ¥å£å’Œæ³¨è§£
- æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè°ƒç”¨é€»è¾‘

```java
// è¿™å°±æ˜¯å£°æ˜å¼ - åªéœ€è¦å£°æ˜æ¥å£ï¼Œä¸éœ€è¦å®ç°
@FeignClient(name = "user-service", path = "/api")
public interface UserService {
    
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable("id") Long id);
    
    @PostMapping("/users")
    User createUser(@RequestBody User user);
}
```

### 2.2 åŸºæœ¬ç”¨æ³•è¯¦è§£


#### ğŸ“ æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–å’Œæ³¨è§£


```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

```java
@SpringBootApplication
@EnableFeignClients  // â† å¼€å¯FeignåŠŸèƒ½
public class OrderApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderApplication.class, args);
    }
}
```

#### ğŸ“ æ­¥éª¤2ï¼šå®šä¹‰Feignå®¢æˆ·ç«¯æ¥å£


```java
@FeignClient(
    name = "user-service",           // æœåŠ¡åç§°
    path = "/api/v1",               // ç»Ÿä¸€è·¯å¾„å‰ç¼€
    fallback = UserServiceFallback.class  // é™çº§å¤„ç†ç±»
)
public interface UserService {
    
    // GETè¯·æ±‚
    @GetMapping("/users/{userId}")
    User getUser(@PathVariable Long userId);
    
    // POSTè¯·æ±‚  
    @PostMapping("/users")
    User createUser(@RequestBody UserCreateRequest request);
    
    // å¸¦æŸ¥è¯¢å‚æ•°çš„è¯·æ±‚
    @GetMapping("/users")
    List<User> getUsers(@RequestParam String name, 
                       @RequestParam Integer age);
}
```

#### ğŸ“ æ­¥éª¤3ï¼šç›´æ¥ä½¿ç”¨


```java
@RestController
public class OrderController {
    
    @Autowired
    private UserService userService;  // åƒæ™®é€šSpring Beanä¸€æ ·æ³¨å…¥
    
    @PostMapping("/orders")
    public Order createOrder(@RequestBody OrderRequest request) {
        // è°ƒç”¨è¿œç¨‹ç”¨æˆ·æœåŠ¡ - å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼
        User user = userService.getUser(request.getUserId());
        
        // åˆ›å»ºè®¢å•é€»è¾‘
        return orderService.createOrder(user, request);
    }
}
```

### 2.3 é«˜çº§ç‰¹æ€§è¯¦è§£


#### ğŸ”§ è‡ªå®šä¹‰ç¼–ç å™¨


**ä½œç”¨**ï¼šæ§åˆ¶è¯·æ±‚å’Œå“åº”çš„åºåˆ—åŒ–æ–¹å¼

```java
@Configuration
public class FeignConfig {
    
    // è‡ªå®šä¹‰JSONç¼–ç å™¨
    @Bean
    public Encoder feignEncoder() {
        return new JacksonEncoder(objectMapper());
    }
    
    // è‡ªå®šä¹‰JSONè§£ç å™¨
    @Bean  
    public Decoder feignDecoder() {
        return new JacksonDecoder(objectMapper());
    }
    
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        // å¿½ç•¥æœªçŸ¥å±æ€§
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        return mapper;
    }
}
```

#### ğŸ” è‡ªå®šä¹‰æ‹¦æˆªå™¨


**ä½œç”¨**ï¼šåœ¨å‘é€è¯·æ±‚å‰ç»Ÿä¸€å¤„ç†ï¼ˆæ·»åŠ è¯·æ±‚å¤´ã€æ—¥å¿—è®°å½•ç­‰ï¼‰

```java
@Component
public class FeignRequestInterceptor implements RequestInterceptor {
    
    @Override
    public void apply(RequestTemplate template) {
        // æ·»åŠ è®¤è¯å¤´
        String token = getCurrentUserToken();
        template.header("Authorization", "Bearer " + token);
        
        // æ·»åŠ è¿½è¸ªID
        template.header("Trace-Id", UUID.randomUUID().toString());
        
        // è®°å½•è¯·æ±‚æ—¥å¿—
        log.info("Feignè¯·æ±‚: {} {}", template.method(), template.url());
    }
    
    private String getCurrentUserToken() {
        // è·å–å½“å‰ç”¨æˆ·tokençš„é€»è¾‘
        return SecurityContextHolder.getContext()
            .getAuthentication().getCredentials().toString();
    }
}
```

#### âš ï¸ è‡ªå®šä¹‰é”™è¯¯å¤„ç†


```java
@Component
public class FeignErrorDecoder implements ErrorDecoder {
    
    @Override
    public Exception decode(String methodKey, Response response) {
        switch (response.status()) {
            case 404:
                return new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨");
            case 401:
                return new UnauthorizedException("è®¤è¯å¤±è´¥");
            case 500:
                return new RemoteServiceException("è¿œç¨‹æœåŠ¡å†…éƒ¨é”™è¯¯");
            default:
                return new FeignException.Default(methodKey, response);
        }
    }
}
```

### 2.4 ä¸Hystrixé›†æˆ


**ç†”æ–­é™çº§é…ç½®**ï¼š

```java
// 1. å®šä¹‰é™çº§å¤„ç†ç±»
@Component
public class UserServiceFallback implements UserService {
    
    @Override
    public User getUser(Long userId) {
        // è¿”å›é»˜è®¤ç”¨æˆ·ä¿¡æ¯
        return User.builder()
            .id(userId)
            .name("é»˜è®¤ç”¨æˆ·")
            .status("UNKNOWN")
            .build();
    }
    
    @Override
    public User createUser(UserCreateRequest request) {
        throw new ServiceUnavailableException("ç”¨æˆ·æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•");
    }
}

// 2. Feignæ¥å£æŒ‡å®šé™çº§ç±»
@FeignClient(
    name = "user-service",
    fallback = UserServiceFallback.class
)
public interface UserService {
    // æ¥å£å®šä¹‰...
}
```

**é…ç½®æ–‡ä»¶è®¾ç½®**ï¼š

```yaml
# application.yml
feign:
  hystrix:
    enabled: true  # å¯ç”¨Hystrix
  client:
    config:
      default:  # å…¨å±€é…ç½®
        connect-timeout: 5000
        read-timeout: 10000
      user-service:  # ç‰¹å®šæœåŠ¡é…ç½®
        connect-timeout: 3000
        read-timeout: 8000

hystrix:
  command:
    default:
      execution:
        isolation:
          thread:
            timeout-in-milliseconds: 10000  # ç†”æ–­è¶…æ—¶æ—¶é—´
```

---

## 3. âš–ï¸ Ribbonè´Ÿè½½å‡è¡¡


### 3.1 RibbonåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡**ï¼š
æŠŠè¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œé¿å…æŸä¸ªå®ä¾‹å‹åŠ›è¿‡å¤§

```
æ²¡æœ‰è´Ÿè½½å‡è¡¡ï¼š
å®¢æˆ·ç«¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æœåŠ¡å®ä¾‹1 (å‹åŠ›å¤§ï¼Œå¯èƒ½å´©æºƒ)
                  æœåŠ¡å®ä¾‹2 (é—²ç½®)
                  æœåŠ¡å®ä¾‹3 (é—²ç½®)

æœ‰è´Ÿè½½å‡è¡¡ï¼š
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æœåŠ¡å®ä¾‹1
å®¢æˆ·ç«¯ â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æœåŠ¡å®ä¾‹2  â† Ribboné€‰æ‹©
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æœåŠ¡å®ä¾‹3
```

### 3.2 è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®


#### ğŸ¯ å¸¸ç”¨ç­–ç•¥è¯¦è§£


| ç­–ç•¥åç§° | **å·¥ä½œæ–¹å¼** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|---------|-------------|-------------|-----------|
| `RoundRobinRule` | `è½®è¯¢ï¼š1â†’2â†’3â†’1â†’2â†’3` | `æœåŠ¡å®ä¾‹æ€§èƒ½ç›¸è¿‘` | `ç®€å•å…¬å¹³ï¼Œä½†ä¸è€ƒè™‘å®é™…è´Ÿè½½` |
| `RandomRule` | `éšæœºé€‰æ‹©æœåŠ¡å®ä¾‹` | `ç®€å•åœºæ™¯ï¼Œå®ä¾‹æ€§èƒ½ç›¸è¿‘` | `åˆ†å¸ƒå‡åŒ€ï¼Œä½†å¯èƒ½çŸ­æœŸä¸å‡è¡¡` |
| `WeightedResponseTimeRule` | `å“åº”æ—¶é—´è¶ŠçŸ­æƒé‡è¶Šé«˜` | `æœåŠ¡å®ä¾‹æ€§èƒ½å·®å¼‚å¤§` | `è‡ªåŠ¨é€‚åº”ï¼Œä½†éœ€è¦é¢„çƒ­æ—¶é—´` |
| `BestAvailableRule` | `é€‰æ‹©å¹¶å‘è¯·æ±‚æœ€å°‘çš„å®ä¾‹` | `é•¿è¿æ¥æœåŠ¡` | `è€ƒè™‘å®é™…è´Ÿè½½ï¼Œä½†è®¡ç®—å¤æ‚` |
| `AvailabilityFilteringRule` | `è¿‡æ»¤æ•…éšœå®ä¾‹ï¼Œå†è½®è¯¢` | `éœ€è¦é«˜å¯ç”¨çš„æœåŠ¡` | `è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œé€»è¾‘è¾ƒå¤æ‚` |

#### ğŸ”§ é…ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥


**æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶é…ç½®**
```yaml
# application.yml
user-service:  # æœåŠ¡å
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.WeightedResponseTimeRule
    ConnectTimeout: 3000
    ReadTimeout: 10000
    MaxAutoRetries: 1          # é‡è¯•æ¬¡æ•°
    MaxAutoRetriesNextServer: 2  # é‡è¯•å…¶ä»–æœåŠ¡æ¬¡æ•°
```

**æ–¹å¼2ï¼šJavaé…ç½®**
```java
@Configuration
public class RibbonConfig {
    
    @Bean
    public IRule ribbonRule() {
        // ä½¿ç”¨åŠ æƒå“åº”æ—¶é—´è§„åˆ™
        return new WeightedResponseTimeRule();
    }
    
    @Bean
    public IPing ribbonPing() {
        // ä½¿ç”¨HTTPå¥åº·æ£€æŸ¥
        return new PingUrl(false, "/actuator/health");
    }
}
```

### 3.3 è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡è§„åˆ™


**åŸºäºä¸šåŠ¡çš„è·¯ç”±è§„åˆ™**ï¼š

```java
public class VersionBasedRule extends AbstractLoadBalancerRule {
    
    @Override
    public Server choose(Object key) {
        LoadBalancer lb = getLoadBalancer();
        List<Server> servers = lb.getReachableServers();
        
        // è·å–å½“å‰è¯·æ±‚çš„ç‰ˆæœ¬ä¿¡æ¯
        String requestVersion = getCurrentRequestVersion();
        
        // æ ¹æ®ç‰ˆæœ¬é€‰æ‹©æœåŠ¡å®ä¾‹
        for (Server server : servers) {
            Map<String, String> metadata = getServerMetadata(server);
            String serverVersion = metadata.get("version");
            
            if (requestVersion.equals(serverVersion)) {
                return server;
            }
        }
        
        // æ‰¾ä¸åˆ°åŒ¹é…ç‰ˆæœ¬ï¼Œä½¿ç”¨é»˜è®¤ç­–ç•¥
        return servers.get(0);
    }
    
    private String getCurrentRequestVersion() {
        // ä»è¯·æ±‚å¤´æˆ–ä¸Šä¸‹æ–‡è·å–ç‰ˆæœ¬ä¿¡æ¯
        RequestAttributes attributes = RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = ((ServletRequestAttributes) attributes).getRequest();
        return request.getHeader("API-Version");
    }
}
```

### 3.4 åŒºåŸŸæ„ŸçŸ¥è´Ÿè½½å‡è¡¡


**è·¨åŒºåŸŸè´Ÿè½½å‡è¡¡é…ç½®**ï¼š

```yaml
# application.yml
eureka:
  instance:
    metadata-map:
      zone: zone-a  # å½“å‰å®ä¾‹æ‰€åœ¨åŒºåŸŸ
  client:
    availability-zones:
      region-1: zone-a,zone-b,zone-c

ribbon:
  eureka:
    enabled: true
  zone-preference: zone-a  # ä¼˜å…ˆé€‰æ‹©åŒåŒºåŸŸå®ä¾‹
```

**è‡ªå®šä¹‰åŒºåŸŸæ„ŸçŸ¥è§„åˆ™**ï¼š

```java
public class ZoneAwareRule extends AbstractLoadBalancerRule {
    
    @Override
    public Server choose(Object key) {
        LoadBalancer lb = getLoadBalancer();
        String currentZone = getCurrentZone();
        
        // ä¼˜å…ˆé€‰æ‹©åŒåŒºåŸŸçš„å®ä¾‹
        List<Server> sameZoneServers = filterServersByZone(
            lb.getReachableServers(), currentZone);
            
        if (!sameZoneServers.isEmpty()) {
            return selectFromSameZone(sameZoneServers);
        }
        
        // åŒåŒºåŸŸæ— å¯ç”¨å®ä¾‹ï¼Œé€‰æ‹©å…¶ä»–åŒºåŸŸ
        return selectFromOtherZones(lb.getReachableServers(), currentZone);
    }
    
    private List<Server> filterServersByZone(List<Server> servers, String zone) {
        return servers.stream()
            .filter(server -> zone.equals(getServerZone(server)))
            .collect(Collectors.toList());
    }
}
```

---

## 4. ğŸ›¡ï¸ Hystrixç†”æ–­å™¨


### 4.1 Hystrixæ ¸å¿ƒæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç†”æ–­å™¨**ï¼š
å°±åƒå®¶é‡Œçš„ç”µé—¸ï¼Œå½“ç”µè·¯è¿‡è½½æ—¶è‡ªåŠ¨æ–­å¼€ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿ

```
æ­£å¸¸æƒ…å†µï¼š
è®¢å•æœåŠ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç”¨æˆ·æœåŠ¡ (æ­£å¸¸å“åº”)

ç”¨æˆ·æœåŠ¡æ•…éšœæ—¶ï¼š
è®¢å•æœåŠ¡ â”€â”€Xâ”€â”€â”€â”€â”€â”€â†’ ç”¨æˆ·æœåŠ¡ (è¶…æ—¶/å¼‚å¸¸)
    â†“
  ç­‰å¾…è¶…æ—¶ï¼Œæ‹–æ…¢æ•´ä¸ªç³»ç»Ÿ

ä½¿ç”¨ç†”æ–­å™¨ï¼š
è®¢å•æœåŠ¡ â”€â”€[ç†”æ–­å™¨]â”€â”€â†’ ç”¨æˆ·æœåŠ¡ (æ•…éšœ)
    â†“
  å¿«é€Ÿå¤±è´¥ï¼Œè¿”å›é»˜è®¤å€¼
```

### 4.2 ç†”æ–­å™¨çŠ¶æ€è½¬æ¢


```
ç†”æ–­å™¨çŠ¶æ€å›¾ï¼š
    
    å…³é—­çŠ¶æ€ â”€â”€â”€â”€å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼â”€â”€â”€â”€â†’ æ‰“å¼€çŠ¶æ€
    (CLOSED)                      (OPEN)
        â†‘                           â†“
        â”‚                      è¶…æ—¶åå°è¯•
        â”‚                           â†“
    æˆåŠŸç‡è¾¾æ ‡ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åŠå¼€çŠ¶æ€
                              (HALF-OPEN)
```

**ä¸‰ç§çŠ¶æ€è¯¦è§£**ï¼š
- **ğŸŸ¢ å…³é—­çŠ¶æ€ï¼ˆCLOSEDï¼‰**ï¼šæ­£å¸¸å·¥ä½œï¼Œç»Ÿè®¡å¤±è´¥ç‡
- **ğŸ”´ æ‰“å¼€çŠ¶æ€ï¼ˆOPENï¼‰**ï¼šæ‹’ç»è¯·æ±‚ï¼Œç›´æ¥è¿”å›é™çº§ç»“æœ  
- **ğŸŸ¡ åŠå¼€çŠ¶æ€ï¼ˆHALF-OPENï¼‰**ï¼šå°è¯•æ¢å¤ï¼Œæµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸

### 4.3 é…ç½®ä¼˜åŒ–è¯¦è§£


#### âš™ï¸ æ ¸å¿ƒå‚æ•°é…ç½®


```yaml
hystrix:
  command:
    default:  # å…¨å±€é…ç½®
      execution:
        isolation:
          thread:
            timeout-in-milliseconds: 10000  # è¶…æ—¶æ—¶é—´
        timeout:
          enabled: true
      circuit-breaker:
        enabled: true
        request-volume-threshold: 20      # æœ€å°è¯·æ±‚æ•°
        sleep-window-in-milliseconds: 5000  # æ¢å¤å°è¯•é—´éš”
        error-threshold-percentage: 50    # å¤±è´¥ç‡é˜ˆå€¼
      fallback:
        enabled: true
    UserService#getUser:  # ç‰¹å®šæ–¹æ³•é…ç½®
      execution:
        isolation:
          thread:
            timeout-in-milliseconds: 5000
```

#### ğŸ“Š å‚æ•°å«ä¹‰è¯¦è§£


> **ğŸ” request-volume-threshold = 20**
> å«ä¹‰ï¼šåœ¨ç»Ÿè®¡çª—å£å†…è‡³å°‘è¦æœ‰20ä¸ªè¯·æ±‚ï¼Œæ‰ä¼šè®¡ç®—å¤±è´¥ç‡
> ä½œç”¨ï¼šé¿å…å› ä¸ºè¯·æ±‚é‡å¤ªå°‘å¯¼è‡´çš„è¯¯åˆ¤

> **â° sleep-window-in-milliseconds = 5000**  
> å«ä¹‰ï¼šç†”æ–­å™¨æ‰“å¼€åï¼Œ5ç§’åå°è¯•åŠå¼€çŠ¶æ€
> ä½œç”¨ï¼šç»™ä¸‹æ¸¸æœåŠ¡æ¢å¤çš„æ—¶é—´

> **ğŸ“ˆ error-threshold-percentage = 50**
> å«ä¹‰ï¼šå¤±è´¥ç‡è¾¾åˆ°50%æ—¶è§¦å‘ç†”æ–­
> ä½œç”¨ï¼šæ§åˆ¶ç†”æ–­çš„æ•æ„Ÿåº¦

### 4.4 ç›‘æ§é¢æ¿Dashboard


#### ğŸ“Š å¯ç”¨ç›‘æ§é¢æ¿


**1. æ·»åŠ ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**2. å¯ç”¨Dashboard**ï¼š
```java
@SpringBootApplication
@EnableHystrixDashboard  // å¯ç”¨ç›‘æ§é¢æ¿
public class MonitorApplication {
    
    @Bean
    public ServletRegistrationBean getServlet() {
        HystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();
        ServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);
        registrationBean.setLoadOnStartup(1);
        registrationBean.addUrlMappings("/hystrix.stream");
        registrationBean.setName("HystrixMetricsStreamServlet");
        return registrationBean;
    }
}
```

**3. é…ç½®ç›‘æ§ç«¯ç‚¹**ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: hystrix.stream
  endpoint:
    hystrix:
      stream:
        enabled: true
```

### 4.5 è‡ªå®šä¹‰ç†”æ–­å‘½ä»¤


**å¤æ‚åœºæ™¯çš„ç†”æ–­é€»è¾‘**ï¼š

```java
@Component
public class UserServiceCommand extends HystrixCommand<User> {
    
    private final UserService userService;
    private final Long userId;
    
    public UserServiceCommand(UserService userService, Long userId) {
        super(HystrixCommandGroupKey.Factory.asKey("UserService"));
        this.userService = userService;
        this.userId = userId;
    }
    
    @Override
    protected User run() throws Exception {
        // ä¸»è¦é€»è¾‘ï¼šè°ƒç”¨è¿œç¨‹æœåŠ¡
        return userService.getUser(userId);
    }
    
    @Override
    protected User getFallback() {
        // é™çº§é€»è¾‘ï¼šè¿”å›ç¼“å­˜æ•°æ®æˆ–é»˜è®¤å€¼
        return getCachedUser(userId);
    }
    
    @Override
    protected String getCacheKey() {
        // ç¼“å­˜keyï¼Œç›¸åŒkeyçš„è¯·æ±‚ä¼šè¢«ç¼“å­˜
        return "user:" + userId;
    }
    
    private User getCachedUser(Long userId) {
        // ä»æœ¬åœ°ç¼“å­˜æˆ–æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯
        return redisTemplate.opsForValue().get("user:" + userId);
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤
@RestController
public class OrderController {
    
    public Order createOrder(OrderRequest request) {
        User user = new UserServiceCommand(userService, request.getUserId()).execute();
        return orderService.createOrder(user, request);
    }
}
```

---

## 5. ğŸ¢ æœåŠ¡æ³¨å†Œä¸å‘ç°


### 5.1 æœåŠ¡æ³¨å†Œå‘ç°åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œå‘ç°**ï¼š
å°±åƒç”µè¯é»„é¡µï¼ŒæœåŠ¡å¯åŠ¨æ—¶æŠŠè‡ªå·±çš„åœ°å€"ç™»è®°"åˆ°æ³¨å†Œä¸­å¿ƒï¼Œå…¶ä»–æœåŠ¡è¦è°ƒç”¨æ—¶å»"æŸ¥ç”µè¯å·ç "

```
æœåŠ¡æ³¨å†Œå‘ç°æµç¨‹ï¼š

1. æœåŠ¡å¯åŠ¨æ—¶æ³¨å†Œ
   ç”¨æˆ·æœåŠ¡ â”€â”€æ³¨å†Œâ”€â”€â†’ æ³¨å†Œä¸­å¿ƒ
   (192.168.1.10:8001)   (å­˜å‚¨æœåŠ¡ä¿¡æ¯)
   
2. å…¶ä»–æœåŠ¡å‘ç°å¹¶è°ƒç”¨  
   è®¢å•æœåŠ¡ â”€â”€æŸ¥è¯¢â”€â”€â†’ æ³¨å†Œä¸­å¿ƒ â”€â”€è¿”å›åœ°å€â”€â”€â†’ è®¢å•æœåŠ¡
              â†“
           è°ƒç”¨ç”¨æˆ·æœåŠ¡
```

### 5.2 Eurekaé…ç½®è¯¦è§£


#### ğŸŒŸ Eureka Serveré…ç½®


```java
@SpringBootApplication
@EnableEurekaServer  // å¯ç”¨EurekaæœåŠ¡ç«¯
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

```yaml
# Eureka Serveré…ç½®
server:
  port: 8761

eureka:
  instance:
    hostname: localhost
  client:
    register-with-eureka: false  # è‡ªå·±ä¸æ³¨å†Œåˆ°è‡ªå·±
    fetch-registry: false        # ä¸è·å–æ³¨å†Œä¿¡æ¯
    service-url:
      default-zone: http://${eureka.instance.hostname}:${server.port}/eureka/
  server:
    enable-self-preservation: false  # å…³é—­ä¿æŠ¤æ¨¡å¼(å¼€å‘ç¯å¢ƒ)
```

#### ğŸ“± Eureka Clienté…ç½®


```yaml
# æœåŠ¡æä¾›è€…é…ç½®
spring:
  application:
    name: user-service  # æœåŠ¡åï¼Œå…¶ä»–æœåŠ¡é€šè¿‡è¿™ä¸ªåå­—è°ƒç”¨

eureka:
  client:
    service-url:
      default-zone: http://localhost:8761/eureka/  # æ³¨å†Œä¸­å¿ƒåœ°å€
  instance:
    prefer-ip-address: true  # ä½¿ç”¨IPåœ°å€æ³¨å†Œ
    lease-renewal-interval-in-seconds: 30    # å¿ƒè·³é—´éš”
    lease-expiration-duration-in-seconds: 90  # ç§Ÿçº¦è¿‡æœŸæ—¶é—´
    metadata-map:  # è‡ªå®šä¹‰å…ƒæ•°æ®
      version: 1.0
      zone: zone-a
```

### 5.3 å¥åº·æ£€æŸ¥é…ç½®


```java
@RestController
public class HealthController {
    
    @GetMapping("/actuator/health")
    public Map<String, Object> health() {
        Map<String, Object> health = new HashMap<>();
        
        // æ£€æŸ¥æ•°æ®åº“è¿æ¥
        boolean dbHealthy = checkDatabase();
        // æ£€æŸ¥ç¼“å­˜è¿æ¥  
        boolean cacheHealthy = checkRedis();
        
        if (dbHealthy && cacheHealthy) {
            health.put("status", "UP");
        } else {
            health.put("status", "DOWN");
        }
        
        health.put("database", dbHealthy ? "UP" : "DOWN");
        health.put("cache", cacheHealthy ? "UP" : "DOWN");
        
        return health;
    }
}
```

```yaml
# å¥åº·æ£€æŸ¥é…ç½®
eureka:
  client:
    healthcheck:
      enabled: true  # å¯ç”¨å¥åº·æ£€æŸ¥
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      exposure:
        include: health,info
```

---

## 6. ğŸš€ ä¸Spring Bootæ·±åº¦é›†æˆ


### 6.1 è‡ªåŠ¨é…ç½®åŸç†


**Spring Cloudå¦‚ä½•ä¸Spring Booté›†æˆ**ï¼š

```
Spring Bootå¯åŠ¨æµç¨‹ï¼š
1. æ‰«æ@SpringBootApplication
2. åŠ è½½spring.factoriesä¸­çš„è‡ªåŠ¨é…ç½®ç±»
3. æ ¹æ®æ¡ä»¶æ³¨è§£å†³å®šæ˜¯å¦ç”Ÿæ•ˆ
4. åˆ›å»ºBeanå¹¶æ³¨å…¥å®¹å™¨

Spring Cloudè‡ªåŠ¨é…ç½®ï¼š
spring.factoriesæ–‡ä»¶åŒ…å«ï¼š
- FeignAutoConfiguration      # Feignè‡ªåŠ¨é…ç½®
- RibbonAutoConfiguration     # Ribbonè‡ªåŠ¨é…ç½®  
- HystrixAutoConfiguration    # Hystrixè‡ªåŠ¨é…ç½®
- EurekaClientAutoConfiguration # Eurekaå®¢æˆ·ç«¯è‡ªåŠ¨é…ç½®
```

### 6.2 æ ¸å¿ƒè‡ªåŠ¨é…ç½®ç±»


```java
// Feignè‡ªåŠ¨é…ç½®ç¤ºä¾‹
@Configuration
@ConditionalOnClass(Feign.class)  // ç±»è·¯å¾„æœ‰Feignæ—¶ç”Ÿæ•ˆ
@EnableConfigurationProperties({FeignClientProperties.class, 
                                FeignHttpClientProperties.class})
public class FeignAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean  // æ²¡æœ‰è‡ªå®šä¹‰Beanæ—¶åˆ›å»ºé»˜è®¤Bean
    public Decoder feignDecoder() {
        return new ResponseEntityDecoder(new SpringDecoder(this.messageConverters));
    }
    
    @Bean
    @ConditionalOnMissingBean
    public Encoder feignEncoder() {
        return new SpringEncoder(this.messageConverters);
    }
    
    @Bean
    @ConditionalOnProperty(name = "feign.hystrix.enabled")  // é…ç½®å±æ€§æ§åˆ¶
    public Feign.Builder feignHystrixBuilder() {
        return HystrixFeign.builder();
    }
}
```

### 6.3 å¥åº·æ£€æŸ¥é›†æˆ


#### ğŸ¥ è‡ªå®šä¹‰å¥åº·æ£€æŸ¥æŒ‡ç¤ºå™¨


```java
@Component
public class UserServiceHealthIndicator implements HealthIndicator {
    
    @Autowired
    private UserService userService;
    
    @Override
    public Health health() {
        try {
            // å°è¯•è°ƒç”¨è¿œç¨‹æœåŠ¡
            userService.getUser(1L);
            return Health.up()
                .withDetail("user-service", "Available")
                .withDetail("response-time", "< 100ms")
                .build();
        } catch (Exception e) {
            return Health.down(e)
                .withDetail("user-service", "Unavailable")
                .withDetail("error", e.getMessage())
                .build();
        }
    }
}
```

#### ğŸ“Š é›†æˆActuatorç›‘æ§ç«¯ç‚¹


```yaml
# ç›‘æ§ç«¯ç‚¹é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: '*'  # æš´éœ²æ‰€æœ‰ç«¯ç‚¹
      base-path: /actuator
  endpoint:
    health:
      show-details: always
    metrics:
      enabled: true
    prometheus:  # Prometheusç›‘æ§é›†æˆ
      enabled: true

# è‡ªå®šä¹‰åº¦é‡æŒ‡æ ‡
spring:
  application:
    name: order-service
  metrics:
    tags:
      application: ${spring.application.name}
      environment: production
```

### 6.4 åº¦é‡æŒ‡æ ‡é›†æˆ


```java
@RestController
public class OrderController {
    
    private final MeterRegistry meterRegistry;
    private final Counter orderCounter;
    private final Timer orderTimer;
    
    public OrderController(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.orderCounter = Counter.builder("orders.created")
            .description("è®¢å•åˆ›å»ºæ•°é‡")
            .register(meterRegistry);
        this.orderTimer = Timer.builder("orders.create.time")
            .description("è®¢å•åˆ›å»ºè€—æ—¶")
            .register(meterRegistry);
    }
    
    @PostMapping("/orders")
    public Order createOrder(@RequestBody OrderRequest request) {
        return orderTimer.recordCallable(() -> {
            try {
                Order order = orderService.createOrder(request);
                orderCounter.increment();  // è®¡æ•°å™¨+1
                return order;
            } catch (Exception e) {
                // è®°å½•é”™è¯¯æŒ‡æ ‡
                meterRegistry.counter("orders.create.errors").increment();
                throw e;
            }
        });
    }
}
```

---

## 7. ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„æœ€ä½³å®è·µ


### 7.1 æœåŠ¡æ‹†åˆ†åŸåˆ™


**å¦‚ä½•åˆç†æ‹†åˆ†å¾®æœåŠ¡**ï¼š

```
âŒ é”™è¯¯æ‹†åˆ†ï¼šæŒ‰æŠ€æœ¯å±‚æ¬¡æ‹†åˆ†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webå±‚æœåŠ¡  â”‚  â”‚ Serviceå±‚æœåŠ¡â”‚  â”‚   DAOå±‚æœåŠ¡  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šè·¨æœåŠ¡è°ƒç”¨é¢‘ç¹ï¼Œæ€§èƒ½å·®

âœ… æ­£ç¡®æ‹†åˆ†ï¼šæŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æœåŠ¡   â”‚  â”‚   è®¢å•æœåŠ¡   â”‚  â”‚   æ”¯ä»˜æœåŠ¡   â”‚
â”‚ (å®Œæ•´ä¸šåŠ¡åŸŸ) â”‚  â”‚ (å®Œæ•´ä¸šåŠ¡åŸŸ) â”‚  â”‚ (å®Œæ•´ä¸šåŠ¡åŸŸ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜ç‚¹ï¼šé«˜å†…èšï¼Œä½è€¦åˆ
```

**æ‹†åˆ†æŒ‡å¯¼åŸåˆ™**ï¼š
- ğŸ¯ **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡åŸŸ
- ğŸ”’ **æ•°æ®ç‹¬ç«‹**ï¼šæ¯ä¸ªæœåŠ¡ç®¡ç†è‡ªå·±çš„æ•°æ®åº“
- ğŸ“ **æ¥å£ç¨³å®š**ï¼šæœåŠ¡é—´é€šè¿‡ç¨³å®šçš„APIé€šä¿¡
- ğŸš€ **ç‹¬ç«‹éƒ¨ç½²**ï¼šå¯ä»¥ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²

### 7.2 APIç½‘å…³æ¨¡å¼


```
APIç½‘å…³æ¶æ„ï¼š

å®¢æˆ·ç«¯(Web/Mobile)
        â†“
    APIç½‘å…³
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚è·¯ç”±è½¬å‘  â”‚â”€â”€â†’ ç”¨æˆ·æœåŠ¡
   â”‚è´Ÿè½½å‡è¡¡  â”‚â”€â”€â†’ è®¢å•æœåŠ¡  
   â”‚è®¤è¯é‰´æƒ  â”‚â”€â”€â†’ æ”¯ä»˜æœåŠ¡
   â”‚é™æµç†”æ–­  â”‚â”€â”€â†’ å•†å“æœåŠ¡
   â”‚æ—¥å¿—ç›‘æ§  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**APIç½‘å…³çš„ä½œç”¨**ï¼š
- ğŸšª **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰è¯·æ±‚ç»è¿‡ç½‘å…³
- ğŸ” **å®‰å…¨æ§åˆ¶**ï¼šè®¤è¯ã€æˆæƒã€APIå¯†é’¥éªŒè¯  
- ğŸš¦ **æµé‡æ§åˆ¶**ï¼šé™æµã€ç†”æ–­ã€è¶…æ—¶æ§åˆ¶
- ğŸ“Š **ç›‘æ§æ—¥å¿—**ï¼šè¯·æ±‚è¿½è¸ªã€æ€§èƒ½ç›‘æ§

### 7.3 é…ç½®ç®¡ç†æ¨¡å¼


**é›†ä¸­åŒ–é…ç½®ç®¡ç†**ï¼š

```yaml
# config-serveré…ç½®
spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/company/config-repo
          search-paths: config
          username: ${GIT_USERNAME}
          password: ${GIT_PASSWORD}

# é…ç½®ä»“åº“ç»“æ„
config-repo/
â”œâ”€â”€ user-service.yml          # ç”¨æˆ·æœåŠ¡é…ç½®
â”œâ”€â”€ user-service-dev.yml      # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ user-service-prod.yml     # ç”Ÿäº§ç¯å¢ƒ
â”œâ”€â”€ order-service.yml         # è®¢å•æœåŠ¡é…ç½®
â””â”€â”€ application.yml           # å…¬å…±é…ç½®
```

**é…ç½®åˆ·æ–°**ï¼š

```java
@RestController
@RefreshScope  // æ”¯æŒé…ç½®çƒ­æ›´æ–°
public class ConfigController {
    
    @Value("${app.message:default}")
    private String message;
    
    @GetMapping("/message")
    public String getMessage() {
        return message;
    }
}
```

### 7.4 åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª


**Sleuthé›†æˆç¤ºä¾‹**ï¼š

```yaml
spring:
  sleuth:
    sampler:
      probability: 1.0  # é‡‡æ ·ç‡100%(ç”Ÿäº§ç¯å¢ƒå»ºè®®0.1)
    zipkin:
      base-url: http://zipkin-server:9411
  application:
    name: order-service
```

**è‡ªå®šä¹‰é“¾è·¯ä¿¡æ¯**ï¼š

```java
@RestController
public class OrderController {
    
    private final Tracer tracer;
    
    @PostMapping("/orders")
    public Order createOrder(@RequestBody OrderRequest request) {
        // åˆ›å»ºè‡ªå®šä¹‰Span
        Span span = tracer.nextSpan()
            .name("create-order")
            .tag("user.id", request.getUserId().toString())
            .tag("order.type", request.getType())
            .start();
            
        try (Tracer.SpanInScope ws = tracer.withSpanInScope(span)) {
            // ä¸šåŠ¡é€»è¾‘
            Order order = orderService.createOrder(request);
            span.tag("order.id", order.getId().toString());
            return order;
        } finally {
            span.end();
        }
    }
}
```

### 7.5 å®¹é”™è®¾è®¡æ¨¡å¼


#### ğŸ”„ é‡è¯•æ¨¡å¼


```java
@Retryable(
    value = {ConnectException.class, SocketTimeoutException.class},
    maxAttempts = 3,
    backoff = @Backoff(delay = 1000, multiplier = 2)
)
public User getUserWithRetry(Long userId) {
    return userService.getUser(userId);
}

@Recover
public User recover(Exception ex, Long userId) {
    log.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼ŒuserId: {}", userId, ex);
    return getDefaultUser(userId);
}
```

#### ğŸ€ èˆ±å£æ¨¡å¼


```yaml
# çº¿ç¨‹æ± éš”ç¦»é…ç½®
hystrix:
  threadpool:
    UserServicePool:  # ç”¨æˆ·æœåŠ¡ä¸“ç”¨çº¿ç¨‹æ± 
      core-size: 10
      max-queue-size: 100
    OrderServicePool: # è®¢å•æœåŠ¡ä¸“ç”¨çº¿ç¨‹æ±   
      core-size: 20
      max-queue-size: 200

  command:
    UserService:
      threadPoolKey: UserServicePool
    OrderService:
      threadPoolKey: OrderServicePool
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ OpenFeignï¼šå£°æ˜å¼HTTPå®¢æˆ·ç«¯ï¼Œè®©è¿œç¨‹è°ƒç”¨åƒæœ¬åœ°è°ƒç”¨
ğŸ”¸ Ribbonï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œæ™ºèƒ½é€‰æ‹©æœåŠ¡å®ä¾‹  
ğŸ”¸ Hystrixï¼šç†”æ–­å™¨ï¼ŒæœåŠ¡æ•…éšœæ—¶çš„ä¿æŠ¤ä¼
ğŸ”¸ Eurekaï¼šæœåŠ¡æ³¨å†Œå‘ç°ï¼Œå¾®æœåŠ¡çš„ç”µè¯é»„é¡µ
ğŸ”¸ è‡ªåŠ¨é…ç½®ï¼šSpring Booté›†æˆï¼Œå¼€ç®±å³ç”¨
ğŸ”¸ ç›‘æ§æ²»ç†ï¼šå¥åº·æ£€æŸ¥ã€åº¦é‡æŒ‡æ ‡ã€é“¾è·¯è¿½è¸ª
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ç»„ä»¶**ï¼š
- **è¿œç¨‹è°ƒç”¨å¤æ‚** â†’ OpenFeignç®€åŒ–è°ƒç”¨
- **å¤šå®ä¾‹é€‰æ‹©å›°éš¾** â†’ Ribbonè´Ÿè½½å‡è¡¡
- **æœåŠ¡æ•…éšœè¿é”ååº”** â†’ Hystrixç†”æ–­ä¿æŠ¤
- **æœåŠ¡åœ°å€ç¡¬ç¼–ç ** â†’ EurekaåŠ¨æ€å‘ç°

**ğŸ”¹ ç»„ä»¶åä½œå…³ç³»**ï¼š
```
è¯·æ±‚æµç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ OpenFeign â†’ Ribboné€‰æ‹©å®ä¾‹ â†’ Hystrixä¿æŠ¤ â†’ ç›®æ ‡æœåŠ¡
   â†‘                     â†“
Eurekaæ³¨å†Œä¸­å¿ƒ â†â”€â”€â”€ æœåŠ¡å®ä¾‹åˆ—è¡¨
```

**ğŸ”¹ é…ç½®ä¼˜å…ˆçº§ç†è§£**ï¼š
```
é…ç½®ä¼˜å…ˆçº§ï¼ˆé«˜åˆ°ä½ï¼‰ï¼š
1. ä»£ç ä¸­çš„@Beané…ç½®
2. application.ymlä¸­çš„ç‰¹å®šæœåŠ¡é…ç½®  
3. application.ymlä¸­çš„defaulté…ç½®
4. æ¡†æ¶é»˜è®¤é…ç½®
```

### 8.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- âš¡ **è¿æ¥æ± é…ç½®**ï¼šåˆç†è®¾ç½®è¿æ¥è¶…æ—¶å’Œè¯»å–è¶…æ—¶
- ğŸ”„ **é‡è¯•ç­–ç•¥**ï¼šé¿å…é‡è¯•é£æš´ï¼Œè®¾ç½®åˆç†çš„é‡è¯•æ¬¡æ•°
- ğŸ“Š **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- ğŸ¥ **å¥åº·æ£€æŸ¥**ï¼šè‡ªå®šä¹‰ä¸šåŠ¡ç›¸å…³çš„å¥åº·æ£€æŸ¥é€»è¾‘

**ğŸ”’ å®‰å…¨è€ƒè™‘**ï¼š
- ğŸ”‘ **æœåŠ¡é—´è®¤è¯**ï¼šä½¿ç”¨JWTæˆ–OAuth2ä¿æŠ¤æœåŠ¡é—´è°ƒç”¨
- ğŸš« **è®¿é—®æ§åˆ¶**ï¼šç½‘å…³å±‚è¿›è¡Œç»Ÿä¸€çš„æƒé™æ§åˆ¶
- ğŸ” **æ•æ„Ÿé…ç½®åŠ å¯†**ï¼šä½¿ç”¨Config Serverçš„åŠ å¯†åŠŸèƒ½

**ğŸ“ˆ å¯æ‰©å±•æ€§è®¾è®¡**ï¼š
- ğŸ”§ **é…ç½®å¤–éƒ¨åŒ–**ï¼šæ‰€æœ‰é…ç½®éƒ½æ”¾åœ¨é…ç½®ä¸­å¿ƒ
- ğŸ“¦ **æœåŠ¡ç‰ˆæœ¬ç®¡ç†**ï¼šæ”¯æŒå¤šç‰ˆæœ¬å¹¶å­˜å’Œç°åº¦å‘å¸ƒ
- ğŸŒ **è·¨åŒºåŸŸéƒ¨ç½²**ï¼šè€ƒè™‘å¤šæœºæˆ¿çš„éƒ¨ç½²æ¶æ„

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- OpenFeignå£°æ˜è°ƒç”¨å¾ˆç®€å•ï¼Œå°±åƒæœ¬åœ°æ–¹æ³•ä¸€æ ·ç”¨
- Ribbonè´Ÿè½½å‡è¡¡é€‰å®ä¾‹ï¼Œè½®è¯¢éšæœºæƒé‡éšä½ é…
- Hystrixç†”æ–­ä¿æŠ¤é˜²é›ªå´©ï¼Œå¿«é€Ÿå¤±è´¥è¿”å›é»˜è®¤å€¼  
- Eurekaæ³¨å†Œå‘ç°åšé»„é¡µï¼ŒæœåŠ¡åœ°å€ä¸ç”¨è®°
- Spring Bootè‡ªåŠ¨é…ç½®å¾ˆæ™ºèƒ½ï¼Œå¼€ç®±å³ç”¨çœŸæ–¹ä¾¿