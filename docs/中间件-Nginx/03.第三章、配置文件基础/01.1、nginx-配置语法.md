---
title: 1、nginx-配置语法
---
## 📚 目录

1. [Nginx配置文件概述](#1-Nginx配置文件概述)
2. [配置文件基本结构](#2-配置文件基本结构)
3. [指令和指令块详解](#3-指令和指令块详解)
4. [语法规则与规范](#4-语法规则与规范)
5. [注释方式与最佳实践](#5-注释方式与最佳实践)
6. [配置继承规则](#6-配置继承规则)
7. [变量使用与应用](#7-变量使用与应用)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🌐 Nginx配置文件概述


### 1.1 什么是Nginx配置文件


**🔸 简单理解**
```
把Nginx配置文件想象成"说明书"：
- 就像家电说明书告诉你怎么使用产品
- Nginx配置文件告诉Nginx怎么工作
- 你在配置文件里写规则，Nginx按规则执行
```

**📋 核心作用**
- **控制行为**：告诉Nginx监听哪个端口、处理什么请求
- **定义规则**：设置网站根目录、反向代理规则等
- **优化性能**：配置缓存、压缩、连接数等参数
- **安全设置**：访问控制、SSL证书配置等

### 1.2 配置文件位置


**📁 常见位置**
```
Linux系统：
主配置文件：/etc/nginx/nginx.conf
网站配置：/etc/nginx/sites-available/
         /etc/nginx/conf.d/

macOS（通过brew安装）：
主配置文件：/usr/local/etc/nginx/nginx.conf

Windows：
主配置文件：nginx安装目录/conf/nginx.conf
```

> 💡 **新手提示**：不同安装方式配置文件位置可能不同，可以用 `nginx -t` 命令查看当前使用的配置文件路径

### 1.3 配置文件类型


| 配置文件类型 | **作用说明** | **典型位置** |
|-------------|-------------|-------------|
| 🔹 **主配置文件** | `全局设置，包含基本参数` | `/etc/nginx/nginx.conf` |
| 🔹 **网站配置文件** | `具体网站的配置规则` | `/etc/nginx/sites-available/` |
| 🔹 **模块配置文件** | `特定功能模块的配置` | `/etc/nginx/conf.d/` |

---

## 2. 🏗️ 配置文件基本结构


### 2.1 整体架构图


```
nginx.conf 文件结构：

┌─────────────────────────────────┐
│         全局配置块               │  ← 影响整个Nginx运行
│  user, worker_processes 等      │
├─────────────────────────────────┤
│         events 配置块           │  ← 连接处理相关配置
│  worker_connections 等          │
├─────────────────────────────────┤
│         http 配置块             │  ← HTTP相关的所有配置
│  ├─────────────────────────────┤│
│  │      server 配置块          ││  ← 虚拟主机配置
│  │  ├─────────────────────────┤││
│  │  │    location 配置块      │││  ← 具体URL处理规则
│  │  └─────────────────────────┘││
│  └─────────────────────────────┘│
└─────────────────────────────────┘
```

### 2.2 配置层级关系


**🔸 层级理解**
```
全局块：整个Nginx的基础设置
  ↓
events块：处理连接的方式
  ↓  
http块：处理HTTP请求的总规则
  ↓
server块：一个网站的配置
  ↓
location块：网站内具体路径的处理方式
```

> 📝 **通俗解释**：就像俄罗斯套娃一样，大盒子套小盒子，外层的设置会影响内层，内层可以覆盖外层的某些设置

### 2.3 最小可用配置示例


```nginx
# 全局配置
worker_processes 1;

# 事件配置
events {
    worker_connections 1024;
}

# HTTP配置
http {
    # 一个最基本的网站配置
    server {
        listen 80;                    # 监听80端口
        server_name localhost;        # 服务器名称
        
        location / {                  # 处理根路径请求
            root /var/www/html;       # 网站文件目录
            index index.html;         # 默认首页文件
        }
    }
}
```

---

## 3. 📋 指令和指令块详解


### 3.1 什么是指令


**🔸 指令的概念**
```
指令就像"命令"：
- 告诉Nginx做什么事情
- 每个指令有固定的格式
- 必须以分号(;)结尾（除了指令块）
```

**💡 指令分类**

| 指令类型 | **说明** | **示例** |
|---------|---------|---------|
| ⭐ **简单指令** | `一行完成的设置` | `listen 80;` |
| ⭐ **指令块** | `包含多个配置的大块` | `server { ... }` |

### 3.2 常用简单指令


**🔹 端口监听指令**
```nginx
listen 80;                    # 监听80端口
listen 443 ssl;              # 监听443端口并启用SSL
listen [::]:80;               # 监听IPv6的80端口
```

**🔹 服务器名称指令**
```nginx
server_name example.com;              # 单个域名
server_name example.com www.example.com;  # 多个域名
server_name *.example.com;            # 通配符域名
```

**🔹 文件路径指令**
```nginx
root /var/www/html;           # 网站根目录
index index.html index.php;  # 默认首页文件（按顺序查找）
```

### 3.3 指令块详解


**🔸 指令块特点**
- 用大括号 `{}` 包围
- 可以嵌套（块里面还可以有块）
- 不需要分号结尾
- 内部包含多个简单指令

**📊 主要指令块类型**

```nginx
# 1. events块 - 连接处理配置
events {
    worker_connections 1024;     # 每个工作进程最大连接数
    use epoll;                   # 使用的事件模型
}

# 2. http块 - HTTP协议配置
http {
    include mime.types;          # 包含文件类型定义
    sendfile on;                 # 启用高效文件传输
    
    # 3. server块 - 虚拟主机配置
    server {
        listen 80;
        server_name example.com;
        
        # 4. location块 - URL路径匹配
        location / {
            root /var/www/html;
            index index.html;
        }
        
        location /api/ {
            proxy_pass http://backend;
        }
    }
}
```

### 3.4 指令块的作用域


```
作用域理解：
┌─────────────────┐
│    全局块       │ ← 影响整个Nginx
│ ┌─────────────┐ │
│ │  http块     │ │ ← 影响所有HTTP请求
│ │ ┌─────────┐ │ │
│ │ │server块 │ │ │ ← 影响这个网站
│ │ │┌───────┐│ │ │
│ │ ││location││ │ │ ← 影响特定URL路径
│ │ │└───────┘│ │ │
│ │ └─────────┘ │ │
│ └─────────────┘ │
└─────────────────┘
```

---

## 4. 📜 语法规则与规范


### 4.1 基本语法规则


**🔸 核心规则**
- ✅ **分号结尾**：每个简单指令必须以分号结尾
- ✅ **大括号配对**：指令块用 `{}` 包围，必须配对
- ✅ **空格分隔**：指令名和参数用空格分隔
- ✅ **路径规范**：文件路径建议使用绝对路径

```nginx
# ✅ 正确写法
listen 80;
server_name example.com;
root /var/www/html;

# ❌ 错误写法
listen 80    # 缺少分号
server_name example.com；  # 中文分号
root/var/www/html;  # 缺少空格
```

### 4.2 参数类型与格式


**📋 参数类型说明**

| 参数类型 | **格式要求** | **示例** |
|---------|-------------|---------|
| 🔹 **字符串** | `可加引号或不加引号` | `"index.html"` 或 `index.html` |
| 🔹 **数字** | `直接写数字` | `1024` |
| 🔹 **时间单位** | `数字+单位(s/m/h/d)` | `30s` `5m` `1h` `7d` |
| 🔹 **大小单位** | `数字+单位(k/m/g)` | `1k` `10m` `1g` |
| 🔹 **开关** | `on或off` | `sendfile on;` |

```nginx
# 时间参数示例
client_timeout 30s;        # 30秒
keepalive_timeout 65;      # 65秒（默认单位）
proxy_connect_timeout 5m;  # 5分钟

# 大小参数示例
client_max_body_size 10m;  # 10MB
worker_rlimit_nofile 65535; # 数字
```

### 4.3 引号使用规则


**🔸 何时需要引号**
```nginx
# 包含特殊字符时需要引号
location "~* \.(jpg|png|gif)$" {
    # 正则表达式需要引号
}

# 包含空格时需要引号
error_page 404 "/404 page.html";

# 一般情况不需要引号
root /var/www/html;
index index.html;
```

### 4.4 路径表示规范


```nginx
# ✅ 推荐：使用绝对路径
root /var/www/html;
access_log /var/log/nginx/access.log;

# ⚠️ 注意：相对路径相对于nginx安装目录
root html;  # 相当于 nginx安装目录/html

# 🔸 路径末尾斜杠的区别
location /images/ {     # 匹配 /images/xxx
    alias /var/www/img/; # alias末尾要有斜杠
}

location /static {      # 匹配 /static 和 /staticxxx
    root /var/www;      # root末尾可以没有斜杠
}
```

---

## 5. 💬 注释方式与最佳实践


### 5.1 注释语法


**🔸 注释规则**
- 使用 `#` 号开始注释
- 可以单独一行，也可以在指令后面
- `#` 后面建议加一个空格

```nginx
# 这是单行注释
worker_processes auto;  # 这是行尾注释

# 这是多行注释的第一行
# 这是多行注释的第二行
events {
    worker_connections 1024;
}
```

### 5.2 注释最佳实践


**📝 配置文件注释示例**
```nginx
# ===========================================
# Nginx主配置文件
# 创建时间：2025-09-21
# 维护人员：运维团队
# ===========================================

# 工作进程数配置（建议设置为CPU核心数）
worker_processes auto;

# 错误日志配置
error_log /var/log/nginx/error.log warn;

# 事件处理配置
events {
    # 每个工作进程的最大连接数
    worker_connections 1024;
    
    # 使用epoll事件模型（Linux推荐）
    use epoll;
}

http {
    # 文件类型定义
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # 网站配置
    server {
        listen 80;                    # 监听端口
        server_name example.com;      # 域名
        
        # 网站根目录配置
        location / {
            root /var/www/html;       # 静态文件目录
            index index.html;         # 默认首页
        }
    }
}
```

### 5.3 注释内容建议


> 💡 **注释内容指南**：
> - ✅ **配置说明**：解释这个配置的作用
> - ✅ **参数含义**：重要参数的含义和建议值
> - ✅ **修改记录**：重要修改的时间和原因
> - ✅ **注意事项**：配置的限制或副作用
> - ❌ **避免冗余**：不要注释显而易见的内容

---

## 6. 🔄 配置继承规则


### 6.1 继承机制理解


**🔸 继承的概念**
```
类比家庭关系：
爷爷的财产 → 爸爸可以继承 → 儿子可以继承

Nginx配置：
全局配置 → http块继承 → server块继承 → location块继承
```

**📊 继承层级图**
```
全局块配置
    ↓ 继承
events块 + http块
    ↓ 继承
  server块
    ↓ 继承
  location块
```

### 6.2 继承规则详解


**🔹 指令继承类型**

| 继承类型 | **说明** | **示例** |
|---------|---------|---------|
| ⭐ **可继承** | `子块自动获得父块设置` | `sendfile`, `gzip` |
| ⭐ **可覆盖** | `子块可以修改父块设置` | `root`, `index` |
| ⭐ **不继承** | `只在当前块生效` | `listen`, `server_name` |

### 6.3 继承示例说明


```nginx
http {
    # 父级设置：所有server都会继承
    sendfile on;              # 所有server继承
    gzip on;                  # 所有server继承
    root /var/www;            # 默认根目录
    
    server {
        listen 80;            # 只在当前server生效
        server_name site1.com;
        
        # 继承了http块的sendfile、gzip设置
        # 覆盖了http块的root设置
        root /var/www/site1;
        
        location / {
            # 继承server的root设置 -> /var/www/site1
            index index.html;
        }
        
        location /admin/ {
            # 覆盖server的root设置
            root /var/www/admin;
            index admin.html;
        }
    }
    
    server {
        listen 80;
        server_name site2.com;
        
        # 同样继承http块的设置
        # 但可以有不同的配置
        root /var/www/site2;
    }
}
```

### 6.4 继承冲突处理


**🔸 优先级规则**
```
就近原则：越具体的配置优先级越高

location块 > server块 > http块 > 全局块
```

**📝 实际应用示例**
```nginx
http {
    root /var/www/default;    # 第4优先级

    server {
        root /var/www/site;   # 第3优先级
        
        location / {
            # 使用server的root: /var/www/site
        }
        
        location /special/ {
            root /var/www/special;  # 第1优先级（最高）
            # 最终使用: /var/www/special
        }
    }
}
```

---

## 7. 🔧 变量使用与应用


### 7.1 Nginx变量概念


**🔸 变量理解**
```
变量就像"占位符"：
- 存储临时信息
- 可以在配置中重复使用
- 让配置更灵活
```

**📋 变量语法**
- 使用 `$` 符号开头
- 格式：`$变量名`
- 区分大小写

### 7.2 内置变量


**🔹 常用内置变量**

| 变量名 | **含义** | **示例值** |
|-------|---------|-----------|
| `$host` | `请求的主机名` | `example.com` |
| `$request_uri` | `完整的请求URI` | `/path?param=value` |
| `$uri` | `当前请求的URI路径` | `/path` |
| `$args` | `请求参数` | `param=value` |
| `$remote_addr` | `客户端IP地址` | `192.168.1.100` |
| `$server_name` | `服务器名称` | `example.com` |
| `$request_method` | `请求方法` | `GET`、`POST` |

**💡 变量使用示例**
```nginx
server {
    listen 80;
    server_name example.com;
    
    # 在日志中使用变量
    access_log /var/log/nginx/access.log;
    
    location / {
        # 在响应头中使用变量
        add_header X-Real-IP $remote_addr;
        
        # 根据不同请求方法处理
        if ($request_method = POST) {
            return 405;  # 不允许POST请求
        }
        
        root /var/www/html;
    }
}
```

### 7.3 自定义变量


**🔹 set指令定义变量**
```nginx
server {
    listen 80;
    
    # 定义自定义变量
    set $mobile_request 0;
    set $api_version "v1";
    
    # 根据User-Agent判断是否移动端
    if ($http_user_agent ~* "(iPhone|Android)") {
        set $mobile_request 1;
    }
    
    location / {
        # 使用自定义变量
        if ($mobile_request = 1) {
            root /var/www/mobile;
        }
        if ($mobile_request = 0) {
            root /var/www/desktop;
        }
    }
}
```

### 7.4 变量在不同场景的应用


**🔹 日志记录**
```nginx
http {
    # 自定义日志格式，使用多个变量
    log_format main '$remote_addr - $remote_user [$time_local] '
                   '"$request" $status $body_bytes_sent '
                   '"$http_referer" "$http_user_agent"';
                   
    access_log /var/log/nginx/access.log main;
}
```

**🔹 反向代理**
```nginx
location /api/ {
    # 使用变量构建代理地址
    proxy_pass http://backend$request_uri;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

**🔹 条件判断**
```nginx
location / {
    # 根据变量值进行条件处理
    if ($args ~ "debug=1") {
        access_log /var/log/nginx/debug.log;
    }
    
    root /var/www/html;
}
```

> ⚠️ **注意事项**：
> - 变量值都是字符串类型
> - 未定义的变量值为空字符串
> - 某些变量只在特定上下文中可用

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基础概念


```
🔸 配置文件结构：全局块 → events块 → http块 → server块 → location块
🔸 指令语法：简单指令以分号结尾，指令块用大括号包围
🔸 继承规则：子块继承父块配置，可以覆盖父块设置
🔸 变量使用：$开头，用于存储和传递信息
🔸 注释规范：用#号，要写有意义的说明
```

### 8.2 关键理解要点


**🔹 配置文件的层级思维**
```
理解要点：
- 每一层都有自己的作用范围
- 内层可以继承外层的设置
- 内层设置优先级更高
- 合理利用继承可以简化配置
```

**🔹 指令的分类使用**
```
简单指令：
- 格式固定，参数明确
- 必须以分号结尾
- 一行完成配置

指令块：
- 包含多个相关配置
- 用大括号包围
- 可以嵌套使用
```

**🔹 变量的灵活应用**
```
变量优势：
- 减少重复配置
- 动态获取请求信息
- 实现条件判断
- 简化复杂逻辑
```

### 8.3 实际应用建议


**✅ 配置文件编写建议**
- **结构清晰**：合理使用缩进和空行
- **注释充分**：重要配置要有说明
- **测试验证**：修改后用 `nginx -t` 测试语法
- **备份习惯**：修改前备份原配置文件

**✅ 学习进阶路径**
- ① 熟练掌握基本语法规则
- ② 理解配置块的层级关系
- ③ 学会使用常用变量
- ④ 练习编写实际的网站配置

**核心记忆要点**：
- Nginx配置就像说明书，告诉服务器怎么工作
- 配置有层级，内层继承外层并可以覆盖
- 简单指令要分号，指令块用大括号
- 变量用$开头，让配置更灵活
- 注释用#号，让别人看懂你的配置