---
title: 3ã€nginx-urlé‡å†™å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [URLé‡å†™çš„åŸºæœ¬æ¦‚å¿µ](#1-URLé‡å†™çš„åŸºæœ¬æ¦‚å¿µ)
2. [RewriteæŒ‡ä»¤è¯¦è§£](#2-RewriteæŒ‡ä»¤è¯¦è§£)
3. [SEOå‹å¥½URLå®ç°](#3-SEOå‹å¥½URLå®ç°)
4. [ä¼ªé™æ€åŒ–å®æˆ˜](#4-ä¼ªé™æ€åŒ–å®æˆ˜)
5. [åŸŸåè·³è½¬ä¸è·¯å¾„é‡å†™](#5-åŸŸåè·³è½¬ä¸è·¯å¾„é‡å†™)
6. [ç§»åŠ¨ç«¯é€‚é…é‡å†™](#6-ç§»åŠ¨ç«¯é€‚é…é‡å†™)
7. [APIè·¯ç”±é‡å†™](#7-APIè·¯ç”±é‡å†™)
8. [å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ](#8-å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ URLé‡å†™çš„åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯URLé‡å†™


**ğŸ”¸ ç”Ÿæ´»åŒ–ç†è§£**
```
URLé‡å†™å°±åƒç»™ä½ çš„æˆ¿å­æ¢é—¨ç‰Œå·ï¼š
â€¢ åŸé—¨ç‰Œï¼šå¤æ‚éš¾è®°çš„ç¼–å·
â€¢ æ–°é—¨ç‰Œï¼šç®€æ´æ˜“æ‡‚çš„åœ°å€
â€¢ é‚®é€’å‘˜ï¼šæµè§ˆå™¨å’Œæœç´¢å¼•æ“
â€¢ æˆ¿å­æœ¬èº«ï¼šç½‘ç«™å†…å®¹æ²¡æœ‰å˜åŒ–
```

**ğŸ“‹ æŠ€æœ¯å®šä¹‰**
```
URLé‡å†™ï¼ˆURL Rewritingï¼‰ï¼š
â€¢ å°†ç”¨æˆ·è®¿é—®çš„URLè½¬æ¢ä¸ºæœåŠ¡å™¨å†…éƒ¨çš„URL
â€¢ å¯¹å¤–å±•ç¤ºå‹å¥½URLï¼Œå†…éƒ¨ä½¿ç”¨çœŸå®è·¯å¾„
â€¢ å®ç°URLç¾åŒ–ã€SEOä¼˜åŒ–ã€å…¼å®¹æ€§å¤„ç†
â€¢ ç”¨æˆ·çœ‹åˆ°çš„å’ŒæœåŠ¡å™¨å¤„ç†çš„å¯ä»¥å®Œå…¨ä¸åŒ
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦URLé‡å†™


**ğŸ¯ ä¸»è¦ç”¨é€”å¯¹æ¯”**

| **åœºæ™¯** | **åŸå§‹URL** | **é‡å†™åURL** | **å¥½å¤„** |
|---------|------------|--------------|----------|
| **åŠ¨æ€é¡µé¢** | `/product.php?id=123&cat=5` | `/product/123/category/5` | æ›´ç¾è§‚ã€SEOå‹å¥½ |
| **æ—§ç«™è¿ç§»** | `/old/news/2023/article1.html` | `/news/2023/article1` | ä¿æŒé“¾æ¥æœ‰æ•ˆæ€§ |
| **ç§»åŠ¨é€‚é…** | `example.com/page` | `m.example.com/page` | è‡ªåŠ¨è·³è½¬ç§»åŠ¨ç‰ˆ |
| **å¤šè¯­è¨€** | `/zh/about.html` | `/about?lang=zh` | ç®€åŒ–URLç»“æ„ |

**ğŸ’¡ å®é™…ä»·å€¼**
```
SEOä¼˜åŒ–ï¼š
â€¢ æœç´¢å¼•æ“æ›´å–œæ¬¢é™æ€åŒ–URL
â€¢ å…³é”®è¯å¯ä»¥åŒ…å«åœ¨URLä¸­
â€¢ æå‡é¡µé¢æ’åæƒé‡

ç”¨æˆ·ä½“éªŒï¼š
â€¢ URLæ›´å®¹æ˜“è®°å¿†å’Œåˆ†äº«
â€¢ éšè—æŠ€æœ¯å®ç°ç»†èŠ‚
â€¢ æä¾›æ›´ä¸“ä¸šçš„ç½‘ç«™å½¢è±¡

ç»´æŠ¤ä¾¿åˆ©ï¼š
â€¢ å¯ä»¥éšæ—¶è°ƒæ•´URLç»“æ„
â€¢ ä¸å½±å“å·²æœ‰çš„å¤–éƒ¨é“¾æ¥
â€¢ å®ç°ç‰ˆæœ¬æ§åˆ¶å’ŒA/Bæµ‹è¯•
```

### 1.3 URLé‡å†™çš„å·¥ä½œåŸç†


**ğŸ”§ å¤„ç†æµç¨‹**
```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ·æµè§ˆå™¨ â†’ å‘é€è¯·æ±‚ â†’ Nginxæ¥æ”¶
     â†“
Nginxé‡å†™å¼•æ“ â†’ åŒ¹é…é‡å†™è§„åˆ™ â†’ ç”Ÿæˆæ–°URL
     â†“
å†…éƒ¨è½¬å‘ â†’ åç«¯å¤„ç† â†’ è¿”å›å“åº”
     â†“
å“åº”è¿”å› â†’ ç”¨æˆ·æµè§ˆå™¨ â†’ æ˜¾ç¤ºå†…å®¹

å…³é”®ç†è§£ï¼š
â€¢ ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ç¾åŒ–åçš„URL
â€¢ æœåŠ¡å™¨å¤„ç†çš„æ˜¯çœŸå®çš„æ–‡ä»¶è·¯å¾„
â€¢ æ•´ä¸ªè¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜
```

---

## 2. âš™ï¸ RewriteæŒ‡ä»¤è¯¦è§£


### 2.1 RewriteæŒ‡ä»¤åŸºæœ¬è¯­æ³•


**ğŸ“ è¯­æ³•æ ¼å¼**
```nginx
rewrite regex replacement [flag];
```

**ğŸ”¸ å‚æ•°è¯´æ˜**
```
regexï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…åŸå§‹URL
replacementï¼šæ›¿æ¢åçš„URL
flagï¼šé‡å†™æ ‡å¿—ï¼Œæ§åˆ¶å¤„ç†æ–¹å¼

ä½ç½®è¦æ±‚ï¼š
â€¢ å¯ä»¥ç”¨åœ¨ serverã€location å—ä¸­
â€¢ æ‰§è¡Œé¡ºåºï¼šæŒ‰åœ¨é…ç½®æ–‡ä»¶ä¸­çš„é¡ºåºæ‰§è¡Œ
â€¢ å¯ä»¥æœ‰å¤šæ¡rewriteè§„åˆ™
```

### 2.2 Rewriteæ ‡å¿—è¯¦è§£


**ğŸ·ï¸ å¸¸ç”¨æ ‡å¿—å¯¹æ¯”**

| **æ ‡å¿—** | **å«ä¹‰** | **è¡Œä¸º** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|----------|-------------|
| **last** | åœæ­¢å¤„ç†å½“å‰rewrite | é‡æ–°åŒ¹é…location | å†…éƒ¨è·³è½¬åˆ°æ–°location |
| **break** | åœæ­¢å¤„ç†rewrite | ç»§ç»­å½“å‰location | åœ¨å½“å‰locationå†…å¤„ç† |
| **redirect** | ä¸´æ—¶é‡å®šå‘(302) | è¿”å›302çŠ¶æ€ç  | ä¸´æ—¶URLå˜æ›´ |
| **permanent** | æ°¸ä¹…é‡å®šå‘(301) | è¿”å›301çŠ¶æ€ç  | æ°¸ä¹…URLå˜æ›´ |

**ğŸ’­ é€šä¿—ç†è§£**
```
æƒ³è±¡ä½ åœ¨å•†åœºæ‰¾åº—é“ºï¼š

lastæ ‡å¿—ï¼š
â€¢ å‘Šè¯‰ä½ "è¿™ä¸ªåº—æ¬åˆ°3æ¥¼äº†"
â€¢ ä½ é‡æ–°ä»1æ¥¼å¼€å§‹æ‰¾è·¯
â€¢ ç›¸å½“äºé‡æ–°å¼€å§‹å®šä½

breakæ ‡å¿—ï¼š
â€¢ å‘Šè¯‰ä½ "å°±åœ¨è¿™ä¸€å±‚ï¼Œå¾€å‰èµ°"
â€¢ ä½ ç»§ç»­åœ¨å½“å‰æ¥¼å±‚æ‰¾
â€¢ ä¸ä¼šå›åˆ°å…¥å£é‡æ–°å¼€å§‹

redirectæ ‡å¿—ï¼š
â€¢ ç»™ä½ ä¸€å¼ çº¸æ¡å†™ç€æ–°åœ°å€
â€¢ ä½ éœ€è¦é‡æ–°å‡ºå‘å»æ–°åœ°å€
â€¢ æµè§ˆå™¨ä¼šæ˜¾ç¤ºæ–°URL

permanentæ ‡å¿—ï¼š
â€¢ åº—é“ºæ°¸ä¹…æ¬è¿é€šçŸ¥
â€¢ ä»¥åéƒ½è¦å»æ–°åœ°å€
â€¢ æœç´¢å¼•æ“ä¼šæ›´æ–°ç´¢å¼•
```

### 2.3 æ­£åˆ™è¡¨è¾¾å¼å¸¸ç”¨æ¨¡å¼


**ğŸ” åŸºç¡€æ­£åˆ™ç¬¦å·**

| **ç¬¦å·** | **å«ä¹‰** | **ç¤ºä¾‹** | **åŒ¹é…ç»“æœ** |
|---------|----------|----------|-------------|
| **^** | è¡Œå¼€å§‹ | `^/api` | ä»¥/apiå¼€å¤´çš„URL |
| **$** | è¡Œç»“æŸ | `.html$` | ä»¥.htmlç»“å°¾çš„URL |
| **.** | ä»»æ„å­—ç¬¦ | `/p.ge` | /page, /pigeç­‰ |
| **+** | ä¸€ä¸ªæˆ–å¤šä¸ª | `/news/\d+` | /news/123, /news/456 |
| **\*** | é›¶ä¸ªæˆ–å¤šä¸ª | `/blog.*` | /blog, /blog/post |
| **()** | æ•è·ç»„ | `^/(\w+)/(\d+)$` | æ•è·ä¸¤ä¸ªå‚æ•° |

**ğŸ“Š å®ç”¨ç¤ºä¾‹**
```nginx
# ç¤ºä¾‹1ï¼šæ•è·æ–‡ç« ID
rewrite ^/article/(\d+)$ /show.php?id=$1 last;
# åŒ¹é…ï¼š/article/123 â†’ /show.php?id=123

# ç¤ºä¾‹2ï¼šæ•è·åˆ†ç±»å’ŒID
rewrite ^/(\w+)/(\d+)$ /index.php?category=$1&id=$2 last;
# åŒ¹é…ï¼š/tech/456 â†’ /index.php?category=tech&id=456

# ç¤ºä¾‹3ï¼šç§»é™¤æ–‡ä»¶æ‰©å±•å
rewrite ^/(.*)\.html$ /$1 permanent;
# åŒ¹é…ï¼š/about.html â†’ /about
```

---

## 3. ğŸ” SEOå‹å¥½URLå®ç°


### 3.1 é™æ€åŒ–URLè®¾è®¡åŸåˆ™


**ğŸ¯ SEOæœ€ä½³å®è·µ**
```
ä¼˜ç§€URLç‰¹å¾ï¼š
âœ… ç®€çŸ­æ˜“è®°ï¼š/product/laptop æ¯” /p.php?id=123å¥½
âœ… åŒ…å«å…³é”®è¯ï¼š/nginx-tutorial æ¯” /article/001å¥½  
âœ… å±‚æ¬¡æ¸…æ™°ï¼š/blog/2024/nginx-guide
âœ… é¿å…ç‰¹æ®Šå­—ç¬¦ï¼šä¸ç”¨ &ã€?ã€= ç­‰
âœ… ä½¿ç”¨è¿å­—ç¬¦ï¼šnginx-config æ¯” nginx_configå¥½
```

**âŒ é¿å…çš„URLæ¨¡å¼**
```
åŠ¨æ€å‚æ•°è¿‡å¤šï¼š
/index.php?page=product&category=laptop&brand=dell&color=black

URLè¿‡é•¿ï¼š
/very/deep/nested/structure/that/makes/no/sense/product

ç‰¹æ®Šå­—ç¬¦æ··ä¹±ï¼š
/product?id=123&cat=5#section1?ref=google

ä¸­æ–‡å­—ç¬¦ï¼ˆéœ€ç¼–ç ï¼‰ï¼š
/äº§å“/ç¬”è®°æœ¬ â†’ /%E4%BA%A7%E5%93%81/%E7%AC%94%E8%AE%B0%E6%9C%AC
```

### 3.2 ç”µå•†ç½‘ç«™URLé‡å†™


**ğŸ›’ å•†å“é¡µé¢é‡å†™**
```nginx
# å•†å“è¯¦æƒ…é¡µï¼š/product/åˆ†ç±»/å•†å“ID
rewrite ^/product/([a-zA-Z0-9-]+)/(\d+)/?$ /product.php?category=$1&id=$2 last;

# åˆ†ç±»é¡µé¢ï¼š/category/åˆ†ç±»å/é¡µç 
rewrite ^/category/([a-zA-Z0-9-]+)/?$ /category.php?name=$1 last;
rewrite ^/category/([a-zA-Z0-9-]+)/page/(\d+)/?$ /category.php?name=$1&page=$2 last;

# å“ç‰Œé¡µé¢ï¼š/brand/å“ç‰Œå
rewrite ^/brand/([a-zA-Z0-9-]+)/?$ /brand.php?name=$1 last;

# æœç´¢é¡µé¢ï¼š/search/å…³é”®è¯
rewrite ^/search/([^/]+)/?$ /search.php?q=$1 last;
```

**ğŸ”— URLæ˜ å°„ç¤ºä¾‹**
```
ç”¨æˆ·è®¿é—®çš„URL â†’ å®é™…å¤„ç†çš„æ–‡ä»¶

/product/laptop/123
â†’ /product.php?category=laptop&id=123

/category/electronics/page/2  
â†’ /category.php?name=electronics&page=2

/brand/apple
â†’ /brand.php?name=apple

/search/macbook-pro
â†’ /search.php?q=macbook-pro
```

### 3.3 åšå®¢ç½‘ç«™URLé‡å†™


**ğŸ“ åšå®¢URLä¼˜åŒ–**
```nginx
# æ–‡ç« é¡µé¢ï¼š/å¹´ä»½/æœˆä»½/æ–‡ç« æ ‡é¢˜
rewrite ^/(\d{4})/(\d{2})/([a-zA-Z0-9-]+)/?$ /post.php?year=$1&month=$2&slug=$3 last;

# åˆ†ç±»é¡µé¢ï¼š/category/åˆ†ç±»å
rewrite ^/category/([a-zA-Z0-9-]+)/?$ /category.php?cat=$1 last;

# æ ‡ç­¾é¡µé¢ï¼š/tag/æ ‡ç­¾å  
rewrite ^/tag/([a-zA-Z0-9-]+)/?$ /tag.php?tag=$1 last;

# ä½œè€…é¡µé¢ï¼š/author/ä½œè€…å
rewrite ^/author/([a-zA-Z0-9-]+)/?$ /author.php?author=$1 last;

# å½’æ¡£é¡µé¢ï¼š/archive/å¹´ä»½
rewrite ^/archive/(\d{4})/?$ /archive.php?year=$1 last;
```

---

## 4. ğŸ­ ä¼ªé™æ€åŒ–å®æˆ˜


### 4.1 ä»€ä¹ˆæ˜¯ä¼ªé™æ€


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
ä¼ªé™æ€ = å‡è£…çš„é™æ€é¡µé¢

çœŸå®é™æ€é¡µé¢ï¼š
â€¢ æœåŠ¡å™¨ä¸ŠçœŸå®å­˜åœ¨.htmlæ–‡ä»¶
â€¢ ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹è¿”å›
â€¢ é€Ÿåº¦å¿«ï¼Œä½†æ›´æ–°ä¸ä¾¿

ä¼ªé™æ€é¡µé¢ï¼š
â€¢ çœ‹èµ·æ¥åƒ.htmlï¼Œå®é™…æ˜¯åŠ¨æ€ç”Ÿæˆ
â€¢ é€šè¿‡é‡å†™è§„åˆ™è½¬æ¢ä¸ºåŠ¨æ€é¡µé¢
â€¢ å…¼é¡¾SEOå’ŒåŠ¨æ€åŠŸèƒ½
```

**ğŸ”„ å·¥ä½œæµç¨‹å¯¹æ¯”**
```
ä¼ ç»ŸåŠ¨æ€é¡µé¢è®¿é—®ï¼š
ç”¨æˆ· â†’ /news.php?id=123 â†’ PHPå¤„ç† â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ è¿”å›å†…å®¹

ä¼ªé™æ€é¡µé¢è®¿é—®ï¼š
ç”¨æˆ· â†’ /news/123.html â†’ Nginxé‡å†™ â†’ /news.php?id=123 â†’ è¿”å›å†…å®¹

ç”¨æˆ·çœ‹åˆ°ï¼š/news/123.htmlï¼ˆçœ‹èµ·æ¥åƒé™æ€æ–‡ä»¶ï¼‰
å®é™…å¤„ç†ï¼š/news.php?id=123ï¼ˆåŠ¨æ€é¡µé¢å¤„ç†ï¼‰
```

### 4.2 å¸¸è§CMSä¼ªé™æ€è§„åˆ™


**ğŸ“° WordPressä¼ªé™æ€**
```nginx
location / {
    try_files $uri $uri/ /index.php?$args;
}

# è‡ªå®šä¹‰å›ºå®šé“¾æ¥ç»“æ„
location ~* ^/(\d{4})/(\d{2})/(.+)\.html$ {
    rewrite ^/(\d{4})/(\d{2})/(.+)\.html$ /index.php?year=$1&monthnum=$2&name=$3 last;
}

# åˆ†ç±»å’Œæ ‡ç­¾é¡µé¢
rewrite ^/category/(.+)/?$ /index.php?category_name=$1 last;
rewrite ^/tag/(.+)/?$ /index.php?tag=$1 last;
```

**ğŸ›ï¸ Discuzè®ºå›ä¼ªé™æ€**
```nginx
# ä¸»é¢˜é¡µé¢
rewrite ^/thread-([0-9]+)-([0-9]+)-([0-9]+)\.html$ /viewthread.php?tid=$1&extra=page%3D$3 last;

# ç‰ˆå—é¡µé¢  
rewrite ^/forum-([0-9]+)-([0-9]+)\.html$ /forumdisplay.php?fid=$1&page=$2 last;

# ç”¨æˆ·ç©ºé—´
rewrite ^/space-([a-zA-Z0-9_\-]+)\.html$ /space.php?username=$1 last;
```

### 4.3 è‡ªå®šä¹‰ä¼ªé™æ€æ–¹æ¡ˆ


**ğŸ—ï¸ æ–°é—»ç½‘ç«™ä¼ªé™æ€**
```nginx
server {
    listen 80;
    server_name news.example.com;
    root /var/www/news;
    index index.php;

    # é¦–é¡µ
    location = / {
        rewrite ^/$ /index.php last;
    }

    # æ–°é—»è¯¦æƒ…ï¼š/news/2024/technology/article-title.html
    location ~* ^/news/(\d{4})/([a-zA-Z0-9-]+)/([a-zA-Z0-9-]+)\.html$ {
        rewrite ^/news/(\d{4})/([a-zA-Z0-9-]+)/([a-zA-Z0-9-]+)\.html$ /article.php?year=$1&category=$2&title=$3 last;
    }

    # åˆ†ç±»åˆ—è¡¨ï¼š/category/technology.html
    location ~* ^/category/([a-zA-Z0-9-]+)\.html$ {
        rewrite ^/category/([a-zA-Z0-9-]+)\.html$ /category.php?name=$1 last;
    }

    # åˆ†é¡µï¼š/category/technology/page/2.html
    location ~* ^/category/([a-zA-Z0-9-]+)/page/(\d+)\.html$ {
        rewrite ^/category/([a-zA-Z0-9-]+)/page/(\d+)\.html$ /category.php?name=$1&page=$2 last;
    }

    # PHPæ–‡ä»¶å¤„ç†
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

---

## 5. ğŸŒ åŸŸåè·³è½¬ä¸è·¯å¾„é‡å†™


### 5.1 åŸŸåè§„èŒƒåŒ–è·³è½¬


**ğŸ”„ å¸¸è§åŸŸåè·³è½¬éœ€æ±‚**

| **åœºæ™¯** | **åŸåŸŸå** | **ç›®æ ‡åŸŸå** | **ç›®çš„** |
|---------|------------|-------------|----------|
| **WWWç»Ÿä¸€** | `example.com` | `www.example.com` | SEOæƒé‡é›†ä¸­ |
| **HTTPSè·³è½¬** | `http://example.com` | `https://example.com` | å®‰å…¨å‡çº§ |
| **åŸŸåæ›´æ¢** | `old-site.com` | `new-site.com` | å“ç‰Œå‡çº§ |
| **å¤šåŸŸååˆå¹¶** | `blog.example.com` | `example.com/blog` | ç®€åŒ–ç®¡ç† |

**ğŸ”§ WWWåŸŸåç»Ÿä¸€**
```nginx
# æ–¹æ¡ˆ1ï¼šä¸å¸¦wwwè·³è½¬åˆ°å¸¦www
server {
    listen 80;
    server_name example.com;
    return 301 https://www.example.com$request_uri;
}

# æ–¹æ¡ˆ2ï¼šå¸¦wwwè·³è½¬åˆ°ä¸å¸¦www  
server {
    listen 80;
    server_name www.example.com;
    return 301 https://example.com$request_uri;
}

# ä¸»ç«™é…ç½®
server {
    listen 80;
    server_name www.example.com;  # æˆ– example.com
    # å…¶ä»–é…ç½®...
}
```

### 5.2 HTTPSå¼ºåˆ¶è·³è½¬


**ğŸ”’ HTTPåˆ°HTTPSè·³è½¬**
```nginx
# æ–¹æ³•1ï¼šç®€å•ç²—æš´è·³è½¬
server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$server_name$request_uri;
}

# æ–¹æ³•2ï¼šä¿ç•™æŸ¥è¯¢å‚æ•°çš„è·³è½¬
server {
    listen 80;
    server_name example.com www.example.com;
    
    location / {
        return 301 https://$host$request_uri;
    }
}

# HTTPSä¸»ç«™é…ç½®
server {
    listen 443 ssl;
    server_name example.com www.example.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/cert.crt;
    ssl_certificate_key /path/to/private.key;
    
    # å…¶ä»–é…ç½®...
}
```

### 5.3 å¤æ‚è·¯å¾„é‡å†™åœºæ™¯


**ğŸ—‚ï¸ ç½‘ç«™æ”¹ç‰ˆè·¯å¾„è¿ç§»**
```nginx
server {
    listen 80;
    server_name example.com;

    # æ—§çš„æ–°é—»è·¯å¾„è¿ç§»
    # æ—§ï¼š/news.php?id=123 â†’ æ–°ï¼š/news/123
    location ~* ^/news\.php$ {
        if ($arg_id) {
            return 301 /news/$arg_id;
        }
        return 301 /news/;
    }

    # æ—§çš„äº§å“è·¯å¾„è¿ç§»  
    # æ—§ï¼š/product.php?cat=laptop&id=456 â†’ æ–°ï¼š/product/laptop/456
    location ~* ^/product\.php$ {
        if ($arg_cat) {
            return 301 /product/$arg_cat/$arg_id;
        }
        return 301 /product/;
    }

    # æ—§çš„ç”¨æˆ·ä¸­å¿ƒè¿ç§»
    # æ—§ï¼š/user.php?action=profile â†’ æ–°ï¼š/user/profile  
    location ~* ^/user\.php$ {
        return 301 /user/$arg_action;
    }

    # æ–°è·¯å¾„çš„å¤„ç†è§„åˆ™
    location ~* ^/news/(\d+)$ {
        rewrite ^/news/(\d+)$ /news.php?id=$1 last;
    }
    
    location ~* ^/product/([^/]+)/(\d+)$ {
        rewrite ^/product/([^/]+)/(\d+)$ /product.php?cat=$1&id=$2 last;
    }
}
```

---

## 6. ğŸ“± ç§»åŠ¨ç«¯é€‚é…é‡å†™


### 6.1 ç§»åŠ¨ç«¯æ£€æµ‹ä¸è·³è½¬


**ğŸ“² User-Agentæ£€æµ‹**
```nginx
# ç§»åŠ¨è®¾å¤‡æ£€æµ‹
map $http_user_agent $mobile {
    ~*"android|webos|iphone|ipod|blackberry|iemobile|opera mobile" 1;
    default 0;
}

server {
    listen 80;
    server_name example.com;

    # ç§»åŠ¨ç«¯è·³è½¬åˆ°æ‰‹æœºç‰ˆåŸŸå
    if ($mobile = 1) {
        return 301 https://m.example.com$request_uri;
    }

    # æ¡Œé¢ç‰ˆé…ç½®
    location / {
        root /var/www/desktop;
        index index.html;
    }
}

# æ‰‹æœºç‰ˆç½‘ç«™é…ç½®
server {
    listen 80;
    server_name m.example.com;
    
    location / {
        root /var/www/mobile;
        index index.html;
    }
    
    # ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©æ¡Œé¢ç‰ˆ
    location /desktop {
        return 301 https://example.com$request_uri;
    }
}
```

### 6.2 å“åº”å¼é‡å†™è§„åˆ™


**ğŸ”„ æ™ºèƒ½è·¯å¾„é€‚é…**
```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;

    # æ ¹æ®è®¾å¤‡ç±»å‹é€‰æ‹©ä¸åŒæ¨¡æ¿
    location / {
        # ç§»åŠ¨ç«¯ä½¿ç”¨ç§»åŠ¨æ¨¡æ¿
        if ($mobile = 1) {
            rewrite ^/(.*)$ /mobile/$1 break;
        }
        
        # å¹³æ¿ä½¿ç”¨å¹³æ¿æ¨¡æ¿
        if ($http_user_agent ~* "ipad|android.*tablet") {
            rewrite ^/(.*)$ /tablet/$1 break;
        }
        
        # é»˜è®¤æ¡Œé¢ç‰ˆ
        try_files $uri $uri/ /index.html;
    }

    # APIæ¥å£ä¸åšè®¾å¤‡åŒºåˆ†
    location /api {
        proxy_pass http://backend;
    }
}
```

### 6.3 ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–


**âš¡ ç§»åŠ¨ä¼˜åŒ–é‡å†™**
```nginx
server {
    listen 80;
    server_name m.example.com;
    root /var/www/mobile;

    # ç§»åŠ¨ç«¯å›¾ç‰‡ä¼˜åŒ–
    location ~* \.(jpg|jpeg|png|gif)$ {
        # æ ¹æ®å±å¹•å¯†åº¦é€‰æ‹©å›¾ç‰‡
        if ($http_user_agent ~* "retina|@2x") {
            rewrite ^/images/(.+)\.(jpg|jpeg|png|gif)$ /images/retina/$1.$2 break;
        }
        
        # é»˜è®¤å›¾ç‰‡è·¯å¾„
        try_files $uri /images/default/$uri =404;
        
        # ç¼“å­˜è®¾ç½®
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # ç§»åŠ¨ç«¯CSS/JSä¼˜åŒ–
    location ~* \.(css|js)$ {
        # å‹ç¼©ç‰ˆæœ¬
        try_files $uri.min $uri =404;
        expires 7d;
        gzip on;
    }
}
```

---

## 7. ğŸ”Œ APIè·¯ç”±é‡å†™


### 7.1 RESTful APIè·¯ç”±è®¾è®¡


**ğŸŒŸ RESTfulé£æ ¼é‡å†™**
```nginx
server {
    listen 80;
    server_name api.example.com;

    # APIç‰ˆæœ¬æ§åˆ¶ï¼š/v1/users/123 â†’ /api.php?version=1&resource=users&id=123
    location ~* ^/v([0-9]+)/([^/]+)/?$ {
        rewrite ^/v([0-9]+)/([^/]+)/?$ /api.php?version=$1&resource=$2 last;
    }

    # å¸¦IDçš„èµ„æºï¼š/v1/users/123 â†’ /api.php?version=1&resource=users&id=123
    location ~* ^/v([0-9]+)/([^/]+)/([0-9]+)/?$ {
        rewrite ^/v([0-9]+)/([^/]+)/([0-9]+)/?$ /api.php?version=$1&resource=$2&id=$3 last;
    }

    # å­èµ„æºï¼š/v1/users/123/posts â†’ /api.php?version=1&resource=users&id=123&sub=posts
    location ~* ^/v([0-9]+)/([^/]+)/([0-9]+)/([^/]+)/?$ {
        rewrite ^/v([0-9]+)/([^/]+)/([0-9]+)/([^/]+)/?$ /api.php?version=$1&resource=$2&id=$3&sub=$4 last;
    }

    # PHPå¤„ç†
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }
}
```

### 7.2 å¾®æœåŠ¡è·¯ç”±åˆ†å‘


**ğŸ”€ æœåŠ¡è·¯ç”±é‡å†™**
```nginx
upstream user_service {
    server 127.0.0.1:3001;
}

upstream order_service {
    server 127.0.0.1:3002;
}

upstream product_service {
    server 127.0.0.1:3003;
}

server {
    listen 80;
    server_name api.example.com;

    # ç”¨æˆ·æœåŠ¡è·¯ç”±
    location ~* ^/api/v1/user(.*) {
        rewrite ^/api/v1/user(.*)$ /user$1 break;
        proxy_pass http://user_service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # è®¢å•æœåŠ¡è·¯ç”±
    location ~* ^/api/v1/order(.*) {
        rewrite ^/api/v1/order(.*)$ /order$1 break;
        proxy_pass http://order_service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # å•†å“æœåŠ¡è·¯ç”±  
    location ~* ^/api/v1/product(.*) {
        rewrite ^/api/v1/product(.*)$ /product$1 break;
        proxy_pass http://product_service;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 8. ğŸ› ï¸ å®æˆ˜æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ


### 8.1 ç”µå•†ç½‘ç«™å®Œæ•´é‡å†™æ–¹æ¡ˆ


**ğŸ›’ ç»¼åˆæ¡ˆä¾‹ï¼šåœ¨çº¿å•†åŸ**
```nginx
server {
    listen 80;
    server_name shop.example.com;
    root /var/www/shop;
    index index.php;

    # é¦–é¡µ
    location = / {
        try_files /index.html /index.php;
    }

    # å•†å“è¯¦æƒ…ï¼š/product/æ‰‹æœº/iphone-15/123
    location ~* ^/product/([^/]+)/([^/]+)/(\d+)/?$ {
        rewrite ^/product/([^/]+)/([^/]+)/(\d+)/?$ /product.php?category=$1&slug=$2&id=$3 last;
    }

    # åˆ†ç±»é¡µé¢ï¼š/category/æ‰‹æœº/page/2
    location ~* ^/category/([^/]+)/?$ {
        rewrite ^/category/([^/]+)/?$ /category.php?name=$1 last;
    }
    
    location ~* ^/category/([^/]+)/page/(\d+)/?$ {
        rewrite ^/category/([^/]+)/page/(\d+)/?$ /category.php?name=$1&page=$2 last;
    }

    # å“ç‰Œé¡µé¢ï¼š/brand/apple
    location ~* ^/brand/([^/]+)/?$ {
        rewrite ^/brand/([^/]+)/?$ /brand.php?name=$1 last;
    }

    # æœç´¢ç»“æœï¼š/search/iphone
    location ~* ^/search/([^/]+)/?$ {
        rewrite ^/search/([^/]+)/?$ /search.php?q=$1 last;
    }

    # ç”¨æˆ·ä¸­å¿ƒï¼š/user/profile, /user/orders
    location ~* ^/user/([^/]+)/?$ {
        rewrite ^/user/([^/]+)/?$ /user.php?action=$1 last;
    }

    # è´­ç‰©è½¦å’Œç»“ç®—
    location /cart {
        rewrite ^/cart/?$ /cart.php last;
    }
    
    location /checkout {
        rewrite ^/checkout/?$ /checkout.php last;
    }

    # PHPå¤„ç†
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 8.2 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**âš ï¸ é‡å†™è§„åˆ™è°ƒè¯•**

| **é—®é¢˜** | **ç°è±¡** | **è§£å†³æ–¹æ¡ˆ** |
|---------|----------|-------------|
| **é‡å†™æ­»å¾ªç¯** | é¡µé¢æ— æ³•è®¿é—®ï¼Œå‡ºç°500é”™è¯¯ | æ£€æŸ¥é‡å†™è§„åˆ™æ˜¯å¦ä¼šå¾ªç¯åŒ¹é… |
| **å‚æ•°ä¸¢å¤±** | é‡å†™åGETå‚æ•°æ¶ˆå¤± | åœ¨replacementä¸­åŠ ä¸Š`?$args` |
| **æ€§èƒ½é—®é¢˜** | æ­£åˆ™åŒ¹é…è¿‡å¤šå½±å“æ€§èƒ½ | ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½¿ç”¨æ›´ç²¾ç¡®çš„location |
| **ä¸­æ–‡URLé—®é¢˜** | ä¸­æ–‡è·¯å¾„æ— æ³•æ­£ç¡®åŒ¹é… | ç¡®ä¿ç¼–ç ä¸€è‡´ï¼Œè€ƒè™‘ä½¿ç”¨IDæ›¿ä»£ä¸­æ–‡ |

**ğŸ”§ è°ƒè¯•æŠ€å·§**
```nginx
# å¼€å¯é‡å†™æ—¥å¿—
error_log /var/log/nginx/rewrite.log notice;
rewrite_log on;

# åœ¨é…ç½®ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯
location ~* ^/debug/(.*)$ {
    # è®°å½•åŸå§‹è¯·æ±‚
    access_log /var/log/nginx/debug.log;
    
    # é‡å†™è§„åˆ™
    rewrite ^/debug/(.*)$ /test.php?path=$1 last;
}
```

### 8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ é‡å†™æ€§èƒ½ä¼˜åŒ–**
```nginx
# 1. ä½¿ç”¨ç²¾ç¡®çš„locationåŒ¹é…
location = /api/user {
    # ç²¾ç¡®åŒ¹é…ï¼Œæ€§èƒ½æœ€å¥½
    rewrite ^/api/user$ /user.php last;
}

# 2. é¿å…å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
# å·®çš„å†™æ³•
location ~* ^/(.*)/(.*)/(.*)/(.*)/(.*)$ {
    rewrite ^/(.*)/(.*)/(.*)/(.*)/(.*)$ /complex.php?p1=$1&p2=$2&p3=$3&p4=$4&p5=$5 last;
}

# å¥½çš„å†™æ³•  
location /api/v1/users/ {
    rewrite ^/api/v1/users/(.*)$ /users.php?path=$1 last;
}

# 3. åˆç†ä½¿ç”¨try_filesæ›¿ä»£rewrite
location / {
    # ä¼˜å…ˆä½¿ç”¨try_files
    try_files $uri $uri/ @fallback;
}

location @fallback {
    rewrite ^/(.*)$ /index.php?path=$1 last;
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ URLé‡å†™æœ¬è´¨ï¼šå°†ç”¨æˆ·å‹å¥½çš„URLè½¬æ¢ä¸ºç¨‹åºå¤„ç†çš„URL
ğŸ”¸ é‡å†™vsé‡å®šå‘ï¼šå†…éƒ¨è½¬å‘vså¤–éƒ¨è·³è½¬çš„åŒºåˆ«  
ğŸ”¸ æ­£åˆ™è¡¨è¾¾å¼ï¼šæŒæ¡åŸºæœ¬çš„åŒ¹é…æ¨¡å¼å’Œæ•è·ç»„
ğŸ”¸ é‡å†™æ ‡å¿—ï¼šlastã€breakã€redirectã€permanentçš„ä½¿ç”¨åœºæ™¯
ğŸ”¸ SEOä»·å€¼ï¼šé™æ€åŒ–URLå¯¹æœç´¢å¼•æ“ä¼˜åŒ–çš„é‡è¦æ€§
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é‡å†™æ ‡å¿—çš„é€‰æ‹©**
```
å†…éƒ¨å¤„ç†ç”¨ï¼šlastã€break
â€¢ lastï¼šéœ€è¦é‡æ–°åŒ¹é…location
â€¢ breakï¼šç»§ç»­å½“å‰locationå¤„ç†

å¤–éƒ¨è·³è½¬ç”¨ï¼šredirectã€permanent  
â€¢ redirectï¼šä¸´æ—¶è·³è½¬(302)
â€¢ permanentï¼šæ°¸ä¹…è·³è½¬(301)

è®°å¿†æ–¹æ³•ï¼š
â€¢ å†…éƒ¨å¤„ç†ä¸æ¢åœ°å€ï¼Œå¤–éƒ¨è·³è½¬è¦æ¢åœ°å€
â€¢ ä¸´æ—¶çš„ç”¨redirectï¼Œæ°¸ä¹…çš„ç”¨permanent
```

**ğŸ”¹ æ­£åˆ™è¡¨è¾¾å¼æŠ€å·§**
```
å¸¸ç”¨æ¨¡å¼è®°å¿†ï¼š
â€¢ \d+ ï¼šä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ï¼ˆç”¨äºIDï¼‰
â€¢ \w+ ï¼šä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æ•°å­—ï¼ˆç”¨äºåç§°ï¼‰
â€¢ [^/]+ ï¼šé™¤äº†æ–œæ å¤–çš„ä»»æ„å­—ç¬¦ï¼ˆç”¨äºè·¯å¾„æ®µï¼‰
â€¢ (.*) ï¼šæ•è·ä»»æ„å†…å®¹ï¼ˆè´ªå©ªåŒ¹é…ï¼‰
â€¢ (.+?) ï¼šæ•è·ä»»æ„å†…å®¹ï¼ˆéè´ªå©ªåŒ¹é…ï¼‰

è°ƒè¯•æŠ€å·§ï¼š
â€¢ ä»ç®€å•åˆ°å¤æ‚é€æ­¥æ„å»ºæ­£åˆ™
â€¢ ä½¿ç”¨åœ¨çº¿æ­£åˆ™æµ‹è¯•å·¥å…·éªŒè¯
â€¢ å¼€å¯rewrite_logæŸ¥çœ‹åŒ¹é…è¿‡ç¨‹
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†ç½‘ç«™**ï¼šå•†å“URLç¾åŒ–ï¼Œåˆ†ç±»å¯¼èˆªä¼˜åŒ–
- **æ–°é—»ç½‘ç«™**ï¼šæ–‡ç« é“¾æ¥SEOä¼˜åŒ–ï¼Œå½’æ¡£é¡µé¢æ•´ç†
- **ä¼ä¸šå®˜ç½‘**ï¼šé¡µé¢URLè§„èŒƒåŒ–ï¼Œç§»åŠ¨ç«¯é€‚é…
- **APIæœåŠ¡**ï¼šRESTfulæ¥å£è®¾è®¡ï¼Œå¾®æœåŠ¡è·¯ç”±
- **å¤šè¯­è¨€ç«™ç‚¹**ï¼šè¯­è¨€åˆ‡æ¢ï¼Œæœ¬åœ°åŒ–URL

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**
- **SEOæå‡**ï¼šæé«˜æœç´¢å¼•æ“æ”¶å½•å’Œæ’å
- **ç”¨æˆ·ä½“éªŒ**ï¼šURLæ›´æ˜“è®°å¿†å’Œåˆ†äº«
- **ç³»ç»Ÿè¿ç§»**ï¼šå¹³æ»‘çš„ç‰ˆæœ¬å‡çº§å’Œæ¶æ„è°ƒæ•´
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†çš„ç¼“å­˜ç­–ç•¥å’Œè®¿é—®æ§åˆ¶
- **å®‰å…¨å¢å¼º**ï¼šéšè—çœŸå®çš„ç³»ç»Ÿæ¶æ„ä¿¡æ¯

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é‡å†™è§„åˆ™è¦ç²¾å‡†ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯å…³é”®
- å†…éƒ¨è½¬å‘ç”¨last breakï¼Œå¤–éƒ¨è·³è½¬ç”¨redirect
- SEOä¼˜åŒ–é é™æ€ï¼Œç”¨æˆ·ä½“éªŒè¦å‹å¥½
- è°ƒè¯•å¼€å¯æ—¥å¿—çœ‹ï¼Œæ€§èƒ½ä¼˜åŒ–é¿å…å¤æ‚

**ğŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
1. å…ˆæŒæ¡åŸºç¡€è¯­æ³•å’Œå¸¸ç”¨æ­£åˆ™
2. é€šè¿‡å®é™…é¡¹ç›®ç»ƒä¹ ä¸åŒåœºæ™¯
3. å…³æ³¨SEOå’Œç”¨æˆ·ä½“éªŒçš„å¹³è¡¡
4. å­¦ä¼šè°ƒè¯•å’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§