---
title: 2ã€nginx-é™æ€ç¼“å­˜
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯é™æ€ç¼“å­˜](#1-ä»€ä¹ˆæ˜¯é™æ€ç¼“å­˜)
2. [expiresæŒ‡ä»¤è¯¦è§£](#2-expiresæŒ‡ä»¤è¯¦è§£)
3. [add_headeræŒ‡ä»¤ä½¿ç”¨](#3-add_headeræŒ‡ä»¤ä½¿ç”¨)
4. [Cache-Controlè®¾ç½®ç­–ç•¥](#4-Cache-Controlè®¾ç½®ç­–ç•¥)
5. [ETagä¸Last-Modified](#5-ETagä¸Last-Modified)
6. [æµè§ˆå™¨ç¼“å­˜ç­–ç•¥](#6-æµè§ˆå™¨ç¼“å­˜ç­–ç•¥)
7. [å®Œæ•´é…ç½®å®ä¾‹](#7-å®Œæ•´é…ç½®å®ä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŸ ä»€ä¹ˆæ˜¯é™æ€ç¼“å­˜


### 1.1 é™æ€ç¼“å­˜çš„æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šå°±åƒä½ æŠŠå¸¸ç”¨çš„ä¸œè¥¿æ”¾åœ¨èº«è¾¹ï¼Œä¸‹æ¬¡ç”¨çš„æ—¶å€™ä¸ç”¨è·‘è¿œè·¯å»æ‹¿

```
æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µï¼š
ç”¨æˆ·æ¯æ¬¡è®¿é—® â†’ æœåŠ¡å™¨é‡æ–°å‘é€æ–‡ä»¶ â†’ æµªè´¹å¸¦å®½å’Œæ—¶é—´

æœ‰ç¼“å­˜çš„æƒ…å†µï¼š
ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—® â†’ æœåŠ¡å™¨å‘é€æ–‡ä»¶+ç¼“å­˜è§„åˆ™
ç”¨æˆ·å†æ¬¡è®¿é—® â†’ æµè§ˆå™¨ç›´æ¥ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ â†’ å¿«é€ŸåŠ è½½
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
```
âœ… å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼šä¸ç”¨æ¯æ¬¡éƒ½å¤„ç†ç›¸åŒè¯·æ±‚
âœ… æå‡ç”¨æˆ·ä½“éªŒï¼šé¡µé¢åŠ è½½æ›´å¿«
âœ… èŠ‚çœç½‘ç»œå¸¦å®½ï¼šå‡å°‘é‡å¤ä¼ è¾“
âœ… é™ä½æœåŠ¡å™¨æˆæœ¬ï¼šå‡å°‘èµ„æºæ¶ˆè€—
```

### 1.2 å“ªäº›æ–‡ä»¶é€‚åˆç¼“å­˜


**ğŸ“ é€‚åˆç¼“å­˜çš„é™æ€èµ„æº**
```
å›¾ç‰‡æ–‡ä»¶ï¼š.jpg, .png, .gif, .svg
æ ·å¼æ–‡ä»¶ï¼š.css
è„šæœ¬æ–‡ä»¶ï¼š.js
å­—ä½“æ–‡ä»¶ï¼š.woff, .ttf
æ–‡æ¡£æ–‡ä»¶ï¼š.pdf, .doc
```

**âš ï¸ ä¸é€‚åˆç¼“å­˜çš„æ–‡ä»¶**
```
APIæ¥å£å“åº”ï¼šæ•°æ®ç»å¸¸å˜åŒ–
ç”¨æˆ·ç›¸å…³é¡µé¢ï¼šä¸ªäººä¿¡æ¯ã€è´­ç‰©è½¦
å®æ—¶æ•°æ®ï¼šè‚¡ä»·ã€å¤©æ°”ã€æ–°é—»
```

### 1.3 ç¼“å­˜å·¥ä½œåŸç†å›¾ç¤º


```
ç¬¬ä¸€æ¬¡è®¿é—®æµç¨‹ï¼š
æµè§ˆå™¨ â†’ [è¯·æ±‚style.css] â†’ NginxæœåŠ¡å™¨
æµè§ˆå™¨ â† [æ–‡ä»¶å†…å®¹+ç¼“å­˜å¤´] â† NginxæœåŠ¡å™¨
æµè§ˆå™¨ä¿å­˜æ–‡ä»¶åˆ°æœ¬åœ°ç¼“å­˜

å†æ¬¡è®¿é—®æµç¨‹ï¼š
æµè§ˆå™¨ â†’ æ£€æŸ¥æœ¬åœ°ç¼“å­˜ â†’ å‘ç°æœªè¿‡æœŸ
æµè§ˆå™¨ â†’ ç›´æ¥ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ âœ… (æ— éœ€è¯·æ±‚æœåŠ¡å™¨)
```

---

## 2. â° expiresæŒ‡ä»¤è¯¦è§£


### 2.1 expiresæŒ‡ä»¤åŸºæœ¬è¯­æ³•


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
`expires`æŒ‡ä»¤å‘Šè¯‰æµè§ˆå™¨ï¼š"è¿™ä¸ªæ–‡ä»¶åœ¨å¤šé•¿æ—¶é—´å†…æ˜¯æ–°é²œçš„ï¼Œä½ å¯ä»¥æ”¾å¿ƒä½¿ç”¨æœ¬åœ°å‰¯æœ¬"

```nginx
# åŸºæœ¬è¯­æ³•
expires [æ—¶é—´] | [off] | [epoch] | [max] | [modified];

# å¸¸ç”¨ç¤ºä¾‹
expires 30d;        # 30å¤©åè¿‡æœŸ
expires 1h;         # 1å°æ—¶åè¿‡æœŸ
expires -1;         # ç«‹å³è¿‡æœŸ
expires off;        # ä¸è®¾ç½®ç¼“å­˜
```

### 2.2 æ—¶é—´å•ä½è¯´æ˜


| æ—¶é—´å•ä½ | **å«ä¹‰** | **ç¤ºä¾‹** | **å®é™…æ•ˆæœ** |
|---------|---------|---------|-------------|
| `s` | `ç§’` | `expires 300s;` | `5åˆ†é’Ÿç¼“å­˜` |
| `m` | `åˆ†é’Ÿ` | `expires 30m;` | `30åˆ†é’Ÿç¼“å­˜` |
| `h` | `å°æ—¶` | `expires 2h;` | `2å°æ—¶ç¼“å­˜` |
| `d` | `å¤©` | `expires 7d;` | `1å‘¨ç¼“å­˜` |
| `w` | `å‘¨` | `expires 2w;` | `2å‘¨ç¼“å­˜` |
| `M` | `æœˆ` | `expires 6M;` | `6ä¸ªæœˆç¼“å­˜` |
| `y` | `å¹´` | `expires 1y;` | `1å¹´ç¼“å­˜` |

### 2.3 ä¸åŒç±»å‹æ–‡ä»¶çš„ç¼“å­˜æ—¶é—´å»ºè®®


```nginx
# é…ç½®ç¤ºä¾‹ï¼šæ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®ä¸åŒç¼“å­˜æ—¶é—´
server {
    listen 80;
    server_name example.com;
    
    # å›¾ç‰‡æ–‡ä»¶ - ç¼“å­˜1ä¸ªæœˆ
    location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
        expires 30d;
    }
    
    # CSS/JSæ–‡ä»¶ - ç¼“å­˜1å‘¨
    location ~* \.(css|js)$ {
        expires 7d;
    }
    
    # å­—ä½“æ–‡ä»¶ - ç¼“å­˜1å¹´
    location ~* \.(woff|woff2|ttf|eot)$ {
        expires 1y;
    }
    
    # HTMLæ–‡ä»¶ - ç¼“å­˜1å°æ—¶
    location ~* \.html$ {
        expires 1h;
    }
}
```

### 2.4 ç‰¹æ®Šexpireså€¼


**ğŸ”¸ è´Ÿæ•°å€¼ï¼šå¼ºåˆ¶ä¸ç¼“å­˜**
```nginx
# è®©æ–‡ä»¶ç«‹å³è¿‡æœŸï¼Œå¼ºåˆ¶æ¯æ¬¡éƒ½ä»æœåŠ¡å™¨è·å–
location /api/ {
    expires -1;
    # ç­‰åŒäºè®¾ç½®ï¼šCache-Control: no-cache
}
```

**ğŸ”¸ maxå€¼ï¼šæ°¸ä¹…ç¼“å­˜**
```nginx
# è®¾ç½®æœ€å¤§è¿‡æœŸæ—¶é—´ï¼ˆçº¦10å¹´ï¼‰
location /static/images/ {
    expires max;
    # ç­‰åŒäºï¼šexpires 10y;
}
```

**ğŸ”¸ offå€¼ï¼šä¸è®¾ç½®ç¼“å­˜å¤´**
```nginx
# ä¸æ·»åŠ ä»»ä½•ç¼“å­˜ç›¸å…³çš„HTTPå¤´
location /dynamic/ {
    expires off;
}
```

---

## 3. ğŸ“‹ add_headeræŒ‡ä»¤ä½¿ç”¨


### 3.1 add_headeråŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯add_header**
`add_header`æŒ‡ä»¤å…è®¸ä½ æ‰‹åŠ¨æ·»åŠ HTTPå“åº”å¤´ï¼Œç»™æµè§ˆå™¨æ›´è¯¦ç»†çš„ç¼“å­˜æŒ‡ä»¤

```nginx
# åŸºæœ¬è¯­æ³•
add_header å¤´åç§° å¤´å€¼ [always];

# ç¤ºä¾‹
add_header Cache-Control "public, max-age=3600";
add_header X-Cache-Status "HIT";
```

### 3.2 å¸¸ç”¨ç¼“å­˜å“åº”å¤´


**ğŸ”¸ Cache-Controlå“åº”å¤´**
```nginx
# å…¬å…±ç¼“å­˜ï¼Œæœ€å¤§ç¼“å­˜æ—¶é—´3600ç§’
add_header Cache-Control "public, max-age=3600";

# ç§æœ‰ç¼“å­˜ï¼Œåªèƒ½æµè§ˆå™¨ç¼“å­˜
add_header Cache-Control "private, max-age=1800";

# ç¦æ­¢ç¼“å­˜
add_header Cache-Control "no-cache, no-store, must-revalidate";

# å…è®¸ç¼“å­˜ä½†éœ€è¦éªŒè¯
add_header Cache-Control "no-cache";
```

**ğŸ”¸ å…¶ä»–å®ç”¨å“åº”å¤´**
```nginx
# æ·»åŠ è‡ªå®šä¹‰ç¼“å­˜çŠ¶æ€æ ‡è¯†
add_header X-Cache-Status "MISS" always;

# è®¾ç½®å®‰å…¨ç›¸å…³å¤´éƒ¨
add_header X-Content-Type-Options "nosniff";
add_header X-Frame-Options "DENY";

# è·¨åŸŸèµ„æºå…±äº«
add_header Access-Control-Allow-Origin "*";
```

### 3.3 add_headerä¸expiresçš„åŒºåˆ«


```
expiresæŒ‡ä»¤ï¼š
âœ… ç®€å•æ˜“ç”¨ï¼Œè‡ªåŠ¨è®¡ç®—è¿‡æœŸæ—¶é—´
âœ… åŒæ—¶è®¾ç½®Expireså’ŒCache-Controlå¤´
âŒ åŠŸèƒ½ç›¸å¯¹ç®€å•

add_headeræŒ‡ä»¤ï¼š
âœ… çµæ´»æ§åˆ¶ï¼Œå¯è®¾ç½®å¤æ‚ç¼“å­˜ç­–ç•¥
âœ… å¯æ·»åŠ ä»»æ„è‡ªå®šä¹‰å¤´éƒ¨
âŒ éœ€è¦æ‰‹åŠ¨è®¡ç®—æ—¶é—´å€¼
```

### 3.4 ç»„åˆä½¿ç”¨ç¤ºä¾‹


```nginx
location ~* \.(css|js)$ {
    # ä½¿ç”¨expiresè®¾ç½®åŸºæœ¬ç¼“å­˜
    expires 7d;
    
    # ä½¿ç”¨add_headeræ·»åŠ é¢å¤–æ§åˆ¶
    add_header Cache-Control "public, immutable";
    add_header X-Content-Type-Options "nosniff";
    
    # å…è®¸è·¨åŸŸè®¿é—®
    add_header Access-Control-Allow-Origin "*";
}
```

---

## 4. ğŸ›ï¸ Cache-Controlè®¾ç½®ç­–ç•¥


### 4.1 Cache-ControlæŒ‡ä»¤è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
Cache-Controlæ˜¯HTTP/1.1ä¸­æœ€é‡è¦çš„ç¼“å­˜æ§åˆ¶å¤´ï¼Œå®ƒå‘Šè¯‰æµè§ˆå™¨å¦‚ä½•ç¼“å­˜è¿™ä¸ªæ–‡ä»¶

```
Cache-Controlçš„å€¼å°±åƒç»™æµè§ˆå™¨çš„"ä½¿ç”¨è¯´æ˜ä¹¦"ï¼š
- è¿™ä¸ªæ–‡ä»¶å¯ä»¥ç¼“å­˜å—ï¼Ÿ
- ç¼“å­˜å¤šé•¿æ—¶é—´ï¼Ÿ
- åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦é‡æ–°éªŒè¯ï¼Ÿ
```

### 4.2 ä¸»è¦Cache-ControlæŒ‡ä»¤


| æŒ‡ä»¤ | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹** |
|------|---------|-------------|---------|
| `public` | `ä»»ä½•äººéƒ½å¯ä»¥ç¼“å­˜` | `å…¬å…±èµ„æº` | `CSSã€JSã€å›¾ç‰‡` |
| `private` | `åªæœ‰æµè§ˆå™¨å¯ä»¥ç¼“å­˜` | `ä¸ªäººæ•°æ®` | `ç”¨æˆ·é¡µé¢` |
| `no-cache` | `å¯ä»¥ç¼“å­˜ä½†éœ€è¦éªŒè¯` | `ç»å¸¸æ›´æ–°çš„æ–‡ä»¶` | `HTMLé¡µé¢` |
| `no-store` | `å®Œå…¨ç¦æ­¢ç¼“å­˜` | `æ•æ„Ÿä¿¡æ¯` | `æ”¯ä»˜é¡µé¢` |
| `max-age` | `æœ€å¤§ç¼“å­˜æ—¶é—´(ç§’)` | `è®¾ç½®è¿‡æœŸæ—¶é—´` | `é™æ€èµ„æº` |
| `immutable` | `æ–‡ä»¶æ°¸ä¸æ”¹å˜` | `ç‰ˆæœ¬åŒ–èµ„æº` | `å¸¦å“ˆå¸Œçš„æ–‡ä»¶` |

### 4.3 ä¸åŒåœºæ™¯çš„æœ€ä½³é…ç½®


**ğŸ”¸ é™æ€èµ„æºï¼ˆé•¿æœŸç¼“å­˜ï¼‰**
```nginx
location ~* \.(css|js|jpg|png|gif)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
    # è§£é‡Šï¼šå…¬å…±ç¼“å­˜ï¼Œ1å¹´æ—¶é—´ï¼Œæ–‡ä»¶ä¸ä¼šæ”¹å˜
}
```

**ğŸ”¸ HTMLé¡µé¢ï¼ˆçŸ­æœŸç¼“å­˜ï¼‰**
```nginx
location ~* \.html$ {
    add_header Cache-Control "public, max-age=3600, must-revalidate";
    # è§£é‡Šï¼šå…¬å…±ç¼“å­˜ï¼Œ1å°æ—¶ï¼Œè¿‡æœŸåå¿…é¡»éªŒè¯
}
```

**ğŸ”¸ APIæ¥å£ï¼ˆç¦æ­¢ç¼“å­˜ï¼‰**
```nginx
location /api/ {
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
    # è§£é‡Šï¼šå®Œå…¨ç¦æ­¢ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½ä»æœåŠ¡å™¨è·å–
}
```

**ğŸ”¸ ç”¨æˆ·ç›¸å…³å†…å®¹ï¼ˆç§æœ‰ç¼“å­˜ï¼‰**
```nginx
location /user/ {
    add_header Cache-Control "private, max-age=1800";
    # è§£é‡Šï¼šåªå…è®¸æµè§ˆå™¨ç¼“å­˜ï¼Œ30åˆ†é’Ÿè¿‡æœŸ
}
```

### 4.4 Cache-Controlç»„åˆç­–ç•¥


```nginx
# æ ¹æ®æ–‡ä»¶æ›´æ–°é¢‘ç‡è®¾ç½®ä¸åŒç­–ç•¥
server {
    # å¾ˆå°‘æ›´æ–°çš„èµ„æºï¼šæ¿€è¿›ç¼“å­˜
    location /static/lib/ {
        add_header Cache-Control "public, max-age=31536000, immutable";
    }
    
    # å®šæœŸæ›´æ–°çš„èµ„æºï¼šä¸­ç­‰ç¼“å­˜
    location /static/app/ {
        add_header Cache-Control "public, max-age=86400";
    }
    
    # ç»å¸¸æ›´æ–°çš„èµ„æºï¼šçŸ­æœŸç¼“å­˜
    location / {
        add_header Cache-Control "public, max-age=3600, must-revalidate";
    }
    
    # åŠ¨æ€å†…å®¹ï¼šæ— ç¼“å­˜
    location /api/ {
        add_header Cache-Control "no-store";
    }
}
```

---

## 5. ğŸ·ï¸ ETagä¸Last-Modified


### 5.1 ä»€ä¹ˆæ˜¯ETagå’ŒLast-Modified


**ğŸ”¸ ç®€å•ç†è§£**
```
Last-Modifiedï¼šå°±åƒæ–‡ä»¶çš„"æœ€åä¿®æ”¹æ—¶é—´"æ ‡ç­¾
ETagï¼šå°±åƒæ–‡ä»¶çš„"æŒ‡çº¹"ï¼Œå†…å®¹ä¸å˜æŒ‡çº¹å°±ä¸å˜

æµè§ˆå™¨çš„é€»è¾‘ï¼š
"è¿™ä¸ªæ–‡ä»¶æˆ‘æœ‰ç¼“å­˜ï¼Œä½†å¯èƒ½è¿‡æœŸäº†ï¼Œè®©æˆ‘é—®é—®æœåŠ¡å™¨æ–‡ä»¶æœ‰æ²¡æœ‰æ›´æ–°"
```

### 5.2 å·¥ä½œæµç¨‹å›¾ç¤º


```
ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š
æµè§ˆå™¨ â†’ [GET /style.css] â†’ æœåŠ¡å™¨
æµè§ˆå™¨ â† [æ–‡ä»¶å†…å®¹ + ETag: "abc123" + Last-Modified: "2024-01-01"] â† æœåŠ¡å™¨

å†æ¬¡è¯·æ±‚ï¼ˆç¼“å­˜è¿‡æœŸï¼‰ï¼š
æµè§ˆå™¨ â†’ [GET /style.css + If-None-Match: "abc123"] â†’ æœåŠ¡å™¨
æœåŠ¡å™¨æ£€æŸ¥æ–‡ä»¶ETagæ˜¯å¦è¿˜æ˜¯"abc123"
å¦‚æœç›¸åŒï¼š
æµè§ˆå™¨ â† [304 Not Modifiedï¼ˆæ— å†…å®¹ï¼‰] â† æœåŠ¡å™¨

å¦‚æœä¸åŒï¼š
æµè§ˆå™¨ â† [æ–°æ–‡ä»¶å†…å®¹ + æ–°ETag] â† æœåŠ¡å™¨
```

### 5.3 Nginxä¸­çš„ETagé…ç½®


```nginx
# å¯ç”¨ETagï¼ˆNginxé»˜è®¤å¼€å¯ï¼‰
server {
    # ETagè‡ªåŠ¨ç”Ÿæˆï¼ŒåŸºäºæ–‡ä»¶ä¿®æ”¹æ—¶é—´å’Œå¤§å°
    etag on;  # é»˜è®¤å°±æ˜¯on
    
    location /static/ {
        # ç»“åˆexpiresä½¿ç”¨
        expires 1d;
        # Nginxä¼šè‡ªåŠ¨æ·»åŠ ETagå¤´
    }
}

# å…³é—­ETagï¼ˆæŸäº›æƒ…å†µä¸‹ï¼‰
server {
    etag off;
    
    location /api/ {
        # APIå“åº”ä¸éœ€è¦ETag
        expires -1;
    }
}
```

### 5.4 Last-Modifiedçš„å¤„ç†


```nginx
# Nginxä¼šè‡ªåŠ¨è®¾ç½®Last-Modifiedå¤´
# åŸºäºæ–‡ä»¶çš„å®é™…ä¿®æ”¹æ—¶é—´

server {
    location /files/ {
        # è‡ªåŠ¨æ·»åŠ Last-Modifiedå¤´
        # æµè§ˆå™¨ä¼šå‘é€If-Modified-Sinceè¿›è¡ŒéªŒè¯
        
        # ç»“åˆç¼“å­˜è®¾ç½®
        expires 1h;
        add_header Cache-Control "public, must-revalidate";
    }
}
```

### 5.5 æ¡ä»¶è¯·æ±‚éªŒè¯


**ğŸ”¸ æµè§ˆå™¨å‘é€çš„éªŒè¯å¤´**
```
If-None-Match: "abc123"     # éªŒè¯ETag
If-Modified-Since: Mon, 01 Jan 2024 12:00:00 GMT  # éªŒè¯ä¿®æ”¹æ—¶é—´
```

**ğŸ”¸ æœåŠ¡å™¨å“åº”**
```
æ–‡ä»¶æœªä¿®æ”¹ï¼šè¿”å› 304 Not Modified
æ–‡ä»¶å·²ä¿®æ”¹ï¼šè¿”å› 200 OK + æ–°å†…å®¹
```

---

## 6. ğŸŒ æµè§ˆå™¨ç¼“å­˜ç­–ç•¥


### 6.1 æµè§ˆå™¨ç¼“å­˜çš„å·¥ä½œæœºåˆ¶


**ğŸ”¸ ç¼“å­˜æŸ¥æ‰¾é¡ºåº**
```
1. æ£€æŸ¥å†…å­˜ç¼“å­˜ï¼ˆMemory Cacheï¼‰
   â†“ æœªæ‰¾åˆ°
2. æ£€æŸ¥ç£ç›˜ç¼“å­˜ï¼ˆDisk Cacheï¼‰
   â†“ æœªæ‰¾åˆ°æˆ–å·²è¿‡æœŸ
3. å‘é€ç½‘ç»œè¯·æ±‚åˆ°æœåŠ¡å™¨
   â†“ æœåŠ¡å™¨éªŒè¯
4. è¿”å›304ï¼ˆæœªä¿®æ”¹ï¼‰æˆ–200ï¼ˆæ–°å†…å®¹ï¼‰
```

### 6.2 å¼ºç¼“å­˜vsåå•†ç¼“å­˜


**ğŸ”¸ å¼ºç¼“å­˜ï¼ˆæ— éœ€è¯¢é—®æœåŠ¡å™¨ï¼‰**
```nginx
# è®¾ç½®å¼ºç¼“å­˜
location /images/ {
    expires 30d;
    add_header Cache-Control "public, max-age=2592000";
    # æµè§ˆå™¨åœ¨30å¤©å†…ç›´æ¥ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œä¸ä¼šè¯¢é—®æœåŠ¡å™¨
}
```

**ğŸ”¸ åå•†ç¼“å­˜ï¼ˆéœ€è¦éªŒè¯ï¼‰**
```nginx
# è®¾ç½®åå•†ç¼“å­˜
location /html/ {
    expires 1h;
    add_header Cache-Control "public, max-age=3600, must-revalidate";
    # 1å°æ—¶åå¿…é¡»å‘æœåŠ¡å™¨éªŒè¯æ–‡ä»¶æ˜¯å¦æ›´æ–°
}
```

### 6.3 ç¼“å­˜ç­–ç•¥çš„é€‰æ‹©åŸåˆ™


```
é™æ€ä¸å˜çš„æ–‡ä»¶ï¼š
ğŸ“· å›¾ç‰‡ã€å­—ä½“ã€ç¬¬ä¸‰æ–¹åº“ â†’ é•¿æœŸå¼ºç¼“å­˜ï¼ˆ1å¹´ï¼‰

ç‰ˆæœ¬åŒ–çš„æ–‡ä»¶ï¼š
ğŸ“ app.v1.2.3.js, style.abc123.css â†’ æ°¸ä¹…ç¼“å­˜ + immutable

ç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼š
ğŸ“„ HTMLé¡µé¢ã€ç”¨æˆ·æ•°æ® â†’ çŸ­æœŸç¼“å­˜ + åå•†éªŒè¯

å®æ—¶æ•°æ®ï¼š
ğŸ”„ APIæ¥å£ã€è‚¡ä»·æ•°æ® â†’ ç¦æ­¢ç¼“å­˜
```

### 6.4 ç”¨æˆ·è¡Œä¸ºå¯¹ç¼“å­˜çš„å½±å“


| ç”¨æˆ·æ“ä½œ | **ç¼“å­˜è¡Œä¸º** | **å‘é€çš„è¯·æ±‚** |
|---------|-------------|---------------|
| `åœ°å€æ å›è½¦` | `ä½¿ç”¨å¼ºç¼“å­˜` | `å¯èƒ½æ— è¯·æ±‚` |
| `F5åˆ·æ–°` | `è·³è¿‡å¼ºç¼“å­˜ï¼Œä½¿ç”¨åå•†ç¼“å­˜` | `å¸¦If-xxxå¤´çš„è¯·æ±‚` |
| `Ctrl+F5å¼ºåˆ·` | `è·³è¿‡æ‰€æœ‰ç¼“å­˜` | `å¸¦Cache-Control: no-cacheçš„è¯·æ±‚` |
| `ç‚¹å‡»é“¾æ¥` | `æ­£å¸¸ç¼“å­˜ç­–ç•¥` | `æ ¹æ®ç¼“å­˜å¤´å†³å®š` |

---

## 7. ğŸ“ å®Œæ•´é…ç½®å®ä¾‹


### 7.1 ç”µå•†ç½‘ç«™ç¼“å­˜é…ç½®


```nginx
server {
    listen 80;
    server_name shop.example.com;
    root /var/www/shop;
    
    # é¦–é¡µHTML - çŸ­æœŸç¼“å­˜
    location = / {
        try_files /index.html =404;
        expires 10m;
        add_header Cache-Control "public, max-age=600, must-revalidate";
    }
    
    # å•†å“é¡µé¢ - ä¸­æœŸç¼“å­˜
    location ~ ^/product/ {
        expires 1h;
        add_header Cache-Control "public, max-age=3600, must-revalidate";
    }
    
    # ç”¨æˆ·ç›¸å…³é¡µé¢ - ç§æœ‰çŸ­æœŸç¼“å­˜
    location ~ ^/(cart|profile|orders)/ {
        expires 5m;
        add_header Cache-Control "private, max-age=300, must-revalidate";
    }
    
    # é™æ€èµ„æº - é•¿æœŸç¼“å­˜
    location /static/ {
        # CSS/JSæ–‡ä»¶
        location ~* \.(css|js)$ {
            expires 30d;
            add_header Cache-Control "public, max-age=2592000, immutable";
            add_header X-Content-Type-Options "nosniff";
        }
        
        # å›¾ç‰‡æ–‡ä»¶
        location ~* \.(jpg|jpeg|png|gif|webp|svg|ico)$ {
            expires 1y;
            add_header Cache-Control "public, max-age=31536000, immutable";
            add_header Vary "Accept-Encoding";
        }
        
        # å­—ä½“æ–‡ä»¶
        location ~* \.(woff|woff2|ttf|eot)$ {
            expires 1y;
            add_header Cache-Control "public, max-age=31536000, immutable";
            add_header Access-Control-Allow-Origin "*";
        }
    }
    
    # APIæ¥å£ - ç¦æ­¢ç¼“å­˜
    location /api/ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header X-Content-Type-Options "nosniff";
    }
    
    # ä¸Šä¼ æ–‡ä»¶ - ä¸­æœŸç¼“å­˜
    location /uploads/ {
        expires 7d;
        add_header Cache-Control "public, max-age=604800";
        add_header X-Content-Type-Options "nosniff";
    }
}
```

### 7.2 åšå®¢ç½‘ç«™ç¼“å­˜é…ç½®


```nginx
server {
    listen 80;
    server_name blog.example.com;
    root /var/www/blog;
    
    # æ–‡ç« é¡µé¢ - ä¸­æœŸç¼“å­˜
    location ~ ^/posts/ {
        expires 2h;
        add_header Cache-Control "public, max-age=7200, must-revalidate";
        add_header X-Frame-Options "SAMEORIGIN";
    }
    
    # RSSè®¢é˜… - çŸ­æœŸç¼“å­˜
    location ~ \.(xml|rss)$ {
        expires 30m;
        add_header Cache-Control "public, max-age=1800";
        add_header Content-Type "application/rss+xml; charset=utf-8";
    }
    
    # ä¸»é¢˜èµ„æº - é•¿æœŸç¼“å­˜
    location /themes/ {
        expires 15d;
        add_header Cache-Control "public, max-age=1296000, immutable";
        
        # CSS/JSç‰¹æ®Šå¤„ç†
        location ~* \.(css|js)$ {
            gzip_static on;
            add_header Vary "Accept-Encoding";
        }
    }
    
    # è¯„è®ºç³»ç»Ÿ - æ— ç¼“å­˜
    location /comments/ {
        expires -1;
        add_header Cache-Control "no-cache, must-revalidate";
    }
}
```

### 7.3 å¼€å‘ç¯å¢ƒé…ç½®


```nginx
# å¼€å‘ç¯å¢ƒï¼šç¦ç”¨æ‰€æœ‰ç¼“å­˜ï¼Œæ–¹ä¾¿è°ƒè¯•
server {
    listen 80;
    server_name dev.example.com;
    
    # å…¨å±€ç¦ç”¨ç¼“å­˜
    location / {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        
        # ç¦ç”¨ETag
        etag off;
        
        # å¼€å‘ç”¨çš„è°ƒè¯•å¤´
        add_header X-Debug-Mode "on";
        add_header X-Cache-Disabled "true";
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ é™æ€ç¼“å­˜ï¼šè®©æµè§ˆå™¨ä¿å­˜æ–‡ä»¶å‰¯æœ¬ï¼Œå‡å°‘é‡å¤è¯·æ±‚
ğŸ”¸ expiresæŒ‡ä»¤ï¼šè®¾ç½®æ–‡ä»¶è¿‡æœŸæ—¶é—´çš„ç®€å•æ–¹æ³•
ğŸ”¸ add_headerï¼šæ‰‹åŠ¨æ·»åŠ HTTPå“åº”å¤´ï¼Œçµæ´»æ§åˆ¶ç¼“å­˜
ğŸ”¸ Cache-Controlï¼šç°ä»£ç¼“å­˜æ§åˆ¶çš„æ ¸å¿ƒï¼ŒåŠŸèƒ½æœ€å¼ºå¤§
ğŸ”¸ ETag/Last-Modifiedï¼šæ–‡ä»¶å˜åŒ–æ£€æµ‹ï¼Œå®ç°æ™ºèƒ½ç¼“å­˜æ›´æ–°
ğŸ”¸ å¼ºç¼“å­˜vsåå•†ç¼“å­˜ï¼šç†è§£ä¸¤ç§ä¸åŒçš„ç¼“å­˜éªŒè¯æœºåˆ¶
```

### 8.2 ç¼“å­˜ç­–ç•¥é€‰æ‹©æŒ‡å—


**ğŸ”¹ æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©ç­–ç•¥**
```
æ°¸ä¹…ä¸å˜çš„æ–‡ä»¶ï¼š
ğŸ¯ ç¬¬ä¸‰æ–¹åº“ã€å­—ä½“æ–‡ä»¶ â†’ expires max + immutable

ç‰ˆæœ¬åŒ–æ–‡ä»¶ï¼š
ğŸ¯ app.v1.js, style.hash.css â†’ é•¿æœŸç¼“å­˜ + immutable

ç»å¸¸æ›´æ–°æ–‡ä»¶ï¼š
ğŸ¯ HTMLé¡µé¢ã€ç”¨æˆ·æ•°æ® â†’ çŸ­æœŸç¼“å­˜ + must-revalidate

å®æ—¶æ•°æ®ï¼š
ğŸ¯ APIã€è‚¡ä»·ã€èŠå¤© â†’ no-cache/no-store
```

**ğŸ”¹ æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´**
```
ç”µå•†ç½‘ç«™ï¼š
ğŸ“± å•†å“å›¾ç‰‡ â†’ é•¿æœŸç¼“å­˜
ğŸ“± ä»·æ ¼ä¿¡æ¯ â†’ çŸ­æœŸç¼“å­˜
ğŸ“± è´­ç‰©è½¦ â†’ ç§æœ‰ç¼“å­˜

æ–°é—»ç½‘ç«™ï¼š
ğŸ“° æ–‡ç« å†…å®¹ â†’ ä¸­æœŸç¼“å­˜
ğŸ“° çƒ­ç‚¹æ–°é—» â†’ çŸ­æœŸç¼“å­˜
ğŸ“° å›¾ç‰‡è§†é¢‘ â†’ é•¿æœŸç¼“å­˜

å¼€å‘è°ƒè¯•ï¼š
ğŸ”§ å®Œå…¨ç¦ç”¨ç¼“å­˜
ğŸ”§ ä¾¿äºå®æ—¶çœ‹åˆ°ä¿®æ”¹æ•ˆæœ
```

### 8.3 å¸¸è§é…ç½®æ¨¡å¼


**ğŸ”¹ åŸºç¡€é…ç½®æ¨¡å¼**
```nginx
# ä¸‰æ®µå¼ç¼“å­˜ç­–ç•¥
location /static/ {
    expires 1y;                    # é™æ€èµ„æºé•¿æœŸç¼“å­˜
}
location / {
    expires 1h;                    # é¡µé¢å†…å®¹çŸ­æœŸç¼“å­˜
}
location /api/ {
    expires -1;                    # åŠ¨æ€å†…å®¹ç¦æ­¢ç¼“å­˜
}
```

**ğŸ”¹ å®‰å…¨åŠ å›ºæ¨¡å¼**
```nginx
# ç¼“å­˜ + å®‰å…¨å¤´
add_header Cache-Control "public, max-age=3600";
add_header X-Content-Type-Options "nosniff";
add_header X-Frame-Options "SAMEORIGIN";
add_header Referrer-Policy "strict-origin-when-cross-origin";
```

### 8.4 è°ƒè¯•ä¸ç›‘æ§


**ğŸ”¹ ç¼“å­˜çŠ¶æ€æ£€æŸ¥**
```bash
# æ£€æŸ¥å“åº”å¤´
curl -I http://example.com/style.css

# å…³æ³¨è¿™äº›å¤´éƒ¨ï¼š
# Cache-Control: public, max-age=3600
# Expires: Mon, 20 Jan 2025 11:30:00 GMT
# ETag: "abc123"
# Last-Modified: Mon, 20 Jan 2025 10:30:00 GMT
```

**ğŸ”¹ æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```
ç¼“å­˜å‘½ä¸­ç‡ï¼šæœ¬åœ°ç¼“å­˜ä½¿ç”¨æ¯”ä¾‹
å¸¦å®½èŠ‚çœï¼šå‡å°‘çš„æ•°æ®ä¼ è¾“é‡
åŠ è½½é€Ÿåº¦ï¼šé¡µé¢æ‰“å¼€æ—¶é—´æ”¹å–„
æœåŠ¡å™¨è´Ÿè½½ï¼šè¯·æ±‚æ•°é‡å‡å°‘ç¨‹åº¦
```

### 8.5 æœ€ä½³å®è·µè¦ç‚¹


```
âœ… é™æ€èµ„æºä½¿ç”¨é•¿æœŸç¼“å­˜ + ç‰ˆæœ¬å·
âœ… HTMLä½¿ç”¨çŸ­æœŸç¼“å­˜ + åå•†éªŒè¯
âœ… APIæ¥å£ç¦ç”¨ç¼“å­˜æˆ–ä½¿ç”¨ç§æœ‰ç¼“å­˜
âœ… å¼€å‘ç¯å¢ƒç¦ç”¨ç¼“å­˜ä¾¿äºè°ƒè¯•
âœ… å®šæœŸç›‘æ§ç¼“å­˜æ•ˆæœå’Œå‘½ä¸­ç‡
âœ… æ ¹æ®å®é™…è®¿é—®æ¨¡å¼è°ƒæ•´ç­–ç•¥

âŒ ä¸è¦å¯¹å®æ—¶æ•°æ®è®¾ç½®ç¼“å­˜
âŒ ä¸è¦å¯¹ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ä½¿ç”¨å…¬å…±ç¼“å­˜
âŒ ä¸è¦è®¾ç½®è¿‡é•¿çš„ç¼“å­˜æ—¶é—´ç»™ç»å¸¸å˜åŒ–çš„æ–‡ä»¶
âŒ ä¸è¦å¿½ç•¥ç§»åŠ¨ç«¯çš„ç¼“å­˜ç­–ç•¥å·®å¼‚
```

**ğŸ’¡ è®°å¿†è¦ç‚¹**ï¼š
- ç¼“å­˜å°±æ˜¯"æŠŠä¸œè¥¿æ”¾åœ¨ç¦»ç”¨æˆ·æ›´è¿‘çš„åœ°æ–¹"
- expiresè®¾æ—¶é—´ï¼Œadd_headerè®¾è§„åˆ™ï¼ŒCache-Controlæœ€çµæ´»
- é™æ€æ–‡ä»¶ç¼“å­˜ä¹…ä¸€ç‚¹ï¼ŒåŠ¨æ€å†…å®¹ç¼“å­˜çŸ­ä¸€ç‚¹
- å¼€å‘æ—¶ç¦ç¼“å­˜ï¼Œç”Ÿäº§æ—¶ç”¨ç¼“å­˜ï¼Œæ ¹æ®éœ€è¦é€‰ç­–ç•¥