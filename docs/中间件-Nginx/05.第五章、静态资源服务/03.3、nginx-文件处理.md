---
title: 3ã€nginx-æ–‡ä»¶å¤„ç†
---
## ğŸ“š ç›®å½•

1. [æ–‡ä»¶å¤„ç†åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶å¤„ç†åŸºç¡€æ¦‚å¿µ)
2. [æ–‡ä»¶ä¸Šä¼ é…ç½®è¯¦è§£](#2-æ–‡ä»¶ä¸Šä¼ é…ç½®è¯¦è§£)
3. [å¤§æ–‡ä»¶ä¸‹è½½ä¼˜åŒ–](#3-å¤§æ–‡ä»¶ä¸‹è½½ä¼˜åŒ–)
4. [æ–­ç‚¹ç»­ä¼ å®ç°](#4-æ–­ç‚¹ç»­ä¼ å®ç°)
5. [æ–‡ä»¶æƒé™ä¸å®‰å…¨](#5-æ–‡ä»¶æƒé™ä¸å®‰å…¨)
6. [æ–‡ä»¶ç±»å‹åˆ¤æ–­ä¸å¤„ç†](#6-æ–‡ä»¶ç±»å‹åˆ¤æ–­ä¸å¤„ç†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ æ–‡ä»¶å¤„ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Nginxæ–‡ä»¶å¤„ç†


**é€šä¿—ç†è§£**ï¼šå°±åƒä½ ç”¨å¿«é€’å…¬å¸å¯„ä¸œè¥¿ä¸€æ ·ï¼ŒNginxæ˜¯ä¸ª"è¶…çº§å¿«é€’å‘˜"ï¼Œä¸“é—¨è´Ÿè´£åœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’æ–‡ä»¶ã€‚

```
ç®€å•æ¯”å–»ï¼š
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ = ä½ è¦å¯„åŒ…è£¹ç»™æœ‹å‹
Nginx = å¿«é€’å…¬å¸
æœåŠ¡å™¨ = æœ‹å‹çš„åœ°å€

ç”¨æˆ·ä¸‹è½½æ–‡ä»¶ = æœ‹å‹è¦å¯„ä¸œè¥¿ç»™ä½ 
Nginx = å¿«é€’å…¬å¸
æœåŠ¡å™¨ = ä»“åº“
```

### 1.2 Nginxå¤„ç†æ–‡ä»¶çš„æ ¸å¿ƒèƒ½åŠ›


**ğŸ”¸ æ–‡ä»¶ä¼ è¾“ç®¡å®¶**
```
Nginxèƒ½åšä»€ä¹ˆï¼š
âœ… æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆåƒæ”¶ä»¶å‘˜ï¼‰
âœ… æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™ï¼ˆåƒç§°é‡ï¼‰
âœ… å‘é€æ–‡ä»¶ç»™ç”¨æˆ·ä¸‹è½½ï¼ˆåƒæ´¾ä»¶å‘˜ï¼‰
âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆåƒå¿«é€’è¿½è¸ªï¼‰
âœ… ç®¡ç†æ–‡ä»¶è®¿é—®æƒé™ï¼ˆåƒé—¨å«ï¼‰
```

### 1.3 æ–‡ä»¶å¤„ç†çš„åŸºæœ¬æµç¨‹


```
æ–‡ä»¶ä¸Šä¼ æµç¨‹ï¼š
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ â†’ æµè§ˆå™¨å‘é€POSTè¯·æ±‚ â†’ Nginxæ¥æ”¶æ•°æ® â†’ æ£€æŸ¥å¤§å°é™åˆ¶ â†’ ä¿å­˜åˆ°æŒ‡å®šä½ç½®

æ–‡ä»¶ä¸‹è½½æµç¨‹ï¼š
ç”¨æˆ·ç‚¹å‡»ä¸‹è½½ â†’ æµè§ˆå™¨å‘é€GETè¯·æ±‚ â†’ Nginxæ‰¾åˆ°æ–‡ä»¶ â†’ æ£€æŸ¥æƒé™ â†’ åˆ†å—å‘é€ç»™ç”¨æˆ·
```

---

## 2. ğŸ“¤ æ–‡ä»¶ä¸Šä¼ é…ç½®è¯¦è§£


### 2.1 client_max_body_size æ ¸å¿ƒé…ç½®


**ä»€ä¹ˆæ˜¯client_max_body_sizeï¼Ÿ**
```
é€šä¿—è§£é‡Šï¼šè¿™å°±åƒå¿«é€’å…¬å¸è§„å®šçš„"åŒ…è£¹æœ€å¤§é‡é‡é™åˆ¶"
- å¦‚æœä½ çš„åŒ…è£¹è¶…è¿‡è¿™ä¸ªé‡é‡ï¼Œå¿«é€’å‘˜å°±ä¸æ”¶
- å¦‚æœç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¶…è¿‡è¿™ä¸ªå¤§å°ï¼ŒNginxå°±æ‹’ç»æ¥æ”¶
```

**ğŸ”§ åŸºç¡€é…ç½®ç¤ºä¾‹**
```nginx
# å…¨å±€è®¾ç½®ï¼ˆå½±å“æ•´ä¸ªæœåŠ¡å™¨ï¼‰
http {
    client_max_body_size 100M;  # å…è®¸ä¸Šä¼ æœ€å¤§100MBæ–‡ä»¶
}

# é’ˆå¯¹ç‰¹å®šç«™ç‚¹è®¾ç½®
server {
    listen 80;
    server_name upload.example.com;
    client_max_body_size 500M;  # è¿™ä¸ªç«™ç‚¹å…è®¸500MB
}

# é’ˆå¯¹ç‰¹å®šè·¯å¾„è®¾ç½®
location /upload {
    client_max_body_size 1G;    # ä¸Šä¼ è·¯å¾„å…è®¸1GB
}
```

### 2.2 æ–‡ä»¶ä¸Šä¼ é…ç½®çš„å±‚çº§å…³ç³»


**ğŸ“Š é…ç½®ä¼˜å…ˆçº§**
```
å±‚çº§å…³ç³»ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š
location > server > http

å®é™…åº”ç”¨ï¼š
â”œâ”€â”€ http { client_max_body_size 10M; }        â† å…¨å±€é»˜è®¤
â”œâ”€â”€ server { client_max_body_size 50M; }      â† ç«™ç‚¹çº§åˆ«ï¼ˆè¦†ç›–å…¨å±€ï¼‰
â””â”€â”€ location { client_max_body_size 100M; }   â† è·¯å¾„çº§åˆ«ï¼ˆè¦†ç›–ç«™ç‚¹ï¼‰

ç»“æœï¼š/uploadè·¯å¾„æœ€å¤§å…è®¸100Mï¼Œå…¶ä»–è·¯å¾„50M
```

### 2.3 æ–‡ä»¶ä¸Šä¼ çš„å®Œæ•´é…ç½®


**ğŸ”§ ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®**
```nginx
server {
    listen 80;
    server_name fileserver.example.com;
    
    # æ–‡ä»¶ä¸Šä¼ é…ç½®
    location /upload {
        # æœ€å¤§æ–‡ä»¶å¤§å°
        client_max_body_size 200M;
        
        # è¯·æ±‚ä½“ç¼“å†²è®¾ç½®
        client_body_buffer_size 128k;
        client_body_timeout 60s;
        
        # ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ä½ç½®
        client_body_temp_path /tmp/nginx_uploads;
        
        # ä»£ç†åˆ°åç«¯å¤„ç†
        proxy_pass http://backend_upload;
        proxy_request_buffering off;  # å…³é—­è¯·æ±‚ç¼“å†²ï¼Œé€‚åˆå¤§æ–‡ä»¶
    }
}
```

### 2.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â— 413 Request Entity Too Large é”™è¯¯**
```
é—®é¢˜ç°è±¡ï¼šç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶æ˜¾ç¤º"413é”™è¯¯"
åŸå› åˆ†æï¼šæ–‡ä»¶å¤§å°è¶…è¿‡äº†client_max_body_sizeé™åˆ¶

è§£å†³æ–¹æ³•ï¼š
1ï¸âƒ£ æ£€æŸ¥å½“å‰é™åˆ¶ï¼šnginx -T | grep client_max_body_size
2ï¸âƒ£ ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¢å¤§é™åˆ¶å€¼
3ï¸âƒ£ é‡æ–°åŠ è½½é…ç½®ï¼šnginx -s reload
```

**âš ï¸ ä¸Šä¼ è¶…æ—¶é—®é¢˜**
```nginx
# è§£å†³ä¸Šä¼ è¶…æ—¶çš„é…ç½®
location /upload {
    client_max_body_size 500M;
    client_body_timeout 300s;      # 5åˆ†é’Ÿè¶…æ—¶
    proxy_read_timeout 300s;       # åç«¯å¤„ç†è¶…æ—¶
    proxy_send_timeout 300s;       # å‘é€è¶…æ—¶
}
```

---

## 3. ğŸ“¥ å¤§æ–‡ä»¶ä¸‹è½½ä¼˜åŒ–


### 3.1 ä»€ä¹ˆæ˜¯å¤§æ–‡ä»¶ä¸‹è½½é—®é¢˜


**ç°å®åœºæ™¯ç†è§£**ï¼š
```
æƒ³è±¡ä½ è¦ä¸‹è½½ä¸€ä¸ª1GBçš„ç”µå½±ï¼š
âŒ æ™®é€šæ–¹å¼ï¼šNginxæŠŠæ•´ä¸ªæ–‡ä»¶è¯»åˆ°å†…å­˜ï¼Œå†å‘ç»™ä½ ï¼ˆå ç”¨1GBå†…å­˜ï¼‰
âœ… ä¼˜åŒ–æ–¹å¼ï¼šNginxè¾¹è¯»è¾¹å‘ï¼Œåƒæµæ°´ä¸€æ ·ï¼ˆåªå ç”¨å¾ˆå°‘å†…å­˜ï¼‰
```

### 3.2 sendfile é«˜æ•ˆä¼ è¾“


**sendfileæ˜¯ä»€ä¹ˆï¼Ÿ**
```
æŠ€æœ¯è§£é‡Šï¼šé›¶æ‹·è´æŠ€æœ¯ï¼Œç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¼ è¾“æ–‡ä»¶
é€šä¿—ç†è§£ï¼šå°±åƒ"ä¼ é€å¸¦"ç›´æ¥æŠŠæ–‡ä»¶ä»ç¡¬ç›˜é€åˆ°ç½‘ç»œï¼Œä¸ç»è¿‡å†…å­˜ä¸­è½¬

ä¼ ç»Ÿæ–¹å¼ï¼šç¡¬ç›˜ â†’ å†…å­˜ â†’ ç½‘ç»œ ï¼ˆæ…¢ï¼Œå å†…å­˜ï¼‰
sendfileï¼š ç¡¬ç›˜ â†’ ç½‘ç»œ       ï¼ˆå¿«ï¼Œçœå†…å­˜ï¼‰
```

**ğŸ”§ sendfileé…ç½®**
```nginx
http {
    # å¯ç”¨é«˜æ•ˆæ–‡ä»¶ä¼ è¾“
    sendfile on;
    
    # TCPæ¨é€ä¼˜åŒ–
    tcp_nopush on;
    tcp_nodelay on;
    
    # æ–‡ä»¶ä¼ è¾“è¶…æ—¶
    send_timeout 60s;
}

server {
    listen 80;
    server_name download.example.com;
    
    location /downloads {
        root /var/www/files;
        
        # å¤§æ–‡ä»¶ä¼˜åŒ–è®¾ç½®
        sendfile on;
        sendfile_max_chunk 1m;  # æ¯æ¬¡å‘é€1MB
    }
}
```

### 3.3 åˆ†å—ä¼ è¾“é…ç½®


**ä»€ä¹ˆæ˜¯åˆ†å—ä¼ è¾“ï¼Ÿ**
```
ç±»æ¯”ç†è§£ï¼š
å¤§æ–‡ä»¶ = ä¸€æœ¬åšä¹¦
åˆ†å—ä¼ è¾“ = ä¸€é¡µä¸€é¡µåœ°çœ‹ï¼Œä¸ç”¨ä¸€æ¬¡æ€§è¯»å®Œæ•´æœ¬ä¹¦

å¥½å¤„ï¼š
âœ… èŠ‚çœå†…å­˜ï¼ˆä¸ç”¨ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨ï¼‰
âœ… æå‡å“åº”é€Ÿåº¦ï¼ˆç«‹å³å¼€å§‹ä¼ è¾“ï¼‰
âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆå¯ä»¥ä»ä¸­é—´å¼€å§‹ï¼‰
```

**ğŸ”§ åˆ†å—ä¼ è¾“é…ç½®**
```nginx
location /bigfiles {
    root /var/www/downloads;
    
    # å¯ç”¨åˆ†å—ä¼ è¾“
    chunked_transfer_encoding on;
    
    # è¾“å‡ºç¼“å†²è®¾ç½®
    output_buffers 2 1m;
    
    # å‡å°‘ç£ç›˜IO
    open_file_cache max=1000 inactive=20s;
}
```

---

## 4. â¸ï¸ æ–­ç‚¹ç»­ä¼ å®ç°


### 4.1 æ–­ç‚¹ç»­ä¼ åŸç†


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
åœºæ™¯ï¼šä½ åœ¨ä¸‹è½½ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œç½‘ç»œçªç„¶æ–­äº†
âŒ æ²¡æœ‰æ–­ç‚¹ç»­ä¼ ï¼šä»å¤´å¼€å§‹ä¸‹è½½ï¼ˆæµªè´¹æ—¶é—´å’Œæµé‡ï¼‰
âœ… æœ‰æ–­ç‚¹ç»­ä¼ ï¼šä»æ–­å¼€çš„åœ°æ–¹ç»§ç»­ä¸‹è½½ï¼ˆçœæ—¶çœæµé‡ï¼‰

æŠ€æœ¯åŸç†ï¼š
1. å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨ï¼š"æˆ‘å·²ç»ä¸‹è½½äº†å‰1MBï¼Œè¯·ä»1MBåå¼€å§‹å‘é€"
2. æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä»ç¬¬1MBä½ç½®å¼€å§‹å‘é€å‰©ä½™å†…å®¹
```

### 4.2 HTTP Rangeè¯·æ±‚æ”¯æŒ


**Rangeè¯·æ±‚å¤´çš„å«ä¹‰**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚ï¼š
GET /largefile.zip HTTP/1.1
Range: bytes=1048576-     # ä»ç¬¬1MBå¼€å§‹åˆ°æ–‡ä»¶ç»“æŸ

æœåŠ¡å™¨å“åº”ï¼š
HTTP/1.1 206 Partial Content
Content-Range: bytes 1048576-2097151/2097152  # å‘é€ç¬¬2MBçš„å†…å®¹
```

### 4.3 Nginxæ–­ç‚¹ç»­ä¼ é…ç½®


**ğŸ”§ å®Œæ•´æ–­ç‚¹ç»­ä¼ é…ç½®**
```nginx
server {
    listen 80;
    server_name download.example.com;
    
    location /downloads {
        root /var/www/files;
        
        # å¯ç”¨æ–­ç‚¹ç»­ä¼ æ”¯æŒ
        add_header Accept-Ranges bytes;
        
        # å¤§æ–‡ä»¶ä¼˜åŒ–
        sendfile on;
        sendfile_max_chunk 1m;
        
        # ç¼“å­˜æ–‡ä»¶ä¿¡æ¯ï¼ˆæå‡æ€§èƒ½ï¼‰
        open_file_cache max=10000 inactive=60s;
        open_file_cache_valid 60s;
        open_file_cache_min_uses 1;
        
        # é”™è¯¯é¡µé¢
        error_page 404 /404.html;
    }
}
```

### 4.4 æ–­ç‚¹ç»­ä¼ æµ‹è¯•éªŒè¯


**ğŸ“‹ æµ‹è¯•æ–¹æ³•**
```bash
# 1. æµ‹è¯•Rangeè¯·æ±‚æ”¯æŒ
curl -I -H "Range: bytes=0-1023" http://your-server/downloads/file.zip

# 2. åº”è¯¥çœ‹åˆ°çš„å“åº”
HTTP/1.1 206 Partial Content
Accept-Ranges: bytes
Content-Range: bytes 0-1023/æ€»æ–‡ä»¶å¤§å°
Content-Length: 1024

# 3. å¦‚æœä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œä¼šè¿”å›
HTTP/1.1 200 OK  # æ³¨æ„æ˜¯200è€Œä¸æ˜¯206
```

---

## 5. ğŸ”’ æ–‡ä»¶æƒé™ä¸å®‰å…¨


### 5.1 æ–‡ä»¶è®¿é—®æƒé™æ§åˆ¶


**ä¸ºä»€ä¹ˆéœ€è¦æƒé™æ§åˆ¶ï¼Ÿ**
```
ç°å®åœºæ™¯ï¼š
- å…¬å¸å†…éƒ¨æ–‡æ¡£ï¼šåªå…è®¸å‘˜å·¥è®¿é—®
- å®¢æˆ·èµ„æ–™ï¼šåªå…è®¸ç‰¹å®šIPè®¿é—®
- ç³»ç»Ÿæ–‡ä»¶ï¼šç¦æ­¢å¤–éƒ¨è®¿é—®

æŠ€æœ¯å®ç°ï¼š
é€šè¿‡Nginxé…ç½®è§„åˆ™ï¼Œå†³å®šè°èƒ½è®¿é—®å“ªäº›æ–‡ä»¶
```

### 5.2 åŸºäºIPçš„è®¿é—®æ§åˆ¶


**ğŸ”§ IPè®¿é—®æ§åˆ¶é…ç½®**
```nginx
location /private {
    root /var/www/secure;
    
    # å…è®¸ç‰¹å®šIPè®¿é—®
    allow 192.168.1.0/24;    # å…è®¸å†…ç½‘è®¿é—®
    allow 10.0.0.100;        # å…è®¸ç‰¹å®šIP
    deny all;                # æ‹’ç»å…¶ä»–æ‰€æœ‰IP
}

location /downloads {
    root /var/www/files;
    
    # é™åˆ¶æŸäº›IP
    deny 192.168.1.100;      # æ‹’ç»ç‰¹å®šIP
    allow all;               # å…è®¸å…¶ä»–æ‰€æœ‰IP
}
```

### 5.3 åŸºäºæ—¶é—´çš„è®¿é—®æ§åˆ¶


**ğŸ”§ æ—¶é—´é™åˆ¶é…ç½®**
```nginx
location /business-hours {
    root /var/www/files;
    
    # åªåœ¨å·¥ä½œæ—¶é—´å…è®¸è®¿é—®ï¼ˆéœ€è¦é¢å¤–æ¨¡å—æ”¯æŒï¼‰
    access_by_lua_block {
        local hour = tonumber(os.date("%H"))
        if hour < 9 or hour > 18 then
            ngx.exit(403)
        end
    }
}
```

### 5.4 éšè—æ–‡ä»¶å’Œç›®å½•


**ğŸ”’ éšè—æ•æ„Ÿæ–‡ä»¶**
```nginx
server {
    listen 80;
    server_name fileserver.example.com;
    
    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # ç¦æ­¢è®¿é—®å¤‡ä»½æ–‡ä»¶
    location ~ ~$ {
        deny all;
    }
    
    # ç¦æ­¢è®¿é—®é…ç½®æ–‡ä»¶
    location ~* \.(conf|ini|log)$ {
        deny all;
    }
}
```

---

## 6. ğŸ“‹ æ–‡ä»¶ç±»å‹åˆ¤æ–­ä¸å¤„ç†


### 6.1 MIMEç±»å‹çš„ä½œç”¨


**ä»€ä¹ˆæ˜¯MIMEç±»å‹ï¼Ÿ**
```
é€šä¿—ç†è§£ï¼šå°±åƒæ–‡ä»¶çš„"èº«ä»½è¯"ï¼Œå‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶

å¸¸è§ä¾‹å­ï¼š
- .jpgå›¾ç‰‡ â†’ image/jpeg
- .pdfæ–‡æ¡£ â†’ application/pdf  
- .mp4è§†é¢‘ â†’ video/mp4
- .txtæ–‡æœ¬ â†’ text/plain
```

### 6.2 Nginx MIMEç±»å‹é…ç½®


**ğŸ”§ MIMEç±»å‹é…ç½®**
```nginx
http {
    # å¼•å…¥é»˜è®¤MIMEç±»å‹
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    # è‡ªå®šä¹‰MIMEç±»å‹
    types {
        application/vnd.ms-excel    xls;
        application/vnd.openxmlformats-officedocument.spreadsheetml.sheet xlsx;
        video/x-flv                 flv;
    }
}
```

### 6.3 åŸºäºæ–‡ä»¶ç±»å‹çš„å¤„ç†ç­–ç•¥


**ğŸ“Š ä¸åŒæ–‡ä»¶ç±»å‹çš„å¤„ç†æ–¹å¼**

| æ–‡ä»¶ç±»å‹ | **MIMEç±»å‹** | **å¤„ç†ç­–ç•¥** | **å…¸å‹é…ç½®** |
|---------|-------------|------------|-------------|
| ğŸ“· **å›¾ç‰‡** | `image/*` | `ç›´æ¥æ˜¾ç¤ºï¼Œè®¾ç½®ç¼“å­˜` | `expires 7d` |
| ğŸ“„ **æ–‡æ¡£** | `application/pdf` | `æµè§ˆå™¨é¢„è§ˆæˆ–ä¸‹è½½` | `add_header Content-Disposition inline` |
| ğŸµ **éŸ³é¢‘** | `audio/*` | `æµåª’ä½“æ’­æ”¾` | `mp4 æ¨¡å—æ”¯æŒ` |
| ğŸ¬ **è§†é¢‘** | `video/*` | `åˆ†æ®µä¼ è¾“` | `sendfile on` |
| ğŸ“¦ **å‹ç¼©åŒ…** | `application/zip` | `å¼ºåˆ¶ä¸‹è½½` | `attachment; filename` |

**ğŸ”§ å®é™…é…ç½®ç¤ºä¾‹**
```nginx
location ~* \.(jpg|jpeg|png|gif)$ {
    root /var/www/images;
    expires 30d;
    add_header Cache-Control "public, immutable";
}

location ~* \.(pdf|doc|docx)$ {
    root /var/www/documents;
    add_header Content-Disposition "inline";
}

location ~* \.(zip|rar|tar|gz)$ {
    root /var/www/downloads;
    add_header Content-Disposition "attachment";
}
```

### 6.4 å¼ºåˆ¶ä¸‹è½½é…ç½®


**ä»€ä¹ˆæ—¶å€™éœ€è¦å¼ºåˆ¶ä¸‹è½½ï¼Ÿ**
```
åœºæ™¯è¯´æ˜ï¼š
- é»˜è®¤æƒ…å†µï¼šç‚¹å‡»PDFé“¾æ¥ â†’ æµè§ˆå™¨ç›´æ¥æ‰“å¼€
- å¼ºåˆ¶ä¸‹è½½ï¼šç‚¹å‡»PDFé“¾æ¥ â†’ å¼¹å‡ºä¸‹è½½å¯¹è¯æ¡†

åº”ç”¨åœºæ™¯ï¼š
âœ… è½¯ä»¶å®‰è£…åŒ…ï¼šå¸Œæœ›ç”¨æˆ·ä¸‹è½½è€Œä¸æ˜¯åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
âœ… æœºå¯†æ–‡æ¡£ï¼šä¸å¸Œæœ›åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ
âœ… å¤§æ–‡ä»¶ï¼šé¿å…æµè§ˆå™¨å¡é¡¿
```

**ğŸ”§ å¼ºåˆ¶ä¸‹è½½é…ç½®**
```nginx
location /downloads {
    root /var/www/files;
    
    # å¼ºåˆ¶ä¸‹è½½æ‰€æœ‰æ–‡ä»¶
    add_header Content-Disposition "attachment";
    
    # æˆ–è€…æ ¹æ®æ–‡ä»¶åè®¾ç½®ä¸‹è½½åç§°
    location ~ ^/downloads/(.+)$ {
        root /var/www/files;
        add_header Content-Disposition "attachment; filename=$1";
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„é…ç½®é¡¹


```
ğŸ”¸ client_max_body_size: æ§åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶
ğŸ”¸ sendfile: å¯ç”¨é«˜æ•ˆæ–‡ä»¶ä¼ è¾“ï¼ˆé›¶æ‹·è´ï¼‰
ğŸ”¸ client_body_timeout: è®¾ç½®ä¸Šä¼ è¶…æ—¶æ—¶é—´
ğŸ”¸ add_header Accept-Ranges: æ”¯æŒæ–­ç‚¹ç»­ä¼ 
ğŸ”¸ MIMEç±»å‹é…ç½®: æ­£ç¡®è¯†åˆ«æ–‡ä»¶ç±»å‹
ğŸ”¸ è®¿é—®æ§åˆ¶: allow/deny è§„åˆ™ä¿æŠ¤æ–‡ä»¶å®‰å…¨
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–æ€è·¯**
```
å¤§å°é™åˆ¶: client_max_body_size æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®
è¶…æ—¶æ§åˆ¶: client_body_timeout é˜²æ­¢é•¿æ—¶é—´å ç”¨è¿æ¥
ç¼“å†²ä¼˜åŒ–: client_body_buffer_size æå‡å¤„ç†æ•ˆç‡
ä¸´æ—¶ç›®å½•: client_body_temp_path æŒ‡å®šä¸´æ—¶æ–‡ä»¶å­˜æ”¾ä½ç½®
```

**ğŸ”¹ æ–‡ä»¶ä¸‹è½½ä¼˜åŒ–ç­–ç•¥**
```
é›¶æ‹·è´: sendfile æŠ€æœ¯å‡å°‘å†…å­˜ä½¿ç”¨
åˆ†å—ä¼ è¾“: sendfile_max_chunk æ§åˆ¶æ¯æ¬¡å‘é€å¤§å°
æ–­ç‚¹ç»­ä¼ : Accept-Ranges æ”¯æŒå¤§æ–‡ä»¶ä¸‹è½½æ¢å¤
ç¼“å­˜ç­–ç•¥: open_file_cache å‡å°‘ç£ç›˜IOæ“ä½œ
```

**ğŸ”¹ å®‰å…¨é˜²æŠ¤è¦ç‚¹**
```
è®¿é—®æ§åˆ¶: åŸºäºIPã€æ—¶é—´ç­‰æ¡ä»¶é™åˆ¶è®¿é—®
æ–‡ä»¶éšè—: é˜²æ­¢æ•æ„Ÿæ–‡ä»¶è¢«ç›´æ¥è®¿é—®
ç±»å‹æ£€æŸ¥: æ ¹æ®MIMEç±»å‹æ‰§è¡Œä¸åŒå®‰å…¨ç­–ç•¥
ä¸‹è½½æ§åˆ¶: ä½¿ç”¨Content-Dispositionæ§åˆ¶æ–‡ä»¶è¡Œä¸º
```

### 7.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ† æ¨èé…ç½®æ¨¡æ¿**
```nginx
server {
    listen 80;
    server_name fileserver.example.com;
    
    # å…¨å±€æ–‡ä»¶å¤„ç†è®¾ç½®
    client_max_body_size 100M;
    client_body_timeout 60s;
    sendfile on;
    sendfile_max_chunk 1m;
    
    # æ–‡ä»¶ä¸Šä¼ 
    location /upload {
        client_max_body_size 500M;
        proxy_pass http://upload_backend;
        proxy_request_buffering off;
    }
    
    # æ–‡ä»¶ä¸‹è½½
    location /downloads {
        root /var/www/files;
        add_header Accept-Ranges bytes;
        open_file_cache max=1000 inactive=20s;
    }
    
    # å®‰å…¨è®¾ç½®
    location ~ /\. {
        deny all;
    }
}
```

### 7.4 å¸¸è§é—®é¢˜æ’æŸ¥


**ğŸ”§ é—®é¢˜è¯Šæ–­æ­¥éª¤**
```
413é”™è¯¯: æ£€æŸ¥client_max_body_sizeè®¾ç½®
ä¸Šä¼ å¤±è´¥: æ£€æŸ¥ç£ç›˜ç©ºé—´å’Œæƒé™
ä¸‹è½½ä¸­æ–­: ç¡®è®¤sendfileå’ŒAccept-Rangesé…ç½®
è®¿é—®è¢«æ‹’: æ£€æŸ¥allow/denyè§„åˆ™å’Œæ–‡ä»¶æƒé™
MIMEé”™è¯¯: ç¡®è®¤mime.typesæ–‡ä»¶å’Œè‡ªå®šä¹‰ç±»å‹
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¸Šä¼ å¤§å°client_maxæ§åˆ¶ï¼Œè¶…æ—¶ç¼“å†²ä¸€èµ·é…
- ä¸‹è½½ä¼˜åŒ–sendfileå¼€ï¼Œåˆ†å—æ–­ç‚¹æ•ˆç‡é«˜  
- æƒé™å®‰å…¨å¾ˆé‡è¦ï¼ŒIPæ—¶é—´åŒé‡ä¿
- æ–‡ä»¶ç±»å‹MIMEå®šï¼Œå¼ºåˆ¶ä¸‹è½½dispositionæ˜