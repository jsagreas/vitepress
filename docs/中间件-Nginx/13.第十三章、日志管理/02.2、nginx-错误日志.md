---
title: 2ã€nginx-é”™è¯¯æ—¥å¿—
---
## ğŸ“š ç›®å½•

1. [é”™è¯¯æ—¥å¿—åŸºæœ¬æ¦‚å¿µ](#1-é”™è¯¯æ—¥å¿—åŸºæœ¬æ¦‚å¿µ)
2. [error_logæŒ‡ä»¤è¯¦è§£](#2-error_logæŒ‡ä»¤è¯¦è§£)
3. [æ—¥å¿—çº§åˆ«è®¾ç½®ä¸é€‰æ‹©](#3-æ—¥å¿—çº§åˆ«è®¾ç½®ä¸é€‰æ‹©)
4. [æ—¥å¿—ä½ç½®é…ç½®ç­–ç•¥](#4-æ—¥å¿—ä½ç½®é…ç½®ç­–ç•¥)
5. [é”™è¯¯è°ƒè¯•ä¸æ•…éšœæ’æŸ¥](#5-é”™è¯¯è°ƒè¯•ä¸æ•…éšœæ’æŸ¥)
6. [æ—¥å¿—åˆ†æå®æˆ˜æŠ€å·§](#6-æ—¥å¿—åˆ†æå®æˆ˜æŠ€å·§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ é”™è¯¯æ—¥å¿—åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Nginxé”™è¯¯æ—¥å¿—


> ğŸ’¡ **ç®€å•ç†è§£**ï¼šé”™è¯¯æ—¥å¿—å°±åƒåŒ»ç”Ÿçš„è¯Šæ–­è®°å½•ï¼Œè®°å½•Nginxè¿è¡Œæ—¶é‡åˆ°çš„æ‰€æœ‰é—®é¢˜å’Œå¼‚å¸¸æƒ…å†µ

**é”™è¯¯æ—¥å¿—çš„æœ¬è´¨**ï¼š
```
é”™è¯¯æ—¥å¿— = Nginxçš„"ä½“æ£€æŠ¥å‘Š"
â€¢ è®°å½•è¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯
â€¢ å¸®åŠ©ç®¡ç†å‘˜å‘ç°å’Œè§£å†³é—®é¢˜
â€¢ æä¾›ç³»ç»Ÿå¥åº·çŠ¶å†µçš„é‡è¦ä¿¡æ¯
```

### 1.2 é”™è¯¯æ—¥å¿—ä¸è®¿é—®æ—¥å¿—çš„åŒºåˆ«


```
ç”Ÿæ´»ç±»æ¯”ï¼š
è®¿é—®æ—¥å¿— = å•†åº—çš„å®¢æµè®°å½•ï¼ˆè°æ¥äº†ï¼Œä¹°äº†ä»€ä¹ˆï¼‰
é”™è¯¯æ—¥å¿— = å•†åº—çš„æ•…éšœè®°å½•ï¼ˆä»€ä¹ˆåäº†ï¼Œæ€ä¹ˆä¿®ï¼‰

å¯¹æ¯”è¡¨æ ¼ï¼š
```

| ç‰¹å¾ | **é”™è¯¯æ—¥å¿—** | **è®¿é—®æ—¥å¿—** |
|------|-------------|-------------|
| ğŸ“ **è®°å½•å†…å®¹** | `ç³»ç»Ÿé”™è¯¯ã€é…ç½®é—®é¢˜ã€è¿è¡Œå¼‚å¸¸` | `ç”¨æˆ·è®¿é—®è¯·æ±‚ã€å“åº”çŠ¶æ€` |
| ğŸ¯ **ä¸»è¦ç”¨é€”** | `æ•…éšœè¯Šæ–­ã€é—®é¢˜æ’æŸ¥` | `æµé‡åˆ†æã€ç”¨æˆ·è¡Œä¸º` |
| ğŸ“Š **å…³æ³¨é‡ç‚¹** | `ç³»ç»Ÿå¥åº·çŠ¶å†µ` | `ä¸šåŠ¡æ•°æ®ç»Ÿè®¡` |
| âš¡ **ç´§æ€¥ç¨‹åº¦** | `é«˜ï¼ˆå½±å“æœåŠ¡ï¼‰` | `ä½ï¼ˆæ•°æ®åˆ†æï¼‰` |

### 1.3 é”™è¯¯æ—¥å¿—çš„é‡è¦ä½œç”¨


**ğŸ” æ•…éšœé¢„è­¦**ï¼š
```
åŠæ—¶å‘ç°é—®é¢˜ï¼š
â€¢ æœåŠ¡å™¨èµ„æºä¸è¶³
â€¢ é…ç½®æ–‡ä»¶é”™è¯¯  
â€¢ ä¸Šæ¸¸æœåŠ¡å™¨å¼‚å¸¸
â€¢ æ–‡ä»¶æƒé™é—®é¢˜
```

**ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–**ï¼š
```
æ€§èƒ½ç“¶é¢ˆè¯†åˆ«ï¼š
â€¢ æ…¢æŸ¥è¯¢å®šä½
â€¢ èµ„æºå ç”¨åˆ†æ
â€¢ å¹¶å‘é—®é¢˜æ’æŸ¥
â€¢ ç¼“å­˜å‘½ä¸­ç‡é—®é¢˜
```

---

## 2. âš™ï¸ error_logæŒ‡ä»¤è¯¦è§£


### 2.1 error_logæŒ‡ä»¤åŸºæœ¬è¯­æ³•


```nginx
# åŸºæœ¬è¯­æ³•æ ¼å¼
error_log æ—¥å¿—æ–‡ä»¶è·¯å¾„ [æ—¥å¿—çº§åˆ«];

# å¸¸ç”¨é…ç½®ç¤ºä¾‹
error_log /var/log/nginx/error.log warn;
```

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼šerror_log = "é”™è¯¯æ—¥å¿—" + "å­˜æ”¾ä½ç½®" + "è®°å½•çº§åˆ«"

### 2.2 error_logæŒ‡ä»¤çš„ä½¿ç”¨ä½ç½®


```
é…ç½®ä¸Šä¸‹æ–‡å±‚çº§å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     mainå…¨å±€        â”‚ â† å¯ä»¥é…ç½®error_log
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     eventsäº‹ä»¶      â”‚ â† å¯ä»¥é…ç½®error_log
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     httpåè®®        â”‚ â† å¯ä»¥é…ç½®error_log
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚    serverè™šæ‹Ÿä¸»æœºâ”‚ â† å¯ä»¥é…ç½®error_log
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ â”‚   locationè·¯å¾„â”‚ â† ä¸èƒ½é…ç½®error_log
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®ç¤ºä¾‹**ï¼š
```nginx
# å…¨å±€é…ç½®ï¼ˆå½±å“æ•´ä¸ªNginxï¼‰
error_log /var/log/nginx/global_error.log error;

http {
    # HTTPçº§åˆ«é…ç½®ï¼ˆå½±å“æ‰€æœ‰è™šæ‹Ÿä¸»æœºï¼‰
    error_log /var/log/nginx/http_error.log warn;
    
    server {
        # æœåŠ¡å™¨çº§åˆ«é…ç½®ï¼ˆåªå½±å“å½“å‰è™šæ‹Ÿä¸»æœºï¼‰
        error_log /var/log/nginx/site_error.log info;
        
        location / {
            # locationä¸­ä¸èƒ½ç›´æ¥é…ç½®error_log
            # ä¼šç»§æ‰¿ä¸Šçº§çš„é…ç½®
        }
    }
}
```

### 2.3 error_logæŒ‡ä»¤çš„ç‰¹æ®Šç”¨æ³•


**ğŸš« å…³é—­é”™è¯¯æ—¥å¿—**ï¼š
```nginx
# å®Œå…¨å…³é—­é”™è¯¯æ—¥å¿—ï¼ˆä¸æ¨èï¼‰
error_log off;

# åªè®°å½•ä¸¥é‡é”™è¯¯
error_log /var/log/nginx/error.log crit;
```

**ğŸ”„ å¤šä¸ªé”™è¯¯æ—¥å¿—**ï¼š
```nginx
# å¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªé”™è¯¯æ—¥å¿—
error_log /var/log/nginx/error.log warn;
error_log /var/log/nginx/debug.log debug;
error_log syslog:server=192.168.1.100 error;
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šä¸å»ºè®®å®Œå…¨å…³é—­é”™è¯¯æ—¥å¿—ï¼Œè¿™ä¼šè®©æ•…éšœæ’æŸ¥å˜å¾—éå¸¸å›°éš¾

---

## 3. ğŸ“Š æ—¥å¿—çº§åˆ«è®¾ç½®ä¸é€‰æ‹©


### 3.1 æ—¥å¿—çº§åˆ«å®Œæ•´åˆ—è¡¨


```
æ—¥å¿—çº§åˆ«é‡‘å­—å¡”ï¼ˆä»ä¸¥é‡åˆ°è¯¦ç»†ï¼‰ï¼š
        ğŸ”´ emergï¼ˆç´§æ€¥ï¼‰
       ğŸŸ  alertï¼ˆè­¦æŠ¥ï¼‰  
      ğŸŸ¡ critï¼ˆä¸¥é‡ï¼‰
     ğŸ”µ errorï¼ˆé”™è¯¯ï¼‰
    ğŸŸ¢ warnï¼ˆè­¦å‘Šï¼‰
   ğŸŸ£ noticeï¼ˆæ³¨æ„ï¼‰
  âšª infoï¼ˆä¿¡æ¯ï¼‰
 ğŸ” debugï¼ˆè°ƒè¯•ï¼‰
```

| çº§åˆ« | **å«ä¹‰** | **è®°å½•å†…å®¹** | **ä½¿ç”¨åœºæ™¯** |
|------|----------|-------------|-------------|
| `emerg` | **ç³»ç»Ÿå´©æºƒ** | `Nginxæ— æ³•å¯åŠ¨çš„è‡´å‘½é”™è¯¯` | `ç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨` |
| `alert` | **ç«‹å³å¤„ç†** | `éœ€è¦ç«‹å³ä¿®å¤çš„ä¸¥é‡é—®é¢˜` | `æœåŠ¡ä¸¥é‡å—å½±å“` |
| `crit` | **ä¸¥é‡é”™è¯¯** | `å…³é”®åŠŸèƒ½å¤±è´¥` | `éƒ¨åˆ†åŠŸèƒ½ä¸å¯ç”¨` |
| `error` | **æ™®é€šé”™è¯¯** | `è¯·æ±‚å¤„ç†å¤±è´¥ã€ä¸Šæ¸¸é”™è¯¯` | `å½±å“ç”¨æˆ·ä½“éªŒ` |
| `warn` | **è­¦å‘Šä¿¡æ¯** | `æ½œåœ¨é—®é¢˜ã€é…ç½®å»ºè®®` | `éœ€è¦å…³æ³¨ä½†ä¸ç´§æ€¥` |
| `notice` | **æ­£å¸¸ä½†é‡è¦** | `é…ç½®é‡è½½ã€å·¥ä½œè¿›ç¨‹å¯åŠ¨` | `ç³»ç»ŸçŠ¶æ€å˜åŒ–` |
| `info` | **ä¸€èˆ¬ä¿¡æ¯** | `è¯¦ç»†çš„è¿è¡Œä¿¡æ¯` | `è¯¦ç»†ç›‘æ§` |
| `debug` | **è°ƒè¯•ä¿¡æ¯** | `éå¸¸è¯¦ç»†çš„è°ƒè¯•æ•°æ®` | `å¼€å‘è°ƒè¯•` |

### 3.2 ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®


**ğŸ¯ ä¸åŒç¯å¢ƒçš„æœ€ä½³å®è·µ**ï¼š

```nginx
# ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼šwarnçº§åˆ«ï¼‰
error_log /var/log/nginx/error.log warn;

# æµ‹è¯•ç¯å¢ƒï¼ˆæ¨èï¼šinfoçº§åˆ«ï¼‰  
error_log /var/log/nginx/error.log info;

# å¼€å‘ç¯å¢ƒï¼ˆæ¨èï¼šdebugçº§åˆ«ï¼‰
error_log /var/log/nginx/error.log debug;
```

> ğŸ’¡ **é€‰æ‹©åŸåˆ™**ï¼šçº§åˆ«è¶Šä½è®°å½•è¶Šè¯¦ç»†ï¼Œä½†æ—¥å¿—æ–‡ä»¶ä¹Ÿä¼šè¶Šå¤§

### 3.3 æ—¥å¿—çº§åˆ«å®é™…æ•ˆæœå¯¹æ¯”


```
å‡è®¾å‘ç”Ÿä¸€ä¸ª404é”™è¯¯ï¼Œä¸åŒçº§åˆ«çš„è®°å½•æƒ…å†µï¼š

debugçº§åˆ«ï¼šè®°å½•æ‰€æœ‰ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¯·æ±‚è¯¦ç»†è¿‡ç¨‹ï¼‰
infoçº§åˆ«ï¼š è®°å½•åŸºæœ¬å¤„ç†ä¿¡æ¯
warnçº§åˆ«ï¼š å¯èƒ½ä¸è®°å½•ï¼ˆ404æ˜¯æ­£å¸¸é”™è¯¯ï¼‰
errorçº§åˆ«ï¼šè®°å½•404é”™è¯¯ä¿¡æ¯
critçº§åˆ«ï¼š ä¸è®°å½•ï¼ˆ404ä¸æ˜¯ä¸¥é‡é”™è¯¯ï¼‰
```

**ğŸ“‹ çº§åˆ«åŒ…å«å…³ç³»**ï¼š
```
è®¾ç½®warnçº§åˆ« = è®°å½•warn + error + crit + alert + emerg
è®¾ç½®errorçº§åˆ« = è®°å½•error + crit + alert + emerg
è®¾ç½®infoçº§åˆ« = è®°å½•info + warn + error + crit + alert + emerg
```

---

## 4. ğŸ“ æ—¥å¿—ä½ç½®é…ç½®ç­–ç•¥


### 4.1 å¸¸è§æ—¥å¿—è·¯å¾„é€‰æ‹©


**ğŸ—‚ï¸ æ ‡å‡†è·¯å¾„æ¨è**ï¼š

```
Linuxç³»ç»Ÿæ¨èè·¯å¾„ï¼š
â”œâ”€â”€ /var/log/nginx/           â† æœ€å¸¸ç”¨çš„æ ‡å‡†ä½ç½®
â”‚   â”œâ”€â”€ error.log            â† ä¸»é”™è¯¯æ—¥å¿—
â”‚   â”œâ”€â”€ access.log           â† è®¿é—®æ—¥å¿—
â”‚   â””â”€â”€ debug.log            â† è°ƒè¯•æ—¥å¿—
â”‚
â”œâ”€â”€ /usr/local/nginx/logs/    â† ç¼–è¯‘å®‰è£…æ—¶å¸¸ç”¨
â”‚   â””â”€â”€ error.log
â”‚
â””â”€â”€ /home/user/logs/          â† ç”¨æˆ·æƒé™å—é™æ—¶
    â””â”€â”€ nginx_error.log
```

### 4.2 æ—¥å¿—è·¯å¾„é…ç½®è€ƒè™‘å› ç´ 


**ğŸ’¾ å­˜å‚¨ç©ºé—´è§„åˆ’**ï¼š

```
ç£ç›˜ç©ºé—´åˆ†é…å»ºè®®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿç›˜ï¼š/                   â”‚ â† ä¸å»ºè®®æ”¾æ—¥å¿—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¥å¿—ç›˜ï¼š/var/log           â”‚ â† æ¨èï¼šç‹¬ç«‹åˆ†åŒº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ æ•°æ®ç›˜ï¼š/data              â”‚ â† å¯é€‰ï¼šå¤§å®¹é‡å­˜å‚¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŠ¿ï¼š
â€¢ æ—¥å¿—æ»¡äº†ä¸å½±å“ç³»ç»Ÿè¿è¡Œ
â€¢ æ–¹ä¾¿æ—¥å¿—ç®¡ç†å’Œå¤‡ä»½
â€¢ æ€§èƒ½éš”ç¦»
```

**ğŸ” æƒé™é…ç½®è¦æ±‚**ï¼š

```nginx
# ç¡®ä¿Nginxè¿›ç¨‹æœ‰å†™å…¥æƒé™
# æŸ¥çœ‹Nginxè¿è¡Œç”¨æˆ·
ps aux | grep nginx

# è®¾ç½®æ­£ç¡®çš„ç›®å½•æƒé™
sudo mkdir -p /var/log/nginx
sudo chown nginx:nginx /var/log/nginx
sudo chmod 755 /var/log/nginx
```

### 4.3 é«˜çº§æ—¥å¿—è·¯å¾„é…ç½®


**ğŸ“Š æŒ‰è™šæ‹Ÿä¸»æœºåˆ†ç¦»æ—¥å¿—**ï¼š

```nginx
# ä¸ºä¸åŒç½‘ç«™é…ç½®ç‹¬ç«‹çš„é”™è¯¯æ—¥å¿—
server {
    server_name example.com;
    error_log /var/log/nginx/example.com_error.log warn;
}

server {
    server_name test.com;
    error_log /var/log/nginx/test.com_error.log warn;
}
```

**ğŸ“… æŒ‰æ—¶é—´æ»šåŠ¨æ—¥å¿—**ï¼š

```nginx
# ä½¿ç”¨å˜é‡å®ç°æŒ‰æ—¥æœŸåˆ†å‰²
map $time_iso8601 $logdate {
    ~^(\d{4}-\d{2}-\d{2}) $1;
}

server {
    error_log /var/log/nginx/error_$logdate.log warn;
}
```

---

## 5. ğŸ”§ é”™è¯¯è°ƒè¯•ä¸æ•…éšœæ’æŸ¥


### 5.1 å¸¸è§é”™è¯¯ç±»å‹è¯†åˆ«


**ğŸš« å…¸å‹é”™è¯¯ä¿¡æ¯è§£è¯»**ï¼š

```
é”™è¯¯ç±»å‹åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®æ–‡ä»¶é”™è¯¯       â”‚ â† nginx -t å¯æ£€æµ‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æƒé™é—®é¢˜é”™è¯¯       â”‚ â† 403ã€æ–‡ä»¶æ— æ³•è®¿é—®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸Šæ¸¸æœåŠ¡å™¨é”™è¯¯     â”‚ â† 502ã€503ã€504
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   èµ„æºä¸è¶³é”™è¯¯       â”‚ â† å†…å­˜ã€æ–‡ä»¶å¥æŸ„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é”™è¯¯æ—¥å¿—åˆ†æå®ä¾‹


**âŒ é…ç½®æ–‡ä»¶é”™è¯¯ç¤ºä¾‹**ï¼š
```
æ—¥å¿—å†…å®¹ï¼š
2024/09/21 15:30:45 [emerg] 1234#0: unexpected "}" in /etc/nginx/nginx.conf:25

è§£è¯»ï¼š
â€¢ emergçº§åˆ«ï¼šä¸¥é‡é”™è¯¯ï¼ŒNginxæ— æ³•å¯åŠ¨
â€¢ ä½ç½®ï¼š/etc/nginx/nginx.conf ç¬¬25è¡Œ
â€¢ é—®é¢˜ï¼šå¤šäº†ä¸€ä¸ªå³å¤§æ‹¬å· "}"
â€¢ è§£å†³ï¼šæ£€æŸ¥ç¬¬25è¡Œé™„è¿‘çš„æ‹¬å·åŒ¹é…
```

**ğŸ”’ æƒé™é—®é¢˜ç¤ºä¾‹**ï¼š
```
æ—¥å¿—å†…å®¹ï¼š
2024/09/21 15:30:45 [crit] 1234#0: *1 open() "/var/www/html/index.html" failed (13: Permission denied)

è§£è¯»ï¼š
â€¢ critçº§åˆ«ï¼šä¸¥é‡é”™è¯¯
â€¢ é—®é¢˜ï¼šæ— æ³•æ‰“å¼€æ–‡ä»¶ï¼Œæƒé™è¢«æ‹’ç»
â€¢ è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™å’ŒNginxè¿è¡Œç”¨æˆ·
```

**ğŸ”— ä¸Šæ¸¸æœåŠ¡å™¨é”™è¯¯ç¤ºä¾‹**ï¼š
```
æ—¥å¿—å†…å®¹ï¼š
2024/09/21 15:30:45 [error] 1234#0: *1 connect() failed (111: Connection refused) while connecting to upstream

è§£è¯»ï¼š
â€¢ errorçº§åˆ«ï¼šæ™®é€šé”™è¯¯
â€¢ é—®é¢˜ï¼šæ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨
â€¢ åŸå› ï¼šåç«¯æœåŠ¡å¯èƒ½åœæ­¢è¿è¡Œ
â€¢ è§£å†³ï¼šæ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
```

### 5.3 ç³»ç»ŸåŒ–æ•…éšœæ’æŸ¥æµç¨‹


```
æ•…éšœæ’æŸ¥æ ‡å‡†æµç¨‹ï¼š
ç¬¬1æ­¥ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—
    â†“
ç¬¬2æ­¥ï¼šç¡®å®šé”™è¯¯çº§åˆ«å’Œç±»å‹
    â†“  
ç¬¬3æ­¥ï¼šå®šä½å…·ä½“é”™è¯¯ä½ç½®
    â†“
ç¬¬4æ­¥ï¼šåˆ†æé”™è¯¯åŸå› 
    â†“
ç¬¬5æ­¥ï¼šåˆ¶å®šè§£å†³æ–¹æ¡ˆ
    â†“
ç¬¬6æ­¥ï¼šéªŒè¯ä¿®å¤æ•ˆæœ
    â†“
ç¬¬7æ­¥ï¼šè®°å½•è§£å†³è¿‡ç¨‹
```

**ğŸ› ï¸ å¿«é€Ÿè¯Šæ–­å‘½ä»¤**ï¼š

```bash
# å®æ—¶æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯ï¼ˆæœ€æ–°20æ¡ï¼‰
tail -20 /var/log/nginx/error.log

# æœç´¢ç‰¹å®šé”™è¯¯ç±»å‹
grep "error" /var/log/nginx/error.log | tail -10

# æŒ‰æ—¶é—´èŒƒå›´æŸ¥çœ‹é”™è¯¯
grep "2024/09/21 15:" /var/log/nginx/error.log
```

---

## 6. ğŸ“ˆ æ—¥å¿—åˆ†æå®æˆ˜æŠ€å·§


### 6.1 é«˜æ•ˆæ—¥å¿—åˆ†ææ–¹æ³•


**ğŸ” å¿«é€Ÿå®šä½é—®é¢˜çš„æŠ€å·§**ï¼š

| é—®é¢˜ç±»å‹ | **æœç´¢å‘½ä»¤** | **å…³é”®è¯** |
|---------|-------------|-----------|
| **è¿æ¥é”™è¯¯** | `grep "connect" error.log` | `connect refused, timeout` |
| **æƒé™é—®é¢˜** | `grep "permission\|denied" error.log` | `permission denied, 403` |
| **é…ç½®é”™è¯¯** | `grep "emerg\|crit" error.log` | `unexpected, invalid` |
| **èµ„æºä¸è¶³** | `grep "limit\|memory" error.log` | `too many, out of memory` |

### 6.2 æ—¥å¿—ç»Ÿè®¡åˆ†æ


**ğŸ“Š é”™è¯¯é¢‘ç‡ç»Ÿè®¡**ï¼š

```bash
# ç»Ÿè®¡å„ç§é”™è¯¯çº§åˆ«çš„æ•°é‡
awk '{print $4}' /var/log/nginx/error.log | sort | uniq -c

# è¾“å‡ºç¤ºä¾‹ï¼š
#   15 [error]
#    3 [warn]  
#    1 [crit]

# ç»Ÿè®¡æœ€å¸¸è§çš„é”™è¯¯ä¿¡æ¯
grep "error" /var/log/nginx/error.log | awk -F'] ' '{print $2}' | sort | uniq -c | sort -nr
```

### 6.3 æ—¥å¿—ç›‘æ§å‘Šè­¦è®¾ç½®


**âš ï¸ å…³é”®é”™è¯¯å‘Šè­¦è§„åˆ™**ï¼š

```bash
# ç›‘æ§è„šæœ¬ç¤ºä¾‹
#!/bin/bash
LOG_FILE="/var/log/nginx/error.log"
ERROR_COUNT=$(grep "$(date '+%Y/%m/%d %H:')" $LOG_FILE | grep -c "error\|crit\|emerg")

if [ $ERROR_COUNT -gt 10 ]; then
    echo "Nginxé”™è¯¯è¿‡å¤š: $ERROR_COUNT ä¸ªé”™è¯¯åœ¨è¿‡å»1å°æ—¶å†…" | mail -s "Nginxå‘Šè­¦" admin@example.com
fi
```

### 6.4 æ—¥å¿—è½®è½¬ä¸å½’æ¡£


**ğŸ”„ æ—¥å¿—è½®è½¬é…ç½®**ï¼š

```bash
# /etc/logrotate.d/nginx é…ç½®æ–‡ä»¶
/var/log/nginx/*.log {
    daily                    # æ¯å¤©è½®è½¬
    missingok               # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    rotate 52               # ä¿ç•™52ä¸ªå†å²æ–‡ä»¶
    compress                # å‹ç¼©æ—§æ—¥å¿—
    delaycompress          # å»¶è¿Ÿä¸€å¤©å‹ç¼©
    notifempty             # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 640 nginx nginx  # åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™
    postrotate             # è½®è½¬åæ‰§è¡Œ
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é”™è¯¯æ—¥å¿—æœ¬è´¨ï¼šè®°å½•Nginxè¿è¡Œæ—¶çš„é—®é¢˜å’Œå¼‚å¸¸
ğŸ”¸ error_logæŒ‡ä»¤ï¼šé…ç½®æ—¥å¿—æ–‡ä»¶ä½ç½®å’Œè®°å½•çº§åˆ«  
ğŸ”¸ æ—¥å¿—çº§åˆ«ï¼šä»emergåˆ°debugå…±8ä¸ªçº§åˆ«ï¼Œçº§åˆ«è¶Šä½è®°å½•è¶Šè¯¦ç»†
ğŸ”¸ é…ç½®ä½ç½®ï¼šå¯åœ¨mainã€httpã€serverä¸­é…ç½®ï¼Œlocationä¸­ä¸èƒ½é…ç½®
ğŸ”¸ æ•…éšœæ’æŸ¥ï¼šé€šè¿‡é”™è¯¯æ—¥å¿—å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜
```

### 7.2 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**âœ… æ¨èé…ç½®**ï¼š
```nginx
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
error_log /var/log/nginx/error.log warn;

# é‡è¦ç½‘ç«™ç‹¬ç«‹æ—¥å¿—
server {
    server_name important.com;
    error_log /var/log/nginx/important_error.log error;
}
```

**âš ï¸ é¿å…çš„åšæ³•**ï¼š
- âŒ ä¸è¦è®¾ç½®debugçº§åˆ«åœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆæ—¥å¿—è¿‡å¤šï¼‰
- âŒ ä¸è¦å®Œå…¨å…³é—­é”™è¯¯æ—¥å¿—ï¼ˆerror_log offï¼‰  
- âŒ ä¸è¦æŠŠæ—¥å¿—æ”¾åœ¨ç³»ç»Ÿç›˜ï¼ˆå¯èƒ½æ’‘çˆ†ç£ç›˜ï¼‰
- âŒ ä¸è¦å¿˜è®°é…ç½®æ—¥å¿—è½®è½¬ï¼ˆæ–‡ä»¶ä¼šæ— é™å¢å¤§ï¼‰

### 7.3 æ•…éšœæ’æŸ¥è®°å¿†è¦ç‚¹


> ğŸ’¡ **ä¸‰æ­¥æ’æŸ¥æ³•**ï¼š
> 1. **çœ‹æ—¥å¿—**ï¼štail -f /var/log/nginx/error.log
> 2. **æ‰¾å…³é”®è¯**ï¼šgrep "error\|crit\|emerg" 
> 3. **å®šä½åŸå› **ï¼šåˆ†æé”™è¯¯ä¿¡æ¯çš„æ—¶é—´ã€çº§åˆ«ã€å…·ä½“å†…å®¹

### 7.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æ–°æ‰‹å…¥é—¨æŒ‡å¯¼**ï¼š
- å­¦ä¼šè¯»æ‡‚é”™è¯¯æ—¥å¿—æ˜¯Nginxè¿ç»´çš„ç¬¬ä¸€æŠ€èƒ½
- æŒæ¡error_logé…ç½®å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜
- ç†è§£æ—¥å¿—çº§åˆ«å¸®åŠ©è¿‡æ»¤æ— ç”¨ä¿¡æ¯
- å»ºç«‹æ—¥å¿—åˆ†æä¹ æƒ¯æå‡æ•…éšœå¤„ç†èƒ½åŠ›

**ğŸš€ è¿›é˜¶æŠ€èƒ½å‘å±•**ï¼š
- ç»“åˆç›‘æ§ç³»ç»Ÿå®ç°è‡ªåŠ¨å‘Šè­¦
- ä½¿ç”¨ELKç­‰å·¥å…·è¿›è¡Œæ—¥å¿—é›†ä¸­åˆ†æ  
- ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬å¤„ç†å¸¸è§é—®é¢˜
- å»ºç«‹å®Œæ•´çš„æ—¥å¿—ç®¡ç†ä½“ç³»

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ“ **é”™è¯¯æ—¥å¿—å¾ˆé‡è¦ï¼Œæ’æŸ¥æ•…éšœå°‘ä¸äº†**  
> ğŸ“ **error_logé…è·¯å¾„ï¼Œçº§åˆ«é€‰æ‹©è¦åˆç†**  
> ğŸ“ **warné€‚åˆç”Ÿäº§ç”¨ï¼Œdebugåªåœ¨å¼€å‘è°ƒ**  
> ğŸ“ **å®æ—¶ç›‘æ§tailå‘½ä»¤ï¼Œgrepæœç´¢å®šä½å¿«**