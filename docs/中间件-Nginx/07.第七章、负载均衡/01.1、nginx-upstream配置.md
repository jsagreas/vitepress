---
title: 1ã€nginx-upstreamé…ç½®
---
## ğŸ“š ç›®å½•

1. [upstreamæ¨¡å—åŸºç¡€æ¦‚å¿µ](#1-upstreamæ¨¡å—åŸºç¡€æ¦‚å¿µ)
2. [åç«¯æœåŠ¡å™¨å®šä¹‰ä¸é…ç½®](#2-åç«¯æœåŠ¡å™¨å®šä¹‰ä¸é…ç½®)
3. [æœåŠ¡å™¨æƒé‡è®¾ç½®è¯¦è§£](#3-æœåŠ¡å™¨æƒé‡è®¾ç½®è¯¦è§£)
4. [backupæœåŠ¡å™¨æœºåˆ¶](#4-backupæœåŠ¡å™¨æœºåˆ¶)
5. [downæ ‡è®°ä¸æœåŠ¡å™¨ç®¡ç†](#5-downæ ‡è®°ä¸æœåŠ¡å™¨ç®¡ç†)
6. [max_failsæ•…éšœæ£€æµ‹é…ç½®](#6-max_failsæ•…éšœæ£€æµ‹é…ç½®)
7. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#7-å®æˆ˜é…ç½®æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ upstreamæ¨¡å—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯upstream


**ğŸ’¡ ç®€å•ç†è§£**
`upstream`å°±åƒæ˜¯ä¸€ä¸ª**æœåŠ¡å™¨ç»„ç»‡è€…**ï¼Œå®ƒæŠŠå¤šå°åç«¯æœåŠ¡å™¨ç»„ç»‡åœ¨ä¸€èµ·ï¼Œç»™å®ƒä»¬èµ·ä¸ªåå­—ï¼Œç„¶åNginxå°±å¯ä»¥æŠŠç”¨æˆ·è¯·æ±‚åˆ†å‘ç»™è¿™äº›æœåŠ¡å™¨ã€‚

```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ å¼€äº†ä¸€å®¶é¤å…ï¼Œæœ‰3ä¸ªå¨å¸ˆ
- upstreamå°±æ˜¯"å¨å¸ˆç»„"çš„æ¦‚å¿µ
- æ¯ä¸ªå¨å¸ˆå°±æ˜¯ä¸€å°åç«¯æœåŠ¡å™¨
- å½“å®¢äººç‚¹èœæ—¶ï¼Œä½ å†³å®šè®©å“ªä¸ªå¨å¸ˆæ¥åšèœ
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
- **æœåŠ¡å™¨åˆ†ç»„**ï¼šæŠŠå¤šå°æœåŠ¡å™¨ç»„ç»‡æˆä¸€ä¸ªé€»è¾‘ç»„
- **è´Ÿè½½åˆ†å‘**ï¼šæ™ºèƒ½åˆ†é…ç”¨æˆ·è¯·æ±‚
- **æ•…éšœå¤„ç†**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†æœåŠ¡å™¨æ•…éšœ
- **ç»Ÿä¸€ç®¡ç†**ï¼šé›†ä¸­é…ç½®å’Œç®¡ç†åç«¯æœåŠ¡å™¨

### 1.2 upstreamåœ¨Nginxä¸­çš„ä½ç½®


**ğŸ—ï¸ é…ç½®ç»“æ„å›¾**
```
nginx.conf
â”œâ”€â”€ httpå—
â”‚   â”œâ”€â”€ upstreamå— (å®šä¹‰æœåŠ¡å™¨ç»„)
â”‚   â”‚   â”œâ”€â”€ serveræŒ‡ä»¤ (å®šä¹‰å…·ä½“æœåŠ¡å™¨)
â”‚   â”‚   â””â”€â”€ å…¶ä»–é…ç½®æŒ‡ä»¤
â”‚   â””â”€â”€ serverå—
â”‚       â””â”€â”€ locationå—
â”‚           â””â”€â”€ proxy_pass (ä½¿ç”¨upstream)
```

**ğŸ“‹ åŸºæœ¬è¯­æ³•ç»“æ„**
```nginx
http {
    # å®šä¹‰åç«¯æœåŠ¡å™¨ç»„
    upstream backend_group {
        server 192.168.1.10:8080;
        server 192.168.1.11:8080;
        server 192.168.1.12:8080;
    }
    
    server {
        location / {
            # ä½¿ç”¨å®šä¹‰çš„æœåŠ¡å™¨ç»„
            proxy_pass http://backend_group;
        }
    }
}
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦upstream


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**

| é—®é¢˜åœºæ™¯ | ä¼ ç»Ÿåšæ³• | upstreamè§£å†³æ–¹æ¡ˆ |
|---------|---------|-----------------|
| **å•ç‚¹æ•…éšœ** | ä¸€å°æœåŠ¡å™¨æŒ‚äº†ï¼ŒæœåŠ¡åœæ­¢ | å¤šå°æœåŠ¡å™¨ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§» |
| **æ€§èƒ½ç“¶é¢ˆ** | ä¸€å°æœåŠ¡å™¨å¤„ç†æ‰€æœ‰è¯·æ±‚ | å¤šå°æœåŠ¡å™¨åˆ†æ‹…è´Ÿè½½ |
| **ç»´æŠ¤å›°éš¾** | åœæœºç»´æŠ¤å½±å“ç”¨æˆ· | é€å°ç»´æŠ¤ï¼Œä¸å½±å“æœåŠ¡ |
| **æ‰©å±•å›°éš¾** | éœ€è¦ä¿®æ”¹å¤§é‡é…ç½® | ç®€å•å¢å‡æœåŠ¡å™¨ |

---

## 2. ğŸ–¥ï¸ åç«¯æœåŠ¡å™¨å®šä¹‰ä¸é…ç½®


### 2.1 serveræŒ‡ä»¤åŸºç¡€


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```nginx
upstream backend_name {
    server address [parameters];
}
```

**ğŸ“ addressæ ¼å¼è¯´æ˜**

```
æ”¯æŒçš„åœ°å€æ ¼å¼ï¼š
â€¢ IPåœ°å€:ç«¯å£     â†’ server 192.168.1.10:8080;
â€¢ åŸŸå:ç«¯å£       â†’ server app1.example.com:8080;
â€¢ Unixå¥—æ¥å­—     â†’ server unix:/tmp/backend.socket;
â€¢ ä»…IPåœ°å€       â†’ server 192.168.1.10; (é»˜è®¤80ç«¯å£)
```

### 2.2 å®é™…é…ç½®ç¤ºä¾‹


**ğŸ’» Webåº”ç”¨é›†ç¾¤é…ç½®**
```nginx
# å®šä¹‰Webåº”ç”¨æœåŠ¡å™¨ç»„
upstream web_servers {
    server 192.168.1.10:8080;  # ç¬¬ä¸€å°WebæœåŠ¡å™¨
    server 192.168.1.11:8080;  # ç¬¬äºŒå°WebæœåŠ¡å™¨
    server 192.168.1.12:8080;  # ç¬¬ä¸‰å°WebæœåŠ¡å™¨
}

server {
    listen 80;
    server_name www.example.com;
    
    location / {
        proxy_pass http://web_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**ğŸ“Š APIæœåŠ¡é›†ç¾¤é…ç½®**
```nginx
# å®šä¹‰APIæœåŠ¡å™¨ç»„
upstream api_servers {
    server api1.internal.com:3000;
    server api2.internal.com:3000;
    server api3.internal.com:3000;
}

server {
    listen 80;
    server_name api.example.com;
    
    location /api/ {
        proxy_pass http://api_servers;
        proxy_set_header Content-Type application/json;
    }
}
```

### 2.3 æœåŠ¡å™¨åœ°å€çš„é€‰æ‹©åŸåˆ™


**ğŸ¯ é…ç½®å»ºè®®**

```
å†…ç½‘åœ°å€ä¼˜å…ˆï¼š
âœ… æ¨èï¼šserver 192.168.1.10:8080;
âŒ é¿å…ï¼šserver external.example.com:8080;

ç«¯å£æ˜ç¡®æŒ‡å®šï¼š
âœ… æ¨èï¼šserver 192.168.1.10:8080;
âš ï¸ è°¨æ…ï¼šserver 192.168.1.10; (é»˜è®¤80ç«¯å£)

ç»Ÿä¸€å‘½åè§„èŒƒï¼š
âœ… æ¨èï¼šweb01, web02, web03
âŒ é¿å…ï¼šserver1, test-machine, my-computer
```

---

## 3. âš–ï¸ æœåŠ¡å™¨æƒé‡è®¾ç½®è¯¦è§£


### 3.1 æƒé‡æ¦‚å¿µç†è§£


**ğŸ’¡ ä»€ä¹ˆæ˜¯æƒé‡**
æƒé‡ï¼ˆweightï¼‰å°±åƒæ˜¯ç»™æ¯å°æœåŠ¡å™¨åˆ†é…"å¤„ç†èƒ½åŠ›ç‚¹æ•°"ï¼Œç‚¹æ•°è¶Šé«˜çš„æœåŠ¡å™¨ï¼Œåˆ†é…åˆ°çš„è¯·æ±‚å°±è¶Šå¤šã€‚

**ğŸ”„ æƒé‡åˆ†å‘åŸç†å›¾**
```
å‡è®¾æœ‰3å°æœåŠ¡å™¨ï¼š
Server A: weight=3  (30%çš„è¯·æ±‚)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Server B: weight=2  (20%çš„è¯·æ±‚)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Server C: weight=5  (50%çš„è¯·æ±‚)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

æ€»æƒé‡ = 3+2+5 = 10
Aåˆ†é…æ¯”ä¾‹ = 3/10 = 30%
Båˆ†é…æ¯”ä¾‹ = 2/10 = 20%  
Cåˆ†é…æ¯”ä¾‹ = 5/10 = 50%
```

### 3.2 æƒé‡é…ç½®è¯­æ³•


**ğŸ“‹ åŸºæœ¬é…ç½®æ ¼å¼**
```nginx
upstream backend {
    server 192.168.1.10:8080 weight=3;
    server 192.168.1.11:8080 weight=2;
    server 192.168.1.12:8080 weight=5;
}
```

**ğŸ”¢ æƒé‡å€¼è¯´æ˜**
- **é»˜è®¤å€¼**ï¼š`weight=1`ï¼ˆä¸å†™weightå‚æ•°æ—¶çš„é»˜è®¤å€¼ï¼‰
- **å–å€¼èŒƒå›´**ï¼šæ­£æ•´æ•°ï¼ˆ1, 2, 3, ... ï¼‰
- **ç›¸å¯¹æƒé‡**ï¼šé‡è¦çš„æ˜¯æ¯”ä¾‹å…³ç³»ï¼Œä¸æ˜¯ç»å¯¹æ•°å€¼

### 3.3 æƒé‡è®¾ç½®çš„å®é™…åº”ç”¨


**ğŸ’ª æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è®¾ç½®æƒé‡**
```nginx
upstream mixed_servers {
    # é«˜æ€§èƒ½æœåŠ¡å™¨ - 16æ ¸32Gå†…å­˜
    server 192.168.1.10:8080 weight=5;
    
    # ä¸­ç­‰æ€§èƒ½æœåŠ¡å™¨ - 8æ ¸16Gå†…å­˜  
    server 192.168.1.11:8080 weight=3;
    server 192.168.1.12:8080 weight=3;
    
    # ä½æ€§èƒ½æœåŠ¡å™¨ - 4æ ¸8Gå†…å­˜
    server 192.168.1.13:8080 weight=1;
}
```

**â° æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®æƒé‡**
```nginx
upstream business_servers {
    # æ–°ç‰ˆæœ¬æœåŠ¡å™¨ - ç°åº¦å‘å¸ƒï¼Œå°‘é‡æµé‡
    server 192.168.1.20:8080 weight=1;
    
    # ç¨³å®šç‰ˆæœ¬æœåŠ¡å™¨ - ä¸»è¦æµé‡
    server 192.168.1.10:8080 weight=4;
    server 192.168.1.11:8080 weight=4;
}
```

### 3.4 æƒé‡é…ç½®çš„æ³¨æ„äº‹é¡¹


> **âš ï¸ é‡è¦æé†’**
> 
> **æƒé‡æ¯”ä¾‹è¦åˆç†**ï¼šä¸è¦è®¾ç½®è¿‡å¤§çš„æƒé‡å·®è·ï¼Œé¿å…æŸå°æœåŠ¡å™¨è´Ÿè½½è¿‡é‡
> 
> **è€ƒè™‘å®é™…æ€§èƒ½**ï¼šæƒé‡è®¾ç½®è¦ç¬¦åˆæœåŠ¡å™¨çš„çœŸå®å¤„ç†èƒ½åŠ›
> 
> **å®šæœŸè°ƒæ•´**ï¼šæ ¹æ®ç›‘æ§æ•°æ®è°ƒæ•´æƒé‡é…ç½®

**ğŸ“Š æƒé‡è®¾ç½®å»ºè®®è¡¨**

| æœåŠ¡å™¨é…ç½® | æ¨èæƒé‡ | è¯´æ˜ |
|-----------|---------|------|
| **é«˜ç«¯æœåŠ¡å™¨** | `weight=4-5` | 16æ ¸ä»¥ä¸Šï¼Œ32Gä»¥ä¸Šå†…å­˜ |
| **ä¸­ç«¯æœåŠ¡å™¨** | `weight=2-3` | 8-16æ ¸ï¼Œ16-32Gå†…å­˜ |
| **å…¥é—¨æœåŠ¡å™¨** | `weight=1-2` | 4-8æ ¸ï¼Œ8-16Gå†…å­˜ |
| **æµ‹è¯•æœåŠ¡å™¨** | `weight=1` | ç”¨äºåŠŸèƒ½éªŒè¯ |

---

## 4. ğŸ›¡ï¸ backupæœåŠ¡å™¨æœºåˆ¶


### 4.1 backupæœåŠ¡å™¨æ¦‚å¿µ


**ğŸ’¡ ä»€ä¹ˆæ˜¯backupæœåŠ¡å™¨**
backupæœåŠ¡å™¨å°±åƒæ˜¯**å¤‡ç”¨è½®èƒ**ï¼Œå¹³æ—¶ä¸ä½¿ç”¨ï¼Œåªæœ‰å½“æ‰€æœ‰æ­£å¸¸æœåŠ¡å™¨éƒ½å‡ºé—®é¢˜æ—¶ï¼Œæ‰ä¼šå¯ç”¨backupæœåŠ¡å™¨æ¥åº”æ€¥ã€‚

**ğŸ”„ backupå·¥ä½œæµç¨‹**
```
æ­£å¸¸æƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ Nginx â†’ æ­£å¸¸æœåŠ¡å™¨ç»„ (backupæœåŠ¡å™¨ç©ºé—²)

æ•…éšœæƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ Nginx â†’ æ­£å¸¸æœåŠ¡å™¨å…¨éƒ¨æ•…éšœ â†’ å¯ç”¨backupæœåŠ¡å™¨
```

### 4.2 backupé…ç½®è¯­æ³•


**ğŸ“‹ åŸºæœ¬é…ç½®ç¤ºä¾‹**
```nginx
upstream web_cluster {
    # ä¸»è¦æœåŠ¡å™¨ç»„
    server 192.168.1.10:8080 weight=3;
    server 192.168.1.11:8080 weight=3;
    server 192.168.1.12:8080 weight=2;
    
    # å¤‡ç”¨æœåŠ¡å™¨
    server 192.168.1.20:8080 backup;
    server 192.168.1.21:8080 backup;
}
```

### 4.3 backupæœåŠ¡å™¨çš„ç‰¹ç‚¹


**ğŸ”¸ æ ¸å¿ƒç‰¹æ€§**

| ç‰¹æ€§ | è¯´æ˜ | ä¾‹å­ |
|------|------|------|
| **å¾…æœºçŠ¶æ€** | å¹³æ—¶ä¸æ¥æ”¶è¯·æ±‚ | ä¸»æœåŠ¡å™¨æ­£å¸¸æ—¶ï¼ŒbackupæœåŠ¡å™¨ç©ºé—² |
| **è‡ªåŠ¨å¯ç”¨** | ä¸»æœåŠ¡å™¨å…¨éƒ¨æ•…éšœæ—¶è‡ªåŠ¨å¯ç”¨ | 3å°ä¸»æœåŠ¡å™¨éƒ½æŒ‚äº†ï¼Œbackupå¼€å§‹å·¥ä½œ |
| **é™çº§æœåŠ¡** | é€šå¸¸é…ç½®è¾ƒä½ | ä¿è¯åŸºæœ¬åŠŸèƒ½ï¼Œæ€§èƒ½å¯èƒ½è¾ƒå·® |
| **ä¸´æ—¶ä½¿ç”¨** | ä¸»æœåŠ¡å™¨æ¢å¤åè‡ªåŠ¨åœç”¨ | ä¸»æœåŠ¡å™¨ä¿®å¤åï¼Œbackupåˆå›åˆ°å¾…æœº |

### 4.4 backupæœåŠ¡å™¨çš„åº”ç”¨åœºæ™¯


**ğŸ¥ æ•…éšœåº”æ€¥åœºæ™¯**
```nginx
# ç”µå•†ç½‘ç«™é…ç½®ç¤ºä¾‹
upstream ecommerce_app {
    # ä¸»è¦æœåŠ¡å™¨ - é«˜æ€§èƒ½é›†ç¾¤
    server app1.internal.com:8080 weight=4;
    server app2.internal.com:8080 weight=4;
    server app3.internal.com:8080 weight=4;
    
    # å¤‡ç”¨æœåŠ¡å™¨ - åŸºç¡€åŠŸèƒ½ä¿éšœ
    server backup1.internal.com:8080 backup;
}
```

**ğŸ”§ ç»´æŠ¤åœºæ™¯é…ç½®**
```nginx
# æ»šåŠ¨ç»´æŠ¤æ—¶çš„é…ç½®
upstream maintenance_safe {
    # æ­£åœ¨ç»´æŠ¤çš„æœåŠ¡å™¨æ ‡è®°ä¸ºdown
    server 192.168.1.10:8080 down;
    server 192.168.1.11:8080 weight=3;
    server 192.168.1.12:8080 weight=3;
    
    # ä¸´æ—¶å¤‡ç”¨æœåŠ¡å™¨
    server 192.168.1.99:8080 backup;
}
```

### 4.5 backupé…ç½®æœ€ä½³å®è·µ


> **ğŸ’¡ é…ç½®å»ºè®®**
> 
> **backupæ•°é‡**ï¼šå»ºè®®é…ç½®1-2å°backupæœåŠ¡å™¨ï¼Œå¤ªå¤šæµªè´¹èµ„æº
> 
> **æ€§èƒ½é…ç½®**ï¼šbackupæœåŠ¡å™¨å¯ä»¥é…ç½®è¾ƒä½ï¼Œä½†è¦ä¿è¯åŸºæœ¬åŠŸèƒ½
> 
> **ç›‘æ§å‘Šè­¦**ï¼šbackupå¯ç”¨æ—¶è¦åŠæ—¶å‘é€å‘Šè­¦é€šçŸ¥

**âœ… æ¨èé…ç½®æ¨¡å¼**
```nginx
upstream production_app {
    # ä¸»åŠ›æœåŠ¡å™¨ç»„ (80%å®¹é‡)
    server prod1.example.com:8080 weight=3;
    server prod2.example.com:8080 weight=3;
    
    # å¤‡ç”¨æœåŠ¡å™¨ (20%å®¹é‡ï¼Œåº”æ€¥ä½¿ç”¨)
    server backup1.example.com:8080 backup;
}
```

---

## 5. ğŸ”§ downæ ‡è®°ä¸æœåŠ¡å™¨ç®¡ç†


### 5.1 downæ ‡è®°çš„å«ä¹‰


**ğŸ’¡ ä»€ä¹ˆæ˜¯downæ ‡è®°**
`down`æ ‡è®°å°±åƒç»™æœåŠ¡å™¨è´´ä¸Š"æš‚åœæœåŠ¡"çš„æ ‡ç­¾ï¼Œå‘Šè¯‰Nginxè¿™å°æœåŠ¡å™¨æš‚æ—¶ä¸è¦ä½¿ç”¨ï¼Œä½†é…ç½®è¿˜ä¿ç•™ç€ã€‚

**ğŸ”„ downæ ‡è®°çš„ä½œç”¨æµç¨‹**
```
æ­£å¸¸æœåŠ¡å™¨ï¼šç”¨æˆ·è¯·æ±‚ â†’ Nginx â†’ åˆ†å‘ç»™æœåŠ¡å™¨
downæ ‡è®°æœåŠ¡å™¨ï¼šç”¨æˆ·è¯·æ±‚ â†’ Nginx â†’ è·³è¿‡è¿™å°æœåŠ¡å™¨ â†’ åˆ†å‘ç»™å…¶ä»–æœåŠ¡å™¨
```

### 5.2 downæ ‡è®°çš„åŸºæœ¬è¯­æ³•


**ğŸ“‹ é…ç½®ç¤ºä¾‹**
```nginx
upstream app_servers {
    server 192.168.1.10:8080 weight=3;
    server 192.168.1.11:8080 weight=3;
    server 192.168.1.12:8080 down;      # æš‚æ—¶åœç”¨
    server 192.168.1.13:8080 weight=2;
}
```

### 5.3 downæ ‡è®°çš„ä½¿ç”¨åœºæ™¯


**ğŸ”§ ç»´æŠ¤åœºæ™¯**
```nginx
# åœºæ™¯ï¼šéœ€è¦å¯¹æœåŠ¡å™¨è¿›è¡Œç³»ç»Ÿå‡çº§
upstream web_app {
    server web01:8080 weight=3;
    server web02:8080 down;        # æ­£åœ¨ç»´æŠ¤å‡çº§
    server web03:8080 weight=3;
    server web04:8080 weight=3;
}

# ç»´æŠ¤å®Œæˆåï¼Œå»æ‰downæ ‡è®°
upstream web_app {
    server web01:8080 weight=3;
    server web02:8080 weight=3;    # ç»´æŠ¤å®Œæˆï¼Œæ¢å¤æœåŠ¡
    server web03:8080 weight=3;
    server web04:8080 weight=3;
}
```

**ğŸš¨ æ•…éšœåœºæ™¯**
```nginx
# åœºæ™¯ï¼šå‘ç°æŸå°æœåŠ¡å™¨æœ‰é—®é¢˜ï¼Œéœ€è¦ä¸´æ—¶éš”ç¦»
upstream api_cluster {
    server api01:3000 weight=2;
    server api02:3000 down;        # å‘ç°æ•…éšœï¼Œä¸´æ—¶éš”ç¦»
    server api03:3000 weight=2;
    server backup:3000 backup;     # å¯ç”¨å¤‡ç”¨æœåŠ¡å™¨
}
```

### 5.4 down vs ç›´æ¥åˆ é™¤é…ç½®


**ğŸ“Š å¯¹æ¯”åˆ†æ**

| æ“ä½œæ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|----------|
| **downæ ‡è®°** | é…ç½®ä¿ç•™ï¼Œæ¢å¤ç®€å• | é…ç½®æ–‡ä»¶ç¨æ˜¾å†—ä½™ | ä¸´æ—¶ç»´æŠ¤ã€æ•…éšœéš”ç¦» |
| **åˆ é™¤é…ç½®** | é…ç½®æ–‡ä»¶ç®€æ´ | æ¢å¤æ—¶è¦é‡æ–°æ·»åŠ  | æ°¸ä¹…ä¸‹çº¿æœåŠ¡å™¨ |

**âœ… æ¨èä½¿ç”¨æ–¹å¼**
```nginx
# ä¸´æ—¶ç»´æŠ¤ - ä½¿ç”¨downæ ‡è®°
server 192.168.1.10:8080 down;

# æ°¸ä¹…ä¸‹çº¿ - ç›´æ¥åˆ é™¤é…ç½®è¡Œ
# server 192.168.1.99:8080;  (æ³¨é‡Šæˆ–åˆ é™¤)
```

### 5.5 åŠ¨æ€ç®¡ç†æœåŠ¡å™¨çŠ¶æ€


**ğŸ”„ æ»šåŠ¨ç»´æŠ¤ç¤ºä¾‹**
```nginx
# ç¬¬ä¸€æ­¥ï¼šæ ‡è®°ç¬¬ä¸€å°æœåŠ¡å™¨down
upstream rolling_update {
    server app01:8080 down;        # ç»´æŠ¤ä¸­
    server app02:8080 weight=3;
    server app03:8080 weight=3;
}

# ç¬¬äºŒæ­¥ï¼šç¬¬ä¸€å°ç»´æŠ¤å®Œæˆï¼Œæ ‡è®°ç¬¬äºŒå°down
upstream rolling_update {
    server app01:8080 weight=3;    # ç»´æŠ¤å®Œæˆ
    server app02:8080 down;        # ç»´æŠ¤ä¸­
    server app03:8080 weight=3;
}

# ç¬¬ä¸‰æ­¥ï¼šå…¨éƒ¨ç»´æŠ¤å®Œæˆ
upstream rolling_update {
    server app01:8080 weight=3;
    server app02:8080 weight=3;    # ç»´æŠ¤å®Œæˆ
    server app03:8080 weight=3;
}
```

---

## 6. ğŸ› ï¸ max_failsæ•…éšœæ£€æµ‹é…ç½®


### 6.1 max_failsæœºåˆ¶åŸç†


**ğŸ’¡ ä»€ä¹ˆæ˜¯max_fails**
`max_fails`å°±åƒæ˜¯ç»™æœåŠ¡å™¨è®¾ç½®ä¸€ä¸ª"å®¹é”™æ¬¡æ•°"ï¼Œå½“Nginxè¿ç»­å‘æŸå°æœåŠ¡å™¨å‘é€è¯·æ±‚å¤±è´¥æ¬¡æ•°è¾¾åˆ°è¿™ä¸ªå€¼æ—¶ï¼Œå°±æš‚æ—¶æŠŠè¿™å°æœåŠ¡å™¨æ ‡è®°ä¸ºä¸å¯ç”¨ã€‚

**ğŸ”„ æ•…éšœæ£€æµ‹æµç¨‹å›¾**
```
è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ Nginx â†’ åç«¯æœåŠ¡å™¨

æ­£å¸¸æƒ…å†µï¼š
è¯·æ±‚æˆåŠŸ â†’ å¤±è´¥è®¡æ•°å™¨æ¸…é›¶

æ•…éšœæƒ…å†µï¼š
è¯·æ±‚å¤±è´¥ â†’ å¤±è´¥è®¡æ•°å™¨+1 â†’ è¾¾åˆ°max_fails â†’ æš‚æ—¶ç§»é™¤æœåŠ¡å™¨
```

### 6.2 max_failsåŸºæœ¬è¯­æ³•


**ğŸ“‹ é…ç½®æ ¼å¼**
```nginx
upstream backend {
    server 192.168.1.10:8080 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:8080 max_fails=3 fail_timeout=30s;
}
```

**ğŸ”¢ å‚æ•°è¯´æ˜**
- **max_fails**ï¼šå…è®¸çš„æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼š1ï¼‰
- **fail_timeout**ï¼šå¤±è´¥åçš„æš‚åœæ—¶é—´ï¼ˆé»˜è®¤å€¼ï¼š10sï¼‰

### 6.3 æ•…éšœæ£€æµ‹çš„å·¥ä½œæœºåˆ¶


**â±ï¸ æ£€æµ‹æ—¶é—´è½´ç¤ºä¾‹**
```
æ—¶é—´ç‚¹  äº‹ä»¶                     å¤±è´¥è®¡æ•°  æœåŠ¡å™¨çŠ¶æ€
00:00   è¯·æ±‚æˆåŠŸ                 0        æ­£å¸¸
00:01   è¯·æ±‚å¤±è´¥                 1        æ­£å¸¸
00:02   è¯·æ±‚å¤±è´¥                 2        æ­£å¸¸  
00:03   è¯·æ±‚å¤±è´¥                 3        æš‚åœ (è¾¾åˆ°max_fails=3)
00:03-00:33  æš‚åœæœŸé—´              -        ä¸æ¥æ”¶è¯·æ±‚
00:33   é‡æ–°å°è¯•                 0        æ¢å¤æ­£å¸¸
```

### 6.4 å®é™…é…ç½®ç¤ºä¾‹


**ğŸŒ Webåº”ç”¨æ•…éšœæ£€æµ‹**
```nginx
upstream web_servers {
    # é…ç½®æ•…éšœæ£€æµ‹å‚æ•°
    server web01:8080 weight=3 max_fails=2 fail_timeout=20s;
    server web02:8080 weight=3 max_fails=2 fail_timeout=20s;
    server web03:8080 weight=2 max_fails=3 fail_timeout=30s;
    
    # å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ›´å®½æ¾çš„æ£€æµ‹
    server backup:8080 backup max_fails=5 fail_timeout=60s;
}
```

**ğŸ“Š APIæœåŠ¡æ•…éšœæ£€æµ‹**
```nginx
upstream api_servers {
    # APIæœåŠ¡é€šå¸¸è¦æ±‚æ›´ä¸¥æ ¼çš„æ£€æµ‹
    server api01:3000 max_fails=1 fail_timeout=10s;
    server api02:3000 max_fails=1 fail_timeout=10s;
    server api03:3000 max_fails=1 fail_timeout=10s;
}
```

### 6.5 max_failså‚æ•°è°ƒä¼˜


**ğŸ¯ å‚æ•°è®¾ç½®å»ºè®®**

| æœåŠ¡ç±»å‹ | max_fails | fail_timeout | è¯´æ˜ |
|---------|-----------|--------------|------|
| **Webåº”ç”¨** | `2-3` | `20-30s` | å¹³è¡¡å“åº”é€Ÿåº¦å’Œå®¹é”™æ€§ |
| **APIæœåŠ¡** | `1-2` | `10-20s` | å¿«é€Ÿæ•…éšœæ£€æµ‹ |
| **æ–‡ä»¶æœåŠ¡** | `3-5` | `30-60s` | å…è®¸æ›´å¤šé‡è¯• |
| **å¤‡ç”¨æœåŠ¡å™¨** | `5-10` | `60-120s` | æ›´å®½æ¾çš„æ£€æµ‹ç­–ç•¥ |

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```nginx
# é«˜å¯ç”¨é…ç½® - å¿«é€Ÿæ•…éšœåˆ‡æ¢
upstream high_availability {
    server primary:8080   max_fails=1 fail_timeout=5s;
    server secondary:8080 max_fails=1 fail_timeout=5s;
    server emergency:8080 backup max_fails=3 fail_timeout=30s;
}

# ç¨³å®šæ€§é…ç½® - é¿å…è¯¯åˆ¤
upstream stable_service {
    server stable01:8080 max_fails=3 fail_timeout=30s;
    server stable02:8080 max_fails=3 fail_timeout=30s;
}
```

### 6.6 æ•…éšœæ£€æµ‹çš„æ³¨æ„äº‹é¡¹


> **âš ï¸ é‡è¦æé†’**
> 
> **ç½‘ç»œæ³¢åŠ¨å½±å“**ï¼šç½‘ç»œä¸ç¨³å®šæ—¶å¯èƒ½å¯¼è‡´è¯¯åˆ¤ï¼Œé€‚å½“å¢å¤§max_failså€¼
> 
> **æœåŠ¡å¯åŠ¨æ—¶é—´**ï¼šæŸäº›åº”ç”¨å¯åŠ¨è¾ƒæ…¢ï¼Œéœ€è¦è°ƒæ•´fail_timeout
> 
> **ç›‘æ§é…åˆ**ï¼šæ•…éšœæ£€æµ‹è¦é…åˆç›‘æ§ç³»ç»Ÿï¼ŒåŠæ—¶å‘ç°é—®é¢˜

**ğŸ” æ•…éšœæ’æŸ¥è¦ç‚¹**
- æ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦çœŸçš„æœ‰é—®é¢˜
- æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
- ç¡®è®¤ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- éªŒè¯æœåŠ¡å™¨è´Ÿè½½æ˜¯å¦è¿‡é«˜

---

## 7. ğŸ¯ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 7.1 ç”µå•†ç½‘ç«™å®Œæ•´é…ç½®


**ğŸ›’ ç”µå•†å¹³å°è´Ÿè½½å‡è¡¡é…ç½®**
```nginx
# ç”µå•†ä¸»ç«™æœåŠ¡å™¨ç»„
upstream ecommerce_web {
    # ä¸»åŠ›æœåŠ¡å™¨ - é«˜æ€§èƒ½é…ç½®
    server web01.shop.com:8080 weight=4 max_fails=2 fail_timeout=20s;
    server web02.shop.com:8080 weight=4 max_fails=2 fail_timeout=20s;
    server web03.shop.com:8080 weight=3 max_fails=2 fail_timeout=20s;
    
    # å¤‡ç”¨æœåŠ¡å™¨ - åº”æ€¥ä½¿ç”¨
    server backup-web.shop.com:8080 backup max_fails=3 fail_timeout=60s;
}

# APIæœåŠ¡å™¨ç»„
upstream ecommerce_api {
    # APIæœåŠ¡å™¨ - å¿«é€Ÿæ•…éšœæ£€æµ‹
    server api01.shop.com:3000 weight=3 max_fails=1 fail_timeout=10s;
    server api02.shop.com:3000 weight=3 max_fails=1 fail_timeout=10s;
    server api03.shop.com:3000 weight=2 max_fails=1 fail_timeout=10s;
    
    # APIå¤‡ç”¨æœåŠ¡å™¨
    server backup-api.shop.com:3000 backup max_fails=2 fail_timeout=30s;
}

server {
    listen 80;
    server_name www.shop.com;
    
    # ä¸»ç«™é¡µé¢
    location / {
        proxy_pass http://ecommerce_web;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # APIæ¥å£
    location /api/ {
        proxy_pass http://ecommerce_api;
        proxy_set_header Host $host;
        proxy_set_header Content-Type application/json;
    }
}
```

### 7.2 ä¼ä¸šåº”ç”¨å¤šç¯å¢ƒé…ç½®


**ğŸ¢ ä¼ä¸šçº§åº”ç”¨é…ç½®**
```nginx
# ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ç»„
upstream production_app {
    server prod01.company.com:8080 weight=5 max_fails=2 fail_timeout=30s;
    server prod02.company.com:8080 weight=5 max_fails=2 fail_timeout=30s;
    server prod03.company.com:8080 weight=3 max_fails=2 fail_timeout=30s;
    
    # ç”Ÿäº§å¤‡ç”¨æœåŠ¡å™¨
    server prod-backup.company.com:8080 backup max_fails=5 fail_timeout=60s;
}

# æµ‹è¯•ç¯å¢ƒæœåŠ¡å™¨ç»„
upstream testing_app {
    server test01.company.com:8080 weight=2 max_fails=3 fail_timeout=60s;
    server test02.company.com:8080 weight=1 max_fails=3 fail_timeout=60s;
}

# å¼€å‘ç¯å¢ƒæœåŠ¡å™¨ç»„  
upstream development_app {
    server dev01.company.com:8080 weight=1 max_fails=5 fail_timeout=120s;
    # å¼€å‘ç¯å¢ƒå¯èƒ½ä¸ç¨³å®šï¼Œæ›´å®½æ¾çš„æ£€æµ‹
}

server {
    listen 80;
    server_name app.company.com;
    
    # æ ¹æ®å­åŸŸåè·¯ç”±åˆ°ä¸åŒç¯å¢ƒ
    location / {
        proxy_pass http://production_app;
        proxy_set_header Host $host;
    }
}

server {
    listen 80;
    server_name test.company.com;
    
    location / {
        proxy_pass http://testing_app;
        proxy_set_header Host $host;
    }
}
```

### 7.3 å¾®æœåŠ¡æ¶æ„é…ç½®


**ğŸ”§ å¾®æœåŠ¡é›†ç¾¤é…ç½®**
```nginx
# ç”¨æˆ·æœåŠ¡
upstream user_service {
    server user01.micro.com:8001 weight=3 max_fails=2 fail_timeout=15s;
    server user02.micro.com:8001 weight=3 max_fails=2 fail_timeout=15s;
    server user03.micro.com:8001 backup;
}

# è®¢å•æœåŠ¡
upstream order_service {
    server order01.micro.com:8002 weight=4 max_fails=1 fail_timeout=10s;
    server order02.micro.com:8002 weight=4 max_fails=1 fail_timeout=10s;
    server order03.micro.com:8002 weight=2 max_fails=1 fail_timeout=10s;
}

# æ”¯ä»˜æœåŠ¡ - é«˜å¯ç”¨é…ç½®
upstream payment_service {
    server pay01.micro.com:8003 weight=5 max_fails=1 fail_timeout=5s;
    server pay02.micro.com:8003 weight=5 max_fails=1 fail_timeout=5s;
    server pay-backup.micro.com:8003 backup max_fails=3 fail_timeout=30s;
}

server {
    listen 80;
    server_name api.micro.com;
    
    # ç”¨æˆ·ç›¸å…³API
    location /api/user/ {
        proxy_pass http://user_service;
        proxy_set_header Host $host;
    }
    
    # è®¢å•ç›¸å…³API
    location /api/order/ {
        proxy_pass http://order_service;
        proxy_set_header Host $host;
    }
    
    # æ”¯ä»˜ç›¸å…³API - å…³é”®æœåŠ¡ï¼Œç‰¹æ®Šå¤„ç†
    location /api/payment/ {
        proxy_pass http://payment_service;
        proxy_set_header Host $host;
        proxy_connect_timeout 5s;    # æ”¯ä»˜æœåŠ¡è¶…æ—¶è®¾ç½®æ›´ä¸¥æ ¼
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
}
```

### 7.4 ç°åº¦å‘å¸ƒé…ç½®


**ğŸ¯ ç°åº¦å‘å¸ƒåœºæ™¯**
```nginx
# ç°åº¦å‘å¸ƒé…ç½® - æ–°è€ç‰ˆæœ¬å…±å­˜
upstream app_gray_release {
    # ç¨³å®šç‰ˆæœ¬ - 90%æµé‡
    server stable01.app.com:8080 weight=9 max_fails=2 fail_timeout=30s;
    server stable02.app.com:8080 weight=9 max_fails=2 fail_timeout=30s;
    
    # æ–°ç‰ˆæœ¬ - 10%æµé‡ï¼Œè°¨æ…æµ‹è¯•
    server new-version.app.com:8080 weight=2 max_fails=1 fail_timeout=15s;
    
    # ç´§æ€¥å›æ»šæœåŠ¡å™¨
    server rollback.app.com:8080 backup max_fails=5 fail_timeout=60s;
}

server {
    listen 80;
    server_name app.example.com;
    
    location / {
        proxy_pass http://app_gray_release;
        proxy_set_header Host $host;
        
        # è®°å½•è®¿é—®æ—¥å¿—ï¼Œä¾¿äºåˆ†ææ–°ç‰ˆæœ¬è¡¨ç°
        access_log /var/log/nginx/gray_release.log;
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ upstreamæ¨¡å—ï¼šç»„ç»‡å’Œç®¡ç†åç«¯æœåŠ¡å™¨çš„æ ¸å¿ƒå·¥å…·
ğŸ”¸ serveræŒ‡ä»¤ï¼šå®šä¹‰å…·ä½“çš„åç«¯æœåŠ¡å™¨åœ°å€å’Œå‚æ•°
ğŸ”¸ weightæƒé‡ï¼šæ§åˆ¶è¯·æ±‚åˆ†å‘æ¯”ä¾‹çš„é‡è¦å‚æ•°
ğŸ”¸ backupæœºåˆ¶ï¼šæä¾›æ•…éšœè½¬ç§»å’Œåº”æ€¥æœåŠ¡çš„ä¿éšœ
ğŸ”¸ downæ ‡è®°ï¼šä¸´æ—¶åœç”¨æœåŠ¡å™¨çš„ç®¡ç†æ‰‹æ®µ
ğŸ”¸ max_failsæ£€æµ‹ï¼šè‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ¢å¤æœºåˆ¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ upstreamçš„æœ¬è´¨ä½œç”¨**
```
æœåŠ¡å™¨ç»„ç»‡è€…ï¼šæŠŠå¤šå°æœåŠ¡å™¨ç»„ç»‡æˆé€»è¾‘ç»„
è¯·æ±‚åˆ†å‘å™¨ï¼šæ™ºèƒ½åˆ†é…ç”¨æˆ·è¯·æ±‚åˆ°åˆé€‚çš„æœåŠ¡å™¨
æ•…éšœç®¡ç†å™¨ï¼šè‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†æœåŠ¡å™¨æ•…éšœ
è´Ÿè½½å¹³è¡¡å™¨ï¼šæ ¹æ®é…ç½®å®ç°è´Ÿè½½å‡è¡¡
```

**ğŸ”¹ æƒé‡é…ç½®çš„æ ¸å¿ƒåŸåˆ™**
```
æ€§èƒ½åŒ¹é…ï¼šæƒé‡è¦ç¬¦åˆæœåŠ¡å™¨å®é™…æ€§èƒ½
åˆç†æ¯”ä¾‹ï¼šé¿å…æƒé‡å·®è·è¿‡å¤§
åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®ç›‘æ§æ•°æ®åŠæ—¶è°ƒæ•´
ä¸šåŠ¡éœ€æ±‚ï¼šç»“åˆä¸šåŠ¡åœºæ™¯è®¾ç½®æƒé‡
```

**ğŸ”¹ æ•…éšœæ£€æµ‹çš„å¹³è¡¡è‰ºæœ¯**
```
å“åº”é€Ÿåº¦ vs ç¨³å®šæ€§ï¼š
â€¢ max_failsè®¾ç½®å° â†’ å¿«é€Ÿæ•…éšœåˆ‡æ¢ï¼Œä½†å¯èƒ½è¯¯åˆ¤
â€¢ max_failsè®¾ç½®å¤§ â†’ å‡å°‘è¯¯åˆ¤ï¼Œä½†æ•…éšœåˆ‡æ¢æ…¢

åˆç†è®¾ç½®ï¼š
â€¢ å…³é”®æœåŠ¡ï¼šmax_fails=1-2, fail_timeout=10-20s
â€¢ ä¸€èˆ¬æœåŠ¡ï¼šmax_fails=2-3, fail_timeout=20-30s
â€¢ å¤‡ç”¨æœåŠ¡ï¼šmax_fails=3-5, fail_timeout=30-60s
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é…ç½®æœ€ä½³å®è·µ**
```
åŸºç¡€é…ç½®è¦ç‚¹ï¼š
â€¢ æ˜ç¡®æŒ‡å®šç«¯å£å·ï¼Œé¿å…ä½¿ç”¨é»˜è®¤å€¼
â€¢ åˆç†è®¾ç½®æƒé‡ï¼Œè€ƒè™‘æœåŠ¡å™¨å®é™…æ€§èƒ½
â€¢ é…ç½®backupæœåŠ¡å™¨ï¼Œæä¾›æ•…éšœä¿éšœ
â€¢ è®¾ç½®åˆé€‚çš„max_failså’Œfail_timeout

ç›‘æ§å’Œç»´æŠ¤ï¼š
â€¢ å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
â€¢ ç›‘æ§è¯·æ±‚åˆ†å‘æ˜¯å¦å‡åŒ€
â€¢ å…³æ³¨æ•…éšœæ£€æµ‹æ—¥å¿—
â€¢ åŠæ—¶è°ƒæ•´é…ç½®å‚æ•°
```

**ğŸ¯ ä¸åŒåœºæ™¯çš„é…ç½®ç­–ç•¥**

| åº”ç”¨åœºæ™¯ | æƒé‡ç­–ç•¥ | æ•…éšœæ£€æµ‹ | backupé…ç½® |
|---------|---------|---------|-----------|
| **é«˜å¯ç”¨æœåŠ¡** | å‡åŒ€åˆ†é… | ä¸¥æ ¼æ£€æµ‹ | å¿…é¡»é…ç½® |
| **æ€§èƒ½ä¼˜å…ˆ** | æŒ‰æ€§èƒ½åˆ†é… | ä¸­ç­‰æ£€æµ‹ | å»ºè®®é…ç½® |
| **å¼€å‘æµ‹è¯•** | ç®€å•é…ç½® | å®½æ¾æ£€æµ‹ | å¯é€‰é…ç½® |
| **ç°åº¦å‘å¸ƒ** | æ¯”ä¾‹æ§åˆ¶ | ä¸¥æ ¼æ£€æµ‹ | ç´§æ€¥å›æ»š |

### 8.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**
```
è¯·æ±‚åˆ†å‘ä¸å‡ï¼š
â€¢ æ£€æŸ¥æƒé‡é…ç½®æ˜¯å¦åˆç†
â€¢ ç¡®è®¤æœåŠ¡å™¨æ€§èƒ½æ˜¯å¦åŒ¹é…æƒé‡
â€¢ æŸ¥çœ‹æ˜¯å¦æœ‰æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºdown

æœåŠ¡å™¨é¢‘ç¹æ•…éšœåˆ‡æ¢ï¼š
â€¢ è°ƒæ•´max_failså’Œfail_timeoutå‚æ•°
â€¢ æ£€æŸ¥ç½‘ç»œè¿æ¥ç¨³å®šæ€§
â€¢ ç¡®è®¤æœåŠ¡å™¨è´Ÿè½½æ˜¯å¦è¿‡é«˜

backupæœåŠ¡å™¨æ„å¤–å¯ç”¨ï¼š
â€¢ æ£€æŸ¥ä¸»æœåŠ¡å™¨çŠ¶æ€
â€¢ æŸ¥çœ‹é”™è¯¯æ—¥å¿—
â€¢ éªŒè¯æœåŠ¡å™¨è¿æ¥æ€§
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- upstreamæ˜¯Nginxè´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç»„ç»‡å’Œç®¡ç†åç«¯æœåŠ¡å™¨
- weightæƒé‡æ§åˆ¶è¯·æ±‚åˆ†å‘æ¯”ä¾‹ï¼Œè¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½åˆç†è®¾ç½®  
- backupæä¾›æ•…éšœä¿éšœï¼Œdownæ ‡è®°ç”¨äºç»´æŠ¤ç®¡ç†
- max_failså®ç°è‡ªåŠ¨æ•…éšœæ£€æµ‹ï¼Œå‚æ•°è®¾ç½®è¦å¹³è¡¡é€Ÿåº¦å’Œç¨³å®šæ€§
- å®é™…åº”ç”¨ä¸­è¦ç»“åˆä¸šåŠ¡éœ€æ±‚ï¼Œåˆç†é…ç½®å„é¡¹å‚æ•°