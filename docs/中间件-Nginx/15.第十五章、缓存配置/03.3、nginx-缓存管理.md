---
title: 3ã€nginx-ç¼“å­˜ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-ç¼“å­˜ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [ç¼“å­˜æ¸…ç†å·¥å…·](#2-ç¼“å­˜æ¸…ç†å·¥å…·)
3. [ç¼“å­˜é¢„çƒ­ç­–ç•¥](#3-ç¼“å­˜é¢„çƒ­ç­–ç•¥)
4. [ç¼“å­˜ç›‘æ§ä½“ç³»](#4-ç¼“å­˜ç›‘æ§ä½“ç³»)
5. [ç¼“å­˜æ€§èƒ½åˆ†æ](#5-ç¼“å­˜æ€§èƒ½åˆ†æ)
6. [ç¼“å­˜æ•…éšœå¤„ç†](#6-ç¼“å­˜æ•…éšœå¤„ç†)
7. [ç¼“å­˜ç­–ç•¥ä¼˜åŒ–](#7-ç¼“å­˜ç­–ç•¥ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç¼“å­˜ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Nginxç¼“å­˜ç®¡ç†


**ç®€å•ç†è§£**ï¼šç¼“å­˜ç®¡ç†å°±åƒæ˜¯ç®¡ç†ä¸€ä¸ªæ™ºèƒ½ä»“åº“
```
ä¼ ç»Ÿç½‘ç«™è®¿é—®ï¼š                  æœ‰ç¼“å­˜çš„ç½‘ç«™è®¿é—®ï¼š
ç”¨æˆ· â†’ æœåŠ¡å™¨ â†’ æ•°æ®åº“          ç”¨æˆ· â†’ ç¼“å­˜ä»“åº“ â†’ (å‘½ä¸­)ç›´æ¥è¿”å›
(æ¯æ¬¡éƒ½è¦å»æ•°æ®åº“å–)           (ç¬¬ä¸€æ¬¡)ç”¨æˆ· â†’ ç¼“å­˜ â†’ æœåŠ¡å™¨ â†’ æ•°æ®åº“
```

**ç¼“å­˜ç®¡ç†çš„ä½œç”¨**ï¼š
- **æå‡é€Ÿåº¦** - ç”¨æˆ·è®¿é—®æ›´å¿«ï¼Œå°±åƒä»è¿‘å¤„ä»“åº“æ‹¿è´§
- **å‡è½»å‹åŠ›** - åç«¯æœåŠ¡å™¨å‹åŠ›å°ï¼Œé¿å…"æŒ¤çˆ†"
- **èŠ‚çœèµ„æº** - å‡å°‘é‡å¤è®¡ç®—å’Œç½‘ç»œä¼ è¾“

### 1.2 ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸ


**ç¼“å­˜ä»åˆ›å»ºåˆ°æ¶ˆå¤±çš„è¿‡ç¨‹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1.åˆ›å»ºç¼“å­˜  â”‚ â†’  â”‚  2.ä½¿ç”¨ç¼“å­˜  â”‚ â†’  â”‚  3.æ›´æ–°ç¼“å­˜  â”‚ â†’  â”‚  4.æ¸…ç†ç¼“å­˜  â”‚
â”‚ (ç¬¬ä¸€æ¬¡è®¿é—®) â”‚    â”‚ (åç»­è®¿é—®)   â”‚    â”‚ (å†…å®¹å˜åŒ–)   â”‚    â”‚ (è¿‡æœŸæ¸…ç†)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¯ä¸ªé˜¶æ®µçš„ç‰¹ç‚¹**ï¼š
- **åˆ›å»º**ï¼šç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œç¼“å­˜"å­¦ä¹ "å†…å®¹
- **ä½¿ç”¨**ï¼šç¼“å­˜ç›´æ¥æä¾›æœåŠ¡ï¼Œé€Ÿåº¦æœ€å¿«
- **æ›´æ–°**ï¼šæºå†…å®¹å˜åŒ–æ—¶ï¼Œç¼“å­˜è·Ÿç€æ›´æ–°
- **æ¸…ç†**ï¼šè¿‡æœŸæˆ–ç©ºé—´ä¸è¶³æ—¶ï¼Œåˆ é™¤æ—§ç¼“å­˜

### 1.3 ç¼“å­˜ç®¡ç†çš„æ ¸å¿ƒä»»åŠ¡


**ç®¡ç†å‘˜éœ€è¦å…³å¿ƒçš„é—®é¢˜**ï¼š
- **ç©ºé—´ç®¡ç†** - ç¼“å­˜å ç”¨å¤šå°‘ç£ç›˜ç©ºé—´ï¼Ÿ
- **æ—¶æ•ˆç®¡ç†** - ç¼“å­˜ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Ÿ
- **è´¨é‡ç®¡ç†** - ç¼“å­˜å‘½ä¸­ç‡é«˜ä¸é«˜ï¼Ÿ
- **æ•…éšœç®¡ç†** - ç¼“å­˜å‡ºé—®é¢˜æ€ä¹ˆå¤„ç†ï¼Ÿ

---

## 2. ğŸ§¹ ç¼“å­˜æ¸…ç†å·¥å…·


### 2.1 è‡ªåŠ¨æ¸…ç†æœºåˆ¶


**Nginxå†…ç½®çš„æ¸…ç†æ–¹å¼**ï¼š

```nginx
# åŸºç¡€ç¼“å­˜é…ç½®
proxy_cache_path /var/cache/nginx/app
    levels=1:2                    # ç›®å½•ç»“æ„å±‚çº§
    keys_zone=app_cache:10m       # å†…å­˜åŒºåŸŸåç§°å’Œå¤§å°
    max_size=1g                   # æœ€å¤§ç£ç›˜ç©ºé—´
    inactive=60m                  # ä¸æ´»è·ƒæ—¶é—´
    use_temp_path=off;            # ç›´æ¥å†™å…¥ç¼“å­˜ç›®å½•
```

**å‚æ•°å«ä¹‰é€šä¿—è§£é‡Š**ï¼š
- `max_size=1g` - å°±åƒç»™ä»“åº“é™å®š"æœ€å¤šå­˜1GBçš„è´§"
- `inactive=60m` - "60åˆ†é’Ÿæ²¡äººè¦çš„è´§å°±æ‰”æ‰"
- `levels=1:2` - æ–‡ä»¶æŒ‰å±‚çº§å­˜æ”¾ï¼Œæ–¹ä¾¿ç®¡ç†

**è‡ªåŠ¨æ¸…ç†çš„è§¦å‘æ¡ä»¶**ï¼š
| è§¦å‘æƒ…å†µ | æ¸…ç†ç­–ç•¥ | é€šä¿—ç†è§£ |
|---------|---------|---------|
| **ç©ºé—´ä¸è¶³** | åˆ é™¤æœ€è€çš„ç¼“å­˜ | ä»“åº“æ»¡äº†ï¼Œå…ˆæ¸…ç†æœ€æ—§çš„è´§ |
| **é•¿æ—¶é—´æœªç”¨** | åˆ é™¤ä¸æ´»è·ƒç¼“å­˜ | é•¿æœŸæ²¡äººè¦çš„è´§æ¸…æ‰ |
| **ç¼“å­˜è¿‡æœŸ** | åˆ é™¤è¿‡æœŸå†…å®¹ | è¿‡äº†ä¿è´¨æœŸçš„è´§æ‰”æ‰ |

### 2.2 æ‰‹åŠ¨æ¸…ç†å·¥å…·


**å‘½ä»¤è¡Œæ¸…ç†æ–¹å¼**ï¼š

```bash
# 1. æ¸…ç†æŒ‡å®šç›®å½•çš„æ‰€æœ‰ç¼“å­˜
sudo rm -rf /var/cache/nginx/app/*

# 2. æ¸…ç†ç‰¹å®šæ—¶é—´ä¹‹å‰çš„ç¼“å­˜ï¼ˆ7å¤©å‰ï¼‰
sudo find /var/cache/nginx/app -type f -mtime +7 -delete

# 3. æ¸…ç†å¤§äºç‰¹å®šå¤§å°çš„ç¼“å­˜æ–‡ä»¶ï¼ˆå¤§äº100MBï¼‰
sudo find /var/cache/nginx/app -type f -size +100M -delete
```

**ç¬¬ä¸‰æ–¹æ¸…ç†å·¥å…·æ¨è**ï¼š

```bash
# nginx-cache-purgeæ¨¡å— - ä¸“é—¨çš„ç¼“å­˜æ¸…ç†å·¥å…·
# å®‰è£…æ–¹å¼
sudo apt-get install nginx-module-cache-purge

# ä½¿ç”¨æ–¹æ³• - é€šè¿‡URLæ¸…ç†ç‰¹å®šç¼“å­˜
curl -X PURGE http://your-domain.com/path/to/cached/file
```

### 2.3 æ‰¹é‡æ¸…ç†ç­–ç•¥


**æŒ‰å†…å®¹ç±»å‹æ¸…ç†**ï¼š

```bash
#!/bin/bash
# æ¸…ç†è„šæœ¬ç¤ºä¾‹ - cleanup_cache.sh

CACHE_DIR="/var/cache/nginx/app"

# æ¸…ç†å›¾ç‰‡ç¼“å­˜ï¼ˆè¶…è¿‡3å¤©ï¼‰
find $CACHE_DIR -name "*jpg*" -o -name "*png*" -mtime +3 -delete

# æ¸…ç†CSS/JSç¼“å­˜ï¼ˆè¶…è¿‡1å¤©ï¼‰
find $CACHE_DIR -name "*css*" -o -name "*js*" -mtime +1 -delete

# æ¸…ç†APIå“åº”ç¼“å­˜ï¼ˆè¶…è¿‡2å°æ—¶ï¼‰
find $CACHE_DIR -name "*api*" -mmin +120 -delete

echo "ç¼“å­˜æ¸…ç†å®Œæˆ"
```

**å®šæ—¶æ¸…ç†ä»»åŠ¡**ï¼š

```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†
crontab -e

# æ¯å¤©2ç‚¹æ¸…ç†è¿‡æœŸç¼“å­˜
0 2 * * * /path/to/cleanup_cache.sh

# æ¯å°æ—¶æ¸…ç†å¤§æ–‡ä»¶ç¼“å­˜
0 * * * * find /var/cache/nginx -size +500M -delete
```

---

## 3. ğŸ”¥ ç¼“å­˜é¢„çƒ­ç­–ç•¥


### 3.1 ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
```
æ²¡æœ‰é¢„çƒ­çš„æƒ…å†µï¼š
ç”¨æˆ·Aè®¿é—®é¦–é¡µ â†’ ç¼“å­˜æ²¡æœ‰ â†’ å»æœåŠ¡å™¨å– â†’ ç”¨æˆ·ç­‰3ç§’
ç”¨æˆ·Bè®¿é—®é¦–é¡µ â†’ ç¼“å­˜æœ‰äº† â†’ ç›´æ¥è¿”å› â†’ ç”¨æˆ·ç­‰0.1ç§’

æœ‰é¢„çƒ­çš„æƒ…å†µï¼š
ç®¡ç†å‘˜é¢„çƒ­ â†’ æå‰æŠŠçƒ­é—¨å†…å®¹æ”¾ç¼“å­˜ â†’ ç”¨æˆ·Aè®¿é—® â†’ ç›´æ¥è¿”å› â†’ ç”¨æˆ·ç­‰0.1ç§’
```

**é¢„çƒ­çš„å¥½å¤„**ï¼š
- âœ… **ç”¨æˆ·ä½“éªŒå¥½** - ç¬¬ä¸€ä¸ªç”¨æˆ·ä¹Ÿèƒ½äº«å—ç¼“å­˜é€Ÿåº¦
- âœ… **æœåŠ¡å™¨å‹åŠ›å°** - é¿å…çªç„¶å¤§é‡è¯·æ±‚æ‰“å®æœåŠ¡å™¨
- âœ… **å“åº”æ›´ç¨³å®š** - å‡å°‘"ç¬¬ä¸€æ¬¡æ…¢ï¼Œåç»­å¿«"çš„æƒ…å†µ

### 3.2 é¢„çƒ­æ—¶æœºé€‰æ‹©


**æœ€ä½³é¢„çƒ­æ—¶é—´ç‚¹**ï¼š

| é¢„çƒ­æ—¶æœº | é€‚ç”¨åœºæ™¯ | å…·ä½“æ“ä½œ |
|---------|---------|---------|
| **æœåŠ¡å™¨é‡å¯å** | ç¼“å­˜è¢«æ¸…ç©ºæ—¶ | ç«‹å³é¢„çƒ­æ ¸å¿ƒé¡µé¢ |
| **æ–°ç‰ˆæœ¬å‘å¸ƒå** | å†…å®¹æ›´æ–°æ—¶ | é¢„çƒ­æ›´æ–°çš„é¡µé¢ |
| **é«˜å³°æœŸå‰** | é¢„çŸ¥æµé‡é«˜å³° | æå‰1å°æ—¶é¢„çƒ­ |
| **æ·±å¤œç»´æŠ¤æ—¶** | ç”¨æˆ·è®¿é—®å°‘æ—¶ | è¶å¤œæ·±é¢„çƒ­æ˜å¤©çš„å†…å®¹ |

### 3.3 é¢„çƒ­ç­–ç•¥å®æ–½


**ç®€å•é¢„çƒ­è„šæœ¬**ï¼š

```bash
#!/bin/bash
# ç¼“å­˜é¢„çƒ­è„šæœ¬ - warmup_cache.sh

BASE_URL="https://your-website.com"

# é¢„çƒ­ä¸»è¦é¡µé¢
echo "å¼€å§‹é¢„çƒ­ç¼“å­˜..."

# é¢„çƒ­é¦–é¡µ
curl -s "$BASE_URL/" > /dev/null
echo "é¦–é¡µé¢„çƒ­å®Œæˆ"

# é¢„çƒ­çƒ­é—¨é¡µé¢åˆ—è¡¨
HOT_PAGES=(
    "/products"
    "/about"
    "/contact"
    "/api/user/profile"
)

for page in "${HOT_PAGES[@]}"
do
    curl -s "$BASE_URL$page" > /dev/null
    echo "é¢„çƒ­å®Œæˆ: $page"
    sleep 1  # é¿å…è¯·æ±‚è¿‡å¿«
done

echo "ç¼“å­˜é¢„çƒ­å…¨éƒ¨å®Œæˆï¼"
```

**æ™ºèƒ½é¢„çƒ­ç­–ç•¥**ï¼š

```bash
# åŸºäºè®¿é—®æ—¥å¿—çš„æ™ºèƒ½é¢„çƒ­
# åˆ†ææ˜¨å¤©çš„çƒ­é—¨é¡µé¢ï¼Œä»Šå¤©æå‰é¢„çƒ­

# 1. åˆ†æè®¿é—®æ—¥å¿—ï¼Œæ‰¾å‡ºçƒ­é—¨URL
awk '{print $7}' /var/log/nginx/access.log | \
    sort | uniq -c | sort -nr | head -20 > hot_urls.txt

# 2. æ‰¹é‡é¢„çƒ­è¿™äº›URL
while read count url; do
    if [ $count -gt 100 ]; then  # è®¿é—®è¶…è¿‡100æ¬¡çš„æ‰é¢„çƒ­
        curl -s "https://your-website.com$url" > /dev/null
        echo "é¢„çƒ­: $url (è®¿é—®æ¬¡æ•°: $count)"
    fi
done < hot_urls.txt
```

### 3.4 é¢„çƒ­æ•ˆæœéªŒè¯


**æ£€æŸ¥é¢„çƒ­æ˜¯å¦æˆåŠŸ**ï¼š

```bash
# æ£€æŸ¥ç¼“å­˜ç›®å½•æ–‡ä»¶æ•°é‡
echo "ç¼“å­˜æ–‡ä»¶æ•°é‡ï¼š"
find /var/cache/nginx -type f | wc -l

# æ£€æŸ¥ç¼“å­˜å ç”¨ç©ºé—´
echo "ç¼“å­˜å ç”¨ç©ºé—´ï¼š"
du -sh /var/cache/nginx

# æµ‹è¯•å“åº”æ—¶é—´å¯¹æ¯”
echo "æµ‹è¯•é¦–é¡µå“åº”æ—¶é—´ï¼š"
curl -w "å“åº”æ—¶é—´: %{time_total}ç§’\n" -s -o /dev/null https://your-website.com/
```

---

## 4. ğŸ“Š ç¼“å­˜ç›‘æ§ä½“ç³»


### 4.1 å…³é”®ç›‘æ§æŒ‡æ ‡


**æ ¸å¿ƒæŒ‡æ ‡è§£é‡Š**ï¼š

```
ç¼“å­˜å‘½ä¸­ç‡ = ä»ç¼“å­˜ç›´æ¥è¿”å›çš„è¯·æ±‚ / æ€»è¯·æ±‚æ•° Ã— 100%

ç¤ºä¾‹ç†è§£ï¼š
ä»Šå¤©æ€»å…±1000ä¸ªè¯·æ±‚
å…¶ä¸­800ä¸ªä»ç¼“å­˜ç›´æ¥è¿”å›
200ä¸ªéœ€è¦å»åç«¯æœåŠ¡å™¨å–
ç¼“å­˜å‘½ä¸­ç‡ = 800/1000 Ã— 100% = 80%
```

**é‡è¦æŒ‡æ ‡åˆ—è¡¨**ï¼š

| æŒ‡æ ‡åç§° | æ­£å¸¸èŒƒå›´ | å«ä¹‰è§£é‡Š | é—®é¢˜ä¿¡å· |
|---------|---------|---------|---------|
| **å‘½ä¸­ç‡** | `>80%` | ç¼“å­˜æˆåŠŸæœåŠ¡çš„æ¯”ä¾‹ | `<60%`éœ€è¦ä¼˜åŒ– |
| **ç¼“å­˜å¤§å°** | `<ç£ç›˜80%` | ç¼“å­˜å ç”¨çš„ç£ç›˜ç©ºé—´ | æ¥è¿‘ä¸Šé™éœ€æ¸…ç† |
| **å¹³å‡å“åº”æ—¶é—´** | `<100ms` | ç¼“å­˜è¿”å›å†…å®¹çš„é€Ÿåº¦ | `>500ms`æ€§èƒ½å·® |
| **è¿‡æœŸå¤±æ•ˆç‡** | `<20%` | ç¼“å­˜è¿‡æœŸå¤±æ•ˆçš„æ¯”ä¾‹ | å¤ªé«˜è¯´æ˜TTLè®¾ç½®ä¸å½“ |

### 4.2 ç›‘æ§é…ç½®å®æ–½


**NginxçŠ¶æ€ç›‘æ§é…ç½®**ï¼š

```nginx
# æ·»åŠ çŠ¶æ€ç›‘æ§ç«¯ç‚¹
server {
    listen 8080;
    server_name localhost;
    
    # ç¼“å­˜çŠ¶æ€ç›‘æ§
    location /nginx_status {
        stub_status on;
        access_log off;
        allow 127.0.0.1;      # åªå…è®¸æœ¬æœºè®¿é—®
        deny all;
    }
    
    # ç¼“å­˜è¯¦ç»†ä¿¡æ¯
    location /cache_status {
        proxy_cache_bypass 1;  # ç»•è¿‡ç¼“å­˜
        proxy_no_cache 1;
        # è¿”å›ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
        return 200 "Cache Status: OK\n";
        add_header Content-Type text/plain;
    }
}
```

**ç›‘æ§è„šæœ¬ç¤ºä¾‹**ï¼š

```bash
#!/bin/bash
# ç¼“å­˜ç›‘æ§è„šæœ¬ - monitor_cache.sh

LOG_FILE="/var/log/nginx/cache_monitor.log"
CACHE_DIR="/var/cache/nginx"

# è·å–å½“å‰æ—¶é—´
NOW=$(date "+%Y-%m-%d %H:%M:%S")

# ç»Ÿè®¡ç¼“å­˜æ–‡ä»¶æ•°é‡
CACHE_FILES=$(find $CACHE_DIR -type f | wc -l)

# ç»Ÿè®¡ç¼“å­˜æ€»å¤§å°
CACHE_SIZE=$(du -sh $CACHE_DIR | cut -f1)

# ç»Ÿè®¡ç£ç›˜ä½¿ç”¨ç‡
DISK_USAGE=$(df $CACHE_DIR | tail -1 | awk '{print $5}' | sed 's/%//')

# è®°å½•ç›‘æ§æ•°æ®
echo "$NOW - ç¼“å­˜æ–‡ä»¶: $CACHE_FILES, å¤§å°: $CACHE_SIZE, ç£ç›˜ä½¿ç”¨: $DISK_USAGE%" >> $LOG_FILE

# æŠ¥è­¦æ£€æŸ¥
if [ $DISK_USAGE -gt 85 ]; then
    echo "è­¦å‘Šï¼šç¼“å­˜ç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡85%ï¼" | mail -s "ç¼“å­˜ç›‘æ§è­¦å‘Š" admin@yoursite.com
fi
```

### 4.3 å¯è§†åŒ–ç›‘æ§å·¥å…·


**ç®€å•çš„Webç›‘æ§é¡µé¢**ï¼š

```bash
# ç”Ÿæˆç›‘æ§æŠ¥å‘Šé¡µé¢
cat > /var/www/html/cache_report.html << 'EOF'
<!DOCTYPE html>
<html>
<head>
    <title>Nginxç¼“å­˜ç›‘æ§</title>
    <meta http-equiv="refresh" content="30">
</head>
<body>
    <h1>ğŸ“Š ç¼“å­˜çŠ¶æ€ç›‘æ§</h1>
    <div id="stats">
        <script>
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
        fetch('/cache_status')
            .then(response => response.text())
            .then(data => {
                document.getElementById('stats').innerHTML = data;
            });
        </script>
    </div>
</body>
</html>
EOF
```

---

## 5. ğŸ“ˆ ç¼“å­˜æ€§èƒ½åˆ†æ


### 5.1 æ€§èƒ½åˆ†æç»´åº¦


**ä»å¤šä¸ªè§’åº¦åˆ†æç¼“å­˜è¡¨ç°**ï¼š

```
æ—¶é—´ç»´åº¦åˆ†æï¼š
â”œâ”€â”€ å°æ—¶çº§ - ä¸€å¤©ä¸­ä»€ä¹ˆæ—¶å€™å‘½ä¸­ç‡æœ€é«˜ï¼Ÿ
â”œâ”€â”€ å¤©çº§   - å·¥ä½œæ—¥å’Œå‘¨æœ«çš„ç¼“å­˜è¡¨ç°å¦‚ä½•ï¼Ÿ
â””â”€â”€ æœˆçº§   - é•¿æœŸè¶‹åŠ¿æ˜¯æ”¹å–„è¿˜æ˜¯æ¶åŒ–ï¼Ÿ

å†…å®¹ç»´åº¦åˆ†æï¼š
â”œâ”€â”€ æ–‡ä»¶ç±»å‹ - å›¾ç‰‡ã€CSSã€JSã€HTMLå“ªä¸ªç¼“å­˜æ•ˆæœå¥½ï¼Ÿ
â”œâ”€â”€ é¡µé¢ç±»å‹ - é¦–é¡µã€åˆ—è¡¨é¡µã€è¯¦æƒ…é¡µå“ªä¸ªéœ€è¦ä¼˜åŒ–ï¼Ÿ
â””â”€â”€ APIæ¥å£ - å“ªäº›æ¥å£é€‚åˆç¼“å­˜ï¼Œå“ªäº›ä¸é€‚åˆï¼Ÿ
```

### 5.2 æ—¥å¿—åˆ†ææ–¹æ³•


**åˆ†æNginxè®¿é—®æ—¥å¿—**ï¼š

```bash
# è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œè®°å½•ç¼“å­˜çŠ¶æ€
log_format cache_log '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent '
                    '"$http_referer" "$http_user_agent" '
                    'cache:$upstream_cache_status '
                    'rt:$request_time';

# åº”ç”¨åˆ°å…·ä½“ä½ç½®
access_log /var/log/nginx/cache_access.log cache_log;
```

**æ—¥å¿—åˆ†æè„šæœ¬**ï¼š

```bash
#!/bin/bash
# ç¼“å­˜æ€§èƒ½åˆ†æè„šæœ¬

LOG_FILE="/var/log/nginx/cache_access.log"

echo "=== ğŸ“Š ç¼“å­˜æ€§èƒ½åˆ†ææŠ¥å‘Š ==="
echo

# 1. æ€»ä½“å‘½ä¸­ç‡ç»Ÿè®¡
echo "ğŸ“‹ æ•´ä½“ç¼“å­˜å‘½ä¸­ç‡ï¼š"
awk '{
    total++
    if ($10 ~ /HIT/) hit++
    if ($10 ~ /MISS/) miss++
    if ($10 ~ /BYPASS/) bypass++
}
END {
    printf "æ€»è¯·æ±‚: %d\n", total
    printf "ç¼“å­˜å‘½ä¸­: %d (%.1f%%)\n", hit, hit/total*100
    printf "ç¼“å­˜æœªå‘½ä¸­: %d (%.1f%%)\n", miss, miss/total*100
    printf "ç¼“å­˜ç»•è¿‡: %d (%.1f%%)\n", bypass, bypass/total*100
}' $LOG_FILE

echo

# 2. æŒ‰æ–‡ä»¶ç±»å‹åˆ†æ
echo "ğŸ“ æŒ‰æ–‡ä»¶ç±»å‹å‘½ä¸­ç‡ï¼š"
awk '{
    if ($7 ~ /\.(jpg|png|gif|jpeg)$/) {
        image_total++
        if ($10 ~ /HIT/) image_hit++
    }
    else if ($7 ~ /\.(css|js)$/) {
        static_total++
        if ($10 ~ /HIT/) static_hit++
    }
    else if ($7 ~ /\.html$/ || $7 == "/") {
        html_total++
        if ($10 ~ /HIT/) html_hit++
    }
}
END {
    printf "å›¾ç‰‡æ–‡ä»¶: %.1f%% (%d/%d)\n", image_hit/image_total*100, image_hit, image_total
    printf "é™æ€èµ„æº: %.1f%% (%d/%d)\n", static_hit/static_total*100, static_hit, static_total
    printf "HTMLé¡µé¢: %.1f%% (%d/%d)\n", html_hit/html_total*100, html_hit, html_total
}' $LOG_FILE
```

### 5.3 å“åº”æ—¶é—´åˆ†æ


**åˆ†æç¼“å­˜å¯¹å“åº”æ—¶é—´çš„å½±å“**ï¼š

```bash
# å“åº”æ—¶é—´ç»Ÿè®¡è„šæœ¬
awk '{
    # æå–å“åº”æ—¶é—´ï¼ˆæœ€åä¸€ä¸ªå­—æ®µï¼‰
    rt = $NF
    gsub(/rt:/, "", rt)  # ç§»é™¤rt:å‰ç¼€
    
    if ($10 ~ /HIT/) {
        hit_times[++hit_count] = rt
        hit_total += rt
    } else if ($10 ~ /MISS/) {
        miss_times[++miss_count] = rt  
        miss_total += rt
    }
}
END {
    printf "ç¼“å­˜å‘½ä¸­å¹³å‡å“åº”æ—¶é—´: %.3fç§’\n", hit_total/hit_count
    printf "ç¼“å­˜æœªå‘½ä¸­å¹³å‡å“åº”æ—¶é—´: %.3fç§’\n", miss_total/miss_count
    printf "æ€§èƒ½æå‡å€æ•°: %.1fx\n", (miss_total/miss_count)/(hit_total/hit_count)
}' /var/log/nginx/cache_access.log
```

---

## 6. ğŸ”§ ç¼“å­˜æ•…éšœå¤„ç†


### 6.1 å¸¸è§æ•…éšœç±»å‹


**å…¸å‹ç¼“å­˜é—®é¢˜åŠç—‡çŠ¶**ï¼š

| æ•…éšœç±»å‹ | ç—‡çŠ¶è¡¨ç° | ç”¨æˆ·æ„Ÿå— | ç´§æ€¥ç¨‹åº¦ |
|---------|---------|---------|---------|
| **ç¼“å­˜å®Œå…¨å¤±æ•ˆ** | å‘½ä¸­ç‡ä¸º0% | ç½‘ç«™å˜æ…¢ | ğŸ”´ é«˜ |
| **ç¼“å­˜ç›®å½•æƒé™é”™è¯¯** | æ— æ³•å†™å…¥ç¼“å­˜ | é—´æ­‡æ€§æ…¢ | ğŸŸ¡ ä¸­ |
| **ç£ç›˜ç©ºé—´ä¸è¶³** | æ–°ç¼“å­˜æ— æ³•åˆ›å»º | æ–°é¡µé¢æ…¢ | ğŸŸ¡ ä¸­ |
| **ç¼“å­˜å†…å®¹é”™è¯¯** | è¿”å›æ—§ç‰ˆæœ¬å†…å®¹ | çœ‹åˆ°è¿‡æ—¶ä¿¡æ¯ | ğŸŸ¢ ä½ |

### 6.2 æ•…éšœè¯Šæ–­æ­¥éª¤


**ç³»ç»ŸåŒ–è¯Šæ–­æµç¨‹**ï¼š

```
ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€
â”œâ”€â”€ Nginxæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ
â”œâ”€â”€ ç¼“å­˜é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
â””â”€â”€ é”™è¯¯æ—¥å¿—æœ‰ä»€ä¹ˆä¿¡æ¯ï¼Ÿ

ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ç¼“å­˜ç›®å½•
â”œâ”€â”€ ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Ÿ
â”œâ”€â”€ æƒé™æ˜¯å¦æ­£ç¡®ï¼Ÿ
â””â”€â”€ ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Ÿ

ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶
â”œâ”€â”€ ç¼“å­˜è·¯å¾„é…ç½®å¯¹å—ï¼Ÿ
â”œâ”€â”€ ç¼“å­˜è§„åˆ™è®¾ç½®å¯¹å—ï¼Ÿ
â””â”€â”€ è¯­æ³•æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ

ç¬¬å››æ­¥ï¼šéªŒè¯ç¼“å­˜æ•ˆæœ
â”œâ”€â”€ æ‰‹åŠ¨æµ‹è¯•ç¼“å­˜å‘½ä¸­
â”œâ”€â”€ æŸ¥çœ‹å“åº”å¤´ä¿¡æ¯
â””â”€â”€ æ£€æŸ¥ç¼“å­˜æ–‡ä»¶ç”Ÿæˆ
```

**å¿«é€Ÿè¯Šæ–­å‘½ä»¤**ï¼š

```bash
#!/bin/bash
# ç¼“å­˜æ•…éšœå¿«é€Ÿè¯Šæ–­è„šæœ¬

echo "ğŸ” Nginxç¼“å­˜æ•…éšœè¯Šæ–­å¼€å§‹..."

# 1. æ£€æŸ¥NginxçŠ¶æ€
echo "1ï¸âƒ£ æ£€æŸ¥NginxæœåŠ¡çŠ¶æ€:"
systemctl is-active nginx && echo "âœ… Nginxè¿è¡Œæ­£å¸¸" || echo "âŒ NginxæœåŠ¡å¼‚å¸¸"

# 2. æ£€æŸ¥ç¼“å­˜ç›®å½•
CACHE_DIR="/var/cache/nginx"
echo "2ï¸âƒ£ æ£€æŸ¥ç¼“å­˜ç›®å½•:"
if [ -d "$CACHE_DIR" ]; then
    echo "âœ… ç¼“å­˜ç›®å½•å­˜åœ¨: $CACHE_DIR"
    ls -la "$CACHE_DIR"
else
    echo "âŒ ç¼“å­˜ç›®å½•ä¸å­˜åœ¨: $CACHE_DIR"
fi

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "3ï¸âƒ£ æ£€æŸ¥ç£ç›˜ç©ºé—´:"
df -h "$CACHE_DIR"

# 4. æ£€æŸ¥æœ€è¿‘é”™è¯¯æ—¥å¿—
echo "4ï¸âƒ£ æœ€è¿‘çš„é”™è¯¯æ—¥å¿—:"
tail -10 /var/log/nginx/error.log

# 5. æµ‹è¯•ç¼“å­˜åŠŸèƒ½
echo "5ï¸âƒ£ æµ‹è¯•ç¼“å­˜åŠŸèƒ½:"
curl -I http://localhost/ 2>/dev/null | grep -i cache || echo "æœªå‘ç°ç¼“å­˜ç›¸å…³å¤´ä¿¡æ¯"
```

### 6.3 æ•…éšœå¤„ç†æ–¹æ¡ˆ


**åˆ†ç±»å¤„ç†ç­–ç•¥**ï¼š

**ğŸ”´ ç´§æ€¥æ•…éšœ - ç¼“å­˜å®Œå…¨å¤±æ•ˆ**ï¼š
```bash
# ç«‹å³å¤„ç†æ­¥éª¤
# 1. é‡å¯NginxæœåŠ¡
sudo systemctl restart nginx

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
sudo nginx -t

# 3. å¦‚æœé…ç½®æœ‰é—®é¢˜ï¼Œæ¢å¤å¤‡ä»½é…ç½®
sudo cp /etc/nginx/nginx.conf.backup /etc/nginx/nginx.conf
sudo systemctl reload nginx

# 4. ç«‹å³é¢„çƒ­å…³é”®ç¼“å­˜
curl -s http://localhost/ > /dev/null
```

**ğŸŸ¡ ä¸€èˆ¬æ•…éšœ - æƒé™é—®é¢˜**ï¼š
```bash
# ä¿®å¤ç¼“å­˜ç›®å½•æƒé™
sudo chown -R nginx:nginx /var/cache/nginx
sudo chmod -R 755 /var/cache/nginx

# é‡æ–°å¯åŠ¨Nginx
sudo systemctl restart nginx
```

**ğŸŸ¢ è½»å¾®æ•…éšœ - å†…å®¹æ›´æ–°**ï¼š
```bash
# æ¸…ç†ç‰¹å®šç¼“å­˜å¹¶é‡æ–°ç”Ÿæˆ
sudo rm -rf /var/cache/nginx/specific_cache/*

# è§¦å‘ç¼“å­˜é‡å»º
curl -s http://localhost/updated-page > /dev/null
```

### 6.4 æ•…éšœé¢„é˜²æªæ–½


**å»ºç«‹é¢„é˜²ä½“ç³»**ï¼š

```bash
# 1. å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
#!/bin/bash
# æ¯æ—¥é…ç½®å¤‡ä»½è„šæœ¬
cp /etc/nginx/nginx.conf /backup/nginx.conf.$(date +%Y%m%d)

# 2. ç£ç›˜ç©ºé—´ç›‘æ§
# å½“ç£ç›˜ä½¿ç”¨è¶…è¿‡80%æ—¶è‡ªåŠ¨æ¸…ç†
USAGE=$(df /var/cache/nginx | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $USAGE -gt 80 ]; then
    find /var/cache/nginx -type f -mtime +7 -delete
    echo "è‡ªåŠ¨æ¸…ç†æ—§ç¼“å­˜æ–‡ä»¶"
fi

# 3. ç¼“å­˜å¥åº·æ£€æŸ¥
# æ¯å°æ—¶æ£€æŸ¥ç¼“å­˜åŠŸèƒ½
0 * * * * /usr/local/bin/cache_health_check.sh
```

---

## 7. âš¡ ç¼“å­˜ç­–ç•¥ä¼˜åŒ–


### 7.1 ç¼“å­˜ç­–ç•¥åˆ†æ


**ä¸åŒå†…å®¹çš„æœ€ä½³ç¼“å­˜ç­–ç•¥**ï¼š

```
é™æ€èµ„æºåˆ†å±‚ç¼“å­˜ç­–ç•¥ï¼š

ğŸ“¸ å›¾ç‰‡æ–‡ä»¶ (jpg, png, gif)
â”œâ”€â”€ ç¼“å­˜æ—¶é—´: 30å¤©
â”œâ”€â”€ åŸå› : å¾ˆå°‘å˜åŒ–ï¼Œæ–‡ä»¶è¾ƒå¤§
â””â”€â”€ é…ç½®: expires 30d;

ğŸ¨ æ ·å¼æ–‡ä»¶ (css, js)  
â”œâ”€â”€ ç¼“å­˜æ—¶é—´: 7å¤©
â”œâ”€â”€ åŸå› : ç‰ˆæœ¬æ›´æ–°æ—¶ä¼šå˜åŒ–
â””â”€â”€ é…ç½®: expires 7d;

ğŸ“„ HTMLé¡µé¢
â”œâ”€â”€ ç¼“å­˜æ—¶é—´: 1å°æ—¶
â”œâ”€â”€ åŸå› : å†…å®¹æ›´æ–°è¾ƒé¢‘ç¹
â””â”€â”€ é…ç½®: expires 1h;

ğŸ“Š APIæ•°æ®
â”œâ”€â”€ ç¼“å­˜æ—¶é—´: 5åˆ†é’Ÿ
â”œâ”€â”€ åŸå› : æ•°æ®å®æ—¶æ€§è¦æ±‚é«˜
â””â”€â”€ é…ç½®: expires 5m;
```

### 7.2 æ™ºèƒ½ç¼“å­˜é…ç½®


**æ ¹æ®è®¿é—®æ¨¡å¼ä¼˜åŒ–ç¼“å­˜**ï¼š

```nginx
# æ™ºèƒ½ç¼“å­˜é…ç½®ç¤ºä¾‹
server {
    listen 80;
    server_name example.com;
    
    # è®¾ç½®ç¼“å­˜åŒºåŸŸ
    proxy_cache app_cache;
    
    # å›¾ç‰‡èµ„æº - é•¿æœŸç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
        proxy_cache_valid 200 302 30d;    # æˆåŠŸå“åº”ç¼“å­˜30å¤©
        proxy_cache_valid 404 1m;         # 404ç¼“å­˜1åˆ†é’Ÿ
        add_header X-Cache-Status $upstream_cache_status;
    }
    
    # CSS/JSèµ„æº - ä¸­æœŸç¼“å­˜
    location ~* \.(css|js|woff|woff2)$ {
        proxy_cache_valid 200 7d;
        proxy_cache_valid 404 1m;
        add_header X-Cache-Status $upstream_cache_status;
    }
    
    # HTMLé¡µé¢ - çŸ­æœŸç¼“å­˜
    location ~* \.(html|htm)$ {
        proxy_cache_valid 200 1h;
        proxy_cache_valid 404 1m;
        
        # æ ¹æ®Cookieå†³å®šæ˜¯å¦ç¼“å­˜
        proxy_cache_bypass $cookie_user_session;
        proxy_no_cache $cookie_user_session;
        
        add_header X-Cache-Status $upstream_cache_status;
    }
    
    # APIæ¥å£ - å¾®ç¼“å­˜
    location /api/ {
        proxy_cache_valid 200 5m;
        proxy_cache_valid 404 30s;
        
        # æ ¹æ®è¯·æ±‚å‚æ•°ç¼“å­˜
        proxy_cache_key $scheme$request_method$host$request_uri$is_args$args;
        
        add_header X-Cache-Status $upstream_cache_status;
    }
}
```

### 7.3 åŠ¨æ€ç¼“å­˜ä¼˜åŒ–


**æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ç¼“å­˜ç­–ç•¥**ï¼š

```bash
#!/bin/bash
# ç¼“å­˜ç­–ç•¥ä¼˜åŒ–åˆ†æè„šæœ¬

echo "ğŸ” åˆ†æè®¿é—®æ¨¡å¼ä»¥ä¼˜åŒ–ç¼“å­˜ç­–ç•¥..."

# åˆ†ææœ€è¿‘24å°æ—¶çš„è®¿é—®æ—¥å¿—
LOG_FILE="/var/log/nginx/access.log"
YESTERDAY=$(date -d "yesterday" "+%d/%b/%Y")

# 1. åˆ†æå„ç±»æ–‡ä»¶çš„è®¿é—®é¢‘ç‡
echo "ğŸ“Š æ–‡ä»¶ç±»å‹è®¿é—®é¢‘ç‡åˆ†æï¼š"
grep "$YESTERDAY" $LOG_FILE | awk '{
    if ($7 ~ /\.(jpg|png|gif|jpeg)$/) images++
    else if ($7 ~ /\.(css|js)$/) static++
    else if ($7 ~ /\.(html|htm)$/ || $7 == "/") html++
    else if ($7 ~ /^\/api\//) api++
    else other++
    total++
}
END {
    printf "å›¾ç‰‡æ–‡ä»¶: %dæ¬¡ (%.1f%%)\n", images, images/total*100
    printf "é™æ€èµ„æº: %dæ¬¡ (%.1f%%)\n", static, static/total*100  
    printf "HTMLé¡µé¢: %dæ¬¡ (%.1f%%)\n", html, html/total*100
    printf "APIè¯·æ±‚: %dæ¬¡ (%.1f%%)\n", api, api/total*100
    printf "å…¶ä»–: %dæ¬¡ (%.1f%%)\n", other, other/total*100
}'

# 2. åˆ†æç¼“å­˜å‘½ä¸­ç‡
echo
echo "ğŸ¯ å„ç±»å‹ç¼“å­˜å‘½ä¸­ç‡ï¼š"
grep "$YESTERDAY" $LOG_FILE | awk '{
    file_type = "other"
    if ($7 ~ /\.(jpg|png|gif|jpeg)$/) file_type = "images"
    else if ($7 ~ /\.(css|js)$/) file_type = "static"
    else if ($7 ~ /\.(html|htm)$/ || $7 == "/") file_type = "html"
    else if ($7 ~ /^\/api\//) file_type = "api"
    
    total[file_type]++
    if ($0 ~ /cache:HIT/) hit[file_type]++
}
END {
    for (type in total) {
        printf "%s: %.1f%% (%d/%d)\n", type, hit[type]/total[type]*100, hit[type], total[type]
    }
}'

# 3. æå‡ºä¼˜åŒ–å»ºè®®
echo
echo "ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼š"
echo "- å¦‚æœå›¾ç‰‡å‘½ä¸­ç‡<90%ï¼Œå»ºè®®å¢åŠ ç¼“å­˜æ—¶é—´åˆ°60å¤©"
echo "- å¦‚æœAPIå‘½ä¸­ç‡>50%ï¼Œå¯ä»¥é€‚å½“å¢åŠ ç¼“å­˜æ—¶é—´"
echo "- å¦‚æœHTMLå‘½ä¸­ç‡<30%ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¿‡å¤šåŠ¨æ€å†…å®¹"
```

### 7.4 ç¼“å­˜æ€§èƒ½è°ƒä¼˜


**é«˜çº§ä¼˜åŒ–æŠ€å·§**ï¼š

```nginx
# é«˜æ€§èƒ½ç¼“å­˜é…ç½®
http {
    # 1. ä¼˜åŒ–ç¼“å­˜é”®è®¡ç®—
    proxy_cache_key "$scheme$request_method$host$request_uri$is_args$args";
    
    # 2. å¯ç”¨ç¼“å­˜é”ï¼Œé¿å…æƒŠç¾¤æ•ˆåº”
    proxy_cache_lock on;
    proxy_cache_lock_timeout 5s;
    proxy_cache_lock_age 10s;
    
    # 3. åå°æ›´æ–°ç¼“å­˜
    proxy_cache_background_update on;
    proxy_cache_use_stale updating error timeout;
    
    # 4. åˆ†çº§å­˜å‚¨ä¼˜åŒ–
    proxy_cache_path /fast-ssd/nginx/cache
        levels=1:2
        keys_zone=fast_cache:100m
        max_size=10g
        inactive=1d;
    
    proxy_cache_path /slow-disk/nginx/cache
        levels=1:2  
        keys_zone=slow_cache:50m
        max_size=100g
        inactive=30d;
}

server {
    # çƒ­ç‚¹å†…å®¹ç”¨å¿«é€Ÿå­˜å‚¨
    location ~* \.(css|js)$ {
        proxy_cache fast_cache;
        proxy_cache_valid 200 7d;
    }
    
    # å†·é—¨å†…å®¹ç”¨æ™®é€šå­˜å‚¨
    location ~* \.(jpg|png)$ {
        proxy_cache slow_cache;
        proxy_cache_valid 200 30d;
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ¯ ç¼“å­˜ç®¡ç†æ ¸å¿ƒç†å¿µï¼š
- ç¼“å­˜æ˜¯æå‡æ€§èƒ½çš„å·¥å…·ï¼Œä¸æ˜¯ä¸‡èƒ½è§£å†³æ–¹æ¡ˆ
- å¥½çš„ç¼“å­˜ç®¡ç†éœ€è¦å¹³è¡¡é€Ÿåº¦ã€ç©ºé—´ã€æ—¶æ•ˆæ€§
- ä¸åŒç±»å‹å†…å®¹éœ€è¦ä¸åŒçš„ç¼“å­˜ç­–ç•¥
- ç›‘æ§å’Œä¼˜åŒ–æ˜¯æŒç»­çš„è¿‡ç¨‹ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§é…ç½®
```

### 8.2 å®ç”¨æŠ€èƒ½æ¸…å•


**âœ… å¿…å¤‡æŠ€èƒ½æ£€æŸ¥è¡¨**ï¼š
- [ ] **èƒ½é…ç½®åŸºç¡€ç¼“å­˜** - è®¾ç½®ç¼“å­˜ç›®å½•å’ŒåŸºæœ¬å‚æ•°
- [ ] **ä¼šæ¸…ç†ç¼“å­˜** - æ‰‹åŠ¨å’Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸå†…å®¹
- [ ] **èƒ½é¢„çƒ­ç¼“å­˜** - åœ¨æµé‡é«˜å³°å‰æå‰å‡†å¤‡
- [ ] **ä¼šç›‘æ§ç¼“å­˜** - æŸ¥çœ‹å‘½ä¸­ç‡å’Œæ€§èƒ½æŒ‡æ ‡
- [ ] **èƒ½åˆ†æé—®é¢˜** - é€šè¿‡æ—¥å¿—åˆ†æç¼“å­˜æ•ˆæœ
- [ ] **ä¼šå¤„ç†æ•…éšœ** - å¿«é€Ÿè¯Šæ–­å’Œè§£å†³ç¼“å­˜é—®é¢˜
- [ ] **èƒ½ä¼˜åŒ–ç­–ç•¥** - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é…ç½®

### 8.3 å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥


**ğŸ”§ æ—¥å¸¸ç®¡ç†å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹ç¼“å­˜çŠ¶æ€
du -sh /var/cache/nginx/*                    # ç¼“å­˜å ç”¨ç©ºé—´
find /var/cache/nginx -type f | wc -l        # ç¼“å­˜æ–‡ä»¶æ•°é‡

# æ¸…ç†ç¼“å­˜
rm -rf /var/cache/nginx/app/*                # æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
find /var/cache/nginx -mtime +7 -delete      # æ¸…ç†7å¤©å‰ç¼“å­˜

# æµ‹è¯•ç¼“å­˜
curl -I http://localhost/                    # æŸ¥çœ‹ç¼“å­˜å¤´ä¿¡æ¯
curl -H "Cache-Control: no-cache" http://localhost/  # ç»•è¿‡ç¼“å­˜

# ç›‘æ§ç¼“å­˜
tail -f /var/log/nginx/access.log | grep HIT # å®æ—¶æŸ¥çœ‹ç¼“å­˜å‘½ä¸­
```

### 8.4 æœ€ä½³å®è·µåŸåˆ™


**ğŸŒŸ ç¼“å­˜ç®¡ç†é»„é‡‘æ³•åˆ™**ï¼š

1. **åˆç†è§„åˆ’** - æ ¹æ®å†…å®¹ç‰¹ç‚¹è®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´
2. **å®šæœŸç›‘æ§** - æ¯å¤©æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡å’Œç©ºé—´ä½¿ç”¨
3. **åŠæ—¶æ¸…ç†** - ä¸è¦è®©ç¼“å­˜ç›®å½•å æ»¡ç£ç›˜ç©ºé—´
4. **æ•…éšœé¢„æ¡ˆ** - æå‰å‡†å¤‡ç¼“å­˜å¤±æ•ˆæ—¶çš„åº”å¯¹æ–¹æ¡ˆ
5. **æŒç»­ä¼˜åŒ–** - æ ¹æ®è®¿é—®æ•°æ®ä¸æ–­è°ƒæ•´ç¼“å­˜ç­–ç•¥

### 8.5 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


**âš¡ æå‡ç¼“å­˜æ•ˆæœçš„å…³é”®ç‚¹**ï¼š
- **ç¼“å­˜å‘½ä¸­ç‡ç›®æ ‡**ï¼šé™æ€èµ„æº>95%ï¼ŒåŠ¨æ€å†…å®¹>70%
- **å“åº”æ—¶é—´ç›®æ ‡**ï¼šç¼“å­˜å‘½ä¸­<100msï¼Œæœªå‘½ä¸­<500ms
- **ç©ºé—´ç®¡ç†ç›®æ ‡**ï¼šç£ç›˜ä½¿ç”¨ç‡<80%ï¼Œä¿ç•™20%ç¼“å†²
- **æ¸…ç†ç­–ç•¥ç›®æ ‡**ï¼šè‡ªåŠ¨æ¸…ç†+å®šæœŸæ‰‹åŠ¨æ£€æŸ¥

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç¼“å­˜ç®¡ç†ä¸æ˜¯"é…å¥½å°±ä¸ç®¡"ï¼Œéœ€è¦æŒç»­å…³æ³¨
- ä¸åŒå†…å®¹éœ€è¦ä¸åŒç­–ç•¥ï¼Œæ²¡æœ‰ä¸‡èƒ½é…ç½®
- ç›‘æ§æ•°æ®æ¯”æ„Ÿè§‰æ›´é‡è¦ï¼Œè¦ç”¨æ•°æ®è¯´è¯
- æ•…éšœå¤„ç†éœ€è¦å¿«é€Ÿå“åº”ï¼Œé¢„æ¡ˆæ¯”æ•‘ç«æ›´æœ‰æ•ˆ