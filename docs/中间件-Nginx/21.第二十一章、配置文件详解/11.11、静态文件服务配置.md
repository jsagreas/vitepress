---
title: 11ã€é™æ€æ–‡ä»¶æœåŠ¡é…ç½®
---
## ğŸ“š ç›®å½•

1. [é™æ€æ–‡ä»¶æœåŠ¡åŸºç¡€æ¦‚å¿µ](#1-é™æ€æ–‡ä»¶æœåŠ¡åŸºç¡€æ¦‚å¿µ)
2. [aliasç›®å½•åˆ«åæ˜ å°„](#2-aliasç›®å½•åˆ«åæ˜ å°„)
3. [ç¼“å­˜æ§åˆ¶æœºåˆ¶](#3-ç¼“å­˜æ§åˆ¶æœºåˆ¶)
4. [ç›®å½•æµè§ˆé…ç½®](#4-ç›®å½•æµè§ˆé…ç½®)
5. [é™æ€æ–‡ä»¶å‹ç¼©ä¼˜åŒ–](#5-é™æ€æ–‡ä»¶å‹ç¼©ä¼˜åŒ–)
6. [æ–‡ä»¶ç¼“å­˜ä¸ETagé…ç½®](#6-æ–‡ä»¶ç¼“å­˜ä¸ETagé…ç½®)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ é™æ€æ–‡ä»¶æœåŠ¡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é™æ€æ–‡ä»¶æœåŠ¡


**ç®€å•ç†è§£**ï¼šé™æ€æ–‡ä»¶å°±æ˜¯é‚£äº›ä¸éœ€è¦ç¨‹åºåŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶

```
é™æ€æ–‡ä»¶ä¸¾ä¾‹ï¼š
ğŸ“· å›¾ç‰‡æ–‡ä»¶ï¼š.jpgã€.pngã€.gifã€.svg
ğŸ“„ æ ·å¼æ–‡ä»¶ï¼š.css
ğŸ”§ è„šæœ¬æ–‡ä»¶ï¼š.js
ğŸ“‹ æ–‡æ¡£æ–‡ä»¶ï¼š.pdfã€.docã€.txt
ğŸµ åª’ä½“æ–‡ä»¶ï¼š.mp4ã€.mp3

åŠ¨æ€æ–‡ä»¶å¯¹æ¯”ï¼š
âŒ ç”¨æˆ·ç™»å½•åçš„ä¸ªäººä¿¡æ¯é¡µé¢
âŒ å®æ—¶çš„è‚¡ç¥¨ä»·æ ¼æ˜¾ç¤º
âŒ è´­ç‰©è½¦å†…å®¹
âœ… ç½‘ç«™çš„logoå›¾ç‰‡
âœ… é€šç”¨çš„æ ·å¼æ–‡ä»¶
âœ… å…¬å¸ä»‹ç»çš„PDFæ–‡æ¡£
```

**Nginxçš„ä¼˜åŠ¿**ï¼šNginxç‰¹åˆ«æ“…é•¿å¤„ç†é™æ€æ–‡ä»¶ï¼Œæ¯”Apacheç­‰å…¶ä»–æœåŠ¡å™¨æ›´å¿«æ›´çœèµ„æº

### 1.2 é™æ€æ–‡ä»¶æœåŠ¡çš„å·¥ä½œæµç¨‹


```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
æµè§ˆå™¨ â†’ è¯·æ±‚ï¼šhttp://example.com/images/logo.png
   â†“
Nginx â†’ æŸ¥æ‰¾ï¼š/var/www/images/logo.png
   â†“
ç³»ç»Ÿ â†’ è¯»å–æ–‡ä»¶å†…å®¹
   â†“
Nginx â†’ è¿”å›æ–‡ä»¶ç»™æµè§ˆå™¨
   â†“
æµè§ˆå™¨ â†’ æ˜¾ç¤ºå›¾ç‰‡
```

### 1.3 åŸºæœ¬é…ç½®ç»“æ„


**æœ€ç®€å•çš„é™æ€æ–‡ä»¶é…ç½®**ï¼š
```nginx
server {
    listen 80;
    server_name example.com;
    
    # ç½‘ç«™æ ¹ç›®å½•
    root /var/www/html;
    
    # é¦–é¡µæ–‡ä»¶
    index index.html index.htm;
}
```

**é…ç½®è¯´æ˜**ï¼š
- `root`ï¼šå‘Šè¯‰Nginxå»å“ªä¸ªæ–‡ä»¶å¤¹æ‰¾æ–‡ä»¶
- `index`ï¼šå½“ç”¨æˆ·è®¿é—®ç›®å½•æ—¶ï¼Œè‡ªåŠ¨å¯»æ‰¾çš„æ–‡ä»¶å

---

## 2. ğŸ”— aliasç›®å½•åˆ«åæ˜ å°„


### 2.1 aliasçš„åŸºæœ¬æ¦‚å¿µ


**aliasçš„ä½œç”¨**ï¼šç»™æ–‡ä»¶å¤¹èµ·ä¸€ä¸ª"ç½‘å€åˆ«å"ï¼Œè®©ç”¨æˆ·é€šè¿‡ç®€å•çš„ç½‘å€è®¿é—®å¤æ‚è·¯å¾„çš„æ–‡ä»¶

```
å®é™…æƒ…å†µä¸¾ä¾‹ï¼š
çœŸå®æ–‡ä»¶ä½ç½®ï¼š/home/user/project/static/css/style.css
ç”¨æˆ·è®¿é—®ç½‘å€ï¼šhttp://example.com/assets/style.css

é€šè¿‡aliaså®ç°æ˜ å°„ï¼š
/assets/ â†’ /home/user/project/static/css/
```

### 2.2 aliasä¸rootçš„åŒºåˆ«


**rootæ–¹å¼ï¼ˆè·¯å¾„æ‹¼æ¥ï¼‰**ï¼š
```nginx
location /images/ {
    root /var/www;
}

# è®¿é—®ï¼šhttp://example.com/images/photo.jpg
# å®é™…æŸ¥æ‰¾ï¼š/var/www/images/photo.jpg
# ç‰¹ç‚¹ï¼šä¼šæŠŠlocationè·¯å¾„æ‹¼æ¥åˆ°rootè·¯å¾„åé¢
```

**aliasæ–¹å¼ï¼ˆè·¯å¾„æ›¿æ¢ï¼‰**ï¼š
```nginx
location /assets/ {
    alias /var/www/static/;
}

# è®¿é—®ï¼šhttp://example.com/assets/photo.jpg  
# å®é™…æŸ¥æ‰¾ï¼š/var/www/static/photo.jpg
# ç‰¹ç‚¹ï¼šç›´æ¥ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„
```

**é€šä¿—ç†è§£**ï¼š
- `root`åƒæ˜¯å‘Šè¯‰Nginxï¼š"åœ¨è¿™ä¸ªå¤§æ–‡ä»¶å¤¹é‡Œï¼ŒæŒ‰ç…§ç½‘å€è·¯å¾„æ‰¾æ–‡ä»¶"
- `alias`åƒæ˜¯å‘Šè¯‰Nginxï¼š"æŠŠè¿™ä¸ªç½‘å€è·¯å¾„æ¢æˆé‚£ä¸ªçœŸå®è·¯å¾„"

### 2.3 aliasé…ç½®å®ä¾‹


**åœºæ™¯1ï¼šé¡¹ç›®é™æ€èµ„æºç®¡ç†**
```nginx
server {
    listen 80;
    server_name mysite.com;
    
    # ä¸»é¡µé¢
    location / {
        root /var/www/html;
        index index.html;
    }
    
    # CSSå’ŒJSæ–‡ä»¶
    location /assets/ {
        alias /opt/project/dist/;
        expires 1y;  # ç¼“å­˜1å¹´
    }
    
    # ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
    location /uploads/ {
        alias /data/user-uploads/;
        expires 30d;  # ç¼“å­˜30å¤©
    }
}
```

**åœºæ™¯2ï¼šå¤šç‰ˆæœ¬èµ„æºç®¡ç†**
```nginx
# ä¸ºä¸åŒç‰ˆæœ¬çš„å‰ç«¯èµ„æºè®¾ç½®åˆ«å
location /v1/static/ {
    alias /var/www/static/v1.0/;
}

location /v2/static/ {
    alias /var/www/static/v2.0/;
}

location /latest/ {
    alias /var/www/static/current/;
}
```

### 2.4 aliasä½¿ç”¨æ³¨æ„äº‹é¡¹


> âš ï¸ **é‡è¦æé†’**ï¼šaliasè·¯å¾„æœ€åä¸€å®šè¦åŠ æ–œæ  `/`

```nginx
# âœ… æ­£ç¡®å†™æ³•
location /images/ {
    alias /var/www/static/;
}

# âŒ é”™è¯¯å†™æ³•
location /images/ {
    alias /var/www/static;  # ç¼ºå°‘ç»“å°¾æ–œæ 
}
```

**ä¸ºä»€ä¹ˆè¦åŠ æ–œæ **ï¼š
- ä¸åŠ æ–œæ å¯èƒ½å¯¼è‡´è·¯å¾„æ‹¼æ¥é”™è¯¯
- ä¼šå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶çš„é—®é¢˜

---

## 3. â° ç¼“å­˜æ§åˆ¶æœºåˆ¶


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜æ§åˆ¶


**é—®é¢˜åœºæ™¯**ï¼š
```
ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç«™ï¼š
ğŸŒ ä¸‹è½½logo.png (100KB)
ğŸŒ ä¸‹è½½style.css (50KB) 
ğŸŒ ä¸‹è½½script.js (200KB)
æ€»è®¡ï¼š350KBï¼Œè€—æ—¶è¾ƒé•¿

ç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®åŒæ ·çš„ç½‘ç«™ï¼š
â“ è¿˜è¦é‡æ–°ä¸‹è½½è¿™äº›æ–‡ä»¶å—ï¼Ÿ
```

**ç¼“å­˜çš„å¥½å¤„**ï¼š
- âœ… ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼ˆé¡µé¢åŠ è½½æ›´å¿«ï¼‰
- âœ… æœåŠ¡å™¨å‹åŠ›æ›´å°ï¼ˆå‡å°‘é‡å¤ä¼ è¾“ï¼‰
- âœ… èŠ‚çœå¸¦å®½æµé‡

### 3.2 expiresç¼“å­˜è¿‡æœŸæ—¶é—´


**expiresçš„ä½œç”¨**ï¼šå‘Šè¯‰æµè§ˆå™¨"è¿™ä¸ªæ–‡ä»¶å¯ä»¥ç¼“å­˜å¤šé•¿æ—¶é—´"

**åŸºæœ¬è¯­æ³•**ï¼š
```nginx
expires [æ—¶é—´] | [off] | [epoch] | [max];
```

**æ—¶é—´æ ¼å¼å¯¹ç…§è¡¨**ï¼š

| **æ—¶é—´å†™æ³•** | **å«ä¹‰** | **é€‚ç”¨åœºæ™¯** |
|-------------|---------|-------------|
| `30s` | 30ç§’ | å®æ—¶æ•°æ®ã€ä¸´æ—¶æ–‡ä»¶ |
| `10m` | 10åˆ†é’Ÿ | ç»å¸¸æ›´æ–°çš„å†…å®¹ |
| `2h` | 2å°æ—¶ | ä¸€èˆ¬é¡µé¢å†…å®¹ |
| `7d` | 7å¤© | å›¾ç‰‡ã€æ–‡æ¡£ç­‰ |
| `1M` | 1ä¸ªæœˆ | æ ·å¼è¡¨ã€è„šæœ¬æ–‡ä»¶ |
| `1y` | 1å¹´ | å¾ˆå°‘å˜åŒ–çš„èµ„æº |
| `max` | æœ€é•¿æ—¶é—´ | æ°¸è¿œä¸å˜çš„æ–‡ä»¶ |

### 3.3 ä¸åŒæ–‡ä»¶ç±»å‹çš„ç¼“å­˜ç­–ç•¥


```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    
    # HTMLæ–‡ä»¶ï¼šçŸ­æ—¶é—´ç¼“å­˜ï¼ˆå†…å®¹å¯èƒ½æ›´æ–°ï¼‰
    location ~* \.(html|htm)$ {
        expires 1h;
        add_header Cache-Control "public, must-revalidate";
    }
    
    # å›¾ç‰‡æ–‡ä»¶ï¼šé•¿æ—¶é—´ç¼“å­˜ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰
    location ~* \.(jpg|jpeg|png|gif|svg|ico)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # CSSå’ŒJSï¼šä¸­ç­‰æ—¶é—´ç¼“å­˜ï¼ˆç‰ˆæœ¬æ›´æ–°æ—¶ä¼šæ”¹æ–‡ä»¶åï¼‰
    location ~* \.(css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # å­—ä½“æ–‡ä»¶ï¼šé•¿æ—¶é—´ç¼“å­˜
    location ~* \.(woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public";
        add_header Access-Control-Allow-Origin "*";
    }
}
```

### 3.4 add_headerå“åº”å¤´æ·»åŠ 


**add_headerçš„ä½œç”¨**ï¼šç»™æœåŠ¡å™¨å›åº”æ·»åŠ é¢å¤–çš„ä¿¡æ¯å¤´

**å¸¸ç”¨çš„ç¼“å­˜æ§åˆ¶å¤´**ï¼š

```nginx
# åŸºç¡€ç¼“å­˜æ§åˆ¶
add_header Cache-Control "public, max-age=3600";

# è¯¦ç»†è¯´æ˜ï¼š
# public    - å…è®¸ä»»ä½•ç¼“å­˜å­˜å‚¨
# private   - åªå…è®¸æµè§ˆå™¨ç¼“å­˜
# no-cache  - æ¯æ¬¡éƒ½è¦éªŒè¯
# no-store  - å®Œå…¨ä¸ç¼“å­˜
# max-age   - ç¼“å­˜ç§’æ•°
# immutable - æ–‡ä»¶ä¸ä¼šæ”¹å˜
```

**å®ç”¨é…ç½®ç¤ºä¾‹**ï¼š
```nginx
location /api/ {
    # APIæ¥å£ä¸ç¼“å­˜
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
}

location /images/ {
    # å›¾ç‰‡é•¿æ—¶é—´ç¼“å­˜
    expires 1y;
    add_header Cache-Control "public, immutable";
    # æ·»åŠ è·¨åŸŸè®¿é—®æ”¯æŒ
    add_header Access-Control-Allow-Origin "*";
}
```

---

## 4. ğŸ“‚ ç›®å½•æµè§ˆé…ç½®


### 4.1 ä»€ä¹ˆæ˜¯ç›®å½•æµè§ˆ


**ç›®å½•æµè§ˆåŠŸèƒ½**ï¼šå½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªæ–‡ä»¶å¤¹ç½‘å€æ—¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶åˆ—è¡¨

```
åœºæ™¯ä¸¾ä¾‹ï¼š
ç”¨æˆ·è®¿é—®ï¼šhttp://example.com/downloads/
æ˜¾ç¤ºé¡µé¢ï¼š
ğŸ“ 2024å¹´æŠ¥å‘Š/
ğŸ“ äº§å“æ‰‹å†Œ/
ğŸ“„ ç”¨æˆ·æŒ‡å—.pdf
ğŸ“„ å®‰è£…åŒ….zip
ğŸ“„ æ›´æ–°æ—¥å¿—.txt
```

### 4.2 autoindexç›®å½•æµè§ˆå¼€å…³


**autoindexåŸºæœ¬é…ç½®**ï¼š
```nginx
location /files/ {
    alias /var/www/downloads/;
    autoindex on;        # å¼€å¯ç›®å½•æµè§ˆ
    autoindex_exact_size off;   # æ–‡ä»¶å¤§å°äººæ€§åŒ–æ˜¾ç¤º
    autoindex_localtime on;     # ä½¿ç”¨æœ¬åœ°æ—¶é—´
}
```

**é…ç½®æ•ˆæœå¯¹æ¯”**ï¼š

| **é…ç½®é¡¹** | **offæ•ˆæœ** | **onæ•ˆæœ** |
|-----------|-------------|-----------|
| `autoindex` | æ˜¾ç¤º403é”™è¯¯ | æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ |
| `autoindex_exact_size` | æ˜¾ç¤ºç¡®åˆ‡å­—èŠ‚æ•° | æ˜¾ç¤ºKB/MB/GB |
| `autoindex_localtime` | æ˜¾ç¤ºUTCæ—¶é—´ | æ˜¾ç¤ºæœ¬åœ°æ—¶é—´ |

### 4.3 autoindexè¯¦ç»†é…ç½®


**autoindex_exact_sizeæ–‡ä»¶å¤§å°æ˜¾ç¤º**ï¼š
```nginx
# æ˜¾ç¤ºç¡®åˆ‡å­—èŠ‚æ•°
autoindex_exact_size on;
# æ–‡ä»¶æ˜¾ç¤ºï¼šinstall.zip    1048576

# æ˜¾ç¤ºäººæ€§åŒ–å¤§å°
autoindex_exact_size off;
# æ–‡ä»¶æ˜¾ç¤ºï¼šinstall.zip    1.0M
```

**autoindex_localtimeæ—¶é—´æ ¼å¼**ï¼š
```nginx
# ä½¿ç”¨UTCæ—¶é—´
autoindex_localtime off;
# æ—¶é—´æ˜¾ç¤ºï¼š17-Sep-2024 06:30

# ä½¿ç”¨æœ¬åœ°æ—¶é—´  
autoindex_localtime on;
# æ—¶é—´æ˜¾ç¤ºï¼š17-Sep-2024 14:30
```

### 4.4 ç›®å½•æµè§ˆå®‰å…¨é…ç½®


**å®Œæ•´çš„æ–‡ä»¶ä¸‹è½½ç«™é…ç½®**ï¼š
```nginx
server {
    listen 80;
    server_name files.example.com;
    
    location / {
        root /var/www/public-files;
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        
        # å®‰å…¨è®¾ç½®
        location ~ /\. {
            deny all;  # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
        }
        
        # ç¦æ­¢è®¿é—®æ•æ„Ÿæ–‡ä»¶
        location ~* \.(conf|log|ini)$ {
            deny all;
        }
    }
    
    # ç§å¯†æ–‡ä»¶éœ€è¦è®¤è¯
    location /private/ {
        alias /var/www/private-files/;
        autoindex on;
        auth_basic "è¯·è¾“å…¥ç”¨æˆ·åå¯†ç ";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}
```

---

## 5. ğŸ—œï¸ é™æ€æ–‡ä»¶å‹ç¼©ä¼˜åŒ–


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ–‡ä»¶å‹ç¼©


**å‹ç¼©çš„å¥½å¤„**ï¼š
```
åŸå§‹æ–‡ä»¶å¤§å°ï¼šstyle.css (100KB)
å‹ç¼©åå¤§å°ï¼šstyle.css.gz (25KB)
èŠ‚çœæµé‡ï¼š75KB (75%)
åŠ è½½æ—¶é—´ï¼šä»2ç§’é™åˆ°0.5ç§’
```

**é€‚åˆå‹ç¼©çš„æ–‡ä»¶ç±»å‹**ï¼š
- âœ… æ–‡æœ¬æ–‡ä»¶ï¼šHTMLã€CSSã€JSã€XMLã€JSON
- âœ… å›¾æ ‡æ–‡ä»¶ï¼šSVG
- âŒ å·²å‹ç¼©æ–‡ä»¶ï¼šJPGã€PNGã€ZIPã€MP4ï¼ˆå†å‹ç¼©æ•ˆæœä¸æ˜æ˜¾ï¼‰

### 5.2 gzipå‹ç¼©é…ç½®


**åŸºç¡€gzipé…ç½®**ï¼š
```nginx
http {
    # å¼€å¯gzipå‹ç¼©
    gzip on;
    
    # å‹ç¼©çº§åˆ« (1-9ï¼Œ9æœ€é«˜ä½†æœ€è€—CPU)
    gzip_comp_level 6;
    
    # æœ€å°å‹ç¼©æ–‡ä»¶å¤§å°
    gzip_min_length 1000;
    
    # è¦å‹ç¼©çš„æ–‡ä»¶ç±»å‹
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
}
```

**å‚æ•°è¯¦è§£**ï¼š

| **å‚æ•°** | **æ¨èå€¼** | **è¯´æ˜** |
|---------|----------|---------|
| `gzip_comp_level` | 6 | å‹ç¼©çº§åˆ«ï¼Œå¹³è¡¡å‹ç¼©ç‡å’ŒCPUæ¶ˆè€— |
| `gzip_min_length` | 1000 | å°äº1KBçš„æ–‡ä»¶ä¸å‹ç¼© |
| `gzip_buffers` | 16 8k | å‹ç¼©ç¼“å†²åŒºè®¾ç½® |
| `gzip_http_version` | 1.1 | æ”¯æŒçš„HTTPç‰ˆæœ¬ |

### 5.3 é«˜çº§å‹ç¼©é…ç½®


**å®Œæ•´çš„å‹ç¼©ä¼˜åŒ–é…ç½®**ï¼š
```nginx
http {
    # gzipå‹ç¼©è®¾ç½®
    gzip on;
    gzip_vary on;                    # æ·»åŠ Vary: Accept-Encodingå¤´
    gzip_proxied any;               # ä»£ç†è¯·æ±‚ä¹Ÿå‹ç¼©
    gzip_comp_level 6;
    gzip_min_length 1000;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json
        image/svg+xml;
    
    server {
        listen 80;
        server_name example.com;
        root /var/www/html;
        
        # é™æ€æ–‡ä»¶ç¼“å­˜+å‹ç¼©
        location ~* \.(css|js)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
            gzip_static on;  # ä½¿ç”¨é¢„å‹ç¼©æ–‡ä»¶
        }
    }
}
```

**gzip_staticé¢„å‹ç¼©**ï¼š
```bash
# æ‰‹åŠ¨ç”Ÿæˆå‹ç¼©æ–‡ä»¶
gzip -k /var/www/html/style.css
# ä¼šç”Ÿæˆ style.css.gz

# Nginxä¼šä¼˜å…ˆä½¿ç”¨å·²å­˜åœ¨çš„.gzæ–‡ä»¶
```

---

## 6. ğŸ·ï¸ æ–‡ä»¶ç¼“å­˜ä¸ETagé…ç½®


### 6.1 ä»€ä¹ˆæ˜¯ETag


**ETagçš„ä½œç”¨**ï¼šç»™æ¯ä¸ªæ–‡ä»¶ä¸€ä¸ª"æŒ‡çº¹"ï¼Œæ–‡ä»¶å†…å®¹å˜åŒ–æ—¶æŒ‡çº¹ä¹Ÿä¼šå˜åŒ–

```
å·¥ä½œåŸç†ï¼š
ç¬¬ä¸€æ¬¡è®¿é—®ï¼š
æµè§ˆå™¨ â†’ è¯·æ±‚ï¼šstyle.css
æœåŠ¡å™¨ â†’ å›åº”ï¼šæ–‡ä»¶å†…å®¹ + ETag: "abc123"
æµè§ˆå™¨ â†’ ä¿å­˜æ–‡ä»¶å’ŒETagå€¼

ç¬¬äºŒæ¬¡è®¿é—®ï¼š
æµè§ˆå™¨ â†’ è¯·æ±‚ï¼šstyle.css (If-None-Match: "abc123")
æœåŠ¡å™¨ â†’ æ£€æŸ¥ï¼šæ–‡ä»¶ETagè¿˜æ˜¯"abc123"å—ï¼Ÿ
æœåŠ¡å™¨ â†’ å›åº”ï¼š304 Not Modified (æ–‡ä»¶æ²¡å˜åŒ–)
æµè§ˆå™¨ â†’ ä½¿ç”¨ç¼“å­˜çš„æ–‡ä»¶
```

### 6.2 ETagé…ç½®é€‰é¡¹


**etagæŒ‡ä»¤æ§åˆ¶**ï¼š
```nginx
http {
    # å…¨å±€å¼€å¯ETag
    etag on;
}

server {
    listen 80;
    server_name example.com;
    
    location / {
        root /var/www/html;
        etag on;   # ä¸ºè¿™ä¸ªlocationå¼€å¯ETag
    }
    
    location /api/ {
        etag off;  # APIæ¥å£å…³é—­ETagï¼ˆåŠ¨æ€å†…å®¹ï¼‰
    }
}
```

### 6.3 ETagä¸ç¼“å­˜çš„å®Œæ•´é…ç½®


**æ™ºèƒ½ç¼“å­˜ç­–ç•¥**ï¼š
```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    
    # HTMLæ–‡ä»¶ï¼šçŸ­ç¼“å­˜+ETagéªŒè¯
    location ~* \.(html|htm)$ {
        expires 1h;
        etag on;
        add_header Cache-Control "public, must-revalidate";
    }
    
    # é™æ€èµ„æºï¼šé•¿ç¼“å­˜+ETag
    location ~* \.(css|js|jpg|png|gif)$ {
        expires 1y;
        etag on;
        add_header Cache-Control "public";
    }
    
    # ç»å¸¸å˜åŒ–çš„æ–‡ä»¶ï¼šåªç”¨ETagä¸è®¾expires
    location /data/ {
        etag on;
        add_header Cache-Control "no-cache";
    }
}
```

### 6.4 ç¼“å­˜éªŒè¯æµç¨‹å›¾


```
ç¼“å­˜éªŒè¯å®Œæ•´æµç¨‹ï¼š

æµè§ˆå™¨ç¼“å­˜æ£€æŸ¥
    â†“
æœ‰ç¼“å­˜ä¸”æœªè¿‡æœŸï¼Ÿ
    â†“ æ˜¯              â†“ å¦
ç›´æ¥ä½¿ç”¨ç¼“å­˜     å‘é€æ¡ä»¶è¯·æ±‚
    â†“              (If-None-Match: ETag)
æ˜¾ç¤ºé¡µé¢              â†“
                 æœåŠ¡å™¨æ£€æŸ¥ETag
                     â†“
                æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹ï¼Ÿ
                 â†“ å¦        â†“ æ˜¯
            è¿”å›304      è¿”å›æ–°æ–‡ä»¶
            (ä¸ä¼ è¾“æ–‡ä»¶)   (ä¼ è¾“å®Œæ•´å†…å®¹)
                â†“            â†“
            ä½¿ç”¨æ—§ç¼“å­˜    æ›´æ–°ç¼“å­˜
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é™æ€æ–‡ä»¶æœåŠ¡ï¼šNginxæ“…é•¿å¤„ç†ä¸éœ€è¦åŠ¨æ€ç”Ÿæˆçš„æ–‡ä»¶
ğŸ”¸ aliasæ˜ å°„ï¼šç»™å¤æ‚çš„æ–‡ä»¶è·¯å¾„èµ·ç®€å•çš„ç½‘å€åˆ«å
ğŸ”¸ ç¼“å­˜æ§åˆ¶ï¼šé€šè¿‡expireså’Œadd_headerè®©æ–‡ä»¶åœ¨æµè§ˆå™¨ç¼“å­˜
ğŸ”¸ ç›®å½•æµè§ˆï¼šautoindexè®©ç”¨æˆ·èƒ½æµè§ˆæ–‡ä»¶å¤¹å†…å®¹
ğŸ”¸ æ–‡ä»¶å‹ç¼©ï¼šgzipå‡å°ä¼ è¾“æ–‡ä»¶å¤§å°ï¼Œæå‡åŠ è½½é€Ÿåº¦
ğŸ”¸ ETagéªŒè¯ï¼šç»™æ–‡ä»¶åŠ "æŒ‡çº¹"ï¼Œæ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°ä¸‹è½½
```

### 7.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ aliasä½¿ç”¨åŸåˆ™**ï¼š
```
è®°å¿†è¦ç‚¹ï¼š
- aliasè·¯å¾„æœ€åå¿…é¡»åŠ æ–œæ  /
- aliasæ˜¯è·¯å¾„æ›¿æ¢ï¼Œrootæ˜¯è·¯å¾„æ‹¼æ¥
- é€‚åˆç”¨äºé¡¹ç›®èµ„æºçš„çµæ´»æ˜ å°„
```

**ğŸ”¹ ç¼“å­˜æ—¶é—´è®¾ç½®ç­–ç•¥**ï¼š
```
æ–‡ä»¶ç±»å‹ç¼“å­˜å»ºè®®ï¼š
- HTMLæ–‡ä»¶ï¼š1å°æ—¶-1å¤©ï¼ˆå†…å®¹å¯èƒ½æ›´æ–°ï¼‰
- å›¾ç‰‡æ–‡ä»¶ï¼š30å¤©-1å¹´ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰
- CSS/JSæ–‡ä»¶ï¼š1å¹´ï¼ˆç‰ˆæœ¬æ§åˆ¶é€šè¿‡æ–‡ä»¶åï¼‰
- APIå“åº”ï¼šä¸ç¼“å­˜æˆ–å¾ˆçŸ­æ—¶é—´
```

**ğŸ”¹ å‹ç¼©é…ç½®è¦ç‚¹**ï¼š
```
æœ€ä½³å®è·µï¼š
- å‹ç¼©çº§åˆ«6ï¼ˆå¹³è¡¡æ•ˆæœå’Œæ€§èƒ½ï¼‰
- åªå‹ç¼©å¤§äº1KBçš„æ–‡ä»¶
- æ–‡æœ¬ç±»æ–‡ä»¶å‹ç¼©æ•ˆæœæœ€å¥½
- å·²å‹ç¼©æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€è§†é¢‘ï¼‰ä¸å†å‹ç¼©
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ç½‘ç«™æ€§èƒ½ä¼˜åŒ–**ï¼š
- **æ–‡ä»¶ç¼“å­˜**ï¼šå‡å°‘é‡å¤ä¸‹è½½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- **gzipå‹ç¼©**ï¼šèŠ‚çœ75%ä¼ è¾“æµé‡ï¼ŒåŠ å¿«åŠ è½½é€Ÿåº¦
- **æ™ºèƒ½è·¯å¾„**ï¼šaliasè®©èµ„æºç®¡ç†æ›´çµæ´»

**è¿ç»´ç®¡ç†**ï¼š
- **ç›®å½•æµè§ˆ**ï¼šæ–¹ä¾¿æ–‡ä»¶ä¸‹è½½å’Œç®¡ç†
- **ETagéªŒè¯**ï¼šç²¾ç¡®æ§åˆ¶ç¼“å­˜æ›´æ–°
- **å®‰å…¨é…ç½®**ï¼šä¿æŠ¤æ•æ„Ÿæ–‡ä»¶ä¸è¢«è®¿é—®

**é¡¹ç›®å¼€å‘**ï¼š
- **é™æ€èµ„æºåˆ†ç¦»**ï¼šå‰åç«¯åˆ†ç¦»éƒ¨ç½²
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé€šè¿‡aliasæ”¯æŒå¤šç‰ˆæœ¬å…±å­˜
- **CDNå‹å¥½**ï¼šåˆç†çš„ç¼“å­˜ç­–ç•¥ä¾¿äºCDNåŠ é€Ÿ

### 7.4 é…ç½®æ¨¡æ¿


**é€šç”¨é™æ€ç«™ç‚¹é…ç½®**ï¼š
```nginx
server {
    listen 80;
    server_name example.com;
    root /var/www/html;
    index index.html;
    
    # gzipå‹ç¼©
    gzip on;
    gzip_types text/css text/javascript application/javascript image/svg+xml;
    
    # HTMLæ–‡ä»¶
    location ~* \.(html|htm)$ {
        expires 1h;
        etag on;
    }
    
    # é™æ€èµ„æº
    location ~* \.(css|js|jpg|png|gif|svg|ico|woff|woff2)$ {
        expires 1y;
        etag on;
        add_header Cache-Control "public, immutable";
    }
    
    # ä¸‹è½½æ–‡ä»¶å¤¹
    location /downloads/ {
        alias /var/www/downloads/;
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
    }
}
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é™æ€æ–‡ä»¶Nginxæœ€æ‹¿æ‰‹ï¼Œç¼“å­˜å‹ç¼©æ ·æ ·æœ‰
- aliasåˆ«åè·¯å¾„è¦æ›¿æ¢ï¼Œç»“å°¾æ–œæ åˆ«å¿˜åŠ 
- expiresæ§åˆ¶ç¼“å­˜æ—¶é—´ï¼ŒETagéªŒè¯æ›´æ™ºèƒ½
- gzipå‹ç¼©çœæµé‡ï¼Œautoindexæµè§ˆç›®å½•æ–¹ä¾¿