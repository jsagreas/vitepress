---
title: 3ã€nginx-å®¹å™¨åŒ–éƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–éƒ¨ç½²](#1-ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–éƒ¨ç½²)
2. [Dockeréƒ¨ç½²Nginx](#2-Dockeréƒ¨ç½²Nginx)
3. [Kubernetesé›†æˆ](#3-Kubernetesé›†æˆ)
4. [é…ç½®çƒ­æ›´æ–°](#4-é…ç½®çƒ­æ›´æ–°)
5. [æœåŠ¡å‘ç°æœºåˆ¶](#5-æœåŠ¡å‘ç°æœºåˆ¶)
6. [å¼¹æ€§ä¼¸ç¼©å®ç°](#6-å¼¹æ€§ä¼¸ç¼©å®ç°)
7. [äº‘åŸç”Ÿæ¶æ„å®è·µ](#7-äº‘åŸç”Ÿæ¶æ„å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ ä»€ä¹ˆæ˜¯å®¹å™¨åŒ–éƒ¨ç½²


### 1.1 å®¹å™¨åŒ–çš„æœ¬è´¨


**ğŸ”¸ ç®€å•ç†è§£å®¹å™¨åŒ–**
```
ä¼ ç»Ÿéƒ¨ç½²ï¼šå°±åƒåœ¨æˆ¿å­é‡Œç›´æ¥å®‰è£…è½¯ä»¶
- æ¯ä¸ªè½¯ä»¶éƒ½è¦é€‚åº”æˆ¿å­çš„ç¯å¢ƒ
- è½¯ä»¶ä¹‹é—´å¯èƒ½äº’ç›¸å½±å“
- æ¬å®¶æ—¶éœ€è¦é‡æ–°å®‰è£…é…ç½®

å®¹å™¨åŒ–éƒ¨ç½²ï¼šå°±åƒæŠŠè½¯ä»¶è£…åœ¨ä¾¿æºå¼æˆ¿è½¦é‡Œ
- æˆ¿è½¦é‡Œæœ‰è½¯ä»¶è¿è¡Œçš„å®Œæ•´ç¯å¢ƒ
- ä¸åŒæˆ¿è½¦äº’ä¸å¹²æ‰°
- å¯ä»¥éšæ—¶å¼€åˆ°ä»»ä½•åœ°æ–¹è¿è¡Œ
```

**ğŸ’¡ å®¹å™¨åŒ–çš„æ ¸å¿ƒä»·å€¼**
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ç›¸åŒ
- **å¿«é€Ÿéƒ¨ç½²**ï¼šå‡ ç§’é’Ÿå°±èƒ½å¯åŠ¨ä¸€ä¸ªæœåŠ¡
- **èµ„æºéš”ç¦»**ï¼šæ¯ä¸ªå®¹å™¨ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å½±å“
- **æ˜“äºæ‰©å±•**ï¼šéœ€è¦æ›´å¤šæœåŠ¡æ—¶ï¼Œå¤åˆ¶å®¹å™¨å³å¯

### 1.2 ä¸ºä»€ä¹ˆNginxéœ€è¦å®¹å™¨åŒ–


**ğŸ¯ ä¼ ç»Ÿéƒ¨ç½²çš„ç—›ç‚¹**
```
ç¯å¢ƒé…ç½®å¤æ‚ï¼š
- ä¸åŒæœåŠ¡å™¨ç¯å¢ƒä¸ä¸€è‡´
- ä¾èµ–åº“ç‰ˆæœ¬å†²çª
- é…ç½®æ–‡ä»¶ç®¡ç†å›°éš¾

è¿ç»´æˆæœ¬é«˜ï¼š
- æ‰‹å·¥éƒ¨ç½²å®¹æ˜“å‡ºé”™
- æ‰©å®¹ç¼©å®¹æ“ä½œç¹ç
- ç›‘æ§ç®¡ç†åˆ†æ•£

ä¸šåŠ¡è¿­ä»£æ…¢ï¼š
- éƒ¨ç½²æµç¨‹é•¿
- å›æ»šå›°éš¾
- ç¯å¢ƒå‡†å¤‡æ—¶é—´é•¿
```

**âœ… å®¹å™¨åŒ–çš„ä¼˜åŠ¿**
- **æ ‡å‡†åŒ–éƒ¨ç½²**ï¼šä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œ
- **å¿«é€Ÿæ‰©å®¹**ï¼šæ ¹æ®æµé‡è‡ªåŠ¨å¢å‡å®ä¾‹
- **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€çš„é…ç½®ä¸­å¿ƒ
- **ç›‘æ§ç»Ÿä¸€**ï¼šé›†ä¸­çš„æ—¥å¿—å’Œç›‘æ§

---

## 2. ğŸš€ Dockeréƒ¨ç½²Nginx


### 2.1 åŸºç¡€Dockeréƒ¨ç½²


**ğŸ”¸ æœ€ç®€å•çš„Nginxå®¹å™¨**
```bash
# æ‹‰å–å®˜æ–¹Nginxé•œåƒ
docker pull nginx:latest

# å¯åŠ¨Nginxå®¹å™¨
docker run -d \
  --name my-nginx \
  -p 80:80 \
  nginx:latest
```

> ğŸ’¡ **è§£é‡Š**ï¼šè¿™å°±åƒä»å•†åº—ä¹°äº†ä¸ªç°æˆçš„Nginx"ç›’é¥­"ï¼Œæ‰“å¼€å°±èƒ½ç”¨

**ğŸ”§ å¸¦è‡ªå®šä¹‰é…ç½®çš„éƒ¨ç½²**
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•
mkdir -p ./nginx/conf ./nginx/html ./nginx/logs

# å¯åŠ¨å¸¦æŒ‚è½½çš„å®¹å™¨
docker run -d \
  --name nginx-custom \
  -p 80:80 \
  -v ./nginx/conf/nginx.conf:/etc/nginx/nginx.conf \
  -v ./nginx/html:/usr/share/nginx/html \
  -v ./nginx/logs:/var/log/nginx \
  nginx:latest
```

### 2.2 è‡ªå®šä¹‰Nginxé•œåƒ


**ğŸ“¦ Dockerfileç¤ºä¾‹**
```dockerfile
# åŸºäºå®˜æ–¹nginxé•œåƒ
FROM nginx:alpine

# ç»´æŠ¤è€…ä¿¡æ¯
LABEL maintainer="your-email@example.com"

# å¤åˆ¶è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
COPY nginx.conf /etc/nginx/nginx.conf
COPY default.conf /etc/nginx/conf.d/default.conf

# å¤åˆ¶é™æ€æ–‡ä»¶
COPY ./html /usr/share/nginx/html

# æš´éœ²ç«¯å£
EXPOSE 80 443

# å¯åŠ¨nginxï¼ˆå‰å°è¿è¡Œï¼‰
CMD ["nginx", "-g", "daemon off;"]
```

**ğŸ—ï¸ æ„å»ºå’Œè¿è¡Œ**
```bash
# æ„å»ºé•œåƒ
docker build -t my-nginx:v1.0 .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name production-nginx \
  -p 80:80 \
  -p 443:443 \
  my-nginx:v1.0
```

### 2.3 Docker Composeéƒ¨ç½²


**ğŸ“‹ docker-compose.ymlé…ç½®**
```yaml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    container_name: nginx-server
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/conf/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/conf.d:/etc/nginx/conf.d
      - ./nginx/html:/usr/share/nginx/html
      - ./nginx/logs:/var/log/nginx
      - ./nginx/ssl:/etc/nginx/ssl
    environment:
      - TZ=Asia/Shanghai
    restart: unless-stopped
    networks:
      - nginx-network

  # åç«¯åº”ç”¨ç¤ºä¾‹
  app:
    image: node:alpine
    container_name: backend-app
    expose:
      - "3000"
    networks:
      - nginx-network

networks:
  nginx-network:
    driver: bridge
```

**ğŸš€ å¯åŠ¨æœåŠ¡æ ˆ**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down
```

---

## 3. â˜¸ï¸ Kubernetesé›†æˆ


### 3.1 KubernetesåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ K8sæ ¸å¿ƒæ¦‚å¿µç®€è§£**
```
Podï¼š       æœ€å°éƒ¨ç½²å•å…ƒï¼Œé‡Œé¢è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨
Deploymentï¼šç®¡ç†Podçš„å‰¯æœ¬æ•°é‡å’Œæ›´æ–°ç­–ç•¥  
Serviceï¼š   ä¸ºPodæä¾›ç¨³å®šçš„ç½‘ç»œè®¿é—®å…¥å£
ConfigMapï¼š å­˜å‚¨é…ç½®æ–‡ä»¶
Secretï¼š    å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€è¯ä¹¦ç­‰ï¼‰
Ingressï¼š   é›†ç¾¤å…¥å£ï¼Œç®¡ç†å¤–éƒ¨è®¿é—®
```

> ğŸ’¡ **ç±»æ¯”ç†è§£**ï¼šK8så°±åƒä¸€ä¸ªæ™ºèƒ½çš„é›†è£…ç®±ç å¤´ï¼Œè‡ªåŠ¨ç®¡ç†æ‰€æœ‰é›†è£…ç®±ï¼ˆå®¹å™¨ï¼‰çš„è°ƒåº¦å’Œè¿è¡Œ

### 3.2 Nginxåœ¨K8sä¸­çš„éƒ¨ç½²


**ğŸ“¦ åŸºç¡€Deploymenté…ç½®**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3  # è¿è¡Œ3ä¸ªå‰¯æœ¬
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        ports:
        - containerPort: 80
        resources:
          limits:
            memory: "256Mi"
            cpu: "200m"
          requests:
            memory: "128Mi"
            cpu: "100m"
```

**ğŸŒ Serviceæš´éœ²æœåŠ¡**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: LoadBalancer  # æˆ– ClusterIPã€NodePort
```

### 3.3 ConfigMapç®¡ç†é…ç½®


**ğŸ“„ nginx-configmap.yaml**
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  nginx.conf: |
    events {
        worker_connections 1024;
    }
    http {
        upstream backend {
            server app-service:3000;
        }
        
        server {
            listen 80;
            location / {
                proxy_pass http://backend;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
            }
        }
    }
```

**ğŸ”§ åœ¨Deploymentä¸­ä½¿ç”¨ConfigMap**
```yaml
spec:
  template:
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        volumeMounts:
        - name: nginx-config
          mountPath: /etc/nginx/nginx.conf
          subPath: nginx.conf
      volumes:
      - name: nginx-config
        configMap:
          name: nginx-config
```

---

## 4. ğŸ”„ é…ç½®çƒ­æ›´æ–°


### 4.1 ä»€ä¹ˆæ˜¯çƒ­æ›´æ–°


**ğŸ”¸ çƒ­æ›´æ–°çš„å«ä¹‰**
```
å†·æ›´æ–°ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š
ä¿®æ”¹é…ç½® â†’ é‡å¯æœåŠ¡ â†’ æœåŠ¡ä¸­æ–­ â†’ æ¢å¤æœåŠ¡

çƒ­æ›´æ–°ï¼ˆç°ä»£æ–¹å¼ï¼‰ï¼š
ä¿®æ”¹é…ç½® â†’ é‡æ–°åŠ è½½ â†’ æœåŠ¡ä¸ä¸­æ–­ â†’ é…ç½®ç”Ÿæ•ˆ
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒæ¢è½®èƒï¼Œå†·æ›´æ–°æ˜¯æŠŠè½¦åœä¸‹æ¥æ¢ï¼Œçƒ­æ›´æ–°æ˜¯åœ¨è¡Œé©¶ä¸­æ¢è½®èƒ

### 4.2 Dockerç¯å¢ƒä¸‹çš„çƒ­æ›´æ–°


**ğŸ”§ é…ç½®æ–‡ä»¶çƒ­æ›´æ–°**
```bash
# ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œé‡æ–°åŠ è½½nginxé…ç½®
docker exec nginx-container nginx -s reload

# æˆ–è€…å‘é€ä¿¡å·
docker kill -s HUP nginx-container
```

**ğŸ“¦ å®Œæ•´çƒ­æ›´æ–°è„šæœ¬**
```bash
#!/bin/bash
# nginx-hot-reload.sh

CONTAINER_NAME="nginx-server"
CONFIG_PATH="./nginx/conf/nginx.conf"

echo "æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•..."
docker exec $CONTAINER_NAME nginx -t

if [ $? -eq 0 ]; then
    echo "é…ç½®è¯­æ³•æ­£ç¡®ï¼Œå¼€å§‹çƒ­é‡è½½..."
    docker exec $CONTAINER_NAME nginx -s reload
    echo "çƒ­é‡è½½å®Œæˆï¼"
else
    echo "é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•"
    exit 1
fi
```

### 4.3 Kubernetesç¯å¢ƒä¸‹çš„çƒ­æ›´æ–°


**ğŸ”„ ä½¿ç”¨ConfigMapçƒ­æ›´æ–°**
```bash
# æ›´æ–°ConfigMap
kubectl apply -f nginx-configmap.yaml

# é‡å¯Podä»¥åº”ç”¨æ–°é…ç½®ï¼ˆK8s 1.15+æ”¯æŒè‡ªåŠ¨é‡è½½ï¼‰
kubectl rollout restart deployment/nginx-deployment
```

**âš¡ é›¶åœæœºæ›´æ–°ç­–ç•¥**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 0      # ç¡®ä¿å§‹ç»ˆæœ‰Podåœ¨è¿è¡Œ
      maxSurge: 1           # æœ€å¤šå¤šåˆ›å»º1ä¸ªPod
  template:
    metadata:
      annotations:
        # é…ç½®å˜æ›´æ—¶è‡ªåŠ¨é‡å¯
        config-hash: "{{ .Values.configHash }}"
```

---

## 5. ğŸ” æœåŠ¡å‘ç°æœºåˆ¶


### 5.1 æœåŠ¡å‘ç°çš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°**
```
é—®é¢˜ï¼šå®¹å™¨ç¯å¢ƒä¸­ï¼ŒæœåŠ¡çš„IPåœ°å€ç»å¸¸å˜åŒ–
     app1åœ¨192.168.1.10:3000
     é‡å¯åå˜æˆ192.168.1.15:3000

è§£å†³ï¼šé€šè¿‡æœåŠ¡åè®¿é—®ï¼Œè‡ªåŠ¨æ‰¾åˆ°æ­£ç¡®çš„IP
     http://app-service â†’ è‡ªåŠ¨æŒ‡å‘å½“å‰æ­£ç¡®çš„IP
```

> ğŸ’¡ **ç±»æ¯”**ï¼šå°±åƒç”µè¯ç°¿ï¼Œä½ è®°ä½æœ‹å‹çš„åå­—ï¼Œç”µè¯ç°¿å¸®ä½ æ‰¾åˆ°ä»–å½“å‰çš„ç”µè¯å·ç 

### 5.2 Dockerç¯å¢ƒçš„æœåŠ¡å‘ç°


**ğŸŒ Dockerç½‘ç»œæœåŠ¡å‘ç°**
```yaml
# docker-compose.yml
version: '3.8'
services:
  nginx:
    image: nginx:alpine
    depends_on:
      - app1
      - app2
    
  app1:
    image: myapp:latest
    
  app2:
    image: myapp:latest
```

**ğŸ“‹ Nginxé…ç½®ä½¿ç”¨æœåŠ¡å**
```nginx
upstream backend {
    # ç›´æ¥ä½¿ç”¨docker-composeä¸­çš„æœåŠ¡å
    server app1:3000;
    server app2:3000;
}

server {
    listen 80;
    location / {
        proxy_pass http://backend;
    }
}
```

### 5.3 KubernetesæœåŠ¡å‘ç°


**ğŸ”§ K8så†…ç½®DNSæœåŠ¡å‘ç°**
```yaml
# åç«¯æœåŠ¡å®šä¹‰
apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: default
spec:
  selector:
    app: backend
  ports:
  - port: 3000
    targetPort: 3000
```

**ğŸ“‹ Nginxé…ç½®è®¿é—®æœåŠ¡**
```nginx
upstream backend {
    # ä½¿ç”¨K8sæœåŠ¡å.å‘½åç©ºé—´.svc.cluster.local
    server backend-service.default.svc.cluster.local:3000;
    
    # åŒå‘½åç©ºé—´å¯ä»¥ç®€å†™
    server backend-service:3000;
}
```

### 5.4 å¤–éƒ¨æœåŠ¡å‘ç°


**ğŸ”— é›†æˆå¤–éƒ¨æœåŠ¡å‘ç°ç³»ç»Ÿ**

| æœåŠ¡å‘ç°ç³»ç»Ÿ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|-------------|---------|-------------|
| **Consul** | åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒå¥åº·æ£€æŸ¥ | æ··åˆäº‘ç¯å¢ƒ |
| **Etcd** | è½»é‡çº§ï¼ŒK8sé»˜è®¤ä½¿ç”¨ | äº‘åŸç”Ÿåº”ç”¨ |
| **Zookeeper** | æˆç†Ÿç¨³å®šï¼ŒJavaç”Ÿæ€ | ä¼ ç»Ÿä¼ä¸šåº”ç”¨ |
| **Eureka** | Springç”Ÿæ€ï¼Œæ˜“é›†æˆ | å¾®æœåŠ¡æ¶æ„ |

---

## 6. ğŸ“ˆ å¼¹æ€§ä¼¸ç¼©å®ç°


### 6.1 å¼¹æ€§ä¼¸ç¼©çš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¼¹æ€§ä¼¸ç¼©**
```
æ‰‹åŠ¨ä¼¸ç¼©ï¼š
æµé‡é«˜å³° â†’ è¿ç»´äººå‘˜æ‰‹åŠ¨åŠ æœºå™¨ â†’ æµé‡ä¸‹é™ â†’ æ‰‹åŠ¨å‡æœºå™¨

è‡ªåŠ¨ä¼¸ç¼©ï¼š
æµé‡é«˜å³° â†’ ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ â†’ è‡ªåŠ¨å¢åŠ å®¹å™¨ â†’ æµé‡ä¸‹é™ â†’ è‡ªåŠ¨å‡å°‘å®¹å™¨
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒå•†åœºçš„æ‰¶æ¢¯ï¼Œäººå¤šæ—¶è‡ªåŠ¨åŠ å¿«é€Ÿåº¦ï¼Œäººå°‘æ—¶è‡ªåŠ¨å‡æ…¢ï¼Œå®Œå…¨è‡ªåŠ¨åŒ–

### 6.2 Dockerç¯å¢ƒçš„æ‰‹åŠ¨ä¼¸ç¼©


**ğŸ”§ Docker Swarmä¼¸ç¼©**
```bash
# åˆå§‹åŒ–Swarmé›†ç¾¤
docker swarm init

# åˆ›å»ºæœåŠ¡ï¼ˆ3ä¸ªå‰¯æœ¬ï¼‰
docker service create \
  --name nginx-service \
  --replicas 3 \
  -p 80:80 \
  nginx:alpine

# æ‰©å®¹åˆ°5ä¸ªå‰¯æœ¬
docker service scale nginx-service=5

# ç¼©å®¹åˆ°2ä¸ªå‰¯æœ¬
docker service scale nginx-service=2
```

### 6.3 Kubernetesè‡ªåŠ¨ä¼¸ç¼©


**ğŸ“Š HPAï¼ˆæ°´å¹³Podè‡ªåŠ¨ä¼¸ç¼©ï¼‰é…ç½®**
```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: nginx-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: nginx-deployment
  minReplicas: 2      # æœ€å°‘2ä¸ªPod
  maxReplicas: 10     # æœ€å¤š10ä¸ªPod
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70  # CPUè¶…è¿‡70%æ—¶æ‰©å®¹
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80  # å†…å­˜è¶…è¿‡80%æ—¶æ‰©å®¹
```

**ğŸ¯ æ‰©ç¼©å®¹ç­–ç•¥è¯¦è§£**
```yaml
behavior:
  scaleUp:
    stabilizationWindowSeconds: 60    # æ‰©å®¹å‰ç­‰å¾…60ç§’
    policies:
    - type: Percent
      value: 100                      # æ¯æ¬¡æœ€å¤šæ‰©å®¹100%ï¼ˆç¿»å€ï¼‰
      periodSeconds: 60
  scaleDown:
    stabilizationWindowSeconds: 300   # ç¼©å®¹å‰ç­‰å¾…5åˆ†é’Ÿ
    policies:
    - type: Percent
      value: 10                       # æ¯æ¬¡æœ€å¤šç¼©å®¹10%
      periodSeconds: 60
```

### 6.4 VPAï¼ˆå‚ç›´Podè‡ªåŠ¨ä¼¸ç¼©ï¼‰


**ğŸ“Š èµ„æºè‡ªåŠ¨è°ƒæ•´**
```yaml
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: nginx-vpa
spec:
  targetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: nginx-deployment
  updatePolicy:
    updateMode: "Auto"    # è‡ªåŠ¨æ›´æ–°èµ„æºé™åˆ¶
  resourcePolicy:
    containerPolicies:
    - containerName: nginx
      maxAllowed:
        memory: 1Gi
        cpu: 500m
      minAllowed:
        memory: 100Mi
        cpu: 50m
```

---

## 7. â˜ï¸ äº‘åŸç”Ÿæ¶æ„å®è·µ


### 7.1 äº‘åŸç”Ÿæ¶æ„æ¨¡å¼


**ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„ä¸­çš„Nginxè§’è‰²**
```
ä¼ ç»Ÿæ¶æ„ï¼š
å®¢æˆ·ç«¯ â†’ å•ä½“åº”ç”¨æœåŠ¡å™¨

å¾®æœåŠ¡æ¶æ„ï¼š
å®¢æˆ·ç«¯ â†’ Nginxç½‘å…³ â†’ ç”¨æˆ·æœåŠ¡
                  â†’ è®¢å•æœåŠ¡  
                  â†’ æ”¯ä»˜æœåŠ¡
                  â†’ å•†å“æœåŠ¡
```

**ğŸŒŸ Nginxåœ¨å¾®æœåŠ¡ä¸­çš„ä½œç”¨**
- **APIç½‘å…³**ï¼šç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±åˆ†å‘
- **è´Ÿè½½å‡è¡¡**ï¼šè¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹  
- **æœåŠ¡ç†”æ–­**ï¼šæ•…éšœæœåŠ¡è‡ªåŠ¨éš”ç¦»
- **é™æµæ§åˆ¶**ï¼šä¿æŠ¤åç«¯æœåŠ¡ä¸è¢«å‹å®

### 7.2 Istio Service Meshé›†æˆ


**ğŸ•¸ï¸ ä»€ä¹ˆæ˜¯Service Mesh**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
åº”ç”¨A â†’ ç½‘ç»œ â†’ åº”ç”¨B
(Aéœ€è¦å¤„ç†é‡è¯•ã€ç†”æ–­ã€ç›‘æ§ç­‰é€»è¾‘)

Service Meshï¼š
åº”ç”¨A â†’ Sidecarä»£ç† â†’ ç½‘ç»œ â†’ Sidecarä»£ç† â†’ åº”ç”¨B
(ä»£ç†å¤„ç†æ‰€æœ‰ç½‘ç»œç›¸å…³é€»è¾‘ï¼Œåº”ç”¨ä¸“æ³¨ä¸šåŠ¡)
```

**ğŸ”§ Nginx + Istioé…ç½®**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
  labels:
    app: nginx
spec:
  ports:
  - port: 80
    name: http
  selector:
    app: nginx
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: nginx-vs
spec:
  http:
  - match:
    - uri:
        prefix: /api/
    route:
    - destination:
        host: backend-service
        port:
          number: 3000
  - route:
    - destination:
        host: nginx-service
        port:
          number: 80
```

### 7.3 å¤šäº‘éƒ¨ç½²æ¶æ„


**ğŸŒ è·¨äº‘æœåŠ¡æ¶æ„**
```
ä¸»äº‘ï¼ˆé˜¿é‡Œäº‘ï¼‰ï¼š
  â”œâ”€â”€ K8sé›†ç¾¤1 â†’ Nginxå®ä¾‹1,2,3
  â””â”€â”€ æ•°æ®åº“ä¸»åº“

å¤‡äº‘ï¼ˆè…¾è®¯äº‘ï¼‰ï¼š
  â”œâ”€â”€ K8sé›†ç¾¤2 â†’ Nginxå®ä¾‹4,5
  â””â”€â”€ æ•°æ®åº“ä»åº“

è¾¹ç¼˜äº‘ï¼š
  â””â”€â”€ CDN + Nginxè¾¹ç¼˜èŠ‚ç‚¹
```

**âš–ï¸ å¤šäº‘è´Ÿè½½å‡è¡¡é…ç½®**
```yaml
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: multi-cloud-nginx
spec:
  host: nginx-service
  trafficPolicy:
    loadBalancer:
      localityLbSetting:
        enabled: true
        distribute:
        - from: region1/*
          to:
            "region1/*": 80    # 80%æµé‡ç»™æœ¬åœ°åŒº
            "region2/*": 20    # 20%æµé‡ç»™å¤‡ç”¨åŒº
        failover:
        - from: region1
          to: region2          # ä¸»åŒºåŸŸæ•…éšœæ—¶åˆ‡æ¢
```

### 7.4 DevOpsé›†æˆ


**ğŸ”„ CI/CDæµæ°´çº¿**
```yaml
# GitLab CIç¤ºä¾‹
stages:
  - build
  - test
  - deploy

build-nginx:
  stage: build
  script:
    - docker build -t nginx:$CI_COMMIT_SHA .
    - docker push registry.example.com/nginx:$CI_COMMIT_SHA

deploy-staging:
  stage: deploy
  script:
    - kubectl set image deployment/nginx-deployment 
        nginx=registry.example.com/nginx:$CI_COMMIT_SHA
    - kubectl rollout status deployment/nginx-deployment
  environment:
    name: staging
    url: https://staging.example.com

deploy-production:
  stage: deploy
  script:
    - kubectl set image deployment/nginx-deployment 
        nginx=registry.example.com/nginx:$CI_COMMIT_SHA
    - kubectl rollout status deployment/nginx-deployment
  environment:
    name: production
    url: https://example.com
  when: manual  # ç”Ÿäº§ç¯å¢ƒæ‰‹åŠ¨éƒ¨ç½²
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å®¹å™¨åŒ–éƒ¨ç½²æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¹å™¨åŒ–æœ¬è´¨ï¼šæŠŠåº”ç”¨å’Œç¯å¢ƒæ‰“åŒ…åœ¨ä¸€èµ·ï¼Œåˆ°å¤„éƒ½èƒ½è¿è¡Œ
ğŸ”¸ Dockeréƒ¨ç½²ï¼šå•æœºå®¹å™¨åŒ–ï¼Œå¼€å‘æµ‹è¯•å‹å¥½
ğŸ”¸ Kubernetesï¼šç”Ÿäº§çº§å®¹å™¨ç¼–æ’ï¼Œè‡ªåŠ¨åŒ–ç®¡ç†
ğŸ”¸ æœåŠ¡å‘ç°ï¼šé€šè¿‡åç§°è®¿é—®æœåŠ¡ï¼ŒIPå˜åŒ–æ— æ„ŸçŸ¥
ğŸ”¸ å¼¹æ€§ä¼¸ç¼©ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´å®ä¾‹æ•°é‡
ğŸ”¸ äº‘åŸç”Ÿï¼šé¢å‘äº‘ç¯å¢ƒè®¾è®¡çš„ç°ä»£åŒ–æ¶æ„
```

### 8.2 å…³é”®æŠ€èƒ½æŒæ¡


**ğŸ¯ DockeræŠ€èƒ½**
- **åŸºç¡€æ“ä½œ**ï¼šå®¹å™¨çš„åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢
- **é•œåƒæ„å»º**ï¼šç¼–å†™Dockerfileï¼Œæ„å»ºè‡ªå®šä¹‰é•œåƒ
- **ç½‘ç»œé…ç½®**ï¼šå®¹å™¨é—´é€šä¿¡ï¼Œç«¯å£æ˜ å°„
- **æ•°æ®ç®¡ç†**ï¼šæ•°æ®å·æŒ‚è½½ï¼Œé…ç½®æ–‡ä»¶ç®¡ç†

**â˜¸ï¸ KubernetesæŠ€èƒ½**  
- **èµ„æºç®¡ç†**ï¼šPodã€Serviceã€Deploymentçš„ä½¿ç”¨
- **é…ç½®ç®¡ç†**ï¼šConfigMapã€Secretçš„åº”ç”¨
- **ç½‘ç»œç®¡ç†**ï¼šIngressã€æœåŠ¡ç½‘æ ¼çš„é…ç½®
- **ç›‘æ§è¿ç»´**ï¼šæ—¥å¿—æ”¶é›†ï¼Œæ€§èƒ½ç›‘æ§

### 8.3 å®è·µå»ºè®®


**ğŸ“š å­¦ä¹ è·¯å¾„**
```
ç¬¬ä¸€æ­¥ï¼šæŒæ¡DockeråŸºç¡€
- å­¦ä¼šè¿è¡ŒNginxå®¹å™¨
- ç†è§£é•œåƒå’Œå®¹å™¨æ¦‚å¿µ
- ç»ƒä¹ æŒ‚è½½é…ç½®æ–‡ä»¶

ç¬¬äºŒæ­¥ï¼šå­¦ä¹ KubernetesåŸºç¡€
- éƒ¨ç½²ç®€å•çš„Nginxåº”ç”¨
- ç†è§£Podå’ŒServiceæ¦‚å¿µ
- æŒæ¡åŸºæœ¬çš„kubectlå‘½ä»¤

ç¬¬ä¸‰æ­¥ï¼šè¿›é˜¶å®è·µ
- å®ç°é…ç½®çƒ­æ›´æ–°
- é…ç½®è‡ªåŠ¨ä¼¸ç¼©
- é›†æˆç›‘æ§å‘Šè­¦

ç¬¬å››æ­¥ï¼šç”Ÿäº§å®è·µ
- å¤šç¯å¢ƒéƒ¨ç½²ç®¡ç†
- CI/CDæµæ°´çº¿é›†æˆ
- ç¾éš¾æ¢å¤æ–¹æ¡ˆ
```

**âš ï¸ å¸¸è§é™·é˜±**
- **èµ„æºé™åˆ¶**ï¼šä¸è®¾ç½®èµ„æºé™åˆ¶å¯èƒ½å¯¼è‡´å®¹å™¨æ¶ˆè€—è¿‡å¤šèµ„æº
- **æ•°æ®æŒä¹…åŒ–**ï¼šå¿˜è®°æŒ‚è½½æ•°æ®å·å¯¼è‡´æ•°æ®ä¸¢å¤±
- **ç½‘ç»œé…ç½®**ï¼šæœåŠ¡é—´æ— æ³•é€šä¿¡çš„ç½‘ç»œé—®é¢˜
- **é…ç½®ç®¡ç†**ï¼šé…ç½®æ–‡ä»¶ä¿®æ”¹åå¿˜è®°é‡æ–°éƒ¨ç½²

### 8.4 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ—ï¸ æ¶æ„è®¾è®¡**
- **é«˜å¯ç”¨**ï¼šå¤šå‰¯æœ¬éƒ¨ç½²ï¼Œè·¨å¯ç”¨åŒºåˆ†å¸ƒ
- **å¯è§‚æµ‹**ï¼šå®Œå–„çš„æ—¥å¿—ã€ç›‘æ§ã€é“¾è·¯è¿½è¸ª
- **å®‰å…¨æ€§**ï¼šé•œåƒå®‰å…¨æ‰«æï¼Œç½‘ç»œç­–ç•¥é…ç½®
- **æ€§èƒ½ä¼˜åŒ–**ï¼šèµ„æºé…é¢ã€HPAé…ç½®è°ƒä¼˜

**ğŸ”§ è¿ç»´ç®¡ç†**
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé•œåƒæ ‡ç­¾è§„èŒƒï¼Œå›æ»šç­–ç•¥
- **é…ç½®ç®¡ç†**ï¼šç¯å¢ƒé…ç½®åˆ†ç¦»ï¼Œæ•æ„Ÿä¿¡æ¯åŠ å¯†
- **ç¾éš¾æ¢å¤**ï¼šå®šæœŸå¤‡ä»½ï¼Œæ•…éšœæ¼”ç»ƒ
- **å®¹é‡è§„åˆ’**ï¼šç›‘æ§èµ„æºä½¿ç”¨ï¼Œæå‰æ‰©å®¹

**æ ¸å¿ƒè®°ä½**ï¼š
- å®¹å™¨åŒ–è®©éƒ¨ç½²å˜å¾—æ ‡å‡†åŒ–å’Œè‡ªåŠ¨åŒ–
- Kubernetesæ˜¯ç”Ÿäº§ç¯å¢ƒçš„å¿…å¤‡æŠ€èƒ½
- æœåŠ¡å‘ç°å’Œå¼¹æ€§ä¼¸ç¼©æ˜¯äº‘åŸç”Ÿçš„æ ¸å¿ƒ
- ç›‘æ§å’Œæ—¥å¿—æ˜¯è¿ç»´çš„çœ¼ç›
- å®è·µå‡ºçœŸçŸ¥ï¼Œå¤šåŠ¨æ‰‹æ‰èƒ½æŒæ¡