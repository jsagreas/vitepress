---
title: 2ã€nginx-serveré…ç½®
---
## ğŸ“š ç›®å½•

1. [serveré…ç½®å—çš„ä½œç”¨](#1-serveré…ç½®å—çš„ä½œç”¨)
2. [listenæŒ‡ä»¤è¯¦è§£](#2-listenæŒ‡ä»¤è¯¦è§£)
3. [server_nameæŒ‡ä»¤è¯¦è§£](#3-server_nameæŒ‡ä»¤è¯¦è§£)
4. [åŸŸååŒ¹é…è§„åˆ™æœºåˆ¶](#4-åŸŸååŒ¹é…è§„åˆ™æœºåˆ¶)
5. [é€šé…ç¬¦åŸŸåé…ç½®](#5-é€šé…ç¬¦åŸŸåé…ç½®)
6. [æ­£åˆ™è¡¨è¾¾å¼åŸŸå](#6-æ­£åˆ™è¡¨è¾¾å¼åŸŸå)
7. [å®è·µé…ç½®æ¡ˆä¾‹](#7-å®è·µé…ç½®æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ  serveré…ç½®å—çš„ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯serveré…ç½®å—


**é€šä¿—ç†è§£**ï¼šå°±åƒä¸€æ ‹æ¥¼é‡Œæœ‰å¾ˆå¤šæˆ¿é—´ï¼Œæ¯ä¸ª`server`é…ç½®å—å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æˆ¿é—´ï¼Œå¯ä»¥ä¸ºä¸åŒçš„ç½‘ç«™æä¾›æœåŠ¡ã€‚

```
æƒ³è±¡ä¸€ä¸‹å…¬å¯“æ¥¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     NginxæœåŠ¡å™¨å¤§æ¥¼      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ serverå—1: å…¬å¸å®˜ç½‘     â”‚ â† www.company.com
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ serverå—2: åšå®¢ç½‘ç«™     â”‚ â† blog.company.com  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ serverå—3: APIæ¥å£      â”‚ â† api.company.com
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸€ä¸ªNginxå¯ä»¥åŒæ—¶æ‰˜ç®¡å¤šä¸ªä¸åŒçš„ç½‘ç«™ï¼
```

### 1.2 serverå—çš„åŸºæœ¬ä½œç”¨


**ğŸ”¸ ç½‘ç«™éš”ç¦»**
- æ¯ä¸ªç½‘ç«™æœ‰è‡ªå·±ç‹¬ç«‹çš„é…ç½®
- ä¸åŒç½‘ç«™çš„è®¾ç½®ä¸ä¼šç›¸äº’å½±å“
- å°±åƒæ¯ä¸ªæˆ¿é—´æœ‰è‡ªå·±çš„è£…ä¿®é£æ ¼

**ğŸ”¸ èµ„æºåˆ†é…**
- å¯ä»¥ä¸ºä¸åŒç½‘ç«™åˆ†é…ä¸åŒçš„èµ„æº
- è®¾ç½®ä¸åŒçš„è®¿é—®è§„åˆ™å’Œé™åˆ¶
- é…ç½®ä¸“é—¨çš„æ—¥å¿—æ–‡ä»¶

**ğŸ”¸ çµæ´»ç®¡ç†**
- å¯ä»¥å•ç‹¬å¯ç”¨æˆ–åœç”¨æŸä¸ªç½‘ç«™
- æ–¹ä¾¿ç»´æŠ¤å’Œå‡çº§ç‰¹å®šç½‘ç«™
- ä¾¿äºé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–

### 1.3 serverå—åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ä½ç½®


```nginx
# nginx.conf ä¸»é…ç½®æ–‡ä»¶ç»“æ„
http {
    # å…¨å±€HTTPè®¾ç½®
    include       /etc/nginx/mime.types;
    
    # ç¬¬ä¸€ä¸ªç½‘ç«™
    server {
        listen 80;
        server_name www.example.com;
        # è¿™ä¸ªç½‘ç«™çš„å…·ä½“é…ç½®...
    }
    
    # ç¬¬äºŒä¸ªç½‘ç«™  
    server {
        listen 80;
        server_name blog.example.com;
        # å¦ä¸€ä¸ªç½‘ç«™çš„é…ç½®...
    }
}
```

**ğŸ’¡ ç†è§£è¦ç‚¹**ï¼š
- `server`å—å¿…é¡»å†™åœ¨`http`å—å†…éƒ¨
- ä¸€ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ª`server`å—
- æ¯ä¸ª`server`å—ä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼ˆç½‘ç«™ï¼‰

---

## 2. ğŸ”Œ listenæŒ‡ä»¤è¯¦è§£


### 2.1 listenæŒ‡ä»¤çš„åŸºæœ¬ä½œç”¨


**é€šä¿—è§£é‡Š**ï¼š`listen`å°±åƒæ˜¯å‘Šè¯‰Nginx"è¯·åœ¨å“ªä¸ªé—¨å£ç­‰å®¢äºº"ã€‚å°±åƒé…’åº—å‰å°éœ€è¦çŸ¥é“åœ¨å‡ å·é—¨æ¥å¾…å®¢äººä¸€æ ·ã€‚

```
ç°å®ç±»æ¯”ï¼š
é…’åº—æœ‰å¤šä¸ªå…¥å£ï¼š
- æ­£é—¨ï¼ˆ80ç«¯å£ï¼‰    â† HTTPè®¿é—®
- VIPå…¥å£ï¼ˆ443ç«¯å£ï¼‰ â† HTTPSè®¿é—®  
- åé—¨ï¼ˆ8080ç«¯å£ï¼‰  â† ç®¡ç†åå°

æ¯ä¸ªå…¥å£éƒ½éœ€è¦æœ‰äººå€¼å®ˆï¼
```

### 2.2 listençš„å¸¸ç”¨é…ç½®æ–¹å¼


**ğŸ”¸ åŸºç¡€ç«¯å£ç›‘å¬**
```nginx
server {
    listen 80;                # ç›‘å¬80ç«¯å£ï¼ˆHTTPæ ‡å‡†ç«¯å£ï¼‰
    listen 443 ssl;           # ç›‘å¬443ç«¯å£ï¼ˆHTTPSæ ‡å‡†ç«¯å£ï¼‰
    listen 8080;              # ç›‘å¬è‡ªå®šä¹‰ç«¯å£
}
```

**ğŸ”¸ æŒ‡å®šIPåœ°å€ç›‘å¬**
```nginx
server {
    listen 192.168.1.100:80;    # åªç›‘å¬ç‰¹å®šIPçš„80ç«¯å£
    listen 127.0.0.1:8080;      # åªç›‘å¬æœ¬åœ°çš„8080ç«¯å£
    listen [::]:80;             # IPv6åœ°å€ç›‘å¬
}
```

**ğŸ”¸ å¸¦å‚æ•°çš„ç›‘å¬é…ç½®**
```nginx
server {
    listen 80 default_server;   # è®¾ä¸ºé»˜è®¤æœåŠ¡å™¨
    listen 443 ssl http2;       # å¯ç”¨SSLå’ŒHTTP/2
    listen 80 reuseport;        # ç«¯å£é‡ç”¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
}
```

### 2.3 default_serverçš„é‡è¦ä½œç”¨


**â“ ä»€ä¹ˆæ˜¯default_server**ï¼š
å½“è®¿é—®çš„åŸŸåæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•`server_name`æ—¶ï¼ŒNginxä¼šä½¿ç”¨æ ‡è®°ä¸º`default_server`çš„æœåŠ¡å™¨å—æ¥å¤„ç†è¯·æ±‚ã€‚

```nginx
# é»˜è®¤æœåŠ¡å™¨ - å¤„ç†æ— æ³•åŒ¹é…çš„è¯·æ±‚
server {
    listen 80 default_server;
    server_name _;  # ä¸‹åˆ’çº¿è¡¨ç¤ºåŒ¹é…ä»»ä½•åŸŸå
    
    # è¿”å›404æˆ–è€…è·³è½¬åˆ°ä¸»ç«™
    return 404;
}

# å…·ä½“çš„ç½‘ç«™é…ç½®
server {
    listen 80;
    server_name www.example.com;
    # ç½‘ç«™é…ç½®...
}
```

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
- æ€»æ˜¯é…ç½®ä¸€ä¸ª`default_server`
- ç”¨æ¥å¤„ç†æ¶æ„è®¿é—®æˆ–é”™è¯¯è¯·æ±‚
- å¯ä»¥è¿”å›404æˆ–é‡å®šå‘åˆ°ä¸»ç«™

---

## 3. ğŸ“ server_nameæŒ‡ä»¤è¯¦è§£


### 3.1 server_nameçš„åŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼š`server_name`å°±åƒé—¨ç‰Œå·ï¼Œå‘Šè¯‰Nginx"å½“å®¢äººé—®è¿™ä¸ªåœ°å€æ—¶ï¼Œå°±è®©ä»–è¿›è¿™ä¸ªæˆ¿é—´"ã€‚

```
ç±»æ¯”å¿«é€’é…é€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°åŒºï¼šNginxæœåŠ¡å™¨            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1å·æ¥¼ï¼šwww.example.com      â”‚ â† server_name
â”‚ 2å·æ¥¼ï¼šblog.example.com     â”‚ â† server_name  
â”‚ 3å·æ¥¼ï¼šapi.example.com      â”‚ â† server_name
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¿«é€’å‘˜æ ¹æ®åœ°å€æ‰¾åˆ°å¯¹åº”çš„æ¥¼ï¼
```

### 3.2 ç²¾ç¡®åŸŸååŒ¹é…


**ğŸ”¸ å®Œæ•´åŸŸååŒ¹é…**
```nginx
server {
    listen 80;
    server_name www.example.com;    # åªåŒ¹é…è¿™ä¸ªç¡®åˆ‡åŸŸå
}

server {
    listen 80;  
    server_name blog.example.com;   # åªåŒ¹é…è¿™ä¸ªç¡®åˆ‡åŸŸå
}
```

**ğŸ”¸ å¤šä¸ªåŸŸååŒ¹é…**
```nginx
server {
    listen 80;
    server_name www.example.com example.com;  # ä¸¤ä¸ªåŸŸåéƒ½æŒ‡å‘åŒä¸€ä¸ªç½‘ç«™
}

server {
    listen 80;
    server_name 
        www.example.com 
        example.com 
        www.example.net;  # å¤šè¡Œå†™æ³•ï¼Œæ›´æ¸…æ™°
}
```

### 3.3 server_nameçš„åŒ¹é…ä¼˜å…ˆçº§


**ğŸ“Š åŒ¹é…ä¼˜å…ˆçº§ä»é«˜åˆ°ä½**ï¼š

| ä¼˜å…ˆçº§ | åŒ¹é…ç±»å‹ | ç¤ºä¾‹ | è¯´æ˜ |
|--------|----------|------|------|
| **1** | ç²¾ç¡®åŒ¹é… | `www.example.com` | å®Œå…¨ç›¸åŒçš„åŸŸå |
| **2** | å‰ç¼€é€šé…ç¬¦ | `*.example.com` | ä»¥é€šé…ç¬¦å¼€å¤´ |
| **3** | åç¼€é€šé…ç¬¦ | `www.example.*` | ä»¥é€šé…ç¬¦ç»“å°¾ |
| **4** | æ­£åˆ™è¡¨è¾¾å¼ | `~^www\.(.+)\.com$` | æ­£åˆ™åŒ¹é… |
| **5** | default_server | `_` | é»˜è®¤æœåŠ¡å™¨ |

**ğŸ’¡ ç†è§£è¦ç‚¹**ï¼š
- Nginxä¼šé€‰æ‹©æœ€ç²¾ç¡®çš„åŒ¹é…
- å¦‚æœæœ‰å¤šä¸ªç›¸åŒä¼˜å…ˆçº§çš„åŒ¹é…ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
- å»ºè®®é¿å…å¤æ‚çš„åŒ¹é…è§„åˆ™ï¼Œä¿æŒé…ç½®ç®€å•

---

## 4. ğŸ¯ åŸŸååŒ¹é…è§„åˆ™æœºåˆ¶


### 4.1 åŒ¹é…è¿‡ç¨‹è¯¦è§£


**ğŸ” Nginxçš„åŸŸååŒ¹é…æ­¥éª¤**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚: http://blog.example.com
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1æ­¥ï¼šå¯»æ‰¾ç²¾ç¡®åŒ¹é…               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŸ¥æ‰¾ server_name blog.example.com â”‚
â”‚ æ‰¾åˆ°äº†ï¼Ÿ æ˜¯ â†’ ä½¿ç”¨æ­¤serverå—     â”‚
â”‚          å¦ â†’ ç»§ç»­ä¸‹ä¸€æ­¥         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2æ­¥ï¼šå¯»æ‰¾é€šé…ç¬¦åŒ¹é…             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŸ¥æ‰¾ server_name *.example.com   â”‚
â”‚ åŒ¹é…äº†ï¼Ÿ æ˜¯ â†’ ä½¿ç”¨æ­¤serverå—     â”‚
â”‚          å¦ â†’ ç»§ç»­ä¸‹ä¸€æ­¥         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬3æ­¥ï¼šä½¿ç”¨default_server        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä½¿ç”¨æ ‡è®°ä¸ºdefault_serverçš„é…ç½®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 åŒ¹é…è§„åˆ™å®é™…æ¡ˆä¾‹


**ğŸ“ é…ç½®ç¤ºä¾‹**ï¼š
```nginx
# ç²¾ç¡®åŒ¹é… - ä¼˜å…ˆçº§æœ€é«˜
server {
    listen 80;
    server_name blog.example.com;
    root /var/www/blog;
}

# é€šé…ç¬¦åŒ¹é… - ä¼˜å…ˆçº§è¾ƒä½
server {
    listen 80;
    server_name *.example.com;
    root /var/www/wildcard;
}

# é»˜è®¤æœåŠ¡å™¨ - ä¼˜å…ˆçº§æœ€ä½
server {
    listen 80 default_server;
    server_name _;
    return 404;
}
```

**ğŸ§ª æµ‹è¯•å„ç§è®¿é—®æƒ…å†µ**ï¼š

| è®¿é—®åŸŸå | åŒ¹é…ç»“æœ | åŸå›  |
|----------|----------|------|
| `blog.example.com` | ç¬¬1ä¸ªserver | ç²¾ç¡®åŒ¹é…ï¼Œä¼˜å…ˆçº§æœ€é«˜ |
| `api.example.com` | ç¬¬2ä¸ªserver | é€šé…ç¬¦åŒ¹é… |
| `www.example.com` | ç¬¬2ä¸ªserver | é€šé…ç¬¦åŒ¹é… |
| `other.com` | ç¬¬3ä¸ªserver | æ— åŒ¹é…ï¼Œä½¿ç”¨é»˜è®¤ |

### 4.3 ç‰¹æ®ŠåŒ¹é…æƒ…å†µ


**ğŸ”¸ IPåœ°å€è®¿é—®**
```nginx
server {
    listen 80;
    server_name 192.168.1.100;  # ç›´æ¥ç”¨IPè®¿é—®
    return 301 http://www.example.com$request_uri;  # é‡å®šå‘åˆ°åŸŸå
}
```

**ğŸ”¸ ç¦æ­¢IPç›´æ¥è®¿é—®**
```nginx
server {
    listen 80 default_server;
    server_name _;
    return 444;  # ç›´æ¥å…³é—­è¿æ¥ï¼Œä¸è¿”å›ä»»ä½•å†…å®¹
}
```

---

## 5. ğŸŒŸ é€šé…ç¬¦åŸŸåé…ç½®


### 5.1 ä»€ä¹ˆæ˜¯é€šé…ç¬¦åŸŸå


**é€šä¿—è§£é‡Š**ï¼šé€šé…ç¬¦å°±åƒæ˜¯ä¸‡èƒ½é’¥åŒ™ï¼Œå¯ä»¥åŒ¹é…ä¸€ç±»ç›¸ä¼¼çš„åŸŸåã€‚æ˜Ÿå·ï¼ˆ*ï¼‰å°±æ˜¯è¿™æŠŠä¸‡èƒ½é’¥åŒ™ã€‚

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
å®¶åº­ä½å€é€šé…ç¬¦ï¼š
- ç²¾ç¡®åœ°å€ï¼šåŒ—äº¬å¸‚æœé˜³åŒºæŸæŸå°åŒº1å·æ¥¼
- é€šé…ç¬¦åœ°å€ï¼šåŒ—äº¬å¸‚æœé˜³åŒºæŸæŸå°åŒº*å·æ¥¼  â† åŒ¹é…æ‰€æœ‰æ¥¼å·

åŸŸåé€šé…ç¬¦ï¼š
- ç²¾ç¡®åŸŸåï¼šblog.example.com
- é€šé…ç¬¦åŸŸåï¼š*.example.com  â† åŒ¹é…æ‰€æœ‰å­åŸŸå
```

### 5.2 å‰ç¼€é€šé…ç¬¦é…ç½®


**ğŸ”¸ å­åŸŸåé€šé…ç¬¦**
```nginx
server {
    listen 80;
    server_name *.example.com;  # åŒ¹é…æ‰€æœ‰example.comçš„å­åŸŸå
    
    # åŒ¹é…æ•ˆæœï¼š
    # âœ… blog.example.com
    # âœ… api.example.com  
    # âœ… www.example.com
    # âœ… admin.example.com
    # âŒ example.com        (ä¸åŒ¹é…æ ¹åŸŸå)
    # âŒ blog.other.com     (ä¸åŒ¹é…å…¶ä»–åŸŸå)
}
```

**ğŸ”¸ å¤šçº§å­åŸŸååŒ¹é…**
```nginx
server {
    listen 80;
    server_name *.api.example.com;
    
    # åŒ¹é…æ•ˆæœï¼š
    # âœ… v1.api.example.com
    # âœ… v2.api.example.com
    # âœ… test.api.example.com  
    # âŒ api.example.com      (ä¸åŒ¹é…ä¸Šçº§åŸŸå)
}
```

### 5.3 åç¼€é€šé…ç¬¦é…ç½®


**ğŸ”¸ é¡¶çº§åŸŸåé€šé…ç¬¦**
```nginx
server {
    listen 80;
    server_name www.example.*;  # åŒ¹é…ä¸åŒçš„é¡¶çº§åŸŸå
    
    # åŒ¹é…æ•ˆæœï¼š
    # âœ… www.example.com
    # âœ… www.example.net
    # âœ… www.example.org
    # âœ… www.example.cn
    # âŒ blog.example.com    (ä¸åŒ¹é…ä¸åŒå‰ç¼€)
}
```

### 5.4 é€šé…ç¬¦ä½¿ç”¨æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦é™åˆ¶**ï¼š
- é€šé…ç¬¦åªèƒ½åœ¨åŸŸåçš„å¼€å¤´æˆ–ç»“å°¾
- ä¸€ä¸ªåŸŸåä¸­åªèƒ½æœ‰ä¸€ä¸ªé€šé…ç¬¦
- é€šé…ç¬¦ä¸èƒ½åœ¨åŸŸåä¸­é—´

```nginx
# âœ… æ­£ç¡®ç”¨æ³•
server_name *.example.com;      # å‰ç¼€é€šé…ç¬¦
server_name www.example.*;      # åç¼€é€šé…ç¬¦

# âŒ é”™è¯¯ç”¨æ³•  
server_name *.example.*;        # ä¸èƒ½åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªé€šé…ç¬¦
server_name www.*.com;          # ä¸èƒ½åœ¨ä¸­é—´ä½¿ç”¨é€šé…ç¬¦
server_name *example.com;       # é€šé…ç¬¦åå¿…é¡»æœ‰ç‚¹å·
```

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
- ä¼˜å…ˆä½¿ç”¨ç²¾ç¡®åŒ¹é…ï¼Œæ€§èƒ½æ›´å¥½
- é€šé…ç¬¦ä¸»è¦ç”¨äºå­åŸŸåè¾ƒå¤šçš„åœºæ™¯
- é¿å…è¿‡äºå®½æ³›çš„é€šé…ç¬¦åŒ¹é…

---

## 6. ğŸ” æ­£åˆ™è¡¨è¾¾å¼åŸŸå


### 6.1 ä»€ä¹ˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼åŸŸå


**é€šä¿—ç†è§£**ï¼šå¦‚æœè¯´é€šé…ç¬¦æ˜¯ä¸‡èƒ½é’¥åŒ™ï¼Œé‚£æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯å¯ä»¥å®šåˆ¶çš„æ™ºèƒ½é”ï¼Œå¯ä»¥æŒ‰ç…§å¤æ‚çš„è§„åˆ™æ¥åŒ¹é…åŸŸåã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
é€šé…ç¬¦ï¼šæ‰€æœ‰å§“å¼ çš„äººéƒ½å¯ä»¥è¿›å…¥ (*.zhang)
æ­£åˆ™è¡¨è¾¾å¼ï¼šå§“å¼ ï¼Œåå­—æ˜¯ä¸¤ä¸ªå­—ï¼Œç¬¬äºŒä¸ªå­—æ˜¯"æ˜"çš„äººå¯ä»¥è¿›å…¥ (~^å¼ .æ˜$)

åŸŸååŒ¹é…ï¼š
é€šé…ç¬¦ï¼š*.example.com
æ­£åˆ™è¡¨è¾¾å¼ï¼š~^(?<subdomain>\w+)\.example\.com$
```

### 6.2 æ­£åˆ™è¡¨è¾¾å¼çš„åŸºæœ¬è¯­æ³•


**ğŸ”¸ æ­£åˆ™åŸŸåæ ‡è¯†**
```nginx
server {
    listen 80;
    server_name ~^æ­£åˆ™è¡¨è¾¾å¼$;  # æ³¢æµªå·(~)å¼€å¤´è¡¨ç¤ºæ­£åˆ™åŒ¹é…
}
```

**ğŸ”¸ å¸¸ç”¨æ­£åˆ™ç¬¦å·å«ä¹‰**

| ç¬¦å· | å«ä¹‰ | ç¤ºä¾‹ | åŒ¹é…æ•ˆæœ |
|------|------|------|----------|
| `^` | å¼€å§‹é”šç‚¹ | `^www` | ä»¥wwwå¼€å¤´ |
| `$` | ç»“æŸé”šç‚¹ | `com$` | ä»¥comç»“å°¾ |
| `.` | ä»»æ„å­—ç¬¦ | `a.c` | abc, a1c, a-c |
| `\.` | ç‚¹å·æœ¬èº« | `\.com` | .com |
| `\w` | å­—æ¯æ•°å­— | `\w+` | ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æ•°å­— |
| `+` | ä¸€ä¸ªæˆ–å¤šä¸ª | `a+` | a, aa, aaa |
| `*` | é›¶ä¸ªæˆ–å¤šä¸ª | `a*` | ç©º, a, aa |
| `()` | åˆ†ç»„æ•è· | `(www)` | æ•è·wwwåˆ°å˜é‡ |

### 6.3 å®ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼æ¡ˆä¾‹


**ğŸ”¸ åŒ¹é…ç§»åŠ¨ç«¯å­åŸŸå**
```nginx
server {
    listen 80;
    server_name ~^(m|mobile|wap)\.example\.com$;
    
    # åŒ¹é…æ•ˆæœï¼š
    # âœ… m.example.com
    # âœ… mobile.example.com  
    # âœ… wap.example.com
    # âŒ www.example.com
    
    root /var/www/mobile;
}
```

**ğŸ”¸ åŒ¹é…ç‰ˆæœ¬å·å­åŸŸå**
```nginx
server {
    listen 80;
    server_name ~^v\d+\.api\.example\.com$;
    
    # åŒ¹é…æ•ˆæœï¼š
    # âœ… v1.api.example.com
    # âœ… v2.api.example.com
    # âœ… v10.api.example.com
    # âŒ api.example.com
    # âŒ va.api.example.com
}
```

**ğŸ”¸ æ•è·å­åŸŸååˆ°å˜é‡**
```nginx
server {
    listen 80;
    server_name ~^(?<user>\w+)\.users\.example\.com$;
    
    # æ•è·å­åŸŸååˆ°$userå˜é‡
    # john.users.example.com â†’ $user = "john"
    
    root /var/www/users/$user;  # ä½¿ç”¨æ•è·çš„å˜é‡
}
```

### 6.4 æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨å»ºè®®


**âš ï¸ æ€§èƒ½è€ƒè™‘**ï¼š
- æ­£åˆ™åŒ¹é…æ¯”ç²¾ç¡®åŒ¹é…æ…¢
- å¤æ‚æ­£åˆ™ä¼šå½±å“Nginxæ€§èƒ½
- åªåœ¨å¿…è¦æ—¶ä½¿ç”¨æ­£åˆ™åŒ¹é…

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
```nginx
# æ¨èï¼šç®€å•åœºæ™¯ç”¨ç²¾ç¡®åŒ¹é…
server {
    server_name www.example.com blog.example.com;
}

# æ¨èï¼šä¸­ç­‰å¤æ‚åº¦ç”¨é€šé…ç¬¦
server {
    server_name *.example.com;
}

# è°¨æ…ä½¿ç”¨ï¼šå¤æ‚åœºæ™¯æ‰ç”¨æ­£åˆ™
server {
    server_name ~^(?<env>dev|test|prod)\.api\.example\.com$;
}
```

---

## 7. ğŸ› ï¸ å®è·µé…ç½®æ¡ˆä¾‹


### 7.1 å¤šç«™ç‚¹é…ç½®å®ä¾‹


**ğŸ¯ åœºæ™¯æè¿°**ï¼šä¸€å°æœåŠ¡å™¨æ‰˜ç®¡å…¬å¸çš„å¤šä¸ªç½‘ç«™

```nginx
# /etc/nginx/nginx.conf

http {
    # å…¨å±€è®¾ç½®
    include /etc/nginx/mime.types;
    
    # å…¬å¸å®˜ç½‘
    server {
        listen 80;
        server_name www.company.com company.com;
        root /var/www/company;
        index index.html index.php;
        
        # å¤„ç†PHPæ–‡ä»¶
        location ~ \.php$ {
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_index index.php;
            include fastcgi_params;
        }
    }
    
    # åšå®¢ç½‘ç«™
    server {
        listen 80;
        server_name blog.company.com;
        root /var/www/blog;
        index index.html;
        
        # é™æ€æ–‡ä»¶ç¼“å­˜
        location ~* \.(jpg|jpeg|png|css|js)$ {
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # APIæ¥å£
    server {
        listen 80;
        server_name api.company.com;
        
        # ä»£ç†åˆ°åç«¯åº”ç”¨
        location / {
            proxy_pass http://127.0.0.1:3000;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }
    
    # é»˜è®¤å¤„ç†ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
    server {
        listen 80 default_server;
        server_name _;
        return 444;  # ç›´æ¥æ–­å¼€è¿æ¥
    }
}
```

### 7.2 å¼€å‘ç¯å¢ƒé…ç½®


**ğŸ¯ åœºæ™¯æè¿°**ï¼šä¸ºå¼€å‘å›¢é˜Ÿé…ç½®æµ‹è¯•ç¯å¢ƒ

```nginx
# å¼€å‘ç¯å¢ƒå¤šç‰ˆæœ¬é…ç½®
server {
    listen 80;
    server_name ~^(?<env>dev|test|staging)\.(?<project>\w+)\.company\.com$;
    
    # æ ¹æ®ç¯å¢ƒå’Œé¡¹ç›®ååŠ¨æ€è®¾ç½®è·¯å¾„
    root /var/www/$env/$project;
    index index.html index.php;
    
    # æ·»åŠ è°ƒè¯•ä¿¡æ¯å¤´
    add_header X-Environment $env;
    add_header X-Project $project;
}

# ä¸ªäººå¼€å‘ç¯å¢ƒ
server {
    listen 80;
    server_name ~^(?<username>\w+)\.dev\.company\.com$;
    
    root /home/$username/www;
    index index.html;
    
    # åªå…è®¸å†…ç½‘è®¿é—®
    allow 192.168.0.0/16;
    allow 10.0.0.0/8;
    deny all;
}
```

### 7.3 HTTPSå’ŒHTTPé‡å®šå‘


**ğŸ¯ åœºæ™¯æè¿°**ï¼šå¼ºåˆ¶ä½¿ç”¨HTTPSè®¿é—®

```nginx
# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name www.company.com company.com;
    return 301 https://www.company.com$request_uri;
}

# HTTPSé…ç½®
server {
    listen 443 ssl http2;
    server_name www.company.com company.com;
    
    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/company.crt;
    ssl_certificate_key /etc/nginx/ssl/company.key;
    
    # SSLå®‰å…¨è®¾ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    
    root /var/www/company;
    index index.html;
}
```

### 7.4 é…ç½®æµ‹è¯•å’Œè°ƒè¯•


**ğŸ”§ æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®**ï¼š

```bash
# æ£€æŸ¥é…ç½®è¯­æ³•
sudo nginx -t

# é‡æ–°åŠ è½½é…ç½®
sudo nginx -s reload

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æµ‹è¯•åŸŸåè§£æ
curl -H "Host: www.example.com" http://your-server-ip/
```

**ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|----------|----------|----------|
| è®¿é—®æ˜¾ç¤ºé»˜è®¤é¡µé¢ | `server_name`ä¸åŒ¹é… | æ£€æŸ¥åŸŸåé…ç½®å’ŒDNSè§£æ |
| 502é”™è¯¯ | åç«¯æœåŠ¡æœªå¯åŠ¨ | æ£€æŸ¥`proxy_pass`çš„ç›®æ ‡æœåŠ¡ |
| 403é”™è¯¯ | æƒé™æˆ–æ–‡ä»¶ä¸å­˜åœ¨ | æ£€æŸ¥`root`ç›®å½•å’Œæ–‡ä»¶æƒé™ |
| é…ç½®ä¸ç”Ÿæ•ˆ | æœªé‡è½½é…ç½® | æ‰§è¡Œ`nginx -s reload` |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ serveré…ç½®å—ï¼šæ¯ä¸ªç½‘ç«™çš„ç‹¬ç«‹é…ç½®ç©ºé—´
ğŸ”¸ listenæŒ‡ä»¤ï¼šæŒ‡å®šç›‘å¬çš„IPåœ°å€å’Œç«¯å£
ğŸ”¸ server_nameæŒ‡ä»¤ï¼šå®šä¹‰å“åº”çš„åŸŸå
ğŸ”¸ åŸŸååŒ¹é…é¡ºåºï¼šç²¾ç¡® > é€šé…ç¬¦ > æ­£åˆ™ > é»˜è®¤
ğŸ”¸ default_serverï¼šå¤„ç†æ— åŒ¹é…è¯·æ±‚çš„é»˜è®¤é…ç½®
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è™šæ‹Ÿä¸»æœºçš„æœ¬è´¨**
```
ä¸€å°ç‰©ç†æœåŠ¡å™¨ = å¤šä¸ªè™šæ‹Ÿç½‘ç«™
æ¯ä¸ªserverå— = ä¸€ä¸ªè™šæ‹Ÿä¸»æœº
é€šè¿‡åŸŸååŒºåˆ† = ä¸åŒçš„ç½‘ç«™æœåŠ¡
```

**ğŸ”¹ åŒ¹é…ä¼˜å…ˆçº§è®°å¿†**
```
ç²¾ç¡®åŒ¹é…æœ€ä¼˜å…ˆ â†’ www.example.com
å‰ç¼€é€šé…ç¬¦å…¶æ¬¡ â†’ *.example.com  
åç¼€é€šé…ç¬¦å†æ¬¡ â†’ www.example.*
æ­£åˆ™è¡¨è¾¾å¼è¾ƒå â†’ ~^www\.(.+)\.com$
é»˜è®¤æœåŠ¡å™¨æœ€å â†’ default_server
```

**ğŸ”¹ é…ç½®æœ€ä½³å®è·µ**
```
ç®€å•åœºæ™¯ç”¨ç²¾ç¡®åŒ¹é…ï¼šæ€§èƒ½æœ€å¥½
å­åŸŸåå¤šç”¨é€šé…ç¬¦ï¼šé…ç½®ç®€æ´
å¤æ‚è§„åˆ™ç”¨æ­£åˆ™ï¼šåŠŸèƒ½å¼ºå¤§
æ€»æ˜¯é…ç½®é»˜è®¤æœåŠ¡å™¨ï¼šå®‰å…¨è€ƒè™‘
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ä¼ä¸šå®˜ç½‘**ï¼šå¤šä¸ªåŸŸåæŒ‡å‘åŒä¸€ç½‘ç«™
- **å­ç«™ç®¡ç†**ï¼šä¸åŒä¸šåŠ¡çº¿çš„ç‹¬ç«‹ç½‘ç«™  
- **å¼€å‘ç¯å¢ƒ**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒéš”ç¦»
- **APIæœåŠ¡**ï¼šæ¥å£æœåŠ¡çš„ç‹¬ç«‹é…ç½®

**ğŸ”§ è¿ç»´å®è·µ**
- **é…ç½®ç®¡ç†**ï¼šæ¯ä¸ªç½‘ç«™ç‹¬ç«‹é…ç½®ï¼Œä¾¿äºç»´æŠ¤
- **æ•…éšœéš”ç¦»**ï¼šå•ä¸ªç½‘ç«™é—®é¢˜ä¸å½±å“å…¶ä»–ç«™ç‚¹
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸åŒç½‘ç«™çš„ä¸“é—¨ä¼˜åŒ–
- **å®‰å…¨æ§åˆ¶**ï¼šä¸åŒç½‘ç«™çš„è®¿é—®æ§åˆ¶ç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
serverå—åˆ†ç½‘ç«™ï¼Œlistenå®šç«¯å£
server_nameè¯†åŸŸåï¼ŒåŒ¹é…æœ‰ä¼˜å…ˆ  
ç²¾ç¡®é€šé…æ­£åˆ™åºï¼Œé»˜è®¤æœ€åå…œåº•
é…ç½®æµ‹è¯•è¦ä»”ç»†ï¼Œé‡è½½ç”Ÿæ•ˆè«å¿˜è®°
```

**ğŸ’¡ æ–°æ‰‹å­¦ä¹ å»ºè®®**ï¼š
1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆé…ç½®å•ä¸ªç½‘ç«™ï¼Œå†å°è¯•å¤šç«™ç‚¹
2. **ç†è§£åŒ¹é…é€»è¾‘**ï¼šææ¸…æ¥šNginxå¦‚ä½•é€‰æ‹©serverå—
3. **å¤šåšå®éªŒ**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå°è¯•ä¸åŒé…ç½®
4. **æŸ¥çœ‹æ—¥å¿—**ï¼šé‡åˆ°é—®é¢˜æ—¶å…»æˆçœ‹æ—¥å¿—çš„ä¹ æƒ¯
5. **å¤‡ä»½é…ç½®**ï¼šä¿®æ”¹å‰å…ˆå¤‡ä»½ï¼Œé¿å…é…ç½®ä¸¢å¤±