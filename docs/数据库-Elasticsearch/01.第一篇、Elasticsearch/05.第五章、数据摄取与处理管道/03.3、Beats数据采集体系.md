---
title: 3ã€Beatsæ•°æ®é‡‡é›†ä½“ç³»
---
## ğŸ“š ç›®å½•

1. [Beatsæ•°æ®é‡‡é›†ä½“ç³»æ¦‚è¿°](#1-beatsæ•°æ®é‡‡é›†ä½“ç³»æ¦‚è¿°)
2. [Filebeatæ—¥å¿—é‡‡é›†è¯¦è§£](#2-filebeatæ—¥å¿—é‡‡é›†è¯¦è§£)
3. [MetricbeatæŒ‡æ ‡é‡‡é›†ç³»ç»Ÿ](#3-metricbeatæŒ‡æ ‡é‡‡é›†ç³»ç»Ÿ)
4. [ç³»ç»Ÿä¸å®‰å…¨ç›‘æ§Beats](#4-ç³»ç»Ÿä¸å®‰å…¨ç›‘æ§beats)
5. [ç½‘ç»œä¸å¯ç”¨æ€§ç›‘æ§](#5-ç½‘ç»œä¸å¯ç”¨æ€§ç›‘æ§)
6. [Beatsæ ¸å¿ƒé…ç½®ç®¡ç†](#6-beatsæ ¸å¿ƒé…ç½®ç®¡ç†)
7. [æ•°æ®å¤„ç†ä¸å­—æ®µç®¡ç†](#7-æ•°æ®å¤„ç†ä¸å­—æ®µç®¡ç†)
8. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç­–ç•¥](#8-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Beatsæ•°æ®é‡‡é›†ä½“ç³»æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Beats

**ç®€å•ç†è§£**ï¼šBeatså°±åƒæ˜¯æ•°æ®æ”¶é›†çš„"å°åŠ©æ‰‹"ï¼Œä¸“é—¨è´Ÿè´£ä»å„ç§åœ°æ–¹æ”¶é›†æ•°æ®ï¼Œç„¶åé€åˆ°Elasticsearch

> ğŸ’¡ **é€šä¿—æ¯”å–»**ï¼šæƒ³è±¡Beatsæ˜¯ä¸€ç¾¤ä¸åŒä¸“ä¸šçš„"æ•°æ®å¿«é€’å‘˜"
> - Filebeatï¼šä¸“é—¨æ”¶é›†æ–‡ä»¶å’Œæ—¥å¿—
> - Metricbeatï¼šä¸“é—¨æ”¶é›†ç³»ç»Ÿæ€§èƒ½æ•°æ®  
> - Winlogbeatï¼šä¸“é—¨æ”¶é›†Windowsç³»ç»Ÿæ—¥å¿—
> - æ¯ä¸ª"å¿«é€’å‘˜"éƒ½æœ‰è‡ªå·±çš„ä¸“é•¿

```
Beatsç”Ÿæ€ç³»ç»Ÿæ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨æœåŠ¡å™¨     â”‚    â”‚   æ•°æ®åº“æœåŠ¡å™¨   â”‚    â”‚   WebæœåŠ¡å™¨     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Filebeat   â”‚ â”‚    â”‚ â”‚ Metricbeat  â”‚ â”‚    â”‚ â”‚  Filebeat   â”‚ â”‚
â”‚ â”‚(æ”¶é›†æ—¥å¿—)   â”‚ â”‚    â”‚ â”‚(æ”¶é›†æŒ‡æ ‡)   â”‚ â”‚    â”‚ â”‚(æ”¶é›†è®¿é—®æ—¥å¿—)â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Elasticsearch  â”‚
                         â”‚   (ç»Ÿä¸€å­˜å‚¨)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Beatså®¶æ—æˆå‘˜


| Beatç±»å‹ | **ä¸»è¦ç”¨é€”** | **å…¸å‹åº”ç”¨åœºæ™¯** | **æ•°æ®ç±»å‹** |
|----------|-------------|-----------------|-------------|
| ğŸ“„ **Filebeat** | `æ—¥å¿—æ–‡ä»¶é‡‡é›†` | Webæ—¥å¿—ã€åº”ç”¨æ—¥å¿—ã€é”™è¯¯æ—¥å¿— | `æ–‡æœ¬æ—¥å¿—` |
| ğŸ“Š **Metricbeat** | `ç³»ç»ŸæŒ‡æ ‡é‡‡é›†` | CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç›‘æ§ | `æ•°å€¼æŒ‡æ ‡` |
| ğŸ–¥ï¸ **Winlogbeat** | `Windowsæ—¥å¿—` | ç³»ç»Ÿäº‹ä»¶ã€å®‰å…¨æ—¥å¿—ã€åº”ç”¨æ—¥å¿— | `äº‹ä»¶æ—¥å¿—` |
| ğŸ”’ **Auditbeat** | `å®¡è®¡æ•°æ®` | æ–‡ä»¶å˜æ›´ã€ç”¨æˆ·è¡Œä¸ºã€ç³»ç»Ÿè°ƒç”¨ | `å®¡è®¡äº‹ä»¶` |
| ğŸ’“ **Heartbeat** | `å¯ç”¨æ€§ç›‘æ§` | æœåŠ¡å¥åº·æ£€æŸ¥ã€å“åº”æ—¶é—´ç›‘æ§ | `å¥åº·çŠ¶æ€` |
| ğŸŒ **Packetbeat** | `ç½‘ç»œç›‘æ§` | ç½‘ç»œæµé‡ã€åè®®åˆ†æã€æ€§èƒ½ç›‘æ§ | `ç½‘ç»œåŒ…` |

### 1.3 ä¸ºä»€ä¹ˆè¦ç”¨Beats


**ä¼ ç»Ÿæ–¹å¼ vs Beatsæ–¹å¼ï¼š**

```
ä¼ ç»Ÿæ—¥å¿—æ”¶é›†æ–¹å¼ï¼š
åº”ç”¨ â†’ å†™å…¥æ–‡ä»¶ â†’ æ‰‹åŠ¨å¤åˆ¶ â†’ æ‰‹åŠ¨è§£æ â†’ æ‰‹åŠ¨å¯¼å…¥ â†’ Elasticsearch
é—®é¢˜ï¼šç¹çã€å®¹æ˜“å‡ºé”™ã€å®æ—¶æ€§å·®

Beatsæ–¹å¼ï¼š
åº”ç”¨ â†’ å†™å…¥æ–‡ä»¶ â†’ Filebeatè‡ªåŠ¨é‡‡é›† â†’ è‡ªåŠ¨è§£æ â†’ è‡ªåŠ¨å‘é€ â†’ Elasticsearch
ä¼˜åŠ¿ï¼šè‡ªåŠ¨åŒ–ã€å®æ—¶æ€§å¥½ã€é…ç½®ç®€å•
```

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- âœ… **è½»é‡çº§**ï¼šå ç”¨èµ„æºå°‘ï¼Œå¯¹ç³»ç»Ÿå½±å“å°
- âœ… **å¯é æ€§**ï¼šæ–­ç‚¹ç»­ä¼ ï¼Œä¸ä¸¢å¤±æ•°æ®
- âœ… **æ˜“é…ç½®**ï¼šYAMLé…ç½®æ–‡ä»¶ï¼Œç®€å•ç›´è§‚
- âœ… **å¤šæ ·åŒ–**ï¼šæ”¯æŒå„ç§æ•°æ®æºå’Œè¾“å‡ºç›®æ ‡

---

## 2. ğŸ“„ Filebeatæ—¥å¿—é‡‡é›†è¯¦è§£


### 2.1 Filebeatæ ¸å¿ƒæ¦‚å¿µ


**å·¥ä½œåŸç†ç®€è¿°**ï¼š
> Filebeatå°±åƒä¸€ä¸ªä¸“é—¨è¯»æ–‡ä»¶çš„"ç›‘è§†å™¨"ï¼Œå®ƒä¼šç›¯ç€æŒ‡å®šçš„æ–‡ä»¶ï¼Œä¸€æ—¦æœ‰æ–°å†…å®¹å°±ç«‹å³è¯»å–å¹¶å‘é€å‡ºå»

```
Filebeatå·¥ä½œæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç›‘æ§æ–‡ä»¶ â”‚ â†’ â”‚è¯»å–å†…å®¹ â”‚ â†’ â”‚å¤„ç†æ•°æ® â”‚ â†’ â”‚å‘é€æ•°æ® â”‚
â”‚(Input)  â”‚    â”‚(Harvest)â”‚    â”‚(Process)â”‚    â”‚(Output) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Šï¼š**
- **Inputï¼ˆè¾“å…¥ï¼‰**ï¼šå‘Šè¯‰Filebeatè¦ç›‘æ§å“ªäº›æ–‡ä»¶
- **Harvesterï¼ˆæ”¶å‰²æœºï¼‰**ï¼šè´Ÿè´£è¯»å–æ–‡ä»¶å†…å®¹çš„ç»„ä»¶
- **Processorï¼ˆå¤„ç†å™¨ï¼‰**ï¼šå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—å’Œè½¬æ¢
- **Outputï¼ˆè¾“å‡ºï¼‰**ï¼šå°†æ•°æ®å‘é€åˆ°ç›®æ ‡ä½ç½®

### 2.2 åŸºç¡€é…ç½®ç¤ºä¾‹


```yaml
# filebeat.yml - åŸºç¡€é…ç½®ç¤ºä¾‹
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/nginx/*.log    # ç›‘æ§nginxæ—¥å¿—
    - /var/log/app/*.log      # ç›‘æ§åº”ç”¨æ—¥å¿—
  fields:
    service: web-server       # æ·»åŠ æœåŠ¡æ ‡è¯†
  fields_under_root: true     # å­—æ®µæ”¾åœ¨æ ¹çº§åˆ«

# è¾“å‡ºåˆ°Elasticsearch
output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "web-logs-%{+yyyy.MM.dd}"

# æ—¥å¿—çº§åˆ«è®¾ç½®
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
```

**é…ç½®è¯´æ˜ï¼š**
- `paths`: æŒ‡å®šè¦ç›‘æ§çš„æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒé€šé…ç¬¦
- `fields`: ç»™æ¯æ¡æ—¥å¿—æ·»åŠ é¢å¤–å­—æ®µ
- `index`: æŒ‡å®šå­˜å‚¨åˆ°ESçš„ç´¢å¼•åç§°

### 2.3 å¤šè¡Œæ—¥å¿—å¤„ç†


**é—®é¢˜åœºæ™¯**ï¼šJavaå¼‚å¸¸å †æ ˆã€å¤šè¡Œé…ç½®æ–‡ä»¶ç­‰éœ€è¦åˆå¹¶å¤„ç†

```yaml
# å¤„ç†Javaå¼‚å¸¸å †æ ˆæ—¥å¿—
filebeat.inputs:
- type: log
  paths:
    - /var/log/java-app/*.log
  multiline.pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'  # æ—¥æœŸå¼€å¤´æ¨¡å¼
  multiline.negate: true     # ä¸åŒ¹é…çš„è¡Œ
  multiline.match: after     # è¿½åŠ åˆ°å‰ä¸€æ¡è®°å½•
  multiline.timeout: 5s      # è¶…æ—¶æ—¶é—´
```

**æ¨¡å¼è¯´æ˜ï¼š**
```
åŸå§‹æ—¥å¿—ï¼š
2023-09-20 10:00:01 ERROR Exception occurred
    at com.example.Service.method(Service.java:123)
    at com.example.Controller.handle(Controller.java:45)
2023-09-20 10:00:02 INFO Normal log message

å¤„ç†åï¼š
è®°å½•1: "2023-09-20 10:00:01 ERROR Exception occurred\n    at com.example..."
è®°å½•2: "2023-09-20 10:00:02 INFO Normal log message"
```

### 2.4 æ¨¡å—åŒ–é…ç½®


**ä½¿ç”¨å†…ç½®æ¨¡å—**ï¼šFilebeatæä¾›äº†è®¸å¤šé¢„é…ç½®çš„æ¨¡å—

```bash
# å¯ç”¨nginxæ¨¡å—
filebeat modules enable nginx

# å¯ç”¨apacheæ¨¡å—  
filebeat modules enable apache

# æŸ¥çœ‹å¯ç”¨æ¨¡å—
filebeat modules list
```

```yaml
# modules.d/nginx.yml - nginxæ¨¡å—é…ç½®
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
  error:
    enabled: true  
    var.paths: ["/var/log/nginx/error.log*"]
```

---

## 3. ğŸ“Š MetricbeatæŒ‡æ ‡é‡‡é›†ç³»ç»Ÿ


### 3.1 ç³»ç»ŸæŒ‡æ ‡ç›‘æ§


**Metricbeatçš„ä½œç”¨**ï¼š
> æŠŠMetricbeatæƒ³è±¡æˆä¸€ä¸ª"æ•°å­—ä»ªè¡¨ç›˜"ï¼Œå®ƒä¼šå®šæœŸæ£€æŸ¥æœåŠ¡å™¨çš„å„ç§çŠ¶æ€ï¼Œå°±åƒæ±½è½¦ä»ªè¡¨ç›˜æ˜¾ç¤ºé€Ÿåº¦ã€æ²¹é‡ä¸€æ ·

```yaml
# metricbeat.yml - ç³»ç»Ÿç›‘æ§é…ç½®
metricbeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: true
  reload.period: 10s

# ç³»ç»Ÿæ¨¡å—
metricbeat.modules:
- module: system
  metricsets:
    - cpu          # CPUä½¿ç”¨ç‡
    - memory       # å†…å­˜ä½¿ç”¨æƒ…å†µ  
    - disk         # ç£ç›˜ä½¿ç”¨æƒ…å†µ
    - network      # ç½‘ç»œæµé‡
    - process      # è¿›ç¨‹ä¿¡æ¯
  enabled: true
  period: 10s      # æ¯10ç§’é‡‡é›†ä¸€æ¬¡
```

**å¸¸è§ç›‘æ§æŒ‡æ ‡ï¼š**

| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§å†…å®¹** | **å…³é”®å­—æ®µ** | **å‘Šè­¦é˜ˆå€¼å»ºè®®** |
|----------|-------------|-------------|-----------------|
| ğŸ–¥ï¸ **CPU** | `ä½¿ç”¨ç‡ã€è´Ÿè½½` | cpu.user, cpu.system | `>80%` |
| ğŸ’¾ **å†…å­˜** | `ä½¿ç”¨ç‡ã€å¯ç”¨å†…å­˜` | memory.used.pct | `>85%` |
| ğŸ’¿ **ç£ç›˜** | `ä½¿ç”¨ç‡ã€IOæ€§èƒ½` | disk.used.pct, disk.io | `>90%` |
| ğŸŒ **ç½‘ç»œ** | `æµé‡ã€åŒ…æ•°ã€é”™è¯¯` | network.in.bytes | `æ ¹æ®å¸¦å®½è®¾å®š` |

### 3.2 æ•°æ®åº“ç›‘æ§


```yaml
# MySQLç›‘æ§é…ç½®
- module: mysql
  metricsets:
    - status        # æœåŠ¡å™¨çŠ¶æ€
    - performance   # æ€§èƒ½æŒ‡æ ‡
  enabled: true
  period: 30s
  hosts: ["tcp(localhost:3306)/"]
  username: metricbeat
  password: your_password
```

**ç›‘æ§æŒ‡æ ‡ç¤ºä¾‹ï¼š**
```
MySQLå…³é”®æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡æ ‡åç§°        â”‚ å­—æ®µå      â”‚ è¯´æ˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿æ¥æ•°          â”‚ connections â”‚ å½“å‰æ´»è·ƒè¿æ¥    â”‚
â”‚ æŸ¥è¯¢ç‡          â”‚ queries     â”‚ æ¯ç§’æŸ¥è¯¢æ•°      â”‚
â”‚ æ…¢æŸ¥è¯¢æ•°        â”‚ slow_queriesâ”‚ æ…¢æŸ¥è¯¢ç»Ÿè®¡      â”‚
â”‚ ç¼“å†²æ± å‘½ä¸­ç‡    â”‚ buffer_pool â”‚ InnoDBç¼“å†²æ€§èƒ½  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å®¹å™¨ç›‘æ§


```yaml
# Dockerå®¹å™¨ç›‘æ§
- module: docker
  metricsets:
    - container     # å®¹å™¨åŸºæœ¬ä¿¡æ¯
    - cpu          # å®¹å™¨CPUä½¿ç”¨
    - memory       # å®¹å™¨å†…å­˜ä½¿ç”¨
    - network      # å®¹å™¨ç½‘ç»œæµé‡
  enabled: true
  period: 15s
  hosts: ["unix:///var/run/docker.sock"]
```

---

## 4. ğŸ–¥ï¸ ç³»ç»Ÿä¸å®‰å…¨ç›‘æ§Beats


### 4.1 Winlogbeat - Windowsç³»ç»Ÿæ—¥å¿—


**åº”ç”¨åœºæ™¯**ï¼šWindowsæœåŠ¡å™¨å®‰å…¨ç›‘æ§ã€ç³»ç»Ÿäº‹ä»¶è¿½è¸ª

```yaml
# winlogbeat.yml - Windowsæ—¥å¿—é…ç½®
winlogbeat.event_logs:
  - name: System
    level: error, warning    # åªæ”¶é›†é”™è¯¯å’Œè­¦å‘Š
  - name: Security
    event_id: 4624, 4625    # ç™»å½•æˆåŠŸ/å¤±è´¥äº‹ä»¶
  - name: Application
    ignore_older: 72h       # å¿½ç•¥72å°æ—¶å‰çš„æ—¥å¿—

# æ·»åŠ ä¸»æœºä¿¡æ¯
processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
```

**å…³é”®äº‹ä»¶IDï¼š**
```
Windowså®‰å…¨äº‹ä»¶é€ŸæŸ¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹ä»¶ID  â”‚ äº‹ä»¶ç±»å‹        â”‚ å®‰å…¨æ„ä¹‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4624    â”‚ ç™»å½•æˆåŠŸ        â”‚ æ­£å¸¸ç”¨æˆ·æ´»åŠ¨        â”‚
â”‚ 4625    â”‚ ç™»å½•å¤±è´¥        â”‚ å¯èƒ½çš„æš´åŠ›ç ´è§£      â”‚
â”‚ 4648    â”‚ æ˜¾å¼å‡­æ®ç™»å½•    â”‚ æ¨ªå‘ç§»åŠ¨è¿¹è±¡        â”‚
â”‚ 4697    â”‚ æœåŠ¡å®‰è£…        â”‚ æŒä¹…åŒ–æ”»å‡»æ‰‹æ®µ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Auditbeat - ç³»ç»Ÿå®¡è®¡


**ç›‘æ§èƒ½åŠ›**ï¼šæ–‡ä»¶å®Œæ•´æ€§ã€ç”¨æˆ·æ´»åŠ¨ã€è¿›ç¨‹æ‰§è¡Œ

```yaml
# auditbeat.yml - å®¡è®¡é…ç½®
auditbeat.modules:
- module: file_integrity
  paths:
  - /bin         # ç³»ç»ŸäºŒè¿›åˆ¶æ–‡ä»¶
  - /usr/bin     # ç”¨æˆ·äºŒè¿›åˆ¶æ–‡ä»¶
  - /etc         # é…ç½®æ–‡ä»¶
  scan_at_start: true
  scan_rate_per_sec: 50 MiB

- module: auditd
  audit_rules: |
    # ç›‘æ§å…³é”®æ–‡ä»¶ä¿®æ”¹
    -w /etc/passwd -p wa -k user_modification
    -w /etc/shadow -p wa -k password_modification
    
    # ç›‘æ§ç‰¹æƒå‘½ä»¤æ‰§è¡Œ
    -a always,exit -F arch=b64 -S execve -F uid=0 -k root_commands
```

**æ–‡ä»¶å®Œæ•´æ€§ç›‘æ§ç¤ºä¾‹ï¼š**
```
ç›‘æ§äº‹ä»¶ç¤ºä¾‹ï¼š
{
  "event": {
    "action": "updated",
    "category": "file"
  },
  "file": {
    "path": "/etc/passwd",
    "hash": {
      "sha256": "abc123..."
    }
  },
  "user": {
    "name": "root"
  }
}
```

---

## 5. ğŸŒ ç½‘ç»œä¸å¯ç”¨æ€§ç›‘æ§


### 5.1 Heartbeat - æœåŠ¡å¯ç”¨æ€§ç›‘æ§


**ä½œç”¨è¯´æ˜**ï¼š
> Heartbeatå°±åƒåŒ»ç”Ÿå¬å¿ƒè·³ä¸€æ ·ï¼Œå®šæœŸæ£€æŸ¥ä½ çš„æœåŠ¡æ˜¯å¦"å¥åº·"

```yaml
# heartbeat.yml - å¯ç”¨æ€§ç›‘æ§é…ç½®
heartbeat.monitors:
# HTTPæœåŠ¡ç›‘æ§
- type: http
  name: "Web Service"
  urls: ["http://localhost:8080/health"]
  schedule: '@every 30s'        # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
  timeout: 10s
  check.response.status: 200    # æœŸæœ›çŠ¶æ€ç 

# TCPç«¯å£ç›‘æ§  
- type: tcp
  name: "Database Connection"
  hosts: ["localhost:3306"]
  schedule: '@every 60s'

# ICMP pingç›‘æ§
- type: icmp
  name: "Server Ping"
  hosts: ["192.168.1.100"]
  schedule: '@every 15s'
```

**ç›‘æ§ç»“æœç¤ºä¾‹ï¼š**
```
å¥åº·æ£€æŸ¥ç»“æœï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡åç§°     â”‚ çŠ¶æ€       â”‚ å“åº”æ—¶é—´    â”‚ æœ€åæ£€æŸ¥æ—¶é—´ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web Service  â”‚ UP âœ…      â”‚ 45ms        â”‚ 10:30:15     â”‚
â”‚ Database     â”‚ DOWN âŒ    â”‚ timeout     â”‚ 10:30:10     â”‚
â”‚ Server Ping  â”‚ UP âœ…      â”‚ 12ms        â”‚ 10:30:20     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Packetbeat - ç½‘ç»œæµé‡ç›‘æ§


**ç›‘æ§åè®®**ï¼šHTTPã€MySQLã€Redisã€DNSç­‰

```yaml
# packetbeat.yml - ç½‘ç»œç›‘æ§é…ç½®
packetbeat.interfaces.device: any

packetbeat.protocols:
  http:
    ports: [80, 8080, 8000, 5000, 8002]
    real_ip_header: "X-Forwarded-For"
    
  mysql:
    ports: [3306]
    
  redis:
    ports: [6379]
```

**ç½‘ç»œåˆ†æèƒ½åŠ›ï¼š**
```
HTTPè¯·æ±‚åˆ†æï¼š
è¯·æ±‚ â†’ [Packetbeatæ•è·] â†’ åˆ†æç»“æœ
â”‚
â”œâ”€ è¯·æ±‚æ–¹æ³•: GET/POST
â”œâ”€ å“åº”çŠ¶æ€: 200/404/500  
â”œâ”€ å“åº”æ—¶é—´: 100ms
â”œâ”€ è¯·æ±‚å¤§å°: 1.2KB
â””â”€ å“åº”å¤§å°: 5.4KB
```

---

## 6. âš™ï¸ Beatsæ ¸å¿ƒé…ç½®ç®¡ç†


### 6.1 è¾“å‡ºé…ç½®è¯¦è§£


**Elasticsearchè¾“å‡º**ï¼š
```yaml
output.elasticsearch:
  hosts: ["es1:9200", "es2:9200", "es3:9200"]
  
  # ç´¢å¼•é…ç½®
  index: "logs-%{[agent.version]}-%{+yyyy.MM.dd}"
  
  # è®¤è¯é…ç½®
  username: "elastic"
  password: "changeme"
  
  # æ€§èƒ½ä¼˜åŒ–
  bulk_max_size: 1000      # æ‰¹é‡å¤§å°
  flush_timeout: 30s       # åˆ·æ–°è¶…æ—¶
  worker: 2                # å·¥ä½œçº¿ç¨‹æ•°
  
  # é‡è¯•é…ç½®
  max_retries: 3
  backoff.init: 1s
  backoff.max: 60s
```

**Logstashè¾“å‡º**ï¼š
```yaml
output.logstash:
  hosts: ["logstash1:5044", "logstash2:5044"]
  loadbalance: true        # è´Ÿè½½å‡è¡¡
  compression_level: 3     # å‹ç¼©çº§åˆ«
```

### 6.2 å¤„ç†å™¨é…ç½®


**å¸¸ç”¨å¤„ç†å™¨**ï¼š
```yaml
processors:
  # æ·»åŠ ä¸»æœºä¿¡æ¯
  - add_host_metadata:
      when.not.contains.tags: forwarded

  # ä¸¢å¼ƒå­—æ®µ
  - drop_fields:
      fields: ["agent.ephemeral_id", "agent.hostname"]

  # æ·»åŠ æ ‡ç­¾
  - add_tags:
      tags: [production, web-server]
      when.contains:
        service: nginx

  # å­—æ®µé‡å‘½å
  - rename:
      fields:
        - from: "message"
          to: "log_message"
```

### 6.3 æ¨¡æ¿ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†


```yaml
# ç´¢å¼•æ¨¡æ¿é…ç½®
setup.template.settings:
  index.number_of_shards: 1
  index.number_of_replicas: 1
  index.refresh_interval: 30s

# ILMç­–ç•¥
setup.ilm.enabled: true
setup.ilm.policy: "beats-default-policy"
setup.ilm.rollover_alias: "beats-logs"
```

---

## 7. ğŸ”§ æ•°æ®å¤„ç†ä¸å­—æ®µç®¡ç†


### 7.1 æ—¥å¿—è§£æä¸å­—æ®µæå–


**Grokæ¨¡å¼è§£æ**ï¼š
```yaml
# åœ¨Filebeatä¸­ä½¿ç”¨å†…ç½®è§£æ
filebeat.inputs:
- type: log
  paths:
    - /var/log/nginx/access.log
  processors:
    - dissect:
        tokenizer: '%{client_ip} - %{user} [%{timestamp}] "%{method} %{url} %{protocol}" %{status} %{bytes}'
        field: "message"
```

**JSONæ—¥å¿—å¤„ç†**ï¼š
```yaml
processors:
  - decode_json_fields:
      fields: ["message"]
      target: ""
      overwrite_keys: true
```

### 7.2 å­—æ®µæ˜ å°„ä¸æ¸…ç†


```yaml
processors:
  # ç±»å‹è½¬æ¢
  - convert:
      fields:
        - {from: "status", to: "status_code", type: "integer"}
        - {from: "bytes", to: "response_size", type: "long"}
  
  # æ—¶é—´æˆ³è§£æ
  - timestamp:
      field: "timestamp"
      layouts:
        - '2006-01-02T15:04:05.000Z'
        - '02/Jan/2006:15:04:05 -0700'
      test:
        - '2023-09-20T10:30:45.123Z'
```

### 7.3 æ¡ä»¶å¤„ç†ä¸è·¯ç”±


```yaml
processors:
  # æ¡ä»¶åˆ é™¤
  - drop_event:
      when.regexp:
        message: '^DEBUG'
  
  # æ¡ä»¶æ·»åŠ å­—æ®µ
  - add_fields:
      target: alert
      fields:
        level: critical
      when.regexp:
        message: 'ERROR|FATAL'
```

---

## 8. ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç­–ç•¥


### 8.1 æ€§èƒ½ä¼˜åŒ–é…ç½®


**èµ„æºé…ç½®å»ºè®®**ï¼š
```yaml
# é˜Ÿåˆ—é…ç½®
queue.mem:
  events: 4096
  flush.min_events: 512
  flush.timeout: 5s

# è¾“å‡ºç¼“å†²
output.elasticsearch:
  bulk_max_size: 1000
  flush_timeout: 30s
  worker: 2
```

**ç³»ç»Ÿèµ„æºå»ºè®®**ï¼š
```
æ€§èƒ½è°ƒä¼˜å‚æ•°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨è§„æ¨¡  â”‚ CPUæ ¸å¿ƒ     â”‚ å†…å­˜        â”‚ ç½‘ç»œå¸¦å®½    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å°å‹ç¯å¢ƒ    â”‚ 2æ ¸         â”‚ 2GB         â”‚ 100Mbps     â”‚
â”‚ ä¸­å‹ç¯å¢ƒ    â”‚ 4æ ¸         â”‚ 4GB         â”‚ 1Gbps       â”‚
â”‚ å¤§å‹ç¯å¢ƒ    â”‚ 8æ ¸+        â”‚ 8GB+        â”‚ 10Gbps      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 é›†ç¾¤éƒ¨ç½²æ¶æ„


```
ç”Ÿäº§ç¯å¢ƒæ¶æ„ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Server1 â”‚  â”‚ Web Server2 â”‚  â”‚ Web Server3 â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Filebeat â”‚ â”‚  â”‚ â”‚Filebeat â”‚ â”‚  â”‚ â”‚Filebeat â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Load Balancer    â”‚
              â”‚   (Logstashé›†ç¾¤)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Elasticsearch     â”‚
              â”‚     é›†ç¾¤           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 ç›‘æ§ä¸å‘Šè­¦


**ç›‘æ§é…ç½®**ï¼š
```yaml
# å¯ç”¨ç›‘æ§
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["monitoring-es:9200"]

# æ€§èƒ½æŒ‡æ ‡
http.enabled: true
http.host: localhost
http.port: 5066
```

**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
- âœ… **æ•°æ®å¤„ç†ç‡**ï¼ševents/second
- âœ… **é”™è¯¯ç‡**ï¼šfailed events percentage  
- âœ… **å»¶è¿Ÿ**ï¼šprocessing latency
- âœ… **èµ„æºä½¿ç”¨**ï¼šCPUã€å†…å­˜ä½¿ç”¨ç‡

### 8.4 æ•…éšœå¤„ç†ä¸æ¢å¤


**èƒŒå‹æ§åˆ¶**ï¼š
```yaml
# å½“è¾“å‡ºé˜»å¡æ—¶çš„å¤„ç†
output.elasticsearch:
  backoff.init: 1s
  backoff.max: 60s
  max_retries: 3
  
# é˜Ÿåˆ—æ»¡æ—¶çš„å¤„ç†ç­–ç•¥
queue.mem:
  events: 4096
  flush.min_events: 512
```

**çŠ¶æ€æŒä¹…åŒ–**ï¼š
```yaml
# ä¿å­˜å¤„ç†çŠ¶æ€
filebeat.registry.path: "/var/lib/filebeat"
filebeat.registry.file_permissions: 0600
filebeat.registry.flush: 0s
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ¯ Beatsæ ¸å¿ƒç†å¿µï¼š
â€¢ è½»é‡çº§æ•°æ®é‡‡é›†å™¨ï¼Œä¸“é—¨è´Ÿè´£æ”¶é›†å„ç§ç±»å‹çš„æ•°æ®
â€¢ æ¯ç§Beatéƒ½æœ‰ç‰¹å®šç”¨é€”ï¼Œé€‰æ‹©åˆé€‚çš„Beatå¾ˆé‡è¦
â€¢ é…ç½®ç®€å•ä½†åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆå¤§è§„æ¨¡éƒ¨ç½²

ğŸ”§ å…³é”®ç»„ä»¶ï¼š
â€¢ Inputï¼šæ•°æ®æ¥æºé…ç½®
â€¢ Processorï¼šæ•°æ®å¤„ç†å’Œè½¬æ¢
â€¢ Outputï¼šæ•°æ®è¾“å‡ºç›®æ ‡
â€¢ Moduleï¼šé¢„é…ç½®çš„é‡‡é›†æ¨¡å—
```

### 9.2 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‰æ‹©Beatçš„åŸåˆ™**ï¼š
```
æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©ï¼š
ğŸ“„ æ—¥å¿—æ–‡ä»¶ â†’ Filebeat
ğŸ“Š ç³»ç»ŸæŒ‡æ ‡ â†’ Metricbeat  
ğŸ–¥ï¸ Windowsäº‹ä»¶ â†’ Winlogbeat
ğŸ”’ å®‰å…¨å®¡è®¡ â†’ Auditbeat
ğŸ’“ æœåŠ¡ç›‘æ§ â†’ Heartbeat
ğŸŒ ç½‘ç»œæµé‡ â†’ Packetbeat
```

**é…ç½®ä¼˜å…ˆçº§**ï¼š
```
â‘  å…ˆç¡®å®šæ•°æ®æºå’Œç›®æ ‡
â‘¡ é…ç½®åŸºæœ¬çš„è¾“å…¥è¾“å‡º
â‘¢ æ·»åŠ å¿…è¦çš„å¤„ç†å™¨
â‘£ ä¼˜åŒ–æ€§èƒ½å‚æ•°
â‘¤ è®¾ç½®ç›‘æ§å’Œå‘Šè­¦
```

### 9.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**éƒ¨ç½²å»ºè®®**ï¼š
- âœ… **åˆ†ç¯å¢ƒé…ç½®**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ä½¿ç”¨ä¸åŒé…ç½®
- âœ… **èµ„æºè§„åˆ’**ï¼šæ ¹æ®æ•°æ®é‡åˆç†åˆ†é…CPUå’Œå†…å­˜
- âœ… **ç½‘ç»œä¼˜åŒ–**ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å’Œè¿æ¥å¤ç”¨
- âœ… **å®‰å…¨é…ç½®**ï¼šå¯ç”¨è®¤è¯å’ŒåŠ å¯†ä¼ è¾“

**è¿ç»´è¦ç‚¹**ï¼š
- ğŸ” **ç›‘æ§å…³é”®æŒ‡æ ‡**ï¼šå¤„ç†é€Ÿç‡ã€é”™è¯¯ç‡ã€èµ„æºä½¿ç”¨
- ğŸ“ **æ—¥å¿—ç®¡ç†**ï¼šåˆç†è®¾ç½®æ—¥å¿—çº§åˆ«å’Œè½®è½¬ç­–ç•¥  
- ğŸš¨ **å‘Šè­¦é…ç½®**ï¼šè®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- ğŸ”„ **ç‰ˆæœ¬ç®¡ç†**ï¼šå®šæœŸæ›´æ–°ä½†è¦åšå¥½å…¼å®¹æ€§æµ‹è¯•

### 9.4 å¸¸è§é—®é¢˜è§£å†³


**æ€§èƒ½é—®é¢˜**ï¼š
```
é—®é¢˜ï¼šæ•°æ®å¤„ç†å¤ªæ…¢
è§£å†³ï¼š
â€¢ å¢åŠ workeræ•°é‡
â€¢ è°ƒæ•´bulk_max_size
â€¢ ä¼˜åŒ–ç½‘ç»œé…ç½®
â€¢ æ£€æŸ¥Elasticsearchæ€§èƒ½
```

**æ•°æ®ä¸¢å¤±**ï¼š
```
é—®é¢˜ï¼šæ•°æ®é‡‡é›†æœ‰é—æ¼
è§£å†³ï¼š
â€¢ æ£€æŸ¥registryæ–‡ä»¶æƒé™
â€¢ ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®
â€¢ è°ƒæ•´é˜Ÿåˆ—å¤§å°
â€¢ å¯ç”¨çŠ¶æ€æŒä¹…åŒ–
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Beatsæ˜¯Elasticsearchç”Ÿæ€çš„æ•°æ®é‡‡é›†åˆ©å™¨
- æ¯ç§Beatéƒ½æœ‰ç‰¹å®šç”¨é€”ï¼Œé€‰å¯¹å·¥å…·å¾ˆé‡è¦
- é…ç½®ç®€å•ä½†è¦æ³¨æ„æ€§èƒ½è°ƒä¼˜
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¦è€ƒè™‘é«˜å¯ç”¨å’Œç›‘æ§