---
title: 3ã€ä¸­æ–‡æœç´¢ä¸åˆ†è¯ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [ä¸­æ–‡æœç´¢çš„æŒ‘æˆ˜ä¸éš¾ç‚¹](#1-ä¸­æ–‡æœç´¢çš„æŒ‘æˆ˜ä¸éš¾ç‚¹)
2. [IKåˆ†æå™¨å®‰è£…ä¸åŸºç¡€é…ç½®](#2-IKåˆ†æå™¨å®‰è£…ä¸åŸºç¡€é…ç½®)
3. [æ™ºèƒ½åˆ†è¯ä¸æœ€ç»†ç²’åº¦åˆ†è¯](#3-æ™ºèƒ½åˆ†è¯ä¸æœ€ç»†ç²’åº¦åˆ†è¯)
4. [è‡ªå®šä¹‰è¯å…¸ä¸åœç”¨è¯é…ç½®](#4-è‡ªå®šä¹‰è¯å…¸ä¸åœç”¨è¯é…ç½®)
5. [åŒä¹‰è¯å¤„ç†ä¸ç¹ç®€ä½“è½¬æ¢](#5-åŒä¹‰è¯å¤„ç†ä¸ç¹ç®€ä½“è½¬æ¢)
6. [æ‹¼éŸ³æœç´¢æ”¯æŒ](#6-æ‹¼éŸ³æœç´¢æ”¯æŒ)
7. [ä¸­æ–‡æœç´¢ä¼˜åŒ–ç­–ç•¥](#7-ä¸­æ–‡æœç´¢ä¼˜åŒ–ç­–ç•¥)
8. [æœç´¢å»ºè®®ä¸è‡ªåŠ¨è¡¥å…¨](#8-æœç´¢å»ºè®®ä¸è‡ªåŠ¨è¡¥å…¨)
9. [ä¸­æ–‡ç›¸å…³æ€§è°ƒä¼˜](#9-ä¸­æ–‡ç›¸å…³æ€§è°ƒä¼˜)
10. [æ€§èƒ½å¯¹æ¯”ä¸è¯å…¸çƒ­æ›´æ–°](#10-æ€§èƒ½å¯¹æ¯”ä¸è¯å…¸çƒ­æ›´æ–°)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä¸­æ–‡æœç´¢çš„æŒ‘æˆ˜ä¸éš¾ç‚¹


### 1.1 ä¸­æ–‡æœç´¢ä¸ºä»€ä¹ˆå›°éš¾


**ğŸ”¸ ä¸è‹±æ–‡æœç´¢çš„æ ¹æœ¬å·®å¼‚**
```
è‹±æ–‡æœç´¢ï¼š
Hello World  â†’  ["Hello", "World"]  (å¤©ç„¶æœ‰ç©ºæ ¼åˆ†éš”)

ä¸­æ–‡æœç´¢ï¼š
ä¸­åäººæ°‘å…±å’Œå›½  â†’  ???  (æ²¡æœ‰å¤©ç„¶åˆ†éš”ç¬¦)
å¯èƒ½åˆ†ä¸ºï¼š["ä¸­å", "äººæ°‘", "å…±å’Œå›½"]
ä¹Ÿå¯èƒ½ï¼š["ä¸­åäººæ°‘å…±å’Œå›½"] 
æˆ–è€…ï¼š["ä¸­", "å", "äºº", "æ°‘", "å…±", "å’Œ", "å›½"]
```

**ğŸ¤” ä¸­æ–‡åˆ†è¯çš„æ ¸å¿ƒæŒ‘æˆ˜**

| æŒ‘æˆ˜ç±»å‹ | **å…·ä½“é—®é¢˜** | **ç¤ºä¾‹** |
|---------|------------|---------|
| ğŸ§© **æ­§ä¹‰åˆ†è¯** | `åŒä¸€å¥è¯æœ‰å¤šç§åˆ†è¯æ–¹å¼` | `"å—äº¬å¸‚é•¿æ±Ÿå¤§æ¡¥"` å¯åˆ†ä¸º `"å—äº¬å¸‚/é•¿æ±Ÿå¤§æ¡¥"` æˆ– `"å—äº¬/å¸‚é•¿/æ±Ÿå¤§æ¡¥"` |
| ğŸ†• **æ–°è¯è¯†åˆ«** | `ç½‘ç»œæµè¡Œè¯­ã€ä¸“ä¸šæœ¯è¯­` | `"æ‰“å·¥äºº"ã€"å†…å·"ã€"å…ƒå®‡å®™"` ç­‰æ–°è¯ |
| ğŸ·ï¸ **ä¸“åè¯†åˆ«** | `äººåã€åœ°åã€æœºæ„å` | `"ç‹å°æ˜åœ¨åŒ—äº¬å¤§å­¦å­¦ä¹ "` éœ€è¦æ­£ç¡®è¯†åˆ«äººåå’Œæœºæ„å |
| ğŸ”¤ **è‹±æ–‡æ··åˆ** | `ä¸­è‹±æ–‡æ··åˆæ–‡æœ¬` | `"æˆ‘ç”¨iPhoneå‘å¾®ä¿¡"` ä¸­çš„è‹±æ–‡å¤„ç† |

### 1.2 Elasticsearché»˜è®¤åˆ†æå™¨çš„é—®é¢˜


**é»˜è®¤standardåˆ†æå™¨å¤„ç†ä¸­æ–‡çš„æ•ˆæœï¼š**
```json
POST _analyze
{
  "analyzer": "standard",
  "text": "æˆ‘çˆ±ä¸­åäººæ°‘å…±å’Œå›½"
}

ç»“æœï¼š["æˆ‘", "çˆ±", "ä¸­", "å", "äºº", "æ°‘", "å…±", "å’Œ", "å›½"]
```

> ğŸ’¡ **é—®é¢˜è¯´æ˜**ï¼šé»˜è®¤åˆ†æå™¨æŠŠæ¯ä¸ªä¸­æ–‡å­—ç¬¦éƒ½å•ç‹¬åˆ†å¼€äº†ï¼Œè¿™æ ·æœç´¢ `"ä¸­å"` å°±æœä¸åˆ°åŒ…å« `"ä¸­åäººæ°‘å…±å’Œå›½"` çš„æ–‡æ¡£ï¼Œå› ä¸ºç´¢å¼•é‡Œåªæœ‰å•ä¸ªå­—ç¬¦ã€‚

---

## 2. ğŸ”§ IKåˆ†æå™¨å®‰è£…ä¸åŸºç¡€é…ç½®


### 2.1 ä»€ä¹ˆæ˜¯IKåˆ†æå™¨


**ğŸ”¸ IKåˆ†æå™¨ç®€ä»‹**
```
IK Analysisæ˜¯ä¸“é—¨ä¸ºElasticsearchè®¾è®¡çš„ä¸­æ–‡åˆ†è¯æ’ä»¶
- åŸºäºJavaå¼€å‘ï¼Œæ€§èƒ½ä¼˜ç§€
- æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰è¯å…¸
- æä¾›ä¸¤ç§åˆ†è¯æ¨¡å¼
- æŒç»­ç»´æŠ¤æ›´æ–°ï¼Œå…¼å®¹æ€§å¥½
```

### 2.2 å®‰è£…IKåˆ†æå™¨


**æ­¥éª¤1ï¼šä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„IKæ’ä»¶**
```bash
# ç¡®è®¤Elasticsearchç‰ˆæœ¬
curl http://localhost:9200

# ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„IKæ’ä»¶ï¼ˆç‰ˆæœ¬å·è¦åŒ¹é…ï¼‰
# ä¾‹å¦‚ES 7.15.0å¯¹åº”ik 7.15.0
wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.15.0/elasticsearch-analysis-ik-7.15.0.zip
```

**æ­¥éª¤2ï¼šå®‰è£…æ’ä»¶**
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨elasticsearch-pluginå‘½ä»¤å®‰è£…
bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.15.0/elasticsearch-analysis-ik-7.15.0.zip

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å®‰è£…
# åœ¨pluginsç›®å½•ä¸‹åˆ›å»ºikæ–‡ä»¶å¤¹ï¼Œè§£å‹æ’ä»¶åˆ°è¯¥ç›®å½•
mkdir plugins/ik
unzip elasticsearch-analysis-ik-7.15.0.zip -d plugins/ik/
```

**æ­¥éª¤3ï¼šé‡å¯Elasticsearch**
```bash
# é‡å¯ESæœåŠ¡
systemctl restart elasticsearch

# éªŒè¯æ’ä»¶å®‰è£…æˆåŠŸ
curl http://localhost:9200/_cat/plugins
```

### 2.3 éªŒè¯å®‰è£…æ•ˆæœ


**æµ‹è¯•IKåˆ†æå™¨æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š**
```json
POST _analyze
{
  "analyzer": "ik_smart",
  "text": "æˆ‘çˆ±ä¸­åäººæ°‘å…±å’Œå›½"
}

é¢„æœŸç»“æœï¼š["æˆ‘", "çˆ±", "ä¸­åäººæ°‘å…±å’Œå›½"]
```

> âœ… **å®‰è£…æˆåŠŸæ ‡å¿—**ï¼šå¦‚æœèƒ½çœ‹åˆ° `"ä¸­åäººæ°‘å…±å’Œå›½"` ä½œä¸ºä¸€ä¸ªå®Œæ•´è¯è¢«è¯†åˆ«å‡ºæ¥ï¼Œè¯´æ˜IKåˆ†æå™¨å®‰è£…æˆåŠŸã€‚

---

## 3. âš¡ æ™ºèƒ½åˆ†è¯ä¸æœ€ç»†ç²’åº¦åˆ†è¯


### 3.1 ä¸¤ç§åˆ†è¯æ¨¡å¼çš„åŒºåˆ«


**ğŸ”¸ ik_smartï¼ˆæ™ºèƒ½åˆ†è¯ï¼‰**
```
ç‰¹ç‚¹ï¼šç²—ç²’åº¦åˆ†è¯ï¼Œè¯æ±‡é‡é€‚ä¸­
åŸç†ï¼šå°½é‡ç”¨æ›´é•¿çš„è¯æ±‡ï¼Œé¿å…è¿‡åº¦åˆ‡åˆ†
é€‚ç”¨ï¼šæœç´¢åœºæ™¯ï¼Œæé«˜æœç´¢ç²¾åº¦
```

**ğŸ”¸ ik_max_wordï¼ˆæœ€ç»†ç²’åº¦åˆ†è¯ï¼‰**
```
ç‰¹ç‚¹ï¼šç»†ç²’åº¦åˆ†è¯ï¼Œè¯æ±‡é‡æœ€å¤§
åŸç†ï¼šå°†æ–‡æœ¬æŒ‰ç…§æœ€ç»†ç²’åº¦è¿›è¡Œåˆ‡åˆ†
é€‚ç”¨ï¼šç´¢å¼•åœºæ™¯ï¼Œæé«˜æœç´¢å¬å›ç‡
```

### 3.2 å®é™…å¯¹æ¯”æ•ˆæœ


**æµ‹è¯•æ–‡æœ¬ï¼š`"åŒ—äº¬å¤§å­¦ç”Ÿç‰©æŠ€æœ¯ç ”ç©¶æ‰€"`**

```json
# æ™ºèƒ½åˆ†è¯æµ‹è¯•
POST _analyze
{
  "analyzer": "ik_smart",
  "text": "åŒ—äº¬å¤§å­¦ç”Ÿç‰©æŠ€æœ¯ç ”ç©¶æ‰€"
}

ç»“æœï¼š["åŒ—äº¬å¤§å­¦", "ç”Ÿç‰©æŠ€æœ¯", "ç ”ç©¶æ‰€"]
```

```json
# æœ€ç»†ç²’åº¦åˆ†è¯æµ‹è¯•
POST _analyze
{
  "analyzer": "ik_max_word", 
  "text": "åŒ—äº¬å¤§å­¦ç”Ÿç‰©æŠ€æœ¯ç ”ç©¶æ‰€"
}

ç»“æœï¼š["åŒ—äº¬å¤§å­¦", "åŒ—äº¬", "å¤§å­¦", "ç”Ÿç‰©æŠ€æœ¯", "ç”Ÿç‰©", "æŠ€æœ¯", "ç ”ç©¶æ‰€", "ç ”ç©¶", "æ‰€"]
```

**ğŸ“Š ä¸¤ç§æ¨¡å¼å¯¹æ¯”è¡¨**

| å¯¹æ¯”ç»´åº¦ | **ik_smart** | **ik_max_word** |
|---------|-------------|----------------|
| ğŸ¯ **è¯æ±‡æ•°é‡** | `è¾ƒå°‘ï¼Œç²—ç²’åº¦` | `è¾ƒå¤šï¼Œç»†ç²’åº¦` |
| ğŸ” **æœç´¢ç²¾åº¦** | `é«˜ï¼Œé¿å…å™ªéŸ³` | `ä¸­ç­‰ï¼Œå¯èƒ½æœ‰å™ªéŸ³` |
| ğŸ“ˆ **æœç´¢å¬å›** | `ä¸­ç­‰` | `é«˜ï¼Œè¦†ç›–æ›´å¤šå¯èƒ½æ€§` |
| âš¡ **æ€§èƒ½** | `è¾ƒå¿«` | `è¾ƒæ…¢` |
| ğŸª **é€‚ç”¨åœºæ™¯** | `æœç´¢æŸ¥è¯¢` | `æ–‡æ¡£ç´¢å¼•` |

### 3.3 å¦‚ä½•é€‰æ‹©åˆ†è¯æ¨¡å¼


**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
ç´¢å¼•æ—¶ä½¿ç”¨ï¼šik_max_word
- ç›®çš„ï¼šæœ€å¤§åŒ–è¯æ±‡è¦†ç›–ï¼Œæé«˜å¬å›ç‡
- ç”¨æˆ·å¯èƒ½ç”¨å„ç§æ–¹å¼æœç´¢åŒä¸€ä¸ªæ¦‚å¿µ

æŸ¥è¯¢æ—¶ä½¿ç”¨ï¼šik_smart  
- ç›®çš„ï¼šå‡å°‘æ­§ä¹‰ï¼Œæé«˜ç²¾åº¦
- é¿å…è¿‡åº¦åˆ‡åˆ†å¯¼è‡´çš„æ— å…³ç»“æœ
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```json
PUT my_index
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",     // ç´¢å¼•æ—¶ç”¨æœ€ç»†ç²’åº¦
        "search_analyzer": "ik_smart" // æœç´¢æ—¶ç”¨æ™ºèƒ½åˆ†è¯
      }
    }
  }
}
```

---

## 4. ğŸ“š è‡ªå®šä¹‰è¯å…¸ä¸åœç”¨è¯é…ç½®


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰è¯å…¸


**ğŸ”¸ ä¸šåŠ¡ç‰¹å®šè¯æ±‡éœ€æ±‚**
```
ç”µå•†åœºæ™¯ï¼š
- å•†å“åç§°ï¼š"iPhone13ProMax"
- å“ç‰Œè¯æ±‡ï¼š"å°ç±³"ã€"åä¸º"

åŒ»ç–—åœºæ™¯ï¼š  
- è¯å“åç§°ï¼š"é˜¿è«è¥¿æ—èƒ¶å›Š"
- ç–¾ç—…åç§°ï¼š"æ–°å† è‚ºç‚"

æŠ€æœ¯åœºæ™¯ï¼š
- ä¸“ä¸šæœ¯è¯­ï¼š"Elasticsearch"ã€"æœºå™¨å­¦ä¹ "
```

### 4.2 é…ç½®è‡ªå®šä¹‰è¯å…¸


**æ­¥éª¤1ï¼šåˆ›å»ºè‡ªå®šä¹‰è¯å…¸æ–‡ä»¶**
```bash
# åœ¨IKæ’ä»¶configç›®å½•ä¸‹åˆ›å»ºè¯å…¸æ–‡ä»¶
cd plugins/ik/config
echo "åä¸ºæ‰‹æœº" >> my_dict.dic
echo "å°ç±³ç§‘æŠ€" >> my_dict.dic
echo "äººå·¥æ™ºèƒ½" >> my_dict.dic
```

**æ­¥éª¤2ï¼šä¿®æ”¹IKé…ç½®æ–‡ä»¶**
```xml
<!-- ç¼–è¾‘ plugins/ik/config/IKAnalyzer.cfg.xml -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>IK Analyzer æ‰©å±•é…ç½®</comment>
    
    <!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ -->
    <entry key="ext_dict">my_dict.dic</entry>
    
    <!-- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸ -->
    <entry key="ext_stopwords">my_stopword.dic</entry>
</properties>
```

**æ­¥éª¤3ï¼šé‡å¯ElasticsearchéªŒè¯**
```json
POST _analyze
{
  "analyzer": "ik_smart",
  "text": "æˆ‘ä¹°äº†åä¸ºæ‰‹æœº"
}

æœŸæœ›ç»“æœï¼š["æˆ‘", "ä¹°", "äº†", "åä¸ºæ‰‹æœº"]
```

### 4.3 åœç”¨è¯é…ç½®


**ğŸ”¸ ä»€ä¹ˆæ˜¯åœç”¨è¯**
```
åœç”¨è¯æ˜¯æŒ‡åœ¨æœç´¢ä¸­åº”è¯¥è¢«å¿½ç•¥çš„è¯æ±‡ï¼š
- å¸¸è§çš„ï¼šçš„ã€äº†ã€åœ¨ã€æ˜¯ã€æœ‰ã€å’Œ
- ä¸šåŠ¡ç›¸å…³çš„ï¼šæ ¹æ®å…·ä½“åœºæ™¯å®šä¹‰
```

**åˆ›å»ºåœç”¨è¯æ–‡ä»¶ï¼š**
```bash
# åˆ›å»ºåœç”¨è¯å…¸
echo "çš„" >> my_stopword.dic
echo "äº†" >> my_stopword.dic  
echo "åœ¨" >> my_stopword.dic
echo "æ˜¯" >> my_stopword.dic
```

**éªŒè¯åœç”¨è¯æ•ˆæœï¼š**
```json
POST _analyze
{
  "analyzer": "ik_smart",
  "text": "æˆ‘åœ¨åŒ—äº¬çš„å®¶é‡Œ"
}

é…ç½®å‰ï¼š["æˆ‘", "åœ¨", "åŒ—äº¬", "çš„", "å®¶é‡Œ"]
é…ç½®åï¼š["æˆ‘", "åŒ—äº¬", "å®¶é‡Œ"]
```

> ğŸ’¡ **ä½¿ç”¨å»ºè®®**ï¼šåœç”¨è¯è¦è°¨æ…é…ç½®ï¼Œè¿‡å¤šçš„åœç”¨è¯å¯èƒ½å½±å“æœç´¢æ•ˆæœã€‚å»ºè®®ä»å¸¸è§çš„è¯­æ³•è¯å¼€å§‹ï¼Œé€æ­¥ä¼˜åŒ–ã€‚

### 4.4 è¯å…¸çƒ­æ›´æ–°


**è¿œç¨‹è¯å…¸é…ç½®ï¼ˆæ¨èï¼‰ï¼š**
```xml
<!-- æ”¯æŒHTTPæ–¹å¼åŠ¨æ€åŠ è½½è¯å…¸ -->
<entry key="remote_ext_dict">http://your-server/custom_dict.txt</entry>
<entry key="remote_ext_stopwords">http://your-server/stopwords.txt</entry>
```

**çƒ­æ›´æ–°çš„ä¼˜åŠ¿ï¼š**
- ğŸ”„ æ— éœ€é‡å¯ESæœåŠ¡
- ğŸš€ è¯å…¸æ›´æ–°ç«‹å³ç”Ÿæ•ˆ  
- ğŸ“± æ”¯æŒå¤šèŠ‚ç‚¹åŒæ­¥æ›´æ–°
- ğŸ¯ é€‚åˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨

---

## 5. ğŸ”„ åŒä¹‰è¯å¤„ç†ä¸ç¹ç®€ä½“è½¬æ¢


### 5.1 åŒä¹‰è¯å¤„ç†


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦åŒä¹‰è¯**
```
ç”¨æˆ·æœç´¢ä¹ æƒ¯ä¸åŒï¼š
- "æ‰‹æœº" â‰ˆ "ç”µè¯" â‰ˆ "ç§»åŠ¨ç”µè¯"
- "æ±½è½¦" â‰ˆ "è½¦è¾†" â‰ˆ "è½¿è½¦"  
- "åŒ—äº¬" â‰ˆ "å¸éƒ½"
```

**é…ç½®åŒä¹‰è¯åˆ†æå™¨ï¼š**
```json
PUT my_index
{
  "settings": {
    "analysis": {
      "filter": {
        "my_synonym": {
          "type": "synonym",
          "synonyms": [
            "æ‰‹æœº,ç”µè¯,ç§»åŠ¨ç”µè¯",
            "æ±½è½¦,è½¦è¾†,è½¿è½¦",
            "åŒ—äº¬,å¸éƒ½"
          ]
        }
      },
      "analyzer": {
        "my_ik_synonym": {
          "tokenizer": "ik_smart",
          "filter": ["my_synonym"]
        }
      }
    }
  }
}
```

**æµ‹è¯•åŒä¹‰è¯æ•ˆæœï¼š**
```json
POST my_index/_analyze
{
  "analyzer": "my_ik_synonym",
  "text": "æˆ‘è¦ä¹°æ‰‹æœº"
}

ç»“æœï¼š["æˆ‘", "è¦", "ä¹°", "æ‰‹æœº", "ç”µè¯", "ç§»åŠ¨ç”µè¯"]
```

### 5.2 ç¹ç®€ä½“è½¬æ¢


**ä½¿ç”¨ICUæ’ä»¶å¤„ç†ç¹ç®€ä½“ï¼š**
```bash
# å®‰è£…ICUæ’ä»¶
bin/elasticsearch-plugin install analysis-icu
```

**é…ç½®ç¹ç®€ä½“è½¬æ¢ï¼š**
```json
PUT my_index  
{
  "settings": {
    "analysis": {
      "filter": {
        "traditional_convert": {
          "type": "icu_transform",
          "id": "Traditional-Simplified"
        }
      },
      "analyzer": {
        "ik_traditional": {
          "tokenizer": "ik_smart",
          "filter": ["traditional_convert"]
        }
      }
    }
  }
}
```

**æµ‹è¯•ç¹ç®€è½¬æ¢ï¼š**
```json
POST my_index/_analyze
{
  "analyzer": "ik_traditional", 
  "text": "æˆ‘æ„›ä¸­è¯äººæ°‘å…±å’Œåœ‹"
}

ç»“æœï¼š["æˆ‘", "çˆ±", "ä¸­åäººæ°‘å…±å’Œå›½"]
```

---

## 6. ğŸ”¤ æ‹¼éŸ³æœç´¢æ”¯æŒ


### 6.1 æ‹¼éŸ³æœç´¢çš„åº”ç”¨åœºæ™¯


**ğŸ”¸ å¸¸è§éœ€æ±‚**
```
ç”¨æˆ·è¾“å…¥åœºæ™¯ï¼š
- è¾“å…¥"beijing" æ‰¾åˆ° "åŒ—äº¬"
- è¾“å…¥"zhongguo" æ‰¾åˆ° "ä¸­å›½"  
- è¾“å…¥"pg" æ‰¾åˆ° "è‹¹æœ"ï¼ˆé¦–å­—æ¯æœç´¢ï¼‰
```

### 6.2 å®‰è£…æ‹¼éŸ³æ’ä»¶


```bash
# ä¸‹è½½æ‹¼éŸ³æ’ä»¶
wget https://github.com/medcl/elasticsearch-analysis-pinyin/releases/download/v7.15.0/elasticsearch-analysis-pinyin-7.15.0.zip

# å®‰è£…æ’ä»¶
bin/elasticsearch-plugin install file:///path/to/elasticsearch-analysis-pinyin-7.15.0.zip
```

### 6.3 é…ç½®æ‹¼éŸ³åˆ†æå™¨


**å®Œæ•´æ‹¼éŸ³åˆ†æå™¨é…ç½®ï¼š**
```json
PUT my_index
{
  "settings": {
    "analysis": {
      "analyzer": {
        "pinyin_analyzer": {
          "tokenizer": "ik_smart",
          "filter": ["pinyin_filter"]
        }
      },
      "filter": {
        "pinyin_filter": {
          "type": "pinyin",
          "keep_first_letter": true,     // ä¿ç•™é¦–å­—æ¯
          "keep_separate_first_letter": false,
          "keep_full_pinyin": true,      // ä¿ç•™å…¨æ‹¼
          "keep_original": true,         // ä¿ç•™åŸæ–‡
          "limit_first_letter_length": 16,
          "lowercase": true
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "name": {
        "type": "text",
        "analyzer": "pinyin_analyzer",
        "search_analyzer": "ik_smart"
      }
    }
  }
}
```

**æµ‹è¯•æ‹¼éŸ³åˆ†ææ•ˆæœï¼š**
```json
POST my_index/_analyze
{
  "analyzer": "pinyin_analyzer",
  "text": "åŒ—äº¬å¤§å­¦"
}

ç»“æœï¼š["åŒ—äº¬å¤§å­¦", "bei", "jing", "da", "xue", "beijingdaxue", "bjdx"]
```

### 6.4 æ‹¼éŸ³æœç´¢æœ€ä½³å®è·µ


**å¤šå­—æ®µç­–ç•¥ï¼š**
```json
PUT my_index
{
  "mappings": {
    "properties": {
      "name": {
        "type": "text",
        "analyzer": "ik_smart",
        "fields": {
          "pinyin": {
            "type": "text", 
            "analyzer": "pinyin_analyzer",
            "search_analyzer": "ik_smart"
          }
        }
      }
    }
  }
}
```

**ç»¼åˆæœç´¢æŸ¥è¯¢ï¼š**
```json
GET my_index/_search
{
  "query": {
    "multi_match": {
      "query": "beijing",
      "fields": ["name", "name.pinyin"]
    }
  }
}
```

---

## 7. ğŸ¯ ä¸­æ–‡æœç´¢ä¼˜åŒ–ç­–ç•¥


### 7.1 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ å¤šåˆ†æå™¨ç»„åˆç­–ç•¥**
```json
PUT articles
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart",
        "fields": {
          "pinyin": {
            "type": "text",
            "analyzer": "pinyin_analyzer"
          },
          "suggest": {
            "type": "completion"
          }
        }
      }
    }
  }
}
```

### 7.2 æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥


**æ™ºèƒ½æŸ¥è¯¢ç»„åˆï¼š**
```json
GET articles/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "match": {
            "title": {
              "query": "ç”¨æˆ·æœç´¢è¯",
              "boost": 3    // ä¸­æ–‡åŒ¹é…æƒé‡æœ€é«˜
            }
          }
        },
        {
          "match": {
            "title.pinyin": {
              "query": "ç”¨æˆ·æœç´¢è¯", 
              "boost": 1    // æ‹¼éŸ³åŒ¹é…æƒé‡è¾ƒä½
            }
          }
        }
      ]
    }
  }
}
```

### 7.3 ç›¸å…³æ€§ä¼˜åŒ–


**ğŸ”¸ å­—æ®µæƒé‡é…ç½®**
```json
GET articles/_search
{
  "query": {
    "multi_match": {
      "query": "äººå·¥æ™ºèƒ½",
      "fields": [
        "title^3",        // æ ‡é¢˜æƒé‡3å€
        "content^1",      // å†…å®¹åŸºç¡€æƒé‡
        "tags^2"         // æ ‡ç­¾æƒé‡2å€
      ]
    }
  }
}
```

**ğŸ”¸ çŸ­è¯­åŒ¹é…ä¼˜åŒ–**
```json
GET articles/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "match_phrase": {
            "title": {
              "query": "äººå·¥æ™ºèƒ½",
              "boost": 2
            }
          }
        },
        {
          "match": {
            "title": "äººå·¥æ™ºèƒ½"
          }
        }
      ]
    }
  }
}
```

---

## 8. ğŸ’¡ æœç´¢å»ºè®®ä¸è‡ªåŠ¨è¡¥å…¨


### 8.1 å®ç°æœç´¢å»ºè®®


**é…ç½®completionå­—æ®µï¼š**
```json
PUT search_suggest
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_smart"
      },
      "suggest": {
        "type": "completion",
        "analyzer": "ik_smart",
        "contexts": [
          {
            "name": "category",
            "type": "category"
          }
        ]
      }
    }
  }
}
```

**ç´¢å¼•å»ºè®®æ•°æ®ï¼š**
```json
PUT search_suggest/_doc/1
{
  "title": "è‹¹æœæ‰‹æœºiPhone13",
  "suggest": {
    "input": ["è‹¹æœæ‰‹æœº", "iPhone13", "è‹¹æœ", "æ‰‹æœº"],
    "contexts": {
      "category": "ç”µå­äº§å“"
    }
  }
}
```

**æœç´¢å»ºè®®æŸ¥è¯¢ï¼š**
```json
GET search_suggest/_search
{
  "suggest": {
    "my_suggest": {
      "prefix": "è‹¹æœ",
      "completion": {
        "field": "suggest",
        "contexts": {
          "category": "ç”µå­äº§å“"
        }
      }
    }
  }
}
```

### 8.2 æ™ºèƒ½æç¤ºä¼˜åŒ–


**æ‹¼éŸ³ + ä¸­æ–‡ç»„åˆå»ºè®®ï¼š**
```json
PUT search_suggest/_doc/2
{
  "title": "åä¸ºæ‰‹æœºMate40",
  "suggest": {
    "input": [
      "åä¸ºæ‰‹æœº", "huawei", "hw", 
      "Mate40", "mate", "åä¸º"
    ]
  }
}
```

---

## 9. ğŸ“Š ä¸­æ–‡ç›¸å…³æ€§è°ƒä¼˜


### 9.1 ç†è§£ä¸­æ–‡ç›¸å…³æ€§è®¡ç®—


**ğŸ”¸ å½±å“ç›¸å…³æ€§çš„å› ç´ **
```
è¯é¢‘(TF)ï¼šè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„é¢‘ç‡
æ–‡æ¡£é¢‘ç‡(DF)ï¼šåŒ…å«è¯¥è¯çš„æ–‡æ¡£æ•°é‡  
å­—æ®µé•¿åº¦ï¼šæ–‡æ¡£å­—æ®µçš„é•¿åº¦
æŸ¥è¯¢è¦†ç›–åº¦ï¼šæŸ¥è¯¢è¯å‘½ä¸­çš„æ¯”ä¾‹
```

### 9.2 ä¸­æ–‡ç›¸å…³æ€§è°ƒä¼˜æŠ€å·§


**è°ƒæ•´åˆ†è¯æƒé‡ï¼š**
```json
GET articles/_search
{
  "query": {
    "function_score": {
      "query": {
        "match": {
          "title": "äººå·¥æ™ºèƒ½æŠ€æœ¯"
        }
      },
      "functions": [
        {
          "filter": {
            "match_phrase": {
              "title": "äººå·¥æ™ºèƒ½æŠ€æœ¯"
            }
          },
          "weight": 2.0    // å®Œæ•´çŸ­è¯­åŒ¹é…åŠ æƒ
        }
      ]
    }
  }
}
```

**å­—æ®µé•¿åº¦å½’ä¸€åŒ–ï¼š**
```json
PUT articles
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_smart",
        "norms": true    // å¯ç”¨é•¿åº¦å½’ä¸€åŒ–
      }
    }
  }
}
```

---

## 10. âš¡ æ€§èƒ½å¯¹æ¯”ä¸è¯å…¸çƒ­æ›´æ–°


### 10.1 åˆ†è¯å™¨æ€§èƒ½å¯¹æ¯”


**ğŸ“Š æ€§èƒ½æµ‹è¯•ç»“æœ**

| åˆ†æå™¨ | **åˆ†è¯é€Ÿåº¦** | **å†…å­˜å ç”¨** | **å‡†ç¡®æ€§** | **é€‚ç”¨åœºæ™¯** |
|-------|------------|------------|----------|------------|
| `standard` | `æœ€å¿«` | `æœ€å°‘` | `å·®` | `è‹±æ–‡æ–‡æ¡£` |
| `ik_smart` | `å¿«` | `ä¸­ç­‰` | `å¥½` | `ä¸­æ–‡æœç´¢` |
| `ik_max_word` | `ä¸­ç­‰` | `è¾ƒå¤š` | `æœ€å¥½` | `ä¸­æ–‡ç´¢å¼•` |
| `pinyin` | `æ…¢` | `æœ€å¤š` | `ä¸­ç­‰` | `æ‹¼éŸ³æœç´¢` |

### 10.2 è¯å…¸çƒ­æ›´æ–°å®ç°


**è®¾ç½®è¿œç¨‹è¯å…¸æœåŠ¡ï¼š**
```python
# ç®€å•çš„è¯å…¸æœåŠ¡å®ç°
from flask import Flask, Response
import time

app = Flask(__name__)

@app.route('/custom_dict.txt')
def custom_dict():
    # è¿”å›è‡ªå®šä¹‰è¯å…¸å†…å®¹
    words = [
        "åä¸ºæ‰‹æœº",
        "å°ç±³ç§‘æŠ€", 
        "äººå·¥æ™ºèƒ½",
        "åŒºå—é“¾æŠ€æœ¯"
    ]
    
    content = '\n'.join(words)
    response = Response(content, mimetype='text/plain')
    response.headers['Last-Modified'] = time.strftime('%a, %d %b %Y %H:%M:%S GMT')
    return response

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

**IKé…ç½®è¿œç¨‹è¯å…¸ï¼š**
```xml
<entry key="remote_ext_dict">http://localhost:8080/custom_dict.txt</entry>
```

**è¯å…¸æ›´æ–°ç›‘æ§ï¼š**
```bash
# æŸ¥çœ‹IKæ’ä»¶æ—¥å¿—ï¼Œç¡®è®¤è¯å…¸æ›´æ–°
tail -f logs/elasticsearch.log | grep "ik"
```

> ğŸ’¡ **çƒ­æ›´æ–°åŸç†**ï¼šIKæ’ä»¶ä¼šå®šæœŸæ£€æŸ¥è¿œç¨‹è¯å…¸çš„`Last-Modified`å¤´ï¼Œå¦‚æœå‘ç°æ›´æ–°å°±é‡æ–°åŠ è½½è¯å…¸ï¼Œæ•´ä¸ªè¿‡ç¨‹æ— éœ€é‡å¯ESã€‚

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¸­æ–‡åˆ†è¯æŒ‘æˆ˜ï¼šæ— å¤©ç„¶åˆ†éš”ç¬¦ã€æ­§ä¹‰åˆ†è¯ã€æ–°è¯è¯†åˆ«
ğŸ”¸ IKåˆ†æå™¨ï¼šik_smartæ™ºèƒ½åˆ†è¯ + ik_max_wordæœ€ç»†ç²’åº¦åˆ†è¯
ğŸ”¸ åˆ†è¯ç­–ç•¥ï¼šç´¢å¼•ç”¨ik_max_wordï¼Œæœç´¢ç”¨ik_smart
ğŸ”¸ è‡ªå®šä¹‰è¯å…¸ï¼šä¸šåŠ¡ç‰¹å®šè¯æ±‡ï¼Œæé«˜åˆ†è¯å‡†ç¡®æ€§
ğŸ”¸ æ‹¼éŸ³æœç´¢ï¼šæ”¯æŒæ‹¼éŸ³è¾“å…¥ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
ğŸ”¸ æœç´¢ä¼˜åŒ–ï¼šå¤šå­—æ®µç»„åˆã€æƒé‡è°ƒæ•´ã€ç›¸å…³æ€§ä¼˜åŒ–
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ä¸­æ–‡åˆ†è¯**
```
ç†è§£è¦ç‚¹ï¼š
- ä¸­æ–‡æ²¡æœ‰å¤©ç„¶çš„è¯æ±‡åˆ†éš”ç¬¦
- æ­£ç¡®çš„åˆ†è¯æ˜¯ä¸­æ–‡æœç´¢çš„åŸºç¡€
- åˆ†è¯è´¨é‡ç›´æ¥å½±å“æœç´¢æ•ˆæœ
```

**ğŸ”¹ ä¸¤ç§åˆ†è¯æ¨¡å¼çš„é€‰æ‹©**
```
è®°å¿†æ–¹æ³•ï¼š
- ik_smartï¼šæœç´¢ç”¨ï¼Œæ±‚ç²¾å‡†
- ik_max_wordï¼šç´¢å¼•ç”¨ï¼Œæ±‚å…¨é¢
- ä¸€ä¸ªæ±‚è´¨é‡ï¼Œä¸€ä¸ªæ±‚è¦†ç›–
```

**ğŸ”¹ è‡ªå®šä¹‰è¯å…¸çš„é‡è¦æ€§**
```
å®é™…ä»·å€¼ï¼š
- é€šç”¨è¯å…¸æ— æ³•è¦†ç›–ä¸“ä¸šé¢†åŸŸ
- ä¸šåŠ¡è¯æ±‡éœ€è¦ä¸“é—¨ç»´æŠ¤
- è¯å…¸è´¨é‡å†³å®šåˆ†è¯æ•ˆæœ
```

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**æœ€ä½³å®è·µæ€»ç»“ï¼š**
- ğŸ¯ **åˆ†æå™¨é€‰æ‹©**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„åˆ†è¯ç­–ç•¥
- ğŸ“š **è¯å…¸ç»´æŠ¤**ï¼šå»ºç«‹ä¸šåŠ¡è¯å…¸æ›´æ–°æœºåˆ¶  
- ğŸ” **æœç´¢ä¼˜åŒ–**ï¼šå¤šå­—æ®µç»„åˆæå‡æœç´¢ä½“éªŒ
- âš¡ **æ€§èƒ½å¹³è¡¡**ï¼šåœ¨åˆ†è¯ç²¾åº¦å’Œæ€§èƒ½é—´æ‰¾å¹³è¡¡
- ğŸ”„ **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®ç”¨æˆ·æœç´¢è¡Œä¸ºè°ƒæ•´ç­–ç•¥

### 11.4 å¸¸è§é—®é¢˜è§£å†³


**åˆ†è¯ä¸å‡†ç¡®ï¼š**
- âœ… æ£€æŸ¥è¯å…¸é…ç½®
- âœ… æ·»åŠ ä¸šåŠ¡ç›¸å…³è¯æ±‡
- âœ… è°ƒæ•´åˆ†è¯å™¨å‚æ•°

**æœç´¢å¬å›ç‡ä½ï¼š**
- âœ… ä½¿ç”¨ik_max_wordç´¢å¼•
- âœ… æ·»åŠ åŒä¹‰è¯é…ç½®
- âœ… æ”¯æŒæ‹¼éŸ³æœç´¢

**æœç´¢ç²¾åº¦ä¸é«˜ï¼š**
- âœ… ä½¿ç”¨ik_smartæŸ¥è¯¢
- âœ… è°ƒæ•´å­—æ®µæƒé‡
- âœ… ä¼˜åŒ–ç›¸å…³æ€§ç®—æ³•

**æ ¸å¿ƒè®°å¿†**ï¼š
- ä¸­æ–‡åˆ†è¯æ˜¯åŸºç¡€ï¼Œé€‰å¯¹åˆ†æå™¨æ˜¯å…³é”®
- ç´¢å¼•æ±‚å…¨é¢ï¼Œæœç´¢æ±‚ç²¾å‡†
- è¯å…¸è¦ç»´æŠ¤ï¼Œæ‹¼éŸ³èƒ½åŠ åˆ†
- ç»„åˆç­–ç•¥ç”¨ï¼Œæ•ˆæœæ‰æœ€ä½³