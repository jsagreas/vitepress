---
title: 6、REST-API-基础操作
---
## 📚 目录

1. [REST API 核心概念理解](#1-REST-API-核心概念理解)
2. [HTTP 方法与操作映射](#2-HTTP-方法与操作映射)
3. [URL 路径结构详解](#3-URL-路径结构详解)
4. [请求与响应格式](#4-请求与响应格式)
5. [集群管理 API 实战](#5-集群管理-API-实战)
6. [节点信息查询 API](#6-节点信息查询-API)
7. [健康检查与监控 API](#7-健康检查与监控-API)
8. [统计信息获取 API](#8-统计信息获取-API)
9. [API 版本兼容性处理](#9-API-版本兼容性处理)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🌐 REST API 核心概念理解


### 1.1 什么是 REST API


**🔸 简单理解**
想象 Elasticsearch 是一个超级智能的图书管理员，REST API 就是你和这个管理员交流的"标准语言"。

```
现实对话                    REST API 对话
─────────────────────────────────────────────
"请帮我查找一本书"     →     GET /books/_search
"我要添加一本新书"     →     POST /books/_doc
"请更新这本书信息"     →     PUT /books/_doc/1
"请删除这本书"         →     DELETE /books/_doc/1
```

**🔸 REST 的核心思想**
- **RE**presentational：数据的表现形式（通常是 JSON）
- **S**tate：状态信息（数据的当前状态）
- **T**ransfer：传输（在客户端和服务器间传递）

### 1.2 为什么选择 REST API


> 💡 **通俗解释**  
> 就像全世界的人都用英语交流一样，REST API 是软件世界的"通用语言"，任何编程语言都能使用它与 Elasticsearch 对话。

**🔸 主要优势**
- **🌍 通用性强**：任何能发送 HTTP 请求的工具都能使用
- **🔧 简单易学**：基于大家熟悉的 HTTP 协议
- **📱 跨平台**：手机、电脑、服务器都能访问
- **🔍 可调试**：用浏览器就能测试简单操作

---

## 2. 🛠️ HTTP 方法与操作映射


### 2.1 四大基础方法详解


**🔸 数据库操作类比**

| HTTP 方法 | **数据库操作** | **Elasticsearch 用途** | **生活类比** |
|-----------|---------------|----------------------|-------------|
| 🟢 **GET** | `SELECT 查询` | `查找和获取数据` | `去图书馆借书查阅` |
| 🔵 **POST** | `INSERT 插入` | `创建新文档` | `向图书馆捐赠新书` |
| 🟡 **PUT** | `UPDATE 更新` | `更新或创建文档` | `替换书架上的旧书` |
| 🔴 **DELETE** | `DELETE 删除` | `删除文档或索引` | `从图书馆移除某本书` |

### 2.2 实际使用场景


**🔸 GET - 查询操作**
```bash
# 获取集群健康状态（就像问"图书馆现在运营正常吗？"）

GET /_cluster/health

# 查找特定文档（就像问"请帮我找编号为 123 的那本书"）

GET /my_index/_doc/123

# 搜索内容（就像问"有哪些关于 JavaScript 的书？"）

GET /books/_search?q=javascript
```

**🔸 POST - 创建操作**
```bash
# 添加新文档，让 ES 自动生成 ID（就像"我要捐一本书，你帮我编号"）

POST /books/_doc
{
  "title": "Vue.js 实战指南",
  "author": "张三",
  "price": 59.9
}
```

**🔸 PUT - 更新操作**
```bash
# 更新指定 ID 的文档（就像"请把编号 123 的书信息改成这样"）

PUT /books/_doc/123
{
  "title": "Vue.js 高级实战",
  "author": "张三",
  "price": 79.9
}
```

**🔸 DELETE - 删除操作**
```bash
# 删除特定文档（就像"请把编号 123 的书移除"）

DELETE /books/_doc/123

# 删除整个索引（就像"把整个计算机类图书区域清空"）

DELETE /books
```

### 2.3 方法选择决策树


```
需要操作数据？
    │
    ├─ 只是查看 ────────────────────→ GET
    │
    ├─ 要添加新数据
    │   ├─ 不知道数据 ID ──────────→ POST
    │   └─ 已知数据 ID ──────────→ PUT
    │
    └─ 要删除数据 ────────────────────→ DELETE
```

---

## 3. 🗺️ URL 路径结构详解


### 3.1 ES URL 结构解析


**🔸 基本结构模式**
```
http://hostname:port/index_name/type_name/document_id?parameters
│    │        │    │          │         │           │
│    │        │    │          │         │           └─ 查询参数
│    │        │    │          │         └─ 文档ID（可选）
│    │        │    │          └─ 类型（ES 7+ 已废弃）
│    │        │    └─ 索引名称
│    │        └─ 端口号（默认 9200）
│    └─ 主机地址
└─ 协议类型
```

**🔸 现代 ES URL 结构（ES 7+）**
```
http://localhost:9200/books/_doc/123?refresh=true
│                   │     │    │   │
│                   │     │    │   └─ 参数：立即刷新
│                   │     │    └─ 文档 ID
│                   │     └─ 固定的 _doc 类型
│                   └─ 索引名称
```

### 3.2 特殊 API 路径前缀


**🔸 系统级 API（以下划线开头）**

| 路径前缀 | **用途说明** | **类比理解** |
|---------|-------------|-------------|
| `/_cat/` | `简洁的信息展示` | `图书馆的简明公告牌` |
| `/_cluster/` | `集群级别操作` | `整个图书馆的管理` |
| `/_nodes/` | `节点信息查询` | `各个书库的状态` |
| `/_index/` | `索引管理操作` | `特定书类的管理` |

### 3.3 路径构建实例


**🔸 从简单到复杂的路径示例**

```bash
# 1️⃣ 最简单：查看集群状态

GET /

# 2️⃣ 查看所有索引

GET /_cat/indices

# 3️⃣ 操作特定索引

GET /books

# 4️⃣ 操作特定文档

GET /books/_doc/123

# 5️⃣ 带参数的复杂查询

GET /books/_search?q=title:javascript&size=10&from=0
```

---

## 4. 📋 请求与响应格式


### 4.1 请求体格式规范


**🔸 JSON 格式基础**

> 💡 **简单理解**  
> JSON 就像填表格，用大括号 `{}` 表示一张表，用方括号 `[]` 表示一个列表。

```json
{
  "书名": "JavaScript 高级程序设计",
  "作者": "Nicholas C. Zakas",
  "价格": 99.0,
  "标签": ["编程", "前端", "JavaScript"],
  "出版信息": {
    "出版社": "人民邮电出版社",
    "出版年份": 2020
  }
}
```

**🔸 常见请求体结构**

```bash
# 创建文档的请求体

POST /books/_doc
{
  "title": "Vue.js 从入门到精通",
  "author": "李四",
  "category": "前端开发",
  "price": 69.9,
  "publish_date": "2024-01-01"
}
```

### 4.2 响应状态码含义


**🔸 HTTP 状态码速查**

| 状态码 | **含义** | **ES 场景** | **类比理解** |
|-------|---------|------------|-------------|
| 🟢 **200** | `成功` | `操作完成` | `"好的，已经帮您处理了"` |
| 🟢 **201** | `已创建` | `文档创建成功` | `"新书已经上架"` |
| 🟡 **400** | `请求错误` | `JSON 格式有误` | `"您的申请表填错了"` |
| 🟡 **404** | `未找到` | `索引或文档不存在` | `"找不到您要的书"` |
| 🔴 **500** | `服务器错误` | `ES 内部错误` | `"图书馆系统故障"` |

### 4.3 响应体结构解读


**🔸 成功响应示例**
```json
{
  "_index": "books",           // 索引名称
  "_type": "_doc",            // 文档类型
  "_id": "1",                 // 文档 ID
  "_version": 1,              // 版本号（每次更新 +1）
  "result": "created",        // 操作结果
  "_shards": {                // 分片信息
    "total": 2,               // 总分片数
    "successful": 2,          // 成功分片数
    "failed": 0               // 失败分片数
  }
}
```

**🔸 错误响应示例**
```json
{
  "error": {
    "type": "parsing_exception",
    "reason": "Expected [START_OBJECT] but found [START_ARRAY]",
    "line": 1,
    "col": 1
  },
  "status": 400
}
```

---

## 5. 🏢 集群管理 API 实战


### 5.1 _cluster API 核心功能


**🔸 集群健康检查**

> 🌰 **生活类比**  
> 就像体检报告一样，告诉你整个 Elasticsearch "身体"是否健康。

```bash
# 获取集群健康状态

GET /_cluster/health

# 获取特定索引的健康状态

GET /_cluster/health/books
```

**🔸 健康状态颜色含义**

| 颜色 | **状态** | **含义** | **类比** |
|------|---------|---------|---------|
| 🟢 **green** | `健康` | `所有分片都正常工作` | `身体完全健康` |
| 🟡 **yellow** | `警告` | `主分片正常，副本分片有问题` | `有点小毛病，但能正常工作` |
| 🔴 **red** | `危险` | `有主分片无法使用` | `严重疾病，需要立即治疗` |

### 5.2 集群设置管理


**🔸 查看集群设置**
```bash
# 查看所有集群设置

GET /_cluster/settings

# 只查看持久化设置

GET /_cluster/settings?include_defaults=true
```

**🔸 修改集群设置**
```bash
# 临时修改设置（重启后失效）

PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.enable": "all"
  }
}

# 永久修改设置（重启后仍有效）

PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.enable": "all"
  }
}
```

### 5.3 集群状态详情


**🔸 获取集群详细状态**
```bash
# 获取完整集群状态（信息量很大）

GET /_cluster/state

# 只获取特定部分的状态

GET /_cluster/state/nodes,routing_table
```

> ⚠️ **注意事项**  
> 完整的集群状态信息非常庞大，生产环境中建议只获取需要的部分。

---

## 6. 🖥️ 节点信息查询 API


### 6.1 _nodes API 基础用法


**🔸 节点概念理解**

> 🌰 **团队类比**  
> 如果 Elasticsearch 集群是一个公司，那么每个节点就是公司里的一个员工，各自负责不同的工作。

```
集群 = 公司
├── 节点1 = 总经理（Master节点）
├── 节点2 = 业务员工（Data节点）  
├── 节点3 = 接待员（Coordinating节点）
└── 节点4 = 后勤员工（Ingest节点）
```

### 6.2 节点信息查询


**🔸 基础节点信息**
```bash
# 查看所有节点基本信息

GET /_nodes

# 查看特定节点信息（用节点名或ID）

GET /_nodes/node-1

# 只查看节点的特定信息

GET /_nodes/stats/jvm,os,process
```

**🔸 节点统计信息**
```bash
# 获取节点统计数据

GET /_nodes/stats

# 获取特定类型的统计

GET /_nodes/stats/indices,os,process
```

### 6.3 节点角色理解


**🔸 节点角色说明**

| 角色类型 | **职责** | **类比** |
|---------|---------|---------|
| **Master** | `集群管理，决策制定` | `公司总经理` |
| **Data** | `存储数据，执行查询` | `仓库管理员` |
| **Ingest** | `数据预处理` | `数据处理员` |
| **Coordinating** | `请求分发，结果汇总` | `前台接待员` |

---

## 7. 🏥 健康检查与监控 API


### 7.1 _cat API 系列介绍


**🔸 _cat API 的特点**

> 💡 **简单理解**  
> _cat API 就像医院的化验单，用简洁的表格形式显示重要信息，方便人类阅读。

```bash
# 显示所有可用的 _cat API

GET /_cat

# 带列标题的输出（更容易理解）

GET /_cat/health?v

# 以 JSON 格式输出（程序处理）

GET /_cat/health?format=json
```

### 7.2 常用健康检查命令


**🔸 核心监控命令**

```bash
# 🏥 集群健康状态（最重要）

GET /_cat/health?v

# 📊 节点状态

GET /_cat/nodes?v

# 📚 索引状态

GET /_cat/indices?v

# 🔧 分片分布情况

GET /_cat/shards?v

# 💾 磁盘使用情况

GET /_cat/allocation?v
```

### 7.3 输出格式控制


**🔸 格式化选项**

| 参数 | **效果** | **使用场景** |
|------|---------|-------------|
| `?v` | `显示列标题` | `人工查看` |
| `?format=json` | `JSON 格式输出` | `程序处理` |
| `?h=column1,column2` | `只显示指定列` | `精简输出` |
| `?s=column` | `按指定列排序` | `排序显示` |

**🔸 实用示例**
```bash
# 按磁盘使用率排序显示节点

GET /_cat/nodes?v&s=disk.used_percent:desc

# 只显示索引名称和状态

GET /_cat/indices?v&h=index,status,health

# 显示分片分布，按节点排序

GET /_cat/shards?v&s=node
```

---

## 8. 📈 统计信息获取 API


### 8.1 集群级统计信息


**🔸 整体统计概览**
```bash
# 获取集群整体统计

GET /_stats

# 获取特定类型的统计

GET /_stats/docs,store,indexing
```

**🔸 统计信息类型**

| 统计类型 | **含义** | **类比** |
|---------|---------|---------|
| **docs** | `文档数量统计` | `图书馆的藏书数量` |
| **store** | `存储空间统计` | `书架占用的空间` |
| **indexing** | `索引操作统计` | `新书入库的速度` |
| **search** | `搜索操作统计` | `读者查书的频率` |

### 8.2 索引级统计信息


**🔸 特定索引统计**
```bash
# 获取特定索引的统计

GET /books/_stats

# 获取多个索引的统计

GET /books,articles/_stats

# 获取所有索引的统计

GET /_all/_stats
```

### 8.3 节点级统计信息


**🔸 节点性能监控**
```bash
# 获取所有节点的统计

GET /_nodes/stats

# 获取特定节点的统计

GET /_nodes/node-1/stats

# 获取JVM相关统计

GET /_nodes/stats/jvm
```

---

## 9. 🔄 API 版本兼容性处理


### 9.1 版本差异概述


**🔸 主要版本变化**

```
ES 版本演进图
──────────────────────────────────────────
ES 6.x  │  类型(Type)开始废弃
        │  
ES 7.x  │  移除类型概念，统一使用 _doc
        │  
ES 8.x  │  完全移除类型，API进一步简化
```

### 9.2 跨版本兼容性策略


**🔸 检查 ES 版本**
```bash
# 获取集群版本信息

GET /

# 响应示例

{
  "name": "node-1",
  "cluster_name": "my-cluster",
  "version": {
    "number": "7.15.0",
    "build_flavor": "default"
  }
}
```

**🔸 版本适配最佳实践**

| ES 版本 | **推荐做法** | **注意事项** |
|---------|-------------|-------------|
| **6.x** | `逐步废弃类型使用` | `为升级做准备` |
| **7.x** | `统一使用 _doc 类型` | `删除所有自定义类型` |
| **8.x** | `完全移除类型概念` | `API 调用更简洁` |

### 9.3 API 调用兼容性示例


**🔸 跨版本的文档操作**

```bash
# ❌ ES 6.x 的旧写法（不推荐）

PUT /books/book/1
{
  "title": "JavaScript Guide"
}

# ✅ ES 7.x+ 的新写法（推荐）

PUT /books/_doc/1
{
  "title": "JavaScript Guide"
}

# ✅ ES 8.x 的简化写法

PUT /books/_doc/1
{
  "title": "JavaScript Guide"
}
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的基础概念


**🔸 核心理解要点**
- **REST API 本质**：使用 HTTP 协议与 ES 交互的标准方式
- **HTTP 方法映射**：GET查询、POST创建、PUT更新、DELETE删除
- **URL 结构规律**：`host:port/index/_doc/id?parameters`
- **请求响应格式**：JSON 格式的结构化数据交换
- **系统 API 前缀**：`_cat`、`_cluster`、`_nodes` 等特殊用途

### 10.2 实用操作清单


**🔸 日常运维必备命令**

```bash
# 🏥 健康检查三步曲

GET /_cat/health?v           # 集群整体健康
GET /_cat/nodes?v            # 节点状态
GET /_cat/indices?v          # 索引状态

# 📊 性能监控

GET /_nodes/stats/jvm,os     # 节点性能
GET /_cluster/stats          # 集群统计

# 🔧 日常管理

GET /_cat/allocation?v       # 磁盘分配
GET /_cat/shards?v          # 分片分布
```

### 10.3 关键理解要点


**🔹 REST API 的优势理解**
```
简单性：像普通网页访问一样简单
通用性：任何编程语言都能使用
可读性：URL 和 JSON 都很直观
可调试：浏览器就能测试基本功能
```

**🔹 操作安全性考虑**
```
GET 操作：安全，只读取数据
POST/PUT 操作：需要谨慎，会修改数据
DELETE 操作：危险，会删除数据
生产环境：建议使用权限控制
```

**🔹 性能优化建议**
```
适量查询：避免一次性获取大量数据
使用过滤：通过参数限制返回字段
定期监控：及时发现性能问题
版本兼容：选择合适的 API 版本
```

### 10.4 学习路径建议


**🗺️ 推荐学习顺序**
```
基础概念 → 简单查询 → 数据操作 → 集群管理 → 性能优化
    ↓           ↓          ↓          ↓          ↓
  理论学习    GET练习   POST/PUT   监控API   生产实践
```

**🎯 实践练习建议**
1. **先熟悉 GET 操作**：从查看集群状态开始
2. **再练习数据操作**：创建、更新、删除文档
3. **最后学习管理**：集群监控和性能调优

> 💡 **学习心得**  
> REST API 是 Elasticsearch 的"通用语言"，掌握了它就能用任何工具与 ES 对话。记住"GET查看、POST创建、PUT更新、DELETE删除"这个核心逻辑，其他都是在这个基础上的扩展。

**核心记忆口诀**：
- REST API 四动词：GET查POST创PUT改DELETE删
- 路径结构要记清：索引文档ID参数跟
- 健康监控三件套：health、nodes、indices查
- JSON格式要规范：大括号里放数据