---
title: 3ã€åˆ†ç‰‡ç®¡ç†ä¸åˆ†é…
---
## ğŸ“š ç›®å½•

1. [åˆ†ç‰‡åŸºç¡€æ¦‚å¿µ](#1-åˆ†ç‰‡åŸºç¡€æ¦‚å¿µ)
2. [åˆ†ç‰‡çŠ¶æ€æŸ¥çœ‹å‘½ä»¤](#2-åˆ†ç‰‡çŠ¶æ€æŸ¥çœ‹å‘½ä»¤)
3. [åˆ†ç‰‡åˆ†é…ä¸è·¯ç”±](#3-åˆ†ç‰‡åˆ†é…ä¸è·¯ç”±)
4. [åˆ†ç‰‡æ¢å¤ä¸ç»´æŠ¤](#4-åˆ†ç‰‡æ¢å¤ä¸ç»´æŠ¤)
5. [åˆ†ç‰‡æ€§èƒ½ä¼˜åŒ–](#5-åˆ†ç‰‡æ€§èƒ½ä¼˜åŒ–)
6. [å®æˆ˜æ¡ˆä¾‹ä¸æ•…éšœæ’é™¤](#6-å®æˆ˜æ¡ˆä¾‹ä¸æ•…éšœæ’é™¤)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§© åˆ†ç‰‡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†ç‰‡ï¼Ÿç”¨å¤§ç™½è¯æ¥è¯´


æƒ³è±¡ä¸€ä¸‹ä½ æœ‰ä¸€æœ¬è¶…åšçš„å­—å…¸ï¼Œå¦‚æœè®©ä¸€ä¸ªäººæ¥ç¿»æ‰¾æŸä¸ªè¯ï¼Œä¼šå¾ˆæ…¢ã€‚ä½†å¦‚æœæŠŠè¿™æœ¬å­—å…¸æ‹†æˆå‡ æœ¬å°å†Œå­ï¼ˆæ¯”å¦‚A-F, G-M, N-S, T-Zï¼‰ï¼Œè®©å‡ ä¸ªäººåŒæ—¶æŸ¥æ‰¾ï¼Œæ˜¯ä¸æ˜¯å°±å¿«å¤šäº†ï¼Ÿ

```
å®Œæ•´ç´¢å¼• = ä¸€æœ¬å¤§å­—å…¸
    â†“
åˆ†ç‰‡å¤„ç† = æ‹†æˆå¤šæœ¬å°å­—å…¸
    â†“
å¹¶è¡ŒæŸ¥è¯¢ = å¤šäººåŒæ—¶æŸ¥æ‰¾ = æ›´å¿«çš„æœç´¢

å®é™…æ•ˆæœï¼š
åŸæœ¬éœ€è¦10ç§’æŸ¥æ‰¾ â†’ ç°åœ¨åªéœ€è¦2-3ç§’
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
- **ä¸»åˆ†ç‰‡ï¼ˆPrimary Shardï¼‰**ï¼šåŸå§‹æ•°æ®çš„å­˜å‚¨ä½ç½®ï¼Œå°±åƒåŸç¨¿
- **å‰¯æœ¬åˆ†ç‰‡ï¼ˆReplica Shardï¼‰**ï¼šä¸»åˆ†ç‰‡çš„å¤‡ä»½ï¼Œå°±åƒå¤å°ä»¶
- **åˆ†ç‰‡åˆ†é…**ï¼šå†³å®šæ¯ä¸ªåˆ†ç‰‡æ”¾åœ¨å“ªå°æœåŠ¡å™¨ä¸Š

### 1.2 åˆ†ç‰‡çš„çŠ¶æ€ç±»å‹


| çŠ¶æ€ | å«ä¹‰ | æ¯”å–»è¯´æ˜ | æ˜¯å¦æ­£å¸¸ |
|------|------|----------|----------|
| `ğŸŸ¢ STARTED` | åˆ†ç‰‡æ­£å¸¸å·¥ä½œ | å‘˜å·¥æ­£å¸¸ä¸Šç­ | âœ… æ­£å¸¸ |
| `ğŸŸ¡ INITIALIZING` | åˆ†ç‰‡æ­£åœ¨åˆå§‹åŒ– | æ–°å‘˜å·¥å…¥èŒåŸ¹è®­ä¸­ | âš ï¸ ä¸´æ—¶çŠ¶æ€ |
| `ğŸŸ¡ RELOCATING` | åˆ†ç‰‡æ­£åœ¨è¿ç§» | å‘˜å·¥è°ƒéƒ¨é—¨ä¸­ | âš ï¸ ä¸´æ—¶çŠ¶æ€ |
| `ğŸ”´ UNASSIGNED` | åˆ†ç‰‡æœªåˆ†é…åˆ°èŠ‚ç‚¹ | å‘˜å·¥å¾…åˆ†é…å²—ä½ | âŒ éœ€è¦å¤„ç† |

### 1.3 åˆ†ç‰‡åˆ†å¸ƒç¤ºæ„å›¾


```
é›†ç¾¤åˆ†ç‰‡åˆ†å¸ƒå›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èŠ‚ç‚¹ A    â”‚  â”‚   èŠ‚ç‚¹ B    â”‚  â”‚   èŠ‚ç‚¹ C    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸»åˆ†ç‰‡ 0    â”‚  â”‚ å‰¯æœ¬åˆ†ç‰‡ 0  â”‚  â”‚ ä¸»åˆ†ç‰‡ 1    â”‚
â”‚ å‰¯æœ¬åˆ†ç‰‡ 2  â”‚  â”‚ ä¸»åˆ†ç‰‡ 2    â”‚  â”‚ å‰¯æœ¬åˆ†ç‰‡ 1  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æŸ¥è¯¢æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åè°ƒèŠ‚ç‚¹ â†’ è·¯ç”±åˆ°ç›¸å…³åˆ†ç‰‡ â†’ åˆå¹¶ç»“æœ â†’ è¿”å›ç”¨æˆ·
```

---

## 2. ğŸ” åˆ†ç‰‡çŠ¶æ€æŸ¥çœ‹å‘½ä»¤


### 2.1 æŸ¥çœ‹æ‰€æœ‰åˆ†ç‰‡çŠ¶æ€ - ä¸€ç›®äº†ç„¶


**ğŸ’¡ æœ€å¸¸ç”¨å‘½ä»¤**ï¼š`GET /_cat/shards`

```bash
# åŸºç¡€æŸ¥çœ‹ï¼ˆæ–°æ‰‹æ¨èï¼‰
GET /_cat/shards?v

# è¯¦ç»†æŸ¥çœ‹ï¼ˆåŒ…å«æ›´å¤šä¿¡æ¯ï¼‰
GET /_cat/shards?v&h=index,shard,prirep,state,docs,store,node&s=index
```

**ğŸ“Š è¾“å‡ºç»“æœè§£è¯»**ï¼š
```
index    shard prirep state      docs  store  node
my_index 0     p      STARTED    1000  2.1mb  node-1
my_index 0     r      STARTED    1000  2.1mb  node-2  
my_index 1     p      STARTED    950   2.0mb  node-3
my_index 1     r      UNASSIGNED
```

**ğŸ”¸ å­—æ®µå«ä¹‰é€ŸæŸ¥**ï¼š
- **index**: ç´¢å¼•åç§°ï¼ˆå“ªæœ¬å­—å…¸ï¼‰
- **shard**: åˆ†ç‰‡ç¼–å·ï¼ˆç¬¬å‡ å†Œï¼‰
- **prirep**: `p`=ä¸»åˆ†ç‰‡ï¼Œ`r`=å‰¯æœ¬åˆ†ç‰‡
- **state**: å½“å‰çŠ¶æ€
- **docs**: æ–‡æ¡£æ•°é‡
- **store**: å­˜å‚¨å¤§å°
- **node**: æ‰€åœ¨èŠ‚ç‚¹

### 2.2 æŸ¥çœ‹ç‰¹å®šç´¢å¼•åˆ†ç‰‡


```bash
# æŸ¥çœ‹å•ä¸ªç´¢å¼•çš„åˆ†ç‰‡
GET /_cat/shards/my_index?v

# æŸ¥çœ‹å¤šä¸ªç´¢å¼•çš„åˆ†ç‰‡
GET /_cat/shards/index1,index2?v

# ä½¿ç”¨é€šé…ç¬¦æŸ¥çœ‹
GET /_cat/shards/log-*?v
```

### 2.3 åˆ†ç‰‡å¥åº·çŠ¶æ€å¿«é€Ÿæ£€æŸ¥


**ğŸš€ ä¸€é”®å¥åº·æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹é›†ç¾¤æ•´ä½“åˆ†ç‰‡çŠ¶æ€
GET /_cluster/health?level=shards

# æŸ¥çœ‹æœªåˆ†é…åˆ†ç‰‡ï¼ˆé‡ç‚¹å…³æ³¨ï¼‰
GET /_cat/shards?v&h=index,shard,prirep,state,unassigned.reason | grep UNASSIGNED
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**  
> å¦‚æœçœ‹åˆ°å¾ˆå¤š `UNASSIGNED` çŠ¶æ€ï¼Œä¸è¦æ…Œï¼è¿™é€šå¸¸æ„å‘³ç€é›†ç¾¤æ­£åœ¨é‡æ–°å¹³è¡¡æˆ–è€…æœ‰èŠ‚ç‚¹ç¦»çº¿ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šæ•™ä½ å¦‚ä½•å¤„ç†ã€‚

---

## 3. âš–ï¸ åˆ†ç‰‡åˆ†é…ä¸è·¯ç”±


### 3.1 æŸ¥çœ‹åˆ†ç‰‡åˆ†é…åŸå› 


å½“åˆ†ç‰‡æ— æ³•åˆ†é…æ—¶ï¼ŒElasticsearchä¼šå‘Šè¯‰æˆ‘ä»¬å…·ä½“åŸå› ï¼š

```bash
# æŸ¥çœ‹ä¸ºä»€ä¹ˆåˆ†ç‰‡æ²¡æœ‰åˆ†é…ï¼ˆæ•…éšœæ’é™¤å¿…å¤‡ï¼‰
GET /_cluster/allocation/explain
{
  "index": "my_index",
  "shard": 0,
  "primary": true
}
```

**ğŸ“‹ å¸¸è§åˆ†é…å¤±è´¥åŸå› **ï¼š

| åŸå› ä»£ç  | é€šä¿—è§£é‡Š | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| `ALLOCATION_FAILED` | ä¹‹å‰åˆ†é…å¤±è´¥è¿‡ | æ‰‹åŠ¨é‡æ–°åˆ†é… |
| `NODE_LEFT` | èŠ‚ç‚¹ç¦»çº¿äº† | ç­‰èŠ‚ç‚¹æ¢å¤æˆ–æ‰‹åŠ¨åˆ†é… |
| `NO_VALID_SHARD_COPY` | æ²¡æœ‰æœ‰æ•ˆçš„åˆ†ç‰‡å‰¯æœ¬ | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ |
| `TOO_MANY_SHARDS` | èŠ‚ç‚¹åˆ†ç‰‡æ•°é‡å·²æ»¡ | å¢åŠ èŠ‚ç‚¹æˆ–è°ƒæ•´è®¾ç½® |

### 3.2 æ‰‹åŠ¨åˆ†ç‰‡è·¯ç”± - ç´§æ€¥æƒ…å†µæ•‘æ€¥


**âš ï¸ æ³¨æ„ï¼šè¿™æ˜¯é«˜çº§æ“ä½œï¼Œæ–°æ‰‹è¯·è°¨æ…ä½¿ç”¨**

```bash
# å°†æœªåˆ†é…çš„åˆ†ç‰‡æ‰‹åŠ¨åˆ†é…åˆ°æŒ‡å®šèŠ‚ç‚¹
POST /_cluster/reroute
{
  "commands": [
    {
      "allocate_empty_primary": {
        "index": "my_index",
        "shard": 0,
        "node": "node-1",
        "accept_data_loss": true
      }
    }
  ]
}
```

**ğŸ”¸ è·¯ç”±å‘½ä»¤ç±»å‹**ï¼š
- **`move`**: ç§»åŠ¨å·²åˆ†é…çš„åˆ†ç‰‡
- **`allocate_empty_primary`**: åˆ†é…ç©ºçš„ä¸»åˆ†ç‰‡
- **`allocate_replica`**: åˆ†é…å‰¯æœ¬åˆ†ç‰‡

> âš ï¸ **é‡è¦è­¦å‘Š**  
> `accept_data_loss: true` å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼åªåœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨ï¼Œå»ºè®®å…ˆå’¨è¯¢æœ‰ç»éªŒçš„åŒäº‹ã€‚

### 3.3 åˆ†ç‰‡åˆ†é…è®¾ç½®è°ƒä¼˜


```bash
# è°ƒæ•´åˆ†ç‰‡åˆ†é…ç›¸å…³è®¾ç½®
PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.node_concurrent_recoveries": 2,
    "cluster.routing.allocation.cluster_concurrent_rebalance": 2,
    "cluster.routing.allocation.awareness.attributes": "rack_id"
  }
}
```

**ğŸ¯ å…³é”®è®¾ç½®è¯´æ˜**ï¼š
- **`node_concurrent_recoveries`**: æ¯ä¸ªèŠ‚ç‚¹åŒæ—¶æ¢å¤çš„åˆ†ç‰‡æ•°ï¼ˆé»˜è®¤2ï¼‰
- **`cluster_concurrent_rebalance`**: é›†ç¾¤åŒæ—¶é‡å¹³è¡¡çš„åˆ†ç‰‡æ•°ï¼ˆé»˜è®¤2ï¼‰
- **`awareness.attributes`**: åˆ†ç‰‡æ„ŸçŸ¥å±æ€§ï¼ˆé¿å…åŒä¸€æœºæ¶æ”¾å¤šä¸ªå‰¯æœ¬ï¼‰

---

## 4. ğŸ”„ åˆ†ç‰‡æ¢å¤ä¸ç»´æŠ¤


### 4.1 æŸ¥çœ‹åˆ†ç‰‡æ¢å¤çŠ¶æ€


åˆ†ç‰‡æ¢å¤å°±åƒæ¬å®¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ¬å®¶è¿›åº¦ï¼š

```bash
# æŸ¥çœ‹æ­£åœ¨æ¢å¤çš„åˆ†ç‰‡
GET /_cat/recovery?v&h=index,shard,time,type,stage,source_node,target_node,bytes_percent

# æŸ¥çœ‹è¯¦ç»†æ¢å¤ä¿¡æ¯
GET /_recovery/my_index
```

**ğŸ“ˆ æ¢å¤é˜¶æ®µè¯´æ˜**ï¼š
```
INIT â†’ INDEX â†’ START â†’ TRANSLOG â†’ FINALIZE â†’ DONE
 â†“      â†“       â†“        â†“          â†“        â†“
åˆå§‹åŒ–  ç´¢å¼•    å¯åŠ¨    äº‹åŠ¡æ—¥å¿—    æœ€ç»ˆåŒ–   å®Œæˆ
```

### 4.2 åˆ†ç‰‡åˆ·æ–°æ“ä½œ


**ğŸ”„ ç†è§£åˆ·æ–°æ“ä½œ**ï¼š
- **Refresh**: è®©æ–°å†™å…¥çš„æ•°æ®å¯ä»¥è¢«æœç´¢åˆ°ï¼ˆç±»ä¼¼ä¿å­˜æ–‡æ¡£ï¼‰
- **Flush**: å°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼ˆç±»ä¼¼å¤‡ä»½æ–‡æ¡£ï¼‰

```bash
# åˆ·æ–°ç´¢å¼•ï¼ˆè®©æ–°æ•°æ®å¯æœç´¢ï¼‰
POST /my_index/_refresh

# åˆ·æ–°æ‰€æœ‰ç´¢å¼•
POST /_refresh

# å¼ºåˆ¶åˆ·æ–°åˆ°ç£ç›˜ï¼ˆæŒä¹…åŒ–ï¼‰
POST /my_index/_flush

# å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰ç´¢å¼•
POST /_flush
```

> ğŸ’¡ **æ€§èƒ½æç¤º**  
> é¢‘ç¹çš„refreshä¼šå½±å“æ€§èƒ½ã€‚åœ¨å¤§é‡å†™å…¥æ•°æ®æ—¶ï¼Œå¯ä»¥ä¸´æ—¶è°ƒæ•´refreshé—´éš”ï¼š
> ```bash
> PUT /my_index/_settings
> {
>   "refresh_interval": "30s"
> }
> ```

### 4.3 æŸ¥çœ‹åˆ†ç‰‡æ®µä¿¡æ¯


åˆ†ç‰‡æ®µå°±åƒä¹¦çš„ç« èŠ‚ï¼Œäº†è§£æ®µä¿¡æ¯æœ‰åŠ©äºæ€§èƒ½ä¼˜åŒ–ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰åˆ†ç‰‡çš„æ®µä¿¡æ¯
GET /_cat/segments?v&h=index,shard,prirep,segment,docs.count,size

# æŸ¥çœ‹ç‰¹å®šç´¢å¼•çš„æ®µä¿¡æ¯
GET /my_index/_segments
```

**ğŸ“Š æ®µä¼˜åŒ–å»ºè®®**ï¼š
- æ®µæ•°è¿‡å¤šï¼ˆ>10ä¸ªï¼‰è€ƒè™‘åˆå¹¶
- å•ä¸ªæ®µè¿‡å¤§ï¼ˆ>5GBï¼‰è€ƒè™‘é‡æ–°ç´¢å¼•
- åˆ é™¤æ–‡æ¡£è¿‡å¤šè€ƒè™‘force merge

---

## 5. ğŸš€ åˆ†ç‰‡æ€§èƒ½ä¼˜åŒ–


### 5.1 åˆ†ç‰‡æ•°é‡è§„åˆ’


**ğŸ¯ åˆ†ç‰‡æ•°é‡é»„é‡‘æ³•åˆ™**ï¼š

```
åˆ†ç‰‡å¤§å°å»ºè®®èŒƒå›´:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç†æƒ³åˆ†ç‰‡å¤§å°: 10GB - 50GB          â”‚
â”‚  æœ€å¤§å»ºè®®: ä¸è¶…è¿‡65GB               â”‚
â”‚  æœ€å°å»ºè®®: ä¸å°‘äº1GB                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®¡ç®—å…¬å¼:
åˆ†ç‰‡æ•°é‡ = é¢„è®¡æ•°æ®æ€»é‡ Ã· å•åˆ†ç‰‡ç›®æ ‡å¤§å°
```

**ğŸ“‹ å®é™…æ¡ˆä¾‹è®¡ç®—**ï¼š
```
å‡è®¾åœºæ™¯: æ—¥å¿—ç³»ç»Ÿï¼Œé¢„è®¡æ¯å¤©100GBæ•°æ®
ç›®æ ‡åˆ†ç‰‡å¤§å°: 20GB
è®¡ç®—ç»“æœ: 100GB Ã· 20GB = 5ä¸ªä¸»åˆ†ç‰‡

è®¾ç½®æ–¹æ³•:
PUT /daily_logs
{
  "settings": {
    "number_of_shards": 5,
    "number_of_replicas": 1
  }
}
```

### 5.2 åˆ†ç‰‡åˆ†é…ç­–ç•¥ä¼˜åŒ–


```bash
# è®¾ç½®åˆ†ç‰‡åˆ†é…ç­–ç•¥
PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.balance.shard": 0.45,
    "cluster.routing.allocation.balance.index": 0.55,
    "cluster.routing.allocation.balance.threshold": 1.0
  }
}
```

**âš–ï¸ å¹³è¡¡å‚æ•°è¯´æ˜**ï¼š
- **shard**: åˆ†ç‰‡æ•°é‡å¹³è¡¡æƒé‡
- **index**: ç´¢å¼•åˆ†å¸ƒå¹³è¡¡æƒé‡  
- **threshold**: å¹³è¡¡é˜ˆå€¼

### 5.3 åˆ†ç‰‡è·¯ç”±ä¼˜åŒ–


ä½¿ç”¨è·¯ç”±å¯ä»¥è®©ç›¸å…³æ•°æ®èšé›†åœ¨åŒä¸€åˆ†ç‰‡ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼š

```bash
# åˆ›å»ºå¸¦è·¯ç”±çš„ç´¢å¼•
PUT /user_data/_doc/1?routing=user_123
{
  "user_id": "user_123",
  "action": "login",
  "timestamp": "2024-01-20T10:30:00"
}

# æŸ¥è¯¢æ—¶ä½¿ç”¨ç›¸åŒè·¯ç”±
GET /user_data/_search?routing=user_123
{
  "query": {
    "term": {
      "user_id": "user_123"
    }
  }
}
```

---

## 6. ğŸ› ï¸ å®æˆ˜æ¡ˆä¾‹ä¸æ•…éšœæ’é™¤


### 6.1 æ¡ˆä¾‹1ï¼šåˆ†ç‰‡æœªåˆ†é…é—®é¢˜


**ğŸ” é—®é¢˜ç°è±¡**ï¼š
```bash
GET /_cat/shards?v
# è¾“å‡ºæ˜¾ç¤ºå¤šä¸ªåˆ†ç‰‡çŠ¶æ€ä¸º UNASSIGNED
```

**ğŸ”§ æ’æŸ¥æ­¥éª¤**ï¼š

**æ­¥éª¤ 1ï¸âƒ£**ï¼šæŸ¥çœ‹å…·ä½“åŸå› 
```bash
GET /_cluster/allocation/explain
```

**æ­¥éª¤ 2ï¸âƒ£**ï¼šæ ¹æ®åŸå› è§£å†³
```bash
# å¦‚æœæ˜¯ç£ç›˜ç©ºé—´ä¸è¶³
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.disk.watermark.low": "90%",
    "cluster.routing.allocation.disk.watermark.high": "95%"
  }
}

# å¦‚æœæ˜¯èŠ‚ç‚¹ç¦»çº¿
POST /_cluster/reroute?retry_failed=true
```

### 6.2 æ¡ˆä¾‹2ï¼šåˆ†ç‰‡æ¢å¤ç¼“æ…¢


**ğŸ“Š é—®é¢˜åˆ†æ**ï¼š
```bash
# æ£€æŸ¥æ¢å¤è¿›åº¦
GET /_cat/recovery?v&active_only=true

# æ£€æŸ¥ç½‘ç»œå’ŒIOçŠ¶æ€
GET /_nodes/stats/indices/recovery
```

**âš¡ åŠ é€Ÿæ¢å¤æ–¹æ¡ˆ**ï¼š
```bash
# ä¸´æ—¶æé«˜æ¢å¤å¹¶å‘æ•°
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.node_concurrent_recoveries": 4,
    "indices.recovery.max_bytes_per_sec": "100mb"
  }
}
```

### 6.3 æ¡ˆä¾‹3ï¼šåˆ†ç‰‡åˆ†å¸ƒä¸å‡


**ğŸ“ˆ æ£€æŸ¥åˆ†å¸ƒæƒ…å†µ**ï¼š
```bash
# æŒ‰èŠ‚ç‚¹æŸ¥çœ‹åˆ†ç‰‡åˆ†å¸ƒ
GET /_cat/shards?v&h=index,shard,prirep,node&s=node
```

**âš–ï¸ æ‰‹åŠ¨é‡å¹³è¡¡**ï¼š
```bash
# ç§»åŠ¨åˆ†ç‰‡åˆ°å…¶ä»–èŠ‚ç‚¹
POST /_cluster/reroute
{
  "commands": [
    {
      "move": {
        "index": "my_index",
        "shard": 0,
        "from_node": "node-1",
        "to_node": "node-2"
      }
    }
  ]
}
```

### 6.4 å¸¸ç”¨æ•…éšœæ’é™¤å‘½ä»¤æ¸…å•


| é—®é¢˜ç±»å‹ | æ£€æŸ¥å‘½ä»¤ | è§£å†³å‘½ä»¤ |
|----------|----------|----------|
| åˆ†ç‰‡æœªåˆ†é… | `GET /_cluster/allocation/explain` | `POST /_cluster/reroute?retry_failed=true` |
| æ¢å¤ç¼“æ…¢ | `GET /_cat/recovery?v&active_only=true` | è°ƒæ•´å¹¶å‘è®¾ç½® |
| åˆ†å¸ƒä¸å‡ | `GET /_cat/shards?v&s=node` | æ‰‹åŠ¨moveåˆ†ç‰‡ |
| ç£ç›˜å‘Šè­¦ | `GET /_cat/allocation?v&h=node,disk.*` | è°ƒæ•´æ°´ä½çº¿è®¾ç½® |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```bash
ğŸ” æ—¥å¸¸æ£€æŸ¥å‘½ä»¤:
GET /_cat/shards?v                    # æŸ¥çœ‹åˆ†ç‰‡çŠ¶æ€
GET /_cluster/health?level=shards     # é›†ç¾¤åˆ†ç‰‡å¥åº·åº¦
GET /_cat/recovery?v&active_only=true # æ¢å¤è¿›åº¦

ğŸ› ï¸ æ•…éšœå¤„ç†å‘½ä»¤:
GET /_cluster/allocation/explain      # åˆ†é…å¤±è´¥åŸå› 
POST /_cluster/reroute?retry_failed=true # é‡è¯•åˆ†é…
POST /_cluster/reroute               # æ‰‹åŠ¨è·¯ç”±

ğŸ”„ ç»´æŠ¤æ“ä½œå‘½ä»¤:
POST /_refresh                       # åˆ·æ–°ç´¢å¼•
POST /_flush                         # æŒä¹…åŒ–æ•°æ®
GET /_cat/segments?v                 # æŸ¥çœ‹æ®µä¿¡æ¯
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ åˆ†ç‰‡çŠ¶æ€å«ä¹‰**ï¼š
- `ğŸŸ¢ STARTED` = æ­£å¸¸å·¥ä½œ
- `ğŸŸ¡ INITIALIZING/RELOCATING` = ä¸´æ—¶çŠ¶æ€ï¼Œè€å¿ƒç­‰å¾…
- `ğŸ”´ UNASSIGNED` = éœ€è¦æ’æŸ¥å¤„ç†

**ğŸ”¹ åˆ†ç‰‡åˆ†é…åŸåˆ™**ï¼š
- ä¸»å‰¯åˆ†ç‰‡ä¸èƒ½åœ¨åŒä¸€èŠ‚ç‚¹
- åˆ†ç‰‡å¤§å°æ§åˆ¶åœ¨10-50GBä¹‹é—´
- åˆ†ç‰‡æ•°é‡ = æ•°æ®é‡ Ã· å•åˆ†ç‰‡ç›®æ ‡å¤§å°

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š
- åˆç†è®¾ç½®åˆ†ç‰‡æ•°é‡
- ä½¿ç”¨è·¯ç”±ä¼˜åŒ–æŸ¥è¯¢
- å®šæœŸç›‘æ§åˆ†ç‰‡åˆ†å¸ƒ
- åŠæ—¶å¤„ç†UNASSIGNEDåˆ†ç‰‡

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°æ‰‹å»ºè®®**ï¼š
1. **å…ˆè§‚å¯Ÿå†åŠ¨æ‰‹** - ç”¨ `_cat/shards` äº†è§£ç°çŠ¶
2. **ç†è§£åå†æ“ä½œ** - ç”¨ `allocation/explain` ææ¸…æ¥šåŸå› 
3. **å°æ­¥å¿«è·‘** - ä¸€æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°
4. **åšå¥½å¤‡ä»½** - é‡è¦æ“ä½œå‰å…ˆå¤‡ä»½æ•°æ®

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- æ‰‹åŠ¨åˆ†ç‰‡è·¯ç”±å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
- é¢‘ç¹refreshå½±å“æ€§èƒ½
- åˆ†ç‰‡æ•°é‡è®¾ç½®åéš¾ä»¥ä¿®æ”¹
- ç”Ÿäº§ç¯å¢ƒæ“ä½œéœ€è¦å›¢é˜Ÿè¯„ä¼°

**ğŸš€ è¿›é˜¶æ–¹å‘**ï¼š
- å­¦ä¹ ç´¢å¼•æ¨¡æ¿ç®¡ç†åˆ†ç‰‡è®¾ç½®
- æŒæ¡ILMç”Ÿå‘½å‘¨æœŸç®¡ç†
- äº†è§£è·¨é›†ç¾¤å¤åˆ¶å’Œåˆ†ç‰‡åˆ†é…
- ç ”ç©¶åˆ†ç‰‡è·¯ç”±ç®—æ³•ä¼˜åŒ–

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
åˆ†ç‰‡çŠ¶æ€è¦å¸¸çœ‹ï¼ŒUNASSIGNEDå¿«æ’æŸ¥
åˆ†é…åŸå› å…ˆææ¸…ï¼Œæ‰‹åŠ¨è·¯ç”±éœ€è°¨æ…  
åˆ·æ–°æ“ä½œåˆ«å¤ªé¢‘ï¼Œæ®µä¿¡æ¯åŠ©ä¼˜åŒ–
åˆ†ç‰‡å¤§å°æœ‰æ ‡å‡†ï¼Œè·¯ç”±ç­–ç•¥ææ•ˆç‡
```