---
title: 35、系统信息查询
---
## 📚 目录

1. [Elasticsearch系统信息查询概述](#1-Elasticsearch系统信息查询概述)
2. [集群基础信息查询](#2-集群基础信息查询)
3. [节点详细信息查询](#3-节点详细信息查询)
4. [许可证与功能信息](#4-许可证与功能信息)
5. [安全与用户信息](#5-安全与用户信息)
6. [监控与统计信息](#6-监控与统计信息)
7. [实用调试技巧](#7-实用调试技巧)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔍 Elasticsearch系统信息查询概述


### 1.1 什么是系统信息查询

**简单理解**：就像给你的电脑查看"系统属性"一样，Elasticsearch也提供了各种命令来查看集群的"健康状况"和"基本信息"。

```
想象一下：
你买了一台新电脑 → 查看系统信息了解配置
你部署了ES集群 → 查看集群信息了解状态

作用：
✅ 了解集群运行状态
✅ 检查功能是否正常
✅ 监控性能指标
✅ 排查问题故障
```

### 1.2 为什么需要这些查询命令

**实际场景举例**：
- **运维同学**：集群今天怎么这么慢？先查查基本信息
- **开发同学**：我的搜索功能报错了，看看ES状态正常吗？
- **DBA同学**：需要了解当前许可证支持哪些功能

> 💡 **新手提示**：这些命令就像医生给病人做体检，通过各种"检查项目"了解ES集群的"身体状况"

### 1.3 命令分类一览

```
基础信息类：
├── GET /                    # 集群基本信息（最常用）
├── GET /_cluster/stats      # 集群统计信息
└── GET /_nodes/stats        # 节点统计信息

功能信息类：
├── GET /_license            # 许可证信息
├── GET /_xpack             # X-Pack功能信息
└── GET /_ml/info           # 机器学习信息

安全信息类：
├── GET /_security/user/_current  # 当前用户
└── GET /_security/role          # 角色信息

监控统计类：
├── GET /_transform/_stats       # 数据转换统计
└── GET /_monitoring/bulk       # 监控数据
```

---

## 2. 🏠 集群基础信息查询


### 2.1 查看集群根信息 - GET /

**这是什么**：最基础的命令，查看ES集群的"身份证"信息

```bash
# 最简单的查询命令
GET /
```

**返回信息解读**：
```json
{
  "name": "node-1",              # 节点名称
  "cluster_name": "my-cluster",   # 集群名称  
  "cluster_uuid": "abc123...",    # 集群唯一ID
  "version": {
    "number": "8.10.0",          # ES版本号
    "build_flavor": "default",    # 构建类型
    "build_type": "tar",         # 安装方式
    "build_hash": "def456...",    # 构建哈希
    "build_date": "2023-09-15",  # 构建日期
    "build_snapshot": false,      # 是否快照版本
    "lucene_version": "9.7.0"    # Lucene版本
  },
  "tagline": "You Know, for Search"  # ES标语
}
```

> 🔥 **重点理解**：
> - **cluster_name**：确认连接的是哪个集群
> - **version.number**：版本信息，影响功能支持
> - **name**：当前响应的节点名称

### 2.2 集群详细统计 - GET /_cluster/stats

**这是什么**：查看集群的"体检报告"，包含节点数量、索引统计、存储使用等

```bash
GET /_cluster/stats
```

**关键信息解读**：
```
返回信息包含：
┌─────────────────────┐
│     集群概览         │
├─────────────────────┤
│ 节点数量统计         │  ← 多少个节点在工作
├─────────────────────┤
│ 索引统计信息         │  ← 有多少索引、文档
├─────────────────────┤
│ 存储使用情况         │  ← 磁盘空间使用
├─────────────────────┤
│ 内存使用统计         │  ← JVM内存状态
└─────────────────────┘
```

**新手重点关注字段**：
```json
{
  "nodes": {
    "count": {
      "total": 3,           # 总节点数
      "master": 3,          # 主节点候选数
      "data": 3             # 数据节点数
    }
  },
  "indices": {
    "count": 10,            # 索引总数
    "docs": {
      "count": 1000000      # 文档总数
    },
    "store": {
      "size_in_bytes": 5368709120  # 存储大小(字节)
    }
  }
}
```

### 2.3 指定节点统计 - GET /_cluster/stats/nodes/{node_id}

**这是什么**：针对特定节点查看详细信息，就像给某个员工单独体检

```bash
# 查看特定节点的统计信息
GET /_cluster/stats/nodes/node-1

# 也可以使用节点ID
GET /_cluster/stats/nodes/abc123-def456-789
```

**应用场景**：
- 某个节点性能异常，需要单独检查
- 负载均衡时，查看各节点压力分布
- 扩容前评估单节点处理能力

---

## 3. 📊 节点详细信息查询


### 3.1 节点基本信息

**查看所有节点列表**：
```bash
GET /_cat/nodes?v
```

**输出示例**：
```
ip        heap.percent ram.percent cpu load_1m node.role master name
10.0.0.1           45          78   2    0.15 mdi       *      node-1
10.0.0.2           52          82   1    0.08 mdi       -      node-2
10.0.0.3           38          65   0    0.05 mdi       -      node-3
```

> 📝 **字段含义**：
> - **heap.percent**：JVM堆内存使用百分比
> - **ram.percent**：系统内存使用百分比
> - **cpu**：CPU使用率
> - **node.role**：节点角色（m=master, d=data, i=ingest）
> - **master**：`*`表示当前主节点

### 3.2 节点详细统计信息

```bash
# 查看所有节点详细统计
GET /_nodes/stats

# 查看特定节点统计  
GET /_nodes/node-1/stats

# 只查看特定指标
GET /_nodes/stats/jvm,os,process
```

**重要监控指标**：
```
JVM相关：
├── heap_used_percent        # 堆内存使用率
├── gc.collectors.young     # 年轻代GC情况
└── gc.collectors.old       # 老年代GC情况

系统相关：
├── os.cpu.percent          # CPU使用率
├── os.mem.used_percent     # 内存使用率
└── os.load_average         # 系统负载

进程相关：
├── process.cpu.percent     # 进程CPU使用率
├── process.mem.total       # 进程内存使用
└── process.open_file_descriptors  # 打开文件数
```

---

## 4. 🔐 许可证与功能信息


### 4.1 基础许可状态 - GET /_license/basic_status

**这是什么**：查看当前ES使用的许可证类型和状态

```bash
GET /_license/basic_status
```

**返回信息理解**：
```json
{
  "eligible_to_start_basic": true    # 是否可以使用基础许可
}
```

> 💡 **许可证类型简单理解**：
> - **Basic（基础版）**：免费，基本搜索功能
> - **Gold（黄金版）**：付费，包含安全、监控功能  
> - **Platinum（白金版）**：付费，包含机器学习功能

### 4.2 完整许可信息 - GET /_license

```bash
GET /_license
```

**关键信息解读**：
```json
{
  "license": {
    "status": "active",           # 许可状态：active/expired
    "uid": "abc-123-def",         # 许可唯一ID
    "type": "basic",              # 许可类型
    "issue_date": "2023-01-01",   # 发行日期
    "issue_date_in_millis": 1672531200000,
    "expiry_date": "2024-01-01",  # 过期日期（basic永不过期）
    "max_nodes": 1000,            # 最大节点数
    "issued_to": "my-company",    # 许可持有者
    "issuer": "elasticsearch"     # 发行者
  }
}
```

### 4.3 X-Pack功能信息 - GET /_xpack

**这是什么**：X-Pack是ES的功能扩展包，包含安全、监控、机器学习等高级功能

```bash
GET /_xpack
```

**功能模块解读**：
```json
{
  "build": {
    "hash": "abc123",
    "date": "2023-09-15"
  },
  "features": {
    "security": {
      "available": true,          # 安全功能是否可用
      "enabled": true             # 安全功能是否启用
    },
    "monitoring": {
      "available": true,          # 监控功能是否可用
      "enabled": true             # 监控功能是否启用
    },
    "ml": {
      "available": false,         # 机器学习功能（需要付费许可）
      "enabled": false
    }
  }
}
```

---

## 5. 👤 安全与用户信息


### 5.1 当前用户信息 - GET /_security/user/_current

**这是什么**：查看当前登录用户的身份和权限信息

```bash
GET /_security/user/_current
```

**返回信息理解**：
```json
{
  "username": "admin",           # 用户名
  "roles": ["superuser"],        # 用户角色
  "full_name": "Administrator",  # 全名
  "email": "admin@company.com",  # 邮箱
  "metadata": {},               # 元数据
  "enabled": true,              # 是否启用
  "authentication_realm": {     # 认证域信息
    "name": "native",
    "type": "native"
  }
}
```

> ⚠️ **注意**：此命令只在启用了安全功能时可用

### 5.2 用户权限检查实例

**检查用户访问权限**：
```bash
# 检查对特定索引的权限
GET /_security/user/_has_privileges
{
  "index": [
    {
      "names": ["my-index"],
      "privileges": ["read", "write"]
    }
  ]
}
```

---

## 6. 📈 监控与统计信息


### 6.1 机器学习信息 - GET /_ml/info

**这是什么**：查看机器学习功能的配置和限制信息

```bash
GET /_ml/info
```

**关键信息**：
```json
{
  "defaults": {
    "anomaly_detectors": {
      "model_memory_limit": "1gb",    # 默认模型内存限制
      "categorization_examples_limit": 4  # 分类示例限制
    }
  },
  "limits": {
    "max_model_memory_limit": "2gb"   # 最大模型内存限制
  },
  "native_code": {
    "version": "8.10.0",             # 原生代码版本
    "build_hash": "abc123"           # 构建哈希
  }
}
```

### 6.2 数据转换统计 - GET /_transform/_stats

**这是什么**：Transform是ES的数据转换功能，可以将索引数据聚合转换为新的索引

```bash
# 查看所有转换任务统计
GET /_transform/_stats

# 查看特定转换任务
GET /_transform/my-transform/_stats
```

**统计信息包含**：
```
转换任务状态：
├── state                    # 任务状态：started/stopped/failed
├── documents_processed      # 已处理文档数
├── documents_indexed        # 已索引文档数
├── trigger_count           # 触发次数
├── pages_processed         # 已处理页数
└── processing_time_in_ms   # 处理时间(毫秒)
```

### 6.3 监控批量API - GET /_monitoring/bulk

**这是什么**：查看监控数据的批量处理情况

```bash
GET /_monitoring/bulk
```

**应用场景**：
- 监控系统性能分析
- 批量数据处理状态检查
- 系统健康度评估

---

## 7. 🛠️ 实用调试技巧


### 7.1 快速健康检查流程

**新手推荐的检查顺序**：

```
步骤1：基础连通性检查
GET /                        # 确认ES可访问

步骤2：集群状态检查  
GET /_cluster/health         # 查看集群健康状态

步骤3：节点状态检查
GET /_cat/nodes?v           # 查看节点运行情况

步骤4：详细信息查看
GET /_cluster/stats         # 查看集群详细统计
```

### 7.2 常见问题排查

**🔍 场景1：集群响应慢**
```bash
# 检查节点资源使用
GET /_nodes/stats/jvm,os

# 查看关键指标
关注点：
- heap_used_percent > 85%    # 堆内存过高
- cpu.percent > 80%          # CPU使用率过高
- load_average 持续 > 核心数  # 系统负载过高
```

**🔍 场景2：功能异常**
```bash
# 检查许可证状态
GET /_license

# 检查X-Pack功能
GET /_xpack

# 确认功能是否available和enabled
```

**🔍 场景3：权限问题**
```bash
# 检查当前用户
GET /_security/user/_current

# 检查用户权限
GET /_security/user/_has_privileges
```

### 7.3 监控指标阈值参考

**⚠️ 警告阈值**：
```
JVM堆内存使用率：
🟢 < 70%     正常
🟡 70-85%    注意  
🔴 > 85%     警告

CPU使用率：
🟢 < 60%     正常
🟡 60-80%    注意
🔴 > 80%     警告

磁盘使用率：
🟢 < 80%     正常
🟡 80-90%    注意
🔴 > 90%     警告
```

---

## 8. 📋 核心要点总结


### 8.1 必知必会的命令

```
🔸 GET /                           # 最基础，查看ES版本和集群信息
🔸 GET /_cluster/health           # 集群健康状态（绿/黄/红）  
🔸 GET /_cluster/stats            # 集群详细统计信息
🔸 GET /_cat/nodes?v             # 节点列表和状态
🔸 GET /_license                  # 许可证信息
🔸 GET /_security/user/_current   # 当前用户信息
```

### 8.2 实用记忆技巧

**🔹 命令规律**：
```
基础信息：GET /                    # 根路径最简单
集群相关：GET /_cluster/...        # cluster前缀
节点相关：GET /_nodes/...          # nodes前缀  
安全相关：GET /_security/...       # security前缀
功能相关：GET /_xpack, /_ml/...    # 功能名前缀
```

**🔹 调试思路**：
```
问题排查步骤：
连通性 → 健康状态 → 资源使用 → 功能状态 → 权限检查
   ↓        ↓         ↓         ↓         ↓
  GET /  → health → nodes stats → xpack → user
```

### 8.3 新手注意事项

> 💡 **重要提醒**：
> - 这些查询命令都是**只读操作**，不会修改数据，可以放心使用
> - 大部分命令支持`?pretty`参数，让输出更易读
> - 某些命令需要特定权限，如安全相关命令需要security功能启用

### 8.4 实际应用价值

**📊 运维场景**：
- **日常巡检**：定时执行健康检查命令
- **故障排查**：快速定位性能瓶颈
- **容量规划**：基于统计数据做扩容决策

**👨‍💻 开发场景**：
- **环境确认**：确保连接正确的ES集群
- **功能验证**：检查所需功能是否可用
- **性能监控**：监控应用对ES的影响

**核心记忆**：
- 系统信息查询是ES运维的基础技能
- 掌握基础命令，组合使用解决复杂问题
- 定期检查有助于提前发现潜在问题
- 理解返回字段含义，数据才有价值