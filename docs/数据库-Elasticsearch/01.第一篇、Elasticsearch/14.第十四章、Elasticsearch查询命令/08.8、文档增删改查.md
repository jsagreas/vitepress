---
title: 8ã€æ–‡æ¡£å¢åˆ æ”¹æŸ¥
---
## ğŸ“š ç›®å½•

1. [æ–‡æ¡£æ“ä½œåŸºç¡€æ¦‚å¿µ](#1-æ–‡æ¡£æ“ä½œåŸºç¡€æ¦‚å¿µ)
2. [åˆ›å»ºæ–‡æ¡£æ“ä½œ](#2-åˆ›å»ºæ–‡æ¡£æ“ä½œ)
3. [è¯»å–æ–‡æ¡£æ“ä½œ](#3-è¯»å–æ–‡æ¡£æ“ä½œ)
4. [æ›´æ–°æ–‡æ¡£æ“ä½œ](#4-æ›´æ–°æ–‡æ¡£æ“ä½œ)
5. [åˆ é™¤æ–‡æ¡£æ“ä½œ](#5-åˆ é™¤æ–‡æ¡£æ“ä½œ)
6. [æ–‡æ¡£å­˜åœ¨æ€§æ£€æŸ¥](#6-æ–‡æ¡£å­˜åœ¨æ€§æ£€æŸ¥)
7. [æ‰¹é‡æ–‡æ¡£æ“ä½œ](#7-æ‰¹é‡æ–‡æ¡£æ“ä½œ)
8. [å®æˆ˜åº”ç”¨åœºæ™¯](#8-å®æˆ˜åº”ç”¨åœºæ™¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“– æ–‡æ¡£æ“ä½œåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Elasticsearchæ–‡æ¡£

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ–‡æ¡£ï¼ˆDocumentï¼‰å°±åƒæ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œæ˜¯Elasticsearchä¸­å­˜å‚¨æ•°æ®çš„åŸºæœ¬å•ä½

**é€šä¿—ç†è§£**ï¼š
```
ä¼ ç»Ÿæ•°æ®åº“        Elasticsearch
æ•°æ®åº“(Database)  ç´¢å¼•(Index)
è¡¨(Table)        ç±»å‹(Typeï¼Œå·²åºŸå¼ƒ)
è¡Œ(Row)          æ–‡æ¡£(Document)
åˆ—(Column)       å­—æ®µ(Field)
```

**æ–‡æ¡£çš„ç‰¹ç‚¹**ï¼š
- ğŸ”¸ **JSONæ ¼å¼**ï¼šæ‰€æœ‰æ–‡æ¡£éƒ½ç”¨JSONæ ¼å¼å­˜å‚¨
- ğŸ”¸ **å”¯ä¸€æ ‡è¯†**ï¼šæ¯ä¸ªæ–‡æ¡£éƒ½æœ‰å”¯ä¸€çš„ID
- ğŸ”¸ **åŠ¨æ€ç»“æ„**ï¼šå¯ä»¥éšæ—¶æ·»åŠ æ–°å­—æ®µ
- ğŸ”¸ **å…¨æ–‡æœç´¢**ï¼šæ”¯æŒå¤æ‚çš„æœç´¢æŸ¥è¯¢

### 1.2 æ–‡æ¡£IDçš„æ¦‚å¿µ

**ä»€ä¹ˆæ˜¯æ–‡æ¡£ID**ï¼š
- **ä½œç”¨**ï¼šå°±åƒèº«ä»½è¯å·ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ–‡æ¡£
- **ç±»å‹**ï¼šå¯ä»¥æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ä»»æ„æ ¼å¼
- **æ¥æº**ï¼šå¯ä»¥è‡ªå·±æŒ‡å®šï¼Œä¹Ÿå¯ä»¥è®©ESè‡ªåŠ¨ç”Ÿæˆ

**IDç¤ºä¾‹å¯¹æ¯”**ï¼š
```
è‡ªå®šä¹‰IDï¼šuser001, product_123, order-2024-001
è‡ªåŠ¨ç”Ÿæˆï¼šBWlGl4QBxH8-6nFf8n7v (ESè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²)
```

### 1.3 RESTful APIåŸºç¡€

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šElasticsearchä½¿ç”¨HTTPè¯·æ±‚æ¥æ“ä½œæ•°æ®ï¼Œä¸åŒçš„HTTPæ–¹æ³•ä»£è¡¨ä¸åŒçš„æ“ä½œ

**HTTPæ–¹æ³•å¯¹åº”çš„æ“ä½œ**ï¼š
- `PUT` â†’ åˆ›å»ºæˆ–å®Œå…¨æ›¿æ¢
- `POST` â†’ åˆ›å»ºæˆ–éƒ¨åˆ†æ›´æ–°  
- `GET` â†’ æŸ¥è¯¢è·å–
- `DELETE` â†’ åˆ é™¤
- `HEAD` â†’ æ£€æŸ¥å­˜åœ¨æ€§

---

## 2. ğŸ“ åˆ›å»ºæ–‡æ¡£æ“ä½œ


### 2.1 æŒ‡å®šIDåˆ›å»ºæ–‡æ¡£

> â­ **é‡è¦åº¦**ï¼šâ­â­â­ æœ€å¸¸ç”¨çš„åˆ›å»ºæ–¹å¼

**åŸºæœ¬è¯­æ³•**ï¼š
```http
PUT /{ç´¢å¼•å}/_doc/{æ–‡æ¡£ID}
```

**å®é™…ç¤ºä¾‹**ï¼š
```json
PUT /users/_doc/001
{
  "name": "å¼ ä¸‰",
  "age": 25,
  "email": "zhangsan@example.com",
  "department": "æŠ€æœ¯éƒ¨"
}
```

**æ“ä½œç»“æœè§£é‡Š**ï¼š
```json
{
  "_index": "users",     // æ–‡æ¡£æ‰€åœ¨çš„ç´¢å¼•
  "_id": "001",          // æ–‡æ¡£ID
  "_version": 1,         // ç‰ˆæœ¬å·ï¼ˆç¬¬ä¸€æ¬¡åˆ›å»ºä¸º1ï¼‰
  "result": "created",   // æ“ä½œç»“æœï¼šcreatedè¡¨ç¤ºæ–°å»º
  "_shards": {           // åˆ†ç‰‡ä¿¡æ¯
    "total": 2,
    "successful": 1,
    "failed": 0
  }
}
```

### 2.2 è‡ªåŠ¨ç”ŸæˆIDåˆ›å»ºæ–‡æ¡£

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šå½“ä½ ä¸éœ€è¦è‡ªå®šä¹‰IDæ—¶ï¼Œè®©ESè‡ªåŠ¨ç”Ÿæˆ

**åŸºæœ¬è¯­æ³•**ï¼š
```http
POST /{ç´¢å¼•å}/_doc
```

**å®é™…ç¤ºä¾‹**ï¼š
```json
POST /users/_doc
{
  "name": "æå››",
  "age": 28,
  "email": "lisi@example.com",
  "department": "é”€å”®éƒ¨"
}
```

**è¿”å›ç»“æœ**ï¼š
```json
{
  "_index": "users",
  "_id": "BWlGl4QBxH8-6nFf8n7v",  // ESè‡ªåŠ¨ç”Ÿæˆçš„ID
  "_version": 1,
  "result": "created"
}
```

### 2.3 åˆ›å»ºæ“ä½œçš„æ³¨æ„äº‹é¡¹


**é‡è¦æé†’**ï¼š
> âš ï¸ **æ³¨æ„**ï¼šä½¿ç”¨PUTæ–¹æ³•æ—¶ï¼Œå¦‚æœæ–‡æ¡£IDå·²å­˜åœ¨ï¼Œä¼šå®Œå…¨è¦†ç›–åŸæ–‡æ¡£ï¼

**å¯¹æ¯”ç¤ºä¾‹**ï¼š
```json
// ç¬¬ä¸€æ¬¡åˆ›å»º
PUT /users/_doc/001
{
  "name": "å¼ ä¸‰",
  "age": 25,
  "email": "zhangsan@example.com"
}

// ç¬¬äºŒæ¬¡PUTåŒæ ·çš„ID - ä¼šå®Œå…¨è¦†ç›–ï¼
PUT /users/_doc/001
{
  "name": "å¼ ä¸‰ä¸°",
  "department": "æ­¦å½“æ´¾"
}

// ç»“æœï¼šageå’Œemailå­—æ®µä¸¢å¤±äº†ï¼åªå‰©ä¸‹nameå’Œdepartment
```

**å®‰å…¨åˆ›å»ºæ–¹å¼**ï¼š
```json
// ä½¿ç”¨_createç¡®ä¿åªåˆ›å»ºæ–°æ–‡æ¡£
PUT /users/_create/001
{
  "name": "å¼ ä¸‰",
  "age": 25
}

// æˆ–è€…ä½¿ç”¨POST with op_type
POST /users/_doc/001?op_type=create
{
  "name": "å¼ ä¸‰",
  "age": 25
}
```

---

## 3. ğŸ” è¯»å–æ–‡æ¡£æ“ä½œ


### 3.1 æ ¹æ®IDè·å–å®Œæ•´æ–‡æ¡£

> â­ **é‡è¦åº¦**ï¼šâ­â­â­ æœ€åŸºç¡€çš„æŸ¥è¯¢æ“ä½œ

**åŸºæœ¬è¯­æ³•**ï¼š
```http
GET /{ç´¢å¼•å}/_doc/{æ–‡æ¡£ID}
```

**å®é™…ç¤ºä¾‹**ï¼š
```json
GET /users/_doc/001
```

**è¿”å›ç»“æœè§£é‡Š**ï¼š
```json
{
  "_index": "users",
  "_id": "001",
  "_version": 1,
  "_seq_no": 0,
  "_primary_term": 1,
  "found": true,        // æ˜¯å¦æ‰¾åˆ°æ–‡æ¡£
  "_source": {          // æ–‡æ¡£çš„åŸå§‹å†…å®¹
    "name": "å¼ ä¸‰",
    "age": 25,
    "email": "zhangsan@example.com",
    "department": "æŠ€æœ¯éƒ¨"
  }
}
```

### 3.2 åªè·å–æ–‡æ¡£æºæ•°æ®

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šå½“ä½ åªéœ€è¦æ–‡æ¡£å†…å®¹ï¼Œä¸éœ€è¦å…ƒæ•°æ®æ—¶

**åŸºæœ¬è¯­æ³•**ï¼š
```http
GET /{ç´¢å¼•å}/_source/{æ–‡æ¡£ID}
```

**å®é™…ç¤ºä¾‹**ï¼š
```json
GET /users/_source/001
```

**è¿”å›ç»“æœ**ï¼ˆåªæœ‰æ–‡æ¡£å†…å®¹ï¼‰ï¼š
```json
{
  "name": "å¼ ä¸‰",
  "age": 25,
  "email": "zhangsan@example.com",
  "department": "æŠ€æœ¯éƒ¨"
}
```

### 3.3 è·å–æŒ‡å®šå­—æ®µ

> ğŸ’¡ **ä¼˜åŠ¿**ï¼šå‡å°‘ç½‘ç»œä¼ è¾“ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡

**è·å–ç‰¹å®šå­—æ®µ**ï¼š
```http
GET /users/_doc/001?_source=name,email
```

**è¿”å›ç»“æœ**ï¼š
```json
{
  "_index": "users",
  "_id": "001",
  "_version": 1,
  "found": true,
  "_source": {
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com"
  }
}
```

**æ’é™¤ç‰¹å®šå­—æ®µ**ï¼š
```http
GET /users/_doc/001?_source_excludes=department
```

### 3.4 æ‰¹é‡è·å–æ–‡æ¡£

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šä¸€æ¬¡è·å–å¤šä¸ªæ–‡æ¡£ï¼Œæé«˜æ•ˆç‡

**åŸºæœ¬è¯­æ³•**ï¼š
```json
GET /_mget
{
  "docs": [
    {
      "_index": "users",
      "_id": "001"
    },
    {
      "_index": "users", 
      "_id": "002"
    }
  ]
}
```

**åŒä¸€ç´¢å¼•çš„ç®€åŒ–å†™æ³•**ï¼š
```json
GET /users/_mget
{
  "ids": ["001", "002", "003"]
}
```

---

## 4. âœï¸ æ›´æ–°æ–‡æ¡£æ“ä½œ


### 4.1 éƒ¨åˆ†æ›´æ–°æ–‡æ¡£

> â­ **é‡è¦åº¦**ï¼šâ­â­â­ å®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨çš„æ›´æ–°æ–¹å¼

**åŸºæœ¬è¯­æ³•**ï¼š
```http
POST /{ç´¢å¼•å}/_update/{æ–‡æ¡£ID}
```

**å®é™…ç¤ºä¾‹**ï¼š
```json
POST /users/_update/001
{
  "doc": {
    "age": 26,
    "phone": "138-0000-0000"
  }
}
```

**æ“ä½œç»“æœ**ï¼š
- âœ… ageä»25æ›´æ–°ä¸º26
- âœ… æ–°å¢phoneå­—æ®µ
- âœ… å…¶ä»–å­—æ®µä¿æŒä¸å˜

### 4.2 è„šæœ¬æ›´æ–°

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šéœ€è¦å¤æ‚é€»è¾‘æ›´æ–°æ—¶ï¼Œæ¯”å¦‚å­—æ®µè®¡ç®—

**å¢åŠ æ•°å€¼ç¤ºä¾‹**ï¼š
```json
POST /users/_update/001
{
  "script": {
    "source": "ctx._source.age += params.increment",
    "params": {
      "increment": 1
    }
  }
}
```

**æ¡ä»¶æ›´æ–°ç¤ºä¾‹**ï¼š
```json
POST /users/_update/001
{
  "script": {
    "source": "if (ctx._source.age < 30) { ctx._source.status = 'young' } else { ctx._source.status = 'mature' }"
  }
}
```

### 4.3 upsertæ“ä½œ

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šå¦‚æœæ–‡æ¡£å­˜åœ¨å°±æ›´æ–°ï¼Œä¸å­˜åœ¨å°±åˆ›å»º

**åŸºæœ¬ç¤ºä¾‹**ï¼š
```json
POST /users/_update/005
{
  "doc": {
    "name": "ç‹äº”",
    "age": 30
  },
  "upsert": {
    "name": "ç‹äº”",
    "age": 30,
    "department": "äººäº‹éƒ¨",
    "created_time": "2024-01-01"
  }
}
```

**æ‰§è¡Œé€»è¾‘**ï¼š
- å¦‚æœIDä¸º005çš„æ–‡æ¡£å­˜åœ¨ â†’ åªæ›´æ–°nameå’Œage
- å¦‚æœIDä¸º005çš„æ–‡æ¡£ä¸å­˜åœ¨ â†’ åˆ›å»ºæ–°æ–‡æ¡£ï¼Œä½¿ç”¨upsertä¸­çš„å®Œæ•´æ•°æ®

### 4.4 å®Œå…¨æ›¿æ¢æ–‡æ¡£

> âš ï¸ **è­¦å‘Š**ï¼šä¼šå®Œå…¨è¦†ç›–åŸæ–‡æ¡£ï¼Œæ…é‡ä½¿ç”¨

**ä½¿ç”¨PUTæ–¹æ³•**ï¼š
```json
PUT /users/_doc/001
{
  "name": "å¼ ä¸‰ä¸°",
  "age": 100,
  "martial_arts": "å¤ªææ‹³"
}
```

**ç»“æœ**ï¼šåŸæ–‡æ¡£çš„emailã€departmentç­‰å­—æ®µå…¨éƒ¨ä¸¢å¤±ï¼

---

## 5. ğŸ—‘ï¸ åˆ é™¤æ–‡æ¡£æ“ä½œ


### 5.1 æ ¹æ®IDåˆ é™¤å•ä¸ªæ–‡æ¡£

> â­ **é‡è¦åº¦**ï¼šâ­â­â­ åŸºç¡€åˆ é™¤æ“ä½œ

**åŸºæœ¬è¯­æ³•**ï¼š
```http
DELETE /{ç´¢å¼•å}/_doc/{æ–‡æ¡£ID}
```

**å®é™…ç¤ºä¾‹**ï¼š
```http
DELETE /users/_doc/001
```

**è¿”å›ç»“æœè§£é‡Š**ï¼š
```json
{
  "_index": "users",
  "_id": "001",
  "_version": 2,
  "result": "deleted",    // åˆ é™¤æˆåŠŸ
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  }
}
```

### 5.2 æŒ‰æŸ¥è¯¢æ¡ä»¶åˆ é™¤

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šæ‰¹é‡åˆ é™¤ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£

**åŸºæœ¬è¯­æ³•**ï¼š
```json
POST /{ç´¢å¼•å}/_delete_by_query
{
  "query": {
    "match": {
      "department": "é”€å”®éƒ¨"
    }
  }
}
```

**å®é™…ç¤ºä¾‹**ï¼š
```json
POST /users/_delete_by_query
{
  "query": {
    "range": {
      "age": {
        "lt": 18
      }
    }
  }
}
```

**æ“ä½œç»“æœ**ï¼š
```json
{
  "took": 30,
  "timed_out": false,
  "total": 5,           // æ€»å…±æ‰¾åˆ°5ä¸ªæ–‡æ¡£
  "deleted": 5,         // æˆåŠŸåˆ é™¤5ä¸ªæ–‡æ¡£
  "batches": 1,
  "version_conflicts": 0,
  "noops": 0
}
```

---

## 6. ğŸ” æ–‡æ¡£å­˜åœ¨æ€§æ£€æŸ¥


### 6.1 æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼šåœ¨æ‰§è¡Œæ“ä½œå‰å…ˆç¡®è®¤æ–‡æ¡£æ˜¯å¦å­˜åœ¨

**åŸºæœ¬è¯­æ³•**ï¼š
```http
HEAD /{ç´¢å¼•å}/_doc/{æ–‡æ¡£ID}
```

**å®é™…ç¤ºä¾‹**ï¼š
```http
HEAD /users/_doc/001
```

**ç»“æœåˆ¤æ–­**ï¼š
- **200 OK** â†’ æ–‡æ¡£å­˜åœ¨
- **404 Not Found** â†’ æ–‡æ¡£ä¸å­˜åœ¨

### 6.2 å®é™…åº”ç”¨åœºæ™¯


**æ¡ä»¶æ£€æŸ¥ç¤ºä¾‹**ï¼š
```bash
# å…ˆæ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨
curl -I "http://localhost:9200/users/_doc/001"

# æ ¹æ®è¿”å›çŠ¶æ€ç å†³å®šåç»­æ“ä½œ
if [ $? -eq 0 ]; then
    echo "æ–‡æ¡£å­˜åœ¨ï¼Œå¯ä»¥è¿›è¡Œæ›´æ–°æ“ä½œ"
    # æ‰§è¡Œæ›´æ–°æ“ä½œ
else
    echo "æ–‡æ¡£ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆåˆ›å»º"
    # æ‰§è¡Œåˆ›å»ºæ“ä½œ
fi
```

---

## 7. ğŸ“¦ æ‰¹é‡æ–‡æ¡£æ“ä½œ


### 7.1 æ‰¹é‡æ“ä½œçš„ä¼˜åŠ¿

> ğŸ’¡ **æ ¸å¿ƒä¼˜åŠ¿**ï¼šå‡å°‘ç½‘ç»œå¼€é”€ï¼Œæé«˜æ“ä½œæ•ˆç‡

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
å•ä¸ªæ“ä½œï¼š100ä¸ªæ–‡æ¡£ = 100æ¬¡HTTPè¯·æ±‚
æ‰¹é‡æ“ä½œï¼š100ä¸ªæ–‡æ¡£ = 1æ¬¡HTTPè¯·æ±‚
æ•ˆç‡æå‡ï¼šçº¦10-50å€
```

### 7.2 bulk APIåŸºæœ¬è¯­æ³•

**æ“ä½œæ ¼å¼**ï¼š
```json
POST /_bulk
{"action": {"_index": "ç´¢å¼•å", "_id": "æ–‡æ¡£ID"}}
{"field1": "value1", "field2": "value2"}
{"action": {"_index": "ç´¢å¼•å", "_id": "æ–‡æ¡£ID"}}
{"field1": "value1", "field2": "value2"}
```

### 7.3 æ‰¹é‡æ“ä½œå®ä¾‹


**æ··åˆæ“ä½œç¤ºä¾‹**ï¼š
```json
POST /users/_bulk
{"index": {"_id": "001"}}
{"name": "å¼ ä¸‰", "age": 25, "department": "æŠ€æœ¯éƒ¨"}
{"index": {"_id": "002"}}
{"name": "æå››", "age": 28, "department": "é”€å”®éƒ¨"}
{"update": {"_id": "001"}}
{"doc": {"phone": "138-0000-0000"}}
{"delete": {"_id": "003"}}
```

**æ“ä½œè¯´æ˜**ï¼š
- **ç¬¬1-2è¡Œ**ï¼šåˆ›å»ºIDä¸º001çš„æ–‡æ¡£
- **ç¬¬3-4è¡Œ**ï¼šåˆ›å»ºIDä¸º002çš„æ–‡æ¡£  
- **ç¬¬5-6è¡Œ**ï¼šæ›´æ–°IDä¸º001çš„æ–‡æ¡£ï¼Œæ·»åŠ phoneå­—æ®µ
- **ç¬¬7è¡Œ**ï¼šåˆ é™¤IDä¸º003çš„æ–‡æ¡£

### 7.4 æ‰¹é‡æ“ä½œæœ€ä½³å®è·µ


> ğŸ“ **æœ€ä½³å®è·µ**ï¼š
> - æ¯æ‰¹å¤„ç†1000-5000ä¸ªæ–‡æ¡£
> - æ¯æ‰¹æ•°æ®å¤§å°æ§åˆ¶åœ¨5-15MB
> - ç›‘æ§rejectedçº¿ç¨‹æ± ï¼Œé¿å…è¿‡è½½

**æ‰¹é‡æ“ä½œé”™è¯¯å¤„ç†**ï¼š
```json
{
  "took": 30,
  "errors": true,
  "items": [
    {
      "index": {
        "_index": "users",
        "_id": "001",
        "status": 201,
        "result": "created"
      }
    },
    {
      "index": {
        "_index": "users", 
        "_id": "002",
        "status": 400,
        "error": {
          "type": "version_conflict_engine_exception",
          "reason": "version conflict"
        }
      }
    }
  ]
}
```

---

## 8. ğŸš€ å®æˆ˜åº”ç”¨åœºæ™¯


### 8.1 ç”¨æˆ·ç®¡ç†ç³»ç»Ÿç¤ºä¾‹


**åœºæ™¯æè¿°**ï¼šæ„å»ºä¸€ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿçš„æ–‡æ¡£æ“ä½œ

**1. ç”¨æˆ·æ³¨å†Œï¼ˆåˆ›å»ºæ–‡æ¡£ï¼‰**ï¼š
```json
POST /users/_doc
{
  "username": "john_doe",
  "email": "john@example.com",
  "real_name": "çº¦ç¿°Â·å¤š",
  "age": 28,
  "status": "active",
  "created_time": "2024-01-15T10:30:00",
  "profile": {
    "bio": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
    "interests": ["ç¼–ç¨‹", "éŸ³ä¹", "æ—…è¡Œ"]
  }
}
```

**2. ç”¨æˆ·ä¿¡æ¯æ›´æ–°**ï¼š
```json
POST /users/_update/BWlGl4QBxH8-6nFf8n7v
{
  "doc": {
    "age": 29,
    "profile": {
      "bio": "é«˜çº§è½¯ä»¶å·¥ç¨‹å¸ˆ", 
      "location": "åŒ—äº¬"
    }
  }
}
```

**3. ç”¨æˆ·ç™»å½•è®°å½•æ›´æ–°**ï¼š
```json
POST /users/_update/BWlGl4QBxH8-6nFf8n7v
{
  "script": {
    "source": "ctx._source.login_count += 1; ctx._source.last_login = params.current_time",
    "params": {
      "current_time": "2024-01-20T09:15:00"
    }
  }
}
```

### 8.2 ç”µå•†å•†å“ç®¡ç†ç¤ºä¾‹


**å•†å“ä¿¡æ¯ç»“æ„**ï¼š
```json
PUT /products/_doc/prod_001
{
  "title": "iPhone 15 Pro",
  "category": "æ‰‹æœºæ•°ç ",
  "brand": "Apple",
  "price": 7999.00,
  "stock": 50,
  "description": "æœ€æ–°æ¬¾iPhoneï¼Œæ­è½½A17èŠ¯ç‰‡",
  "tags": ["æ‰‹æœº", "è‹¹æœ", "5G"],
  "images": [
    "http://example.com/img1.jpg",
    "http://example.com/img2.jpg"
  ],
  "created_time": "2024-01-15T08:00:00",
  "updated_time": "2024-01-15T08:00:00"
}
```

**åº“å­˜æ›´æ–°æ“ä½œ**ï¼š
```json
POST /products/_update/prod_001
{
  "script": {
    "source": "ctx._source.stock -= params.sold_quantity; ctx._source.updated_time = params.update_time",
    "params": {
      "sold_quantity": 2,
      "update_time": "2024-01-20T14:30:00"
    }
  }
}
```

### 8.3 æ—¥å¿—ç³»ç»Ÿç¤ºä¾‹


**æ—¥å¿—æ–‡æ¡£ç»“æ„**ï¼š
```json
POST /app_logs/_doc
{
  "timestamp": "2024-01-20T10:15:30.123Z",
  "level": "ERROR",
  "service": "user-service", 
  "message": "Database connection timeout",
  "user_id": "user_12345",
  "request_id": "req_abcdef",
  "details": {
    "error_code": "DB_TIMEOUT",
    "retry_count": 3,
    "duration_ms": 5000
  }
}
```

**æ—¥å¿—èšåˆæ›´æ–°**ï¼š
```json
POST /error_stats/_update/2024-01-20
{
  "script": {
    "source": "ctx._source.error_count += 1; if (ctx._source.error_types.containsKey(params.error_type)) { ctx._source.error_types[params.error_type] += 1 } else { ctx._source.error_types[params.error_type] = 1 }",
    "params": {
      "error_type": "DB_TIMEOUT"
    }
  },
  "upsert": {
    "date": "2024-01-20",
    "error_count": 1,
    "error_types": {
      "DB_TIMEOUT": 1
    }
  }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 æ–‡æ¡£æ“ä½œå‘½ä»¤é€ŸæŸ¥è¡¨


| æ“ä½œç±»å‹ | HTTPæ–¹æ³• | APIè·¯å¾„ | ä¸»è¦ç”¨é€” |
|---------|---------|---------|----------|
| **åˆ›å»º** | `PUT` | `/{index}/_doc/{id}` | æŒ‡å®šIDåˆ›å»º/æ›¿æ¢æ–‡æ¡£ |
| **åˆ›å»º** | `POST` | `/{index}/_doc` | è‡ªåŠ¨IDåˆ›å»ºæ–‡æ¡£ |
| **æŸ¥è¯¢** | `GET` | `/{index}/_doc/{id}` | è·å–å®Œæ•´æ–‡æ¡£ |
| **æŸ¥è¯¢** | `GET` | `/{index}/_source/{id}` | åªè·å–æ–‡æ¡£æº |
| **æ›´æ–°** | `POST` | `/{index}/_update/{id}` | éƒ¨åˆ†æ›´æ–°æ–‡æ¡£ |
| **åˆ é™¤** | `DELETE` | `/{index}/_doc/{id}` | åˆ é™¤å•ä¸ªæ–‡æ¡£ |
| **æ£€æŸ¥** | `HEAD` | `/{index}/_doc/{id}` | æ£€æŸ¥æ–‡æ¡£å­˜åœ¨ |
| **æ‰¹é‡** | `POST` | `/_bulk` | æ‰¹é‡æ“ä½œæ–‡æ¡£ |

### 9.2 æ ¸å¿ƒæ¦‚å¿µç†è§£


**ğŸ”¸ æ–‡æ¡£IDçš„é‡è¦æ€§**ï¼š
```
è‡ªå®šä¹‰IDä¼˜åŠ¿ï¼š
âœ… ä¾¿äºä¸šåŠ¡é€»è¾‘å…³è”
âœ… æ”¯æŒå¹‚ç­‰æ“ä½œ
âœ… ä¾¿äºç¼“å­˜å’Œå¼•ç”¨

è‡ªåŠ¨IDä¼˜åŠ¿ï¼š
âœ… æ— éœ€è€ƒè™‘IDå†²çª
âœ… æ€§èƒ½æ›´å¥½
âœ… é€‚åˆçº¯æ–°å¢åœºæ™¯
```

**ğŸ”¸ æ›´æ–° vs æ›¿æ¢**ï¼š
```
éƒ¨åˆ†æ›´æ–°ï¼ˆ_updateï¼‰ï¼š
- ä¿ç•™åŸæœ‰å­—æ®µ
- åªä¿®æ”¹æŒ‡å®šå­—æ®µ
- å®‰å…¨é«˜æ•ˆ

å®Œå…¨æ›¿æ¢ï¼ˆPUTï¼‰ï¼š
- è¦†ç›–æ•´ä¸ªæ–‡æ¡£
- å¯èƒ½ä¸¢å¤±æ•°æ®
- éœ€è¦è°¨æ…ä½¿ç”¨
```

### 9.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸš€ æ‰¹é‡æ“ä½œä¼˜åŒ–**ï¼š
- âœ… ä½¿ç”¨bulk APIæ‰¹é‡å¤„ç†
- âœ… åˆç†æ§åˆ¶æ‰¹é‡å¤§å°ï¼ˆ1000-5000æ–‡æ¡£ï¼‰
- âœ… ç›‘æ§é›†ç¾¤æ€§èƒ½æŒ‡æ ‡

**ğŸ“Š æŸ¥è¯¢ä¼˜åŒ–**ï¼š
- âœ… åªè·å–éœ€è¦çš„å­—æ®µï¼ˆ_sourceè¿‡æ»¤ï¼‰
- âœ… ä½¿ç”¨HEADæ£€æŸ¥å­˜åœ¨æ€§
- âœ… é¿å…é¢‘ç¹çš„å•æ–‡æ¡£æŸ¥è¯¢

**ğŸ’¡ æ›´æ–°ä¼˜åŒ–**ï¼š
- âœ… ä¼˜å…ˆä½¿ç”¨éƒ¨åˆ†æ›´æ–°
- âœ… åˆç†ä½¿ç”¨è„šæœ¬æ›´æ–°
- âœ… åˆ©ç”¨upsertå‡å°‘åˆ¤æ–­é€»è¾‘

### 9.4 å¸¸è§é”™è¯¯é¿å…


**âŒ å¸¸è§é”™è¯¯**ï¼š
```
1. æ··æ·†PUTå’ŒPOSTçš„ä½¿ç”¨åœºæ™¯
2. å¿˜è®°å¤„ç†æ–‡æ¡£ä¸å­˜åœ¨çš„æƒ…å†µ  
3. æ‰¹é‡æ“ä½œæ—¶å¿½ç•¥é”™è¯¯å¤„ç†
4. è¿‡åº¦ä½¿ç”¨è„šæœ¬æ›´æ–°å½±å“æ€§èƒ½
5. ä¸åˆç†çš„æ‰¹é‡æ“ä½œå¤§å°
```

**âœ… æœ€ä½³å®è·µ**ï¼š
```
1. æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ“ä½œæ–¹æ³•
2. å§‹ç»ˆæ£€æŸ¥æ“ä½œç»“æœå’Œé”™è¯¯ä¿¡æ¯
3. åˆç†è®¾è®¡æ–‡æ¡£ç»“æ„å’ŒIDè§„åˆ™
4. ç›‘æ§æ€§èƒ½æŒ‡æ ‡ï¼ŒåŠæ—¶ä¼˜åŒ–
5. åšå¥½æ•°æ®å¤‡ä»½å’Œæ¢å¤ç­–ç•¥
```

### 9.5 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å¾ªåºæ¸è¿›å­¦ä¹ **ï¼š
1. **åŸºç¡€é˜¶æ®µ** â†’ æŒæ¡å•æ–‡æ¡£CRUDæ“ä½œ
2. **è¿›é˜¶é˜¶æ®µ** â†’ å­¦ä¹ æ‰¹é‡æ“ä½œå’Œè„šæœ¬æ›´æ–°  
3. **ä¼˜åŒ–é˜¶æ®µ** â†’ äº†è§£æ€§èƒ½è°ƒä¼˜å’Œæœ€ä½³å®è·µ
4. **å®æˆ˜é˜¶æ®µ** â†’ ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯åº”ç”¨

> ğŸ’¡ **å­¦ä¹ æç¤º**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†ç»ƒä¹ ï¼Œç†è§£æ¯ä¸ªæ“ä½œçš„å…·ä½“è¡Œä¸ºï¼Œå†åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚æ–‡æ¡£æ“ä½œæ˜¯Elasticsearchçš„åŸºç¡€ï¼ŒæŒæ¡å¥½è¿™äº›å‘½ä»¤æ˜¯è¿›ä¸€æ­¥å­¦ä¹ æœç´¢å’Œèšåˆçš„å‰æã€‚