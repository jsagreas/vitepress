---
title: 4、索引创建与删除
---
## 📚 目录

1. [索引基础概念](#1-索引基础概念)
2. [索引创建操作](#2-索引创建操作)
3. [索引删除操作](#3-索引删除操作)
4. [索引存在性检查](#4-索引存在性检查)
5. [索引列表查看](#5-索引列表查看)
6. [索引设置管理](#6-索引设置管理)
7. [索引开关控制](#7-索引开关控制)
8. [实战最佳实践](#8-实战最佳实践)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 📖 索引基础概念


### 1.1 什么是Elasticsearch索引


**通俗理解**：
```
传统数据库的比较：
MySQL数据库 = Elasticsearch集群
MySQL表    = Elasticsearch索引
MySQL行    = Elasticsearch文档
```

> 💡 **简单来说**：索引就像是一个专门的"数据仓库"，用来存储和组织相同类型的数据

**索引的核心作用**：
- 🏠 **数据容器**：存储相关文档的地方
- 🔍 **搜索范围**：定义搜索操作的边界
- ⚙️ **配置载体**：承载分片、副本等设置
- 📋 **映射管理**：定义字段类型和索引规则

### 1.2 索引命名规则


**📝 命名要求**：
- ✅ **小写字母**：只能使用小写字母
- ✅ **数字允许**：可以包含数字
- ✅ **特殊符号**：允许使用 `-` `_` `+`
- ❌ **禁止字符**：不能包含空格、大写字母、特殊符号

**🎯 命名建议**：
```
✅ 好的命名：
- user_profiles
- product_catalog_2024  
- log_nginx_access

❌ 避免的命名：
- User-Profiles (大写字母)
- product catalog (空格)
- log@nginx (特殊字符)
```

### 1.3 索引生命周期


```
索引状态流转图：

创建 → 打开 → 使用中 → 关闭 → 删除
  ↓      ↓       ↓       ↓      ↓
 空索引  可读写   正常运行  只读   消失

📊 状态说明：
• 打开状态：可以读写，消耗内存和CPU
• 关闭状态：不可读写，节省资源
• 删除状态：数据完全销毁，不可恢复
```

---

## 2. 🔨 索引创建操作


### 2.1 基础创建命令


**核心命令：`PUT /{index}`**

```bash
# 最简单的索引创建
PUT /my_first_index

# 响应示例
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "my_first_index"
}
```

**响应字段含义**：
- `acknowledged`: 操作是否被集群确认
- `shards_acknowledged`: 分片是否成功创建
- `index`: 创建的索引名称

### 2.2 带配置的索引创建


**🔧 设置分片和副本**：

```bash
PUT /product_catalog
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  }
}
```

**配置参数解释**：

| 参数 | 含义 | 新手理解 | 建议值 |
|------|------|----------|--------|
| `number_of_shards` | 主分片数量 | 把数据分成几份存储 | 1-5个 |
| `number_of_replicas` | 副本数量 | 每份数据复制几个备份 | 1个 |

> ⚠️ **重要提醒**：主分片数量创建后**不能修改**，副本数量可以随时调整

### 2.3 带映射的索引创建


**📋 定义字段类型**：

```bash
PUT /user_profiles
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "name": {
        "type": "text"
      },
      "age": {
        "type": "integer"
      },
      "email": {
        "type": "keyword"
      },
      "create_time": {
        "type": "date"
      }
    }
  }
}
```

**字段类型说明**：

```
📝 常用字段类型：

text    → 全文搜索字段（如文章内容）
keyword → 精确匹配字段（如邮箱、ID）
integer → 整数字段
long    → 长整数字段  
date    → 日期时间字段
boolean → 布尔值字段
```

### 2.4 创建索引的最佳实践


**🎯 新手推荐配置**：

```bash
PUT /my_app_data
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1,
    "refresh_interval": "1s"
  },
  "mappings": {
    "properties": {
      "title": {"type": "text"},
      "status": {"type": "keyword"},
      "created_at": {"type": "date"}
    }
  }
}
```

**⭐ 配置原则**：
- **小数据量**：1个分片足够
- **生产环境**：至少1个副本保证可用性
- **开发测试**：可以设置0个副本节省资源

---

## 3. 🗑️ 索引删除操作


### 3.1 删除单个索引


**核心命令：`DELETE /{index}`**

```bash
# 删除指定索引
DELETE /my_first_index

# 响应示例
{
  "acknowledged": true
}
```

> ⚠️ **危险操作警告**：删除索引会**永久销毁**所有数据，无法恢复！

### 3.2 删除多个索引


**🔢 批量删除**：

```bash
# 删除多个指定索引
DELETE /index1,index2,index3

# 使用通配符删除
DELETE /log_*

# 删除所有以test开头的索引
DELETE /test*
```

**通配符说明**：
- `*` : 匹配任意字符
- `log_*` : 匹配所有以log_开头的索引
- `*_2024` : 匹配所有以_2024结尾的索引

### 3.3 安全删除实践


**🛡️ 删除前的安全检查**：

```bash
# 1. 先查看要删除的索引
GET /_cat/indices/log_*

# 2. 确认无误后再删除
DELETE /log_*
```

**📋 删除检查清单**：
- ✅ 确认索引名称无误
- ✅ 确认数据已备份
- ✅ 确认业务影响范围
- ✅ 在维护时间窗口执行

---

## 4. 🔍 索引存在性检查


### 4.1 检查索引是否存在


**核心命令：`HEAD /{index}`**

```bash
# 检查单个索引
HEAD /user_profiles

# 检查多个索引
HEAD /index1,index2
```

**响应状态码解释**：
- `200 OK` : 索引存在
- `404 Not Found` : 索引不存在

### 4.2 实际应用场景


**🎯 脚本中的条件判断**：

```bash
# 检查索引存在性，根据结果执行不同操作
if curl -f -s -XHEAD "localhost:9200/my_index" > /dev/null; then
    echo "索引存在，执行更新操作"
else
    echo "索引不存在，先创建索引"
fi
```

**💡 使用技巧**：
- HEAD请求不返回响应体，速度更快
- 适合在脚本中做条件判断
- 可以避免重复创建索引的错误

---

## 5. 👀 索引列表查看


### 5.1 基础查看命令


**核心命令：`GET /_cat/indices`**

```bash
# 查看所有索引
GET /_cat/indices

# 响应示例（表格格式）
green  open log_2024    1 1  1000  500kb
yellow open user_data   1 0   100   50kb
red    close old_index  1 1     0     0b
```

### 5.2 详细信息查看


**🔍 显示更多字段**：

```bash
# 显示详细信息
GET /_cat/indices?v

# 自定义显示字段
GET /_cat/indices?h=index,status,health,docs.count,store.size&v
```

**字段含义解释**：

| 字段 | 含义 | 说明 |
|------|------|------|
| `health` | 健康状态 | green=正常，yellow=警告，red=异常 |
| `status` | 开关状态 | open=打开，close=关闭 |
| `index` | 索引名称 | 索引的名字 |
| `docs.count` | 文档数量 | 存储的文档总数 |
| `store.size` | 存储大小 | 占用的磁盘空间 |

### 5.3 过滤和排序


**🎯 按条件查看**：

```bash
# 查看特定模式的索引
GET /_cat/indices/log_*

# 按大小排序
GET /_cat/indices?s=store.size:desc

# 只看打开的索引
GET /_cat/indices?h=index,status&s=index | grep open
```

---

## 6. ⚙️ 索引设置管理


### 6.1 查看索引设置


**核心命令：`GET /{index}/_settings`**

```bash
# 查看单个索引设置
GET /user_profiles/_settings

# 查看多个索引设置
GET /user_profiles,product_catalog/_settings

# 查看所有索引设置
GET /_settings
```

**响应示例**：
```json
{
  "user_profiles": {
    "settings": {
      "index": {
        "number_of_shards": "1",
        "number_of_replicas": "1",
        "creation_date": "1640995200000"
      }
    }
  }
}
```

### 6.2 修改索引设置


**核心命令：`PUT /{index}/_settings`**

```bash
# 修改副本数量
PUT /user_profiles/_settings
{
  "number_of_replicas": 2
}

# 修改刷新间隔
PUT /user_profiles/_settings
{
  "refresh_interval": "30s"
}
```

**📝 可修改的设置**：

| 设置项 | 说明 | 可否修改 |
|--------|------|----------|
| `number_of_replicas` | 副本数量 | ✅ 可以 |
| `refresh_interval` | 刷新间隔 | ✅ 可以 |
| `number_of_shards` | 主分片数 | ❌ 不可以 |

### 6.3 常用设置优化


**🚀 性能优化设置**：

```bash
# 提高写入性能（开发环境）
PUT /my_index/_settings
{
  "refresh_interval": "30s",
  "number_of_replicas": 0
}

# 恢复生产环境设置
PUT /my_index/_settings
{
  "refresh_interval": "1s",
  "number_of_replicas": 1
}
```

---

## 7. 🔄 索引开关控制


### 7.1 关闭索引


**核心命令：`POST /{index}/_close`**

```bash
# 关闭单个索引
POST /old_data/_close

# 关闭多个索引
POST /old_data,temp_data/_close

# 响应示例
{
  "acknowledged": true,
  "shards_acknowledged": true
}
```

**🔒 关闭索引的作用**：
- 💾 **节省内存**：释放索引占用的内存
- ⚡ **减少开销**：停止后台维护任务
- 🛡️ **数据保护**：防止意外修改
- 📚 **归档用途**：保留数据但不占用资源

### 7.2 打开索引


**核心命令：`POST /{index}/_open`**

```bash
# 打开单个索引
POST /old_data/_open

# 打开多个索引
POST /old_data,temp_data/_open
```

### 7.3 开关状态查看


**👁️ 查看索引状态**：

```bash
# 查看所有索引状态
GET /_cat/indices?h=index,status&v

# 输出示例
index       status
user_data   open
old_data    close
temp_data   open
```

### 7.4 实际应用场景


**📊 使用场景对比**：

```
场景分析：

🟢 保持打开：
- 正在使用的业务数据
- 需要实时搜索的索引
- 近期数据（如当月日志）

🔴 适合关闭：
- 历史归档数据
- 临时测试索引
- 很少访问的旧数据
```

---

## 8. 🎯 实战最佳实践


### 8.1 索引创建最佳实践


**🏗️ 标准创建流程**：

```bash
# 第一步：规划索引结构
# 考虑：数据量、查询模式、性能要求

# 第二步：创建带完整配置的索引
PUT /ecommerce_products
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1,
    "refresh_interval": "1s"
  },
  "mappings": {
    "properties": {
      "title": {"type": "text", "analyzer": "standard"},
      "price": {"type": "double"},
      "category": {"type": "keyword"},
      "tags": {"type": "keyword"},
      "description": {"type": "text"},
      "created_at": {"type": "date"}
    }
  }
}
```

### 8.2 索引命名规范


**📝 企业级命名规范**：

```
命名模式：{业务模块}_{数据类型}_{环境}_{时间}

示例：
✅ user_profile_prod_202409     (用户档案-生产-202409)
✅ order_detail_test_v1         (订单详情-测试-v1)
✅ log_nginx_dev_daily          (nginx日志-开发-按日)

环境标识：
- prod (生产环境)
- test (测试环境)  
- dev  (开发环境)
```

### 8.3 索引健康监控


**🏥 健康检查脚本**：

```bash
# 每日健康检查
GET /_cluster/health

# 检查异常索引
GET /_cat/indices?h=index,health&v | grep -v green

# 检查大容量索引
GET /_cat/indices?h=index,store.size&s=store.size:desc
```

### 8.4 安全操作流程


**🛡️ 生产环境操作流程**：

```
操作前检查清单：

☑️ 1. 确认操作时间窗口
☑️ 2. 通知相关业务方
☑️ 3. 备份重要数据
☑️ 4. 准备回滚方案
☑️ 5. 在测试环境验证
☑️ 6. 监控集群状态
```

---

## 9. 📋 核心要点总结


### 9.1 必知必会命令速查


```
📝 索引生命周期管理：

创建索引：PUT /{index}
删除索引：DELETE /{index}
检查存在：HEAD /{index}
查看列表：GET /_cat/indices
查看设置：GET /{index}/_settings
修改设置：PUT /{index}/_settings
关闭索引：POST /{index}/_close
打开索引：POST /{index}/_open
```

### 9.2 关键概念理解


**🧠 核心概念记忆**：

```
索引 = 数据库表的概念
分片 = 数据水平分割，创建后不可改
副本 = 数据备份，随时可调整
映射 = 字段类型定义，类似表结构
设置 = 索引配置参数，部分可修改
```

### 9.3 新手易错点


**⚠️ 常见错误及解决**：

| 错误场景 | 问题原因 | 解决方案 |
|----------|----------|----------|
| 索引名大写 | 命名规则违反 | 使用小写字母 |
| 分片数过多 | 资源浪费 | 小数据用1个分片 |
| 忘记副本 | 数据安全隐患 | 生产环境至少1个副本 |
| 误删索引 | 操作不慎 | 删除前三次确认 |

### 9.4 性能优化建议


**🚀 性能调优要点**：

```
数据写入阶段：
- 减少副本数量（临时）
- 增大refresh_interval
- 批量写入数据

数据查询阶段：
- 恢复副本数量
- 调整refresh_interval为1s
- 监控集群性能
```

### 9.5 运维监控要点


**📊 日常监控指标**：

- **集群健康**：`GET /_cluster/health`
- **索引状态**：`GET /_cat/indices?v`
- **磁盘使用**：`GET /_cat/allocation?v`
- **性能指标**：`GET /_cat/nodes?v`

**🎯 核心记忆口诀**：
```
索引创建要规划，分片副本要合理
命名规范很重要，小写字母加下划线
删除操作需谨慎，备份确认再执行  
开关状态灵活用，节省资源护数据
```

**💡 新手学习建议**：
1. **从简单开始**：先用默认配置创建索引
2. **边学边练**：在测试环境多练习命令
3. **理解概念**：重点理解分片、副本、映射的含义
4. **安全第一**：生产环境操作前务必确认
5. **持续监控**：养成定期检查索引健康的习惯