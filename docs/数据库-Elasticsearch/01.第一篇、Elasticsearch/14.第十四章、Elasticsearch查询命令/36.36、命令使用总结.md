---
title: 36ã€å‘½ä»¤ä½¿ç”¨æ€»ç»“
---
## ğŸ“š ç›®å½•

1. [ElasticsearchåŸºç¡€æ¦‚å¿µä¸æ¶æ„](#1-elasticsearchåŸºç¡€æ¦‚å¿µä¸æ¶æ„)
2. [å‘½ä»¤æ ¼å¼çº¦å®šä¸å‚æ•°è¯¦è§£](#2-å‘½ä»¤æ ¼å¼çº¦å®šä¸å‚æ•°è¯¦è§£)
3. [é›†ç¾¤ä¸èŠ‚ç‚¹ç®¡ç†](#3-é›†ç¾¤ä¸èŠ‚ç‚¹ç®¡ç†)
4. [ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†](#4-ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†)
5. [æ–‡æ¡£æ“ä½œæ ¸å¿ƒå‘½ä»¤](#5-æ–‡æ¡£æ“ä½œæ ¸å¿ƒå‘½ä»¤)
6. [æœç´¢æŸ¥è¯¢å®æˆ˜](#6-æœç´¢æŸ¥è¯¢å®æˆ˜)
7. [æ˜ å°„ä¸è®¾ç½®ç®¡ç†](#7-æ˜ å°„ä¸è®¾ç½®ç®¡ç†)
8. [æ•°æ®å¯¼å…¥å¯¼å‡º](#8-æ•°æ®å¯¼å…¥å¯¼å‡º)
9. [ç›‘æ§ä¸è¿ç»´å‘½ä»¤](#9-ç›‘æ§ä¸è¿ç»´å‘½ä»¤)
10. [é«˜çº§ç‰¹æ€§æ“ä½œ](#10-é«˜çº§ç‰¹æ€§æ“ä½œ)
11. [ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜](#11-ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ElasticsearchåŸºç¡€æ¦‚å¿µä¸æ¶æ„


### 1.1 ä»€ä¹ˆæ˜¯Elasticsearch


**ğŸ¯ é€šä¿—ç†è§£**
```
æŠŠElasticsearchæƒ³è±¡æˆä¸€ä¸ªè¶…çº§æ™ºèƒ½çš„å›¾ä¹¦é¦†ç®¡ç†å‘˜ï¼š
â€¢ èƒ½ç¬é—´ä»æµ·é‡ä¹¦ç±ä¸­æ‰¾åˆ°ä½ è¦çš„å†…å®¹
â€¢ ä¸åªçœ‹ä¹¦åï¼Œè¿˜èƒ½ç†è§£å†…å®¹ã€ä½œè€…ã€ä¸»é¢˜ç­‰
â€¢ æ”¯æŒæ¨¡ç³ŠæŸ¥æ‰¾ï¼š"æ‰¾æ‰€æœ‰å…³äºç¼–ç¨‹çš„ä¹¦"
â€¢ èƒ½æŒ‰ç›¸å…³æ€§æ’åºï¼šæœ€ç›¸å…³çš„ç»“æœæ’åœ¨å‰é¢
â€¢ è¿˜èƒ½ç»Ÿè®¡åˆ†æï¼šè¿™ä¸ªæœˆå“ªç±»ä¹¦æœ€å—æ¬¢è¿
```

**ğŸ“– ä¸“ä¸šå®šä¹‰**
> Elasticsearchæ˜¯ä¸€ä¸ª**åˆ†å¸ƒå¼**ã€**RESTfulé£æ ¼**çš„**æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“**ï¼ŒåŸºäºApache Luceneæ„å»ºï¼Œèƒ½å¤Ÿå®ç°**è¿‘å®æ—¶æœç´¢**å’Œ**å¤æ‚æ•°æ®åˆ†æ**ã€‚

**ğŸ”§ æ ¸å¿ƒç‰¹ç‚¹**
- **åˆ†å¸ƒå¼æ¶æ„**ï¼šæ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œè‡ªåŠ¨è´Ÿè½½å‡è¡¡
- **RESTful API**ï¼šé€šè¿‡HTTPè¯·æ±‚è¿›è¡Œæ‰€æœ‰æ“ä½œï¼Œç®€å•æ˜“ç”¨
- **JSONæ ¼å¼**ï¼šæ•°æ®å­˜å‚¨å’Œäº¤äº’éƒ½ä½¿ç”¨JSONï¼Œæ˜“è¯»æ˜“å†™
- **è¿‘å®æ—¶æœç´¢**ï¼šæ•°æ®å†™å…¥å1ç§’å†…å³å¯è¢«æœç´¢åˆ°
- **å…¨æ–‡æ£€ç´¢**ï¼šæ”¯æŒå¤æ‚çš„æ–‡æœ¬æœç´¢ã€åˆ†æå’Œè¯„åˆ†

### 1.2 ESä¸ä¼ ç»Ÿæ•°æ®åº“çš„åŒºåˆ«


| å¯¹æ¯”ç»´åº¦ | **ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“** | **Elasticsearch** |
|---------|-------------------|------------------|
| ğŸ¯ **ä¸»è¦ç”¨é€”** | `äº‹åŠ¡å¤„ç†ã€æ•°æ®å­˜å‚¨` | `æœç´¢ã€åˆ†æã€æ—¥å¿—å¤„ç†` |
| ğŸ“Š **æ•°æ®ç»“æ„** | `è¡¨æ ¼å¼(è¡Œåˆ—ç»“æ„)` | `æ–‡æ¡£å¼(JSONç»“æ„)` |
| ğŸ” **æŸ¥è¯¢æ–¹å¼** | `SQLè¯­å¥æŸ¥è¯¢` | `RESTful API + JSONæŸ¥è¯¢` |
| âš¡ **æœç´¢èƒ½åŠ›** | `ç®€å•LIKEæ¨¡ç³ŠåŒ¹é…` | `å…¨æ–‡æ£€ç´¢ã€ç›¸å…³æ€§è¯„åˆ†ã€åˆ†è¯` |
| ğŸ“ˆ **æ‰©å±•æ€§** | `å‚ç›´æ‰©å±•(å‡çº§ç¡¬ä»¶)` | `æ°´å¹³æ‰©å±•(å¢åŠ æœåŠ¡å™¨)` |
| ğŸ•’ **ä¸€è‡´æ€§** | `ACIDå¼ºä¸€è‡´æ€§` | `æœ€ç»ˆä¸€è‡´æ€§ã€è¿‘å®æ—¶å¯è§` |
| ğŸ”§ **å¤æ‚æŸ¥è¯¢** | `JOINå…³è”æŸ¥è¯¢å¼º` | `èšåˆåˆ†æã€ç»Ÿè®¡æŸ¥è¯¢å¼º` |

**ğŸ’¡ å®é™…åº”ç”¨å¯¹æ¯”**
```
ä¼ ç»Ÿæ•°æ®åº“æŸ¥è¯¢ï¼š
SELECT * FROM products WHERE name LIKE '%æ‰‹æœº%' AND price BETWEEN 1000 AND 3000;
â†’ åªèƒ½æŒ‰å­—æ®µç²¾ç¡®/æ¨¡ç³ŠåŒ¹é…ï¼Œæ€§èƒ½éšæ•°æ®é‡ä¸‹é™

ElasticsearchæŸ¥è¯¢ï¼š
GET /products/_search
{
  "query": {
    "bool": {
      "must": [{"match": {"title": "æ™ºèƒ½æ‰‹æœº"}}],
      "filter": [{"range": {"price": {"gte": 1000, "lte": 3000}}}]
    }
  }
}
â†’ èƒ½æ‰¾åˆ°ï¼š
  - æ ‡é¢˜åŒ…å«"æ‰‹æœº"çš„å•†å“
  - æè¿°ä¸­æåˆ°"æ™ºèƒ½è®¾å¤‡"çš„å•†å“  
  - å“ç‰Œä¸º"åä¸ºæ‰‹æœº"çš„å•†å“
  - è¿˜èƒ½æŒ‰ç›¸å…³æ€§å’Œé”€é‡æ’åº
```

### 1.3 æ ¸å¿ƒæ¶æ„ä¸ç»„ä»¶


**ğŸ“‹ åŸºæœ¬æ¦‚å¿µå¯¹ç…§è¡¨**

```
ä¼ ç»Ÿæ•°æ®åº“æ¦‚å¿µ    â†’    Elasticsearchæ¦‚å¿µ    â†’    ç”Ÿæ´»ç±»æ¯”
æ•°æ®åº“(Database)   â†’    ç´¢å¼•(Index)         â†’    å›¾ä¹¦é¦†çš„åˆ†åŒº(ç§‘æŠ€åŒºã€æ–‡å­¦åŒº)
è¡¨(Table)         â†’    ç±»å‹(Type)[å·²åºŸå¼ƒ]   â†’    ä¹¦æ¶åˆ†ç±»
è¡Œ(Row)           â†’    æ–‡æ¡£(Document)      â†’    ä¸€æœ¬å…·ä½“çš„ä¹¦
åˆ—(Column)        â†’    å­—æ®µ(Field)         â†’    ä¹¦çš„å±æ€§(æ ‡é¢˜ã€ä½œè€…ã€ä»·æ ¼)
ä¸»é”®(Primary Key) â†’    æ–‡æ¡£ID(_id)         â†’    ä¹¦çš„ç¼–å·
ç´¢å¼•(Index)       â†’    å€’æ’ç´¢å¼•(Inverted)   â†’    ä¹¦çš„ç›®å½•ç´¢å¼•
```

**ğŸ—ï¸ é›†ç¾¤æ¶æ„å›¾è§£**
```
         Elasticsearché›†ç¾¤æ¶æ„
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         Master Node             â”‚ â† ä¸»èŠ‚ç‚¹ï¼šç®¡ç†é›†ç¾¤çŠ¶æ€
    â”‚      (é›†ç¾¤çŠ¶æ€ç®¡ç†è€…)             â”‚   ä¸å­˜å‚¨æ•°æ®ï¼Œè´Ÿè´£åè°ƒ
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚                â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Node A â”‚  â”‚ Node B â”‚  â”‚ Node C  â”‚ â† æ•°æ®èŠ‚ç‚¹ï¼šå­˜å‚¨æ•°æ®
    â”‚ (æ•°æ®) â”‚  â”‚ (æ•°æ®) â”‚  â”‚ (æ•°æ®)  â”‚   å¤„ç†æœç´¢è¯·æ±‚
    â”‚Shard 0 â”‚  â”‚Shard 1 â”‚  â”‚Shard 2 â”‚
    â”‚Shard 1'â”‚  â”‚Shard 2'â”‚  â”‚Shard 0'â”‚ â† ä¸»åˆ†ç‰‡+å‰¯æœ¬åˆ†ç‰‡
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ èŠ‚ç‚¹ç±»å‹è¯´æ˜**
- **Master Node**ï¼šç®¡ç†é›†ç¾¤çŠ¶æ€ã€ç´¢å¼•åˆ›å»ºåˆ é™¤ã€èŠ‚ç‚¹åŠ å…¥ç¦»å¼€
- **Data Node**ï¼šå­˜å‚¨å®é™…æ•°æ®ï¼Œå¤„ç†CRUDå’Œæœç´¢è¯·æ±‚  
- **Coordinating Node**ï¼šåè°ƒèŠ‚ç‚¹ï¼Œåˆ†å‘è¯·æ±‚åˆ°å¯¹åº”èŠ‚ç‚¹ï¼Œèšåˆç»“æœ
- **Ingest Node**ï¼šæ•°æ®é¢„å¤„ç†èŠ‚ç‚¹ï¼Œåœ¨ç´¢å¼•å‰è½¬æ¢å’Œä¸°å¯Œæ•°æ®

**ğŸ”¸ åˆ†ç‰‡ä¸å‰¯æœ¬æœºåˆ¶**
```
åˆ†ç‰‡(Shard)è®¾è®¡åŸç†ï¼š
æŠŠä¸€ä¸ªå¤§ç´¢å¼•åˆ‡æˆè‹¥å¹²å°å—ï¼Œåˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒèŠ‚ç‚¹ä¸Š
å°±åƒæŠŠä¸€å¥—ç™¾ç§‘å…¨ä¹¦æ‹†æˆA-Fã€G-Mã€N-Zä¸‰å·ï¼Œåˆ†åˆ«æ”¾åœ¨ä¸åŒä¹¦æ¶

ä¼˜åŠ¿ï¼š
âœ“ çªç ´å•æœºå­˜å‚¨é™åˆ¶
âœ“ æé«˜æœç´¢æ€§èƒ½(å¹¶è¡Œå¤„ç†)
âœ“ æ°´å¹³æ‰©å±•èƒ½åŠ›

å‰¯æœ¬(Replica)å®¹é”™æœºåˆ¶ï¼š
æ¯ä¸ªä¸»åˆ†ç‰‡çš„å®Œæ•´å¤‡ä»½ï¼Œæä¾›å®¹é”™å’Œè´Ÿè½½åˆ†æ‹…
å°±åƒé‡è¦æ–‡ä»¶è¦å¤šå¤å°å‡ ä»½åˆ†åˆ«ä¿å­˜

ä¼˜åŠ¿ï¼š
âœ“ æ•°æ®å®‰å…¨(èŠ‚ç‚¹å®•æœºä¸ä¸¢æ•°æ®)
âœ“ æé«˜æŸ¥è¯¢æ€§èƒ½(è¯»è¯·æ±‚è´Ÿè½½å‡è¡¡)
âœ“ è¿‘å®æ—¶æ•…éšœæ¢å¤
```

### 1.4 é€‚ç”¨åœºæ™¯åˆ†æ


**âœ… Elasticsearchæœ€æ“…é•¿çš„åœºæ™¯**
- **å…¨æ–‡æœç´¢**ï¼šç½‘ç«™æœç´¢ã€æ–‡æ¡£æ£€ç´¢ã€ä»£ç æœç´¢
- **æ—¥å¿—åˆ†æ**ï¼šELK stackã€ç³»ç»Ÿç›‘æ§ã€è®¿é—®æ—¥å¿—åˆ†æ
- **å®æ—¶åˆ†æ**ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æã€ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡
- **æ¨èç³»ç»Ÿ**ï¼šåŸºäºå†…å®¹çš„æ¨èã€ç›¸ä¼¼å•†å“æ¨è
- **åœ°ç†ä½ç½®æœç´¢**ï¼šé™„è¿‘å•†å®¶ã€åœ°å›¾æœç´¢

**âŒ ä¸å¤ªé€‚åˆçš„åœºæ™¯**
- **äº‹åŠ¡å¤„ç†**ï¼šè®¢å•å¤„ç†ã€æ”¯ä»˜ç³»ç»Ÿ(ç¼ºä¹ACID)
- **å¼ºä¸€è‡´æ€§**ï¼šé“¶è¡Œè½¬è´¦ã€åº“å­˜æ‰£å‡(æœ€ç»ˆä¸€è‡´æ€§)
- **å¤æ‚å…³è”**ï¼šå¤šè¡¨JOINã€å¤æ‚å…³ç³»æŸ¥è¯¢
- **é¢‘ç¹æ›´æ–°**ï¼šé«˜é¢‘ä¿®æ”¹åŒä¸€æ–‡æ¡£(é‡å»ºå¼€é”€å¤§)

---

## 2. ğŸ“ å‘½ä»¤æ ¼å¼çº¦å®šä¸å‚æ•°è¯¦è§£


### 2.1 å‘½ä»¤åŸºæœ¬ç»“æ„


**ğŸ”§ æ ‡å‡†å‘½ä»¤æ ¼å¼**
```
HTTPæ–¹æ³• + APIè·¯å¾„ + æŸ¥è¯¢å‚æ•° + è¯·æ±‚ä½“

æ ¼å¼è¯´æ˜ï¼š
METHOD /{index}/{endpoint}/{id}?{parameters}
{
  "request_body": "JSONæ ¼å¼"
}
```

**ğŸ’¡ å‘½ä»¤ç»„æˆéƒ¨åˆ†è§£æ**
```
GET /users/_doc/123?pretty=true

æ‹†è§£è¯´æ˜ï¼š
â”œâ”€ GET              â† HTTPæ–¹æ³•ï¼šè·å–æ•°æ®
â”œâ”€ /users           â† ç´¢å¼•åç§°ï¼šç”¨æˆ·æ•°æ®ç´¢å¼•
â”œâ”€ /_doc            â† APIç«¯ç‚¹ï¼šæ–‡æ¡£æ“ä½œ
â”œâ”€ /123             â† æ–‡æ¡£IDï¼šå…·ä½“ç”¨æˆ·ç¼–å·
â””â”€ ?pretty=true     â† æŸ¥è¯¢å‚æ•°ï¼šç¾åŒ–JSONè¾“å‡º
```

### 2.2 å ä½ç¬¦è¯¦ç»†è¯´æ˜


**ğŸ¯ æ ¸å¿ƒå ä½ç¬¦å«ä¹‰**

| å ä½ç¬¦ | **å«ä¹‰è¯´æ˜** | **å®é™…ç¤ºä¾‹** | **ä½¿ç”¨åœºæ™¯** |
|--------|-------------|-------------|-------------|
| `{index}` | **ç´¢å¼•åç§°** | `users, products, logs` | `æŒ‡å®šæ“ä½œçš„æ•°æ®é›†åˆ` |
| `{id}` | **æ–‡æ¡£ID** | `user_001, 12345` | `å”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•` |
| `{alias}` | **ç´¢å¼•åˆ«å** | `current_data, prod` | `ç´¢å¼•çš„ç®€ç§°æˆ–ç‰ˆæœ¬åˆ‡æ¢` |
| `{node_id}` | **èŠ‚ç‚¹æ ‡è¯†** | `node-1, master-node` | `é›†ç¾¤ä¸­ç‰¹å®šæœåŠ¡å™¨` |
| `{type}` | **æ–‡æ¡£ç±»å‹** | `_doc`(ES7+ç»Ÿä¸€ä½¿ç”¨) | `æ–‡æ¡£åˆ†ç±»(å·²åºŸå¼ƒ)` |

**ğŸ“‹ å ä½ç¬¦ä½¿ç”¨ç¤ºä¾‹å¯¹ç…§**

```bash
# æ¨¡æ¿æ ¼å¼ â†’ å®é™…ä½¿ç”¨
GET /{index}/_doc/{id}
GET /users/_doc/12345           # æŸ¥è¯¢ç”¨æˆ·12345çš„ä¿¡æ¯

PUT /{index}/_doc/{id}
PUT /products/_doc/iphone15     # åˆ›å»ºiPhone15å•†å“ä¿¡æ¯

DELETE /{index}/_doc/{id}  
DELETE /orders/_doc/order_001   # åˆ é™¤è®¢å•order_001

GET /_cat/{endpoint}?v
GET /_cat/indices?v             # æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çŠ¶æ€
```

### 2.3 HTTPæ–¹æ³•è¯¦è§£


**ğŸ”¸ HTTPæ–¹æ³•ä¸æ“ä½œå¯¹åº”å…³ç³»**

| HTTPæ–¹æ³• | **æ“ä½œç±»å‹** | **å¹‚ç­‰æ€§** | **ä½¿ç”¨åœºæ™¯** | **ç”Ÿæ´»ç±»æ¯”** |
|---------|------------|-----------|-------------|-------------|
| `GET` | **è¯»å–æŸ¥è¯¢** | `æ˜¯` | `æŸ¥è¯¢æ–‡æ¡£ã€è·å–çŠ¶æ€` | `çœ‹ä¹¦ã€æŸ¥èµ„æ–™` |
| `POST` | **åˆ›å»º/æ‰§è¡Œ** | `å¦` | `æ·»åŠ æ–‡æ¡£ã€æ‰§è¡Œæœç´¢` | `å†™æ–°å†…å®¹ã€æäº¤ç”³è¯·` |
| `PUT` | **åˆ›å»º/æ›¿æ¢** | `æ˜¯` | `æŒ‡å®šIDåˆ›å»ºã€å®Œæ•´æ›´æ–°` | `é‡å†™æ•´é¡µå†…å®¹` |
| `DELETE` | **åˆ é™¤** | `æ˜¯` | `åˆ é™¤æ–‡æ¡£ã€åˆ é™¤ç´¢å¼•` | `æ’•æ‰ã€æ“¦é™¤` |
| `HEAD` | **æ£€æŸ¥å­˜åœ¨** | `æ˜¯` | `æ£€æŸ¥æ–‡æ¡£/ç´¢å¼•æ˜¯å¦å­˜åœ¨` | `çœ‹çœ‹æœ‰æ²¡æœ‰è¿™æœ¬ä¹¦` |

**ğŸ’¡ æ–¹æ³•é€‰æ‹©æŒ‡å¯¼**
```
åˆ›å»ºæ–‡æ¡£æ—¶ï¼š
PUT /index/_doc/123    â† æŒ‡å®šIDï¼Œå¦‚æœå­˜åœ¨åˆ™è¦†ç›–
POST /index/_doc       â† è‡ªåŠ¨ç”ŸæˆIDï¼Œæ€»æ˜¯åˆ›å»ºæ–°æ–‡æ¡£

æŸ¥è¯¢æ“ä½œæ—¶ï¼š
GET /index/_search     â† ç®€å•æŸ¥è¯¢ï¼Œå‚æ•°åœ¨URL
POST /index/_search    â† å¤æ‚æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ¡ä»¶åœ¨body

æ£€æŸ¥å­˜åœ¨æ—¶ï¼š
HEAD /index/_doc/123   â† åªè¿”å›çŠ¶æ€ç ï¼Œä¸è¿”å›å†…å®¹(èŠ‚çœå¸¦å®½)
```

### 2.4 å¸¸ç”¨å‚æ•°è¯¦è§£


**ğŸ”¸ æ˜¾ç¤ºæ§åˆ¶å‚æ•°**

| å‚æ•° | **ä½œç”¨è¯´æ˜** | **ä½¿ç”¨ç¤ºä¾‹** | **æ•ˆæœå¯¹æ¯”** |
|------|-------------|-------------|-------------|
| `?v` | **æ˜¾ç¤ºåˆ—æ ‡é¢˜** | `GET /_cat/indices?v` | `è¡¨æ ¼æœ‰è¡¨å¤´ï¼Œæ˜“è¯»` |
| `?h=åˆ—å` | **æŒ‡å®šæ˜¾ç¤ºåˆ—** | `?h=index,docs.count` | `åªæ˜¾ç¤ºå…³å¿ƒçš„ä¿¡æ¯` |
| `?s=åˆ—å` | **æŒ‰åˆ—æ’åº** | `?s=docs.count:desc` | `æŒ‰æ–‡æ¡£æ•°é™åºæ’åˆ—` |
| `?format=json` | **JSONæ ¼å¼è¾“å‡º** | `?format=json` | `ä¾¿äºç¨‹åºå¤„ç†` |

```bash
# å‚æ•°æ•ˆæœå¯¹æ¯”ç¤ºä¾‹
GET /_cat/indices
# è¾“å‡ºï¼šyellow open users 5 1 1000 0 1.2mb 650kb (æ— è¡¨å¤´)

GET /_cat/indices?v  
# è¾“å‡ºï¼š
# health status index pri rep docs.count docs.deleted store.size pri.store.size
# yellow open   users   5   1       1000            0      1.2mb          650kb

GET /_cat/indices?v&h=index,docs.count&s=docs.count:desc
# è¾“å‡ºï¼š
# index    docs.count
# products      5000
# users         1000
```

**ğŸ”¸ æ ¼å¼åŒ–å‚æ•°**

| å‚æ•° | **ä½œç”¨è¯´æ˜** | **é€‚ç”¨åœºæ™¯** | **ç¤ºä¾‹æ•ˆæœ** |
|------|-------------|-------------|-------------|
| `?pretty` | **ç¾åŒ–JSONè¾“å‡º** | `å¼€å‘è°ƒè¯•ã€æ‰‹å·¥æŸ¥çœ‹` | `æ ¼å¼åŒ–ç¼©è¿›ï¼Œæ˜“è¯»` |
| `?filter_path` | **è¿‡æ»¤è¿”å›å­—æ®µ** | `å‡å°‘ç½‘ç»œä¼ è¾“` | `åªè¿”å›æŒ‡å®šè·¯å¾„` |
| `?human` | **äººæ€§åŒ–æ•°å€¼æ˜¾ç¤º** | `æŸ¥çœ‹å¤§å°ã€æ—¶é—´` | `1.2gbè€Œéå­—èŠ‚æ•°` |

```bash
# prettyå‚æ•°æ•ˆæœå¯¹æ¯”
GET /users/_doc/1
{"_index":"users","_id":"1","_source":{"name":"å¼ ä¸‰","age":25}}

GET /users/_doc/1?pretty
{
  "_index" : "users",
  "_id" : "1", 
  "_source" : {
    "name" : "å¼ ä¸‰",
    "age" : 25
  }
}
```

**ğŸ”¸ æ“ä½œæ§åˆ¶å‚æ•°**

| å‚æ•° | **ä½œç”¨è¯´æ˜** | **é»˜è®¤å€¼** | **ä½¿ç”¨åœºæ™¯** |
|------|-------------|-----------|-------------|
| `?timeout=30s` | **æ“ä½œè¶…æ—¶æ—¶é—´** | `30s` | `é˜²æ­¢æ“ä½œå¡æ­»` |
| `?refresh=true` | **ç«‹å³åˆ·æ–°ç´¢å¼•** | `false` | `å†™å…¥åç«‹å³å¯æœç´¢` |
| `?routing=user1` | **æŒ‡å®šè·¯ç”±å€¼** | `è‡ªåŠ¨` | `æ€§èƒ½ä¼˜åŒ–` |
| `?preference=_local` | **æŸ¥è¯¢åå¥½è®¾ç½®** | `éšæœº` | `æŒ‡å®šæŸ¥è¯¢èŠ‚ç‚¹` |

### 2.5 å¯é€‰å‚æ•°æ ‡è®°è¯´æ˜


**ğŸ”¸ æ–‡æ¡£æ ‡è®°å«ä¹‰**
```
æ–¹æ‹¬å·[]è¡¨ç¤ºå¯é€‰å‚æ•°ï¼š
GET /{index}/_search[?q=query][&size=10]

ç†è§£ï¼š
- /{index}/_search æ˜¯å¿…éœ€çš„åŸºç¡€è·¯å¾„
- [?q=query] æ˜¯å¯é€‰çš„æŸ¥è¯¢å‚æ•°  
- [&size=10] æ˜¯å¯é€‰çš„åˆ†é¡µå‚æ•°

å®é™…ä½¿ç”¨ï¼š
GET /users/_search                    â† æœ€ç®€å½¢å¼
GET /users/_search?q=name:å¼ ä¸‰        â† åŠ æŸ¥è¯¢æ¡ä»¶
GET /users/_search?q=name:å¼ ä¸‰&size=5 â† åŠ æŸ¥è¯¢+åˆ†é¡µ
```

**ğŸ”¸ GETä¸POSTå¯äº’æ¢è¯´æ˜**
```
å¤§å¤šæ•°GETè¯·æ±‚å¯ä»¥æ”¹ä¸ºPOSTè¯·æ±‚çš„åŸå› ï¼š

URLé•¿åº¦é™åˆ¶ï¼š
GET /users/_search?q=å¾ˆé•¿çš„æŸ¥è¯¢æ¡ä»¶...
â†’ URLå¯èƒ½è¶…è¿‡æµè§ˆå™¨/æœåŠ¡å™¨é™åˆ¶

POSTè¯·æ±‚ä¼˜åŠ¿ï¼š
POST /users/_search
{
  "query": {
    "bool": {
      "must": [å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶]
    }
  }
}
â†’ æŸ¥è¯¢æ¡ä»¶æ”¾åœ¨è¯·æ±‚ä½“ï¼Œæ— é•¿åº¦é™åˆ¶
â†’ æ”¯æŒå¤æ‚çš„JSONç»“æ„æŸ¥è¯¢
```

---

## 3. ğŸ—ï¸ é›†ç¾¤ä¸èŠ‚ç‚¹ç®¡ç†


### 3.1 é›†ç¾¤çŠ¶æ€ç›‘æ§


**ğŸ” é›†ç¾¤å¥åº·æ£€æŸ¥**
```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
GET /_cluster/health

# è¯¦ç»†å¥åº·ä¿¡æ¯(æ˜¾ç¤ºè¡¨å¤´)
GET /_cluster/health?v

# ç´¢å¼•çº§åˆ«å¥åº·çŠ¶æ€
GET /_cluster/health?level=indices

# åˆ†ç‰‡çº§åˆ«è¯¦ç»†ä¿¡æ¯
GET /_cluster/health?level=shards&pretty
```

**ğŸ’¡ å¥åº·çŠ¶æ€è§£è¯»**
```
é›†ç¾¤å¥åº·çŠ¶æ€é¢œè‰²å«ä¹‰ï¼š
ğŸŸ¢ Green:  æ‰€æœ‰ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸åˆ†é…
ğŸŸ¡ Yellow: æ‰€æœ‰ä¸»åˆ†ç‰‡æ­£å¸¸ï¼Œä½†éƒ¨åˆ†å‰¯æœ¬åˆ†ç‰‡æœªåˆ†é…
ğŸ”´ Red:    éƒ¨åˆ†ä¸»åˆ†ç‰‡ä¸å¯ç”¨ï¼Œé›†ç¾¤åŠŸèƒ½å—å½±å“

å¸¸è§YellowçŠ¶æ€åŸå› ï¼š
â€¢ å•èŠ‚ç‚¹é›†ç¾¤(å‰¯æœ¬æ— æ³•åˆ†é…åˆ°å…¶ä»–èŠ‚ç‚¹)
â€¢ èŠ‚ç‚¹æ•…éšœå¯¼è‡´å‰¯æœ¬åˆ†ç‰‡ä¸¢å¤±
â€¢ ç´¢å¼•å‰¯æœ¬æ•°è®¾ç½®è¿‡é«˜
â€¢ ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´åˆ†ç‰‡æ— æ³•åˆ†é…

RedçŠ¶æ€ç´§æ€¥å¤„ç†ï¼š
1. ç«‹å³æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
2. æŸ¥çœ‹æœªåˆ†é…åˆ†ç‰‡åŸå›   
3. æ£€æŸ¥ç£ç›˜ç©ºé—´å’Œå†…å­˜
4. è€ƒè™‘ä¸´æ—¶å…³é—­å‰¯æœ¬åˆ†ç‰‡
```

**ğŸ“Š é›†ç¾¤ç»Ÿè®¡ä¿¡æ¯**
```bash
# é›†ç¾¤æ•´ä½“ç»Ÿè®¡
GET /_cluster/stats

# é›†ç¾¤è®¾ç½®æŸ¥çœ‹
GET /_cluster/settings

# é›†ç¾¤çŠ¶æ€è¯¦ç»†ä¿¡æ¯(åŒ…å«è·¯ç”±è¡¨)
GET /_cluster/state?pretty
```

### 3.2 èŠ‚ç‚¹ç®¡ç†æ“ä½œ


**ğŸ”§ èŠ‚ç‚¹ä¿¡æ¯æŸ¥çœ‹**
```bash
# èŠ‚ç‚¹åˆ—è¡¨æ¦‚è§ˆ
GET /_cat/nodes?v

# èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
GET /_nodes

# æŒ‡å®šèŠ‚ç‚¹ä¿¡æ¯
GET /_nodes/{node_name}

# èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯
GET /_nodes/stats

# èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
GET /_cat/nodes?v&h=name,heap.percent,ram.percent,cpu,load_1m,disk.used_percent
```

**ğŸ“‹ èŠ‚ç‚¹è§’è‰²è¯´æ˜**
```
èŠ‚ç‚¹è§’è‰²æ ‡è¯†(node.roleåˆ—)ï¼š
d (data)    = æ•°æ®èŠ‚ç‚¹ï¼Œå­˜å‚¨æ•°æ®å’Œæ‰§è¡Œæœç´¢
m (master)  = ä¸»èŠ‚ç‚¹å€™é€‰ï¼Œå¯è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹
i (ingest)  = é¢„å¤„ç†èŠ‚ç‚¹ï¼Œæ•°æ®å†™å…¥å‰å¤„ç†
l (ml)      = æœºå™¨å­¦ä¹ èŠ‚ç‚¹
r (remote)  = è¿œç¨‹é›†ç¾¤å®¢æˆ·ç«¯èŠ‚ç‚¹
t (transform) = æ•°æ®è½¬æ¢èŠ‚ç‚¹

èŠ‚ç‚¹çŠ¶æ€æ ‡è¯†ï¼š
* = å½“å‰ä¸»èŠ‚ç‚¹
- = æ™®é€šèŠ‚ç‚¹

å®ä¾‹è§£è¯»ï¼š
name    heap.percent ram.percent cpu load_1m node.role master
node-1       65          78      12    0.5    dim       *
node-2       45          56       8    0.3    di        -
```

**âš™ï¸ èŠ‚ç‚¹åŠ¨æ€ç®¡ç†**
```bash
# æ’é™¤èŠ‚ç‚¹(ç»´æŠ¤æ—¶ä½¿ç”¨)
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.exclude._name": "node-1"
  }
}

# åŒ…å«ç‰¹å®šèŠ‚ç‚¹
PUT /_cluster/settings  
{
  "transient": {
    "cluster.routing.allocation.include._name": "node-1,node-2"
  }
}

# æ¸…é™¤æ’é™¤è®¾ç½®
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.exclude._name": null
  }
}
```

### 3.3 åˆ†ç‰‡åˆ†é…ç®¡ç†


**ğŸ” åˆ†ç‰‡çŠ¶æ€æŸ¥çœ‹**
```bash
# æŸ¥çœ‹æ‰€æœ‰åˆ†ç‰‡åˆ†å¸ƒ
GET /_cat/shards?v

# æŒ‰ç´¢å¼•åˆ†ç»„æŸ¥çœ‹åˆ†ç‰‡
GET /_cat/shards?v&s=index

# æŸ¥çœ‹æœªåˆ†é…åˆ†ç‰‡
GET /_cat/shards?v&h=index,shard,prirep,state,unassigned.reason

# åˆ†ç‰‡åˆ†é…è§£é‡Š
GET /_cluster/allocation/explain
{
  "index": "my_index",
  "shard": 0,
  "primary": true
}
```

**ğŸ”§ æ‰‹åŠ¨åˆ†ç‰‡åˆ†é…**
```bash
# æ‰‹åŠ¨åˆ†é…ä¸»åˆ†ç‰‡
POST /_cluster/reroute
{
  "commands": [
    {
      "allocate_empty_primary": {
        "index": "my_index",
        "shard": 0,
        "node": "node-1",
        "accept_data_loss": true
      }
    }
  ]
}

# ç§»åŠ¨åˆ†ç‰‡åˆ°å…¶ä»–èŠ‚ç‚¹
POST /_cluster/reroute
{
  "commands": [
    {
      "move": {
        "index": "my_index", 
        "shard": 0,
        "from_node": "node-1",
        "to_node": "node-2"
      }
    }
  ]
}
```

### 3.4 é›†ç¾¤è®¾ç½®ç®¡ç†


**âš™ï¸ é›†ç¾¤å‚æ•°é…ç½®**
```bash
# æŸ¥çœ‹å½“å‰é›†ç¾¤è®¾ç½®
GET /_cluster/settings?include_defaults=true

# ä¸´æ—¶è®¾ç½®(é‡å¯åå¤±æ•ˆ)
PUT /_cluster/settings
{
  "transient": {
    "cluster.routing.allocation.disk.threshold.low": "85%",
    "cluster.routing.allocation.disk.threshold.high": "90%"
  }
}

# æ°¸ä¹…è®¾ç½®(é‡å¯åä¿æŒ)
PUT /_cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.total_shards_per_node": 1000,
    "cluster.max_shards_per_node": 1000
  }
}
```

**ğŸ’¡ å¸¸ç”¨é›†ç¾¤è®¾ç½®**
```
ç£ç›˜æ°´ä½è®¾ç½®ï¼š
cluster.routing.allocation.disk.threshold.low: "85%"    # ä½æ°´ä½è­¦å‘Š
cluster.routing.allocation.disk.threshold.high: "90%"   # é«˜æ°´ä½ç¦æ­¢åˆ†é…
cluster.routing.allocation.disk.threshold.flood_stage: "95%" # æ´ªæ°´ä½åªè¯»

åˆ†ç‰‡åˆ†é…è®¾ç½®ï¼š  
cluster.routing.allocation.total_shards_per_node: 1000  # æ¯èŠ‚ç‚¹æœ€å¤§åˆ†ç‰‡æ•°
cluster.max_shards_per_node: 1000                      # é›†ç¾¤çº§åˆ†ç‰‡é™åˆ¶

æ¢å¤è®¾ç½®ï¼š
cluster.routing.allocation.node_concurrent_recoveries: 2 # å¹¶å‘æ¢å¤æ•°
indices.recovery.max_bytes_per_sec: "40mb"              # æ¢å¤é€Ÿåº¦é™åˆ¶
```

---

## 4. ğŸ“‚ ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†


### 4.1 ç´¢å¼•åŸºæœ¬æ“ä½œ


**ğŸ†• ç´¢å¼•åˆ›å»º**
```bash
# åˆ›å»ºæœ€ç®€å•ç´¢å¼•
PUT /my_index

# åˆ›å»ºå¸¦åŸºç¡€è®¾ç½®çš„ç´¢å¼•
PUT /my_index
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  }
}

# åˆ›å»ºå®Œæ•´é…ç½®ç´¢å¼•
PUT /my_index
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1,
    "refresh_interval": "1s",
    "max_result_window": 10000
  },
  "mappings": {
    "properties": {
      "title": {"type": "text"},
      "price": {"type": "float"},
      "created_at": {"type": "date"}
    }
  }
}
```

**ğŸ” ç´¢å¼•ä¿¡æ¯æŸ¥çœ‹**
```bash
# æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•æ¦‚å†µ
GET /_cat/indices?v

# æŒ‰å­˜å‚¨å¤§å°æ’åºæŸ¥çœ‹
GET /_cat/indices?v&s=store.size:desc

# æŸ¥çœ‹ç‰¹å®šç´¢å¼•è¯¦æƒ…
GET /my_index

# æŸ¥çœ‹ç´¢å¼•è®¾ç½®
GET /my_index/_settings

# æŸ¥çœ‹ç´¢å¼•æ˜ å°„
GET /my_index/_mapping

# æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯  
GET /my_index/_stats
```

**âŒ ç´¢å¼•åˆ é™¤**
```bash
# åˆ é™¤å•ä¸ªç´¢å¼•(å±é™©æ“ä½œ!)
DELETE /my_index

# åˆ é™¤å¤šä¸ªç´¢å¼•
DELETE /index1,index2,index3

# ä½¿ç”¨é€šé…ç¬¦åˆ é™¤(æå…¶å±é™©!)
DELETE /log-2024-*

# æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨
HEAD /my_index
```

> âš ï¸ **å®‰å…¨æç¤º**ï¼šåˆ é™¤ç´¢å¼•æ˜¯ä¸å¯é€†æ“ä½œï¼ç”Ÿäº§ç¯å¢ƒå¿…é¡»å…ˆå¤‡ä»½æ•°æ®å¹¶ç¡®è®¤ç´¢å¼•åç§°ã€‚

### 4.2 ç´¢å¼•è®¾ç½®åŠ¨æ€è°ƒæ•´


**âš™ï¸ è¿è¡Œæ—¶è®¾ç½®ä¿®æ”¹**
```bash
# ä¿®æ”¹å‰¯æœ¬æ•°é‡(å¸¸ç”¨äºæ‰©ç¼©å®¹)
PUT /my_index/_settings
{
  "number_of_replicas": 2
}

# è°ƒæ•´åˆ·æ–°é—´éš”(å½±å“æœç´¢å®æ—¶æ€§)
PUT /my_index/_settings
{
  "refresh_interval": "5s"
}

# æš‚åœåˆ·æ–°(æ‰¹é‡å¯¼å…¥æ—¶æå‡æ€§èƒ½)
PUT /my_index/_settings
{
  "refresh_interval": -1
}

# æ¢å¤é»˜è®¤åˆ·æ–°
PUT /my_index/_settings
{
  "refresh_interval": null
}
```

**ğŸ”§ ç´¢å¼•çŠ¶æ€ç®¡ç†**
```bash
# å…³é—­ç´¢å¼•(èŠ‚çœå†…å­˜å’ŒCPU)
POST /my_index/_close

# é‡æ–°æ‰“å¼€ç´¢å¼•
POST /my_index/_open

# æ‰‹åŠ¨åˆ·æ–°ç´¢å¼•(ä½¿æ–°æ•°æ®ç«‹å³å¯æœç´¢)
POST /my_index/_refresh

# æ‰‹åŠ¨flush(å¼ºåˆ¶å†™å…¥ç£ç›˜)
POST /my_index/_flush

# å¼ºåˆ¶åˆå¹¶æ®µ(å‡å°‘æ®µæ•°é‡ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½)
POST /my_index/_forcemerge?max_num_segments=1
```

### 4.3 ç´¢å¼•åˆ«åç®¡ç†


**ğŸ·ï¸ åˆ«åæ“ä½œè¯¦è§£**
```bash
# åˆ›å»ºç®€å•åˆ«å
POST /_aliases
{
  "actions": [
    {"add": {"index": "my_index_v1", "alias": "my_index"}}
  ]
}

# åˆ›å»ºå¸¦è¿‡æ»¤æ¡ä»¶çš„åˆ«å
POST /_aliases
{
  "actions": [
    {
      "add": {
        "index": "users_index",
        "alias": "active_users",
        "filter": {"term": {"status": "active"}}
      }
    }
  ]
}

# åŸå­æ€§åˆ‡æ¢åˆ«å(é›¶åœæœºéƒ¨ç½²)
POST /_aliases
{
  "actions": [
    {"remove": {"index": "my_index_v1", "alias": "my_index"}},
    {"add": {"index": "my_index_v2", "alias": "my_index"}}
  ]
}

# æŸ¥çœ‹æ‰€æœ‰åˆ«å
GET /_cat/aliases?v

# æŸ¥çœ‹ç‰¹å®šåˆ«åæŒ‡å‘çš„ç´¢å¼•
GET /_alias/my_index
```

**ğŸ’¡ åˆ«ååº”ç”¨åœºæ™¯**
```
ç‰ˆæœ¬ç®¡ç†ï¼š
my_index â†’ my_index_v1 (å½“å‰ç‰ˆæœ¬)
éƒ¨ç½²æ–°ç‰ˆæœ¬æ—¶ â†’ my_index â†’ my_index_v2 (æ— ç¼åˆ‡æ¢)

ç¯å¢ƒéš”ç¦»ï¼š
prod_data â†’ production_index_2024_09
test_data â†’ test_index_latest

æ—¶é—´åºåˆ—æ•°æ®ï¼š
current_logs â†’ logs_2024_09_21
archive_logs â†’ logs_2024_09_01 to logs_2024_09_20

å¤šç§Ÿæˆ·ï¼š
tenant_a_data â†’ tenant_a_index_v3
tenant_b_data â†’ tenant_b_index_v2
```

### 4.4 ç´¢å¼•æ¨¡æ¿


**ğŸ“ æ¨¡æ¿åˆ›å»ºå’Œç®¡ç†**
```bash
# åˆ›å»ºç´¢å¼•æ¨¡æ¿
PUT /_index_template/logs_template
{
  "index_patterns": ["logs-*", "application-logs-*"],
  "priority": 200,
  "template": {
    "settings": {
      "number_of_shards": 1,
      "number_of_replicas": 1,
      "refresh_interval": "5s"
    },
    "mappings": {
      "properties": {
        "@timestamp": {"type": "date"},
        "level": {"type": "keyword"},
        "message": {"type": "text"},
        "host": {"type": "keyword"}
      }
    }
  }
}

# æŸ¥çœ‹ç´¢å¼•æ¨¡æ¿
GET /_index_template/logs_template

# æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿
GET /_cat/templates?v

# åˆ é™¤ç´¢å¼•æ¨¡æ¿  
DELETE /_index_template/logs_template
```

**ğŸ¯ æ¨¡æ¿åŒ¹é…è§„åˆ™**
```
ç´¢å¼•æ¨¡å¼åŒ¹é…ï¼š
"index_patterns": ["logs-*"]
â†’ åŒ¹é…ï¼šlogs-2024, logs-app, logs-error
â†’ ä¸åŒ¹é…ï¼šlog-2024, mylogs-2024

ä¼˜å…ˆçº§è§„åˆ™ï¼š
"priority": 200 (é«˜ä¼˜å…ˆçº§)
"priority": 100 (ä½ä¼˜å…ˆçº§)
â†’ å½“å¤šä¸ªæ¨¡æ¿åŒ¹é…åŒä¸€ç´¢å¼•æ—¶ï¼Œé«˜ä¼˜å…ˆçº§æ¨¡æ¿çš„è®¾ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§

ç»„åˆæ¨¡æ¿ï¼š
å¯ä»¥æœ‰å¤šä¸ªæ¨¡æ¿åŒæ—¶åŒ¹é…ä¸€ä¸ªç´¢å¼•ï¼ŒESä¼šåˆå¹¶æ‰€æœ‰åŒ¹é…æ¨¡æ¿çš„é…ç½®
```

---

## 5. ğŸ“„ æ–‡æ¡£æ“ä½œæ ¸å¿ƒå‘½ä»¤


### 5.1 æ–‡æ¡£å¢åˆ æ”¹æŸ¥


**â• æ–‡æ¡£åˆ›å»ºå’Œæ·»åŠ **
```bash
# æŒ‡å®šIDåˆ›å»ºæ–‡æ¡£
PUT /users/_doc/1
{
  "name": "å¼ ä¸‰",
  "age": 25,
  "city": "åŒ—äº¬",
  "email": "zhangsan@example.com"
}

# è‡ªåŠ¨ç”ŸæˆID
POST /users/_doc
{
  "name": "æå››", 
  "age": 30,
  "city": "ä¸Šæµ·",
  "skills": ["Java", "Python", "Elasticsearch"]
}

# ä»…å½“æ–‡æ¡£ä¸å­˜åœ¨æ—¶åˆ›å»º
PUT /users/_create/2
{
  "name": "ç‹äº”",
  "age": 28
}

# æŒ‡å®šè·¯ç”±å€¼(æ€§èƒ½ä¼˜åŒ–)
PUT /users/_doc/3?routing=beijing
{
  "name": "èµµå…­",
  "city": "åŒ—äº¬"
}
```

**ğŸ” æ–‡æ¡£æŸ¥è¯¢å’Œæ£€ç´¢**
```bash
# æ ¹æ®IDè·å–å®Œæ•´æ–‡æ¡£
GET /users/_doc/1

# åªè·å–æºæ•°æ®(ä¸å«å…ƒæ•°æ®)
GET /users/_source/1

# è·å–æŒ‡å®šå­—æ®µ
GET /users/_doc/1?_source=name,age

# æ’é™¤æŒ‡å®šå­—æ®µ
GET /users/_doc/1?_source_excludes=email,skills

# æ£€æŸ¥æ–‡æ¡£æ˜¯å¦å­˜åœ¨(åªè¿”å›çŠ¶æ€ç )
HEAD /users/_doc/1

# è·å–æ–‡æ¡£ç‰ˆæœ¬ä¿¡æ¯
GET /users/_doc/1?version=2
```

**âœï¸ æ–‡æ¡£æ›´æ–°æ“ä½œ**
```bash
# éƒ¨åˆ†å­—æ®µæ›´æ–°(æ¨èæ–¹å¼)
POST /users/_update/1
{
  "doc": {
    "age": 26,
    "city": "æ·±åœ³"
  }
}

# ä½¿ç”¨è„šæœ¬æ›´æ–°
POST /users/_update/1
{
  "script": {
    "source": "ctx._source.age += params.increment",
    "params": {"increment": 1}
  }
}

# æ›´æ–°æ—¶æ’å…¥(upsert)
POST /users/_update/10
{
  "doc": {"name": "æ–°ç”¨æˆ·", "age": 22},
  "upsert": {"name": "æ–°ç”¨æˆ·", "age": 22, "status": "new"}
}

# æ¡ä»¶æ›´æ–°
POST /users/_update/1
{
  "script": {
    "source": "if (ctx._source.age < 30) { ctx._source.status = 'young' }"
  }
}
```

**ğŸ—‘ï¸ æ–‡æ¡£åˆ é™¤æ“ä½œ**
```bash
# åˆ é™¤æŒ‡å®šæ–‡æ¡£
DELETE /users/_doc/1

# æŒ‰æŸ¥è¯¢æ¡ä»¶åˆ é™¤å¤šä¸ªæ–‡æ¡£
POST /users/_delete_by_query
{
  "query": {
    "range": {
      "age": {"lt": 18}
    }
  }
}

# æŒ‰æŸ¥è¯¢åˆ é™¤å¹¶é™åˆ¶æ•°é‡
POST /users/_delete_by_query
{
  "size": 100,
  "query": {
    "term": {"status": "inactive"}
  }
}
```

### 5.2 æ‰¹é‡æ“ä½œ


**ğŸ“¦ Bulk APIè¯¦è§£**
```bash
# æ··åˆæ‰¹é‡æ“ä½œ
POST /_bulk
{"index": {"_index": "users", "_id": "1"}}
{"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}
{"index": {"_index": "users", "_id": "2"}}  
{"name": "æå››", "age": 30, "city": "ä¸Šæµ·"}
{"update": {"_index": "users", "_id": "1"}}
{"doc": {"age": 26}}
{"delete": {"_index": "users", "_id": "3"}}

# æŒ‡å®šç´¢å¼•çš„æ‰¹é‡æ“ä½œ
POST /users/_bulk
{"index": {"_id": "1"}}
{"name": "ç‹äº”", "age": 28}
{"update": {"_id": "2"}}
{"doc": {"status": "active"}}
```

**ğŸ’¡ Bulkæ“ä½œæœ€ä½³å®è·µ**
```
æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š
â€¢ æ‰¹é‡å¤§å°ï¼š1000-5000ä¸ªæ–‡æ¡£perè¯·æ±‚
â€¢ æ•°æ®é‡ï¼š5-15MB perè¯·æ±‚  
â€¢ å¹¶å‘æ§åˆ¶ï¼š2-4ä¸ªå¹¶å‘bulkè¯·æ±‚
â€¢ é”™è¯¯å¤„ç†ï¼šæ£€æŸ¥å“åº”ä¸­çš„errorså­—æ®µ

æ ¼å¼è¦æ±‚ï¼š
âœ“ æ¯è¡Œå¿…é¡»ä»¥æ¢è¡Œç¬¦(\n)ç»“æŸ
âœ“ æœ€åä¸€è¡Œä¹Ÿè¦æœ‰æ¢è¡Œç¬¦
âœ“ JSONä¸èƒ½æ ¼å¼åŒ–(ä¸èƒ½æœ‰ç¼©è¿›å’Œå¤šä½™ç©ºæ ¼)
âœ“ æ“ä½œè¡Œå’Œæ•°æ®è¡Œå¿…é¡»é…å¯¹

é”™è¯¯å¤„ç†ï¼š
{
  "took": 30,
  "errors": true,
  "items": [
    {"index": {"status": 201, "_id": "1"}},
    {"index": {"status": 400, "error": "parsing_exception"}}
  ]
}
```

### 5.3 å¤šæ–‡æ¡£æ“ä½œ


**ğŸ” æ‰¹é‡æŸ¥è¯¢**
```bash
# æ‰¹é‡è·å–æ–‡æ¡£
GET /_mget
{
  "docs": [
    {"_index": "users", "_id": "1"},
    {"_index": "users", "_id": "2", "_source": ["name", "age"]},
    {"_index": "products", "_id": "p1"}
  ]
}

# åŒä¸€ç´¢å¼•çš„æ‰¹é‡æŸ¥è¯¢
GET /users/_mget
{
  "docs": [
    {"_id": "1"},
    {"_id": "2"},
    {"_id": "3"}
  ]
}

# ç®€åŒ–å½¢å¼
GET /users/_mget
{
  "ids": ["1", "2", "3"]
}
```

### 5.4 æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶


**ğŸ”„ ä¹è§‚é”æœºåˆ¶**
```bash
# åŸºäºç‰ˆæœ¬å·çš„æ›´æ–°
PUT /users/_doc/1?version=2
{
  "name": "å¼ ä¸‰",
  "age": 26
}

# åŸºäºåºåˆ—å·çš„æ›´æ–°(æ¨è)
PUT /users/_doc/1?if_seq_no=5&if_primary_term=1  
{
  "name": "å¼ ä¸‰",
  "age": 27
}

# å¤–éƒ¨ç‰ˆæœ¬æ§åˆ¶
PUT /users/_doc/1?version=1001&version_type=external
{
  "name": "å¼ ä¸‰",
  "age": 25
}
```

---

## 6. ğŸ” æœç´¢æŸ¥è¯¢å®æˆ˜


### 6.1 åŸºç¡€æœç´¢è¯­æ³•


**ğŸ¯ ç®€å•æœç´¢æ–¹å¼**
```bash
# URIæœç´¢(é€‚åˆç®€å•æŸ¥è¯¢)
GET /users/_search?q=å¼ ä¸‰

# æŒ‡å®šå­—æ®µæœç´¢
GET /users/_search?q=name:å¼ ä¸‰

# èŒƒå›´æœç´¢
GET /users/_search?q=age:[25 TO 35]

# æ¨¡ç³Šæœç´¢
GET /users/_search?q=name:å¼ *

# å¤šå­—æ®µæœç´¢
GET /users/_search?q=name:å¼ ä¸‰ AND city:åŒ—äº¬
```

**ğŸ“ è¯·æ±‚ä½“æœç´¢(æ¨èæ–¹å¼)**
```bash
# æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£
GET /users/_search
{
  "query": {"match_all": {}}
}

# ç²¾ç¡®åŒ¹é…
GET /users/_search
{
  "query": {
    "term": {"city.keyword": "åŒ—äº¬"}
  }
}

# å…¨æ–‡æœç´¢
GET /users/_search
{
  "query": {
    "match": {"name": "å¼ ä¸‰"}
  }
}

# å¤šå­—æ®µæœç´¢
GET /users/_search
{
  "query": {
    "multi_match": {
      "query": "å¼ ä¸‰",
      "fields": ["name", "nickname"]
    }
  }
}
```

### 6.2 å¤åˆæŸ¥è¯¢è¯¦è§£


**ğŸ¨ å¸ƒå°”æŸ¥è¯¢(Bool Query)**
```bash
# å¤æ‚æ¡ä»¶ç»„åˆ
GET /users/_search
{
  "query": {
    "bool": {
      "must": [                           # å¿…é¡»æ»¡è¶³(AND)
        {"match": {"name": "å¼ ä¸‰"}}
      ],
      "filter": [                         # è¿‡æ»¤æ¡ä»¶(ä¸è®¡ç®—åˆ†æ•°)
        {"range": {"age": {"gte": 25, "lte": 35}}},
        {"term": {"status": "active"}}
      ],
      "must_not": [                       # å¿…é¡»ä¸æ»¡è¶³(NOT)
        {"term": {"city.keyword": "å·²åˆ é™¤"}}
      ],
      "should": [                         # åº”è¯¥æ»¡è¶³(ORï¼Œå¯é€‰)
        {"match": {"skills": "Java"}},
        {"match": {"skills": "Python"}}
      ],
      "minimum_should_match": 1           # shouldè‡³å°‘åŒ¹é…æ•°é‡
    }
  }
}
```

**ğŸ’¡ å¸ƒå°”æŸ¥è¯¢å­å¥è¯´æ˜**
```
æŸ¥è¯¢å­å¥ç±»å‹ï¼š
must:     å¿…é¡»åŒ¹é…ï¼Œå½±å“_scoreè¯„åˆ†ï¼Œæ€§èƒ½è¾ƒæ…¢
filter:   å¿…é¡»åŒ¹é…ï¼Œä¸å½±å“_scoreï¼Œæœ‰ç¼“å­˜ï¼Œæ€§èƒ½å¿«
must_not: å¿…é¡»ä¸åŒ¹é…ï¼Œä¸å½±å“_score
should:   å¯é€‰åŒ¹é…ï¼Œå½±å“_scoreï¼Œå¯ç”¨äºæƒé‡è°ƒæ•´

ä½¿ç”¨å»ºè®®ï¼š
âœ“ ç²¾ç¡®æ¡ä»¶ç”¨filter(å¦‚çŠ¶æ€ã€æ—¥æœŸèŒƒå›´)
âœ“ å…¨æ–‡æœç´¢ç”¨must(å¦‚æ ‡é¢˜ã€å†…å®¹æœç´¢)  
âœ“ æ’é™¤æ¡ä»¶ç”¨must_not(å¦‚åˆ é™¤ã€ç¦ç”¨çš„è®°å½•)
âœ“ å¯é€‰åŠ åˆ†ç”¨should(å¦‚æ ‡ç­¾åŒ¹é…)
```

### 6.3 èŒƒå›´å’Œæ¨¡ç³ŠæŸ¥è¯¢


**ğŸ“Š èŒƒå›´æŸ¥è¯¢**
```bash
# æ•°å€¼èŒƒå›´
GET /products/_search
{
  "query": {
    "range": {
      "price": {
        "gte": 100,      # å¤§äºç­‰äº
        "lte": 1000,     # å°äºç­‰äº
        "boost": 2.0     # æƒé‡åŠ æˆ
      }
    }
  }
}

# æ—¥æœŸèŒƒå›´
GET /logs/_search
{
  "query": {
    "range": {
      "timestamp": {
        "gte": "2024-01-01",
        "lte": "2024-01-31",
        "format": "yyyy-MM-dd"
      }
    }
  }
}

# ç›¸å¯¹æ—¶é—´èŒƒå›´
GET /logs/_search
{
  "query": {
    "range": {
      "timestamp": {
        "gte": "now-7d",       # æœ€è¿‘7å¤©
        "lte": "now"
      }
    }
  }
}
```

**ğŸ” æ¨¡ç³Šå’Œé€šé…ç¬¦æŸ¥è¯¢**
```bash
# æ¨¡ç³ŠæŸ¥è¯¢(å…è®¸æ‹¼å†™é”™è¯¯)
GET /users/_search
{
  "query": {
    "fuzzy": {
      "name": {
        "value": "zhansan",    # é”™æ‹¼çš„"å¼ ä¸‰"
        "fuzziness": "AUTO"    # è‡ªåŠ¨æ¨¡ç³Šåº¦
      }
    }
  }
}

# é€šé…ç¬¦æŸ¥è¯¢
GET /users/_search
{
  "query": {
    "wildcard": {"name.keyword": "*ä¸‰*"}
  }
}

# æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢
GET /users/_search
{
  "query": {
    "regexp": {"email": ".*@gmail\\.com"}
  }
}

# å‰ç¼€æŸ¥è¯¢
GET /users/_search
{
  "query": {
    "prefix": {"name.keyword": "å¼ "}
  }
}
```

### 6.4 æœç´¢ç»“æœæ§åˆ¶


**ğŸ“„ åˆ†é¡µå’Œæ’åº**
```bash
# åŸºç¡€åˆ†é¡µ
GET /users/_search
{
  "from": 0,           # è·³è¿‡æ–‡æ¡£æ•°
  "size": 10,          # è¿”å›æ–‡æ¡£æ•°
  "query": {"match_all": {}}
}

# å¤æ‚æ’åº
GET /users/_search
{
  "sort": [
    {"age": {"order": "desc"}},                    # æŒ‰å¹´é¾„é™åº
    {"_score": {"order": "desc"}},                 # æŒ‰ç›¸å…³æ€§é™åº
    {"name.keyword": {"order": "asc"}},            # æŒ‰å§“åå‡åº
    {"created_at": {"order": "desc", "missing": "_last"}} # ç©ºå€¼æ’æœ€å
  ],
  "query": {"match_all": {}}
}
```

**âš ï¸ æ·±åº¦åˆ†é¡µé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**
```bash
# é—®é¢˜ï¼šfrom + size > 10000ä¼šæŠ¥é”™
GET /users/_search
{
  "from": 10000,
  "size": 10
}

# è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨search_after(æ¨è)
GET /users/_search
{
  "size": 10,
  "sort": [{"age": "asc"}, {"_id": "asc"}],
  "search_after": [25, "user_123"]    # ä¸Šæ¬¡æŸ¥è¯¢æœ€åä¸€æ¡çš„sortå€¼
}

# è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨scroll(éå†æ‰€æœ‰æ•°æ®)
GET /users/_search?scroll=1m
{
  "size": 100,
  "sort": ["_doc"]
}

# ç»§ç»­scroll
GET /_search/scroll
{
  "scroll": "1m",
  "scroll_id": "DXF1ZXJ5QW5kRmV0Y2g..."
}
```

### 6.5 æœç´¢ç»“æœå­—æ®µæ§åˆ¶


**ğŸ¯ å­—æ®µé€‰æ‹©å’Œè¿‡æ»¤**
```bash
# è¿”å›æŒ‡å®šå­—æ®µ
GET /users/_search
{
  "_source": ["name", "age", "city"],
  "query": {"match_all": {}}
}

# æ’é™¤æŒ‡å®šå­—æ®µ
GET /users/_search
{
  "_source": {
    "excludes": ["password", "internal_id"]
  },
  "query": {"match_all": {}}
}

# åŒ…å«å’Œæ’é™¤ç»“åˆ
GET /users/_search
{
  "_source": {
    "includes": ["name", "contact.*"],
    "excludes": ["contact.private_phone"]
  },
  "query": {"match_all": {}}
}

# ä¸è¿”å›_sourceï¼Œåªè¿”å›å…ƒæ•°æ®
GET /users/_search
{
  "_source": false,
  "query": {"match_all": {}}
}
```

### 6.6 èšåˆç»Ÿè®¡æŸ¥è¯¢


**ğŸ“ˆ åŸºç¡€èšåˆç»Ÿè®¡**
```bash
# ç®€å•ç»Ÿè®¡æŒ‡æ ‡
GET /users/_search
{
  "size": 0,          # ä¸è¿”å›æ–‡æ¡£ï¼Œåªè¦èšåˆç»“æœ
  "aggs": {
    "avg_age": {"avg": {"field": "age"}},
    "max_age": {"max": {"field": "age"}},
    "min_age": {"min": {"field": "age"}},
    "sum_age": {"sum": {"field": "age"}},
    "stats_age": {"stats": {"field": "age"}},        # åŒ…å«ä¸Šè¿°æ‰€æœ‰ç»Ÿè®¡
    "count_users": {"value_count": {"field": "age"}}
  }
}
```

**ğŸ“Š åˆ†ç»„èšåˆ**
```bash
# æŒ‰å­—æ®µåˆ†ç»„ç»Ÿè®¡
GET /users/_search
{
  "size": 0,
  "aggs": {
    "by_city": {
      "terms": {
        "field": "city.keyword",
        "size": 10                    # è¿”å›top10åŸå¸‚
      },
      "aggs": {                       # åµŒå¥—èšåˆ
        "avg_age": {"avg": {"field": "age"}},
        "age_ranges": {
          "range": {
            "field": "age",
            "ranges": [
              {"to": 25, "key": "young"},
              {"from": 25, "to": 35, "key": "middle"},
              {"from": 35, "key": "senior"}
            ]
          }
        }
      }
    }
  }
}
```

**ğŸ•’ æ—¥æœŸç›´æ–¹å›¾èšåˆ**
```bash
# æŒ‰æ—¶é—´æ®µç»Ÿè®¡
GET /logs/_search
{
  "size": 0,
  "aggs": {
    "by_month": {
      "date_histogram": {
        "field": "timestamp",
        "calendar_interval": "month",   # æŒ‰æœˆç»Ÿè®¡
        "format": "yyyy-MM",
        "time_zone": "+08:00"
      },
      "aggs": {
        "error_count": {
          "filter": {"term": {"level": "ERROR"}}
        }
      }
    }
  }
}
```

---

## 7. ğŸ—ºï¸ æ˜ å°„ä¸è®¾ç½®ç®¡ç†


### 7.1 æ˜ å°„åŸºç¡€æ¦‚å¿µ


**ğŸ—‚ï¸ æ˜ å°„(Mapping)çš„ä½œç”¨**
```
æ˜ å°„å®šä¹‰äº†ç´¢å¼•ä¸­å­—æ®µçš„å­˜å‚¨å’Œæœç´¢è¡Œä¸ºï¼š
â€¢ å­—æ®µæ•°æ®ç±»å‹(text, keyword, integerç­‰)
â€¢ å­—æ®µåˆ†æå™¨è®¾ç½®(å¦‚ä½•åˆ†è¯)
â€¢ å­—æ®µç´¢å¼•ç­–ç•¥(æ˜¯å¦å¯æœç´¢ã€æ’åº)
â€¢ å­—æ®µæ ¼å¼åŒ–è§„åˆ™(æ—¥æœŸæ ¼å¼ç­‰)

ç±»æ¯”ç†è§£ï¼š
æ•°æ®åº“çš„è¡¨ç»“æ„ â†’ ESçš„æ˜ å°„
åˆ—çš„æ•°æ®ç±»å‹   â†’ å­—æ®µçš„ç±»å‹  
åˆ—çš„çº¦æŸ       â†’ å­—æ®µçš„é…ç½®
```

**ğŸ“‹ æ ¸å¿ƒæ•°æ®ç±»å‹å¯¹ç…§è¡¨**

| ESå­—æ®µç±»å‹ | **å­˜å‚¨å†…å®¹** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹æ•°æ®** | **æœç´¢ç‰¹æ€§** |
|-----------|-------------|-------------|-------------|-------------|
| `text` | **å¯åˆ†è¯æ–‡æœ¬** | `æ–‡ç« å†…å®¹ã€å•†å“æè¿°` | `"è‹¹æœæ‰‹æœºå¾ˆå¥½ç”¨"` | `å…¨æ–‡æœç´¢ã€ç›¸å…³æ€§è¯„åˆ†` |
| `keyword` | **ç²¾ç¡®å€¼æ–‡æœ¬** | `çŠ¶æ€ã€æ ‡ç­¾ã€ID` | `"å·²å‘è´§"` | `ç²¾ç¡®åŒ¹é…ã€èšåˆã€æ’åº` |
| `integer` | **32ä½æ•´æ•°** | `å¹´é¾„ã€æ•°é‡` | `25` | `èŒƒå›´æŸ¥è¯¢ã€æ•°å€¼è®¡ç®—` |
| `long` | **64ä½æ•´æ•°** | `æ—¶é—´æˆ³ã€å¤§æ•°å€¼` | `1634567890000` | `èŒƒå›´æŸ¥è¯¢ã€æ•°å€¼è®¡ç®—` |
| `float` | **32ä½æµ®ç‚¹æ•°** | `ä»·æ ¼ã€è¯„åˆ†` | `99.99` | `èŒƒå›´æŸ¥è¯¢ã€æ•°å€¼è®¡ç®—` |
| `double` | **64ä½æµ®ç‚¹æ•°** | `ç²¾ç¡®å°æ•°` | `3.141592653589793` | `é«˜ç²¾åº¦æ•°å€¼è®¡ç®—` |
| `boolean` | **å¸ƒå°”å€¼** | `æ˜¯å¦æ ‡å¿—` | `true, false` | `ç²¾ç¡®åŒ¹é…ã€è¿‡æ»¤` |
| `date` | **æ—¥æœŸæ—¶é—´** | `åˆ›å»ºæ—¶é—´ã€ç”Ÿæ—¥` | `"2024-09-21T10:30:00"` | `æ—¥æœŸèŒƒå›´ã€æ’åº` |
| `geo_point` | **åœ°ç†åæ ‡** | `ä½ç½®ä¿¡æ¯` | `{"lat": 39.9, "lon": 116.4}` | `åœ°ç†è·ç¦»ã€èŒƒå›´æŸ¥è¯¢` |

### 7.2 åˆ›å»ºè‡ªå®šä¹‰æ˜ å°„


**ğŸ¨ å®šä¹‰å®Œæ•´æ˜ å°„**
```bash
# åˆ›å»ºå¸¦å®Œæ•´æ˜ å°„çš„ç´¢å¼•
PUT /products
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",           # ä¸­æ–‡åˆ†è¯å™¨
        "fields": {
          "keyword": {                      # å¤šå­—æ®µæ˜ å°„
            "type": "keyword",
            "ignore_above": 256
          }
        }
      },
      "description": {
        "type": "text",
        "analyzer": "ik_smart"
      },
      "price": {
        "type": "float",
        "null_value": 0                     # ç©ºå€¼é»˜è®¤å¤„ç†
      },
      "category": {
        "type": "keyword"
      },
      "tags": {
        "type": "keyword"                   # æ•°ç»„å­—æ®µ
      },
      "created_at": {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
      },
      "location": {
        "type": "geo_point"
      },
      "specs": {                            # å¯¹è±¡å­—æ®µ
        "properties": {
          "color": {"type": "keyword"},
          "size": {"type": "keyword"},
          "weight": {"type": "float"}
        }
      }
    }
  }
}
```

### 7.3 text vs keyword æ·±åº¦è§£æ


**ğŸ” ä¸¤ç§ç±»å‹çš„æœ¬è´¨åŒºåˆ«**
```bash
# æ¼”ç¤ºtextå’Œkeywordçš„åŒºåˆ«
PUT /demo
{
  "mappings": {
    "properties": {
      "title_text": {"type": "text"},
      "title_keyword": {"type": "keyword"}
    }
  }
}

# æ·»åŠ æµ‹è¯•æ•°æ®
PUT /demo/_doc/1
{
  "title_text": "è‹¹æœiPhone 15 Pro Max",
  "title_keyword": "è‹¹æœiPhone 15 Pro Max"
}

# textå­—æ®µåˆ†è¯æœç´¢(ä¼šåŒ¹é…)
GET /demo/_search
{
  "query": {"match": {"title_text": "è‹¹æœæ‰‹æœº"}}
}

# keywordå­—æ®µç²¾ç¡®æœç´¢(ä¸ä¼šåŒ¹é…)  
GET /demo/_search
{
  "query": {"term": {"title_keyword": "è‹¹æœæ‰‹æœº"}}
}

# keywordå­—æ®µç²¾ç¡®æœç´¢(ä¼šåŒ¹é…)
GET /demo/_search
{
  "query": {"term": {"title_keyword": "è‹¹æœiPhone 15 Pro Max"}}
}
```

**ğŸ’¡ å­—æ®µç±»å‹é€‰æ‹©æŒ‡å¯¼**
```
textç±»å‹ä½¿ç”¨åœºæ™¯ï¼š
âœ“ éœ€è¦å…¨æ–‡æœç´¢çš„å†…å®¹ï¼šæ–‡ç« æ­£æ–‡ã€å•†å“æè¿°ã€è¯„è®ºå†…å®¹
âœ“ éœ€è¦ç›¸å…³æ€§è¯„åˆ†ï¼šæœç´¢ç»“æœæŒ‰ç›¸å…³åº¦æ’åº
âœ“ éœ€è¦é«˜äº®æ˜¾ç¤ºï¼šæœç´¢å…³é”®è¯é«˜äº®
âœ“ æ”¯æŒåŒä¹‰è¯ã€æ¨¡ç³ŠåŒ¹é…ï¼šæ™ºèƒ½æœç´¢

keywordç±»å‹ä½¿ç”¨åœºæ™¯ï¼š
âœ“ ç²¾ç¡®åŒ¹é…ï¼šçŠ¶æ€å­—æ®µ(å·²å‘è´§ã€å·²å®Œæˆ)
âœ“ èšåˆç»Ÿè®¡ï¼šæŒ‰ç±»åˆ«ã€åŸå¸‚åˆ†ç»„ç»Ÿè®¡
âœ“ æ’åºï¼šæŒ‰ç…§å­—æ®µå€¼ç²¾ç¡®æ’åº
âœ“ æ ‡ç­¾å’Œè¿‡æ»¤ï¼šå•†å“æ ‡ç­¾ã€ç”¨æˆ·æ ‡ç­¾

å¤šå­—æ®µæ˜ å°„ï¼š
title: {
  type: "text",           â† ç”¨äºæœç´¢
  fields: {
    keyword: {            â† ç”¨äºèšåˆå’Œæ’åº
      type: "keyword"
    }
  }
}
```

### 7.4 åŠ¨æ€æ˜ å°„ç®¡ç†


**âš™ï¸ åŠ¨æ€æ˜ å°„é…ç½®**
```bash
# æŸ¥çœ‹å½“å‰åŠ¨æ€æ˜ å°„è§„åˆ™
GET /my_index/_mapping

# è®¾ç½®åŠ¨æ€æ˜ å°„ç­–ç•¥
PUT /my_index
{
  "mappings": {
    "dynamic": "strict",              # strict/true/false
    "properties": {
      "name": {"type": "text"}
    }
  }
}

# åŠ¨æ€æ¨¡æ¿
PUT /my_index
{
  "mappings": {
    "dynamic_templates": [
      {
        "strings_as_keywords": {       # æ¨¡æ¿åç§°
          "match_mapping_type": "string",
          "mapping": {
            "type": "keyword",
            "ignore_above": 256
          }
        }
      },
      {
        "integers_as_long": {
          "match_mapping_type": "long",
          "mapping": {"type": "long"}
        }
      }
    ]
  }
}
```

**ğŸ’¡ åŠ¨æ€æ˜ å°„ç­–ç•¥è¯´æ˜**
```
dynamicè®¾ç½®å€¼ï¼š
true:    å…è®¸åŠ¨æ€æ·»åŠ æ–°å­—æ®µ(é»˜è®¤)
false:   æ–°å­—æ®µä¼šè¢«å¿½ç•¥ï¼Œä¸ç´¢å¼•ä½†ä¼šå­˜å‚¨
strict:  æ–°å­—æ®µä¼šå¯¼è‡´æ–‡æ¡£ç´¢å¼•å¤±è´¥

ä½¿ç”¨å»ºè®®ï¼š
â€¢ å¼€å‘ç¯å¢ƒï¼štrue(çµæ´»æµ‹è¯•)
â€¢ ç”Ÿäº§ç¯å¢ƒï¼šstrict(é¿å…å­—æ®µè†¨èƒ€)
â€¢ æ—¥å¿—ç´¢å¼•ï¼šfalse(å­˜å‚¨ä½†ä¸ç´¢å¼•æœªçŸ¥å­—æ®µ)
```

### 7.5 æ˜ å°„æ›´æ–°å’Œç®¡ç†


**ğŸ”§ æ˜ å°„å­—æ®µæ·»åŠ **
```bash
# ä¸ºç°æœ‰ç´¢å¼•æ·»åŠ æ–°å­—æ®µ
PUT /my_index/_mapping
{
  "properties": {
    "new_field": {
      "type": "keyword"
    },
    "nested_obj": {
      "properties": {
        "sub_field": {"type": "text"}
      }
    }
  }
}

# æŸ¥çœ‹ç‰¹å®šå­—æ®µæ˜ å°„
GET /my_index/_mapping/field/title

# æŸ¥çœ‹å­—æ®µèƒ½åŠ›
GET /my_index/_field_caps?fields=title,price
```

**âš ï¸ æ˜ å°„é™åˆ¶è¯´æ˜**
```
ä¸å¯ä¿®æ”¹çš„æ˜ å°„å±æ€§ï¼š
â€¢ å­—æ®µæ•°æ®ç±»å‹(textä¸èƒ½æ”¹ä¸ºkeyword)
â€¢ åˆ†æå™¨è®¾ç½®(analyzerä¸èƒ½ä¿®æ”¹)
â€¢ ç´¢å¼•ç­–ç•¥(indexä¸èƒ½ä»trueæ”¹ä¸ºfalse)

è§£å†³æ–¹æ¡ˆï¼š
1. åˆ›å»ºæ–°ç´¢å¼• â†’ å®šä¹‰æ­£ç¡®æ˜ å°„ â†’ reindexæ•°æ®
2. æ·»åŠ æ–°å­—æ®µ â†’ ä½¿ç”¨åˆ«ååˆ‡æ¢
3. å¤šå­—æ®µæ˜ å°„ â†’ åŒæ—¶æ”¯æŒå¤šç§ç±»å‹
```

---

## 8. ğŸ“¥ æ•°æ®å¯¼å…¥å¯¼å‡º


### 8.1 å•æ–‡æ¡£å¯¼å…¥å¯¼å‡º


**ğŸ“¤ æ–‡æ¡£å¯¼å‡º**
```bash
# å¯¼å‡ºå•ä¸ªæ–‡æ¡£(å«å…ƒæ•°æ®)
GET /users/_doc/1

# åªå¯¼å‡ºæºæ•°æ®
GET /users/_source/1

# å¯¼å‡ºæŒ‡å®šå­—æ®µ
GET /users/_doc/1?_source=name,age,email

# æ‰¹é‡å¯¼å‡ºæŒ‡å®šIDçš„æ–‡æ¡£
GET /users/_mget
{
  "ids": ["1", "2", "3"]
}
```

**ğŸ“¥ æ–‡æ¡£å¯¼å…¥**
```bash
# è¦†ç›–å¯¼å…¥(PUT)
PUT /users/_doc/1
{
  "name": "å¼ ä¸‰",
  "age": 25,
  "city": "åŒ—äº¬"
}

# æ–°å¢å¯¼å…¥(POST)
POST /users/_doc
{
  "name": "æå››",
  "age": 30
}

# æ¡ä»¶å¯¼å…¥(ä»…å½“ä¸å­˜åœ¨æ—¶)
PUT /users/_create/2
{
  "name": "ç‹äº”",
  "age": 28
}
```

### 8.2 æ‰¹é‡æ•°æ®å¯¼å…¥


**ğŸ“¦ Bulk APIæ‰¹é‡å¯¼å…¥**
```bash
# ä»æ–‡ä»¶æ‰¹é‡å¯¼å…¥
curl -X POST "localhost:9200/_bulk" \
     -H "Content-Type: application/json" \
     --data-binary @bulk_data.json

# bulk_data.jsonæ–‡ä»¶æ ¼å¼ï¼š
{"index": {"_index": "users", "_id": "1"}}
{"name": "å¼ ä¸‰", "age": 25, "city": "åŒ—äº¬"}
{"index": {"_index": "users", "_id": "2"}}
{"name": "æå››", "age": 30, "city": "ä¸Šæµ·"}
```

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–çš„æ‰¹é‡å¯¼å…¥**
```bash
# ä¼˜åŒ–è®¾ç½®ï¼šå…³é—­refreshå’Œå‰¯æœ¬
PUT /users/_settings
{
  "refresh_interval": -1,
  "number_of_replicas": 0
}

# æ‰§è¡Œæ‰¹é‡å¯¼å…¥...

# æ¢å¤è®¾ç½®
PUT /users/_settings
{
  "refresh_interval": "1s",
  "number_of_replicas": 1
}

# æ‰‹åŠ¨åˆ·æ–°
POST /users/_refresh
```

### 8.3 ä½¿ç”¨Logstashå¯¼å…¥


**ğŸš€ Logstashé…ç½®æ–‡ä»¶ç¤ºä¾‹**
```ruby
# logstash.conf - CSVæ–‡ä»¶å¯¼å…¥ES
input {
  file {
    path => "/data/users.csv"
    start_position => "beginning"
    sincedb_path => "/dev/null"
  }
}

filter {
  csv {
    separator => ","
    columns => ["id", "name", "age", "city", "email"]
  }
  
  mutate {
    convert => { 
      "age" => "integer" 
      "id" => "integer"
    }
    remove_field => ["message", "host", "@version"]
  }
  
  if [age] == "" {
    drop { }
  }
}

output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "users"
    document_id => "%{id}"
  }
  
  stdout {
    codec => rubydebug
  }
}
```

**ğŸ—„ï¸ ä»æ•°æ®åº“å¯¼å…¥**
```ruby
# ä»MySQLå¯¼å…¥ES
input {
  jdbc {
    jdbc_driver_library => "/path/to/mysql-connector.jar"
    jdbc_driver_class => "com.mysql.jdbc.Driver"
    jdbc_connection_string => "jdbc:mysql://localhost:3306/mydb"
    jdbc_user => "username"
    jdbc_password => "password"
    statement => "SELECT * FROM users WHERE updated_at > :sql_last_value"
    schedule => "*/5 * * * *"  # æ¯5åˆ†é’ŸåŒæ­¥ä¸€æ¬¡
    use_column_value => true
    tracking_column => "updated_at"
  }
}

filter {
  mutate {
    remove_field => ["@version", "@timestamp"]
  }
}

output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "users"
    document_id => "%{id}"
  }
}
```

### 8.4 Reindexé‡å»ºç´¢å¼•


**ğŸ”„ åŸºç¡€é‡å»ºæ“ä½œ**
```bash
# åŸºæœ¬é‡å»ºç´¢å¼•
POST /_reindex
{
  "source": {
    "index": "old_users"
  },
  "dest": {
    "index": "new_users"
  }
}

# å¸¦æŸ¥è¯¢æ¡ä»¶çš„é‡å»º
POST /_reindex
{
  "source": {
    "index": "users",
    "query": {
      "range": {
        "age": {"gte": 18}
      }
    }
  },
  "dest": {
    "index": "adult_users"
  }
}

# è¿œç¨‹é›†ç¾¤é‡å»º
POST /_reindex
{
  "source": {
    "remote": {
      "host": "http://old-cluster:9200",
      "username": "user",
      "password": "pass"
    },
    "index": "old_index"
  },
  "dest": {
    "index": "new_index"
  }
}

# é‡å»ºæ—¶ä¿®æ”¹å­—æ®µ
POST /_reindex
{
  "source": {"index": "users"},
  "dest": {"index": "new_users"},
  "script": {
    "source": "ctx._source.age_group = ctx._source.age < 30 ? 'young' : 'old'"
  }
}
```

**âš¡ é‡å»ºæ€§èƒ½ä¼˜åŒ–**
```bash
# å¹¶è¡Œé‡å»º(æé«˜é€Ÿåº¦)
POST /_reindex?slices=5
{
  "source": {"index": "large_index"},
  "dest": {"index": "new_index"}
}

# æ§åˆ¶é‡å»ºé€Ÿåº¦(é¿å…å½±å“é›†ç¾¤æ€§èƒ½)
POST /_reindex?requests_per_second=100
{
  "source": {"index": "users"},
  "dest": {"index": "new_users"}
}

# æŸ¥çœ‹é‡å»ºä»»åŠ¡è¿›åº¦
GET /_tasks?actions=*reindex&detailed
```

### 8.5 å¿«ç…§å¤‡ä»½ä¸æ¢å¤


**ğŸ’¾ å¿«ç…§ä»“åº“ç®¡ç†**
```bash
# æ³¨å†Œæ–‡ä»¶ç³»ç»Ÿå¿«ç…§ä»“åº“
PUT /_snapshot/my_backup
{
  "type": "fs",
  "settings": {
    "location": "/mount/backups/elasticsearch",
    "compress": true
  }
}

# æ³¨å†ŒS3å¿«ç…§ä»“åº“
PUT /_snapshot/s3_backup
{
  "type": "s3",
  "settings": {
    "bucket": "my-backup-bucket",
    "region": "us-east-1",
    "base_path": "elasticsearch-snapshots"
  }
}

# æŸ¥çœ‹å¿«ç…§ä»“åº“
GET /_snapshot/_all
```

**ğŸ“¸ åˆ›å»ºå’Œç®¡ç†å¿«ç…§**
```bash
# åˆ›å»ºå¿«ç…§(åŒ…å«æ‰€æœ‰ç´¢å¼•)
PUT /_snapshot/my_backup/snapshot_2024_09_21
{
  "indices": "*",
  "ignore_unavailable": true,
  "include_global_state": false,
  "metadata": {
    "taken_by": "admin",
    "reason": "daily backup"
  }
}

# åˆ›å»ºç‰¹å®šç´¢å¼•å¿«ç…§
PUT /_snapshot/my_backup/users_snapshot
{
  "indices": "users,products",
  "ignore_unavailable": true
}

# æŸ¥çœ‹å¿«ç…§çŠ¶æ€
GET /_snapshot/my_backup/snapshot_2024_09_21

# æŸ¥çœ‹æ‰€æœ‰å¿«ç…§
GET /_snapshot/my_backup/_all

# åˆ é™¤å¿«ç…§
DELETE /_snapshot/my_backup/old_snapshot
```

**ğŸ”„ å¿«ç…§æ¢å¤æ“ä½œ**
```bash
# æ¢å¤æ•´ä¸ªå¿«ç…§
POST /_snapshot/my_backup/snapshot_2024_09_21/_restore

# æ¢å¤ç‰¹å®šç´¢å¼•
POST /_snapshot/my_backup/snapshot_2024_09_21/_restore
{
  "indices": "users,products",
  "ignore_unavailable": true,
  "include_global_state": false
}

# æ¢å¤æ—¶é‡å‘½åç´¢å¼•
POST /_snapshot/my_backup/snapshot_2024_09_21/_restore
{
  "indices": "users",
  "rename_pattern": "(.+)",
  "rename_replacement": "restored_$1"
}

# æŸ¥çœ‹æ¢å¤è¿›åº¦
GET /_recovery?human
```

---

## 9. ğŸ“Š ç›‘æ§ä¸è¿ç»´å‘½ä»¤


### 9.1 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ é›†ç¾¤æ€§èƒ½ç›‘æ§**
```bash
# é›†ç¾¤æ•´ä½“æ€§èƒ½ç»Ÿè®¡
GET /_cluster/stats?human&pretty

# èŠ‚ç‚¹æ€§èƒ½ç»Ÿè®¡
GET /_nodes/stats?human

# ç´¢å¼•æ€§èƒ½ç»Ÿè®¡
GET /_stats?human

# å…·ä½“ç´¢å¼•ç»Ÿè®¡
GET /my_index/_stats?human

# èŠ‚ç‚¹èµ„æºä½¿ç”¨ç›‘æ§
GET /_cat/nodes?v&h=name,heap.percent,ram.percent,cpu,load_1m,disk.used_percent
```

**ğŸ” å…³é”®æ€§èƒ½æŒ‡æ ‡è§£è¯»**
```
å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
ğŸ”¸ heap.percent:     JVMå †å†…å­˜ä½¿ç”¨ç‡(æ­£å¸¸<75%)
ğŸ”¸ ram.percent:      ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡(æ­£å¸¸<85%) 
ğŸ”¸ cpu:              CPUä½¿ç”¨ç‡(æ­£å¸¸<80%)
ğŸ”¸ load_1m:          1åˆ†é’Ÿå¹³å‡è´Ÿè½½
ğŸ”¸ disk.used_percent: ç£ç›˜ä½¿ç”¨ç‡(æ­£å¸¸<85%)

æœç´¢æ€§èƒ½æŒ‡æ ‡ï¼š
ğŸ”¸ query_time_in_millis:  æŸ¥è¯¢è€—æ—¶
ğŸ”¸ query_total:           æŸ¥è¯¢æ€»æ•°
ğŸ”¸ fetch_time_in_millis:  è·å–è€—æ—¶
ğŸ”¸ search.query_current:  å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŸ¥è¯¢æ•°

ç´¢å¼•æ€§èƒ½æŒ‡æ ‡ï¼š
ğŸ”¸ indexing.index_time_in_millis: ç´¢å¼•è€—æ—¶
ğŸ”¸ indexing.index_total:          ç´¢å¼•æ–‡æ¡£æ€»æ•°
ğŸ”¸ store.size_in_bytes:           å­˜å‚¨å¤§å°
```

### 9.2 æ…¢æŸ¥è¯¢æ—¥å¿—ç›‘æ§


**â±ï¸ æ…¢æŸ¥è¯¢è®¾ç½®**
```bash
# è®¾ç½®ç´¢å¼•çº§æ…¢æŸ¥è¯¢é˜ˆå€¼
PUT /my_index/_settings
{
  "index.search.slowlog.threshold.query.warn": "10s",
  "index.search.slowlog.threshold.query.info": "5s", 
  "index.search.slowlog.threshold.query.debug": "2s",
  "index.search.slowlog.threshold.fetch.warn": "1s",
  "index.indexing.slowlog.threshold.index.warn": "10s",
  "index.indexing.slowlog.threshold.index.info": "5s"
}

# æŸ¥çœ‹æ…¢æŸ¥è¯¢è®¾ç½®
GET /my_index/_settings?include_defaults=true&filter_path=*.settings.index.*slowlog*

# é›†ç¾¤çº§æ…¢æŸ¥è¯¢è®¾ç½®
PUT /_cluster/settings
{
  "transient": {
    "logger.org.elasticsearch.index.search.slowlog": "DEBUG",
    "logger.org.elasticsearch.index.indexing.slowlog": "DEBUG"
  }
}
```

**ğŸ“ æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹æ…¢æŸ¥è¯¢ç»Ÿè®¡
GET /_nodes/stats/indices/search?filter_path=nodes.*.indices.search

# å¸¸è§æ…¢æŸ¥è¯¢ä¼˜åŒ–å»ºè®®ï¼š
æ·±åº¦åˆ†é¡µ â†’ ä½¿ç”¨scrollæˆ–search_after
å¤§èŒƒå›´èšåˆ â†’ å¢åŠ ç¼“å­˜ï¼Œå‡å°‘èšåˆèŒƒå›´
é€šé…ç¬¦æŸ¥è¯¢ â†’ æ”¹ç”¨prefixæˆ–matchæŸ¥è¯¢
æ’åºå¤§ç»“æœé›† â†’ ä½¿ç”¨doc_valuesï¼Œå¢åŠ å†…å­˜
```

### 9.3 ä»»åŠ¡ç®¡ç†


**ğŸ“‹ ä»»åŠ¡ç›‘æ§**
```bash
# æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
GET /_tasks?detailed=true&human

# æŸ¥çœ‹ç‰¹å®šç±»å‹ä»»åŠ¡
GET /_tasks?actions=*reindex*&detailed

# æŸ¥çœ‹é•¿æ—¶é—´è¿è¡Œä»»åŠ¡
GET /_tasks?timeout=30s

# å–æ¶ˆç‰¹å®šä»»åŠ¡
POST /_tasks/{task_id}/_cancel

# æŸ¥çœ‹ä»»åŠ¡ç»Ÿè®¡
GET /_cat/tasks?v&h=action,type,start_time,timestamp,running_time
```

**ğŸ”„ é•¿æ—¶é—´ä»»åŠ¡ç›‘æ§**
```bash
# ç›‘æ§reindexè¿›åº¦
GET /_tasks?actions=*reindex&detailed=true&wait_for_completion=false

# å“åº”ç¤ºä¾‹è§£è¯»ï¼š
{
  "nodes": {
    "node1": {
      "tasks": {
        "task123": {
          "action": "indices:data/write/reindex",
          "status": {
            "total": 10000,           # æ€»æ–‡æ¡£æ•°
            "updated": 5000,          # å·²å¤„ç†æ•°
            "created": 5000,          # å·²åˆ›å»ºæ•°
            "batches": 50,            # æ‰¹æ¬¡æ•°
            "version_conflicts": 0,   # ç‰ˆæœ¬å†²çªæ•°
            "noops": 0,              # æ— æ“ä½œæ•°
            "retries": 0,            # é‡è¯•æ¬¡æ•°
            "throttled_millis": 0,   # é™æµæ—¶é—´
            "requests_per_second": 100, # å¤„ç†é€Ÿç‡
            "throttled_until_millis": 0
          }
        }
      }
    }
  }
}
```

### 9.4 ç¼“å­˜ç®¡ç†


**ğŸ—„ï¸ ç¼“å­˜çŠ¶æ€æŸ¥çœ‹**
```bash
# æŸ¥çœ‹èŠ‚ç‚¹ç¼“å­˜ä½¿ç”¨æƒ…å†µ
GET /_cat/nodes?h=name,query_cache.memory_size,fielddata.memory_size,request_cache.memory_size&v

# æŸ¥çœ‹ç´¢å¼•ç¼“å­˜ç»Ÿè®¡
GET /_stats/query_cache,fielddata,request_cache?human

# æŸ¥çœ‹ç‰¹å®šç´¢å¼•ç¼“å­˜
GET /my_index/_stats/query_cache,fielddata?human
```

**ğŸ§¹ ç¼“å­˜æ¸…ç†æ“ä½œ**
```bash
# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
POST /_cache/clear

# æ¸…é™¤æŸ¥è¯¢ç¼“å­˜
POST /_cache/clear?query=true

# æ¸…é™¤å­—æ®µæ•°æ®ç¼“å­˜
POST /_cache/clear?fielddata=true

# æ¸…é™¤è¯·æ±‚ç¼“å­˜
POST /_cache/clear?request=true

# æ¸…é™¤ç‰¹å®šç´¢å¼•ç¼“å­˜
POST /my_index/_cache/clear?query=true,fielddata=true
```

**âš™ï¸ ç¼“å­˜è®¾ç½®ä¼˜åŒ–**
```bash
# è®¾ç½®æŸ¥è¯¢ç¼“å­˜å¤§å°
PUT /_cluster/settings
{
  "persistent": {
    "indices.queries.cache.size": "20%"
  }
}

# è®¾ç½®å­—æ®µæ•°æ®ç¼“å­˜å¤§å°
PUT /_cluster/settings
{
  "persistent": {
    "indices.fielddata.cache.size": "30%"
  }
}

# ç´¢å¼•çº§ç¼“å­˜è®¾ç½®
PUT /my_index/_settings
{
  "index.queries.cache.enabled": true,
  "index.requests.cache.enable": true
}
```

### 9.5 å¥åº·è¯Šæ–­


**ğŸ”§ é›†ç¾¤è¯Šæ–­å·¥å…·**
```bash
# é›†ç¾¤åˆ†é…è¯Šæ–­
GET /_cluster/allocation/explain?pretty

# åˆ†ç‰‡åˆ†é…è§£é‡Š(ç‰¹å®šåˆ†ç‰‡)
GET /_cluster/allocation/explain
{
  "index": "my_index",
  "shard": 0,
  "primary": true
}

# æ£€æŸ¥é›†ç¾¤ç“¶é¢ˆ
GET /_cluster/pending_tasks

# æŸ¥çœ‹çƒ­çº¿ç¨‹(æ€§èƒ½é—®é¢˜è¯Šæ–­)
GET /_nodes/hot_threads?threads=10&interval=500ms

# æŸ¥çœ‹JVMä¿¡æ¯
GET /_nodes/stats/jvm?human
```

**ğŸ“Š å­˜å‚¨å’Œåˆ†ç‰‡è¯Šæ–­**
```bash
# æŸ¥çœ‹ç£ç›˜åˆ†é…æƒ…å†µ
GET /_cat/allocation?v&h=shards,disk.indices,disk.used,disk.avail,disk.total,disk.percent,host,node

# æŸ¥çœ‹å¤§åˆ†ç‰‡(å¯èƒ½éœ€è¦ä¼˜åŒ–)
GET /_cat/shards?v&s=store.size:desc&h=index,shard,prirep,store.size,node

# æŸ¥çœ‹æœªåˆ†é…åˆ†ç‰‡åŸå› 
GET /_cat/shards?v&h=index,shard,prirep,state,unassigned.reason | grep UNASSIGNED
```

---

## 10. ğŸš€ é«˜çº§ç‰¹æ€§æ“ä½œ


### 10.1 æ»šåŠ¨æœç´¢(Scroll)


**ğŸ”„ æ»šåŠ¨æœç´¢åŸç†å’Œä½¿ç”¨**
```
æ»šåŠ¨æœç´¢é€‚ç”¨åœºæ™¯ï¼š
âœ“ å¯¼å‡ºå¤§é‡æ•°æ®(å‡ ä¸‡åˆ°å‡ ç™¾ä¸‡æ–‡æ¡£)
âœ“ æ•°æ®æ‰¹é‡å¤„ç†å’Œè¿ç§»
âœ“ æ·±åº¦åˆ†é¡µ(è¶…è¿‡10000æ¡)
âœ“ éå†å…¨éƒ¨æ•°æ®

ä¸æ™®é€šåˆ†é¡µå¯¹æ¯”ï¼š
æ™®é€šåˆ†é¡µï¼šfrom + sizeï¼Œé€‚åˆæµ…å±‚åˆ†é¡µ
æ»šåŠ¨æœç´¢ï¼šç»´æŠ¤æœç´¢ä¸Šä¸‹æ–‡ï¼Œé€‚åˆå¤§æ•°æ®é‡éå†
```

```bash
# å¼€å§‹æ»šåŠ¨æœç´¢
GET /users/_search?scroll=1m
{
  "size": 1000,
  "sort": ["_doc"],                    # æŒ‰æ–‡æ¡£é¡ºåºæ’åº(æœ€å¿«)
  "query": {"match_all": {}}
}

# ç»§ç»­æ»šåŠ¨(ä½¿ç”¨è¿”å›çš„scroll_id)
GET /_search/scroll
{
  "scroll": "1m",
  "scroll_id": "DXF1ZXJ5QW5kRmV0Y2gxTERSSE5sbjU2..."
}

# æ¸…é™¤æ»šåŠ¨ä¸Šä¸‹æ–‡(é‡Šæ”¾èµ„æº)
DELETE /_search/scroll
{
  "scroll_id": "DXF1ZXJ5QW5kRmV0Y2gxTERSSE5sbjU2..."
}

# æ¸…é™¤æ‰€æœ‰æ»šåŠ¨ä¸Šä¸‹æ–‡
DELETE /_search/scroll/_all
```

**âš¡ æ»šåŠ¨æœç´¢æœ€ä½³å®è·µ**
```bash
# æ€§èƒ½ä¼˜åŒ–çš„æ»šåŠ¨æœç´¢
GET /users/_search?scroll=5m
{
  "size": 5000,                       # è¾ƒå¤§æ‰¹æ¬¡æé«˜æ•ˆç‡
  "sort": ["_doc"],                   # æœ€å¿«çš„æ’åºæ–¹å¼
  "_source": ["id", "name", "email"], # åªè¿”å›éœ€è¦çš„å­—æ®µ
  "query": {
    "bool": {
      "filter": [                     # ä½¿ç”¨filterè€Œéquery
        {"range": {"created_at": {"gte": "2024-01-01"}}}
      ]
    }
  }
}
```

### 10.2 Search Afteræ·±åº¦åˆ†é¡µ


**ğŸ“„ Search Afterä½¿ç”¨æ–¹æ³•**
```bash
# ç¬¬ä¸€æ¬¡æŸ¥è¯¢
GET /users/_search
{
  "size": 10,
  "sort": [
    {"created_at": {"order": "desc"}},
    {"_id": {"order": "asc"}}          # å¿…é¡»åŒ…å«å”¯ä¸€å­—æ®µ
  ],
  "query": {"match_all": {}}
}

# åç»­æŸ¥è¯¢(ä½¿ç”¨ä¸Šæ¬¡æœ€åä¸€æ¡è®°å½•çš„sortå€¼)
GET /users/_search
{
  "size": 10,
  "sort": [
    {"created_at": {"order": "desc"}},
    {"_id": {"order": "asc"}}
  ],
  "search_after": ["2024-09-20T10:30:00", "user_12345"],
  "query": {"match_all": {}}
}
```

**ğŸ’¡ Search After vs Scrollé€‰æ‹©**
```
Search Afteré€‚ç”¨ï¼š
âœ“ å®æ—¶æ€§è¦æ±‚é«˜(å¯ä»¥çœ‹åˆ°æ–°æ•°æ®)
âœ“ ç”¨æˆ·äº¤äº’å¼åˆ†é¡µ
âœ“ æ— çŠ¶æ€åº”ç”¨(RESTful)
âœ“ åˆ†é¡µæ·±åº¦é€‚ä¸­

Scrollé€‚ç”¨ï¼š
âœ“ æ•°æ®å¯¼å‡ºå’Œæ‰¹å¤„ç†
âœ“ ä¸€è‡´æ€§å¿«ç…§(å›ºå®šæ•°æ®é›†)
âœ“ æ·±åº¦éå†å¤§æ•°æ®é›†
âœ“ åå°ä»»åŠ¡å¤„ç†
```

### 10.3 å¤šé‡æœç´¢(Multi-Search)


**ğŸ” æ‰¹é‡æœç´¢æ“ä½œ**
```bash
# ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªæœç´¢è¯·æ±‚
GET /_msearch
{"index": "users"}
{"query": {"match": {"name": "å¼ ä¸‰"}}, "size": 5}
{"index": "products"}
{"query": {"range": {"price": {"gte": 100}}}, "size": 10}
{"index": "orders"}
{"query": {"match_all": {}}, "from": 0, "size": 20}

# ä½¿ç”¨é»˜è®¤ç´¢å¼•
GET /users/_msearch
{}
{"query": {"match": {"city": "åŒ—äº¬"}}}
{}
{"query": {"range": {"age": {"gte": 25}}}}
```

**âš¡ Multi-Searchæ€§èƒ½ä¼˜åŠ¿**
```
æ€§èƒ½æå‡åŸç†ï¼š
â€¢ å‡å°‘HTTPè¯·æ±‚å¼€é”€
â€¢ æ‰¹é‡å¤„ç†å‡å°‘ç½‘ç»œå»¶è¿Ÿ
â€¢ å¹¶è¡Œæ‰§è¡Œå¤šä¸ªæŸ¥è¯¢
â€¢ å…±äº«è¿æ¥å’Œèµ„æº

é€‚ç”¨åœºæ™¯ï¼š
â€¢ ä»ªè¡¨æ¿å¤šå›¾è¡¨æ•°æ®
â€¢ æœç´¢ç»“æœé¡µå¤šä¸ªåŒºå—
â€¢ æ‰¹é‡æ•°æ®éªŒè¯
â€¢ APIèšåˆæŸ¥è¯¢
```

### 10.4 Ingest Pipelineæ•°æ®å¤„ç†


**ğŸ”§ åˆ›å»ºå¤„ç†ç®¡é“**
```bash
# åˆ›å»ºæ•°æ®é¢„å¤„ç†ç®¡é“
PUT /_ingest/pipeline/user_pipeline
{
  "description": "å¤„ç†ç”¨æˆ·æ•°æ®çš„ç®¡é“",
  "processors": [
    {
      "set": {                         # è®¾ç½®å­—æ®µ
        "field": "processed_time",
        "value": "{{_ingest.timestamp}}"
      }
    },
    {
      "uppercase": {                   # è½¬å¤§å†™
        "field": "name"
      }
    },
    {
      "script": {                      # è„šæœ¬å¤„ç†
        "source": "ctx.age_group = ctx.age < 30 ? 'young' : 'old'"
      }
    },
    {
      "remove": {                      # åˆ é™¤å­—æ®µ
        "field": "temp_field"
      }
    }
  ],
  "on_failure": [                      # å¤±è´¥å¤„ç†
    {
      "set": {
        "field": "error",
        "value": "pipeline processing failed"
      }
    }
  ]
}

# æµ‹è¯•ç®¡é“
POST /_ingest/pipeline/user_pipeline/_simulate
{
  "docs": [
    {
      "_source": {
        "name": "zhang san",
        "age": 25,
        "temp_field": "should be removed"
      }
    }
  ]
}

# ä½¿ç”¨ç®¡é“æ’å…¥æ•°æ®
PUT /users/_doc/1?pipeline=user_pipeline
{
  "name": "li si",
  "age": 35
}
```

**ğŸ“Š å¸¸ç”¨å¤„ç†å™¨**
```bash
# æ—¥æœŸå¤„ç†ç®¡é“
PUT /_ingest/pipeline/log_pipeline
{
  "processors": [
    {
      "date": {                        # æ—¥æœŸè§£æ
        "field": "timestamp",
        "formats": ["yyyy-MM-dd HH:mm:ss", "ISO8601"]
      }
    },
    {
      "grok": {                        # æ—¥å¿—è§£æ
        "field": "message",
        "patterns": ["%{COMBINEDAPACHELOG}"]
      }
    },
    {
      "convert": {                     # ç±»å‹è½¬æ¢
        "field": "response_code",
        "type": "integer"
      }
    }
  ]
}
```

### 10.5 è‡ªå®šä¹‰è¯„åˆ†


**ğŸ¯ Function ScoreæŸ¥è¯¢**
```bash
# ä½¿ç”¨å‡½æ•°è¯„åˆ†è‡ªå®šä¹‰æ’åº
GET /products/_search
{
  "query": {
    "function_score": {
      "query": {                       # åŸºç¡€æŸ¥è¯¢
        "match": {"title": "æ‰‹æœº"}
      },
      "functions": [
        {
          "filter": {                  # æ¡ä»¶è¿‡æ»¤
            "term": {"category": "ç”µå­äº§å“"}
          },
          "weight": 2.0                # æƒé‡åŠ æˆ
        },
        {
          "field_value_factor": {      # å­—æ®µå€¼å½±å“åˆ†æ•°
            "field": "sales_count",
            "factor": 0.1,
            "modifier": "log1p"        # å¯¹æ•°å¤„ç†
          }
        },
        {
          "gauss": {                   # é«˜æ–¯è¡°å‡
            "created_at": {
              "origin": "now",
              "scale": "30d",
              "decay": 0.5
            }
          }
        }
      ],
      "boost_mode": "multiply",        # åˆ†æ•°ç»„åˆæ–¹å¼
      "score_mode": "sum"              # å‡½æ•°åˆ†æ•°ç»„åˆæ–¹å¼
    }
  }
}
```

**ğŸ“ˆ è¯„åˆ†å½±å“å› å­**
```
å¸¸ç”¨è¯„åˆ†å‡½æ•°ï¼š
weight:           å›ºå®šæƒé‡åŠ æˆ
field_value_factor: å­—æ®µå€¼å½±å“è¯„åˆ†
random_score:     éšæœºè¯„åˆ†
script_score:     è„šæœ¬è‡ªå®šä¹‰è¯„åˆ†
gauss/linear/exp: è·ç¦»è¡°å‡å‡½æ•°

ç»„åˆæ¨¡å¼ï¼š
boost_mode:
- multiply: query_score * function_score
- sum:      query_score + function_score  
- replace:  function_scoreæ›¿ä»£query_score

score_mode(å¤šä¸ªå‡½æ•°æ—¶):
- sum:      å‡½æ•°åˆ†æ•°ç›¸åŠ 
- multiply: å‡½æ•°åˆ†æ•°ç›¸ä¹˜
- max/min:  å–æœ€å¤§/æœ€å°å‡½æ•°åˆ†æ•°
```

---

## 11. ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜


### 11.1 ä¸»è¦ç‰ˆæœ¬å·®å¼‚


**ğŸ“Š Elasticsearchç‰ˆæœ¬æ¼”è¿›**
```
ç‰ˆæœ¬å‘å±•å†ç¨‹ï¼š
ES 5.x â”€â”€â†’ ES 6.x â”€â”€â†’ ES 7.x â”€â”€â†’ ES 8.x
  â”‚         â”‚         â”‚         â”‚
å†å²ç‰ˆæœ¬   è¿‡æ¸¡ç‰ˆæœ¬   å½“å‰ä¸»æµ   æœ€æ–°ç‰ˆæœ¬

ä½¿ç”¨å»ºè®®ï¼š
â€¢ æ–°é¡¹ç›®ï¼šæ¨èES 7.xæˆ–8.x
â€¢ ç°æœ‰é¡¹ç›®ï¼š7.xæœ€ç¨³å®šï¼Œèµ„æ–™æœ€å…¨
â€¢ å­¦ä¹ é˜¶æ®µï¼šä½¿ç”¨7.xï¼Œå…¼å®¹æ€§æœ€å¥½
```

**ğŸ”¸ ES 7.x vs 6.xçš„ä¸»è¦å˜åŒ–**

| å˜æ›´å†…å®¹ | **ES 6.x** | **ES 7.x** | **å½±å“è¯´æ˜** |
|---------|-----------|-----------|-------------|
| **æ–‡æ¡£ç±»å‹** | `æ”¯æŒå¤šç±»å‹` | `åªæ”¯æŒ_docç±»å‹` | `ç®€åŒ–æ•°æ®æ¨¡å‹ï¼Œæé«˜æ€§èƒ½` |
| **APIè·¯å¾„** | `/{index}/{type}/{id}` | `/{index}/_doc/{id}` | `URLæ ¼å¼å˜åŒ–ï¼Œéœ€è¦é€‚é…` |
| **æ˜ å°„ç±»å‹** | `å¯ä»¥è‡ªå®šä¹‰type` | `å›ºå®šä½¿ç”¨_doc` | `å‡å°‘å¤æ‚æ€§ï¼Œç»Ÿä¸€æ ‡å‡†` |
| **é»˜è®¤åˆ†ç‰‡** | `5ä¸ªä¸»åˆ†ç‰‡` | `1ä¸ªä¸»åˆ†ç‰‡` | `å°ç´¢å¼•æ€§èƒ½æ›´å¥½` |

```bash
# ES 6.x é£æ ¼
PUT /users/user/1          # æœ‰type
GET /users/user/_search    # éœ€è¦æŒ‡å®štype

# ES 7.x é£æ ¼  
PUT /users/_doc/1          # ç»Ÿä¸€ä½¿ç”¨_doc
GET /users/_search         # ç›´æ¥æœç´¢ç´¢å¼•
```

**ğŸ”¸ ES 8.xçš„æ–°ç‰¹æ€§å’Œå˜åŒ–**

```
å®‰å…¨æ€§å¢å¼ºï¼š
â€¢ é»˜è®¤å¯ç”¨å®‰å…¨åŠŸèƒ½(éœ€è¦é…ç½®ç”¨æˆ·åå¯†ç )
â€¢ é»˜è®¤å¯ç”¨HTTPS
â€¢ æ›´ä¸¥æ ¼çš„æƒé™æ§åˆ¶

APIå˜åŒ–ï¼š
â€¢ ç§»é™¤äº†ä¸€äº›åºŸå¼ƒçš„API
â€¢ ä¼˜åŒ–äº†èšåˆæ€§èƒ½
â€¢ æ”¹è¿›äº†æœç´¢é€Ÿåº¦

é…ç½®å˜åŒ–ï¼š
â€¢ æŸäº›é…ç½®å‚æ•°åç§°å˜æ›´
â€¢ é»˜è®¤é…ç½®æ›´å®‰å…¨
â€¢ å†…å­˜ä½¿ç”¨ä¼˜åŒ–
```

### 11.2 å‘½ä»¤å…¼å®¹æ€§å¯¹ç…§


**ğŸ”„ ç‰ˆæœ¬è¿ç§»å‘½ä»¤å¯¹ç…§**

| æ“ä½œç±»å‹ | **ES 6.xå‘½ä»¤** | **ES 7.x/8.xå‘½ä»¤** | **è¯´æ˜** |
|---------|---------------|------------------|---------|
| **åˆ›å»ºæ–‡æ¡£** | `PUT /index/type/id` | `PUT /index/_doc/id` | `typeå›ºå®šä¸º_doc` |
| **æŸ¥è¯¢æ–‡æ¡£** | `GET /index/type/id` | `GET /index/_doc/id` | `ç§»é™¤typeå‚æ•°` |
| **æœç´¢** | `GET /index/type/_search` | `GET /index/_search` | `ç®€åŒ–è·¯å¾„` |
| **æ˜ å°„** | `PUT /index/_mapping/type` | `PUT /index/_mapping` | `ä¸éœ€è¦æŒ‡å®štype` |

```bash
# 6.xåˆ°7.xè¿ç§»ç¤ºä¾‹
# æ—§ç‰ˆæœ¬(6.x)
PUT /users/user/1
{
  "name": "å¼ ä¸‰"
}

# æ–°ç‰ˆæœ¬(7.x+)
PUT /users/_doc/1
{
  "name": "å¼ ä¸‰"
}
```

### 11.3 é…ç½®å…¼å®¹æ€§


**âš™ï¸ é…ç½®æ–‡ä»¶å˜åŒ–**
```yaml
# ES 6.x elasticsearch.yml
cluster.name: my-cluster
node.name: node-1
path.data: /path/to/data
path.logs: /path/to/logs
network.host: 0.0.0.0
http.port: 9200

# ES 8.x elasticsearch.yml (é¢å¤–å®‰å…¨é…ç½®)
cluster.name: my-cluster
node.name: node-1
path.data: /path/to/data
path.logs: /path/to/logs
network.host: 0.0.0.0
http.port: 9200

# å®‰å…¨é…ç½®(8.xæ–°å¢)
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.http.ssl.enabled: true
```

### 11.4 å‡çº§å»ºè®®


**ğŸ“‹ ç‰ˆæœ¬é€‰æ‹©æŒ‡å¯¼**

| ç‰ˆæœ¬èŒƒå›´ | **æ¨èç¨‹åº¦** | **é€‚ç”¨åœºæ™¯** | **æ³¨æ„äº‹é¡¹** |
|---------|------------|-------------|-------------|
| **ES 6.x** | `ä¸æ¨è` | `è€é¡¹ç›®ç»´æŠ¤` | `é€æ­¥å‡çº§åˆ°7.x` |
| **ES 7.x** | `å¼ºçƒˆæ¨è` | `ç”Ÿäº§ç¯å¢ƒé¦–é€‰` | `èµ„æ–™ä¸°å¯Œï¼Œç¨³å®šå¯é ` |
| **ES 8.x** | `è°¨æ…ä½¿ç”¨` | `æ–°é¡¹ç›®ï¼Œå®‰å…¨è¦æ±‚é«˜` | `é…ç½®å¤æ‚ï¼Œéœ€è¦ç»éªŒ` |

**ğŸ”„ å‡çº§ç­–ç•¥**
```
å¹³æ»‘å‡çº§è·¯å¾„ï¼š
6.x â†’ 7.17 â†’ 8.x (æ¨è)
6.x â†’ 7.x (æœ€å¸¸è§)

å‡çº§å‰å‡†å¤‡ï¼š
1. å¤‡ä»½æ‰€æœ‰æ•°æ®
2. æµ‹è¯•æŸ¥è¯¢å…¼å®¹æ€§
3. æ£€æŸ¥æ’ä»¶å…¼å®¹æ€§
4. å‡†å¤‡å›æ»šæ–¹æ¡ˆ

å‡çº§åéªŒè¯ï¼š
1. é›†ç¾¤å¥åº·çŠ¶æ€
2. ç´¢å¼•æ•°æ®å®Œæ•´æ€§
3. æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
4. æ€§èƒ½å¯¹æ¯”æµ‹è¯•
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


```
ğŸ”¸ ESæœ¬è´¨ï¼šåˆ†å¸ƒå¼å®æ—¶æœç´¢å¼•æ“ï¼ŒåŸºäºLuceneï¼ŒRESTful API
ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µï¼šCluster(é›†ç¾¤) â†’ Node(èŠ‚ç‚¹) â†’ Index(ç´¢å¼•) â†’ Document(æ–‡æ¡£) â†’ Field(å­—æ®µ)
ğŸ”¸ æ¶æ„ç‰¹ç‚¹ï¼šä¸»åˆ†ç‰‡+å‰¯æœ¬åˆ†ç‰‡ï¼Œæ°´å¹³æ‰©å±•ï¼Œè¿‘å®æ—¶æœç´¢
ğŸ”¸ æ•°æ®ç±»å‹ï¼štext(å…¨æ–‡æœç´¢) vs keyword(ç²¾ç¡®åŒ¹é…)ï¼Œæ•°å€¼å‹ã€æ—¥æœŸå‹ã€å¸ƒå°”å‹
ğŸ”¸ æ“ä½œæ¨¡å¼ï¼šCRUDæ“ä½œï¼Œæ‰¹é‡æ“ä½œï¼Œå¤åˆæŸ¥è¯¢ï¼Œèšåˆåˆ†æ
ğŸ”¸ å‘½ä»¤æ ¼å¼ï¼šHTTPæ–¹æ³• + APIè·¯å¾„ + å‚æ•°ï¼Œå ä½ç¬¦æ›¿æ¢
```

### 12.2 å…³é”®æŠ€æœ¯ç†è§£


**ğŸ”¹ æœç´¢vsæ•°æ®åº“æ€ç»´**
```
æ•°æ®åº“æ€ç»´ï¼šå…ˆå»ºè¡¨â†’æ’æ•°æ®â†’å†™SQLæŸ¥è¯¢
ESæ€ç»´ï¼š    å®šä¹‰æ˜ å°„â†’ç´¢å¼•æ–‡æ¡£â†’JSONæŸ¥è¯¢

æ ¸å¿ƒå·®å¼‚ï¼š
â€¢ ESæ“…é•¿ï¼šå…¨æ–‡æœç´¢ã€å®æ—¶åˆ†æã€æ¨¡ç³ŠåŒ¹é…ã€ç›¸å…³æ€§æ’åº
â€¢ æ•°æ®åº“æ“…é•¿ï¼šäº‹åŠ¡å¤„ç†ã€å¤æ‚å…³è”ã€å¼ºä¸€è‡´æ€§ã€ç²¾ç¡®è®¡ç®—

é€‰æ‹©åŸåˆ™ï¼š
æœç´¢åœºæ™¯é€‰ESï¼Œäº‹åŠ¡åœºæ™¯é€‰æ•°æ®åº“ï¼Œæ··åˆåœºæ™¯å¯ä»¥ç»„åˆä½¿ç”¨
```

**ğŸ”¹ åˆ†ç‰‡ä¸å‰¯æœ¬ç­–ç•¥**
```
åˆ†ç‰‡è®¾è®¡åŸåˆ™ï¼š
â€¢ ä¸»åˆ†ç‰‡æ•°ï¼šæ ¹æ®æ•°æ®é‡ç¡®å®šï¼Œä¸€èˆ¬3-5ä¸ª
â€¢ å‰¯æœ¬æ•°ï¼šæ ¹æ®æŸ¥è¯¢å‹åŠ›å’Œå¯ç”¨æ€§è¦æ±‚
â€¢ å•åˆ†ç‰‡å¤§å°ï¼šå»ºè®®ä¸è¶…è¿‡50GB

å®é™…é…ç½®ï¼š
å°ç´¢å¼•(<1GB)ï¼š   1ä¸»åˆ†ç‰‡ï¼Œ1å‰¯æœ¬
ä¸­ç­‰ç´¢å¼•(1-50GB)ï¼š3ä¸»åˆ†ç‰‡ï¼Œ1å‰¯æœ¬  
å¤§ç´¢å¼•(>50GB)ï¼š  5ä¸»åˆ†ç‰‡ï¼Œ1-2å‰¯æœ¬
```

**ğŸ”¹ æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–**
```
æŸ¥è¯¢ä¼˜åŒ–åŸåˆ™ï¼š
â€¢ ä½¿ç”¨filterä»£æ›¿query(ä¸éœ€è¦è¯„åˆ†æ—¶)
â€¢ boolæŸ¥è¯¢ä¸­filteræ€§èƒ½ä¼˜äºmust
â€¢ é¿å…æ·±åº¦åˆ†é¡µï¼Œä½¿ç”¨scrollæˆ–search_after
â€¢ åˆç†ä½¿ç”¨èšåˆï¼Œé¿å…å¤§èŒƒå›´èšåˆ

ç´¢å¼•ä¼˜åŒ–åŸåˆ™ï¼š
â€¢ åˆç†è®¾ç½®refresh_interval
â€¢ æ‰¹é‡æ“ä½œä½¿ç”¨bulk API
â€¢ å†·çƒ­æ•°æ®åˆ†ç¦»
â€¢ å®šæœŸå¼ºåˆ¶åˆå¹¶æ®µ
```

### 12.3 å®ç”¨å‘½ä»¤é€ŸæŸ¥


**ğŸ“‹ æ—¥å¸¸è¿ç»´å‘½ä»¤æ¸…å•**
```bash
# é›†ç¾¤å¥åº·ç›‘æ§
GET /_cluster/health?v
GET /_cat/nodes?v
GET /_cat/indices?v&s=store.size:desc

# ç´¢å¼•ç®¡ç†
PUT /ç´¢å¼•å                    # åˆ›å»ºç´¢å¼•
GET /ç´¢å¼•å/_mapping           # æŸ¥çœ‹æ˜ å°„
PUT /ç´¢å¼•å/_settings          # ä¿®æ”¹è®¾ç½®
DELETE /ç´¢å¼•å                 # åˆ é™¤ç´¢å¼•

# æ–‡æ¡£æ“ä½œ
PUT /ç´¢å¼•/_doc/ID              # åˆ›å»º/æ›´æ–°æ–‡æ¡£
GET /ç´¢å¼•/_doc/ID              # æŸ¥è¯¢æ–‡æ¡£
POST /ç´¢å¼•/_update/ID          # éƒ¨åˆ†æ›´æ–°
DELETE /ç´¢å¼•/_doc/ID           # åˆ é™¤æ–‡æ¡£

# æœç´¢æŸ¥è¯¢
GET /ç´¢å¼•/_search              # åŸºç¡€æœç´¢
POST /ç´¢å¼•/_search             # å¤æ‚æœç´¢
GET /_search                   # å…¨å±€æœç´¢

# æ‰¹é‡æ“ä½œ
POST /_bulk                    # æ‰¹é‡å¢åˆ æ”¹
GET /_mget                     # æ‰¹é‡æŸ¥è¯¢

# æ€§èƒ½ç›‘æ§
GET /_nodes/stats              # èŠ‚ç‚¹ç»Ÿè®¡
GET /_tasks                    # ä»»åŠ¡ç›‘æ§
POST /_cache/clear             # æ¸…é™¤ç¼“å­˜
```

### 12.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ”§ å¸¸è§é—®é¢˜è¯Šæ–­æ€è·¯**

```
é›†ç¾¤REDçŠ¶æ€ï¼š
1. æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ï¼šGET /_cat/nodes?v
2. æŸ¥çœ‹åˆ†ç‰‡åˆ†é…ï¼šGET /_cat/shards?v
3. æŸ¥çœ‹åˆ†é…åŸå› ï¼šGET /_cluster/allocation/explain
4. æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼šGET /_cat/allocation?v

æœç´¢ç¼“æ…¢ï¼š
1. æ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—
2. åˆ†ææŸ¥è¯¢è¯­å¥å¤æ‚åº¦
3. æ£€æŸ¥ç´¢å¼•æ˜ å°„è®¾è®¡
4. ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶å’Œè¿‡æ»¤å™¨

ç´¢å¼•å†™å…¥æ…¢ï¼š
1. æ£€æŸ¥refresh_intervalè®¾ç½®
2. è€ƒè™‘æ‰¹é‡å†™å…¥
3. æ£€æŸ¥åˆ†ç‰‡æ•°é‡è®¾ç½®
4. ç›‘æ§ç£ç›˜IOå’Œå†…å­˜

å†…å­˜ä½¿ç”¨é«˜ï¼š
1. æ£€æŸ¥field dataç¼“å­˜
2. æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜ä½¿ç”¨
3. æ£€æŸ¥èšåˆæŸ¥è¯¢
4. è€ƒè™‘å¢åŠ èŠ‚ç‚¹æˆ–ä¼˜åŒ–æŸ¥è¯¢
```

### 12.5 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**

```
é›†ç¾¤è®¾è®¡ï¼š
â€¢ è‡³å°‘3ä¸ªèŠ‚ç‚¹(é¿å…è„‘è£‚)
â€¢ ä¸»èŠ‚ç‚¹ä¸æ•°æ®èŠ‚ç‚¹åˆ†ç¦»
â€¢ åˆç†è§„åˆ’åˆ†ç‰‡å’Œå‰¯æœ¬
â€¢ å®šæœŸç›‘æ§é›†ç¾¤å¥åº·çŠ¶æ€

ç´¢å¼•è®¾è®¡ï¼š
â€¢ æ ¹æ®æŸ¥è¯¢æ¨¡å¼è®¾è®¡æ˜ å°„
â€¢ textç”¨äºæœç´¢ï¼Œkeywordç”¨äºèšåˆ
â€¢ è®¾ç½®åˆç†çš„refresh_interval
â€¢ é¿å…å­—æ®µè†¨èƒ€(field explosion)

æŸ¥è¯¢ä¼˜åŒ–ï¼š
â€¢ ä¼˜å…ˆä½¿ç”¨filteræŸ¥è¯¢
â€¢ é¿å…æ·±åº¦åˆ†é¡µ
â€¢ åˆç†ä½¿ç”¨ç¼“å­˜
â€¢ ç›‘æ§æ…¢æŸ¥è¯¢å¹¶ä¼˜åŒ–

è¿ç»´ç®¡ç†ï¼š
â€¢ å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
â€¢ ç›‘æ§é›†ç¾¤æ€§èƒ½æŒ‡æ ‡
â€¢ åˆ¶å®šå®¹é‡è§„åˆ’
â€¢ å»ºç«‹å‘Šè­¦æœºåˆ¶

å®‰å…¨è€ƒè™‘ï¼š
â€¢ å¯ç”¨èº«ä»½è®¤è¯
â€¢ é…ç½®ç½‘ç»œéš”ç¦»
â€¢ å®šæœŸæ›´æ–°ESç‰ˆæœ¬
â€¢ ç›‘æ§å¼‚å¸¸è®¿é—®
```

**ğŸ“ å­¦ä¹ è¿›é˜¶è·¯å¾„**

```
å…¥é—¨é˜¶æ®µ(1-2å‘¨)ï¼š
âœ“ ç†è§£ESåŸºæœ¬æ¦‚å¿µ
âœ“ æŒæ¡åŸºç¡€CRUDæ“ä½œ
âœ“ å­¦ä¼šç®€å•æœç´¢æŸ¥è¯¢
âœ“ äº†è§£é›†ç¾¤å¥åº·ç›‘æ§

è¿›é˜¶é˜¶æ®µ(1-2ä¸ªæœˆ)ï¼š
âœ“ æŒæ¡å¤æ‚æŸ¥è¯¢è¯­æ³•
âœ“ ç†è§£æ˜ å°„å’Œåˆ†æå™¨
âœ“ å­¦ä¼šæ€§èƒ½è°ƒä¼˜
âœ“ ç†Ÿæ‚‰è¿ç»´ç®¡ç†

é«˜çº§é˜¶æ®µ(3-6ä¸ªæœˆ)ï¼š
âœ“ æ·±å…¥ç†è§£åˆ†å¸ƒå¼åŸç†
âœ“ æŒæ¡æ’ä»¶å¼€å‘
âœ“ å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†
âœ“ ç–‘éš¾é—®é¢˜æ’æŸ¥

ä¸“å®¶é˜¶æ®µ(æŒç»­å­¦ä¹ )ï¼š
âœ“ æºç åˆ†æå’Œå®šåˆ¶
âœ“ æ¶æ„è®¾è®¡å’Œä¼˜åŒ–
âœ“ æŠ€æœ¯åˆ†äº«å’ŒåŸ¹è®­
âœ“ ç¤¾åŒºè´¡çŒ®
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ESæœç´¢å¼ºåˆå¿«ï¼Œåˆ†å¸ƒé›†ç¾¤å¥½æ‰©å±•
ç´¢å¼•æ–‡æ¡£å­—æ®µæ¸…ï¼Œæ˜ å°„ç±»å‹è¦åˆ†æ˜
RESTfulæ¥å£è°ƒç”¨ä¾¿ï¼ŒJSONæŸ¥è¯¢åŠŸèƒ½å…¨
boolæŸ¥è¯¢é€»è¾‘æ´»ï¼Œèšåˆç»Ÿè®¡æ•°æ®åŒ–
ç›‘æ§è¿ç»´ä¸å¯å°‘ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ç‹é“
ç‰ˆæœ¬å…¼å®¹è¦æ³¨æ„ï¼Œæœ€ä½³å®è·µè®°å¿ƒé‡Œ
```

### 12.6 å¸¸ç”¨èµ„æºå’Œå·¥å…·


**ğŸ“š å­¦ä¹ èµ„æº**
```
å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.elastic.co/guide/
ä¸­æ–‡ç¤¾åŒºï¼šhttps://elasticsearch.cn/
æ€§èƒ½è°ƒä¼˜ï¼šå®˜æ–¹æ€§èƒ½è°ƒä¼˜æŒ‡å—
æ’ä»¶ç”Ÿæ€ï¼šhttps://github.com/elastic

æ¨èå·¥å…·ï¼š
â€¢ Kibanaï¼šæ•°æ®å¯è§†åŒ–å’Œç®¡ç†ç•Œé¢
â€¢ Logstashï¼šæ•°æ®é‡‡é›†å’Œå¤„ç†
â€¢ Beatsï¼šè½»é‡çº§æ•°æ®é‡‡é›†å™¨
â€¢ Elasticsearch-headï¼šé›†ç¾¤ç®¡ç†æ’ä»¶
```

è¿™ä»½å®Œæ•´çš„ElasticsearchæŒ‡å—æ¶µç›–äº†ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§ç‰¹æ€§çš„æ‰€æœ‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œé€šè¿‡å¤§é‡å®ä¾‹å’Œè¯¦ç»†è§£é‡Šï¼Œå¸®åŠ©ä»æ–°æ‰‹åˆ°è¿›é˜¶ç”¨æˆ·å…¨é¢æŒæ¡ESçš„ä½¿ç”¨æ–¹æ³•ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å‚è€ƒç›¸åº”ç« èŠ‚å†…å®¹ï¼Œé€æ­¥æ·±å…¥å­¦ä¹ å’Œå®è·µã€‚