---
title: 34、开发工具命令
---
## 📚 目录


1. [开发调试命令概述](#1-开发调试命令概述)
2. [Cat命令系列详解](#2-Cat命令系列详解)
3. [脚本存储与执行](#3-脚本存储与执行)
4. [输出格式化控制](#4-输出格式化控制)
5. [调试技巧与最佳实践](#5-调试技巧与最佳实践)
6. [核心要点总结](#6-核心要点总结)

---

# 1. 🔧 开发调试命令概述



## 1.1 什么是开发调试命令



**简单理解**：开发调试命令就像是Elasticsearch给开发者准备的"瑞士军刀"，帮助我们查看系统状态、调试问题、格式化输出。

**为什么需要这些命令**：
- 📊 **快速诊断**：像医生的听诊器，快速了解ES集群"健康状况"
- 🔍 **问题排查**：当出现问题时，能够快速定位原因
- 📱 **开发便利**：让复杂的JSON数据变得易读易懂
- ⚡ **效率提升**：一条命令完成复杂的状态查看

## 1.2 命令分类总览



```
开发调试命令分类：
┌─────────────────────────────────────┐
│           开发调试命令               │
├─────────────────┬───────────────────┤
│   Cat命令系列   │   脚本管理命令     │
│  (查看状态信息) │ (存储执行脚本)     │
├─────────────────┼───────────────────┤
│   格式化命令    │   帮助调试命令     │
│  (美化输出)     │ (获取帮助信息)     │
└─────────────────┴───────────────────┘
```

**核心设计理念**：
- **人性化**：让机器语言变成人类可读的信息
- **高效性**：一条命令胜过复杂的查询操作
- **灵活性**：支持多种输出格式，满足不同需求

---

# 2. 📋 Cat命令系列详解



## 2.1 Cat命令是什么



**通俗解释**：Cat命令就像是ES的"体检报告生成器"，能够以简洁的表格形式显示集群的各种状态信息。

**为什么叫Cat**：
- 来源于Linux的`cat`命令（查看文件内容）
- 专门设计给**人类阅读**，而不是程序解析
- 输出简洁、直观，一目了然

## 2.2 获取命令帮助



### 🔸 基础帮助命令



```http
GET /_cat/{command}?help
```

**实际应用示例**：
```http
# 查看nodes命令的帮助信息

GET /_cat/nodes?help

# 查看indices命令的帮助信息  

GET /_cat/indices?help

# 查看health命令的帮助信息

GET /_cat/health?help
```

**帮助信息解读**：
```
输出示例：
epoch      | t,time               | seconds since 1970-01-01 00:00:00
timestamp  | ts,hms,hhmmss        | time in HH:MM:SS
cluster    | cl                   | cluster name
status     | st                   | health status

字段说明：
- 第一列：完整字段名
- 第二列：可用的缩写形式
- 第三列：字段含义描述
```

## 2.3 详细输出控制



### 🔸 详细模式（v参数）



```http
GET /_cat/{command}?v
```

**对比效果**：
```http
# 普通输出（无列标题）

GET /_cat/nodes
# 输出：192.168.1.100 15 95 0 0.45 0.34 0.12 mdi * node-1


# 详细输出（有列标题）

GET /_cat/nodes?v
# 输出：

# ip            heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name

# 192.168.1.100           15          95   0    0.45    0.34     0.12 mdi       *      node-1

```

**💡 记忆技巧**：`v`代表`verbose`（详细的），就像给表格加上了"标题行"。

## 2.4 输出格式控制



### 🔸 JSON格式输出



```http
GET /_cat/{command}?format=json
```

**使用场景对比**：

| 格式类型 | **适用场景** | **优势** | **示例** |
|---------|-------------|---------|----------|
| `默认格式` | `人工查看` | `简洁直观` | `快速检查集群状态` |
| `JSON格式` | `程序处理` | `结构化数据` | `脚本自动化监控` |
| `详细模式` | `学习调试` | `字段含义清晰` | `新手了解字段含义` |

**实际应用示例**：
```http
# 获取集群健康状态的JSON格式

GET /_cat/health?format=json

# 返回结果：

[
  {
    "epoch": "1632150000",
    "timestamp": "10:00:00",
    "cluster": "my-cluster",
    "status": "green",
    "node.total": "3",
    "node.data": "3"
  }
]
```

### 🔸 指定列输出



```http
GET /_cat/{command}?h={headers}
```

**实用技巧**：
```http
# 只显示节点名称和IP地址

GET /_cat/nodes?h=name,ip

# 只显示索引名称和状态

GET /_cat/indices?h=index,status

# 显示多个关键字段

GET /_cat/allocation?h=node,disk.indices,disk.used,disk.avail
```

**💡 记忆方法**：`h`代表`headers`（表头），就像在Excel中只显示需要的列。

## 2.5 排序输出



### 🔸 排序功能



```http
GET /_cat/{command}?s={sort_field}
```

**排序示例**：
```http
# 按磁盘使用量排序（升序）

GET /_cat/allocation?s=disk.used

# 按磁盘使用量排序（降序）

GET /_cat/allocation?s=disk.used:desc

# 按多个字段排序

GET /_cat/nodes?s=cpu:desc,load_1m:desc
```

**实际应用场景**：
```
问题场景：集群性能问题排查
解决方案：
1. 按CPU使用率排序找高负载节点
   GET /_cat/nodes?v&s=cpu:desc
   
2. 按磁盘使用量排序找存储瓶颈
   GET /_cat/allocation?v&s=disk.percent:desc
   
3. 按分片数量排序找热点索引
   GET /_cat/indices?v&s=pri:desc
```

---

# 3. 💾 脚本存储与执行



## 3.1 什么是脚本存储



**简单理解**：脚本存储就像是把常用的"代码片段"保存在ES中，需要时可以重复调用，避免每次都写复杂的脚本。

**实际用途**：
- 🔄 **复用性**：一次编写，多次使用
- 🛡️ **安全性**：预定义脚本，减少注入风险
- ⚡ **性能**：编译后缓存，执行速度更快
- 📝 **维护性**：集中管理，便于版本控制

## 3.2 存储脚本



### 🔸 基本存储语法



```http
POST /_scripts/{script_id}
{
  "script": {
    "lang": "painless",
    "source": "脚本内容"
  }
}
```

**实用示例**：
```http
# 存储一个计算价格折扣的脚本

POST /_scripts/calculate_discount
{
  "script": {
    "lang": "painless",
    "source": "params.price * params.discount_rate"
  }
}

# 存储一个字符串处理脚本

POST /_scripts/format_name
{
  "script": {
    "lang": "painless",
    "source": "params.firstName + ' ' + params.lastName"
  }
}
```

**💡 实用技巧**：
- **命名规范**：使用有意义的ID，如`calculate_discount`、`format_date`
- **参数化**：通过`params`传递变量，提高脚本复用性
- **测试先行**：在查询中测试脚本逻辑，确认无误后再存储

## 3.3 执行脚本



### 🔸 直接执行存储的脚本



```http
POST /_scripts/{script_id}/_execute
{
  "script": {
    "params": {
      "参数名": "参数值"
    }
  }
}
```

**执行示例**：
```http
# 执行折扣计算脚本

POST /_scripts/calculate_discount/_execute
{
  "script": {
    "params": {
      "price": 100,
      "discount_rate": 0.8
    }
  }
}

# 返回结果：80.0

```

## 3.4 脚本在查询中的应用



**在搜索中使用存储脚本**：
```http
# 使用脚本计算字段

GET /products/_search
{
  "script_fields": {
    "final_price": {
      "script": {
        "id": "calculate_discount",
        "params": {
          "price": 100,
          "discount_rate": 0.9
        }
      }
    }
  }
}
```

**应用场景总结**：

| 应用场景 | **脚本用途** | **优势** |
|---------|-------------|---------|
| `数据计算` | `价格计算、评分算法` | `逻辑复用` |
| `数据清洗` | `格式化、去重` | `统一处理` |
| `条件判断` | `复杂业务逻辑` | `灵活控制` |
| `聚合分析` | `自定义聚合指标` | `深度分析` |

---

# 4. 🎨 输出格式化控制



## 4.1 美化JSON输出



### 🔸 pretty参数



```http
GET /_mapping?pretty
```

**对比效果**：

**普通输出（难阅读）**：
```json
{"myindex":{"mappings":{"properties":{"title":{"type":"text"},"price":{"type":"float"}}}}}
```

**美化输出（易阅读）**：
```json
{
  "myindex": {
    "mappings": {
      "properties": {
        "title": {
          "type": "text"
        },
        "price": {
          "type": "float"
        }
      }
    }
  }
}
```

**💡 开发建议**：开发调试时总是加上`?pretty`参数，让JSON输出更加易读。

## 4.2 组合参数使用



### 🔸 多参数组合



```http
# 组合使用多个参数

GET /_cat/nodes?v&h=name,heap.percent,cpu&s=cpu:desc&format=json
```

**参数组合说明**：
```
参数解析：
- v: 显示列标题
- h=name,heap.percent,cpu: 只显示指定列
- s=cpu:desc: 按CPU使用率降序排列
- format=json: 输出JSON格式

作用：获取按CPU使用率排序的节点信息，只显示关键字段
```

**实际应用场景**：
```http
# 监控脚本：找出CPU使用率最高的3个节点

GET /_cat/nodes?v&h=name,ip,cpu,load_1m&s=cpu:desc&size=3

# 存储监控：找出磁盘使用率最高的索引

GET /_cat/indices?v&h=index,store.size,pri.store.size&s=store.size:desc

# 性能分析：按查询时间排序，找出慢查询索引

GET /_cat/indices?v&h=index,search.query_time_in_millis&s=search.query_time_in_millis:desc
```

---

# 5. 🛠️ 调试技巧与最佳实践



## 5.1 常用调试流程



### 🔸 系统健康检查流程



```
调试检查清单：
┌─ 第1步：集群整体健康状况
│   GET /_cat/health?v
│
├─ 第2步：节点状态检查  
│   GET /_cat/nodes?v
│
├─ 第3步：索引状态检查
│   GET /_cat/indices?v
│
├─ 第4步：分片分布检查
│   GET /_cat/shards?v
│
└─ 第5步：具体问题深入分析
    根据前面发现的问题进行针对性检查
```

**实用检查脚本**：
```bash
# 一键健康检查脚本

echo "=== 集群健康状况 ==="
curl -X GET "localhost:9200/_cat/health?v"

echo -e "\n=== 节点状态 ==="  
curl -X GET "localhost:9200/_cat/nodes?v"

echo -e "\n=== 索引概览 ==="
curl -X GET "localhost:9200/_cat/indices?v&s=store.size:desc"
```

## 5.2 问题排查技巧



### 🔸 性能问题排查



**CPU高使用率排查**：
```http
# 1. 找出CPU使用率最高的节点

GET /_cat/nodes?v&h=name,cpu,load_1m,load_5m&s=cpu:desc

# 2. 检查该节点的分片分布

GET /_cat/shards?v&h=index,shard,prirep,node&s=node

# 3. 查看最活跃的索引

GET /_cat/indices?v&h=index,search.query_current,indexing.index_current&s=search.query_current:desc
```

**存储空间排查**：
```http
# 1. 查看磁盘使用情况

GET /_cat/allocation?v&s=disk.percent:desc

# 2. 找出占用空间最大的索引

GET /_cat/indices?v&h=index,store.size&s=store.size:desc

# 3. 检查分片大小分布

GET /_cat/shards?v&h=index,shard,prirep,store&s=store:desc
```

## 5.3 日常监控命令



### 🔸 制作监控仪表板



**核心监控指标**：
```http
# 监控脚本模板

#!/bin/bash


echo "=== $(date) ES集群监控报告 ==="

echo "1. 集群健康状态："
curl -s "localhost:9200/_cat/health?h=status,node.total,active_primary_shards"

echo -e "\n2. 节点资源使用TOP3："
curl -s "localhost:9200/_cat/nodes?h=name,heap.percent,cpu,load_1m&s=heap.percent:desc" | head -3

echo -e "\n3. 最大索引TOP5："
curl -s "localhost:9200/_cat/indices?h=index,store.size&s=store.size:desc" | head -5

echo -e "\n4. 当前搜索活动："
curl -s "localhost:9200/_cat/indices?h=index,search.query_current&s=search.query_current:desc" | head -3
```

## 5.4 错误排查指南



### 🔸 常见错误及解决方案



**错误类型及处理方法**：

| 错误现象 | **可能原因** | **排查命令** | **解决思路** |
|---------|-------------|-------------|-------------|
| `集群状态红色` | `主分片丢失` | `GET /_cat/shards?v\|grep UNASSIGNED` | `重新分配分片或恢复数据` |
| `节点离线` | `网络或资源问题` | `GET /_cat/nodes?v` | `检查节点日志和资源` |
| `搜索缓慢` | `资源不足或查询复杂` | `GET /_cat/nodes?h=name,search.query_time_in_millis` | `优化查询或扩容` |
| `写入失败` | `磁盘空间不足` | `GET /_cat/allocation?v` | `清理数据或扩容` |

---

# 6. 📋 核心要点总结



## 6.1 必须掌握的核心命令



```
🔸 基础查看命令：
- GET /_cat/health?v         # 集群健康状态
- GET /_cat/nodes?v          # 节点状态信息  
- GET /_cat/indices?v        # 索引状态信息

🔸 调试辅助命令：
- GET /_cat/{command}?help   # 获取命令帮助
- GET /_cat/{command}?format=json  # JSON格式输出
- GET /_cat/{command}?h=field1,field2  # 指定字段输出

🔸 脚本管理命令：
- POST /_scripts/{id}        # 存储脚本
- POST /_scripts/{id}/_execute  # 执行脚本
- GET /_mapping?pretty       # 美化JSON输出
```

## 6.2 关键理解要点



**🔹 Cat命令的设计哲学**：
```
设计目标：
- 人类友好：输出格式适合人工阅读
- 信息精炼：只显示关键状态信息
- 操作简单：一条命令完成复杂查询
- 格式灵活：支持多种输出格式
```

**🔹 参数组合的威力**：
```
单一参数：功能有限
组合参数：威力倍增

示例：GET /_cat/nodes?v&h=name,cpu&s=cpu:desc
效果：显示节点名和CPU，按CPU降序，带列标题
```

**🔹 脚本存储的价值**：
```
价值体现：
- 代码复用：避免重复编写
- 性能提升：预编译缓存
- 安全控制：减少注入风险
- 统一管理：便于维护更新
```

## 6.3 实际应用价值



**日常运维场景**：
- **健康监控**：定期检查集群状态，及时发现问题
- **性能调优**：通过排序和过滤找出性能瓶颈
- **容量规划**：监控资源使用情况，制定扩容计划
- **故障排查**：快速定位问题节点和异常索引

**开发调试场景**：
- **接口测试**：美化JSON输出，便于查看返回数据
- **脚本开发**：存储常用脚本，提高开发效率
- **数据分析**：使用灵活的格式化输出进行数据分析

## 6.4 学习建议



**🎯 学习路径**：
```
第1阶段：掌握基础Cat命令
- 熟练使用health、nodes、indices命令
- 理解v、h、s等基础参数

第2阶段：掌握格式化技巧  
- 学会使用format、pretty参数
- 掌握参数组合使用技巧

第3阶段：掌握脚本管理
- 学会存储和执行脚本
- 在实际项目中应用脚本

第4阶段：形成监控体系
- 建立日常监控脚本
- 制定故障排查流程
```

**💡 记忆口诀**：
- **Cat命令看状态，v参数显标题**
- **h选字段s排序，format控制输出格式**  
- **脚本存储能复用，pretty美化易阅读**
- **组合参数威力大，监控调试都不怕**

**核心记忆**：
- 开发调试命令是ES的"体检工具"
- Cat命令专为人类阅读设计
- 参数组合使用威力倍增
- 脚本存储提高开发效率
- 美化输出提升调试体验