---
title: 20ã€å†…å­˜ä¸ç¼“å­˜ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜æœºåˆ¶åŸºç¡€æ¦‚å¿µ](#1-ç¼“å­˜æœºåˆ¶åŸºç¡€æ¦‚å¿µ)
2. [ç¼“å­˜æ¸…é™¤æ ¸å¿ƒå‘½ä»¤](#2-ç¼“å­˜æ¸…é™¤æ ¸å¿ƒå‘½ä»¤)
3. [å­—æ®µæ•°æ®ç¼“å­˜ç®¡ç†](#3-å­—æ®µæ•°æ®ç¼“å­˜ç®¡ç†)
4. [æ®µç¼“å­˜ä¸å†…å­˜ä¼˜åŒ–](#4-æ®µç¼“å­˜ä¸å†…å­˜ä¼˜åŒ–)
5. [æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­](#5-æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­)
6. [å®æˆ˜ä¼˜åŒ–ç­–ç•¥](#6-å®æˆ˜ä¼˜åŒ–ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§  ç¼“å­˜æœºåˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Elasticsearchç¼“å­˜


**ğŸ”¸ ç¼“å­˜çš„æœ¬è´¨**
```
ç®€å•ç†è§£ï¼šç¼“å­˜å°±åƒæ˜¯"è®°å¿†"
- ä½ ç¬¬ä¸€æ¬¡æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼ŒESä¼šæŠŠç»“æœ"è®°ä½"
- ä¸‹æ¬¡æŸ¥è¯¢ç›¸åŒå†…å®¹æ—¶ï¼Œç›´æ¥ä»"è®°å¿†"ä¸­å–å‡º
- è¿™æ ·å°±ä¸ç”¨é‡æ–°è®¡ç®—ï¼Œé€Ÿåº¦æ›´å¿«
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜**
```
å®é™…åœºæ™¯ï¼š
ç½‘åº—æœç´¢ "æ‰‹æœº" â†’ ESè®¡ç®—ç»“æœ â†’ ç”¨æˆ·çœ‹åˆ°å•†å“åˆ—è¡¨
å†æœ‰äººæœç´¢ "æ‰‹æœº" â†’ ESç›´æ¥ä»ç¼“å­˜å–ç»“æœ â†’ ç§’çº§å“åº”

ä¼˜åŠ¿ï¼š
ğŸš€ å“åº”é€Ÿåº¦å¿«ï¼šé¿å…é‡å¤è®¡ç®—
ğŸ’¾ èŠ‚çœèµ„æºï¼šå‡å°‘CPUå’Œç£ç›˜ä½¿ç”¨
ğŸ“ˆ æå‡ååé‡ï¼šåŒæ—¶å¤„ç†æ›´å¤šè¯·æ±‚
```

### 1.2 ESç¼“å­˜ç³»ç»Ÿæ¶æ„


**ğŸ—ï¸ ç¼“å­˜å±‚æ¬¡ç»“æ„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åº”ç”¨å±‚æŸ¥è¯¢è¯·æ±‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Query Cache (æŸ¥è¯¢ç¼“å­˜)       â”‚ â† ç¼“å­˜æŸ¥è¯¢ç»“æœ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Request Cache (è¯·æ±‚ç¼“å­˜)      â”‚ â† ç¼“å­˜HTTPè¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Field Data Cache (å­—æ®µç¼“å­˜)   â”‚ â† ç¼“å­˜å­—æ®µæ•°æ®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Segment Cache (æ®µç¼“å­˜)      â”‚ â† ç¼“å­˜ç´¢å¼•æ®µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” å„å±‚ç¼“å­˜ä½œç”¨**
- **æŸ¥è¯¢ç¼“å­˜**ï¼šå­˜å‚¨æœç´¢ç»“æœï¼Œç›¸åŒæŸ¥è¯¢ç›´æ¥è¿”å›
- **è¯·æ±‚ç¼“å­˜**ï¼šç¼“å­˜æ•´ä¸ªHTTPè¯·æ±‚å“åº”
- **å­—æ®µç¼“å­˜**ï¼šç¼“å­˜ç”¨äºæ’åºã€èšåˆçš„å­—æ®µæ•°æ®
- **æ®µç¼“å­˜**ï¼šç¼“å­˜ç´¢å¼•æ–‡ä»¶è¯»å–çš„æ•°æ®

### 1.3 ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸ


**â° ç¼“å­˜ä½•æ—¶åˆ›å»º**
```
è§¦å‘æ¡ä»¶ï¼š
1. é¦–æ¬¡æ‰§è¡ŒæŸ¥è¯¢ â†’ è®¡ç®—ç»“æœ â†’ å­˜å…¥ç¼“å­˜
2. æ•°æ®æ›´æ–°å â†’ æ—§ç¼“å­˜å¤±æ•ˆ â†’ é‡æ–°ç¼“å­˜
3. å†…å­˜ä¸è¶³æ—¶ â†’ æ¸…ç†æ—§ç¼“å­˜ â†’ ä¸ºæ–°æ•°æ®è…¾ç©ºé—´

ç”Ÿå‘½å‘¨æœŸï¼š
åˆ›å»º â†’ ä½¿ç”¨ â†’ æ›´æ–° â†’ å¤±æ•ˆ â†’ æ¸…ç†
```

---

## 2. ğŸ§¹ ç¼“å­˜æ¸…é™¤æ ¸å¿ƒå‘½ä»¤


### 2.1 å…¨å±€ç¼“å­˜æ¸…é™¤


**ğŸ”¸ æ¸…é™¤æ‰€æœ‰ç¼“å­˜**
```bash
POST /_cache/clear
```

**ğŸ’­ ä»€ä¹ˆæ—¶å€™ç”¨**
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… ç³»ç»Ÿå†…å­˜ä¸è¶³
âœ… æ•°æ®å¤§é‡æ›´æ–°å
âœ… æ€§èƒ½é—®é¢˜æ’æŸ¥
âœ… ç»´æŠ¤æœŸé—´æ¸…ç†

å®é™…ä¾‹å­ï¼š
ç”µå•†ç½‘ç«™åŒ11åï¼Œå•†å“ä¿¡æ¯å¤§é‡å˜æ›´
â†’ ä½¿ç”¨æ­¤å‘½ä»¤æ¸…é™¤æ‰€æœ‰ç¼“å­˜
â†’ ç¡®ä¿ç”¨æˆ·çœ‹åˆ°æœ€æ–°æ•°æ®
```

**âš¡ æ‰§è¡Œæ•ˆæœ**
```
æ¸…é™¤å†…å®¹ï¼š
â€¢ æŸ¥è¯¢ç¼“å­˜ âœ“
â€¢ è¯·æ±‚ç¼“å­˜ âœ“  
â€¢ å­—æ®µæ•°æ®ç¼“å­˜ âœ“
â€¢ è¿‡æ»¤å™¨ç¼“å­˜ âœ“

æ³¨æ„ï¼š
âš ï¸ æ‰§è¡Œåæ€§èƒ½ä¼šæš‚æ—¶ä¸‹é™ï¼ˆéœ€è¦é‡æ–°æ„å»ºç¼“å­˜ï¼‰
âš ï¸ å»ºè®®åœ¨ä½å³°æœŸæ‰§è¡Œ
```

### 2.2 ç´¢å¼•çº§ç¼“å­˜æ¸…é™¤


**ğŸ”¸ æ¸…é™¤æŒ‡å®šç´¢å¼•ç¼“å­˜**
```bash
POST /my_index/_cache/clear
```

**ğŸ¯ ç²¾ç¡®æ§åˆ¶ç¤ºä¾‹**
```bash
# æ¸…é™¤å•ä¸ªç´¢å¼•
POST /products/_cache/clear

# æ¸…é™¤å¤šä¸ªç´¢å¼•
POST /products,orders/_cache/clear

# ä½¿ç”¨é€šé…ç¬¦
POST /log-*/_cache/clear
```

**ğŸ“Š å¯¹æ¯”å…¨å±€æ¸…é™¤**

| æ“ä½œç±»å‹ | **å½±å“èŒƒå›´** | **æ€§èƒ½å½±å“** | **ä½¿ç”¨åœºæ™¯** |
|---------|------------|------------|-------------|
| å…¨å±€æ¸…é™¤ | `æ‰€æœ‰ç´¢å¼•` | `è¾ƒå¤§` | `ç³»ç»Ÿç»´æŠ¤` |
| ç´¢å¼•æ¸…é™¤ | `æŒ‡å®šç´¢å¼•` | `è¾ƒå°` | `ç‰¹å®šæ•°æ®æ›´æ–°` |

### 2.3 æŒ‡å®šç±»å‹ç¼“å­˜æ¸…é™¤


**ğŸ”¸ æ¸…é™¤ç‰¹å®šç±»å‹ç¼“å­˜**
```bash
POST /_indices/my_index/_cache/clear
```

**ğŸ”§ é«˜çº§å‚æ•°æ§åˆ¶**
```bash
# åªæ¸…é™¤æŸ¥è¯¢ç¼“å­˜
POST /products/_cache/clear?query=true

# åªæ¸…é™¤å­—æ®µæ•°æ®ç¼“å­˜
POST /products/_cache/clear?fielddata=true

# åªæ¸…é™¤è¯·æ±‚ç¼“å­˜
POST /products/_cache/clear?request=true

# ç»„åˆæ¸…é™¤
POST /products/_cache/clear?query=true&fielddata=true
```

**ğŸ’¡ å‚æ•°è¯´æ˜**
- `query=true` â†’ æ¸…é™¤æŸ¥è¯¢ç»“æœç¼“å­˜
- `fielddata=true` â†’ æ¸…é™¤å­—æ®µæ•°æ®ç¼“å­˜
- `request=true` â†’ æ¸…é™¤HTTPè¯·æ±‚ç¼“å­˜

---

## 3. ğŸ“Š å­—æ®µæ•°æ®ç¼“å­˜ç®¡ç†


### 3.1 å­—æ®µæ•°æ®ç¼“å­˜æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å­—æ®µæ•°æ®ç¼“å­˜**
```
é€šä¿—è§£é‡Šï¼š
æƒ³è±¡ä½ åœ¨Excelä¸­å¯¹æ•°æ®æ’åºï¼š
1. Exceléœ€è¦æŠŠæ•´åˆ—æ•°æ®åŠ è½½åˆ°å†…å­˜
2. ç„¶åè¿›è¡Œæ’åºæ“ä½œ
3. ESçš„å­—æ®µæ•°æ®ç¼“å­˜å°±æ˜¯è¿™ä¸ª"åŠ è½½åˆ°å†…å­˜çš„æ•°æ®"

ç”¨é€”ï¼š
â€¢ æ’åºæ“ä½œï¼šORDER BY price
â€¢ èšåˆè®¡ç®—ï¼šç»Ÿè®¡å¹³å‡ä»·æ ¼
â€¢ è„šæœ¬è®¡ç®—ï¼šè‡ªå®šä¹‰è®¡ç®—å…¬å¼
```

**âš ï¸ é‡è¦ç‰¹ç‚¹**
```
å†…å­˜æ¶ˆè€—å¤§ï¼š
- éœ€è¦å°†å­—æ®µå®Œæ•´æ•°æ®åŠ è½½åˆ°å†…å­˜
- æ–‡æœ¬å­—æ®µç‰¹åˆ«å ç”¨å†…å­˜
- å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º

æŒä¹…åŒ–ï¼š
- ä¸€æ—¦åŠ è½½å°±ä¼šä¿ç•™åœ¨å†…å­˜ä¸­
- ç›´åˆ°ç´¢å¼•åˆ·æ–°æˆ–æ‰‹åŠ¨æ¸…é™¤
- é‡å¯ESä¼šä¸¢å¤±
```

### 3.2 å­—æ®µæ•°æ®ç›‘æ§å‘½ä»¤


**ğŸ”¸ æŸ¥çœ‹å­—æ®µæ•°æ®ç¼“å­˜çŠ¶æ€**
```bash
GET /_cat/fielddata?v
```

**ğŸ“‹ è¾“å‡ºè§£è¯»**
```
å“åº”ç¤ºä¾‹ï¼š
id      host      ip        node    field   size
abc123  host1     1.2.3.4   node1   price   50mb
abc123  host1     1.2.3.4   node1   title   120mb

å­—æ®µå«ä¹‰ï¼š
â€¢ id: èŠ‚ç‚¹ID
â€¢ field: ç¼“å­˜çš„å­—æ®µå
â€¢ size: å ç”¨å†…å­˜å¤§å°
```

**ğŸ” è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯**
```bash
GET /_nodes/stats/indices/fielddata
```

**ğŸ“Š è¯¦ç»†å“åº”ç»“æ„**
```json
{
  "nodes": {
    "node1": {
      "indices": {
        "fielddata": {
          "memory_size_in_bytes": 157286400,
          "evictions": 0,
          "fields": {
            "title": {
              "memory_size_in_bytes": 104857600
            },
            "price": {
              "memory_size_in_bytes": 52428800
            }
          }
        }
      }
    }
  }
}
```

### 3.3 å­—æ®µæ•°æ®ç¼“å­˜æ¸…é™¤


**ğŸ”¸ æ¸…é™¤æ‰€æœ‰å­—æ®µæ•°æ®ç¼“å­˜**
```bash
POST /_cache/clear?fielddata=true
```

**ğŸ”¸ æ¸…é™¤æŒ‡å®šç´¢å¼•å­—æ®µç¼“å­˜**
```bash
POST /products/_cache/clear?fielddata=true
```

**ğŸ’¡ å®æˆ˜åœºæ™¯**
```
ä»€ä¹ˆæ—¶å€™æ¸…é™¤å­—æ®µç¼“å­˜ï¼š

1. å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜
   GET /_cat/nodes?v&h=name,heap.percent
   â†’ å¦‚æœheap.percent > 80% è€ƒè™‘æ¸…é™¤

2. æ•°æ®æ›´æ–°é¢‘ç¹
   å¤§é‡æ–‡æ¡£æ›´æ–°å â†’ å­—æ®µç¼“å­˜å¯èƒ½è¿‡æ—¶

3. æŸ¥è¯¢æ¨¡å¼æ”¹å˜
   ä¸å†éœ€è¦æŸäº›å­—æ®µæ’åº â†’ æ¸…é™¤é‡Šæ”¾å†…å­˜
```

### 3.4 å­—æ®µç¼“å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ”§ ç¦ç”¨å­—æ®µæ•°æ®**
```bash
PUT /my_index/_mapping
{
  "properties": {
    "description": {
      "type": "text",
      "fielddata": false
    }
  }
}
```

**ğŸ“ˆ å†…å­˜é™åˆ¶è®¾ç½®**
```bash
PUT /_cluster/settings
{
  "persistent": {
    "indices.fielddata.cache.size": "30%"
  }
}
```

---

## 4. ğŸ—‚ï¸ æ®µç¼“å­˜ä¸å†…å­˜ä¼˜åŒ–


### 4.1 æ®µç¼“å­˜åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ®µ(Segment)**
```
ç®€å•ç†è§£ï¼š
ESç´¢å¼•å°±åƒä¸€æœ¬ä¹¦ï¼š
â€¢ æ•´æœ¬ä¹¦ = ç´¢å¼•
â€¢ æ¯ä¸€ç«  = åˆ†ç‰‡(Shard)  
â€¢ æ¯ä¸€é¡µ = æ®µ(Segment)

æ®µçš„ç‰¹ç‚¹ï¼š
â€¢ ä¸å¯å˜ï¼šä¸€æ—¦åˆ›å»ºä¸ä¼šä¿®æ”¹
â€¢ ç‹¬ç«‹å­˜å‚¨ï¼šæ¯ä¸ªæ®µéƒ½æ˜¯ç‹¬ç«‹æ–‡ä»¶
â€¢ åˆå¹¶æ“ä½œï¼šå°æ®µä¼šåˆå¹¶æˆå¤§æ®µ
```

**ğŸ—ƒï¸ æ®µç¼“å­˜æœºåˆ¶**
```
ç¼“å­˜å†…å®¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç´¢å¼•æ®µæ–‡ä»¶     â”‚ â† ç£ç›˜å­˜å‚¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ®µç¼“å­˜åŒºåŸŸ     â”‚ â† å†…å­˜ç¼“å­˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æŸ¥è¯¢æ‰§è¡Œå™¨     â”‚ â† å®é™…ä½¿ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·¥ä½œæµç¨‹ï¼š
1. æŸ¥è¯¢è¯·æ±‚åˆ°è¾¾
2. æ£€æŸ¥æ®µç¼“å­˜
3. ç¼“å­˜æœªå‘½ä¸­ â†’ ä»ç£ç›˜è¯»å– â†’ å­˜å…¥ç¼“å­˜
4. ç¼“å­˜å‘½ä¸­ â†’ ç›´æ¥ä½¿ç”¨
```

### 4.2 æ®µç¼“å­˜ä¿¡æ¯æŸ¥çœ‹


**ğŸ”¸ æŸ¥çœ‹æ®µä¿¡æ¯**
```bash
GET /_cat/segments?v
```

**ğŸ“Š è¾“å‡ºè§£è¯»**
```
å“åº”ç¤ºä¾‹ï¼š
index    shard prirep ip        segment  generation docs.count size
products 0     p      1.2.3.4   _0       0          1000       5mb
products 0     p      1.2.3.4   _1       1          2000       8mb

å­—æ®µè¯´æ˜ï¼š
â€¢ index: ç´¢å¼•åç§°
â€¢ shard: åˆ†ç‰‡ç¼–å·
â€¢ segment: æ®µæ ‡è¯†
â€¢ docs.count: æ–‡æ¡£æ•°é‡
â€¢ size: æ®µå¤§å°
```

**ğŸ” è¯¦ç»†æ®µç»Ÿè®¡**
```bash
GET /products/_stats/segments
```

### 4.3 æ®µç¼“å­˜ä¼˜åŒ–


**ğŸ”¸ å¼ºåˆ¶æ®µåˆå¹¶**
```bash
POST /products/_forcemerge?max_num_segments=1
```

**ğŸ’¡ åˆå¹¶çš„å¥½å¤„**
```
åˆå¹¶å‰ï¼š
æ®µ1: 1000æ–‡æ¡£, 5MB
æ®µ2: 2000æ–‡æ¡£, 8MB  
æ®µ3: 500æ–‡æ¡£, 2MB
â†’ æ€»å…±3ä¸ªæ®µï¼Œ15MB

åˆå¹¶åï¼š
æ®µ1: 3500æ–‡æ¡£, 14MB
â†’ åªæœ‰1ä¸ªæ®µï¼Œå‡å°‘ç¼“å­˜ç¢ç‰‡
```

**âš ï¸ åˆå¹¶æ³¨æ„äº‹é¡¹**
```
ä½•æ—¶åˆå¹¶ï¼š
âœ… æ•°æ®å†™å…¥å®Œæˆå
âœ… ç³»ç»Ÿç©ºé—²æ—¶é—´
âœ… æ®µæ•°é‡è¿‡å¤šæ—¶(>10ä¸ª)

ä½•æ—¶ä¸åˆå¹¶ï¼š
âŒ é¢‘ç¹å†™å…¥æœŸé—´
âŒ ç³»ç»Ÿè´Ÿè½½é«˜æ—¶
âŒ æ•°æ®ä¼šç»§ç»­æ›´æ–°
```

---

## 5. ğŸ“ˆ æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­


### 5.1 å†…å­˜ä½¿ç”¨ç›‘æ§


**ğŸ”¸ èŠ‚ç‚¹å†…å­˜çŠ¶æ€**
```bash
GET /_cat/nodes?v&h=name,heap.percent,heap.current,heap.max,ram.percent
```

**ğŸ“Š å†…å­˜æŒ‡æ ‡è§£è¯»**
```
å“åº”ç¤ºä¾‹ï¼š
name   heap.percent heap.current heap.max  ram.percent
node1  45           2.1gb        4gb       60

æŒ‡æ ‡å«ä¹‰ï¼š
â€¢ heap.percent: JVMå †å†…å­˜ä½¿ç”¨ç‡
â€¢ heap.current: å½“å‰å †å†…å­˜ä½¿ç”¨é‡
â€¢ heap.max: æœ€å¤§å †å†…å­˜
â€¢ ram.percent: ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡
```

**ğŸš¨ å†…å­˜å‘Šè­¦é˜ˆå€¼**
```
å¥åº·çŠ¶æ€ï¼š
ğŸŸ¢ heap.percent < 75%  â†’ æ­£å¸¸
ğŸŸ¡ heap.percent 75-85% â†’ æ³¨æ„
ğŸ”´ heap.percent > 85%  â†’ å±é™©

å¤„ç†å»ºè®®ï¼š
75-85%: è€ƒè™‘æ¸…é™¤ç¼“å­˜
85-95%: å¿…é¡»æ¸…é™¤ç¼“å­˜
>95%:   åœæ­¢å†™å…¥ï¼Œç´§æ€¥æ¸…ç†
```

### 5.2 ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§


**ğŸ”¸ æŸ¥è¯¢ç¼“å­˜ç»Ÿè®¡**
```bash
GET /_stats/query_cache
```

**ğŸ“ˆ ç¼“å­˜æ•ˆæœåˆ†æ**
```json
{
  "query_cache": {
    "memory_size_in_bytes": 52428800,
    "total_count": 1000,
    "hit_count": 800,
    "miss_count": 200,
    "cache_size": 150,
    "cache_count": 150,
    "evictions": 10
  }
}
```

**ğŸ’¡ å…³é”®æŒ‡æ ‡è®¡ç®—**
```
å‘½ä¸­ç‡è®¡ç®—ï¼š
å‘½ä¸­ç‡ = hit_count / total_count Ã— 100%
ç¤ºä¾‹: 800 / 1000 Ã— 100% = 80%

æ•ˆæœè¯„ä¼°ï¼š
ğŸŸ¢ å‘½ä¸­ç‡ > 70%  â†’ ç¼“å­˜æ•ˆæœå¥½
ğŸŸ¡ å‘½ä¸­ç‡ 50-70% â†’ æ•ˆæœä¸€èˆ¬
ğŸ”´ å‘½ä¸­ç‡ < 50%  â†’ éœ€è¦ä¼˜åŒ–
```

### 5.3 ç¼“å­˜æ€§èƒ½è¯Šæ–­


**ğŸ”¸ è¯·æ±‚ç¼“å­˜ç»Ÿè®¡**
```bash
GET /_stats/request_cache
```

**ğŸ” è¯Šæ–­ç¼“å­˜é—®é¢˜**
```
å¸¸è§é—®é¢˜è¯Šæ–­ï¼š

1. ç¼“å­˜å‘½ä¸­ç‡ä½
   åŸå› ï¼šæŸ¥è¯¢å˜åŒ–å¤§ï¼Œç¼“å­˜é¢‘ç¹å¤±æ•ˆ
   è§£å†³ï¼šä¼˜åŒ–æŸ¥è¯¢æ¨¡å¼ï¼Œå¢åŠ ç¼“å­˜ç©ºé—´

2. å†…å­˜ä½¿ç”¨ç‡é«˜
   åŸå› ï¼šç¼“å­˜æ•°æ®è¿‡å¤š
   è§£å†³ï¼šå®šæœŸæ¸…ç†ï¼Œè°ƒæ•´ç¼“å­˜å¤§å°

3. æŸ¥è¯¢å“åº”æ…¢
   åŸå› ï¼šç¼“å­˜æœªå‘½ä¸­ï¼Œéœ€è¦é‡æ–°è®¡ç®—
   è§£å†³ï¼šé¢„çƒ­ç¼“å­˜ï¼Œä¼˜åŒ–æŸ¥è¯¢
```

---

## 6. ğŸ”§ å®æˆ˜ä¼˜åŒ–ç­–ç•¥


### 6.1 ç¼“å­˜ä¼˜åŒ–æœ€ä½³å®è·µ


**ğŸ¯ ç¼“å­˜æ¸…ç†ç­–ç•¥**
```bash
# 1. å®šæœŸæ¸…ç†ç­–ç•¥(æ¯å¤©å‡Œæ™¨)
POST /_cache/clear?fielddata=true

# 2. æŒ‰éœ€æ¸…ç†ç­–ç•¥(æ•°æ®æ›´æ–°å)
POST /products/_cache/clear

# 3. ç´§æ€¥æ¸…ç†ç­–ç•¥(å†…å­˜ä¸è¶³)
POST /_cache/clear
```

**ğŸ“‹ æ¸…ç†é¢‘ç‡å»ºè®®**

| æ•°æ®ç±»å‹ | **æ›´æ–°é¢‘ç‡** | **æ¸…ç†ç­–ç•¥** | **æ¸…ç†é¢‘ç‡** |
|---------|------------|------------|-------------|
| é™æ€æ•°æ® | `å¾ˆå°‘` | `æ‰‹åŠ¨æ¸…ç†` | `æœˆ/å­£åº¦` |
| ä¸šåŠ¡æ•°æ® | `æ¯å¤©` | `å®šæ—¶æ¸…ç†` | `æ¯å¤©` |
| å®æ—¶æ•°æ® | `é¢‘ç¹` | `è‡ªåŠ¨æ¸…ç†` | `å°æ—¶çº§` |

### 6.2 å†…å­˜ç®¡ç†ç­–ç•¥


**ğŸ”¸ å †å†…å­˜åˆ†é…å»ºè®®**
```bash
# æŸ¥çœ‹å½“å‰å †å†…å­˜é…ç½®
GET /_cat/nodes?v&h=name,heap.max

# JVMå¯åŠ¨å‚æ•°ä¼˜åŒ–
-Xms4g -Xmx4g  # è®¾ç½®å †å†…å­˜4GB
```

**ğŸ“Š å†…å­˜åˆ†é…åŸåˆ™**
```
å†…å­˜åˆ†é…å»ºè®®ï¼š
â€¢ å †å†…å­˜ â‰¤ 32GB (é¿å…å‹ç¼©æŒ‡é’ˆå¤±æ•ˆ)
â€¢ å †å†…å­˜ â‰¤ ç³»ç»Ÿå†…å­˜50% (ä¸ºç³»ç»Ÿç¼“å­˜ç•™ç©ºé—´)
â€¢ ç”Ÿäº§ç¯å¢ƒæœ€å°8GB

ç¤ºä¾‹é…ç½®ï¼š
16GBç³»ç»Ÿå†…å­˜ â†’ 8GBå †å†…å­˜
32GBç³»ç»Ÿå†…å­˜ â†’ 16GBå †å†…å­˜
64GBç³»ç»Ÿå†…å­˜ â†’ 32GBå †å†…å­˜
```

### 6.3 åŒæ­¥åˆ·æ–°ä¼˜åŒ–


**ğŸ”¸ åŒæ­¥åˆ·æ–°å‘½ä»¤**
```bash
POST /_flush/synced
```

**ğŸ’¡ åŒæ­¥åˆ·æ–°ä½œç”¨**
```
ç”¨é€”ï¼š
â€¢ å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç£ç›˜
â€¢ æ¸…ç†äº‹åŠ¡æ—¥å¿—(translog)
â€¢ ä¼˜åŒ–æ®µæ–‡ä»¶å­˜å‚¨
â€¢ æé«˜æŸ¥è¯¢æ€§èƒ½

æ‰§è¡Œæ—¶æœºï¼š
âœ… æ‰¹é‡æ•°æ®å¯¼å…¥å®Œæˆå
âœ… ç³»ç»Ÿç»´æŠ¤æœŸé—´
âœ… èŠ‚ç‚¹é‡å¯å‰
```

**ğŸ”„ åˆ·æ–°æµç¨‹å›¾ç¤º**
```
å†…å­˜æ•°æ®              ç£ç›˜å­˜å‚¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    åŒæ­¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡æ¡£ç¼“å­˜ â”‚ ---------> â”‚ æ®µæ–‡ä»¶   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   åˆ·æ–°     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚äº‹åŠ¡æ—¥å¿—  â”‚ ---------> â”‚ æŒä¹…åŒ–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 ç›‘æ§è„šæœ¬ç¤ºä¾‹


**ğŸ”¸ å†…å­˜ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# å†…å­˜ä½¿ç”¨ç‡æ£€æŸ¥è„šæœ¬

HEAP_USAGE=$(curl -s "localhost:9200/_cat/nodes?h=heap.percent" | head -1)

if [ $HEAP_USAGE -gt 85 ]; then
    echo "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: ${HEAP_USAGE}%"
    # æ¸…é™¤å­—æ®µæ•°æ®ç¼“å­˜
    curl -XPOST "localhost:9200/_cache/clear?fielddata=true"
    echo "å·²æ¸…é™¤å­—æ®µæ•°æ®ç¼“å­˜"
elif [ $HEAP_USAGE -gt 75 ]; then
    echo "å†…å­˜ä½¿ç”¨ç‡è¾ƒé«˜: ${HEAP_USAGE}%ï¼Œå»ºè®®å…³æ³¨"
fi
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```bash
# ğŸ”§ åŸºç¡€ç¼“å­˜æ¸…ç†
POST /_cache/clear                    # æ¸…é™¤æ‰€æœ‰ç¼“å­˜
POST /{index}/_cache/clear           # æ¸…é™¤ç´¢å¼•ç¼“å­˜
POST /_cache/clear?fielddata=true    # æ¸…é™¤å­—æ®µæ•°æ®ç¼“å­˜

# ğŸ“Š ç›‘æ§å‘½ä»¤
GET /_cat/fielddata?v                # å­—æ®µæ•°æ®ç¼“å­˜çŠ¶æ€
GET /_cat/nodes?v&h=heap.percent     # å†…å­˜ä½¿ç”¨ç‡
GET /_cat/segments?v                 # æ®µä¿¡æ¯æŸ¥çœ‹

# âš¡ ä¼˜åŒ–å‘½ä»¤
POST /_flush/synced                  # åŒæ­¥åˆ·æ–°
POST /{index}/_forcemerge            # å¼ºåˆ¶æ®µåˆå¹¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç¼“å­˜çš„æœ¬è´¨**
```
ç¼“å­˜ = ç”¨å†…å­˜æ¢æ—¶é—´
â€¢ ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ…¢ â†’ è®¡ç®—å¹¶ç¼“å­˜ç»“æœ
â€¢ åç»­æŸ¥è¯¢å¿« â†’ ç›´æ¥ä»ç¼“å­˜å–æ•°æ®
â€¢ å†…å­˜æœ‰é™ â†’ éœ€è¦å®šæœŸæ¸…ç†
```

**ğŸ”¹ å†…å­˜ç®¡ç†åŸåˆ™**
```
ç›‘æ§ â†’ é¢„è­¦ â†’ æ¸…ç† â†’ ä¼˜åŒ–

ç›‘æ§æŒ‡æ ‡ï¼š
â€¢ heap.percent < 85% (å¥åº·)
â€¢ ç¼“å­˜å‘½ä¸­ç‡ > 70% (æœ‰æ•ˆ)
â€¢ æ®µæ•°é‡ < 10ä¸ª (åˆç†)
```

**ğŸ”¹ ä¼˜åŒ–ç­–ç•¥é€‰æ‹©**
```
æŒ‰å½±å“èŒƒå›´é€‰æ‹©ï¼š
â€¢ å…¨å±€æ¸…ç† â†’ ç³»ç»Ÿçº§é—®é¢˜
â€¢ ç´¢å¼•æ¸…ç† â†’ ç‰¹å®šæ•°æ®é—®é¢˜  
â€¢ å­—æ®µæ¸…ç† â†’ å†…å­˜å‹åŠ›é—®é¢˜

æŒ‰æ‰§è¡Œæ—¶æœºé€‰æ‹©ï¼š
â€¢ å®šæœŸæ¸…ç† â†’ é¢„é˜²æ€§ç»´æŠ¤
â€¢ æŒ‰éœ€æ¸…ç† â†’ å“åº”å¼å¤„ç†
â€¢ ç´§æ€¥æ¸…ç† â†’ æ•…éšœæ¢å¤
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è¿ç»´æœ€ä½³å®è·µ**
```
æ—¥å¸¸ç»´æŠ¤ï¼š
1. æ¯å¤©æ£€æŸ¥å†…å­˜ä½¿ç”¨ç‡
2. æ•°æ®æ›´æ–°åæ¸…ç†ç›¸å…³ç¼“å­˜
3. å®šæœŸåˆå¹¶å°æ®µæ–‡ä»¶
4. ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡

æ•…éšœå¤„ç†ï¼š
1. å†…å­˜ä¸è¶³ â†’ ç«‹å³æ¸…ç†å­—æ®µç¼“å­˜
2. æŸ¥è¯¢å˜æ…¢ â†’ æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
3. æ•°æ®ä¸ä¸€è‡´ â†’ æ¸…ç†æŸ¥è¯¢ç¼“å­˜
```

**ğŸ”§ æ€§èƒ½è°ƒä¼˜æ€è·¯**
```
åˆ†æ â†’ å®šä½ â†’ ä¼˜åŒ– â†’ éªŒè¯

æ€§èƒ½é—®é¢˜åˆ†æï¼š
â€¢ æ…¢æŸ¥è¯¢ â†’ æ£€æŸ¥ç¼“å­˜ä½¿ç”¨
â€¢ é«˜å†…å­˜ â†’ åˆ†æç¼“å­˜åˆ†å¸ƒ
â€¢ ä½å‘½ä¸­ç‡ â†’ ä¼˜åŒ–æŸ¥è¯¢æ¨¡å¼
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç¼“å­˜æé€Ÿåº¦ï¼Œå†…å­˜æœ‰é™éœ€æ¸…ç†
- ç›‘æ§å†…å­˜ç‡ï¼Œè¶…æ ‡å¿…é¡»è¦å¤„ç†  
- å­—æ®µç¼“å­˜å¤§ï¼ŒåŠæ—¶æ¸…ç†é‡Šå†…å­˜
- æ®µæ–‡ä»¶åˆå¹¶ï¼Œå‡å°‘ç¼“å­˜ç¢ç‰‡åŒ–