---
title: 22ã€åº”ç”¨é›†æˆé—®é¢˜
---
## ğŸ“š ç›®å½•

1. [åº”ç”¨é›†æˆé—®é¢˜æ¦‚è¿°](#1-åº”ç”¨é›†æˆé—®é¢˜æ¦‚è¿°)
2. [Spring Dataé›†æˆé—®é¢˜](#2-Spring-Dataé›†æˆé—®é¢˜)
3. [Logstashæ•°æ®å¤„ç†å¤±è´¥](#3-Logstashæ•°æ®å¤„ç†å¤±è´¥)
4. [Kibanaä»ªè¡¨æ¿å¼‚å¸¸](#4-Kibanaä»ªè¡¨æ¿å¼‚å¸¸)
5. [Beatsæ•°æ®æ”¶é›†é—®é¢˜](#5-Beatsæ•°æ®æ”¶é›†é—®é¢˜)
6. [ä¸­é—´ä»¶é›†æˆå¤±è´¥](#6-ä¸­é—´ä»¶é›†æˆå¤±è´¥)
7. [æ•°æ®åº“åŒæ­¥é—®é¢˜](#7-æ•°æ®åº“åŒæ­¥é—®é¢˜)
8. [å¾®æœåŠ¡è°ƒç”¨å¤±è´¥](#8-å¾®æœåŠ¡è°ƒç”¨å¤±è´¥)
9. [å®¹å™¨åŒ–éƒ¨ç½²é—®é¢˜](#9-å®¹å™¨åŒ–éƒ¨ç½²é—®é¢˜)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ åº”ç”¨é›†æˆé—®é¢˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯åº”ç”¨é›†æˆé—®é¢˜


**é€šä¿—ç†è§£**ï¼šå°±åƒæŠŠä¸åŒçš„ç”µå™¨è¿æ¥åœ¨ä¸€èµ·æ—¶å¯èƒ½å‡ºç°çš„å…¼å®¹æ€§é—®é¢˜

```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ ä¹°äº†ä¸€å°æ–°ç”µè§†ï¼Œæƒ³è¿æ¥è€å¼çš„DVDæ’­æ”¾å™¨
- æ¥å£ä¸åŒ¹é… â† è¿™å°±æ˜¯"ç‰ˆæœ¬å…¼å®¹æ€§"é—®é¢˜
- ä¿¡å·æ ¼å¼ä¸åŒ â† è¿™å°±æ˜¯"æ•°æ®æ ¼å¼"é—®é¢˜  
- é¥æ§å™¨æ§åˆ¶ä¸äº† â† è¿™å°±æ˜¯"é€šä¿¡åè®®"é—®é¢˜

Elasticsearché›†æˆé—®é¢˜ä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ï¼
```

### 1.2 é›†æˆé—®é¢˜çš„æ ¹æœ¬åŸå› 


**ğŸ”¸ ç‰ˆæœ¬ä¸åŒ¹é…**
```
å¸¸è§æƒ…å†µï¼š
- ESç‰ˆæœ¬ï¼š7.15.0
- Spring Data ESï¼š4.1.0  â† è¿™ä¸ªç‰ˆæœ¬åªæ”¯æŒES 7.12ä»¥ä¸‹
- ç»“æœï¼šå¯åŠ¨å°±æŠ¥é”™ï¼Œè¿æ¥å¤±è´¥

å°±åƒæ–°æ‰‹æœºç”¨è€å……ç”µå™¨ï¼Œæ¥å£å¯¹ä¸ä¸Šï¼
```

**ğŸ”¸ é…ç½®é”™è¯¯**
```
å…¸å‹é”™è¯¯ï¼š
- å†™é”™äº†ESæœåŠ¡å™¨åœ°å€
- å¿˜è®°é…ç½®ç”¨æˆ·åå¯†ç 
- ç«¯å£å·æé”™äº†

å°±åƒæ‹¨é”™äº†ç”µè¯å·ç ï¼Œå½“ç„¶æ‰“ä¸é€šï¼
```

**ğŸ”¸ ç½‘ç»œè¿æ¥é—®é¢˜**
```
ç½‘ç»œæ•…éšœè¡¨ç°ï¼š
âœ… æœ¬åœ°èƒ½è®¿é—®ES â†’ é…ç½®æ­£ç¡®
âŒ åº”ç”¨è¿ä¸ä¸ŠES â†’ å¯èƒ½æ˜¯é˜²ç«å¢™ã€ç½‘ç»œç­–ç•¥é—®é¢˜
```

---

## 2. ğŸŒ± Spring Dataé›†æˆé—®é¢˜


### 2.1 ä»€ä¹ˆæ˜¯Spring Data Elasticsearch


**æ–°æ‰‹ç†è§£**ï¼šSpring Data ESå°±åƒæ˜¯ä¸€ä¸ª"ç¿»è¯‘å™¨"

```
æ²¡æœ‰Spring Data ESçš„æƒ…å†µï¼š
ä½ çš„Javaä»£ç  â†’ éœ€è¦æ‰‹å†™HTTPè¯·æ±‚ â†’ å‘é€ç»™Elasticsearch
              â†‘ è¿™å¾ˆå¤æ‚ï¼Œè¦æ‡‚ESçš„APIè¯­æ³•

æœ‰äº†Spring Data ESï¼š
ä½ çš„Javaä»£ç  â†’ ç®€å•çš„æ–¹æ³•è°ƒç”¨ â†’ Springè‡ªåŠ¨ç¿»è¯‘æˆESè¯·æ±‚
              â†‘ è¿™å¾ˆç®€å•ï¼Œåƒæ“ä½œæ•°æ®åº“ä¸€æ ·
```

### 2.2 ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜


**ğŸ”´ æœ€å¸¸è§çš„é”™è¯¯**

| Spring Data ESç‰ˆæœ¬ | æ”¯æŒçš„ESç‰ˆæœ¬ | **å¸¸è§é—®é¢˜** |
|------------------|------------|------------|
| `4.4.x` | ES 7.17.x | `å¦‚æœç”¨ES 8.xä¼šæŠ¥é”™` |
| `4.3.x` | ES 7.15.x | `APIè°ƒç”¨å¤±è´¥` |
| `5.0.x` | ES 8.5.x | `è€é¡¹ç›®å‡çº§å›°éš¾` |

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ**
```xml
<!-- æ–¹æ³•ä¸€ï¼šå‡çº§Spring Data ESç‰ˆæœ¬ -->
<dependency>
    <groupId>org.springframework.data</groupId>
    <artifactId>spring-data-elasticsearch</artifactId>
    <version>5.0.0</version> <!-- åŒ¹é…ä½ çš„ESç‰ˆæœ¬ -->
</dependency>

<!-- æ–¹æ³•äºŒï¼šé™çº§ESç‰ˆæœ¬ï¼ˆå¦‚æœä¸èƒ½å‡çº§ä»£ç ï¼‰ -->
<!-- ä½¿ç”¨ES 7.17.x é…åˆ Spring Data ES 4.4.x -->
```

### 2.3 é…ç½®é—®é¢˜è¯¦è§£


**âŒ é”™è¯¯çš„é…ç½®ç¤ºä¾‹**
```yaml
spring:
  elasticsearch:
    rest:
      uris: localhost:9200  # â† é”™è¯¯ï¼šç¼ºå°‘http://å‰ç¼€
      username: admin       # â† é”™è¯¯ï¼šESæ²¡å¼€å¯å®‰å…¨è®¤è¯
      password: 123456
```

**âœ… æ­£ç¡®çš„é…ç½®ç¤ºä¾‹**
```yaml
spring:
  elasticsearch:
    rest:
      uris: http://localhost:9200  # â† æ­£ç¡®ï¼šåŒ…å«åè®®
      # å¦‚æœESæ²¡å¼€å¯è®¤è¯ï¼Œå°±ä¸è¦å†™usernameå’Œpassword
```

**ğŸ”§ è¿æ¥æµ‹è¯•æ–¹æ³•**
```java
@RestController
public class ESTestController {
    
    @Autowired
    private ElasticsearchTemplate elasticsearchTemplate;
    
    @GetMapping("/test-es")
    public String testConnection() {
        try {
            // ç®€å•çš„è¿æ¥æµ‹è¯•
            boolean exists = elasticsearchTemplate.indexOps(IndexCoordinates.of("test")).exists();
            return "ESè¿æ¥æˆåŠŸï¼";
        } catch (Exception e) {
            return "ESè¿æ¥å¤±è´¥ï¼š" + e.getMessage();
        }
    }
}
```

### 2.4 å®ä½“æ˜ å°„é—®é¢˜


**æ–°æ‰‹å¸¸çŠ¯çš„é”™è¯¯**
```java
// âŒ é”™è¯¯çš„å®ä½“å®šä¹‰
@Document(indexName = "user-index")  // â† ç´¢å¼•åä¸èƒ½æœ‰å¤§å†™å­—æ¯
public class User {
    @Id
    private String id;
    
    @Field(type = FieldType.Text)
    private Date createTime;  // â† é”™è¯¯ï¼šDateç±»å‹åº”è¯¥ç”¨FieldType.Date
}

// âœ… æ­£ç¡®çš„å®ä½“å®šä¹‰
@Document(indexName = "user_index")  // â† æ­£ç¡®ï¼šç”¨ä¸‹åˆ’çº¿
public class User {
    @Id
    private String id;
    
    @Field(type = FieldType.Date)  // â† æ­£ç¡®ï¼šæ—¥æœŸç”¨Dateç±»å‹
    private Date createTime;
    
    @Field(type = FieldType.Text, analyzer = "ik_max_word")
    private String content;  // â† ä¸­æ–‡æœç´¢è¦æŒ‡å®šåˆ†è¯å™¨
}
```

---

## 3. ğŸ”„ Logstashæ•°æ®å¤„ç†å¤±è´¥


### 3.1 ä»€ä¹ˆæ˜¯Logstash


**é€šä¿—æ¯”å–»**ï¼šLogstashå°±åƒä¸€ä¸ª"æ•°æ®æ¬è¿å·¥"

```
æƒ³è±¡ä¸€ä¸ªæµæ°´çº¿ï¼š
åŸå§‹æ•°æ® â†’ Logstashå¤„ç† â†’ è¾“å‡ºåˆ°ES
    â†‘         â†‘           â†‘
   æ—¥å¿—æ–‡ä»¶   æ¸…æ´—ã€è½¬æ¢    å­˜å‚¨æœç´¢

Logstashçš„ä¸‰ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š
ğŸ“¥ Inputï¼šä»å“ªé‡Œè¯»æ•°æ®ï¼ˆæ–‡ä»¶ã€æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰
âš™ï¸ Filterï¼šæ€ä¹ˆå¤„ç†æ•°æ®ï¼ˆè§£æã€è½¬æ¢ã€æ¸…æ´—ï¼‰  
ğŸ“¤ Outputï¼šæ•°æ®è¾“å‡ºåˆ°å“ªé‡Œï¼ˆESã€æ–‡ä»¶ã€å…¶ä»–ç³»ç»Ÿï¼‰
```

### 3.2 è¿‡æ»¤å™¨é…ç½®é—®é¢˜


**ğŸ”´ å¸¸è§çš„Grokè§£æå¤±è´¥**

Grokå°±åƒæ˜¯ä¸€ä¸ª"æ¨¡å¼åŒ¹é…å™¨"ï¼Œç”¨æ¥ä»éç»“æ„åŒ–æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–æ•°æ®ã€‚

```ruby
# âŒ é”™è¯¯çš„Grokæ¨¡å¼
filter {
  grok {
    match => { "message" => "%{WORD:level} %{GREEDYDATA:content}" }
  }
}

# å®é™…æ—¥å¿—æ ¼å¼ï¼š[INFO] 2023-09-21 ç”¨æˆ·ç™»å½•æˆåŠŸ
# ä¸Šé¢çš„æ¨¡å¼åŒ¹é…ä¸äº†æ—¥æœŸéƒ¨åˆ†ï¼

# âœ… æ­£ç¡®çš„Grokæ¨¡å¼  
filter {
  grok {
    match => { 
      "message" => "\[%{WORD:level}\] %{TIMESTAMP_ISO8601:timestamp} %{GREEDYDATA:content}" 
    }
  }
  
  # è½¬æ¢æ—¶é—´æ ¼å¼
  date {
    match => [ "timestamp", "yyyy-MM-dd HH:mm:ss" ]
  }
}
```

**ğŸ› ï¸ è°ƒè¯•Grokæ¨¡å¼çš„æ–¹æ³•**
```bash
# ä½¿ç”¨Grok Debuggeråœ¨çº¿æµ‹è¯•
# ç½‘å€ï¼šhttp://grokdebug.herokuapp.com/

# æˆ–è€…åœ¨Logstashé…ç½®ä¸­è¾“å‡ºåˆ°æ–‡ä»¶è°ƒè¯•
output {
  file {
    path => "/tmp/logstash-debug.log"
    codec => rubydebug  # â† è¿™ä¼šæ˜¾ç¤ºå®Œæ•´çš„æ•°æ®ç»“æ„
  }
}
```

### 3.3 è¾“å‡ºé…ç½®é—®é¢˜


**âŒ å¸¸è§çš„ESè¾“å‡ºé”™è¯¯**
```ruby
output {
  elasticsearch {
    hosts => ["localhost:9200"]
    index => "MyApp-Logs"  # â† é”™è¯¯ï¼šç´¢å¼•åä¸èƒ½æœ‰å¤§å†™
    document_type => "_doc" # â† ES 8.xä¸éœ€è¦è¿™ä¸ªå­—æ®µ
  }
}
```

**âœ… æ­£ç¡®çš„ESè¾“å‡ºé…ç½®**
```ruby
output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "myapp-logs-%{+YYYY.MM.dd}"  # â† æŒ‰æ—¥æœŸåˆ†ç´¢å¼•
    # ES 8.xä¸éœ€è¦document_type
  }
}
```

### 3.4 æ€§èƒ½é—®é¢˜è§£å†³


**ğŸ”¸ æ‰¹é‡å¤„ç†ä¼˜åŒ–**
```ruby
output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "logs-%{+YYYY.MM.dd}"
    
    # æ‰¹é‡è®¾ç½®ï¼ˆæé«˜æ€§èƒ½ï¼‰
    flush_size => 1000      # â† æ¯1000æ¡è®°å½•æäº¤ä¸€æ¬¡
    idle_flush_time => 5    # â† 5ç§’è‡ªåŠ¨æäº¤ä¸€æ¬¡
    workers => 4            # â† ä½¿ç”¨4ä¸ªå·¥ä½œçº¿ç¨‹
  }
}
```

---

## 4. ğŸ“Š Kibanaä»ªè¡¨æ¿å¼‚å¸¸


### 4.1 ä»€ä¹ˆæ˜¯Kibana


**æ–°æ‰‹ç†è§£**ï¼šKibanaå°±åƒExcelçš„å›¾è¡¨åŠŸèƒ½ï¼Œä½†ä¸“é—¨ç”¨æ¥åˆ†æESä¸­çš„æ•°æ®

```
ä¼ ç»Ÿåˆ†ææ–¹å¼ï¼š
æ•°æ®åº“ â†’ å¯¼å‡ºExcel â†’ æ‰‹å·¥åšå›¾è¡¨ â†’ é™æ€æŠ¥è¡¨

Kibanaæ–¹å¼ï¼š
ESæ•°æ® â†’ Kibanaè‡ªåŠ¨åˆ†æ â†’ å®æ—¶å›¾è¡¨ â†’ åŠ¨æ€ä»ªè¡¨æ¿
```

### 4.2 ç´¢å¼•æ¨¡å¼é—®é¢˜


**ğŸ”´ æœ€å¸¸è§é”™è¯¯ï¼šæ‰¾ä¸åˆ°ç´¢å¼•æ¨¡å¼**

**é—®é¢˜ç°è±¡**ï¼š
- Kibanaç•Œé¢æ˜¾ç¤º"No index patterns"
- åˆ›å»ºå›¾è¡¨æ—¶æç¤º"No matching indices found"

**ğŸ”§ è§£å†³æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ£€æŸ¥ESä¸­æ˜¯å¦æœ‰æ•°æ®**
```bash
# åœ¨ESä¸­æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•
GET /_cat/indices?v

# åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
# health status index           uuid                   pri rep docs.count
# yellow open   myapp-logs-2023.09.21 xxxxx-xxxxx-xxxxx  1   1      12543
```

**æ­¥éª¤2ï¼šåœ¨Kibanaä¸­åˆ›å»ºç´¢å¼•æ¨¡å¼**
```
1. æ‰“å¼€Kibana â†’ Stack Management â†’ Index Patterns
2. ç‚¹å‡»"Create index pattern"  
3. è¾“å…¥æ¨¡å¼ï¼šmyapp-logs-*  ï¼ˆè¿™ä¸ª*ä»£è¡¨åŒ¹é…æ‰€æœ‰æ—¥æœŸï¼‰
4. é€‰æ‹©æ—¶é—´å­—æ®µï¼š@timestamp
5. ç‚¹å‡»"Create index pattern"
```

### 4.3 å­—æ®µæ˜ å°„é—®é¢˜


**ğŸ”´ å¸¸è§é—®é¢˜ï¼šå­—æ®µç±»å‹ä¸å¯¹ï¼Œæ— æ³•åšèšåˆåˆ†æ**

**é—®é¢˜åŸå› **ï¼š
```
ESä¸­çš„å­—æ®µæœ‰ä¸åŒç±»å‹ï¼š
- textï¼šç”¨äºå…¨æ–‡æœç´¢ï¼Œä¸èƒ½èšåˆ
- keywordï¼šç”¨äºç²¾ç¡®åŒ¹é…ï¼Œå¯ä»¥èšåˆ  
- dateï¼šæ—¶é—´ç±»å‹
- numericï¼šæ•°å­—ç±»å‹

å¦‚æœæŠŠæ•°å­—å­˜æˆäº†textç±»å‹ï¼Œå°±æ— æ³•åšæ•°å€¼ç»Ÿè®¡ï¼
```

**ğŸ› ï¸ è§£å†³æ–¹æ³•ï¼šä¿®æ”¹å­—æ®µæ˜ å°„**
```json
// æŸ¥çœ‹å½“å‰æ˜ å°„
GET /myapp-logs-*/_mapping

// åˆ›å»ºæ–°çš„ç´¢å¼•æ¨¡æ¿ï¼ˆå½±å“æœªæ¥çš„æ•°æ®ï¼‰
PUT /_index_template/myapp-logs-template
{
  "index_patterns": ["myapp-logs-*"],
  "template": {
    "mappings": {
      "properties": {
        "user_id": {
          "type": "keyword"  // â† ç”¨æˆ·IDåº”è¯¥æ˜¯keywordç±»å‹ï¼Œå¯ä»¥èšåˆ
        },
        "response_time": {
          "type": "integer"  // â† å“åº”æ—¶é—´æ˜¯æ•°å­—ï¼Œå¯ä»¥åšç»Ÿè®¡
        },
        "level": {
          "type": "keyword"  // â† æ—¥å¿—çº§åˆ«æ˜¯keywordï¼Œå¯ä»¥åˆ†ç»„
        }
      }
    }
  }
}
```

### 4.4 ä»ªè¡¨æ¿åŠ è½½æ…¢


**ğŸ”§ ä¼˜åŒ–æ–¹æ³•**ï¼š

**æ–¹æ³•1ï¼šé™åˆ¶æ—¶é—´èŒƒå›´**
```
é»˜è®¤æŸ¥è¯¢ï¼šLast 15 minutes  â† æ”¹æˆæ›´çŸ­çš„æ—¶é—´
å»ºè®®è®¾ç½®ï¼šLast 5 minutes   â† å‡å°‘æ•°æ®é‡
```

**æ–¹æ³•2ï¼šä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶**
```
é¿å…ï¼š*  ï¼ˆæŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼‰
ä½¿ç”¨ï¼šlevel:ERROR  ï¼ˆåªæŸ¥è¯¢é”™è¯¯æ—¥å¿—ï¼‰
```

**æ–¹æ³•3ï¼šä½¿ç”¨èšåˆè€Œä¸æ˜¯è¯¦ç»†æ•°æ®**
```
ä¸å¥½çš„åšæ³•ï¼šæ˜¾ç¤ºæ¯ä¸€æ¡æ—¥å¿—è®°å½•
å¥½çš„åšæ³•ï¼šæŒ‰å°æ—¶ç»Ÿè®¡æ—¥å¿—æ•°é‡ï¼Œæ˜¾ç¤ºè¶‹åŠ¿å›¾
```

---

## 5. ğŸ“¡ Beatsæ•°æ®æ”¶é›†é—®é¢˜


### 5.1 ä»€ä¹ˆæ˜¯Beats


**ç®€å•ç†è§£**ï¼šBeatså°±åƒå„ç§"æ•°æ®æ”¶é›†å™¨"

```
ä¸åŒçš„Beatæœ‰ä¸åŒçš„ç”¨é€”ï¼š
ğŸ—‚ï¸ Filebeatï¼šæ”¶é›†æ—¥å¿—æ–‡ä»¶ï¼ˆåƒä¸€ä¸ªä¸“é—¨è¯»æ–‡ä»¶çš„æœºå™¨äººï¼‰
ğŸ’» Metricbeatï¼šæ”¶é›†ç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ç­‰ï¼‰
ğŸŒ Packetbeatï¼šæ”¶é›†ç½‘ç»œæ•°æ®åŒ…
â¤ï¸ Heartbeatï¼šç›‘æ§æœåŠ¡å¯ç”¨æ€§

æœ€å¸¸ç”¨çš„æ˜¯Filebeatï¼
```

### 5.2 Filebeaté…ç½®é—®é¢˜


**âŒ å¸¸è§çš„é…ç½®é”™è¯¯**
```yaml
# filebeat.yml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/*.log    # â† è·¯å¾„ä¸å­˜åœ¨æˆ–æƒé™ä¸å¤Ÿ
  
output.elasticsearch:
  hosts: ["localhost:9200"]  # â† æ²¡æœ‰å†™http://å‰ç¼€
  index: "filebeat"          # â† æ²¡æœ‰æŒ‰æ—¥æœŸåˆ†ç´¢å¼•
```

**âœ… æ­£ç¡®çš„é…ç½®**
```yaml
# filebeat.yml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/app/*.log     # â† ç¡®ä¿è·¯å¾„å­˜åœ¨ä¸”æœ‰è¯»æƒé™
  fields:
    app_name: "myapp"        # â† æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
  fields_under_root: true
  
output.elasticsearch:
  hosts: ["http://localhost:9200"]
  index: "filebeat-%{+yyyy.MM.dd}"  # â† æŒ‰æ—¥æœŸåˆ†ç´¢å¼•
  template.enabled: false           # â† ç¦ç”¨é»˜è®¤æ¨¡æ¿
```

### 5.3 ç½‘ç»œè¿æ¥é—®é¢˜


**ğŸ”§ è¯Šæ–­æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ£€æŸ¥Filebeatæ˜¯å¦èƒ½è¿æ¥ES**
```bash
# æµ‹è¯•è¿æ¥
./filebeat test output

# æ­£å¸¸è¾“å‡ºï¼š
# elasticsearch: http://localhost:9200...
#   parse url... OK
#   connection... OK
#   auth... OK
#   talk to server... OK
```

**æ­¥éª¤2ï¼šæŸ¥çœ‹Filebeatæ—¥å¿—**
```bash
# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f /var/log/filebeat/filebeat.log

# å¸¸è§é”™è¯¯ä¿¡æ¯ï¼š
# "connection refused" â†’ ESæœåŠ¡æ²¡å¯åŠ¨
# "timeout" â†’ ç½‘ç»œé—®é¢˜æˆ–é˜²ç«å¢™
# "401 Unauthorized" â†’ è®¤è¯é—®é¢˜
```

### 5.4 æ•°æ®ä¸æ›´æ–°é—®é¢˜


**ğŸ”´ å¸¸è§åŸå› ï¼šFilebeatè®°ä½äº†è¯»å–ä½ç½®**

**é—®é¢˜è§£é‡Š**ï¼š
```
Filebeatä¼šè®°ä½æ¯ä¸ªæ–‡ä»¶è¯»åˆ°å“ªé‡Œäº†ï¼Œé¿å…é‡å¤è¯»å–
è¿™ä¸ªä¿¡æ¯å­˜åœ¨registryæ–‡ä»¶ä¸­

å¦‚æœä½ åˆ é™¤äº†æ—¥å¿—æ–‡ä»¶é‡æ–°åˆ›å»ºï¼ŒFilebeatå¯èƒ½è¿˜è®°å¾—è€ä½ç½®
```

**ğŸ› ï¸ è§£å†³æ–¹æ³•**ï¼š
```bash
# æ–¹æ³•1ï¼šåˆ é™¤registryæ–‡ä»¶ï¼ˆä¼šé‡æ–°è¯»å–æ‰€æœ‰æ—¥å¿—ï¼‰
rm -rf /var/lib/filebeat/registry

# æ–¹æ³•2ï¼šä¿®æ”¹é…ç½®ï¼Œå¿½ç•¥æ–‡ä»¶ä½ç½®
# åœ¨filebeat.ymlä¸­æ·»åŠ ï¼š
filebeat.inputs:
- type: log
  ignore_older: 0          # â† ä¸å¿½ç•¥ä»»ä½•æ–‡ä»¶
  scan_frequency: 10s      # â† æ¯10ç§’æ‰«æä¸€æ¬¡
  harvester_buffer_size: 16384
```

---

## 6. ğŸ”— ä¸­é—´ä»¶é›†æˆå¤±è´¥


### 6.1 æ¶ˆæ¯é˜Ÿåˆ—é›†æˆé—®é¢˜


**åœºæ™¯è¯´æ˜**ï¼šå¾ˆå¤šä¼ä¸šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£è€¦ç³»ç»Ÿ

```
å…¸å‹æ¶æ„ï¼š
åº”ç”¨ç³»ç»Ÿ â†’ Kafka/RabbitMQ â†’ Logstash â†’ Elasticsearch
          â†‘                â†‘           â†‘
       ç”Ÿäº§æ¶ˆæ¯           æ¶ˆè´¹æ¶ˆæ¯      å­˜å‚¨æœç´¢
```

**ğŸ”´ Kafkaé›†æˆå¸¸è§é—®é¢˜**

**é—®é¢˜1ï¼šè¿æ¥ä¸ä¸ŠKafka**
```ruby
# âŒ é”™è¯¯çš„Logstashé…ç½®
input {
  kafka {
    bootstrap_servers => "localhost:9092"
    topics => ["app-logs"]
    group_id => "logstash"
  }
}

# é”™è¯¯åŸå› ï¼š
# 1. KafkaæœåŠ¡æ²¡å¯åŠ¨
# 2. é˜²ç«å¢™é˜»æŒ¡9092ç«¯å£  
# 3. topicåç§°ä¸å­˜åœ¨
```

**ğŸ› ï¸ è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥Kafkaæ˜¯å¦å¯åŠ¨
netstat -tlnp | grep 9092

# 2. æ£€æŸ¥topicæ˜¯å¦å­˜åœ¨
kafka-topics.sh --list --bootstrap-server localhost:9092

# 3. åˆ›å»ºtopicï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
kafka-topics.sh --create --topic app-logs \
  --bootstrap-server localhost:9092 \
  --partitions 3 --replication-factor 1
```

**é—®é¢˜2ï¼šæ¶ˆæ¯ç§¯å‹**

**ç°è±¡**ï¼šKafkaæœ‰æ•°æ®ï¼Œä½†ESä¸­æ²¡æœ‰
```bash
# æ£€æŸ¥æ¶ˆè´¹è€…lagï¼ˆæ¶ˆæ¯ç§¯å‹ï¼‰
kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --group logstash --describe

# è¾“å‡ºæ˜¾ç¤ºLAGå¾ˆå¤§ï¼Œè¯´æ˜Logstashæ¶ˆè´¹å¤ªæ…¢
```

**ğŸ”§ ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```ruby
input {
  kafka {
    bootstrap_servers => "localhost:9092"
    topics => ["app-logs"]
    group_id => "logstash"
    consumer_threads => 4    # â† å¢åŠ æ¶ˆè´¹çº¿ç¨‹
    fetch_min_bytes => 1024  # â† æ‰¹é‡æ‹‰å–æ¶ˆæ¯
  }
}
```

### 6.2 Redisç¼“å­˜é›†æˆé—®é¢˜


**ä½¿ç”¨åœºæ™¯**ï¼šç”¨RedisåšESæŸ¥è¯¢ç»“æœç¼“å­˜

```java
// å…¸å‹çš„ç¼“å­˜é€»è¾‘
@Service
public class SearchService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Autowired  
    private ElasticsearchTemplate esTemplate;
    
    public List<Document> search(String keyword) {
        // 1. å…ˆæŸ¥ç¼“å­˜
        String cacheKey = "search:" + keyword;
        List<Document> cached = (List<Document>) redisTemplate.opsForValue().get(cacheKey);
        
        if (cached != null) {
            return cached;  // ç¼“å­˜å‘½ä¸­
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥ES
        List<Document> results = esTemplate.search(/* ESæŸ¥è¯¢ */);
        
        // 3. ç»“æœæ”¾å…¥ç¼“å­˜
        redisTemplate.opsForValue().set(cacheKey, results, 300); // 5åˆ†é’Ÿè¿‡æœŸ
        
        return results;
    }
}
```

**ğŸ”´ å¸¸è§é—®é¢˜ï¼šåºåˆ—åŒ–å¼‚å¸¸**

**é”™è¯¯ä¿¡æ¯**ï¼š
```
SerializationException: Could not read JSON: Unrecognized token
```

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ**ï¼š
```java
@Configuration
public class RedisConfig {
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(factory);
        
        // ä½¿ç”¨JSONåºåˆ—åŒ–
        Jackson2JsonRedisSerializer<Object> serializer = 
            new Jackson2JsonRedisSerializer<>(Object.class);
        
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(serializer);  // â† å…³é”®é…ç½®
        
        return template;
    }
}
```

---

## 7. ğŸ—„ï¸ æ•°æ®åº“åŒæ­¥é—®é¢˜


### 7.1 ä»€ä¹ˆæ˜¯CDCï¼ˆChange Data Captureï¼‰


**é€šä¿—ç†è§£**ï¼šCDCå°±åƒä¸€ä¸ª"æ•°æ®åº“ç›‘è§†å™¨"

```
ä¼ ç»ŸåŒæ­¥æ–¹å¼ï¼š
å®šæ—¶ä»»åŠ¡æ¯å°æ—¶æŸ¥è¯¢æ•°æ®åº“ â†’ å¯¹æ¯”æ•°æ®å˜åŒ– â†’ åŒæ­¥åˆ°ES
ç¼ºç‚¹ï¼šå»¶è¿Ÿé«˜ï¼Œæ€§èƒ½å·®

CDCæ–¹å¼ï¼š  
æ•°æ®åº“æœ‰ä»»ä½•å˜åŒ– â†’ ç«‹å³æ•è·å˜æ›´ â†’ å®æ—¶åŒæ­¥åˆ°ES
ä¼˜ç‚¹ï¼šå®æ—¶æ€§å¥½ï¼Œæ€§èƒ½é«˜
```

### 7.2 MySQLåˆ°ESåŒæ­¥é—®é¢˜


**ğŸ”§ ä½¿ç”¨Logstash JDBCæ’ä»¶åŒæ­¥**

**åŸºç¡€é…ç½®**ï¼š
```ruby
input {
  jdbc {
    jdbc_driver_library => "/path/to/mysql-connector-java.jar"
    jdbc_driver_class => "com.mysql.cj.jdbc.Driver" 
    jdbc_connection_string => "jdbc:mysql://localhost:3306/mydb"
    jdbc_user => "root"
    jdbc_password => "password"
    
    statement => "SELECT * FROM users WHERE updated_at > :sql_last_value"
    schedule => "*/5 * * * *"  # â† æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    use_column_value => true
    tracking_column => "updated_at"  # â† è¿½è¸ªæ›´æ–°æ—¶é—´
  }
}

filter {
  # æ•°æ®è½¬æ¢
  mutate {
    remove_field => ["@version", "@timestamp"]
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "users"
    document_id => "%{id}"  # â† ä½¿ç”¨æ•°æ®åº“IDä½œä¸ºESæ–‡æ¡£ID
  }
}
```

**ğŸ”´ å¸¸è§é—®é¢˜ï¼šå¢é‡åŒæ­¥å¤±è´¥**

**é—®é¢˜åŸå› **ï¼š`sql_last_value`æ²¡æœ‰æ­£ç¡®æ›´æ–°

**è§£å†³æ–¹æ³•**ï¼š
```ruby
input {
  jdbc {
    # ... å…¶ä»–é…ç½®
    
    # æ˜ç¡®æŒ‡å®šlast_run_metadata_path
    last_run_metadata_path => "/tmp/logstash_jdbc_last_run"
    
    # ç¡®ä¿tracking_columnçš„æ•°æ®ç±»å‹æ­£ç¡®
    tracking_column_type => "timestamp"
    
    # SQLè¯­å¥è¦åŒ…å«æ’åº
    statement => "SELECT * FROM users WHERE updated_at > :sql_last_value ORDER BY updated_at ASC"
  }
}
```

### 7.3 å®æ—¶CDCè§£å†³æ–¹æ¡ˆ


**ä½¿ç”¨Debezium + Kafka Connect**

```
æ¶æ„æµç¨‹ï¼š
MySQL â†’ Debezium â†’ Kafka â†’ Kafka Connect â†’ Elasticsearch

ä¼˜åŠ¿ï¼šçœŸæ­£çš„å®æ—¶åŒæ­¥ï¼Œæ¯«ç§’çº§å»¶è¿Ÿ
```

**Debeziumé…ç½®ç¤ºä¾‹**ï¼š
```json
{
  "name": "mysql-connector",
  "config": {
    "connector.class": "io.debezium.connector.mysql.MySqlConnector",
    "database.hostname": "localhost",
    "database.port": "3306", 
    "database.user": "debezium",
    "database.password": "password",
    "database.server.id": "1",
    "database.server.name": "mydb",
    "table.whitelist": "mydb.users,mydb.orders",
    "database.history.kafka.bootstrap.servers": "localhost:9092",
    "database.history.kafka.topic": "dbhistory.mydb"
  }
}
```

---

## 8. ğŸ”§ å¾®æœåŠ¡è°ƒç”¨å¤±è´¥


### 8.1 æœåŠ¡å‘ç°é—®é¢˜


**åœºæ™¯**ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæœåŠ¡éœ€è¦åŠ¨æ€å‘ç°ESé›†ç¾¤

```
ä¼ ç»Ÿæ–¹å¼ï¼šç¡¬ç¼–ç ESåœ°å€
å¾®æœåŠ¡æ–¹å¼ï¼šé€šè¿‡æœåŠ¡æ³¨å†Œä¸­å¿ƒåŠ¨æ€å‘ç°ESæœåŠ¡
```

**ğŸ”´ å¸¸è§é—®é¢˜ï¼šConsul/Eurekaé›†æˆå¤±è´¥**

**Spring Cloudé…ç½®ç¤ºä¾‹**ï¼š
```yaml
# application.yml
spring:
  cloud:
    consul:
      host: localhost
      port: 8500
      discovery:
        service-name: elasticsearch-service
        
  elasticsearch:
    rest:
      uris: ${elasticsearch.urls:http://localhost:9200}  # â† åŠ¨æ€é…ç½®

# Consulä¸­æ³¨å†ŒESæœåŠ¡
elasticsearch:
  urls: http://${consul.service.elasticsearch.host}:${consul.service.elasticsearch.port}
```

**ğŸ› ï¸ åŠ¨æ€é…ç½®åˆ·æ–°**ï¼š
```java
@RestController
@RefreshScope  // â† æ”¯æŒé…ç½®çƒ­åˆ·æ–°
public class SearchController {
    
    @Value("${elasticsearch.urls}")
    private String esUrls;
    
    @Autowired
    private ElasticsearchTemplate esTemplate;
    
    @GetMapping("/search")
    public ResponseEntity<?> search(@RequestParam String q) {
        try {
            // ESæœç´¢é€»è¾‘
            return ResponseEntity.ok(results);
        } catch (Exception e) {
            // æœåŠ¡é™çº§ï¼šè¿”å›ç¼“å­˜ç»“æœæˆ–é»˜è®¤æ•°æ®
            return ResponseEntity.ok(getDefaultResults());
        }
    }
}
```

### 8.2 è´Ÿè½½å‡è¡¡é—®é¢˜


**ğŸ”´ é—®é¢˜ï¼šESé›†ç¾¤è´Ÿè½½ä¸å‡è¡¡**

**åœºæ™¯è¯´æ˜**ï¼š
```
ESé›†ç¾¤ï¼šnode1, node2, node3
åº”ç”¨æ€»æ˜¯è¿æ¥node1 â†’ node1å‹åŠ›å¤§ï¼Œå…¶ä»–èŠ‚ç‚¹é—²ç½®
```

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡**
```yaml
spring:
  elasticsearch:
    rest:
      uris: 
        - http://es-node1:9200
        - http://es-node2:9200  
        - http://es-node3:9200
```

**é«˜çº§é…ç½®**ï¼š
```java
@Configuration
public class ElasticsearchConfig {
    
    @Bean
    public RestHighLevelClient restHighLevelClient() {
        return new RestHighLevelClient(
            RestClient.builder(
                new HttpHost("es-node1", 9200, "http"),
                new HttpHost("es-node2", 9200, "http"),
                new HttpHost("es-node3", 9200, "http")
            )
            .setRequestConfigCallback(requestConfigBuilder ->
                requestConfigBuilder
                    .setConnectTimeout(5000)     # â† è¿æ¥è¶…æ—¶
                    .setSocketTimeout(60000)     # â† è¯»å–è¶…æ—¶
            )
            .setHttpClientConfigCallback(httpClientBuilder ->
                httpClientBuilder
                    .setMaxConnTotal(100)        # â† æœ€å¤§è¿æ¥æ•°
                    .setMaxConnPerRoute(10)      # â† æ¯ä¸ªè·¯ç”±æœ€å¤§è¿æ¥æ•°
            )
        );
    }
}
```

### 8.3 ç†”æ–­é™çº§


**ä¸ºä»€ä¹ˆéœ€è¦ç†”æ–­**ï¼š
```
æ­£å¸¸æƒ…å†µï¼šåº”ç”¨ â†’ ES â†’ è¿”å›ç»“æœ
ESæ•…éšœæ—¶ï¼šåº”ç”¨ â†’ ESè¶…æ—¶ â†’ åº”ç”¨ä¹Ÿå˜æ…¢ â†’ æ•´ä¸ªç³»ç»Ÿå´©æºƒ

æœ‰äº†ç†”æ–­ï¼šåº”ç”¨ â†’ æ£€æµ‹åˆ°ESå¼‚å¸¸ â†’ å¿«é€Ÿè¿”å›é»˜è®¤ç»“æœ â†’ ç³»ç»Ÿå¯ç”¨
```

**ğŸ”§ Hystrixç†”æ–­é…ç½®**ï¼š
```java
@Component
public class SearchService {
    
    @HystrixCommand(
        fallbackMethod = "searchFallback",
        commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "3000"),
            @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "10"),
            @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "50")
        }
    )
    public SearchResult search(String keyword) {
        // ESæœç´¢é€»è¾‘
        return esTemplate.search(keyword);
    }
    
    // é™çº§æ–¹æ³•
    public SearchResult searchFallback(String keyword) {
        // è¿”å›ç¼“å­˜ç»“æœæˆ–é»˜è®¤æ•°æ®
        return new SearchResult("æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

---

## 9. ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²é—®é¢˜


### 9.1 Dockeréƒ¨ç½²é—®é¢˜


**ğŸ”´ å¸¸è§é—®é¢˜ï¼šå†…å­˜é™åˆ¶å¯¼è‡´ESå¯åŠ¨å¤±è´¥**

**é”™è¯¯ç°è±¡**ï¼š
```bash
docker logs elasticsearch
# è¾“å‡ºï¼š
# ERROR: [1] bootstrap checks failed
# [1]: max virtual memory areas vm.max_map_count [65530] is too low
```

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®¿ä¸»æœºä¸Šä¿®æ”¹å†…æ ¸å‚æ•°
sudo sysctl -w vm.max_map_count=262144

# æ°¸ä¹…ç”Ÿæ•ˆ
echo 'vm.max_map_count=262144' >> /etc/sysctl.conf

# Docker Composeé…ç½®
version: '3.7'
services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms1g -Xmx1g"  # â† é™åˆ¶å†…å­˜ä½¿ç”¨
      - bootstrap.memory_lock=true
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - esdata:/usr/share/elasticsearch/data
    ports:
      - "9200:9200"
      
volumes:
  esdata:
```

### 9.2 Kuberneteséƒ¨ç½²é—®é¢˜


**ğŸ”´ Podé¢‘ç¹é‡å¯é—®é¢˜**

**å¸¸è§åŸå› **ï¼š
1. å†…å­˜ä¸è¶³è¢«OOMKilled
2. å¥åº·æ£€æŸ¥å¤±è´¥
3. å­˜å‚¨å·æŒ‚è½½é—®é¢˜

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ**ï¼š

**1. èµ„æºé…ç½®**ï¼š
```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: elasticsearch
spec:
  serviceName: "elasticsearch"
  replicas: 3
  template:
    spec:
      containers:
      - name: elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:7.17.0
        resources:
          requests:
            memory: "2Gi"     # â† æœ€å°å†…å­˜éœ€æ±‚
            cpu: "1000m"
          limits:
            memory: "4Gi"     # â† æœ€å¤§å†…å­˜é™åˆ¶
            cpu: "2000m"
        env:
        - name: ES_JAVA_OPTS
          value: "-Xms2g -Xmx2g"  # â† JVMå †å†…å­˜è®¾ç½®
```

**2. å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```yaml
        readinessProbe:
          httpGet:
            path: /_cluster/health?local=true
            port: 9200
          initialDelaySeconds: 30  # â† ç»™ESè¶³å¤Ÿçš„å¯åŠ¨æ—¶é—´
          timeoutSeconds: 5
          periodSeconds: 10
          
        livenessProbe:
          httpGet:
            path: /_cluster/health?local=true
            port: 9200
          initialDelaySeconds: 60  # â† å¯åŠ¨æ£€æŸ¥å»¶è¿Ÿæ›´é•¿
          timeoutSeconds: 5
          periodSeconds: 30
```

### 9.3 ç½‘ç»œè¿æ¥é—®é¢˜


**ğŸ”´ è·¨Podé€šä¿¡å¤±è´¥**

**é—®é¢˜åœºæ™¯**ï¼š
```
åº”ç”¨Pod â†’ æ— æ³•è¿æ¥ â†’ ES Pod
```

**ğŸ› ï¸ è§£å†³æ­¥éª¤**ï¼š

**1. æ£€æŸ¥Serviceé…ç½®**ï¼š
```yaml
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch-service
spec:
  selector:
    app: elasticsearch
  ports:
  - port: 9200
    targetPort: 9200
  type: ClusterIP  # â† é›†ç¾¤å†…éƒ¨è®¿é—®
```

**2. åº”ç”¨ä¸­ä½¿ç”¨Serviceåç§°**ï¼š
```yaml
# åº”ç”¨çš„ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  elasticsearch.url: "http://elasticsearch-service:9200"  # â† ä½¿ç”¨Serviceå
```

**3. ç½‘ç»œç­–ç•¥æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰NetworkPolicyé˜»æ­¢é€šä¿¡
kubectl get networkpolicy

# æµ‹è¯•Podé—´è¿é€šæ€§
kubectl exec -it app-pod -- curl http://elasticsearch-service:9200/_cluster/health
```

### 9.4 æŒä¹…åŒ–å­˜å‚¨é—®é¢˜


**ğŸ”´ æ•°æ®ä¸¢å¤±é—®é¢˜**

**é—®é¢˜åŸå› **ï¼šES Podé‡å¯åæ•°æ®æ¶ˆå¤±

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨StatefulSet + PVC**
```yaml
apiVersion: v1
kind: StorageClass
metadata:
  name: fast-ssd
provisioner: kubernetes.io/aws-ebs  # â† æ ¹æ®äº‘å‚å•†é€‰æ‹©
parameters:
  type: gp2
  
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: elasticsearch
spec:
  serviceName: "elasticsearch"
  replicas: 3
  volumeClaimTemplates:  # â† æ¯ä¸ªPodç‹¬ç«‹çš„å­˜å‚¨
  - metadata:
      name: es-data
    spec:
      storageClassName: fast-ssd
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 100Gi  # â† æ ¹æ®æ•°æ®é‡è°ƒæ•´
  template:
    spec:
      containers:
      - name: elasticsearch
        volumeMounts:
        - name: es-data
          mountPath: /usr/share/elasticsearch/data
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é›†æˆé—®é¢˜æœ¬è´¨ï¼šä¸åŒç³»ç»Ÿé—´çš„å…¼å®¹æ€§å’Œé€šä¿¡é—®é¢˜
ğŸ”¸ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šç»„ä»¶ç‰ˆæœ¬å¿…é¡»åŒ¹é…ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸å·¥ä½œ
ğŸ”¸ é…ç½®æ­£ç¡®æ€§ï¼šåœ°å€ã€ç«¯å£ã€è®¤è¯ä¿¡æ¯å¿…é¡»å‡†ç¡®
ğŸ”¸ ç½‘ç»œè¿é€šæ€§ï¼šé˜²ç«å¢™ã€ç½‘ç»œç­–ç•¥å¯èƒ½é˜»æ­¢é€šä¿¡
ğŸ”¸ èµ„æºå……è¶³æ€§ï¼šå†…å­˜ã€CPUã€å­˜å‚¨å¿…é¡»æ»¡è¶³éœ€æ±‚
ğŸ”¸ ç›‘æ§è¯Šæ–­ï¼šæ—¥å¿—å’Œç›‘æ§æ˜¯å®šä½é—®é¢˜çš„å…³é”®
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é›†æˆé—®é¢˜çš„è¯Šæ–­æ€è·¯**
```
1. ç¡®è®¤åŸºç¡€æœåŠ¡çŠ¶æ€ï¼ˆESæ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼‰
2. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼ˆpingã€telnetæµ‹è¯•ï¼‰
3. éªŒè¯é…ç½®æ­£ç¡®æ€§ï¼ˆåœ°å€ã€ç«¯å£ã€è®¤è¯ï¼‰
4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼ˆé”™è¯¯ä¿¡æ¯ã€å¼‚å¸¸å †æ ˆï¼‰
5. é€æ­¥éš”ç¦»é—®é¢˜ï¼ˆä»ç®€å•åˆ°å¤æ‚ï¼‰
```

**ğŸ”¹ ç‰ˆæœ¬å…¼å®¹æ€§ç®¡ç†**
```
å‡çº§ç­–ç•¥ï¼š
- å°ç‰ˆæœ¬å‡çº§ï¼šé€šå¸¸å‘åå…¼å®¹ï¼Œé£é™©è¾ƒå°
- å¤§ç‰ˆæœ¬å‡çº§ï¼šå¯èƒ½æœ‰ç ´åæ€§å˜æ›´ï¼Œéœ€è¦æµ‹è¯•
- ç»„ä»¶å‡çº§ï¼šæŒ‰ç…§å®˜æ–¹å…¼å®¹æ€§çŸ©é˜µè¿›è¡Œ

å›æ»šç­–ç•¥ï¼š
- ä¿æŒé…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
- æ•°æ®å¤‡ä»½å’Œæ¢å¤æ–¹æ¡ˆ
- åˆ†é˜¶æ®µå‡çº§ï¼Œä¾¿äºå›æ»š
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–åŸåˆ™**
```
æ‰¹é‡å¤„ç†ï¼š
- æ‰¹é‡å†™å…¥ä»£æ›¿å•æ¡å†™å…¥
- æ‰¹é‡æŸ¥è¯¢ä»£æ›¿å¾ªç¯æŸ¥è¯¢
- åˆç†è®¾ç½®æ‰¹æ¬¡å¤§å°

è¿æ¥ç®¡ç†ï¼š
- ä½¿ç”¨è¿æ¥æ± ï¼Œé¿å…é¢‘ç¹å»ºè¿
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- å®ç°è¿æ¥å¥åº·æ£€æŸ¥

ç¼“å­˜ç­–ç•¥ï¼š
- æŸ¥è¯¢ç»“æœç¼“å­˜
- è¿æ¥ä¿¡æ¯ç¼“å­˜
- é…ç½®ä¿¡æ¯ç¼“å­˜
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æœ€ä½³å®è·µæ¸…å•**

```
é…ç½®ç®¡ç†ï¼š
âœ… ä½¿ç”¨é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†
âœ… æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
âœ… ç¯å¢ƒé…ç½®åˆ†ç¦»
âœ… é…ç½®å˜æ›´ç‰ˆæœ¬æ§åˆ¶

é”™è¯¯å¤„ç†ï¼š
âœ… å®ç°ç†”æ–­é™çº§æœºåˆ¶
âœ… æä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
âœ… è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
âœ… è®¾ç½®åˆç†çš„é‡è¯•ç­–ç•¥

ç›‘æ§å‘Šè­¦ï¼š
âœ… ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
âœ… è®¾ç½®é˜ˆå€¼å‘Šè­¦
âœ… å»ºç«‹æ•…éšœå“åº”æµç¨‹
âœ… å®šæœŸå¥åº·æ£€æŸ¥

æ–‡æ¡£ç»´æŠ¤ï¼š
âœ… è®°å½•æ¶æ„è®¾è®¡æ–‡æ¡£
âœ… ç»´æŠ¤æ•…éšœå¤„ç†æ‰‹å†Œ
âœ… æ›´æ–°é…ç½®å˜æ›´è®°å½•
âœ… ç¼–å†™è¿ç»´æ“ä½œæŒ‡å—
```

**ğŸ”§ å¸¸ç”¨è¯Šæ–­å‘½ä»¤**
```bash
# ESé›†ç¾¤å¥åº·æ£€æŸ¥
curl -X GET "localhost:9200/_cluster/health?pretty"

# æŸ¥çœ‹ç´¢å¼•çŠ¶æ€
curl -X GET "localhost:9200/_cat/indices?v"

# æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
curl -X GET "localhost:9200/_cat/nodes?v"

# æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
curl -X GET "localhost:9200/_cat/tasks?v"

# ç½‘ç»œè¿é€šæ€§æµ‹è¯•
telnet es-host 9200
nc -zv es-host 9200

# å®¹å™¨æ—¥å¿—æŸ¥çœ‹
docker logs -f container-name
kubectl logs -f pod-name
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- é›†æˆé—®é¢˜ä¹æˆæ˜¯é…ç½®é—®é¢˜ï¼Œä»”ç»†æ£€æŸ¥é…ç½®
- ç‰ˆæœ¬å…¼å®¹æ˜¯ç¬¬ä¸€è¦åŠ¡ï¼Œå‡çº§å‰å¿…é¡»ç¡®è®¤å…¼å®¹æ€§
- ç½‘ç»œè¿é€šæ˜¯åŸºç¡€ï¼Œè§£å†³é—®é¢˜ä»ç½‘ç»œå¼€å§‹
- æ—¥å¿—æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œå­¦ä¼šè¯»æ‡‚é”™è¯¯ä¿¡æ¯
- ç›‘æ§æ¯”ä¿®å¤æ›´é‡è¦ï¼Œé¢„é˜²èƒœäºæ²»ç–—