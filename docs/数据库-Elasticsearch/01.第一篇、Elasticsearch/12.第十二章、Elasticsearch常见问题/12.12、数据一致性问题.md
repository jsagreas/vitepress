---
title: 12ã€æ•°æ®ä¸€è‡´æ€§é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [æ•°æ®ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ](#1-æ•°æ®ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ)
2. [ä¸»å‰¯æœ¬æ•°æ®ä¸ä¸€è‡´](#2-ä¸»å‰¯æœ¬æ•°æ®ä¸ä¸€è‡´)
3. [æ–‡æ¡£ç‰ˆæœ¬å†²çªé—®é¢˜](#3-æ–‡æ¡£ç‰ˆæœ¬å†²çªé—®é¢˜)
4. [æ•°æ®ä¸¢å¤±é—®é¢˜è¯Šæ–­](#4-æ•°æ®ä¸¢å¤±é—®é¢˜è¯Šæ–­)
5. [é‡å¤æ•°æ®é—®é¢˜å¤„ç†](#5-é‡å¤æ•°æ®é—®é¢˜å¤„ç†)
6. [ç´¢å¼•åŒæ­¥é—®é¢˜è§£å†³](#6-ç´¢å¼•åŒæ­¥é—®é¢˜è§£å†³)
7. [æ—¶é—´å­—æ®µç›¸å…³é—®é¢˜](#7-æ—¶é—´å­—æ®µç›¸å…³é—®é¢˜)
8. [æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯](#8-æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯)
9. [é¢„é˜²ä¸æœ€ä½³å®è·µ](#9-é¢„é˜²ä¸æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ•°æ®ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§


**é€šä¿—ç†è§£**
```
æ•°æ®ä¸€è‡´æ€§å°±åƒä¿è¯æ‰€æœ‰å›¾ä¹¦é¦†åˆ†é¦†çš„ä¹¦ç›®ä¿¡æ¯å®Œå…¨ä¸€æ ·ï¼š
â€¢ ä¸»é¦†æœ‰ä¸€æœ¬æ–°ä¹¦ï¼Œåˆ†é¦†ä¹Ÿè¦æœ‰ç›¸åŒè®°å½•
â€¢ ä¸»é¦†åˆ é™¤ä¸€æœ¬ä¹¦ï¼Œåˆ†é¦†ä¹Ÿè¦åŒæ­¥åˆ é™¤
â€¢ ä»»ä½•æ—¶å€™æŸ¥è¯¢ï¼Œæ‰€æœ‰åˆ†é¦†çš„ä¿¡æ¯éƒ½åº”è¯¥ä¸€è‡´
```

**æ ¸å¿ƒæ¦‚å¿µ**
```
åœ¨Elasticsearchä¸­ï¼Œæ•°æ®ä¸€è‡´æ€§åŒ…æ‹¬ï¼š
ğŸ”¸ ä¸»åˆ†ç‰‡ä¸å‰¯æœ¬åˆ†ç‰‡ä¹‹é—´çš„ä¸€è‡´æ€§
ğŸ”¸ ä¸åŒèŠ‚ç‚¹é—´çš„æ•°æ®åŒæ­¥
ğŸ”¸ æ–‡æ¡£ç‰ˆæœ¬çš„æ­£ç¡®ç®¡ç†
ğŸ”¸ ç´¢å¼•çŠ¶æ€çš„ç»Ÿä¸€æ€§
```

### 1.2 ESä¸­çš„ä¸€è‡´æ€§æ¨¡å‹


**ESçš„ä¸€è‡´æ€§ç‰¹ç‚¹**
```
Elasticsearché‡‡ç”¨"æœ€ç»ˆä¸€è‡´æ€§"æ¨¡å‹ï¼š
â€¢ å†™å…¥æ“ä½œå…ˆåœ¨ä¸»åˆ†ç‰‡å®Œæˆ
â€¢ ç„¶åå¼‚æ­¥å¤åˆ¶åˆ°å‰¯æœ¬åˆ†ç‰‡
â€¢ çŸ­æ—¶é—´å†…å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´
â€¢ æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€

ä¸å¼ºä¸€è‡´æ€§çš„åŒºåˆ«ï¼š
å¼ºä¸€è‡´æ€§ï¼šæ‰€æœ‰å‰¯æœ¬åŒæ—¶æ›´æ–°å®Œæ‰ç®—æˆåŠŸ
æœ€ç»ˆä¸€è‡´æ€§ï¼šä¸»åˆ†ç‰‡æ›´æ–°å®Œå°±ç®—æˆåŠŸï¼Œå‰¯æœ¬å¼‚æ­¥è·Ÿä¸Š
```

### 1.3 å¸¸è§ä¸€è‡´æ€§é—®é¢˜ç±»å‹


**ğŸ“‹ é—®é¢˜åˆ†ç±»è¡¨**

| é—®é¢˜ç±»å‹ | **è¡¨ç°ç—‡çŠ¶** | **å¸¸è§åŸå› ** | **å½±å“ç¨‹åº¦** |
|---------|-------------|-------------|-------------|
| **ä¸»å‰¯æœ¬ä¸ä¸€è‡´** | `æœç´¢ç»“æœä¸ç¨³å®š` | `ç½‘ç»œä¸­æ–­ã€èŠ‚ç‚¹æ•…éšœ` | `âš ï¸ ä¸­ç­‰` |
| **ç‰ˆæœ¬å†²çª** | `æ›´æ–°æ“ä½œå¤±è´¥` | `å¹¶å‘å†™å…¥ã€ä¹è§‚é”å†²çª` | `ğŸ”´ é«˜` |
| **æ•°æ®ä¸¢å¤±** | `æ–‡æ¡£æŸ¥è¯¢ä¸åˆ°` | `åˆ†ç‰‡ä¸¢å¤±ã€é…ç½®é”™è¯¯` | `ğŸ”´ ä¸¥é‡` |
| **é‡å¤æ•°æ®** | `ç›¸åŒæ–‡æ¡£å¤šä»½` | `IDç­–ç•¥é”™è¯¯ã€é‡å¤å†™å…¥` | `âš ï¸ ä¸­ç­‰` |
| **ç´¢å¼•ä¸åŒæ­¥** | `æ•°æ®å»¶è¿Ÿå¯è§` | `refreshè®¾ç½®ã€åˆ†ç‰‡çŠ¶æ€` | `ğŸŸ¡ è¾ƒä½` |

---

## 2. ğŸ”„ ä¸»å‰¯æœ¬æ•°æ®ä¸ä¸€è‡´


### 2.1 é—®é¢˜è¡¨ç°ä¸è¯†åˆ«


**ğŸ” å…¸å‹ç—‡çŠ¶**
```
é—®é¢˜ç°è±¡ï¼š
â€¢ åŒæ ·çš„æŸ¥è¯¢ï¼Œå¤šæ¬¡æ‰§è¡Œç»“æœä¸åŒ
â€¢ æŸäº›èŠ‚ç‚¹èƒ½æŸ¥åˆ°æ•°æ®ï¼ŒæŸäº›æŸ¥ä¸åˆ°
â€¢ æ–‡æ¡£è®¡æ•°åœ¨ä¸åŒæ—¶é—´ç‚¹æœ‰å·®å¼‚
â€¢ èšåˆç»Ÿè®¡ç»“æœæ³¢åŠ¨

å®é™…æ¡ˆä¾‹ï¼š
ç”¨æˆ·AæŸ¥è¯¢å•†å“æ•°é‡ï¼š10ä¸ª
ç”¨æˆ·BåŒæ—¶æŸ¥è¯¢ï¼š8ä¸ª
å‡ ç§’åå†æŸ¥è¯¢ï¼šéƒ½å˜æˆ9ä¸ª
```

**ğŸ“Š é—®é¢˜è¯Šæ–­å‘½ä»¤**
```bash
# æ£€æŸ¥åˆ†ç‰‡å¥åº·çŠ¶æ€
GET /_cat/shards?v&h=index,shard,prirep,state,docs,store

# æŸ¥çœ‹å…·ä½“ç´¢å¼•çš„åˆ†ç‰‡çŠ¶æ€
GET /_cluster/health/my_index?level=shards

# æ£€æŸ¥å‰¯æœ¬åŒæ­¥çŠ¶æ€
GET /my_index/_stats?level=shards
```

### 2.2 å¸¸è§åŸå› åˆ†æ


**ğŸ”§ ç½‘ç»œä¸­æ–­å¯¼è‡´åŒæ­¥å¤±è´¥**
```
åœºæ™¯æè¿°ï¼š
ä¸»åˆ†ç‰‡åœ¨èŠ‚ç‚¹Aï¼Œå‰¯æœ¬åœ¨èŠ‚ç‚¹B
ç½‘ç»œä¸´æ—¶ä¸­æ–­ï¼Œå¯¼è‡´æ•°æ®æ— æ³•åŒæ­¥

è¯Šæ–­æ–¹æ³•ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥æ—¥å¿—
2. æŸ¥çœ‹èŠ‚ç‚¹é—´é€šä¿¡çŠ¶æ€
3. æ£€æŸ¥å‰¯æœ¬åˆ†ç‰‡çŠ¶æ€
```

```bash
# æ£€æŸ¥èŠ‚ç‚¹é—´è¿æ¥
GET /_nodes/stats/transport

# æŸ¥çœ‹åˆ†ç‰‡åˆ†é…å¤±è´¥åŸå› 
GET /_cluster/allocation/explain
{
  "index": "my_index",
  "shard": 0,
  "primary": false
}
```

**ğŸ”§ èŠ‚ç‚¹æ•…éšœæ¢å¤åçš„æ•°æ®å·®å¼‚**
```
æ•…éšœæ¢å¤æµç¨‹å›¾ï¼š
èŠ‚ç‚¹æ•…éšœ â†’ å‰¯æœ¬æå‡ä¸ºä¸»åˆ†ç‰‡ â†’ åŸèŠ‚ç‚¹æ¢å¤ â†’ æ•°æ®å¯èƒ½ä¸ä¸€è‡´

ä¿®å¤æ­¥éª¤ï¼š
1. ç¡®è®¤å“ªä¸ªåˆ†ç‰‡æ˜¯æœ€æ–°çš„
2. å¼ºåˆ¶é‡æ–°åˆ†é…åˆ†ç‰‡
3. ç­‰å¾…æ•°æ®é‡æ–°åŒæ­¥
```

### 2.3 è§£å†³æ–¹æ¡ˆ


**âš¡ å¼ºåˆ¶åˆ·æ–°ç´¢å¼•**
```bash
# å¼ºåˆ¶åˆ·æ–°ï¼Œä½¿æ‰€æœ‰å˜æ›´å¯è§
POST /my_index/_refresh

# å¼ºåˆ¶å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç£ç›˜
POST /my_index/_flush

# å¼ºåˆ¶åŒæ­¥æ‰€æœ‰å‰¯æœ¬
POST /my_index/_refresh?wait_for_active_shards=all
```

**ğŸ”„ é‡æ–°åˆ†é…åˆ†ç‰‡**
```bash
# é‡æ–°åˆ†é…æœ‰é—®é¢˜çš„å‰¯æœ¬åˆ†ç‰‡
POST /_cluster/reroute
{
  "commands": [
    {
      "cancel": {
        "index": "my_index",
        "shard": 0,
        "node": "node-2"
      }
    },
    {
      "allocate_replica": {
        "index": "my_index", 
        "shard": 0,
        "node": "node-3"
      }
    }
  ]
}
```

**ğŸ› ï¸ ä¿®å¤æ­¥éª¤è¯¦è§£**
```
ä¿®å¤æµç¨‹ï¼š
1. è¯†åˆ«é—®é¢˜åˆ†ç‰‡
   GET /_cat/shards?v&h=index,shard,prirep,state,node

2. æ£€æŸ¥æ•°æ®å·®å¼‚
   å¯¹æ¯”ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡çš„æ–‡æ¡£æ•°é‡

3. å¼ºåˆ¶é‡æ–°åˆ†é…
   åˆ é™¤æœ‰é—®é¢˜çš„å‰¯æœ¬ï¼Œè®©ESé‡æ–°åˆ›å»º

4. éªŒè¯ä¿®å¤ç»“æœ
   ç¡®è®¤æ‰€æœ‰åˆ†ç‰‡çŠ¶æ€æ­£å¸¸ï¼Œæ•°æ®ä¸€è‡´
```

---

## 3. ğŸ” æ–‡æ¡£ç‰ˆæœ¬å†²çªé—®é¢˜


### 3.1 ç‰ˆæœ¬å†²çªæœºåˆ¶ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å†²çª**
```
ç‰ˆæœ¬å†²çªå°±åƒä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘åŒä¸€ä»½æ–‡æ¡£ï¼š
â€¢ äººAè¯»å–æ–‡æ¡£ç‰ˆæœ¬1ï¼Œå‡†å¤‡ä¿®æ”¹
â€¢ äººBä¹Ÿè¯»å–ç‰ˆæœ¬1ï¼Œå…ˆå®Œæˆä¿®æ”¹ï¼Œç‰ˆæœ¬å˜æˆ2
â€¢ äººAæäº¤ä¿®æ”¹æ—¶ï¼Œå‘ç°ç‰ˆæœ¬å·²ç»æ˜¯2äº†
â€¢ ç³»ç»Ÿæ‹’ç»äººAçš„ä¿®æ”¹ï¼ŒæŠ¥å‘Šç‰ˆæœ¬å†²çª

ESçš„ä¹è§‚é”æœºåˆ¶ï¼š
æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰_versionå­—æ®µ
æ›´æ–°æ—¶å¿…é¡»æŒ‡å®šæœŸæœ›çš„ç‰ˆæœ¬å·
å¦‚æœç‰ˆæœ¬ä¸åŒ¹é…ï¼Œæ“ä½œå¤±è´¥
```

**ğŸ’¡ ç‰ˆæœ¬å†²çªçš„å¥½å¤„**
```
é˜²æ­¢æ•°æ®è¦†ç›–ï¼š
å¦‚æœæ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼Œåé¢çš„æ›´æ–°ä¼šè¦†ç›–å‰é¢çš„
æœ‰äº†ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥æ£€æµ‹åˆ°å¹¶å‘ä¿®æ”¹
å¼€å‘è€…å¯ä»¥å†³å®šå¦‚ä½•å¤„ç†å†²çª
```

### 3.2 å†²çªåœºæ™¯ä¸è¡¨ç°


**ğŸ“‹ å¸¸è§å†²çªåœºæ™¯**
```bash
# åœºæ™¯1ï¼šå¹¶å‘æ›´æ–°åŒä¸€æ–‡æ¡£
ç”¨æˆ·A: POST /products/_update/1 {"doc": {"price": 100}}
ç”¨æˆ·B: POST /products/_update/1 {"doc": {"stock": 50}}
# Bå…ˆå®Œæˆï¼ŒAä¼šé‡åˆ°ç‰ˆæœ¬å†²çª

# åœºæ™¯2ï¼šè‡ªåŠ¨åŒ–è„šæœ¬å¹¶å‘è¿è¡Œ
è„šæœ¬1: æ›´æ–°ç”¨æˆ·ç§¯åˆ†
è„šæœ¬2: æ›´æ–°ç”¨æˆ·ç­‰çº§  
# åŒæ—¶æ“ä½œåŒä¸€ç”¨æˆ·è®°å½•

# åœºæ™¯3ï¼šæ‰¹é‡æ“ä½œä¸­çš„å†²çª
bulkæ“ä½œä¸­æŸäº›æ–‡æ¡£è¢«å…¶ä»–è¿›ç¨‹ä¿®æ”¹
```

**ğŸ” å†²çªé”™è¯¯ä¿¡æ¯**
```json
{
  "error": {
    "type": "version_conflict_engine_exception",
    "reason": "[1]: version conflict, current version [3] is different than the one provided [2]"
  }
}

é”™è¯¯è§£è¯»ï¼š
â€¢ æ–‡æ¡£IDä¸º1å‘ç”Ÿç‰ˆæœ¬å†²çª
â€¢ å½“å‰ç‰ˆæœ¬æ˜¯3ï¼Œä½†æ“ä½œæœŸæœ›çš„ç‰ˆæœ¬æ˜¯2
â€¢ è¯´æ˜åœ¨å‡†å¤‡æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å…¶ä»–æ“ä½œä¿®æ”¹äº†æ–‡æ¡£
```

### 3.3 è§£å†³æ–¹æ¡ˆç­–ç•¥


**ğŸ¯ ç­–ç•¥1ï¼šé‡è¯•æœºåˆ¶**
```bash
# è‡ªåŠ¨é‡è¯•çš„æ›´æ–°è„šæœ¬ç¤ºä¾‹
#!/bin/bash
retry_count=0
max_retries=3

while [ $retry_count -lt $max_retries ]; do
  response=$(curl -s -X POST "localhost:9200/products/_update/1" \
    -H "Content-Type: application/json" \
    -d '{"doc": {"price": 120}}')
  
  if [[ $response == *"version_conflict"* ]]; then
    echo "ç‰ˆæœ¬å†²çªï¼Œé‡è¯•ä¸­... ($((retry_count + 1))/$max_retries)"
    retry_count=$((retry_count + 1))
    sleep 1
  else
    echo "æ›´æ–°æˆåŠŸ"
    break
  fi
done
```

**ğŸ›¡ï¸ ç­–ç•¥2ï¼šä½¿ç”¨å¤–éƒ¨ç‰ˆæœ¬æ§åˆ¶**
```bash
# ä½¿ç”¨å¤–éƒ¨ç‰ˆæœ¬å·ï¼ˆå¦‚æ•°æ®åº“çš„timestampï¼‰
PUT /products/_doc/1?version=1634567890&version_type=external
{
  "name": "å•†å“åç§°",
  "price": 100,
  "updated_time": 1634567890
}

# å¥½å¤„ï¼šå¯ä»¥ä¸å¤–éƒ¨ç³»ç»Ÿä¿æŒç‰ˆæœ¬ä¸€è‡´æ€§
```

**âš™ï¸ ç­–ç•¥3ï¼šè„šæœ¬æ›´æ–°é¿å…å†²çª**
```bash
# ä½¿ç”¨è„šæœ¬è¿›è¡ŒåŸå­æ€§æ›´æ–°
POST /products/_update/1?retry_on_conflict=3
{
  "script": {
    "source": """
      if (ctx._source.stock > params.purchase_quantity) {
        ctx._source.stock -= params.purchase_quantity;
        ctx._source.sold += params.purchase_quantity;
      } else {
        ctx.op = 'noop';
      }
    """,
    "params": {
      "purchase_quantity": 5
    }
  }
}
```

**ğŸ’¡ æœ€ä½³å®è·µ**
```
é€‰æ‹©ç­–ç•¥çš„åŸåˆ™ï¼š
â€¢ é«˜å¹¶å‘åœºæ™¯ï¼šä½¿ç”¨è„šæœ¬æ›´æ–° + é‡è¯•æœºåˆ¶
â€¢ æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜ï¼šä½¿ç”¨å¤–éƒ¨ç‰ˆæœ¬æ§åˆ¶
â€¢ ç®€å•åœºæ™¯ï¼šä¾èµ–ESå†…ç½®é‡è¯•æœºåˆ¶

é‡è¯•ç­–ç•¥è®¾è®¡ï¼š
â€¢ æŒ‡æ•°é€€é¿ï¼šé‡è¯•é—´éš”é€æ¸å¢åŠ 
â€¢ æœ€å¤§é‡è¯•æ¬¡æ•°ï¼šé¿å…æ— é™é‡è¯•
â€¢ é”™è¯¯åˆ†ç±»ï¼šåªå¯¹ç‰ˆæœ¬å†²çªé‡è¯•
```

---

## 4. ğŸ’¥ æ•°æ®ä¸¢å¤±é—®é¢˜è¯Šæ–­


### 4.1 æ•°æ®ä¸¢å¤±çš„å¸¸è§åŸå› 


**ğŸ” åˆ†ç‰‡ä¸¢å¤±å¯¼è‡´æ•°æ®ä¸å¯è®¿é—®**
```
åœºæ™¯æè¿°ï¼š
æŸä¸ªèŠ‚ç‚¹çªç„¶å®•æœºï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ä¸»åˆ†ç‰‡æ— æ³•è®¿é—®
å¦‚æœæ²¡æœ‰å‰¯æœ¬æˆ–å‰¯æœ¬ä¹Ÿæœ‰é—®é¢˜ï¼Œæ•°æ®å°±"ä¸¢å¤±"äº†

æ£€æŸ¥æ–¹æ³•ï¼š
æŸ¥çœ‹å“ªäº›åˆ†ç‰‡å¤„äºUNASSIGNEDçŠ¶æ€
```

```bash
# æŸ¥çœ‹æœªåˆ†é…çš„åˆ†ç‰‡
GET /_cat/shards?v&h=index,shard,prirep,state,unassigned.reason | grep UNASSIGNED

# æŸ¥çœ‹åˆ†ç‰‡åˆ†é…å¤±è´¥çš„è¯¦ç»†åŸå› 
GET /_cluster/allocation/explain
{
  "index": "my_index",
  "shard": 0,
  "primary": true
}
```

**ğŸ”§ èŠ‚ç‚¹é…ç½®é”™è¯¯å¯¼è‡´çš„æ•°æ®ä¸¢å¤±**
```
å¸¸è§é…ç½®é—®é¢˜ï¼š
â€¢ path.data é…ç½®é”™è¯¯ï¼Œæ•°æ®å­˜å‚¨ä½ç½®ä¸å¯¹
â€¢ node.name é‡å¤ï¼Œå¯¼è‡´æ•°æ®å†²çª
â€¢ é›†ç¾¤åç§°é…ç½®é”™è¯¯ï¼ŒèŠ‚ç‚¹åŠ å…¥äº†é”™è¯¯çš„é›†ç¾¤

è¯Šæ–­æ­¥éª¤ï¼š
1. æ£€æŸ¥èŠ‚ç‚¹é…ç½®æ–‡ä»¶
2. æŸ¥çœ‹æ•°æ®ç›®å½•æ˜¯å¦å­˜åœ¨
3. ç¡®è®¤é›†ç¾¤æˆå‘˜å…³ç³»
```

### 4.2 æ•°æ®æ¢å¤æ–¹æ³•


**ğŸ“ ä»å¤‡ä»½å¿«ç…§æ¢å¤**
```bash
# æŸ¥çœ‹å¯ç”¨çš„å¿«ç…§
GET /_snapshot/my_backup/_all

# æ¢å¤ç‰¹å®šç´¢å¼•
POST /_snapshot/my_backup/snapshot_2024_09_21/_restore
{
  "indices": "lost_index",
  "ignore_unavailable": true,
  "include_global_state": false,
  "rename_pattern": "(.+)",
  "rename_replacement": "restored_$1"
}

# ç›‘æ§æ¢å¤è¿›åº¦
GET /_recovery/restored_lost_index
```

**ğŸ”„ ä»å…¶ä»–ç¯å¢ƒåŒæ­¥æ•°æ®**
```bash
# ä½¿ç”¨reindexä»å…¶ä»–é›†ç¾¤æ¢å¤æ•°æ®
POST /_reindex
{
  "source": {
    "remote": {
      "host": "http://backup-cluster:9200",
      "username": "user",
      "password": "pass"
    },
    "index": "source_index"
  },
  "dest": {
    "index": "recovered_index"
  }
}
```

### 4.3 é¢„é˜²æ•°æ®ä¸¢å¤±


**ğŸ›¡ï¸ å‰¯æœ¬é…ç½®ä¼˜åŒ–**
```bash
# ç¡®ä¿å…³é”®ç´¢å¼•æœ‰è¶³å¤Ÿçš„å‰¯æœ¬
PUT /critical_index/_settings
{
  "number_of_replicas": 2
}

# è®¾ç½®æœ€å°ä¸»åˆ†ç‰‡æ•°é‡è¦æ±‚
PUT /_cluster/settings
{
  "persistent": {
    "gateway.expected_nodes": 3,
    "gateway.recover_after_nodes": 2
  }
}
```

**â° è‡ªåŠ¨å¤‡ä»½ç­–ç•¥**
```bash
# åˆ›å»ºå®šæœŸå¿«ç…§ç­–ç•¥
PUT /_slm/policy/daily_backup
{
  "schedule": "0 2 * * *",
  "name": "<backup-{now/d}>",
  "repository": "my_backup",
  "config": {
    "indices": ["important_*"],
    "ignore_unavailable": false,
    "include_global_state": false
  },
  "retention": {
    "expire_after": "30d",
    "min_count": 5,
    "max_count": 50
  }
}
```

---

## 5. ğŸ” é‡å¤æ•°æ®é—®é¢˜å¤„ç†


### 5.1 é‡å¤æ•°æ®äº§ç”ŸåŸå› 


**ğŸ” IDç”Ÿæˆç­–ç•¥é—®é¢˜**
```
é—®é¢˜åœºæ™¯ï¼š
åº”ç”¨ç¨‹åºæ²¡æœ‰æŒ‡å®šæ–‡æ¡£IDï¼ŒESè‡ªåŠ¨ç”Ÿæˆ
ç›¸åŒçš„æ•°æ®è¢«å¤šæ¬¡å†™å…¥ï¼Œäº§ç”Ÿä¸åŒIDçš„é‡å¤æ–‡æ¡£

ç¤ºä¾‹ï¼š
POST /users/_doc  # æ²¡æœ‰æŒ‡å®šID
{"name": "å¼ ä¸‰", "email": "zhangsan@example.com"}

POST /users/_doc  # å†æ¬¡å†™å…¥ï¼Œä¼šäº§ç”Ÿæ–°çš„ID
{"name": "å¼ ä¸‰", "email": "zhangsan@example.com"}

ç»“æœï¼šåŒä¸€ç”¨æˆ·ä¿¡æ¯å­˜å‚¨äº†ä¸¤æ¬¡ï¼ŒIDä¸åŒ
```

**ğŸ”„ åº”ç”¨é‡è¯•é€»è¾‘å¯¼è‡´é‡å¤**
```
ç½‘ç»œè¶…æ—¶åœºæ™¯ï¼š
1. åº”ç”¨å‘é€æ•°æ®åˆ°ES
2. ç½‘ç»œå»¶è¿Ÿï¼Œåº”ç”¨è®¤ä¸ºå¤±è´¥
3. åº”ç”¨é‡è¯•å‘é€ç›¸åŒæ•°æ®
4. ç»“æœï¼šESæ”¶åˆ°äº†ä¸¤æ¬¡ç›¸åŒçš„è¯·æ±‚

é¢„é˜²æ–¹æ³•ï¼š
ä½¿ç”¨å¹‚ç­‰æ€§IDæˆ–æ£€æŸ¥æ“ä½œç»“æœ
```

### 5.2 è¯†åˆ«é‡å¤æ•°æ®


**ğŸ•µï¸ æŸ¥æ‰¾é‡å¤æ–‡æ¡£**
```bash
# ä½¿ç”¨èšåˆæŸ¥æ‰¾é‡å¤çš„email
GET /users/_search
{
  "size": 0,
  "aggs": {
    "duplicates": {
      "terms": {
        "field": "email.keyword",
        "min_doc_count": 2
      },
      "aggs": {
        "duplicate_docs": {
          "top_hits": {
            "size": 10
          }
        }
      }
    }
  }
}

# æŸ¥æ‰¾å®Œå…¨ç›¸åŒçš„æ–‡æ¡£
GET /users/_search
{
  "query": {
    "bool": {
      "must": [
        {"term": {"name.keyword": "å¼ ä¸‰"}},
        {"term": {"email.keyword": "zhangsan@example.com"}}
      ]
    }
  }
}
```

### 5.3 æ¸…ç†é‡å¤æ•°æ®


**ğŸ§¹ åˆ é™¤é‡å¤æ–‡æ¡£ç­–ç•¥**
```bash
# ä¿ç•™æœ€æ–°çš„ï¼Œåˆ é™¤æ—§çš„é‡å¤æ–‡æ¡£
POST /_delete_by_query
{
  "query": {
    "bool": {
      "must": [
        {"term": {"email.keyword": "zhangsan@example.com"}},
        {"range": {"_id": {"lt": "æœ€æ–°æ–‡æ¡£çš„ID"}}}
      ]
    }
  }
}

# ä½¿ç”¨è„šæœ¬æ‰¹é‡æ¸…ç†
POST /users/_update_by_query
{
  "script": {
    "source": """
      // æ ‡è®°é‡å¤æ–‡æ¡£
      if (ctx._source.containsKey('duplicate_flag')) {
        ctx.op = 'delete';
      }
    """
  },
  "query": {
    "exists": {"field": "duplicate_flag"}
  }
}
```

**ğŸ› ï¸ é¢„é˜²é‡å¤æ•°æ®**
```bash
# ä½¿ç”¨ä¸šåŠ¡IDä½œä¸ºæ–‡æ¡£ID
PUT /users/_doc/user_zhangsan_001
{
  "name": "å¼ ä¸‰",
  "email": "zhangsan@example.com",
  "user_id": "user_zhangsan_001"
}

# ä½¿ç”¨upsertæ“ä½œ
POST /users/_update/user_zhangsan_001
{
  "doc": {
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "last_updated": "2024-09-21"
  },
  "doc_as_upsert": true
}
```

---

## 6. ğŸ”„ ç´¢å¼•åŒæ­¥é—®é¢˜è§£å†³


### 6.1 refreshå»¶è¿Ÿé—®é¢˜


**â° refreshæœºåˆ¶ç†è§£**
```
ESçš„æ•°æ®å¯è§æ€§æœºåˆ¶ï¼š
å†™å…¥ â†’ å†…å­˜ç¼“å†²åŒº â†’ refresh â†’ å¯æœç´¢
é»˜è®¤æ¯ç§’è‡ªåŠ¨refreshä¸€æ¬¡

é—®é¢˜è¡¨ç°ï¼š
â€¢ åˆšå†™å…¥çš„æ•°æ®æœç´¢ä¸åˆ°
â€¢ ä¸åŒæ—¶é—´æŸ¥è¯¢ç»“æœä¸åŒ
â€¢ å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯å‡ºç°å»¶è¿Ÿ
```

```bash
# æŸ¥çœ‹ç´¢å¼•çš„refreshè®¾ç½®
GET /my_index/_settings?include_defaults=true&filter_path=*.settings.index.refresh_interval

# è°ƒæ•´refreshé¢‘ç‡
PUT /my_index/_settings
{
  "refresh_interval": "1s"  # é»˜è®¤å€¼ï¼Œå¯ä»¥è°ƒæ•´
}

# ç¦ç”¨è‡ªåŠ¨refreshï¼ˆæ‰¹é‡å¯¼å…¥æ—¶ä½¿ç”¨ï¼‰
PUT /my_index/_settings
{
  "refresh_interval": -1
}
```

### 6.2 å¼ºåˆ¶åŒæ­¥æ“ä½œ


**âš¡ ç«‹å³å¯è§æ•°æ®**
```bash
# å†™å…¥åç«‹å³refresh
POST /my_index/_doc/1?refresh=true
{
  "title": "é‡è¦æ–‡æ¡£",
  "content": "éœ€è¦ç«‹å³å¯è§"
}

# æ‰¹é‡æ“ä½œååˆ·æ–°
POST /_bulk?refresh=true
{"index": {"_index": "my_index", "_id": "1"}}
{"title": "æ–‡æ¡£1"}
{"index": {"_index": "my_index", "_id": "2"}}
{"title": "æ–‡æ¡£2"}

# ç­‰å¾…refreshå®Œæˆ
POST /my_index/_doc/1?refresh=wait_for
{
  "title": "ç­‰å¾…å¯è§çš„æ–‡æ¡£"
}
```

### 6.3 è·¨ç´¢å¼•ä¸€è‡´æ€§


**ğŸ”— å¤šç´¢å¼•æ“ä½œåŒæ­¥**
```bash
# ç¡®ä¿å¤šä¸ªç´¢å¼•åŒæ—¶refresh
POST /index1,index2,index3/_refresh

# ä½¿ç”¨åˆ«åç¡®ä¿æŸ¥è¯¢ä¸€è‡´æ€§
POST /_aliases
{
  "actions": [
    {"add": {"indices": ["index1", "index2"], "alias": "my_data"}}
  ]
}

# æŸ¥è¯¢åˆ«åæ—¶ä¼šè‡ªåŠ¨èšåˆå¤šä¸ªç´¢å¼•çš„ç»“æœ
GET /my_data/_search
{
  "query": {"match_all": {}}
}
```

---

## 7. ğŸ• æ—¶é—´å­—æ®µç›¸å…³é—®é¢˜


### 7.1 æ—¶åŒºé—®é¢˜è¯Šæ–­


**ğŸŒ æ—¶åŒºå¯¼è‡´çš„æ•°æ®æ··ä¹±**
```
å¸¸è§é—®é¢˜ï¼š
â€¢ åº”ç”¨æœåŠ¡å™¨æ—¶åŒºï¼šUTC+8 (åŒ—äº¬æ—¶é—´)
â€¢ ESæœåŠ¡å™¨æ—¶åŒºï¼šUTC (æ ¼æ—å¨æ²»æ—¶é—´)  
â€¢ æ•°æ®åº“æ—¶åŒºï¼šUTC+8
â€¢ ç»“æœï¼šæ—¶é—´å­—æ®µæ˜¾ç¤ºæ··ä¹±ï¼Œç›¸å·®8å°æ—¶

å®é™…æ¡ˆä¾‹ï¼š
åº”ç”¨æ˜¾ç¤ºï¼š2024-09-21 14:30:00 (åŒ—äº¬æ—¶é—´)
ESå­˜å‚¨ï¼š  2024-09-21 06:30:00 (UTCæ—¶é—´)
æŸ¥è¯¢ç»“æœï¼šç”¨æˆ·å›°æƒ‘ä¸ºä»€ä¹ˆæ—¶é—´å¯¹ä¸ä¸Š
```

**ğŸ” æ—¶åŒºé—®é¢˜æ£€æŸ¥**
```bash
# æŸ¥çœ‹ESæœåŠ¡å™¨æ—¶åŒº
GET /_nodes/stats/jvm?filter_path=nodes.*.jvm.start_time_in_millis

# æŸ¥çœ‹ç´¢å¼•ä¸­çš„æ—¶é—´å­—æ®µæ˜ å°„
GET /my_index/_mapping?filter_path=*.mappings.properties.timestamp

# æŸ¥çœ‹å®é™…å­˜å‚¨çš„æ—¶é—´æ•°æ®
GET /my_index/_search
{
  "_source": ["timestamp", "@timestamp"],
  "sort": [{"timestamp": "desc"}],
  "size": 5
}
```

### 7.2 æ—¶é—´æ ¼å¼ç»Ÿä¸€


**ğŸ“… æ ‡å‡†åŒ–æ—¶é—´æ ¼å¼**
```bash
# åˆ›å»ºæ˜ç¡®çš„æ—¶é—´å­—æ®µæ˜ å°„
PUT /events
{
  "mappings": {
    "properties": {
      "event_time": {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd'T'HH:mm:ss.SSSZ"
      },
      "created_at": {
        "type": "date",
        "format": "epoch_millis"
      }
    }
  }
}

# æ’å…¥æ ‡å‡†æ ¼å¼çš„æ—¶é—´æ•°æ®
POST /events/_doc
{
  "event_time": "2024-09-21 14:30:00",
  "created_at": 1695291000000,
  "description": "æ ‡å‡†æ—¶é—´æ ¼å¼"
}
```

### 7.3 æ—¶åŒºå¤„ç†æœ€ä½³å®è·µ


**ğŸ› ï¸ æ—¶é—´å¤„ç†è§„èŒƒ**
```bash
# ä½¿ç”¨UTCæ—¶é—´å­˜å‚¨
POST /logs/_doc
{
  "message": "ç”¨æˆ·ç™»å½•",
  "timestamp": "2024-09-21T06:30:00Z",  # UTCæ—¶é—´
  "local_time": "2024-09-21T14:30:00+08:00",  # æœ¬åœ°æ—¶é—´
  "timezone": "Asia/Shanghai"
}

# æŸ¥è¯¢æ—¶æŒ‡å®šæ—¶åŒº
GET /logs/_search
{
  "query": {
    "range": {
      "timestamp": {
        "gte": "2024-09-21T00:00:00",
        "lte": "2024-09-21T23:59:59",
        "time_zone": "+08:00"
      }
    }
  }
}

# èšåˆæ—¶è€ƒè™‘æ—¶åŒº
GET /logs/_search
{
  "size": 0,
  "aggs": {
    "daily_stats": {
      "date_histogram": {
        "field": "timestamp",
        "calendar_interval": "day",
        "time_zone": "Asia/Shanghai"
      }
    }
  }
}
```

---

## 8. ğŸ”„ æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯


### 8.1 åŠ¨æ€æ˜ å°„å¯¼è‡´çš„é—®é¢˜


**ğŸ¯ ç±»å‹æ¨æ–­é”™è¯¯**
```
é—®é¢˜åœºæ™¯ï¼š
ç¬¬ä¸€æ¡æ•°æ®ï¼š{"user_id": "123"} â†’ ESæ¨æ–­ä¸ºtextç±»å‹
ç¬¬äºŒæ¡æ•°æ®ï¼š{"user_id": 456} â†’ æ•°å­—ç±»å‹ï¼Œä¸æ˜ å°„å†²çª

é”™è¯¯ä¿¡æ¯ï¼š
"mapper_parsing_exception": "failed to parse field [user_id] of type [text]"
```

```bash
# æŸ¥çœ‹å½“å‰å­—æ®µæ˜ å°„
GET /my_index/_mapping/field/user_id

# æ£€æŸ¥ç±»å‹å†²çªçš„æ–‡æ¡£
GET /my_index/_search
{
  "query": {
    "exists": {"field": "user_id"}
  },
  "_source": ["user_id"],
  "size": 10
}
```

### 8.2 å¼ºåˆ¶ç±»å‹è½¬æ¢


**ğŸ”§ ä¿®å¤ç±»å‹ä¸ä¸€è‡´**
```bash
# é‡å»ºç´¢å¼•ï¼Œç»Ÿä¸€å­—æ®µç±»å‹
PUT /my_index_v2
{
  "mappings": {
    "properties": {
      "user_id": {"type": "keyword"},  # ç»Ÿä¸€ä¸ºkeywordç±»å‹
      "age": {"type": "integer"},
      "score": {"type": "float"}
    }
  }
}

# è¿ç§»æ•°æ®å¹¶è½¬æ¢ç±»å‹
POST /_reindex
{
  "source": {"index": "my_index"},
  "dest": {"index": "my_index_v2"},
  "script": {
    "source": """
      // ç¡®ä¿user_idä¸ºå­—ç¬¦ä¸²
      ctx._source.user_id = ctx._source.user_id.toString();
      
      // ç¡®ä¿ageä¸ºæ•´æ•°
      if (ctx._source.age instanceof String) {
        ctx._source.age = Integer.parseInt(ctx._source.age);
      }
    """
  }
}
```

### 8.3 é¢„é˜²ç±»å‹é—®é¢˜


**ğŸ›¡ï¸ ä¸¥æ ¼æ˜ å°„æ§åˆ¶**
```bash
# åˆ›å»ºä¸¥æ ¼æ¨¡å¼çš„ç´¢å¼•
PUT /strict_index
{
  "mappings": {
    "dynamic": "strict",  # ç¦æ­¢åŠ¨æ€æ·»åŠ å­—æ®µ
    "properties": {
      "user_id": {"type": "keyword"},
      "name": {"type": "text"},
      "age": {"type": "integer"},
      "created_at": {"type": "date"}
    }
  }
}

# ä½¿ç”¨æ¨¡æ¿ç¡®ä¿æ–°ç´¢å¼•çš„æ˜ å°„ä¸€è‡´
PUT /_index_template/user_template
{
  "index_patterns": ["user_*"],
  "template": {
    "mappings": {
      "dynamic": "strict",
      "properties": {
        "user_id": {"type": "keyword"},
        "name": {"type": "text"},
        "age": {"type": "integer"}
      }
    }
  }
}
```

---

## 9. ğŸ›¡ï¸ é¢„é˜²ä¸æœ€ä½³å®è·µ


### 9.1 æ•°æ®ä¸€è‡´æ€§ä¿éšœç­–ç•¥


**ğŸ“‹ è®¾è®¡åŸåˆ™**
```
1. åˆç†çš„å‰¯æœ¬é…ç½®
   â€¢ é‡è¦æ•°æ®è‡³å°‘1ä¸ªå‰¯æœ¬
   â€¢ è·¨èŠ‚ç‚¹åˆ†å¸ƒå‰¯æœ¬
   â€¢ å®šæœŸæ£€æŸ¥å‰¯æœ¬å¥åº·çŠ¶æ€

2. å†™å…¥ç­–ç•¥ä¼˜åŒ–
   â€¢ ä½¿ç”¨wait_for_active_shardså‚æ•°
   â€¢ æ‰¹é‡æ“ä½œä½¿ç”¨åˆé€‚çš„æ‰¹æ¬¡å¤§å°
   â€¢ å¤„ç†å¥½å¹¶å‘å†™å…¥çš„ç‰ˆæœ¬å†²çª

3. ç›‘æ§ä¸å‘Šè­¦
   â€¢ ç›‘æ§åˆ†ç‰‡çŠ¶æ€
   â€¢ å…³æ³¨ç‰ˆæœ¬å†²çªé¢‘ç‡
   â€¢ è®¾ç½®æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
```

### 9.2 åº”ç”¨å±‚æœ€ä½³å®è·µ


**ğŸ’» ä»£ç å±‚é¢çš„ä¿éšœ**
```python
# Pythonå®¢æˆ·ç«¯ç¤ºä¾‹ï¼šå¸¦é‡è¯•çš„æ›´æ–°æ“ä½œ
from elasticsearch import Elasticsearch
import time

def safe_update_document(es_client, index, doc_id, update_body, max_retries=3):
    for attempt in range(max_retries):
        try:
            response = es_client.update(
                index=index,
                id=doc_id,
                body=update_body,
                retry_on_conflict=3
            )
            return response
        except Exception as e:
            if "version_conflict" in str(e) and attempt < max_retries - 1:
                print(f"ç‰ˆæœ¬å†²çªï¼Œé‡è¯•ä¸­... (å°è¯• {attempt + 1})")
                time.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
                continue
            else:
                raise e
    return None
```

**ğŸ”„ å¹‚ç­‰æ€§è®¾è®¡**
```bash
# ä½¿ç”¨ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ä½œä¸ºæ–‡æ¡£ID
PUT /orders/_doc/order_20240921_001
{
  "order_id": "order_20240921_001",
  "customer": "å¼ ä¸‰",
  "amount": 299.00,
  "status": "pending"
}

# ä½¿ç”¨upsertç¡®ä¿å¹‚ç­‰æ€§
POST /orders/_update/order_20240921_001
{
  "doc": {
    "status": "confirmed",
    "confirmed_at": "2024-09-21T14:30:00Z"
  },
  "doc_as_upsert": true
}
```

### 9.3 è¿ç»´ç›‘æ§è§„èŒƒ


**ğŸ“Š å…³é”®æŒ‡æ ‡ç›‘æ§**
```bash
# ç›‘æ§è„šæœ¬ç¤ºä¾‹
#!/bin/bash

# æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€
health=$(curl -s "localhost:9200/_cluster/health" | jq -r '.status')
if [ "$health" != "green" ]; then
    echo "è­¦å‘Šï¼šé›†ç¾¤çŠ¶æ€ä¸å¥åº· - $health"
fi

# æ£€æŸ¥æœªåˆ†é…åˆ†ç‰‡
unassigned=$(curl -s "localhost:9200/_cat/shards" | grep UNASSIGNED | wc -l)
if [ $unassigned -gt 0 ]; then
    echo "è­¦å‘Šï¼šå‘ç° $unassigned ä¸ªæœªåˆ†é…åˆ†ç‰‡"
fi

# æ£€æŸ¥ç‰ˆæœ¬å†²çªé¢‘ç‡
conflicts=$(curl -s "localhost:9200/_stats" | jq '.indices[].total.indexing.version_conflicts')
echo "ç‰ˆæœ¬å†²çªæ¬¡æ•°ï¼š$conflicts"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ä¸€è‡´æ€§æ¨¡å‹ï¼šESé‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸»åˆ†ç‰‡å…ˆæ›´æ–°ï¼Œå‰¯æœ¬å¼‚æ­¥è·Ÿè¿›
ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶ï¼šé€šè¿‡_versionå­—æ®µå®ç°ä¹è§‚é”ï¼Œé˜²æ­¢å¹¶å‘è¦†ç›–
ğŸ”¸ åˆ†ç‰‡æœºåˆ¶ï¼šä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡çš„åŒæ­¥å…³ç³»æ˜¯ä¸€è‡´æ€§çš„åŸºç¡€  
ğŸ”¸ refreshæœºåˆ¶ï¼šæ•°æ®å†™å…¥åˆ°å¯æœç´¢éœ€è¦refreshè¿‡ç¨‹
ğŸ”¸ æ—¶åŒºå¤„ç†ï¼šç»Ÿä¸€ä½¿ç”¨UTCæ—¶é—´å­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶è½¬æ¢æ˜¾ç¤º
```

### 10.2 æ•…éšœè¯Šæ–­æ£€æŸ¥æ¸…å•


**ğŸ” é—®é¢˜è¯Šæ–­æ­¥éª¤**
```
1. æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€
   GET /_cluster/health?level=shards

2. æŸ¥çœ‹åˆ†ç‰‡åˆ†å¸ƒæƒ…å†µ  
   GET /_cat/shards?v&h=index,shard,prirep,state,node

3. æ£€æŸ¥å‰¯æœ¬åŒæ­¥çŠ¶æ€
   GET /ç´¢å¼•å/_stats?level=shards

4. æŸ¥çœ‹ç‰ˆæœ¬å†²çªç»Ÿè®¡
   GET /_stats?filter_path=indices.*.total.indexing.version_conflicts

5. æ£€æŸ¥æ—¶é—´å­—æ®µæ˜ å°„
   GET /ç´¢å¼•å/_mapping?filter_path=*.mappings.properties.*timestamp*
```

### 10.3 è§£å†³æ–¹æ¡ˆé€ŸæŸ¥è¡¨


| é—®é¢˜ç±»å‹ | **å¿«é€Ÿè§£å†³å‘½ä»¤** | **é¢„é˜²æªæ–½** |
|---------|-----------------|-------------|
| **ä¸»å‰¯æœ¬ä¸ä¸€è‡´** | `POST /ç´¢å¼•/_refresh` | `å¢åŠ å‰¯æœ¬æ•°é‡ï¼Œç›‘æ§åˆ†ç‰‡çŠ¶æ€` |
| **ç‰ˆæœ¬å†²çª** | `retry_on_conflict=3` | `ä½¿ç”¨è„šæœ¬æ›´æ–°ï¼Œè®¾è®¡é‡è¯•æœºåˆ¶` |
| **æ•°æ®ä¸¢å¤±** | `å¿«ç…§æ¢å¤/_snapshot/restore` | `å®šæœŸå¤‡ä»½ï¼Œå¤šå‰¯æœ¬é…ç½®` |
| **é‡å¤æ•°æ®** | `_delete_by_queryæ¸…ç†` | `ä½¿ç”¨ä¸šåŠ¡IDï¼Œå¹‚ç­‰æ€§è®¾è®¡` |
| **ç´¢å¼•ä¸åŒæ­¥** | `POST /ç´¢å¼•/_refresh` | `åˆç†è®¾ç½®refresh_interval` |
| **æ—¶åŒºé—®é¢˜** | `æŸ¥è¯¢æ—¶æŒ‡å®štime_zone` | `ç»Ÿä¸€UTCå­˜å‚¨ï¼Œæ˜ å°„æ ¼å¼åŒ–` |

### 10.4 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒå»ºè®®**
```
é…ç½®ä¼˜åŒ–ï¼š
â€¢ é‡è¦ç´¢å¼•è®¾ç½®number_of_replicas >= 1
â€¢ åˆç†è®¾ç½®refresh_intervalï¼ˆé»˜è®¤1sï¼‰
â€¢ ä½¿ç”¨index templateç»Ÿä¸€é…ç½®

åº”ç”¨è®¾è®¡ï¼š
â€¢ ä½¿ç”¨ä¸šåŠ¡æœ‰æ„ä¹‰çš„æ–‡æ¡£ID
â€¢ å®ç°ç‰ˆæœ¬å†²çªé‡è¯•æœºåˆ¶
â€¢ æ—¶é—´å­—æ®µç»Ÿä¸€ä½¿ç”¨UTCæ ¼å¼

è¿ç»´ç›‘æ§ï¼š
â€¢ ç›‘æ§é›†ç¾¤å¥åº·çŠ¶æ€å’Œåˆ†ç‰‡åˆ†å¸ƒ
â€¢ è®¾ç½®ç‰ˆæœ¬å†²çªé¢‘ç‡å‘Šè­¦
â€¢ å®šæœŸæ£€æŸ¥æ•°æ®å®Œæ•´æ€§
â€¢ å»ºç«‹å®Œå–„çš„å¤‡ä»½æ¢å¤æµç¨‹
```

**âš ï¸ å¸¸è§é”™è¯¯é¿å…**
```
é”™è¯¯åšæ³•ï¼š
âŒ å¿½ç•¥ç‰ˆæœ¬å†²çªï¼Œç›´æ¥é‡è¯•è¦†ç›–
âŒ ä¸è®¾ç½®å‰¯æœ¬ï¼Œå•ç‚¹å­˜å‚¨é‡è¦æ•°æ®
âŒ æ··åˆä½¿ç”¨å¤šç§æ—¶åŒºæ ¼å¼
âŒ åŠ¨æ€æ˜ å°„å¯¼è‡´å­—æ®µç±»å‹ä¸ä¸€è‡´

æ­£ç¡®åšæ³•ï¼š
âœ… å¤„ç†ç‰ˆæœ¬å†²çªï¼Œå®ç°åˆç†é‡è¯•æœºåˆ¶
âœ… å…³é”®æ•°æ®é…ç½®è¶³å¤Ÿå‰¯æœ¬
âœ… ç»Ÿä¸€æ—¶é—´æ ¼å¼ï¼Œæ˜ç¡®æ—¶åŒºå¤„ç†
âœ… ä½¿ç”¨ä¸¥æ ¼æ˜ å°„ï¼Œé¢„å®šä¹‰å­—æ®µç±»å‹
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ESæœ€ç»ˆä¸€è‡´æ€§éœ€è¦æ—¶é—´ï¼Œä¸è¦æœŸæœ›ç¬é—´åŒæ­¥
- ç‰ˆæœ¬å†²çªæ˜¯ä¿æŠ¤æœºåˆ¶ï¼Œè¦æ­£ç¡®å¤„ç†è€Œéå¿½ç•¥
- å‰¯æœ¬æ˜¯æ•°æ®å®‰å…¨çš„åŸºç¡€ï¼Œç›‘æ§æ˜¯å‘ç°é—®é¢˜çš„å…³é”®
- æ—¶åŒºå’Œç±»å‹è¦åœ¨è®¾è®¡é˜¶æ®µå°±è§„èŒƒå¥½
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œå¥½çš„è®¾è®¡å‡å°‘90%çš„é—®é¢˜