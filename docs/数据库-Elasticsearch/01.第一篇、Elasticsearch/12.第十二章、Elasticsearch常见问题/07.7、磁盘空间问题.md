---
title: 7ã€ç£ç›˜ç©ºé—´é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [ç£ç›˜ç©ºé—´ä¸è¶³é—®é¢˜](#1-ç£ç›˜ç©ºé—´ä¸è¶³é—®é¢˜)
2. [ç£ç›˜æ°´ä½çº¿æœºåˆ¶](#2-ç£ç›˜æ°´ä½çº¿æœºåˆ¶)
3. [ç£ç›˜I/Oæ€§èƒ½ç“¶é¢ˆ](#3-ç£ç›˜IOæ€§èƒ½ç“¶é¢ˆ)
4. [å­˜å‚¨è·¯å¾„æƒé™é—®é¢˜](#4-å­˜å‚¨è·¯å¾„æƒé™é—®é¢˜)
5. [ç£ç›˜æ•…éšœä¸æ•°æ®ä¸¢å¤±](#5-ç£ç›˜æ•…éšœä¸æ•°æ®ä¸¢å¤±)
6. [å¿«ç…§å¤‡ä»½å¤±è´¥é—®é¢˜](#6-å¿«ç…§å¤‡ä»½å¤±è´¥é—®é¢˜)
7. [ç´¢å¼•æ®µæ–‡ä»¶æŸåå¤„ç†](#7-ç´¢å¼•æ®µæ–‡ä»¶æŸåå¤„ç†)
8. [æ—¥å¿—æ–‡ä»¶è¿‡å¤§é—®é¢˜](#8-æ—¥å¿—æ–‡ä»¶è¿‡å¤§é—®é¢˜)
9. [é¢„é˜²ä¸ç›‘æ§ç­–ç•¥](#9-é¢„é˜²ä¸ç›‘æ§ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¾ ç£ç›˜ç©ºé—´ä¸è¶³é—®é¢˜


### 1.1 é—®é¢˜ç°è±¡ä¸è¯†åˆ«


> ğŸ’¡ **é€šä¿—ç†è§£**  
> å°±åƒä½ çš„æ‰‹æœºå­˜å‚¨ç©ºé—´æ»¡äº†æ— æ³•æ‹ç…§ä¸€æ ·ï¼ŒElasticsearchç£ç›˜ç©ºé—´ä¸è¶³æ—¶ä¹Ÿæ— æ³•ç»§ç»­å­˜å‚¨æ–°æ•°æ®

**ğŸ” å¸¸è§ç—‡çŠ¶**
```
å…¸å‹é”™è¯¯ä¿¡æ¯ï¼š
- "disk usage exceeded flood-stage watermark"
- "cannot write, disk full"
- "index [xxx] blocked by: [TOO_MANY_REQUESTS/12/disk usage]"

ç³»ç»Ÿè¡¨ç°ï¼š
âœ… æŸ¥è¯¢æ“ä½œæ­£å¸¸
âŒ å†™å…¥æ“ä½œè¢«é˜»æ­¢
âŒ æ–°ç´¢å¼•æ— æ³•åˆ›å»º
âš ï¸  é›†ç¾¤çŠ¶æ€å˜ä¸ºåªè¯»
```

### 1.2 ç©ºé—´ä¸è¶³çš„åŸå› åˆ†æ


**ğŸ“Š æ•°æ®å¢é•¿è¿‡å¿«åŸå› **
```
å¸¸è§åŸå› è§£æï¼š

ğŸ”¸ æ—¥å¿—æ•°æ®æš´å¢
ä¸šåŠ¡çªç„¶å¢é•¿ â†’ æ—¥å¿—é‡æ¿€å¢ â†’ å­˜å‚¨å‹åŠ›
è§£å†³æ€è·¯ï¼šè®¾ç½®åˆç†çš„æ—¥å¿—ä¿ç•™ç­–ç•¥

ğŸ”¸ ç´¢å¼•é…ç½®ä¸å½“  
å‰¯æœ¬æ•°è®¾ç½®è¿‡å¤š â†’ å­˜å‚¨ç¿»å€å¢é•¿
åˆ†ç‰‡æ•°è®¾ç½®è¿‡å° â†’ å•ä¸ªåˆ†ç‰‡è¿‡å¤§

ğŸ”¸ æ•°æ®æ¸…ç†ç­–ç•¥ç¼ºå¤±
æ—§æ•°æ®æœªåŠæ—¶æ¸…ç† â†’ å†å²æ•°æ®ç´¯ç§¯
æ²¡æœ‰è®¾ç½®ILMç­–ç•¥ â†’ æ•°æ®æ— é™å¢é•¿
```

### 1.3 ç«‹å³è§£å†³æ–¹æ¡ˆ


**âš¡ ç´§æ€¥å¤„ç†æ­¥éª¤**

```bash
# 1. æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
GET _cat/allocation?v&h=shards,disk.indices,disk.used,disk.avail,disk.total,disk.percent,host,node

# 2. æ£€æŸ¥æœ€å¤§çš„ç´¢å¼•
GET _cat/indices?v&s=store.size:desc

# 3. è§£é™¤åªè¯»é™åˆ¶ï¼ˆä¸´æ—¶ï¼‰
PUT _all/_settings
{
  "index.blocks.read_only_allow_delete": null
}
```

**ğŸ› ï¸ å¿«é€Ÿé‡Šæ”¾ç©ºé—´**
```
æ–¹æ³•ä¸€ï¼šåˆ é™¤æ—§ç´¢å¼•
DELETE /logstash-2024.01.*

æ–¹æ³•äºŒï¼šæ¸…ç†æ— ç”¨æ•°æ®
POST /my_index/_delete_by_query
{
  "query": {
    "range": {
      "@timestamp": {
        "lt": "2024-01-01"
      }
    }
  }
}

æ–¹æ³•ä¸‰ï¼šå‡å°‘å‰¯æœ¬æ•°ï¼ˆä¸´æ—¶ï¼‰
PUT /my_index/_settings
{
  "number_of_replicas": 0
}
```

### 1.4 é•¿æœŸè§£å†³æ–¹æ¡ˆ


**ğŸ“‹ ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰**

> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> ILMå°±åƒç»™æ•°æ®è®¾å®š"ç”Ÿå‘½å‘¨æœŸ"ï¼Œè‡ªåŠ¨ç®¡ç†æ•°æ®ä»æ–°é²œåˆ°è¿‡æœŸçš„æ•´ä¸ªè¿‡ç¨‹

```json
PUT _ilm/policy/log_policy
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "5GB",
            "max_age": "7d"
          }
        }
      },
      "warm": {
        "min_age": "7d",
        "actions": {
          "allocate": {
            "number_of_replicas": 0
          }
        }
      },
      "delete": {
        "min_age": "30d"
      }
    }
  }
}
```

**ğŸ’¡ ILMç­–ç•¥è§£é‡Š**
- **Hoté˜¶æ®µ**ï¼šæ–°æ•°æ®ï¼ŒæŸ¥è¯¢é¢‘ç¹ï¼Œä¿æŒå¤šå‰¯æœ¬
- **Warmé˜¶æ®µ**ï¼š7å¤©åï¼Œå‡å°‘å‰¯æœ¬èŠ‚çœç©ºé—´  
- **Deleteé˜¶æ®µ**ï¼š30å¤©åè‡ªåŠ¨åˆ é™¤

---

## 2. ğŸŒŠ ç£ç›˜æ°´ä½çº¿æœºåˆ¶


### 2.1 æ°´ä½çº¿æœºåˆ¶è¯¦è§£


> ğŸ” **ç”Ÿæ´»ç±»æ¯”**  
> ç£ç›˜æ°´ä½çº¿å°±åƒæ°´åº“çš„è­¦æˆ’çº¿ï¼šç»¿è‰²å®‰å…¨ã€é»„è‰²è­¦å‘Šã€çº¢è‰²å±é™©ï¼Œä¸åŒçº§åˆ«è§¦å‘ä¸åŒçš„ä¿æŠ¤æªæ–½

**ğŸ“Š ä¸‰çº§æ°´ä½çº¿è¯´æ˜**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯ç”¨ç©ºé—´ > 15%    â”‚ ğŸŸ¢ æ­£å¸¸å·¥ä½œçŠ¶æ€   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ å¯ç”¨ç©ºé—´ < 15%    â”‚ ğŸŸ¡ Lowæ°´ä½çº¿     â”‚
â”‚                  â”‚   ç¦æ­¢æ–°åˆ†ç‰‡åˆ†é…   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨ç©ºé—´ < 10%    â”‚ ğŸŸ  Highæ°´ä½çº¿    â”‚  
â”‚                  â”‚   è¿ç§»ç°æœ‰åˆ†ç‰‡     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨ç©ºé—´ < 5%     â”‚ ğŸ”´ Floodæ°´ä½çº¿   â”‚
â”‚                  â”‚   ç´¢å¼•åªè¯»æ¨¡å¼     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ°´ä½çº¿é…ç½®è°ƒæ•´


**ğŸ”§ æŸ¥çœ‹å½“å‰æ°´ä½çº¿è®¾ç½®**
```bash
GET _cluster/settings?include_defaults&filter_path=**.watermark.*
```

**âš™ï¸ è°ƒæ•´æ°´ä½çº¿é˜ˆå€¼**
```json
PUT _cluster/settings
{
  "persistent": {
    "cluster.routing.allocation.disk.watermark.low": "20%",
    "cluster.routing.allocation.disk.watermark.high": "15%", 
    "cluster.routing.allocation.disk.watermark.flood_stage": "10%"
  }
}
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> è°ƒæ•´æ°´ä½çº¿åªæ˜¯ä¸´æ—¶æªæ–½ï¼Œæ ¹æœ¬è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è¦å¢åŠ ç£ç›˜ç©ºé—´æˆ–æ¸…ç†æ•°æ®

### 2.3 è§£é™¤åªè¯»çŠ¶æ€


**ğŸ”“ æ‰¹é‡è§£é™¤ç´¢å¼•åªè¯»**
```bash
# è§£é™¤æ‰€æœ‰ç´¢å¼•çš„åªè¯»çŠ¶æ€
PUT _all/_settings
{
  "index.blocks.read_only_allow_delete": null
}

# è§£é™¤ç‰¹å®šç´¢å¼•çš„åªè¯»çŠ¶æ€  
PUT /my_index/_settings
{
  "index.blocks.read_only_allow_delete": null
}
```

---

## 3. âš¡ ç£ç›˜I/Oæ€§èƒ½ç“¶é¢ˆ


### 3.1 I/Oç“¶é¢ˆè¯†åˆ«


> ğŸ’­ **ç®€å•ç†è§£**  
> I/Oç“¶é¢ˆå°±åƒå•è½¦é“å µè½¦ï¼Œæ•°æ®è¯»å†™æ’é˜Ÿç­‰å¾…ï¼Œå¯¼è‡´Elasticsearchå“åº”å˜æ…¢

**ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```bash
# æŸ¥çœ‹èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯
GET _nodes/stats?filter_path=nodes.*.fs,nodes.*.indices.store

# ç›‘æ§å…³é”®æŒ‡æ ‡
- io_stats.total.operationsï¼šI/Oæ“ä½œæ¬¡æ•°
- io_stats.total.read_timeï¼šè¯»å–è€—æ—¶
- io_stats.total.write_timeï¼šå†™å…¥è€—æ—¶
```

### 3.2 I/Oä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ ç¡¬ä»¶å±‚é¢ä¼˜åŒ–**
```
å­˜å‚¨ç±»å‹é€‰æ‹©ï¼š
âœ… SSDå›ºæ€ç¡¬ç›˜ï¼šéšæœºè¯»å†™æ€§èƒ½ä¼˜ç§€
âŒ æœºæ¢°ç¡¬ç›˜ï¼šé¡ºåºè¯»å†™å¯ä»¥ï¼Œéšæœºè®¿é—®æ…¢

RAIDé…ç½®ï¼š
âœ… RAID 0ï¼šæ€§èƒ½æœ€ä½³ï¼Œä½†æ— å®¹é”™
âœ… RAID 10ï¼šæ€§èƒ½å’Œå®‰å…¨çš„å¹³è¡¡
âŒ RAID 5/6ï¼šå†™å…¥æ€§èƒ½è¾ƒå·®
```

**ğŸ”¸ ESé…ç½®ä¼˜åŒ–**
```json
# ä¼˜åŒ–ç´¢å¼•è®¾ç½®
PUT /my_index/_settings
{
  "index": {
    "refresh_interval": "30s",
    "number_of_replicas": 0,
    "translog.durability": "async",
    "translog.sync_interval": "30s"
  }
}
```

**ğŸ’¡ é…ç½®è§£é‡Š**
- `refresh_interval`: å»¶é•¿åˆ·æ–°é—´éš”ï¼Œå‡å°‘I/O
- `translog.durability`: å¼‚æ­¥å†™å…¥ï¼Œæå‡æ€§èƒ½
- `number_of_replicas`: ä¸´æ—¶å‡å°‘å‰¯æœ¬ï¼Œé™ä½å†™å…¥å‹åŠ›

### 3.3 æ‰¹é‡æ“ä½œä¼˜åŒ–


**ğŸ“¦ ä½¿ç”¨Bulk APIå‡å°‘I/O**
```json
POST _bulk
{ "index": { "_index": "my_index" } }
{ "field1": "value1", "timestamp": "2024-09-21" }
{ "index": { "_index": "my_index" } }
{ "field1": "value2", "timestamp": "2024-09-21" }
```

> ğŸ¯ **æœ€ä½³å®è·µ**  
> å•æ¬¡bulkæ“ä½œå»ºè®®5-10MBæ•°æ®é‡ï¼Œæ—¢ä¿è¯æ•ˆç‡åˆé¿å…å†…å­˜å‹åŠ›

---

## 4. ğŸ”’ å­˜å‚¨è·¯å¾„æƒé™é—®é¢˜


### 4.1 æƒé™é—®é¢˜è¯Šæ–­


**ğŸ” å¸¸è§æƒé™é”™è¯¯**
```
é”™è¯¯ä¿¡æ¯ç¤ºä¾‹ï¼š
- "Permission denied"
- "Access denied to path [/var/lib/elasticsearch]"
- "Cannot create directory"

æ£€æŸ¥æ–¹æ³•ï¼š
ls -la /var/lib/elasticsearch/
ps aux | grep elasticsearch
```

### 4.2 æƒé™ä¿®å¤æ–¹æ¡ˆ


**ğŸ› ï¸ Linuxæƒé™ä¿®å¤**
```bash
# 1. ç¡®è®¤elasticsearchç”¨æˆ·
id elasticsearch

# 2. ä¿®æ­£æ•°æ®ç›®å½•æƒé™
sudo chown -R elasticsearch:elasticsearch /var/lib/elasticsearch/
sudo chmod -R 755 /var/lib/elasticsearch/

# 3. ä¿®æ­£æ—¥å¿—ç›®å½•æƒé™
sudo chown -R elasticsearch:elasticsearch /var/log/elasticsearch/
sudo chmod -R 755 /var/log/elasticsearch/
```

### 4.3 Dockerç¯å¢ƒæƒé™


**ğŸ³ Dockeræƒé™é…ç½®**
```yaml
version: '3'
services:
  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - ./data:/usr/share/elasticsearch/data
    user: "1000:1000"  # æŒ‡å®šç”¨æˆ·ID
```

> ğŸ’¡ **Dockeræç¤º**  
> Dockerç¯å¢ƒä¸‹è¦ç‰¹åˆ«æ³¨æ„å®¿ä¸»æœºå’Œå®¹å™¨å†…çš„ç”¨æˆ·IDæ˜ å°„å…³ç³»

---

## 5. ğŸ’¥ ç£ç›˜æ•…éšœä¸æ•°æ®ä¸¢å¤±


### 5.1 ç£ç›˜æ•…éšœè¯†åˆ«


**âš ï¸ æ•…éšœé¢„è­¦ä¿¡å·**
```
ç¡¬ä»¶å±‚é¢ï¼š
- ç£ç›˜å‘å‡ºå¼‚å¸¸å™ªéŸ³
- ç³»ç»Ÿæ—¥å¿—å‡ºç°I/Oé”™è¯¯
- ç£ç›˜å“åº”æ—¶é—´å¼‚å¸¸å¢åŠ 

ESå±‚é¢è¡¨ç°ï¼š
- åˆ†ç‰‡çŠ¶æ€å˜ä¸ºUNASSIGNED
- é›†ç¾¤å¥åº·çŠ¶æ€å˜çº¢
- æ•°æ®æŸ¥è¯¢å‡ºç°å¼‚å¸¸
```

### 5.2 æ•°æ®æ¢å¤ç­–ç•¥


**ğŸ”„ åˆ†ç‰‡æ¢å¤æµç¨‹**

```
æ•…éšœæ¢å¤æ­¥éª¤ï¼š
èŠ‚ç‚¹æ•…éšœ â¡ï¸ åˆ†ç‰‡æ ‡è®°ä¸ºæœªåˆ†é… â¡ï¸ è‡ªåŠ¨é‡æ–°åˆ†é… â¡ï¸ æ•°æ®æ¢å¤

è‡ªåŠ¨æ¢å¤æ¡ä»¶ï¼š
âœ… æœ‰å‰¯æœ¬åˆ†ç‰‡å­˜åœ¨
âœ… å…¶ä»–èŠ‚ç‚¹æœ‰è¶³å¤Ÿç©ºé—´
âœ… æ»¡è¶³åˆ†é…è§„åˆ™
```

**ğŸ› ï¸ æ‰‹åŠ¨åˆ†ç‰‡åˆ†é…**
```json
POST _cluster/reroute
{
  "commands": [
    {
      "allocate_primary": {
        "index": "my_index",
        "shard": 0,
        "node": "node-2",
        "accept_data_loss": true
      }
    }
  ]
}
```

> âš ï¸ **é‡è¦è­¦å‘Š**  
> `accept_data_loss: true`å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œåªåœ¨ç¡®è®¤æ— å…¶ä»–é€‰æ‹©æ—¶ä½¿ç”¨

### 5.3 é¢„é˜²æªæ–½


**ğŸ›¡ï¸ æ•°æ®ä¿æŠ¤ç­–ç•¥**
```
å¤šé‡ä¿æŠ¤æœºåˆ¶ï¼š

ğŸ”¸ å‰¯æœ¬ç­–ç•¥
- è‡³å°‘è®¾ç½®1ä¸ªå‰¯æœ¬
- å‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹
- å…³é”®æ•°æ®å¯è®¾ç½®2ä¸ªå‰¯æœ¬

ğŸ”¸ è·¨æœºæ¶éƒ¨ç½²
- ä½¿ç”¨rack awareness
- é¿å…å•ç‚¹æ•…éšœå½±å“
- æé«˜å®¹ç¾èƒ½åŠ›

ğŸ”¸ å®šæœŸå¤‡ä»½
- è®¾ç½®è‡ªåŠ¨å¿«ç…§
- å¼‚åœ°å¤‡ä»½å­˜å‚¨
- æµ‹è¯•æ¢å¤æµç¨‹
```

---

## 6. ğŸ“¸ å¿«ç…§å¤‡ä»½å¤±è´¥é—®é¢˜


### 6.1 å¿«ç…§æœºåˆ¶è¯¦è§£


> ğŸ“– **å¿«ç…§åŸç†**  
> å¿«ç…§å°±åƒç»™æ•´ä¸ªæ•°æ®åº“æ‹ç…§ç‰‡ï¼Œè®°å½•æŸä¸ªæ—¶åˆ»çš„å®Œæ•´çŠ¶æ€ï¼Œå¯ä»¥éšæ—¶æ¢å¤åˆ°è¿™ä¸ªçŠ¶æ€

**ğŸ”¸ å¿«ç…§ç±»å‹å¯¹æ¯”**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å¿«ç…§ç±»å‹     â”‚     å­˜å‚¨ä½ç½®     â”‚     é€‚ç”¨åœºæ™¯     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–‡ä»¶ç³»ç»Ÿå¿«ç…§     â”‚   æœ¬åœ°ç£ç›˜       â”‚   æµ‹è¯•ç¯å¢ƒ       â”‚
â”‚ S3å¿«ç…§         â”‚   AWS S3        â”‚   ç”Ÿäº§ç¯å¢ƒ       â”‚
â”‚ Azureå¿«ç…§      â”‚   Azureå­˜å‚¨      â”‚   äº‘ç¯å¢ƒ         â”‚
â”‚ GCSå¿«ç…§        â”‚   Googleäº‘å­˜å‚¨   â”‚   Googleäº‘       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å¿«ç…§ä»“åº“é…ç½®


**ğŸ“ æ–‡ä»¶ç³»ç»Ÿä»“åº“è®¾ç½®**
```json
PUT _snapshot/my_backup
{
  "type": "fs",
  "settings": {
    "location": "/mount/backups/elasticsearch",
    "compress": true,
    "chunk_size": "64mb"
  }
}
```

**â˜ï¸ S3ä»“åº“è®¾ç½®**
```json
PUT _snapshot/s3_backup  
{
  "type": "s3",
  "settings": {
    "bucket": "my-elasticsearch-backups",
    "region": "us-east-1",
    "compress": true,
    "storage_class": "standard_ia"
  }
}
```

### 6.3 å¿«ç…§å¤±è´¥å¸¸è§åŸå› 


**âŒ æƒé™é—®é¢˜è§£å†³**
```bash
# æ£€æŸ¥å¤‡ä»½ç›®å½•æƒé™
ls -la /mount/backups/
sudo chown -R elasticsearch:elasticsearch /mount/backups/

# æ£€æŸ¥S3æƒé™ï¼ˆéœ€è¦ä»¥ä¸‹æƒé™ï¼‰
- s3:ListBucket
- s3:GetObject  
- s3:PutObject
- s3:DeleteObject
```

**ğŸ’¾ ç©ºé—´ä¸è¶³è§£å†³**
```bash
# æ£€æŸ¥å¤‡ä»½å­˜å‚¨ç©ºé—´
df -h /mount/backups/

# æ¸…ç†æ—§å¿«ç…§é‡Šæ”¾ç©ºé—´
DELETE _snapshot/my_backup/snapshot_2024_01_01
```

### 6.4 è‡ªåŠ¨å¿«ç…§ç­–ç•¥


**â° è®¾ç½®å¿«ç…§ç”Ÿå‘½å‘¨æœŸç®¡ç†**
```json
PUT _slm/policy/daily_snapshots
{
  "schedule": "0 1 * * *",
  "name": "<daily-snap-{now/d}>",
  "repository": "my_backup",
  "config": {
    "indices": ["logs-*", "metrics-*"],
    "ignore_unavailable": true
  },
  "retention": {
    "expire_after": "30d",
    "min_count": 5,
    "max_count": 50
  }
}
```

**ğŸ’¡ ç­–ç•¥è§£é‡Š**
- `schedule`: æ¯å¤©å‡Œæ™¨1ç‚¹æ‰§è¡Œ
- `retention`: ä¿ç•™30å¤©ï¼Œæœ€å°‘5ä¸ªï¼Œæœ€å¤š50ä¸ª
- `ignore_unavailable`: å¿½ç•¥ä¸å­˜åœ¨çš„ç´¢å¼•

---

## 7. ğŸ”§ ç´¢å¼•æ®µæ–‡ä»¶æŸåå¤„ç†


### 7.1 æ®µæ–‡ä»¶æŸåè¯†åˆ«


> ğŸ’­ **æ®µæ–‡ä»¶ç†è§£**  
> æ®µæ–‡ä»¶æ˜¯Elasticsearchå­˜å‚¨æ•°æ®çš„æœ€å°å•ä½ï¼Œå°±åƒä¹¦çš„ç« èŠ‚ï¼Œæ¯ä¸ªæ®µåŒ…å«ä¸€éƒ¨åˆ†æ•°æ®

**ğŸ” æŸåç—‡çŠ¶æ£€æµ‹**
```bash
# æ£€æŸ¥åˆ†ç‰‡å¥åº·çŠ¶æ€
GET _cat/shards?v&h=index,shard,prirep,state,unassigned.reason

# æŸ¥çœ‹é›†ç¾¤å¥åº·è¯¦æƒ…
GET _cluster/health?level=shards

# æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
GET _nodes/stats?filter_path=nodes.*.indices.store
```

### 7.2 æ®µæ–‡ä»¶ä¿®å¤


**ğŸ› ï¸ æ£€æŸ¥å¹¶ä¿®å¤æŸåæ®µ**
```bash
# å…³é—­å—å½±å“çš„ç´¢å¼•
POST /damaged_index/_close

# æ‰§è¡Œæ®µæ–‡ä»¶æ£€æŸ¥
POST /damaged_index/_forcemerge?only_expunge_deletes=true

# é‡æ–°æ‰“å¼€ç´¢å¼•
POST /damaged_index/_open
```

**ğŸ”„ ä»å‰¯æœ¬æ¢å¤**
```json
# å¦‚æœä¸»åˆ†ç‰‡æŸåï¼Œä»å‰¯æœ¬æ¢å¤
POST _cluster/reroute
{
  "commands": [
    {
      "allocate_primary": {
        "index": "damaged_index",
        "shard": 0,
        "node": "node_with_good_replica"
      }
    }
  ]
}
```

### 7.3 é¢„é˜²æ®µæ–‡ä»¶æŸå


**ğŸ›¡ï¸ é¢„é˜²æªæ–½**
```
ç¡¬ä»¶å±‚é¢ï¼š
âœ… ä½¿ç”¨ECCå†…å­˜
âœ… å¯é çš„å­˜å‚¨è®¾å¤‡
âœ… UPSä¸é—´æ–­ç”µæº

è½¯ä»¶å±‚é¢ï¼š
âœ… å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·
âœ… è®¾ç½®é€‚å½“çš„å‰¯æœ¬æ•°
âœ… ä½¿ç”¨å¿«ç…§å¤‡ä»½
```

---

## 8. ğŸ“‹ æ—¥å¿—æ–‡ä»¶è¿‡å¤§é—®é¢˜


### 8.1 æ—¥å¿—ç±»å‹ä¸ä½ç½®


**ğŸ“‚ ESæ—¥å¿—æ–‡ä»¶åˆ†ç±»**
```
æ—¥å¿—æ–‡ä»¶ç»“æ„ï¼š
/var/log/elasticsearch/
â”œâ”€â”€ elasticsearch.log          # ä¸»æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ elasticsearch_deprecation.log   # åºŸå¼ƒè­¦å‘Š
â”œâ”€â”€ elasticsearch_index_*.log       # æ…¢æŸ¥è¯¢æ—¥å¿—
â”œâ”€â”€ elasticsearch_search_*.log      # æ…¢æœç´¢æ—¥å¿—  
â””â”€â”€ gc.log                         # GCæ—¥å¿—
```

### 8.2 æ—¥å¿—çº§åˆ«é…ç½®


**âš™ï¸ è°ƒæ•´æ—¥å¿—çº§åˆ«**
```yaml
# log4j2.propertiesé…ç½®
logger.org.elasticsearch.level = WARN
logger.action.level = INFO
logger.com.amazonaws.level = WARN

# åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«
PUT _cluster/settings
{
  "persistent": {
    "logger.org.elasticsearch": "WARN"
  }
}
```

### 8.3 æ—¥å¿—è½®è½¬é…ç½®


**ğŸ”„ æ—¥å¿—è½®è½¬ç­–ç•¥**
```xml
<!-- log4j2.propertiesä¸­é…ç½® -->
<RollingFile name="rolling" fileName="${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}.log"
    filePattern="${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}-%d{yyyy-MM-dd}-%i.log.gz">
  <PatternLayout pattern="[%d{ISO8601}][%-5p][%-25c{1.}] [%node_name]%marker %m%n"/>
  <Policies>
    <TimeBasedTriggeringPolicy />
    <SizeBasedTriggeringPolicy size="128MB"/>
  </Policies>
  <DefaultRolloverStrategy max="30"/>
</RollingFile>
```

### 8.4 æ—¥å¿—æ¸…ç†è‡ªåŠ¨åŒ–


**ğŸ§¹ è‡ªåŠ¨æ¸…ç†è„šæœ¬**
```bash
#!/bin/bash
# elasticsearch_log_cleanup.sh

LOG_DIR="/var/log/elasticsearch"
RETENTION_DAYS=7

# åˆ é™¤7å¤©å‰çš„æ—¥å¿—æ–‡ä»¶
find $LOG_DIR -name "*.log.*" -mtime +$RETENTION_DAYS -delete

# åˆ é™¤å‹ç¼©çš„æ—§æ—¥å¿—
find $LOG_DIR -name "*.gz" -mtime +$RETENTION_DAYS -delete

echo "æ—¥å¿—æ¸…ç†å®Œæˆï¼š$(date)"
```

**â° å®šæ—¶ä»»åŠ¡è®¾ç½®**
```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯å¤©å‡Œæ™¨æ‰§è¡Œ
0 2 * * * /path/to/elasticsearch_log_cleanup.sh
```

---

## 9. ğŸ“Š é¢„é˜²ä¸ç›‘æ§ç­–ç•¥


### 9.1 ç£ç›˜ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**
```
ç£ç›˜ç©ºé—´æŒ‡æ ‡ï¼š
- ç£ç›˜ä½¿ç”¨ç‡ï¼ˆå»ºè®®<80%ï¼‰
- å¯ç”¨ç©ºé—´å¤§å°
- ç£ç›˜å¢é•¿è¶‹åŠ¿

æ€§èƒ½æŒ‡æ ‡ï¼š
- ç£ç›˜I/Oå»¶è¿Ÿ
- è¯»å†™ååé‡  
- é˜Ÿåˆ—æ·±åº¦

ESç›¸å…³æŒ‡æ ‡ï¼š
- ç´¢å¼•å¤§å°å¢é•¿
- åˆ†ç‰‡åˆ†å¸ƒæƒ…å†µ
- æ®µåˆå¹¶é¢‘ç‡
```

### 9.2 å‘Šè­¦è§„åˆ™è®¾ç½®


**âš ï¸ ç£ç›˜ç©ºé—´å‘Šè­¦**
```yaml
# Prometheuså‘Šè­¦è§„åˆ™ç¤ºä¾‹
groups:
- name: elasticsearch_disk
  rules:
  - alert: DiskSpaceHigh
    expr: elasticsearch_filesystem_data_available_bytes / elasticsearch_filesystem_data_size_bytes < 0.2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "ESèŠ‚ç‚¹ç£ç›˜ç©ºé—´ä¸è¶³"

  - alert: DiskSpaceCritical  
    expr: elasticsearch_filesystem_data_available_bytes / elasticsearch_filesystem_data_size_bytes < 0.1
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "ESèŠ‚ç‚¹ç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³"
```

### 9.3 å®¹é‡è§„åˆ’å»ºè®®


**ğŸ“Š å®¹é‡è§„åˆ’å…¬å¼**
```
æ€»å­˜å‚¨éœ€æ±‚è®¡ç®—ï¼š
åŸå§‹æ•°æ®å¤§å° Ã— (1 + å‰¯æœ¬æ•°) Ã— (1 + å¼€é”€ç‡) Ã— å¢é•¿ç³»æ•°

ç¤ºä¾‹è®¡ç®—ï¼š
- åŸå§‹æ•°æ®ï¼š100GB/å¤©
- å‰¯æœ¬æ•°ï¼š1
- å¼€é”€ç‡ï¼š0.3ï¼ˆç´¢å¼•å¼€é”€+æ®µå¼€é”€ï¼‰  
- ä¿ç•™æœŸï¼š30å¤©
- å¢é•¿ç³»æ•°ï¼š1.5

æ€»éœ€æ±‚ = 100 Ã— (1+1) Ã— (1+0.3) Ã— 30 Ã— 1.5 = 11,700GB
```

**ğŸ’¡ è§„åˆ’å»ºè®®**
- é¢„ç•™30-50%çš„ç¼“å†²ç©ºé—´
- è€ƒè™‘æ•°æ®å¢é•¿è¶‹åŠ¿
- å®šæœŸè¯„ä¼°å’Œè°ƒæ•´

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç£ç›˜æ°´ä½çº¿ï¼šä¸‰çº§ä¿æŠ¤æœºåˆ¶ï¼Œé˜²æ­¢ç£ç›˜ç©ºé—´è€—å°½
ğŸ”¸ ILMç­–ç•¥ï¼šè‡ªåŠ¨ç®¡ç†ç´¢å¼•ç”Ÿå‘½å‘¨æœŸï¼Œæ§åˆ¶æ•°æ®å¢é•¿
ğŸ”¸ å¿«ç…§å¤‡ä»½ï¼šæ•°æ®ä¿æŠ¤çš„æœ€åé˜²çº¿ï¼Œå®šæœŸå¤‡ä»½è‡³å…³é‡è¦
ğŸ”¸ æƒé™ç®¡ç†ï¼šç¡®ä¿ESè¿›ç¨‹æœ‰è¶³å¤Ÿæƒé™è®¿é—®å­˜å‚¨è·¯å¾„
ğŸ”¸ I/Oä¼˜åŒ–ï¼šç¡¬ä»¶é€‰æ‹©å’Œé…ç½®ä¼˜åŒ–å½±å“æ€§èƒ½è¡¨ç°
```

### 10.2 æ•…éšœå¤„ç†ä¼˜å…ˆçº§


**ğŸš¨ ç´§æ€¥å¤„ç†é¡ºåº**
```
1. ç«‹å³è§£é™¤åªè¯»çŠ¶æ€ï¼ˆæ¢å¤æœåŠ¡ï¼‰
2. å¿«é€Ÿé‡Šæ”¾ç£ç›˜ç©ºé—´ï¼ˆåˆ é™¤æ—§æ•°æ®ï¼‰
3. è°ƒæ•´æ°´ä½çº¿é˜ˆå€¼ï¼ˆä¸´æ—¶ç¼“è§£ï¼‰
4. è®¾ç½®ILMç­–ç•¥ï¼ˆé•¿æœŸè§£å†³ï¼‰
5. å»ºç«‹ç›‘æ§å‘Šè­¦ï¼ˆé¢„é˜²å†æ¬¡å‘ç”Ÿï¼‰
```

### 10.3 é¢„é˜²ä¸ºä¸»çš„è¿ç»´æ€è·¯


**ğŸ’¡ é¢„é˜²èƒœäºæ²»ç–—**
```
ç›‘æ§å…ˆè¡Œï¼š
- å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
- è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- å®šæœŸæ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶å†µ

è§„åˆ’ä¸ºå…ˆï¼š
- åšå¥½å®¹é‡è§„åˆ’
- è®¾ç½®æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†  
- å»ºç«‹åº”æ€¥é¢„æ¡ˆ

è‡ªåŠ¨åŒ–ç®¡ç†ï¼š
- ä½¿ç”¨ILMè‡ªåŠ¨ç®¡ç†æ•°æ®
- é…ç½®è‡ªåŠ¨å¿«ç…§å¤‡ä»½
- è„šæœ¬åŒ–æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡
```

### 10.4 å®é™…åº”ç”¨ä»·å€¼


- **ä¸šåŠ¡è¿ç»­æ€§**ï¼šå¿«é€Ÿæ¢å¤æœåŠ¡ï¼Œå‡å°‘ä¸šåŠ¡ä¸­æ–­
- **æ•°æ®å®‰å…¨æ€§**ï¼šé€šè¿‡å¤‡ä»½å’Œå‰¯æœ¬ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±
- **æˆæœ¬æ§åˆ¶**ï¼šåˆç†è§„åˆ’å­˜å‚¨èµ„æºï¼Œé¿å…æµªè´¹
- **æ€§èƒ½ä¼˜åŒ–**ï¼šI/Oä¼˜åŒ–æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦
- **è¿ç»´æ•ˆç‡**ï¼šè‡ªåŠ¨åŒ–ç®¡ç†å‡å°‘äººå·¥å¹²é¢„

**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ç›‘æ§å‘Šè­¦é˜²æœªç„¶ï¼Œå®¹é‡è§„åˆ’è¦æå‰
- æ°´ä½çº¿ä¿æŠ¤ç£ç›˜ç©ºé—´ï¼ŒILMç®¡ç†æ•°æ®ç”Ÿå‘½
- å¿«ç…§å¤‡ä»½æ˜¯ä¿éšœï¼Œæƒé™é…ç½®è¦æ­£ç¡®
- I/Oä¼˜åŒ–ææ€§èƒ½ï¼Œè‡ªåŠ¨åŒ–è¿ç»´æœ€çœå¿ƒ