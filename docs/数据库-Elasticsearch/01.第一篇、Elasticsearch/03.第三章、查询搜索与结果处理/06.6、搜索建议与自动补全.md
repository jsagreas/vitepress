---
title: 6ã€æœç´¢å»ºè®®ä¸è‡ªåŠ¨è¡¥å…¨
---
## ğŸ“š ç›®å½•

1. [æœç´¢å»ºè®®æ¦‚è¿°](#1-æœç´¢å»ºè®®æ¦‚è¿°)
2. [Termå»ºè®®-æ‹¼å†™çº é”™](#2-termå»ºè®®-æ‹¼å†™çº é”™)
3. [Phraseå»ºè®®-çŸ­è¯­çº é”™](#3-phraseå»ºè®®-çŸ­è¯­çº é”™)
4. [Completionå»ºè®®-è‡ªåŠ¨è¡¥å…¨](#4-completionå»ºè®®-è‡ªåŠ¨è¡¥å…¨)
5. [Contextå»ºè®®-ä¸Šä¸‹æ–‡è¡¥å…¨](#5-contextå»ºè®®-ä¸Šä¸‹æ–‡è¡¥å…¨)
6. [å»ºè®®å™¨é…ç½®ä¸ä¼˜åŒ–](#6-å»ºè®®å™¨é…ç½®ä¸ä¼˜åŒ–)
7. [å®é™…åº”ç”¨åœºæ™¯](#7-å®é™…åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æœç´¢å»ºè®®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æœç´¢å»ºè®®


**ç®€å•ç†è§£**ï¼šæœç´¢å»ºè®®å°±åƒæ‰‹æœºè¾“å…¥æ³•çš„æ™ºèƒ½æç¤ºåŠŸèƒ½

```
ç”¨æˆ·ä½“éªŒå¯¹æ¯”ï¼š
æ²¡æœ‰å»ºè®®ï¼šç”¨æˆ·è¾“å…¥é”™è¯¯ â†’ æ— ç»“æœ â†’ ç”¨æˆ·å›°æƒ‘
æœ‰äº†å»ºè®®ï¼šç”¨æˆ·è¾“å…¥é”™è¯¯ â†’ ç³»ç»Ÿæç¤ºæ­£ç¡®è¯ â†’ ç”¨æˆ·æ»¡æ„

å°±åƒï¼š
ç”¨æˆ·æœç´¢"è‹¹æœæ‰‹æœº" â†’ ç³»ç»Ÿå»ºè®®"iPhoneæ‰‹æœº"
ç”¨æˆ·è¾“å…¥"applr" â†’ ç³»ç»Ÿå»ºè®®"apple"
ç”¨æˆ·è¾“å…¥"æœºå™¨å­¦" â†’ ç³»ç»Ÿå»ºè®®"æœºå™¨å­¦ä¹ "
```

### 1.2 å»ºè®®ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼


ğŸ’¡ **è§£å†³çš„é—®é¢˜**ï¼š
- **æ‹¼å†™é”™è¯¯**ï¼šç”¨æˆ·æ‰“å­—æ‰“é”™äº†
- **è¯æ±‡ä¸å‡†ç¡®**ï¼šç”¨æˆ·ä¸çŸ¥é“å‡†ç¡®çš„ä¸“ä¸šæœ¯è¯­
- **è¾“å…¥æ•ˆç‡**ï¼šå‡å°‘ç”¨æˆ·è¾“å…¥æ—¶é—´
- **å‘ç°å†…å®¹**ï¼šå¸®ç”¨æˆ·æ‰¾åˆ°ä»–ä»¬å¯èƒ½æ„Ÿå…´è¶£ä½†ä¸çŸ¥é“çš„å†…å®¹

### 1.3 Elasticsearchä¸­çš„å››ç§å»ºè®®ç±»å‹


```
å»ºè®®ç±»å‹å…¨æ™¯å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             æœç´¢å»ºè®®                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Termå»ºè®®    â”‚ Phraseå»ºè®®  â”‚ Completion â”‚ Contextå»ºè®®
â”‚ (å•è¯çº é”™)  â”‚ (çŸ­è¯­çº é”™)  â”‚ (è‡ªåŠ¨è¡¥å…¨) â”‚ (ä¸Šä¸‹æ–‡è¡¥å…¨)
â”‚             â”‚             â”‚           â”‚
â”‚ applr       â”‚ machine     â”‚ æœºå™¨å­¦     â”‚ æ ¹æ®ç”¨æˆ·è¡Œä¸º
â”‚ â†“           â”‚ learn       â”‚ â†“         â”‚ å’Œä½ç½®ç­‰
â”‚ apple       â”‚ â†“           â”‚ æœºå™¨å­¦ä¹    â”‚ æ™ºèƒ½æ¨è
â”‚             â”‚ machine     â”‚ æœºå™¨å­¦é™¢   â”‚
â”‚             â”‚ learning    â”‚ æœºå™¨å­¦ç§‘   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âœï¸ Termå»ºè®®-æ‹¼å†™çº é”™


### 2.1 Termå»ºè®®çš„å·¥ä½œåŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šåŸºäºç¼–è¾‘è·ç¦»æ‰¾åˆ°æœ€ç›¸ä¼¼çš„æ­£ç¡®å•è¯

```
ç¼–è¾‘è·ç¦»ç¤ºä¾‹ï¼š
"applr" â†’ "apple"
- åˆ é™¤å­—æ¯'r'ï¼šè·ç¦»=1
- æˆ–è€…æ›¿æ¢'r'ä¸º'e'ï¼šè·ç¦»=1

"machien" â†’ "machine"  
- äº¤æ¢'i'å’Œ'e'ï¼šè·ç¦»=1
```

**ğŸ”§ ç®—æ³•æœºåˆ¶**ï¼š
- **Levenshteinè·ç¦»**ï¼šè®¡ç®—ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„æœ€å°ç¼–è¾‘æ¬¡æ•°
- **æ¨¡ç³ŠåŒ¹é…**ï¼šåœ¨æŒ‡å®šè·ç¦»å†…å¯»æ‰¾ç›¸ä¼¼è¯
- **é¢‘ç‡æƒé‡**ï¼šä¼˜å…ˆæ¨èå‡ºç°é¢‘ç‡é«˜çš„è¯

### 2.2 åŸºç¡€Termå»ºè®®ä½¿ç”¨


```json
{
  "suggest": {
    "product_suggest": {
      "text": "applr phone",
      "term": {
        "field": "product_name"
      }
    }
  }
}
```

**å‚æ•°è¯´æ˜**ï¼š
- `text`ï¼šç”¨æˆ·è¾“å…¥çš„åŸå§‹æ–‡æœ¬
- `field`ï¼šå»ºè®®æœç´¢çš„å­—æ®µ
- ç³»ç»Ÿä¼šå¯¹"applr"å’Œ"phone"åˆ†åˆ«ç»™å‡ºå»ºè®®

### 2.3 Termå»ºè®®é«˜çº§é…ç½®


```json
{
  "suggest": {
    "my_suggestion": {
      "text": "applr",
      "term": {
        "field": "product_name",
        "size": 3,                    // ğŸ”¸ æœ€å¤šè¿”å›3ä¸ªå»ºè®®
        "max_edits": 2,              // ğŸ”¸ æœ€å¤§ç¼–è¾‘è·ç¦»
        "min_word_length": 3,        // ğŸ”¸ æœ€çŸ­å»ºè®®è¯é•¿åº¦
        "prefix_length": 1,          // ğŸ”¸ å‰ç¼€å¿…é¡»åŒ¹é…çš„é•¿åº¦
        "min_doc_freq": 1,           // ğŸ”¸ æœ€å°æ–‡æ¡£é¢‘ç‡
        "max_term_freq": 0.01        // ğŸ”¸ æœ€å¤§è¯é¢‘é˜ˆå€¼
      }
    }
  }
}
```

**é…ç½®å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | **ä½œç”¨** | **å»ºè®®å€¼** | **è¯´æ˜** |
|------|---------|-----------|----------|
| `size` | `é™åˆ¶å»ºè®®æ•°é‡` | `3-5` | `å¤ªå¤šä¼šå›°æ‰°ç”¨æˆ·` |
| `max_edits` | `ç¼–è¾‘è·ç¦»é™åˆ¶` | `1-2` | `è·ç¦»å¤ªå¤§å»ºè®®è´¨é‡å·®` |
| `min_word_length` | `æœ€çŸ­è¯é•¿` | `3-4` | `é¿å…å¯¹çŸ­è¯å»ºè®®` |
| `prefix_length` | `å‰ç¼€åŒ¹é…` | `1-2` | `æé«˜å»ºè®®å‡†ç¡®æ€§` |

### 2.4 å®é™…åº”ç”¨ç¤ºä¾‹


**åœºæ™¯**ï¼šç”µå•†ç½‘ç«™å•†å“æœç´¢

```json
// ç”¨æˆ·è¾“å…¥ï¼šipon 13
{
  "suggest": {
    "product_suggest": {
      "text": "ipon 13",
      "term": {
        "field": "product_name",
        "size": 3,
        "max_edits": 1
      }
    }
  }
}

// è¿”å›ç»“æœç¤ºä¾‹ï¼š
{
  "suggest": {
    "product_suggest": [
      {
        "text": "ipon",
        "options": [
          {"text": "iphone", "score": 0.8, "freq": 1500},
          {"text": "ipod", "score": 0.6, "freq": 200}
        ]
      }
    ]
  }
}
```

---

## 3. ğŸ“ Phraseå»ºè®®-çŸ­è¯­çº é”™


### 3.1 Phraseå»ºè®®vs Termå»ºè®®


**æ ¸å¿ƒåŒºåˆ«**ï¼š

```
Termå»ºè®®ï¼šé€ä¸ªå•è¯çº é”™
"machine learn" â†’ ["machine", "learning"] (åˆ†åˆ«çº é”™)

Phraseå»ºè®®ï¼šæ•´ä¸ªçŸ­è¯­çº é”™  
"machine learn" â†’ "machine learning" (æ•´ä½“çº é”™)
```

**ä¼˜åŠ¿å¯¹æ¯”**ï¼š
- âœ… **è¯­ä¹‰è¿è´¯**ï¼šä¿æŒçŸ­è¯­çš„å®Œæ•´å«ä¹‰
- âœ… **ä¸Šä¸‹æ–‡ç†è§£**ï¼šè€ƒè™‘è¯ä¸è¯ä¹‹é—´çš„å…³ç³»
- âœ… **è‡ªç„¶è¯­è¨€**ï¼šç»“æœæ›´ç¬¦åˆè‡ªç„¶è¡¨è¾¾ä¹ æƒ¯

### 3.2 åŸºç¡€Phraseå»ºè®®


```json
{
  "suggest": {
    "article_suggest": {
      "text": "machine learn algorithm",
      "phrase": {
        "field": "content",
        "size": 2
      }
    }
  }
}
```

### 3.3 Phraseå»ºè®®é«˜çº§é…ç½®


```json
{
  "suggest": {
    "smart_phrase": {
      "text": "data scince tutorial",
      "phrase": {
        "field": "title",
        "size": 3,
        "real_word_error_likelihood": 0.95,  // ğŸ”¸ çœŸå®å•è¯é”™è¯¯æ¦‚ç‡
        "max_errors": 2,                     // ğŸ”¸ æœ€å¤§é”™è¯¯æ•°
        "gram_size": 3,                      // ğŸ”¸ N-gramå¤§å°
        "direct_generator": [
          {
            "field": "title",
            "suggest_mode": "always",        // ğŸ”¸ å»ºè®®æ¨¡å¼
            "min_word_length": 3,
            "prefix_length": 1
          }
        ]
      }
    }
  }
}
```

**å…³é”®å‚æ•°è¯´æ˜**ï¼š

ğŸ’¡ **real_word_error_likelihood**ï¼ˆçœŸå®å•è¯é”™è¯¯æ¦‚ç‡ï¼‰
```
è®¾ç½®ä¸º0.95æ„æ€æ˜¯ï¼š
å³ä½¿"data"æ˜¯ä¸€ä¸ªæ­£ç¡®çš„å•è¯ï¼Œ
ä½†åœ¨"data scince"è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ
æœ‰95%å¯èƒ½å®ƒå®é™…æƒ³è¡¨è¾¾çš„æ˜¯"data science"
```

ğŸ’¡ **gram_size**ï¼ˆN-gramå¤§å°ï¼‰
```
gram_size=2ï¼šè€ƒè™‘2ä¸ªè¯çš„ç»„åˆ
"machine learning" â†’ åˆ†æ["machine", "learning"]

gram_size=3ï¼šè€ƒè™‘3ä¸ªè¯çš„ç»„åˆ  
"machine learning algorithm" â†’ åˆ†æ["machine learning", "learning algorithm"]
```

### 3.4 å®ç”¨é…ç½®å»ºè®®


```json
// ğŸ¯ ç”µå•†æœç´¢ä¼˜åŒ–é…ç½®
{
  "suggest": {
    "product_phrase": {
      "text": "iphone 13 prom max",
      "phrase": {
        "field": "product_title",
        "size": 5,
        "confidence": 1.0,              // ğŸ”¸ ç½®ä¿¡åº¦é˜ˆå€¼
        "max_errors": 1,
        "real_word_error_likelihood": 0.9,
        "highlight": {                  // ğŸ”¸ é«˜äº®é…ç½®
          "pre_tag": "<em>",
          "post_tag": "</em>"
        }
      }
    }
  }
}
```

---

## 4. ğŸš€ Completionå»ºè®®-è‡ªåŠ¨è¡¥å…¨


### 4.1 Completionå»ºè®®çš„ç‰¹ç‚¹


**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âš¡ **æå¿«é€Ÿåº¦**ï¼šä¸“é—¨ä¸ºè‡ªåŠ¨è¡¥å…¨ä¼˜åŒ–çš„æ•°æ®ç»“æ„
- ğŸ¯ **å‰ç¼€åŒ¹é…**ï¼šç”¨æˆ·è¾“å…¥ä¸€éƒ¨åˆ†ï¼Œç«‹å³ç»™å‡ºå®Œæ•´å»ºè®®
- ğŸ“Š **æ”¯æŒæƒé‡**ï¼šå¯ä»¥æ§åˆ¶å»ºè®®çš„ä¼˜å…ˆçº§

**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š
```
æœç´¢æ¡†è¾“å…¥ä½“éªŒï¼š
ç”¨æˆ·è¾“å…¥"æœºå™¨" â†’ ç«‹å³æ˜¾ç¤ºï¼š
- æœºå™¨å­¦ä¹ 
- æœºå™¨äºº
- æœºå™¨è§†è§‰
- æœºå™¨ç¿»è¯‘

VS ä¼ ç»Ÿæœç´¢ï¼š
ç”¨æˆ·è¾“å…¥"æœºå™¨" â†’ æŒ‰å›è½¦ â†’ ç­‰å¾…ç»“æœ â†’ æŸ¥çœ‹ç»“æœ
```

### 4.2 Completionå­—æ®µé…ç½®


**ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåŒ…å«completionå­—æ®µçš„ç´¢å¼•**

```json
PUT /product_index
{
  "mappings": {
    "properties": {
      "product_name": {"type": "text"},
      "suggest": {                    // ğŸ”¸ ä¸“é—¨çš„completionå­—æ®µ
        "type": "completion",
        "analyzer": "simple",
        "preserve_separators": true,
        "preserve_position_increments": true,
        "max_input_length": 50
      }
    }
  }
}
```

**ç¬¬äºŒæ­¥ï¼šç´¢å¼•æ•°æ®æ—¶åŒ…å«å»ºè®®å†…å®¹**

```json
PUT /product_index/_doc/1
{
  "product_name": "iPhone 13 Pro Max",
  "suggest": {
    "input": [                        // ğŸ”¸ å¤šç§è¾“å…¥æ–¹å¼
      "iPhone 13 Pro Max",
      "è‹¹æœæ‰‹æœº",
      "iPhone",
      "13 Pro Max"
    ],
    "weight": 100                     // ğŸ”¸ æƒé‡è¶Šé«˜ä¼˜å…ˆçº§è¶Šé«˜
  }
}

PUT /product_index/_doc/2  
{
  "product_name": "iPhone 13 Mini",
  "suggest": {
    "input": ["iPhone 13 Mini", "è‹¹æœè¿·ä½ ", "Mini"],
    "weight": 80
  }
}
```

### 4.3 åŸºç¡€è‡ªåŠ¨è¡¥å…¨æŸ¥è¯¢


```json
POST /product_index/_search
{
  "suggest": {
    "product_completion": {
      "prefix": "iph",               // ğŸ”¸ ç”¨æˆ·è¾“å…¥çš„å‰ç¼€
      "completion": {
        "field": "suggest",
        "size": 5
      }
    }
  }
}
```

**è¿”å›ç»“æœç¤ºä¾‹**ï¼š
```json
{
  "suggest": {
    "product_completion": [
      {
        "text": "iph",
        "options": [
          {
            "text": "iPhone 13 Pro Max",
            "_score": 100.0,
            "_source": {
              "product_name": "iPhone 13 Pro Max"
            }
          },
          {
            "text": "iPhone 13 Mini", 
            "_score": 80.0,
            "_source": {
              "product_name": "iPhone 13 Mini"
            }
          }
        ]
      }
    ]
  }
}
```

### 4.4 é«˜çº§è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½


**æ¨¡ç³ŠåŒ¹é…è‡ªåŠ¨è¡¥å…¨**ï¼š

```json
{
  "suggest": {
    "fuzzy_completion": {
      "prefix": "iphon",             // ğŸ”¸ ç”¨æˆ·æ‹¼å†™é”™è¯¯
      "completion": {
        "field": "suggest",
        "size": 3,
        "fuzzy": {                   // ğŸ”¸ å¯ç”¨æ¨¡ç³ŠåŒ¹é…
          "fuzziness": 1,            // å…è®¸1ä¸ªå­—ç¬¦é”™è¯¯
          "transpositions": true,    // å…è®¸å­—ç¬¦ä½ç½®äº¤æ¢
          "min_length": 3,           // æœ€å°é•¿åº¦æ‰å¯ç”¨æ¨¡ç³Š
          "prefix_length": 1         // å‰ç¼€ç²¾ç¡®åŒ¹é…é•¿åº¦
        }
      }
    }
  }
}
```

**æ­£åˆ™è¡¨è¾¾å¼è¡¥å…¨**ï¼š

```json
{
  "suggest": {
    "regex_completion": {
      "regex": "ip[ho]*",           // ğŸ”¸ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
      "completion": {
        "field": "suggest",
        "size": 5
      }
    }
  }
}
```

### 4.5 å®é™…å‰ç«¯é›†æˆç¤ºä¾‹


**JavaScriptå®ç°å®æ—¶æœç´¢å»ºè®®**ï¼š

```javascript
// ğŸ¯ å®æ—¶æœç´¢å»ºè®®å®ç°
class SearchSuggestion {
  constructor(elasticsearchUrl) {
    this.esUrl = elasticsearchUrl;
    this.debounceTimer = null;
  }
  
  // é˜²æŠ–å¤„ç†ç”¨æˆ·è¾“å…¥
  onUserInput(inputValue) {
    clearTimeout(this.debounceTimer);
    this.debounceTimer = setTimeout(() => {
      this.getSuggestions(inputValue);
    }, 300); // 300mså»¶è¿Ÿ
  }
  
  // è·å–å»ºè®®
  async getSuggestions(prefix) {
    if (prefix.length < 2) return; // å¤ªçŸ­ä¸æŸ¥è¯¢
    
    const query = {
      suggest: {
        product_suggest: {
          prefix: prefix,
          completion: {
            field: "suggest",
            size: 5
          }
        }
      }
    };
    
    const response = await fetch(`${this.esUrl}/products/_search`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(query)
    });
    
    const result = await response.json();
    this.displaySuggestions(result.suggest.product_suggest[0].options);
  }
  
  // æ˜¾ç¤ºå»ºè®®
  displaySuggestions(suggestions) {
    const suggestionList = document.getElementById('suggestions');
    suggestionList.innerHTML = suggestions.map(item => 
      `<li onclick="selectSuggestion('${item.text}')">${item.text}</li>`
    ).join('');
  }
}
```

---

## 5. ğŸ¯ Contextå»ºè®®-ä¸Šä¸‹æ–‡è¡¥å…¨


### 5.1 Contextå»ºè®®çš„é«˜çº§ç‰¹æ€§


**ä»€ä¹ˆæ˜¯Contextå»ºè®®**ï¼š
```
æ™®é€šè¡¥å…¨ï¼šç”¨æˆ·è¾“å…¥"å’–å•¡" â†’ å»ºè®®æ‰€æœ‰å’–å•¡ç›¸å…³
Contextè¡¥å…¨ï¼š
- åœ¨"æ˜Ÿå·´å…‹"ä¸Šä¸‹æ–‡ä¸­ï¼Œè¾“å…¥"å’–å•¡" â†’ å»ºè®®"æ˜Ÿå·´å…‹æ‹¿é“"
- åœ¨"å®¶ç”¨"ä¸Šä¸‹æ–‡ä¸­ï¼Œè¾“å…¥"å’–å•¡" â†’ å»ºè®®"å’–å•¡æœº"
- åœ¨"ä¸‹åˆèŒ¶"ä¸Šä¸‹æ–‡ä¸­ï¼Œè¾“å…¥"å’–å•¡" â†’ å»ºè®®"å’–å•¡è›‹ç³•"
```

### 5.2 Contextå­—æ®µé…ç½®


```json
PUT /restaurant_index
{
  "mappings": {
    "properties": {
      "name": {"type": "text"},
      "suggest": {
        "type": "completion",
        "contexts": [                     // ğŸ”¸ å®šä¹‰ä¸Šä¸‹æ–‡
          {
            "name": "location",           // ä½ç½®ä¸Šä¸‹æ–‡
            "type": "geo",
            "precision": "5km"
          },
          {
            "name": "category",           // åˆ†ç±»ä¸Šä¸‹æ–‡
            "type": "category"
          },
          {
            "name": "price_range",        // ä»·æ ¼åŒºé—´ä¸Šä¸‹æ–‡
            "type": "category"
          }
        ]
      }
    }
  }
}
```

### 5.3 å¸¦Contextçš„æ•°æ®ç´¢å¼•


```json
PUT /restaurant_index/_doc/1
{
  "name": "æ˜Ÿå·´å…‹å’–å•¡",
  "suggest": {
    "input": ["æ˜Ÿå·´å…‹", "å’–å•¡", "æ‹¿é“", "ç¾å¼å’–å•¡"],
    "weight": 90,
    "contexts": {
      "location": {                      // ğŸ”¸ åœ°ç†ä½ç½®ä¸Šä¸‹æ–‡
        "lat": 39.9042,
        "lon": 116.4074
      },
      "category": ["å’–å•¡åº—", "è¿é”åº—"],    // ğŸ”¸ åˆ†ç±»ä¸Šä¸‹æ–‡
      "price_range": ["ä¸­ç­‰ä»·ä½"]         // ğŸ”¸ ä»·æ ¼ä¸Šä¸‹æ–‡
    }
  }
}

PUT /restaurant_index/_doc/2
{
  "name": "å®¶ç”¨å’–å•¡æœº",
  "suggest": {
    "input": ["å’–å•¡æœº", "å®¶ç”¨ç”µå™¨", "æ„å¼å’–å•¡æœº"],
    "weight": 70,
    "contexts": {
      "category": ["å®¶ç”µ", "å¨æˆ¿ç”¨å“"],
      "price_range": ["é«˜ç«¯"]
    }
  }
}
```

### 5.4 ContextæŸ¥è¯¢ç¤ºä¾‹


**åŸºäºä½ç½®çš„ä¸Šä¸‹æ–‡æŸ¥è¯¢**ï¼š

```json
{
  "suggest": {
    "location_suggest": {
      "prefix": "å’–å•¡",
      "completion": {
        "field": "suggest",
        "size": 5,
        "contexts": {
          "location": {                   // ğŸ”¸ æŒ‡å®šä½ç½®ä¸Šä¸‹æ–‡
            "lat": 39.9042,
            "lon": 116.4074,
            "precision": "5km"
          }
        }
      }
    }
  }
}
```

**åŸºäºåˆ†ç±»çš„ä¸Šä¸‹æ–‡æŸ¥è¯¢**ï¼š

```json
{
  "suggest": {
    "category_suggest": {
      "prefix": "å’–å•¡",
      "completion": {
        "field": "suggest", 
        "contexts": {
          "category": ["å’–å•¡åº—", "é¤å…"]    // ğŸ”¸ æŒ‡å®šåˆ†ç±»ä¸Šä¸‹æ–‡
        }
      }
    }
  }
}
```

**å¤šé‡ä¸Šä¸‹æ–‡ç»„åˆæŸ¥è¯¢**ï¼š

```json
{
  "suggest": {
    "multi_context": {
      "prefix": "å’–å•¡",
      "completion": {
        "field": "suggest",
        "contexts": {
          "category": ["å’–å•¡åº—"],
          "price_range": ["ä¸­ç­‰ä»·ä½", "ç»æµå®æƒ "]
        }
      }
    }
  }
}
```

---

## 6. âš™ï¸ å»ºè®®å™¨é…ç½®ä¸ä¼˜åŒ–


### 6.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**å»ºè®®æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼š

```json
// ğŸ¯ é«˜æ€§èƒ½é…ç½®ç¤ºä¾‹
PUT /optimized_suggest_index
{
  "settings": {
    "index": {
      "max_result_window": 1000,
      "refresh_interval": "5s"          // ğŸ”¸ é€‚å½“çš„åˆ·æ–°é—´éš”
    }
  },
  "mappings": {
    "properties": {
      "suggest": {
        "type": "completion",
        "analyzer": "simple",            // ğŸ”¸ é€‰æ‹©åˆé€‚çš„åˆ†æå™¨
        "preserve_separators": false,    // ğŸ”¸ æ ¹æ®éœ€æ±‚è°ƒæ•´
        "preserve_position_increments": false,
        "max_input_length": 30          // ğŸ”¸ é™åˆ¶è¾“å…¥é•¿åº¦æå‡æ€§èƒ½
      }
    }
  }
}
```

### 6.2 å»ºè®®è´¨é‡ä¼˜åŒ–


**æƒé‡ç­–ç•¥è®¾è®¡**ï¼š

```javascript
// ğŸ¯ æ™ºèƒ½æƒé‡è®¡ç®—
function calculateSuggestionWeight(item) {
  let weight = 0;
  
  // åŸºç¡€æƒé‡ï¼šå•†å“çƒ­åº¦
  weight += item.popularity * 10;
  
  // æ—¶é—´æƒé‡ï¼šæ–°å•†å“åŠ æƒ
  const daysSinceCreated = (Date.now() - item.createdAt) / (1000 * 60 * 60 * 24);
  if (daysSinceCreated < 30) {
    weight += (30 - daysSinceCreated) * 2;
  }
  
  // é”€é‡æƒé‡
  weight += Math.log(item.salesCount + 1) * 5;
  
  // è¯„åˆ†æƒé‡
  weight += item.rating * 3;
  
  return Math.min(weight, 999); // é™åˆ¶æœ€å¤§æƒé‡
}
```

### 6.3 å¤šè¯­è¨€å»ºè®®æ”¯æŒ


```json
PUT /multilang_suggest
{
  "mappings": {
    "properties": {
      "suggest_cn": {                    // ğŸ”¸ ä¸­æ–‡å»ºè®®
        "type": "completion",
        "analyzer": "ik_smart"
      },
      "suggest_en": {                    // ğŸ”¸ è‹±æ–‡å»ºè®®  
        "type": "completion",
        "analyzer": "english"
      }
    }
  }
}

// ç´¢å¼•æ•°æ®
PUT /multilang_suggest/_doc/1
{
  "suggest_cn": {
    "input": ["è‹¹æœæ‰‹æœº", "iPhone", "æ™ºèƒ½æ‰‹æœº"],
    "weight": 100
  },
  "suggest_en": {
    "input": ["Apple iPhone", "smartphone", "mobile phone"],
    "weight": 100
  }
}
```

### 6.4 å»ºè®®ç»“æœæ’åºä¼˜åŒ–


```json
{
  "suggest": {
    "smart_suggest": {
      "prefix": "æ‰‹æœº",
      "completion": {
        "field": "suggest",
        "size": 10
      }
    }
  },
  "sort": [                              // ğŸ”¸ å¯¹å»ºè®®ç»“æœè¿›è¡Œæ’åº
    {"_score": {"order": "desc"}},       // ç›¸å…³æ€§åˆ†æ•°
    {"popularity": {"order": "desc"}},   // çƒ­åº¦
    {"_id": {"order": "asc"}}           // ç¨³å®šæ’åº
  ]
}
```

---

## 7. ğŸ“± å®é™…åº”ç”¨åœºæ™¯


### 7.1 ç”µå•†æœç´¢å»ºè®®


**éœ€æ±‚åˆ†æ**ï¼š
- âœ… **æ‹¼å†™çº é”™**ï¼šç”¨æˆ·è¾“å…¥é”™è¯¯å•†å“å
- âœ… **å“ç‰Œå»ºè®®**ï¼šè¾“å…¥éƒ¨åˆ†å“ç‰Œåæ˜¾ç¤ºå®Œæ•´ä¿¡æ¯
- âœ… **åˆ†ç±»å»ºè®®**ï¼šæ ¹æ®è¾“å…¥æ˜¾ç¤ºç›¸å…³åˆ†ç±»
- âœ… **çƒ­é—¨æ¨è**ï¼šç»“åˆé”€é‡å’Œè¯„ä»·çš„æ™ºèƒ½æ¨è

**å®ç°æ–¹æ¡ˆ**ï¼š

```json
// ğŸ›’ ç”µå•†ç»¼åˆå»ºè®®é…ç½®
{
  "suggest": {
    "spell_check": {                     // æ‹¼å†™çº é”™
      "text": "applr phone",
      "term": {
        "field": "product_name",
        "size": 3,
        "max_edits": 1
      }
    },
    "auto_complete": {                   // è‡ªåŠ¨è¡¥å…¨
      "prefix": "iph",
      "completion": {
        "field": "suggest",
        "size": 8,
        "contexts": {
          "category": ["æ‰‹æœº", "æ•°ç "]
        }
      }
    },
    "brand_suggest": {                   // å“ç‰Œå»ºè®®
      "prefix": "è‹¹æœ",
      "completion": {
        "field": "brand_suggest",
        "size": 5
      }
    }
  }
}
```

### 7.2 å†…å®¹å¹³å°æœç´¢


**åº”ç”¨åœºæ™¯**ï¼šåšå®¢ã€æ–°é—»ã€æ–‡æ¡£å¹³å°

```json
// ğŸ“° å†…å®¹å¹³å°å»ºè®®
{
  "suggest": {
    "content_suggest": {
      "text": "machine learn tutorial",
      "phrase": {
        "field": "title",
        "size": 5,
        "real_word_error_likelihood": 0.8,
        "highlight": {
          "pre_tag": "<mark>",
          "post_tag": "</mark>"
        }
      }
    },
    "tag_complete": {                    // æ ‡ç­¾è‡ªåŠ¨è¡¥å…¨
      "prefix": "java",
      "completion": {
        "field": "tags_suggest",
        "size": 10
      }
    }
  }
}
```

### 7.3 æœ¬åœ°æœåŠ¡æœç´¢


**åœºæ™¯**ï¼šé¤å…ã€é…’åº—ã€æœåŠ¡é¢„è®¢

```json
// ğŸª æœ¬åœ°æœåŠ¡å»ºè®®ï¼ˆå¸¦åœ°ç†ä½ç½®ï¼‰
{
  "suggest": {
    "location_service": {
      "prefix": "å’–å•¡",
      "completion": {
        "field": "business_suggest",
        "size": 8,
        "contexts": {
          "location": {
            "lat": 39.9042,
            "lon": 116.4074,
            "precision": "2km"
          },
          "business_type": ["é¤å…", "å’–å•¡åº—"]
        }
      }
    }
  }
}
```

### 7.4 æœç´¢å†å²ä¸ä¸ªæ€§åŒ–


**æ™ºèƒ½æœç´¢å†å²è®°å½•**ï¼š

```javascript
// ğŸ¯ ä¸ªæ€§åŒ–å»ºè®®å®ç°
class PersonalizedSuggestion {
  constructor(userId) {
    this.userId = userId;
    this.searchHistory = [];
    this.userPreferences = {};
  }
  
  // è®°å½•ç”¨æˆ·æœç´¢å†å²
  recordSearch(query, selectedItem) {
    this.searchHistory.push({
      query: query,
      selected: selectedItem,
      timestamp: Date.now()
    });
    this.updateUserPreferences();
  }
  
  // åŸºäºå†å²ä¼˜åŒ–å»ºè®®
  async getPersonalizedSuggestions(prefix) {
    const baseQuery = {
      suggest: {
        personal_suggest: {
          prefix: prefix,
          completion: {
            field: "suggest",
            size: 10
          }
        }
      }
    };
    
    // æ·»åŠ ä¸ªäººåå¥½æƒé‡
    if (this.userPreferences.categories) {
      baseQuery.suggest.personal_suggest.completion.contexts = {
        category: this.userPreferences.categories
      };
    }
    
    return baseQuery;
  }
}
```

### 7.5 çƒ­é—¨æœç´¢è¯ç»Ÿè®¡


```json
// ğŸ“Š çƒ­é—¨æœç´¢è¯èšåˆåˆ†æ
{
  "size": 0,
  "aggs": {
    "popular_searches": {
      "terms": {
        "field": "search_query.keyword",    // ğŸ”¸ æœç´¢è¯å­—æ®µ
        "size": 20,
        "order": {"search_count": "desc"}
      },
      "aggs": {
        "search_count": {
          "sum": {
            "field": "search_frequency"      // ğŸ”¸ æœç´¢é¢‘æ¬¡
          }
        },
        "recent_searches": {
          "date_histogram": {
            "field": "timestamp",
            "calendar_interval": "1d"
          }
        }
      }
    }
  }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å››ç§å»ºè®®ç±»å‹ï¼šTerm(æ‹¼å†™)ã€Phrase(çŸ­è¯­)ã€Completion(è¡¥å…¨)ã€Context(ä¸Šä¸‹æ–‡)
ğŸ”¸ æ ¸å¿ƒåº”ç”¨åœºæ™¯ï¼šæ‹¼å†™çº é”™ã€è‡ªåŠ¨è¡¥å…¨ã€æ™ºèƒ½æ¨èã€ä¸ªæ€§åŒ–å»ºè®®
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹ï¼šåˆç†æƒé‡ã€é€‚å½“é…ç½®ã€ç´¢å¼•ä¼˜åŒ–
ğŸ”¸ ç”¨æˆ·ä½“éªŒæå‡ï¼šå®æ—¶å“åº”ã€å‡†ç¡®å»ºè®®ã€ä¸ªæ€§åŒ–æ¨è
```

### 8.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ é€‰æ‹©åˆé€‚çš„å»ºè®®ç±»å‹**ï¼š
```
æ‹¼å†™é”™è¯¯è¾ƒå¤š â†’ Termå»ºè®®
çŸ­è¯­æœç´¢ä¸ºä¸» â†’ Phraseå»ºè®®  
å®æ—¶è¡¥å…¨éœ€æ±‚ â†’ Completionå»ºè®®
ä¸ªæ€§åŒ–éœ€æ±‚é«˜ â†’ Contextå»ºè®®
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
```
æ•°æ®é‡å¤§ï¼š
- æ§åˆ¶max_input_length
- åˆç†è®¾ç½®æƒé‡
- é€‚å½“çš„refresh_interval

ç”¨æˆ·ä½“éªŒï¼š
- é˜²æŠ–å¤„ç†ç”¨æˆ·è¾“å…¥
- ç¼“å­˜çƒ­é—¨å»ºè®®
- æ¸è¿›å¼åŠ è½½
```

**ğŸ”¹ å®é™…éƒ¨ç½²è€ƒè™‘**ï¼š
```
å‰ç«¯é›†æˆï¼š
- å®æ—¶å“åº”ï¼ˆ300mså†…ï¼‰
- é”®ç›˜å¯¼èˆªæ”¯æŒ
- ç§»åŠ¨ç«¯é€‚é…

åç«¯ä¼˜åŒ–ï¼š  
- å»ºè®®ç»“æœç¼“å­˜
- é™çº§ç­–ç•¥
- ç›‘æ§å’Œå‘Šè­¦
```

### 8.3 æœ€ä½³å®è·µå»ºè®®


ğŸ’¡ **é…ç½®å»ºè®®**ï¼š
- **Termå»ºè®®**ï¼š`max_edits=1-2`ï¼Œé¿å…è·ç¦»è¿‡å¤§
- **Completionå»ºè®®**ï¼š`weight`èŒƒå›´æ§åˆ¶åœ¨1-1000
- **Contextå»ºè®®**ï¼šä¸Šä¸‹æ–‡ä¸è¶…è¿‡3ä¸ªç»´åº¦
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå»ºè®®æ•°é‡æ§åˆ¶åœ¨5-10ä¸ª

âš ï¸ **å¸¸è§é—®é¢˜é¿å…**ï¼š
- **è¿‡åº¦ä¾èµ–å»ºè®®**ï¼šä¿ç•™ç”¨æˆ·åŸå§‹æœç´¢èƒ½åŠ›
- **å»ºè®®è´¨é‡å·®**ï¼šå®šæœŸæ¸…ç†å’Œæ›´æ–°å»ºè®®æ•°æ®
- **æ€§èƒ½é—®é¢˜**ï¼šåˆç†æ§åˆ¶å»ºè®®å­—æ®µå¤§å°
- **ç”¨æˆ·éšç§**ï¼šä¸ªæ€§åŒ–å»ºè®®è¦æ³¨æ„æ•°æ®ä¿æŠ¤

ğŸ¯ **å®ç”¨è®°å¿†**ï¼š
- **Term**ï¼šå•è¯æ‹¼å†™åŠ©æ‰‹
- **Phrase**ï¼šçŸ­è¯­æ™ºèƒ½çº é”™  
- **Completion**ï¼šè¾“å…¥å®æ—¶è¡¥å…¨
- **Context**ï¼šæƒ…æ™¯æ™ºèƒ½æ¨è

**æ ¸å¿ƒä»·å€¼**ï¼šè®©ç”¨æˆ·"æƒ³æœä»€ä¹ˆå°±èƒ½æ‰¾åˆ°ä»€ä¹ˆ"ï¼Œå³ä½¿ä»–ä»¬ä¸çŸ¥é“å‡†ç¡®çš„è¡¨è¾¾æ–¹å¼ï¼