---
title: 4ã€discoveryå‘ç°æœºåˆ¶é…ç½®
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å‘ç°æœºåˆ¶](#1-ä»€ä¹ˆæ˜¯å‘ç°æœºåˆ¶)
2. [å‘ç°ç±»å‹é…ç½®](#2-å‘ç°ç±»å‹é…ç½®)
3. [ç§å­ä¸»æœºé…ç½®](#3-ç§å­ä¸»æœºé…ç½®)
4. [é›†ç¾¤åˆå§‹åŒ–é…ç½®](#4-é›†ç¾¤åˆå§‹åŒ–é…ç½®)
5. [æ•…éšœæ£€æµ‹é…ç½®](#5-æ•…éšœæ£€æµ‹é…ç½®)
6. [è¶…æ—¶å‚æ•°é…ç½®](#6-è¶…æ—¶å‚æ•°é…ç½®)
7. [ç‰ˆæœ¬å·®å¼‚è¯´æ˜](#7-ç‰ˆæœ¬å·®å¼‚è¯´æ˜)
8. [å®æˆ˜é…ç½®ç¤ºä¾‹](#8-å®æˆ˜é…ç½®ç¤ºä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä»€ä¹ˆæ˜¯å‘ç°æœºåˆ¶


### 1.1 å‘ç°æœºåˆ¶çš„æœ¬è´¨


**ç®€å•ç†è§£**ï¼šå‘ç°æœºåˆ¶å°±åƒæ˜¯è®©ElasticsearchèŠ‚ç‚¹ä¹‹é—´**"ç›¸äº’è®¤è¯†"**çš„è¿‡ç¨‹

```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ æ¬åˆ°æ–°å°åŒºï¼Œéœ€è¦è®¤è¯†é‚»å±…ç»„å»ºä¸šä¸»ç¾¤
- éœ€è¦çŸ¥é“å“ªäº›æ˜¯é‚»å±…ï¼ˆç§å­ä¸»æœºï¼‰
- éœ€è¦é€‰å‡ºç¾¤ä¸»ï¼ˆä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼‰
- éœ€è¦å¤„ç†æœ‰äººæ¬èµ°çš„æƒ…å†µï¼ˆæ•…éšœæ£€æµ‹ï¼‰

Elasticsearchçš„å‘ç°æœºåˆ¶å°±æ˜¯è¿™æ ·çš„"é‚»å±…è®¤è¯†"è¿‡ç¨‹
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **èŠ‚ç‚¹å‘ç°**ï¼šè®©æ–°èŠ‚ç‚¹æ‰¾åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹
- ğŸ”¸ **ä¸»èŠ‚ç‚¹é€‰ä¸¾**ï¼šé€‰å‡ºè´Ÿè´£ç®¡ç†é›†ç¾¤çš„ä¸»èŠ‚ç‚¹
- ğŸ”¸ **é›†ç¾¤çŠ¶æ€åŒæ­¥**ï¼šä¿æŒæ‰€æœ‰èŠ‚ç‚¹çš„é›†ç¾¤ä¿¡æ¯ä¸€è‡´
- ğŸ”¸ **æ•…éšœæ£€æµ‹**ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†èŠ‚ç‚¹æ•…éšœ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å‘ç°æœºåˆ¶


**é—®é¢˜åœºæ™¯**ï¼š
```
æ²¡æœ‰å‘ç°æœºåˆ¶çš„é—®é¢˜ï¼š
âŒ èŠ‚ç‚¹å¯åŠ¨åä¸çŸ¥é“å…¶ä»–èŠ‚ç‚¹åœ¨å“ª
âŒ å¤šä¸ªèŠ‚ç‚¹å¯èƒ½å„è‡ªä¸ºæ”¿ï¼Œå½¢æˆå¤šä¸ªå°é›†ç¾¤
âŒ èŠ‚ç‚¹æ•…éšœåå…¶ä»–èŠ‚ç‚¹ä¸çŸ¥é“ï¼Œç»§ç»­å‘é€è¯·æ±‚
âŒ æ•°æ®åˆ†å¸ƒæ··ä¹±ï¼Œæ— æ³•åè°ƒå·¥ä½œ
```

**å‘ç°æœºåˆ¶è§£å†³çš„é—®é¢˜**ï¼š
```
âœ… è‡ªåŠ¨å‘ç°ï¼šèŠ‚ç‚¹å¯åŠ¨åè‡ªåŠ¨æ‰¾åˆ°é›†ç¾¤
âœ… é€‰ä¸»åè°ƒï¼šé€‰å‡ºä¸»èŠ‚ç‚¹ç»Ÿä¸€ç®¡ç†
âœ… çŠ¶æ€åŒæ­¥ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ä¿æŒä¸€è‡´
âœ… æ•…éšœå¤„ç†ï¼šåŠæ—¶å‘ç°å¹¶å¤„ç†èŠ‚ç‚¹æ•…éšœ
```

---

## 2. âš™ï¸ å‘ç°ç±»å‹é…ç½®


### 2.1 discovery.type å‚æ•°è¯¦è§£


**å‚æ•°å«ä¹‰**ï¼šå‘Šè¯‰Elasticsearchä½¿ç”¨å“ªç§æ–¹å¼æ¥å‘ç°å…¶ä»–èŠ‚ç‚¹

**ä¸»è¦ç±»å‹å¯¹æ¯”**ï¼š

| å‘ç°ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ç‰¹ç‚¹** | **é…ç½®å¤æ‚åº¦** |
|---------|------------|---------|--------------|
| `single-node` | `å¼€å‘æµ‹è¯•` | `å•èŠ‚ç‚¹è¿è¡Œï¼Œä¸éœ€è¦é›†ç¾¤` | `â­â˜†â˜†â˜†â˜†` |
| `zen` | `ç”Ÿäº§ç¯å¢ƒ` | `å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œæ”¯æŒä¸»èŠ‚ç‚¹é€‰ä¸¾` | `â­â­â­â­â˜†` |

### 2.2 single-node æ¨¡å¼


**ä»€ä¹ˆæ—¶å€™ç”¨**ï¼š
- ğŸ¯ **å¼€å‘ç¯å¢ƒ**ï¼šæœ¬åœ°å¼€å‘æµ‹è¯•
- ğŸ¯ **å­¦ä¹ ç»ƒä¹ **ï¼šåˆšå¼€å§‹å­¦ä¹ ES
- ğŸ¯ **å•æœºéƒ¨ç½²**ï¼šåªæœ‰ä¸€å°æœåŠ¡å™¨

**é…ç½®æ–¹æ³•**ï¼š
```yaml
# elasticsearch.yml
discovery.type: single-node
```

**ç‰¹ç‚¹è¯´æ˜**ï¼š
```
ä¼˜ç‚¹ï¼š
âœ… é…ç½®ç®€å•ï¼Œä¸€è¡Œæå®š
âœ… å¯åŠ¨å¿«é€Ÿï¼Œä¸éœ€è¦ç­‰å¾…å…¶ä»–èŠ‚ç‚¹
âœ… é€‚åˆå¼€å‘æµ‹è¯•

é™åˆ¶ï¼š
âŒ åªèƒ½å•èŠ‚ç‚¹ï¼Œæ— æ³•æ‰©å±•
âŒ æ²¡æœ‰é«˜å¯ç”¨æ€§
âŒ æ€§èƒ½å—é™äºå•å°æœºå™¨
```

### 2.3 zen æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰


**ä»€ä¹ˆæ—¶å€™ç”¨**ï¼š
- ğŸ¯ **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ­£å¼çš„ä¸šåŠ¡ç³»ç»Ÿ
- ğŸ¯ **é›†ç¾¤éƒ¨ç½²**ï¼šå¤šå°æœåŠ¡å™¨ç»„æˆé›†ç¾¤
- ğŸ¯ **é«˜å¯ç”¨éœ€æ±‚**ï¼šéœ€è¦æ•…éšœè½¬ç§»

**é…ç½®è¯´æ˜**ï¼š
```yaml
# elasticsearch.yml
# zenæ˜¯é»˜è®¤å€¼ï¼Œé€šå¸¸ä¸éœ€è¦æ˜¾å¼æŒ‡å®š
discovery.type: zen
```

**zenæ¨¡å¼çš„å·¥ä½œæµç¨‹**ï¼š
```
èŠ‚ç‚¹å¯åŠ¨æµç¨‹ï¼š
1ï¸âƒ£ èŠ‚ç‚¹å¯åŠ¨ â†’ æŸ¥æ‰¾ç§å­ä¸»æœºåˆ—è¡¨
2ï¸âƒ£ è”ç³»ç§å­ä¸»æœº â†’ è·å–é›†ç¾¤å½“å‰çŠ¶æ€
3ï¸âƒ£ åŠ å…¥é›†ç¾¤ â†’ å‚ä¸ä¸»èŠ‚ç‚¹é€‰ä¸¾
4ï¸âƒ£ åŒæ­¥æ•°æ® â†’ æ¥æ”¶é›†ç¾¤çŠ¶æ€æ›´æ–°
```

---

## 3. ğŸŒ± ç§å­ä¸»æœºé…ç½®


### 3.1 discovery.seed_hosts è¯¦è§£


**ç®€å•ç†è§£**ï¼šç§å­ä¸»æœºå°±åƒæ˜¯**"ä»‹ç»äºº"**ï¼Œæ–°èŠ‚ç‚¹é€šè¿‡å®ƒä»¬æ¥è®¤è¯†æ•´ä¸ªé›†ç¾¤

**é…ç½®æ ¼å¼**ï¼š
```yaml
# æ–¹å¼1ï¼šIPåœ°å€åˆ—è¡¨
discovery.seed_hosts:
  - "192.168.1.100:9300"
  - "192.168.1.101:9300"
  - "192.168.1.102:9300"

# æ–¹å¼2ï¼šä¸»æœºååˆ—è¡¨
discovery.seed_hosts:
  - "es-node1"
  - "es-node2"
  - "es-node3"

# æ–¹å¼3ï¼šæ··åˆé…ç½®
discovery.seed_hosts:
  - "es-master.example.com:9300"
  - "192.168.1.100"
  - "[::1]:9300"  # IPv6åœ°å€
```

### 3.2 ç§å­ä¸»æœºçš„ä½œç”¨æœºåˆ¶


**å·¥ä½œåŸç†å›¾ç¤º**ï¼š
```
æ–°èŠ‚ç‚¹å¯åŠ¨è¿‡ç¨‹ï¼š

æ–°èŠ‚ç‚¹                ç§å­ä¸»æœº               é›†ç¾¤
   |                     |                  |
   |--[1]å°è¯•è¿æ¥-------->|                  |
   |   (192.168.1.100)   |                  |
   |                     |--[2]è¿”å›é›†ç¾¤ä¿¡æ¯->|
   |<--[3]é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨----|                  |
   |                     |                  |
   |--[4]è¿æ¥çœŸæ­£çš„é›†ç¾¤èŠ‚ç‚¹----------------->|
   |                     |                  |
   |<--[5]åŠ å…¥é›†ç¾¤æˆåŠŸ----------------------------|
```

**é‡è¦è¯´æ˜**ï¼š
- ğŸ”¸ **ç§å­ä¸»æœºä¸éœ€è¦æ˜¯ä¸»èŠ‚ç‚¹**ï¼šæ™®é€šæ•°æ®èŠ‚ç‚¹ä¹Ÿå¯ä»¥ä½œä¸ºç§å­ä¸»æœº
- ğŸ”¸ **ä¸éœ€è¦åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹**ï¼šåªéœ€è¦å‡ ä¸ªç¨³å®šçš„èŠ‚ç‚¹å³å¯
- ğŸ”¸ **å»ºè®®è‡³å°‘3ä¸ª**ï¼šé¿å…å•ç‚¹æ•…éšœ
- ğŸ”¸ **ç«¯å£é»˜è®¤9300**ï¼šä¼ è¾“å±‚ç«¯å£ï¼Œä¸æ˜¯HTTPç«¯å£9200

### 3.3 ç§å­æä¾›è€…é…ç½®


**discovery.seed_providers å‚æ•°**ï¼š

**æ–‡ä»¶æä¾›è€…**ï¼š
```yaml
discovery.seed_providers: file

# éœ€è¦åˆ›å»º unicast_hosts.txt æ–‡ä»¶
# æ–‡ä»¶å†…å®¹ï¼š
# 192.168.1.100:9300
# 192.168.1.101:9300
# 192.168.1.102:9300
```

**äº‘æä¾›è€…**ï¼ˆAWS EC2ç¤ºä¾‹ï¼‰ï¼š
```yaml
discovery.seed_providers: ec2

# éœ€è¦é¢å¤–çš„äº‘æ’ä»¶é…ç½®
discovery.ec2.tag.Environment: production
discovery.ec2.tag.Team: search
```

**ä½¿ç”¨å»ºè®®**ï¼š
- ğŸ¯ **å°å‹é›†ç¾¤**ï¼šç›´æ¥ä½¿ç”¨ `discovery.seed_hosts`
- ğŸ¯ **åŠ¨æ€ç¯å¢ƒ**ï¼šä½¿ç”¨äº‘æä¾›è€…æˆ–æ–‡ä»¶æä¾›è€…
- ğŸ¯ **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šè€ƒè™‘ä½¿ç”¨DNSå‘ç°

---

## 4. ğŸš€ é›†ç¾¤åˆå§‹åŒ–é…ç½®


### 4.1 cluster.initial_master_nodes è¯¦è§£


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šè¿™ä¸ªå‚æ•°å‘Šè¯‰Elasticsearch**ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶**å“ªäº›èŠ‚ç‚¹æœ‰èµ„æ ¼æˆä¸ºä¸»èŠ‚ç‚¹

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªé…ç½®**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
é›†ç¾¤ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œæ²¡æœ‰ä»»ä½•å†å²ä¿¡æ¯
å¦‚æœä¸æŒ‡å®šï¼Œå¯èƒ½å‡ºç°ï¼š
âŒ æ‰€æœ‰èŠ‚ç‚¹éƒ½ç­‰å¾…åˆ«äººå½“ä¸»èŠ‚ç‚¹
âŒ å¤šä¸ªèŠ‚ç‚¹åŒæ—¶è®¤ä¸ºè‡ªå·±æ˜¯ä¸»èŠ‚ç‚¹
âŒ é›†ç¾¤æ— æ³•æ­£å¸¸å¯åŠ¨

è§£å†³æ–¹æ¡ˆï¼š
âœ… æ˜ç¡®æŒ‡å®šåˆå§‹ä¸»èŠ‚ç‚¹å€™é€‰
âœ… é¿å…è„‘è£‚é—®é¢˜
âœ… ç¡®ä¿é›†ç¾¤é¡ºåˆ©å¯åŠ¨
```

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
cluster.initial_master_nodes:
  - "es-master-1"
  - "es-master-2"
  - "es-master-3"

# æˆ–è€…ä½¿ç”¨èŠ‚ç‚¹åç§°
cluster.initial_master_nodes:
  - "node-1"
  - "node-2"
  - "node-3"
```

### 4.2 åˆå§‹åŒ–è¿‡ç¨‹è¯¦è§£


**é›†ç¾¤é¦–æ¬¡å¯åŠ¨æµç¨‹**ï¼š
```
ç¬¬ä¸€æ¬¡å¯åŠ¨é›†ç¾¤ï¼š

æ­¥éª¤1ï¸âƒ£ï¼šå‡†å¤‡èŠ‚ç‚¹
es-master-1  es-master-2  es-master-3
    |           |           |
    |--é…ç½®ç›¸åŒçš„initial_master_nodes--|

æ­¥éª¤2ï¸âƒ£ï¼šå¯åŠ¨é€‰ä¸¾
ç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹æ£€æŸ¥ï¼š
- æˆ‘åœ¨initial_master_nodesåˆ—è¡¨ä¸­å—ï¼Ÿâœ…
- èƒ½è”ç³»åˆ°å…¶ä»–å€™é€‰èŠ‚ç‚¹å—ï¼ŸğŸ”
- æ»¡è¶³é€‰ä¸¾æ¡ä»¶å°±æˆä¸ºä¸»èŠ‚ç‚¹

æ­¥éª¤3ï¸âƒ£ï¼šå…¶ä»–èŠ‚ç‚¹åŠ å…¥
åç»­å¯åŠ¨çš„èŠ‚ç‚¹ï¼š
- å‘ç°å·²æœ‰ä¸»èŠ‚ç‚¹ â†’ ç›´æ¥åŠ å…¥é›†ç¾¤
- ä¸å†éœ€è¦initial_master_nodesé…ç½®
```

**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š
> âš ï¸ **ä¸€æ¬¡æ€§é…ç½®**ï¼š`cluster.initial_master_nodes` åªåœ¨é›†ç¾¤**ç¬¬ä¸€æ¬¡å¯åŠ¨**æ—¶ç”Ÿæ•ˆ
> 
> âš ï¸ **åç»­å¯åŠ¨å¿½ç•¥**ï¼šé›†ç¾¤å»ºç«‹åï¼Œé‡å¯èŠ‚ç‚¹æ—¶è¿™ä¸ªé…ç½®ä¼šè¢«å¿½ç•¥
> 
> âš ï¸ **èŠ‚ç‚¹åç§°å‡†ç¡®**ï¼šå¿…é¡»ä¸ `node.name` é…ç½®å®Œå…¨ä¸€è‡´

---

## 5. ğŸ”§ æ•…éšœæ£€æµ‹é…ç½®


### 5.1 cluster.fault_detection æ¦‚è¿°


**æ•…éšœæ£€æµ‹çš„ä½œç”¨**ï¼šå°±åƒæ˜¯é›†ç¾¤çš„**"å¥åº·æ£€æŸ¥å‘˜"**ï¼Œå®šæœŸæ£€æŸ¥å„ä¸ªèŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ

**æ£€æµ‹æœºåˆ¶**ï¼š
```
æ•…éšœæ£€æµ‹æ–¹å¼ï¼š
1ï¸âƒ£ ä¸»èŠ‚ç‚¹æ£€æµ‹ï¼šä¸»èŠ‚ç‚¹å®šæœŸæ£€æŸ¥å…¶ä»–èŠ‚ç‚¹
2ï¸âƒ£ ä»èŠ‚ç‚¹æ£€æµ‹ï¼šæ™®é€šèŠ‚ç‚¹å®šæœŸæ£€æŸ¥ä¸»èŠ‚ç‚¹
3ï¸âƒ£ ç½‘ç»œæ£€æµ‹ï¼šæ£€æŸ¥èŠ‚ç‚¹é—´ç½‘ç»œè¿é€šæ€§
4ï¸âƒ£ å“åº”æ£€æµ‹ï¼šæ£€æŸ¥èŠ‚ç‚¹å“åº”æ—¶é—´
```

### 5.2 ä¸»è¦é…ç½®å‚æ•°


**cluster.fault_detection.leader_check.interval**ï¼š
```yaml
# ä¸»èŠ‚ç‚¹æ£€æŸ¥é—´éš”ï¼ˆé»˜è®¤1ç§’ï¼‰
cluster.fault_detection.leader_check.interval: 1s
```
**é€šä¿—è§£é‡Š**ï¼šä¸»èŠ‚ç‚¹æ¯éš”å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡å…¶ä»–èŠ‚ç‚¹æ˜¯å¦æ´»ç€

**cluster.fault_detection.leader_check.timeout**ï¼š
```yaml
# ä¸»èŠ‚ç‚¹æ£€æŸ¥è¶…æ—¶ï¼ˆé»˜è®¤10ç§’ï¼‰
cluster.fault_detection.leader_check.timeout: 10s
```
**é€šä¿—è§£é‡Š**ï¼šä¸»èŠ‚ç‚¹ç­‰å¾…å…¶ä»–èŠ‚ç‚¹å“åº”çš„æœ€é•¿æ—¶é—´

**cluster.fault_detection.leader_check.retry_count**ï¼š
```yaml
# é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤3æ¬¡ï¼‰
cluster.fault_detection.leader_check.retry_count: 3
```
**é€šä¿—è§£é‡Š**ï¼šè®¤ä¸ºèŠ‚ç‚¹æ•…éšœå‰æœ€å¤šé‡è¯•å‡ æ¬¡

### 5.3 æ•…éšœæ£€æµ‹æµç¨‹


**æ£€æµ‹æµç¨‹å›¾ç¤º**ï¼š
```
æ•…éšœæ£€æµ‹è¿‡ç¨‹ï¼š

ä¸»èŠ‚ç‚¹                     ç›®æ ‡èŠ‚ç‚¹
   |                         |
   |--[1]å‘é€å¿ƒè·³æ£€æŸ¥-------->|
   |                         |
   |                    [2]èŠ‚ç‚¹æ­£å¸¸ï¼Ÿ
   |                         |
   |<--[3a]æ­£å¸¸å“åº”-----------| âœ… æ­£å¸¸æƒ…å†µ
   |                         |
   |     [3b]æ— å“åº”æˆ–é”™è¯¯     | âŒ å¼‚å¸¸æƒ…å†µ
   |                         |
   |--[4]é‡è¯•æ£€æŸ¥(æœ€å¤š3æ¬¡)--->|
   |                         |
   |     [5]ä»æ— å“åº”         |
   |                         |
   |--[6]æ ‡è®°èŠ‚ç‚¹æ•…éšœ         |
   |--[7]ä»é›†ç¾¤ä¸­ç§»é™¤è¯¥èŠ‚ç‚¹    |
```

**è°ƒä¼˜å»ºè®®**ï¼š
```
ç½‘ç»œè¾ƒå·®ç¯å¢ƒï¼š
cluster.fault_detection.leader_check.timeout: 30s
cluster.fault_detection.leader_check.retry_count: 5

ç½‘ç»œè¾ƒå¥½ç¯å¢ƒï¼š
cluster.fault_detection.leader_check.timeout: 5s
cluster.fault_detection.leader_check.retry_count: 2
```

---

## 6. â° è¶…æ—¶å‚æ•°é…ç½®


### 6.1 discovery.request_peers_timeout


**å‚æ•°å«ä¹‰**ï¼šæ–°èŠ‚ç‚¹å¯»æ‰¾å…¶ä»–èŠ‚ç‚¹æ—¶çš„**ç­‰å¾…æ—¶é—´**

```yaml
# é»˜è®¤3ç§’
discovery.request_peers_timeout: 3s
```

**é€šä¿—è§£é‡Š**ï¼š
```
åœºæ™¯ï¼šæ–°å‘˜å·¥å…¥èŒéœ€è¦æ‰¾åˆ°å›¢é˜Ÿ
discovery.request_peers_timeout = åœ¨å¤§å…ç­‰å¾…å¤šä¹…æ‰¾ä¸åˆ°äººå°±æ”¾å¼ƒ

å®é™…åº”ç”¨ï¼š
- æ—¶é—´å¤ªçŸ­ï¼šå¯èƒ½è¿˜æ²¡æ‰¾å…¨å°±æ”¾å¼ƒäº†
- æ—¶é—´å¤ªé•¿ï¼šå¯åŠ¨é€Ÿåº¦æ…¢
- å»ºè®®å€¼ï¼šç½‘ç»œå¥½3sï¼Œç½‘ç»œå·®10s
```

### 6.2 discovery.cluster_formation_warning_timeout


**å‚æ•°å«ä¹‰**ï¼šé›†ç¾¤å½¢æˆè­¦å‘Šçš„**è¶…æ—¶æ—¶é—´**

```yaml
# é»˜è®¤10ç§’
discovery.cluster_formation_warning_timeout: 10s
```

**ä½œç”¨è¯´æ˜**ï¼š
```
è­¦å‘Šæœºåˆ¶ï¼š
- å¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡å½¢æˆé›†ç¾¤
- Elasticsearchä¼šåœ¨æ—¥å¿—ä¸­è¾“å‡ºè­¦å‘Šä¿¡æ¯
- å¸®åŠ©ç®¡ç†å‘˜å‘ç°é…ç½®é—®é¢˜

å¸¸è§è­¦å‘Šä¿¡æ¯ï¼š
"master not discovered yet, this node has not previously joined a bootstrapped (v7+) cluster"
```

**å®é™…é…ç½®å»ºè®®**ï¼š
```yaml
# ç”Ÿäº§ç¯å¢ƒé…ç½®
discovery.request_peers_timeout: 10s
discovery.cluster_formation_warning_timeout: 30s

# å¼€å‘ç¯å¢ƒé…ç½®
discovery.request_peers_timeout: 3s
discovery.cluster_formation_warning_timeout: 10s
```

---

## 7. ğŸ“š ç‰ˆæœ¬å·®å¼‚è¯´æ˜


### 7.1 Elasticsearch 7.x é‡å¤§å˜åŒ–


**å·²åºŸå¼ƒçš„é…ç½®**ï¼š

**discovery.zen.minimum_master_nodes**ï¼ˆ7.xå·²åºŸå¼ƒï¼‰ï¼š
```yaml
# âŒ 7.xç‰ˆæœ¬å·²åºŸå¼ƒï¼Œä¸è¦ä½¿ç”¨
discovery.zen.minimum_master_nodes: 2

# âœ… 7.xç‰ˆæœ¬è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
```

**é€šä¿—è§£é‡Šå˜åŒ–**ï¼š
```
6.xç‰ˆæœ¬çš„é—®é¢˜ï¼š
éœ€è¦æ‰‹åŠ¨è®¡ç®—å’Œè®¾ç½®minimum_master_nodes
å…¬å¼ï¼š(æœ‰é€‰ä¸¾æƒèŠ‚ç‚¹æ•° / 2) + 1
å®¹æ˜“é…ç½®é”™è¯¯å¯¼è‡´è„‘è£‚

7.xç‰ˆæœ¬çš„æ”¹è¿›ï¼š
âœ… è‡ªåŠ¨è®¡ç®—æœ€å°ä¸»èŠ‚ç‚¹æ•°
âœ… é€šè¿‡cluster.initial_master_nodesä¸€æ¬¡æ€§é…ç½®
âœ… é¿å…è„‘è£‚é—®é¢˜
```

**discovery.zen.ping.unicast.hosts**ï¼ˆ7.xå·²åºŸå¼ƒï¼‰ï¼š
```yaml
# âŒ 7.xç‰ˆæœ¬å·²åºŸå¼ƒ
discovery.zen.ping.unicast.hosts:
  - "host1:9300"
  - "host2:9300"

# âœ… 7.xç‰ˆæœ¬ä½¿ç”¨æ–°é…ç½®
discovery.seed_hosts:
  - "host1:9300"
  - "host2:9300"
```

### 7.2 ç‰ˆæœ¬å‡çº§æ³¨æ„äº‹é¡¹


**ä»6.xå‡çº§åˆ°7.x**ï¼š
```yaml
# æ—§é…ç½®ï¼ˆ6.xï¼‰
discovery.zen.ping.unicast.hosts:
  - "es1:9300"
  - "es2:9300"
discovery.zen.minimum_master_nodes: 2

# æ–°é…ç½®ï¼ˆ7.xï¼‰
discovery.seed_hosts:
  - "es1:9300"
  - "es2:9300"
cluster.initial_master_nodes:
  - "es1"
  - "es2"
  - "es3"
```

> ğŸ’¡ **å‡çº§å»ºè®®**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°é…ç½®ï¼Œç¡®ä¿é›†ç¾¤èƒ½æ­£å¸¸å¯åŠ¨åå†å‡çº§ç”Ÿäº§ç¯å¢ƒ

---

## 8. ğŸ› ï¸ å®æˆ˜é…ç½®ç¤ºä¾‹


### 8.1 ä¸‰èŠ‚ç‚¹é›†ç¾¤é…ç½®


**åœºæ™¯æè¿°**ï¼šç”Ÿäº§ç¯å¢ƒä¸‰èŠ‚ç‚¹ESé›†ç¾¤é…ç½®

**èŠ‚ç‚¹1é…ç½®**ï¼ˆes-master-1ï¼‰ï¼š
```yaml
# elasticsearch.yml
cluster.name: my-es-cluster
node.name: es-master-1
node.roles: [master, data]

# ç½‘ç»œé…ç½®
network.host: 192.168.1.100
http.port: 9200
transport.port: 9300

# å‘ç°é…ç½®
discovery.seed_hosts:
  - "192.168.1.100:9300"
  - "192.168.1.101:9300"
  - "192.168.1.102:9300"

cluster.initial_master_nodes:
  - "es-master-1"
  - "es-master-2"
  - "es-master-3"

# æ•…éšœæ£€æµ‹é…ç½®
cluster.fault_detection.leader_check.interval: 1s
cluster.fault_detection.leader_check.timeout: 10s
cluster.fault_detection.leader_check.retry_count: 3

# è¶…æ—¶é…ç½®
discovery.request_peers_timeout: 10s
discovery.cluster_formation_warning_timeout: 30s
```

**èŠ‚ç‚¹2é…ç½®**ï¼ˆes-master-2ï¼‰ï¼š
```yaml
# elasticsearch.yml
cluster.name: my-es-cluster
node.name: es-master-2
node.roles: [master, data]

# ç½‘ç»œé…ç½®
network.host: 192.168.1.101
http.port: 9200
transport.port: 9300

# å‘ç°é…ç½®ï¼ˆä¸èŠ‚ç‚¹1ç›¸åŒï¼‰
discovery.seed_hosts:
  - "192.168.1.100:9300"
  - "192.168.1.101:9300"
  - "192.168.1.102:9300"

cluster.initial_master_nodes:
  - "es-master-1"
  - "es-master-2"
  - "es-master-3"
```

### 8.2 å¼€å‘ç¯å¢ƒå•èŠ‚ç‚¹é…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šæœ¬åœ°å¼€å‘ã€æµ‹è¯•å­¦ä¹ 

```yaml
# elasticsearch.yml
cluster.name: dev-cluster
node.name: dev-node-1

# å•èŠ‚ç‚¹æ¨¡å¼
discovery.type: single-node

# ç½‘ç»œé…ç½®
network.host: localhost
http.port: 9200

# å®‰å…¨é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
xpack.security.enabled: false
```

### 8.3 Dockerå®¹å™¨é…ç½®


**docker-compose.ymlç¤ºä¾‹**ï¼š
```yaml
version: '3.8'
services:
  es01:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: es01
    environment:
      - node.name=es01
      - cluster.name=docker-cluster
      - discovery.seed_hosts=es02,es03
      - cluster.initial_master_nodes=es01,es02,es03
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    networks:
      - elastic

  es02:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: es02
    environment:
      - node.name=es02
      - cluster.name=docker-cluster
      - discovery.seed_hosts=es01,es03
      - cluster.initial_master_nodes=es01,es02,es03
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=false
    networks:
      - elastic

networks:
  elastic:
    driver: bridge
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‘ç°æœºåˆ¶ï¼šè®©ESèŠ‚ç‚¹ç›¸äº’è®¤è¯†å’Œåè°ƒå·¥ä½œçš„æœºåˆ¶
ğŸ”¸ discovery.typeï¼šé€‰æ‹©single-nodeï¼ˆå¼€å‘ï¼‰æˆ–zenï¼ˆç”Ÿäº§ï¼‰
ğŸ”¸ discovery.seed_hostsï¼šç§å­ä¸»æœºåˆ—è¡¨ï¼Œæ–°èŠ‚ç‚¹çš„"ä»‹ç»äºº"
ğŸ”¸ cluster.initial_master_nodesï¼šé¦–æ¬¡å¯åŠ¨æ—¶çš„ä¸»èŠ‚ç‚¹å€™é€‰åˆ—è¡¨
ğŸ”¸ æ•…éšœæ£€æµ‹ï¼šå®šæœŸæ£€æŸ¥èŠ‚ç‚¹å¥åº·çŠ¶æ€çš„æœºåˆ¶
```

### 9.2 å…³é”®é…ç½®åŸåˆ™


**ğŸ”¹ ç¯å¢ƒé€‰æ‹©åŸåˆ™**ï¼š
```
å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼š
âœ… ä½¿ç”¨single-nodeæ¨¡å¼
âœ… é…ç½®ç®€å•ï¼Œå¯åŠ¨å¿«é€Ÿ
âœ… æ— éœ€è€ƒè™‘é›†ç¾¤å¤æ‚æ€§

ç”Ÿäº§ç¯å¢ƒï¼š
âœ… ä½¿ç”¨é»˜è®¤zenæ¨¡å¼
âœ… è‡³å°‘3ä¸ªèŠ‚ç‚¹é¿å…è„‘è£‚
âœ… åˆç†é…ç½®æ•…éšœæ£€æµ‹å‚æ•°
```

**ğŸ”¹ ç§å­ä¸»æœºé…ç½®åŸåˆ™**ï¼š
```
é€‰æ‹©ç§å­ä¸»æœºï¼š
âœ… é€‰æ‹©ç¨³å®šçš„èŠ‚ç‚¹ï¼ˆé€šå¸¸æ˜¯ä¸»èŠ‚ç‚¹ï¼‰
âœ… è‡³å°‘é…ç½®2-3ä¸ªé¿å…å•ç‚¹æ•…éšœ
âœ… ä½¿ç”¨IPåœ°å€æ¯”ä¸»æœºåæ›´å¯é 
âœ… ç¡®ä¿ç«¯å£æ­£ç¡®ï¼ˆé»˜è®¤9300ï¼‰
```

**ğŸ”¹ åˆå§‹åŒ–é…ç½®åŸåˆ™**ï¼š
```
cluster.initial_master_nodesï¼š
âœ… åªåœ¨é¦–æ¬¡å¯åŠ¨æ—¶éœ€è¦
âœ… å¿…é¡»ä¸node.nameå®Œå…¨ä¸€è‡´
âœ… å»ºè®®åŒ…å«æ‰€æœ‰æœ‰é€‰ä¸¾æƒçš„èŠ‚ç‚¹
âœ… é›†ç¾¤å»ºç«‹åå¯ä»¥åˆ é™¤æ­¤é…ç½®
```

### 9.3 å¸¸è§é—®é¢˜è§£å†³


**é—®é¢˜1**ï¼šé›†ç¾¤æ— æ³•å¯åŠ¨
```
å¯èƒ½åŸå› ï¼š
âŒ initial_master_nodesé…ç½®é”™è¯¯
âŒ ç§å­ä¸»æœºæ— æ³•è¿é€š
âŒ èŠ‚ç‚¹åç§°ä¸åŒ¹é…

è§£å†³æ­¥éª¤ï¼š
1ï¸âƒ£ æ£€æŸ¥node.nameä¸initial_master_nodesä¸€è‡´æ€§
2ï¸âƒ£ éªŒè¯seed_hostsç½‘ç»œè¿é€šæ€§
3ï¸âƒ£ æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
```

**é—®é¢˜2**ï¼šèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤
```
å¯èƒ½åŸå› ï¼š
âŒ cluster.nameä¸ä¸€è‡´
âŒ ç§å­ä¸»æœºé…ç½®é”™è¯¯
âŒ ç½‘ç»œé˜²ç«å¢™é˜»æ‹¦

è§£å†³æ­¥éª¤ï¼š
1ï¸âƒ£ ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹cluster.nameç›¸åŒ
2ï¸âƒ£ æ£€æŸ¥9300ç«¯å£æ˜¯å¦å¼€æ”¾
3ï¸âƒ£ éªŒè¯ç§å­ä¸»æœºé…ç½®æ­£ç¡®æ€§
```

**é—®é¢˜3**ï¼šé›†ç¾¤å‡ºç°è„‘è£‚
```
7.xç‰ˆæœ¬é¢„é˜²ï¼š
âœ… è‡ªåŠ¨è®¡ç®—minimum_master_nodes
âœ… æ­£ç¡®é…ç½®initial_master_nodes
âœ… ç¡®ä¿ç½‘ç»œç¨³å®šæ€§

6.xç‰ˆæœ¬è§£å†³ï¼š
âœ… æ‰‹åŠ¨è®¾ç½®minimum_master_nodes
âœ… å…¬å¼ï¼š(masterèŠ‚ç‚¹æ•° / 2) + 1
```

### 9.4 æœ€ä½³å®è·µå»ºè®®


**ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- ğŸ¯ **èŠ‚ç‚¹è§„åˆ’**ï¼šè‡³å°‘3ä¸ªmasterèŠ‚ç‚¹ï¼Œå¥‡æ•°ä¸ªé¿å…è„‘è£‚
- ğŸ¯ **ç½‘ç»œé…ç½®**ï¼šä½¿ç”¨ä¸“ç”¨ç½‘ç»œï¼Œç¡®ä¿ä½å»¶è¿Ÿé«˜å¯é 
- ğŸ¯ **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§é›†ç¾¤çŠ¶æ€å’ŒèŠ‚ç‚¹å¥åº·åº¦
- ğŸ¯ **æ•…éšœæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¢å¤æ¼”ç»ƒ

**é…ç½®ç®¡ç†å»ºè®®**ï¼š
- ğŸ¯ **é…ç½®ç»Ÿä¸€**ï¼šä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·ä¿æŒä¸€è‡´æ€§
- ğŸ¯ **ç‰ˆæœ¬æ§åˆ¶**ï¼šé…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- ğŸ¯ **æ–‡æ¡£è®°å½•**ï¼šè¯¦ç»†è®°å½•é…ç½®å˜æ›´å’ŒåŸå› 
- ğŸ¯ **æµ‹è¯•éªŒè¯**ï¼šé…ç½®å˜æ›´å‰åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

**æ ¸å¿ƒè®°å¿†**ï¼š
- å‘ç°æœºåˆ¶æ˜¯ESé›†ç¾¤çš„"ç¤¾äº¤ç³»ç»Ÿ"
- single-nodeé€‚åˆå¼€å‘ï¼Œzené€‚åˆç”Ÿäº§
- ç§å­ä¸»æœºæ˜¯æ–°èŠ‚ç‚¹çš„"ä»‹ç»äºº"
- initial_master_nodesåªåœ¨é¦–æ¬¡å¯åŠ¨æ—¶æœ‰æ•ˆ
- æ•…éšœæ£€æµ‹æ˜¯é›†ç¾¤çš„"å¥åº·æ£€æŸ¥å‘˜"