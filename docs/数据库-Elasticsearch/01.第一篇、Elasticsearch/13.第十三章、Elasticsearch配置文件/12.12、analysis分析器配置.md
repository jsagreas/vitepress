---
title: 12ã€analysisåˆ†æå™¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [åˆ†æå™¨åŸºç¡€æ¦‚å¿µ](#1-åˆ†æå™¨åŸºç¡€æ¦‚å¿µ)
2. [æ ¸å¿ƒåˆ†æå™¨é…ç½®](#2-æ ¸å¿ƒåˆ†æå™¨é…ç½®)
3. [åˆ†è¯å™¨é…ç½®è¯¦è§£](#3-åˆ†è¯å™¨é…ç½®è¯¦è§£)
4. [è¿‡æ»¤å™¨é…ç½®å®è·µ](#4-è¿‡æ»¤å™¨é…ç½®å®è·µ)
5. [å­—ç¬¦è¿‡æ»¤å™¨é…ç½®](#5-å­—ç¬¦è¿‡æ»¤å™¨é…ç½®)
6. [æ ‡å‡†åŒ–å™¨é…ç½®](#6-æ ‡å‡†åŒ–å™¨é…ç½®)
7. [é»˜è®¤åˆ†æå™¨è®¾ç½®](#7-é»˜è®¤åˆ†æå™¨è®¾ç½®)
8. [æœç´¢åˆ†æå™¨ä¸“é¡¹](#8-æœç´¢åˆ†æå™¨ä¸“é¡¹)
9. [æ…¢æ—¥å¿—é…ç½®](#9-æ…¢æ—¥å¿—é…ç½®)
10. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#10-å®æˆ˜é…ç½®æ¡ˆä¾‹)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” åˆ†æå™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†æå™¨

**é€šä¿—ç†è§£**ï¼šåˆ†æå™¨å°±åƒæ˜¯ä¸€ä¸ª"æ–‡æœ¬å¤„ç†å·¥å‚"ï¼ŒæŠŠä½ è¾“å…¥çš„æ–‡å­—æ‹†è§£ã€æ¸…æ´—ã€æ•´ç†æˆElasticsearchèƒ½ç†è§£çš„æ ¼å¼ã€‚

```
ç”¨æˆ·è¾“å…¥ï¼š"Hello World!"
           â†“
        åˆ†æå™¨å¤„ç†
           â†“
      ["hello", "world"]
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **æ–‡æœ¬åˆ†è§£**ï¼šæŠŠå¥å­æ‹†æˆå•è¯
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€å¤§å°å†™ã€å»é™¤æ ‡ç‚¹
- **ä¼˜åŒ–æœç´¢**ï¼šè®©æœç´¢æ›´å‡†ç¡®ã€æ›´æ™ºèƒ½

### 1.2 åˆ†æå™¨çš„å·¥ä½œæµç¨‹


```
åŸå§‹æ–‡æœ¬ â†’ å­—ç¬¦è¿‡æ»¤å™¨ â†’ åˆ†è¯å™¨ â†’ è¯æ±‡è¿‡æ»¤å™¨ â†’ æœ€ç»ˆè¯æ±‡
   â†“            â†“          â†“          â†“           â†“
"HTMLæ ‡ç­¾"  â†’  æ¸…ç†HTML  â†’  åˆ†è¯   â†’  å°å†™åŒ–   â†’  ["html","æ ‡ç­¾"]
```

**ä¸‰å¤§ç»„ä»¶è¯´æ˜**ï¼š
- ğŸ”¸ **å­—ç¬¦è¿‡æ»¤å™¨**ï¼šå¤„ç†åŸå§‹æ–‡æœ¬ï¼ˆå»HTMLã€æ›¿æ¢ç¬¦å·ï¼‰
- ğŸ”¸ **åˆ†è¯å™¨**ï¼šæŠŠæ–‡æœ¬åˆ‡åˆ†æˆè¯æ±‡ï¼ˆæŒ‰ç©ºæ ¼ã€æ ‡ç‚¹åˆ†å‰²ï¼‰
- ğŸ”¸ **è¯æ±‡è¿‡æ»¤å™¨**ï¼šå¤„ç†è¯æ±‡ï¼ˆè½¬å°å†™ã€å»åœç”¨è¯ã€åŒä¹‰è¯ï¼‰

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦åˆ†æå™¨

**ç”Ÿæ´»ä¾‹å­**ï¼šå°±åƒå›¾ä¹¦é¦†çš„åˆ†ç±»ç³»ç»Ÿ
- ğŸ“š **æ²¡æœ‰åˆ†æå™¨**ï¼šä¹¦ç±éšæ„å †æ”¾ï¼Œæ‰¾ä¹¦å¾ˆå›°éš¾
- ğŸ“š **æœ‰äº†åˆ†æå™¨**ï¼šæŒ‰ç±»åˆ«ã€ä½œè€…ã€ä¸»é¢˜åˆ†ç±»ï¼Œå¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„ä¹¦

**å®é™…å¥½å¤„**ï¼š
```
æœç´¢"è‹¹æœæ‰‹æœº" èƒ½æ‰¾åˆ°ï¼š
âœ… "è‹¹æœæ‰‹æœºå¾ˆå¥½ç”¨"
âœ… "Appleæ‰‹æœºä»·æ ¼"  
âœ… "iPhoneè®¾å¤‡æ¨è"
âŒ æ²¡æœ‰åˆ†æå™¨å°±åªèƒ½ç²¾ç¡®åŒ¹é…
```

---

## 2. âš™ï¸ æ ¸å¿ƒåˆ†æå™¨é…ç½®


### 2.1 analysis.analyzer - è‡ªå®šä¹‰åˆ†æå™¨


**åŸºæœ¬æ¦‚å¿µ**ï¼šå°±åƒç»„è£…ä¸€å°ç”µè„‘ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„é…ä»¶ç»„åˆå‡ºæœ€é€‚åˆä½ éœ€æ±‚çš„åˆ†æå™¨ã€‚

```json
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_custom_analyzer": {
          "type": "custom",
          "char_filter": ["html_strip"],
          "tokenizer": "standard", 
          "filter": ["lowercase", "stop"]
        }
      }
    }
  }
}
```

**é…ç½®è§£è¯»**ï¼š
- ğŸ”¸ **char_filter**: `["html_strip"]` - å»é™¤HTMLæ ‡ç­¾
- ğŸ”¸ **tokenizer**: `"standard"` - ä½¿ç”¨æ ‡å‡†åˆ†è¯å™¨
- ğŸ”¸ **filter**: `["lowercase", "stop"]` - è½¬å°å†™ + å»åœç”¨è¯

### 2.2 å†…ç½®åˆ†æå™¨ç±»å‹


| åˆ†æå™¨ç±»å‹ | **ç”¨é€”è¯´æ˜** | **é€‚ç”¨åœºæ™¯** | **å¤„ç†æ•ˆæœ** |
|---------|------------|-------------|------------|
| ğŸ“ **standard** | `é€šç”¨æ ‡å‡†åˆ†æå™¨` | `ä¸€èˆ¬æ–‡æœ¬æœç´¢` | `"Hello World" â†’ ["hello", "world"]` |
| ğŸ”¤ **simple** | `ç®€å•åˆ†æå™¨` | `åŸºç¡€æ–‡æœ¬å¤„ç†` | `"Hello-World" â†’ ["hello", "world"]` |
| ğŸš« **stop** | `åœç”¨è¯åˆ†æå™¨` | `å»é™¤æ— æ„ä¹‰è¯æ±‡` | `"the quick brown" â†’ ["quick", "brown"]` |
| ğŸ”‘ **keyword** | `å…³é”®è¯åˆ†æå™¨` | `ç²¾ç¡®åŒ¹é…` | `"Hello World" â†’ ["Hello World"]` |
| ğŸŒ **language** | `è¯­è¨€åˆ†æå™¨` | `ç‰¹å®šè¯­è¨€ä¼˜åŒ–` | `æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ç­‰` |

### 2.3 è‡ªå®šä¹‰åˆ†æå™¨å®è·µæ¡ˆä¾‹


**åœºæ™¯**ï¼šä¸ºä¸­æ–‡ç”µå•†ç½‘ç«™é…ç½®å•†å“æœç´¢åˆ†æå™¨

```json
{
  "settings": {
    "analysis": {
      "analyzer": {
        "product_analyzer": {
          "type": "custom",
          "char_filter": ["html_strip"],
          "tokenizer": "ik_max_word",
          "filter": [
            "lowercase",
            "synonym_filter"
          ]
        }
      },
      "filter": {
        "synonym_filter": {
          "type": "synonym",
          "synonyms": [
            "æ‰‹æœº,ç”µè¯,phone",
            "è‹¹æœ,apple,iPhone"
          ]
        }
      }
    }
  }
}
```

**æ•ˆæœæ¼”ç¤º**ï¼š
```
è¾“å…¥ï¼š"è‹¹æœæ‰‹æœºå¾ˆä¸é”™"
å¤„ç†åï¼š["è‹¹æœ", "apple", "iphone", "æ‰‹æœº", "ç”µè¯", "phone", "ä¸é”™"]
æœç´¢æ—¶ï¼šç”¨æˆ·æœ"iPhone"ä¹Ÿèƒ½æ‰¾åˆ°å«"è‹¹æœæ‰‹æœº"çš„å•†å“
```

---

## 3. ğŸ”§ åˆ†è¯å™¨é…ç½®è¯¦è§£


### 3.1 analysis.tokenizer - åˆ†è¯å™¨é…ç½®


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šåˆ†è¯å™¨å°±åƒæ˜¯"æ–‡å­—åˆ‡å‰²åˆ€"ï¼Œå†³å®šå¦‚ä½•æŠŠæ–‡æœ¬åˆ‡åˆ†æˆä¸€ä¸ªä¸ªè¯æ±‡ã€‚

### 3.2 å¸¸ç”¨åˆ†è¯å™¨ç±»å‹


**standard æ ‡å‡†åˆ†è¯å™¨**ï¼š
```json
{
  "tokenizer": {
    "my_standard": {
      "type": "standard",
      "max_token_length": 255
    }
  }
}
```

**å¤„ç†æ•ˆæœ**ï¼š
```
è¾“å…¥ï¼š"Hello, World! 2023å¹´"
è¾“å‡ºï¼š["Hello", "World", "2023", "å¹´"]
ç‰¹ç‚¹ï¼šæŒ‰æ ‡ç‚¹å’Œç©ºæ ¼åˆ†å‰²ï¼Œä¿ç•™æ•°å­—
```

**keyword å…³é”®è¯åˆ†è¯å™¨**ï¼š
```json
{
  "tokenizer": {
    "my_keyword": {
      "type": "keyword",
      "buffer_size": 256
    }
  }
}
```

**å¤„ç†æ•ˆæœ**ï¼š
```
è¾“å…¥ï¼š"åŒ—äº¬å¸‚æœé˜³åŒº"
è¾“å‡ºï¼š["åŒ—äº¬å¸‚æœé˜³åŒº"]
ç‰¹ç‚¹ï¼šæ•´ä¸ªæ–‡æœ¬ä½œä¸ºä¸€ä¸ªè¯æ±‡ï¼Œç”¨äºç²¾ç¡®åŒ¹é…
```

### 3.3 ä¸­æ–‡åˆ†è¯å™¨é…ç½®


**IKåˆ†è¯å™¨**ï¼ˆéœ€è¦å®‰è£…æ’ä»¶ï¼‰ï¼š
```json
{
  "tokenizer": {
    "ik_smart_tokenizer": {
      "type": "ik_smart"
    },
    "ik_max_tokenizer": {
      "type": "ik_max_word"
    }
  }
}
```

**ä¸¤ç§æ¨¡å¼å¯¹æ¯”**ï¼š
```
åŸæ–‡ï¼š"ä¸­åäººæ°‘å…±å’Œå›½"

ik_smartæ¨¡å¼ï¼š
["ä¸­åäººæ°‘å…±å’Œå›½"] (ç²—ç²’åº¦åˆ‡åˆ†)

ik_max_wordæ¨¡å¼ï¼š  
["ä¸­åäººæ°‘å…±å’Œå›½", "ä¸­åäººæ°‘", "ä¸­å", "åäºº", "äººæ°‘å…±å’Œå›½", "äººæ°‘", "å…±å’Œå›½", "å…±å’Œ", "å›½"]
(ç»†ç²’åº¦åˆ‡åˆ†ï¼Œè¦†ç›–æ›´å¤šæœç´¢å¯èƒ½)
```

**é€‰æ‹©å»ºè®®**ï¼š
- ğŸ¯ **ç²¾ç¡®æœç´¢** â†’ ç”¨ `ik_smart`
- ğŸ¯ **æ¨¡ç³Šæœç´¢** â†’ ç”¨ `ik_max_word`

---

## 4. ğŸ”„ è¿‡æ»¤å™¨é…ç½®å®è·µ


### 4.1 analysis.filter - è¿‡æ»¤å™¨é…ç½®


**è¿‡æ»¤å™¨ä½œç”¨**ï¼šå°±åƒæ´—è¡£æœçš„å„ç§ç¨‹åºï¼Œå¯¹è¯æ±‡è¿›è¡Œæ¸…æ´—ã€è½¬æ¢ã€ä¼˜åŒ–ã€‚

### 4.2 åŸºç¡€è¿‡æ»¤å™¨


**lowercase å°å†™è¿‡æ»¤å™¨**ï¼š
```json
{
  "filter": {
    "my_lowercase": {
      "type": "lowercase"
    }
  }
}
```

**æ•ˆæœ**ï¼š`"iPhone" â†’ "iphone"`ï¼Œé¿å…å¤§å°å†™å¯¼è‡´çš„æœç´¢é—æ¼

**stop åœç”¨è¯è¿‡æ»¤å™¨**ï¼š
```json
{
  "filter": {
    "my_stop": {
      "type": "stop",
      "stopwords": ["çš„", "äº†", "åœ¨", "æ˜¯", "å’Œ"]
    }
  }
}
```

**æ•ˆæœ**ï¼šå»é™¤æ— æ„ä¹‰çš„å¸¸ç”¨è¯ï¼Œæé«˜æœç´¢ç²¾åº¦

### 4.3 é«˜çº§è¿‡æ»¤å™¨é…ç½®


**synonym åŒä¹‰è¯è¿‡æ»¤å™¨**ï¼š
```json
{
  "filter": {
    "my_synonym": {
      "type": "synonym",
      "synonyms": [
        "æ‰‹æœº,ç”µè¯,phone,mobile",
        "ç”µè„‘,è®¡ç®—æœº,computer,PC",
        "æ±½è½¦,è½¦è¾†,car,automobile"
      ]
    }
  }
}
```

**åº”ç”¨åœºæ™¯å›¾è§£**ï¼š
```
ç”¨æˆ·æœç´¢è¯æ±‡æ‰©å±•ï¼š
"æ‰‹æœº" â†’ æœç´¢èŒƒå›´æ‰©å¤§åˆ°ï¼š
  â”œâ”€â”€ "æ‰‹æœº"ç›¸å…³å†…å®¹
  â”œâ”€â”€ "ç”µè¯"ç›¸å…³å†…å®¹  
  â”œâ”€â”€ "phone"ç›¸å…³å†…å®¹
  â””â”€â”€ "mobile"ç›¸å…³å†…å®¹
```

**stemmer è¯å¹²æå–è¿‡æ»¤å™¨**ï¼š
```json
{
  "filter": {
    "english_stemmer": {
      "type": "stemmer",
      "language": "english"
    }
  }
}
```

**æ•ˆæœæ¼”ç¤º**ï¼š
```
"running" â†’ "run"
"dogs" â†’ "dog"  
"better" â†’ "better"
è®©ä¸åŒå½¢å¼çš„è¯æ±‡èƒ½åŒ¹é…åˆ°ç›¸åŒå†…å®¹
```

---

## 5. ğŸ§¹ å­—ç¬¦è¿‡æ»¤å™¨é…ç½®


### 5.1 analysis.char_filter - å­—ç¬¦è¿‡æ»¤å™¨


**ä½œç”¨è¯´æ˜**ï¼šåœ¨åˆ†è¯ä¹‹å‰å¯¹åŸå§‹æ–‡æœ¬è¿›è¡Œé¢„å¤„ç†ï¼Œå°±åƒé£Ÿæå¤„ç†å‰çš„æ¸…æ´—å·¥ä½œã€‚

### 5.2 html_strip å­—ç¬¦è¿‡æ»¤å™¨


```json
{
  "char_filter": {
    "my_html_strip": {
      "type": "html_strip",
      "escaped_tags": ["b", "i"]
    }
  }
}
```

**å¤„ç†æ•ˆæœ**ï¼š
```
è¾“å…¥ï¼š<p>è¿™æ˜¯<b>é‡è¦</b>å†…å®¹</p>
è¾“å‡ºï¼šè¿™æ˜¯<b>é‡è¦</b>å†…å®¹
è¯´æ˜ï¼šå»é™¤HTMLæ ‡ç­¾ï¼Œä¿ç•™æŒ‡å®šæ ‡ç­¾
```

### 5.3 mapping å­—ç¬¦æ˜ å°„è¿‡æ»¤å™¨


```json
{
  "char_filter": {
    "my_mapping": {
      "type": "mapping",
      "mappings": [
        "& => and",
        "| => or",
        "â‘  => 1",
        "â‘¡ => 2"
      ]
    }
  }
}
```

**å®é™…åº”ç”¨**ï¼š
```
å¤„ç†å‰ï¼š"Apple & Samsung | Huawei"
å¤„ç†åï¼š"Apple and Samsung or Huawei"
å¥½å¤„ï¼šç»Ÿä¸€ç¬¦å·è¡¨ç¤ºï¼Œæé«˜æœç´¢å‡†ç¡®æ€§
```

### 5.4 pattern_replace æ¨¡å¼æ›¿æ¢è¿‡æ»¤å™¨


```json
{
  "char_filter": {
    "phone_number_filter": {
      "type": "pattern_replace",
      "pattern": "(\\d{3})-(\\d{4})-(\\d{4})",
      "replacement": "$1$2$3"
    }
  }
}
```

**åº”ç”¨å®ä¾‹**ï¼š
```
æ‰‹æœºå·ç æ ‡å‡†åŒ–ï¼š
"138-0013-8000" â†’ "13800138000"
"138 0013 8000" â†’ "13800138000"  
ä¾¿äºç”µè¯å·ç çš„ç»Ÿä¸€æœç´¢
```

---

## 6. ğŸ“ æ ‡å‡†åŒ–å™¨é…ç½®


### 6.1 analysis.normalizer - æ ‡å‡†åŒ–å™¨


**æ¦‚å¿µç†è§£**ï¼šæ ‡å‡†åŒ–å™¨ä¸“é—¨ç”¨äº `keyword` ç±»å‹å­—æ®µï¼Œå¯¹ä¸éœ€è¦åˆ†è¯çš„æ–‡æœ¬è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚

**ä¸åˆ†æå™¨çš„åŒºåˆ«**ï¼š
```
åˆ†æå™¨ï¼š    "Hello World" â†’ ["hello", "world"] (åˆ†è¯)
æ ‡å‡†åŒ–å™¨ï¼š  "Hello World" â†’ "hello world"     (ä¸åˆ†è¯ï¼Œåªæ ‡å‡†åŒ–)
```

### 6.2 æ ‡å‡†åŒ–å™¨é…ç½®ç¤ºä¾‹


```json
{
  "settings": {
    "analysis": {
      "normalizer": {
        "my_normalizer": {
          "type": "custom",
          "char_filter": [],
          "filter": ["lowercase", "asciifolding"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "username": {
        "type": "keyword",
        "normalizer": "my_normalizer"
      }
    }
  }
}
```

**å®é™…æ•ˆæœ**ï¼š
```
å­˜å‚¨ç”¨æˆ·åæ—¶ï¼š
"UserName" â†’ æ ‡å‡†åŒ–ä¸º "username"
"USER_NAME" â†’ æ ‡å‡†åŒ–ä¸º "user_name"

æœç´¢æ—¶ï¼š
æ— è®ºç”¨æˆ·è¾“å…¥ "Username" è¿˜æ˜¯ "username" éƒ½èƒ½æ‰¾åˆ°
```

### 6.3 å¸¸ç”¨æ ‡å‡†åŒ–å™¨åœºæ™¯


**é‚®ç®±åœ°å€æ ‡å‡†åŒ–**ï¼š
```json
{
  "normalizer": {
    "email_normalizer": {
      "filter": ["lowercase", "trim"]
    }
  }
}
```

**å¤„ç†æ•ˆæœ**ï¼š
```
" UserName@Gmail.COM " â†’ "username@gmail.com"
å¥½å¤„ï¼šé¿å…å¤§å°å†™å’Œç©ºæ ¼å¯¼è‡´çš„åŒ¹é…é—®é¢˜
```

---

## 7. ğŸ¯ é»˜è®¤åˆ†æå™¨è®¾ç½®


### 7.1 index.analysis.analyzer.default - é»˜è®¤åˆ†æå™¨


**é‡è¦æ€§**ï¼šå¦‚æœå­—æ®µæ²¡æœ‰æŒ‡å®šåˆ†æå™¨ï¼Œå°±ä¼šä½¿ç”¨é»˜è®¤åˆ†æå™¨ï¼Œå½±å“æ•´ä¸ªç´¢å¼•çš„æœç´¢è¡Œä¸ºã€‚

### 7.2 è®¾ç½®é»˜è®¤åˆ†æå™¨


```json
{
  "settings": {
    "index": {
      "analysis": {
        "analyzer": {
          "default": {
            "type": "custom",
            "tokenizer": "ik_max_word",
            "filter": ["lowercase", "stop"]
          }
        }
      }
    }
  }
}
```

**é…ç½®è¯´æ˜**ï¼š
- ğŸ”¸ **å…¨å±€å½±å“**ï¼šæ‰€æœ‰ `text` ç±»å‹å­—æ®µéƒ½ä¼šä½¿ç”¨è¿™ä¸ªåˆ†æå™¨
- ğŸ”¸ **æ€§èƒ½å½±å“**ï¼šé€‰æ‹©åˆé€‚çš„é»˜è®¤åˆ†æå™¨å¾ˆé‡è¦
- ğŸ”¸ **åæœŸä¿®æ”¹**ï¼šç´¢å¼•åˆ›å»ºåè¾ƒéš¾ä¿®æ”¹ï¼Œéœ€è¦é‡å»ºç´¢å¼•

### 7.3 é»˜è®¤åˆ†æå™¨é€‰æ‹©å»ºè®®


**ä¸­æ–‡ç½‘ç«™æ¨èé…ç½®**ï¼š
```json
{
  "analyzer": {
    "default": {
      "tokenizer": "ik_smart",
      "filter": ["lowercase"]
    }
  }
}
```

**è‹±æ–‡ç½‘ç«™æ¨èé…ç½®**ï¼š
```json
{
  "analyzer": {
    "default": {
      "tokenizer": "standard",
      "filter": ["lowercase", "stop"]
    }
  }
}
```

**å¤šè¯­è¨€ç½‘ç«™æ¨èé…ç½®**ï¼š
```json
{
  "analyzer": {
    "default": {
      "tokenizer": "standard",
      "filter": ["lowercase", "cjk_width", "stop"]
    }
  }
}
```

---

## 8. ğŸ” æœç´¢åˆ†æå™¨ä¸“é¡¹


### 8.1 index.analysis.search_analyzer - æœç´¢åˆ†æå™¨


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šç´¢å¼•æ—¶ç”¨ä¸€å¥—åˆ†æå™¨ï¼Œæœç´¢æ—¶ç”¨å¦ä¸€å¥—åˆ†æå™¨ï¼Œå®ç°æ›´ç²¾å‡†çš„æœç´¢åŒ¹é…ã€‚

### 8.2 ç´¢å¼•åˆ†æå™¨ vs æœç´¢åˆ†æå™¨


```
æ•°æ®æµå‘å›¾ï¼š
æ–‡æ¡£å†™å…¥ â†’ ç´¢å¼•åˆ†æå™¨ â†’ å­˜å‚¨åˆ°å€’æ’ç´¢å¼•
    â†“
æœç´¢æŸ¥è¯¢ â†’ æœç´¢åˆ†æå™¨ â†’ æŸ¥è¯¢è¯æ±‡å¤„ç†
    â†“
è¯æ±‡åŒ¹é… â†’ è¿”å›æœç´¢ç»“æœ
```

**åº”ç”¨åœºæ™¯**ï¼š
```json
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",      // ç´¢å¼•æ—¶ç»†ç²’åº¦åˆ†è¯
        "search_analyzer": "ik_smart"   // æœç´¢æ—¶ç²—ç²’åº¦åˆ†è¯
      }
    }
  }
}
```

**æ•ˆæœå¯¹æ¯”**ï¼š
```
æ–‡æ¡£æ ‡é¢˜ï¼š"ä¸­åäººæ°‘å…±å’Œå›½æˆç«‹"

ç´¢å¼•æ—¶ (ik_max_word)ï¼š
["ä¸­åäººæ°‘å…±å’Œå›½", "ä¸­åäººæ°‘", "ä¸­å", "åäºº", "äººæ°‘å…±å’Œå›½", "äººæ°‘", "å…±å’Œå›½", "å…±å’Œ", "å›½", "æˆç«‹"]

æœç´¢æ—¶ (ik_smart)ï¼š
ç”¨æˆ·æœç´¢"ä¸­åäººæ°‘" â†’ åˆ†è¯ä¸º["ä¸­åäººæ°‘"]
èƒ½åŒ¹é…åˆ°ç´¢å¼•ä¸­çš„"ä¸­åäººæ°‘"è¯æ±‡
```

### 8.3 æœç´¢åˆ†æå™¨é…ç½®å®ä¾‹


**ç”µå•†å•†å“æœç´¢ä¼˜åŒ–**ï¼š
```json
{
  "settings": {
    "analysis": {
      "analyzer": {
        "index_analyzer": {
          "tokenizer": "ik_max_word",
          "filter": ["lowercase", "synonym_expand"]
        },
        "search_analyzer": {
          "tokenizer": "ik_smart", 
          "filter": ["lowercase"]
        }
      },
      "filter": {
        "synonym_expand": {
          "type": "synonym",
          "synonyms": [
            "iPhone,è‹¹æœæ‰‹æœº,appleæ‰‹æœº"
          ]
        }
      }
    }
  }
}
```

**å®é™…æ•ˆæœ**ï¼š
- ğŸ“ **ç´¢å¼•æ—¶**ï¼šåŒä¹‰è¯æ‰©å±•ï¼Œå¢åŠ æœç´¢è¦†ç›–é¢
- ğŸ” **æœç´¢æ—¶**ï¼šç²¾ç¡®åˆ†è¯ï¼Œæé«˜æœç´¢ç²¾åº¦

---

## 9. ğŸ“Š æ…¢æ—¥å¿—é…ç½®


### 9.1 æ…¢æ—¥å¿—çš„é‡è¦æ€§


**ä½œç”¨è¯´æ˜**ï¼šå°±åƒä½“æ£€æŠ¥å‘Šï¼Œå¸®ä½ å‘ç°å“ªäº›æœç´¢å’Œç´¢å¼•æ“ä½œæ¯”è¾ƒæ…¢ï¼Œéœ€è¦ä¼˜åŒ–ã€‚

### 9.2 index.search.slowlog.threshold - æœç´¢æ…¢æ—¥å¿—


```json
{
  "settings": {
    "index.search.slowlog.threshold.query.warn": "10s",
    "index.search.slowlog.threshold.query.info": "5s", 
    "index.search.slowlog.threshold.query.debug": "2s",
    "index.search.slowlog.threshold.query.trace": "500ms",
    "index.search.slowlog.threshold.fetch.warn": "1s",
    "index.search.slowlog.threshold.fetch.info": "800ms",
    "index.search.slowlog.threshold.fetch.debug": "500ms",
    "index.search.slowlog.threshold.fetch.trace": "200ms"
  }
}
```

**æ—¥å¿—çº§åˆ«è¯´æ˜**ï¼š
```
æ€§èƒ½é˜ˆå€¼å›¾ç¤ºï¼š
ğŸŸ¢ æ­£å¸¸     < 500ms   (traceçº§åˆ«)
ğŸŸ¡ æ³¨æ„     < 2s      (debugçº§åˆ«)  
ğŸŸ  å…³æ³¨     < 5s      (infoçº§åˆ«)
ğŸ”´ è­¦å‘Š     < 10s     (warnçº§åˆ«)
ğŸ’¥ ä¸¥é‡     > 10s     (éœ€è¦ç«‹å³ä¼˜åŒ–)
```

### 9.3 index.indexing.slowlog.threshold - ç´¢å¼•æ…¢æ—¥å¿—


```json
{
  "settings": {
    "index.indexing.slowlog.threshold.index.warn": "10s",
    "index.indexing.slowlog.threshold.index.info": "5s",
    "index.indexing.slowlog.threshold.index.debug": "2s", 
    "index.indexing.slowlog.threshold.index.trace": "500ms"
  }
}
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- ğŸ”¸ **ç´¢å¼•å†™å…¥é€Ÿåº¦**ï¼šæ–‡æ¡£å†™å…¥è€—æ—¶
- ğŸ”¸ **åˆ†æå™¨æ€§èƒ½**ï¼šæ–‡æœ¬åˆ†æå¤„ç†æ—¶é—´
- ğŸ”¸ **ç£ç›˜IOæ€§èƒ½**ï¼šå­˜å‚¨å†™å…¥é€Ÿåº¦

### 9.4 æ…¢æ—¥å¿—å®é™…åº”ç”¨


**æ—¥å¿—åˆ†æç¤ºä¾‹**ï¼š
```
[WARN] [index.search.slowlog.query] took[11.2s], took_millis[11280], 
types[], stats[], search_type[QUERY_THEN_FETCH], total_shards[5], 
source[{"query":{"match":{"content":"elasticsearch"}}}]
```

**ä¼˜åŒ–å»ºè®®æµç¨‹**ï¼š
```
å‘ç°æ…¢æŸ¥è¯¢ â†’ åˆ†ææŸ¥è¯¢è¯­å¥ â†’ æ£€æŸ¥åˆ†æå™¨é…ç½® â†’ ä¼˜åŒ–ç´¢å¼•ç»“æ„ â†’ é‡æ–°æµ‹è¯•
    â†“
å¸¸è§é—®é¢˜ï¼š
1. åˆ†æå™¨è¿‡äºå¤æ‚
2. åŒä¹‰è¯åº“è¿‡å¤§  
3. ç´¢å¼•å­—æ®µè¿‡å¤š
4. æŸ¥è¯¢æ¡ä»¶ä¸åˆç†
```

---

## 10. ğŸš€ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 10.1 å®Œæ•´çš„ç”µå•†æœç´¢é…ç½®


**éœ€æ±‚åˆ†æ**ï¼š
- æ”¯æŒä¸­æ–‡å•†å“æœç´¢
- åŒä¹‰è¯æ”¯æŒï¼ˆæ‰‹æœº=ç”µè¯ï¼‰
- å“ç‰Œåç§°ç²¾ç¡®åŒ¹é…
- æ€§èƒ½ç›‘æ§

```json
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1,
    "analysis": {
      "char_filter": {
        "html_cleanup": {
          "type": "html_strip"
        }
      },
      "tokenizer": {
        "ik_smart_tokenizer": {
          "type": "ik_smart"
        },
        "ik_max_tokenizer": {
          "type": "ik_max_word"
        }
      },
      "filter": {
        "product_synonym": {
          "type": "synonym",
          "synonyms": [
            "æ‰‹æœº,ç”µè¯,phone,mobile",
            "ç¬”è®°æœ¬,laptop,notebook",
            "è‹¹æœ,Apple,iPhone",
            "ä¸‰æ˜Ÿ,Samsung"
          ]
        },
        "chinese_stop": {
          "type": "stop",
          "stopwords": ["çš„", "äº†", "åœ¨", "æ˜¯", "å’Œ", "æœ‰", "ä¸ª"]
        }
      },
      "analyzer": {
        "product_index_analyzer": {
          "type": "custom",
          "char_filter": ["html_cleanup"],
          "tokenizer": "ik_max_tokenizer",
          "filter": ["lowercase", "product_synonym", "chinese_stop"]
        },
        "product_search_analyzer": {
          "type": "custom", 
          "tokenizer": "ik_smart_tokenizer",
          "filter": ["lowercase"]
        },
        "brand_analyzer": {
          "type": "keyword",
          "normalizer": "brand_normalizer"
        }
      },
      "normalizer": {
        "brand_normalizer": {
          "filter": ["lowercase", "trim"]
        }
      }
    },
    "index.search.slowlog.threshold.query.warn": "2s",
    "index.indexing.slowlog.threshold.index.warn": "5s"
  },
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "product_index_analyzer",
        "search_analyzer": "product_search_analyzer"
      },
      "description": {
        "type": "text", 
        "analyzer": "product_index_analyzer",
        "search_analyzer": "product_search_analyzer"
      },
      "brand": {
        "type": "keyword",
        "normalizer": "brand_normalizer"
      },
      "price": {
        "type": "double"
      },
      "category": {
        "type": "keyword"
      }
    }
  }
}
```

### 10.2 é…ç½®æ•ˆæœéªŒè¯


**æµ‹è¯•æ•°æ®**ï¼š
```json
{
  "title": "è‹¹æœiPhone 14 Pro Max æ‰‹æœº",
  "description": "å…¨æ–°<b>Apple</b> iPhoneè®¾å¤‡ï¼Œæ€§èƒ½å¼ºåŠ²",
  "brand": "Apple",
  "price": 9999.00,
  "category": "æ‰‹æœºæ•°ç "
}
```

**æœç´¢æµ‹è¯•**ï¼š
```
æœç´¢è¯ï¼š"appleæ‰‹æœº" 
å‘½ä¸­åŸå› ï¼š
- "è‹¹æœ" é€šè¿‡åŒä¹‰è¯åŒ¹é… "apple"
- "æ‰‹æœº" ç›´æ¥åŒ¹é…

æœç´¢è¯ï¼š"ç”µè¯è®¾å¤‡"
å‘½ä¸­åŸå› ï¼š  
- "ç”µè¯" é€šè¿‡åŒä¹‰è¯åŒ¹é… "æ‰‹æœº"
- "è®¾å¤‡" åŒ¹é…æè¿°ä¸­çš„ç›¸å…³è¯æ±‡
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 åˆ†æå™¨é…ç½®æ ¸å¿ƒè¦ç‚¹


```
ğŸ”¸ åˆ†æå™¨=æ–‡æœ¬å¤„ç†å·¥å‚ï¼šæŠŠæ–‡å­—å˜æˆå¯æœç´¢çš„è¯æ±‡
ğŸ”¸ ä¸‰å¤§ç»„ä»¶ï¼šå­—ç¬¦è¿‡æ»¤å™¨â†’åˆ†è¯å™¨â†’è¯æ±‡è¿‡æ»¤å™¨
ğŸ”¸ è‡ªå®šä¹‰é…ç½®ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ç»„è£…ä¸åŒç»„ä»¶
ğŸ”¸ é»˜è®¤è®¾ç½®ï¼šå½±å“æ•´ä¸ªç´¢å¼•ï¼Œéœ€è¦æ…é‡é€‰æ‹©
ğŸ”¸ æœç´¢ä¼˜åŒ–ï¼šç´¢å¼•åˆ†æå™¨â‰ æœç´¢åˆ†æå™¨
```

### 11.2 é…ç½®é€‰æ‹©æŒ‡å—


**ä¸­æ–‡å†…å®¹æ¨è**ï¼š
- ğŸ¯ **åˆ†è¯å™¨**ï¼šik_smartï¼ˆæœç´¢ï¼‰ + ik_max_wordï¼ˆç´¢å¼•ï¼‰
- ğŸ¯ **è¿‡æ»¤å™¨**ï¼šlowercase + ä¸­æ–‡åœç”¨è¯
- ğŸ¯ **åŒä¹‰è¯**ï¼šæ ¹æ®ä¸šåŠ¡é¢†åŸŸå®šåˆ¶

**è‹±æ–‡å†…å®¹æ¨è**ï¼š
- ğŸ¯ **åˆ†è¯å™¨**ï¼šstandard
- ğŸ¯ **è¿‡æ»¤å™¨**ï¼šlowercase + stop + stemmer
- ğŸ¯ **æ ‡å‡†åŒ–**ï¼škeywordå­—æ®µä½¿ç”¨normalizer

**æ··åˆå†…å®¹æ¨è**ï¼š
- ğŸ¯ **åˆ†è¯å™¨**ï¼šstandard + cjkå¤„ç†
- ğŸ¯ **è¿‡æ»¤å™¨**ï¼šå¤šè¯­è¨€stopè¯å…¸
- ğŸ¯ **å­—ç¬¦å¤„ç†**ï¼šç»Ÿä¸€ç¬¦å·å’Œç¼–ç 

### 11.3 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


**åˆ†æå™¨æ€§èƒ½ä¼˜åŒ–**ï¼š
```
é¿å…è¿‡åº¦åˆ†æï¼š
âŒ è¿‡å¤šçš„åŒä¹‰è¯ï¼ˆ>1000æ¡ï¼‰
âŒ è¿‡æ·±çš„è¿‡æ»¤å™¨é“¾ï¼ˆ>5ä¸ªï¼‰
âŒ å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼

æ¨èåšæ³•ï¼š
âœ… åˆç†çš„åŒä¹‰è¯æ•°é‡ï¼ˆ<500æ¡ï¼‰
âœ… ç®€åŒ–çš„è¿‡æ»¤å™¨é“¾ï¼ˆ2-3ä¸ªï¼‰
âœ… é«˜æ•ˆçš„åˆ†è¯å™¨é€‰æ‹©
```

**ç›‘æ§å…³é”®æŒ‡æ ‡**ï¼š
- ğŸ“Š **æœç´¢å»¶è¿Ÿ**ï¼šå¹³å‡å“åº”æ—¶é—´
- ğŸ“Š **ç´¢å¼•é€Ÿåº¦**ï¼šæ–‡æ¡£å†™å…¥é€Ÿç‡
- ğŸ“Š **å†…å­˜ä½¿ç”¨**ï¼šåˆ†æå™¨å†…å­˜å ç”¨
- ğŸ“Š **æ…¢æŸ¥è¯¢**ï¼šè¶…æ—¶æŸ¥è¯¢ç»Ÿè®¡

### 11.4 å¸¸è§é—®é¢˜è§£å†³


**æœç´¢ç»“æœä¸å‡†ç¡®**ï¼š
```
åŸå› åˆ†æï¼š
1. åˆ†æå™¨é…ç½®ä¸å½“
2. åŒä¹‰è¯è®¾ç½®é”™è¯¯
3. åœç”¨è¯è¿‡æ»¤è¿‡åº¦

è§£å†³æ–¹æ¡ˆï¼š
1. ä½¿ç”¨_analyze APIæµ‹è¯•åˆ†ææ•ˆæœ
2. é€æ­¥è°ƒæ•´é…ç½®å‚æ•°
3. å¯¹æ¯”ä¸åŒåˆ†æå™¨æ•ˆæœ
```

**ç´¢å¼•æ€§èƒ½æ…¢**ï¼š
```
åŸå› åˆ†æï¼š
1. åˆ†æå™¨è¿‡äºå¤æ‚
2. åŒä¹‰è¯åº“è¿‡å¤§
3. å­—æ®µåˆ†æé…ç½®è¿‡å¤š

è§£å†³æ–¹æ¡ˆï¼š
1. ç®€åŒ–åˆ†æå™¨é…ç½®
2. ä¼˜åŒ–åŒä¹‰è¯åº“
3. åˆç†é€‰æ‹©éœ€è¦åˆ†æçš„å­—æ®µ
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- åˆ†æå™¨æ˜¯æœç´¢è´¨é‡çš„åŸºç¡€ï¼Œé…ç½®éœ€è¦åå¤æµ‹è¯•ä¼˜åŒ–
- é»˜è®¤åˆ†æå™¨å½±å“å…¨å±€ï¼Œä¿®æ”¹éœ€è¦é‡å»ºç´¢å¼•
- ç´¢å¼•åˆ†æå™¨å’Œæœç´¢åˆ†æå™¨å¯ä»¥ä¸åŒï¼Œå„æœ‰ç”¨é€”
- æ€§èƒ½ç›‘æ§å¾ˆé‡è¦ï¼Œæ…¢æ—¥å¿—å¸®åŠ©å‘ç°é—®é¢˜
- æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„åˆ†æå™¨ç»„åˆ