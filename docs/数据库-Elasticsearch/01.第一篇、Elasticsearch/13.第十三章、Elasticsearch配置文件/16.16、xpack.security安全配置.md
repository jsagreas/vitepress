---
title: 16ã€xpack.securityå®‰å…¨é…ç½®
---
## ğŸ“š ç›®å½•

1. [å®‰å…¨é…ç½®æ¦‚è¿°](#1-å®‰å…¨é…ç½®æ¦‚è¿°)
2. [åŸºç¡€å®‰å…¨åŠŸèƒ½å¯ç”¨](#2-åŸºç¡€å®‰å…¨åŠŸèƒ½å¯ç”¨)
3. [SSL/TLSä¼ è¾“åŠ å¯†é…ç½®](#3-SSL/TLSä¼ è¾“åŠ å¯†é…ç½®)
4. [ç”¨æˆ·è®¤è¯é…ç½®](#4-ç”¨æˆ·è®¤è¯é…ç½®)
5. [æƒé™æˆæƒé…ç½®](#5-æƒé™æˆæƒé…ç½®)
6. [å®¡è®¡æ—¥å¿—é…ç½®](#6-å®¡è®¡æ—¥å¿—é…ç½®)
7. [é«˜çº§å®‰å…¨ç‰¹æ€§](#7-é«˜çº§å®‰å…¨ç‰¹æ€§)
8. [å®é™…åº”ç”¨åœºæ™¯](#8-å®é™…åº”ç”¨åœºæ™¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ å®‰å…¨é…ç½®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Elasticsearchå®‰å…¨é…ç½®


**é€šä¿—ç†è§£**ï¼šå°±åƒç»™ä½ å®¶è£…é—¨é”ã€ç›‘æ§å’Œè®¿å®¢ç™»è®°ç³»ç»Ÿä¸€æ ·ï¼ŒElasticsearchçš„å®‰å…¨é…ç½®å°±æ˜¯ç»™æ•°æ®åº“åŠ ä¸Šå„ç§ä¿æŠ¤æªæ–½ã€‚

```
æ²¡æœ‰å®‰å…¨é…ç½®çš„ESï¼š
ä»»ä½•äºº â†’ ç›´æ¥è®¿é—® â†’ éšæ„æ“ä½œæ•°æ®

æœ‰å®‰å…¨é…ç½®çš„ESï¼š
ç”¨æˆ· â†’ èº«ä»½éªŒè¯ â†’ æƒé™æ£€æŸ¥ â†’ å…è®¸è®¿é—®ç‰¹å®šæ•°æ®
     â†“
   å®¡è®¡è®°å½•   SSLåŠ å¯†ä¼ è¾“   ä¼šè¯ç®¡ç†
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ” **èº«ä»½éªŒè¯**ï¼šç¡®è®¤"ä½ æ˜¯è°"
- ğŸ›¡ï¸ **æƒé™æ§åˆ¶**ï¼šå†³å®š"ä½ èƒ½åšä»€ä¹ˆ"
- ğŸ” **å®¡è®¡ç›‘æ§**ï¼šè®°å½•"ä½ åšäº†ä»€ä¹ˆ"
- ğŸŒ **ä¼ è¾“åŠ å¯†**ï¼šä¿æŠ¤"æ•°æ®åœ¨è·¯ä¸Šçš„å®‰å…¨"

### 1.2 X-Packå®‰å…¨åŠŸèƒ½ç®€ä»‹


**X-Packæ˜¯ä»€ä¹ˆ**ï¼šElasticsearchå®˜æ–¹æä¾›çš„æ‰©å±•åŠŸèƒ½åŒ…ï¼Œå®‰å…¨åŠŸèƒ½æ˜¯å…¶æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚

```
X-Packå®‰å…¨åŠŸèƒ½æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·è¯·æ±‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” è®¤è¯å±‚ (Authentication)         â”‚ â† éªŒè¯ç”¨æˆ·èº«ä»½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ›¡ï¸ æˆæƒå±‚ (Authorization)          â”‚ â† æ£€æŸ¥æ“ä½œæƒé™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” å®¡è®¡å±‚ (Auditing)              â”‚ â† è®°å½•æ“ä½œæ—¥å¿—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ ä¼ è¾“å±‚ (Transport Security)     â”‚ â† SSL/TLSåŠ å¯†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš¡ åŸºç¡€å®‰å…¨åŠŸèƒ½å¯ç”¨


### 2.1 å®‰å…¨åŠŸèƒ½æ€»å¼€å…³


**xpack.security.enabled**

**ä½œç”¨**ï¼šè¿™æ˜¯æ‰€æœ‰å®‰å…¨åŠŸèƒ½çš„æ€»å¼€å…³ï¼Œå°±åƒå®¶é‡Œçš„æ€»ç”µé—¸ã€‚

```yaml
# elasticsearch.yml
xpack.security.enabled: true
```

**é…ç½®è¯´æ˜**ï¼š
- `true`ï¼šå¯ç”¨æ‰€æœ‰å®‰å…¨åŠŸèƒ½
- `false`ï¼šå…³é—­å®‰å…¨åŠŸèƒ½ï¼ˆé»˜è®¤å€¼ï¼Œç”Ÿäº§ç¯å¢ƒä¸æ¨èï¼‰

::: warning é‡è¦æé†’
ä¸€æ—¦å¯ç”¨å®‰å…¨åŠŸèƒ½ï¼Œå¿…é¡»é…ç½®ç”¨æˆ·è´¦å·ï¼Œå¦åˆ™æ— æ³•è®¿é—®é›†ç¾¤ï¼
:::

### 2.2 ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½


**xpack.security.enrollment.enabled**

**é€šä¿—è§£é‡Š**ï¼šå†³å®šæ˜¯å¦å…è®¸æ–°ç”¨æˆ·è‡ªåŠ©æ³¨å†Œï¼Œç±»ä¼¼ç½‘ç«™çš„"æ³¨å†Œæ–°è´¦å·"åŠŸèƒ½ã€‚

```yaml
# å…è®¸ç”¨æˆ·æ³¨å†Œ
xpack.security.enrollment.enabled: true

# ç¦æ­¢ç”¨æˆ·æ³¨å†Œï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒè®¾ç½®ï¼‰
xpack.security.enrollment.enabled: false
```

**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| ç¯å¢ƒ | æ¨èè®¾ç½® | åŸå›  |
|------|---------|------|
| ğŸŸ¢ **å¼€å‘ç¯å¢ƒ** | `true` | æ–¹ä¾¿å¼€å‘äººå‘˜å¿«é€Ÿæ³¨å†Œæµ‹è¯•è´¦å· |
| ğŸŸ¡ **æµ‹è¯•ç¯å¢ƒ** | `true` | æµ‹è¯•äººå‘˜å¯è‡ªè¡Œåˆ›å»ºæµ‹è¯•è´¦å· |
| ğŸ”´ **ç”Ÿäº§ç¯å¢ƒ** | `false` | å®‰å…¨è€ƒè™‘ï¼Œç»Ÿä¸€ç®¡ç†ç”¨æˆ·è´¦å· |

### 2.3 é¦–æ¬¡å¯åŠ¨é…ç½®æŒ‡å—


**æ­¥éª¤æµç¨‹**ï¼š
```
Step â‘ : ä¿®æ”¹é…ç½®æ–‡ä»¶
elasticsearch.yml æ·»åŠ : xpack.security.enabled: true

Step â‘¡: é‡å¯Elasticsearch
systemctl restart elasticsearch

Step â‘¢: è®¾ç½®å†…ç½®ç”¨æˆ·å¯†ç 
bin/elasticsearch-setup-passwords auto

Step â‘£: è®°å½•ç”Ÿæˆçš„å¯†ç 
elasticç”¨æˆ·å¯†ç : xxxxx
kibanaç”¨æˆ·å¯†ç : xxxxx
```

---

## 3. ğŸŒ SSL/TLSä¼ è¾“åŠ å¯†é…ç½®


### 3.1 HTTPå±‚SSLé…ç½®


**xpack.security.http.ssl.enabled**

**é€šä¿—ç†è§£**ï¼šå°±åƒç½‘ç«™çš„HTTPSä¸€æ ·ï¼Œç¡®ä¿å®¢æˆ·ç«¯åˆ°Elasticsearchçš„è¿æ¥æ˜¯åŠ å¯†çš„ã€‚

```yaml
# å¯ç”¨HTTP SSL
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: certs/http.p12
xpack.security.http.ssl.truststore.path: certs/http.p12
```

**é…ç½®æ•ˆæœå¯¹æ¯”**ï¼š
```
æœªå¯ç”¨SSLï¼š
å®¢æˆ·ç«¯ --[æ˜æ–‡ä¼ è¾“]--> Elasticsearch
         â†‘ å®¹æ˜“è¢«çªƒå¬

å¯ç”¨SSLï¼š
å®¢æˆ·ç«¯ --[åŠ å¯†ä¼ è¾“]--> Elasticsearch
         â†‘ å®‰å…¨ä¼ è¾“
```

### 3.2 èŠ‚ç‚¹é—´ä¼ è¾“SSLé…ç½®


**xpack.security.transport.ssl.enabled**

**ä½œç”¨**ï¼šä¿æŠ¤Elasticsearché›†ç¾¤å†…éƒ¨èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å®‰å…¨ã€‚

```yaml
# å¯ç”¨èŠ‚ç‚¹é—´SSL
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path: certs/transport.p12
xpack.security.transport.ssl.truststore.path: certs/transport.p12
```

**é›†ç¾¤é€šä¿¡ç¤ºæ„å›¾**ï¼š
```
MasterèŠ‚ç‚¹ â†--[SSLåŠ å¯†]--â†’ DataèŠ‚ç‚¹1
    â†‘                        â†“
    â””--[SSLåŠ å¯†]--â†’ DataèŠ‚ç‚¹2 â†â”˜
    
æ‰€æœ‰èŠ‚ç‚¹é—´é€šä¿¡éƒ½ç»è¿‡SSLåŠ å¯†ä¿æŠ¤
```

### 3.3 è¯ä¹¦ç”Ÿæˆä¸ç®¡ç†


**å¿«é€Ÿç”Ÿæˆè¯ä¹¦**ï¼š
```bash
# ç”ŸæˆCAè¯ä¹¦
bin/elasticsearch-certutil ca

# ç”ŸæˆèŠ‚ç‚¹è¯ä¹¦
bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12

# ç”ŸæˆHTTPè¯ä¹¦
bin/elasticsearch-certutil http
```

**è¯ä¹¦æ–‡ä»¶è¯´æ˜**ï¼š
- ğŸ“„ `elastic-stack-ca.p12`ï¼šCAæ ¹è¯ä¹¦
- ğŸ“„ `elastic-certificates.p12`ï¼šèŠ‚ç‚¹è¯ä¹¦
- ğŸ“„ `elasticsearch-ssl-http.zip`ï¼šHTTPè¯ä¹¦åŒ…

---

## 4. ğŸ‘¤ ç”¨æˆ·è®¤è¯é…ç½®


### 4.1 è®¤è¯åŸŸé…ç½®æ¦‚è¿°


**xpack.security.authc.realms**

**é€šä¿—è§£é‡Š**ï¼šè®¤è¯åŸŸå°±åƒä¸åŒçš„"èº«ä»½éªŒè¯çª—å£"ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸åŒæ–¹å¼è¯æ˜èº«ä»½ã€‚

```
è®¤è¯åŸŸç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬åœ°ç”¨æˆ·åº“     â”‚  â”‚      LDAP      â”‚  â”‚   Active Directory â”‚
â”‚   (native)     â”‚  â”‚     è®¤è¯åŸŸ      â”‚  â”‚      è®¤è¯åŸŸ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                     â†“                     â†“
      ESå†…ç½®            ä¼ä¸šLDAPæœåŠ¡å™¨         Windows ADåŸŸ
```

### 4.2 æœ¬åœ°è®¤è¯åŸŸé…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
xpack.security.authc.realms.native.native1:
  order: 0  # è®¤è¯é¡ºåºï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
  enabled: true
```

**å†…ç½®ç”¨æˆ·è¯´æ˜**ï¼š

| ç”¨æˆ·å | é»˜è®¤è§’è‰² | ç”¨é€”è¯´æ˜ | é‡è¦ç¨‹åº¦ |
|--------|---------|----------|----------|
| `elastic` | `superuser` | è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ | ğŸ”¥**æœ€é«˜** |
| `kibana_system` | `kibana_system` | KibanaæœåŠ¡ä¸“ç”¨è´¦å· | â­**é‡è¦** |
| `logstash_system` | `logstash_system` | LogstashæœåŠ¡ä¸“ç”¨è´¦å· | â­**é‡è¦** |
| `beats_system` | `beats_system` | Beatsç»„ä»¶ä¸“ç”¨è´¦å· | ğŸ’**ä¸­ç­‰** |

### 4.3 LDAPè®¤è¯åŸŸé…ç½®


**ä¼ä¸šçº§LDAPé›†æˆ**ï¼š
```yaml
xpack.security.authc.realms.ldap.ldap1:
  order: 1
  url: "ldaps://ldap.company.com:636"
  bind_dn: "cn=elasticsearch,ou=services,dc=company,dc=com"
  bind_password: "password"
  user_search:
    base_dn: "ou=users,dc=company,dc=com"
    filter: "(cn={0})"
  group_search:
    base_dn: "ou=groups,dc=company,dc=com"
```

**LDAPè®¤è¯æµç¨‹**ï¼š
```
ç”¨æˆ·ç™»å½• â†’ ESæŸ¥è¯¢LDAP â†’ éªŒè¯å¯†ç  â†’ è·å–ç”¨æˆ·ç»„ â†’ åˆ†é…è§’è‰² â†’ å…è®¸è®¿é—®
    â†“           â†“          â†“         â†“         â†“         â†“
  è¾“å…¥è´¦å·   è¿æ¥LDAPæœåŠ¡å™¨  å¯†ç æ­£ç¡®   è·å–æƒé™   æ˜ å°„ESè§’è‰²  è®¿é—®èµ„æº
```

---

## 5. ğŸ›¡ï¸ æƒé™æˆæƒé…ç½®


### 5.1 æˆæƒå­˜å‚¨ç±»å‹


**xpack.security.authz.store.type**

**é€šä¿—ç†è§£**ï¼šå†³å®šæƒé™ä¿¡æ¯å­˜å‚¨åœ¨å“ªé‡Œï¼Œå°±åƒå†³å®šæŠŠé’¥åŒ™æ”¾åœ¨å“ªä¸ªæŠ½å±‰é‡Œã€‚

```yaml
# å­˜å‚¨åœ¨ESå†…éƒ¨ï¼ˆæ¨èï¼‰
xpack.security.authz.store.type: native

# å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼ˆå·²åºŸå¼ƒï¼‰
xpack.security.authz.store.type: file
```

**å­˜å‚¨æ–¹å¼å¯¹æ¯”**ï¼š

| å­˜å‚¨ç±»å‹ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èåº¦ |
|---------|------|------|--------|
| `native` | åŠ¨æ€ç®¡ç†ã€é«˜å¯ç”¨ã€æ˜“ç»´æŠ¤ | æ— æ˜æ˜¾ç¼ºç‚¹ | âœ…**å¼ºçƒˆæ¨è** |
| `file` | é…ç½®ç®€å• | é™æ€é…ç½®ã€ç»´æŠ¤å›°éš¾ | âŒ**å·²åºŸå¼ƒ** |

### 5.2 è§’è‰²ä¸æƒé™ä½“ç³»


**æƒé™å±‚çº§å…³ç³»**ï¼š
```
ç”¨æˆ· (User)
  â†“ åˆ†é…
è§’è‰² (Role)
  â†“ åŒ…å«
æƒé™ (Privileges)
  â†“ ä½œç”¨äº
èµ„æº (Resources)

ç¤ºä¾‹ï¼š
ç”¨æˆ· john â†’ è§’è‰² data_analyst â†’ æƒé™ read â†’ èµ„æº logs-* ç´¢å¼•
```

### 5.3 å¸¸ç”¨è§’è‰²æƒé™é…ç½®


**å†…ç½®è§’è‰²è¯´æ˜**ï¼š

| è§’è‰²åç§° | æƒé™èŒƒå›´ | é€‚ç”¨åœºæ™¯ | å®‰å…¨çº§åˆ« |
|---------|----------|----------|----------|
| `superuser` | æ‰€æœ‰æƒé™ | ç³»ç»Ÿç®¡ç†å‘˜ | ğŸ”´**æœ€é«˜** |
| `kibana_admin` | Kibanaå®Œå…¨ç®¡ç† | Kibanaç®¡ç†å‘˜ | ğŸŸ¡**ä¸­é«˜** |
| `editor` | ç´¢å¼•è¯»å†™æƒé™ | æ•°æ®åˆ†æå¸ˆ | ğŸŸ¡**ä¸­ç­‰** |
| `viewer` | ç´¢å¼•åªè¯»æƒé™ | æŠ¥è¡¨æŸ¥çœ‹è€… | ğŸŸ¢**è¾ƒä½** |

**è‡ªå®šä¹‰è§’è‰²ç¤ºä¾‹**ï¼š
```json
{
  "log_reader": {
    "cluster": ["monitor"],
    "indices": [
      {
        "names": ["logs-*", "metrics-*"],
        "privileges": ["read", "view_index_metadata"]
      }
    ]
  }
}
```

---

## 6. ğŸ” å®¡è®¡æ—¥å¿—é…ç½®


### 6.1 å®¡è®¡åŠŸèƒ½å¯ç”¨


**xpack.security.audit.enabled**

**é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡Œçš„ç›‘æ§æ‘„åƒå¤´ï¼Œè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆæ“ä½œã€‚

```yaml
# å¯ç”¨å®¡è®¡æ—¥å¿—
xpack.security.audit.enabled: true

# å®¡è®¡æ—¥å¿—è¾“å‡ºæ–¹å¼
xpack.security.audit.outputs: [index, logfile]
```

### 6.2 å®¡è®¡äº‹ä»¶ç±»å‹


**è®°å½•çš„å…³é”®äº‹ä»¶**ï¼š

```
ğŸ“‹ å®¡è®¡äº‹ä»¶ç±»å‹ï¼š
â”œâ”€â”€ ğŸ” è®¤è¯äº‹ä»¶
â”‚   â”œâ”€â”€ authentication_success (ç™»å½•æˆåŠŸ)
â”‚   â”œâ”€â”€ authentication_failed (ç™»å½•å¤±è´¥)
â”‚   â””â”€â”€ realm_authentication_failed (åŸŸè®¤è¯å¤±è´¥)
â”œâ”€â”€ ğŸ›¡ï¸ æˆæƒäº‹ä»¶  
â”‚   â”œâ”€â”€ access_granted (è®¿é—®å…è®¸)
â”‚   â”œâ”€â”€ access_denied (è®¿é—®æ‹’ç»)
â”‚   â””â”€â”€ privilege_check (æƒé™æ£€æŸ¥)
â”œâ”€â”€ ğŸ”§ ç³»ç»Ÿäº‹ä»¶
â”‚   â”œâ”€â”€ system_access_granted (ç³»ç»Ÿè®¿é—®)
â”‚   â”œâ”€â”€ connection_granted (è¿æ¥å»ºç«‹)
â”‚   â””â”€â”€ connection_denied (è¿æ¥æ‹’ç»)
â””â”€â”€ ğŸ“Š æ•°æ®äº‹ä»¶
    â”œâ”€â”€ index_event (ç´¢å¼•æ“ä½œ)
    â”œâ”€â”€ document_event (æ–‡æ¡£æ“ä½œ)
    â””â”€â”€ query_event (æŸ¥è¯¢æ“ä½œ)
```

### 6.3 å®¡è®¡æ—¥å¿—é…ç½®ç¤ºä¾‹


**è¯¦ç»†é…ç½®**ï¼š
```yaml
xpack.security.audit.enabled: true
xpack.security.audit.outputs: [index, logfile]

# ç´¢å¼•è¾“å‡ºé…ç½®
xpack.security.audit.index:
  events:
    include: [authentication_failed, access_denied, access_granted]
  settings:
    index.number_of_shards: 1
    index.number_of_replicas: 0

# æ—¥å¿—æ–‡ä»¶è¾“å‡ºé…ç½®  
xpack.security.audit.logfile:
  events:
    include: [authentication_failed, access_denied]
    exclude: [authentication_success]
```

**å®¡è®¡æ—¥å¿—ç¤ºä¾‹**ï¼š
```json
{
  "@timestamp": "2024-12-21T10:30:00.123Z",
  "event.type": "access_denied",
  "user.name": "john",
  "elasticsearch.request.method": "DELETE",
  "elasticsearch.request.uri": "/important_data/_doc/1",
  "source.ip": "192.168.1.100"
}
```

---

## 7. ğŸ”’ é«˜çº§å®‰å…¨ç‰¹æ€§


### 7.1 FIPSæ¨¡å¼é…ç½®


**xpack.security.fips_mode.enabled**

**FIPSæ˜¯ä»€ä¹ˆ**ï¼šç¾å›½è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼Œè¦æ±‚ä½¿ç”¨ç»è¿‡è®¤è¯çš„åŠ å¯†ç®—æ³•ã€‚

```yaml
# å¯ç”¨FIPSæ¨¡å¼ï¼ˆæ”¿åºœæˆ–é«˜å®‰å…¨è¦æ±‚ç¯å¢ƒï¼‰
xpack.security.fips_mode.enabled: true
```

**FIPSæ¨¡å¼å½±å“**ï¼š
- âœ… åªèƒ½ä½¿ç”¨FIPSè®¤è¯çš„åŠ å¯†ç®—æ³•
- âš ï¸ éƒ¨åˆ†åŠ å¯†é€‰é¡¹ä¼šè¢«é™åˆ¶
- ğŸ¯ é€‚ç”¨äºæ”¿åºœã€é‡‘èç­‰é«˜å®‰å…¨è¦æ±‚åœºæ™¯

### 7.2 ä¼šè¯ç®¡ç†é…ç½®


**xpack.security.session.idletimeout**

**ä½œç”¨**ï¼šæ§åˆ¶ç”¨æˆ·ä¼šè¯çš„ç©ºé—²è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢é•¿æ—¶é—´æ— æ“ä½œçš„å®‰å…¨é£é™©ã€‚

```yaml
# è®¾ç½®ä¼šè¯30åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨é€€å‡º
xpack.security.session.idletimeout: 30m

# å…¶ä»–æ—¶é—´å•ä½ç¤ºä¾‹
xpack.security.session.idletimeout: 1h   # 1å°æ—¶
xpack.security.session.idletimeout: 2d   # 2å¤©
```

**ä¼šè¯è¶…æ—¶æœºåˆ¶**ï¼š
```
ç”¨æˆ·ç™»å½• â†’ è·å¾—ä¼šè¯ä»¤ç‰Œ â†’ æ­£å¸¸æ“ä½œé‡ç½®è®¡æ—¶å™¨
     â†“                    â†“
   è®¾ç½®è¶…æ—¶            æ— æ“ä½œ30åˆ†é’Ÿ
     â†“                    â†“  
  å¼€å§‹è®¡æ—¶              è‡ªåŠ¨æ³¨é”€
```

### 7.3 APIå¯†é’¥ç®¡ç†


**API Keyè®¤è¯**ï¼š
```bash
# åˆ›å»ºAPIå¯†é’¥
POST /_security/api_key
{
  "name": "my-api-key",
  "expiration": "1d",
  "role_descriptors": {
    "role-a": {
      "cluster": ["monitor"],
      "index": [
        {
          "names": ["logs-*"],
          "privileges": ["read"]
        }
      ]
    }
  }
}
```

**APIå¯†é’¥ä½¿ç”¨åœºæ™¯**ï¼š
- ğŸ¤– **åº”ç”¨ç¨‹åºè®¤è¯**ï¼šæœåŠ¡é—´è°ƒç”¨
- ğŸ“Š **æ•°æ®é‡‡é›†å·¥å…·**ï¼šBeatsã€Logstashç­‰
- ğŸ”Œ **ç¬¬ä¸‰æ–¹é›†æˆ**ï¼šå¤–éƒ¨ç³»ç»Ÿè®¿é—®ES

---

## 8. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 8.1 å°å‹å›¢é˜Ÿå¿«é€Ÿé…ç½®


**åœºæ™¯**ï¼š10äººä»¥ä¸‹çš„å¼€å‘å›¢é˜Ÿï¼Œéœ€è¦åŸºç¡€å®‰å…¨ä¿æŠ¤ã€‚

**æ¨èé…ç½®**ï¼š
```yaml
# åŸºç¡€å®‰å…¨é…ç½®
xpack.security.enabled: true
xpack.security.enrollment.enabled: false

# ä»…å¯ç”¨HTTP SSL
xpack.security.http.ssl.enabled: true
xpack.security.transport.ssl.enabled: false  # å•èŠ‚ç‚¹å¯å…³é—­

# æœ¬åœ°ç”¨æˆ·è®¤è¯
xpack.security.authc.realms.native.native1:
  order: 0
  enabled: true

# åŸºç¡€å®¡è®¡
xpack.security.audit.enabled: true
xpack.security.audit.outputs: [logfile]
```

### 8.2 ä¼ä¸šçº§å®‰å…¨é…ç½®


**åœºæ™¯**ï¼šå¤§å‹ä¼ä¸šï¼Œéœ€è¦é›†æˆLDAPï¼Œä¸¥æ ¼çš„å®‰å…¨è¦æ±‚ã€‚

**æ¨èé…ç½®**ï¼š
```yaml
# å®Œæ•´å®‰å…¨åŠŸèƒ½
xpack.security.enabled: true
xpack.security.enrollment.enabled: false

# å…¨é¢SSLåŠ å¯†
xpack.security.http.ssl.enabled: true
xpack.security.transport.ssl.enabled: true

# LDAPé›†æˆ
xpack.security.authc.realms.ldap.ldap1:
  order: 0
  enabled: true
  url: "ldaps://ldap.company.com:636"
  # ... è¯¦ç»†LDAPé…ç½®

# æœ¬åœ°è®¤è¯ä½œä¸ºå¤‡ä»½
xpack.security.authc.realms.native.native1:
  order: 1
  enabled: true

# å®Œæ•´å®¡è®¡
xpack.security.audit.enabled: true
xpack.security.audit.outputs: [index, logfile]

# ä¼šè¯ç®¡ç†
xpack.security.session.idletimeout: 1h
```

### 8.3 é…ç½®æœ€ä½³å®è·µæ¸…å•


**å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•**ï¼š

```
ğŸ”² åŸºç¡€é…ç½®
  â”œâ”€â”€ âœ… å¯ç”¨xpack.security.enabled
  â”œâ”€â”€ âœ… ç¦ç”¨enrollmentï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
  â”œâ”€â”€ âœ… è®¾ç½®å¼ºå¯†ç ç­–ç•¥
  â””â”€â”€ âœ… å®šæœŸæ›´æ–°å¯†ç 

ğŸ”² ä¼ è¾“å®‰å…¨
  â”œâ”€â”€ âœ… å¯ç”¨HTTP SSL
  â”œâ”€â”€ âœ… å¯ç”¨Transport SSLï¼ˆé›†ç¾¤ç¯å¢ƒï¼‰
  â”œâ”€â”€ âœ… ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•
  â””â”€â”€ âœ… å®šæœŸæ›´æ–°è¯ä¹¦

ğŸ”² ç”¨æˆ·ç®¡ç†
  â”œâ”€â”€ âœ… æœ€å°æƒé™åŸåˆ™
  â”œâ”€â”€ âœ… å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
  â”œâ”€â”€ âœ… ç¦ç”¨ä¸å¿…è¦çš„å†…ç½®ç”¨æˆ·
  â””â”€â”€ âœ… ä½¿ç”¨è§’è‰²åˆ†ç¦»

ğŸ”² ç›‘æ§å®¡è®¡
  â”œâ”€â”€ âœ… å¯ç”¨å®¡è®¡æ—¥å¿—
  â”œâ”€â”€ âœ… ç›‘æ§å¤±è´¥ç™»å½•
  â”œâ”€â”€ âœ… è®¾ç½®å‘Šè­¦è§„åˆ™
  â””â”€â”€ âœ… å®šæœŸåˆ†ææ—¥å¿—
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®‰å…¨ä¸‰è¦ç´ ï¼šè®¤è¯(Authentication)ã€æˆæƒ(Authorization)ã€å®¡è®¡(Auditing)
ğŸ”¸ X-Packå®‰å…¨ï¼šElasticsearchå®˜æ–¹å®‰å…¨è§£å†³æ–¹æ¡ˆ
ğŸ”¸ SSL/TLSï¼šä¼ è¾“å±‚åŠ å¯†ï¼Œä¿æŠ¤æ•°æ®ä¼ è¾“å®‰å…¨
ğŸ”¸ è®¤è¯åŸŸï¼šä¸åŒçš„èº«ä»½éªŒè¯æ–¹å¼ï¼ˆæœ¬åœ°ã€LDAPã€ADç­‰ï¼‰
ğŸ”¸ è§’è‰²æƒé™ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC)æ¨¡å‹
ğŸ”¸ å®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³äº‹ä»¶
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®‰å…¨é…ç½®çš„å±‚æ¬¡æ€§**
```
ç†è§£è¦ç‚¹ï¼š
- æ€»å¼€å…³ â†’ åŠŸèƒ½æ¨¡å— â†’ å…·ä½“å‚æ•°
- å…ˆå¯ç”¨åŸºç¡€åŠŸèƒ½ï¼Œå†é…ç½®è¯¦ç»†å‚æ•°
- éµå¾ªæœ€å°æƒé™åŸåˆ™
```

**ğŸ”¹ è¯ä¹¦ä¸SSLçš„é‡è¦æ€§**
```
è®°å¿†æ–¹æ³•ï¼š
- HTTP SSLï¼šä¿æŠ¤å®¢æˆ·ç«¯åˆ°ESçš„è¿æ¥
- Transport SSLï¼šä¿æŠ¤ESèŠ‚ç‚¹é—´çš„è¿æ¥  
- è¯ä¹¦ç®¡ç†ï¼šå®šæœŸæ›´æ–°ï¼Œé˜²æ­¢è¿‡æœŸ
```

**ğŸ”¹ ç”¨æˆ·æƒé™è®¾è®¡åŸåˆ™**
```
å®é™…åº”ç”¨ï¼š
- æŒ‰èŒèƒ½åˆ†é…è§’è‰²ï¼Œä¸ç»™ä¸ªäººç‰¹æ®Šæƒé™
- å®šæœŸå®¡æŸ¥æƒé™ï¼ŒåŠæ—¶å›æ”¶ä¸éœ€è¦çš„æƒé™
- ä½¿ç”¨API Keyä»£æ›¿ç”¨æˆ·å¯†ç è¿›è¡Œç¨‹åºè®¤è¯
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ç¯å¢ƒé…ç½®å»ºè®®**ï¼š

| ç¯å¢ƒç±»å‹ | å®‰å…¨ç­‰çº§ | æ¨èé…ç½® | é‡ç‚¹å…³æ³¨ |
|---------|---------|----------|----------|
| ğŸŸ¢ **å¼€å‘ç¯å¢ƒ** | åŸºç¡€ | å¯ç”¨è®¤è¯ï¼ŒHTTP SSLå¯é€‰ | ä¾¿äºå¼€å‘è°ƒè¯• |
| ğŸŸ¡ **æµ‹è¯•ç¯å¢ƒ** | ä¸­ç­‰ | æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒé…ç½® | åŠŸèƒ½éªŒè¯ |
| ğŸ”´ **ç”Ÿäº§ç¯å¢ƒ** | æœ€é«˜ | å…¨åŠŸèƒ½å®‰å…¨é…ç½® | å®‰å…¨æ€§ä¼˜å…ˆ |

**å¸¸è§é…ç½®é”™è¯¯é¿å…**ï¼š
- âŒ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é»˜è®¤å¯†ç 
- âŒ è¯ä¹¦è¿‡æœŸæœªåŠæ—¶æ›´æ–°  
- âŒ æƒé™é…ç½®è¿‡äºå®½æ¾
- âŒ å®¡è®¡æ—¥å¿—æœªå¯ç”¨
- âŒ SSLé…ç½®ä¸å½“å¯¼è‡´æ€§èƒ½é—®é¢˜

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ESå®‰å…¨é…ç½®è¦è®°ç‰¢ï¼Œ
è®¤è¯æˆæƒå®¡è®¡å°‘ä¸äº†ï¼Œ
SSLåŠ å¯†ä¿ä¼ è¾“ï¼Œ
ç”¨æˆ·æƒé™è¦æ§å¥½ï¼Œ
å®šæœŸæ£€æŸ¥å’Œç»´æŠ¤ï¼Œ
å®‰å…¨è¿è¡Œæ²¡çƒ¦æ¼ã€‚
```

### 9.4 é…ç½®æ–‡ä»¶æ¨¡æ¿


**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# === Elasticsearchå®‰å…¨é…ç½®æ¨¡æ¿ ===

# 1. åŸºç¡€å®‰å…¨åŠŸèƒ½
xpack.security.enabled: true
xpack.security.enrollment.enabled: false

# 2. SSL/TLSé…ç½®
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: certs/http.p12
xpack.security.transport.ssl.enabled: true  
xpack.security.transport.ssl.keystore.path: certs/transport.p12

# 3. è®¤è¯é…ç½®
xpack.security.authc.realms.native.native1:
  order: 0
  enabled: true

# 4. æˆæƒé…ç½®
xpack.security.authz.store.type: native

# 5. å®¡è®¡é…ç½®
xpack.security.audit.enabled: true
xpack.security.audit.outputs: [index, logfile]

# 6. ä¼šè¯ç®¡ç†
xpack.security.session.idletimeout: 30m

# 7. é«˜çº§åŠŸèƒ½ï¼ˆæŒ‰éœ€å¯ç”¨ï¼‰
# xpack.security.fips_mode.enabled: false
```

è¿™ä»½é…ç½®æ¶µç›–äº†Elasticsearchå®‰å…¨åŠŸèƒ½çš„æ‰€æœ‰æ ¸å¿ƒè¦ç´ ï¼Œé€‚åˆä½œä¸ºç”Ÿäº§ç¯å¢ƒçš„èµ·å§‹é…ç½®æ¨¡æ¿ã€‚è®°ä½è¦æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å…·ä½“å‚æ•°ï¼Œå¹¶å®šæœŸè¿›è¡Œå®‰å…¨å®¡æŸ¥å’Œç»´æŠ¤ã€‚