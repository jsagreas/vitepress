---
title: 7、node节点配置
---
## 📚 目录

1. [节点配置基础概念](#1-节点配置基础概念)
2. [节点角色详解](#2-节点角色详解)
3. [核心配置参数解析](#3-核心配置参数解析)
4. [节点角色配置实践](#4-节点角色配置实践)
5. [节点属性与定制化](#5-节点属性与定制化)
6. [本地存储配置](#6-本地存储配置)
7. [配置最佳实践](#7-配置最佳实践)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🏗️ 节点配置基础概念


### 1.1 什么是Elasticsearch节点


**通俗理解**：把Elasticsearch集群想象成一个公司，**节点就是公司里的员工**。每个员工都有自己的名字、职责和特长。

```
现实公司组织：              Elasticsearch集群：
     总经理                    Master节点
    /      \                  /          \
  技术总监  运营总监          Data节点    Ingest节点
  /    \      \              /    \        \
开发员 测试员 客服员        索引A  索引B    数据处理
```

**核心作用**：
- 🎯 **身份标识**：每个节点都有独特的名称和标识
- 🔧 **角色分工**：不同节点承担不同的职责
- 📊 **资源管理**：控制节点使用的资源和能力
- 🌐 **集群协调**：节点间相互配合完成任务

### 1.2 节点配置的重要性


**为什么要配置节点**：
- **🎭 明确角色**：告诉节点"你是做什么的"
- **⚡ 优化性能**：让每个节点专注自己擅长的事
- **🛡️ 提高稳定性**：避免单个节点承担过多职责
- **📈 便于扩展**：新节点加入时能快速融入团队

### 1.3 配置文件位置


**配置文件路径**：
```bash
# 主配置文件
$ES_HOME/config/elasticsearch.yml

# 日志配置
$ES_HOME/config/log4j2.properties

# JVM配置  
$ES_HOME/config/jvm.options
```

---

## 2. 🎭 节点角色详解


### 2.1 节点角色概念


**简单理解**：节点角色就像员工的岗位职责，决定了这个节点在集群中主要负责什么工作。

```
传统单一节点：                现代角色分工：
    ┌─────────────┐              ┌─Master─┐ ┌─Data─┐
    │             │              │管理集群 │ │存数据│
    │ 什么都做的   │       →      └───────┘ └─────┘
    │ 万能节点     │              ┌─Ingest─┐ ┌─ML───┐
    │             │              │处理数据 │ │机器学│
    └─────────────┘              └───────┘ └─习──┘
```

### 2.2 主要节点角色类型


| 角色类型 | **主要职责** | **类比** | **适用场景** |
|---------|-------------|---------|-------------|
| 🎯 **master** | `集群管理、索引操作` | `公司经理` | `小集群或专门管理节点` |
| 📊 **data** | `存储数据、搜索查询` | `仓库管理员` | `数据存储和检索` |
| 🔄 **ingest** | `数据预处理、格式转换` | `数据处理员` | `需要数据清洗的场景` |
| 🤖 **ml** | `机器学习任务` | `数据分析师` | `智能分析需求` |
| 🔄 **transform** | `数据转换聚合` | `报表制作员` | `数据汇总分析` |
| 🌐 **remote_cluster_client** | `跨集群通信` | `外联专员` | `多集群环境` |

### 2.3 角色组合策略


**常见组合方式**：

```
小型集群（1-3节点）：
节点配置：[master, data, ingest]
说明：一个节点身兼数职，像小公司员工

中型集群（4-10节点）：
Master节点：[master] 
Data节点：[data, ingest]
说明：开始专业分工，管理和存储分离

大型集群（10+节点）：
Master节点：[master]
Data节点：[data]  
Ingest节点：[ingest]
ML节点：[ml]
说明：精细化分工，各司其职
```

---

## 3. ⚙️ 核心配置参数解析


### 3.1 节点名称配置


**node.name** - 节点的身份证

```yaml
# 设置节点唯一名称
node.name: "elasticsearch-node-01"

# 也可以使用主机名
node.name: "${HOSTNAME}"

# 或者自定义命名规则
node.name: "prod-data-node-${HOSTNAME}"
```

**配置建议**：
- ✅ **使用有意义的名称**：如 `prod-master-01`、`data-node-beijing`
- ✅ **包含环境信息**：区分开发、测试、生产环境
- ✅ **包含角色信息**：从名称就能看出节点作用
- ❌ **避免重复名称**：集群中每个节点名称必须唯一

### 3.2 节点角色配置（推荐方式）


**node.roles** - 告诉节点"你要做什么工作"

```yaml
# 专门的主节点（只管理不存数据）
node.roles: ["master"]

# 专门的数据节点（只存储数据）  
node.roles: ["data"]

# 数据+摄取节点（存储数据+预处理）
node.roles: ["data", "ingest"]

# 全能节点（小集群常用）
node.roles: ["master", "data", "ingest"]

# 机器学习节点
node.roles: ["ml"]

# 纯协调节点（不存储不管理，只转发请求）
node.roles: []
```

### 3.3 传统角色配置（7.x已废弃）


> ⚠️ **注意**：以下配置在Elasticsearch 7.x版本后已废弃，仅做了解

```yaml
# 传统配置方式（不推荐）
node.master: true   # 可以成为主节点
node.data: true     # 可以存储数据  
node.ingest: true   # 可以处理摄取管道
```

**为什么废弃**：
- 🎯 **更清晰**：新的 `node.roles` 配置更直观
- 🔧 **更灵活**：支持更多角色类型
- 🛡️ **更安全**：避免配置冲突和歧义

### 3.4 机器学习和转换配置


```yaml
# 机器学习节点配置
node.roles: ["ml"]
node.ml: true

# 数据转换节点配置  
node.roles: ["transform"]
node.transform: true

# 组合配置
node.roles: ["data", "ml", "transform"]
```

### 3.5 远程集群客户端配置


```yaml
# 支持跨集群搜索
node.remote_cluster_client: true

# 完整配置示例
node.roles: ["data", "remote_cluster_client"]
node.remote_cluster_client: true
```

---

## 4. 🔧 节点角色配置实践


### 4.1 小型集群配置（3节点）


**场景**：小型企业或开发环境

```yaml
# 节点1配置 (elasticsearch-01.yml)
cluster.name: "small-cluster"
node.name: "node-01"
node.roles: ["master", "data", "ingest"]
network.host: "192.168.1.10"

# 节点2配置 (elasticsearch-02.yml)  
cluster.name: "small-cluster"
node.name: "node-02"
node.roles: ["master", "data", "ingest"]
network.host: "192.168.1.11"

# 节点3配置 (elasticsearch-03.yml)
cluster.name: "small-cluster"  
node.name: "node-03"
node.roles: ["master", "data", "ingest"]
network.host: "192.168.1.12"
```

**特点说明**：
- 🎯 每个节点都能做主节点（高可用）
- 📊 每个节点都存储数据（充分利用资源）
- 🔄 每个节点都能预处理数据（功能完整）

### 4.2 中型集群配置（6节点）


**场景**：中型企业生产环境

```yaml
# 主节点配置 (master-01.yml)
node.name: "master-01"
node.roles: ["master"]
# 专门管理集群，不存储数据

# 主节点配置 (master-02.yml)
node.name: "master-02"  
node.roles: ["master"]

# 主节点配置 (master-03.yml)
node.name: "master-03"
node.roles: ["master"]

# 数据节点配置 (data-01.yml)
node.name: "data-01"
node.roles: ["data", "ingest"]
# 存储数据+预处理

# 数据节点配置 (data-02.yml)
node.name: "data-02"
node.roles: ["data", "ingest"]

# 数据节点配置 (data-03.yml)  
node.name: "data-03"
node.roles: ["data", "ingest"]
```

**优势分析**：
- 🎯 **管理专业化**：专门的主节点，管理效率高
- 📊 **存储专业化**：数据节点专注存储和查询
- ⚡ **性能优化**：角色分离，避免资源竞争

### 4.3 大型集群配置示例


```yaml
# 主节点集群
node.roles: ["master"]

# 热数据节点（高性能SSD）
node.roles: ["data_hot"]

# 温数据节点（普通SSD）  
node.roles: ["data_warm"]

# 冷数据节点（机械硬盘）
node.roles: ["data_cold"]

# 摄取节点（专门预处理）
node.roles: ["ingest"]

# 协调节点（只转发请求）
node.roles: []
```

---

## 5. 🏷️ 节点属性与定制化


### 5.1 节点自定义属性


**node.attr.*** - 给节点贴标签

```yaml
# 机房位置标签
node.attr.rack: "rack-01"
node.attr.zone: "beijing"

# 硬件配置标签  
node.attr.disk_type: "ssd"
node.attr.memory: "32gb"

# 业务标签
node.attr.env: "production"
node.attr.team: "backend"
```

**实际应用场景**：

```yaml
# 根据机房分配数据
index.routing.allocation.include.zone: "beijing"

# 根据硬件类型分配
index.routing.allocation.require.disk_type: "ssd"

# 高性能索引分配到SSD节点
PUT /high_performance_index/_settings
{
  "index.routing.allocation.require.disk_type": "ssd"
}
```

### 5.2 属性配置最佳实践


**标签分类建议**：

| 属性类型 | **示例** | **用途** |
|---------|---------|---------|
| 🏢 **地理位置** | `zone: "beijing"` | `跨地域部署` |
| 💾 **硬件配置** | `disk_type: "ssd"` | `性能分层` |
| 🏗️ **环境类型** | `env: "prod"` | `环境隔离` |
| 👥 **团队归属** | `team: "search"` | `资源管理` |
| ⏰ **数据生命周期** | `data_tier: "hot"` | `数据分层` |

---

## 6. 💾 本地存储配置


### 6.1 最大本地存储节点数


**node.max_local_storage_nodes** - 控制单机多节点

```yaml
# 默认值：1（生产环境推荐）
node.max_local_storage_nodes: 1

# 开发测试环境可以设置多个
node.max_local_storage_nodes: 3
```

**配置说明**：

```
单机单节点（推荐）：           单机多节点（测试用）：
┌─────────────────┐           ┌─────────────────┐
│   物理服务器     │           │   物理服务器     │
│ ┌─────────────┐ │           │ ┌─────┐ ┌─────┐ │
│ │ES Node 1    │ │           │ │Node1│ │Node2│ │
│ │独享所有资源  │ │           │ │共享 │ │资源 │ │
│ └─────────────┘ │           │ └─────┘ └─────┘ │
└─────────────────┘           └─────────────────┘
```

**生产环境建议**：
- ✅ **单机单节点**：性能最佳，资源独享
- ❌ **单机多节点**：资源竞争，故障影响大

### 6.2 数据路径配置


```yaml
# 数据存储路径
path.data: ["/data/elasticsearch/data1", "/data/elasticsearch/data2"]

# 日志路径
path.logs: "/data/elasticsearch/logs"

# 节点锁文件路径
node.max_local_storage_nodes: 1
```

---

## 7. 📋 配置最佳实践


### 7.1 生产环境推荐配置


**典型生产配置模板**：

```yaml
# =================================
# 节点基础配置
# =================================
cluster.name: "production-cluster"
node.name: "prod-data-01"

# =================================  
# 节点角色配置
# =================================
node.roles: ["data", "ingest"]

# =================================
# 节点属性配置  
# =================================
node.attr.rack: "rack-01"
node.attr.zone: "beijing"
node.attr.disk_type: "ssd"

# =================================
# 存储配置
# =================================
node.max_local_storage_nodes: 1
path.data: "/data/elasticsearch/data"
path.logs: "/data/elasticsearch/logs"

# =================================
# 网络配置
# =================================
network.host: "192.168.1.10"
http.port: 9200
transport.port: 9300
```

### 7.2 不同环境配置策略


**开发环境**：
```yaml
# 简单配置，快速启动
node.roles: ["master", "data", "ingest"]
node.max_local_storage_nodes: 3
```

**测试环境**：
```yaml
# 模拟生产，但资源较少
node.roles: ["master", "data"]
node.attr.env: "test"
```

**生产环境**：
```yaml
# 角色明确，高可用
node.roles: ["data"]
node.attr.env: "production"
node.max_local_storage_nodes: 1
```

### 7.3 配置检查清单


**配置前检查**：
- [ ] 📝 节点名称是否唯一且有意义
- [ ] 🎭 节点角色是否符合集群规划
- [ ] 🏷️ 节点属性是否便于管理
- [ ] 💾 存储路径是否有足够空间
- [ ] 🌐 网络配置是否正确

**配置后验证**：
```bash
# 检查节点状态
GET /_cat/nodes?v&h=name,node.role,master

# 检查节点属性
GET /_cat/nodeattrs?v

# 检查集群健康
GET /_cluster/health
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 节点角色：决定节点在集群中的职责分工
🔸 配置方式：推荐使用 node.roles 而非传统配置
🔸 角色组合：根据集群规模选择合适的角色搭配
🔸 节点属性：通过标签实现灵活的资源管理
🔸 存储配置：生产环境建议单机单节点部署
```

### 8.2 关键理解要点


**🔹 节点角色选择原则**：
```
小集群（≤5节点）：
- 多角色节点，充分利用资源
- 典型配置：[master, data, ingest]

大集群（>10节点）：
- 角色专业化，提高性能
- 主节点：只做管理
- 数据节点：只存储数据
- 摄取节点：只处理数据
```

**🔹 配置优化思路**：
```
性能优先：
- 角色分离，避免资源竞争
- SSD节点存储热数据
- 机械硬盘存储冷数据

可用性优先：
- 主节点数量为奇数（3、5、7）
- 数据多副本分布
- 跨机房部署

成本优先：
- 多角色节点，减少服务器数量
- 合理规划存储层次
- 动态调整节点角色
```

### 8.3 实际应用价值


**🎯 业务场景应用**：
- **电商搜索**：数据节点负责商品搜索，摄取节点处理实时更新
- **日志分析**：按时间分层存储，热数据用SSD，冷数据用机械盘
- **企业搜索**：按部门设置节点属性，实现数据隔离
- **监控系统**：专门的机器学习节点做异常检测

**🔧 运维实践**：
- **容量规划**：根据数据量和查询量规划节点角色
- **性能调优**：通过节点属性实现精细化资源分配
- **故障隔离**：角色分离降低故障影响范围
- **弹性扩展**：新节点加入时快速分配角色

**核心记忆**：
- 节点角色像员工岗位，明确分工提高效率
- 小集群多面手，大集群专业化
- 节点属性是标签，便于管理和分配
- 生产环境重稳定，开发环境求灵活