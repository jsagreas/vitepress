---
title: 1ã€å®‰å…¨é…ç½®ä¸è®¤è¯æˆæƒ
---
## ğŸ“š ç›®å½•

1. [Elasticsearch å®‰å…¨æ¦‚è¿°](#1-elasticsearch-å®‰å…¨æ¦‚è¿°)
2. [X-Pack Security åŸºç¡€é…ç½®](#2-x-pack-security-åŸºç¡€é…ç½®)
3. [TLS/SSL åŠ å¯†é…ç½®](#3-tlsssl-åŠ å¯†é…ç½®)
4. [ç”¨æˆ·è®¤è¯æœºåˆ¶](#4-ç”¨æˆ·è®¤è¯æœºåˆ¶)
5. [è§’è‰²æƒé™ç®¡ç†](#5-è§’è‰²æƒé™ç®¡ç†)
6. [RBAC æƒé™æ¨¡å‹è¯¦è§£](#6-rbac-æƒé™æ¨¡å‹è¯¦è§£)
7. [API å¯†é’¥ç®¡ç†](#7-api-å¯†é’¥ç®¡ç†)
8. [ä¼ä¸šçº§é›†æˆè®¤è¯](#8-ä¼ä¸šçº§é›†æˆè®¤è¯)
9. [é«˜çº§å®‰å…¨ç‰¹æ€§](#9-é«˜çº§å®‰å…¨ç‰¹æ€§)
10. [å®‰å…¨æœ€ä½³å®è·µ](#10-å®‰å…¨æœ€ä½³å®è·µ)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Elasticsearch å®‰å…¨æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨é…ç½®


**ğŸ¯ å®‰å…¨çš„é‡è¦æ€§**
```
æƒ³è±¡ä¸€ä¸‹ä½ çš„æ•°æ®å°±åƒé“¶è¡Œçš„é‡‘åº“ï¼š
â€¢ æ²¡æœ‰å®‰å…¨æªæ–½ = é‡‘åº“å¤§é—¨æ•å¼€ï¼Œä»»ä½•äººéƒ½èƒ½è¿›å‡º
â€¢ æœ‰äº†å®‰å…¨é…ç½® = è®¾ç½®å¯†ç ã€æƒé™éªŒè¯ã€ç›‘æ§è®°å½•

Elasticsearch é»˜è®¤æƒ…å†µä¸‹æ˜¯"å¼€æ”¾"çš„ï¼š
â€¢ ä»»ä½•èƒ½è®¿é—®åˆ°çš„äººéƒ½å¯ä»¥æŸ¥çœ‹æ•°æ®
â€¢ å¯ä»¥éšæ„å¢åˆ æ”¹æŸ¥æ‰€æœ‰ç´¢å¼•
â€¢ æ²¡æœ‰è®¿é—®æ—¥å¿—è®°å½•
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> 
> Elasticsearch å®‰å…¨å°±æ˜¯ç»™ä½ çš„æ•°æ®ç©¿ä¸Š"ç›”ç”²"ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„äººæ‰èƒ½è®¿é—®ç‰¹å®šçš„æ•°æ®ï¼Œå°±åƒç»™ä¸åŒæˆ¿é—´é…ä¸åŒçš„é’¥åŒ™ä¸€æ ·ã€‚

### 1.2 å®‰å…¨å¨èƒä¸é˜²æŠ¤


**å¸¸è§å®‰å…¨é£é™©ï¼š**

| ğŸš¨ **å¨èƒç±»å‹** | **å…·ä½“é£é™©** | **é˜²æŠ¤æªæ–½** |
|---------------|-------------|-------------|
| **æ•°æ®æ³„éœ²** | `æ•æ„Ÿä¿¡æ¯è¢«éæˆæƒè®¿é—®` | `ç”¨æˆ·è®¤è¯ + æƒé™æ§åˆ¶` |
| **æ•°æ®ç¯¡æ”¹** | `é‡è¦æ•°æ®è¢«æ¶æ„ä¿®æ”¹` | `ç»†ç²’åº¦æƒé™ + å®¡è®¡æ—¥å¿—` |
| **æœåŠ¡ä¸­æ–­** | `æ¶æ„åˆ é™¤ç´¢å¼•æˆ–é›†ç¾¤` | `è§’è‰²æƒé™é™åˆ¶ + å¤‡ä»½ç­–ç•¥` |
| **ç½‘ç»œçªƒå¬** | `æ•°æ®ä¼ è¾“è¢«æ‹¦æˆª` | `TLS/SSL åŠ å¯†` |

### 1.3 Elasticsearch å®‰å…¨æ¶æ„


```
å®Œæ•´çš„å®‰å…¨é˜²æŠ¤ä½“ç³»ï¼š

ç”¨æˆ·/åº”ç”¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¤è¯å±‚ (Auth)   â”‚ â† éªŒè¯"ä½ æ˜¯è°"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æˆæƒå±‚ (Authz)  â”‚ â† æ§åˆ¶"ä½ èƒ½åšä»€ä¹ˆ"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŠ å¯†å±‚ (TLS)    â”‚ â† ä¿æŠ¤"æ•°æ®ä¼ è¾“"
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®¡è®¡å±‚ (Audit)  â”‚ â† è®°å½•"è°åšäº†ä»€ä¹ˆ"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Elasticsearch é›†ç¾¤
```

---

## 2. âš™ï¸ X-Pack Security åŸºç¡€é…ç½®


### 2.1 ä»€ä¹ˆæ˜¯ X-Pack Security


**ğŸ”¸ ç®€å•ç†è§£**
```
X-Pack Security å°±åƒæ˜¯ Elasticsearch çš„"å®‰ä¿ç³»ç»Ÿ"ï¼š
â€¢ ç›¸å½“äºç»™ ES å®‰è£…äº†é—¨ç¦ç³»ç»Ÿ
â€¢ æä¾›ç”¨æˆ·è´¦å·ã€å¯†ç éªŒè¯åŠŸèƒ½
â€¢ æ”¯æŒæƒé™åˆ†çº§ç®¡ç†
â€¢ å†…ç½®å¤šç§è®¤è¯æ–¹å¼
```

> **ğŸ“ é‡è¦è¯´æ˜**
> 
> ä» Elasticsearch 6.3 å¼€å§‹ï¼ŒåŸºç¡€å®‰å…¨åŠŸèƒ½å·²ç»å…è´¹æä¾›ï¼Œä¸å†éœ€è¦ä»˜è´¹çš„ X-Pack è®¸å¯è¯ã€‚

### 2.2 å¯ç”¨ X-Pack Security


**æ­¥éª¤ 1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**

åœ¨ `elasticsearch.yml` ä¸­æ·»åŠ ï¼š
```yaml
# å¯ç”¨ X-Pack å®‰å…¨åŠŸèƒ½
xpack.security.enabled: true

# å¯ç”¨ä¼ è¾“å±‚å®‰å…¨
xpack.security.transport.ssl.enabled: true
```

**æ­¥éª¤ 2ï¼šé‡å¯ Elasticsearch**
```bash
# é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
sudo systemctl restart elasticsearch
```

**æ­¥éª¤ 3ï¼šè®¾ç½®å†…ç½®ç”¨æˆ·å¯†ç **
```bash
# ä½¿ç”¨ elasticsearch-setup-passwords å·¥å…·
bin/elasticsearch-setup-passwords interactive

# ç³»ç»Ÿä¼šæç¤ºä¸ºä»¥ä¸‹ç”¨æˆ·è®¾ç½®å¯†ç ï¼š
# - elastic (è¶…çº§ç®¡ç†å‘˜)
# - kibana_system (Kibana æœåŠ¡ç”¨æˆ·)
# - logstash_system (Logstash æœåŠ¡ç”¨æˆ·)
# - beats_system (Beats æœåŠ¡ç”¨æˆ·)
```

### 2.3 éªŒè¯å®‰å…¨é…ç½®


**æµ‹è¯•è®¤è¯æ˜¯å¦ç”Ÿæ•ˆï¼š**
```bash
# æœªè®¤è¯è®¿é—®ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
curl http://localhost:9200/

# è®¤è¯è®¿é—®ï¼ˆä½¿ç”¨ elastic ç”¨æˆ·ï¼‰
curl -u elastic:your_password http://localhost:9200/
```

**ğŸ¯ é¢„æœŸç»“æœ**
- æœªè®¤è¯è®¿é—®è¿”å› 401 Unauthorized
- è®¤è¯è®¿é—®è¿”å›æ­£å¸¸çš„é›†ç¾¤ä¿¡æ¯

---

## 3. ğŸ”’ TLS/SSL åŠ å¯†é…ç½®


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦ TLS/SSL


**ğŸ“Š åŠ å¯†çš„å¿…è¦æ€§**
```
æ²¡æœ‰åŠ å¯†çš„æ•°æ®ä¼ è¾“ï¼š
å®¢æˆ·ç«¯ â”€â”€â”€â”€[æ˜æ–‡æ•°æ®]â”€â”€â”€â”€â†’ Elasticsearch
         â†‘ å®¹æ˜“è¢«çªƒå¬

æœ‰äº† TLS åŠ å¯†ï¼š
å®¢æˆ·ç«¯ â”€â”€â”€â”€[åŠ å¯†æ•°æ®]â”€â”€â”€â”€â†’ Elasticsearch
         â†‘ å³ä½¿è¢«æˆªè·ä¹Ÿæ— æ³•è¯»å–
```

### 3.2 ç”Ÿæˆ SSL è¯ä¹¦


**ä½¿ç”¨ Elasticsearch å†…ç½®å·¥å…·ç”Ÿæˆè¯ä¹¦ï¼š**

```bash
# 1. ç”Ÿæˆ CA è¯ä¹¦
bin/elasticsearch-certutil ca --out elastic-ca.p12

# 2. ä¸ºé›†ç¾¤ç”Ÿæˆè¯ä¹¦
bin/elasticsearch-certutil cert --ca elastic-ca.p12 --out elastic-certificates.p12

# 3. å°†è¯ä¹¦å¤åˆ¶åˆ°é…ç½®ç›®å½•
cp elastic-certificates.p12 config/
```

### 3.3 é…ç½®ä¼ è¾“å±‚åŠ å¯†


**åœ¨ `elasticsearch.yml` ä¸­é…ç½®ï¼š**
```yaml
# å¯ç”¨ä¼ è¾“å±‚ SSL
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12

# å¯ç”¨ HTTP å±‚ SSLï¼ˆå¯é€‰ï¼‰
xpack.security.http.ssl.enabled: true
xpack.security.http.ssl.keystore.path: elastic-certificates.p12
```

### 3.4 éªŒè¯ SSL é…ç½®


```bash
# ä½¿ç”¨ HTTPS è®¿é—®
curl -k -u elastic:password https://localhost:9200/

# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
openssl s_client -connect localhost:9200 -servername localhost
```

---

## 4. ğŸ‘¤ ç”¨æˆ·è®¤è¯æœºåˆ¶


### 4.1 å†…ç½®ç”¨æˆ·è´¦æˆ·


**ğŸ”¸ ç³»ç»Ÿé¢„å®šä¹‰ç”¨æˆ·**

| **ç”¨æˆ·å** | **ç”¨é€”** | **æƒé™çº§åˆ«** |
|-----------|---------|-------------|
| `elastic` | `è¶…çº§ç®¡ç†å‘˜` | `æ‰€æœ‰æƒé™` |
| `kibana_system` | `Kibana æœåŠ¡` | `Kibana è¿è¡Œæ‰€éœ€æƒé™` |
| `logstash_system` | `Logstash æœåŠ¡` | `å†™å…¥æ•°æ®æƒé™` |
| `beats_system` | `Beats æœåŠ¡` | `ç›‘æ§å’Œå†™å…¥æƒé™` |

### 4.2 åˆ›å»ºè‡ªå®šä¹‰ç”¨æˆ·


**é€šè¿‡ API åˆ›å»ºç”¨æˆ·ï¼š**
```bash
# åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·
curl -X POST "localhost:9200/_security/user/john_doe" \
-H "Content-Type: application/json" \
-u elastic:password \
-d '{
  "password": "secure_password",
  "roles": ["read_only_user"],
  "full_name": "John Doe",
  "email": "john.doe@example.com"
}'
```

**é€šè¿‡ Kibana ç•Œé¢åˆ›å»ºï¼š**
1. ç™»å½• Kibana â†’ Stack Management
2. Security â†’ Users â†’ Create user
3. å¡«å†™ç”¨æˆ·ä¿¡æ¯å’Œåˆ†é…è§’è‰²

### 4.3 å¯†ç ç­–ç•¥é…ç½®


```yaml
# åœ¨ elasticsearch.yml ä¸­é…ç½®å¯†ç ç­–ç•¥
xpack.security.authc.password_hashing.algorithm: bcrypt

# è®¾ç½®å¯†ç å¤æ‚åº¦è¦æ±‚ï¼ˆéœ€è¦ Gold è®¸å¯è¯ï¼‰
# xpack.security.authc.password_policy.min_length: 8
# xpack.security.authc.password_policy.min_uppercase: 1
```

---

## 5. ğŸ­ è§’è‰²æƒé™ç®¡ç†


### 5.1 è§’è‰²çš„æ¦‚å¿µ


**ğŸ¯ è§’è‰²å°±åƒ"å·¥ä½œèŒåŠ¡"**
```
ç°å®ä¸­çš„ä¾‹å­ï¼š
â€¢ å›¾ä¹¦ç®¡ç†å‘˜ï¼šå¯ä»¥å€Ÿè¿˜ä¹¦ï¼Œä½†ä¸èƒ½ä¿®æ”¹å›¾ä¹¦ä¿¡æ¯
â€¢ ç³»ç»Ÿç®¡ç†å‘˜ï¼šå¯ä»¥æ·»åŠ åˆ é™¤å›¾ä¹¦ï¼Œç®¡ç†æ‰€æœ‰åŠŸèƒ½
â€¢ è¯»è€…ï¼šåªèƒ½æŸ¥çœ‹å’Œå€Ÿé˜…å›¾ä¹¦

Elasticsearch ä¸­ï¼š
â€¢ è§’è‰²å®šä¹‰äº†ä¸€ç»„æƒé™
â€¢ ç”¨æˆ·å¯ä»¥åˆ†é…ä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²
â€¢ æƒé™æ§åˆ¶åˆ°ç´¢å¼•ã€æ–‡æ¡£çº§åˆ«
```

### 5.2 å†…ç½®è§’è‰²ä»‹ç»


**å¸¸ç”¨å†…ç½®è§’è‰²ï¼š**

| **è§’è‰²å** | **æƒé™æè¿°** | **é€‚ç”¨åœºæ™¯** |
|-----------|-------------|-------------|
| `superuser` | `æ‰€æœ‰æƒé™` | `ç³»ç»Ÿç®¡ç†å‘˜` |
| `read_only` | `åªè¯»æƒé™` | `æ•°æ®åˆ†æå¸ˆ` |
| `kibana_admin` | `Kibana ç®¡ç†` | `Kibana ç®¡ç†å‘˜` |
| `logstash_writer` | `å†™å…¥æ•°æ®` | `æ—¥å¿—æ”¶é›†` |

### 5.3 åˆ›å»ºè‡ªå®šä¹‰è§’è‰²


**åˆ›å»ºæ•°æ®åˆ†æå¸ˆè§’è‰²ï¼š**
```bash
curl -X POST "localhost:9200/_security/role/data_analyst" \
-H "Content-Type: application/json" \
-u elastic:password \
-d '{
  "cluster": ["monitor"],
  "indices": [
    {
      "names": ["logs-*", "metrics-*"],
      "privileges": ["read", "view_index_metadata"]
    }
  ]
}'
```

**ğŸ”§ æƒé™è¯´æ˜**
- `cluster: ["monitor"]`ï¼šå¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
- `indices`ï¼šæŒ‡å®šå¯ä»¥è®¿é—®çš„ç´¢å¼•å’Œæ“ä½œæƒé™
- `names: ["logs-*"]`ï¼šåªèƒ½è®¿é—®ä»¥ logs- å¼€å¤´çš„ç´¢å¼•

### 5.4 åˆ†é…è§’è‰²ç»™ç”¨æˆ·


```bash
# å°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·
curl -X PUT "localhost:9200/_security/user/analyst" \
-H "Content-Type: application/json" \
-u elastic:password \
-d '{
  "password": "analyst_password",
  "roles": ["data_analyst", "kibana_user"],
  "full_name": "Data Analyst"
}'
```

---

## 6. ğŸ¢ RBAC æƒé™æ¨¡å‹è¯¦è§£


### 6.1 RBAC æ¨¡å‹åŸç†


**ğŸ”¸ åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (Role-Based Access Control)**
```
RBAC ä¸‰è¦ç´ å…³ç³»ï¼š

ç”¨æˆ· (Users) â†â†’ è§’è‰² (Roles) â†â†’ æƒé™ (Privileges)

å®é™…å·¥ä½œæµç¨‹ï¼š
1. ç”¨æˆ·ç™»å½•ç³»ç»Ÿ
2. ç³»ç»ŸæŸ¥çœ‹ç”¨æˆ·è¢«åˆ†é…çš„è§’è‰²
3. æ ¹æ®è§’è‰²ç¡®å®šç”¨æˆ·çš„æƒé™
4. æ‰§è¡Œç›¸åº”çš„æ“ä½œ
```

### 6.2 æƒé™å±‚çº§ç»“æ„


**æƒé™åˆ†ä¸ºä¸‰ä¸ªå±‚çº§ï¼š**

```
â”Œâ”€ é›†ç¾¤çº§æƒé™ (Cluster)
â”‚  â”œâ”€ all: æ‰€æœ‰é›†ç¾¤æ“ä½œ
â”‚  â”œâ”€ monitor: æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
â”‚  â”œâ”€ manage: ç®¡ç†é›†ç¾¤è®¾ç½®
â”‚  â””â”€ manage_security: ç®¡ç†å®‰å…¨è®¾ç½®
â”‚
â”œâ”€ ç´¢å¼•çº§æƒé™ (Index)
â”‚  â”œâ”€ all: ç´¢å¼•çš„æ‰€æœ‰æ“ä½œ
â”‚  â”œâ”€ read: è¯»å–æ•°æ®
â”‚  â”œâ”€ write: å†™å…¥æ•°æ®
â”‚  â”œâ”€ create: åˆ›å»ºæ–‡æ¡£
â”‚  â”œâ”€ delete: åˆ é™¤æ–‡æ¡£
â”‚  â””â”€ manage: ç®¡ç†ç´¢å¼•
â”‚
â””â”€ å­—æ®µçº§æƒé™ (Field)
   â”œâ”€ æŒ‡å®šå¯è®¿é—®çš„å­—æ®µ
   â””â”€ æŒ‡å®šå—é™çš„å­—æ®µ
```

### 6.3 å®é™…æƒé™é…ç½®ç¤ºä¾‹


**åˆ›å»ºä¸šåŠ¡éƒ¨é—¨è§’è‰²ï¼š**
```json
{
  "cluster": ["monitor"],
  "indices": [
    {
      "names": ["sales-*"],
      "privileges": ["read", "write"],
      "field_security": {
        "grant": ["product", "quantity", "price"],
        "except": ["customer_ssn", "internal_notes"]
      }
    }
  ]
}
```

**ğŸ¯ é…ç½®è§£è¯»**
- å¯ä»¥ç›‘æ§é›†ç¾¤çŠ¶æ€
- åªèƒ½è®¿é—®é”€å”®ç›¸å…³ç´¢å¼•
- èƒ½è¯»å†™æ•°æ®ï¼Œä½†ä¸èƒ½çœ‹åˆ°å®¢æˆ·èº«ä»½è¯å·

---

## 7. ğŸ”‘ API å¯†é’¥ç®¡ç†


### 7.1 API å¯†é’¥çš„ä¼˜åŠ¿


**ğŸ“‹ ä¸ºä»€ä¹ˆä½¿ç”¨ API å¯†é’¥**
```
ä¼ ç»Ÿç”¨æˆ·å¯†ç æ–¹å¼ï¼š
â€¢ å¯†ç å¯èƒ½è¢«æ„å¤–æ³„éœ²
â€¢ éœ€è¦åœ¨åº”ç”¨ä¸­ç¡¬ç¼–ç å¯†ç 
â€¢ éš¾ä»¥ç®¡ç†å’Œè½®æ¢

API å¯†é’¥æ–¹å¼ï¼š
â€¢ å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´
â€¢ å®¹æ˜“æ’¤é”€å’Œé‡æ–°ç”Ÿæˆ
â€¢ æƒé™å¯ä»¥ç²¾ç¡®æ§åˆ¶
â€¢ æ›´é€‚åˆç¨‹åºè°ƒç”¨
```

### 7.2 åˆ›å»º API å¯†é’¥


**ä¸ºåº”ç”¨ç¨‹åºåˆ›å»º API å¯†é’¥ï¼š**
```bash
curl -X POST "localhost:9200/_security/api_key" \
-H "Content-Type: application/json" \
-u elastic:password \
-d '{
  "name": "app-log-writer",
  "expiration": "1d",
  "role_descriptors": {
    "log_writer": {
      "cluster": ["monitor"],
      "indices": [
        {
          "names": ["logs-*"],
          "privileges": ["create", "write"]
        }
      ]
    }
  }
}'
```

**ğŸ”§ å‚æ•°è¯´æ˜**
- `name`ï¼šAPI å¯†é’¥çš„åç§°
- `expiration`ï¼šè¿‡æœŸæ—¶é—´ï¼ˆ1d=1å¤©ï¼‰
- `role_descriptors`ï¼šç›´æ¥å®šä¹‰æƒé™ï¼Œä¸éœ€è¦é¢„å…ˆåˆ›å»ºè§’è‰²

### 7.3 ä½¿ç”¨ API å¯†é’¥


**åœ¨åº”ç”¨ä¸­ä½¿ç”¨ API å¯†é’¥ï¼š**
```bash
# ä½¿ç”¨ API å¯†é’¥è®¤è¯
curl -H "Authorization: ApiKey base64(id:api_key)" \
http://localhost:9200/logs-app/_doc/1
```

**åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š**
```python
from elasticsearch import Elasticsearch

# ä½¿ç”¨ API å¯†é’¥è¿æ¥
es = Elasticsearch(
    ['localhost:9200'],
    api_key=('id', 'api_key')
)
```

### 7.4 ç®¡ç† API å¯†é’¥


```bash
# æŸ¥çœ‹æ‰€æœ‰ API å¯†é’¥
curl -u elastic:password "localhost:9200/_security/api_key"

# æ’¤é”€ API å¯†é’¥
curl -X DELETE -u elastic:password \
"localhost:9200/_security/api_key?ids=å¯†é’¥ID"
```

---

## 8. ğŸ¢ ä¼ä¸šçº§é›†æˆè®¤è¯


### 8.1 LDAP é›†æˆé…ç½®


**ğŸ”¸ LDAP é›†æˆçš„å¥½å¤„**
```
ä¼ä¸šåœºæ™¯ï¼š
â€¢ å…¬å¸å·²æœ‰ LDAP/AD ç”¨æˆ·ç›®å½•
â€¢ å‘˜å·¥ç”¨åŒä¸€å¥—è´¦å·ç™»å½•æ‰€æœ‰ç³»ç»Ÿ
â€¢ ç»Ÿä¸€çš„å¯†ç ç­–ç•¥å’Œç®¡ç†

é…ç½®åæ•ˆæœï¼š
â€¢ å‘˜å·¥ç”¨å…¬å¸è´¦å·ç™»å½• ES/Kibana
â€¢ æ— éœ€å•ç‹¬åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·
â€¢ æƒé™å¯ä»¥åŸºäºéƒ¨é—¨è‡ªåŠ¨åˆ†é…
```

**åŸºæœ¬ LDAP é…ç½®ï¼š**
```yaml
# elasticsearch.yml ä¸­çš„ LDAP é…ç½®
xpack.security.authc.realms.ldap.ldap1:
  order: 0
  url: "ldap://ldap.company.com:389"
  bind_dn: "cn=admin,dc=company,dc=com"
  bind_password: "admin_password"
  user_search:
    base_dn: "ou=users,dc=company,dc=com"
    filter: "(cn={0})"
  group_search:
    base_dn: "ou=groups,dc=company,dc=com"
  role_mapping: "/path/to/role_mapping.yml"
```

### 8.2 Active Directory é›†æˆ


**AD ç‰¹å®šé…ç½®ï¼š**
```yaml
xpack.security.authc.realms.active_directory.ad1:
  order: 0
  domain_name: "company.local"
  url: "ldap://ad.company.local:389"
  bind_dn: "CN=elasticsearch,CN=Users,DC=company,DC=local"
  bind_password: "service_password"
```

### 8.3 SAML å•ç‚¹ç™»å½•


**ğŸ”¸ SAML SSO çš„å·¥ä½œæµç¨‹**
```
ç”¨æˆ·è®¿é—®æµç¨‹ï¼š
1. ç”¨æˆ·è®¿é—® Kibana
2. é‡å®šå‘åˆ°å…¬å¸ SSO é¡µé¢
3. ç”¨æˆ·åœ¨ SSO ç³»ç»Ÿç™»å½•
4. SSO ç³»ç»Ÿè¿”å›è®¤è¯ä¿¡æ¯
5. Kibana éªŒè¯åå…è®¸è®¿é—®
```

**SAML åŸºç¡€é…ç½®ï¼š**
```yaml
xpack.security.authc.realms.saml.saml1:
  order: 2
  idp.metadata.path: "/path/to/metadata.xml"
  idp.entity_id: "https://sso.company.com"
  sp.entity_id: "https://kibana.company.com"
  sp.acs: "https://kibana.company.com/api/security/v1/saml"
```

---

## 9. ğŸ›¡ï¸ é«˜çº§å®‰å…¨ç‰¹æ€§


### 9.1 å¤šå› å­è®¤è¯ (MFA)


**ğŸ”’ å¢å¼ºå®‰å…¨æ€§**
```
å•å› å­è®¤è¯ï¼šåªéœ€è¦å¯†ç 
å¤šå› å­è®¤è¯ï¼šå¯†ç  + æ‰‹æœºéªŒè¯ç /ä»¤ç‰Œ

æ”»å‡»éš¾åº¦å¯¹æ¯”ï¼š
â€¢ å•å› å­ï¼šè·å–å¯†ç å³å¯å…¥ä¾µ
â€¢ å¤šå› å­ï¼šéœ€è¦å¯†ç  + ç‰©ç†è®¾å¤‡ï¼Œéš¾åº¦æŒ‡æ•°çº§å¢åŠ 
```

**å¯ç”¨ MFA é…ç½®ï¼š**
```yaml
# éœ€è¦ Platinum è®¸å¯è¯
xpack.security.authc.realms.native.native1:
  order: 0
  enabled: true
  # MFA ç›¸å…³è®¾ç½®åœ¨ Kibana ä¸­é…ç½®
```

### 9.2 æ–‡æ¡£çº§å®‰å…¨ (DLS)


**ğŸ¯ ç²¾ç¡®æƒé™æ§åˆ¶**
```
åº”ç”¨åœºæ™¯ï¼š
â€¢ é”€å”®äººå‘˜åªèƒ½çœ‹åˆ°è‡ªå·±è´Ÿè´£åŒºåŸŸçš„æ•°æ®
â€¢ è´¢åŠ¡äººå‘˜åªèƒ½çœ‹åˆ°æœ¬éƒ¨é—¨çš„è´¢åŠ¡è®°å½•
â€¢ å®¢æœåªèƒ½çœ‹åˆ°åˆ†é…ç»™è‡ªå·±çš„å·¥å•

å®ç°æ–¹å¼ï¼š
åœ¨è§’è‰²ä¸­æ·»åŠ æŸ¥è¯¢è¿‡æ»¤æ¡ä»¶
```

**é…ç½®ç¤ºä¾‹ï¼š**
```json
{
  "indices": [
    {
      "names": ["sales-*"],
      "privileges": ["read"],
      "query": {
        "term": {
          "sales_region": "{{username}}"
        }
      }
    }
  ]
}
```

### 9.3 å­—æ®µçº§å®‰å…¨ (FLS)


**éšè—æ•æ„Ÿå­—æ®µï¼š**
```json
{
  "indices": [
    {
      "names": ["customer-*"],
      "privileges": ["read"],
      "field_security": {
        "grant": ["name", "email", "phone"],
        "except": ["ssn", "credit_card"]
      }
    }
  ]
}
```

**ğŸ’¡ ç†è§£è¦ç‚¹**
- `grant`ï¼šå…è®¸è®¿é—®çš„å­—æ®µ
- `except`ï¼šç¦æ­¢è®¿é—®çš„å­—æ®µ
- ç”¨æˆ·æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿå­—æ®µ

---

## 10. ğŸ“Š å®‰å…¨æœ€ä½³å®è·µ


### 10.1 å¯†ç å®‰å…¨ç­–ç•¥


**ğŸ”§ å¯†ç ç®¡ç†å»ºè®®**

| **ç­–ç•¥** | **å»ºè®®åšæ³•** | **åŸå› ** |
|---------|-------------|---------|
| **å¤æ‚åº¦** | `è‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦` | `æé«˜ç ´è§£éš¾åº¦` |
| **å®šæœŸæ›´æ¢** | `æ¯3-6ä¸ªæœˆæ›´æ¢ä¸€æ¬¡` | `é™ä½æ³„éœ²é£é™©` |
| **é¿å…é‡å¤** | `ä¸åŒç³»ç»Ÿä½¿ç”¨ä¸åŒå¯†ç ` | `é˜²æ­¢è¿é”æ³„éœ²` |
| **å­˜å‚¨æ–¹å¼** | `ä½¿ç”¨å¯†ç ç®¡ç†å™¨` | `é¿å…æ˜æ–‡å­˜å‚¨` |

### 10.2 ç½‘ç»œå®‰å…¨é…ç½®


**é™åˆ¶è®¿é—®æ¥æºï¼š**
```yaml
# åªå…è®¸ç‰¹å®š IP è®¿é—®
network.host: 192.168.1.100
http.host: 192.168.1.100

# ç»‘å®šåˆ°å†…ç½‘æ¥å£
network.bind_host: ["192.168.1.100", "127.0.0.1"]
```

**é˜²ç«å¢™é…ç½®ï¼š**
```bash
# åªå…è®¸å¿…è¦ç«¯å£
sudo ufw allow from 192.168.1.0/24 to any port 9200
sudo ufw allow from 192.168.1.0/24 to any port 9300
```

### 10.3 ç›‘æ§å’Œå®¡è®¡


**å¯ç”¨å®‰å…¨å®¡è®¡ï¼š**
```yaml
xpack.security.audit.enabled: true
xpack.security.audit.outputs: [index, logfile]
xpack.security.audit.logfile.events.emit_request_body: true
```

**ğŸ” å®¡è®¡å†…å®¹åŒ…æ‹¬**
- ç”¨æˆ·ç™»å½•å°è¯•
- æƒé™å˜æ›´è®°å½•
- æ•°æ®è®¿é—®æ—¥å¿—
- å¤±è´¥çš„è®¤è¯å°è¯•

### 10.4 å®šæœŸå®‰å…¨æ£€æŸ¥


**ğŸ“‹ å®‰å…¨æ£€æŸ¥æ¸…å•**

```
æ¯å‘¨æ£€æŸ¥ï¼š
â˜‘ï¸ æŸ¥çœ‹å®¡è®¡æ—¥å¿—å¼‚å¸¸
â˜‘ï¸ æ£€æŸ¥å¤±è´¥ç™»å½•å°è¯•
â˜‘ï¸ éªŒè¯ç”¨æˆ·æƒé™æ˜¯å¦åˆç†

æ¯æœˆæ£€æŸ¥ï¼š
â˜‘ï¸ æ›´æ–° Elasticsearch ç‰ˆæœ¬
â˜‘ï¸ æ£€æŸ¥è¯ä¹¦è¿‡æœŸæ—¶é—´
â˜‘ï¸ æ¸…ç†ä¸æ´»è·ƒç”¨æˆ·

æ¯å­£åº¦æ£€æŸ¥ï¼š
â˜‘ï¸ å®¡æŸ¥è§’è‰²æƒé™é…ç½®
â˜‘ï¸ æ›´æ–°å¯†ç ç­–ç•¥
â˜‘ï¸ è¿›è¡Œå®‰å…¨æ¸—é€æµ‹è¯•
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ X-Pack Securityï¼šElasticsearch çš„å®‰å…¨ä¿æŠ¤ç³»ç»Ÿ
ğŸ”¸ TLS/SSLï¼šæ•°æ®ä¼ è¾“åŠ å¯†ï¼Œé˜²æ­¢ç½‘ç»œçªƒå¬
ğŸ”¸ ç”¨æˆ·è®¤è¯ï¼šéªŒè¯"ä½ æ˜¯è°"çš„è¿‡ç¨‹
ğŸ”¸ è§’è‰²æˆæƒï¼šæ§åˆ¶"ä½ èƒ½åšä»€ä¹ˆ"çš„æœºåˆ¶
ğŸ”¸ RBAC æ¨¡å‹ï¼šåŸºäºè§’è‰²çš„æƒé™ç®¡ç†æ–¹å¼
ğŸ”¸ API å¯†é’¥ï¼šç¨‹åºè°ƒç”¨çš„å®‰å…¨è®¤è¯æ–¹å¼
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®‰å…¨é…ç½®çš„å±‚æ¬¡**
```
åŸºç¡€å®‰å…¨ï¼šå¯ç”¨è®¤è¯ï¼Œè®¾ç½®å¯†ç 
ä¼ è¾“å®‰å…¨ï¼šé…ç½® TLS/SSL åŠ å¯†
æƒé™æ§åˆ¶ï¼šç²¾ç¡®çš„è§’è‰²æƒé™ç®¡ç†
ä¼ä¸šé›†æˆï¼šä¸ç°æœ‰è®¤è¯ç³»ç»Ÿé›†æˆ
é«˜çº§å®‰å…¨ï¼šæ–‡æ¡£çº§ã€å­—æ®µçº§æƒé™æ§åˆ¶
```

**ğŸ”¹ æƒé™è®¾è®¡åŸåˆ™**
```
æœ€å°æƒé™åŸåˆ™ï¼šåªç»™å¿…éœ€çš„æƒé™ï¼Œä¸å¤šç»™
èŒè´£åˆ†ç¦»ï¼šä¸åŒè§’è‰²è´Ÿè´£ä¸åŒåŠŸèƒ½
å®šæœŸå®¡æŸ¥ï¼šåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„æƒé™
ç›‘æ§è®°å½•ï¼šè®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³æ“ä½œ
```

### 11.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **æ•°æ®åˆ†æå›¢é˜Ÿ**ï¼šåªè¯»æƒé™ï¼Œè®¿é—®ç‰¹å®šæ•°æ®é›†
- **å¼€å‘å›¢é˜Ÿ**ï¼šæµ‹è¯•ç¯å¢ƒå®Œæ•´æƒé™ï¼Œç”Ÿäº§ç¯å¢ƒå—é™æƒé™
- **è¿ç»´å›¢é˜Ÿ**ï¼šé›†ç¾¤ç®¡ç†æƒé™ï¼Œä½†ä¸èƒ½è®¿é—®ä¸šåŠ¡æ•°æ®
- **ä¸šåŠ¡éƒ¨é—¨**ï¼šåªèƒ½è®¿é—®æœ¬éƒ¨é—¨ç›¸å…³æ•°æ®

**ğŸ”§ è¿ç»´å®è·µ**
- **æ–°å‘˜å·¥å…¥èŒ**ï¼šæ ¹æ®å²—ä½åˆ†é…å¯¹åº”è§’è‰²
- **å‘˜å·¥ç¦»èŒ**ï¼šåŠæ—¶ç¦ç”¨è´¦æˆ·å’Œæ’¤é”€æƒé™
- **æƒé™å˜æ›´**ï¼šé€šè¿‡è§’è‰²ç®¡ç†ï¼Œé¿å…ç›´æ¥ä¿®æ”¹ç”¨æˆ·æƒé™
- **å®‰å…¨äº‹ä»¶**ï¼šé€šè¿‡å®¡è®¡æ—¥å¿—å¿«é€Ÿå®šä½é—®é¢˜

### 11.4 å¸¸è§é—®é¢˜è§£å†³


**â“ å¿˜è®° elastic ç”¨æˆ·å¯†ç æ€ä¹ˆåŠï¼Ÿ**
```bash
# ä½¿ç”¨ elasticsearch-reset-password å·¥å…·
bin/elasticsearch-reset-password -u elastic
```

**â“ SSL è¯ä¹¦è¿‡æœŸå¦‚ä½•å¤„ç†ï¼Ÿ**
```bash
# é‡æ–°ç”Ÿæˆè¯ä¹¦
bin/elasticsearch-certutil cert --ca elastic-ca.p12 --out new-certificates.p12
# æ›¿æ¢æ—§è¯ä¹¦å¹¶é‡å¯æœåŠ¡
```

**â“ ç”¨æˆ·æ— æ³•è®¿é—®ç‰¹å®šç´¢å¼•**
```
æ£€æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤ç”¨æˆ·çš„è§’è‰²åˆ†é…
2. æ£€æŸ¥è§’è‰²çš„æƒé™é…ç½®
3. éªŒè¯ç´¢å¼•åç§°æ¨¡å¼åŒ¹é…
4. æŸ¥çœ‹å®¡è®¡æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å®‰å…¨é…ç½®æ­¥æ­¥ä¸ºè¥ï¼Œè®¤è¯æˆæƒå±‚å±‚æŠŠå…³
- è¯ä¹¦åŠ å¯†ä¼ è¾“å®‰å…¨ï¼Œè§’è‰²æƒé™ç²¾ç¡®ç®¡æ§
- ä¼ä¸šé›†æˆç»Ÿä¸€è®¤è¯ï¼Œç›‘æ§å®¡è®¡é˜²æ‚£æœªç„¶
- æœ€å°æƒé™å®šæœŸæ£€æŸ¥ï¼Œå®‰å…¨æ„è¯†æ—¶åˆ»ä¸å¿˜