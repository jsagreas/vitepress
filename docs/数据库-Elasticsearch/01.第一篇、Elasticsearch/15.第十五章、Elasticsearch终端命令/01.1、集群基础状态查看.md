---
title: 1、集群基础状态查看
---
## 📚 目录

1. [Elasticsearch基础认知](#1-Elasticsearch基础认知)
2. [集群基本信息查看](#2-集群基本信息查看)
3. [集群健康状态监控](#3-集群健康状态监控)
4. [集群统计信息获取](#4-集群统计信息获取)
5. [节点状态管理](#5-节点状态管理)
6. [可视化查看工具](#6-可视化查看工具)
7. [集群配置管理](#7-集群配置管理)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔍 Elasticsearch基础认知


### 1.1 什么是Elasticsearch


**🔸 通俗理解**
想象一下，Elasticsearch就像是一个**超级智能的图书管理员**。传统图书馆需要你知道确切的书名才能找到书，但这个智能管理员可以通过任何关键词、甚至是模糊的描述来帮你快速找到相关的所有书籍。

```
传统数据库查询：  我要找"张三"的记录
                 ↓
               精确匹配查找

Elasticsearch查询：我要找"张"开头的，年龄30左右的人
                  ↓
                全文搜索+模糊匹配+条件过滤
```

**🎯 Elasticsearch的核心价值**
- **全文搜索**：像百度搜索一样，输入关键词就能找到相关内容
- **实时性**：数据写入后几乎立即可以搜索到
- **分布式**：可以部署在多台服务器上，处理海量数据
- **高可用**：单台服务器故障不影响整体服务

### 1.2 集群概念解析


**🏢 什么是集群**

> 集群就像一个**公司的多个部门协同工作**。每个部门（节点）都有自己的职责，但大家一起完成同一个目标。

```
Elasticsearch集群架构：

     主节点(Master)     ← 相当于总经理，负责整体协调
    /       |       \
数据节点1  数据节点2  数据节点3  ← 相当于各部门，负责具体工作
   |        |        |
 存储A    存储B    存储C     ← 每个节点存储部分数据
```

**🔗 集群的关键概念**

| **概念** | **通俗解释** | **技术含义** |
|---------|------------|-------------|
| **节点(Node)** | `公司里的一个员工` | `集群中的一台服务器` |
| **主节点(Master)** | `部门经理，负责协调` | `负责集群管理和元数据操作` |
| **数据节点(Data)** | `实际干活的员工` | `存储数据并处理搜索请求` |
| **分片(Shard)** | `把大任务拆分成小任务` | `把索引数据分成多个片段` |
| **副本(Replica)** | `工作备份，防止丢失` | `数据的备份副本` |

---

## 2. 📊 集群基本信息查看


### 2.1 查看集群基础信息


**🔍 最基础的"自我介绍"命令**

```bash
curl -X GET "localhost:9200"
```

> **通俗解释**：这就像走进一家新公司，先问前台"你们公司叫什么名字，现在什么情况？"

**📋 返回信息解读**

```json
{
  "name" : "node-1",                    // 节点名称（这台服务器的名字）
  "cluster_name" : "my-cluster",        // 集群名称（公司名称）
  "cluster_uuid" : "abc123...",         // 集群唯一标识（公司注册号）
  "version" : {                         // 版本信息
    "number" : "7.10.0",               // Elasticsearch版本号
    "build_flavor" : "default",        // 构建类型
    "build_type" : "tar"               // 安装包类型
  },
  "tagline" : "You Know, for Search"   // Elasticsearch的标语
}
```

**💡 实际应用场景**
- **新环境确认**：连接新的ES服务时，先确认连接是否正常
- **版本检查**：确认ES版本，避免API兼容性问题
- **集群识别**：确认连接到正确的集群

### 2.2 命令参数详解


**🔧 curl命令结构解析**

```
curl -X GET "localhost:9200"
  |   |  |        |
  |   |  |        └── ES服务地址和端口
  |   |  └─────────── HTTP请求方法
  |   └─────────────── 指定请求方法的参数
  └─────────────────── curl工具命令
```

**⚙️ 常用参数说明**

| **参数** | **含义** | **示例** | **使用场景** |
|---------|---------|---------|-------------|
| `-X GET` | `指定HTTP GET方法` | `查询数据` | `获取信息时使用` |
| `-X POST` | `指定HTTP POST方法` | `提交数据` | `创建或更新数据` |
| `-X PUT` | `指定HTTP PUT方法` | `完整替换` | `创建索引或文档` |
| `-X DELETE` | `指定HTTP DELETE方法` | `删除数据` | `删除索引或文档` |

---

## 3. 🏥 集群健康状态监控


### 3.1 基础健康检查


**❤️ 集群"体检"命令**

```bash
curl -X GET "localhost:9200/_cluster/health"
```

> **通俗解释**：就像给公司做一个整体的健康体检，看看各个部门运转是否正常。

**🎨 美化输出格式**

```bash
curl -X GET "localhost:9200/_cluster/health?pretty"
```

> **pretty参数的作用**：让返回的JSON数据格式化显示，就像把杂乱的文件整理得整整齐齐，方便阅读。

**📊 健康状态详解**

```json
{
  "cluster_name" : "my-cluster",           // 集群名称
  "status" : "green",                      // 健康状态（重点关注）
  "timed_out" : false,                     // 是否超时
  "number_of_nodes" : 3,                   // 节点总数
  "number_of_data_nodes" : 2,              // 数据节点数
  "active_primary_shards" : 5,             // 活跃主分片数
  "active_shards" : 10,                    // 总活跃分片数
  "relocating_shards" : 0,                 // 正在迁移的分片
  "initializing_shards" : 0,               // 正在初始化的分片
  "unassigned_shards" : 0                  // 未分配的分片
}
```

### 3.2 健康状态颜色含义


**🚦 三色健康指示灯**

```
集群健康状态解读：

🟢 GREEN（绿色）    ← 完全健康
├─ 所有主分片和副本都正常
├─ 所有功能完全可用
└─ 这是最理想的状态

🟡 YELLOW（黄色）   ← 基本健康，有隐患
├─ 所有主分片正常
├─ 部分副本分片有问题
└─ 功能可用，但可靠性降低

🔴 RED（红色）      ← 严重问题
├─ 部分主分片不可用
├─ 部分数据无法访问
└─ 需要立即处理
```

**⚠️ 各状态的实际影响**

| **状态** | **数据可用性** | **服务影响** | **处理紧急度** |
|---------|--------------|-------------|--------------|
| **🟢 GREEN** | `100%可用` | `无影响` | `无需处理` |
| **🟡 YELLOW** | `100%可用` | `性能可能下降` | `建议尽快处理` |
| **🔴 RED** | `部分不可用` | `严重影响业务` | `立即处理` |

### 3.3 健康状态监控实践


**📈 持续监控命令**

```bash
# 每5秒检查一次健康状态
watch -n 5 'curl -s "localhost:9200/_cluster/health?pretty"'
```

**🔍 详细健康信息查看**

```bash
# 查看每个索引的健康状态
curl -X GET "localhost:9200/_cluster/health?level=indices&pretty"
```

> **level=indices参数**：把检查粒度细化到每个索引，就像不仅看公司整体情况，还要看每个部门的具体状况。

---

## 4. 📈 集群统计信息获取


### 4.1 集群整体统计


**📊 集群"年报"查看**

```bash
curl -X GET "localhost:9200/_cluster/stats"
```

> **通俗解释**：就像查看公司的年度报告，了解整体的运营数据、资源使用情况、业务指标等。

**🔢 关键统计指标解读**

```
集群统计信息结构：

📊 indices（索引相关）
├─ count: 索引总数
├─ docs: 文档总数  
├─ store: 存储大小
└─ fielddata: 字段数据内存使用

🖥️ nodes（节点相关）
├─ count: 节点总数
├─ versions: ES版本分布
├─ os: 操作系统信息
└─ jvm: Java虚拟机信息

💾 stats（性能统计）
├─ fs: 文件系统使用
├─ memory: 内存使用
└─ cpu: CPU使用情况
```

### 4.2 节点详细统计


**🔍 单个"员工"的工作报告**

```bash
curl -X GET "localhost:9200/_nodes/stats"
```

> **应用场景**：当集群出现性能问题时，通过这个命令可以找出是哪个节点负载过高，就像找出哪个员工工作量过大需要调整。

**📋 节点统计关键指标**

| **指标类别** | **关键数据** | **实际意义** |
|-------------|-------------|-------------|
| **JVM内存** | `heap_used_percent` | `Java内存使用率，超过75%需要注意` |
| **磁盘空间** | `fs.total.free_in_bytes` | `剩余磁盘空间，用完会影响写入` |
| **查询性能** | `search.query_time_in_millis` | `搜索响应时间，数值越小越好` |
| **索引性能** | `indexing.index_time_in_millis` | `数据写入耗时，影响写入效率` |

---

## 5. 🖥️ 节点状态管理


### 5.1 节点基础信息查看


**👥 查看团队成员列表**

```bash
curl -X GET "localhost:9200/_cat/nodes?v"
```

> **v参数的作用**：verbose的缩写，显示表头信息，让数据更好理解，就像给表格加上标题行。

**📋 节点信息表格解读**

```
输出示例：
ip        heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
10.0.0.1            45          78   2    0.12    0.15     0.18 mdi       *      node-1
10.0.0.2            52          65   1    0.08    0.11     0.14 mdi       -      node-2
10.0.0.3            38          72   3    0.21    0.19     0.16 mdi       -      node-3
```

**🔍 字段含义详解**

| **字段** | **含义** | **关注点** |
|---------|---------|-----------|
| **heap.percent** | `JVM堆内存使用百分比` | `超过75%需要关注` |
| **ram.percent** | `系统内存使用百分比` | `超过90%需要关注` |
| **cpu** | `CPU使用百分比` | `持续高负载需要调优` |
| **node.role** | `节点角色(m=master,d=data,i=ingest)` | `了解节点功能分工` |
| **master** | `是否为主节点(*表示是)` | `确认集群管理者` |

### 5.2 节点角色理解


**🎭 不同角色的"工作职责"**

```
Elasticsearch节点角色分工：

🎯 Master节点 (m)
├─ 职责：集群管理和协调
├─ 类比：公司总经理
└─ 关键：负责索引创建、节点加入退出等

📦 Data节点 (d)  
├─ 职责：数据存储和搜索
├─ 类比：业务部门员工
└─ 关键：承担实际的数据处理工作

🔄 Ingest节点 (i)
├─ 职责：数据预处理
├─ 类比：数据清洗专员  
└─ 关键：在数据存储前进行转换
```

---

## 6. 👀 可视化查看工具


### 6.1 健康状态表格化显示


**📊 一目了然的健康看板**

```bash
curl -X GET "localhost:9200/_cat/health?v"
```

> **_cat API的优势**：专门为人类阅读设计的API，返回简洁的表格格式，不需要解析复杂的JSON。

**📈 输出示例解读**

```
epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent
1609459200 12:00:00  my-cluster    green           3         2     10   5    0    0        0             0                  -                100.0%
```

### 6.2 _cat API系列命令


**🛠️ 运维人员的"瑞士军刀"**

| **命令** | **作用** | **使用场景** |
|---------|---------|-------------|
| `_cat/health?v` | `集群健康状态` | `日常巡检` |
| `_cat/nodes?v` | `节点列表` | `资源监控` |
| `_cat/indices?v` | `索引列表` | `数据管理` |
| `_cat/shards?v` | `分片分布` | `性能调优` |
| `_cat/allocation?v` | `磁盘分配` | `容量规划` |

**💡 _cat API使用技巧**

```bash
# 按特定字段排序
curl -X GET "localhost:9200/_cat/nodes?v&s=heap.percent:desc"

# 只显示特定字段
curl -X GET "localhost:9200/_cat/nodes?v&h=name,heap.percent,ram.percent"

# 输出为JSON格式
curl -X GET "localhost:9200/_cat/nodes?format=json&pretty"
```

---

## 7. ⚙️ 集群配置管理


### 7.1 查看集群设置


**🔧 查看集群"配置文件"**

```bash
curl -X GET "localhost:9200/_cluster/settings"
```

> **通俗解释**：就像查看公司的规章制度，了解集群是按照什么规则在运行。

**📋 配置分类理解**

```
集群设置层级结构：

🌍 persistent（持久设置）
├─ 重启后仍然生效
├─ 存储在集群状态中
└─ 优先级最高

⚡ transient（临时设置）  
├─ 重启后失效
├─ 仅在当前会话有效
└─ 优先级中等

📁 defaults（默认设置）
├─ ES内置默认值
├─ 配置文件中的设置
└─ 优先级最低
```

### 7.2 常见配置项说明


**🎛️ 重要配置参数解释**

| **配置项** | **含义** | **影响** |
|-----------|---------|---------|
| `cluster.routing.allocation.enable` | `分片分配控制` | `控制是否允许分片迁移` |
| `indices.recovery.max_bytes_per_sec` | `恢复速度限制` | `影响节点故障恢复速度` |
| `cluster.routing.rebalance.enable` | `分片再平衡` | `控制负载均衡行为` |

### 7.3 配置修改示例


**✏️ 动态修改集群设置**

```bash
# 临时禁用分片分配（用于维护）
curl -X PUT "localhost:9200/_cluster/settings" -H 'Content-Type: application/json' -d'
{
  "transient": {
    "cluster.routing.allocation.enable": "none"
  }
}'

# 恢复分片分配
curl -X PUT "localhost:9200/_cluster/settings" -H 'Content-Type: application/json' -d'
{
  "transient": {
    "cluster.routing.allocation.enable": "all"
  }
}'
```

> **⚠️ 安全提醒**：修改集群配置前一定要了解其影响，建议先在测试环境验证。

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基础命令


```
🔸 基础信息：curl -X GET "localhost:9200"
🔸 健康检查：curl -X GET "localhost:9200/_cluster/health?pretty"
🔸 节点状态：curl -X GET "localhost:9200/_cat/nodes?v"
🔸 集群统计：curl -X GET "localhost:9200/_cluster/stats"
🔸 可视化查看：curl -X GET "localhost:9200/_cat/health?v"
🔸 配置查看：curl -X GET "localhost:9200/_cluster/settings"
```

### 8.2 健康监控关键点


**🎯 日常监控重点**
- **集群状态颜色**：绿色正常，黄色警告，红色严重
- **节点内存使用**：JVM堆内存不应超过75%
- **磁盘空间**：及时清理或扩容，避免写入失败
- **未分配分片**：数量为0表示健康

### 8.3 故障排查思路


**🔍 问题诊断流程**

```
故障排查流程图：

1️⃣ 检查集群健康状态
    ↓
2️⃣ 查看节点列表和状态
    ↓  
3️⃣ 分析具体错误信息
    ↓
4️⃣ 查看日志定位问题
    ↓
5️⃣ 采取对应解决措施
```

### 8.4 实际运维建议


**💡 运维最佳实践**
- **定期检查**：每天至少检查一次集群健康状态
- **监控告警**：设置自动化监控，异常时及时通知
- **备份策略**：定期备份重要数据和配置
- **容量规划**：根据业务增长预留足够资源
- **版本管理**：及时关注ES版本更新和安全补丁

### 8.5 新手学习路径


**📚 学习进阶建议**
1. **熟练基础命令**：掌握本章所有命令的使用
2. **理解集群概念**：深入了解分片、副本、节点角色
3. **实践操作**：在测试环境多动手练习
4. **问题处理**：学会分析和解决常见问题
5. **进阶学习**：索引管理、查询优化、性能调优

**核心记忆口诀**：
```
ES集群像公司，节点员工各司职
健康状态看颜色，绿黄红灯要牢记  
cat命令看得清，pretty格式更友好
基础命令要熟练，监控运维不用愁
```