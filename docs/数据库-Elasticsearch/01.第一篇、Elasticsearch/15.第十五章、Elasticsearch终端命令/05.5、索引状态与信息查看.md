---
title: 5、索引状态与信息查看
---
## 📚 目录

1. [索引信息查看基础](#1-索引信息查看基础)
2. [索引列表查看操作](#2-索引列表查看操作)
3. [索引详细信息获取](#3-索引详细信息获取)
4. [索引设置与映射查看](#4-索引设置与映射查看)
5. [索引统计信息分析](#5-索引统计信息分析)
6. [分片信息监控](#6-分片信息监控)
7. [实用查看技巧](#7-实用查看技巧)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔍 索引信息查看基础


### 1.1 什么是索引信息查看


**简单理解**：就像查看文件夹的属性一样，了解你的数据存储情况

```
生活比喻：
图书馆管理员需要知道：
- 有哪些书架？（索引列表）
- 每个书架有多少本书？（文档数量）
- 书架状态如何？（健康状态）
- 书架是如何分类的？（映射结构）

Elasticsearch中：
- 索引 = 书架
- 文档 = 书本
- 映射 = 分类规则
- 统计 = 使用情况
```

### 1.2 为什么要查看索引信息


**🎯 核心作用**：
- **监控健康状态**：及时发现问题
- **了解数据规模**：知道存了多少数据
- **性能分析**：找出性能瓶颈
- **容量规划**：预测存储需求

### 1.3 信息查看的基本思路


```
查看顺序建议：
1. 先看整体 → 索引列表概览
2. 再看细节 → 单个索引详情
3. 深入分析 → 设置、映射、统计
4. 问题定位 → 分片状态检查
```

---

## 2. 📋 索引列表查看操作


### 2.1 基础索引列表查看


**🔸 最常用命令**：查看所有索引概览
```bash
curl -X GET "localhost:9200/_cat/indices?v"
```

**💡 命令解读**：
- `_cat/indices`：cat命令专门用于人类可读的输出
- `?v`：显示列标题（verbose），让输出更易读

**📊 输出示例**：
```
health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size
yellow open   my_blog  u8FNjxKLTLWBEyXFYp0mgg   1   1        100            0      45.1kb         45.1kb
green  open   my_shop  x9GQkzMLSMWCFzYGq1nhhw   2   0       1500            5      89.2kb         89.2kb
```

**📝 字段含义解释**：
- **health**：`🟢 green`(健康) `🟡 yellow`(警告) `🔴 red`(故障)
- **status**：`open`(可用) `close`(关闭)
- **index**：索引名称
- **pri**：主分片数量
- **rep**：副本分片数量
- **docs.count**：文档总数
- **store.size**：总存储大小

### 2.2 自定义字段显示


**🔸 指定显示字段**：只看关心的信息
```bash
curl -X GET "localhost:9200/_cat/indices?h=index,status,health,docs.count"
```

**💡 常用字段组合**：
```bash
# 基础信息组合
curl -X GET "localhost:9200/_cat/indices?h=index,health,docs.count,store.size"

# 分片信息组合  
curl -X GET "localhost:9200/_cat/indices?h=index,pri,rep,docs.count"

# 性能关注组合
curl -X GET "localhost:9200/_cat/indices?h=index,docs.count,store.size,search.query_total"
```

### 2.3 排序和过滤


**🔸 按文档数排序**：
```bash
curl -X GET "localhost:9200/_cat/indices?v&s=docs.count:desc"
```

**🔸 按存储大小排序**：
```bash
curl -X GET "localhost:9200/_cat/indices?v&s=store.size:desc"
```

**⚡ 实用技巧**：
| 排序参数 | 含义 | 使用场景 |
|---------|------|----------|
| `s=docs.count:desc` | 按文档数降序 | 找出数据量最大的索引 |
| `s=store.size:desc` | 按存储大小降序 | 找出占用空间最多的索引 |
| `s=index` | 按索引名排序 | 按字母顺序查看 |

---

## 3. 📖 索引详细信息获取


### 3.1 获取索引基本信息


**🔸 查看单个索引详情**：
```bash
curl -X GET "localhost:9200/my_index"
```

**📊 返回信息结构**：
```json
{
  "my_index": {
    "aliases": {},           // 别名信息
    "mappings": {},         // 字段映射
    "settings": {}          // 索引设置
  }
}
```

**💡 信息解读**：
- **aliases**：这个索引的别名（如果有的话）
- **mappings**：定义了文档结构和字段类型
- **settings**：索引的配置参数

### 3.2 批量查看多个索引


**🔸 查看多个指定索引**：
```bash
curl -X GET "localhost:9200/index1,index2,index3"
```

**🔸 使用通配符查看**：
```bash
# 查看所有以 "log" 开头的索引
curl -X GET "localhost:9200/log*"

# 查看所有以 "2024" 结尾的索引  
curl -X GET "localhost:9200/*2024"
```

**⚠️ 注意事项**：
- 通配符查询可能返回大量数据
- 建议先用 `_cat/indices` 确认索引名称
- 生产环境中谨慎使用通配符

---

## 4. ⚙️ 索引设置与映射查看


### 4.1 查看索引设置


**🔸 获取索引配置**：
```bash
curl -X GET "localhost:9200/my_index/_settings"
```

**📋 常见设置项解释**：
```json
{
  "my_index": {
    "settings": {
      "index": {
        "number_of_shards": "1",      // 主分片数量
        "number_of_replicas": "0",    // 副本数量
        "creation_date": "1640995200000",  // 创建时间戳
        "version": {
          "created": "7140099"         // 创建时的ES版本
        }
      }
    }
  }
}
```

**💡 设置项含义**：
- **number_of_shards**：数据分片数量，创建后不可修改
- **number_of_replicas**：副本数量，可以动态修改
- **refresh_interval**：刷新间隔，影响搜索的实时性

### 4.2 查看索引映射


**🔸 获取字段映射**：
```bash
curl -X GET "localhost:9200/my_index/_mapping"
```

**📊 映射结构示例**：
```json
{
  "my_index": {
    "mappings": {
      "properties": {
        "title": {
          "type": "text",           // 文本类型，可分词
          "analyzer": "standard"    // 使用标准分析器
        },
        "publish_date": {
          "type": "date",           // 日期类型
          "format": "yyyy-MM-dd"    // 日期格式
        },
        "view_count": {
          "type": "integer"         // 整数类型
        }
      }
    }
  }
}
```

**🔧 映射类型说明**：

| 字段类型 | 用途 | 示例 |
|---------|------|------|
| `text` | 全文搜索 | 文章内容、标题 |
| `keyword` | 精确匹配 | 状态码、分类 |
| `integer/long` | 数值 | 数量、ID |
| `date` | 日期时间 | 创建时间、更新时间 |
| `boolean` | 布尔值 | 是否发布 |

---

## 5. 📊 索引统计信息分析


### 5.1 获取索引统计


**🔸 查看索引统计信息**：
```bash
curl -X GET "localhost:9200/my_index/_stats"
```

**📈 统计信息类别**：
```
性能统计:
├── 文档操作
│   ├── 索引操作次数 (indexing)
│   ├── 删除操作次数 (delete)  
│   └── 搜索操作次数 (search)
├── 存储统计
│   ├── 总存储大小 (store.size)
│   └── 文档数量 (docs.count)
└── 缓存统计
    ├── 查询缓存 (query_cache)
    └── 字段数据缓存 (fielddata)
```

### 5.2 关键统计指标解读


**🎯 重要指标说明**：

**📝 文档操作统计**：
- `docs.count`：当前文档总数
- `docs.deleted`：已删除文档数（等待合并清理）
- `indexing.index_total`：索引操作总次数
- `search.query_total`：搜索查询总次数

**💾 存储统计**：
- `store.size_in_bytes`：索引总存储字节数
- `segments.count`：段文件数量
- `segments.memory_in_bytes`：段占用内存

**⚡ 性能统计**：
- `search.query_time_in_millis`：搜索总耗时
- `indexing.index_time_in_millis`：索引总耗时

### 5.3 获取特定统计信息


**🔸 只获取文档统计**：
```bash
curl -X GET "localhost:9200/my_index/_stats/docs"
```

**🔸 只获取搜索统计**：
```bash
curl -X GET "localhost:9200/my_index/_stats/search"
```

**🔸 只获取索引统计**：
```bash
curl -X GET "localhost:9200/my_index/_stats/indexing"
```

---

## 6. 🔧 分片信息监控


### 6.1 查看分片状态


**🔸 查看所有分片信息**：
```bash
curl -X GET "localhost:9200/_cat/shards?v"
```

**📊 输出示例**：
```
index   shard prirep state   docs store ip        node
my_blog 0     p      STARTED  100 45.1kb 127.0.0.1 node-1
my_blog 0     r      STARTED  100 45.1kb 127.0.0.1 node-2
my_shop 0     p      STARTED  750 44.6kb 127.0.0.1 node-1
my_shop 1     p      STARTED  750 44.6kb 127.0.0.1 node-2
```

**📝 字段解释**：
- **shard**：分片编号（从0开始）
- **prirep**：`p`(主分片) `r`(副本分片)
- **state**：分片状态
- **docs**：该分片文档数
- **store**：该分片存储大小
- **node**：分片所在节点

### 6.2 分片状态含义


**🚦 分片状态说明**：

| 状态 | 含义 | 说明 |
|------|------|------|
| `STARTED` | ✅ 正常运行 | 分片可以正常读写 |
| `INITIALIZING` | 🔄 初始化中 | 分片正在启动 |
| `RELOCATING` | 📦 迁移中 | 分片正在节点间迁移 |
| `UNASSIGNED` | ⚠️ 未分配 | 分片没有分配到节点 |

### 6.3 查看特定索引的分片


**🔸 查看指定索引分片**：
```bash
curl -X GET "localhost:9200/_cat/shards/my_index?v"
```

**🔸 查看问题分片**：
```bash
# 查看未分配的分片
curl -X GET "localhost:9200/_cat/shards?h=index,shard,prirep,state,unassigned.reason" | grep UNASSIGNED

# 查看正在初始化的分片
curl -X GET "localhost:9200/_cat/shards?v" | grep INITIALIZING
```

---

## 7. 💡 实用查看技巧


### 7.1 健康状态快速检查


**🔸 快速健康检查脚本**：
```bash
# 检查集群整体健康
curl -X GET "localhost:9200/_cluster/health?pretty"

# 检查有问题的索引
curl -X GET "localhost:9200/_cat/indices?v" | grep -E "(red|yellow)"

# 检查未分配的分片
curl -X GET "localhost:9200/_cat/shards?v" | grep UNASSIGNED
```

### 7.2 容量监控技巧


**📊 存储容量分析**：
```bash
# 按存储大小排序，找出最大的索引
curl -X GET "localhost:9200/_cat/indices?h=index,store.size&s=store.size:desc"

# 统计总的存储使用
curl -X GET "localhost:9200/_cat/allocation?v"

# 查看节点存储使用情况
curl -X GET "localhost:9200/_cat/nodes?h=name,disk.used_percent,disk.used,disk.total&v"
```

### 7.3 性能分析技巧


**⚡ 性能指标获取**：
```bash
# 查看搜索性能最差的索引
curl -X GET "localhost:9200/_cat/indices?h=index,search.query_total,search.query_time&s=search.query_time:desc"

# 查看索引操作频繁的索引
curl -X GET "localhost:9200/_cat/indices?h=index,indexing.index_total,indexing.index_time&s=indexing.index_total:desc"
```

### 7.4 日常监控脚本


**🔍 一键检查脚本思路**：
```bash
#!/bin/bash
echo "=== Elasticsearch 健康检查 ==="

echo "1. 集群状态:"
curl -s "localhost:9200/_cluster/health?pretty" | grep -E "(status|number_of_nodes)"

echo -e "\n2. 问题索引:"
curl -s "localhost:9200/_cat/indices?v" | grep -E "(red|yellow)" || echo "所有索引状态正常"

echo -e "\n3. 存储最大的前5个索引:"
curl -s "localhost:9200/_cat/indices?h=index,store.size&s=store.size:desc" | head -5

echo -e "\n4. 未分配分片:"
curl -s "localhost:9200/_cat/shards?v" | grep UNASSIGNED || echo "所有分片已分配"
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本命令


```bash
🔸 索引概览：curl -X GET "localhost:9200/_cat/indices?v"
🔸 索引详情：curl -X GET "localhost:9200/my_index"  
🔸 索引设置：curl -X GET "localhost:9200/my_index/_settings"
🔸 索引映射：curl -X GET "localhost:9200/my_index/_mapping"
🔸 索引统计：curl -X GET "localhost:9200/my_index/_stats"
🔸 分片状态：curl -X GET "localhost:9200/_cat/shards?v"
```

### 8.2 日常监控重点关注


**🎯 健康状态监控**：
- **集群颜色**：绿色正常，黄色警告，红色故障
- **分片分配**：确保没有未分配分片
- **存储增长**：监控磁盘使用趋势

**📊 性能指标关注**：
- **文档数量增长**：了解数据增长速度
- **存储大小变化**：预测容量需求
- **搜索延迟**：关注用户体验

### 8.3 常见问题排查思路


```
问题排查流程：
1. 集群健康 → _cluster/health
2. 索引状态 → _cat/indices  
3. 分片分布 → _cat/shards
4. 节点状态 → _cat/nodes
5. 详细分析 → 具体索引的 _stats
```

### 8.4 最佳实践建议


**💡 监控建议**：
- **定期检查**：每日查看集群健康状态
- **容量规划**：根据存储增长趋势提前扩容
- **性能优化**：关注查询慢的索引，考虑优化
- **备份策略**：重要索引要有备份计划

**🔧 操作技巧**：
- **使用别名**：方便索引切换和管理
- **合理分片**：根据数据量设置合适的分片数
- **监控告警**：设置关键指标的告警阈值

**核心记忆**：
- `_cat` 命令用于人类可读输出，记得加 `?v` 显示表头
- 索引信息包括：基本信息、设置、映射、统计四大类
- 分片状态直接影响索引可用性，要重点关注
- 定期监控存储和性能指标，做好容量规划