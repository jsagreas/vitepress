---
title: 10、基础搜索查询
---
## 📚 目录

1. [搜索查询基础概念](#1-搜索查询基础概念)
2. [最简单的搜索操作](#2-最简单的搜索操作)
3. [URI查询方式](#3-URI查询方式)
4. [JSON查询方式](#4-JSON查询方式)
5. [分页与排序操作](#5-分页与排序操作)
6. [跨索引搜索技巧](#6-跨索引搜索技巧)
7. [实战应用场景](#7-实战应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🔍 搜索查询基础概念


### 1.1 什么是Elasticsearch搜索

**简单理解**：搜索就是在Elasticsearch中找到你想要的数据，就像在图书馆里找书一样。

```
现实世界的搜索：
图书馆找书 → 按书名、作者、类别查找
网上购物   → 按商品名、品牌、价格筛选

Elasticsearch搜索：
数据库查找 → 按字段内容、条件、范围检索
```

### 1.2 搜索的两种基本方式

**🔸 URI查询**（简单快捷）
- 把查询条件直接写在网址里
- 适合简单的查询
- 就像在搜索框里直接输入关键词

**🔸 JSON查询**（功能强大）
- 用JSON格式描述复杂的查询条件
- 适合复杂的查询逻辑
- 就像填写详细的搜索表单

### 1.3 搜索结果的基本结构

当你发起搜索后，Elasticsearch会返回：
- **总数量**：一共找到多少条数据
- **具体数据**：实际的文档内容
- **评分信息**：每条结果的相关性得分
- **耗时信息**：这次搜索用了多长时间

---

## 2. 🎯 最简单的搜索操作


### 2.1 搜索所有文档

**功能说明**：查看某个索引里的所有数据，就像打开一个文件夹查看所有文件。

```bash
curl -X GET "localhost:9200/my_index/_search"
```

**命令解释**：
- `GET`：表示我们要获取数据
- `my_index`：要搜索的索引名称（相当于数据库表名）
- `_search`：告诉ES这是一个搜索操作

### 2.2 返回结果说明

```json
{
  "took": 5,                    // 搜索耗时5毫秒
  "timed_out": false,           // 没有超时
  "hits": {
    "total": {"value": 100},    // 总共找到100条数据
    "max_score": 1.0,           // 最高相关性得分
    "hits": [...]               // 具体的搜索结果
  }
}
```

**结果字段含义**：
- `took`：搜索花费的时间（毫秒）
- `hits.total.value`：匹配的文档总数
- `hits.hits`：实际返回的文档列表（默认返回前10条）

### 2.3 实际应用场景

```bash
# 查看用户索引的所有数据
curl -X GET "localhost:9200/users/_search"

# 查看商品索引的所有数据  
curl -X GET "localhost:9200/products/_search"

# 查看日志索引的所有数据
curl -X GET "localhost:9200/logs/_search"
```

---

## 3. 🔎 URI查询方式


### 3.1 基本URI查询语法

**功能说明**：在URL中直接指定查询条件，就像在搜索引擎里输入关键词。

```bash
curl -X GET "localhost:9200/my_index/_search?q=field:value"
```

**语法结构**：
- `?q=`：表示查询参数的开始
- `field:value`：在指定字段中查找指定值
- 格式：`字段名:要查找的值`

### 3.2 常用URI查询示例


**🔸 精确查找**
```bash
# 查找用户名为"张三"的用户
curl -X GET "localhost:9200/users/_search?q=username:张三"

# 查找状态为"已发布"的文章
curl -X GET "localhost:9200/articles/_search?q=status:published"

# 查找价格为99的商品
curl -X GET "localhost:9200/products/_search?q=price:99"
```

**🔸 模糊查找**
```bash
# 查找标题中包含"技术"的文章
curl -X GET "localhost:9200/articles/_search?q=title:技术"

# 查找描述中包含"优惠"的商品
curl -X GET "localhost:9200/products/_search?q=description:优惠"
```

**🔸 多条件查询**
```bash
# 同时满足多个条件（AND关系）
curl -X GET "localhost:9200/products/_search?q=category:电子产品 AND price:100"

# 满足任一条件（OR关系）
curl -X GET "localhost:9200/users/_search?q=city:北京 OR city:上海"
```

### 3.3 URI查询的优缺点对比


| 特点 | **URI查询** | **说明** |
|------|------------|----------|
| ✅ **优点** | `简单快捷` | 适合简单查询，一行命令搞定 |
| ✅ **优点** | `学习成本低` | 语法简单，容易上手 |
| ❌ **缺点** | `功能有限` | 复杂查询难以表达 |
| ❌ **缺点** | `特殊字符问题` | URL编码问题，中文需要转码 |

---

## 4. 📝 JSON查询方式


### 4.1 match_all查询（查询所有）

**功能说明**：查询索引中的所有文档，等同于"显示全部"。

```bash
curl -X POST "localhost:9200/my_index/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match_all": {}
  }
}'
```

**JSON结构解释**：
```json
{
  "query": {          // 查询块：告诉ES这是查询操作
    "match_all": {}    // 匹配所有：不设任何条件
  }
}
```

### 4.2 match查询（匹配查询）

**功能说明**：在指定字段中查找包含指定词语的文档，支持分词和模糊匹配。

```bash
curl -X POST "localhost:9200/my_index/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "field": "value"
    }
  }
}'
```

**实际应用示例**：
```bash
# 在标题字段中查找包含"Elasticsearch"的文章
curl -X POST "localhost:9200/articles/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "title": "Elasticsearch"
    }
  }
}'
```

### 4.3 match查询的智能特性


**🔸 自动分词**：
```
输入："Elasticsearch教程"
实际搜索：["Elasticsearch", "教程"]
能匹配：
- "Elasticsearch入门教程"  ✅
- "教程：Elasticsearch使用"  ✅  
- "学习Elasticsearch"  ✅
```

**🔸 相关性评分**：
```
搜索词："技术文章"
结果按相关性排序：
1. "技术文章精选"     (评分最高，完全匹配)
2. "技术分享文章"     (评分中等，部分匹配)  
3. "文章分类技术"     (评分较低，词序不同)
```

### 4.4 常用查询类型对比


| 查询类型 | **使用场景** | **示例** | **特点** |
|---------|-------------|----------|---------|
| 🎯 **match_all** | `查看所有数据` | 浏览全部商品 | 无条件查询 |
| 🔍 **match** | `关键词搜索` | 搜索文章标题 | 支持分词，模糊匹配 |
| 📋 **term** | `精确匹配` | 查找特定ID | 不分词，完全匹配 |
| 📊 **range** | `范围查询` | 价格区间筛选 | 数值、日期范围 |

---

## 5. 📄 分页与排序操作


### 5.1 分页查询基础

**为什么需要分页**：当搜索结果很多时（比如10万条），一次性显示会很慢，就像翻书一样需要一页一页看。

**分页参数说明**：
- `size`：每页显示多少条数据（默认10条）
- `from`：从第几条开始显示（从0开始计数）

### 5.2 基础分页操作

```bash
# 查看前10条数据（第1页）
curl -X GET "localhost:9200/my_index/_search?size=10&from=0"

# 查看第2页数据（第11-20条）
curl -X GET "localhost:9200/my_index/_search?size=10&from=10"

# 查看第3页数据（第21-30条）
curl -X GET "localhost:9200/my_index/_search?size=10&from=20"
```

**分页计算公式**：
```
页数计算：
第1页：from = 0
第2页：from = size × 1 = 10
第3页：from = size × 2 = 20
第N页：from = size × (N-1)
```

### 5.3 排序查询操作

**功能说明**：按照指定字段对搜索结果进行排序，就像按价格、时间、评分排序商品。

```bash
# 按价格降序排列（从高到低）
curl -X GET "localhost:9200/products/_search?sort=price:desc"

# 按创建时间升序排列（从早到晚）
curl -X GET "localhost:9200/articles/_search?sort=created_at:asc"

# 按评分降序排列（评分高的在前）
curl -X GET "localhost:9200/reviews/_search?sort=rating:desc"
```

**排序方向说明**：
- `asc`：升序（从小到大，A-Z，旧到新）
- `desc`：降序（从大到小，Z-A，新到旧）

### 5.4 组合分页和排序

```bash
# 按价格降序，显示第2页，每页5条
curl -X GET "localhost:9200/products/_search?sort=price:desc&size=5&from=5"

# 按时间降序，显示最新的20条
curl -X GET "localhost:9200/news/_search?sort=publish_time:desc&size=20"
```

### 5.5 JSON方式的分页排序

```bash
curl -X POST "localhost:9200/products/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {"match_all": {}},
  "sort": [
    {"price": {"order": "desc"}},
    {"created_at": {"order": "asc"}}
  ],
  "size": 10,
  "from": 0
}'
```

---

## 6. 🌐 跨索引搜索技巧


### 6.1 什么是跨索引搜索

**简单理解**：同时在多个索引中搜索数据，就像同时在多个文件夹中查找文件。

```
单索引搜索：只在"用户"表中查找
跨索引搜索：同时在"用户"、"订单"、"商品"表中查找
```

### 6.2 搜索所有索引

```bash
# 在所有索引中搜索
curl -X GET "localhost:9200/_search"

# 查找所有索引中包含"error"的文档
curl -X GET "localhost:9200/_search?q=error"
```

**应用场景**：
- 全局搜索用户输入的关键词
- 在所有日志中查找错误信息
- 跨表查询相关数据

### 6.3 指定多个索引搜索

```bash
# 在指定的多个索引中搜索
curl -X GET "localhost:9200/users,orders,products/_search"

# 使用通配符搜索
curl -X GET "localhost:9200/log-*/_search"

# 搜索以"shop"开头的所有索引
curl -X GET "localhost:9200/shop*/_search"
```

### 6.4 跨索引搜索的实际应用


**🔸 电商平台搜索**
```bash
# 同时搜索商品、店铺、品牌
curl -X GET "localhost:9200/products,shops,brands/_search?q=苹果"
```

**🔸 日志分析**
```bash
# 搜索所有日期的日志
curl -X GET "localhost:9200/log-2024-*/_search?q=level:ERROR"
```

**🔸 用户行为分析**
```bash
# 搜索用户相关的所有数据
curl -X GET "localhost:9200/users,user_actions,user_preferences/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "user_id": "12345"
    }
  }
}'
```

---

## 7. 🎯 实战应用场景


### 7.1 电商商品搜索系统


**场景描述**：用户在电商网站搜索商品，需要支持关键词搜索、分页、排序。

```bash
# 1. 搜索包含"手机"的商品
curl -X POST "localhost:9200/products/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "title": "手机"
    }
  }
}'

# 2. 按价格排序，分页显示
curl -X POST "localhost:9200/products/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "title": "手机"
    }
  },
  "sort": [{"price": {"order": "asc"}}],
  "size": 20,
  "from": 0
}'

# 3. 查看热门商品（按销量排序）
curl -X GET "localhost:9200/products/_search?sort=sales:desc&size=10"
```

### 7.2 新闻文章搜索系统


**场景描述**：新闻网站需要根据关键词搜索文章，按发布时间排序。

```bash
# 1. 搜索科技类新闻
curl -X POST "localhost:9200/articles/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "category": "科技"
    }
  },
  "sort": [{"publish_time": {"order": "desc"}}],
  "size": 15
}'

# 2. 搜索标题包含特定关键词的文章
curl -X GET "localhost:9200/articles/_search?q=title:人工智能&sort=publish_time:desc"
```

### 7.3 用户管理系统


**场景描述**：管理员需要查找和管理用户信息。

```bash
# 1. 查找活跃用户
curl -X POST "localhost:9200/users/_search" \
-H "Content-Type: application/json" \
-d '{
  "query": {
    "match": {
      "status": "active"
    }
  }
}'

# 2. 按注册时间查看新用户
curl -X GET "localhost:9200/users/_search?sort=register_time:desc&size=50"

# 3. 搜索特定城市的用户
curl -X GET "localhost:9200/users/_search?q=city:北京"
```

### 7.4 搜索性能优化建议


**🚀 提升搜索速度的技巧**：

| 优化方法 | **说明** | **适用场景** |
|---------|---------|-------------|
| 🎯 **限制返回字段** | 只返回需要的字段 | 大文档搜索 |
| 📄 **合理设置分页** | 避免深度分页(from太大) | 大数据量分页 |
| 🔍 **使用过滤器** | 结构化数据用filter | 精确条件筛选 |
| 💾 **利用缓存** | 相同查询会被缓存 | 重复查询场景 |

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的基本操作


```bash
🔸 基础搜索：curl -X GET "localhost:9200/index/_search"
🔸 URI查询：curl -X GET "localhost:9200/index/_search?q=field:value"  
🔸 JSON查询：使用POST方法 + JSON请求体
🔸 分页操作：?size=10&from=0
🔸 排序操作：?sort=field:desc
🔸 跨索引搜索：curl -X GET "localhost:9200/_search"
```

### 8.2 关键概念理解


**🔹 搜索方式选择**
```
简单查询 → 使用URI方式（?q=参数）
复杂查询 → 使用JSON方式（POST + JSON体）
全局搜索 → 跨索引搜索（/_search）
```

**🔹 分页机制**
```
分页公式：第N页的from = size × (N-1)
性能考虑：避免from值过大（建议<10000）
替代方案：深度分页使用scroll或search_after
```

**🔹 排序规则**
```
asc：升序（1,2,3... A,B,C... 早→晚）
desc：降序（3,2,1... Z,Y,X... 晚→早）
多字段：可以按多个字段组合排序
```

### 8.3 实际应用指导


**💡 最佳实践**：
- **开发阶段**：使用URI查询快速测试
- **生产环境**：使用JSON查询保证功能完整
- **大数据量**：合理设置分页参数，避免性能问题
- **用户体验**：提供排序选项，支持多维度查看数据

**⚠️ 常见注意事项**：
- URI查询中的中文需要URL编码
- JSON查询必须设置正确的Content-Type
- 分页的from参数不建议超过10000
- 排序字段建议建立索引以提升性能

**🎯 学习路径建议**：
1. 先掌握基础的GET搜索
2. 练习URI查询的各种参数
3. 学习JSON查询的结构化写法
4. 理解分页和排序的组合使用
5. 最后尝试跨索引的复杂搜索

**核心记忆口诀**：
- 搜索有两种：URI简单，JSON强大
- 分页靠两参：size定数量，from定起点  
- 排序分两向：asc向上，desc向下
- 跨索引搜索：/_search走天下