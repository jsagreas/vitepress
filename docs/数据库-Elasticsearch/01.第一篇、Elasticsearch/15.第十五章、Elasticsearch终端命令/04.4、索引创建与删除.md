---
title: 4、索引创建与删除
---
## 📚 目录

1. [索引基础概念](#1-索引基础概念)
2. [索引创建操作](#2-索引创建操作)
3. [索引删除操作](#3-索引删除操作)
4. [索引状态管理](#4-索引状态管理)
5. [索引存在性检查](#5-索引存在性检查)
6. [实际应用场景](#6-实际应用场景)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 📋 索引基础概念


### 1.1 什么是Elasticsearch索引


**💡 通俗理解**
想象一下图书馆的书架系统：
- **索引** = 一个专门的书架区域（比如"计算机书籍区"）
- **文档** = 书架上的每一本书
- **字段** = 每本书的属性（书名、作者、出版年份等）

```
图书馆的组织方式：
计算机书籍区（索引）
├── Python编程（文档1）
├── Java开发（文档2）
└── 数据库设计（文档3）

文学书籍区（另一个索引）
├── 红楼梦（文档1）
├── 三国演义（文档2）
└── 西游记（文档3）
```

**🔸 核心概念解释**
- **索引（Index）**：存储相似数据的逻辑容器，类似数据库中的"表"
- **分片（Shard）**：索引的物理分割，提升搜索性能和数据存储能力
- **副本（Replica）**：分片的备份，保证数据安全和查询性能

### 1.2 索引的作用和价值


**🎯 索引解决的问题**
```
传统文件存储的问题：
📁 文件夹1/用户资料.txt
📁 文件夹2/订单信息.txt  
📁 文件夹3/商品数据.txt
→ 查找困难，无法快速搜索

Elasticsearch索引的优势：
🔍 秒级全文搜索
📊 实时数据分析
🔄 水平扩展能力
⚡ 高并发查询支持
```

### 1.3 索引命名规范


**📝 命名最佳实践**
```
✅ 推荐命名方式：
user-profiles      # 用户配置信息
order-2024-01     # 按时间分割的订单数据
product-catalog   # 商品目录
log-application   # 应用日志

❌ 避免的命名：
User_Profiles     # 避免大写字母
order.2024.01     # 避免点号
-order-data-      # 避免以-开头或结尾
```

---

## 2. 🏗️ 索引创建操作


### 2.1 基础索引创建


**🔸 最简单的索引创建**

```bash
curl -X PUT "localhost:9200/my_index"
```

**💭 这条命令做了什么？**
- `PUT` 方法：告诉ES"我要创建一个新索引"
- `localhost:9200`：ES服务器地址（9200是默认端口）
- `my_index`：新索引的名称

**📋 执行结果示例**
```json
{
  "acknowledged": true,        # 操作被确认执行
  "shards_acknowledged": true, # 分片创建成功
  "index": "my_index"         # 创建的索引名称
}
```

### 2.2 带配置的索引创建


**🔧 设置分片数量**

```bash
curl -X PUT "localhost:9200/my_index" \
  -H "Content-Type: application/json" \
  -d '{
    "settings": {
      "number_of_shards": 3
    }
  }'
```

**🧠 分片数量说明**
```
分片数量的选择原则：
🔸 小数据量（<5GB）：1个分片足够
🔸 中等数据量（5-100GB）：3-5个分片
🔸 大数据量（>100GB）：根据节点数确定

为什么需要分片？
📈 提升查询性能：多个分片并行搜索
💾 突破单机存储限制：数据分布到多台机器
⚡ 增强处理能力：多个CPU核心并行工作
```

**🏗️ 完整的索引配置示例**

```bash
curl -X PUT "localhost:9200/user_profiles" \
  -H "Content-Type: application/json" \
  -d '{
    "settings": {
      "number_of_shards": 3,      
      "number_of_replicas": 1     
    },
    "mappings": {
      "properties": {
        "username": {"type": "keyword"},
        "email": {"type": "keyword"},
        "age": {"type": "integer"},
        "created_at": {"type": "date"}
      }
    }
  }'
```

**📊 配置参数详解**

| 参数 | 作用 | 建议值 | 说明 |
|------|------|--------|------|
| `number_of_shards` | **主分片数量** | `1-5` | 创建后不能修改 |
| `number_of_replicas` | **副本数量** | `1-2` | 可以随时修改 |
| `mappings` | **字段结构定义** | 按需设置 | 定义数据类型和索引方式 |

---

## 3. 🗑️ 索引删除操作


### 3.1 单个索引删除


**🔸 删除指定索引**

```bash
curl -X DELETE "localhost:9200/my_index"
```

**⚠️ 删除操作注意事项**
```
删除是永久性的：
❌ 数据无法恢复
❌ 索引结构完全消失
❌ 相关配置全部丢失

删除前的检查清单：
✅ 确认索引名称正确
✅ 备份重要数据
✅ 通知相关团队成员
```

### 3.2 批量删除操作


**🔸 删除多个指定索引**

```bash
curl -X DELETE "localhost:9200/index1,index2,index3"
```

**💡 实际应用场景**
```
日常运维场景：
删除测试环境的多个索引：
curl -X DELETE "localhost:9200/test_users,test_orders,test_products"

清理旧的日志索引：
curl -X DELETE "localhost:9200/logs-2023-01,logs-2023-02,logs-2023-03"
```

**🔸 通配符删除（谨慎使用）**

```bash
curl -X DELETE "localhost:9200/log-*"
```

**🎯 通配符使用场景**
```
时间序列数据清理：
log-2024-01-*    # 删除1月份所有日志
temp-*           # 删除所有临时索引
test-*           # 删除所有测试索引

⚠️ 危险操作警告：
curl -X DELETE "localhost:9200/*"  # 会删除所有索引！
```

### 3.3 安全删除实践


**🛡️ 删除前的安全检查**

```bash
# 1. 查看要删除的索引
curl -X GET "localhost:9200/_cat/indices/log-*?v"

# 2. 检查索引大小和文档数量
curl -X GET "localhost:9200/log-2024-01/_stats"

# 3. 确认后再删除
curl -X DELETE "localhost:9200/log-2024-01"
```

---

## 4. 🔄 索引状态管理


### 4.1 关闭索引操作


**🔸 关闭索引**

```bash
curl -X POST "localhost:9200/my_index/_close"
```

**💭 关闭索引的含义**
```
关闭索引就像"冰箱的灯"：
🔸 数据还在：所有文档都保留
🔸 无法使用：不能搜索和写入
🔸 节省资源：释放内存和CPU
🔸 可以重新打开：随时恢复使用

实际应用场景：
📊 历史数据归档：保留数据但不常用
💾 节省系统资源：临时释放内存
🔧 维护操作：安全进行配置修改
```

### 4.2 打开索引操作


**🔸 重新打开索引**

```bash
curl -X POST "localhost:9200/my_index/_open"
```

**⚡ 打开索引的过程**
```
索引打开的步骤：
1️⃣ 分配分片到节点
2️⃣ 恢复索引元数据
3️⃣ 重建内存结构
4️⃣ 准备接受查询

状态变化：
关闭状态 → 正在打开 → 可用状态
  ↓           ↓         ↓
无法访问   临时不可用   正常使用
```

### 4.3 索引状态查看


**📊 查看索引状态**

```bash
# 查看所有索引状态
curl -X GET "localhost:9200/_cat/indices?v"

# 查看特定索引状态
curl -X GET "localhost:9200/_cat/indices/my_index?v"
```

**📋 状态信息解读**
```
输出示例：
health status index    pri rep docs.count store.size
yellow open   my_index   3   1       1000      1.2mb
green  close  old_index  5   1          0       260b

状态说明：
🟢 green：所有分片正常
🟡 yellow：主分片正常，副本分片可能有问题
🔴 red：有主分片无法使用
```

---

## 5. 🔍 索引存在性检查


### 5.1 检查索引是否存在


**🔸 使用HEAD方法检查**

```bash
curl -X HEAD "localhost:9200/my_index"
```

**📋 返回状态码含义**
```
HTTP状态码解读：
✅ 200：索引存在且正常
❌ 404：索引不存在
🔴 其他状态码：可能有权限或其他问题

实际应用：
在创建索引前检查是否已存在：
if curl -s -I "localhost:9200/my_index" | grep -q "200 OK"; then
    echo "索引已存在"
else
    echo "索引不存在，可以创建"
fi
```

### 5.2 获取索引详细信息


**🔸 查看索引配置**

```bash
curl -X GET "localhost:9200/my_index"
```

**📊 返回信息示例**
```json
{
  "my_index": {
    "aliases": {},
    "mappings": {
      "properties": {
        "username": {"type": "keyword"},
        "created_at": {"type": "date"}
      }
    },
    "settings": {
      "index": {
        "number_of_shards": "3",
        "number_of_replicas": "1"
      }
    }
  }
}
```

---

## 6. 🎯 实际应用场景


### 6.1 日志管理系统


**📊 按时间创建日志索引**
```
场景：每天产生大量应用日志
解决方案：按天创建索引

2024-01-01：创建 logs-2024-01-01
2024-01-02：创建 logs-2024-01-02
2024-01-03：创建 logs-2024-01-03
...

定期清理：删除30天前的日志索引
curl -X DELETE "localhost:9200/logs-2023-12-*"
```

### 6.2 数据归档策略


**🗃️ 冷热数据分离**
```
热数据索引：
user-profiles-hot     # 活跃用户数据
order-current        # 当前订单

温数据索引：
user-profiles-warm   # 一般用户数据  
order-history       # 历史订单

冷数据索引：
user-profiles-cold   # 很少访问的用户
order-archive       # 归档订单（关闭状态）
```

### 6.3 测试环境管理


**🧪 测试数据快速清理**
```
开发阶段：
curl -X PUT "localhost:9200/test-users"
curl -X PUT "localhost:9200/test-orders"
curl -X PUT "localhost:9200/test-products"

测试完成后批量清理：
curl -X DELETE "localhost:9200/test-*"
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的基本操作


```
🔸 索引创建：PUT方法创建新索引，可带配置参数
🔸 索引删除：DELETE方法删除，支持单个、多个、通配符
🔸 状态管理：_close关闭索引，_open打开索引  
🔸 存在检查：HEAD方法检查，GET方法获取详细信息
```

### 7.2 关键理解要点


**🔹 分片策略的重要性**
```
分片数量影响：
📈 查询性能：更多分片 = 更快搜索
💾 存储分布：数据分散到多个节点
⚖️ 资源消耗：过多分片会增加开销

经验法则：
小项目：1个分片
中项目：3-5个分片  
大项目：根据数据量和节点数确定
```

**🔹 索引生命周期管理**
```
创建阶段：规划好分片和副本数量
使用阶段：监控性能和存储空间
维护阶段：适时关闭不常用索引
清理阶段：删除过期数据释放空间
```

**🔹 操作安全注意事项**
```
删除操作：
⚠️ 无法撤销，务必谨慎
✅ 删除前先备份重要数据
✅ 使用通配符时特别小心

状态管理：
💡 关闭索引可节省资源
💡 打开索引需要一定时间
💡 频繁开关会影响性能
```

### 7.3 实际应用价值


**🎯 业务场景应用**
- **电商网站**：商品索引、用户索引、订单索引分离管理
- **日志系统**：按时间创建索引，定期清理历史数据
- **内容管理**：文章索引、评论索引独立维护
- **监控系统**：指标数据按时间段创建索引

**🔧 运维实践**
- **容量规划**：根据数据增长预估分片需求
- **性能优化**：合理设置分片和副本数量
- **数据治理**：建立索引命名规范和生命周期策略
- **故障处理**：索引损坏时的修复和重建方案

**💡 核心记忆**
```
索引管理三要素：创建、删除、状态控制
安全操作两原则：谨慎删除、合理配置
性能优化一核心：分片策略要得当
```