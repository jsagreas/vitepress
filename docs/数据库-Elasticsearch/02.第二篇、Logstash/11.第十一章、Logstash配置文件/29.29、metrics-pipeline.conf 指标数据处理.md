---
title: 29ã€metrics-pipeline.conf æŒ‡æ ‡æ•°æ®å¤„ç†
---
## ğŸ“š ç›®å½•

1. [æŒ‡æ ‡æ•°æ®å¤„ç†åŸºç¡€æ¦‚å¿µ](#1-æŒ‡æ ‡æ•°æ®å¤„ç†åŸºç¡€æ¦‚å¿µ)
2. [ç³»ç»ŸæŒ‡æ ‡é‡‡é›†é…ç½®](#2-ç³»ç»ŸæŒ‡æ ‡é‡‡é›†é…ç½®)
3. [åº”ç”¨æ€§èƒ½æŒ‡æ ‡å¤„ç†](#3-åº”ç”¨æ€§èƒ½æŒ‡æ ‡å¤„ç†)
4. [ä¸šåŠ¡æŒ‡æ ‡è®¡ç®—ä¸ç»Ÿè®¡](#4-ä¸šåŠ¡æŒ‡æ ‡è®¡ç®—ä¸ç»Ÿè®¡)
5. [æ—¶é—´åºåˆ—æ•°æ®å¤„ç†](#5-æ—¶é—´åºåˆ—æ•°æ®å¤„ç†)
6. [ç›‘æ§é˜ˆå€¼ä¸å‘Šè­¦é…ç½®](#6-ç›‘æ§é˜ˆå€¼ä¸å‘Šè­¦é…ç½®)
7. [ä»ªè¡¨æ¿æ•°æ®å‡†å¤‡](#7-ä»ªè¡¨æ¿æ•°æ®å‡†å¤‡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š æŒ‡æ ‡æ•°æ®å¤„ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æŒ‡æ ‡æ•°æ®

**ğŸ”¸ ç®€å•ç†è§£**ï¼šæŒ‡æ ‡æ•°æ®å°±åƒæ˜¯ç»™ç³»ç»Ÿåš"ä½“æ£€æŠ¥å‘Š"çš„å„ç§æ•°æ®

```
ç”Ÿæ´»ç±»æ¯”ï¼š
åŒ»é™¢ä½“æ£€æŠ¥å‘Š â†’ ç³»ç»ŸæŒ‡æ ‡ç›‘æ§
è¡€å‹ã€å¿ƒç‡    â†’ CPUã€å†…å­˜ä½¿ç”¨ç‡
ä½“é‡å˜åŒ–      â†’ ç£ç›˜ç©ºé—´å˜åŒ–
åŒ–éªŒæŒ‡æ ‡      â†’ åº”ç”¨æ€§èƒ½æŒ‡æ ‡
```

**ğŸ’¡ æŒ‡æ ‡æ•°æ®çš„ç‰¹ç‚¹**ï¼š
- **æ•°å€¼å‹**ï¼šéƒ½æ˜¯å¯ä»¥è®¡ç®—çš„æ•°å­—
- **æ—¶é—´æ€§**ï¼šæ¯ä¸ªæŒ‡æ ‡éƒ½æœ‰æ—¶é—´æˆ³
- **æŒç»­æ€§**ï¼šéœ€è¦æŒç»­æ”¶é›†å’Œç›‘æ§
- **å¯èšåˆ**ï¼šå¯ä»¥åšç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ

### 1.2 æŒ‡æ ‡æ•°æ®çš„åˆ†ç±»


| æŒ‡æ ‡ç±»å‹ | **è¯´æ˜** | **ä¸¾ä¾‹** | **ä½œç”¨** |
|---------|---------|---------|---------|
| ğŸ–¥ï¸ **ç³»ç»ŸæŒ‡æ ‡** | æœåŠ¡å™¨ç¡¬ä»¶ç›¸å…³ | CPUã€å†…å­˜ã€ç£ç›˜ | ç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶æ€ |
| ğŸ“± **åº”ç”¨æŒ‡æ ‡** | åº”ç”¨ç¨‹åºæ€§èƒ½ | å“åº”æ—¶é—´ã€ååé‡ | ä¼˜åŒ–åº”ç”¨æ€§èƒ½ |
| ğŸ’¼ **ä¸šåŠ¡æŒ‡æ ‡** | ä¸šåŠ¡ç›¸å…³æ•°æ® | è®¢å•é‡ã€ç”¨æˆ·æ•° | åˆ†æä¸šåŠ¡è¶‹åŠ¿ |
| ğŸŒ **ç½‘ç»œæŒ‡æ ‡** | ç½‘ç»œä¼ è¾“ç›¸å…³ | å¸¦å®½ã€å»¶è¿Ÿ | ç½‘ç»œæ€§èƒ½ä¼˜åŒ– |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦Logstashå¤„ç†æŒ‡æ ‡


> ğŸ“Œ **æ ¸å¿ƒä»·å€¼**  
> Logstashå°±åƒä¸€ä¸ª"æ•°æ®åŠ å·¥å‚"ï¼ŒæŠŠåŸå§‹çš„æŒ‡æ ‡æ•°æ®å˜æˆæœ‰ç”¨çš„ç›‘æ§ä¿¡æ¯

**ğŸ”§ ä¸»è¦ä½œç”¨**ï¼š
- **æ•°æ®æ¸…æ´—**ï¼šå»é™¤æ— æ•ˆå’Œé”™è¯¯æ•°æ®
- **æ ¼å¼ç»Ÿä¸€**ï¼šå°†ä¸åŒæ¥æºçš„æ•°æ®æ ‡å‡†åŒ–
- **è®¡ç®—å¢å¼º**ï¼šæ·»åŠ è®¡ç®—å­—æ®µå’Œç»Ÿè®¡ä¿¡æ¯
- **è·¯ç”±åˆ†å‘**ï¼šå°†æ•°æ®å‘é€åˆ°ä¸åŒçš„å­˜å‚¨å’Œå±•ç¤ºç³»ç»Ÿ

---

## 2. ğŸ–¥ï¸ ç³»ç»ŸæŒ‡æ ‡é‡‡é›†é…ç½®


### 2.1 åŸºç¡€ç³»ç»ŸæŒ‡æ ‡é…ç½®


```ruby
# 29-metrics-pipeline.conf - ç³»ç»ŸæŒ‡æ ‡å¤„ç†é…ç½®
input {
  # ä»Metricbeatæ”¶é›†ç³»ç»ŸæŒ‡æ ‡
  beats {
    port => 5044
    type => "system_metrics"
  }
  
  # ä»ç³»ç»Ÿæ—¥å¿—ä¸­æå–æŒ‡æ ‡
  file {
    path => "/var/log/system-metrics.log"
    start_position => "beginning"
    type => "custom_metrics"
  }
}
```

> ğŸ’¡ **é…ç½®è¯´æ˜**  
> `beats`æ’ä»¶æ¥æ”¶Metricbeatå‘é€çš„ç³»ç»ŸæŒ‡æ ‡ï¼Œ`file`æ’ä»¶è¯»å–è‡ªå®šä¹‰çš„æŒ‡æ ‡æ–‡ä»¶

### 2.2 CPUæŒ‡æ ‡å¤„ç†


```ruby
filter {
  # å¤„ç†CPUç›¸å…³æŒ‡æ ‡
  if [fields][module] == "system" and [metricset][name] == "cpu" {
    
    # è®¡ç®—CPUä½¿ç”¨ç‡ç™¾åˆ†æ¯”
    ruby {
      code => "
        if event.get('[system][cpu][user][pct]')
          total_pct = event.get('[system][cpu][user][pct]').to_f + 
                     event.get('[system][cpu][system][pct]').to_f
          event.set('cpu_usage_percent', (total_pct * 100).round(2))
        end
      "
    }
    
    # æ·»åŠ CPUçŠ¶æ€æ ‡ç­¾
    if [cpu_usage_percent] {
      if [cpu_usage_percent] < 70 {
        mutate { add_field => { "cpu_status" => "normal" } }
      } else if [cpu_usage_percent] < 85 {
        mutate { add_field => { "cpu_status" => "warning" } }
      } else {
        mutate { add_field => { "cpu_status" => "critical" } }
      }
    }
  }
}
```

> âš ï¸ **é‡è¦ç†è§£**  
> è¿™é‡Œç”¨rubyä»£ç è®¡ç®—CPUæ€»ä½¿ç”¨ç‡ï¼Œå¹¶æ ¹æ®ä½¿ç”¨ç‡æ·»åŠ çŠ¶æ€æ ‡ç­¾ï¼Œæ–¹ä¾¿åç»­ç›‘æ§å‘Šè­¦

### 2.3 å†…å­˜æŒ‡æ ‡å¢å¼º


```ruby
filter {
  # å†…å­˜æŒ‡æ ‡å¤„ç†
  if [metricset][name] == "memory" {
    
    # è®¡ç®—å†…å­˜ä½¿ç”¨ç‡
    ruby {
      code => "
        total = event.get('[system][memory][total]').to_f
        used = event.get('[system][memory][used][bytes]').to_f
        if total > 0
          usage_pct = (used / total * 100).round(2)
          event.set('memory_usage_percent', usage_pct)
          event.set('memory_available_gb', ((total - used) / 1024 / 1024 / 1024).round(2))
        end
      "
    }
    
    # å†…å­˜å‹åŠ›è¯„ä¼°
    if [memory_usage_percent] {
      if [memory_usage_percent] < 80 {
        mutate { add_field => { "memory_pressure" => "low" } }
      } else if [memory_usage_percent] < 90 {
        mutate { add_field => { "memory_pressure" => "medium" } }
      } else {
        mutate { add_field => { "memory_pressure" => "high" } }
      }
    }
  }
}
```

---

## 3. ğŸ“± åº”ç”¨æ€§èƒ½æŒ‡æ ‡å¤„ç†


### 3.1 å“åº”æ—¶é—´æŒ‡æ ‡é…ç½®


```ruby
filter {
  # å¤„ç†åº”ç”¨å“åº”æ—¶é—´æŒ‡æ ‡
  if [type] == "app_metrics" {
    
    # è§£æå“åº”æ—¶é—´æ•°æ®
    grok {
      match => { 
        "message" => "response_time:%{NUMBER:response_time_ms} endpoint:%{WORD:endpoint} status:%{NUMBER:status_code}"
      }
    }
    
    # è½¬æ¢æ•°æ®ç±»å‹
    mutate {
      convert => { 
        "response_time_ms" => "float"
        "status_code" => "integer"
      }
    }
    
    # å“åº”æ—¶é—´åˆ†çº§
    if [response_time_ms] {
      if [response_time_ms] < 100 {
        mutate { add_field => { "performance_level" => "excellent" } }
      } else if [response_time_ms] < 500 {
        mutate { add_field => { "performance_level" => "good" } }
      } else if [response_time_ms] < 2000 {
        mutate { add_field => { "performance_level" => "acceptable" } }
      } else {
        mutate { add_field => { "performance_level" => "poor" } }
      }
    }
  }
}
```

> ğŸ“Œ **æ€§èƒ½åˆ†çº§è¯´æ˜**  
> - **excellent**: < 100ms - ç”¨æˆ·æ„Ÿè§‰éå¸¸å¿«
> - **good**: 100-500ms - ç”¨æˆ·æ„Ÿè§‰å¿«é€Ÿ  
> - **acceptable**: 500ms-2s - ç”¨æˆ·å¯ä»¥æ¥å—
> - **poor**: > 2s - ç”¨æˆ·ä½“éªŒå·®

### 3.2 é”™è¯¯ç‡ç»Ÿè®¡


```ruby
filter {
  # è®¡ç®—é”™è¯¯ç‡ç›¸å…³æŒ‡æ ‡
  if [status_code] {
    
    # æ ‡è®°è¯·æ±‚ç±»å‹
    if [status_code] >= 200 and [status_code] < 300 {
      mutate { add_field => { "request_result" => "success" } }
    } else if [status_code] >= 400 and [status_code] < 500 {
      mutate { add_field => { "request_result" => "client_error" } }
    } else if [status_code] >= 500 {
      mutate { add_field => { "request_result" => "server_error" } }
    }
    
    # æ·»åŠ æ—¶é—´çª—å£æ ‡è¯†ï¼ˆç”¨äºèšåˆç»Ÿè®¡ï¼‰
    ruby {
      code => "
        timestamp = event.get('@timestamp')
        # æŒ‰5åˆ†é’Ÿçª—å£åˆ†ç»„
        window = (timestamp.to_i / 300) * 300
        event.set('time_window', Time.at(window).strftime('%Y-%m-%d %H:%M:%S'))
      "
    }
  }
}
```

---

## 4. ğŸ’¼ ä¸šåŠ¡æŒ‡æ ‡è®¡ç®—ä¸ç»Ÿè®¡


### 4.1 è®¢å•ç›¸å…³æŒ‡æ ‡


```ruby
filter {
  # å¤„ç†ç”µå•†è®¢å•æŒ‡æ ‡
  if [type] == "order_metrics" {
    
    # è§£æè®¢å•æ•°æ®
    json {
      source => "message"
    }
    
    # è®¡ç®—è®¢å•é‡‘é¢ç›¸å…³æŒ‡æ ‡
    if [order_amount] {
      mutate {
        convert => { "order_amount" => "float" }
      }
      
      # è®¢å•é‡‘é¢åˆ†çº§
      if [order_amount] < 100 {
        mutate { add_field => { "order_category" => "small" } }
      } else if [order_amount] < 500 {
        mutate { add_field => { "order_category" => "medium" } }
      } else {
        mutate { add_field => { "order_category" => "large" } }
      }
    }
    
    # æ·»åŠ åœ°åŒºä¿¡æ¯ï¼ˆç”¨äºåŒºåŸŸåˆ†æï¼‰
    if [customer_province] {
      mutate {
        add_field => { "region" => "%{customer_province}" }
      }
    }
  }
}
```

### 4.2 ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡


```ruby
filter {
  # ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡å¤„ç†
  if [type] == "user_behavior" {
    
    # è§£æç”¨æˆ·è¡Œä¸ºæ•°æ®
    grok {
      match => { 
        "message" => "user:%{WORD:user_id} action:%{WORD:action} duration:%{NUMBER:duration_seconds}"
      }
    }
    
    # ç”¨æˆ·æ´»è·ƒåº¦è¯„ä¼°
    if [duration_seconds] {
      mutate { convert => { "duration_seconds" => "integer" } }
      
      if [duration_seconds] < 30 {
        mutate { add_field => { "engagement_level" => "low" } }
      } else if [duration_seconds] < 300 {
        mutate { add_field => { "engagement_level" => "medium" } }
      } else {
        mutate { add_field => { "engagement_level" => "high" } }
      }
    }
  }
}
```

---

## 5. â° æ—¶é—´åºåˆ—æ•°æ®å¤„ç†


### 5.1 æ—¶é—´çª—å£èšåˆ


```ruby
filter {
  # ä¸ºæ—¶é—´åºåˆ—åˆ†æå‡†å¤‡æ•°æ®
  ruby {
    code => "
      timestamp = event.get('@timestamp')
      
      # æ·»åŠ å„ç§æ—¶é—´ç»´åº¦
      event.set('hour_of_day', timestamp.hour)
      event.set('day_of_week', timestamp.wday)
      event.set('date_str', timestamp.strftime('%Y-%m-%d'))
      event.set('hour_str', timestamp.strftime('%Y-%m-%d %H:00:00'))
      
      # æ·»åŠ æ—¶é—´æ®µæ ‡è¯†
      hour = timestamp.hour
      if hour >= 6 && hour < 12
        event.set('time_period', 'morning')
      elsif hour >= 12 && hour < 18
        event.set('time_period', 'afternoon')
      elsif hour >= 18 && hour < 24
        event.set('time_period', 'evening')
      else
        event.set('time_period', 'night')
      end
    "
  }
}
```

> ğŸ’¡ **æ—¶é—´ç»´åº¦ä½œç”¨**  
> æ·»åŠ è¿™äº›æ—¶é—´å­—æ®µåï¼Œå¯ä»¥è½»æ¾åšæŒ‰å°æ—¶ã€æŒ‰å¤©ã€æŒ‰å‘¨çš„æ•°æ®åˆ†æå’Œè¶‹åŠ¿å›¾è¡¨

### 5.2 è¶‹åŠ¿è®¡ç®—é…ç½®


```ruby
filter {
  # ç§»åŠ¨å¹³å‡è®¡ç®—ï¼ˆç®€åŒ–ç‰ˆï¼‰
  if [cpu_usage_percent] {
    ruby {
      code => "
        # è¿™é‡Œç®€åŒ–æ¼”ç¤ºï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦å¤–éƒ¨ç¼“å­˜
        current_value = event.get('cpu_usage_percent').to_f
        
        # æ¨¡æ‹Ÿç§»åŠ¨å¹³å‡ï¼ˆå®é™…éœ€è¦ç»´æŠ¤å†å²æ•°æ®ï¼‰
        # è¿™é‡Œä»…ä½œä¸ºç¤ºä¾‹ï¼Œå®é™…åº”ç”¨å»ºè®®åœ¨Elasticsearchä¸­è®¡ç®—
        event.set('cpu_trend_indicator', current_value > 80 ? 'increasing' : 'stable')
      "
    }
  }
}
```

---

## 6. ğŸš¨ ç›‘æ§é˜ˆå€¼ä¸å‘Šè­¦é…ç½®


### 6.1 é˜ˆå€¼ç›‘æ§è®¾ç½®


```ruby
filter {
  # ç»Ÿä¸€çš„é˜ˆå€¼æ£€æŸ¥
  ruby {
    code => "
      alerts = []
      
      # CPUå‘Šè­¦æ£€æŸ¥
      if event.get('cpu_usage_percent')
        cpu_pct = event.get('cpu_usage_percent').to_f
        if cpu_pct > 90
          alerts << {
            'type' => 'cpu_critical',
            'message' => 'CPU usage is critically high',
            'value' => cpu_pct,
            'threshold' => 90,
            'severity' => 'critical'
          }
        elsif cpu_pct > 80
          alerts << {
            'type' => 'cpu_warning',
            'message' => 'CPU usage is high',
            'value' => cpu_pct,
            'threshold' => 80,
            'severity' => 'warning'
          }
        end
      end
      
      # å†…å­˜å‘Šè­¦æ£€æŸ¥
      if event.get('memory_usage_percent')
        mem_pct = event.get('memory_usage_percent').to_f
        if mem_pct > 95
          alerts << {
            'type' => 'memory_critical',
            'message' => 'Memory usage is critically high',
            'value' => mem_pct,
            'threshold' => 95,
            'severity' => 'critical'
          }
        end
      end
      
      # è®¾ç½®å‘Šè­¦å­—æ®µ
      if alerts.length > 0
        event.set('alerts', alerts)
        event.set('alert_count', alerts.length)
        event.set('has_alerts', true)
      else
        event.set('has_alerts', false)
      end
    "
  }
}
```

### 6.2 å‘Šè­¦çº§åˆ«åˆ†ç±»


```ruby
filter {
  # å‘Šè­¦ä¼˜å…ˆçº§è®¾ç½®
  if [has_alerts] == true {
    
    # è®¡ç®—æœ€é«˜å‘Šè­¦çº§åˆ«
    ruby {
      code => "
        alerts = event.get('alerts')
        max_severity = 'info'
        
        alerts.each do |alert|
          case alert['severity']
          when 'critical'
            max_severity = 'critical'
            break
          when 'warning'
            max_severity = 'warning' if max_severity != 'critical'
          end
        end
        
        event.set('max_alert_severity', max_severity)
      "
    }
    
    # æ·»åŠ å‘Šè­¦æ ‡ç­¾
    mutate {
      add_tag => [ "alert", "needs_attention" ]
    }
  }
}
```

---

## 7. ğŸ“Š ä»ªè¡¨æ¿æ•°æ®å‡†å¤‡


### 7.1 è¾“å‡ºåˆ°ä¸åŒç›®æ ‡


```ruby
output {
  # å‘é€åˆ°Elasticsearchç”¨äºæœç´¢å’Œåˆ†æ
  if [type] == "system_metrics" {
    elasticsearch {
      hosts => ["localhost:9200"]
      index => "system-metrics-%{+YYYY.MM.dd}"
      template_name => "system_metrics"
    }
  }
  
  # åº”ç”¨æŒ‡æ ‡å‘é€åˆ°ä¸“é—¨ç´¢å¼•
  if [type] == "app_metrics" {
    elasticsearch {
      hosts => ["localhost:9200"]
      index => "app-metrics-%{+YYYY.MM.dd}"
    }
  }
  
  # å‘Šè­¦æ•°æ®å‘é€åˆ°å‘Šè­¦ç´¢å¼•
  if [has_alerts] == true {
    elasticsearch {
      hosts => ["localhost:9200"]
      index => "alerts-%{+YYYY.MM.dd}"
    }
    
    # åŒæ—¶å‘é€åˆ°å‘Šè­¦ç³»ç»Ÿ
    http {
      url => "http://alert-manager:9093/api/v1/alerts"
      http_method => "post"
      format => "json"
      mapping => {
        "alerts" => "%{alerts}"
        "timestamp" => "%{@timestamp}"
        "host" => "%{host}"
      }
    }
  }
  
  # è°ƒè¯•è¾“å‡ºï¼ˆå¼€å‘ç¯å¢ƒï¼‰
  if [debug] == true {
    stdout { 
      codec => rubydebug 
    }
  }
}
```

### 7.2 æ•°æ®æ ¼å¼ä¼˜åŒ–


```ruby
filter {
  # ä¸ºKibanaä»ªè¡¨æ¿ä¼˜åŒ–æ•°æ®ç»“æ„
  mutate {
    # ç§»é™¤ä¸éœ€è¦çš„å­—æ®µ
    remove_field => [ 
      "message", 
      "[event][original]",
      "[log][file][path]"
    ]
    
    # æ·»åŠ ä»ªè¡¨æ¿æ ‡è¯†
    add_field => { 
      "dashboard_ready" => "true"
      "data_source" => "logstash_metrics"
    }
  }
  
  # ç¡®ä¿æ•°å­—å­—æ®µç±»å‹æ­£ç¡®
  if [cpu_usage_percent] {
    mutate { convert => { "cpu_usage_percent" => "float" } }
  }
  if [memory_usage_percent] {
    mutate { convert => { "memory_usage_percent" => "float" } }
  }
  if [response_time_ms] {
    mutate { convert => { "response_time_ms" => "float" } }
  }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 é…ç½®æ–‡ä»¶å…³é”®è¦ç´ 


> ğŸ“Œ **å¿…å¤‡ç»„ä»¶æ¸…å•**  
> âœ… **è¾“å…¥æºé…ç½®** - æŒ‡å®šæ•°æ®æ¥æºï¼ˆbeatsã€fileã€httpç­‰ï¼‰  
> âœ… **æ•°æ®è§£æ** - ä½¿ç”¨grokã€jsonç­‰è§£æåŸå§‹æ•°æ®  
> âœ… **æŒ‡æ ‡è®¡ç®—** - ç”¨rubyä»£ç è®¡ç®—è¡ç”ŸæŒ‡æ ‡  
> âœ… **é˜ˆå€¼æ£€æŸ¥** - å®ç°ç›‘æ§å‘Šè­¦é€»è¾‘  
> âœ… **è¾“å‡ºè·¯ç”±** - å°†æ•°æ®å‘é€åˆ°åˆé€‚çš„å­˜å‚¨

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æŒ‡æ ‡å¤„ç†æ€è·¯**ï¼š
```
åŸå§‹æ•°æ® â†’ è§£æç»“æ„åŒ– â†’ è®¡ç®—å¢å¼º â†’ é˜ˆå€¼åˆ¤æ–­ â†’ åˆ†ç±»å­˜å‚¨
    â†“         â†“          â†“        â†“        â†“
  æ—¥å¿—æ–‡ä»¶   grokè§£æ   rubyè®¡ç®—   å‘Šè­¦æ£€æŸ¥  ESç´¢å¼•
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š
- **åˆç†åˆ†ç´¢å¼•**ï¼šä¸åŒç±»å‹æŒ‡æ ‡å­˜å‚¨åˆ°ä¸åŒç´¢å¼•
- **å­—æ®µç±»å‹è½¬æ¢**ï¼šç¡®ä¿æ•°å­—å­—æ®µæ˜¯æ­£ç¡®çš„æ•°æ®ç±»å‹
- **åˆ é™¤æ— ç”¨å­—æ®µ**ï¼šå‡å°‘å­˜å‚¨ç©ºé—´å’Œç½‘ç»œä¼ è¾“
- **æ‰¹é‡å¤„ç†**ï¼šä½¿ç”¨åˆé€‚çš„batch sizeæé«˜æ•ˆç‡

### 8.3 å®é™…åº”ç”¨ä»·å€¼


| åº”ç”¨åœºæ™¯ | **é…ç½®é‡ç‚¹** | **æ•ˆæœ** |
|---------|-------------|---------|
| ğŸ–¥ï¸ **ç³»ç»Ÿç›‘æ§** | CPUã€å†…å­˜ã€ç£ç›˜æŒ‡æ ‡å¤„ç† | åŠæ—¶å‘ç°ç³»ç»Ÿæ€§èƒ½é—®é¢˜ |
| ğŸ“± **åº”ç”¨ç›‘æ§** | å“åº”æ—¶é—´ã€é”™è¯¯ç‡åˆ†æ | ä¼˜åŒ–åº”ç”¨æ€§èƒ½ä½“éªŒ |
| ğŸ’¼ **ä¸šåŠ¡åˆ†æ** | è®¢å•ã€ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡ | æ”¯æŒä¸šåŠ¡å†³ç­–åˆ†æ |
| ğŸš¨ **å‘Šè­¦ç›‘æ§** | é˜ˆå€¼æ£€æŸ¥ã€å‘Šè­¦åˆ†çº§ | å¿«é€Ÿå“åº”ç³»ç»Ÿå¼‚å¸¸ |

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ”§ é…ç½®æŠ€å·§**ï¼š
```bash
# 1. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
bin/logstash --config.test_and_exit -f metrics-pipeline.conf

# 2. å¼€å¯è°ƒè¯•æ¨¡å¼
bin/logstash -f metrics-pipeline.conf --log.level debug

# 3. ç›‘æ§å¤„ç†æ€§èƒ½
curl -X GET "localhost:9600/_node/stats/pipeline"
```

**âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼š
- ä½¿ç”¨`pipeline.workers`æ§åˆ¶å¹¶å‘åº¦
- åˆç†è®¾ç½®`pipeline.batch.size`
- ç›‘æ§JVMå†…å­˜ä½¿ç”¨æƒ…å†µ
- å®šæœŸæ¸…ç†æ—§çš„ç´¢å¼•æ•°æ®

**ğŸ”’ å®‰å…¨è€ƒè™‘**ï¼š
- æ•æ„Ÿæ•°æ®å­—æ®µåŠ å¯†æˆ–è„±æ•
- é…ç½®è®¿é—®æƒé™æ§åˆ¶
- ä½¿ç”¨HTTPSä¼ è¾“æ•æ„ŸæŒ‡æ ‡æ•°æ®
- å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶

**æ ¸å¿ƒè®°å¿†**ï¼š
> Logstashå¤„ç†æŒ‡æ ‡æ•°æ® = æ•°æ®æ¸…æ´— + æŒ‡æ ‡è®¡ç®— + é˜ˆå€¼ç›‘æ§ + æ™ºèƒ½è·¯ç”±  
> å…³é”®æ˜¯ç†è§£ä¸šåŠ¡éœ€æ±‚ï¼Œåˆç†è®¾è®¡æ•°æ®æµè½¬å’Œè®¡ç®—é€»è¾‘