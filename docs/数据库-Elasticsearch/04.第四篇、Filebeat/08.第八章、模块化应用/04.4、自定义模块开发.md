---
title: 4ã€è‡ªå®šä¹‰æ¨¡å—å¼€å‘
---
## ğŸ“š ç›®å½•

1. [è‡ªå®šä¹‰æ¨¡å—å¼€å‘æ¦‚è¿°](#1-è‡ªå®šä¹‰æ¨¡å—å¼€å‘æ¦‚è¿°)
2. [è‡ªå®šä¹‰è¾“å…¥æ’ä»¶å¼€å‘](#2-è‡ªå®šä¹‰è¾“å…¥æ’ä»¶å¼€å‘)
3. [æ¨¡å—å¼€å‘æ¡†æ¶è¯¦è§£](#3-æ¨¡å—å¼€å‘æ¡†æ¶è¯¦è§£)
4. [æ’ä»¶æ¥å£è®¾è®¡](#4-æ’ä»¶æ¥å£è®¾è®¡)
5. [æ¨¡å—æ‰“åŒ…éƒ¨ç½²](#5-æ¨¡å—æ‰“åŒ…éƒ¨ç½²)
6. [æ’ä»¶æµ‹è¯•æ–¹æ³•](#6-æ’ä»¶æµ‹è¯•æ–¹æ³•)
7. [ç¬¬ä¸‰æ–¹æ¨¡å—é›†æˆ](#7-ç¬¬ä¸‰æ–¹æ¨¡å—é›†æˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ è‡ªå®šä¹‰æ¨¡å—å¼€å‘æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰æ¨¡å—


**ğŸ’­ ç®€å•ç†è§£**ï¼šå°±åƒæ­ç§¯æœ¨ä¸€æ ·ï¼ŒFilebeatè‡ªå¸¦äº†å¾ˆå¤šç°æˆçš„ç§¯æœ¨ï¼ˆå®˜æ–¹æ¨¡å—ï¼‰ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€äº›ç‰¹æ®Šå½¢çŠ¶çš„ç§¯æœ¨æ¥å®Œæˆç‰¹å®šä»»åŠ¡ï¼Œè¿™æ—¶å°±éœ€è¦è‡ªå·±åˆ¶ä½œç§¯æœ¨ï¼ˆè‡ªå®šä¹‰æ¨¡å—ï¼‰ã€‚

**ğŸ” æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
å®˜æ–¹æ¨¡å— VS è‡ªå®šä¹‰æ¨¡å—ï¼š

å®˜æ–¹æ¨¡å—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Apacheæ¨¡å—    â”‚ â† Elasticå®˜æ–¹æä¾›
â”‚   Nginxæ¨¡å—     â”‚ â† å¼€ç®±å³ç”¨
â”‚   MySQLæ¨¡å—     â”‚ â† é…ç½®ç®€å•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è‡ªå®šä¹‰æ¨¡å—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†…éƒ¨ç³»ç»Ÿæ¨¡å—   â”‚ â† å…¬å¸ç‰¹æœ‰ç³»ç»Ÿ
â”‚  ç§æœ‰åè®®æ¨¡å—   â”‚ â† ç‰¹æ®Šæ•°æ®æ ¼å¼
â”‚  ä¸šåŠ¡é€»è¾‘æ¨¡å—   â”‚ â† ç‰¹å®šä¸šåŠ¡éœ€æ±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰æ¨¡å—


**ğŸ¤” å®é™…åœºæ™¯**ï¼š

| åœºæ™¯ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **å†…éƒ¨ç³»ç»Ÿ** | å…¬å¸è‡ªç ”ç³»ç»Ÿçš„æ—¥å¿—æ ¼å¼ | å¼€å‘ä¸“ç”¨æ¨¡å—è§£æ |
| **ç‰¹æ®Šåè®®** | ç§æœ‰é€šä¿¡åè®®æ•°æ® | è‡ªå®šä¹‰è¾“å…¥æ’ä»¶ |
| **ä¸šåŠ¡éœ€æ±‚** | å¤æ‚çš„æ•°æ®é¢„å¤„ç†é€»è¾‘ | å®šåˆ¶åŒ–å¤„ç†æ¨¡å— |
| **æ€§èƒ½ä¼˜åŒ–** | å®˜æ–¹æ¨¡å—æ€§èƒ½ä¸æ»¡è¶³ | ä¼˜åŒ–ç‰ˆè‡ªå®šä¹‰æ¨¡å— |

**ğŸ¯ å¼€å‘ç›®æ ‡**ï¼š
- **ä¸“ä¸šæ€§**ï¼šé’ˆå¯¹ç‰¹å®šéœ€æ±‚ç²¾ç¡®è®¾è®¡
- **é«˜æ•ˆæ€§**ï¼šé¿å…ä¸å¿…è¦çš„åŠŸèƒ½å¼€é”€
- **å¯ç»´æŠ¤æ€§**ï¼šç¬¦åˆå›¢é˜Ÿå¼€å‘è§„èŒƒ
- **å¯æ‰©å±•æ€§**ï¼šä¾¿äºåç»­åŠŸèƒ½æ·»åŠ 

---

## 2. âš™ï¸ è‡ªå®šä¹‰è¾“å…¥æ’ä»¶å¼€å‘


### 2.1 æ’ä»¶å¼€å‘åŸºç¡€


**ğŸ·ï¸ ä¸“ä¸šæœ¯è¯­**ï¼š
- **`Input Plugin`** = è¾“å…¥æ’ä»¶ï¼Œè´Ÿè´£ä»æ•°æ®æºè¯»å–æ•°æ®
- **`Beat Framework`** = Filebeatçš„åº•å±‚æ¡†æ¶ï¼Œæä¾›æ’ä»¶å¼€å‘æ¥å£
- **`Harvester`** = æ”¶å‰²å™¨ï¼Œå®é™…è¯»å–æ•°æ®çš„ç»„ä»¶

**ğŸ—ï¸ æ’ä»¶æ¶æ„**ï¼š
```
Filebeat æ’ä»¶æ¶æ„ï¼š
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Filebeatä¸»ç¨‹åº  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Input Manager â”‚ â† ç®¡ç†æ‰€æœ‰è¾“å…¥æ’ä»¶
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚                         â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Logæ’ä»¶  â”‚              â”‚Fileæ’ä»¶    â”‚            â”‚è‡ªå®šä¹‰æ’ä»¶  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ’ä»¶å¼€å‘æ­¥éª¤


**ğŸ“‹ å¼€å‘æµç¨‹**ï¼š

**æ­¥éª¤1ï¼šç¯å¢ƒå‡†å¤‡**
```bash
# 1. å®‰è£…Goè¯­è¨€ç¯å¢ƒï¼ˆFilebeatç”¨Goç¼–å†™ï¼‰
go version  # ç¡®è®¤Goç‰ˆæœ¬ >= 1.19

# 2. ä¸‹è½½Filebeatæºç 
git clone https://github.com/elastic/beats.git
cd beats/filebeat

# 3. å®‰è£…ä¾èµ–
go mod download
```

**æ­¥éª¤2ï¼šåˆ›å»ºæ’ä»¶ç›®å½•**
```
åˆ›å»ºç›®å½•ç»“æ„ï¼š
filebeat/
â””â”€â”€ input/
    â””â”€â”€ myapp/              â† ä½ çš„æ’ä»¶åç§°
        â”œâ”€â”€ input.go        â† ä¸»è¦é€»è¾‘
        â”œâ”€â”€ config.go       â† é…ç½®å®šä¹‰
        â””â”€â”€ input_test.go   â† æµ‹è¯•æ–‡ä»¶
```

**æ­¥éª¤3ï¼šå®ç°æ ¸å¿ƒæ¥å£**

**ğŸ”‘ å…³é”®ä»£ç ç»“æ„**ï¼š
```go
// input.go - æ ¸å¿ƒå®ç°
package myapp

import (
    "github.com/elastic/beats/v8/filebeat/input"
    "github.com/elastic/beats/v8/libbeat/beat"
)

// æ’ä»¶æ³¨å†Œå‡½æ•°
func init() {
    err := input.Register("myapp", NewInput)
    if err != nil {
        panic(err)
    }
}

// æ’ä»¶æ„é€ å‡½æ•°
func NewInput(cfg *common.Config) (input.Input, error) {
    config := defaultConfig()
    if err := cfg.Unpack(&config); err != nil {
        return nil, err
    }
    
    return &myappInput{
        config: config,
    }, nil
}

// æ’ä»¶ä¸»ä½“ç»“æ„
type myappInput struct {
    config myappConfig
    outlet beat.PipelineConnector
}

// å®ç°Inputæ¥å£çš„Runæ–¹æ³•
func (input *myappInput) Run(ctx context.Context, pipeline beat.PipelineConnector) error {
    // è¿™é‡Œå†™ä½ çš„æ•°æ®æ”¶é›†é€»è¾‘
    for {
        // 1. è¯»å–æ•°æ®
        data := readDataFromSource()
        
        // 2. åˆ›å»ºäº‹ä»¶
        event := beat.Event{
            Timestamp: time.Now(),
            Fields: common.MapStr{
                "message": data,
                "source": "myapp",
            },
        }
        
        // 3. å‘é€åˆ°ç®¡é“
        pipeline.PublishEvent(event)
    }
}
```

### 2.3 é…ç½®æ–‡ä»¶è®¾è®¡


**âš¡ é…ç½®ç¤ºä¾‹**ï¼š
```go
// config.go - é…ç½®ç»“æ„å®šä¹‰
type myappConfig struct {
    // æ•°æ®æºé…ç½®
    SourcePath   string        `config:"source_path" validate:"required"`
    ReadInterval time.Duration `config:"read_interval"`
    
    // è§£æé…ç½®
    ParseFormat  string `config:"parse_format"`
    FieldMapping map[string]string `config:"field_mapping"`
    
    // è¿‡æ»¤é…ç½®
    IncludeLines []string `config:"include_lines"`
    ExcludeLines []string `config:"exclude_lines"`
}

// é»˜è®¤é…ç½®
func defaultConfig() myappConfig {
    return myappConfig{
        ReadInterval: 1 * time.Second,
        ParseFormat:  "json",
        FieldMapping: make(map[string]string),
    }
}
```

**ğŸ“ ç”¨æˆ·é…ç½®æ–‡ä»¶**ï¼š
```yaml
# filebeat.yml ä¸­çš„é…ç½®
filebeat.inputs:
- type: myapp
  source_path: "/var/log/myapp/*.log"
  read_interval: 5s
  parse_format: "json"
  field_mapping:
    timestamp: "@timestamp"
    level: "log.level"
    message: "message"
  include_lines: ['ERROR', 'WARN']
```

---

## 3. ğŸ› ï¸ æ¨¡å—å¼€å‘æ¡†æ¶è¯¦è§£


### 3.1 Beatsæ¡†æ¶æ ¸å¿ƒç»„ä»¶


**ğŸŒ° æ¡†æ¶å°±åƒå·¥å‚æµæ°´çº¿**ï¼š

```
Beatsæ¡†æ¶ = æ•°æ®å¤„ç†å·¥å‚ï¼š

åŸææ–™ä»“åº“     åŠ å·¥è½¦é—´      è´¨æ£€éƒ¨é—¨      æˆå“ä»“åº“
    â”‚             â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Input  â”‚â”€â”€â”€â–¶â”‚Processor  â”‚â–¶â”‚Filter  â”‚â”€â–¶â”‚Output     â”‚
â”‚(è¯»å–)  â”‚    â”‚(å¤„ç†)     â”‚ â”‚(è¿‡æ»¤)   â”‚  â”‚(è¾“å‡º)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” æ·±å…¥ç†è§£ç»„ä»¶èŒè´£**ï¼š

| ç»„ä»¶ | èŒè´£ | ä¸¾ä¾‹è¯´æ˜ |
|------|------|----------|
| **Input** | æ•°æ®é‡‡é›† | ä»æ–‡ä»¶ã€ç½‘ç»œã€APIè¯»å–åŸå§‹æ•°æ® |
| **Processor** | æ•°æ®åŠ å·¥ | è§£æJSONã€æå–å­—æ®µã€æ ¼å¼è½¬æ¢ |
| **Filter** | æ•°æ®ç­›é€‰ | è¿‡æ»¤æ•æ„Ÿä¿¡æ¯ã€å»é‡ã€é‡‡æ · |
| **Output** | æ•°æ®è¾“å‡º | å‘é€åˆ°Elasticsearchã€Kafkaç­‰ |

### 3.2 æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†


**â° æ¨¡å—è¿è¡Œç”Ÿå‘½å‘¨æœŸ**ï¼š

```
æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

å¯åŠ¨é˜¶æ®µ           è¿è¡Œé˜¶æ®µ           åœæ­¢é˜¶æ®µ
    â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Init   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Run        â”‚â”€â”€â”€â”€â”€â–¶â”‚Stop       â”‚
â”‚åˆå§‹åŒ–  â”‚        â”‚æŒç»­è¿è¡Œ    â”‚      â”‚ä¼˜é›…å…³é—­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                  â”‚                  â”‚
   â–¼                  â–¼                  â–¼
é…ç½®åŠ è½½           æ•°æ®å¤„ç†           èµ„æºæ¸…ç†
èµ„æºåˆ†é…           äº‹ä»¶å‘é€           è¿æ¥å…³é—­
è¿æ¥å»ºç«‹           é”™è¯¯å¤„ç†           çŠ¶æ€ä¿å­˜
```

**ğŸ’¡ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å®ç°**ï¼š
```go
type MyModule struct {
    config ModuleConfig
    client *http.Client
    ctx    context.Context
    cancel context.CancelFunc
}

// åˆå§‹åŒ–é˜¶æ®µ
func (m *MyModule) Init() error {
    // 1. éªŒè¯é…ç½®
    if err := m.validateConfig(); err != nil {
        return err
    }
    
    // 2. åˆ›å»ºå®¢æˆ·ç«¯
    m.client = &http.Client{
        Timeout: m.config.Timeout,
    }
    
    // 3. å»ºç«‹è¿æ¥
    if err := m.testConnection(); err != nil {
        return err
    }
    
    return nil
}

// è¿è¡Œé˜¶æ®µ
func (m *MyModule) Run(ctx context.Context) error {
    m.ctx, m.cancel = context.WithCancel(ctx)
    
    ticker := time.NewTicker(m.config.Interval)
    defer ticker.Stop()
    
    for {
        select {
        case <-ticker.C:
            m.collectData()
        case <-m.ctx.Done():
            return nil
        }
    }
}

// åœæ­¢é˜¶æ®µ
func (m *MyModule) Stop() {
    // 1. å–æ¶ˆè¿è¡Œ
    if m.cancel != nil {
        m.cancel()
    }
    
    // 2. å…³é—­è¿æ¥
    if m.client != nil {
        m.client.CloseIdleConnections()
    }
    
    // 3. æ¸…ç†èµ„æº
    m.cleanup()
}
```

### 3.3 é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶


**ğŸš¨ é‡è¦æé†’**ï¼šè‡ªå®šä¹‰æ¨¡å—å¿…é¡»æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†ï¼Œå¦åˆ™ä¼šå½±å“æ•´ä¸ªFilebeatçš„ç¨³å®šæ€§ã€‚

**ğŸ”§ é”™è¯¯å¤„ç†ç­–ç•¥**ï¼š

```
é”™è¯¯å¤„ç†é‡‘å­—å¡”ï¼š

    ä¸´æ—¶é”™è¯¯ï¼ˆç½‘ç»œæ³¢åŠ¨ï¼‰
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   è‡ªåŠ¨é‡è¯•       â”‚ â† æŒ‡æ•°é€€é¿é‡è¯•
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    é…ç½®é”™è¯¯ï¼ˆæ ¼å¼é”™è¯¯ï¼‰
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   è®°å½•æ—¥å¿—       â”‚ â† è¯¦ç»†é”™è¯¯ä¿¡æ¯
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    è‡´å‘½é”™è¯¯ï¼ˆæƒé™ä¸è¶³ï¼‰
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   æ¨¡å—åœæ­¢       â”‚ â† é¿å…å½±å“å…¶ä»–æ¨¡å—
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ é‡è¯•æœºåˆ¶å®ç°**ï¼š
```go
type RetryConfig struct {
    MaxRetries int           `config:"max_retries"`
    InitialInterval time.Duration `config:"initial_interval"`
    MaxInterval time.Duration `config:"max_interval"`
    Multiplier float64       `config:"multiplier"`
}

func (m *MyModule) collectDataWithRetry() error {
    var lastErr error
    interval := m.retryConfig.InitialInterval
    
    for attempt := 0; attempt <= m.retryConfig.MaxRetries; attempt++ {
        if err := m.collectData(); err == nil {
            return nil // æˆåŠŸ
        } else {
            lastErr = err
            
            // åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•
            if !isRetryableError(err) {
                return err // ä¸å¯é‡è¯•çš„é”™è¯¯
            }
            
            // ç­‰å¾…åé‡è¯•
            if attempt < m.retryConfig.MaxRetries {
                time.Sleep(interval)
                interval = time.Duration(float64(interval) * m.retryConfig.Multiplier)
                if interval > m.retryConfig.MaxInterval {
                    interval = m.retryConfig.MaxInterval
                }
            }
        }
    }
    
    return lastErr
}
```

---

## 4. ğŸ”Œ æ’ä»¶æ¥å£è®¾è®¡


### 4.1 æ ‡å‡†æ¥å£è§„èŒƒ


**ğŸ·ï¸ æ¥å£è®¾è®¡åŸåˆ™**ï¼šå°±åƒè®¾è®¡ç”µå™¨æ’å¤´ä¸€æ ·ï¼Œè¦ç¬¦åˆæ ‡å‡†è§„æ ¼ï¼Œæ‰èƒ½å’Œæ’åº§ï¼ˆFilebeatï¼‰å®Œç¾é…åˆã€‚

**ğŸ“‹ æ ¸å¿ƒæ¥å£åˆ—è¡¨**ï¼š

| æ¥å£åç§° | ä½œç”¨ | å¿…é¡»å®ç° |
|----------|------|----------|
| **`Input`** | æ•°æ®è¾“å…¥æ¥å£ | âœ… æ˜¯ |
| **`Configurable`** | é…ç½®ç®¡ç†æ¥å£ | âœ… æ˜¯ |
| **`Stoppable`** | åœæ­¢æ§åˆ¶æ¥å£ | âœ… æ˜¯ |
| **`Validator`** | é…ç½®éªŒè¯æ¥å£ | âŒ å¯é€‰ |
| **`Reloadable`** | åŠ¨æ€é‡è½½æ¥å£ | âŒ å¯é€‰ |

### 4.2 Inputæ¥å£å®ç°


**ğŸ”‘ æ ¸å¿ƒInputæ¥å£**ï¼š
```go
// Inputæ¥å£å®šä¹‰ï¼ˆç®€åŒ–ç‰ˆï¼‰
type Input interface {
    // è¿è¡Œè¾“å…¥æ’ä»¶
    Run(ctx context.Context, connector beat.PipelineConnector) error
    
    // ç­‰å¾…æ’ä»¶å®Œæˆ
    Wait()
    
    // åœæ­¢æ’ä»¶
    Stop()
}
```

**ğŸ’¡ å®é™…å®ç°ç¤ºä¾‹**ï¼š
```go
type CustomInput struct {
    config     Config
    logger     *logp.Logger
    done       chan struct{}
    connector  beat.PipelineConnector
}

func (input *CustomInput) Run(ctx context.Context, connector beat.PipelineConnector) error {
    input.connector = connector
    input.logger.Info("å¯åŠ¨è‡ªå®šä¹‰è¾“å…¥æ’ä»¶")
    
    // åˆ›å»ºæ•°æ®è¯»å–å™¨
    reader, err := input.createReader()
    if err != nil {
        return err
    }
    defer reader.Close()
    
    // ä¸»å¾ªç¯
    for {
        select {
        case <-ctx.Done():
            return nil
        case <-input.done:
            return nil
        default:
            if err := input.processData(reader); err != nil {
                input.logger.Error("å¤„ç†æ•°æ®å¤±è´¥:", err)
                // æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦ç»§ç»­
                if isFatalError(err) {
                    return err
                }
            }
        }
    }
}

func (input *CustomInput) Stop() {
    input.logger.Info("åœæ­¢è‡ªå®šä¹‰è¾“å…¥æ’ä»¶")
    close(input.done)
}

func (input *CustomInput) Wait() {
    <-input.done
}
```

### 4.3 é…ç½®æ¥å£è®¾è®¡


**ğŸ¯ é…ç½®æ¥å£è®¾è®¡ç›®æ ‡**ï¼š
- **æ˜“ç”¨æ€§**ï¼šç”¨æˆ·é…ç½®ç®€å•ç›´è§‚
- **çµæ´»æ€§**ï¼šæ”¯æŒå„ç§é…ç½®åœºæ™¯
- **éªŒè¯æ€§**ï¼šè‡ªåŠ¨éªŒè¯é…ç½®åˆæ³•æ€§
- **æ–‡æ¡£æ€§**ï¼šé…ç½®é¡¹æœ‰æ¸…æ™°è¯´æ˜

**ğŸ“ é…ç½®ç»“æ„è®¾è®¡**ï¼š
```go
type InputConfig struct {
    // åŸºç¡€é…ç½®
    Enabled  bool   `config:"enabled" validate:"required"`
    Type     string `config:"type" validate:"required"`
    
    // æ•°æ®æºé…ç½®
    Source   SourceConfig   `config:"source"`
    
    // å¤„ç†é…ç½®
    Parsing  ParsingConfig  `config:"parsing"`
    
    // è¾“å‡ºé…ç½®
    Fields   map[string]interface{} `config:"fields"`
    Tags     []string               `config:"tags"`
    
    // æ€§èƒ½é…ç½®
    Workers     int           `config:"workers" validate:"min=1,max=10"`
    BufferSize  int           `config:"buffer_size" validate:"min=1024"`
    Timeout     time.Duration `config:"timeout"`
}

type SourceConfig struct {
    Path       string            `config:"path" validate:"required"`
    Recursive  bool              `config:"recursive"`
    Patterns   []string          `config:"patterns"`
    Encoding   string            `config:"encoding" validate:"oneof=utf-8 gbk gb2312"`
    Headers    map[string]string `config:"headers"`
}

type ParsingConfig struct {
    Format      string            `config:"format" validate:"oneof=json xml csv"`
    Delimiter   string            `config:"delimiter"`
    Multiline   MultilineConfig   `config:"multiline"`
    Processors  []ProcessorConfig `config:"processors"`
}
```

### 4.4 äº‹ä»¶å‘é€æ¥å£


**ğŸš€ äº‹ä»¶å‘é€æµç¨‹**ï¼š

```
äº‹ä»¶å‘é€ç®¡é“ï¼š

æ•°æ®é‡‡é›† â†’ äº‹ä»¶æ„å»º â†’ å­—æ®µæ˜ å°„ â†’ å‘é€åˆ°ç®¡é“ â†’ Elasticsearch
    â”‚          â”‚          â”‚          â”‚            â”‚
åŸå§‹æ•°æ®    beat.Event  æ·»åŠ å­—æ®µ   PipelineConnector  ç´¢å¼•å­˜å‚¨
```

**âš¡ äº‹ä»¶æ„å»ºå’Œå‘é€**ï¼š
```go
func (input *CustomInput) sendEvent(data map[string]interface{}) error {
    // 1. æ„å»ºåŸºç¡€äº‹ä»¶
    event := beat.Event{
        Timestamp: time.Now(),
        Fields: common.MapStr{
            "agent": common.MapStr{
                "name":    "filebeat",
                "type":    "filebeat",
                "version": version.GetDefaultVersion(),
            },
            "input": common.MapStr{
                "type": "custom",
            },
        },
    }
    
    // 2. æ·»åŠ åŸå§‹æ•°æ®
    event.Fields["message"] = data["raw_message"]
    
    // 3. æ·»åŠ è§£æåçš„å­—æ®µ
    if parsed, exists := data["parsed"]; exists {
        event.Fields["parsed"] = parsed
    }
    
    // 4. æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
    for key, value := range input.config.Fields {
        event.Fields[key] = value
    }
    
    // 5. æ·»åŠ æ ‡ç­¾
    if len(input.config.Tags) > 0 {
        event.Fields["tags"] = input.config.Tags
    }
    
    // 6. å‘é€äº‹ä»¶
    input.connector.PublishEvent(event)
    
    return nil
}
```

---

## 5. ğŸ“¦ æ¨¡å—æ‰“åŒ…éƒ¨ç½²


### 5.1 ç¼–è¯‘æ„å»º


**ğŸ”¨ æ„å»ºæµç¨‹**ï¼š

**æ­¥éª¤1ï¼šç¼–è¯‘æ’ä»¶**
```bash
# åœ¨beats/filebeatç›®å½•ä¸‹
go build -buildmode=plugin -o inputs/myapp.so ./input/myapp/

# æˆ–è€…ç¼–è¯‘åˆ°Filebeatä¸»ç¨‹åºä¸­
go build -o filebeat
```

**æ­¥éª¤2ï¼šéªŒè¯ç¼–è¯‘ç»“æœ**
```bash
# æ£€æŸ¥ç¼–è¯‘äº§ç‰©
ls -la inputs/
# åº”è¯¥çœ‹åˆ° myapp.so æ–‡ä»¶

# æµ‹è¯•åŠ è½½æ’ä»¶
./filebeat test config -c filebeat.yml
```

### 5.2 é…ç½®æ–‡ä»¶å‡†å¤‡


**ğŸ“‹ éƒ¨ç½²é…ç½®æ¸…å•**ï¼š

**åŸºç¡€é…ç½®æ–‡ä»¶**ï¼š
```yaml
# filebeat.yml
filebeat.inputs:
- type: myapp
  enabled: true
  source:
    path: "/var/log/myapp/*.log"
    recursive: true
  parsing:
    format: "json"
    multiline:
      pattern: '^\d{4}-\d{2}-\d{2}'
      negate: true
      match: after
  fields:
    service: "myapp"
    environment: "production"
  tags: ["myapp", "custom"]

# è¾“å‡ºé…ç½®
output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "myapp-logs-%{+yyyy.MM.dd}"

# æ—¥å¿—é…ç½®  
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
```

### 5.3 éƒ¨ç½²ç­–ç•¥


**ğŸ¢ éƒ¨ç½²æ¶æ„é€‰æ‹©**ï¼š

| éƒ¨ç½²æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|----------|----------|--------|
| **å•æœºéƒ¨ç½²** | å°è§„æ¨¡åº”ç”¨ | âœ… ç®€å• âŒ å•ç‚¹æ•…éšœ |
| **é›†ç¾¤éƒ¨ç½²** | å¤§è§„æ¨¡åº”ç”¨ | âœ… é«˜å¯ç”¨ âŒ å¤æ‚ |
| **å®¹å™¨éƒ¨ç½²** | äº‘åŸç”Ÿç¯å¢ƒ | âœ… ä¾¿äºç®¡ç† âŒ èµ„æºå¼€é”€ |
| **è¾¹ç¼˜éƒ¨ç½²** | è¾¹ç¼˜è®¡ç®—åœºæ™¯ | âœ… ä½å»¶è¿Ÿ âŒ ç®¡ç†å›°éš¾ |

**ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²ç¤ºä¾‹**ï¼š
```dockerfile
# Dockerfile
FROM docker.elastic.co/beats/filebeat:8.10.0

# å¤åˆ¶è‡ªå®šä¹‰æ¨¡å—
COPY inputs/myapp.so /usr/share/filebeat/inputs/
COPY filebeat.yml /usr/share/filebeat/

# å¤åˆ¶å¯åŠ¨è„šæœ¬
COPY start.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/start.sh

USER filebeat
ENTRYPOINT ["/usr/local/bin/start.sh"]
```

**ğŸš€ å¯åŠ¨è„šæœ¬**ï¼š
```bash
#!/bin/bash
# start.sh

# ç­‰å¾…ä¾èµ–æœåŠ¡å¯åŠ¨
wait-for-it elasticsearch:9200 --timeout=60

# å¯åŠ¨Filebeat
exec filebeat -e -c /usr/share/filebeat/filebeat.yml
```

### 5.4 ç‰ˆæœ¬ç®¡ç†


**ğŸ“Š ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥**ï¼š

```
ç‰ˆæœ¬ç®¡ç†é‡‘å­—å¡”ï¼š

ç”Ÿäº§ç‰ˆæœ¬ï¼ˆProductionï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   v1.2.0        â”‚ â† ç¨³å®šç‰ˆæœ¬ï¼Œå……åˆ†æµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
é¢„å‘å¸ƒç‰ˆæœ¬ï¼ˆStagingï¼‰  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   v1.2.0-rc1    â”‚ â† å‘å¸ƒå€™é€‰ç‰ˆæœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
å¼€å‘ç‰ˆæœ¬ï¼ˆDevelopmentï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   v1.2.0-dev    â”‚ â† å¼€å‘æµ‹è¯•ç‰ˆæœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ·ï¸ ç‰ˆæœ¬æ ‡è®°è§„èŒƒ**ï¼š
```bash
# Gitæ ‡ç­¾ç®¡ç†
git tag -a v1.0.0 -m "ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬"
git tag -a v1.1.0-beta -m "æ–°åŠŸèƒ½æµ‹è¯•ç‰ˆæœ¬"
git tag -a v1.1.0 -m "æ–°åŠŸèƒ½ç¨³å®šç‰ˆæœ¬"

# ç‰ˆæœ¬ä¿¡æ¯åµŒå…¥
go build -ldflags "-X main.version=v1.0.0 -X main.buildTime=$(date +%Y%m%d%H%M%S)"
```

---

## 6. ğŸ§ª æ’ä»¶æµ‹è¯•æ–¹æ³•


### 6.1 å•å…ƒæµ‹è¯•


**ğŸ¯ æµ‹è¯•ç›®æ ‡**ï¼šç¡®ä¿æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹å·¥ä½œæ­£å¸¸ã€‚

**ğŸ“‹ æµ‹è¯•æ¸…å•**ï¼š
- âœ… é…ç½®è§£ææµ‹è¯•
- âœ… æ•°æ®è¯»å–æµ‹è¯•  
- âœ… äº‹ä»¶æ„å»ºæµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**ğŸ’» æµ‹è¯•ä»£ç ç¤ºä¾‹**ï¼š
```go
// input_test.go
package myapp

import (
    "testing"
    "context"
    "time"
    
    "github.com/stretchr/testify/assert"
    "github.com/elastic/beats/v8/libbeat/beat"
)

func TestInputConfig(t *testing.T) {
    // æµ‹è¯•é…ç½®è§£æ
    configYAML := `
source:
  path: "/test/*.log"
parsing:
  format: "json"
workers: 2
`
    
    config, err := parseConfig(configYAML)
    assert.NoError(t, err)
    assert.Equal(t, "/test/*.log", config.Source.Path)
    assert.Equal(t, "json", config.Parsing.Format)
    assert.Equal(t, 2, config.Workers)
}

func TestDataProcessing(t *testing.T) {
    // æ¨¡æ‹Ÿè¾“å…¥æ•°æ®
    input := &CustomInput{
        config: defaultConfig(),
    }
    
    // æµ‹è¯•æ•°æ®å¤„ç†
    testData := `{"level":"INFO","message":"test message","timestamp":"2023-10-01T10:00:00Z"}`
    
    event, err := input.processRawData([]byte(testData))
    assert.NoError(t, err)
    assert.Equal(t, "INFO", event.Fields["level"])
    assert.Equal(t, "test message", event.Fields["message"])
}

func TestErrorHandling(t *testing.T) {
    input := &CustomInput{}
    
    // æµ‹è¯•æ— æ•ˆæ•°æ®å¤„ç†
    invalidData := `invalid json data`
    _, err := input.processRawData([]byte(invalidData))
    assert.Error(t, err)
    assert.Contains(t, err.Error(), "json parse error")
}
```

### 6.2 é›†æˆæµ‹è¯•


**ğŸ”— é›†æˆæµ‹è¯•åœºæ™¯**ï¼š

```
é›†æˆæµ‹è¯•æµç¨‹ï¼š

æ•°æ®æº â†’ Filebeat â†’ Elasticsearch â†’ éªŒè¯ç»“æœ
   â”‚         â”‚           â”‚            â”‚
æ¨¡æ‹Ÿæ–‡ä»¶   è‡ªå®šä¹‰æ’ä»¶   æµ‹è¯•é›†ç¾¤     æ£€æŸ¥ç´¢å¼•
```

**âš¡ é›†æˆæµ‹è¯•è„šæœ¬**ï¼š
```bash
#!/bin/bash
# integration_test.sh

# 1. å¯åŠ¨æµ‹è¯•ç¯å¢ƒ
docker-compose up -d elasticsearch

# 2. å‡†å¤‡æµ‹è¯•æ•°æ®
echo '{"level":"INFO","message":"test1"}' > /tmp/test.log
echo '{"level":"ERROR","message":"test2"}' >> /tmp/test.log

# 3. å¯åŠ¨Filebeat
./filebeat -c test_config.yml &
FILEBEAT_PID=$!

# 4. ç­‰å¾…æ•°æ®å¤„ç†
sleep 10

# 5. éªŒè¯ç»“æœ
RESULT=$(curl -s "http://localhost:9200/test-index/_search" | jq '.hits.total.value')
if [ "$RESULT" -eq 2 ]; then
    echo "âœ… é›†æˆæµ‹è¯•é€šè¿‡"
    exit 0
else
    echo "âŒ é›†æˆæµ‹è¯•å¤±è´¥ï¼ŒæœŸæœ›2æ¡è®°å½•ï¼Œå®é™…$RESULTæ¡"
    exit 1
fi

# 6. æ¸…ç†ç¯å¢ƒ
kill $FILEBEAT_PID
docker-compose down
```

### 6.3 æ€§èƒ½æµ‹è¯•


**ğŸ“Š æ€§èƒ½æµ‹è¯•æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|------|---------|----------|
| **ååé‡** | >1000 events/s | å¤§é‡æ•°æ®æµ‹è¯• |
| **å»¶è¿Ÿ** | <100ms | æ—¶é—´æˆ³å¯¹æ¯” |
| **å†…å­˜ä½¿ç”¨** | <100MB | èµ„æºç›‘æ§ |
| **CPUä½¿ç”¨** | <50% | ç³»ç»Ÿç›‘æ§ |

**ğŸ” æ€§èƒ½æµ‹è¯•å·¥å…·**ï¼š
```go
// benchmark_test.go
func BenchmarkDataProcessing(b *testing.B) {
    input := &CustomInput{
        config: defaultConfig(),
    }
    
    testData := `{"level":"INFO","message":"benchmark test"}`
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        _, err := input.processRawData([]byte(testData))
        if err != nil {
            b.Fatal(err)
        }
    }
}

func BenchmarkConcurrentProcessing(b *testing.B) {
    input := &CustomInput{
        config: defaultConfig(),
    }
    
    b.RunParallel(func(pb *testing.PB) {
        testData := `{"level":"INFO","message":"concurrent test"}`
        for pb.Next() {
            input.processRawData([]byte(testData))
        }
    })
}
```

### 6.4 é”™è¯¯åœºæ™¯æµ‹è¯•


**ğŸš¨ é”™è¯¯åœºæ™¯æ¸…å•**ï¼š

**ç½‘ç»œé”™è¯¯æ¨¡æ‹Ÿ**ï¼š
```go
func TestNetworkFailure(t *testing.T) {
    // æ¨¡æ‹Ÿç½‘ç»œä¸­æ–­
    server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        time.Sleep(5 * time.Second) // æ¨¡æ‹Ÿè¶…æ—¶
    }))
    defer server.Close()
    
    input := &CustomInput{
        config: Config{
            URL: server.URL,
            Timeout: 1 * time.Second,
        },
    }
    
    err := input.fetchData()
    assert.Error(t, err)
    assert.Contains(t, err.Error(), "timeout")
}
```

**èµ„æºä¸è¶³æ¨¡æ‹Ÿ**ï¼š
```go
func TestResourceExhaustion(t *testing.T) {
    // æ¨¡æ‹Ÿå†…å­˜ä¸è¶³
    input := &CustomInput{
        config: Config{
            BufferSize: 1, // å¾ˆå°çš„ç¼“å†²åŒº
        },
    }
    
    // å‘é€å¤§é‡æ•°æ®
    for i := 0; i < 1000; i++ {
        err := input.processData(generateLargeData())
        if err != nil {
            assert.Contains(t, err.Error(), "buffer full")
            break
        }
    }
}
```

---

## 7. ğŸ”— ç¬¬ä¸‰æ–¹æ¨¡å—é›†æˆ


### 7.1 æ¨¡å—å…¼å®¹æ€§


**ğŸ¤” å…¼å®¹æ€§è€ƒè™‘å› ç´ **ï¼š

```
å…¼å®¹æ€§æ£€æŸ¥æ¸…å•ï¼š

ç‰ˆæœ¬å…¼å®¹æ€§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Filebeatç‰ˆæœ¬    â”‚ â† ç¡®ä¿APIå…¼å®¹
â”‚ Goè¯­è¨€ç‰ˆæœ¬      â”‚ â† ç¼–è¯‘ç¯å¢ƒå…¼å®¹  
â”‚ ä¾èµ–åº“ç‰ˆæœ¬      â”‚ â† é¿å…å†²çª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
æ¥å£å…¼å®¹æ€§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Inputæ¥å£       â”‚ â† å®ç°æ ‡å‡†æ¥å£
â”‚ é…ç½®æ ¼å¼        â”‚ â† éµå¾ªé…ç½®è§„èŒƒ
â”‚ äº‹ä»¶æ ¼å¼        â”‚ â† æ ‡å‡†äº‹ä»¶ç»“æ„
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
è¿è¡Œç¯å¢ƒå…¼å®¹æ€§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œç³»ç»Ÿ        â”‚ â† Linux/Windows/Mac
â”‚ CPUæ¶æ„         â”‚ â† x86/ARMç­‰
â”‚ èµ„æºéœ€æ±‚        â”‚ â† å†…å­˜/ç£ç›˜è¦æ±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç¬¬ä¸‰æ–¹æ¨¡å—ä½¿ç”¨


**ğŸ“¦ æ¨¡å—è·å–æ–¹å¼**ï¼š

**GitHubç¤¾åŒºæ¨¡å—**ï¼š
```bash
# 1. ä»GitHubè·å–
git clone https://github.com/community/filebeat-custom-input.git

# 2. æ£€æŸ¥å…¼å®¹æ€§
cd filebeat-custom-input
grep -r "filebeat" go.mod  # æ£€æŸ¥Filebeatç‰ˆæœ¬ä¾èµ–

# 3. ç¼–è¯‘å®‰è£…
make build
cp build/custom-input.so /path/to/filebeat/inputs/
```

**Goæ¨¡å—æ–¹å¼**ï¼š
```go
// go.mod ä¸­æ·»åŠ ä¾èµ–
module myproject

require (
    github.com/elastic/beats/v8 v8.10.0
    github.com/community/custom-parser v1.2.0
)

// åœ¨ä»£ç ä¸­ä½¿ç”¨
import "github.com/community/custom-parser"

func (input *CustomInput) parseData(data []byte) (map[string]interface{}, error) {
    return custom_parser.Parse(data, input.config.Format)
}
```

### 7.3 æ¨¡å—é…ç½®ç®¡ç†


**âš™ï¸ ç»Ÿä¸€é…ç½®ç®¡ç†**ï¼š

```yaml
# filebeat.yml - å¤šæ¨¡å—é…ç½®ç¤ºä¾‹
filebeat.inputs:
# å®˜æ–¹æ¨¡å—
- type: log
  paths: ["/var/log/system.log"]
  
# ç¬¬ä¸‰æ–¹æ¨¡å—1  
- type: custom-api
  url: "https://api.example.com/logs"
  auth:
    token: "${API_TOKEN}"
  
# ç¬¬ä¸‰æ–¹æ¨¡å—2
- type: custom-database
  connection:
    host: "localhost"
    port: 5432
    database: "logs"
  query: "SELECT * FROM app_logs WHERE created_at > NOW() - INTERVAL '1 minute'"

# è‡ªå®šä¹‰æ¨¡å—
- type: myapp
  source:
    path: "/app/logs/*.log"
```

### 7.4 æ¨¡å—ä¾èµ–ç®¡ç†


**ğŸ“š ä¾èµ–ç®¡ç†ç­–ç•¥**ï¼š

**ä¾èµ–ç‰ˆæœ¬é”å®š**ï¼š
```go
// go.mod
module filebeat-custom

go 1.19

require (
    github.com/elastic/beats/v8 v8.10.0
    github.com/lib/pq v1.10.9                    // PostgreSQLé©±åŠ¨
    github.com/go-redis/redis/v8 v8.11.5         // Rediså®¢æˆ·ç«¯
    github.com/prometheus/client_golang v1.16.0  // ç›‘æ§æŒ‡æ ‡
)

// ä½¿ç”¨replaceæŒ‡ä»¤å¤„ç†ç‰ˆæœ¬å†²çª
replace github.com/conflicted/package => github.com/fixed/package v1.0.0
```

**ä¾èµ–å†²çªè§£å†³**ï¼š
```bash
# 1. æ£€æŸ¥ä¾èµ–å†²çª
go mod graph | grep conflicted-package

# 2. æŸ¥çœ‹å…·ä½“å†²çª
go mod why github.com/conflicted/package

# 3. ä½¿ç”¨replaceè§£å†³
go mod edit -replace github.com/old/package=github.com/new/package@v1.0.0

# 4. æ¸…ç†å’ŒéªŒè¯
go mod tidy
go mod verify
```

**ğŸ”„ æ¨¡å—æ›´æ–°ç­–ç•¥**ï¼š

```
æ¨¡å—æ›´æ–°æµç¨‹ï¼š

æµ‹è¯•ç¯å¢ƒéªŒè¯ â†’ é¢„å‘å¸ƒæµ‹è¯• â†’ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
        â”‚              â”‚              â”‚
    åŠŸèƒ½æµ‹è¯•        å…¼å®¹æ€§æµ‹è¯•      ç°åº¦å‘å¸ƒ
    æ€§èƒ½æµ‹è¯•        å›å½’æµ‹è¯•        ç›‘æ§è§‚å¯Ÿ
    å®‰å…¨æµ‹è¯•        å‹åŠ›æµ‹è¯•        å¿«é€Ÿå›æ»š
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è‡ªå®šä¹‰æ¨¡å—æœ¬è´¨ï¼šä¸ºç‰¹å®šéœ€æ±‚å®šåˆ¶çš„æ•°æ®æ”¶é›†å’Œå¤„ç†ç»„ä»¶
ğŸ”¸ å¼€å‘æ¡†æ¶ï¼šåŸºäºBeatsæ¡†æ¶ï¼Œå®ç°æ ‡å‡†æ¥å£ï¼Œéµå¾ªç”Ÿå‘½å‘¨æœŸ
ğŸ”¸ æ ¸å¿ƒæ¥å£ï¼šInputã€Configurableã€Stoppableç­‰æ ‡å‡†æ¥å£
ğŸ”¸ æµ‹è¯•ç­–ç•¥ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€é”™è¯¯åœºæ™¯æµ‹è¯•
ğŸ”¸ éƒ¨ç½²ç®¡ç†ï¼šç¼–è¯‘æ„å»ºã€ç‰ˆæœ¬æ§åˆ¶ã€å®¹å™¨åŒ–éƒ¨ç½²
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¼€å‘æ¨¡å—çš„æ ¸å¿ƒåŸåˆ™**ï¼š
```
ä¸“ä¸šæ€§ï¼šé’ˆå¯¹ç‰¹å®šä¸šåŠ¡éœ€æ±‚ç²¾ç¡®è®¾è®¡
æ ‡å‡†åŒ–ï¼šéµå¾ªFilebeatæ ‡å‡†æ¥å£å’Œè§„èŒƒ  
å¯é æ€§ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
å¯ç»´æŠ¤ï¼šæ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£è¯´æ˜
å¯æ‰©å±•ï¼šé¢„ç•™æ‰©å±•æ¥å£å’Œé…ç½®é€‰é¡¹
```

**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰æ¨¡å—**ï¼š
```
âœ… é€‚åˆè‡ªå®šä¹‰ï¼š
â€¢ å…¬å¸å†…éƒ¨ç³»ç»Ÿçš„ç‰¹æ®Šæ—¥å¿—æ ¼å¼
â€¢ å®˜æ–¹æ¨¡å—ä¸æ”¯æŒçš„æ•°æ®æº
â€¢ æœ‰ç‰¹æ®Šæ€§èƒ½è¦æ±‚çš„åœºæ™¯
â€¢ éœ€è¦ç‰¹æ®Šå¤„ç†é€»è¾‘çš„æ•°æ®

âŒ ä¸é€‚åˆè‡ªå®šä¹‰ï¼š
â€¢ å®˜æ–¹æ¨¡å—å·²èƒ½æ»¡è¶³éœ€æ±‚
â€¢ æ•°æ®æ ¼å¼æ ‡å‡†ä¸”ç®€å•
â€¢ å›¢é˜Ÿç¼ºä¹å¼€å‘ç»´æŠ¤èƒ½åŠ›
â€¢ ä¸€æ¬¡æ€§çš„ä¸´æ—¶éœ€æ±‚
```

**ğŸ”¹ å¼€å‘è¿‡ç¨‹ä¸­çš„é‡ç‚¹å…³æ³¨**ï¼š
```
é…ç½®è®¾è®¡ï¼šç®€å•æ˜“ç”¨ï¼ŒéªŒè¯å®Œå–„
é”™è¯¯å¤„ç†ï¼šä¼˜é›…é™çº§ï¼Œä¸å½±å“ä¸»ç¨‹åº
æ€§èƒ½ä¼˜åŒ–ï¼šé¿å…å†…å­˜æ³„æ¼ï¼Œæ§åˆ¶èµ„æºä½¿ç”¨
æµ‹è¯•è¦†ç›–ï¼šåŠŸèƒ½æµ‹è¯•ï¼Œè¾¹ç•Œæµ‹è¯•ï¼Œå‹åŠ›æµ‹è¯•
æ–‡æ¡£ç¼–å†™ï¼šä½¿ç”¨è¯´æ˜ï¼Œé…ç½®ç¤ºä¾‹ï¼Œæ•…éšœæ’æŸ¥
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **é‡‘èç³»ç»Ÿ**ï¼šäº¤æ˜“æ—¥å¿—çš„å®æ—¶é‡‡é›†å’Œé£æ§æ•°æ®æå–
- **ç”µå•†å¹³å°**ï¼šç”¨æˆ·è¡Œä¸ºæ•°æ®çš„ä¸ªæ€§åŒ–æ”¶é›†å’Œåˆ†æ
- **ç‰©è”ç½‘**ï¼šè®¾å¤‡ä¼ æ„Ÿå™¨æ•°æ®çš„åè®®è§£æå’Œé¢„å¤„ç†
- **æ¸¸æˆè¡Œä¸š**ï¼šæ¸¸æˆæ—¥å¿—çš„æ€§èƒ½åˆ†æå’Œç©å®¶è¡Œä¸ºè¿½è¸ª

**ğŸ› ï¸ æŠ€æœ¯ä»·å€¼**ï¼š
- **å®šåˆ¶åŒ–**ï¼šå®Œå…¨ç¬¦åˆä¸šåŠ¡éœ€æ±‚çš„æ•°æ®æ”¶é›†æ–¹æ¡ˆ
- **é«˜æ€§èƒ½**ï¼šé’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–ï¼Œæ€§èƒ½æ›´ä¼˜
- **å¯æ§æ€§**ï¼šå®Œå…¨æŒæ§ä»£ç é€»è¾‘ï¼Œé—®é¢˜å¿«é€Ÿå®šä½
- **æ‰©å±•æ€§**ï¼šå¯æ ¹æ®ä¸šåŠ¡å‘å±•æŒç»­è¿­ä»£ä¼˜åŒ–

### 8.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ è¿›é˜¶è·¯çº¿**ï¼š

```
æ–°æ‰‹å…¥é—¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç†Ÿæ‚‰Filebeat â”‚ â† æŒæ¡åŸºç¡€ä½¿ç”¨å’Œé…ç½®
â”‚ 2. å­¦ä¹ Goè¯­è¨€   â”‚ â† æŒæ¡åŸºç¡€è¯­æ³•å’Œç‰¹æ€§
â”‚ 3. ç†è§£Beatsæ¡†æ¶â”‚ â† äº†è§£æ¶æ„å’Œæ¥å£è®¾è®¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
è¿›é˜¶å¼€å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç®€å•æ’ä»¶å¼€å‘ â”‚ â† ä»æ–‡ä»¶è¯»å–å¼€å§‹
â”‚ 2. å¤æ‚é€»è¾‘å¤„ç† â”‚ â† æ•°æ®è§£æå’Œè½¬æ¢
â”‚ 3. æ€§èƒ½ä¼˜åŒ–    â”‚ â† å¹¶å‘å¤„ç†å’Œèµ„æºç®¡ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
é«˜çº§åº”ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ†å¸ƒå¼éƒ¨ç½²   â”‚ â† é›†ç¾¤ç®¡ç†å’Œç›‘æ§
â”‚ 2. ä¼ä¸šçº§åº”ç”¨   â”‚ â† å®‰å…¨æ€§å’Œç¨³å®šæ€§
â”‚ 3. å¼€æºè´¡çŒ®     â”‚ â† ç¤¾åŒºæ¨¡å—å¼€å‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
- **åŠ¨æ‰‹å®è·µ**ï¼šä»ç®€å•çš„æ–‡ä»¶è¯»å–æ’ä»¶å¼€å§‹
- **é˜…è¯»æºç **ï¼šç ”ç©¶å®˜æ–¹æ¨¡å—çš„å®ç°æ–¹å¼
- **ç¤¾åŒºäº¤æµ**ï¼šå‚ä¸Elasticç¤¾åŒºè®¨è®ºå’Œè´¡çŒ®
- **æŒç»­å­¦ä¹ **ï¼šå…³æ³¨æ–°ç‰ˆæœ¬ç‰¹æ€§å’Œæœ€ä½³å®è·µ

**æ ¸å¿ƒè®°å¿†**ï¼š
- è‡ªå®šä¹‰æ¨¡å—è§£å†³ç‰¹æ®Šéœ€æ±‚ï¼ŒåŸºäºæ ‡å‡†æ¡†æ¶å¼€å‘
- æ¥å£è®¾è®¡è¦æ ‡å‡†åŒ–ï¼Œé”™è¯¯å¤„ç†è¦å®Œå–„
- æµ‹è¯•è¦†ç›–è¦å…¨é¢ï¼Œéƒ¨ç½²ç®¡ç†è¦è§„èŒƒ
- å¼€å‘ä¸ºäº†ä¸šåŠ¡ä»·å€¼ï¼Œä¸æ˜¯ä¸ºäº†æŠ€æœ¯ç‚«æŠ€