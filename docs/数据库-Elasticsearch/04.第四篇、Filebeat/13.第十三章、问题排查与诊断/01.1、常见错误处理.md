---
title: 1ã€å¸¸è§é”™è¯¯å¤„ç†
---
## ğŸ“š ç›®å½•

1. [é—®é¢˜æ’æŸ¥åŸºç¡€](#1-é—®é¢˜æ’æŸ¥åŸºç¡€)
2. [è¿æ¥è¶…æ—¶é—®é¢˜](#2-è¿æ¥è¶…æ—¶é—®é¢˜)
3. [è®¤è¯å¤±è´¥å¤„ç†](#3-è®¤è¯å¤±è´¥å¤„ç†)
4. [ç´¢å¼•åˆ›å»ºå¤±è´¥](#4-ç´¢å¼•åˆ›å»ºå¤±è´¥)
5. [æ–‡ä»¶æƒé™é”™è¯¯](#5-æ–‡ä»¶æƒé™é”™è¯¯)
6. [å†…å­˜ä¸è¶³é—®é¢˜](#6-å†…å­˜ä¸è¶³é—®é¢˜)
7. [é…ç½®è¯­æ³•é”™è¯¯](#7-é…ç½®è¯­æ³•é”™è¯¯)
8. [ç½‘ç»œè¿æ¥é—®é¢˜](#8-ç½‘ç»œè¿æ¥é—®é¢˜)
9. [é…ç½®é”™è¯¯è¯Šæ–­](#9-é…ç½®é”™è¯¯è¯Šæ–­)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” é—®é¢˜æ’æŸ¥åŸºç¡€


### 1.1 Filebeaté—®é¢˜æ’æŸ¥çš„æ€è·¯


**ä»€ä¹ˆæ˜¯é—®é¢˜æ’æŸ¥ï¼Ÿ**
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“Filebeatä¸æ­£å¸¸å·¥ä½œæ—¶ï¼Œæˆ‘ä»¬è¦åƒåŒ»ç”Ÿçœ‹ç—…ä¸€æ ·ï¼Œæ‰¾å‡ºé—®é¢˜åœ¨å“ªé‡Œï¼Œç„¶åå¯¹ç—‡ä¸‹è¯ã€‚

```
é—®é¢˜æ’æŸ¥çš„åŸºæœ¬æµç¨‹ï¼š

è§‚å¯Ÿç—‡çŠ¶ â†’ æŸ¥çœ‹æ—¥å¿— â†’ åˆ†æåŸå›  â†’ æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ â†’ éªŒè¯ä¿®å¤
     â†“
åƒçœ‹ç—…ä¸€æ ·ï¼šå‘ç°ä¸èˆ’æœ â†’ æ£€æŸ¥èº«ä½“ â†’ æ‰¾ç—…å›  â†’ å¼€è¯æ²»ç–— â†’ å¤æŸ¥
```

**ğŸ”¸ å¸¸è§é—®é¢˜åˆ†ç±»**

| é—®é¢˜ç±»å‹ | **è¡¨ç°ç—‡çŠ¶** | **å¯èƒ½åŸå› ** | **ä¼˜å…ˆçº§** |
|---------|------------|-------------|-----------|
| ğŸŒ **è¿æ¥é—®é¢˜** | `æ— æ³•å‘é€æ•°æ®åˆ°Elasticsearch` | `ç½‘ç»œã€é…ç½®ã€è®¤è¯` | `ğŸ”¥é«˜` |
| ğŸ“ **æ–‡ä»¶é—®é¢˜** | `æ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶` | `æƒé™ã€è·¯å¾„ã€æ ¼å¼` | `ğŸ”¥é«˜` |
| âš™ï¸ **é…ç½®é—®é¢˜** | `å¯åŠ¨å¤±è´¥æˆ–å¼‚å¸¸è¡Œä¸º` | `è¯­æ³•é”™è¯¯ã€å‚æ•°é”™è¯¯` | `ğŸ”¥é«˜` |
| ğŸ’¾ **æ€§èƒ½é—®é¢˜** | `å†…å­˜å ç”¨é«˜ã€å¤„ç†æ…¢` | `èµ„æºä¸è¶³ã€é…ç½®ä¸å½“` | `âš ï¸ä¸­` |

### 1.2 æ’æŸ¥å·¥å…·å’Œæ–¹æ³•


**ğŸ”§ åŸºæœ¬æ’æŸ¥å·¥å…·**

```bash
# 1. æŸ¥çœ‹Filebeatè¿è¡ŒçŠ¶æ€
systemctl status filebeat

# 2. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼ˆæœ€é‡è¦çš„æ’æŸ¥å·¥å…·ï¼‰
tail -f /var/log/filebeat/filebeat

# 3. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
filebeat test config

# 4. æµ‹è¯•è¾“å‡ºè¿æ¥
filebeat test output

# 5. éªŒè¯è¾“å…¥é…ç½®
filebeat test inputs
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šæ—¥å¿—æ–‡ä»¶æ˜¯æ’æŸ¥é—®é¢˜çš„"ç—…å†æœ¬"ï¼Œ90%çš„é—®é¢˜éƒ½èƒ½ä»æ—¥å¿—ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚

---

## 2. â±ï¸ è¿æ¥è¶…æ—¶é—®é¢˜


### 2.1 ä»€ä¹ˆæ˜¯è¿æ¥è¶…æ—¶


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒæ‰“ç”µè¯æ—¶ï¼Œæ‹¨å·åé•¿æ—¶é—´æ²¡äººæ¥å¬ï¼Œæœ€åè‡ªåŠ¨æŒ‚æ–­ã€‚Filebeatå‘Elasticsearchå‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç­‰å¾…æ—¶é—´å¤ªé•¿æ²¡æœ‰å“åº”ï¼Œå°±ä¼š"æŒ‚æ–­"è¿æ¥ã€‚

### 2.2 è¿æ¥è¶…æ—¶çš„å¸¸è§è¡¨ç°


**ğŸ“‹ å…¸å‹é”™è¯¯ä¿¡æ¯**
```
é”™è¯¯æ—¥å¿—ç¤ºä¾‹ï¼š
2025-12-21T14:30:15.123Z  ERROR  [publisher_pipeline_output]  
pipeline/output.go:154  Failed to connect to backoff(elasticsearch): 
Get "http://localhost:9200": dial tcp [::1]:9200: 
connect: connection refused

2025-12-21T14:30:20.456Z  ERROR  [elasticsearch]  
elasticsearch/client.go:342  Connection marked as failed because 
the onConnect callback failed: could not connect to any of the 
configured Elasticsearch hosts
```

**ğŸ”¸ é”™è¯¯ä¿¡æ¯è§£è¯»**
- `connection refused`ï¼šç›®æ ‡æœåŠ¡å™¨æ‹’ç»è¿æ¥ï¼ˆé€šå¸¸æ˜¯æœåŠ¡æœªå¯åŠ¨ï¼‰
- `dial tcp timeout`ï¼šç½‘ç»œè¿æ¥è¶…æ—¶
- `could not connect to any hosts`ï¼šæ‰€æœ‰é…ç½®çš„æœåŠ¡å™¨éƒ½è¿ä¸ä¸Š

### 2.3 è§£å†³è¿æ¥è¶…æ—¶é—®é¢˜


**æ­¥éª¤1ï¼šæ£€æŸ¥ç›®æ ‡æœåŠ¡çŠ¶æ€**
```bash
# æ£€æŸ¥Elasticsearchæ˜¯å¦è¿è¡Œ
curl -X GET "localhost:9200"

# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -tuln | grep 9200

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
systemctl status firewalld
```

**æ­¥éª¤2ï¼šè°ƒæ•´è¶…æ—¶é…ç½®**
```yaml
# filebeat.yml
output.elasticsearch:
  hosts: ["localhost:9200"]
  timeout: 90s           # é»˜è®¤90ç§’ï¼Œå¯ä»¥é€‚å½“å¢åŠ 
  max_retries: 3         # é‡è¯•æ¬¡æ•°
  backoff.init: 1s       # åˆå§‹é‡è¯•é—´éš”
  backoff.max: 60s       # æœ€å¤§é‡è¯•é—´éš”
```

**æ­¥éª¤3ï¼šç½‘ç»œè¯Šæ–­**
```bash
# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping elasticsearch-server

# æµ‹è¯•ç«¯å£è¿é€šæ€§
telnet localhost 9200

# æ£€æŸ¥DNSè§£æ
nslookup elasticsearch-server
```

> âš ï¸ **æ³¨æ„**ï¼šè¶…æ—¶æ—¶é—´ä¸è¦è®¾å¾—å¤ªçŸ­ï¼Œç½‘ç»œä¸å¥½æ—¶å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ã€‚

---

## 3. ğŸ” è®¤è¯å¤±è´¥å¤„ç†


### 3.1 è®¤è¯å¤±è´¥çš„å«ä¹‰


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒé—¨ç¦å¡åˆ·ä¸å¼€é—¨ä¸€æ ·ï¼ŒFilebeatæœ‰ç”¨æˆ·åå¯†ç ï¼Œä½†Elasticsearchä¸è®¤å¯ï¼Œæ‹’ç»è®©å®ƒè¿›å…¥ã€‚

### 3.2 è®¤è¯å¤±è´¥çš„è¡¨ç°


**ğŸ“‹ å…¸å‹é”™è¯¯ä¿¡æ¯**
```
é”™è¯¯ç¤ºä¾‹ï¼š
2025-12-21T14:35:10.789Z  ERROR  [elasticsearch]  
elasticsearch/client.go:342  Cannot index event publisher.Event
{content:{timestamp: ... }} (status=401): {"error":{"type":"security_exception",
"reason":"unable to authenticate user [filebeat_user] for REST request [/_bulk]"}}

2025-12-21T14:35:15.234Z  WARN   [elasticsearch]  
elasticsearch/client.go:387  Cannot index event publisher.Event
{content:{timestamp: ... }} (status=403): {"error":{"type":"security_exception",
"reason":"action [indices:data/write/bulk] is unauthorized for user [filebeat_user]"}}
```

**ğŸ”¸ é”™è¯¯çŠ¶æ€ç å«ä¹‰**
- `401 Unauthorized`ï¼šç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
- `403 Forbidden`ï¼šè®¤è¯æˆåŠŸä½†æƒé™ä¸è¶³
- `security_exception`ï¼šå®‰å…¨ç›¸å…³çš„é”™è¯¯

### 3.3 è§£å†³è®¤è¯é—®é¢˜


**æƒ…å†µ1ï¼šç”¨æˆ·åå¯†ç é”™è¯¯**
```yaml
# filebeat.yml - æ£€æŸ¥è®¤è¯é…ç½®
output.elasticsearch:
  hosts: ["localhost:9200"]
  username: "filebeat_user"        # ç¡®è®¤ç”¨æˆ·åæ­£ç¡®
  password: "your_password"        # ç¡®è®¤å¯†ç æ­£ç¡®
  
  # æˆ–ä½¿ç”¨APIå¯†é’¥ï¼ˆæ¨èï¼‰
  api_key: "your_base64_api_key"
```

**æƒ…å†µ2ï¼šæƒé™ä¸è¶³**
```bash
# åœ¨Elasticsearchä¸­ä¸ºç”¨æˆ·åˆ†é…æ­£ç¡®è§’è‰²
PUT /_security/user/filebeat_user
{
  "roles": [
    "beats_system",              # BeatsåŸºç¡€æƒé™
    "filebeat_writer"           # å†™å…¥æƒé™
  ]
}

# åˆ›å»ºè‡ªå®šä¹‰è§’è‰²
PUT /_security/role/filebeat_writer
{
  "indices": [
    {
      "names": ["filebeat-*"],
      "privileges": ["write", "create_index", "auto_configure"]
    }
  ]
}
```

**æƒ…å†µ3ï¼šè¯ä¹¦é—®é¢˜ï¼ˆHTTPSï¼‰**
```yaml
# filebeat.yml - SSLé…ç½®
output.elasticsearch:
  hosts: ["https://localhost:9200"]
  ssl.certificate_authorities: ["/path/to/ca.crt"]
  ssl.verification_mode: certificate    # æˆ– noneï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
```

> ğŸ”§ **å®è·µå»ºè®®**ï¼šä¼˜å…ˆä½¿ç”¨APIå¯†é’¥è€Œä¸æ˜¯ç”¨æˆ·åå¯†ç ï¼Œæ›´å®‰å…¨ä¹Ÿæ›´æ–¹ä¾¿ç®¡ç†ã€‚

---

## 4. ğŸ“Š ç´¢å¼•åˆ›å»ºå¤±è´¥


### 4.1 ç´¢å¼•åˆ›å»ºå¤±è´¥çš„åŸå› 


**ä»€ä¹ˆæ˜¯ç´¢å¼•åˆ›å»ºå¤±è´¥ï¼Ÿ**
æŠŠç´¢å¼•æƒ³è±¡æˆæ•°æ®åº“ä¸­çš„è¡¨ï¼Œå¦‚æœè¡¨åˆ›å»ºä¸äº†ï¼Œæ•°æ®å°±å­˜ä¸è¿›å»ã€‚Filebeatè¦å¾€Elasticsearchå†™æ•°æ®ï¼Œå¿…é¡»å…ˆæœ‰"è¡¨"ï¼ˆç´¢å¼•ï¼‰ã€‚

### 4.2 å¸¸è§çš„åˆ›å»ºå¤±è´¥åœºæ™¯


**ğŸ“‹ å…¸å‹é”™è¯¯è¡¨ç°**
```
é”™è¯¯ç¤ºä¾‹ï¼š
2025-12-21T14:40:22.567Z  ERROR  [elasticsearch]  
elasticsearch/client.go:342  Cannot index event publisher.Event
{content:{timestamp: ...}} (status=400): {"error":{"type":"invalid_index_name_exception",
"reason":"Invalid index name [FILEBEAT-2025.12.21], must be lowercase"}}

2025-12-21T14:40:30.123Z  ERROR  [index-management]  
idxmgmt/std.go:184  Failed to create index template: 
{"error":{"type":"resource_already_exists_exception",
"reason":"index template [filebeat-7.15.0] already exists"}}
```

### 4.3 è§£å†³ç´¢å¼•åˆ›å»ºé—®é¢˜


**é—®é¢˜1ï¼šç´¢å¼•åç§°ä¸è§„èŒƒ**
```yaml
# filebeat.yml - ä¿®æ­£ç´¢å¼•å‘½å
setup.template.settings:
  index.number_of_shards: 1
  index.number_of_replicas: 0

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-%{+yyyy.MM.dd}"    # ç¡®ä¿å°å†™ï¼Œæ ¼å¼æ­£ç¡®
```

**é—®é¢˜2ï¼šæ¨¡æ¿å†²çª**
```bash
# åˆ é™¤å†²çªçš„ç´¢å¼•æ¨¡æ¿
DELETE /_index_template/filebeat-*

# è®©Filebeaté‡æ–°åˆ›å»ºæ¨¡æ¿
filebeat setup --index-management
```

**é—®é¢˜3ï¼šæƒé™ä¸è¶³**
```bash
# ç¡®ä¿ç”¨æˆ·æœ‰åˆ›å»ºç´¢å¼•çš„æƒé™
PUT /_security/role/filebeat_writer
{
  "indices": [
    {
      "names": ["filebeat-*"],
      "privileges": [
        "write", 
        "create_index", 
        "manage",           # ç®¡ç†ç´¢å¼•
        "auto_configure"    # è‡ªåŠ¨é…ç½®
      ]
    }
  ]
}
```

> ğŸ’¡ **å°æŠ€å·§**ï¼šç´¢å¼•åç§°å¿…é¡»å…¨éƒ¨å°å†™ï¼Œå¯ä»¥åŒ…å«æ•°å­—ã€è¿å­—ç¬¦å’Œç‚¹å·ï¼Œä½†ä¸èƒ½ä»¥è¿å­—ç¬¦ã€ä¸‹åˆ’çº¿æˆ–ç‚¹å·å¼€å¤´ã€‚

---

## 5. ğŸ“ æ–‡ä»¶æƒé™é”™è¯¯


### 5.1 æ–‡ä»¶æƒé™é—®é¢˜çš„æœ¬è´¨


**é€šä¿—è§£é‡Š**ï¼š
å°±åƒä½ æƒ³çœ‹åˆ«äººçš„æ—¥è®°ï¼Œä½†æ—¥è®°æœ¬è¢«é”èµ·æ¥äº†ã€‚Filebeatæƒ³è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œä½†æ“ä½œç³»ç»Ÿä¸å…è®¸å®ƒè®¿é—®ã€‚

### 5.2 æƒé™é”™è¯¯çš„è¡¨ç°


**ğŸ“‹ å…¸å‹é”™è¯¯ä¿¡æ¯**
```
æƒé™é”™è¯¯ç¤ºä¾‹ï¼š
2025-12-21T14:45:18.345Z  ERROR  [input.log]  
log/input.go:145  Error reading /var/log/nginx/access.log: 
open /var/log/nginx/access.log: permission denied

2025-12-21T14:45:25.678Z  WARN   [input.log]  
log/harvester.go:302  File descriptor for /var/log/app/error.log could not be obtained: 
stat /var/log/app/error.log: permission denied
```

### 5.3 è§£å†³æ–‡ä»¶æƒé™é—®é¢˜


**æ–¹æ³•1ï¼šä¿®æ”¹æ–‡ä»¶æƒé™ï¼ˆæ¨èï¼‰**
```bash
# æŸ¥çœ‹å½“å‰æƒé™
ls -la /var/log/nginx/access.log

# ç»™Filebeatç”¨æˆ·è¯»å–æƒé™
chmod 644 /var/log/nginx/access.log

# æˆ–è€…å°†Filebeatç”¨æˆ·åŠ å…¥æ—¥å¿—æ–‡ä»¶çš„ç”¨æˆ·ç»„
usermod -a -G nginx filebeat
```

**æ–¹æ³•2ï¼šä¿®æ”¹Filebeatè¿è¡Œç”¨æˆ·**
```bash
# æŸ¥çœ‹Filebeatå½“å‰è¿è¡Œç”¨æˆ·
ps aux | grep filebeat

# ä¿®æ”¹systemdæœåŠ¡æ–‡ä»¶
sudo systemctl edit filebeat

# æ·»åŠ ä»¥ä¸‹é…ç½®
[Service]
User=root
Group=root
```

**æ–¹æ³•3ï¼šä½¿ç”¨sudoæƒé™ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰**
```bash
# ä¸´æ—¶ä»¥rootèº«ä»½è¿è¡Œ
sudo filebeat -e -c /etc/filebeat/filebeat.yml
```

**ğŸ“Š æƒé™è®¾ç½®å¯¹æ¯”**

| æƒé™æ–¹æ¡ˆ | **å®‰å…¨æ€§** | **ç»´æŠ¤æ€§** | **æ¨èåº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-----------|-----------|-----------|-------------|
| `ä¿®æ”¹æ–‡ä»¶æƒé™` | `â­â­â­â­` | `â­â­â­â­â­` | `ğŸ”¥æ¨è` | `ç”Ÿäº§ç¯å¢ƒ` |
| `åŠ å…¥ç”¨æˆ·ç»„` | `â­â­â­â­` | `â­â­â­â­` | `âœ…æ¨è` | `å¤šç”¨æˆ·ç¯å¢ƒ` |
| `ä½¿ç”¨rootè¿è¡Œ` | `â­â­` | `â­â­â­` | `âš ï¸è°¨æ…` | `æµ‹è¯•ç¯å¢ƒ` |

---

## 6. ğŸ’¾ å†…å­˜ä¸è¶³é—®é¢˜


### 6.1 å†…å­˜ä¸è¶³çš„è¡¨ç°


**ä»€ä¹ˆæ˜¯å†…å­˜ä¸è¶³ï¼Ÿ**
å°±åƒæ‰‹æœºè¿è¡Œå¤ªå¤šAPPä¼šå¡é¡¿ä¸€æ ·ï¼ŒFilebeatå¤„ç†å¤§é‡æ—¥å¿—æ—¶éœ€è¦å†…å­˜ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿå°±ä¼šå‡ºç°é—®é¢˜ã€‚

### 6.2 å†…å­˜é—®é¢˜çš„ç—‡çŠ¶


**ğŸ“‹ å…¸å‹è¡¨ç°**
```
å†…å­˜ç›¸å…³é”™è¯¯ï¼š
2025-12-21T14:50:33.789Z  ERROR  [beat]  
instance/beat.go:958  Exiting: failed to start: runtime: out of memory

2025-12-21T14:50:40.123Z  WARN   [filebeat]  
beater/filebeat.go:178  Memory usage is high (>80%), current: 85%

ç³»ç»Ÿå±‚é¢è¡¨ç°ï¼š
- Filebeatè¿›ç¨‹è¢«ç³»ç»Ÿkill
- æœåŠ¡å™¨å“åº”å˜æ…¢
- dmesgä¸­å‡ºç°OOM Killerä¿¡æ¯
```

### 6.3 å†…å­˜ä¼˜åŒ–ç­–ç•¥


**ç­–ç•¥1ï¼šè°ƒæ•´é˜Ÿåˆ—è®¾ç½®**
```yaml
# filebeat.yml - æ§åˆ¶å†…å­˜ä½¿ç”¨
queue.mem:
  events: 2048          # å‡å°‘å†…å­˜ä¸­çš„äº‹ä»¶æ•°ï¼ˆé»˜è®¤4096ï¼‰
  flush.min_events: 512 # æ‰¹æ¬¡å¤§å°
  flush.timeout: 1s     # åˆ·æ–°è¶…æ—¶

# é™åˆ¶harvesteræ•°é‡
filebeat.inputs:
- type: log
  paths:
    - /var/log/*.log
  harvester_limit: 10   # é™åˆ¶åŒæ—¶å¤„ç†çš„æ–‡ä»¶æ•°
```

**ç­–ç•¥2ï¼šä¼˜åŒ–è¾“å‡ºæ‰¹æ¬¡**
```yaml
output.elasticsearch:
  hosts: ["localhost:9200"]
  bulk_max_size: 1000   # å‡å°‘æ‰¹æ¬¡å¤§å°ï¼ˆé»˜è®¤50ï¼‰
  worker: 1             # å‡å°‘å·¥ä½œçº¿ç¨‹æ•°
  compression_level: 1  # é™ä½å‹ç¼©çº§åˆ«
```

**ç­–ç•¥3ï¼šç³»ç»Ÿçº§ä¼˜åŒ–**
```bash
# å¢åŠ ç³»ç»Ÿswapï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# ç›‘æ§å†…å­˜ä½¿ç”¨
watch -n 1 'free -h && ps aux | grep filebeat | grep -v grep'
```

**ğŸ“ˆ å†…å­˜ä½¿ç”¨ç›‘æ§**
```
å†…å­˜ä½¿ç”¨è¯„ä¼°æ ‡å‡†ï¼š

æ­£å¸¸ä½¿ç”¨ï¼š< 200MB    âœ… å¥åº·çŠ¶æ€
æ³¨æ„è§‚å¯Ÿï¼š200-500MB  âš ï¸ éœ€è¦å…³æ³¨  
éœ€è¦ä¼˜åŒ–ï¼š500MB-1GB  ğŸ”¥ ä¼˜åŒ–é…ç½®
ä¸¥é‡é—®é¢˜ï¼š> 1GB      ğŸš¨ ç«‹å³å¤„ç†
```

---

## 7. âš™ï¸ é…ç½®è¯­æ³•é”™è¯¯


### 7.1 é…ç½®è¯­æ³•é”™è¯¯çš„ç±»å‹


**ä»€ä¹ˆæ˜¯é…ç½®è¯­æ³•é”™è¯¯ï¼Ÿ**
å°±åƒå†™ä½œæ–‡æ—¶è¯­æ³•é”™è¯¯ä¼šå½±å“ç†è§£ä¸€æ ·ï¼ŒFilebeatçš„é…ç½®æ–‡ä»¶å¦‚æœè¯­æ³•ä¸å¯¹ï¼Œç¨‹åºå°±çœ‹ä¸æ‡‚ï¼Œæ— æ³•æ­£å¸¸å·¥ä½œã€‚

### 7.2 å¸¸è§è¯­æ³•é”™è¯¯


**ğŸ“‹ å…¸å‹è¯­æ³•é”™è¯¯**
```yaml
# âŒ é”™è¯¯ç¤ºä¾‹1ï¼šç¼©è¿›ä¸å¯¹
filebeat.inputs:
- type: log
paths:                    # ç¼©è¿›é”™è¯¯ï¼Œåº”è¯¥å’Œtypeå¯¹é½
  - /var/log/*.log

# âŒ é”™è¯¯ç¤ºä¾‹2ï¼šå¼•å·é—®é¢˜
filebeat.inputs:
- type: log
  paths:
    - '/var/log/*.log'    # å•å¼•å·åŒ…å«é€šé…ç¬¦å¯èƒ½æœ‰é—®é¢˜

# âŒ é”™è¯¯ç¤ºä¾‹3ï¼šæ ¼å¼é”™è¯¯
output.elasticsearch:
  hosts: localhost:9200   # ç¼ºå°‘æ•°ç»„æ ¼å¼çš„[]

# âœ… æ­£ç¡®å†™æ³•
filebeat.inputs:
- type: log
  paths:                  # æ­£ç¡®ç¼©è¿›
    - "/var/log/*.log"    # åŒå¼•å·æˆ–æ— å¼•å·
    
output.elasticsearch:
  hosts: ["localhost:9200"] # æ­£ç¡®çš„æ•°ç»„æ ¼å¼
```

### 7.3 é…ç½®éªŒè¯å’Œä¿®å¤


**æ­¥éª¤1ï¼šè¯­æ³•æ£€æŸ¥**
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
filebeat test config -c /etc/filebeat/filebeat.yml

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
filebeat test config -c /etc/filebeat/filebeat.yml -v
```

**æ­¥éª¤2ï¼šå¸¸è§é”™è¯¯ä¿®å¤**
```yaml
# é…ç½®æ–‡ä»¶æœ€ä½³å®è·µæ¨¡æ¿
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/*.log
  fields:
    logtype: system
  fields_under_root: false

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-%{+yyyy.MM.dd}"

logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0600
```

**æ­¥éª¤3ï¼šé…ç½®æ–‡ä»¶æ£€æŸ¥æ¸…å•**

> ğŸ”§ **é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
> - [ ] YAMLç¼©è¿›ä½¿ç”¨ç©ºæ ¼ï¼Œä¸ç”¨Tab
> - [ ] å­—ç¬¦ä¸²ç»Ÿä¸€ä½¿ç”¨åŒå¼•å·
> - [ ] æ•°ç»„æ ¼å¼ä½¿ç”¨æ–¹æ‹¬å·[]
> - [ ] è·¯å¾„ä½¿ç”¨ç»å¯¹è·¯å¾„
> - [ ] æ•æ„Ÿä¿¡æ¯é¿å…æ˜æ–‡å­˜å‚¨

---

## 8. ğŸŒ ç½‘ç»œè¿æ¥é—®é¢˜


### 8.1 ç½‘ç»œé—®é¢˜çš„åˆ†ç±»


**ç½‘ç»œè¿æ¥é—®é¢˜çš„æœ¬è´¨**ï¼š
å°±åƒä¸¤ä¸ªäººæ‰“ç”µè¯ï¼Œå¯èƒ½æ˜¯ä¿¡å·ä¸å¥½ã€å·ç é”™è¯¯ã€å¯¹æ–¹ä¸åœ¨ç­‰å¤šç§åŸå› å¯¼è‡´é€šè¯å¤±è´¥ã€‚

### 8.2 ç½‘ç»œé—®é¢˜è¯Šæ–­


**ğŸ” ç½‘ç»œè¯Šæ–­æ­¥éª¤**

```
ç½‘ç»œé—®é¢˜æ’æŸ¥æµç¨‹ï¼š

ç¬¬1æ­¥ï¼šåŸºç¡€è¿é€šæ€§
â””â”€ pingç›®æ ‡æœåŠ¡å™¨

ç¬¬2æ­¥ï¼šç«¯å£å¯è¾¾æ€§  
â””â”€ telnetæˆ–ncæµ‹è¯•ç«¯å£

ç¬¬3æ­¥ï¼šDNSè§£æ
â””â”€ nslookupæˆ–digæ£€æŸ¥åŸŸå

ç¬¬4æ­¥ï¼šé˜²ç«å¢™æ£€æŸ¥
â””â”€ æ£€æŸ¥æœ¬æœºå’Œç›®æ ‡æœåŠ¡å™¨é˜²ç«å¢™

ç¬¬5æ­¥ï¼šç½‘ç»œè·¯ç”±
â””â”€ tracerouteæŸ¥çœ‹ç½‘ç»œè·¯å¾„
```

**å®é™…è¯Šæ–­å‘½ä»¤**ï¼š
```bash
# 1. åŸºç¡€è¿é€šæ€§æµ‹è¯•
ping -c 4 elasticsearch-server

# 2. ç«¯å£è¿é€šæ€§æµ‹è¯•
telnet elasticsearch-server 9200
# æˆ–ä½¿ç”¨nc
nc -zv elasticsearch-server 9200

# 3. DNSè§£ææµ‹è¯•
nslookup elasticsearch-server
dig elasticsearch-server

# 4. é˜²ç«å¢™çŠ¶æ€æ£€æŸ¥
# CentOS/RHEL
systemctl status firewalld
firewall-cmd --list-all

# Ubuntu
ufw status

# 5. ç½‘ç»œè·¯ç”±è·Ÿè¸ª
traceroute elasticsearch-server
```

### 8.3 ç½‘ç»œé—®é¢˜è§£å†³æ–¹æ¡ˆ


**é—®é¢˜1ï¼šDNSè§£æå¤±è´¥**
```bash
# æ£€æŸ¥/etc/hostsæ–‡ä»¶
cat /etc/hosts

# æ·»åŠ ä¸»æœºæ˜ å°„ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
echo "192.168.1.100 elasticsearch-server" >> /etc/hosts

# æˆ–ç›´æ¥ä½¿ç”¨IPåœ°å€
```

```yaml
# filebeat.yml - ä½¿ç”¨IPä»£æ›¿åŸŸå
output.elasticsearch:
  hosts: ["192.168.1.100:9200"]  # ç›´æ¥ä½¿ç”¨IP
```

**é—®é¢˜2ï¼šé˜²ç«å¢™é˜»æ–­**
```bash
# ä¸´æ—¶å¼€æ”¾ç«¯å£ï¼ˆCentOS/RHELï¼‰
firewall-cmd --add-port=9200/tcp --zone=public

# æ°¸ä¹…å¼€æ”¾ç«¯å£
firewall-cmd --add-port=9200/tcp --zone=public --permanent
firewall-cmd --reload

# Ubuntuå¼€æ”¾ç«¯å£
ufw allow 9200/tcp
```

**é—®é¢˜3ï¼šç½‘ç»œä»£ç†é—®é¢˜**
```yaml
# filebeat.yml - é…ç½®ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
output.elasticsearch:
  hosts: ["localhost:9200"]
  proxy_url: "http://proxy-server:8080"
```

---

## 9. ğŸ”§ é…ç½®é”™è¯¯è¯Šæ–­


### 9.1 ç³»ç»ŸåŒ–çš„è¯Šæ–­æ–¹æ³•


**é…ç½®é”™è¯¯è¯Šæ–­æ€è·¯**ï¼š
åƒä¿®è½¦ä¸€æ ·ï¼Œè¦ç³»ç»Ÿåœ°æ£€æŸ¥æ¯ä¸ªéƒ¨ä»¶ï¼Œä»æœ€åŸºç¡€çš„å¼€å§‹ï¼Œé€æ­¥ç¼©å°é—®é¢˜èŒƒå›´ã€‚

### 9.2 åˆ†å±‚è¯Šæ–­æ–¹æ³•


**ğŸ” è¯Šæ–­å±‚æ¬¡ç»“æ„**

```
é…ç½®è¯Šæ–­é‡‘å­—å¡”ï¼š

            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   åº”ç”¨å±‚é—®é¢˜     â”‚  â† ä¸šåŠ¡é€»è¾‘ã€æ•°æ®å¤„ç†
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   é…ç½®å±‚é—®é¢˜     â”‚  â† å‚æ•°è®¾ç½®ã€è¯­æ³•é”™è¯¯  
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   è¿æ¥å±‚é—®é¢˜     â”‚  â† ç½‘ç»œã€è®¤è¯ã€ç«¯å£
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚   ç³»ç»Ÿå±‚é—®é¢˜     â”‚  â† æƒé™ã€èµ„æºã€æœåŠ¡
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†å±‚è¯Šæ–­æ­¥éª¤**ï¼š

**ç¬¬1å±‚ï¼šç³»ç»Ÿå±‚æ£€æŸ¥**
```bash
# æœåŠ¡çŠ¶æ€æ£€æŸ¥
systemctl status filebeat

# èµ„æºä½¿ç”¨æ£€æŸ¥
top -p $(pgrep filebeat)
df -h  # ç£ç›˜ç©ºé—´
free -h # å†…å­˜ä½¿ç”¨

# åŸºç¡€æƒé™æ£€æŸ¥
id filebeat  # ç”¨æˆ·æ˜¯å¦å­˜åœ¨
```

**ç¬¬2å±‚ï¼šè¿æ¥å±‚æ£€æŸ¥**
```bash
# ç½‘ç»œè¿é€šæ€§
curl -X GET "localhost:9200"

# é…ç½®æµ‹è¯•
filebeat test output
filebeat test inputs
```

**ç¬¬3å±‚ï¼šé…ç½®å±‚æ£€æŸ¥**
```bash
# è¯­æ³•éªŒè¯
filebeat test config

# é…ç½®å¯¼å‡ºï¼ˆæŸ¥çœ‹å®é™…ç”Ÿæ•ˆçš„é…ç½®ï¼‰
filebeat export config
```

**ç¬¬4å±‚ï¼šåº”ç”¨å±‚æ£€æŸ¥**
```bash
# è¯¦ç»†æ—¥å¿—è¾“å‡º
filebeat -e -v -c /etc/filebeat/filebeat.yml

# è°ƒè¯•æ¨¡å¼
filebeat -e -d "*" -c /etc/filebeat/filebeat.yml
```

### 9.3 å¸¸ç”¨è¯Šæ–­å‘½ä»¤ç»„åˆ


**ğŸ› ï¸ å¿«é€Ÿè¯Šæ–­è„šæœ¬**
```bash
#!/bin/bash
# filebeat-diagnose.sh - Filebeaté—®é¢˜å¿«é€Ÿè¯Šæ–­è„šæœ¬

echo "=== Filebeat é—®é¢˜è¯Šæ–­ ==="

echo "1. æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
systemctl status filebeat

echo "2. æ£€æŸ¥é…ç½®è¯­æ³•..."
filebeat test config

echo "3. æ£€æŸ¥è¾“å‡ºè¿æ¥..."
filebeat test output

echo "4. æ£€æŸ¥æœ€è¿‘çš„é”™è¯¯æ—¥å¿—..."
tail -20 /var/log/filebeat/filebeat | grep ERROR

echo "5. æ£€æŸ¥ç³»ç»Ÿèµ„æº..."
echo "å†…å­˜ä½¿ç”¨:" && free -h
echo "ç£ç›˜ä½¿ç”¨:" && df -h /var/log

echo "è¯Šæ–­å®Œæˆï¼"
```

**ğŸ“Š é—®é¢˜å®šä½è¡¨**

| ç—‡çŠ¶ | **å¯èƒ½åŸå› ** | **æ£€æŸ¥å‘½ä»¤** | **è§£å†³æ–¹å‘** |
|------|------------|-------------|-------------|
| `å¯åŠ¨å¤±è´¥` | `é…ç½®é”™è¯¯` | `filebeat test config` | `ä¿®æ­£é…ç½®è¯­æ³•` |
| `æ— æ•°æ®ä¼ è¾“` | `è¾“å‡ºé…ç½®é”™è¯¯` | `filebeat test output` | `æ£€æŸ¥è¿æ¥å’Œè®¤è¯` |
| `æ–‡ä»¶è¯»å–å¤±è´¥` | `æƒé™é—®é¢˜` | `ls -la /var/log/` | `ä¿®æ”¹æ–‡ä»¶æƒé™` |
| `å†…å­˜å ç”¨é«˜` | `é…ç½®ä¸å½“` | `top -p filebeat-pid` | `ä¼˜åŒ–é˜Ÿåˆ—è®¾ç½®` |

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„é—®é¢˜æ’æŸ¥æŠ€èƒ½


```
ğŸ”¸ åŸºç¡€è¯Šæ–­ï¼šsystemctl statusã€æ—¥å¿—æŸ¥çœ‹ã€é…ç½®æµ‹è¯•
ğŸ”¸ è¿æ¥é—®é¢˜ï¼šç½‘ç»œè¯Šæ–­ã€è®¤è¯æ£€æŸ¥ã€è¶…æ—¶è°ƒä¼˜
ğŸ”¸ æƒé™é—®é¢˜ï¼šæ–‡ä»¶æƒé™ã€ç”¨æˆ·æƒé™ã€å®‰å…¨ä¸Šä¸‹æ–‡
ğŸ”¸ æ€§èƒ½é—®é¢˜ï¼šå†…å­˜ä¼˜åŒ–ã€é˜Ÿåˆ—è°ƒæ•´ã€æ‰¹æ¬¡è®¾ç½®
ğŸ”¸ é…ç½®é—®é¢˜ï¼šè¯­æ³•æ£€æŸ¥ã€å‚æ•°éªŒè¯ã€æœ€ä½³å®è·µ
```

### 10.2 é—®é¢˜æ’æŸ¥çš„é»„é‡‘æ³•åˆ™


**ğŸ¯ æ’æŸ¥åŸåˆ™**
```
1. å…ˆçœ‹æ—¥å¿—ï¼Œæ—¥å¿—é‡Œæœ‰80%çš„ç­”æ¡ˆ
2. ä»ç®€å•åˆ°å¤æ‚ï¼Œå…ˆæŸ¥åŸºç¡€é—®é¢˜
3. ä¸€æ¬¡åªæ”¹ä¸€ä¸ªé…ç½®ï¼Œé¿å…æ··ä¹±
4. ä¿ç•™å·¥ä½œé…ç½®çš„å¤‡ä»½
5. ç”¨æµ‹è¯•å‘½ä»¤éªŒè¯æ¯ä¸ªç»„ä»¶
```

**ğŸ”§ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥**
```bash
# çŠ¶æ€æ£€æŸ¥ä¸‰ä»¶å¥—
systemctl status filebeat       # æœåŠ¡çŠ¶æ€
tail -f /var/log/filebeat/filebeat  # å®æ—¶æ—¥å¿—  
filebeat test config            # é…ç½®æµ‹è¯•

# è¿æ¥æ£€æŸ¥ä¸‰ä»¶å¥—
filebeat test output            # è¾“å‡ºæµ‹è¯•
curl localhost:9200             # ESè¿é€šæ€§
ping elasticsearch-server       # ç½‘ç»œè¿é€šæ€§

# æƒé™æ£€æŸ¥
ls -la /var/log/                # æ–‡ä»¶æƒé™
id filebeat                     # ç”¨æˆ·æƒé™
```

### 10.3 é¢„é˜²é—®é¢˜çš„æœ€ä½³å®è·µ


**ğŸ›¡ï¸ é¢„é˜²æªæ–½**
- **é…ç½®ç®¡ç†**ï¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶
- **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®å…³é”®æŒ‡æ ‡ç›‘æ§
- **å®šæœŸæ£€æŸ¥**ï¼šå®šæœŸè¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•é…ç½®å˜æ›´å’Œé—®é¢˜è§£å†³è¿‡ç¨‹
- **æµ‹è¯•ç¯å¢ƒ**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®å˜æ›´

**ğŸ“ˆ é—®é¢˜è§£å†³æ•ˆç‡æå‡**
```
æ–°æ‰‹é˜¶æ®µï¼šé‡åˆ°é—®é¢˜ â†’ æŸ¥æ–‡æ¡£ â†’ å°è¯•è§£å†³ (è€—æ—¶è¾ƒé•¿)
     â†“
ç†Ÿç»ƒé˜¶æ®µï¼šé‡åˆ°é—®é¢˜ â†’ å¿«é€Ÿå®šä½ â†’ ç²¾å‡†è§£å†³ (æ•ˆç‡æå‡)
     â†“  
ä¸“å®¶é˜¶æ®µï¼šé¢„é˜²é—®é¢˜ â†’ å¿«é€Ÿè¯Šæ–­ â†’ æ ¹æœ¬è§£å†³ (æœ€é«˜æ•ˆç‡)
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ—¥å¿—æ˜¯æœ€å¥½çš„è¯Šæ–­å·¥å…·ï¼Œå­¦ä¼šçœ‹æ—¥å¿—å°±æˆåŠŸäº†ä¸€åŠ
- ç½‘ç»œå’Œæƒé™é—®é¢˜å æ®äº†å¤§éƒ¨åˆ†æ•…éšœï¼Œé‡ç‚¹å…³æ³¨
- ç³»ç»ŸåŒ–çš„è¯Šæ–­æ–¹æ³•æ¯”éšæœºå°è¯•æ›´é«˜æ•ˆ
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œå¥½çš„é…ç½®å’Œç›‘æ§èƒ½é¿å…å¤§éƒ¨åˆ†é—®é¢˜

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå»ºè®®æ–°æ‰‹å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ•…æ„åˆ¶é€ ä¸€äº›é”™è¯¯ï¼Œç»ƒä¹ æ’æŸ¥å’Œè§£å†³é—®é¢˜çš„æŠ€èƒ½ï¼Œè¿™æ ·åœ¨ç”Ÿäº§ç¯å¢ƒé‡åˆ°é—®é¢˜æ—¶å°±ä¸ä¼šæ…Œä¹±ã€‚