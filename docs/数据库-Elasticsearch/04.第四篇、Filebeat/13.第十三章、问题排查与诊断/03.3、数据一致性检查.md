---
title: 3ã€æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
---
## ğŸ“š ç›®å½•

1. [æ•°æ®ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ](#1-æ•°æ®ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ)
2. [æ•°æ®ä¸¢å¤±æ’æŸ¥](#2-æ•°æ®ä¸¢å¤±æ’æŸ¥)
3. [é‡å¤æ•°æ®æ£€æµ‹ä¸å¤„ç†](#3-é‡å¤æ•°æ®æ£€æµ‹ä¸å¤„ç†)
4. [æ—¶é—´æˆ³ä¸å­—æ®µè§£æé—®é¢˜](#4-æ—¶é—´æˆ³ä¸å­—æ®µè§£æé—®é¢˜)
5. [ç¼–ç ä¸ä¹±ç é—®é¢˜å¤„ç†](#5-ç¼–ç ä¸ä¹±ç é—®é¢˜å¤„ç†)
6. [å¤šè¡Œæ—¥å¿—åˆå¹¶é”™è¯¯æ’æŸ¥](#6-å¤šè¡Œæ—¥å¿—åˆå¹¶é”™è¯¯æ’æŸ¥)
7. [ç´¢å¼•æ˜ å°„å†²çªè§£å†³](#7-ç´¢å¼•æ˜ å°„å†²çªè§£å†³)
8. [å®æˆ˜æ’æŸ¥å·¥å…·ç®±](#8-å®æˆ˜æ’æŸ¥å·¥å…·ç®±)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ•°æ®ä¸€è‡´æ€§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§


**é€šä¿—ç†è§£**ï¼šæ•°æ®ä¸€è‡´æ€§å°±æ˜¯ç¡®ä¿ä½ çš„æ—¥å¿—æ•°æ®ä»äº§ç”Ÿåˆ°æœ€ç»ˆå­˜å‚¨çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œ**ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€ä¸å‡ºé”™**ã€‚

```
æ•°æ®æµè½¬è¿‡ç¨‹ï¼š
åº”ç”¨æ—¥å¿— â†’ Filebeat â†’ Elasticsearch â†’ æŸ¥è¯¢ç»“æœ
    |         |           |            |
åŸå§‹æ•°æ®   é‡‡é›†æ•°æ®    å­˜å‚¨æ•°æ®     å±•ç¤ºæ•°æ®
    â†“         â†“           â†“            â†“
éœ€è¦ä¿è¯å„ä¸ªç¯èŠ‚çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„
```

### 1.2 å¸¸è§æ•°æ®ä¸€è‡´æ€§é—®é¢˜


**ğŸ”¸ æ•°æ®å®Œæ•´æ€§é—®é¢˜**
- **æ•°æ®ä¸¢å¤±**ï¼šéƒ¨åˆ†æ—¥å¿—æ²¡æœ‰è¢«é‡‡é›†æˆ–ä¼ è¾“
- **æ•°æ®é‡å¤**ï¼šåŒä¸€æ¡æ—¥å¿—è¢«é‡‡é›†å¤šæ¬¡
- **æ•°æ®æˆªæ–­**ï¼šæ—¥å¿—å†…å®¹ä¸å®Œæ•´

**ğŸ”¸ æ•°æ®å‡†ç¡®æ€§é—®é¢˜**
- **æ—¶é—´æˆ³é”™è¯¯**ï¼šæ—¥å¿—æ—¶é—´ä¸å®é™…æ—¶é—´ä¸ç¬¦
- **å­—æ®µè§£æé”™è¯¯**ï¼šæ—¥å¿—å­—æ®µè¢«é”™è¯¯è§£æ
- **ç¼–ç é—®é¢˜**ï¼šä¸­æ–‡ä¹±ç æˆ–ç‰¹æ®Šå­—ç¬¦ä¸¢å¤±

**ğŸ”¸ æ•°æ®æ ¼å¼é—®é¢˜**
- **å¤šè¡Œåˆå¹¶é”™è¯¯**ï¼šå¤šè¡Œæ—¥å¿—è¢«é”™è¯¯åˆ†å‰²æˆ–åˆå¹¶
- **ç´¢å¼•æ˜ å°„å†²çª**ï¼šå­—æ®µç±»å‹ä¸Elasticsearchæ˜ å°„ä¸åŒ¹é…

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å°±åƒæ˜¯ç»™æ•°æ®åš"ä½“æ£€"ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰"ç”Ÿç—…"ã€‚

---

## 2. ğŸ” æ•°æ®ä¸¢å¤±æ’æŸ¥


### 2.1 æ•°æ®ä¸¢å¤±çš„å…¸å‹è¡¨ç°


**å¦‚ä½•å‘ç°æ•°æ®ä¸¢å¤±ï¼Ÿ**

```
ä¸šåŠ¡ç°è±¡ï¼š
âœ— åº”ç”¨æŠ¥é”™äº†ï¼Œä½†Elasticsearchä¸­æŸ¥ä¸åˆ°å¯¹åº”çš„é”™è¯¯æ—¥å¿—
âœ— æ—¥å¿—æ—¶é—´å‡ºç°"æ–­å±‚"ï¼ŒæŸä¸ªæ—¶é—´æ®µçš„æ—¥å¿—å®Œå…¨ç¼ºå¤±
âœ— æ—¥å¿—æ•°é‡æ˜æ˜¾å°‘äºé¢„æœŸï¼ˆæ¯”å¦‚å¹³æ—¶1å°æ—¶1ä¸‡æ¡ï¼Œç°åœ¨åªæœ‰5000æ¡ï¼‰
âœ— é‡è¦çš„ä¸šåŠ¡æ“ä½œè®°å½•æ‰¾ä¸åˆ°
```

### 2.2 æ•°æ®ä¸¢å¤±æ’æŸ¥æ­¥éª¤


**ğŸ”¸ ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ—¥å¿—æ˜¯å¦äº§ç”Ÿ**

```bash
# æ£€æŸ¥åº”ç”¨æœåŠ¡å™¨ä¸Šçš„åŸå§‹æ—¥å¿—æ–‡ä»¶
tail -f /var/log/app/application.log

# ç¡®è®¤é—®é¢˜æ—¶é—´æ®µæ˜¯å¦æœ‰æ—¥å¿—äº§ç”Ÿ
grep "2025-09-21 14:30" /var/log/app/application.log
```

**ğŸ”¸ ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥FilebeatçŠ¶æ€**

```bash
# æŸ¥çœ‹Filebeatæ˜¯å¦æ­£å¸¸è¿è¡Œ
systemctl status filebeat

# æ£€æŸ¥Filebeatæ—¥å¿—
tail -f /var/log/filebeat/filebeat.log

# æŸ¥çœ‹æ³¨å†Œè¡¨çŠ¶æ€ï¼ˆç¡®è®¤æ–‡ä»¶è¯»å–ä½ç½®ï¼‰
cat /var/lib/filebeat/registry/filebeat/data.json
```

**ğŸ”¸ ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ç½‘ç»œè¿æ¥**

```bash
# æµ‹è¯•åˆ°Elasticsearchçš„è¿æ¥
curl -X GET "elasticsearch:9200/_cluster/health"

# æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping elasticsearch-host
```

### 2.3 å¸¸è§ä¸¢å¤±åŸå› åŠè§£å†³æ–¹æ¡ˆ


| ä¸¢å¤±åŸå›  | **è¡¨ç°ç—‡çŠ¶** | **è§£å†³æ–¹æ¡ˆ** |
|---------|------------|-------------|
| ğŸ”§ **Filebeatåœæ­¢è¿è¡Œ** | `æœåŠ¡çŠ¶æ€å¼‚å¸¸` | `é‡å¯æœåŠ¡ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶` |
| ğŸ“ **æ—¥å¿—æ–‡ä»¶æƒé™é—®é¢˜** | `Permission deniedé”™è¯¯` | `è°ƒæ•´æ–‡ä»¶æƒé™ï¼Œæ£€æŸ¥ç”¨æˆ·ç»„` |
| ğŸŒ **ç½‘ç»œè¿æ¥ä¸­æ–­** | `è¿æ¥è¶…æ—¶é”™è¯¯` | `æ£€æŸ¥ç½‘ç»œï¼Œé…ç½®é‡è¯•æœºåˆ¶` |
| ğŸ’¾ **ç£ç›˜ç©ºé—´ä¸è¶³** | `No space lefté”™è¯¯` | `æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œé…ç½®æ—¥å¿—è½®è½¬` |
| âš™ï¸ **é…ç½®é”™è¯¯** | `è·¯å¾„æ‰¾ä¸åˆ°ï¼Œæ ¼å¼é”™è¯¯` | `éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•å’Œè·¯å¾„` |

**å®ç”¨æ’æŸ¥é…ç½®**ï¼š

```yaml
# filebeat.yml - å¢åŠ è°ƒè¯•ä¿¡æ¯
logging.level: debug
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644

# å¯ç”¨ç›‘æ§
monitoring:
  enabled: true
  elasticsearch:
    hosts: ["localhost:9200"]
```

> âš ï¸ **æ³¨æ„**ï¼šå¼€å¯debugæ¨¡å¼ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œæ’æŸ¥å®Œé—®é¢˜åè®°å¾—å…³é—­ã€‚

---

## 3. ğŸ“Š é‡å¤æ•°æ®æ£€æµ‹ä¸å¤„ç†


### 3.1 é‡å¤æ•°æ®çš„äº§ç”ŸåŸå› 


**ä¸ºä»€ä¹ˆä¼šæœ‰é‡å¤æ•°æ®ï¼Ÿ**

```
å¸¸è§åœºæ™¯ï¼š
ç½‘ç»œæ•…éšœ â†’ Filebeaté‡ä¼  â†’ æ•°æ®é‡å¤
æœåŠ¡é‡å¯ â†’ é‡å¤è¯»å– â†’ æ•°æ®é‡å¤
é…ç½®é”™è¯¯ â†’ å¤šä¸ªå®ä¾‹ â†’ æ•°æ®é‡å¤
```

### 3.2 é‡å¤æ•°æ®æ£€æµ‹æ–¹æ³•


**ğŸ”¸ æ–¹æ³•ä¸€ï¼šé€šè¿‡æ—¶é—´æˆ³æ£€æµ‹**

```bash
# åœ¨Kibanaä¸­æ£€æŸ¥é‡å¤çš„æ—¶é—´æˆ³
GET logs-*/_search
{
  "aggs": {
    "duplicate_timestamps": {
      "terms": {
        "field": "@timestamp",
        "min_doc_count": 2,
        "size": 100
      }
    }
  }
}
```

**ğŸ”¸ æ–¹æ³•äºŒï¼šé€šè¿‡æ—¥å¿—å†…å®¹æ£€æµ‹**

```bash
# æ£€æŸ¥å®Œå…¨ç›¸åŒçš„æ—¥å¿—å†…å®¹
GET logs-*/_search
{
  "aggs": {
    "duplicate_messages": {
      "terms": {
        "field": "message.keyword",
        "min_doc_count": 2,
        "size": 100
      }
    }
  }
}
```

### 3.3 é˜²é‡å¤é…ç½®ç­–ç•¥


**ğŸ”¸ ä½¿ç”¨fingerprintå¤„ç†å™¨**

```yaml
# filebeat.yml
processors:
  - fingerprint:
      fields: ["message", "@timestamp", "host.name"]
      target_field: "fingerprint"
      method: "md5"

# åœ¨Elasticsearchä¸­åŸºäºfingerprintå»é‡
PUT _template/logs-template
{
  "index_patterns": ["logs-*"],
  "settings": {
    "index": {
      "codec": "best_compression"
    }
  },
  "mappings": {
    "properties": {
      "fingerprint": {
        "type": "keyword"
      }
    }
  }
}
```

**ğŸ”¸ é…ç½®å¹‚ç­‰æ€§å†™å…¥**

```yaml
# filebeat.yml - ä½¿ç”¨æ–‡æ¡£IDé¿å…é‡å¤
output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "logs-%{+yyyy.MM.dd}"
  document_id: "%{fingerprint}"  # ç›¸åŒå†…å®¹ä¼šè¦†ç›–ï¼Œä¸ä¼šé‡å¤
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**ï¼šfingerprintå°±åƒæ˜¯ç»™æ¯æ¡æ—¥å¿—æ‰“ä¸Š"æŒ‡çº¹"ï¼Œç›¸åŒæŒ‡çº¹çš„æ—¥å¿—å°±æ˜¯é‡å¤çš„ã€‚

---

## 4. â° æ—¶é—´æˆ³ä¸å­—æ®µè§£æé—®é¢˜


### 4.1 æ—¶é—´æˆ³é”™è¯¯çš„å¸¸è§è¡¨ç°


**ğŸ”¸ æ—¶é—´æˆ³é—®é¢˜è¯†åˆ«**

```
é—®é¢˜ç°è±¡ï¼š
âŒ æ—¥å¿—æ—¶é—´æ˜¾ç¤ºä¸º1970å¹´ï¼ˆæ—¶é—´æˆ³è§£æå¤±è´¥ï¼‰
âŒ æ—¥å¿—æ—¶é—´ä¸å®é™…æ—¶é—´ç›¸å·®8å°æ—¶ï¼ˆæ—¶åŒºé—®é¢˜ï¼‰
âŒ æ—¥å¿—æ—¶é—´æ ¼å¼æ··ä¹±ï¼ˆè§£æè§„åˆ™ä¸åŒ¹é…ï¼‰
âŒ @timestampå­—æ®µä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯
```

### 4.2 æ—¶é—´æˆ³è§£æé…ç½®


**ğŸ”¸ å¸¸è§æ—¶é—´æ ¼å¼å¤„ç†**

```yaml
# filebeat.yml
processors:
  - timestamp:
      field: log_time
      layouts:
        - '2006-01-02 15:04:05'
        - '2006/01/02 15:04:05'
        - 'Jan _2 15:04:05'
      test:
        - '2025-09-21 14:30:25'
      location: 'Asia/Shanghai'  # è®¾ç½®æ—¶åŒº
```

**ğŸ”¸ æ—¶åŒºé—®é¢˜è§£å†³**

```yaml
# æ–¹æ³•1ï¼šåœ¨Filebeatä¸­å¤„ç†æ—¶åŒº
processors:
  - script:
      lang: javascript
      source: >
        function process(event) {
          var timestamp = event.Get("@timestamp");
          // è½¬æ¢ä¸ºæœ¬åœ°æ—¶åŒº
          var localTime = new Date(timestamp.getTime() + 8*60*60*1000);
          event.Put("@timestamp", localTime);
        }

# æ–¹æ³•2ï¼šä½¿ç”¨Ingest Pipelineå¤„ç†
PUT _ingest/pipeline/timezone-processor
{
  "processors": [
    {
      "date": {
        "field": "log_time",
        "target_field": "@timestamp",
        "formats": ["yyyy-MM-dd HH:mm:ss"],
        "timezone": "Asia/Shanghai"
      }
    }
  ]
}
```

### 4.3 å­—æ®µè§£æé”™è¯¯å¤„ç†


**ğŸ”¸ å­—æ®µç±»å‹å†²çª**

```
é—®é¢˜ï¼šåŒä¸€å­—æ®µæœ‰æ—¶æ˜¯æ•°å­—ï¼Œæœ‰æ—¶æ˜¯å­—ç¬¦ä¸²
è§£å†³ï¼šä½¿ç”¨åŠ¨æ€æ¨¡æ¿æˆ–æ˜ç¡®æ˜ å°„
```

```yaml
# è§£å†³æ–¹æ¡ˆï¼šé¢„å¤„ç†æ•°æ®ç±»å‹
processors:
  - convert:
      fields:
        - {from: "response_time", to: "response_time_ms", type: "float"}
        - {from: "status_code", to: "status", type: "integer"}
      fail_on_error: false
```

> âš ï¸ **æ³¨æ„**ï¼šæ—¶é—´æˆ³é—®é¢˜å¾€å¾€å¯¼è‡´æ—¥å¿—åœ¨æ—¶é—´çº¿ä¸Šæ˜¾ç¤ºé”™ä¹±ï¼Œå½±å“é—®é¢˜æ’æŸ¥ã€‚

---

## 5. ğŸ”¤ ç¼–ç ä¸ä¹±ç é—®é¢˜å¤„ç†


### 5.1 ç¼–ç é—®é¢˜çš„è¯†åˆ«


**å¦‚ä½•å‘ç°ç¼–ç é—®é¢˜ï¼Ÿ**

```
ä¹±ç è¡¨ç°ï¼š
ä¸­æ–‡æ˜¾ç¤ºä¸º "????????" æˆ– "é”Ÿæ–¤æ‹·"
ç‰¹æ®Šå­—ç¬¦å˜æˆå¥‡æ€ªç¬¦å·
JSONæ ¼å¼è¢«ç ´å
æ—¥å¿—å†…å®¹ä¸å®Œæ•´
```

### 5.2 ç¼–ç æ£€æµ‹ä¸å¤„ç†


**ğŸ”¸ æ£€æµ‹æ–‡ä»¶ç¼–ç **

```bash
# æ£€æµ‹æ—¥å¿—æ–‡ä»¶ç¼–ç 
file -i /var/log/app/application.log
# è¾“å‡ºï¼štext/plain; charset=utf-8

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹ç¼–ç 
hexdump -C /var/log/app/application.log | head
```

**ğŸ”¸ Filebeatç¼–ç é…ç½®**

```yaml
# filebeat.yml
filebeat.inputs:
  - type: log
    paths:
      - /var/log/app/*.log
    encoding: utf-8  # æ˜ç¡®æŒ‡å®šç¼–ç 
    
    # å¤„ç†ä¸åŒç¼–ç çš„æ–‡ä»¶
  - type: log
    paths:
      - /var/log/legacy/*.log
    encoding: gbk     # è€ç³»ç»Ÿå¯èƒ½ä½¿ç”¨GBKç¼–ç 
```

**ğŸ”¸ å­—ç¬¦é›†è½¬æ¢å¤„ç†**

```yaml
# ä½¿ç”¨å¤„ç†å™¨è½¬æ¢ç¼–ç 
processors:
  - script:
      lang: javascript
      source: >
        function process(event) {
          var message = event.Get("message");
          if (message) {
            // æ¸…ç†ä¸å¯æ‰“å°å­—ç¬¦
            var cleaned = message.replace(/[\x00-\x1F\x7F]/g, '');
            event.Put("message", cleaned);
          }
        }
```

### 5.3 å¸¸è§ç¼–ç é—®é¢˜è§£å†³æ–¹æ¡ˆ


| ç¼–ç é—®é¢˜ | **ç—‡çŠ¶** | **è§£å†³æ–¹æ¡ˆ** |
|---------|---------|-------------|
| ğŸ”¤ **UTF-8 BOM** | `æ–‡ä»¶å¼€å¤´æœ‰ç‰¹æ®Šå­—ç¬¦` | `é…ç½®ignore_olderï¼Œè¿‡æ»¤BOM` |
| ğŸ‡¨ğŸ‡³ **GBKä¸­æ–‡ä¹±ç ** | `ä¸­æ–‡æ˜¾ç¤ºä¸ºé—®å·` | `è®¾ç½®encoding: gbk` |
| ğŸ“ **æ··åˆç¼–ç ** | `éƒ¨åˆ†å†…å®¹ä¹±ç ` | `ä½¿ç”¨encodingæ£€æµ‹å™¨` |
| ğŸ”§ **æ§åˆ¶å­—ç¬¦** | `JSONè§£æå¤±è´¥` | `æ¸…ç†ä¸å¯æ‰“å°å­—ç¬¦` |

**å®ç”¨é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# å¤„ç†å¤šç§ç¼–ç çš„æ—¥å¿—
filebeat.inputs:
  - type: log
    paths:
      - /var/log/app/*.log
    multiline.pattern: '^\d{4}-\d{2}-\d{2}'
    multiline.negate: true
    multiline.match: after
    encoding: utf-8
    processors:
      - decode_json_fields:
          fields: ["message"]
          target: "json"
          overwrite_keys: true
```

> ğŸ’¡ **ç»éªŒåˆ†äº«**ï¼šç¼–ç é—®é¢˜é€šå¸¸åœ¨ä¸­æ–‡ç¯å¢ƒä¸‹æ›´å¸¸è§ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨UTF-8ç¼–ç ã€‚

---

## 6. ğŸ“„ å¤šè¡Œæ—¥å¿—åˆå¹¶é”™è¯¯æ’æŸ¥


### 6.1 å¤šè¡Œæ—¥å¿—é—®é¢˜çš„è¡¨ç°


**ä»€ä¹ˆæ˜¯å¤šè¡Œæ—¥å¿—é—®é¢˜ï¼Ÿ**

```
æ­£å¸¸æƒ…å†µï¼š
2025-09-21 14:30:01 ERROR Exception occurred:
java.lang.NullPointerException
    at com.example.Service.method(Service.java:123)
    at com.example.Controller.handle(Controller.java:45)

é—®é¢˜æƒ…å†µï¼š
æ¯ä¸€è¡Œè¢«å½“ä½œç‹¬ç«‹çš„æ—¥å¿—äº‹ä»¶å¤„ç†
```

### 6.2 å¤šè¡Œåˆå¹¶é…ç½®


**ğŸ”¸ åŸºäºæ¨¡å¼çš„å¤šè¡Œåˆå¹¶**

```yaml
# filebeat.yml - Javaå¼‚å¸¸æ—¥å¿—åˆå¹¶
filebeat.inputs:
  - type: log
    paths:
      - /var/log/app/*.log
    multiline.pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'  # æ—¶é—´æˆ³å¼€å¤´
    multiline.negate: true    # ä¸åŒ¹é…æ¨¡å¼çš„è¡Œ
    multiline.match: after    # åˆå¹¶åˆ°å‰ä¸€æ¡è®°å½•åé¢
    multiline.max_lines: 500  # æœ€å¤§è¡Œæ•°é™åˆ¶
    multiline.timeout: 10s    # è¶…æ—¶æ—¶é—´
```

**ğŸ”¸ ä¸åŒç±»å‹çš„å¤šè¡Œæ¨¡å¼**

```yaml
# Pythonå¼‚å¸¸æ—¥å¿—
multiline.pattern: '^Traceback'
multiline.negate: false
multiline.match: after

# JSONæ—¥å¿—ï¼ˆè·¨å¤šè¡Œï¼‰
multiline.pattern: '^[\s]*[{}]'
multiline.negate: true
multiline.match: after

# Apacheè®¿é—®æ—¥å¿—ï¼ˆç»§ç»­è¡Œä»¥ç©ºæ ¼å¼€å¤´ï¼‰
multiline.pattern: '^[[:space:]]'
multiline.negate: false
multiline.match: after
```

### 6.3 å¤šè¡Œåˆå¹¶é—®é¢˜æ’æŸ¥


**ğŸ”¸ æ’æŸ¥æ­¥éª¤**

```bash
# 1. æŸ¥çœ‹åŸå§‹æ—¥å¿—æ ¼å¼
head -20 /var/log/app/application.log

# 2. æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼
echo "2025-09-21 14:30:01 ERROR" | grep -E '^[0-9]{4}-[0-9]{2}-[0-9]{2}'

# 3. æ£€æŸ¥Filebeatè§£æç»“æœ
tail -f /var/log/filebeat/filebeat.log | grep multiline
```

**ğŸ”¸ å¸¸è§é…ç½®é”™è¯¯**

| é…ç½®é”™è¯¯ | **é—®é¢˜è¡¨ç°** | **æ­£ç¡®é…ç½®** |
|---------|-------------|-------------|
| âš™ï¸ **patterné”™è¯¯** | `æ—¥å¿—è¢«é”™è¯¯åˆ†å‰²` | `ä»”ç»†éªŒè¯æ­£åˆ™è¡¨è¾¾å¼` |
| ğŸ”„ **negateè®¾ç½®é”™è¯¯** | `åˆå¹¶æ–¹å‘ç›¸å` | `ç†è§£negateçš„å«ä¹‰` |
| â±ï¸ **timeoutè¿‡çŸ­** | `æ—¥å¿—è¢«æå‰åˆ‡æ–­` | `é€‚å½“å¢åŠ è¶…æ—¶æ—¶é—´` |
| ğŸ“ **max_linesè¿‡å°** | `é•¿æ—¥å¿—è¢«æˆªæ–­` | `æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´` |

> âš ï¸ **é‡è¦æé†’**ï¼šå¤šè¡Œåˆå¹¶é…ç½®é”™è¯¯å¯èƒ½å¯¼è‡´æ—¥å¿—å†…å®¹æ··ä¹±ï¼ŒåŠ¡å¿…åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®ã€‚

---

## 7. ğŸ—‚ï¸ ç´¢å¼•æ˜ å°„å†²çªè§£å†³


### 7.1 æ˜ å°„å†²çªçš„äº§ç”ŸåŸå› 


**ä»€ä¹ˆæ˜¯ç´¢å¼•æ˜ å°„å†²çªï¼Ÿ**

```
åœºæ™¯ï¼šåŒä¸€å­—æ®µåœ¨ä¸åŒæ—¶é—´è¢«è¯†åˆ«ä¸ºä¸åŒç±»å‹
ç¬¬ä¸€æ¡æ—¥å¿—ï¼š{"count": "100"}     â†’ countè¢«æ˜ å°„ä¸ºtextç±»å‹
ç¬¬äºŒæ¡æ—¥å¿—ï¼š{"count": 100}       â†’ countæƒ³è¦æ˜ å°„ä¸ºintegerç±»å‹
ç»“æœï¼šæ˜ å°„å†²çªï¼Œç¬¬äºŒæ¡æ—¥å¿—å†™å…¥å¤±è´¥
```

### 7.2 å†²çªæ£€æµ‹æ–¹æ³•


**ğŸ”¸ æŸ¥çœ‹æ˜ å°„å†²çªé”™è¯¯**

```bash
# æŸ¥çœ‹Elasticsearchæ—¥å¿—ä¸­çš„å†²çªä¿¡æ¯
GET logs-*/_search
{
  "query": {
    "term": {
      "tags": "mapperParsingException"
    }
  }
}

# æ£€æŸ¥å½“å‰ç´¢å¼•æ˜ å°„
GET logs-2025.09.21/_mapping
```

**ğŸ”¸ å¸¸è§å†²çªç±»å‹**

```json
// æ•°æ®ç±»å‹å†²çªç¤ºä¾‹
{
  "error": {
    "type": "mapper_parsing_exception",
    "reason": "failed to parse field [response_time] of type [long] in document"
  }
}
```

### 7.3 æ˜ å°„å†²çªè§£å†³ç­–ç•¥


**ğŸ”¸ æ–¹æ³•ä¸€ï¼šé¢„å®šä¹‰ç´¢å¼•æ¨¡æ¿**

```bash
# åˆ›å»ºä¸¥æ ¼çš„ç´¢å¼•æ¨¡æ¿
PUT _template/logs-template
{
  "index_patterns": ["logs-*"],
  "settings": {
    "index.mapping.ignore_malformed": true,
    "index.mapping.coerce": true
  },
  "mappings": {
    "properties": {
      "response_time": {"type": "float"},
      "status_code": {"type": "integer"},
      "timestamp": {"type": "date"},
      "message": {"type": "text"}
    }
  }
}
```

**ğŸ”¸ æ–¹æ³•äºŒï¼šFilebeatä¸­é¢„å¤„ç†**

```yaml
# filebeat.yml - æ•°æ®ç±»å‹è½¬æ¢
processors:
  - convert:
      fields:
        - {from: "response_time", type: "float"}
        - {from: "status_code", type: "integer"}
      ignore_missing: true
      fail_on_error: false
  
  - drop_fields:
      fields: ["original_field"]  # åˆ é™¤åŸå§‹å­—æ®µé¿å…å†²çª
```

**ğŸ”¸ æ–¹æ³•ä¸‰ï¼šä½¿ç”¨åŠ¨æ€æ¨¡æ¿**

```json
{
  "mappings": {
    "dynamic_templates": [
      {
        "strings_as_keywords": {
          "match": "*_id",
          "mapping": {
            "type": "keyword"
          }
        }
      },
      {
        "strings_as_text": {
          "match_mapping_type": "string",
          "mapping": {
            "type": "text",
            "fields": {
              "keyword": {
                "type": "keyword",
                "ignore_above": 256
              }
            }
          }
        }
      }
    ]
  }
}
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šæå‰è§„åˆ’å­—æ®µç±»å‹ï¼Œä½¿ç”¨ç´¢å¼•æ¨¡æ¿é¿å…æ˜ å°„å†²çªã€‚

---

## 8. ğŸ§° å®æˆ˜æ’æŸ¥å·¥å…·ç®±


### 8.1 ç›‘æ§å’Œè¯Šæ–­å·¥å…·


**ğŸ”¸ Filebeatå†…ç½®ç›‘æ§**

```yaml
# filebeat.yml - å¯ç”¨è¯¦ç»†ç›‘æ§
monitoring:
  enabled: true
  elasticsearch:
    hosts: ["localhost:9200"]
    
# æŸ¥çœ‹FilebeatæŒ‡æ ‡
GET .monitoring-beats-*/_search
{
  "query": {
    "bool": {
      "filter": [
        {"term": {"beats_stats.beat.name": "filebeat"}},
        {"range": {"timestamp": {"gte": "now-1h"}}}
      ]
    }
  }
}
```

**ğŸ”¸ å®ç”¨æ£€æŸ¥è„šæœ¬**

```bash
#!/bin/bash
# filebeat-health-check.sh

echo "=== Filebeatå¥åº·æ£€æŸ¥ ==="

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "1. æœåŠ¡çŠ¶æ€ï¼š"
systemctl is-active filebeat

# æ£€æŸ¥é…ç½®æ–‡ä»¶
echo "2. é…ç½®æ–‡ä»¶è¯­æ³•ï¼š"
filebeat test config

# æ£€æŸ¥æ—¥å¿—è¾“å‡º
echo "3. è¿‘æœŸé”™è¯¯æ—¥å¿—ï¼š"
tail -20 /var/log/filebeat/filebeat.log | grep -i error

# æ£€æŸ¥æ³¨å†Œè¡¨
echo "4. æ–‡ä»¶è¯»å–çŠ¶æ€ï¼š"
cat /var/lib/filebeat/registry/filebeat/data.json | jq '.[] | select(.source | contains("error"))'

echo "æ£€æŸ¥å®Œæˆï¼"
```

### 8.2 æ•°æ®è´¨é‡æ£€æŸ¥æŸ¥è¯¢


**ğŸ”¸ å¸¸ç”¨æ£€æŸ¥æŸ¥è¯¢**

```bash
# æ£€æŸ¥æ—¥å¿—æ•°é‡è¶‹åŠ¿
GET logs-*/_search
{
  "size": 0,
  "aggs": {
    "logs_over_time": {
      "date_histogram": {
        "field": "@timestamp",
        "calendar_interval": "1h"
      }
    }
  }
}

# æ£€æŸ¥å­—æ®µå®Œæ•´æ€§
GET logs-*/_search
{
  "size": 0,
  "aggs": {
    "missing_fields": {
      "missing": {
        "field": "response_time"
      }
    }
  }
}

# æ£€æŸ¥å¼‚å¸¸å€¼
GET logs-*/_search
{
  "query": {
    "bool": {
      "should": [
        {"range": {"response_time": {"gte": 10000}}},
        {"term": {"status_code": 0}},
        {"wildcard": {"message": "*null*"}}
      ]
    }
  }
}
```

### 8.3 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬


**ğŸ”¸ æ•°æ®è´¨é‡æ£€æŸ¥è„šæœ¬**

```python
#!/usr/bin/env python3
# data_quality_check.py

from elasticsearch import Elasticsearch
from datetime import datetime, timedelta
import json

def check_data_quality():
    es = Elasticsearch(['localhost:9200'])
    
    # æ£€æŸ¥æœ€è¿‘1å°æ—¶çš„æ•°æ®
    end_time = datetime.now()
    start_time = end_time - timedelta(hours=1)
    
    # æŸ¥è¯¢æ•°æ®é‡
    count_query = {
        "query": {
            "range": {
                "@timestamp": {
                    "gte": start_time.isoformat(),
                    "lte": end_time.isoformat()
                }
            }
        }
    }
    
    result = es.search(index="logs-*", body=count_query, size=0)
    total_docs = result['hits']['total']['value']
    
    print(f"æœ€è¿‘1å°æ—¶æ—¥å¿—æ•°é‡: {total_docs}")
    
    # æ£€æŸ¥å­—æ®µç¼ºå¤±æƒ…å†µ
    missing_fields = {}
    for field in ['response_time', 'status_code', 'user_id']:
        missing_query = {
            "query": {
                "bool": {
                    "must": [count_query["query"]],
                    "must_not": [{"exists": {"field": field}}]
                }
            }
        }
        result = es.search(index="logs-*", body=missing_query, size=0)
        missing_count = result['hits']['total']['value']
        missing_fields[field] = missing_count
    
    print("å­—æ®µç¼ºå¤±ç»Ÿè®¡:", json.dumps(missing_fields, indent=2))

if __name__ == "__main__":
    check_data_quality()
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ’æŸ¥æ€è·¯


```
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥çš„æœ¬è´¨ï¼šç¡®ä¿æ•°æ®ä»äº§ç”Ÿåˆ°å­˜å‚¨çš„å®Œæ•´æ€§
ğŸ”¸ æ’æŸ¥é¡ºåºï¼šæºå¤´â†’é‡‡é›†â†’ä¼ è¾“â†’å­˜å‚¨â†’å±•ç¤ºï¼Œé€ç¯èŠ‚æ£€æŸ¥
ğŸ”¸ å·¥å…·é…åˆï¼šFilebeatæ—¥å¿—+ElasticsearchæŸ¥è¯¢+ç›‘æ§æŒ‡æ ‡
ğŸ”¸ é¢„é˜²ä¸ºä¸»ï¼šæå‰é…ç½®ç›‘æ§ï¼Œè§„èŒƒæ•°æ®æ ¼å¼ï¼Œå»ºç«‹æ£€æŸ¥æœºåˆ¶
```

### 9.2 å…³é”®æ£€æŸ¥ç‚¹


**ğŸ”¹ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**
```
æ—¥å¿—æ•°é‡æ˜¯å¦æ­£å¸¸ â†’ æ—¶é—´åˆ†å¸ƒæ˜¯å¦è¿ç»­ â†’ å…³é”®å­—æ®µæ˜¯å¦ç¼ºå¤±
ç½‘ç»œä¼ è¾“æ˜¯å¦ç¨³å®š â†’ ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³ â†’ æœåŠ¡çŠ¶æ€æ˜¯å¦æ­£å¸¸
```

**ğŸ”¹ æ•°æ®å‡†ç¡®æ€§æ£€æŸ¥**
```
æ—¶é—´æˆ³æ˜¯å¦æ­£ç¡® â†’ å­—æ®µç±»å‹æ˜¯å¦åŒ¹é… â†’ ç¼–ç æ˜¯å¦æ­£å¸¸
å¤šè¡Œåˆå¹¶æ˜¯å¦æ­£ç¡® â†’ ç´¢å¼•æ˜ å°„æ˜¯å¦å†²çª â†’ æ•°æ®æ ¼å¼æ˜¯å¦è§„èŒƒ
```

### 9.3 å®æˆ˜ç»éªŒæ€»ç»“


**ğŸ”§ é¢„é˜²æ€§æªæ–½**
- **é…ç½®ç›‘æ§**ï¼šåŠæ—¶å‘ç°é—®é¢˜
- **è§„èŒƒæ—¥å¿—æ ¼å¼**ï¼šå‡å°‘è§£æé”™è¯¯
- **æµ‹è¯•é…ç½®**ï¼šé¿å…ç”Ÿäº§ç¯å¢ƒé—®é¢˜
- **å»ºç«‹æ£€æŸ¥æµç¨‹**ï¼šå®šæœŸéªŒè¯æ•°æ®è´¨é‡

**ğŸ¯ æ’æŸ¥æŠ€å·§**
- **åˆ†å±‚æ’æŸ¥**ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œä»å¤–å±‚åˆ°å†…å±‚
- **å¯¹æ¯”åˆ†æ**ï¼šæ­£å¸¸æ—¶æœŸvsé—®é¢˜æ—¶æœŸçš„æ•°æ®å¯¹æ¯”
- **å·¥å…·ç»“åˆ**ï¼šå¤šç§å·¥å…·äº¤å‰éªŒè¯
- **è®°å½•é—®é¢˜**ï¼šå»ºç«‹é—®é¢˜åº“ï¼Œç§¯ç´¯ç»éªŒ

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æ˜¯è¿ç»´çš„"é˜²ç«å¢™"ï¼Œé¢„é˜²èƒœäºæ²»ç–—
- æ’æŸ¥é—®é¢˜è¦æœ‰ç« æ³•ï¼Œåˆ†å±‚åˆ†æ­¥éª¤ï¼Œä¸èƒ½ç›²ç›®çŒœæµ‹
- å·¥å…·æ˜¯è¾…åŠ©ï¼Œæ€è·¯æ˜¯å…³é”®ï¼Œç»éªŒæ˜¯è´¢å¯Œ
- é¢„é˜²é…ç½®æ¯”äº‹åæ’æŸ¥æ›´é‡è¦ï¼Œè§„èŒƒèƒœäºè¡¥æ•‘