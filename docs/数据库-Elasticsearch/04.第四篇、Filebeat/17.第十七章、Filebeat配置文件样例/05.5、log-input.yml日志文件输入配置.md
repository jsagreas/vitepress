---
title: 5ã€log-input.ymlæ—¥å¿—æ–‡ä»¶è¾“å…¥é…ç½®
---
## ğŸ“š ç›®å½•

1. [Filebeatæ—¥å¿—æ–‡ä»¶è¾“å…¥åŸºç¡€](#1-filebeatæ—¥å¿—æ–‡ä»¶è¾“å…¥åŸºç¡€)
2. [åŸºç¡€æ—¥å¿—æ–‡ä»¶æ”¶é›†é…ç½®](#2-åŸºç¡€æ—¥å¿—æ–‡ä»¶æ”¶é›†é…ç½®)
3. [å¤šè·¯å¾„é€šé…ç¬¦é…ç½®ç¤ºä¾‹](#3-å¤šè·¯å¾„é€šé…ç¬¦é…ç½®ç¤ºä¾‹)
4. [å¤šè¡Œæ—¥å¿—åˆå¹¶é…ç½®](#4-å¤šè¡Œæ—¥å¿—åˆå¹¶é…ç½®)
5. [æ–‡ä»¶ç¼–ç ä¸å­—ç¬¦é›†å¤„ç†](#5-æ–‡ä»¶ç¼–ç ä¸å­—ç¬¦é›†å¤„ç†)
6. [åŒ…å«æ’é™¤è¡Œè¿‡æ»¤é…ç½®](#6-åŒ…å«æ’é™¤è¡Œè¿‡æ»¤é…ç½®)
7. [æ–‡ä»¶çŠ¶æ€ç®¡ç†é…ç½®](#7-æ–‡ä»¶çŠ¶æ€ç®¡ç†é…ç½®)
8. [æ‰«æé¢‘ç‡ä¸æ€§èƒ½ä¼˜åŒ–](#8-æ‰«æé¢‘ç‡ä¸æ€§èƒ½ä¼˜åŒ–)
9. [é”™è¯¯å¤„ç†é…ç½®](#9-é”™è¯¯å¤„ç†é…ç½®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“– Filebeatæ—¥å¿—æ–‡ä»¶è¾“å…¥åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Filebeatæ—¥å¿—æ–‡ä»¶è¾“å…¥


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡Filebeatå°±åƒä¸€ä¸ªå‹¤åŠ³çš„"æ–‡ä»¶ç®¡å®¶"ï¼Œå®ƒä¼šå®šæœŸæ£€æŸ¥ä½ æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸€æ—¦å‘ç°æœ‰æ–°å†…å®¹ï¼Œå°±ç«‹å³"è¯»å–"å¹¶"æ¬è¿"åˆ°ä½ æŒ‡å®šçš„åœ°æ–¹ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **Input**ï¼šå‘Šè¯‰Filebeatä»å“ªé‡Œè¯»å–æ•°æ®
- **Log Input**ï¼šä¸“é—¨è´Ÿè´£è¯»å–æ–‡ä»¶çš„è¾“å…¥ç±»å‹
- **æ–‡ä»¶ç›‘æ§**ï¼šå®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œä¸ä¼šé—æ¼æ–°å¢çš„æ—¥å¿—

```
ç®€å•çš„æ•°æ®æµå‘ï¼š
åº”ç”¨ç¨‹åº â†’ å†™å…¥æ—¥å¿—æ–‡ä»¶ â†’ Filebeatè¯»å– â†’ å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿ

å®é™…ä¾‹å­ï¼š
WebæœåŠ¡å™¨ â†’ ç”Ÿæˆaccess.log â†’ Filebeatæ”¶é›† â†’ å‘é€åˆ°Elasticsearch
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—æ–‡ä»¶è¾“å…¥é…ç½®


**ä¸šåŠ¡åœºæ™¯ç†è§£**ï¼š
```
æ²¡æœ‰Filebeatä¹‹å‰ï¼š
è¿ç»´äººå‘˜è¦æŸ¥æ—¥å¿— â†’ ç™»å½•æ¯å°æœåŠ¡å™¨ â†’ æ‰‹åŠ¨æŸ¥çœ‹æ–‡ä»¶ â†’ æ•ˆç‡ä½ä¸‹

æœ‰äº†Filebeatä¹‹åï¼š
æ‰€æœ‰æœåŠ¡å™¨æ—¥å¿— â†’ è‡ªåŠ¨æ”¶é›† â†’ ç»Ÿä¸€å­˜å‚¨ â†’ ä¸€é”®æœç´¢åˆ†æ
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- **ğŸ¯ ç»Ÿä¸€æ”¶é›†**ï¼šå¤šå°æœåŠ¡å™¨çš„æ—¥å¿—é›†ä¸­ç®¡ç†
- **âš¡ å®æ—¶ç›‘æ§**ï¼šæ—¥å¿—äº§ç”Ÿå³æ—¶æ”¶é›†ï¼Œä¸ä¼šé—æ¼
- **ğŸ’ª å¯é ä¼ è¾“**ï¼šç¡®ä¿æ—¥å¿—ä¸ä¸¢å¤±ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
- **ğŸ”§ çµæ´»é…ç½®**ï¼šæ ¹æ®ä¸åŒéœ€æ±‚å®šåˆ¶æ”¶é›†ç­–ç•¥

---

## 2. ğŸš€ åŸºç¡€æ—¥å¿—æ–‡ä»¶æ”¶é›†é…ç½®


### 2.1 æœ€ç®€å•çš„é…ç½®ç¤ºä¾‹


**æ–°æ‰‹å‹å¥½é…ç½®**ï¼š
```yaml
# æœ€åŸºç¡€çš„æ—¥å¿—æ”¶é›†é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/app.log    # æŒ‡å®šè¦æ”¶é›†çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„

output.elasticsearch:
  hosts: ["localhost:9200"]

# è®¾ç½®æ—¥å¿—çº§åˆ«
logging.level: info
```

**é…ç½®è§£é‡Š**ï¼š
- `type: log`ï¼šå£°æ˜è¿™æ˜¯ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶è¾“å…¥
- `enabled: true`ï¼šå¯ç”¨è¿™ä¸ªè¾“å…¥é…ç½®
- `paths`ï¼šå‘Šè¯‰Filebeatè¦ç›‘æ§å“ªä¸ªæ–‡ä»¶

### 2.2 å®ç”¨çš„åŸºç¡€é…ç½®æ¨¡æ¿


```yaml
# 05-basic-log-input.yml
filebeat.inputs:
- type: log
  enabled: true
  
  # æ–‡ä»¶è·¯å¾„é…ç½®
  paths:
    - /var/log/nginx/access.log
    - /var/log/nginx/error.log
  
  # ä¸ºè¿™äº›æ—¥å¿—æ·»åŠ æ ‡è¯†å­—æ®µ
  fields:
    service: nginx
    environment: production
    server_name: web-01
  
  # å­—æ®µæ·»åŠ åˆ°æ ¹çº§åˆ«
  fields_under_root: true

# è¾“å‡ºåˆ°Elasticsearch
output.elasticsearch:
  hosts: ["192.168.1.100:9200"]
  index: "nginx-logs-%{+yyyy.MM.dd}"

# å¤„ç†å™¨é…ç½®ï¼ˆé¢„å¤„ç†æ—¥å¿—ï¼‰
processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
```

**é…ç½®è¦ç‚¹è¯´æ˜**ï¼š

| é…ç½®é¡¹ | **ä½œç”¨** | **æ–°æ‰‹ç†è§£** |
|-------|----------|-------------|
| `paths` | `æŒ‡å®šæ–‡ä»¶è·¯å¾„` | `å‘Šè¯‰Filebeatå»å“ªé‡Œæ‰¾æ—¥å¿—æ–‡ä»¶` |
| `fields` | `æ·»åŠ è‡ªå®šä¹‰å­—æ®µ` | `ç»™æ—¥å¿—è´´æ ‡ç­¾ï¼Œæ–¹ä¾¿åç»­æŸ¥æ‰¾` |
| `fields_under_root` | `å­—æ®µä½ç½®æ§åˆ¶` | `å†³å®šæ ‡ç­¾æ”¾åœ¨æ—¥å¿—çš„ä»€ä¹ˆä½ç½®` |
| `processors` | `æ•°æ®é¢„å¤„ç†` | `åœ¨å‘é€å‰å¯¹æ—¥å¿—è¿›è¡ŒåŠ å·¥å¤„ç†` |

---

## 3. ğŸ—‚ï¸ å¤šè·¯å¾„é€šé…ç¬¦é…ç½®ç¤ºä¾‹


### 3.1 é€šé…ç¬¦çš„åŸºæœ¬ç”¨æ³•


**é€šé…ç¬¦æ¦‚å¿µ**ï¼šå°±åƒWindowsç³»ç»Ÿä¸­æœç´¢æ–‡ä»¶æ—¶ç”¨çš„`*`å·ï¼Œå¯ä»¥åŒ¹é…å¤šä¸ªæ–‡ä»¶ã€‚

```
é€šé…ç¬¦ç¬¦å·å«ä¹‰ï¼š
* ï¼šåŒ¹é…ä»»æ„å­—ç¬¦
? ï¼šåŒ¹é…å•ä¸ªå­—ç¬¦
[] ï¼šåŒ¹é…æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦
```

### 3.2 å¸¸ç”¨é€šé…ç¬¦é…ç½®ç¤ºä¾‹


```yaml
# å¤šè·¯å¾„é€šé…ç¬¦é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    # æ”¶é›†æ‰€æœ‰nginxæ—¥å¿—æ–‡ä»¶
    - /var/log/nginx/*.log
    
    # æ”¶é›†æŒ‰æ—¥æœŸå‘½åçš„æ—¥å¿—æ–‡ä»¶
    - /var/log/app/app-*.log
    
    # æ”¶é›†å¤šçº§ç›®å½•ä¸‹çš„æ—¥å¿—
    - /var/log/*/error.log
    
    # æ”¶é›†ç‰¹å®šæ ¼å¼çš„æ—¥å¿—æ–‡ä»¶
    - /var/log/application/app-[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9].log
  
  # æ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶
  exclude_files: 
    - '\.gz$'          # æ’é™¤å‹ç¼©æ–‡ä»¶
    - '\.zip$'         # æ’é™¤zipæ–‡ä»¶
    - 'debug\.log$'    # æ’é™¤debugæ—¥å¿—
```

### 3.3 å¤æ‚åœºæ™¯çš„é€šé…ç¬¦é…ç½®


```yaml
# å¤æ‚çš„å¤šåº”ç”¨æ—¥å¿—æ”¶é›†
filebeat.inputs:
# æ”¶é›†WebæœåŠ¡å™¨æ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/nginx/access*.log
    - /var/log/apache2/access*.log
  fields:
    log_type: web_access
    
# æ”¶é›†åº”ç”¨ç¨‹åºæ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/app-*/application.log
    - /var/log/service-*/service.log
  fields:
    log_type: application
    
# æ”¶é›†ç³»ç»Ÿæ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/syslog
    - /var/log/messages
  fields:
    log_type: system
```

**è·¯å¾„åŒ¹é…ç¤ºä¾‹**ï¼š
```
é…ç½®ï¼š/var/log/app-*/application.log
åŒ¹é…æ–‡ä»¶ï¼š
âœ… /var/log/app-web/application.log
âœ… /var/log/app-api/application.log
âœ… /var/log/app-worker/application.log
âŒ /var/log/app/application.log (ç¼ºå°‘-åç¼€)
```

---

## 4. ğŸ“ å¤šè¡Œæ—¥å¿—åˆå¹¶é…ç½®


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šè¡Œåˆå¹¶


**é—®é¢˜åœºæ™¯**ï¼š
```
Javaå¼‚å¸¸æ—¥å¿—é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š
2024-01-20 10:30:15 ERROR Exception occurred
    at com.example.service.UserService.getUser(UserService.java:45)
    at com.example.controller.UserController.getUser(UserController.java:23)
    at java.base/java.lang.reflect.Method.invoke(Method.java:566)

å¦‚æœä¸åšå¤šè¡Œåˆå¹¶ï¼ŒFilebeatä¼šæŠŠæ¯ä¸€è¡Œå½“ä½œç‹¬ç«‹çš„æ—¥å¿—äº‹ä»¶ï¼Œ
è¿™æ ·å¼‚å¸¸ä¿¡æ¯å°±è¢«æ‹†æ•£äº†ï¼Œæ— æ³•å®Œæ•´åˆ†æã€‚
```

### 4.2 åŸºç¡€å¤šè¡Œåˆå¹¶é…ç½®


```yaml
# å¤šè¡Œæ—¥å¿—åˆå¹¶é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/application.log
  
  # å¤šè¡Œé…ç½®
  multiline.type: pattern
  multiline.pattern: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'  # æ—¶é—´æˆ³æ ¼å¼
  multiline.negate: true        # å–ååŒ¹é…
  multiline.match: after       # åˆå¹¶åˆ°å‰ä¸€è¡Œä¹‹å
  multiline.max_lines: 500     # æœ€å¤§è¡Œæ•°é™åˆ¶
  multiline.timeout: 5s        # è¶…æ—¶æ—¶é—´
```

**é…ç½®è§£é‡Š**ï¼š
- `pattern`ï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®šä¹‰ä»€ä¹ˆæ˜¯"æ–°æ—¥å¿—"çš„å¼€å§‹
- `negate: true`ï¼šè¡¨ç¤º"ä¸åŒ¹é…patternçš„è¡Œ"è¦åˆå¹¶
- `match: after`ï¼šä¸åŒ¹é…çš„è¡Œåˆå¹¶åˆ°åŒ¹é…è¡Œçš„åé¢

### 4.3 å¸¸è§æ—¥å¿—æ ¼å¼çš„å¤šè¡Œé…ç½®


```yaml
# Javaå¼‚å¸¸æ—¥å¿—åˆå¹¶
- type: log
  paths: ["/var/log/java-app.log"]
  multiline.type: pattern
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'    # åŒ¹é…æ—¥æœŸå¼€å¤´
  multiline.negate: true
  multiline.match: after
  fields:
    app_type: java

# Pythonå¼‚å¸¸æ—¥å¿—åˆå¹¶  
- type: log
  paths: ["/var/log/python-app.log"]
  multiline.type: pattern
  multiline.pattern: '^Traceback'             # åŒ¹é…Tracebackå¼€å¤´
  multiline.negate: false                     # ç›´æ¥åŒ¹é…
  multiline.match: after
  fields:
    app_type: python

# Nginxé”™è¯¯æ—¥å¿—åˆå¹¶
- type: log
  paths: ["/var/log/nginx/error.log"]
  multiline.type: pattern
  multiline.pattern: '^\d{4}/\d{2}/\d{2}'    # åŒ¹é…nginxæ—¶é—´æ ¼å¼
  multiline.negate: true
  multiline.match: after
  fields:
    app_type: nginx
```

### 4.4 å¤šè¡Œåˆå¹¶é…ç½®å¯¹æ¯”è¡¨


| åº”ç”¨ç±»å‹ | **Patternæ¨¡å¼** | **Negateè®¾ç½®** | **é€‚ç”¨åœºæ™¯** |
|---------|----------------|---------------|-------------|
| **Javaåº”ç”¨** | `^\d{4}-\d{2}-\d{2}` | `true` | `æ ‡å‡†æ—¶é—´æˆ³å¼€å¤´çš„æ—¥å¿—` |
| **Pythonåº”ç”¨** | `^Traceback` | `false` | `å¼‚å¸¸æ ˆä¿¡æ¯åˆå¹¶` |
| **IISæ—¥å¿—** | `^\d{4}-\d{2}-\d{2}` | `true` | `Windows IISæœåŠ¡å™¨æ—¥å¿—` |
| **è‡ªå®šä¹‰åº”ç”¨** | `^\[INFO\|ERROR\|WARN\]` | `true` | `è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«æ ¼å¼` |

---

## 5. ğŸ”¤ æ–‡ä»¶ç¼–ç ä¸å­—ç¬¦é›†å¤„ç†


### 5.1 ç¼–ç é—®é¢˜çš„å¸¸è§åœºæ™¯


**å®é™…é—®é¢˜**ï¼š
```
ä¸­æ–‡æ—¥å¿—æ˜¾ç¤ºä¹±ç ï¼š
åŸå§‹å†…å®¹ï¼šç”¨æˆ·ç™»å½•æˆåŠŸ
æ˜¾ç¤ºç»“æœï¼šç”¨æˆ·ç™»å½•æˆåŠŸ  (å‡ºç°ä¹±ç )

åŸå› ï¼šæ–‡ä»¶ç¼–ç ä¸Filebeatè¯»å–ç¼–ç ä¸åŒ¹é…
```

### 5.2 ç¼–ç é…ç½®ç¤ºä¾‹


```yaml
# æ–‡ä»¶ç¼–ç é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/chinese-app.log
  
  # æŒ‡å®šæ–‡ä»¶ç¼–ç 
  encoding: utf-8              # æœ€å¸¸ç”¨çš„ç¼–ç 
  
  # å…¶ä»–ç¼–ç ç¤ºä¾‹
  # encoding: gbk              # ä¸­æ–‡Windowsç³»ç»Ÿå¸¸ç”¨
  # encoding: gb2312           # ç®€ä½“ä¸­æ–‡ç¼–ç 
  # encoding: big5             # ç¹ä½“ä¸­æ–‡ç¼–ç 
  # encoding: iso-8859-1       # è¥¿æ¬§å­—ç¬¦ç¼–ç 
  
  fields:
    charset: utf8
```

### 5.3 ä¸åŒç³»ç»Ÿçš„ç¼–ç é…ç½®


```yaml
# Windowsç³»ç»Ÿä¸­æ–‡æ—¥å¿—
- type: log
  paths: ["C:\\logs\\app.log"]
  encoding: gbk                # Windowsä¸­æ–‡ç³»ç»Ÿé»˜è®¤ç¼–ç 
  fields:
    os_type: windows
    
# Linuxç³»ç»Ÿä¸­æ–‡æ—¥å¿—  
- type: log
  paths: ["/var/log/app.log"]
  encoding: utf-8              # Linuxç³»ç»Ÿé»˜è®¤UTF-8
  fields:
    os_type: linux
    
# æ—§ç³»ç»Ÿå…¼å®¹é…ç½®
- type: log
  paths: ["/legacy/system.log"]
  encoding: gb2312             # è€ç³»ç»Ÿå¯èƒ½ç”¨GB2312
  fields:
    system_type: legacy
```

**ç¼–ç é€‰æ‹©æŒ‡å—**ï¼š
```
ğŸ”¸ ç°ä»£åº”ç”¨ï¼šä½¿ç”¨ utf-8
ğŸ”¸ Windowsä¸­æ–‡ï¼šä½¿ç”¨ gbk æˆ– gb2312  
ğŸ”¸ ç‰¹æ®Šå­—ç¬¦ï¼šæ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©
ğŸ”¸ ä¸ç¡®å®šæ—¶ï¼šå…ˆç”¨ utf-8 è¯•è¯•
```

---

## 6. ğŸ” åŒ…å«æ’é™¤è¡Œè¿‡æ»¤é…ç½®


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦è¡Œè¿‡æ»¤


**å®é™…éœ€æ±‚**ï¼š
```
æ—¥å¿—æ–‡ä»¶å¾ˆå¤§ï¼Œä½†æˆ‘ä»¬åªå…³å¿ƒï¼š
âœ… ERRORçº§åˆ«çš„é”™è¯¯ä¿¡æ¯
âœ… ç™»å½•ç›¸å…³çš„æ“ä½œæ—¥å¿—
âŒ DEBUGè°ƒè¯•ä¿¡æ¯ï¼ˆå¤ªå¤šå¤ªæ‚ï¼‰
âŒ å¥åº·æ£€æŸ¥æ—¥å¿—ï¼ˆæ²¡æœ‰åˆ†æä»·å€¼ï¼‰

é€šè¿‡è¿‡æ»¤ï¼Œå¯ä»¥ï¼š
- å‡å°‘ç½‘ç»œä¼ è¾“é‡
- é™ä½å­˜å‚¨æˆæœ¬  
- æé«˜æŸ¥è¯¢æ•ˆç‡
```

### 6.2 åŒ…å«è¡Œè¿‡æ»¤é…ç½®


```yaml
# åªæ”¶é›†åŒ…å«ç‰¹å®šå†…å®¹çš„æ—¥å¿—è¡Œ
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/application.log
  
  # åªæ”¶é›†åŒ…å«è¿™äº›å…³é”®è¯çš„è¡Œ
  include_lines: 
    - 'ERROR'           # åŒ…å«ERRORçš„è¡Œ
    - 'FATAL'           # åŒ…å«FATALçš„è¡Œ
    - 'login'           # åŒ…å«loginçš„è¡Œ
    - 'authentication'  # åŒ…å«authenticationçš„è¡Œ
  
  fields:
    filter_type: error_and_auth
```

### 6.3 æ’é™¤è¡Œè¿‡æ»¤é…ç½®


```yaml
# æ’é™¤ä¸éœ€è¦çš„æ—¥å¿—è¡Œ
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/application.log
  
  # æ’é™¤è¿™äº›ä¸éœ€è¦çš„è¡Œ
  exclude_lines:
    - '^DEBUG'          # æ’é™¤DEBUGå¼€å¤´çš„è¡Œ
    - 'health-check'    # æ’é™¤å¥åº·æ£€æŸ¥æ—¥å¿—
    - 'heartbeat'       # æ’é™¤å¿ƒè·³æ—¥å¿—
    - '200 OK'          # æ’é™¤æˆåŠŸå“åº”æ—¥å¿—
  
  fields:
    filter_type: exclude_noise
```

### 6.4 å¤åˆè¿‡æ»¤é…ç½®ç¤ºä¾‹


```yaml
# å¤æ‚çš„è¿‡æ»¤è§„åˆ™ç»„åˆ
filebeat.inputs:
# åªæ”¶é›†é”™è¯¯æ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/app-error.log
  include_lines:
    - 'ERROR|FATAL|CRITICAL'    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
  exclude_lines:
    - 'test.*ERROR'             # æ’é™¤æµ‹è¯•ç›¸å…³çš„é”™è¯¯
  fields:
    log_category: errors_only

# æ”¶é›†ä¸šåŠ¡æ—¥å¿—ï¼Œæ’é™¤ç³»ç»Ÿæ—¥å¿—
- type: log
  enabled: true  
  paths:
    - /var/log/business.log
  include_lines:
    - 'user_action:'            # ç”¨æˆ·æ“ä½œæ—¥å¿—
    - 'transaction:'            # äº¤æ˜“ç›¸å…³æ—¥å¿—
    - 'order:'                  # è®¢å•ç›¸å…³æ—¥å¿—
  exclude_lines:
    - 'system_monitor'          # æ’é™¤ç³»ç»Ÿç›‘æ§
    - 'gc_info'                 # æ’é™¤GCä¿¡æ¯
  fields:
    log_category: business_only
```

### 6.5 è¿‡æ»¤è§„åˆ™é…ç½®æŠ€å·§


**æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹**ï¼š
```yaml
# é«˜çº§è¿‡æ»¤æŠ€å·§
include_lines:
  - '^2024.*ERROR'              # 2024å¹´çš„é”™è¯¯æ—¥å¿—
  - 'user_id:\s*\d+'           # åŒ…å«ç”¨æˆ·IDçš„æ—¥å¿—
  - '\[ERROR\]|\[FATAL\]'      # ERRORæˆ–FATALçº§åˆ«
  - 'status:\s*[45]\d{2}'      # HTTP 4xxæˆ–5xxçŠ¶æ€ç 

exclude_lines:
  - '^\s*$'                    # æ’é™¤ç©ºè¡Œ
  - '^#'                       # æ’é™¤æ³¨é‡Šè¡Œ
  - 'localhost.*200'           # æ’é™¤æœ¬åœ°æˆåŠŸè¯·æ±‚
  - 'GET.*\.(css|js|png|jpg)'  # æ’é™¤é™æ€èµ„æºè¯·æ±‚
```

---

## 7. ğŸ’¾ æ–‡ä»¶çŠ¶æ€ç®¡ç†é…ç½®


### 7.1 æ–‡ä»¶çŠ¶æ€ç®¡ç†çš„é‡è¦æ€§


**é—®é¢˜åœºæ™¯**ï¼š
```
æœåŠ¡å™¨é‡å¯åï¼Œå¦‚æœFilebeatä¸è®°ä½ä¹‹å‰è¯»å–çš„ä½ç½®ï¼š
âŒ å¯èƒ½é‡å¤å‘é€å·²ç»å¤„ç†è¿‡çš„æ—¥å¿—
âŒ å¯èƒ½é—æ¼é‡å¯æœŸé—´äº§ç”Ÿçš„æ—¥å¿—
âœ… é€šè¿‡çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿æ¯æ¡æ—¥å¿—åªå‘é€ä¸€æ¬¡
```

**çŠ¶æ€ç®¡ç†åŸç†**ï¼š
```
Filebeatè¿è¡Œæµç¨‹ï¼š
1. è¯»å–æ–‡ä»¶ â†’ è®°å½•è¯»å–ä½ç½®
2. å‘é€æ—¥å¿— â†’ æ›´æ–°çŠ¶æ€ä¿¡æ¯  
3. é‡å¯å â†’ ä»ä¸Šæ¬¡ä½ç½®ç»§ç»­è¯»å–
```

### 7.2 åŸºç¡€çŠ¶æ€ç®¡ç†é…ç½®


```yaml
# æ–‡ä»¶çŠ¶æ€ç®¡ç†é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/application.log
  
  # æ–‡ä»¶çŠ¶æ€ç›¸å…³é…ç½®
  close_inactive: 5m           # 5åˆ†é’Ÿæ— æ´»åŠ¨åˆ™å…³é—­æ–‡ä»¶å¥æŸ„
  close_removed: true          # æ–‡ä»¶è¢«åˆ é™¤æ—¶å…³é—­
  close_renamed: true          # æ–‡ä»¶è¢«é‡å‘½åæ—¶å…³é—­
  clean_inactive: 24h          # 24å°æ—¶åæ¸…ç†inactiveæ–‡ä»¶çŠ¶æ€
  clean_removed: true          # æ¸…ç†å·²åˆ é™¤æ–‡ä»¶çš„çŠ¶æ€
  
  # é‡å¤æ•°æ®å¤„ç†
  ignore_older: 24h            # å¿½ç•¥24å°æ—¶å‰çš„æ–‡ä»¶
  
  fields:
    state_management: enabled
```

**é…ç½®è§£é‡Š**ï¼š
- `close_inactive`ï¼šå¤šä¹…æ²¡æœ‰æ–°æ•°æ®å°±å…³é—­æ–‡ä»¶
- `close_removed`ï¼šæ–‡ä»¶è¢«åˆ é™¤æ—¶æ˜¯å¦å…³é—­
- `clean_inactive`ï¼šå¤šä¹…åæ¸…ç†æ–‡ä»¶çŠ¶æ€ä¿¡æ¯
- `ignore_older`ï¼šå¿½ç•¥å¤šä¹…ä¹‹å‰çš„æ—§æ–‡ä»¶

### 7.3 æ—¥å¿—è½®è½¬åœºæ™¯çš„çŠ¶æ€ç®¡ç†


```yaml
# é’ˆå¯¹æ—¥å¿—è½®è½¬çš„çŠ¶æ€ç®¡ç†
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/app.log          # å½“å‰æ—¥å¿—æ–‡ä»¶
    - /var/log/app.log.*        # è½®è½¬åçš„æ—¥å¿—æ–‡ä»¶
  
  # æ—¥å¿—è½®è½¬å¤„ç†é…ç½®
  close_inactive: 1m           # è½®è½¬åå¿«é€Ÿå…³é—­æ—§æ–‡ä»¶
  close_removed: true          # æ–‡ä»¶åˆ é™¤æ—¶å…³é—­
  close_renamed: true          # æ–‡ä»¶é‡å‘½åæ—¶å…³é—­
  close_eof: false             # è¯»åˆ°æ–‡ä»¶æœ«å°¾ä¸å…³é—­ï¼ˆç­‰å¾…æ–°æ•°æ®ï¼‰
  
  # æ‰«ææ§åˆ¶
  scan_frequency: 10s          # æ¯10ç§’æ‰«æä¸€æ¬¡æ–°æ–‡ä»¶
  
  # çŠ¶æ€æ¸…ç†
  clean_inactive: 12h          # 12å°æ—¶åæ¸…ç†çŠ¶æ€
  clean_removed: true          # è‡ªåŠ¨æ¸…ç†å·²åˆ é™¤æ–‡ä»¶çŠ¶æ€
```

### 7.4 é«˜å¹¶å‘åœºæ™¯çš„çŠ¶æ€ä¼˜åŒ–


```yaml
# é«˜å¹¶å‘åœºæ™¯ä¼˜åŒ–é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/high-traffic/*.log
  
  # æ€§èƒ½ä¼˜åŒ–é…ç½®
  harvester_buffer_size: 65536  # 64KBç¼“å†²åŒºï¼ˆé»˜è®¤16KBï¼‰
  max_bytes: 10485760          # å•è¡Œæœ€å¤§10MB
  backoff: 1s                  # æ–‡ä»¶æ— æ•°æ®æ—¶ç­‰å¾…æ—¶é—´
  max_backoff: 10s             # æœ€å¤§ç­‰å¾…æ—¶é—´
  backoff_factor: 2            # ç­‰å¾…æ—¶é—´é€’å¢å› å­
  
  # æ–‡ä»¶å¥æŸ„ç®¡ç†
  close_inactive: 30s          # é«˜å¹¶å‘ä¸‹å¿«é€Ÿå…³é—­
  max_harvester: 0             # ä¸é™åˆ¶harvesteræ•°é‡
```

---

## 8. âš¡ æ‰«æé¢‘ç‡ä¸æ€§èƒ½ä¼˜åŒ–


### 8.1 æ‰«æé¢‘ç‡çš„ä½œç”¨æœºåˆ¶


**æ‰«æé¢‘ç‡æ¦‚å¿µ**ï¼šFilebeatå¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡æ–‡ä»¶æ˜¯å¦æœ‰æ–°å†…å®¹ï¼Œå°±åƒè®¾ç½®é—¹é’Ÿæé†’è‡ªå·±æŸ¥çœ‹é‚®ç®±ä¸€æ ·ã€‚

```
æ‰«æé¢‘ç‡å½±å“ï¼š
é¢‘ç‡é«˜ï¼ˆå¦‚1ç§’ï¼‰ï¼š
âœ… å®æ—¶æ€§å¥½ï¼Œæ–°æ—¥å¿—å¿«é€Ÿå‘ç°
âŒ CPUå ç”¨é«˜ï¼Œç³»ç»Ÿè´Ÿè½½å¤§

é¢‘ç‡ä½ï¼ˆå¦‚60ç§’ï¼‰ï¼š
âœ… ç³»ç»Ÿè´Ÿè½½ä½ï¼Œèµ„æºå ç”¨å°‘  
âŒ å®æ—¶æ€§å·®ï¼Œå¯èƒ½å»¶è¿Ÿè¾ƒå¤§
```

### 8.2 æ‰«æé¢‘ç‡é…ç½®ç¤ºä¾‹


```yaml
# ä¸åŒåœºæ™¯çš„æ‰«æé¢‘ç‡é…ç½®
filebeat.inputs:
# å®æ—¶ç›‘æ§åœºæ™¯ï¼ˆå¦‚é”™è¯¯æ—¥å¿—ï¼‰
- type: log
  enabled: true
  paths:
    - /var/log/critical-errors.log
  scan_frequency: 1s           # 1ç§’æ‰«æä¸€æ¬¡ï¼Œå¿«é€Ÿå‘ç°é—®é¢˜
  fields:
    priority: critical
    
# ä¸€èˆ¬ä¸šåŠ¡æ—¥å¿—
- type: log  
  enabled: true
  paths:
    - /var/log/business.log
  scan_frequency: 10s          # 10ç§’æ‰«æï¼Œå¹³è¡¡æ€§èƒ½å’Œå®æ—¶æ€§
  fields:
    priority: normal
    
# å½’æ¡£æ—¥å¿—æˆ–ä½é¢‘æ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/archive/*.log
  scan_frequency: 60s          # 1åˆ†é’Ÿæ‰«æï¼ŒèŠ‚çœèµ„æº
  fields:
    priority: low
```

### 8.3 æ€§èƒ½ä¼˜åŒ–é…ç½®ç»„åˆ


```yaml
# é«˜æ€§èƒ½ä¼˜åŒ–é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/high-volume/*.log
  
  # æ‰«æä¼˜åŒ–
  scan_frequency: 5s           # é€‚ä¸­çš„æ‰«æé¢‘ç‡
  harvester_buffer_size: 65536 # å¢å¤§ç¼“å†²åŒº
  
  # æ‰¹é‡å¤„ç†ä¼˜åŒ–
  max_bytes: 1048576           # 1MBå•è¡Œé™åˆ¶
  backoff: 1s                  # æ–‡ä»¶EOFåç­‰å¾…æ—¶é—´
  max_backoff: 10s             # æœ€å¤§ç­‰å¾…æ—¶é—´
  
  # å†…å­˜ç®¡ç†
  close_inactive: 5m           # 5åˆ†é’Ÿå…³é—­ä¸æ´»è·ƒæ–‡ä»¶
  close_timeout: 0             # ä¸å¼ºåˆ¶å…³é—­è¶…æ—¶
  close_eof: false             # ä¸åœ¨EOFæ—¶å…³é—­

# å…¨å±€æ€§èƒ½é…ç½®
queue.mem:
  events: 4096                 # å†…å­˜é˜Ÿåˆ—å¤§å°
  flush.min_events: 2048       # æœ€å°åˆ·æ–°äº‹ä»¶æ•°
  flush.timeout: 5s            # åˆ·æ–°è¶…æ—¶

output.elasticsearch:
  hosts: ["localhost:9200"]
  bulk_max_size: 1600          # æ‰¹é‡å‘é€å¤§å°
  flush_interval: 1s           # åˆ·æ–°é—´éš”
```

### 8.4 æ€§èƒ½ç›‘æ§é…ç½®


```yaml
# æ€§èƒ½ç›‘æ§å’Œè°ƒè¯•é…ç½®
filebeat.config:
  inputs:
    reload.enabled: true        # å…è®¸çƒ­é‡è½½é…ç½®
    reload.period: 10s          # æ¯10ç§’æ£€æŸ¥é…ç½®å˜åŒ–

# ç›‘æ§é…ç½®
monitoring:
  enabled: true
  elasticsearch:
    hosts: ["localhost:9200"]
    index: ".monitoring-beats"
    
# æ—¥å¿—é…ç½®
logging:
  level: info                   # ç”Ÿäº§ç¯å¢ƒç”¨infoçº§åˆ«
  to_files: true
  files:
    path: /var/log/filebeat
    name: filebeat.log
    keepfiles: 7                # ä¿ç•™7å¤©æ—¥å¿—
    permissions: 0644
```

---

## 9. ğŸ› ï¸ é”™è¯¯å¤„ç†é…ç½®


### 9.1 å¸¸è§é”™è¯¯åœºæ™¯


**å®é™…é‡åˆ°çš„é—®é¢˜**ï¼š
```
1. ç½‘ç»œä¸­æ–­ï¼šElasticsearchä¸å¯è¾¾
2. ç£ç›˜æ»¡äº†ï¼šæ— æ³•å†™å…¥çŠ¶æ€æ–‡ä»¶
3. æƒé™é—®é¢˜ï¼šæ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶
4. ç¼–ç é”™è¯¯ï¼šæ–‡ä»¶ç¼–ç å¯¼è‡´è§£æå¤±è´¥
5. æ–‡ä»¶è¢«é”ï¼šå…¶ä»–ç¨‹åºæ­£åœ¨å†™å…¥æ–‡ä»¶
```

### 9.2 åŸºç¡€é”™è¯¯å¤„ç†é…ç½®


```yaml
# é”™è¯¯å¤„ç†å’Œé‡è¯•é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/application.log
  
  # æ–‡ä»¶è®¿é—®é”™è¯¯å¤„ç†
  ignore_permission_errors: true    # å¿½ç•¥æƒé™é”™è¯¯
  
  # ç¼–ç é”™è¯¯å¤„ç†
  encoding: utf-8
  # é‡åˆ°ç¼–ç é”™è¯¯æ—¶çš„å¤„ç†æ–¹å¼

# è¾“å‡ºé”™è¯¯å¤„ç†
output.elasticsearch:
  hosts: ["localhost:9200"]
  
  # è¿æ¥é”™è¯¯é‡è¯•
  max_retries: 3                   # æœ€å¤§é‡è¯•æ¬¡æ•°
  backoff.init: 1s                 # åˆå§‹é‡è¯•ç­‰å¾…æ—¶é—´
  backoff.max: 60s                 # æœ€å¤§é‡è¯•ç­‰å¾…æ—¶é—´
  
  # æ‰¹é‡é”™è¯¯å¤„ç†
  bulk_max_size: 1600              # æ‰¹é‡å¤§å°
  timeout: 90s                     # è¯·æ±‚è¶…æ—¶æ—¶é—´
```

### 9.3 è¯¦ç»†çš„é”™è¯¯å¤„ç†ç­–ç•¥


```yaml
# å…¨é¢çš„é”™è¯¯å¤„ç†é…ç½®
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/app.log
  
  # æ–‡ä»¶ç›¸å…³é”™è¯¯å¤„ç†
  ignore_permission_errors: true   # å¿½ç•¥æƒé™é”™è¯¯ï¼Œç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶
  encoding: utf-8                  # æŒ‡å®šç¼–ç é¿å…ä¹±ç 
  
  # æ–‡ä»¶ç›‘æ§å¼‚å¸¸å¤„ç†
  close_timeout: 30s               # 30ç§’åå¼ºåˆ¶å…³é—­æ— å“åº”æ–‡ä»¶
  close_on_state_change: true      # çŠ¶æ€å˜åŒ–æ—¶å…³é—­æ–‡ä»¶é‡æ–°æ‰“å¼€

# è¾“å‡ºé”™è¯¯æ¢å¤é…ç½®  
output.elasticsearch:
  hosts: ["primary:9200", "backup:9200"]  # å¤šä¸ªESèŠ‚ç‚¹æ”¯æŒæ•…éšœè½¬ç§»
  
  # è¯¦ç»†çš„é‡è¯•ç­–ç•¥
  max_retries: 5                   # æœ€å¤šé‡è¯•5æ¬¡
  backoff.init: 2s                 # é¦–æ¬¡é‡è¯•ç­‰å¾…2ç§’
  backoff.max: 300s                # æœ€å¤§ç­‰å¾…5åˆ†é’Ÿ
  
  # è¿æ¥å’Œä¼ è¾“é…ç½®
  timeout: 90s                     # è¯·æ±‚è¶…æ—¶90ç§’
  compression_level: 3             # å¯ç”¨å‹ç¼©å‡å°‘ç½‘ç»œé”™è¯¯
  
  # æ‰¹é‡å¤„ç†é”™è¯¯æ§åˆ¶
  bulk_max_size: 1000              # å‡å°æ‰¹é‡å¤§å°é™ä½å¤±è´¥æ¦‚ç‡
  flush_interval: 5s               # 5ç§’å¼ºåˆ¶åˆ·æ–°

# æœ¬åœ°é˜Ÿåˆ—é…ç½®ï¼ˆé¿å…æ•°æ®ä¸¢å¤±ï¼‰
queue.mem:
  events: 8192                     # å¢å¤§å†…å­˜é˜Ÿåˆ—
  flush.min_events: 4096           # æ‰¹é‡åˆ·æ–°é˜ˆå€¼
  flush.timeout: 10s               # åˆ·æ–°è¶…æ—¶
```

### 9.4 é”™è¯¯æ—¥å¿—å’Œç›‘æ§é…ç½®


```yaml
# é”™è¯¯ç›‘æ§å’Œæ—¥å¿—é…ç½®
logging:
  level: warning                   # åªè®°å½•è­¦å‘Šå’Œé”™è¯¯
  selectors: ["*"]                 # è®°å½•æ‰€æœ‰ç»„ä»¶çš„æ—¥å¿—
  to_files: true
  files:
    path: /var/log/filebeat
    name: filebeat.log
    keepfiles: 10                  # ä¿ç•™10ä¸ªæ—¥å¿—æ–‡ä»¶
    permissions: 0644
    rotateeverybytes: 100MB        # 100MBè½®è½¬
    
# åº¦é‡æŒ‡æ ‡ç›‘æ§
http:
  enabled: true                    # å¯ç”¨HTTPç›‘æ§ç«¯ç‚¹
  host: "0.0.0.0"                 # ç›‘å¬æ‰€æœ‰æ¥å£
  port: 5066                      # ç›‘æ§ç«¯å£

# å¤„ç†å™¨é”™è¯¯å¤„ç†
processors:
- add_fields:
    target: error_handling
    fields:
      version: "8.x"
      config_date: "2024-01-20"
      
# å½“å¤„ç†å™¨å‡ºé”™æ—¶ç»§ç»­å¤„ç†
- script:
    lang: javascript
    source: >
      function process(event) {
        try {
          // å¤„ç†é€»è¾‘
          event.Put("processed", true);
        } catch (e) {
          event.Put("process_error", e.message);
        }
      }
```

### 9.5 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


**é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
```yaml
# ç”Ÿäº§ç¯å¢ƒé”™è¯¯å¤„ç†æ£€æŸ¥æ¸…å•
filebeat.inputs:
- type: log
  enabled: true
  paths: ["/var/log/app.log"]
  
  # âœ… æƒé™é”™è¯¯å¤„ç†
  ignore_permission_errors: true
  
  # âœ… ç¼–ç è®¾ç½®
  encoding: utf-8
  
  # âœ… æ–‡ä»¶çŠ¶æ€ç®¡ç†
  close_inactive: 5m
  clean_inactive: 24h
  
  # âœ… æ€§èƒ½é™åˆ¶
  max_bytes: 10485760              # 10MBè¡Œå¤§å°é™åˆ¶
  harvester_buffer_size: 65536     # 64KBç¼“å†²åŒº

# âœ… è¾“å‡ºå®¹é”™é…ç½®
output.elasticsearch:
  hosts: ["es1:9200", "es2:9200"]  # å¤šèŠ‚ç‚¹
  max_retries: 3                   # é‡è¯•æœºåˆ¶
  timeout: 90s                     # åˆç†è¶…æ—¶
  bulk_max_size: 1000              # é€‚ä¸­æ‰¹é‡å¤§å°

# âœ… ç›‘æ§é…ç½®  
logging.level: info                # é€‚å½“æ—¥å¿—çº§åˆ«
http.enabled: true                 # ç›‘æ§æ¥å£
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ—¥å¿—è¾“å…¥ç±»å‹ï¼štype: log æ˜¯æœ€åŸºç¡€çš„æ–‡ä»¶ç›‘æ§æ–¹å¼
ğŸ”¸ è·¯å¾„é…ç½®ï¼špaths æ”¯æŒé€šé…ç¬¦ï¼Œå¯ä»¥çµæ´»åŒ¹é…å¤šä¸ªæ–‡ä»¶
ğŸ”¸ å¤šè¡Œåˆå¹¶ï¼šmultiline é…ç½®è§£å†³å¼‚å¸¸æ—¥å¿—è¢«æ‹†åˆ†çš„é—®é¢˜
ğŸ”¸ ç¼–ç å¤„ç†ï¼šencoding é…ç½®è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜  
ğŸ”¸ è¡Œè¿‡æ»¤ï¼šinclude_lines/exclude_lines å‡å°‘æ— ç”¨æ•°æ®ä¼ è¾“
ğŸ”¸ çŠ¶æ€ç®¡ç†ï¼šç¡®ä¿æ—¥å¿—ä¸é‡å¤ä¸é—æ¼çš„å…³é”®æœºåˆ¶
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ‰«æé¢‘ç‡å’Œç¼“å†²åŒºå¤§å°å½±å“ç³»ç»Ÿæ€§èƒ½
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šé‡è¯•æœºåˆ¶å’Œå®¹é”™é…ç½®ä¿è¯æœåŠ¡ç¨³å®šæ€§
```

### 10.2 å…³é”®é…ç½®é¡¹å¯¹æ¯”


| é…ç½®ç±»åˆ« | **æ ¸å¿ƒå‚æ•°** | **ä½œç”¨æ•ˆæœ** | **å»ºè®®å€¼** |
|---------|-------------|-------------|-----------|
| **åŸºç¡€é…ç½®** | `type/enabled/paths` | `å®šä¹‰è¾“å…¥æº` | `type: log, enabled: true` |
| **æ€§èƒ½é…ç½®** | `scan_frequency` | `æ§åˆ¶æ‰«æé¢‘ç‡` | `5-10ç§’å¹³è¡¡æ€§èƒ½` |
| **å¤šè¡Œåˆå¹¶** | `multiline.pattern` | `åˆå¹¶å¼‚å¸¸æ—¥å¿—` | `æ ¹æ®æ—¶é—´æˆ³æ ¼å¼å®šåˆ¶` |
| **è¿‡æ»¤é…ç½®** | `include/exclude_lines` | `å‡å°‘æ•°æ®é‡` | `è¿‡æ»¤è°ƒè¯•å’Œå¥åº·æ£€æŸ¥` |
| **çŠ¶æ€ç®¡ç†** | `close_inactive` | `æ–‡ä»¶å¥æŸ„ç®¡ç†` | `5åˆ†é’Ÿé€‚ä¸­å€¼` |
| **é”™è¯¯å¤„ç†** | `max_retries` | `æé«˜å¯é æ€§` | `3-5æ¬¡é‡è¯•` |

### 10.3 å®é™…åº”ç”¨åœºæ™¯æŒ‡å¯¼


**ğŸ”¹ WebæœåŠ¡å™¨æ—¥å¿—æ”¶é›†**ï¼š
```yaml
# WebæœåŠ¡å™¨æœ€ä½³å®è·µ
paths: ["/var/log/nginx/*.log"]
exclude_lines: ['200 OK', 'health-check']    # æ’é™¤æˆåŠŸå’Œå¥åº·æ£€æŸ¥
include_lines: ['4\d{2}', '5\d{2}', 'ERROR'] # åªæ”¶é›†é”™è¯¯ç›¸å…³
scan_frequency: 10s                          # 10ç§’æ‰«æé¢‘ç‡
encoding: utf-8                              # ç»Ÿä¸€ç¼–ç 
```

**ğŸ”¹ åº”ç”¨ç¨‹åºå¼‚å¸¸ç›‘æ§**ï¼š
```yaml
# åº”ç”¨å¼‚å¸¸ç›‘æ§é…ç½®
multiline.pattern: '^\d{4}-\d{2}-\d{2}'     # æŒ‰æ—¶é—´æˆ³åˆå¹¶
multiline.negate: true                       # å¼‚å¸¸æ ˆåˆå¹¶
include_lines: ['ERROR', 'FATAL', 'Exception'] # åªæ”¶é›†å¼‚å¸¸
max_bytes: 10485760                          # 10MBå•è¡Œé™åˆ¶
```

**ğŸ”¹ é«˜å¹¶å‘ç³»ç»Ÿä¼˜åŒ–**ï¼š
```yaml
# é«˜å¹¶å‘ä¼˜åŒ–é…ç½®
harvester_buffer_size: 65536                # 64KBç¼“å†²åŒº
bulk_max_size: 1600                         # æ‰¹é‡å‘é€
close_inactive: 1m                          # å¿«é€Ÿå…³é—­æ–‡ä»¶
scan_frequency: 5s                          # è¾ƒå¿«æ‰«æ
```

### 10.4 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


**ğŸ”§ é—®é¢˜1ï¼šä¸­æ–‡æ—¥å¿—ä¹±ç **
```yaml
è§£å†³æ–¹æ¡ˆï¼š
encoding: utf-8          # Linuxç³»ç»Ÿ
encoding: gbk            # Windowsä¸­æ–‡ç³»ç»Ÿ
```

**ğŸ”§ é—®é¢˜2ï¼šå¼‚å¸¸æ—¥å¿—è¢«æ‹†åˆ†**
```yaml
è§£å†³æ–¹æ¡ˆï¼š
multiline.type: pattern
multiline.pattern: '^\d{4}-\d{2}-\d{2}'
multiline.negate: true
multiline.match: after
```

**ğŸ”§ é—®é¢˜3ï¼šç³»ç»Ÿæ€§èƒ½å½±å“å¤§**
```yaml
è§£å†³æ–¹æ¡ˆï¼š
scan_frequency: 30s      # é™ä½æ‰«æé¢‘ç‡
close_inactive: 1m       # å¿«é€Ÿå…³é—­æ–‡ä»¶
harvester_buffer_size: 32768  # é€‚ä¸­ç¼“å†²åŒº
```

**ğŸ”§ é—®é¢˜4ï¼šæ—¥å¿—å‘é€å¤±è´¥**
```yaml
è§£å†³æ–¹æ¡ˆï¼š
max_retries: 5           # å¢åŠ é‡è¯•æ¬¡æ•°
backoff.max: 300s        # å¢å¤§é‡è¯•é—´éš”
timeout: 90s             # åˆç†è¶…æ—¶æ—¶é—´
```

### 10.5 é…ç½®æ¨¡æ¿å¿«é€Ÿå‚è€ƒ


```yaml
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®æ¨¡æ¿
filebeat.inputs:
- type: log
  enabled: true
  paths: ["/var/log/app/*.log"]
  
  # åŸºç¡€é…ç½®
  encoding: utf-8
  scan_frequency: 10s
  
  # å¤šè¡Œåˆå¹¶
  multiline.type: pattern
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after
  
  # è¿‡æ»¤é…ç½®
  exclude_lines: ['^DEBUG', 'health-check']
  
  # çŠ¶æ€ç®¡ç†
  close_inactive: 5m
  clean_inactive: 24h
  ignore_older: 24h
  
  # æ€§èƒ½ä¼˜åŒ–
  harvester_buffer_size: 65536
  max_bytes: 10485760
  
  # é”™è¯¯å¤„ç†
  ignore_permission_errors: true

# è¾“å‡ºé…ç½®
output.elasticsearch:
  hosts: ["es1:9200", "es2:9200"]
  max_retries: 3
  bulk_max_size: 1600
  timeout: 90s

# æ—¥å¿—é…ç½®
logging.level: info
logging.to_files: true
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- æ—¥å¿—è¾“å…¥é…ç½®æ˜¯Filebeatçš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒæŒæ¡åŸºç¡€é…ç½®å³å¯åº”å¯¹å¤§éƒ¨åˆ†åœºæ™¯
- å¤šè¡Œåˆå¹¶å’Œè¡Œè¿‡æ»¤æ˜¯å¤„ç†å¤æ‚æ—¥å¿—çš„å…³é”®æŠ€æœ¯
- æ€§èƒ½ä¼˜åŒ–éœ€è¦åœ¨å®æ—¶æ€§å’Œç³»ç»Ÿè´Ÿè½½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡
- é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†ç¡®ä¿æ•°æ®é‡‡é›†çš„å¯é æ€§
- æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„é…ç½®å‚æ•°ï¼Œé¿å…è¿‡åº¦ä¼˜åŒ–