---
title: 21ã€processors-grok.ymlé…ç½®
---
## ğŸ“š ç›®å½•

1. [Grokå¤„ç†å™¨åŸºç¡€æ¦‚å¿µ](#1-grokå¤„ç†å™¨åŸºç¡€æ¦‚å¿µ)
2. [Grokæ¨¡å¼åŒ¹é…é…ç½®](#2-grokæ¨¡å¼åŒ¹é…é…ç½®)
3. [è‡ªå®šä¹‰æ¨¡å¼å®šä¹‰](#3-è‡ªå®šä¹‰æ¨¡å¼å®šä¹‰)
4. [å¤šæ¨¡å¼åŒ¹é…è®¾ç½®](#4-å¤šæ¨¡å¼åŒ¹é…è®¾ç½®)
5. [å‘½åæ•è·ç»„é…ç½®](#5-å‘½åæ•è·ç»„é…ç½®)
6. [é”™è¯¯å¤„ç†é…ç½®](#6-é”™è¯¯å¤„ç†é…ç½®)
7. [æ€§èƒ½ä¼˜åŒ–è®¾ç½®](#7-æ€§èƒ½ä¼˜åŒ–è®¾ç½®)
8. [å®æˆ˜é…ç½®ç¤ºä¾‹](#8-å®æˆ˜é…ç½®ç¤ºä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Grokå¤„ç†å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Grokå¤„ç†å™¨

**ç®€å•ç†è§£**ï¼šGrokå°±åƒä¸€ä¸ª"æ–‡æœ¬è§£æåŠ©æ‰‹"ï¼Œå®ƒèƒ½æŠŠæ‚ä¹±æ— ç« çš„æ—¥å¿—æ–‡æœ¬å˜æˆç»“æ„åŒ–çš„æ•°æ®ã€‚

```
æƒ³è±¡ä¸€ä¸‹ï¼š
åŸå§‹æ—¥å¿—ï¼š192.168.1.1 - john [10/Oct/2000:13:55:36] "GET /apache_pb.gif HTTP/1.0" 200 2326
â†“ ç»è¿‡Grokå¤„ç†å â†“
{
  "ip": "192.168.1.1",
  "user": "john", 
  "timestamp": "10/Oct/2000:13:55:36",
  "method": "GET",
  "url": "/apache_pb.gif",
  "status": 200,
  "size": 2326
}
```

**Grokçš„ä½œç”¨**ï¼š
- ğŸ”¸ **æ–‡æœ¬è§£æ**ï¼šæŠŠéç»“æ„åŒ–æ–‡æœ¬å˜æˆç»“æ„åŒ–æ•°æ®
- ğŸ”¸ **å­—æ®µæå–**ï¼šä»æ—¥å¿—ä¸­æå–æœ‰ç”¨çš„ä¿¡æ¯
- ğŸ”¸ **æ•°æ®è§„èŒƒ**ï¼šç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼Œä¾¿äºåç»­åˆ†æ
- ğŸ”¸ **æŸ¥è¯¢ä¼˜åŒ–**ï¼šç»“æ„åŒ–æ•°æ®ä¾¿äºæœç´¢å’Œç»Ÿè®¡

### 1.2 Grokåœ¨Filebeatä¸­çš„ä½ç½®

```
æ•°æ®æµå‘å›¾ï¼š
æ—¥å¿—æ–‡ä»¶ â†’ Filebeaté‡‡é›† â†’ Grokå¤„ç†å™¨è§£æ â†’ Elasticsearchå­˜å‚¨ â†’ Kibanaå±•ç¤º

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸå§‹æ—¥å¿—    â”‚ â†’ â”‚   Filebeat   â”‚ â†’ â”‚ Elasticsearchâ”‚ â†’ â”‚   Kibana    â”‚
â”‚ (æ–‡æœ¬æ ¼å¼)   â”‚    â”‚ (Grokå¤„ç†)   â”‚    â”‚ (ç»“æ„å­˜å‚¨)   â”‚    â”‚ (å¯è§†åŒ–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦Grokå¤„ç†å™¨

**ä¸šåŠ¡åœºæ™¯**ï¼š
```
é—®é¢˜ï¼šåŸå§‹æ—¥å¿—éš¾ä»¥åˆ†æ
- æ‰€æœ‰ä¿¡æ¯æ··åœ¨ä¸€è¡Œé‡Œ
- æ— æ³•å¿«é€Ÿæ‰¾åˆ°ç‰¹å®šå­—æ®µ
- ç»Ÿè®¡åˆ†æå›°éš¾

è§£å†³ï¼šGrokç»“æ„åŒ–å¤„ç†
- æ¯ä¸ªå­—æ®µéƒ½æœ‰æ˜ç¡®å«ä¹‰
- å¯ä»¥æŒ‰å­—æ®µæœç´¢å’Œè¿‡æ»¤
- ä¾¿äºç”ŸæˆæŠ¥è¡¨å’Œå›¾è¡¨
```

---

## 2. ğŸ”§ Grokæ¨¡å¼åŒ¹é…é…ç½®


### 2.1 åŸºç¡€æ¨¡å¼é…ç½®

**åŸºæœ¬è¯­æ³•**ï¼š`%{PATTERN:field_name}`

```yaml
# åŸºç¡€Groké…ç½®ç¤ºä¾‹
filebeat.inputs:
- type: log
  paths:
    - /var/log/apache/access.log
  processors:
  - grok:
      # åŒ¹é…Apacheè®¿é—®æ—¥å¿—æ ¼å¼
      patterns:
        - '%{IP:client_ip} %{USER:ident} %{USER:auth} \[%{HTTPDATE:timestamp}\] "%{WORD:method} %{URIPATH:request} HTTP/%{NUMBER:http_version}" %{NUMBER:status_code} %{NUMBER:bytes}'
      # æŒ‡å®šè¦è§£æçš„å­—æ®µ
      field: "message"
      # è§£æå¤±è´¥æ—¶çš„å¤„ç†
      ignore_missing: true
```

**é…ç½®è¯´æ˜**ï¼š
- `patterns`ï¼šå®šä¹‰åŒ¹é…æ¨¡å¼çš„åˆ—è¡¨
- `field`ï¼šæŒ‡å®šè¦è§£æçš„æºå­—æ®µï¼ˆé€šå¸¸æ˜¯messageï¼‰
- `ignore_missing`ï¼šæºå­—æ®µä¸å­˜åœ¨æ—¶æ˜¯å¦å¿½ç•¥é”™è¯¯

### 2.2 å¸¸ç”¨å†…ç½®æ¨¡å¼

| æ¨¡å¼åç§° | **å«ä¹‰** | **ç¤ºä¾‹åŒ¹é…** | **ç”¨é€”** |
|---------|----------|-------------|---------|
| `IP` | IPåœ°å€ | `192.168.1.1` | å®¢æˆ·ç«¯IP |
| `WORD` | å•è¯å­—ç¬¦ | `GET`, `POST` | HTTPæ–¹æ³• |
| `NUMBER` | æ•°å­— | `200`, `404` | çŠ¶æ€ç  |
| `HTTPDATE` | HTTPæ—¥æœŸ | `10/Oct/2000:13:55:36 -0700` | æ—¶é—´æˆ³ |
| `URI` | å®Œæ•´URI | `/path/to/page?param=value` | è¯·æ±‚è·¯å¾„ |
| `QUOTEDSTRING` | å¼•å·å­—ç¬¦ä¸² | `"GET /index.html"` | è¯·æ±‚ä¿¡æ¯ |

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```yaml
processors:
- grok:
    patterns:
      # è§£æNginxè®¿é—®æ—¥å¿—
      - '%{IP:remote_ip} - %{USER:remote_user} \[%{HTTPDATE:time_local}\] "%{WORD:method} %{URIPATH:uri} HTTP/%{NUMBER:http_version}" %{NUMBER:status} %{NUMBER:body_bytes_sent} "%{URI:http_referer}" "%{DATA:http_user_agent}"'
    field: "message"
```

### 2.3 æ¨¡å¼åŒ¹é…é¡ºåº

```yaml
processors:
- grok:
    patterns:
      # ä¼˜å…ˆåŒ¹é…Apacheæ ¼å¼
      - '%{COMMONAPACHELOG}'
      # å…¶æ¬¡åŒ¹é…Nginxæ ¼å¼  
      - '%{NGINXACCESS}'
      # æœ€ååŒ¹é…é€šç”¨æ ¼å¼
      - '%{IP:ip} %{GREEDYDATA:message}'
    field: "message"
    # åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªå°±åœæ­¢
    break_on_match: true
```

**åŒ¹é…åŸåˆ™**ï¼š
- ğŸ”¸ **é¡ºåºæ‰§è¡Œ**ï¼šæŒ‰patternsåˆ—è¡¨é¡ºåºé€ä¸ªå°è¯•
- ğŸ”¸ **é¦–æ¬¡åŒ¹é…**ï¼šæ‰¾åˆ°åŒ¹é…çš„æ¨¡å¼å°±åœæ­¢ï¼ˆå½“break_on_matchä¸ºtrueï¼‰
- ğŸ”¸ **ç²¾ç¡®ä¼˜å…ˆ**ï¼šæŠŠæ›´ç²¾ç¡®çš„æ¨¡å¼æ”¾åœ¨å‰é¢

---

## 3. ğŸ¨ è‡ªå®šä¹‰æ¨¡å¼å®šä¹‰


### 3.1 åˆ›å»ºè‡ªå®šä¹‰æ¨¡å¼

**åŸºæœ¬è¯­æ³•**ï¼š`(?<field_name>æ­£åˆ™è¡¨è¾¾å¼)`

```yaml
processors:
- grok:
    patterns:
      # è‡ªå®šä¹‰æ—¶é—´æ ¼å¼æ¨¡å¼
      - '(?<custom_time>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) \[(?<level>\w+)\] (?<message>.*)'
    field: "message"
```

**å®é™…ç¤ºä¾‹**ï¼šè§£æè‡ªå®šä¹‰åº”ç”¨æ—¥å¿—
```yaml
# åŸå§‹æ—¥å¿—æ ¼å¼ï¼š2023-10-15 14:30:25 [ERROR] Database connection failed: timeout
processors:
- grok:
    patterns:
      - '(?<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) \[(?<log_level>[A-Z]+)\] (?<error_message>.*)'
    field: "message"
```

### 3.2 ä½¿ç”¨æ¨¡å¼æ–‡ä»¶

**åˆ›å»ºæ¨¡å¼æ–‡ä»¶**ï¼š`/etc/filebeat/patterns/custom_patterns`
```
# è‡ªå®šä¹‰æ¨¡å¼å®šä¹‰æ–‡ä»¶
CUSTOM_TIMESTAMP \d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}
LOG_LEVEL (DEBUG|INFO|WARN|ERROR|FATAL)
ERROR_CODE E\d{4}
```

**åœ¨é…ç½®ä¸­å¼•ç”¨**ï¼š
```yaml
processors:
- grok:
    # æŒ‡å®šæ¨¡å¼æ–‡ä»¶è·¯å¾„
    patterns_dir:
      - "/etc/filebeat/patterns"
    patterns:
      # ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å¼
      - '%{CUSTOM_TIMESTAMP:timestamp} \[%{LOG_LEVEL:level}\] %{ERROR_CODE:code}: %{GREEDYDATA:message}'
    field: "message"
```

### 3.3 ç»„åˆæ¨¡å¼å®šä¹‰

```yaml
processors:
- grok:
    patterns:
      # ç»„åˆå¤šä¸ªå°æ¨¡å¼æ„å»ºå¤æ‚æ¨¡å¼
      - '%{IP:client_ip} %{WORD:method} %{URIPATH:path} %{NUMBER:response_time:float}ms'
      # ä½¿ç”¨æ¡ä»¶åŒ¹é…
      - 'user_id=(?<user_id>\d+) action=(?<action>\w+) result=(?<result>success|failed)'
    field: "message"
```

---

## 4. ğŸ”„ å¤šæ¨¡å¼åŒ¹é…è®¾ç½®


### 4.1 å¤šæ¨¡å¼å¹¶è¡Œå¤„ç†

```yaml
processors:
- grok:
    patterns:
      # å¤„ç†ä¸åŒæ ¼å¼çš„æ—¥å¿—
      - 'access_log: %{COMMONAPACHELOG}'
      - 'error_log: \[(?<timestamp>.*?)\] \[(?<level>.*?)\] (?<message>.*)'
      - 'custom_log: (?<app>\w+) (?<severity>\d+) (?<content>.*)'
    field: "message"
    # ä¸åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…ååœæ­¢
    break_on_match: false
```

### 4.2 æ¡ä»¶æ¨¡å¼åŒ¹é…

```yaml
processors:
# æ ¹æ®æ—¥å¿—ç±»å‹é€‰æ‹©ä¸åŒæ¨¡å¼
- if:
    contains:
      message: "access_log"
  then:
  - grok:
      patterns:
        - '%{COMMONAPACHELOG}'
      field: "message"
- if:
    contains:
      message: "error_log"  
  then:
  - grok:
      patterns:
        - '\[(?<timestamp>.*?)\] \[(?<level>.*?)\] (?<error_message>.*)'
      field: "message"
```

### 4.3 fallbackæ¨¡å¼é…ç½®

```yaml
processors:
- grok:
    patterns:
      # ä¸»è¦æ¨¡å¼ï¼šå°è¯•ç²¾ç¡®åŒ¹é…
      - '%{IP:ip} %{USER:user} \[%{HTTPDATE:timestamp}\] "%{WORD:method} %{URIPATH:path} HTTP/%{NUMBER:version}" %{NUMBER:status} %{NUMBER:size}'
      # å¤‡ç”¨æ¨¡å¼ï¼šå®½æ¾åŒ¹é…
      - '%{IP:ip} %{GREEDYDATA:raw_message}'
      # å…œåº•æ¨¡å¼ï¼šæœ€åŸºæœ¬åŒ¹é…
      - '(?<raw_log>.*)'
    field: "message"
    break_on_match: true
```

**åŒ¹é…ç­–ç•¥è¯´æ˜**ï¼š
- ğŸ¯ **ç²¾ç¡®ä¼˜å…ˆ**ï¼šå…ˆå°è¯•æœ€ç²¾ç¡®çš„æ¨¡å¼
- ğŸ”„ **é€æ­¥æ”¾å®½**ï¼šé€æ¸ä½¿ç”¨æ›´å®½æ¾çš„æ¨¡å¼
- ğŸ›¡ï¸ **å…œåº•ä¿éšœ**ï¼šç¡®ä¿æ‰€æœ‰æ—¥å¿—éƒ½èƒ½è¢«å¤„ç†

---

## 5. ğŸ·ï¸ å‘½åæ•è·ç»„é…ç½®


### 5.1 åŸºç¡€å‘½åæ•è·

**è¯­æ³•æ ¼å¼**ï¼š`(?<å­—æ®µå>åŒ¹é…æ¨¡å¼)`

```yaml
processors:
- grok:
    patterns:
      # ç›´æ¥å‘½åæ•è·
      - '(?<client_ip>\d+\.\d+\.\d+\.\d+) - (?<user_name>\w+) \[(?<request_time>[^\]]+)\]'
    field: "message"
```

### 5.2 ç±»å‹è½¬æ¢é…ç½®

```yaml
processors:
- grok:
    patterns:
      - '%{IP:client_ip} %{NUMBER:response_time:float} %{NUMBER:status_code:int} %{WORD:method}'
    field: "message"
    # ç±»å‹è½¬æ¢é…ç½®
    pattern_definitions:
      FLOAT_NUMBER: '(?<response_time>\d+\.\d+)'
      INT_NUMBER: '(?<status_code>\d+)'
```

**æ”¯æŒçš„æ•°æ®ç±»å‹**ï¼š
- `int`ï¼šæ•´æ•°ç±»å‹
- `float`ï¼šæµ®ç‚¹æ•°ç±»å‹
- `boolean`ï¼šå¸ƒå°”ç±»å‹ï¼ˆtrue/falseï¼‰
- é»˜è®¤ä¸ºå­—ç¬¦ä¸²ç±»å‹

### 5.3 åµŒå¥—å­—æ®µæ•è·

```yaml
processors:
- grok:
    patterns:
      # åˆ›å»ºåµŒå¥—ç»“æ„
      - '%{IP:request.client_ip} %{WORD:request.method} %{NUMBER:response.status_code:int} %{NUMBER:response.size:int}'
    field: "message"
```

**ç”Ÿæˆçš„ç»“æ„**ï¼š
```json
{
  "request": {
    "client_ip": "192.168.1.100",
    "method": "GET"
  },
  "response": {
    "status_code": 200,
    "size": 1234
  }
}
```

---

## 6. âš ï¸ é”™è¯¯å¤„ç†é…ç½®


### 6.1 åŸºç¡€é”™è¯¯å¤„ç†

```yaml
processors:
- grok:
    patterns:
      - '%{COMMONAPACHELOG}'
    field: "message"
    # é”™è¯¯å¤„ç†é€‰é¡¹
    ignore_missing: true          # å¿½ç•¥ç¼ºå¤±å­—æ®µ
    overwrite_keys: false         # ä¸è¦†ç›–å·²å­˜åœ¨çš„å­—æ®µ
    tag_on_failure: ["grok_parse_failed"]  # å¤±è´¥æ—¶æ·»åŠ æ ‡ç­¾
```

### 6.2 è¯¦ç»†é”™è¯¯ä¿¡æ¯

```yaml
processors:
- grok:
    patterns:
      - '%{COMMONAPACHELOG}'
    field: "message"
    # ä¿ç•™åŸå§‹æ¶ˆæ¯
    keep_empty_captures: false
    # æ·»åŠ è°ƒè¯•ä¿¡æ¯
    tag_on_failure: 
      - "grok_parse_failed"
      - "_grokparsefailure"
    # å¤±è´¥æ—¶ä¿ç•™åŸå§‹æ•°æ®
    on_failure:
      - set:
          field: "grok.error"
          value: "Pattern matching failed"
```

### 6.3 å¤šçº§é”™è¯¯å¤„ç†

```yaml
processors:
- grok:
    patterns:
      - '%{COMMONAPACHELOG}'
    field: "message"
    tag_on_failure: ["primary_grok_failed"]
    
# å¤‡ç”¨è§£æå™¨
- if:
    contains:
      tags: "primary_grok_failed"
  then:
  - grok:
      patterns:
        - '%{GREEDYDATA:raw_message}'
      field: "message"
      tag_on_failure: ["secondary_grok_failed"]
```

**é”™è¯¯å¤„ç†å±‚æ¬¡**ï¼š
```
ç¬¬ä¸€å±‚ï¼šç²¾ç¡®æ¨¡å¼åŒ¹é…
     â†“ (å¤±è´¥)
ç¬¬äºŒå±‚ï¼šå®½æ¾æ¨¡å¼åŒ¹é…  
     â†“ (å¤±è´¥)
ç¬¬ä¸‰å±‚ï¼šåŸå§‹æ•°æ®ä¿ç•™
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–è®¾ç½®


### 7.1 ç¼“å­˜é…ç½®

```yaml
processors:
- grok:
    patterns:
      - '%{COMMONAPACHELOG}'
    field: "message"
    # å¯ç”¨æ¨¡å¼ç¼“å­˜
    patterns_cache_size: 1000
    # ç¼“å­˜è¿‡æœŸæ—¶é—´
    patterns_cache_ttl: "1h"
```

### 7.2 åŒ¹é…ä¼˜åŒ–

```yaml
processors:
- grok:
    patterns:
      # æŠŠæœ€å¸¸è§çš„æ¨¡å¼æ”¾åœ¨å‰é¢
      - '%{COMMONAPACHELOG}'      # 80%çš„æ—¥å¿—
      - '%{NGINXACCESS}'          # 15%çš„æ—¥å¿—
      - '%{GREEDYDATA:raw}'       # 5%çš„æ—¥å¿—
    field: "message"
    # åŒ¹é…æˆåŠŸåç«‹å³åœæ­¢
    break_on_match: true
```

### 7.3 èµ„æºé™åˆ¶

```yaml
processors:
- grok:
    patterns:
      - '%{COMMONAPACHELOG}'
    field: "message"
    # è®¾ç½®è¶…æ—¶é™åˆ¶
    timeout: "30s"
    # é™åˆ¶æ¨¡å¼å¤æ‚åº¦
    max_pattern_length: 1000
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- ğŸ“Š **ç›‘æ§åŒ¹é…ç‡**ï¼šç»å¸¸æ£€æŸ¥å„ä¸ªæ¨¡å¼çš„åŒ¹é…æˆåŠŸç‡
- ğŸ¯ **ä¼˜åŒ–é¡ºåº**ï¼šæŠŠå¸¸ç”¨æ¨¡å¼æ”¾åœ¨å‰é¢
- ğŸš€ **ç®€åŒ–æ¨¡å¼**ï¼šé¿å…è¿‡äºå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
- ğŸ’¾ **åˆç†ç¼“å­˜**ï¼šæ ¹æ®æ—¥å¿—é‡è°ƒæ•´ç¼“å­˜å¤§å°

---

## 8. ğŸ“ å®æˆ˜é…ç½®ç¤ºä¾‹


### 8.1 Apacheè®¿é—®æ—¥å¿—è§£æ

```yaml
# å®Œæ•´çš„Apacheæ—¥å¿—å¤„ç†é…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/apache2/access.log
  processors:
  - grok:
      patterns:
        # Apache Combinedæ ¼å¼
        - '%{IP:client_ip} %{USER:ident} %{USER:auth} \[%{HTTPDATE:timestamp}\] "%{WORD:method} %{URIPATH:request_path}(?:%{URIPARAM:request_params})? HTTP/%{NUMBER:http_version}" %{NUMBER:status_code:int} %{NUMBER:response_size:int} "%{URI:referrer}" "%{DATA:user_agent}"'
      field: "message"
      ignore_missing: true
      tag_on_failure: ["apache_grok_failed"]
  
  # æ—¶é—´æˆ³å¤„ç†
  - timestamp:
      field: timestamp
      layouts:
        - '02/Jan/2006:15:04:05 -0700'
      test:
        - '25/May/2023:10:30:15 +0000'

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "apache-logs-%{+yyyy.MM.dd}"
```

### 8.2 è‡ªå®šä¹‰åº”ç”¨æ—¥å¿—è§£æ

```yaml
# è§£æJavaåº”ç”¨æ—¥å¿—
filebeat.inputs:
- type: log
  paths:
    - /var/log/myapp/*.log
  processors:
  - grok:
      patterns:
        # Javaåº”ç”¨æ—¥å¿—æ ¼å¼ï¼š2023-10-15 14:30:25.123 [thread-1] ERROR com.example.Service - Database connection failed
        - '(?<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}) \[(?<thread>.*?)\] (?<level>\w+) (?<logger>[\w\.]+) - (?<log_message>.*)'
      field: "message"
      
  # æ·»åŠ åº”ç”¨æ ‡è¯†
  - add_fields:
      target: app
      fields:
        name: "myapp"
        version: "1.0.0"
        
  # é”™è¯¯æ—¥å¿—ç‰¹æ®Šå¤„ç†
  - if:
      equals:
        level: "ERROR"
    then:
    - add_tags:
        tags: ["error", "alert"]
```

### 8.3 å¤šæºæ—¥å¿—ç»Ÿä¸€å¤„ç†

```yaml
# å¤„ç†å¤šç§ä¸åŒæ ¼å¼çš„æ—¥å¿—
filebeat.inputs:
- type: log
  paths:
    - /var/log/*.log
  processors:
  
  # è¯†åˆ«æ—¥å¿—ç±»å‹
  - script:
      lang: javascript
      source: >
        function process(event) {
          var message = event.Get("message");
          if (message.indexOf("access_log") >= 0) {
            event.Put("log_type", "access");
          } else if (message.indexOf("error_log") >= 0) {
            event.Put("log_type", "error");
          } else {
            event.Put("log_type", "unknown");
          }
        }
  
  # æ ¹æ®ç±»å‹é€‰æ‹©è§£æå™¨
  - if:
      equals:
        log_type: "access"
    then:
    - grok:
        patterns:
          - '%{COMMONAPACHELOG}'
        field: "message"
        
  - if:
      equals:
        log_type: "error"
    then:
    - grok:
        patterns:
          - '\[(?<error_time>.*?)\] \[(?<error_level>.*?)\] (?<error_detail>.*)'
        field: "message"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ Grokæœ¬è´¨ï¼šæ–‡æœ¬è§£æå·¥å…·ï¼ŒæŠŠéç»“æ„åŒ–æ—¥å¿—å˜æˆç»“æ„åŒ–æ•°æ®
ğŸ”¸ æ¨¡å¼è¯­æ³•ï¼š%{PATTERN:field_name} æ ¼å¼ï¼Œæ”¯æŒç±»å‹è½¬æ¢
ğŸ”¸ åŒ¹é…é¡ºåºï¼šæŒ‰patternsåˆ—è¡¨é¡ºåºæ‰§è¡Œï¼Œå¯è®¾ç½®break_on_match
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šé€šè¿‡tag_on_failureå’Œignore_missingå¤„ç†å¼‚å¸¸
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šåˆç†æ’åºã€å¯ç”¨ç¼“å­˜ã€è®¾ç½®è¶…æ—¶é™åˆ¶
```

### 9.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ æ¨¡å¼è®¾è®¡åŸåˆ™**
```
ç²¾ç¡®æ€§ï¼šä¼˜å…ˆä½¿ç”¨ç²¾ç¡®åŒ¹é…çš„æ¨¡å¼
ç®€æ´æ€§ï¼šé¿å…è¿‡äºå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼
å¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨æ¨¡å¼æ–‡ä»¶ç®¡ç†å¤æ‚æ¨¡å¼
å¯æ‰©å±•æ€§ï¼šè®¾è®¡æ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼çš„æ¨¡å¼
```

**ğŸ”¹ å®é™…åº”ç”¨å»ºè®®**
```
æµ‹è¯•ä¼˜å…ˆï¼š
- åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯æ¨¡å¼
- ä½¿ç”¨çœŸå®æ—¥å¿—æ•°æ®è¿›è¡Œæµ‹è¯•
- å…³æ³¨åŒ¹é…æˆåŠŸç‡å’Œæ€§èƒ½

ç›‘æ§å…³é”®ï¼š
- ç›‘æ§grokå¤„ç†å¤±è´¥çš„æ—¥å¿—
- æ£€æŸ¥è§£æåå­—æ®µçš„æ•°æ®è´¨é‡
- å…³æ³¨å¤„ç†æ€§èƒ½å’Œèµ„æºæ¶ˆè€—

ç»´æŠ¤ç­–ç•¥ï¼š
- å®šæœŸæ›´æ–°æ¨¡å¼ä»¥é€‚åº”æ—¥å¿—æ ¼å¼å˜åŒ–
- å»ºç«‹æ¨¡å¼åº“ä¾¿äºå¤ç”¨
- æ–‡æ¡£åŒ–æ‰€æœ‰è‡ªå®šä¹‰æ¨¡å¼
```

### 9.3 å¸¸è§é—®é¢˜å¤„ç†


**ğŸ”§ é—®é¢˜æ’æŸ¥æ¸…å•**
- [ ] æ¨¡å¼è¯­æ³•æ˜¯å¦æ­£ç¡®
- [ ] å­—æ®µåæ˜¯å¦ç¬¦åˆå‘½åè§„èŒƒ
- [ ] æ˜¯å¦è®¾ç½®äº†é€‚å½“çš„é”™è¯¯å¤„ç†
- [ ] æ€§èƒ½æ˜¯å¦æ»¡è¶³è¦æ±‚
- [ ] è§£æç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ

**ğŸ’¡ ä¼˜åŒ–å»ºè®®**
- ä½¿ç”¨Kibanaçš„Dev Toolsæµ‹è¯•Grokæ¨¡å¼
- å¯ç”¨Filebeatçš„æ—¥å¿—è°ƒè¯•æ¨¡å¼
- å®šæœŸåˆ†æå¤„ç†å¤±è´¥çš„æ—¥å¿—æ ·æœ¬
- å»ºç«‹æ—¥å¿—æ ¼å¼å˜æ›´é€šçŸ¥æœºåˆ¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- Grokè®©æ··ä¹±æ—¥å¿—å˜ç»“æ„åŒ–æ•°æ®
- æ¨¡å¼åŒ¹é…æŒ‰é¡ºåºï¼Œç²¾ç¡®ä¼˜å…ˆåŸåˆ™
- é”™è¯¯å¤„ç†è¦å®Œå–„ï¼Œæ€§èƒ½ä¼˜åŒ–åˆ«å¿˜è®°
- æµ‹è¯•éªŒè¯æ˜¯å…³é”®ï¼ŒæŒç»­ç›‘æ§ä¿ç¨³å®š