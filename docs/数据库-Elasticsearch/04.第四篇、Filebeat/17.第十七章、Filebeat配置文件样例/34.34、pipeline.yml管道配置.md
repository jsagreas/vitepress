---
title: 34ã€pipeline.ymlç®¡é“é…ç½®
---
## ğŸ“š ç›®å½•

1. [Elasticsearchç®¡é“åŸºç¡€æ¦‚å¿µ](#1-elasticsearchç®¡é“åŸºç¡€æ¦‚å¿µ)
2. [ç®¡é“é…ç½®æ–‡ä»¶ç»“æ„](#2-ç®¡é“é…ç½®æ–‡ä»¶ç»“æ„)
3. [æ•°æ®é¢„å¤„ç†ç®¡é“è¯¦è§£](#3-æ•°æ®é¢„å¤„ç†ç®¡é“è¯¦è§£)
4. [ç®¡é“å¤„ç†å™¨é“¾é…ç½®](#4-ç®¡é“å¤„ç†å™¨é“¾é…ç½®)
5. [æ¡ä»¶ç®¡é“é…ç½®å®æˆ˜](#5-æ¡ä»¶ç®¡é“é…ç½®å®æˆ˜)
6. [ç®¡é“é”™è¯¯å¤„ç†æœºåˆ¶](#6-ç®¡é“é”™è¯¯å¤„ç†æœºåˆ¶)
7. [ç®¡é“æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#7-ç®¡é“æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
8. [ç®¡é“ç›‘æ§ä¸ç‰ˆæœ¬ç®¡ç†](#8-ç®¡é“ç›‘æ§ä¸ç‰ˆæœ¬ç®¡ç†)
9. [å®é™…é…ç½®æ¡ˆä¾‹è¯¦è§£](#9-å®é™…é…ç½®æ¡ˆä¾‹è¯¦è§£)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Elasticsearchç®¡é“åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Elasticsearchç®¡é“


ğŸ¤” **æƒ³è±¡ä¸€ä¸ªç°å®åœºæ™¯**ï¼šä½ å¼€äº†ä¸€å®¶é¢åŒ…åº—ï¼Œæ¯å¤©æ”¶åˆ°å„ç§åŸææ–™ï¼ˆé¢ç²‰ã€é¸¡è›‹ã€ç‰›å¥¶ï¼‰ï¼Œä½ éœ€è¦æŒ‰ç…§ä¸åŒé…æ–¹åŠ å·¥æˆå„ç§é¢åŒ…ã€‚Elasticsearchçš„ç®¡é“å°±åƒè¿™ä¸ªåŠ å·¥æµæ°´çº¿ã€‚

**ğŸ’­ ç®¡é“çš„æœ¬è´¨**ï¼š
```
åŸå§‹æ—¥å¿—æ•°æ® â†’ [ç®¡é“å¤„ç†] â†’ ç»“æ„åŒ–æ•°æ® â†’ å­˜å‚¨åˆ°ES
å°±åƒï¼š
é¢ç²‰é¸¡è›‹ â†’ [é¢åŒ…åˆ¶ä½œæµç¨‹] â†’ æˆå“é¢åŒ… â†’ æ”¾å…¥è´§æ¶
```

**ğŸ·ï¸ ä¸“ä¸šæœ¯è¯­è§£é‡Š**ï¼š
- **Pipelineï¼ˆç®¡é“ï¼‰** = ä¸€å¥—æ•°æ®å¤„ç†æµç¨‹ï¼Œå®šä¹‰äº†æ•°æ®å¦‚ä½•è¢«åŠ å·¥
- **Processorï¼ˆå¤„ç†å™¨ï¼‰** = æµç¨‹ä¸­çš„æ¯ä¸ªæ­¥éª¤ï¼Œæ¯”å¦‚"è§£ææ—¶é—´"ã€"æå–IPåœ°å€"
- **Ingest Nodeï¼ˆæ‘„å–èŠ‚ç‚¹ï¼‰** = ä¸“é—¨è´Ÿè´£è¿è¡Œç®¡é“çš„ESèŠ‚ç‚¹

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç®¡é“


**âŒ æ²¡æœ‰ç®¡é“æ—¶çš„é—®é¢˜**ï¼š
```
åŸå§‹æ—¥å¿—ï¼š[2024-01-15 14:30:25] ERROR User login failed for IP 192.168.1.100
å­˜å‚¨åï¼šå°±æ˜¯è¿™ä¸€æ•´è¡Œæ–‡æœ¬ï¼Œæ— æ³•è¿›è¡Œå¤æ‚æŸ¥è¯¢å’Œåˆ†æ
```

**âœ… æœ‰ç®¡é“å¤„ç†å**ï¼š
```
ç»“æ„åŒ–æ•°æ®ï¼š
{
  "timestamp": "2024-01-15T14:30:25",
  "level": "ERROR", 
  "message": "User login failed",
  "ip_address": "192.168.1.100",
  "event_type": "login_failure"
}
```

ğŸ¯ **ç®¡é“çš„ä»·å€¼**ï¼šè®©åŸæœ¬"ä¸€å›¢ä¹±éº»"çš„æ—¥å¿—å˜æˆ"äº•äº•æœ‰æ¡"çš„ç»“æ„åŒ–æ•°æ®ï¼Œæ–¹ä¾¿åç»­æŸ¥è¯¢ã€ç»Ÿè®¡ã€å‘Šè­¦ã€‚

### 1.3 ç®¡é“åœ¨Filebeatä¸­çš„ä½ç½®


```
æ•°æ®æµå‘å›¾ï¼š
æ—¥å¿—æ–‡ä»¶ â†’ Filebeaté‡‡é›† â†’ [ç®¡é“å¤„ç†] â†’ Elasticsearchå­˜å‚¨ â†’ Kibanaå±•ç¤º

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ—¥å¿—æ–‡ä»¶   â”‚â”€â”€â”€â–¶â”‚   Filebeat   â”‚â”€â”€â”€â–¶â”‚ ES Pipeline â”‚â”€â”€â”€â–¶â”‚ Elasticsearchâ”‚
â”‚ /var/log/*.logâ”‚    â”‚   (é‡‡é›†å™¨)    â”‚    â”‚  (æ•°æ®å¤„ç†)  â”‚    â”‚   (å­˜å‚¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”— çŸ¥è¯†ä¸²è”**ï¼š
- **Filebeat** è´Ÿè´£é‡‡é›†å’Œå‘é€æ•°æ®
- **Pipeline** è´Ÿè´£æ•°æ®é¢„å¤„ç†å’Œè½¬æ¢  
- **Elasticsearch** è´Ÿè´£å­˜å‚¨å’Œç´¢å¼•
- **Kibana** è´Ÿè´£æ•°æ®å¯è§†åŒ–

---

## 2. ğŸ“‹ ç®¡é“é…ç½®æ–‡ä»¶ç»“æ„


### 2.1 ç®¡é“é…ç½®æ–‡ä»¶åŸºæœ¬ç»“æ„


ğŸ’¡ **ç®¡é“é…ç½®å°±åƒèœè°±**ï¼šæ˜ç¡®åˆ—å‡ºå¤„ç†æ­¥éª¤ï¼Œæ¯ä¸€æ­¥åšä»€ä¹ˆï¼Œç”¨ä»€ä¹ˆ"è°ƒæ–™"ï¼ˆå‚æ•°ï¼‰ã€‚

**åŸºç¡€ç»“æ„æ¨¡æ¿**ï¼š
```json
{
  "description": "ç®¡é“ç”¨é€”è¯´æ˜ - ç›¸å½“äºèœå",
  "processors": [
    {
      "å¤„ç†å™¨ç±»å‹": {
        "å‚æ•°1": "å€¼1",
        "å‚æ•°2": "å€¼2"
      }
    }
  ],
  "on_failure": [
    {
      "é”™è¯¯å¤„ç†å™¨": {
        "å‚æ•°": "å€¼"
      }
    }
  ]
}
```

### 2.2 å…³é”®å­—æ®µè¯¦è§£


**ğŸ“ å„å­—æ®µå«ä¹‰**ï¼š

| å­—æ®µå | ä½œç”¨ | å¿…å¡« | ä¸¾ä¾‹è¯´æ˜ |
|--------|------|------|----------|
| `description` | ç®¡é“åŠŸèƒ½æè¿° | âŒ | "è§£æApacheè®¿é—®æ—¥å¿—" |
| `processors` | å¤„ç†å™¨åˆ—è¡¨ | âœ… | å…·ä½“çš„æ•°æ®å¤„ç†æ­¥éª¤ |
| `on_failure` | é”™è¯¯å¤„ç† | âŒ | å¤„ç†å¤±è´¥æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ |
| `version` | ç®¡é“ç‰ˆæœ¬å· | âŒ | ä¾¿äºç®¡ç†å’Œå›æ»š |

### 2.3 åœ¨Filebeatä¸­é…ç½®ç®¡é“


**ğŸ”§ Filebeaté…ç½®ç¤ºä¾‹**ï¼š
```yaml
# filebeat.yml é…ç½®ç‰‡æ®µ
output.elasticsearch:
  hosts: ["localhost:9200"]
  # æ–¹å¼1ï¼šä¸ºæ‰€æœ‰æ•°æ®æŒ‡å®šåŒä¸€ä¸ªç®¡é“
  pipeline: "my-log-pipeline"
  
  # æ–¹å¼2ï¼šæ ¹æ®ä¸åŒæ¡ä»¶ä½¿ç”¨ä¸åŒç®¡é“
  pipelines:
    - pipeline: "apache-pipeline"
      when.contains:
        source: "/var/log/apache"
    - pipeline: "nginx-pipeline" 
      when.contains:
        source: "/var/log/nginx"
```

ğŸŒ° **ä¸¾ä¸ªä¾‹å­**ï¼šè¿™å°±åƒå¿«é€’åˆ†æ‹£ï¼Œä¸åŒç±»å‹çš„åŒ…è£¹ï¼ˆæ—¥å¿—ï¼‰èµ°ä¸åŒçš„å¤„ç†æµæ°´çº¿ï¼ˆç®¡é“ï¼‰ã€‚

---

## 3. ğŸ”„ æ•°æ®é¢„å¤„ç†ç®¡é“è¯¦è§£


### 3.1 æ•°æ®é¢„å¤„ç†çš„å¿…è¦æ€§


**ğŸ’­ æ€è€ƒä¸€ä¸‹**ï¼šä¸ºä»€ä¹ˆè¦é¢„å¤„ç†æ•°æ®ï¼Ÿ

æƒ³è±¡ä½ æ˜¯æ•°æ®åˆ†æå¸ˆï¼Œé¢å¯¹è¿™æ ·çš„åŸå§‹æ—¥å¿—ï¼š
```
[2024-01-15 14:30:25] 192.168.1.100 POST /login HTTP/1.1 401 1234
```

ä½ æƒ³åˆ†æï¼š
- ä»Šå¤©æœ‰å¤šå°‘æ¬¡ç™»å½•å¤±è´¥ï¼Ÿ
- å“ªä¸ªIPåœ°å€æ”»å‡»æœ€é¢‘ç¹ï¼Ÿ
- æ¯å°æ—¶çš„è¯·æ±‚é‡è¶‹åŠ¿å¦‚ä½•ï¼Ÿ

**âŒ åŸå§‹æ•°æ®çš„é—®é¢˜**ï¼š
- æ‰€æœ‰ä¿¡æ¯æŒ¤åœ¨ä¸€èµ·ï¼Œéš¾ä»¥å•ç‹¬æŸ¥è¯¢
- æ—¶é—´æ ¼å¼ä¸ç»Ÿä¸€
- çŠ¶æ€ç æ˜¯æ•°å­—ï¼Œä¸ç›´è§‚
- æ²¡æœ‰è¯­ä¹‰åŒ–çš„å­—æ®µå

**âœ… é¢„å¤„ç†åçš„æ•ˆæœ**ï¼š
```json
{
  "@timestamp": "2024-01-15T14:30:25.000Z",
  "client_ip": "192.168.1.100",
  "http_method": "POST",
  "url_path": "/login",
  "http_version": "1.1", 
  "response_code": 401,
  "response_status": "Unauthorized",
  "bytes": 1234,
  "event_type": "http_request",
  "is_error": true
}
```

### 3.2 å¸¸ç”¨é¢„å¤„ç†æ“ä½œ


**ğŸ› ï¸ æ ¸å¿ƒé¢„å¤„ç†ç±»å‹**ï¼š

#### ğŸ“Š æ•°æ®è§£æç±»

```json
{
  "grok": {
    "field": "message",
    "patterns": [
      "\\[%{TIMESTAMP_ISO8601:timestamp}\\] %{IP:client_ip} %{WORD:method}"
    ]
  }
}
```
**ğŸ” æ·±å…¥ç†è§£**ï¼šGrokå°±åƒæ­£åˆ™è¡¨è¾¾å¼çš„"äººè¯ç‰ˆæœ¬"ï¼Œç”¨é¢„å®šä¹‰çš„æ¨¡å¼æå–å­—æ®µã€‚

#### ğŸ”§ æ•°æ®è½¬æ¢ç±»  

```json
{
  "convert": {
    "field": "response_code",
    "type": "integer"
  }
}
```
**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šæŠŠå­—ç¬¦ä¸²"200"è½¬æ¢æˆæ•°å­—200ï¼Œè¿™æ ·å°±èƒ½åšæ•°å€¼æ¯”è¾ƒå’Œç»Ÿè®¡ã€‚

#### ğŸ“… æ—¶é—´å¤„ç†ç±»

```json
{
  "date": {
    "field": "timestamp",
    "formats": ["yyyy-MM-dd HH:mm:ss"],
    "target_field": "@timestamp"
  }
}
```
**ğŸ’¡ è®°å¿†æŠ€å·§**ï¼šæŠŠå„ç§æ—¶é—´æ ¼å¼ç»Ÿä¸€è½¬æ¢æˆESè®¤è¯†çš„æ ‡å‡†æ—¶é—´æ ¼å¼ã€‚

### 3.3 é¢„å¤„ç†ç®¡é“ç¤ºä¾‹


**ğŸ“‹ Webè®¿é—®æ—¥å¿—é¢„å¤„ç†ç®¡é“**ï¼š
```json
{
  "description": "è§£æApacheè®¿é—®æ—¥å¿—",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "%{COMBINEDAPACHELOG}"
        ]
      }
    },
    {
      "date": {
        "field": "timestamp", 
        "formats": ["dd/MMM/yyyy:HH:mm:ss Z"]
      }
    },
    {
      "convert": {
        "field": "response",
        "type": "integer"
      }
    },
    {
      "set": {
        "field": "event_type",
        "value": "web_access"
      }
    }
  ]
}
```

**ğŸ”¢ æ­¥éª¤åˆ†è§£**ï¼š
1. **æ­¥éª¤1**ï¼šç”¨Grokè§£ææ—¥å¿—æ ¼å¼ï¼Œæå–IPã€æ—¶é—´ã€è¯·æ±‚ç­‰å­—æ®µ
2. **æ­¥éª¤2**ï¼šæŠŠæ—¶é—´å­—ç¬¦ä¸²è½¬æ¢æˆæ ‡å‡†æ—¶é—´æ ¼å¼
3. **æ­¥éª¤3**ï¼šæŠŠå“åº”ç è½¬æ¢æˆæ•°å­—ç±»å‹
4. **æ­¥éª¤4**ï¼šæ·»åŠ äº‹ä»¶ç±»å‹æ ‡è¯†

---

## 4. â›“ï¸ ç®¡é“å¤„ç†å™¨é“¾é…ç½®


### 4.1 å¤„ç†å™¨é“¾çš„å·¥ä½œåŸç†


**ğŸ”„ é“¾å¼å¤„ç†æ¦‚å¿µ**ï¼š
```
åŸå§‹æ•°æ® â†’ å¤„ç†å™¨1 â†’ å¤„ç†å™¨2 â†’ å¤„ç†å™¨3 â†’ æœ€ç»ˆç»“æœ

å°±åƒå·¥å‚æµæ°´çº¿ï¼š
åŸææ–™ â†’ åˆ‡å‰² â†’ æ‰“ç£¨ â†’ ç»„è£… â†’ æˆå“
```

**âš¡ é‡è¦æé†’**ï¼šå¤„ç†å™¨æŒ‰é¡ºåºæ‰§è¡Œï¼Œå‰é¢çš„è¾“å‡ºæ˜¯åé¢çš„è¾“å…¥ï¼Œé¡ºåºå¾ˆé‡è¦ï¼

### 4.2 å¸¸ç”¨å¤„ç†å™¨è¯¦è§£


#### ğŸ” æ–‡æœ¬è§£æå¤„ç†å™¨


**Grokå¤„ç†å™¨**ï¼š
```json
{
  "grok": {
    "field": "message",
    "patterns": [
      "%{TIMESTAMP_ISO8601:@timestamp} %{LOGLEVEL:level} %{GREEDYDATA:content}"
    ],
    "ignore_missing": true
  }
}
```

**ğŸ’­ ä¸ºä»€ä¹ˆè¿™æ ·**ï¼šGrokä½¿ç”¨é¢„å®šä¹‰æ¨¡å¼åŒ¹é…ï¼Œæ¯”æ‰‹å†™æ­£åˆ™è¡¨è¾¾å¼æ›´ç®€å•ã€‚

**JSONè§£æå¤„ç†å™¨**ï¼š
```json
{
  "json": {
    "field": "message",
    "target_field": "parsed_json"
  }
}
```

#### ğŸ”§ å­—æ®µæ“ä½œå¤„ç†å™¨


**æ·»åŠ å­—æ®µ**ï¼š
```json
{
  "set": {
    "field": "environment",
    "value": "production"
  }
}
```

**é‡å‘½åå­—æ®µ**ï¼š
```json
{
  "rename": {
    "field": "src_ip", 
    "target_field": "source_ip"
  }
}
```

**åˆ é™¤å­—æ®µ**ï¼š
```json
{
  "remove": {
    "field": ["unnecessary_field1", "temp_field"]
  }
}
```

#### ğŸ“Š æ•°æ®ç±»å‹è½¬æ¢å¤„ç†å™¨


```json
{
  "convert": {
    "field": "response_time",
    "type": "float"
  }
}
```

**ğŸŒ° å®é™…åº”ç”¨**ï¼šæŠŠå“åº”æ—¶é—´ä»å­—ç¬¦ä¸²"0.123"è½¬æ¢æˆæµ®ç‚¹æ•°0.123ï¼Œè¿™æ ·å°±èƒ½è®¡ç®—å¹³å‡å“åº”æ—¶é—´äº†ã€‚

### 4.3 å¤„ç†å™¨é“¾å®ä¾‹


**ğŸ“ å®Œæ•´çš„æ—¥å¿—å¤„ç†é“¾**ï¼š
```json
{
  "description": "åº”ç”¨æ—¥å¿—å®Œæ•´å¤„ç†é“¾",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "\\[%{TIMESTAMP_ISO8601:log_timestamp}\\] %{LOGLEVEL:level}: %{GREEDYDATA:log_message}"
        ]
      }
    },
    {
      "date": {
        "field": "log_timestamp",
        "formats": ["yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"]
      }
    },
    {
      "lowercase": {
        "field": "level"
      }
    },
    {
      "set": {
        "field": "service_name",
        "value": "web-api"
      }
    },
    {
      "script": {
        "source": "ctx.is_error = ctx.level == 'error' || ctx.level == 'fatal'"
      }
    },
    {
      "remove": {
        "field": ["log_timestamp", "message"]
      }
    }
  ]
}
```

**ğŸ”¢ å¤„ç†æ­¥éª¤è¯´æ˜**ï¼š
1. è§£ææ—¥å¿—æ ¼å¼ï¼Œæå–æ—¶é—´æˆ³ã€çº§åˆ«ã€æ¶ˆæ¯
2. å°†æ—¶é—´æˆ³è½¬æ¢ä¸ºESæ ‡å‡†æ ¼å¼
3. å°†æ—¥å¿—çº§åˆ«è½¬ä¸ºå°å†™
4. æ·»åŠ æœåŠ¡åç§°æ ‡è¯†
5. æ ¹æ®æ—¥å¿—çº§åˆ«åˆ¤æ–­æ˜¯å¦ä¸ºé”™è¯¯
6. æ¸…ç†ä¸éœ€è¦çš„ä¸´æ—¶å­—æ®µ

---

## 5. ğŸ¯ æ¡ä»¶ç®¡é“é…ç½®å®æˆ˜


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ¡ä»¶å¤„ç†


**ğŸ¤” æƒ³è±¡åœºæ™¯**ï¼šä½ çš„åº”ç”¨åŒæ—¶äº§ç”Ÿå¤šç§æ—¥å¿—ï¼š
- è®¿é—®æ—¥å¿—ï¼šè®°å½•ç”¨æˆ·è¯·æ±‚
- é”™è¯¯æ—¥å¿—ï¼šè®°å½•ç³»ç»Ÿå¼‚å¸¸  
- æ€§èƒ½æ—¥å¿—ï¼šè®°å½•å“åº”æ—¶é—´

ä¸åŒç±»å‹çš„æ—¥å¿—éœ€è¦ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œè¿™æ—¶å°±éœ€è¦æ¡ä»¶ç®¡é“ã€‚

### 5.2 æ¡ä»¶è¯­æ³•åŸºç¡€


**åŸºæœ¬æ¡ä»¶ç»“æ„**ï¼š
```json
{
  "if": "æ¡ä»¶è¡¨è¾¾å¼",
  "then": [å¤„ç†å™¨æ•°ç»„],
  "else": [å¯é€‰çš„elseå¤„ç†å™¨]
}
```

**å¸¸ç”¨æ¡ä»¶è¡¨è¾¾å¼**ï¼š

| æ¡ä»¶ç±»å‹ | è¯­æ³•ç¤ºä¾‹ | è¯´æ˜ |
|----------|----------|------|
| å­—æ®µå­˜åœ¨ | `ctx.containsKey('field_name')` | æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨ |
| å­—ç¬¦ä¸²åŒ¹é… | `ctx.message.contains('ERROR')` | æ£€æŸ¥æ˜¯å¦åŒ…å«ç‰¹å®šæ–‡æœ¬ |
| æ•°å€¼æ¯”è¾ƒ | `ctx.response_code >= 400` | æ•°å€¼å¤§å°æ¯”è¾ƒ |
| æ­£åˆ™åŒ¹é… | `ctx.path =~ /.*\\.log$/` | æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… |

### 5.3 æ¡ä»¶å¤„ç†å™¨å®ä¾‹


**ğŸ“Š åŸºäºæ—¥å¿—çº§åˆ«çš„æ¡ä»¶å¤„ç†**ï¼š
```json
{
  "description": "æ ¹æ®æ—¥å¿—çº§åˆ«è¿›è¡Œä¸åŒå¤„ç†",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": ["%{LOGLEVEL:level} %{GREEDYDATA:content}"]
      }
    },
    {
      "if": "ctx.level == 'ERROR'",
      "processors": [
        {
          "set": {
            "field": "priority",
            "value": "high"
          }
        },
        {
          "set": {
            "field": "alert_required", 
            "value": true
          }
        }
      ]
    },
    {
      "if": "ctx.level == 'WARN'",
      "processors": [
        {
          "set": {
            "field": "priority",
            "value": "medium"
          }
        }
      ]
    },
    {
      "if": "ctx.level == 'INFO' || ctx.level == 'DEBUG'",
      "processors": [
        {
          "set": {
            "field": "priority",
            "value": "low"
          }
        }
      ]
    }
  ]
}
```

**ğŸ’¡ å®é™…æ•ˆæœ**ï¼š
- ERRORæ—¥å¿— â†’ é«˜ä¼˜å…ˆçº§ + éœ€è¦å‘Šè­¦
- WARNæ—¥å¿— â†’ ä¸­ä¼˜å…ˆçº§
- INFO/DEBUGæ—¥å¿— â†’ ä½ä¼˜å…ˆçº§

### 5.4 å¤æ‚æ¡ä»¶ç»„åˆ


**ğŸ”§ å¤šæ¡ä»¶ç»„åˆç¤ºä¾‹**ï¼š
```json
{
  "if": "ctx.containsKey('response_code') && ctx.response_code >= 400",
  "processors": [
    {
      "set": {
        "field": "is_client_error",
        "value": "{{response_code}}{{#response_code}}{{#between}}400{{/between}}{{#between}}499{{/between}}{{/response_code}}"
      }
    },
    {
      "if": "ctx.response_code >= 500",
      "processors": [
        {
          "set": {
            "field": "is_server_error",
            "value": true
          }
        },
        {
          "set": {
            "field": "severity",
            "value": "critical"
          }
        }
      ]
    }
  ]
}
```

**ğŸŒ° ä¸šåŠ¡åœºæ™¯è§£é‡Š**ï¼š
- 4xxé”™è¯¯ â†’ æ ‡è®°ä¸ºå®¢æˆ·ç«¯é”™è¯¯
- 5xxé”™è¯¯ â†’ æ ‡è®°ä¸ºæœåŠ¡å™¨é”™è¯¯ï¼Œè®¾ç½®å…³é”®ä¸¥é‡ç¨‹åº¦

---

## 6. âš ï¸ ç®¡é“é”™è¯¯å¤„ç†æœºåˆ¶


### 6.1 é”™è¯¯å¤„ç†çš„é‡è¦æ€§


**ğŸ’¥ å¸¸è§é—®é¢˜åœºæ™¯**ï¼š
- æ—¥å¿—æ ¼å¼çªç„¶å˜åŒ–ï¼ŒGrokè§£æå¤±è´¥
- æŸä¸ªå­—æ®µç¼ºå¤±ï¼Œå¯¼è‡´è½¬æ¢å‡ºé”™
- ç½‘ç»œé—®é¢˜å¯¼è‡´æ•°æ®ä¼ è¾“ä¸­æ–­

**âŒ æ²¡æœ‰é”™è¯¯å¤„ç†çš„åæœ**ï¼š
- æ•´ä¸ªç®¡é“åœæ­¢å·¥ä½œ
- æ•°æ®ä¸¢å¤±
- ç³»ç»Ÿèµ„æºæµªè´¹

**âœ… æœ‰é”™è¯¯å¤„ç†çš„å¥½å¤„**ï¼š
- é”™è¯¯æ•°æ®å¯ä»¥å•ç‹¬å­˜å‚¨
- ç³»ç»Ÿç»§ç»­å¤„ç†æ­£å¸¸æ•°æ®  
- ä¾¿äºåç»­é—®é¢˜æ’æŸ¥

### 6.2 on_failureé”™è¯¯å¤„ç†


**åŸºæœ¬é”™è¯¯å¤„ç†ç»“æ„**ï¼š
```json
{
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": ["%{COMBINEDAPACHELOG}"],
        "on_failure": [
          {
            "set": {
              "field": "parse_error",
              "value": "grok_parse_failed"
            }
          },
          {
            "set": {
              "field": "error_timestamp",
              "value": "{{_ingest.timestamp}}"
            }
          }
        ]
      }
    }
  ]
}
```

**ğŸ” æ·±å…¥ç†è§£**ï¼šå½“Grokè§£æå¤±è´¥æ—¶ï¼Œä¸æ˜¯è®©æ•´ä¸ªæ–‡æ¡£è¢«ä¸¢å¼ƒï¼Œè€Œæ˜¯ç»™å®ƒæ‰“ä¸Šé”™è¯¯æ ‡è®°ï¼Œè¿™æ ·åç»­å¯ä»¥ä¸“é—¨åˆ†æè§£æå¤±è´¥çš„æ—¥å¿—ã€‚

### 6.3 å…¨å±€é”™è¯¯å¤„ç†


**ğŸ“‹ ç®¡é“çº§åˆ«çš„é”™è¯¯å¤„ç†**ï¼š
```json
{
  "description": "å¸¦å…¨å±€é”™è¯¯å¤„ç†çš„ç®¡é“",
  "processors": [
    {
      "json": {
        "field": "message"
      }
    },
    {
      "date": {
        "field": "timestamp",
        "formats": ["yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"]
      }
    }
  ],
  "on_failure": [
    {
      "set": {
        "field": "_pipeline_error",
        "value": "{{_ingest.on_failure_message}}"
      }
    },
    {
      "set": {
        "field": "_pipeline_error_processor",
        "value": "{{_ingest.on_failure_processor_type}}"
      }
    },
    {
      "set": {
        "field": "_error_timestamp",
        "value": "{{_ingest.timestamp}}"
      }
    }
  ]
}
```

**ğŸ¯ é”™è¯¯ä¿¡æ¯åŒ…å«**ï¼š
- å…·ä½“çš„é”™è¯¯æ¶ˆæ¯
- å‡ºé”™çš„å¤„ç†å™¨ç±»å‹
- é”™è¯¯å‘ç”Ÿæ—¶é—´

### 6.4 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


**ğŸ› ï¸ æ¨èåšæ³•**ï¼š

1. **ä¸ºå…³é”®å¤„ç†å™¨æ·»åŠ é”™è¯¯å¤„ç†**
2. **ä¿ç•™åŸå§‹æ•°æ®ä»¥ä¾¿æ’æŸ¥**
3. **è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯**
4. **è®¾ç½®é”™è¯¯æ•°æ®çš„ç‰¹æ®Šç´¢å¼•**

**âœ… å®Œå–„çš„é”™è¯¯å¤„ç†ç¤ºä¾‹**ï¼š
```json
{
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": ["%{COMBINEDAPACHELOG}"],
        "on_failure": [
          {
            "set": {
              "field": "grok_parse_error",
              "value": true
            }
          },
          {
            "rename": {
              "field": "message",
              "target_field": "original_message"
            }
          }
        ]
      }
    }
  ],
  "on_failure": [
    {
      "set": {
        "field": "_index",
        "value": "failed-logs-{{_index}}"
      }
    }
  ]
}
```

**ğŸ’¡ è¿™æ ·è®¾è®¡çš„å¥½å¤„**ï¼š
- è§£æå¤±è´¥çš„æ•°æ®ä¼šä¿ç•™åŸå§‹æ¶ˆæ¯
- æ‰€æœ‰å¤„ç†å¤±è´¥çš„æ•°æ®ä¼šå­˜å‚¨åˆ°ä¸“é—¨çš„"failed-logs"ç´¢å¼•
- æ–¹ä¾¿åç»­æ’æŸ¥å’Œä¿®å¤é—®é¢˜

---

## 7. ğŸš€ ç®¡é“æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 7.1 æ€§èƒ½é—®é¢˜çš„è¡¨ç°


**ğŸš¨ å¸¸è§æ€§èƒ½é—®é¢˜**ï¼š
- æ•°æ®å¤„ç†é€Ÿåº¦æ…¢ï¼Œç§¯å‹è¶Šæ¥è¶Šå¤š
- CPUå ç”¨ç‡è¿‡é«˜
- å†…å­˜ä½¿ç”¨é‡æŒç»­å¢é•¿
- Elasticsearché›†ç¾¤å“åº”æ…¢

**ğŸ“Š æ€§èƒ½æŒ‡æ ‡ç›‘æ§**ï¼š
```
å¤„ç†é€Ÿåº¦ï¼šæ–‡æ¡£æ•°/ç§’
å¤„ç†å»¶è¿Ÿï¼šæ•°æ®ä»è¿›å…¥åˆ°å®Œæˆå¤„ç†çš„æ—¶é—´
é”™è¯¯ç‡ï¼šå¤„ç†å¤±è´¥çš„æ–‡æ¡£æ¯”ä¾‹
èµ„æºä½¿ç”¨ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
```

### 7.2 å¤„ç†å™¨ä¼˜åŒ–ç­–ç•¥


#### ğŸ” å‡å°‘å¤æ‚å¤„ç†å™¨ä½¿ç”¨


**âŒ æ€§èƒ½è¾ƒå·®çš„å†™æ³•**ï¼š
```json
{
  "script": {
    "source": """
      if (ctx.message.contains('ERROR')) {
        ctx.level = 'error';
        ctx.priority = 'high';
        ctx.alert = true;
      } else if (ctx.message.contains('WARN')) {
        ctx.level = 'warning';
        ctx.priority = 'medium';
      }
    """
  }
}
```

**âœ… æ€§èƒ½æ›´å¥½çš„å†™æ³•**ï¼š
```json
[
  {
    "grok": {
      "field": "message", 
      "patterns": ["%{LOGLEVEL:level} %{GREEDYDATA:content}"]
    }
  },
  {
    "if": "ctx.level == 'ERROR'",
    "processors": [
      {"set": {"field": "priority", "value": "high"}},
      {"set": {"field": "alert", "value": true}}
    ]
  }
]
```

**ğŸ’­ ä¸ºä»€ä¹ˆæ›´å¥½**ï¼šä½¿ç”¨ä¸“é—¨çš„å¤„ç†å™¨æ¯”å†™å¤æ‚è„šæœ¬æ›´é«˜æ•ˆã€‚

#### ğŸ“ å­—æ®µæ“ä½œä¼˜åŒ–


**ğŸ¯ åªå¤„ç†å¿…è¦çš„å­—æ®µ**ï¼š
```json
{
  "remove": {
    "field": ["unnecessary_field1", "temp_field2", "debug_info"],
    "ignore_missing": true
  }
}
```

**âš¡ æ‰¹é‡æ“ä½œ**ï¼š
```json
{
  "rename": {
    "field": "src",
    "target_field": "source"
  }
}
```

### 7.3 ç®¡é“ç»“æ„ä¼˜åŒ–


#### ğŸ—ï¸ åˆç†çš„å¤„ç†å™¨é¡ºåº


**âœ… æ¨èé¡ºåº**ï¼š
1. **å­—æ®µæå–**ï¼ˆgrokã€jsonç­‰ï¼‰
2. **æ•°æ®éªŒè¯**ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰
3. **æ•°æ®è½¬æ¢**ï¼ˆconvertã€dateç­‰ï¼‰
4. **å­—æ®µæ¸…ç†**ï¼ˆremoveã€renameç­‰ï¼‰

**ğŸ“‹ ä¼˜åŒ–åçš„ç®¡é“ç»“æ„**ï¼š
```json
{
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": ["%{COMBINEDAPACHELOG}"]
      }
    },
    {
      "if": "ctx.containsKey('response')",
      "processors": [
        {
          "convert": {
            "field": "response",
            "type": "integer"
          }
        }
      ]
    },
    {
      "date": {
        "field": "timestamp",
        "formats": ["dd/MMM/yyyy:HH:mm:ss Z"]
      }
    },
    {
      "remove": {
        "field": ["timestamp", "message"]
      }
    }
  ]
}
```

### 7.4 èµ„æºé…ç½®ä¼˜åŒ–


**âš™ï¸ ElasticsearchèŠ‚ç‚¹é…ç½®**ï¼š
```yaml
# elasticsearch.yml
node.ingest: true
processors: 8  # æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´
thread_pool.write.queue_size: 1000
```

**ğŸ“Š æ€§èƒ½ç›‘æ§é…ç½®**ï¼š
```json
{
  "processors": [
    {
      "set": {
        "field": "_pipeline_start_time",
        "value": "{{_ingest.timestamp}}"
      }
    }
  ]
}
```

---

## 8. ğŸ“Š ç®¡é“ç›‘æ§ä¸ç‰ˆæœ¬ç®¡ç†


### 8.1 ç®¡é“ç›‘æ§çš„é‡è¦æ€§


**ğŸ” ä¸ºä»€ä¹ˆè¦ç›‘æ§ç®¡é“**ï¼š
- åŠæ—¶å‘ç°å¤„ç†å¼‚å¸¸
- äº†è§£æ•°æ®å¤„ç†æ•ˆç‡
- ä¼˜åŒ–ç®¡é“æ€§èƒ½
- ä¿è¯æ•°æ®è´¨é‡

### 8.2 ç®¡é“ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»å‹ | å…·ä½“æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | å¼‚å¸¸å‘Šè­¦ |
|----------|----------|----------|----------|
| **å¤„ç†æ€§èƒ½** | æ–‡æ¡£å¤„ç†é€Ÿåº¦ | >1000docs/s | <500docs/s |
| **é”™è¯¯ç‡** | å¤„ç†å¤±è´¥æ¯”ä¾‹ | <1% | >5% |
| **å»¶è¿Ÿ** | å¤„ç†æ—¶é—´ | <100ms | >500ms |
| **èµ„æºä½¿ç”¨** | CPU/å†…å­˜ä½¿ç”¨ç‡ | <70% | >90% |

### 8.3 ç›‘æ§é…ç½®å®ç°


**ğŸ“Š å†…ç½®ç›‘æ§ä¿¡æ¯**ï¼š
```json
{
  "processors": [
    {
      "set": {
        "field": "pipeline_info",
        "value": {
          "pipeline_name": "{{_ingest.pipeline}}",
          "process_time": "{{_ingest.timestamp}}", 
          "node_name": "{{_ingest.node_name}}"
        }
      }
    }
  ]
}
```

**ğŸ“ ä½¿ç”¨Elasticsearchç›‘æ§API**ï¼š
```bash
# æŸ¥çœ‹ç®¡é“ç»Ÿè®¡ä¿¡æ¯
GET _nodes/stats/ingest

# æŸ¥çœ‹ç‰¹å®šç®¡é“ä¿¡æ¯  
GET _ingest/pipeline/my-pipeline/_stats
```

### 8.4 ç®¡é“ç‰ˆæœ¬ç®¡ç†


#### ğŸ“‹ ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ


**ğŸ·ï¸ ç‰ˆæœ¬å‘½åè§„èŒƒ**ï¼š
```
ç®¡é“åç§°-ç¯å¢ƒ-ç‰ˆæœ¬å·
ä¾‹å¦‚ï¼šweb-logs-prod-v1.2.3
```

**ğŸ“ é…ç½®æ–‡ä»¶ç®¡ç†**ï¼š
```
pipelines/
â”œâ”€â”€ web-logs/
â”‚   â”œâ”€â”€ v1.0.0/
â”‚   â”‚   â””â”€â”€ pipeline.json
â”‚   â”œâ”€â”€ v1.1.0/
â”‚   â”‚   â””â”€â”€ pipeline.json  
â”‚   â””â”€â”€ current -> v1.1.0/
â””â”€â”€ app-logs/
    â””â”€â”€ v1.0.0/
        â””â”€â”€ pipeline.json
```

#### ğŸ”„ ç®¡é“æ›´æ–°æµç¨‹


**âš¡ å®‰å…¨æ›´æ–°æ­¥éª¤**ï¼š

1. **æµ‹è¯•ç¯å¢ƒéªŒè¯**
```bash
# 1. åˆ›å»ºæµ‹è¯•ç®¡é“
PUT _ingest/pipeline/web-logs-test-v1.2.0
{
  "description": "æµ‹è¯•ç‰ˆæœ¬ 1.2.0",
  "processors": [...]
}

# 2. ä½¿ç”¨æµ‹è¯•æ•°æ®éªŒè¯
POST _ingest/pipeline/web-logs-test-v1.2.0/_simulate
{
  "docs": [
    {
      "_source": {
        "message": "test log message"
      }
    }
  ]
}
```

2. **ç°åº¦å‘å¸ƒ**
```json
{
  "if": "Math.random() < 0.1",
  "processors": [
    {
      "pipeline": {
        "name": "web-logs-test-v1.2.0"
      }
    }
  ],
  "else": [
    {
      "pipeline": {
        "name": "web-logs-prod-v1.1.0" 
      }
    }
  ]
}
```

3. **å…¨é‡åˆ‡æ¢**
```bash
# æ›´æ–°ç”Ÿäº§ç®¡é“
PUT _ingest/pipeline/web-logs-prod
{
  "description": "ç”Ÿäº§ç‰ˆæœ¬ 1.2.0",
  "processors": [...]
}
```

#### ğŸ“œ ç‰ˆæœ¬å›æ»šæœºåˆ¶


**ğŸ”„ å¿«é€Ÿå›æ»šé…ç½®**ï¼š
```bash
# ä¿å­˜å½“å‰ç‰ˆæœ¬çš„å¤‡ä»½
GET _ingest/pipeline/web-logs-prod > backup_v1.2.0.json

# å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
PUT _ingest/pipeline/web-logs-prod < backup_v1.1.0.json
```

---

## 9. ğŸ’¼ å®é™…é…ç½®æ¡ˆä¾‹è¯¦è§£


### 9.1 WebæœåŠ¡å™¨æ—¥å¿—å¤„ç†ç®¡é“


**ğŸŒ åœºæ™¯æè¿°**ï¼šå¤„ç†Nginxè®¿é—®æ—¥å¿—ï¼Œæå–ç”¨æˆ·è¡Œä¸ºæ•°æ®ç”¨äºåˆ†æã€‚

**åŸå§‹æ—¥å¿—æ ¼å¼**ï¼š
```
192.168.1.100 - - [15/Jan/2024:14:30:25 +0000] "GET /api/users HTTP/1.1" 200 1234 "https://example.com" "Mozilla/5.0"
```

**ğŸ“‹ å®Œæ•´ç®¡é“é…ç½®**ï¼š
```json
{
  "description": "Nginxè®¿é—®æ—¥å¿—å¤„ç†ç®¡é“",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "%{IPORHOST:client_ip} - - \\[%{HTTPDATE:timestamp}\\] \"%{WORD:http_method} %{URIPATH:url_path}(?:%{URIPARAM:url_params})? HTTP/%{NUMBER:http_version}\" %{INT:response_code} %{INT:response_size} \"%{DATA:referrer}\" \"%{DATA:user_agent}\""
        ]
      }
    },
    {
      "date": {
        "field": "timestamp",
        "formats": ["dd/MMM/yyyy:HH:mm:ss Z"],
        "target_field": "@timestamp"
      }
    },
    {
      "convert": {
        "field": "response_code",
        "type": "integer"
      }
    },
    {
      "convert": {
        "field": "response_size", 
        "type": "integer"
      }
    },
    {
      "if": "ctx.response_code >= 400",
      "processors": [
        {
          "set": {
            "field": "is_error",
            "value": true
          }
        },
        {
          "if": "ctx.response_code >= 500",
          "processors": [
            {
              "set": {
                "field": "error_type",
                "value": "server_error"
              }
            }
          ],
          "else": [
            {
              "set": {
                "field": "error_type", 
                "value": "client_error"
              }
            }
          ]
        }
      ]
    },
    {
      "geoip": {
        "field": "client_ip",
        "target_field": "geoip"
      }
    },
    {
      "user_agent": {
        "field": "user_agent",
        "target_field": "ua"
      }
    },
    {
      "remove": {
        "field": ["message", "timestamp", "user_agent"]
      }
    }
  ],
  "on_failure": [
    {
      "set": {
        "field": "pipeline_error",
        "value": "nginx_log_parse_failed"
      }
    }
  ]
}
```

**ğŸ“Š å¤„ç†ç»“æœç¤ºä¾‹**ï¼š
```json
{
  "@timestamp": "2024-01-15T14:30:25.000Z",
  "client_ip": "192.168.1.100",
  "http_method": "GET",
  "url_path": "/api/users",
  "http_version": "1.1",
  "response_code": 200,
  "response_size": 1234,
  "referrer": "https://example.com",
  "geoip": {
    "country_name": "China",
    "city_name": "Beijing"
  },
  "ua": {
    "name": "Chrome",
    "version": "91.0"
  }
}
```

### 9.2 åº”ç”¨ç¨‹åºæ—¥å¿—å¤„ç†ç®¡é“


**ğŸ”§ åœºæ™¯æè¿°**ï¼šå¤„ç†Javaåº”ç”¨çš„ç»“æ„åŒ–æ—¥å¿—ï¼ŒåŒ…å«ä¸åŒæ—¥å¿—çº§åˆ«å’Œå¼‚å¸¸å †æ ˆã€‚

**åŸå§‹æ—¥å¿—ç¤ºä¾‹**ï¼š
```json
{"timestamp":"2024-01-15T14:30:25.123Z","level":"ERROR","logger":"com.example.UserService","message":"User not found","exception":"java.lang.RuntimeException: User ID 123 not found\n\tat com.example.UserService.getUser(UserService.java:45)"}
```

**ğŸ“‹ åº”ç”¨æ—¥å¿—ç®¡é“**ï¼š
```json
{
  "description": "Javaåº”ç”¨æ—¥å¿—å¤„ç†ç®¡é“",
  "processors": [
    {
      "json": {
        "field": "message",
        "target_field": "app_log"
      }
    },
    {
      "date": {
        "field": "app_log.timestamp",
        "formats": ["yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"]
      }
    },
    {
      "set": {
        "field": "log_level",
        "value": "{{app_log.level}}"
      }
    },
    {
      "set": {
        "field": "logger_name", 
        "value": "{{app_log.logger}}"
      }
    },
    {
      "set": {
        "field": "log_message",
        "value": "{{app_log.message}}"
      }
    },
    {
      "if": "ctx.app_log.containsKey('exception')",
      "processors": [
        {
          "set": {
            "field": "has_exception",
            "value": true
          }
        },
        {
          "set": {
            "field": "exception_trace",
            "value": "{{app_log.exception}}"
          }
        },
        {
          "grok": {
            "field": "exception_trace",
            "patterns": [
              "%{JAVACLASS:exception_class}: %{GREEDYDATA:exception_message}"
            ]
          }
        }
      ]
    },
    {
      "script": {
        "source": """
          ctx.priority = 'low';
          if (ctx.log_level == 'ERROR' || ctx.log_level == 'FATAL') {
            ctx.priority = 'high';
          } else if (ctx.log_level == 'WARN') {
            ctx.priority = 'medium';
          }
        """
      }
    },
    {
      "remove": {
        "field": ["message", "app_log"]
      }
    }
  ]
}
```

### 9.3 å®‰å…¨æ—¥å¿—å¤„ç†ç®¡é“


**ğŸ” åœºæ™¯æè¿°**ï¼šå¤„ç†ç³»ç»Ÿå®‰å…¨æ—¥å¿—ï¼Œè¯†åˆ«å¯ç–‘æ´»åŠ¨å’Œæ”»å‡»è¡Œä¸ºã€‚

**ğŸ“‹ å®‰å…¨æ—¥å¿—ç®¡é“**ï¼š
```json
{
  "description": "å®‰å…¨æ—¥å¿—åˆ†æç®¡é“",
  "processors": [
    {
      "grok": {
        "field": "message",
        "patterns": [
          "%{SYSLOGTIMESTAMP:syslog_timestamp} %{IPORHOST:host} %{PROG:program}: %{GREEDYDATA:content}"
        ]
      }
    },
    {
      "if": "ctx.program == 'sshd'",
      "processors": [
        {
          "grok": {
            "field": "content",
            "patterns": [
              "Failed password for %{USERNAME:username} from %{IP:source_ip} port %{INT:source_port}",
              "Accepted password for %{USERNAME:username} from %{IP:source_ip} port %{INT:source_port}"
            ]
          }
        },
        {
          "if": "ctx.content.contains('Failed')",
          "processors": [
            {
              "set": {
                "field": "event_type",
                "value": "ssh_login_failure"
              }
            },
            {
              "set": {
                "field": "threat_level",
                "value": "medium"
              }
            }
          ],
          "else": [
            {
              "set": {
                "field": "event_type", 
                "value": "ssh_login_success"
              }
            }
          ]
        }
      ]
    },
    {
      "if": "ctx.containsKey('source_ip')",
      "processors": [
        {
          "geoip": {
            "field": "source_ip",
            "target_field": "geoip"
          }
        }
      ]
    }
  ]
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ ç®¡é“æœ¬è´¨**ï¼šæ•°æ®é¢„å¤„ç†æµæ°´çº¿ï¼Œå°†åŸå§‹æ—¥å¿—è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®
**ğŸ”¸ å¤„ç†å™¨é“¾**ï¼šæŒ‰é¡ºåºæ‰§è¡Œçš„æ•°æ®å¤„ç†æ­¥éª¤ï¼Œå‰é¢çš„è¾“å‡ºæ˜¯åé¢çš„è¾“å…¥  
**ğŸ”¸ æ¡ä»¶å¤„ç†**ï¼šæ ¹æ®æ•°æ®å†…å®¹é€‰æ‹©ä¸åŒçš„å¤„ç†è·¯å¾„
**ğŸ”¸ é”™è¯¯å¤„ç†**ï¼šä¿è¯ç®¡é“ç¨³å®šè¿è¡Œï¼Œé¿å…æ•°æ®ä¸¢å¤±
**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†è®¾è®¡ç®¡é“ç»“æ„ï¼Œæé«˜å¤„ç†æ•ˆç‡

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç®¡é“è®¾è®¡åŸåˆ™**ï¼š
- **å…ˆè§£æï¼Œåè½¬æ¢**ï¼šé¦–å…ˆæå–å­—æ®µï¼Œç„¶åè¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢
- **æ¡ä»¶åœ¨å‰ï¼Œæ“ä½œåœ¨å**ï¼šå…ˆåˆ¤æ–­æ¡ä»¶ï¼Œå†æ‰§è¡Œå…·ä½“æ“ä½œ
- **åŠæ—¶æ¸…ç†**ï¼šåˆ é™¤ä¸éœ€è¦çš„ä¸´æ—¶å­—æ®µï¼Œå‡å°‘å­˜å‚¨ç©ºé—´

**ğŸ”¹ é”™è¯¯å¤„ç†ç­–ç•¥**ï¼š
- **é¢„é˜²ä¸ºä¸»**ï¼šä½¿ç”¨`ignore_missing`ç­‰å‚æ•°é¿å…å¸¸è§é”™è¯¯
- **ä¼˜é›…é™çº§**ï¼šå¤„ç†å¤±è´¥æ—¶ä¿ç•™åŸå§‹æ•°æ®ï¼Œæ·»åŠ é”™è¯¯æ ‡è®°
- **åˆ†ç±»å­˜å‚¨**ï¼šå°†é”™è¯¯æ•°æ®å­˜å‚¨åˆ°ä¸“é—¨çš„ç´¢å¼•ä¾¿äºæ’æŸ¥

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**ï¼š
- **é¿å…å¤æ‚è„šæœ¬**ï¼šä¼˜å…ˆä½¿ç”¨ä¸“é—¨çš„å¤„ç†å™¨è€Œä¸æ˜¯scriptå¤„ç†å™¨
- **åˆç†ä½¿ç”¨æ¡ä»¶**ï¼šé¿å…ä¸å¿…è¦çš„æ¡ä»¶åˆ¤æ–­
- **æ‰¹é‡æ“ä½œ**ï¼šä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªå­—æ®µè€Œä¸æ˜¯é€ä¸ªå¤„ç†

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š ç®¡é“è®¾è®¡æµç¨‹**ï¼š
1. **åˆ†æåŸå§‹æ•°æ®æ ¼å¼**ï¼šäº†è§£æ—¥å¿—çš„ç»“æ„å’Œç‰¹ç‚¹
2. **ç¡®å®šç›®æ ‡ç»“æœ**ï¼šæ˜ç¡®éœ€è¦æå–å“ªäº›å­—æ®µ
3. **è®¾è®¡å¤„ç†æ­¥éª¤**ï¼šè§„åˆ’å¤„ç†å™¨çš„é¡ºåºå’Œé…ç½®
4. **æµ‹è¯•éªŒè¯**ï¼šä½¿ç”¨æ¨¡æ‹ŸAPIæµ‹è¯•ç®¡é“æ•ˆæœ
5. **ç›‘æ§ä¼˜åŒ–**ï¼šéƒ¨ç½²åæŒç»­ç›‘æ§å’Œä¼˜åŒ–

**ğŸ› ï¸ å¸¸ç”¨é…ç½®æ¨¡æ¿**ï¼š
- **Webæ—¥å¿—**ï¼šGrokè§£æ + æ—¶é—´è½¬æ¢ + IPåœ°ç†ä½ç½® + User-Agentè§£æ
- **åº”ç”¨æ—¥å¿—**ï¼šJSONè§£æ + æ—¥å¿—çº§åˆ«åˆ†ç±» + å¼‚å¸¸æå–
- **ç³»ç»Ÿæ—¥å¿—**ï¼šSyslogè§£æ + äº‹ä»¶åˆ†ç±» + å®‰å…¨åˆ†æ

**âš ï¸ å¸¸è§è¯¯åŒºé¿å…**ï¼š
- ä¸è¦è¿‡åº¦ä½¿ç”¨scriptå¤„ç†å™¨
- ä¸è¦å¿½ç•¥é”™è¯¯å¤„ç†é…ç½®
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥ä¿®æ”¹ç®¡é“
- ä¸è¦å¿˜è®°æ¸…ç†ä¸´æ—¶å­—æ®µ

### 10.4 å­¦ä¹ å»ºè®®


**ğŸ“ å­¦ä¹ è·¯å¾„**ï¼š
1. **åŸºç¡€æ¦‚å¿µ**ï¼šç†è§£ç®¡é“ã€å¤„ç†å™¨ã€å­—æ®µçš„æ¦‚å¿µ
2. **å¸¸ç”¨å¤„ç†å™¨**ï¼šæŒæ¡grokã€dateã€convertç­‰æ ¸å¿ƒå¤„ç†å™¨
3. **å®é™…ç»ƒä¹ **ï¼šç”¨è‡ªå·±çš„æ—¥å¿—æ•°æ®ç»ƒä¹ é…ç½®ç®¡é“
4. **é«˜çº§ç‰¹æ€§**ï¼šå­¦ä¹ æ¡ä»¶å¤„ç†ã€é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–
5. **ç”Ÿäº§å®è·µ**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨å’Œä¼˜åŒ–

**ğŸ’¡ å®è·µæŠ€å·§**ï¼š
- ä»ç®€å•çš„æ—¥å¿—æ ¼å¼å¼€å§‹ç»ƒä¹ 
- å¤šä½¿ç”¨æ¨¡æ‹ŸAPIæµ‹è¯•é…ç½®
- é˜…è¯»å®˜æ–¹æ–‡æ¡£äº†è§£æ›´å¤šå¤„ç†å™¨
- å‚è€ƒç¤¾åŒºåˆ†äº«çš„ç®¡é“é…ç½®æ¡ˆä¾‹

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç®¡é“åƒæµæ°´çº¿ï¼Œæ•°æ®é€æ­¥åŠ å·¥æˆå‹
- å¤„ç†å™¨æœ‰é¡ºåºï¼Œå‰é¢è¾“å‡ºåé¢ç”¨
- æ¡ä»¶åˆ¤æ–­çµæ´»ï¼Œä¸åŒæ•°æ®ä¸åŒè·¯
- é”™è¯¯å¤„ç†é‡è¦ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šè·‘
- æ€§èƒ½ä¼˜åŒ–å…³é”®ï¼Œåˆç†è®¾è®¡æ•ˆç‡é«˜