---
title: 13ã€redis-output.yml Redisè¾“å‡ºé…ç½®
---
## ğŸ“š ç›®å½•

1. [Redisè¾“å‡ºåŸºç¡€æ¦‚å¿µ](#1-Redisè¾“å‡ºåŸºç¡€æ¦‚å¿µ)
2. [Redisè¿æ¥é…ç½®è¯¦è§£](#2-Redisè¿æ¥é…ç½®è¯¦è§£)
3. [æ•°æ®ç»“æ„é€‰æ‹©é…ç½®](#3-æ•°æ®ç»“æ„é€‰æ‹©é…ç½®)
4. [é”®åæ¨¡æ¿è®¾ç½®](#4-é”®åæ¨¡æ¿è®¾ç½®)
5. [è¿æ¥æ± ä¸æ€§èƒ½é…ç½®](#5-è¿æ¥æ± ä¸æ€§èƒ½é…ç½®)
6. [è®¤è¯ä¸å®‰å…¨é…ç½®](#6-è®¤è¯ä¸å®‰å…¨é…ç½®)
7. [è¶…æ—¶é‡è¯•æœºåˆ¶](#7-è¶…æ—¶é‡è¯•æœºåˆ¶)
8. [ç®¡é“æ‰¹é‡æ“ä½œ](#8-ç®¡é“æ‰¹é‡æ“ä½œ)
9. [å®é™…åº”ç”¨åœºæ™¯](#9-å®é™…åº”ç”¨åœºæ™¯)
10. [é…ç½®æ–‡ä»¶å®Œæ•´ç¤ºä¾‹](#10-é…ç½®æ–‡ä»¶å®Œæ•´ç¤ºä¾‹)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Redisè¾“å‡ºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Redisè¾“å‡º


**ğŸ”¸ é€šä¿—ç†è§£**
```
æŠŠFilebeatæƒ³è±¡æˆä¸€ä¸ªæ¬è¿å·¥ï¼š
- ğŸ  ä»æ–‡ä»¶é‡Œæ¬æ•°æ® (Input)
- ğŸš› è£…è½¦è¿è¾“å¤„ç† (Processing)  
- ğŸª é€åˆ°Redisä»“åº“ (Output)

Rediså°±åƒä¸€ä¸ªé«˜é€Ÿç¼“å­˜ä»“åº“ï¼Œä¸“é—¨å­˜æ”¾ä¸´æ—¶æ•°æ®
```

**ğŸ’¡ ä¸ºä»€ä¹ˆé€‰æ‹©Redisä½œä¸ºè¾“å‡ºç›®æ ‡**
- **âš¡ é€Ÿåº¦æå¿«**ï¼šå†…å­˜å­˜å‚¨ï¼Œæ¯«ç§’çº§å“åº”
- **ğŸ”„ ç¼“å­˜ä½œç”¨**ï¼šä½œä¸ºæ—¥å¿—å¤„ç†çš„ä¸­é—´ç¼“å†²åŒº
- **ğŸ“Š æ•°æ®ç»“æ„ä¸°å¯Œ**ï¼šæ”¯æŒåˆ—è¡¨ã€é›†åˆã€å“ˆå¸Œç­‰å¤šç§å­˜å‚¨æ–¹å¼
- **ğŸ”— è§£è€¦æ¶æ„**ï¼šè®©æ•°æ®æ”¶é›†å’Œæ•°æ®å¤„ç†åˆ†ç¦»

### 1.2 Redisåœ¨æ—¥å¿—ç³»ç»Ÿä¸­çš„è§’è‰²


```
å…¸å‹æ—¥å¿—å¤„ç†æµç¨‹ï¼š

åº”ç”¨æœåŠ¡å™¨ â†’ Filebeat â†’ Redis â†’ Logstash â†’ Elasticsearch
     â†“           â†“        â†“        â†“           â†“
   äº§ç”Ÿæ—¥å¿—    æ”¶é›†æ—¥å¿—   ç¼“å­˜é˜Ÿåˆ—  å¤„ç†è½¬æ¢    å­˜å‚¨æœç´¢

Redisä½œç”¨ï¼š
âœ… ç¼“å†²åŒºï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±
âœ… è§£è€¦ï¼šæ”¶é›†å’Œå¤„ç†åˆ†ç¦»
âœ… å‰Šå³°ï¼šå¤„ç†æµé‡çªå¢
âœ… åˆ†å‘ï¼šæ”¯æŒå¤šä¸ªæ¶ˆè´¹è€…
```

### 1.3 æ”¯æŒçš„Redisæ•°æ®ç±»å‹


| æ•°æ®ç±»å‹ | **ä½œç”¨** | **é€‚ç”¨åœºæ™¯** | **ç‰¹ç‚¹** |
|---------|---------|-------------|---------|
| **Liståˆ—è¡¨** | `é˜Ÿåˆ—å­˜å‚¨` | `æ—¥å¿—é˜Ÿåˆ—ï¼Œé¡ºåºå¤„ç†` | `FIFOå…ˆè¿›å…ˆå‡ºï¼Œæ”¯æŒé˜»å¡è¯»å–` |
| **Channelå‘å¸ƒè®¢é˜…** | `æ¶ˆæ¯åˆ†å‘` | `å®æ—¶é€šçŸ¥ï¼Œå¹¿æ’­æ¶ˆæ¯` | `ä¸€å¯¹å¤šåˆ†å‘ï¼Œå®æ—¶æ€§å¥½` |
| **Seté›†åˆ** | `å»é‡å­˜å‚¨` | `å”¯ä¸€æ€§æ—¥å¿—ï¼Œç»Ÿè®¡è®¡æ•°` | `è‡ªåŠ¨å»é‡ï¼Œæ— åºå­˜å‚¨` |
| **Hashå“ˆå¸Œ** | `ç»“æ„åŒ–å­˜å‚¨` | `å¤æ‚æ—¥å¿—å¯¹è±¡` | `é”®å€¼å¯¹å­˜å‚¨ï¼Œç»“æ„æ¸…æ™°` |

---

## 2. ğŸ”— Redisè¿æ¥é…ç½®è¯¦è§£


### 2.1 åŸºç¡€è¿æ¥é…ç½®


**ğŸ”¸ å•æœºRedisè¿æ¥**
```yaml
output.redis:
  # RedisæœåŠ¡å™¨åœ°å€å’Œç«¯å£
  hosts: ["localhost:6379"]
  
  # é€‰æ‹©æ•°æ®åº“ï¼ˆRedisæœ‰16ä¸ªæ•°æ®åº“ï¼Œç¼–å·0-15ï¼‰
  db: 0
  
  # è¿æ¥è¶…æ—¶æ—¶é—´
  timeout: 5s
```

**ğŸ’­ é€šä¿—è§£é‡Š**
- `hosts`ï¼šå‘Šè¯‰Filebeatå»å“ªé‡Œæ‰¾Redisï¼Œå°±åƒå‘Šè¯‰å¤–å–å‘˜åœ°å€
- `db`ï¼šRedisæœ‰å¾ˆå¤šæˆ¿é—´ï¼ˆæ•°æ®åº“ï¼‰ï¼Œé€‰æ‹©å­˜æ”¾åœ¨å“ªä¸ªæˆ¿é—´
- `timeout`ï¼šç­‰å¤šä¹…æ²¡è¿ä¸Šå°±æ”¾å¼ƒï¼Œé¿å…ä¸€ç›´ç­‰ä¸‹å»

### 2.2 é›†ç¾¤æ¨¡å¼è¿æ¥


**ğŸ”¸ Rediså“¨å…µæ¨¡å¼é…ç½®**
```yaml
output.redis:
  # å“¨å…µåœ°å€åˆ—è¡¨
  hosts: ["sentinel1:26379", "sentinel2:26379", "sentinel3:26379"]
  
  # ä¸»æœåŠ¡å™¨åç§°
  sentinel_master_name: "mymaster"
  
  # å“¨å…µå¯†ç ï¼ˆå¦‚æœè®¾ç½®äº†ï¼‰
  sentinel_password: "sentinel_pass"
```

**ğŸ“Š å“¨å…µæ¨¡å¼æ¶æ„å›¾**
```
           å“¨å…µé›†ç¾¤ç›‘æ§
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Sentinel1  Sentinel2  â”‚
    â”‚     â†“         â†“        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Redis-Master          â”‚ â† ä¸»æœåŠ¡å™¨å†™å…¥
    â”‚        â†“                â”‚
    â”‚   Redis-Slave1          â”‚ â† ä»æœåŠ¡å™¨å¤‡ä»½
    â”‚   Redis-Slave2          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ Redisé›†ç¾¤æ¨¡å¼é…ç½®**
```yaml
output.redis:
  # é›†ç¾¤èŠ‚ç‚¹åœ°å€
  hosts: ["redis1:6379", "redis2:6379", "redis3:6379"]
  
  # å¯ç”¨é›†ç¾¤æ¨¡å¼
  cluster: true
  
  # é›†ç¾¤é…ç½®
  cluster_max_redirects: 3
```

### 2.3 SSL/TLSå®‰å…¨è¿æ¥


**ğŸ”¸ åŠ å¯†è¿æ¥é…ç½®**
```yaml
output.redis:
  hosts: ["redis.example.com:6380"]
  
  # å¯ç”¨SSL
  ssl.enabled: true
  
  # è¯ä¹¦é…ç½®
  ssl.certificate: "/path/to/client.crt"
  ssl.key: "/path/to/client.key"
  ssl.certificate_authorities: ["/path/to/ca.crt"]
  
  # è·³è¿‡è¯ä¹¦éªŒè¯ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
  ssl.verification_mode: none
```

---

## 3. ğŸ—‚ï¸ æ•°æ®ç»“æ„é€‰æ‹©é…ç½®


### 3.1 Liståˆ—è¡¨æ¨¡å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰


**ğŸ”¸ åŸºç¡€Listé…ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # ä½¿ç”¨åˆ—è¡¨æ•°æ®ç±»å‹
  data_type: "list"
  
  # é”®åï¼ˆåˆ—è¡¨åï¼‰
  key: "filebeat-logs"
  
  # åˆ—è¡¨æ“ä½œç±»å‹
  list.mode: "lpush"  # ä»å·¦è¾¹æ’å…¥
```

**ğŸ’¡ Listæ¨¡å¼è¯¦è§£**
- **`lpush`**ï¼šä»åˆ—è¡¨å·¦ç«¯æ’å…¥ï¼Œæœ€æ–°æ•°æ®åœ¨æœ€å·¦è¾¹
- **`rpush`**ï¼šä»åˆ—è¡¨å³ç«¯æ’å…¥ï¼Œæœ€æ–°æ•°æ®åœ¨æœ€å³è¾¹
- **é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¿—é˜Ÿåˆ—ï¼ŒæŒ‰æ—¶é—´é¡ºåºå¤„ç†

```
Listå­˜å‚¨ç¤ºæ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ filebeat-logs (List)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æœ€æ–°] log3 â† lpushæ’å…¥         â”‚
â”‚        log2                     â”‚
â”‚ [æœ€æ—§] log1                     â”‚ â† rpopå–å‡º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Channelå‘å¸ƒè®¢é˜…æ¨¡å¼


**ğŸ”¸ å‘å¸ƒè®¢é˜…é…ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # ä½¿ç”¨å‘å¸ƒè®¢é˜…
  data_type: "channel"
  
  # é¢‘é“åç§°
  key: "log-channel"
```

**ğŸ”„ å‘å¸ƒè®¢é˜…å·¥ä½œæµç¨‹**
```
Filebeatå‘å¸ƒæ¶ˆæ¯                å¤šä¸ªè®¢é˜…è€…æ¥æ”¶
     â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  publish  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  subscribe  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Filebeat â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Redis   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Logstash â”‚
â”‚          â”‚           â”‚ Channel â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Consumer â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Monitor  â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 åŠ¨æ€é”®åæ¨¡æ¿


**ğŸ”¸ åŸºäºå­—æ®µçš„åŠ¨æ€é”®å**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  data_type: "list"
  
  # åŠ¨æ€é”®åæ¨¡æ¿
  key: "logs-%{[fields.env]}-%{[agent.hostname]}"
  
  # ç¤ºä¾‹ç»“æœï¼š
  # logs-production-web01
  # logs-testing-app02
```

**ğŸ“‹ é”®åæ¨¡æ¿å˜é‡**
| å˜é‡ç±»å‹ | **ç¤ºä¾‹** | **è¯´æ˜** |
|---------|---------|---------|
| **æ—¶é—´å˜é‡** | `%{+yyyy.MM.dd}` | `æŒ‰æ—¥æœŸåˆ†ç»„` |
| **å­—æ®µå˜é‡** | `%{[fields.env]}` | `è‡ªå®šä¹‰å­—æ®µå€¼` |
| **ä¸»æœºå˜é‡** | `%{[agent.hostname]}` | `ä¸»æœºå` |
| **æ—¥å¿—æº** | `%{[log.file.path]}` | `æ–‡ä»¶è·¯å¾„` |

---

## 4. ğŸ¯ é”®åæ¨¡æ¿è®¾ç½®


### 4.1 æ—¶é—´åŸºç¡€çš„é”®å


**ğŸ”¸ æŒ‰æ—¶é—´åˆ†å‰²æ—¥å¿—**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  data_type: "list"
  
  # æŒ‰å°æ—¶åˆ†å‰²
  key: "logs-%{+yyyy-MM-dd-HH}"
  
  # æŒ‰å¤©åˆ†å‰²  
  key: "logs-%{+yyyy-MM-dd}"
  
  # æŒ‰æœˆåˆ†å‰²
  key: "logs-%{+yyyy-MM}"
```

**ğŸ“… æ—¶é—´åˆ†å‰²çš„å¥½å¤„**
```
æŒ‰å°æ—¶åˆ†å‰²ç¤ºä¾‹ï¼š
logs-2025-09-21-09  â† ä¸Šåˆ9ç‚¹çš„æ—¥å¿—
logs-2025-09-21-10  â† ä¸Šåˆ10ç‚¹çš„æ—¥å¿—
logs-2025-09-21-11  â† ä¸Šåˆ11ç‚¹çš„æ—¥å¿—

å¥½å¤„ï¼š
âœ… é¿å…å•ä¸ªåˆ—è¡¨è¿‡å¤§
âœ… ä¾¿äºæŒ‰æ—¶é—´æ®µå¤„ç†
âœ… è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
âœ… æé«˜æŸ¥è¯¢æ•ˆç‡
```

### 4.2 å¤šç»´åº¦é”®åç»„åˆ


**ğŸ”¸ ç¯å¢ƒ+æœåŠ¡+æ—¶é—´ç»„åˆ**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  data_type: "list"
  
  # å¤åˆé”®åæ¨¡æ¿
  key: "logs-%{[fields.environment]}-%{[fields.service]}-%{+yyyy-MM-dd}"
  
  # æ·»åŠ å­—æ®µåˆ°æ—¥å¿—ä¸­
  fields:
    environment: "production"
    service: "web-api"
  fields_under_root: true
```

**ğŸ¯ å®é™…ç”Ÿæˆçš„é”®å**
```
çœŸå®åœºæ™¯ç¤ºä¾‹ï¼š
logs-production-web-api-2025-09-21     â† ç”Ÿäº§ç¯å¢ƒWeb APIæ—¥å¿—
logs-testing-user-service-2025-09-21   â† æµ‹è¯•ç¯å¢ƒç”¨æˆ·æœåŠ¡æ—¥å¿—
logs-staging-payment-api-2025-09-21    â† é¢„å‘å¸ƒç¯å¢ƒæ”¯ä»˜APIæ—¥å¿—

åˆ†ç±»æ¸…æ™°ï¼Œä¾¿äºç®¡ç†ï¼
```

### 4.3 æ¡ä»¶åŒ–é”®åé€‰æ‹©


**ğŸ”¸ æ ¹æ®æ—¥å¿—çº§åˆ«åˆ†ç±»**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  data_type: "list"
  
  # æ ¹æ®æ—¥å¿—çº§åˆ«é€‰æ‹©ä¸åŒé”®å
  key: "logs-%{[log.level]}-%{+yyyy-MM-dd}"
  
  # å¦‚æœæ²¡æœ‰çº§åˆ«å­—æ®µï¼Œä½¿ç”¨é»˜è®¤å€¼
  key: "logs-%{[log.level]:info}-%{+yyyy-MM-dd}"
```

---

## 5. âš¡ è¿æ¥æ± ä¸æ€§èƒ½é…ç½®


### 5.1 è¿æ¥æ± é…ç½®


**ğŸ”¸ è¿æ¥æ± ä¼˜åŒ–**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # è¿æ¥æ± è®¾ç½®
  pool:
    # æœ€å¤§è¿æ¥æ•°
    max_connections: 100
    
    # ç©ºé—²è¿æ¥æ•°
    idle_connections: 20
    
    # è¿æ¥è¶…æ—¶
    connection_timeout: 30s
    
    # ç©ºé—²è¶…æ—¶
    idle_timeout: 300s
```

**ğŸŠ è¿æ¥æ± å·¥ä½œåŸç†**
```
è¿æ¥æ± ç®¡ç†ç¤ºæ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        è¿æ¥æ±                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ´»è·ƒ] Conn1 â† æ­£åœ¨ä½¿ç”¨     â”‚
â”‚ [æ´»è·ƒ] Conn2 â† æ­£åœ¨ä½¿ç”¨     â”‚
â”‚ [ç©ºé—²] Conn3 â† ç­‰å¾…å¤ç”¨     â”‚
â”‚ [ç©ºé—²] Conn4 â† ç­‰å¾…å¤ç”¨     â”‚
â”‚        ...                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¥½å¤„ï¼š
âœ… å‡å°‘è¿æ¥å»ºç«‹å¼€é”€
âœ… æé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
âœ… æ§åˆ¶èµ„æºä½¿ç”¨
```

### 5.2 æ‰¹é‡æ“ä½œé…ç½®


**ğŸ”¸ æ‰¹é‡å‘é€ä¼˜åŒ–**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # æ‰¹é‡è®¾ç½®
  bulk_max_size: 2048      # æ¯æ‰¹æœ€å¤§äº‹ä»¶æ•°
  
  # ç®¡é“æ“ä½œ
  pipeline: 10             # ç®¡é“å¤§å°
  
  # åˆ·æ–°é—´éš”
  flush_interval: 1s       # å¼ºåˆ¶åˆ·æ–°é—´éš”
```

**ğŸ“Š æ‰¹é‡æ“ä½œæ€§èƒ½å¯¹æ¯”**
```
å•æ¡å‘é€ vs æ‰¹é‡å‘é€ï¼š

å•æ¡å‘é€ï¼š
Event1 â†’ Redis (è€—æ—¶1ms)
Event2 â†’ Redis (è€—æ—¶1ms)  
Event3 â†’ Redis (è€—æ—¶1ms)
æ€»è®¡ï¼š3ms + ç½‘ç»œå¼€é”€ Ã— 3

æ‰¹é‡å‘é€ï¼š
[Event1, Event2, Event3] â†’ Redis (è€—æ—¶1ms)
æ€»è®¡ï¼š1ms + ç½‘ç»œå¼€é”€ Ã— 1

æ€§èƒ½æå‡ï¼š3-5å€ï¼
```

### 5.3 ç®¡é“Pipelineé…ç½®


**ğŸ”¸ ç®¡é“æ“ä½œè¯¦è§£**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # å¯ç”¨ç®¡é“
  pipeline: 50
  
  # ç®¡é“è¶…æ—¶
  pipeline_timeout: 5s
```

**ğŸš° ç®¡é“å·¥ä½œåŸç†**
```
æ™®é€šæ¨¡å¼ï¼ˆç­‰å¾…å“åº”ï¼‰ï¼š
Send Cmd1 â†’ Wait Response â†’ Send Cmd2 â†’ Wait Response

ç®¡é“æ¨¡å¼ï¼ˆæ‰¹é‡å‘é€ï¼‰ï¼š
Send Cmd1 + Cmd2 + Cmd3 â†’ Batch Response

æ—¶é—´èŠ‚çœï¼š
æ™®é€šï¼š(å‘é€+ç­‰å¾…) Ã— 3 = 9ms
ç®¡é“ï¼šå‘é€Ã—3 + ç­‰å¾…Ã—1 = 4ms
```

---

## 6. ğŸ” è®¤è¯ä¸å®‰å…¨é…ç½®


### 6.1 å¯†ç è®¤è¯


**ğŸ”¸ åŸºç¡€å¯†ç è®¤è¯**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # Rediså¯†ç 
  password: "your_redis_password"
  
  # ç”¨æˆ·åï¼ˆRedis 6.0+æ”¯æŒï¼‰
  username: "filebeat_user"
```

### 6.2 ACLç”¨æˆ·æƒé™é…ç½®


**ğŸ”¸ Redis ACLé…ç½®ç¤ºä¾‹**
```bash
# åœ¨Redisä¸­åˆ›å»ºä¸“ç”¨ç”¨æˆ·
127.0.0.1:6379> ACL SETUSER filebeat_user on >password123 +@write +@read -@dangerous

# è§£é‡Šï¼š
# on: æ¿€æ´»ç”¨æˆ·
# >password123: è®¾ç½®å¯†ç 
# +@write: å…è®¸å†™æ“ä½œ
# +@read: å…è®¸è¯»æ“ä½œ  
# -@dangerous: ç¦æ­¢å±é™©æ“ä½œ
```

**ğŸ›¡ï¸ æƒé™æ§åˆ¶é…ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  username: "filebeat_user"
  password: "password123"
  
  # é™åˆ¶æ“ä½œçš„é”®åæ¨¡å¼
  key: "filebeat:*"
```

### 6.3 ç½‘ç»œå®‰å…¨é…ç½®


**ğŸ”¸ ç½‘ç»œé™åˆ¶è®¾ç½®**
```yaml
output.redis:
  hosts: ["redis.internal.com:6379"]
  
  # ç»‘å®šæœ¬åœ°IPï¼ˆå¤šç½‘å¡æ—¶ï¼‰
  local: "192.168.1.100"
  
  # ä»£ç†è®¾ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
  proxy_url: "socks5://proxy.company.com:1080"
```

---

## 7. â±ï¸ è¶…æ—¶é‡è¯•æœºåˆ¶


### 7.1 è¶…æ—¶é…ç½®


**ğŸ”¸ å„ç§è¶…æ—¶è®¾ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # è¿æ¥è¶…æ—¶
  timeout: 5s
  
  # è¯»å†™è¶…æ—¶
  read_timeout: 10s
  write_timeout: 10s
  
  # ä¿æŒè¿æ¥å¿ƒè·³
  keep_alive: 30s
```

### 7.2 é‡è¯•ç­–ç•¥


**ğŸ”¸ é‡è¯•æœºåˆ¶é…ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # é‡è¯•è®¾ç½®
  max_retries: 3           # æœ€å¤§é‡è¯•æ¬¡æ•°
  backoff.init: 1s         # åˆå§‹é‡è¯•é—´éš”
  backoff.max: 60s         # æœ€å¤§é‡è¯•é—´éš”
```

**ğŸ”„ é‡è¯•ç­–ç•¥è¯´æ˜**
```
æŒ‡æ•°é€€é¿é‡è¯•ç¤ºä¾‹ï¼š

ç¬¬1æ¬¡å¤±è´¥ â†’ ç­‰å¾…1s â†’ é‡è¯•
ç¬¬2æ¬¡å¤±è´¥ â†’ ç­‰å¾…2s â†’ é‡è¯•  
ç¬¬3æ¬¡å¤±è´¥ â†’ ç­‰å¾…4s â†’ é‡è¯•
ç¬¬4æ¬¡å¤±è´¥ â†’ ç­‰å¾…8s â†’ é‡è¯•
...
æœ€å¤§ç­‰å¾… â†’ ç­‰å¾…60s â†’ é‡è¯•

é¿å…é¢‘ç¹é‡è¯•é€ æˆé›ªå´©æ•ˆåº”
```

### 7.3 é”™è¯¯å¤„ç†é…ç½®


**ğŸ”¸ é”™è¯¯å¤„ç†ç­–ç•¥**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # é”™è¯¯å¤„ç†
  on_failure:
    # è®°å½•å¤±è´¥æ—¥å¿—
    log_failures: true
    
    # å¤±è´¥æ•°æ®å­˜å‚¨è·¯å¾„
    dead_letter_index: "filebeat-failed"
```

---

## 8. ğŸš€ ç®¡é“æ‰¹é‡æ“ä½œ


### 8.1 Redis PipelineåŸç†


**ğŸ’­ ä»€ä¹ˆæ˜¯Pipeline**
```
æƒ³è±¡ä¸€ä¸‹æ´—è¡£æœçš„è¿‡ç¨‹ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆå•ä¸ªæ“ä½œï¼‰ï¼š
æ´—è¡£æœ1 â†’ ç­‰å¾…å®Œæˆ â†’ æ´—è¡£æœ2 â†’ ç­‰å¾…å®Œæˆ â†’ æ´—è¡£æœ3

Pipelineæ–¹å¼ï¼ˆæ‰¹é‡æ“ä½œï¼‰ï¼š  
æŠŠè¡£æœ1ã€2ã€3ä¸€èµ·æ”¾è¿›æ´—è¡£æœº â†’ ä¸€æ¬¡æ€§å®Œæˆ

Redis PipelineåŒç†ï¼š
æŠŠå¤šä¸ªå‘½ä»¤æ‰“åŒ…ä¸€èµ·å‘é€ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”
```

### 8.2 Pipelineé…ç½®è¯¦è§£


**ğŸ”¸ Pipelineæ€§èƒ½é…ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  
  # Pipelineè®¾ç½®
  pipeline: 100            # ç®¡é“å¤§å°ï¼ˆå‘½ä»¤æ•°é‡ï¼‰
  pipeline_timeout: 2s     # ç®¡é“è¶…æ—¶æ—¶é—´
  
  # æ‰¹é‡è®¾ç½®
  bulk_max_size: 1000     # æ¯æ‰¹æœ€å¤§äº‹ä»¶æ•°
  flush_interval: 500ms    # å¼ºåˆ¶åˆ·æ–°é—´éš”
```

**ğŸ“ˆ Pipelineæ€§èƒ½ä¼˜åŒ–**
```
ä¸åŒPipelineå¤§å°çš„æ€§èƒ½å¯¹æ¯”ï¼š

Pipeline=1   (æ— ç®¡é“): 1000 ops/sec
Pipeline=10  (å°ç®¡é“): 5000 ops/sec
Pipeline=50  (ä¸­ç®¡é“): 15000 ops/sec  â† æ¨è
Pipeline=100 (å¤§ç®¡é“): 18000 ops/sec
Pipeline=500 (è¶…å¤§):   17000 ops/sec  â† æ€§èƒ½ä¸‹é™

æœ€ä½³å®è·µï¼šPipeline=50-100
```

### 8.3 æ‰¹é‡æ“ä½œæ¨¡å¼


**ğŸ”¸ ä¸åŒæ‰¹é‡æ¨¡å¼é…ç½®**
```yaml
# æ¨¡å¼1ï¼šæŒ‰æ•°é‡æ‰¹é‡
output.redis:
  hosts: ["localhost:6379"]
  bulk_max_size: 500       # 500æ¡ä¸€æ‰¹

# æ¨¡å¼2ï¼šæŒ‰æ—¶é—´æ‰¹é‡  
output.redis:
  hosts: ["localhost:6379"]
  flush_interval: 1s       # 1ç§’ä¸€æ‰¹

# æ¨¡å¼3ï¼šæŒ‰å¤§å°æ‰¹é‡
output.redis:
  hosts: ["localhost:6379"]
  bulk_max_bytes: 1MB      # 1MBä¸€æ‰¹
```

---

## 9. ğŸª å®é™…åº”ç”¨åœºæ™¯


### 9.1 WebæœåŠ¡å™¨æ—¥å¿—ç¼“å­˜


**ğŸŒ åœºæ™¯ï¼šé«˜å¹¶å‘WebæœåŠ¡å™¨**
```yaml
# nginx-redis.yml
filebeat.inputs:
- type: log
  paths:
    - /var/log/nginx/access.log
  fields:
    log_type: "nginx_access"
    environment: "production"

output.redis:
  hosts: ["redis-cluster:6379"]
  data_type: "list"
  key: "nginx-logs-%{+yyyy-MM-dd-HH}"
  
  # é«˜æ€§èƒ½é…ç½®
  pipeline: 100
  bulk_max_size: 2000
  flush_interval: 500ms
  
  # è¿æ¥æ± ä¼˜åŒ–
  pool:
    max_connections: 50
    idle_connections: 10
```

### 9.2 åº”ç”¨é”™è¯¯æ—¥å¿—å®æ—¶ç›‘æ§


**ğŸš¨ åœºæ™¯ï¼šåº”ç”¨é”™è¯¯å®æ—¶å‘Šè­¦**
```yaml
# error-monitor.yml  
filebeat.inputs:
- type: log
  paths:
    - /app/logs/error.log
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after

processors:
- if:
    contains:
      message: "ERROR"
  then:
    - add_fields:
        fields:
          alert_level: "high"
          notify: "true"

output.redis:
  hosts: ["redis.monitor:6379"]
  data_type: "channel"
  key: "error-alerts"
  
  # å®æ—¶æ€§é…ç½®
  flush_interval: 100ms
```

### 9.3 å¤šç¯å¢ƒæ—¥å¿—åˆ†ç¦»


**ğŸ—ï¸ åœºæ™¯ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»**
```yaml
# multi-env.yml
filebeat.inputs:
- type: log
  paths:
    - /app/logs/*.log
  fields:
    environment: "${ENV:production}"
    service: "${SERVICE:web-api}"

output.redis:
  hosts: ["${REDIS_HOST:localhost}:${REDIS_PORT:6379}"]
  data_type: "list"
  
  # ç¯å¢ƒéš”ç¦»é”®å
  key: "logs-%{[fields.environment]}-%{[fields.service]}-%{+yyyy-MM-dd}"
  
  # ç¯å¢ƒç‰¹å®šé…ç½®
  password: "${REDIS_PASSWORD:}"
  db: "${REDIS_DB:0}"
```

---

## 10. ğŸ“„ é…ç½®æ–‡ä»¶å®Œæ•´ç¤ºä¾‹


### 10.1 ç”Ÿäº§ç¯å¢ƒå®Œæ•´é…ç½®


**ğŸ­ enterprise-redis.yml**
```yaml
#=================== Filebeat Redisè¾“å‡ºç”Ÿäº§é…ç½® ===================

# æ—¥å¿—è¾“å…¥é…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/app/*.log
    - /var/log/nginx/*.log
  
  # å­—æ®µæ ‡è®°
  fields:
    environment: "production"
    datacenter: "dc1"
    cluster: "web-cluster"
  fields_under_root: true
  
  # å¤šè¡Œæ—¥å¿—å¤„ç†
  multiline.pattern: '^\[\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after

# æ•°æ®å¤„ç†
processors:
- add_host_metadata:
    when.not.contains.tags: forwarded

- drop_fields:
    fields: ["agent.ephemeral_id", "agent.id", "ecs.version"]

# Redisè¾“å‡ºé…ç½®
output.redis:
  # é›†ç¾¤åœ°å€
  hosts: 
    - "redis1.prod.com:6379"
    - "redis2.prod.com:6379" 
    - "redis3.prod.com:6379"
  
  # åŸºç¡€é…ç½®
  data_type: "list"
  db: 2
  
  # åŠ¨æ€é”®åï¼ˆç¯å¢ƒ-æœåŠ¡-æ—¶é—´ï¼‰
  key: "logs-%{[environment]}-%{[cluster]}-%{+yyyy-MM-dd-HH}"
  
  # è®¤è¯é…ç½®
  username: "filebeat_prod"
  password: "${REDIS_PASSWORD}"
  
  # æ€§èƒ½ä¼˜åŒ–
  pipeline: 80
  bulk_max_size: 1500
  flush_interval: 800ms
  
  # è¿æ¥æ± é…ç½®
  pool:
    max_connections: 40
    idle_connections: 8
    connection_timeout: 10s
    idle_timeout: 300s
  
  # è¶…æ—¶é‡è¯•
  timeout: 8s
  max_retries: 5
  backoff.init: 2s
  backoff.max: 120s
  
  # SSLé…ç½®ï¼ˆå¦‚æœå¯ç”¨ï¼‰
  ssl.enabled: false
  # ssl.certificate: "/etc/ssl/client.crt"
  # ssl.key: "/etc/ssl/client.key"

# æ—¥å¿—é…ç½®
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644

# ç›‘æ§é…ç½®
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["elasticsearch.monitor.com:9200"]
```

### 10.2 å¼€å‘æµ‹è¯•ç¯å¢ƒé…ç½®


**ğŸ§ª dev-redis.yml**
```yaml
#=================== Filebeat Rediså¼€å‘æµ‹è¯•é…ç½® ===================

filebeat.inputs:
- type: log
  paths:
    - /app/logs/*.log
  
  fields:
    environment: "development"
    developer: "${USER}"

processors:
- add_docker_metadata: ~

output.redis:
  hosts: ["localhost:6379"]
  data_type: "list"
  key: "dev-logs-%{[fields.developer]}-%{+MM-dd-HH}"
  
  # å¼€å‘ç¯å¢ƒç®€åŒ–é…ç½®
  db: 0
  pipeline: 20
  bulk_max_size: 100
  flush_interval: 2s
  
  # è°ƒè¯•æ¨¡å¼
  pretty: true

logging.level: debug
logging.to_stderr: true
```

### 10.3 é«˜å¯ç”¨å®¹ç¾é…ç½®


**ğŸ”„ ha-redis.yml**
```yaml
#=================== é«˜å¯ç”¨Redisè¾“å‡ºé…ç½® ===================

output.redis:
  # ä¸»Redisé›†ç¾¤
  hosts: ["redis-primary:6379"]
  
  # å“¨å…µæ¨¡å¼é«˜å¯ç”¨
  sentinel_master_name: "prod-master"
  sentinels:
    - "sentinel1:26379"
    - "sentinel2:26379"  
    - "sentinel3:26379"
  
  data_type: "list"
  key: "ha-logs-%{+yyyy-MM-dd-HH}"
  
  # æ•…éšœè½¬ç§»é…ç½®
  max_retries: 10
  backoff.init: 1s
  backoff.max: 60s
  
  # æ€§èƒ½ä¸å¯é æ€§å¹³è¡¡
  pipeline: 50
  bulk_max_size: 1000
  flush_interval: 1s
  
  # è¿æ¥ä¿æŒ
  pool:
    max_connections: 20
    idle_connections: 5
    connection_timeout: 5s
    
# å¤‡ç”¨è¾“å‡ºï¼ˆå½“Rediså®Œå…¨ä¸å¯ç”¨æ—¶ï¼‰
output.file:
  path: "/var/log/filebeat/backup"
  filename: "redis-backup-%{+yyyy-MM-dd}.log"
  codec.json:
    pretty: false
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


```
ğŸ”¸ Redisè¾“å‡ºè§’è‰²ï¼šé«˜é€Ÿç¼“å­˜ä¸­é—´ä»¶ï¼Œè§£è€¦æ•°æ®æ”¶é›†å’Œå¤„ç†
ğŸ”¸ æ•°æ®ç±»å‹é€‰æ‹©ï¼šListé˜Ÿåˆ—ã€Channelå‘å¸ƒè®¢é˜…ã€Setå»é‡ã€Hashç»“æ„åŒ–
ğŸ”¸ é”®åè®¾è®¡ï¼šæ”¯æŒæ¨¡æ¿å˜é‡ï¼Œå¯æŒ‰æ—¶é—´ã€ç¯å¢ƒã€æœåŠ¡åˆ†ç±»
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šPipelineç®¡é“ã€æ‰¹é‡æ“ä½œã€è¿æ¥æ± é…ç½®
ğŸ”¸ å¯é æ€§ä¿éšœï¼šè¶…æ—¶é‡è¯•ã€æ•…éšœè½¬ç§»ã€æ•°æ®å¤‡ä»½
```

### 11.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ æ€§èƒ½è°ƒä¼˜åŸåˆ™**
```
æ‰¹é‡å¤§å°è®¾ç½®ï¼š
â€¢ å°æ‰¹é‡(100-500)ï¼šå»¶è¿Ÿä½ï¼Œé€‚åˆå®æ—¶åœºæ™¯
â€¢ ä¸­æ‰¹é‡(500-1500)ï¼šå¹³è¡¡æ€§èƒ½å’Œå»¶è¿Ÿ  â† æ¨è
â€¢ å¤§æ‰¹é‡(1500+)ï¼šé«˜ååï¼Œä½†å»¶è¿Ÿé«˜

Pipelineè®¾ç½®ï¼š
â€¢ å¼€å‘ç¯å¢ƒï¼š10-20
â€¢ æµ‹è¯•ç¯å¢ƒï¼š20-50  
â€¢ ç”Ÿäº§ç¯å¢ƒï¼š50-100  â† æœ€ä½³å®è·µ
```

**ğŸ”¹ é”®åè®¾è®¡æœ€ä½³å®è·µ**
```
é”®åæ¨¡æ¿å»ºè®®ï¼š
âœ… åŒ…å«ç¯å¢ƒæ ‡è¯†ï¼šprod/test/dev
âœ… åŒ…å«æœåŠ¡æ ‡è¯†ï¼šweb/api/db
âœ… åŒ…å«æ—¶é—´ä¿¡æ¯ï¼šæŒ‰å°æ—¶æˆ–å¤©åˆ†å‰²
âœ… é¿å…ç‰¹æ®Šå­—ç¬¦ï¼šä½¿ç”¨å­—æ¯ã€æ•°å­—ã€æ¨ªçº¿

ç¤ºä¾‹å¥½çš„é”®åï¼š
logs-prod-web-api-2025-09-21-14
logs-test-user-service-2025-09-21
error-prod-payment-2025-09-21
```

**ğŸ”¹ å®‰å…¨é…ç½®è¦ç‚¹**
```
ç”Ÿäº§ç¯å¢ƒå¿…é¡»ï¼š
ğŸ” å¯ç”¨å¯†ç è®¤è¯
ğŸ” ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·å’ŒACLæƒé™
ğŸ” å¯ç”¨SSL/TLSåŠ å¯†ï¼ˆæ•æ„Ÿç¯å¢ƒï¼‰
ğŸ” ç½‘ç»œè®¿é—®æ§åˆ¶å’Œé˜²ç«å¢™
ğŸ” å®šæœŸæ›´æ¢å¯†ç å’Œè¯ä¹¦
```

### 11.3 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ” å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| **è¿æ¥è¶…æ—¶** | `ç½‘ç»œé—®é¢˜æˆ–RedisæœåŠ¡å¼‚å¸¸` | `æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼Œç¡®è®¤RedisçŠ¶æ€` |
| **è®¤è¯å¤±è´¥** | `å¯†ç é”™è¯¯æˆ–æƒé™ä¸è¶³` | `éªŒè¯ç”¨æˆ·åå¯†ç ï¼Œæ£€æŸ¥ACLæƒé™` |
| **å†…å­˜ä¸è¶³** | `Rediså†…å­˜è€—å°½` | `å¢åŠ å†…å­˜æˆ–é…ç½®æ·˜æ±°ç­–ç•¥` |
| **æ€§èƒ½ä¸‹é™** | `Pipelineæˆ–æ‰¹é‡é…ç½®ä¸å½“` | `è°ƒæ•´pipelineå’Œbulk_max_size` |
| **æ•°æ®ä¸¢å¤±** | `é‡è¯•é…ç½®è¿‡å°‘` | `å¢åŠ max_retrieså’Œè®¾ç½®å¤‡ç”¨è¾“å‡º` |

**ğŸ› ï¸ è°ƒè¯•é…ç½®å»ºè®®**
```yaml
# è°ƒè¯•æ¨¡å¼é…ç½®
logging.level: debug
logging.selectors: ["redis", "output"]

# å¯ç”¨æŒ‡æ ‡ç›‘æ§
monitoring.enabled: true

# æµ‹è¯•è¿æ¥é…ç½®
output.redis:
  hosts: ["localhost:6379"]
  timeout: 5s
  max_retries: 1  # å¿«é€Ÿå¤±è´¥ï¼Œä¾¿äºè°ƒè¯•
```

### 11.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
- **é«˜å¯ç”¨**ï¼šä½¿ç”¨å“¨å…µæˆ–é›†ç¾¤æ¨¡å¼
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†è®¾ç½®Pipelineå’Œæ‰¹é‡å¤§å°
- **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®Rediså’ŒFilebeatç›‘æ§
- **å¤‡ä»½ç­–ç•¥**ï¼šè®¾ç½®å¤‡ç”¨è¾“å‡ºè·¯å¾„
- **å®‰å…¨åŠ å›º**ï¼šè®¤è¯ã€æƒé™ã€åŠ å¯†ä¸‰é‡ä¿éšœ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Redisè¾“å‡ºå¿«å¦‚é£ï¼Œç¼“å­˜é˜Ÿåˆ—è§£è€¦æ¾
- é”®åæ¨¡æ¿æŒ‰éœ€è®¾ï¼ŒPipelineæ‰¹é‡æ€§èƒ½å‡  
- è®¤è¯æƒé™å®‰å…¨é”ï¼Œè¶…æ—¶é‡è¯•ä¿å¯é 
- ç›‘æ§è°ƒè¯•å¸¸ç›¸ä¼´ï¼Œç”Ÿäº§ç¯å¢ƒç¨³å¦‚å±±