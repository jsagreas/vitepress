---
title: 35ã€template.ymlæ¨¡æ¿é…ç½®
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯æ¨¡æ¿é…ç½®](#1-ä»€ä¹ˆæ˜¯æ¨¡æ¿é…ç½®)
2. [ç´¢å¼•æ¨¡æ¿åŸºç¡€](#2-ç´¢å¼•æ¨¡æ¿åŸºç¡€)
3. [å­—æ®µæ˜ å°„æ¨¡æ¿](#3-å­—æ®µæ˜ å°„æ¨¡æ¿)
4. [è®¾ç½®æ¨¡æ¿é…ç½®](#4-è®¾ç½®æ¨¡æ¿é…ç½®)
5. [åˆ«åæ¨¡æ¿è®¾ç½®](#5-åˆ«åæ¨¡æ¿è®¾ç½®)
6. [ç”Ÿå‘½å‘¨æœŸæ¨¡æ¿](#6-ç”Ÿå‘½å‘¨æœŸæ¨¡æ¿)
7. [ç»„ä»¶æ¨¡æ¿é…ç½®](#7-ç»„ä»¶æ¨¡æ¿é…ç½®)
8. [æ¨¡æ¿ä¼˜å…ˆçº§ä¸ç‰ˆæœ¬ç®¡ç†](#8-æ¨¡æ¿ä¼˜å…ˆçº§ä¸ç‰ˆæœ¬ç®¡ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯æ¨¡æ¿é…ç½®


### 1.1 æ¨¡æ¿é…ç½®çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Elasticsearchæ¨¡æ¿ï¼Ÿ**
```
ç®€å•ç†è§£ï¼šæ¨¡æ¿å°±åƒæ˜¯ä¸€ä¸ª"è£…ä¿®æ ·æ¿é—´"
- å½“æ–°å»ºç´¢å¼•æ—¶ï¼Œè‡ªåŠ¨æŒ‰ç…§æ¨¡æ¿æ¥è®¾ç½®
- åŒ…æ‹¬å­—æ®µç±»å‹ã€ç´¢å¼•è®¾ç½®ã€åˆ«åç­‰
- é¿å…æ¯æ¬¡æ‰‹åŠ¨é…ç½®ï¼Œæé«˜ä¸€è‡´æ€§

ç”Ÿæ´»ç±»æ¯”ï¼š
å°±åƒè£…ä¿®æˆ¿å­æ—¶çš„æ ·æ¿é—´è®¾è®¡å›¾ï¼š
â€¢ è§„å®šäº†å®¢å…è¦å¤šå¤§ï¼ˆç´¢å¼•è®¾ç½®ï¼‰
â€¢ ç¡®å®šäº†ç”µå™¨æ‘†æ”¾ä½ç½®ï¼ˆå­—æ®µæ˜ å°„ï¼‰
â€¢ è®¾ç½®äº†æˆ¿é—´åˆ«åï¼ˆç´¢å¼•åˆ«åï¼‰
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ¨¡æ¿ï¼Ÿ**
```
å®é™…é—®é¢˜ï¼š
1. æ¯å¤©äº§ç”Ÿæ–°çš„æ—¥å¿—ç´¢å¼•ï¼ˆå¦‚log-2025-09-21ï¼‰
2. æ‰‹åŠ¨é…ç½®æ¯ä¸ªç´¢å¼•å¤ªéº»çƒ¦
3. ä¸åŒç¯å¢ƒéœ€è¦ä¿æŒé…ç½®ä¸€è‡´æ€§

æ¨¡æ¿è§£å†³æ–¹æ¡ˆï¼š
â€¢ è‡ªåŠ¨åŒ–ï¼šæ–°ç´¢å¼•è‡ªåŠ¨åº”ç”¨é…ç½®
â€¢ æ ‡å‡†åŒ–ï¼šç¡®ä¿æ‰€æœ‰ç´¢å¼•ç»“æ„ä¸€è‡´
â€¢ ä¾¿ç®¡ç†ï¼šé›†ä¸­ç®¡ç†é…ç½®ç­–ç•¥
```

### 1.2 æ¨¡æ¿çš„å·¥ä½œåŸç†


**ğŸ”„ æ¨¡æ¿åº”ç”¨æµç¨‹**
```
æ•°æ®å†™å…¥è¿‡ç¨‹ï¼š
å®¢æˆ·ç«¯ â†’ Filebeat â†’ Elasticsearch

1. Filebeatæ”¶é›†æ—¥å¿—æ•°æ®
2. å‘ESå‘é€æ•°æ®åˆ°ç´¢å¼•ï¼ˆå¦‚filebeat-2025.09.21ï¼‰
3. ESæ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨
4. å¦‚æœä¸å­˜åœ¨ï¼ŒæŸ¥æ‰¾åŒ¹é…çš„æ¨¡æ¿
5. æ ¹æ®æ¨¡æ¿åˆ›å»ºæ–°ç´¢å¼•
6. åº”ç”¨æ¨¡æ¿ä¸­çš„æ‰€æœ‰é…ç½®

ç´¢å¼•å‘½åç¤ºä¾‹ï¼š
filebeat-2025.09.21  â† åŒ¹é…æ¨¡æ¿ "filebeat-*"
filebeat-2025.09.22  â† åŒ¹é…æ¨¡æ¿ "filebeat-*"
app-log-2025.09.21   â† åŒ¹é…æ¨¡æ¿ "app-log-*"
```

---

## 2. ğŸ“‹ ç´¢å¼•æ¨¡æ¿åŸºç¡€


### 2.1 åŸºç¡€ç´¢å¼•æ¨¡æ¿é…ç½®


**ğŸ”§ æœ€ç®€å•çš„æ¨¡æ¿é…ç½®**

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šå…ˆä»æœ€ç®€å•çš„å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚æ€§

```yaml
# filebeat.yml ä¸­çš„æ¨¡æ¿é…ç½®
setup.template.enabled: true
setup.template.name: "my-filebeat"
setup.template.pattern: "filebeat-*"

# åŸºç¡€è®¾ç½®
setup.template.settings:
  number_of_shards: 1        # åˆ†ç‰‡æ•°é‡ï¼ˆå°æ•°æ®é‡ç”¨1ä¸ªï¼‰
  number_of_replicas: 1      # å‰¯æœ¬æ•°é‡ï¼ˆä¿è¯å¯é æ€§ï¼‰
  refresh_interval: "5s"     # æ•°æ®åˆ·æ–°é—´éš”
```

**ğŸ“Š å‚æ•°è¯¦è§£è¡¨æ ¼**

| å‚æ•° | ä½œç”¨ | æ–°æ‰‹å»ºè®®å€¼ | è¯´æ˜ |
|------|------|------------|------|
| `enabled` | ğŸ”§ å¯ç”¨æ¨¡æ¿ | `true` | å¿…é¡»å¼€å¯æ‰èƒ½ä½¿ç”¨æ¨¡æ¿ |
| `name` | ğŸ“ æ¨¡æ¿åç§° | `"my-filebeat"` | ç»™æ¨¡æ¿èµ·ä¸ªå®¹æ˜“è®°çš„åå­— |
| `pattern` | ğŸ¯ åŒ¹é…è§„åˆ™ | `"filebeat-*"` | å†³å®šå“ªäº›ç´¢å¼•ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿ |
| `number_of_shards` | ğŸ“¦ åˆ†ç‰‡æ•°é‡ | `1` | å°é¡¹ç›®ç”¨1ä¸ªï¼Œå¤§é¡¹ç›®æ ¹æ®æ•°æ®é‡è°ƒæ•´ |
| `number_of_replicas` | ğŸ”„ å‰¯æœ¬æ•°é‡ | `1` | è‡³å°‘1ä¸ªå‰¯æœ¬ä¿è¯æ•°æ®å®‰å…¨ |

### 2.2 å®Œæ•´çš„ç´¢å¼•æ¨¡æ¿ç¤ºä¾‹


```yaml
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
setup.template.enabled: true
setup.template.name: "filebeat-production"
setup.template.pattern: "filebeat-*"

# è¯¦ç»†è®¾ç½®
setup.template.settings:
  # === æ€§èƒ½ç›¸å…³è®¾ç½® ===
  number_of_shards: 3           # åˆ†ç‰‡æ•°ï¼šæ ¹æ®æ•°æ®é‡è°ƒæ•´
  number_of_replicas: 1         # å‰¯æœ¬æ•°ï¼šç”Ÿäº§ç¯å¢ƒè‡³å°‘1ä¸ª
  refresh_interval: "30s"       # åˆ·æ–°é—´éš”ï¼šå¹³è¡¡æ€§èƒ½å’Œå®æ—¶æ€§
  
  # === å­˜å‚¨ä¼˜åŒ– ===
  codec: "best_compression"     # å‹ç¼©æ–¹å¼ï¼šèŠ‚çœå­˜å‚¨ç©ºé—´
  
  # === ç´¢å¼•è®¾ç½® ===
  max_result_window: 50000      # æœ€å¤§æŸ¥è¯¢ç»“æœæ•°
  
  # === åˆ†æå™¨è®¾ç½® ===
  analysis:
    analyzer:
      my_analyzer:
        type: "standard"
        stopwords: "_none_"
```

**ğŸ¯ é…ç½®é€‰æ‹©æŒ‡å—**

```
å°å‹é¡¹ç›®ï¼ˆ< 1GB/å¤©ï¼‰ï¼š
â€¢ number_of_shards: 1
â€¢ refresh_interval: "5s"
â€¢ é‡ç‚¹ï¼šç®€å•å¤Ÿç”¨

ä¸­å‹é¡¹ç›®ï¼ˆ1-10GB/å¤©ï¼‰ï¼š
â€¢ number_of_shards: 3
â€¢ refresh_interval: "30s"  
â€¢ é‡ç‚¹ï¼šæ€§èƒ½å¹³è¡¡

å¤§å‹é¡¹ç›®ï¼ˆ> 10GB/å¤©ï¼‰ï¼š
â€¢ number_of_shards: 5-10
â€¢ refresh_interval: "60s"
â€¢ é‡ç‚¹ï¼šä¼˜åŒ–æ€§èƒ½
```

---

## 3. ğŸ—ºï¸ å­—æ®µæ˜ å°„æ¨¡æ¿


### 3.1 ä»€ä¹ˆæ˜¯å­—æ®µæ˜ å°„


**ğŸ”¸ å­—æ®µæ˜ å°„çš„é€šä¿—è§£é‡Š**

```
ç±»æ¯”ç†è§£ï¼šå­—æ®µæ˜ å°„å°±åƒ"æ•°æ®å­—å…¸"
â€¢ å‘Šè¯‰ESæ¯ä¸ªå­—æ®µæ˜¯ä»€ä¹ˆç±»å‹
â€¢ å†³å®šå­—æ®µå¦‚ä½•è¢«å­˜å‚¨å’Œæœç´¢
â€¢ å°±åƒExcelè¡¨æ ¼çš„åˆ—æ ¼å¼è®¾ç½®

ç¤ºä¾‹å¯¹æ¯”ï¼š
åŸå§‹æ—¥å¿—ï¼š2025-09-21 14:30:00 [ERROR] User login failed
æ˜ å°„åï¼š
â€¢ timestamp: dateç±»å‹
â€¢ level: keywordç±»å‹  
â€¢ message: textç±»å‹
```

### 3.2 å¸¸ç”¨å­—æ®µç±»å‹é…ç½®


**ğŸ“ åŸºç¡€å­—æ®µæ˜ å°„é…ç½®**

```yaml
setup.template.mappings:
  properties:
    # === æ—¶é—´å­—æ®µ ===
    "@timestamp":
      type: "date"
      format: "strict_date_optional_time||epoch_millis"
    
    # === æ—¥å¿—çº§åˆ«ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ ===
    log.level:
      type: "keyword"           # ä¸åˆ†è¯ï¼Œç²¾ç¡®åŒ¹é…
      ignore_above: 256         # è¶…è¿‡256å­—ç¬¦å¿½ç•¥
    
    # === æ¶ˆæ¯å†…å®¹ï¼ˆå…¨æ–‡æœç´¢ï¼‰ ===
    message:
      type: "text"              # åˆ†è¯ï¼Œæ”¯æŒå…¨æ–‡æœç´¢
      analyzer: "standard"      # ä½¿ç”¨æ ‡å‡†åˆ†æå™¨
      fields:
        keyword:                # åŒæ—¶æ”¯æŒç²¾ç¡®åŒ¹é…
          type: "keyword"
          ignore_above: 512
    
    # === ä¸»æœºä¿¡æ¯ ===
    host.name:
      type: "keyword"
    
    # === æ•°å€¼å­—æ®µ ===
    response_time:
      type: "long"              # æ•´æ•°ç±»å‹
    
    memory_usage:
      type: "float"             # æµ®ç‚¹æ•°ç±»å‹
```

**ğŸ“Š å­—æ®µç±»å‹é€‰æ‹©æŒ‡å—**

| æ•°æ®ç‰¹ç‚¹ | æ¨èç±»å‹ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|----------|----------|----------|------|
| ğŸ”¤ **ç²¾ç¡®å€¼** | `keyword` | è¿‡æ»¤ã€èšåˆ | æ—¥å¿—çº§åˆ«ã€çŠ¶æ€ç  |
| ğŸ“ **æ–‡æœ¬å†…å®¹** | `text` | å…¨æ–‡æœç´¢ | é”™è¯¯æ¶ˆæ¯ã€æè¿° |
| ğŸ“… **æ—¶é—´æ•°æ®** | `date` | æ—¶é—´èŒƒå›´æŸ¥è¯¢ | æ—¶é—´æˆ³ã€æ—¥æœŸ |
| ğŸ”¢ **æ•´æ•°** | `long` | æ•°å€¼è®¡ç®— | è®¡æ•°ã€ID |
| ğŸ¯ **å°æ•°** | `float` | ç»Ÿè®¡åˆ†æ | ç™¾åˆ†æ¯”ã€è¯„åˆ† |
| âœ… **å¸ƒå°”å€¼** | `boolean` | æ¡ä»¶åˆ¤æ–­ | æ˜¯å¦æˆåŠŸ |

### 3.3 åŠ¨æ€å­—æ®µæ˜ å°„


**ğŸ”„ è‡ªåŠ¨æ˜ å°„é…ç½®**

```yaml
setup.template.mappings:
  # === åŠ¨æ€æ˜ å°„è®¾ç½® ===
  dynamic: true                 # å…è®¸è‡ªåŠ¨åˆ›å»ºæ–°å­—æ®µ
  
  # === åŠ¨æ€æ¨¡æ¿ ===
  dynamic_templates:
    - string_fields:
        match_mapping_type: "string"
        mapping:
          type: "text"
          fields:
            keyword:
              type: "keyword"
              ignore_above: 256
    
    - numeric_fields:
        match_mapping_type: "long"
        mapping:
          type: "long"
          
  properties:
    # å…·ä½“å­—æ®µæ˜ å°„...
```

**âš¡ åŠ¨æ€æ˜ å°„ç­–ç•¥**

```
strictæ¨¡å¼ï¼šæ‹’ç»æœªå®šä¹‰å­—æ®µ
â€¢ ä¼˜ç‚¹ï¼šä¸¥æ ¼æ§åˆ¶ï¼Œé¿å…é”™è¯¯
â€¢ ç¼ºç‚¹ï¼šçµæ´»æ€§å·®
â€¢ é€‚åˆï¼šç”Ÿäº§ç¯å¢ƒï¼Œå­—æ®µå›ºå®š

trueæ¨¡å¼ï¼šè‡ªåŠ¨åˆ›å»ºå­—æ®µ  
â€¢ ä¼˜ç‚¹ï¼šçµæ´»æ€§å¥½
â€¢ ç¼ºç‚¹ï¼šå¯èƒ½äº§ç”Ÿåƒåœ¾å­—æ®µ
â€¢ é€‚åˆï¼šå¼€å‘ç¯å¢ƒï¼Œæ•°æ®æ¢ç´¢

falseæ¨¡å¼ï¼šå¿½ç•¥æœªå®šä¹‰å­—æ®µ
â€¢ ä¼˜ç‚¹ï¼šé¿å…åƒåœ¾å­—æ®µ
â€¢ ç¼ºç‚¹ï¼šæ•°æ®å¯èƒ½ä¸¢å¤±
â€¢ é€‚åˆï¼šç‰¹å®šåœºæ™¯è¿‡æ»¤
```

---

## 4. âš™ï¸ è®¾ç½®æ¨¡æ¿é…ç½®


### 4.1 ç´¢å¼•æ€§èƒ½è®¾ç½®


**ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®**

```yaml
setup.template.settings:
  # === åŸºç¡€æ€§èƒ½è®¾ç½® ===
  number_of_shards: 3
  number_of_replicas: 1
  refresh_interval: "30s"
  
  # === å†™å…¥ä¼˜åŒ– ===
  translog:
    durability: "async"         # å¼‚æ­¥äº‹åŠ¡æ—¥å¿—ï¼Œæå‡å†™å…¥æ€§èƒ½
    sync_interval: "5s"         # åŒæ­¥é—´éš”
    flush_threshold_size: "512mb" # åˆ·æ–°é˜ˆå€¼
  
  # === å­˜å‚¨ä¼˜åŒ– ===
  codec: "best_compression"     # æœ€ä½³å‹ç¼©
  
  # === åˆå¹¶ç­–ç•¥ ===
  merge:
    policy:
      max_merge_at_once: 5      # åŒæ—¶åˆå¹¶çš„æ®µæ•°
      segments_per_tier: 4      # æ¯å±‚æ®µæ•°
```

**ğŸ“ˆ æ€§èƒ½å‚æ•°è§£é‡Š**

```
ğŸ”¸ refresh_intervalï¼ˆåˆ·æ–°é—´éš”ï¼‰
ä½œç”¨ï¼šæ§åˆ¶æ•°æ®å¯è§æ€§å»¶è¿Ÿ
â€¢ "1s"ï¼šè¿‘å®æ—¶ï¼Œé«˜CPUæ¶ˆè€—
â€¢ "30s"ï¼šå¹³è¡¡é€‰æ‹©
â€¢ "60s"ï¼šé«˜æ€§èƒ½ï¼Œé€‚åˆæ‰¹é‡å†™å…¥

ğŸ”¸ translog.durabilityï¼ˆäº‹åŠ¡æŒä¹…æ€§ï¼‰
â€¢ "request"ï¼šæ¯æ¬¡å†™å…¥éƒ½æŒä¹…åŒ–ï¼ˆå®‰å…¨ï¼‰
â€¢ "async"ï¼šå¼‚æ­¥æŒä¹…åŒ–ï¼ˆæ€§èƒ½ï¼‰

ğŸ”¸ codecï¼ˆå‹ç¼©æ–¹å¼ï¼‰
â€¢ "default"ï¼šé»˜è®¤å‹ç¼©ï¼Œé€Ÿåº¦å¿«
â€¢ "best_compression"ï¼šæœ€ä½³å‹ç¼©ï¼ŒèŠ‚çœç©ºé—´
```

### 4.2 æ•°æ®ä¿ç•™è®¾ç½®


```yaml
setup.template.settings:
  # === ç”Ÿå‘½å‘¨æœŸç®¡ç† ===
  lifecycle:
    name: "filebeat-policy"     # å…³è”ç”Ÿå‘½å‘¨æœŸç­–ç•¥
    rollover_alias: "filebeat-latest"
  
  # === åˆ†ç‰‡åˆ†é… ===
  routing:
    allocation:
      total_shards_per_node: 3  # æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§åˆ†ç‰‡æ•°
      
  # === æŸ¥è¯¢é™åˆ¶ ===
  max_result_window: 50000      # æœ€å¤§æŸ¥è¯¢ç»“æœæ•°
  max_rescore_window: 10000     # é‡è¯„åˆ†çª—å£å¤§å°
```

---

## 5. ğŸ·ï¸ åˆ«åæ¨¡æ¿è®¾ç½®


### 5.1 ç´¢å¼•åˆ«ååŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç´¢å¼•åˆ«åï¼Ÿ**

```
ç®€å•ç†è§£ï¼šåˆ«åå°±åƒ"å¿«æ·æ–¹å¼"
â€¢ ç»™ç´¢å¼•èµ·ä¸ªå®¹æ˜“è®°çš„åå­—
â€¢ å¯ä»¥æŒ‡å‘å¤šä¸ªç´¢å¼•
â€¢ æ–¹ä¾¿åº”ç”¨ç¨‹åºä½¿ç”¨

ç”Ÿæ´»ç±»æ¯”ï¼š
çœŸå®åœ°å€ï¼šåŒ—äº¬å¸‚æœé˜³åŒºxxè¡—é“xxå·xxå®¤
åˆ«åï¼šæˆ‘çš„å®¶

ç´¢å¼•å®ä¾‹ï¼š
çœŸå®ç´¢å¼•ï¼šfilebeat-2025.09.21, filebeat-2025.09.22
åˆ«åï¼šfilebeat-latest, filebeat-logs
```

### 5.2 åˆ«åé…ç½®ç¤ºä¾‹


**ğŸ”§ åŸºç¡€åˆ«åé…ç½®**

```yaml
setup.template.aliases:
  # === æœ€æ–°æ•°æ®åˆ«å ===
  filebeat-latest:
    filter:
      range:
        "@timestamp":
          gte: "now-7d"         # æœ€è¿‘7å¤©çš„æ•°æ®
  
  # === é”™è¯¯æ—¥å¿—åˆ«å ===
  filebeat-errors:
    filter:
      term:
        log.level: "ERROR"      # åªåŒ…å«é”™è¯¯æ—¥å¿—
  
  # === åº”ç”¨åˆ«å ===
  filebeat-app:
    filter:
      wildcard:
        fields.service: "app-*" # åŒ¹é…åº”ç”¨æœåŠ¡
```

**ğŸ¯ åˆ«åä½¿ç”¨åœºæ™¯**

| åˆ«åç±»å‹ | é…ç½®ç¤ºä¾‹ | ä½¿ç”¨åœºæ™¯ | ä¼˜åŠ¿ |
|----------|----------|----------|------|
| ğŸ“… **æ—¶é—´åˆ«å** | `filebeat-today` | æŸ¥è¯¢å½“å¤©æ•°æ® | è‡ªåŠ¨æŒ‡å‘å½“å‰ç´¢å¼• |
| ğŸš¨ **çº§åˆ«åˆ«å** | `filebeat-errors` | é”™è¯¯æ—¥å¿—åˆ†æ | å¿«é€Ÿå®šä½é—®é¢˜ |
| ğŸ¢ **åº”ç”¨åˆ«å** | `app-prod` | ç”Ÿäº§ç¯å¢ƒç›‘æ§ | é€»è¾‘åˆ†ç»„ç®¡ç† |
| ğŸ“Š **ç»Ÿè®¡åˆ«å** | `filebeat-stats` | æ•°æ®åˆ†æ | ç®€åŒ–æŸ¥è¯¢æ“ä½œ |

### 5.3 åŠ¨æ€åˆ«åé…ç½®


```yaml
# åœ¨Filebeatä¸­é…ç½®åŠ¨æ€åˆ«å
output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-%{+yyyy.MM.dd}"
  
  # === åˆ«åé…ç½® ===
  ilm:
    enabled: true
    rollover_alias: "filebeat-active"   # æ´»è·ƒæ•°æ®åˆ«å
    pattern: "filebeat-*"
    policy: "filebeat-policy"

# æ¨¡æ¿ä¸­çš„åˆ«åè®¾ç½®
setup.template.aliases:
  filebeat-all: {}                      # å…¨éƒ¨æ•°æ®åˆ«å
  filebeat-recent:                      # æœ€è¿‘æ•°æ®åˆ«å
    filter:
      range:
        "@timestamp":
          gte: "now-1d"
```

---

## 6. ğŸ”„ ç”Ÿå‘½å‘¨æœŸæ¨¡æ¿


### 6.1 ä»€ä¹ˆæ˜¯ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ


**ğŸ”¸ ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¦‚å¿µ**

```
ç®€å•ç†è§£ï¼šå°±åƒæ–‡ä»¶çš„"è‡ªåŠ¨æ•´ç†"
â€¢ Hoté˜¶æ®µï¼šæ–°æ•°æ®ï¼Œé¢‘ç¹è¯»å†™
â€¢ Warmé˜¶æ®µï¼šæ—§æ•°æ®ï¼Œå¶å°”æŸ¥è¯¢  
â€¢ Coldé˜¶æ®µï¼šå†å²æ•°æ®ï¼Œå¾ˆå°‘è®¿é—®
â€¢ Deleteé˜¶æ®µï¼šè¿‡æœŸæ•°æ®ï¼Œè‡ªåŠ¨åˆ é™¤

ç”Ÿæ´»ç±»æ¯”ï¼š
â€¢ Hotï¼šä»Šå¤©çš„ç…§ç‰‡ï¼ˆç»å¸¸çœ‹ï¼‰
â€¢ Warmï¼šä¸Šæœˆçš„ç…§ç‰‡ï¼ˆå¶å°”çœ‹ï¼‰
â€¢ Coldï¼šå»å¹´çš„ç…§ç‰‡ï¼ˆå¾ˆå°‘çœ‹ï¼‰
â€¢ Deleteï¼š10å¹´å‰çš„ç…§ç‰‡ï¼ˆåˆ é™¤ï¼‰
```

### 6.2 ç”Ÿå‘½å‘¨æœŸç­–ç•¥é…ç½®


**ğŸ”§ å®Œæ•´ç”Ÿå‘½å‘¨æœŸé…ç½®**

```yaml
# åœ¨Filebeatä¸­å¯ç”¨ILM
setup.ilm.enabled: true
setup.ilm.rollover_alias: "filebeat-active"
setup.ilm.pattern: "filebeat-*"
setup.ilm.policy: "filebeat-lifecycle"

# ç”Ÿå‘½å‘¨æœŸç­–ç•¥ï¼ˆé€šè¿‡APIåˆ›å»ºï¼‰
setup.ilm.check_exists: false
setup.ilm.overwrite: true

# æ¨¡æ¿ä¸­å…³è”ç”Ÿå‘½å‘¨æœŸ
setup.template.settings:
  lifecycle:
    name: "filebeat-lifecycle"
    rollover_alias: "filebeat-active"
```

**ğŸ“‹ ç­–ç•¥é˜¶æ®µé…ç½®**

```json
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "5GB",      // ç´¢å¼•è¾¾åˆ°5GBæ—¶æ»šåŠ¨
            "max_age": "1d"         // æˆ–è€…1å¤©åæ»šåŠ¨
          },
          "set_priority": {
            "priority": 100         // é«˜ä¼˜å…ˆçº§
          }
        }
      },
      "warm": {
        "min_age": "7d",            // 7å¤©åè¿›å…¥warmé˜¶æ®µ
        "actions": {
          "allocate": {
            "number_of_replicas": 0  // å‡å°‘å‰¯æœ¬èŠ‚çœç©ºé—´
          },
          "forcemerge": {
            "max_num_segments": 1    // åˆå¹¶æ®µï¼Œä¼˜åŒ–å­˜å‚¨
          },
          "set_priority": {
            "priority": 50           // ä¸­ç­‰ä¼˜å…ˆçº§
          }
        }
      },
      "cold": {
        "min_age": "30d",           // 30å¤©åè¿›å…¥coldé˜¶æ®µ
        "actions": {
          "allocate": {
            "number_of_replicas": 0
          }
        }
      },
      "delete": {
        "min_age": "90d"            // 90å¤©ååˆ é™¤
      }
    }
  }
}
```

### 6.3 ç®€åŒ–çš„ç”Ÿå‘½å‘¨æœŸé…ç½®


**âš¡ æ–°æ‰‹æ¨èé…ç½®**

```yaml
# ç®€å•çš„3é˜¶æ®µé…ç½®
setup.ilm.enabled: true
setup.ilm.rollover_alias: "filebeat"
setup.ilm.pattern: "filebeat-*"

# è‡ªå®šä¹‰ç­–ç•¥åç§°
setup.ilm.policy: "simple-filebeat"
```

**ğŸ¯ ç®€åŒ–ç­–ç•¥ç¤ºä¾‹**

| é˜¶æ®µ | æ—¶é—´ | åŠ¨ä½œ | ç›®çš„ |
|------|------|------|------|
| ğŸ”¥ **Hot** | å½“å‰ | æ­£å¸¸è¯»å†™ | å¤„ç†æœ€æ–°æ•°æ® |
| â„ï¸ **Cold** | 7å¤©å | å‡å°‘å‰¯æœ¬ | èŠ‚çœå­˜å‚¨ç©ºé—´ |
| ğŸ—‘ï¸ **Delete** | 30å¤©å | è‡ªåŠ¨åˆ é™¤ | æ¸…ç†è¿‡æœŸæ•°æ® |

---

## 7. ğŸ§© ç»„ä»¶æ¨¡æ¿é…ç½®


### 7.1 ä»€ä¹ˆæ˜¯ç»„ä»¶æ¨¡æ¿


**ğŸ”¸ ç»„ä»¶æ¨¡æ¿æ¦‚å¿µ**

```
ç®€å•ç†è§£ï¼šç»„ä»¶æ¨¡æ¿å°±åƒ"ç§¯æœ¨å—"
â€¢ å¯ä»¥ç»„åˆä½¿ç”¨çš„é…ç½®ç‰‡æ®µ
â€¢ æé«˜é…ç½®å¤ç”¨æ€§
â€¢ ä¾¿äºç»´æŠ¤å’Œç®¡ç†

æ¨¡å—åŒ–æ€ç»´ï¼š
â€¢ åŸºç¡€æ¨¡æ¿ï¼šé€šç”¨è®¾ç½®
â€¢ æ—¥å¿—æ¨¡æ¿ï¼šæ—¥å¿—ç‰¹å®šé…ç½®
â€¢ ç›‘æ§æ¨¡æ¿ï¼šç›‘æ§ç›¸å…³è®¾ç½®
```

### 7.2 ç»„ä»¶æ¨¡æ¿ç¤ºä¾‹


**ğŸ”§ åŸºç¡€ç»„ä»¶æ¨¡æ¿**

```yaml
# åŸºç¡€è®¾ç½®ç»„ä»¶
setup.template.name: "filebeat-base"
setup.template.component_templates:
  - name: "base-settings"
    template:
      settings:
        number_of_replicas: 1
        refresh_interval: "30s"
        codec: "best_compression"
  
  - name: "base-mappings"  
    template:
      mappings:
        properties:
          "@timestamp":
            type: "date"
          "host.name":
            type: "keyword"
          "log.level":
            type: "keyword"
```

**ğŸ“¦ ä¸“ç”¨ç»„ä»¶æ¨¡æ¿**

```yaml
# åº”ç”¨æ—¥å¿—ç»„ä»¶
- name: "app-log-mappings"
  template:
    mappings:
      properties:
        app.name:
          type: "keyword"
        app.version:
          type: "keyword"
        response_time:
          type: "long"
        status_code:
          type: "short"

# ç³»ç»Ÿç›‘æ§ç»„ä»¶  
- name: "system-metrics"
  template:
    mappings:
      properties:
        cpu.percent:
          type: "float"
        memory.used:
          type: "long"
        disk.free:
          type: "long"
```

### 7.3 ç»„ä»¶æ¨¡æ¿ç»„åˆä½¿ç”¨


**ğŸ¯ æ¨¡æ¿ç»§æ‰¿é…ç½®**

```yaml
# æœ€ç»ˆç´¢å¼•æ¨¡æ¿
setup.template.name: "filebeat-complete"
setup.template.pattern: "filebeat-*"

# ç»„åˆå¤šä¸ªç»„ä»¶
setup.template.composed_of:
  - "base-settings"        # åŸºç¡€è®¾ç½®
  - "base-mappings"        # åŸºç¡€å­—æ®µæ˜ å°„
  - "app-log-mappings"     # åº”ç”¨æ—¥å¿—å­—æ®µ
  - "lifecycle-settings"   # ç”Ÿå‘½å‘¨æœŸè®¾ç½®

# æ¨¡æ¿ä¼˜å…ˆçº§
setup.template.priority: 200
```

---

## 8. ğŸ“ˆ æ¨¡æ¿ä¼˜å…ˆçº§ä¸ç‰ˆæœ¬ç®¡ç†


### 8.1 æ¨¡æ¿ä¼˜å…ˆçº§æœºåˆ¶


**ğŸ”¸ ä¼˜å…ˆçº§å·¥ä½œåŸç†**

```
ä¼˜å…ˆçº§è§„åˆ™ï¼šæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜
â€¢ 1-100ï¼šç³»ç»Ÿæ¨¡æ¿
â€¢ 101-200ï¼šåº”ç”¨æ¨¡æ¿  
â€¢ 201-300ï¼šè‡ªå®šä¹‰æ¨¡æ¿

åŒ¹é…é¡ºåºï¼š
1. æ£€æŸ¥æ‰€æœ‰åŒ¹é…çš„æ¨¡æ¿
2. æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½æ’åº
3. åº”ç”¨é…ç½®ï¼ˆé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ï¼‰
```

### 8.2 ä¼˜å…ˆçº§é…ç½®ç¤ºä¾‹


**âš–ï¸ ä¼˜å…ˆçº§è®¾ç½®**

```yaml
# åŸºç¡€æ¨¡æ¿ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
setup.template.name: "filebeat-base"
setup.template.pattern: "filebeat-*"
setup.template.priority: 100

# åº”ç”¨æ¨¡æ¿ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰  
setup.template.name: "filebeat-app"
setup.template.pattern: "filebeat-app-*"
setup.template.priority: 150

# ç”Ÿäº§æ¨¡æ¿ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
setup.template.name: "filebeat-prod"
setup.template.pattern: "filebeat-prod-*"  
setup.template.priority: 200
```

### 8.3 ç‰ˆæœ¬ç®¡ç†é…ç½®


**ğŸ”„ æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶**

```yaml
# ç‰ˆæœ¬åŒ–æ¨¡æ¿ç®¡ç†
setup.template.name: "filebeat-v2"
setup.template.pattern: "filebeat-*"
setup.template.version: 2

# ç‰ˆæœ¬å‡çº§é…ç½®
setup.template.settings:
  meta:
    version: "2.1.0"
    description: "Updated mappings for new log format"
    created_by: "log-team"
    created_at: "2025-09-21"

# æ¨¡æ¿æ›´æ–°ç­–ç•¥
setup.template.overwrite: false    # ä¸è¦†ç›–ç°æœ‰æ¨¡æ¿
setup.template.append_fields: true # è¿½åŠ æ–°å­—æ®µ
```

**ğŸ“‹ ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ**

| åœºæ™¯ | é…ç½®ç­–ç•¥ | ä¼˜åŠ¿ | æ³¨æ„äº‹é¡¹ |
|------|----------|------|----------|
| ğŸ†• **æ–°éƒ¨ç½²** | `overwrite: true` | ç¡®ä¿æœ€æ–°é…ç½® | ä¼šè¦†ç›–ç°æœ‰è®¾ç½® |
| ğŸ”„ **å‡çº§** | `overwrite: false` | ä¿æŠ¤ç°æœ‰æ•°æ® | éœ€è¦æ‰‹åŠ¨ç®¡ç†å†²çª |
| ğŸ§ª **æµ‹è¯•** | `name: "test-template"` | éš”ç¦»æµ‹è¯•ç¯å¢ƒ | ä½¿ç”¨ä¸åŒåç§° |
| ğŸ­ **ç”Ÿäº§** | ç‰ˆæœ¬å·ç®¡ç† | å¯è¿½æº¯å˜æ›´ | ä¸¥æ ¼æµ‹è¯•åéƒ¨ç½² |

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¨¡æ¿ä½œç”¨ï¼šè‡ªåŠ¨åŒ–ç´¢å¼•é…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§
ğŸ”¸ å­—æ®µæ˜ å°„ï¼šå®šä¹‰æ•°æ®ç±»å‹ï¼Œå½±å“æœç´¢å’Œå­˜å‚¨
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸï¼šè‡ªåŠ¨ç®¡ç†æ•°æ®ä»åˆ›å»ºåˆ°åˆ é™¤
ğŸ”¸ ç»„ä»¶åŒ–ï¼šæ¨¡å—åŒ–é…ç½®ï¼Œæé«˜å¤ç”¨æ€§
ğŸ”¸ ä¼˜å…ˆçº§ï¼šæ§åˆ¶æ¨¡æ¿åº”ç”¨é¡ºåºå’Œè¦†ç›–å…³ç³»
```

### 9.2 æ–°æ‰‹å¸¸è§é—®é¢˜ä¸è§£å†³


**â“ å¸¸è§é—®é¢˜é€ŸæŸ¥**

```
é—®é¢˜1ï¼šæ•°æ®å†™å…¥åæœç´¢ä¸åˆ°
è§£å†³ï¼šæ£€æŸ¥refresh_intervalè®¾ç½®ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…åˆ·æ–°

é—®é¢˜2ï¼šç´¢å¼•å ç”¨ç©ºé—´è¿‡å¤§  
è§£å†³ï¼šå¯ç”¨å‹ç¼©(codec: "best_compression")ï¼Œé…ç½®ç”Ÿå‘½å‘¨æœŸ

é—®é¢˜3ï¼šæŸ¥è¯¢æ€§èƒ½æ…¢
è§£å†³ï¼šä¼˜åŒ–å­—æ®µæ˜ å°„ï¼Œåˆç†è®¾ç½®åˆ†ç‰‡æ•°é‡

é—®é¢˜4ï¼šæ¨¡æ¿ä¸ç”Ÿæ•ˆ
è§£å†³ï¼šæ£€æŸ¥patternåŒ¹é…è§„åˆ™ï¼Œç¡®è®¤ä¼˜å…ˆçº§è®¾ç½®

é—®é¢˜5ï¼šå­—æ®µç±»å‹é”™è¯¯
è§£å†³ï¼šè®¾ç½®åŠ¨æ€æ˜ å°„æˆ–é¢„å®šä¹‰å­—æ®µç±»å‹
```

### 9.3 é…ç½®å»ºè®®æ€»ç»“


**ğŸ¯ æ–°æ‰‹é…ç½®å»ºè®®**

```
å¼€å‘ç¯å¢ƒï¼š
âœ… ç®€å•é…ç½®ä¼˜å…ˆ
âœ… å¯ç”¨åŠ¨æ€æ˜ å°„  
âœ… è¾ƒçŸ­çš„ç”Ÿå‘½å‘¨æœŸ(7å¤©)
âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•

ç”Ÿäº§ç¯å¢ƒï¼š
âœ… ä¸¥æ ¼çš„å­—æ®µæ˜ å°„
âœ… ä¼˜åŒ–çš„æ€§èƒ½è®¾ç½®
âœ… åˆç†çš„ç”Ÿå‘½å‘¨æœŸ(30-90å¤©)
âœ… ç›‘æ§å’Œå‘Šè­¦
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†è¦ç‚¹**

```
æ¨¡æ¿ä¸‰è¦ç´ ï¼š
â€¢ Patternï¼šå†³å®šåŒ¹é…èŒƒå›´
â€¢ Settingsï¼šæ§åˆ¶æ€§èƒ½å’Œå­˜å‚¨  
â€¢ Mappingsï¼šå®šä¹‰å­—æ®µç±»å‹

é…ç½®åŸåˆ™ï¼š
â€¢ å…ˆç®€å•åå¤æ‚
â€¢ å…ˆæµ‹è¯•åç”Ÿäº§
â€¢ å…ˆå•ä¸€åç»„åˆ
â€¢ ç‰ˆæœ¬åŒ–ç®¡ç†å˜æ›´
```

**ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®**

1. **å®è·µæ“ä½œ**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒé…ç½®åŸºç¡€æ¨¡æ¿
2. **ç›‘æ§è§‚å¯Ÿ**ï¼šæŸ¥çœ‹æ¨¡æ¿åº”ç”¨æ•ˆæœå’Œæ€§èƒ½æŒ‡æ ‡
3. **é€æ­¥ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…æ•°æ®é‡è°ƒæ•´é…ç½®å‚æ•°
4. **æ·±å…¥å­¦ä¹ **ï¼šäº†è§£Elasticsearché›†ç¾¤ç®¡ç†å’Œä¼˜åŒ–

---

> ğŸ’­ **å­¦ä¹ å°è´´å£«**ï¼šæ¨¡æ¿é…ç½®çœ‹èµ·æ¥å¤æ‚ï¼Œä½†æ ¸å¿ƒå°±æ˜¯"è®©ESçŸ¥é“æ€ä¹ˆå¤„ç†ä½ çš„æ•°æ®"ã€‚ä»æœ€ç®€å•çš„é…ç½®å¼€å§‹ï¼Œé€æ­¥å¢åŠ åŠŸèƒ½ï¼Œæ¯æ¬¡åªæ”¹å˜ä¸€ä¸ªå‚æ•°ï¼Œè§‚å¯Ÿæ•ˆæœã€‚è®°ä½ï¼šå¥½çš„æ¨¡æ¿é…ç½®æ˜¯æ…¢æ…¢è°ƒä¼˜å‡ºæ¥çš„ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§å®Œç¾çš„ï¼