---
title: 17ã€mysql.yml.disabledé…ç½®
---
## ðŸ“š ç›®å½•

1. [MySQLæ¨¡å—åŸºç¡€æ¦‚å¿µ](#1-MySQLæ¨¡å—åŸºç¡€æ¦‚å¿µ)
2. [MySQLæ—¥å¿—ç±»åž‹è¯¦è§£](#2-MySQLæ—¥å¿—ç±»åž‹è¯¦è§£)
3. [MySQLæ¨¡å—é…ç½®å®žè·µ](#3-MySQLæ¨¡å—é…ç½®å®žè·µ)
4. [é”™è¯¯æ—¥å¿—é…ç½®è¯¦è§£](#4-é”™è¯¯æ—¥å¿—é…ç½®è¯¦è§£)
5. [æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®è¯¦è§£](#5-æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®è¯¦è§£)
6. [äºŒè¿›åˆ¶æ—¥å¿—é…ç½®è¯¦è§£](#6-äºŒè¿›åˆ¶æ—¥å¿—é…ç½®è¯¦è§£)
7. [å¤šè¡Œæ—¥å¿—å¤„ç†é…ç½®](#7-å¤šè¡Œæ—¥å¿—å¤„ç†é…ç½®)
8. [æ€§èƒ½ç›‘æŽ§é…ç½®å®žæˆ˜](#8-æ€§èƒ½ç›‘æŽ§é…ç½®å®žæˆ˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ MySQLæ¨¡å—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Filebeat MySQLæ¨¡å—


**ðŸ”¸ ç®€å•ç†è§£**
æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªæ•°æ®åº“ç®¡ç†å‘˜ï¼Œæ¯å¤©éœ€è¦æŸ¥çœ‹MySQLçš„å„ç§æ—¥å¿—æ–‡ä»¶æ¥äº†è§£æ•°æ®åº“çš„è¿è¡ŒçŠ¶å†µã€‚æ‰‹åŠ¨æŸ¥çœ‹è¿™äº›æ—¥å¿—æ—¢è´¹æ—¶åˆå®¹æ˜“é—æ¼é‡è¦ä¿¡æ¯ã€‚Filebeatçš„MySQLæ¨¡å—å°±åƒæ˜¯ä¸€ä¸ª**æ™ºèƒ½åŠ©æ‰‹**ï¼Œå®ƒèƒ½è‡ªåŠ¨å¸®ä½ æ”¶é›†ã€è§£æžå’Œæ•´ç†æ‰€æœ‰MySQLç›¸å…³çš„æ—¥å¿—ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç®¡ç†å‘˜ â†’ æ‰‹åŠ¨æŸ¥çœ‹é”™è¯¯æ—¥å¿— â†’ æ‰‹åŠ¨åˆ†æžæ…¢æŸ¥è¯¢ â†’ æ‰‹åŠ¨æ£€æŸ¥äºŒè¿›åˆ¶æ—¥å¿—
        â†“ è´¹æ—¶è´¹åŠ›ï¼Œå®¹æ˜“é—æ¼

Filebeat MySQLæ¨¡å—ï¼š
MySQLæ•°æ®åº“ â†’ è‡ªåŠ¨æ”¶é›†æ‰€æœ‰æ—¥å¿— â†’ æ™ºèƒ½è§£æžå†…å®¹ â†’ ç»Ÿä¸€å‘é€åˆ°Elasticsearch
          â†“ è‡ªåŠ¨åŒ–ï¼Œå…¨é¢è¦†ç›–
```

**ðŸ’¡ æ ¸å¿ƒä½œç”¨**
- **æ—¥å¿—æ”¶é›†å™¨**ï¼šè‡ªåŠ¨æŠ“å–MySQLäº§ç”Ÿçš„å„ç§æ—¥å¿—æ–‡ä»¶
- **æ™ºèƒ½è§£æžå™¨**ï¼šæŠŠåŽŸå§‹æ—¥å¿—è½¬æ¢æˆç»“æž„åŒ–æ•°æ®
- **æ•°æ®ä¼ è¾“å™¨**ï¼šå°†å¤„ç†å¥½çš„æ•°æ®å‘é€åˆ°åˆ†æžç³»ç»Ÿ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦MySQLæ¨¡å—


**ðŸŽ¯ è§£å†³çš„å®žé™…é—®é¢˜**

| é—®é¢˜åœºæ™¯ | ä¼ ç»Ÿæ–¹å¼çš„å›°éš¾ | MySQLæ¨¡å—çš„è§£å†³æ–¹æ¡ˆ |
|---------|---------------|-------------------|
| ðŸš¨ **æ•°æ®åº“å¼‚å¸¸ç›‘æŽ§** | éœ€è¦äººå·¥å®šæœŸæŸ¥çœ‹é”™è¯¯æ—¥å¿— | è‡ªåŠ¨æ”¶é›†å¹¶å®žæ—¶å‘Šè­¦ |
| ðŸŒ **æ€§èƒ½é—®é¢˜æŽ’æŸ¥** | æ‰‹åŠ¨åˆ†æžæ…¢æŸ¥è¯¢æ—¥å¿— | è‡ªåŠ¨è§£æžå¹¶å¯è§†åŒ–å±•ç¤º |
| ðŸ” **æ•°æ®å˜æ›´è¿½è¸ª** | äºŒè¿›åˆ¶æ—¥å¿—éš¾ä»¥è§£è¯» | ç»“æž„åŒ–å±•ç¤ºæ•°æ®å˜æ›´ |
| ðŸ“Š **è¶‹åŠ¿åˆ†æž** | åŽ†å²æ•°æ®éš¾ä»¥ç»Ÿè®¡ | å»ºç«‹æ—¶é—´åºåˆ—æ•°æ® |

### 1.3 MySQLæ¨¡å—çš„å·¥ä½œæµç¨‹


**ðŸ”„ å®Œæ•´å·¥ä½œæµç¨‹**
```
MySQLæ•°æ®åº“è¿è¡Œ
        â†“
äº§ç”Ÿå„ç§ç±»åž‹æ—¥å¿—æ–‡ä»¶
        â†“
Filebeat MySQLæ¨¡å—æ£€æµ‹åˆ°æ—¥å¿—å˜åŒ–
        â†“
æ ¹æ®é…ç½®è§„åˆ™æ”¶é›†å¯¹åº”æ—¥å¿—
        â†“
ä½¿ç”¨å†…ç½®è§£æžå™¨å¤„ç†æ—¥å¿—å†…å®¹
        â†“
æ·»åŠ å…ƒæ•°æ®å’Œæ ‡ç­¾ä¿¡æ¯
        â†“
å‘é€åˆ°Elasticsearchæˆ–å…¶ä»–è¾“å‡ºç«¯
        â†“
åœ¨Kibanaä¸­è¿›è¡Œå¯è§†åŒ–åˆ†æž
```

---

## 2. ðŸ“ MySQLæ—¥å¿—ç±»åž‹è¯¦è§£


### 2.1 é”™è¯¯æ—¥å¿—ï¼ˆError Logï¼‰


**ðŸ”¸ è¿™æ˜¯ä»€ä¹ˆ**
é”™è¯¯æ—¥å¿—å°±åƒæ˜¯MySQLæ•°æ®åº“çš„"å¥åº·ä½“æ£€æŠ¥å‘Š"ï¼Œè®°å½•äº†æ•°æ®åº“å¯åŠ¨ã€è¿è¡Œå’Œå…³é—­è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‰€æœ‰é—®é¢˜å’Œé‡è¦äº‹ä»¶ã€‚

**ðŸ“‹ è®°å½•å†…å®¹**
```
ðŸš¨ ä¸¥é‡é”™è¯¯ï¼šæ•°æ®åº“æ— æ³•å¯åŠ¨ã€è¡¨æŸå
âš ï¸ è­¦å‘Šä¿¡æ¯ï¼šé…ç½®é—®é¢˜ã€æƒé™é—®é¢˜
â„¹ï¸ é‡è¦äº‹ä»¶ï¼šæœåŠ¡å¯åŠ¨/åœæ­¢ã€è¿žæŽ¥å¼‚å¸¸
ðŸ”§ è°ƒè¯•ä¿¡æ¯ï¼šå†…éƒ¨çŠ¶æ€å˜åŒ–
```

**ðŸ’¼ å®žé™…åº”ç”¨åœºæ™¯**
> **åœºæ™¯1**ï¼šå‡Œæ™¨2ç‚¹æ•°æ®åº“çªç„¶æ— æ³•è¿žæŽ¥
> é€šè¿‡é”™è¯¯æ—¥å¿—å¯ä»¥å¿«é€Ÿå®šä½æ˜¯ç£ç›˜ç©ºé—´ä¸è¶³è¿˜æ˜¯å†…å­˜æº¢å‡º

> **åœºæ™¯2**ï¼šåº”ç”¨ç¨‹åºæŠ¥å‘Š"è¿žæŽ¥è¢«æ‹’ç»"  
> é”™è¯¯æ—¥å¿—èƒ½æ˜¾ç¤ºæ˜¯å¦è¾¾åˆ°äº†æœ€å¤§è¿žæŽ¥æ•°é™åˆ¶

### 2.2 æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰


**ðŸ”¸ è¿™æ˜¯ä»€ä¹ˆ**
æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰§è¡Œæ—¶é—´è¶…è¿‡è®¾å®šé˜ˆå€¼çš„SQLè¯­å¥ï¼Œå°±åƒæ˜¯æ•°æ®åº“çš„"æ€§èƒ½ä½“æ£€æŠ¥å‘Š"ã€‚

**â±ï¸ é»˜è®¤é˜ˆå€¼è¯´æ˜Ž**
```
é»˜è®¤æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼š10ç§’
æ„æ€ï¼šä»»ä½•æ‰§è¡Œæ—¶é—´è¶…è¿‡10ç§’çš„SQLéƒ½ä¼šè¢«è®°å½•

å®žé™…åœºæ™¯ï¼š
SELECT * FROM orders WHERE create_time > '2023-01-01';
â†‘ å¦‚æžœè¿™ä¸ªæŸ¥è¯¢ç”¨äº†15ç§’ï¼Œå°±ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—
```

**ðŸŽ¯ é‡è¦æ€§åˆ†æž**
- **æ€§èƒ½ç“¶é¢ˆå®šä½**ï¼šæ‰¾å‡ºæ‹–æ…¢ç³»ç»Ÿçš„å…·ä½“SQLè¯­å¥
- **ç´¢å¼•ä¼˜åŒ–æŒ‡å¯¼**ï¼šè¯†åˆ«éœ€è¦æ·»åŠ ç´¢å¼•çš„æŸ¥è¯¢
- **ä¸šåŠ¡å½±å“è¯„ä¼°**ï¼šäº†è§£æ…¢æŸ¥è¯¢å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“

### 2.3 äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBinary Logï¼‰


**ðŸ”¸ è¿™æ˜¯ä»€ä¹ˆ**
äºŒè¿›åˆ¶æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ”¹å˜æ•°æ®åº“æ•°æ®çš„æ“ä½œï¼Œå°±åƒæ˜¯æ•°æ®åº“çš„"æ“ä½œå½•åƒå¸¦"ã€‚

**ðŸ“Š è®°å½•çš„æ“ä½œç±»åž‹**
```
INSERTï¼šæ–°å¢žæ•°æ®è®°å½•
UPDATEï¼šä¿®æ”¹æ•°æ®è®°å½•  
DELETEï¼šåˆ é™¤æ•°æ®è®°å½•
CREATE/DROPï¼šè¡¨ç»“æž„å˜æ›´
ALTERï¼šè¡¨ç»“æž„ä¿®æ”¹
```

**ðŸ” ä¸»è¦ç”¨é€”**
- **æ•°æ®å¤åˆ¶**ï¼šä¸»ä»Žå¤åˆ¶çš„åŸºç¡€
- **æ•°æ®æ¢å¤**ï¼šç»“åˆå¤‡ä»½è¿›è¡Œç‚¹å¯¹ç‚¹æ¢å¤
- **å®¡è®¡è¿½è¸ª**ï¼šè¿½è¸ªæ•°æ®å˜æ›´åŽ†å²

---

## 3. âš™ï¸ MySQLæ¨¡å—é…ç½®å®žè·µ


### 3.1 æ¨¡å—å¯ç”¨é…ç½®


**ðŸ“ éš¾åº¦ç­‰çº§**ï¼šðŸŸ¢ åŸºç¡€

**ðŸ”§ åŸºæœ¬å¯ç”¨æ–¹æ³•**

```yaml
# filebeat.yml åŸºç¡€é…ç½®
filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: true
  reload.period: 10s

# æ¨¡å—å¯ç”¨
filebeat.modules:
- module: mysql
  error:
    enabled: true
    var.paths: ["/var/log/mysql/error.log"]
  slowlog:
    enabled: true  
    var.paths: ["/var/log/mysql/mysql-slow.log"]
```

**ðŸ’¡ é…ç½®è§£é‡Š**
- `reload.enabled: true`ï¼šå…è®¸åŠ¨æ€é‡æ–°åŠ è½½é…ç½®
- `reload.period: 10s`ï¼šæ¯10ç§’æ£€æŸ¥ä¸€æ¬¡é…ç½®å˜åŒ–
- `var.paths`ï¼šæŒ‡å®šMySQLæ—¥å¿—æ–‡ä»¶çš„å…·ä½“è·¯å¾„

### 3.2 æ¨¡å—æ–‡ä»¶ç®¡ç†


**ðŸ—‚ï¸ æ¨¡å—æ–‡ä»¶ä½ç½®**
```
Filebeatå®‰è£…ç›®å½•ç»“æž„ï¼š
â”œâ”€â”€ filebeat.yml          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ modules.d/            # æ¨¡å—é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ mysql.yml         # MySQLæ¨¡å—é…ç½®
â”‚   â”œâ”€â”€ nginx.yml.disabled # æœªå¯ç”¨çš„Nginxæ¨¡å—
â”‚   â””â”€â”€ apache.yml.disabled # æœªå¯ç”¨çš„Apacheæ¨¡å—
```

**ðŸ”„ æ¨¡å—å¯ç”¨å‘½ä»¤**
```bash
# å¯ç”¨MySQLæ¨¡å—
./filebeat modules enable mysql

# æŸ¥çœ‹å·²å¯ç”¨çš„æ¨¡å—
./filebeat modules list

# ç¦ç”¨MySQLæ¨¡å—  
./filebeat modules disable mysql
```

### 3.3 å®Œæ•´çš„MySQLæ¨¡å—é…ç½®æ–‡ä»¶


**ðŸ“‹ modules.d/mysql.yml å®Œæ•´é…ç½®**

```yaml
# MySQLæ¨¡å—é…ç½®æ–‡ä»¶
- module: mysql
  
  # é”™è¯¯æ—¥å¿—é…ç½®
  error:
    enabled: true
    
    # æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
    var.paths:
      - /var/log/mysql/error.log
      - /var/log/mysqld.log
      - /var/log/mysql/mysqld.err
    
    # å¤šè¡Œæ—¥å¿—å¤„ç†ï¼ˆMySQLé”™è¯¯æ—¥å¿—å¯èƒ½è·¨å¤šè¡Œï¼‰
    multiline.pattern: '^\d{4}-\d{2}-\d{2}'
    multiline.negate: true
    multiline.match: after
    
    # æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
    fields:
      log_type: mysql_error
      environment: production
    
    # å­—æ®µé…ç½®
    fields_under_root: true
    
  # æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®  
  slowlog:
    enabled: true
    
    # æ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„
    var.paths:
      - /var/log/mysql/mysql-slow.log
      - /var/log/mysql/slow.log
    
    # å¤šè¡ŒSQLè¯­å¥å¤„ç†
    multiline.pattern: '^# Time:|^# User@Host:'
    multiline.negate: true
    multiline.match: after
    
    # æ·»åŠ æ ‡ç­¾
    tags: ["mysql", "slowlog", "performance"]
    
    # è‡ªå®šä¹‰å­—æ®µ
    fields:
      log_type: mysql_slowlog
      environment: production
      
  # äºŒè¿›åˆ¶æ—¥å¿—é…ç½®ï¼ˆé€šå¸¸ä¸ç›´æŽ¥ç›‘æŽ§ï¼Œå› ä¸ºæ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼‰
  # å¦‚æžœéœ€è¦ç›‘æŽ§ï¼Œå»ºè®®ä½¿ç”¨MySQLçš„äº‹ä»¶è¡¨
```

---

## 4. ðŸš¨ é”™è¯¯æ—¥å¿—é…ç½®è¯¦è§£


### 4.1 é”™è¯¯æ—¥å¿—è·¯å¾„é…ç½®


**ðŸŽ¯ å¸¸è§MySQLé”™è¯¯æ—¥å¿—ä½ç½®**

| æ“ä½œç³»ç»Ÿ | é»˜è®¤è·¯å¾„ | å¤‡æ³¨ |
|---------|----------|------|
| **Ubuntu/Debian** | `/var/log/mysql/error.log` | é€šè¿‡aptå®‰è£… |
| **CentOS/RHEL** | `/var/log/mysqld.log` | é€šè¿‡yumå®‰è£… |
| **è‡ªå®šä¹‰å®‰è£…** | `/usr/local/mysql/data/hostname.err` | ç¼–è¯‘å®‰è£… |
| **Dockerå®¹å™¨** | `/var/log/mysql/error.log` | å®¹å™¨å†…è·¯å¾„ |

**ðŸ”§ çµæ´»è·¯å¾„é…ç½®**
```yaml
error:
  enabled: true
  var.paths:
    # æ”¯æŒå¤šä¸ªå¯èƒ½çš„è·¯å¾„
    - /var/log/mysql/error.log
    - /var/log/mysqld.log  
    - /var/log/mysql/*.log
    # æ”¯æŒé€šé…ç¬¦åŒ¹é…
    - /opt/mysql/logs/error*.log
```

### 4.2 é”™è¯¯æ—¥å¿—å¤šè¡Œå¤„ç†


**ðŸ“ MySQLé”™è¯¯æ—¥å¿—çš„ç‰¹ç‚¹**

MySQLé”™è¯¯æ—¥å¿—é€šå¸¸æ˜¯è¿™æ ·çš„æ ¼å¼ï¼š
```
2024-09-21T10:30:45.123456Z 0 [Note] Starting MySQL...
2024-09-21T10:30:45.234567Z 0 [ERROR] InnoDB: Operating system error number 28 in a file operation.
2024-09-21T10:30:45.234568Z 0 [ERROR] InnoDB: Error number 28 means 'No space left on device'.
2024-09-21T10:30:45.234569Z 0 [ERROR] InnoDB: Some operating system error details...
```

**ðŸ” å¤šè¡Œå¤„ç†é…ç½®è§£æž**
```yaml
error:
  # å¤šè¡Œæ—¥å¿—å¤„ç†è§„åˆ™
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'  # åŒ¹é…æ—¶é—´æˆ³å¼€å¤´
  multiline.negate: true                    # å–ååŒ¹é…
  multiline.match: after                   # å°†ä¸åŒ¹é…çš„è¡Œé™„åŠ åˆ°ä¸Šä¸€è¡Œ
```

**ðŸ’¡ é…ç½®å«ä¹‰è§£é‡Š**
- `pattern: '^\d{4}-\d{2}-\d{2}'`ï¼šæŸ¥æ‰¾ä»¥æ—¥æœŸå¼€å¤´çš„è¡Œï¼ˆå¦‚2024-09-21ï¼‰
- `negate: true`ï¼šå¯¹åŒ¹é…ç»“æžœå–åï¼Œå³"ä¸æ˜¯"ä»¥æ—¥æœŸå¼€å¤´çš„è¡Œ
- `match: after`ï¼šå°†è¿™äº›è¡Œåˆå¹¶åˆ°å‰ä¸€ä¸ªä»¥æ—¥æœŸå¼€å¤´çš„è¡Œä¹‹åŽ

### 4.3 é”™è¯¯æ—¥å¿—è§£æžå­—æ®µ


**ðŸ“Š Filebeatè§£æžåŽçš„å­—æ®µç»“æž„**
```yaml
è§£æžåŽçš„æ–‡æ¡£ç»“æž„ï¼š
{
  "@timestamp": "2024-09-21T10:30:45.123Z",
  "mysql": {
    "error": {
      "timestamp": "2024-09-21T10:30:45.123456Z",
      "thread_id": 0,
      "level": "ERROR",
      "subsystem": "InnoDB", 
      "message": "Operating system error number 28..."
    }
  },
  "log": {
    "file": {
      "path": "/var/log/mysql/error.log"
    }
  },
  "fields": {
    "log_type": "mysql_error",
    "environment": "production"
  }
}
```

---

## 5. ðŸŒ æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®è¯¦è§£


### 5.1 æ…¢æŸ¥è¯¢æ—¥å¿—å¯ç”¨é…ç½®


**ðŸ”§ MySQLæœåŠ¡å™¨ç«¯é…ç½®**

é¦–å…ˆéœ€è¦åœ¨MySQLæœåŠ¡å™¨ä¸Šå¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š
```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';

-- è®¾ç½®æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆç§’ï¼‰
SET GLOBAL long_query_time = 2;

-- è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„
SET GLOBAL slow_query_log_file = '/var/log/mysql/mysql-slow.log';

-- è®°å½•æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SET GLOBAL log_queries_not_using_indexes = 'ON';
```

**ðŸ“ Filebeaté…ç½®**
```yaml
slowlog:
  enabled: true
  
  # æ…¢æŸ¥è¯¢æ—¥å¿—è·¯å¾„
  var.paths:
    - /var/log/mysql/mysql-slow.log
    - /var/log/mysql/slow.log
    
  # å¤šè¡ŒSQLå¤„ç†
  multiline.pattern: '^# Time:|^# User@Host:|^SET timestamp='
  multiline.negate: true
  multiline.match: after
  
  # æ·»åŠ æœ‰ç”¨çš„æ ‡ç­¾å’Œå­—æ®µ
  tags: ["mysql", "slowlog", "performance"]
  fields:
    log_type: mysql_slowlog
    criticality: high
```

### 5.2 æ…¢æŸ¥è¯¢æ—¥å¿—æ ¼å¼è§£æž


**ðŸ“‹ å…¸åž‹çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ ¼å¼**
```
# Time: 2024-09-21T10:30:45.123456Z
# User@Host: app_user[app_user] @ [192.168.1.100] Id: 12345
# Query_time: 15.234567  Lock_time: 0.000123  Rows_sent: 1000  Rows_examined: 500000
SET timestamp=1695293445;
SELECT o.*, c.name as customer_name 
FROM orders o 
LEFT JOIN customers c ON o.customer_id = c.id 
WHERE o.create_time >= '2024-01-01' 
ORDER BY o.create_time DESC;
```

**ðŸ” å­—æ®µå«ä¹‰è§£é‡Š**
- `Query_time: 15.234567`ï¼šSQLæ‰§è¡Œæ€»æ—¶é—´ï¼ˆ15.23ç§’ï¼‰
- `Lock_time: 0.000123`ï¼šç­‰å¾…é”çš„æ—¶é—´
- `Rows_sent: 1000`ï¼šè¿”å›žç»™å®¢æˆ·ç«¯çš„è¡Œæ•°
- `Rows_examined: 500000`ï¼šMySQLæ‰«æçš„è¡Œæ•°

### 5.3 æ…¢æŸ¥è¯¢åˆ†æžé…ç½®


**ðŸ“Š æ€§èƒ½åˆ†æžå­—æ®µé…ç½®**
```yaml
slowlog:
  enabled: true
  var.paths: ["/var/log/mysql/mysql-slow.log"]
  
  # å¤„ç†å™¨é…ç½®ï¼Œç”¨äºŽæå–å…³é”®æ€§èƒ½æŒ‡æ ‡
  processors:
    - script:
        lang: javascript
        source: >
          function process(event) {
            var message = event.Get("message");
            
            // æå–æŸ¥è¯¢æ—¶é—´
            var queryTimeMatch = message.match(/Query_time:\s*(\d+\.\d+)/);
            if (queryTimeMatch) {
              event.Put("mysql.slowlog.query_time_sec", parseFloat(queryTimeMatch[1]));
            }
            
            // æå–æ‰«æè¡Œæ•°
            var rowsExaminedMatch = message.match(/Rows_examined:\s*(\d+)/);
            if (rowsExaminedMatch) {
              event.Put("mysql.slowlog.rows_examined", parseInt(rowsExaminedMatch[1]));
            }
            
            // è®¡ç®—æ‰«ææ•ˆçŽ‡
            var rowsSent = event.Get("mysql.slowlog.rows_sent");
            var rowsExamined = event.Get("mysql.slowlog.rows_examined");
            if (rowsSent && rowsExamined && rowsExamined > 0) {
              var efficiency = (rowsSent / rowsExamined) * 100;
              event.Put("mysql.slowlog.scan_efficiency_percent", efficiency);
            }
          }
```

---

## 6. ðŸ“ äºŒè¿›åˆ¶æ—¥å¿—é…ç½®è¯¦è§£


### 6.1 äºŒè¿›åˆ¶æ—¥å¿—çš„ç‰¹æ®Šæ€§


**ðŸ”¸ ä¸ºä»€ä¹ˆäºŒè¿›åˆ¶æ—¥å¿—ç‰¹æ®Š**

äºŒè¿›åˆ¶æ—¥å¿—ä¸åŒäºŽé”™è¯¯æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå®ƒæ˜¯ä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨çš„ï¼Œç›´æŽ¥ç”¨æ–‡æœ¬å·¥å…·æ— æ³•é˜…è¯»ã€‚å› æ­¤ï¼Œé€šå¸¸ä¸ç›´æŽ¥ç”¨Filebeatç›‘æŽ§binlogæ–‡ä»¶ã€‚

```
é”™è¯¯æ—¥å¿—å’Œæ…¢æŸ¥è¯¢æ—¥å¿—ï¼š
æ–‡æœ¬æ ¼å¼ â†’ å¯ä»¥ç›´æŽ¥è¯»å– â†’ Filebeatå¯ä»¥å¤„ç†

äºŒè¿›åˆ¶æ—¥å¿—ï¼š
äºŒè¿›åˆ¶æ ¼å¼ â†’ éœ€è¦ä¸“é—¨å·¥å…·è§£æž â†’ Filebeatæ— æ³•ç›´æŽ¥å¤„ç†
```

### 6.2 ç›‘æŽ§äºŒè¿›åˆ¶æ—¥å¿—çš„æ›¿ä»£æ–¹æ¡ˆ


**ðŸŽ¯ æ–¹æ¡ˆ1ï¼šä½¿ç”¨MySQLå®¡è®¡è¡¨**
```yaml
# ç›‘æŽ§MySQLçš„performance_schemaæˆ–information_schema
# è€Œä¸æ˜¯ç›´æŽ¥ç›‘æŽ§binlogæ–‡ä»¶

input_type: log
paths: ["/tmp/mysql_audit.log"]

# é…åˆè„šæœ¬å®šæœŸå¯¼å‡ºäºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯
```

**ðŸŽ¯ æ–¹æ¡ˆ2ï¼šä½¿ç”¨MySQL Events**
```sql
-- åœ¨MySQLä¸­åˆ›å»ºå®šæ—¶äº‹ä»¶ï¼Œå°†binlogä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶
CREATE EVENT log_binlog_status
ON SCHEDULE EVERY 1 MINUTE
DO
  INSERT INTO mysql_audit_log 
  SELECT NOW(), 'BINLOG_STATUS', 
         CONCAT('Position: ', $$global.gtid_executed);
```

**ðŸŽ¯ æ–¹æ¡ˆ3ï¼šç›‘æŽ§binlogæ–‡ä»¶å˜åŒ–**
```yaml
# å¦‚æžœåªéœ€è¦ç›‘æŽ§binlogæ–‡ä»¶çš„å˜åŒ–æƒ…å†µ
- type: filestream
  id: mysql-binlog-files
  paths:
    - /var/lib/mysql/mysql-bin.*
  
  # åªç›‘æŽ§æ–‡ä»¶å…ƒæ•°æ®ï¼Œä¸è¯»å–å†…å®¹
  include_lines: ['^$']  # åªåŒ¹é…ç©ºè¡Œï¼Œå®žé™…ä¸è¯»å–å†…å®¹
  
  processors:
    - add_fields:
        fields:
          log_type: mysql_binlog_metadata
          action: file_change
```

---

## 7. ðŸ”„ å¤šè¡Œæ—¥å¿—å¤„ç†é…ç½®


### 7.1 å¤šè¡Œæ—¥å¿—çš„æŒ‘æˆ˜


**ðŸ¤” ä»€ä¹ˆæ˜¯å¤šè¡Œæ—¥å¿—é—®é¢˜**

æƒ³è±¡ä½ åœ¨è®°å½•ä¸€ä¸ªé•¿æ•…äº‹ï¼Œä½†æ¯æ¬¡åªèƒ½å†™ä¸€è¡Œã€‚MySQLçš„æ—¥å¿—å°±æ˜¯è¿™æ ·ï¼Œä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼‰å¯èƒ½åˆ†æ•£åœ¨å¤šè¡Œä¸­ã€‚

```
å•è¡Œæ—¥å¿—ï¼ˆç®€å•ï¼‰ï¼š
2024-09-21 10:30:45 [ERROR] Connection failed

å¤šè¡Œæ—¥å¿—ï¼ˆå¤æ‚ï¼‰ï¼š
2024-09-21 10:30:45 [ERROR] InnoDB: Operating system error
InnoDB: Additional error details here
InnoDB: Stack trace information
InnoDB: End of error report
2024-09-21 10:30:46 [NOTE] Next log entry starts
```

**ðŸŽ¯ æŒ‘æˆ˜è¯´æ˜Ž**
- å¦‚æžœä¸æ­£ç¡®å¤„ç†ï¼Œæ¯ä¸€è¡Œéƒ½ä¼šè¢«å½“ä½œç‹¬ç«‹çš„æ—¥å¿—äº‹ä»¶
- è¿™ä¼šå¯¼è‡´ä¿¡æ¯åˆ†æ•£ï¼Œæ— æ³•å®Œæ•´åˆ†æžé—®é¢˜
- éœ€è¦å°†ç›¸å…³çš„å¤šè¡Œåˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„æ—¥å¿—äº‹ä»¶

### 7.2 å¤šè¡Œå¤„ç†ç­–ç•¥


**ðŸ“‹ MySQLä¸åŒæ—¥å¿—çš„å¤šè¡Œæ¨¡å¼**

| æ—¥å¿—ç±»åž‹ | å¤šè¡Œç‰¹å¾ | å¤„ç†ç­–ç•¥ |
|---------|----------|----------|
| **é”™è¯¯æ—¥å¿—** | ä»¥æ—¶é—´æˆ³å¼€å¤´ | åŒ¹é…æ—¶é—´æˆ³æ¨¡å¼ |
| **æ…¢æŸ¥è¯¢æ—¥å¿—** | ä»¥# Time:æˆ–# User@Host:å¼€å¤´ | åŒ¹é…ç‰¹æ®Šæ ‡è®° |
| **é€šç”¨æŸ¥è¯¢æ—¥å¿—** | ä»¥æ—¶é—´æˆ³å¼€å¤´ | åŒ¹é…æ—¶é—´æˆ³æ¨¡å¼ |

**ðŸ”§ é”™è¯¯æ—¥å¿—å¤šè¡Œé…ç½®**
```yaml
error:
  multiline.pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}'
  multiline.negate: true
  multiline.match: after
  multiline.max_lines: 50        # æœ€å¤šåˆå¹¶50è¡Œ
  multiline.timeout: 30s         # 30ç§’è¶…æ—¶
```

**ðŸ”§ æ…¢æŸ¥è¯¢æ—¥å¿—å¤šè¡Œé…ç½®**
```yaml
slowlog:
  multiline.pattern: '^# Time:|^# User@Host:'
  multiline.negate: true  
  multiline.match: after
  multiline.max_lines: 100       # SQLå¯èƒ½å¾ˆé•¿
  multiline.timeout: 10s
```

### 7.3 å¤šè¡Œå¤„ç†æœ€ä½³å®žè·µ


**âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®**
```yaml
# å®Œæ•´çš„å¤šè¡Œå¤„ç†é…ç½®
mysql:
  error:
    enabled: true
    var.paths: ["/var/log/mysql/error.log"]
    
    # å¤šè¡Œå¤„ç†
    multiline.pattern: '^\d{4}-\d{2}-\d{2}'
    multiline.negate: true
    multiline.match: after
    multiline.max_lines: 50       # é™åˆ¶æœ€å¤§è¡Œæ•°ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º
    multiline.timeout: 30s        # è¶…æ—¶è®¾ç½®ï¼Œé¿å…é˜»å¡ž
    
    # æ€§èƒ½ä¼˜åŒ–
    close_inactive: 5m            # 5åˆ†é’Ÿä¸æ´»è·ƒåˆ™å…³é—­æ–‡ä»¶å¥æŸ„
    scan_frequency: 10s           # æ¯10ç§’æ‰«æä¸€æ¬¡æ–‡ä»¶å˜åŒ–
    harvester_buffer_size: 16384  # è¯»å–ç¼“å†²åŒºå¤§å°
    
    # é”™è¯¯å¤„ç†
    ignore_older: 24h             # å¿½ç•¥24å°æ—¶å‰çš„æ—¥å¿—
    
  slowlog:
    enabled: true
    var.paths: ["/var/log/mysql/mysql-slow.log"]
    
    # SQLè¯­å¥å¯èƒ½å¾ˆé•¿ï¼Œéœ€è¦æ›´å¤§çš„ç¼“å†²
    multiline.pattern: '^# Time:|^# User@Host:'
    multiline.negate: true
    multiline.match: after  
    multiline.max_lines: 200      # SQLè¯­å¥å¯èƒ½å¾ˆé•¿
    multiline.timeout: 15s
    
    # æ€§èƒ½ä¼˜åŒ–
    close_inactive: 10m
    scan_frequency: 30s
```

**ðŸ” è°ƒè¯•å¤šè¡Œå¤„ç†**
```yaml
# æ·»åŠ è°ƒè¯•é…ç½®æ¥éªŒè¯å¤šè¡Œå¤„ç†æ˜¯å¦æ­£ç¡®
logging.level: debug
logging.selectors: ["input"]

# åœ¨æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä¿¡æ¯ï¼š
# "Multiline event flushed because timeout reached"
# "Multiline pattern matched, starting new multiline event"
```

---

## 8. ðŸ“Š æ€§èƒ½ç›‘æŽ§é…ç½®å®žæˆ˜


### 8.1 MySQLæ€§èƒ½ç›‘æŽ§æŒ‡æ ‡


**ðŸŽ¯ å…³é”®æ€§èƒ½æŒ‡æ ‡ä½“ç³»**

```
æ•°æ®åº“å¥åº·åº¦ç›‘æŽ§ä½“ç³»ï¼š
â”œâ”€â”€ ðŸ“ˆ è¿žæŽ¥æ€§èƒ½
â”‚   â”œâ”€â”€ è¿žæŽ¥æ•°å˜åŒ–è¶‹åŠ¿
â”‚   â”œâ”€â”€ è¿žæŽ¥å¤±è´¥çŽ‡
â”‚   â””â”€â”€ è¿žæŽ¥è¶…æ—¶æ¬¡æ•°
â”œâ”€â”€ ðŸ” æŸ¥è¯¢æ€§èƒ½  
â”‚   â”œâ”€â”€ æ…¢æŸ¥è¯¢æ•°é‡ç»Ÿè®¡
â”‚   â”œâ”€â”€ å¹³å‡æŸ¥è¯¢æ—¶é—´
â”‚   â””â”€â”€ æŸ¥è¯¢æ‰«ææ•ˆçŽ‡
â”œâ”€â”€ ðŸ’¾ å­˜å‚¨æ€§èƒ½
â”‚   â”œâ”€â”€ InnoDBé”™è¯¯ç»Ÿè®¡
â”‚   â”œâ”€â”€ è¡¨é”ç­‰å¾…æ—¶é—´
â”‚   â””â”€â”€ ç£ç›˜ç©ºé—´å‘Šè­¦
â””â”€â”€ ðŸš¨ å¼‚å¸¸ç›‘æŽ§
    â”œâ”€â”€ é”™è¯¯é¢‘çŽ‡ç»Ÿè®¡
    â”œâ”€â”€ é‡å¯æ¬¡æ•°è®°å½•
    â””â”€â”€ æ­»é”æ£€æµ‹è®°å½•
```

### 8.2 ç»¼åˆç›‘æŽ§é…ç½®


**ðŸ”§ å®Œæ•´çš„æ€§èƒ½ç›‘æŽ§é…ç½®**
```yaml
# modules.d/mysql.yml - ç”Ÿäº§çŽ¯å¢ƒæ€§èƒ½ç›‘æŽ§é…ç½®
- module: mysql
  
  # é”™è¯¯æ—¥å¿— - ç³»ç»Ÿå¥åº·ç›‘æŽ§
  error:
    enabled: true
    var.paths: 
      - /var/log/mysql/error.log
      - /var/log/mysqld.log
    
    # å¤šè¡Œå¤„ç†
    multiline.pattern: '^\d{4}-\d{2}-\d{2}'
    multiline.negate: true
    multiline.match: after
    multiline.timeout: 30s
    
    # æ€§èƒ½æ ‡ç­¾
    tags: ["mysql", "error", "health-monitor"]
    fields:
      log_type: mysql_error
      environment: production
      datacenter: dc1
      mysql_version: "8.0"
    
    # å¤„ç†å™¨é…ç½®
    processors:
      # æå–é”™è¯¯çº§åˆ«
      - dissect:
          tokenizer: "%{timestamp} %{thread_id} [%{level}] %{message}"
          field: "message"
          target_prefix: "mysql.error"
      
      # æ·»åŠ å‘Šè­¦çº§åˆ«
      - script:
          lang: javascript
          source: >
            function process(event) {
              var level = event.Get("mysql.error.level");
              if (level === "ERROR" || level === "FATAL") {
                event.Put("alert.severity", "high");
              } else if (level === "WARNING") {
                event.Put("alert.severity", "medium"); 
              } else {
                event.Put("alert.severity", "low");
              }
            }
  
  # æ…¢æŸ¥è¯¢æ—¥å¿— - æ€§èƒ½ç›‘æŽ§
  slowlog:
    enabled: true
    var.paths:
      - /var/log/mysql/mysql-slow.log
    
    # å¤šè¡ŒSQLå¤„ç†
    multiline.pattern: '^# Time:|^# User@Host:'
    multiline.negate: true
    multiline.match: after
    multiline.timeout: 15s
    multiline.max_lines: 500
    
    # æ€§èƒ½æ ‡ç­¾
    tags: ["mysql", "slowlog", "performance"]
    fields:
      log_type: mysql_slowlog
      environment: production
      
    # å¤„ç†å™¨é…ç½® - æå–å…³é”®æ€§èƒ½æŒ‡æ ‡
    processors:
      # è§£æžæŸ¥è¯¢æ—¶é—´
      - script:
          lang: javascript
          source: >
            function process(event) {
              var message = event.Get("message");
              
              // æå–æŸ¥è¯¢æ—¶é—´
              var queryTimeMatch = message.match(/Query_time:\s*(\d+\.?\d*)/);
              if (queryTimeMatch) {
                var queryTime = parseFloat(queryTimeMatch[1]);
                event.Put("mysql.slowlog.query_time_sec", queryTime);
                
                // æ€§èƒ½ç­‰çº§åˆ†ç±»
                if (queryTime > 60) {
                  event.Put("mysql.slowlog.performance_grade", "critical");
                } else if (queryTime > 10) {
                  event.Put("mysql.slowlog.performance_grade", "poor");
                } else if (queryTime > 2) {
                  event.Put("mysql.slowlog.performance_grade", "fair");
                }
              }
              
              // æå–æ‰«æè¡Œæ•°
              var rowsExaminedMatch = message.match(/Rows_examined:\s*(\d+)/);
              var rowsSentMatch = message.match(/Rows_sent:\s*(\d+)/);
              
              if (rowsExaminedMatch && rowsSentMatch) {
                var rowsExamined = parseInt(rowsExaminedMatch[1]);
                var rowsSent = parseInt(rowsSentMatch[1]);
                
                event.Put("mysql.slowlog.rows_examined", rowsExamined);
                event.Put("mysql.slowlog.rows_sent", rowsSent);
                
                // è®¡ç®—æ‰«ææ•ˆçŽ‡
                if (rowsExamined > 0) {
                  var efficiency = (rowsSent / rowsExamined) * 100;
                  event.Put("mysql.slowlog.scan_efficiency_percent", efficiency.toFixed(2));
                  
                  // æ•ˆçŽ‡ç­‰çº§
                  if (efficiency < 1) {
                    event.Put("mysql.slowlog.efficiency_grade", "very_poor");
                  } else if (efficiency < 10) {
                    event.Put("mysql.slowlog.efficiency_grade", "poor");
                  } else if (efficiency < 50) {
                    event.Put("mysql.slowlog.efficiency_grade", "fair");
                  } else {
                    event.Put("mysql.slowlog.efficiency_grade", "good");
                  }
                }
              }
            }
```

### 8.3 å‘Šè­¦å’Œç›‘æŽ§é›†æˆ


**ðŸš¨ å‘Šè­¦é…ç½®ç¤ºä¾‹**
```yaml
# åœ¨Elasticsearchä¸­è®¾ç½®å‘Šè­¦è§„åˆ™ï¼ˆWatcheré…ç½®ï¼‰
# è¿™ä¸ªé…ç½®é€šå¸¸åœ¨Kibanaçš„Watcherä¸­è®¾ç½®

å‘Šè­¦è§„åˆ™ç¤ºä¾‹ï¼š
1. æ…¢æŸ¥è¯¢æ•°é‡å‘Šè­¦ï¼š
   - æ¡ä»¶ï¼š5åˆ†é’Ÿå†…æ…¢æŸ¥è¯¢è¶…è¿‡50ä¸ª
   - åŠ¨ä½œï¼šå‘é€é‚®ä»¶å’ŒSlacké€šçŸ¥

2. æ•°æ®åº“é”™è¯¯å‘Šè­¦ï¼š
   - æ¡ä»¶ï¼šå‡ºçŽ°ERRORæˆ–FATALçº§åˆ«æ—¥å¿—
   - åŠ¨ä½œï¼šç«‹å³å‘é€å‘Šè­¦

3. æ€§èƒ½ä¸‹é™å‘Šè­¦ï¼š
   - æ¡ä»¶ï¼šå¹³å‡æŸ¥è¯¢æ—¶é—´è¶…è¿‡åŽ†å²åŸºçº¿çš„200%
   - åŠ¨ä½œï¼šå‘é€æ€§èƒ½é¢„è­¦
```

**ðŸ“Š Kibanaä»ªè¡¨æ¿é…ç½®**
```yaml
# æŽ¨èçš„Kibanaå¯è§†åŒ–å›¾è¡¨

1. MySQLé”™è¯¯è¶‹åŠ¿å›¾ï¼š
   - ç±»åž‹ï¼šæ—¶é—´åºåˆ—å›¾
   - æŒ‡æ ‡ï¼šé”™è¯¯æ•°é‡æŒ‰æ—¶é—´åˆ†å¸ƒ
   - åˆ†ç»„ï¼šæŒ‰é”™è¯¯çº§åˆ«åˆ†ç»„

2. æ…¢æŸ¥è¯¢Top 10ï¼š
   - ç±»åž‹ï¼šæ•°æ®è¡¨æ ¼
   - æŒ‡æ ‡ï¼šæŸ¥è¯¢æ—¶é—´æœ€é•¿çš„SQL
   - å­—æ®µï¼šSQLè¯­å¥ã€æ‰§è¡Œæ—¶é—´ã€æ‰«æè¡Œæ•°

3. æ•°æ®åº“æ€§èƒ½æ¦‚è§ˆï¼š
   - ç±»åž‹ï¼šæŒ‡æ ‡ä»ªè¡¨æ¿
   - åŒ…å«ï¼šæ€»æŸ¥è¯¢æ•°ã€å¹³å‡å“åº”æ—¶é—´ã€é”™è¯¯çŽ‡

4. æ‰«ææ•ˆçŽ‡åˆ†æžï¼š
   - ç±»åž‹ï¼šé¥¼å›¾æˆ–æŸ±çŠ¶å›¾
   - æŒ‡æ ‡ï¼šæ‰«ææ•ˆçŽ‡åˆ†å¸ƒ
   - ç”¨é€”ï¼šè¯†åˆ«éœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢
```

---

## 9. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ MySQLæ¨¡å—æœ¬è´¨ï¼šä¸“é—¨å¤„ç†MySQLå„ç§æ—¥å¿—çš„æ™ºèƒ½æ”¶é›†å™¨
ðŸ”¸ ä¸‰å¤§æ—¥å¿—ç±»åž‹ï¼šé”™è¯¯æ—¥å¿—(å¥åº·)ã€æ…¢æŸ¥è¯¢æ—¥å¿—(æ€§èƒ½)ã€äºŒè¿›åˆ¶æ—¥å¿—(å®¡è®¡)
ðŸ”¸ å¤šè¡Œå¤„ç†ï¼šå°†åˆ†æ•£çš„å¤šè¡Œæ—¥å¿—åˆå¹¶æˆå®Œæ•´äº‹ä»¶
ðŸ”¸ æ€§èƒ½ç›‘æŽ§ï¼šé€šè¿‡æ—¥å¿—åˆ†æžæ¥ç›‘æŽ§æ•°æ®åº“æ€§èƒ½çŠ¶å†µ
ðŸ”¸ é…ç½®ç®¡ç†ï¼šæ¨¡å—åŒ–é…ç½®ï¼Œæ”¯æŒåŠ¨æ€é‡è½½
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ æ—¥å¿—ç±»åž‹çš„é€‰æ‹©åŽŸåˆ™**
```
é”™è¯¯æ—¥å¿—ï¼šå¿…é¡»ç›‘æŽ§
- ç”¨é€”ï¼šç³»ç»Ÿå¥åº·çŠ¶å†µç›‘æŽ§
- é‡è¦æ€§ï¼šâ­â­â­â­â­ æ ¸å¿ƒå¿…éœ€
- å‘Šè­¦çº§åˆ«ï¼šé«˜

æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šå¼ºçƒˆå»ºè®®ç›‘æŽ§
- ç”¨é€”ï¼šæ€§èƒ½ä¼˜åŒ–å’Œé—®é¢˜å®šä½
- é‡è¦æ€§ï¼šâ­â­â­â­ éžå¸¸é‡è¦
- å‘Šè­¦çº§åˆ«ï¼šä¸­

äºŒè¿›åˆ¶æ—¥å¿—ï¼šæŒ‰éœ€ç›‘æŽ§
- ç”¨é€”ï¼šå®¡è®¡å’Œæ•°æ®è¿½è¸ª
- é‡è¦æ€§ï¼šâ­â­â­ é‡è¦
- å‘Šè­¦çº§åˆ«ï¼šä½Ž
```

**ðŸ”¹ å¤šè¡Œå¤„ç†çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆé‡è¦ï¼š
- ä¿è¯æ—¥å¿—äº‹ä»¶çš„å®Œæ•´æ€§
- é¿å…ä¿¡æ¯ä¸¢å¤±å’Œåˆ†æžé”™è¯¯
- æé«˜æ—¥å¿—åˆ†æžçš„å‡†ç¡®æ€§

é…ç½®è¦ç‚¹ï¼š
- æ­£ç¡®è¯†åˆ«æ—¥å¿—å¼€å§‹æ¨¡å¼
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- é™åˆ¶æœ€å¤§è¡Œæ•°é¿å…å†…å­˜é—®é¢˜
```

**ðŸ”¹ æ€§èƒ½ç›‘æŽ§çš„å±‚æ¬¡**
```
åŸºç¡€ç›‘æŽ§ï¼šæ”¶é›†é”™è¯¯å’Œæ…¢æŸ¥è¯¢æ—¥å¿—
è¿›é˜¶ç›‘æŽ§ï¼šæ·»åŠ è‡ªå®šä¹‰å­—æ®µå’Œå¤„ç†å™¨
é«˜çº§ç›‘æŽ§ï¼šé›†æˆå‘Šè­¦å’Œè‡ªåŠ¨åŒ–åˆ†æž
ä¸“å®¶çº§ç›‘æŽ§ï¼šæ€§èƒ½åŸºçº¿å’Œè¶‹åŠ¿åˆ†æž
```

### 9.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**âœ… ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•**
- [ ] ç¡®è®¤MySQLæ—¥å¿—æ–‡ä»¶è·¯å¾„æ­£ç¡®
- [ ] é…ç½®åˆé€‚çš„å¤šè¡Œå¤„ç†è§„åˆ™  
- [ ] è®¾ç½®æ€§èƒ½ç›‘æŽ§å­—æ®µå’Œå¤„ç†å™¨
- [ ] é…ç½®å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥æ–¹å¼
- [ ] éªŒè¯Elasticsearchç´¢å¼•æ¨¡æ¿
- [ ] åˆ›å»ºKibanaç›‘æŽ§ä»ªè¡¨æ¿
- [ ] æµ‹è¯•æ—¥å¿—æ”¶é›†å’Œè§£æžæ•ˆæžœ
- [ ] è®¾ç½®æ—¥å¿—ä¿ç•™å’Œæ¸…ç†ç­–ç•¥

**ðŸŽ¯ å¸¸è§é—®é¢˜æŽ’æŸ¥**
```
é—®é¢˜1ï¼šæ—¥å¿—æ²¡æœ‰è¢«æ”¶é›†
æŽ’æŸ¥ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„ã€æƒé™ã€Filebeatè¿è¡ŒçŠ¶æ€

é—®é¢˜2ï¼šå¤šè¡Œæ—¥å¿—è¢«æ‹†åˆ†
æŽ’æŸ¥ï¼šéªŒè¯multilineé…ç½®ã€æ£€æŸ¥æ—¥å¿—æ ¼å¼

é—®é¢˜3ï¼šæ€§èƒ½å½±å“è¿‡å¤§
æŽ’æŸ¥ï¼šè°ƒæ•´scan_frequencyã€close_inactiveå‚æ•°

é—®é¢˜4ï¼šè§£æžå­—æ®µä¸æ­£ç¡®
æŽ’æŸ¥ï¼šéªŒè¯å¤„ç†å™¨é…ç½®ã€æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼
```

**ðŸš€ ä¼˜åŒ–å»ºè®®**
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- åˆç†è®¾ç½®æ‰«æé¢‘çŽ‡
- ä½¿ç”¨close_inactiveå‡å°‘èµ„æºå ç”¨
- é…ç½®ignore_olderé¿å…å¤„ç†æ—§æ—¥å¿—

å¯é æ€§ä¼˜åŒ–ï¼š
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- é…ç½®å¤±è´¥é‡è¯•æœºåˆ¶
- ç›‘æŽ§Filebeatè‡ªèº«çŠ¶æ€

ç»´æŠ¤æ€§ä¼˜åŒ–ï¼š
- ä½¿ç”¨æ¸…æ™°çš„æ ‡ç­¾å’Œå­—æ®µå‘½å
- æ·»åŠ çŽ¯å¢ƒå’Œç‰ˆæœ¬ä¿¡æ¯
- å®šæœŸæ¸…ç†å’Œè½®è½¬æ—¥å¿—
```

### 9.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ðŸ›¤ï¸ è¿›é˜¶å­¦ä¹ è·¯å¾„**
```
åŸºç¡€é˜¶æ®µï¼š
âœ… ç†è§£MySQLæ—¥å¿—ç±»åž‹å’Œä½œç”¨
âœ… æŽŒæ¡åŸºæœ¬çš„æ¨¡å—é…ç½®æ–¹æ³•
âœ… å­¦ä¼šå¯ç”¨å’Œç¦ç”¨æ¨¡å—

åº”ç”¨é˜¶æ®µï¼š  
âœ… é…ç½®å¤šè¡Œæ—¥å¿—å¤„ç†
âœ… æ·»åŠ è‡ªå®šä¹‰å­—æ®µå’Œæ ‡ç­¾
âœ… é›†æˆElasticsearchå’ŒKibana

è¿›é˜¶é˜¶æ®µï¼š
âœ… ç¼–å†™è‡ªå®šä¹‰å¤„ç†å™¨
âœ… é…ç½®å¤æ‚çš„å‘Šè­¦è§„åˆ™
âœ… ä¼˜åŒ–æ€§èƒ½å’Œèµ„æºä½¿ç”¨

ä¸“å®¶é˜¶æ®µï¼š
âœ… è®¾è®¡å®Œæ•´çš„ç›‘æŽ§ä½“ç³»
âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç†
âœ… é›†æˆå…¶ä»–ç›‘æŽ§å·¥å…·
```

**ðŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**
```
"MySQLæ¨¡å—ä¸‰æ—¥å¿—ï¼Œé”™è¯¯æ…¢æŸ¥äºŒè¿›åˆ¶"
"å¤šè¡Œå¤„ç†è¦é…å¥½ï¼Œæ€§èƒ½ç›‘æŽ§ä¸èƒ½å°‘"  
"æ ‡ç­¾å­—æ®µåŠ é½å…¨ï¼Œå‘Šè­¦ä»ªè¡¨è¦å»ºå…¨"
"ç”Ÿäº§éƒ¨ç½²è¦è°¨æ…Žï¼Œæµ‹è¯•éªŒè¯æ˜¯å…³é”®"
```

**ðŸ’¡ æœ€åŽæé†’**
- MySQLæ¨¡å—æ˜¯Filebeatæœ€å¸¸ç”¨çš„æ¨¡å—ä¹‹ä¸€ï¼ŒæŽŒæ¡å®ƒå¯¹æ—¥å¿—åˆ†æžè‡³å…³é‡è¦
- é…ç½®æ—¶è¦è€ƒè™‘ç”Ÿäº§çŽ¯å¢ƒçš„æ€§èƒ½å½±å“ï¼Œåˆç†è®¾ç½®å„ç§å‚æ•°
- å¤šè¡Œæ—¥å¿—å¤„ç†æ˜¯éš¾ç‚¹ï¼Œéœ€è¦æ ¹æ®å®žé™…æ—¥å¿—æ ¼å¼ä»”ç»†è°ƒè¯•
- ç›‘æŽ§å’Œå‘Šè­¦ä½“ç³»çš„å»ºè®¾æ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹