---
title: 31、multi-input.yml多输入源配置
---
## 📚 目录

1. [多输入源配置概述](#1-多输入源配置概述)
2. [输入类型组合配置](#2-输入类型组合配置)
3. [输入源优先级与资源管理](#3-输入源优先级与资源管理)
4. [错误隔离与容错配置](#4-错误隔离与容错配置)
5. [输入源标识与标签管理](#5-输入源标识与标签管理)
6. [动态输入配置](#6-动态输入配置)
7. [性能优化与监控](#7-性能优化与监控)
8. [实际部署案例](#8-实际部署案例)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 📋 多输入源配置概述


### 1.1 什么是多输入源配置


**通俗理解**：就像一个数据收集站，可以同时从多个地方收集不同类型的数据

```
现实场景类比：
超市收银系统 = Filebeat
├── 收银台扫码 = 文件日志收集
├── 会员卡刷卡 = 系统指标收集  
├── 监控摄像头 = 网络数据收集
└── 库存盘点机 = 数据库日志收集

每个数据源都不一样，但都要汇总到同一个系统里
```

**🔸 核心概念**
```
多输入源：同时配置多种不同的数据输入方式
目的：一个Filebeat实例处理多种数据类型
优势：减少资源消耗，统一管理，简化部署
```

### 1.2 为什么需要多输入源


**💡 实际需求场景**
```
Web服务器监控需求：
✅ 访问日志：/var/log/nginx/access.log
✅ 错误日志：/var/log/nginx/error.log  
✅ 系统日志：/var/log/syslog
✅ 应用日志：/app/logs/*.log
✅ 性能指标：CPU、内存使用率

如果每种数据用一个Filebeat → 资源浪费
用一个Filebeat配置多个输入 → 高效统一
```

**🎯 主要优势**
- **资源节约**：一个进程处理多种数据
- **配置统一**：所有数据源集中管理
- **输出协调**：统一发送到Elasticsearch
- **监控简化**：只需监控一个Filebeat实例

### 1.3 多输入源架构图


```
┌─────────────────────────────────┐
│           Filebeat              │
├─────────────────────────────────┤
│  Input 1: 文件日志              │ → 标签: logs
│  Input 2: 系统指标              │ → 标签: metrics  
│  Input 3: 网络数据              │ → 标签: network
│  Input 4: 容器日志              │ → 标签: docker
├─────────────────────────────────┤
│         处理器 (Processors)      │
│  ├── 添加标签                   │
│  ├── 字段过滤                   │
│  └── 数据格式化                 │
├─────────────────────────────────┤
│         输出 (Output)           │
│  └── Elasticsearch集群          │
└─────────────────────────────────┘
```

---

## 2. 🔧 输入类型组合配置


### 2.1 常见输入类型组合


**📊 输入类型分类**

| 输入类型 | **用途** | **适用场景** | **配置复杂度** |
|---------|---------|-------------|---------------|
| `log` | 文件日志收集 | Web服务器、应用日志 | ⭐⭐ |
| `filestream` | 高性能文件流 | 大量日志文件 | ⭐⭐⭐ |
| `container` | 容器日志 | Docker、K8s环境 | ⭐⭐⭐ |
| `syslog` | 系统日志 | 服务器系统监控 | ⭐⭐ |
| `tcp/udp` | 网络数据 | 设备日志、远程数据 | ⭐⭐⭐ |

### 2.2 Web服务器完整监控配置


> 💡 **实际案例**  
> 这是一个典型的Web服务器监控配置，涵盖了网站运营的所有关键数据

```yaml
# 多输入源Web服务器监控配置
filebeat.inputs:

# 输入源1：Nginx访问日志
- type: log
  id: nginx-access-logs
  enabled: true
  paths:
    - /var/log/nginx/access.log
    - /var/log/nginx/*access*.log
  fields:
    log_type: "web_access"
    service: "nginx"
    environment: "production"
  fields_under_root: true
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after

# 输入源2：Nginx错误日志  
- type: log
  id: nginx-error-logs
  enabled: true
  paths:
    - /var/log/nginx/error.log
  fields:
    log_type: "web_error"
    service: "nginx"
    priority: "high"
  fields_under_root: true
  
# 输入源3：应用程序日志
- type: filestream
  id: app-logs
  enabled: true
  paths:
    - /app/logs/*.log
    - /app/logs/**/*.log
  fields:
    log_type: "application"
    service: "web_app"
  fields_under_root: true
  parsers:
    - multiline:
        type: pattern
        pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2}'
        negate: true
        match: after

# 输入源4：系统日志
- type: syslog
  id: system-logs
  protocol.udp:
    host: "localhost:514"
  fields:
    log_type: "system"
    service: "syslog"
  fields_under_root: true

# 输入源5：容器日志（如果使用Docker）
- type: container
  id: docker-logs
  paths:
    - '/var/lib/docker/containers/*/*.log'
  fields:
    log_type: "container"
    service: "docker"
  fields_under_root: true
```

### 2.3 数据库服务器监控配置


> 🔧 **数据库专用配置**  
> 专门针对数据库服务器的多输入源配置

```yaml
filebeat.inputs:

# MySQL慢查询日志
- type: log
  id: mysql-slow-logs
  paths:
    - /var/log/mysql/mysql-slow.log
  fields:
    db_type: "mysql"
    log_category: "slow_query"
    priority: "medium"
  multiline.pattern: '^# Time:'
  multiline.negate: true
  multiline.match: after

# MySQL错误日志
- type: log
  id: mysql-error-logs
  paths:
    - /var/log/mysql/error.log
  fields:
    db_type: "mysql"
    log_category: "error"
    priority: "high"

# 数据库连接日志
- type: tcp
  id: db-connection-logs
  host: "localhost:3306"
  fields:
    log_type: "db_connection"
    service: "mysql"
```

---

## 3. ⚖️ 输入源优先级与资源管理


### 3.1 输入源优先级配置


**🎯 为什么需要优先级？**
```
现实场景：
高优先级：错误日志、安全日志 → 立即处理
中优先级：访问日志、业务日志 → 正常处理  
低优先级：调试日志、统计日志 → 延迟处理

就像医院急诊科的分诊制度！
```

**⭐ 优先级配置示例**

```yaml
filebeat.inputs:

# 高优先级：安全和错误日志
- type: log
  id: security-logs
  paths:
    - /var/log/auth.log
    - /var/log/security.log
  fields:
    priority: "critical"
    urgent: true
  close_timeout: 1s        # 快速关闭文件
  scan_frequency: 1s       # 高频扫描
  harvester_buffer_size: 32768

# 中优先级：业务日志
- type: log  
  id: business-logs
  paths:
    - /app/logs/business.log
  fields:
    priority: "normal"
  close_timeout: 5s
  scan_frequency: 10s
  harvester_buffer_size: 16384

# 低优先级：调试日志
- type: log
  id: debug-logs
  paths:
    - /app/logs/debug.log
  fields:
    priority: "low"
  close_timeout: 30s       # 延迟关闭
  scan_frequency: 30s      # 低频扫描
  harvester_buffer_size: 8192
```

### 3.2 资源分配配置


**🔧 资源控制参数详解**

```yaml
# 全局资源配置
filebeat.config:
  inputs:
    reload.enabled: true
    reload.period: 30s

# 性能调优配置
queue.mem:
  events: 8192            # 内存队列大小
  flush.min_events: 1024  # 最小刷新事件数
  flush.timeout: 5s       # 刷新超时时间

# 输出性能配置  
output.elasticsearch:
  hosts: ["localhost:9200"]
  worker: 4               # 并发工作线程数
  bulk_max_size: 2048     # 批量发送大小
  timeout: 60s
  compression_level: 3    # 压缩级别
```

**📊 资源分配策略表**

| 资源类型 | **高优先级** | **中优先级** | **低优先级** |
|---------|-------------|-------------|-------------|
| 扫描频率 | 1-5秒 | 10-30秒 | 30-60秒 |
| 缓冲区大小 | 32KB | 16KB | 8KB |
| 关闭超时 | 1-5秒 | 5-15秒 | 30-60秒 |
| 队列优先级 | 立即处理 | 正常排队 | 延迟处理 |

### 3.3 资源隔离配置


> ⚠️ **重要提醒**  
> 不同输入源之间要做好资源隔离，避免一个输入源的问题影响其他输入源

```yaml
# 输入源隔离配置示例
filebeat.inputs:

# 关键业务日志 - 独立配置
- type: filestream
  id: critical-business
  paths:
    - /critical/logs/*.log
  # 独立的harvester设置
  close.on_state_change.enabled: true
  close.on_state_change.check_interval: 5s
  # 错误处理隔离
  ignore_older: 24h
  clean_inactive: 48h
  # 独立的处理器
  processors:
    - add_tags:
        tags: ["critical", "isolated"]

# 普通日志 - 共享配置
- type: log
  id: normal-logs
  paths:
    - /var/log/*.log
  # 共享的harvester设置
  close_timeout: 10s
  ignore_older: 72h
  processors:
    - add_tags:
        tags: ["normal", "shared"]
```

---

## 4. 🛡️ 错误隔离与容错配置


### 4.1 错误隔离机制


**🔍 什么是错误隔离？**
```
问题场景：
某个日志文件损坏 → 影响所有输入源？
网络输入断开 → 文件输入也停止？
内存不足 → 所有输入都失败？

错误隔离：
✅ 每个输入源独立运行
✅ 单个输入源错误不影响其他
✅ 自动重试和恢复机制
```

**🔧 错误隔离配置**

```yaml
filebeat.inputs:

# 网络输入 - 独立错误处理
- type: tcp
  id: network-input
  host: "0.0.0.0:5044"
  # 网络专用错误处理
  timeout: 30s
  max_connections: 100
  # 连接错误时不影响其他输入
  close_timeout: 1s
  processors:
    - add_tags:
        tags: ["network", "isolated"]
        when:
          network:
            connection: "active"

# 文件输入 - 独立错误处理  
- type: log
  id: file-input
  paths:
    - /var/log/*.log
  # 文件专用错误处理
  ignore_older: 24h
  close_inactive: 5m
  close_removed: true
  close_renamed: false
  # 文件错误时不影响网络输入
  harvester_limit: 100
  processors:
    - add_tags:
        tags: ["file", "isolated"]
        when:
          exists:
            fields: ["log.file.path"]
```

### 4.2 容错机制配置


**🔄 自动重试配置**

```yaml
# 全局容错配置
filebeat.config:
  inputs:
    reload.enabled: true
    reload.period: 10s      # 10秒重新加载配置

# 输出容错配置
output.elasticsearch:
  hosts: ["es1:9200", "es2:9200", "es3:9200"]
  # 自动故障转移
  loadbalance: true
  # 重试配置
  max_retries: 3
  backoff.init: 1s
  backoff.max: 60s
  # 超时配置
  timeout: 60s
  
# 日志输出容错
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
```

**🚨 错误监控配置**

```yaml
# 监控配置
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["localhost:9200"]
  
# 健康检查配置  
http.enabled: true
http.host: "0.0.0.0"
http.port: 5066

# 错误处理处理器
processors:
  - script:
      lang: javascript
      id: error_handler
      source: >
        function process(event) {
          if (event.Get("error.message")) {
            event.Put("error.handled", true);
            event.Put("error.timestamp", new Date().toISOString());
          }
          return event;
        }
```

---

## 5. 🏷️ 输入源标识与标签管理


### 5.1 输入源标识策略


**🎯 为什么需要标识？**
```
数据来源识别问题：
所有日志混在一起 → 分不清来源
查询时无法过滤 → 影响分析效率
故障排查困难 → 不知道哪里出错

解决方案：
✅ 每个输入源添加唯一标识
✅ 使用字段和标签分类
✅ 建立标准的命名规范
```

**📋 标识配置示例**

```yaml
filebeat.inputs:

# Web服务器访问日志
- type: log
  id: web-access-001
  paths:
    - /var/log/nginx/access.log
  # 基础标识字段
  fields:
    source: "nginx"
    log_type: "access"
    server_role: "frontend"
    environment: "production"
    datacenter: "dc1"
  fields_under_root: true
  # 标签标识
  tags: ["web", "nginx", "access", "frontend"]
  
# 数据库日志
- type: log
  id: db-mysql-001
  paths:
    - /var/log/mysql/*.log
  # 数据库专用标识
  fields:
    source: "mysql"
    log_type: "database"
    server_role: "backend"
    db_instance: "primary"
    version: "8.0"
  fields_under_root: true
  tags: ["database", "mysql", "backend"]

# 应用程序日志
- type: filestream
  id: app-business-001
  paths:
    - /app/logs/business.log
  # 应用专用标识
  fields:
    source: "application"
    log_type: "business"
    app_name: "ecommerce"
    module: "order"
    team: "backend"
  fields_under_root: true
  tags: ["application", "business", "ecommerce"]
```

### 5.2 动态标签添加


**🔧 处理器动态标签**

```yaml
# 基于内容动态添加标签
processors:
  # 根据日志级别添加标签
  - add_tags:
      tags: ["error", "critical"]
      when:
        regexp:
          message: "(ERROR|FATAL|CRITICAL)"
          
  - add_tags:
      tags: ["warning", "attention"]  
      when:
        regexp:
          message: "(WARN|WARNING)"
          
  - add_tags:
      tags: ["info", "normal"]
      when:
        regexp:
          message: "(INFO|DEBUG)"

  # 根据来源IP添加标签
  - add_tags:
      tags: ["internal", "trusted"]
      when:
        network:
          source.ip: "192.168.0.0/16"
          
  - add_tags:
      tags: ["external", "internet"]
      when:
        not:
          network:
            source.ip: "192.168.0.0/16"

  # 根据时间添加标签
  - script:
      lang: javascript
      source: >
        function process(event) {
          var hour = new Date().getHours();
          if (hour >= 9 && hour <= 17) {
            event.Put("time_category", "business_hours");
          } else {
            event.Put("time_category", "after_hours");
          }
          return event;
        }
```

### 5.3 标签管理最佳实践


**📊 标签分类体系**

```
层级标签体系：
├── 基础分类
│   ├── source: nginx/mysql/app
│   ├── type: access/error/business
│   └── environment: prod/test/dev
├── 业务分类  
│   ├── service: web/db/cache
│   ├── module: user/order/payment
│   └── priority: high/medium/low
└── 运维分类
    ├── datacenter: dc1/dc2/cloud
    ├── server_role: frontend/backend
    └── alert_level: critical/warning/info
```

> 💡 **标签命名建议**  
> - 使用小写字母和下划线
> - 避免特殊字符和空格
> - 保持命名一致性
> - 建立标签词典文档

---

## 6. 🔄 动态输入配置


### 6.1 配置热重载


**🔥 什么是热重载？**
```
传统方式：
修改配置 → 重启Filebeat → 服务中断 → 数据丢失风险

热重载方式：
修改配置 → 自动检测 → 无缝切换 → 零停机时间
```

**⚙️ 热重载配置**

```yaml
# 启用配置自动重载
filebeat.config.inputs:
  enabled: true
  path: /etc/filebeat/inputs.d/*.yml
  reload.enabled: true
  reload.period: 30s       # 30秒检查一次配置变化

# 模块自动重载
filebeat.config.modules:
  enabled: true
  path: /etc/filebeat/modules.d/*.yml
  reload.enabled: true
  reload.period: 30s

# 处理器动态重载
processors:
  - script:
      lang: javascript
      id: dynamic_processor
      source: >
        // 可以动态修改的处理逻辑
        function process(event) {
          // 处理逻辑可以通过重载配置更新
          return event;
        }
```

### 6.2 条件输入配置


**🎛️ 基于条件的输入启用**

```yaml
# 基于时间的动态输入
filebeat.inputs:

# 工作时间启用详细日志
- type: log
  id: detailed-logs
  enabled: true
  paths:
    - /app/logs/detailed.log
  # 只在工作时间启用
  condition: >
    ${hour} >= 9 && ${hour} <= 17
  fields:
    collection_mode: "detailed"
    active_hours: true

# 非工作时间简化日志
- type: log
  id: simple-logs  
  enabled: true
  paths:
    - /app/logs/error.log
    - /app/logs/critical.log
  # 24小时启用，但非工作时间为主
  condition: >
    ${hour} < 9 || ${hour} > 17
  fields:
    collection_mode: "essential"
    active_hours: false

# 基于系统负载的动态输入
- type: filestream
  id: performance-logs
  enabled: true
  paths:
    - /var/log/performance/*.log
  # 只在系统负载低时启用
  condition: >
    ${system.load.1} < 2.0
  scan_frequency: 60s
```

### 6.3 外部配置管理


**☁️ 配置中心集成**

```yaml
# 环境变量配置
filebeat.inputs:
- type: log
  enabled: ${LOG_COLLECTION_ENABLED:true}
  paths:
    - ${LOG_FILE_PATH:/var/log/*.log}
  fields:
    environment: ${ENVIRONMENT:production}
    datacenter: ${DATACENTER:dc1}
    version: ${APP_VERSION:1.0.0}

# 外部配置文件引用
filebeat.config.inputs:
  enabled: true
  path: ${CONFIG_PATH:/etc/filebeat/configs}/*.yml
  
# Consul/etcd配置中心集成示例
http.enabled: true
http.host: ${HTTP_HOST:localhost}
http.port: ${HTTP_PORT:5066}

# 配置更新webhook
setup.template.settings:
  index.number_of_shards: ${ES_SHARDS:1}
  index.number_of_replicas: ${ES_REPLICAS:1}
```

---

## 7. 📈 性能优化与监控


### 7.1 性能优化配置


**🚀 多输入源性能调优**

```yaml
# 全局性能配置
queue.mem:
  events: 8192              # 内存队列大小
  flush.min_events: 1024    # 最小刷新事件数
  flush.timeout: 5s         # 刷新超时

# 输入源性能配置
filebeat.inputs:
- type: filestream
  id: high-performance-logs
  paths:
    - /high-volume/logs/*.log
  # 高性能配置
  prospector.scanner:
    check_interval: 1s      # 快速检查新文件
    cleanup_timeout: 5m     # 清理超时
  close.on_state_change:
    enabled: true
    check_interval: 5s
  # 批量处理优化
  harvester_buffer_size: 32768
  max_bytes: 10485760       # 10MB最大字节数

# 输出性能优化
output.elasticsearch:
  hosts: ["es1:9200", "es2:9200"]
  worker: 8                 # 增加工作线程
  bulk_max_size: 3200       # 增大批量大小
  compression_level: 1      # 降低压缩级别提高速度
  timeout: 90s
```

### 7.2 监控配置


**📊 性能监控指标**

```yaml
# 启用监控
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["localhost:9200"]
  
# HTTP监控端点
http.enabled: true
http.host: "0.0.0.0"
http.port: 5066

# 日志监控
logging.level: info
logging.metrics.enabled: true
logging.metrics.period: 30s

# 自定义监控指标
processors:
  - script:
      lang: javascript
      id: performance_metrics
      source: >
        function process(event) {
          // 记录处理时间
          event.Put("processing.timestamp", Date.now());
          
          // 记录输入源标识
          if (event.Get("input.type")) {
            event.Put("metrics.input_type", event.Get("input.type"));
          }
          
          return event;
        }
```

**📋 关键监控指标**

| 指标类型 | **监控项目** | **正常范围** | **告警阈值** |
|---------|-------------|-------------|-------------|
| 吞吐量 | 每秒处理事件数 | 1000-5000/s | <500/s |
| 延迟 | 事件处理延迟 | <100ms | >1000ms |
| 错误率 | 输入错误比例 | <1% | >5% |
| 资源 | CPU使用率 | <50% | >80% |
| 资源 | 内存使用率 | <70% | >90% |

---

## 8. 🏢 实际部署案例


### 8.1 电商网站完整监控方案


> 🛒 **实际场景**  
> 一个中型电商网站的完整日志监控部署方案

```yaml
# 电商网站多输入源配置
# 文件位置：/etc/filebeat/filebeat.yml

# 全局配置
name: "ecommerce-filebeat-01"
tags: ["ecommerce", "production", "web"]

filebeat.inputs:

# 1. Nginx访问日志 - 用户行为分析
- type: log
  id: nginx-access
  enabled: true
  paths:
    - /var/log/nginx/access.log
    - /var/log/nginx/access_ssl.log
  fields:
    service: "nginx"
    log_type: "access"
    business_type: "user_behavior"
    importance: "high"
  exclude_lines: ['^127\.0\.0\.1', 'health-check']
  processors:
    - add_tags:
        tags: ["web", "access", "user_tracking"]

# 2. 业务应用日志 - 订单处理
- type: filestream
  id: order-service
  enabled: true
  paths:
    - /app/ecommerce/logs/order-service.log
  fields:
    service: "order-service"
    log_type: "business"
    business_type: "transaction"
    importance: "critical"
  parsers:
    - multiline:
        type: pattern
        pattern: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
        negate: true
        match: after

# 3. 支付系统日志 - 金融交易
- type: log
  id: payment-service
  enabled: true  
  paths:
    - /app/payment/logs/payment.log
    - /app/payment/logs/refund.log
  fields:
    service: "payment-service"
    log_type: "financial"
    business_type: "payment"
    importance: "critical"
    compliance: "pci_dss"
  processors:
    - add_tags:
        tags: ["payment", "financial", "secure"]

# 4. 用户服务日志 - 用户管理
- type: filestream
  id: user-service
  enabled: true
  paths:
    - /app/user/logs/*.log
  fields:
    service: "user-service"
    log_type: "user_management"
    business_type: "authentication"
    importance: "medium"

# 5. 数据库日志 - 数据持久化
- type: log
  id: mysql-logs
  enabled: true
  paths:
    - /var/log/mysql/mysql.log
    - /var/log/mysql/error.log
  fields:
    service: "mysql"
    log_type: "database"
    business_type: "data_persistence"
    importance: "high"

# 性能优化配置
queue.mem:
  events: 10240
  flush.min_events: 2048
  flush.timeout: 3s

# 输出到Elasticsearch
output.elasticsearch:
  hosts: ["es-cluster-01:9200", "es-cluster-02:9200"]
  index: "ecommerce-logs-%{+yyyy.MM.dd}"
  template.settings:
    index.number_of_shards: 3
    index.number_of_replicas: 1
```

### 8.2 微服务架构监控方案


**🔄 容器化微服务监控**

```yaml
# 微服务容器日志收集配置
filebeat.inputs:

# Kubernetes容器日志
- type: container
  id: k8s-containers
  paths:
    - /var/log/containers/*-user-service-*.log
    - /var/log/containers/*-order-service-*.log
    - /var/log/containers/*-payment-service-*.log
  processors:
    - add_kubernetes_metadata:
        host: ${NODE_NAME}
        matchers:
        - logs_path:
            logs_path: "/var/log/containers/"

# Docker直接日志收集
- type: docker
  id: docker-services
  containers.ids:
    - "*"
  exclude_containers:
    - "filebeat*"
    - "*debug*"
  processors:
    - add_docker_metadata:
        host: "unix:///var/run/docker.sock"

# 服务网格日志 (Istio/Envoy)
- type: log
  id: service-mesh
  paths:
    - /var/log/istio/*.log
    - /var/log/envoy/*.log
  fields:
    service: "service-mesh"
    infrastructure: "istio"
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


> 🎯 **核心理解要点**  
> 多输入源配置的本质是用一个Filebeat实例高效管理多种数据源

```
🔸 多输入源概念：一个Filebeat同时处理多种数据类型
🔸 输入类型组合：log、filestream、container、syslog、tcp/udp
🔸 资源管理：优先级设置、资源分配、性能调优
🔸 错误隔离：每个输入源独立运行，互不影响
🔸 标识管理：通过字段和标签识别数据来源
🔸 动态配置：热重载、条件启用、外部配置管理
```

### 9.2 配置最佳实践


**📋 实用配置清单**

```
✅ 命名规范：每个输入源使用唯一ID
✅ 标签体系：建立一致的标签分类规范  
✅ 优先级设置：根据业务重要性分配资源
✅ 错误处理：配置独立的错误隔离机制
✅ 性能调优：根据数据量调整缓冲区和扫描频率
✅ 监控配置：启用性能监控和健康检查
✅ 热重载：支持配置动态更新，减少重启
```

### 9.3 常见问题解决


**❗ 典型问题及解决方案**

| 问题描述 | **可能原因** | **解决方案** |
|---------|-------------|-------------|
| 某个输入源停止工作 | 文件权限、路径错误 | 检查权限和路径配置 |
| 内存使用过高 | 队列配置过大 | 调整queue.mem配置 |
| 数据丢失 | 输出端连接问题 | 配置输出重试机制 |
| 处理延迟高 | 扫描频率过低 | 提高scan_frequency |
| 磁盘空间不足 | 日志文件过多 | 配置日志清理策略 |

### 9.4 实际应用建议


**🎯 部署建议**

```
小型项目（<5个服务）：
- 使用简单的log输入类型
- 基础的字段标识
- 标准的错误处理

中型项目（5-20个服务）：
- 混合使用log和filestream
- 完整的标签体系
- 资源优先级配置
- 性能监控

大型项目（>20个服务）：
- 多种输入类型组合
- 动态配置管理
- 完整的错误隔离
- 自动化运维
```

**💡 记忆要点**
- 多输入源 = 一个Filebeat管理多个数据源
- 每个输入源独立配置，互不干扰
- 通过标签和字段识别数据来源
- 根据重要性设置优先级和资源分配
- 启用监控确保系统健康运行