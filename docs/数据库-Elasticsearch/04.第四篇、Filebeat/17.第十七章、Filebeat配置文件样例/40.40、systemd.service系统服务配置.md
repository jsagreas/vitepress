---
title: 40ã€systemd.serviceç³»ç»ŸæœåŠ¡é…ç½®
---
## ğŸ“š ç›®å½•


1. [SystemdæœåŠ¡åŸºç¡€æ¦‚å¿µ](#1-systemdæœåŠ¡åŸºç¡€æ¦‚å¿µ)
2. [FilebeatæœåŠ¡å•å…ƒé…ç½®](#2-filebeatæœåŠ¡å•å…ƒé…ç½®)
3. [æœåŠ¡å¯åŠ¨ä¸ä¾èµ–é…ç½®](#3-æœåŠ¡å¯åŠ¨ä¸ä¾èµ–é…ç½®)
4. [ç”¨æˆ·æƒé™ä¸å®‰å…¨é…ç½®](#4-ç”¨æˆ·æƒé™ä¸å®‰å…¨é…ç½®)
5. [ç¯å¢ƒå˜é‡ä¸æ—¥å¿—é…ç½®](#5-ç¯å¢ƒå˜é‡ä¸æ—¥å¿—é…ç½®)
6. [å®é™…éƒ¨ç½²æ¡ˆä¾‹è¯¦è§£](#6-å®é™…éƒ¨ç½²æ¡ˆä¾‹è¯¦è§£)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# 1. ğŸ”§ SystemdæœåŠ¡åŸºç¡€æ¦‚å¿µ



## 1.1 ä»€ä¹ˆæ˜¯SystemdæœåŠ¡



**ç®€å•ç†è§£**ï¼š
Systemdå°±åƒæ˜¯Linuxç³»ç»Ÿçš„"æ€»ç®¡å®¶"ï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡ã€‚æŠŠFilebeaté…ç½®æˆSystemdæœåŠ¡ï¼Œå°±ç›¸å½“äºå‘Šè¯‰ç³»ç»Ÿï¼š"è¯·å¸®æˆ‘è‡ªåŠ¨ç®¡ç†Filebeatï¼Œè®©å®ƒå¼€æœºè‡ªå¯åŠ¨ï¼Œå´©æºƒäº†è‡ªåŠ¨é‡å¯"ã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š
```
ä¼ ç»Ÿæ–¹å¼è¿è¡ŒFilebeatï¼š
./filebeat -e -c filebeat.yml
é—®é¢˜ï¼šå…³é—­ç»ˆç«¯å°±åœæ­¢äº†ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†

Systemdæ–¹å¼ï¼š
systemctl start filebeat
ä¼˜åŠ¿ï¼šåå°è¿è¡Œï¼Œè‡ªåŠ¨ç®¡ç†ï¼Œå¼€æœºå¯åŠ¨
```

## 1.2 SystemdæœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸ



```
â”Œâ”€ æœåŠ¡çŠ¶æ€æµè½¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚
â”‚ inactive â†’ activating â†’ active â”‚
â”‚     â†‘          â†“        â†“     â”‚
â”‚     â””â”€ failed â†â”€ deactivating â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€è¯´æ˜ï¼š
â€¢ inactiveï¼šæœåŠ¡æœªè¿è¡Œ
â€¢ activatingï¼šæ­£åœ¨å¯åŠ¨ä¸­
â€¢ activeï¼šæ­£å¸¸è¿è¡Œä¸­
â€¢ deactivatingï¼šæ­£åœ¨åœæ­¢ä¸­
â€¢ failedï¼šå¯åŠ¨å¤±è´¥æˆ–è¿è¡Œå¼‚å¸¸
```

**å®é™…å«ä¹‰**ï¼š
- **inactive**: Filebeatæ²¡æœ‰è¿è¡Œ
- **active**: Filebeatæ­£åœ¨æ”¶é›†æ—¥å¿—
- **failed**: Filebeatå‡ºé”™äº†ï¼Œéœ€è¦æ£€æŸ¥é…ç½®

---

# 2. ğŸ“‹ FilebeatæœåŠ¡å•å…ƒé…ç½®



## 2.1 åŸºç¡€æœåŠ¡é…ç½®æ–‡ä»¶



**æ–‡ä»¶ä½ç½®**ï¼š`/etc/systemd/system/filebeat.service`

```ini
[Unit]
# æœåŠ¡æè¿° - è®©äººä¸€çœ¼çœ‹æ‡‚è¿™æ˜¯ä»€ä¹ˆæœåŠ¡

Description=Filebeat sends log files to Logstash or directly to Elasticsearch.
# æ–‡æ¡£é“¾æ¥ - å‡ºé—®é¢˜æ—¶çŸ¥é“å»å“ªé‡ŒæŸ¥æ–‡æ¡£

Documentation=https://www.elastic.co/products/beats/filebeat
# æœåŠ¡å¯åŠ¨é¡ºåº - ç¡®ä¿ç½‘ç»œå’Œç³»ç»Ÿå‡†å¤‡å¥½äº†å†å¯åŠ¨

Wants=network-online.target
After=network-online.target

[Service]
# æœåŠ¡ç±»å‹ - simpleè¡¨ç¤ºä¸»è¿›ç¨‹å°±æ˜¯æˆ‘ä»¬è¦è¿è¡Œçš„ç¨‹åº

Type=simple
# ç”¨æˆ·èº«ä»½ - ä»¥rootç”¨æˆ·è¿è¡Œï¼ˆéœ€è¦è¯»å–å„ç§æ—¥å¿—æ–‡ä»¶ï¼‰

User=root
Group=root
# ç¨‹åºè·¯å¾„å’Œå‚æ•°

ExecStart=/usr/share/filebeat/bin/filebeat -c /etc/filebeat/filebeat.yml
# ä¼˜é›…åœæ­¢ - ç»™ç¨‹åºå‘é€TERMä¿¡å·è®©å®ƒè‡ªå·±é€€å‡º

KillMode=process
KillSignal=SIGTERM
# é‡å¯ç­–ç•¥ - ç¨‹åºå´©æºƒäº†è‡ªåŠ¨é‡å¯

Restart=on-failure
RestartSec=3
# èµ„æºé™åˆ¶ - é˜²æ­¢ç¨‹åºå ç”¨å¤ªå¤šèµ„æº

LimitNOFILE=65536

[Install]
# å¼€æœºå¯åŠ¨ - è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨

WantedBy=multi-user.target
```

## 2.2 é«˜çº§æœåŠ¡é…ç½®é€‰é¡¹



**å¢å¼ºç‰ˆé…ç½®**ï¼š

```ini
[Unit]
Description=Filebeat Log Shipper
Documentation=https://www.elastic.co/guide/en/beats/filebeat/current/index.html
# ä¾èµ–å…³ç³» - ç¡®ä¿è¿™äº›æœåŠ¡å…ˆå¯åŠ¨

Wants=network-online.target
After=network-online.target syslog.target
# å†²çªæ£€æµ‹ - é¿å…å’Œå…¶ä»–æ—¥å¿—æ”¶é›†å™¨å†²çª

Conflicts=rsyslog.service

[Service]
Type=simple
User=filebeat
Group=filebeat
# å·¥ä½œç›®å½•

WorkingDirectory=/usr/share/filebeat
# å¯åŠ¨å‘½ä»¤

ExecStart=/usr/share/filebeat/bin/filebeat -c /etc/filebeat/filebeat.yml -path.home /usr/share/filebeat -path.config /etc/filebeat -path.data /var/lib/filebeat -path.logs /var/log/filebeat
# é‡æ–°åŠ è½½é…ç½®

ExecReload=/bin/kill -HUP $MAINPID
# åœæ­¢å‘½ä»¤

ExecStop=/bin/kill -TERM $MAINPID

# é‡å¯ç­–ç•¥è¯¦ç»†é…ç½®

Restart=on-failure
RestartSec=5
# å¯åŠ¨å¤±è´¥é‡è¯•æ¬¡æ•°

StartLimitInterval=60
StartLimitBurst=3

# è¿›ç¨‹ç®¡ç†

KillMode=process
KillSignal=SIGTERM
TimeoutStopSec=30

# èµ„æºé™åˆ¶

LimitNOFILE=65536
LimitNPROC=8192
# å†…å­˜é™åˆ¶ï¼ˆå¯é€‰ï¼‰

MemoryLimit=512M

[Install]
WantedBy=multi-user.target
```

---

# 3. ğŸš€ æœåŠ¡å¯åŠ¨ä¸ä¾èµ–é…ç½®



## 3.1 ä¾èµ–å…³ç³»è¯¦è§£



**ä¾èµ–å…³ç³»çš„é‡è¦æ€§**ï¼š
æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœFilebeatåœ¨ç½‘ç»œè¿˜æ²¡å‡†å¤‡å¥½çš„æ—¶å€™å°±å¯åŠ¨äº†ï¼Œå®ƒè¿ä¸ä¸ŠElasticsearchï¼Œå°±ä¼šä¸€ç›´æŠ¥é”™ã€‚é€šè¿‡é…ç½®ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬ç¡®ä¿Filebeatåœ¨åˆé€‚çš„æ—¶æœºå¯åŠ¨ã€‚

```ini
[Unit]
# Wantsï¼šå¸Œæœ›è¿™äº›æœåŠ¡å…ˆå¯åŠ¨ï¼Œä½†ä¸æ˜¯å¼ºåˆ¶çš„

Wants=network-online.target
# Afterï¼šåœ¨è¿™äº›æœåŠ¡ä¹‹åå¯åŠ¨

After=network-online.target syslog.target
# Requiresï¼šå¼ºåˆ¶ä¾èµ–ï¼Œå¦‚æœè¿™äº›æœåŠ¡å¯åŠ¨å¤±è´¥ï¼ŒFilebeatä¹Ÿä¸å¯åŠ¨

# Requires=elasticsearch.service  # å¦‚æœElasticsearchåœ¨åŒä¸€å°æœºå™¨ä¸Š


# å®é™…æ•ˆæœï¼š

# 1. ç­‰ç½‘ç»œå‡†å¤‡å¥½

# 2. ç­‰ç³»ç»Ÿæ—¥å¿—æœåŠ¡å¯åŠ¨

# 3. å†å¯åŠ¨Filebeat

```

## 3.2 å¯åŠ¨é¡ºåºæ§åˆ¶



**å¯åŠ¨é¡ºåºç¤ºä¾‹**ï¼š

```
ç³»ç»Ÿå¯åŠ¨æµç¨‹ï¼š
1. å†…æ ¸åŠ è½½ â†’ 2. åŸºç¡€ç³»ç»Ÿ â†’ 3. ç½‘ç»œæœåŠ¡ â†’ 4. Filebeat
      â†“            â†“            â†“           â†“
   kernel      systemd    network-online  filebeat.service
```

**é…ç½®æŠ€å·§**ï¼š
```ini
# å¦‚æœElasticsearchåœ¨æœ¬æœºï¼Œå¯ä»¥è¿™æ ·é…ç½®

[Unit]
Description=Filebeat
After=network.target elasticsearch.service
Wants=elasticsearch.service

# å¦‚æœåªæ˜¯ç½‘ç»œä¾èµ–

[Unit]
Description=Filebeat  
After=network-online.target
Wants=network-online.target
```

## 3.3 æœåŠ¡ç®¡ç†å‘½ä»¤



**å¸¸ç”¨ç®¡ç†å‘½ä»¤**ï¼š

```bash
# é‡æ–°åŠ è½½systemdé…ç½®ï¼ˆä¿®æ”¹.serviceæ–‡ä»¶åå¿…é¡»æ‰§è¡Œï¼‰

sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡

sudo systemctl start filebeat

# åœæ­¢æœåŠ¡  

sudo systemctl stop filebeat

# é‡å¯æœåŠ¡

sudo systemctl restart filebeat

# è®¾ç½®å¼€æœºè‡ªå¯åŠ¨

sudo systemctl enable filebeat

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€

sudo systemctl status filebeat

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—

sudo journalctl -u filebeat -f
```

---

# 4. ğŸ”’ ç”¨æˆ·æƒé™ä¸å®‰å…¨é…ç½®



## 4.1 ç”¨æˆ·æƒé™é…ç½®



**ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„ç”¨æˆ·**ï¼š
è¿è¡ŒFilebeatæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æƒé™è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œä½†åˆä¸å¸Œæœ›ç»™å®ƒå¤ªé«˜çš„æƒé™é€ æˆå®‰å…¨é£é™©ã€‚æœ€ä½³å®è·µæ˜¯åˆ›å»ºä¸“é—¨çš„ç”¨æˆ·ã€‚

**åˆ›å»ºFilebeatç”¨æˆ·**ï¼š
```bash
# åˆ›å»ºç³»ç»Ÿç”¨æˆ·ï¼ˆä¸èƒ½ç™»å½•ï¼Œæ›´å®‰å…¨ï¼‰

sudo useradd --system --no-create-home --shell /bin/false filebeat

# åˆ›å»ºå¿…è¦çš„ç›®å½•

sudo mkdir -p /var/lib/filebeat /var/log/filebeat /etc/filebeat

# è®¾ç½®ç›®å½•æƒé™

sudo chown -R filebeat:filebeat /var/lib/filebeat /var/log/filebeat
sudo chown -R root:filebeat /etc/filebeat
sudo chmod 750 /etc/filebeat
```

**æƒé™é…ç½®ç¤ºä¾‹**ï¼š
```ini
[Service]
# ä½¿ç”¨ä¸“é—¨çš„ç”¨æˆ·è¿è¡Œ

User=filebeat
Group=filebeat

# é¢å¤–ç”¨æˆ·ç»„ - è®©filebeatèƒ½è¯»å–å…¶ä»–æ—¥å¿—

SupplementaryGroups=adm,syslog

# å¦‚æœéœ€è¦è¯»å–Dockeræ—¥å¿—

# SupplementaryGroups=adm,syslog,docker

```

## 4.2 å®‰å…¨æ²™ç›’é…ç½®



**å®‰å…¨åŠ å›ºé€‰é¡¹**ï¼š
```ini
[Service]
# åŸºç¡€å®‰å…¨è®¾ç½®

NoNewPrivileges=true
PrivateTmp=true

# æ–‡ä»¶ç³»ç»Ÿä¿æŠ¤

ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/filebeat /var/log/filebeat

# ç½‘ç»œé™åˆ¶

# RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX


# ç³»ç»Ÿè°ƒç”¨é™åˆ¶ï¼ˆé«˜çº§é€‰é¡¹ï¼Œè°¨æ…ä½¿ç”¨ï¼‰

# SystemCallFilter=@system-service

# SystemCallErrorNumber=EPERM

```

**å®‰å…¨é…ç½®è¯´æ˜**ï¼š
```
â”Œâ”€ å®‰å…¨å±‚æ¬¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NoNewPrivileges: ä¸èƒ½æå‡æƒé™   â”‚
â”‚ PrivateTmp: ç§æœ‰ä¸´æ—¶ç›®å½•       â”‚  
â”‚ ProtectSystem: ä¿æŠ¤ç³»ç»Ÿç›®å½•    â”‚
â”‚ ProtectHome: ä¿æŠ¤ç”¨æˆ·ç›®å½•      â”‚
â”‚ ReadWritePaths: æŒ‡å®šå¯å†™è·¯å¾„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 5. ğŸŒ ç¯å¢ƒå˜é‡ä¸æ—¥å¿—é…ç½®



## 5.1 ç¯å¢ƒå˜é‡é…ç½®



**ç¯å¢ƒå˜é‡çš„ä½œç”¨**ï¼š
é€šè¿‡ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æƒ…å†µä¸‹è°ƒæ•´Filebeatçš„è¡Œä¸ºï¼Œæ¯”å¦‚è®¾ç½®æ—¥å¿—çº§åˆ«ã€é…ç½®è·¯å¾„ç­‰ã€‚

```ini
[Service]
# è®¾ç½®ç¯å¢ƒå˜é‡

Environment=BEAT_LOG_LEVEL=info
Environment=BEAT_STRICT_PERMS=false
Environment=GODEBUG=madvdontneed=1

# ä»æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡

EnvironmentFile=/etc/default/filebeat

# å¤šä¸ªç¯å¢ƒå˜é‡æ–‡ä»¶

EnvironmentFile=-/etc/default/filebeat
EnvironmentFile=-/etc/filebeat/environment
```

**ç¯å¢ƒå˜é‡æ–‡ä»¶ç¤ºä¾‹** `/etc/default/filebeat`ï¼š
```bash
# æ—¥å¿—çº§åˆ«è®¾ç½®

BEAT_LOG_LEVEL=info

# å†…å­˜ä¼˜åŒ–

GODEBUG=madvdontneed=1

# é…ç½®æ–‡ä»¶è·¯å¾„

FILEBEAT_CONFIG=/etc/filebeat/filebeat.yml

# æ•°æ®ç›®å½•

FILEBEAT_DATA_DIR=/var/lib/filebeat

# æ—¥å¿—ç›®å½•  

FILEBEAT_LOG_DIR=/var/log/filebeat
```

## 5.2 æ—¥å¿—é…ç½®è¯¦è§£



**ç³»ç»Ÿæ—¥å¿—é›†æˆ**ï¼š
```ini
[Service]
# æ ‡å‡†è¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—

StandardOutput=journal
StandardError=journal

# ç³»ç»Ÿæ—¥å¿—æ ‡è¯†

SyslogIdentifier=filebeat

# æ—¥å¿—çº§åˆ«

SyslogLevel=info
```

**æŸ¥çœ‹æ—¥å¿—å‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹FilebeatæœåŠ¡æ—¥å¿—

sudo journalctl -u filebeat

# å®æ—¶æŸ¥çœ‹æ—¥å¿—  

sudo journalctl -u filebeat -f

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯

sudo journalctl -u filebeat --since "1 hour ago" -p err

# æŸ¥çœ‹è¯¦ç»†å¯åŠ¨æ—¥å¿—

sudo journalctl -u filebeat --since today --no-pager
```

---

# 6. ğŸ’¼ å®é™…éƒ¨ç½²æ¡ˆä¾‹è¯¦è§£



## 6.1 ç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½®



**å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š

```ini
[Unit]
Description=Filebeat Log Data Shipper
Documentation=https://www.elastic.co/guide/en/beats/filebeat/current/index.html
Wants=network-online.target
After=network-online.target
# åœ¨å¤šç”¨æˆ·æ¨¡å¼ä¸‹å¯åŠ¨

DefaultDependencies=yes

[Service]
Type=simple
User=filebeat
Group=filebeat
UMask=0027

# ç¨‹åºè·¯å¾„å’Œå‚æ•°

ExecStart=/usr/share/filebeat/bin/filebeat -c /etc/filebeat/filebeat.yml -path.home /usr/share/filebeat -path.config /etc/filebeat -path.data /var/lib/filebeat -path.logs /var/log/filebeat
ExecReload=/bin/kill -HUP $MAINPID

# é‡å¯ç­–ç•¥

Restart=on-failure
RestartSec=5
StartLimitInterval=300
StartLimitBurst=5

# è¿›ç¨‹ç®¡ç†

KillMode=mixed
KillSignal=SIGTERM
TimeoutStartSec=60
TimeoutStopSec=60

# èµ„æºé™åˆ¶

LimitNOFILE=65536
LimitNPROC=8192
LimitCORE=infinity

# ç¯å¢ƒå˜é‡

Environment=BEAT_LOG_LEVEL=info
Environment=BEAT_STRICT_PERMS=false
EnvironmentFile=-/etc/default/filebeat

# å®‰å…¨è®¾ç½®

NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/lib/filebeat /var/log/filebeat /tmp

# æ—¥å¿—é…ç½®

StandardOutput=journal
StandardError=journal
SyslogIdentifier=filebeat

[Install]
WantedBy=multi-user.target
```

## 6.2 Dockerç¯å¢ƒä¸‹çš„é…ç½®



**é€‚ç”¨äºDockerä¸»æœºçš„é…ç½®**ï¼š

```ini
[Unit]
Description=Filebeat for Docker Logs
After=docker.service
Wants=docker.service

[Service]
Type=simple
User=root
Group=root
SupplementaryGroups=docker

# Dockeræ—¥å¿—è·¯å¾„éœ€è¦ç‰¹æ®Šé…ç½®

ExecStart=/usr/share/filebeat/bin/filebeat -c /etc/filebeat/filebeat.yml
ExecReload=/bin/kill -HUP $MAINPID

Restart=on-failure
RestartSec=10

# Dockerç¯å¢ƒç‰¹æ®Šæƒé™

ReadWritePaths=/var/lib/docker/containers
ReadOnlyPaths=/var/lib/docker

# ç›‘æ§Dockerå®ˆæŠ¤è¿›ç¨‹

BindsTo=docker.service

[Install]
WantedBy=multi-user.target
```

## 6.3 é«˜å¯ç”¨ç¯å¢ƒé…ç½®



**å¤šå®ä¾‹é…ç½®ç¤ºä¾‹**ï¼š

```ini
# /etc/systemd/system/filebeat@.service

[Unit]
Description=Filebeat instance %i
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=filebeat
Group=filebeat

# ä½¿ç”¨å®ä¾‹å‚æ•°

ExecStart=/usr/share/filebeat/bin/filebeat -c /etc/filebeat/filebeat-%i.yml -path.data /var/lib/filebeat-%i
ExecReload=/bin/kill -HUP $MAINPID

Restart=on-failure
RestartSec=5

# å®ä¾‹éš”ç¦»

PrivateNetwork=false
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨å¤šä¸ªå®ä¾‹**ï¼š
```bash
# å¯åŠ¨ä¸åŒé…ç½®çš„å®ä¾‹

sudo systemctl start filebeat@web.service
sudo systemctl start filebeat@db.service  
sudo systemctl start filebeat@app.service

# è®¾ç½®å¼€æœºå¯åŠ¨

sudo systemctl enable filebeat@web.service
sudo systemctl enable filebeat@db.service
```

---

# 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



## 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ SystemdæœåŠ¡ï¼šç³»ç»ŸæœåŠ¡ç®¡ç†å™¨ï¼Œè®©ç¨‹åºè‡ªåŠ¨åŒ–è¿è¡Œ
ğŸ”¸ æœåŠ¡å•å…ƒï¼š.serviceæ–‡ä»¶ï¼Œå®šä¹‰æœåŠ¡å¦‚ä½•å¯åŠ¨å’Œç®¡ç†
ğŸ”¸ ä¾èµ–å…³ç³»ï¼šç¡®ä¿æœåŠ¡æŒ‰æ­£ç¡®é¡ºåºå¯åŠ¨
ğŸ”¸ ç”¨æˆ·æƒé™ï¼šå®‰å…¨è¿è¡Œï¼Œé¿å…æƒé™è¿‡é«˜çš„å®‰å…¨é£é™©  
ğŸ”¸ é‡å¯ç­–ç•¥ï¼šç¨‹åºå´©æºƒæ—¶çš„æ¢å¤æœºåˆ¶
ğŸ”¸ èµ„æºé™åˆ¶ï¼šé˜²æ­¢ç¨‹åºå ç”¨è¿‡å¤šç³»ç»Ÿèµ„æº
```

## 7.2 é…ç½®æ–‡ä»¶å…³é”®å­—æ®µç†è§£



**ğŸ”¹ [Unit]éƒ¨åˆ†**ï¼š
```
Description: æœåŠ¡æè¿°ï¼Œè®©äººçœ‹æ‡‚è¿™æ˜¯ä»€ä¹ˆ
After: åœ¨å“ªäº›æœåŠ¡ä¹‹åå¯åŠ¨
Wants: å¸Œæœ›å…ˆå¯åŠ¨çš„æœåŠ¡ï¼ˆéå¼ºåˆ¶ï¼‰
Requires: å¿…é¡»å…ˆå¯åŠ¨çš„æœåŠ¡ï¼ˆå¼ºåˆ¶ï¼‰
```

**ğŸ”¹ [Service]éƒ¨åˆ†**ï¼š
```
Type: æœåŠ¡ç±»å‹ï¼Œsimpleæœ€å¸¸ç”¨
User/Group: è¿è¡Œç”¨æˆ·ï¼Œå®‰å…¨é‡è¦
ExecStart: å¯åŠ¨å‘½ä»¤ï¼Œç¨‹åºçš„å®Œæ•´è·¯å¾„
Restart: é‡å¯ç­–ç•¥ï¼Œon-failureæœ€å®ç”¨
```

**ğŸ”¹ [Install]éƒ¨åˆ†**ï¼š
```
WantedBy: å¼€æœºå¯åŠ¨çš„ç›®æ ‡ï¼Œmulti-user.targetæ˜¯æ ‡å‡†é€‰æ‹©
```

## 7.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ”§ éƒ¨ç½²æ­¥éª¤**ï¼š
```
1. åˆ›å»ºæœåŠ¡æ–‡ä»¶ â†’ /etc/systemd/system/filebeat.service
2. é‡æ–°åŠ è½½é…ç½® â†’ systemctl daemon-reload  
3. å¯åŠ¨æœåŠ¡ â†’ systemctl start filebeat
4. è®¾ç½®å¼€æœºå¯åŠ¨ â†’ systemctl enable filebeat
5. éªŒè¯çŠ¶æ€ â†’ systemctl status filebeat
```

**ğŸ¯ å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š
```
æœåŠ¡å¯åŠ¨å¤±è´¥ï¼š
â€¢ æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³• â†’ journalctl -u filebeat
â€¢ éªŒè¯æ–‡ä»¶æƒé™ â†’ ls -la /etc/filebeat/
â€¢ ç¡®è®¤ç”¨æˆ·å­˜åœ¨ â†’ id filebeat

æœåŠ¡é¢‘ç¹é‡å¯ï¼š
â€¢ æŸ¥çœ‹é”™è¯¯æ—¥å¿— â†’ journalctl -u filebeat -f
â€¢ æ£€æŸ¥èµ„æºé™åˆ¶ â†’ è°ƒæ•´LimitNOFILEç­‰å‚æ•°
â€¢ éªŒè¯é…ç½®æ–‡ä»¶ â†’ filebeat test config
```

**ğŸš€ æœ€ä½³å®è·µ**ï¼š
```
å®‰å…¨å»ºè®®ï¼š
â€¢ ä½¿ç”¨ä¸“é—¨çš„ç”¨æˆ·è¿è¡ŒæœåŠ¡
â€¢ å¯ç”¨å®‰å…¨æ²™ç›’åŠŸèƒ½
â€¢ è®¾ç½®åˆç†çš„èµ„æºé™åˆ¶

è¿ç»´å»ºè®®ï¼š  
â€¢ é…ç½®åˆé€‚çš„é‡å¯ç­–ç•¥
â€¢ è®¾ç½®ç›‘æ§å’Œå‘Šè­¦
â€¢ å®šæœŸæ£€æŸ¥æœåŠ¡çŠ¶æ€

æ€§èƒ½å»ºè®®ï¼š
â€¢ æ ¹æ®è´Ÿè½½è°ƒæ•´èµ„æºé™åˆ¶
â€¢ ä½¿ç”¨å¤šå®ä¾‹åˆ†æ‹…å‹åŠ›
â€¢ ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
```

## 7.4 è®°å¿†å£è¯€



**æ ¸å¿ƒé…ç½®è®°å¿†**ï¼š
```
ğŸ§  Systemdé…ç½®ä¸‰æ­¥èµ°ï¼š
Unitå®šä¾èµ–ï¼ŒServiceé…è¿è¡Œï¼ŒInstallè®¾å¯åŠ¨

ğŸ”¤ é‡å¯ç­–ç•¥è®°å¿†ï¼š
on-failureæœ€å®ç”¨ï¼Œalwayså¤ªé¢‘ç¹ï¼Œnoé‡å¯ä¸æ¢å¤

ğŸ“ æƒé™é…ç½®åŸåˆ™ï¼š
æœ€å°æƒé™å¤Ÿç”¨å°±è¡Œï¼Œå®‰å…¨ç¬¬ä¸€æ€§èƒ½å…¶æ¬¡
```

**å®é™…æ“ä½œæµç¨‹**ï¼š
```
æ”¹é…ç½® â†’ é‡åŠ è½½ â†’ å¯æœåŠ¡ â†’ çœ‹çŠ¶æ€ â†’ æŸ¥æ—¥å¿—
daemon-reload â†’ start â†’ status â†’ journalctl
```

**æ ¸å¿ƒç†è§£**ï¼š
- Systemdè®©Filebeatå˜æˆçœŸæ­£çš„ç³»ç»ŸæœåŠ¡
- é…ç½®ä¾èµ–å…³ç³»ç¡®ä¿å¯åŠ¨é¡ºåºæ­£ç¡®  
- ç”¨æˆ·æƒé™å¹³è¡¡å®‰å…¨æ€§å’ŒåŠŸèƒ½éœ€æ±‚
- é‡å¯ç­–ç•¥ä¿è¯æœåŠ¡é«˜å¯ç”¨æ€§
- æ—¥å¿—é›†æˆä¾¿äºè¿ç»´ç›‘æ§ç®¡ç†