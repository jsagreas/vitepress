---
title: 15ã€nginx.yml.disabledé…ç½®
---
## ğŸ“š ç›®å½•

1. [Nginxæ¨¡å—åŸºç¡€æ¦‚å¿µ](#1-nginxæ¨¡å—åŸºç¡€æ¦‚å¿µ)
2. [Nginxæ—¥å¿—ç±»å‹è¯¦è§£](#2-nginxæ—¥å¿—ç±»å‹è¯¦è§£)
3. [æ¨¡å—é…ç½®æ–‡ä»¶ç»“æ„](#3-æ¨¡å—é…ç½®æ–‡ä»¶ç»“æ„)
4. [è®¿é—®æ—¥å¿—é…ç½®è¯¦è§£](#4-è®¿é—®æ—¥å¿—é…ç½®è¯¦è§£)
5. [é”™è¯¯æ—¥å¿—é…ç½®è¯¦è§£](#5-é”™è¯¯æ—¥å¿—é…ç½®è¯¦è§£)
6. [é«˜çº§é…ç½®åŠŸèƒ½](#6-é«˜çº§é…ç½®åŠŸèƒ½)
7. [å®é™…éƒ¨ç½²ç¤ºä¾‹](#7-å®é™…éƒ¨ç½²ç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Nginxæ¨¡å—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Filebeatçš„Nginxæ¨¡å—


**ç®€å•ç†è§£**ï¼šNginxæ¨¡å—å°±æ˜¯Filebeatä¸“é—¨ä¸ºå¤„ç†NginxæœåŠ¡å™¨æ—¥å¿—è€Œè®¾è®¡çš„**é¢„é…ç½®åŒ…**

```
ç±»æ¯”ç†è§£ï¼š
å°±åƒæ‰‹æœºçš„"ç›¸æœºæ»¤é•œ" â†’ ä¸“é—¨ä¼˜åŒ–æ‹ç…§æ•ˆæœ
Nginxæ¨¡å— â†’ ä¸“é—¨ä¼˜åŒ–Nginxæ—¥å¿—æ”¶é›†æ•ˆæœ

ä¸ç”¨æ¨¡å—ï¼šéœ€è¦è‡ªå·±å†™å¤æ‚é…ç½®ï¼Œå‘Šè¯‰Filebeatæ€ä¹ˆç†è§£Nginxæ—¥å¿—
ä½¿ç”¨æ¨¡å—ï¼šFilebeatå·²ç»çŸ¥é“Nginxæ—¥å¿—çš„æ ¼å¼ï¼Œå¼€ç®±å³ç”¨
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„Nginxæ¨¡å—


**æ ¸å¿ƒé—®é¢˜**ï¼šNginxæ—¥å¿—æœ‰è‡ªå·±çš„ç‰¹æ®Šæ ¼å¼å’Œç»“æ„

```
åŸå§‹Nginxè®¿é—®æ—¥å¿—ç¤ºä¾‹ï¼š
192.168.1.100 - - [21/Sep/2025:14:30:45 +0800] "GET /api/users HTTP/1.1" 200 1234 "https://example.com" "Mozilla/5.0..."

äººçœ¼çœ‹èµ·æ¥ï¼šå°±æ˜¯ä¸€å †æ–‡å­—
Nginxæ¨¡å—çœ‹åˆ°ï¼š
- IPåœ°å€ï¼š192.168.1.100
- æ—¶é—´ï¼š2025å¹´9æœˆ21æ—¥14:30:45
- è¯·æ±‚æ–¹æ³•ï¼šGET
- è¯·æ±‚è·¯å¾„ï¼š/api/users
- çŠ¶æ€ç ï¼š200
- å“åº”å¤§å°ï¼š1234å­—èŠ‚
- æ¥æºç½‘ç«™ï¼šhttps://example.com
- æµè§ˆå™¨ä¿¡æ¯ï¼šMozilla/5.0...
```

**æ¨¡å—çš„ä»·å€¼**ï¼š
- **è‡ªåŠ¨è§£æ**ï¼šä¸éœ€è¦å†™æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¨¡å—çŸ¥é“æ¯éƒ¨åˆ†çš„å«ä¹‰
- **æ™ºèƒ½å¤„ç†**ï¼šè‡ªåŠ¨è¯†åˆ«è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—çš„ä¸åŒæ ¼å¼
- **å¢å¼ºåŠŸèƒ½**ï¼šè‡ªåŠ¨æ·»åŠ åœ°ç†ä½ç½®ã€ç”¨æˆ·ä»£ç†è§£æç­‰é«˜çº§ä¿¡æ¯

### 1.3 æ¨¡å—ä¸é…ç½®æ–‡ä»¶çš„å…³ç³»


```
Filebeatç›®å½•ç»“æ„ï¼š
/etc/filebeat/
â”œâ”€â”€ filebeat.yml           # ä¸»é…ç½®æ–‡ä»¶
â””â”€â”€ modules.d/             # æ¨¡å—é…ç½®ç›®å½•
    â”œâ”€â”€ nginx.yml.disabled # Nginxæ¨¡å—é…ç½®ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
    â”œâ”€â”€ apache.yml.disabled
    â””â”€â”€ mysql.yml.disabled

å¯ç”¨æ¨¡å—çš„æ–¹å¼ï¼š
1. é‡å‘½åæ–‡ä»¶ï¼šnginx.yml.disabled â†’ nginx.yml
2. æˆ–ä½¿ç”¨å‘½ä»¤ï¼šfilebeat modules enable nginx
```

---

## 2. ğŸ“‹ Nginxæ—¥å¿—ç±»å‹è¯¦è§£


### 2.1 è®¿é—®æ—¥å¿—ï¼ˆAccess Logï¼‰


**ä½œç”¨**ï¼šè®°å½•æ¯ä¸€ä¸ªè®¿é—®ç½‘ç«™çš„è¯·æ±‚

```
å…¸å‹è®¿é—®æ—¥å¿—å†…å®¹ï¼š
192.168.1.100 - - [21/Sep/2025:14:30:45 +0800] "GET /index.html HTTP/1.1" 200 2048 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

ä¿¡æ¯è§£è¯»ï¼š
â”Œâ”€ è®¿å®¢IP
â”‚        â”Œâ”€ æ—¶é—´æˆ³
â”‚        â”‚                    â”Œâ”€ è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„
â”‚        â”‚                    â”‚               â”Œâ”€ çŠ¶æ€ç 
â”‚        â”‚                    â”‚               â”‚   â”Œâ”€ å“åº”å¤§å°
192.168.1.100 [21/Sep/2025:14:30:45] "GET /index.html" 200 2048
```

**é»˜è®¤æ—¥å¿—ä½ç½®**ï¼š
- CentOS/RHELï¼š`/var/log/nginx/access.log`
- Ubuntu/Debianï¼š`/var/log/nginx/access.log`
- è‡ªå®šä¹‰è·¯å¾„ï¼šåœ¨nginx.confä¸­é…ç½®

### 2.2 é”™è¯¯æ—¥å¿—ï¼ˆError Logï¼‰


**ä½œç”¨**ï¼šè®°å½•æœåŠ¡å™¨è¿è¡Œä¸­çš„é”™è¯¯å’Œè­¦å‘Š

```
å…¸å‹é”™è¯¯æ—¥å¿—å†…å®¹ï¼š
2025/09/21 14:30:45 [error] 12345#0: *67890 open() "/var/www/html/missing.html" failed (2: No such file or directory)

ä¿¡æ¯è§£è¯»ï¼š
â”Œâ”€ æ—¶é—´        â”Œâ”€ æ—¥å¿—çº§åˆ«  â”Œâ”€ è¿›ç¨‹ID    â”Œâ”€ è¿æ¥ID
â”‚             â”‚           â”‚           â”‚      â”Œâ”€ å…·ä½“é”™è¯¯æè¿°
2025/09/21 14:30:45 [error] 12345#0: *67890 æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯
```

**é”™è¯¯çº§åˆ«è¯´æ˜**ï¼š
- `debug`ï¼šè°ƒè¯•ä¿¡æ¯ï¼ˆæœ€è¯¦ç»†ï¼‰
- `info`ï¼šä¸€èˆ¬ä¿¡æ¯
- `notice`ï¼šæ³¨æ„äº‹é¡¹
- `warn`ï¼šè­¦å‘Šä¿¡æ¯
- `error`ï¼šé”™è¯¯ä¿¡æ¯
- `crit`ï¼šä¸¥é‡é”™è¯¯
- `alert`ï¼šç´§æ€¥æƒ…å†µ
- `emerg`ï¼šç³»ç»Ÿä¸å¯ç”¨ï¼ˆæœ€ä¸¥é‡ï¼‰

---

## 3. ğŸ”§ æ¨¡å—é…ç½®æ–‡ä»¶ç»“æ„


### 3.1 åŸºæœ¬é…ç½®æ–‡ä»¶ç»“æ„


**nginx.ymlé…ç½®æ–‡ä»¶çš„åŸºæœ¬æ¡†æ¶**ï¼š

```yaml
# Nginxæ¨¡å—é…ç½®æ–‡ä»¶ç»“æ„
- module: nginx
  # è®¿é—®æ—¥å¿—é…ç½®éƒ¨åˆ†
  access:
    enabled: true                    # æ˜¯å¦å¯ç”¨è®¿é—®æ—¥å¿—æ”¶é›†
    var.paths: ["/var/log/nginx/access.log*"]  # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  
  # é”™è¯¯æ—¥å¿—é…ç½®éƒ¨åˆ†  
  error:
    enabled: true                    # æ˜¯å¦å¯ç”¨é”™è¯¯æ—¥å¿—æ”¶é›†
    var.paths: ["/var/log/nginx/error.log*"]   # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

### 3.2 é…ç½®æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„ç†è§£


```
é…ç½®å±‚æ¬¡å…³ç³»ï¼š
nginx.yml (æ•´ä¸ªæ¨¡å—)
â”œâ”€â”€ access (è®¿é—®æ—¥å¿—éƒ¨åˆ†)
â”‚   â”œâ”€â”€ enabled: true/false
â”‚   â”œâ”€â”€ var.paths: [æ—¥å¿—è·¯å¾„åˆ—è¡¨]
â”‚   â””â”€â”€ var.other_options: å…¶ä»–é€‰é¡¹
â””â”€â”€ error (é”™è¯¯æ—¥å¿—éƒ¨åˆ†)
    â”œâ”€â”€ enabled: true/false
    â”œâ”€â”€ var.paths: [æ—¥å¿—è·¯å¾„åˆ—è¡¨]
    â””â”€â”€ var.other_options: å…¶ä»–é€‰é¡¹
```

**varå‰ç¼€çš„å«ä¹‰**ï¼š
- `var.` å¼€å¤´çš„é…ç½®é¡¹æ˜¯**æ¨¡å—å˜é‡**
- è¿™äº›å˜é‡ä¼šä¼ é€’ç»™Filebeatçš„å†…éƒ¨å¤„ç†å™¨
- ä¸åŒæ¨¡å—æœ‰ä¸åŒçš„å¯ç”¨å˜é‡

---

## 4. ğŸ“Š è®¿é—®æ—¥å¿—é…ç½®è¯¦è§£


### 4.1 åŸºç¡€è®¿é—®æ—¥å¿—é…ç½®


```yaml
- module: nginx
  access:
    enabled: true
    var.paths: 
      - "/var/log/nginx/access.log*"      # å½“å‰æ—¥å¿—æ–‡ä»¶
      - "/var/log/nginx/access.log-*"     # è½®è½¬çš„å†å²æ—¥å¿—æ–‡ä»¶
```

**è·¯å¾„é…ç½®è¯´æ˜**ï¼š
- `*` æ˜¯é€šé…ç¬¦ï¼ŒåŒ¹é…ä»»æ„å­—ç¬¦
- `access.log*` ä¼šåŒ¹é…ï¼š`access.log`ã€`access.log.1`ã€`access.log.2.gz`
- å¤šä¸ªè·¯å¾„ç”¨YAMLåˆ—è¡¨æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªè·¯å¾„

### 4.2 è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼é…ç½®


**å½“Nginxä½¿ç”¨éæ ‡å‡†æ—¥å¿—æ ¼å¼æ—¶**ï¼š

```yaml
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    # æŒ‡å®šè‡ªå®šä¹‰çš„æ—¥å¿—æ ¼å¼
    var.format: >
      $remote_addr - $remote_user [$time_local] "$request" 
      $status $body_bytes_sent "$http_referer" "$http_user_agent" 
      "$http_x_forwarded_for" $request_time
```

**å¸¸è§çš„Nginxæ—¥å¿—æ ¼å¼å˜é‡**ï¼š
- `$remote_addr`ï¼šå®¢æˆ·ç«¯IPåœ°å€
- `$time_local`ï¼šæœ¬åœ°æ—¶é—´
- `$request`ï¼šè¯·æ±‚è¡Œï¼ˆæ–¹æ³• + URL + åè®®ç‰ˆæœ¬ï¼‰
- `$status`ï¼šHTTPçŠ¶æ€ç 
- `$body_bytes_sent`ï¼šå‘é€ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°
- `$http_referer`ï¼šæ¥æºé¡µé¢
- `$http_user_agent`ï¼šç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ä¿¡æ¯ï¼‰
- `$request_time`ï¼šè¯·æ±‚å¤„ç†æ—¶é—´

### 4.3 å¤šç«™ç‚¹æ—¥å¿—é…ç½®


**å½“æœ‰å¤šä¸ªç½‘ç«™æ—¶**ï¼š

```yaml
- module: nginx
  access:
    enabled: true
    var.paths: 
      - "/var/log/nginx/site1-access.log*"
      - "/var/log/nginx/site2-access.log*"
      - "/var/log/nginx/api-access.log*"
    # ä¸ºä¸åŒæ—¥å¿—æ·»åŠ æ ‡è¯†å­—æ®µ
    fields:
      service: "web-frontend"
      environment: "production"
    fields_under_root: true
```

---

## 5. âš ï¸ é”™è¯¯æ—¥å¿—é…ç½®è¯¦è§£


### 5.1 åŸºç¡€é”™è¯¯æ—¥å¿—é…ç½®


```yaml
- module: nginx
  error:
    enabled: true
    var.paths: ["/var/log/nginx/error.log*"]
```

### 5.2 é”™è¯¯çº§åˆ«è¿‡æ»¤é…ç½®


**åªæ”¶é›†ç‰¹å®šçº§åˆ«çš„é”™è¯¯**ï¼š

```yaml
- module: nginx
  error:
    enabled: true
    var.paths: ["/var/log/nginx/error.log*"]
    # æ·»åŠ å¤„ç†å™¨æ¥è¿‡æ»¤æ—¥å¿—çº§åˆ«
    processors:
      - drop_event:
          when:
            regexp:
              message: "\\[debug\\]|\\[info\\]"  # æ’é™¤debugå’Œinfoçº§åˆ«
```

### 5.3 å¤šçº§åˆ«é”™è¯¯æ—¥å¿—é…ç½®


**å½“Nginxé…ç½®äº†ä¸åŒçº§åˆ«çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶**ï¼š

```yaml
- module: nginx
  error:
    enabled: true
    var.paths: 
      - "/var/log/nginx/error.log*"        # ä¸€èˆ¬é”™è¯¯æ—¥å¿—
      - "/var/log/nginx/error-debug.log*"  # è°ƒè¯•æ—¥å¿—
    fields:
      log_type: "nginx_error"
```

---

## 6. ğŸš€ é«˜çº§é…ç½®åŠŸèƒ½


### 6.1 åœ°ç†ä½ç½®è§£æé…ç½®


**è‡ªåŠ¨è§£æIPåœ°å€çš„åœ°ç†ä½ç½®**ï¼š

```yaml
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    # å¯ç”¨GeoIPè§£æ
    var.geoip:
      enabled: true
      database_path: "/usr/share/GeoIP/GeoLite2-City.mmdb"
```

> ğŸ’¡ **è¯´æ˜**ï¼šåœ°ç†ä½ç½®è§£æå¯ä»¥å‘Šè¯‰ä½ è®¿å®¢æ¥è‡ªå“ªä¸ªå›½å®¶ã€åŸå¸‚ï¼Œå¯¹åˆ†æç”¨æˆ·åˆ†å¸ƒå¾ˆæœ‰ç”¨

### 6.2 ç”¨æˆ·ä»£ç†è§£æé…ç½®


**è§£ææµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯**ï¼š

```yaml
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    # å¯ç”¨ç”¨æˆ·ä»£ç†è§£æ
    var.user_agent:
      enabled: true
```

**è§£æç»“æœç¤ºä¾‹**ï¼š
```
åŸå§‹user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
è§£æåè·å¾—ï¼š
- æµè§ˆå™¨ï¼šChrome
- æ“ä½œç³»ç»Ÿï¼šWindows 10
- è®¾å¤‡ç±»å‹ï¼šDesktop
```

### 6.3 è‡ªå®šä¹‰å­—æ®µæ·»åŠ 


**ä¸ºæ—¥å¿—æ·»åŠ é¢å¤–çš„æ ‡è¯†ä¿¡æ¯**ï¼š

```yaml
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    # æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
    fields:
      datacenter: "beijing"      # æ•°æ®ä¸­å¿ƒæ ‡è¯†
      server_role: "frontend"    # æœåŠ¡å™¨è§’è‰²
      team: "devops"            # è´Ÿè´£å›¢é˜Ÿ
    fields_under_root: true      # å­—æ®µæ”¾åœ¨æ ¹çº§åˆ«ï¼Œè€Œä¸æ˜¯fieldså­å¯¹è±¡ä¸­
```

### 6.4 ç´¢å¼•æ¨¡æ¿é…ç½®


**æŒ‡å®šæ•°æ®å‘é€åˆ°ç‰¹å®šçš„Elasticsearchç´¢å¼•**ï¼š

```yaml
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    # è‡ªå®šä¹‰ç´¢å¼•è®¾ç½®
    index: "nginx-access-%{+yyyy.MM.dd}"    # æŒ‰æ—¥æœŸåˆ›å»ºç´¢å¼•
  error:
    enabled: true
    var.paths: ["/var/log/nginx/error.log*"]
    index: "nginx-error-%{+yyyy.MM.dd}"     # é”™è¯¯æ—¥å¿—å•ç‹¬ç´¢å¼•
```

---

## 7. ğŸ’¼ å®é™…éƒ¨ç½²ç¤ºä¾‹


### 7.1 å•æœºWebæœåŠ¡å™¨é…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šå•å°æœåŠ¡å™¨è¿è¡Œä¸€ä¸ªç½‘ç«™

```yaml
# /etc/filebeat/modules.d/nginx.yml
- module: nginx
  # è®¿é—®æ—¥å¿—é…ç½®
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    fields:
      server_name: "web01"
      site: "company-website"
    fields_under_root: true
  
  # é”™è¯¯æ—¥å¿—é…ç½®
  error:
    enabled: true
    var.paths: ["/var/log/nginx/error.log*"]
    fields:
      server_name: "web01"
      site: "company-website"
    fields_under_root: true
```

### 7.2 å¤šç«™ç‚¹æœåŠ¡å™¨é…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šä¸€å°æœåŠ¡å™¨æ‰˜ç®¡å¤šä¸ªç½‘ç«™

```yaml
# ä¸»ç«™é…ç½®
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/mainsite-access.log*"]
    fields:
      site: "mainsite"
      priority: "high"
  error:
    enabled: true
    var.paths: ["/var/log/nginx/mainsite-error.log*"]
    fields:
      site: "mainsite"
      priority: "high"

# APIæœåŠ¡é…ç½®
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/api-access.log*"]
    fields:
      site: "api"
      service_type: "backend"
  error:
    enabled: true
    var.paths: ["/var/log/nginx/api-error.log*"]
    fields:
      site: "api"
      service_type: "backend"
```

### 7.3 è´Ÿè½½å‡è¡¡ç¯å¢ƒé…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šå¤šå°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤

```yaml
# å‰ç«¯è´Ÿè½½å‡è¡¡å™¨
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]
    var.format: >
      $remote_addr - $remote_user [$time_local] "$request" 
      $status $body_bytes_sent "$http_referer" "$http_user_agent" 
      "$http_x_forwarded_for" $upstream_addr $request_time $upstream_response_time
    fields:
      server_role: "loadbalancer"
      cluster: "web-cluster"
    fields_under_root: true
```

**å…³é”®é…ç½®è¯´æ˜**ï¼š
- `$upstream_addr`ï¼šåç«¯æœåŠ¡å™¨åœ°å€ï¼Œåœ¨è´Ÿè½½å‡è¡¡ç¯å¢ƒä¸­å¾ˆé‡è¦
- `$request_time`ï¼šæ€»è¯·æ±‚æ—¶é—´
- `$upstream_response_time`ï¼šåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´

### 7.4 å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®


```yaml
# ç”Ÿäº§ç¯å¢ƒå®Œæ•´é…ç½®ç¤ºä¾‹
- module: nginx
  access:
    enabled: true
    var.paths: 
      - "/var/log/nginx/access.log*"
      - "/var/log/nginx/ssl-access.log*"
    
    # å¯ç”¨é«˜çº§åŠŸèƒ½
    var.geoip:
      enabled: true
      database_path: "/usr/share/GeoIP/GeoLite2-City.mmdb"
    
    var.user_agent:
      enabled: true
    
    # æ·»åŠ ç¯å¢ƒæ ‡è¯†
    fields:
      environment: "production"
      datacenter: "beijing"
      server_id: "web01"
      team: "platform"
    fields_under_root: true
    
    # æ·»åŠ å¤„ç†å™¨
    processors:
      # æ’é™¤å¥åº·æ£€æŸ¥è¯·æ±‚
      - drop_event:
          when:
            regexp:
              nginx.access.url: "/health|/ping|/status"
      
      # æ·»åŠ æ—¶é—´æˆ³
      - timestamp:
          field: "@timestamp"
          layouts:
            - '2006-01-02T15:04:05.999Z'
            - '2006-01-02T15:04:05.999-07:00'
  
  error:
    enabled: true
    var.paths: ["/var/log/nginx/error.log*"]
    
    fields:
      environment: "production"
      datacenter: "beijing" 
      server_id: "web01"
      team: "platform"
    fields_under_root: true
    
    # åªæ”¶é›†errorçº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—
    processors:
      - drop_event:
          when:
            regexp:
              message: "\\[debug\\]|\\[info\\]|\\[notice\\]"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


```
ğŸ”¸ Nginxæ¨¡å—æœ¬è´¨ï¼šä¸“é—¨å¤„ç†Nginxæ—¥å¿—çš„é¢„é…ç½®åŒ…
ğŸ”¸ ä¸¤ç§æ—¥å¿—ç±»å‹ï¼šè®¿é—®æ—¥å¿—(è®°å½•è¯·æ±‚) + é”™è¯¯æ—¥å¿—(è®°å½•é—®é¢˜)  
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼šmodule â†’ access/error â†’ enabled/paths/options
ğŸ”¸ varå˜é‡æ¦‚å¿µï¼šæ¨¡å—ç‰¹æœ‰çš„é…ç½®å˜é‡ï¼Œç”¨äºå®šåˆ¶å¤„ç†è¡Œä¸º
ğŸ”¸ è·¯å¾„é€šé…ç¬¦ï¼šä½¿ç”¨*åŒ¹é…å¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒåŒ…æ‹¬è½®è½¬çš„å†å²æ–‡ä»¶
```

### 8.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ è·¯å¾„é…ç½®æœ€ä½³å®è·µ**ï¼š
```yaml
# âœ… æ¨èåšæ³•
var.paths: 
  - "/var/log/nginx/access.log*"    # åŒ…å«è½®è½¬æ–‡ä»¶
  - "/var/log/nginx/ssl-access.log*" # å¤šä¸ªæ—¥å¿—æº

# âŒ é¿å…çš„åšæ³•  
var.paths: ["/var/log/nginx/access.log"]  # åªæ”¶é›†å½“å‰æ–‡ä»¶ï¼Œä¸¢å¤±å†å²æ•°æ®
```

**ğŸ”¹ å­—æ®µæ·»åŠ ç­–ç•¥**ï¼š
```yaml
# ç¯å¢ƒæ ‡è¯† - å¿…éœ€
fields:
  environment: "production"  # åŒºåˆ†å¼€å‘/æµ‹è¯•/ç”Ÿäº§
  server_id: "web01"        # æœåŠ¡å™¨æ ‡è¯†
  team: "platform"          # è´Ÿè´£å›¢é˜Ÿ

# ä¸šåŠ¡æ ‡è¯† - æ ¹æ®éœ€è¦
fields:
  site: "mainsite"          # ç«™ç‚¹æ ‡è¯†
  service_type: "frontend"  # æœåŠ¡ç±»å‹
```

### 8.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**é—®é¢˜1ï¼šæ—¥å¿—æ”¶é›†ä¸åˆ°**
```
å¯èƒ½åŸå› ï¼š
1. è·¯å¾„é…ç½®é”™è¯¯ â†’ æ£€æŸ¥å®é™…æ—¥å¿—æ–‡ä»¶ä½ç½®
2. æƒé™ä¸è¶³ â†’ ç¡®ä¿filebeatç”¨æˆ·å¯è¯»å–æ—¥å¿—æ–‡ä»¶  
3. æ–‡ä»¶æœªå¯ç”¨ â†’ æ£€æŸ¥nginx.ymlæ–‡ä»¶æ˜¯å¦å»æ‰äº†.disabledåç¼€

è§£å†³æ­¥éª¤ï¼š
1. éªŒè¯è·¯å¾„ï¼šls -la /var/log/nginx/
2. æ£€æŸ¥æƒé™ï¼šsudo -u filebeat cat /var/log/nginx/access.log
3. æŸ¥çœ‹çŠ¶æ€ï¼šfilebeat modules list
```

**é—®é¢˜2ï¼šæ—¥å¿—æ ¼å¼è§£æå¤±è´¥**
```
å¯èƒ½åŸå› ï¼š
1. Nginxä½¿ç”¨äº†è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼
2. æ¨¡å—çš„é»˜è®¤æ ¼å¼ä¸å®é™…ä¸åŒ¹é…

è§£å†³æ–¹æ¡ˆï¼š
1. æŸ¥çœ‹nginx.confä¸­çš„log_formaté…ç½®
2. åœ¨æ¨¡å—ä¸­æ·»åŠ var.formaté…ç½®
3. æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰çš„æ—¥å¿—è¾“å…¥è€Œä¸æ˜¯æ¨¡å—
```

**é—®é¢˜3ï¼šæ€§èƒ½å½±å“**
```
ä¼˜åŒ–ç­–ç•¥ï¼š
1. ä½¿ç”¨æ’é™¤å¤„ç†å™¨è¿‡æ»¤æ— ç”¨æ—¥å¿—
2. åˆç†è®¾ç½®æ—¥å¿—çº§åˆ«
3. é¿å…æ”¶é›†è¿‡äºé¢‘ç¹çš„å¥åº·æ£€æŸ¥æ—¥å¿—
4. æ ¹æ®ä¸šåŠ¡éœ€è¦é€‰æ‹©å¯ç”¨çš„åŠŸèƒ½
```

### 8.4 å®è·µå»ºè®®


**ğŸ¯ éƒ¨ç½²ç­–ç•¥**ï¼š
- **å¼€å‘ç¯å¢ƒ**ï¼šç®€å•é…ç½®ï¼Œå¿«é€ŸéªŒè¯åŠŸèƒ½
- **æµ‹è¯•ç¯å¢ƒ**ï¼šå®Œæ•´é…ç½®ï¼ŒéªŒè¯æ‰€æœ‰åŠŸèƒ½
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä¼˜åŒ–é…ç½®ï¼Œæ³¨é‡æ€§èƒ½å’Œç¨³å®šæ€§

**ğŸ“Š ç›‘æ§é‡ç‚¹**ï¼š
- **è®¿é—®æ—¥å¿—**ï¼šå…³æ³¨å“åº”æ—¶é—´ã€çŠ¶æ€ç åˆ†å¸ƒã€è®¿é—®é‡è¶‹åŠ¿
- **é”™è¯¯æ—¥å¿—**ï¼šå…³æ³¨errorçº§åˆ«ä»¥ä¸Šçš„é—®é¢˜ï¼ŒåŠæ—¶å¤„ç†å¼‚å¸¸

**ğŸ”§ ç»´æŠ¤è¦ç‚¹**ï¼š
- å®šæœŸæ£€æŸ¥æ—¥å¿—è½®è½¬æ˜¯å¦æ­£å¸¸
- ç›‘æ§Filebeatçš„èµ„æºä½¿ç”¨æƒ…å†µ
- æ ¹æ®ä¸šåŠ¡å˜åŒ–è°ƒæ•´é…ç½®

**æ ¸å¿ƒè®°å¿†**ï¼š
- Nginxæ¨¡å—è®©æ—¥å¿—æ”¶é›†å˜ç®€å•ï¼Œå¼€ç®±å³ç”¨
- ä¸¤ç§æ—¥å¿—å„æœ‰ç”¨é€”ï¼šè®¿é—®çœ‹ä¸šåŠ¡ï¼Œé”™è¯¯æŸ¥é—®é¢˜
- é…ç½®æ–‡ä»¶ç»“æ„æ¸…æ™°ï¼šæ¨¡å—â†’ç±»å‹â†’é€‰é¡¹
- ç”Ÿäº§ç¯å¢ƒè¦åŠ æ ‡è¯†å­—æ®µï¼Œæ–¹ä¾¿åç»­åˆ†æå’Œæ’æŸ¥