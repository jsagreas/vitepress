---
title: 11ã€logstash-output.yml é…ç½®
---
## ğŸ“š ç›®å½•

1. [Filebeatå’ŒLogstashå…³ç³»è§£æ](#1-filebeatå’Œlogstashå…³ç³»è§£æ)
2. [Logstashè¾“å‡ºåŸºç¡€é…ç½®](#2-logstashè¾“å‡ºåŸºç¡€é…ç½®)
3. [è¿æ¥é…ç½®è¯¦è§£](#3-è¿æ¥é…ç½®è¯¦è§£)
4. [æ€§èƒ½ä¼˜åŒ–é…ç½®](#4-æ€§èƒ½ä¼˜åŒ–é…ç½®)
5. [å®‰å…¨ä¼ è¾“é…ç½®](#5-å®‰å…¨ä¼ è¾“é…ç½®)
6. [é«˜å¯ç”¨ä¸è´Ÿè½½å‡è¡¡](#6-é«˜å¯ç”¨ä¸è´Ÿè½½å‡è¡¡)
7. [æ•…éšœå¤„ç†ä¸é‡è¯•ç­–ç•¥](#7-æ•…éšœå¤„ç†ä¸é‡è¯•ç­–ç•¥)
8. [å®é™…éƒ¨ç½²é…ç½®æ ·ä¾‹](#8-å®é™…éƒ¨ç½²é…ç½®æ ·ä¾‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— Filebeatå’ŒLogstashå…³ç³»è§£æ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®ä¼ è¾“é“¾è·¯


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸‹å¿«é€’ç³»ç»Ÿ
```
ä½ çš„åŒ…è£¹ â†’ æ”¶ä»¶å‘˜(Filebeat) â†’ åˆ†æ‹£ä¸­å¿ƒ(Logstash) â†’ æœ€ç»ˆä»“åº“(Elasticsearch)

æ—¥å¿—æ•°æ® â†’ Filebeatæ”¶é›† â†’ Logstashå¤„ç† â†’ Elasticsearchå­˜å‚¨
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡**
- **åˆ†å·¥æ˜ç¡®**ï¼šFilebeatä¸“é—¨è´Ÿè´£æ”¶é›†ï¼ŒLogstashä¸“é—¨è´Ÿè´£å¤„ç†
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…åœ¨æœåŠ¡å™¨ä¸Šåšå¤æ‚å¤„ç†ï¼Œå‡è½»å‹åŠ›
- **çµæ´»å¤„ç†**ï¼šLogstashå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¤æ‚çš„è½¬æ¢å’Œæ¸…æ´—

### 1.2 Filebeatåˆ°Logstashçš„æ•°æ®æµ


```
åº”ç”¨æœåŠ¡å™¨                    æ•°æ®å¤„ç†æœåŠ¡å™¨               å­˜å‚¨æœåŠ¡å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨æ—¥å¿—    â”‚              â”‚  Logstash   â”‚             â”‚Elasticsearchâ”‚
â”‚     â†“       â”‚    æ•°æ®ä¼ è¾“   â”‚     â†“       â”‚   å¤„ç†å     â”‚             â”‚
â”‚  Filebeat   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   è§£æè¿‡æ»¤   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚    ç´¢å¼•     â”‚
â”‚   (é‡‡é›†)    â”‚              â”‚   æ ¼å¼è½¬æ¢   â”‚             â”‚   (å­˜å‚¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ¯ å…³é”®ç†è§£**
- Filebeat = **æ•°æ®é‡‡é›†å‘˜**ï¼Œè½»é‡çº§ï¼Œä¸“é—¨è¯»å–æ–‡ä»¶
- Logstash = **æ•°æ®å¤„ç†å‚**ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥è§£æã€è¿‡æ»¤ã€è½¬æ¢æ•°æ®
- ä¸¤è€…é…åˆ = **é«˜æ•ˆçš„æ•°æ®ç®¡é“**

---

## 2. âš™ï¸ Logstashè¾“å‡ºåŸºç¡€é…ç½®


### 2.1 æœ€ç®€å•çš„é…ç½®


```yaml
# åŸºç¡€çš„Logstashè¾“å‡ºé…ç½®
output.logstash:
  hosts: ["localhost:5044"]
```

**ğŸ“– é€è¡Œè§£é‡Š**
- `output.logstash:` - å‘Šè¯‰Filebeat"æˆ‘è¦æŠŠæ•°æ®å‘ç»™Logstash"
- `hosts:` - æŒ‡å®šLogstashæœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£
- `"localhost:5044"` - Logstashé»˜è®¤ç›‘å¬5044ç«¯å£

### 2.2 å¤šæœåŠ¡å™¨é…ç½®


```yaml
# å¤šä¸ªLogstashæœåŠ¡å™¨é…ç½®
output.logstash:
  hosts: 
    - "logstash1.company.com:5044"
    - "logstash2.company.com:5044"
    - "logstash3.company.com:5044"
```

**ğŸ”„ å·¥ä½œåŸç†**
- Filebeatä¼š**è‡ªåŠ¨é€‰æ‹©**ä¸€ä¸ªå¯ç”¨çš„LogstashæœåŠ¡å™¨
- å¦‚æœä¸€ä¸ªæœåŠ¡å™¨æŒ‚äº†ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€ä¸ª
- è¿™å«**é«˜å¯ç”¨æ€§**ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±

### 2.3 åŸºç¡€é…ç½®å‚æ•°è¯´æ˜


| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|------|------|--------|------|
| `hosts` | LogstashæœåŠ¡å™¨åœ°å€åˆ—è¡¨ | å¿…é¡»é…ç½® | `["192.168.1.100:5044"]` |
| `worker` | å¹¶å‘å·¥ä½œçº¿ç¨‹æ•° | `1` | `worker: 2` |
| `loadbalance` | è´Ÿè½½å‡è¡¡å¼€å…³ | `false` | `loadbalance: true` |
| `index` | æŒ‡å®šç´¢å¼•åç§° | è‡ªåŠ¨ | `index: "my-logs-%{+yyyy.MM.dd}"` |

---

## 3. ğŸŒ è¿æ¥é…ç½®è¯¦è§£


### 3.1 è¿æ¥è¶…æ—¶è®¾ç½®


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # è¿æ¥è¶…æ—¶è®¾ç½®
  timeout: 30s          # è¿æ¥è¶…æ—¶æ—¶é—´
  ttl: 30s             # è¿æ¥å­˜æ´»æ—¶é—´
  pipelining: 2        # ç®¡é“å¹¶å‘æ•°
```

**ğŸ“‹ å‚æ•°å«ä¹‰è§£é‡Š**
- **timeout** - ç­‰å¾…è¿æ¥å»ºç«‹çš„æœ€é•¿æ—¶é—´ï¼ˆæƒ³è±¡æ‹¨å·ç­‰å¾…ï¼‰
- **ttl** - è¿æ¥ä¿æŒæ´»è·ƒçš„æ—¶é—´ï¼ˆåƒç”µè¯é€šè¯æ—¶é•¿ï¼‰
- **pipelining** - åŒæ—¶å‘é€å¤šå°‘æ‰¹æ•°æ®ï¼ˆåƒåŒæ—¶å¤„ç†å‡ ä¸ªå¿«é€’åŒ…è£¹ï¼‰

### 3.2 è¿æ¥æ± ç®¡ç†


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # è¿æ¥æ± é…ç½®
  worker: 1            # å·¥ä½œçº¿ç¨‹æ•°
  bulk_max_size: 2048  # æ‰¹é‡å‘é€å¤§å°
  flush_interval: 1s   # å¼ºåˆ¶å‘é€é—´éš”
```

**ğŸ’¡ é€šä¿—ç†è§£è¿æ¥æ± **
```
æƒ³è±¡ä¸€ä¸ªé¤å…ï¼š
- worker: 1 = åªæœ‰1ä¸ªæœåŠ¡å‘˜
- bulk_max_size: 2048 = æ¯æ¬¡æœ€å¤šç«¯2048ä¸ªç›˜å­
- flush_interval: 1s = æ¯1ç§’å¿…é¡»å»å¨æˆ¿ä¸€æ¬¡

æ•°æ®ä¼ è¾“ä¹Ÿæ˜¯è¿™æ ·ï¼š
- æ”¶é›†ä¸€æ‰¹æ•°æ®å†å‘é€ï¼ˆæé«˜æ•ˆç‡ï¼‰
- å®šæ—¶å‘é€é¿å…æ•°æ®ç§¯å‹
```

### 3.3 ç½‘ç»œé…ç½®ä¼˜åŒ–


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # ç½‘ç»œä¼˜åŒ–
  compression_level: 1  # å‹ç¼©çº§åˆ« (0-9)
  escape_html: false   # ä¸è½¬ä¹‰HTMLå­—ç¬¦
  
  # è¿æ¥å¤ç”¨
  max_retries: 3       # æœ€å¤§é‡è¯•æ¬¡æ•°
  backoff.init: 1s     # åˆå§‹é‡è¯•é—´éš”
  backoff.max: 60s     # æœ€å¤§é‡è¯•é—´éš”
```

---

## 4. ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®


### 4.1 æ‰¹é‡ä¼ è¾“ä¼˜åŒ–


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # æ‰¹é‡ä¼ è¾“è®¾ç½®
  bulk_max_size: 2048     # æ¯æ‰¹æœ€å¤§äº‹ä»¶æ•°
  flush_interval: 1s      # å¼ºåˆ¶åˆ·æ–°é—´éš”
  
  # æ€§èƒ½è°ƒä¼˜
  worker: 2              # å¹¶å‘å·¥ä½œçº¿ç¨‹
  pipelining: 2          # ç®¡é“å¹¶å‘æ•°
```

**ğŸ“Š æ€§èƒ½è°ƒä¼˜ç­–ç•¥**

| åœºæ™¯ | worker | bulk_max_size | flush_interval | è¯´æ˜ |
|------|--------|---------------|----------------|------|
| **ä½æµé‡** | `1` | `1024` | `5s` | èŠ‚çœèµ„æºï¼Œå»¶è¿Ÿç¨é«˜ |
| **ä¸­æµé‡** | `2` | `2048` | `1s` | å¹³è¡¡æ€§èƒ½å’Œèµ„æº |
| **é«˜æµé‡** | `4` | `4096` | `500ms` | è¿½æ±‚æœ€å¤§ååé‡ |

### 4.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # å†…å­˜ä¼˜åŒ–
  bulk_max_size: 1024      # å‡å°æ‰¹é‡å¤§å°
  flush_interval: 2s       # é€‚å½“å»¶é•¿é—´éš”
  
  # æ§åˆ¶é˜Ÿåˆ—å¤§å°
  queue.mem.events: 4096   # å†…å­˜é˜Ÿåˆ—å¤§å°
  queue.mem.flush.min_events: 512  # æœ€å°åˆ·æ–°äº‹ä»¶æ•°
```

**âš¡ æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```bash
# ç›‘æ§Filebeatæ€§èƒ½çš„å…³é”®æŒ‡æ ‡

å‘é€é€Ÿç‡ï¼š    events/second
é˜Ÿåˆ—ä½¿ç”¨ç‡ï¼š  queue usage %
è¿æ¥çŠ¶æ€ï¼š    connection status
é”™è¯¯ç‡ï¼š      error rate %
```

---

## 5. ğŸ”’ å®‰å…¨ä¼ è¾“é…ç½®


### 5.1 SSL/TLSåŠ å¯†é…ç½®


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # SSLåŠ å¯†ä¼ è¾“
  ssl.enabled: true
  ssl.certificate_authorities: ["/etc/filebeat/ca.crt"]
  ssl.certificate: "/etc/filebeat/client.crt"
  ssl.key: "/etc/filebeat/client.key"
```

**ğŸ” SSLè¯ä¹¦æ–‡ä»¶è¯´æ˜**
```
è¯ä¹¦æ–‡ä»¶ç»“æ„ï¼š
/etc/filebeat/
â”œâ”€â”€ ca.crt          â† CAæ ¹è¯ä¹¦ï¼ˆéªŒè¯æœåŠ¡å™¨èº«ä»½ï¼‰
â”œâ”€â”€ client.crt      â† å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆè¯æ˜è‡ªå·±èº«ä»½ï¼‰
â””â”€â”€ client.key      â† å®¢æˆ·ç«¯ç§é’¥ï¼ˆåŠ å¯†é€šä¿¡ï¼‰

ç±»æ¯”ç†è§£ï¼š
ca.crt = èº«ä»½è¯å‘è¯æœºå…³çš„å…¬ç« 
client.crt = ä½ çš„èº«ä»½è¯
client.key = ä½ çš„å¯†ç 
```

### 5.2 SSLéªŒè¯é€‰é¡¹


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  ssl.enabled: true
  ssl.verification_mode: "full"    # å®Œæ•´éªŒè¯
  # ssl.verification_mode: "none"  # è·³è¿‡éªŒè¯ï¼ˆä¸å®‰å…¨ï¼‰
  
  # é«˜çº§SSLé€‰é¡¹
  ssl.supported_protocols: ["TLSv1.2", "TLSv1.3"]
  ssl.cipher_suites: []            # ä½¿ç”¨é»˜è®¤åŠ å¯†å¥—ä»¶
  ssl.curve_types: []              # ä½¿ç”¨é»˜è®¤æ¤­åœ†æ›²çº¿
```

**ğŸ›¡ï¸ éªŒè¯æ¨¡å¼é€‰æ‹©**
- **full** - æœ€å®‰å…¨ï¼ŒéªŒè¯è¯ä¹¦å’Œä¸»æœºå
- **certificate** - éªŒè¯è¯ä¹¦ï¼Œä¸éªŒè¯ä¸»æœºå  
- **none** - ä¸éªŒè¯ï¼ˆä»…ç”¨äºæµ‹è¯•ç¯å¢ƒï¼‰

### 5.3 å®‰å…¨é…ç½®æœ€ä½³å®è·µ


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
  ssl.enabled: true
  ssl.verification_mode: "full"
  ssl.certificate_authorities: ["/etc/ssl/certs/ca-bundle.crt"]
  
  # è¶…æ—¶è®¾ç½®
  timeout: 30s
  
  # é‡è¯•ç­–ç•¥
  max_retries: 3
  backoff.init: 1s
  backoff.max: 60s
```

---

## 6. âš–ï¸ é«˜å¯ç”¨ä¸è´Ÿè½½å‡è¡¡


### 6.1 è´Ÿè½½å‡è¡¡é…ç½®


```yaml
output.logstash:
  # å¤šæœåŠ¡å™¨è´Ÿè½½å‡è¡¡
  hosts:
    - "logstash1.company.com:5044"
    - "logstash2.company.com:5044"
    - "logstash3.company.com:5044"
  
  # å¯ç”¨è´Ÿè½½å‡è¡¡
  loadbalance: true
  
  # å·¥ä½œçº¿ç¨‹é…ç½®
  worker: 1              # æ¯ä¸ªè¿æ¥ä¸€ä¸ªå·¥ä½œçº¿ç¨‹
```

**ğŸ”„ è´Ÿè½½å‡è¡¡å·¥ä½œåŸç†**
```
è½®è¯¢æ¨¡å¼ (loadbalance: true):
è¯·æ±‚1 â†’ logstash1
è¯·æ±‚2 â†’ logstash2  
è¯·æ±‚3 â†’ logstash3
è¯·æ±‚4 â†’ logstash1 (å¾ªç¯)

æ•…éšœè½¬ç§»æ¨¡å¼ (loadbalance: false):
é»˜è®¤ â†’ logstash1
æ•…éšœ â†’ è‡ªåŠ¨åˆ‡æ¢åˆ°logstash2
æ¢å¤ â†’ ç»§ç»­ä½¿ç”¨logstash2
```

### 6.2 å¥åº·æ£€æŸ¥é…ç½®


```yaml
output.logstash:
  hosts: 
    - "logstash1.company.com:5044"
    - "logstash2.company.com:5044"
  
  # å¥åº·æ£€æŸ¥è®¾ç½®
  timeout: 30s           # è¿æ¥è¶…æ—¶
  max_retries: 3         # æœ€å¤§é‡è¯•æ¬¡æ•°
  
  # è‡ªåŠ¨æ•…éšœè½¬ç§»
  backoff.init: 1s       # åˆå§‹é€€é¿æ—¶é—´
  backoff.max: 60s       # æœ€å¤§é€€é¿æ—¶é—´
```

### 6.3 é›†ç¾¤éƒ¨ç½²ç¤ºä¾‹


```yaml
# å¤§å‹é›†ç¾¤é…ç½®ç¤ºä¾‹
output.logstash:
  hosts:
    # ä¸»æ•°æ®ä¸­å¿ƒ
    - "logstash-master-1.dc1.com:5044"
    - "logstash-master-2.dc1.com:5044"
    # å¤‡ç”¨æ•°æ®ä¸­å¿ƒ  
    - "logstash-backup-1.dc2.com:5044"
    - "logstash-backup-2.dc2.com:5044"
  
  # é›†ç¾¤é…ç½®
  loadbalance: true
  worker: 2
  
  # ç½‘ç»œä¼˜åŒ–
  compression_level: 3
  bulk_max_size: 2048
```

---

## 7. ğŸ”§ æ•…éšœå¤„ç†ä¸é‡è¯•ç­–ç•¥


### 7.1 é‡è¯•æœºåˆ¶é…ç½®


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # é‡è¯•ç­–ç•¥
  max_retries: 3         # æœ€å¤šé‡è¯•3æ¬¡
  backoff.init: 1s       # ç¬¬ä¸€æ¬¡é‡è¯•ç­‰å¾…1ç§’
  backoff.max: 60s       # æœ€é•¿é‡è¯•ç­‰å¾…60ç§’
```

**ğŸ”„ é‡è¯•æœºåˆ¶å·¥ä½œæµç¨‹**
```
æ•°æ®å‘é€å¤±è´¥å¤„ç†æµç¨‹ï¼š

ç¬¬1æ¬¡å¤±è´¥ â†’ ç­‰å¾…1ç§’ â†’ é‡è¯•
ç¬¬2æ¬¡å¤±è´¥ â†’ ç­‰å¾…2ç§’ â†’ é‡è¯•  
ç¬¬3æ¬¡å¤±è´¥ â†’ ç­‰å¾…4ç§’ â†’ é‡è¯•
ç¬¬4æ¬¡å¤±è´¥ â†’ æ”¾å¼ƒè¯¥æ‰¹æ•°æ®

æŒ‡æ•°é€€é¿ç®—æ³•ï¼š
ç­‰å¾…æ—¶é—´ = min(backoff.init * 2^é‡è¯•æ¬¡æ•°, backoff.max)
```

### 7.2 é”™è¯¯å¤„ç†ç­–ç•¥


```yaml
output.logstash:
  hosts: ["logstash.example.com:5044"]
  
  # é”™è¯¯å¤„ç†
  max_retries: 3
  
  # æ—¥å¿—è®°å½•
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
```

**ğŸ“ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ**

| é”™è¯¯ç±»å‹ | åŸå›  | è§£å†³æ–¹æ³• |
|----------|------|----------|
| **è¿æ¥è¶…æ—¶** | ç½‘ç»œå»¶è¿Ÿæˆ–Logstashè¿‡è½½ | å¢åŠ timeoutå€¼ï¼Œæ£€æŸ¥ç½‘ç»œ |
| **è¿æ¥è¢«æ‹’ç»** | Logstashæœªå¯åŠ¨æˆ–ç«¯å£é”™è¯¯ | æ£€æŸ¥LogstashçŠ¶æ€å’Œé…ç½® |
| **SSLæ¡æ‰‹å¤±è´¥** | è¯ä¹¦é…ç½®é”™è¯¯ | æ£€æŸ¥SSLè¯ä¹¦å’Œé…ç½® |
| **æ•°æ®å‘é€å¤±è´¥** | Logstashå¤„ç†èƒ½åŠ›ä¸è¶³ | è°ƒæ•´bulk_max_size |

### 7.3 ç›‘æ§å’Œå‘Šè­¦


```yaml
# ç›‘æ§é…ç½®
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["elasticsearch.example.com:9200"]

# å¥åº·æ£€æŸ¥
http.enabled: true
http.host: localhost
http.port: 5066
```

**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```bash
# Filebeatç›‘æ§å‘½ä»¤
curl -XGET 'localhost:5066/stats'

é‡è¦æŒ‡æ ‡ï¼š
- å‘é€æˆåŠŸç‡
- é˜Ÿåˆ—ä½¿ç”¨ç‡  
- è¿æ¥çŠ¶æ€
- é”™è¯¯è®¡æ•°
- ååé‡
```

---

## 8. ğŸ“‹ å®é™…éƒ¨ç½²é…ç½®æ ·ä¾‹


### 8.1 å¼€å‘ç¯å¢ƒé…ç½®


```yaml
# dev-logstash-output.yml - å¼€å‘ç¯å¢ƒé…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/app/*.log
  fields:
    env: development
    
output.logstash:
  hosts: ["localhost:5044"]
  
  # å¼€å‘ç¯å¢ƒè®¾ç½®
  timeout: 30s
  bulk_max_size: 1024
  flush_interval: 5s
  
logging.level: debug
logging.to_files: true
```

**ğŸ”§ å¼€å‘ç¯å¢ƒç‰¹ç‚¹**
- **ç®€å•é…ç½®**ï¼šå•æœºéƒ¨ç½²ï¼Œä¾¿äºè°ƒè¯•
- **è¯¦ç»†æ—¥å¿—**ï¼šdebugçº§åˆ«ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
- **è¾ƒå°æ‰¹é‡**ï¼šæ•°æ®é‡å°‘ï¼Œæ‰¹é‡è®¾ç½®å°ä¸€äº›

### 8.2 ç”Ÿäº§ç¯å¢ƒé…ç½®


```yaml
# prod-logstash-output.yml - ç”Ÿäº§ç¯å¢ƒé…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/nginx/*.log
    - /var/log/app/*.log
  fields:
    env: production
    datacenter: dc1
    
output.logstash:
  # ç”Ÿäº§ç¯å¢ƒå¤šæœåŠ¡å™¨
  hosts:
    - "logstash1.prod.com:5044"
    - "logstash2.prod.com:5044"
    - "logstash3.prod.com:5044"
  
  # è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨
  loadbalance: true
  worker: 2
  
  # æ€§èƒ½ä¼˜åŒ–
  bulk_max_size: 2048
  flush_interval: 1s
  compression_level: 3
  
  # SSLå®‰å…¨ä¼ è¾“
  ssl.enabled: true
  ssl.certificate_authorities: ["/etc/filebeat/ca.crt"]
  ssl.certificate: "/etc/filebeat/client.crt"
  ssl.key: "/etc/filebeat/client.key"
  ssl.verification_mode: "full"
  
  # é‡è¯•ç­–ç•¥
  max_retries: 3
  backoff.init: 1s
  backoff.max: 60s
  timeout: 30s

# é˜Ÿåˆ—é…ç½®
queue.mem:
  events: 4096
  flush.min_events: 512
  flush.timeout: 5s

# æ—¥å¿—é…ç½®
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  rotateeverybytes: 10485760

# ç›‘æ§
monitoring.enabled: true
```

### 8.3 é«˜å¹¶å‘åœºæ™¯é…ç½®


```yaml
# high-volume-logstash-output.yml - é«˜å¹¶å‘é…ç½®
output.logstash:
  hosts:
    - "logstash-cluster-1.com:5044"
    - "logstash-cluster-2.com:5044"
    - "logstash-cluster-3.com:5044"
    - "logstash-cluster-4.com:5044"
  
  # é«˜æ€§èƒ½è®¾ç½®
  loadbalance: true
  worker: 4                # å¢åŠ å·¥ä½œçº¿ç¨‹
  pipelining: 4           # å¢åŠ ç®¡é“å¹¶å‘
  
  # å¤§æ‰¹é‡ä¼ è¾“
  bulk_max_size: 4096     # å¤§æ‰¹é‡
  flush_interval: 500ms   # å¿«é€Ÿåˆ·æ–°
  compression_level: 6    # é«˜å‹ç¼©æ¯”
  
  # ç½‘ç»œä¼˜åŒ–
  timeout: 15s
  ttl: 30s
  
  # æ¿€è¿›é‡è¯•
  max_retries: 5
  backoff.init: 500ms
  backoff.max: 30s

# å¤§å†…å­˜é˜Ÿåˆ—
queue.mem:
  events: 8192
  flush.min_events: 1024
  flush.timeout: 1s
```

### 8.4 å¤šç¯å¢ƒç»Ÿä¸€é…ç½®æ¨¡æ¿


```yaml
# universal-logstash-output.yml - é€šç”¨æ¨¡æ¿
output.logstash:
  # ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®
  hosts: ["${LOGSTASH_HOST:localhost}:${LOGSTASH_PORT:5044}"]
  
  # åŸºç¡€è®¾ç½®
  worker: ${FILEBEAT_WORKERS:1}
  bulk_max_size: ${BULK_MAX_SIZE:2048}
  flush_interval: ${FLUSH_INTERVAL:1s}
  
  # SSLé…ç½® (å¯é€‰)
  ssl.enabled: ${SSL_ENABLED:false}
  ssl.certificate_authorities: ["${SSL_CA_PATH:/etc/ssl/ca.crt}"]
  ssl.certificate: "${SSL_CERT_PATH:/etc/ssl/client.crt}"
  ssl.key: "${SSL_KEY_PATH:/etc/ssl/client.key}"
  
  # é‡è¯•é…ç½®
  max_retries: ${MAX_RETRIES:3}
  timeout: ${CONNECTION_TIMEOUT:30s}

# ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ (.env)
# LOGSTASH_HOST=logstash.prod.com
# LOGSTASH_PORT=5044
# FILEBEAT_WORKERS=2
# SSL_ENABLED=true
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®æµå‘ï¼šFilebeat â†’ Logstash â†’ Elasticsearch
ğŸ”¸ åŸºç¡€é…ç½®ï¼šhostsåœ°å€ã€ç«¯å£ã€è¿æ¥å‚æ•°
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ‰¹é‡å¤§å°ã€å·¥ä½œçº¿ç¨‹ã€åˆ·æ–°é—´éš”
ğŸ”¸ é«˜å¯ç”¨æ€§ï¼šå¤šæœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœè½¬ç§»
ğŸ”¸ å®‰å…¨ä¼ è¾“ï¼šSSLåŠ å¯†ã€è¯ä¹¦éªŒè¯
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šé‡è¯•ç­–ç•¥ã€é”™è¯¯ç›‘æ§
```

### 9.2 å…³é”®é…ç½®å‚æ•°è®°å¿†


**ğŸ”¹ æ€§èƒ½ç›¸å…³å‚æ•°**
```
bulk_max_size: æ‰¹é‡å¤§å° (å½±å“ååé‡)
flush_interval: åˆ·æ–°é—´éš” (å½±å“å»¶è¿Ÿ)
worker: å·¥ä½œçº¿ç¨‹æ•° (å½±å“å¹¶å‘)
compression_level: å‹ç¼©çº§åˆ« (å½±å“ç½‘ç»œ)
```

**ğŸ”¹ å¯é æ€§ç›¸å…³å‚æ•°**
```
max_retries: é‡è¯•æ¬¡æ•° (å½±å“å®¹é”™)
timeout: è¿æ¥è¶…æ—¶ (å½±å“ç¨³å®šæ€§)
loadbalance: è´Ÿè½½å‡è¡¡ (å½±å“åˆ†å¸ƒ)
ssl.enabled: å®‰å…¨ä¼ è¾“ (å½±å“å®‰å…¨)
```

### 9.3 é…ç½®é€‰æ‹©æŒ‡å¯¼åŸåˆ™


**ğŸ“Š ç¯å¢ƒé…ç½®å»ºè®®**

| ç¯å¢ƒç±»å‹ | é…ç½®é‡ç‚¹ | å…³é”®å‚æ•° |
|---------|----------|----------|
| **å¼€å‘ç¯å¢ƒ** | ç®€å•æ˜“è°ƒè¯• | `å•æœºéƒ¨ç½²` `debugæ—¥å¿—` |
| **æµ‹è¯•ç¯å¢ƒ** | æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ | `å¤šæœåŠ¡å™¨` `SSLå¯é€‰` |
| **ç”Ÿäº§ç¯å¢ƒ** | é«˜å¯ç”¨é«˜æ€§èƒ½ | `è´Ÿè½½å‡è¡¡` `SSLå¿…é¡»` |
| **é«˜å¹¶å‘åœºæ™¯** | æè‡´æ€§èƒ½ | `å¤§æ‰¹é‡` `å¤šçº¿ç¨‹` |

### 9.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


**â“ è¿æ¥é—®é¢˜**
```
é—®é¢˜ï¼šæ— æ³•è¿æ¥Logstash
æ£€æŸ¥ï¼šç½‘ç»œè¿é€šæ€§ã€ç«¯å£å¼€æ”¾ã€LogstashçŠ¶æ€
è§£å†³ï¼štelnetæµ‹è¯•ã€é˜²ç«å¢™é…ç½®ã€æœåŠ¡é‡å¯
```

**â“ æ€§èƒ½é—®é¢˜**
```
é—®é¢˜ï¼šæ•°æ®ä¼ è¾“æ…¢
æ£€æŸ¥ï¼šæ‰¹é‡å¤§å°ã€ç½‘ç»œå¸¦å®½ã€Logstashå¤„ç†èƒ½åŠ›
è§£å†³ï¼šè°ƒæ•´bulk_max_sizeã€å¢åŠ workerã€ä¼˜åŒ–Logstash
```

**â“ SSLé—®é¢˜**
```
é—®é¢˜ï¼šSSLæ¡æ‰‹å¤±è´¥
æ£€æŸ¥ï¼šè¯ä¹¦è·¯å¾„ã€è¯ä¹¦æœ‰æ•ˆæœŸã€åŠ å¯†ç®—æ³•
è§£å†³ï¼šæ›´æ–°è¯ä¹¦ã€æ£€æŸ¥é…ç½®ã€éªŒè¯æƒé™
```

### 9.5 æœ€ä½³å®è·µæ€»ç»“


**âœ… é…ç½®æœ€ä½³å®è·µ**
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨SSLåŠ å¯†
- ä½¿ç”¨å¤šæœåŠ¡å™¨å®ç°é«˜å¯ç”¨
- æ ¹æ®æ•°æ®é‡è°ƒæ•´æ‰¹é‡å‚æ•°
- é…ç½®é€‚å½“çš„é‡è¯•ç­–ç•¥
- å¯ç”¨ç›‘æ§å’Œæ—¥å¿—è®°å½•

**âœ… è¿ç»´æœ€ä½³å®è·µ**
- å®šæœŸæ£€æŸ¥è¿æ¥çŠ¶æ€
- ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
- åŠæ—¶å¤„ç†å‘Šè­¦ä¿¡æ¯
- å®šæœŸæ›´æ–°SSLè¯ä¹¦
- å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Filebeaté€æ•°æ®ï¼ŒLogstashæ¥æ¥æ”¶
- å¤šæœåŠ¡å™¨ä¿å¯ç”¨ï¼Œè´Ÿè½½å‡è¡¡ææ€§èƒ½
- SSLåŠ å¯†ä¿å®‰å…¨ï¼Œé‡è¯•æœºåˆ¶é˜²ä¸¢å¤±
- ç›‘æ§å‘Šè­¦è¦åˆ°ä½ï¼Œé…ç½®ä¼˜åŒ–éœ€æŒç»­