---
title: 29、logging.yml日志配置
---
## 📚 目录

1. [Filebeat日志系统概述](#1-filebeat日志系统概述)
2. [日志级别配置详解](#2-日志级别配置详解)
3. [日志文件输出配置](#3-日志文件输出配置)
4. [日志轮转策略配置](#4-日志轮转策略配置)
5. [日志格式与权限设置](#5-日志格式与权限设置)
6. [实用配置示例大全](#6-实用配置示例大全)
7. [调试与故障排查](#7-调试与故障排查)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 📊 Filebeat日志系统概述


### 1.1 什么是Filebeat日志系统


**简单理解**：Filebeat的日志系统就像是一个**记录员**，专门记录Filebeat自己的工作情况。

```
想象一下快递员的工作日志：
├─ 今天派送了多少件包裹 ✓
├─ 遇到了什么问题 ⚠️
├─ 哪些地址找不到 ❌
└─ 工作进度如何 📈

Filebeat的日志系统也是这样：
├─ 收集了多少日志文件 ✓
├─ 发送到哪些目标 📤
├─ 遇到了什么错误 ❌
└─ 性能状况如何 📊
```

### 1.2 为什么需要配置日志


**核心价值**：
- **🔍 问题诊断**：当Filebeat不工作时，通过日志找原因
- **📈 性能监控**：了解处理速度和资源使用情况
- **🛡️ 安全审计**：记录重要操作和异常行为
- **🔧 运维管理**：便于日常维护和故障排查

**实际场景举例**：
```
场景1：Filebeat突然停止发送日志
→ 查看error级别日志，发现网络连接问题

场景2：服务器磁盘空间不足
→ 查看日志轮转配置，优化存储策略

场景3：性能下降
→ 查看debug日志，发现某个文件解析慢
```

### 1.3 日志配置的基本结构


```yaml
# Filebeat日志配置的基本框架
logging:
  level: info          # 🎯 日志级别（控制详细程度）
  to_files: true       # 📁 是否写入文件
  to_syslog: false     # 📡 是否发送到系统日志
  files:               # 📄 文件相关配置
    path: /var/log/filebeat    # 存储位置
    name: filebeat.log         # 文件名称
    keepfiles: 7              # 保留文件数量
    permissions: 0644         # 文件权限
```

---

## 2. 🎚️ 日志级别配置详解


### 2.1 日志级别的含义


日志级别就像**音量调节器**，决定记录多少详细信息：

```
📢 debug   : 最详细（开发调试用）
📣 info    : 常规信息（推荐使用）
📯 warning : 警告信息（需要注意）
🚨 error   : 错误信息（必须解决）
```

### 2.2 各级别详细说明


**🔧 debug级别**：
```yaml
logging:
  level: debug

# 会记录的内容：
# ✓ 每个文件的读取进度
# ✓ 网络连接的详细过程  
# ✓ 配置解析的每个步骤
# ✓ 内存和CPU使用情况
```

> **🎯 使用场景**：开发测试、详细故障排查
> **⚠️ 注意**：日志量很大，不建议生产环境长期使用

**📋 info级别**：
```yaml
logging:
  level: info

# 会记录的内容：
# ✓ Filebeat启动和停止
# ✓ 配置文件加载成功
# ✓ 发现新的日志文件
# ✓ 发送日志的统计信息
```

> **🎯 使用场景**：生产环境推荐，信息适中
> **✅ 优点**：既能了解状态，又不会产生过多日志

**⚠️ warning级别**：
```yaml
logging:
  level: warning

# 会记录的内容：
# ✓ 网络连接不稳定
# ✓ 文件读取权限问题
# ✓ 配置项可能有问题
# ✓ 性能可能下降的提醒
```

**🚨 error级别**：
```yaml
logging:
  level: error

# 会记录的内容：
# ✓ 无法连接到Elasticsearch
# ✓ 配置文件格式错误
# ✓ 文件无法读取
# ✓ 致命错误导致停止
```

### 2.3 级别选择指南


| 环境类型 | **推荐级别** | **理由说明** |
|---------|-------------|-------------|
| 🧪 **开发测试** | `debug` | `需要详细信息定位问题` |
| 🏭 **生产环境** | `info` | `平衡信息量和性能` |
| 🔥 **故障排查** | `debug` | `临时开启获取详细信息` |
| 💾 **资源受限** | `warning` | `减少日志量节省空间` |

---

## 3. 📁 日志文件输出配置


### 3.1 基本文件输出配置


```yaml
logging:
  to_files: true              # 开启文件输出
  files:
    path: /var/log/filebeat   # 📍 日志存储目录
    name: filebeat.log        # 📄 日志文件名
    rotateeverybytes: 10485760 # 🔄 10MB轮转一次
    keepfiles: 7              # 📚 保留7个历史文件
    permissions: 0644         # 🔐 文件权限设置
```

### 3.2 关键配置项详解


**📍 path（存储路径）**：
```yaml
# 不同系统的推荐路径
# Linux系统：
path: /var/log/filebeat

# Windows系统：
path: C:\ProgramData\filebeat\logs

# 容器环境：
path: /usr/share/filebeat/logs
```

**📄 name（文件名称）**：
```yaml
# 基础配置
name: filebeat.log

# 带时间戳的配置
name: filebeat-%{+yyyy.MM.dd}.log

# 按环境区分
name: filebeat-production.log
```

**🔐 permissions（文件权限）**：
```yaml
# 常用权限设置
permissions: 0644  # rw-r--r-- (推荐)
permissions: 0600  # rw------- (更安全)
permissions: 0666  # rw-rw-rw- (测试环境)
```

> **权限说明**：
> - `0644`：所有者可读写，其他人只读
> - `0600`：只有所有者可读写，最安全
> - `0666`：所有人可读写，仅测试环境使用

### 3.3 多种输出目标配置


**📡 同时输出到多个位置**：
```yaml
logging:
  to_files: true        # ✓ 输出到文件
  to_syslog: true       # ✓ 输出到系统日志
  to_stderr: false      # ✗ 不输出到标准错误
  
  files:
    path: /var/log/filebeat
    name: filebeat.log
    
  syslog:
    facility: local0    # 系统日志设施
```

---

## 4. 🔄 日志轮转策略配置


### 4.1 什么是日志轮转


**形象比喻**：日志轮转就像换**笔记本**：
```
第1天：在笔记本1上写 → filebeat.log
第2天：笔记本1写满了，换笔记本2 → filebeat.log.1
第3天：笔记本2写满了，换笔记本3 → filebeat.log.2
...
第7天：扔掉第1个笔记本，保留最新6个
```

### 4.2 按大小轮转配置


```yaml
logging:
  files:
    rotateeverybytes: 10485760    # 📏 10MB轮转（推荐）
    keepfiles: 7                  # 📚 保留7个文件
    
# 文件轮转效果：
# filebeat.log      ← 当前活跃文件
# filebeat.log.1    ← 昨天的文件  
# filebeat.log.2    ← 前天的文件
# ...
# filebeat.log.7    ← 最旧的文件（即将删除）
```

**📏 大小配置参考**：
```yaml
# 小型环境（日志量少）
rotateeverybytes: 5242880     # 5MB

# 中型环境（推荐）
rotateeverybytes: 10485760    # 10MB

# 大型环境（日志量大）
rotateeverybytes: 52428800    # 50MB

# 超大环境
rotateeverybytes: 104857600   # 100MB
```

### 4.3 日志保留策略


```yaml
logging:
  files:
    keepfiles: 7              # 🗓️ 保留7天（推荐）
    
# 不同场景的保留策略：
# 开发环境：keepfiles: 3    （节省空间）
# 生产环境：keepfiles: 7    （平衡需求）
# 合规要求：keepfiles: 30   （满足审计）
```

### 4.4 完整轮转配置示例


```yaml
# 📋 生产环境推荐配置
logging:
  level: info
  to_files: true
  files:
    path: /var/log/filebeat
    name: filebeat.log
    rotateeverybytes: 10485760    # 10MB轮转
    keepfiles: 7                  # 保留7个文件
    permissions: 0644             # 标准权限
    
# 📊 预估存储用量：
# 单文件：10MB
# 总文件：7个 × 10MB = 70MB
# 加上当前活跃文件，约80MB
```

---

## 5. 🎨 日志格式与权限设置


### 5.1 日志格式配置


**基础格式配置**：
```yaml
logging:
  json: false              # 📝 使用文本格式（易读）
  
# 输出示例：
# 2025-09-21T14:30:15.123Z INFO [publisher] Connected to Elasticsearch
```

**JSON格式配置**：
```yaml
logging:
  json: true               # 📋 使用JSON格式（易解析）
  
# 输出示例：
# {"timestamp":"2025-09-21T14:30:15.123Z","level":"INFO","message":"Connected to Elasticsearch"}
```

### 5.2 自定义日志选择器


```yaml
logging:
  level: info
  selectors: ["*"]         # 📡 记录所有组件日志
  
# 或者只记录特定组件：
logging:
  level: info
  selectors: ["publisher", "harvester"]  # 只记录发布器和收集器日志
```

**🎯 常用选择器**：
- `publisher`：发送到目标的日志
- `harvester`：文件收集相关日志  
- `input`：输入处理相关日志
- `output`：输出处理相关日志

### 5.3 控制台日志设置


```yaml
logging:
  to_stderr: true          # 🖥️ 输出到控制台
  to_files: true           # 📁 同时输出到文件
  
# 容器环境推荐：
logging:
  to_stderr: true          # 便于docker logs查看
  to_files: false          # 不写入文件（避免存储问题）
```

---

## 6. 📋 实用配置示例大全


### 6.1 开发环境配置


```yaml
# 🧪 开发环境 - 详细调试
logging:
  level: debug                    # 最详细的日志
  to_files: true
  to_stderr: true                # 同时显示在控制台
  
  files:
    path: ./logs                 # 当前目录下的logs文件夹
    name: filebeat-dev.log       # 标识开发环境
    rotateeverybytes: 5242880    # 5MB（开发环境文件小）
    keepfiles: 3                 # 只保留3个文件
    permissions: 0666            # 宽松权限便于调试
    
  selectors: ["*"]              # 记录所有组件日志
```

### 6.2 生产环境配置


```yaml
# 🏭 生产环境 - 稳定可靠
logging:
  level: info                     # 适中的日志级别
  to_files: true
  to_stderr: false               # 不输出到控制台
  
  files:
    path: /var/log/filebeat      # 标准日志目录
    name: filebeat.log           # 标准文件名
    rotateeverybytes: 10485760   # 10MB标准轮转
    keepfiles: 7                 # 保留一周
    permissions: 0644            # 安全权限
    
  # 🎯 只记录关键组件日志
  selectors: ["publisher", "harvester", "input"]
```

### 6.3 高负载环境配置


```yaml
# ⚡ 高负载环境 - 性能优先
logging:
  level: warning                  # 减少日志量
  to_files: true
  json: true                     # JSON格式便于机器处理
  
  files:
    path: /var/log/filebeat
    name: filebeat.log
    rotateeverybytes: 52428800   # 50MB（减少轮转频率）
    keepfiles: 5                 # 适度保留
    permissions: 0644
    
  # 🎯 只记录错误和警告
  selectors: ["publisher"]        # 只记录核心组件
```

### 6.4 容器环境配置


```yaml
# 🐳 容器环境 - 云原生
logging:
  level: info
  to_stderr: true                # 输出到标准错误（便于容器日志收集）
  to_files: false               # 不写入文件（避免存储卷问题）
  json: true                    # JSON格式便于日志平台处理
  
  # 🔧 如果需要文件输出：
  # files:
  #   path: /usr/share/filebeat/logs
  #   name: filebeat.log
  #   rotateeverybytes: 10485760
  #   keepfiles: 3
```

### 6.5 调试故障配置


```yaml
# 🔍 故障排查 - 临时调试
logging:
  level: debug                   # 最详细的信息
  to_files: true
  to_stderr: true               # 同时输出便于实时查看
  
  files:
    path: /tmp/filebeat-debug    # 临时目录
    name: debug.log              # 明确标识
    rotateeverybytes: 10485760   
    keepfiles: 2                 # 少量保留
    permissions: 0666            # 宽松权限便于分析
    
  selectors: ["*"]              # 记录所有信息
  
# ⚠️ 注意：调试完成后记得改回正常配置！
```

---

## 7. 🔍 调试与故障排查


### 7.1 常见日志问题诊断


**🚨 问题1：日志文件无法创建**
```bash
# 错误现象：
# ERROR Failed to create log file: permission denied

# 🔧 解决步骤：
# 1. 检查目录权限
ls -la /var/log/

# 2. 创建目录并设置权限  
sudo mkdir -p /var/log/filebeat
sudo chown filebeat:filebeat /var/log/filebeat
sudo chmod 755 /var/log/filebeat

# 3. 检查配置文件权限
sudo chmod 644 /etc/filebeat/filebeat.yml
```

**📊 问题2：日志文件过大占满磁盘**
```yaml
# 🎯 优化配置：
logging:
  files:
    rotateeverybytes: 5242880    # 减小轮转大小
    keepfiles: 3                 # 减少保留文件
    
# 📋 应急处理：
# sudo find /var/log/filebeat -name "*.log.*" -mtime +3 -delete
```

**🔄 问题3：日志轮转不工作**
```yaml
# ✅ 正确配置：
logging:
  files:
    rotateeverybytes: 10485760   # 确保数值正确
    keepfiles: 7                 # 确保大于0
    
# ❌ 错误配置示例：
# rotateeverybytes: 0           # 禁用轮转
# keepfiles: 0                  # 不保留历史文件
```

### 7.2 日志分析技巧


**📊 查看日志文件大小**：
```bash
# 查看当前日志文件大小
ls -lh /var/log/filebeat/

# 查看日志占用总空间
du -sh /var/log/filebeat/

# 实时监控日志增长
watch -n 1 'ls -lh /var/log/filebeat/filebeat.log'
```

**🔍 搜索关键错误信息**：
```bash
# 查找错误信息
grep -i error /var/log/filebeat/filebeat.log

# 查找连接问题
grep -i "connection" /var/log/filebeat/filebeat.log

# 查看最近的日志
tail -f /var/log/filebeat/filebeat.log

# 按时间查看日志
grep "2025-09-21T14:" /var/log/filebeat/filebeat.log
```

### 7.3 性能优化建议


**📈 日志配置性能调优**：
```yaml
# 🎯 高性能配置
logging:
  level: warning              # 减少日志量
  to_files: true
  files:
    rotateeverybytes: 52428800  # 50MB（减少I/O频率）
    keepfiles: 3               # 减少磁盘占用
    
# 📊 监控指标：
# - 日志文件写入频率
# - 磁盘I/O使用率  
# - 日志处理延迟
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 日志级别：debug > info > warning > error，级别越高记录越少
🔸 文件轮转：自动创建新文件，删除旧文件，控制磁盘占用
🔸 输出目标：可以同时输出到文件、控制台、系统日志
🔸 权限管理：正确设置文件和目录权限，确保安全性
🔸 格式选择：文本格式易读，JSON格式易处理
```

### 8.2 关键配置要点


**🎯 生产环境最佳实践**：
```yaml
logging:
  level: info                    # ✓ 平衡信息量和性能
  to_files: true                # ✓ 持久化存储
  files:
    path: /var/log/filebeat     # ✓ 标准路径
    rotateeverybytes: 10485760  # ✓ 10MB轮转
    keepfiles: 7                # ✓ 保留一周
    permissions: 0644           # ✓ 安全权限
```

**⚠️ 常见配置陷阱**：
```
❌ 权限设置过于宽松（0777）
❌ 日志级别设置为debug（生产环境）
❌ 轮转大小设置过小（频繁I/O）
❌ 保留文件数设置过多（占用磁盘）
❌ 忘记配置轮转策略（磁盘满）
```

### 8.3 实用操作指南


**🔧 快速配置检查清单**：
- □ 确认日志目录存在且有写权限
- □ 设置合适的日志级别（生产用info）
- □ 配置日志轮转（推荐10MB）
- □ 设置文件保留策略（推荐7个）
- □ 检查文件权限设置（推荐0644）

**📊 监控要点**：
- 🎯 日志文件大小变化
- 🎯 轮转是否正常工作
- 🎯 磁盘空间使用情况
- 🎯 错误日志出现频率

### 8.4 故障排查流程


```
1️⃣ 检查配置语法
   └─ filebeat test config

2️⃣ 查看权限设置
   └─ ls -la /var/log/filebeat/

3️⃣ 检查磁盘空间
   └─ df -h

4️⃣ 分析错误日志
   └─ grep -i error filebeat.log

5️⃣ 调整日志级别
   └─ 临时设置debug级别
```

**核心记忆口诀**：
- 日志配置要合理，级别轮转权限齐
- 生产环境用info，调试故障开debug
- 文件大小控制好，磁盘空间不担心
- 权限安全要记牢，644标准最可靠