---
title: 9ã€kafka-input.ymlæ¶ˆæ¯é˜Ÿåˆ—è¾“å…¥
---
## ğŸ“š ç›®å½•

1. [Kafkaè¾“å…¥æºåŸºç¡€æ¦‚å¿µ](#1-kafkaè¾“å…¥æºåŸºç¡€æ¦‚å¿µ)
2. [åŸºæœ¬é…ç½®ç»“æ„](#2-åŸºæœ¬é…ç½®ç»“æ„)
3. [æ¶ˆè´¹è€…é…ç½®è¯¦è§£](#3-æ¶ˆè´¹è€…é…ç½®è¯¦è§£)
4. [ä¸»é¢˜è®¢é˜…ä¸åˆ†åŒºç­–ç•¥](#4-ä¸»é¢˜è®¢é˜…ä¸åˆ†åŒºç­–ç•¥)
5. [å®‰å…¨è®¤è¯é…ç½®](#5-å®‰å…¨è®¤è¯é…ç½®)
6. [æ€§èƒ½ä¼˜åŒ–é…ç½®](#6-æ€§èƒ½ä¼˜åŒ–é…ç½®)
7. [é”™è¯¯å¤„ç†ä¸ç›‘æ§](#7-é”™è¯¯å¤„ç†ä¸ç›‘æ§)
8. [å®é™…åº”ç”¨åœºæ™¯](#8-å®é™…åº”ç”¨åœºæ™¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Kafkaè¾“å…¥æºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Kafkaè¾“å…¥æº


**ç®€å•ç†è§£**ï¼šæƒ³è±¡Kafkaå°±åƒä¸€ä¸ªå¤§å‹çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œå¥½æ¯”é‚®å±€ä¸€æ ·ã€‚

```
ä¼ ç»Ÿæ•°æ®æ”¶é›†ï¼š             Kafkaæ¶ˆæ¯é˜Ÿåˆ—æ”¶é›†ï¼š
åº”ç”¨ â†’ ç›´æ¥å†™æ–‡ä»¶ â†’ Filebeat    åº”ç”¨ â†’ Kafka â†’ Filebeat â†’ Elasticsearch
                          |              |
                        æ¶ˆæ¯é˜Ÿåˆ—        æ¶ˆè´¹æ•°æ®
```

**Kafkaè¾“å…¥æºçš„ä½œç”¨**ï¼š
- ğŸ”¸ **è§£è€¦æ•°æ®æº**ï¼šåº”ç”¨ä¸ç›´æ¥å†™æ–‡ä»¶ï¼Œè€Œæ˜¯å‘é€åˆ°Kafka
- ğŸ”¸ **æé«˜å¯é æ€§**ï¼šæ¶ˆæ¯åœ¨Kafkaä¸­æŒä¹…åŒ–å­˜å‚¨
- ğŸ”¸ **æ”¯æŒé«˜å¹¶å‘**ï¼šå¤šä¸ªFilebeatå¯ä»¥åŒæ—¶æ¶ˆè´¹
- ğŸ”¸ **æ•°æ®ç¼“å†²**ï¼šKafkaå……å½“æ•°æ®ç¼“å†²åŒº

### 1.2 KafkaåŸºæœ¬æ¦‚å¿µè§£é‡Š


**æ ¸å¿ƒæœ¯è¯­é€šä¿—è¯´æ˜**ï¼š

```
ğŸ”¸ Topicï¼ˆä¸»é¢˜ï¼‰= æŠ¥çº¸çš„ç‰ˆé¢
å°±åƒæŠ¥çº¸æœ‰ä½“è‚²ç‰ˆã€æ–°é—»ç‰ˆä¸€æ ·ï¼ŒTopicæŠŠä¸åŒç±»å‹çš„æ¶ˆæ¯åˆ†ç±»

ğŸ”¸ Partitionï¼ˆåˆ†åŒºï¼‰= æ¯ä¸ªç‰ˆé¢çš„æ ç›®
ä¸€ä¸ªä¸»é¢˜å¯ä»¥åˆ†æˆå¤šä¸ªåˆ†åŒºï¼Œæé«˜å¤„ç†æ•ˆç‡

ğŸ”¸ Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰= è®¢é˜…ç”¨æˆ·ç»„
åŒä¸€ç»„å†…çš„ç”¨æˆ·ä¸ä¼šé‡å¤æ”¶åˆ°ç›¸åŒæ¶ˆæ¯

ğŸ”¸ Offsetï¼ˆåç§»é‡ï¼‰= é˜…è¯»è¿›åº¦æ ‡è®°
è®°å½•ä½ è¯»åˆ°ç¬¬å‡ æ¡æ¶ˆæ¯äº†
```

### 1.3 ä¸ºä»€ä¹ˆä½¿ç”¨Kafkaè¾“å…¥æº


**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| ä½¿ç”¨æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** |
|---------|------------|---------|---------|
| ğŸ”¸ **æ–‡ä»¶è¾“å…¥** | `å°è§„æ¨¡åº”ç”¨` | `ç®€å•ç›´æ¥` | `å•ç‚¹æ•…éšœé£é™©` |
| ğŸ”¸ **Kafkaè¾“å…¥** | `å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿ` | `é«˜å¯é æ€§ã€å¯æ‰©å±•` | `é…ç½®å¤æ‚ä¸€äº›` |

---

## 2. âš™ï¸ åŸºæœ¬é…ç½®ç»“æ„


### 2.1 æœ€ç®€å•çš„Kafkaè¾“å…¥é…ç½®


```yaml
# åŸºç¡€Kafkaè¾“å…¥é…ç½®
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]          # KafkaæœåŠ¡å™¨åœ°å€
  topics: ["my-application-logs"]    # è¦è®¢é˜…çš„ä¸»é¢˜

output.elasticsearch:
  hosts: ["localhost:9200"]
```

**é…ç½®è¯´æ˜**ï¼š
- **type: kafka**ï¼šå‘Šè¯‰Filebeatè¿™æ˜¯Kafkaè¾“å…¥æº
- **hosts**ï¼šKafkaé›†ç¾¤çš„åœ°å€åˆ—è¡¨
- **topics**ï¼šè¦ç›‘å¬çš„ä¸»é¢˜åç§°

### 2.2 é…ç½®æ–‡ä»¶ç»“æ„å›¾


```
Filebeaté…ç½®ç»“æ„ï¼š
â”œâ”€â”€ filebeat.inputs
â”‚   â”œâ”€â”€ type: kafka              â† è¾“å…¥ç±»å‹
â”‚   â”œâ”€â”€ hosts: [...]            â† Kafkaé›†ç¾¤åœ°å€
â”‚   â”œâ”€â”€ topics: [...]           â† è®¢é˜…ä¸»é¢˜
â”‚   â”œâ”€â”€ group_id: "filebeat"    â† æ¶ˆè´¹è€…ç»„ID
â”‚   â”œâ”€â”€ consumer.*              â† æ¶ˆè´¹è€…é…ç½®
â”‚   â””â”€â”€ security.*              â† å®‰å…¨é…ç½®
â”œâ”€â”€ processors: [...]           â† æ•°æ®å¤„ç†
â””â”€â”€ output.*                    â† è¾“å‡ºé…ç½®
```

### 2.3 å®Œæ•´é…ç½®æ¨¡æ¿


```yaml
filebeat.inputs:
- type: kafka
  # åŸºæœ¬è¿æ¥é…ç½®
  hosts: 
    - "kafka1:9092"
    - "kafka2:9092"
    - "kafka3:9092"
  
  # ä¸»é¢˜é…ç½®
  topics: ["logs", "metrics", "events"]
  
  # æ¶ˆè´¹è€…ç»„é…ç½®
  group_id: "filebeat-log-consumer"
  
  # å­—æ®µæ˜ å°„
  fields:
    service: "my-app"
    environment: "production"
  fields_under_root: true

# è¾“å‡ºé…ç½®
output.elasticsearch:
  hosts: ["elasticsearch:9200"]
```

---

## 3. ğŸ”§ æ¶ˆè´¹è€…é…ç½®è¯¦è§£


### 3.1 æ¶ˆè´¹è€…ç»„é…ç½®


**ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç»„ï¼Ÿ**

æƒ³è±¡ä½ å’Œæœ‹å‹ä¸€èµ·çœ‹ç”µè§†å‰§ï¼š
- **åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„**ï¼šä½ ä»¬ä¸ä¼šé‡å¤çœ‹åŒä¸€é›†
- **ä¸åŒæ¶ˆè´¹è€…ç»„**ï¼šæ¯ç»„éƒ½ä»å¤´å¼€å§‹çœ‹

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]
  topics: ["app-logs"]
  
  # æ¶ˆè´¹è€…ç»„é…ç½®
  group_id: "filebeat-prod-logs"     # ç»„åï¼ŒåŒç»„ä¸é‡å¤æ¶ˆè´¹
  client_id: "filebeat-node-01"      # å®¢æˆ·ç«¯æ ‡è¯†
```

**æ¶ˆè´¹è€…ç»„çš„ä½œç”¨**ï¼š
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šå¤šä¸ªFilebeatå®ä¾‹åˆ†æ‘Šæ¶ˆæ¯
- âœ… **æ•…éšœæ¢å¤**ï¼šä¸€ä¸ªå®ä¾‹æŒ‚äº†ï¼Œå…¶ä»–ç»§ç»­å·¥ä½œ
- âœ… **é¿å…é‡å¤**ï¼šä¿è¯æ¶ˆæ¯åªè¢«å¤„ç†ä¸€æ¬¡

### 3.2 åç§»é‡ç®¡ç†ç­–ç•¥


**åç§»é‡å°±åƒä¹¦ç­¾**ï¼šè®°å½•ä½ è¯»åˆ°å“ªé‡Œäº†

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]
  topics: ["app-logs"]
  group_id: "filebeat-logs"
  
  # åç§»é‡é…ç½®
  consumer:
    initial_offset: "newest"    # ä»æœ€æ–°æ¶ˆæ¯å¼€å§‹
    # initial_offset: "oldest"  # ä»æœ€æ—©æ¶ˆæ¯å¼€å§‹
```

**åç§»é‡ç­–ç•¥é€‰æ‹©**ï¼š

| ç­–ç•¥ | **é€‚ç”¨åœºæ™¯** | **è¯´æ˜** |
|-----|------------|---------|
| ğŸ”¸ **newest** | `å®æ—¶ç›‘æ§` | `åªå¤„ç†æ–°äº§ç”Ÿçš„æ¶ˆæ¯` |
| ğŸ”¸ **oldest** | `æ•°æ®è¿ç§»` | `å¤„ç†æ‰€æœ‰å†å²æ¶ˆæ¯` |

### 3.3 æ‰¹é‡æ¶ˆè´¹é…ç½®


**æ‰¹é‡æ¶ˆè´¹ = æ‰“åŒ…å¤„ç†**ï¼šä¸€æ¬¡å¤„ç†å¤šæ¡æ¶ˆæ¯ï¼Œæé«˜æ•ˆç‡

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]
  topics: ["high-volume-logs"]
  
  consumer:
    # æ‰¹é‡å¤§å°é…ç½®
    fetch:
      min: 1024        # æœ€å°æ‰¹é‡å¤§å°ï¼ˆå­—èŠ‚ï¼‰
      default: 1048576 # é»˜è®¤æ‰¹é‡å¤§å°ï¼ˆ1MBï¼‰
      max: 52428800    # æœ€å¤§æ‰¹é‡å¤§å°ï¼ˆ50MBï¼‰
    
    # ç­‰å¾…æ—¶é—´é…ç½®
    max_wait_time: 250ms  # æœ€é•¿ç­‰å¾…æ—¶é—´
```

**å‚æ•°è¯´æ˜**ï¼š
- **fetch.min**ï¼šè‡³å°‘æ”¶é›†è¿™ä¹ˆå¤šæ•°æ®æ‰å¤„ç†
- **fetch.max**ï¼šå•æ¬¡æœ€å¤šå¤„ç†è¿™ä¹ˆå¤šæ•°æ®
- **max_wait_time**ï¼šæœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œé¿å…å»¶è¿Ÿå¤ªä¹…

---

## 4. ğŸ“‹ ä¸»é¢˜è®¢é˜…ä¸åˆ†åŒºç­–ç•¥


### 4.1 ä¸»é¢˜è®¢é˜…æ–¹å¼


**æ–¹å¼ä¸€ï¼šæŒ‡å®šå…·ä½“ä¸»é¢˜**
```yaml
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]
  topics: ["user-logs", "order-logs", "payment-logs"]  # å…·ä½“ä¸»é¢˜åˆ—è¡¨
```

**æ–¹å¼äºŒï¼šæ­£åˆ™è¡¨è¾¾å¼è®¢é˜…**
```yaml
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]
  topic_regex: "app-.*-logs"  # åŒ¹é… app-xxx-logs æ¨¡å¼çš„ä¸»é¢˜
```

### 4.2 åˆ†åŒºæ¶ˆè´¹ç­–ç•¥


**åˆ†åŒºå°±åƒé«˜é€Ÿå…¬è·¯çš„è½¦é“**ï¼š

```
Kafkaä¸»é¢˜åˆ†åŒºç¤ºä¾‹ï¼š
ä¸»é¢˜: user-logs
â”œâ”€â”€ åˆ†åŒº0: [æ¶ˆæ¯1, æ¶ˆæ¯4, æ¶ˆæ¯7, ...]
â”œâ”€â”€ åˆ†åŒº1: [æ¶ˆæ¯2, æ¶ˆæ¯5, æ¶ˆæ¯8, ...]
â””â”€â”€ åˆ†åŒº2: [æ¶ˆæ¯3, æ¶ˆæ¯6, æ¶ˆæ¯9, ...]

Filebeatæ¶ˆè´¹ç­–ç•¥:
Filebeat-1 â†’ åˆ†åŒº0
Filebeat-2 â†’ åˆ†åŒº1  
Filebeat-3 â†’ åˆ†åŒº2
```

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["localhost:9092"]
  topics: ["user-logs"]
  
  consumer:
    # åˆ†åŒºåˆ†é…ç­–ç•¥
    rebalance_strategy: "range"  # range, roundrobin, sticky
    
    # ä¼šè¯é…ç½®
    session_timeout: 30s         # ä¼šè¯è¶…æ—¶æ—¶é—´
    heartbeat_interval: 3s       # å¿ƒè·³é—´éš”
```

**åˆ†é…ç­–ç•¥è¯´æ˜**ï¼š
- **range**ï¼šæŒ‰èŒƒå›´åˆ†é…åˆ†åŒºï¼ˆé»˜è®¤ï¼‰
- **roundrobin**ï¼šè½®è¯¢åˆ†é…åˆ†åŒº
- **sticky**ï¼šå°½é‡ä¿æŒåŸæœ‰åˆ†é…

### 4.3 å¤šä¸»é¢˜é…ç½®å®ä¾‹


```yaml
filebeat.inputs:
# åº”ç”¨æ—¥å¿—è¾“å…¥
- type: kafka
  hosts: ["kafka-cluster:9092"]
  topics: ["app-error-logs", "app-access-logs"]
  group_id: "filebeat-app-logs"
  fields:
    log_type: "application"

# ç³»ç»Ÿæ—¥å¿—è¾“å…¥  
- type: kafka
  hosts: ["kafka-cluster:9092"]
  topics: ["system-logs"]
  group_id: "filebeat-system-logs"
  fields:
    log_type: "system"

output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "logs-%{[log_type]}-%{+yyyy.MM.dd}"
```

---

## 5. ğŸ” å®‰å…¨è®¤è¯é…ç½®


### 5.1 SASL/PLAINè®¤è¯


**SASLå°±åƒç”¨æˆ·åå¯†ç ç™»å½•**ï¼š

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["secure-kafka:9092"]
  topics: ["secure-logs"]
  
  # SASLè®¤è¯é…ç½®
  username: "filebeat-user"
  password: "your-password"
  
  # æˆ–è€…ä½¿ç”¨æ–‡ä»¶å­˜å‚¨å¯†ç 
  # password_file: "/etc/filebeat/kafka-password"
```

### 5.2 SSL/TLSåŠ å¯†ä¼ è¾“


**SSLåƒç»™æ•°æ®ç©¿ä¸Šé˜²æŠ¤æœ**ï¼š

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["secure-kafka:9093"]  # æ³¨æ„ï¼šé€šå¸¸SSLç«¯å£æ˜¯9093
  topics: ["encrypted-logs"]
  
  # SSLé…ç½®
  ssl:
    enabled: true
    certificate_authorities: ["/etc/ssl/ca-cert.pem"]
    certificate: "/etc/ssl/client-cert.pem"
    key: "/etc/ssl/client-key.pem"
    verification_mode: "full"  # full, certificate, none
```

### 5.3 å®Œæ•´å®‰å…¨é…ç½®ç¤ºä¾‹


```yaml
filebeat.inputs:
- type: kafka
  hosts: ["kafka1:9093", "kafka2:9093"]
  topics: ["production-logs"]
  
  # è®¤è¯é…ç½®
  username: "${KAFKA_USERNAME}"      # ä½¿ç”¨ç¯å¢ƒå˜é‡
  password: "${KAFKA_PASSWORD}"
  
  # SSLé…ç½®
  ssl:
    enabled: true
    certificate_authorities: ["/etc/filebeat/ca.pem"]
    verification_mode: "full"
  
  # æ¶ˆè´¹è€…é…ç½®
  group_id: "filebeat-secure"
  consumer:
    initial_offset: "newest"
```

**å®‰å…¨æœ€ä½³å®è·µ**ï¼š
- ğŸ”’ **ç¯å¢ƒå˜é‡**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- ğŸ”’ **è¯ä¹¦ç®¡ç†**ï¼šå®šæœŸæ›´æ–°SSLè¯ä¹¦
- ğŸ”’ **æƒé™æ§åˆ¶**ï¼šä¸ºFilebeatåˆ›å»ºä¸“ç”¨ç”¨æˆ·

---

## 6. âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®


### 6.1 ååé‡ä¼˜åŒ–


**é«˜ååé‡é…ç½®æ€è·¯**ï¼š

```
æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š
æ‰¹é‡å¤§å° â†‘ â†’ ååé‡ â†‘ â†’ å»¶è¿Ÿ â†‘
å¹¶å‘æ•° â†‘ â†’ ååé‡ â†‘ â†’ èµ„æºæ¶ˆè€— â†‘
ç¼“å†²åŒº â†‘ â†’ ç¨³å®šæ€§ â†‘ â†’ å†…å­˜æ¶ˆè€— â†‘
```

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["kafka:9092"]
  topics: ["high-volume-logs"]
  
  # é«˜ååé‡é…ç½®
  consumer:
    fetch:
      min: 10485760      # 10MBæœ€å°æ‰¹é‡
      default: 52428800  # 50MBé»˜è®¤æ‰¹é‡
      max: 104857600     # 100MBæœ€å¤§æ‰¹é‡
    max_wait_time: 1s    # å¢åŠ ç­‰å¾…æ—¶é—´
  
  # å·¥ä½œçº¿ç¨‹é…ç½®
  workers: 4             # å¢åŠ å·¥ä½œçº¿ç¨‹æ•°
```

### 6.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–


```yaml
filebeat.inputs:
- type: kafka
  hosts: ["kafka:9092"]
  topics: ["logs"]
  
  consumer:
    # æ§åˆ¶å†…å­˜ä½¿ç”¨
    fetch:
      default: 1048576   # 1MBï¼ˆé€‚ä¸­çš„æ‰¹é‡å¤§å°ï¼‰
    
    # è¿æ¥æ± é…ç½®
    keep_alive: 30s      # è¿æ¥ä¿æŒæ—¶é—´
    
  # ç¼“å†²åŒºé…ç½®
  buffer_size: 16384     # 16KBç¼“å†²åŒº
```

### 6.3 ç½‘ç»œä¼˜åŒ–é…ç½®


```yaml
filebeat.inputs:
- type: kafka
  hosts: ["kafka:9092"]
  topics: ["logs"]
  
  consumer:
    # ç½‘ç»œè¶…æ—¶é…ç½®
    connect_timeout: 30s
    request_timeout: 30s
    
    # é‡è¯•é…ç½®
    retry:
      backoff: 250ms     # é‡è¯•é—´éš”
      max_retries: 3     # æœ€å¤§é‡è¯•æ¬¡æ•°
```

---

## 7. ğŸš¨ é”™è¯¯å¤„ç†ä¸ç›‘æ§


### 7.1 é”™è¯¯å¤„ç†ç­–ç•¥


**é”™è¯¯å¤„ç†å°±åƒå‡†å¤‡åº”æ€¥é¢„æ¡ˆ**ï¼š

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["kafka:9092"]
  topics: ["logs"]
  
  # é”™è¯¯å¤„ç†é…ç½®
  consumer:
    # é‡è¯•é…ç½®
    retry:
      backoff: 1s        # é‡è¯•é—´éš”
      max_retries: 5     # æœ€å¤§é‡è¯•æ¬¡æ•°
    
    # è¶…æ—¶é…ç½®
    session_timeout: 30s
    request_timeout: 30s

# æ—¥å¿—è®°å½•é…ç½®
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
```

### 7.2 ç›‘æ§æŒ‡æ ‡é…ç½®


```yaml
# å¯ç”¨ç›‘æ§
monitoring:
  enabled: true
  elasticsearch:
    hosts: ["monitoring-es:9200"]
    index: "filebeat-monitoring"

# HTTPç›‘æ§ç«¯ç‚¹
http:
  enabled: true
  host: "0.0.0.0"
  port: 5066
```

**ç›‘æ§æŒ‡æ ‡å«ä¹‰**ï¼š
- ğŸ“Š **æ¶ˆè´¹é€Ÿç‡**ï¼šæ¯ç§’å¤„ç†æ¶ˆæ¯æ•°
- ğŸ“Š **å»¶è¿ŸæŒ‡æ ‡**ï¼šæ¶ˆæ¯ä»äº§ç”Ÿåˆ°å¤„ç†çš„æ—¶é—´
- ğŸ“Š **é”™è¯¯ç‡**ï¼šå¤±è´¥æ¶ˆæ¯çš„æ¯”ä¾‹
- ğŸ“Š **è¿æ¥çŠ¶æ€**ï¼šä¸Kafkaçš„è¿æ¥å¥åº·åº¦

### 7.3 å‘Šè­¦é…ç½®


```yaml
filebeat.inputs:
- type: kafka
  hosts: ["kafka:9092"]
  topics: ["critical-logs"]
  
  # å¤„ç†å™¨é…ç½®
  processors:
  - drop_event:
      when:
        regexp:
          message: "DEBUG|TRACE"  # ä¸¢å¼ƒè°ƒè¯•æ—¥å¿—
  
  - add_fields:
      target: "meta"
      fields:
        alert_level: "critical"
        source_system: "kafka"
```

---

## 8. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 8.1 å¾®æœåŠ¡æ—¥å¿—æ”¶é›†


**åœºæ™¯**ï¼šå¤šä¸ªå¾®æœåŠ¡çš„æ—¥å¿—ç»Ÿä¸€æ”¶é›†

```yaml
# å¾®æœåŠ¡æ—¥å¿—æ”¶é›†é…ç½®
filebeat.inputs:
- type: kafka
  hosts: ["kafka-cluster:9092"]
  topics: ["user-service-logs", "order-service-logs", "payment-service-logs"]
  group_id: "filebeat-microservices"
  
  # æ·»åŠ æœåŠ¡æ ‡è¯†
  processors:
  - add_fields:
      target: "service"
      fields:
        environment: "production"
        cluster: "main"

output.elasticsearch:
  hosts: ["es-cluster:9200"]
  index: "microservices-logs-%{+yyyy.MM.dd}"
  template.settings:
    index.number_of_shards: 3
    index.number_of_replicas: 1
```

### 8.2 å®æ—¶æ•°æ®åˆ†æ


**åœºæ™¯**ï¼šç”¨æˆ·è¡Œä¸ºæ•°æ®å®æ—¶åˆ†æ

```yaml
filebeat.inputs:
- type: kafka
  hosts: ["analytics-kafka:9092"]
  topics: ["user-events", "click-streams"]
  group_id: "filebeat-analytics"
  
  # å®æ—¶å¤„ç†é…ç½®
  consumer:
    initial_offset: "newest"    # åªå¤„ç†æœ€æ–°æ•°æ®
    max_wait_time: 100ms        # ä½å»¶è¿Ÿé…ç½®
  
  # æ•°æ®é¢„å¤„ç†
  processors:
  - decode_json_fields:
      fields: ["message"]
      target: "event"
  - timestamp:
      field: "event.timestamp"
      layouts:
        - "2006-01-02T15:04:05.000Z"

output.elasticsearch:
  hosts: ["analytics-es:9200"]
  index: "user-analytics-%{+yyyy.MM.dd}"
```

### 8.3 å¤šç¯å¢ƒéƒ¨ç½²


```yaml
# ç”Ÿäº§ç¯å¢ƒé…ç½®
filebeat.inputs:
- type: kafka
  hosts: ["prod-kafka1:9092", "prod-kafka2:9092", "prod-kafka3:9092"]
  topics: ["prod-app-logs"]
  group_id: "filebeat-prod"
  
  # ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®
  username: "${KAFKA_USERNAME}"
  password: "${KAFKA_PASSWORD}"
  ssl:
    enabled: true
    certificate_authorities: ["/etc/ssl/ca.pem"]
  
  # é«˜å¯ç”¨é…ç½®
  consumer:
    session_timeout: 10s
    heartbeat_interval: 3s
    retry:
      max_retries: 10

output.elasticsearch:
  hosts: ["prod-es1:9200", "prod-es2:9200", "prod-es3:9200"]
  username: "${ES_USERNAME}"
  password: "${ES_PASSWORD}"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Kafkaè¾“å…¥æºï¼šä»æ¶ˆæ¯é˜Ÿåˆ—è¯»å–æ•°æ®çš„è¾“å…¥æ–¹å¼
ğŸ”¸ æ¶ˆè´¹è€…ç»„ï¼šç¡®ä¿æ¶ˆæ¯ä¸é‡å¤å¤„ç†çš„æœºåˆ¶
ğŸ”¸ åç§»é‡ï¼šè®°å½•æ¶ˆè´¹è¿›åº¦çš„ä½ç½®æ ‡è®°
ğŸ”¸ ä¸»é¢˜è®¢é˜…ï¼šé€‰æ‹©è¦ç›‘å¬çš„æ¶ˆæ¯åˆ†ç±»
ğŸ”¸ åˆ†åŒºç­–ç•¥ï¼šæ•°æ®åˆ†å¸ƒå’Œè´Ÿè½½å‡è¡¡æ–¹å¼
```

### 9.2 é…ç½®è¦ç‚¹æ€»ç»“


**ğŸ”¹ åŸºç¡€é…ç½®ä¸‰è¦ç´ **
```
1. hosts: Kafkaé›†ç¾¤åœ°å€
2. topics: è¦è®¢é˜…çš„ä¸»é¢˜
3. group_id: æ¶ˆè´¹è€…ç»„æ ‡è¯†
```

**ğŸ”¹ æ€§èƒ½è°ƒä¼˜å…³é”®å‚æ•°**
```
fetché…ç½® â†’ æ§åˆ¶æ‰¹é‡å¤§å°
max_wait_time â†’ æ§åˆ¶å»¶è¿Ÿ
workers â†’ æ§åˆ¶å¹¶å‘æ•°
```

**ğŸ”¹ å®‰å…¨é…ç½®é‡ç‚¹**
```
SASLè®¤è¯ â†’ ç”¨æˆ·åå¯†ç éªŒè¯
SSLåŠ å¯† â†’ æ•°æ®ä¼ è¾“åŠ å¯†
æƒé™æ§åˆ¶ â†’ æœ€å°æƒé™åŸåˆ™
```

### 9.3 æœ€ä½³å®è·µå»ºè®®


**â­ é…ç½®æœ€ä½³å®è·µ**ï¼š
- ğŸ¯ **ç¯å¢ƒå˜é‡**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨
- ğŸ¯ **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- ğŸ¯ **é”™è¯¯å¤„ç†**ï¼šè®¾ç½®åˆç†çš„é‡è¯•å’Œè¶…æ—¶å‚æ•°
- ğŸ¯ **æ€§èƒ½æµ‹è¯•**ï¼šæ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´æ‰¹é‡å¤§å°

**â­ è¿ç»´æœ€ä½³å®è·µ**ï¼š
- ğŸ”§ **åˆ†ç»„å‘½å**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„æ¶ˆè´¹è€…ç»„åç§°
- ğŸ”§ **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®æ–‡ä»¶ç‰ˆæœ¬åŒ–ç®¡ç†
- ğŸ”§ **å®¹é‡è§„åˆ’**ï¼šæ ¹æ®æ¶ˆæ¯é‡è§„åˆ’èµ„æº
- ğŸ”§ **æ•…éšœæ¢å¤**ï¼šåˆ¶å®šå®Œæ•´çš„æ•…éšœæ¢å¤æ–¹æ¡ˆ

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ç±»å‹ | **ç—‡çŠ¶** | **è§£å†³æ–¹æ¡ˆ** |
|---------|---------|-------------|
| ğŸ”¸ **æ¶ˆè´¹å»¶è¿Ÿ** | `æ¶ˆæ¯å †ç§¯` | `å¢åŠ workersæ•°é‡ï¼Œè°ƒæ•´æ‰¹é‡å¤§å°` |
| ğŸ”¸ **è¿æ¥å¤±è´¥** | `æ— æ³•è¿æ¥Kafka` | `æ£€æŸ¥ç½‘ç»œã€è®¤è¯ä¿¡æ¯` |
| ğŸ”¸ **é‡å¤æ¶ˆè´¹** | `æ¶ˆæ¯è¢«é‡å¤å¤„ç†` | `æ£€æŸ¥group_idé…ç½®` |
| ğŸ”¸ **å†…å­˜æº¢å‡º** | `Filebeatå†…å­˜å ç”¨è¿‡é«˜` | `å‡å°fetchæ‰¹é‡å¤§å°` |

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Kafkaè¾“å…¥æºè®©Filebeatä»æ¶ˆæ¯é˜Ÿåˆ—è¯»å–æ•°æ®
- æ¶ˆè´¹è€…ç»„ç¡®ä¿æ¶ˆæ¯å¤„ç†çš„å¯é æ€§å’Œè´Ÿè½½å‡è¡¡
- åˆç†é…ç½®æ‰¹é‡å¤§å°å’Œè¶…æ—¶å‚æ•°ä¼˜åŒ–æ€§èƒ½
- å®‰å…¨é…ç½®å’Œç›‘æ§å‘Šè­¦æ˜¯ç”Ÿäº§ç¯å¢ƒå¿…éœ€