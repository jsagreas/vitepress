---
title: 7ã€å…¶ä»–è¾“å‡ºç±»å‹
---
## ğŸ“š ç›®å½•

1. [è¾“å‡ºç±»å‹æ¦‚è¿°](#1-è¾“å‡ºç±»å‹æ¦‚è¿°)
2. [consoleæ§åˆ¶å°è¾“å‡º](#2-consoleæ§åˆ¶å°è¾“å‡º)
3. [fileæ–‡ä»¶è¾“å‡º](#3-fileæ–‡ä»¶è¾“å‡º)
4. [redisç¼“å­˜è¾“å‡º](#4-redisç¼“å­˜è¾“å‡º)
5. [ç¼–ç å™¨codecé…ç½®](#5-ç¼–ç å™¨codecé…ç½®)
6. [å¤šè¾“å‡ºé…ç½®ç­–ç•¥](#6-å¤šè¾“å‡ºé…ç½®ç­–ç•¥)
7. [æ¡ä»¶è¾“å‡ºåˆ¤æ–­](#7-æ¡ä»¶è¾“å‡ºåˆ¤æ–­)
8. [æµ‹è¯•è°ƒè¯•è¾“å‡º](#8-æµ‹è¯•è°ƒè¯•è¾“å‡º)
9. [å®æˆ˜åº”ç”¨åœºæ™¯](#9-å®æˆ˜åº”ç”¨åœºæ™¯)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¾“å‡ºç±»å‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Filebeatè¾“å‡º


**ğŸ”¸ è¾“å‡ºçš„åŸºæœ¬æ¦‚å¿µ**
```
è¾“å‡ºï¼ˆOutputï¼‰å°±æ˜¯å‘Šè¯‰Filebeatï¼š
"ä½ æ”¶é›†åˆ°çš„æ—¥å¿—æ•°æ®è¦å‘é€åˆ°å“ªé‡Œå»"

æƒ³è±¡ä¸€ä¸‹ï¼š
Filebeatåƒä¸€ä¸ªå¿«é€’å‘˜ï¼Œæ”¶é›†äº†åŒ…è£¹ï¼ˆæ—¥å¿—ï¼‰
è¾“å‡ºé…ç½®å°±æ˜¯å‘Šè¯‰å¿«é€’å‘˜é€è´§åœ°å€
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ä¸åŒçš„è¾“å‡ºç±»å‹**
```
ä¸åŒåœºæ™¯çš„éœ€æ±‚ï¼š

å¼€å‘æµ‹è¯•é˜¶æ®µï¼š
- å¸Œæœ›åœ¨å±å¹•ä¸Šç›´æ¥çœ‹åˆ°æ•°æ® â†’ consoleè¾“å‡º
- æƒ³ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶æŸ¥çœ‹ â†’ fileè¾“å‡º

ç”Ÿäº§ç¯å¢ƒï¼š
- éœ€è¦å‘é€åˆ°Elasticsearch â†’ elasticsearchè¾“å‡º
- è¦é€šè¿‡Redisç¼“å†² â†’ redisè¾“å‡º
- ä¼ è¾“åˆ°Kafkaé˜Ÿåˆ— â†’ kafkaè¾“å‡º
```

### 1.2 å¸¸ç”¨è¾“å‡ºç±»å‹å¯¹æ¯”


| è¾“å‡ºç±»å‹ | **ä½¿ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨é˜¶æ®µ** |
|---------|-------------|----------|----------|-------------|
| ğŸ–¥ï¸ **console** | `è°ƒè¯•æµ‹è¯•` | `ç›´è§‚å¯è§` | `æ— æ³•æŒä¹…åŒ–` | `å¼€å‘é˜¶æ®µ` |
| ğŸ“ **file** | `æœ¬åœ°å­˜å‚¨` | `ç®€å•å¯é ` | `æ— æ³•é›†ä¸­ç®¡ç†` | `æµ‹è¯•/å¤‡ä»½` |
| ğŸ—„ï¸ **elasticsearch** | `æ—¥å¿—åˆ†æ` | `åŠŸèƒ½å¼ºå¤§` | `èµ„æºæ¶ˆè€—å¤§` | `ç”Ÿäº§ç¯å¢ƒ` |
| ğŸ”„ **redis** | `ç¼“å†²é˜Ÿåˆ—` | `é«˜æ€§èƒ½` | `éœ€è¦é¢å¤–ç»´æŠ¤` | `é«˜å¹¶å‘åœºæ™¯` |
| ğŸ“¨ **kafka** | `æ¶ˆæ¯é˜Ÿåˆ—` | `é«˜ååé‡` | `é…ç½®å¤æ‚` | `å¤§æ•°æ®åœºæ™¯` |

### 1.3 è¾“å‡ºé…ç½®çš„åŸºæœ¬ç»“æ„


**ğŸ“‹ é…ç½®æ–‡ä»¶ç»“æ„è¯´æ˜**
```yaml
# filebeat.yml åŸºæœ¬ç»“æ„
filebeat.inputs:
  - type: log
    paths:
      - /var/log/*.log

# è¾“å‡ºé…ç½®éƒ¨åˆ†ï¼ˆåŒæ—¶åªèƒ½å¯ç”¨ä¸€ç§ï¼‰
output.console:     # æ§åˆ¶å°è¾“å‡º
  # é…ç½®å‚æ•°
  
# æˆ–è€…
output.file:        # æ–‡ä»¶è¾“å‡º
  # é…ç½®å‚æ•°
  
# æˆ–è€…  
output.redis:       # Redisè¾“å‡º
  # é…ç½®å‚æ•°
```

> ğŸ”¥ **é‡è¦æé†’**ï¼šFilebeatåŒæ—¶åªèƒ½é…ç½®ä¸€ç§è¾“å‡ºç±»å‹ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨å¤šä¸ªoutput

---

## 2. ğŸ–¥ï¸ consoleæ§åˆ¶å°è¾“å‡º


### 2.1 consoleè¾“å‡ºçš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ§åˆ¶å°è¾“å‡º**
```
æ§åˆ¶å°è¾“å‡ºå°±æ˜¯æŠŠæ”¶é›†åˆ°çš„æ—¥å¿—æ•°æ®
ç›´æ¥æ˜¾ç¤ºåœ¨è¿è¡ŒFilebeatçš„å‘½ä»¤è¡Œç•Œé¢ä¸Š

å¥½å¤„ï¼š
- å¯ä»¥ç«‹å³çœ‹åˆ°Filebeatæ˜¯å¦æ­£å¸¸å·¥ä½œ
- æ–¹ä¾¿è°ƒè¯•é…ç½®æ˜¯å¦æ­£ç¡®
- å¿«é€ŸéªŒè¯æ—¥å¿—æ ¼å¼å’Œå†…å®¹
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**
```
æœ€é€‚åˆè¿™äº›æƒ…å†µï¼š
âœ… åˆšå¼€å§‹å­¦ä¹ Filebeat
âœ… æµ‹è¯•æ–°çš„é…ç½®æ–‡ä»¶
âœ… è°ƒè¯•æ—¥å¿—è§£æè§„åˆ™
âœ… éªŒè¯æ•°æ®æ ¼å¼
âœ… å¼€å‘ç¯å¢ƒå¿«é€ŸéªŒè¯

ä¸é€‚åˆè¿™äº›åœºæ™¯ï¼š
âŒ ç”Ÿäº§ç¯å¢ƒé•¿æœŸè¿è¡Œ
âŒ å¤§é‡æ—¥å¿—æ•°æ®å¤„ç†
âŒ éœ€è¦æ•°æ®æŒä¹…åŒ–ä¿å­˜
```

### 2.2 åŸºç¡€é…ç½®æ–¹æ³•


**âš™ï¸ æœ€ç®€å•çš„consoleé…ç½®**
```yaml
# filebeat.yml
filebeat.inputs:
  - type: log
    paths:
      - /var/log/test.log

# å¯ç”¨æ§åˆ¶å°è¾“å‡º
output.console:
  enabled: true
```

**ğŸš€ å¯åŠ¨æŸ¥çœ‹æ•ˆæœ**
```bash
# å¯åŠ¨Filebeatï¼ˆå‰å°è¿è¡Œï¼Œæ–¹ä¾¿çœ‹è¾“å‡ºï¼‰
sudo filebeat -e -c filebeat.yml

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯å†™å…¥æµ‹è¯•æ—¥å¿—
echo "è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ—¥å¿—" >> /var/log/test.log
```

### 2.3 consoleè¾“å‡ºæ ¼å¼é…ç½®


**ğŸ¨ è¾“å‡ºæ ¼å¼ç¾åŒ–**
```yaml
output.console:
  enabled: true
  # ç¾åŒ–è¾“å‡ºæ ¼å¼ï¼Œä¾¿äºé˜…è¯»
  pretty: true
  
  # æ§åˆ¶è¾“å‡ºå†…å®¹çš„è¯¦ç»†ç¨‹åº¦
  bulk_max_size: 1
```

**ğŸ“Š ä¸åŒæ ¼å¼æ•ˆæœå¯¹æ¯”**
```
# pretty: false ï¼ˆé»˜è®¤ï¼Œç´§å‡‘æ ¼å¼ï¼‰
{"@timestamp":"2025-09-21T08:30:00.000Z","message":"æµ‹è¯•æ—¥å¿—"}

# pretty: true ï¼ˆç¾åŒ–æ ¼å¼ï¼Œæ˜“è¯»ï¼‰
{
  "@timestamp": "2025-09-21T08:30:00.000Z",
  "message": "æµ‹è¯•æ—¥å¿—",
  "log": {
    "file": {
      "path": "/var/log/test.log"
    }
  }
}
```

### 2.4 æ§åˆ¶å°è¾“å‡ºé«˜çº§é…ç½®


**ğŸ”§ å®Œæ•´é…ç½®ç¤ºä¾‹**
```yaml
output.console:
  enabled: true
  
  # ç¾åŒ–JSONè¾“å‡º
  pretty: true
  
  # æ¯æ¬¡è¾“å‡ºçš„æœ€å¤§äº‹ä»¶æ•°
  bulk_max_size: 1
  
  # å­—ç¬¦ç¼–ç è®¾ç½®
  codec.format:
    string: '%{[message]}'
  
  # åªè¾“å‡ºæŒ‡å®šå­—æ®µ
  codec.json:
    pretty: true
    escape_html: false
```

> ğŸ’¡ **å°è´´å£«**ï¼š`bulk_max_size: 1` è¡¨ç¤ºæ¯æ”¶åˆ°ä¸€æ¡æ—¥å¿—å°±ç«‹å³è¾“å‡ºï¼Œæ–¹ä¾¿å®æ—¶æŸ¥çœ‹

---

## 3. ğŸ“ fileæ–‡ä»¶è¾“å‡º


### 3.1 fileè¾“å‡ºçš„ç”¨é€”


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ–‡ä»¶è¾“å‡º**
```
æ–‡ä»¶è¾“å‡ºå°±æ˜¯æŠŠFilebeatæ”¶é›†çš„æ—¥å¿—
ä¿å­˜åˆ°æœ¬åœ°çš„æ–‡ä»¶ä¸­

ç®€å•ç†è§£ï¼š
åŸæ¥çš„æ—¥å¿—åœ¨ /var/log/app.log
ç»è¿‡Filebeatå¤„ç†åä¿å­˜åˆ° /tmp/filebeat-output.json

ç”¨é€”ï¼š
- æœ¬åœ°å¤‡ä»½æ—¥å¿—æ•°æ®
- ç¦»çº¿åˆ†ææ—¥å¿—å†…å®¹  
- è°ƒè¯•éªŒè¯æ•°æ®æ ¼å¼
- ä¸´æ—¶å­˜å‚¨å¾…åç»­å¤„ç†
```

### 3.2 åŸºæœ¬æ–‡ä»¶è¾“å‡ºé…ç½®


**ğŸ“ ç®€å•æ–‡ä»¶è¾“å‡º**
```yaml
# filebeat.yml
filebeat.inputs:
  - type: log
    paths:
      - /var/log/app.log

# æ–‡ä»¶è¾“å‡ºé…ç½®
output.file:
  enabled: true
  # è¾“å‡ºæ–‡ä»¶è·¯å¾„
  path: "/tmp/filebeat"
  # æ–‡ä»¶å
  filename: "filebeat-output"
```

**ğŸ“‚ è¾“å‡ºæ–‡ä»¶å‘½åè§„åˆ™**
```
ç”Ÿæˆçš„æ–‡ä»¶åæ ¼å¼ï¼š
/tmp/filebeat/filebeat-output-2025-09-21-001.ndjson

æ–‡ä»¶åç»„æˆï¼š
- path: /tmp/filebeat ï¼ˆç›®å½•ï¼‰
- filename: filebeat-output ï¼ˆæ–‡ä»¶åå‰ç¼€ï¼‰
- æ—¥æœŸ: 2025-09-21 ï¼ˆè‡ªåŠ¨æ·»åŠ ï¼‰
- åºå·: 001 ï¼ˆè‡ªåŠ¨é€’å¢ï¼‰
- æ‰©å±•å: .ndjson ï¼ˆJSONæ ¼å¼ï¼‰
```

### 3.3 æ–‡ä»¶è½®è½¬é…ç½®


**ğŸ”„ è‡ªåŠ¨æ–‡ä»¶è½®è½¬è®¾ç½®**
```yaml
output.file:
  enabled: true
  path: "/tmp/filebeat"
  filename: "logs"
  
  # æ–‡ä»¶å¤§å°è½®è½¬ï¼ˆå•ä¸ªæ–‡ä»¶æœ€å¤§10MBï¼‰
  rotate_every_kb: 10240
  
  # ä¿ç•™æ–‡ä»¶æ•°é‡ï¼ˆæœ€å¤šä¿ç•™7ä¸ªæ–‡ä»¶ï¼‰
  number_of_files: 7
  
  # æ–‡ä»¶æƒé™è®¾ç½®
  permissions: 0644
```

**ğŸ“‹ è½®è½¬è§„åˆ™è¯´æ˜**
```
å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ä¼šåˆ›å»ºæ–°æ–‡ä»¶ï¼š
1. å½“å‰æ–‡ä»¶å¤§å°è¶…è¿‡ rotate_every_kb è®¾ç½®çš„å¤§å°
2. æ–‡ä»¶æ•°é‡è¶…è¿‡ number_of_files è®¾ç½®çš„æ•°é‡æ—¶ï¼Œåˆ é™¤æœ€è€çš„æ–‡ä»¶

æ–‡ä»¶å‘½åç¤ºä¾‹ï¼š
logs-2025-09-21-001.ndjson  ï¼ˆç¬¬1ä¸ªæ–‡ä»¶ï¼‰
logs-2025-09-21-002.ndjson  ï¼ˆç¬¬2ä¸ªæ–‡ä»¶ï¼‰
logs-2025-09-22-001.ndjson  ï¼ˆç¬¬äºŒå¤©çš„æ–‡ä»¶ï¼‰
```

### 3.4 æ–‡ä»¶è¾“å‡ºå®ç”¨é…ç½®


**âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®**
```yaml
output.file:
  enabled: true
  path: "/var/log/filebeat"
  filename: "processed-logs"
  
  # æ‰¹é‡å†™å…¥å¤§å°ï¼ˆæé«˜æ€§èƒ½ï¼‰
  bulk_max_size: 1024
  
  # å¼ºåˆ¶åˆ·æ–°é—´éš”ï¼ˆç¡®ä¿æ•°æ®åŠæ—¶å†™å…¥ï¼‰
  flush_interval: 1s
  
  # æ–‡ä»¶è½®è½¬å¤§å°ï¼ˆ100MBï¼‰
  rotate_every_kb: 102400
  
  # ä¿ç•™æ–‡ä»¶æ•°é‡
  number_of_files: 10
```

---

## 4. ğŸ”„ redisç¼“å­˜è¾“å‡º


### 4.1 redisè¾“å‡ºçš„åº”ç”¨ä»·å€¼


**ğŸ”¸ ä¸ºä»€ä¹ˆä½¿ç”¨Redisä½œä¸ºè¾“å‡º**
```
Redisåœ¨æ—¥å¿—å¤„ç†ä¸­çš„ä½œç”¨ï¼š

ç¼“å†²åŒºè§’è‰²ï¼š
Filebeat â†’ Redis â†’ Logstash â†’ Elasticsearch

å¥½å¤„è§£é‡Šï¼š
1. å‰Šå³°å¡«è°·ï¼šåº”å¯¹æ—¥å¿—çªå‘é‡
2. è§£è€¦ç³»ç»Ÿï¼šFilebeatå’Œåç«¯å¤„ç†åˆ†ç¦»
3. é«˜æ€§èƒ½ï¼šRedisè¯»å†™é€Ÿåº¦å¿«
4. å¯é æ€§ï¼šé¿å…æ•°æ®ä¸¢å¤±
```

**ğŸ¯ å…¸å‹åº”ç”¨æ¶æ„**
```
WebæœåŠ¡å™¨é›†ç¾¤           Redisé›†ç¾¤           æ—¥å¿—å¤„ç†é›†ç¾¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Server1 â”‚â”€â”€â”€â”€â”€â”€â†’ â”‚   Redis1    â”‚â”€â”€â”€â”€â†’ â”‚ Logstash1   â”‚
â”‚  Filebeat   â”‚        â”‚   (Master)  â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Server2 â”‚â”€â”€â”€â”€â”€â”€â†’ â”‚   Redis2    â”‚â”€â”€â”€â”€â†’ â”‚ Logstash2   â”‚
â”‚  Filebeat   â”‚        â”‚   (Slave)   â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Redisè¾“å‡ºåŸºæœ¬é…ç½®


**âš™ï¸ ç®€å•Redisé…ç½®**
```yaml
# filebeat.yml
filebeat.inputs:
  - type: log
    paths:
      - /var/log/app.log

# Redisè¾“å‡ºé…ç½®
output.redis:
  enabled: true
  # RedisæœåŠ¡å™¨åœ°å€
  hosts: ["localhost:6379"]
  # æ•°æ®å­˜å‚¨çš„keyåç§°
  key: "filebeat-logs"
  # æ•°æ®ç±»å‹ï¼ˆliståˆ—è¡¨ï¼‰
  data_type: "list"
```

**ğŸ”‘ Redisè¿æ¥é…ç½®**
```yaml
output.redis:
  enabled: true
  hosts: ["redis1:6379", "redis2:6379"]
  
  # è®¤è¯é…ç½®
  password: "your_redis_password"
  
  # æ•°æ®åº“é€‰æ‹©ï¼ˆé»˜è®¤0ï¼‰
  db: 0
  
  # è¿æ¥è¶…æ—¶
  timeout: 5s
  
  # é‡è¿è®¾ç½®
  max_retries: 3
```

### 4.3 Redisæ•°æ®ç»“æ„é…ç½®


**ğŸ“‹ listç±»å‹å­˜å‚¨**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  # ä½¿ç”¨listæ•°æ®ç»“æ„
  data_type: "list"
  key: "app-logs"
  
  # listæ“ä½œç±»å‹
  list_operation: "lpush"  # ä»å·¦ä¾§æ¨å…¥
```

**ğŸ—ƒï¸ channelç±»å‹å‘å¸ƒ**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  # ä½¿ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å¼
  data_type: "channel"
  key: "log-channel"
```

**âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®**
```yaml
output.redis:
  hosts: ["localhost:6379"]
  key: "filebeat-logs"
  data_type: "list"
  
  # æ‰¹é‡å¤„ç†å¤§å°
  bulk_max_size: 2048
  
  # æ‰¹é‡å¤„ç†è¶…æ—¶
  timeout: 30s
  
  # è¿æ¥æ± å¤§å°
  worker: 1
```

### 4.4 Redisè¾“å‡ºç›‘æ§éªŒè¯


**ğŸ” éªŒè¯Redisæ•°æ®**
```bash
# è¿æ¥åˆ°RedisæŸ¥çœ‹æ•°æ®
redis-cli

# æŸ¥çœ‹listç±»å‹æ•°æ®
LLEN filebeat-logs        # æŸ¥çœ‹åˆ—è¡¨é•¿åº¦
LRANGE filebeat-logs 0 5  # æŸ¥çœ‹å‰5æ¡æ•°æ®

# æŸ¥çœ‹å®æ—¶æ•°æ®å†™å…¥
MONITOR                   # ç›‘æ§Rediså‘½ä»¤æ‰§è¡Œ
```

---

## 5. ğŸ¨ ç¼–ç å™¨codecé…ç½®


### 5.1 codecç¼–ç å™¨æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¼–ç å™¨**
```
ç¼–ç å™¨ï¼ˆCodecï¼‰å†³å®šäº†æ•°æ®çš„è¾“å‡ºæ ¼å¼

ç®€å•ç†è§£ï¼š
åŸå§‹æ—¥å¿—ï¼š2025-09-21 error: ç”¨æˆ·ç™»å½•å¤±è´¥
ç»è¿‡ç¼–ç å™¨å¤„ç†åçš„æ ¼å¼å¯ä»¥æ˜¯ï¼š
- JSONæ ¼å¼ï¼š{"level":"error","message":"ç”¨æˆ·ç™»å½•å¤±è´¥"}
- çº¯æ–‡æœ¬æ ¼å¼ï¼š[ERROR] ç”¨æˆ·ç™»å½•å¤±è´¥
- è‡ªå®šä¹‰æ ¼å¼ï¼šé”™è¯¯|2025-09-21|ç”¨æˆ·ç™»å½•å¤±è´¥
```

**ğŸ“Š å¸¸ç”¨ç¼–ç å™¨ç±»å‹**
```
jsonç¼–ç å™¨ï¼š
- è¾“å‡ºæ ‡å‡†JSONæ ¼å¼
- é€‚åˆç¨‹åºå¤„ç†

plainç¼–ç å™¨ï¼š
- è¾“å‡ºçº¯æ–‡æœ¬æ ¼å¼  
- é€‚åˆäººç±»é˜…è¯»

formatç¼–ç å™¨ï¼š
- è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼
- çµæ´»æ§åˆ¶è¾“å‡ºå†…å®¹
```

### 5.2 JSONç¼–ç å™¨é…ç½®


**ğŸ“ æ ‡å‡†JSONè¾“å‡º**
```yaml
output.console:
  enabled: true
  # JSONç¼–ç å™¨é…ç½®
  codec.json:
    # ç¾åŒ–è¾“å‡ºæ ¼å¼
    pretty: true
    # è½¬ä¹‰HTMLå­—ç¬¦
    escape_html: false
```

**ğŸ¨ è‡ªå®šä¹‰JSONå­—æ®µ**
```yaml
output.file:
  path: "/tmp/logs"
  filename: "app-logs"
  
  codec.json:
    pretty: true
    # åªè¾“å‡ºæŒ‡å®šå­—æ®µ
    fields: ["@timestamp", "message", "level"]
```

### 5.3 æ ¼å¼åŒ–ç¼–ç å™¨


**âœï¸ è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼**
```yaml
output.console:
  enabled: true
  # æ ¼å¼åŒ–ç¼–ç å™¨
  codec.format:
    # è‡ªå®šä¹‰è¾“å‡ºæ¨¡æ¿
    string: '[%{[@timestamp]}] %{[log.level]} %{[message]}'
```

**ğŸ“‹ æ ¼å¼åŒ–æ¨¡æ¿è¯­æ³•**
```
æ¨¡æ¿è¯­æ³•è¯´æ˜ï¼š
%{[å­—æ®µå]}           # è¾“å‡ºæŒ‡å®šå­—æ®µçš„å€¼
%{[@timestamp]}       # è¾“å‡ºæ—¶é—´æˆ³
%{[message]}          # è¾“å‡ºæ¶ˆæ¯å†…å®¹
%{[log.file.path]}    # è¾“å‡ºæ–‡ä»¶è·¯å¾„

ç¤ºä¾‹æ¨¡æ¿ï¼š
'%{[@timestamp]} [%{[log.level]}] %{[host.name]} %{[message]}'

è¾“å‡ºæ•ˆæœï¼š
2025-09-21T08:30:00.000Z [INFO] web-server-01 ç”¨æˆ·ç™»å½•æˆåŠŸ
```

### 5.4 ç¼–ç å™¨å®é™…åº”ç”¨


**ğŸ¯ åœºæ™¯åŒ–ç¼–ç é…ç½®**
```yaml
# åœºæ™¯1ï¼šå¼€å‘è°ƒè¯•ï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰
output.console:
  codec.json:
    pretty: true
    
# åœºæ™¯2ï¼šæ—¥å¿—å½’æ¡£ï¼ˆç´§å‡‘æ ¼å¼ï¼‰
output.file:
  path: "/backup/logs"
  codec.format:
    string: '%{[@timestamp]}|%{[log.level]}|%{[message]}'
    
# åœºæ™¯3ï¼šé”™è¯¯å‘Šè­¦ï¼ˆå…³é”®ä¿¡æ¯ï¼‰
output.redis:
  codec.format:
    string: 'ALERT: %{[message]} FROM %{[host.name]}'
```

---

## 6. ğŸ”€ å¤šè¾“å‡ºé…ç½®ç­–ç•¥


### 6.1 å¤šè¾“å‡ºçš„éœ€æ±‚åœºæ™¯


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦å¤šè¾“å‡º**
```
å®é™…ä¸šåŠ¡åœºæ™¯ï¼š

åŒæ—¶éœ€è¦ï¼š
1. å®æ—¶ç›‘æ§ â†’ å‘é€åˆ°Elasticsearch
2. æ•°æ®å¤‡ä»½ â†’ ä¿å­˜åˆ°æ–‡ä»¶
3. å‘Šè­¦å¤„ç† â†’ å‘é€åˆ°Redisé˜Ÿåˆ—
4. è°ƒè¯•éªŒè¯ â†’ è¾“å‡ºåˆ°æ§åˆ¶å°

é—®é¢˜ï¼šFilebeatåŸç”Ÿåªæ”¯æŒä¸€ç§è¾“å‡º
è§£å†³ï¼šé€šè¿‡ä¸­é—´ä»¶å®ç°å¤šè¾“å‡º
```

### 6.2 é€šè¿‡Logstashå®ç°å¤šè¾“å‡º


**ğŸ”„ æ¶æ„è®¾è®¡**
```
Filebeat â†’ Logstash â†’ å¤šä¸ªè¾“å‡º
                  â”œâ”€â”€ Elasticsearch
                  â”œâ”€â”€ File
                  â”œâ”€â”€ Redis
                  â””â”€â”€ Email
```

**âš™ï¸ Filebeaté…ç½®**
```yaml
# filebeat.yml
output.logstash:
  hosts: ["localhost:5044"]
```

**ğŸ”§ Logstashé…ç½®ç¤ºä¾‹**
```ruby
# logstash.conf
input {
  beats {
    port => 5044
  }
}

filter {
  # æ•°æ®å¤„ç†é€»è¾‘
}

output {
  # è¾“å‡ºåˆ°Elasticsearch
  elasticsearch {
    hosts => ["localhost:9200"]
  }
  
  # åŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶
  file {
    path => "/backup/logs/app-%{+yyyy-MM-dd}.log"
  }
  
  # é”™è¯¯æ—¥å¿—å‘é€åˆ°Redis
  if [log.level] == "ERROR" {
    redis {
      host => "localhost"
      port => 6379
      key => "error-alerts"
    }
  }
}
```

### 6.3 æ¡ä»¶è¾“å‡ºç­–ç•¥


**ğŸ¯ åŸºäºæ—¥å¿—çº§åˆ«çš„åˆ†æµ**
```ruby
# Logstashæ¡ä»¶è¾“å‡º
output {
  # é”™è¯¯æ—¥å¿— â†’ Rediså‘Šè­¦é˜Ÿåˆ—
  if [log.level] == "ERROR" {
    redis {
      key => "error-queue"
    }
  }
  
  # æ™®é€šæ—¥å¿— â†’ Elasticsearch
  else {
    elasticsearch {
      index => "app-logs-%{+yyyy.MM.dd}"
    }
  }
  
  # æ‰€æœ‰æ—¥å¿— â†’ æ–‡ä»¶å¤‡ä»½
  file {
    path => "/backup/all-logs.json"
  }
}
```

---

## 7. âš–ï¸ æ¡ä»¶è¾“å‡ºåˆ¤æ–­


### 7.1 æ¡ä»¶åˆ¤æ–­çš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ¡ä»¶è¾“å‡º**
```
æ¡ä»¶è¾“å‡ºå°±æ˜¯æ ¹æ®æ—¥å¿—çš„å†…å®¹ç‰¹å¾
å†³å®šå°†æ•°æ®å‘é€åˆ°å“ªä¸ªç›®æ ‡

ä¸¾ä¾‹è¯´æ˜ï¼š
- å¦‚æœæ˜¯é”™è¯¯æ—¥å¿— â†’ å‘é€åˆ°å‘Šè­¦ç³»ç»Ÿ
- å¦‚æœæ˜¯è®¿é—®æ—¥å¿— â†’ å‘é€åˆ°ç»Ÿè®¡ç³»ç»Ÿ  
- å¦‚æœæ˜¯è°ƒè¯•æ—¥å¿— â†’ åªä¿å­˜åˆ°æ–‡ä»¶
```

### 7.2 åœ¨Logstashä¸­å®ç°æ¡ä»¶åˆ¤æ–­


**âš™ï¸ åŸºæœ¬æ¡ä»¶è¯­æ³•**
```ruby
# Logstashæ¡ä»¶åˆ¤æ–­è¯­æ³•
if [å­—æ®µå] == "å€¼" {
  # æ»¡è¶³æ¡ä»¶æ—¶çš„å¤„ç†
}
else if [å­—æ®µå] != "å€¼" {
  # å…¶ä»–æ¡ä»¶çš„å¤„ç†  
}
else {
  # é»˜è®¤å¤„ç†
}
```

**ğŸ¯ å®é™…æ¡ä»¶åˆ¤æ–­ç¤ºä¾‹**
```ruby
output {
  # æ¡ä»¶1ï¼šåº”ç”¨é”™è¯¯æ—¥å¿—
  if [fields][app] == "web-app" and [log.level] == "ERROR" {
    redis {
      key => "web-app-errors"
      host => "redis-alerts:6379"
    }
  }
  
  # æ¡ä»¶2ï¼šæ•°æ®åº“æ…¢æŸ¥è¯¢
  if [message] =~ /slow query/ {
    elasticsearch {
      index => "slow-queries-%{+yyyy.MM.dd}"
    }
  }
  
  # æ¡ä»¶3ï¼šç”¨æˆ·è¡Œä¸ºæ—¥å¿—
  if [fields][type] == "user-behavior" {
    kafka {
      topic_id => "user-events"
    }
  }
  
  # é»˜è®¤ï¼šæ‰€æœ‰å…¶ä»–æ—¥å¿—
  else {
    elasticsearch {
      index => "general-logs-%{+yyyy.MM.dd}"
    }
  }
}
```

### 7.3 Filebeatå­—æ®µæ¡ä»¶é…ç½®


**ğŸ·ï¸ ä¸ºä¸åŒè¾“å…¥æ·»åŠ æ ‡è¯†**
```yaml
# filebeat.yml
filebeat.inputs:
  # Webåº”ç”¨æ—¥å¿—
  - type: log
    paths: ["/var/log/webapp/*.log"]
    fields:
      app: "webapp"
      env: "production"
    fields_under_root: true
    
  # æ•°æ®åº“æ—¥å¿—
  - type: log
    paths: ["/var/log/mysql/*.log"]
    fields:
      app: "mysql"
      type: "database"
    fields_under_root: true

output.logstash:
  hosts: ["logstash:5044"]
```

---

## 8. ğŸ” æµ‹è¯•è°ƒè¯•è¾“å‡º


### 8.1 è°ƒè¯•è¾“å‡ºçš„é‡è¦æ€§


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦è°ƒè¯•è¾“å‡º**
```
å¼€å‘å’Œè¿ç»´ä¸­çš„å¸¸è§é—®é¢˜ï¼š
1. Filebeatæ˜¯å¦æ­£å¸¸è¯»å–æ—¥å¿—ï¼Ÿ
2. æ•°æ®æ ¼å¼æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Ÿ
3. å­—æ®µè§£ææ˜¯å¦æ­£ç¡®ï¼Ÿ
4. è¾“å‡ºé…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

è°ƒè¯•è¾“å‡ºå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜
```

### 8.2 æ§åˆ¶å°è°ƒè¯•æŠ€å·§


**ğŸ–¥ï¸ å®æ—¶è°ƒè¯•å‘½ä»¤**
```bash
# å‰å°è¿è¡ŒFilebeatï¼Œæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
sudo filebeat -e -c filebeat.yml -d "*"

# åªæµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
sudo filebeat test config -c filebeat.yml

# æµ‹è¯•è¾“å‡ºè¿æ¥æ˜¯å¦æ­£å¸¸
sudo filebeat test output -c filebeat.yml
```

**ğŸ“Š è°ƒè¯•ä¿¡æ¯è§£è¯»**
```bash
# å¯åŠ¨æ—¶çœ‹åˆ°è¿™äº›ä¿¡æ¯è¡¨ç¤ºæ­£å¸¸ï¼š
INFO    [crawler]       beater/crawler.go:71    Loading Inputs: 1
INFO    [cfgfile]       cfgfile/reload.go:164   Config reloader started
INFO    instance/beat.go:468    filebeat start running.

# æ—¥å¿—å¤„ç†ä¿¡æ¯ï¼š
INFO    [publisher_pipeline_output]     Events sent: 10
INFO    [registrar]     registrar/registrar.go:104     States Loaded from registries
```

### 8.3 æ–‡ä»¶è°ƒè¯•è¾“å‡º


**ğŸ“ è°ƒè¯•æ–‡ä»¶é…ç½®**
```yaml
# ä¸“é—¨ç”¨äºè°ƒè¯•çš„é…ç½®
output.file:
  enabled: true
  path: "/tmp/debug"
  filename: "filebeat-debug"
  
  # ç¾åŒ–JSONæ ¼å¼ä¾¿äºæŸ¥çœ‹
  codec.json:
    pretty: true
  
  # æ¯æ¡æ—¥å¿—å•ç‹¬è¾“å‡º
  bulk_max_size: 1
  
  # ç«‹å³åˆ·æ–°åˆ°ç£ç›˜
  flush_interval: 1s
```

### 8.4 ç”Ÿäº§ç¯å¢ƒè°ƒè¯•ç­–ç•¥


**âš¡ ä¸å½±å“ç”Ÿäº§çš„è°ƒè¯•æ–¹æ³•**
```yaml
# æ–¹æ³•1ï¼šä¸´æ—¶å¯ç”¨æ–‡ä»¶è¾“å‡º
output.file:
  enabled: true
  path: "/tmp/debug"
  filename: "production-debug"
  # åªä¿ç•™å°‘é‡è°ƒè¯•æ•°æ®
  number_of_files: 2
  rotate_every_kb: 1024

# æ–¹æ³•2ï¼šä½¿ç”¨fieldsæ ‡è®°è°ƒè¯•æ•°æ®
filebeat.inputs:
  - type: log
    paths: ["/var/log/app.log"]
    # æ·»åŠ è°ƒè¯•æ ‡è®°
    fields:
      debug: true
      environment: "production"
```

**ğŸ” è¿œç¨‹è°ƒè¯•æ–¹æ³•**
```bash
# æŸ¥çœ‹Filebeatè¿è¡ŒçŠ¶æ€
sudo systemctl status filebeat

# æŸ¥çœ‹å®æ—¶æ—¥å¿—è¾“å‡º
sudo journalctl -u filebeat -f

# æ£€æŸ¥registryæ–‡ä»¶ï¼ˆè·Ÿè¸ªè¯»å–ä½ç½®ï¼‰
sudo cat /var/lib/filebeat/registry/filebeat/data.json | jq
```

---

## 9. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 9.1 å¼€å‘ç¯å¢ƒå¿«é€ŸéªŒè¯


**ğŸ”§ å¼€å‘è€…æ—¥å¸¸å·¥ä½œæµ**
```yaml
# å¼€å‘ç¯å¢ƒé…ç½®
filebeat.inputs:
  - type: log
    paths: ["/var/log/myapp/*.log"]

# ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°æŸ¥çœ‹
output.console:
  enabled: true
  pretty: true
  bulk_max_size: 1

# å¯åŠ¨å‘½ä»¤
# filebeat -e -c dev-filebeat.yml
```

### 9.2 æµ‹è¯•ç¯å¢ƒæ•°æ®éªŒè¯


**ğŸ“‹ æµ‹è¯•ç¯å¢ƒé…ç½®**
```yaml
# æµ‹è¯•ç¯å¢ƒï¼šåŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶å’Œæ§åˆ¶å°
filebeat.inputs:
  - type: log
    paths: ["/var/log/test-app/*.log"]
    fields:
      environment: "test"

output.file:
  path: "/tmp/test-logs"
  filename: "test-output"
  codec.json:
    pretty: true
```

### 9.3 ç”Ÿäº§ç¯å¢ƒç›‘æ§é…ç½®


**ğŸ­ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
```yaml
# ç”Ÿäº§ç¯å¢ƒï¼šé«˜æ€§èƒ½Redisè¾“å‡º
filebeat.inputs:
  - type: log
    paths: ["/var/log/prod-app/*.log"]
    fields:
      environment: "production"
      datacenter: "us-east-1"

output.redis:
  hosts: ["redis-cluster:6379"]
  key: "production-logs"
  data_type: "list"
  bulk_max_size: 2048
  timeout: 30s
  password: "${REDIS_PASSWORD}"
```

### 9.4 åº”æ€¥æ•…éšœæ’æŸ¥


**ğŸš¨ æ•…éšœæ’æŸ¥ä¸´æ—¶é…ç½®**
```yaml
# ç´§æ€¥æƒ…å†µï¼šä¸´æ—¶å¯ç”¨æ–‡ä»¶è¾“å‡ºè°ƒè¯•
filebeat.inputs:
  - type: log
    paths: ["/var/log/error-app/*.log"]
    # åªå¤„ç†æœ€è¿‘çš„æ—¥å¿—
    ignore_older: 1h

output.file:
  enabled: true
  path: "/emergency/debug"
  filename: "emergency-logs"
  
  # è¯¦ç»†è¾“å‡ºä¾¿äºåˆ†æ
  codec.json:
    pretty: true
  
  # å¿«é€Ÿåˆ·æ–°
  flush_interval: 1s
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ è¾“å‡ºç±»å‹é€‰æ‹©ï¼šæ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„è¾“å‡ºæ–¹å¼
ğŸ”¸ consoleè¾“å‡ºï¼šå¼€å‘è°ƒè¯•é˜¶æ®µçš„æœ€ä½³é€‰æ‹©ï¼Œç›´è§‚å¯è§
ğŸ”¸ fileè¾“å‡ºï¼šæœ¬åœ°å­˜å‚¨å’Œå¤‡ä»½çš„å¯é æ–¹æ¡ˆ
ğŸ”¸ redisè¾“å‡ºï¼šé«˜æ€§èƒ½ç¼“å†²å’Œæ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ
ğŸ”¸ codecç¼–ç ï¼šæ§åˆ¶è¾“å‡ºæ•°æ®çš„æ ¼å¼å’Œå†…å®¹
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¾“å‡ºç±»å‹çš„é€‰æ‹©æ ‡å‡†**
```
å¼€å‘è°ƒè¯•é˜¶æ®µï¼š
- é¦–é€‰consoleè¾“å‡ºï¼Œå®æ—¶å¯è§
- é…åˆfileè¾“å‡ºåšæ•°æ®å¤‡ä»½

æµ‹è¯•éªŒè¯é˜¶æ®µï¼š
- ä½¿ç”¨fileè¾“å‡ºä¿å­˜æµ‹è¯•æ•°æ®
- ä¾¿äºç¦»çº¿åˆ†æå’ŒéªŒè¯

ç”Ÿäº§ç¯å¢ƒé˜¶æ®µï¼š
- redis/kafkaåšæ¶ˆæ¯é˜Ÿåˆ—
- elasticsearchåšå­˜å‚¨åˆ†æ
- fileåšå¤‡ä»½ä¿éšœ
```

**ğŸ”¹ æ€§èƒ½å’Œå¯é æ€§å¹³è¡¡**
```
æ€§èƒ½ä¼˜åŒ–ï¼š
- åˆç†è®¾ç½®bulk_max_size
- ä½¿ç”¨redisåšç¼“å†²
- é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨console

å¯é æ€§ä¿éšœï¼š
- fileè¾“å‡ºåšæœ¬åœ°å¤‡ä»½
- é…ç½®åˆé€‚çš„é‡è¯•æœºåˆ¶
- ç›‘æ§è¾“å‡ºçŠ¶æ€å’Œé”™è¯¯
```

### 10.3 å®è·µåº”ç”¨å»ºè®®


**ğŸ’¡ é…ç½®æ–‡ä»¶ç®¡ç†**
```
ç¯å¢ƒéš”ç¦»ï¼š
âœ… å¼€å‘ç¯å¢ƒï¼šdev-filebeat.yml
âœ… æµ‹è¯•ç¯å¢ƒï¼štest-filebeat.yml  
âœ… ç”Ÿäº§ç¯å¢ƒï¼šprod-filebeat.yml

ç‰ˆæœ¬æ§åˆ¶ï¼š
âœ… å°†é…ç½®æ–‡ä»¶çº³å…¥Gitç®¡ç†
âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
âœ… å®šæœŸå¤‡ä»½ç”Ÿäº§é…ç½®
```

**ğŸ”§ è°ƒè¯•å’Œç›‘æ§**
```
è°ƒè¯•æŠ€å·§ï¼š
âœ… ä½¿ç”¨testå‘½ä»¤éªŒè¯é…ç½®
âœ… å‰å°è¿è¡ŒæŸ¥çœ‹å®æ—¶æ—¥å¿—
âœ… é…ç½®è¯¦ç»†çš„æ—¥å¿—çº§åˆ«

ç›‘æ§è¦ç‚¹ï¼š
âœ… ç›‘æ§è¾“å‡ºçš„æˆåŠŸç‡
âœ… å…³æ³¨é”™è¯¯æ—¥å¿—å’Œé‡è¯•æ¬¡æ•°
âœ… å®šæœŸæ£€æŸ¥ç›®æ ‡ç³»ç»ŸçŠ¶æ€
```

### 10.4 å¸¸è§é”™è¯¯é¿å…


```
é…ç½®é”™è¯¯ï¼š
âŒ åŒæ—¶é…ç½®å¤šä¸ªè¾“å‡ºç±»å‹
âŒ æ–‡ä»¶è·¯å¾„æƒé™ä¸è¶³
âŒ Redisè¿æ¥ä¿¡æ¯é”™è¯¯

æ€§èƒ½é—®é¢˜ï¼š
âŒ bulk_max_sizeè®¾ç½®è¿‡å°
âŒ åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨consoleè¾“å‡º
âŒ æ²¡æœ‰é…ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´

è¿ç»´é—®é¢˜ï¼š
âŒ æ²¡æœ‰ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨
âŒ æ²¡æœ‰å®šæœŸæ¸…ç†å†å²æ–‡ä»¶
âŒ ç¼ºå°‘è¾“å‡ºçŠ¶æ€ç›‘æ§
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- è¾“å‡ºç±»å‹è¦æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©ï¼Œä¸åŒé˜¶æ®µç”¨ä¸åŒæ–¹æ¡ˆ
- consoleé€‚åˆè°ƒè¯•ï¼Œfileé€‚åˆå¤‡ä»½ï¼Œredisé€‚åˆç¼“å†²
- codecç¼–ç å™¨æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼Œå¯ä»¥çµæ´»å®šåˆ¶
- å¤šè¾“å‡ºéœ€è¦é€šè¿‡Logstashç­‰ä¸­é—´ä»¶å®ç°
- è°ƒè¯•æ—¶è¦å……åˆ†åˆ©ç”¨æµ‹è¯•å‘½ä»¤å’Œè¯¦ç»†æ—¥å¿—