---
title: 3ã€åº”ç”¨ç¨‹åºæ—¥å¿—
---
## ğŸ“š ç›®å½•

1. [åº”ç”¨ç¨‹åºæ—¥å¿—æ¦‚è¿°](#1-åº”ç”¨ç¨‹åºæ—¥å¿—æ¦‚è¿°)
2. [Javaåº”ç”¨æ—¥å¿—å¤„ç†](#2-Javaåº”ç”¨æ—¥å¿—å¤„ç†)
3. [SpringBootæ—¥å¿—é›†æˆ](#3-SpringBootæ—¥å¿—é›†æˆ)
4. [Pythonåº”ç”¨æ—¥å¿—å¤„ç†](#4-Pythonåº”ç”¨æ—¥å¿—å¤„ç†)
5. [ç»“æ„åŒ–æ—¥å¿—å¤„ç†](#5-ç»“æ„åŒ–æ—¥å¿—å¤„ç†)
6. [å¼‚å¸¸æ—¥å¿—ä¸å¤šè¡Œå¤„ç†](#6-å¼‚å¸¸æ—¥å¿—ä¸å¤šè¡Œå¤„ç†)
7. [æ—¥å¿—çº§åˆ«è¿‡æ»¤ä¸å­—æ®µæ˜ å°„](#7-æ—¥å¿—çº§åˆ«è¿‡æ»¤ä¸å­—æ®µæ˜ å°„)
8. [åº”ç”¨é”™è¯¯ç›‘æ§å®æˆ˜](#8-åº”ç”¨é”™è¯¯ç›‘æ§å®æˆ˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ åº”ç”¨ç¨‹åºæ—¥å¿—æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯åº”ç”¨ç¨‹åºæ—¥å¿—


**ğŸ“‹ åŸºæœ¬æ¦‚å¿µ**
åº”ç”¨ç¨‹åºæ—¥å¿—å°±æ˜¯æˆ‘ä»¬å†™çš„ç¨‹åºåœ¨è¿è¡Œæ—¶äº§ç”Ÿçš„è®°å½•ä¿¡æ¯ï¼Œå°±åƒç¨‹åºçš„"æ—¥è®°æœ¬"ä¸€æ ·ï¼Œè®°å½•ç€ç¨‹åºåšäº†ä»€ä¹ˆã€é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ã€‚

```
ç®€å•ç†è§£ï¼š
ç¨‹åºè¿è¡Œ â†’ äº§ç”Ÿå„ç§ä¿¡æ¯ â†’ å†™å…¥æ—¥å¿—æ–‡ä»¶ â†’ Filebeatæ”¶é›† â†’ å‘é€åˆ°Elasticsearch

å°±åƒè¿™æ ·ï¼š
ä½ çš„Javaç¨‹åº â†’ æ‰“å°"ç”¨æˆ·ç™»å½•æˆåŠŸ" â†’ å†™åˆ°app.log â†’ Filebeatè¯»å– â†’ é€åˆ°ESåˆ†æ
```

**ğŸ¯ ä¸ºä»€ä¹ˆè¦æ”¶é›†åº”ç”¨æ—¥å¿—**
- **æ’æŸ¥é—®é¢˜**ï¼šç¨‹åºå‡ºé”™äº†ï¼Œé€šè¿‡æ—¥å¿—æ‰¾åŸå› 
- **ç›‘æ§è¿è¡Œ**ï¼šç¨‹åºæ˜¯å¦æ­£å¸¸å·¥ä½œ
- **åˆ†æç”¨æˆ·è¡Œä¸º**ï¼šç”¨æˆ·åšäº†ä»€ä¹ˆæ“ä½œ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå“ªäº›æ“ä½œæ¯”è¾ƒæ…¢

### 1.2 åº”ç”¨æ—¥å¿—çš„å¸¸è§ç±»å‹


```
æ—¥å¿—ç±»å‹åˆ†å¸ƒï¼š

åº”ç”¨è®¿é—®æ—¥å¿—              ä¸šåŠ¡æ“ä½œæ—¥å¿—              é”™è¯¯å¼‚å¸¸æ—¥å¿—
     |                        |                        |
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç™»å½•     â”‚        â”‚ ä¸‹å•æˆåŠŸ     â”‚        â”‚ æ•°æ®åº“è¿æ¥å¤±è´¥â”‚
â”‚ é¡µé¢è®¿é—®     â”‚        â”‚ æ”¯ä»˜å®Œæˆ     â”‚        â”‚ ç©ºæŒ‡é’ˆå¼‚å¸¸   â”‚
â”‚ APIè°ƒç”¨     â”‚        â”‚ å‘é€é‚®ä»¶     â”‚        â”‚ ç½‘ç»œè¶…æ—¶     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š æ—¥å¿—çº§åˆ«å¯¹æ¯”**

| çº§åˆ« | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** | **ä¸¾ä¾‹** |
|------|---------|-------------|---------|
| ğŸ”´ **ERROR** | `ä¸¥é‡é”™è¯¯` | `ç¨‹åºå¼‚å¸¸ï¼Œéœ€è¦ç«‹å³å¤„ç†` | `æ•°æ®åº“è¿æ¥å¤±è´¥` |
| âš ï¸ **WARN** | `è­¦å‘Šä¿¡æ¯` | `å¯èƒ½æœ‰é—®é¢˜ï¼Œä½†ç¨‹åºè¿˜èƒ½è¿è¡Œ` | `ç£ç›˜ç©ºé—´ä¸è¶³` |
| â„¹ï¸ **INFO** | `ä¸€èˆ¬ä¿¡æ¯` | `æ­£å¸¸çš„ä¸šåŠ¡æµç¨‹è®°å½•` | `ç”¨æˆ·ç™»å½•æˆåŠŸ` |
| ğŸ” **DEBUG** | `è°ƒè¯•ä¿¡æ¯` | `å¼€å‘æ—¶æŸ¥çœ‹ç¨‹åºè¿è¡Œç»†èŠ‚` | `å˜é‡å€¼å˜åŒ–` |

---

## 2. â˜• Javaåº”ç”¨æ—¥å¿—å¤„ç†


### 2.1 Javaæ—¥å¿—çš„ç‰¹ç‚¹


**ğŸ”¸ Javaæ—¥å¿—æ¡†æ¶**
Javaç¨‹åºé€šå¸¸ä½¿ç”¨è¿™äº›æ¡†æ¶æ¥äº§ç”Ÿæ—¥å¿—ï¼š
- **Logback**ï¼šæœ€æµè¡Œçš„ï¼ŒSpringBooté»˜è®¤ç”¨å®ƒ
- **Log4j2**ï¼šæ€§èƒ½å¾ˆå¥½ï¼ŒåŠŸèƒ½å¼ºå¤§
- **JUL**ï¼šJavaè‡ªå¸¦çš„ï¼Œæ¯”è¾ƒç®€å•

**ğŸ’¡ å…¸å‹çš„Javaæ—¥å¿—é•¿è¿™æ ·**
```
2024-09-21 10:30:15.123 INFO  [main] com.example.UserService - ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·IDï¼š12345
2024-09-21 10:30:16.456 ERROR [http-thread-1] com.example.OrderService - åˆ›å»ºè®¢å•å¤±è´¥
java.sql.SQLException: æ•°æ®åº“è¿æ¥è¶…æ—¶
    at com.mysql.jdbc.Driver.connect(Driver.java:123)
    at com.example.OrderService.createOrder(OrderService.java:45)
    at com.example.OrderController.submitOrder(OrderController.java:78)
```

### 2.2 Filebeatæ”¶é›†Javaæ—¥å¿—é…ç½®


**ğŸ”§ åŸºç¡€é…ç½®æ–‡ä»¶**
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/myapp/*.log        # Javaåº”ç”¨æ—¥å¿—è·¯å¾„
  fields:
    app_name: "java-shop"         # åº”ç”¨åç§°æ ‡è¯†
    log_type: "application"       # æ—¥å¿—ç±»å‹
  fields_under_root: true

# å¤šè¡Œé…ç½®ï¼šå¤„ç†Javaå¼‚å¸¸å †æ ˆ
multiline.pattern: '^\d{4}-\d{2}-\d{2}'    # æ—¥æœŸå¼€å¤´çš„æ˜¯æ–°çš„ä¸€è¡Œ
multiline.negate: true                      # ä¸åŒ¹é…çš„è¡Œåˆå¹¶åˆ°ä¸Šä¸€è¡Œ
multiline.match: after                     # åˆå¹¶åˆ°å‰é¢çš„æ—¥å¿—

# è¾“å‡ºåˆ°Elasticsearch
output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-java-app-%{+yyyy.MM.dd}"

# æ—¥å¿—çº§åˆ«ä¿¡æ¯
processors:
- add_host_metadata:
    when.not.contains.tags: forwarded
```

### 2.3 Javaæ—¥å¿—è§£æä¼˜åŒ–


**ğŸ“ æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–**
å»ºè®®Javaåº”ç”¨ä½¿ç”¨è¿™ç§ç»Ÿä¸€æ ¼å¼ï¼š
```
æ—¶é—´æˆ³ æ—¥å¿—çº§åˆ« [çº¿ç¨‹å] ç±»å - æ¶ˆæ¯å†…å®¹

å®ä¾‹ï¼š
2024-09-21 10:30:15.123 INFO  [main] com.example.UserService - ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·IDï¼š12345
```

**âš¡ Filebeatè§£æé…ç½®**
```yaml
processors:
- dissect:
    tokenizer: "%{timestamp} %{level} [%{thread}] %{class} - %{message}"
    field: "message"
    target_prefix: "java"

- timestamp:
    field: java.timestamp
    layouts:
      - '2006-01-02 15:04:05.000'
    test:
      - '2024-09-21 10:30:15.123'
```

---

## 3. ğŸƒ SpringBootæ—¥å¿—é›†æˆ


### 3.1 SpringBootæ—¥å¿—ç‰¹è‰²


**ğŸŒŸ SpringBootæ—¥å¿—ä¼˜åŠ¿**
SpringBootæŠŠæ—¥å¿—é…ç½®ç®€åŒ–äº†å¾ˆå¤šï¼Œå¼€ç®±å³ç”¨ï¼š
- **è‡ªåŠ¨é…ç½®**ï¼šä¸ç”¨å¤æ‚è®¾ç½®å°±èƒ½ç”¨
- **ç»Ÿä¸€æ ¼å¼**ï¼šé»˜è®¤æ ¼å¼å¾ˆè§„èŒƒ
- **é›†æˆè‰¯å¥½**ï¼šå’ŒSpringç”Ÿæ€å®Œç¾ç»“åˆ

**ğŸ“‹ SpringBooté»˜è®¤æ—¥å¿—æ ¼å¼**
```
2024-09-21 10:30:15.123  INFO 12345 --- [           main] c.e.UserController : ç”¨æˆ·æ³¨å†ŒæˆåŠŸ
â”‚                         â”‚     â”‚         â”‚                  â”‚                    â”‚
â””â”€æ—¶é—´æˆ³                   â”‚     â”‚         â”‚                  â”‚                    â””â”€æ¶ˆæ¯å†…å®¹
                          â”‚     â”‚         â”‚                  â””â”€ç±»åï¼ˆç®€åŒ–ï¼‰
                          â”‚     â”‚         â””â”€çº¿ç¨‹å
                          â”‚     â””â”€è¿›ç¨‹ID
                          â””â”€æ—¥å¿—çº§åˆ«
```

### 3.2 SpringBoot + Filebeatå®Œæ•´é…ç½®


**ğŸ”§ SpringBootåº”ç”¨é…ç½®ï¼ˆapplication.ymlï¼‰**
```yaml
logging:
  level:
    com.example: INFO                 # ä¸šåŠ¡åŒ…è®¾ç½®INFOçº§åˆ«
    org.springframework: WARN        # Springæ¡†æ¶è®¾ç½®WARNçº§åˆ«
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} %5p [%t] %c{1} : %m%n"
  file:
    name: /var/log/spring-shop/app.log
    max-size: 100MB                   # å•ä¸ªæ–‡ä»¶æœ€å¤§100MB
    max-history: 30                   # ä¿ç•™30ä¸ªå†å²æ–‡ä»¶
```

**ğŸ“Š å¯¹åº”çš„Filebeaté…ç½®**
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/spring-shop/*.log
  
  # SpringBootç‰¹å®šå­—æ®µ
  fields:
    app_name: "spring-shop"
    framework: "springboot"
    log_type: "application"
  fields_under_root: true
  
  # æ’é™¤ä¸éœ€è¦çš„æ—¥å¿—
  exclude_lines: ['DEBUG', 'TRACE']   # æ’é™¤è°ƒè¯•ä¿¡æ¯
  include_lines: ['ERROR', 'WARN', 'INFO']  # åªæ”¶é›†è¿™äº›çº§åˆ«

# è§£æSpringBootæ—¥å¿—æ ¼å¼
processors:
- dissect:
    tokenizer: "%{timestamp} %{level} [%{thread}] %{class} : %{message}"
    field: "message"
    target_prefix: "spring"

# æ·»åŠ æœ‰ç”¨çš„å…ƒæ•°æ®
- add_docker_metadata:
    host: "unix:///var/run/docker.sock"

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-springboot-%{+yyyy.MM.dd}"
  template.settings:
    index.number_of_shards: 1
    index.number_of_replicas: 0
```

### 3.3 SpringBootæ—¥å¿—æœ€ä½³å®è·µ


**âœ… æ¨èçš„æ—¥å¿—å†™æ³•**
```java
@RestController
public class UserController {
    private static final Logger logger = LoggerFactory.getLogger(UserController.class);
    
    @PostMapping("/register")
    public ResponseEntity<?> register(@RequestBody User user) {
        try {
            // è®°å½•ä¸šåŠ¡æ“ä½œå¼€å§‹
            logger.info("ç”¨æˆ·æ³¨å†Œå¼€å§‹ï¼Œé‚®ç®±ï¼š{}", user.getEmail());
            
            userService.register(user);
            
            // è®°å½•æˆåŠŸ
            logger.info("ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œç”¨æˆ·IDï¼š{}ï¼Œé‚®ç®±ï¼š{}", user.getId(), user.getEmail());
            return ResponseEntity.ok("æ³¨å†ŒæˆåŠŸ");
            
        } catch (Exception e) {
            // è®°å½•é”™è¯¯ï¼ŒåŒ…å«å…³é”®ä¿¡æ¯
            logger.error("ç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼Œé‚®ç®±ï¼š{}ï¼Œé”™è¯¯ï¼š{}", user.getEmail(), e.getMessage(), e);
            return ResponseEntity.status(500).body("æ³¨å†Œå¤±è´¥");
        }
    }
}
```

---

## 4. ğŸ Pythonåº”ç”¨æ—¥å¿—å¤„ç†


### 4.1 Pythonæ—¥å¿—åŸºç¡€


**ğŸ”¸ Pythonæ—¥å¿—æ¨¡å—**
Pythonä½¿ç”¨å†…ç½®çš„`logging`æ¨¡å—ï¼Œç®€å•å¥½ç”¨ï¼š
```python
import logging

# é…ç½®æ—¥å¿—æ ¼å¼
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s %(levelname)s [%(name)s] %(message)s',
    filename='/var/log/python-app/app.log'
)

logger = logging.getLogger('my_app')

# ä½¿ç”¨æ—¥å¿—
logger.info('ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·IDï¼š%s', user_id)
logger.error('æ•°æ®åº“è¿æ¥å¤±è´¥ï¼š%s', str(e))
```

**ğŸ’¡ Pythonæ—¥å¿—æ ·ä¾‹**
```
2024-09-21 10:30:15,123 INFO [my_app.user_service] ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·IDï¼š12345
2024-09-21 10:30:16,456 ERROR [my_app.order_service] åˆ›å»ºè®¢å•å¤±è´¥ï¼šæ•°æ®åº“è¿æ¥è¶…æ—¶
Traceback (most recent call last):
  File "order_service.py", line 45, in create_order
    db.execute(sql)
  File "database.py", line 123, in execute
    raise ConnectionError("æ•°æ®åº“è¿æ¥è¶…æ—¶")
ConnectionError: æ•°æ®åº“è¿æ¥è¶…æ—¶
```

### 4.2 Pythonæ—¥å¿—Filebeaté…ç½®


**ğŸ”§ Pythonåº”ç”¨æ—¥å¿—æ”¶é›†é…ç½®**
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/python-app/*.log
  
  fields:
    app_name: "python-shop"
    language: "python"
    log_type: "application"
  fields_under_root: true

  # Pythonå¤šè¡Œå¼‚å¸¸å¤„ç†
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after
  multiline.max_lines: 500           # æœ€å¤šåˆå¹¶500è¡Œï¼ˆé˜²æ­¢è¶…å¤§å¼‚å¸¸ï¼‰

processors:
- dissect:
    tokenizer: "%{timestamp} %{level} [%{module}] %{message}"
    field: "message"
    target_prefix: "python"

- script:
    lang: javascript
    source: >
      function(event) {
        var msg = event.Get("python.message");
        if (msg && msg.includes("Traceback")) {
          event.Put("python.has_exception", true);
          event.Put("python.log_type", "exception");
        }
      }

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-python-%{+yyyy.MM.dd}"
```

---

## 5. ğŸ“„ ç»“æ„åŒ–æ—¥å¿—å¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯ç»“æ„åŒ–æ—¥å¿—


**ğŸ”¸ ç»“æ„åŒ–æ—¥å¿—çš„ä¼˜åŠ¿**
ä¼ ç»Ÿæ—¥å¿—æ˜¯ä¸€è¡Œæ–‡æœ¬ï¼Œç»“æ„åŒ–æ—¥å¿—æ˜¯JSONæ ¼å¼ï¼Œæ›´å®¹æ˜“åˆ†æï¼š

```
ä¼ ç»Ÿæ—¥å¿—ï¼ˆéš¾åˆ†æï¼‰ï¼š
2024-09-21 10:30:15 INFO ç”¨æˆ·12345ç™»å½•æˆåŠŸï¼ŒIPï¼š192.168.1.100ï¼Œè€—æ—¶ï¼š150ms

ç»“æ„åŒ–æ—¥å¿—ï¼ˆæ˜“åˆ†æï¼‰ï¼š
{
  "timestamp": "2024-09-21T10:30:15.123Z",
  "level": "INFO",
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "user_id": 12345,
  "client_ip": "192.168.1.100",
  "response_time": 150
}
```

### 5.2 JSONæ ¼å¼æ—¥å¿—é…ç½®


**ğŸ“Š Javaåº”ç”¨è¾“å‡ºJSONæ—¥å¿—**
```java
// ä½¿ç”¨Logback JSON encoder
<configuration>
    <appender name="FILE" class="ch.qos.logback.core.FileAppender">
        <file>/var/log/myapp/app-json.log</file>
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <logLevel/>
                <loggerName/>
                <message/>
                <mdc/>
                <arguments/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>
    
    <root level="INFO">
        <appender-ref ref="FILE" />
    </root>
</configuration>
```

**ğŸ”§ Filebeatå¤„ç†JSONæ—¥å¿—**
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/myapp/app-json.log
  
  # è‡ªåŠ¨è§£æJSON
  json.keys_under_root: true          # JSONå­—æ®µæ”¾åˆ°æ ¹çº§åˆ«
  json.add_error_key: true            # è§£æå¤±è´¥æ—¶æ·»åŠ é”™è¯¯ä¿¡æ¯
  json.message_key: message           # æŒ‡å®šæ¶ˆæ¯å­—æ®µ

  fields:
    app_name: "json-app"
    log_format: "json"
  fields_under_root: true

processors:
# æ—¶é—´æˆ³å¤„ç†
- timestamp:
    field: timestamp
    layouts:
      - '2006-01-02T15:04:05.000Z'
    test:
      - '2024-09-21T10:30:15.123Z'

# æ¸…ç†ä¸éœ€è¦çš„å­—æ®µ
- drop_fields:
    fields: ["host", "agent", "ecs", "input"]

output.elasticsearch:
  hosts: ["localhost:9200"]
  index: "filebeat-json-app-%{+yyyy.MM.dd}"
```

### 5.3 ç»“æ„åŒ–æ—¥å¿—æœ€ä½³å®è·µ


**âœ… æ¨èçš„JSONæ—¥å¿—ç»“æ„**
```json
{
  "timestamp": "2024-09-21T10:30:15.123Z",
  "level": "INFO",
  "service": "user-service",
  "trace_id": "abc123def456",           // é“¾è·¯è¿½è¸ªID
  "user_id": 12345,                    // ä¸šåŠ¡ç›¸å…³ID
  "action": "user_login",              // ä¸šåŠ¡åŠ¨ä½œ
  "result": "success",                 // æ“ä½œç»“æœ
  "response_time": 150,                // å“åº”æ—¶é—´
  "client_ip": "192.168.1.100",       // å®¢æˆ·ç«¯IP
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ"              // äººç±»å¯è¯»çš„æ¶ˆæ¯
}
```

---

## 6. âš ï¸ å¼‚å¸¸æ—¥å¿—ä¸å¤šè¡Œå¤„ç†


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šè¡Œå¤„ç†


**ğŸ”¸ å¤šè¡Œæ—¥å¿—çš„æŒ‘æˆ˜**
ç¨‹åºå¼‚å¸¸æ—¶ä¼šäº§ç”Ÿ"å †æ ˆä¿¡æ¯"ï¼Œé€šå¸¸è·¨è¶Šå¤šè¡Œï¼š
```
2024-09-21 10:30:15 ERROR OrderService - åˆ›å»ºè®¢å•å¤±è´¥
java.sql.SQLException: æ•°æ®åº“è¿æ¥è¶…æ—¶
    at com.mysql.jdbc.Driver.connect(Driver.java:123)
    at com.example.OrderService.createOrder(OrderService.java:45)
    at com.example.OrderController.submitOrder(OrderController.java:78)
```

å¦‚æœä¸é…ç½®å¤šè¡Œå¤„ç†ï¼ŒFilebeatä¼šæŠŠæ¯ä¸€è¡Œå½“æˆç‹¬ç«‹çš„æ—¥å¿—ï¼Œå°±ä¹±å¥—äº†ã€‚

### 6.2 å¤šè¡Œé…ç½®è¯¦è§£


**ğŸ“‹ å¤šè¡Œé…ç½®çš„ä¸‰ä¸ªå…³é”®å‚æ•°**

```yaml
multiline.pattern: '^\d{4}-\d{2}-\d{2}'    # æ­£åˆ™è¡¨è¾¾å¼ï¼šåŒ¹é…æ—¥æœŸå¼€å¤´
multiline.negate: true                      # å–åï¼šä¸åŒ¹é…çš„è¡Œè¦å¤„ç†
multiline.match: after                     # åˆå¹¶ä½ç½®ï¼šåˆå¹¶åˆ°å‰ä¸€æ¡æ—¥å¿—
```

**ğŸ’¡ é€šä¿—ç†è§£**
- `pattern`ï¼šä»€ä¹ˆæ ·çš„è¡Œæ˜¯"æ–°æ—¥å¿—çš„å¼€å§‹"
- `negate: true`ï¼šä¸æ˜¯æ–°å¼€å§‹çš„è¡Œï¼Œå°±åˆå¹¶èµ·æ¥
- `match: after`ï¼šåˆå¹¶åˆ°å‰é¢é‚£æ¡æ—¥å¿—é‡Œ

### 6.3 ä¸åŒè¯­è¨€çš„å¤šè¡Œé…ç½®


**â˜• Javaå¼‚å¸¸å¤„ç†**
```yaml
# Javaå †æ ˆè·Ÿè¸ª
multiline.pattern: '^\d{4}-\d{2}-\d{2}'     # æ—¥æœŸå¼€å¤´æ˜¯æ–°æ—¥å¿—
multiline.negate: true
multiline.match: after
multiline.max_lines: 500                    # æœ€å¤š500è¡Œï¼ˆé˜²æ­¢è¶…å¤§å¼‚å¸¸ï¼‰
multiline.timeout: 5s                       # 5ç§’è¶…æ—¶
```

**ğŸ Pythonå¼‚å¸¸å¤„ç†**
```yaml
# Python Traceback
multiline.pattern: '^Traceback|^\d{4}-\d{2}-\d{2}'
multiline.negate: false
multiline.match: after
multiline.max_lines: 200
```

**ğŸ”§ é€šç”¨å¼‚å¸¸å¤„ç†é…ç½®**
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/apps/*.log
  
  # å¤šè¡Œå¼‚å¸¸å¤„ç†
  multiline.pattern: '^\d{4}-\d{2}-\d{2}|\d{4}/\d{2}/\d{2}'
  multiline.negate: true
  multiline.match: after
  multiline.max_lines: 1000
  multiline.timeout: 10s

processors:
# æ£€æµ‹å¼‚å¸¸æ—¥å¿—
- script:
    lang: javascript
    source: >
      function(event) {
        var message = event.Get("message");
        if (message.includes("Exception") || 
            message.includes("Error") || 
            message.includes("Traceback")) {
          event.Put("log_type", "exception");
          event.Put("severity", "high");
        }
      }
```

---

## 7. ğŸ¯ æ—¥å¿—çº§åˆ«è¿‡æ»¤ä¸å­—æ®µæ˜ å°„


### 7.1 æ—¥å¿—çº§åˆ«è¿‡æ»¤ç­–ç•¥


**ğŸ“Š ä¸åŒç¯å¢ƒçš„è¿‡æ»¤ç­–ç•¥**

```
ç”Ÿäº§ç¯å¢ƒæ—¥å¿—æ”¶é›†ç­–ç•¥ï¼š

é«˜ä¼˜å…ˆçº§ï¼ˆå¿…æ”¶ï¼‰          ä¸­ä¼˜å…ˆçº§ï¼ˆé€‰æ”¶ï¼‰          ä½ä¼˜å…ˆçº§ï¼ˆä¸æ”¶ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR       â”‚ 100%   â”‚ WARN        â”‚ 50%    â”‚ DEBUG       â”‚ 0%
â”‚ FATAL       â”‚ 100%   â”‚ INFO        â”‚ 30%    â”‚ TRACE       â”‚ 0%
â”‚ å¼‚å¸¸å †æ ˆ     â”‚ 100%   â”‚ ä¸šåŠ¡æ“ä½œ     â”‚ 30%    â”‚ å¼€å‘è°ƒè¯•     â”‚ 0%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ çº§åˆ«è¿‡æ»¤é…ç½®**
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/myapp/*.log
  
  # åªæ”¶é›†é‡è¦çº§åˆ«çš„æ—¥å¿—
  include_lines: [' ERROR ', ' FATAL ', ' WARN ']
  exclude_lines: [' DEBUG ', ' TRACE ']
  
  # æˆ–è€…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
  include_lines: ['.*\s(ERROR|FATAL|WARN)\s.*']

processors:
# æ ¹æ®æ—¥å¿—çº§åˆ«æ·»åŠ æ ‡ç­¾
- script:
    lang: javascript
    source: >
      function(event) {
        var message = event.Get("message");
        if (message.includes(" ERROR ")) {
          event.Put("log_level", "error");
          event.Put("priority", "high");
        } else if (message.includes(" WARN ")) {
          event.Put("log_level", "warn");
          event.Put("priority", "medium");
        } else if (message.includes(" INFO ")) {
          event.Put("log_level", "info");
          event.Put("priority", "low");
        }
      }
```

### 7.2 å­—æ®µæ˜ å°„ä¸è§„èŒƒåŒ–


**ğŸ—‚ï¸ ç»Ÿä¸€å­—æ®µæ˜ å°„**
ä¸åŒåº”ç”¨çš„æ—¥å¿—æ ¼å¼å¯èƒ½ä¸åŒï¼Œéœ€è¦æ˜ å°„åˆ°ç»Ÿä¸€çš„å­—æ®µï¼š

```yaml
processors:
# æå–å…¬å…±å­—æ®µ
- dissect:
    tokenizer: "%{timestamp} %{level} [%{thread}] %{class} - %{message}"
    field: "message"

# å­—æ®µé‡å‘½åå’Œæ˜ å°„
- rename:
    fields:
      - from: "level"
        to: "log_level"
      - from: "class"
        to: "source_class"
      - from: "thread"
        to: "thread_name"

# æ·»åŠ åº”ç”¨é€šç”¨å­—æ®µ
- add_fields:
    target: "app"
    fields:
      name: "my-application"
      version: "1.0.0"
      environment: "production"

# å­—æ®µç±»å‹è½¬æ¢
- convert:
    fields:
      - {from: "response_time", to: "response_time_ms", type: "integer"}
      - {from: "user_id", to: "user_id", type: "long"}
```

**ğŸ“‹ æ ‡å‡†åŒ–å­—æ®µç»“æ„**
```yaml
# æ¨èçš„æ ‡å‡†å­—æ®µç»“æ„
{
  "@timestamp": "2024-09-21T10:30:15.123Z",      # æ ‡å‡†æ—¶é—´æˆ³
  "log_level": "ERROR",                          # ç»Ÿä¸€æ—¥å¿—çº§åˆ«
  "message": "ç”¨æˆ·ç™»å½•å¤±è´¥",                      # åŸå§‹æ¶ˆæ¯
  "app": {
    "name": "user-service",                      # åº”ç”¨åç§°
    "version": "1.2.3",                         # åº”ç”¨ç‰ˆæœ¬
    "environment": "production"                  # è¿è¡Œç¯å¢ƒ
  },
  "user": {
    "id": 12345,                                # ç”¨æˆ·ID
    "email": "user@example.com"                 # ç”¨æˆ·é‚®ç®±
  },
  "request": {
    "id": "req-abc123",                         # è¯·æ±‚ID
    "method": "POST",                           # HTTPæ–¹æ³•
    "url": "/api/login",                        # è¯·æ±‚è·¯å¾„
    "ip": "192.168.1.100"                      # å®¢æˆ·ç«¯IP
  },
  "response": {
    "status": 401,                              # å“åº”çŠ¶æ€ç 
    "time_ms": 150                              # å“åº”æ—¶é—´
  }
}
```

---

## 8. ğŸš¨ åº”ç”¨é”™è¯¯ç›‘æ§å®æˆ˜


### 8.1 é”™è¯¯ç›‘æ§æŒ‡æ ‡


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

```
é”™è¯¯ç›‘æ§é‡‘å­—å¡”ï¼š

                    ğŸ”´ è‡´å‘½é”™è¯¯
                   /           \
                 ç³»ç»Ÿå´©æºƒ       æ•°æ®ä¸¢å¤±
               /       \     /       \
           âš ï¸ é‡è¦é”™è¯¯                 ğŸŸ¡ ä¸€èˆ¬é”™è¯¯
          /    |    \                /    |    \
     æœåŠ¡è¶…æ—¶ æ•°æ®åº“å¼‚å¸¸ ç¬¬ä¸‰æ–¹æ¥å£å¼‚å¸¸   ä¸šåŠ¡é€»è¾‘é”™è¯¯ å‚æ•°éªŒè¯å¤±è´¥
```

| ç›‘æ§çº§åˆ« | **é˜ˆå€¼è®¾ç½®** | **å‘Šè­¦æ–¹å¼** | **å¤„ç†æ—¶é—´** |
|---------|-------------|-------------|-------------|
| ğŸ”´ **è‡´å‘½** | `é”™è¯¯ç‡>5%` | `ç«‹å³ç”µè¯+çŸ­ä¿¡` | `5åˆ†é’Ÿå†…` |
| âš ï¸ **é‡è¦** | `é”™è¯¯ç‡>2%` | `é‚®ä»¶+é’‰é’‰` | `30åˆ†é’Ÿå†…` |
| ğŸŸ¡ **ä¸€èˆ¬** | `é”™è¯¯ç‡>1%` | `é‚®ä»¶` | `2å°æ—¶å†…` |

### 8.2 é”™è¯¯æ”¶é›†ä¸åˆ†æé…ç½®


**ğŸ”§ é”™è¯¯æ—¥å¿—ä¸“é¡¹æ”¶é›†**
```yaml
filebeat.inputs:
# æ™®é€šåº”ç”¨æ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/myapp/app.log
  include_lines: [' INFO ', ' WARN ']
  fields:
    log_type: "normal"
    index_template: "app-normal"

# é”™è¯¯æ—¥å¿—ä¸“é—¨æ”¶é›†
- type: log
  enabled: true
  paths:
    - /var/log/myapp/app.log
  include_lines: [' ERROR ', ' FATAL ', 'Exception', 'Error']
  fields:
    log_type: "error"
    index_template: "app-error"
    priority: "high"
  
  # é”™è¯¯æ—¥å¿—å¤šè¡Œå¤„ç†
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after
  multiline.max_lines: 1000

processors:
# é”™è¯¯åˆ†ç±»å¤„ç†
- script:
    lang: javascript
    source: >
      function(event) {
        var message = event.Get("message");
        var errorType = "unknown";
        
        // æ•°æ®åº“é”™è¯¯
        if (message.includes("SQLException") || message.includes("database")) {
          errorType = "database";
        }
        // ç½‘ç»œé”™è¯¯
        else if (message.includes("timeout") || message.includes("connection")) {
          errorType = "network";
        }
        // ä¸šåŠ¡é€»è¾‘é”™è¯¯
        else if (message.includes("BusinessException")) {
          errorType = "business";
        }
        // ç³»ç»Ÿé”™è¯¯
        else if (message.includes("OutOfMemoryError") || message.includes("StackOverflow")) {
          errorType = "system";
        }
        
        event.Put("error_type", errorType);
        
        // é”™è¯¯ä¸¥é‡çº§åˆ«
        if (message.includes("FATAL") || message.includes("OutOfMemoryError")) {
          event.Put("severity", "critical");
        } else if (message.includes("ERROR")) {
          event.Put("severity", "high");
        } else {
          event.Put("severity", "medium");
        }
      }

# è¾“å‡ºåˆ°ä¸åŒç´¢å¼•
output.elasticsearch:
  hosts: ["localhost:9200"]
  indices:
    - index: "app-error-%{+yyyy.MM.dd}"
      when.equals:
        log_type: "error"
    - index: "app-normal-%{+yyyy.MM.dd}"
      when.equals:
        log_type: "normal"
```

### 8.3 å®æ—¶é”™è¯¯å‘Šè­¦é…ç½®


**ğŸš¨ Elasticsearchå‘Šè­¦è§„åˆ™**
```json
{
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "search_type": "query_then_fetch",
        "indices": ["app-error-*"],
        "body": {
          "query": {
            "bool": {
              "must": [
                {
                  "range": {
                    "@timestamp": {
                      "gte": "now-5m"
                    }
                  }
                },
                {
                  "term": {
                    "severity": "critical"
                  }
                }
              ]
            }
          },
          "aggs": {
            "error_count": {
              "cardinality": {
                "field": "_id"
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "compare": {
      "ctx.payload.aggregations.error_count.value": {
        "gt": 5
      }
    }
  },
  "actions": {
    "send_email": {
      "email": {
        "to": ["admin@company.com"],
        "subject": "ä¸¥é‡é”™è¯¯å‘Šè­¦ï¼š5åˆ†é’Ÿå†…å‘ç”Ÿ{{ctx.payload.aggregations.error_count.value}}æ¬¡ä¸¥é‡é”™è¯¯",
        "body": "è¯·ç«‹å³æ£€æŸ¥åº”ç”¨çŠ¶æ€"
      }
    }
  }
}
```

**ğŸ“± å‘Šè­¦å¤„ç†æµç¨‹**
```
é”™è¯¯å‘ç”Ÿ â†’ Filebeatæ”¶é›† â†’ Elasticsearchå­˜å‚¨ â†’ å‘Šè­¦è§„åˆ™è§¦å‘ â†’ é€šçŸ¥ç›¸å…³äººå‘˜

å‘Šè­¦å¤„ç†æ­¥éª¤ï¼š
1ï¸âƒ£ æ”¶åˆ°å‘Šè­¦é€šçŸ¥
2ï¸âƒ£ ç™»å½•KibanaæŸ¥çœ‹é”™è¯¯è¯¦æƒ…  
3ï¸âƒ£ åˆ†æé”™è¯¯ç±»å‹å’Œå½±å“èŒƒå›´
4ï¸âƒ£ æ ¹æ®é”™è¯¯ç±»å‹é‡‡å–ç›¸åº”æªæ–½
5ï¸âƒ£ ä¿®å¤é—®é¢˜åç¡®è®¤å‘Šè­¦è§£é™¤
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åº”ç”¨æ—¥å¿—ç±»å‹ï¼šè®¿é—®æ—¥å¿—ã€ä¸šåŠ¡æ—¥å¿—ã€é”™è¯¯æ—¥å¿—ä¸‰å¤§ç±»
ğŸ”¸ æ—¥å¿—æ ¼å¼ï¼šä¼ ç»Ÿæ–‡æœ¬æ ¼å¼ vs JSONç»“æ„åŒ–æ ¼å¼
ğŸ”¸ å¤šè¡Œå¤„ç†ï¼šJava/Pythonå¼‚å¸¸å †æ ˆçš„æ­£ç¡®æ”¶é›†æ–¹å¼
ğŸ”¸ çº§åˆ«è¿‡æ»¤ï¼šç”Ÿäº§ç¯å¢ƒåªæ”¶é›†é‡è¦çº§åˆ«çš„æ—¥å¿—
ğŸ”¸ å­—æ®µæ˜ å°„ï¼šç»Ÿä¸€ä¸åŒåº”ç”¨çš„æ—¥å¿—å­—æ®µç»“æ„
ğŸ”¸ é”™è¯¯ç›‘æ§ï¼šå»ºç«‹åˆ†çº§å‘Šè­¦æœºåˆ¶ï¼Œå¿«é€Ÿå“åº”é—®é¢˜
```

### 9.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ Javaåº”ç”¨æ—¥å¿—æ”¶é›†**
```yaml
# æ ¸å¿ƒé…ç½®è¦ç‚¹
multiline.pattern: '^\d{4}-\d{2}-\d{2}'    # å¤„ç†å¼‚å¸¸å †æ ˆ
include_lines: ['ERROR', 'WARN', 'INFO']    # è¿‡æ»¤æ—¥å¿—çº§åˆ«
dissectå¤„ç†å™¨: è§£ææ—¥å¿—æ ¼å¼                   # ç»“æ„åŒ–æ—¥å¿—å†…å®¹
```

**ğŸ”¹ SpringBootæ—¥å¿—æœ€ä½³å®è·µ**
```yaml
# é…ç½®å»ºè®®
- ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼
- åˆç†è®¾ç½®æ—¥å¿—çº§åˆ«è¿‡æ»¤
- æ·»åŠ åº”ç”¨æ ‡è¯†å­—æ®µ
- é…ç½®æ—¥å¿—è½®è½¬é¿å…æ–‡ä»¶è¿‡å¤§
```

**ğŸ”¹ Pythonåº”ç”¨ç‰¹æ®Šå¤„ç†**
```yaml
# Pythonç‰¹ç‚¹
multilineå¤„ç†: é‡ç‚¹å¤„ç†Tracebackå¼‚å¸¸
ç¼–ç é—®é¢˜: æ³¨æ„ä¸­æ–‡å­—ç¬¦å¤„ç†
æ¨¡å—è¯†åˆ«: é€šè¿‡æ—¥å¿—æ ¼å¼è¯†åˆ«Pythonæ¨¡å—
```

### 9.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**âœ… æ¨èçš„é…ç½®ç­–ç•¥**
- **åˆ†çº§æ”¶é›†**ï¼šé‡è¦é”™è¯¯å…¨æ”¶é›†ï¼Œä¸€èˆ¬ä¿¡æ¯é‡‡æ ·æ”¶é›†
- **ç´¢å¼•åˆ†ç¦»**ï¼šé”™è¯¯æ—¥å¿—å’Œæ™®é€šæ—¥å¿—åˆ†å¼€å­˜å‚¨
- **å­—æ®µæ ‡å‡†åŒ–**ï¼šç»Ÿä¸€å­—æ®µå‘½åå’Œæ ¼å¼è§„èŒƒ
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹å¤šçº§å‘Šè­¦æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†é…ç½®ç¼“å†²åŒºå’Œæ‰¹é‡å‘é€

**ğŸš¨ å¸¸è§é—®é¢˜é¿å…**
- **è¿‡åº¦æ”¶é›†**ï¼šä¸è¦æ”¶é›†DEBUGå’ŒTRACEçº§åˆ«æ—¥å¿—
- **æ ¼å¼æ··ä¹±**ï¼šç»Ÿä¸€åº”ç”¨çš„æ—¥å¿—è¾“å‡ºæ ¼å¼
- **å¼‚å¸¸ä¸¢å¤±**ï¼šæ­£ç¡®é…ç½®å¤šè¡Œå¤„ç†é¿å…å †æ ˆä¿¡æ¯ä¸¢å¤±
- **å­˜å‚¨æµªè´¹**ï¼šåˆç†è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é—´å’Œç´¢å¼•å¤§å°

### 9.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åº”ç”¨åœºæ™¯**
- **æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½åº”ç”¨é—®é¢˜åŸå› 
- **æ€§èƒ½ç›‘æ§**ï¼šåˆ†æåº”ç”¨å“åº”æ—¶é—´å’Œååé‡
- **ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼šäº†è§£ç”¨æˆ·æ“ä½œä¹ æƒ¯
- **å®‰å…¨å®¡è®¡**ï¼šè¿½è¸ªå¼‚å¸¸è®¿é—®å’Œæ“ä½œè®°å½•

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**
- **è‡ªåŠ¨åŒ–ç›‘æ§**ï¼šå‡å°‘äººå·¥ç›‘æ§å·¥ä½œé‡
- **é¢„è­¦æœºåˆ¶**ï¼šæå‰å‘ç°æ½œåœ¨é—®é¢˜
- **æ•°æ®åˆ†æ**ï¼šä¸ºä¸šåŠ¡å†³ç­–æä¾›æ•°æ®æ”¯æŒ
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³å®¡è®¡å’Œåˆè§„æ€§è¦æ±‚

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- åº”ç”¨æ—¥å¿—æ”¶é›†é‡åœ¨é…ç½®å¤šè¡Œå¤„ç†å’Œçº§åˆ«è¿‡æ»¤
- Java/SpringBooté‡ç‚¹å¤„ç†å¼‚å¸¸å †æ ˆå’Œç»Ÿä¸€æ ¼å¼
- Pythonåº”ç”¨æ³¨æ„Tracebackå’Œç¼–ç é—®é¢˜
- ç»“æ„åŒ–æ—¥å¿—ï¼ˆJSONï¼‰æ›´åˆ©äºåç»­åˆ†æå¤„ç†
- é”™è¯¯ç›‘æ§å»ºç«‹åˆ†çº§å‘Šè­¦ï¼Œå¿«é€Ÿå“åº”é—®é¢˜
- ç”Ÿäº§ç¯å¢ƒè¦å¹³è¡¡æ”¶é›†å®Œæ•´æ€§å’Œå­˜å‚¨æˆæœ¬