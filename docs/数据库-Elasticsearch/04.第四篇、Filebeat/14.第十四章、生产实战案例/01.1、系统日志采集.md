---
title: 1ã€ç³»ç»Ÿæ—¥å¿—é‡‡é›†
---
## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ—¥å¿—é‡‡é›†æ¦‚è¿°](#1-ç³»ç»Ÿæ—¥å¿—é‡‡é›†æ¦‚è¿°)
2. [Linuxç³»ç»Ÿæ—¥å¿—åŸºç¡€](#2-Linuxç³»ç»Ÿæ—¥å¿—åŸºç¡€)
3. [Filebeat Systemæ¨¡å—è¯¦è§£](#3-Filebeat-Systemæ¨¡å—è¯¦è§£)
4. [ç³»ç»Ÿæ¶ˆæ¯æ—¥å¿—é‡‡é›†](#4-ç³»ç»Ÿæ¶ˆæ¯æ—¥å¿—é‡‡é›†)
5. [å®‰å…¨æ—¥å¿—ç›‘æ§å®æˆ˜](#5-å®‰å…¨æ—¥å¿—ç›‘æ§å®æˆ˜)
6. [å®¡è®¡ä¸ç™»å½•æ—¥å¿—åˆ†æ](#6-å®¡è®¡ä¸ç™»å½•æ—¥å¿—åˆ†æ)
7. [å­—æ®µç»“æ„åŒ–å¤„ç†](#7-å­—æ®µç»“æ„åŒ–å¤„ç†)
8. [ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ](#8-ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç³»ç»Ÿæ—¥å¿—é‡‡é›†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç³»ç»Ÿæ—¥å¿—é‡‡é›†


**ç®€å•ç†è§£**ï¼šç³»ç»Ÿæ—¥å¿—é‡‡é›†å°±åƒç»™æœåŠ¡å™¨å®‰è£…ä¸€ä¸ª"ç›‘æ§æ‘„åƒå¤´"ï¼Œä¸“é—¨è®°å½•æœåŠ¡å™¨å‘ç”Ÿçš„å„ç§äº‹ä»¶ã€‚

```
æƒ³è±¡ä¸€ä¸‹åŒ»é™¢çš„ç—…å†è®°å½•ï¼š
åŒ»ç”Ÿè®°å½• â†’ ç—…å†æœ¬ â†’ ç»Ÿä¸€ç®¡ç†
ç³»ç»Ÿäº‹ä»¶ â†’ æ—¥å¿—æ–‡ä»¶ â†’ Filebeaté‡‡é›† â†’ Elasticsearchå­˜å‚¨
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **æ•…éšœæ’æŸ¥**ï¼šç³»ç»Ÿå‡ºé—®é¢˜æ—¶ï¼Œæ—¥å¿—æ˜¯ç¬¬ä¸€æ‰‹è¯æ®
- ğŸ”¸ **å®‰å…¨ç›‘æ§**ï¼šå‘ç°å¼‚å¸¸ç™»å½•ã€æ”»å‡»è¡Œä¸º
- ğŸ”¸ **æ€§èƒ½åˆ†æ**ï¼šäº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶å†µ
- ğŸ”¸ **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³ä¼ä¸šåˆè§„è¦æ±‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—é‡‡é›†


**ä¼ ç»Ÿé—®é¢˜**ï¼š
```
æœåŠ¡å™¨Aï¼šæ—¥å¿—åœ¨ /var/log/messages
æœåŠ¡å™¨Bï¼šæ—¥å¿—åœ¨ /var/log/secure  
æœåŠ¡å™¨Cï¼šæ—¥å¿—åœ¨ /var/log/audit.log

é—®é¢˜ï¼š
âŒ åˆ†æ•£å­˜å‚¨ï¼ŒæŸ¥æ‰¾å›°éš¾
âŒ æ ¼å¼ä¸ç»Ÿä¸€ï¼Œåˆ†æå¤æ‚
âŒ æ‰‹å·¥æŸ¥çœ‹ï¼Œæ•ˆç‡ä½ä¸‹
âŒ æ—¥å¿—ä¸¢å¤±ï¼Œæ— æ³•è¿½æº¯
```

**Filebeatè§£å†³æ–¹æ¡ˆ**ï¼š
```
ç»Ÿä¸€é‡‡é›†æµç¨‹ï¼š
å„æœåŠ¡å™¨æ—¥å¿— â†’ Filebeaté‡‡é›† â†’ æ ¼å¼åŒ–å¤„ç† â†’ Elasticsearchå­˜å‚¨ â†’ Kibanaå¯è§†åŒ–

ä¼˜åŠ¿ï¼š
âœ… é›†ä¸­ç®¡ç†ï¼Œä¸€ç«™å¼æŸ¥çœ‹
âœ… æ ¼å¼æ ‡å‡†åŒ–ï¼Œä¾¿äºåˆ†æ
âœ… å®æ—¶ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
âœ… é•¿æœŸå­˜å‚¨ï¼Œå†å²æ•°æ®å¯æŸ¥
```

### 1.3 ç³»ç»Ÿæ—¥å¿—é‡‡é›†æ¶æ„å›¾


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LinuxæœåŠ¡å™¨   â”‚    â”‚   Filebeat   â”‚    â”‚ Elasticsearch   â”‚
â”‚                 â”‚    â”‚              â”‚    â”‚     é›†ç¾¤        â”‚
â”‚ /var/log/       â”‚â”€â”€â”€â–¶â”‚ Systemæ¨¡å—   â”‚â”€â”€â”€â–¶â”‚                 â”‚
â”‚ â”œâ”€messages      â”‚    â”‚ â”œâ”€syslog     â”‚    â”‚ ç´¢å¼•ï¼š           â”‚
â”‚ â”œâ”€secure        â”‚    â”‚ â”œâ”€auth       â”‚    â”‚ filebeat-*      â”‚
â”‚ â”œâ”€audit.log     â”‚    â”‚ â””â”€audit      â”‚    â”‚                 â”‚
â”‚ â””â”€cron          â”‚    â”‚              â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                       â”‚
                              â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   Logstash   â”‚    â”‚     Kibana      â”‚
                       â”‚   (å¯é€‰)      â”‚    â”‚   å¯è§†åŒ–ç•Œé¢     â”‚
                       â”‚  æ•°æ®å¤„ç†     â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“‹ Linuxç³»ç»Ÿæ—¥å¿—åŸºç¡€


### 2.1 ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶åˆ†å¸ƒ


**ä¸»è¦æ—¥å¿—æ–‡ä»¶ä½ç½®**ï¼š

| æ—¥å¿—æ–‡ä»¶ | **ä½œç”¨è¯´æ˜** | **å†…å®¹ç¤ºä¾‹** |
|---------|------------|-------------|
| ğŸ“„ **/var/log/messages** | `ç³»ç»Ÿä¸»è¦æ¶ˆæ¯æ—¥å¿—` | `å†…æ ¸æ¶ˆæ¯ã€ç³»ç»ŸæœåŠ¡çŠ¶æ€` |
| ğŸ”’ **/var/log/secure** | `å®‰å…¨è®¤è¯æ—¥å¿—` | `SSHç™»å½•ã€sudoæ“ä½œ` |
| ğŸ•µï¸ **/var/log/audit/audit.log** | `ç³»ç»Ÿå®¡è®¡æ—¥å¿—` | `æ–‡ä»¶è®¿é—®ã€æƒé™å˜æ›´` |
| â° **/var/log/cron** | `å®šæ—¶ä»»åŠ¡æ—¥å¿—` | `crontabæ‰§è¡Œè®°å½•` |
| ğŸŒ **/var/log/httpd/** | `Apache WebæœåŠ¡å™¨æ—¥å¿—` | `è®¿é—®æ—¥å¿—ã€é”™è¯¯æ—¥å¿—` |
| ğŸ“¨ **/var/log/maillog** | `é‚®ä»¶ç³»ç»Ÿæ—¥å¿—` | `é‚®ä»¶å‘é€æ¥æ”¶è®°å½•` |

### 2.2 syslogç³»ç»Ÿå·¥ä½œåŸç†


**syslogç®€å•ç†è§£**ï¼šå°±åƒé‚®å±€åˆ†æ‹£ç³»ç»Ÿï¼ŒæŠŠä¸åŒç±»å‹çš„ä¿¡ä»¶åˆ†ç±»æŠ•é€’åˆ°ä¸åŒçš„ä¿¡ç®±ã€‚

```
åº”ç”¨ç¨‹åºäº§ç”Ÿæ—¥å¿— â†’ syslogå®ˆæŠ¤è¿›ç¨‹ â†’ æ ¹æ®è§„åˆ™åˆ†ç±» â†’ å†™å…¥å¯¹åº”æ—¥å¿—æ–‡ä»¶

åˆ†ç±»è§„åˆ™ç¤ºä¾‹ï¼š
- å†…æ ¸æ¶ˆæ¯     â†’ /var/log/messages
- è®¤è¯æ¶ˆæ¯     â†’ /var/log/secure  
- é‚®ä»¶æ¶ˆæ¯     â†’ /var/log/maillog
- å®šæ—¶ä»»åŠ¡     â†’ /var/log/cron
```

**æ—¥å¿—æ ¼å¼ç»“æ„**ï¼š
```
æ ‡å‡†syslogæ ¼å¼ï¼š
æ—¶é—´æˆ³ ä¸»æœºå ç¨‹åºå[è¿›ç¨‹ID]: æ¶ˆæ¯å†…å®¹

å®é™…ç¤ºä¾‹ï¼š
Dec 21 10:30:15 web01 sshd[12345]: Accepted password for admin from 192.168.1.100
â”‚              â”‚     â”‚           â”‚
æ—¶é—´            ä¸»æœº   ç¨‹åº        å…·ä½“æ¶ˆæ¯
```

### 2.3 æ—¥å¿—çº§åˆ«ä¸è®¾æ–½


**æ—¥å¿—çº§åˆ«**ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
- ğŸ”´ **emerg**ï¼šç³»ç»Ÿæ— æ³•ä½¿ç”¨
- ğŸŸ  **alert**ï¼šéœ€è¦ç«‹å³å¤„ç†  
- ğŸŸ¡ **crit**ï¼šä¸¥é‡é”™è¯¯
- ğŸŸ¢ **err**ï¼šä¸€èˆ¬é”™è¯¯
- ğŸ”µ **warning**ï¼šè­¦å‘Šä¿¡æ¯
- âšª **notice**ï¼šæ­£å¸¸ä½†é‡è¦
- âš« **info**ï¼šä¿¡æ¯æ€§æ¶ˆæ¯
- ğŸ”˜ **debug**ï¼šè°ƒè¯•ä¿¡æ¯

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼šçº§åˆ«è¶Šé«˜ï¼Œé—®é¢˜è¶Šä¸¥é‡ï¼Œå°±åƒåŒ»é™¢çš„æ€¥è¯Šåˆ†çº§ä¸€æ ·ï¼

---

## 3. âš™ï¸ Filebeat Systemæ¨¡å—è¯¦è§£


### 3.1 Systemæ¨¡å—æ¦‚è¿°


**ä»€ä¹ˆæ˜¯Systemæ¨¡å—**ï¼š
Systemæ¨¡å—æ˜¯Filebeatå†…ç½®çš„ä¸€ä¸ªä¸“é—¨ç”¨æ¥é‡‡é›†Linux/Unixç³»ç»Ÿæ—¥å¿—çš„"å·¥å…·åŒ…"ï¼Œå®ƒå·²ç»é¢„å…ˆé…ç½®å¥½äº†å¦‚ä½•è¯»å–å’Œè§£æå¸¸è§çš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶ã€‚

**ç±»æ¯”ç†è§£**ï¼š
```
å°±åƒæ™ºèƒ½æ‰‹æœºçš„"ç›¸æœºæ¨¡å¼"ï¼š
- äººåƒæ¨¡å¼ï¼šä¸“é—¨æ‹äººç‰©ï¼Œè‡ªåŠ¨ä¼˜åŒ–
- é£æ™¯æ¨¡å¼ï¼šä¸“é—¨æ‹é£æ™¯ï¼Œè‡ªåŠ¨è°ƒè‰²
- Systemæ¨¡å—ï¼šä¸“é—¨é‡‡é›†ç³»ç»Ÿæ—¥å¿—ï¼Œè‡ªåŠ¨è§£æ
```

### 3.2 Systemæ¨¡å—å¯ç”¨æ–¹æ³•


**ç¬¬ä¸€æ­¥ï¼šå¯ç”¨æ¨¡å—**
```bash
# æŸ¥çœ‹å¯ç”¨æ¨¡å—
filebeat modules list

# å¯ç”¨systemæ¨¡å—
filebeat modules enable system

# ç¡®è®¤æ¨¡å—çŠ¶æ€
filebeat modules list | grep system
```

**ç¬¬äºŒæ­¥ï¼šé…ç½®æ–‡ä»¶è¯´æ˜**
```yaml
# /etc/filebeat/modules.d/system.yml
- module: system
  # ç³»ç»Ÿæ—¥å¿—é‡‡é›†
  syslog:
    enabled: true
    var.paths: ["/var/log/messages"]
  
  # è®¤è¯æ—¥å¿—é‡‡é›†  
  auth:
    enabled: true
    var.paths: ["/var/log/secure"]
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šå¯ç”¨æ¨¡å—åï¼ŒFilebeatä¼šè‡ªåŠ¨çŸ¥é“å¦‚ä½•è¯»å–å’Œè§£æè¿™äº›æ—¥å¿—ï¼Œä¸éœ€è¦ä½ æ‰‹å†™å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ï¼

### 3.3 Systemæ¨¡å—å­ç»„ä»¶


**ä¸»è¦å­æ¨¡å—åŠŸèƒ½**ï¼š

| å­æ¨¡å— | **ä½œç”¨** | **é»˜è®¤è·¯å¾„** | **è§£æå†…å®¹** |
|-------|---------|-------------|-------------|
| ğŸ”¸ **syslog** | `ç³»ç»Ÿæ¶ˆæ¯æ—¥å¿—` | `/var/log/messages` | `å†…æ ¸ã€æœåŠ¡çŠ¶æ€` |
| ğŸ”¸ **auth** | `è®¤è¯æˆæƒæ—¥å¿—` | `/var/log/secure` | `ç™»å½•ã€sudoæ“ä½œ` |
| ğŸ”¸ **audit** | `å®¡è®¡æ—¥å¿—` | `/var/log/audit/audit.log` | `æ–‡ä»¶æ“ä½œã€æƒé™å˜æ›´` |

**é…ç½®çµæ´»æ€§**ï¼š
```yaml
# å¯ä»¥å•ç‹¬å¯ç”¨éœ€è¦çš„å­æ¨¡å—
- module: system
  syslog:
    enabled: true      # å¯ç”¨ç³»ç»Ÿæ—¥å¿—
  auth:
    enabled: true      # å¯ç”¨è®¤è¯æ—¥å¿—  
  audit:
    enabled: false     # ä¸å¯ç”¨å®¡è®¡æ—¥å¿—
```

---

## 4. ğŸ“¨ ç³»ç»Ÿæ¶ˆæ¯æ—¥å¿—é‡‡é›†


### 4.1 /var/log/messagesè¯¦è§£


**messagesæ—¥å¿—æ˜¯ä»€ä¹ˆ**ï¼š
è¿™ä¸ªæ–‡ä»¶å°±åƒç³»ç»Ÿçš„"æ€»æ—¥è®°æœ¬"ï¼Œè®°å½•äº†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­å‡ ä¹æ‰€æœ‰é‡è¦äº‹ä»¶ã€‚

**å¸¸è§æ—¥å¿—å†…å®¹ç±»å‹**ï¼š
```
å†…æ ¸æ¶ˆæ¯ï¼š  ç¡¬ä»¶æ£€æµ‹ã€é©±åŠ¨åŠ è½½
æœåŠ¡çŠ¶æ€ï¼š  æœåŠ¡å¯åŠ¨ã€åœæ­¢ã€é‡å¯
ç½‘ç»œäº‹ä»¶ï¼š  æ¥å£up/downã€IPå˜åŒ–
å­˜å‚¨äº‹ä»¶ï¼š  ç£ç›˜é”™è¯¯ã€æ–‡ä»¶ç³»ç»Ÿé—®é¢˜
å®šæ—¶ä»»åŠ¡ï¼š  cronä½œä¸šæ‰§è¡Œæƒ…å†µ
```

### 4.2 syslogå­æ¨¡å—é…ç½®


**åŸºç¡€é…ç½®**ï¼š
```yaml
- module: system
  syslog:
    enabled: true
    var.paths: 
      - "/var/log/messages"
      - "/var/log/syslog"        # Ubuntuç³»ç»Ÿ
    
    # å¯é€‰é…ç½®
    var.convert_timezone: true   # æ—¶åŒºè½¬æ¢
    var.exclude_lines: ["DEBUG"] # æ’é™¤è°ƒè¯•ä¿¡æ¯
```

**å¤šè·¯å¾„é‡‡é›†**ï¼š
```yaml
# é€‚é…ä¸åŒLinuxå‘è¡Œç‰ˆ
var.paths: 
  - "/var/log/messages"    # CentOS/RHEL
  - "/var/log/syslog"      # Ubuntu/Debian  
  - "/var/log/system.log"  # macOS
```

> ğŸ“Œ **é‡è¦è¯´æ˜**ï¼šä¸åŒLinuxå‘è¡Œç‰ˆçš„ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶è·¯å¾„å¯èƒ½ä¸åŒï¼Œè¦æ ¹æ®å®é™…ç³»ç»Ÿè°ƒæ•´ï¼

### 4.3 å­—æ®µè§£ææ•ˆæœ


**åŸå§‹æ—¥å¿—**ï¼š
```
Dec 21 10:30:15 web01 kernel: Out of memory: Kill process 1234 (java) score 900
```

**Filebeatè§£æåçš„å­—æ®µ**ï¼š
```json
{
  "@timestamp": "2023-12-21T10:30:15.000Z",
  "host.name": "web01",
  "process.name": "kernel",
  "message": "Out of memory: Kill process 1234 (java) score 900",
  "log.level": "info",
  "event.dataset": "system.syslog"
}
```

**è§£æä¼˜åŠ¿**ï¼š
- âœ… **ç»“æ„åŒ–æ•°æ®**ï¼šä¾¿äºæœç´¢å’Œåˆ†æ
- âœ… **æ—¶é—´æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€æ—¶é—´æ ¼å¼
- âœ… **å­—æ®µæå–**ï¼šè‡ªåŠ¨è¯†åˆ«ä¸»æœºåã€è¿›ç¨‹å
- âœ… **å…ƒæ•°æ®æ·»åŠ **ï¼šå¢åŠ æ•°æ®é›†æ ‡è¯†

---

## 5. ğŸ” å®‰å…¨æ—¥å¿—ç›‘æ§å®æˆ˜


### 5.1 /var/log/secureå®‰å…¨æ—¥å¿—


**secureæ—¥å¿—çš„é‡è¦æ€§**ï¼š
è¿™ä¸ªæ–‡ä»¶è®°å½•äº†æ‰€æœ‰ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„äº‹ä»¶ï¼Œæ˜¯ç½‘ç»œå®‰å…¨ç›‘æ§çš„é‡è¦æ•°æ®æºã€‚

**å…¸å‹å®‰å…¨äº‹ä»¶**ï¼š
```
SSHç™»å½•å°è¯•ï¼š  æˆåŠŸ/å¤±è´¥çš„è¿œç¨‹ç™»å½•
sudoæ“ä½œï¼š    æƒé™æå‡æ“ä½œè®°å½•
ç”¨æˆ·åˆ‡æ¢ï¼š    suå‘½ä»¤ä½¿ç”¨è®°å½•
å¯†ç è®¤è¯ï¼š    å¯†ç éªŒè¯æˆåŠŸ/å¤±è´¥
æœåŠ¡è®¤è¯ï¼š    å„ç§æœåŠ¡çš„è®¤è¯äº‹ä»¶
```

### 5.2 authå­æ¨¡å—é…ç½®


**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š
```yaml
- module: system
  auth:
    enabled: true
    var.paths: ["/var/log/secure"]
    
    # å®‰å…¨äº‹ä»¶è¿‡æ»¤
    var.exclude_lines: ["COMMAND="]  # æ’é™¤å‘½ä»¤æ‰§è¡Œè¯¦æƒ…
    
    # å­—æ®µå¤„ç†
    processors:
      - add_fields:
          target: security
          fields:
            category: "authentication"
            risk_level: "medium"
```

### 5.3 å¸¸è§å®‰å…¨äº‹ä»¶è§£æ


**SSHç™»å½•æˆåŠŸ**ï¼š
```
åŸå§‹æ—¥å¿—ï¼š
Dec 21 10:30:15 web01 sshd[12345]: Accepted password for admin from 192.168.1.100 port 22 ssh2

è§£æå­—æ®µï¼š
{
  "event.action": "ssh_login",
  "event.outcome": "success", 
  "user.name": "admin",
  "source.ip": "192.168.1.100",
  "source.port": 22,
  "process.pid": 12345
}
```

**SSHç™»å½•å¤±è´¥**ï¼š
```
åŸå§‹æ—¥å¿—ï¼š
Dec 21 10:31:20 web01 sshd[12346]: Failed password for invalid user hacker from 192.168.1.200

è§£æå­—æ®µï¼š
{
  "event.action": "ssh_login",
  "event.outcome": "failure",
  "user.name": "hacker", 
  "source.ip": "192.168.1.200",
  "error.message": "invalid user"
}
```

**sudoæ“ä½œè®°å½•**ï¼š
```
åŸå§‹æ—¥å¿—ï¼š
Dec 21 10:32:10 web01 sudo: admin : TTY=pts/0 ; PWD=/home/admin ; USER=root ; COMMAND=/bin/systemctl restart nginx

è§£æå­—æ®µï¼š
{
  "event.action": "sudo_command",
  "user.name": "admin",
  "user.target.name": "root", 
  "process.command_line": "/bin/systemctl restart nginx"
}
```

### 5.4 å®‰å…¨ç›‘æ§å‘Šè­¦è§„åˆ™


**åŸºäºElasticsearchçš„å‘Šè­¦è§„åˆ™**ï¼š

| å®‰å…¨äº‹ä»¶ | **ç›‘æ§æŒ‡æ ‡** | **å‘Šè­¦æ¡ä»¶** | **é£é™©çº§åˆ«** |
|---------|------------|-------------|-------------|
| ğŸš¨ **æš´åŠ›ç ´è§£** | `SSHå¤±è´¥æ¬¡æ•°` | `5åˆ†é’Ÿå†…å¤±è´¥>10æ¬¡` | `é«˜å±` |
| âš ï¸ **å¼‚å¸¸ç™»å½•** | `ç™»å½•IPåœ°ç†ä½ç½®` | `éç™½åå•IPç™»å½•` | `ä¸­å±` |
| ğŸ“Š **æƒé™æå‡** | `sudoæ“ä½œé¢‘ç‡` | `å•ç”¨æˆ·æ¯å°æ—¶>50æ¬¡` | `ä¸­å±` |
| ğŸ” **è´¦æˆ·æ‰«æ** | `æ— æ•ˆç”¨æˆ·å°è¯•` | `å°è¯•ä¸å­˜åœ¨ç”¨æˆ·å` | `ä½å±` |

---

## 6. ğŸ•µï¸ å®¡è®¡ä¸ç™»å½•æ—¥å¿—åˆ†æ


### 6.1 ç³»ç»Ÿå®¡è®¡æ—¥å¿—æ¦‚è¿°


**audit.logæ˜¯ä»€ä¹ˆ**ï¼š
ç³»ç»Ÿå®¡è®¡æ—¥å¿—è®°å½•äº†æ›´è¯¦ç»†çš„ç³»ç»Ÿè°ƒç”¨å’Œæ–‡ä»¶æ“ä½œï¼Œæ¯”secureæ—¥å¿—æ›´åŠ å…¨é¢å’Œç²¾ç¡®ã€‚

**å®¡è®¡æ—¥å¿—vså®‰å…¨æ—¥å¿—**ï¼š
```
secureæ—¥å¿—ï¼š    è®°å½•è®¤è¯äº‹ä»¶ï¼ˆè°ç™»å½•äº†ï¼‰
auditæ—¥å¿—ï¼š     è®°å½•è¯¦ç»†æ“ä½œï¼ˆè°åœ¨ä»€ä¹ˆæ—¶å€™å¯¹ä»€ä¹ˆæ–‡ä»¶åšäº†ä»€ä¹ˆï¼‰

ç±»æ¯”ï¼š
secure = é—¨ç¦è®°å½•ï¼ˆè°è¿›é—¨äº†ï¼‰  
audit = ç›‘æ§å½•åƒï¼ˆè¿›é—¨ååšäº†ä»€ä¹ˆï¼‰
```

### 6.2 å®¡è®¡äº‹ä»¶ç±»å‹


**å¸¸è§å®¡è®¡äº‹ä»¶**ï¼š

| äº‹ä»¶ç±»å‹ | **æè¿°** | **ç¤ºä¾‹åœºæ™¯** |
|---------|---------|-------------|
| ğŸ”¸ **SYSCALL** | `ç³»ç»Ÿè°ƒç”¨` | `æ–‡ä»¶è¯»å†™ã€è¿›ç¨‹åˆ›å»º` |
| ğŸ”¸ **PATH** | `æ–‡ä»¶è·¯å¾„æ“ä½œ` | `æ–‡ä»¶åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹` |
| ğŸ”¸ **USER_LOGIN** | `ç”¨æˆ·ç™»å½•` | `æœ¬åœ°å’Œè¿œç¨‹ç™»å½•äº‹ä»¶` |
| ğŸ”¸ **USER_CMD** | `ç”¨æˆ·å‘½ä»¤` | `æ‰§è¡Œçš„å‘½ä»¤è®°å½•` |
| ğŸ”¸ **CONFIG_CHANGE** | `é…ç½®å˜æ›´` | `ç³»ç»Ÿé…ç½®æ–‡ä»¶ä¿®æ”¹` |

### 6.3 ç™»å½•æ—¥å¿—åˆ†æå®æˆ˜


**ç™»å½•è¡Œä¸ºåˆ†æç»´åº¦**ï¼š

```
æ—¶é—´ç»´åº¦ï¼š  ç™»å½•æ—¶é—´åˆ†å¸ƒã€å¼‚å¸¸æ—¶æ®µç™»å½•
åœ°ç†ç»´åº¦ï¼š  ç™»å½•IPå½’å±åœ°ã€è·¨åœ°åŸŸç™»å½•  
ç”¨æˆ·ç»´åº¦ï¼š  ç™»å½•ç”¨æˆ·ç»Ÿè®¡ã€æ–°ç”¨æˆ·ç™»å½•
é¢‘ç‡ç»´åº¦ï¼š  ç™»å½•é¢‘ç‡åˆ†æã€æ‰¹é‡ç™»å½•æ£€æµ‹
```

**å®ç”¨æŸ¥è¯¢ç¤ºä¾‹**ï¼ˆKibanaä¸­ä½¿ç”¨ï¼‰ï¼š
```
# æŸ¥çœ‹ä»Šæ—¥æ‰€æœ‰ç™»å½•äº‹ä»¶
event.dataset: "system.auth" AND event.action: "ssh_login"

# æŸ¥çœ‹ç™»å½•å¤±è´¥äº‹ä»¶
event.outcome: "failure" AND event.action: "ssh_login"

# æŸ¥çœ‹ç‰¹å®šIPçš„ç™»å½•å°è¯•
source.ip: "192.168.1.100" AND event.action: "ssh_login"

# æŸ¥çœ‹rootç”¨æˆ·ç™»å½•
user.name: "root" AND event.action: "ssh_login"
```

---

## 7. ğŸ”§ å­—æ®µç»“æ„åŒ–å¤„ç†


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦å­—æ®µç»“æ„åŒ–


**é—®é¢˜åœºæ™¯**ï¼š
```
åŸå§‹æ—¥å¿—æ–‡æœ¬ï¼š
"Dec 21 10:30:15 web01 sshd[12345]: Failed password for admin from 192.168.1.100"

ç›´æ¥å­˜å‚¨é—®é¢˜ï¼š
âŒ æ— æ³•æŒ‰IPæŸ¥è¯¢
âŒ æ— æ³•æŒ‰ç”¨æˆ·ç»Ÿè®¡  
âŒ æ— æ³•æ—¶é—´èŒƒå›´è¿‡æ»¤
âŒ åˆ†ææ•ˆç‡ä½ä¸‹
```

**ç»“æ„åŒ–åçš„ä¼˜åŠ¿**ï¼š
```json
{
  "@timestamp": "2023-12-21T10:30:15.000Z",
  "host.name": "web01", 
  "process.name": "sshd",
  "process.pid": 12345,
  "event.action": "ssh_login",
  "event.outcome": "failure",
  "user.name": "admin",
  "source.ip": "192.168.1.100"
}
```

âœ… **æŸ¥è¯¢ä¾¿åˆ©**ï¼šå¯ä»¥ç²¾ç¡®æŒ‰å­—æ®µæŸ¥è¯¢
âœ… **ç»Ÿè®¡åˆ†æ**ï¼šå¯ä»¥åšèšåˆåˆ†æ
âœ… **å¯è§†åŒ–**ï¼šå¯ä»¥åˆ¶ä½œå›¾è¡¨dashboard

### 7.2 ECSå­—æ®µæ ‡å‡†


**ä»€ä¹ˆæ˜¯ECS**ï¼š
ECSï¼ˆElastic Common Schemaï¼‰æ˜¯Elasticåˆ¶å®šçš„é€šç”¨æ•°æ®æ ¼å¼æ ‡å‡†ï¼Œè®©ä¸åŒæ¥æºçš„æ•°æ®ä½¿ç”¨ç»Ÿä¸€çš„å­—æ®µåç§°ã€‚

**æ ¸å¿ƒå­—æ®µåˆ†ç±»**ï¼š

| å­—æ®µå‰ç¼€ | **ç”¨é€”** | **ç¤ºä¾‹å­—æ®µ** |
|---------|---------|-------------|
| ğŸ”¸ **@timestamp** | `äº‹ä»¶æ—¶é—´` | `äº‹ä»¶å‘ç”Ÿçš„ç²¾ç¡®æ—¶é—´` |
| ğŸ”¸ **host.*** | `ä¸»æœºä¿¡æ¯` | `host.name, host.ip` |
| ğŸ”¸ **user.*** | `ç”¨æˆ·ä¿¡æ¯` | `user.name, user.id` |
| ğŸ”¸ **source.*** | `æ¥æºä¿¡æ¯` | `source.ip, source.port` |
| ğŸ”¸ **event.*** | `äº‹ä»¶ä¿¡æ¯` | `event.action, event.outcome` |
| ğŸ”¸ **process.*** | `è¿›ç¨‹ä¿¡æ¯` | `process.name, process.pid` |

### 7.3 è‡ªå®šä¹‰å­—æ®µå¤„ç†


**æ·»åŠ è‡ªå®šä¹‰å­—æ®µ**ï¼š
```yaml
- module: system
  auth:
    enabled: true
    processors:
      # æ·»åŠ ç¯å¢ƒæ ‡è¯†
      - add_fields:
          target: environment
          fields:
            env: "production"
            datacenter: "beijing"
            
      # æ ¹æ®IPæ·»åŠ åœ°ç†ä½ç½®  
      - add_locale:
          format: offset
          
      # åˆ é™¤æ•æ„Ÿå­—æ®µ
      - drop_fields:
          fields: ["agent.version", "ecs.version"]
```

**å­—æ®µé‡å‘½å**ï¼š
```yaml
processors:
  # é‡å‘½åå­—æ®µ
  - rename:
      fields:
        - from: "host.name"
          to: "server.hostname"
        - from: "source.ip"  
          to: "client.ip"
```

---

## 8. ğŸ­ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


### 8.1 æ€§èƒ½ä¼˜åŒ–é…ç½®


**å¤šçº¿ç¨‹å¤„ç†**ï¼š
```yaml
filebeat.inputs:
- type: log
  paths: ["/var/log/messages"]
  harvester_buffer_size: 32768    # å¢å¤§ç¼“å†²åŒº
  max_bytes: 10485760            # å•è¡Œæœ€å¤§10MB
  
output.elasticsearch:
  hosts: ["es01:9200", "es02:9200"]
  worker: 4                      # 4ä¸ªå·¥ä½œçº¿ç¨‹
  bulk_max_size: 2048           # æ‰¹é‡å¤§å°
  flush_interval: 30s           # åˆ·æ–°é—´éš”
```

**å†…å­˜ä¼˜åŒ–**ï¼š
```yaml
queue.mem:
  events: 8192        # å†…å­˜é˜Ÿåˆ—å¤§å°
  flush.min_events: 1024
  flush.timeout: 5s

logging.level: info   # å‡å°‘æ—¥å¿—è¾“å‡º
logging.to_files: true
```

### 8.2 é«˜å¯ç”¨é…ç½®


**è´Ÿè½½å‡è¡¡é…ç½®**ï¼š
```yaml
output.elasticsearch:
  hosts: 
    - "es01.cluster.local:9200"
    - "es02.cluster.local:9200"  
    - "es03.cluster.local:9200"
  loadbalance: true
  
  # è¿æ¥æ± è®¾ç½®
  max_retries: 3
  backoff.init: 1s
  backoff.max: 60s
  timeout: 90s
```

**æ•…éšœè½¬ç§»**ï¼š
```yaml
# ä¸»è¾“å‡ºå¤±è´¥æ—¶ä½¿ç”¨å¤‡ç”¨è¾“å‡º
output.elasticsearch:
  hosts: ["primary-es:9200"]
  
# å¤‡ç”¨è¾“å‡ºåˆ°æ–‡ä»¶
filebeat.config.outputs:
  path: ${path.config}/outputs.d/*.yml
  reload.enabled: true
```

### 8.3 ç›‘æ§å’Œå‘Šè­¦


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§é¡¹** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|---------|-----------|-------------|-------------|
| ğŸ“Š **ååé‡** | `events/second` | `100-1000` | `<50 æˆ– >2000` |
| â±ï¸ **å»¶è¿Ÿ** | `processing latency` | `<5s` | `>30s` |
| ğŸ’¾ **å†…å­˜** | `memory usage` | `<80%` | `>90%` |
| ğŸ“ˆ **é˜Ÿåˆ—** | `queue length` | `<5000` | `>10000` |

**Filebeatè‡ªç›‘æ§**ï¼š
```yaml
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["monitor-es:9200"]
  
# å¼€å¯å†…éƒ¨æŒ‡æ ‡æ”¶é›†
http.enabled: true
http.host: "0.0.0.0"
http.port: 5066
```

### 8.4 å®‰å…¨åŠ å›º


**TLSåŠ å¯†ä¼ è¾“**ï¼š
```yaml
output.elasticsearch:
  hosts: ["https://es01:9200"]
  protocol: "https"
  ssl.certificate_authorities: ["/etc/filebeat/ca.crt"]
  ssl.certificate: "/etc/filebeat/client.crt"
  ssl.key: "/etc/filebeat/client.key"
```

**APIå¯†é’¥è®¤è¯**ï¼š
```yaml
output.elasticsearch:
  api_key: "your-api-key-here"
  # æˆ–ä½¿ç”¨ç”¨æˆ·åå¯†ç 
  username: "filebeat_writer"
  password: "secure-password"
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ç³»ç»Ÿæ—¥å¿—é‡‡é›†ï¼šé€šè¿‡Filebeatæ”¶é›†Linuxç³»ç»Ÿå„ç±»æ—¥å¿—æ–‡ä»¶
ğŸ”¸ Systemæ¨¡å—ï¼šFilebeatå†…ç½®çš„ç³»ç»Ÿæ—¥å¿—å¤„ç†å·¥å…·åŒ…
ğŸ”¸ æ—¥å¿—æ ‡å‡†åŒ–ï¼šå°†éç»“æ„åŒ–æ—¥å¿—è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®
ğŸ”¸ ECSå­—æ®µè§„èŒƒï¼šç»Ÿä¸€çš„æ•°æ®å­—æ®µå‘½åæ ‡å‡†
ğŸ”¸ å®‰å…¨äº‹ä»¶ç›‘æ§ï¼šåŸºäºæ—¥å¿—è¿›è¡Œå®‰å…¨å¨èƒæ£€æµ‹
```

### 9.2 å…³é”®æ“ä½œæµç¨‹


**ğŸ“‹ ç³»ç»Ÿæ—¥å¿—é‡‡é›†æ ‡å‡†æµç¨‹**ï¼š
```
1. å¯ç”¨Systemæ¨¡å—ï¼šfilebeat modules enable system
2. é…ç½®é‡‡é›†è·¯å¾„ï¼šä¿®æ”¹modules.d/system.yml
3. æµ‹è¯•é…ç½®æ–‡ä»¶ï¼šfilebeat test config
4. å¯åŠ¨é‡‡é›†æœåŠ¡ï¼šsystemctl start filebeat
5. éªŒè¯æ•°æ®ä¼ è¾“ï¼šæ£€æŸ¥Elasticsearchç´¢å¼•
```

**ğŸ”§ æ•…éšœæ’æŸ¥æ€è·¯**ï¼š
```
æ•°æ®æœªåˆ°è¾¾ â†’ æ£€æŸ¥FilebeatçŠ¶æ€ â†’ éªŒè¯ç½‘ç»œè¿æ¥ â†’ æŸ¥çœ‹é”™è¯¯æ—¥å¿—
æ•°æ®æ ¼å¼é”™è¯¯ â†’ æ£€æŸ¥æ¨¡å—é…ç½® â†’ éªŒè¯å­—æ®µæ˜ å°„ â†’ è°ƒæ•´è§£æè§„åˆ™
æ€§èƒ½é—®é¢˜ â†’ ç›‘æ§èµ„æºä½¿ç”¨ â†’ è°ƒæ•´æ‰¹å¤„ç†å¤§å° â†’ ä¼˜åŒ–ç½‘ç»œé…ç½®
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è¿ç»´åœºæ™¯åº”ç”¨**ï¼š
- **æ•…éšœå®šä½**ï¼šå¿«é€ŸæŸ¥æ‰¾ç³»ç»Ÿé”™è¯¯å’Œå¼‚å¸¸äº‹ä»¶
- **æ€§èƒ½ç›‘æ§**ï¼šåˆ†æç³»ç»Ÿè´Ÿè½½å’Œèµ„æºä½¿ç”¨è¶‹åŠ¿
- **å®‰å…¨é˜²æŠ¤**ï¼šæ£€æµ‹å¼‚å¸¸ç™»å½•å’Œå¯ç–‘æ“ä½œè¡Œä¸º
- **åˆè§„å®¡è®¡**ï¼šæ»¡è¶³ä¼ä¸šå†…æ§å’Œæ³•è§„è¦æ±‚

**ğŸ“Š ä¸šåŠ¡ä»·å€¼ä½“ç°**ï¼š
- **é™ä½MTTR**ï¼šå¹³å‡æ•…éšœæ¢å¤æ—¶é—´å‡å°‘60%
- **æå‡å®‰å…¨**ï¼šåŠæ—¶å‘ç°å’Œå“åº”å®‰å…¨å¨èƒ
- **è¿ç»´æ•ˆç‡**ï¼šé›†ä¸­åŒ–æ—¥å¿—ç®¡ç†æå‡å·¥ä½œæ•ˆç‡
- **æˆæœ¬æ§åˆ¶**ï¼šé¢„é˜²æ€§ç»´æŠ¤å‡å°‘æ•…éšœæŸå¤±

**ğŸ” æ ¸å¿ƒå­¦ä¹ è¦ç‚¹**ï¼š
- ç†è§£Linuxç³»ç»Ÿæ—¥å¿—çš„åˆ†ç±»å’Œä½œç”¨
- æŒæ¡Filebeat Systemæ¨¡å—çš„é…ç½®æ–¹æ³•
- å­¦ä¼šä½¿ç”¨ECSæ ‡å‡†è§„èŒƒæ•°æ®å­—æ®µ
- å…·å¤‡åŸºæœ¬çš„å®‰å…¨æ—¥å¿—åˆ†æèƒ½åŠ›
- äº†è§£ç”Ÿäº§ç¯å¢ƒçš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒç»ƒä¹ åŸºæœ¬é…ç½®ï¼Œç†Ÿæ‚‰åå†åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚é‡ç‚¹å…³æ³¨å®‰å…¨æ—¥å¿—çš„åˆ†æï¼Œè¿™æ˜¯ä¼ä¸šæœ€å…³æ³¨çš„åº”ç”¨åœºæ™¯ï¼

**ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ æ–¹å‘**ï¼š
- æ·±å…¥å­¦ä¹ Logstashæ•°æ®å¤„ç†ç®¡é“
- æŒæ¡Kibanaå¯è§†åŒ–åˆ†ææŠ€å·§  
- äº†è§£Elasticsearché›†ç¾¤ç®¡ç†
- å­¦ä¹ æ›´å¤šFilebeatæ¨¡å—ï¼ˆå¦‚Nginxã€Apacheç­‰ï¼‰