---
title: 11ã€Logstashè¾“å‡ºé…ç½®
---
## ğŸ“š ç›®å½•

1. [Logstashè¾“å‡ºæ¦‚è¿°](#1-Logstashè¾“å‡ºæ¦‚è¿°)
2. [åŸºç¡€é…ç½®å‚æ•°è¯¦è§£](#2-åŸºç¡€é…ç½®å‚æ•°è¯¦è§£)
3. [è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨é…ç½®](#3-è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨é…ç½®)
4. [æ€§èƒ½ä¼˜åŒ–é…ç½®](#4-æ€§èƒ½ä¼˜åŒ–é…ç½®)
5. [ä¼ è¾“å®‰å…¨ä¸å‹ç¼©è®¾ç½®](#5-ä¼ è¾“å®‰å…¨ä¸å‹ç¼©è®¾ç½®)
6. [å®¹é”™ä¸é‡è¯•æœºåˆ¶](#6-å®¹é”™ä¸é‡è¯•æœºåˆ¶)
7. [å®é™…åº”ç”¨åœºæ™¯é…ç½®](#7-å®é™…åº”ç”¨åœºæ™¯é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¡ Logstashè¾“å‡ºæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Logstashè¾“å‡º


**ç®€å•ç†è§£**ï¼šFilebeatæ”¶é›†åˆ°æ—¥å¿—åï¼Œéœ€è¦å‘é€åˆ°æŸä¸ªåœ°æ–¹å¤„ç†ï¼ŒLogstashå°±æ˜¯å…¶ä¸­ä¸€ä¸ªé‡è¦çš„ç›®æ ‡

```
æ—¥å¿—æ•°æ®æµå‘ï¼š
åº”ç”¨æœåŠ¡å™¨ â†’ Filebeatæ”¶é›† â†’ å‘é€åˆ°Logstash â†’ å¤„ç†åŠ å·¥ â†’ å­˜å‚¨åˆ°Elasticsearch

ä¸ºä»€ä¹ˆé€‰æ‹©Logstashï¼Ÿ
ğŸ”¸ å¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼šå¯ä»¥è§£æã€è½¬æ¢ã€ä¸°å¯Œæ—¥å¿—æ•°æ®
ğŸ”¸ ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼šæ”¯æŒå„ç§è¾“å…¥è¾“å‡ºæ ¼å¼
ğŸ”¸ çµæ´»çš„è¿‡æ»¤è§„åˆ™ï¼šå¯ä»¥æ ¹æ®éœ€è¦æ¸…æ´—å’Œç»“æ„åŒ–æ•°æ®
```

### 1.2 Logstashè¾“å‡ºçš„æ ¸å¿ƒä½œç”¨


**æ•°æ®ä¼ è¾“ä¸­è½¬ç«™**ï¼š
- **æ”¶é›†æ±‡èš**ï¼šå°†å¤šä¸ªFilebeatçš„æ•°æ®é›†ä¸­åˆ°Logstash
- **æ•°æ®å¤„ç†**ï¼šå¯¹åŸå§‹æ—¥å¿—è¿›è¡Œè§£æã€æ ¼å¼åŒ–ã€å­—æ®µæå–
- **åˆ†å‘è·¯ç”±**ï¼šæ ¹æ®è§„åˆ™å°†å¤„ç†åçš„æ•°æ®å‘é€åˆ°ä¸åŒç›®æ ‡

```
Filebeaté…ç½®ä¸­çš„ä½ç½®ï¼š
input:          â† æ•°æ®æ¥æºï¼ˆæ–‡ä»¶ã€å®¹å™¨ç­‰ï¼‰
  type: log
  paths: ["/var/log/*.log"]

output:         â† æ•°æ®å»å‘ï¼ˆæœ¬ç« é‡ç‚¹ï¼‰
  logstash:
    hosts: ["localhost:5044"]
```

### 1.3 é…ç½®æ®µåŸºæœ¬ç»“æ„


**`output.logstash`é…ç½®çš„åŸºæœ¬æ¡†æ¶**ï¼š

```yaml
output.logstash:
  # åŸºç¡€è¿æ¥é…ç½®
  hosts: ["logstash1:5044", "logstash2:5044"]
  
  # æ€§èƒ½è°ƒä¼˜é…ç½®
  worker: 2
  bulk_max_size: 2048
  
  # è´Ÿè½½å‡è¡¡é…ç½®
  loadbalance: true
  
  # ç½‘ç»œä¸å®‰å…¨é…ç½®
  compression_level: 3
  timeout: 30
```

---

## 2. ğŸ”§ åŸºç¡€é…ç½®å‚æ•°è¯¦è§£


### 2.1 hosts - LogstashæœåŠ¡å™¨åœ°å€


**æ ¸å¿ƒä½œç”¨**ï¼šå‘Šè¯‰Filebeatè¦æŠŠæ•°æ®å‘é€åˆ°å“ªäº›LogstashæœåŠ¡å™¨

```yaml
# å•ä¸ªLogstashæœåŠ¡å™¨
output.logstash:
  hosts: ["192.168.1.100:5044"]

# å¤šä¸ªLogstashæœåŠ¡å™¨ï¼ˆé«˜å¯ç”¨ï¼‰
output.logstash:
  hosts: 
    - "logstash1.company.com:5044"
    - "logstash2.company.com:5044" 
    - "192.168.1.102:5044"
```

**åœ°å€æ ¼å¼è¯´æ˜**ï¼š
- ğŸ”¸ **`IPåœ°å€:ç«¯å£`**ï¼šå¦‚`192.168.1.100:5044`
- ğŸ”¸ **`åŸŸå:ç«¯å£`**ï¼šå¦‚`logstash.company.com:5044`
- ğŸ”¸ **é»˜è®¤ç«¯å£**ï¼šLogstashé»˜è®¤ç›‘å¬`5044`ç«¯å£

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šç«¯å£å·5044æ˜¯Logstash beatsè¾“å…¥æ’ä»¶çš„é»˜è®¤ç«¯å£ï¼Œç¡®ä¿Logstashé…ç½®ä¸­å¼€å¯äº†beatsè¾“å…¥

### 2.2 worker - å·¥ä½œçº¿ç¨‹é…ç½®


**é€šä¿—è§£é‡Š**ï¼šworkerå°±åƒæ˜¯ä¸“é—¨è´Ÿè´£å‘é€æ•°æ®çš„å·¥ä½œäººå‘˜ï¼Œäººæ•°è¶Šå¤šï¼Œå‘é€é€Ÿåº¦è¶Šå¿«

```yaml
output.logstash:
  hosts: ["logstash:5044"]
  worker: 2  # ä½¿ç”¨2ä¸ªå·¥ä½œçº¿ç¨‹å¹¶å‘å‘é€æ•°æ®
```

**çº¿ç¨‹æ•°é‡é€‰æ‹©æŒ‡å¯¼**ï¼š

| **æ•°æ®é‡çº§** | **æ¨èworkeræ•°é‡** | **é€‚ç”¨åœºæ™¯** |
|------------|------------------|-------------|
| `å°å‹ï¼ˆ<1GB/å¤©ï¼‰` | `1-2` | `å•å°æœåŠ¡å™¨ï¼Œè½»é‡æ—¥å¿—` |
| `ä¸­å‹ï¼ˆ1-10GB/å¤©ï¼‰` | `2-4` | `å¤šå°æœåŠ¡å™¨ï¼Œä¸šåŠ¡æ—¥å¿—` |
| `å¤§å‹ï¼ˆ>10GB/å¤©ï¼‰` | `4-8` | `é›†ç¾¤ç¯å¢ƒï¼Œé«˜å¹¶å‘åº”ç”¨` |

> âš ï¸ **æ³¨æ„**ï¼šworkeræ•°é‡ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¿‡å¤šä¼šå¢åŠ CPUå’Œå†…å­˜æ¶ˆè€—

### 2.3 index - ç´¢å¼•å­—æ®µè®¾ç½®


**ä½œç”¨è¯´æ˜**ï¼šæŒ‡å®šæ•°æ®åœ¨Elasticsearchä¸­å­˜å‚¨åˆ°å“ªä¸ªç´¢å¼•

```yaml
output.logstash:
  hosts: ["logstash:5044"]
  index: "filebeat-%{+yyyy.MM.dd}"  # æŒ‰æ—¥æœŸåˆ›å»ºç´¢å¼•
```

**å¸¸ç”¨ç´¢å¼•å‘½åç­–ç•¥**ï¼š

```yaml
# æŒ‰æ—¥æœŸåˆ†ç´¢å¼•ï¼ˆæ¨èï¼‰
index: "app-logs-%{+yyyy.MM.dd}"
# ç»“æœï¼šapp-logs-2024.03.15

# æŒ‰åº”ç”¨åˆ†ç´¢å¼•
index: "nginx-access-%{+yyyy.MM}"
# ç»“æœï¼šnginx-access-2024.03

# æŒ‰æœåŠ¡å™¨åˆ†ç´¢å¼•
index: "%{[agent.hostname]}-%{+yyyy.MM.dd}"
# ç»“æœï¼šweb01-2024.03.15
```

---

## 3. âš–ï¸ è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨é…ç½®


### 3.1 loadbalance - è´Ÿè½½å‡è¡¡ç­–ç•¥


**ç®€å•ç†è§£**ï¼šå½“æœ‰å¤šä¸ªLogstashæœåŠ¡å™¨æ—¶ï¼Œloadbalanceå†³å®šå¦‚ä½•åˆ†é…æ•°æ®å‘é€ä»»åŠ¡

```yaml
output.logstash:
  hosts: 
    - "logstash1:5044"
    - "logstash2:5044"
    - "logstash3:5044"
  loadbalance: true  # å¼€å¯è´Ÿè½½å‡è¡¡
```

**è´Ÿè½½å‡è¡¡æ•ˆæœå¯¹æ¯”**ï¼š

```
ä¸å¼€å¯è´Ÿè½½å‡è¡¡ï¼ˆloadbalance: falseï¼‰ï¼š
Filebeat â†’ logstash1ï¼ˆä¸»è¦ï¼‰
         â†’ logstash2ï¼ˆå¤‡ç”¨ï¼Œä»…å½“logstash1ä¸å¯ç”¨ï¼‰
         â†’ logstash3ï¼ˆå¤‡ç”¨ï¼Œä»…å½“å‰é¢éƒ½ä¸å¯ç”¨ï¼‰

å¼€å¯è´Ÿè½½å‡è¡¡ï¼ˆloadbalance: trueï¼‰ï¼š
Filebeat â†’ logstash1ï¼ˆ33%æ•°æ®ï¼‰
         â†’ logstash2ï¼ˆ33%æ•°æ®ï¼‰  
         â†’ logstash3ï¼ˆ34%æ•°æ®ï¼‰
```

### 3.2 é«˜å¯ç”¨æ¶æ„è®¾è®¡


**æ¨èçš„é«˜å¯ç”¨é…ç½®**ï¼š

```yaml
output.logstash:
  hosts: 
    - "logstash-primary:5044"     # ä¸»èŠ‚ç‚¹
    - "logstash-secondary:5044"   # å¤‡ç”¨èŠ‚ç‚¹
    - "logstash-backup:5044"      # å¤‡ä»½èŠ‚ç‚¹
  
  loadbalance: true               # å¯ç”¨è´Ÿè½½å‡è¡¡
  worker: 3                       # å·¥ä½œçº¿ç¨‹æ•°åŒ¹é…èŠ‚ç‚¹æ•°
  
  # è¿æ¥å¤±è´¥æ—¶çš„é‡è¯•è®¾ç½®
  max_retries: 3
  backoff:
    init: 1s
    max: 60s
```

**å®¹ç¾æµç¨‹ç¤ºæ„**ï¼š

```
æ­£å¸¸æƒ…å†µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è´Ÿè½½å‡è¡¡    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Filebeat â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚Logstash1 â”‚
â”‚         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚Logstash2 â”‚
â”‚         â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚Logstash3 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•…éšœæƒ…å†µï¼ˆLogstash1å®•æœºï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Filebeat â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚Logstash2 â”‚
â”‚         â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚Logstash3 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®


### 4.1 bulk_max_size - æ‰¹é‡ä¼ è¾“å¤§å°


**é€šä¿—è§£é‡Š**ï¼šå°±åƒæ˜¯æ¬è¿è´§ç‰©ï¼Œä¸€æ¬¡æ¬ä¸€ä¸ªæ•ˆç‡ä½ï¼Œä¸€æ¬¡æ¬ä¸€è½¦æ•ˆç‡é«˜ã€‚bulk_max_sizeå†³å®šä¸€æ¬¡å‘é€å¤šå°‘æ¡æ—¥å¿—

```yaml
output.logstash:
  hosts: ["logstash:5044"]
  bulk_max_size: 2048  # ä¸€æ¬¡æœ€å¤šå‘é€2048æ¡æ—¥å¿—
```

**æ‰¹é‡å¤§å°é€‰æ‹©æŒ‡å—**ï¼š

| **æ—¥å¿—äº§ç”Ÿé€Ÿåº¦** | **æ¨èbulk_max_size** | **å»¶è¿Ÿç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|----------------|---------------------|-------------|-------------|
| `ä½é¢‘ï¼ˆ<100æ¡/ç§’ï¼‰` | `512-1024` | `å»¶è¿Ÿè¾ƒä½` | `ç³»ç»Ÿæ—¥å¿—ã€é”™è¯¯æ—¥å¿—` |
| `ä¸­é¢‘ï¼ˆ100-1000æ¡/ç§’ï¼‰` | `1024-2048` | `å»¶è¿Ÿé€‚ä¸­` | `åº”ç”¨è®¿é—®æ—¥å¿—` |
| `é«˜é¢‘ï¼ˆ>1000æ¡/ç§’ï¼‰` | `2048-4096` | `å»¶è¿Ÿè¾ƒé«˜` | `é«˜å¹¶å‘WebæœåŠ¡` |

### 4.2 slow_start - æ…¢å¯åŠ¨é…ç½®


**ä½œç”¨è¯´æ˜**ï¼šé¿å…Filebeatå¯åŠ¨æ—¶ç¬é—´å‘é€å¤§é‡æ•°æ®ï¼Œç»™Logstashé€ æˆå‹åŠ›

```yaml
output.logstash:
  hosts: ["logstash:5044"]
  slow_start: true      # å¯ç”¨æ…¢å¯åŠ¨
  bulk_max_size: 2048
```

**æ…¢å¯åŠ¨è¿‡ç¨‹ç¤ºæ„**ï¼š

```
æ…¢å¯åŠ¨æ•ˆæœï¼š
æ—¶é—´ç‚¹1: å‘é€ 256æ¡  ï¼ˆåˆå§‹è¾ƒå°ï¼‰
æ—¶é—´ç‚¹2: å‘é€ 512æ¡  ï¼ˆé€æ­¥å¢åŠ ï¼‰
æ—¶é—´ç‚¹3: å‘é€ 1024æ¡ ï¼ˆç»§ç»­å¢åŠ ï¼‰
æ—¶é—´ç‚¹4: å‘é€ 2048æ¡ ï¼ˆè¾¾åˆ°è®¾å®šæœ€å¤§å€¼ï¼‰

ä¸å¼€å¯æ…¢å¯åŠ¨ï¼š
æ—¶é—´ç‚¹1: å‘é€ 2048æ¡ ï¼ˆç›´æ¥æœ€å¤§ï¼Œå¯èƒ½é€ æˆå†²å‡»ï¼‰
```

### 4.3 workerä¸bulk_max_sizeåè°ƒé…ç½®


**æœ€ä½³å®è·µç»„åˆ**ï¼š

```yaml
# ä¸­ç­‰è§„æ¨¡é…ç½®
output.logstash:
  hosts: ["logstash1:5044", "logstash2:5044"]
  worker: 2
  bulk_max_size: 1024
  slow_start: true

# å¤§è§„æ¨¡é…ç½®  
output.logstash:
  hosts: 
    - "logstash1:5044"
    - "logstash2:5044" 
    - "logstash3:5044"
  worker: 4
  bulk_max_size: 2048
  loadbalance: true
```

---

## 5. ğŸ“¦ ä¼ è¾“å®‰å…¨ä¸å‹ç¼©è®¾ç½®


### 5.1 compression - å‹ç¼©ä¼ è¾“é…ç½®


**ä¸ºä»€ä¹ˆéœ€è¦å‹ç¼©**ï¼šå‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼Œç‰¹åˆ«æ˜¯åœ¨å¸¦å®½æœ‰é™æˆ–è·¨æœºæˆ¿ä¼ è¾“æ—¶

```yaml
output.logstash:
  hosts: ["logstash:5044"]
  compression_level: 3  # å‹ç¼©çº§åˆ«ï¼ˆ0-9ï¼‰
```

**å‹ç¼©çº§åˆ«é€‰æ‹©**ï¼š

| **å‹ç¼©çº§åˆ«** | **å‹ç¼©æ¯”** | **CPUæ¶ˆè€—** | **é€‚ç”¨åœºæ™¯** |
|------------|-----------|-----------|-------------|
| `0` | `æ— å‹ç¼©` | `æœ€ä½` | `å±€åŸŸç½‘ï¼Œå¸¦å®½å……è¶³` |
| `1-3` | `ä½å‹ç¼©` | `è¾ƒä½` | `ä¸€èˆ¬ç½‘ç»œç¯å¢ƒ` |
| `4-6` | `ä¸­ç­‰å‹ç¼©` | `é€‚ä¸­` | `è·¨æœºæˆ¿ä¼ è¾“` |
| `7-9` | `é«˜å‹ç¼©` | `è¾ƒé«˜` | `å…¬ç½‘ä¼ è¾“ï¼Œå¸¦å®½ç´§å¼ ` |

### 5.2 SSL/TLSå®‰å…¨ä¼ è¾“é…ç½®


**åŠ å¯†ä¼ è¾“é…ç½®ç¤ºä¾‹**ï¼š

```yaml
output.logstash:
  hosts: ["logstash.company.com:5044"]
  
  # SSL/TLSé…ç½®
  ssl.enabled: true
  ssl.certificate_authorities: ["/etc/ssl/ca.crt"]
  ssl.certificate: "/etc/ssl/client.crt"
  ssl.key: "/etc/ssl/client.key"
  
  # è¯ä¹¦éªŒè¯è®¾ç½®
  ssl.verification_mode: full  # full/none/certificate
```

**SSLé…ç½®æ–‡ä»¶è¯´æ˜**ï¼š
- ğŸ”¸ **ca.crt**ï¼šCAæ ¹è¯ä¹¦ï¼ŒéªŒè¯æœåŠ¡å™¨èº«ä»½
- ğŸ”¸ **client.crt**ï¼šå®¢æˆ·ç«¯è¯ä¹¦ï¼Œå®¢æˆ·ç«¯èº«ä»½è®¤è¯
- ğŸ”¸ **client.key**ï¼šå®¢æˆ·ç«¯ç§é’¥ï¼Œé…åˆè¯ä¹¦ä½¿ç”¨

---

## 6. ğŸ”„ å®¹é”™ä¸é‡è¯•æœºåˆ¶


### 6.1 backoff - é€€é¿ç­–ç•¥è®¾ç½®


**é€€é¿ç­–ç•¥è§£é‡Š**ï¼šå½“å‘é€å¤±è´¥æ—¶ï¼Œä¸æ˜¯ç«‹å³é‡è¯•ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€æ®µæ—¶é—´å†è¯•ï¼Œé¿å…é›ªå´©æ•ˆåº”

```yaml
output.logstash:
  hosts: ["logstash:5044"]
  
  # é€€é¿ç­–ç•¥é…ç½®
  backoff:
    init: 1s      # åˆå§‹ç­‰å¾…æ—¶é—´
    max: 60s      # æœ€å¤§ç­‰å¾…æ—¶é—´
    factor: 2     # é€’å¢å› å­
```

**é€€é¿æ—¶é—´é€’å¢ç¤ºä¾‹**ï¼š

```
é‡è¯•æ—¶é—´é€’å¢è¿‡ç¨‹ï¼š
ç¬¬1æ¬¡å¤±è´¥ â†’ ç­‰å¾… 1ç§’  â†’ é‡è¯•
ç¬¬2æ¬¡å¤±è´¥ â†’ ç­‰å¾… 2ç§’  â†’ é‡è¯•  (1 Ã— 2 = 2)
ç¬¬3æ¬¡å¤±è´¥ â†’ ç­‰å¾… 4ç§’  â†’ é‡è¯•  (2 Ã— 2 = 4)
ç¬¬4æ¬¡å¤±è´¥ â†’ ç­‰å¾… 8ç§’  â†’ é‡è¯•  (4 Ã— 2 = 8)
ç¬¬5æ¬¡å¤±è´¥ â†’ ç­‰å¾… 16ç§’ â†’ é‡è¯•  (8 Ã— 2 = 16)
ç¬¬6æ¬¡å¤±è´¥ â†’ ç­‰å¾… 32ç§’ â†’ é‡è¯•  (16 Ã— 2 = 32)
ç¬¬7æ¬¡å¤±è´¥ â†’ ç­‰å¾… 60ç§’ â†’ é‡è¯•  (è¾¾åˆ°maxé™åˆ¶)
```

### 6.2 è¶…æ—¶ä¸é‡è¯•é…ç½®


**å®Œæ•´çš„å®¹é”™é…ç½®**ï¼š

```yaml
output.logstash:
  hosts: 
    - "logstash1:5044"
    - "logstash2:5044"
  
  # è¿æ¥ä¸ä¼ è¾“è¶…æ—¶
  timeout: 30              # ç½‘ç»œè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  max_retries: 3           # æœ€å¤§é‡è¯•æ¬¡æ•°
  
  # é€€é¿ç­–ç•¥
  backoff:
    init: 1s
    max: 60s
    factor: 2
  
  # æ‰¹é‡å‘é€è¶…æ—¶
  bulk_max_size: 1024
  worker: 2
```

### 6.3 æ•…éšœè½¬ç§»æµç¨‹


**æ•…éšœå¤„ç†æµç¨‹å›¾**ï¼š

```
æ•°æ®å‘é€æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡†å¤‡å‘é€æ•°æ® â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å¤±è´¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é€åˆ°ä¸»èŠ‚ç‚¹ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ è®°å½•å¤±è´¥æ¬¡æ•° â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚æˆåŠŸ                     â”‚
      â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‘é€å®Œæˆ    â”‚           â”‚ æ‰§è¡Œé€€é¿ç­‰å¾… â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ å°è¯•å¤‡ç”¨èŠ‚ç‚¹ â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯é…ç½®


### 7.1 å°å‹å•æœºç¯å¢ƒé…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šä¸ªäººå­¦ä¹ ã€å°å‹åº”ç”¨ã€æµ‹è¯•ç¯å¢ƒ

```yaml
# filebeat.yml - å°å‹ç¯å¢ƒé…ç½®
output.logstash:
  hosts: ["localhost:5044"]
  worker: 1
  bulk_max_size: 512
  timeout: 30
  
  # ç®€å•é‡è¯•ç­–ç•¥
  max_retries: 2
  backoff:
    init: 1s
    max: 10s
```

### 7.2 ä¸­å‹ä¼ä¸šç¯å¢ƒé…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šä¸­å‹å…¬å¸ã€ä¸šåŠ¡ç³»ç»Ÿã€ç”Ÿäº§ç¯å¢ƒ

```yaml
# filebeat.yml - ä¸­å‹ä¼ä¸šé…ç½®
output.logstash:
  hosts: 
    - "logstash-prod1.company.local:5044"
    - "logstash-prod2.company.local:5044"
  
  # è´Ÿè½½å‡è¡¡é…ç½®
  loadbalance: true
  worker: 3
  bulk_max_size: 1024
  
  # æ€§èƒ½ä¼˜åŒ–
  compression_level: 3
  slow_start: true
  
  # å®¹é”™é…ç½®
  timeout: 30
  max_retries: 3
  backoff:
    init: 2s
    max: 30s
    factor: 2
  
  # ç´¢å¼•é…ç½®
  index: "app-logs-%{[agent.hostname]}-%{+yyyy.MM.dd}"
```

### 7.3 å¤§å‹åˆ†å¸ƒå¼ç¯å¢ƒé…ç½®


**é€‚ç”¨åœºæ™¯**ï¼šå¤§å‹äº’è”ç½‘å…¬å¸ã€å¾®æœåŠ¡æ¶æ„ã€é«˜å¹¶å‘ç³»ç»Ÿ

```yaml
# filebeat.yml - å¤§å‹åˆ†å¸ƒå¼é…ç½®
output.logstash:
  hosts: 
    - "logstash-cluster1.prod.company.com:5044"
    - "logstash-cluster2.prod.company.com:5044"
    - "logstash-cluster3.prod.company.com:5044"
    - "logstash-cluster4.prod.company.com:5044"
  
  # é«˜æ€§èƒ½é…ç½®
  loadbalance: true
  worker: 6
  bulk_max_size: 2048
  
  # ç½‘ç»œä¼˜åŒ–
  compression_level: 4
  timeout: 60
  
  # é«˜å¯ç”¨é…ç½®
  max_retries: 5
  backoff:
    init: 1s
    max: 120s
    factor: 2
  
  # SSLå®‰å…¨ä¼ è¾“
  ssl.enabled: true
  ssl.certificate_authorities: ["/etc/filebeat/ssl/ca.crt"]
  ssl.verification_mode: full
  
  # åŠ¨æ€ç´¢å¼•é…ç½®
  index: "%{[fields.env]}-%{[fields.app]}-%{+yyyy.MM.dd}"
```

### 7.4 è·¨æœºæˆ¿ç¾å¤‡é…ç½®


**ç‰¹æ®Šåœºæ™¯**ï¼šå¼‚åœ°å®¹ç¾ã€å¤šæœºæˆ¿éƒ¨ç½²

```yaml
# filebeat.yml - è·¨æœºæˆ¿é…ç½®
output.logstash:
  hosts: 
    # ä¸»æœºæˆ¿Logstashé›†ç¾¤
    - "logstash1.datacenter-a.com:5044"
    - "logstash2.datacenter-a.com:5044"
    # å¤‡æœºæˆ¿Logstashé›†ç¾¤  
    - "logstash1.datacenter-b.com:5044"
    - "logstash2.datacenter-b.com:5044"
  
  # è·¨æœºæˆ¿ä¼˜åŒ–é…ç½®
  loadbalance: true
  worker: 4
  bulk_max_size: 4096      # å¢å¤§æ‰¹é‡ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
  compression_level: 6     # æé«˜å‹ç¼©ï¼ŒèŠ‚çœå¸¦å®½
  
  # ç½‘ç»œå®¹é”™é…ç½®
  timeout: 120             # å¢å¤§è¶…æ—¶ï¼Œé€‚åº”è·¨æœºæˆ¿å»¶è¿Ÿ
  max_retries: 5
  backoff:
    init: 5s
    max: 300s
    factor: 2
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé…ç½®


```yaml
# åŸºç¡€å¿…å¤‡é…ç½®
output.logstash:
  hosts: ["logstashæœåŠ¡å™¨åœ°å€:ç«¯å£"]    # å¿…é¡»é…ç½®
  worker: å·¥ä½œçº¿ç¨‹æ•°                    # å½±å“å‘é€æ€§èƒ½
  bulk_max_size: æ‰¹é‡å‘é€å¤§å°           # å½±å“å»¶è¿Ÿå’Œååé‡
  loadbalance: true/false             # å¤šèŠ‚ç‚¹è´Ÿè½½å‡è¡¡
  index: "ç´¢å¼•åç§°æ¨¡æ¿"                 # æ•°æ®å­˜å‚¨ä½ç½®
```

### 8.2 å…³é”®å‚æ•°è°ƒä¼˜æŒ‡å¯¼


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–å…³é”®å‚æ•°**ï¼š
```
å°è§„æ¨¡ï¼ˆ<1GB/å¤©ï¼‰ï¼š
- worker: 1-2
- bulk_max_size: 512-1024
- compression_level: 0-3

å¤§è§„æ¨¡ï¼ˆ>10GB/å¤©ï¼‰ï¼š
- worker: 4-8  
- bulk_max_size: 2048-4096
- compression_level: 3-6
```

**ğŸ”¹ ç½‘ç»œç¯å¢ƒé€‚é…**ï¼š
```
å±€åŸŸç½‘ç¯å¢ƒï¼š
- timeout: 30s
- compression_level: 0-3
- é‡ç‚¹å…³æ³¨ååé‡

è·¨æœºæˆ¿ç¯å¢ƒï¼š
- timeout: 60-120s  
- compression_level: 4-6
- é‡ç‚¹å…³æ³¨ç¨³å®šæ€§
```

### 8.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**âŒ æ•°æ®å‘é€ç¼“æ…¢**ï¼š
- å¢åŠ `worker`æ•°é‡
- è°ƒå¤§`bulk_max_size`
- æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ

**âŒ è¿æ¥ç»å¸¸æ–­å¼€**ï¼š
- å¢å¤§`timeout`å€¼
- é…ç½®åˆç†çš„`backoff`ç­–ç•¥
- æ£€æŸ¥LogstashæœåŠ¡çŠ¶æ€

**âŒ å†…å­˜å ç”¨è¿‡é«˜**ï¼š
- å‡å°`bulk_max_size`
- é™ä½`worker`æ•°é‡
- å¯ç”¨`compression`

### 8.4 é…ç½®æœ€ä½³å®è·µ


**âœ… é…ç½®åŸåˆ™**ï¼š
1. **å…ˆæ±‚ç¨³å®šï¼Œå†æ±‚æ€§èƒ½**ï¼šç¡®ä¿æ•°æ®ä¸ä¸¢å¤±æ˜¯é¦–è¦ç›®æ ‡
2. **æ ¹æ®è§„æ¨¡è°ƒæ•´**ï¼šå°ç¯å¢ƒç”¨ä¿å®ˆé…ç½®ï¼Œå¤§ç¯å¢ƒé€‚åº¦æ¿€è¿›
3. **ç›‘æ§é©±åŠ¨ä¼˜åŒ–**ï¼šé€šè¿‡ç›‘æ§æŒ‡æ ‡è°ƒæ•´å‚æ•°
4. **å†—ä½™ä¿éšœ**ï¼šå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœ

**âœ… éƒ¨ç½²å»ºè®®**ï¼š
```yaml
# æ¨èçš„é€šç”¨é…ç½®æ¨¡æ¿
output.logstash:
  hosts: ["logstash1:5044", "logstash2:5044"]  # è‡³å°‘2ä¸ªèŠ‚ç‚¹
  loadbalance: true                            # å¯ç”¨è´Ÿè½½å‡è¡¡
  worker: 2                                   # é€‚ä¸­çš„å·¥ä½œçº¿ç¨‹
  bulk_max_size: 1024                         # å¹³è¡¡å»¶è¿Ÿå’Œæ€§èƒ½
  compression_level: 3                        # é€‚åº¦å‹ç¼©
  timeout: 30                                 # åˆç†è¶…æ—¶æ—¶é—´
  max_retries: 3                              # é€‚åº¦é‡è¯•
  slow_start: true                            # å¯ç”¨æ…¢å¯åŠ¨
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Logstashè¾“å‡ºé€æ—¥å¿—ï¼Œhostsé…ç½®æ˜¯åŸºç¡€
- workerçº¿ç¨‹æ§é€Ÿåº¦ï¼Œbulkæ‰¹é‡å¾ˆé‡è¦  
- è´Ÿè½½å‡è¡¡ä¿é«˜å¯ç”¨ï¼Œå‹ç¼©ä¼ è¾“çœå¸¦å®½
- é€€é¿é‡è¯•é˜²é›ªå´©ï¼Œç´¢å¼•å‘½åè¦è§„èŒƒ