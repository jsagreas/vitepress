---
title: 18ã€æ¡ä»¶è¿‡æ»¤ä¸è·¯ç”±é…ç½®
---
## ğŸ“š ç›®å½•


1. [æ¡ä»¶è¿‡æ»¤åŸºç¡€æ¦‚å¿µ](#1-æ¡ä»¶è¿‡æ»¤åŸºç¡€æ¦‚å¿µ)
2. [drop_eventäº‹ä»¶ä¸¢å¼ƒå¤„ç†å™¨](#2-drop_eventäº‹ä»¶ä¸¢å¼ƒå¤„ç†å™¨)
3. [whenæ¡ä»¶è¯­æ³•è¯¦è§£](#3-whenæ¡ä»¶è¯­æ³•è¯¦è§£)
4. [åŸºç¡€æ¡ä»¶åˆ¤æ–­æ“ä½œ](#4-åŸºç¡€æ¡ä»¶åˆ¤æ–­æ“ä½œ)
5. [å­—ç¬¦ä¸²åŒ¹é…ä¸æ­£åˆ™è¡¨è¾¾å¼](#5-å­—ç¬¦ä¸²åŒ¹é…ä¸æ­£åˆ™è¡¨è¾¾å¼)
6. [æ•°å€¼ä¸å­—æ®µåˆ¤æ–­](#6-æ•°å€¼ä¸å­—æ®µåˆ¤æ–­)
7. [é€»è¾‘è¿ç®—ç¬¦ç»„åˆ](#7-é€»è¾‘è¿ç®—ç¬¦ç»„åˆ)
8. [ç½‘ç»œæ¡ä»¶åˆ¤æ–­](#8-ç½‘ç»œæ¡ä»¶åˆ¤æ–­)
9. [å®é™…åº”ç”¨åœºæ™¯](#9-å®é™…åº”ç”¨åœºæ™¯)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**: éœ€è¦äº†è§£FilebeatåŸºç¡€é…ç½®ã€æ—¥å¿—æ ¼å¼ â†’ **å½“å‰å†…å®¹**: æ¡ä»¶è¿‡æ»¤ä¸è·¯ç”± â†’ **åç»­å­¦ä¹ **: Elasticsearchç´¢å¼•ç®¡ç†

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**: æœ¬ç« 45åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**: `#Filebeatæ ¸å¿ƒ` `#æ—¥å¿—å¤„ç†` `#å¿…æŒæ¡æŠ€èƒ½`

---

## 1. ğŸ¤” æ¡ä»¶è¿‡æ»¤åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯æ¡ä»¶è¿‡æ»¤



**ğŸ”¸ ç”Ÿæ´»åŒ–ç†è§£**
æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªé‚®é€’å‘˜ï¼Œæ¯å¤©è¦å¤„ç†å¾ˆå¤šä¿¡ä»¶ï¼š
- **æ²¡æœ‰è¿‡æ»¤**: æŠŠæ‰€æœ‰ä¿¡ä»¶éƒ½é€åˆ°åŒä¸€ä¸ªåœ°æ–¹ï¼Œä¸ç®¡æ˜¯åƒåœ¾é‚®ä»¶è¿˜æ˜¯é‡è¦æ–‡ä»¶
- **æœ‰æ¡ä»¶è¿‡æ»¤**: çœ‹ä¿¡ä»¶å†…å®¹ï¼Œåƒåœ¾é‚®ä»¶ç›´æ¥æ‰”æ‰ï¼Œé‡è¦é‚®ä»¶é€åˆ°å¯¹åº”éƒ¨é—¨

**ğŸ“‹ æŠ€æœ¯å®šä¹‰**
```
æ¡ä»¶è¿‡æ»¤: æ ¹æ®æ—¥å¿—å†…å®¹çš„ç‰¹å®šæ¡ä»¶ï¼Œå†³å®šå¦‚ä½•å¤„ç†è¿™æ¡æ—¥å¿—
- ä¿ç•™: ç»§ç»­å‘é€åˆ°Elasticsearch
- ä¸¢å¼ƒ: ç›´æ¥åˆ é™¤ï¼Œä¸å ç”¨å­˜å‚¨ç©ºé—´  
- è·¯ç”±: å‘é€åˆ°ä¸åŒçš„ç›®æ ‡ä½ç½®
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¡ä»¶è¿‡æ»¤



**ğŸ¯ ä¸»è¦ä»·å€¼**

**èŠ‚çœå­˜å‚¨ç©ºé—´**
```
åœºæ™¯: ç³»ç»Ÿæ¯åˆ†é’Ÿäº§ç”Ÿ1000æ¡æ—¥å¿—
é—®é¢˜: å…¶ä¸­800æ¡æ˜¯DEBUGçº§åˆ«çš„è°ƒè¯•ä¿¡æ¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸éœ€è¦
è§£å†³: ç”¨æ¡ä»¶è¿‡æ»¤åªä¿ç•™ERRORå’ŒWARNçº§åˆ«æ—¥å¿—
ç»“æœ: å­˜å‚¨ç©ºé—´å‡å°‘80%ï¼Œè´¹ç”¨å¤§å¹…é™ä½
```

**æå‡æŸ¥è¯¢æ€§èƒ½**
```
åŸç†: æ•°æ®é‡è¶Šå°ï¼ŒæŸ¥è¯¢è¶Šå¿«
æ•ˆæœ: 
- å‡å°‘æ— ç”¨æ•°æ® â†’ ç´¢å¼•æ›´å° â†’ æŸ¥è¯¢æ›´å¿«
- å‡å°‘ç½‘ç»œä¼ è¾“ â†’ å“åº”æ›´åŠæ—¶
```

**ç²¾å‡†é—®é¢˜å®šä½**
```
å¥½å¤„:
- è¿‡æ»¤æ‰å™ªéŸ³æ•°æ®ï¼Œçªå‡ºé‡è¦ä¿¡æ¯
- æŒ‰ä¸šåŠ¡æ¨¡å—åˆ†ç±»å­˜å‚¨ï¼Œä¾¿äºæ’æŸ¥
- æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ï¼Œä¿è¯å®‰å…¨åˆè§„
```

### 1.3 æ¡ä»¶è¿‡æ»¤çš„åŸºæœ¬æ€è·¯



**ğŸ”„ å¤„ç†æµç¨‹å›¾ç¤º**
```
æ—¥å¿—è¾“å…¥ â†’ è¯»å–å­—æ®µå†…å®¹ â†’ æ¡ä»¶åˆ¤æ–­ â†’ æ‰§è¡ŒåŠ¨ä½œ
    â†“           â†“           â†“         â†“
App.log â†’ messageå­—æ®µ â†’ åŒ…å«ERROR? â†’ æ˜¯:ä¿ç•™/å¦:ä¸¢å¼ƒ
```

**ğŸ’¡ è®¾è®¡åŸåˆ™**
- **å…ˆå®½åä¸¥**: ä»ç®€å•æ¡ä»¶å¼€å§‹ï¼Œé€æ­¥ç»†åŒ–
- **æµ‹è¯•éªŒè¯**: æ¯ä¸ªè¿‡æ»¤è§„åˆ™éƒ½è¦éªŒè¯æ•ˆæœ
- **æ–‡æ¡£è®°å½•**: å¤æ‚æ¡ä»¶è¦å†™æ¸…æ¥šç”¨é€”

---

## 2. ğŸ—‘ï¸ drop_eventäº‹ä»¶ä¸¢å¼ƒå¤„ç†å™¨



### 2.1 drop_eventåŸºç¡€æ¦‚å¿µ



**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
```
drop_event: Filebeatçš„"åƒåœ¾æ¡¶"å¤„ç†å™¨
åŠŸèƒ½: æ»¡è¶³æ¡ä»¶çš„æ—¥å¿—ç›´æ¥åˆ é™¤ï¼Œä¸ä¼šå‘é€åˆ°ä»»ä½•åœ°æ–¹
ç‰¹ç‚¹: ä¸å¯æ¢å¤ï¼Œåˆ é™¤åæ— æ³•æ‰¾å›
```

**âš ï¸ å®‰å…¨æé†’**
> ä½¿ç”¨drop_eventè¦è°¨æ…ï¼Œå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è§„åˆ™ï¼Œç¡®è®¤æ— è¯¯åå†åº”ç”¨åˆ°ç”Ÿäº§

### 2.2 åŸºç¡€è¯­æ³•ç»“æ„



**ğŸ“ é…ç½®æ ¼å¼**
```yaml
processors:
- drop_event:
    when:
      æ¡ä»¶è¡¨è¾¾å¼
```

**ğŸŒŸ ç¬¬ä¸€ä¸ªä¾‹å­**
```yaml
# åˆ é™¤æ‰€æœ‰DEBUGçº§åˆ«çš„æ—¥å¿—

processors:
- drop_event:
    when:
      contains:
        message: "DEBUG"
```

**é€šä¿—è§£é‡Š**: å¦‚æœæ—¥å¿—æ¶ˆæ¯ä¸­åŒ…å«"DEBUG"è¿™ä¸ªè¯ï¼Œå°±æŠŠæ•´æ¡æ—¥å¿—åˆ æ‰

### 2.3 å¸¸è§åº”ç”¨åœºæ™¯



**ğŸ¯ åœºæ™¯1: è¿‡æ»¤è°ƒè¯•ä¿¡æ¯**
```yaml
# ç”Ÿäº§ç¯å¢ƒä¸éœ€è¦DEBUGå’ŒTRACEæ—¥å¿—

processors:
- drop_event:
    when:
      or:
        - contains:
            message: "DEBUG"
        - contains:
            message: "TRACE"
```

**ğŸ¯ åœºæ™¯2: å»é™¤å¿ƒè·³æ£€æŸ¥**
```yaml
# å¥åº·æ£€æŸ¥æ—¥å¿—å¤ªé¢‘ç¹ï¼Œæ²¡æœ‰ä¸šåŠ¡ä»·å€¼

processors:
- drop_event:
    when:
      contains:
        message: "health check"
```

**ğŸ¯ åœºæ™¯3: è¿‡æ»¤ç‰¹å®šIPè®¿é—®**
```yaml
# è¿‡æ»¤å†…éƒ¨ç›‘æ§ç³»ç»Ÿçš„è®¿é—®æ—¥å¿—

processors:
- drop_event:
    when:
      equals:
        client_ip: "192.168.1.100"
```

### 2.4 drop_eventé…ç½®æ³¨æ„äº‹é¡¹



**âœ… æœ€ä½³å®è·µ**
- **å°æ­¥è¯•éªŒ**: å…ˆè®¾ç½®è¾ƒä¸¥æ ¼çš„æ¡ä»¶ï¼Œè§‚å¯Ÿæ•ˆæœåå†æ”¾å®½
- **ä¿ç•™æ ·æœ¬**: å¯ä»¥è®¾ç½®åªä¸¢å¼ƒ90%ï¼Œä¿ç•™10%ç”¨äºç›‘æ§
- **å®šæœŸå›é¡¾**: å®šæœŸæ£€æŸ¥ä¸¢å¼ƒè§„åˆ™æ˜¯å¦è¿˜åˆé€‚

**âŒ å¸¸è§é”™è¯¯**
```yaml
# é”™è¯¯: æ¡ä»¶å¤ªå®½æ³›ï¼Œå¯èƒ½åˆ é™¤é‡è¦æ—¥å¿—  

processors:
- drop_event:
    when:
      contains:
        message: "error"  # ä¼šåˆ é™¤æ‰€æœ‰åŒ…å«errorçš„æ—¥å¿—ï¼ŒåŒ…æ‹¬é”™è¯¯æŠ¥å‘Š
        
# æ­£ç¡®: æ¡ä»¶å…·ä½“åŒ–

processors:
- drop_event:
    when:
      equals:
        log.level: "DEBUG"  # åªåˆ é™¤DEBUGçº§åˆ«æ—¥å¿—
```

---

## 3. ğŸ“‹ whenæ¡ä»¶è¯­æ³•è¯¦è§£



### 3.1 whenå­å¥åŸºç¡€



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
when: æ¡ä»¶åˆ¤æ–­çš„å…³é”®å­—ï¼Œç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ifè¯­å¥
ä½œç”¨: å®šä¹‰ä»€ä¹ˆæƒ…å†µä¸‹æ‰§è¡ŒæŸä¸ªå¤„ç†å™¨
è¯­æ³•: whenå­å¥åé¢è·Ÿå…·ä½“çš„æ¡ä»¶è¡¨è¾¾å¼
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
```
ç”Ÿæ´»ä¸­: "å½“å¤©æ°”ä¸‹é›¨æ—¶ï¼Œæˆ‘å°±å¸¦ä¼"
Filebeatä¸­: "å½“æ—¥å¿—çº§åˆ«æ˜¯ERRORæ—¶ï¼Œå°±å‘é€å‘Šè­¦"
```

### 3.2 whenè¯­æ³•ç»“æ„



**ğŸ“‹ åŸºæœ¬æ ¼å¼**
```yaml
processors:
- å¤„ç†å™¨åç§°:
    when:
      æ¡ä»¶ç±»å‹:
        å­—æ®µå: æœŸæœ›å€¼
```

**ğŸŒŸ è¯­æ³•ç¤ºä¾‹**
```yaml
# åŸºç¡€æ¡ä»¶

processors:
- drop_event:
    when:
      equals:           # æ¡ä»¶ç±»å‹
        log.level: "DEBUG"  # å­—æ®µå: æœŸæœ›å€¼

# å¤æ‚æ¡ä»¶

processors:
- drop_event:
    when:
      and:              # é€»è¾‘è¿ç®—ç¬¦
        - equals:
            log.level: "INFO"
        - contains:
            message: "success"
```

### 3.3 å­—æ®µå¼•ç”¨æ–¹å¼



**ğŸ” å­—æ®µè·¯å¾„è¡¨ç¤ºæ³•**

**ç‚¹å·åˆ†éš”æ³•**
```yaml
# å¼•ç”¨åµŒå¥—å­—æ®µ

when:
  equals:
    log.level: "ERROR"        # ç®€å•å­—æ®µ
    user.name: "admin"        # åµŒå¥—å­—æ®µ
    request.headers.host: "api.example.com"  # æ·±å±‚åµŒå¥—
```

**æ–¹æ‹¬å·è¡¨ç¤ºæ³•**
```yaml
# å½“å­—æ®µååŒ…å«ç‰¹æ®Šå­—ç¬¦æ—¶ä½¿ç”¨

when:
  equals:
    "[log][level]": "ERROR"
    "[user-info][user-name]": "admin"
```

**ğŸ¯ å®ç”¨æŠ€å·§**
```yaml
# è·å–å­—æ®µå€¼çš„å¸¸ç”¨ä½ç½®

fields:
  - message          # åŸå§‹æ—¥å¿—å†…å®¹
  - "@timestamp"     # æ—¶é—´æˆ³
  - log.level        # æ—¥å¿—çº§åˆ«(å¦‚æœè§£æè¿‡)
  - source.ip        # æ¥æºIP
  - url.path         # URLè·¯å¾„
```

### 3.4 æ¡ä»¶è¯­æ³•è°ƒè¯•æŠ€å·§



**ğŸ”§ æµ‹è¯•æ–¹æ³•**
1. **æ·»åŠ è°ƒè¯•è¾“å‡º**: å…ˆç”¨add_fieldsæ·»åŠ æµ‹è¯•å­—æ®µï¼Œçœ‹æ¡ä»¶æ˜¯å¦åŒ¹é…
2. **é€æ­¥ç»†åŒ–**: ä»ç®€å•æ¡ä»¶å¼€å§‹ï¼Œé€æ­¥æ·»åŠ å¤æ‚é€»è¾‘
3. **æŸ¥çœ‹æ—¥å¿—**: è§‚å¯ŸFilebeatæ—¥å¿—ï¼Œçœ‹æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

**è°ƒè¯•é…ç½®ç¤ºä¾‹**
```yaml
# è°ƒè¯•ä¸“ç”¨é…ç½®

processors:
# å…ˆæ·»åŠ æ ‡è®°ï¼Œçœ‹å“ªäº›æ—¥å¿—åŒ¹é…æ¡ä»¶

- add_fields:
    when:
      contains:
        message: "ERROR"
    fields:
      debug_matched: "yes"
    target: ""

# å†åº”ç”¨å®é™…å¤„ç†

- drop_event:
    when:
      contains:
        message: "ERROR"
```

---

## 4. âš–ï¸ åŸºç¡€æ¡ä»¶åˆ¤æ–­æ“ä½œ



### 4.1 equalsç²¾ç¡®åŒ¹é…



**ğŸ”¸ æ¦‚å¿µè¯´æ˜**
```
equals: å®Œå…¨ç›¸ç­‰åˆ¤æ–­ï¼Œå­—ç¬¦å¿…é¡»å®Œå…¨ä¸€è‡´
ç‰¹ç‚¹: åŒºåˆ†å¤§å°å†™ï¼Œç²¾ç¡®åŒ¹é…
é€‚ç”¨: çŠ¶æ€ç ã€æ—¥å¿—çº§åˆ«ç­‰å›ºå®šå€¼åˆ¤æ–­
```

**ğŸ“ åŸºç¡€ç”¨æ³•**
```yaml
# åŒ¹é…ç‰¹å®šHTTPçŠ¶æ€ç 

processors:
- drop_event:
    when:
      equals:
        response.status_code: 200

# åŒ¹é…æ—¥å¿—çº§åˆ«

processors:
- add_tags:
    when:
      equals:
        log.level: "ERROR"
    tags: ["critical"]
```

**ğŸ¯ å®é™…æ¡ˆä¾‹**
```yaml
# è¿‡æ»¤æˆåŠŸçš„ç”¨æˆ·ç™»å½•æ—¥å¿—

processors:
- drop_event:
    when:
      and:
        - equals:
            event.action: "user_login"
        - equals:
            event.outcome: "success"
```

### 4.2 notå–åæ“ä½œ



**ğŸ”¸ æ¦‚å¿µè¯´æ˜**
```
not: æ¡ä»¶å–åï¼Œæ»¡è¶³æ¡ä»¶æ—¶ä¸æ‰§è¡Œï¼Œä¸æ»¡è¶³æ—¶æ‰§è¡Œ
é€»è¾‘: æŠŠTrueå˜Falseï¼ŒFalseå˜True
ç”¨é€”: ä¿ç•™é™¤äº†æŸäº›æ¡ä»¶å¤–çš„æ‰€æœ‰æ—¥å¿—
```

**ğŸ“ åŸºç¡€è¯­æ³•**
```yaml
# ä¿ç•™æ‰€æœ‰éDEBUGæ—¥å¿—

processors:
- drop_event:
    when:
      not:
        equals:
          log.level: "DEBUG"
```

**ğŸŒŸ å¯¹æ¯”ç†è§£**
```yaml
# æ–¹æ³•1: åˆ é™¤DEBUGæ—¥å¿—

processors:
- drop_event:
    when:
      equals:
        log.level: "DEBUG"

# æ–¹æ³•2: ä¿ç•™éDEBUGæ—¥å¿—(æ•ˆæœç›¸åŒ)

processors:
- drop_event:
    when:
      not:
        equals:
          log.level: "DEBUG"
```

**å®é™…åº”ç”¨åœºæ™¯**
```yaml
# åªå¤„ç†ä¸šåŠ¡ç›¸å…³æ—¥å¿—ï¼Œè¿‡æ»¤ç³»ç»Ÿæ—¥å¿—

processors:
- drop_event:
    when:
      not:
        contains:
          log.file.path: "/app/logs/"
```

### 4.3 å¤šå€¼åŒ¹é…æŠ€å·§



**ğŸ¯ åŒ¹é…å¤šä¸ªçŠ¶æ€ç **
```yaml
# è¿‡æ»¤å¤šä¸ªæˆåŠŸçŠ¶æ€ç 

processors:
- drop_event:
    when:
      or:
        - equals:
            response.status_code: 200
        - equals:
            response.status_code: 201
        - equals:
            response.status_code: 204
```

**ğŸ“‹ æ›´ä¼˜é›…çš„å†™æ³•**
```yaml
# ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…èŒƒå›´

processors:
- drop_event:
    when:
      regexp:
        response.status_code: "^2[0-9][0-9]$"  # æ‰€æœ‰2xxçŠ¶æ€ç 
```

---

## 5. ğŸ” å­—ç¬¦ä¸²åŒ¹é…ä¸æ­£åˆ™è¡¨è¾¾å¼



### 5.1 containsåŒ…å«åŒ¹é…



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
contains: æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šå­ä¸²
ç‰¹ç‚¹: ä¸éœ€è¦å®Œå…¨åŒ¹é…ï¼Œåªè¦åŒ…å«å°±ç®—åŒ¹é…
ä¼˜åŠ¿: ç®€å•çµæ´»ï¼Œé€‚åˆæ¨¡ç³ŠåŒ¹é…
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
```
é—®é¢˜: "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"è¿™å¥è¯é‡Œæ˜¯å¦åŒ…å«"å¤©æ°”"ï¼Ÿ
ç­”æ¡ˆ: æ˜¯çš„ï¼ŒåŒ…å«"å¤©æ°”"ä¸¤ä¸ªå­—
containså°±æ˜¯è¿™æ ·å·¥ä½œçš„
```

### 5.2 containså®é™…åº”ç”¨



**ğŸ“ åŸºç¡€ç”¨æ³•**
```yaml
# è¿‡æ»¤åŒ…å«æ•æ„Ÿè¯çš„æ—¥å¿—

processors:
- drop_event:
    when:
      contains:
        message: "password"

# ä¿ç•™é”™è¯¯ç›¸å…³æ—¥å¿—

processors:
- add_tags:
    when:
      contains:
        message: "exception"
    tags: ["error_related"]
```

**ğŸ¯ å¤æ‚åŒ¹é…åœºæ™¯**
```yaml
# åŒ¹é…å¤šç§é”™è¯¯å…³é”®è¯

processors:
- add_fields:
    when:
      or:
        - contains:
            message: "ERROR"
        - contains:
            message: "Exception"
        - contains:
            message: "Failed"
    fields:
      alert_level: "high"
```

### 5.3 regexpæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…



**ğŸ”¸ æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€**
```
regexp: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…
èƒ½åŠ›: æ”¯æŒå¤æ‚çš„å­—ç¬¦ä¸²æ¨¡å¼è¯†åˆ«
å­¦ä¹ : éœ€è¦æŒæ¡åŸºæœ¬æ­£åˆ™è¯­æ³•
```

**ğŸ“š å¸¸ç”¨æ­£åˆ™æ¨¡å¼**

| **æ¨¡å¼** | **å«ä¹‰** | **ç¤ºä¾‹** |
|---------|---------|---------|
| `^` | è¡Œå¼€å§‹ | `^ERROR` åŒ¹é…ä»¥ERRORå¼€å¤´çš„è¡Œ |
| `$` | è¡Œç»“æŸ | `success$` åŒ¹é…ä»¥successç»“å°¾çš„è¡Œ |
| `.*` | ä»»æ„å­—ç¬¦ | `user.*login` åŒ¹é…userå’Œloginé—´æœ‰ä»»æ„å­—ç¬¦ |
| `[0-9]+` | æ•°å­— | `[0-9]+` åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­— |
| `\d{1,3}` | 1-3ä½æ•°å­— | åŒ¹é…IPåœ°å€ä¸­çš„æ•°å­—éƒ¨åˆ† |

### 5.4 æ­£åˆ™è¡¨è¾¾å¼å®é™…åº”ç”¨



**ğŸŒŸ IPåœ°å€åŒ¹é…**
```yaml
# åŒ¹é…å†…ç½‘IPè®¿é—®

processors:
- add_tags:
    when:
      regexp:
        client_ip: "^192\.168\."
    tags: ["internal_access"]
```

**ğŸŒŸ HTTPçŠ¶æ€ç åˆ†ç±»**
```yaml
# åŒ¹é…æ‰€æœ‰4xxé”™è¯¯

processors:
- add_fields:
    when:
      regexp:
        response.status_code: "^4[0-9][0-9]$"
    fields:
      error_type: "client_error"
```

**ğŸŒŸ æ—¶é—´æ ¼å¼åŒ¹é…**
```yaml
# åŒ¹é…ç‰¹å®šæ—¶é—´æ ¼å¼çš„æ—¥å¿—

processors:
- drop_event:
    when:
      not:
        regexp:
          "@timestamp": "^2024-"  # åªä¿ç•™2024å¹´çš„æ—¥å¿—
```

### 5.5 å­—ç¬¦ä¸²åŒ¹é…æœ€ä½³å®è·µ



**âœ… æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```yaml
# ä¼˜å…ˆçº§æ’åº: ç®€å•æ¡ä»¶æ”¾å‰é¢

processors:
- drop_event:
    when:
      and:
        - equals:           # æœ€å¿«
            log.level: "DEBUG"
        - contains:         # ä¸­ç­‰
            message: "test"
        - regexp:           # æœ€æ…¢
            user.name: "^test_.*"
```

**âš ï¸ å¸¸è§é™·é˜±**
```yaml
# é”™è¯¯: æ­£åˆ™è¡¨è¾¾å¼æœªè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

when:
  regexp:
    message: "192.168.1.1"  # é”™è¯¯: .ä¼šåŒ¹é…ä»»æ„å­—ç¬¦

# æ­£ç¡®: è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

when:
  regexp:
    message: "192\\.168\\.1\\.1"  # æ­£ç¡®: \.åŒ¹é…ç‚¹å·
```

---

## 6. ğŸ”¢ æ•°å€¼ä¸å­—æ®µåˆ¤æ–­



### 6.1 rangeæ•°å€¼èŒƒå›´åˆ¤æ–­



**ğŸ”¸ æ¦‚å¿µç†è§£**
```
range: åˆ¤æ–­æ•°å€¼æ˜¯å¦åœ¨æŒ‡å®šèŒƒå›´å†…
è¯­æ³•: æ”¯æŒå¤§äº(gt)ã€å°äº(lt)ã€å¤§äºç­‰äº(gte)ã€å°äºç­‰äº(lte)
ç”¨é€”: å“åº”æ—¶é—´ã€æ–‡ä»¶å¤§å°ã€çŠ¶æ€ç ç­‰æ•°å€¼åˆ¤æ–­
```

**ğŸ“Š èŒƒå›´æ“ä½œç¬¦è¯´æ˜**

| **æ“ä½œç¬¦** | **å«ä¹‰** | **ç¤ºä¾‹** |
|-----------|---------|---------|
| `gt` | å¤§äº | `gt: 1000` å¤§äº1000 |
| `gte` | å¤§äºç­‰äº | `gte: 500` å¤§äºç­‰äº500 |
| `lt` | å°äº | `lt: 100` å°äº100 |
| `lte` | å°äºç­‰äº | `lte: 200` å°äºç­‰äº200 |

### 6.2 rangeå®é™…åº”ç”¨



**ğŸ¯ å“åº”æ—¶é—´è¿‡æ»¤**
```yaml
# åªå…³æ³¨æ…¢æŸ¥è¯¢(å“åº”æ—¶é—´>3ç§’)

processors:
- add_tags:
    when:
      range:
        response_time:
          gt: 3000  # å¤§äº3000æ¯«ç§’
    tags: ["slow_query"]

# è¿‡æ»¤å¤ªå¿«çš„å“åº”(å¯èƒ½æ˜¯ç¼“å­˜å‘½ä¸­)

- drop_event:
    when:
      range:
        response_time:
          lt: 10    # å°äº10æ¯«ç§’
```

**ğŸ¯ HTTPçŠ¶æ€ç èŒƒå›´**
```yaml
# æ ‡è®°å®¢æˆ·ç«¯é”™è¯¯(4xxçŠ¶æ€ç )

processors:
- add_fields:
    when:
      range:
        response.status_code:
          gte: 400
          lt: 500
    fields:
      error_category: "client_error"
```

**ğŸ¯ ç»„åˆèŒƒå›´æ¡ä»¶**
```yaml
# æ ‡è®°å¼‚å¸¸å“åº”æ—¶é—´çš„æˆåŠŸè¯·æ±‚

processors:
- add_tags:
    when:
      and:
        - equals:
            response.status_code: 200
        - range:
            response_time:
              gt: 5000  # æˆåŠŸä½†å¾ˆæ…¢çš„è¯·æ±‚
    tags: ["slow_success"]
```

### 6.3 has_fieldså­—æ®µå­˜åœ¨åˆ¤æ–­



**ğŸ”¸ åŸºç¡€æ¦‚å¿µ**
```
has_fields: æ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨
ä½œç”¨: ç¡®ä¿å¤„ç†çš„æ—¥å¿—åŒ…å«å¿…è¦å­—æ®µ
åœºæ™¯: ä¸åŒæ—¥å¿—æ ¼å¼æ··åˆæ—¶çš„é¢„å¤„ç†
```

**ğŸ“ åŸºç¡€è¯­æ³•**
```yaml
# åªå¤„ç†åŒ…å«userå­—æ®µçš„æ—¥å¿—

processors:
- add_tags:
    when:
      has_fields: ['user.name']
    tags: ["user_action"]

# æ£€æŸ¥å¤šä¸ªå­—æ®µ

processors:
- drop_event:
    when:
      not:
        has_fields: ['timestamp', 'level', 'message']
```

### 6.4 å­—æ®µåˆ¤æ–­å®é™…åº”ç”¨



**ğŸ¯ æ—¥å¿—æ ¼å¼éªŒè¯**
```yaml
# ç¡®ä¿Webè®¿é—®æ—¥å¿—æ ¼å¼å®Œæ•´

processors:
- drop_event:
    when:
      not:
        has_fields: 
          - 'client_ip'
          - 'request_method'
          - 'response.status_code'
          - 'response_time'
```

**ğŸ¯ æ¡ä»¶æ€§å­—æ®µå¤„ç†**
```yaml
# åªæœ‰å½“å­˜åœ¨é”™è¯¯ç æ—¶æ‰æ·»åŠ å‘Šè­¦æ ‡ç­¾

processors:
- add_tags:
    when:
      and:
        - has_fields: ['error.code']
        - not:
            equals:
              error.code: "0"
    tags: ["error_alert"]
```

### 6.5 æ•°å€¼åˆ¤æ–­æŠ€å·§ä¸é™·é˜±



**ğŸ’¡ ç±»å‹è½¬æ¢æ³¨æ„äº‹é¡¹**
```yaml
# æ³¨æ„: ç¡®ä¿å­—æ®µæ˜¯æ•°å€¼ç±»å‹

processors:
# é”™è¯¯: å­—ç¬¦ä¸²"500"ä¸èƒ½ç”¨rangeæ¯”è¾ƒ

- range:
    status_code_string: 
      gt: 400

# æ­£ç¡®: æ•°å€¼500å¯ä»¥æ¯”è¾ƒ

- range:
    status_code_number:
      gt: 400
```

**ğŸ”§ æ•°æ®ç±»å‹å¤„ç†**
```yaml
# å…ˆè½¬æ¢ç±»å‹ï¼Œå†è¿›è¡Œæ•°å€¼åˆ¤æ–­

processors:
- convert:
    fields:
      - {from: "response.status_code", to: "response.status_code_int", type: "integer"}
- add_tags:
    when:
      range:
        response.status_code_int:
          gte: 500
    tags: ["server_error"]
```

---

## 7. ğŸ”— é€»è¾‘è¿ç®—ç¬¦ç»„åˆ



### 7.1 andé€»è¾‘ä¸æ“ä½œ



**ğŸ”¸ æ¦‚å¿µç†è§£**
```
and: æ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³æ‰ç®—åŒ¹é…
é€»è¾‘: æ¡ä»¶1 AND æ¡ä»¶2 AND æ¡ä»¶3...
ç‰¹ç‚¹: æ¡ä»¶è¶Šå¤šï¼ŒåŒ¹é…è¶Šä¸¥æ ¼
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
```
æ‰¾å·¥ä½œè¦æ±‚: "å·¥ä½œç»éªŒ3å¹´ä»¥ä¸Š AND ç†Ÿæ‚‰Python AND æœ‰å›¢é˜Ÿç®¡ç†ç»éªŒ"
å¿…é¡»ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ‰ç®—ç¬¦åˆè¦æ±‚
Filebeatçš„andä¹Ÿæ˜¯è¿™æ ·å·¥ä½œçš„
```

### 7.2 andæ“ä½œå®é™…åº”ç”¨



**ğŸ“ åŸºç¡€è¯­æ³•**
```yaml
# åˆ é™¤ç‰¹å®šç”¨æˆ·çš„DEBUGæ—¥å¿—

processors:
- drop_event:
    when:
      and:
        - equals:
            log.level: "DEBUG"
        - equals:
            user.name: "test_user"
        - contains:
            message: "unittest"
```

**ğŸ¯ å¤æ‚ä¸šåŠ¡åœºæ™¯**
```yaml
# æ ‡è®°é«˜ä»·å€¼ç”¨æˆ·çš„å¼‚å¸¸è¡Œä¸º

processors:
- add_tags:
    when:
      and:
        - equals:
            user.type: "premium"     # é«˜çº§ç”¨æˆ·
        - range:
            response_time:
              gt: 10000             # å“åº”æ—¶é—´>10ç§’
        - range:
            response.status_code:
              gte: 500              # æœåŠ¡å™¨é”™è¯¯
    tags: ["vip_user_issue"]
```

### 7.3 oré€»è¾‘æˆ–æ“ä½œ



**ğŸ”¸ æ¦‚å¿µç†è§£**
```
or: ä»»æ„ä¸€ä¸ªæ¡ä»¶æ»¡è¶³å°±ç®—åŒ¹é…
é€»è¾‘: æ¡ä»¶1 OR æ¡ä»¶2 OR æ¡ä»¶3...
ç‰¹ç‚¹: æ¡ä»¶è¶Šå¤šï¼ŒåŒ¹é…è¶Šå®½æ¾
```

**ğŸ“ åŸºç¡€è¯­æ³•**
```yaml
# åŒ¹é…å¤šç§é”™è¯¯ç±»å‹

processors:
- add_tags:
    when:
      or:
        - contains:
            message: "ERROR"
        - contains:
            message: "Exception"
        - contains:
            message: "Failed"
        - range:
            response.status_code:
              gte: 500
    tags: ["error_related"]
```

### 7.4 å¤æ‚é€»è¾‘ç»„åˆ



**ğŸ¯ åµŒå¥—é€»è¾‘ç»“æ„**
```yaml
# å¤æ‚çš„ä¸šåŠ¡è§„åˆ™ç»„åˆ

processors:
- add_fields:
    when:
      and:
#        # å¿…é¡»æ˜¯APIè¯·æ±‚
        - contains:
            url.path: "/api/"
#        # å¹¶ä¸”æ»¡è¶³ä»¥ä¸‹ä»»ä¸€å¼‚å¸¸æ¡ä»¶
        - or:
#            # å“åº”æ—¶é—´è¿‡é•¿
            - range:
                response_time:
                  gt: 5000
#            # æˆ–è€…æ˜¯é”™è¯¯çŠ¶æ€
            - range:
                response.status_code:
                  gte: 400
    fields:
      alert_type: "api_performance_issue"
```

**ğŸ“Š é€»è¾‘å…³ç³»è¡¨**

| **ç»„åˆ** | **æ¡ä»¶A** | **æ¡ä»¶B** | **andç»“æœ** | **orç»“æœ** |
|---------|----------|----------|-----------|----------|
| æƒ…å†µ1 | âœ… æ»¡è¶³ | âœ… æ»¡è¶³ | âœ… åŒ¹é… | âœ… åŒ¹é… |
| æƒ…å†µ2 | âœ… æ»¡è¶³ | âŒ ä¸æ»¡è¶³ | âŒ ä¸åŒ¹é… | âœ… åŒ¹é… |
| æƒ…å†µ3 | âŒ ä¸æ»¡è¶³ | âœ… æ»¡è¶³ | âŒ ä¸åŒ¹é… | âœ… åŒ¹é… |
| æƒ…å†µ4 | âŒ ä¸æ»¡è¶³ | âŒ ä¸æ»¡è¶³ | âŒ ä¸åŒ¹é… | âŒ ä¸åŒ¹é… |

### 7.5 noté€»è¾‘éæ“ä½œ



**ğŸ”¸ æ¦‚å¿µè¯´æ˜**
```
not: æ¡ä»¶å–åæ“ä½œ
é€»è¾‘: æ»¡è¶³æ¡ä»¶æ—¶å˜ä¸ºä¸æ»¡è¶³ï¼Œä¸æ»¡è¶³æ—¶å˜ä¸ºæ»¡è¶³
ç”¨é€”: æ’é™¤ç‰¹å®šæƒ…å†µï¼Œä¿ç•™å…¶ä»–æ‰€æœ‰æƒ…å†µ
```

**ğŸ“ å®é™…åº”ç”¨**
```yaml
# ä¿ç•™æ‰€æœ‰éæµ‹è¯•ç¯å¢ƒçš„æ—¥å¿—

processors:
- drop_event:
    when:
      not:
        and:
          - contains:
              source.environment: "test"
          - contains:
              user.name: "test_"
```

**ğŸ¯ å¤æ‚notç»„åˆ**
```yaml
# åªå¤„ç†é‡è¦çš„ä¸šåŠ¡æ—¥å¿—

processors:
- drop_event:
    when:
      or:
#        # æ’é™¤å¥åº·æ£€æŸ¥
        - contains:
            url.path: "/health"
#        # æ’é™¤é™æ€èµ„æº
        - regexp:
            url.path: "\\.(css|js|png|jpg)$"
#        # æ’é™¤å†…éƒ¨IP
        - not:
            regexp:
              client_ip: "^(10\\.|192\\.168\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.)"
```

---

## 8. ğŸŒ ç½‘ç»œæ¡ä»¶åˆ¤æ–­



### 8.1 networkæ¡ä»¶åŸºç¡€



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
network: ä¸“é—¨ç”¨äºç½‘ç»œç›¸å…³çš„æ¡ä»¶åˆ¤æ–­
åŠŸèƒ½: IPåœ°å€èŒƒå›´ã€CIDRç½‘æ®µã€ç½‘ç»œå½’å±åˆ¤æ–­
ä¼˜åŠ¿: æ¯”æ­£åˆ™è¡¨è¾¾å¼æ›´ç²¾ç¡®å’Œé«˜æ•ˆ
```

**ğŸ’¡ ç†è§£CIDRè¡¨ç¤ºæ³•**
```
CIDR: æ— ç±»åŸŸé—´è·¯ç”±(Classless Inter-Domain Routing)
æ ¼å¼: IPåœ°å€/å‰ç¼€é•¿åº¦
ç¤ºä¾‹: 
- 192.168.1.0/24 è¡¨ç¤º 192.168.1.1 åˆ° 192.168.1.254
- 10.0.0.0/8 è¡¨ç¤º 10.0.0.1 åˆ° 10.255.255.254
```

### 8.2 ç½‘ç»œæ¡ä»¶è¯­æ³•



**ğŸ“ åŸºç¡€è¯­æ³•æ ¼å¼**
```yaml
when:
  network:
    å­—æ®µå: 
      - "IPåœ°å€æˆ–CIDRç½‘æ®µ"
      - "å¦ä¸€ä¸ªç½‘æ®µ"
```

**ğŸŒŸ åŸºç¡€åº”ç”¨ç¤ºä¾‹**
```yaml
# æ ‡è®°å†…ç½‘è®¿é—®

processors:
- add_tags:
    when:
      network:
        client_ip:
          - "192.168.0.0/16"    # 192.168.x.xç½‘æ®µ
          - "10.0.0.0/8"        # 10.x.x.xç½‘æ®µ
          - "172.16.0.0/12"     # 172.16-31.x.xç½‘æ®µ
    tags: ["internal_network"]
```

### 8.3 å¸¸è§ç½‘ç»œåº”ç”¨åœºæ™¯



**ğŸ¯ è®¿é—®æ¥æºåˆ†ç±»**
```yaml
# åŒºåˆ†ä¸åŒæ¥æºçš„è®¿é—®

processors:
# å†…ç½‘è®¿é—®

- add_fields:
    when:
      network:
        client_ip:
          - "192.168.0.0/16"
          - "10.0.0.0/8"
    fields:
      access_type: "internal"

# åŠå…¬ç½‘è®¿é—®

- add_fields:
    when:
      network:
        client_ip:
          - "203.0.113.0/24"    # å…¬å¸å…¬ç½‘IPæ®µ
    fields:
      access_type: "office"

# å…¶ä»–å¤–ç½‘è®¿é—®

- add_fields:
    when:
      not:
        network:
          client_ip:
            - "192.168.0.0/16"
            - "10.0.0.0/8"
            - "203.0.113.0/24"
    fields:
      access_type: "external"
```

**ğŸ¯ å®‰å…¨ç›‘æ§åº”ç”¨**
```yaml
# æ ‡è®°å¯ç–‘IPè®¿é—®

processors:
- add_tags:
    when:
      and:
#        # å¤–ç½‘è®¿é—®
        - not:
            network:
              client_ip:
                - "192.168.0.0/16"
                - "10.0.0.0/8"
#        # è®¿é—®æ•æ„Ÿè·¯å¾„
        - contains:
            url.path: "/admin/"
#        # éæ­£å¸¸æ—¶é—´
        - script:
            lang: painless
            source: >
              def hour = doc['@timestamp'].value.getHour();
              return hour < 6 || hour > 22;
    tags: ["suspicious_access"]
```

### 8.4 ç½‘ç»œæ¡ä»¶å®ç”¨æŠ€å·§



**ğŸ”§ IPåœ°å€å¤„ç†æŠ€å·§**
```yaml
# å¤„ç†ä»£ç†æœåŠ¡å™¨çš„çœŸå®IP

processors:
# å¦‚æœæœ‰X-Forwarded-Forå¤´ï¼Œä¼˜å…ˆä½¿ç”¨çœŸå®IP

- script:
    lang: painless
    source: >
      if (ctx.containsKey('headers') && 
          ctx.headers.containsKey('x_forwarded_for')) {
        ctx.real_client_ip = ctx.headers.x_forwarded_for.split(',')[0].trim();
      } else {
        ctx.real_client_ip = ctx.client_ip;
      }

# åŸºäºçœŸå®IPè¿›è¡Œç½‘ç»œåˆ¤æ–­

- add_tags:
    when:
      network:
        real_client_ip:
          - "192.168.0.0/16"
    tags: ["internal_real_ip"]
```

**ğŸ“Š ç½‘ç»œæ®µè§„åˆ’å‚è€ƒ**

| **ç½‘ç»œç±»å‹** | **CIDRèŒƒå›´** | **è¯´æ˜** |
|-------------|-------------|---------|
| **Aç±»ç§ç½‘** | `10.0.0.0/8` | 1677ä¸‡ä¸ªåœ°å€ |
| **Bç±»ç§ç½‘** | `172.16.0.0/12` | 104ä¸‡ä¸ªåœ°å€ |
| **Cç±»ç§ç½‘** | `192.168.0.0/16` | 6.5ä¸‡ä¸ªåœ°å€ |
| **ç¯å›åœ°å€** | `127.0.0.0/8` | æœ¬æœºå›ç¯ |
| **é“¾è·¯æœ¬åœ°** | `169.254.0.0/16` | è‡ªåŠ¨åˆ†é…åœ°å€ |

---

## 9. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯



### 9.1 WebæœåŠ¡å™¨æ—¥å¿—å¤„ç†



**ğŸŒ Nginxè®¿é—®æ—¥å¿—æ™ºèƒ½è¿‡æ»¤**
```yaml
# Nginxè®¿é—®æ—¥å¿—çš„å®Œæ•´å¤„ç†æµç¨‹

filebeat.inputs:
- type: log
  paths:
    - "/var/log/nginx/access.log"
  
processors:
# 1. è¿‡æ»¤å¥åº·æ£€æŸ¥å’Œç›‘æ§è¯·æ±‚

- drop_event:
    when:
      or:
        - contains:
            message: "/health"
        - contains:
            message: "/status"
        - equals:
            http.request.method: "HEAD"

# 2. æ ‡è®°é”™è¯¯çŠ¶æ€

- add_tags:
    when:
      range:
        http.response.status_code:
          gte: 400
    tags: ["http_error"]

# 3. æ ‡è®°æ…¢è¯·æ±‚

- add_fields:
    when:
      range:
        http.response.time:
          gt: 2000
    fields:
      performance_issue: "slow_response"

# 4. åŒºåˆ†è®¿é—®æ¥æº

- add_fields:
    when:
      network:
        source.ip:
          - "192.168.0.0/16"
    fields:
      access_source: "internal"
```

### 9.2 åº”ç”¨ç¨‹åºæ—¥å¿—åˆ†çº§å¤„ç†



**ğŸ“± Javaåº”ç”¨æ—¥å¿—æ™ºèƒ½åˆ†ç±»**
```yaml
# Javaåº”ç”¨æ—¥å¿—çš„åˆ†çº§å¤„ç†

processors:
# 1. åˆ é™¤è¿‡å¤šçš„DEBUGæ—¥å¿—(ç”Ÿäº§ç¯å¢ƒ)

- drop_event:
    when:
      and:
        - equals:
            log.level: "DEBUG"
        - not:
            contains:
              message: "performance"  # ä¿ç•™æ€§èƒ½ç›¸å…³DEBUG

# 2. é”™è¯¯æ—¥å¿—å¢å¼ºå¤„ç†

- add_fields:
    when:
      or:
        - equals:
            log.level: "ERROR"
        - contains:
            message: "Exception"
    fields:
      alert_level: "high"
      notify_team: "backend"

# 3. æ€§èƒ½ç›‘æ§æ—¥å¿—ç‰¹æ®Šå¤„ç†

- add_tags:
    when:
      and:
        - contains:
            logger_name: "performance"
        - range:
            execution_time:
              gt: 1000
    tags: ["performance_alert"]

# 4. æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

- drop_fields:
    when:
      contains:
        message: "password"
    fields: ["message"]
```

### 9.3 å®‰å…¨æ—¥å¿—ç›‘æ§



**ğŸ”’ å®‰å…¨äº‹ä»¶æ™ºèƒ½è¯†åˆ«**
```yaml
# å®‰å…¨ç›¸å…³æ—¥å¿—çš„å¤„ç†æµç¨‹

processors:
# 1. æ ‡è®°ç™»å½•å¤±è´¥äº‹ä»¶

- add_fields:
    when:
      and:
        - contains:
            event.action: "authentication"
        - equals:
            event.outcome: "failure"
    fields:
      security_event: "login_failure"
      risk_level: "medium"

# 2. æ£€æµ‹æš´åŠ›ç ´è§£æ”»å‡»

- add_tags:
    when:
      and:
        - contains:
            message: "authentication failed"
        - script:
            lang: painless
            source: >
              // æ£€æŸ¥1åˆ†é’Ÿå†…åŒIPå¤±è´¥æ¬¡æ•°(ç®€åŒ–ç¤ºä¾‹)
              return params.failure_count > 5
    tags: ["brute_force_attack"]

# 3. ç›‘æ§æƒé™æå‡æ“ä½œ

- add_fields:
    when:
      or:
        - contains:
            message: "sudo"
        - contains:
            event.action: "privilege_escalation"
    fields:
      security_category: "privilege_change"
      review_required: true

# 4. è¿‡æ»¤æ­£å¸¸çš„ç³»ç»Ÿæ“ä½œ

- drop_event:
    when:
      and:
        - contains:
            user.name: "system"
        - contains:
            event.action: "cron_job"
```

### 9.4 å¾®æœåŠ¡æ¶æ„æ—¥å¿—è·¯ç”±



**ğŸ”„ å¤šæœåŠ¡æ—¥å¿—æ™ºèƒ½è·¯ç”±**
```yaml
# å¾®æœåŠ¡ç¯å¢ƒçš„æ—¥å¿—è·¯ç”±é…ç½®

processors:
# 1. æœåŠ¡è¯†åˆ«å’Œæ ‡è®°

- add_fields:
    when:
      contains:
        log.file.path: "/app/user-service/"
    fields:
      service.name: "user-service"
      service.type: "backend"

- add_fields:
    when:
      contains:
        log.file.path: "/app/payment-service/"
    fields:
      service.name: "payment-service"
      service.type: "critical"

# 2. æŒ‰æœåŠ¡é‡è¦æ€§åˆ†çº§

- add_tags:
    when:
      equals:
        service.type: "critical"
    tags: ["high_priority"]

# 3. é”™è¯¯æ—¥å¿—ç‰¹æ®Šå¤„ç†

- add_fields:
    when:
      and:
        - equals:
            service.type: "critical"
        - or:
          - equals:
              log.level: "ERROR"
          - contains:
              message: "Exception"
    fields:
      alert_channel: "slack_critical"
      escalation_level: "immediate"

# 4. æ€§èƒ½ç›‘æ§æ•°æ®æ ‡è®°

- add_tags:
    when:
      and:
        - has_fields: ["response_time", "request_id"]
        - range:
            response_time:
              gt: 5000
    tags: ["performance_monitoring"]
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ æ¡ä»¶è¿‡æ»¤æœ¬è´¨: æ ¹æ®æ—¥å¿—å†…å®¹å†³å®šå¦‚ä½•å¤„ç†æ¯æ¡æ—¥å¿—è®°å½•
ğŸ”¸ drop_eventä½œç”¨: åˆ é™¤ä¸éœ€è¦çš„æ—¥å¿—ï¼ŒèŠ‚çœå­˜å‚¨å’Œæå‡æ€§èƒ½
ğŸ”¸ whenè¯­æ³•ç»“æ„: æ‰€æœ‰æ¡ä»¶åˆ¤æ–­çš„åŸºç¡€è¯­æ³•æ¡†æ¶
ğŸ”¸ åŸºç¡€æ¡ä»¶ç±»å‹: equalsç²¾ç¡®åŒ¹é…ã€containsåŒ…å«åŒ¹é…ã€rangeèŒƒå›´åˆ¤æ–­
ğŸ”¸ é€»è¾‘è¿ç®—ç¬¦: and(ä¸)ã€or(æˆ–)ã€not(é)çš„ç»„åˆä½¿ç”¨
ğŸ”¸ ç½‘ç»œæ¡ä»¶åˆ¤æ–­: åŸºäºIPåœ°å€å’ŒCIDRç½‘æ®µçš„ä¸“ä¸šç½‘ç»œåˆ¤æ–­
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä¸åŒçš„æ¡ä»¶ç±»å‹**
```
equals: å›ºå®šå€¼åŒ¹é… â†’ æ—¥å¿—çº§åˆ«ã€çŠ¶æ€ç ã€ç”¨æˆ·ç±»å‹ç­‰
contains: æ¨¡ç³ŠåŒ¹é… â†’ é”™è¯¯å…³é”®è¯ã€URLè·¯å¾„åŒ…å«ç­‰
regexp: å¤æ‚æ¨¡å¼ â†’ IPæ ¼å¼ã€æ—¶é—´æ ¼å¼ã€å¤æ‚å­—ç¬¦ä¸²æ¨¡å¼
range: æ•°å€¼èŒƒå›´ â†’ å“åº”æ—¶é—´ã€çŠ¶æ€ç èŒƒå›´ã€æ–‡ä»¶å¤§å°ç­‰
network: ç½‘ç»œåˆ¤æ–­ â†’ IPåœ°å€å½’å±ã€ç½‘æ®µåˆ’åˆ†ç­‰
has_fields: å­—æ®µå­˜åœ¨ â†’ æ—¥å¿—æ ¼å¼éªŒè¯ã€æ¡ä»¶æ€§å¤„ç†ç­‰
```

**ğŸ”¹ é€»è¾‘è¿ç®—ç¬¦çš„é€‰æ‹©åŸåˆ™**
```
and: æ¡ä»¶éƒ½è¦æ»¡è¶³ â†’ ç²¾ç¡®ç­›é€‰ï¼ŒèŒƒå›´ç¼©å°
or: æ»¡è¶³ä»»ä¸€æ¡ä»¶ â†’ å®½æ³›åŒ¹é…ï¼ŒèŒƒå›´æ‰©å¤§  
not: æ’é™¤ç‰¹å®šæƒ…å†µ â†’ åå‘ç­›é€‰ï¼Œä¿ç•™å…¶ä»–
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘**
```
æ¡ä»¶é¡ºåº: ç®€å•æ¡ä»¶æ”¾å‰é¢(equals > contains > regexp)
å­—æ®µå¼•ç”¨: ä½¿ç”¨ç‚¹å·è¯­æ³•ï¼Œé¿å…å¤æ‚åµŒå¥—
æ­£åˆ™è¡¨è¾¾å¼: è°¨æ…ä½¿ç”¨ï¼Œæ³¨æ„è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
æ¡ä»¶ç»„åˆ: ä¼˜å…ˆç”¨ç®€å•æ¡ä»¶è¿‡æ»¤å¤§éƒ¨åˆ†æ•°æ®
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼



**ğŸ¯ æ—¥å¿—å¤„ç†æµç¨‹è®¾è®¡**
```
æ­¥éª¤1: æ•°æ®æ¸…ç† â†’ åˆ é™¤æ— ç”¨æ—¥å¿—(å¥åº·æ£€æŸ¥ã€è°ƒè¯•ä¿¡æ¯)
æ­¥éª¤2: åˆ†ç±»æ ‡è®° â†’ æŒ‰é‡è¦æ€§ã€æ¥æºã€ç±»å‹åˆ†ç±»
æ­¥éª¤3: å®‰å…¨å¤„ç† â†’ æ•æ„Ÿä¿¡æ¯è¿‡æ»¤ã€å¼‚å¸¸æ£€æµ‹
æ­¥éª¤4: æ€§èƒ½ä¼˜åŒ– â†’ ç´¢å¼•ä¼˜åŒ–ã€å­˜å‚¨åˆ†å±‚
```

**ğŸ› ï¸ é…ç½®æœ€ä½³å®è·µ**
```
æµ‹è¯•éªŒè¯:
- å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è§„åˆ™
- å°èŒƒå›´è¯•è¿è¡Œè§‚å¯Ÿæ•ˆæœ
- é€æ­¥æ‰©å¤§åº”ç”¨èŒƒå›´

ç›‘æ§å‘Šè­¦:
- ç›‘æ§è¿‡æ»¤è§„åˆ™çš„å½±å“
- è®¾ç½®æ•°æ®é‡å˜åŒ–å‘Šè­¦
- å®šæœŸæ£€æŸ¥è§„åˆ™æœ‰æ•ˆæ€§

æ–‡æ¡£è®°å½•:
- è®°å½•æ¯ä¸ªè§„åˆ™çš„ç”¨é€”
- è¯´æ˜ä¸šåŠ¡èƒŒæ™¯å’Œå½±å“
- å®šæœŸå›é¡¾å’Œæ›´æ–°
```

### 10.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ“ åŸºç¡€æŠ€èƒ½æ£€æŸ¥**
- [ ] ç†è§£whenæ¡ä»¶è¯­æ³•çš„åŸºæœ¬ç»“æ„
- [ ] æŒæ¡equalsã€containsã€regexpçš„åŒºåˆ«å’Œç”¨æ³•
- [ ] ä¼šä½¿ç”¨rangeè¿›è¡Œæ•°å€¼èŒƒå›´åˆ¤æ–­
- [ ] äº†è§£has_fieldså­—æ®µå­˜åœ¨æ€§æ£€æŸ¥
- [ ] èƒ½å¤Ÿç»„åˆä½¿ç”¨andã€orã€noté€»è¾‘è¿ç®—ç¬¦

**ğŸ¯ è¿›é˜¶åº”ç”¨æ£€æŸ¥**  
- [ ] èƒ½å¤Ÿè®¾è®¡å¤æ‚çš„åµŒå¥—æ¡ä»¶é€»è¾‘
- [ ] æŒæ¡networkç½‘ç»œæ¡ä»¶çš„CIDRè¯­æ³•
- [ ] ä¼šé’ˆå¯¹ä¸åŒæ—¥å¿—ç±»å‹è®¾è®¡è¿‡æ»¤è§„åˆ™
- [ ] èƒ½å¤Ÿå¹³è¡¡è¿‡æ»¤ç²¾åº¦å’Œæ€§èƒ½è¦æ±‚
- [ ] å…·å¤‡è°ƒè¯•å’Œä¼˜åŒ–æ¡ä»¶é…ç½®çš„èƒ½åŠ›

**ğŸš€ å®æˆ˜é¡¹ç›®æ£€æŸ¥**
- [ ] å®ŒæˆWebæœåŠ¡å™¨æ—¥å¿—çš„æ™ºèƒ½è¿‡æ»¤é…ç½®
- [ ] å®ç°åº”ç”¨ç¨‹åºæ—¥å¿—çš„åˆ†çº§å¤„ç†
- [ ] è®¾è®¡å®‰å…¨æ—¥å¿—çš„ç›‘æ§å‘Šè­¦è§„åˆ™
- [ ] æ„å»ºå¾®æœåŠ¡æ¶æ„çš„æ—¥å¿—è·¯ç”±æ–¹æ¡ˆ

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
> æ¡ä»¶è¿‡æ»¤æ˜¯æ—¥å¿—å¤„ç†çš„æ ¸å¿ƒæŠ€èƒ½
> whenè¯­æ³•æ˜¯æ‰€æœ‰æ¡ä»¶åˆ¤æ–­çš„åŸºç¡€
> åˆç†çš„è¿‡æ»¤è§„åˆ™èƒ½æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½
> æµ‹è¯•éªŒè¯æ˜¯é¿å…æ•°æ®ä¸¢å¤±çš„å…³é”®æ­¥éª¤

**ğŸ’¡ è¿›é˜¶å­¦ä¹ æ–¹å‘**
- å­¦ä¹ Elasticsearchçš„Index Templateè®¾è®¡
- äº†è§£Logstashçš„æ›´å¤æ‚æ•°æ®å¤„ç†èƒ½åŠ›
- ç ”ç©¶ELK stackçš„æ•´ä½“æ¶æ„ä¼˜åŒ–
- æ¢ç´¢å®æ—¶æ—¥å¿—æµå¤„ç†å’Œå‘Šè­¦ç³»ç»Ÿ