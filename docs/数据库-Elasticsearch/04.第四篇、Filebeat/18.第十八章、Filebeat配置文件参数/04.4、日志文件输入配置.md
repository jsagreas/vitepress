---
title: 4ã€æ—¥å¿—æ–‡ä»¶è¾“å…¥é…ç½®
---
## ğŸ“š ç›®å½•

1. [Filebeatæ—¥å¿—è¾“å…¥åŸºç¡€æ¦‚å¿µ](#1-filebeatæ—¥å¿—è¾“å…¥åŸºç¡€æ¦‚å¿µ)
2. [type-logåŸºç¡€é…ç½®è¯¦è§£](#2-type-logåŸºç¡€é…ç½®è¯¦è§£)
3. [æ–‡ä»¶è·¯å¾„é…ç½®ä¸é€šé…ç¬¦](#3-æ–‡ä»¶è·¯å¾„é…ç½®ä¸é€šé…ç¬¦)
4. [æ—¥å¿—å†…å®¹è¿‡æ»¤é…ç½®](#4-æ—¥å¿—å†…å®¹è¿‡æ»¤é…ç½®)
5. [å¤šè¡Œæ—¥å¿—åˆå¹¶å¤„ç†](#5-å¤šè¡Œæ—¥å¿—åˆå¹¶å¤„ç†)
6. [æ–‡ä»¶ç¼–ç ä¸é«˜çº§è®¾ç½®](#6-æ–‡ä»¶ç¼–ç ä¸é«˜çº§è®¾ç½®)
7. [å®æˆ˜é…ç½®æ¡ˆä¾‹](#7-å®æˆ˜é…ç½®æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Filebeatæ—¥å¿—è¾“å…¥åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Filebeatæ—¥å¿—è¾“å…¥


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šFilebeatå°±åƒä¸€ä¸ªä¸“é—¨çš„"æ–‡ä»¶ç›‘è§†å‘˜"ï¼Œå®ƒä¼šç›¯ç€ä½ æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œä¸€æ—¦æœ‰æ–°å†…å®¹å†™å…¥ï¼Œå°±ç«‹å³è¯»å–å¹¶å‘é€åˆ°ç›®æ ‡ä½ç½®ï¼ˆæ¯”å¦‚Elasticsearchï¼‰

**Filebeatçš„å·¥ä½œåŸç†**ï¼š
```
åº”ç”¨ç¨‹åºå†™æ—¥å¿— â†’ Filebeatç›‘æ§æ–‡ä»¶ â†’ è¯»å–æ–°å†…å®¹ â†’ å‘é€åˆ°ç›®æ ‡
     â†“               â†“              â†“           â†“
   app.log      å®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–    è§£æå¤„ç†     Elasticsearch
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **è¾“å…¥æºï¼ˆInputï¼‰**ï¼šå‘Šè¯‰Filebeatå»å“ªé‡Œæ‰¾æ—¥å¿—æ–‡ä»¶
- **å¤„ç†å™¨ï¼ˆProcessorï¼‰**ï¼šå¯¹æ—¥å¿—å†…å®¹è¿›è¡ŒåŠ å·¥å¤„ç†
- **è¾“å‡ºï¼ˆOutputï¼‰**ï¼šå°†å¤„ç†åçš„æ—¥å¿—å‘é€åˆ°å“ªé‡Œ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—æ–‡ä»¶è¾“å…¥é…ç½®


**å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š
```
åœºæ™¯1ï¼šç½‘ç«™è®¿é—®æ—¥å¿—
/var/log/nginx/access.log â†’ éœ€è¦æ”¶é›†ç”¨æˆ·è®¿é—®ä¿¡æ¯

åœºæ™¯2ï¼šåº”ç”¨é”™è¯¯æ—¥å¿—  
/app/logs/error.log â†’ éœ€è¦ç›‘æ§ç³»ç»Ÿå¼‚å¸¸

åœºæ™¯3ï¼šå¤šä¸ªæœåŠ¡æ—¥å¿—
/logs/service1/*.log â†’ éœ€è¦æ”¶é›†å¤šä¸ªæ–‡ä»¶
/logs/service2/*.log
```

> ğŸ“Œ **å…³é”®ç†è§£**ï¼šä¸åŒçš„æ—¥å¿—æ–‡ä»¶æœ‰ä¸åŒçš„æ ¼å¼å’Œä½ç½®ï¼Œéœ€è¦é’ˆå¯¹æ€§é…ç½®æ‰èƒ½æ­£ç¡®æ”¶é›†

---

## 2. âš™ï¸ type: logåŸºç¡€é…ç½®è¯¦è§£


### 2.1 åŸºç¡€é…ç½®ç»“æ„


**æœ€ç®€å•çš„é…ç½®ç¤ºä¾‹**ï¼š
```yaml
filebeat.inputs:
- type: log                    # æŒ‡å®šè¾“å…¥ç±»å‹ä¸ºæ—¥å¿—æ–‡ä»¶
  enabled: true               # å¯ç”¨è¿™ä¸ªè¾“å…¥é…ç½®
  paths:                      # æŒ‡å®šè¦ç›‘æ§çš„æ–‡ä»¶è·¯å¾„
    - /var/log/app.log
```

### 2.2 type: logæ ¸å¿ƒå‚æ•°è¯¦è§£


**å®Œæ•´å‚æ•°é…ç½®**ï¼š
```yaml
filebeat.inputs:
- type: log
  enabled: true                           # æ˜¯å¦å¯ç”¨æ­¤è¾“å…¥
  paths:                                  # æ–‡ä»¶è·¯å¾„åˆ—è¡¨
    - /var/log/*.log
  fields:                                 # æ·»åŠ è‡ªå®šä¹‰å­—æ®µ
    service: "web-app"
    environment: "production"
  fields_under_root: false               # è‡ªå®šä¹‰å­—æ®µæ˜¯å¦æ”¾åœ¨æ ¹çº§åˆ«
  tags: ["web", "production"]           # æ·»åŠ æ ‡ç­¾ä¾¿äºåˆ†ç±»
  scan_frequency: 10s                    # æ‰«ææ–°æ–‡ä»¶çš„é¢‘ç‡
  harvester_buffer_size: 16384           # è¯»å–ç¼“å†²åŒºå¤§å°
  max_bytes: 10485760                    # å•è¡Œæœ€å¤§å­—èŠ‚æ•°(10MB)
  close_inactive: 5m                     # æ–‡ä»¶ä¸æ´»è·ƒå¤šä¹…åå…³é—­
```

**å‚æ•°å«ä¹‰è¯¦ç»†è¯´æ˜**ï¼š

| å‚æ•°å | **ä½œç”¨è¯´æ˜** | **å…¸å‹å€¼** | **ä½¿ç”¨åœºæ™¯** |
|--------|-------------|-----------|-------------|
| `enabled` | `æ§åˆ¶æ˜¯å¦å¯ç”¨è¿™ä¸ªé…ç½®` | `true/false` | `ä¸´æ—¶ç¦ç”¨æŸä¸ªæ—¥å¿—æ”¶é›†` |
| `fields` | `ç»™æ—¥å¿—æ·»åŠ é¢å¤–ä¿¡æ¯` | `service: "web"` | `åŒºåˆ†ä¸åŒæœåŠ¡çš„æ—¥å¿—` |
| `tags` | `ç»™æ—¥å¿—æ‰“æ ‡ç­¾` | `["web", "prod"]` | `åç»­è¿‡æ»¤å’Œåˆ†æä½¿ç”¨` |
| `scan_frequency` | `æ£€æŸ¥æ–°æ–‡ä»¶çš„é—´éš”` | `10s` | `å¹³è¡¡æ€§èƒ½å’Œå®æ—¶æ€§` |
| `close_inactive` | `ä¸æ´»è·ƒæ–‡ä»¶å…³é—­æ—¶é—´` | `5m` | `èŠ‚çœæ–‡ä»¶å¥æŸ„èµ„æº` |

---

## 3. ğŸ“ æ–‡ä»¶è·¯å¾„é…ç½®ä¸é€šé…ç¬¦


### 3.1 åŸºç¡€è·¯å¾„é…ç½®


**å•ä¸ªæ–‡ä»¶é…ç½®**ï¼š
```yaml
paths:
  - /var/log/nginx/access.log              # ç›‘æ§å•ä¸ªå…·ä½“æ–‡ä»¶
```

**å¤šä¸ªæ–‡ä»¶é…ç½®**ï¼š
```yaml
paths:
  - /var/log/nginx/access.log
  - /var/log/nginx/error.log
  - /var/log/app/application.log
```

### 3.2 é€šé…ç¬¦æ¨¡å¼è¯¦è§£


> ğŸ” **é€šé…ç¬¦ä½œç”¨**ï¼šè®©Filebeatèƒ½å¤Ÿè‡ªåŠ¨åŒ¹é…ç¬¦åˆæ¡ä»¶çš„å¤šä¸ªæ–‡ä»¶ï¼Œç‰¹åˆ«é€‚åˆæ—¥å¿—è½®è½¬çš„åœºæ™¯

**å¸¸ç”¨é€šé…ç¬¦è¯´æ˜**ï¼š

```
é€šé…ç¬¦è¯­æ³•å›¾ç¤ºï¼š
*     â†’ åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬è·¯å¾„åˆ†éš”ç¬¦ï¼‰
**    â†’ åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆåŒ…æ‹¬è·¯å¾„åˆ†éš”ç¬¦ï¼Œé€’å½’åŒ¹é…ï¼‰
?     â†’ åŒ¹é…å•ä¸ªå­—ç¬¦
[]    â†’ åŒ¹é…æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```yaml
# ç¤ºä¾‹1ï¼šåŒ¹é…æ‰€æœ‰.logæ–‡ä»¶
paths:
  - /var/log/*.log
# åŒ¹é…ï¼šaccess.log, error.log, app.log

# ç¤ºä¾‹2ï¼šé€’å½’åŒ¹é…æ‰€æœ‰å­ç›®å½•çš„æ—¥å¿—
paths:
  - /var/log/**/*.log
# åŒ¹é…ï¼š/var/log/nginx/access.log, /var/log/app/service/debug.log

# ç¤ºä¾‹3ï¼šåŒ¹é…ç‰¹å®šæ—¥æœŸæ ¼å¼çš„æ—¥å¿—æ–‡ä»¶
paths:
  - /var/log/app-2025-??-??.log
# åŒ¹é…ï¼šapp-2025-01-15.log, app-2025-12-25.log

# ç¤ºä¾‹4ï¼šåŒ¹é…å¤šç§æ‰©å±•å
paths:
  - /var/log/app.*
# åŒ¹é…ï¼šapp.log, app.out, app.err
```

### 3.3 è·¯å¾„é…ç½®æœ€ä½³å®è·µ


**æ—¥å¿—è½®è½¬åœºæ™¯é…ç½®**ï¼š
```yaml
# é’ˆå¯¹æŒ‰æ—¥æœŸè½®è½¬çš„æ—¥å¿—æ–‡ä»¶
paths:
  - /var/log/application.log          # å½“å‰æ—¥å¿—
  - /var/log/application-*.log        # å†å²æ—¥å¿—
  
# é’ˆå¯¹æŒ‰å¤§å°è½®è½¬çš„æ—¥å¿—æ–‡ä»¶  
paths:
  - /var/log/app.log
  - /var/log/app.log.[0-9]*          # app.log.1, app.log.2ç­‰
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šé€šé…ç¬¦ä¼šå¢åŠ æ–‡ä»¶ç³»ç»Ÿæ‰«æå¼€é”€ï¼Œå»ºè®®å°½é‡å…·ä½“åŒ–è·¯å¾„ï¼Œé¿å…è¿‡äºå®½æ³›çš„åŒ¹é…

---

## 4. ğŸ” æ—¥å¿—å†…å®¹è¿‡æ»¤é…ç½®


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦å†…å®¹è¿‡æ»¤


**å®é™…é—®é¢˜åœºæ™¯**ï¼š
```
åŸå§‹æ—¥å¿—æ–‡ä»¶åŒ…å«ï¼š
2025-09-21 10:00:01 INFO  ç”¨æˆ·ç™»å½•æˆåŠŸ        â† éœ€è¦æ”¶é›†
2025-09-21 10:00:02 DEBUG æ•°æ®åº“è¿æ¥è¯¦æƒ…      â† ä¸éœ€è¦æ”¶é›†
2025-09-21 10:00:03 ERROR æ”¯ä»˜å¤±è´¥           â† éœ€è¦æ”¶é›†
2025-09-21 10:00:04 DEBUG å†…å­˜ä½¿ç”¨æƒ…å†µ        â† ä¸éœ€è¦æ”¶é›†

ç›®æ ‡ï¼šåªæ”¶é›†INFOå’ŒERRORçº§åˆ«çš„æ—¥å¿—ï¼Œè¿‡æ»¤æ‰DEBUGä¿¡æ¯
```

### 4.2 include_linesåŒ…å«è¿‡æ»¤


> ğŸ’¡ **ä½œç”¨è¯´æ˜**ï¼šåªæ”¶é›†åŒ¹é…æŒ‡å®šæ¨¡å¼çš„æ—¥å¿—è¡Œï¼Œå…¶ä»–è¡Œç›´æ¥å¿½ç•¥

**åŸºç¡€è¯­æ³•**ï¼š
```yaml
include_lines: ['æ­£åˆ™è¡¨è¾¾å¼1', 'æ­£åˆ™è¡¨è¾¾å¼2']
```

**å®ç”¨é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# ç¤ºä¾‹1ï¼šåªæ”¶é›†ERRORå’ŒWARNçº§åˆ«çš„æ—¥å¿—
filebeat.inputs:
- type: log
  paths: ["/var/log/app.log"]
  include_lines: ['\b(ERROR|WARN)\b']
  
# ç¤ºä¾‹2ï¼šåªæ”¶é›†ç‰¹å®šIPçš„è®¿é—®æ—¥å¿—
filebeat.inputs:
- type: log
  paths: ["/var/log/nginx/access.log"]
  include_lines: ['192\.168\.1\.']
  
# ç¤ºä¾‹3ï¼šåªæ”¶é›†åŒ…å«å…³é”®è¯çš„æ—¥å¿—
filebeat.inputs:
- type: log
  paths: ["/var/log/business.log"]
  include_lines: ['(æ”¯ä»˜|è®¢å•|ç”¨æˆ·æ³¨å†Œ)']
```

### 4.3 exclude_linesæ’é™¤è¿‡æ»¤


> ğŸ’¡ **ä½œç”¨è¯´æ˜**ï¼šæ’é™¤åŒ¹é…æŒ‡å®šæ¨¡å¼çš„æ—¥å¿—è¡Œï¼Œæ”¶é›†å…¶ä»–æ‰€æœ‰è¡Œ

**åŸºç¡€è¯­æ³•**ï¼š
```yaml
exclude_lines: ['æ­£åˆ™è¡¨è¾¾å¼1', 'æ­£åˆ™è¡¨è¾¾å¼2']
```

**å®ç”¨é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# ç¤ºä¾‹1ï¼šæ’é™¤DEBUGçº§åˆ«æ—¥å¿—
filebeat.inputs:
- type: log
  paths: ["/var/log/app.log"]
  exclude_lines: ['\bDEBUG\b']
  
# ç¤ºä¾‹2ï¼šæ’é™¤å¥åº·æ£€æŸ¥è¯·æ±‚
filebeat.inputs:
- type: log
  paths: ["/var/log/nginx/access.log"]
  exclude_lines: ['/health', '/status', '/ping']
  
# ç¤ºä¾‹3ï¼šæ’é™¤ç³»ç»Ÿå†…éƒ¨IPè®¿é—®
filebeat.inputs:
- type: log
  paths: ["/var/log/access.log"]
  exclude_lines: ['127\.0\.0\.1', '10\.0\.0\.']
```

### 4.4 è¿‡æ»¤é…ç½®ä¼˜å…ˆçº§å’Œç»„åˆä½¿ç”¨


**æ‰§è¡Œé¡ºåºè¯´æ˜**ï¼š
```
æ—¥å¿—è¡Œ â†’ include_linesæ£€æŸ¥ â†’ exclude_linesæ£€æŸ¥ â†’ æœ€ç»ˆç»“æœ

1. å¦‚æœåŒæ—¶é…ç½®äº†include_lineså’Œexclude_lines
2. å…ˆæ‰§è¡Œinclude_linesåŒ¹é…
3. é€šè¿‡include_linesçš„å†æ‰§è¡Œexclude_lines
4. æœ€ç»ˆé€šè¿‡ä¸¤è½®è¿‡æ»¤çš„æ—¥å¿—æ‰ä¼šè¢«å‘é€
```

**ç»„åˆä½¿ç”¨ç¤ºä¾‹**ï¼š
```yaml
filebeat.inputs:
- type: log
  paths: ["/var/log/app.log"]
  include_lines: ['\b(INFO|WARN|ERROR)\b']    # åªè¦INFO/WARN/ERROR
  exclude_lines: ['health_check']             # ä½†æ’é™¤å¥åº·æ£€æŸ¥ç›¸å…³
```

---

## 5. ğŸ“ å¤šè¡Œæ—¥å¿—åˆå¹¶å¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯å¤šè¡Œæ—¥å¿—é—®é¢˜


**å…¸å‹å¤šè¡Œæ—¥å¿—åœºæ™¯**ï¼š
```
Javaå¼‚å¸¸å †æ ˆæ—¥å¿—ï¼š
2025-09-21 10:30:01 ERROR Exception in thread "main"     â† ç¬¬1è¡Œ
java.lang.NullPointerException: null                    â† ç¬¬2è¡Œ  
    at com.example.Service.process(Service.java:123)    â† ç¬¬3è¡Œ
    at com.example.Main.main(Main.java:45)              â† ç¬¬4è¡Œ

é—®é¢˜ï¼šè¿™4è¡Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªå®Œæ•´çš„é”™è¯¯ä¿¡æ¯ï¼Œåº”è¯¥ä½œä¸ºä¸€æ¡æ—¥å¿—å¤„ç†
```

**ä¸å¤„ç†å¤šè¡Œçš„åæœ**ï¼š
```
é”™è¯¯å¤„ç†æ–¹å¼ï¼šæ¯è¡Œéƒ½å½“ä½œç‹¬ç«‹æ—¥å¿—
âœ— æ—¥å¿—1: "2025-09-21 10:30:01 ERROR Exception in thread"
âœ— æ—¥å¿—2: "java.lang.NullPointerException: null"  
âœ— æ—¥å¿—3: "    at com.example.Service.process"
âœ— æ—¥å¿—4: "    at com.example.Main.main"

æ­£ç¡®å¤„ç†æ–¹å¼ï¼šåˆå¹¶ä¸ºä¸€æ¡å®Œæ•´æ—¥å¿—
âœ“ æ—¥å¿—1: "2025-09-21 10:30:01 ERROR Exception... (åŒ…å«å®Œæ•´å †æ ˆ)"
```

### 5.2 multilineåŸºç¡€é…ç½®


**é…ç½®ç»“æ„**ï¼š
```yaml
multiline:
  pattern: 'æ­£åˆ™è¡¨è¾¾å¼'        # ç”¨äºè¯†åˆ«è¡Œçš„æ¨¡å¼
  negate: true/false         # æ˜¯å¦å–åæ¨¡å¼åŒ¹é…
  match: after/before        # åŒ¹é…çš„è¡ŒåŠ åˆ°å‰é¢è¿˜æ˜¯åé¢
```

### 5.3 multiline.patternæ­£åˆ™æ¨¡å¼è¯¦è§£


> ğŸ¯ **æ ¸å¿ƒç†è§£**ï¼špatternç”¨æ¥è¯†åˆ«å“ªäº›è¡Œæ˜¯"èµ·å§‹è¡Œ"æˆ–"ç»§ç»­è¡Œ"

**å¸¸ç”¨æ¨¡å¼ç¤ºä¾‹**ï¼š

```yaml
# æ¨¡å¼1ï¼šæ—¶é—´æˆ³å¼€å¤´çš„æ—¥å¿—ï¼ˆæœ€å¸¸ç”¨ï¼‰
multiline:
  pattern: '^\d{4}-\d{2}-\d{2}'           # åŒ¹é…YYYY-MM-DDå¼€å¤´
  negate: true                            # ä¸æ˜¯æ—¶é—´æˆ³å¼€å¤´çš„è¡Œ
  match: after                            # åŠ åˆ°å‰ä¸€æ¡æ—¥å¿—åé¢
  
# æ¨¡å¼2ï¼šJavaå¼‚å¸¸å †æ ˆ
multiline:
  pattern: '^[[:space:]]'                 # åŒ¹é…ç©ºæ ¼æˆ–tabå¼€å¤´çš„è¡Œ
  negate: false                           # æ˜¯ç©ºæ ¼å¼€å¤´çš„è¡Œ
  match: after                            # åŠ åˆ°å‰ä¸€æ¡æ—¥å¿—åé¢
  
# æ¨¡å¼3ï¼šç‰¹å®šçº§åˆ«æ—¥å¿—å¼€å¤´
multiline:
  pattern: '^(INFO|WARN|ERROR|DEBUG)'     # åŒ¹é…æ—¥å¿—çº§åˆ«å¼€å¤´
  negate: true                            # ä¸æ˜¯æ—¥å¿—çº§åˆ«å¼€å¤´çš„è¡Œ  
  match: after                            # åŠ åˆ°å‰ä¸€æ¡æ—¥å¿—åé¢
```

### 5.4 multiline.negateæ¨¡å¼å–åè¯¦è§£


> ğŸ’¡ **negateä½œç”¨**ï¼šå†³å®šæ˜¯"åŒ¹é…çš„è¡Œ"è¿˜æ˜¯"ä¸åŒ¹é…çš„è¡Œ"ä½œä¸ºè¿æ¥è¡Œ

**negate: falseï¼ˆä¸å–åï¼‰ç¤ºä¾‹**ï¼š
```yaml
multiline:
  pattern: '^[[:space:]]'     # åŒ¹é…ç©ºæ ¼å¼€å¤´çš„è¡Œ
  negate: false              # ç©ºæ ¼å¼€å¤´çš„è¡Œå°±æ˜¯"ç»§ç»­è¡Œ"
  match: after               # åŠ åˆ°å‰é¢

æ—¥å¿—ç¤ºä¾‹ï¼š
ERROR ä¸»è¦é”™è¯¯ä¿¡æ¯        â† èµ·å§‹è¡Œ
    è¯¦ç»†é”™è¯¯æè¿°          â† ç»§ç»­è¡Œï¼ˆç©ºæ ¼å¼€å¤´ï¼ŒåŒ¹é…patternï¼‰
    æ›´å¤šé”™è¯¯ä¿¡æ¯          â† ç»§ç»­è¡Œï¼ˆç©ºæ ¼å¼€å¤´ï¼ŒåŒ¹é…patternï¼‰
INFO ä¸‹ä¸€æ¡æ—¥å¿—           â† æ–°çš„èµ·å§‹è¡Œ
```

**negate: trueï¼ˆå–åï¼‰ç¤ºä¾‹**ï¼š
```yaml
multiline:
  pattern: '^\d{4}-\d{2}-\d{2}'    # åŒ¹é…æ—¶é—´æˆ³å¼€å¤´
  negate: true                     # ä¸æ˜¯æ—¶é—´æˆ³å¼€å¤´çš„å°±æ˜¯"ç»§ç»­è¡Œ"
  match: after                     # åŠ åˆ°å‰é¢

æ—¥å¿—ç¤ºä¾‹ï¼š
2025-09-21 10:30:01 ERROR é”™è¯¯ä¿¡æ¯    â† èµ·å§‹è¡Œï¼ˆåŒ¹é…æ—¶é—´æˆ³ï¼‰
è¯¦ç»†çš„é”™è¯¯æè¿°                        â† ç»§ç»­è¡Œï¼ˆä¸åŒ¹é…æ—¶é—´æˆ³ï¼Œè¢«negateï¼‰
æ›´å¤šè¡¥å……ä¿¡æ¯                          â† ç»§ç»­è¡Œï¼ˆä¸åŒ¹é…æ—¶é—´æˆ³ï¼Œè¢«negateï¼‰
2025-09-21 10:30:02 INFO æ­£å¸¸ä¿¡æ¯     â† æ–°çš„èµ·å§‹è¡Œï¼ˆåŒ¹é…æ—¶é—´æˆ³ï¼‰
```

### 5.5 multiline.matchåŒ¹é…æ–¹å¼è¯¦è§£


**match: afterï¼ˆå‘ååˆå¹¶ï¼‰**ï¼š
```yaml
match: after    # ç»§ç»­è¡ŒåŠ åˆ°å‰é¢çš„æ—¥å¿—åé¢

å¤„ç†æµç¨‹ï¼š
èµ·å§‹è¡Œ: "2025-09-21 ERROR ä¸»é”™è¯¯"
ç»§ç»­è¡Œ: "  è¯¦ç»†ä¿¡æ¯1"              â†’ åŠ åˆ°ä¸»é”™è¯¯åé¢  
ç»§ç»­è¡Œ: "  è¯¦ç»†ä¿¡æ¯2"              â†’ ç»§ç»­åŠ åˆ°åé¢
ç»“æœ: "2025-09-21 ERROR ä¸»é”™è¯¯\n  è¯¦ç»†ä¿¡æ¯1\n  è¯¦ç»†ä¿¡æ¯2"
```

**match: beforeï¼ˆå‘å‰åˆå¹¶ï¼‰**ï¼š
```yaml
match: before   # ç»§ç»­è¡ŒåŠ åˆ°åé¢çš„æ—¥å¿—å‰é¢

å¤„ç†æµç¨‹ï¼š
ç»§ç»­è¡Œ: "  ä¸Šä¸‹æ–‡ä¿¡æ¯1"            â†’ æš‚å­˜
ç»§ç»­è¡Œ: "  ä¸Šä¸‹æ–‡ä¿¡æ¯2"            â†’ ç»§ç»­æš‚å­˜  
èµ·å§‹è¡Œ: "2025-09-21 ERROR ä¸»é”™è¯¯"  â†’ å°†æš‚å­˜çš„åŠ åˆ°å‰é¢
ç»“æœ: "  ä¸Šä¸‹æ–‡ä¿¡æ¯1\n  ä¸Šä¸‹æ–‡ä¿¡æ¯2\n2025-09-21 ERROR ä¸»é”™è¯¯"
```

### 5.6 å¤šè¡Œé…ç½®å®æˆ˜æ¡ˆä¾‹


**æ¡ˆä¾‹1ï¼šJavaåº”ç”¨æ—¥å¿—**ï¼š
```yaml
# Javaå¼‚å¸¸å †æ ˆåˆå¹¶
filebeat.inputs:
- type: log
  paths: ["/var/log/java-app.log"]
  multiline:
    pattern: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'  # æ—¶é—´æˆ³æ ¼å¼
    negate: true                                       # éæ—¶é—´æˆ³å¼€å¤´çš„è¡Œ
    match: after                                       # åˆå¹¶åˆ°å‰é¢
    max_lines: 500                                     # æœ€å¤šåˆå¹¶500è¡Œ
    timeout: 5s                                        # 5ç§’è¶…æ—¶
```

**æ¡ˆä¾‹2ï¼šPythoné”™è¯¯æ—¥å¿—**ï¼š
```yaml
# Python tracebackåˆå¹¶
filebeat.inputs:
- type: log
  paths: ["/var/log/python-app.log"]
  multiline:
    pattern: '^Traceback|^[[:space:]]+|^[[:alnum:]]+Error:'  # å¤šç§æ¨¡å¼
    negate: false                                           # åŒ¹é…çš„è¡Œæ˜¯ç»§ç»­è¡Œ
    match: after
```

**æ¡ˆä¾‹3ï¼šè‡ªå®šä¹‰æ ¼å¼æ—¥å¿—**ï¼š
```yaml
# ä»¥">>>"å¼€å¤´çš„å¤šè¡Œæ¶ˆæ¯
filebeat.inputs:
- type: log  
  paths: ["/var/log/custom.log"]
  multiline:
    pattern: '^>>>'              # ä»¥>>>å¼€å¤´è¡¨ç¤ºæ–°æ¶ˆæ¯
    negate: true                 # ä¸ä»¥>>>å¼€å¤´çš„æ˜¯ç»§ç»­è¡Œ
    match: after
```

---

## 6. ğŸ”¤ æ–‡ä»¶ç¼–ç ä¸é«˜çº§è®¾ç½®


### 6.1 encodingæ–‡ä»¶ç¼–ç è®¾ç½®


> ğŸ“ **ç¼–ç é‡è¦æ€§**ï¼šä¸åŒç³»ç»Ÿå’Œåº”ç”¨å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶ç¼–ç ï¼Œé”™è¯¯çš„ç¼–ç è®¾ç½®ä¼šå¯¼è‡´ä¸­æ–‡ç­‰ç‰¹æ®Šå­—ç¬¦ä¹±ç 

**å¸¸è§ç¼–ç æ ¼å¼**ï¼š
```yaml
# UTF-8ç¼–ç ï¼ˆæ¨èï¼Œæœ€é€šç”¨ï¼‰
encoding: utf-8

# GBKç¼–ç ï¼ˆä¸­æ–‡Windowsç³»ç»Ÿå¸¸ç”¨ï¼‰  
encoding: gbk

# GB2312ç¼–ç ï¼ˆè¾ƒè€çš„ä¸­æ–‡ç¼–ç ï¼‰
encoding: gb2312

# ASCIIç¼–ç ï¼ˆçº¯è‹±æ–‡ï¼‰
encoding: ascii

# è‡ªåŠ¨æ£€æµ‹ç¼–ç ï¼ˆä¸æ¨èï¼Œæ€§èƒ½è¾ƒå·®ï¼‰
encoding: auto
```

**ç¼–ç é…ç½®ç¤ºä¾‹**ï¼š
```yaml
filebeat.inputs:
- type: log
  paths: ["/var/log/chinese-app.log"]
  encoding: utf-8                      # æŒ‡å®šUTF-8ç¼–ç 
  
- type: log  
  paths: ["/var/log/windows-app.log"]
  encoding: gbk                        # Windowsä¸­æ–‡æ—¥å¿—ä½¿ç”¨GBK
```

### 6.2 é«˜çº§æ€§èƒ½å‚æ•°


**æ–‡ä»¶ç›‘æ§ä¼˜åŒ–é…ç½®**ï¼š
```yaml
filebeat.inputs:
- type: log
  paths: ["/var/log/high-volume.log"]
  
  # æ€§èƒ½ä¼˜åŒ–å‚æ•°
  scan_frequency: 1s              # æ‰«æé¢‘ç‡ï¼Œé»˜è®¤10s
  harvester_buffer_size: 32768    # è¯»å–ç¼“å†²åŒºï¼Œé»˜è®¤16KB
  max_bytes: 10485760            # å•è¡Œæœ€å¤§10MBï¼Œé˜²æ­¢å†…å­˜æº¢å‡º
  
  # æ–‡ä»¶ç®¡ç†å‚æ•°  
  close_inactive: 1m             # 1åˆ†é’Ÿæ— æ´»åŠ¨åå…³é—­æ–‡ä»¶
  close_removed: true            # æ–‡ä»¶è¢«åˆ é™¤åå…³é—­å¥æŸ„
  close_renamed: true            # æ–‡ä»¶è¢«é‡å‘½ååå…³é—­å¥æŸ„
  
  # æ—¥å¿—è½®è½¬å¤„ç†
  clean_inactive: 24h            # 24å°æ—¶åæ¸…ç†ä¸æ´»è·ƒæ–‡ä»¶çŠ¶æ€
  ignore_older: 48h              # å¿½ç•¥48å°æ—¶å‰çš„æ–‡ä»¶
```

**å‚æ•°é€‰æ‹©æŒ‡å¯¼**ï¼š

| åœºæ™¯ç±»å‹ | **scan_frequency** | **buffer_size** | **close_inactive** |
|---------|-------------------|-----------------|-------------------|
| `é«˜é¢‘æ—¥å¿—` | `1s` | `32KB-64KB` | `30s-1m` |
| `æ™®é€šæ—¥å¿—` | `10s` | `16KB` | `5m` |
| `ä½é¢‘æ—¥å¿—` | `30s` | `8KB` | `30m` |

---

## 7. ğŸ¯ å®æˆ˜é…ç½®æ¡ˆä¾‹


### 7.1 WebæœåŠ¡å™¨æ—¥å¿—æ”¶é›†


**Nginxè®¿é—®æ—¥å¿—é…ç½®**ï¼š
```yaml
filebeat.inputs:
# Nginxè®¿é—®æ—¥å¿—
- type: log
  enabled: true
  paths:
    - /var/log/nginx/access.log
    - /var/log/nginx/access-*.log
  fields:
    service: nginx
    log_type: access
  exclude_lines: ['/health', '/favicon.ico']    # æ’é™¤å¥åº·æ£€æŸ¥
  encoding: utf-8
  
# Nginxé”™è¯¯æ—¥å¿—  
- type: log
  enabled: true
  paths:
    - /var/log/nginx/error.log
  fields:
    service: nginx
    log_type: error
  include_lines: ['\[error\]', '\[warn\]']     # åªæ”¶é›†é”™è¯¯å’Œè­¦å‘Š
```

### 7.2 Javaåº”ç”¨æ—¥å¿—æ”¶é›†


**Spring Bootåº”ç”¨é…ç½®**ï¼š
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/spring-boot/*.log
  fields:
    application: spring-boot
    environment: production
  
  # å¤šè¡Œå¼‚å¸¸åˆå¹¶
  multiline:
    pattern: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}'
    negate: true
    match: after
    max_lines: 1000
    timeout: 10s
    
  # è¿‡æ»¤é…ç½®
  exclude_lines: ['DEBUG', 'TRACE']
  encoding: utf-8
  
  # æ€§èƒ½ä¼˜åŒ–
  scan_frequency: 5s
  close_inactive: 2m
```

### 7.3 å®¹å™¨åŒ–ç¯å¢ƒæ—¥å¿—æ”¶é›†


**Dockerå®¹å™¨æ—¥å¿—é…ç½®**ï¼š
```yaml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/lib/docker/containers/*/*-json.log
  json.keys_under_root: true
  json.add_error_key: true
  
  fields:
    environment: docker
    
  # å®¹å™¨æ—¥å¿—é€šå¸¸æ˜¯JSONæ ¼å¼
  processors:
    - decode_json_fields:
        fields: ["message"]
        target: ""
        overwrite_keys: true
```

### 7.4 å¤šæœåŠ¡ç»Ÿä¸€é…ç½®


**å¾®æœåŠ¡ç¯å¢ƒé…ç½®**ï¼š
```yaml
filebeat.inputs:
# ç”¨æˆ·æœåŠ¡
- type: log
  paths: ["/var/log/user-service/*.log"]
  fields: {service: "user-service", team: "backend"}
  multiline:
    pattern: '^\d{4}-\d{2}-\d{2}'
    negate: true
    match: after
    
# è®¢å•æœåŠ¡
- type: log  
  paths: ["/var/log/order-service/*.log"]
  fields: {service: "order-service", team: "backend"}
  multiline:
    pattern: '^\d{4}-\d{2}-\d{2}'
    negate: true
    match: after
    
# æ”¯ä»˜æœåŠ¡
- type: log
  paths: ["/var/log/payment-service/*.log"] 
  fields: {service: "payment-service", team: "finance"}
  include_lines: ['ERROR', 'WARN', 'INFO']    # æ”¯ä»˜æœåŠ¡æ—¥å¿—æ›´ä¸¥æ ¼
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„é…ç½®è¦ç‚¹


```
ğŸ¯ åŸºç¡€é…ç½®ä¸‰è¦ç´ ï¼š
â€¢ type: log - æŒ‡å®šæ—¥å¿—æ–‡ä»¶è¾“å…¥ç±»å‹
â€¢ enabled: true - å¯ç”¨é…ç½®  
â€¢ paths: [...] - æŒ‡å®šæ–‡ä»¶è·¯å¾„

ğŸ” è·¯å¾„é…ç½®æ ¸å¿ƒï¼š
â€¢ ä½¿ç”¨é€šé…ç¬¦åŒ¹é…å¤šæ–‡ä»¶ï¼š*.log, **/*.log
â€¢ è€ƒè™‘æ—¥å¿—è½®è½¬ï¼šapp.log, app-*.log
â€¢ é¿å…è¿‡å®½åŒ¹é…å½±å“æ€§èƒ½

ğŸ“ å†…å®¹è¿‡æ»¤å…³é”®ï¼š
â€¢ include_lines: åªæ”¶é›†åŒ¹é…çš„è¡Œ
â€¢ exclude_lines: æ’é™¤åŒ¹é…çš„è¡Œ
â€¢ å…ˆæ‰§è¡Œincludeå†æ‰§è¡Œexclude

ğŸ”— å¤šè¡Œåˆå¹¶è¦ç‚¹ï¼š
â€¢ pattern: è¯†åˆ«è¡Œçš„æ­£åˆ™æ¨¡å¼
â€¢ negate: å†³å®šåŒ¹é…è¡Œè¿˜æ˜¯éåŒ¹é…è¡Œä½œä¸ºç»§ç»­è¡Œ
â€¢ match: after(å‘ååˆå¹¶) æˆ– before(å‘å‰åˆå¹¶)
```

### 8.2 é…ç½®é€‰æ‹©æŒ‡å¯¼åŸåˆ™


**æ ¹æ®æ—¥å¿—ç‰¹ç‚¹é€‰æ‹©é…ç½®**ï¼š

```
å•è¡Œç®€å•æ—¥å¿—ï¼š
â†’ åŸºç¡€é…ç½®å³å¯
â†’ é‡ç‚¹å…³æ³¨è·¯å¾„å’Œè¿‡æ»¤

å¤šè¡Œå¤æ‚æ—¥å¿—ï¼š
â†’ å¿…é¡»é…ç½®multiline
â†’ é‡ç‚¹è°ƒè¯•patternæ¨¡å¼

é«˜é¢‘å¤§é‡æ—¥å¿—ï¼š
â†’ ä¼˜åŒ–æ€§èƒ½å‚æ•°
â†’ åˆç†è®¾ç½®è¿‡æ»¤è§„åˆ™

å¤šæœåŠ¡æ··åˆæ—¥å¿—ï¼š
â†’ ä½¿ç”¨fieldsåŒºåˆ†æœåŠ¡
â†’ ç»Ÿä¸€multilineæ¨¡å¼
```

### 8.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**é—®é¢˜1ï¼šä¸­æ–‡ä¹±ç **
```yaml
è§£å†³æ–¹æ¡ˆï¼šæ­£ç¡®è®¾ç½®ç¼–ç 
encoding: utf-8    # æˆ–gbkï¼Œæ ¹æ®å®é™…æƒ…å†µ
```

**é—®é¢˜2ï¼šå¤šè¡Œæ—¥å¿—åˆ†æ•£**
```yaml
è§£å†³æ–¹æ¡ˆï¼šé…ç½®multilineåˆå¹¶
multiline:
  pattern: '^\d{4}-\d{2}-\d{2}'    # æ ¹æ®å®é™…æ ¼å¼è°ƒæ•´
  negate: true
  match: after
```

**é—®é¢˜3ï¼šæ”¶é›†äº†å¤ªå¤šæ— ç”¨æ—¥å¿—**
```yaml
è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¿‡æ»¤è§„åˆ™
exclude_lines: ['DEBUG', 'health_check']    # æ’é™¤è°ƒè¯•å’Œå¥åº·æ£€æŸ¥
```

**é—®é¢˜4ï¼šæ–‡ä»¶å¥æŸ„è€—å°½**
```yaml
è§£å†³æ–¹æ¡ˆï¼šä¼˜åŒ–æ–‡ä»¶ç®¡ç†
close_inactive: 5m      # åŠæ—¶å…³é—­ä¸æ´»è·ƒæ–‡ä»¶
clean_inactive: 24h     # æ¸…ç†æ—§æ–‡ä»¶çŠ¶æ€
```

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ é…ç½®æœ€ä½³å®è·µ**ï¼š
- **åˆ†å±‚é…ç½®**ï¼šæŒ‰æœåŠ¡ã€ç¯å¢ƒåˆ†åˆ«é…ç½®ï¼Œä¾¿äºç®¡ç†
- **åˆç†è¿‡æ»¤**ï¼šåªæ”¶é›†æœ‰ä»·å€¼çš„æ—¥å¿—ï¼Œå‡å°‘å­˜å‚¨å’Œä¼ è¾“æˆæœ¬
- **ç»Ÿä¸€æ ‡å‡†**ï¼šåŒç±»æœåŠ¡ä½¿ç”¨ç›¸åŒçš„multilineæ¨¡å¼
- **ç›‘æ§ä¼˜åŒ–**ï¼šå®šæœŸæ£€æŸ¥Filebeatæ€§èƒ½æŒ‡æ ‡ï¼Œè°ƒä¼˜å‚æ•°

**ğŸ”§ è¿ç»´æœ€ä½³å®è·µ**ï¼š
- **æµ‹è¯•éªŒè¯**ï¼šæ–°é…ç½®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•é…ç½®å˜æ›´åŸå› å’Œæ•ˆæœ
- **å®šæœŸå®¡æŸ¥**ï¼šå®šæœŸæ£€æŸ¥é…ç½®çš„æœ‰æ•ˆæ€§å’Œå¿…è¦æ€§

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è·¯å¾„é€šé…çµæ´»é…ï¼Œè¿‡æ»¤è§„åˆ™è¦ç²¾å‡†
- å¤šè¡Œåˆå¹¶çœ‹æ¨¡å¼ï¼Œç¼–ç è®¾ç½®é˜²ä¹±ç   
- æ€§èƒ½å‚æ•°éœ€è°ƒä¼˜ï¼Œå­—æ®µæ ‡ç­¾åŠ©åˆ†ç±»
- æµ‹è¯•éªŒè¯ä¿ç¨³å®šï¼Œç›‘æ§ä¼˜åŒ–ä¿ƒæå‡