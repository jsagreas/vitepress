---
title: 12ã€Kafkaè¾“å‡ºé…ç½®
---
## ğŸ“š ç›®å½•

1. [Kafkaè¾“å‡ºåŸºç¡€æ¦‚å¿µ](#1-kafkaè¾“å‡ºåŸºç¡€æ¦‚å¿µ)
2. [æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£](#2-æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£)
3. [è¿æ¥ä¸é›†ç¾¤é…ç½®](#3-è¿æ¥ä¸é›†ç¾¤é…ç½®)
4. [ä¸»é¢˜ä¸åˆ†åŒºç­–ç•¥](#4-ä¸»é¢˜ä¸åˆ†åŒºç­–ç•¥)
5. [æ€§èƒ½ä¸å¯é æ€§é…ç½®](#5-æ€§èƒ½ä¸å¯é æ€§é…ç½®)
6. [å®æˆ˜é…ç½®ç¤ºä¾‹](#6-å®æˆ˜é…ç½®ç¤ºä¾‹)
7. [æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–](#7-æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ Kafkaè¾“å‡ºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Kafkaè¾“å‡º


**ç®€å•ç†è§£**ï¼šKafkaè¾“å‡ºå°±æ˜¯æŠŠFilebeatæ”¶é›†çš„æ—¥å¿—æ•°æ®å‘é€åˆ°Kafkaæ¶ˆæ¯é˜Ÿåˆ—çš„è¿‡ç¨‹ã€‚

```
æ—¥å¿—æ–‡ä»¶ â†’ Filebeat â†’ Kafkaé›†ç¾¤ â†’ å…¶ä»–ç³»ç»Ÿæ¶ˆè´¹
```

**ä¸ºä»€ä¹ˆé€‰æ‹©Kafkaï¼Ÿ**
- **ğŸ“Š é«˜ååé‡**ï¼šæ¯ç§’å¤„ç†ç™¾ä¸‡çº§æ¶ˆæ¯
- **ğŸ”„ è§£è€¦ç³»ç»Ÿ**ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…äº’ä¸å½±å“  
- **ğŸ“ˆ æ˜“æ‰©å±•**ï¼šæ°´å¹³æ‰©å±•æ”¯æŒå¤§è§„æ¨¡æ•°æ®
- **ğŸ’¾ æ•°æ®æŒä¹…åŒ–**ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±

### 1.2 Kafkaè¾“å‡ºçš„å·¥ä½œæµç¨‹


```
Filebeatæ”¶é›†æ—¥å¿—
       â†“
æ ¼å¼åŒ–ä¸ºJSONæ¶ˆæ¯
       â†“
é€‰æ‹©ç›®æ ‡ä¸»é¢˜(topic)
       â†“
ç¡®å®šåˆ†åŒºç­–ç•¥
       â†“
å‘é€åˆ°Kafkaé›†ç¾¤
       â†“
ç­‰å¾…ç¡®è®¤å“åº”
```

**æ ¸å¿ƒé…ç½®æ®µ**ï¼š`output.kafka`

---

## 2. âš™ï¸ æ ¸å¿ƒé…ç½®å‚æ•°è¯¦è§£


### 2.1 åŸºç¡€è¾“å‡ºé…ç½®ç»“æ„


```yaml
output.kafka:
  # å¿…éœ€é…ç½®
  hosts: ["kafka1:9092", "kafka2:9092"]
  topic: "filebeat-logs"
  
  # å¯é€‰é…ç½®
  partition.round_robin:
    reachable_only: false
  required_acks: 1
  compression: gzip
  max_message_bytes: 1000000
```

### 2.2 é…ç½®å‚æ•°åˆ†ç±»


**ğŸ”¸ è¿æ¥é…ç½®**
- `hosts` - KafkaæœåŠ¡å™¨åœ°å€
- `username/password` - è®¤è¯ä¿¡æ¯
- `ssl` - åŠ å¯†è¿æ¥è®¾ç½®

**ğŸ”¸ æ¶ˆæ¯é…ç½®**  
- `topic` - ç›®æ ‡ä¸»é¢˜
- `partition` - åˆ†åŒºç­–ç•¥
- `compression` - å‹ç¼©ç®—æ³•

**ğŸ”¸ å¯é æ€§é…ç½®**
- `required_acks` - ç¡®è®¤çº§åˆ«
- `retry` - é‡è¯•æœºåˆ¶
- `timeout` - è¶…æ—¶è®¾ç½®

---

## 3. ğŸŒ è¿æ¥ä¸é›†ç¾¤é…ç½®


### 3.1 hosts - Kafkaé›†ç¾¤åœ°å€é…ç½®


**ä½œç”¨**ï¼šæŒ‡å®šKafkaé›†ç¾¤ä¸­brokerçš„åœ°å€å’Œç«¯å£

```yaml
# å•ä¸ªèŠ‚ç‚¹
output.kafka:
  hosts: ["localhost:9092"]

# å¤šä¸ªèŠ‚ç‚¹é›†ç¾¤
output.kafka:
  hosts: 
    - "kafka-node1:9092"
    - "kafka-node2:9092" 
    - "kafka-node3:9092"

# å¸¦åŸŸåçš„é…ç½®
output.kafka:
  hosts: ["kafka.company.com:9092"]
```

**ğŸ“ é…ç½®è¯´æ˜**ï¼š
- **æ ¼å¼**ï¼š`["host1:port1", "host2:port2"]`
- **é»˜è®¤ç«¯å£**ï¼š9092
- **å»ºè®®**ï¼šé…ç½®å¤šä¸ªèŠ‚ç‚¹æé«˜å¯ç”¨æ€§

### 3.2 è®¤è¯é…ç½®


**SASLè®¤è¯é…ç½®**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  username: "filebeat-user"
  password: "secure-password"
  
  # SASLæœºåˆ¶é€‰æ‹©
  sasl.mechanism: "PLAIN"  # æˆ– SCRAM-SHA-256, SCRAM-SHA-512
```

**SSLåŠ å¯†é…ç½®**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9093"]  # SSLç«¯å£é€šå¸¸æ˜¯9093
  ssl.enabled: true
  ssl.certificate_authorities: ["/path/to/ca.crt"]
  ssl.certificate: "/path/to/client.crt"
  ssl.key: "/path/to/client.key"
```

### 3.3 è¿æ¥æ± ä¸è¶…æ—¶è®¾ç½®


```yaml
output.kafka:
  hosts: ["kafka:9092"]
  
  # è¿æ¥è¶…æ—¶ï¼ˆé»˜è®¤30ç§’ï¼‰
  timeout: 30s
  
  # ä¿æŒè¿æ¥æ´»è·ƒ
  keep_alive: 3s
  
  # å…ƒæ•°æ®åˆ·æ–°é—´éš”
  metadata:
    refresh_frequency: 10m
    full: false
```

---

## 4. ğŸ“‹ ä¸»é¢˜ä¸åˆ†åŒºç­–ç•¥


### 4.1 topic - ä¸»é¢˜é…ç½®


**é™æ€ä¸»é¢˜é…ç½®**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "application-logs"  # å›ºå®šä¸»é¢˜åç§°
```

**åŠ¨æ€ä¸»é¢˜é…ç½®**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  # åŸºäºå­—æ®µåŠ¨æ€ç”Ÿæˆä¸»é¢˜å
  topic: "%{[fields.log_type]}-logs"
  
# å¯¹åº”çš„æ—¥å¿—é‡‡é›†é…ç½®
filebeat.inputs:
- type: log
  paths: ["/var/log/app/*.log"]
  fields:
    log_type: "application"
```

**æŒ‰æ—¥æœŸåˆ†å‰²ä¸»é¢˜**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs-%{+yyyy.MM.dd}"  # ç”Ÿæˆï¼šlogs-2025.09.21
```

### 4.2 partition - åˆ†åŒºç­–ç•¥è¯¦è§£


**round_robinåˆ†åŒºï¼ˆé»˜è®¤ï¼‰**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  partition.round_robin:
    reachable_only: false  # æ˜¯å¦åªå‘é€åˆ°å¯è¾¾åˆ†åŒº
```

**hashåˆ†åŒº**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  partition.hash:
    # åŸºäºæŒ‡å®šå­—æ®µè¿›è¡Œhashåˆ†åŒº
    hash: ["%{[host.name]}"]
    random: true  # hashå†²çªæ—¶éšæœºé€‰æ‹©
```

**randomåˆ†åŒº**ï¼š
```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  partition.random:
    group_events: 1  # æ¯ç»„äº‹ä»¶æ•°é‡
```

### 4.3 åˆ†åŒºç­–ç•¥å¯¹æ¯”


| åˆ†åŒºç­–ç•¥ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|-------------|---------|---------|
| `round_robin` | è´Ÿè½½å‡è¡¡ | åˆ†å¸ƒå‡åŒ€ | æ— åºä¿è¯ |
| `hash` | ç›¸åŒkeyæ•°æ®æœ‰åº | ä¿è¯é¡ºåº | å¯èƒ½å€¾æ–œ |
| `random` | ç®€å•åœºæ™¯ | é…ç½®ç®€å• | å®Œå…¨éšæœº |

---

## 5. âš¡ æ€§èƒ½ä¸å¯é æ€§é…ç½®


### 5.1 required_acks - ç¡®è®¤çº§åˆ«


**ä½œç”¨**ï¼šæ§åˆ¶æ¶ˆæ¯ç¡®è®¤çš„ä¸¥æ ¼ç¨‹åº¦ï¼Œå½±å“æ€§èƒ½å’Œå¯é æ€§çš„å¹³è¡¡

```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  
  # ç¡®è®¤çº§åˆ«é€‰æ‹©
  required_acks: 1  # 0, 1, -1
```

**ç¡®è®¤çº§åˆ«è¯´æ˜**ï¼š

```
required_acks: 0 - æ— ç¡®è®¤ï¼ˆæœ€å¿«ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filebeat   â”‚â”€â”€â”€â–¶â”‚   Kafka     â”‚
â”‚             â”‚    â”‚   Broker    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      ç«åŠ›å…¨å¼€ï¼Œä¸ç­‰å“åº”

required_acks: 1 - Leaderç¡®è®¤ï¼ˆå¹³è¡¡ï¼‰  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filebeat   â”‚â”€â”€â”€â–¶â”‚   Leader    â”‚
â”‚             â”‚â—€â”€â”€â”€â”‚   Broker    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      ç­‰å¾…Leaderå†™å…¥ç¡®è®¤

required_acks: -1 - å…¨éƒ¨å‰¯æœ¬ç¡®è®¤ï¼ˆæœ€å¯é ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filebeat   â”‚â”€â”€â”€â–¶â”‚   Leader    â”‚â”€â”€â”€â–¶â”‚  Followers  â”‚
â”‚             â”‚â—€â”€â”€â”€â”‚   Broker    â”‚â—€â”€â”€â”€â”‚   Brokers   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      ç­‰å¾…æ‰€æœ‰å‰¯æœ¬åŒæ­¥ç¡®è®¤
```

**é€‰æ‹©å»ºè®®**ï¼š
- **é«˜æ€§èƒ½åœºæ™¯**ï¼š`required_acks: 0`
- **ä¸€èˆ¬åœºæ™¯**ï¼š`required_acks: 1`
- **å…³é”®ä¸šåŠ¡**ï¼š`required_acks: -1`

### 5.2 compression - å‹ç¼©ç®—æ³•é…ç½®


```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  
  # å‹ç¼©ç®—æ³•é€‰æ‹©
  compression: gzip  # none, gzip, snappy, lz4, zstd
```

**å‹ç¼©ç®—æ³•å¯¹æ¯”**ï¼š

| å‹ç¼©ç®—æ³• | **å‹ç¼©ç‡** | **CPUæ¶ˆè€—** | **é€Ÿåº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-----------|-----------|---------|-------------|
| `none` | æ— å‹ç¼© | æœ€ä½ | æœ€å¿« | ç½‘ç»œå……è¶³ |
| `gzip` | é«˜ | é«˜ | æ…¢ | ç½‘ç»œå—é™ |
| `snappy` | ä¸­ç­‰ | ä¸­ç­‰ | å¿« | å¹³è¡¡é€‰æ‹© |
| `lz4` | ä¸­ç­‰ | ä½ | å¾ˆå¿« | æ€§èƒ½ä¼˜å…ˆ |
| `zstd` | å¾ˆé«˜ | ä¸­ç­‰ | ä¸­ç­‰ | æ–°ç‰ˆæœ¬æ¨è |

### 5.3 max_message_bytes - æ¶ˆæ¯å¤§å°é™åˆ¶


```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  
  # æœ€å¤§æ¶ˆæ¯å¤§å°ï¼ˆé»˜è®¤1MBï¼‰
  max_message_bytes: 1000000  # 1MB
  
  # å¤§æ¶ˆæ¯å¤„ç†
  max_message_bytes: 10485760  # 10MB
```

**ğŸ“ æ³¨æ„äº‹é¡¹**ï¼š
- å¿…é¡»å°äºKafka brokerçš„`message.max.bytes`é…ç½®
- è¿‡å¤§ä¼šå½±å“æ€§èƒ½
- å»ºè®®æ ¹æ®å®é™…æ—¥å¿—å¤§å°è°ƒæ•´

### 5.4 é‡è¯•æœºåˆ¶é…ç½®


```yaml
output.kafka:
  hosts: ["kafka:9092"]
  topic: "logs"
  
  # é‡è¯•é…ç½®
  max_retries: 3        # æœ€å¤§é‡è¯•æ¬¡æ•°
  backoff.init: 1s      # åˆå§‹é€€é¿æ—¶é—´
  backoff.max: 60s      # æœ€å¤§é€€é¿æ—¶é—´
  
  # æ‰¹é‡å‘é€é…ç½®
  bulk_max_size: 2048   # æ‰¹é‡å¤§å°
  bulk_flush_frequency: 5s  # åˆ·æ–°é¢‘ç‡
```

---

## 6. ğŸ› ï¸ å®æˆ˜é…ç½®ç¤ºä¾‹


### 6.1 åŸºç¡€ç”Ÿäº§ç¯å¢ƒé…ç½®


```yaml
# filebeat.yml
filebeat.inputs:
- type: log
  paths: ["/var/log/app/*.log"]
  fields:
    service: "web-api"
    environment: "production"

output.kafka:
  # Kafkaé›†ç¾¤åœ°å€
  hosts: 
    - "kafka-1.internal:9092"
    - "kafka-2.internal:9092"
    - "kafka-3.internal:9092"
  
  # ä¸»é¢˜é…ç½®
  topic: "app-logs-%{[fields.environment]}"
  
  # åˆ†åŒºç­–ç•¥ï¼šåŸºäºæœåŠ¡åhashåˆ†åŒº
  partition.hash:
    hash: ["%{[fields.service]}"]
  
  # å¯é æ€§é…ç½®
  required_acks: 1
  max_retries: 3
  
  # æ€§èƒ½é…ç½®
  compression: snappy
  bulk_max_size: 1024
  bulk_flush_frequency: 2s

# æ—¥å¿—çº§åˆ«
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
```

### 6.2 é«˜æ€§èƒ½åœºæ™¯é…ç½®


```yaml
output.kafka:
  hosts: ["kafka-cluster:9092"]
  topic: "high-volume-logs"
  
  # æ€§èƒ½ä¼˜å…ˆé…ç½®
  required_acks: 0          # æ— ç¡®è®¤ï¼Œæœ€é«˜æ€§èƒ½
  compression: lz4          # å¿«é€Ÿå‹ç¼©
  max_message_bytes: 5242880  # 5MB
  
  # æ‰¹é‡å¤„ç†ä¼˜åŒ–
  bulk_max_size: 4096       # å¤§æ‰¹é‡
  bulk_flush_frequency: 1s   # å¿«é€Ÿåˆ·æ–°
  
  # ç½‘ç»œä¼˜åŒ–
  timeout: 10s
  keep_alive: 1s
  
  # åˆ†åŒºä¼˜åŒ–
  partition.round_robin:
    reachable_only: true    # åªå‘é€åˆ°å¯ç”¨åˆ†åŒº
```

### 6.3 å®‰å…¨ç”Ÿäº§ç¯å¢ƒé…ç½®


```yaml
output.kafka:
  hosts: ["secure-kafka:9093"]
  topic: "secure-logs"
  
  # è®¤è¯é…ç½®
  username: "${KAFKA_USERNAME}"
  password: "${KAFKA_PASSWORD}"
  sasl.mechanism: "SCRAM-SHA-256"
  
  # SSLåŠ å¯†
  ssl.enabled: true
  ssl.certificate_authorities: ["/etc/ssl/ca.crt"]
  ssl.verification_mode: "strict"
  
  # é«˜å¯é æ€§é…ç½®
  required_acks: -1         # å…¨å‰¯æœ¬ç¡®è®¤
  max_retries: 5
  backoff.max: 300s
  
  # æ¶ˆæ¯å®Œæ•´æ€§
  compression: zstd
  max_message_bytes: 2097152  # 2MBé™åˆ¶
```

### 6.4 å¤šç¯å¢ƒåŠ¨æ€ä¸»é¢˜é…ç½®


```yaml
filebeat.inputs:
- type: log
  paths: ["/var/log/nginx/access.log"]
  fields:
    log_type: "access"
    service: "nginx"
  
- type: log
  paths: ["/var/log/app/error.log"]
  fields:
    log_type: "error"
    service: "application"

output.kafka:
  hosts: ["kafka:9092"]
  
  # åŠ¨æ€ä¸»é¢˜ï¼šæŒ‰æ—¥æœŸå’Œç±»å‹åˆ†å‰²
  topic: "%{[fields.service]}-%{[fields.log_type]}-%{+yyyy.MM.dd}"
  
  # æ™ºèƒ½åˆ†åŒºï¼šé”™è¯¯æ—¥å¿—é›†ä¸­å¤„ç†
  partition.hash:
    hash: ["%{[fields.log_type]}", "%{[host.name]}"]
  
  # åˆ†çº§ç¡®è®¤ï¼šé”™è¯¯æ—¥å¿—é«˜å¯é æ€§
  required_acks: 1
  
processors:
- if:
    equals:
      fields.log_type: "error"
  then:
  - add_fields:
      target: _kafka
      fields:
        required_acks: -1  # é”™è¯¯æ—¥å¿—ä½¿ç”¨æœ€é«˜å¯é æ€§
```

---

## 7. ğŸ”§ æ•…éšœæ’æŸ¥ä¸ä¼˜åŒ–


### 7.1 å¸¸è§è¿æ¥é—®é¢˜


**é—®é¢˜1ï¼šè¿æ¥Kafkaå¤±è´¥**
```
âŒ é”™è¯¯ä¿¡æ¯ï¼š
ERROR kafka/client.go:xxx connect failed: dial tcp: no route to host

ğŸ” æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
2. éªŒè¯ç«¯å£å¼€æ”¾
3. ç¡®è®¤é˜²ç«å¢™è®¾ç½®

âœ… è§£å†³æ–¹æ¡ˆï¼š
# æµ‹è¯•è¿æ¥
telnet kafka-host 9092

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo firewall-cmd --list-ports
```

**é—®é¢˜2ï¼šè®¤è¯å¤±è´¥**
```
âŒ é”™è¯¯ä¿¡æ¯ï¼š
ERROR kafka/client.go:xxx SASL authentication failed

ğŸ” æ£€æŸ¥æ¸…å•ï¼š
â–¡ ç”¨æˆ·åå¯†ç æ­£ç¡®
â–¡ SASLæœºåˆ¶åŒ¹é…
â–¡ æƒé™é…ç½®æ­£ç¡®

âœ… é…ç½®éªŒè¯ï¼š
output.kafka:
  username: "correct-username"
  password: "correct-password"
  sasl.mechanism: "PLAIN"  # ç¡®ä¿æœºåˆ¶åŒ¹é…
```

### 7.2 æ€§èƒ½è°ƒä¼˜æŒ‡å—


**ç›‘æ§å…³é”®æŒ‡æ ‡**ï¼š
```yaml
# æ·»åŠ ç›‘æ§é…ç½®
monitoring.enabled: true

# å…³é”®æŒ‡æ ‡ï¼š
# - å‘é€é€Ÿç‡ï¼ˆevents/secï¼‰
# - é”™è¯¯ç‡ï¼ˆerrors/secï¼‰  
# - å»¶è¿Ÿï¼ˆlatencyï¼‰
# - æ‰¹é‡å¤§å°ï¼ˆbatch_sizeï¼‰
```

**æ€§èƒ½ä¼˜åŒ–é…ç½®**ï¼š
```yaml
output.kafka:
  # ç½‘ç»œä¼˜åŒ–
  timeout: 5s
  keep_alive: 3s
  
  # æ‰¹é‡ä¼˜åŒ–
  bulk_max_size: 2048      # æ ¹æ®å†…å­˜è°ƒæ•´
  bulk_flush_frequency: 2s  # æ ¹æ®å»¶è¿Ÿè¦æ±‚è°ƒæ•´
  
  # å‹ç¼©ä¼˜åŒ–
  compression: snappy      # å¹³è¡¡å‹ç¼©ç‡å’ŒCPU
  
  # å¹¶å‘ä¼˜åŒ–  
  worker: 2               # å·¥ä½œçº¿ç¨‹æ•°
```

### 7.3 æ¶ˆæ¯ä¸¢å¤±æ’æŸ¥


**æ’æŸ¥æ­¥éª¤**ï¼š
```
1. æ£€æŸ¥Filebeatæ—¥å¿—
tail -f /var/log/filebeat/filebeat.log

2. éªŒè¯Kafka topic
kafka-console-consumer.sh --bootstrap-server kafka:9092 \
  --topic your-topic --from-beginning

3. æ£€æŸ¥ç¡®è®¤çº§åˆ«
required_acks: 1  # ç¡®ä¿æœ‰ç¡®è®¤

4. éªŒè¯é‡è¯•é…ç½®
max_retries: 3
backoff.max: 60s
```

**æ¶ˆæ¯å»é‡å¤„ç†**ï¼š
```yaml
# æ·»åŠ å”¯ä¸€IDé¿å…é‡å¤
processors:
- fingerprint:
    fields: ["message", "@timestamp", "host.name"]
    target_field: "event_id"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒé…ç½®


```yaml
ğŸ”¸ åŸºç¡€è¿æ¥é…ç½®
hosts: Kafkaé›†ç¾¤åœ°å€åˆ—è¡¨
username/password: è®¤è¯ä¿¡æ¯
ssl: åŠ å¯†è¿æ¥é…ç½®

ğŸ”¸ æ¶ˆæ¯è·¯ç”±é…ç½®  
topic: ç›®æ ‡ä¸»é¢˜ï¼ˆæ”¯æŒåŠ¨æ€ï¼‰
partition: åˆ†åŒºç­–ç•¥é€‰æ‹©

ğŸ”¸ å¯é æ€§é…ç½®
required_acks: ç¡®è®¤çº§åˆ«ï¼ˆ0/1/-1ï¼‰
max_retries: é‡è¯•æ¬¡æ•°
compression: å‹ç¼©ç®—æ³•

ğŸ”¸ æ€§èƒ½é…ç½®
bulk_max_size: æ‰¹é‡å¤§å°
bulk_flush_frequency: åˆ·æ–°é¢‘ç‡
max_message_bytes: æ¶ˆæ¯å¤§å°é™åˆ¶
```

### 8.2 é…ç½®é€‰æ‹©æŒ‡å¯¼åŸåˆ™


**ğŸ”¹ å¯é æ€§çº§åˆ«é€‰æ‹©**
```
é«˜å¯é æ€§ä¸šåŠ¡ï¼š
required_acks: -1
max_retries: 5
compression: zstd

ä¸€èˆ¬ä¸šåŠ¡ï¼š
required_acks: 1  
max_retries: 3
compression: snappy

é«˜æ€§èƒ½åœºæ™¯ï¼š
required_acks: 0
bulk_max_size: 4096
compression: lz4
```

**ğŸ”¹ åˆ†åŒºç­–ç•¥é€‰æ‹©**
```
éœ€è¦é¡ºåºä¿è¯ï¼š
partition.hash: [å…³é”®å­—æ®µ]

è´Ÿè½½å‡è¡¡ï¼š
partition.round_robin

ç®€å•åœºæ™¯ï¼š
partition.random
```

**ğŸ”¹ å‹ç¼©ç®—æ³•é€‰æ‹©**
```
ç½‘ç»œå¸¦å®½å……è¶³ï¼šcompression: none
å¹³è¡¡åœºæ™¯ï¼šcompression: snappy  
ç½‘ç»œå—é™ï¼šcompression: gzip
æ–°ç‰ˆæœ¬æ¨èï¼šcompression: zstd
```

### 8.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**âœ… è¿æ¥é…ç½®**
- é…ç½®å¤šä¸ªKafkaèŠ‚ç‚¹æé«˜å¯ç”¨æ€§
- ä½¿ç”¨åŸŸåè€ŒéIPåœ°å€
- å¯ç”¨SSLåŠ å¯†ä¼ è¾“æ•æ„Ÿæ•°æ®

**âœ… ä¸»é¢˜ç®¡ç†**
- ä½¿ç”¨æœ‰æ„ä¹‰çš„ä¸»é¢˜å‘½åè§„èŒƒ
- è€ƒè™‘æŒ‰æ—¶é—´åˆ†å‰²å¤§ä¸»é¢˜
- åˆç†è®¾ç½®åˆ†åŒºæ•°é‡

**âœ… æ€§èƒ½ä¼˜åŒ–**
- æ ¹æ®ç½‘ç»œå’ŒCPUæƒ…å†µé€‰æ‹©å‹ç¼©ç®—æ³•
- è°ƒæ•´æ‰¹é‡å¤§å°å¹³è¡¡å»¶è¿Ÿå’Œååé‡
- ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡

**âœ… å¯é æ€§ä¿éšœ**
- æ ¹æ®ä¸šåŠ¡é‡è¦æ€§é€‰æ‹©ç¡®è®¤çº§åˆ«
- é…ç½®åˆç†çš„é‡è¯•æœºåˆ¶
- å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- Kafkaè¾“å‡ºé…ç½®å›´ç»•**è¿æ¥ã€è·¯ç”±ã€æ€§èƒ½ã€å¯é æ€§**å››ä¸ªç»´åº¦
- **required_acks**æ˜¯å¯é æ€§å’Œæ€§èƒ½çš„å…³é”®å¹³è¡¡ç‚¹
- **æ‰¹é‡é…ç½®**ç›´æ¥å½±å“ååé‡å’Œå»¶è¿Ÿ
- **åˆ†åŒºç­–ç•¥**å†³å®šæ¶ˆæ¯åˆ†å¸ƒå’Œé¡ºåºä¿è¯
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»è€ƒè™‘**å®‰å…¨è®¤è¯**å’Œ**ç›‘æ§å‘Šè­¦**