---
title: 29ã€é›†ç¾¤ç›‘æ§ä¸å¥åº·æ£€æŸ¥
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤ç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-é›†ç¾¤ç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [monitoringç›‘æ§é…ç½®è¯¦è§£](#2-monitoringç›‘æ§é…ç½®è¯¦è§£)
3. [é›†ç¾¤UUIDä¸æ ‡è¯†ç®¡ç†](#3-é›†ç¾¤UUIDä¸æ ‡è¯†ç®¡ç†)
4. [X-Packç›‘æ§æ‰©å±•åŠŸèƒ½](#4-X-Packç›‘æ§æ‰©å±•åŠŸèƒ½)
5. [æŒ‡æ ‡æ”¶é›†ä¸ç›‘æ§å‘¨æœŸ](#5-æŒ‡æ ‡æ”¶é›†ä¸ç›‘æ§å‘¨æœŸ)
6. [ç›‘æ§è®¤è¯ä¸å®‰å…¨é…ç½®](#6-ç›‘æ§è®¤è¯ä¸å®‰å…¨é…ç½®)
7. [å®æˆ˜é…ç½®ä¸æœ€ä½³å®è·µ](#7-å®æˆ˜é…ç½®ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” é›†ç¾¤ç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Filebeaté›†ç¾¤ç›‘æ§


> **é›†ç¾¤ç›‘æ§**ï¼šå°±åƒç»™ä½ çš„æ•°æ®æ”¶é›†å›¢é˜Ÿå®‰è£…äº†ä¸€å¥—"å¥åº·ä½“æ£€ç³»ç»Ÿ"ï¼Œå®æ—¶ç›‘æ§æ¯ä¸ªFilebeatèŠ‚ç‚¹çš„å·¥ä½œçŠ¶æ€ã€æ€§èƒ½è¡¨ç°å’Œå¥åº·ç¨‹åº¦ã€‚

**ğŸ¥ ç”Ÿæ´»åŒ–ç†è§£**
```
æƒ³è±¡ä¸€ä¸ªåŒ»é™¢çš„ç›‘æŠ¤ç³»ç»Ÿï¼š
åŒ»é™¢ = Elasticsearché›†ç¾¤
ç—…æˆ¿ = å„ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹  
ç›‘æŠ¤è®¾å¤‡ = Filebeatç›‘æ§
æŠ¤å£«ç«™æ˜¾ç¤ºå± = ç›‘æ§é¢æ¿

æŠ¤å£«å¯ä»¥å®æ—¶çœ‹åˆ°æ¯ä¸ªç—…æˆ¿çš„ï¼š
â€¢ å¿ƒç‡ â†’ CPUä½¿ç”¨ç‡
â€¢ è¡€å‹ â†’ å†…å­˜å ç”¨
â€¢ ä½“æ¸© â†’ ç½‘ç»œå»¶è¿Ÿ
â€¢ å‘¼å¸ â†’ æ•°æ®å¤„ç†é€Ÿåº¦
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤ç›‘æ§


**ğŸ¯ ç›‘æ§çš„æ ¸å¿ƒä»·å€¼**

| **ç›‘æ§ç›®æ ‡** | **è§£å†³é—®é¢˜** | **å®é™…ä»·å€¼** |
|-------------|-------------|-------------|
| **æ€§èƒ½ç›‘æ§** | `å‘ç°ç“¶é¢ˆå’Œå¼‚å¸¸` | `æå‰é¢„è­¦ï¼Œé¿å…ç³»ç»Ÿå´©æºƒ` |
| **å¥åº·æ£€æŸ¥** | `èŠ‚ç‚¹çŠ¶æ€è¿½è¸ª` | `å¿«é€Ÿå®šä½æ•…éšœèŠ‚ç‚¹` |
| **èµ„æºç®¡ç†** | `CPUã€å†…å­˜ã€ç£ç›˜ç›‘æ§` | `åˆç†åˆ†é…èµ„æºï¼Œä¼˜åŒ–æˆæœ¬` |
| **æ•°æ®æµç›‘æ§** | `æ•°æ®ä¼ è¾“çŠ¶æ€è·Ÿè¸ª` | `ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ã€ä¸å»¶è¿Ÿ` |

### 1.3 Filebeatç›‘æ§æ¶æ„


```
Filebeaté›†ç¾¤ç›‘æ§æ¶æ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç›‘æ§æ•°æ®æµå‘                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®æºå±‚       â”‚   Filebeatå±‚    â”‚    ç›‘æ§å­˜å‚¨å±‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ åº”ç”¨æ—¥å¿—       â”‚â€¢ Filebeat-01    â”‚â€¢ Elasticsearch      â”‚
â”‚â€¢ ç³»ç»Ÿæ—¥å¿—       â”‚â€¢ Filebeat-02    â”‚â€¢ ç›‘æ§ç´¢å¼•          â”‚
â”‚â€¢ æœåŠ¡æ—¥å¿—       â”‚â€¢ Filebeat-03    â”‚â€¢ æŒ‡æ ‡å­˜å‚¨          â”‚
â”‚                â”‚                 â”‚                     â”‚
â”‚     â†“           â”‚       â†“         â”‚         â†“           â”‚
â”‚                â”‚                 â”‚                     â”‚
â”‚â€¢ æ—¥å¿—æ–‡ä»¶       â”‚â€¢ æ”¶é›†å¤„ç†       â”‚â€¢ Kibanaä»ªè¡¨æ¿      â”‚
â”‚â€¢ äº‹ä»¶æ•°æ®       â”‚â€¢ çŠ¶æ€ç›‘æ§       â”‚â€¢ å‘Šè­¦é€šçŸ¥          â”‚
â”‚â€¢ æŒ‡æ ‡ä¿¡æ¯       â”‚â€¢ æ€§èƒ½æŒ‡æ ‡       â”‚â€¢ å¥åº·æ£€æŸ¥          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš™ï¸ monitoringç›‘æ§é…ç½®è¯¦è§£


### 2.1 monitoringåŸºç¡€é…ç½®


**ğŸ”§ æ ¸å¿ƒé…ç½®ç»“æ„**

```yaml
# filebeat.yml - åŸºç¡€ç›‘æ§é…ç½®
monitoring:
  enabled: true                    # å¯ç”¨ç›‘æ§åŠŸèƒ½
  cluster_uuid: "my-cluster-123"   # é›†ç¾¤å”¯ä¸€æ ‡è¯†
  
  elasticsearch:
    hosts: ["localhost:9200"]      # ç›‘æ§æ•°æ®å­˜å‚¨ä½ç½®
    username: "monitoring_user"    # ç›‘æ§ç”¨æˆ·å
    password: "monitoring_pass"    # ç›‘æ§å¯†ç 
```

**ğŸ’¡ é…ç½®é¡¹è¯¦è§£**

| **é…ç½®é¡¹** | **ä½œç”¨** | **å€¼ç±»å‹** | **ç¤ºä¾‹** |
|-----------|---------|-----------|---------|
| `enabled` | `æ˜¯å¦å¯ç”¨ç›‘æ§` | `å¸ƒå°”å€¼` | `true/false` |
| `cluster_uuid` | `é›†ç¾¤å”¯ä¸€æ ‡è¯†` | `å­—ç¬¦ä¸²` | `"prod-cluster-001"` |
| `hosts` | `ç›‘æ§æ•°æ®å­˜å‚¨åœ°å€` | `æ•°ç»„` | `["es1:9200", "es2:9200"]` |
| `username` | `è¿æ¥è®¤è¯ç”¨æˆ·å` | `å­—ç¬¦ä¸²` | `"filebeat_monitor"` |
| `password` | `è¿æ¥è®¤è¯å¯†ç ` | `å­—ç¬¦ä¸²` | `"secure_password"` |

### 2.2 ç›‘æ§æ•°æ®å­˜å‚¨é…ç½®


**ğŸ“Š æ•°æ®å­˜å‚¨ç­–ç•¥**

```yaml
monitoring:
  elasticsearch:
    hosts: ["es-monitor-01:9200", "es-monitor-02:9200"]
    
    # ç´¢å¼•é…ç½®
    template.settings:
      index:
        number_of_shards: 1         # åˆ†ç‰‡æ•°é‡
        number_of_replicas: 1       # å‰¯æœ¬æ•°é‡
        refresh_interval: "5s"      # åˆ·æ–°é—´éš”
    
    # æ‰¹é‡å‘é€é…ç½®
    bulk_max_size: 50              # æ‰¹é‡æœ€å¤§æ¡æ•°
    flush_interval: "1s"           # åˆ·æ–°é—´éš”
    
    # ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ
    ilm:
      enabled: true                # å¯ç”¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†
      rollover_alias: "filebeat-monitoring"
      pattern: "000001"
```

> **ğŸ’­ é€šä¿—è§£é‡Š**ï¼šå°±åƒè®¾ç½®ä¸€ä¸ªæ¡£æ¡ˆæŸœï¼Œå†³å®šæ¯ä¸ªæ–‡ä»¶å¤¹æ”¾å¤šå°‘æ–‡ä»¶ã€å¤šä¹…æ•´ç†ä¸€æ¬¡ã€ä»€ä¹ˆæ—¶å€™å½’æ¡£æ—§æ–‡ä»¶ã€‚

### 2.3 ç›‘æ§çº§åˆ«é…ç½®


**ğŸ“ˆ ä¸åŒç›‘æ§çº§åˆ«**

```yaml
monitoring:
  # åŸºç¡€ç›‘æ§ - è½»é‡çº§
  level: "basic"
  collect_interval: "10s"          # æ¯10ç§’æ”¶é›†ä¸€æ¬¡
  
  # è¯¦ç»†ç›‘æ§ - è¯¦ç»†ä¿¡æ¯
  level: "detailed" 
  collect_interval: "5s"           # æ¯5ç§’æ”¶é›†ä¸€æ¬¡
  
  # è°ƒè¯•ç›‘æ§ - æœ€è¯¦ç»†
  level: "debug"
  collect_interval: "1s"           # æ¯ç§’æ”¶é›†ä¸€æ¬¡
```

**âš–ï¸ ç›‘æ§çº§åˆ«å¯¹æ¯”**

| **çº§åˆ«** | **æ”¶é›†é¢‘ç‡** | **æ•°æ®é‡** | **æ€§èƒ½å½±å“** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-----------|-------------|-------------|
| **basic** | `10-30ç§’` | `è¾ƒå°‘` | `æœ€å°` | `ç”Ÿäº§ç¯å¢ƒæ—¥å¸¸ç›‘æ§` |
| **detailed** | `5-10ç§’` | `ä¸­ç­‰` | `ä¸­ç­‰` | `æ€§èƒ½è°ƒä¼˜åˆ†æ` |
| **debug** | `1-5ç§’` | `æœ€å¤š` | `è¾ƒå¤§` | `æ•…éšœæ’æŸ¥è°ƒè¯•` |

---

## 3. ğŸ”– é›†ç¾¤UUIDä¸æ ‡è¯†ç®¡ç†


### 3.1 cluster_uuidçš„ä½œç”¨


**ğŸ¯ ä»€ä¹ˆæ˜¯cluster_uuid**

> **cluster_uuid**ï¼šå°±åƒæ¯ä¸ªå®¶åº­çš„é—¨ç‰Œå·ï¼Œæ˜¯é›†ç¾¤çš„å”¯ä¸€èº«ä»½è¯ï¼Œç¡®ä¿ç›‘æ§æ•°æ®ä¸ä¼šä¸²é—¨åˆ°åˆ«çš„é›†ç¾¤ã€‚

```yaml
# å•é›†ç¾¤é…ç½®
monitoring:
  cluster_uuid: "prod-web-cluster-2024"
  
# å¤šé›†ç¾¤ç¯å¢ƒé…ç½®
monitoring:
  cluster_uuid: "${CLUSTER_ID:default-cluster}"  # ç¯å¢ƒå˜é‡æ–¹å¼
```

### 3.2 UUIDç”Ÿæˆä¸ç®¡ç†


**ğŸ”§ UUIDè®¾ç½®æ–¹å¼**

```bash
# æ–¹å¼1ï¼šæ‰‹åŠ¨æŒ‡å®šæœ‰æ„ä¹‰çš„UUID
cluster_uuid: "production-web-logs-2024"

# æ–¹å¼2ï¼šä½¿ç”¨Elasticsearché›†ç¾¤UUID
curl -X GET "localhost:9200/_cluster/stats" | jq '.cluster_uuid'

# æ–¹å¼3ï¼šç¯å¢ƒå˜é‡åŠ¨æ€è®¾ç½®
export FILEBEAT_CLUSTER_UUID="staging-api-logs"
```

**ğŸ“ UUIDå‘½åè§„èŒƒ**

```
æ¨èå‘½åæ ¼å¼ï¼š
{ç¯å¢ƒ}-{ä¸šåŠ¡}-{ç”¨é€”}-{ç‰ˆæœ¬}

ç¤ºä¾‹ï¼š
â€¢ prod-ecommerce-logs-v1        # ç”Ÿäº§ç”µå•†æ—¥å¿—
â€¢ staging-payment-metrics-v2    # æµ‹è¯•æ”¯ä»˜æŒ‡æ ‡  
â€¢ dev-user-events-v1           # å¼€å‘ç”¨æˆ·äº‹ä»¶
```

### 3.3 é›†ç¾¤æ ‡è¯†æœ€ä½³å®è·µ


**âœ… è‰¯å¥½å®è·µ**

| **åœºæ™¯** | **UUIDè®¾ç½®** | **è¯´æ˜** |
|---------|-------------|---------|
| **å•ä¸€é›†ç¾¤** | `"company-prod-logs"` | `ç®€å•æ˜ç¡®çš„æ ‡è¯†` |
| **å¤šç¯å¢ƒ** | `"${ENV}-logs-cluster"` | `é€šè¿‡å˜é‡åŒºåˆ†ç¯å¢ƒ` |
| **å¤šä¸šåŠ¡çº¿** | `"${BUSINESS}-${ENV}-logs"` | `ä¸šåŠ¡å’Œç¯å¢ƒåŒé‡æ ‡è¯†` |
| **ç‰ˆæœ¬ç®¡ç†** | `"logs-cluster-v${VERSION}"` | `åŒ…å«ç‰ˆæœ¬ä¿¡æ¯` |

---

## 4. ğŸ›¡ï¸ X-Packç›‘æ§æ‰©å±•åŠŸèƒ½


### 4.1 xpack.monitoringé…ç½®


**ğŸš€ X-Packç›‘æ§èƒ½åŠ›**

```yaml
xpack.monitoring:
  enabled: true                    # å¯ç”¨X-Packç›‘æ§
  
  # ç›‘æ§æ•°æ®æ”¶é›†
  collection:
    enabled: true                  # å¯ç”¨æ•°æ®æ”¶é›†
    interval: "10s"               # æ”¶é›†é—´éš”
    
  # ç›‘æ§æ•°æ®å¯¼å‡º
  exporters:
    elasticsearch:
      type: elasticsearch          # å¯¼å‡ºç±»å‹
      host: ["es-monitor:9200"]    # ç›‘æ§ESåœ°å€
      
    http:
      type: http                   # HTTPå¯¼å‡º
      host: "http://monitor-api:8080"
```

### 4.2 é«˜çº§ç›‘æ§ç‰¹æ€§


**ğŸ“Š X-Packæä¾›çš„å¢å¼ºåŠŸèƒ½**

```yaml
xpack.monitoring:
  # é›†ç¾¤çŠ¶æ€ç›‘æ§
  cluster_stats:
    enabled: true
    interval: "1m"                 # æ¯åˆ†é’Ÿæ”¶é›†é›†ç¾¤çŠ¶æ€
    
  # èŠ‚ç‚¹ç»Ÿè®¡ç›‘æ§  
  node_stats:
    enabled: true
    interval: "10s"               # æ¯10ç§’æ”¶é›†èŠ‚ç‚¹çŠ¶æ€
    
  # ç´¢å¼•ç»Ÿè®¡ç›‘æ§
  indices_stats:
    enabled: true
    interval: "5m"                # æ¯5åˆ†é’Ÿæ”¶é›†ç´¢å¼•ç»Ÿè®¡
```

**ğŸ” ç›‘æ§ç»´åº¦è¯´æ˜**

| **ç›‘æ§ç»´åº¦** | **åŒ…å«æŒ‡æ ‡** | **æ›´æ–°é¢‘ç‡** | **ç”¨é€”** |
|-------------|-------------|-------------|---------|
| **cluster_stats** | `é›†ç¾¤å¥åº·ã€èŠ‚ç‚¹æ•°é‡ã€åˆ†ç‰‡çŠ¶æ€` | `1-5åˆ†é’Ÿ` | `æ•´ä½“å¥åº·è¯„ä¼°` |
| **node_stats** | `CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ` | `10-30ç§’` | `èŠ‚ç‚¹æ€§èƒ½ç›‘æ§` |
| **indices_stats** | `ç´¢å¼•å¤§å°ã€æ–‡æ¡£æ•°é‡ã€æŸ¥è¯¢æ€§èƒ½` | `1-10åˆ†é’Ÿ` | `æ•°æ®å­˜å‚¨åˆ†æ` |

### 4.3 ç›‘æ§æ•°æ®å¯è§†åŒ–


**ğŸ“ˆ Kibanaé›†æˆé…ç½®**

```yaml
# kibana.yml - Kibanaç›‘æ§é…ç½®
monitoring.ui.container.elasticsearch.enabled: true

xpack.monitoring:
  kibana:
    collection:
      enabled: true               # å¯ç”¨Kibanaç›‘æ§æ•°æ®æ”¶é›†
      interval: 10000            # 10ç§’æ”¶é›†é—´éš”
```

---

## 5. ğŸ“Š æŒ‡æ ‡æ”¶é›†ä¸ç›‘æ§å‘¨æœŸ


### 5.1 metricsetsæŒ‡æ ‡é›†é…ç½®


**ğŸ“‹ æŒ‡æ ‡é›†ç±»å‹**

```yaml
metricbeat.modules:
- module: system
  metricsets:
    - cpu                        # CPUä½¿ç”¨ç‡
    - memory                     # å†…å­˜ä½¿ç”¨æƒ…å†µ  
    - disk                       # ç£ç›˜ç©ºé—´å’ŒIO
    - network                    # ç½‘ç»œæµé‡
    - process                    # è¿›ç¨‹çŠ¶æ€
  period: 10s                    # æ¯10ç§’æ”¶é›†ä¸€æ¬¡
  
- module: elasticsearch  
  metricsets:
    - node                       # èŠ‚ç‚¹çŠ¶æ€
    - cluster_stats              # é›†ç¾¤ç»Ÿè®¡
    - index                      # ç´¢å¼•æŒ‡æ ‡
    - shard                      # åˆ†ç‰‡çŠ¶æ€
  period: 10s
  hosts: ["localhost:9200"]
```

### 5.2 periodç›‘æ§å‘¨æœŸè®¾ç½®


**â° ç›‘æ§é¢‘ç‡ç­–ç•¥**

```yaml
# ä¸åŒç±»å‹æŒ‡æ ‡çš„ç›‘æ§å‘¨æœŸå»ºè®®
monitoring:
  periods:
    # ç³»ç»Ÿæ ¸å¿ƒæŒ‡æ ‡ - é«˜é¢‘ç›‘æ§
    system_core: "5s"            # CPUã€å†…å­˜ã€ç£ç›˜
    
    # ç½‘ç»œæŒ‡æ ‡ - ä¸­é¢‘ç›‘æ§  
    network: "10s"               # ç½‘ç»œæµé‡ã€è¿æ¥æ•°
    
    # ä¸šåŠ¡æŒ‡æ ‡ - ä½é¢‘ç›‘æ§
    business: "30s"              # åº”ç”¨å±‚é¢æŒ‡æ ‡
    
    # ç»Ÿè®¡æŒ‡æ ‡ - å®šæœŸç›‘æ§
    statistics: "300s"           # æ±‡æ€»ç»Ÿè®¡æ•°æ®
```

**ğŸ›ï¸ ç›‘æ§å‘¨æœŸæƒè¡¡**

| **ç›‘æ§å‘¨æœŸ** | **æ•°æ®ç²¾åº¦** | **å­˜å‚¨å¼€é”€** | **ç³»ç»Ÿå½±å“** | **é€‚ç”¨æŒ‡æ ‡** |
|-------------|-------------|-------------|-------------|-------------|
| **1-5ç§’** | `æé«˜` | `å¾ˆå¤§` | `æ˜æ˜¾` | `å…³é”®ç³»ç»ŸæŒ‡æ ‡` |
| **10-30ç§’** | `é«˜` | `ä¸­ç­‰` | `è¾ƒå°` | `å¸¸è§„æ€§èƒ½æŒ‡æ ‡` |
| **1-5åˆ†é’Ÿ** | `ä¸­ç­‰` | `è¾ƒå°` | `å¾ˆå°` | `è¶‹åŠ¿åˆ†ææŒ‡æ ‡` |
| **10åˆ†é’Ÿ+** | `ä½` | `æœ€å°` | `å‡ ä¹æ— ` | `æ±‡æ€»ç»Ÿè®¡æŒ‡æ ‡` |

### 5.3 æŒ‡æ ‡æ”¶é›†ä¼˜åŒ–


**âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®**

```yaml
# æ‰¹é‡ä¼˜åŒ–é…ç½®
monitoring:
  elasticsearch:
    # æ‰¹é‡å‘é€ä¼˜åŒ–
    bulk_max_size: 1000          # æ‰¹é‡æœ€å¤§æ¡æ•°
    flush_interval: "5s"         # å¼ºåˆ¶åˆ·æ–°é—´éš”
    compression_level: 1         # å‹ç¼©çº§åˆ« (0-9)
    
    # è¿æ¥æ± ä¼˜åŒ–
    max_retries: 3               # æœ€å¤§é‡è¯•æ¬¡æ•°
    backoff.init: "1s"          # åˆå§‹é€€é¿æ—¶é—´
    backoff.max: "60s"          # æœ€å¤§é€€é¿æ—¶é—´
    
    # è¶…æ—¶è®¾ç½®
    timeout: "30s"              # è¿æ¥è¶…æ—¶
    
# å†…å­˜ä½¿ç”¨ä¼˜åŒ–
queue.mem:
  events: 3200                  # å†…å­˜é˜Ÿåˆ—å¤§å°
  flush.min_events: 1600        # æœ€å°åˆ·æ–°äº‹ä»¶æ•°
```

---

## 6. ğŸ” ç›‘æ§è®¤è¯ä¸å®‰å…¨é…ç½®


### 6.1 username/passwordè®¤è¯é…ç½®


**ğŸ”‘ åŸºç¡€è®¤è¯è®¾ç½®**

```yaml
monitoring:
  elasticsearch:
    # åŸºç¡€è®¤è¯
    username: "filebeat_monitor"
    password: "secure_monitor_pass"
    
    # æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡
    username: "${MONITOR_USER:filebeat_monitor}"
    password: "${MONITOR_PASS}"
```

**ğŸ‘¤ ç›‘æ§ç”¨æˆ·æƒé™è®¾è®¡**

```json
// Elasticsearchä¸­åˆ›å»ºç›‘æ§ä¸“ç”¨ç”¨æˆ·
PUT /_security/user/filebeat_monitor
{
  "password": "secure_monitor_pass",
  "roles": ["remote_monitoring_collector", "remote_monitoring_agent"],
  "full_name": "Filebeat Monitoring User",
  "metadata": {
    "purpose": "filebeat monitoring data collection"
  }
}
```

### 6.2 SSLç›‘æ§åŠ å¯†ä¼ è¾“


**ğŸ›¡ï¸ SSL/TLSåŠ å¯†é…ç½®**

```yaml
monitoring:
  elasticsearch:
    hosts: ["https://es-monitor:9200"]
    
    # SSLåŸºç¡€é…ç½®
    ssl:
      enabled: true
      
      # è¯ä¹¦éªŒè¯
      verification_mode: "certificate"    # full|certificate|none
      
      # è¯ä¹¦æ–‡ä»¶
      certificate_authorities: ["/etc/filebeat/ca.crt"]
      certificate: "/etc/filebeat/client.crt"
      key: "/etc/filebeat/client.key"
      
      # é«˜çº§SSLè®¾ç½®
      cipher_suites: 
        - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
        - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
      min_version: "1.2"
      max_version: "1.3"
```

### 6.3 APIå¯†é’¥è®¤è¯


**ğŸ” ç°ä»£åŒ–è®¤è¯æ–¹å¼**

```yaml
monitoring:
  elasticsearch:
    # API Keyè®¤è¯ (æ¨è)
    api_key: "VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6ui2lp2axTNmsyakw9tvyuDw"
    
    # æˆ–ä½¿ç”¨Base64ç¼–ç çš„ID:API_KEY
    api_key: "${FILEBEAT_API_KEY}"
```

```bash
# ç”ŸæˆAPIå¯†é’¥
curl -X POST "localhost:9200/_security/api_key" \
  -H "Content-Type: application/json" \
  -u "elastic:password" \
  -d '{
    "name": "filebeat-monitoring-key",
    "role_descriptors": {
      "filebeat_monitor": {
        "cluster": ["monitor"],
        "index": [
          {
            "names": [".monitoring-*"],
            "privileges": ["create_index", "create", "index"]
          }
        ]
      }
    }
  }'
```

---

## 7. ğŸ› ï¸ å®æˆ˜é…ç½®ä¸æœ€ä½³å®è·µ


### 7.1 ç”Ÿäº§ç¯å¢ƒå®Œæ•´é…ç½®


**ğŸ­ ç”Ÿäº§çº§ç›‘æ§é…ç½®ç¤ºä¾‹**

```yaml
# filebeat.yml - ç”Ÿäº§ç¯å¢ƒç›‘æ§é…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/application/*.log
  fields:
    service: "web-api"
    environment: "production"

# ç›‘æ§é…ç½®
monitoring:
  enabled: true
  cluster_uuid: "${CLUSTER_UUID:prod-web-api-2024}"
  
  elasticsearch:
    hosts: ["es-monitor-01:9200", "es-monitor-02:9200"]
    
    # è®¤è¯å’Œå®‰å…¨
    api_key: "${MONITORING_API_KEY}"
    ssl:
      enabled: true
      verification_mode: "certificate"
      certificate_authorities: ["/etc/ssl/ca.crt"]
    
    # æ€§èƒ½ä¼˜åŒ–
    bulk_max_size: 1000
    flush_interval: "5s"
    compression_level: 3
    timeout: "30s"
    
    # ç´¢å¼•ç®¡ç†
    template.settings:
      index:
        number_of_shards: 1
        number_of_replicas: 1
        refresh_interval: "30s"
    
    # ç”Ÿå‘½å‘¨æœŸç®¡ç†
    ilm:
      enabled: true
      rollover_alias: "filebeat-monitoring"
      pattern: "000001"

# X-Packç›‘æ§
xpack.monitoring:
  enabled: true
  collection:
    enabled: true
    interval: "10s"
  
  exporters:
    elasticsearch:
      type: elasticsearch
      host: ["es-monitor-01:9200", "es-monitor-02:9200"]
```

### 7.2 ç›‘æ§å‘Šè­¦é…ç½®


**ğŸš¨ å‘Šè­¦è§„åˆ™è®¾ç½®**

```yaml
# é€šè¿‡Elasticsearch Watcherè®¾ç½®å‘Šè­¦
PUT _watcher/watch/filebeat_health_check
{
  "trigger": {
    "schedule": {
      "interval": "1m"
    }
  },
  "input": {
    "search": {
      "request": {
        "search_type": "query_then_fetch",
        "indices": [".monitoring-beats-*"],
        "body": {
          "query": {
            "bool": {
              "filter": [
                {"range": {"timestamp": {"gte": "now-2m"}}},
                {"term": {"type": "beats_stats"}}
              ]
            }
          },
          "aggs": {
            "hosts": {
              "terms": {
                "field": "beats_stats.beat.host",
                "size": 100
              }
            }
          }
        }
      }
    }
  },
  "condition": {
    "script": {
      "source": "ctx.payload.aggregations.hosts.buckets.size() < ctx.metadata.expected_hosts",
      "params": {
        "expected_hosts": 3
      }
    }
  },
  "actions": {
    "send_email": {
      "email": {
        "to": ["admin@company.com"],
        "subject": "FilebeatèŠ‚ç‚¹ç¦»çº¿å‘Šè­¦",
        "body": "æ£€æµ‹åˆ°FilebeatèŠ‚ç‚¹ç¦»çº¿ï¼Œå½“å‰æ´»è·ƒèŠ‚ç‚¹æ•°é‡ä¸è¶³"
      }
    }
  }
}
```

### 7.3 æ€§èƒ½è°ƒä¼˜å»ºè®®


**âš¡ ç›‘æ§æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**

| **ä¼˜åŒ–ç»´åº¦** | **é…ç½®å»ºè®®** | **æ•ˆæœ** |
|-------------|-------------|---------|
| **æ”¶é›†é¢‘ç‡** | `æ ¹æ®é‡è¦æ€§åˆ†çº§è®¾ç½®` | `å‡å°‘ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—` |
| **æ‰¹é‡å¤§å°** | `bulk_max_size: 1000-5000` | `æé«˜ä¼ è¾“æ•ˆç‡` |
| **å‹ç¼©ä¼ è¾“** | `compression_level: 1-6` | `å‡å°‘ç½‘ç»œå¸¦å®½` |
| **è¿æ¥å¤ç”¨** | `keep-aliveé…ç½®` | `å‡å°‘è¿æ¥å¼€é”€` |
| **ç´¢å¼•ä¼˜åŒ–** | `åˆç†è®¾ç½®åˆ†ç‰‡å’Œå‰¯æœ¬` | `ä¼˜åŒ–å­˜å‚¨æ€§èƒ½` |

### 7.4 æ•…éšœæ’æŸ¥æŒ‡å—


**ğŸ”§ å¸¸è§é—®é¢˜è¯Šæ–­**

```bash
# 1. æ£€æŸ¥ç›‘æ§è¿æ¥çŠ¶æ€
curl -X GET "localhost:9200/_cat/indices/.monitoring-*?v&s=index"

# 2. æŸ¥çœ‹Filebeatç›‘æ§æ—¥å¿—
tail -f /var/log/filebeat/filebeat.log | grep -i monitoring

# 3. æ£€æŸ¥ç›‘æ§ç”¨æˆ·æƒé™
curl -X GET "localhost:9200/_security/user/filebeat_monitor"

# 4. éªŒè¯SSLè¯ä¹¦
openssl s_client -connect es-monitor:9200 -servername es-monitor

# 5. æµ‹è¯•APIå¯†é’¥
curl -X GET "localhost:9200/_security/_authenticate" \
  -H "Authorization: ApiKey VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6ui2lp2axTNmsyakw9tvyuDw"
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é›†ç¾¤ç›‘æ§ï¼šå®æ—¶è¿½è¸ªFilebeaté›†ç¾¤çš„å¥åº·çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
ğŸ”¸ monitoringé…ç½®ï¼šå¯ç”¨å’Œé…ç½®åŸºç¡€ç›‘æ§åŠŸèƒ½çš„æ ¸å¿ƒè®¾ç½®
ğŸ”¸ cluster_uuidï¼šé›†ç¾¤çš„å”¯ä¸€æ ‡è¯†ï¼Œç¡®ä¿ç›‘æ§æ•°æ®å‡†ç¡®å½’ç±»
ğŸ”¸ xpackç›‘æ§ï¼šElasticsearchå®˜æ–¹æä¾›çš„é«˜çº§ç›‘æ§æ‰©å±•åŠŸèƒ½
ğŸ”¸ æŒ‡æ ‡æ”¶é›†ï¼šé€šè¿‡metricsetså®šä¹‰æ”¶é›†å“ªäº›æŒ‡æ ‡æ•°æ®
ğŸ”¸ ç›‘æ§å‘¨æœŸï¼šperiodå‚æ•°æ§åˆ¶æ•°æ®æ”¶é›†çš„é¢‘ç‡å’Œç²¾åº¦
ğŸ”¸ è®¤è¯å®‰å…¨ï¼šusername/passwordå’ŒSSLç¡®ä¿ç›‘æ§æ•°æ®ä¼ è¾“å®‰å…¨
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§çš„æœ¬è´¨ç›®çš„**
```
ç›‘æ§ä¸æ˜¯ä¸ºäº†ç›‘æ§è€Œç›‘æ§ï¼Œè€Œæ˜¯ä¸ºäº†ï¼š
â€¢ æå‰å‘ç°é—®é¢˜ï¼Œé¿å…æ•…éšœæ‰©å¤§
â€¢ äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ï¼Œä¼˜åŒ–æ€§èƒ½
â€¢ ä¸ºå®¹é‡è§„åˆ’æä¾›æ•°æ®æ”¯æ’‘
â€¢ æ»¡è¶³è¿ç»´ç®¡ç†å’Œåˆè§„è¦æ±‚
```

**ğŸ”¹ é…ç½®ä¼˜å…ˆçº§**
```
1. å®‰å…¨æ€§ï¼šè®¤è¯å’ŒåŠ å¯†ä¼ è¾“å¿…é¡»é…ç½®
2. å¯é æ€§ï¼šé›†ç¾¤æ ‡è¯†å’Œæ•°æ®å­˜å‚¨è¦ç¨³å®š
3. æ€§èƒ½ï¼šç›‘æ§é¢‘ç‡å’Œæ‰¹é‡å¤§å°è¦å¹³è¡¡
4. å¯ç»´æŠ¤æ€§ï¼šé…ç½®è¦æ¸…æ™°ã€å¯è¯»ã€å¯æ‰©å±•
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹**
```
â€¢ ç›‘æ§æ•°æ®å•ç‹¬å­˜å‚¨ï¼Œé¿å…å½±å“ä¸šåŠ¡é›†ç¾¤
â€¢ åˆç†è®¾ç½®ç›‘æ§é¢‘ç‡ï¼Œé¿å…è¿‡åº¦æ¶ˆè€—èµ„æº
â€¢ å»ºç«‹ç›‘æ§å‘Šè­¦æœºåˆ¶ï¼ŒåŠæ—¶å“åº”å¼‚å¸¸
â€¢ å®šæœŸæ¸…ç†å†å²ç›‘æ§æ•°æ®ï¼Œæ§åˆ¶å­˜å‚¨æˆæœ¬
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†å¹³å°**ï¼šç›‘æ§è®¢å•å¤„ç†æ—¥å¿—çš„æ”¶é›†çŠ¶æ€ï¼Œç¡®ä¿äº¤æ˜“æ•°æ®ä¸ä¸¢å¤±
- **é‡‘èç³»ç»Ÿ**ï¼šå®æ—¶ç›‘æ§æ”¯ä»˜æ—¥å¿—ä¼ è¾“ï¼Œæ»¡è¶³åˆè§„è¦æ±‚
- **æ¸¸æˆä¸šåŠ¡**ï¼šç›‘æ§ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ”¶é›†ï¼Œæ”¯æŒæ•°æ®åˆ†æå†³ç­–
- **è¿ç»´ç®¡ç†**ï¼šç»Ÿä¸€ç›‘æ§æ‰€æœ‰åº”ç”¨çš„æ—¥å¿—æ”¶é›†çŠ¶æ€ï¼Œæé«˜è¿ç»´æ•ˆç‡

**ğŸ¯ æŠ€èƒ½å‘å±•è·¯å¾„**
- **åŸºç¡€åº”ç”¨**ï¼šæŒæ¡åŸºæœ¬ç›‘æ§é…ç½®å’ŒçŠ¶æ€æŸ¥çœ‹
- **è¿›é˜¶ä¼˜åŒ–**ï¼šå­¦ä¼šæ€§èƒ½è°ƒä¼˜å’Œæ•…éšœæ’æŸ¥
- **æ¶æ„è®¾è®¡**ï¼šè®¾è®¡ä¼ä¸šçº§ç›‘æ§ä½“ç³»å’Œå‘Šè­¦æœºåˆ¶
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šç»“åˆè„šæœ¬å’Œå·¥å…·å®ç°ç›‘æ§è‡ªåŠ¨åŒ–

### 8.4 å­¦ä¹ æ£€æŸ¥ç‚¹


**âœ… åŸºç¡€æŒæ¡ç¡®è®¤**
```
â–¡ èƒ½å¤Ÿé…ç½®åŸºæœ¬çš„monitoringç›‘æ§åŠŸèƒ½
â–¡ ç†è§£cluster_uuidçš„ä½œç”¨å’Œè®¾ç½®æ–¹æ³•
â–¡ æŒæ¡ç”¨æˆ·è®¤è¯å’ŒSSLåŠ å¯†é…ç½®
â–¡ äº†è§£ä¸åŒç›‘æ§çº§åˆ«å’Œå‘¨æœŸçš„é€‰æ‹©
```

**ğŸš€ è¿›é˜¶èƒ½åŠ›ç›®æ ‡**
```
â–¡ èƒ½å¤Ÿè®¾è®¡ç”Ÿäº§çº§ç›‘æ§é…ç½®æ–¹æ¡ˆ
â–¡ ç†Ÿç»ƒè¿›è¡Œç›‘æ§æ€§èƒ½è°ƒä¼˜
â–¡ å…·å¤‡ç›‘æ§æ•…éšœå¿«é€Ÿæ’æŸ¥èƒ½åŠ›
â–¡ èƒ½å¤Ÿå»ºç«‹å®Œæ•´çš„ç›‘æ§å‘Šè­¦ä½“ç³»
```

**æ ¸å¿ƒè®°å¿†**ï¼š
```
ç›‘æ§å¦‚ä½“æ£€ï¼Œå¥åº·è¦å¸¸çœ‹
UUIDä½œé—¨ç‰Œï¼Œé›†ç¾¤ä¸ä¸²é—¨
è®¤è¯ä¿å®‰å…¨ï¼ŒåŠ å¯†é˜²æ³„éœ²  
å‘¨æœŸè¦åˆç†ï¼Œæ€§èƒ½ä¸ç²¾åº¦
å‘Šè­¦åŠå“åº”ï¼Œæ•…éšœæ—©å‘ç°
```