---
title: 1ã€å®‰è£…éƒ¨ç½²æ–¹å¼
---
## ðŸ“š ç›®å½•

1. [Filebeatæ¦‚è¿°ä¸Žå®‰è£…å‡†å¤‡](#1-filebeatæ¦‚è¿°ä¸Žå®‰è£…å‡†å¤‡)
2. [ç³»ç»ŸçŽ¯å¢ƒè¦æ±‚](#2-ç³»ç»ŸçŽ¯å¢ƒè¦æ±‚)
3. [Linuxç³»ç»Ÿå®‰è£…éƒ¨ç½²](#3-linuxç³»ç»Ÿå®‰è£…éƒ¨ç½²)
4. [Windowsç³»ç»Ÿå®‰è£…éƒ¨ç½²](#4-windowsç³»ç»Ÿå®‰è£…éƒ¨ç½²)
5. [macOSç³»ç»Ÿå®‰è£…éƒ¨ç½²](#5-macosç³»ç»Ÿå®‰è£…éƒ¨ç½²)
6. [Dockerå®¹å™¨åŒ–éƒ¨ç½²](#6-dockerå®¹å™¨åŒ–éƒ¨ç½²)
7. [Kubernetesé›†ç¾¤éƒ¨ç½²](#7-kubernetesé›†ç¾¤éƒ¨ç½²)
8. [ç›®å½•ç»“æž„ä¸Žæƒé™é…ç½®](#8-ç›®å½•ç»“æž„ä¸Žæƒé™é…ç½®)
9. [å®‰è£…éªŒè¯ä¸Žæ•…éšœæŽ’æŸ¥](#9-å®‰è£…éªŒè¯ä¸Žæ•…éšœæŽ’æŸ¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ Filebeatæ¦‚è¿°ä¸Žå®‰è£…å‡†å¤‡


### 1.1 ä»€ä¹ˆæ˜¯Filebeat

**ç®€å•ç†è§£**ï¼šFilebeatå°±åƒæ˜¯ä¸€ä¸ª==æ–‡ä»¶ç›‘æŽ§åŠ©æ‰‹==ï¼Œä¸“é—¨è´Ÿè´£ç›‘æŽ§æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ï¼Œå½“æ–‡ä»¶æœ‰æ–°å†…å®¹æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æŠŠè¿™äº›å†…å®¹å‘é€åˆ°Elasticsearchæˆ–å…¶ä»–ç›®æ ‡ç³»ç»Ÿã€‚

```
ä¼ ç»Ÿæ–¹å¼æ”¶é›†æ—¥å¿—ï¼š
å¼€å‘äººå‘˜ â†’ æ‰‹åŠ¨æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ â†’ å¤åˆ¶ç²˜è´´ â†’ åˆ†æž

ä½¿ç”¨Filebeatï¼š
åº”ç”¨ç¨‹åº â†’ å†™å…¥æ—¥å¿—æ–‡ä»¶ â†’ Filebeatè‡ªåŠ¨ç›‘æŽ§ â†’ è‡ªåŠ¨å‘é€åˆ°ES â†’ å¯è§†åŒ–åˆ†æž
```

**ðŸ”¸ æ ¸å¿ƒä½œç”¨**
- **æ–‡ä»¶ç›‘æŽ§**ï¼šå®žæ—¶ç›‘æŽ§æ—¥å¿—æ–‡ä»¶å˜åŒ–
- **æ•°æ®ä¼ è¾“**ï¼šå®‰å…¨å¯é åœ°å°†æ•°æ®å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿ  
- **è½»é‡çº§**ï¼šå ç”¨ç³»ç»Ÿèµ„æºå¾ˆå°‘ï¼Œä¸å½±å“ä¸šåŠ¡è¿è¡Œ
- **å®¹é”™æ€§**ï¼šæ–­ç½‘é‡è¿žåŽèƒ½ç»§ç»­ä¼ è¾“ï¼Œä¸ä¸¢å¤±æ•°æ®

### 1.2 å®‰è£…å‰çš„å‡†å¤‡å·¥ä½œ


**ðŸ“‹ å‡†å¤‡æ¸…å•**
- [ ] ç¡®è®¤ç›®æ ‡ç³»ç»Ÿï¼ˆLinux/Windows/Macï¼‰
- [ ] æ£€æŸ¥ç³»ç»Ÿç‰ˆæœ¬å’Œæž¶æž„ï¼ˆ64ä½/32ä½ï¼‰
- [ ] å‡†å¤‡ç®¡ç†å‘˜æƒé™è´¦å·
- [ ] ç¡®è®¤ç½‘ç»œè¿žæŽ¥æ­£å¸¸
- [ ] äº†è§£è¦ç›‘æŽ§çš„æ—¥å¿—æ–‡ä»¶ä½ç½®

**ðŸŽ¯ é€‰æ‹©åˆé€‚çš„å®‰è£…æ–¹å¼**

| ä½¿ç”¨åœºæ™¯ | **æŽ¨èå®‰è£…æ–¹å¼** | **é€‚ç”¨åŽŸå› ** |
|---------|----------------|-------------|
| `ç”Ÿäº§çŽ¯å¢ƒæœåŠ¡å™¨` | YUM/APTåŒ…ç®¡ç†å™¨ | æ–¹ä¾¿ç®¡ç†å’Œæ›´æ–° |
| `å¼€å‘æµ‹è¯•çŽ¯å¢ƒ` | äºŒè¿›åˆ¶åŒ… | å¿«é€Ÿéƒ¨ç½²ï¼Œçµæ´»é…ç½® |
| `å®¹å™¨åŒ–çŽ¯å¢ƒ` | Dockeré•œåƒ | ä¸Žå®¹å™¨æŠ€æœ¯æ ˆä¸€è‡´ |
| `å¾®æœåŠ¡æž¶æž„` | Kubernetes | ç»Ÿä¸€ç®¡ç†ï¼Œè‡ªåŠ¨æ‰©å±• |

---

## 2. ðŸ–¥ï¸ ç³»ç»ŸçŽ¯å¢ƒè¦æ±‚


### 2.1 ç¡¬ä»¶èµ„æºè¦æ±‚


**âš¡ æœ€ä½Žé…ç½®è¦æ±‚**
```
CPUï¼š1æ ¸å¿ƒï¼ˆå»ºè®®2æ ¸å¿ƒä»¥ä¸Šï¼‰
å†…å­˜ï¼š512MBï¼ˆå»ºè®®1GBä»¥ä¸Šï¼‰
ç£ç›˜ï¼š50MBå®‰è£…ç©ºé—´ + æ—¥å¿—ç¼“å­˜ç©ºé—´
ç½‘ç»œï¼šç¨³å®šçš„ç½‘ç»œè¿žæŽ¥
```

**ðŸ’¡ èµ„æºä½¿ç”¨è¯´æ˜Ž**
- **CPUä½¿ç”¨çŽ‡**ï¼šæ­£å¸¸æƒ…å†µä¸‹ä¸è¶…è¿‡5%
- **å†…å­˜å ç”¨**ï¼šé€šå¸¸åœ¨50-200MBä¹‹é—´
- **ç£ç›˜IO**ï¼šä¸»è¦æ˜¯è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œå†™å…¥è¾ƒå°‘
- **ç½‘ç»œå¸¦å®½**ï¼šå–å†³äºŽæ—¥å¿—äº§ç”Ÿé€Ÿåº¦

### 2.2 æ“ä½œç³»ç»Ÿæ”¯æŒ


**ðŸ”¸ Linuxå‘è¡Œç‰ˆæ”¯æŒ**
```
âœ… CentOS/RHEL: 7.x, 8.x, 9.x
âœ… Ubuntu: 18.04 LTS, 20.04 LTS, 22.04 LTS
âœ… Debian: 9, 10, 11
âœ… Amazon Linux: 2
âœ… SUSE Linux: 12, 15
```

**ðŸ”¸ Windowsç‰ˆæœ¬æ”¯æŒ**
```
âœ… Windows Server: 2016, 2019, 2022
âœ… Windows 10/11 (64ä½)
âœ… éœ€è¦.NET Framework 4.6æˆ–æ›´é«˜ç‰ˆæœ¬
```

**ðŸ”¸ macOSç‰ˆæœ¬æ”¯æŒ**
```
âœ… macOS 10.14 (Mojave) æˆ–æ›´é«˜ç‰ˆæœ¬
âœ… æ”¯æŒIntelå’ŒApple Silicon (M1/M2)èŠ¯ç‰‡
```

### 2.3 è½¯ä»¶ä¾èµ–è¦æ±‚


**ðŸ“¦ å¿…éœ€ç»„ä»¶**
- **æ— é¢å¤–ä¾èµ–**ï¼šFilebeatæ˜¯ç‹¬ç«‹çš„äºŒè¿›åˆ¶ç¨‹åº
- **ç³»ç»Ÿæƒé™**ï¼šéœ€è¦è¯»å–æ—¥å¿—æ–‡ä»¶çš„æƒé™
- **ç½‘ç»œè®¿é—®**ï¼šèƒ½å¤Ÿè¿žæŽ¥åˆ°Elasticsearchæˆ–å…¶ä»–è¾“å‡ºç›®æ ‡

---

## 3. ðŸ§ Linuxç³»ç»Ÿå®‰è£…éƒ¨ç½²


### 3.1 ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…ï¼ˆæŽ¨èï¼‰


**ðŸ”¸ CentOS/RHELç³»ç»Ÿï¼ˆYUMï¼‰**

**ç¬¬ä¸€æ­¥ï¼šæ·»åŠ Elasticä»“åº“**
```bash
# å¯¼å…¥GPGå¯†é’¥
sudo rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch

# åˆ›å»ºä»“åº“é…ç½®æ–‡ä»¶
sudo tee /etc/yum.repos.d/elastic.repo > /dev/null <<EOF
[elastic-8.x]
name=Elastic repository for 8.x packages
baseurl=https://artifacts.elastic.co/packages/8.x/yum
gpgcheck=1
gpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
EOF
```

**ç¬¬äºŒæ­¥ï¼šå®‰è£…Filebeat**
```bash
# æ›´æ–°åŒ…ç´¢å¼•
sudo yum update

# å®‰è£…Filebeat
sudo yum install filebeat

# å¯ç”¨å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable filebeat
```

**ðŸ”¸ Ubuntu/Debianç³»ç»Ÿï¼ˆAPTï¼‰**

```bash
# å®‰è£…ä¾èµ–
sudo apt-get update
sudo apt-get install wget curl gnupg

# æ·»åŠ Elastic GPGå¯†é’¥
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -

# æ·»åŠ ä»“åº“
echo "deb https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list

# æ›´æ–°å¹¶å®‰è£…
sudo apt-get update
sudo apt-get install filebeat

# å¯ç”¨æœåŠ¡
sudo systemctl enable filebeat
```

### 3.2 ä½¿ç”¨äºŒè¿›åˆ¶åŒ…å®‰è£…


**ðŸ“¥ ä¸‹è½½ä¸Žå®‰è£…æ­¥éª¤**

```bash
# ä¸‹è½½FilebeatäºŒè¿›åˆ¶åŒ…ï¼ˆä»¥8.11.0ç‰ˆæœ¬ä¸ºä¾‹ï¼‰
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.11.0-linux-x86_64.tar.gz

# è§£åŽ‹æ–‡ä»¶
tar -xzf filebeat-8.11.0-linux-x86_64.tar.gz

# ç§»åŠ¨åˆ°æ ‡å‡†ç›®å½•
sudo mv filebeat-8.11.0-linux-x86_64 /opt/filebeat

# åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼ˆæ–¹ä¾¿ä½¿ç”¨ï¼‰
sudo ln -s /opt/filebeat/filebeat /usr/local/bin/filebeat

# åˆ›å»ºé…ç½®ç›®å½•
sudo mkdir -p /etc/filebeat
sudo cp /opt/filebeat/filebeat.yml /etc/filebeat/

# è®¾ç½®æƒé™
sudo chown -R root:root /opt/filebeat
sudo chmod 755 /opt/filebeat/filebeat
```

**ðŸ”§ åˆ›å»ºç³»ç»ŸæœåŠ¡**

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/filebeat.service > /dev/null <<EOF
[Unit]
Description=Filebeat sends log files to Logstash or directly to Elasticsearch.
Documentation=https://www.elastic.co/beats/filebeat
Wants=network-online.target
After=network-online.target

[Service]
Type=simple
User=root
Group=root
ExecStart=/usr/local/bin/filebeat -c /etc/filebeat/filebeat.yml
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

# é‡æ–°åŠ è½½systemd
sudo systemctl daemon-reload
sudo systemctl enable filebeat
```

### 3.3 å®‰è£…éªŒè¯


```bash
# æ£€æŸ¥ç‰ˆæœ¬
filebeat version

# æµ‹è¯•é…ç½®æ–‡ä»¶
sudo filebeat test config -c /etc/filebeat/filebeat.yml

# å¯åŠ¨æœåŠ¡
sudo systemctl start filebeat

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status filebeat

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u filebeat -f
```

---

## 4. ðŸªŸ Windowsç³»ç»Ÿå®‰è£…éƒ¨ç½²


### 4.1 ä½¿ç”¨å®‰è£…åŒ…å®‰è£…ï¼ˆæŽ¨èï¼‰


**ðŸ“¥ ä¸‹è½½ä¸Žå®‰è£…æ­¥éª¤**

1. **ä¸‹è½½å®‰è£…åŒ…**
   - è®¿é—® https://www.elastic.co/downloads/beats/filebeat
   - é€‰æ‹©Windowsç‰ˆæœ¬ä¸‹è½½
   - ä¸‹è½½`.msi`å®‰è£…ç¨‹åº

2. **è¿è¡Œå®‰è£…ç¨‹åº**
   ```
   å®‰è£…å‘å¯¼æ­¥éª¤ï¼š
   ðŸ“ æ¬¢è¿Žç•Œé¢ â†’ ä¸‹ä¸€æ­¥
   ðŸ“ è®¸å¯åè®® â†’ åŒæ„ â†’ ä¸‹ä¸€æ­¥  
   ðŸ“ å®‰è£…è·¯å¾„ â†’ é€‰æ‹©è·¯å¾„ï¼ˆé»˜è®¤C:\Program Files\Filebeatï¼‰
   ðŸ“ æœåŠ¡é…ç½® â†’ å‹¾é€‰"ä½œä¸ºWindowsæœåŠ¡å®‰è£…"
   ðŸ“ å®Œæˆå®‰è£…
   ```

### 4.2 ä½¿ç”¨ZIPåŒ…å®‰è£…


**ðŸ“¦ æ‰‹åŠ¨å®‰è£…æ­¥éª¤**

```powershell
# 1. ä¸‹è½½ZIPåŒ…
# ä¸‹è½½ filebeat-8.11.0-windows-x86_64.zip

# 2. è§£åŽ‹åˆ°æŒ‡å®šç›®å½•
# è§£åŽ‹åˆ° C:\filebeat

# 3. ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShell
# è¿›å…¥Filebeatç›®å½•
cd C:\filebeat

# 4. å®‰è£…ä¸ºWindowsæœåŠ¡
.\install-service-filebeat.ps1

# 5. å¯åŠ¨æœåŠ¡
Start-Service filebeat
```

### 4.3 PowerShellç®¡ç†å‘½ä»¤


```powershell
# æœåŠ¡ç®¡ç†å‘½ä»¤
Get-Service filebeat                    # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
Start-Service filebeat                  # å¯åŠ¨æœåŠ¡  
Stop-Service filebeat                   # åœæ­¢æœåŠ¡
Restart-Service filebeat               # é‡å¯æœåŠ¡

# é…ç½®æµ‹è¯•
.\filebeat.exe test config             # æµ‹è¯•é…ç½®æ–‡ä»¶

# æŸ¥çœ‹ç‰ˆæœ¬
.\filebeat.exe version                 # æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯

# æŸ¥çœ‹æ—¥å¿—
Get-Content C:\filebeat\logs\filebeat  # æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
```

---

## 5. ðŸŽ macOSç³»ç»Ÿå®‰è£…éƒ¨ç½²


### 5.1 ä½¿ç”¨Homebrewå®‰è£…ï¼ˆæŽ¨èï¼‰


**ðŸº Homebrewå®‰è£…æ–¹å¼**

```bash
# æ›´æ–°Homebrew
brew update

# å®‰è£…Filebeat
brew install elastic/tap/filebeat-full

# æŸ¥çœ‹å®‰è£…ä¿¡æ¯
brew info filebeat-full

# å¯åŠ¨æœåŠ¡
brew services start elastic/tap/filebeat-full
```

### 5.2 ä½¿ç”¨äºŒè¿›åˆ¶åŒ…å®‰è£…


```bash
# ä¸‹è½½macOSç‰ˆæœ¬
curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.11.0-darwin-x86_64.tar.gz

# IntelèŠ¯ç‰‡Mac
tar -xzf filebeat-8.11.0-darwin-x86_64.tar.gz

# Apple Silicon (M1/M2) Mac  
# curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.11.0-darwin-aarch64.tar.gz
# tar -xzf filebeat-8.11.0-darwin-aarch64.tar.gz

# ç§»åŠ¨åˆ°Applicationsç›®å½•
sudo mv filebeat-8.11.0-darwin-x86_64 /Applications/filebeat

# åˆ›å»ºè½¯é“¾æŽ¥
sudo ln -s /Applications/filebeat/filebeat /usr/local/bin/filebeat

# æµ‹è¯•å®‰è£…
filebeat version
```

### 5.3 åˆ›å»ºå¯åŠ¨æœåŠ¡


```bash
# åˆ›å»ºplistæ–‡ä»¶
sudo tee /Library/LaunchDaemons/co.elastic.filebeat.plist > /dev/null <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>co.elastic.filebeat</string>
    <key>ProgramArguments</key>
    <array>
        <string>/usr/local/bin/filebeat</string>
        <string>-c</string>
        <string>/Applications/filebeat/filebeat.yml</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
</dict>
</plist>
EOF

# åŠ è½½æœåŠ¡
sudo launchctl load /Library/LaunchDaemons/co.elastic.filebeat.plist

# å¯åŠ¨æœåŠ¡
sudo launchctl start co.elastic.filebeat
```

---

## 6. ðŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²


### 6.1 åŸºç¡€Dockeréƒ¨ç½²


**ðŸ”¸ å¿«é€Ÿå¯åŠ¨æ–¹å¼**

```bash
# æ‹‰å–å®˜æ–¹é•œåƒ
docker pull elastic/filebeat:8.11.0

# åˆ›å»ºé…ç½®ç›®å½•
mkdir -p ~/filebeat/config
mkdir -p ~/filebeat/data
mkdir -p ~/filebeat/logs

# åˆ›å»ºåŸºç¡€é…ç½®æ–‡ä»¶
cat > ~/filebeat/config/filebeat.yml <<EOF
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/*.log

output.console:
  enabled: true

logging.level: info
EOF

# å¯åŠ¨å®¹å™¨
docker run -d \
  --name filebeat \
  --user=root \
  --volume="~/filebeat/config/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro" \
  --volume="/var/log:/var/log:ro" \
  --volume="~/filebeat/data:/usr/share/filebeat/data" \
  elastic/filebeat:8.11.0
```

### 6.2 Docker Composeéƒ¨ç½²


**ðŸ“„ åˆ›å»ºdocker-compose.yml**

```yaml
version: '3.8'

services:
  filebeat:
    image: elastic/filebeat:8.11.0
    container_name: filebeat
    user: root
    restart: unless-stopped
    
    volumes:
      # é…ç½®æ–‡ä»¶æŒ‚è½½
      - ./config/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro
      # æ—¥å¿—ç›®å½•æŒ‚è½½ï¼ˆæ ¹æ®å®žé™…æƒ…å†µè°ƒæ•´ï¼‰
      - /var/log:/var/log:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      # æ•°æ®æŒä¹…åŒ–
      - ./data:/usr/share/filebeat/data
      - ./logs:/usr/share/filebeat/logs
    
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
      
    networks:
      - elastic
    
    depends_on:
      - elasticsearch

  elasticsearch:
    image: elasticsearch:8.11.0
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    networks:
      - elastic

networks:
  elastic:
    driver: bridge
```

**ðŸš€ å¯åŠ¨æœåŠ¡**

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹Filebeatæ—¥å¿—
docker-compose logs -f filebeat

# åœæ­¢æœåŠ¡
docker-compose down
```

### 6.3 Dockerå®¹å™¨é…ç½®è¯´æ˜Ž


**ðŸ”§ é‡è¦é…ç½®å‚æ•°**

| é…ç½®é¡¹ | **è¯´æ˜Ž** | **æ³¨æ„äº‹é¡¹** |
|-------|---------|-------------|
| `--user=root` | ä»¥rootç”¨æˆ·è¿è¡Œ | å¿…éœ€ï¼Œå¦åˆ™æ— æ³•è¯»å–å®¿ä¸»æœºæ—¥å¿— |
| `volumesæŒ‚è½½` | æŒ‚è½½é…ç½®å’Œæ—¥å¿—ç›®å½• | è·¯å¾„è¦æ ¹æ®å®žé™…æƒ…å†µè°ƒæ•´ |
| `restartç­–ç•¥` | å®¹å™¨é‡å¯ç­–ç•¥ | æŽ¨èä½¿ç”¨unless-stopped |
| `ç½‘ç»œé…ç½®` | å®¹å™¨ç½‘ç»œè®¾ç½® | ç¡®ä¿èƒ½è¿žæŽ¥åˆ°ESé›†ç¾¤ |

---

## 7. â˜¸ï¸ Kubernetesé›†ç¾¤éƒ¨ç½²


### 7.1 ä½¿ç”¨DaemonSetéƒ¨ç½²


**ðŸ“‹ DaemonSeté…ç½®æ–‡ä»¶**

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: filebeat
  namespace: elastic-system
  labels:
    app: filebeat
spec:
  selector:
    matchLabels:
      app: filebeat
  template:
    metadata:
      labels:
        app: filebeat
    spec:
      serviceAccountName: filebeat
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
      
      containers:
      - name: filebeat
        image: elastic/filebeat:8.11.0
        args: [
          "-c", "/etc/filebeat.yml",
          "-e"
        ]
        
        env:
        - name: ELASTICSEARCH_HOST
          value: "elasticsearch.elastic-system.svc.cluster.local"
        - name: ELASTICSEARCH_PORT
          value: "9200"
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
              
        securityContext:
          runAsUser: 0
          privileged: true
          
        resources:
          limits:
            memory: 200Mi
            cpu: 100m
          requests:
            memory: 100Mi
            cpu: 50m
            
        volumeMounts:
        - name: config
          mountPath: /etc/filebeat.yml
          readOnly: true
          subPath: filebeat.yml
        - name: data
          mountPath: /usr/share/filebeat/data
        - name: varlog
          mountPath: /var/log
          readOnly: true
        - name: varlibdockercontainers
          mountPath: /var/lib/docker/containers
          readOnly: true
          
      volumes:
      - name: config
        configMap:
          defaultMode: 0600
          name: filebeat-config
      - name: varlog
        hostPath:
          path: /var/log
      - name: varlibdockercontainers
        hostPath:
          path: /var/lib/docker/containers
      - name: data
        hostPath:
          path: /var/lib/filebeat-data
          type: DirectoryOrCreate
```

### 7.2 ConfigMapé…ç½®


```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: filebeat-config
  namespace: elastic-system
data:
  filebeat.yml: |-
    filebeat.inputs:
    - type: container
      paths:
        - /var/log/containers/*.log
      processors:
        - add_kubernetes_metadata:
            host: ${NODE_NAME}
            matchers:
            - logs_path:
                logs_path: "/var/log/containers/"

    output.elasticsearch:
      hosts: ['${ELASTICSEARCH_HOST:elasticsearch}:${ELASTICSEARCH_PORT:9200}']
      
    setup.template.settings:
      index.number_of_shards: 1
      index.codec: best_compression
      
    logging.level: info
```

### 7.3 RBACæƒé™é…ç½®


```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: filebeat
  namespace: elastic-system

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: filebeat
rules:
- apiGroups: [""]
  resources:
  - nodes
  - namespaces
  - events
  - pods
  verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: filebeat
subjects:
- kind: ServiceAccount
  name: filebeat
  namespace: elastic-system
roleRef:
  kind: ClusterRole
  name: filebeat
  apiGroup: rbac.authorization.k8s.io
```

**ðŸš€ éƒ¨ç½²å‘½ä»¤**

```bash
# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace elastic-system

# åº”ç”¨é…ç½®
kubectl apply -f filebeat-rbac.yaml
kubectl apply -f filebeat-configmap.yaml  
kubectl apply -f filebeat-daemonset.yaml

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
kubectl get pods -n elastic-system
kubectl get daemonset -n elastic-system

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -n elastic-system -l app=filebeat
```

---

## 8. ðŸ“ ç›®å½•ç»“æž„ä¸Žæƒé™é…ç½®


### 8.1 æ ‡å‡†ç›®å½•ç»“æž„


**ðŸ”¸ Linuxç³»ç»Ÿç›®å½•ç»“æž„**

```
Filebeatå®‰è£…ç›®å½•ç»“æž„ï¼š
/opt/filebeat/                          # ä¸»ç¨‹åºç›®å½•
â”œâ”€â”€ filebeat                           # ä¸»æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ fields.yml                         # å­—æ®µå®šä¹‰æ–‡ä»¶
â”œâ”€â”€ LICENSE.txt                        # è®¸å¯è¯æ–‡ä»¶
â”œâ”€â”€ NOTICE.txt                         # é€šçŸ¥æ–‡ä»¶
â”œâ”€â”€ README.md                          # è¯´æ˜Žæ–‡æ¡£
â””â”€â”€ modules.d/                         # æ¨¡å—é…ç½®ç›®å½•
    â”œâ”€â”€ apache.yml.disabled
    â”œâ”€â”€ nginx.yml.disabled
    â””â”€â”€ system.yml.disabled

é…ç½®æ–‡ä»¶ç›®å½•ï¼š
/etc/filebeat/                         # é…ç½®ç›®å½•
â”œâ”€â”€ filebeat.yml                       # ä¸»é…ç½®æ–‡ä»¶
â””â”€â”€ modules.d/                         # æ¨¡å—é…ç½®ç›®å½•

æ•°æ®ç›®å½•ï¼š
/var/lib/filebeat/                     # æ•°æ®å­˜å‚¨ç›®å½•
â”œâ”€â”€ meta.json                          # å…ƒæ•°æ®æ–‡ä»¶
â”œâ”€â”€ registry/                          # æ³¨å†Œè¡¨ç›®å½•
â””â”€â”€ data/                             # æ•°æ®æ–‡ä»¶ç›®å½•

æ—¥å¿—ç›®å½•ï¼š
/var/log/filebeat/                     # æ—¥å¿—ç›®å½•
â””â”€â”€ filebeat                          # æ—¥å¿—æ–‡ä»¶
```

**ðŸ”¸ Windowsç³»ç»Ÿç›®å½•ç»“æž„**

```
C:\Program Files\Filebeat\             # å®‰è£…ç›®å½•
â”œâ”€â”€ filebeat.exe                       # ä¸»ç¨‹åº
â”œâ”€â”€ filebeat.yml                       # é…ç½®æ–‡ä»¶
â”œâ”€â”€ install-service-filebeat.ps1       # æœåŠ¡å®‰è£…è„šæœ¬
â”œâ”€â”€ uninstall-service-filebeat.ps1     # æœåŠ¡å¸è½½è„šæœ¬
â”œâ”€â”€ fields.yml                         # å­—æ®µå®šä¹‰
â”œâ”€â”€ modules.d\                         # æ¨¡å—ç›®å½•
â””â”€â”€ data\                             # æ•°æ®ç›®å½•

æ—¥å¿—ç›®å½•ï¼š
C:\ProgramData\filebeat\logs\          # æ—¥å¿—ç›®å½•
```

### 8.2 å…³é”®æƒé™è®¾ç½®


**ðŸ” Linuxæƒé™é…ç½®**

```bash
# 1. ç¨‹åºæ–‡ä»¶æƒé™
sudo chown root:root /opt/filebeat/filebeat
sudo chmod 755 /opt/filebeat/filebeat

# 2. é…ç½®æ–‡ä»¶æƒé™ï¼ˆé‡è¦ï¼é…ç½®æ–‡ä»¶æƒé™ä¸èƒ½è¿‡äºŽå®½æ¾ï¼‰
sudo chown root:root /etc/filebeat/filebeat.yml
sudo chmod 600 /etc/filebeat/filebeat.yml

# 3. æ•°æ®ç›®å½•æƒé™
sudo chown -R root:root /var/lib/filebeat
sudo chmod 755 /var/lib/filebeat

# 4. æ—¥å¿—ç›®å½•æƒé™
sudo chown -R root:root /var/log/filebeat
sudo chmod 755 /var/log/filebeat

# 5. è¯»å–ç³»ç»Ÿæ—¥å¿—çš„æƒé™
# å°†filebeatç”¨æˆ·æ·»åŠ åˆ°admç»„ï¼ˆUbuntu/Debianï¼‰
sudo usermod -a -G adm filebeat

# æˆ–æ·»åŠ åˆ°systemd-journalç»„ï¼ˆCentOS/RHELï¼‰
sudo usermod -a -G systemd-journal filebeat
```

**âš ï¸ æƒé™å®‰å…¨æ³¨æ„äº‹é¡¹**

| æ–‡ä»¶/ç›®å½• | **æŽ¨èæƒé™** | **å®‰å…¨è¯´æ˜Ž** |
|----------|-------------|-------------|
| `filebeatå¯æ‰§è¡Œæ–‡ä»¶` | 755 (rwxr-xr-x) | æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œ |
| `é…ç½®æ–‡ä»¶` | 600 (rw-------) | åªæœ‰rootå¯è¯»å†™ |
| `æ•°æ®ç›®å½•` | 755 (rwxr-xr-x) | filebeatéœ€è¦å†™å…¥æƒé™ |
| `æ—¥å¿—æ–‡ä»¶` | 644 (rw-r--r--) | å¯è¯»ä½†ä¸å¯éšæ„ä¿®æ”¹ |

### 8.3 å¸¸è§æƒé™é—®é¢˜è§£å†³


**ðŸ› æƒé™é—®é¢˜æŽ’æŸ¥**

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /etc/filebeat/filebeat.yml
ls -la /opt/filebeat/filebeat
ls -la /var/lib/filebeat/

# æ£€æŸ¥ç”¨æˆ·æ‰€å±žç»„
groups $(whoami)
id filebeat

# æµ‹è¯•æ—¥å¿—æ–‡ä»¶è¯»å–æƒé™
sudo -u filebeat cat /var/log/syslog
sudo -u filebeat ls -la /var/log/

# æ£€æŸ¥SELinuxçŠ¶æ€ï¼ˆCentOS/RHELï¼‰
getenforce
sestatus
```

**ðŸ”§ æƒé™é—®é¢˜ä¿®å¤**

```bash
# ä¿®å¤é…ç½®æ–‡ä»¶æƒé™è¿‡äºŽå®½æ¾çš„é”™è¯¯
sudo chmod 600 /etc/filebeat/filebeat.yml

# ä¿®å¤æ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶çš„é—®é¢˜
sudo chmod +r /var/log/messages
sudo chmod +r /var/log/secure

# å¦‚æžœä½¿ç”¨éžrootç”¨æˆ·è¿è¡Œ
sudo setfacl -m u:filebeat:r /var/log/messages
sudo setfacl -m u:filebeat:r /var/log/secure
```

---

## 9. âœ… å®‰è£…éªŒè¯ä¸Žæ•…éšœæŽ’æŸ¥


### 9.1 å®‰è£…éªŒè¯æ£€æŸ¥æ¸…å•


**ðŸ“‹ åŸºç¡€éªŒè¯æ­¥éª¤**

```bash
# 1. æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯
filebeat version

# é¢„æœŸè¾“å‡ºç¤ºä¾‹ï¼š
# filebeat version 8.11.0 (amd64), libbeat 8.11.0

# 2. æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•
sudo filebeat test config -c /etc/filebeat/filebeat.yml

# é¢„æœŸè¾“å‡ºï¼š
# Config OK

# 3. æµ‹è¯•è¾“å‡ºè¿žæŽ¥
sudo filebeat test output -c /etc/filebeat/filebeat.yml

# é¢„æœŸè¾“å‡ºï¼š
# elasticsearch: http://localhost:9200...
#   parse url... OK
#   connection... OK

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status filebeat

# 5. æŸ¥çœ‹å®žæ—¶æ—¥å¿—
sudo journalctl -u filebeat -f
```

### 9.2 å¸¸è§é—®é¢˜è¯Šæ–­


**ðŸ”¸ é…ç½®æ–‡ä»¶é—®é¢˜**

```bash
# é—®é¢˜1ï¼šé…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯
# é”™è¯¯ä¿¡æ¯ï¼šyaml: line X: found character that cannot start any token

# è§£å†³æ–¹æ³•ï¼š
# 1. æ£€æŸ¥YAMLè¯­æ³•
sudo filebeat test config

# 2. å¸¸è§æ ¼å¼é”™è¯¯ï¼š
#    - ç¼©è¿›ä½¿ç”¨tabè€Œä¸æ˜¯ç©ºæ ¼
#    - å†’å·åŽé¢æ²¡æœ‰ç©ºæ ¼
#    - åˆ—è¡¨é¡¹ç¼©è¿›ä¸æ­£ç¡®

# é—®é¢˜2ï¼šæƒé™è¿‡äºŽå®½æ¾
# é”™è¯¯ä¿¡æ¯ï¼šExiting: error loading config file: config file ("filebeat.yml") must have mode 0600

# è§£å†³æ–¹æ³•ï¼š
sudo chmod 600 /etc/filebeat/filebeat.yml
```

**ðŸ”¸ ç½‘ç»œè¿žæŽ¥é—®é¢˜**

```bash
# é—®é¢˜ï¼šæ— æ³•è¿žæŽ¥åˆ°Elasticsearch
# é”™è¯¯ä¿¡æ¯ï¼šdial tcp: lookup elasticsearch on 127.0.0.53:53: no such host

# è¯Šæ–­æ­¥éª¤ï¼š
# 1. æ£€æŸ¥ç½‘ç»œè¿žé€šæ€§
ping elasticsearch-server
telnet elasticsearch-server 9200

# 2. æ£€æŸ¥DNSè§£æž
nslookup elasticsearch-server

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo firewall-cmd --list-all

# 4. æµ‹è¯•ESè¿žæŽ¥
curl -X GET "localhost:9200/_cluster/health"
```

**ðŸ”¸ æƒé™é—®é¢˜**

```bash
# é—®é¢˜ï¼šæ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶
# é”™è¯¯ä¿¡æ¯ï¼šfailed to read /var/log/messages: permission denied

# è¯Šæ–­æ­¥éª¤ï¼š
# 1. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/log/messages

# 2. æ£€æŸ¥è¿è¡Œç”¨æˆ·
ps aux | grep filebeat

# 3. æµ‹è¯•è¯»å–æƒé™
sudo -u filebeat cat /var/log/messages

# è§£å†³æ–¹æ³•ï¼š
sudo chmod +r /var/log/messages
# æˆ–è€…
sudo usermod -a -G adm filebeat
```

### 9.3 æ—¥å¿—åˆ†æžä¸Žè°ƒè¯•


**ðŸ“Š æ—¥å¿—çº§åˆ«é…ç½®**

```yaml
# åœ¨filebeat.ymlä¸­æ·»åŠ è°ƒè¯•é…ç½®
logging.level: debug
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
```

**ðŸ” å…³é”®æ—¥å¿—ä¿¡æ¯åˆ†æž**

```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
sudo journalctl -u filebeat --since "1 hour ago"

# å…³é”®ä¿¡æ¯æŸ¥æ‰¾ï¼š
# 1. é…ç½®åŠ è½½
grep "Config OK" /var/log/filebeat/filebeat

# 2. è¾“å‡ºè¿žæŽ¥çŠ¶æ€  
grep "connection" /var/log/filebeat/filebeat

# 3. æ–‡ä»¶ç›‘æŽ§çŠ¶æ€
grep "harvester" /var/log/filebeat/filebeat

# 4. é”™è¯¯ä¿¡æ¯
grep "ERROR" /var/log/filebeat/filebeat
grep "WARN" /var/log/filebeat/filebeat
```

### 9.4 æ€§èƒ½ç›‘æŽ§


**ðŸ“ˆ ç›‘æŽ§æŒ‡æ ‡**

```bash
# 1. æŸ¥çœ‹CPUå’Œå†…å­˜ä½¿ç”¨
top -p $(pgrep filebeat)
ps aux | grep filebeat

# 2. æŸ¥çœ‹ç½‘ç»œè¿žæŽ¥
ss -tuln | grep :9200
netstat -tuln | grep :9200

# 3. æŸ¥çœ‹æ–‡ä»¶å¥æŸ„
lsof -p $(pgrep filebeat) | wc -l

# 4. ç›‘æŽ§æ•°æ®å‘é€é€ŸçŽ‡
# åœ¨Elasticsearchä¸­æŸ¥çœ‹ç´¢å¼•æ–‡æ¡£æ•°é‡
curl -X GET "localhost:9200/filebeat-*/_count"
```

---

## 10. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ Filebeatæœ¬è´¨ï¼šè½»é‡çº§æ—¥å¿—æ”¶é›†å™¨ï¼Œç›‘æŽ§æ–‡ä»¶å˜åŒ–å¹¶è½¬å‘æ•°æ®
ðŸ”¸ å®‰è£…æ–¹å¼é€‰æ‹©ï¼šåŒ…ç®¡ç†å™¨é€‚åˆç”Ÿäº§çŽ¯å¢ƒï¼ŒäºŒè¿›åˆ¶åŒ…é€‚åˆæµ‹è¯•çŽ¯å¢ƒ
ðŸ”¸ å®¹å™¨åŒ–éƒ¨ç½²ï¼šDockeré€‚åˆå¼€å‘ï¼ŒKubernetesé€‚åˆå¤§è§„æ¨¡ç”Ÿäº§
ðŸ”¸ æƒé™ç®¡ç†ï¼šé…ç½®æ–‡ä»¶600æƒé™ï¼Œç¨‹åºæ–‡ä»¶755æƒé™ï¼Œæ•°æ®ç›®å½•å¯å†™
ðŸ”¸ éªŒè¯æ–¹æ³•ï¼šç‰ˆæœ¬æ£€æŸ¥ã€é…ç½®æµ‹è¯•ã€è¿žæŽ¥æµ‹è¯•ã€æœåŠ¡çŠ¶æ€æ£€æŸ¥
```

### 10.2 å…³é”®æ“ä½œè¦ç‚¹


**ðŸ”¹ å®‰è£…å‡†å¤‡**
- ç¡®è®¤ç³»ç»Ÿç‰ˆæœ¬å’Œæž¶æž„å…¼å®¹æ€§
- å‡†å¤‡ç®¡ç†å‘˜æƒé™å’Œç½‘ç»œçŽ¯å¢ƒ
- é€‰æ‹©åˆé€‚çš„å®‰è£…æ–¹å¼

**ðŸ”¹ æƒé™é…ç½®**
- é…ç½®æ–‡ä»¶å¿…é¡»æ˜¯600æƒé™ï¼ˆå®‰å…¨è¦æ±‚ï¼‰
- ç¨‹åºéœ€è¦è¯»å–æ—¥å¿—æ–‡ä»¶çš„æƒé™
- æ•°æ®ç›®å½•éœ€è¦å†™å…¥æƒé™

**ðŸ”¹ æœåŠ¡ç®¡ç†**
- ä½¿ç”¨systemctlç®¡ç†LinuxæœåŠ¡
- ä½¿ç”¨WindowsæœåŠ¡ç®¡ç†å™¨ç®¡ç†WindowsæœåŠ¡
- é…ç½®å¼€æœºè‡ªå¯åŠ¨

### 10.3 æ•…éšœæŽ’æŸ¥æ€è·¯


**ðŸ”§ ç³»ç»Ÿæ€§æŽ’æŸ¥æ–¹æ³•**
1. **é…ç½®æ£€æŸ¥**ï¼šè¯­æ³•æ­£ç¡®æ€§ã€æƒé™è®¾ç½®
2. **ç½‘ç»œæ£€æŸ¥**ï¼šè¿žé€šæ€§ã€DNSè§£æžã€é˜²ç«å¢™
3. **æƒé™æ£€æŸ¥**ï¼šæ–‡ä»¶æƒé™ã€ç”¨æˆ·ç»„è®¾ç½®
4. **æ—¥å¿—åˆ†æž**ï¼šé”™è¯¯ä¿¡æ¯ã€è­¦å‘Šä¿¡æ¯ã€è°ƒè¯•ä¿¡æ¯
5. **æ€§èƒ½ç›‘æŽ§**ï¼šèµ„æºä½¿ç”¨ã€è¿žæŽ¥çŠ¶æ€ã€æ•°æ®æµé‡

### 10.4 æœ€ä½³å®žè·µå»ºè®®


**ðŸ“ ç”Ÿäº§çŽ¯å¢ƒå»ºè®®**
- **åŒ…ç®¡ç†å™¨å®‰è£…**ï¼šä¾¿äºŽæ›´æ–°å’Œç®¡ç†
- **æœåŠ¡åŒ–è¿è¡Œ**ï¼šé…ç½®ä¸ºç³»ç»ŸæœåŠ¡ï¼Œå¼€æœºè‡ªå¯
- **æƒé™æœ€å°åŒ–**ï¼šåªç»™å¿…éœ€çš„æƒé™ï¼Œç¡®ä¿å®‰å…¨
- **ç›‘æŽ§å‘Šè­¦**ï¼šé…ç½®æœåŠ¡çŠ¶æ€ç›‘æŽ§å’Œå¼‚å¸¸å‘Šè­¦
- **å®šæœŸç»´æŠ¤**ï¼šå®šæœŸæ£€æŸ¥æ—¥å¿—ã€æ›´æ–°ç‰ˆæœ¬ã€æ¸…ç†æ•°æ®

**ðŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
- é…ç½®æ–‡ä»¶æƒé™ä¸¥æ ¼æŽ§åˆ¶ï¼ˆ600ï¼‰
- é¿å…ä½¿ç”¨è¿‡é«˜æƒé™è¿è¡Œ
- å®šæœŸæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- ç›‘æŽ§å¼‚å¸¸è¿žæŽ¥å’Œé”™è¯¯æ—¥å¿—

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Filebeatæ˜¯è½»é‡çº§çš„æ–‡ä»¶ç›‘æŽ§å’Œæ•°æ®è½¬å‘å·¥å…·
- å®‰è£…æ–¹å¼è¦æ ¹æ®çŽ¯å¢ƒé€‰æ‹©ï¼šåŒ…ç®¡ç†å™¨ã€äºŒè¿›åˆ¶ã€å®¹å™¨
- æƒé™é…ç½®æ˜¯å®‰å…¨è¿è¡Œçš„å…³é”®ï¼šé…ç½®600ï¼Œç¨‹åº755ï¼Œæ•°æ®å¯å†™
- éªŒè¯å®‰è£…æˆåŠŸçš„æ ‡å‡†æµç¨‹ï¼šç‰ˆæœ¬â†’é…ç½®â†’è¿žæŽ¥â†’æœåŠ¡â†’æ—¥å¿—