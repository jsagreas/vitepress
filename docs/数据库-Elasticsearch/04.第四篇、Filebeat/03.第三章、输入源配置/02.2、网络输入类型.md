---
title: 2、网络输入类型
---
## 📚 目录

1. [网络输入概述](#1-网络输入概述)
2. [标准输入stdin配置](#2-标准输入stdin配置)
3. [TCP网络输入配置](#3-TCP网络输入配置)
4. [UDP网络输入配置](#4-UDP网络输入配置)
5. [Syslog输入配置](#5-Syslog输入配置)
6. [网络安全与监控](#6-网络安全与监控)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🌐 网络输入概述


### 1.1 什么是网络输入


**🔸 简单理解**
```
想象一下邮件系统：
- 文件输入像是从邮箱里拿信件（被动收集）
- 网络输入像是开通热线电话（主动接收）

Filebeat网络输入 = 让Filebeat变成"服务器"
其他系统可以主动向Filebeat发送日志数据
```

**💡 网络输入的核心作用**
- **主动接收**：Filebeat监听网络端口，等待数据发送过来
- **实时处理**：数据一到达就立即处理，不用等文件写入
- **灵活对接**：可以接收各种系统、设备发送的日志
- **集中收集**：一个Filebeat可以接收多个来源的数据

### 1.2 网络输入类型对比


| 输入类型 | **使用场景** | **特点** | **适用情况** |
|---------|-------------|---------|-------------|
| 📟 **stdin** | `测试调试` | `从命令行直接输入` | `开发测试、手动测试` |
| 🔌 **tcp** | `可靠传输` | `TCP协议，保证数据不丢失` | `重要日志、应用程序日志` |
| 📡 **udp** | `快速传输` | `UDP协议，速度快但可能丢包` | `系统监控、大量数据` |
| 📋 **syslog** | `系统日志` | `标准syslog协议` | `网络设备、操作系统日志` |

### 1.3 网络输入工作原理图


```
网络日志源                    Filebeat网络输入                输出目标
┌─────────────┐              ┌─────────────────────┐          ┌──────────────┐
│  应用程序   │─────TCP────→ │   监听端口 :5044    │─────────→│ Elasticsearch│
│             │              │                     │          │              │
│  网络设备   │─────UDP────→ │   解析 + 过滤       │─────────→│    Kafka     │
│             │              │                     │          │              │
│ 系统服务器  │───Syslog───→ │   格式化 + 发送     │─────────→│   Logstash   │
└─────────────┘              └─────────────────────┘          └──────────────┘
```

---

## 2. 📟 标准输入stdin配置


### 2.1 stdin基本概念


**🔸 什么是stdin**
```
stdin = Standard Input = 标准输入
就像在命令行里直接打字一样
你输入什么，Filebeat就收集什么

主要用途：
✅ 开发测试 - 快速验证配置是否正确
✅ 调试排错 - 手动输入数据看处理结果
✅ 学习练习 - 理解Filebeat工作原理
```

### 2.2 stdin基础配置


```yaml
# 最简单的stdin配置
filebeat.inputs:
- type: stdin
  enabled: true
  
output.console:
  pretty: true
```

**配置说明**：
- `type: stdin`：指定输入类型为标准输入
- `enabled: true`：启用这个输入源
- `output.console`：输出到控制台（方便看结果）

### 2.3 stdin实用配置示例


```yaml
filebeat.inputs:
- type: stdin
  enabled: true
  # 添加标签，方便识别数据来源
  tags: ["manual-input", "test"]
  # 添加自定义字段
  fields:
    source_type: "manual"
    environment: "development"
  # 是否将自定义字段放在根级别
  fields_under_root: false

# 处理器：在数据发送前进行处理
processors:
- add_host_metadata:
    when.not.contains.tags: skip_add_host_metadata

output.console:
  pretty: true
```

### 2.4 stdin使用场景


**🎯 实际使用示例**

> 💡 **测试场景**: 验证JSON日志解析是否正确

```bash
# 1. 启动Filebeat
./filebeat -e -c test-stdin.yml

# 2. 手动输入JSON数据
{"timestamp":"2024-01-01T10:00:00Z","level":"INFO","message":"用户登录","user_id":"12345"}

# 3. 查看Filebeat输出结果
```

> ⚠️ **注意**: stdin主要用于测试，生产环境很少使用

---

## 3. 🔌 TCP网络输入配置


### 3.1 TCP输入原理


**🔸 TCP输入工作机制**
```
TCP特点：
✅ 可靠传输 - 保证数据不丢失、不重复
✅ 有序接收 - 数据按发送顺序到达
✅ 连接管理 - 建立连接后持续通信

工作流程：
客户端 ──建立连接──→ Filebeat监听端口
客户端 ──发送数据──→ Filebeat接收处理
客户端 ──关闭连接──→ Filebeat释放资源
```

### 3.2 TCP基础配置


```yaml
filebeat.inputs:
- type: tcp
  host: "0.0.0.0:5044"  # 监听所有网卡的5044端口
  enabled: true
  
  # 基本设置
  max_message_size: 20971520  # 最大消息大小 20MB
  timeout: 300s               # 连接超时时间 5分钟
```

**核心参数说明**：
- `host`：监听的IP地址和端口（`0.0.0.0`表示监听所有网卡）
- `max_message_size`：单条消息最大字节数，防止内存溢出
- `timeout`：连接空闲超时时间，超时后自动关闭连接

### 3.3 TCP高级配置


```yaml
filebeat.inputs:
- type: tcp
  host: "192.168.1.100:5044"
  enabled: true
  
  # 连接管理
  max_connections: 100        # 最大并发连接数
  timeout: 300s              # 连接超时
  
  # 数据处理
  max_message_size: 10485760 # 10MB
  buffer_size: 65536         # 接收缓冲区大小 64KB
  
  # 分隔符配置（处理多行数据）
  line_delimiter: "\n"       # 行分隔符
  
  # 标签和字段
  tags: ["tcp-input", "app-logs"]
  fields:
    input_type: "tcp"
    datacenter: "beijing"
  fields_under_root: false
  
  # SSL/TLS安全配置（可选）
  ssl.enabled: false
```

### 3.4 TCP实际应用场景


**🎯 应用程序日志收集**

```yaml
# 配置示例：收集Java应用日志
filebeat.inputs:
- type: tcp
  host: "0.0.0.0:5044"
  enabled: true
  tags: ["java-app", "production"]
  fields:
    app_name: "user-service"
    log_type: "application"

output.elasticsearch:
  hosts: ["es01:9200"]
  index: "app-logs-%{+yyyy.MM.dd}"
```

**应用端发送代码示例（Java）**：
```java
// 简单的TCP发送示例
Socket socket = new Socket("filebeat-server", 5044);
PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
out.println("{\"level\":\"INFO\",\"message\":\"用户登录成功\",\"user_id\":\"12345\"}");
socket.close();
```

### 3.5 TCP性能调优


**📊 性能优化建议**

| 参数 | **推荐值** | **说明** |
|------|-----------|---------|
| `max_connections` | `100-500` | `根据并发客户端数量调整` |
| `buffer_size` | `65536` | `64KB，平衡内存和性能` |
| `timeout` | `300s` | `5分钟，避免僵尸连接` |
| `max_message_size` | `10MB` | `根据日志大小调整` |

---

## 4. 📡 UDP网络输入配置


### 4.1 UDP输入特点


**🔸 UDP vs TCP对比**
```
UDP特点：
⚡ 速度快 - 无需建立连接，直接发送
📊 低延迟 - 适合大量实时数据
⚠️ 不可靠 - 可能丢包，无法保证顺序
🔄 无状态 - 发送完就忘记，不维护连接

使用场景：
✅ 系统监控数据（CPU、内存使用率）
✅ 网络设备状态信息
✅ 大量的非关键日志
❌ 重要的业务日志（建议用TCP）
```

### 4.2 UDP基础配置


```yaml
filebeat.inputs:
- type: udp
  host: "0.0.0.0:5045"  # 监听UDP 5045端口
  enabled: true
  
  # UDP特有配置
  max_message_size: 65536  # 64KB，UDP建议不要太大
  read_buffer: 65536       # 读取缓冲区
```

### 4.3 UDP完整配置示例


```yaml
filebeat.inputs:
- type: udp
  host: "0.0.0.0:5045"
  enabled: true
  
  # 数据处理设置
  max_message_size: 65536    # 64KB单包大小
  read_buffer: 1048576       # 1MB读缓冲区
  timeout: 30s               # 读取超时
  
  # 标识配置
  tags: ["udp-input", "monitoring"]
  fields:
    input_type: "udp"
    data_category: "metrics"
  
# 输出到Elasticsearch
output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "monitoring-data-%{+yyyy.MM.dd}"
```

### 4.4 UDP应用场景示例


**🎯 监控数据收集**

> 💡 **场景**: 收集服务器监控指标

```bash
# 使用nc命令发送UDP测试数据
echo '{"metric":"cpu_usage","value":85.2,"host":"web01","timestamp":"2024-01-01T10:00:00Z"}' | nc -u filebeat-server 5045

# 批量发送多条监控数据
for i in {1..100}; do
  echo "{\"metric\":\"memory_usage\",\"value\":$((RANDOM%100)),\"host\":\"web01\"}" | nc -u filebeat-server 5045
done
```

### 4.5 UDP注意事项


> ⚠️ **重要提醒**:
> - UDP可能丢包，不适合重要日志
> - 单包大小不要超过网络MTU（通常1500字节）
> - 高频发送时注意网络带宽和Filebeat处理能力

---

## 5. 📋 Syslog输入配置


### 5.1 Syslog协议简介


**🔸 什么是Syslog**
```
Syslog = System Log = 系统日志协议
是Unix/Linux系统的标准日志协议

Syslog的作用：
📝 统一格式 - 所有系统日志都用相同格式
📊 优先级分类 - 按重要程度分类（INFO、WARNING、ERROR等）
🌐 网络传输 - 可以通过网络发送到远程服务器
🔧 标准化 - 网络设备、服务器都支持
```

### 5.2 Syslog消息格式


```
标准Syslog消息格式：
<优先级>时间戳 主机名 程序名: 消息内容

示例：
<34>Jan 01 10:00:00 web01 nginx: 192.168.1.100 - - [01/Jan/2024:10:00:00 +0000] "GET / HTTP/1.1" 200 1234
```

**优先级计算**：
- 优先级 = 设施代码 × 8 + 严重级别
- 设施代码：0=内核，1=用户，2=邮件，4=系统守护进程，16=本地用户0
- 严重级别：0=紧急，1=告警，2=严重，3=错误，4=警告，5=通知，6=信息，7=调试

### 5.3 Syslog基础配置


```yaml
filebeat.inputs:
- type: syslog
  protocol.udp:
    host: "0.0.0.0:514"  # 标准syslog UDP端口
  enabled: true
```

### 5.4 Syslog完整配置


```yaml
filebeat.inputs:
- type: syslog
  # UDP协议配置
  protocol.udp:
    host: "0.0.0.0:514"
    max_message_size: 65536
    read_buffer: 1048576
  
  # 或者TCP协议配置
  # protocol.tcp:
  #   host: "0.0.0.0:514"
  #   max_connections: 100
  #   timeout: 300s
  
  enabled: true
  
  # 时区设置（重要！）
  timezone: "Asia/Shanghai"
  
  # 标签和字段
  tags: ["syslog", "infrastructure"]
  fields:
    log_source: "syslog"
    facility: "system"

# 处理器：解析syslog字段
processors:
- syslog:
    field: message
    target_field: syslog
    
output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "syslog-%{+yyyy.MM.dd}"
```

### 5.5 Syslog实际应用


**🎯 网络设备日志收集**

```yaml
# 专门收集网络设备syslog
filebeat.inputs:
- type: syslog
  protocol.udp:
    host: "0.0.0.0:514"
  enabled: true
  tags: ["network-devices"]
  
processors:
- syslog:
    field: message
    target_field: syslog
- add_fields:
    target: ""
    fields:
      data_stream.type: "logs"
      data_stream.dataset: "network.syslog"
      data_stream.namespace: "production"

output.elasticsearch:
  hosts: ["es01:9200"]
  index: "network-logs-%{+yyyy.MM.dd}"
```

**设备配置示例**（路由器/交换机）：
```bash
# Cisco设备配置syslog
logging host 192.168.1.100
logging trap informational

# Linux系统发送syslog测试
logger -n filebeat-server -P 514 "这是一条测试syslog消息"
```

---

## 6. 🔒 网络安全与监控


### 6.1 网络端口管理


**🔸 端口规划建议**

| 服务类型 | **默认端口** | **建议端口** | **说明** |
|---------|-------------|-------------|---------|
| `TCP应用日志` | `5044` | `5044` | `Elastic官方推荐` |
| `UDP监控数据` | `5045` | `5045-5050` | `避免与TCP冲突` |
| `Syslog` | `514` | `514/1514` | `标准端口/非特权端口` |

### 6.2 连接监控配置


```yaml
# 启用内部监控指标
monitoring.enabled: true
monitoring.elasticsearch:
  hosts: ["elasticsearch:9200"]

# 日志级别设置
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644

# 性能监控
filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: true
  reload.period: 10s
```

### 6.3 防火墙配置


**🔧 Linux防火墙设置**
```bash
# 开放TCP 5044端口
sudo iptables -A INPUT -p tcp --dport 5044 -j ACCEPT

# 开放UDP 5045端口  
sudo iptables -A INPUT -p udp --dport 5045 -j ACCEPT

# 开放Syslog端口
sudo iptables -A INPUT -p udp --dport 514 -j ACCEPT

# 保存规则
sudo iptables-save > /etc/iptables/rules.v4
```

### 6.4 SSL/TLS安全配置


```yaml
# TCP SSL配置示例
filebeat.inputs:
- type: tcp
  host: "0.0.0.0:5044"
  ssl.enabled: true
  ssl.certificate: "/path/to/server.crt"
  ssl.key: "/path/to/server.key"
  ssl.client_authentication: "required"
  ssl.certificate_authorities: ["/path/to/ca.crt"]
```

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🔸 网络输入类型：stdin测试、TCP可靠、UDP快速、Syslog标准
🔸 端口监听：Filebeat作为服务器，监听端口接收数据
🔸 协议特点：TCP保证可靠，UDP追求速度，Syslog标准化
🔸 配置要点：host地址、端口号、缓冲区、超时时间
🔸 安全考虑：防火墙开放、SSL加密、连接数限制
```

### 7.2 关键理解要点


**🔹 选择合适的输入类型**
```
决策树：
重要业务日志 → TCP输入（可靠性优先）
监控指标数据 → UDP输入（性能优先）  
网络设备日志 → Syslog输入（标准协议）
开发测试验证 → stdin输入（简单快捷）
```

**🔹 性能与可靠性平衡**
```
可靠性要求高：
- 选择TCP协议
- 设置合理的超时时间
- 限制最大连接数

性能要求高：
- 选择UDP协议  
- 增大缓冲区大小
- 减少消息处理复杂度
```

**🔹 网络配置注意事项**
```
端口冲突：确保端口未被占用
防火墙：开放相应端口访问权限
网络延迟：考虑客户端与Filebeat之间的网络质量
负载均衡：大量数据时考虑多个Filebeat实例
```

### 7.3 实际应用价值


**📊 应用场景总结**
- **应用集中日志**：多个应用通过TCP发送日志到Filebeat
- **设备监控数据**：网络设备通过Syslog发送状态信息
- **实时指标收集**：监控系统通过UDP发送性能数据
- **开发环境测试**：使用stdin快速验证配置和处理逻辑

**🔧 运维实践**
- **监控连接状态**：定期检查网络连接数和处理性能
- **日志轮转管理**：合理设置Filebeat自身的日志管理
- **备份配置文件**：网络配置变更前做好配置备份
- **性能调优测试**：根据实际数据量调整缓冲区和连接参数

**💡 学习建议**
- 从stdin开始练习，理解基本工作原理
- 使用TCP配置处理应用日志，掌握可靠传输
- 尝试UDP配置收集监控数据，体验高性能传输
- 配置Syslog处理系统日志，了解标准协议应用

**核心记忆**：
- 网络输入让Filebeat变身服务器，主动接收各方数据
- TCP求稳定，UDP求速度，Syslog求标准，stdin求简单
- 端口规划要合理，安全配置不能少，性能调优需测试