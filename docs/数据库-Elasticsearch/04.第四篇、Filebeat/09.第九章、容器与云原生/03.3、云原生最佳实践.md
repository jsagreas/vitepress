---
title: 3ã€äº‘åŸç”Ÿæœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [å®¹å™¨åŒ–æœ€ä½³å®è·µ](#1-å®¹å™¨åŒ–æœ€ä½³å®è·µ)
2. [èµ„æºç®¡ç†ä¸ä¼˜åŒ–](#2-èµ„æºç®¡ç†ä¸ä¼˜åŒ–)
3. [å­˜å‚¨ä¸æ•°æ®æŒä¹…åŒ–](#3-å­˜å‚¨ä¸æ•°æ®æŒä¹…åŒ–)
4. [å¾®æœåŠ¡æ—¥å¿—æ”¶é›†ç­–ç•¥](#4-å¾®æœåŠ¡æ—¥å¿—æ”¶é›†ç­–ç•¥)
5. [æœåŠ¡å‘ç°ä¸åŠ¨æ€é…ç½®](#5-æœåŠ¡å‘ç°ä¸åŠ¨æ€é…ç½®)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ³ å®¹å™¨åŒ–æœ€ä½³å®è·µ


### 1.1 ä»€ä¹ˆæ˜¯Filebeatå®¹å™¨åŒ–


**ç®€å•ç†è§£**ï¼šæŠŠFilebeatè£…è¿›"ç›’å­"é‡Œï¼Œè¿™ä¸ªç›’å­å°±æ˜¯å®¹å™¨ã€‚å°±åƒæŠŠå·¥å…·æ”¾è¿›å·¥å…·ç®±ï¼Œåˆ°å“ªé‡Œéƒ½èƒ½ç”¨ã€‚

```
ä¼ ç»Ÿéƒ¨ç½² vs å®¹å™¨åŒ–éƒ¨ç½²ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼š
æœåŠ¡å™¨A â† ç›´æ¥å®‰è£…Filebeat â†’ æ”¶é›†æ—¥å¿—
æœåŠ¡å™¨B â† ç›´æ¥å®‰è£…Filebeat â†’ æ”¶é›†æ—¥å¿—  
æœåŠ¡å™¨C â† ç›´æ¥å®‰è£…Filebeat â†’ æ”¶é›†æ—¥å¿—

å®¹å™¨åŒ–æ–¹å¼ï¼š
æœåŠ¡å™¨A â† Dockerå®¹å™¨(Filebeat) â†’ æ”¶é›†æ—¥å¿—
æœåŠ¡å™¨B â† Dockerå®¹å™¨(Filebeat) â†’ æ”¶é›†æ—¥å¿—
æœåŠ¡å™¨C â† Dockerå®¹å™¨(Filebeat) â†’ æ”¶é›†æ—¥å¿—

ä¼˜åŠ¿ï¼šç‰ˆæœ¬ç»Ÿä¸€ã€ç¯å¢ƒä¸€è‡´ã€éƒ¨ç½²ç®€å•
```

### 1.2 åŸºç¡€å®¹å™¨åŒ–é…ç½®


**ğŸ”§ åŸºæœ¬Dockerfileç¤ºä¾‹**

```dockerfile
# ä½¿ç”¨å®˜æ–¹Filebeaté•œåƒä½œä¸ºåŸºç¡€
FROM docker.elastic.co/beats/filebeat:8.10.0

# æ‹·è´è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
COPY filebeat.yml /usr/share/filebeat/filebeat.yml

# è®¾ç½®æ­£ç¡®çš„æƒé™
USER root
RUN chown filebeat:filebeat /usr/share/filebeat/filebeat.yml
USER filebeat

# å¥åº·æ£€æŸ¥ï¼ˆç¡®ä¿Filebeatæ­£å¸¸è¿è¡Œï¼‰
HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
  CMD filebeat test config || exit 1
```

**ğŸ’¡ é…ç½®è¯´æ˜**ï¼š
- `FROM`ï¼šé€‰æ‹©å®˜æ–¹é•œåƒï¼Œå®‰å…¨å¯é 
- `COPY`ï¼šæŠŠä½ çš„é…ç½®æ–‡ä»¶æ”¾è¿›å®¹å™¨
- `USER`ï¼šè®¾ç½®è¿è¡Œç”¨æˆ·ï¼Œæé«˜å®‰å…¨æ€§
- `HEALTHCHECK`ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸

### 1.3 Docker Composeéƒ¨ç½²


**ğŸš€ å®Œæ•´éƒ¨ç½²é…ç½®**

```yaml
version: '3.8'

services:
  filebeat:
    image: docker.elastic.co/beats/filebeat:8.10.0
    container_name: filebeat-collector
    
    # èµ„æºé™åˆ¶
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
        reservations:
          memory: 256M
    
    # æŒ‚è½½é…ç½®å’Œæ—¥å¿—ç›®å½•
    volumes:
      - ./filebeat.yml:/usr/share/filebeat/filebeat.yml:ro
      - /var/log:/var/log:ro
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
    
    # ç½‘ç»œé…ç½®
    networks:
      - elastic-network
    
    # é‡å¯ç­–ç•¥
    restart: unless-stopped
    
    # ç¯å¢ƒå˜é‡
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
      - KIBANA_HOST=http://kibana:5601

networks:
  elastic-network:
    driver: bridge
```

**ğŸ“‹ é…ç½®è¯¦è§£**ï¼š

| **é…ç½®é¡¹** | **ä½œç”¨** | **é‡è¦æ€§** |
|------------|----------|------------|
| `resources` | é™åˆ¶CPUå’Œå†…å­˜ä½¿ç”¨ | â­â­â­ é˜²æ­¢èµ„æºè€—å°½ |
| `volumes` | æŒ‚è½½é…ç½®å’Œæ—¥å¿—ç›®å½• | â­â­â­ æ•°æ®è®¿é—®å¿…éœ€ |
| `networks` | ç½‘ç»œè¿æ¥è®¾ç½® | â­â­ æœåŠ¡é—´é€šä¿¡ |
| `restart` | è‡ªåŠ¨é‡å¯ç­–ç•¥ | â­â­ é«˜å¯ç”¨ä¿éšœ |

---

## 2. âš–ï¸ èµ„æºç®¡ç†ä¸ä¼˜åŒ–


### 2.1 ä¸ºä»€ä¹ˆè¦é™åˆ¶èµ„æº


**ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒé™åˆ¶å­©å­åƒç³–çš„æ•°é‡ï¼Œä¸æ˜¯ä¸è®©åƒï¼Œè€Œæ˜¯é˜²æ­¢åƒå¤ªå¤šå½±å“å¥åº·ã€‚Filebeatä¹Ÿéœ€è¦é™åˆ¶èµ„æºä½¿ç”¨ï¼Œé˜²æ­¢"åƒ"å¤ªå¤šCPUå’Œå†…å­˜ã€‚

```
æ²¡æœ‰é™åˆ¶çš„é—®é¢˜ï¼š
Filebeat â†’ å ç”¨è¿‡å¤šCPU â†’ å…¶ä»–æœåŠ¡å˜æ…¢
Filebeat â†’ å ç”¨è¿‡å¤šå†…å­˜ â†’ ç³»ç»Ÿå¡é¡¿
Filebeat â†’ å¤„ç†è¿‡å¿« â†’ ç›®æ ‡æœåŠ¡å‹åŠ›å¤§

æœ‰é™åˆ¶çš„å¥½å¤„ï¼š
Filebeat â†’ é€‚é‡CPUä½¿ç”¨ â†’ ç³»ç»Ÿè¿è¡Œç¨³å®š
Filebeat â†’ å›ºå®šå†…å­˜å ç”¨ â†’ å¯é¢„æµ‹çš„èµ„æºä½¿ç”¨
Filebeat â†’ æ§åˆ¶å‘é€é€Ÿåº¦ â†’ ç›®æ ‡æœåŠ¡ä¸è¿‡è½½
```

### 2.2 CPUèµ„æºé…ç½®


**ğŸ”§ Kubernetesèµ„æºé™åˆ¶**

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: filebeat
spec:
  template:
    spec:
      containers:
      - name: filebeat
        image: docker.elastic.co/beats/filebeat:8.10.0
        
        # èµ„æºè¯·æ±‚å’Œé™åˆ¶
        resources:
          requests:
            memory: "256Mi"      # æœ€å°‘éœ€è¦256MBå†…å­˜
            cpu: "100m"          # æœ€å°‘éœ€è¦0.1ä¸ªCPUæ ¸å¿ƒ
          limits:
            memory: "512Mi"      # æœ€å¤šä½¿ç”¨512MBå†…å­˜
            cpu: "500m"          # æœ€å¤šä½¿ç”¨0.5ä¸ªCPUæ ¸å¿ƒ
```

**ğŸ“Š èµ„æºé…ç½®å»ºè®®**ï¼š

| **åœºæ™¯** | **CPUè¯·æ±‚** | **CPUé™åˆ¶** | **å†…å­˜è¯·æ±‚** | **å†…å­˜é™åˆ¶** |
|----------|------------|------------|-------------|-------------|
| **è½»é‡æ—¥å¿—** | 50m | 200m | 128Mi | 256Mi |
| **ä¸­ç­‰è´Ÿè½½** | 100m | 500m | 256Mi | 512Mi |
| **é‡è´Ÿè½½** | 200m | 1000m | 512Mi | 1Gi |

### 2.3 å†…å­˜ä¼˜åŒ–é…ç½®


**âš¡ Filebeatå†…å­˜è°ƒä¼˜**

```yaml
# filebeat.yml ä¸­çš„æ€§èƒ½é…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/*.log
  
  # æ§åˆ¶è¯»å–é€Ÿåº¦ï¼Œé˜²æ­¢å†…å­˜çˆ†ç‚¸
  harvester_buffer_size: 16384    # è¯»å–ç¼“å†²åŒºå¤§å°
  max_bytes: 10485760            # å•è¡Œæœ€å¤§å­—èŠ‚æ•°ï¼ˆ10MBï¼‰

# è¾“å‡ºç¼“å†²é…ç½®
output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  
  # æ‰¹é‡å‘é€é…ç½®ï¼ˆå‡å°‘å†…å­˜å ç”¨ï¼‰
  bulk_max_size: 50              # æ¯æ‰¹æœ€å¤š50æ¡è®°å½•
  flush_bytes: 1048576           # ç¼“å†²åŒºè¾¾åˆ°1MBå°±å‘é€
  flush_timeout: 5s              # 5ç§’å¼ºåˆ¶å‘é€ä¸€æ¬¡

# é˜Ÿåˆ—é…ç½®
queue.mem:
  events: 4096                   # å†…å­˜é˜Ÿåˆ—æœ€å¤š4096ä¸ªäº‹ä»¶
  flush.min_events: 512          # æœ€å°‘512ä¸ªäº‹ä»¶æ‰æ‰¹é‡å¤„ç†
  flush.timeout: 5s              # 5ç§’è¶…æ—¶
```

**ğŸ§  å†…å­˜ä¼˜åŒ–ç†è§£**ï¼š
- **ç¼“å†²åŒºå¤§å°**ï¼šåƒæ°´æ¡¶çš„å¤§å°ï¼Œå¤ªå¤§æµªè´¹ï¼Œå¤ªå°æ•ˆç‡ä½
- **æ‰¹é‡å‘é€**ï¼šåƒå¿«é€’æ‰“åŒ…ï¼Œç§¯æ”’ä¸€å®šæ•°é‡ä¸€èµ·é€ï¼Œæ•ˆç‡æ›´é«˜
- **é˜Ÿåˆ—é™åˆ¶**ï¼šåƒé™åˆ¶æ’é˜Ÿäººæ•°ï¼Œé˜²æ­¢é˜Ÿä¼å¤ªé•¿å åœ°æ–¹

---

## 3. ğŸ’¾ å­˜å‚¨ä¸æ•°æ®æŒä¹…åŒ–


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–


**ç®€å•ç†è§£**ï¼šå®¹å™¨å°±åƒä¸´æ—¶å¸ç¯·ï¼Œåˆ é™¤åé‡Œé¢çš„ä¸œè¥¿å°±æ²¡äº†ã€‚æŒä¹…åŒ–å°±æ˜¯æŠŠé‡è¦ä¸œè¥¿æ”¾åœ¨å¸ç¯·å¤–é¢çš„ä¿é™©æŸœé‡Œã€‚

```
æ²¡æœ‰æŒä¹…åŒ–çš„é—®é¢˜ï¼š
å®¹å™¨é‡å¯ â†’ æ³¨å†Œè¡¨ä¿¡æ¯ä¸¢å¤± â†’ é‡å¤æ”¶é›†æ—¥å¿—
å®¹å™¨åˆ é™¤ â†’ å¤„ç†è¿›åº¦ä¸¢å¤± â†’ æ•°æ®å¯èƒ½é‡å¤æˆ–é—æ¼

æœ‰æŒä¹…åŒ–çš„å¥½å¤„ï¼š
å®¹å™¨é‡å¯ â†’ æ³¨å†Œè¡¨ä¿¡æ¯ä¿ç•™ â†’ ç»§ç»­ä»æ–­ç‚¹æ”¶é›†
å®¹å™¨åˆ é™¤ â†’ é‡è¦æ•°æ®ä¿ç•™ â†’ æ–°å®¹å™¨å¯ä»¥ç»§ç»­å·¥ä½œ
```

### 3.2 å…³é”®ç›®å½•æŒ‚è½½


**ğŸ“ å¿…é¡»æŒ‚è½½çš„ç›®å½•**

```yaml
# Docker Compose æŒ‚è½½é…ç½®
volumes:
  # 1. é…ç½®æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
  - ./filebeat.yml:/usr/share/filebeat/filebeat.yml:ro
  
  # 2. æ—¥å¿—ç›®å½•ï¼ˆåªè¯»ï¼‰
  - /var/log:/var/log:ro
  - /var/lib/docker/containers:/var/lib/docker/containers:ro
  
  # 3. æ³¨å†Œè¡¨ç›®å½•ï¼ˆè¯»å†™ï¼Œé‡è¦ï¼ï¼‰
  - filebeat-registry:/usr/share/filebeat/data
  
  # 4. Dockerå¥—æ¥å­—ï¼ˆç›‘æ§å®¹å™¨ï¼‰
  - /var/run/docker.sock:/var/run/docker.sock:ro

# å®šä¹‰æŒä¹…åŒ–å·
volumes:
  filebeat-registry:
    driver: local
```

**ğŸ¯ ç›®å½•ä½œç”¨è¯´æ˜**ï¼š

| **ç›®å½•** | **ä½œç”¨** | **æƒé™** | **é‡è¦ç¨‹åº¦** |
|----------|----------|----------|--------------|
| `filebeat.yml` | é…ç½®æ–‡ä»¶ | åªè¯» | â­â­â­ å¿…éœ€ |
| `/var/log` | ç³»ç»Ÿæ—¥å¿— | åªè¯» | â­â­â­ æ•°æ®æº |
| `/data` | æ³¨å†Œè¡¨ä¿¡æ¯ | è¯»å†™ | â­â­â­ é˜²é‡å¤ |
| `docker.sock` | å®¹å™¨ç›‘æ§ | åªè¯» | â­â­ å®¹å™¨æ—¥å¿— |

### 3.3 KubernetesæŒä¹…åŒ–é…ç½®


**ğŸ”§ PVCé…ç½®ç¤ºä¾‹**

```yaml
# æŒä¹…åŒ–å·å£°æ˜
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: filebeat-data
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi

---
# DaemonSeté…ç½®
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: filebeat
spec:
  template:
    spec:
      containers:
      - name: filebeat
        volumeMounts:
        # æŒ‚è½½æŒä¹…åŒ–å·
        - name: filebeat-data
          mountPath: /usr/share/filebeat/data
        
        # æŒ‚è½½ä¸»æœºæ—¥å¿—ç›®å½•
        - name: var-log
          mountPath: /var/log
          readOnly: true
      
      volumes:
      - name: filebeat-data
        persistentVolumeClaim:
          claimName: filebeat-data
      
      - name: var-log
        hostPath:
          path: /var/log
```

---

## 4. ğŸ¯ å¾®æœåŠ¡æ—¥å¿—æ”¶é›†ç­–ç•¥


### 4.1 å¾®æœåŠ¡æ—¥å¿—ç‰¹ç‚¹


**ç†è§£å¾®æœåŠ¡æ—¥å¿—**ï¼šæƒ³è±¡ä¸€ä¸ªå¤§é¤å…ï¼Œæœ‰å‰å°ã€å¨æˆ¿ã€æ”¶é“¶ã€æ¸…æ´ç­‰éƒ¨é—¨ã€‚æ¯ä¸ªéƒ¨é—¨éƒ½æœ‰è‡ªå·±çš„å·¥ä½œè®°å½•ï¼Œå¾®æœåŠ¡å°±æ˜¯è¿™æ ·ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ—¥å¿—ã€‚

```
ä¼ ç»Ÿåº”ç”¨æ—¥å¿—ï¼š
å•ä½“åº”ç”¨ â†’ ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ â†’ ç®€å•æ”¶é›†

å¾®æœåŠ¡æ—¥å¿—ï¼š
ç”¨æˆ·æœåŠ¡ â†’ user.log
è®¢å•æœåŠ¡ â†’ order.log  
æ”¯ä»˜æœåŠ¡ â†’ payment.log
é€šçŸ¥æœåŠ¡ â†’ notification.log
...
æ¯ä¸ªæœåŠ¡ â†’ ç‹¬ç«‹æ—¥å¿— â†’ éœ€è¦ç»Ÿä¸€æ”¶é›†
```

### 4.2 Sidecaræ¨¡å¼æ”¶é›†


**ğŸ”„ Sidecarå·¥ä½œåŸç†**

```
Sidecaræ¨¡å¼å°±åƒç»™æ¯ä¸ªå‘˜å·¥é…ä¸€ä¸ªåŠ©æ‰‹ï¼š

Podå†…å®¹å™¨ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pod (ä¸€ä¸ªå·¥ä½œç»„)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åº”ç”¨å®¹å™¨     â”‚ â”‚ Filebeat    â”‚ â”‚
â”‚ â”‚ (ä¸»è¦å·¥ä½œ)   â”‚ â”‚ (æ—¥å¿—æ”¶é›†)   â”‚ â”‚
â”‚ â”‚             â”‚ â”‚             â”‚ â”‚
â”‚ â”‚ å†™æ—¥å¿— â”€â”€â”€â”€â–º â”‚ â”‚ è¯»å–æ—¥å¿—     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         å…±äº«å­˜å‚¨å·               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“ Sidecaré…ç½®ç¤ºä¾‹**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-app
spec:
  template:
    spec:
      containers:
      # ä¸»åº”ç”¨å®¹å™¨
      - name: web-app
        image: my-web-app:latest
        volumeMounts:
        - name: app-logs
          mountPath: /app/logs
      
      # Filebeat sidecarå®¹å™¨
      - name: filebeat
        image: docker.elastic.co/beats/filebeat:8.10.0
        volumeMounts:
        - name: app-logs
          mountPath: /var/log/app
        - name: filebeat-config
          mountPath: /usr/share/filebeat/filebeat.yml
          subPath: filebeat.yml
      
      volumes:
      - name: app-logs
        emptyDir: {}
      - name: filebeat-config
        configMap:
          name: filebeat-config
```

### 4.3 å¤šè¡Œæ—¥å¿—å¤„ç†


**ğŸ” Javaå¼‚å¸¸æ—¥å¿—ç¤ºä¾‹**

```yaml
# filebeat.yml å¤šè¡Œé…ç½®
filebeat.inputs:
- type: log
  paths:
    - /var/log/app/*.log
  
  # å¤šè¡Œæ¨¡å¼é…ç½®
  multiline.type: pattern
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'    # ä»¥æ—¥æœŸå¼€å¤´çš„è¡Œ
  multiline.negate: true                     # ä¸åŒ¹é…çš„è¡Œ
  multiline.match: after                     # åˆå¹¶åˆ°å‰ä¸€è¡Œ
  multiline.max_lines: 500                   # æœ€å¤š500è¡Œ
  multiline.timeout: 5s                      # 5ç§’è¶…æ—¶
  
  # æ·»åŠ æœåŠ¡æ ‡è¯†
  fields:
    service: user-service
    environment: production
  fields_under_root: true
```

**ğŸ’¡ å¤šè¡Œå¤„ç†ç†è§£**ï¼š
- **æ¨¡å¼åŒ¹é…**ï¼šåƒæ‰¾è§„å¾‹ï¼Œæ—¥æœŸå¼€å¤´çš„æ˜¯æ–°è®°å½•
- **è¡Œåˆå¹¶**ï¼šæŠŠç›¸å…³çš„è¡Œæ‹¼åœ¨ä¸€èµ·ï¼Œå½¢æˆå®Œæ•´ä¿¡æ¯
- **è¶…æ—¶æœºåˆ¶**ï¼šé˜²æ­¢ç­‰å¤ªä¹…ï¼Œå®šæ—¶å¤„ç†ç§¯ç´¯çš„å†…å®¹

---

## 5. ğŸ” æœåŠ¡å‘ç°ä¸åŠ¨æ€é…ç½®


### 5.1 ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°


**ç”Ÿæ´»ç±»æ¯”**ï¼šæœåŠ¡å‘ç°å°±åƒé€šè®¯å½•è‡ªåŠ¨æ›´æ–°ã€‚å½“æœ‰æ–°åŒäº‹å…¥èŒæˆ–ç¦»èŒæ—¶ï¼Œé€šè®¯å½•ä¼šè‡ªåŠ¨æ·»åŠ æˆ–åˆ é™¤è”ç³»æ–¹å¼ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ã€‚

```
é™æ€é…ç½®é—®é¢˜ï¼š
æ‰‹åŠ¨é…ç½® â†’ elasticsearch: ["192.168.1.10:9200"]
æœåŠ¡å™¨å˜æ›´ â†’ éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶
æ‰©å®¹ç¼©å®¹ â†’ é…ç½®æ–‡ä»¶éœ€è¦åŒæ­¥æ›´æ–°

åŠ¨æ€å‘ç°å¥½å¤„ï¼š
è‡ªåŠ¨å‘ç° â†’ elasticsearchæœåŠ¡è‡ªåŠ¨è¯†åˆ«
æœåŠ¡å™¨å˜æ›´ â†’ è‡ªåŠ¨æ„ŸçŸ¥æ–°çš„æœåŠ¡åœ°å€
æ‰©å®¹ç¼©å®¹ â†’ æ— éœ€ä¿®æ”¹é…ç½®ï¼Œè‡ªåŠ¨é€‚åº”
```

### 5.2 KubernetesæœåŠ¡å‘ç°


**ğŸ¯ åŸºäºServiceçš„å‘ç°**

```yaml
# Elasticsearch Serviceå®šä¹‰
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch
  labels:
    app: elasticsearch
spec:
  ports:
  - port: 9200
    name: http
  selector:
    app: elasticsearch

---
# Filebeaté…ç½®ä½¿ç”¨æœåŠ¡å
apiVersion: v1
kind: ConfigMap
metadata:
  name: filebeat-config
data:
  filebeat.yml: |
    filebeat.inputs:
    - type: log
      paths:
        - /var/log/*.log
    
    # ä½¿ç”¨KubernetesæœåŠ¡å‘ç°
    output.elasticsearch:
      hosts: ["elasticsearch:9200"]  # ç›´æ¥ä½¿ç”¨æœåŠ¡å
      
    # è‡ªåŠ¨æ·»åŠ Kuberneteså…ƒæ•°æ®
    processors:
    - add_kubernetes_metadata:
        host: ${NODE_NAME}
        matchers:
        - logs_path:
            logs_path: "/var/log/containers/"
```

### 5.3 åŠ¨æ€é…ç½®æ›´æ–°


**ğŸ”„ ConfigMapè‡ªåŠ¨æ›´æ–°**

```yaml
# é…ç½®æ–‡ä»¶ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: filebeat-config
data:
  filebeat.yml: |
    # é…ç½®å†…å®¹
    
---
# DaemonSeté…ç½®
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: filebeat
spec:
  template:
    spec:
      containers:
      - name: filebeat
        image: docker.elastic.co/beats/filebeat:8.10.0
        
        # æŒ‚è½½ConfigMap
        volumeMounts:
        - name: config
          mountPath: /usr/share/filebeat/filebeat.yml
          subPath: filebeat.yml
        
        # ç¯å¢ƒå˜é‡ï¼ˆå¯åŠ¨æ€æ›´æ–°ï¼‰
        env:
        - name: ELASTICSEARCH_HOSTS
          value: "http://elasticsearch:9200"
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
      
      volumes:
      - name: config
        configMap:
          name: filebeat-config
```

**âš¡ é…ç½®çƒ­æ›´æ–°æœºåˆ¶**

```yaml
# åœ¨filebeat.ymlä¸­å¯ç”¨é…ç½®é‡è½½
filebeat.config:
  inputs:
    enabled: true
    path: /usr/share/filebeat/inputs.d/*.yml
    reload.enabled: true
    reload.period: 10s    # æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡é…ç½®å˜åŒ–

# å¯ä»¥æŠŠä¸åŒè¾“å…¥é…ç½®åˆ†ç¦»åˆ°å•ç‹¬æ–‡ä»¶
# inputs.d/web-app.yml
# inputs.d/database.yml  
# inputs.d/cache.yml
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å®¹å™¨åŒ–éƒ¨ç½²ï¼šæŠŠFilebeatè£…è¿›"ç›’å­"ï¼Œæ ‡å‡†åŒ–ã€æ˜“éƒ¨ç½²
ğŸ”¸ èµ„æºé™åˆ¶ï¼šé˜²æ­¢Filebeatå ç”¨è¿‡å¤šç³»ç»Ÿèµ„æº
ğŸ”¸ æ•°æ®æŒä¹…åŒ–ï¼šä¿å­˜é‡è¦ä¿¡æ¯ï¼Œé˜²æ­¢å®¹å™¨é‡å¯ä¸¢å¤±æ•°æ®
ğŸ”¸ æœåŠ¡å‘ç°ï¼šè‡ªåŠ¨æ‰¾åˆ°ç›®æ ‡æœåŠ¡ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®åœ°å€
ğŸ”¸ Sidecaræ¨¡å¼ï¼šæ¯ä¸ªåº”ç”¨é…ä¸€ä¸ªæ—¥å¿—æ”¶é›†åŠ©æ‰‹
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦å®¹å™¨åŒ–Filebeat**
```
ç»Ÿä¸€ç®¡ç†ï¼š
- ç‰ˆæœ¬ä¸€è‡´ï¼šæ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒç‰ˆæœ¬
- é…ç½®æ ‡å‡†ï¼šé¿å…å› ç¯å¢ƒå·®å¼‚å¯¼è‡´çš„é—®é¢˜
- éƒ¨ç½²ç®€å•ï¼šä¸€æ¡å‘½ä»¤å®Œæˆéƒ¨ç½²

å¼¹æ€§ä¼¸ç¼©ï¼š
- å¿«é€Ÿæ‰©å®¹ï¼šæ–°èŠ‚ç‚¹è‡ªåŠ¨éƒ¨ç½²Filebeat
- åŠ¨æ€é€‚åº”ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨è°ƒæ•´èµ„æº
- æ•…éšœæ¢å¤ï¼šå®¹å™¨å¼‚å¸¸è‡ªåŠ¨é‡å¯
```

**ğŸ”¹ èµ„æºé™åˆ¶çš„é‡è¦æ€§**
```
é˜²æ­¢èµ„æºäº‰æŠ¢ï¼š
- CPUé™åˆ¶ï¼šé¿å…å½±å“ä¸»åº”ç”¨æ€§èƒ½
- å†…å­˜é™åˆ¶ï¼šé˜²æ­¢ç³»ç»Ÿå†…å­˜ä¸è¶³
- ç½‘ç»œé™åˆ¶ï¼šæ§åˆ¶æ—¥å¿—ä¼ è¾“é€Ÿåº¦

ç¡®ä¿æœåŠ¡è´¨é‡ï¼š
- èµ„æºé¢„ç•™ï¼šä¿è¯FilebeatåŸºæœ¬è¿è¡Œèµ„æº
- æ€§èƒ½å¯æ§ï¼šé¿å…å› èµ„æºä¸è¶³å¯¼è‡´æ—¥å¿—ä¸¢å¤±
- ç³»ç»Ÿç¨³å®šï¼šç»´æŠ¤æ•´ä½“ç³»ç»Ÿç¨³å®šæ€§
```

**ğŸ”¹ å¾®æœåŠ¡æ—¥å¿—æ”¶é›†ç­–ç•¥**
```
Sidecaræ¨¡å¼ï¼š
- ä¼˜ç‚¹ï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹ï¼Œé…ç½®çµæ´»
- ç¼ºç‚¹ï¼šèµ„æºæ¶ˆè€—å¤šï¼Œç®¡ç†å¤æ‚
- é€‚ç”¨ï¼šå…³é”®æœåŠ¡ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†

DaemonSetæ¨¡å¼ï¼š
- ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡é«˜ï¼Œç»Ÿä¸€ç®¡ç†
- ç¼ºç‚¹ï¼šé…ç½®ç›¸å¯¹å›ºå®š
- é€‚ç”¨ï¼šæ ‡å‡†æ—¥å¿—ï¼Œç»Ÿä¸€æ”¶é›†
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ éƒ¨ç½²å»ºè®®**

| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **é…ç½®è¦ç‚¹** | **æ³¨æ„äº‹é¡¹** |
|----------|-------------|-------------|-------------|
| **å¼€å‘ç¯å¢ƒ** | Docker Compose | èµ„æºé™åˆ¶å®½æ¾ | æ–¹ä¾¿è°ƒè¯• |
| **æµ‹è¯•ç¯å¢ƒ** | Kubernetes DaemonSet | æ¨¡æ‹Ÿç”Ÿäº§é…ç½® | å®Œæ•´æµ‹è¯• |
| **ç”Ÿäº§ç¯å¢ƒ** | Kubernetes + Sidecar | ä¸¥æ ¼èµ„æºé™åˆ¶ | é«˜å¯ç”¨æ€§ |

**ğŸ”§ é…ç½®ä¼˜åŒ–**
```
æ€§èƒ½è°ƒä¼˜ï¼š
1. åˆç†è®¾ç½®æ‰¹é‡å¤§å°ï¼šå¹³è¡¡æ€§èƒ½å’Œèµ„æºä½¿ç”¨
2. é…ç½®é€‚å½“è¶…æ—¶ï¼šé¿å…æ•°æ®ç§¯å‹
3. å¯ç”¨å‹ç¼©ï¼šå‡å°‘ç½‘ç»œä¼ è¾“é‡
4. ç›‘æ§èµ„æºä½¿ç”¨ï¼šåŠæ—¶å‘ç°å¼‚å¸¸

å®‰å…¨é…ç½®ï¼š
1. æœ€å°æƒé™åŸåˆ™ï¼šåªæˆäºˆå¿…è¦æƒé™
2. å®‰å…¨ä¸Šä¸‹æ–‡ï¼šè®¾ç½®érootç”¨æˆ·è¿è¡Œ
3. ç½‘ç»œç­–ç•¥ï¼šé™åˆ¶ä¸å¿…è¦çš„ç½‘ç»œè®¿é—®
4. æ•æ„Ÿä¿¡æ¯ï¼šä½¿ç”¨Secretç®¡ç†å¯†ç 
```

**âš ï¸ å¸¸è§é™·é˜±**
```
å®¹å™¨åŒ–é™·é˜±ï¼š
- å¿˜è®°æŒ‚è½½æ•°æ®ç›®å½•ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±
- èµ„æºé™åˆ¶è¿‡ä¸¥ï¼Œå½±å“æ—¥å¿—æ”¶é›†æ€§èƒ½
- ç½‘ç»œé…ç½®é”™è¯¯ï¼Œæ— æ³•è¿æ¥ç›®æ ‡æœåŠ¡
- æƒé™è®¾ç½®ä¸å½“ï¼Œæ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶

é…ç½®ç®¡ç†é™·é˜±ï¼š
- é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯
- ç¯å¢ƒå˜é‡æ²¡æœ‰æ­£ç¡®ä¼ é€’
- æœåŠ¡å‘ç°é…ç½®é”™è¯¯
- å¤šè¡Œæ—¥å¿—å¤„ç†è§„åˆ™ä¸å‡†ç¡®
```

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
éƒ¨ç½²å®è·µï¼š
1. ä½¿ç”¨å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€
2. é…ç½®å¥åº·æ£€æŸ¥æœºåˆ¶
3. è®¾ç½®åˆç†çš„é‡å¯ç­–ç•¥
4. å®æ–½é…ç½®ç‰ˆæœ¬ç®¡ç†

è¿ç»´å®è·µï¼š
1. ç›‘æ§Filebeatè¿è¡ŒçŠ¶æ€
2. å®šæœŸæ£€æŸ¥æ—¥å¿—æ”¶é›†æƒ…å†µ
3. å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶
4. å»ºç«‹æ•…éšœå¤„ç†æµç¨‹
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å®¹å™¨åŒ–éƒ¨ç½²æ ‡å‡†åŒ–ï¼Œèµ„æºé™åˆ¶è¦åˆç†
- æ•°æ®æŒä¹…é˜²ä¸¢å¤±ï¼ŒæœåŠ¡å‘ç°è‡ªåŠ¨åŒ–
- Sidecaræ¨¡å¼é…åŠ©æ‰‹ï¼Œå¾®æœåŠ¡æ—¥å¿—å…¨è¦†ç›–
- é…ç½®çƒ­æ›´æ–°æ–¹ä¾¿ï¼Œç›‘æ§è¿ç»´ä¿ç¨³å®š