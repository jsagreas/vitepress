---
title: 1ã€é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–
---
## ğŸ“š ç›®å½•


1. [é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–æ¦‚è¿°](#1-é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–æ¦‚è¿°)
2. [é…ç½®æ¨¡æ¿åŒ–è®¾è®¡](#2-é…ç½®æ¨¡æ¿åŒ–è®¾è®¡)
3. [ç¯å¢ƒå˜é‡ç®¡ç†](#3-ç¯å¢ƒå˜é‡ç®¡ç†)
4. [é…ç½®çƒ­é‡è½½æœºåˆ¶](#4-é…ç½®çƒ­é‡è½½æœºåˆ¶)
5. [æ‰¹é‡éƒ¨ç½²ç­–ç•¥](#5-æ‰¹é‡éƒ¨ç½²ç­–ç•¥)
6. [ç‰ˆæœ¬å‡çº§æ–¹æ¡ˆ](#6-ç‰ˆæœ¬å‡çº§æ–¹æ¡ˆ)
7. [é…ç½®ç‰ˆæœ¬æ§åˆ¶](#7-é…ç½®ç‰ˆæœ¬æ§åˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤– é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–æ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–



**ç®€å•ç†è§£**ï¼šå°±åƒç”¨é¥æ§å™¨æ§åˆ¶ç”µè§†ä¸€æ ·ï¼Œé…ç½®ç®¡ç†è‡ªåŠ¨åŒ–è®©æˆ‘ä»¬å¯ä»¥è¿œç¨‹ã€æ‰¹é‡åœ°ç®¡ç†å¤šå°æœåŠ¡å™¨ä¸Šçš„Filebeaté…ç½®ï¼Œè€Œä¸éœ€è¦ä¸€å°å°æ‰‹åŠ¨æ“ä½œã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
ä¼ ç»Ÿæ‰‹åŠ¨æ–¹å¼ï¼š           è‡ªåŠ¨åŒ–æ–¹å¼ï¼š
æœåŠ¡å™¨A â†’ æ‰‹åŠ¨ä¿®æ”¹       ç®¡ç†ä¸­å¿ƒ â†’ ä¸€é”®éƒ¨ç½²
æœåŠ¡å™¨B â†’ æ‰‹åŠ¨ä¿®æ”¹   vs      â†“
æœåŠ¡å™¨C â†’ æ‰‹åŠ¨ä¿®æ”¹       æ‰€æœ‰æœåŠ¡å™¨åŒæ—¶æ›´æ–°
```

**ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨åŒ–**ï¼š
- **æ•ˆç‡æå‡**ï¼šä¸€æ¬¡é…ç½®ï¼Œå¤„å¤„ç”Ÿæ•ˆ
- **å‡å°‘é”™è¯¯**ï¼šé¿å…æ‰‹åŠ¨æ“ä½œçš„ç–æ¼
- **ç»Ÿä¸€ç®¡ç†**ï¼šä¿è¯æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¸€è‡´
- **å¿«é€Ÿå“åº”**ï¼šç´§æ€¥æƒ…å†µä¸‹å¿«é€Ÿè°ƒæ•´

### 1.2 è‡ªåŠ¨åŒ–ç®¡ç†çš„æ ¸å¿ƒä»·å€¼



**ğŸ¯ è§£å†³çš„é—®é¢˜**ï¼š
```
é—®é¢˜1ï¼šé…ç½®ä¸ä¸€è‡´
â€¢ å¼€å‘ç¯å¢ƒé…ç½® â‰  æµ‹è¯•ç¯å¢ƒé…ç½® â‰  ç”Ÿäº§ç¯å¢ƒé…ç½®
â€¢ è§£å†³ï¼šç»Ÿä¸€çš„é…ç½®æ¨¡æ¿å’Œå˜é‡ç®¡ç†

é—®é¢˜2ï¼šå‡çº§å›°éš¾
â€¢ 100å°æœåŠ¡å™¨éœ€è¦é€ä¸€å‡çº§é…ç½®
â€¢ è§£å†³ï¼šæ‰¹é‡éƒ¨ç½²å’Œç‰ˆæœ¬æ§åˆ¶

é—®é¢˜3ï¼šå˜æ›´é£é™©
â€¢ æ‰‹åŠ¨ä¿®æ”¹å®¹æ˜“å‡ºé”™ï¼Œå½±å“ä¸šåŠ¡
â€¢ è§£å†³ï¼šé…ç½®éªŒè¯å’Œå›æ»šæœºåˆ¶
```

### 1.3 è‡ªåŠ¨åŒ–ç®¡ç†æ¶æ„



```
é…ç½®ç®¡ç†ä¸­å¿ƒæ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®ç®¡ç†å°     â”‚ â† ç»Ÿä¸€ç®¡ç†ç•Œé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¨¡æ¿å¼•æ“      â”‚ â† é…ç½®æ¨¡æ¿å¤„ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç‰ˆæœ¬æ§åˆ¶      â”‚ â† Git/SVNç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   éƒ¨ç½²å¼•æ“      â”‚ â† è‡ªåŠ¨åŒ–éƒ¨ç½²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç›®æ ‡æœåŠ¡å™¨ç¾¤ç»„        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚FB-1 â”‚ â”‚FB-2 â”‚ â”‚FB-3 â”‚â”‚ â† Filebeatå®ä¾‹
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“‹ é…ç½®æ¨¡æ¿åŒ–è®¾è®¡



### 2.1 ä»€ä¹ˆæ˜¯é…ç½®æ¨¡æ¿



**é€šä¿—è§£é‡Š**ï¼šé…ç½®æ¨¡æ¿å°±åƒåšèœçš„é£Ÿè°±ï¼Œé‡Œé¢æœ‰å›ºå®šçš„æ­¥éª¤å’Œå¯å˜çš„è°ƒæ–™ã€‚ä¸åŒç¯å¢ƒåªéœ€è¦è°ƒæ•´"è°ƒæ–™"ï¼ˆå˜é‡ï¼‰ï¼Œ"æ­¥éª¤"ï¼ˆåŸºæœ¬é…ç½®ï¼‰ä¿æŒä¸å˜ã€‚

**æ¨¡æ¿åŒ–åŸç†**ï¼š
```
åŸºç¡€æ¨¡æ¿ + ç¯å¢ƒå˜é‡ = æœ€ç»ˆé…ç½®

ä¾‹å¦‚ï¼š
æ¨¡æ¿ï¼šæ—¥å¿—è·¯å¾„ = ${LOG_PATH}/*.log
å˜é‡ï¼šLOG_PATH = /var/log/app
ç»“æœï¼šæ—¥å¿—è·¯å¾„ = /var/log/app/*.log
```

### 2.2 Filebeaté…ç½®æ¨¡æ¿è®¾è®¡



**ğŸ”§ åŸºç¡€æ¨¡æ¿ç»“æ„**ï¼š
```yaml
# filebeat-template.yml

filebeat.inputs:
- type: log
  enabled: true
  paths:
    - ${LOG_PATH}/${APP_NAME}/*.log
  fields:
    env: ${ENVIRONMENT}
    app: ${APP_NAME}
    datacenter: ${DATACENTER}

output.elasticsearch:
  hosts: ${ES_HOSTS}
  username: ${ES_USERNAME}
  password: ${ES_PASSWORD}
  index: "${APP_NAME}-${ENVIRONMENT}-%{+yyyy.MM.dd}"

logging.level: ${LOG_LEVEL}
logging.to_files: true
logging.files:
  path: ${FILEBEAT_LOG_PATH}
  keepfiles: ${KEEP_FILES}
```

**ğŸ“ å˜é‡å®šä¹‰æ–‡ä»¶**ï¼š
```yaml
# variables-production.yml

LOG_PATH: "/var/log"
APP_NAME: "webserver"
ENVIRONMENT: "production"
DATACENTER: "dc01"
ES_HOSTS: '["elasticsearch-prod-1:9200", "elasticsearch-prod-2:9200"]'
ES_USERNAME: "filebeat_user"
ES_PASSWORD: "${ELASTIC_PASSWORD}"
LOG_LEVEL: "info"
FILEBEAT_LOG_PATH: "/var/log/filebeat"
KEEP_FILES: 7
```

### 2.3 æ¨¡æ¿åˆ†å±‚è®¾è®¡



**ğŸ“š åˆ†å±‚æ¨¡æ¿æ¶æ„**ï¼š
```
å…¨å±€åŸºç¡€æ¨¡æ¿ (base.yml)
    â†“
ç¯å¢ƒæ¨¡æ¿ (prod.yml, test.yml)
    â†“
åº”ç”¨ç‰¹å®šæ¨¡æ¿ (app-specific.yml)
    â†“
æœ€ç»ˆé…ç½®æ–‡ä»¶
```

**å®è·µç¤ºä¾‹**ï¼š
```yaml
# base.yml - å…¨å±€åŸºç¡€æ¨¡æ¿

filebeat.inputs: []  # ç”±å…·ä½“æ¨¡æ¿å®šä¹‰
output.elasticsearch:
  hosts: ${ES_HOSTS}
  template.enabled: false
logging.level: ${LOG_LEVEL:-info}

# app-webserver.yml - åº”ç”¨ç‰¹å®šæ¨¡æ¿

filebeat.inputs:
- type: log
  enabled: true
  paths: ["${LOG_PATH}/nginx/*.log"]
  multiline.pattern: '^\d{4}-\d{2}-\d{2}'
  multiline.negate: true
  multiline.match: after

# env-production.yml - ç¯å¢ƒç‰¹å®šé…ç½®

ES_HOSTS: '["es-prod-1:9200", "es-prod-2:9200"]'
LOG_LEVEL: "warn"
```

### 2.4 æ¨¡æ¿æ¸²æŸ“å·¥å…·



**ğŸ› ï¸ å¸¸ç”¨æ¨¡æ¿å¼•æ“**ï¼š

| å·¥å…· | **ä¼˜åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|
| **Jinja2** | `Pythonç”Ÿæ€ï¼ŒåŠŸèƒ½å¼ºå¤§` | `å¤æ‚é€»è¾‘å¤„ç†` |
| **Mustache** | `è¯­è¨€æ— å…³ï¼Œç®€å•æ˜“ç”¨` | `ç®€å•å˜é‡æ›¿æ¢` |
| **Ansible** | `é›†æˆéƒ¨ç½²åŠŸèƒ½` | `æ•´ä½“è‡ªåŠ¨åŒ–æ–¹æ¡ˆ` |
| **Helm** | `KubernetesåŸç”Ÿ` | `å®¹å™¨åŒ–éƒ¨ç½²` |

---

## 3. ğŸŒ ç¯å¢ƒå˜é‡ç®¡ç†



### 3.1 ç¯å¢ƒå˜é‡ç®¡ç†ç­–ç•¥



**ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡ç®¡ç†**ï¼šå°±åƒç»™ä¸åŒçš„æ¼”å‘˜åˆ†é…ä¸åŒçš„å°è¯ï¼ŒåŒä¸€ä¸ªå‰§æœ¬ï¼ˆé…ç½®æ¨¡æ¿ï¼‰åœ¨ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ä¸­ä½¿ç”¨ä¸åŒçš„å˜é‡å€¼ã€‚

**ğŸ“Š ç¯å¢ƒå˜é‡åˆ†ç±»**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å…¨å±€å˜é‡      â”‚ â† æ‰€æœ‰ç¯å¢ƒé€šç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç¯å¢ƒå˜é‡      â”‚ â† ç¯å¢ƒç‰¹å®šï¼ˆprod/test/devï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨å˜é‡      â”‚ â† åº”ç”¨ç‰¹å®š
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•æ„Ÿå˜é‡      â”‚ â† å¯†ç ã€å¯†é’¥ç­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å˜é‡å‘½åè§„èŒƒ



**ğŸ·ï¸ å‘½åçº¦å®š**ï¼š
```bash
# ç¯å¢ƒå‰ç¼€

PROD_ES_HOST="prod-elasticsearch.company.com"
TEST_ES_HOST="test-elasticsearch.company.com"
DEV_ES_HOST="localhost"

# ç»„ä»¶å‰ç¼€

FILEBEAT_LOG_LEVEL="info"
FILEBEAT_LOG_PATH="/var/log/filebeat"
ELASTIC_USERNAME="filebeat_user"
ELASTIC_PASSWORD="secure_password"

# åˆ†å±‚å‘½å

APP_WEBSERVER_LOG_PATH="/var/log/nginx"
APP_DATABASE_LOG_PATH="/var/log/mysql"
```

### 3.3 å˜é‡å­˜å‚¨æ–¹æ¡ˆ



**ğŸ” å®‰å…¨å­˜å‚¨ç­–ç•¥**ï¼š

**æ™®é€šå˜é‡å­˜å‚¨**ï¼š
```bash
# é…ç½®æ–‡ä»¶æ–¹å¼

# config/production.env

LOG_LEVEL=info
DATACENTER=dc01
KEEP_FILES=7

# æ•°æ®åº“æ–¹å¼

mysql> SELECT * FROM config_variables WHERE env='production';
+----------+-------+----------+
| env      | key   | value    |
+----------+-------+----------+
| production| LOG_LEVEL | info |
+----------+-------+----------+
```

**æ•æ„Ÿå˜é‡å­˜å‚¨**ï¼š
```bash
# ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡

# HashiCorp Vault

vault kv put secret/filebeat/prod \
  elastic_password="super_secure_pwd" \
  api_key="abc123xyz"

# AWS SSM Parameter Store

aws ssm put-parameter \
  --name "/filebeat/prod/elastic_password" \
  --value "super_secure_pwd" \
  --type "SecureString"
```

### 3.4 å˜é‡æ³¨å…¥æœºåˆ¶



**ğŸš€ è¿è¡Œæ—¶å˜é‡æ³¨å…¥**ï¼š
```bash
# æ–¹å¼1ï¼šç¯å¢ƒå˜é‡æ³¨å…¥

export ELASTIC_HOST="prod-es.company.com"
export ELASTIC_PASSWORD="$(vault kv get -field=password secret/filebeat/prod)"
filebeat -e -c filebeat.yml

# æ–¹å¼2ï¼šé…ç½®æ–‡ä»¶é¢„å¤„ç†

envsubst < filebeat-template.yml > filebeat.yml
systemctl restart filebeat

# æ–¹å¼3ï¼šå¯åŠ¨è„šæœ¬æ³¨å…¥

#!/bin/bash

# start-filebeat.sh

source /etc/filebeat/environments/${ENVIRONMENT}.env
eval "echo \"$(cat /etc/filebeat/templates/filebeat.yml.template)\"" > /etc/filebeat/filebeat.yml
systemctl start filebeat
```

---

## 4. ğŸ”„ é…ç½®çƒ­é‡è½½æœºåˆ¶



### 4.1 ä»€ä¹ˆæ˜¯é…ç½®çƒ­é‡è½½



**é€šä¿—ç†è§£**ï¼šå°±åƒè°ƒèŠ‚ç©ºè°ƒæ¸©åº¦ä¸€æ ·ï¼Œä¸éœ€è¦å…³é—­ç©ºè°ƒé‡å¯ï¼Œç›´æ¥è°ƒèŠ‚å°±èƒ½ç”Ÿæ•ˆã€‚é…ç½®çƒ­é‡è½½è®©Filebeatåœ¨ä¸åœæ­¢æœåŠ¡çš„æƒ…å†µä¸‹åº”ç”¨æ–°é…ç½®ã€‚

**çƒ­é‡è½½çš„å¥½å¤„**ï¼š
- **é›¶åœæœºæ—¶é—´**ï¼šæœåŠ¡æŒç»­è¿è¡Œ
- **å®æ—¶ç”Ÿæ•ˆ**ï¼šé…ç½®å˜æ›´ç«‹å³åº”ç”¨
- **é™ä½é£é™©**ï¼šé¿å…é‡å¯å¸¦æ¥çš„æœåŠ¡ä¸­æ–­

### 4.2 Filebeatçƒ­é‡è½½æœºåˆ¶



**ğŸ”„ çƒ­é‡è½½è§¦å‘æ–¹å¼**ï¼š
```bash
# æ–¹å¼1ï¼šä¿¡å·è§¦å‘

kill -HUP $(pidof filebeat)

# æ–¹å¼2ï¼šAPIè§¦å‘

curl -X POST "localhost:5066/reload"

# æ–¹å¼3ï¼šæ–‡ä»¶ç›‘æ§è§¦å‘

# filebeat.yml

filebeat.config.inputs:
  enabled: true
  path: configs/*.yml
  reload.enabled: true
  reload.period: 10s
```

**ğŸ“‹ æ”¯æŒçƒ­é‡è½½çš„é…ç½®é¡¹**ï¼š
```yaml
# æ”¯æŒçƒ­é‡è½½

filebeat.inputs: []        # âœ… è¾“å…¥é…ç½®
processors: []             # âœ… å¤„ç†å™¨é…ç½®
fields: {}                # âœ… å­—æ®µé…ç½®

# ä¸æ”¯æŒçƒ­é‡è½½ï¼ˆéœ€è¦é‡å¯ï¼‰

output.elasticsearch: {}   # âŒ è¾“å‡ºé…ç½®
logging: {}               # âŒ æ—¥å¿—é…ç½®
http.enabled: true        # âŒ HTTP APIé…ç½®
```

### 4.3 é…ç½®å˜æ›´æ£€æµ‹



**ğŸ“Š å˜æ›´æ£€æµ‹æœºåˆ¶**ï¼š
```
æ–‡ä»¶ç›‘æ§æ–¹å¼ï¼š
    é…ç½®æ–‡ä»¶ â†’ inotifyç›‘æ§ â†’ å˜æ›´æ£€æµ‹ â†’ è‡ªåŠ¨é‡è½½

APIè½®è¯¢æ–¹å¼ï¼š
    å®šæ—¶ä»»åŠ¡ â†’ æ£€æŸ¥é…ç½®API â†’ å¯¹æ¯”ç‰ˆæœ¬ â†’ è§¦å‘é‡è½½

Gité’©å­æ–¹å¼ï¼š
    Git Push â†’ Webhook â†’ é…ç½®æ›´æ–° â†’ é‡è½½è§¦å‘
```

**å®ç°ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash

# config-monitor.sh

CONFIG_FILE="/etc/filebeat/filebeat.yml"
LAST_MODIFIED=$(stat -c %Y "$CONFIG_FILE")

while true; do
    CURRENT_MODIFIED=$(stat -c %Y "$CONFIG_FILE")
    if [ "$CURRENT_MODIFIED" -gt "$LAST_MODIFIED" ]; then
        echo "é…ç½®æ–‡ä»¶å·²ä¿®æ”¹ï¼Œè§¦å‘é‡è½½..."
        curl -X POST "localhost:5066/reload"
        LAST_MODIFIED=$CURRENT_MODIFIED
    fi
    sleep 5
done
```

### 4.4 é‡è½½å¤±è´¥å¤„ç†



**âš ï¸ é‡è½½å¤±è´¥çš„åº”å¯¹ç­–ç•¥**ï¼š
```yaml
# é…ç½®éªŒè¯

filebeat.config.inputs:
  reload.enabled: true
  reload.period: 30s
  reload.check_config: true  # éªŒè¯é…ç½®æ­£ç¡®æ€§

# é‡è½½å¤±è´¥æ—¶çš„å¤„ç†

# 1. ä¿æŒåŸé…ç½®ç»§ç»­è¿è¡Œ


# 2. è®°å½•é”™è¯¯æ—¥å¿—


# 3. å‘é€å‘Šè­¦é€šçŸ¥


```

**é”™è¯¯å¤„ç†æµç¨‹**ï¼š
```
é…ç½®å˜æ›´ â†’ è¯­æ³•éªŒè¯ â†’ é€»è¾‘éªŒè¯ â†’ åº”ç”¨é…ç½®
     â†“           â†“          â†“         â†“
   å¤±è´¥        å¤±è´¥       å¤±è´¥      æˆåŠŸ
     â†“           â†“          â†“         â†“
  æ ¼å¼é”™è¯¯   â†’ é…ç½®é”™è¯¯ â†’ æœåŠ¡å¼‚å¸¸ â†’ æ­£å¸¸è¿è¡Œ
     â†“           â†“          â†“
  å›æ»šé…ç½® â†’ å›æ»šé…ç½® â†’ å›æ»šé…ç½®
```

---

## 5. ğŸš€ æ‰¹é‡éƒ¨ç½²ç­–ç•¥



### 5.1 æ‰¹é‡éƒ¨ç½²æ¦‚è¿°



**ä»€ä¹ˆæ˜¯æ‰¹é‡éƒ¨ç½²**ï¼šå°±åƒå‘ç¾¤å‘çŸ­ä¿¡ä¸€æ ·ï¼Œä¸€æ¬¡æ“ä½œå¯ä»¥å‘å¤šä¸ªç›®æ ‡åŒæ—¶å‘é€å†…å®¹ã€‚æ‰¹é‡éƒ¨ç½²è®©æˆ‘ä»¬èƒ½åŒæ—¶æ›´æ–°å‡ åå°ç”šè‡³ä¸Šç™¾å°æœåŠ¡å™¨çš„Filebeaté…ç½®ã€‚

**ğŸ¯ æ‰¹é‡éƒ¨ç½²çš„æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **æ—¶é—´æ•ˆç‡**ï¼šå‡ åˆ†é’Ÿå®Œæˆå‡ ç™¾å°æœåŠ¡å™¨çš„é…ç½®æ›´æ–°
- **ä¸€è‡´æ€§ä¿è¯**ï¼šæ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„é…ç½®
- **æ“ä½œç®€åŒ–**ï¼šä¸€ä¸ªå‘½ä»¤æ›¿ä»£é‡å¤æ‰‹å·¥æ“ä½œ

### 5.2 éƒ¨ç½²ç­–ç•¥åˆ†ç±»



**ğŸ“Š å¸¸è§éƒ¨ç½²ç­–ç•¥å¯¹æ¯”**ï¼š

| ç­–ç•¥ç±»å‹ | **ç‰¹ç‚¹** | **ä¼˜åŠ¿** | **é£é™©** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|---------|-------------|
| **å…¨é‡éƒ¨ç½²** | `ä¸€æ¬¡æ€§å…¨éƒ¨æ›´æ–°` | `é€Ÿåº¦å¿«ï¼Œç®€å•` | `å½±å“é¢å¤§` | `é…ç½®ä¿®å¤ï¼Œç´§æ€¥æ›´æ–°` |
| **ç°åº¦éƒ¨ç½²** | `åˆ†æ‰¹æ¬¡é€æ­¥æ¨å¹¿` | `é£é™©å¯æ§` | `è€—æ—¶è¾ƒé•¿` | `æ–°åŠŸèƒ½ä¸Šçº¿` |
| **è“ç»¿éƒ¨ç½²** | `åŒç¯å¢ƒåˆ‡æ¢` | `é›¶åœæœºï¼Œå¯å¿«é€Ÿå›æ»š` | `èµ„æºæ¶ˆè€—å¤§` | `é‡è¦ä¸šåŠ¡ç³»ç»Ÿ` |
| **æ»šåŠ¨éƒ¨ç½²** | `é€å°æ›´æ–°` | `å¹³æ»‘è¿‡æ¸¡` | `éƒ¨ç½²æ—¶é—´é•¿` | `é«˜å¯ç”¨è¦æ±‚` |

### 5.3 æ‰¹é‡éƒ¨ç½²å·¥å…·é€‰æ‹©



**ğŸ› ï¸ ä¸»æµæ‰¹é‡éƒ¨ç½²å·¥å…·**ï¼š

**Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼š
```yaml
# ansible-playbook.yml

- hosts: filebeat_servers
  become: yes
  vars:
    filebeat_version: "7.15.0"
    config_source: "templates/filebeat.yml.j2"
  
  tasks:
    - name: åœæ­¢FilebeatæœåŠ¡
      systemd:
        name: filebeat
        state: stopped
    
    - name: å¤‡ä»½å½“å‰é…ç½®
      copy:
        src: /etc/filebeat/filebeat.yml
        dest: /etc/filebeat/filebeat.yml.backup
        remote_src: yes
    
    - name: éƒ¨ç½²æ–°é…ç½®
      template:
        src: "{{ config_source }}"
        dest: /etc/filebeat/filebeat.yml
        backup: yes
        validate: 'filebeat test config -c %s'
    
    - name: å¯åŠ¨FilebeatæœåŠ¡
      systemd:
        name: filebeat
        state: started
        enabled: yes
```

**SaltStacké…ç½®ç®¡ç†**ï¼š
```yaml
# salt/filebeat/init.sls

filebeat_config:
  file.managed:
    - name: /etc/filebeat/filebeat.yml
    - source: salt://filebeat/files/filebeat.yml.jinja
    - template: jinja
    - context:
        env: {{ grains['env'] }}
        datacenter: {{ grains['datacenter'] }}
    - require:
      - pkg: filebeat

filebeat_service:
  service.running:
    - name: filebeat
    - enable: True
    - watch:
      - file: filebeat_config
```

### 5.4 åˆ†æ‰¹éƒ¨ç½²å®è·µ



**ğŸ¯ ç°åº¦éƒ¨ç½²ç­–ç•¥**ï¼š
```
é˜¶æ®µ1ï¼šé‡‘ä¸é›€éƒ¨ç½²ï¼ˆ1-2å°ï¼‰
    â†“ éªŒè¯æ— é—®é¢˜
é˜¶æ®µ2ï¼šå°æ‰¹é‡éƒ¨ç½²ï¼ˆ10%èŠ‚ç‚¹ï¼‰
    â†“ ç›‘æ§è¿è¡ŒçŠ¶æ€
é˜¶æ®µ3ï¼šå¤§æ‰¹é‡éƒ¨ç½²ï¼ˆ50%èŠ‚ç‚¹ï¼‰
    â†“ ç¡®è®¤ç¨³å®šæ€§
é˜¶æ®µ4ï¼šå…¨é‡éƒ¨ç½²ï¼ˆ100%èŠ‚ç‚¹ï¼‰
```

**å®ç°è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash

# gradual-deploy.sh


SERVERS_FILE="servers.txt"
BATCH_SIZE=5
DELAY_BETWEEN_BATCHES=60

# è¯»å–æœåŠ¡å™¨åˆ—è¡¨

mapfile -t SERVERS < "$SERVERS_FILE"
TOTAL_SERVERS=${#SERVERS[@]}

echo "å¼€å§‹åˆ†æ‰¹éƒ¨ç½²ï¼Œå…± $TOTAL_SERVERS å°æœåŠ¡å™¨ï¼Œæ¯æ‰¹ $BATCH_SIZE å°"

for ((i=0; i<$TOTAL_SERVERS; i+=$BATCH_SIZE)); do
    BATCH_SERVERS=("${SERVERS[@]:$i:$BATCH_SIZE}")
    BATCH_NUM=$((i/$BATCH_SIZE + 1))
    
    echo "éƒ¨ç½²ç¬¬ $BATCH_NUM æ‰¹æœåŠ¡å™¨: ${BATCH_SERVERS[*]}"
    
#    # å¹¶è¡Œéƒ¨ç½²å½“å‰æ‰¹æ¬¡
    for server in "${BATCH_SERVERS[@]}"; do
        (
            echo "éƒ¨ç½² $server..."
            ansible-playbook -l "$server" deploy-filebeat.yml
            echo "$server éƒ¨ç½²å®Œæˆ"
        ) &
    done
    
#    # ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
    wait
    echo "ç¬¬ $BATCH_NUM æ‰¹éƒ¨ç½²å®Œæˆï¼Œç­‰å¾… $DELAY_BETWEEN_BATCHES ç§’..."
    sleep $DELAY_BETWEEN_BATCHES
done

echo "æ‰€æœ‰æœåŠ¡å™¨éƒ¨ç½²å®Œæˆï¼"
```

### 5.5 éƒ¨ç½²éªŒè¯ä¸å›æ»š



**âœ… éƒ¨ç½²åéªŒè¯**ï¼š
```bash
# éªŒè¯è„šæœ¬

#!/bin/bash

# verify-deployment.sh


verify_server() {
    local server=$1
    echo "éªŒè¯æœåŠ¡å™¨: $server"
    
#    # æ£€æŸ¥æœåŠ¡çŠ¶æ€
    if ssh "$server" "systemctl is-active filebeat" | grep -q "active"; then
        echo "âœ… $server: FilebeatæœåŠ¡è¿è¡Œæ­£å¸¸"
    else
        echo "âŒ $server: FilebeatæœåŠ¡å¼‚å¸¸"
        return 1
    fi
    
#    # æ£€æŸ¥æ—¥å¿—è¾“å‡º
    if ssh "$server" "tail -n 10 /var/log/filebeat/filebeat.log" | grep -q "INFO"; then
        echo "âœ… $server: æ—¥å¿—è¾“å‡ºæ­£å¸¸"
    else
        echo "âŒ $server: æ—¥å¿—è¾“å‡ºå¼‚å¸¸"
        return 1
    fi
    
    return 0
}

# æ‰¹é‡éªŒè¯

while read -r server; do
    if ! verify_server "$server"; then
        echo "æœåŠ¡å™¨ $server éªŒè¯å¤±è´¥ï¼Œè€ƒè™‘å›æ»š"
#        # è§¦å‘å›æ»šé€»è¾‘
    fi
done < servers.txt
```

---

## 6. ğŸ“ˆ ç‰ˆæœ¬å‡çº§æ–¹æ¡ˆ



### 6.1 ç‰ˆæœ¬å‡çº§ç­–ç•¥



**ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å‡çº§**ï¼šå°±åƒæ‰‹æœºç³»ç»Ÿå‡çº§ä¸€æ ·ï¼ŒFilebeatä¹Ÿä¼šå‘å¸ƒæ–°ç‰ˆæœ¬æ¥ä¿®å¤é—®é¢˜å’Œå¢åŠ åŠŸèƒ½ã€‚åˆç†çš„å‡çº§ç­–ç•¥ç¡®ä¿ä¸šåŠ¡ä¸å—å½±å“ã€‚

**ğŸ”„ å‡çº§ç±»å‹åˆ†ç±»**ï¼š
```
å°ç‰ˆæœ¬å‡çº§ (7.15.1 â†’ 7.15.2)
â€¢ ä¸»è¦æ˜¯Bugä¿®å¤
â€¢ é£é™©è¾ƒä½ï¼Œå¯ä»¥å¿«é€Ÿå‡çº§

å¤§ç‰ˆæœ¬å‡çº§ (7.x â†’ 8.x)
â€¢ å¯èƒ½æœ‰ç ´åæ€§å˜æ›´
â€¢ éœ€è¦è°¨æ…æµ‹è¯•å’Œåˆ†é˜¶æ®µå‡çº§
```

### 6.2 å‡çº§å‰å‡†å¤‡å·¥ä½œ



**ğŸ“‹ å‡çº§æ£€æŸ¥æ¸…å•**ï¼š
```
â–¡ å¤‡ä»½å½“å‰é…ç½®æ–‡ä»¶
â–¡ è®°å½•å½“å‰ç‰ˆæœ¬å·
â–¡ æ£€æŸ¥æ–°ç‰ˆæœ¬å…¼å®¹æ€§
â–¡ å‡†å¤‡å›æ»šæ–¹æ¡ˆ
â–¡ é€šçŸ¥ç›¸å…³å›¢é˜Ÿ
â–¡ é€‰æ‹©ç»´æŠ¤çª—å£
```

**å…¼å®¹æ€§æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥å½“å‰ç‰ˆæœ¬

filebeat version

# æŸ¥çœ‹é…ç½®å…¼å®¹æ€§

filebeat test config -c /etc/filebeat/filebeat.yml

# æ£€æŸ¥ä¾èµ–ç»„ä»¶ç‰ˆæœ¬

curl -X GET "elasticsearch:9200/"
```

### 6.3 å‡çº§æ‰§è¡Œæµç¨‹



**ğŸ¯ æ ‡å‡†å‡çº§æµç¨‹**ï¼š
```
1. æµ‹è¯•ç¯å¢ƒéªŒè¯
     â†“
2. ç”Ÿäº§ç¯å¢ƒå°æ‰¹é‡è¯•ç‚¹
     â†“
3. ç›‘æ§è¿è¡ŒçŠ¶æ€ï¼ˆ24å°æ—¶ï¼‰
     â†“
4. å…¨é‡å‡çº§æ¨å¹¿
     â†“
5. å‡çº§åéªŒè¯
```

**è‡ªåŠ¨åŒ–å‡çº§è„šæœ¬**ï¼š
```bash
#!/bin/bash

# upgrade-filebeat.sh


OLD_VERSION=$(filebeat version | grep -oP 'version \K[0-9.]+')
NEW_VERSION="8.5.0"
BACKUP_DIR="/opt/backups/filebeat-$OLD_VERSION-$(date +%Y%m%d)"

echo "å¼€å§‹å‡çº§ Filebeat: $OLD_VERSION â†’ $NEW_VERSION"

# 1. åˆ›å»ºå¤‡ä»½

mkdir -p "$BACKUP_DIR"
cp -r /etc/filebeat "$BACKUP_DIR/"
systemctl stop filebeat

# 2. ä¸‹è½½æ–°ç‰ˆæœ¬

wget "https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-$NEW_VERSION-linux-x86_64.tar.gz"
tar -xzf "filebeat-$NEW_VERSION-linux-x86_64.tar.gz"

# 3. å®‰è£…æ–°ç‰ˆæœ¬

cp "filebeat-$NEW_VERSION-linux-x86_64/filebeat" /usr/bin/
chmod +x /usr/bin/filebeat

# 4. éªŒè¯é…ç½®å…¼å®¹æ€§

if filebeat test config -c /etc/filebeat/filebeat.yml; then
    echo "âœ… é…ç½®éªŒè¯é€šè¿‡"
else
    echo "âŒ é…ç½®éªŒè¯å¤±è´¥ï¼Œå¼€å§‹å›æ»š"
    cp "$BACKUP_DIR/filebeat" /usr/bin/
    exit 1
fi

# 5. å¯åŠ¨æ–°ç‰ˆæœ¬

systemctl start filebeat
systemctl enable filebeat

# 6. éªŒè¯è¿è¡ŒçŠ¶æ€

sleep 10
if systemctl is-active filebeat | grep -q "active"; then
    echo "âœ… å‡çº§æˆåŠŸï¼ŒFilebeat $NEW_VERSION è¿è¡Œæ­£å¸¸"
else
    echo "âŒ å‡çº§å¤±è´¥ï¼ŒæœåŠ¡å¯åŠ¨å¼‚å¸¸"
    exit 1
fi
```

### 6.4 å‡çº§å›æ»šæœºåˆ¶



**ğŸ”™ å›æ»šç­–ç•¥**ï¼š
```
å¿«é€Ÿå›æ»šï¼ˆ5åˆ†é’Ÿå†…ï¼‰ï¼š
â€¢ åœæ­¢æ–°ç‰ˆæœ¬æœåŠ¡
â€¢ æ¢å¤æ—§ç‰ˆæœ¬äºŒè¿›åˆ¶æ–‡ä»¶
â€¢ æ¢å¤æ—§ç‰ˆæœ¬é…ç½®
â€¢ å¯åŠ¨æœåŠ¡éªŒè¯

å®Œæ•´å›æ»šï¼ˆ30åˆ†é’Ÿå†…ï¼‰ï¼š
â€¢ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
â€¢ ç´¢å¼•æ¨¡æ¿å›æ»š
â€¢ ç®¡é“é…ç½®å›æ»š
â€¢ ç›‘æ§é…ç½®å›æ»š
```

**è‡ªåŠ¨å›æ»šè„šæœ¬**ï¼š
```bash
#!/bin/bash

# rollback-filebeat.sh


BACKUP_DIR="$1"
if [ -z "$BACKUP_DIR" ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 <backup_directory>"
    exit 1
fi

echo "å¼€å§‹å›æ»š Filebeat åˆ°å¤‡ä»½ç‰ˆæœ¬"

# 1. åœæ­¢å½“å‰æœåŠ¡

systemctl stop filebeat

# 2. æ¢å¤äºŒè¿›åˆ¶æ–‡ä»¶

if [ -f "$BACKUP_DIR/filebeat" ]; then
    cp "$BACKUP_DIR/filebeat" /usr/bin/
    chmod +x /usr/bin/filebeat
    echo "âœ… äºŒè¿›åˆ¶æ–‡ä»¶å·²å›æ»š"
fi

# 3. æ¢å¤é…ç½®æ–‡ä»¶

if [ -d "$BACKUP_DIR/filebeat" ]; then
    cp -r "$BACKUP_DIR/filebeat"/* /etc/filebeat/
    echo "âœ… é…ç½®æ–‡ä»¶å·²å›æ»š"
fi

# 4. å¯åŠ¨æœåŠ¡

systemctl start filebeat

# 5. éªŒè¯å›æ»šç»“æœ

sleep 5
if systemctl is-active filebeat | grep -q "active"; then
    echo "âœ… å›æ»šæˆåŠŸï¼ŒæœåŠ¡è¿è¡Œæ­£å¸¸"
    filebeat version
else
    echo "âŒ å›æ»šå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥"
    exit 1
fi
```

---

## 7. ğŸ“ é…ç½®ç‰ˆæœ¬æ§åˆ¶



### 7.1 ç‰ˆæœ¬æ§åˆ¶çš„é‡è¦æ€§



**ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶**ï¼šå°±åƒå†™æ–‡æ¡£éœ€è¦ä¿å­˜å†å²ç‰ˆæœ¬ä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶è®©æˆ‘ä»¬èƒ½è¿½è¸ªæ¯æ¬¡å˜æ›´ã€æ¯”è¾ƒå·®å¼‚ã€å›æ»šåˆ°ä»»æ„å†å²ç‰ˆæœ¬ã€‚

**ğŸ¯ ç‰ˆæœ¬æ§åˆ¶çš„æ ¸å¿ƒä»·å€¼**ï¼š
- **å˜æ›´è¿½è¸ª**ï¼šè°åœ¨ä»€ä¹ˆæ—¶å€™ä¿®æ”¹äº†ä»€ä¹ˆ
- **å·®å¼‚å¯¹æ¯”**ï¼šæ–°æ—§é…ç½®çš„å…·ä½“å·®å¼‚
- **å›æ»šèƒ½åŠ›**ï¼šå¿«é€Ÿæ¢å¤åˆ°ä»»æ„å†å²ç‰ˆæœ¬
- **åä½œç®¡ç†**ï¼šå¤šäººåä½œæ—¶é¿å…å†²çª

### 7.2 Gité…ç½®ç®¡ç†å®è·µ



**ğŸ“ é…ç½®ä»“åº“ç»“æ„è®¾è®¡**ï¼š
```
filebeat-configs/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ production/
â”‚   â”‚   â”œâ”€â”€ filebeat.yml
â”‚   â”‚   â””â”€â”€ variables.env
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â”œâ”€â”€ filebeat.yml
â”‚   â”‚   â””â”€â”€ variables.env
â”‚   â””â”€â”€ development/
â”‚       â”œâ”€â”€ filebeat.yml
â”‚       â””â”€â”€ variables.env
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.yml.j2
â”‚   â”œâ”€â”€ web-server.yml.j2
â”‚   â””â”€â”€ database.yml.j2
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â”œâ”€â”€ validate.sh
â”‚   â””â”€â”€ rollback.sh
â””â”€â”€ docs/
    â”œâ”€â”€ CHANGELOG.md
    â””â”€â”€ deployment-guide.md
```

**ğŸ”„ é…ç½®å˜æ›´å·¥ä½œæµ**ï¼š
```
å¼€å‘ä¿®æ”¹é…ç½®
      â†“
åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (feature/update-logging)
      â†“
æäº¤å˜æ›´å¹¶æ¨é€
      â†“
åˆ›å»ºåˆå¹¶è¯·æ±‚ (Merge Request)
      â†“
ä»£ç å®¡æŸ¥ (Code Review)
      â†“
åˆå¹¶åˆ°ä¸»åˆ†æ”¯ (main)
      â†“
è‡ªåŠ¨éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒ
```

### 7.3 é…ç½®å˜æ›´å®¡æ ¸æµç¨‹



**ğŸ‘¥ å®¡æ ¸æµç¨‹è®¾è®¡**ï¼š
```yaml
# .gitlab-ci.yml

stages:
  - validate
  - review
  - deploy

validate_config:
  stage: validate
  script:
    - filebeat test config -c environments/production/filebeat.yml
    - ./scripts/validate.sh
  only:
    - merge_requests

deploy_staging:
  stage: deploy
  script:
    - ./scripts/deploy.sh staging
  only:
    - main
  environment:
    name: staging

deploy_production:
  stage: deploy
  script:
    - ./scripts/deploy.sh production
  only:
    - main
  when: manual  # éœ€è¦æ‰‹åŠ¨è§¦å‘
  environment:
    name: production
```

**ğŸ“‹ å˜æ›´å®¡æ ¸æ£€æŸ¥é¡¹**ï¼š
```
è¯­æ³•æ£€æŸ¥ï¼š
â–¡ YAMLè¯­æ³•æ˜¯å¦æ­£ç¡®
â–¡ Filebeaté…ç½®æ˜¯å¦æœ‰æ•ˆ
â–¡ å˜é‡å¼•ç”¨æ˜¯å¦å®Œæ•´

é€»è¾‘æ£€æŸ¥ï¼š
â–¡ æ—¥å¿—è·¯å¾„æ˜¯å¦å­˜åœ¨
â–¡ Elasticsearchè¿æ¥æ˜¯å¦æ­£ç¡®
â–¡ ç´¢å¼•æ¨¡æ¿æ˜¯å¦åŒ¹é…

å®‰å…¨æ£€æŸ¥ï¼š
â–¡ æ•æ„Ÿä¿¡æ¯æ˜¯å¦åŠ å¯†
â–¡ è®¿é—®æƒé™æ˜¯å¦åˆç†
â–¡ ç½‘ç»œé…ç½®æ˜¯å¦å®‰å…¨

å½±å“è¯„ä¼°ï¼š
â–¡ å˜æ›´å½±å“èŒƒå›´
â–¡ å›æ»šè®¡åˆ’æ˜¯å¦å®Œæ•´
â–¡ ç›‘æ§å‘Šè­¦æ˜¯å¦åˆ°ä½
```

### 7.4 ç‰ˆæœ¬æ ‡ç­¾ä¸å‘å¸ƒç®¡ç†



**ğŸ·ï¸ ç‰ˆæœ¬æ ‡ç­¾ç­–ç•¥**ï¼š
```bash
# è¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾

git tag -a v1.2.3 -m "ä¿®å¤æ—¥å¿—æ”¶é›†bug"
git tag -a v1.3.0 -m "æ–°å¢å¤šè¡Œæ—¥å¿—æ”¯æŒ"
git tag -a v2.0.0 -m "é‡æ„é…ç½®æ¶æ„"

# ç¯å¢ƒç‰¹å®šæ ‡ç­¾

git tag -a prod-v1.2.3 -m "ç”Ÿäº§ç¯å¢ƒå‘å¸ƒç‰ˆæœ¬1.2.3"
git tag -a staging-v1.3.0 -m "æµ‹è¯•ç¯å¢ƒå‘å¸ƒç‰ˆæœ¬1.3.0"
```

**ğŸ“Š å‘å¸ƒè®°å½•ç®¡ç†**ï¼š
```markdown
# CHANGELOG.md


# [v1.3.0] - 2024-01-15



## æ–°å¢åŠŸèƒ½


- æ”¯æŒå¤šè¡Œæ—¥å¿—æ¨¡å¼é…ç½®
- æ–°å¢è‡ªå®šä¹‰å­—æ®µå¤„ç†å™¨
- æ·»åŠ é…ç½®çƒ­é‡è½½åŠŸèƒ½

## ä¿®å¤é—®é¢˜


- ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜ (#123)
- è§£å†³æ–­çº¿é‡è¿å¼‚å¸¸ (#145)

## å˜æ›´è¯´æ˜


- é…ç½®æ–‡ä»¶æ ¼å¼å‘åå…¼å®¹
- å»ºè®®å‡çº§å‰å¤‡ä»½é…ç½®

## éƒ¨ç½²ä¿¡æ¯


- æµ‹è¯•ç¯å¢ƒï¼š2024-01-10 éƒ¨ç½²æˆåŠŸ
- ç”Ÿäº§ç¯å¢ƒï¼š2024-01-15 éƒ¨ç½²æˆåŠŸ
- å›æ»šç‰ˆæœ¬ï¼šv1.2.3
```

### 7.5 é…ç½®å·®å¼‚å¯¹æ¯”ä¸åˆå¹¶



**ğŸ” é…ç½®å·®å¼‚åˆ†æå·¥å…·**ï¼š
```bash
#!/bin/bash

# config-diff.sh


OLD_CONFIG="$1"
NEW_CONFIG="$2"

echo "é…ç½®æ–‡ä»¶å·®å¼‚åˆ†æï¼š"
echo "===================="

# åŸºç¡€å·®å¼‚å¯¹æ¯”

diff -u "$OLD_CONFIG" "$NEW_CONFIG" | head -50

# ç»“æ„åŒ–å·®å¼‚åˆ†æ

echo -e "\nå…³é”®é…ç½®é¡¹å˜æ›´ï¼š"
echo "===================="

# æå–å¹¶å¯¹æ¯”å…³é”®é…ç½®

extract_key_configs() {
    local config_file="$1"
    yq eval '.filebeat.inputs[].paths, .output.elasticsearch.hosts, .logging.level' "$config_file"
}

echo "æ—§é…ç½®å…³é”®é¡¹ï¼š"
extract_key_configs "$OLD_CONFIG"

echo -e "\næ–°é…ç½®å…³é”®é¡¹ï¼š"
extract_key_configs "$NEW_CONFIG"
```

**âš™ï¸ é…ç½®åˆå¹¶ç­–ç•¥**ï¼š
```bash
# ä¸‰æ–¹åˆå¹¶ç­–ç•¥

# åŸºç¡€ç‰ˆæœ¬ + åˆ†æ”¯Aå˜æ›´ + åˆ†æ”¯Bå˜æ›´ = åˆå¹¶ç»“æœ


# è‡ªåŠ¨åˆå¹¶è§„åˆ™

cat > .gitattributes << EOF
*.yml merge=union          # è‡ªåŠ¨åˆå¹¶éå†²çªå†…å®¹
**/secrets.yml merge=ours  # ä¿ç•™å½“å‰åˆ†æ”¯çš„æ•æ„Ÿé…ç½®
**/local.yml merge=theirs  # é‡‡ç”¨ä¼ å…¥åˆ†æ”¯çš„æœ¬åœ°é…ç½®
EOF
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ é…ç½®æ¨¡æ¿åŒ–ï¼šç»Ÿä¸€ç®¡ç†ï¼Œå˜é‡é©±åŠ¨ï¼Œç¯å¢ƒéš”ç¦»
ğŸ”¸ ç¯å¢ƒå˜é‡ç®¡ç†ï¼šåˆ†å±‚å­˜å‚¨ï¼Œå®‰å…¨æ³¨å…¥ï¼ŒåŠ¨æ€é…ç½®
ğŸ”¸ é…ç½®çƒ­é‡è½½ï¼šé›¶åœæœºæ›´æ–°ï¼Œå®æ—¶ç”Ÿæ•ˆï¼Œæ•…éšœè‡ªæ„ˆ
ğŸ”¸ æ‰¹é‡éƒ¨ç½²ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œåˆ†æ‰¹å‘å¸ƒï¼Œé£é™©å¯æ§
ğŸ”¸ ç‰ˆæœ¬å‡çº§ï¼šå…¼å®¹æ€§æ£€æŸ¥ï¼Œåˆ†é˜¶æ®µå‡çº§ï¼Œå¿«é€Ÿå›æ»š
ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶ï¼šå˜æ›´è¿½è¸ªï¼Œå®¡æ ¸æµç¨‹ï¼Œå‘å¸ƒç®¡ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ è‡ªåŠ¨åŒ–çš„æ ¸å¿ƒä»·å€¼**
```
æ•ˆç‡æå‡ï¼š
â€¢ æ‰‹åŠ¨æ“ä½œï¼š1å°æœåŠ¡å™¨5åˆ†é’Ÿ Ã— 100å° = 8å°æ—¶
â€¢ è‡ªåŠ¨åŒ–æ“ä½œï¼š100å°æœåŠ¡å™¨åŒæ—¶å¤„ç† = 10åˆ†é’Ÿ

ä¸€è‡´æ€§ä¿è¯ï¼š
â€¢ æ¶ˆé™¤äººä¸ºé”™è¯¯å’Œç¯å¢ƒå·®å¼‚
â€¢ ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹é…ç½®å®Œå…¨ä¸€è‡´

å¿«é€Ÿå“åº”ï¼š
â€¢ ç´§æ€¥é…ç½®å˜æ›´å¯åœ¨å‡ åˆ†é’Ÿå†…å®Œæˆ
â€¢ æ•…éšœåœºæ™¯ä¸‹å¿«é€Ÿå›æ»šæ¢å¤
```

**ğŸ”¹ é…ç½®ç®¡ç†çš„æœ€ä½³å®è·µ**
```
æ¨¡æ¿åŒ–è®¾è®¡ï¼š
â€¢ åŸºç¡€æ¨¡æ¿ + ç¯å¢ƒå˜é‡ = æœ€ç»ˆé…ç½®
â€¢ åˆ†å±‚ç»§æ‰¿ï¼Œé¿å…é‡å¤é…ç½®

ç‰ˆæœ¬æ§åˆ¶ï¼š
â€¢ æ‰€æœ‰é…ç½®å˜æ›´éƒ½è¦æœ‰è®°å½•
â€¢ æ¯æ¬¡éƒ¨ç½²éƒ½è¦æ‰“æ ‡ç­¾

åˆ†é˜¶æ®µéƒ¨ç½²ï¼š
â€¢ æµ‹è¯•ç¯å¢ƒ â†’ ç°åº¦å‘å¸ƒ â†’ å…¨é‡éƒ¨ç½²
â€¢ æ¯ä¸ªé˜¶æ®µéƒ½è¦éªŒè¯å’Œç›‘æ§
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ’¼ ä¼ä¸šçº§åº”ç”¨åœºæ™¯**
- **å¤§è§„æ¨¡é›†ç¾¤ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†æ•°ç™¾å°FilebeatèŠ‚ç‚¹
- **å¤šç¯å¢ƒéƒ¨ç½²**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®è‡ªåŠ¨åŒ–
- **DevOpsé›†æˆ**ï¼šä¸CI/CDæµæ°´çº¿æ— ç¼é›†æˆ
- **æ•…éšœå¿«é€Ÿæ¢å¤**ï¼šåˆ†é’Ÿçº§é…ç½®å›æ»šå’Œé—®é¢˜ä¿®å¤
- **åˆè§„å®¡è®¡**ï¼šå®Œæ•´çš„é…ç½®å˜æ›´å†å²è®°å½•

**ğŸ”§ è¿ç»´å®è·µè¦ç‚¹**
- **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®å˜æ›´åçš„çŠ¶æ€ç›‘æ§
- **æ–‡æ¡£ç»´æŠ¤**ï¼šæ“ä½œæ‰‹å†Œå’Œæ•…éšœå¤„ç†æŒ‡å—
- **å›¢é˜ŸåŸ¹è®­**ï¼šç¡®ä¿å›¢é˜Ÿæˆå‘˜æŒæ¡è‡ªåŠ¨åŒ–å·¥å…·
- **å®šæœŸæ¼”ç»ƒ**ï¼šå›æ»šå’Œæ•…éšœæ¢å¤æµç¨‹æ¼”ç»ƒ

### 8.4 è¿›é˜¶å‘å±•æ–¹å‘



```
åŸºç¡€è‡ªåŠ¨åŒ–é˜¶æ®µï¼š
â€¢ é…ç½®æ¨¡æ¿åŒ–
â€¢ æ‰¹é‡éƒ¨ç½²è„šæœ¬
â€¢ ç®€å•ç‰ˆæœ¬æ§åˆ¶

è¿›é˜¶è‡ªåŠ¨åŒ–é˜¶æ®µï¼š
â€¢ åŸºç¡€è®¾æ–½å³ä»£ç  (IaC)
â€¢ GitOpså·¥ä½œæµ
â€¢ è‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ

é«˜çº§è‡ªåŠ¨åŒ–é˜¶æ®µï¼š
â€¢ æ™ºèƒ½åŒ–è¿ç»´
â€¢ è‡ªåŠ¨æ•…éšœè¯Šæ–­
â€¢ é¢„æµ‹æ€§ç»´æŠ¤
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–æ˜¯ç°ä»£è¿ç»´çš„å¿…å¤‡æŠ€èƒ½
- æ¨¡æ¿åŒ–å’Œç‰ˆæœ¬æ§åˆ¶æ˜¯æ ¸å¿ƒåŸºç¡€
- åˆ†é˜¶æ®µéƒ¨ç½²å’Œå¿«é€Ÿå›æ»šä¿è¯ç³»ç»Ÿç¨³å®šæ€§
- è‡ªåŠ¨åŒ–å·¥å…·è¦ä¸å›¢é˜Ÿå·¥ä½œæµç¨‹ç›¸ç»“åˆ
- ç›‘æ§å’Œæ–‡æ¡£æ˜¯è‡ªåŠ¨åŒ–æˆåŠŸçš„å…³é”®ä¿éšœ