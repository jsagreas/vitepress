---
title: 2ã€æ¡ä»¶åˆ¤æ–­å¤„ç†å™¨
---
## ğŸ“š ç›®å½•

1. [æ¡ä»¶åˆ¤æ–­å¤„ç†å™¨æ¦‚è¿°](#1-æ¡ä»¶åˆ¤æ–­å¤„ç†å™¨æ¦‚è¿°)
2. [whenæ¡ä»¶è¯­æ³•åŸºç¡€](#2-whenæ¡ä»¶è¯­æ³•åŸºç¡€)
3. [åŸºæœ¬æ¡ä»¶ç±»å‹è¯¦è§£](#3-åŸºæœ¬æ¡ä»¶ç±»å‹è¯¦è§£)
4. [é€»è¾‘è¿ç®—ç¬¦ç»„åˆ](#4-é€»è¾‘è¿ç®—ç¬¦ç»„åˆ)
5. [å¤åˆæ¡ä»¶é…ç½®å®æˆ˜](#5-å¤åˆæ¡ä»¶é…ç½®å®æˆ˜)
6. [å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹](#6-å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ¡ä»¶åˆ¤æ–­å¤„ç†å™¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ¡ä»¶åˆ¤æ–­å¤„ç†å™¨


**ç®€å•ç†è§£**ï¼šå°±åƒç”Ÿæ´»ä¸­çš„"å¦‚æœ...é‚£ä¹ˆ..."é€»è¾‘ä¸€æ ·ï¼Œæ¡ä»¶åˆ¤æ–­å¤„ç†å™¨è®©Filebeatèƒ½å¤Ÿæ™ºèƒ½åœ°å†³å®šä»€ä¹ˆæ—¶å€™å¯¹æ—¥å¿—æ•°æ®è¿›è¡Œå¤„ç†ã€‚

```
ç”Ÿæ´»ä¸­çš„æ¡ä»¶åˆ¤æ–­ï¼š
å¦‚æœä»Šå¤©ä¸‹é›¨ï¼Œé‚£ä¹ˆå¸¦é›¨ä¼
å¦‚æœæ°”æ¸©è¶…è¿‡30åº¦ï¼Œé‚£ä¹ˆå¼€ç©ºè°ƒ

Filebeatä¸­çš„æ¡ä»¶åˆ¤æ–­ï¼š
å¦‚æœæ—¥å¿—çº§åˆ«æ˜¯ERRORï¼Œé‚£ä¹ˆæ·»åŠ å‘Šè­¦æ ‡ç­¾
å¦‚æœæ¥æºæ˜¯nginxï¼Œé‚£ä¹ˆè§£æè®¿é—®æ—¥å¿—æ ¼å¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¡ä»¶åˆ¤æ–­


**æ ¸å¿ƒä»·å€¼**ï¼šä¸æ˜¯æ‰€æœ‰æ—¥å¿—éƒ½éœ€è¦ç›¸åŒçš„å¤„ç†æ–¹å¼

```
å®é™…åœºæ™¯ä¸¾ä¾‹ï¼š

WebæœåŠ¡å™¨æ—¥å¿—æ··åˆæƒ…å†µï¼š
â”œâ”€â”€ Nginxè®¿é—®æ—¥å¿— â†’ éœ€è¦è§£æIPã€çŠ¶æ€ç ã€å“åº”æ—¶é—´
â”œâ”€â”€ Nginxé”™è¯¯æ—¥å¿— â†’ éœ€è¦æå–é”™è¯¯çº§åˆ«ã€é”™è¯¯ä¿¡æ¯  
â”œâ”€â”€ åº”ç”¨ç¨‹åºæ—¥å¿— â†’ éœ€è¦è§£æä¸šåŠ¡å­—æ®µ
â””â”€â”€ ç³»ç»Ÿæ—¥å¿— â†’ éœ€è¦æå–ç³»ç»Ÿäº‹ä»¶ä¿¡æ¯

æ²¡æœ‰æ¡ä»¶åˆ¤æ–­çš„é—®é¢˜ï¼š
âŒ æ‰€æœ‰æ—¥å¿—ç”¨åŒä¸€å¥—è§„åˆ™å¤„ç†
âŒ å¯¼è‡´è§£æé”™è¯¯å’Œæ•°æ®æ··ä¹±
âŒ æµªè´¹ç³»ç»Ÿèµ„æº

æœ‰æ¡ä»¶åˆ¤æ–­çš„å¥½å¤„ï¼š
âœ… é’ˆå¯¹ä¸åŒç±»å‹æ—¥å¿—é‡‡ç”¨ä¸åŒå¤„ç†ç­–ç•¥
âœ… æé«˜æ•°æ®è´¨é‡å’Œå¤„ç†æ•ˆç‡
âœ… çµæ´»åº”å¯¹å¤æ‚çš„æ—¥å¿—ç¯å¢ƒ
```

### 1.3 æ¡ä»¶åˆ¤æ–­çš„å·¥ä½œæµç¨‹


**å¤„ç†æµç¨‹å›¾**ï¼š
```
æ—¥å¿—æ•°æ®è¾“å…¥
    |
    â–¼
æ£€æŸ¥whenæ¡ä»¶
    |
    â”œâ”€ æ¡ä»¶ä¸ºtrue â”€â”€â–º æ‰§è¡Œå¤„ç†å™¨
    |                    |
    |                    â–¼
    â””â”€ æ¡ä»¶ä¸ºfalse â”€â”€â–º è·³è¿‡å¤„ç†å™¨
                          |
                          â–¼
                    ç»§ç»­ä¸‹ä¸€ä¸ªå¤„ç†å™¨
```

---

## 2. ğŸ“ whenæ¡ä»¶è¯­æ³•åŸºç¡€


### 2.1 whenæ¡ä»¶çš„åŸºæœ¬ç»“æ„


**è¯­æ³•æ ¼å¼**ï¼š
```yaml
processors:
  - processor_name:
      when:
        condition_type: condition_value
      # å¤„ç†å™¨çš„å…·ä½“é…ç½®
```

**å®é™…ç¤ºä¾‹**ï¼š
```yaml
processors:
  - add_tags:
      when:
        equals:
          log.level: "ERROR"
      tags: ["error", "alert"]
```

> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šè¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯"å½“æ—¥å¿—çº§åˆ«ç­‰äºERRORæ—¶ï¼Œç»™è¿™æ¡æ—¥å¿—æ·»åŠ errorå’Œalertä¸¤ä¸ªæ ‡ç­¾"

### 2.2 æ¡ä»¶åˆ¤æ–­çš„æ‰§è¡Œæ—¶æœº


**é‡è¦ç†è§£**ï¼šwhenæ¡ä»¶åœ¨å¤„ç†å™¨æ‰§è¡Œä¹‹å‰å°±ä¼šè¢«è¯„ä¼°

```
æ‰§è¡Œé¡ºåºè¯¦è§£ï¼š

1. æ—¥å¿—äº‹ä»¶åˆ°è¾¾å¤„ç†å™¨
2. Filebeatè¯»å–whenæ¡ä»¶
3. æ ¹æ®äº‹ä»¶å­—æ®µå€¼è¯„ä¼°æ¡ä»¶
4. å¦‚æœæ¡ä»¶ä¸ºtrueï¼Œæ‰§è¡Œå¤„ç†å™¨æ“ä½œ
5. å¦‚æœæ¡ä»¶ä¸ºfalseï¼Œè·³è¿‡è¯¥å¤„ç†å™¨
6. ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå¤„ç†å™¨
```

### 2.3 å­—æ®µå¼•ç”¨è¯­æ³•


**å­—æ®µè®¿é—®æ–¹å¼**ï¼šä½¿ç”¨ç‚¹å·åˆ†éš”çš„è·¯å¾„æ¥è®¿é—®åµŒå¥—å­—æ®µ

```yaml
# è®¿é—®é¡¶çº§å­—æ®µ
when:
  equals:
    message: "error occurred"

# è®¿é—®åµŒå¥—å­—æ®µ  
when:
  equals:
    log.level: "ERROR"
    
# è®¿é—®æ›´æ·±å±‚åµŒå¥—
when:
  equals:
    fields.custom.app_name: "web-server"
```

**å­—æ®µè·¯å¾„ç¤ºä¾‹**ï¼š
```
æ—¥å¿—äº‹ä»¶ç»“æ„ï¼š
{
  "message": "User login failed",
  "log": {
    "level": "WARN",
    "file": "/var/log/app.log"
  },
  "fields": {
    "environment": "production",
    "custom": {
      "app_name": "user-service"
    }
  }
}

å­—æ®µå¼•ç”¨æ–¹å¼ï¼š
- message â†’ "User login failed"  
- log.level â†’ "WARN"
- log.file â†’ "/var/log/app.log"
- fields.environment â†’ "production"
- fields.custom.app_name â†’ "user-service"
```

---

## 3. ğŸ” åŸºæœ¬æ¡ä»¶ç±»å‹è¯¦è§£


### 3.1 equals - ç²¾ç¡®åŒ¹é…æ¡ä»¶


**ç”¨é€”**ï¼šåˆ¤æ–­å­—æ®µå€¼æ˜¯å¦å®Œå…¨ç›¸ç­‰

```yaml
# å•ä¸ªå­—æ®µåŒ¹é…
processors:
  - add_tags:
      when:
        equals:
          log.level: "ERROR"
      tags: ["critical"]

# å¤šä¸ªå­—æ®µåŒæ—¶åŒ¹é…ï¼ˆANDå…³ç³»ï¼‰
processors:
  - add_tags:
      when:
        equals:
          log.level: "ERROR"
          fields.service: "payment"
      tags: ["payment-error"]
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
- æ ¹æ®æ—¥å¿—çº§åˆ«åˆ†ç±»å¤„ç†
- æŒ‰æœåŠ¡åç§°è·¯ç”±æ—¥å¿—
- æ ¹æ®çŠ¶æ€ç æ·»åŠ æ ‡ç­¾

### 3.2 contains - åŒ…å«åŒ¹é…æ¡ä»¶


**ç”¨é€”**ï¼šåˆ¤æ–­å­—æ®µå€¼æ˜¯å¦åŒ…å«æŒ‡å®šå†…å®¹

```yaml
# æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦åŒ…å«ç‰¹å®šå…³é”®è¯
processors:
  - add_tags:
      when:
        contains:
          message: "connection timeout"
      tags: ["network-issue"]

# æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦åŒ…å«ç‰¹å®šç›®å½•
processors:
  - add_fields:
      when:
        contains:
          log.file.path: "/var/log/nginx/"
      fields:
        log_type: "nginx"
```

**ä½¿ç”¨æŠ€å·§**ï¼š
- **å¤§å°å†™æ•æ„Ÿ**ï¼š`"Error"` å’Œ `"error"` æ˜¯ä¸åŒçš„
- **éƒ¨åˆ†åŒ¹é…**ï¼šåªè¦åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²å°±åŒ¹é…æˆåŠŸ
- **é€‚ç”¨åœºæ™¯**ï¼šå…³é”®è¯æ£€æµ‹ã€è·¯å¾„åŒ¹é…ã€å†…å®¹åˆ†ç±»

### 3.3 regexp - æ­£åˆ™è¡¨è¾¾å¼æ¡ä»¶


**ç”¨é€”**ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå¤æ‚æ¨¡å¼åŒ¹é…

```yaml
# åŒ¹é…IPåœ°å€æ ¼å¼
processors:
  - add_tags:
      when:
        regexp:
          message: '\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b'
      tags: ["contains-ip"]

# åŒ¹é…HTTPçŠ¶æ€ç 
processors:
  - add_fields:
      when:
        regexp:
          message: '\s[45]\d{2}\s'  # 4xxæˆ–5xxçŠ¶æ€ç 
      fields:
        response_type: "error"
```

**æ­£åˆ™è¡¨è¾¾å¼å¸¸ç”¨æ¨¡å¼**ï¼š

| æ¨¡å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `\d+` | **åŒ¹é…æ•°å­—** | `123`, `456` |
| `\w+` | **åŒ¹é…å­—æ¯æ•°å­—ä¸‹åˆ’çº¿** | `user_name`, `id123` |
| `[45]\d{2}` | **åŒ¹é…4xxæˆ–5xxçŠ¶æ€ç ** | `404`, `500` |
| `\b\w+@\w+\.\w+\b` | **åŒ¹é…é‚®ç®±æ ¼å¼** | `user@example.com` |

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼šæ­£åˆ™è¡¨è¾¾å¼è¦ç”¨å•å¼•å·åŒ…å›´ï¼Œé¿å…YAMLè½¬ä¹‰é—®é¢˜

### 3.4 exists - å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥


**ç”¨é€”**ï¼šæ£€æŸ¥æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨ï¼ˆä¸å…³å¿ƒå€¼æ˜¯ä»€ä¹ˆï¼‰

```yaml
# åªæœ‰å½“error_codeå­—æ®µå­˜åœ¨æ—¶æ‰å¤„ç†
processors:
  - add_tags:
      when:
        exists:
          - "error_code"
      tags: ["has-error-code"]

# æ£€æŸ¥å¤šä¸ªå­—æ®µæ˜¯å¦éƒ½å­˜åœ¨
processors:
  - add_fields:
      when:
        exists:
          - "user_id"
          - "session_id"
      fields:
        log_category: "user-session"
```

**å…¸å‹ç”¨é€”**ï¼š
- ç¡®ä¿å¿…è¦å­—æ®µå­˜åœ¨åå†å¤„ç†
- åŒºåˆ†ä¸åŒæ ¼å¼çš„æ—¥å¿—
- é˜²æ­¢å¤„ç†ä¸å®Œæ•´çš„æ—¥å¿—è®°å½•

---

## 4. ğŸ”„ é€»è¾‘è¿ç®—ç¬¦ç»„åˆ


### 4.1 and - é€»è¾‘ä¸è¿ç®—


**å«ä¹‰**ï¼šæ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»ä¸ºtrueï¼Œæ•´ä¸ªæ¡ä»¶æ‰ä¸ºtrue

```yaml
# ä¸¥æ ¼åŒ¹é…ï¼šå¿…é¡»åŒæ—¶æ»¡è¶³çº§åˆ«å’ŒæœåŠ¡å
processors:
  - add_tags:
      when:
        and:
          - equals:
              log.level: "ERROR"
          - equals:
              fields.service: "database"
      tags: ["db-error"]
```

**å®é™…åœºæ™¯**ï¼šç­›é€‰ç‰¹å®šæœåŠ¡çš„ç‰¹å®šçº§åˆ«æ—¥å¿—

### 4.2 or - é€»è¾‘æˆ–è¿ç®—


**å«ä¹‰**ï¼šä»»æ„ä¸€ä¸ªæ¡ä»¶ä¸ºtrueï¼Œæ•´ä¸ªæ¡ä»¶å°±ä¸ºtrue

```yaml
# å®½æ¾åŒ¹é…ï¼šé”™è¯¯æˆ–è­¦å‘Šéƒ½è¦å¤„ç†
processors:
  - add_tags:
      when:
        or:
          - equals:
              log.level: "ERROR"  
          - equals:
              log.level: "WARN"
      tags: ["needs-attention"]
```

**å®é™…åœºæ™¯**ï¼šæ•è·å¤šç§ç±»å‹çš„é—®é¢˜æ—¥å¿—

### 4.3 not - é€»è¾‘éè¿ç®—


**å«ä¹‰**ï¼šæ¡ä»¶ä¸ºfalseæ—¶ï¼Œæ•´ä¸ªæ¡ä»¶ä¸ºtrueï¼ˆå–åï¼‰

```yaml
# æ’é™¤DEBUGçº§åˆ«çš„æ—¥å¿—
processors:
  - add_tags:
      when:
        not:
          equals:
            log.level: "DEBUG"
      tags: ["non-debug"]
```

**å®é™…åœºæ™¯**ï¼šæ’é™¤ä¸éœ€è¦çš„æ—¥å¿—ç±»å‹

### 4.4 å¤æ‚é€»è¾‘ç»„åˆ


**åµŒå¥—é€»è¾‘**ï¼šå¯ä»¥å¤šå±‚åµŒå¥—å®ç°å¤æ‚æ¡ä»¶

```yaml
# å¤æ‚æ¡ä»¶ï¼š(ERRORçº§åˆ« æˆ– åŒ…å«timeout) ä¸” ä¸æ˜¯æ¥è‡ªhealth-check
processors:
  - add_tags:
      when:
        and:
          - or:
              - equals:
                  log.level: "ERROR"
              - contains:
                  message: "timeout"
          - not:
              contains:
                message: "health-check"
      tags: ["real-issue"]
```

**é€»è¾‘å…³ç³»å›¾**ï¼š
```
æœ€ç»ˆæ¡ä»¶ = AND
    â”œâ”€â”€ OR (ç¬¬ä¸€ä¸ªæ¡ä»¶)
    â”‚   â”œâ”€â”€ log.level == "ERROR"
    â”‚   â””â”€â”€ message contains "timeout"  
    â””â”€â”€ NOT (ç¬¬äºŒä¸ªæ¡ä»¶)
        â””â”€â”€ message contains "health-check"
```

---

## 5. âš™ï¸ å¤åˆæ¡ä»¶é…ç½®å®æˆ˜


### 5.1 WebæœåŠ¡å™¨æ—¥å¿—åˆ†ç±»å¤„ç†


**åœºæ™¯**ï¼šæ ¹æ®ä¸åŒçš„æ—¥å¿—ç±»å‹é‡‡ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥

```yaml
filebeat.inputs:
- type: log
  paths:
    - /var/log/nginx/*.log
  processors:
    # å¤„ç†è®¿é—®æ—¥å¿—
    - add_fields:
        when:
          contains:
            log.file.path: "access.log"
        fields:
          log_type: "access"
          index_prefix: "nginx-access"
    
    # å¤„ç†é”™è¯¯æ—¥å¿—  
    - add_fields:
        when:
          contains:
            log.file.path: "error.log"
        fields:
          log_type: "error"
          index_prefix: "nginx-error"
    
    # ç»™4xx/5xxçŠ¶æ€ç æ·»åŠ å‘Šè­¦æ ‡ç­¾
    - add_tags:
        when:
          and:
            - equals:
                fields.log_type: "access"
            - regexp:
                message: '\s[45]\d{2}\s'
        tags: ["http-error", "alert"]
```

### 5.2 åº”ç”¨ç¨‹åºæ—¥å¿—å¤„ç†


**åœºæ™¯**ï¼šå¤šåº”ç”¨æ··åˆæ—¥å¿—çš„æ™ºèƒ½å¤„ç†

```yaml
processors:
  # å¤„ç†æ”¯ä»˜æœåŠ¡çš„é”™è¯¯æ—¥å¿—
  - add_fields:
      when:
        and:
          - equals:
              fields.service: "payment"
          - or:
              - equals:
                  log.level: "ERROR"
              - contains:
                  message: "payment failed"
      fields:
        priority: "high"
        team: "payment-team"
  
  # å¤„ç†ç”¨æˆ·æœåŠ¡çš„ç™»å½•ç›¸å…³æ—¥å¿—
  - add_tags:
      when:
        and:
          - equals:
              fields.service: "user"
          - or:
              - contains:
                  message: "login"
              - contains:
                  message: "authentication"
      tags: ["user-auth", "security"]
  
  # æ’é™¤å¥åº·æ£€æŸ¥æ—¥å¿—
  - drop_event:
      when:
        or:
          - contains:
              message: "health-check"
          - contains:
              message: "/ping"
```

### 5.3 åŸºäºæ—¶é—´çš„æ¡ä»¶å¤„ç†


**åœºæ™¯**ï¼šå·¥ä½œæ—¶é—´å’Œéå·¥ä½œæ—¶é—´çš„ä¸åŒå¤„ç†ç­–ç•¥

```yaml
processors:
  # å·¥ä½œæ—¶é—´å¤–çš„é”™è¯¯éœ€è¦ç‰¹åˆ«å…³æ³¨
  - add_tags:
      when:
        and:
          - equals:
              log.level: "ERROR"
          - or:
              - range:
                  "@timestamp":
                    lt: "08:00"
              - range:
                  "@timestamp": 
                    gt: "18:00"
      tags: ["after-hours", "urgent"]
```

---

## 6. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯æ¡ˆä¾‹


### 6.1 æ¡ˆä¾‹ä¸€ï¼šç”µå•†ç³»ç»Ÿæ—¥å¿—åˆ†æµ


**èƒŒæ™¯**ï¼šç”µå•†ç³»ç»ŸåŒ…å«è®¢å•ã€æ”¯ä»˜ã€åº“å­˜ç­‰å¤šä¸ªæœåŠ¡ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡é‡è¦æ€§è¿›è¡Œåˆ†ç±»å¤„ç†

```yaml
processors:
  # æ”¯ä»˜ç›¸å…³çš„ä»»ä½•é—®é¢˜éƒ½æ˜¯é«˜ä¼˜å…ˆçº§
  - add_fields:
      when:
        and:
          - equals:
              fields.service: "payment"
          - or:
              - equals:
                  log.level: "ERROR"
              - equals:
                  log.level: "WARN"
              - contains:
                  message: "payment_failed"
      fields:
        business_priority: "critical"
        alert_team: "payment"
        
  # è®¢å•æœåŠ¡çš„åº“å­˜ä¸è¶³è­¦å‘Š
  - add_tags:
      when:
        and:
          - equals:
              fields.service: "order"
          - contains:
              message: "insufficient_stock"
      tags: ["inventory-alert", "business-impact"]
      
  # ç”¨æˆ·ç™»å½•å¤±è´¥é¢‘ç‡ç›‘æ§
  - add_fields:
      when:
        and:
          - equals:
              fields.service: "auth"
          - contains:
              message: "login_failed"
      fields:
        security_event: "login_failure"
        monitor_frequency: "high"
```

### 6.2 æ¡ˆä¾‹äºŒï¼šå¾®æœåŠ¡æ•…éšœè¯Šæ–­


**èƒŒæ™¯**ï¼šå¾®æœåŠ¡æ¶æ„ä¸­éœ€è¦å¿«é€Ÿå®šä½æ•…éšœé“¾è·¯

```yaml
processors:
  # æœåŠ¡é—´è°ƒç”¨è¶…æ—¶
  - add_fields:
      when:
        or:
          - contains:
              message: "timeout"
          - contains:
              message: "connection refused"
          - regexp:
              message: "5\d{2}"  # 5xxçŠ¶æ€ç 
      fields:
        issue_type: "service_connectivity"
        investigation_priority: "high"
        
  # æ•°æ®åº“è¿æ¥é—®é¢˜
  - add_tags:
      when:
        and:
          - or:
              - contains:
                  message: "database"
              - contains:
                  message: "SQL"
              - contains:
                  message: "connection pool"
          - or:
              - contains:
                  message: "timeout"
              - contains:
                  message: "refused"
              - equals:
                  log.level: "ERROR"
      tags: ["database-issue", "infrastructure"]
```

### 6.3 æ¡ˆä¾‹ä¸‰ï¼šå®‰å…¨äº‹ä»¶ç›‘æ§


**èƒŒæ™¯**ï¼šç›‘æ§å¯ç–‘çš„å®‰å…¨ç›¸å…³æ´»åŠ¨

```yaml
processors:
  # å¼‚å¸¸ç™»å½•è¡Œä¸º
  - add_fields:
      when:
        or:
          - and:
              - contains:
                  message: "login"
              - or:
                  - contains:
                      message: "failed"
                  - contains:
                      message: "blocked"
          - contains:
              message: "brute force"
          - contains:
              message: "suspicious"
      fields:
        security_category: "authentication"
        alert_level: "medium"
        
  # æƒé™æå‡å’Œæ•æ„Ÿæ“ä½œ
  - add_tags:
      when:
        or:
          - contains:
              message: "privilege escalation" 
          - contains:
              message: "admin access"
          - and:
              - contains:
                  message: "delete"
              - or:
                  - contains:
                      message: "user"
                  - contains:
                      message: "account"
      tags: ["privilege-operation", "audit-required"]
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¡ä»¶åˆ¤æ–­æœ¬è´¨ï¼šè®©Filebeatèƒ½å¤Ÿæ™ºèƒ½åœ°é€‰æ‹©æ€§å¤„ç†æ—¥å¿—
ğŸ”¸ whenè¯­æ³•ç»“æ„ï¼šåœ¨å¤„ç†å™¨é…ç½®ä¸­æ·»åŠ whenæ¡ä»¶å—
ğŸ”¸ åŸºæœ¬æ¡ä»¶ç±»å‹ï¼šequals(ç²¾ç¡®)ã€contains(åŒ…å«)ã€regexp(æ­£åˆ™)ã€exists(å­˜åœ¨)
ğŸ”¸ é€»è¾‘è¿ç®—ç¬¦ï¼šand(ä¸”)ã€or(æˆ–)ã€not(é)çš„ç»„åˆä½¿ç”¨
ğŸ”¸ å­—æ®µå¼•ç”¨ï¼šä½¿ç”¨ç‚¹å·è·¯å¾„è®¿é—®åµŒå¥—å­—æ®µå€¼
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¡ä»¶åˆ¤æ–­çš„ä»·å€¼**
```
æé«˜å¤„ç†æ•ˆç‡ï¼š
- é¿å…å¯¹ä¸éœ€è¦çš„æ—¥å¿—è¿›è¡Œå¤æ‚å¤„ç†
- å‡å°‘ç³»ç»Ÿèµ„æºæ¶ˆè€—
- æå‡æ•´ä½“æ€§èƒ½

å¢å¼ºæ•°æ®è´¨é‡ï¼š
- é’ˆå¯¹ä¸åŒç±»å‹æ—¥å¿—é‡‡ç”¨ä¸“é—¨çš„å¤„ç†è§„åˆ™
- é¿å…é”™è¯¯çš„æ•°æ®è§£æå’Œè½¬æ¢
- ç¡®ä¿è¾“å‡ºæ•°æ®çš„å‡†ç¡®æ€§

ç®€åŒ–è¿ç»´ç®¡ç†ï¼š
- ä¸€å¥—é…ç½®å¤„ç†å¤šç§æ—¥å¿—æ ¼å¼
- çµæ´»çš„ä¸šåŠ¡é€»è¾‘å®ç°
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•
```

**ğŸ”¹ æ¡ä»¶è®¾è®¡åŸåˆ™**
```
ä»ç®€å•åˆ°å¤æ‚ï¼š
- å…ˆç”¨åŸºæœ¬æ¡ä»¶è§£å†³ä¸»è¦éœ€æ±‚
- å†ç”¨é€»è¾‘è¿ç®—ç»„åˆå¤„ç†å¤æ‚åœºæ™¯
- é¿å…è¿‡åº¦å¤æ‚çš„åµŒå¥—é€»è¾‘

æ€§èƒ½ä¼˜å…ˆï¼š
- æŠŠæœ€å¸¸è§çš„æ¡ä»¶æ”¾åœ¨å‰é¢
- ä½¿ç”¨existsæ£€æŸ¥é¿å…å­—æ®µä¸å­˜åœ¨é”™è¯¯
- åˆç†ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼‰

å¯è¯»æ€§ç»´æŠ¤ï¼š
- æ¡ä»¶é€»è¾‘è¦æ¸…æ™°æ˜“æ‡‚
- æ·»åŠ æ³¨é‡Šè¯´æ˜å¤æ‚æ¡ä»¶çš„ä¸šåŠ¡å«ä¹‰
- å®šæœŸreviewå’Œä¼˜åŒ–æ¡ä»¶é…ç½®
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¸¸è§åº”ç”¨æ¨¡å¼**
- **æ—¥å¿—åˆ†ç±»**ï¼šæ ¹æ®æ¥æºã€çº§åˆ«ã€å†…å®¹è¿›è¡Œåˆ†ç±»å¤„ç†
- **æ•°æ®è·¯ç”±**ï¼šå°†ä¸åŒç±»å‹æ—¥å¿—å‘é€åˆ°ä¸åŒç›®æ ‡
- **å‘Šè­¦ç­›é€‰**ï¼šåªå¯¹é‡è¦é—®é¢˜è¿›è¡Œå‘Šè­¦é€šçŸ¥
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè·³è¿‡ä¸éœ€è¦å¤„ç†çš„æ—¥å¿—è®°å½•

**âš ï¸ å¸¸è§é™·é˜±**
- **å­—æ®µä¸å­˜åœ¨**ï¼šä½¿ç”¨existså…ˆæ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
- **ç±»å‹ä¸åŒ¹é…**ï¼šæ³¨æ„å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ¯”è¾ƒæ–¹å¼
- **æ­£åˆ™æ€§èƒ½**ï¼šå¤æ‚æ­£åˆ™è¡¨è¾¾å¼ä¼šå½±å“å¤„ç†æ€§èƒ½
- **é€»è¾‘é”™è¯¯**ï¼šand/orçš„ç»„åˆè¦ä»”ç»†éªŒè¯é€»è¾‘æ­£ç¡®æ€§

**ğŸ”§ è°ƒè¯•æŠ€å·§**
```yaml
# æ·»åŠ è°ƒè¯•å­—æ®µæŸ¥çœ‹æ¡ä»¶æ‰§è¡Œç»“æœ
processors:
  - add_fields:
      when:
        equals:
          log.level: "ERROR"
      fields:
        debug_condition: "error_level_matched"
        debug_timestamp: "%{+yyyy-MM-dd HH:mm:ss}"
```

### 7.4 å­¦ä¹ è¿›åº¦æ£€æŸ¥


**ğŸ¯ æŒæ¡æ ‡å‡†**ï¼š
- [ ] èƒ½å¤Ÿç¼–å†™åŸºæœ¬çš„equalsã€containsæ¡ä»¶
- [ ] ç†è§£andã€orã€notçš„é€»è¾‘å…³ç³»  
- [ ] ä¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…
- [ ] èƒ½å¤Ÿè®¾è®¡å¤åˆæ¡ä»¶è§£å†³å®é™…é—®é¢˜
- [ ] æŒæ¡å­—æ®µå¼•ç”¨å’ŒåµŒå¥—è®¿é—®è¯­æ³•

**ğŸ’¡ å®è·µå»ºè®®**ï¼š
1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆç»ƒä¹ å•ä¸€æ¡ä»¶çš„é…ç½®
2. **é€æ­¥å¤æ‚åŒ–**ï¼šå†å°è¯•é€»è¾‘è¿ç®—ç¬¦çš„ç»„åˆ
3. **å®é™…é¡¹ç›®åº”ç”¨**ï¼šç»“åˆè‡ªå·±çš„æ—¥å¿—æ•°æ®è®¾è®¡æ¡ä»¶
4. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿æ¡ä»¶é€»è¾‘æŒ‰é¢„æœŸå·¥ä½œ
5. **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨æ¡ä»¶åˆ¤æ–­å¯¹å¤„ç†æ€§èƒ½çš„å½±å“

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¡ä»¶åˆ¤æ–­è®©æ—¥å¿—å¤„ç†æ›´æ™ºèƒ½
- whenæ¡ä»¶åœ¨å¤„ç†å™¨æ‰§è¡Œå‰è¯„ä¼°
- åŸºæœ¬ç±»å‹coverå¤§éƒ¨åˆ†ä½¿ç”¨åœºæ™¯
- é€»è¾‘è¿ç®—ç¬¦å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘
- å®é™…åº”ç”¨è¦å¹³è¡¡åŠŸèƒ½å’Œæ€§èƒ½