---
title: 2、通知连接器配置
---
## 📚 目录

1. [连接器基础概念](#1-连接器基础概念)
2. [Email邮件通知配置](#2-Email邮件通知配置)
3. [Webhook集成设置](#3-Webhook集成设置)
4. [Slack通知配置](#4-Slack通知配置)
5. [企业微信集成](#5-企业微信集成)
6. [钉钉通知配置](#6-钉钉通知配置)
7. [消息模板与变量](#7-消息模板与变量)
8. [通知测试与故障排除](#8-通知测试与故障排除)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🔗 连接器基础概念


### 1.1 什么是连接器


**🎯 通俗理解**
连接器就像是Kibana的"信使"，当系统出现问题时，它会按照你的指示把告警信息发送到各种地方。

```
简单类比：
连接器 = 快递公司
告警信息 = 包裹  
通知渠道 = 收货地址

当有告警时：
Kibana → 连接器 → 发送通知 → 你收到消息
```

**🔸 连接器的作用**
- **传递消息**：把告警信息发送到指定位置
- **多渠道支持**：邮件、聊天工具、短信等
- **自动化通知**：无需人工干预，自动发送
- **格式转换**：把技术信息转换成易读格式

### 1.2 连接器工作流程


```
告警触发流程：
监控数据 → 触发条件 → 生成告警 → 选择连接器 → 发送通知

具体步骤：
1. Elasticsearch收集数据
2. Kibana监控规则检查数据
3. 发现异常触发告警
4. 调用配置的连接器
5. 连接器发送通知到目标平台
6. 用户收到告警消息
```

### 1.3 连接器类型总览


| **连接器类型** | **适用场景** | **配置难度** | **推荐指数** |
|---------------|-------------|-------------|-------------|
| 📧 **Email** | `通用告警通知` | `⭐⭐` | `⭐⭐⭐⭐⭐` |
| 🌐 **Webhook** | `系统集成` | `⭐⭐⭐` | `⭐⭐⭐⭐` |
| 💬 **Slack** | `团队协作` | `⭐⭐` | `⭐⭐⭐⭐⭐` |
| 🏢 **企业微信** | `企业内部` | `⭐⭐⭐` | `⭐⭐⭐⭐` |
| 📱 **钉钉** | `中小团队` | `⭐⭐` | `⭐⭐⭐⭐` |

---

## 2. 📧 Email邮件通知配置


### 2.1 Email连接器基础配置


**🔧 配置步骤**

**步骤1：创建Email连接器**
```
Stack Management → Connectors → Create connector → Email
```

**步骤2：基本信息设置**
```
连接器名称：生产环境告警邮件
描述：用于发送系统告警到运维团队
```

**步骤3：SMTP服务器配置**
```
SMTP配置说明：
服务器地址：smtp.company.com
端口：587（TLS）或 25（无加密）
用户名：alert@company.com
密码：邮箱授权码（不是登录密码）
```

### 2.2 常见邮箱SMTP配置


**📮 主流邮箱SMTP设置**

```
QQ邮箱：
服务器：smtp.qq.com
端口：587 (TLS) / 465 (SSL)
用户名：完整QQ邮箱地址
密码：授权码

网易163：
服务器：smtp.163.com  
端口：587 (TLS) / 994 (SSL)
用户名：完整邮箱地址
密码：客户端授权码

企业邮箱：
服务器：smtp.exmail.qq.com
端口：587 (TLS) / 465 (SSL)
用户名：企业邮箱地址
密码：邮箱密码
```

### 2.3 Email消息模板配置


**✉️ 邮件格式设置**

```json
{
  "subject": "🚨 {{alertName}} - {{context.date}}",
  "message": "告警详情：\n时间：{{context.date}}\n级别：{{context.rule.params.level}}\n描述：{{context.message}}\n\n查看详情：{{context.kibanaBaseUrl}}"
}
```

**🎨 HTML格式邮件模板**
```html
<h2 style="color: #d32f2f;">🚨 系统告警</h2>
<table border="1" cellpadding="5">
  <tr><td><strong>告警名称</strong></td><td>{{alertName}}</td></tr>
  <tr><td><strong>触发时间</strong></td><td>{{context.date}}</td></tr>
  <tr><td><strong>告警级别</strong></td><td>{{context.rule.params.level}}</td></tr>
  <tr><td><strong>详细描述</strong></td><td>{{context.message}}</td></tr>
</table>
<p><a href="{{context.kibanaBaseUrl}}">点击查看详情</a></p>
```

---

## 3. 🌐 Webhook集成设置


### 3.1 Webhook连接器概念


**🔗 什么是Webhook**
Webhook就像是一个"网络接口"，可以把告警信息发送到任何支持HTTP接收的系统。

```
Webhook工作原理：
Kibana → HTTP POST请求 → 目标系统API → 系统处理告警

常见用途：
• 集成ITSM系统（ServiceNow、Jira）
• 触发自动化脚本
• 发送到监控平台
• 集成自定义系统
```

### 3.2 Webhook配置实例


**⚙️ 基础配置**
```
连接器名称：ITSM系统集成
URL：https://api.company.com/alerts
方法：POST
认证：Basic Auth 或 API Key
```

**📝 请求体模板**
```json
{
  "alert": {
    "name": "{{alertName}}",
    "timestamp": "{{context.date}}",
    "severity": "{{context.rule.params.level}}",
    "description": "{{context.message}}",
    "source": "Kibana",
    "environment": "production"
  }
}
```

### 3.3 Headers配置


```
Content-Type: application/json
Authorization: Bearer your-api-token
X-Alert-Source: Kibana
X-Environment: production
```

---

## 4. 💬 Slack通知配置


### 4.1 Slack连接器设置


**🚀 快速配置步骤**

**步骤1：创建Slack应用**
```
访问：https://api.slack.com/apps
点击：Create New App
选择：From scratch
填写：App name 和 workspace
```

**步骤2：配置权限**
```
需要的权限范围：
• chat:write - 发送消息
• chat:write.public - 发送到公共频道
• incoming-webhook - 接收webhook
```

**步骤3：获取Webhook URL**
```
Incoming Webhooks → Activate → Add New Webhook
选择频道 → 复制Webhook URL
```

### 4.2 Slack消息格式


**📱 基础消息模板**
```json
{
  "channel": "#alerts",
  "username": "Kibana Alert",
  "icon_emoji": ":warning:",
  "text": "🚨 *{{alertName}}*\n*时间:* {{context.date}}\n*级别:* {{context.rule.params.level}}\n*描述:* {{context.message}}"
}
```

**🎨 富文本消息格式**
```json
{
  "channel": "#alerts",
  "attachments": [
    {
      "color": "danger",
      "title": "🚨 系统告警",
      "fields": [
        {
          "title": "告警名称",
          "value": "{{alertName}}",
          "short": true
        },
        {
          "title": "触发时间", 
          "value": "{{context.date}}",
          "short": true
        },
        {
          "title": "告警级别",
          "value": "{{context.rule.params.level}}",
          "short": true
        },
        {
          "title": "详细描述",
          "value": "{{context.message}}",
          "short": false
        }
      ],
      "actions": [
        {
          "type": "button",
          "text": "查看详情",
          "url": "{{context.kibanaBaseUrl}}"
        }
      ]
    }
  ]
}
```

---

## 5. 🏢 企业微信集成


### 5.1 企业微信机器人配置


**🤖 机器人创建步骤**

**步骤1：创建群聊机器人**
```
企业微信群 → 右键群名称 → 添加群机器人
机器人名称：Kibana告警机器人
完成创建 → 复制Webhook地址
```

**步骤2：Kibana连接器配置**
```
连接器类型：Webhook
URL：企业微信机器人webhook地址
方法：POST
Headers：Content-Type: application/json
```

### 5.2 企业微信消息格式


**📝 文本消息格式**
```json
{
  "msgtype": "text",
  "text": {
    "content": "🚨 系统告警\n告警名称：{{alertName}}\n触发时间：{{context.date}}\n告警级别：{{context.rule.params.level}}\n详细描述：{{context.message}}\n\n点击查看：{{context.kibanaBaseUrl}}"
  }
}
```

**📊 Markdown格式消息**
```json
{
  "msgtype": "markdown",
  "markdown": {
    "content": "## 🚨 系统告警\n\n**告警名称：**{{alertName}}\n**触发时间：**{{context.date}}\n**告警级别：**<font color=\"warning\">{{context.rule.params.level}}</font>\n**详细描述：**{{context.message}}\n\n[查看详情]({{context.kibanaBaseUrl}})"
  }
}
```

---

## 6. 📱 钉钉通知配置


### 6.1 钉钉机器人设置


**🔧 创建钉钉机器人**

**步骤1：群设置**
```
钉钉群 → 群设置 → 智能群助手 → 添加机器人
选择：自定义（通过Webhook接入）
```

**步骤2：安全设置**
```
安全设置选择：
• 关键词：Kibana、告警、监控
• IP地址：填入Kibana服务器IP
• 加签：复制密钥用于验证
```

### 6.2 钉钉消息模板


**💬 基础文本消息**
```json
{
  "msgtype": "text",
  "text": {
    "content": "🚨 Kibana系统告警\n\n告警名称：{{alertName}}\n触发时间：{{context.date}}\n告警级别：{{context.rule.params.level}}\n详细描述：{{context.message}}\n\n@所有人"
  },
  "at": {
    "isAtAll": true
  }
}
```

**📋 Link卡片消息**
```json
{
  "msgtype": "link",
  "link": {
    "text": "告警详情：{{context.message}}",
    "title": "🚨 {{alertName}}",
    "picUrl": "",
    "messageUrl": "{{context.kibanaBaseUrl}}"
  }
}
```

---

## 7. 📝 消息模板与变量


### 7.1 常用模板变量


**🔤 系统内置变量**

| **变量名** | **含义** | **示例值** |
|-----------|---------|-----------|
| `{{alertName}}` | `告警规则名称` | `CPU使用率过高` |
| `{{context.date}}` | `触发时间` | `2024-01-15 14:30:00` |
| `{{context.message}}` | `告警描述` | `CPU使用率达到95%` |
| `{{context.rule.name}}` | `规则名称` | `服务器监控规则` |
| `{{context.kibanaBaseUrl}}` | `Kibana访问地址` | `https://kibana.company.com` |

**📊 数据相关变量**
```
{{context.hits}} - 匹配的文档数量
{{context.conditions}} - 触发条件详情  
{{context.value}} - 当前监控值
{{context.threshold}} - 阈值设定
{{context.tags}} - 标签信息
```

### 7.2 自定义消息模板


**✨ 模板设计原则**
- **简洁明了**：关键信息一目了然
- **层次清晰**：重要信息优先显示
- **便于操作**：包含处理链接
- **适配平台**：符合各平台格式要求

**🎨 通用模板示例**
```
🚨 【{{context.rule.params.level}}】{{alertName}}

⏰ 时间：{{context.date}}
📊 当前值：{{context.value}}
🎯 阈值：{{context.threshold}}
📝 描述：{{context.message}}

🔗 查看详情：{{context.kibanaBaseUrl}}
👥 负责人：@运维团队
```

---

## 8. 🔍 通知测试与故障排除


### 8.1 连接器测试


**🧪 测试步骤**

**步骤1：基础连通性测试**
```
Stack Management → Connectors → 选择连接器 → Test
查看测试结果：
✅ 成功：连接器配置正确
❌ 失败：检查配置参数
```

**步骤2：实际告警测试**
```
创建测试告警规则：
条件：简单易触发
动作：使用待测试连接器
观察：是否收到通知
```

### 8.2 常见问题排查


**❌ Email发送失败**
```
问题检查清单：
□ SMTP服务器地址正确
□ 端口号匹配加密方式
□ 用户名密码无误
□ 网络连接正常
□ 邮箱服务商安全设置

解决方案：
• 检查邮箱授权码
• 确认SMTP服务开启
• 测试网络连通性
• 查看Kibana日志
```

**❌ Webhook调用失败**
```
排查步骤：
1. 检查URL格式正确性
2. 验证HTTP方法匹配
3. 确认认证信息有效
4. 测试目标API可访问性
5. 检查请求体格式

调试技巧：
• 使用curl命令测试
• 查看HTTP状态码
• 检查响应内容
• 启用详细日志
```

### 8.3 性能优化建议


**⚡ 优化策略**
- **批量发送**：避免频繁单条通知
- **限流设置**：防止通知轰炸
- **异步处理**：避免阻塞主流程
- **重试机制**：处理临时网络问题

**📊 监控指标**
```
关注指标：
• 通知发送成功率
• 通知延迟时间  
• 连接器错误频率
• 目标系统响应时间

优化建议：
• 成功率低于95%需要排查
• 延迟超过30秒需要优化
• 错误率超过5%需要检查
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的基本概念


```
🔸 连接器作用：Kibana告警信息的传递桥梁
🔸 配置要素：认证信息、消息格式、目标地址
🔸 模板变量：动态填充告警相关信息
🔸 测试验证：确保通知能够正常发送
🔸 故障排查：快速定位和解决配置问题
```

### 9.2 关键理解要点


**🔹 连接器选择原则**
```
团队协作：优选Slack、企业微信、钉钉
系统集成：使用Webhook对接第三方系统
通用通知：Email是最可靠的选择
移动办公：钉钉、企业微信移动端友好
```

**🔹 消息设计要点**
```
信息完整：包含告警的关键要素
格式清晰：便于快速理解和处理
操作便利：提供直接处理链接
平台适配：符合目标平台特性
```

### 9.3 实际应用指导


**🎯 最佳实践**
- **分级通知**：不同级别告警使用不同通知方式
- **多重保障**：重要告警配置多个连接器
- **模板统一**：团队使用一致的消息格式
- **定期测试**：确保通知渠道正常工作

**核心记忆**：
- 连接器是告警通知的桥梁，配置简单但作用重大
- 选择合适的通知方式比复杂的配置更重要
- 消息模板要清晰简洁，包含关键信息
- 定期测试验证，确保关键时刻通知可达