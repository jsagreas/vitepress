---
title: 4、Discover基础搜索操作
---
## 📚 目录

1. [Discover界面认识](#1-discover界面认识)
2. [搜索框基本使用](#2-搜索框基本使用)
3. [字段筛选与展示](#3-字段筛选与展示)
4. [文档详情查看](#4-文档详情查看)
5. [搜索结果排序](#5-搜索结果排序)
6. [字段值统计查看](#6-字段值统计查看)
7. [搜索历史管理](#7-搜索历史管理)
8. [结果导出功能](#8-结果导出功能)
9. [数据表格操作](#9-数据表格操作)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🔍 Discover界面认识


### 1.1 什么是Discover


**简单理解**：Discover就像是Elasticsearch数据的"搜索引擎界面"
- **作用**：让你可以像用百度、谷歌一样搜索你的数据
- **目标**：快速找到你需要的日志、文档或任何存储的数据
- **优势**：不需要写复杂的查询语句，界面操作就能完成大部分搜索

> 💡 **新手理解**  
> 就像你在淘宝搜商品一样，Discover让你在海量数据中快速找到想要的信息

### 1.2 Discover界面布局


```
┌─────────────────────────────────────────────────────────────┐
│  🔍 搜索框                          📅 时间选择器             │
├─────────────────┬───────────────────────────────────────────┤
│                 │  📊 直方图（数据量趋势图）                  │
│  📋 字段列表     ├───────────────────────────────────────────┤
│                 │                                           │
│  - @timestamp   │  📄 搜索结果列表                          │
│  - message      │                                           │
│  - level        │  document 1                               │
│  - host         │  document 2                               │
│  - ...          │  document 3                               │
│                 │  ...                                      │
└─────────────────┴───────────────────────────────────────────┘
```

**各区域功能说明**：
- **🔍 搜索框**：输入搜索条件的地方
- **📅 时间选择器**：选择查看哪个时间段的数据
- **📋 字段列表**：显示数据包含哪些字段（列）
- **📊 直方图**：显示数据量随时间的变化趋势
- **📄 结果列表**：显示符合条件的具体数据

### 1.3 进入Discover的方法


**步骤1**：登录Kibana后，在左侧菜单找到`Discover`
**步骤2**：点击进入，系统会要求你选择一个**索引模式**

> ❗ **重要概念 - 索引模式**  
> 索引模式就是告诉Kibana你要搜索哪些数据。比如：
> - `logstash-*`：搜索所有以logstash开头的索引
> - `nginx-logs-*`：搜索所有nginx日志索引
> - `app-logs-2024*`：搜索2024年的应用日志

---

## 2. 🔎 搜索框基本使用


### 2.1 搜索框的三种模式


**模式1：简单文本搜索**
```
搜索内容：error
含义：查找包含"error"这个词的所有文档
```

**模式2：字段搜索**
```
搜索内容：level:error
含义：查找level字段等于"error"的文档
```

**模式3：KQL查询语言**（稍微高级一点）
```
搜索内容：level:error AND host:web-server-01
含义：查找level是error且host是web-server-01的文档
```

### 2.2 常用的搜索语法


| 搜索语法 | 示例 | 含义 |
|----------|------|------|
| **简单文本** | `exception` | 包含"exception"的文档 |
| **字段等于** | `status:404` | status字段等于404 |
| **字段包含** | `message:*timeout*` | message字段包含"timeout" |
| **AND条件** | `level:error AND host:web01` | 同时满足两个条件 |
| **OR条件** | `level:error OR level:warn` | 满足任意一个条件 |
| **NOT条件** | `NOT level:debug` | 排除debug级别的日志 |

### 2.3 实际搜索示例


**场景1：查找错误日志**
```
搜索：level:error
结果：显示所有错误级别的日志
```

**场景2：查找特定服务器的日志**
```
搜索：host:"web-server-01"
结果：显示来自web-server-01服务器的日志
```

**场景3：查找最近的数据库连接问题**
```
搜索：message:*database* AND message:*connection*
结果：显示消息中包含database和connection的日志
```

> 💡 **搜索技巧**  
> - 用引号包围短语：`"database connection error"`  
> - 用星号做通配符：`*error*`（前后都可以有其他字符）
> - 大小写不敏感：`Error`和`error`效果一样

---

## 3. 📋 字段筛选与展示


### 3.1 理解字段的概念


**什么是字段**：
- 字段就是数据的"属性"或"列"
- 比如一条日志可能有：时间、级别、消息、来源主机等字段

**常见字段示例**：
```
一条Web服务器日志可能包含：
┌─────────────┬─────────────────────────────────────┐
│ 字段名      │ 字段值                              │
├─────────────┼─────────────────────────────────────┤
│ @timestamp  │ 2024-09-21T10:30:45.123Z           │
│ level       │ ERROR                               │
│ message     │ Database connection timeout         │
│ host        │ web-server-01                       │
│ ip          │ 192.168.1.100                       │
│ status_code │ 500                                 │
└─────────────┴─────────────────────────────────────┘
```

### 3.2 字段列表的使用


**左侧字段列表功能**：
- ✅ **查看可用字段**：显示数据包含哪些字段
- ✅ **字段类型显示**：文本、数字、日期等
- ✅ **字段值预览**：点击字段名可以看到该字段的常见值
- ✅ **添加到表格**：选择要在结果中显示的字段

**字段操作步骤**：
1. **查看字段值**：点击字段名旁边的`i`图标
2. **添加字段到表格**：点击字段名旁边的`+`号
3. **移除字段**：点击已添加字段旁边的`-`号

### 3.3 自定义显示字段


**默认显示**：通常只显示`@timestamp`和`_source`（完整文档）

**自定义显示字段的好处**：
- **节省空间**：只显示关心的字段
- **提高效率**：快速浏览重要信息
- **便于分析**：突出关键数据

**操作示例**：
```
需求：只想看时间、级别、消息和主机
操作：
1. 点击 level 字段旁的 + 号
2. 点击 message 字段旁的 + 号  
3. 点击 host 字段旁的 + 号
4. 移除 _source 字段（点击 - 号）

结果：表格只显示这4列，更加清晰
```

### 3.4 字段筛选器的使用


**什么是字段筛选器**：
- 快速筛选字段值的工具
- 点击字段值旁边的`+`（包含）或`-`（排除）

**使用场景**：
```
场景：在搜索结果中看到很多host字段值
操作：点击 "web-server-01" 旁边的 + 号
结果：自动添加 host:"web-server-01" 到搜索条件
```

---

## 4. 📄 文档详情查看


### 4.1 什么是文档详情


**文档**：Elasticsearch中存储的每一条数据记录
**文档详情**：查看这条记录的完整信息

> 💡 **形象理解**  
> 文档就像图书馆里的一本书，文档详情就是打开这本书看里面的详细内容

### 4.2 查看文档详情的方法


**方法1：点击展开箭头**
```
在搜索结果中，每条记录左边有个 > 箭头
点击箭头 → 展开显示文档的详细字段
```

**方法2：查看原始JSON**
```
展开文档后，点击 "JSON" 标签
可以看到这条数据的原始JSON格式
```

### 4.3 文档详情的查看模式


**表格模式**：字段名和字段值以表格形式显示
```
┌─────────────┬─────────────────────────────────────┐
│ Field       │ Value                               │
├─────────────┼─────────────────────────────────────┤
│ @timestamp  │ Sep 21, 2024 @ 10:30:45.123        │
│ level       │ ERROR                               │
│ message     │ Database connection timeout         │
│ host        │ web-server-01                       │
└─────────────┴─────────────────────────────────────┘
```

**JSON模式**：显示原始的JSON数据
```json
{
  "@timestamp": "2024-09-21T10:30:45.123Z",
  "level": "ERROR", 
  "message": "Database connection timeout",
  "host": "web-server-01"
}
```

### 4.4 文档详情的实用功能


**🔍 字段值搜索**：
- 在文档详情中，点击任意字段值旁边的放大镜
- 自动用该值创建新的搜索条件

**📋 字段操作**：
- **添加筛选器**：`+` 号（包含该值）
- **排除筛选器**：`-` 号（排除该值）
- **添加到列**：将字段添加到结果表格显示

**📤 单条数据导出**：
- 可以复制单条文档的JSON数据
- 用于问题分析或与其他人分享

---

## 5. 📊 搜索结果排序


### 5.1 排序的作用和意义


**为什么需要排序**：
- **时间顺序**：按时间查看事件发生顺序
- **重要性排序**：按错误级别、响应时间等排序
- **数值分析**：按数值大小找到极值

### 5.2 默认排序规则


**时间字段排序**：默认按`@timestamp`字段倒序排列
```
最新的数据在最上面 ↓
2024-09-21 10:30:00  ← 最新
2024-09-21 10:29:00
2024-09-21 10:28:00
2024-09-21 10:27:00  ← 较旧
```

### 5.3 自定义排序操作


**步骤1：添加可排序字段到列表**
```
1. 在左侧字段列表中找到要排序的字段
2. 点击字段旁边的 + 号添加到表格
3. 确保该字段是可排序的类型（数字、日期、keyword）
```

**步骤2：点击列标题排序**
```
在结果表格的列标题上点击字段名
第一次点击：升序 ↑
第二次点击：降序 ↓  
第三次点击：取消排序
```

### 5.4 常用排序场景


**场景1：按时间正序查看**
```
需求：从最早的日志开始查看
操作：点击 @timestamp 列标题，选择升序
结果：最老的日志在最上面
```

**场景2：按响应时间排序**
```
需求：找到响应最慢的请求
操作：添加 response_time 字段，按降序排序
结果：响应时间最长的请求在最上面
```

**场景3：按错误级别排序**
```
需求：优先查看严重错误
操作：添加 level 字段，按字母排序
结果：CRITICAL、ERROR、WARN、INFO的顺序
```

> ⚠️ **排序注意事项**  
> - 文本字段需要是`keyword`类型才能排序
> - `text`类型的字段不能直接排序  
> - 排序会影响查询性能，数据量大时要注意

---

## 6. 📈 字段值统计查看


### 6.1 什么是字段值统计


**字段统计**：显示某个字段所有不同值的分布情况
- **作用**：快速了解数据的分布特征
- **用途**：发现异常值、了解数据模式

> 💡 **生活举例**  
> 就像统计班级学生的身高分布，看看多少人是160cm、多少人是170cm等

### 6.2 查看字段统计的方法


**步骤**：
1. 在左侧字段列表中找到要统计的字段
2. 点击字段名（不是+号）
3. 在弹出的面板中查看统计信息

**统计信息包含**：
- **Top 5 值**：出现频率最高的5个值
- **出现次数**：每个值出现了多少次
- **占比**：每个值占总数据的百分比

### 6.3 字段统计的实际应用


**应用场景1：错误分析**
```
字段：level
统计结果：
- ERROR: 1,234 次 (15%)
- WARN:  2,567 次 (31%) 
- INFO:  4,234 次 (54%)

分析：错误率15%，需要关注
```

**应用场景2：服务器负载分析**
```
字段：host
统计结果：
- web-01: 5,234 次 (45%)
- web-02: 3,456 次 (30%)
- web-03: 2,876 次 (25%)

分析：web-01负载最高，可能需要调整
```

**应用场景3：用户行为分析**
```
字段：user_agent
统计结果：
- Chrome: 6,789 次 (67%)
- Firefox: 2,345 次 (23%) 
- Safari: 1,012 次 (10%)

分析：大部分用户使用Chrome浏览器
```

### 6.4 基于统计结果的快速筛选


**从统计直接创建筛选器**：
1. 在字段统计面板中
2. 点击某个值旁边的`+`号（包含）或`-`号（排除）
3. 自动创建筛选条件

**实用技巧**：
```
场景：发现ERROR日志很多，想排除INFO日志
操作：
1. 查看level字段统计
2. 点击INFO旁边的 - 号
3. 自动添加 NOT level:INFO 筛选条件
```

---

## 7. 🗂️ 搜索历史管理


### 7.1 搜索历史的作用


**什么是搜索历史**：
- Kibana自动保存你之前使用过的搜索条件
- 方便重复使用常用的搜索

**使用价值**：
- **提高效率**：不用重复输入复杂搜索条件
- **工作连续性**：快速回到之前的分析状态
- **团队协作**：分享有用的搜索条件

### 7.2 查看和使用搜索历史


**查看历史**：
1. 点击搜索框右侧的时钟图标⏰
2. 显示最近使用的搜索条件列表

**使用历史搜索**：
```
历史搜索示例：
⏰ level:error AND host:web-server-01
⏰ status_code:500 
⏰ message:*timeout*
⏰ level:warn AND @timestamp:[now-1h TO now]

点击任意一条，自动应用该搜索条件
```

### 7.3 保存有用的搜索


**保存搜索的步骤**：
1. 创建好搜索条件
2. 点击顶部的`Save`按钮
3. 输入搜索名称，如"生产环境错误日志"
4. 点击确认保存

**保存搜索的好处**：
- **持久保存**：不会因为浏览器关闭而丢失
- **团队共享**：其他人也可以使用
- **快速访问**：在`Saved Objects`中可以找到

### 7.4 管理保存的搜索


**查看已保存的搜索**：
- 在Discover页面点击`Open`按钮
- 选择要打开的已保存搜索

**常用搜索示例**：
```
📋 我的常用搜索：
1. "生产环境错误" - level:error AND environment:production
2. "数据库问题" - message:*database* AND level:error  
3. "API响应慢" - response_time:>1000
4. "用户登录失败" - action:login AND status:failed
```

> 💡 **最佳实践**  
> 为常用搜索起有意义的名称，比如"周一故障分析"比"搜索1"更有用

---

## 8. 📤 结果导出功能


### 8.1 为什么需要导出数据


**导出的应用场景**：
- **离线分析**：在Excel等工具中进一步分析
- **报告制作**：将数据整理到文档或PPT中
- **数据备份**：保存重要的搜索结果
- **团队分享**：将发现的问题数据分享给同事

### 8.2 导出数据的方法


**CSV格式导出**：
1. 执行搜索，确保结果是你需要的数据
2. 点击顶部的`Share`按钮
3. 选择`CSV Reports`
4. 选择要导出的字段
5. 点击`Generate CSV`

**导出配置选项**：
- **字段选择**：选择要包含在CSV中的字段
- **数量限制**：设置最多导出多少条记录
- **时间格式**：选择时间的显示格式

### 8.3 导出格式和限制


**CSV导出特点**：
```
✅ 优点：
- 可以在Excel中打开
- 文件体积小
- 兼容性好

⚠️ 限制：
- 通常限制导出10,000条记录
- 复杂嵌套数据可能被简化
- 不保留原始JSON结构
```

**导出文件示例**：
```csv
@timestamp,level,message,host
2024-09-21T10:30:00.000Z,ERROR,Database timeout,web-01
2024-09-21T10:29:00.000Z,WARN,High memory usage,web-02
2024-09-21T10:28:00.000Z,INFO,User login,web-01
```

### 8.4 导出的最佳实践


**导出前的准备**：
- **精确搜索**：确保搜索条件准确，避免导出无关数据
- **字段优化**：只选择分析需要的字段
- **时间范围**：合理设置时间范围，避免数据过多

**导出后的处理**：
```
Excel中的常用操作：
1. 数据排序：按时间或重要性排序
2. 数据筛选：使用Excel的筛选功能
3. 数据透视表：统计分析各种维度
4. 图表制作：制作趋势图、饼图等
```

**大数据量导出技巧**：
- **分批导出**：按时间段分别导出
- **字段筛选**：只导出必要字段减少文件大小
- **使用时间切片**：按小时或天分别导出

---

## 9. 📊 数据表格操作


### 9.1 数据表格的基本结构


**表格组成部分**：
```
┌──────────────┬─────────────┬─────────────┬─────────────┐
│ Time         │ level       │ message     │ host        │ ← 列标题
├──────────────┼─────────────┼─────────────┼─────────────┤
│ 10:30:45     │ ERROR       │ DB timeout  │ web-01      │ ← 数据行
│ 10:29:30     │ WARN        │ Memory high │ web-02      │
│ 10:28:15     │ INFO        │ User login  │ web-01      │
└──────────────┴─────────────┴─────────────┴─────────────┘
```

### 9.2 表格列的管理


**添加列**：
- 在左侧字段列表中点击字段旁的`+`号
- 该字段会作为新列添加到表格中

**移除列**：
- 点击列标题旁的`×`号
- 或在字段列表中点击已添加字段的`-`号

**重新排列列的顺序**：
- 拖拽列标题可以调整列的位置
- 把最重要的字段放在最前面

### 9.3 表格数据的查看模式


**紧凑模式**：
- 每行数据显示更紧凑
- 适合查看大量数据的概览

**详细模式**：
- 每行数据显示更多信息
- 适合仔细阅读每条记录

**切换方法**：
在表格右上角找到视图切换按钮进行切换

### 9.4 表格数据的交互操作


**行展开**：
- 点击行首的`>`箭头展开查看完整文档
- 查看该条记录的所有字段信息

**字段值筛选**：
- 将鼠标悬停在任意单元格值上
- 出现`+`和`-`按钮，快速创建筛选条件

**数据复制**：
- 选中单元格内容可以直接复制
- 用于粘贴到其他工具中分析

### 9.5 表格显示优化技巧


**字段选择策略**：
```
✅ 推荐显示：
- @timestamp (时间)
- level (日志级别) 
- message (关键消息)
- host (来源主机)

❌ 不推荐显示：
- _source (完整文档，太占空间)
- _id (系统ID，通常无业务意义)
- 过长的文本字段
```

**表格宽度调整**：
- 拖拽列边界调整列宽
- 双击列边界自动调整到合适宽度

**数据量控制**：
- 默认显示500条记录
- 可以在设置中调整显示数量
- 过多数据会影响浏览器性能

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的基础操作


```
🔸 界面认识：搜索框、字段列表、结果区域的作用
🔸 基本搜索：文本搜索、字段搜索、组合条件搜索
🔸 字段操作：添加字段到表格、查看字段统计、筛选字段值
🔸 结果查看：文档详情、排序、导出、表格操作
🔸 历史管理：使用搜索历史、保存常用搜索
```

### 10.2 关键操作技巧总结


**🔹 搜索效率提升**：
```
快速筛选：点击字段值旁的 + - 按钮
历史复用：使用搜索历史避免重复输入
字段统计：了解数据分布，发现异常
保存搜索：将常用查询保存起来
```

**🔹 数据查看优化**：
```
合理选择显示字段：只显示关心的信息
使用排序：按时间、重要性等排序
文档详情：深入查看具体记录信息
导出分析：将数据导出做进一步分析
```

**🔹 常见搜索模式**：
```
故障排查：level:error AND @timestamp:[now-1h TO now]
性能监控：response_time:>1000 
安全审计：action:login AND status:failed
业务分析：user_id:* AND event_type:purchase
```

### 10.3 新手学习路径建议


**第一阶段：基础操作熟练**
- [x] 熟悉Discover界面布局
- [x] 掌握基本文本搜索
- [x] 学会添加和移除字段
- [x] 了解文档详情查看

**第二阶段：搜索技巧提升**
- [x] 掌握字段搜索语法
- [x] 学会使用AND、OR、NOT
- [x] 熟练使用字段筛选器
- [x] 掌握排序和统计功能

**第三阶段：高效工作流程**
- [x] 建立常用搜索模板
- [x] 掌握数据导出和分析
- [x] 学会团队协作分享
- [x] 优化搜索性能

### 10.4 实际工作应用场景


**运维场景**：
- **故障排查**：快速定位错误日志和异常
- **性能监控**：分析响应时间和系统负载
- **容量规划**：统计资源使用情况

**开发场景**：
- **调试支持**：查找特定用户或功能的日志
- **性能优化**：分析慢查询和瓶颈点
- **用户行为**：了解功能使用情况

**业务场景**：
- **数据分析**：用户行为和业务指标分析
- **安全审计**：登录失败、异常访问监控
- **合规检查**：操作日志的审计和报告

**核心记忆口诀**：
- 搜索先选时间和索引，字段筛选很重要
- 统计排序找规律，详情导出做分析  
- 历史保存提效率，团队协作共进步
- 多练多用成专家，数据探索无难题