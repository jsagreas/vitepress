---
title: 3ã€æ¨¡å—ç³»ç»Ÿä¸å¯¼å…¥å¯¼å‡º
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Œä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–](#1-ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Œä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–)
2. [æ¨¡å—åŒ–è§£å†³çš„æ ¸å¿ƒé—®é¢˜](#2-æ¨¡å—åŒ–è§£å†³çš„æ ¸å¿ƒé—®é¢˜)
3. [CommonJSæ¨¡å—è§„èŒƒè¯¦è§£](#3-CommonJSæ¨¡å—è§„èŒƒè¯¦è§£)
4. [require()å¯¼å…¥æ¨¡å—çš„ç”¨æ³•å’Œæœºåˆ¶](#4-requireå¯¼å…¥æ¨¡å—çš„ç”¨æ³•å’Œæœºåˆ¶)
5. [æ¨¡å—è§£æç®—æ³•å’ŒæŸ¥æ‰¾è§„åˆ™](#5-æ¨¡å—è§£æç®—æ³•å’ŒæŸ¥æ‰¾è§„åˆ™)
6. [å¯¼å‡ºæœºåˆ¶ï¼šmodule.exports vs exports](#6-å¯¼å‡ºæœºåˆ¶ï¼šmodule.exports-vs-exports)
7. [åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—](#7-åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—)
8. [æ¨¡å—ç¼“å­˜æœºåˆ¶](#8-æ¨¡å—ç¼“å­˜æœºåˆ¶)
9. [å¾ªç¯ä¾èµ–å¤„ç†](#9-å¾ªç¯ä¾èµ–å¤„ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯æ¨¡å—ï¼Œä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–


### 1.1 é€šä¿—ç†è§£æ¨¡å—


**æ¨¡å—å°±åƒæ˜¯ä¸€ä¸ªè£…å·¥å…·çš„å·¥å…·ç®±**

```
ä¼ ç»Ÿå¼€å‘ï¼ˆæ²¡æœ‰æ¨¡å—ï¼‰ï¼š
æ‰€æœ‰å·¥å…·éƒ½å †åœ¨ä¸€ä¸ªå¤§ç®±å­é‡Œ
â”œâ”€ èºä¸åˆ€ã€é”¤å­ã€æ‰³æ‰‹å…¨æ··åœ¨ä¸€èµ·
â”œâ”€ æ‰¾å·¥å…·å¾ˆå›°éš¾
â”œâ”€ å®¹æ˜“ä¸¢å¤±å’ŒæŸå
â””â”€ ä¸çŸ¥é“å“ªäº›å·¥å…·æ˜¯é…å¥—çš„

æ¨¡å—åŒ–å¼€å‘ï¼š
æ¯ç§å·¥å…·æœ‰è‡ªå·±çš„å°ç›’å­
â”œâ”€ ğŸ“¦ ç”µå·¥å·¥å…·ç›’ (ç”µå·¥ç›¸å…³åŠŸèƒ½)
â”œâ”€ ğŸ“¦ æœ¨å·¥å·¥å…·ç›’ (æœ¨å·¥ç›¸å…³åŠŸèƒ½)  
â”œâ”€ ğŸ“¦ ä¿®ç†å·¥å…·ç›’ (é€šç”¨ä¿®ç†åŠŸèƒ½)
â””â”€ éœ€è¦ä»€ä¹ˆæ‹¿ä»€ä¹ˆï¼Œæ•´é½æœ‰åº
```

**ğŸ”¸ æ¨¡å—çš„æœ¬è´¨**
- æ¨¡å— = ä¸€ä¸ªç‹¬ç«‹çš„åŠŸèƒ½å•å…ƒ
- æ¯ä¸ªæ¨¡å—æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼ˆç§æœ‰ç©ºé—´ï¼‰
- æ¨¡å—å¯ä»¥æš´éœ²éƒ¨åˆ†åŠŸèƒ½ç»™å…¶ä»–æ¨¡å—ä½¿ç”¨
- æ¨¡å—å¯ä»¥å¼•å…¥å…¶ä»–æ¨¡å—çš„åŠŸèƒ½

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¨¡å—åŒ–


**æ²¡æœ‰æ¨¡å—åŒ–æ—¶çš„ç—›ç‚¹**

```javascript
// ä¼ ç»Ÿæ–¹å¼ï¼šæ‰€æœ‰ä»£ç å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œ
// main.js (1000è¡Œä»£ç )

var userName = "å°æ˜";
var userAge = 20;

function login() { ... }
function logout() { ... }
function sendEmail() { ... }
function parseDate() { ... }
function validateForm() { ... }
// ... è¿˜æœ‰å‡ ç™¾ä¸ªå‡½æ•°

// é—®é¢˜ï¼š
// 1. æ–‡ä»¶å¤ªé•¿ï¼Œéš¾ä»¥ç»´æŠ¤
// 2. å˜é‡åå¯èƒ½å†²çª
// 3. ä¸çŸ¥é“å“ªäº›å‡½æ•°ç›¸å…³
// 4. éš¾ä»¥å¤ç”¨ä»£ç 
```

**æ¨¡å—åŒ–åçš„æ¸…çˆ½ä¸–ç•Œ**

```javascript
// ç”¨æˆ·æ¨¡å— (user.js)
exports.login = function() { ... }
exports.logout = function() { ... }

// é‚®ä»¶æ¨¡å— (email.js)  
exports.send = function() { ... }

// å·¥å…·æ¨¡å— (utils.js)
exports.parseDate = function() { ... }
exports.validateForm = function() { ... }

// ä¸»æ–‡ä»¶ (main.js)
const user = require('./user');
const email = require('./email');
const utils = require('./utils');

user.login();
email.send();
```

---

## 2. ğŸ’¡ æ¨¡å—åŒ–è§£å†³çš„æ ¸å¿ƒé—®é¢˜


### 2.1 å‘½åå†²çªé—®é¢˜


**é—®é¢˜åœºæ™¯ï¼š**
```javascript
// æ²¡æœ‰æ¨¡å—åŒ–æ—¶
var name = "ç”¨æˆ·å"; // ç”¨æˆ·æ¨¡å—çš„name
var name = "å•†å“å"; // å•†å“æ¨¡å—çš„name - å†²çªäº†ï¼

function save() { ... } // ç”¨æˆ·ä¿å­˜
function save() { ... } // å•†å“ä¿å­˜ - åˆå†²çªäº†ï¼
```

**æ¨¡å—åŒ–è§£å†³ï¼š**
```javascript
// user.js
var name = "ç”¨æˆ·å";     // åªåœ¨useræ¨¡å—å†…å¯è§
function save() { ... }  // åªåœ¨useræ¨¡å—å†…å¯è§

// product.js  
var name = "å•†å“å";     // åªåœ¨productæ¨¡å—å†…å¯è§
function save() { ... }  // åªåœ¨productæ¨¡å—å†…å¯è§

// ä¸ä¼šå†²çªï¼æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ç©ºé—´
```

### 2.2 ä¾èµ–ç®¡ç†é—®é¢˜


**é—®é¢˜æ¼”ç¤ºï¼š**
```html
<!-- ä¼ ç»Ÿæ–¹å¼ï¼šå¿…é¡»æ‰‹åŠ¨ç®¡ç†åŠ è½½é¡ºåº -->
<script src="jquery.js"></script>      <!-- å¿…é¡»å…ˆåŠ è½½ -->
<script src="bootstrap.js"></script>   <!-- ä¾èµ–jquery -->
<script src="my-plugin.js"></script>   <!-- ä¾èµ–bootstrap -->
<script src="main.js"></script>        <!-- ä¾èµ–æ‰€æœ‰ä¸Šé¢çš„ -->
```

**æ¨¡å—åŒ–è§£å†³ï¼š**
```javascript
// main.js - åªéœ€è¦å£°æ˜éœ€è¦ä»€ä¹ˆ
const $ = require('jquery');
const bootstrap = require('bootstrap');
const myPlugin = require('./my-plugin');

// Node.jsä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»
```

### 2.3 ä»£ç å¤ç”¨é—®é¢˜


**ğŸ”¸ æ²¡æœ‰æ¨¡å—åŒ–**
```javascript
// æ¯æ¬¡éœ€è¦æ—¥æœŸæ ¼å¼åŒ–éƒ½è¦å¤åˆ¶ç²˜è´´ä»£ç 
function formatDate(date) {
    // 20è¡Œæ ¼å¼åŒ–ä»£ç 
}

// é¡¹ç›®Aä¸­å¤åˆ¶ä¸€ä»½
// é¡¹ç›®Bä¸­å¤åˆ¶ä¸€ä»½  
// é¡¹ç›®Cä¸­å¤åˆ¶ä¸€ä»½
// å¦‚æœå‘ç°bugï¼Œè¦æ”¹Nä¸ªåœ°æ–¹
```

**ğŸ”¸ æ¨¡å—åŒ–è§£å†³**
```javascript
// date-utils.js - å†™ä¸€æ¬¡ï¼Œåˆ°å¤„ç”¨
exports.formatDate = function(date) {
    // 20è¡Œæ ¼å¼åŒ–ä»£ç 
};

// ä»»ä½•é¡¹ç›®éƒ½å¯ä»¥
const dateUtils = require('date-utils');
dateUtils.formatDate(new Date());
```

---

## 3. ğŸ“‹ CommonJSæ¨¡å—è§„èŒƒè¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯CommonJS


> ğŸ’¡ **é€šä¿—ç†è§£**
> 
> CommonJSå°±åƒæ˜¯åˆ¶å®šäº†ä¸€å¥—"åŒ…è£…ç›’æ ‡å‡†"ï¼š
> - ğŸ“¦ æ¯ä¸ªæ¨¡å—éƒ½è¦æ”¾åœ¨æ ‡å‡†ç›’å­é‡Œ
> - ğŸ·ï¸ ç›’å­ä¸Šè¦è´´æ ‡ç­¾è¯´æ˜é‡Œé¢æœ‰ä»€ä¹ˆ
> - ğŸ”— ç›’å­ä¹‹é—´å¯ä»¥ç›¸äº’ä¼ é€’ä¸œè¥¿
> - ğŸ“‹ æ‰€æœ‰äººéƒ½æŒ‰è¿™ä¸ªæ ‡å‡†æ¥ï¼Œå°±èƒ½äº’ç›¸å…¼å®¹

**ğŸ”¸ CommonJSæ ¸å¿ƒç‰¹ç‚¹**
- **åŒæ­¥åŠ è½½**ï¼šrequire()æ—¶ç«‹å³åŠ è½½å¹¶æ‰§è¡Œ
- **ç¼“å­˜æœºåˆ¶**ï¼šåŒä¸€ä¸ªæ¨¡å—åªåŠ è½½ä¸€æ¬¡
- **åŠ¨æ€åŠ è½½**ï¼šå¯ä»¥åœ¨ä»£ç è¿è¡Œæ—¶require
- **æœåŠ¡å™¨ç«¯**ï¼šä¸»è¦ç”¨äºNode.jsç¯å¢ƒ

### 3.2 CommonJSçš„æ ¸å¿ƒæ¦‚å¿µ


```javascript
// æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—
// æ¯ä¸ªæ¨¡å—æœ‰è‡ªå·±ç‹¬ç«‹çš„ä½œç”¨åŸŸ

// math.js - è¿™æ˜¯ä¸€ä¸ªæ¨¡å—
console.log('mathæ¨¡å—è¢«åŠ è½½äº†');

var pi = 3.14159; // ç§æœ‰å˜é‡ï¼Œå¤–éƒ¨è®¿é—®ä¸åˆ°

function add(a, b) {
    return a + b;
}

function multiply(a, b) {
    return a * b;
}

// åªæœ‰é€šè¿‡exportsæš´éœ²çš„æ‰èƒ½è¢«å¤–éƒ¨ä½¿ç”¨
module.exports = {
    add: add,
    multiply: multiply,
    PI: pi
};
```

---

## 4. ğŸ”§ require()å¯¼å…¥æ¨¡å—çš„ç”¨æ³•å’Œæœºåˆ¶


### 4.1 require()çš„åŸºæœ¬ç”¨æ³•


**ğŸ”¸ è¯­æ³•æ ¼å¼**
```javascript
const æ¨¡å—å = require('æ¨¡å—è·¯å¾„');
```

**ğŸ”¸ ä¸‰ç§æ¨¡å—ç±»å‹**

```javascript
// 1. å†…ç½®æ¨¡å—ï¼ˆNode.jsè‡ªå¸¦ï¼‰
const fs = require('fs');           // æ–‡ä»¶ç³»ç»Ÿ
const path = require('path');       // è·¯å¾„å¤„ç†
const http = require('http');       // HTTPæœåŠ¡

// 2. ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆnpmå®‰è£…ï¼‰
const express = require('express'); // Webæ¡†æ¶
const lodash = require('lodash');   // å·¥å…·åº“

// 3. è‡ªå®šä¹‰æ¨¡å—ï¼ˆè‡ªå·±å†™çš„ï¼‰
const myUtils = require('./utils');     // ç›¸å¯¹è·¯å¾„
const config = require('../config');    // ä¸Šçº§ç›®å½•
const userModel = require('./models/user'); // å­ç›®å½•
```

### 4.2 require()çš„å·¥ä½œæœºåˆ¶


```
ç”¨æˆ·è°ƒç”¨: require('./math')
         â†“
ç¬¬1æ­¥: è§£æè·¯å¾„
â”œâ”€ ç›¸å¯¹è·¯å¾„: ./math â†’ /current/path/math
â”œâ”€ æŸ¥æ‰¾æ–‡ä»¶: math.js æˆ– math/index.js
â””â”€ ç¡®å®šå®Œæ•´è·¯å¾„: /current/path/math.js
         â†“
ç¬¬2æ­¥: æ£€æŸ¥ç¼“å­˜
â”œâ”€ å¦‚æœå·²ç¼“å­˜ â†’ ç›´æ¥è¿”å›ç¼“å­˜çš„module.exports
â””â”€ å¦‚æœæœªç¼“å­˜ â†’ ç»§ç»­ä¸‹ä¸€æ­¥
         â†“
ç¬¬3æ­¥: åŠ è½½å¹¶æ‰§è¡Œ
â”œâ”€ è¯»å–æ–‡ä»¶å†…å®¹
â”œâ”€ åŒ…è£…æˆå‡½æ•°
â”œâ”€ æ‰§è¡Œä»£ç 
â”œâ”€ ä¿å­˜åˆ°ç¼“å­˜
â””â”€ è¿”å›module.exports
```

**ğŸ”¸ å®é™…æ¼”ç¤º**

```javascript
// math.js
console.log('mathæ¨¡å—æ­£åœ¨æ‰§è¡Œ');
exports.add = (a, b) => a + b;

// main.js
console.log('å¼€å§‹åŠ è½½æ¨¡å—');
const math1 = require('./math'); // è¾“å‡ºï¼šmathæ¨¡å—æ­£åœ¨æ‰§è¡Œ
console.log('ç¬¬ä¸€æ¬¡åŠ è½½å®Œæˆ');

const math2 = require('./math'); // ä¸ä¼šå†è¾“å‡ºï¼Œç›´æ¥ä»ç¼“å­˜å–
console.log('ç¬¬äºŒæ¬¡åŠ è½½å®Œæˆ');

console.log(math1 === math2); // true - æ˜¯åŒä¸€ä¸ªå¯¹è±¡
```

---

## 5. ğŸ” æ¨¡å—è§£æç®—æ³•å’ŒæŸ¥æ‰¾è§„åˆ™


### 5.1 æ¨¡å—æŸ¥æ‰¾ä¼˜å…ˆçº§


```
require('æ¨¡å—å') çš„æŸ¥æ‰¾é¡ºåºï¼š

1ï¸âƒ£ å†…ç½®æ¨¡å—æ£€æŸ¥
   å¦‚æœæ˜¯ 'fs', 'path', 'http' ç­‰
   â†’ ç›´æ¥è¿”å›å†…ç½®æ¨¡å—

2ï¸âƒ£ æ–‡ä»¶æ¨¡å—æ£€æŸ¥  
   å¦‚æœä»¥ './', '../', '/' å¼€å¤´
   â†’ æŒ‰ç›¸å¯¹/ç»å¯¹è·¯å¾„æŸ¥æ‰¾

3ï¸âƒ£ node_modules æŸ¥æ‰¾
   å¦‚æœä¸æ˜¯ä¸Šè¿°æƒ…å†µ
   â†’ åœ¨å„çº§ node_modules ç›®å½•æŸ¥æ‰¾
```

### 5.2 è¯¦ç»†æŸ¥æ‰¾è§„åˆ™


**ğŸ”¸ æ–‡ä»¶æŸ¥æ‰¾è§„åˆ™**

```javascript
require('./math') çš„æŸ¥æ‰¾è¿‡ç¨‹ï¼š

1. æŸ¥æ‰¾ ./math æ–‡ä»¶
2. æŸ¥æ‰¾ ./math.js æ–‡ä»¶  
3. æŸ¥æ‰¾ ./math.json æ–‡ä»¶
4. æŸ¥æ‰¾ ./math.node æ–‡ä»¶
5. æŸ¥æ‰¾ ./math ç›®å½•ä¸‹çš„ index.js
6. æŸ¥æ‰¾ ./math ç›®å½•ä¸‹çš„ index.json
7. æŸ¥æ‰¾ ./math ç›®å½•ä¸‹çš„ index.node
8. å¦‚æœéƒ½æ²¡æ‰¾åˆ° â†’ æŠ¥é”™
```

**ğŸ”¸ ç¬¬ä¸‰æ–¹æ¨¡å—æŸ¥æ‰¾**

```javascript
// åœ¨ /home/user/project/src/app.js ä¸­æ‰§è¡Œ
require('express')

æŸ¥æ‰¾è·¯å¾„ï¼š
1. /home/user/project/src/node_modules/express
2. /home/user/project/node_modules/express  
3. /home/user/node_modules/express
4. /home/node_modules/express
5. /node_modules/express

ä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æˆ–åˆ°è¾¾æ ¹ç›®å½•
```

### 5.3 package.json çš„ä½œç”¨


```javascript
// express ç›®å½•ç»“æ„
express/
â”œâ”€â”€ package.json    â† åŒ…çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ index.js
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ express.js
â””â”€â”€ ...

// package.json å†…å®¹
{
  "name": "express",
  "main": "index.js",    â† æŒ‡å®šå…¥å£æ–‡ä»¶
  "version": "4.18.0"
}

// require('express') å®é™…åŠ è½½çš„æ˜¯ express/index.js
```

### 5.4 require.cache ç¼“å­˜æŸ¥çœ‹


```javascript
// æŸ¥çœ‹å½“å‰å·²åŠ è½½çš„æ‰€æœ‰æ¨¡å—
console.log(Object.keys(require.cache));

// æŸ¥çœ‹ç‰¹å®šæ¨¡å—çš„ç¼“å­˜ä¿¡æ¯
console.log(require.cache[require.resolve('./math')]);

// æ¸…é™¤æ¨¡å—ç¼“å­˜ï¼ˆå¾ˆå°‘ç”¨åˆ°ï¼‰
delete require.cache[require.resolve('./math')];
const math = require('./math'); // ä¼šé‡æ–°åŠ è½½
```

---

## 6. ğŸ“¤ å¯¼å‡ºæœºåˆ¶ï¼šmodule.exports vs exports


### 6.1 ä¸¤ç§å¯¼å‡ºæ–¹å¼çš„å…³ç³»


> âš ï¸ **é‡è¦ç†è§£**
> 
> `exports` åªæ˜¯ `module.exports` çš„ä¸€ä¸ªå¿«æ·å¼•ç”¨
> 
> å°±åƒï¼š`exports` æ˜¯é¥æ§å™¨ï¼Œ`module.exports` æ˜¯ç”µè§†æœº
> 
> çœŸæ­£èµ·ä½œç”¨çš„æ˜¯ç”µè§†æœºï¼Œé¥æ§å™¨åªæ˜¯ç”¨æ¥æ“ä½œç”µè§†æœºçš„

```javascript
// Node.jså†…éƒ¨å®é™…æ˜¯è¿™æ ·çš„ï¼š
var module = {
  exports: {}
};
var exports = module.exports; // exportsæŒ‡å‘module.exports

// æœ€ç»ˆrequire()è¿”å›çš„æ˜¯module.exports
```

### 6.2 æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼


**âœ… æ–¹å¼1ï¼šä½¿ç”¨ exports æ·»åŠ å±æ€§**

```javascript
// math.js
exports.add = function(a, b) {
    return a + b;
};

exports.PI = 3.14159;

exports.subtract = function(a, b) {
    return a - b;
};

// ç›¸å½“äºï¼š
// module.exports.add = function(a, b) { return a + b; };
// module.exports.PI = 3.14159;
// module.exports.subtract = function(a, b) { return a - b; };
```

**âœ… æ–¹å¼2ï¼šä½¿ç”¨ module.exports æ•´ä½“å¯¼å‡º**

```javascript
// calculator.js
module.exports = {
    add: function(a, b) { return a + b; },
    subtract: function(a, b) { return a - b; },
    PI: 3.14159
};

// æˆ–è€…å¯¼å‡ºä¸€ä¸ªå‡½æ•°
module.exports = function(name) {
    console.log('Hello ' + name);
};

// æˆ–è€…å¯¼å‡ºä¸€ä¸ªç±»
module.exports = class Calculator {
    add(a, b) { return a + b; }
};
```

### 6.3 exports çš„é™·é˜±å’Œæœ€ä½³å®è·µ


**âŒ å¸¸è§é”™è¯¯ï¼šé‡æ–°èµ‹å€¼ exports**

```javascript
// é”™è¯¯ç¤ºä¾‹ - è¿™æ ·åšæ— æ•ˆï¼
exports = {
    add: function(a, b) { return a + b; }
};

// ä¸ºä»€ä¹ˆæ— æ•ˆï¼Ÿ
// å› ä¸ºè¿™æ ·åšåªæ˜¯è®©exportså˜é‡æŒ‡å‘äº†æ–°å¯¹è±¡
// ä½†module.exportsè¿˜æ˜¯æŒ‡å‘åŸæ¥çš„ç©ºå¯¹è±¡{}
// require()è¿”å›çš„æ˜¯module.exportsï¼Œä¸æ˜¯exports
```

**ğŸ“Š å›¾è§£è¯´æ˜**

```
åˆå§‹çŠ¶æ€ï¼š
module.exports = {}  â†â”€â”€ exports æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡

ä½¿ç”¨ exports.add = ... ï¼š
module.exports = { add: function... }  â†â”€â”€ exports è¿˜æ˜¯æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ âœ…

é”™è¯¯çš„ exports = { ... } ï¼š
module.exports = {}           â† require()è¿”å›è¿™ä¸ªç©ºå¯¹è±¡
exports = { add: ... }        â† æŒ‡å‘äº†æ–°å¯¹è±¡ï¼Œä½†æ²¡ç”¨ âŒ
```

**âœ… æœ€ä½³å®è·µå»ºè®®**

```javascript
// ğŸ‘ æ¨èï¼šç»Ÿä¸€ä½¿ç”¨ module.exports
module.exports = {
    add: function(a, b) { return a + b; },
    subtract: function(a, b) { return a - b; }
};

// ğŸ‘ æ¨èï¼šæˆ–è€…ç»Ÿä¸€ä½¿ç”¨ exports.xxx
exports.add = function(a, b) { return a + b; };
exports.subtract = function(a, b) { return a - b; };

// ğŸ‘ ä¸æ¨èï¼šæ··åˆä½¿ç”¨ï¼Œå®¹æ˜“å‡ºé”™
exports.add = function(a, b) { return a + b; };
module.exports = { subtract: function(a, b) { return a - b; } }; // ä¼šè¦†ç›–exports.add
```

---

## 7. ğŸ—ï¸ åˆ›å»ºå’Œä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—


### 7.1 åˆ›å»ºç®€å•çš„å·¥å…·æ¨¡å—


```javascript
// utils.js - å·¥å…·æ¨¡å—
/**
 * å­—ç¬¦ä¸²å·¥å…·å‡½æ•°
 */
exports.capitalize = function(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
};

exports.reverse = function(str) {
    return str.split('').reverse().join('');
};

/**
 * æ•°å­—å·¥å…·å‡½æ•°  
 */
exports.random = function(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
};

exports.isEven = function(num) {
    return num % 2 === 0;
};
```

```javascript
// main.js - ä½¿ç”¨å·¥å…·æ¨¡å—
const utils = require('./utils');

console.log(utils.capitalize('hello'));    // Hello
console.log(utils.reverse('hello'));       // olleh
console.log(utils.random(1, 10));          // éšæœºæ•°1-10
console.log(utils.isEven(4));              // true
```

### 7.2 åˆ›å»ºç±»æ¨¡å—


```javascript
// user.js - ç”¨æˆ·ç±»æ¨¡å—
class User {
    constructor(name, age) {
        this.name = name;
        this.age = age;
    }
    
    greet() {
        return `ä½ å¥½ï¼Œæˆ‘æ˜¯${this.name}ï¼Œä»Šå¹´${this.age}å²`;
    }
    
    isAdult() {
        return this.age >= 18;
    }
}

module.exports = User;
```

```javascript
// main.js - ä½¿ç”¨ç”¨æˆ·ç±»
const User = require('./user');

const user1 = new User('å°æ˜', 20);
const user2 = new User('å°çº¢', 16);

console.log(user1.greet());      // ä½ å¥½ï¼Œæˆ‘æ˜¯å°æ˜ï¼Œä»Šå¹´20å²
console.log(user1.isAdult());    // true
console.log(user2.isAdult());    // false
```

### 7.3 æ¨¡å—çš„ç›®å½•ç»“æ„


```
project/
â”œâ”€â”€ ğŸ“„ main.js              â† ä¸»ç¨‹åº
â”œâ”€â”€ ğŸ“ utils/               â† å·¥å…·æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ index.js         â† å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“„ string.js        â† å­—ç¬¦ä¸²å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“„ number.js        â† æ•°å­—å·¥å…·
â”‚   â””â”€â”€ ğŸ“„ date.js          â† æ—¥æœŸå·¥å…·
â”œâ”€â”€ ğŸ“ models/              â† æ•°æ®æ¨¡å‹ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ user.js          â† ç”¨æˆ·æ¨¡å‹
â”‚   â””â”€â”€ ğŸ“„ product.js       â† äº§å“æ¨¡å‹
â””â”€â”€ ğŸ“ config/              â† é…ç½®æ–‡ä»¶ç›®å½•
    â””â”€â”€ ğŸ“„ database.js      â† æ•°æ®åº“é…ç½®
```

```javascript
// utils/index.js - å·¥å…·æ¨¡å—çš„å…¥å£æ–‡ä»¶
const string = require('./string');
const number = require('./number');
const date = require('./date');

module.exports = {
    string: string,
    number: number,
    date: date
};

// main.js - ä½¿ç”¨æ—¶å¾ˆç®€æ´
const utils = require('./utils'); // è‡ªåŠ¨åŠ è½½ utils/index.js

utils.string.capitalize('hello');
utils.number.random(1, 10);
utils.date.format(new Date());
```

---

## 8. ğŸ’¾ æ¨¡å—ç¼“å­˜æœºåˆ¶


### 8.1 ç¼“å­˜çš„å·¥ä½œåŸç†


**ğŸ”¸ ç¼“å­˜æœºåˆ¶ç¤ºæ„å›¾**

```
ç¬¬ä¸€æ¬¡ require('./math')ï¼š
æ–‡ä»¶ç³»ç»Ÿ â†’ è¯»å–math.js â†’ æ‰§è¡Œä»£ç  â†’ ä¿å­˜ç»“æœåˆ°ç¼“å­˜ â†’ è¿”å›ç»“æœ

ç¬¬äºŒæ¬¡ require('./math')ï¼š
æ£€æŸ¥ç¼“å­˜ â†’ å‘ç°å·²å­˜åœ¨ â†’ ç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼ˆä¸å†æ‰§è¡Œæ–‡ä»¶ï¼‰
```

**ğŸ”¸ å®é™…æ¼”ç¤º**

```javascript
// counter.js
console.log('counteræ¨¡å—è¢«æ‰§è¡Œäº†');

let count = 0;

exports.increment = function() {
    count++;
    return count;
};

exports.getCount = function() {
    return count;
};
```

```javascript
// main.js
const counter1 = require('./counter'); // è¾“å‡ºï¼šcounteræ¨¡å—è¢«æ‰§è¡Œäº†
const counter2 = require('./counter'); // ä¸ä¼šå†è¾“å‡º

console.log(counter1.increment()); // 1
console.log(counter2.increment()); // 2 (å…±äº«åŒä¸€ä¸ªcountå˜é‡)
console.log(counter1.getCount());  // 2

console.log(counter1 === counter2); // true - æ˜¯åŒä¸€ä¸ªå¯¹è±¡
```

### 8.2 ç¼“å­˜çš„å¥½å¤„å’Œæ³¨æ„äº‹é¡¹


**âœ… ç¼“å­˜çš„å¥½å¤„**
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…é‡å¤æ–‡ä»¶è¯»å–å’Œä»£ç æ‰§è¡Œ
- **çŠ¶æ€ä¿æŒ**ï¼šæ¨¡å—å†…çš„å˜é‡çŠ¶æ€ä¼šä¿æŒ
- **å•ä¾‹æ¨¡å¼**ï¼šå¤©ç„¶å®ç°å•ä¾‹ï¼Œå¤šæ¬¡requireå¾—åˆ°åŒä¸€ä¸ªå®ä¾‹

**âš ï¸ éœ€è¦æ³¨æ„çš„åœ°æ–¹**
```javascript
// config.js
let config = {
    debug: false,
    port: 3000
};

exports.setDebug = function(value) {
    config.debug = value;
};

exports.getConfig = function() {
    return config;
};
```

```javascript
// main.js
const config1 = require('./config');
const config2 = require('./config');

config1.setDebug(true);
console.log(config2.getConfig().debug); // true - çŠ¶æ€è¢«å…±äº«äº†

// åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç§å…±äº«å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„
```

### 8.3 æ¸…é™¤ç¼“å­˜çš„æ–¹æ³•


```javascript
// æŸ¥çœ‹æŸä¸ªæ¨¡å—çš„å®Œæ•´è·¯å¾„
const modulePath = require.resolve('./math');
console.log(modulePath); // /full/path/to/math.js

// åˆ é™¤æ¨¡å—ç¼“å­˜
delete require.cache[modulePath];

// é‡æ–°åŠ è½½æ¨¡å—ï¼ˆä¼šé‡æ–°æ‰§è¡Œä»£ç ï¼‰
const math = require('./math');
```

---

## 9. ğŸ”„ å¾ªç¯ä¾èµ–å¤„ç†


### 9.1 ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–


**ğŸ”¸ å¾ªç¯ä¾èµ–ç¤ºæ„å›¾**

```
a.js ä¾èµ– b.js
   â†“
b.js ä¾èµ– a.js
   â†“
å½¢æˆå¾ªç¯ï¼ša â†’ b â†’ a â†’ b â†’ ...
```

### 9.2 å¾ªç¯ä¾èµ–çš„é—®é¢˜æ¼”ç¤º


```javascript
// a.js
console.log('aæ¨¡å—å¼€å§‹æ‰§è¡Œ');
const b = require('./b');
console.log('aæ¨¡å—ä¸­bæ˜¯:', b);

exports.name = 'moduleA';
exports.sayHello = function() {
    console.log('Hello from A');
};

console.log('aæ¨¡å—æ‰§è¡Œç»“æŸ');
```

```javascript
// b.js  
console.log('bæ¨¡å—å¼€å§‹æ‰§è¡Œ');
const a = require('./a'); // è¿™é‡Œä¼šäº§ç”Ÿå¾ªç¯ä¾èµ–
console.log('bæ¨¡å—ä¸­aæ˜¯:', a);

exports.name = 'moduleB';
exports.sayHello = function() {
    console.log('Hello from B');
};

console.log('bæ¨¡å—æ‰§è¡Œç»“æŸ');
```

```javascript
// main.js
const a = require('./a');

// æ‰§è¡Œç»“æœï¼š
// aæ¨¡å—å¼€å§‹æ‰§è¡Œ
// bæ¨¡å—å¼€å§‹æ‰§è¡Œ  
// bæ¨¡å—ä¸­aæ˜¯: {} (ç©ºå¯¹è±¡ï¼)
// bæ¨¡å—æ‰§è¡Œç»“æŸ
// aæ¨¡å—ä¸­bæ˜¯: { name: 'moduleB', sayHello: [Function] }
// aæ¨¡å—æ‰§è¡Œç»“æŸ
```

### 9.3 ä¸ºä»€ä¹ˆä¼šå‡ºç°ç©ºå¯¹è±¡


```
æ‰§è¡Œæµç¨‹åˆ†æï¼š

1. main.js æ‰§è¡Œ require('./a')
2. a.js å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ° require('./b')  
3. b.js å¼€å§‹æ‰§è¡Œï¼Œé‡åˆ° require('./a')
4. æ­¤æ—¶a.jsè¿˜æ²¡æ‰§è¡Œå®Œï¼Œmodule.exportsè¿˜æ˜¯{}
5. b.jså¾—åˆ°ç©ºçš„aå¯¹è±¡
6. b.jsæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ç»™a.js
7. a.jsç»§ç»­æ‰§è¡Œå®Œæ¯•
```

### 9.4 é¿å…å¾ªç¯ä¾èµ–çš„æ–¹æ³•


**âœ… æ–¹æ³•1ï¼šé‡æ–°è®¾è®¡æ¨¡å—ç»“æ„**

```javascript
// å°†å…±åŒä¾èµ–æå–åˆ°ç¬¬ä¸‰ä¸ªæ¨¡å—

// common.js - å…±åŒçš„å·¥å…·
exports.formatMessage = function(name, message) {
    return `[${name}] ${message}`;
};

// a.js - ä¸å†ä¾èµ–b  
const common = require('./common');
exports.messageA = function() {
    return common.formatMessage('A', 'Hello from A');
};

// b.js - ä¸å†ä¾èµ–a
const common = require('./common');
exports.messageB = function() {
    return common.formatMessage('B', 'Hello from B');
};
```

**âœ… æ–¹æ³•2ï¼šå»¶è¿Ÿrequire**

```javascript
// a.js
exports.sayHello = function() {
    const b = require('./b'); // åœ¨å‡½æ•°å†…éƒ¨require
    return 'A says: ' + b.sayHello();
};

// b.js
exports.sayHello = function() {
    return 'Hello from B';
};
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¨¡å—åŒ–æœ¬è´¨ï¼šä»£ç çš„å°è£…å’Œå¤ç”¨æœºåˆ¶
ğŸ”¸ CommonJSè§„èŒƒï¼šNode.jsä½¿ç”¨çš„æ¨¡å—æ ‡å‡†
ğŸ”¸ require()æœºåˆ¶ï¼šåŒæ­¥åŠ è½½ï¼Œç¼“å­˜ç»“æœï¼Œè·¯å¾„è§£æ
ğŸ”¸ exportså¯¼å‡ºï¼šmodule.exportsæ˜¯çœŸæ­£çš„å¯¼å‡ºï¼Œexportsæ˜¯å¿«æ·æ–¹å¼
ğŸ”¸ æ¨¡å—ç¼“å­˜ï¼šåŒä¸€æ¨¡å—åªæ‰§è¡Œä¸€æ¬¡ï¼Œç»“æœè¢«ç¼“å­˜
ğŸ”¸ å¾ªç¯ä¾èµ–ï¼šéœ€è¦é¿å…ï¼Œæˆ–è€…é‡æ–°è®¾è®¡æ¨¡å—ç»“æ„
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¨¡å—çš„æœ¬è´¨**
```
æ¨¡å— = ç‹¬ç«‹çš„ä½œç”¨åŸŸ + æ˜ç¡®çš„æ¥å£
- ä½œç”¨åŸŸï¼šå†…éƒ¨å˜é‡ä¸ä¼šæ±¡æŸ“å…¨å±€
- æ¥å£ï¼šé€šè¿‡exportsæš´éœ²åŠŸèƒ½ç»™å¤–éƒ¨
```

**ğŸ”¹ require()çš„å·¥ä½œæµç¨‹**
```
è§£æè·¯å¾„ â†’ æ£€æŸ¥ç¼“å­˜ â†’ åŠ è½½æ‰§è¡Œ â†’ è¿”å›exports
```

**ğŸ”¹ exports vs module.exports**
```
è®°ä½ï¼šrequire()è¿”å›çš„æ˜¯module.exports
exportsåªæ˜¯module.exportsçš„å¼•ç”¨
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“ æ¨¡å—è®¾è®¡åŸåˆ™**
- **å•ä¸€èŒè´£**ï¼šä¸€ä¸ªæ¨¡å—åªåšä¸€ä»¶äº‹
- **æ¥å£æ¸…æ™°**ï¼šå¯¼å‡ºçš„åŠŸèƒ½è¦æ˜ç¡®æœ‰ç”¨
- **é¿å…å‰¯ä½œç”¨**ï¼šæ¨¡å—åŠ è½½ä¸åº”è¯¥äº§ç”Ÿæ„å¤–çš„å‰¯ä½œç”¨
- **åˆç†ç²’åº¦**ï¼šä¸è¦è¿‡åº¦æ‹†åˆ†ï¼Œä¹Ÿä¸è¦è¿‡åº¦èšåˆ

**ğŸ”§ å®ç”¨æŠ€å·§**
```javascript
// 1. ä½¿ç”¨ç»å¯¹è·¯å¾„é¿å…ç›¸å¯¹è·¯å¾„æ··ä¹±
const path = require('path');
const myModule = require(path.join(__dirname, 'modules', 'user'));

// 2. ä½¿ç”¨index.jsä½œä¸ºç›®å½•çš„å…¥å£
const utils = require('./utils'); // è‡ªåŠ¨åŠ è½½utils/index.js

// 3. æ¨¡å—å†…éƒ¨é”™è¯¯è¦åŠæ—¶æŠ›å‡º
exports.divide = function(a, b) {
    if (b === 0) {
        throw new Error('é™¤æ•°ä¸èƒ½ä¸ºé›¶');
    }
    return a / b;
};
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ¨¡å—å°è£…åŠŸèƒ½ï¼Œrequireå¼•å…¥ä½¿ç”¨
- è·¯å¾„ç›¸å¯¹ç»å¯¹ï¼Œç¼“å­˜æé«˜æ•ˆç‡  
- exportsæš´éœ²æ¥å£ï¼Œmoduleæ˜¯æ ¹åŸº
- å¾ªç¯ä¾èµ–è¦é¿å…ï¼Œè®¾è®¡åˆç†æ˜¯å…³é”®