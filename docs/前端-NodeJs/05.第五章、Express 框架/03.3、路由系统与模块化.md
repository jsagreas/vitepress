---
title: 3ã€è·¯ç”±ç³»ç»Ÿä¸æ¨¡å—åŒ–
---
## ğŸ“š ç›®å½•

1. [è·¯ç”±åŸºç¡€æ¦‚å¿µ](#1-è·¯ç”±åŸºç¡€æ¦‚å¿µ)
2. [HTTPæ–¹æ³•ä¸è¯­ä¹‰åŒ–ä½¿ç”¨](#2-HTTPæ–¹æ³•ä¸è¯­ä¹‰åŒ–ä½¿ç”¨)
3. [è·¯ç”±è·¯å¾„ä¸æ¨¡å¼åŒ¹é…](#3-è·¯ç”±è·¯å¾„ä¸æ¨¡å¼åŒ¹é…)
4. [è·¯ç”±å¤„ç†å‡½æ•°è¿›é˜¶](#4-è·¯ç”±å¤„ç†å‡½æ•°è¿›é˜¶)
5. [è·¯ç”±æ¨¡å—åŒ–å®è·µ](#5-è·¯ç”±æ¨¡å—åŒ–å®è·µ)
6. [è·¯ç”±ä¸­é—´ä»¶ä¸å‚æ•°éªŒè¯](#6-è·¯ç”±ä¸­é—´ä»¶ä¸å‚æ•°éªŒè¯)
7. [æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ](#7-æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¤ï¸ è·¯ç”±åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è·¯ç”±ï¼Ÿ


**é€šä¿—ç†è§£**ï¼šè·¯ç”±å°±åƒæ˜¯**å¿«é€’åˆ†æ‹£ä¸­å¿ƒ**ï¼Œæ ¹æ®åŒ…è£¹ä¸Šçš„åœ°å€ï¼Œå†³å®šæŠŠåŒ…è£¹é€åˆ°å“ªé‡Œå»ã€‚

```
ç°å®ç”Ÿæ´»ä¸­çš„å¿«é€’åˆ†æ‹£ï¼š
åŒ…è£¹åœ°å€ï¼š"åŒ—äº¬å¸‚æœé˜³åŒºXXX" â†’ åˆ†æ‹£åˆ°åŒ—äº¬åˆ†éƒ¨
åŒ…è£¹åœ°å€ï¼š"ä¸Šæµ·å¸‚æµ¦ä¸œåŒºXXX" â†’ åˆ†æ‹£åˆ°ä¸Šæµ·åˆ†éƒ¨

Express è·¯ç”±åˆ†æ‹£ï¼š
è¯·æ±‚åœ°å€ï¼š"/users" â†’ ç”¨æˆ·ç›¸å…³å¤„ç†å‡½æ•°
è¯·æ±‚åœ°å€ï¼š"/orders" â†’ è®¢å•ç›¸å…³å¤„ç†å‡½æ•°
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- ğŸ¯ **è·¯ç”±**ï¼šå†³å®šåº”ç”¨ç¨‹åºå¦‚ä½•å“åº”å®¢æˆ·ç«¯å¯¹ç‰¹å®šç«¯ç‚¹çš„è¯·æ±‚
- ğŸ“ **ç«¯ç‚¹**ï¼šç”±è·¯å¾„å’ŒHTTPæ–¹æ³•ç»„æˆçš„å”¯ä¸€æ ‡è¯†
- ğŸ”§ **å¤„ç†å‡½æ•°**ï¼šå½“è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œçš„ä»£ç 

### 1.2 è·¯ç”±çš„ç»„æˆéƒ¨åˆ†


```javascript
app.get('/users/:id', (req, res) => {
  // å¤„ç†é€»è¾‘
});
```

**ä¸‰è¦ç´ åˆ†è§£**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app.get('/users/:id', callback)    â”‚
â”‚   â”‚   â”‚      â”‚          â”‚          â”‚
â”‚   â”‚   â”‚      â”‚          â””â”€â”€ å¤„ç†å‡½æ•° â”‚
â”‚   â”‚   â”‚      â””â”€â”€ è·¯å¾„æ¨¡å¼           â”‚
â”‚   â”‚   â””â”€â”€ HTTPæ–¹æ³•                 â”‚
â”‚   â””â”€â”€ Expressåº”ç”¨å®ä¾‹               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 è·¯ç”±å·¥ä½œæµç¨‹


```
å®¢æˆ·ç«¯è¯·æ±‚                Expressè·¯ç”±åŒ¹é…                å¤„ç†å‡½æ•°æ‰§è¡Œ
     â”‚                         â”‚                         â”‚
     â–¼                         â–¼                         â–¼
  GET /users/123  â”€â”€â”€â”€â”€â”€â”€â”€â–º  å¯»æ‰¾åŒ¹é…çš„è·¯ç”±  â”€â”€â”€â”€â”€â”€â”€â”€â–º  æ‰§è¡Œå¯¹åº”é€»è¾‘
     â”‚                         â”‚                         â”‚
     â”‚                         â–¼                         â–¼
     â”‚                     åŒ¹é…æˆåŠŸï¼Ÿ                  è¿”å›å“åº”
     â”‚                         â”‚                         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸš€ HTTPæ–¹æ³•ä¸è¯­ä¹‰åŒ–ä½¿ç”¨


### 2.1 å¸¸ç”¨HTTPæ–¹æ³•è¯¦è§£


**ğŸ’¡ è®°å¿†æŠ€å·§**ï¼šæŠŠHTTPæ–¹æ³•æƒ³è±¡æˆ**å¯¹æ•°æ®çš„ä¸åŒæ“ä½œ**

| HTTPæ–¹æ³• | **å«ä¹‰** | **ç±»æ¯”** | **ç”¨é€”** |
|---------|---------|---------|---------|
| `GET` | `è·å–` | `çœ‹ä¹¦ğŸ“–` | `æŸ¥è¯¢æ•°æ®ï¼Œä¸ä¿®æ”¹ä»»ä½•å†…å®¹` |
| `POST` | `åˆ›å»º` | `å†™æ–°æ—¥è®°ğŸ“` | `æ–°å¢æ•°æ®ï¼Œåˆ›å»ºæ–°èµ„æº` |
| `PUT` | `æ›´æ–°` | `é‡å†™æ•´é¡µğŸ“„` | `å®Œæ•´æ›´æ–°ï¼Œæ›¿æ¢æ•´ä¸ªèµ„æº` |
| `PATCH` | `éƒ¨åˆ†æ›´æ–°` | `ä¿®æ”¹å‡ ä¸ªå­—âœï¸` | `éƒ¨åˆ†æ›´æ–°ï¼Œåªä¿®æ”¹æŒ‡å®šå­—æ®µ` |
| `DELETE` | `åˆ é™¤` | `æ’•æ‰é¡µé¢ğŸ—‘ï¸` | `åˆ é™¤æŒ‡å®šèµ„æº` |



| æ–¹æ³• | **ç”¨é€”** | **ç‰¹ç‚¹** | **å®é™…ä¾‹å­** |
|------|---------|----------|-------------|
| `GET` | **æŸ¥çœ‹ä¿¡æ¯** | `ä¸æ”¹å˜æ•°æ®ï¼Œå¯ç¼“å­˜` | `çœ‹å•†å“è¯¦æƒ…` |
| `POST` | **æäº¤è¡¨å•** | `åˆ›å»ºæ–°å†…å®¹` | `æ³¨å†Œæ–°è´¦å·` |
| `PUT` | **å®Œæ•´æ›¿æ¢** | `æ›´æ–°å…¨éƒ¨ä¿¡æ¯` | `é‡æ–°ç¼–è¾‘ä¸ªäººèµ„æ–™` |
| `PATCH` | **å±€éƒ¨ä¿®æ”¹** | `åªæ”¹éƒ¨åˆ†ä¿¡æ¯` | `åªæ”¹å¤´åƒ` |
| `DELETE` | **åˆ é™¤å†…å®¹** | `ç§»é™¤æ•°æ®` | `åˆ é™¤è´­ç‰©è½¦å•†å“` |






### 2.2 è¯­ä¹‰åŒ–ä½¿ç”¨ç¤ºä¾‹


```javascript
// ç”¨æˆ·ç®¡ç†çš„å®Œæ•´ CRUD æ“ä½œ
const express = require('express');
const app = express();

// ğŸ“– GET - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ï¼‰
app.get('/users', (req, res) => {
  res.json({ users: ['å¼ ä¸‰', 'æå››', 'ç‹äº”'] });
});

// ğŸ“– GET - è·å–å•ä¸ªç”¨æˆ·ï¼ˆæŸ¥çœ‹ç‰¹å®šç”¨æˆ·ï¼‰
app.get('/users/:id', (req, res) => {
  res.json({ user: `ç”¨æˆ·${req.params.id}çš„ä¿¡æ¯` });
});

// ğŸ“ POST - åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆæ³¨å†Œæ–°ç”¨æˆ·ï¼‰
app.post('/users', (req, res) => {
  res.json({ message: 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ', id: 123 });
});

// ğŸ“„ PUT - å®Œæ•´æ›´æ–°ç”¨æˆ·ï¼ˆæ›´æ–°ç”¨æˆ·å…¨éƒ¨ä¿¡æ¯ï¼‰
app.put('/users/:id', (req, res) => {
  res.json({ message: `ç”¨æˆ·${req.params.id}ä¿¡æ¯å·²å®Œå…¨æ›´æ–°` });
});

// âœï¸ PATCH - éƒ¨åˆ†æ›´æ–°ç”¨æˆ·ï¼ˆåªæ›´æ–°ç”¨æˆ·å¤´åƒï¼‰
app.patch('/users/:id', (req, res) => {
  res.json({ message: `ç”¨æˆ·${req.params.id}å¤´åƒå·²æ›´æ–°` });
});

// ğŸ—‘ï¸ DELETE - åˆ é™¤ç”¨æˆ·
app.delete('/users/:id', (req, res) => {
  res.json({ message: `ç”¨æˆ·${req.params.id}å·²åˆ é™¤` });
});
```

### 2.3 æ–¹æ³•é€‰æ‹©çš„å®é™…åœºæ™¯


**ğŸ’­ å®é™…åº”ç”¨æ€è€ƒ**ï¼š
```
åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•
âŒ é”™è¯¯ï¼šPOST /users/login  ï¼ˆè¯­ä¹‰ä¸æ˜ç¡®ï¼‰
âœ… æ­£ç¡®ï¼šPOST /auth/login   ï¼ˆåˆ›å»ºç™»å½•ä¼šè¯ï¼‰

åœºæ™¯2ï¼šä¿®æ”¹ç”¨æˆ·å¯†ç 
âŒ é”™è¯¯ï¼šPUT /users/123    ï¼ˆä¼šæ›¿æ¢æ•´ä¸ªç”¨æˆ·ä¿¡æ¯ï¼‰
âœ… æ­£ç¡®ï¼šPATCH /users/123  ï¼ˆåªä¿®æ”¹å¯†ç å­—æ®µï¼‰

åœºæ™¯3ï¼šè·å–å•†å“åˆ—è¡¨
âŒ é”™è¯¯ï¼šPOST /products    ï¼ˆä¸åº”è¯¥ç”¨POSTæŸ¥è¯¢ï¼‰
âœ… æ­£ç¡®ï¼šGET /products     ï¼ˆè·å–æ•°æ®ç”¨GETï¼‰
```

---

## 3. ğŸ¯ è·¯ç”±è·¯å¾„ä¸æ¨¡å¼åŒ¹é…


### 3.1 åŸºç¡€è·¯å¾„åŒ¹é…


**å­—ç¬¦ä¸²è·¯å¾„**ï¼š
```javascript
// ç²¾ç¡®åŒ¹é…
app.get('/about', handler);           // åªåŒ¹é… /about
app.get('/users', handler);           // åªåŒ¹é… /users
app.get('/products/list', handler);   // åªåŒ¹é… /products/list
```

**é€šé…ç¬¦è·¯å¾„**ï¼š
```javascript
// ? è¡¨ç¤ºå¯é€‰å­—ç¬¦
app.get('/ab?cd', handler);   // åŒ¹é… /acd æˆ– /abcd

// + è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ª
app.get('/ab+cd', handler);   // åŒ¹é… /abcdã€/abbcdã€/abbbcd ç­‰

// * è¡¨ç¤ºä»»æ„å­—ç¬¦
app.get('/ab*cd', handler);   // åŒ¹é… /abcdã€/abxcdã€/abRANDOMcd ç­‰

// () è¡¨ç¤ºåˆ†ç»„
app.get('/ab(cd)?e', handler); // åŒ¹é… /abe æˆ– /abcde
```

### 3.2 å‚æ•°è·¯å¾„ï¼ˆæœ€é‡è¦â­ï¼‰


**åŠ¨æ€å‚æ•°**ï¼š
```javascript
// åŸºç¡€å‚æ•°
app.get('/users/:id', (req, res) => {
  const userId = req.params.id;
  res.json({ message: `ç”¨æˆ·IDæ˜¯${userId}` });
});

// å¤šä¸ªå‚æ•°
app.get('/users/:userId/posts/:postId', (req, res) => {
  const { userId, postId } = req.params;
  res.json({ 
    message: `ç”¨æˆ·${userId}çš„æ–‡ç« ${postId}` 
  });
});

// å¯é€‰å‚æ•°
app.get('/products/:id?', (req, res) => {
  if (req.params.id) {
    res.json({ product: `å•†å“${req.params.id}` });
  } else {
    res.json({ products: 'æ‰€æœ‰å•†å“åˆ—è¡¨' });
  }
});
```

### 3.3 æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„


```javascript
// æ•°å­—IDé™åˆ¶
app.get('/users/:id(\\d+)', (req, res) => {
  // åªåŒ¹é…æ•°å­—IDï¼Œå¦‚ /users/123
  res.json({ userId: req.params.id });
});

// æ–‡ä»¶æ‰©å±•ååŒ¹é…
app.get('/files/*.(jpg|jpeg|png)', (req, res) => {
  // åŒ¹é…å›¾ç‰‡æ–‡ä»¶ï¼Œå¦‚ /files/avatar.jpg
  res.sendFile(req.params[0]);
});

// é‚®ç®±æ ¼å¼éªŒè¯
app.get('/verify/:email([\\w\\._%+-]+@[\\w\\.-]+\\.[A-Za-z]{2,})', (req, res) => {
  res.json({ email: req.params.email, valid: true });
});
```

### 3.4 è·¯å¾„åŒ¹é…ä¼˜å…ˆçº§


```javascript
// âš ï¸ æ³¨æ„ï¼šè·¯ç”±é¡ºåºå¾ˆé‡è¦ï¼
app.get('/users/new', (req, res) => {
  res.json({ page: 'æ–°å»ºç”¨æˆ·é¡µé¢' });
});

app.get('/users/:id', (req, res) => {
  res.json({ user: `ç”¨æˆ·${req.params.id}` });
});

// æ­£ç¡®é¡ºåºï¼šå…·ä½“çš„è·¯ç”±è¦æ”¾åœ¨åŠ¨æ€è·¯ç”±å‰é¢
// /users/new ä¼šåŒ¹é…ç¬¬ä¸€ä¸ªè·¯ç”±
// /users/123 ä¼šåŒ¹é…ç¬¬äºŒä¸ªè·¯ç”±
```

---

## 4. âš™ï¸ è·¯ç”±å¤„ç†å‡½æ•°è¿›é˜¶


### 4.1 å•ä¸ªå¤„ç†å‡½æ•°


```javascript
// åŸºç¡€å¤„ç†å‡½æ•°
app.get('/simple', (req, res) => {
  res.json({ message: 'ç®€å•å¤„ç†å‡½æ•°' });
});

// å¼‚æ­¥å¤„ç†å‡½æ•°
app.get('/async', async (req, res) => {
  try {
    const data = await fetchDataFromDatabase();
    res.json(data);
  } catch (error) {
    res.status(500).json({ error: 'æœåŠ¡å™¨é”™è¯¯' });
  }
});
```

### 4.2 å¤šä¸ªå¤„ç†å‡½æ•°é“¾å¼è°ƒç”¨


**ğŸ’¡ ç†è§£é“¾å¼è°ƒç”¨**ï¼šå°±åƒ**å·¥å‚æµæ°´çº¿**ï¼Œæ¯ä¸ªç¯èŠ‚å¤„ç†ä¸€éƒ¨åˆ†å·¥ä½œ

```
è¯·æ±‚è¿›å…¥ â†’ èº«ä»½éªŒè¯ â†’ æƒé™æ£€æŸ¥ â†’ ä¸šåŠ¡é€»è¾‘ â†’ è¿”å›å“åº”
    â”‚          â”‚          â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼          â–¼          â–¼
  ä¸­é—´ä»¶1    ä¸­é—´ä»¶2    ä¸­é—´ä»¶3    æœ€ç»ˆå¤„ç†    å‘é€å“åº”
```

```javascript
// èº«ä»½éªŒè¯ä¸­é—´ä»¶
function authenticate(req, res, next) {
  const token = req.headers.authorization;
  if (token) {
    req.user = { id: 1, name: 'å¼ ä¸‰' }; // æ¨¡æ‹Ÿç”¨æˆ·ä¿¡æ¯
    next(); // ç»§ç»­ä¸‹ä¸€ä¸ªå¤„ç†å‡½æ•°
  } else {
    res.status(401).json({ error: 'æœªæˆæƒ' });
  }
}

// æƒé™æ£€æŸ¥ä¸­é—´ä»¶
function checkPermission(req, res, next) {
  if (req.user.id === 1) {
    next(); // æœ‰æƒé™ï¼Œç»§ç»­
  } else {
    res.status(403).json({ error: 'æƒé™ä¸è¶³' });
  }
}

// ä¸šåŠ¡é€»è¾‘å¤„ç†
function getSecretData(req, res) {
  res.json({ 
    secret: 'è¿™æ˜¯æœºå¯†æ•°æ®',
    user: req.user.name 
  });
}

// é“¾å¼è°ƒç”¨ï¼šéªŒè¯ â†’ æƒé™ â†’ ä¸šåŠ¡é€»è¾‘
app.get('/secret', authenticate, checkPermission, getSecretData);
```

### 4.3 æ•°ç»„å½¢å¼çš„å¤„ç†å‡½æ•°


```javascript
// æŠŠä¸­é—´ä»¶ç»„ç»‡æˆæ•°ç»„
const middlewares = [authenticate, checkPermission];

app.get('/admin/users', middlewares, (req, res) => {
  res.json({ users: ['ç®¡ç†å‘˜ç”¨æˆ·åˆ—è¡¨'] });
});

// æ··åˆä½¿ç”¨
app.get('/mixed', 
  authenticate,           // å•ä¸ªä¸­é—´ä»¶
  [checkPermission],      // æ•°ç»„ä¸­é—´ä»¶
  (req, res) => {         // æœ€ç»ˆå¤„ç†å‡½æ•°
    res.json({ message: 'æ··åˆä½¿ç”¨ç¤ºä¾‹' });
  }
);
```

### 4.4 é”™è¯¯å¤„ç†å‡½æ•°


```javascript
// é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼ˆ4ä¸ªå‚æ•°ï¼‰
function errorHandler(err, req, res, next) {
  console.error('é”™è¯¯è¯¦æƒ…:', err);
  
  if (err.type === 'validation') {
    res.status(400).json({ error: 'å‚æ•°éªŒè¯å¤±è´¥' });
  } else {
    res.status(500).json({ error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯' });
  }
}

// åœ¨è·¯ç”±ä¸­æŠ›å‡ºé”™è¯¯
app.get('/error-demo', (req, res, next) => {
  const error = new Error('æ•…æ„åˆ¶é€ çš„é”™è¯¯');
  error.type = 'validation';
  next(error); // ä¼ é€’é”™è¯¯ç»™é”™è¯¯å¤„ç†ä¸­é—´ä»¶
});

// æ³¨å†Œé”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼ˆå¿…é¡»åœ¨æœ€åï¼‰
app.use(errorHandler);
```

---

## 5. ğŸ“¦ è·¯ç”±æ¨¡å—åŒ–å®è·µ


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è·¯ç”±æ¨¡å—åŒ–ï¼Ÿ


**é—®é¢˜åœºæ™¯**ï¼š
```javascript
// ğŸ˜° æ‰€æœ‰è·¯ç”±éƒ½å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œ
app.get('/users', handler1);
app.post('/users', handler2);
app.get('/users/:id', handler3);
app.put('/users/:id', handler4);
app.delete('/users/:id', handler5);
app.get('/orders', handler6);
app.post('/orders', handler7);
app.get('/orders/:id', handler8);
// ... å‡ ç™¾è¡Œè·¯ç”±ä»£ç 
```

**ğŸ˜µ é—®é¢˜**ï¼š
- æ–‡ä»¶å¤ªé•¿ï¼Œéš¾ä»¥ç»´æŠ¤
- ä¸åŒåŠŸèƒ½æ··åœ¨ä¸€èµ·
- å›¢é˜Ÿåä½œå›°éš¾
- ä»£ç å¤ç”¨æ€§å·®

### 5.2 express.Router åŸºç¡€ç”¨æ³•


**Router æ˜¯ä»€ä¹ˆ**ï¼šæŠŠ Router æƒ³è±¡æˆ**å°å‹çš„ Express åº”ç”¨**ï¼Œä¸“é—¨å¤„ç†æŸä¸ªåŠŸèƒ½æ¨¡å—çš„è·¯ç”±ã€‚

**åˆ›å»ºç”¨æˆ·è·¯ç”±æ¨¡å—**ï¼š
```javascript
// routes/users.js - ç”¨æˆ·ç›¸å…³è·¯ç”±
const express = require('express');
const router = express.Router();

// ğŸ”¸ æ³¨æ„ï¼šè¿™é‡Œçš„è·¯å¾„æ˜¯ç›¸å¯¹äºæŒ‚è½½ç‚¹çš„
router.get('/', (req, res) => {
  res.json({ message: 'è·å–ç”¨æˆ·åˆ—è¡¨' });
});

router.get('/:id', (req, res) => {
  res.json({ message: `è·å–ç”¨æˆ·${req.params.id}` });
});

router.post('/', (req, res) => {
  res.json({ message: 'åˆ›å»ºæ–°ç”¨æˆ·' });
});

router.put('/:id', (req, res) => {
  res.json({ message: `æ›´æ–°ç”¨æˆ·${req.params.id}` });
});

router.delete('/:id', (req, res) => {
  res.json({ message: `åˆ é™¤ç”¨æˆ·${req.params.id}` });
});

module.exports = router;
```

**åœ¨ä¸»åº”ç”¨ä¸­ä½¿ç”¨**ï¼š
```javascript
// app.js - ä¸»åº”ç”¨æ–‡ä»¶
const express = require('express');
const userRoutes = require('./routes/users');

const app = express();

// æŒ‚è½½ç”¨æˆ·è·¯ç”±åˆ° /users è·¯å¾„
app.use('/users', userRoutes);

// ç°åœ¨å¯ä»¥è®¿é—®ï¼š
// GET /users        â†’ router.get('/')
// GET /users/123    â†’ router.get('/:id')
// POST /users       â†’ router.post('/')
// PUT /users/123    â†’ router.put('/:id')
// DELETE /users/123 â†’ router.delete('/:id')
```

### 5.3 é¡¹ç›®ç»“æ„ç»„ç»‡


**æ¨èçš„æ–‡ä»¶ç»“æ„**ï¼š
```
project/
â”œâ”€â”€ app.js                 # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ routes/                # è·¯ç”±æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ index.js          # è·¯ç”±æ±‡æ€»æ–‡ä»¶
â”‚   â”œâ”€â”€ users.js          # ç”¨æˆ·è·¯ç”±
â”‚   â”œâ”€â”€ orders.js         # è®¢å•è·¯ç”±
â”‚   â”œâ”€â”€ products.js       # å•†å“è·¯ç”±
â”‚   â””â”€â”€ auth.js           # è®¤è¯è·¯ç”±
â”œâ”€â”€ middleware/           # ä¸­é—´ä»¶ç›®å½•
â”‚   â”œâ”€â”€ auth.js          # è®¤è¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ validation.js    # éªŒè¯ä¸­é—´ä»¶
â””â”€â”€ controllers/         # æ§åˆ¶å™¨ç›®å½•
    â”œâ”€â”€ userController.js
    â””â”€â”€ orderController.js
```

**è·¯ç”±æ±‡æ€»æ–‡ä»¶**ï¼š
```javascript
// routes/index.js - è·¯ç”±å…¥å£æ–‡ä»¶
const express = require('express');
const router = express.Router();

// å¯¼å…¥å„ä¸ªæ¨¡å—çš„è·¯ç”±
const userRoutes = require('./users');
const orderRoutes = require('./orders');
const productRoutes = require('./products');
const authRoutes = require('./auth');

// ç»Ÿä¸€æŒ‚è½½è·¯ç”±
router.use('/users', userRoutes);
router.use('/orders', orderRoutes);
router.use('/products', productRoutes);
router.use('/auth', authRoutes);

// æ ¹è·¯å¾„
router.get('/', (req, res) => {
  res.json({ 
    message: 'APIæœåŠ¡æ­£å¸¸è¿è¡Œ',
    endpoints: ['/users', '/orders', '/products', '/auth']
  });
});

module.exports = router;
```

**ä¸»åº”ç”¨æ–‡ä»¶**ï¼š
```javascript
// app.js
const express = require('express');
const routes = require('./routes');

const app = express();

// ä½¿ç”¨ç»Ÿä¸€çš„è·¯ç”±
app.use('/api', routes);

app.listen(3000, () => {
  console.log('æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000');
});
```

### 5.4 Router é«˜çº§ç”¨æ³•


**Router çº§åˆ«çš„ä¸­é—´ä»¶**ï¼š
```javascript
// routes/admin.js - ç®¡ç†å‘˜è·¯ç”±
const express = require('express');
const router = express.Router();

// ç®¡ç†å‘˜è®¤è¯ä¸­é—´ä»¶
function adminAuth(req, res, next) {
  if (req.headers.admin === 'true') {
    next();
  } else {
    res.status(403).json({ error: 'éœ€è¦ç®¡ç†å‘˜æƒé™' });
  }
}

// ğŸ”¸ æ‰€æœ‰ç®¡ç†å‘˜è·¯ç”±éƒ½éœ€è¦è®¤è¯
router.use(adminAuth);

router.get('/dashboard', (req, res) => {
  res.json({ message: 'ç®¡ç†å‘˜ä»ªè¡¨æ¿' });
});

router.get('/users', (req, res) => {
  res.json({ message: 'ç®¡ç†å‘˜æŸ¥çœ‹ç”¨æˆ·' });
});

module.exports = router;
```

**åµŒå¥—è·¯ç”±**ï¼š
```javascript
// routes/users.js - ç”¨æˆ·è·¯ç”±withåµŒå¥—
const express = require('express');
const router = express.Router();

// ç”¨æˆ·çš„æ–‡ç« è·¯ç”±
const userPostsRouter = express.Router({ mergeParams: true });

userPostsRouter.get('/', (req, res) => {
  const userId = req.params.userId; // æ¥è‡ªçˆ¶è·¯ç”±çš„å‚æ•°
  res.json({ message: `ç”¨æˆ·${userId}çš„æ‰€æœ‰æ–‡ç« ` });
});

userPostsRouter.get('/:postId', (req, res) => {
  const { userId, postId } = req.params;
  res.json({ message: `ç”¨æˆ·${userId}çš„æ–‡ç« ${postId}` });
});

// æŒ‚è½½åµŒå¥—è·¯ç”±
router.use('/:userId/posts', userPostsRouter);

// ç”¨æˆ·åŸºç¡€è·¯ç”±
router.get('/', (req, res) => {
  res.json({ message: 'ç”¨æˆ·åˆ—è¡¨' });
});

router.get('/:userId', (req, res) => {
  res.json({ message: `ç”¨æˆ·${req.params.userId}` });
});

module.exports = router;
```

---

## 6. ğŸ›¡ï¸ è·¯ç”±ä¸­é—´ä»¶ä¸å‚æ•°éªŒè¯


### 6.1 è·¯ç”±å‚æ•°éªŒè¯


**ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°éªŒè¯**ï¼š
```
ç”¨æˆ·è¯·æ±‚ï¼šGET /users/abc123
æœŸæœ›ï¼šæ•°å­—ID
å®é™…ï¼šå­—ç¬¦ä¸²

æ²¡æœ‰éªŒè¯ï¼šç¨‹åºå¯èƒ½å´©æºƒ ğŸ’¥
æœ‰äº†éªŒè¯ï¼šå‹å¥½çš„é”™è¯¯æç¤º âœ…
```

**åŸºç¡€å‚æ•°éªŒè¯**ï¼š
```javascript
// ä¸­é—´ä»¶/éªŒè¯.js
function validateUserId(req, res, next) {
  const { id } = req.params;
  
  // æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
  if (!/^\d+$/.test(id)) {
    return res.status(400).json({ 
      error: 'ç”¨æˆ·IDå¿…é¡»æ˜¯æ•°å­—',
      received: id 
    });
  }
  
  // æ£€æŸ¥IDèŒƒå›´
  const userId = parseInt(id);
  if (userId < 1 || userId > 999999) {
    return res.status(400).json({ 
      error: 'ç”¨æˆ·IDå¿…é¡»åœ¨1-999999ä¹‹é—´' 
    });
  }
  
  // éªŒè¯é€šè¿‡ï¼Œæ·»åŠ åˆ°è¯·æ±‚å¯¹è±¡
  req.validatedUserId = userId;
  next();
}

// åœ¨è·¯ç”±ä¸­ä½¿ç”¨
router.get('/:id', validateUserId, (req, res) => {
  // è¿™é‡Œå¯ä»¥å®‰å…¨ä½¿ç”¨ req.validatedUserId
  res.json({ 
    userId: req.validatedUserId,
    message: 'å‚æ•°éªŒè¯é€šè¿‡' 
  });
});
```

**é€šç”¨å‚æ•°éªŒè¯å‡½æ•°**ï¼š
```javascript
// åˆ›å»ºéªŒè¯å™¨å·¥å‚å‡½æ•°
function createValidator(field, rules) {
  return (req, res, next) => {
    const value = req.params[field];
    
    for (const rule of rules) {
      if (!rule.test(value)) {
        return res.status(400).json({
          error: rule.message,
          field: field,
          value: value
        });
      }
    }
    
    next();
  };
}

// å®šä¹‰éªŒè¯è§„åˆ™
const idRules = [
  {
    test: (value) => /^\d+$/.test(value),
    message: 'IDå¿…é¡»æ˜¯æ•°å­—'
  },
  {
    test: (value) => parseInt(value) > 0,
    message: 'IDå¿…é¡»å¤§äº0'
  }
];

// ä½¿ç”¨éªŒè¯å™¨
const validateId = createValidator('id', idRules);

router.get('/users/:id', validateId, (req, res) => {
  res.json({ message: 'éªŒè¯é€šè¿‡' });
});
```

### 6.2 æŸ¥è¯¢å‚æ•°éªŒè¯


```javascript
// åˆ†é¡µå‚æ•°éªŒè¯
function validatePagination(req, res, next) {
  const { page = 1, limit = 10 } = req.query;
  
  // è½¬æ¢ä¸ºæ•°å­—
  const pageNum = parseInt(page);
  const limitNum = parseInt(limit);
  
  // éªŒè¯åˆ†é¡µå‚æ•°
  if (isNaN(pageNum) || pageNum < 1) {
    return res.status(400).json({ error: 'é¡µç å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—' });
  }
  
  if (isNaN(limitNum) || limitNum < 1 || limitNum > 100) {
    return res.status(400).json({ error: 'æ¯é¡µæ•°é‡å¿…é¡»åœ¨1-100ä¹‹é—´' });
  }
  
  // æ·»åŠ éªŒè¯åçš„å‚æ•°
  req.pagination = {
    page: pageNum,
    limit: limitNum,
    offset: (pageNum - 1) * limitNum
  };
  
  next();
}

// ä½¿ç”¨åˆ†é¡µéªŒè¯
router.get('/users', validatePagination, (req, res) => {
  const { page, limit, offset } = req.pagination;
  res.json({
    message: `è·å–ç¬¬${page}é¡µï¼Œæ¯é¡µ${limit}æ¡æ•°æ®`,
    offset: offset
  });
});
```

### 6.3 è¯·æ±‚ä½“éªŒè¯


```javascript
// ç”¨æˆ·æ³¨å†Œæ•°æ®éªŒè¯
function validateUserRegistration(req, res, next) {
  const { username, email, password } = req.body;
  const errors = [];
  
  // ç”¨æˆ·åéªŒè¯
  if (!username || username.length < 3) {
    errors.push('ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦');
  }
  
  // é‚®ç®±éªŒè¯
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email || !emailRegex.test(email)) {
    errors.push('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
  }
  
  // å¯†ç éªŒè¯
  if (!password || password.length < 6) {
    errors.push('å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦');
  }
  
  if (errors.length > 0) {
    return res.status(400).json({
      error: 'æ•°æ®éªŒè¯å¤±è´¥',
      details: errors
    });
  }
  
  next();
}

router.post('/register', validateUserRegistration, (req, res) => {
  res.json({ message: 'æ³¨å†ŒæˆåŠŸ' });
});
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ


### 7.1 è·¯ç”±ç¼“å­˜ç­–ç•¥


**é™æ€å†…å®¹ç¼“å­˜**ï¼š
```javascript
// è®¾ç½®é™æ€èµ„æºç¼“å­˜
router.get('/static/*', (req, res, next) => {
  // è®¾ç½®ç¼“å­˜å¤´
  res.set({
    'Cache-Control': 'public, max-age=86400', // ç¼“å­˜1å¤©
    'ETag': `"${Date.now()}"` // ç®€å•çš„ETag
  });
  next();
});

// APIå“åº”ç¼“å­˜
const cache = new Map(); // ç®€å•å†…å­˜ç¼“å­˜

function cacheMiddleware(duration = 300) { // é»˜è®¤5åˆ†é’Ÿ
  return (req, res, next) => {
    const key = req.originalUrl;
    const cached = cache.get(key);
    
    if (cached && Date.now() - cached.timestamp < duration * 1000) {
      return res.json(cached.data);
    }
    
    // é‡å†™res.jsonæ¥ç¼“å­˜å“åº”
    const originalJson = res.json;
    res.json = function(data) {
      cache.set(key, {
        data: data,
        timestamp: Date.now()
      });
      originalJson.call(this, data);
    };
    
    next();
  };
}

// ä½¿ç”¨ç¼“å­˜
router.get('/products', cacheMiddleware(600), (req, res) => {
  // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
  const products = ['å•†å“1', 'å•†å“2', 'å•†å“3'];
  res.json({ products });
});
```

### 7.2 è·¯ç”±ç»„ç»‡æœ€ä½³å®è·µ


**ğŸ”¥ æ ¸å¿ƒåŸåˆ™**ï¼š
1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªè·¯ç”±æ–‡ä»¶åªå¤„ç†ä¸€ç±»èµ„æº
2. **RESTfulè®¾è®¡**ï¼šéµå¾ªREST APIè®¾è®¡è§„èŒƒ
3. **ä¸­é—´ä»¶å¤ç”¨**ï¼šæå–å…¬å…±é€»è¾‘åˆ°ä¸­é—´ä»¶
4. **é”™è¯¯ç»Ÿä¸€å¤„ç†**ï¼šé›†ä¸­å¤„ç†é”™è¯¯

**é¡¹ç›®è·¯ç”±è§„èŒƒ**ï¼š
```javascript
// è‰¯å¥½çš„è·¯ç”±ç»„ç»‡ç¤ºä¾‹
const express = require('express');
const router = express.Router();

// ğŸ“‹ ç»Ÿä¸€çš„å“åº”æ ¼å¼
function formatResponse(data, message = 'success') {
  return {
    code: 200,
    message: message,
    data: data,
    timestamp: new Date().toISOString()
  };
}

// ğŸ“‹ ç»Ÿä¸€çš„é”™è¯¯å“åº”
function formatError(message, code = 400) {
  return {
    code: code,
    message: message,
    data: null,
    timestamp: new Date().toISOString()
  };
}

// ğŸ“‹ RESTful ç”¨æˆ·èµ„æºè·¯ç”±
router.route('/')
  .get((req, res) => {
    res.json(formatResponse(['ç”¨æˆ·åˆ—è¡¨'], 'è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ'));
  })
  .post((req, res) => {
    res.json(formatResponse({ id: 123 }, 'åˆ›å»ºç”¨æˆ·æˆåŠŸ'));
  });

router.route('/:id')
  .get((req, res) => {
    res.json(formatResponse({ id: req.params.id }, 'è·å–ç”¨æˆ·æˆåŠŸ'));
  })
  .put((req, res) => {
    res.json(formatResponse({ id: req.params.id }, 'æ›´æ–°ç”¨æˆ·æˆåŠŸ'));
  })
  .delete((req, res) => {
    res.json(formatResponse(null, 'åˆ é™¤ç”¨æˆ·æˆåŠŸ'));
  });

module.exports = router;
```

### 7.3 è·¯ç”±æ€§èƒ½ç›‘æ§


```javascript
// è·¯ç”±æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
function performanceMonitor(req, res, next) {
  const startTime = Date.now();
  
  // ç›‘å¬å“åº”ç»“æŸäº‹ä»¶
  res.on('finish', () => {
    const duration = Date.now() - startTime;
    const method = req.method;
    const url = req.originalUrl;
    const status = res.statusCode;
    
    // è®°å½•æ…¢æŸ¥è¯¢ï¼ˆè¶…è¿‡1ç§’ï¼‰
    if (duration > 1000) {
      console.warn(`ğŸŒ æ…¢æŸ¥è¯¢: ${method} ${url} - ${duration}ms - ${status}`);
    } else {
      console.log(`âš¡ ${method} ${url} - ${duration}ms - ${status}`);
    }
  });
  
  next();
}

// å…¨å±€ä½¿ç”¨æ€§èƒ½ç›‘æ§
app.use(performanceMonitor);
```

### 7.4 åŠ¨æ€è·¯ç”±ä¼˜åŒ–


```javascript
// é¿å…è¿‡åº¦åŠ¨æ€çš„è·¯ç”±
// âŒ ä¸å¥½çš„åšæ³•
router.get('/:action/:id?', (req, res) => {
  const { action, id } = req.params;
  
  switch (action) {
    case 'list':
      // å¤„ç†åˆ—è¡¨
      break;
    case 'detail':
      // å¤„ç†è¯¦æƒ…
      break;
    case 'edit':
      // å¤„ç†ç¼–è¾‘
      break;
    default:
      res.status(404).json({ error: 'Action not found' });
  }
});

// âœ… æ›´å¥½çš„åšæ³•
router.get('/list', (req, res) => {
  // ä¸“é—¨å¤„ç†åˆ—è¡¨
});

router.get('/:id', validateId, (req, res) => {
  // ä¸“é—¨å¤„ç†è¯¦æƒ…
});

router.get('/:id/edit', validateId, (req, res) => {
  // ä¸“é—¨å¤„ç†ç¼–è¾‘
});
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ è·¯ç”±æœ¬è´¨ï¼šæ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œæ–¹æ³•ï¼Œå†³å®šæ‰§è¡Œå“ªä¸ªå¤„ç†å‡½æ•°
ğŸš€ HTTPæ–¹æ³•ï¼šGETæŸ¥è¯¢ã€POSTåˆ›å»ºã€PUTæ›´æ–°ã€PATCHéƒ¨åˆ†æ›´æ–°ã€DELETEåˆ é™¤
ğŸª è·¯å¾„åŒ¹é…ï¼šå­—ç¬¦ä¸²ã€å‚æ•°ã€é€šé…ç¬¦ã€æ­£åˆ™è¡¨è¾¾å¼å››ç§æ–¹å¼
âš™ï¸ å¤„ç†å‡½æ•°ï¼šå•ä¸ªå‡½æ•°ã€ä¸­é—´ä»¶é“¾ã€é”™è¯¯å¤„ç†çš„çµæ´»ç»„åˆ
ğŸ“¦ æ¨¡å—åŒ–ï¼šç”¨Routeråˆ†ç¦»ä¸åŒåŠŸèƒ½ï¼Œä¿æŒä»£ç æ•´æ´
ğŸ›¡ï¸ å‚æ•°éªŒè¯ï¼šä¿è¯æ•°æ®å®‰å…¨ï¼Œæä¾›å‹å¥½é”™è¯¯æç¤º
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è·¯ç”±å°±åƒå¿«é€’åˆ†æ‹£**
```
è¯·æ±‚åœ°å€ â†’ è·¯ç”±åŒ¹é… â†’ å¤„ç†å‡½æ•° â†’ è¿”å›å“åº”
å°±åƒåŒ…è£¹æ ¹æ®åœ°å€é€åˆ°ä¸åŒåœ°æ–¹ä¸€æ ·ç®€å•
```

**ğŸ”¹ HTTPæ–¹æ³•è¦è¯­ä¹‰åŒ–**
```
GET     = çœ‹/è¯»å–ï¼Œä¸æ”¹å˜ä»»ä½•ä¸œè¥¿
POST    = æ–°å»º/åˆ›å»ºæ–°çš„ä¸œè¥¿  
PUT     = å®Œå…¨æ›¿æ¢/é‡å†™æ•´ä¸ªå†…å®¹
PATCH   = éƒ¨åˆ†ä¿®æ”¹/åªæ”¹ä¸€ç‚¹ç‚¹
DELETE  = åˆ é™¤/ç§»é™¤
```

**ğŸ”¹ ä¸­é—´ä»¶åƒæµæ°´çº¿**
```
è¯·æ±‚ â†’ ä¸­é—´ä»¶1 â†’ ä¸­é—´ä»¶2 â†’ ä¸­é—´ä»¶3 â†’ æœ€ç»ˆå¤„ç† â†’ å“åº”
æ¯ä¸ªç¯èŠ‚å¤„ç†ä¸€éƒ¨åˆ†å·¥ä½œï¼Œå¯ä»¥éšæ—¶ä¸­æ­¢
```

**ğŸ”¹ æ¨¡å—åŒ–è®©ä»£ç æ›´æ¸…æ™°**
```
ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªåŠŸèƒ½ï¼š
- users.js    å¤„ç†ç”¨æˆ·ç›¸å…³
- orders.js   å¤„ç†è®¢å•ç›¸å…³  
- auth.js     å¤„ç†è®¤è¯ç›¸å…³
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ æ–°æ‰‹å…¥é—¨æ­¥éª¤**ï¼š
1. **å…ˆå†™ç®€å•è·¯ç”±**ï¼š`app.get('/hello', (req, res) => res.send('Hello'))`
2. **å­¦ä¼šç”¨å‚æ•°**ï¼š`app.get('/users/:id', ...)`
3. **æŒæ¡HTTPæ–¹æ³•**ï¼šGETã€POSTã€PUTã€DELETE
4. **æ·»åŠ å‚æ•°éªŒè¯**ï¼šç¡®ä¿æ•°æ®å®‰å…¨
5. **å­¦ä¼šæ¨¡å—åŒ–**ï¼šç”¨Routeråˆ†ç¦»åŠŸèƒ½
6. **ä¼˜åŒ–æ€§èƒ½**ï¼šæ·»åŠ ç¼“å­˜å’Œç›‘æ§

**ğŸ’¡ å¸¸è§é”™è¯¯é¿å…**ï¼š
- âŒ è·¯ç”±é¡ºåºé”™è¯¯ï¼ˆå…·ä½“è·¯ç”±è¦åœ¨åŠ¨æ€è·¯ç”±å‰é¢ï¼‰
- âŒ å¿˜è®°è°ƒç”¨`next()`å¯¼è‡´è¯·æ±‚å¡ä½
- âŒ å‚æ•°éªŒè¯ä¸å……åˆ†å¯¼è‡´ç¨‹åºå´©æºƒ
- âŒ æ‰€æœ‰è·¯ç”±å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œéš¾ä»¥ç»´æŠ¤

**ğŸš€ è¿›é˜¶å­¦ä¹ æ–¹å‘**ï¼š
- å­¦ä¹ æ›´å¤šéªŒè¯åº“ï¼ˆå¦‚joiã€express-validatorï¼‰
- æŒæ¡è·¯ç”±æƒé™æ§åˆ¶
- äº†è§£APIæ–‡æ¡£ç”Ÿæˆï¼ˆswaggerï¼‰
- å­¦ä¹ è·¯ç”±æµ‹è¯•æ–¹æ³•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è·¯ç”±åˆ†æ‹£å¾ˆç®€å•ï¼Œåœ°å€æ–¹æ³•å®šæ–¹å‘
å‚æ•°éªŒè¯è¦åšå¥½ï¼Œä¸­é—´ä»¶é“¾åƒæµæ°´
æ¨¡å—åˆ†ç¦»åŠŸèƒ½æ¸…ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸èƒ½å¿˜
GETæŸ¥POSTå»ºPUTæ”¹ï¼ŒDELETEåˆ è¦è®°ç‰¢
```