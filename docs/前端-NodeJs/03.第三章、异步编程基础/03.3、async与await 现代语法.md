---
title: 3ã€asyncä¸await ç°ä»£è¯­æ³•
---
## ğŸ“š ç›®å½•

1. [async/await æ˜¯ä»€ä¹ˆ](#1-async-await-æ˜¯ä»€ä¹ˆ)
2. [async å‡½æ•°è¯¦è§£](#2-async-å‡½æ•°è¯¦è§£)
3. [await å…³é”®å­—ä½¿ç”¨](#3-await-å…³é”®å­—ä½¿ç”¨)
4. [é”™è¯¯å¤„ç†æœºåˆ¶](#4-é”™è¯¯å¤„ç†æœºåˆ¶)
5. [å¹¶å‘ä¸ä¸²è¡Œæ‰§è¡Œ](#5-å¹¶å‘ä¸ä¸²è¡Œæ‰§è¡Œ)
6. [å¾ªç¯ä¸­çš„ä½¿ç”¨æŠ€å·§](#6-å¾ªç¯ä¸­çš„ä½¿ç”¨æŠ€å·§)
7. [ä¸Promiseçš„é€‰æ‹©å¯¹æ¯”](#7-ä¸promiseçš„é€‰æ‹©å¯¹æ¯”)
8. [å®é™…åº”ç”¨åœºæ™¯](#8-å®é™…åº”ç”¨åœºæ™¯)
9. [å¸¸è§é™·é˜±ä¸é¿å‘æŒ‡å—](#9-å¸¸è§é™·é˜±ä¸é¿å‘æŒ‡å—)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ async/await æ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£


**ç®€å•æ¥è¯´**ï¼šasync/await æ˜¯è®©å¼‚æ­¥ä»£ç å†™èµ·æ¥åƒåŒæ­¥ä»£ç ä¸€æ ·ç®€å•çš„è¯­æ³•ç³–ã€‚

```
ä¼ ç»Ÿå†™æ³•ï¼ˆéš¾è¯»éš¾ç»´æŠ¤ï¼‰ï¼š         ç°ä»£å†™æ³•ï¼ˆæ¸…æ™°æ˜“æ‡‚ï¼‰ï¼š
getData()                     async function main() {
  .then(data => {                const data = await getData();
    return processData(data);     const result = await processData(data);
  })                             console.log(result);
  .then(result => {            }
    console.log(result);
  });
```

### 1.2 æœ¬è´¨ç†è§£


> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šasync/await æœ¬è´¨ä¸Šè¿˜æ˜¯ Promiseï¼Œåªæ˜¯æ¢äº†ä¸€ç§æ›´ä¼˜é›…çš„å†™æ³•

- **async**ï¼šå‘Šè¯‰ JavaScript "è¿™ä¸ªå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œ"
- **await**ï¼šå‘Šè¯‰ JavaScript "ç­‰ä¸€ä¸‹ï¼Œå…ˆå®Œæˆè¿™ä¸ªå¼‚æ­¥æ“ä½œå†ç»§ç»­"

### 1.3 è§£å†³çš„ç—›ç‚¹


**Promise é“¾å¼è°ƒç”¨çš„é—®é¢˜**ï¼š
```javascript
// ğŸš« Promise é“¾å¼è°ƒç”¨ - å®¹æ˜“äº§ç”Ÿ"åµŒå¥—åœ°ç‹±"
function fetchUserData(userId) {
  return fetchUser(userId)
    .then(user => {
      return fetchUserPosts(user.id)
        .then(posts => {
          return fetchPostComments(posts[0].id)
            .then(comments => {
              return { user, posts, comments };
            });
        });
    });
}
```

**async/await çš„è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// âœ… async/await - ä»£ç æ¸…æ™°æ˜“è¯»
async function fetchUserData(userId) {
  const user = await fetchUser(userId);
  const posts = await fetchUserPosts(user.id);
  const comments = await fetchPostComments(posts[0].id);
  return { user, posts, comments };
}
```

---

## 2. ğŸ”§ async å‡½æ•°è¯¦è§£


### 2.1 async å‡½æ•°çš„åŸºæœ¬ç‰¹æ€§


**å£°æ˜æ–¹å¼**ï¼š
```javascript
// å‡½æ•°å£°æ˜
async function getName() {
  return 'Node.js';
}

// å‡½æ•°è¡¨è¾¾å¼
const getName = async function() {
  return 'Node.js';
};

// ç®­å¤´å‡½æ•°
const getName = async () => {
  return 'Node.js';
};
```

### 2.2 async å‡½æ•°è¿”å›å€¼çš„ç§˜å¯†


> âš ï¸ **é‡è¦**ï¼šasync å‡½æ•°**æ€»æ˜¯**è¿”å› Promiseï¼Œæ— è®ºä½ å†™ä»€ä¹ˆ

```javascript
// çœ‹èµ·æ¥è¿”å›å­—ç¬¦ä¸²
async function test1() {
  return 'hello';
}

// å®é™…è¿”å› Promise
console.log(test1()); // Promise { 'hello' }

// è¦è·å–å®é™…å€¼ï¼Œéœ€è¦ç”¨ then æˆ– await
test1().then(result => console.log(result)); // 'hello'
```

**è¿”å›å€¼è§„åˆ™**ï¼š
```javascript
async function examples() {
  // 1. è¿”å›æ™®é€šå€¼ â†’ åŒ…è£…æˆ resolved Promise
  return 'success'; // Promise.resolve('success')
  
  // 2. è¿”å› Promise â†’ ç›´æ¥è¿”å›è¿™ä¸ª Promise
  return Promise.resolve('data'); // åŸæ ·è¿”å›
  
  // 3. æŠ›å‡ºé”™è¯¯ â†’ åŒ…è£…æˆ rejected Promise  
  throw new Error('å¤±è´¥'); // Promise.reject(Error)
}
```

### 2.3 async å‡½æ•°åœ¨å¯¹è±¡ä¸­çš„ä½¿ç”¨


```javascript
// å¯¹è±¡æ–¹æ³•
const api = {
  async fetchData() {
    return await getData();
  }
};

// ç±»æ–¹æ³•
class UserService {
  async getUser(id) {
    return await this.fetchUserById(id);
  }
}
```

---

## 3. â³ await å…³é”®å­—ä½¿ç”¨


### 3.1 await çš„ä½¿ç”¨è§„åˆ™


> ğŸ”¥ **æ ¸å¿ƒè§„åˆ™**ï¼šawait **åªèƒ½**åœ¨ async å‡½æ•°å†…éƒ¨ä½¿ç”¨

```javascript
// âœ… æ­£ç¡®ä½¿ç”¨
async function correct() {
  const result = await someAsyncFunction();
  return result;
}

// ğŸš« é”™è¯¯ä½¿ç”¨
function wrong() {
  const result = await someAsyncFunction(); // è¯­æ³•é”™è¯¯ï¼
}
```

### 3.2 await ç­‰å¾…ä»€ä¹ˆ


**await å¯ä»¥ç­‰å¾…ä»»ä½•å€¼**ï¼š
```javascript
async function waitExamples() {
  // 1. ç­‰å¾… Promise
  const data = await fetch('/api/data');
  
  // 2. ç­‰å¾…æ™®é€šå€¼ï¼ˆç«‹å³è¿”å›ï¼‰
  const name = await 'Node.js'; // 'Node.js'
  
  // 3. ç­‰å¾… async å‡½æ•°
  const result = await anotherAsyncFunction();
  
  // 4. ç­‰å¾… thenable å¯¹è±¡
  const custom = await { then: (resolve) => resolve('è‡ªå®šä¹‰') };
}
```

### 3.3 await çš„æ‰§è¡Œæœºåˆ¶


```
æ‰§è¡Œæµç¨‹å›¾ï¼š
å‡½æ•°å¼€å§‹æ‰§è¡Œ
     â†“
é‡åˆ° await å…³é”®å­—
     â†“
æš‚åœå‡½æ•°æ‰§è¡Œï¼Œç­‰å¾… Promise å®Œæˆ
     â†“
Promise å®Œæˆåï¼Œç»§ç»­æ‰§è¡Œåç»­ä»£ç 
     â†“
å‡½æ•°æ‰§è¡Œå®Œæ¯•

å®é™…ä¾‹å­ï¼š
async function demo() {
  console.log('1. å¼€å§‹æ‰§è¡Œ');
  const result = await delay(1000); // æš‚åœ1ç§’
  console.log('2. ç»§ç»­æ‰§è¡Œ', result);
}
```

---

## 4. ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶


### 4.1 åŸºç¡€ try/catch ç”¨æ³•


```javascript
async function handleErrors() {
  try {
    const data = await riskyOperation();
    console.log('æˆåŠŸ:', data);
  } catch (error) {
    console.log('å¤±è´¥:', error.message);
  }
}
```

### 4.2 åµŒå¥— try/catch å¤„ç†ç­–ç•¥


**åœºæ™¯1ï¼šä¸åŒæ“ä½œéœ€è¦ä¸åŒçš„é”™è¯¯å¤„ç†**
```javascript
async function complexOperation() {
  let user, posts;
  
  // è·å–ç”¨æˆ·ä¿¡æ¯ - å¦‚æœå¤±è´¥å°±ç»“æŸ
  try {
    user = await fetchUser();
  } catch (error) {
    console.log('ç”¨æˆ·è·å–å¤±è´¥ï¼Œæ— æ³•ç»§ç»­');
    return null;
  }
  
  // è·å–æ–‡ç«  - å¦‚æœå¤±è´¥å¯ä»¥ç”¨é»˜è®¤å€¼
  try {
    posts = await fetchPosts(user.id);
  } catch (error) {
    console.log('æ–‡ç« è·å–å¤±è´¥ï¼Œä½¿ç”¨ç©ºæ•°ç»„');
    posts = [];
  }
  
  return { user, posts };
}
```

**åœºæ™¯2ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†ä¸ç‰¹æ®Šé”™è¯¯å¤„ç†**
```javascript
async function smartErrorHandling() {
  try {
    const data = await fetchData();
    
    try {
      // ç‰¹æ®Šçš„å¤„ç†é€»è¾‘
      const processed = await processData(data);
      return processed;
    } catch (processError) {
      // å¤„ç†å¤±è´¥ï¼Œä½†æ•°æ®è·å–æˆåŠŸï¼Œè¿”å›åŸå§‹æ•°æ®
      console.log('å¤„ç†å¤±è´¥ï¼Œè¿”å›åŸå§‹æ•°æ®');
      return data;
    }
    
  } catch (fetchError) {
    // æ•°æ®è·å–å¤±è´¥ï¼Œæ— æ³•ç»§ç»­
    throw new Error('æ•°æ®è·å–å¤±è´¥: ' + fetchError.message);
  }
}
```

### 4.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


```javascript
// âœ… æ¨èï¼šæ˜ç¡®çš„é”™è¯¯åˆ†ç±»å¤„ç†
async function robustOperation() {
  try {
    const result = await apiCall();
    return result;
  } catch (error) {
    // æ ¹æ®é”™è¯¯ç±»å‹è¿›è¡Œä¸åŒå¤„ç†
    if (error.code === 'NETWORK_ERROR') {
      console.log('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
    } else if (error.code === 'AUTH_ERROR') {
      console.log('è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•');
    } else {
      console.log('æœªçŸ¥é”™è¯¯:', error.message);
    }
    throw error; // é‡æ–°æŠ›å‡ºï¼Œè®©è°ƒç”¨è€…å†³å®šå¦‚ä½•å¤„ç†
  }
}
```

---

## 5. ğŸš€ å¹¶å‘ä¸ä¸²è¡Œæ‰§è¡Œ


### 5.1 ä¸²è¡Œæ‰§è¡Œï¼ˆä¸€ä¸ªæ¥ä¸€ä¸ªï¼‰


```javascript
// ä¸²è¡Œæ‰§è¡Œ - æ€»è€—æ—¶: 3ç§’
async function serialExecution() {
  console.time('ä¸²è¡Œæ‰§è¡Œ');
  
  const result1 = await task1(); // ç­‰å¾… 1ç§’
  const result2 = await task2(); // ç­‰å¾… 1ç§’  
  const result3 = await task3(); // ç­‰å¾… 1ç§’
  
  console.timeEnd('ä¸²è¡Œæ‰§è¡Œ'); // çº¦ 3000ms
  return [result1, result2, result3];
}
```

### 5.2 å¹¶å‘æ‰§è¡Œï¼ˆåŒæ—¶è¿›è¡Œï¼‰


```javascript
// å¹¶å‘æ‰§è¡Œ - æ€»è€—æ—¶: 1ç§’
async function parallelExecution() {
  console.time('å¹¶å‘æ‰§è¡Œ');
  
  // åŒæ—¶å¯åŠ¨æ‰€æœ‰ä»»åŠ¡
  const [result1, result2, result3] = await Promise.all([
    task1(), // åŒæ—¶å¼€å§‹
    task2(), // åŒæ—¶å¼€å§‹
    task3()  // åŒæ—¶å¼€å§‹
  ]);
  
  console.timeEnd('å¹¶å‘æ‰§è¡Œ'); // çº¦ 1000ms
  return [result1, result2, result3];
}
```

### 5.3 å¹¶å‘æ§åˆ¶çš„å®é™…åº”ç”¨


**åœºæ™¯ï¼šæ‰¹é‡ä¸‹è½½æ–‡ä»¶ï¼Œä½†é™åˆ¶åŒæ—¶ä¸‹è½½æ•°é‡**
```javascript
async function downloadWithLimit(urls, limit = 3) {
  const results = [];
  
  for (let i = 0; i < urls.length; i += limit) {
    // æ¯æ¬¡å¤„ç† limit ä¸ªURL
    const batch = urls.slice(i, i + limit);
    
    // å¹¶å‘ä¸‹è½½è¿™ä¸€æ‰¹
    const batchResults = await Promise.all(
      batch.map(url => downloadFile(url))
    );
    
    results.push(...batchResults);
    console.log(`å®Œæˆç¬¬ ${Math.floor(i/limit) + 1} æ‰¹ä¸‹è½½`);
  }
  
  return results;
}
```

### 5.4 ä»€ä¹ˆæ—¶å€™ç”¨å¹¶å‘ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ä¸²è¡Œ


```javascript
// ğŸ”„ éœ€è¦ä¸²è¡Œçš„æƒ…å†µï¼šåç»­æ“ä½œä¾èµ–å‰é¢çš„ç»“æœ
async function loginProcess() {
  const token = await login(username, password);    // å¿…é¡»å…ˆç™»å½•
  const userData = await fetchUserData(token);      // ç”¨ç™»å½•tokenè·å–æ•°æ®  
  const preferences = await fetchPreferences(userData.id); // ç”¨ç”¨æˆ·IDè·å–åå¥½
}

// âš¡ å¯ä»¥å¹¶å‘çš„æƒ…å†µï¼šæ“ä½œç›¸äº’ç‹¬ç«‹
async function pageData() {
  const [user, notifications, settings] = await Promise.all([
    fetchUser(),          // ç‹¬ç«‹æ“ä½œ
    fetchNotifications(), // ç‹¬ç«‹æ“ä½œ  
    fetchSettings()       // ç‹¬ç«‹æ“ä½œ
  ]);
}
```

---

## 6. ğŸ”„ å¾ªç¯ä¸­çš„ä½¿ç”¨æŠ€å·§


### 6.1 forEach ä¸ async/await çš„é™·é˜±


> âš ï¸ **é‡è¦é™·é˜±**ï¼šforEach ä¸ä¼šç­‰å¾… async å‡½æ•°å®Œæˆ

```javascript
// ğŸš« é”™è¯¯ç”¨æ³• - forEach ä¸ç­‰å¾…
async function wrongWay(urls) {
  urls.forEach(async (url) => {
    const data = await fetch(url); // è¿™äº›è¯·æ±‚ä¼šåŒæ—¶å‘å‡ºï¼
    console.log(data);
  });
  console.log('ç»“æŸ'); // è¿™ä¼šç«‹å³æ‰§è¡Œï¼Œä¸ç­‰å¾…è¯·æ±‚å®Œæˆ
}
```

### 6.2 æ­£ç¡®çš„å¾ªç¯å¤„ç†æ–¹å¼


**ä¸²è¡Œå¤„ç†ï¼ˆä¸€ä¸ªä¸€ä¸ªå¤„ç†ï¼‰**ï¼š
```javascript
// âœ… ä½¿ç”¨ for...of å¾ªç¯ - ä¸²è¡Œæ‰§è¡Œ
async function serialLoop(urls) {
  for (const url of urls) {
    const data = await fetch(url);
    console.log('å®Œæˆ:', url);
  }
  console.log('æ‰€æœ‰è¯·æ±‚å®Œæˆ');
}

// âœ… ä½¿ç”¨ä¼ ç»Ÿ for å¾ªç¯ - ä¸²è¡Œæ‰§è¡Œ  
async function serialForLoop(urls) {
  for (let i = 0; i < urls.length; i++) {
    const data = await fetch(urls[i]);
    console.log('å®Œæˆ:', urls[i]);
  }
}
```

**å¹¶å‘å¤„ç†ï¼ˆåŒæ—¶å¤„ç†ï¼‰**ï¼š
```javascript
// âœ… ä½¿ç”¨ Promise.all - å¹¶å‘æ‰§è¡Œ
async function parallelLoop(urls) {
  const promises = urls.map(url => fetch(url));
  const results = await Promise.all(promises);
  console.log('æ‰€æœ‰è¯·æ±‚å®Œæˆ', results);
}

// âœ… ä½¿ç”¨ map + Promise.all - æ›´ç®€æ´
async function concurrentProcessing(urls) {
  const results = await Promise.all(
    urls.map(async (url) => {
      const data = await fetch(url);
      return processData(data);
    })
  );
  return results;
}
```

### 6.3 å¾ªç¯ä¸­çš„é”™è¯¯å¤„ç†


```javascript
// ä¸²è¡Œå¤„ç† - é‡åˆ°é”™è¯¯åœæ­¢
async function serialWithErrors(tasks) {
  const results = [];
  for (const task of tasks) {
    try {
      const result = await task();
      results.push(result);
    } catch (error) {
      console.log('ä»»åŠ¡å¤±è´¥:', error.message);
      break; // é‡åˆ°é”™è¯¯å°±åœæ­¢
    }
  }
  return results;
}

// å¹¶å‘å¤„ç† - éƒ¨åˆ†å¤±è´¥ä¹Ÿç»§ç»­
async function parallelWithErrors(tasks) {
  const results = await Promise.allSettled(
    tasks.map(task => task())
  );
  
  const successful = results
    .filter(result => result.status === 'fulfilled')
    .map(result => result.value);
    
  const failed = results
    .filter(result => result.status === 'rejected')
    .map(result => result.reason);
    
  return { successful, failed };
}
```

---

## 7. ğŸ†š ä¸Promiseçš„é€‰æ‹©å¯¹æ¯”


### 7.1 è¯­æ³•å¯¹æ¯”


| åœºæ™¯ | Promise å†™æ³• | async/await å†™æ³• | æ¨è |
|------|-------------|------------------|------|
| **ç®€å•è°ƒç”¨** | `getData().then(data => console.log(data))` | `const data = await getData(); console.log(data);` | async/await |
| **é”™è¯¯å¤„ç†** | `.catch(err => console.log(err))` | `try { ... } catch (err) { ... }` | async/await |
| **é“¾å¼è°ƒç”¨** | `.then().then().then()` | `await a(); await b(); await c();` | async/await |
| **å¹¶å‘æ‰§è¡Œ** | `Promise.all([a(), b(), c()])` | `Promise.all([a(), b(), c()])` | ä¸¤è€…éƒ½å¯ä»¥ |

### 7.2 ä½•æ—¶ä½¿ç”¨ Promise


```javascript
// âœ… Promise æ›´é€‚åˆçš„åœºæ™¯ï¼šç®€å•çš„å•æ¬¡è°ƒç”¨
function quickCheck() {
  return isOnline()
    .then(online => online ? 'online' : 'offline')
    .catch(() => 'unknown');
}

// âœ… Promise æ›´é€‚åˆçš„åœºæ™¯ï¼šå‡½æ•°å¼ç¼–ç¨‹é£æ ¼
function processData(data) {
  return validateData(data)
    .then(cleanData)
    .then(transformData)
    .then(saveData);
}
```

### 7.3 ä½•æ—¶ä½¿ç”¨ async/await


```javascript
// âœ… async/await æ›´é€‚åˆçš„åœºæ™¯ï¼šå¤æ‚çš„ä¸šåŠ¡é€»è¾‘
async function completeWorkflow(userId) {
  try {
    const user = await fetchUser(userId);
    
    if (!user.isActive) {
      throw new Error('ç”¨æˆ·æœªæ¿€æ´»');
    }
    
    const permissions = await fetchPermissions(user.role);
    const data = await fetchUserData(user.id, permissions);
    
    // å¤æ‚çš„æ•°æ®å¤„ç†é€»è¾‘
    const processed = await processComplexData(data);
    
    return {
      user: user.name,
      data: processed,
      timestamp: Date.now()
    };
  } catch (error) {
    console.log('å·¥ä½œæµç¨‹å¤±è´¥:', error.message);
    return null;
  }
}
```

### 7.4 é¡¶å±‚ await ä½¿ç”¨åœºæ™¯


> ğŸ’¡ **æ–°ç‰¹æ€§**ï¼šNode.js 14.8+ æ”¯æŒé¡¶å±‚ awaitï¼ˆåœ¨æ¨¡å—é¡¶å±‚ç›´æ¥ä½¿ç”¨ awaitï¼‰

```javascript
// package.json éœ€è¦è®¾ç½® "type": "module"

// âœ… é¡¶å±‚ await - ç”¨äºæ¨¡å—åˆå§‹åŒ–
const config = await loadConfig();
const db = await connectDatabase(config.db);

export { db };

// âœ… é¡¶å±‚ await - ç”¨äºæ¡ä»¶æ€§å¯¼å…¥
const features = await checkFeatures();
const module = features.advanced 
  ? await import('./advanced.js')
  : await import('./basic.js');

export default module;
```

---

## 8. ğŸ’¼ å®é™…åº”ç”¨åœºæ™¯


### 8.1 API æ¥å£è°ƒç”¨


```javascript
// ç”¨æˆ·ç™»å½•æµç¨‹
async function userLogin(username, password) {
  try {
    // 1. éªŒè¯ç”¨æˆ·å‡­æ®
    const authResult = await authenticate(username, password);
    
    // 2. è·å–ç”¨æˆ·ä¿¡æ¯  
    const userInfo = await fetchUserProfile(authResult.userId);
    
    // 3. è®°å½•ç™»å½•æ—¥å¿—
    await logUserActivity(userInfo.id, 'login');
    
    return {
      success: true,
      user: userInfo,
      token: authResult.token
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
```

### 8.2 æ–‡ä»¶å¤„ç†æ“ä½œ


```javascript
const fs = require('fs').promises;
const path = require('path');

// æ‰¹é‡å¤„ç†æ–‡ä»¶
async function processFiles(directory) {
  try {
    const files = await fs.readdir(directory);
    const results = [];
    
    for (const file of files) {
      if (path.extname(file) === '.txt') {
        const content = await fs.readFile(
          path.join(directory, file), 
          'utf8'
        );
        
        const processed = content.toUpperCase();
        
        await fs.writeFile(
          path.join(directory, `processed_${file}`),
          processed
        );
        
        results.push(`å¤„ç†å®Œæˆ: ${file}`);
      }
    }
    
    return results;
  } catch (error) {
    throw new Error(`æ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`);
  }
}
```

### 8.3 æ•°æ®åº“æ“ä½œ


```javascript
// ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ˆæ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œï¼‰
async function registerUser(userData) {
  try {
    // 1. æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
    const existingUser = await User.findByUsername(userData.username);
    if (existingUser) {
      throw new Error('ç”¨æˆ·åå·²å­˜åœ¨');
    }
    
    // 2. åŠ å¯†å¯†ç 
    const hashedPassword = await hashPassword(userData.password);
    
    // 3. åˆ›å»ºç”¨æˆ·
    const newUser = await User.create({
      ...userData,
      password: hashedPassword
    });
    
    // 4. å‘é€æ¬¢è¿é‚®ä»¶
    await sendWelcomeEmail(newUser.email);
    
    return {
      id: newUser.id,
      username: newUser.username,
      email: newUser.email
    };
  } catch (error) {
    throw new Error(`ç”¨æˆ·æ³¨å†Œå¤±è´¥: ${error.message}`);
  }
}
```

---

## 9. ğŸš¨ å¸¸è§é™·é˜±ä¸é¿å‘æŒ‡å—


### 9.1 å¿˜è®°ä½¿ç”¨ await


```javascript
// ğŸš« å¸¸è§é”™è¯¯ï¼šå¿˜è®° await
async function wrong() {
  const data = getData(); // è¿”å› Promiseï¼Œä¸æ˜¯å®é™…æ•°æ®ï¼
  console.log(data.name); // é”™è¯¯ï¼šPromise æ²¡æœ‰ name å±æ€§
}

// âœ… æ­£ç¡®å†™æ³•
async function correct() {
  const data = await getData(); // ç­‰å¾… Promise å®Œæˆ
  console.log(data.name); // æ­£ç¡®ï¼šdata æ˜¯å®é™…æ•°æ®
}
```

### 9.2 åœ¨é async å‡½æ•°ä¸­ä½¿ç”¨ await


```javascript
// ğŸš« é”™è¯¯ï¼šåœ¨æ™®é€šå‡½æ•°ä¸­ä½¿ç”¨ await
function wrong() {
  const result = await someAsyncOperation(); // è¯­æ³•é”™è¯¯ï¼
}

// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šæ”¹ä¸º async å‡½æ•°
async function solution1() {
  const result = await someAsyncOperation();
}

// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ .then()
function solution2() {
  return someAsyncOperation().then(result => {
    // å¤„ç†ç»“æœ
  });
}
```

### 9.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**é¿å…ä¸å¿…è¦çš„ä¸²è¡Œç­‰å¾…**ï¼š
```javascript
// ğŸš« æ€§èƒ½å·®ï¼šä¸å¿…è¦çš„ä¸²è¡Œæ‰§è¡Œ
async function slow() {
  const user = await fetchUser();      // 1ç§’
  const settings = await fetchSettings(); // 1ç§’ (å¯ä»¥å¹¶å‘)
  const notifications = await fetchNotifications(); // 1ç§’ (å¯ä»¥å¹¶å‘)
  // æ€»è€—æ—¶: 3ç§’
}

// âœ… æ€§èƒ½å¥½ï¼šåˆç†çš„å¹¶å‘æ‰§è¡Œ
async function fast() {
  const user = await fetchUser(); // 1ç§’
  
  // settings å’Œ notifications å¯ä»¥å¹¶å‘è·å–
  const [settings, notifications] = await Promise.all([
    fetchSettings(),     // ä¸ä¸‹é¢å¹¶å‘æ‰§è¡Œ
    fetchNotifications() // ä¸ä¸Šé¢å¹¶å‘æ‰§è¡Œ
  ]);
  // æ€»è€—æ—¶: 2ç§’
}
```

**ä½¿ç”¨ Promise.allSettled å¤„ç†éƒ¨åˆ†å¤±è´¥**ï¼š
```javascript
// âœ… å…è®¸éƒ¨åˆ†æ“ä½œå¤±è´¥
async function robustDataFetch() {
  const results = await Promise.allSettled([
    fetchUserData(),    // é‡è¦æ•°æ®
    fetchRecommendations(), // å¯é€‰æ•°æ®
    fetchAdvertisements()   // å¯é€‰æ•°æ®
  ]);
  
  const userData = results[0].status === 'fulfilled' 
    ? results[0].value 
    : null;
    
  const recommendations = results[1].status === 'fulfilled'
    ? results[1].value
    : [];
    
  return { userData, recommendations };
}
```

### 9.4 å†…å­˜æ³„æ¼é¢„é˜²


```javascript
// âš ï¸ æ³¨æ„ï¼šå¤§é‡å¹¶å‘å¯èƒ½å¯¼è‡´å†…å­˜é—®é¢˜
async function memoryFriendly(largeArray) {
  const results = [];
  const batchSize = 100;
  
  // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…åŒæ—¶åˆ›å»ºå¤ªå¤š Promise
  for (let i = 0; i < largeArray.length; i += batchSize) {
    const batch = largeArray.slice(i, i + batchSize);
    const batchResults = await Promise.all(
      batch.map(item => processItem(item))
    );
    results.push(...batchResults);
    
    // å¯é€‰ï¼šé‡Šæ”¾å†…å­˜çš„æš‚åœ
    if (i % 1000 === 0) {
      await new Promise(resolve => setImmediate(resolve));
    }
  }
  
  return results;
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```javascript
ğŸ”¸ async å‡½æ•°æ€»æ˜¯è¿”å› Promise
ğŸ”¸ await åªèƒ½åœ¨ async å‡½æ•°å†…ä½¿ç”¨  
ğŸ”¸ await ä¼šæš‚åœå‡½æ•°æ‰§è¡Œï¼Œç­‰å¾… Promise å®Œæˆ
ğŸ”¸ ç”¨ try/catch å¤„ç† async/await çš„é”™è¯¯
ğŸ”¸ åˆç†é€‰æ‹©ä¸²è¡Œ vs å¹¶å‘æ‰§è¡Œ
ğŸ”¸ forEach ä¸ç­‰å¾… async å‡½æ•°ï¼Œç”¨ for...of æˆ– map+Promise.all
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ async/await çš„æœ¬è´¨**
```
æœ¬è´¨ç†è§£ï¼š
- async/await æ˜¯ Promise çš„è¯­æ³•ç³–
- è®©å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç 
- åº•å±‚ä»ç„¶æ˜¯åŸºäº Promise å’Œäº‹ä»¶å¾ªç¯
- ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹
```

**ğŸ”¹ ä½•æ—¶ä½¿ç”¨ä¸²è¡Œï¼Œä½•æ—¶ä½¿ç”¨å¹¶å‘**
```
ä¸²è¡Œä½¿ç”¨åœºæ™¯ï¼š
âœ… åç»­æ“ä½œä¾èµ–å‰é¢çš„ç»“æœ
âœ… éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘
âœ… é¿å…å¹¶å‘å¯¼è‡´çš„èµ„æºç«äº‰

å¹¶å‘ä½¿ç”¨åœºæ™¯ï¼š  
âœ… æ“ä½œç›¸äº’ç‹¬ç«‹
âœ… æé«˜æ‰§è¡Œæ•ˆç‡
âœ… æ‰¹é‡å¤„ç†æ•°æ®
```

**ğŸ”¹ é”™è¯¯å¤„ç†çš„æœ€ä½³å®è·µ**
```
æ¨èåšæ³•ï¼š
âœ… ä½¿ç”¨ try/catch åŒ…è£… await æ“ä½œ
âœ… æ ¹æ®é”™è¯¯ç±»å‹è¿›è¡Œåˆ†ç±»å¤„ç†
âœ… åœ¨é€‚å½“çš„å±‚çº§å¤„ç†é”™è¯¯
âœ… å‘è°ƒç”¨è€…æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


- **API å¼€å‘**ï¼šå¤„ç†æ•°æ®åº“æ“ä½œã€å¤–éƒ¨ API è°ƒç”¨
- **æ–‡ä»¶å¤„ç†**ï¼šè¯»å†™æ–‡ä»¶ã€æ‰¹é‡å¤„ç†æ•°æ®
- **çˆ¬è™«å¼€å‘**ï¼šå¹¶å‘è¯·æ±‚ã€æ•°æ®æŠ“å–
- **è‡ªåŠ¨åŒ–è„šæœ¬**ï¼šé¡ºåºæ‰§è¡Œå¤æ‚ä»»åŠ¡
- **å¾®æœåŠ¡**ï¼šæœåŠ¡é—´å¼‚æ­¥é€šä¿¡

### 10.4 å­¦ä¹ å»ºè®®


1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆæŒæ¡åŸºæœ¬çš„ async/await è¯­æ³•
2. **ç†è§£æ‰§è¡Œé¡ºåº**ï¼šææ¸…æ¥šä»£ç çš„æ‰§è¡Œæµç¨‹
3. **å¤šç»ƒä¹ é”™è¯¯å¤„ç†**ï¼štry/catch æ˜¯å¿…é¡»æŒæ¡çš„
4. **å¯¹æ¯”å­¦ä¹ **ï¼šä¸ Promise å¯¹æ¯”ç†è§£ä¼˜ç¼ºç‚¹
5. **å®é™…é¡¹ç›®åº”ç”¨**ï¼šåœ¨çœŸå®é¡¹ç›®ä¸­ç»ƒä¹ ä½¿ç”¨

**æ ¸å¿ƒè®°å¿†**ï¼š
- async å£°æ˜å¼‚æ­¥å‡½æ•°ï¼Œæ€»æ˜¯è¿”å› Promise
- await ç­‰å¾…å¼‚æ­¥æ“ä½œï¼Œåªèƒ½åœ¨ async å‡½æ•°å†…ä½¿ç”¨
- try/catch å¤„ç†é”™è¯¯ï¼Œå°±åƒå¤„ç†åŒæ­¥ä»£ç ä¸€æ ·
- åˆç†é€‰æ‹©ä¸²è¡Œå’Œå¹¶å‘ï¼Œæé«˜ç¨‹åºæ€§èƒ½