---
title: 4ã€äº‹ä»¶å¾ªç¯ä¸ EventEmitter
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯](#1-ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯)
2. [è°ƒç”¨æ ˆä¸ä»»åŠ¡é˜Ÿåˆ—](#2-è°ƒç”¨æ ˆä¸ä»»åŠ¡é˜Ÿåˆ—)
3. [äº‹ä»¶å¾ªç¯å„é˜¶æ®µè¯¦è§£](#3-äº‹ä»¶å¾ªç¯å„é˜¶æ®µè¯¦è§£)
4. [å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡](#4-å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡)
5. [EventEmitteräº‹ä»¶å‘å°„å™¨](#5-EventEmitteräº‹ä»¶å‘å°„å™¨)
6. [è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿ](#6-è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿ)
7. [äº‹ä»¶å¤„ç†è¿›é˜¶æŠ€å·§](#7-äº‹ä»¶å¤„ç†è¿›é˜¶æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯


### 1.1 é€šä¿—ç†è§£äº‹ä»¶å¾ªç¯


**ğŸ¤” å…ˆæƒ³è±¡ä¸€ä¸ªç”Ÿæ´»åœºæ™¯**ï¼š
ä½ åœ¨å¨æˆ¿åšé¥­ï¼ŒåŒæ—¶è¦å¤„ç†å¤šä»¶äº‹ï¼š
- ğŸ³ ç…è›‹ï¼ˆéœ€è¦æŒç»­çœ‹ç€ï¼‰
- â° å®šæ—¶å™¨å“äº†ï¼ˆå¾®æ³¢ç‚‰çƒ­é¥­ï¼‰
- ğŸ“ ç”µè¯å“äº†ï¼ˆæœ‹å‹æ‰¾ä½ èŠå¤©ï¼‰
- ğŸšª é—¨é“ƒå“äº†ï¼ˆå¤–å–åˆ°äº†ï¼‰

ä½ **ä¸èƒ½åŒæ—¶åšè¿™äº›äº‹**ï¼Œåªèƒ½**æŒ‰ä¼˜å…ˆçº§**å’Œ**æ—¶é—´é¡ºåº**ä¸€ä»¶ä¸€ä»¶å¤„ç†ã€‚

```
è¿™å°±æ˜¯äº‹ä»¶å¾ªç¯çš„æœ¬è´¨ï¼š
å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŒ‰ç…§ä¸€å®šè§„åˆ™å¤„ç†å„ç§ä»»åŠ¡
```

### 1.2 Node.jsä¸­çš„äº‹ä»¶å¾ªç¯


**ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- Node.jsæ˜¯**å•çº¿ç¨‹**çš„ï¼Œä½†é€šè¿‡äº‹ä»¶å¾ªç¯å®ç°**é«˜å¹¶å‘**
- äº‹ä»¶å¾ªç¯å°±åƒä¸€ä¸ª**ä»»åŠ¡è°ƒåº¦å‘˜**ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™æ‰§è¡Œä»€ä¹ˆä»»åŠ¡
- æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œéƒ½é€šè¿‡äº‹ä»¶å¾ªç¯æ¥ç®¡ç†

```
ç®€å•ç†è§£ï¼š
åŒæ­¥ä»£ç  â†’ ç«‹å³æ‰§è¡Œ
å¼‚æ­¥ä»£ç  â†’ æ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œç­‰äº‹ä»¶å¾ªç¯å¤„ç†
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶å¾ªç¯


**ğŸ¯ è§£å†³çš„é—®é¢˜**ï¼š
```
âŒ æ²¡æœ‰äº‹ä»¶å¾ªç¯ï¼š
è¯»å–æ–‡ä»¶ â†’ ç¨‹åºå¡ä½ç­‰å¾… â†’ ä¸èƒ½å¤„ç†å…¶ä»–è¯·æ±‚

âœ… æœ‰äº†äº‹ä»¶å¾ªç¯ï¼š
è¯»å–æ–‡ä»¶ â†’ ç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚ â†’ æ–‡ä»¶è¯»å®Œåå›è°ƒ
```

---

## 2. ğŸ“‹ è°ƒç”¨æ ˆä¸ä»»åŠ¡é˜Ÿåˆ—


### 2.1 è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰


**ğŸ“š é€šä¿—è§£é‡Š**ï¼š
è°ƒç”¨æ ˆå°±åƒ**å ç›˜å­**ï¼Œåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰

```
æ‰§è¡Œä»£ç è¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  function3  â”‚ â† æœ€åè¿›å…¥ï¼Œæœ€å…ˆæ‰§è¡Œå®Œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  function2  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚  function1  â”‚ â† æœ€å…ˆè¿›å…¥ï¼Œæœ€åæ‰§è¡Œå®Œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” ç®€å•ç¤ºä¾‹**ï¼š
```javascript
function first() {
    console.log('1');
    second();
    console.log('4');
}

function second() {
    console.log('2');
    third();
    console.log('3');
}

function third() {
    console.log('ä¸­é—´');
}

first();
// è¾“å‡ºï¼š1 â†’ 2 â†’ ä¸­é—´ â†’ 3 â†’ 4
```

### 2.2 ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queueï¼‰


**ğŸª é€šä¿—ç†è§£**ï¼š
ä»»åŠ¡é˜Ÿåˆ—å°±åƒ**æ’é˜Ÿä¹°ç¥¨**ï¼Œå…ˆæ¥å…ˆæœåŠ¡ï¼ˆFIFOï¼‰

```
å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæµç¨‹ï¼š
1. å¼‚æ­¥ä»»åŠ¡ï¼ˆsetTimeoutã€æ–‡ä»¶è¯»å–ç­‰ï¼‰
2. æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—æ’é˜Ÿç­‰å¾…
3. è°ƒç”¨æ ˆç©ºäº†ä¹‹åï¼Œä»é˜Ÿåˆ—å–ä»»åŠ¡æ‰§è¡Œ
```

**ğŸ“Š æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
ä¸»çº¿ç¨‹ä»£ç 
    â†“
è°ƒç”¨æ ˆæ‰§è¡Œ
    â†“
é‡åˆ°å¼‚æ­¥ä»»åŠ¡ â†’ æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—
    â†“
è°ƒç”¨æ ˆæ¸…ç©º
    â†“
äº‹ä»¶å¾ªç¯æ£€æŸ¥é˜Ÿåˆ— â†’ å–å‡ºä»»åŠ¡æ‰§è¡Œ
```

---

## 3. ğŸ”§ äº‹ä»¶å¾ªç¯å„é˜¶æ®µè¯¦è§£


### 3.1 äº‹ä»¶å¾ªç¯çš„å…­ä¸ªé˜¶æ®µ


**ğŸ”„ å¾ªç¯æµç¨‹å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€>â”‚           timers          â”‚  â† setTimeoutã€setInterval
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     pending callbacks     â”‚  â† I/Oå›è°ƒ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚       idle, prepare       â”‚  â† å†…éƒ¨ä½¿ç”¨
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚           poll            â”‚  â† æ–°çš„I/Oäº‹ä»¶
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚           check           â”‚  â† setImmediate
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤      close callbacks      â”‚  â† å…³é—­å›è°ƒ
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é‡è¦é˜¶æ®µè¯¦è§£


**â±ï¸ timersé˜¶æ®µ**ï¼š
- æ‰§è¡Œ`setTimeout`å’Œ`setInterval`çš„å›è°ƒ
- åªæ‰§è¡Œ**åˆ°æœŸ**çš„å®šæ—¶å™¨

**ğŸ“Š pollé˜¶æ®µ**ï¼š
- **æœ€é‡è¦çš„é˜¶æ®µ**ï¼Œå¤„ç†æ–°çš„I/Oäº‹ä»¶
- å¦‚æœæ²¡æœ‰å®šæ—¶å™¨ï¼Œä¼šåœ¨è¿™é‡Œ**ç­‰å¾…**æ–°äº‹ä»¶

**âš¡ checké˜¶æ®µ**ï¼š
- æ‰§è¡Œ`setImmediate`å›è°ƒ
- åœ¨pollé˜¶æ®µ**ä¹‹å**ç«‹å³æ‰§è¡Œ

---

## 4. ğŸ¯ å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡


### 4.1 ä»»åŠ¡åˆ†ç±»


**ğŸ“‹ ä»»åŠ¡ä¼˜å…ˆçº§**ï¼š
```
æœ€é«˜ä¼˜å…ˆçº§ï¼šprocess.nextTick
é«˜ä¼˜å…ˆçº§ï¼š  å¾®ä»»åŠ¡ï¼ˆPromise.thenï¼‰
æ™®é€šä¼˜å…ˆçº§ï¼šå®ä»»åŠ¡ï¼ˆsetTimeoutã€setImmediateï¼‰
```

### 4.2 æ‰§è¡Œé¡ºåºè§„åˆ™


**ğŸ”¢ æ‰§è¡Œé¡ºåº**ï¼š
1. **åŒæ­¥ä»£ç **å…ˆæ‰§è¡Œ
2. **process.nextTick**æœ€ä¼˜å…ˆ
3. **å¾®ä»»åŠ¡**ï¼ˆPromiseï¼‰æ¬¡ä¼˜å…ˆ
4. **å®ä»»åŠ¡**ï¼ˆsetTimeoutï¼‰æœ€å

**ğŸ’¡ è®°å¿†å£è¯€**ï¼š
```
åŒæ­¥å…ˆè¡Œï¼ŒnextTickæŠ¢é“
å¾®ä»»åŠ¡ç´§è·Ÿï¼Œå®ä»»åŠ¡æ’é˜Ÿ
```

### 4.3 å®é™…ä¾‹å­ç†è§£


```javascript
console.log('1');

setTimeout(() => console.log('2'), 0);

Promise.resolve().then(() => console.log('3'));

process.nextTick(() => console.log('4'));

console.log('5');

// è¾“å‡ºé¡ºåºï¼š1 â†’ 5 â†’ 4 â†’ 3 â†’ 2
```

**ğŸ” æ‰§è¡Œåˆ†æ**ï¼š
```
1. console.log('1') - åŒæ­¥ï¼Œç«‹å³æ‰§è¡Œ
2. setTimeout - å®ä»»åŠ¡ï¼Œæ”¾å…¥é˜Ÿåˆ—
3. Promise.then - å¾®ä»»åŠ¡ï¼Œæ”¾å…¥é˜Ÿåˆ—  
4. process.nextTick - æœ€é«˜ä¼˜å…ˆçº§ï¼Œæ”¾å…¥é˜Ÿåˆ—
5. console.log('5') - åŒæ­¥ï¼Œç«‹å³æ‰§è¡Œ
6. æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œå¼€å§‹å¤„ç†å¼‚æ­¥ï¼š
   - å…ˆæ‰§è¡Œ nextTick: è¾“å‡º 4
   - å†æ‰§è¡Œå¾®ä»»åŠ¡: è¾“å‡º 3
   - æœ€åæ‰§è¡Œå®ä»»åŠ¡: è¾“å‡º 2
```

### 4.4 setImmediate vs setTimeout(0)


**âš¡ ä¸¤è€…åŒºåˆ«**ï¼š
```javascript
// åœ¨ä¸åŒç¯å¢ƒä¸‹æ‰§è¡Œé¡ºåºå¯èƒ½ä¸åŒ
setTimeout(() => console.log('timeout'), 0);
setImmediate(() => console.log('immediate'));

// ä½†åœ¨I/Oå›è°ƒä¸­ï¼ŒsetImmediateæ€»æ˜¯ä¼˜å…ˆ
const fs = require('fs');
fs.readFile(__filename, () => {
    setTimeout(() => console.log('timeout'), 0);
    setImmediate(() => console.log('immediate'));
    // è¾“å‡ºï¼šimmediate â†’ timeout
});
```

**ğŸ“š ç®€å•è®°å¿†**ï¼š
- `setTimeout(0)`ï¼šåœ¨timersé˜¶æ®µæ‰§è¡Œ
- `setImmediate`ï¼šåœ¨checké˜¶æ®µæ‰§è¡Œ
- åœ¨I/Oå›è°ƒä¸­ï¼Œchecké˜¶æ®µåœ¨timersé˜¶æ®µä¹‹å‰

---

## 5. ğŸ“¡ EventEmitteräº‹ä»¶å‘å°„å™¨


### 5.1 ä»€ä¹ˆæ˜¯EventEmitter


**ğŸ¬ ç”Ÿæ´»ç±»æ¯”**ï¼š
EventEmitterå°±åƒ**å¹¿æ’­ç”µå°**ï¼š
- ğŸ“» **ç›‘å¬è€…**ï¼šè°ƒé¢‘åˆ°æŸä¸ªé¢‘é“ï¼ˆonç›‘å¬äº‹ä»¶ï¼‰
- ğŸ“¢ **å¹¿æ’­å‘˜**ï¼šåœ¨é¢‘é“æ’­æ”¾å†…å®¹ï¼ˆemitè§¦å‘äº‹ä»¶ï¼‰
- ğŸ“± **å¤šä¸ªå¬ä¼—**ï¼šå¯ä»¥åŒæ—¶æ”¶å¬åŒä¸€é¢‘é“

```javascript
const EventEmitter = require('events');

// åˆ›å»ºä¸€ä¸ªäº‹ä»¶å‘å°„å™¨ï¼ˆå¹¿æ’­ç”µå°ï¼‰
const myEmitter = new EventEmitter();

// ç›‘å¬äº‹ä»¶ï¼ˆè°ƒé¢‘æ”¶å¬ï¼‰
myEmitter.on('news', (message) => {
    console.log('æ”¶åˆ°æ–°é—»ï¼š', message);
});

// è§¦å‘äº‹ä»¶ï¼ˆæ’­æ”¾æ–°é—»ï¼‰
myEmitter.emit('news', 'ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼');
// è¾“å‡ºï¼šæ”¶åˆ°æ–°é—»ï¼šä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼
```

### 5.2 åŸºç¡€æ–¹æ³•ä½¿ç”¨


**ğŸ“‹ æ ¸å¿ƒæ–¹æ³•å¯¹æ¯”**ï¼š

| æ–¹æ³• | ä½œç”¨ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|------|------|------|----------|
| `on()` | ç›‘å¬äº‹ä»¶ | å¯é‡å¤è§¦å‘ | æŒç»­ç›‘å¬ |
| `once()` | ä¸€æ¬¡æ€§ç›‘å¬ | åªè§¦å‘ä¸€æ¬¡ | åˆå§‹åŒ–æ“ä½œ |
| `emit()` | è§¦å‘äº‹ä»¶ | é€šçŸ¥æ‰€æœ‰ç›‘å¬è€… | å‘é€æ¶ˆæ¯ |
| `off()`/`removeListener()` | ç§»é™¤ç›‘å¬ | å–æ¶ˆç‰¹å®šç›‘å¬ | æ¸…ç†èµ„æº |

**ğŸ” å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
const EventEmitter = require('events');
const emitter = new EventEmitter();

// æ™®é€šç›‘å¬ - å¯ä»¥å¤šæ¬¡è§¦å‘
emitter.on('greet', (name) => {
    console.log(`ä½ å¥½ï¼Œ${name}ï¼`);
});

// ä¸€æ¬¡æ€§ç›‘å¬ - åªè§¦å‘ä¸€æ¬¡
emitter.once('welcome', (name) => {
    console.log(`æ¬¢è¿æ–°ç”¨æˆ·ï¼š${name}`);
});

// è§¦å‘äº‹ä»¶
emitter.emit('greet', 'å°æ˜');     // ä½ å¥½ï¼Œå°æ˜ï¼
emitter.emit('greet', 'å°çº¢');     // ä½ å¥½ï¼Œå°çº¢ï¼
emitter.emit('welcome', 'å°æ');   // æ¬¢è¿æ–°ç”¨æˆ·ï¼šå°æ
emitter.emit('welcome', 'å°ç‹');   // ä¸ä¼šè¾“å‡ºï¼ˆå·²ç»è§¦å‘è¿‡ä¸€æ¬¡ï¼‰
```

### 5.3 äº‹ä»¶å‚æ•°ä¼ é€’


**ğŸ“¦ å¤šå‚æ•°ä¼ é€’**ï¼š
```javascript
const emitter = new EventEmitter();

// ç›‘å¬è®¢å•äº‹ä»¶
emitter.on('order', (productName, quantity, price) => {
    console.log(`è®¢å•ä¿¡æ¯ï¼š`);
    console.log(`å•†å“ï¼š${productName}`);
    console.log(`æ•°é‡ï¼š${quantity}`);
    console.log(`ä»·æ ¼ï¼š${price}å…ƒ`);
});

// è§¦å‘äº‹ä»¶ï¼Œä¼ é€’å¤šä¸ªå‚æ•°
emitter.emit('order', 'è‹¹æœæ‰‹æœº', 1, 5999);
```

---

## 6. ğŸ—ï¸ è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿ


### 6.1 åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶ç±»


**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**ï¼š
åˆ›å»ºä¸€ä¸ªç®€å•çš„**ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ**

```javascript
const EventEmitter = require('events');

class UserManager extends EventEmitter {
    constructor() {
        super();
        this.users = [];
    }
    
    // æ·»åŠ ç”¨æˆ·
    addUser(user) {
        this.users.push(user);
        // è§¦å‘ç”¨æˆ·æ·»åŠ äº‹ä»¶
        this.emit('userAdded', user);
    }
    
    // åˆ é™¤ç”¨æˆ·
    removeUser(userId) {
        const userIndex = this.users.findIndex(u => u.id === userId);
        if (userIndex !== -1) {
            const user = this.users.splice(userIndex, 1)[0];
            // è§¦å‘ç”¨æˆ·åˆ é™¤äº‹ä»¶
            this.emit('userRemoved', user);
        }
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ç³»ç»Ÿ
const userManager = new UserManager();

// ç›‘å¬ç”¨æˆ·äº‹ä»¶
userManager.on('userAdded', (user) => {
    console.log(`âœ… æ–°ç”¨æˆ·åŠ å…¥ï¼š${user.name}`);
});

userManager.on('userRemoved', (user) => {
    console.log(`âŒ ç”¨æˆ·ç¦»å¼€ï¼š${user.name}`);
});

// æµ‹è¯•
userManager.addUser({ id: 1, name: 'å°æ˜' });
userManager.addUser({ id: 2, name: 'å°çº¢' });
userManager.removeUser(1);
```

### 6.2 é”™è¯¯äº‹ä»¶å¤„ç†


**âš ï¸ é”™è¯¯å¤„ç†çš„é‡è¦æ€§**ï¼š
```javascript
const EventEmitter = require('events');
const emitter = new EventEmitter();

// ç›‘å¬é”™è¯¯äº‹ä»¶ - éå¸¸é‡è¦ï¼
emitter.on('error', (err) => {
    console.error('å‘ç”Ÿé”™è¯¯ï¼š', err.message);
});

// è§¦å‘é”™è¯¯äº‹ä»¶
emitter.emit('error', new Error('something went wrong'));

// å¦‚æœæ²¡æœ‰ç›‘å¬ error äº‹ä»¶ï¼Œç¨‹åºä¼šå´©æºƒï¼
```

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
- æ€»æ˜¯ç›‘å¬`error`äº‹ä»¶
- é”™è¯¯å¤„ç†è¦**ä¼˜é›…é™çº§**
- ä¸è¦è®©ä¸€ä¸ªé”™è¯¯å½±å“æ•´ä¸ªç¨‹åº

---

## 7. ğŸ”§ äº‹ä»¶å¤„ç†è¿›é˜¶æŠ€å·§


### 7.1 æ‰¹é‡ç§»é™¤ç›‘å¬å™¨


**ğŸ§¹ æ¸…ç†å†…å­˜çš„é‡è¦æ€§**ï¼š
```javascript
const emitter = new EventEmitter();

// æ·»åŠ å¤šä¸ªç›‘å¬å™¨
emitter.on('test', () => console.log('ç›‘å¬å™¨1'));
emitter.on('test', () => console.log('ç›‘å¬å™¨2'));
emitter.on('other', () => console.log('å…¶ä»–äº‹ä»¶'));

console.log('ç§»é™¤å‰ç›‘å¬å™¨æ•°é‡ï¼š', emitter.listenerCount('test')); // 2

// ç§»é™¤ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨
emitter.removeAllListeners('test');

console.log('ç§»é™¤åç›‘å¬å™¨æ•°é‡ï¼š', emitter.listenerCount('test')); // 0

// ç§»é™¤æ‰€æœ‰äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨
// emitter.removeAllListeners();
```

### 7.2 äº‹ä»¶çš„å¼‚æ­¥å¤„ç†


**âš¡ å¼‚æ­¥äº‹ä»¶å¤„ç†**ï¼š
```javascript
const emitter = new EventEmitter();

// å¼‚æ­¥äº‹ä»¶å¤„ç†
emitter.on('asyncEvent', async (data) => {
    console.log('å¼€å§‹å¤„ç†å¼‚æ­¥ä»»åŠ¡...');
    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
    await new Promise(resolve => setTimeout(resolve, 1000));
    console.log('å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼š', data);
});

emitter.emit('asyncEvent', 'é‡è¦æ•°æ®');
console.log('è¿™è¡Œä¼šç«‹å³æ‰§è¡Œ'); // ä¸ä¼šç­‰å¾…å¼‚æ­¥äº‹ä»¶å®Œæˆ
```

### 7.3 å†…å­˜æ³„æ¼é˜²èŒƒ


**ğŸš¨ å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› **ï¼š
```javascript
const emitter = new EventEmitter();

// âŒ é”™è¯¯åšæ³•ï¼šæ— é™æ·»åŠ ç›‘å¬å™¨
function badPractice() {
    setInterval(() => {
        emitter.on('data', () => {
            console.log('å¤„ç†æ•°æ®');
        });
    }, 1000);
}

// âœ… æ­£ç¡®åšæ³•ï¼šå¤ç”¨ç›‘å¬å™¨
function goodPractice() {
    const dataHandler = () => {
        console.log('å¤„ç†æ•°æ®');
    };
    
    emitter.on('data', dataHandler);
    
    // åœ¨é€‚å½“æ—¶å€™ç§»é™¤
    // emitter.removeListener('data', dataHandler);
}
```

**ğŸ’¡ é˜²èŒƒæŠ€å·§**ï¼š
- è®¾ç½®æœ€å¤§ç›‘å¬å™¨æ•°é‡ï¼š`emitter.setMaxListeners(10)`
- åŠæ—¶ç§»é™¤ä¸éœ€è¦çš„ç›‘å¬å™¨
- ä½¿ç”¨`once()`ä»£æ›¿`on()`ï¼ˆå½“åªéœ€è¦ç›‘å¬ä¸€æ¬¡æ—¶ï¼‰

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 äº‹ä»¶å¾ªç¯æ ¸å¿ƒç†è§£


```
ğŸ”„ äº‹ä»¶å¾ªç¯æœ¬è´¨ï¼š
å•çº¿ç¨‹ç¯å¢ƒä¸‹çš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶ï¼Œè®©Node.jsèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¼‚æ­¥æ“ä½œ

ğŸ¯ æ‰§è¡Œä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1ï¸âƒ£ åŒæ­¥ä»£ç 
2ï¸âƒ£ process.nextTick
3ï¸âƒ£ å¾®ä»»åŠ¡ï¼ˆPromise.thenï¼‰
4ï¸âƒ£ å®ä»»åŠ¡ï¼ˆsetTimeoutã€setImmediateï¼‰
```

### 8.2 EventEmitteræ ¸å¿ƒç”¨æ³•


| æ“ä½œ | æ–¹æ³• | è¯´æ˜ | è®°å¿†æŠ€å·§ |
|------|------|------|----------|
| **ç›‘å¬** | `on(event, callback)` | æŒç»­ç›‘å¬ | on = å¼€å¯ |
| **ä¸€æ¬¡** | `once(event, callback)` | åªç›‘å¬ä¸€æ¬¡ | once = ä¸€æ¬¡ |
| **è§¦å‘** | `emit(event, ...args)` | å‘å°„äº‹ä»¶ | emit = å‘å°„ |
| **ç§»é™¤** | `off(event, callback)` | ç§»é™¤ç›‘å¬ | off = å…³é—­ |

### 8.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ EventEmitteré€‚ç”¨åœºæ™¯**ï¼š
- âœ… **ç”¨æˆ·ç³»ç»Ÿ**ï¼šç™»å½•ã€æ³¨å†Œã€æ³¨é”€äº‹ä»¶
- âœ… **æ–‡ä»¶æ“ä½œ**ï¼šä¸Šä¼ è¿›åº¦ã€å®Œæˆé€šçŸ¥
- âœ… **ç½‘ç»œè¯·æ±‚**ï¼šè¿æ¥ã€æ–­å¼€ã€é”™è¯¯å¤„ç†
- âœ… **æ¸¸æˆå¼€å‘**ï¼šè§’è‰²è¡Œä¸ºã€é“å…·ä½¿ç”¨

### 8.4 æœ€ä½³å®è·µå»ºè®®


**ğŸ’¡ ç¼–ç¨‹å»ºè®®**ï¼š

1. **æ€»æ˜¯å¤„ç†é”™è¯¯äº‹ä»¶**
```javascript
emitter.on('error', (err) => {
    // ä¼˜é›…å¤„ç†é”™è¯¯
});
```

2. **åŠæ—¶æ¸…ç†ç›‘å¬å™¨**
```javascript
// é¡µé¢å¸è½½æ—¶ç§»é™¤ç›‘å¬å™¨
window.addEventListener('beforeunload', () => {
    emitter.removeAllListeners();
});
```

3. **ä½¿ç”¨æœ‰æ„ä¹‰çš„äº‹ä»¶åç§°**
```javascript
// âœ… å¥½çš„äº‹ä»¶å
emitter.on('user:login', handler);
emitter.on('file:uploadComplete', handler);

// âŒ ä¸å¥½çš„äº‹ä»¶å
emitter.on('event1', handler);
emitter.on('data', handler);
```

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- äº‹ä»¶å¾ªç¯æ˜¯Node.jså¼‚æ­¥çš„åŸºç¡€
- process.nextTickä¼˜å…ˆçº§æœ€é«˜
- EventEmitteræ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°
- ä¸€å®šè¦å¤„ç†erroräº‹ä»¶é˜²æ­¢ç¨‹åºå´©æºƒ
- åŠæ—¶æ¸…ç†ç›‘å¬å™¨é˜²æ­¢å†…å­˜æ³„æ¼