---
title: 4ã€é™æ€èµ„æºæœåŠ¡ä¸æ‰˜ç®¡
---
## ğŸ“š ç›®å½•

1. [é™æ€èµ„æºæœåŠ¡åŸºç¡€æ¦‚å¿µ](#1-é™æ€èµ„æºæœåŠ¡åŸºç¡€æ¦‚å¿µ)
2. [express.static()ä¸­é—´ä»¶è¯¦è§£](#2-expressstaticä¸­é—´ä»¶è¯¦è§£)
3. [é™æ€èµ„æºç›®å½•é…ç½®](#3-é™æ€èµ„æºç›®å½•é…ç½®)
4. [è™šæ‹Ÿè·¯å¾„ä¸å¤šç›®å½•é…ç½®](#4-è™šæ‹Ÿè·¯å¾„ä¸å¤šç›®å½•é…ç½®)
5. [ç¼“å­˜æ§åˆ¶ä¸æ€§èƒ½ä¼˜åŒ–](#5-ç¼“å­˜æ§åˆ¶ä¸æ€§èƒ½ä¼˜åŒ–)
6. [å®‰å…¨é˜²æŠ¤ä¸æœ€ä½³å®è·µ](#6-å®‰å…¨é˜²æŠ¤ä¸æœ€ä½³å®è·µ)
7. [èµ„æºå‹ç¼©ä¸ç‰ˆæœ¬ç®¡ç†](#7-èµ„æºå‹ç¼©ä¸ç‰ˆæœ¬ç®¡ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ é™æ€èµ„æºæœåŠ¡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é™æ€èµ„æº

**ç®€å•ç†è§£**ï¼šé™æ€èµ„æºå°±æ˜¯é‚£äº›ä¸éœ€è¦æœåŠ¡å™¨å¤„ç†ï¼Œç›´æ¥å‘é€ç»™ç”¨æˆ·çš„æ–‡ä»¶

```
é™æ€èµ„æºå¸¸è§ç±»å‹ï¼š
ğŸ“„ HTMLæ–‡ä»¶ï¼šç½‘é¡µå†…å®¹
ğŸ¨ CSSæ–‡ä»¶ï¼šæ ·å¼è¡¨
ğŸ“± JavaScriptæ–‡ä»¶ï¼šå‰ç«¯è„šæœ¬
ğŸ–¼ï¸ å›¾ç‰‡æ–‡ä»¶ï¼šJPGã€PNGã€GIFã€SVGç­‰
ğŸ“¹ è§†é¢‘éŸ³é¢‘ï¼šMP4ã€MP3ç­‰
ğŸ“ æ–‡æ¡£æ–‡ä»¶ï¼šPDFã€Wordç­‰
ğŸ”  å­—ä½“æ–‡ä»¶ï¼šTTFã€WOFFç­‰
```

### 1.2 é™æ€èµ„æºæœåŠ¡çš„ä½œç”¨

**æ ¸å¿ƒç›®çš„**ï¼šè®©æµè§ˆå™¨èƒ½å¤Ÿç›´æ¥è®¿é—®å’Œä¸‹è½½è¿™äº›æ–‡ä»¶

```
ä¼ ç»Ÿæ–¹å¼ vs Node.jsæ–¹å¼ï¼š

ä¼ ç»ŸWebæœåŠ¡å™¨(Apache/Nginx)ï¼š
æµè§ˆå™¨è¯·æ±‚ â†’ WebæœåŠ¡å™¨ â†’ ç›´æ¥è¿”å›æ–‡ä»¶

Node.js + Expressï¼š
æµè§ˆå™¨è¯·æ±‚ â†’ Expressåº”ç”¨ â†’ é™æ€ä¸­é—´ä»¶ â†’ è¿”å›æ–‡ä»¶
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦é™æ€èµ„æºæœåŠ¡

> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šExpressé»˜è®¤åªå¤„ç†è·¯ç”±ï¼Œä¸ä¼šè‡ªåŠ¨æä¾›æ–‡ä»¶ä¸‹è½½åŠŸèƒ½

**æ²¡æœ‰é™æ€æœåŠ¡çš„é—®é¢˜**ï¼š
- âŒ æµè§ˆå™¨æ— æ³•åŠ è½½CSSæ ·å¼
- âŒ JavaScriptæ–‡ä»¶æ— æ³•æ‰§è¡Œ  
- âŒ å›¾ç‰‡æ— æ³•æ˜¾ç¤º
- âŒ ç½‘é¡µå˜æˆçº¯æ–‡æœ¬

---

## 2. âš™ï¸ express.static()ä¸­é—´ä»¶è¯¦è§£


### 2.1 express.static()åŸºæœ¬æ¦‚å¿µ

**ç®€å•å®šä¹‰**ï¼šExpresså†…ç½®çš„ä¸­é—´ä»¶ï¼Œä¸“é—¨ç”¨æ¥æä¾›é™æ€æ–‡ä»¶æœåŠ¡

```javascript
// æœ€ç®€å•çš„ç”¨æ³•
app.use(express.static('public'));
```

> ğŸ“ **é€šä¿—è§£é‡Š**ï¼šå‘Šè¯‰Express"publicæ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®"

### 2.2 åŸºæœ¬ä½¿ç”¨æ–¹å¼

```javascript
const express = require('express');
const app = express();

// è®¾ç½®é™æ€æ–‡ä»¶ç›®å½•
app.use(express.static('public'));

app.listen(3000, () => {
    console.log('æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000');
});
```

**ç›®å½•ç»“æ„ç¤ºä¾‹**ï¼š
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ app.js          â† Expressåº”ç”¨
â”œâ”€â”€ public/         â† é™æ€æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ app.js
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â””â”€â”€ index.html
```

**è®¿é—®æ–¹å¼**ï¼š
```
http://localhost:3000/css/style.css    â† è®¿é—®CSSæ–‡ä»¶
http://localhost:3000/js/app.js        â† è®¿é—®JSæ–‡ä»¶  
http://localhost:3000/images/logo.png  â† è®¿é—®å›¾ç‰‡
http://localhost:3000/index.html       â† è®¿é—®HTML
```

### 2.3 è·¯å¾„è§£ææœºåˆ¶

> ğŸ¯ **é‡è¦ç†è§£**ï¼šURLä¸­ä¸åŒ…å« `public` è¿™ä¸ªç›®å½•å

```
æ–‡ä»¶å®é™…è·¯å¾„ï¼š./public/css/style.css
æµè§ˆå™¨è®¿é—®è·¯å¾„ï¼š/css/style.css

Expressè‡ªåŠ¨éšè—äº† public ç›®å½•åï¼
```

---

## 3. ğŸ“ é™æ€èµ„æºç›®å½•é…ç½®


### 3.1 ç»å¯¹è·¯å¾„é…ç½®

**æ¨èæ–¹å¼**ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„é¿å…ç›¸å¯¹è·¯å¾„é—®é¢˜

```javascript
const path = require('path');

// ä½¿ç”¨ç»å¯¹è·¯å¾„
app.use(express.static(path.join(__dirname, 'public')));
```

> âš ï¸ **æ³¨æ„**ï¼šç›¸å¯¹è·¯å¾„å¯èƒ½å› å¯åŠ¨ç›®å½•ä¸åŒè€Œå‡ºé”™ï¼Œç»å¯¹è·¯å¾„æ›´å¯é 

### 3.2 å¤šä¸ªé™æ€ç›®å½•é…ç½®

**å®é™…åœºæ™¯**ï¼šé¡¹ç›®å¯èƒ½éœ€è¦å¤šä¸ªèµ„æºç›®å½•

```javascript
// é…ç½®å¤šä¸ªé™æ€ç›®å½•
app.use(express.static('public'));        // ä¸»è¦èµ„æºç›®å½•
app.use(express.static('uploads'));       // ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
app.use(express.static('assets'));        // ç¬¬ä¸‰æ–¹èµ„æº

// ä½¿ç”¨ç»å¯¹è·¯å¾„çš„å®Œæ•´é…ç½®
app.use(express.static(path.join(__dirname, 'public')));
app.use(express.static(path.join(__dirname, 'uploads')));
app.use(express.static(path.join(__dirname, 'assets')));
```

**æŸ¥æ‰¾é¡ºåº**ï¼š
```
å½“è®¿é—® /logo.png æ—¶ï¼š
1. å…ˆåœ¨ public/ ä¸­æŸ¥æ‰¾
2. æ‰¾ä¸åˆ°å°±åœ¨ uploads/ ä¸­æŸ¥æ‰¾  
3. è¿˜æ‰¾ä¸åˆ°å°±åœ¨ assets/ ä¸­æŸ¥æ‰¾
4. éƒ½æ‰¾ä¸åˆ°è¿”å› 404
```

### 3.3 æ¡ä»¶æ€§é™æ€æœåŠ¡

```javascript
// åªåœ¨å¼€å‘ç¯å¢ƒæä¾›é™æ€æœåŠ¡
if (process.env.NODE_ENV === 'development') {
    app.use(express.static('public'));
}

// å¸¦æ¡ä»¶çš„é™æ€ç›®å½•é…ç½®
const staticOptions = {
    dotfiles: 'ignore',        // å¿½ç•¥éšè—æ–‡ä»¶
    etag: false,              // ç¦ç”¨ETag
    extensions: ['html', 'htm'], // å…è®¸çš„æ‰©å±•å
    index: false,             // ç¦ç”¨ç›®å½•ç´¢å¼•
    maxAge: '1d',            // ç¼“å­˜æ—¶é—´1å¤©
    redirect: false          // ç¦ç”¨é‡å®šå‘
};

app.use(express.static('public', staticOptions));
```

---

## 4. ğŸ›£ï¸ è™šæ‹Ÿè·¯å¾„ä¸å¤šç›®å½•é…ç½®


### 4.1 è™šæ‹Ÿè·¯å¾„çš„æ¦‚å¿µ

**ç®€å•ç†è§£**ï¼šç»™é™æ€èµ„æºæ·»åŠ ä¸€ä¸ª"å‡çš„"URLå‰ç¼€

```javascript
// è®¾ç½®è™šæ‹Ÿè·¯å¾„
app.use('/static', express.static('public'));
```

**è®¿é—®å˜åŒ–**ï¼š
```
è®¾ç½®å‰ï¼šhttp://localhost:3000/css/style.css
è®¾ç½®åï¼šhttp://localhost:3000/static/css/style.css
```

> ğŸ’¡ **ç”¨é€”**ï¼šè®©URLæ›´è§„èŒƒï¼Œæˆ–è€…éšè—çœŸå®ç›®å½•ç»“æ„

### 4.2 è™šæ‹Ÿè·¯å¾„çš„å®é™…åº”ç”¨

```javascript
// ä¸åŒç±»å‹çš„èµ„æºä½¿ç”¨ä¸åŒè™šæ‹Ÿè·¯å¾„
app.use('/assets', express.static('public'));        // é™æ€èµ„æº
app.use('/uploads', express.static('user_files'));   // ç”¨æˆ·ä¸Šä¼ 
app.use('/libs', express.static('node_modules'));    // ç¬¬ä¸‰æ–¹åº“
```

**ç›®å½•æ˜ å°„å…³ç³»**ï¼š
```
è™šæ‹Ÿè·¯å¾„é…ç½®ï¼š
/assets     â†’ public/          (ç½‘ç«™é™æ€èµ„æº)
/uploads    â†’ user_files/      (ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶)  
/libs       â†’ node_modules/    (ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶)

å®é™…è®¿é—®ï¼š
/assets/css/style.css      â†’ public/css/style.css
/uploads/avatar/user1.jpg  â†’ user_files/avatar/user1.jpg
/libs/jquery/jquery.min.js â†’ node_modules/jquery/dist/jquery.min.js
```

### 4.3 å¤šåŸŸåé™æ€èµ„æºé…ç½®

```javascript
// æ ¹æ®ä¸åŒåŸŸåæä¾›ä¸åŒé™æ€èµ„æº
app.use((req, res, next) => {
    const host = req.get('host');
    
    if (host === 'admin.example.com') {
        express.static('admin_assets')(req, res, next);
    } else if (host === 'api.example.com') {
        express.static('api_docs')(req, res, next);
    } else {
        express.static('public')(req, res, next);
    }
});
```

---

## 5. âš¡ ç¼“å­˜æ§åˆ¶ä¸æ€§èƒ½ä¼˜åŒ–


### 5.1 ç¼“å­˜æ§åˆ¶åŸºç¡€

**ç¼“å­˜çš„ä½œç”¨**ï¼šå‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œæé«˜ç”¨æˆ·è®¿é—®é€Ÿåº¦

```javascript
// åŸºæœ¬ç¼“å­˜é…ç½®
const cacheOptions = {
    maxAge: '1d',           // ç¼“å­˜1å¤©
    etag: true,            // å¯ç”¨ETag
    lastModified: true     // å¯ç”¨Last-Modified
};

app.use(express.static('public', cacheOptions));
```

### 5.2 ETag å’Œ Last-Modified è¯¦è§£

**ETag**ï¼šæ–‡ä»¶å†…å®¹çš„"æŒ‡çº¹"ï¼Œå†…å®¹å˜åŒ–æ—¶ETagä¹Ÿå˜åŒ–
**Last-Modified**ï¼šæ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´

```
ç¼“å­˜å·¥ä½œæµç¨‹ï¼š
1. æµè§ˆå™¨é¦–æ¬¡è¯·æ±‚æ–‡ä»¶
2. æœåŠ¡å™¨è¿”å›æ–‡ä»¶ + ETag + Last-Modified
3. æµè§ˆå™¨å†æ¬¡è¯·æ±‚æ—¶å‘é€ If-None-Match(ETag) å’Œ If-Modified-Since
4. æœåŠ¡å™¨æ¯”è¾ƒï¼Œæœªå˜åŒ–è¿”å›304ï¼Œå˜åŒ–äº†è¿”å›æ–°æ–‡ä»¶
```

```javascript
// è¯¦ç»†ç¼“å­˜é…ç½®
const cacheControl = {
    // å¼ºç¼“å­˜ï¼šç›´æ¥ä»æµè§ˆå™¨ç¼“å­˜è¯»å–
    maxAge: 1000 * 60 * 60 * 24 * 7,  // 7å¤©å¼ºç¼“å­˜
    
    // åå•†ç¼“å­˜ï¼šå‘æœåŠ¡å™¨ç¡®è®¤æ˜¯å¦å˜åŒ–
    etag: true,                        // å¯ç”¨ETagéªŒè¯
    lastModified: true,               // å¯ç”¨æ—¶é—´éªŒè¯
    
    // å…¶ä»–é…ç½®
    immutable: true,                  // æ ‡è®°æ–‡ä»¶ä¸å¯å˜
    cacheControl: true               // è®¾ç½®Cache-Controlå¤´
};

app.use(express.static('public', cacheControl));
```

### 5.3 ä¸åŒèµ„æºç±»å‹çš„ç¼“å­˜ç­–ç•¥

```javascript
// æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®ä¸åŒç¼“å­˜
app.use('/css', express.static('public/css', {
    maxAge: '7d',        // CSSæ–‡ä»¶ç¼“å­˜7å¤©
    immutable: true
}));

app.use('/js', express.static('public/js', {
    maxAge: '7d',        // JSæ–‡ä»¶ç¼“å­˜7å¤©
    immutable: true
}));

app.use('/images', express.static('public/images', {
    maxAge: '30d',       // å›¾ç‰‡ç¼“å­˜30å¤©
    immutable: true
}));

app.use('/api-docs', express.static('docs', {
    maxAge: '1h',        // APIæ–‡æ¡£ç¼“å­˜1å°æ—¶
    etag: true
}));
```

---

## 6. ğŸ”’ å®‰å…¨é˜²æŠ¤ä¸æœ€ä½³å®è·µ


### 6.1 é˜²æ­¢ç›®å½•éå†æ”»å‡»

**æ”»å‡»åŸç†**ï¼šæ¶æ„ç”¨æˆ·å°è¯•è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶

```
å±é™©çš„è®¿é—®å°è¯•ï¼š
../../../etc/passwd          (å°è¯•è®¿é—®ç³»ç»Ÿæ–‡ä»¶)
..\\..\\windows\\system32    (Windowsç³»ç»Ÿç›®å½•)
```

**Expressè‡ªåŠ¨é˜²æŠ¤**ï¼š
```javascript
// Express.staticè‡ªåŠ¨è§„èŒƒåŒ–è·¯å¾„ï¼Œé˜²æ­¢ç›®å½•éå†
app.use(express.static('public'));

// è¿™äº›æ¶æ„è¯·æ±‚ä¼šè¢«è‡ªåŠ¨é˜»æ­¢ï¼š
// GET /../../../etc/passwd
// GET /..%2F..%2F..%2Fetc%2Fpasswd
```

### 6.2 éšè—æ–‡ä»¶ä¿æŠ¤

```javascript
const secureOptions = {
    dotfiles: 'ignore',       // å¿½ç•¥éšè—æ–‡ä»¶(.å¼€å¤´)
    index: false,            // ä¸æ˜¾ç¤ºç›®å½•åˆ—è¡¨
    redirect: false          // ç¦æ­¢é‡å®šå‘
};

app.use(express.static('public', secureOptions));
```

> âš ï¸ **å®‰å…¨æé†’**ï¼šéšè—æ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ `.env`ã€`.git` ç­‰

### 6.3 æ–‡ä»¶ç±»å‹é™åˆ¶

```javascript
// åªå…è®¸ç‰¹å®šç±»å‹çš„æ–‡ä»¶
const allowedExtensions = ['.html', '.css', '.js', '.png', '.jpg', '.gif'];

app.use('/safe', (req, res, next) => {
    const ext = path.extname(req.path).toLowerCase();
    
    if (allowedExtensions.includes(ext) || req.path === '/') {
        express.static('public')(req, res, next);
    } else {
        res.status(403).send('æ–‡ä»¶ç±»å‹ä¸å…è®¸');
    }
});
```

### 6.4 è®¿é—®æ—¥å¿—è®°å½•

```javascript
// è®°å½•é™æ€æ–‡ä»¶è®¿é—®æ—¥å¿—
app.use('/static', (req, res, next) => {
    console.log(`é™æ€æ–‡ä»¶è®¿é—®: ${req.method} ${req.path} - ${new Date().toISOString()}`);
    next();
}, express.static('public'));
```

---

## 7. ğŸ“¦ èµ„æºå‹ç¼©ä¸ç‰ˆæœ¬ç®¡ç†


### 7.1 Gzip å‹ç¼©é…ç½®

**å‹ç¼©çš„å¥½å¤„**ï¼šå‡å°‘ä¼ è¾“æ•°æ®é‡ï¼Œæé«˜åŠ è½½é€Ÿåº¦

```javascript
const compression = require('compression');

// å¯ç”¨Gzipå‹ç¼©
app.use(compression({
    // åªå‹ç¼©å¤§äº1KBçš„æ–‡ä»¶
    threshold: 1024,
    
    // å‹ç¼©çº§åˆ«(1-9, 9æœ€é«˜)
    level: 6,
    
    // è¿‡æ»¤å‡½æ•°ï¼šå†³å®šå“ªäº›æ–‡ä»¶éœ€è¦å‹ç¼©
    filter: (req, res) => {
        // å¦‚æœè¯·æ±‚å¤´åŒ…å« 'x-no-compression'ï¼Œåˆ™ä¸å‹ç¼©
        if (req.headers['x-no-compression']) {
            return false;
        }
        
        // ä½¿ç”¨é»˜è®¤è¿‡æ»¤å™¨
        return compression.filter(req, res);
    }
}));

// åœ¨å‹ç¼©ä¸­é—´ä»¶ä¹‹åé…ç½®é™æ€æ–‡ä»¶
app.use(express.static('public'));
```

**å‹ç¼©æ•ˆæœå¯¹æ¯”**ï¼š
```
æ–‡ä»¶ç±»å‹    åŸå§‹å¤§å°    å‹ç¼©å     å‹ç¼©ç‡
CSSæ–‡ä»¶     100KB      25KB       75%
JSæ–‡ä»¶      200KB      60KB       70%
HTMLæ–‡ä»¶    50KB       15KB       70%
å›¾ç‰‡æ–‡ä»¶    500KB      500KB      0% (å·²å‹ç¼©)
```

### 7.2 é™æ€èµ„æºç‰ˆæœ¬ç®¡ç†

**ç‰ˆæœ¬ç®¡ç†ç›®çš„**ï¼šè§£å†³æµè§ˆå™¨ç¼“å­˜å¯¼è‡´çš„æ›´æ–°é—®é¢˜

```javascript
// æ–¹æ³•1ï¼šæ–‡ä»¶åæ·»åŠ ç‰ˆæœ¬å·
const version = '1.2.3';

app.locals.assetVersion = version;

// åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
// <link rel="stylesheet" href="/css/style.css?v=<%= assetVersion %>">
```

```javascript
// æ–¹æ³•2ï¼šæ–‡ä»¶å†…å®¹å“ˆå¸Œç‰ˆæœ¬
const crypto = require('crypto');
const fs = require('fs');

function getFileHash(filePath) {
    const fileContent = fs.readFileSync(filePath);
    return crypto.createHash('md5').update(fileContent).digest('hex').substring(0, 8);
}

// æ·»åŠ æ–‡ä»¶å“ˆå¸Œåˆ°URL
app.get('/css/style.css', (req, res) => {
    const filePath = path.join(__dirname, 'public/css/style.css');
    const hash = getFileHash(filePath);
    
    // è®¾ç½®å¼ºç¼“å­˜å’ŒETag
    res.setHeader('Cache-Control', 'public, max-age=31536000'); // 1å¹´
    res.setHeader('ETag', hash);
    
    if (req.headers['if-none-match'] === hash) {
        return res.status(304).end();
    }
    
    res.sendFile(filePath);
});
```

### 7.3 CDN é›†æˆè€ƒè™‘

**CDN ç¼“å­˜ç­–ç•¥**ï¼š

```javascript
// é…ç½®é€‚åˆCDNçš„å“åº”å¤´
app.use('/static', (req, res, next) => {
    // è®¾ç½®CDNå‹å¥½çš„ç¼“å­˜å¤´
    res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');
    res.setHeader('Vary', 'Accept-Encoding');
    
    next();
}, express.static('public', {
    maxAge: '1y',
    immutable: true,
    etag: true
}));
```

**CDNå›æºé…ç½®**ï¼š
```javascript
// æ£€æµ‹æ˜¯å¦æ¥è‡ªCDNçš„å›æºè¯·æ±‚
app.use((req, res, next) => {
    const cdnHeaders = ['cf-ray', 'x-forwarded-for', 'x-real-ip'];
    const isCDNRequest = cdnHeaders.some(header => req.headers[header]);
    
    if (isCDNRequest) {
        // CDNå›æºè¯·æ±‚ï¼Œè®¾ç½®åˆé€‚çš„ç¼“å­˜ç­–ç•¥
        res.setHeader('Cache-Control', 'public, max-age=86400'); // 24å°æ—¶
    }
    
    next();
});
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ

```
ğŸ”¸ é™æ€èµ„æºæœåŠ¡ï¼šæä¾›æ–‡ä»¶ç›´æ¥ä¸‹è½½çš„åŠŸèƒ½
ğŸ”¸ express.static()ï¼šExpresså†…ç½®çš„é™æ€æ–‡ä»¶ä¸­é—´ä»¶  
ğŸ”¸ è™šæ‹Ÿè·¯å¾„ï¼šç»™é™æ€èµ„æºæ·»åŠ URLå‰ç¼€
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šæé«˜æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒçš„é‡è¦æ‰‹æ®µ
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šé˜²æ­¢ç›®å½•éå†å’Œæ•æ„Ÿæ–‡ä»¶æ³„éœ²
```

### 8.2 å…³é”®é…ç½®é€‰é¡¹


| é…ç½®é¡¹ | **ä½œç”¨** | **æ¨èå€¼** | **è¯´æ˜** |
|--------|----------|------------|----------|
| `maxAge` | `ç¼“å­˜æ—¶é—´` | `1d-30d` | `æ ¹æ®æ–‡ä»¶ç±»å‹è°ƒæ•´` |
| `etag` | `å†…å®¹éªŒè¯` | `true` | `å¯ç”¨åå•†ç¼“å­˜` |
| `dotfiles` | `éšè—æ–‡ä»¶` | `ignore` | `å®‰å…¨è€ƒè™‘` |
| `index` | `ç›®å½•ç´¢å¼•` | `false` | `å®‰å…¨è€ƒè™‘` |
| `redirect` | `è‡ªåŠ¨é‡å®šå‘` | `false` | `å®‰å…¨è€ƒè™‘` |

### 8.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ”¹ ç›®å½•ç»“æ„ç»„ç»‡**
```
æ¨èçš„é™æ€èµ„æºç›®å½•ç»“æ„ï¼š
public/
â”œâ”€â”€ css/           â† æ ·å¼æ–‡ä»¶
â”œâ”€â”€ js/            â† JavaScriptæ–‡ä»¶
â”œâ”€â”€ images/        â† å›¾ç‰‡èµ„æº
â”œâ”€â”€ fonts/         â† å­—ä½“æ–‡ä»¶
â”œâ”€â”€ docs/          â† æ–‡æ¡£èµ„æº
â””â”€â”€ favicon.ico    â† ç½‘ç«™å›¾æ ‡
```

**ğŸ”¹ ç¼“å­˜ç­–ç•¥å»ºè®®**
```
ä¸åŒèµ„æºçš„ç¼“å­˜æ—¶é—´ï¼š
CSS/JSæ–‡ä»¶ï¼š    7-30å¤© (å¸¦ç‰ˆæœ¬å·)
å›¾ç‰‡æ–‡ä»¶ï¼š      30-365å¤© (å†…å®¹ä¸å¸¸å˜)
HTMLæ–‡ä»¶ï¼š      1å°æ—¶-1å¤© (å†…å®¹ç»å¸¸æ›´æ–°)
å­—ä½“æ–‡ä»¶ï¼š      365å¤© (å¾ˆå°‘å˜åŒ–)
APIæ–‡æ¡£ï¼š       1-24å°æ—¶ (å¯èƒ½æ›´æ–°)
```

**ğŸ”¹ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
å¿…åšçš„å®‰å…¨é…ç½®ï¼š
âœ… ç¦ç”¨ç›®å½•åˆ—è¡¨ (index: false)
âœ… å¿½ç•¥éšè—æ–‡ä»¶ (dotfiles: 'ignore')  
âœ… é™åˆ¶æ–‡ä»¶ç±»å‹è®¿é—®
âœ… è®°å½•è®¿é—®æ—¥å¿—
âœ… ä½¿ç”¨HTTPSä¼ è¾“æ•æ„Ÿèµ„æº
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
å…³é”®ä¼˜åŒ–æªæ–½ï¼š
ğŸš€ å¯ç”¨Gzipå‹ç¼©
ğŸš€ åˆç†è®¾ç½®ç¼“å­˜ç­–ç•¥
ğŸš€ ä½¿ç”¨CDNåŠ é€Ÿ
ğŸš€ æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†
ğŸš€ å‹ç¼©å›¾ç‰‡å’Œä»£ç 
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**é—®é¢˜1ï¼šé™æ€æ–‡ä»¶404é”™è¯¯**
```javascript
// æ£€æŸ¥è·¯å¾„é…ç½®
console.log('é™æ€ç›®å½•:', path.join(__dirname, 'public'));
console.log('æ–‡ä»¶æ˜¯å¦å­˜åœ¨:', fs.existsSync(path.join(__dirname, 'public/css/style.css')));
```

**é—®é¢˜2ï¼šç¼“å­˜è¿‡æœŸä¸æ›´æ–°**
```javascript
// å¼€å‘ç¯å¢ƒç¦ç”¨ç¼“å­˜
if (process.env.NODE_ENV === 'development') {
    app.use(express.static('public', {
        maxAge: 0,
        etag: false
    }));
}
```

**é—®é¢˜3ï¼šä¸­æ–‡æ–‡ä»¶åä¹±ç **
```javascript
// è®¾ç½®æ­£ç¡®çš„å­—ç¬¦ç¼–ç 
app.use(express.static('public', {
    setHeaders: (res, path) => {
        if (path.match(/\.(css|js)$/)) {
            res.setHeader('Content-Type', 'text/plain; charset=utf-8');
        }
    }
}));
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- é™æ€èµ„æºæœåŠ¡è®©æ–‡ä»¶å¯ç›´æ¥è®¿é—®ä¸‹è½½
- express.static()æ˜¯Expressæä¾›é™æ€æœåŠ¡çš„æ ‡å‡†æ–¹å¼
- è™šæ‹Ÿè·¯å¾„è®©URLæ›´è§„èŒƒæ›´å®‰å…¨
- ç¼“å­˜ç­–ç•¥å¹³è¡¡æ€§èƒ½å’Œæ›´æ–°éœ€æ±‚  
- å®‰å…¨é…ç½®é˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²