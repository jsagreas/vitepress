---
title: 2ã€é…ç½®æ–‡ä»¶ä¸ç¯å¢ƒç®¡ç†
---
## ğŸ“š ç›®å½•

1. [é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [ç¯å¢ƒå˜é‡ä¸.envæ–‡ä»¶](#2-ç¯å¢ƒå˜é‡ä¸envæ–‡ä»¶)
3. [é…ç½®æ–‡ä»¶åˆ†å±‚ç­–ç•¥](#3-é…ç½®æ–‡ä»¶åˆ†å±‚ç­–ç•¥)
4. [dotenvåŒ…æ·±åº¦åº”ç”¨](#4-dotenvåŒ…æ·±åº¦åº”ç”¨)
5. [å¤šç¯å¢ƒé…ç½®å®æˆ˜](#5-å¤šç¯å¢ƒé…ç½®å®æˆ˜)
6. [æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ç­–ç•¥](#6-æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ç­–ç•¥)
7. [é…ç½®éªŒè¯ä¸é»˜è®¤å€¼](#7-é…ç½®éªŒè¯ä¸é»˜è®¤å€¼)
8. [é«˜çº§é…ç½®ç®¡ç†æŠ€å·§](#8-é«˜çº§é…ç½®ç®¡ç†æŠ€å·§)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ç®¡ç†


**ç®€å•ç†è§£**ï¼šé…ç½®ç®¡ç†å°±åƒç»™ä½ çš„ç¨‹åºå‡†å¤‡ä¸€ä¸ª"è®¾ç½®é¢æ¿"

```
ç°å®ç±»æ¯”ï¼š
æ‰‹æœºè®¾ç½® ğŸ“±              Node.js é…ç½®
â”œâ”€â”€ ç½‘ç»œè®¾ç½®            â”œâ”€â”€ æ•°æ®åº“è¿æ¥
â”œâ”€â”€ æ˜¾ç¤ºäº®åº¦            â”œâ”€â”€ æœåŠ¡å™¨ç«¯å£
â”œâ”€â”€ é€šçŸ¥è®¾ç½®            â”œâ”€â”€ APIå¯†é’¥
â””â”€â”€ éšç§è®¾ç½®            â””â”€â”€ æ—¥å¿—çº§åˆ«

éƒ½æ˜¯ä¸ºäº†è®©ç¨‹åºåœ¨ä¸åŒæƒ…å†µä¸‹è¡¨ç°ä¸åŒ
```

**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç®¡ç†**
- **ç¯å¢ƒé€‚åº”** - å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸åŒè®¾ç½®
- **å®‰å…¨ä¿æŠ¤** - å¯†ç ã€å¯†é’¥ä¸èƒ½å†™æ­»åœ¨ä»£ç é‡Œ
- **çµæ´»è°ƒæ•´** - ä¸æ”¹ä»£ç å°±èƒ½ä¿®æ”¹ç¨‹åºè¡Œä¸º
- **å›¢é˜Ÿåä½œ** - æ¯ä¸ªäººçš„æœ¬åœ°è®¾ç½®å¯ä»¥ä¸åŒ

### 1.2 é…ç½®ç®¡ç†çš„æ ¸å¿ƒåŸåˆ™


**ğŸ“‹ åŸºæœ¬åŸåˆ™**
```
âœ… é…ç½®ä¸ä»£ç åˆ†ç¦»     - è®¾ç½®ä¸å†™åœ¨ä»£ç é‡Œ
âœ… ç¯å¢ƒç‰¹å®šé…ç½®      - ä¸åŒç¯å¢ƒä¸åŒè®¾ç½®  
âœ… æ•æ„Ÿä¿¡æ¯ä¿æŠ¤      - å¯†ç å¯†é’¥è¦åŠ å¯†
âœ… é»˜è®¤å€¼æœºåˆ¶        - æ²¡é…ç½®æ—¶æœ‰å¤‡ç”¨å€¼
âœ… éªŒè¯æœºåˆ¶          - é…ç½®æ ¼å¼è¦æ£€æŸ¥
```

### 1.3 å¸¸è§é…ç½®ç®¡ç†æ–¹å¼


| æ–¹å¼ | **è¯´æ˜** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|----------|----------|----------|-------------|
| ğŸ”§ **ç¯å¢ƒå˜é‡** | `process.env.PORT` | `ç®€å•ç›´æ¥` | `å¤§é‡é…ç½®æ—¶æ··ä¹±` | `ç®€å•é¡¹ç›®` |
| ğŸ“„ **.envæ–‡ä»¶** | `.env` æ–‡ä»¶å­˜å‚¨ | `ä¾¿äºç®¡ç†` | `éœ€è¦é¢å¤–å·¥å…·` | `ä¸­å°é¡¹ç›®` |
| ğŸ“ **JSONé…ç½®** | `config.json` | `ç»“æ„æ¸…æ™°` | `ä¸æ”¯æŒæ³¨é‡Š` | `ç»“æ„åŒ–é…ç½®` |
| ğŸ—ï¸ **é…ç½®åˆ†å±‚** | `å¤šæ–‡ä»¶ç»„åˆ` | `çµæ´»å¼ºå¤§` | `å¤æ‚åº¦é«˜` | `å¤§å‹é¡¹ç›®` |

---

## 2. ğŸŒ ç¯å¢ƒå˜é‡ä¸.envæ–‡ä»¶


### 2.1 ç¯å¢ƒå˜é‡åŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡**
ç¯å¢ƒå˜é‡å°±åƒä½ ç”µè„‘çš„"å…¨å±€è®¾ç½®"ï¼Œæ‰€æœ‰ç¨‹åºéƒ½èƒ½è¯»å–

```bash
# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
echo $PATH        # ç³»ç»Ÿè·¯å¾„
echo $HOME        # ç”¨æˆ·ç›®å½•  
echo $NODE_ENV    # Node.jsç¯å¢ƒæ ‡è¯†
```

**ğŸ’¡ Node.jsä¸­è¯»å–ç¯å¢ƒå˜é‡**
```javascript
// è¯»å–ç¯å¢ƒå˜é‡
console.log(process.env.NODE_ENV);  // 'development' æˆ– 'production'
console.log(process.env.PORT);      // '3000'
console.log(process.env.DATABASE_URL); // æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

// è®¾ç½®é»˜è®¤å€¼
const port = process.env.PORT || 3000;
const env = process.env.NODE_ENV || 'development';
```

### 2.2 .envæ–‡ä»¶å…¥é—¨


**.envæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ**
- å°±æ˜¯ä¸€ä¸ª**æ–‡æœ¬æ–‡ä»¶**ï¼Œä¸“é—¨å­˜æ”¾ç¯å¢ƒå˜é‡
- æ¯è¡Œä¸€ä¸ªé…ç½®ï¼Œæ ¼å¼ï¼š`å˜é‡å=å˜é‡å€¼`
- è®©ç®¡ç†é…ç½®å˜å¾—**ç®€å•ç›´è§‚**

**ğŸ”§ .envæ–‡ä»¶ç¤ºä¾‹**
```bash
# .env æ–‡ä»¶å†…å®¹
NODE_ENV=development
PORT=3000
DATABASE_URL=mongodb://localhost:27017/myapp
API_SECRET=your-secret-key-here
DEBUG=true
```

### 2.3 .envæ–‡ä»¶ä½¿ç”¨è§„èŒƒ


**ğŸ“‹ å‘½åè§„èŒƒ**
```bash
# âœ… æ¨èçš„å‘½åæ–¹å¼
DATABASE_URL=mongodb://localhost:27017/app
API_BASE_URL=https://api.example.com
JWT_SECRET=your-jwt-secret
REDIS_PORT=6379

# âŒ ä¸æ¨èçš„å‘½å
db_url=mongodb://localhost:27017/app    # å°å†™
api-base-url=https://api.example.com    # è¿å­—ç¬¦
jwtSecret=your-jwt-secret               # é©¼å³°å‘½å
```

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```bash
# âœ… æ­£ç¡®æ ¼å¼
API_KEY=abc123
DATABASE_URL=mongodb://localhost:27017

# âŒ é”™è¯¯æ ¼å¼  
API_KEY = abc123        # ç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼
DATABASE_URL =          # å€¼ä¸èƒ½ä¸ºç©º
# API_KEY=abc123        # è¿™æ ·å†™æ³¨é‡Šæ˜¯é”™è¯¯çš„
```

---

## 3. ğŸ“ é…ç½®æ–‡ä»¶åˆ†å±‚ç­–ç•¥


### 3.1 åˆ†å±‚é…ç½®çš„åŸºæœ¬æ€è·¯


**ğŸ—ï¸ åˆ†å±‚å°±åƒæ­ç§¯æœ¨**
```
é…ç½®æ–‡ä»¶ç»“æ„ï¼š
config/
â”œâ”€â”€ default.js          # é»˜è®¤é…ç½®ï¼ˆåŸºç¡€ç§¯æœ¨ï¼‰
â”œâ”€â”€ development.js      # å¼€å‘ç¯å¢ƒï¼ˆå¼€å‘ä¸“ç”¨ç§¯æœ¨ï¼‰
â”œâ”€â”€ production.js       # ç”Ÿäº§ç¯å¢ƒï¼ˆç”Ÿäº§ä¸“ç”¨ç§¯æœ¨ï¼‰
â””â”€â”€ local.js           # ä¸ªäººé…ç½®ï¼ˆä¸ªæ€§åŒ–ç§¯æœ¨ï¼‰

æœ€ç»ˆé…ç½® = é»˜è®¤ + ç¯å¢ƒç‰¹å®š + ä¸ªäººé…ç½®
```

### 3.2 å®é™…é¡¹ç›®é…ç½®ç»“æ„


**ğŸ“‚ é¡¹ç›®é…ç½®ç›®å½•è®¾è®¡**
```
my-project/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ default.js      # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ development.js  # å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ production.js   # ç”Ÿäº§ç¯å¢ƒ
â”‚   â”œâ”€â”€ test.js        # æµ‹è¯•ç¯å¢ƒ
â”‚   â””â”€â”€ index.js       # é…ç½®åŠ è½½å™¨
â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example       # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ app.js            # åº”ç”¨å…¥å£
```

**ğŸ”§ åŸºç¡€é…ç½®æ–‡ä»¶ç¤ºä¾‹**
```javascript
// config/default.js - é»˜è®¤é…ç½®
module.exports = {
  server: {
    port: 3000,
    host: 'localhost'
  },
  database: {
    host: 'localhost',
    port: 27017,
    name: 'myapp'
  },
  logging: {
    level: 'info',
    file: './logs/app.log'
  }
};
```

```javascript
// config/development.js - å¼€å‘ç¯å¢ƒé…ç½®
module.exports = {
  database: {
    name: 'myapp_dev'  // å¼€å‘æ•°æ®åº“
  },
  logging: {
    level: 'debug'     // å¼€å‘æ—¶æ˜¾ç¤ºæ›´å¤šæ—¥å¿—
  },
  debug: true
};
```

```javascript
// config/production.js - ç”Ÿäº§ç¯å¢ƒé…ç½®
module.exports = {
  server: {
    port: process.env.PORT || 80
  },
  database: {
    host: process.env.DB_HOST,
    name: process.env.DB_NAME
  },
  logging: {
    level: 'error'     // ç”Ÿäº§ç¯å¢ƒåªè®°å½•é”™è¯¯
  },
  debug: false
};
```

### 3.3 é…ç½®åŠ è½½å™¨å®ç°


**ğŸ”„ é…ç½®åˆå¹¶é€»è¾‘**
```javascript
// config/index.js - é…ç½®åŠ è½½å™¨
const path = require('path');

function loadConfig() {
  const env = process.env.NODE_ENV || 'development';
  
  // â‘  åŠ è½½é»˜è®¤é…ç½®
  const defaultConfig = require('./default');
  
  // â‘¡ åŠ è½½ç¯å¢ƒç‰¹å®šé…ç½®
  let envConfig = {};
  try {
    envConfig = require(`./${env}`);
  } catch (err) {
    console.log(`æœªæ‰¾åˆ° ${env} ç¯å¢ƒé…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®`);
  }
  
  // â‘¢ åŠ è½½æœ¬åœ°ä¸ªäººé…ç½®ï¼ˆå¯é€‰ï¼‰
  let localConfig = {};
  try {
    localConfig = require('./local');
  } catch (err) {
    // æœ¬åœ°é…ç½®æ˜¯å¯é€‰çš„
  }
  
  // â‘£ åˆå¹¶é…ç½®ï¼ˆåé¢çš„è¦†ç›–å‰é¢çš„ï¼‰
  return Object.assign({}, defaultConfig, envConfig, localConfig);
}

module.exports = loadConfig();
```

---

## 4. ğŸ”§ dotenvåŒ…æ·±åº¦åº”ç”¨


### 4.1 dotenvåŒ…å®‰è£…ä¸åŸºç¡€ä½¿ç”¨


**ğŸ“¦ å®‰è£…dotenv**
```bash
npm install dotenv
```

**ğŸš€ åŸºç¡€ä½¿ç”¨æ–¹å¼**
```javascript
// app.js - åœ¨æ–‡ä»¶æœ€é¡¶éƒ¨å¼•å…¥
require('dotenv').config();

// ç°åœ¨å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡äº†
console.log(process.env.DATABASE_URL);
console.log(process.env.API_SECRET);
```

### 4.2 dotenvé…ç½®ä¼˜å…ˆçº§


**ğŸ“Š é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰**
```
â‘  çœŸå®ç¯å¢ƒå˜é‡     process.env.PORT=8080
â‘¡ .env.local      PORT=3001  
â‘¢ .env            PORT=3000
â‘£ ä»£ç é»˜è®¤å€¼       port = 3000
```

**ğŸ’¡ å®é™…ç¤ºä¾‹**
```javascript
// .env æ–‡ä»¶
PORT=3000
NODE_ENV=development

// .env.local æ–‡ä»¶ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
PORT=3001

// ç»ˆç«¯è®¾ç½®
export PORT=8080

// æœ€ç»ˆç»“æœï¼šprocess.env.PORT = "8080"
```

### 4.3 ä¸åŒç¯å¢ƒçš„.envæ–‡ä»¶


**ğŸŒ å¤š.envæ–‡ä»¶ç­–ç•¥**
```
é¡¹ç›®ç›®å½•/
â”œâ”€â”€ .env                 # é€šç”¨é…ç½®
â”œâ”€â”€ .env.development     # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ .env.production      # ç”Ÿäº§ç¯å¢ƒ  
â”œâ”€â”€ .env.test           # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ .env.local          # æœ¬åœ°ä¸ªäººé…ç½®
â””â”€â”€ .env.example        # é…ç½®æ¨¡æ¿
```

**ğŸ”§ è‡ªåŠ¨åŠ è½½å¯¹åº”ç¯å¢ƒçš„.env**
```javascript
// config/dotenv.js
const dotenv = require('dotenv');
const path = require('path');

const env = process.env.NODE_ENV || 'development';

// æŒ‰ä¼˜å…ˆçº§åŠ è½½å¤šä¸ª.envæ–‡ä»¶
const envFiles = [
  `.env.${env}.local`,  // ç¯å¢ƒç‰¹å®šçš„æœ¬åœ°é…ç½®
  `.env.local`,         // æœ¬åœ°é…ç½®
  `.env.${env}`,        // ç¯å¢ƒç‰¹å®šé…ç½®
  `.env`                // é€šç”¨é…ç½®
];

envFiles.forEach(file => {
  dotenv.config({
    path: path.resolve(process.cwd(), file)
  });
});
```

### 4.4 dotenvé«˜çº§é…ç½®é€‰é¡¹


**âš™ï¸ dotenvè¯¦ç»†é…ç½®**
```javascript
require('dotenv').config({
  path: './custom.env',          // è‡ªå®šä¹‰æ–‡ä»¶è·¯å¾„
  encoding: 'utf8',              // æ–‡ä»¶ç¼–ç 
  debug: true,                   // å¼€å¯è°ƒè¯•æ¨¡å¼
  override: false                // æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç¯å¢ƒå˜é‡
});
```

---

## 5. ğŸŒ å¤šç¯å¢ƒé…ç½®å®æˆ˜


### 5.1 ç¯å¢ƒåˆ†ç±»ä¸é…ç½®ç­–ç•¥


**ğŸ—ï¸ æ ‡å‡†ç¯å¢ƒåˆ†ç±»**
```
å¼€å‘ç¯å¢ƒ (development)
â”œâ”€â”€ æœ¬åœ°æ•°æ®åº“
â”œâ”€â”€ è¯¦ç»†æ—¥å¿—è¾“å‡º
â”œâ”€â”€ çƒ­é‡è½½å¼€å¯
â””â”€â”€ è°ƒè¯•æ¨¡å¼å¼€å¯

æµ‹è¯•ç¯å¢ƒ (test)  
â”œâ”€â”€ æµ‹è¯•æ•°æ®åº“
â”œâ”€â”€ ç®€åŒ–æ—¥å¿—
â”œâ”€â”€ å¿«é€Ÿå¯åŠ¨
â””â”€â”€ è¦†ç›–ç‡ç»Ÿè®¡

ç”Ÿäº§ç¯å¢ƒ (production)
â”œâ”€â”€ ç”Ÿäº§æ•°æ®åº“
â”œâ”€â”€ é”™è¯¯æ—¥å¿—only
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
â””â”€â”€ å®‰å…¨åŠ å›º
```

### 5.2 å®Œæ•´çš„å¤šç¯å¢ƒé…ç½®ç¤ºä¾‹


**ğŸ“„ .env.development**
```bash
# å¼€å‘ç¯å¢ƒé…ç½®
NODE_ENV=development
PORT=3000
DEBUG=true

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=27017
DB_NAME=myapp_dev
DB_USER=dev_user
DB_PASS=dev_password

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379

# APIé…ç½®
API_TIMEOUT=5000
LOG_LEVEL=debug
```

**ğŸ“„ .env.production**
```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®
NODE_ENV=production
PORT=80
DEBUG=false

# æ•°æ®åº“é…ç½®ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼‰
DB_HOST=${PRODUCTION_DB_HOST}
DB_PORT=${PRODUCTION_DB_PORT}
DB_NAME=${PRODUCTION_DB_NAME}
DB_USER=${PRODUCTION_DB_USER}
DB_PASS=${PRODUCTION_DB_PASS}

# Redisé…ç½®
REDIS_HOST=${PRODUCTION_REDIS_HOST}
REDIS_PORT=6379

# APIé…ç½®
API_TIMEOUT=3000
LOG_LEVEL=error
```

### 5.3 ç¯å¢ƒåˆ‡æ¢å®ç°


**ğŸ”„ ç¯å¢ƒåˆ‡æ¢è„šæœ¬**
```javascript
// scripts/env-setup.js
const fs = require('fs');
const path = require('path');

function setupEnvironment(env) {
  const envFile = `.env.${env}`;
  const targetFile = '.env';
  
  if (fs.existsSync(envFile)) {
    fs.copyFileSync(envFile, targetFile);
    console.log(`âœ… å·²åˆ‡æ¢åˆ° ${env} ç¯å¢ƒ`);
  } else {
    console.error(`âŒ æ‰¾ä¸åˆ° ${envFile} æ–‡ä»¶`);
  }
}

// ä»å‘½ä»¤è¡Œå‚æ•°è·å–ç¯å¢ƒ
const env = process.argv[2];
if (env) {
  setupEnvironment(env);
} else {
  console.log('ä½¿ç”¨æ–¹æ³•: node scripts/env-setup.js <ç¯å¢ƒå>');
}
```

**ğŸ“‹ package.jsonè„šæœ¬**
```json
{
  "scripts": {
    "dev": "node scripts/env-setup.js development && nodemon app.js",
    "test": "node scripts/env-setup.js test && npm run test-runner",
    "prod": "node scripts/env-setup.js production && node app.js",
    "build": "node scripts/env-setup.js production && npm run build-assets"
  }
}
```

---

## 6. ğŸ”’ æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ç­–ç•¥


### 6.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿä¿¡æ¯


**ğŸš¨ éœ€è¦ä¿æŠ¤çš„ä¿¡æ¯ç±»å‹**
```
æ•°æ®åº“å¯†ç          DATABASE_PASSWORD=secret123
APIå¯†é’¥           API_SECRET=sk-1234567890abcdef  
JWTç­¾åå¯†é’¥       JWT_SECRET=your-super-secret-key
ç¬¬ä¸‰æ–¹æœåŠ¡å¯†é’¥     STRIPE_SECRET_KEY=sk_test_...
SSLè¯ä¹¦è·¯å¾„       SSL_CERT_PATH=/path/to/cert.pem
```

### 6.2 .envæ–‡ä»¶å®‰å…¨å®è·µ


**ğŸ“‹ .gitignoreé…ç½®**
```bash
# .gitignore - é˜²æ­¢æ•æ„Ÿæ–‡ä»¶è¢«æäº¤
.env
.env.local
.env.production
.env.*.local

# ä½†è¦ä¿ç•™ç¤ºä¾‹æ–‡ä»¶
!.env.example
```

**ğŸ“ .env.exampleæ¨¡æ¿**
```bash
# .env.example - å®‰å…¨çš„é…ç½®æ¨¡æ¿
NODE_ENV=development
PORT=3000

# æ•°æ®åº“é…ç½®ï¼ˆè¯·ä¿®æ”¹ä¸ºå®é™…å€¼ï¼‰
DB_HOST=localhost
DB_PORT=27017
DB_NAME=your_database_name
DB_USER=your_username
DB_PASS=your_password

# APIå¯†é’¥ï¼ˆè¯·åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼‰
API_SECRET=your-api-secret-here
JWT_SECRET=your-jwt-secret-here
```

### 6.3 é…ç½®åŠ å¯†ç­–ç•¥


**ğŸ” ç®€å•é…ç½®åŠ å¯†å®ç°**
```javascript
// utils/crypto.js - ç®€å•çš„é…ç½®åŠ å¯†å·¥å…·
const crypto = require('crypto');

const ENCRYPTION_KEY = process.env.CONFIG_KEY || 'default-32-char-key-for-encryption';
const ALGORITHM = 'aes-256-gcm';

function encrypt(text) {
  const iv = crypto.randomBytes(16);
  const cipher = crypto.createCipher(ALGORITHM, ENCRYPTION_KEY);
  
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  return `${iv.toString('hex')}:${encrypted}`;
}

function decrypt(encryptedText) {
  const [ivHex, encrypted] = encryptedText.split(':');
  const iv = Buffer.from(ivHex, 'hex');
  const decipher = crypto.createDecipher(ALGORITHM, ENCRYPTION_KEY);
  
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  
  return decrypted;
}

module.exports = { encrypt, decrypt };
```

**ğŸ”§ åŠ å¯†é…ç½®ä½¿ç”¨**
```javascript
// config/secure.js - å®‰å…¨é…ç½®åŠ è½½
const { decrypt } = require('../utils/crypto');

function loadSecureConfig() {
  return {
    database: {
      password: decrypt(process.env.DB_PASS_ENCRYPTED)
    },
    api: {
      secret: decrypt(process.env.API_SECRET_ENCRYPTED)
    }
  };
}
```

---

## 7. âœ… é…ç½®éªŒè¯ä¸é»˜è®¤å€¼


### 7.1 é…ç½®éªŒè¯çš„é‡è¦æ€§


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯é…ç½®**
```
é˜²æ­¢å¯åŠ¨é”™è¯¯      ç¼ºå°‘å¿…éœ€é…ç½®å¯¼è‡´åº”ç”¨å´©æºƒ
æ•°æ®ç±»å‹æ£€æŸ¥      ç«¯å£å·å¿…é¡»æ˜¯æ•°å­—
æ ¼å¼éªŒè¯         é‚®ç®±åœ°å€æ ¼å¼æ£€æŸ¥  
èŒƒå›´éªŒè¯         ç«¯å£å·åœ¨1-65535ä¹‹é—´
```

### 7.2 ç®€å•çš„é…ç½®éªŒè¯


**ğŸ”§ åŸºç¡€éªŒè¯å‡½æ•°**
```javascript
// config/validator.js
function validateConfig(config) {
  const errors = [];
  
  // æ£€æŸ¥å¿…éœ€å­—æ®µ
  if (!config.port) {
    errors.push('PORT æ˜¯å¿…éœ€çš„');
  }
  
  if (!config.database.host) {
    errors.push('DATABASE_HOST æ˜¯å¿…éœ€çš„');
  }
  
  // æ£€æŸ¥æ•°æ®ç±»å‹
  if (config.port && isNaN(config.port)) {
    errors.push('PORT å¿…é¡»æ˜¯æ•°å­—');
  }
  
  // æ£€æŸ¥æ•°å€¼èŒƒå›´
  if (config.port && (config.port < 1 || config.port > 65535)) {
    errors.push('PORT å¿…é¡»åœ¨ 1-65535 ä¹‹é—´');
  }
  
  if (errors.length > 0) {
    console.error('âŒ é…ç½®éªŒè¯å¤±è´¥:');
    errors.forEach(error => console.error(`  - ${error}`));
    process.exit(1);
  }
  
  console.log('âœ… é…ç½®éªŒè¯é€šè¿‡');
}

module.exports = { validateConfig };
```

### 7.3 é»˜è®¤å€¼è®¾ç½®ç­–ç•¥


**ğŸ”§ æ™ºèƒ½é»˜è®¤å€¼å®ç°**
```javascript
// config/defaults.js
function applyDefaults(config) {
  return {
    // æœåŠ¡å™¨é…ç½®
    port: config.port || 3000,
    host: config.host || 'localhost',
    
    // æ•°æ®åº“é…ç½®
    database: {
      host: config.database?.host || 'localhost',
      port: config.database?.port || 27017,
      name: config.database?.name || 'myapp',
      ...config.database
    },
    
    // æ—¥å¿—é…ç½®
    logging: {
      level: config.logging?.level || 'info',
      file: config.logging?.file || './logs/app.log',
      ...config.logging
    },
    
    // å…¶ä»–é…ç½®
    debug: config.debug !== undefined ? config.debug : false,
    timeout: config.timeout || 5000,
    
    ...config
  };
}
```

### 7.4 ä½¿ç”¨Joiè¿›è¡Œé«˜çº§éªŒè¯


**ğŸ“¦ å®‰è£…JoiéªŒè¯åº“**
```bash
npm install joi
```

**ğŸ”§ JoiéªŒè¯æ¨¡å¼**
```javascript
// config/schema.js
const Joi = require('joi');

const configSchema = Joi.object({
  NODE_ENV: Joi.string().valid('development', 'production', 'test').default('development'),
  PORT: Joi.number().port().default(3000),
  
  DATABASE_HOST: Joi.string().required(),
  DATABASE_PORT: Joi.number().port().default(27017),
  DATABASE_NAME: Joi.string().required(),
  
  API_SECRET: Joi.string().min(32).required(),
  
  LOG_LEVEL: Joi.string().valid('error', 'warn', 'info', 'debug').default('info')
});

function validateConfig(config) {
  const { error, value } = configSchema.validate(config, {
    allowUnknown: true,
    stripUnknown: true
  });
  
  if (error) {
    throw new Error(`é…ç½®éªŒè¯å¤±è´¥: ${error.message}`);
  }
  
  return value;
}

module.exports = { validateConfig };
```

---

## 8. ğŸš€ é«˜çº§é…ç½®ç®¡ç†æŠ€å·§


### 8.1 é…ç½®çƒ­é‡è½½å®ç°


**ğŸ”„ ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–**
```javascript
// config/hot-reload.js
const fs = require('fs');
const path = require('path');

class ConfigManager {
  constructor() {
    this.config = this.loadConfig();
    this.watchers = [];
    this.setupWatchers();
  }
  
  loadConfig() {
    // åŠ è½½é…ç½®é€»è¾‘
    delete require.cache[require.resolve('./index.js')];
    return require('./index.js');
  }
  
  setupWatchers() {
    const configFiles = ['.env', 'config/default.js'];
    
    configFiles.forEach(file => {
      if (fs.existsSync(file)) {
        const watcher = fs.watch(file, () => {
          console.log(`ğŸ“ é…ç½®æ–‡ä»¶ ${file} å·²æ›´æ–°ï¼Œé‡æ–°åŠ è½½...`);
          this.config = this.loadConfig();
          this.notifyListeners();
        });
        this.watchers.push(watcher);
      }
    });
  }
  
  notifyListeners() {
    // é€šçŸ¥åº”ç”¨é…ç½®å·²æ›´æ–°
    process.emit('config-updated', this.config);
  }
  
  destroy() {
    this.watchers.forEach(watcher => watcher.close());
  }
}

module.exports = new ConfigManager();
```

### 8.2 é…ç½®ä¸­å¿ƒåŒ–ç®¡ç†


**ğŸ¢ è¿œç¨‹é…ç½®æœåŠ¡æ¨¡æ‹Ÿ**
```javascript
// config/remote-config.js
const https = require('https');

class RemoteConfigService {
  constructor(configUrl, apiKey) {
    this.configUrl = configUrl;
    this.apiKey = apiKey;
    this.cache = new Map();
  }
  
  async fetchConfig(appName, env) {
    const cacheKey = `${appName}-${env}`;
    
    // æ£€æŸ¥ç¼“å­˜
    if (this.cache.has(cacheKey)) {
      const cached = this.cache.get(cacheKey);
      if (Date.now() - cached.timestamp < 300000) { // 5åˆ†é’Ÿç¼“å­˜
        return cached.config;
      }
    }
    
    try {
      const config = await this.httpRequest(`${this.configUrl}/${appName}/${env}`);
      
      // æ›´æ–°ç¼“å­˜
      this.cache.set(cacheKey, {
        config,
        timestamp: Date.now()
      });
      
      return config;
    } catch (error) {
      console.error('è·å–è¿œç¨‹é…ç½®å¤±è´¥:', error.message);
      return null;
    }
  }
  
  httpRequest(url) {
    return new Promise((resolve, reject) => {
      const options = {
        headers: { 'Authorization': `Bearer ${this.apiKey}` }
      };
      
      https.get(url, options, (res) => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => {
          try {
            resolve(JSON.parse(data));
          } catch (e) {
            reject(e);
          }
        });
      }).on('error', reject);
    });
  }
}
```

### 8.3 é…ç½®ç‰ˆæœ¬ç®¡ç†


**ğŸ“‹ é…ç½®å˜æ›´è¿½è¸ª**
```javascript
// config/version-manager.js
const fs = require('fs');
const crypto = require('crypto');

class ConfigVersionManager {
  constructor() {
    this.versionsFile = './config/versions.json';
    this.versions = this.loadVersions();
  }
  
  loadVersions() {
    try {
      return JSON.parse(fs.readFileSync(this.versionsFile, 'utf8'));
    } catch {
      return { versions: [], current: null };
    }
  }
  
  saveVersions() {
    fs.writeFileSync(this.versionsFile, JSON.stringify(this.versions, null, 2));
  }
  
  createVersion(config, description) {
    const configHash = this.hashConfig(config);
    const version = {
      id: `v${Date.now()}`,
      hash: configHash,
      description,
      timestamp: new Date().toISOString(),
      config: JSON.parse(JSON.stringify(config))
    };
    
    this.versions.versions.push(version);
    this.versions.current = version.id;
    this.saveVersions();
    
    console.log(`âœ… é…ç½®ç‰ˆæœ¬ ${version.id} å·²åˆ›å»º: ${description}`);
    return version.id;
  }
  
  hashConfig(config) {
    const str = JSON.stringify(config, Object.keys(config).sort());
    return crypto.createHash('md5').update(str).digest('hex');
  }
  
  rollback(versionId) {
    const version = this.versions.versions.find(v => v.id === versionId);
    if (!version) {
      throw new Error(`ç‰ˆæœ¬ ${versionId} ä¸å­˜åœ¨`);
    }
    
    this.versions.current = versionId;
    this.saveVersions();
    
    console.log(`ğŸ”„ å·²å›æ»šåˆ°ç‰ˆæœ¬ ${versionId}`);
    return version.config;
  }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é…ç½®åˆ†ç¦»åŸåˆ™ï¼šé…ç½®ä¸å†™åœ¨ä»£ç é‡Œï¼Œç”¨ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
ğŸ”¸ ç¯å¢ƒå˜é‡ä½¿ç”¨ï¼šprocess.envè¯»å–ï¼Œ.envæ–‡ä»¶ç®¡ç†
ğŸ”¸ åˆ†å±‚é…ç½®ç­–ç•¥ï¼šé»˜è®¤é…ç½® + ç¯å¢ƒé…ç½® + ä¸ªäººé…ç½®  
ğŸ”¸ dotenvå·¥å…·ï¼šç®€åŒ–.envæ–‡ä»¶çš„åŠ è½½å’Œç®¡ç†
ğŸ”¸ å¤šç¯å¢ƒç®¡ç†ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„ä¸åŒé…ç½®
ğŸ”¸ æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ï¼šå¯†ç å¯†é’¥ä¸èƒ½æäº¤åˆ°ä»£ç ä»“åº“
```

### 9.2 å®ç”¨é…ç½®ç®¡ç†æŠ€å·§


**ğŸ¯ é…ç½®æ–‡ä»¶ç»„ç»‡**
```javascript
// æ¨èçš„é…ç½®ç»“æ„
{
  server: { port, host, ssl },           // æœåŠ¡å™¨é…ç½®
  database: { host, port, name, auth },  // æ•°æ®åº“é…ç½®
  cache: { redis, memcached },           // ç¼“å­˜é…ç½®
  external: { apis, services },          // å¤–éƒ¨æœåŠ¡
  logging: { level, file, format },      // æ—¥å¿—é…ç½®
  security: { cors, rate_limit }         // å®‰å…¨é…ç½®
}
```

**âš¡ é…ç½®åŠ è½½æœ€ä½³å®è·µ**
```javascript
// æ ‡å‡†é…ç½®åŠ è½½æµç¨‹
â‘  åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆdotenvï¼‰
â‘¡ åº”ç”¨é»˜è®¤å€¼
â‘¢ éªŒè¯é…ç½®å®Œæ•´æ€§
â‘£ å¯åŠ¨åº”ç”¨æœåŠ¡
```

### 9.3 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


**ğŸ”§ é—®é¢˜æ’æŸ¥æ¸…å•**
```
â–¡ .envæ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®ï¼Ÿ
â–¡ ç¯å¢ƒå˜é‡å‘½åæ˜¯å¦è§„èŒƒï¼Ÿ
â–¡ æ˜¯å¦åœ¨ä»£ç æœ€é¡¶éƒ¨åŠ è½½dotenvï¼Ÿ
â–¡ æ•æ„Ÿæ–‡ä»¶æ˜¯å¦å·²åŠ å…¥.gitignoreï¼Ÿ
â–¡ é…ç½®ä¼˜å…ˆçº§æ˜¯å¦æ­£ç¡®ï¼Ÿ
â–¡ ç”Ÿäº§ç¯å¢ƒé…ç½®æ˜¯å¦å®Œæ•´ï¼Ÿ
```

**ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
- **ç¼“å­˜é…ç½®** - é¿å…é‡å¤è¯»å–æ–‡ä»¶
- **å»¶è¿ŸåŠ è½½** - æŒ‰éœ€åŠ è½½ä¸å¸¸ç”¨é…ç½®
- **é…ç½®é¢„ç¼–è¯‘** - æ„å»ºæ—¶åˆå¹¶é…ç½®æ–‡ä»¶
- **é…ç½®éªŒè¯** - å¯åŠ¨æ—¶ä¸€æ¬¡æ€§éªŒè¯æ‰€æœ‰é…ç½®

### 9.4 ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹


**ğŸš¨ å®‰å…¨æ£€æŸ¥æ¸…å•**
```
âœ… æ‰€æœ‰.envæ–‡ä»¶å·²æ·»åŠ åˆ°.gitignore
âœ… ç”Ÿäº§ç¯å¢ƒå¯†é’¥å·²é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®
âœ… é…ç½®æ–‡ä»¶æƒé™è®¾ç½®æ­£ç¡®
âœ… æ•æ„Ÿé…ç½®å·²åŠ å¯†å­˜å‚¨
âœ… é…ç½®æ›´æ–°æœ‰å®¡è®¡æ—¥å¿—
âœ… å¤‡ä»½å’Œæ¢å¤æœºåˆ¶å®Œå–„
```

**ğŸ¯ éƒ¨ç½²é…ç½®ç­–ç•¥**
```
å¼€å‘é˜¶æ®µï¼šä½¿ç”¨.envæ–‡ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯•
æµ‹è¯•é˜¶æ®µï¼šæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒï¼ŒéªŒè¯é…ç½®
ç”Ÿäº§éƒ¨ç½²ï¼šçº¯ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿å®‰å…¨
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- é…ç½®åˆ†ç¦»è®©ç¨‹åºæ›´çµæ´»
- ç¯å¢ƒå˜é‡æ˜¯é…ç½®çš„åŸºç¡€
- .envæ–‡ä»¶è®©ç®¡ç†æ›´ç®€å•
- åˆ†å±‚é…ç½®åº”å¯¹å¤æ‚éœ€æ±‚
- å®‰å…¨ä¿æŠ¤æ˜¯é‡ä¸­ä¹‹é‡