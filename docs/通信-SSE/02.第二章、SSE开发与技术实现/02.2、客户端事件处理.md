---
title: 2ã€å®¢æˆ·ç«¯äº‹ä»¶å¤„ç†
---
## ğŸ“š ç›®å½•

1. [SSEå®¢æˆ·ç«¯äº‹ä»¶å¤„ç†æ¦‚è¿°](#1-SSEå®¢æˆ·ç«¯äº‹ä»¶å¤„ç†æ¦‚è¿°)
2. [ä¸‰å¤§åŸºç¡€äº‹ä»¶è¯¦è§£](#2-ä¸‰å¤§åŸºç¡€äº‹ä»¶è¯¦è§£)
3. [è‡ªå®šä¹‰äº‹ä»¶å¤„ç†æœºåˆ¶](#3-è‡ªå®šä¹‰äº‹ä»¶å¤„ç†æœºåˆ¶)
4. [äº‹ä»¶å¯¹è±¡å±æ€§æ·±å…¥](#4-äº‹ä»¶å¯¹è±¡å±æ€§æ·±å…¥)
5. [å®é™…åº”ç”¨åœºæ™¯æ¼”ç¤º](#5-å®é™…åº”ç”¨åœºæ™¯æ¼”ç¤º)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ SSEå®¢æˆ·ç«¯äº‹ä»¶å¤„ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯SSEå®¢æˆ·ç«¯äº‹ä»¶å¤„ç†


**ğŸ”¸ é€šä¿—ç†è§£**
SSEå®¢æˆ·ç«¯äº‹ä»¶å¤„ç†å°±åƒæ˜¯**ç»™ä½ çš„ç½‘é¡µè£…ä¸Šè€³æœµ**ï¼Œè®©å®ƒèƒ½å¤Ÿ"å¬åˆ°"æœåŠ¡å™¨å‘æ¥çš„å„ç§"å£°éŸ³"ï¼ˆæ¶ˆæ¯ï¼‰ã€‚

```
æƒ³è±¡ä¸€ä¸‹æ”¶éŸ³æœºçš„åœºæ™¯ï¼š
ğŸ“» æ”¶éŸ³æœº = ä½ çš„ç½‘é¡µ
ğŸ“¡ ç”µå° = æœåŠ¡å™¨
ğŸµ ä¸åŒé¢‘é“ = ä¸åŒç±»å‹çš„äº‹ä»¶

æ”¶éŸ³æœºèƒ½å¬åˆ°ï¼š
- ğŸ“¢ å¼€å§‹æ’­æ”¾çš„å£°éŸ³ (onopenäº‹ä»¶)
- ğŸµ æ­£åœ¨æ’­æ”¾çš„éŸ³ä¹ (onmessageäº‹ä»¶)  
- âŒ ä¿¡å·ä¸­æ–­çš„æ‚éŸ³ (onerroräº‹ä»¶)
```

**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
- **ç›‘å¬æœåŠ¡å™¨çŠ¶æ€**ï¼šçŸ¥é“è¿æ¥æ˜¯å¦æˆåŠŸå»ºç«‹
- **æ¥æ”¶å®æ—¶æ•°æ®**ï¼šè·å–æœåŠ¡å™¨æ¨é€çš„æœ€æ–°ä¿¡æ¯
- **å¤„ç†å¼‚å¸¸æƒ…å†µ**ï¼šå½“å‡ºç°é—®é¢˜æ—¶åŠæ—¶å“åº”
- **åˆ†ç±»å¤„ç†æ¶ˆæ¯**ï¼šæ ¹æ®ä¸åŒäº‹ä»¶ç±»å‹åšä¸åŒçš„äº‹æƒ…

### 1.2 SSEäº‹ä»¶å¤„ç†æœºåˆ¶åŸç†


```
æœåŠ¡å™¨ç«¯                           å®¢æˆ·ç«¯æµè§ˆå™¨
    â”‚                                 â”‚
    â”‚â”€â”€â”€â”€[è¿æ¥å»ºç«‹]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ âœ… è§¦å‘onopenäº‹ä»¶
    â”‚                                 â”‚
    â”‚â”€â”€â”€â”€[å‘é€æ¶ˆæ¯1]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ğŸ“¨ è§¦å‘onmessageäº‹ä»¶
    â”‚                                 â”‚
    â”‚â”€â”€â”€â”€[å‘é€æ¶ˆæ¯2]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ğŸ“¨ è§¦å‘onmessageäº‹ä»¶
    â”‚                                 â”‚
    â”‚â”€â”€â”€â”€[è¿æ¥å¼‚å¸¸]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ âŒ è§¦å‘onerroräº‹ä»¶
```

**ğŸ’¡ ç†è§£è¦ç‚¹**ï¼š
- æ¯ä¸ªäº‹ä»¶éƒ½æœ‰**ç‰¹å®šçš„è§¦å‘æ—¶æœº**
- ä½ å¯ä»¥ç»™æ¯ä¸ªäº‹ä»¶**ç»‘å®šå¤„ç†å‡½æ•°**
- å°±åƒç»™ä¸åŒçš„é—¨é“ƒè®¾ç½®ä¸åŒçš„å“åº”åŠ¨ä½œä¸€æ ·

---

## 2. ğŸ¯ ä¸‰å¤§åŸºç¡€äº‹ä»¶è¯¦è§£


### 2.1 onopenäº‹ä»¶ï¼šè¿æ¥å»ºç«‹æˆåŠŸ


**ğŸ”¸ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
`onopen`äº‹ä»¶å°±åƒæ˜¯**æ¡æ‰‹æˆåŠŸçš„ä¿¡å·**ã€‚å½“ä½ çš„ç½‘é¡µæˆåŠŸè¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚

**ğŸ”¸ ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ**
```
å®¢æˆ·ç«¯: æˆ‘æƒ³è¿æ¥ä½ çš„æœåŠ¡å™¨
æœåŠ¡å™¨: å¥½çš„ï¼Œè¿æ¥å·²å»ºç«‹
å®¢æˆ·ç«¯: âœ… è§¦å‘onopenäº‹ä»¶ - "å¤ªå¥½äº†ï¼Œè¿ä¸Šäº†ï¼"
```

**ğŸ”¸ å®é™…ä»£ç ç¤ºä¾‹**
```javascript
// åˆ›å»ºSSEè¿æ¥
const eventSource = new EventSource('/api/events');

// ç›‘å¬è¿æ¥æˆåŠŸäº‹ä»¶
eventSource.onopen = function() {
    console.log('ğŸ‰ è¿æ¥å»ºç«‹æˆåŠŸï¼');
    // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›åˆå§‹åŒ–å·¥ä½œ
    document.getElementById('status').textContent = 'å·²è¿æ¥';
    document.getElementById('status').style.color = 'green';
};
```

**ğŸ”¸ å®é™…åº”ç”¨åœºæ™¯**
- æ˜¾ç¤º"è¿æ¥æˆåŠŸ"çš„æç¤ºä¿¡æ¯
- æ”¹å˜é¡µé¢çŠ¶æ€æŒ‡ç¤ºå™¨çš„é¢œè‰²
- å¼€å§‹æ˜¾ç¤ºåŠ è½½åŠ¨ç”»æˆ–è¿›åº¦æ¡
- åˆå§‹åŒ–ä¸€äº›éœ€è¦è¿æ¥åæ‰èƒ½è¿›è¡Œçš„æ“ä½œ

### 2.2 onmessageäº‹ä»¶ï¼šæ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯


**ğŸ”¸ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
`onmessage`äº‹ä»¶æ˜¯**æ¥æ”¶é‚®ä»¶çš„ä¿¡å·**ã€‚æ¯å½“æœåŠ¡å™¨ç»™ä½ å‘é€æ•°æ®æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè§¦å‘ã€‚

**ğŸ”¸ å·¥ä½œåŸç†å›¾è§£**
```
æœåŠ¡å™¨                    å®¢æˆ·ç«¯
   â”‚                        â”‚
   â”‚â”€â”€[æ¶ˆæ¯: Hello]â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ğŸ“¨ onmessageè§¦å‘
   â”‚                        â”‚   data = "Hello"
   â”‚â”€â”€[æ¶ˆæ¯: World]â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ğŸ“¨ onmessageè§¦å‘  
   â”‚                        â”‚   data = "World"
```

**ğŸ”¸ å®é™…ä»£ç ç¤ºä¾‹**
```javascript
// ç›‘å¬æœåŠ¡å™¨æ¶ˆæ¯
eventSource.onmessage = function(event) {
    console.log('ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯:', event.data);
    
    // å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
    const messageDiv = document.createElement('div');
    messageDiv.textContent = event.data;
    document.getElementById('messages').appendChild(messageDiv);
};
```

**ğŸ”¸ å¸¸è§åº”ç”¨åœºæ™¯**
- **èŠå¤©åº”ç”¨**ï¼šæ˜¾ç¤ºæ–°æ”¶åˆ°çš„æ¶ˆæ¯
- **è‚¡ç¥¨åº”ç”¨**ï¼šæ›´æ–°å®æ—¶ä»·æ ¼
- **è¿›åº¦æ¡**ï¼šæ›´æ–°ä»»åŠ¡å®Œæˆè¿›åº¦
- **é€šçŸ¥ç³»ç»Ÿ**ï¼šæ˜¾ç¤ºæ–°çš„é€šçŸ¥å†…å®¹

### 2.3 onerroräº‹ä»¶ï¼šå¤„ç†è¿æ¥é”™è¯¯


**ğŸ”¸ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
`onerror`äº‹ä»¶å°±åƒæ˜¯**è­¦æŠ¥å™¨**ã€‚å½“è¿æ¥å‡ºç°é—®é¢˜æ—¶ï¼Œå®ƒä¼šç«‹å³å“èµ·ï¼Œå‘Šè¯‰ä½ å‡ºäº†ä»€ä¹ˆçŠ¶å†µã€‚

**ğŸ”¸ ä»€ä¹ˆæƒ…å†µä¼šè§¦å‘ï¼Ÿ**
```
å¸¸è§è§¦å‘åœºæ™¯ï¼š
ğŸ”¸ æœåŠ¡å™¨å…³é—­äº† â†’ "æ‰¾ä¸åˆ°æœåŠ¡å™¨äº†"
ğŸ”¸ ç½‘ç»œæ–­äº† â†’ "ç½‘ç»œè¿æ¥ä¸­æ–­"  
ğŸ”¸ æœåŠ¡å™¨è¿”å›é”™è¯¯ â†’ "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
ğŸ”¸ URLåœ°å€é”™è¯¯ â†’ "æ‰¾ä¸åˆ°æŒ‡å®šçš„åœ°å€"
```

**ğŸ”¸ å®é™…ä»£ç ç¤ºä¾‹**
```javascript
// ç›‘å¬è¿æ¥é”™è¯¯
eventSource.onerror = function(event) {
    console.log('âŒ è¿æ¥å‡ºç°é”™è¯¯');
    
    // æ›´æ–°é¡µé¢çŠ¶æ€
    document.getElementById('status').textContent = 'è¿æ¥å¤±è´¥';
    document.getElementById('status').style.color = 'red';
    
    // å¯ä»¥å°è¯•é‡æ–°è¿æ¥æˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    setTimeout(() => {
        console.log('ğŸ”„ å°è¯•é‡æ–°è¿æ¥...');
        // è¿™é‡Œå¯ä»¥æ·»åŠ é‡è¿é€»è¾‘
    }, 5000);
};
```

**ğŸ”¸ å®é™…åº”ç”¨ä»·å€¼**
- **ç”¨æˆ·ä½“éªŒ**ï¼šåŠæ—¶å‘ŠçŸ¥ç”¨æˆ·è¿æ¥çŠ¶æ€
- **é”™è¯¯å¤„ç†**ï¼šè‡ªåŠ¨å°è¯•é‡æ–°è¿æ¥
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•é”™è¯¯ä¿¡æ¯ä¾¿äºè°ƒè¯•
- **é™çº§æ–¹æ¡ˆ**ï¼šåˆ‡æ¢åˆ°å…¶ä»–é€šä¿¡æ–¹å¼

---

## 3. ğŸ¨ è‡ªå®šä¹‰äº‹ä»¶å¤„ç†æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰äº‹ä»¶ï¼Ÿ


**ğŸ”¸ é€šä¿—ç†è§£**
å¦‚æœè¯´åŸºç¡€äº‹ä»¶æ˜¯**é»˜è®¤çš„é—¨é“ƒå£°**ï¼Œé‚£ä¹ˆè‡ªå®šä¹‰äº‹ä»¶å°±æ˜¯**ä½ å¯ä»¥è®¾ç½®çš„ç‰¹æ®Šé“ƒå£°**ã€‚

```
æ™®é€šé—¨é“ƒ: "å®å’š" â†’ æœ‰äººæ¥äº†
è‡ªå®šä¹‰é—¨é“ƒ: "ç”Ÿæ—¥å¿«ä¹æ­Œ" â†’ ç”Ÿæ—¥å®¢äººæ¥äº†
           "åœ£è¯æ­Œ" â†’ åœ£è¯å®¢äººæ¥äº†
           "å…¬å¸é“ƒå£°" â†’ å·¥ä½œç›¸å…³çš„äººæ¥äº†
```

### 3.2 addEventListener()æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬ç”¨æ³•**
```javascript
// ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ç±»å‹
eventSource.addEventListener('customEvent', function(event) {
    console.log('æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶:', event.data);
});
```

**ğŸ”¸ å®Œæ•´ç¤ºä¾‹ï¼šæ–°é—»æ¨é€ç³»ç»Ÿ**
```javascript
const newsStream = new EventSource('/api/news-stream');

// ç›‘å¬ä¸åŒç±»å‹çš„æ–°é—»
newsStream.addEventListener('breaking-news', function(event) {
    // å¤„ç†çªå‘æ–°é—» - ç”¨çº¢è‰²æ˜¾ç¤º
    showNews(event.data, 'urgent');
});

newsStream.addEventListener('sports-news', function(event) {
    // å¤„ç†ä½“è‚²æ–°é—» - ç”¨è“è‰²æ˜¾ç¤º  
    showNews(event.data, 'sports');
});

newsStream.addEventListener('weather-update', function(event) {
    // å¤„ç†å¤©æ°”æ›´æ–° - æ˜¾ç¤ºåœ¨å¤©æ°”åŒºåŸŸ
    updateWeather(event.data);
});

function showNews(content, type) {
    const newsDiv = document.createElement('div');
    newsDiv.className = type + '-news';
    newsDiv.textContent = content;
    document.getElementById('news-container').appendChild(newsDiv);
}
```

### 3.3 æœåŠ¡å™¨ç«¯å¦‚ä½•å‘é€è‡ªå®šä¹‰äº‹ä»¶


**ğŸ”¸ æœåŠ¡å™¨ç«¯æ ¼å¼ï¼ˆNode.jsç¤ºä¾‹ï¼‰**
```javascript
// æœåŠ¡å™¨å‘é€ä¸åŒç±»å‹çš„äº‹ä»¶
app.get('/api/news-stream', (req, res) => {
    res.writeHead(200, {
        'Content-Type': 'text/event-stream',
        'Cache-Control': 'no-cache'
    });
    
    // å‘é€çªå‘æ–°é—»
    res.write('event: breaking-news\n');
    res.write('data: é‡å¤§æ–°é—»ï¼šæŸæŸäº‹ä»¶å‘ç”Ÿ\n\n');
    
    // å‘é€ä½“è‚²æ–°é—»  
    res.write('event: sports-news\n');
    res.write('data: ç¯®çƒæ¯”èµ›ç»“æœï¼šAé˜Ÿè·èƒœ\n\n');
});
```

**ğŸ”¸ ç†è§£è¦ç‚¹**
- `event: äº‹ä»¶åç§°`ï¼šå‘Šè¯‰å®¢æˆ·ç«¯è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„äº‹ä»¶
- `data: æ¶ˆæ¯å†…å®¹`ï¼šå®é™…è¦ä¼ é€çš„æ•°æ®
- ä¸¤ä¸ªæ¢è¡Œç¬¦`\n\n`ï¼šè¡¨ç¤ºä¸€æ¡æ¶ˆæ¯ç»“æŸ

---

## 4. ğŸ“Š äº‹ä»¶å¯¹è±¡å±æ€§æ·±å…¥


### 4.1 dataå±æ€§ï¼šæ¶ˆæ¯å†…å®¹


**ğŸ”¸ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
`data`å±æ€§å°±åƒæ˜¯**ä¿¡å°é‡Œçš„ä¿¡ä»¶å†…å®¹**ï¼ŒåŒ…å«äº†æœåŠ¡å™¨å®é™…æƒ³å‘Šè¯‰ä½ çš„ä¿¡æ¯ã€‚

```javascript
eventSource.onmessage = function(event) {
    // event.data å°±æ˜¯æœåŠ¡å™¨å‘é€çš„å®é™…å†…å®¹
    console.log('æ¶ˆæ¯å†…å®¹:', event.data);
    
    // å¯èƒ½æ˜¯ç®€å•æ–‡æœ¬
    if (event.data === 'Hello') {
        console.log('æ”¶åˆ°é—®å€™');
    }
    
    // ä¹Ÿå¯èƒ½æ˜¯JSONæ•°æ®
    try {
        const jsonData = JSON.parse(event.data);
        console.log('ç”¨æˆ·å:', jsonData.username);
        console.log('æ¶ˆæ¯:', jsonData.message);
    } catch (e) {
        // ä¸æ˜¯JSONæ ¼å¼çš„æ•°æ®
    }
};
```

### 4.2 lastEventIdå±æ€§ï¼šæ¶ˆæ¯ç¼–å·


**ğŸ”¸ é€šä¿—ç†è§£**
`lastEventId`å°±åƒæ˜¯**å¿«é€’å•å·**ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œæ–¹ä¾¿è¿½è¸ªå’Œæ–­çº¿é‡è¿ã€‚

```javascript
eventSource.onmessage = function(event) {
    console.log('æ¶ˆæ¯ç¼–å·:', event.lastEventId);
    console.log('æ¶ˆæ¯å†…å®¹:', event.data);
    
    // å¯ä»¥ä¿å­˜æœ€åæ”¶åˆ°çš„æ¶ˆæ¯ID
    localStorage.setItem('lastEventId', event.lastEventId);
};
```

**ğŸ”¸ å®é™…åº”ç”¨åœºæ™¯**
```
æ–­çº¿é‡è¿åœºæ™¯ï¼š
1. å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯IDä¸º100çš„æ¶ˆæ¯
2. ç½‘ç»œçªç„¶æ–­å¼€
3. é‡æ–°è¿æ¥æ—¶ï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼š"æˆ‘æœ€åæ”¶åˆ°çš„æ˜¯100å·æ¶ˆæ¯"
4. æœåŠ¡å™¨ä»101å·æ¶ˆæ¯å¼€å§‹é‡æ–°å‘é€
5. ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯
```

### 4.3 typeå±æ€§ï¼šäº‹ä»¶ç±»å‹


**ğŸ”¸ è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
`type`å±æ€§å‘Šè¯‰ä½ **è¿™æ˜¯å“ªç§ç±»å‹çš„äº‹ä»¶**ï¼Œå°±åƒä¿¡å°ä¸Šçš„æ ‡ç­¾ä¸€æ ·ã€‚

```javascript
eventSource.addEventListener('user-message', function(event) {
    console.log('äº‹ä»¶ç±»å‹:', event.type);        // "user-message"
    console.log('æ¶ˆæ¯å†…å®¹:', event.data);
});

eventSource.addEventListener('system-alert', function(event) {
    console.log('äº‹ä»¶ç±»å‹:', event.type);        // "system-alert"  
    console.log('è­¦æŠ¥å†…å®¹:', event.data);
});
```

### 4.4 å±æ€§ä½¿ç”¨ç»¼åˆç¤ºä¾‹


```javascript
const chatStream = new EventSource('/api/chat-stream');

chatStream.addEventListener('chat-message', function(event) {
    // è§£ææ¶ˆæ¯æ•°æ®
    const messageData = JSON.parse(event.data);
    
    console.log('ğŸ“¨ äº‹ä»¶è¯¦æƒ…:');
    console.log('  ç±»å‹:', event.type);              // "chat-message"
    console.log('  ID:', event.lastEventId);         // "msg-12345"
    console.log('  å†…å®¹:', messageData.text);        // "Hello everyone!"
    console.log('  å‘é€è€…:', messageData.sender);    // "å¼ ä¸‰"
    
    // æ˜¾ç¤ºæ¶ˆæ¯
    displayChatMessage(messageData);
    
    // ä¿å­˜æ¶ˆæ¯IDç”¨äºé‡è¿
    sessionStorage.setItem('lastChatId', event.lastEventId);
});
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯æ¼”ç¤º


### 5.1 å®æ—¶èŠå¤©å®¤å®Œæ•´ç¤ºä¾‹


```javascript
// åˆ›å»ºèŠå¤©å®¤è¿æ¥
const chatSSE = new EventSource('/api/chatroom');

// è¿æ¥æˆåŠŸ
chatSSE.onopen = function() {
    document.getElementById('status').textContent = 'âœ… å·²è¿æ¥åˆ°èŠå¤©å®¤';
    document.getElementById('chatInput').disabled = false;
};

// æ¥æ”¶èŠå¤©æ¶ˆæ¯
chatSSE.addEventListener('new-message', function(event) {
    const message = JSON.parse(event.data);
    addMessageToChat(message.user, message.text, message.timestamp);
});

// æœ‰ç”¨æˆ·åŠ å…¥
chatSSE.addEventListener('user-joined', function(event) {
    const data = JSON.parse(event.data);
    showSystemMessage(`${data.username} åŠ å…¥äº†èŠå¤©å®¤`);
});

// æœ‰ç”¨æˆ·ç¦»å¼€  
chatSSE.addEventListener('user-left', function(event) {
    const data = JSON.parse(event.data);
    showSystemMessage(`${data.username} ç¦»å¼€äº†èŠå¤©å®¤`);
});

// è¿æ¥é”™è¯¯
chatSSE.onerror = function() {
    document.getElementById('status').textContent = 'âŒ è¿æ¥ä¸­æ–­ï¼Œå°è¯•é‡è¿...';
    document.getElementById('chatInput').disabled = true;
};

// è¾…åŠ©å‡½æ•°
function addMessageToChat(user, text, timestamp) {
    const chatBox = document.getElementById('chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.innerHTML = `
        <strong>${user}</strong>: ${text}
        <small>(${new Date(timestamp).toLocaleTimeString()})</small>
    `;
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}
```

### 5.2 å®æ—¶è¿›åº¦æ›´æ–°ç¤ºä¾‹


```javascript
// æ–‡ä»¶ä¸Šä¼ è¿›åº¦ç›‘æ§
const uploadSSE = new EventSource('/api/upload-progress');

uploadSSE.addEventListener('progress-update', function(event) {
    const progress = JSON.parse(event.data);
    
    // æ›´æ–°è¿›åº¦æ¡
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    
    progressBar.style.width = progress.percentage + '%';
    progressText.textContent = `${progress.percentage}% (${progress.completed}/${progress.total})`;
});

uploadSSE.addEventListener('upload-complete', function(event) {
    const result = JSON.parse(event.data);
    
    document.getElementById('progress-text').textContent = 'âœ… ä¸Šä¼ å®Œæˆï¼';
    document.getElementById('download-link').href = result.fileUrl;
    document.getElementById('download-link').style.display = 'block';
    
    // å…³é—­SSEè¿æ¥
    uploadSSE.close();
});

uploadSSE.addEventListener('upload-error', function(event) {
    const error = JSON.parse(event.data);
    document.getElementById('progress-text').textContent = `âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`;
});
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ä¸‰å¤§åŸºç¡€äº‹ä»¶ï¼š
  â€¢ onopen - è¿æ¥å»ºç«‹æˆåŠŸçš„ä¿¡å·
  â€¢ onmessage - æ¥æ”¶æ¶ˆæ¯çš„ä¸»è¦é€”å¾„  
  â€¢ onerror - é”™è¯¯å¤„ç†çš„å…³é”®æœºåˆ¶

ğŸ”¸ è‡ªå®šä¹‰äº‹ä»¶æœºåˆ¶ï¼š
  â€¢ addEventListener() - ç›‘å¬ç‰¹å®šç±»å‹äº‹ä»¶
  â€¢ äº‹ä»¶ç±»å‹ç”±æœåŠ¡å™¨ç«¯æŒ‡å®š
  â€¢ å¯ä»¥åŒæ—¶ç›‘å¬å¤šç§ä¸åŒç±»å‹äº‹ä»¶

ğŸ”¸ äº‹ä»¶å¯¹è±¡ä¸‰å¤§å±æ€§ï¼š
  â€¢ data - å®é™…çš„æ¶ˆæ¯å†…å®¹
  â€¢ lastEventId - æ¶ˆæ¯çš„å”¯ä¸€ç¼–å·
  â€¢ type - äº‹ä»¶çš„å…·ä½“ç±»å‹
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‹ä»¶ç›‘å¬çš„æœ¬è´¨**
```
SSEäº‹ä»¶ç›‘å¬ = ç»™ç½‘é¡µè£…ä¸Šä¸åŒçš„"ä¼ æ„Ÿå™¨"
â€¢ onopenä¼ æ„Ÿå™¨ - æ£€æµ‹è¿æ¥çŠ¶æ€
â€¢ onmessageä¼ æ„Ÿå™¨ - æ¥æ”¶æ•°æ®ä¿¡å·
â€¢ onerrorä¼ æ„Ÿå™¨ - ç›‘æµ‹å¼‚å¸¸æƒ…å†µ
â€¢ è‡ªå®šä¹‰ä¼ æ„Ÿå™¨ - å¤„ç†ç‰¹å®šç±»å‹ä¿¡æ¯
```

**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦ä¸åŒçš„äº‹ä»¶ç±»å‹ï¼Ÿ**
```
å°±åƒé‚®ä»¶åˆ†ç±»ä¸€æ ·ï¼š
ğŸ“§ æ™®é€šé‚®ä»¶ â†’ onmessageå¤„ç†
ğŸš¨ ç´§æ€¥é€šçŸ¥ â†’ è‡ªå®šä¹‰urgentäº‹ä»¶å¤„ç†  
ğŸ“Š æ•°æ®æŠ¥è¡¨ â†’ è‡ªå®šä¹‰reportäº‹ä»¶å¤„ç†
ğŸ’¬ èŠå¤©æ¶ˆæ¯ â†’ è‡ªå®šä¹‰chatäº‹ä»¶å¤„ç†

ä¸åŒç±»å‹çš„ä¿¡æ¯éœ€è¦ä¸åŒçš„å¤„ç†æ–¹å¼ï¼
```

**ğŸ”¹ äº‹ä»¶å¯¹è±¡å±æ€§çš„ä½œç”¨**
```
dataå±æ€§ â†’ å‘Šè¯‰ä½ "æ¶ˆæ¯å†…å®¹æ˜¯ä»€ä¹ˆ"
typeå±æ€§ â†’ å‘Šè¯‰ä½ "è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯" 
lastEventIdå±æ€§ â†’ å‘Šè¯‰ä½ "è¿™æ˜¯ç¬¬å‡ æ¡æ¶ˆæ¯"

ä¸‰ä¸ªå±æ€§é…åˆä½¿ç”¨ï¼Œè®©ä½ å®Œæ•´äº†è§£æ¯ä¸€æ¡æ¶ˆæ¯ï¼
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **å®æ—¶é€šä¿¡**ï¼šèŠå¤©å®¤ã€å®¢æœç³»ç»Ÿã€å›¢é˜Ÿåä½œ
- **çŠ¶æ€ç›‘æ§**ï¼šè¿›åº¦æ¡ã€ä»»åŠ¡çŠ¶æ€ã€ç³»ç»Ÿç›‘æ§
- **æ•°æ®æ¨é€**ï¼šè‚¡ç¥¨ä»·æ ¼ã€æ–°é—»æ›´æ–°ã€é€šçŸ¥æ¨é€
- **ç”¨æˆ·ä½“éªŒ**ï¼šå®æ—¶åé¦ˆã€çŠ¶æ€æç¤ºã€é”™è¯¯å¤„ç†

**ğŸ”§ å¼€å‘å®è·µæŠ€å·§**
- æ€»æ˜¯è¦å¤„ç†`onerror`äº‹ä»¶ï¼Œæä¾›è‰¯å¥½çš„é”™è¯¯ä½“éªŒ
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ä½¿ç”¨åŸºç¡€äº‹ä»¶è¿˜æ˜¯è‡ªå®šä¹‰äº‹ä»¶
- åˆ©ç”¨`lastEventId`å®ç°æ–­çº¿é‡è¿åŠŸèƒ½
- åˆç†è§£æ`data`å±æ€§ä¸­çš„JSONæ•°æ®

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- SSEå®¢æˆ·ç«¯äº‹ä»¶å¤„ç†æ˜¯å®ç°å®æ—¶é€šä¿¡çš„å…³é”®æŠ€æœ¯
- ä¸‰å¤§åŸºç¡€äº‹ä»¶è¦†ç›–äº†è¿æ¥çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- è‡ªå®šä¹‰äº‹ä»¶è®©ä½ èƒ½å¤Ÿç²¾ç¡®å¤„ç†ä¸åŒç±»å‹çš„æ¶ˆæ¯
- äº‹ä»¶å¯¹è±¡å±æ€§æä¾›äº†å¤„ç†æ¶ˆæ¯æ‰€éœ€çš„å®Œæ•´ä¿¡æ¯