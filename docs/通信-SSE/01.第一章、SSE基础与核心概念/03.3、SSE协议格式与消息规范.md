---
title: 3ã€SSEåè®®æ ¼å¼ä¸æ¶ˆæ¯è§„èŒƒ
---
## ğŸ“š ç›®å½•

1. [SSEæ¶ˆæ¯æ ¼å¼åŸºæœ¬æ¦‚å¿µ](#1-SSEæ¶ˆæ¯æ ¼å¼åŸºæœ¬æ¦‚å¿µ)
2. [å››å¤§æ ¸å¿ƒå­—æ®µè¯¦è§£](#2-å››å¤§æ ¸å¿ƒå­—æ®µè¯¦è§£)
3. [æ•°æ®åˆå¹¶è§„åˆ™ä¸å®è·µ](#3-æ•°æ®åˆå¹¶è§„åˆ™ä¸å®è·µ)
4. [è‡ªå®šä¹‰äº‹ä»¶æœºåˆ¶](#4-è‡ªå®šä¹‰äº‹ä»¶æœºåˆ¶)
5. [æ–­çº¿ç»­ä¼ ä¸é‡è¿æœºåˆ¶](#5-æ–­çº¿ç»­ä¼ ä¸é‡è¿æœºåˆ¶)
6. [æ¶ˆæ¯æ ¼å¼æœ€ä½³å®è·µ](#6-æ¶ˆæ¯æ ¼å¼æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ SSEæ¶ˆæ¯æ ¼å¼åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SSEæ¶ˆæ¯æ ¼å¼

**ç®€å•ç†è§£**ï¼šSSEæ¶ˆæ¯å°±åƒå‘çŸ­ä¿¡ä¸€æ ·ï¼Œéœ€è¦éµå¾ªç‰¹å®šçš„"çŸ­ä¿¡æ ¼å¼"ï¼Œè¿™æ ·æµè§ˆå™¨æ‰èƒ½æ­£ç¡®ç†è§£æœåŠ¡å™¨å‘æ¥çš„å†…å®¹ã€‚

```
æƒ³è±¡ä¸€ä¸‹å‘çŸ­ä¿¡ï¼š
æ™®é€šçŸ­ä¿¡ï¼šä½ å¥½ï¼
SSEæ¶ˆæ¯ï¼šdata: ä½ å¥½ï¼

æ¯æ¡æ¶ˆæ¯éƒ½è¦æŒ‰è§„å®šæ ¼å¼å†™ï¼Œæµè§ˆå™¨æ‰è®¤è¯†
```

### 1.2 åŸºæœ¬æ ¼å¼è§„åˆ™

**æ ¸å¿ƒè§„åˆ™**ï¼š
- ğŸ“ æ¯è¡Œä¸€ä¸ªå­—æ®µï¼Œæ ¼å¼æ˜¯ `å­—æ®µå: å€¼`
- ğŸ”š æ¯æ¡å®Œæ•´æ¶ˆæ¯ç”¨ä¸¤ä¸ªæ¢è¡Œç¬¦ `\n\n` ç»“å°¾
- ğŸ’¬ ä»¥ `:` å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šï¼Œæµè§ˆå™¨ä¼šå¿½ç•¥

```
åŸºæœ¬æ¶ˆæ¯ç¤ºä¾‹ï¼š
data: Hello World

ï¼ˆæ³¨æ„ï¼šè¿™é‡Œæœ‰ä¸¤ä¸ªæ¢è¡Œç¬¦ç»“å°¾ï¼‰
```

### 1.3 æ¶ˆæ¯ä¼ è¾“æµç¨‹å›¾


```
æœåŠ¡å™¨                     æµè§ˆå™¨
   |                         |
   |--data: æ¶ˆæ¯å†…å®¹--------->|
   |--                    -->| (ä¸¤ä¸ªæ¢è¡Œç¬¦)
   |                         | æµè§ˆå™¨æ”¶åˆ°å®Œæ•´æ¶ˆæ¯
   |                         | è§¦å‘ message äº‹ä»¶
   |                         |
   |--data: ç¬¬äºŒæ¡æ¶ˆæ¯------>|
   |--                    -->|
   |                         | å†æ¬¡è§¦å‘ message äº‹ä»¶
```

---

## 2. ğŸ”§ å››å¤§æ ¸å¿ƒå­—æ®µè¯¦è§£


### 2.1 dataå­—æ®µ - æ¶ˆæ¯å†…å®¹


**ä½œç”¨**ï¼šä¼ é€’å®é™…çš„æ•°æ®å†…å®¹ï¼Œç›¸å½“äºçŸ­ä¿¡çš„æ­£æ–‡éƒ¨åˆ†

```javascript
// æœåŠ¡å™¨å‘é€
data: ä»Šå¤©å¤©æ°”ä¸é”™

// æµè§ˆå™¨æ¥æ”¶
eventSource.onmessage = function(event) {
  console.log(event.data); // "ä»Šå¤©å¤©æ°”ä¸é”™"
};
```

**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
- `data` å°±æ˜¯ä½ è¦å‘é€çš„å®é™…å†…å®¹
- å¯ä»¥æ˜¯æ–‡å­—ã€æ•°å­—ã€JSONç­‰ä»»ä½•æ•°æ®
- æµè§ˆå™¨æ”¶åˆ°åä¼šæ”¾åœ¨ `event.data` é‡Œ

### 2.2 eventå­—æ®µ - äº‹ä»¶ç±»å‹


**ä½œç”¨**ï¼šç»™æ¶ˆæ¯èµ·ä¸ª"åå­—"ï¼Œè®©æµè§ˆå™¨çŸ¥é“è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„æ¶ˆæ¯

```javascript
// æœåŠ¡å™¨å‘é€
event: userLogin
data: å¼ ä¸‰ç™»å½•äº†

// æµè§ˆå™¨æ¥æ”¶
eventSource.addEventListener('userLogin', function(event) {
  console.log('æœ‰ç”¨æˆ·ç™»å½•ï¼š', event.data); // "å¼ ä¸‰ç™»å½•äº†"
});
```

**ğŸ¯ å®é™…æ•ˆæœå¯¹æ¯”**ï¼š
```
ä¸å¸¦eventå­—æ®µï¼š
data: å¼ ä¸‰ç™»å½•äº†
â†“
è§¦å‘é»˜è®¤çš„ message äº‹ä»¶

å¸¦eventå­—æ®µï¼š
event: userLogin  
data: å¼ ä¸‰ç™»å½•äº†
â†“
è§¦å‘è‡ªå®šä¹‰çš„ userLogin äº‹ä»¶
```

### 2.3 idå­—æ®µ - æ¶ˆæ¯æ ‡è¯†


**ä½œç”¨**ï¼šç»™æ¯æ¡æ¶ˆæ¯ä¸€ä¸ªå”¯ä¸€"èº«ä»½è¯å·"ï¼Œæ”¯æŒæ–­çº¿é‡è¿åŠŸèƒ½

```javascript
// æœåŠ¡å™¨å‘é€
id: msg-001
data: ç¬¬ä¸€æ¡æ¶ˆæ¯

id: msg-002  
data: ç¬¬äºŒæ¡æ¶ˆæ¯

// æµè§ˆå™¨è®°ä½æœ€åæ”¶åˆ°çš„ID
// å¦‚æœæ–­çº¿é‡è¿ï¼Œä¼šå‘Šè¯‰æœåŠ¡å™¨ï¼šæˆ‘æœ€åæ”¶åˆ°msg-002
```

**ğŸ”„ æ–­çº¿ç»­ä¼ åŸç†**ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
æœåŠ¡å™¨ â†’ msg-001 â†’ æµè§ˆå™¨ âœ…
æœåŠ¡å™¨ â†’ msg-002 â†’ æµè§ˆå™¨ âœ…
æœåŠ¡å™¨ â†’ msg-003 â†’ æµè§ˆå™¨ âŒ (ç½‘ç»œæ–­å¼€)

é‡è¿æ—¶ï¼š
æµè§ˆå™¨å‘Šè¯‰æœåŠ¡å™¨ï¼š"æˆ‘æœ€åæ”¶åˆ°msg-002"
æœåŠ¡å™¨ä»msg-003å¼€å§‹é‡æ–°å‘é€
```

### 2.4 retryå­—æ®µ - é‡è¿é—´éš”


**ä½œç”¨**ï¼šå‘Šè¯‰æµè§ˆå™¨å¦‚æœæ–­çº¿äº†ï¼Œç­‰å¤šä¹…å†é‡è¿

```javascript
// æœåŠ¡å™¨å‘é€
retry: 5000
data: è®¾ç½®é‡è¿é—´éš”ä¸º5ç§’

// æµè§ˆå™¨æ”¶åˆ°åï¼š
// å¦‚æœè¿æ¥æ–­å¼€ï¼Œä¼šç­‰5ç§’å†é‡è¿
```

**â° é‡è¿æ—¶é—´è®¾ç½®å»ºè®®**ï¼š
```
å®æ—¶æ€§è¦æ±‚é«˜ï¼šretry: 1000  (1ç§’)
ä¸€èˆ¬åº”ç”¨ï¼š    retry: 5000  (5ç§’)  
ä½é¢‘æ›´æ–°ï¼š    retry: 30000 (30ç§’)
```

---

## 3. ğŸ“ æ•°æ®åˆå¹¶è§„åˆ™ä¸å®è·µ


### 3.1 å¤šè¡Œdataçš„åˆå¹¶æœºåˆ¶


**æ ¸å¿ƒè§„åˆ™**ï¼šå¤šä¸ª `data:` è¡Œä¼šè‡ªåŠ¨åˆå¹¶æˆä¸€æ¡æ¶ˆæ¯ï¼Œç”¨æ¢è¡Œç¬¦è¿æ¥

```javascript
// æœåŠ¡å™¨å‘é€
data: ç¬¬ä¸€è¡Œå†…å®¹
data: ç¬¬äºŒè¡Œå†…å®¹  
data: ç¬¬ä¸‰è¡Œå†…å®¹

// æµè§ˆå™¨æ¥æ”¶åˆ°çš„å®Œæ•´å†…å®¹ï¼š
// "ç¬¬ä¸€è¡Œå†…å®¹\nç¬¬äºŒè¡Œå†…å®¹\nç¬¬ä¸‰è¡Œå†…å®¹"
```

### 3.2 JSONæ•°æ®çš„å®Œç¾ä¼ è¾“


**å®é™…åº”ç”¨åœºæ™¯**ï¼šå‘é€å¤æ‚çš„JSONå¯¹è±¡

```javascript
// æœåŠ¡å™¨ç«¯ä»£ç 
const userData = {
  name: "å¼ ä¸‰",
  age: 25,
  skills: ["JavaScript", "Vue", "Node.js"]
};

// æ–¹æ³•ä¸€ï¼šä¸€è¡Œå‘é€ï¼ˆç®€å•ï¼‰
res.write(`data: ${JSON.stringify(userData)}\n\n`);

// æ–¹æ³•äºŒï¼šå¤šè¡Œå‘é€ï¼ˆä¾¿äºé˜…è¯»ï¼‰
res.write(`data: {\n`);
res.write(`data:   "name": "å¼ ä¸‰",\n`);
res.write(`data:   "age": 25,\n`);
res.write(`data:   "skills": ["JavaScript", "Vue", "Node.js"]\n`);
res.write(`data: }\n\n`);

// æµè§ˆå™¨ç«¯æ¥æ”¶
eventSource.onmessage = function(event) {
  const user = JSON.parse(event.data);
  console.log('ç”¨æˆ·ä¿¡æ¯ï¼š', user.name); // "å¼ ä¸‰"
};
```

### 3.3 åˆå¹¶è§„åˆ™è¯¦ç»†è¯´æ˜


```
æœåŠ¡å™¨å‘é€çš„åŸå§‹æ•°æ®ï¼š
data: å§“åï¼šå¼ ä¸‰
data: å¹´é¾„ï¼š25å²
data: åŸå¸‚ï¼šåŒ—äº¬

æµè§ˆå™¨æ¥æ”¶åˆ°çš„åˆå¹¶ç»“æœï¼š
event.data = "å§“åï¼šå¼ ä¸‰\nå¹´é¾„ï¼š25å²\nåŸå¸‚ï¼šåŒ—äº¬"

å¤„ç†æ–¹å¼ï¼š
const lines = event.data.split('\n');
console.log(lines[0]); // "å§“åï¼šå¼ ä¸‰" 
console.log(lines[1]); // "å¹´é¾„ï¼š25å²"
console.log(lines[2]); // "åŸå¸‚ï¼šåŒ—äº¬"
```

---

## 4. ğŸ¨ è‡ªå®šä¹‰äº‹ä»¶æœºåˆ¶


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰äº‹ä»¶


**é—®é¢˜åœºæ™¯**ï¼š
```
èŠå¤©å®¤åº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦å‘é€ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼š
- ç”¨æˆ·åŠ å…¥èŠå¤©å®¤
- ç”¨æˆ·å‘é€æ¶ˆæ¯  
- ç”¨æˆ·ç¦»å¼€èŠå¤©å®¤
- ç³»ç»Ÿé€šçŸ¥

å¦‚æœéƒ½ç”¨é»˜è®¤çš„messageäº‹ä»¶ï¼Œæ€ä¹ˆåŒºåˆ†è¿™äº›ä¸åŒç±»å‹ï¼Ÿ
```

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ç±»å‹

### 4.2 è‡ªå®šä¹‰äº‹ä»¶çš„å®šä¹‰ä¸è§¦å‘


```javascript
// æœåŠ¡å™¨ç«¯ï¼šå‘é€ä¸åŒç±»å‹çš„äº‹ä»¶
function sendUserJoin(res, username) {
  res.write(`event: userJoin\n`);
  res.write(`data: ${username}åŠ å…¥äº†èŠå¤©å®¤\n\n`);
}

function sendChatMessage(res, username, message) {
  res.write(`event: chatMessage\n`);
  res.write(`data: ${JSON.stringify({user: username, msg: message})}\n\n`);
}

function sendUserLeave(res, username) {
  res.write(`event: userLeave\n`);
  res.write(`data: ${username}ç¦»å¼€äº†èŠå¤©å®¤\n\n`);
}
```

### 4.3 å®¢æˆ·ç«¯ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶


```javascript
const eventSource = new EventSource('/chat-stream');

// ç›‘å¬ç”¨æˆ·åŠ å…¥äº‹ä»¶
eventSource.addEventListener('userJoin', function(event) {
  console.log('ğŸ‰ æ–°ç”¨æˆ·ï¼š', event.data);
  showNotification(event.data, 'success');
});

// ç›‘å¬èŠå¤©æ¶ˆæ¯äº‹ä»¶  
eventSource.addEventListener('chatMessage', function(event) {
  const data = JSON.parse(event.data);
  console.log(`ğŸ’¬ ${data.user}ï¼š${data.msg}`);
  displayMessage(data.user, data.msg);
});

// ç›‘å¬ç”¨æˆ·ç¦»å¼€äº‹ä»¶
eventSource.addEventListener('userLeave', function(event) {
  console.log('ğŸ‘‹ ç”¨æˆ·ç¦»å¼€ï¼š', event.data);
  showNotification(event.data, 'info');
});

// è¿˜å¯ä»¥ç›‘å¬é»˜è®¤çš„messageäº‹ä»¶ï¼ˆç³»ç»Ÿé€šçŸ¥ï¼‰
eventSource.onmessage = function(event) {
  console.log('ğŸ“¢ ç³»ç»Ÿé€šçŸ¥ï¼š', event.data);
  showSystemNotice(event.data);
};
```

### 4.4 è‡ªå®šä¹‰äº‹ä»¶çš„æœ€ä½³å®è·µ


| ğŸ¯ äº‹ä»¶ç±»å‹ | **ç”¨é€”** | **ç¤ºä¾‹** |
|------------|---------|---------|
| `userJoin` | ç”¨æˆ·åŠ å…¥ | `event: userJoin\ndata: å¼ ä¸‰åŠ å…¥èŠå¤©å®¤` |
| `userLeave` | ç”¨æˆ·ç¦»å¼€ | `event: userLeave\ndata: æå››ç¦»å¼€èŠå¤©å®¤` |  
| `chatMessage` | èŠå¤©æ¶ˆæ¯ | `event: chatMessage\ndata: {"user":"ç‹äº”","msg":"å¤§å®¶å¥½"}` |
| `systemNotice` | ç³»ç»Ÿé€šçŸ¥ | `event: systemNotice\ndata: æœåŠ¡å™¨å°†åœ¨10åˆ†é’Ÿåç»´æŠ¤` |

---

## 5. ğŸ”„ æ–­çº¿ç»­ä¼ ä¸é‡è¿æœºåˆ¶


### 5.1 æ–­çº¿ç»­ä¼ çš„å·¥ä½œåŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šå°±åƒçœ‹ç”µè§†å‰§ä¸€æ ·ï¼Œå¦‚æœä¸­é€”æ–­äº†ï¼Œé‡æ–°æ‰“å¼€æ—¶åº”è¯¥ä»æ–­å¼€çš„åœ°æ–¹ç»§ç»­çœ‹

```
æ—¶é—´è½´æ¼”ç¤ºï¼š
10:00 - æœåŠ¡å™¨å‘é€ id: 001, data: æ¶ˆæ¯1  âœ… æµè§ˆå™¨æ”¶åˆ°
10:01 - æœåŠ¡å™¨å‘é€ id: 002, data: æ¶ˆæ¯2  âœ… æµè§ˆå™¨æ”¶åˆ°
10:02 - æœåŠ¡å™¨å‘é€ id: 003, data: æ¶ˆæ¯3  âŒ ç½‘ç»œä¸­æ–­
10:03 - æœåŠ¡å™¨å‘é€ id: 004, data: æ¶ˆæ¯4  âŒ ç½‘ç»œä¸­æ–­

10:05 - ç½‘ç»œæ¢å¤ï¼Œæµè§ˆå™¨é‡è¿
        æµè§ˆå™¨å‘Šè¯‰æœåŠ¡å™¨ï¼š"æˆ‘æœ€åæ”¶åˆ°çš„æ˜¯002"
        æœåŠ¡å™¨ä»003å¼€å§‹é‡æ–°å‘é€
```

### 5.2 æœåŠ¡ç«¯å®ç°æ–­çº¿ç»­ä¼ 


```javascript
// æœåŠ¡å™¨ç«¯å®ç°
let messageHistory = []; // ä¿å­˜å†å²æ¶ˆæ¯
let currentMessageId = 0;

function handleSSEConnection(req, res) {
  // è·å–å®¢æˆ·ç«¯æœ€åæ”¶åˆ°çš„æ¶ˆæ¯ID
  const lastEventId = req.headers['last-event-id'] || '0';
  const startId = parseInt(lastEventId) + 1;
  
  console.log(`å®¢æˆ·ç«¯æœ€åæ”¶åˆ°æ¶ˆæ¯ID: ${lastEventId}`);
  console.log(`ä»æ¶ˆæ¯ID ${startId} å¼€å§‹å‘é€`);
  
  // å‘é€å†å²æ¶ˆæ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
  for (let i = startId; i <= currentMessageId; i++) {
    const message = messageHistory.find(msg => msg.id === i);
    if (message) {
      res.write(`id: ${message.id}\n`);
      res.write(`data: ${message.content}\n\n`);
    }
  }
  
  // ç»§ç»­å‘é€æ–°æ¶ˆæ¯...
}

function broadcastMessage(content) {
  currentMessageId++;
  const message = {
    id: currentMessageId,
    content: content,
    timestamp: Date.now()
  };
  
  messageHistory.push(message);
  
  // å‘é€ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯
  res.write(`id: ${message.id}\n`);
  res.write(`data: ${message.content}\n\n`);
}
```

### 5.3 æµè§ˆå™¨ç«¯è‡ªåŠ¨é‡è¿å¤„ç†


```javascript
const eventSource = new EventSource('/sse-stream');

eventSource.onopen = function() {
  console.log('âœ… SSEè¿æ¥å·²å»ºç«‹');
};

eventSource.onerror = function() {
  console.log('âŒ SSEè¿æ¥å‡ºé”™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡è¿...');
};

eventSource.onmessage = function(event) {
  console.log('ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯ï¼š', event.data);
  
  // æµè§ˆå™¨ä¼šè‡ªåŠ¨è®°ä½æœ€åæ”¶åˆ°çš„æ¶ˆæ¯ID
  // é‡è¿æ—¶ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­åŒ…å« last-event-id
};
```

### 5.4 é‡è¿é—´éš”æ§åˆ¶


```javascript
// æœåŠ¡å™¨è®¾ç½®é‡è¿é—´éš”
function setRetryInterval(res, seconds) {
  res.write(`retry: ${seconds * 1000}\n`); // å•ä½æ˜¯æ¯«ç§’
  res.write(`data: é‡è¿é—´éš”è®¾ç½®ä¸º${seconds}ç§’\n\n`);
}

// å®é™…åº”ç”¨ä¸­çš„å»ºè®®
setRetryInterval(res, 5); // æ­£å¸¸æƒ…å†µä¸‹5ç§’é‡è¿

// æœåŠ¡å™¨è´Ÿè½½é«˜æ—¶
setRetryInterval(res, 30); // å¢åŠ åˆ°30ç§’å‡è½»å‹åŠ›

// ç´§æ€¥æƒ…å†µéœ€è¦å¿«é€Ÿé‡è¿
setRetryInterval(res, 1); // 1ç§’å¿«é€Ÿé‡è¿
```

---

## 6. âœ¨ æ¶ˆæ¯æ ¼å¼æœ€ä½³å®è·µ


### 6.1 æ³¨é‡Šçš„å¦™ç”¨


**ä½œç”¨**ï¼šåœ¨æ¶ˆæ¯æµä¸­æ·»åŠ è¯´æ˜ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•

```javascript
// æœåŠ¡å™¨å‘é€å¸¦æ³¨é‡Šçš„æ¶ˆæ¯
res.write(`: è¿™æ˜¯ä¸€æ¡æ³¨é‡Šï¼Œæµè§ˆå™¨ä¼šå¿½ç•¥\n`);
res.write(`: å½“å‰æ—¶é—´ ${new Date()}\n`);
res.write(`data: å®é™…çš„æ¶ˆæ¯å†…å®¹\n\n`);

// è°ƒè¯•æ—¶çš„å®é™…åº”ç”¨
res.write(`: === å¼€å§‹å‘é€ç”¨æˆ·åˆ—è¡¨ ===\n`);
res.write(`event: userList\n`);
res.write(`data: ${JSON.stringify(users)}\n\n`);
res.write(`: === ç”¨æˆ·åˆ—è¡¨å‘é€å®Œæˆ ===\n`);
```

### 6.2 å®Œæ•´æ¶ˆæ¯ç¤ºä¾‹


```javascript
// ä¸€ä¸ªå®Œæ•´çš„SSEæ¶ˆæ¯æ ¼å¼ç¤ºä¾‹
function sendCompleteMessage(res) {
  res.write(`: å‘é€æ—¶é—´ ${new Date().toISOString()}\n`);
  res.write(`id: msg-${Date.now()}\n`);
  res.write(`event: stockPrice\n`);
  res.write(`retry: 10000\n`);
  res.write(`data: {\n`);
  res.write(`data:   "symbol": "AAPL",\n`);
  res.write(`data:   "price": 150.25,\n`);
  res.write(`data:   "change": +2.15\n`);
  res.write(`data: }\n\n`);
}
```

### 6.3 é”™è¯¯å¤„ç†ä¸å®¹é”™æœºåˆ¶


```javascript
// æœåŠ¡å™¨ç«¯å®¹é”™å¤„ç†
function safeSSEWrite(res, data) {
  try {
    if (res.writableEnded) {
      console.log('è¿æ¥å·²å…³é—­ï¼Œåœæ­¢å‘é€');
      return false;
    }
    
    res.write(data);
    return true;
  } catch (error) {
    console.log('å‘é€å¤±è´¥ï¼š', error.message);
    return false;
  }
}

// å®¢æˆ·ç«¯é”™è¯¯å¤„ç†
const eventSource = new EventSource('/sse-stream');

eventSource.onerror = function(error) {
  console.log('è¿æ¥å‡ºé”™ï¼š', error);
  
  // å¯ä»¥æ ¹æ®é”™è¯¯çŠ¶æ€å†³å®šæ˜¯å¦æ‰‹åŠ¨é‡è¿
  if (eventSource.readyState === EventSource.CLOSED) {
    console.log('è¿æ¥å·²å…³é—­ï¼Œä¸ä¼šè‡ªåŠ¨é‡è¿');
  } else {
    console.log('è¿æ¥ä¸­æ–­ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é‡è¿');
  }
};
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å››å¤§å­—æ®µå¿«é€Ÿè®°å¿†


```
ğŸ”¸ data: æ¶ˆæ¯å†…å®¹ - "è¦è¯´ä»€ä¹ˆ"
ğŸ”¸ event: äº‹ä»¶ç±»å‹ - "æ¶ˆæ¯çš„åå­—" 
ğŸ”¸ id: æ¶ˆæ¯æ ‡è¯† - "æ¶ˆæ¯çš„èº«ä»½è¯"
ğŸ”¸ retry: é‡è¿é—´éš” - "æ–­çº¿åå¤šä¹…é‡è¿"
```

### 7.2 æ¶ˆæ¯æ ¼å¼è§„åˆ™å£è¯€


> ğŸ’¡ **è®°å¿†å£è¯€**
> 
> *"å­—æ®µå†’å·åŠ ç©ºæ ¼ï¼ŒåŒæ¢è¡Œæ¥åšç»“å°¾ï¼›*
> *å¤šè¡Œdataè‡ªåŠ¨å¹¶ï¼Œå†’å·æ³¨é‡Šå¯å¿½ç•¥"*

### 7.3 å®é™…åº”ç”¨å»ºè®®


| ğŸ“‹ åº”ç”¨åœºæ™¯ | **æ¨èå­—æ®µç»„åˆ** | **ç¤ºä¾‹** |
|------------|----------------|---------|
| ğŸ“Š **å®æ—¶æ•°æ®** | `data` + `retry` | è‚¡ä»·ã€ç›‘æ§æ•°æ® |
| ğŸ’¬ **èŠå¤©åº”ç”¨** | `event` + `data` + `id` | æ¶ˆæ¯åˆ†ç±»ã€æ–­çº¿ç»­ä¼  |
| ğŸ“° **æ–°é—»æ¨é€** | `id` + `data` + `retry` | é˜²æ­¢é‡å¤ã€é™ä½é‡è¿é¢‘ç‡ |
| ğŸ® **æ¸¸æˆçŠ¶æ€** | `event` + `data` | ä¸åŒæ¸¸æˆäº‹ä»¶åˆ†ç±»å¤„ç† |

### 7.4 å¸¸è§é”™è¯¯é¿å…


```
âŒ é”™è¯¯åšæ³•ï¼š
data: æ¶ˆæ¯å†…å®¹    (ç¼ºå°‘åŒæ¢è¡Œç»“å°¾)

âœ… æ­£ç¡®åšæ³•ï¼š  
data: æ¶ˆæ¯å†…å®¹

(è¿™é‡Œæœ‰ä¸¤ä¸ªæ¢è¡Œç¬¦)

âŒ é”™è¯¯åšæ³•ï¼š
event:userLogin   (ç¼ºå°‘ç©ºæ ¼)

âœ… æ­£ç¡®åšæ³•ï¼š
event: userLogin  (å†’å·åæœ‰ç©ºæ ¼)
```

### 7.5 è°ƒè¯•æŠ€å·§


> ğŸ”§ **è°ƒè¯•å»ºè®®**
> 
> 1. **ä½¿ç”¨æ³¨é‡Š**ï¼šåœ¨æ¶ˆæ¯ä¸­åŠ å…¥æ—¶é—´æˆ³å’Œè¯´æ˜
> 2. **æµè§ˆå™¨DevTools**ï¼šNetworkæ ‡ç­¾æŸ¥çœ‹SSEè¿æ¥
> 3. **æœåŠ¡å™¨æ—¥å¿—**ï¼šè®°å½•å‘é€çš„æ¯æ¡æ¶ˆæ¯
> 4. **å®¢æˆ·ç«¯æ—¥å¿—**ï¼šæ‰“å°æ¥æ”¶åˆ°çš„eventå¯¹è±¡

**æ ¸å¿ƒè®°å¿†**ï¼š
- SSEæ¶ˆæ¯æ ¼å¼å°±åƒå‘çŸ­ä¿¡çš„å›ºå®šæ ¼å¼
- å››å¤§å­—æ®µå„å¸å…¶èŒï¼Œç»„åˆä½¿ç”¨å¨åŠ›å¤§
- åŒæ¢è¡Œç»“å°¾æ˜¯å…³é”®ï¼Œåƒä¸‡ä¸è¦å¿˜
- è‡ªå®šä¹‰äº‹ä»¶è®©æ¶ˆæ¯åˆ†ç±»æ›´æ¸…æ™°