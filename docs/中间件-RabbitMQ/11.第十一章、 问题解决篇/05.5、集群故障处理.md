---
title: 5ã€é›†ç¾¤æ•…éšœå¤„ç†
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤æ•…éšœåŸºç¡€è®¤çŸ¥](#1-é›†ç¾¤æ•…éšœåŸºç¡€è®¤çŸ¥)
2. [èŠ‚ç‚¹æ•…éšœæ¢å¤å®æˆ˜](#2-èŠ‚ç‚¹æ•…éšœæ¢å¤å®æˆ˜)
3. [ç½‘ç»œåˆ†åŒºå¤„ç†ç­–ç•¥](#3-ç½‘ç»œåˆ†åŒºå¤„ç†ç­–ç•¥)
4. [è„‘è£‚é—®é¢˜æ·±åº¦è§£æ](#4-è„‘è£‚é—®é¢˜æ·±åº¦è§£æ)
5. [æ•°æ®ä¸€è‡´æ€§ä¿®å¤æ–¹æ¡ˆ](#5-æ•°æ®ä¸€è‡´æ€§ä¿®å¤æ–¹æ¡ˆ)
6. [æ•…éšœåˆ‡æ¢æµ‹è¯•æµç¨‹](#6-æ•…éšœåˆ‡æ¢æµ‹è¯•æµç¨‹)
7. [é¢„é˜²æ€§ç»´æŠ¤ç­–ç•¥](#7-é¢„é˜²æ€§ç»´æŠ¤ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ é›†ç¾¤æ•…éšœåŸºç¡€è®¤çŸ¥


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQé›†ç¾¤æ•…éšœ


**ç”¨å¤§ç™½è¯è¯´**ï¼šæƒ³è±¡RabbitMQé›†ç¾¤å°±åƒä¸€ä¸ªå›¢é˜Ÿï¼Œå¹³æ—¶å¤§å®¶åä½œå¾—å¾ˆå¥½ï¼Œä½†æœ‰æ—¶ä¼šå‡ºç°é—®é¢˜â€”â€”æœ‰äººè¯·ç—…å‡ï¼ˆèŠ‚ç‚¹æ•…éšœï¼‰ã€å›¢é˜Ÿå†…éƒ¨æ²Ÿé€šä¸­æ–­ï¼ˆç½‘ç»œåˆ†åŒºï¼‰ã€æˆ–è€…å›¢é˜Ÿåˆ†æˆä¸¤æ´¾å„è‡ªä¸ºæ”¿ï¼ˆè„‘è£‚ï¼‰ã€‚

```
ğŸ¢ å¥åº·çš„é›†ç¾¤çŠ¶æ€ï¼š
èŠ‚ç‚¹A â†â†’ èŠ‚ç‚¹B â†â†’ èŠ‚ç‚¹C
  â†‘        â†‘        â†‘
æ­£å¸¸é€šä¿¡  æ•°æ®åŒæ­¥  åè°ƒä¸€è‡´

ğŸš« æ•…éšœçŠ¶æ€ç¤ºä¾‹ï¼š
èŠ‚ç‚¹A â†Xâ†’ èŠ‚ç‚¹B â†â†’ èŠ‚ç‚¹C
  â†‘        â†‘        â†‘
 å­¤ç«‹    æ­£å¸¸é€šä¿¡   æ­£å¸¸
```

### 1.2 å¸¸è§æ•…éšœç±»å‹ä¸€è§ˆ


**ğŸ“Š æ•…éšœå½±å“ç¨‹åº¦å¯¹æ¯”**ï¼š

| æ•…éšœç±»å‹ | **å½±å“èŒƒå›´** | **ä¿®å¤éš¾åº¦** | **æ•°æ®é£é™©** | **ä¸šåŠ¡å½±å“** |
|---------|-------------|-------------|-------------|-------------|
| **å•èŠ‚ç‚¹æ•…éšœ** | `å±€éƒ¨` | `â­â­â˜†â˜†â˜†` | `ä½` | `æœåŠ¡é™çº§` |
| **ç½‘ç»œåˆ†åŒº** | `å…¨å±€` | `â­â­â­â˜†â˜†` | `ä¸­` | `éƒ¨åˆ†ä¸å¯ç”¨` |
| **è„‘è£‚é—®é¢˜** | `å…¨å±€` | `â­â­â­â­â˜†` | `é«˜` | `æ•°æ®ä¸ä¸€è‡´` |
| **æ•°æ®æŸå** | `å…¨å±€` | `â­â­â­â­â­` | `æé«˜` | `æœåŠ¡ä¸­æ–­` |

### 1.3 æ•…éšœè¯Šæ–­çš„åŸºæœ¬æ€è·¯


**ğŸ” è¯Šæ–­æµç¨‹å›¾**ï¼š
```
å‘ç°æ•…éšœ
    â†“
æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ â†’ å…¨éƒ¨æ­£å¸¸ï¼Ÿ â†’ æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
    â†“              â†“
æœ‰èŠ‚ç‚¹å¼‚å¸¸      æ£€æŸ¥æ¶ˆæ¯ç§¯å‹
    â†“              â†“
å•èŠ‚ç‚¹æ•…éšœå¤„ç†    æ€§èƒ½è°ƒä¼˜
    â†“
æ¢å¤éªŒè¯
```

**ğŸ› ï¸ åŸºç¡€è¯Šæ–­å‘½ä»¤**ï¼š
```bash
# å¿«é€Ÿæ£€æŸ¥é›†ç¾¤æ•´ä½“çŠ¶æ€
rabbitmqctl cluster_status

# æ£€æŸ¥èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€
rabbitmqctl node_health_check

# æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯
rabbitmqctl status
```

**ğŸ’¡ æ•…éšœè¯†åˆ«è¦ç‚¹**ï¼š
```
ğŸ”¸ ç—‡çŠ¶è§‚å¯Ÿï¼šä»ç”¨æˆ·åé¦ˆå’Œç›‘æ§å‘Šè­¦å¼€å§‹
ğŸ”¸ çŠ¶æ€æ£€æŸ¥ï¼šå…ˆçœ‹æ•´ä½“å†çœ‹å±€éƒ¨
ğŸ”¸ æ—¥å¿—åˆ†æï¼šé”™è¯¯æ—¥å¿—æ˜¯æœ€å¥½çš„çº¿ç´¢
ğŸ”¸ ç½‘ç»œæ£€æµ‹ï¼šå¾ˆå¤šé—®é¢˜éƒ½æ˜¯ç½‘ç»œå¼•èµ·çš„
ğŸ”¸ èµ„æºç›‘æ§ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ
```

---

## 2. ğŸ”§ èŠ‚ç‚¹æ•…éšœæ¢å¤å®æˆ˜


### 2.1 å•èŠ‚ç‚¹æ•…éšœçš„è¯†åˆ«ä¸å¤„ç†


**è¯†åˆ«æ•…éšœèŠ‚ç‚¹**ï¼š
```bash
# æ£€æŸ¥å“ªäº›èŠ‚ç‚¹å‡ºç°é—®é¢˜
rabbitmqctl cluster_status

# è¾“å‡ºç¤ºä¾‹è§£è¯»ï¼š
# Running nodes: [rabbit@node1, rabbit@node2]
# Partitioned nodes: [rabbit@node3]  â† è¿™ä¸ªèŠ‚ç‚¹æœ‰é—®é¢˜
```

**ğŸ“‹ èŠ‚ç‚¹æ•…éšœæ¢å¤æ­¥éª¤**ï¼š

**ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ•…éšœåŸå› **
```bash
# åœ¨æ•…éšœèŠ‚ç‚¹ä¸Šæ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status rabbitmq-server

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/rabbitmq/rabbit@$(hostname).log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 5672
```

**ç¬¬äºŒæ­¥ï¼šå°è¯•è½¯é‡å¯**
```bash
# åœæ­¢RabbitMQæœåŠ¡
rabbitmqctl stop

# æˆ–è€…ä½¿ç”¨systemctl
systemctl stop rabbitmq-server

# é‡æ–°å¯åŠ¨
systemctl start rabbitmq-server

# éªŒè¯èŠ‚ç‚¹æ˜¯å¦é‡æ–°åŠ å…¥é›†ç¾¤
rabbitmqctl cluster_status
```

### 2.2 é¡½å›ºèŠ‚ç‚¹æ•…éšœå¤„ç†


æœ‰æ—¶å€™èŠ‚ç‚¹å°±æ˜¯ä¸å¬è¯ï¼Œè¿™æ—¶éœ€è¦æ›´ä¸¥æ ¼çš„æªæ–½ï¼š

**ğŸš‘ å¼ºåˆ¶æ¢å¤æµç¨‹**ï¼š
```bash
# 1. å®Œå…¨åœæ­¢èŠ‚ç‚¹
rabbitmqctl stop_app
systemctl stop rabbitmq-server

# 2. é‡ç½®èŠ‚ç‚¹ï¼ˆæ…ç”¨ï¼ä¼šä¸¢å¤±æœ¬åœ°æ•°æ®ï¼‰
rabbitmqctl reset

# 3. é‡æ–°åŠ å…¥é›†ç¾¤
rabbitmqctl join_cluster rabbit@node1

# 4. å¯åŠ¨åº”ç”¨
rabbitmqctl start_app
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
æ•°æ®ä¸¢å¤±é£é™©ï¼š
â€¢ resetæ“ä½œä¼šæ¸…ç©ºèŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®
â€¢ åªæœ‰åœ¨ç¡®è®¤æ•°æ®å¯ä»¥ä»å…¶ä»–èŠ‚ç‚¹æ¢å¤æ—¶æ‰ä½¿ç”¨
â€¢ å»ºè®®å…ˆåšå¥½æ•°æ®å¤‡ä»½

æ¢å¤éªŒè¯ï¼š
â€¢ æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦æ­£å¸¸
â€¢ éªŒè¯æ¶ˆæ¯æ˜¯å¦èƒ½æ­£å¸¸æ”¶å‘
â€¢ ç¡®è®¤é›†ç¾¤çŠ¶æ€å®Œå…¨æ­£å¸¸
```

### 2.3 ç¡¬ä»¶æ•…éšœçš„åº”å¯¹ç­–ç•¥


**ğŸ’» ç¡¬ä»¶æ•…éšœåœºæ™¯**ï¼š
```
å¸¸è§ç¡¬ä»¶é—®é¢˜ï¼š
ğŸ”¸ ç£ç›˜æ•…éšœï¼šæ•°æ®æ–‡ä»¶æŸåæˆ–æ— æ³•è®¿é—®
ğŸ”¸ å†…å­˜ä¸è¶³ï¼šèŠ‚ç‚¹é¢‘ç¹é‡å¯æˆ–å“åº”ç¼“æ…¢
ğŸ”¸ ç½‘å¡æ•…éšœï¼šèŠ‚ç‚¹æ— æ³•ä¸é›†ç¾¤é€šä¿¡
ğŸ”¸ æœåŠ¡å™¨å®•æœºï¼šèŠ‚ç‚¹å®Œå…¨æ— å“åº”
```

**ğŸ› ï¸ åº”æ€¥å¤„ç†æ–¹æ¡ˆ**ï¼š
```bash
# ç£ç›˜æ•…éšœå¤„ç†
# 1. æ£€æŸ¥ç£ç›˜çŠ¶æ€
df -h
dmesg | grep -i error

# 2. å¦‚æœæ•°æ®ç›®å½•æŸåï¼Œå°è¯•ä¿®å¤
fsck /dev/sdb1

# 3. å¦‚æœæ— æ³•ä¿®å¤ï¼Œä½¿ç”¨å¤‡ä»½æ•°æ®
# åœæ­¢æœåŠ¡ï¼Œæ¢å¤æ•°æ®ç›®å½•ï¼Œé‡å¯æœåŠ¡

# å†…å­˜ä¸è¶³å¤„ç†
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
rabbitmqctl status | grep memory

# è°ƒæ•´å†…å­˜é™åˆ¶
echo "vm_memory_high_watermark.relative = 0.6" >> /etc/rabbitmq/rabbitmq.conf
```

### 2.4 èŠ‚ç‚¹æ›¿æ¢æµç¨‹


å½“ç¡¬ä»¶å®Œå…¨æŸåæ—¶ï¼Œéœ€è¦ç”¨æ–°æœºå™¨æ›¿æ¢ï¼š

**ğŸ”„ èŠ‚ç‚¹æ›¿æ¢æ­¥éª¤**ï¼š
```
1. å‡†å¤‡æ–°æœºå™¨ï¼š
   â€¢ å®‰è£…ç›¸åŒç‰ˆæœ¬çš„RabbitMQ
   â€¢ é…ç½®ç›¸åŒçš„ç½‘ç»œç¯å¢ƒ
   â€¢ ç¡®ä¿èƒ½è®¿é—®å…¶ä»–é›†ç¾¤èŠ‚ç‚¹

2. ä»é›†ç¾¤ä¸­ç§»é™¤æ•…éšœèŠ‚ç‚¹ï¼š
   rabbitmqctl forget_cluster_node rabbit@failed_node

3. æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼š
   rabbitmqctl join_cluster rabbit@existing_node

4. éªŒè¯å’Œæµ‹è¯•ï¼š
   â€¢ æ£€æŸ¥é›†ç¾¤çŠ¶æ€
   â€¢ æµ‹è¯•æ¶ˆæ¯æ”¶å‘
   â€¢ éªŒè¯é˜Ÿåˆ—åˆ†å¸ƒ
```

---

## 3. ğŸŒ ç½‘ç»œåˆ†åŒºå¤„ç†ç­–ç•¥


### 3.1 ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒº


**é€šä¿—è§£é‡Š**ï¼šç½‘ç»œåˆ†åŒºå°±åƒä¸¤ä¸ªæˆ¿é—´ä¹‹é—´çš„é—¨çªç„¶å…³ä¸Šäº†ï¼Œæˆ¿é—´é‡Œçš„äººéƒ½æ­£å¸¸å·¥ä½œï¼Œä½†å½¼æ­¤å¬ä¸åˆ°å£°éŸ³ã€çœ‹ä¸åˆ°å¯¹æ–¹ã€‚åœ¨RabbitMQé›†ç¾¤ä¸­ï¼ŒèŠ‚ç‚¹ä¹‹é—´å¤±å»ç½‘ç»œè¿æ¥å°±å½¢æˆäº†åˆ†åŒºã€‚

```
ğŸ  æ­£å¸¸ç½‘ç»œçŠ¶æ€ï¼š
èŠ‚ç‚¹A â†â”€ç½‘ç»œâ”€â†’ èŠ‚ç‚¹B â†â”€ç½‘ç»œâ”€â†’ èŠ‚ç‚¹C
  â†‘             â†‘             â†‘
æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½ç›¸äº’é€šä¿¡

ğŸš« ç½‘ç»œåˆ†åŒºçŠ¶æ€ï¼š
èŠ‚ç‚¹A     â•³â•³â•³     èŠ‚ç‚¹B â†â”€ç½‘ç»œâ”€â†’ èŠ‚ç‚¹C
  â†‘       æ–­å¼€        â†‘             â†‘
åˆ†åŒº1      ç½‘ç»œ      åˆ†åŒº2ï¼ˆèƒ½ç›¸äº’é€šä¿¡ï¼‰
```

### 3.2 ç½‘ç»œåˆ†åŒºçš„æ£€æµ‹æ–¹æ³•


**ğŸ” æ£€æµ‹ç½‘ç»œåˆ†åŒº**ï¼š
```bash
# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼ˆé‡ç‚¹å…³æ³¨Partitioned nodesï¼‰
rabbitmqctl cluster_status

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping node2
telnet node2 5672

# æŸ¥çœ‹åˆ†åŒºå†å²
rabbitmqctl eval 'rabbit_node_monitor:partitions().'
```

**ğŸ“Š åˆ†åŒºçŠ¶æ€è§£è¯»**ï¼š
```
æ­£å¸¸çŠ¶æ€è¾“å‡ºï¼š
Cluster status:
Running nodes: [rabbit@node1, rabbit@node2, rabbit@node3]
Partitioned nodes: []  â† ç©ºåˆ—è¡¨è¡¨ç¤ºæ²¡æœ‰åˆ†åŒº

åˆ†åŒºçŠ¶æ€è¾“å‡ºï¼š
Running nodes: [rabbit@node1, rabbit@node3]
Partitioned nodes: [rabbit@node2]  â† node2è¢«åˆ†åŒºäº†
```

### 3.3 ç½‘ç»œåˆ†åŒºæ¢å¤ç­–ç•¥


RabbitMQæä¾›äº†å‡ ç§åˆ†åŒºæ¢å¤ç­–ç•¥ï¼Œå°±åƒä¸åŒçš„"å’Œè§£æ–¹æ¡ˆ"ï¼š

**âš™ï¸ åˆ†åŒºå¤„ç†æ¨¡å¼é…ç½®**ï¼š
```bash
# åœ¨rabbitmq.confä¸­è®¾ç½®åˆ†åŒºå¤„ç†ç­–ç•¥
cluster_partition_handling = autoheal    # è‡ªåŠ¨ä¿®å¤ï¼ˆæ¨èï¼‰
# æˆ–è€…
cluster_partition_handling = pause_minority  # æš‚åœå°‘æ•°æ´¾
# æˆ–è€…
cluster_partition_handling = ignore      # å¿½ç•¥ï¼ˆä¸æ¨èï¼‰
```

**ğŸ”§ å„ç§ç­–ç•¥è¯¦è§£**ï¼š

**1. autohealæ¨¡å¼ï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰**ï¼š
```
å·¥ä½œåŸç†ï¼š
â€¢ æ£€æµ‹åˆ°åˆ†åŒºæ—¶ï¼Œé€‰æ‹©ä¸€ä¸ª"æƒå¨"åˆ†åŒº
â€¢ é‡å¯å…¶ä»–åˆ†åŒºçš„èŠ‚ç‚¹ï¼Œè®©å®ƒä»¬é‡æ–°åŠ å…¥
â€¢ ç±»ä¼¼äº"å°‘æ•°æœä»å¤šæ•°"

é€‚ç”¨åœºæ™¯ï¼š
âœ… ç½‘ç»œé—®é¢˜æ˜¯ä¸´æ—¶çš„
âœ… èƒ½å®¹å¿çŸ­æš‚çš„æœåŠ¡ä¸­æ–­
âœ… å¸Œæœ›è‡ªåŠ¨åŒ–å¤„ç†

é…ç½®ç¤ºä¾‹ï¼š
cluster_partition_handling = autoheal
cluster_partition_handling.autoheal.delay = 10  # ç­‰å¾…10ç§’å†ä¿®å¤
```

**2. pause_minorityæ¨¡å¼ï¼ˆæš‚åœå°‘æ•°æ´¾ï¼‰**ï¼š
```
å·¥ä½œåŸç†ï¼š
â€¢ æš‚åœå°‘æ•°æ´¾åˆ†åŒºçš„èŠ‚ç‚¹
â€¢ åªæœ‰å¤šæ•°æ´¾ç»§ç»­æä¾›æœåŠ¡
â€¢ éœ€è¦æ‰‹åŠ¨æ¢å¤è¢«æš‚åœçš„èŠ‚ç‚¹

é€‚ç”¨åœºæ™¯ï¼š
âœ… å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜
âœ… èƒ½å®¹å¿éƒ¨åˆ†èŠ‚ç‚¹æš‚åœæœåŠ¡
âœ… å¸Œæœ›æ‰‹åŠ¨æ§åˆ¶æ¢å¤è¿‡ç¨‹
```

### 3.4 æ‰‹åŠ¨åˆ†åŒºæ¢å¤


å½“è‡ªåŠ¨æ¢å¤ä¸å·¥ä½œæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼š

**ğŸ› ï¸ æ‰‹åŠ¨æ¢å¤æ­¥éª¤**ï¼š
```bash
# 1. ç¡®å®šè¦ä¿ç•™çš„ä¸»åˆ†åŒºï¼ˆé€šå¸¸æ˜¯åŒ…å«å¤šæ•°èŠ‚ç‚¹çš„åˆ†åŒºï¼‰
# 2. åœ¨è¢«åˆ†åŒºçš„èŠ‚ç‚¹ä¸Šåœæ­¢åº”ç”¨
rabbitmqctl stop_app

# 3. é‡æ–°åŠ å…¥é›†ç¾¤
rabbitmqctl join_cluster rabbit@main_node

# 4. å¯åŠ¨åº”ç”¨
rabbitmqctl start_app

# 5. éªŒè¯åˆ†åŒºå·²è§£å†³
rabbitmqctl cluster_status
```

**ğŸ’¡ æ¢å¤æœ€ä½³å®è·µ**ï¼š
```
é€‰æ‹©ä¸»åˆ†åŒºçš„åŸåˆ™ï¼š
ğŸ”¸ åŒ…å«æœ€å¤šèŠ‚ç‚¹çš„åˆ†åŒº
ğŸ”¸ åŒ…å«é‡è¦æ•°æ®çš„åˆ†åŒº
ğŸ”¸ è´Ÿè½½æœ€é‡çš„åˆ†åŒº

æ¢å¤æ³¨æ„äº‹é¡¹ï¼š
âš ï¸ è¢«åˆ†åŒºèŠ‚ç‚¹å¯èƒ½ä¸¢å¤±éƒ¨åˆ†æ•°æ®
âš ï¸ æ¢å¤è¿‡ç¨‹ä¸­æœåŠ¡ä¼šçŸ­æš‚ä¸­æ–­
âš ï¸ éœ€è¦éªŒè¯æ•°æ®å®Œæ•´æ€§
```

---

## 4. ğŸ§  è„‘è£‚é—®é¢˜æ·±åº¦è§£æ


### 4.1 ä»€ä¹ˆæ˜¯è„‘è£‚é—®é¢˜


**å½¢è±¡æ¯”å–»**ï¼šè„‘è£‚å°±åƒä¸€ä¸ªå…¬å¸çš„æ€»éƒ¨å’Œåˆ†å…¬å¸å¤±å»è”ç³»åï¼Œéƒ½è®¤ä¸ºè‡ªå·±æ˜¯"çœŸæ­£çš„å…¬å¸"ï¼Œå¼€å§‹ç‹¬ç«‹åšå†³ç­–ã€‚å½“ç½‘ç»œæ¢å¤æ—¶ï¼Œå°±ä¼šå‘ç°æœ‰ä¸¤å¥—ä¸åŒçš„æ•°æ®å’Œå†³ç­–ï¼Œè¿™å°±éº»çƒ¦äº†ã€‚

```
ğŸ§  è„‘è£‚é—®é¢˜ç¤ºæ„ï¼š
ç½‘ç»œåˆ†åŒºå‰ï¼š
èŠ‚ç‚¹A â†â†’ èŠ‚ç‚¹B â†â†’ èŠ‚ç‚¹C (ç»Ÿä¸€é›†ç¾¤)

ç½‘ç»œåˆ†åŒºåï¼š
åˆ†åŒº1: èŠ‚ç‚¹A (è®¤ä¸ºè‡ªå·±æ˜¯ä¸»é›†ç¾¤)
åˆ†åŒº2: èŠ‚ç‚¹B â†â†’ èŠ‚ç‚¹C (ä¹Ÿè®¤ä¸ºè‡ªå·±æ˜¯ä¸»é›†ç¾¤)

é—®é¢˜ï¼šä¸¤ä¸ªåˆ†åŒºéƒ½åœ¨ç‹¬ç«‹å¤„ç†ä¸šåŠ¡ï¼
```

### 4.2 è„‘è£‚çš„å±å®³åˆ†æ


**ğŸ“Š è„‘è£‚é€ æˆçš„é—®é¢˜**ï¼š

| é—®é¢˜ç±»å‹ | **å…·ä½“è¡¨ç°** | **ä¸šåŠ¡å½±å“** | **æ¢å¤éš¾åº¦** |
|---------|-------------|-------------|-------------|
| **æ•°æ®ä¸ä¸€è‡´** | `ä¸åŒåˆ†åŒºæœ‰ä¸åŒçš„æ¶ˆæ¯` | `ä¸šåŠ¡é€»è¾‘é”™ä¹±` | `â­â­â­â­â˜†` |
| **é‡å¤å¤„ç†** | `åŒä¸€æ¶ˆæ¯è¢«å¤šæ¬¡æ¶ˆè´¹` | `é‡å¤æ‰£æ¬¾ç­‰ä¸¥é‡åæœ` | `â­â­â­â­â­` |
| **çŠ¶æ€åˆ†æ­§** | `é˜Ÿåˆ—çŠ¶æ€ä¸åŒæ­¥` | `ç›‘æ§æ•°æ®æ··ä¹±` | `â­â­â­â˜†â˜†` |
| **é…ç½®å†²çª** | `ä¸åŒåˆ†åŒºæœ‰ä¸åŒé…ç½®` | `æœåŠ¡è¡Œä¸ºä¸ä¸€è‡´` | `â­â­â­â˜†â˜†` |

### 4.3 è„‘è£‚é¢„é˜²ç­–ç•¥


**ğŸ›¡ï¸ é¢„é˜²æªæ–½**ï¼š

**1. ç½‘ç»œå±‚é¢é¢„é˜²**ï¼š
```
ç½‘ç»œå†—ä½™è®¾è®¡ï¼š
â€¢ å¤šæ¡ç½‘ç»œé“¾è·¯
â€¢ ä¸åŒç½‘ç»œè®¾å¤‡
â€¢ å¿ƒè·³æ£€æµ‹æœºåˆ¶

ç½‘ç»œé…ç½®ç¤ºä¾‹ï¼š
# é…ç½®å¤šä¸ªç½‘ç»œæ¥å£
# ä¸»ç½‘ç»œ: eth0 (192.168.1.x)
# å¤‡ç”¨ç½‘ç»œ: eth1 (192.168.2.x)

# åœ¨hostsæ–‡ä»¶ä¸­é…ç½®å¤šä¸ªIP
192.168.1.10 node1
192.168.2.10 node1-backup
```

**2. é›†ç¾¤å±‚é¢é¢„é˜²**ï¼š
```bash
# é…ç½®åˆç†çš„é›†ç¾¤å‚æ•°
echo "cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config" >> /etc/rabbitmq/rabbitmq.conf
echo "cluster_formation.classic_config.nodes.1 = rabbit@node1" >> /etc/rabbitmq/rabbitmq.conf
echo "cluster_formation.classic_config.nodes.2 = rabbit@node2" >> /etc/rabbitmq/rabbitmq.conf
echo "cluster_formation.classic_config.nodes.3 = rabbit@node3" >> /etc/rabbitmq/rabbitmq.conf

# è®¾ç½®é›†ç¾¤åç§°ï¼Œé¿å…æ„å¤–åŠ å…¥å…¶ä»–é›†ç¾¤
echo "cluster_name = production_cluster" >> /etc/rabbitmq/rabbitmq.conf
```

**3. åº”ç”¨å±‚é¢é¢„é˜²**ï¼š
```
åº”ç”¨è®¾è®¡åŸåˆ™ï¼š
âœ… æ¶ˆæ¯å¹‚ç­‰æ€§ï¼šç¡®ä¿é‡å¤å¤„ç†ä¸ä¼šé€ æˆé—®é¢˜
âœ… äº‹åŠ¡æœºåˆ¶ï¼šä½¿ç”¨ç¡®è®¤æœºåˆ¶ä¿è¯æ¶ˆæ¯å¯é æ€§
âœ… ç›‘æ§å‘Šè­¦ï¼šåŠæ—¶å‘ç°åˆ†åŒºé—®é¢˜
âœ… é™çº§æ–¹æ¡ˆï¼šåˆ†åŒºæ—¶çš„åº”æ€¥å¤„ç†ç­–ç•¥
```

### 4.4 è„‘è£‚é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ


**ğŸ”§ å‘ç°è„‘è£‚åçš„å¤„ç†æ­¥éª¤**ï¼š

**ç¬¬ä¸€æ­¥ï¼šè¯„ä¼°æ•°æ®å·®å¼‚**
```bash
# åœ¨å„ä¸ªåˆ†åŒºåˆ†åˆ«æ‰§è¡Œï¼Œæ¯”è¾ƒè¾“å‡º
rabbitmqctl list_queues name messages consumers
rabbitmqctl list_exchanges name type
rabbitmqctl list_bindings

# æ£€æŸ¥é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡å·®å¼‚
# è®°å½•ä¸ä¸€è‡´çš„é˜Ÿåˆ—å’Œæ•°æ®
```

**ç¬¬äºŒæ­¥ï¼šé€‰æ‹©æƒå¨åˆ†åŒº**
```
é€‰æ‹©æ ‡å‡†ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š
1. åŒ…å«æœ€å¤šèŠ‚ç‚¹çš„åˆ†åŒº
2. åŒ…å«æœ€é‡è¦ä¸šåŠ¡æ•°æ®çš„åˆ†åŒº  
3. å¤„ç†æ¶ˆæ¯é‡æœ€å¤§çš„åˆ†åŒº
4. æœ€è¿‘å¤‡ä»½æ—¶é—´æœ€æ–°çš„åˆ†åŒº
```

**ç¬¬ä¸‰æ­¥ï¼šæ•°æ®åˆå¹¶å¤„ç†**
```bash
# åœæ­¢éæƒå¨åˆ†åŒºçš„åº”ç”¨
rabbitmqctl stop_app

# å¦‚æœéœ€è¦ä¿ç•™æ•°æ®ï¼Œå…ˆå¯¼å‡º
rabbitmqctl export_definitions /tmp/backup.json

# é‡ç½®èŠ‚ç‚¹å¹¶é‡æ–°åŠ å…¥
rabbitmqctl reset
rabbitmqctl join_cluster rabbit@authority_node
rabbitmqctl start_app

# å¦‚æœæœ‰éœ€è¦ï¼Œå¯¼å…¥ä¿ç•™çš„é…ç½®
rabbitmqctl import_definitions /tmp/backup.json
```

**ğŸ¯ è„‘è£‚æ¢å¤æœ€ä½³å®è·µ**ï¼š
```
æ•°æ®å¤„ç†ç­–ç•¥ï¼š
â€¢ ä¼˜å…ˆä¿è¯æ ¸å¿ƒä¸šåŠ¡æ•°æ®
â€¢ å¯¹äºå†²çªæ•°æ®ï¼Œé€‰æ‹©æœ€æ–°æ—¶é—´æˆ³çš„
â€¢ é‡å¤æ¶ˆæ¯é€šè¿‡ä¸šåŠ¡å±‚å»é‡
â€¢ é‡è¦é˜Ÿåˆ—æ‰‹åŠ¨éªŒè¯æ•°æ®å®Œæ•´æ€§

æ¢å¤éªŒè¯ï¼š
â€¢ æ£€æŸ¥æ‰€æœ‰é˜Ÿåˆ—çŠ¶æ€
â€¢ éªŒè¯æ¶ˆæ¯è·¯ç”±æ­£ç¡®æ€§
â€¢ æµ‹è¯•ç”Ÿäº§æ¶ˆè´¹åŠŸèƒ½
â€¢ ç›‘æ§æ€§èƒ½æŒ‡æ ‡
```

---

## 5. ğŸ”„ æ•°æ®ä¸€è‡´æ€§ä¿®å¤æ–¹æ¡ˆ


### 5.1 æ•°æ®ä¸ä¸€è‡´çš„è¡¨ç°å½¢å¼


**ğŸ­ ä¸ä¸€è‡´ç—‡çŠ¶è¯†åˆ«**ï¼š
```
å¸¸è§ä¸ä¸€è‡´ç°è±¡ï¼š
ğŸ”¸ é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡ä¸åŒï¼šåŒä¸€é˜Ÿåˆ—åœ¨ä¸åŒèŠ‚ç‚¹æ˜¾ç¤ºä¸åŒæ¶ˆæ¯æ•°
ğŸ”¸ äº¤æ¢å™¨ç»‘å®šå…³ç³»ç¼ºå¤±ï¼šè·¯ç”±è§„åˆ™åœ¨æŸäº›èŠ‚ç‚¹å¤±æ•ˆ
ğŸ”¸ ç”¨æˆ·æƒé™ä¸åŒæ­¥ï¼šæŸäº›èŠ‚ç‚¹æ— æ³•è¯†åˆ«ç”¨æˆ·æƒé™
ğŸ”¸ è™šæ‹Ÿä¸»æœºçŠ¶æ€å¼‚å¸¸ï¼švhoståœ¨éƒ¨åˆ†èŠ‚ç‚¹ä¸å¯ç”¨
```

**ğŸ” æ£€æµ‹æ•°æ®ä¸€è‡´æ€§**ï¼š
```bash
# åˆ›å»ºä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬
cat > check_consistency.sh << 'EOF'
#!/bin/bash
echo "=== æ£€æŸ¥é˜Ÿåˆ—ä¸€è‡´æ€§ ==="
for node in node1 node2 node3; do
    echo "èŠ‚ç‚¹ $node:"
    rabbitmqctl -n rabbit@$node list_queues name messages | head -10
    echo "---"
done

echo "=== æ£€æŸ¥äº¤æ¢å™¨ä¸€è‡´æ€§ ==="
for node in node1 node2 node3; do
    echo "èŠ‚ç‚¹ $node:"
    rabbitmqctl -n rabbit@$node list_exchanges name | head -5
    echo "---"
done
EOF

chmod +x check_consistency.sh
./check_consistency.sh
```

### 5.2 é˜Ÿåˆ—æ•°æ®åŒæ­¥ä¿®å¤


**ğŸ“¦ é˜Ÿåˆ—åŒæ­¥ç­–ç•¥**ï¼š

**è‡ªåŠ¨åŒæ­¥æ–¹æ³•**ï¼š
```bash
# å¯¹äºé•œåƒé˜Ÿåˆ—ï¼Œè§¦å‘åŒæ­¥
rabbitmqctl sync_queue queue_name

# åŒæ­¥æ‰€æœ‰æœªåŒæ­¥çš„é•œåƒé˜Ÿåˆ—
rabbitmqctl eval 'rabbit_mirror_queue_misc:sync_mirrors().'

# æ£€æŸ¥åŒæ­¥çŠ¶æ€
rabbitmqctl list_queues name synchronised_slave_pids
```

**æ‰‹åŠ¨æ•°æ®ä¿®å¤**ï¼š
```bash
# 1. å¤‡ä»½å½“å‰é˜Ÿåˆ—æ•°æ®
rabbitmqctl eval "
rabbit_amqqueue:with_or_die(
    rabbit_misc:r(<<\"virtual_host\">>, queue, <<\"queue_name\">>),
    fun(Q) ->
        rabbit_amqqueue:basic_get(Q, self(), false, undefined)
    end).
"

# 2. æ¸…ç©ºé—®é¢˜é˜Ÿåˆ—
rabbitmqctl purge_queue queue_name

# 3. é‡æ–°è®¾ç½®é˜Ÿåˆ—å±æ€§
rabbitmqctl eval "
rabbit_amqqueue:declare(
    rabbit_misc:r(<<\"virtual_host\">>, queue, <<\"queue_name\">>),
    true, false, [], none, <<\"guest\">>
).
"
```

### 5.3 å…ƒæ•°æ®ä¸€è‡´æ€§ä¿®å¤


**âš™ï¸ é›†ç¾¤å…ƒæ•°æ®åŒæ­¥**ï¼š

**é…ç½®ä¿¡æ¯åŒæ­¥**ï¼š
```bash
# å¯¼å‡ºä¸»èŠ‚ç‚¹çš„å®Œæ•´é…ç½®
rabbitmqctl export_definitions /tmp/master_config.json

# åœ¨å…¶ä»–èŠ‚ç‚¹å¯¼å…¥é…ç½®
rabbitmqctl import_definitions /tmp/master_config.json

# éªŒè¯é…ç½®ä¸€è‡´æ€§
rabbitmqctl eval 'rabbit_runtime_parameters:list().'
```

**ç”¨æˆ·æƒé™åŒæ­¥**ï¼š
```bash
# æ£€æŸ¥ç”¨æˆ·ä¸€è‡´æ€§
rabbitmqctl list_users

# é‡æ–°è®¾ç½®ç”¨æˆ·æƒé™ï¼ˆå¦‚æœå‘ç°ä¸ä¸€è‡´ï¼‰
rabbitmqctl set_permissions -p / username ".*" ".*" ".*"

# åŒæ­¥è™šæ‹Ÿä¸»æœºé…ç½®
rabbitmqctl list_vhosts
rabbitmqctl add_vhost production  # å¦‚æœç¼ºå¤±
```

### 5.4 æ•°æ®ä¿®å¤çš„éªŒè¯æµç¨‹


**âœ… ä¿®å¤éªŒè¯æ£€æŸ¥è¡¨**ï¼š
```bash
# 1. åŸºç¡€è¿é€šæ€§éªŒè¯
rabbitmqctl cluster_status
echo "âœ“ é›†ç¾¤çŠ¶æ€æ­£å¸¸"

# 2. é˜Ÿåˆ—æ•°æ®éªŒè¯
rabbitmqctl list_queues name messages consumers memory
echo "âœ“ é˜Ÿåˆ—çŠ¶æ€ä¸€è‡´"

# 3. æ¶ˆæ¯è·¯ç”±éªŒè¯
rabbitmqctl publish test_exchange test_key "test message"
rabbitmqctl get test_queue
echo "âœ“ æ¶ˆæ¯è·¯ç”±æ­£å¸¸"

# 4. æ€§èƒ½æŒ‡æ ‡éªŒè¯
rabbitmqctl status | grep -E "(memory|disk|connections)"
echo "âœ“ æ€§èƒ½æŒ‡æ ‡æ­£å¸¸"
```

**ğŸ“Š ä¿®å¤æ•ˆæœè¯„ä¼°**ï¼š
```
è¯„ä¼°æŒ‡æ ‡ï¼š
â€¢ æ•°æ®å®Œæ•´æ€§ï¼šæ‰€æœ‰é¢„æœŸæ•°æ®éƒ½å­˜åœ¨
â€¢ åŠŸèƒ½æ­£ç¡®æ€§ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½èƒ½æ­£å¸¸å·¥ä½œ
â€¢ æ€§èƒ½ç¨³å®šæ€§ï¼šä¿®å¤åæ€§èƒ½æ²¡æœ‰æ˜æ˜¾ä¸‹é™
â€¢ ä¸€è‡´æ€§ç¨‹åº¦ï¼šæ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€å®Œå…¨ä¸€è‡´

éªŒæ”¶æ ‡å‡†ï¼š
âœ… æ‰€æœ‰é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡ä¸€è‡´
âœ… äº¤æ¢å™¨å’Œç»‘å®šå…³ç³»å®Œæ•´
âœ… ç”¨æˆ·æƒé™åœ¨æ‰€æœ‰èŠ‚ç‚¹ç”Ÿæ•ˆ
âœ… ç›‘æ§æŒ‡æ ‡æ¢å¤æ­£å¸¸
```

---

## 6. ğŸ”„ æ•…éšœåˆ‡æ¢æµ‹è¯•æµç¨‹


### 6.1 ä¸ºä»€ä¹ˆè¦åšæ•…éšœåˆ‡æ¢æµ‹è¯•


**ğŸ¯ æµ‹è¯•çš„é‡è¦æ€§**ï¼š
æ•…éšœåˆ‡æ¢æµ‹è¯•å°±åƒæ¶ˆé˜²æ¼”ç»ƒï¼Œå¹³æ—¶å¤šç»ƒä¹ ï¼ŒçœŸæ­£é‡åˆ°ç«ç¾æ—¶æ‰ä¸ä¼šæ…Œå¼ ã€‚å¯¹äºRabbitMQé›†ç¾¤æ¥è¯´ï¼Œå®šæœŸæµ‹è¯•èƒ½ç¡®ä¿åœ¨çœŸå®æ•…éšœå‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿèƒ½å¤ŸæŒ‰é¢„æœŸæ¢å¤ã€‚

```
æµ‹è¯•æ”¶ç›Šï¼š
âœ… éªŒè¯æ•…éšœæ¢å¤æµç¨‹çš„æœ‰æ•ˆæ€§
âœ… å‘ç°ç›‘æ§ç³»ç»Ÿçš„ç›²ç‚¹
âœ… è®­ç»ƒè¿ç»´å›¢é˜Ÿçš„åº”æ€¥å“åº”èƒ½åŠ›
âœ… ä¼˜åŒ–æ¢å¤æ—¶é—´å’Œæ­¥éª¤
âœ… å¢å¼ºå¯¹ç³»ç»Ÿå¯é æ€§çš„ä¿¡å¿ƒ
```

### 6.2 æ•…éšœåˆ‡æ¢æµ‹è¯•è®¡åˆ’


**ğŸ“‹ æµ‹è¯•åœºæ™¯è®¾è®¡**ï¼š

**åœºæ™¯ä¸€ï¼šå•èŠ‚ç‚¹æ•…éšœ**
```bash
# æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯å•èŠ‚ç‚¹ä¸‹çº¿æ—¶é›†ç¾¤çš„ç¨³å®šæ€§
# æ‰§è¡Œæ­¥éª¤ï¼š
echo "=== å•èŠ‚ç‚¹æ•…éšœæµ‹è¯•å¼€å§‹ ==="

# 1. è®°å½•å½“å‰çŠ¶æ€
rabbitmqctl cluster_status > /tmp/before_test.log
rabbitmqctl list_queues name messages > /tmp/queues_before.log

# 2. åœæ­¢ä¸€ä¸ªèŠ‚ç‚¹
systemctl stop rabbitmq-server  # åœ¨node3æ‰§è¡Œ

# 3. éªŒè¯é›†ç¾¤ä¾ç„¶å¯ç”¨
rabbitmqctl cluster_status  # åœ¨node1æ‰§è¡Œ
rabbitmqctl publish test_exchange test_key "test message during failure"

# 4. æ¢å¤èŠ‚ç‚¹
systemctl start rabbitmq-server  # åœ¨node3æ‰§è¡Œ

# 5. éªŒè¯æ¢å¤çŠ¶æ€
rabbitmqctl cluster_status
echo "=== å•èŠ‚ç‚¹æ•…éšœæµ‹è¯•å®Œæˆ ==="
```

**åœºæ™¯äºŒï¼šç½‘ç»œåˆ†åŒºæ¨¡æ‹Ÿ**
```bash
# ä½¿ç”¨iptablesæ¨¡æ‹Ÿç½‘ç»œåˆ†åŒº
echo "=== ç½‘ç»œåˆ†åŒºæµ‹è¯•å¼€å§‹ ==="

# 1. åœ¨node1ä¸Šé˜»æ–­ä¸node2çš„é€šä¿¡
iptables -A INPUT -s 192.168.1.20 -j DROP
iptables -A OUTPUT -d 192.168.1.20 -j DROP

# 2. è§‚å¯Ÿåˆ†åŒºæ£€æµ‹å’Œå¤„ç†
rabbitmqctl cluster_status
sleep 30  # ç­‰å¾…åˆ†åŒºæ£€æµ‹

# 3. æ¢å¤ç½‘ç»œ
iptables -F

# 4. éªŒè¯åˆ†åŒºæ¢å¤
rabbitmqctl cluster_status
echo "=== ç½‘ç»œåˆ†åŒºæµ‹è¯•å®Œæˆ ==="
```

### 6.3 è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬


**ğŸ¤– ç»¼åˆæµ‹è¯•è„šæœ¬**ï¼š
```bash
#!/bin/bash
# RabbitMQé›†ç¾¤æ•…éšœåˆ‡æ¢è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

# é…ç½®å‚æ•°
NODES=("node1" "node2" "node3")
TEST_QUEUE="failover_test_queue"
TEST_EXCHANGE="failover_test_exchange"
RESULTS_DIR="/tmp/failover_test_$(date +%Y%m%d_%H%M%S)"

# åˆ›å»ºç»“æœç›®å½•
mkdir -p $RESULTS_DIR

# æµ‹è¯•å‰å‡†å¤‡
setup_test() {
    echo "è®¾ç½®æµ‹è¯•ç¯å¢ƒ..."
    rabbitmqctl declare_queue $TEST_QUEUE durable=true
    rabbitmqctl declare_exchange $TEST_EXCHANGE type=direct
    rabbitmqctl bind_queue $TEST_EXCHANGE $TEST_QUEUE test_key
    
    # å‘é€æµ‹è¯•æ¶ˆæ¯
    for i in {1..100}; do
        rabbitmqctl publish $TEST_EXCHANGE test_key "test message $i"
    done
    
    echo "æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆï¼Œé˜Ÿåˆ—ä¸­æœ‰100æ¡æ¶ˆæ¯"
}

# æ‰§è¡Œæ•…éšœæµ‹è¯•
run_failure_test() {
    local test_node=$1
    echo "å¼€å§‹æµ‹è¯•èŠ‚ç‚¹ $test_node çš„æ•…éšœåˆ‡æ¢..."
    
    # è®°å½•æ•…éšœå‰çŠ¶æ€
    rabbitmqctl cluster_status > $RESULTS_DIR/before_${test_node}_failure.log
    rabbitmqctl list_queues name messages > $RESULTS_DIR/queues_before_${test_node}.log
    
    # æ¨¡æ‹ŸèŠ‚ç‚¹æ•…éšœ
    ssh $test_node "systemctl stop rabbitmq-server"
    echo "èŠ‚ç‚¹ $test_node å·²åœæ­¢"
    
    # ç­‰å¾…æ•…éšœæ£€æµ‹
    sleep 10
    
    # éªŒè¯é›†ç¾¤çŠ¶æ€
    rabbitmqctl cluster_status > $RESULTS_DIR/during_${test_node}_failure.log
    
    # æµ‹è¯•æœåŠ¡å¯ç”¨æ€§
    rabbitmqctl publish $TEST_EXCHANGE test_key "message during $test_node failure"
    
    # æ¢å¤èŠ‚ç‚¹
    ssh $test_node "systemctl start rabbitmq-server"
    echo "èŠ‚ç‚¹ $test_node æ­£åœ¨æ¢å¤..."
    
    # ç­‰å¾…æ¢å¤å®Œæˆ
    sleep 30
    
    # éªŒè¯æ¢å¤çŠ¶æ€
    rabbitmqctl cluster_status > $RESULTS_DIR/after_${test_node}_recovery.log
    rabbitmqctl list_queues name messages > $RESULTS_DIR/queues_after_${test_node}.log
    
    echo "èŠ‚ç‚¹ $test_node æ•…éšœåˆ‡æ¢æµ‹è¯•å®Œæˆ"
}

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
generate_report() {
    echo "ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š..."
    cat > $RESULTS_DIR/test_report.txt << EOF
RabbitMQé›†ç¾¤æ•…éšœåˆ‡æ¢æµ‹è¯•æŠ¥å‘Š
æµ‹è¯•æ—¶é—´: $(date)
æµ‹è¯•èŠ‚ç‚¹: ${NODES[@]}

æµ‹è¯•ç»“æœæ‘˜è¦:
$(for node in ${NODES[@]}; do
    echo "èŠ‚ç‚¹ $node:"
    echo "  æ•…éšœå‰æ¶ˆæ¯æ•°: $(grep $TEST_QUEUE $RESULTS_DIR/queues_before_${node}.log | awk '{print $2}')"
    echo "  æ¢å¤åæ¶ˆæ¯æ•°: $(grep $TEST_QUEUE $RESULTS_DIR/queues_after_${node}.log | awk '{print $2}')"
done)

è¯¦ç»†æ—¥å¿—æ–‡ä»¶ä½ç½®: $RESULTS_DIR/
EOF

    echo "æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: $RESULTS_DIR/test_report.txt"
}

# ä¸»æ‰§è¡Œæµç¨‹
main() {
    echo "å¼€å§‹RabbitMQé›†ç¾¤æ•…éšœåˆ‡æ¢æµ‹è¯•"
    
    setup_test
    
    for node in ${NODES[@]}; do
        run_failure_test $node
        sleep 60  # èŠ‚ç‚¹é—´æµ‹è¯•é—´éš”
    done
    
    generate_report
    echo "æ‰€æœ‰æµ‹è¯•å®Œæˆ"
}

# æ‰§è¡Œæµ‹è¯•
main
```

### 6.4 æµ‹è¯•ç»“æœåˆ†æ


**ğŸ“Š å…³é”®æŒ‡æ ‡è¯„ä¼°**ï¼š

**æ¢å¤æ—¶é—´åˆ†æ**ï¼š
```
æ—¶é—´æŒ‡æ ‡ï¼š
ğŸ”¸ æ•…éšœæ£€æµ‹æ—¶é—´ï¼šä»æ•…éšœå‘ç”Ÿåˆ°è¢«æ£€æµ‹å‡ºçš„æ—¶é—´
ğŸ”¸ åˆ‡æ¢å®Œæˆæ—¶é—´ï¼šä»æ£€æµ‹åˆ°æœåŠ¡æ¢å¤çš„æ—¶é—´
ğŸ”¸ æ•°æ®åŒæ­¥æ—¶é—´ï¼šä»æ¢å¤åˆ°æ•°æ®å®Œå…¨ä¸€è‡´çš„æ—¶é—´

æ ‡å‡†å‚è€ƒï¼š
â€¢ æ•…éšœæ£€æµ‹ï¼š< 30ç§’
â€¢ æœåŠ¡åˆ‡æ¢ï¼š< 2åˆ†é’Ÿ
â€¢ æ•°æ®åŒæ­¥ï¼š< 5åˆ†é’Ÿï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
```

**æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**ï¼š
```bash
# æ¶ˆæ¯ä¸¢å¤±æ£€æŸ¥
echo "æ£€æŸ¥æ¶ˆæ¯å®Œæ•´æ€§..."
EXPECTED_MESSAGES=100
ACTUAL_MESSAGES=$(rabbitmqctl list_queues name messages | grep $TEST_QUEUE | awk '{print $2}')

if [ "$ACTUAL_MESSAGES" -eq "$EXPECTED_MESSAGES" ]; then
    echo "âœ“ æ¶ˆæ¯å®Œæ•´æ€§éªŒè¯é€šè¿‡"
else
    echo "âœ— æ¶ˆæ¯ä¸¢å¤±ï¼šæœŸæœ› $EXPECTED_MESSAGESï¼Œå®é™… $ACTUAL_MESSAGES"
fi
```

**æ€§èƒ½å½±å“è¯„ä¼°**ï¼š
```
æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”ï¼š
â€¢ CPUä½¿ç”¨ç‡å˜åŒ–
â€¢ å†…å­˜ä½¿ç”¨ç‡å˜åŒ–  
â€¢ æ¶ˆæ¯å¤„ç†å»¶è¿Ÿå˜åŒ–
â€¢ è¿æ¥æ•°å˜åŒ–

å¯æ¥å—èŒƒå›´ï¼š
â€¢ æ€§èƒ½ä¸‹é™ < 20%
â€¢ å»¶è¿Ÿå¢åŠ  < 50%
â€¢ æ¢å¤åæ€§èƒ½å®Œå…¨æ¢å¤
```

---

## 7. ğŸ›¡ï¸ é¢„é˜²æ€§ç»´æŠ¤ç­–ç•¥


### 7.1 æ—¥å¸¸ç›‘æ§æ£€æŸ¥


**ğŸ“Š ç›‘æ§æŒ‡æ ‡ä½“ç³»**ï¼š

**ç³»ç»Ÿçº§ç›‘æ§**ï¼š
```bash
# åˆ›å»ºæ—¥å¸¸æ£€æŸ¥è„šæœ¬
cat > daily_health_check.sh << 'EOF'
#!/bin/bash
echo "=== RabbitMQæ—¥å¸¸å¥åº·æ£€æŸ¥ $(date) ==="

# 1. é›†ç¾¤çŠ¶æ€æ£€æŸ¥
echo "1. é›†ç¾¤çŠ¶æ€:"
rabbitmqctl cluster_status | grep -E "(Running nodes|Partitioned nodes)"

# 2. èŠ‚ç‚¹èµ„æºä½¿ç”¨
echo "2. èµ„æºä½¿ç”¨æƒ…å†µ:"
for node in node1 node2 node3; do
    echo "èŠ‚ç‚¹ $node:"
    ssh $node "top -bn1 | grep rabbitmq | head -3"
    ssh $node "df -h | grep -E '(rabbitmq|mnesia)'"
done

# 3. é˜Ÿåˆ—ç§¯å‹æ£€æŸ¥
echo "3. é˜Ÿåˆ—ç§¯å‹æƒ…å†µ:"
rabbitmqctl list_queues name messages consumers | awk '$2 > 1000 {print "è­¦å‘Š: é˜Ÿåˆ— " $1 " ç§¯å‹ " $2 " æ¡æ¶ˆæ¯"}'

# 4. è¿æ¥æ•°æ£€æŸ¥
echo "4. è¿æ¥ç»Ÿè®¡:"
rabbitmqctl list_connections | wc -l

# 5. é”™è¯¯æ—¥å¿—æ£€æŸ¥
echo "5. è¿‘æœŸé”™è¯¯:"
for node in node1 node2 node3; do
    ssh $node "tail -20 /var/log/rabbitmq/rabbit@${node}.log | grep -i error"
done

echo "=== æ£€æŸ¥å®Œæˆ ==="
EOF

chmod +x daily_health_check.sh
```

**åº”ç”¨çº§ç›‘æ§**ï¼š
```
å…³é”®ä¸šåŠ¡æŒ‡æ ‡ï¼š
ğŸ”¸ æ¶ˆæ¯å¤„ç†é€Ÿç‡ï¼šæ¯ç§’å¤„ç†çš„æ¶ˆæ¯æ•°é‡
ğŸ”¸ æ¶ˆæ¯å»¶è¿Ÿï¼šä»å‘é€åˆ°å¤„ç†çš„æ—¶é—´
ğŸ”¸ é”™è¯¯ç‡ï¼šå¤„ç†å¤±è´¥çš„æ¶ˆæ¯æ¯”ä¾‹
ğŸ”¸ é˜Ÿåˆ—é•¿åº¦ï¼šå„é˜Ÿåˆ—çš„ç§¯å‹æƒ…å†µ

å‘Šè­¦é˜ˆå€¼è®¾ç½®ï¼š
â€¢ é˜Ÿåˆ—ç§¯å‹ > 10000æ¡
â€¢ æ¶ˆæ¯å»¶è¿Ÿ > 5ç§’
â€¢ é”™è¯¯ç‡ > 1%
â€¢ èŠ‚ç‚¹CPU > 80%
â€¢ å†…å­˜ä½¿ç”¨ > 85%
```

### 7.2 å®šæœŸç»´æŠ¤ä»»åŠ¡


**ğŸ”§ å‘¨æœŸæ€§ç»´æŠ¤æ¸…å•**ï¼š

**æ¯æ—¥ä»»åŠ¡**ï¼š
```bash
# è‡ªåŠ¨åŒ–æ¯æ—¥ç»´æŠ¤è„šæœ¬
cat > daily_maintenance.sh << 'EOF'
#!/bin/bash
# æ¯æ—¥ç»´æŠ¤ä»»åŠ¡

# 1. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h | awk '$5 > 80 {print "è­¦å‘Š: " $6 " ç£ç›˜ä½¿ç”¨ç‡ " $5}'

# 2. æ¸…ç†è¿‡æœŸæ—¥å¿—
find /var/log/rabbitmq -name "*.log*" -mtime +7 -delete

# 3. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
rabbitmqctl cluster_status > /var/log/cluster_status_$(date +%Y%m%d).log

# 4. å¯¼å‡ºé…ç½®å¤‡ä»½
rabbitmqctl export_definitions /backup/rabbitmq_config_$(date +%Y%m%d).json

# 5. æ€§èƒ½æŒ‡æ ‡æ”¶é›†
rabbitmqctl status | grep -E "(memory|disk)" > /var/log/rabbitmq_metrics_$(date +%Y%m%d).log
EOF
```

**æ¯å‘¨ä»»åŠ¡**ï¼š
```bash
# æ¯å‘¨æ·±åº¦æ£€æŸ¥
weekly_deep_check() {
    echo "=== æ¯å‘¨æ·±åº¦æ£€æŸ¥ ==="
    
    # 1. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
    echo "æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§..."
    ./check_consistency.sh > /var/log/weekly_consistency_$(date +%Y%m%d).log
    
    # 2. æ€§èƒ½åŸºå‡†æµ‹è¯•
    echo "æ‰§è¡Œæ€§èƒ½æµ‹è¯•..."
    rabbitmq-perf-test -x 1 -y 1 -u test_queue -a > /var/log/weekly_performance_$(date +%Y%m%d).log
    
    # 3. é…ç½®æ–‡ä»¶æ£€æŸ¥
    echo "æ£€æŸ¥é…ç½®æ–‡ä»¶..."
    for node in node1 node2 node3; do
        ssh $node "rabbitmqctl environment" > /var/log/config_${node}_$(date +%Y%m%d).log
    done
    
    # 4. æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
    echo "æ¸…ç†æœªä½¿ç”¨èµ„æº..."
    rabbitmqctl eval 'rabbit_amqqueue:delete_unused().'
}
```

### 7.3 å®¹é‡è§„åˆ’ä¸æ‰©å±•


**ğŸ“ˆ å®¹é‡è¯„ä¼°æ–¹æ³•**ï¼š
```
å®¹é‡è§„åˆ’æŒ‡æ ‡ï¼š
ğŸ”¸ æ¶ˆæ¯ååé‡å¢é•¿è¶‹åŠ¿
ğŸ”¸ å­˜å‚¨ç©ºé—´ä½¿ç”¨è¶‹åŠ¿
ğŸ”¸ ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µ
ğŸ”¸ CPUå’Œå†…å­˜ä½¿ç”¨è¶‹åŠ¿

è¯„ä¼°å…¬å¼ï¼š
æœªæ¥å®¹é‡éœ€æ±‚ = å½“å‰ä½¿ç”¨é‡ Ã— å¢é•¿ç‡ Ã— å®‰å…¨ç³»æ•°

ç¤ºä¾‹è®¡ç®—ï¼š
å½“å‰æ¶ˆæ¯é‡ï¼š10000 msg/s
æœˆå¢é•¿ç‡ï¼š20%
å®‰å…¨ç³»æ•°ï¼š1.5
6ä¸ªæœˆåéœ€æ±‚ï¼š10000 Ã— (1.2^6) Ã— 1.5 â‰ˆ 44590 msg/s
```

**ğŸš€ æ‰©å±•ç­–ç•¥è§„åˆ’**ï¼š
```bash
# æ‰©å±•å†³ç­–è„šæœ¬
capacity_planning() {
    echo "=== å®¹é‡è§„åˆ’åˆ†æ ==="
    
    # 1. å½“å‰è´Ÿè½½åˆ†æ
    CURRENT_LOAD=$(rabbitmqctl list_queues messages | awk '{sum += $2} END {print sum}')
    echo "å½“å‰æ€»æ¶ˆæ¯ç§¯å‹: $CURRENT_LOAD"
    
    # 2. æ€§èƒ½ç“¶é¢ˆè¯†åˆ«
    for node in node1 node2 node3; do
        CPU_USAGE=$(ssh $node "top -bn1 | grep 'Cpu(s)' | awk '{print \$2}' | cut -d% -f1")
        MEM_USAGE=$(ssh $node "free | grep Mem | awk '{printf \"%.1f\", \$3/\$2 * 100.0}'")
        echo "èŠ‚ç‚¹ $node: CPU ${CPU_USAGE}%, å†…å­˜ ${MEM_USAGE}%"
    done
    
    # 3. æ‰©å±•å»ºè®®
    if (( $(echo "$CPU_USAGE > 70" | bc -l) )); then
        echo "å»ºè®®: CPUä½¿ç”¨ç‡è¿‡é«˜ï¼Œè€ƒè™‘æ·»åŠ èŠ‚ç‚¹æˆ–ä¼˜åŒ–é…ç½®"
    fi
    
    if (( $(echo "$MEM_USAGE > 80" | bc -l) )); then
        echo "å»ºè®®: å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œè€ƒè™‘å¢åŠ å†…å­˜æˆ–ä¼˜åŒ–é˜Ÿåˆ—é…ç½®"
    fi
}
```

### 7.4 å¤‡ä»½ä¸æ¢å¤ç­–ç•¥


**ğŸ’¾ å¤‡ä»½ç­–ç•¥åˆ¶å®š**ï¼š
```bash
# å…¨é‡å¤‡ä»½è„šæœ¬
full_backup() {
    BACKUP_DIR="/backup/rabbitmq_$(date +%Y%m%d_%H%M%S)"
    mkdir -p $BACKUP_DIR
    
    echo "å¼€å§‹å…¨é‡å¤‡ä»½..."
    
    # 1. é…ç½®å¤‡ä»½
    rabbitmqctl export_definitions $BACKUP_DIR/definitions.json
    
    # 2. æ•°æ®ç›®å½•å¤‡ä»½
    systemctl stop rabbitmq-server
    tar -czf $BACKUP_DIR/mnesia_data.tar.gz /var/lib/rabbitmq/mnesia/
    systemctl start rabbitmq-server
    
    # 3. é…ç½®æ–‡ä»¶å¤‡ä»½
    cp -r /etc/rabbitmq $BACKUP_DIR/config
    
    # 4. åˆ›å»ºå¤‡ä»½ä¿¡æ¯æ–‡ä»¶
    cat > $BACKUP_DIR/backup_info.txt << EOF
å¤‡ä»½æ—¶é—´: $(date)
RabbitMQç‰ˆæœ¬: $(rabbitmqctl version)
é›†ç¾¤çŠ¶æ€: $(rabbitmqctl cluster_status)
å¤‡ä»½ç±»å‹: å…¨é‡å¤‡ä»½
EOF
    
    echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
}

# å¢é‡å¤‡ä»½è„šæœ¬ï¼ˆé’ˆå¯¹é…ç½®å˜æ›´ï¼‰
incremental_backup() {
    BACKUP_DIR="/backup/incremental_$(date +%Y%m%d_%H%M%S)"
    mkdir -p $BACKUP_DIR
    
    # åªå¤‡ä»½é…ç½®å’Œå…ƒæ•°æ®
    rabbitmqctl export_definitions $BACKUP_DIR/definitions.json
    
    echo "å¢é‡å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
}
```

**ğŸ”„ æ¢å¤æµ‹è¯•æµç¨‹**ï¼š
```
æ¢å¤æµ‹è¯•è®¡åˆ’ï¼š
â€¢ æ¯æœˆè¿›è¡Œä¸€æ¬¡æ¢å¤æµ‹è¯•
â€¢ åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ¨¡æ‹Ÿå®Œæ•´æ¢å¤æµç¨‹
â€¢ éªŒè¯æ¢å¤åçš„æ•°æ®å®Œæ•´æ€§
â€¢ æµ‹è¯•æ¢å¤æ—¶é—´æ˜¯å¦ç¬¦åˆRTOè¦æ±‚

æ¢å¤éªŒè¯é¡¹ç›®ï¼š
âœ… æ‰€æœ‰é˜Ÿåˆ—éƒ½èƒ½æ­£å¸¸åˆ›å»º
âœ… æ¶ˆæ¯è·¯ç”±åŠŸèƒ½æ­£å¸¸
âœ… ç”¨æˆ·æƒé™å®Œå…¨æ¢å¤
âœ… ç›‘æ§ç³»ç»Ÿèƒ½æ­£å¸¸è¿æ¥
âœ… åº”ç”¨ç³»ç»Ÿèƒ½æ­£å¸¸ä½¿ç”¨
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ•…éšœå¤„ç†æŠ€èƒ½


```
ğŸ”¸ æ•…éšœè¯Šæ–­ï¼šå¿«é€Ÿè¯†åˆ«é—®é¢˜ç±»å‹å’Œå½±å“èŒƒå›´
ğŸ”¸ èŠ‚ç‚¹æ¢å¤ï¼šæŒæ¡å„ç§èŠ‚ç‚¹æ•…éšœçš„æ¢å¤æ–¹æ³•
ğŸ”¸ ç½‘ç»œåˆ†åŒºï¼šç†è§£åˆ†åŒºåŸç†å’Œä¸åŒå¤„ç†ç­–ç•¥
ğŸ”¸ è„‘è£‚å¤„ç†ï¼šèƒ½å¤Ÿæ­£ç¡®é€‰æ‹©æƒå¨åˆ†åŒºå¹¶å®‰å…¨æ¢å¤
ğŸ”¸ æ•°æ®ä¿®å¤ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œå®Œæ•´æ€§
ğŸ”¸ åˆ‡æ¢æµ‹è¯•ï¼šå®šæœŸéªŒè¯æ•…éšœæ¢å¤æµç¨‹æœ‰æ•ˆæ€§
ğŸ”¸ é¢„é˜²ç»´æŠ¤ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œç»´æŠ¤ä½“ç³»
```

### 8.2 æ•…éšœå¤„ç†çš„æ ¸å¿ƒæ€è·¯


**ğŸ”¹ å¤„ç†ä¼˜å…ˆçº§**ï¼š
```
ç´§æ€¥ç¨‹åº¦æ’åºï¼š
1. å½±å“ä¸šåŠ¡çš„é›†ç¾¤ä¸å¯ç”¨ â†’ ç«‹å³æ¢å¤æœåŠ¡
2. æ•°æ®ä¸ä¸€è‡´é—®é¢˜ â†’ ç¡®ä¿æ•°æ®æ­£ç¡®æ€§
3. å•èŠ‚ç‚¹æ•…éšœ â†’ æ¢å¤é›†ç¾¤å®Œæ•´æ€§
4. æ€§èƒ½é—®é¢˜ â†’ ä¼˜åŒ–ç³»ç»Ÿè¡¨ç°

å¤„ç†åŸåˆ™ï¼š
â€¢ å…ˆæ¢å¤æœåŠ¡ï¼Œå†å®Œå–„æ•°æ®
â€¢ å…ˆå¤„ç†å½±å“å¤§çš„ï¼Œå†å¤„ç†å½±å“å°çš„
â€¢ å…ˆç”¨ç®€å•æ–¹æ³•ï¼Œå†å°è¯•å¤æ‚æ–¹æ¡ˆ
â€¢ æ¯ä¸€æ­¥éƒ½è¦æœ‰å›é€€æ–¹æ¡ˆ
```

**ğŸ”¹ æ•…éšœé¢„é˜²èƒœäºæ²»ç–—**ï¼š
```
é¢„é˜²æªæ–½é‡è¦æ€§ï¼š
â€¢ å®Œå–„çš„ç›‘æ§ç³»ç»Ÿèƒ½æå‰å‘ç°é—®é¢˜
â€¢ å®šæœŸçš„æ•…éšœæ¼”ç»ƒèƒ½å‡å°‘æ¢å¤æ—¶é—´
â€¢ è‰¯å¥½çš„å¤‡ä»½ç­–ç•¥èƒ½é™ä½æ•°æ®ä¸¢å¤±é£é™©
â€¢ åˆç†çš„æ¶æ„è®¾è®¡èƒ½é¿å…å•ç‚¹æ•…éšœ

æŠ•å…¥äº§å‡ºæ¯”ï¼š
â€¢ é¢„é˜²æŠ•å…¥ï¼š10åˆ†åŠªåŠ›
â€¢ æ•…éšœæŸå¤±ï¼š100åˆ†æŸå¤±
â€¢ æ˜æ™ºé€‰æ‹©ï¼šé‡è§†é¢„é˜²
```

### 8.3 å®é™…æ“ä½œç»éªŒæ€»ç»“


**ğŸ’¼ è¿ç»´æœ€ä½³å®è·µ**ï¼š
```
æ—¥å¸¸å·¥ä½œä¹ æƒ¯ï¼š
âœ… æ¯å¤©æ£€æŸ¥é›†ç¾¤çŠ¶æ€å’Œå…³é”®æŒ‡æ ‡
âœ… åŠæ—¶å¤„ç†å‘Šè­¦ï¼Œä¸è¦ç§¯å‹é—®é¢˜
âœ… å®šæœŸæ›´æ–°æ–‡æ¡£ï¼Œè®°å½•å¤„ç†ç»éªŒ
âœ… ä¿æŒå·¥å…·å’Œè„šæœ¬çš„æ›´æ–°

ç´§æ€¥å¤„ç†åŸåˆ™ï¼š
âœ… å†·é™åˆ†æï¼Œä¸è¦æ€¥äºæ“ä½œ
âœ… å…ˆå¤‡ä»½å†æ“ä½œï¼Œç¡®ä¿å¯ä»¥å›é€€
âœ… é€æ­¥å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§å¤§åŠ¨ä½œ
âœ… åŠæ—¶æ²Ÿé€šï¼Œè®©å›¢é˜Ÿäº†è§£è¿›å±•

æŠ€èƒ½æå‡å»ºè®®ï¼š
âœ… æ·±å…¥ç†è§£RabbitMQå†…éƒ¨æœºåˆ¶
âœ… ç†Ÿç»ƒæŒæ¡Linuxç³»ç»Ÿç®¡ç†
âœ… å­¦ä¹ è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·
âœ… å…³æ³¨ç¤¾åŒºæœ€ä½³å®è·µåˆ†äº«
```

**ğŸ¯ æ•…éšœå¤„ç†æˆåŠŸè¦ç´ **ï¼š
```
æŠ€æœ¯èƒ½åŠ›ï¼š
â€¢ æ‰å®çš„åŸºç¡€çŸ¥è¯†
â€¢ ä¸°å¯Œçš„å®è·µç»éªŒ
â€¢ å¿«é€Ÿçš„å­¦ä¹ èƒ½åŠ›

å·¥å…·å‡†å¤‡ï¼š
â€¢ å®Œå–„çš„ç›‘æ§ç³»ç»Ÿ
â€¢ è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬
â€¢ è¯¦ç»†çš„æ–‡æ¡£èµ„æ–™

å›¢é˜Ÿåä½œï¼š
â€¢ æ¸…æ™°çš„åˆ†å·¥æœºåˆ¶
â€¢ é«˜æ•ˆçš„æ²Ÿé€šæ¸ é“
â€¢ å®Œå–„çš„å‡çº§æµç¨‹
```

### 8.4 æŒç»­æ”¹è¿›å»ºè®®


**ğŸ“ˆ èƒ½åŠ›æå‡è·¯å¾„**ï¼š
```
é˜¶æ®µä¸€ï¼šåŸºç¡€æŒæ¡
â€¢ ç†Ÿç»ƒä½¿ç”¨rabbitmqctlå‘½ä»¤
â€¢ ç†è§£é›†ç¾¤åŸºæœ¬æ¦‚å¿µ
â€¢ èƒ½å¤„ç†å¸¸è§å•èŠ‚ç‚¹æ•…éšœ

é˜¶æ®µäºŒï¼šè¿›é˜¶åº”ç”¨
â€¢ æŒæ¡ç½‘ç»œåˆ†åŒºå¤„ç†
â€¢ èƒ½å¤Ÿè¿›è¡Œæ•°æ®æ¢å¤
â€¢ å»ºç«‹ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

é˜¶æ®µä¸‰ï¼šä¸“å®¶æ°´å¹³
â€¢ èƒ½å¤„ç†å¤æ‚çš„è„‘è£‚é—®é¢˜
â€¢ è®¾è®¡é«˜å¯ç”¨æ¶æ„
â€¢ æŒ‡å¯¼å›¢é˜Ÿè¿›è¡Œæ•…éšœæ¼”ç»ƒ

æŒç»­å­¦ä¹ ï¼š
â€¢ å…³æ³¨RabbitMQæ–°ç‰ˆæœ¬ç‰¹æ€§
â€¢ å­¦ä¹ ç›¸å…³çš„è¿ç»´å·¥å…·
â€¢ å‚ä¸ç¤¾åŒºè®¨è®ºå’Œåˆ†äº«
```

**ğŸ”„ æµç¨‹ä¼˜åŒ–æ–¹å‘**ï¼š
```
è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼š
â€¢ æ•…éšœæ£€æµ‹è‡ªåŠ¨åŒ–
â€¢ å¸¸è§é—®é¢˜è‡ªåŠ¨ä¿®å¤
â€¢ æŠ¥å‘Šç”Ÿæˆè‡ªåŠ¨åŒ–

å“åº”é€Ÿåº¦ï¼š
â€¢ ç¼©çŸ­æ•…éšœæ£€æµ‹æ—¶é—´
â€¢ ç®€åŒ–å¤„ç†æµç¨‹
â€¢ æé«˜å›¢é˜Ÿç†Ÿç»ƒåº¦

å¯é æ€§ä¿è¯ï¼š
â€¢ å®Œå–„çš„æµ‹è¯•è¦†ç›–
â€¢ å¤šé‡éªŒè¯æœºåˆ¶
â€¢ é£é™©è¯„ä¼°ä½“ç³»
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- æ•…éšœå¤„ç†è¦å†·é™åˆ†æï¼Œå…ˆæ¢å¤æœåŠ¡å†å®Œå–„æ•°æ®
- ç½‘ç»œåˆ†åŒºç”¨autohealæ¨¡å¼ï¼Œè„‘è£‚é—®é¢˜é€‰æƒå¨åˆ†åŒº
- æ•°æ®ä¿®å¤è¦éªŒè¯ä¸€è‡´æ€§ï¼Œå®šæœŸæµ‹è¯•åˆ‡æ¢æµç¨‹
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œç›‘æ§å‘Šè­¦æ˜¯ç¬¬ä¸€é“é˜²çº¿
- æŒç»­å­¦ä¹ æ–°æŠ€æœ¯ï¼Œä¸æ–­ä¼˜åŒ–å¤„ç†æµç¨‹

**æ ¸å¿ƒç†å¿µ**ï¼šæ•…éšœä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯æ²¡æœ‰å‡†å¤‡ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„å­¦ä¹ å’Œå®è·µï¼Œä»»ä½•RabbitMQé›†ç¾¤æ•…éšœéƒ½èƒ½å¾—åˆ°å¦¥å–„å¤„ç†ï¼