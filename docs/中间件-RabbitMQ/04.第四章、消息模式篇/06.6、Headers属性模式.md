---
title: 6ã€Headerså±æ€§æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [Headersäº¤æ¢æœºåŸºç¡€æ¦‚å¿µ](#1-Headersäº¤æ¢æœºåŸºç¡€æ¦‚å¿µ)
2. [å±æ€§åŒ¹é…è§„åˆ™è¯¦è§£](#2-å±æ€§åŒ¹é…è§„åˆ™è¯¦è§£)
3. [x-matchå‚æ•°æœºåˆ¶](#3-x-matchå‚æ•°æœºåˆ¶)
4. [å¤æ‚æ¡ä»¶è·¯ç”±å®è·µ](#4-å¤æ‚æ¡ä»¶è·¯ç”±å®è·µ)
5. [ç‰¹æ®Šåœºæ™¯åº”ç”¨](#5-ç‰¹æ®Šåœºæ™¯åº”ç”¨)
6. [ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”](#6-ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”)
7. [æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹](#7-æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Headersäº¤æ¢æœºåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Headersäº¤æ¢æœº


**Headersäº¤æ¢æœºå°±åƒä¸€ä¸ªæ™ºèƒ½å¿«é€’åˆ†æ‹£å‘˜**ï¼Œå®ƒä¸çœ‹åŒ…è£¹ä¸Šçš„åœ°å€æ ‡ç­¾ï¼ˆrouting keyï¼‰ï¼Œè€Œæ˜¯æ‰“å¼€åŒ…è£¹æ£€æŸ¥é‡Œé¢çš„**è¯¦ç»†ä¿¡æ¯æ ‡ç­¾**ï¼ˆheadersï¼‰ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯æ¥å†³å®šæŠŠåŒ…è£¹é€åˆ°å“ªé‡Œã€‚

```
ä¼ ç»Ÿé‚®å¯„æ–¹å¼ï¼š                    Headersäº¤æ¢æœºæ–¹å¼ï¼š
çœ‹ä¿¡å°åœ°å€ â†’ æŠ•é€’                 çœ‹ä¿¡ä»¶å†…å®¹å±æ€§ â†’ æŠ•é€’
                                
æ™®é€šå¿«é€’ï¼š                        æ™ºèƒ½åˆ†æ‹£ï¼š
routing key: "beijing"          headers: {
â†“                                city: "beijing",
æŠ•é€’åˆ°åŒ—äº¬                        priority: "urgent",
                                type: "document"
                               }
                               â†“
                               æ ¹æ®å¤šä¸ªæ¡ä»¶æ™ºèƒ½åˆ†æ‹£
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**
- **å¿½ç•¥routing key**ï¼šä¸å…³å¿ƒæ¶ˆæ¯çš„è·¯ç”±é”®æ˜¯ä»€ä¹ˆ
- **åŸºäºå±æ€§åŒ¹é…**ï¼šæ ¹æ®æ¶ˆæ¯å¤´éƒ¨çš„å¤šä¸ªå±æ€§è¿›è¡Œè·¯ç”±
- **æ”¯æŒå¤æ‚æ¡ä»¶**ï¼šå¯ä»¥è®¾ç½®"å¿…é¡»æ»¡è¶³æ‰€æœ‰æ¡ä»¶"æˆ–"æ»¡è¶³ä»»ä¸€æ¡ä»¶"
- **çµæ´»æ€§æœ€é«˜**ï¼šå››ç§äº¤æ¢æœºç±»å‹ä¸­æœ€çµæ´»çš„ä¸€ç§

### 1.2 Headersäº¤æ¢æœºçš„å·¥ä½œåŸç†


```
æ¶ˆæ¯å‘é€æµç¨‹å›¾ï¼š

å‘é€è€…                    Headersäº¤æ¢æœº                é˜Ÿåˆ—ç»‘å®š
  |                          |                        |
  |-- å‘é€æ¶ˆæ¯ -------------->|                        |
  |   headers: {             |                        |
  |     format: "json",      |-- æ£€æŸ¥å±æ€§åŒ¹é… -------->| é˜Ÿåˆ—Aç»‘å®šæ¡ä»¶ï¼š
  |     priority: "high"     |                        | format: "json"
  |   }                      |                        | x-match: "any"
  |                          |                        |
  |                          |-- åŒ¹é…æˆåŠŸ ----------->| é˜Ÿåˆ—Bç»‘å®šæ¡ä»¶ï¼š
  |                          |                        | priority: "high"
  |                          |                        | urgent: true
  |                          |                        | x-match: "all"
```

**å·¥ä½œæ­¥éª¤è§£æ**ï¼š
1. **æ¥æ”¶æ¶ˆæ¯**ï¼šHeadersäº¤æ¢æœºæ”¶åˆ°å¸¦æœ‰å±æ€§çš„æ¶ˆæ¯
2. **æå–å±æ€§**ï¼šä»æ¶ˆæ¯å¤´éƒ¨æå–æ‰€æœ‰çš„key-valueå±æ€§å¯¹
3. **éå†ç»‘å®š**ï¼šæ£€æŸ¥æ¯ä¸ªé˜Ÿåˆ—çš„ç»‘å®šæ¡ä»¶
4. **å±æ€§åŒ¹é…**ï¼šæ ¹æ®x-matchè§„åˆ™è¿›è¡Œå±æ€§åŒ¹é…
5. **è·¯ç”±æŠ•é€’**ï¼šåŒ¹é…æˆåŠŸåˆ™æŠ•é€’åˆ°å¯¹åº”é˜Ÿåˆ—

### 1.3 ä¸ç”Ÿæ´»åœºæ™¯çš„ç±»æ¯”


**ğŸª æƒ³è±¡ä¸€ä¸ªæ™ºèƒ½è¶…å¸‚çš„å•†å“åˆ†æ‹£ç³»ç»Ÿ**ï¼š

```
å•†å“å±æ€§ï¼š                     åˆ†æ‹£è§„åˆ™ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•†å“: è‹¹æœ       â”‚           â”‚ è´§æ¶Aæ¡ä»¶ï¼š      â”‚
â”‚ ç±»å‹: æ°´æœ       â”‚    â”€â”€â”€â”€â”€> â”‚ ç±»å‹=æ°´æœ AND    â”‚
â”‚ äº§åœ°: æ–°ç–†       â”‚           â”‚ äº§åœ°=æ–°ç–†        â”‚
â”‚ ç­‰çº§: ç‰¹çº§       â”‚           â”‚ x-match=all     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¦‚æœå•†å“åŒæ—¶æ»¡è¶³"ç±»å‹=æ°´æœ"å’Œ"äº§åœ°=æ–°ç–†"ï¼Œå°±æ”¾åˆ°è´§æ¶A
å¦‚æœåªè¦æ»¡è¶³å…¶ä¸­ä¸€ä¸ªæ¡ä»¶ï¼Œå°±ç”¨x-match=any
```

---

## 2. ğŸ” å±æ€§åŒ¹é…è§„åˆ™è¯¦è§£


### 2.1 æ¶ˆæ¯å±æ€§çš„ç»„æˆ


åœ¨RabbitMQä¸­ï¼Œæ¶ˆæ¯çš„å±æ€§ï¼ˆheadersï¼‰æ˜¯ä¸€ä¸ª**é”®å€¼å¯¹é›†åˆ**ï¼Œå°±åƒç»™æ¯ä¸ªåŒ…è£¹è´´ä¸Šäº†å¤šå¼ ä¸åŒçš„æ ‡ç­¾ã€‚

```
æ¶ˆæ¯å±æ€§ç¤ºä¾‹ï¼š
{
  "content-type": "application/json",     // å†…å®¹ç±»å‹
  "priority": "high",                     // ä¼˜å…ˆçº§
  "department": "sales",                  // éƒ¨é—¨
  "region": "asia",                       // åœ°åŒº
  "encrypted": true,                      // æ˜¯å¦åŠ å¯†
  "file-size": "large"                    // æ–‡ä»¶å¤§å°
}
```

**ğŸ”¸ å±æ€§çš„ç‰¹ç‚¹**
- **é”®å€¼å¯¹å½¢å¼**ï¼šæ¯ä¸ªå±æ€§éƒ½æœ‰åç§°å’Œå€¼
- **ç±»å‹ä¸°å¯Œ**ï¼šæ”¯æŒå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰
- **è‡ªå®šä¹‰çµæ´»**ï¼šå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦å®šä¹‰ä»»æ„å±æ€§
- **å¤šé‡æ ‡ç­¾**ï¼šä¸€ä¸ªæ¶ˆæ¯å¯ä»¥æœ‰å¤šä¸ªå±æ€§æ ‡ç­¾

### 2.2 é˜Ÿåˆ—ç»‘å®šæ¡ä»¶è®¾ç½®


é˜Ÿåˆ—ç»‘å®šåˆ°Headersäº¤æ¢æœºæ—¶ï¼Œéœ€è¦æŒ‡å®š**åŒ¹é…æ¡ä»¶**ï¼Œå°±åƒè®¾ç½®ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚

```
é˜Ÿåˆ—ç»‘å®šæ¡ä»¶ç¤ºä¾‹ï¼š

é˜Ÿåˆ—Açš„ç»‘å®šæ¡ä»¶ï¼š
{
  "department": "sales",        // å¿…é¡»æ˜¯é”€å”®éƒ¨é—¨
  "priority": "high",          // å¿…é¡»æ˜¯é«˜ä¼˜å…ˆçº§
  "x-match": "all"            // å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸Šæ‰€æœ‰æ¡ä»¶
}

é˜Ÿåˆ—Bçš„ç»‘å®šæ¡ä»¶ï¼š
{
  "region": "asia",           // äºšæ´²åœ°åŒº
  "region": "europe",         // æˆ–è€…æ¬§æ´²åœ°åŒº
  "x-match": "any"           // æ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯
}
```

### 2.3 å±æ€§åŒ¹é…çš„åˆ¤æ–­é€»è¾‘


**ğŸ¯ åŒ¹é…åˆ¤æ–­æµç¨‹**ï¼š

```
å±æ€§åŒ¹é…åˆ¤æ–­æµç¨‹ï¼š

æ¶ˆæ¯å±æ€§: {department: "sales", priority: "high", region: "asia"}
         |
         â†“
ç»‘å®šæ¡ä»¶: {department: "sales", priority: "high", x-match: "all"}
         |
         â†“
é€ä¸ªæ£€æŸ¥: department âœ“  priority âœ“  (éƒ½åŒ¹é…)
         |
         â†“
x-match=all: æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ â†’ åŒ¹é…æˆåŠŸ âœ“
```

**åŒ¹é…è§„åˆ™æ€»ç»“**ï¼š
- **å®Œå…¨åŒ¹é…**ï¼šå±æ€§åå’Œå±æ€§å€¼éƒ½å¿…é¡»å®Œå…¨ç›¸åŒ
- **ç±»å‹æ•æ„Ÿ**ï¼šå­—ç¬¦ä¸²"123"å’Œæ•°å­—123æ˜¯ä¸åŒçš„
- **å¤§å°å†™æ•æ„Ÿ**ï¼š"Sales"å’Œ"sales"æ˜¯ä¸åŒçš„
- **ä¸å­˜åœ¨è§†ä¸ºä¸åŒ¹é…**ï¼šæ¶ˆæ¯ä¸­æ²¡æœ‰çš„å±æ€§è§†ä¸ºä¸åŒ¹é…

---

## 3. âš™ï¸ x-matchå‚æ•°æœºåˆ¶


### 3.1 x-matchå‚æ•°çš„ä½œç”¨


`x-match`æ˜¯Headersäº¤æ¢æœºçš„**æ ¸å¿ƒå‚æ•°**ï¼Œå®ƒå†³å®šäº†å¤šä¸ªå±æ€§æ¡ä»¶ä¹‹é—´æ˜¯"**å¹¶ä¸”**"çš„å…³ç³»è¿˜æ˜¯"**æˆ–è€…**"çš„å…³ç³»ã€‚

```
x-matchå‚æ•°å¯¹æ¯”ï¼š

x-match: "all" (å¹¶ä¸”å…³ç³»)          x-match: "any" (æˆ–è€…å…³ç³»)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¡ä»¶A: éƒ¨é—¨=é”€å”®  â”‚               â”‚ æ¡ä»¶A: éƒ¨é—¨=é”€å”®  â”‚
â”‚       AND       â”‚               â”‚       OR        â”‚
â”‚ æ¡ä»¶B: çº§åˆ«=é«˜çº§  â”‚               â”‚ æ¡ä»¶B: çº§åˆ«=é«˜çº§  â”‚
â”‚       AND       â”‚               â”‚       OR        â”‚
â”‚ æ¡ä»¶C: åœ°åŒº=åŒ—äº¬  â”‚               â”‚ æ¡ä»¶C: åœ°åŒº=åŒ—äº¬  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å¿…é¡»å…¨éƒ¨æ»¡è¶³æ‰åŒ¹é…                   æ»¡è¶³ä»»æ„ä¸€ä¸ªå°±åŒ¹é…
```

### 3.2 x-match: "all" è¯¦è§£


å½“è®¾ç½®`x-match: "all"`æ—¶ï¼Œæ¶ˆæ¯å¿…é¡»**åŒæ—¶æ»¡è¶³**ç»‘å®šæ¡ä»¶ä¸­çš„**æ‰€æœ‰**å±æ€§è¦æ±‚ã€‚

**ğŸ”¸ å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š

> **åœºæ™¯**ï¼šVIPå®¢æˆ·è®¢å•å¤„ç†é˜Ÿåˆ—
> 
> **è¦æ±‚**ï¼šåªæœ‰åŒæ—¶æ»¡è¶³"å®¢æˆ·ç­‰çº§=VIP"ã€"è®¢å•é‡‘é¢=é«˜"ã€"åœ°åŒº=ä¸€çº¿åŸå¸‚"çš„è®¢å•æ‰è¿›å…¥æ­¤é˜Ÿåˆ—

```java
// é˜Ÿåˆ—ç»‘å®šæ¡ä»¶
Map<String, Object> bindingArgs = new HashMap<>();
bindingArgs.put("customer-level", "VIP");
bindingArgs.put("order-amount", "high");
bindingArgs.put("city-tier", "tier1");
bindingArgs.put("x-match", "all");  // å¿…é¡»å…¨éƒ¨æ»¡è¶³

// åŒ¹é…çš„æ¶ˆæ¯
headers: {
  "customer-level": "VIP",     âœ“
  "order-amount": "high",      âœ“  
  "city-tier": "tier1",        âœ“
  "payment-method": "credit"   // é¢å¤–å±æ€§ä¸å½±å“åŒ¹é…
}
â†’ åŒ¹é…æˆåŠŸï¼Œå› ä¸ºæ‰€æœ‰å¿…éœ€æ¡ä»¶éƒ½æ»¡è¶³

// ä¸åŒ¹é…çš„æ¶ˆæ¯
headers: {
  "customer-level": "VIP",     âœ“
  "order-amount": "low",       âœ—  ä¸æ»¡è¶³æ¡ä»¶
  "city-tier": "tier1"         âœ“
}
â†’ åŒ¹é…å¤±è´¥ï¼Œå› ä¸ºorder-amountä¸ç¬¦åˆè¦æ±‚
```

### 3.3 x-match: "any" è¯¦è§£


å½“è®¾ç½®`x-match: "any"`æ—¶ï¼Œæ¶ˆæ¯åªè¦æ»¡è¶³ç»‘å®šæ¡ä»¶ä¸­çš„**ä»»æ„ä¸€ä¸ª**å±æ€§è¦æ±‚å°±å¯ä»¥åŒ¹é…ã€‚

**ğŸ”¸ å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š

> **åœºæ™¯**ï¼šç´§æ€¥é€šçŸ¥é˜Ÿåˆ—
> 
> **è¦æ±‚**ï¼šæ»¡è¶³"ä¼˜å…ˆçº§=ç´§æ€¥"æˆ–"ç±»å‹=è­¦æŠ¥"æˆ–"å‘é€è€…=ç³»ç»Ÿç®¡ç†å‘˜"ä¸­ä»»ä¸€æ¡ä»¶çš„æ¶ˆæ¯éƒ½è¦å¤„ç†

```java
// é˜Ÿåˆ—ç»‘å®šæ¡ä»¶  
Map<String, Object> bindingArgs = new HashMap<>();
bindingArgs.put("priority", "urgent");
bindingArgs.put("type", "alert");
bindingArgs.put("sender", "admin");
bindingArgs.put("x-match", "any");  // æ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯

// åŒ¹é…çš„æ¶ˆæ¯1
headers: {
  "priority": "urgent",        âœ“  æ»¡è¶³æ¡ä»¶
  "department": "IT",
  "timestamp": "2024-01-01"
}
â†’ åŒ¹é…æˆåŠŸï¼Œå› ä¸ºä¼˜å…ˆçº§æ˜¯ç´§æ€¥

// åŒ¹é…çš„æ¶ˆæ¯2  
headers: {
  "priority": "normal",
  "type": "alert",             âœ“  æ»¡è¶³æ¡ä»¶
  "region": "beijing"
}
â†’ åŒ¹é…æˆåŠŸï¼Œå› ä¸ºç±»å‹æ˜¯è­¦æŠ¥

// ä¸åŒ¹é…çš„æ¶ˆæ¯
headers: {
  "priority": "low",           âœ—
  "type": "info",              âœ—  
  "sender": "user"             âœ—
}
â†’ åŒ¹é…å¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•æ¡ä»¶æ»¡è¶³
```

### 3.4 x-matchå‚æ•°çš„é€‰æ‹©ç­–ç•¥


| ä½¿ç”¨åœºæ™¯ | **æ¨èx-match** | **åŸå› è¯´æ˜** |
|---------|----------------|-------------|
| ğŸ¯ **ç²¾ç¡®ç­›é€‰** | `all` | `éœ€è¦åŒæ—¶æ»¡è¶³å¤šä¸ªä¸¥æ ¼æ¡ä»¶` |
| ğŸ” **å®½æ¾è¿‡æ»¤** | `any` | `æ»¡è¶³éƒ¨åˆ†æ¡ä»¶å³å¯å¤„ç†` |
| ğŸš¨ **ç´§æ€¥å¤„ç†** | `any` | `å¤šç§ç´§æ€¥æƒ…å†µéƒ½è¦å“åº”` |
| ğŸ“Š **æ•°æ®åˆ†æ** | `all` | `éœ€è¦å®Œæ•´çš„æ•°æ®å±æ€§` |
| ğŸ“¢ **å¹¿æ’­é€šçŸ¥** | `any` | `å¤šç§è§¦å‘æ¡ä»¶éƒ½è¦é€šçŸ¥` |

---

## 4. ğŸ› ï¸ å¤æ‚æ¡ä»¶è·¯ç”±å®è·µ


### 4.1 å¤šç»´åº¦è®¢å•åˆ†å‘ç³»ç»Ÿ


è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª**ç”µå•†è®¢å•åˆ†å‘ç³»ç»Ÿ**æ¥ç†è§£Headersäº¤æ¢æœºåœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸­çš„åº”ç”¨ã€‚

```
ä¸šåŠ¡éœ€æ±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”µå•†å¹³å°éœ€è¦æ ¹æ®è®¢å•çš„å¤šä¸ªå±æ€§å°†è®¢å•åˆ†å‘åˆ°ä¸åŒçš„å¤„ç†é˜Ÿåˆ—ï¼š      â”‚
â”‚                                                             â”‚
â”‚ â€¢ VIPè®¢å•é˜Ÿåˆ—ï¼šVIPå®¢æˆ· + é«˜é‡‘é¢è®¢å•                          â”‚
â”‚ â€¢ æµ·å¤–è®¢å•é˜Ÿåˆ—ï¼šé…é€åœ°å€åœ¨æµ·å¤–                               â”‚  
â”‚ â€¢ ç´§æ€¥å¤„ç†é˜Ÿåˆ—ï¼šå½“æ—¥è¾¾ æˆ– åŠ æ€¥å¤„ç† æˆ– å®¢æˆ·æŠ•è¯‰                â”‚
â”‚ â€¢ æ™®é€šå¤„ç†é˜Ÿåˆ—ï¼šå…¶ä»–æ‰€æœ‰è®¢å•                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç³»ç»Ÿæ¶æ„è®¾è®¡


```
è®¢å•å¤„ç†ç³»ç»Ÿæ¶æ„ï¼š

è®¢å•æœåŠ¡                Headersäº¤æ¢æœº              å¤„ç†é˜Ÿåˆ—
   â”‚                        â”‚                      â”‚
   â”‚-- å‘é€è®¢å•æ¶ˆæ¯ -------->â”‚                      â”‚
   â”‚   headers: {           â”‚                      â”‚
   â”‚     customer: "VIP",   â”‚-- å±æ€§è·¯ç”± --------->â”‚ VIPè®¢å•é˜Ÿåˆ—
   â”‚     amount: "high",    â”‚                      â”‚
   â”‚     region: "domestic",â”‚-- å±æ€§è·¯ç”± --------->â”‚ æµ·å¤–è®¢å•é˜Ÿåˆ—  
   â”‚     delivery: "normal", â”‚                      â”‚
   â”‚     urgent: false      â”‚-- å±æ€§è·¯ç”± --------->â”‚ ç´§æ€¥å¤„ç†é˜Ÿåˆ—
   â”‚   }                    â”‚                      â”‚
   â”‚                        â”‚-- é»˜è®¤è·¯ç”± --------->â”‚ æ™®é€šå¤„ç†é˜Ÿåˆ—
```

### 4.3 ä»£ç å®ç°ç¤ºä¾‹


```java
// 1. åˆ›å»ºHeadersäº¤æ¢æœº
channel.exchangeDeclare("order.headers", "headers", true);

// 2. åˆ›å»ºVIPè®¢å•é˜Ÿåˆ—ï¼ˆå¿…é¡»åŒæ—¶æ»¡è¶³VIPå®¢æˆ·å’Œé«˜é‡‘é¢ï¼‰
channel.queueDeclare("vip.orders", true, false, false, null);
Map<String, Object> vipBinding = new HashMap<>();
vipBinding.put("customer-type", "VIP");
vipBinding.put("order-amount", "high");
vipBinding.put("x-match", "all");  // å¿…é¡»éƒ½æ»¡è¶³
channel.queueBind("vip.orders", "order.headers", "", vipBinding);

// 3. åˆ›å»ºæµ·å¤–è®¢å•é˜Ÿåˆ—
channel.queueDeclare("overseas.orders", true, false, false, null);
Map<String, Object> overseasBinding = new HashMap<>();
overseasBinding.put("shipping-region", "overseas");
overseasBinding.put("x-match", "any");  // æ»¡è¶³æµ·å¤–é…é€å³å¯
channel.queueBind("overseas.orders", "order.headers", "", overseasBinding);

// 4. åˆ›å»ºç´§æ€¥å¤„ç†é˜Ÿåˆ—ï¼ˆæ»¡è¶³ä»»ä¸€ç´§æ€¥æ¡ä»¶ï¼‰
channel.queueDeclare("urgent.orders", true, false, false, null);
Map<String, Object> urgentBinding = new HashMap<>();
urgentBinding.put("delivery-speed", "same-day");    // å½“æ—¥è¾¾
urgentBinding.put("process-type", "expedited");     // åŠ æ€¥å¤„ç†
urgentBinding.put("customer-complaint", "true");   // å®¢æˆ·æŠ•è¯‰
urgentBinding.put("x-match", "any");  // æ»¡è¶³ä»»ä¸€æ¡ä»¶
channel.queueBind("urgent.orders", "order.headers", "", urgentBinding);
```

### 4.4 æ¶ˆæ¯å‘é€ä¸è·¯ç”±æµ‹è¯•


```java
// å‘é€VIPé«˜é‡‘é¢è®¢å•
Map<String, Object> vipHeaders = new HashMap<>();
vipHeaders.put("customer-type", "VIP");
vipHeaders.put("order-amount", "high");
vipHeaders.put("shipping-region", "domestic");
vipHeaders.put("delivery-speed", "standard");

AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()
    .headers(vipHeaders)
    .build();

channel.basicPublish("order.headers", "", props, "VIPè®¢å•å†…å®¹".getBytes());
// â†’ è·¯ç”±åˆ°ï¼švip.orders é˜Ÿåˆ—

// å‘é€ç´§æ€¥å¤„ç†è®¢å•
Map<String, Object> urgentHeaders = new HashMap<>();
urgentHeaders.put("customer-type", "Regular");
urgentHeaders.put("order-amount", "medium");  
urgentHeaders.put("delivery-speed", "same-day");  // æ»¡è¶³ç´§æ€¥æ¡ä»¶
urgentHeaders.put("shipping-region", "domestic");

AMQP.BasicProperties urgentProps = new AMQP.BasicProperties.Builder()
    .headers(urgentHeaders)
    .build();

channel.basicPublish("order.headers", "", urgentProps, "åŠ æ€¥è®¢å•å†…å®¹".getBytes());
// â†’ è·¯ç”±åˆ°ï¼šurgent.orders é˜Ÿåˆ—
```

**ğŸ“Š è·¯ç”±ç»“æœåˆ†æ**ï¼š

| æ¶ˆæ¯å±æ€§ | **VIPé˜Ÿåˆ—** | **æµ·å¤–é˜Ÿåˆ—** | **ç´§æ€¥é˜Ÿåˆ—** | **åŒ¹é…è¯´æ˜** |
|---------|------------|-------------|-------------|-------------|
| `VIP+é«˜é‡‘é¢+å›½å†…+æ ‡å‡†` | âœ… | âŒ | âŒ | `æ»¡è¶³VIPé˜Ÿåˆ—çš„allæ¡ä»¶` |
| `æ™®é€š+ä¸­ç­‰+æµ·å¤–+æ ‡å‡†` | âŒ | âœ… | âŒ | `æ»¡è¶³æµ·å¤–é˜Ÿåˆ—æ¡ä»¶` |
| `æ™®é€š+ä¸­ç­‰+å›½å†…+å½“æ—¥è¾¾` | âŒ | âŒ | âœ… | `æ»¡è¶³ç´§æ€¥é˜Ÿåˆ—çš„anyæ¡ä»¶` |
| `VIP+é«˜é‡‘é¢+æµ·å¤–+å½“æ—¥è¾¾` | âœ… | âœ… | âœ… | `åŒæ—¶æ»¡è¶³å¤šä¸ªé˜Ÿåˆ—æ¡ä»¶` |

---

## 5. ğŸŒŸ ç‰¹æ®Šåœºæ™¯åº”ç”¨


### 5.1 æ—¥å¿—åˆ†çº§å¤„ç†ç³»ç»Ÿ


Headersäº¤æ¢æœºç‰¹åˆ«é€‚åˆç”¨äº**æ—¥å¿—å¤„ç†ç³»ç»Ÿ**ï¼Œå› ä¸ºæ—¥å¿—é€šå¸¸æœ‰å¤šä¸ªç»´åº¦çš„å±æ€§ã€‚

```
æ—¥å¿—å¤„ç†éœ€æ±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿæ—¥å¿—æœ‰å¤šä¸ªå±æ€§ï¼š                         â”‚
â”‚ â€¢ level: ERROR/WARN/INFO/DEBUG              â”‚
â”‚ â€¢ service: user-service/order-service/...   â”‚
â”‚ â€¢ environment: prod/test/dev                â”‚
â”‚ â€¢ urgent: true/false                        â”‚
â”‚                                             â”‚
â”‚ ä¸åŒçš„æ—¥å¿—éœ€è¦å‘é€åˆ°ä¸åŒçš„å¤„ç†é˜Ÿåˆ—           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æ–¹æ¡ˆ**ï¼š

```java
// é”™è¯¯æ—¥å¿—é˜Ÿåˆ—ï¼šåªå¤„ç†ERRORçº§åˆ«çš„ç”Ÿäº§ç¯å¢ƒæ—¥å¿—
Map<String, Object> errorBinding = new HashMap<>();
errorBinding.put("level", "ERROR");
errorBinding.put("environment", "prod");
errorBinding.put("x-match", "all");
channel.queueBind("error.logs", "log.headers", "", errorBinding);

// ç´§æ€¥é€šçŸ¥é˜Ÿåˆ—ï¼šä»»ä½•æ ‡è®°ä¸ºç´§æ€¥çš„æ—¥å¿—éƒ½è¦ç«‹å³é€šçŸ¥
Map<String, Object> alertBinding = new HashMap<>();
alertBinding.put("urgent", "true");
alertBinding.put("x-match", "any");
channel.queueBind("alert.notifications", "log.headers", "", alertBinding);

// æœåŠ¡ç›‘æ§é˜Ÿåˆ—ï¼šç‰¹å®šæœåŠ¡çš„æ‰€æœ‰çº§åˆ«æ—¥å¿—
Map<String, Object> serviceBinding = new HashMap<>();
serviceBinding.put("service", "payment-service");
serviceBinding.put("x-match", "any");
channel.queueBind("payment.monitor", "log.headers", "", serviceBinding);
```

### 5.2 æ™ºèƒ½æ¶ˆæ¯æ¨é€ç³»ç»Ÿ


**åœºæ™¯**ï¼šç§»åŠ¨Appçš„ä¸ªæ€§åŒ–æ¶ˆæ¯æ¨é€

```
ç”¨æˆ·ç”»åƒå±æ€§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ age-group: teen/young/middle/senior   â”‚
â”‚ â€¢ interests: sports/tech/fashion/food   â”‚
â”‚ â€¢ location: beijing/shanghai/...        â”‚
â”‚ â€¢ vip-level: bronze/silver/gold/diamond â”‚
â”‚ â€¢ active-time: morning/afternoon/night  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨é€ç­–ç•¥å®ç°**ï¼š

```java
// å¹´è½»ç§‘æŠ€çˆ±å¥½è€…æ¨é€é˜Ÿåˆ—
Map<String, Object> techYouthBinding = new HashMap<>();
techYouthBinding.put("age-group", "young");
techYouthBinding.put("interests", "tech");
techYouthBinding.put("x-match", "all");  // å¿…é¡»åŒæ—¶æ»¡è¶³
channel.queueBind("tech.youth.push", "user.headers", "", techYouthBinding);

// VIPç”¨æˆ·ä¸“äº«æ¨é€é˜Ÿåˆ—ï¼ˆé‡‘å¡æˆ–é’»çŸ³å¡ï¼‰
Map<String, Object> vipBinding = new HashMap<>();
vipBinding.put("vip-level", "gold");
vipBinding.put("vip-level", "diamond");  // æ³¨æ„ï¼šè¿™æ ·å†™æ˜¯é”™è¯¯çš„ï¼
vipBinding.put("x-match", "any");
```

> âš ï¸ **æ³¨æ„**ï¼šä¸Šé¢çš„VIPç»‘å®šä»£ç æœ‰é—®é¢˜ï¼åŒä¸€ä¸ªkeyä¸èƒ½è®¾ç½®å¤šä¸ªå€¼ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼š

```java
// æ­£ç¡®åšæ³•1ï¼šä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—ç»‘å®š
Map<String, Object> goldBinding = new HashMap<>();
goldBinding.put("vip-level", "gold");
goldBinding.put("x-match", "any");
channel.queueBind("vip.push", "user.headers", "", goldBinding);

Map<String, Object> diamondBinding = new HashMap<>();
diamondBinding.put("vip-level", "diamond");  
diamondBinding.put("x-match", "any");
channel.queueBind("vip.push", "user.headers", "", diamondBinding);

// æ­£ç¡®åšæ³•2ï¼šä½¿ç”¨è‡ªå®šä¹‰å±æ€§
// åœ¨å‘é€æ¶ˆæ¯æ—¶è®¾ç½®ï¼šis-vip: true
Map<String, Object> vipBinding = new HashMap<>();
vipBinding.put("is-vip", "true");
vipBinding.put("x-match", "any");
channel.queueBind("vip.push", "user.headers", "", vipBinding);
```

### 5.3 æ–‡ä»¶å¤„ç†å·¥ä½œæµ


**åœºæ™¯**ï¼šä¼ä¸šæ–‡æ¡£ç®¡ç†ç³»ç»Ÿçš„æ–‡ä»¶å¤„ç†æµç¨‹

```
æ–‡ä»¶å±æ€§åˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ file-type: pdf/doc/excel/image/video          â”‚
â”‚ â€¢ file-size: small/medium/large/huge            â”‚
â”‚ â€¢ department: hr/finance/sales/tech             â”‚
â”‚ â€¢ security-level: public/internal/confidential â”‚
â”‚ â€¢ requires-approval: true/false                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¤„ç†æµç¨‹è®¾è®¡**ï¼š

```java
// æœºå¯†æ–‡æ¡£å®¡æ‰¹é˜Ÿåˆ—ï¼šæœºå¯†çº§åˆ«çš„æ–‡æ¡£å¿…é¡»å®¡æ‰¹
Map<String, Object> secureBinding = new HashMap<>();
secureBinding.put("security-level", "confidential");
secureBinding.put("requires-approval", "true");
secureBinding.put("x-match", "all");
channel.queueBind("secure.approval", "file.headers", "", secureBinding);

// å¤§æ–‡ä»¶å¤„ç†é˜Ÿåˆ—ï¼šå¤§æ–‡ä»¶éœ€è¦ç‰¹æ®Šå¤„ç†
Map<String, Object> largeFileBinding = new HashMap<>();
largeFileBinding.put("file-size", "large");
largeFileBinding.put("file-size", "huge");  // é”™è¯¯å†™æ³•ï¼
largeFileBinding.put("x-match", "any");

// æ­£ç¡®çš„å¤§æ–‡ä»¶å¤„ç†æ–¹å¼
Map<String, Object> largeBinding = new HashMap<>();
largeBinding.put("file-size", "large");
largeBinding.put("x-match", "any");
channel.queueBind("large.files", "file.headers", "", largeBinding);

Map<String, Object> hugeBinding = new HashMap<>();
hugeBinding.put("file-size", "huge");
hugeBinding.put("x-match", "any");  
channel.queueBind("large.files", "file.headers", "", hugeBinding);
```

---

## 6. ğŸ”„ ä¸å…¶ä»–æ¨¡å¼å¯¹æ¯”


### 6.1 å››ç§äº¤æ¢æœºç±»å‹å¯¹æ¯”


| äº¤æ¢æœºç±»å‹ | **è·¯ç”±ä¾æ®** | **çµæ´»æ€§** | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|----------|-------------|-----------|---------|-------------|
| ğŸ”€ **Direct** | `routing keyå®Œå…¨åŒ¹é…` | â­â­ | â­â­â­â­ | `ç®€å•çš„ç‚¹å¯¹ç‚¹è·¯ç”±` |
| ğŸ“¢ **Fanout** | `å¿½ç•¥æ‰€æœ‰æ¡ä»¶ï¼Œå¹¿æ’­` | â­ | â­â­â­â­â­ | `æ¶ˆæ¯å¹¿æ’­ï¼Œé€šçŸ¥æ‰€æœ‰` |
| ğŸ¯ **Topic** | `routing keyæ¨¡å¼åŒ¹é…` | â­â­â­ | â­â­â­ | `åŸºäºä¸»é¢˜çš„çµæ´»è·¯ç”±` |
| ğŸ“‹ **Headers** | `æ¶ˆæ¯å±æ€§å¤šæ¡ä»¶åŒ¹é…` | â­â­â­â­â­ | â­â­ | `å¤æ‚ä¸šåŠ¡é€»è¾‘è·¯ç”±` |

### 6.2 å®é™…é€‰æ‹©æŒ‡å¯¼


**ğŸ¯ ä»€ä¹ˆæ—¶å€™é€‰æ‹©Headersäº¤æ¢æœº**ï¼š

```
é€‰æ‹©Headersçš„åœºæ™¯ï¼š
âœ… éœ€è¦æ ¹æ®å¤šä¸ªå±æ€§è¿›è¡Œè·¯ç”±
âœ… è·¯ç”±æ¡ä»¶æ¯”è¾ƒå¤æ‚ï¼ˆä¸”/æˆ–é€»è¾‘ï¼‰
âœ… å±æ€§ç»„åˆæ¯”è¾ƒå¤šå˜
âœ… ä¸šåŠ¡é€»è¾‘æ¯”routing keyæ›´å¤æ‚

ä¸é€‰æ‹©Headersçš„åœºæ™¯ï¼š
âŒ ç®€å•çš„è·¯ç”±éœ€æ±‚ï¼ˆç”¨Directæ›´å¥½ï¼‰
âŒ æ€§èƒ½è¦æ±‚æé«˜ï¼ˆHeadersæ€§èƒ½æœ€ä½ï¼‰
âŒ åªéœ€è¦å¹¿æ’­ï¼ˆç”¨Fanoutæ›´ç®€å•ï¼‰
âŒ åŸºäºä¸»é¢˜åˆ†ç±»ï¼ˆç”¨Topicæ›´åˆé€‚ï¼‰
```

**å®é™…åœºæ™¯å¯¹æ¯”ä¸¾ä¾‹**ï¼š

```
åœºæ™¯1ï¼šç”¨æˆ·è®¢å•æŒ‰åœ°åŒºåˆ†å‘
Directæ–¹å¼ï¼šrouting key = "beijing" / "shanghai" / "guangzhou"
Headersæ–¹å¼ï¼šheaders = {region: "beijing", priority: "high"}
â†’ å¦‚æœåªæ ¹æ®åœ°åŒºåˆ†å‘ï¼ŒDirectæ›´ç®€å•é«˜æ•ˆ

åœºæ™¯2ï¼šå¤šæ¡ä»¶çš„å¤æ‚è®¢å•åˆ†å‘  
Topicæ–¹å¼ï¼šrouting key = "order.vip.beijing.urgent"
Headersæ–¹å¼ï¼šheaders = {type: "order", customer: "vip", region: "beijing", urgent: true}
â†’ Headersæ›´çµæ´»ï¼Œå¯ä»¥å®ç°"VIPæˆ–ç´§æ€¥"çš„æˆ–é€»è¾‘

åœºæ™¯3ï¼šæ—¥å¿—åˆ†çº§å¤„ç†
Topicæ–¹å¼ï¼šrouting key = "log.error.payment-service.prod"
Headersæ–¹å¼ï¼šheaders = {level: "error", service: "payment", env: "prod", urgent: true}
â†’ Headerså¯ä»¥å®ç°"é”™è¯¯æ—¥å¿—æˆ–ç´§æ€¥æ—¥å¿—"çš„å¤æ‚æ¡ä»¶
```

---

## 7. ğŸ’¡ æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹


### 7.1 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸš€ Headersäº¤æ¢æœºæ€§èƒ½ç‰¹ç‚¹**ï¼š

```
æ€§èƒ½å½±å“å› ç´ ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å±æ€§æ•°é‡ï¼šå±æ€§è¶Šå¤šï¼ŒåŒ¹é…è¶Šæ…¢                â”‚
â”‚ 2. ç»‘å®šæ•°é‡ï¼šé˜Ÿåˆ—ç»‘å®šè¶Šå¤šï¼Œè·¯ç”±è¶Šæ…¢            â”‚  
â”‚ 3. æ¡ä»¶å¤æ‚åº¦ï¼šx-match=allæ¯”anyç¨æ…¢           â”‚
â”‚ 4. å±æ€§å€¼ç±»å‹ï¼šå­—ç¬¦ä¸²æ¯”è¾ƒæ¯”æ•°å€¼æ¯”è¾ƒæ…¢          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š

1. **æ§åˆ¶å±æ€§æ•°é‡**ï¼š
```java
// âŒ å±æ€§è¿‡å¤šï¼Œå½±å“æ€§èƒ½
headers.put("attr1", "value1");
headers.put("attr2", "value2");
// ... 20ä¸ªå±æ€§

// âœ… ç²¾é€‰æ ¸å¿ƒå±æ€§
headers.put("priority", "high");
headers.put("type", "order");
headers.put("region", "asia");
```

2. **åˆç†è®¾è®¡ç»‘å®šæ¡ä»¶**ï¼š
```java
// âŒ è¿‡äºå¤æ‚çš„æ¡ä»¶
bindingArgs.put("customer-type", "VIP");
bindingArgs.put("order-amount", "high");
bindingArgs.put("payment-method", "credit");
bindingArgs.put("shipping-region", "domestic");
bindingArgs.put("delivery-speed", "express");
bindingArgs.put("x-match", "all");  // 5ä¸ªæ¡ä»¶éƒ½è¦æ»¡è¶³

// âœ… ç®€åŒ–æ¡ä»¶ï¼Œæé«˜åŒ¹é…æ•ˆç‡
bindingArgs.put("is-vip-express", "true");  // åˆå¹¶å¤šä¸ªæ¡ä»¶ä¸ºä¸€ä¸ª
bindingArgs.put("x-match", "any");
```

### 7.2 å¸¸è§é”™è¯¯ä¸é¿å…æ–¹æ³•


**âš ï¸ é”™è¯¯1ï¼šåŒä¸€ä¸ªkeyè®¾ç½®å¤šä¸ªå€¼**

```java
// âŒ é”™è¯¯åšæ³•
Map<String, Object> binding = new HashMap<>();
binding.put("region", "beijing");
binding.put("region", "shanghai");  // åé¢çš„å€¼ä¼šè¦†ç›–å‰é¢çš„
binding.put("x-match", "any");

// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å¤šä¸ªç»‘å®š
Map<String, Object> beijingBinding = new HashMap<>();
beijingBinding.put("region", "beijing");
beijingBinding.put("x-match", "any");
channel.queueBind("china.orders", "order.headers", "", beijingBinding);

Map<String, Object> shanghaiBinding = new HashMap<>();
shanghaiBinding.put("region", "shanghai");
shanghaiBinding.put("x-match", "any");
channel.queueBind("china.orders", "order.headers", "", shanghaiBinding);
```

**âš ï¸ é”™è¯¯2ï¼šå¿˜è®°è®¾ç½®x-matchå‚æ•°**

```java
// âŒ ç¼ºå°‘x-matchï¼Œé»˜è®¤è¡Œä¸ºä¸æ˜ç¡®
Map<String, Object> binding = new HashMap<>();
binding.put("priority", "high");
binding.put("type", "urgent");
// ç¼ºå°‘x-matchè®¾ç½®

// âœ… æ˜ç¡®æŒ‡å®šx-match
binding.put("x-match", "all");  // æˆ–è€… "any"
```

**âš ï¸ é”™è¯¯3ï¼šå±æ€§åç§°ä¸ä¸€è‡´**

```java
// âŒ å‘é€æ¶ˆæ¯å’Œç»‘å®šæ¡ä»¶çš„å±æ€§åä¸ä¸€è‡´
// å‘é€æ—¶ï¼š
headers.put("customerType", "VIP");  // é©¼å³°å‘½å

// ç»‘å®šæ—¶ï¼š
binding.put("customer-type", "VIP");  // è¿å­—ç¬¦å‘½å
// â†’ åŒ¹é…å¤±è´¥ï¼

// âœ… ä¿æŒå‘½åä¸€è‡´
headers.put("customer-type", "VIP");
binding.put("customer-type", "VIP");
```

### 7.3 ç›‘æ§ä¸è°ƒè¯•å»ºè®®


**ğŸ” è°ƒè¯•æŠ€å·§**ï¼š

1. **å¯ç”¨ç®¡ç†æ’ä»¶ç›‘æ§**ï¼š
```bash
# å¯ç”¨RabbitMQç®¡ç†æ’ä»¶
rabbitmq-plugins enable rabbitmq_management

# è®¿é—®ç®¡ç†ç•Œé¢æŸ¥çœ‹äº¤æ¢æœºç»‘å®šæƒ…å†µ
http://localhost:15672
```

2. **æ—¥å¿—è®°å½•å…³é”®ä¿¡æ¯**ï¼š
```java
// è®°å½•å‘é€çš„æ¶ˆæ¯å±æ€§
logger.info("å‘é€æ¶ˆæ¯å±æ€§: {}", headers);

// è®°å½•é˜Ÿåˆ—ç»‘å®šæ¡ä»¶
logger.info("é˜Ÿåˆ—ç»‘å®šæ¡ä»¶: {}", bindingArgs);

// è®°å½•è·¯ç”±ç»“æœ
logger.info("æ¶ˆæ¯æ˜¯å¦æˆåŠŸè·¯ç”±: {}", routingResult);
```

3. **ä½¿ç”¨æµ‹è¯•é˜Ÿåˆ—éªŒè¯**ï¼š
```java
// åˆ›å»ºæµ‹è¯•é˜Ÿåˆ—ï¼Œç»‘å®šç®€å•æ¡ä»¶è¿›è¡ŒéªŒè¯
Map<String, Object> testBinding = new HashMap<>();
testBinding.put("test", "true");
testBinding.put("x-match", "any");
channel.queueBind("test.queue", "order.headers", "", testBinding);

// å‘é€æµ‹è¯•æ¶ˆæ¯
Map<String, Object> testHeaders = new HashMap<>();
testHeaders.put("test", "true");
// æ£€æŸ¥æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Headersäº¤æ¢æœºï¼šåŸºäºæ¶ˆæ¯å±æ€§è¿›è¡Œè·¯ç”±çš„æ™ºèƒ½åˆ†æ‹£å‘˜
ğŸ”¸ å±æ€§åŒ¹é…ï¼šæ ¹æ®æ¶ˆæ¯å¤´éƒ¨çš„é”®å€¼å¯¹è¿›è¡Œæ¡ä»¶åˆ¤æ–­
ğŸ”¸ x-matchå‚æ•°ï¼šæ§åˆ¶å¤šæ¡ä»¶çš„é€»è¾‘å…³ç³»ï¼ˆall/anyï¼‰
ğŸ”¸ å¤æ‚è·¯ç”±ï¼šæ”¯æŒæœ€çµæ´»çš„å¤šç»´åº¦è·¯ç”±ç­–ç•¥
ğŸ”¸ æ€§èƒ½æƒè¡¡ï¼šçµæ´»æ€§æœ€é«˜ä½†æ€§èƒ½ç›¸å¯¹è¾ƒä½
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Headers vs å…¶ä»–äº¤æ¢æœºçš„æœ¬è´¨åŒºåˆ«**
```
è·¯ç”±ä¾æ®çš„åŒºåˆ«ï¼š
Directï¼š   routing key = "beijing"
Topicï¼š    routing key = "order.*.beijing"  
Headersï¼š  headers = {region: "beijing", priority: "high"}

Headersæœ€å¤§ä¼˜åŠ¿ï¼šå¯ä»¥å®ç°AND/ORé€»è¾‘ç»„åˆ
```

**ğŸ”¹ x-matchå‚æ•°çš„é€‰æ‹©ç­–ç•¥**
```
ä¸šåŠ¡é€»è¾‘åˆ¤æ–­ï¼š
éœ€è¦åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶ â†’ x-match: "all"
æ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯   â†’ x-match: "any"

å®é™…åº”ç”¨ï¼š
ä¸¥æ ¼ç­›é€‰åœºæ™¯      â†’ allï¼ˆå¦‚VIPé«˜é‡‘é¢è®¢å•ï¼‰
å®½æ¾è¿‡æ»¤åœºæ™¯      â†’ anyï¼ˆå¦‚ç´§æ€¥é€šçŸ¥ï¼‰
```

**ğŸ”¹ æ€§èƒ½ä¸çµæ´»æ€§çš„å¹³è¡¡**
```
é€‰æ‹©åŸåˆ™ï¼š
ç®€å•è·¯ç”±éœ€æ±‚    â†’ Direct/Fanoutï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
ä¸»é¢˜åˆ†ç±»éœ€æ±‚    â†’ Topicï¼ˆå¹³è¡¡æ€§èƒ½å’Œçµæ´»æ€§ï¼‰
å¤æ‚ä¸šåŠ¡é€»è¾‘    â†’ Headersï¼ˆçµæ´»æ€§ä¼˜å…ˆï¼‰
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æœ€ä½³åº”ç”¨åœºæ™¯**
- **è®¢å•ç®¡ç†ç³»ç»Ÿ**ï¼šæ ¹æ®å®¢æˆ·ç­‰çº§ã€é‡‘é¢ã€åœ°åŒºç­‰å¤šç»´åº¦åˆ†å‘
- **æ—¥å¿—å¤„ç†ç³»ç»Ÿ**ï¼šæ ¹æ®çº§åˆ«ã€æœåŠ¡ã€ç¯å¢ƒç­‰å±æ€§åˆ†ç±»å¤„ç†
- **æ¶ˆæ¯æ¨é€ç³»ç»Ÿ**ï¼šæ ¹æ®ç”¨æˆ·ç”»åƒè¿›è¡Œä¸ªæ€§åŒ–æ¨é€
- **å·¥ä½œæµç³»ç»Ÿ**ï¼šæ ¹æ®æ–‡æ¡£å±æ€§å’Œä¸šåŠ¡è§„åˆ™è¿›è¡Œæµç¨‹è·¯ç”±

**ğŸ”§ å·¥ç¨‹å®è·µè¦ç‚¹**
- **å±æ€§è®¾è®¡**ï¼šç²¾é€‰æ ¸å¿ƒå±æ€§ï¼Œé¿å…è¿‡åº¦å¤æ‚
- **å‘½åè§„èŒƒ**ï¼šä¿æŒå±æ€§åç§°çš„ä¸€è‡´æ€§
- **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨è·¯ç”±æ€§èƒ½ï¼Œå¿…è¦æ—¶ä¼˜åŒ–ç»‘å®šæ¡ä»¶
- **è°ƒè¯•éªŒè¯**ï¼šä½¿ç”¨æµ‹è¯•é˜Ÿåˆ—éªŒè¯è·¯ç”±è§„åˆ™

**ğŸ’¡ å­¦ä¹ å»ºè®®**
- ä»ç®€å•çš„ä¸¤ä¸ªå±æ€§å¼€å§‹ç»ƒä¹ 
- ç†è§£allå’Œanyçš„åŒºåˆ«æ˜¯å…³é”®
- å¤šåšå®é™…åœºæ™¯çš„ç»ƒä¹ 
- å¯¹æ¯”å…¶ä»–äº¤æ¢æœºç±»å‹åŠ æ·±ç†è§£

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Headersæ™ºèƒ½çœ‹å±æ€§ï¼Œä¸çœ‹routing keyèµ°è€è·¯
- x-matchå‚æ•°æ˜¯å…³é”®ï¼Œallå¹¶ä¸”anyæˆ–è€…
- å¤æ‚è·¯ç”±å®ƒæœ€å¼ºï¼Œæ€§èƒ½ç¨å¼±è¦æƒè¡¡
- å¤šç»´æ¡ä»¶ä¸šåŠ¡åœºæ™¯ï¼ŒHeadersäº¤æ¢æœºæ˜¾ç¥å¨