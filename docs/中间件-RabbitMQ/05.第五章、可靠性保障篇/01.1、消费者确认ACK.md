---
title: 1ã€æ¶ˆè´¹è€…ç¡®è®¤ACK
---
## ğŸ“š ç›®å½•

1. [æ¶ˆè´¹è€…ç¡®è®¤ACKåŸºæœ¬æ¦‚å¿µ](#1-æ¶ˆè´¹è€…ç¡®è®¤ACKåŸºæœ¬æ¦‚å¿µ)
2. [è‡ªåŠ¨ç¡®è®¤vsæ‰‹åŠ¨ç¡®è®¤](#2-è‡ªåŠ¨ç¡®è®¤vsæ‰‹åŠ¨ç¡®è®¤)
3. [æ‰‹åŠ¨ç¡®è®¤çš„ä¸‰ç§æ“ä½œ](#3-æ‰‹åŠ¨ç¡®è®¤çš„ä¸‰ç§æ“ä½œ)
4. [é‡æ–°å…¥é˜Ÿæœºåˆ¶è¯¦è§£](#4-é‡æ–°å…¥é˜Ÿæœºåˆ¶è¯¦è§£)
5. [ç¡®è®¤è¶…æ—¶å¤„ç†æœºåˆ¶](#5-ç¡®è®¤è¶…æ—¶å¤„ç†æœºåˆ¶)
6. [æ‰¹é‡ç¡®è®¤ä¼˜åŒ–ç­–ç•¥](#6-æ‰¹é‡ç¡®è®¤ä¼˜åŒ–ç­–ç•¥)
7. [å®é™…åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ](#7-å®é™…åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ¶ˆè´¹è€…ç¡®è®¤ACKåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶


**ğŸ”¸ é€šä¿—ç†è§£**
```
ç”Ÿæ´»ç±»æ¯”ï¼šå¿«é€’ç­¾æ”¶æœºåˆ¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¿«é€’å‘˜é€åŒ…è£¹ â†’ ä½ æ”¶åˆ°åŒ…è£¹    â”‚
â”‚ â†“                         â”‚
â”‚ ä½ ç­¾å­—ç¡®è®¤ â†’ å¿«é€’å‘˜ç¦»å¼€     â”‚
â”‚ â†“                         â”‚
â”‚ åŒ…è£¹æŠ•é€’å®Œæˆ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RabbitMQçš„ACKæœºåˆ¶å°±åƒå¿«é€’ç­¾æ”¶ï¼š
â€¢ æ¶ˆæ¯ = åŒ…è£¹
â€¢ æ¶ˆè´¹è€… = æ”¶ä»¶äºº  
â€¢ ACKç¡®è®¤ = ç­¾å­—ç¡®è®¤
â€¢ åªæœ‰ç­¾æ”¶åï¼Œå¿«é€’å…¬å¸æ‰è®¤ä¸ºæŠ•é€’æˆåŠŸ
```

**ğŸ’¡ æ ¸å¿ƒä½œç”¨**
- **å¯é æ€§ä¿éšœ**ï¼šç¡®ä¿æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†ï¼Œä¸ä¼šä¸¢å¤±
- **æµé‡æ§åˆ¶**ï¼šé˜²æ­¢æ¶ˆè´¹è€…å¤„ç†ä¸è¿‡æ¥æ—¶ç»§ç»­æ¨é€æ¶ˆæ¯
- **é”™è¯¯æ¢å¤**ï¼šå¤„ç†å¤±è´¥æ—¶å¯ä»¥é‡æ–°æŠ•é€’æ¶ˆæ¯

### 1.2 ç¡®è®¤æœºåˆ¶çš„å·¥ä½œæµç¨‹


```
æ¶ˆæ¯å¤„ç†æµç¨‹å›¾ï¼š

RabbitMQæœåŠ¡å™¨          æ¶ˆè´¹è€…åº”ç”¨
      |                    |
   [æ¶ˆæ¯] â”€â”€â”€â”€â”€æ¨é€â”€â”€â”€â”€â†’  [æ¥æ”¶]
      |                    |
      |                 [å¤„ç†ä¸­]
      |                    |
      |  â†â”€â”€â”€â”€ACKç¡®è®¤â”€â”€â”€â”€  [å¤„ç†å®Œæˆ]
      |                    |
   [åˆ é™¤æ¶ˆæ¯]              [ç»§ç»­ä¸‹ä¸€æ¡]
```

**ğŸ”¹ å…³é”®ç†è§£è¦ç‚¹**
- **æ¶ˆæ¯çŠ¶æ€**ï¼šæœªç¡®è®¤çš„æ¶ˆæ¯ä¼šä¸€ç›´ä¿ç•™åœ¨é˜Ÿåˆ—ä¸­
- **ç¡®è®¤æ—¶æœº**ï¼šåªæœ‰æ”¶åˆ°ACKåï¼ŒRabbitMQæ‰ä¼šåˆ é™¤æ¶ˆæ¯
- **å¤±è´¥å¤„ç†**ï¼šå¦‚æœæ¶ˆè´¹è€…å´©æºƒï¼Œæœªç¡®è®¤çš„æ¶ˆæ¯ä¼šé‡æ–°æŠ•é€’

---

## 2. âš–ï¸ è‡ªåŠ¨ç¡®è®¤vsæ‰‹åŠ¨ç¡®è®¤


### 2.1 è‡ªåŠ¨ç¡®è®¤æ¨¡å¼ï¼ˆAuto ACKï¼‰


**ğŸ”¸ å·¥ä½œåŸç†**
```
è‡ªåŠ¨ç¡®è®¤æµç¨‹ï¼š
æ¶ˆæ¯å‘é€ â†’ æ¶ˆè´¹è€…æ¥æ”¶ â†’ ç«‹å³è‡ªåŠ¨ç¡®è®¤ â†’ æ¶ˆæ¯åˆ é™¤
         â†‘_______________|
        (æ— éœ€æ‰‹åŠ¨æ“ä½œ)

ç‰¹ç‚¹ï¼š
âœ… ç®€å•æ–¹ä¾¿ï¼Œæ— éœ€ç¼–å†™ç¡®è®¤ä»£ç 
âœ… æ€§èƒ½æœ€é«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç½‘ç»œå¼€é”€
âŒ å¯é æ€§å·®ï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±
âŒ æ— æ³•å¤„ç†æ¶ˆè´¹å¤±è´¥çš„æƒ…å†µ
```

**ğŸ“ ä»£ç ç¤ºä¾‹**
```java
// Java - è‡ªåŠ¨ç¡®è®¤æ¨¡å¼
channel.basicConsume(queueName, 
    true,  // autoAck = trueï¼Œè‡ªåŠ¨ç¡®è®¤
    (consumerTag, delivery) -> {
        String message = new String(delivery.getBody(), "UTF-8");
        System.out.println("æ”¶åˆ°æ¶ˆæ¯: " + message);
        // æ¶ˆæ¯ä¸€æ¥æ”¶å°±è¢«è‡ªåŠ¨ç¡®è®¤äº†ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†
    }, 
    consumerTag -> {});
```

**âš ï¸ é€‚ç”¨åœºæ™¯**
- **æ—¥å¿—è®°å½•**ï¼šä¸¢å¤±å‡ æ¡æ—¥å¿—å½±å“ä¸å¤§
- **å®æ—¶ç»Ÿè®¡**ï¼šå…è®¸å°‘é‡æ•°æ®ä¸¢å¤±
- **é«˜å¹¶å‘åœºæ™¯**ï¼šè¿½æ±‚æè‡´æ€§èƒ½ï¼Œå®¹å¿å°‘é‡ä¸¢å¤±

### 2.2 æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼ˆManual ACKï¼‰


**ğŸ”¸ å·¥ä½œåŸç†**
```
æ‰‹åŠ¨ç¡®è®¤æµç¨‹ï¼š
æ¶ˆæ¯å‘é€ â†’ æ¶ˆè´¹è€…æ¥æ”¶ â†’ ä¸šåŠ¡å¤„ç† â†’ æ‰‹åŠ¨ç¡®è®¤ â†’ æ¶ˆæ¯åˆ é™¤
                      â†“
                   å¤„ç†å¤±è´¥ â†’ æ‹’ç»/é‡è¯• â†’ æ¶ˆæ¯é‡æ–°å…¥é˜Ÿ

ç‰¹ç‚¹ï¼š
âœ… å¯é æ€§é«˜ï¼Œæ¶ˆæ¯ä¸ä¼šè½»æ˜“ä¸¢å¤±
âœ… å¯ä»¥å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ
âœ… æ”¯æŒæ‰¹é‡æ“ä½œï¼Œæå‡æ€§èƒ½
âŒ éœ€è¦ç¼–å†™é¢å¤–çš„ç¡®è®¤ä»£ç 
âŒ æœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€
```

**ğŸ“ ä»£ç ç¤ºä¾‹**
```java
// Java - æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼
channel.basicConsume(queueName, 
    false,  // autoAck = falseï¼Œæ‰‹åŠ¨ç¡®è®¤
    (consumerTag, delivery) -> {
        try {
            String message = new String(delivery.getBody(), "UTF-8");
            
            // ä¸šåŠ¡å¤„ç†é€»è¾‘
            processMessage(message);
            
            // å¤„ç†æˆåŠŸï¼Œæ‰‹åŠ¨ç¡®è®¤
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
            
        } catch (Exception e) {
            // å¤„ç†å¤±è´¥ï¼Œæ‹’ç»æ¶ˆæ¯
            channel.basicNack(delivery.getEnvelope().getDeliveryTag(), 
                              false, true);
        }
    }, 
    consumerTag -> {});
```

### 2.3 ä¸¤ç§æ¨¡å¼å¯¹æ¯”


| å¯¹æ¯”é¡¹ç›® | **è‡ªåŠ¨ç¡®è®¤** | **æ‰‹åŠ¨ç¡®è®¤** |
|---------|------------|------------|
| **å¯é æ€§** | â­â­ | â­â­â­â­â­ |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ |
| **å¤æ‚åº¦** | â­ | â­â­â­ |
| **æ¶ˆæ¯ä¸¢å¤±é£é™©** | `é«˜` | `ä½` |
| **é”™è¯¯å¤„ç†èƒ½åŠ›** | `æ— ` | `å¼º` |
| **é€‚ç”¨åœºæ™¯** | `é«˜æ€§èƒ½ã€å¯å®¹å¿ä¸¢å¤±` | `ä¸šåŠ¡å…³é”®ã€ä¸èƒ½ä¸¢å¤±` |

---

## 3. ğŸ› ï¸ æ‰‹åŠ¨ç¡®è®¤çš„ä¸‰ç§æ“ä½œ


### 3.1 basic.ack - æ­£é¢ç¡®è®¤


**ğŸ”¸ åŠŸèƒ½è¯´æ˜**
- **ä½œç”¨**ï¼šå‘Šè¯‰RabbitMQæ¶ˆæ¯å·²ç»æˆåŠŸå¤„ç†ï¼Œå¯ä»¥åˆ é™¤
- **ç»“æœ**ï¼šæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­æ°¸ä¹…ç§»é™¤
- **é€‚ç”¨**ï¼šä¸šåŠ¡å¤„ç†æˆåŠŸçš„æƒ…å†µ

```java
/**
 * ç¡®è®¤æ¶ˆæ¯
 * @param deliveryTag æ¶ˆæ¯æ ‡è¯†
 * @param multiple æ˜¯å¦æ‰¹é‡ç¡®è®¤
 */
channel.basicAck(deliveryTag, false);
```

**ğŸ’¡ å‚æ•°è¯¦è§£**
```
deliveryTag: æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªé€’å¢çš„æ•°å­—æ ‡è¯†   â”‚
â”‚ ä¾‹å¦‚ï¼š1, 2, 3, 4, 5...          â”‚
â”‚ ç”¨äºç²¾ç¡®å®šä½è¦ç¡®è®¤çš„æ¶ˆæ¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

multiple: æ‰¹é‡ç¡®è®¤æ ‡å¿—
â€¢ false: åªç¡®è®¤å½“å‰è¿™ä¸€æ¡æ¶ˆæ¯
â€¢ true:  ç¡®è®¤deliveryTagåŠä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯
```

### 3.2 basic.nack - æ‰¹é‡æ‹’ç»


**ğŸ”¸ åŠŸèƒ½è¯´æ˜**
- **ä½œç”¨**ï¼šæ‹’ç»ä¸€æ¡æˆ–å¤šæ¡æ¶ˆæ¯
- **çµæ´»æ€§**ï¼šå¯ä»¥é€‰æ‹©æ˜¯å¦é‡æ–°å…¥é˜Ÿ
- **é€‚ç”¨**ï¼šæ‰¹é‡å¤„ç†å¤±è´¥çš„æƒ…å†µ

```java
/**
 * æ‹’ç»æ¶ˆæ¯ï¼ˆæ”¯æŒæ‰¹é‡ï¼‰
 * @param deliveryTag æ¶ˆæ¯æ ‡è¯†
 * @param multiple æ˜¯å¦æ‰¹é‡æ‹’ç»
 * @param requeue æ˜¯å¦é‡æ–°å…¥é˜Ÿ
 */
channel.basicNack(deliveryTag, false, true);
```

**ğŸ”¹ é‡æ–°å…¥é˜Ÿç­–ç•¥**
```
requeue = true:  æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹æ¬¡æŠ•é€’
  ä¼˜ç‚¹ï¼šä¸ä¼šä¸¢å¤±æ¶ˆæ¯
  ç¼ºç‚¹ï¼šå¯èƒ½å½¢æˆæ­»å¾ªç¯

requeue = false: æ¶ˆæ¯ç›´æ¥ä¸¢å¼ƒï¼ˆæˆ–é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼‰
  ä¼˜ç‚¹ï¼šé¿å…æ— é™é‡è¯•
  ç¼ºç‚¹ï¼šæ¶ˆæ¯å¯èƒ½ä¸¢å¤±
```

### 3.3 basic.reject - å•æ¡æ‹’ç»


**ğŸ”¸ åŠŸèƒ½è¯´æ˜**
- **ä½œç”¨**ï¼šæ‹’ç»å•æ¡æ¶ˆæ¯ï¼ˆnackçš„ç®€åŒ–ç‰ˆï¼‰
- **é™åˆ¶**ï¼šåªèƒ½å¤„ç†ä¸€æ¡æ¶ˆæ¯ï¼Œä¸æ”¯æŒæ‰¹é‡
- **é€‚ç”¨**ï¼šç®€å•çš„å•æ¡æ¶ˆæ¯æ‹’ç»

```java
/**
 * æ‹’ç»å•æ¡æ¶ˆæ¯
 * @param deliveryTag æ¶ˆæ¯æ ‡è¯†  
 * @param requeue æ˜¯å¦é‡æ–°å…¥é˜Ÿ
 */
channel.basicReject(deliveryTag, true);
```

### 3.4 ä¸‰ç§æ“ä½œçš„å®é™…åº”ç”¨


```java
public void handleMessage(Channel channel, Delivery delivery) {
    long deliveryTag = delivery.getEnvelope().getDeliveryTag();
    
    try {
        String message = new String(delivery.getBody(), "UTF-8");
        
        // ä¸šåŠ¡å¤„ç†
        BusinessResult result = processBusinessLogic(message);
        
        if (result.isSuccess()) {
            // ğŸŸ¢ å¤„ç†æˆåŠŸ - ç¡®è®¤æ¶ˆæ¯
            channel.basicAck(deliveryTag, false);
            
        } else if (result.isRetryable()) {
            // ğŸŸ¡ å¯é‡è¯•é”™è¯¯ - é‡æ–°å…¥é˜Ÿ
            channel.basicNack(deliveryTag, false, true);
            
        } else {
            // ğŸ”´ ä¸å¯é‡è¯•é”™è¯¯ - ç›´æ¥ä¸¢å¼ƒ
            channel.basicNack(deliveryTag, false, false);
        }
        
    } catch (Exception e) {
        // âŒ ç³»ç»Ÿå¼‚å¸¸ - æ‹’ç»å¹¶é‡æ–°å…¥é˜Ÿ
        channel.basicReject(deliveryTag, true);
    }
}
```

---

## 4. ğŸ”„ é‡æ–°å…¥é˜Ÿæœºåˆ¶è¯¦è§£


### 4.1 é‡æ–°å…¥é˜Ÿçš„å·¥ä½œåŸç†


**ğŸ”¸ åŸºæœ¬æµç¨‹**
```
é‡æ–°å…¥é˜Ÿæµç¨‹å›¾ï¼š

[æ¶ˆè´¹è€…Aæ¥æ”¶æ¶ˆæ¯] â†’ [å¤„ç†å¤±è´¥] â†’ [nack(requeue=true)]
        â†“                                  â†“
[æ¶ˆæ¯æ ‡è®°ä¸ºæœªç¡®è®¤]  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  [æ¶ˆæ¯é‡æ–°å…¥é˜Ÿ]
        â†“
[ç­‰å¾…ä¸‹æ¬¡æŠ•é€’] â†’ [å¯èƒ½åˆ†é…ç»™å…¶ä»–æ¶ˆè´¹è€…]
```

**ğŸ’¡ å…³é”®ç†è§£**
- **é˜Ÿåˆ—ä½ç½®**ï¼šé‡æ–°å…¥é˜Ÿçš„æ¶ˆæ¯ä¼šå›åˆ°é˜Ÿåˆ—å¤´éƒ¨ï¼Œä¼˜å…ˆè¢«æ¶ˆè´¹
- **æ¶ˆè´¹è€…åˆ†é…**ï¼šå¯èƒ½è¢«åˆ†é…ç»™å…¶ä»–å¯ç”¨çš„æ¶ˆè´¹è€…
- **é‡è¯•æ¬¡æ•°**ï¼šRabbitMQæœ¬èº«ä¸é™åˆ¶é‡è¯•æ¬¡æ•°

### 4.2 é‡æ–°å…¥é˜Ÿçš„è§¦å‘æ¡ä»¶


**ğŸ”¹ ä¸»åŠ¨è§¦å‘**
```java
// 1. ä½¿ç”¨ nack ä¸»åŠ¨é‡æ–°å…¥é˜Ÿ
channel.basicNack(deliveryTag, false, true);

// 2. ä½¿ç”¨ reject ä¸»åŠ¨é‡æ–°å…¥é˜Ÿ  
channel.basicReject(deliveryTag, true);
```

**ğŸ”¹ è¢«åŠ¨è§¦å‘**
```
æ¶ˆè´¹è€…è¿æ¥æ–­å¼€çš„æƒ…å†µï¼š
â€¢ æ¶ˆè´¹è€…è¿›ç¨‹å´©æºƒ
â€¢ ç½‘ç»œè¿æ¥ä¸­æ–­
â€¢ æ¶ˆè´¹è€…ä¸»åŠ¨å…³é—­è¿æ¥
â€¢ å¿ƒè·³è¶…æ—¶

ç»“æœï¼šæ‰€æœ‰æœªç¡®è®¤çš„æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ
```

### 4.3 é˜²æ­¢æ— é™é‡è¯•çš„ç­–ç•¥


**ğŸ¯ ç­–ç•¥1ï¼šè®¾ç½®é‡è¯•æ¬¡æ•°**
```java
public class RetryMessageHandler {
    private static final int MAX_RETRY = 3;
    
    public void handleMessage(Channel channel, Delivery delivery) {
        // ä»æ¶ˆæ¯å¤´è·å–é‡è¯•æ¬¡æ•°
        Map<String, Object> headers = delivery.getProperties().getHeaders();
        int retryCount = (int) headers.getOrDefault("retry-count", 0);
        
        if (retryCount >= MAX_RETRY) {
            // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œç›´æ¥ä¸¢å¼ƒ
            channel.basicNack(delivery.getEnvelope().getDeliveryTag(), 
                              false, false);
            return;
        }
        
        try {
            // ä¸šåŠ¡å¤„ç†
            processMessage(delivery);
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
            
        } catch (Exception e) {
            // é‡è¯•æ¬¡æ•°+1ï¼Œé‡æ–°å‘å¸ƒæ¶ˆæ¯
            republishWithRetryCount(channel, delivery, retryCount + 1);
            channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        }
    }
}
```

**ğŸ¯ ç­–ç•¥2ï¼šä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—**
```
é…ç½®æ­»ä¿¡é˜Ÿåˆ—å¤„ç†å¤±è´¥æ¶ˆæ¯ï¼š

æ­£å¸¸é˜Ÿåˆ— â†’ æ¶ˆæ¯å¤„ç†å¤±è´¥ â†’ æ­»ä¿¡é˜Ÿåˆ— â†’ äººå·¥å¤„ç†
   â†‘                        â†“
   â””â”€â”€â”€ è®¾ç½®TTLè¶…æ—¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. â° ç¡®è®¤è¶…æ—¶å¤„ç†æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯ç¡®è®¤è¶…æ—¶


**ğŸ”¸ æ¦‚å¿µè§£é‡Š**
```
ç¡®è®¤è¶…æ—¶æœºåˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RabbitMQå‘é€æ¶ˆæ¯ç»™æ¶ˆè´¹è€…             â”‚
â”‚ â†“                                 â”‚
â”‚ ç­‰å¾…æ¶ˆè´¹è€…ç¡®è®¤ï¼ˆACK/NACKï¼‰          â”‚
â”‚ â†“                                 â”‚
â”‚ å¦‚æœè¶…è¿‡æŒ‡å®šæ—¶é—´æ²¡æœ‰æ”¶åˆ°ç¡®è®¤         â”‚
â”‚ â†“                                 â”‚
â”‚ è®¤ä¸ºæ¶ˆè´¹è€…å·²ç»"æ­»æ‰"ï¼Œå…³é—­è¿æ¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”Ÿæ´»ç±»æ¯”ï¼š
å°±åƒè€å¸ˆç‚¹åï¼Œå«åˆ°ä½ çš„åå­—åç­‰ä½ å›åº”
å¦‚æœç­‰å¤ªä¹…æ²¡å›åº”ï¼Œå°±è®¤ä¸ºä½ ä¸åœ¨æ•™å®¤
```

### 5.2 è¶…æ—¶å‚æ•°é…ç½®


**ğŸ”¸ æœåŠ¡å™¨ç«¯é…ç½®**
```bash
# rabbitmq.conf é…ç½®æ–‡ä»¶
# è®¾ç½®æ¶ˆè´¹è€…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
consumer_timeout = 900000  # 15åˆ†é’Ÿ

# æˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡
export RABBITMQ_CONSUMER_TIMEOUT=900000
```

**ğŸ”¸ å®¢æˆ·ç«¯é…ç½®**
```java
// Javaå®¢æˆ·ç«¯è®¾ç½®è¿æ¥è¶…æ—¶
ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");

// è®¾ç½®ç½‘ç»œæ¢å¤é—´éš”
factory.setNetworkRecoveryInterval(5000);

// è®¾ç½®è‡ªåŠ¨æ¢å¤
factory.setAutomaticRecoveryEnabled(true);
```

### 5.3 è¶…æ—¶å¤„ç†çš„æœ€ä½³å®è·µ


**âš ï¸ é¿å…è¶…æ—¶çš„æ–¹æ³•**
```java
public class TimeoutSafeConsumer {
    
    public void handleLongRunningTask(Channel channel, Delivery delivery) {
        long deliveryTag = delivery.getEnvelope().getDeliveryTag();
        
        try {
            // å¯¹äºè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ï¼Œåˆ†æ®µå¤„ç†
            String message = new String(delivery.getBody(), "UTF-8");
            
            // æ–¹æ¡ˆ1ï¼šå¿«é€Ÿç¡®è®¤ï¼Œå¼‚æ­¥å¤„ç†
            channel.basicAck(deliveryTag, false);  // å…ˆç¡®è®¤
            processLongTask(message);  // å†å¼‚æ­¥å¤„ç†
            
        } catch (Exception e) {
            // å¤„ç†å¼‚å¸¸
            handleException(e);
        }
    }
    
    // æ–¹æ¡ˆ2ï¼šåˆ†æ‰¹å¤„ç†å¤§ä»»åŠ¡
    public void handleBatchTask(Channel channel, Delivery delivery) {
        long deliveryTag = delivery.getEnvelope().getDeliveryTag();
        
        try {
            List<String> dataList = parseMessage(delivery);
            
            // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…é•¿æ—¶é—´å ç”¨
            for (List<String> batch : partition(dataList, 100)) {
                processBatch(batch);
                
                // å¯ä»¥åœ¨æ‰¹æ¬¡é—´æ£€æŸ¥æ˜¯å¦éœ€è¦ç¡®è®¤
                if (shouldAckNow()) {
                    channel.basicAck(deliveryTag, false);
                    return;
                }
            }
            
            channel.basicAck(deliveryTag, false);
            
        } catch (Exception e) {
            channel.basicNack(deliveryTag, false, true);
        }
    }
}
```

---

## 6. ğŸ“¦ æ‰¹é‡ç¡®è®¤ä¼˜åŒ–ç­–ç•¥


### 6.1 æ‰¹é‡ç¡®è®¤çš„ä¼˜åŠ¿


**ğŸ”¸ æ€§èƒ½å¯¹æ¯”**
```
å•æ¡ç¡®è®¤ vs æ‰¹é‡ç¡®è®¤ï¼š

å•æ¡ç¡®è®¤ï¼š
æ¶ˆæ¯1 â†’ ACK1 â†’ æ¶ˆæ¯2 â†’ ACK2 â†’ æ¶ˆæ¯3 â†’ ACK3
ç½‘ç»œè°ƒç”¨ï¼š6æ¬¡

æ‰¹é‡ç¡®è®¤ï¼š  
æ¶ˆæ¯1 â†’ æ¶ˆæ¯2 â†’ æ¶ˆæ¯3 â†’ æ‰¹é‡ACK(1,2,3)
ç½‘ç»œè°ƒç”¨ï¼š4æ¬¡

æ€§èƒ½æå‡ï¼šå‡å°‘50%çš„ç½‘ç»œè°ƒç”¨
```

**ğŸ’¡ é€‚ç”¨åœºæ™¯**
- **é«˜ååé‡**ï¼šéœ€è¦å¤„ç†å¤§é‡æ¶ˆæ¯
- **ç½‘ç»œå»¶è¿Ÿæ•æ„Ÿ**ï¼šå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°
- **æ‰¹é‡ä¸šåŠ¡é€»è¾‘**ï¼šä¸šåŠ¡æœ¬èº«å°±æ˜¯æ‰¹é‡å¤„ç†

### 6.2 æ‰¹é‡ç¡®è®¤å®ç°æ–¹å¼


**ğŸ”¸ æ–¹å¼1ï¼šæŒ‰æ•°é‡æ‰¹é‡ç¡®è®¤**
```java
public class BatchAckByCount {
    private static final int BATCH_SIZE = 10;
    private int processedCount = 0;
    private long lastDeliveryTag = 0;
    
    public void handleMessage(Channel channel, Delivery delivery) {
        try {
            // å¤„ç†æ¶ˆæ¯
            processMessage(delivery);
            
            processedCount++;
            lastDeliveryTag = delivery.getEnvelope().getDeliveryTag();
            
            // è¾¾åˆ°æ‰¹é‡å¤§å°ï¼Œæ‰§è¡Œæ‰¹é‡ç¡®è®¤
            if (processedCount >= BATCH_SIZE) {
                channel.basicAck(lastDeliveryTag, true);  // multiple=true
                processedCount = 0;
            }
            
        } catch (Exception e) {
            // å‡ºé”™æ—¶ç¡®è®¤ä¹‹å‰çš„æ¶ˆæ¯ï¼Œæ‹’ç»å½“å‰æ¶ˆæ¯
            if (processedCount > 0) {
                channel.basicAck(lastDeliveryTag, true);
                processedCount = 0;
            }
            channel.basicNack(delivery.getEnvelope().getDeliveryTag(), 
                              false, true);
        }
    }
}
```

**ğŸ”¸ æ–¹å¼2ï¼šæŒ‰æ—¶é—´æ‰¹é‡ç¡®è®¤**
```java
public class BatchAckByTime {
    private final ScheduledExecutorService scheduler = 
        Executors.newScheduledThreadPool(1);
    private volatile long lastDeliveryTag = 0;
    private volatile boolean hasPendingMessages = false;
    
    public void startBatchAck(Channel channel) {
        // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡æ‰¹é‡ç¡®è®¤
        scheduler.scheduleAtFixedRate(() -> {
            if (hasPendingMessages && lastDeliveryTag > 0) {
                try {
                    channel.basicAck(lastDeliveryTag, true);
                    hasPendingMessages = false;
                } catch (IOException e) {
                    // å¤„ç†ç¡®è®¤å¤±è´¥
                }
            }
        }, 5, 5, TimeUnit.SECONDS);
    }
    
    public void handleMessage(Channel channel, Delivery delivery) {
        try {
            processMessage(delivery);
            
            lastDeliveryTag = delivery.getEnvelope().getDeliveryTag();
            hasPendingMessages = true;
            
        } catch (Exception e) {
            // ç«‹å³ç¡®è®¤ä¹‹å‰çš„æ¶ˆæ¯
            if (hasPendingMessages) {
                channel.basicAck(lastDeliveryTag, true);
                hasPendingMessages = false;
            }
            // æ‹’ç»å½“å‰æ¶ˆæ¯
            channel.basicNack(delivery.getEnvelope().getDeliveryTag(), 
                              false, true);
        }
    }
}
```

### 6.3 æ‰¹é‡ç¡®è®¤çš„æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æé†’**
```
æ‰¹é‡ç¡®è®¤é£é™©ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¶ˆæ¯1 âœ… â†’ æ¶ˆæ¯2 âŒ â†’ æ¶ˆæ¯3 âœ…       â”‚
â”‚                  â†“                â”‚
â”‚         å¦‚æœæ­¤æ—¶æ‰¹é‡ç¡®è®¤              â”‚
â”‚                  â†“                â”‚
â”‚    æ¶ˆæ¯2è™½ç„¶å¤„ç†å¤±è´¥ï¼Œä½†ä¹Ÿè¢«ç¡®è®¤äº†     â”‚
â”‚              (æ¶ˆæ¯ä¸¢å¤±!)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§£å†³æ–¹æ¡ˆï¼š
1. é‡åˆ°å¤±è´¥ç«‹å³å¤„ç†ï¼Œä¸è¦ç§¯ç´¯
2. ä½¿ç”¨äº‹åŠ¡æˆ–å‘å¸ƒç¡®è®¤ä¿è¯ä¸€è‡´æ€§
3. è®°å½•å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œä¾¿äºæ’æŸ¥
```

---

## 7. ğŸš€ å®é™…åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ


### 7.1 ç”µå•†è®¢å•å¤„ç†åœºæ™¯


**ğŸ›’ ä¸šåŠ¡åœºæ™¯**
```
è®¢å•å¤„ç†æµç¨‹ï¼š
ç”¨æˆ·ä¸‹å• â†’ è®¢å•æ¶ˆæ¯ â†’ åº“å­˜æ£€æŸ¥ â†’ æ”¯ä»˜å¤„ç† â†’ å‘è´§é€šçŸ¥

æ¯ä¸ªç¯èŠ‚éƒ½ä¸èƒ½å‡ºé”™ï¼Œå¿…é¡»å¯é å¤„ç†
```

**ğŸ“ å®ç°æ–¹æ¡ˆ**
```java
@Component
public class OrderProcessor {
    
    @RabbitListener(queues = "order.process")
    public void processOrder(
        @Payload OrderMessage orderMsg,
        @Header Map<String, Object> headers,
        Channel channel,
        @Header("amqp_deliveryTag") long deliveryTag) {
        
        try {
            // 1. å‚æ•°éªŒè¯
            if (!isValidOrder(orderMsg)) {
                log.error("è®¢å•å‚æ•°æ— æ•ˆ: {}", orderMsg);
                channel.basicNack(deliveryTag, false, false);  // ç›´æ¥ä¸¢å¼ƒ
                return;
            }
            
            // 2. å¹‚ç­‰æ€§æ£€æŸ¥
            if (orderService.isProcessed(orderMsg.getOrderId())) {
                log.info("è®¢å•å·²å¤„ç†è¿‡: {}", orderMsg.getOrderId());
                channel.basicAck(deliveryTag, false);  // ç¡®è®¤æ¶ˆæ¯
                return;
            }
            
            // 3. ä¸šåŠ¡å¤„ç†
            OrderResult result = orderService.processOrder(orderMsg);
            
            if (result.isSuccess()) {
                // å¤„ç†æˆåŠŸ
                channel.basicAck(deliveryTag, false);
                
            } else if (result.isRetryable()) {
                // å¯é‡è¯•é”™è¯¯ï¼ˆå¦‚åº“å­˜ä¸è¶³ï¼‰
                int retryCount = getRetryCount(headers);
                if (retryCount < 3) {
                    // å»¶è¿Ÿé‡è¯•
                    delayAndRetry(orderMsg, retryCount + 1);
                    channel.basicAck(deliveryTag, false);
                } else {
                    // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œè½¬å…¥æ­»ä¿¡é˜Ÿåˆ—
                    channel.basicNack(deliveryTag, false, false);
                }
                
            } else {
                // ä¸å¯é‡è¯•é”™è¯¯ï¼ˆå¦‚ç”¨æˆ·ä¸å­˜åœ¨ï¼‰
                channel.basicNack(deliveryTag, false, false);
            }
            
        } catch (Exception e) {
            log.error("è®¢å•å¤„ç†å¼‚å¸¸", e);
            // ç³»ç»Ÿå¼‚å¸¸ï¼Œé‡æ–°å…¥é˜Ÿç­‰å¾…é‡è¯•
            channel.basicReject(deliveryTag, true);
        }
    }
}
```

### 7.2 æ—¥å¿—æ”¶é›†åœºæ™¯


**ğŸ“Š ä¸šåŠ¡ç‰¹ç‚¹**
- **é«˜ååé‡**ï¼šæ¯ç§’æ•°ä¸‡æ¡æ—¥å¿—
- **å¯å®¹å¿ä¸¢å¤±**ï¼šå°‘é‡æ—¥å¿—ä¸¢å¤±å½±å“ä¸å¤§
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šè¿½æ±‚å¤„ç†é€Ÿåº¦

**ğŸ“ å®ç°æ–¹æ¡ˆ**
```java
@Component
public class LogCollector {
    private static final int BATCH_SIZE = 100;
    private final List<LogMessage> batch = new ArrayList<>();
    
    @RabbitListener(queues = "log.collect")
    public void collectLog(
        @Payload LogMessage logMsg,
        Channel channel,
        @Header("amqp_deliveryTag") long deliveryTag) {
        
        try {
            // æ·»åŠ åˆ°æ‰¹æ¬¡
            synchronized (batch) {
                batch.add(logMsg);
                
                // è¾¾åˆ°æ‰¹é‡å¤§å°ï¼Œæ‰¹é‡å¤„ç†
                if (batch.size() >= BATCH_SIZE) {
                    processBatch(new ArrayList<>(batch));
                    batch.clear();
                    
                    // æ‰¹é‡ç¡®è®¤
                    channel.basicAck(deliveryTag, true);
                }
            }
            
        } catch (Exception e) {
            // æ—¥å¿—å¤„ç†å¤±è´¥ï¼Œç›´æ¥ä¸¢å¼ƒï¼ˆä¸é‡è¯•ï¼‰
            log.error("æ—¥å¿—å¤„ç†å¤±è´¥", e);
            channel.basicNack(deliveryTag, false, false);
        }
    }
    
    private void processBatch(List<LogMessage> logs) {
        // æ‰¹é‡å†™å…¥ESæˆ–æ•°æ®åº“
        logService.batchInsert(logs);
    }
}
```

### 7.3 æ–‡ä»¶å¤„ç†åœºæ™¯


**ğŸ“ ä¸šåŠ¡ç‰¹ç‚¹**
- **è€—æ—¶è¾ƒé•¿**ï¼šæ–‡ä»¶å¤„ç†å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ
- **ä¸èƒ½ä¸¢å¤±**ï¼šæ–‡ä»¶å¤„ç†ä»»åŠ¡å¾ˆé‡è¦
- **å¯èƒ½å¤±è´¥**ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯ç­‰

**ğŸ“ å®ç°æ–¹æ¡ˆ**
```java
@Component
public class FileProcessor {
    
    @RabbitListener(queues = "file.process")
    public void processFile(
        @Payload FileMessage fileMsg,
        Channel channel,
        @Header("amqp_deliveryTag") long deliveryTag) {
        
        try {
            // 1. å¿«é€Ÿç¡®è®¤æ¶ˆæ¯ï¼Œé¿å…è¶…æ—¶
            channel.basicAck(deliveryTag, false);
            
            // 2. å¼‚æ­¥å¤„ç†æ–‡ä»¶
            CompletableFuture.runAsync(() -> {
                try {
                    processFileContent(fileMsg);
                    
                    // å¤„ç†æˆåŠŸï¼Œå‘é€å®Œæˆé€šçŸ¥
                    notificationService.sendSuccess(fileMsg);
                    
                } catch (Exception e) {
                    // å¤„ç†å¤±è´¥ï¼Œå‘é€é”™è¯¯é€šçŸ¥
                    notificationService.sendError(fileMsg, e);
                    
                    // é‡æ–°å‘å¸ƒä»»åŠ¡ï¼ˆå¸¦é‡è¯•æ ‡è®°ï¼‰
                    republishFileTask(fileMsg);
                }
            });
            
        } catch (Exception e) {
            // ç¡®è®¤å¤±è´¥ï¼Œé‡æ–°å…¥é˜Ÿ
            channel.basicReject(deliveryTag, true);
        }
    }
    
    private void processFileContent(FileMessage fileMsg) {
        // å®é™…çš„æ–‡ä»¶å¤„ç†é€»è¾‘
        // å¯èƒ½è€—æ—¶å¾ˆé•¿
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ACKæœºåˆ¶æœ¬è´¨ï¼šæ¶ˆè´¹è€…å‘RabbitMQç¡®è®¤æ¶ˆæ¯å·²æ­£ç¡®å¤„ç†
ğŸ”¸ è‡ªåŠ¨vsæ‰‹åŠ¨ï¼šæ€§èƒ½ä¸å¯é æ€§çš„æƒè¡¡é€‰æ‹©
ğŸ”¸ ä¸‰ç§æ“ä½œï¼šACKç¡®è®¤ã€NACKæ‰¹é‡æ‹’ç»ã€Rejectå•æ¡æ‹’ç»
ğŸ”¸ é‡æ–°å…¥é˜Ÿï¼šå¤±è´¥æ¶ˆæ¯å¯ä»¥é‡æ–°æŠ•é€’ï¼Œéœ€é˜²æ­¢æ— é™å¾ªç¯
ğŸ”¸ ç¡®è®¤è¶…æ—¶ï¼šé•¿æ—¶é—´æœªç¡®è®¤ä¼šå¯¼è‡´è¿æ¥å…³é—­
ğŸ”¸ æ‰¹é‡ä¼˜åŒ–ï¼šå‡å°‘ç½‘ç»œè°ƒç”¨ï¼Œæå‡å¤„ç†æ€§èƒ½
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ç”¨è‡ªåŠ¨ç¡®è®¤**
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… æ—¥å¿—æ”¶é›†ã€ç›‘æ§æ•°æ®ç­‰å¯å®¹å¿ä¸¢å¤±çš„åœºæ™¯
âœ… é«˜å¹¶å‘ã€å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
âœ… ç®€å•çš„é€šçŸ¥ç±»æ¶ˆæ¯

ä¸é€‚ç”¨ï¼š
âŒ è®¢å•ã€æ”¯ä»˜ç­‰å…³é”®ä¸šåŠ¡æ•°æ®
âŒ éœ€è¦äº‹åŠ¡ä¸€è‡´æ€§çš„åœºæ™¯
âŒ å¤„ç†é€»è¾‘å¤æ‚ï¼Œå¯èƒ½å‡ºé”™çš„åœºæ™¯
```

**ğŸ”¹ å¦‚ä½•æ­£ç¡®ä½¿ç”¨æ‰‹åŠ¨ç¡®è®¤**
```
åŸºæœ¬åŸåˆ™ï¼š
1. å¤„ç†æˆåŠŸ â†’ basic.ackç¡®è®¤
2. å¯é‡è¯•å¤±è´¥ â†’ basic.nacké‡æ–°å…¥é˜Ÿ
3. ä¸å¯é‡è¯•å¤±è´¥ â†’ basic.nackä¸¢å¼ƒ
4. ç³»ç»Ÿå¼‚å¸¸ â†’ basic.rejecté‡æ–°å…¥é˜Ÿ

æ³¨æ„äº‹é¡¹ï¼š
â€¢ ç¡®è®¤æ“ä½œè¦æ”¾åœ¨finallyå—æˆ–try-catchä¸­
â€¢ æ‰¹é‡ç¡®è®¤æ—¶è¦ç‰¹åˆ«å°å¿ƒå¤±è´¥å¤„ç†
â€¢ é•¿æ—¶é—´å¤„ç†è¦è€ƒè™‘è¶…æ—¶é—®é¢˜
```

**ğŸ”¹ é‡æ–°å…¥é˜Ÿçš„æœ€ä½³å®è·µ**
```
é˜²æ­¢æ­»å¾ªç¯ï¼š
â€¢ è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°
â€¢ ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—å¤„ç†å¤±è´¥æ¶ˆæ¯
â€¢ è®°å½•é‡è¯•æ¬¡æ•°åœ¨æ¶ˆæ¯å¤´ä¸­
â€¢ å¯¹ä¸åŒé”™è¯¯ç±»å‹é‡‡ç”¨ä¸åŒç­–ç•¥
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯é€‰æ‹©æŒ‡å—**

| ä¸šåŠ¡ç±»å‹ | **ç¡®è®¤æ¨¡å¼** | **å¤„ç†ç­–ç•¥** | **å…¸å‹åº”ç”¨** |
|---------|------------|------------|------------|
| **å…³é”®ä¸šåŠ¡** | `æ‰‹åŠ¨ç¡®è®¤` | `ä¸¥æ ¼é”™è¯¯å¤„ç†+é‡è¯•` | `è®¢å•å¤„ç†ã€æ”¯ä»˜` |
| **æ—¥å¿—ç»Ÿè®¡** | `è‡ªåŠ¨ç¡®è®¤` | `å¿«é€Ÿå¤„ç†+å®¹å¿ä¸¢å¤±` | `ç”¨æˆ·è¡Œä¸ºæ—¥å¿—` |
| **æ–‡ä»¶å¤„ç†** | `æ‰‹åŠ¨ç¡®è®¤` | `å¿«é€Ÿç¡®è®¤+å¼‚æ­¥å¤„ç†` | `å›¾ç‰‡å¤„ç†ã€æ–‡æ¡£è½¬æ¢` |
| **é€šçŸ¥æ¶ˆæ¯** | `æ‰‹åŠ¨ç¡®è®¤` | `å¤±è´¥ç›´æ¥ä¸¢å¼ƒ` | `é‚®ä»¶ã€çŸ­ä¿¡` |

**ğŸ›¡ï¸ å¯é æ€§ä¿éšœç­–ç•¥**
- **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§æœªç¡®è®¤æ¶ˆæ¯æ•°é‡
- **æ­»ä¿¡é˜Ÿåˆ—**ï¼šå¤„ç†å½»åº•å¤±è´¥çš„æ¶ˆæ¯
- **å¹‚ç­‰è®¾è®¡**ï¼šé˜²æ­¢é‡å¤å¤„ç†
- **äº‹åŠ¡æ”¯æŒ**ï¼šå…³é”®ä¸šåŠ¡ä½¿ç”¨äº‹åŠ¡ç¡®è®¤

### 8.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


```
ğŸš€ æ€§èƒ½æå‡æŠ€å·§ï¼š

1. æ‰¹é‡ç¡®è®¤ï¼šå‡å°‘ç½‘ç»œIO
2. å¼‚æ­¥å¤„ç†ï¼šé¿å…é˜»å¡æ¶ˆè´¹
3. è¿æ¥å¤ç”¨ï¼šå‡å°‘è¿æ¥å¼€é”€
4. é¢„å–æ§åˆ¶ï¼šæ§åˆ¶æœªç¡®è®¤æ¶ˆæ¯æ•°é‡
5. åˆç†è¶…æ—¶ï¼šé¿å…ä¸å¿…è¦çš„é‡è¿
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ACKåƒå¿«é€’ç­¾æ”¶ï¼Œç¡®è®¤åæ¶ˆæ¯æ‰ä¼šåˆ é™¤
- æ‰‹åŠ¨ç¡®è®¤æ›´å¯é ï¼Œè‡ªåŠ¨ç¡®è®¤æ›´å¿«é€Ÿ
- é‡æ–°å…¥é˜Ÿè¦é˜²å¾ªç¯ï¼Œæ‰¹é‡ç¡®è®¤è¦å°å¿ƒ
- ä¸åŒä¸šåŠ¡é€‰ä¸åŒç­–ç•¥ï¼Œç›‘æ§å‘Šè­¦ä¿å¯é 