---
title: 7ã€æ¶ˆæ¯TTLä¸è¿‡æœŸ
---
## ğŸ“š ç›®å½•

1. [TTLåŸºç¡€æ¦‚å¿µ](#1-TTLåŸºç¡€æ¦‚å¿µ)
2. [æ¶ˆæ¯çº§åˆ«TTL](#2-æ¶ˆæ¯çº§åˆ«TTL)
3. [é˜Ÿåˆ—çº§åˆ«TTL](#3-é˜Ÿåˆ—çº§åˆ«TTL)
4. [è¿‡æœŸæ¶ˆæ¯å¤„ç†æœºåˆ¶](#4-è¿‡æœŸæ¶ˆæ¯å¤„ç†æœºåˆ¶)
5. [TTLä¼˜å…ˆçº§è§„åˆ™](#5-TTLä¼˜å…ˆçº§è§„åˆ™)
6. [å®é™…åº”ç”¨åœºæ™¯](#6-å®é™…åº”ç”¨åœºæ™¯)
7. [æ€§èƒ½ä¼˜åŒ–è€ƒè™‘](#7-æ€§èƒ½ä¼˜åŒ–è€ƒè™‘)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ• TTLåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯TTL

**TTLï¼ˆTime To Liveï¼‰**ï¼šæ¶ˆæ¯çš„ç”Ÿå­˜æ—¶é—´ï¼Œç®€å•è¯´å°±æ˜¯**æ¶ˆæ¯çš„"ä¿è´¨æœŸ"**

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> TTLå°±åƒé£Ÿå“çš„ä¿è´¨æœŸæ ‡ç­¾ï¼Œè¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œé£Ÿå“å°±ä¸èƒ½å†é£Ÿç”¨äº†ã€‚  
> æ¶ˆæ¯çš„TTLè¿‡æœŸåï¼ŒRabbitMQå°±ä¼šå°†å…¶ä»é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚

```
TTLæ ¸å¿ƒä½œç”¨ï¼š
ğŸ”¸ é˜²æ­¢æ¶ˆæ¯æ— é™å †ç§¯
ğŸ”¸ é‡Šæ”¾é˜Ÿåˆ—å­˜å‚¨ç©ºé—´  
ğŸ”¸ ç¡®ä¿æ¶ˆæ¯æ—¶æ•ˆæ€§
ğŸ”¸ é¿å…å¤„ç†è¿‡æœŸä»»åŠ¡
```

### 1.2 TTLçš„ä¸¤ç§è®¾ç½®æ–¹å¼


```
ğŸ“Š TTLè®¾ç½®å±‚çº§å¯¹æ¯”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¶ˆæ¯çº§åˆ«TTL    â”‚    â”‚   é˜Ÿåˆ—çº§åˆ«TTL    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¯æ¡æ¶ˆæ¯ç‹¬ç«‹è®¾ç½®  â”‚    â”‚ æ•´ä¸ªé˜Ÿåˆ—ç»Ÿä¸€è®¾ç½®  â”‚
â”‚ ç²¾ç¡®æ§åˆ¶        â”‚    â”‚ ç®¡ç†ç®€å•        â”‚
â”‚ æ€§èƒ½å¼€é”€è¾ƒå¤§     â”‚    â”‚ æ€§èƒ½å¼€é”€è¾ƒå°     â”‚
â”‚ é€‚åˆç‰¹æ®Šéœ€æ±‚     â”‚    â”‚ é€‚åˆé€šç”¨åœºæ™¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 TTLçš„è®¡æ—¶èµ·ç‚¹


**ğŸ¯ é‡è¦ç†è§£**ï¼šTTLçš„è®¡æ—¶ä»**æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—**å¼€å§‹ï¼Œä¸æ˜¯ä»å‘é€æ—¶å¼€å§‹

```
æ—¶é—´çº¿ç¤ºä¾‹ï¼š
ç”Ÿäº§è€…å‘é€ â”€â”€1ç§’å»¶è¿Ÿâ”€â”€> æ¶ˆæ¯å…¥é˜Ÿ â”€â”€TTLè®¡æ—¶å¼€å§‹â”€â”€> 10ç§’åè¿‡æœŸ
         (ç½‘ç»œä¼ è¾“)      (è¿™é‡Œå¼€å§‹è®¡æ—¶)
```

---

## 2. ğŸ“¨ æ¶ˆæ¯çº§åˆ«TTL


### 2.1 åŸºæœ¬ä½¿ç”¨æ–¹å¼


**æ¶ˆæ¯çº§åˆ«TTL**ï¼šä¸ºæ¯æ¡æ¶ˆæ¯å•ç‹¬è®¾ç½®è¿‡æœŸæ—¶é—´

> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> å°±åƒç»™æ¯ä¸ªå¿«é€’åŒ…è£¹å•ç‹¬è´´ä¸Š"é™æ—¶é€è¾¾"æ ‡ç­¾ï¼Œæ¯ä¸ªåŒ…è£¹éƒ½æœ‰è‡ªå·±çš„æ—¶æ•ˆè¦æ±‚

```java
// Javaå®¢æˆ·ç«¯è®¾ç½®æ¶ˆæ¯TTL
AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
    .expiration("10000")  // 10ç§’åè¿‡æœŸï¼Œå•ä½ï¼šæ¯«ç§’
    .build();

channel.basicPublish("", "task_queue", properties, "Hello World!".getBytes());
```

### 2.2 å®é™…åº”ç”¨ç¤ºä¾‹


**åœºæ™¯ï¼šè®¢å•æ”¯ä»˜è¶…æ—¶å¤„ç†**

```java
// å‘é€è®¢å•æ”¯ä»˜è¶…æ—¶æ£€æŸ¥æ¶ˆæ¯
public void sendPaymentTimeoutCheck(String orderId, int timeoutMinutes) {
    // è®¡ç®—TTLï¼ˆè½¬æ¢ä¸ºæ¯«ç§’ï¼‰
    String ttl = String.valueOf(timeoutMinutes * 60 * 1000);
    
    AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
        .expiration(ttl)  // æ”¯ä»˜è¶…æ—¶æ—¶é—´
        .build();
        
    String message = "CHECK_PAYMENT:" + orderId;
    channel.basicPublish("payment_exchange", "timeout_check", 
                        properties, message.getBytes());
}

// ä½¿ç”¨ç¤ºä¾‹
sendPaymentTimeoutCheck("ORDER_123", 15);  // 15åˆ†é’Ÿåæ£€æŸ¥æ”¯ä»˜çŠ¶æ€
```

### 2.3 æ¶ˆæ¯TTLçš„ç‰¹ç‚¹


```
âœ… ä¼˜åŠ¿ï¼š
ğŸ”¸ çµæ´»æ€§é«˜ - æ¯æ¡æ¶ˆæ¯å¯ä»¥ä¸åŒçš„TTL
ğŸ”¸ ç²¾ç¡®æ§åˆ¶ - é€‚åˆå¤æ‚ä¸šåŠ¡åœºæ™¯
ğŸ”¸ åŠ¨æ€è°ƒæ•´ - å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®æ—¶è°ƒæ•´

âŒ åŠ£åŠ¿ï¼š
ğŸ”¸ æ€§èƒ½å¼€é”€ - æ¯æ¡æ¶ˆæ¯éƒ½éœ€è¦å•ç‹¬å¤„ç†
ğŸ”¸ å†…å­˜å ç”¨ - éœ€è¦é¢å¤–å­˜å‚¨TTLä¿¡æ¯
ğŸ”¸ ç®¡ç†å¤æ‚ - éš¾ä»¥ç»Ÿä¸€ç®¡ç†è¿‡æœŸç­–ç•¥
```

---

## 3. ğŸ“‹ é˜Ÿåˆ—çº§åˆ«TTL


### 3.1 åŸºæœ¬ä½¿ç”¨æ–¹å¼


**é˜Ÿåˆ—çº§åˆ«TTL**ï¼šä¸ºæ•´ä¸ªé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯è®¾ç½®ç»Ÿä¸€çš„è¿‡æœŸæ—¶é—´

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> å°±åƒè¶…å¸‚çš„é¢åŒ…æŸœï¼Œæ‰€æœ‰ä»Šå¤©ç”Ÿäº§çš„é¢åŒ…éƒ½æ ‡æ³¨"24å°æ—¶å†…é£Ÿç”¨"

```java
// å£°æ˜é˜Ÿåˆ—æ—¶è®¾ç½®TTL
Map<String, Object> args = new HashMap<>();
args.put("x-message-ttl", 60000);  // 60ç§’ï¼Œå•ä½ï¼šæ¯«ç§’

channel.queueDeclare("temp_queue", true, false, false, args);
```

### 3.2 å®é™…åº”ç”¨ç¤ºä¾‹


**åœºæ™¯ï¼šä¸´æ—¶ä»»åŠ¡é˜Ÿåˆ—**

```java
// åˆ›å»ºä¸´æ—¶ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯5åˆ†é’Ÿè¿‡æœŸï¼‰
public void createTempTaskQueue() {
    Map<String, Object> args = new HashMap<>();
    args.put("x-message-ttl", 300000);  // 5åˆ†é’Ÿ = 300ç§’ = 300000æ¯«ç§’
    
    channel.queueDeclare("temp_tasks", 
                        true,    // durable
                        false,   // exclusive  
                        false,   // autoDelete
                        args);   // arguments
}

// å‘é€ä¸´æ—¶ä»»åŠ¡ï¼ˆè‡ªåŠ¨ç»§æ‰¿é˜Ÿåˆ—TTLï¼‰
public void sendTempTask(String taskData) {
    channel.basicPublish("", "temp_tasks", null, taskData.getBytes());
    // è¿™æ¡æ¶ˆæ¯ä¼šåœ¨5åˆ†é’Ÿåè‡ªåŠ¨è¿‡æœŸ
}
```

### 3.3 é˜Ÿåˆ—TTLçš„ç‰¹ç‚¹


```
âœ… ä¼˜åŠ¿ï¼š
ğŸ”¸ æ€§èƒ½é«˜æ•ˆ - ç»Ÿä¸€å¤„ç†ï¼Œå¼€é”€å°
ğŸ”¸ ç®¡ç†ç®€å• - ä¸€æ¬¡è®¾ç½®ï¼Œå…¨é˜Ÿåˆ—ç”Ÿæ•ˆ
ğŸ”¸ å†…å­˜å‹å¥½ - ä¸éœ€è¦ä¸ºæ¯æ¡æ¶ˆæ¯å­˜å‚¨TTL

âŒ åŠ£åŠ¿ï¼š
ğŸ”¸ çµæ´»æ€§å·® - æ‰€æœ‰æ¶ˆæ¯ä½¿ç”¨ç›¸åŒTTL
ğŸ”¸ ä¸èƒ½åŠ¨æ€è°ƒæ•´ - é˜Ÿåˆ—åˆ›å»ºåæ— æ³•ä¿®æ”¹
ğŸ”¸ é€‚ç”¨åœºæ™¯æœ‰é™ - åªé€‚åˆç»Ÿä¸€éœ€æ±‚çš„åœºæ™¯
```

---

## 4. ğŸ—‘ï¸ è¿‡æœŸæ¶ˆæ¯å¤„ç†æœºåˆ¶


### 4.1 è¿‡æœŸæ¶ˆæ¯çš„å‘½è¿


**æ¶ˆæ¯è¿‡æœŸåä¼šæ€æ ·ï¼Ÿ**

```
è¿‡æœŸæ¶ˆæ¯å¤„ç†æµç¨‹ï¼š

æ¶ˆæ¯è¿‡æœŸ â”€â”€æ£€æŸ¥â”€â”€> æ˜¯å¦æœ‰æ­»ä¿¡äº¤æ¢æœºï¼Ÿ
    â”‚                    â”‚
    â”‚                   æ˜¯â”‚    â”‚å¦
    â”‚                    â–¼    â–¼
    â”‚              è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—  ç›´æ¥ä¸¢å¼ƒ
    â”‚                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> ä»åŸé˜Ÿåˆ—ç§»é™¤
```

### 4.2 æ­»ä¿¡é˜Ÿåˆ—é…ç½®


**å°†è¿‡æœŸæ¶ˆæ¯è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œåç»­å¤„ç†**

```java
// 1. åˆ›å»ºæ­»ä¿¡äº¤æ¢æœºå’Œé˜Ÿåˆ—
channel.exchangeDeclare("dlx_exchange", "direct");
channel.queueDeclare("dead_letter_queue", true, false, false, null);
channel.queueBind("dead_letter_queue", "dlx_exchange", "expired");

// 2. åˆ›å»ºä¸»é˜Ÿåˆ—ï¼Œé…ç½®æ­»ä¿¡äº¤æ¢æœº
Map<String, Object> args = new HashMap<>();
args.put("x-message-ttl", 30000);              // 30ç§’TTL
args.put("x-dead-letter-exchange", "dlx_exchange");    // æ­»ä¿¡äº¤æ¢æœº
args.put("x-dead-letter-routing-key", "expired");     // æ­»ä¿¡è·¯ç”±é”®

channel.queueDeclare("main_queue", true, false, false, args);
```

### 4.3 è¿‡æœŸæ¶ˆæ¯ç›‘æ§ç¤ºä¾‹


```java
// ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¤„ç†è¿‡æœŸæ¶ˆæ¯
public void handleExpiredMessages() {
    DeliverCallback deliverCallback = (consumerTag, delivery) -> {
        String message = new String(delivery.getBody(), "UTF-8");
        
        // è·å–è¿‡æœŸåŸå› 
        Map<String, Object> headers = delivery.getProperties().getHeaders();
        if (headers != null && "expired".equals(headers.get("x-death-reason"))) {
            System.out.println("å¤„ç†è¿‡æœŸæ¶ˆæ¯: " + message);
            // æ‰§è¡Œè¿‡æœŸåçš„ä¸šåŠ¡é€»è¾‘
            handleExpiredTask(message);
        }
    };
    
    channel.basicConsume("dead_letter_queue", true, deliverCallback, consumerTag -> {});
}
```

---

## 5. âš–ï¸ TTLä¼˜å…ˆçº§è§„åˆ™


### 5.1 ä¼˜å…ˆçº§åˆ¤æ–­æœºåˆ¶


**å½“æ¶ˆæ¯çº§åˆ«TTLå’Œé˜Ÿåˆ—çº§åˆ«TTLåŒæ—¶å­˜åœ¨æ—¶ï¼Œè°ä¼˜å…ˆï¼Ÿ**

> ğŸ¯ **ä¼˜å…ˆçº§è§„åˆ™**ï¼š**å–è¾ƒå°å€¼**ç”Ÿæ•ˆ  
> å°±åƒ"å°±ä½ä¸å°±é«˜"åŸåˆ™ï¼Œå“ªä¸ªæ—¶é—´çŸ­å°±æŒ‰å“ªä¸ªæ‰§è¡Œ

```
ä¼˜å…ˆçº§åˆ¤æ–­è¡¨ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¶ˆæ¯TTL    â”‚   é˜Ÿåˆ—TTL   â”‚   å®é™…TTL   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   10ç§’      â”‚   30ç§’      â”‚   10ç§’      â”‚
â”‚   60ç§’      â”‚   30ç§’      â”‚   30ç§’      â”‚
â”‚   æœªè®¾ç½®     â”‚   20ç§’      â”‚   20ç§’      â”‚
â”‚   15ç§’      â”‚   æœªè®¾ç½®     â”‚   15ç§’      â”‚
â”‚   æœªè®¾ç½®     â”‚   æœªè®¾ç½®     â”‚   æ°¸ä¸è¿‡æœŸ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å®é™…éªŒè¯ç¤ºä¾‹


```java
// æµ‹è¯•TTLä¼˜å…ˆçº§
public void testTTLPriority() {
    // é˜Ÿåˆ—TTLï¼š30ç§’
    Map<String, Object> queueArgs = new HashMap<>();
    queueArgs.put("x-message-ttl", 30000);
    channel.queueDeclare("priority_test", true, false, false, queueArgs);
    
    // æ¶ˆæ¯1ï¼šTTL 10ç§’ï¼ˆæ¯”é˜Ÿåˆ—çŸ­ï¼ŒæŒ‰10ç§’æ‰§è¡Œï¼‰
    AMQP.BasicProperties props1 = new AMQP.BasicProperties.Builder()
        .expiration("10000").build();
    channel.basicPublish("", "priority_test", props1, "Message 1".getBytes());
    
    // æ¶ˆæ¯2ï¼šTTL 60ç§’ï¼ˆæ¯”é˜Ÿåˆ—é•¿ï¼ŒæŒ‰30ç§’æ‰§è¡Œï¼‰
    AMQP.BasicProperties props2 = new AMQP.BasicProperties.Builder()
        .expiration("60000").build();
    channel.basicPublish("", "priority_test", props2, "Message 2".getBytes());
    
    // æ¶ˆæ¯3ï¼šæ— TTLï¼ˆæŒ‰é˜Ÿåˆ—30ç§’æ‰§è¡Œï¼‰
    channel.basicPublish("", "priority_test", null, "Message 3".getBytes());
}
```

### 5.3 ä¼˜å…ˆçº§è§„åˆ™çš„ä¸šåŠ¡æ„ä¹‰


```
ğŸ¯ å®é™…åº”ç”¨åœºæ™¯ï¼š

ç´§æ€¥é€šçŸ¥ç³»ç»Ÿï¼š
â€¢ é˜Ÿåˆ—é»˜è®¤TTLï¼š1å°æ—¶ï¼ˆæ™®é€šæ¶ˆæ¯ï¼‰
â€¢ ç´§æ€¥æ¶ˆæ¯TTLï¼š5åˆ†é’Ÿï¼ˆä¼˜å…ˆå¤„ç†ï¼‰
â€¢ ä¸´æ—¶æ¶ˆæ¯TTLï¼š10åˆ†é’Ÿï¼ˆåŠæ—¶æ¸…ç†ï¼‰

ç»“æœï¼š
â€¢ ç´§æ€¥æ¶ˆæ¯ï¼š5åˆ†é’Ÿåè¿‡æœŸ âœ“
â€¢ ä¸´æ—¶æ¶ˆæ¯ï¼š10åˆ†é’Ÿåè¿‡æœŸ âœ“  
â€¢ æ™®é€šæ¶ˆæ¯ï¼š1å°æ—¶åè¿‡æœŸ âœ“
```

---

## 6. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 6.1 è®¢å•è¶…æ—¶å¤„ç†


**ä¸šåŠ¡éœ€æ±‚**ï¼šè®¢å•åˆ›å»ºå15åˆ†é’Ÿå†…å¿…é¡»æ”¯ä»˜ï¼Œå¦åˆ™è‡ªåŠ¨å–æ¶ˆ

```java
public class OrderTimeoutHandler {
    
    // åˆ›å»ºè®¢å•æ—¶å‘é€è¶…æ—¶æ£€æŸ¥æ¶ˆæ¯
    public void createOrder(String orderId) {
        // ä¸šåŠ¡é€»è¾‘ï¼šåˆ›å»ºè®¢å•
        saveOrder(orderId);
        
        // å‘é€15åˆ†é’Ÿåçš„è¶…æ—¶æ£€æŸ¥
        sendTimeoutCheck(orderId, 15);
    }
    
    private void sendTimeoutCheck(String orderId, int minutes) {
        AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
            .expiration(String.valueOf(minutes * 60 * 1000))  // è½¬æ¢ä¸ºæ¯«ç§’
            .build();
            
        String message = "TIMEOUT_CHECK:" + orderId;
        channel.basicPublish("order_exchange", "timeout", properties, 
                            message.getBytes());
    }
    
    // å¤„ç†è¶…æ—¶æ£€æŸ¥ï¼ˆä»æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹ï¼‰
    public void handleTimeoutCheck(String orderId) {
        Order order = getOrder(orderId);
        if (order != null && !order.isPaid()) {
            cancelOrder(orderId);  // è‡ªåŠ¨å–æ¶ˆæœªæ”¯ä»˜è®¢å•
            notifyCustomer(orderId, "è®¢å•è¶…æ—¶å·²å–æ¶ˆ");
        }
    }
}
```

### 6.2 ç¼“å­˜é¢„çƒ­ä»»åŠ¡


**ä¸šåŠ¡éœ€æ±‚**ï¼šç¼“å­˜é¢„çƒ­ä»»åŠ¡5åˆ†é’Ÿåå¤±æ•ˆï¼Œé¿å…é‡å¤æ‰§è¡Œ

```java
// åˆ›å»ºç¼“å­˜é¢„çƒ­é˜Ÿåˆ—
Map<String, Object> args = new HashMap<>();
args.put("x-message-ttl", 300000);  // 5åˆ†é’ŸTTL

channel.queueDeclare("cache_warmup", true, false, false, args);

// å‘é€é¢„çƒ­ä»»åŠ¡
public void scheduleWarmup(String cacheKey) {
    String task = "WARMUP:" + cacheKey;
    channel.basicPublish("", "cache_warmup", null, task.getBytes());
    // ä»»åŠ¡ä¼šåœ¨5åˆ†é’Ÿåè‡ªåŠ¨è¿‡æœŸï¼Œé¿å…è¿‡æœŸæ‰§è¡Œ
}
```

### 6.3 ä¸´æ—¶æ–‡ä»¶æ¸…ç†


**ä¸šåŠ¡éœ€æ±‚**ï¼šä¸´æ—¶æ–‡ä»¶ä¸Šä¼ å1å°æ—¶å†…æœ‰æ•ˆï¼Œè¶…æ—¶è‡ªåŠ¨æ ‡è®°æ¸…ç†

```java
// ä¸´æ—¶æ–‡ä»¶TTLé…ç½®
public void uploadTempFile(String fileId, String filePath) {
    // ä¿å­˜æ–‡ä»¶ä¿¡æ¯
    saveTempFile(fileId, filePath);
    
    // å‘é€1å°æ—¶åçš„æ¸…ç†æ¶ˆæ¯
    AMQP.BasicProperties properties = new AMQP.BasicProperties.Builder()
        .expiration("3600000")  // 1å°æ—¶ = 3600ç§’ = 3600000æ¯«ç§’
        .build();
        
    String cleanupMsg = "CLEANUP:" + fileId;
    channel.basicPublish("file_exchange", "cleanup", properties, 
                        cleanupMsg.getBytes());
}
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘


### 7.1 TTLè®¾ç½®ç­–ç•¥å¯¹æ¯”


| ç­–ç•¥ç±»å‹ | **æ€§èƒ½å½±å“** | **é€‚ç”¨åœºæ™¯** | **æ¨èæŒ‡æ•°** |
|---------|-------------|-------------|-------------|
| ğŸŸ¢ **é˜Ÿåˆ—çº§åˆ«TTL** | `æå°å¼€é”€` | `ç»Ÿä¸€è¿‡æœŸéœ€æ±‚` | `â­â­â­â­â­` |
| ğŸŸ¡ **å°‘é‡æ¶ˆæ¯TTL** | `è½»å¾®å¼€é”€` | `ç‰¹æ®Šæ¶ˆæ¯å¤„ç†` | `â­â­â­â­` |
| ğŸ”´ **å¤§é‡æ¶ˆæ¯TTL** | `æ˜¾è‘—å¼€é”€` | `å¤æ‚ä¸šåŠ¡é€»è¾‘` | `â­â­` |

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ“Š æœ€ä½³å®è·µç­–ç•¥**

```
ğŸ”¸ ä¼˜å…ˆä½¿ç”¨é˜Ÿåˆ—çº§åˆ«TTL
  â”œâ”€ é€‚åˆ80%çš„åœºæ™¯
  â”œâ”€ æ€§èƒ½å¼€é”€æœ€å°
  â””â”€ ç®¡ç†ç»´æŠ¤ç®€å•

ğŸ”¸ è°¨æ…ä½¿ç”¨æ¶ˆæ¯çº§åˆ«TTL  
  â”œâ”€ ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨
  â”œâ”€ æ§åˆ¶ä½¿ç”¨é¢‘ç‡
  â””â”€ ç›‘æ§æ€§èƒ½å½±å“

ğŸ”¸ åˆç†è®¾ç½®TTLæ—¶é•¿
  â”œâ”€ é¿å…è¿‡çŸ­ï¼ˆé¢‘ç¹è¿‡æœŸï¼‰
  â”œâ”€ é¿å…è¿‡é•¿ï¼ˆèµ„æºæµªè´¹ï¼‰
  â””â”€ æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´
```

### 7.3 å†…å­˜ä½¿ç”¨ä¼˜åŒ–


```java
// âœ… æ¨èï¼šé˜Ÿåˆ—çº§åˆ«TTL
Map<String, Object> args = new HashMap<>();
args.put("x-message-ttl", 300000);  // 5åˆ†é’Ÿç»Ÿä¸€TTL
channel.queueDeclare("efficient_queue", true, false, false, args);

// âŒ é¿å…ï¼šå¤§é‡æ¶ˆæ¯çº§åˆ«TTL
for (int i = 0; i < 10000; i++) {
    AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()
        .expiration("300000").build();  // æ¯æ¡æ¶ˆæ¯éƒ½è®¾ç½®ï¼Œå¼€é”€å¤§
    channel.basicPublish("", "queue", props, ("msg" + i).getBytes());
}
```

### 7.4 ç›‘æ§æŒ‡æ ‡


**ğŸ” å…³é”®ç›‘æ§æŒ‡æ ‡**

```
æ€§èƒ½ç›‘æ§é‡ç‚¹ï¼š
ğŸ“ˆ é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯é‡ï¼šé˜²æ­¢TTLè®¾ç½®è¿‡é•¿
ğŸ“ˆ æ¶ˆæ¯è¿‡æœŸç‡ï¼šç›‘æ§TTLè®¾ç½®åˆç†æ€§  
ğŸ“ˆ å†…å­˜ä½¿ç”¨é‡ï¼šè¯„ä¼°TTLç­–ç•¥å½±å“
ğŸ“ˆ å¤„ç†å»¶è¿Ÿï¼šç¡®ä¿TTLä¸å½±å“å®æ—¶æ€§
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ TTLæœ¬è´¨ï¼šæ¶ˆæ¯çš„"ä¿è´¨æœŸ"ï¼Œè¿‡æœŸåè‡ªåŠ¨å¤„ç†
ğŸ”¸ ä¸¤ç§è®¾ç½®æ–¹å¼ï¼šæ¶ˆæ¯çº§åˆ«ï¼ˆçµæ´»ï¼‰vs é˜Ÿåˆ—çº§åˆ«ï¼ˆé«˜æ•ˆï¼‰
ğŸ”¸ ä¼˜å…ˆçº§è§„åˆ™ï¼šæ¶ˆæ¯TTLå’Œé˜Ÿåˆ—TTLå–è¾ƒå°å€¼
ğŸ”¸ è¿‡æœŸå¤„ç†ï¼šå¯ä¸¢å¼ƒæˆ–è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—
ğŸ”¸ æ€§èƒ½è€ƒè™‘ï¼šé˜Ÿåˆ—çº§åˆ«TTLæ€§èƒ½æ›´ä¼˜
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ TTLçš„è®¡æ—¶èµ·ç‚¹**
```
é‡è¦æé†’ï¼š
TTLä»æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—å¼€å§‹è®¡æ—¶ï¼Œä¸æ˜¯å‘é€æ—¶é—´
è¿™ä¸ªç»†èŠ‚åœ¨å»¶è¿Ÿæ•æ„Ÿçš„åœºæ™¯ä¸­éå¸¸é‡è¦
```

**ğŸ”¹ é€‰æ‹©ç­–ç•¥**
```
é˜Ÿåˆ—çº§åˆ«TTLï¼š
âœ… ç»Ÿä¸€è¿‡æœŸéœ€æ±‚ï¼ˆå¦‚ä¸´æ—¶ä»»åŠ¡ã€ç¼“å­˜é¢„çƒ­ï¼‰
âœ… æ€§èƒ½æ•æ„Ÿåœºæ™¯
âœ… å¤§æ‰¹é‡æ¶ˆæ¯å¤„ç†

æ¶ˆæ¯çº§åˆ«TTLï¼š
âœ… ä¸åŒæ¶ˆæ¯ä¸åŒè¿‡æœŸæ—¶é—´
âœ… å¤æ‚ä¸šåŠ¡é€»è¾‘
âœ… ç²¾ç¡®æ§åˆ¶éœ€æ±‚
```

**ğŸ”¹ æ­»ä¿¡é˜Ÿåˆ—é…åˆ**
```
è¿‡æœŸæ¶ˆæ¯å¤„ç†ç­–ç•¥ï¼š
â€¢ ç›´æ¥ä¸¢å¼ƒï¼šé€‚åˆä¸´æ—¶æ•°æ®
â€¢ è½¬æ­»ä¿¡é˜Ÿåˆ—ï¼šé€‚åˆéœ€è¦åç»­å¤„ç†çš„åœºæ™¯
â€¢ è®°å½•æ—¥å¿—ï¼šä¾¿äºé—®é¢˜æ’æŸ¥å’Œç»Ÿè®¡åˆ†æ
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ æ ¸å¿ƒä¸šåŠ¡ä»·å€¼**
- **èµ„æºç®¡ç†**ï¼šé˜²æ­¢æ¶ˆæ¯æ— é™å †ç§¯ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´
- **ä¸šåŠ¡æ—¶æ•ˆ**ï¼šç¡®ä¿å¤„ç†ä»»åŠ¡çš„æ—¶æ•ˆæ€§
- **ç³»ç»Ÿç¨³å®š**ï¼šé¿å…é˜Ÿåˆ—è¿‡è½½å½±å“æ€§èƒ½
- **æˆæœ¬æ§åˆ¶**ï¼šå‡å°‘ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—

### 8.4 æœ€ä½³å®è·µå»ºè®®


```
ğŸ§  å®è·µè¦ç‚¹ï¼š

è®¾è®¡åŸåˆ™ï¼š
â€¢ ä¼˜å…ˆè€ƒè™‘é˜Ÿåˆ—çº§åˆ«TTL
â€¢ æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®åˆç†æ—¶é•¿
â€¢ é…åˆæ­»ä¿¡é˜Ÿåˆ—å¤„ç†è¿‡æœŸæ¶ˆæ¯
â€¢ ç›‘æ§TTLç­–ç•¥çš„æ€§èƒ½å½±å“

é¿å…é™·é˜±ï¼š
â€¢ ä¸è¦ç›²ç›®ä½¿ç”¨æ¶ˆæ¯çº§åˆ«TTL
â€¢ ä¸è¦è®¾ç½®è¿‡çŸ­çš„TTLï¼ˆå½±å“æ€§èƒ½ï¼‰
â€¢ ä¸è¦å¿½ç•¥è¿‡æœŸæ¶ˆæ¯çš„åç»­å¤„ç†
â€¢ ä¸è¦åœ¨é«˜å¹¶å‘åœºæ™¯æ»¥ç”¨æ¶ˆæ¯TTL
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- TTLæ¶ˆæ¯æœ‰ä¿è´¨æœŸï¼Œè¿‡æœŸè‡ªåŠ¨æ¥å¤„ç†
- é˜Ÿåˆ—ç»Ÿä¸€æ€§èƒ½é«˜ï¼Œæ¶ˆæ¯ç‹¬ç«‹æ›´çµæ´»
- ä¼˜å…ˆçº§è§„åˆ™å–å°å€¼ï¼Œæ­»ä¿¡é˜Ÿåˆ—åšå¤‡èƒ
- åˆç†è®¾ç½®é˜²å †ç§¯ï¼Œç›‘æ§ä¼˜åŒ–ä¿æ€§èƒ½