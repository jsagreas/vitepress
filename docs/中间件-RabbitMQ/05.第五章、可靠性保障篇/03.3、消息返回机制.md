---
title: 3ã€æ¶ˆæ¯è¿”å›æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [æ¶ˆæ¯è¿”å›æœºåˆ¶æ¦‚è¿°](#1-æ¶ˆæ¯è¿”å›æœºåˆ¶æ¦‚è¿°)
2. [Mandatoryå‚æ•°è¯¦è§£](#2-Mandatoryå‚æ•°è¯¦è§£)
3. [Return Listenerå®ç°](#3-Return-Listenerå®ç°)
4. [è·¯ç”±å¤±è´¥å¤„ç†ç­–ç•¥](#4-è·¯ç”±å¤±è´¥å¤„ç†ç­–ç•¥)
5. [å¤‡ç”¨äº¤æ¢æœºæœºåˆ¶](#5-å¤‡ç”¨äº¤æ¢æœºæœºåˆ¶)
6. [å®è·µåº”ç”¨ä¸æœ€ä½³ç­–ç•¥](#6-å®è·µåº”ç”¨ä¸æœ€ä½³ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¬ æ¶ˆæ¯è¿”å›æœºåˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯è¿”å›æœºåˆ¶


**ğŸ”¸ ç®€å•ç†è§£**
```
ç”Ÿæ´»ä¾‹å­ï¼šå¯„å¿«é€’
ä½ å¯„å¿«é€’æ—¶ï¼Œå¦‚æœæ”¶è´§åœ°å€ä¸å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ
å¿«é€’å…¬å¸ä¼šæŠŠåŒ…è£¹é€€å›ç»™ä½ ï¼Œå¯¹å§ï¼

RabbitMQæ¶ˆæ¯è¿”å›ä¹Ÿæ˜¯ä¸€æ ·ï¼š
å½“æ¶ˆæ¯å‘åˆ°äº¤æ¢æœºï¼Œä½†æ‰¾ä¸åˆ°é˜Ÿåˆ—æ¥æ”¶æ—¶
RabbitMQå¯ä»¥æŠŠæ¶ˆæ¯"é€€å›"ç»™å‘é€è€…
```

**ğŸ“‹ æ ¸å¿ƒå®šä¹‰**
- **æ¶ˆæ¯è¿”å›**ï¼šå½“æ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°ä»»ä½•é˜Ÿåˆ—æ—¶ï¼ŒRabbitMQå°†æ¶ˆæ¯è¿”å›ç»™å‘é€è€…çš„æœºåˆ¶
- **è§¦å‘æ¡ä»¶**ï¼šäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä½†æ ¹æ®è·¯ç”±é”®æ‰¾ä¸åˆ°åŒ¹é…çš„é˜Ÿåˆ—
- **å¤„ç†æ–¹å¼**ï¼šé€šè¿‡Return Listeneræ¥æ”¶è¢«é€€å›çš„æ¶ˆæ¯

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯è¿”å›æœºåˆ¶


**â“ å¸¸è§è·¯ç”±å¤±è´¥åœºæ™¯**
```
åœºæ™¯1ï¼šè·¯ç”±é”®å†™é”™äº†
å‘é€ï¼šrouting.key = "user.create"  
é˜Ÿåˆ—ï¼šç»‘å®šé”® = "user.created"
ç»“æœï¼šâŒ æ‰¾ä¸åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆæ¯ä¸¢å¤±

åœºæ™¯2ï¼šé˜Ÿåˆ—è¢«åˆ é™¤äº†
å‘é€ï¼šrouting.key = "order.pay"
çŠ¶æ€ï¼šç›®æ ‡é˜Ÿåˆ—å·²è¢«ç®¡ç†å‘˜åˆ é™¤
ç»“æœï¼šâŒ æ¶ˆæ¯æ— å¤„æŠ•é€’

åœºæ™¯3ï¼šç»‘å®šå…³ç³»é…ç½®é”™è¯¯
å‘é€ï¼šæ­£ç¡®çš„æ¶ˆæ¯
ç»‘å®šï¼šäº¤æ¢æœºä¸é˜Ÿåˆ—ç»‘å®šå…³ç³»æœ‰è¯¯
ç»“æœï¼šâŒ è·¯ç”±è§„åˆ™ä¸åŒ¹é…
```

**ğŸ’¡ è§£å†³ä»·å€¼**
- **åŠæ—¶å‘ç°é—®é¢˜**ï¼šå¿«é€ŸçŸ¥é“æ¶ˆæ¯æŠ•é€’å¤±è´¥
- **æ•°æ®ä¸ä¸¢å¤±**ï¼šå¯ä»¥é‡æ–°å¤„ç†è¢«é€€å›çš„æ¶ˆæ¯  
- **ç³»ç»Ÿç›‘æ§**ï¼šç»Ÿè®¡è·¯ç”±å¤±è´¥ç‡ï¼Œå‘ç°é…ç½®é—®é¢˜
- **é™çº§å¤„ç†**ï¼šå¯ä»¥å°†æ¶ˆæ¯å­˜å‚¨åˆ°å…¶ä»–åœ°æ–¹

---

## 2. âš™ï¸ Mandatoryå‚æ•°è¯¦è§£


### 2.1 Mandatoryå‚æ•°çš„ä½œç”¨


**ğŸ”¸ å‚æ•°å«ä¹‰**
```
mandatory = trueï¼šå¼ºåˆ¶æŠ•é€’
- å¦‚æœæ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°é˜Ÿåˆ—ï¼Œå¿…é¡»è¿”å›ç»™å‘é€è€…
- RabbitMQä¼šè§¦å‘ReturnListener

mandatory = falseï¼šéå¼ºåˆ¶æŠ•é€’ï¼ˆé»˜è®¤ï¼‰
- å¦‚æœæ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°é˜Ÿåˆ—ï¼Œç›´æ¥ä¸¢å¼ƒ
- å‘é€è€…ä¸ä¼šæ”¶åˆ°ä»»ä½•é€šçŸ¥
```

**ğŸ“Š è¡Œä¸ºå¯¹æ¯”**
```
æƒ…å†µå¯¹æ¯”ï¼šå‘é€æ¶ˆæ¯åˆ°ä¸å­˜åœ¨çš„é˜Ÿåˆ—

mandatory = falseï¼ˆé»˜è®¤ï¼‰ï¼š
å‘é€è€… â”€[æ¶ˆæ¯]â†’ äº¤æ¢æœº â”€[æ‰¾ä¸åˆ°é˜Ÿåˆ—]â†’ ğŸ—‘ï¸ ä¸¢å¼ƒ
å‘é€è€…ï¼šâœ… å‘é€æˆåŠŸï¼ˆä½†å®é™…æ¶ˆæ¯ä¸¢äº†ï¼‰

mandatory = trueï¼š
å‘é€è€… â”€[æ¶ˆæ¯]â†’ äº¤æ¢æœº â”€[æ‰¾ä¸åˆ°é˜Ÿåˆ—]â†’ â†©ï¸ è¿”å›
å‘é€è€…ï¼šğŸ“© æ”¶åˆ°ReturnListeneré€šçŸ¥
```

### 2.2 Mandatoryä½¿ç”¨ç¤ºä¾‹


**ğŸ”§ Javaä»£ç ç¤ºä¾‹**
```java
// åŸºç¡€å‘é€ï¼ˆmandatory=falseï¼Œé»˜è®¤ï¼‰
channel.basicPublish("test_exchange", "wrong.key", null, message.getBytes());
// æ¶ˆæ¯ä¸¢å¤±ï¼Œå‘é€è€…ä¸çŸ¥é“

// å¯ç”¨mandatoryå‚æ•°
channel.basicPublish(
    "test_exchange",      // äº¤æ¢æœºåç§°
    "wrong.key",          // é”™è¯¯çš„è·¯ç”±é”®  
    true,                 // mandatory = true
    null,                 // åŸºæœ¬å±æ€§
    message.getBytes()    // æ¶ˆæ¯å†…å®¹
);
// å¦‚æœè·¯ç”±å¤±è´¥ï¼Œä¼šè§¦å‘ReturnListener
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
é‡è¦æé†’ï¼š
1. mandatoryåªå½±å“"æ— æ³•è·¯ç”±"çš„æƒ…å†µ
2. å¦‚æœäº¤æ¢æœºä¸å­˜åœ¨ï¼Œä¼šç›´æ¥æŠ›å¼‚å¸¸
3. å¦‚æœé˜Ÿåˆ—å­˜åœ¨ä½†æ— æ¶ˆè´¹è€…ï¼Œä¸ä¼šè§¦å‘è¿”å›
4. è¿”å›æ˜¯å¼‚æ­¥çš„ï¼Œéœ€è¦è®¾ç½®ç›‘å¬å™¨
```

---

## 3. ğŸ§ Return Listenerå®ç°


### 3.1 Return ListeneråŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ç›‘å¬å™¨ä½œç”¨**
```
ReturnListenerå°±åƒ"å¿«é€’é€€ä»¶é€šçŸ¥"ï¼š
- ç›‘å¬æ‰€æœ‰è¢«é€€å›çš„æ¶ˆæ¯
- è·å–é€€å›åŸå› å’Œè¯¦ç»†ä¿¡æ¯
- å¯ä»¥å®ç°è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘
```

**ğŸ“‹ ReturnCallbackåŒ…å«ä¿¡æ¯**
- **replyCode**ï¼šè¿”å›ç ï¼ˆå¦‚312è¡¨ç¤ºNO_ROUTEï¼‰
- **replyText**ï¼šè¿”å›åŸå› çš„æ–‡å­—æè¿°
- **exchange**ï¼šæ¶ˆæ¯å‘é€åˆ°çš„äº¤æ¢æœº
- **routingKey**ï¼šä½¿ç”¨çš„è·¯ç”±é”®
- **properties**ï¼šæ¶ˆæ¯å±æ€§
- **body**ï¼šæ¶ˆæ¯å†…å®¹

### 3.2 å®ç°Return Listener


**ğŸ”§ åŸºç¡€å®ç°**
```java
public class MessageReturnHandler {
    
    public void setupReturnListener(Channel channel) {
        // è®¾ç½®Returnç›‘å¬å™¨
        channel.addReturnListener(new ReturnListener() {
            @Override
            public void handleReturn(int replyCode, 
                                   String replyText,
                                   String exchange, 
                                   String routingKey,
                                   AMQP.BasicProperties properties, 
                                   byte[] body) {
                
                String message = new String(body);
                System.out.printf("æ¶ˆæ¯è¢«é€€å›: %s\n", message);
                System.out.printf("é€€å›åŸå› : %s\n", replyText);
                System.out.printf("äº¤æ¢æœº: %s\n", exchange);
                System.out.printf("è·¯ç”±é”®: %s\n", routingKey);
                
                // è‡ªå®šä¹‰å¤„ç†é€»è¾‘
                handleReturnedMessage(message, replyText);
            }
        });
    }
    
    private void handleReturnedMessage(String message, String reason) {
        // è®°å½•æ—¥å¿—
        log.warn("æ¶ˆæ¯æŠ•é€’å¤±è´¥: {} åŸå› : {}", message, reason);
        
        // å¯ä»¥é€‰æ‹©çš„å¤„ç†æ–¹å¼ï¼š
        // 1. é‡æ–°å‘é€åˆ°å…¶ä»–äº¤æ¢æœº
        // 2. å­˜å‚¨åˆ°æ•°æ®åº“å¾…å¤„ç†  
        // 3. å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—
        // 4. å‘é€å‘Šè­¦é€šçŸ¥
    }
}
```

### 3.3 SpringBooté›†æˆæ–¹å¼


**ğŸ”§ SpringBooté…ç½®**
```java
@Component
public class RabbitReturnCallback implements RabbitTemplate.ReturnCallback {
    
    private static final Logger log = LoggerFactory.getLogger(RabbitReturnCallback.class);
    
    @Override
    public void returnedMessage(Message message, 
                              int replyCode, 
                              String replyText,
                              String exchange, 
                              String routingKey) {
        
        log.warn("æ¶ˆæ¯è¿”å› - äº¤æ¢æœº:{}, è·¯ç”±é”®:{}, åŸå› :{}", 
                exchange, routingKey, replyText);
        
        // è·å–æ¶ˆæ¯å†…å®¹
        String msgContent = new String(message.getBody());
        
        // æ ¹æ®ä¸åŒåŸå› é‡‡å–ä¸åŒç­–ç•¥
        switch (replyCode) {
            case 312: // NO_ROUTE
                handleNoRoute(msgContent, exchange, routingKey);
                break;
            default:
                handleOtherReturn(msgContent, replyCode, replyText);
        }
    }
    
    private void handleNoRoute(String message, String exchange, String routingKey) {
        // è·¯ç”±å¤±è´¥çš„å…·ä½“å¤„ç†
        log.info("å¤„ç†è·¯ç”±å¤±è´¥çš„æ¶ˆæ¯: {}", message);
        // TODO: å®ç°é‡è¯•æˆ–å¤‡ç”¨æ–¹æ¡ˆ
    }
}

@Configuration
public class RabbitConfig {
    
    @Bean
    public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory,
                                       RabbitReturnCallback returnCallback) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        
        // å¯ç”¨è¿”å›æœºåˆ¶
        template.setMandatory(true);
        template.setReturnCallback(returnCallback);
        
        return template;
    }
}
```

---

## 4. ğŸš¨ è·¯ç”±å¤±è´¥å¤„ç†ç­–ç•¥


### 4.1 å¸¸è§è¿”å›ç è¯´æ˜


**ğŸ“Š ä¸»è¦è¿”å›ç å«ä¹‰**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç    â”‚ å¸¸é‡å          â”‚ è¯´æ˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 312      â”‚ NO_ROUTE        â”‚ æ‰¾ä¸åˆ°åŒ¹é…çš„é˜Ÿåˆ—        â”‚
â”‚ 313      â”‚ NO_CONSUMERS    â”‚ é˜Ÿåˆ—å­˜åœ¨ä½†æ— æ¶ˆè´¹è€…      â”‚
â”‚ 314      â”‚ ACCESS_REFUSED  â”‚ è®¿é—®è¢«æ‹’ç»              â”‚
â”‚ 404      â”‚ NOT_FOUND       â”‚ äº¤æ¢æœºæˆ–é˜Ÿåˆ—ä¸å­˜åœ¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æœ€å¸¸è§çš„æ˜¯312(NO_ROUTE)ï¼š
- äº¤æ¢æœºå­˜åœ¨ï¼Œä½†æ ¹æ®è·¯ç”±é”®æ‰¾ä¸åˆ°é˜Ÿåˆ—
- é€šå¸¸æ˜¯è·¯ç”±é”®é…ç½®é”™è¯¯æˆ–é˜Ÿåˆ—ç»‘å®šé—®é¢˜
```

### 4.2 å¤„ç†ç­–ç•¥è®¾è®¡


**ğŸ¯ åˆ†ç±»å¤„ç†æ–¹æ¡ˆ**
```java
public class ReturnMessageProcessor {
    
    public void processReturnedMessage(int replyCode, String message, 
                                     String exchange, String routingKey) {
        
        switch (replyCode) {
            case 312: // NO_ROUTE - è·¯ç”±å¤±è´¥
                handleRouteFailure(message, exchange, routingKey);
                break;
                
            case 404: // NOT_FOUND - äº¤æ¢æœºä¸å­˜åœ¨  
                handleExchangeNotFound(message, exchange);
                break;
                
            default:
                handleGenericFailure(message, replyCode);
        }
    }
    
    // ç­–ç•¥1ï¼šè·¯ç”±å¤±è´¥å¤„ç†
    private void handleRouteFailure(String message, String exchange, String routingKey) {
        // ğŸ”„ é‡è¯•ç­–ç•¥
        if (shouldRetry(routingKey)) {
            String correctedKey = correctRoutingKey(routingKey);
            resendMessage(message, exchange, correctedKey);
            return;
        }
        
        // ğŸ—‚ï¸ å¤‡ç”¨è·¯ç”±
        if (hasAlternateExchange(exchange)) {
            // å¤‡ç”¨äº¤æ¢æœºä¼šè‡ªåŠ¨å¤„ç†ï¼Œè¿™é‡Œä¸»è¦è®°å½•
            logAlternateRoute(message, exchange);
            return;
        }
        
        // ğŸ’¾ æŒä¹…åŒ–å­˜å‚¨
        saveToFailureQueue(message, exchange, routingKey);
    }
    
    // ç­–ç•¥2ï¼šäº¤æ¢æœºä¸å­˜åœ¨å¤„ç†
    private void handleExchangeNotFound(String message, String exchange) {
        log.error("äº¤æ¢æœºä¸å­˜åœ¨: {}", exchange);
        // è¿™é€šå¸¸æ˜¯é…ç½®é”™è¯¯ï¼Œéœ€è¦äººå·¥å¤„ç†
        alertConfigurationError(exchange);
        saveToErrorStorage(message, "EXCHANGE_NOT_FOUND");
    }
}
```

### 4.3 é‡è¯•ä¸é™çº§æœºåˆ¶


**ğŸ”„ é‡è¯•æœºåˆ¶è®¾è®¡**
```java
@Component
public class MessageRetryHandler {
    
    private final RedisTemplate<String, Object> redisTemplate;
    private final RabbitTemplate rabbitTemplate;
    
    // é‡è¯•è®¡æ•°å™¨
    private static final String RETRY_COUNT_KEY = "msg:retry:count:";
    private static final int MAX_RETRY_COUNT = 3;
    
    public void handleReturnWithRetry(String messageId, String content, 
                                    String exchange, String routingKey) {
        
        // è·å–å½“å‰é‡è¯•æ¬¡æ•°
        String countKey = RETRY_COUNT_KEY + messageId;
        Integer retryCount = (Integer) redisTemplate.opsForValue().get(countKey);
        
        if (retryCount == null) {
            retryCount = 0;
        }
        
        if (retryCount < MAX_RETRY_COUNT) {
            // å¢åŠ é‡è¯•æ¬¡æ•°
            retryCount++;
            redisTemplate.opsForValue().set(countKey, retryCount, 
                                          Duration.ofHours(1));
            
            // å»¶è¿Ÿé‡è¯•
            scheduleRetry(content, exchange, routingKey, retryCount);
            
            log.info("æ¶ˆæ¯é‡è¯• {}/{}: {}", retryCount, MAX_RETRY_COUNT, messageId);
            
        } else {
            // è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ‰§è¡Œé™çº§
            degradeMessage(content, exchange, routingKey);
            redisTemplate.delete(countKey);
            
            log.warn("æ¶ˆæ¯é‡è¯•å¤±è´¥ï¼Œæ‰§è¡Œé™çº§: {}", messageId);
        }
    }
    
    private void scheduleRetry(String content, String exchange, 
                             String routingKey, int retryCount) {
        // ä½¿ç”¨å»¶è¿Ÿé˜Ÿåˆ—å®ç°å»¶è¿Ÿé‡è¯•
        // å»¶è¿Ÿæ—¶é—´ï¼š2^retryCount ç§’ (æŒ‡æ•°é€€é¿)
        long delaySeconds = (long) Math.pow(2, retryCount);
        
        // å‘é€åˆ°å»¶è¿Ÿé˜Ÿåˆ—ï¼Œåˆ°æœŸåé‡æ–°å‘é€åˆ°åŸäº¤æ¢æœº
        sendToDelayQueue(content, exchange, routingKey, delaySeconds);
    }
    
    private void degradeMessage(String content, String exchange, String routingKey) {
        // é™çº§ç­–ç•¥ï¼š
        // 1. ä¿å­˜åˆ°æ•°æ®åº“
        saveToDatabase(content, exchange, routingKey);
        
        // 2. æˆ–è€…å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—
        sendToDeadLetterQueue(content);
        
        // 3. æˆ–è€…å†™å…¥æ–‡ä»¶
        writeToFile(content);
        
        // 4. å‘é€å‘Šè­¦
        sendAlert("æ¶ˆæ¯è·¯ç”±å¤±è´¥", content);
    }
}
```

---

## 5. ğŸ”„ å¤‡ç”¨äº¤æ¢æœºæœºåˆ¶


### 5.1 å¤‡ç”¨äº¤æ¢æœºæ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¤‡ç”¨äº¤æ¢æœºï¼ˆAlternate Exchangeï¼‰**
```
å°±åƒ"å¿«é€’ä»£æ”¶ç‚¹"ï¼š
å¦‚æœä½ å®¶æ²¡äººæ”¶å¿«é€’ï¼Œå¿«é€’å‘˜ä¼šæ”¾åˆ°ä»£æ”¶ç‚¹
å¦‚æœæ¶ˆæ¯è·¯ç”±å¤±è´¥ï¼Œä¼šè‡ªåŠ¨å‘åˆ°å¤‡ç”¨äº¤æ¢æœº

å¤‡ç”¨äº¤æ¢æœº = æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶çš„"å¤‡é€‰æ–¹æ¡ˆ"
```

**ğŸ“‹ å·¥ä½œåŸç†**
```
æ­£å¸¸æµç¨‹ï¼š
ç”Ÿäº§è€… â†’ ä¸»äº¤æ¢æœº â†’ é˜Ÿåˆ—A â†’ æ¶ˆè´¹è€… âœ…

è·¯ç”±å¤±è´¥æ—¶ï¼š
ç”Ÿäº§è€… â†’ ä¸»äº¤æ¢æœº â†’ âŒæ‰¾ä¸åˆ°é˜Ÿåˆ— â†’ å¤‡ç”¨äº¤æ¢æœº â†’ å¤‡ç”¨é˜Ÿåˆ— â†’ å¤„ç†

ä¼˜åŠ¿ï¼š
- è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨ç›‘å¬Return
- ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±
- å¯ä»¥ç»Ÿä¸€å¤„ç†æ‰€æœ‰è·¯ç”±å¤±è´¥çš„æ¶ˆæ¯
```

### 5.2 é…ç½®å¤‡ç”¨äº¤æ¢æœº


**ğŸ”§ å£°æ˜å¸¦å¤‡ç”¨äº¤æ¢æœºçš„ä¸»äº¤æ¢æœº**
```java
@Configuration
public class AlternateExchangeConfig {
    
    // å¤‡ç”¨äº¤æ¢æœº
    @Bean
    public DirectExchange alternateExchange() {
        return new DirectExchange("alternate.exchange", true, false);
    }
    
    // å¤‡ç”¨é˜Ÿåˆ—
    @Bean
    public Queue alternateQueue() {
        return QueueBuilder
            .durable("alternate.queue")
            .build();
    }
    
    // å¤‡ç”¨äº¤æ¢æœºç»‘å®šå¤‡ç”¨é˜Ÿåˆ—
    @Bean
    public Binding alternateBinding() {
        return BindingBuilder
            .bind(alternateQueue())
            .to(alternateExchange())
            .with("failed");
    }
    
    // ä¸»äº¤æ¢æœºï¼ˆé…ç½®å¤‡ç”¨äº¤æ¢æœºï¼‰
    @Bean
    public TopicExchange mainExchange() {
        return ExchangeBuilder
            .topicExchange("main.exchange")
            .durable(true)
            .alternate("alternate.exchange")  // å…³é”®ï¼šæŒ‡å®šå¤‡ç”¨äº¤æ¢æœº
            .build();
    }
    
    // ä¸»é˜Ÿåˆ—
    @Bean  
    public Queue mainQueue() {
        return QueueBuilder
            .durable("main.queue")
            .build();
    }
    
    // ä¸»äº¤æ¢æœºç»‘å®šä¸»é˜Ÿåˆ—
    @Bean
    public Binding mainBinding() {
        return BindingBuilder
            .bind(mainQueue())
            .to(mainExchange())
            .with("user.created");  // åªç»‘å®šç‰¹å®šè·¯ç”±é”®
    }
}
```

### 5.3 å¤‡ç”¨äº¤æ¢æœºæ¶ˆè´¹å¤„ç†


**ğŸ§ å¤„ç†å¤‡ç”¨é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯**
```java
@Component
public class AlternateMessageHandler {
    
    private static final Logger log = LoggerFactory.getLogger(AlternateMessageHandler.class);
    
    @RabbitListener(queues = "alternate.queue")
    public void handleAlternateMessage(
        @Payload String message,
        @Header Map<String, Object> headers,
        Channel channel,
        @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        
        try {
            // è·å–åŸå§‹è·¯ç”±ä¿¡æ¯
            String originalExchange = (String) headers.get("x-first-death-exchange");
            String originalRoutingKey = (String) headers.get("x-first-death-reason");
            
            log.warn("æ”¶åˆ°è·¯ç”±å¤±è´¥æ¶ˆæ¯: åŸäº¤æ¢æœº={}, åŸè·¯ç”±é”®={}, å†…å®¹={}", 
                    originalExchange, originalRoutingKey, message);
            
            // åˆ†æå¤±è´¥åŸå› å¹¶å¤„ç†
            processFailedMessage(message, originalExchange, originalRoutingKey);
            
            // æ‰‹åŠ¨ç¡®è®¤
            channel.basicAck(deliveryTag, false);
            
        } catch (Exception e) {
            log.error("å¤„ç†å¤‡ç”¨æ¶ˆæ¯å¤±è´¥", e);
            try {
                // æ‹’ç»æ¶ˆæ¯ï¼Œä¸é‡æ–°å…¥é˜Ÿ
                channel.basicNack(deliveryTag, false, false);
            } catch (IOException ioException) {
                log.error("æ‹’ç»æ¶ˆæ¯å¤±è´¥", ioException);
            }
        }
    }
    
    private void processFailedMessage(String message, String exchange, String routingKey) {
        // ğŸ” åˆ†æå¤±è´¥åŸå› 
        FailureReason reason = analyzeFailure(exchange, routingKey);
        
        switch (reason) {
            case TYPO_IN_ROUTING_KEY:
                // è·¯ç”±é”®æ‹¼å†™é”™è¯¯ï¼Œå°è¯•ä¿®æ­£
                attemptRoutingKeyCorrection(message, exchange, routingKey);
                break;
                
            case QUEUE_NOT_BOUND:
                // é˜Ÿåˆ—æœªç»‘å®šï¼Œå‘é€é…ç½®å‘Šè­¦
                alertConfigurationIssue(exchange, routingKey);
                storeForManualProcessing(message);
                break;
                
            case QUEUE_DELETED:
                // é˜Ÿåˆ—è¢«åˆ é™¤ï¼Œå­˜å‚¨å¾…æ¢å¤
                storeForQueueRecovery(message, routingKey);
                break;
                
            default:
                // å…¶ä»–æƒ…å†µï¼Œè®°å½•å¹¶å­˜å‚¨
                logUnknownFailure(message, exchange, routingKey);
                storeForInvestigation(message);
        }
    }
}
```

### 5.4 å¤‡ç”¨äº¤æ¢æœºvs Return Listener


**ğŸ“Š ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ€§            â”‚ Return Listener â”‚ å¤‡ç”¨äº¤æ¢æœº       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é…ç½®å¤æ‚åº¦      â”‚ ä¸­ç­‰           â”‚ ç®€å•            â”‚
â”‚ å¤„ç†æ–¹å¼        â”‚ æ‰‹åŠ¨ç¼–ç¨‹å¤„ç†   â”‚ è‡ªåŠ¨è·¯ç”±å¤„ç†    â”‚  
â”‚ çµæ´»æ€§          â”‚ é«˜             â”‚ ä¸­ç­‰            â”‚
â”‚ æ€§èƒ½å¼€é”€        â”‚ è¾ƒå°           â”‚ è¾ƒå¤§            â”‚
â”‚ æ¶ˆæ¯æŒä¹…åŒ–      â”‚ éœ€è¦è‡ªå·±å®ç°   â”‚ è‡ªåŠ¨æŒä¹…åŒ–      â”‚
â”‚ ç›‘æ§ç»Ÿè®¡        â”‚ éœ€è¦è‡ªå·±å®ç°   â”‚ å¯ç”¨é˜Ÿåˆ—æŒ‡æ ‡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å»ºè®®é€‰æ‹©ï¼š
ğŸ¯ ç®€å•åœºæ™¯ï¼šå¤‡ç”¨äº¤æ¢æœºï¼ˆé…ç½®ç®€å•ï¼Œè‡ªåŠ¨å¤„ç†ï¼‰
ğŸ¯ å¤æ‚é€»è¾‘ï¼šReturn Listenerï¼ˆçµæ´»æ€§é«˜ï¼Œç²¾ç¡®æ§åˆ¶ï¼‰
ğŸ¯ æ··åˆä½¿ç”¨ï¼šä¸»è¦ç”¨å¤‡ç”¨äº¤æ¢æœºï¼Œç‰¹æ®Šæƒ…å†µç”¨Return Listener
```

---

## 6. ğŸ› ï¸ å®è·µåº”ç”¨ä¸æœ€ä½³ç­–ç•¥


### 6.1 æ¶ˆæ¯å›é€€çš„å®Œæ•´æµç¨‹è®¾è®¡


**ğŸ”„ ç«¯åˆ°ç«¯çš„æ¶ˆæ¯å¯é æ€§æ–¹æ¡ˆ**
```java
@Service
public class ReliableMessageService {
    
    private final RabbitTemplate rabbitTemplate;
    private final MessageRetryService retryService;
    private final AlertService alertService;
    
    /**
     * å¯é æ¶ˆæ¯å‘é€
     */
    public void sendReliableMessage(String exchange, String routingKey, Object message) {
        // 1. ç”Ÿæˆæ¶ˆæ¯ID
        String messageId = UUID.randomUUID().toString();
        
        // 2. è®¾ç½®æ¶ˆæ¯å±æ€§
        MessageProperties properties = new MessageProperties();
        properties.setMessageId(messageId);
        properties.setTimestamp(new Date());
        
        // 3. è®°å½•å‘é€æ—¥å¿—
        logMessageSend(messageId, exchange, routingKey, message);
        
        try {
            // 4. å‘é€æ¶ˆæ¯ï¼ˆå¯ç”¨mandatoryï¼‰
            rabbitTemplate.convertAndSend(exchange, routingKey, message, 
                msg -> {
                    msg.getMessageProperties().setMessageId(messageId);
                    return msg;
                });
            
            // 5. è®°å½•å‘é€æˆåŠŸ
            logMessageSent(messageId);
            
        } catch (Exception e) {
            // 6. å‘é€å¼‚å¸¸å¤„ç†
            logMessageSendError(messageId, e);
            throw new MessageSendException("æ¶ˆæ¯å‘é€å¤±è´¥", e);
        }
    }
    
    /**
     * Return Listenerå¤„ç†
     */
    @EventListener
    public void handleReturnedMessage(ReturnedMessage event) {
        String messageId = event.getMessage().getMessageProperties().getMessageId();
        
        log.warn("æ¶ˆæ¯è¢«é€€å›: messageId={}, reason={}", messageId, event.getReplyText());
        
        // æ ¹æ®ç­–ç•¥å¤„ç†
        RetryStrategy strategy = determineRetryStrategy(event);
        
        switch (strategy) {
            case IMMEDIATE_RETRY:
                retryService.scheduleImmediateRetry(event);
                break;
                
            case DELAYED_RETRY:
                retryService.scheduleDelayedRetry(event);
                break;
                
            case ALTERNATE_ROUTE:
                routeToAlternate(event);
                break;
                
            case MANUAL_INTERVENTION:
                alertService.sendAlert("æ¶ˆæ¯è·¯ç”±å¤±è´¥éœ€è¦äººå·¥å¹²é¢„", event);
                break;
                
            default:
                saveToDeadLetterQueue(event);
        }
    }
}
```

### 6.2 ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶


**ğŸ“Š æ¶ˆæ¯è¿”å›ç›‘æ§æŒ‡æ ‡**
```java
@Component
public class MessageReturnMetrics {
    
    private final MeterRegistry meterRegistry;
    
    // è®¡æ•°å™¨ï¼šè¿”å›æ¶ˆæ¯æ€»æ•°
    private final Counter returnedMessageCounter;
    
    // è®¡æ•°å™¨ï¼šæŒ‰åŸå› åˆ†ç±»çš„è¿”å›æ¶ˆæ¯
    private final Counter returnedByReasonCounter;
    
    // å®šæ—¶å™¨ï¼šè¿”å›æ¶ˆæ¯å¤„ç†æ—¶é—´
    private final Timer returnProcessingTimer;
    
    public MessageReturnMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        
        this.returnedMessageCounter = Counter.builder("rabbitmq.messages.returned.total")
            .description("Total number of returned messages")
            .register(meterRegistry);
            
        this.returnedByReasonCounter = Counter.builder("rabbitmq.messages.returned.by.reason")
            .description("Returned messages by reason")
            .tag("reason", "unknown")
            .register(meterRegistry);
            
        this.returnProcessingTimer = Timer.builder("rabbitmq.return.processing.time")
            .description("Time spent processing returned messages")
            .register(meterRegistry);
    }
    
    public void recordReturnedMessage(String reason) {
        returnedMessageCounter.increment();
        
        Counter.builder("rabbitmq.messages.returned.by.reason")
            .tag("reason", reason)
            .register(meterRegistry)
            .increment();
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    @EventListener
    public void onMessageReturned(ReturnedMessage event) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            String reason = parseReturnReason(event.getReplyCode());
            recordReturnedMessage(reason);
            
            // å¤„ç†è¿”å›æ¶ˆæ¯çš„é€»è¾‘...
            
        } finally {
            sample.stop(returnProcessingTimer);
        }
    }
}
```

### 6.3 é…ç½®æœ€ä½³å®è·µ


**âœ… æ¨èé…ç½®æ¨¡å¼**
```yaml
# application.yml
spring:
  rabbitmq:
    # å¯ç”¨å‘é€ç¡®è®¤
    publisher-confirm-type: correlated
    # å¯ç”¨è¿”å›ç¡®è®¤  
    publisher-returns: true
    # å¼ºåˆ¶æŠ•é€’ï¼ˆmandatory=trueï¼‰
    template:
      mandatory: true
      
# è‡ªå®šä¹‰é…ç½®
message:
  retry:
    max-attempts: 3
    initial-delay: 1000
    max-delay: 10000
    multiplier: 2.0
  alternate:
    enabled: true
    exchange-suffix: ".alternate"
    queue-suffix: ".failed"
```

**ğŸ”§ å®Œæ•´çš„Springé…ç½®ç±»**
```java
@Configuration
@EnableRabbit
@Slf4j
public class RabbitReliabilityConfig {
    
    @Value("${message.retry.max-attempts:3}")
    private int maxRetryAttempts;
    
    @Bean
    public RabbitTemplate rabbitTemplate(ConnectionFactory connectionFactory) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        
        // å¯ç”¨mandatory
        template.setMandatory(true);
        
        // è®¾ç½®Returnå›è°ƒ
        template.setReturnCallback((message, replyCode, replyText, exchange, routingKey) -> {
            log.warn("æ¶ˆæ¯è¿”å›: exchange={}, routingKey={}, replyCode={}, replyText={}", 
                    exchange, routingKey, replyCode, replyText);
            
            // å‘å¸ƒè¿”å›äº‹ä»¶ï¼Œç”±ä¸“é—¨çš„å¤„ç†å™¨å¤„ç†
            applicationEventPublisher.publishEvent(
                new MessageReturnEvent(message, replyCode, replyText, exchange, routingKey)
            );
        });
        
        // è®¾ç½®Confirmå›è°ƒ
        template.setConfirmCallback((correlationData, ack, cause) -> {
            if (!ack) {
                log.error("æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœºå¤±è´¥: {}", cause);
            }
        });
        
        return template;
    }
    
    @Bean
    public SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory(
        ConnectionFactory connectionFactory) {
        
        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory);
        
        // æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼
        factory.setAcknowledgeMode(AcknowledgeMode.MANUAL);
        
        // è®¾ç½®å¹¶å‘æ¶ˆè´¹è€…
        factory.setConcurrentConsumers(1);
        factory.setMaxConcurrentConsumers(10);
        
        // è®¾ç½®é‡è¯•æœºåˆ¶
        factory.setRetryTemplate(createRetryTemplate());
        
        return factory;
    }
    
    private RetryTemplate createRetryTemplate() {
        RetryTemplate retryTemplate = new RetryTemplate();
        
        // æŒ‡æ•°é€€é¿ç­–ç•¥
        ExponentialBackOffPolicy backOffPolicy = new ExponentialBackOffPolicy();
        backOffPolicy.setInitialInterval(1000);
        backOffPolicy.setMaxInterval(10000);
        backOffPolicy.setMultiplier(2.0);
        
        // é‡è¯•ç­–ç•¥
        SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();
        retryPolicy.setMaxAttempts(maxRetryAttempts);
        
        retryTemplate.setBackOffPolicy(backOffPolicy);
        retryTemplate.setRetryPolicy(retryPolicy);
        
        return retryTemplate;
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ æ¶ˆæ¯è¿”å›æœºåˆ¶ï¼šå½“æ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°é˜Ÿåˆ—æ—¶ï¼ŒRabbitMQè¿”å›ç»™å‘é€è€…çš„ä¿æŠ¤æœºåˆ¶
ğŸ”¸ Mandatoryå‚æ•°ï¼šæ§åˆ¶æ˜¯å¦å¯ç”¨è¿”å›æœºåˆ¶çš„å¼€å…³ï¼ˆtrue=å¯ç”¨ï¼Œfalse=ä¸¢å¼ƒï¼‰
ğŸ”¸ Return Listenerï¼šæ¥æ”¶å’Œå¤„ç†è¢«é€€å›æ¶ˆæ¯çš„ç›‘å¬å™¨
ğŸ”¸ å¤‡ç”¨äº¤æ¢æœºï¼šè·¯ç”±å¤±è´¥æ—¶è‡ªåŠ¨è½¬å‘æ¶ˆæ¯çš„å¤‡é€‰äº¤æ¢æœº
ğŸ”¸ è·¯ç”±å¤±è´¥ï¼šäº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ä½†æ‰¾ä¸åˆ°åŒ¹é…é˜Ÿåˆ—çš„æƒ…å†µ
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¶ˆæ¯è¿”å› vs å‘é€ç¡®è®¤çš„åŒºåˆ«**
```
å‘é€ç¡®è®¤ï¼ˆPublisher Confirmï¼‰ï¼š
- ç¡®è®¤æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾äº¤æ¢æœº
- è§£å†³"äº¤æ¢æœºæ˜¯å¦æ”¶åˆ°"çš„é—®é¢˜

æ¶ˆæ¯è¿”å›ï¼ˆMessage Returnï¼‰ï¼š  
- å¤„ç†æ¶ˆæ¯åˆ°è¾¾äº¤æ¢æœºä½†æ— æ³•è·¯ç”±çš„æƒ…å†µ
- è§£å†³"æ¶ˆæ¯æ˜¯å¦èƒ½æŠ•é€’åˆ°é˜Ÿåˆ—"çš„é—®é¢˜

ä¸¤è€…é…åˆä½¿ç”¨æ‰èƒ½ä¿è¯æ¶ˆæ¯çš„å®Œæ•´å¯é æ€§ï¼
```

**ğŸ”¹ å¤‡ç”¨äº¤æ¢æœºçš„é€‚ç”¨åœºæ™¯**
```
é€‚åˆç”¨å¤‡ç”¨äº¤æ¢æœºï¼š
âœ… è·¯ç”±å¤±è´¥æƒ…å†µæ¯”è¾ƒç»Ÿä¸€
âœ… éœ€è¦è‡ªåŠ¨åŒ–å¤„ç†ï¼Œå‡å°‘äººå·¥å¹²é¢„
âœ… å¤±è´¥æ¶ˆæ¯å¯ä»¥ç”¨ç›¸åŒé€»è¾‘å¤„ç†

é€‚åˆç”¨Return Listenerï¼š
âœ… éœ€è¦æ ¹æ®ä¸åŒæƒ…å†µåšä¸åŒå¤„ç†
âœ… éœ€è¦å®æ—¶å“åº”å’Œè‡ªå®šä¹‰é€»è¾‘
âœ… è¦ä¸ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿæ·±åº¦é›†æˆ
```

**ğŸ”¹ æ¶ˆæ¯å›é€€çš„å¤„ç†ç­–ç•¥**
```
ç«‹å³é‡è¯•ï¼šè·¯ç”±é”®å¯èƒ½çš„æ‹¼å†™é”™è¯¯
å»¶è¿Ÿé‡è¯•ï¼šä¸´æ—¶ç½‘ç»œé—®é¢˜æˆ–é˜Ÿåˆ—çŸ­æš‚ä¸å¯ç”¨  
å¤‡ç”¨è·¯ç”±ï¼šä½¿ç”¨å¤‡ç”¨äº¤æ¢æœºæˆ–å…¶ä»–é˜Ÿåˆ—
é™çº§å¤„ç†ï¼šå­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ–‡ä»¶ï¼Œäººå·¥å¤„ç†
å‘Šè­¦é€šçŸ¥ï¼šé€šçŸ¥è¿ç»´äººå‘˜æ£€æŸ¥é…ç½®é—®é¢˜
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **è®¢å•ç³»ç»Ÿ**ï¼šè®¢å•æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨è½¬åˆ°äººå·¥å¤„ç†é˜Ÿåˆ—
- **æ”¯ä»˜ç³»ç»Ÿ**ï¼šæ”¯ä»˜ç»“æœé€šçŸ¥å¤±è´¥æ—¶ï¼Œè®°å½•åˆ°ä¸“é—¨çš„é‡è¯•é˜Ÿåˆ—
- **åº“å­˜ç³»ç»Ÿ**ï¼šåº“å­˜æ‰£å‡æ¶ˆæ¯å¤±è´¥æ—¶ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´
- **é€šçŸ¥ç³»ç»Ÿ**ï¼šæ¨é€æ¶ˆæ¯è·¯ç”±å¤±è´¥æ—¶ï¼Œè½¬ä¸ºå…¶ä»–é€šçŸ¥æ–¹å¼

**ğŸ”§ è¿ç»´ç›‘æ§ä»·å€¼**
- **æ•…éšœå‘ç°**ï¼šå¿«é€Ÿå‘ç°è·¯ç”±é…ç½®é—®é¢˜
- **æ•°æ®ç»Ÿè®¡**ï¼šç»Ÿè®¡æ¶ˆæ¯å¤±è´¥ç‡å’Œå¤±è´¥åŸå› 
- **å®¹é‡è§„åˆ’**ï¼šåˆ†ææ¶ˆæ¯æµé‡å’Œå¤„ç†èƒ½åŠ›
- **æ•…éšœæ¢å¤**ï¼šè‡ªåŠ¨é‡è¯•å’Œé™çº§ä¿è¯æœåŠ¡å¯ç”¨æ€§

### 7.4 é…ç½®å’Œä½¿ç”¨å»ºè®®


**âœ… æœ€ä½³å®è·µè¦ç‚¹**
```
1. ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨mandatory=true
2. åŒæ—¶é…ç½®Return Listenerå’Œå¤‡ç”¨äº¤æ¢æœº
3. å®ç°åˆ†å±‚çš„é‡è¯•ç­–ç•¥ï¼ˆç«‹å³é‡è¯•â†’å»¶è¿Ÿé‡è¯•â†’äººå·¥å¤„ç†ï¼‰
4. å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
5. å®šæœŸæ£€æŸ¥å¤‡ç”¨é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯
6. æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å¤„ç†ç­–ç•¥
```

**âš ï¸ å¸¸è§é—®é¢˜é¿å…**
```
âŒ åªè®¾ç½®mandatoryä½†ä¸å¤„ç†Return
âŒ é‡è¯•æ¬¡æ•°è¿‡å¤šå¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜
âŒ å¤‡ç”¨é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ä¸å¤„ç†
âŒ æ²¡æœ‰åŒºåˆ†ä¸åŒç±»å‹çš„è·¯ç”±å¤±è´¥
âŒ ç¼ºä¹ç›‘æ§å¯¼è‡´é—®é¢˜å‘ç°æ»å
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è·¯ç”±å¤±è´¥ä¸è¦æ…Œï¼Œè¿”å›æœºåˆ¶æ¥å¸®å¿™
- Mandatoryå¼€å…³è¦æ‰“å¼€ï¼ŒReturnç›‘å¬åˆ«å¿˜è®°  
- å¤‡ç”¨äº¤æ¢æœºåšå…œåº•ï¼Œé‡è¯•é™çº§æœ‰ç­–ç•¥
- ç›‘æ§å‘Šè­¦ä¸å¯å°‘ï¼Œæ¶ˆæ¯å¯é æœ‰ä¿éšœ