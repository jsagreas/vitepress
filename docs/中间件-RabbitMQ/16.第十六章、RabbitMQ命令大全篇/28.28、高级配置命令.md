---
title: 28ã€é«˜çº§é…ç½®å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [è”é‚¦çš„åŸºæœ¬æ¦‚å¿µ](#1-è”é‚¦çš„åŸºæœ¬æ¦‚å¿µ)
2. [è”é‚¦æ’ä»¶ç®¡ç†](#2-è”é‚¦æ’ä»¶ç®¡ç†)
3. [ä¸Šæ¸¸é…ç½®ç®¡ç†](#3-ä¸Šæ¸¸é…ç½®ç®¡ç†)
4. [ä¸Šæ¸¸é›†ç®¡ç†](#4-ä¸Šæ¸¸é›†ç®¡ç†)
5. [è”é‚¦çŠ¶æ€ç›‘æ§](#5-è”é‚¦çŠ¶æ€ç›‘æ§)
6. [è”é‚¦é“¾æ¥ç®¡ç†](#6-è”é‚¦é“¾æ¥ç®¡ç†)
7. [å®æˆ˜åº”ç”¨åœºæ™¯](#7-å®æˆ˜åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ è”é‚¦çš„åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQè”é‚¦


**ğŸ’¡ é€šä¿—ç†è§£**
```
è”é‚¦å°±åƒå»ºç«‹"åˆ†å…¬å¸ç½‘ç»œ"ï¼š
â€¢ æ€»å…¬å¸åœ¨åŒ—äº¬ï¼Œåˆ†å…¬å¸åœ¨ä¸Šæµ·ã€æ·±åœ³
â€¢ å„åœ°åˆ†å…¬å¸å¯ä»¥ç‹¬ç«‹è¿è¥
â€¢ ä½†é‡è¦æ¶ˆæ¯å¯ä»¥åœ¨å…¬å¸é—´ä¼ é€’
â€¢ ä¸éœ€è¦æ‰€æœ‰æ•°æ®éƒ½é›†ä¸­åˆ°æ€»éƒ¨

RabbitMQè”é‚¦ = å¤šä¸ªç‹¬ç«‹çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿäº’ç›¸è¿æ¥
```

**ğŸ¯ æ ¸å¿ƒä½œç”¨**
- **è·¨åœ°åŸŸé€šä¿¡**ï¼šä¸åŒåŸå¸‚çš„RabbitMQå¯ä»¥äº’ç›¸å‘æ¶ˆæ¯
- **è´Ÿè½½åˆ†æ‹…**ï¼šæ¶ˆæ¯å¯ä»¥åˆ†æ•£åˆ°å¤šä¸ªæœåŠ¡å™¨å¤„ç†
- **å®¹é”™å¤‡ä»½**ï¼šä¸€ä¸ªèŠ‚ç‚¹å‡ºé—®é¢˜ï¼Œå…¶ä»–èŠ‚ç‚¹ç»§ç»­å·¥ä½œ
- **ç½‘ç»œä¼˜åŒ–**ï¼šæ¶ˆæ¯å°±è¿‘å¤„ç†ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿ

### 1.2 è”é‚¦vsé›†ç¾¤çš„åŒºåˆ«


```
é›†ç¾¤æ¨¡å¼ï¼ˆç´§å¯†åˆä½œï¼‰ï¼š
åŒ—äº¬æ€»éƒ¨ â†â†’ ä¸Šæµ·åˆ†éƒ¨ â†â†’ æ·±åœ³åˆ†éƒ¨
â€¢ å¿…é¡»æ—¶åˆ»ä¿æŒè¿æ¥
â€¢ æ•°æ®å®Œå…¨åŒæ­¥
â€¢ ä¸€ä¸ªæ–­å¼€ï¼Œå¯èƒ½å½±å“æ•´ä½“

è”é‚¦æ¨¡å¼ï¼ˆæ¾æ•£åˆä½œï¼‰ï¼š
åŒ—äº¬æ€»éƒ¨ â‡„ ä¸Šæµ·åˆ†éƒ¨ â‡„ æ·±åœ³åˆ†éƒ¨
â€¢ å¯ä»¥ä¸´æ—¶æ–­å¼€è¿æ¥
â€¢ æŒ‰éœ€åŒæ­¥æ•°æ®
â€¢ å„è‡ªç‹¬ç«‹è¿è¡Œ
```

**ğŸ“Š å¯¹æ¯”è¡¨æ ¼**

| ç‰¹æ€§ | **é›†ç¾¤æ¨¡å¼** | **è”é‚¦æ¨¡å¼** |
|------|-------------|-------------|
| ç½‘ç»œè¦æ±‚ | ğŸ”´ é«˜é€Ÿç¨³å®šè¿æ¥ | ğŸŸ¢ æ™®é€šç½‘ç»œå³å¯ |
| æ•°æ®ä¸€è‡´æ€§ | ğŸŸ¢ å¼ºä¸€è‡´æ€§ | ğŸŸ¡ æœ€ç»ˆä¸€è‡´æ€§ |
| å®¹é”™èƒ½åŠ› | ğŸŸ¡ èŠ‚ç‚¹é—´ç›¸äº’ä¾èµ– | ğŸŸ¢ å„èŠ‚ç‚¹ç‹¬ç«‹ |
| ç®¡ç†å¤æ‚åº¦ | ğŸŸ¡ ä¸­ç­‰ | ğŸ”´ ç›¸å¯¹å¤æ‚ |

---

## 2. ğŸ”Œ è”é‚¦æ’ä»¶ç®¡ç†


### 2.1 å¯ç”¨è”é‚¦åŠŸèƒ½


**ğŸ› ï¸ åŸºç¡€è”é‚¦æ’ä»¶**
```bash
# å¯ç”¨è”é‚¦æ ¸å¿ƒåŠŸèƒ½
rabbitmq-plugins enable rabbitmq_federation

# æ£€æŸ¥æ’ä»¶çŠ¶æ€
rabbitmq-plugins list | grep federation
```

**ğŸ’¡ è¿™ä¸ªå‘½ä»¤åšä»€ä¹ˆ**
- `rabbitmq_federation`æ˜¯è”é‚¦çš„"å‘åŠ¨æœº"
- å¯ç”¨åï¼ŒRabbitMQå°±å…·å¤‡äº†è¿æ¥å…¶ä»–æœåŠ¡å™¨çš„èƒ½åŠ›
- å°±åƒç»™æ±½è½¦è£…ä¸Šå‘åŠ¨æœºï¼Œæ‰èƒ½è·‘èµ·æ¥

**ğŸ›ï¸ ç®¡ç†ç•Œé¢æ’ä»¶**
```bash
# å¯ç”¨è”é‚¦ç®¡ç†ç•Œé¢
rabbitmq-plugins enable rabbitmq_federation_management

# ç°åœ¨å¯ä»¥åœ¨Webç•Œé¢ç®¡ç†è”é‚¦äº†
```

**ğŸ“± ç®¡ç†ç•Œé¢çš„å¥½å¤„**
- **å¯è§†åŒ–æ“ä½œ**ï¼šä¸ç”¨è®°å¤æ‚å‘½ä»¤
- **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶æŸ¥çœ‹è¿æ¥çŠ¶æ€
- **å›¾å½¢åŒ–é…ç½®**ï¼šç‚¹å‡»å°±èƒ½è®¾ç½®å‚æ•°

### 2.2 æ’ä»¶çŠ¶æ€æ£€æŸ¥


**ğŸ“‹ æ£€æŸ¥æ¸…å•**
```bash
# æŸ¥çœ‹æ‰€æœ‰è”é‚¦ç›¸å…³æ’ä»¶
rabbitmq-plugins list | grep federation

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# [E*] rabbitmq_federation               3.8.0
# [E*] rabbitmq_federation_management    3.8.0
# [E*] = å·²å¯ç”¨å¹¶è¿è¡Œ
```

---

## 3. âš™ï¸ ä¸Šæ¸¸é…ç½®ç®¡ç†


### 3.1 ä»€ä¹ˆæ˜¯ä¸Šæ¸¸


**ğŸŒŠ ä¸Šæ¸¸çš„æ¦‚å¿µ**
```
å°±åƒæ²³æµçš„ä¸Šæ¸¸å’Œä¸‹æ¸¸ï¼š
æ°´ä»ä¸Šæ¸¸æµå‘ä¸‹æ¸¸ â†’ æ¶ˆæ¯ä»ä¸Šæ¸¸å‘åˆ°ä¸‹æ¸¸

ä¸Šæ¸¸æœåŠ¡å™¨ï¼šæ¶ˆæ¯çš„æ¥æº
å½“å‰æœåŠ¡å™¨ï¼šæ¶ˆæ¯çš„æ¥æ”¶æ–¹

ä¾‹å­ï¼š
ä¸Šæµ·æœåŠ¡å™¨ï¼ˆä¸Šæ¸¸ï¼‰â†’ åŒ—äº¬æœåŠ¡å™¨ï¼ˆå½“å‰ï¼‰
è®¢å•æ¶ˆæ¯ä»ä¸Šæµ·å‘é€åˆ°åŒ—äº¬å¤„ç†
```

### 3.2 è®¾ç½®ä¸Šæ¸¸æœåŠ¡å™¨


**ğŸ”§ åŸºæœ¬ä¸Šæ¸¸é…ç½®**
```bash
# è®¾ç½®ä¸€ä¸ªä¸Šæ¸¸è¿æ¥
rabbitmqctl set_parameter federation-upstream shanghai-server \
'{"uri":"amqp://user:pass@shanghai.company.com:5672/%2F"}'
```

**ğŸ“‹ å‚æ•°è¯¦è§£**
- `federation-upstream`ï¼šå‘Šè¯‰ç³»ç»Ÿè¿™æ˜¯ä¸Šæ¸¸é…ç½®
- `shanghai-server`ï¼šç»™è¿™ä¸ªä¸Šæ¸¸èµ·ä¸ªåå­—ï¼ˆè‡ªå·±å®šä¹‰ï¼‰
- `uri`ï¼šä¸Šæ¸¸æœåŠ¡å™¨çš„è¿æ¥åœ°å€

**ğŸ” URIåœ°å€æ ¼å¼è¯´æ˜**
```
amqp://ç”¨æˆ·å:å¯†ç @æœåŠ¡å™¨åœ°å€:ç«¯å£/è™šæ‹Ÿä¸»æœº

ä¾‹å­ï¼š
amqp://admin:123456@192.168.1.100:5672/%2F
â€¢ adminï¼šç”¨æˆ·å
â€¢ 123456ï¼šå¯†ç   
â€¢ 192.168.1.100ï¼šæœåŠ¡å™¨IP
â€¢ 5672ï¼šRabbitMQç«¯å£
â€¢ %2Fï¼šè™šæ‹Ÿä¸»æœº"/"çš„URLç¼–ç 
```

**âš¡ é«˜çº§ä¸Šæ¸¸é…ç½®**
```bash
# å¸¦æ›´å¤šå‚æ•°çš„ä¸Šæ¸¸é…ç½®
rabbitmqctl set_parameter federation-upstream beijing-main \
'{
  "uri":"amqp://admin:secret@beijing.company.com:5672/%2F",
  "max-hops":2,
  "reconnect-delay":10,
  "trust-user-id":true
}'
```

**ğŸ“Š é«˜çº§å‚æ•°è¯´æ˜**

| å‚æ•° | **ä½œç”¨** | **é€šä¿—è§£é‡Š** |
|------|---------|-------------|
| `max-hops` | æœ€å¤§è·³æ•° | æ¶ˆæ¯æœ€å¤šç»è¿‡å‡ ä¸ªæœåŠ¡å™¨ |
| `reconnect-delay` | é‡è¿å»¶è¿Ÿ | æ–­çº¿åç­‰å‡ ç§’å†é‡è¿ |
| `trust-user-id` | ä¿¡ä»»ç”¨æˆ·ID | æ˜¯å¦ç›¸ä¿¡ä¸Šæ¸¸å‘æ¥çš„ç”¨æˆ·ä¿¡æ¯ |

### 3.3 ç®¡ç†ä¸Šæ¸¸é…ç½®


**ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰ä¸Šæ¸¸**
```bash
# åˆ—å‡ºæ‰€æœ‰é…ç½®çš„ä¸Šæ¸¸
rabbitmqctl list_parameters component federation-upstream
```

**ğŸ—‘ï¸ åˆ é™¤ä¸Šæ¸¸é…ç½®**
```bash
# åˆ é™¤æŒ‡å®šçš„ä¸Šæ¸¸é…ç½®
rabbitmqctl clear_parameter federation-upstream shanghai-server
```

**ğŸ’¡ ä»€ä¹ˆæ—¶å€™åˆ é™¤ä¸Šæ¸¸**
- æœåŠ¡å™¨ä¸‹çº¿äº†
- ä¸å†éœ€è¦ä»è¿™ä¸ªæœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯
- é…ç½®é”™è¯¯éœ€è¦é‡æ–°è®¾ç½®

---

## 4. ğŸ“¦ ä¸Šæ¸¸é›†ç®¡ç†


### 4.1 ä»€ä¹ˆæ˜¯ä¸Šæ¸¸é›†


**ğŸ¯ ä¸Šæ¸¸é›†çš„æ¦‚å¿µ**
```
å•ä¸ªä¸Šæ¸¸ï¼šåªä»ä¸€ä¸ªæœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯
ä¸Šæ¸¸é›†ï¼šä»å¤šä¸ªæœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯

æ¯”å¦‚ï¼š
åŒ—äº¬æœåŠ¡å™¨æƒ³æ¥æ”¶æ¥è‡ªå¤šä¸ªåŸå¸‚çš„è®¢å•
â€¢ ä¸Šæµ·æœåŠ¡å™¨çš„è®¢å•
â€¢ æ·±åœ³æœåŠ¡å™¨çš„è®¢å•  
â€¢ å¹¿å·æœåŠ¡å™¨çš„è®¢å•

æŠŠè¿™äº›ä¸Šæ¸¸æ‰“åŒ…æˆä¸€ä¸ª"ä¸Šæ¸¸é›†"
```

**âš–ï¸ è´Ÿè½½å‡è¡¡çš„å¥½å¤„**
- **åˆ†æ•£å‹åŠ›**ï¼šä¸ä¼šåªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ç´¯æ­»
- **æé«˜å¯ç”¨æ€§**ï¼šä¸€ä¸ªæœåŠ¡å™¨åäº†ï¼Œè¿˜æœ‰å…¶ä»–çš„
- **å°±è¿‘é€‰æ‹©**ï¼šè‡ªåŠ¨é€‰æ‹©æœ€å¿«çš„æœåŠ¡å™¨

### 4.2 åˆ›å»ºä¸Šæ¸¸é›†


**ğŸ”§ è®¾ç½®ä¸Šæ¸¸é›†**
```bash
# åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªä¸Šæ¸¸çš„é›†åˆ
rabbitmqctl set_parameter federation-upstream-set order-sources \
'[
  {"upstream":"shanghai-server"},
  {"upstream":"shenzhen-server"},
  {"upstream":"guangzhou-server"}
]'
```

**ğŸ“‹ é…ç½®è¯´æ˜**
- `federation-upstream-set`ï¼šå‘Šè¯‰ç³»ç»Ÿè¿™æ˜¯ä¸Šæ¸¸é›†
- `order-sources`ï¼šç»™ä¸Šæ¸¸é›†èµ·ä¸ªåå­—
- æ–¹æ‹¬å·å†…ï¼šåˆ—å‡ºæ‰€æœ‰è¦åŒ…å«çš„ä¸Šæ¸¸

**âš™ï¸ å¸¦æƒé‡çš„ä¸Šæ¸¸é›†**
```bash
# ä¸åŒä¸Šæ¸¸è®¾ç½®ä¸åŒæƒé‡
rabbitmqctl set_parameter federation-upstream-set weighted-sources \
'[
  {"upstream":"shanghai-server", "weight":3},
  {"upstream":"shenzhen-server", "weight":2},
  {"upstream":"guangzhou-server", "weight":1}
]'
```

**ğŸ² æƒé‡çš„ä½œç”¨**
```
æƒé‡3ï¼šå¤„ç†èƒ½åŠ›å¼ºï¼Œåˆ†é…æ›´å¤šæ¶ˆæ¯
æƒé‡2ï¼šå¤„ç†èƒ½åŠ›ä¸­ç­‰
æƒé‡1ï¼šå¤„ç†èƒ½åŠ›å¼±ï¼Œåˆ†é…è¾ƒå°‘æ¶ˆæ¯

å°±åƒåˆ†é…å·¥ä½œé‡ï¼š
èƒ½å¹²çš„å¤šå¹²ç‚¹ï¼Œèƒ½åŠ›å¼±çš„å°‘å¹²ç‚¹
```

### 4.3 ç®¡ç†ä¸Šæ¸¸é›†


**ğŸ“‹ æŸ¥çœ‹ä¸Šæ¸¸é›†**
```bash
# åˆ—å‡ºæ‰€æœ‰ä¸Šæ¸¸é›†é…ç½®
rabbitmqctl list_parameters component federation-upstream-set
```

**ğŸ—‘ï¸ åˆ é™¤ä¸Šæ¸¸é›†**
```bash
# åˆ é™¤æŒ‡å®šçš„ä¸Šæ¸¸é›†
rabbitmqctl clear_parameter federation-upstream-set order-sources
```

---

## 5. ğŸ“Š è”é‚¦çŠ¶æ€ç›‘æ§


### 5.1 æŸ¥çœ‹è”é‚¦æ•´ä½“çŠ¶æ€


**ğŸ” å…¨å±€çŠ¶æ€æ£€æŸ¥**
```bash
# æŸ¥çœ‹è”é‚¦ç³»ç»Ÿçš„æ•´ä½“çŠ¶æ€
rabbitmqctl eval 'rabbit_federation_status:status().'
```

**ğŸ’¡ è¿™ä¸ªå‘½ä»¤å‘Šè¯‰ä½ ä»€ä¹ˆ**
- å“ªäº›è”é‚¦è¿æ¥æ˜¯æ´»è·ƒçš„
- å“ªäº›è¿æ¥å‡ºç°äº†é—®é¢˜
- æ¶ˆæ¯ä¼ è¾“çš„ç»Ÿè®¡ä¿¡æ¯
- è¿æ¥çš„å¥åº·çŠ¶å†µ

**ğŸ“ˆ çŠ¶æ€ä¿¡æ¯è§£è¯»**
```
è¾“å‡ºç¤ºä¾‹ï¼š
[{<<"shanghai-server">>,[{node,rabbit@beijing},{state,running}]}]

è§£é‡Šï¼š
â€¢ shanghai-serverï¼šä¸Šæ¸¸åç§°
â€¢ rabbit@beijingï¼šå½“å‰èŠ‚ç‚¹å
â€¢ state,runningï¼šè¿æ¥çŠ¶æ€ä¸ºè¿è¡Œä¸­
```

### 5.2 è¿æ¥çŠ¶æ€å«ä¹‰


**ğŸš¥ çŠ¶æ€æŒ‡ç¤ºç¯**

| çŠ¶æ€ | **å«ä¹‰** | **åº”å¯¹æ–¹æ³•** |
|------|---------|-------------|
| `running` | ğŸŸ¢ æ­£å¸¸è¿è¡Œ | ç»§ç»­ç›‘æ§ |
| `starting` | ğŸŸ¡ æ­£åœ¨å¯åŠ¨ | ç­‰å¾…å®Œæˆ |
| `{error, Reason}` | ğŸ”´ è¿æ¥é”™è¯¯ | æ£€æŸ¥ç½‘ç»œå’Œé…ç½® |

**ğŸ› ï¸ å¸¸è§é”™è¯¯æ’æŸ¥**
```bash
# å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œæ£€æŸ¥ï¼š
# 1. ç½‘ç»œè¿é€šæ€§
ping shanghai.company.com

# 2. ç«¯å£æ˜¯å¦å¼€æ”¾
telnet shanghai.company.com 5672

# 3. ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
# 4. è™šæ‹Ÿä¸»æœºæ˜¯å¦å­˜åœ¨
```

---

## 6. ğŸ”— è”é‚¦é“¾æ¥ç®¡ç†


### 6.1 ä»€ä¹ˆæ˜¯è”é‚¦é“¾æ¥


**ğŸŒ‰ é“¾æ¥çš„æ¦‚å¿µ**
```
è”é‚¦é“¾æ¥ = ä¸¤ä¸ªæœåŠ¡å™¨ä¹‹é—´çš„"æ¡¥æ¢"

å°±åƒä¸¤ä¸ªåŸå¸‚ä¹‹é—´çš„é«˜é€Ÿå…¬è·¯ï¼š
â€¢ æœ‰äº†è·¯ï¼Œè½¦æ‰èƒ½è·‘
â€¢ è·¯æ–­äº†ï¼Œè½¦å°±è¿‡ä¸å»
â€¢ è·¯å µäº†ï¼Œè½¦å°±è·‘å¾—æ…¢

è”é‚¦é“¾æ¥å°±æ˜¯æ¶ˆæ¯ä¼ è¾“çš„"é«˜é€Ÿå…¬è·¯"
```

### 6.2 é‡å¯è”é‚¦é“¾æ¥


**ğŸ”„ é‡å¯é“¾æ¥å‘½ä»¤**
```bash
# é‡å¯æŒ‡å®šçš„è”é‚¦é“¾æ¥
rabbitmqctl restart_federation_link {link_name}
```

**ğŸ¤” ä»€ä¹ˆæ—¶å€™éœ€è¦é‡å¯é“¾æ¥**
- ç½‘ç»œå‡ºç°ä¸´æ—¶é—®é¢˜å
- ä¿®æ”¹äº†ä¸Šæ¸¸é…ç½®
- è¿æ¥çŠ¶æ€å¼‚å¸¸æ—¶
- æ€§èƒ½é—®é¢˜æ’æŸ¥æ—¶

**âš ï¸ é‡å¯çš„å½±å“**
```
é‡å¯æœŸé—´ï¼š
â€¢ è¯¥é“¾æ¥æš‚æ—¶ä¸èƒ½ä¼ è¾“æ¶ˆæ¯
â€¢ æ¶ˆæ¯ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…
â€¢ é‡å¯å®Œæˆåè‡ªåŠ¨æ¢å¤ä¼ è¾“
â€¢ ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼ˆé™¤éé˜Ÿåˆ—æ»¡äº†ï¼‰
```

### 6.3 é“¾æ¥å¥åº·æ£€æŸ¥


**ğŸ¥ å®šæœŸä½“æ£€**
```bash
# æ£€æŸ¥æ‰€æœ‰é“¾æ¥çŠ¶æ€çš„è„šæœ¬ç¤ºä¾‹
#!/bin/bash
echo "æ£€æŸ¥è”é‚¦é“¾æ¥å¥åº·çŠ¶å†µ..."
rabbitmqctl eval 'rabbit_federation_status:status().' | grep -E "(running|error)"
```

**ğŸ“‹ å¥åº·æŒ‡æ ‡**
- **è¿æ¥æ•°é‡**ï¼šæ˜¯å¦æœ‰é¢„æœŸçš„è¿æ¥æ•°
- **çŠ¶æ€æ­£å¸¸**ï¼šæ‰€æœ‰é“¾æ¥éƒ½æ˜¯runningçŠ¶æ€
- **æ¶ˆæ¯æµé‡**ï¼šæ˜¯å¦æœ‰æ¶ˆæ¯åœ¨ä¼ è¾“
- **é”™è¯¯æ—¥å¿—**ï¼šæ˜¯å¦æœ‰é”™è¯¯è®°å½•

---

## 7. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 7.1 è·¨åœ°åŸŸç”µå•†ç³»ç»Ÿ


**ğŸª ä¸šåŠ¡åœºæ™¯**
```
ç”µå•†å…¬å¸å¸ƒå±€ï¼š
åŒ—äº¬æ€»éƒ¨ - è´Ÿè´£ç”¨æˆ·æ³¨å†Œã€è´¦æˆ·ç®¡ç†
ä¸Šæµ·ä»“åº“ - è´Ÿè´£å•†å“åº“å­˜ã€å‘è´§
æ·±åœ³å®¢æœ - è´Ÿè´£å”®åã€æŠ•è¯‰å¤„ç†

æ¶ˆæ¯æµå‘ï¼š
ç”¨æˆ·ä¸‹å•(åŒ—äº¬) â†’ åº“å­˜æ‰£å‡(ä¸Šæµ·) â†’ å‘è´§é€šçŸ¥(ä¸Šæµ·â†’åŒ—äº¬)
ç”¨æˆ·æŠ•è¯‰(åŒ—äº¬) â†’ å·¥å•åˆ›å»º(æ·±åœ³) â†’ å¤„ç†ç»“æœ(æ·±åœ³â†’åŒ—äº¬)
```

**âš™ï¸ è”é‚¦é…ç½®å®ä¾‹**
```bash
# åŒ—äº¬æ€»éƒ¨é…ç½®ä¸Šæ¸¸
# 1. è®¾ç½®ä¸Šæµ·ä»“åº“ä¸ºä¸Šæ¸¸
rabbitmqctl set_parameter federation-upstream shanghai-warehouse \
'{"uri":"amqp://warehouse:pass@sh-warehouse.company.com:5672/%2F"}'

# 2. è®¾ç½®æ·±åœ³å®¢æœä¸ºä¸Šæ¸¸  
rabbitmqctl set_parameter federation-upstream shenzhen-service \
'{"uri":"amqp://service:pass@sz-service.company.com:5672/%2F"}'

# 3. åˆ›å»ºä¸Šæ¸¸é›†ï¼ˆæ‰€æœ‰åˆ†æ”¯æœºæ„ï¼‰
rabbitmqctl set_parameter federation-upstream-set all-branches \
'[
  {"upstream":"shanghai-warehouse"},
  {"upstream":"shenzhen-service"}
]'
```

### 7.2 é‡‘èç³»ç»Ÿé£æ§è”é‚¦


**ğŸ¦ ä¸šåŠ¡éœ€æ±‚**
```
é“¶è¡Œé£æ§ç³»ç»Ÿï¼š
å„åœ°åˆ†è¡Œç‹¬ç«‹å¤„ç†ä¸šåŠ¡ï¼Œä½†éœ€è¦å…±äº«é£é™©ä¿¡æ¯

é£é™©äº‹ä»¶è”é‚¦ï¼š
æŸå®¢æˆ·åœ¨Aåˆ†è¡Œè¢«æ ‡è®°é£é™© â†’ ä¿¡æ¯åŒæ­¥åˆ°æ‰€æœ‰åˆ†è¡Œ
å…¶ä»–åˆ†è¡Œæ¥åˆ°è¯¥å®¢æˆ·ä¸šåŠ¡æ—¶ â†’ è‡ªåŠ¨æé†’é£é™©

å®æ—¶æ€§è¦æ±‚ï¼šé£é™©ä¿¡æ¯å¿…é¡»å¿«é€Ÿä¼ æ’­
```

**ğŸ”§ é£æ§è”é‚¦é…ç½®**
```bash
# è®¾ç½®æ‰€æœ‰åˆ†è¡Œä¸ºä¸Šæ¸¸ï¼ˆåŒå‘è”é‚¦ï¼‰
for branch in beijing shanghai guangzhou shenzhen; do
  rabbitmqctl set_parameter federation-upstream ${branch}-branch \
  "{\"uri\":\"amqp://risk:secret@${branch}.bank.com:5672/risk\"}"
done

# åˆ›å»ºé£æ§ä¸Šæ¸¸é›†
rabbitmqctl set_parameter federation-upstream-set risk-network \
'[
  {"upstream":"beijing-branch"},
  {"upstream":"shanghai-branch"},
  {"upstream":"guangzhou-branch"},
  {"upstream":"shenzhen-branch"}
]'
```

### 7.3 ç‰©è”ç½‘æ•°æ®æ”¶é›†


**ğŸŒ IoTåœºæ™¯**
```
æ™ºæ…§åŸå¸‚é¡¹ç›®ï¼š
å„ä¸ªåŒºåŸŸçš„ä¼ æ„Ÿå™¨æ•°æ®éœ€è¦æ±‡æ€»åˆ°ä¸­å¤®å¤„ç†

æ•°æ®æµå‘ï¼š
ä¼ æ„Ÿå™¨ â†’ åŒºåŸŸç½‘å…³ â†’ åŸå¸‚æ•°æ®ä¸­å¿ƒ â†’ äº‘ç«¯åˆ†æ

è”é‚¦ä¼˜åŠ¿ï¼š
â€¢ åŒºåŸŸç½‘å…³å¯ä»¥ç¦»çº¿å·¥ä½œ
â€¢ ç½‘ç»œæ¢å¤æ—¶è‡ªåŠ¨åŒæ­¥æ•°æ®
â€¢ å‡å°‘ä¸­å¤®æœåŠ¡å™¨å‹åŠ›
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ è”é‚¦æœ¬è´¨ï¼šè®©ç‹¬ç«‹çš„RabbitMQæœåŠ¡å™¨èƒ½å¤Ÿäº’ç›¸é€šä¿¡
ğŸ”¸ æ ¸å¿ƒæ’ä»¶ï¼šrabbitmq_federationï¼ˆåŠŸèƒ½ï¼‰+ rabbitmq_federation_managementï¼ˆç•Œé¢ï¼‰
ğŸ”¸ ä¸Šæ¸¸é…ç½®ï¼šè®¾ç½®æ¶ˆæ¯æ¥æºæœåŠ¡å™¨çš„è¿æ¥ä¿¡æ¯
ğŸ”¸ ä¸Šæ¸¸é›†ï¼šå°†å¤šä¸ªä¸Šæ¸¸ç»„åˆï¼Œå®ç°è´Ÿè½½å‡è¡¡
ğŸ”¸ è”é‚¦é“¾æ¥ï¼šå®é™…çš„æ¶ˆæ¯ä¼ è¾“é€šé“ï¼Œå¯ä»¥é‡å¯å’Œç›‘æ§
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è”é‚¦vsé›†ç¾¤çš„é€‰æ‹©**
```
é€‰æ‹©è”é‚¦çš„åœºæ™¯ï¼š
â€¢ æœåŠ¡å™¨åˆ†å¸ƒåœ¨ä¸åŒåœ°åŸŸ
â€¢ ç½‘ç»œè¿æ¥ä¸å¤Ÿç¨³å®š
â€¢ éœ€è¦ç‹¬ç«‹è¿è¡Œèƒ½åŠ›
â€¢ å¯¹å»¶è¿Ÿè¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜

é€‰æ‹©é›†ç¾¤çš„åœºæ™¯ï¼š
â€¢ æœåŠ¡å™¨åœ¨åŒä¸€æœºæˆ¿
â€¢ ç½‘ç»œè¿æ¥éå¸¸ç¨³å®š
â€¢ éœ€è¦å¼ºä¸€è‡´æ€§
â€¢ å¯¹æ€§èƒ½è¦æ±‚æé«˜
```

**ğŸ”¹ é…ç½®ç®¡ç†çš„æœ€ä½³å®è·µ**
```
è§„åˆ’åŸåˆ™ï¼š
â€¢ å‘½åè§„èŒƒï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
â€¢ æƒé‡è®¾ç½®ï¼šæ ¹æ®å®é™…å¤„ç†èƒ½åŠ›
â€¢ ç›‘æ§è¦†ç›–ï¼šæ‰€æœ‰é“¾æ¥éƒ½è¦ç›‘æ§
â€¢ å®¹é”™è®¾è®¡ï¼šè€ƒè™‘ç½‘ç»œä¸­æ–­æƒ…å†µ
```

### 8.3 å‘½ä»¤é€Ÿè®°å¡


**ğŸ¯ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥**
```bash
# æ’ä»¶ç®¡ç†
rabbitmq-plugins enable rabbitmq_federation
rabbitmq-plugins enable rabbitmq_federation_management

# ä¸Šæ¸¸ç®¡ç†
rabbitmqctl set_parameter federation-upstream {name} {config}
rabbitmqctl clear_parameter federation-upstream {name}
rabbitmqctl list_parameters component federation-upstream

# ä¸Šæ¸¸é›†ç®¡ç†  
rabbitmqctl set_parameter federation-upstream-set {name} {config}
rabbitmqctl clear_parameter federation-upstream-set {name}
rabbitmqctl list_parameters component federation-upstream-set

# çŠ¶æ€ç›‘æ§
rabbitmqctl eval 'rabbit_federation_status:status().'
rabbitmqctl restart_federation_link {link}
```

### 8.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **è·¨åœ°åŸŸéƒ¨ç½²**ï¼šä¸åŒåŸå¸‚çš„ç³»ç»Ÿäº’è”äº’é€š
- **å®¹ç¾å¤‡ä»½**ï¼šä¸€åœ°æ•…éšœä¸å½±å“å…¶ä»–åœ°åŒº
- **è´Ÿè½½åˆ†æ‹…**ï¼šæ¶ˆæ¯å¤„ç†å‹åŠ›åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹
- **ç½‘ç»œä¼˜åŒ–**ï¼šå°±è¿‘å¤„ç†å‡å°‘å»¶è¿Ÿ

**ğŸ”§ è¿ç»´å®è·µ**
- **æ¸è¿›éƒ¨ç½²**ï¼šå…ˆå°è§„æ¨¡æµ‹è¯•ï¼Œå†å…¨é¢æ¨å¹¿
- **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®é“¾æ¥çŠ¶æ€ç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦
- **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®ä¸šåŠ¡é‡è°ƒæ•´æƒé‡å’Œå‚æ•°
- **æ•…éšœå¤„ç†**ï¼šåˆ¶å®šç½‘ç»œä¸­æ–­æ—¶çš„åº”æ€¥é¢„æ¡ˆ

**ğŸ’¡ å­¦ä¹ è·¯å¾„å»ºè®®**
```
ç¬¬1æ­¥ï¼šç†è§£è”é‚¦åŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨åœºæ™¯
ç¬¬2æ­¥ï¼šåœ¨æµ‹è¯•ç¯å¢ƒç»ƒä¹ åŸºæœ¬é…ç½®
ç¬¬3æ­¥ï¼šå­¦ä¹ ç›‘æ§å’Œæ•…éšœå¤„ç†
ç¬¬4æ­¥ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨å’Œä¼˜åŒ–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è”é‚¦è¿æ¥å„åœ°åŒºï¼Œç‹¬ç«‹è¿è¡Œèƒ½é€šä¿¡
- ä¸Šæ¸¸è®¾ç½®æ¶ˆæ¯æºï¼Œä¸Šæ¸¸é›†åšè´Ÿè½½å‡è¡¡
- æ’ä»¶å¯ç”¨æ˜¯åŸºç¡€ï¼ŒçŠ¶æ€ç›‘æ§ä¿ç¨³å®š
- è·¨åŸŸéƒ¨ç½²é€‰è”é‚¦ï¼ŒåŒåŸé«˜é€Ÿç”¨é›†ç¾¤