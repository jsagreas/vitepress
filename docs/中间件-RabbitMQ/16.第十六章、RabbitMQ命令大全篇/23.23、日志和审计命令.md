---
title: 23、日志和审计命令
---
## 📚 目录

1. [日志管理基础概念](#1-日志管理基础概念)
2. [日志轮转命令详解](#2-日志轮转命令详解)
3. [日志级别控制](#3-日志级别控制)
4. [日志查看和监控](#4-日志查看和监控)
5. [消息跟踪功能](#5-消息跟踪功能)
6. [内存水位监控](#6-内存水位监控)
7. [审计和安全日志](#7-审计和安全日志)
8. [日志故障排查](#8-日志故障排查)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 📖 日志管理基础概念


### 1.1 什么是RabbitMQ日志系统


**简单理解**：日志就像是RabbitMQ的"日记本"，记录着系统运行过程中发生的所有重要事件。

```
🔍 日志的作用就像：
• 医生的病历本 - 记录系统"健康状况"
• 侦探的线索本 - 帮助找出问题原因  
• 会计的账本 - 追踪系统运行轨迹
• 老师的记录册 - 监控系统表现
```

### 1.2 RabbitMQ日志类型详解


**📋 主要日志分类**：

| 日志类型 | **作用说明** | **记录内容** | **重要程度** |
|---------|-------------|-------------|-------------|
| **系统日志** | `记录系统启动停止` | `服务状态变化` | ⭐⭐⭐⭐⭐ |
| **连接日志** | `记录客户端连接` | `连接建立断开` | ⭐⭐⭐⭐☆ |
| **错误日志** | `记录系统错误` | `异常和故障信息` | ⭐⭐⭐⭐⭐ |
| **访问日志** | `记录操作行为` | `用户操作记录` | ⭐⭐⭐☆☆ |
| **跟踪日志** | `记录消息流向` | `消息传递过程` | ⭐⭐⭐☆☆ |

### 1.3 日志文件位置和结构


**📂 默认日志位置**：
```
Linux系统日志路径：
/var/log/rabbitmq/
├── rabbit@hostname.log        ← 主要系统日志
├── rabbit@hostname-sasl.log   ← SASL应用日志  
├── rabbit@hostname.1          ← 轮转后的历史日志
└── rabbit@hostname.2          ← 更早的历史日志

日志文件命名规则：
rabbit@[节点名称].log           # 当前日志
rabbit@[节点名称].[数字]        # 历史日志（数字越大越旧）
```

---

## 2. 🔄 日志轮转命令详解


### 2.1 基本日志轮转概念


**什么是日志轮转？**
想象日志文件就像一本日记本，写满了就需要换新本子，但旧本子也要保存起来备查。这个换本子的过程就是"日志轮转"。

```
💡 为什么需要日志轮转：
• 防止单个日志文件过大（几GB的文件很难处理）
• 方便按时间查找历史记录
• 控制磁盘空间使用
• 提高日志处理效率
```

### 2.2 基础轮转命令


**🔧 `rabbitmqctl rotate_logs` - 立即轮转日志**

```bash
# 基本日志轮转（最常用）
sudo rabbitmqctl rotate_logs

# 执行后的效果：
# rabbit@server.log → rabbit@server.1 （当前日志变成历史日志）
# 新的rabbit@server.log （创建新的当前日志文件）
```

**📊 轮转前后对比**：
```
轮转前：
/var/log/rabbitmq/
└── rabbit@server.log (2.5GB 很大！)

轮转后：
/var/log/rabbitmq/
├── rabbit@server.log (0KB 新文件)
└── rabbit@server.1 (2.5GB 归档)
```

### 2.3 带后缀的日志轮转


**🏷️ `rabbitmqctl rotate_logs {suffix}` - 自定义轮转后缀**

```bash
# 使用时间戳作为后缀
sudo rabbitmqctl rotate_logs $(date +%Y%m%d_%H%M%S)

# 使用版本号作为后缀  
sudo rabbitmqctl rotate_logs v2.1.0

# 使用事件标记
sudo rabbitmqctl rotate_logs before_upgrade
```

**💡 实际应用场景**：
```
📅 定期维护：
sudo rabbitmqctl rotate_logs weekly_$(date +%Y%U)

🔧 升级前备份：
sudo rabbitmqctl rotate_logs before_upgrade_v3.9

🚨 故障现场保护：
sudo rabbitmqctl rotate_logs incident_$(date +%Y%m%d_%H%M)

📈 性能测试：
sudo rabbitmqctl rotate_logs performance_test_start
```

### 2.4 自动化日志轮转


**⏰ 使用cron定时轮转**：
```bash
# 编辑cron任务
crontab -e

# 添加定时轮转任务（每天凌晨2点）
0 2 * * * /usr/sbin/rabbitmqctl rotate_logs daily_$(date +\%Y\%m\%d)

# 每周日轮转
0 2 * * 0 /usr/sbin/rabbitmqctl rotate_logs weekly_$(date +\%Y\%U)
```

**🧹 日志清理脚本示例**：
```bash
#!/bin/bash
# cleanup_rabbitmq_logs.sh

# 轮转当前日志
sudo rabbitmqctl rotate_logs "cleanup_$(date +%Y%m%d)"

# 删除30天前的日志文件
find /var/log/rabbitmq/ -name "rabbit@*.log.*" -mtime +30 -delete

# 压缩7天前的日志文件
find /var/log/rabbitmq/ -name "rabbit@*.log.*" -mtime +7 -exec gzip {} \;

echo "日志清理完成：$(date)"
```

---

## 3. 📊 日志级别控制


### 3.1 理解日志级别


**日志级别就像音响的音量调节**：
- 级别越高，记录的信息越少（只记录重要的）
- 级别越低，记录的信息越详细（记录所有细节）

```
🔊 日志级别从详细到简略：
debug   ← 最详细，包含调试信息
info    ← 一般信息，日常运行状态  
warning ← 警告信息，需要注意
error   ← 错误信息，影响功能
critical← 最严重，系统级错误
```

### 3.2 设置日志级别


**⚙️ `rabbitmqctl set_log_level {level}` - 动态调整日志级别**

```bash
# 设置为debug级别（最详细，用于故障排查）
sudo rabbitmqctl set_log_level debug

# 设置为info级别（推荐的生产环境级别）
sudo rabbitmqctl set_log_level info

# 设置为warning级别（只记录警告和错误）
sudo rabbitmqctl set_log_level warning

# 设置为error级别（只记录错误）
sudo rabbitmqctl set_log_level error
```

### 3.3 不同级别的实际效果


**📋 各级别日志内容对比**：

```
🔍 debug级别示例：
2024-09-20 10:30:15.123 [debug] Connection established from 192.168.1.100:51234
2024-09-20 10:30:15.125 [debug] Channel 1 opened by connection <0.1234.0>
2024-09-20 10:30:15.127 [debug] Queue 'task_queue' declared on channel 1
2024-09-20 10:30:15.130 [debug] Message published to queue 'task_queue'

ℹ️ info级别示例：
2024-09-20 10:30:15 [info] Started RabbitMQ node rabbit@server
2024-09-20 10:30:16 [info] New connection from 192.168.1.100

⚠️ warning级别示例：  
2024-09-20 10:30:20 [warning] Memory usage above 80% threshold
2024-09-20 10:30:25 [warning] Disk space running low

❌ error级别示例：
2024-09-20 10:30:30 [error] Connection lost: network unreachable
2024-09-20 10:30:35 [error] Queue declaration failed: insufficient permissions
```

### 3.4 级别选择建议


**🎯 不同环境的推荐级别**：

| 环境类型 | **推荐级别** | **原因说明** |
|---------|-------------|-------------|
| **开发环境** | `debug` | `需要详细信息调试代码` |
| **测试环境** | `info` | `平衡详细度和性能` |
| **生产环境** | `warning` | `减少日志量，关注重要问题` |
| **故障排查** | `debug` | `临时开启获取详细信息` |

**⚠️ 注意事项**：
```
性能影响：
• debug级别会显著增加I/O负载
• 生产环境谨慎使用debug级别
• 排查完问题记得调回正常级别

存储影响：
• debug级别日志文件增长很快
• 需要更频繁的日志轮转
• 确保有足够的磁盘空间
```

---

## 4. 👀 日志查看和监控


### 4.1 实时日志查看


**🔍 `rabbitmqctl log_tail` - 查看日志尾部（实时监控）**

```bash
# 查看最新的日志输出（类似tail -f）
sudo rabbitmqctl log_tail

# 实时输出示例：
# 2024-09-20 10:45:23 [info] Connection from 192.168.1.100 established
# 2024-09-20 10:45:24 [info] Channel opened on connection
# 2024-09-20 10:45:25 [info] Message published to exchange 'amq.direct'
```

**⏱️ `rabbitmqctl log_tail {duration}` - 指定查看时间长度**

```bash
# 查看最近30秒的日志
sudo rabbitmqctl log_tail 30

# 查看最近5分钟的日志  
sudo rabbitmqctl log_tail 300

# 查看最近1小时的日志
sudo rabbitmqctl log_tail 3600
```

### 4.2 诊断日志命令


**🔧 `rabbitmq-diagnostics log_tail` - 诊断工具查看日志**

```bash
# 使用诊断工具查看日志尾部
sudo rabbitmq-diagnostics log_tail

# 诊断工具的优势：
# • 提供更多的上下文信息
# • 可以同时显示多个节点的日志
# • 包含系统状态相关信息
```

**📏 `rabbitmq-diagnostics log_tail {n}` - 查看指定行数**

```bash
# 查看最后10行日志
sudo rabbitmq-diagnostics log_tail 10

# 查看最后50行日志
sudo rabbitmq-diagnostics log_tail 50

# 查看最后100行日志
sudo rabbitmq-diagnostics log_tail 100
```

### 4.3 日志查看实用技巧


**💡 结合系统工具使用**：
```bash
# 使用grep过滤特定内容
sudo rabbitmqctl log_tail | grep "error"
sudo rabbitmqctl log_tail | grep "192.168.1.100"

# 使用awk提取特定字段
sudo rabbitmqctl log_tail | awk '{print $1, $2, $4}'

# 保存日志到文件
sudo rabbitmqctl log_tail 60 > /tmp/rabbitmq_recent.log
```

**🔎 常用查看场景**：
```bash
# 监控新连接
sudo rabbitmqctl log_tail | grep "Connection.*established"

# 监控错误信息
sudo rabbitmqctl log_tail | grep -E "(error|warning|critical)"

# 监控特定队列
sudo rabbitmqctl log_tail | grep "my_important_queue"

# 监控内存使用
sudo rabbitmqctl log_tail | grep "memory"
```

---

## 5. 🔍 消息跟踪功能


### 5.1 消息跟踪基本概念


**什么是消息跟踪？**
就像给包裹贴上跟踪单号一样，消息跟踪让你能看到每条消息在RabbitMQ系统中的完整"旅程"。

```
📦 消息的完整旅程：
生产者 → 交换机 → 队列 → 消费者

🔍 跟踪能看到什么：
• 消息什么时候发送的
• 消息经过了哪些组件  
• 消息是否被成功投递
• 消息是否被确认消费
• 如果失败，失败的原因是什么
```

### 5.2 启用消息跟踪


**🔛 `rabbitmqctl trace_on {vhost}` - 启用指定虚拟主机的跟踪**

```bash
# 在默认虚拟主机启用跟踪
sudo rabbitmqctl trace_on /

# 在指定虚拟主机启用跟踪
sudo rabbitmqctl trace_on /production
sudo rabbitmqctl trace_on /development

# 启用后的提示信息：
# Tracing enabled for vhost "/production"
```

**⚠️ 重要注意事项**：
```
性能影响：
• 跟踪会显著增加系统负载
• 仅在需要排查问题时启用
• 生产环境要谨慎使用

资源消耗：
• 会生成大量跟踪数据
• 需要额外的存储空间
• 影响消息处理速度
```

### 5.3 查看跟踪数据


**📊 跟踪数据查看方法**：
```bash
# 查看跟踪队列（跟踪数据存储在特殊队列中）
sudo rabbitmqctl list_queues -p / name messages | grep amq.rabbitmq.trace

# 跟踪数据示例：
# 队列名称：amq.rabbitmq.trace.publish.默认交换机
# 队列名称：amq.rabbitmq.trace.deliver.队列名
```

**🔍 实际跟踪信息示例**：
```json
跟踪消息内容：
{
  "type": "published",
  "timestamp": "2024-09-20T10:30:15.123Z",
  "node": "rabbit@server",
  "connection": "192.168.1.100:51234",
  "channel": 1,
  "exchange": "user_events",
  "routing_key": "user.login",
  "properties": {
    "message_id": "msg_12345",
    "timestamp": 1726831815
  },
  "payload": "用户登录消息内容"
}
```

### 5.4 禁用消息跟踪


**🔛 `rabbitmqctl trace_off {vhost}` - 禁用指定虚拟主机的跟踪**

```bash
# 禁用默认虚拟主机的跟踪
sudo rabbitmqctl trace_off /

# 禁用指定虚拟主机的跟踪
sudo rabbitmqctl trace_off /production

# 禁用后的提示：
# Tracing disabled for vhost "/production"
```

**🧹 清理跟踪数据**：
```bash
# 禁用跟踪后，手动清理跟踪队列
sudo rabbitmqctl delete_queue -p / amq.rabbitmq.trace.publish.amq.direct
sudo rabbitmqctl delete_queue -p / amq.rabbitmq.trace.deliver.task_queue

# 或者使用脚本批量清理
for queue in $(sudo rabbitmqctl list_queues -p / name | grep amq.rabbitmq.trace); do
    sudo rabbitmqctl delete_queue -p / $queue
done
```

---

## 6. 💾 内存水位监控


### 6.1 内存水位概念解释


**什么是内存水位？**
就像水库的水位线一样，内存水位是RabbitMQ设置的安全警戒线，防止系统因内存不足而崩溃。

```
🌊 内存水位机制：
正常运行区域    |████████████| 0-40%  ✅ 正常运行
警告区域        |░░░░░░░░░░░░| 40-80% ⚠️ 开始警告  
危险区域        |▓▓▓▓▓▓▓▓▓▓▓▓| 80-95% 🚨 限制生产者
紧急停止        |████████████| 95%+   🛑 停止接收消息
```

### 6.2 设置内存水位


**⚙️ `rabbitmqctl set_vm_memory_high_watermark {fraction}` - 设置内存高水位**

```bash
# 设置内存水位为系统内存的50%（默认40%）
sudo rabbitmqctl set_vm_memory_high_watermark 0.5

# 设置为80%（较激进的设置）
sudo rabbitmqctl set_vm_memory_high_watermark 0.8

# 设置为30%（保守设置）
sudo rabbitmqctl set_vm_memory_high_watermark 0.3
```

### 6.3 不同水位设置的影响


**📊 水位设置对比**：

| 水位设置 | **适用场景** | **优点** | **缺点** |
|---------|-------------|---------|---------|
| **30%** | `内存紧张服务器` | `最安全，不易崩溃` | `内存利用率低` |
| **40%** | `生产环境推荐` | `平衡安全性和性能` | `标准配置` |
| **60%** | `内存充足环境` | `更高内存利用率` | `风险稍高` |
| **80%** | `开发测试环境` | `最大化内存使用` | `有崩溃风险` |

### 6.4 内存监控实践


**🔍 监控内存使用情况**：
```bash
# 查看当前内存使用状态
sudo rabbitmqctl status | grep memory

# 查看详细的内存统计
sudo rabbitmq-diagnostics memory_breakdown

# 监控内存相关日志
sudo rabbitmqctl log_tail | grep -i memory
```

**🚨 内存告警处理**：
```
内存警告处理步骤：

1. 立即查看内存使用情况
sudo rabbitmq-diagnostics memory_breakdown

2. 查看哪些队列占用内存最多
sudo rabbitmqctl list_queues name memory

3. 临时降低内存水位（紧急情况）
sudo rabbitmqctl set_vm_memory_high_watermark 0.3

4. 排查内存泄漏或消息积压问题
sudo rabbitmqctl list_queues name messages

5. 清理不必要的队列和消息
sudo rabbitmqctl purge_queue problem_queue_name
```

---

## 7. 🔐 审计和安全日志


### 7.1 审计日志概念


**什么是审计日志？**
审计日志就像银行的监控录像，记录着"谁在什么时候做了什么操作"，主要用于安全监控和合规要求。

```
🔍 审计日志记录内容：
• 用户登录和登出
• 权限变更操作
• 队列和交换机的创建删除
• 配置参数的修改
• 敏感操作的执行
```

### 7.2 启用审计功能


**🔧 配置审计日志**：
```bash
# 在rabbitmq.conf中启用审计
echo "auth_backends.1 = rabbit_auth_backend_internal" >> /etc/rabbitmq/rabbitmq.conf
echo "auth_backends.2 = rabbit_auth_backend_ldap" >> /etc/rabbitmq/rabbitmq.conf

# 启用详细的连接日志
echo "log.connection.level = info" >> /etc/rabbitmq/rabbitmq.conf

# 重启服务使配置生效
sudo systemctl restart rabbitmq-server
```

### 7.3 安全事件监控


**🔒 关键安全事件**：
```bash
# 监控登录失败
sudo rabbitmqctl log_tail | grep -i "authentication.*failed"

# 监控权限被拒绝
sudo rabbitmqctl log_tail | grep -i "access.*denied"

# 监控异常连接
sudo rabbitmqctl log_tail | grep -E "connection.*closed|connection.*failed"

# 监控管理员操作
sudo rabbitmqctl log_tail | grep -i "admin\|management"
```

**📋 安全日志示例**：
```
安全相关日志内容：
2024-09-20 10:30:15 [warning] User 'guest' failed authentication from 192.168.1.100
2024-09-20 10:30:20 [info] User 'admin' logged in from 192.168.1.50
2024-09-20 10:30:25 [warning] Access denied for user 'readonly' to queue 'admin_queue'
2024-09-20 10:30:30 [info] Queue 'sensitive_data' created by user 'admin'
2024-09-20 10:30:35 [warning] Multiple failed login attempts from 192.168.1.200
```

### 7.4 合规性日志管理


**📜 合规性要求处理**：
```bash
# 创建专门的审计日志目录
sudo mkdir -p /var/log/rabbitmq/audit

# 配置单独的审计日志文件
echo "audit.log.file = /var/log/rabbitmq/audit/audit.log" >> /etc/rabbitmq/rabbitmq.conf

# 设置日志保留策略（保留1年）
echo "audit.log.rotation.size = 100MB" >> /etc/rabbitmq/rabbitmq.conf
echo "audit.log.rotation.keep = 365" >> /etc/rabbitmq/rabbitmq.conf
```

**🔐 审计数据保护**：
```bash
# 设置审计日志的权限（只有管理员可读）
sudo chmod 600 /var/log/rabbitmq/audit/*
sudo chown rabbitmq:rabbitmq /var/log/rabbitmq/audit/*

# 启用日志文件完整性校验
sudo find /var/log/rabbitmq/audit -name "*.log" -exec md5sum {} \; > /var/log/rabbitmq/audit/checksums.md5
```

---

## 8. 🔧 日志故障排查


### 8.1 常见日志问题


**📋 典型问题及解决方案**：

**问题1：日志文件过大导致磁盘满**
```bash
# 紧急处理：立即轮转日志
sudo rabbitmqctl rotate_logs emergency_cleanup

# 压缩历史日志文件
sudo gzip /var/log/rabbitmq/rabbit@*.log.*

# 删除过期日志（超过30天）
sudo find /var/log/rabbitmq -name "*.log.*" -mtime +30 -delete

# 设置定期清理
echo "0 2 * * * find /var/log/rabbitmq -name '*.log.*' -mtime +30 -delete" | sudo crontab -
```

**问题2：无法查看日志（权限问题）**
```bash
# 检查日志文件权限
ls -la /var/log/rabbitmq/

# 修复权限问题
sudo chown rabbitmq:rabbitmq /var/log/rabbitmq/*
sudo chmod 644 /var/log/rabbitmq/*.log

# 确保用户在正确的组中
sudo usermod -a -G rabbitmq $USER
```

**问题3：日志级别设置不生效**
```bash
# 检查当前配置
sudo rabbitmq-diagnostics environment | grep log

# 重新设置日志级别
sudo rabbitmqctl set_log_level info

# 重启服务（如果配置文件冲突）
sudo systemctl restart rabbitmq-server
```

### 8.2 性能问题诊断


**🔍 通过日志诊断性能问题**：
```bash
# 查看连接相关问题
sudo rabbitmqctl log_tail | grep -E "connection.*timeout|connection.*closed"

# 查看内存相关警告
sudo rabbitmqctl log_tail | grep -i "memory.*high"

# 查看磁盘相关问题
sudo rabbitmqctl log_tail | grep -i "disk.*full|disk.*space"

# 查看队列积压问题
sudo rabbitmqctl log_tail | grep -i "queue.*full|message.*dropped"
```

### 8.3 网络问题排查


**🌐 网络连接问题分析**：
```bash
# 监控连接建立和断开
sudo rabbitmqctl log_tail | grep -E "connection.*(established|closed|lost)"

# 查看SSL/TLS相关问题
sudo rabbitmqctl log_tail | grep -i "ssl\|tls\|certificate"

# 监控心跳检测问题
sudo rabbitmqctl log_tail | grep -i "heartbeat\|missed"
```

### 8.4 故障排查脚本


**🛠️ 综合诊断脚本**：
```bash
#!/bin/bash
# rabbitmq_health_check.sh

echo "=== RabbitMQ健康检查报告 ==="
echo "检查时间: $(date)"
echo

# 检查服务状态
echo "1. 服务状态检查:"
sudo systemctl is-active rabbitmq-server
echo

# 检查内存使用
echo "2. 内存使用情况:"
sudo rabbitmq-diagnostics memory_breakdown | head -10
echo

# 检查磁盘空间
echo "3. 磁盘空间检查:"
df -h /var/log/rabbitmq/
echo

# 检查最近的错误日志
echo "4. 最近的错误信息:"
sudo rabbitmqctl log_tail 100 | grep -i error | tail -5
echo

# 检查连接数量
echo "5. 连接数量统计:"
sudo rabbitmqctl list_connections | wc -l
echo

echo "=== 检查完成 ==="
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的基本概念


```
🔸 日志管理本质：记录系统运行状态，便于监控和故障排查
🔸 日志轮转作用：防止单文件过大，便于历史数据管理  
🔸 日志级别控制：平衡信息详细度和系统性能
🔸 消息跟踪功能：详细跟踪消息流向，用于问题诊断
🔸 内存水位机制：防止内存耗尽，保护系统稳定性
🔸 审计日志价值：安全监控和合规性要求
```

### 9.2 关键理解要点


**🔹 日志管理的重要性**：
```
为什么要重视日志管理：
• 系统健康监控的眼睛
• 故障排查的重要线索
• 性能优化的数据基础
• 安全审计的必要工具
• 合规性要求的支撑
```

**🔹 日志级别选择策略**：
```
选择原则：
• 开发阶段：使用debug级别，便于调试
• 测试阶段：使用info级别，平衡性能和信息
• 生产环境：使用warning级别，减少性能影响
• 故障排查：临时开启debug，排查后恢复
```

**🔹 内存水位设置考虑**：
```
设置因素：
• 服务器总内存大小
• 其他服务的内存需求
• 消息处理的特点
• 业务对可用性的要求
• 运维团队的响应能力
```

### 9.3 实际应用指导


**💼 日常运维建议**：
```
定期任务：
✅ 每日检查日志文件大小
✅ 每周执行日志轮转
✅ 每月清理历史日志
✅ 季度审查日志配置

监控重点：
✅ 错误和警告日志
✅ 内存使用趋势
✅ 连接异常情况
✅ 性能相关指标
```

**🛠️ 故障处理流程**：
```
问题排查步骤：
1. 查看最新的错误日志
2. 检查系统资源使用情况
3. 分析日志中的异常模式
4. 对比历史日志找出变化
5. 根据日志信息定位问题
6. 修复问题后验证日志
```

**🎯 性能优化建议**：
```
优化策略：
• 生产环境避免使用debug级别
• 定期清理和轮转日志文件
• 监控日志I/O对系统性能的影响
• 使用SSD存储重要日志文件
• 考虑日志的分布式存储方案
```

### 9.4 常用命令快速参考


**⚡ 日常操作命令**：
```bash
# 日志轮转
sudo rabbitmqctl rotate_logs

# 查看实时日志
sudo rabbitmqctl log_tail

# 设置日志级别为info
sudo rabbitmqctl set_log_level info

# 启用消息跟踪（谨慎使用）
sudo rabbitmqctl trace_on /

# 设置内存水位为40%
sudo rabbitmqctl set_vm_memory_high_watermark 0.4
```

**🔍 故障排查命令**：
```bash
# 查看最近的错误
sudo rabbitmqctl log_tail | grep error

# 检查内存使用
sudo rabbitmq-diagnostics memory_breakdown

# 查看连接状态
sudo rabbitmqctl list_connections

# 监控系统状态
sudo rabbitmqctl status
```

### 9.5 最佳实践总结


**📚 核心最佳实践**：
```
1. 🕐 定期轮转：设置自动日志轮转，防止文件过大
2. 📊 合理级别：根据环境选择合适的日志级别
3. 💾 监控空间：确保日志目录有足够的磁盘空间
4. 🔐 权限控制：保护敏感日志文件的访问权限
5. ⚠️ 谨慎跟踪：消息跟踪功能仅在必要时使用
6. 📈 趋势分析：定期分析日志趋势，预防问题
7. 🚨 告警设置：配置关键指标的自动告警
8. 📝 文档记录：记录重要的配置变更和故障处理
```

**🧠 记忆要点**：
- 日志是系统的"健康档案"，要定期检查和维护
- 轮转防止文件过大，级别控制平衡性能和信息
- 跟踪功能很强大但消耗资源，要谨慎使用
- 内存水位是安全防线，根据实际情况合理设置
- 审计日志对安全和合规很重要，要妥善保护

**核心理念**：良好的日志管理是RabbitMQ稳定运行的基础，要把日志当作重要的运维资产来对待！