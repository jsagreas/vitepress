---
title: 22ã€æ€§èƒ½ç›‘æ§å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [ç›‘æ§å‘½ä»¤åŸºç¡€æ¦‚å¿µ](#1-ç›‘æ§å‘½ä»¤åŸºç¡€æ¦‚å¿µ)
2. [å†…å­˜ç›‘æ§ä¸åˆ†æ](#2-å†…å­˜ç›‘æ§ä¸åˆ†æ)
3. [æ€§èƒ½çŠ¶æ€æ£€æŸ¥](#3-æ€§èƒ½çŠ¶æ€æ£€æŸ¥)
4. [ç³»ç»Ÿè¿è¡Œæ—¶ç›‘æ§](#4-ç³»ç»Ÿè¿è¡Œæ—¶ç›‘æ§)
5. [è¿æ¥ä¸ç«¯å£æ£€æŸ¥](#5-è¿æ¥ä¸ç«¯å£æ£€æŸ¥)
6. [æ•…éšœè¯Šæ–­ä¸é—®é¢˜æ’æŸ¥](#6-æ•…éšœè¯Šæ–­ä¸é—®é¢˜æ’æŸ¥)
7. [ç›‘æ§æœ€ä½³å®è·µ](#7-ç›‘æ§æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç›‘æ§å‘½ä»¤åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQç›‘æ§


**ç®€å•ç†è§£**ï¼šç›‘æ§å°±åƒåŒ»ç”Ÿç»™ç—…äººä½“æ£€ï¼Œé€šè¿‡å„ç§æ£€æŸ¥äº†è§£RabbitMQçš„"å¥åº·çŠ¶å†µ"

```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š
ä½“æ£€é¡¹ç›®          RabbitMQç›‘æ§
è¡€å‹æµ‹é‡    â†’     å†…å­˜ä½¿ç”¨æƒ…å†µ
å¿ƒç‡æ£€æŸ¥    â†’     æ¶ˆæ¯å¤„ç†é€Ÿåº¦  
ä½“æ¸©æµ‹é‡    â†’     ç³»ç»Ÿè´Ÿè½½çŠ¶æ€
è¡€æ¶²åŒ–éªŒ    â†’     è¿æ¥æ•°å’Œé˜Ÿåˆ—çŠ¶æ€
```

**ç›‘æ§çš„æ ¸å¿ƒç›®çš„**ï¼š
- **é¢„é˜²é—®é¢˜**ï¼šåœ¨é—®é¢˜å‘ç”Ÿå‰å‘ç°å¼‚å¸¸
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¾å‡ºç³»ç»Ÿç“¶é¢ˆï¼Œæå‡æ•ˆç‡
- **æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜
- **å®¹é‡è§„åˆ’**ï¼šäº†è§£èµ„æºä½¿ç”¨ï¼Œåˆç†æ‰©å®¹

### 1.2 rabbitmq-diagnostics å‘½ä»¤å®¶æ—


**å‘½ä»¤ç‰¹ç‚¹**ï¼š
```
rabbitmq-diagnostics = RabbitMQ + è¯Šæ–­å·¥å…·

å°±åƒåŒ»ç”Ÿçš„å¬è¯Šå™¨ã€è¡€å‹è®¡ã€ä½“æ¸©è®¡ä¸€æ ·
æ¯ä¸ªå‘½ä»¤éƒ½æ˜¯ä¸“é—¨çš„"æ£€æµ‹ä»ªå™¨"
```

**å‘½ä»¤åˆ†ç±»**ï¼š
- ğŸ§  **å†…å­˜ç›¸å…³**ï¼šæŸ¥çœ‹å†…å­˜ä½¿ç”¨åˆ†å¸ƒ
- âš¡ **æ€§èƒ½ç›¸å…³**ï¼šæ£€æŸ¥è¿è¡Œæ•ˆç‡
- ğŸ”— **è¿æ¥ç›¸å…³**ï¼šæ£€æŸ¥ç½‘ç»œå’Œç«¯å£
- ğŸš¨ **å‘Šè­¦ç›¸å…³**ï¼šæŸ¥çœ‹ç³»ç»Ÿè­¦å‘Š
- ğŸ¥ **å¥åº·ç›¸å…³**ï¼šæ•´ä½“å¥åº·æ£€æŸ¥

---

## 2. ğŸ§  å†…å­˜ç›‘æ§ä¸åˆ†æ


### 2.1 å†…å­˜ä½¿ç”¨åˆ†è§£åˆ†æ


**`rabbitmq-diagnostics memory_breakdown`**

**ä½œç”¨**ï¼šå°±åƒæŸ¥çœ‹æ‰‹æœºå­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µï¼Œçœ‹çœ‹å†…å­˜éƒ½è¢«ä»€ä¹ˆå ç”¨äº†

```bash
# æŸ¥çœ‹å†…å­˜è¯¦ç»†åˆ†å¸ƒ
rabbitmq-diagnostics memory_breakdown

# æŒ‡å®šèŠ‚ç‚¹æŸ¥çœ‹
rabbitmq-diagnostics memory_breakdown -n rabbit@server1
```

**è¾“å‡ºç¤ºä¾‹è§£è¯»**ï¼š
```
Memory breakdown on node rabbit@localhost:

connection_readers: 12.34 mb (8.2%)
connection_writers: 5.67 mb (3.8%)
connection_channels: 23.45 mb (15.6%)
connection_other: 8.90 mb (5.9%)
queue_procs: 45.67 mb (30.4%)
queue_slave_procs: 0.0 mb (0.0%)
plugins: 12.34 mb (8.2%)
other_proc: 15.67 mb (10.4%)
mnesia: 8.90 mb (5.9%)
mgmt_db: 5.67 mb (3.8%)
msg_index: 10.23 mb (6.8%)
other_ets: 1.23 mb (0.8%)
binary: 0.12 mb (0.1%)
code: 0.23 mb (0.2%)
atom: 0.45 mb (0.3%)
other_system: 0.78 mb (0.5%)
allocated_unused: 1.89 mb (1.3%)
reserved_unallocated: 2.34 mb (1.6%)
total: 150.12 mb
```

**é‡ç‚¹å…³æ³¨é¡¹ç›®**ï¼š

| å†…å­˜é¡¹ç›® | **é€šä¿—è§£é‡Š** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸ä¿¡å·** |
|---------|-------------|-------------|-------------|
| `queue_procs` | `é˜Ÿåˆ—è¿›ç¨‹å ç”¨çš„å†…å­˜` | `< 50%` | `> 70%` |
| `connection_channels` | `è¿æ¥å’Œé€šé“çš„å†…å­˜` | `< 30%` | `> 50%` |
| `msg_index` | `æ¶ˆæ¯ç´¢å¼•å†…å­˜` | `< 10%` | `> 20%` |
| `mnesia` | `æ•°æ®åº“å†…å­˜` | `< 15%` | `> 25%` |

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šå¦‚æœ `queue_procs` å ç”¨è¶…è¿‡70%ï¼Œè¯´æ˜é˜Ÿåˆ—é‡Œæ¶ˆæ¯å¤ªå¤šäº†ï¼Œå°±åƒåƒåœ¾æ¡¶æ»¡äº†éœ€è¦æ¸…ç†

### 2.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–å»ºè®®


**å†…å­˜å ç”¨è¿‡é«˜çš„åŸå› **ï¼š
```
é˜Ÿåˆ—å †ç§¯ï¼šæ¶ˆæ¯ç”Ÿäº§é€Ÿåº¦ > æ¶ˆè´¹é€Ÿåº¦
è¿æ¥è¿‡å¤šï¼šå®¢æˆ·ç«¯è¿æ¥æ•°é‡è¶…å‡ºé¢„æœŸ
æ’ä»¶å ç”¨ï¼šå®‰è£…äº†è€—å†…å­˜çš„æ’ä»¶
æ•°æ®æŒä¹…åŒ–ï¼šå¤§é‡æŒä¹…åŒ–æ¶ˆæ¯å ç”¨ç£ç›˜ç¼“å­˜
```

---

## 3. âš¡ æ€§èƒ½çŠ¶æ€æ£€æŸ¥


### 3.1 è¿è¡ŒçŠ¶æ€å…¨é¢æ£€æŸ¥


**`rabbitmq-diagnostics check_running`**

**ä½œç”¨**ï¼šæ£€æŸ¥RabbitMQæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå°±åƒæ£€æŸ¥æ±½è½¦å¼•æ“æ˜¯å¦å¯åŠ¨

```bash
# æ£€æŸ¥æœ¬åœ°èŠ‚ç‚¹æ˜¯å¦è¿è¡Œ
rabbitmq-diagnostics check_running

# æ£€æŸ¥æŒ‡å®šèŠ‚ç‚¹
rabbitmq-diagnostics check_running -n rabbit@server1

# é™é»˜æ£€æŸ¥ï¼ˆåªè¿”å›çŠ¶æ€ç ï¼‰
rabbitmq-diagnostics check_running -q
```

**è¿”å›ç»“æœ**ï¼š
```
# æ­£å¸¸è¿è¡Œ
RabbitMQ on node rabbit@localhost is running

# æœåŠ¡æœªè¿è¡Œ  
RabbitMQ on node rabbit@localhost is not running
Error: nodedown
```

> âš ï¸ **æ³¨æ„**ï¼šå¦‚æœè¿”å› `nodedown`ï¼Œè¯´æ˜RabbitMQæœåŠ¡æ²¡æœ‰å¯åŠ¨æˆ–ç½‘ç»œä¸é€š

### 3.2 æœ¬åœ°å‘Šè­¦æ£€æŸ¥


**`rabbitmq-diagnostics check_local_alarms`**

**ä½œç”¨**ï¼šæ£€æŸ¥ç³»ç»Ÿå‘Šè­¦ï¼Œå°±åƒæŸ¥çœ‹æ±½è½¦ä»ªè¡¨ç›˜çš„è­¦å‘Šç¯

```bash
# æ£€æŸ¥æœ¬åœ°å‘Šè­¦
rabbitmq-diagnostics check_local_alarms

# è¯¦ç»†å‘Šè­¦ä¿¡æ¯
rabbitmq-diagnostics check_local_alarms -v
```

**å¸¸è§å‘Šè­¦ç±»å‹**ï¼š

| å‘Šè­¦ç±»å‹ | **å«ä¹‰** | **è§¦å‘æ¡ä»¶** | **è§£å†³æ–¹æ³•** |
|---------|---------|-------------|-------------|
| `memory_alarm` | `å†…å­˜å‘Šè­¦` | `å†…å­˜ä½¿ç”¨ > 40%` | `å¢åŠ å†…å­˜æˆ–æ¸…ç†é˜Ÿåˆ—` |
| `disk_free_space_alarm` | `ç£ç›˜ç©ºé—´å‘Šè­¦` | `ç£ç›˜å‰©ä½™ < 50MB` | `æ¸…ç†ç£ç›˜ç©ºé—´` |
| `file_descriptor_alarm` | `æ–‡ä»¶æè¿°ç¬¦å‘Šè­¦` | `æ‰“å¼€æ–‡ä»¶æ•°è¿‡å¤š` | `å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶` |

**å‘Šè­¦è¾“å‡ºç¤ºä¾‹**ï¼š
```
# æ— å‘Šè­¦ï¼ˆæ­£å¸¸çŠ¶æ€ï¼‰
Node rabbit@localhost reported no alarms

# æœ‰å‘Šè­¦ï¼ˆéœ€è¦å¤„ç†ï¼‰
Node rabbit@localhost reported alarms: [memory]
```

### 3.3 è™šæ‹Ÿä¸»æœºæ£€æŸ¥


**`rabbitmq-diagnostics check_virtual_hosts`**

**ä½œç”¨**ï¼šæ£€æŸ¥è™šæ‹Ÿä¸»æœºçŠ¶æ€ï¼Œç¡®ä¿æ‰€æœ‰"æˆ¿é—´"éƒ½æ­£å¸¸

```bash
# æ£€æŸ¥æ‰€æœ‰è™šæ‹Ÿä¸»æœº
rabbitmq-diagnostics check_virtual_hosts

# æ£€æŸ¥ç‰¹å®šè™šæ‹Ÿä¸»æœº
rabbitmq-diagnostics check_virtual_hosts /my-vhost
```

**æ£€æŸ¥å†…å®¹**ï¼š
- è™šæ‹Ÿä¸»æœºæ˜¯å¦å­˜åœ¨
- é˜Ÿåˆ—æ˜¯å¦æ­£å¸¸
- äº¤æ¢å™¨æ˜¯å¦å¯ç”¨
- ç»‘å®šå…³ç³»æ˜¯å¦æ­£ç¡®

---

## 4. ğŸ”§ ç³»ç»Ÿè¿è¡Œæ—¶ç›‘æ§


### 4.1 çº¿ç¨‹ç»Ÿè®¡ä¿¡æ¯


**`rabbitmq-diagnostics runtime_thread_stats`**

**ä½œç”¨**ï¼šæŸ¥çœ‹ç³»ç»Ÿçº¿ç¨‹ä½¿ç”¨æƒ…å†µï¼Œå°±åƒæŸ¥çœ‹å·¥å‚é‡Œæœ‰å¤šå°‘å·¥äººåœ¨å·¥ä½œ

```bash
# æŸ¥çœ‹çº¿ç¨‹ç»Ÿè®¡
rabbitmq-diagnostics runtime_thread_stats

# æŒ‡å®šèŠ‚ç‚¹æŸ¥çœ‹
rabbitmq-diagnostics runtime_thread_stats -n rabbit@server1
```

**è¾“å‡ºè§£è¯»**ï¼š
```
Runtime thread stats on node rabbit@localhost:

total: 42
running: 3
runnable: 1  
waiting: 38
```

**å‚æ•°å«ä¹‰**ï¼š
- **`total`**ï¼šæ€»çº¿ç¨‹æ•°ï¼ˆå·¥äººæ€»æ•°ï¼‰
- **`running`**ï¼šæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼ˆæ­£åœ¨å¹²æ´»çš„å·¥äººï¼‰
- **`runnable`**ï¼šå°±ç»ªçº¿ç¨‹ï¼ˆå‡†å¤‡å¹²æ´»çš„å·¥äººï¼‰
- **`waiting`**ï¼šç­‰å¾…çº¿ç¨‹ï¼ˆä¼‘æ¯ä¸­çš„å·¥äººï¼‰

> ğŸ“Š **æ€§èƒ½æŒ‡æ ‡**ï¼š
> - `running` çº¿ç¨‹è¿‡å¤šï¼šç³»ç»Ÿè´Ÿè½½é«˜
> - `waiting` çº¿ç¨‹è¿‡å¤šï¼šå¯èƒ½æœ‰é˜»å¡

### 4.2 Erlangç‰ˆæœ¬æ£€æŸ¥


**`rabbitmq-diagnostics erlang_version`**

**ä½œç”¨**ï¼šæ£€æŸ¥åº•å±‚Erlangç‰ˆæœ¬ï¼Œç¡®ä¿å…¼å®¹æ€§

```bash
# æŸ¥çœ‹Erlangç‰ˆæœ¬
rabbitmq-diagnostics erlang_version
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
Erlang/OTP 24.3.4 [erts-12.3.2] [source] [64-bit] [smp:8:8] [ds:8:8:10] [async-threads:1] [jit]
```

**ç‰ˆæœ¬ä¿¡æ¯è§£è¯»**ï¼š
- **`24.3.4`**ï¼šErlangä¸»ç‰ˆæœ¬å·
- **`erts-12.3.2`**ï¼šErlangè¿è¡Œæ—¶ç³»ç»Ÿç‰ˆæœ¬
- **`smp:8:8`**ï¼šæ”¯æŒ8æ ¸CPU
- **`jit`**ï¼šå¯ç”¨å³æ—¶ç¼–è¯‘

---

## 5. ğŸ”— è¿æ¥ä¸ç«¯å£æ£€æŸ¥


### 5.1 ç«¯å£è¿é€šæ€§æ£€æŸ¥


**`rabbitmq-diagnostics check_port_connectivity`**

**ä½œç”¨**ï¼šæ£€æŸ¥ç½‘ç»œç«¯å£æ˜¯å¦èƒ½æ­£å¸¸è¿æ¥ï¼Œå°±åƒæµ‹è¯•ç”µè¯çº¿è·¯æ˜¯å¦é€šç•…

```bash
# æ£€æŸ¥é»˜è®¤ç«¯å£è¿é€šæ€§
rabbitmq-diagnostics check_port_connectivity

# æ£€æŸ¥æŒ‡å®šä¸»æœºå’Œç«¯å£
rabbitmq-diagnostics check_port_connectivity rabbit@server1 5672

# æ£€æŸ¥é›†ç¾¤èŠ‚ç‚¹é—´è¿é€šæ€§
rabbitmq-diagnostics check_port_connectivity rabbit@server2
```

**æ£€æŸ¥çš„ç«¯å£**ï¼š
- **`5672`**ï¼šAMQPåè®®ç«¯å£ï¼ˆæ™®é€šè¿æ¥ï¼‰
- **`5671`**ï¼šAMQP SSLç«¯å£ï¼ˆåŠ å¯†è¿æ¥ï¼‰
- **`15672`**ï¼šWebç®¡ç†ç•Œé¢ç«¯å£
- **`25672`**ï¼šé›†ç¾¤é€šä¿¡ç«¯å£

### 5.2 åè®®ç›‘å¬å™¨æ£€æŸ¥


**`rabbitmq-diagnostics check_protocol_listener`**

**ä½œç”¨**ï¼šæ£€æŸ¥RabbitMQæ˜¯å¦åœ¨æŒ‡å®šç«¯å£ç›‘å¬è¿æ¥

```bash
# æ£€æŸ¥AMQPç›‘å¬å™¨
rabbitmq-diagnostics check_protocol_listener amqp

# æ£€æŸ¥HTTPç®¡ç†ç•Œé¢ç›‘å¬å™¨  
rabbitmq-diagnostics check_protocol_listener http

# æ£€æŸ¥ç‰¹å®šç«¯å£ç›‘å¬å™¨
rabbitmq-diagnostics check_protocol_listener amqp 5672
```

**åè®®ç±»å‹**ï¼š
- **`amqp`**ï¼šæ¶ˆæ¯é˜Ÿåˆ—åè®®
- **`http`**ï¼šWebç®¡ç†ç•Œé¢
- **`https`**ï¼šåŠ å¯†Webç®¡ç†ç•Œé¢
- **`mqtt`**ï¼šç‰©è”ç½‘æ¶ˆæ¯åè®®

### 5.3 ç«¯å£ç›‘å¬å™¨æ£€æŸ¥


**`rabbitmq-diagnostics check_port_listener`**

**ä½œç”¨**ï¼šæ£€æŸ¥ç‰¹å®šç«¯å£æ˜¯å¦æœ‰è¿›ç¨‹åœ¨ç›‘å¬

```bash
# æ£€æŸ¥5672ç«¯å£ç›‘å¬çŠ¶æ€
rabbitmq-diagnostics check_port_listener 5672

# æ£€æŸ¥ç®¡ç†ç•Œé¢ç«¯å£
rabbitmq-diagnostics check_port_listener 15672

# æ£€æŸ¥SSLç«¯å£
rabbitmq-diagnostics check_port_listener 5671
```

**ç›‘å¬çŠ¶æ€å›¾ç¤º**ï¼š
```
ç«¯å£ç›‘å¬çŠ¶æ€æ£€æŸ¥æµç¨‹ï¼š

å¼€å§‹æ£€æŸ¥ç«¯å£
      â†“
  ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Ÿ
   â†™        â†˜
  æ˜¯         å¦
  â†“          â†“
ç›‘å¬æ­£å¸¸    ç«¯å£æœªå¼€æ”¾
è¿”å›OK     è¿”å›ERROR
```

---

## 6. ğŸš¨ æ•…éšœè¯Šæ–­ä¸é—®é¢˜æ’æŸ¥


### 6.1 å¡ä½è¿›ç¨‹æ£€æŸ¥


**`rabbitmq-diagnostics maybe_stuck`**

**ä½œç”¨**ï¼šæ‰¾å‡ºå¯èƒ½å¡ä½çš„è¿›ç¨‹ï¼Œå°±åƒæ‰¾å‡ºäº¤é€šå µå¡çš„åŸå› 

```bash
# æ£€æŸ¥å¯èƒ½å¡ä½çš„è¿›ç¨‹
rabbitmq-diagnostics maybe_stuck

# è¯¦ç»†æ£€æŸ¥å¡ä½è¿›ç¨‹
rabbitmq-diagnostics maybe_stuck -v

# æŒ‡å®šæ£€æŸ¥æ—¶é—´é˜ˆå€¼ï¼ˆç§’ï¼‰
rabbitmq-diagnostics maybe_stuck 30
```

**å¡ä½è¿›ç¨‹çš„è¡¨ç°**ï¼š
- æ¶ˆæ¯å¤„ç†é€Ÿåº¦å¼‚å¸¸ç¼“æ…¢
- é˜Ÿåˆ—é•¿åº¦æŒç»­å¢é•¿
- è¿æ¥å“åº”è¶…æ—¶
- å†…å­˜ä½¿ç”¨ç‡å¼‚å¸¸

### 6.2 ç»¼åˆå¥åº·æ£€æŸ¥


**å¥åº·æ£€æŸ¥å‘½ä»¤ç»„åˆ**ï¼š
```bash
# 1. åŸºç¡€è¿è¡ŒçŠ¶æ€
rabbitmq-diagnostics check_running

# 2. å‘Šè­¦çŠ¶æ€  
rabbitmq-diagnostics check_local_alarms

# 3. è™šæ‹Ÿä¸»æœºçŠ¶æ€
rabbitmq-diagnostics check_virtual_hosts

# 4. ç«¯å£è¿é€šæ€§
rabbitmq-diagnostics check_port_connectivity

# 5. å†…å­˜ä½¿ç”¨æƒ…å†µ
rabbitmq-diagnostics memory_breakdown
```

**å¥åº·æ£€æŸ¥è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
echo "=== RabbitMQ å¥åº·æ£€æŸ¥ ==="

echo "1. æ£€æŸ¥è¿è¡ŒçŠ¶æ€..."
rabbitmq-diagnostics check_running

echo "2. æ£€æŸ¥å‘Šè­¦ä¿¡æ¯..."
rabbitmq-diagnostics check_local_alarms

echo "3. æ£€æŸ¥å†…å­˜ä½¿ç”¨..."
rabbitmq-diagnostics memory_breakdown | head -10

echo "4. æ£€æŸ¥çº¿ç¨‹çŠ¶æ€..."
rabbitmq-diagnostics runtime_thread_stats

echo "å¥åº·æ£€æŸ¥å®Œæˆï¼"
```

---

## 7. ğŸ“ˆ ç›‘æ§æœ€ä½³å®è·µ


### 7.1 ç›‘æ§é¢‘ç‡å»ºè®®


**ç›‘æ§ç­‰çº§åˆ’åˆ†**ï¼š

| ç›‘æ§çº§åˆ« | **æ£€æŸ¥é¢‘ç‡** | **ç›‘æ§å‘½ä»¤** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-------------|
| **å®æ—¶ç›‘æ§** | `æ¯åˆ†é’Ÿ` | `check_running`<br>`check_local_alarms` | `ç”Ÿäº§ç¯å¢ƒ` |
| **æ€§èƒ½ç›‘æ§** | `æ¯5åˆ†é’Ÿ` | `memory_breakdown`<br>`runtime_thread_stats` | `æ€§èƒ½è°ƒä¼˜` |
| **å¥åº·æ£€æŸ¥** | `æ¯å°æ—¶` | `check_virtual_hosts`<br>`maybe_stuck` | `é¢„é˜²æ€§ç»´æŠ¤` |
| **å…¨é¢æ£€æŸ¥** | `æ¯å¤©` | `æ‰€æœ‰è¯Šæ–­å‘½ä»¤` | `å®šæœŸä½“æ£€` |

### 7.2 å‘Šè­¦é˜ˆå€¼è®¾ç½®


**å…³é”®æŒ‡æ ‡é˜ˆå€¼**ï¼š
```
å†…å­˜ä½¿ç”¨ç‡ï¼š
ğŸŸ¢ æ­£å¸¸ï¼š< 60%
ğŸŸ¡ æ³¨æ„ï¼š60% - 80%  
ğŸ”´ å±é™©ï¼š> 80%

é˜Ÿåˆ—æ¶ˆæ¯æ•°ï¼š
ğŸŸ¢ æ­£å¸¸ï¼š< 1000æ¡
ğŸŸ¡ æ³¨æ„ï¼š1000 - 10000æ¡
ğŸ”´ å±é™©ï¼š> 10000æ¡

è¿æ¥æ•°ï¼š
ğŸŸ¢ æ­£å¸¸ï¼š< 100ä¸ª
ğŸŸ¡ æ³¨æ„ï¼š100 - 500ä¸ª
ğŸ”´ å±é™©ï¼š> 500ä¸ª
```

### 7.3 ç›‘æ§è„šæœ¬è‡ªåŠ¨åŒ–


**ç®€å•ç›‘æ§è„šæœ¬**ï¼š
```bash
#!/bin/bash

# å®šä¹‰é˜ˆå€¼
MEMORY_THRESHOLD=80
QUEUE_THRESHOLD=1000

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
memory_usage=$(rabbitmq-diagnostics memory_breakdown | head -1 | awk '{print $3}')

# æ£€æŸ¥å‘Šè­¦
alarms=$(rabbitmq-diagnostics check_local_alarms 2>&1)

# å‘é€å‘Šè­¦é€šçŸ¥
if [[ $alarms == *"alarm"* ]]; then
    echo "ğŸš¨ RabbitMQå‘Šè­¦ï¼š$alarms"
    # è¿™é‡Œå¯ä»¥æ·»åŠ é‚®ä»¶æˆ–å¾®ä¿¡é€šçŸ¥
fi

# è®°å½•ç›‘æ§æ—¥å¿—
echo "$(date): å†…å­˜ä½¿ç”¨ $memory_usage, å‘Šè­¦çŠ¶æ€ $alarms" >> /var/log/rabbitmq_monitor.log
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```
ğŸ” åŸºç¡€æ£€æŸ¥å‘½ä»¤ï¼š
â€¢ rabbitmq-diagnostics check_running - æ£€æŸ¥è¿è¡ŒçŠ¶æ€
â€¢ rabbitmq-diagnostics check_local_alarms - æ£€æŸ¥å‘Šè­¦
â€¢ rabbitmq-diagnostics check_virtual_hosts - æ£€æŸ¥è™šæ‹Ÿä¸»æœº

ğŸ§  å†…å­˜ç›‘æ§å‘½ä»¤ï¼š
â€¢ rabbitmq-diagnostics memory_breakdown - å†…å­˜ä½¿ç”¨åˆ†è§£

âš¡ æ€§èƒ½ç›‘æ§å‘½ä»¤ï¼š
â€¢ rabbitmq-diagnostics runtime_thread_stats - çº¿ç¨‹ç»Ÿè®¡
â€¢ rabbitmq-diagnostics maybe_stuck - æ£€æŸ¥å¡ä½è¿›ç¨‹

ğŸ”— è¿æ¥æ£€æŸ¥å‘½ä»¤ï¼š
â€¢ rabbitmq-diagnostics check_port_connectivity - ç«¯å£è¿é€šæ€§
â€¢ rabbitmq-diagnostics check_protocol_listener - åè®®ç›‘å¬å™¨
```

### 8.2 ç›‘æ§é‡ç‚¹å…³æ³¨é¡¹


**ğŸ”¹ å†…å­˜ä½¿ç”¨ç›‘æ§**
```
é‡ç‚¹å…³æ³¨ï¼š
- queue_procs å ç”¨ç‡ï¼ˆé˜Ÿåˆ—è¿›ç¨‹å†…å­˜ï¼‰
- connection_channels å ç”¨ç‡ï¼ˆè¿æ¥å†…å­˜ï¼‰
- æ€»å†…å­˜ä½¿ç”¨ç‡è¶‹åŠ¿

å±é™©ä¿¡å·ï¼š
- é˜Ÿåˆ—è¿›ç¨‹å ç”¨ > 70%
- æ€»å†…å­˜ä½¿ç”¨ > 80%
- å†…å­˜æŒç»­å¢é•¿ä¸é‡Šæ”¾
```

**ğŸ”¹ æ€§èƒ½çŠ¶æ€ç›‘æ§**
```
å…³é”®æŒ‡æ ‡ï¼š
- çº¿ç¨‹è¿è¡ŒçŠ¶æ€åˆ†å¸ƒ
- å‘Šè­¦å‡ºç°é¢‘ç‡
- ç«¯å£è¿é€šæ€§ç¨³å®šæ€§

å¼‚å¸¸è¡¨ç°ï¼š
- running çº¿ç¨‹è¿‡å¤š
- é¢‘ç¹å‡ºç°å†…å­˜å‘Šè­¦
- ç«¯å£è¿æ¥å¤±è´¥
```

### 8.3 æ•…éšœæ’æŸ¥æ€è·¯


**é—®é¢˜æ’æŸ¥æµç¨‹**ï¼š
```
ç¬¬1æ­¥ï¼šåŸºç¡€æ£€æŸ¥
rabbitmq-diagnostics check_running
â†“
ç¬¬2æ­¥ï¼šå‘Šè­¦æ£€æŸ¥  
rabbitmq-diagnostics check_local_alarms
â†“
ç¬¬3æ­¥ï¼šå†…å­˜åˆ†æ
rabbitmq-diagnostics memory_breakdown
â†“
ç¬¬4æ­¥ï¼šè¿›ç¨‹æ£€æŸ¥
rabbitmq-diagnostics maybe_stuck
â†“
ç¬¬5æ­¥ï¼šç½‘ç»œæ£€æŸ¥
rabbitmq-diagnostics check_port_connectivity
```

### 8.4 æ–°æ‰‹å¸¸è§é—®é¢˜


**â“ å¸¸è§ç–‘é—®è§£ç­”**ï¼š

> **Q**: å†…å­˜å ç”¨ä¸€ç›´å¾ˆé«˜æ€ä¹ˆåŠï¼Ÿ
> **A**: å…ˆç”¨ `memory_breakdown` çœ‹æ˜¯å“ªéƒ¨åˆ†å ç”¨é«˜ï¼Œé€šå¸¸æ˜¯é˜Ÿåˆ—å †ç§¯å¯¼è‡´

> **Q**: ç»å¸¸å‡ºç°å‘Šè­¦æ€ä¹ˆå¤„ç†ï¼Ÿ
> **A**: ç”¨ `check_local_alarms` æŸ¥çœ‹å…·ä½“å‘Šè­¦ç±»å‹ï¼Œé’ˆå¯¹æ€§è§£å†³

> **Q**: æ€ä¹ˆçŸ¥é“RabbitMQæ˜¯å¦æ­£å¸¸ï¼Ÿ
> **A**: å®šæœŸè¿è¡Œ `check_running` + `check_local_alarms` ç»„åˆæ£€æŸ¥

> **Q**: ç›‘æ§è„šæœ¬åº”è¯¥å¤šä¹…è¿è¡Œä¸€æ¬¡ï¼Ÿ
> **A**: åŸºç¡€æ£€æŸ¥æ¯åˆ†é’Ÿï¼Œæ€§èƒ½æ£€æŸ¥æ¯5åˆ†é’Ÿï¼Œå…¨é¢æ£€æŸ¥æ¯å°æ—¶

### 8.5 å®ç”¨æ“ä½œæŠ€å·§


**ğŸ’¡ å®æˆ˜å°è´´å£«**ï¼š
- **ç»„åˆä½¿ç”¨**ï¼šå¤šä¸ªå‘½ä»¤ç»„åˆä½¿ç”¨ï¼Œå…¨é¢äº†è§£ç³»ç»ŸçŠ¶æ€
- **å®šæ—¶ç›‘æ§**ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨åŒ–ç›‘æ§å’Œå‘Šè­¦
- **æ—¥å¿—è®°å½•**ï¼šç›‘æ§ç»“æœå†™å…¥æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
- **é˜ˆå€¼è®¾ç½®**ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼

**ğŸ¯ æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç›‘æ§æ˜¯é¢„é˜²é—®é¢˜çš„ç¬¬ä¸€é“é˜²çº¿
- memory_breakdown æ˜¯æ€§èƒ½åˆ†æçš„æ ¸å¿ƒå‘½ä»¤
- check_local_alarms æ˜¯å¥åº·çŠ¶æ€çš„é‡è¦æŒ‡æ ‡
- ç»„åˆå¤šä¸ªå‘½ä»¤æ‰èƒ½å…¨é¢äº†è§£ç³»ç»ŸçŠ¶æ€

**æ ¸å¿ƒç†å¿µ**ï¼šç›‘æ§ä¸æ˜¯ä¸ºäº†ç›‘æ§è€Œç›‘æ§ï¼Œè€Œæ˜¯ä¸ºäº†**åŠæ—¶å‘ç°é—®é¢˜**ã€**é¢„é˜²æ•…éšœå‘ç”Ÿ**ã€**ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½**ã€‚å°±åƒå®šæœŸä½“æ£€ä¸€æ ·ï¼Œè®©æˆ‘ä»¬çš„RabbitMQç³»ç»Ÿå§‹ç»ˆä¿æŒå¥åº·çŠ¶æ€ï¼