---
title: 12ã€é˜Ÿåˆ—ç­–ç•¥ç®¡ç†å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [é˜Ÿåˆ—ç­–ç•¥åŸºç¡€æ¦‚å¿µ](#1-é˜Ÿåˆ—ç­–ç•¥åŸºç¡€æ¦‚å¿µ)
2. [åŸºæœ¬ç­–ç•¥ç®¡ç†å‘½ä»¤](#2-åŸºæœ¬ç­–ç•¥ç®¡ç†å‘½ä»¤)
3. [æ“ä½œå‘˜ç­–ç•¥ç®¡ç†](#3-æ“ä½œå‘˜ç­–ç•¥ç®¡ç†)
4. [ä»²è£é˜Ÿåˆ—æˆå‘˜ç®¡ç†](#4-ä»²è£é˜Ÿåˆ—æˆå‘˜ç®¡ç†)
5. [å®æˆ˜åº”ç”¨åœºæ™¯](#5-å®æˆ˜åº”ç”¨åœºæ™¯)
6. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#6-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é˜Ÿåˆ—ç­–ç•¥åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é˜Ÿåˆ—ç­–ç•¥


**é€šä¿—ç†è§£**ï¼šé˜Ÿåˆ—ç­–ç•¥å°±åƒæ˜¯ç»™é˜Ÿåˆ—å®šåˆ¶çš„"è¡Œä¸ºè§„åˆ™"ï¼Œå‘Šè¯‰RabbitMQè¿™ä¸ªé˜Ÿåˆ—åº”è¯¥æ€ä¹ˆå·¥ä½œã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
å°±åƒç»™ä¸åŒæˆ¿é—´è®¾ç½®ä¸åŒçš„ç©ºè°ƒè§„åˆ™
- å§å®¤ï¼šæ™šä¸Šè‡ªåŠ¨è°ƒåˆ°26åº¦
- å®¢å…ï¼šæœ‰äººæ—¶ä¿æŒ24åº¦  
- ä¹¦æˆ¿ï¼šå·¥ä½œæ—¶é—´ä¿æŒ22åº¦

RabbitMQé˜Ÿåˆ—ç­–ç•¥ï¼š
- è®¢å•é˜Ÿåˆ—ï¼šé«˜å¯ç”¨ï¼Œé•œåƒåˆ°3ä¸ªèŠ‚ç‚¹
- æ—¥å¿—é˜Ÿåˆ—ï¼šè¿‡æœŸæ—¶é—´1å°æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤
- ä¸´æ—¶é˜Ÿåˆ—ï¼šå†…å­˜ä¼˜å…ˆï¼Œå¿«é€Ÿå¤„ç†
```

### 1.2 ç­–ç•¥çš„ä½œç”¨æœºåˆ¶


**ç­–ç•¥åŒ¹é…åŸç†**ï¼š
```
ç­–ç•¥åº”ç”¨æµç¨‹ï¼š
1. åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼ŒRabbitMQæ£€æŸ¥ç­–ç•¥åˆ—è¡¨
2. æŒ‰ç…§æ¨¡å¼(pattern)åŒ¹é…é˜Ÿåˆ—åç§°
3. æ‰¾åˆ°åŒ¹é…çš„ç­–ç•¥åï¼Œåº”ç”¨ç›¸åº”é…ç½®
4. é˜Ÿåˆ—æŒ‰ç…§ç­–ç•¥è§„åˆ™è¿è¡Œ

åŒ¹é…ç¤ºä¾‹ï¼š
ç­–ç•¥åç§°: ha-all
åŒ¹é…æ¨¡å¼: "order.*"  
é€‚ç”¨é˜Ÿåˆ—: order.payment, order.shipping, order.cancel
ä¸é€‚ç”¨: user.login, log.error
```

### 1.3 ç­–ç•¥ç±»å‹åˆ†ç±»


| ç­–ç•¥ç±»å‹ | **ä½œç”¨èŒƒå›´** | **æƒé™çº§åˆ«** | **å…¸å‹ç”¨é€”** |
|---------|-------------|-------------|-------------|
| ğŸ”¸ **æ™®é€šç­–ç•¥** | `æ‰€æœ‰è™šæ‹Ÿä¸»æœº` | `ç®¡ç†å‘˜è®¾ç½®` | `é«˜å¯ç”¨ã€TTLã€é˜Ÿåˆ—é•¿åº¦é™åˆ¶` |
| ğŸ”¸ **æ“ä½œå‘˜ç­–ç•¥** | `é›†ç¾¤çº§åˆ«` | `è¶…çº§ç®¡ç†å‘˜` | `é›†ç¾¤æ€§èƒ½ä¼˜åŒ–ã€èµ„æºé™åˆ¶` |
| ğŸ”¸ **ä»²è£é˜Ÿåˆ—ç­–ç•¥** | `ä»²è£é˜Ÿåˆ—ä¸“ç”¨` | `é›†ç¾¤ç®¡ç†` | `æˆå‘˜ç®¡ç†ã€å‰¯æœ¬æ•°é‡` |

---

## 2. âš™ï¸ åŸºæœ¬ç­–ç•¥ç®¡ç†å‘½ä»¤


### 2.1 è®¾ç½®é˜Ÿåˆ—ç­–ç•¥


**å‘½ä»¤è¯­æ³•**ï¼š
```bash
rabbitmqctl set_policy {ç­–ç•¥å} {åŒ¹é…æ¨¡å¼} {ç­–ç•¥å®šä¹‰}
```

**å‚æ•°è¯¦è§£**ï¼š
```
{ç­–ç•¥å}ï¼šç­–ç•¥çš„å”¯ä¸€æ ‡è¯†ï¼Œæ–¹ä¾¿ç®¡ç†
{åŒ¹é…æ¨¡å¼}ï¼šæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…é˜Ÿåˆ—åç§°
{ç­–ç•¥å®šä¹‰}ï¼šJSONæ ¼å¼çš„é…ç½®å‚æ•°
```

**å®ç”¨ç¤ºä¾‹**ï¼š

**ğŸ’¡ é«˜å¯ç”¨ç­–ç•¥ï¼ˆé˜Ÿåˆ—é•œåƒï¼‰**
```bash
# ä¸ºæ‰€æœ‰ä»¥"order"å¼€å¤´çš„é˜Ÿåˆ—è®¾ç½®é«˜å¯ç”¨
rabbitmqctl set_policy ha-order "^order\." \
  '{"ha-mode":"exactly","ha-params":3,"ha-sync-mode":"automatic"}'
```

**å«ä¹‰è§£é‡Š**ï¼š
- `ha-order`ï¼šç­–ç•¥åç§°ï¼Œä¾¿äºè¯†åˆ«
- `"^order\."`ï¼šåŒ¹é…æ‰€æœ‰ä»¥"order."å¼€å¤´çš„é˜Ÿåˆ—å
- `ha-mode: exactly`ï¼šç²¾ç¡®å‰¯æœ¬æ¨¡å¼
- `ha-params: 3`ï¼šä¿æŒ3ä¸ªå‰¯æœ¬
- `ha-sync-mode: automatic`ï¼šè‡ªåŠ¨åŒæ­¥æ•°æ®

**ğŸ’¡ æ¶ˆæ¯è¿‡æœŸç­–ç•¥**
```bash
# ä¸ºä¸´æ—¶é˜Ÿåˆ—è®¾ç½®1å°æ—¶è¿‡æœŸæ—¶é—´
rabbitmqctl set_policy temp-expire "^temp\." \
  '{"message-ttl":3600000,"expires":7200000}'
```

**å«ä¹‰è§£é‡Š**ï¼š
- `message-ttl: 3600000`ï¼šæ¶ˆæ¯1å°æ—¶åè¿‡æœŸï¼ˆæ¯«ç§’ï¼‰
- `expires: 7200000`ï¼šé˜Ÿåˆ—2å°æ—¶æ— ä½¿ç”¨åè‡ªåŠ¨åˆ é™¤

**ğŸ’¡ é˜Ÿåˆ—é•¿åº¦é™åˆ¶**
```bash
# é™åˆ¶æ—¥å¿—é˜Ÿåˆ—æœ€å¤§é•¿åº¦
rabbitmqctl set_policy log-limit "^log\." \
  '{"max-length":10000,"overflow":"drop-head"}'
```

**å«ä¹‰è§£é‡Š**ï¼š
- `max-length: 10000`ï¼šé˜Ÿåˆ—æœ€å¤šä¿ç•™1ä¸‡æ¡æ¶ˆæ¯
- `overflow: drop-head`ï¼šè¶…å‡ºæ—¶åˆ é™¤æœ€è€çš„æ¶ˆæ¯

### 2.2 æŸ¥çœ‹ç­–ç•¥åˆ—è¡¨


**æŸ¥çœ‹æ‰€æœ‰ç­–ç•¥**ï¼š
```bash
rabbitmqctl list_policies
```

**è¾“å‡ºç¤ºä¾‹è§£è¯»**ï¼š
```
ç­–ç•¥åç§°        è™šæ‹Ÿä¸»æœº    åŒ¹é…æ¨¡å¼       ç­–ç•¥å®šä¹‰
ha-order       /           ^order\.      {"ha-mode":"exactly"...}
temp-expire    /           ^temp\.       {"message-ttl":3600000}
log-limit      /           ^log\.        {"max-length":10000}
```

**æŒ‡å®šè™šæ‹Ÿä¸»æœºæŸ¥çœ‹**ï¼š
```bash
rabbitmqctl list_policies -p /production
```

### 2.3 åˆ é™¤ç­–ç•¥


**åˆ é™¤æŒ‡å®šç­–ç•¥**ï¼š
```bash
rabbitmqctl clear_policy ha-order
```

**æ‰¹é‡åˆ é™¤ç¤ºä¾‹**ï¼š
```bash
# åˆ é™¤æ‰€æœ‰ä¸´æ—¶ç­–ç•¥
rabbitmqctl clear_policy temp-expire
rabbitmqctl clear_policy temp-limit
rabbitmqctl clear_policy temp-routing
```

**âš ï¸ åˆ é™¤æ³¨æ„äº‹é¡¹**ï¼š
```
åˆ é™¤ç­–ç•¥åçš„å½±å“ï¼š
âœ… å·²å­˜åœ¨çš„é˜Ÿåˆ—ï¼šç»§ç»­æŒ‰åŸé…ç½®è¿è¡Œ
âŒ æ–°åˆ›å»ºé˜Ÿåˆ—ï¼šä¸å†åº”ç”¨è¯¥ç­–ç•¥
ğŸ”„ é‡å¯æœåŠ¡åï¼šæ‰€æœ‰é˜Ÿåˆ—é‡æ–°åº”ç”¨å½“å‰ç­–ç•¥
```

---

## 3. ğŸ›¡ï¸ æ“ä½œå‘˜ç­–ç•¥ç®¡ç†


### 3.1 æ“ä½œå‘˜ç­–ç•¥æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ“ä½œå‘˜ç­–ç•¥**ï¼š
```
æ™®é€šç­–ç•¥ vs æ“ä½œå‘˜ç­–ç•¥ï¼š

æ™®é€šç­–ç•¥ï¼š
- ä½œç”¨åŸŸï¼šå•ä¸ªè™šæ‹Ÿä¸»æœº
- æƒé™ï¼šç®¡ç†å‘˜å³å¯è®¾ç½®
- ç”¨é€”ï¼šä¸šåŠ¡ç›¸å…³é…ç½®

æ“ä½œå‘˜ç­–ç•¥ï¼š
- ä½œç”¨åŸŸï¼šæ•´ä¸ªé›†ç¾¤
- æƒé™ï¼šéœ€è¦è¶…çº§ç®¡ç†å‘˜
- ç”¨é€”ï¼šé›†ç¾¤çº§åˆ«çš„èµ„æºæ§åˆ¶
```

### 3.2 è®¾ç½®æ“ä½œå‘˜ç­–ç•¥


**å…¸å‹ä½¿ç”¨åœºæ™¯**ï¼š

**ğŸ’¡ é›†ç¾¤çº§åˆ«çš„èµ„æºé™åˆ¶**
```bash
# é™åˆ¶æ‰€æœ‰é˜Ÿåˆ—çš„æœ€å¤§æ¶ˆè´¹è€…æ•°é‡
rabbitmqctl set_operator_policy cluster-limit ".*" \
  '{"max-consumers":100}' --priority 10
```

**ğŸ’¡ å…¨å±€æ€§èƒ½ä¼˜åŒ–**
```bash
# è®¾ç½®é›†ç¾¤çº§åˆ«çš„å†…å­˜é™åˆ¶
rabbitmqctl set_operator_policy memory-control ".*" \
  '{"max-length-bytes":1073741824}' --priority 5
```

**å‚æ•°è¯´æ˜**ï¼š
- `--priority`ï¼šä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
- æ“ä½œå‘˜ç­–ç•¥ä¼˜å…ˆçº§æ€»æ˜¯é«˜äºæ™®é€šç­–ç•¥

### 3.3 æ“ä½œå‘˜ç­–ç•¥ç®¡ç†


**æŸ¥çœ‹æ“ä½œå‘˜ç­–ç•¥**ï¼š
```bash
rabbitmqctl list_operator_policies
```

**åˆ é™¤æ“ä½œå‘˜ç­–ç•¥**ï¼š
```bash
rabbitmqctl clear_operator_policy cluster-limit
```

**ç­–ç•¥ä¼˜å…ˆçº§ç¤ºä¾‹**ï¼š
```
åº”ç”¨é¡ºåºï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š
1. æ“ä½œå‘˜ç­–ç•¥ (priority: 10)
2. æ“ä½œå‘˜ç­–ç•¥ (priority: 5)  
3. æ™®é€šç­–ç•¥ (priority: 1)
4. é˜Ÿåˆ—é»˜è®¤é…ç½®

æœ€ç»ˆæ•ˆæœï¼šé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§çš„ç›¸åŒé…ç½®é¡¹
```

---

## 4. ğŸ”„ ä»²è£é˜Ÿåˆ—æˆå‘˜ç®¡ç†


### 4.1 ä»²è£é˜Ÿåˆ—åŸºç¡€


**ä»€ä¹ˆæ˜¯ä»²è£é˜Ÿåˆ—**ï¼š
```
ä»²è£é˜Ÿåˆ—ç‰¹ç‚¹ï¼š
- åŸºäºRaftå…±è¯†ç®—æ³•
- ä¿è¯å¼ºä¸€è‡´æ€§
- è‡ªåŠ¨æ•…éšœæ¢å¤
- æ€§èƒ½æ¯”é•œåƒé˜Ÿåˆ—æ›´å¥½

ä½¿ç”¨åœºæ™¯ï¼š
âœ… é‡‘èäº¤æ˜“ç³»ç»Ÿ
âœ… è®¢å•å¤„ç†ç³»ç»Ÿ  
âœ… å…³é”®ä¸šåŠ¡æ•°æ®
âŒ é«˜é¢‘ç‡ä¸´æ—¶æ¶ˆæ¯
```

### 4.2 é˜Ÿåˆ—æˆå‘˜ç®¡ç†


**æ·»åŠ é˜Ÿåˆ—æˆå‘˜**ï¼š
```bash
# ä¸ºè®¢å•é˜Ÿåˆ—æ·»åŠ æ–°çš„å‰¯æœ¬èŠ‚ç‚¹
rabbitmq-queues add_member orders.payment rabbit@node3
```

**åº”ç”¨åœºæ™¯**ï¼š
```
ä½•æ—¶æ·»åŠ æˆå‘˜ï¼š
ğŸ”¸ é›†ç¾¤æ‰©å®¹ï¼šæ–°å¢èŠ‚ç‚¹åå¢åŠ å‰¯æœ¬
ğŸ”¸ æé«˜å¯ç”¨æ€§ï¼šé‡è¦é˜Ÿåˆ—å¢åŠ å¤‡ä»½
ğŸ”¸ è´Ÿè½½åˆ†æ•£ï¼šå°†è´Ÿè½½åˆ†å¸ƒåˆ°æ›´å¤šèŠ‚ç‚¹

å®é™…æ“ä½œæµç¨‹ï¼š
1. æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤
2. ä½¿ç”¨add_memberæ·»åŠ åˆ°é‡è¦é˜Ÿåˆ—
3. ç­‰å¾…æ•°æ®åŒæ­¥å®Œæˆ
4. éªŒè¯é˜Ÿåˆ—çŠ¶æ€æ­£å¸¸
```

**åˆ é™¤é˜Ÿåˆ—æˆå‘˜**ï¼š
```bash
# ä»é˜Ÿåˆ—ä¸­ç§»é™¤èŠ‚ç‚¹ï¼ˆé€šå¸¸æ˜¯æ•…éšœèŠ‚ç‚¹ï¼‰
rabbitmq-queues delete_member orders.payment rabbit@node3
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```
ä½•æ—¶åˆ é™¤æˆå‘˜ï¼š
ğŸ”¸ èŠ‚ç‚¹æ•…éšœï¼šæ°¸ä¹…æ€§æ•…éšœçš„èŠ‚ç‚¹
ğŸ”¸ é›†ç¾¤ç¼©å®¹ï¼šå‡å°‘ä¸å¿…è¦çš„å‰¯æœ¬
ğŸ”¸ ç»´æŠ¤æ“ä½œï¼šä¸´æ—¶ç§»é™¤è¿›è¡Œç»´æŠ¤

æ³¨æ„äº‹é¡¹ï¼š
âš ï¸ ç¡®ä¿è‡³å°‘ä¿ç•™å¥‡æ•°ä¸ªæˆå‘˜
âš ï¸ ä¸è¦åŒæ—¶åˆ é™¤å¤šä¸ªæˆå‘˜
âš ï¸ åˆ é™¤å‰ç¡®è®¤æ•°æ®å·²åŒæ­¥
```

### 4.3 é˜Ÿåˆ—æ‰©ç¼©å®¹æ“ä½œ


**å¢é•¿ä»²è£é˜Ÿåˆ—**ï¼š
```bash
# è‡ªåŠ¨é€‰æ‹©æœ€ä½³èŠ‚ç‚¹å¢åŠ å‰¯æœ¬
rabbitmq-queues grow orders.payment rabbit@node4
```

**æ”¶ç¼©ä»²è£é˜Ÿåˆ—**ï¼š
```bash
# è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹ç§»é™¤å‰¯æœ¬
rabbitmq-queues shrink orders.payment rabbit@node2
```

**è‡ªåŠ¨åŒ–ç®¡ç†ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# ä»²è£é˜Ÿåˆ—è‡ªåŠ¨æ‰©ç¼©å®¹è„šæœ¬

# æ£€æŸ¥é›†ç¾¤èŠ‚ç‚¹æ•°é‡
NODE_COUNT=$(rabbitmqctl cluster_status | grep -c "rabbit@")

# æ ¹æ®èŠ‚ç‚¹æ•°é‡è°ƒæ•´é˜Ÿåˆ—å‰¯æœ¬
if [ $NODE_COUNT -ge 5 ]; then
    # èŠ‚ç‚¹å……è¶³æ—¶å¢åŠ å‰¯æœ¬
    rabbitmq-queues grow critical.orders rabbit@node5
elif [ $NODE_COUNT -le 3 ]; then
    # èŠ‚ç‚¹ä¸è¶³æ—¶å‡å°‘å‰¯æœ¬
    rabbitmq-queues shrink critical.orders rabbit@node4
fi
```

---

## 5. ğŸš€ å®æˆ˜åº”ç”¨åœºæ™¯


### 5.1 ç”µå•†ç³»ç»Ÿç­–ç•¥é…ç½®


**è®¢å•å¤„ç†é˜Ÿåˆ—ç­–ç•¥**ï¼š
```bash
# è®¢å•é˜Ÿåˆ—ï¼šé«˜å¯ç”¨ + æŒä¹…åŒ–
rabbitmqctl set_policy order-ha "^order\." \
  '{"ha-mode":"exactly","ha-params":3,"delivery-mode":2}'

# æ”¯ä»˜é˜Ÿåˆ—ï¼šä»²è£é˜Ÿåˆ—ç¡®ä¿ä¸€è‡´æ€§
rabbitmq-queues add_member payment.process rabbit@node1
rabbitmq-queues add_member payment.process rabbit@node2
rabbitmq-queues add_member payment.process rabbit@node3
```

**æ—¥å¿—å¤„ç†ç­–ç•¥**ï¼š
```bash
# åº”ç”¨æ—¥å¿—ï¼šé™åˆ¶é•¿åº¦ + è‡ªåŠ¨è¿‡æœŸ
rabbitmqctl set_policy log-rotate "^log\." \
  '{"max-length":50000,"message-ttl":86400000}'

# é”™è¯¯æ—¥å¿—ï¼šé«˜ä¼˜å…ˆçº§ä¿å­˜
rabbitmqctl set_policy error-persist "^error\." \
  '{"max-length":10000,"delivery-mode":2}'
```

### 5.2 å¾®æœåŠ¡æ¶æ„ç­–ç•¥


**æœåŠ¡é—´é€šä¿¡ç­–ç•¥**ï¼š
```bash
# APIè°ƒç”¨é˜Ÿåˆ—ï¼šå¿«é€Ÿå“åº”
rabbitmqctl set_policy api-fast "^api\." \
  '{"max-length":1000,"overflow":"drop-head"}'

# äº‹ä»¶é€šçŸ¥ï¼šæŒä¹…åŒ–å­˜å‚¨
rabbitmqctl set_policy event-store "^event\." \
  '{"ha-mode":"all","delivery-mode":2}'
```

**ç›‘æ§å‘Šè­¦ç­–ç•¥**ï¼š
```bash
# å‘Šè­¦é˜Ÿåˆ—ï¼šæœ€é«˜ä¼˜å…ˆçº§
rabbitmqctl set_operator_policy alert-priority "^alert\." \
  '{"max-consumers":1}' --priority 100

# æŒ‡æ ‡æ”¶é›†ï¼šæ‰¹é‡å¤„ç†
rabbitmqctl set_policy metrics-batch "^metrics\." \
  '{"max-length":10000,"consumer-timeout":300000}'
```

### 5.3 å¤§æ•°æ®å¤„ç†ç­–ç•¥


**æ•°æ®æµç®¡é“é…ç½®**ï¼š
```bash
# æ•°æ®æ‘„å–ï¼šå¤§å®¹é‡ç¼“å†²
rabbitmqctl set_policy data-ingest "^ingest\." \
  '{"max-length-bytes":1073741824}'

# æ•°æ®å¤„ç†ï¼šå·¥ä½œé˜Ÿåˆ—æ¨¡å¼
rabbitmqctl set_policy data-process "^process\." \
  '{"ha-mode":"exactly","ha-params":2}'
```

---

## 6. â— å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


### 6.1 ç­–ç•¥ä¸ç”Ÿæ•ˆé—®é¢˜


**é—®é¢˜ç°è±¡**ï¼šè®¾ç½®ç­–ç•¥åé˜Ÿåˆ—è¡Œä¸ºæ²¡æœ‰æ”¹å˜

**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ç­–ç•¥æ˜¯å¦æ­£ç¡®è®¾ç½®
rabbitmqctl list_policies

# 2. æ£€æŸ¥é˜Ÿåˆ—åæ˜¯å¦åŒ¹é…æ¨¡å¼
rabbitmqctl list_queues name

# 3. æŸ¥çœ‹é˜Ÿåˆ—è¯¦ç»†ä¿¡æ¯
rabbitmqctl list_queues name policy
```

**å¸¸è§åŸå› ä¸è§£å†³**ï¼š
```
âŒ æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯ï¼š
é”™è¯¯: "order*"  (ç¼ºå°‘é”šç‚¹)
æ­£ç¡®: "^order\."

âŒ JSONæ ¼å¼é”™è¯¯ï¼š
é”™è¯¯: {'ha-mode':'all'}  (å•å¼•å·)
æ­£ç¡®: '{"ha-mode":"all"}'

âŒ é˜Ÿåˆ—å·²å­˜åœ¨ï¼š
è§£å†³: åˆ é™¤é‡å»ºé˜Ÿåˆ—ï¼Œæˆ–é‡å¯æœåŠ¡
```

### 6.2 ä»²è£é˜Ÿåˆ—æˆå‘˜é—®é¢˜


**é—®é¢˜ï¼šæ·»åŠ æˆå‘˜å¤±è´¥**

**è¯Šæ–­å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
rabbitmq-queues quorum_status my-queue

# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
rabbitmqctl cluster_status

# æŸ¥çœ‹èŠ‚ç‚¹å¥åº·çŠ¶æ€
rabbitmqctl node_health_check
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿ç›®æ ‡èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­
rabbitmqctl join_cluster rabbit@target-node

# ç­‰å¾…é›†ç¾¤åŒæ­¥å®Œæˆ
rabbitmqctl await_startup

# é‡è¯•æ·»åŠ æˆå‘˜
rabbitmq-queues add_member my-queue rabbit@target-node
```

### 6.3 ç­–ç•¥å†²çªé—®é¢˜


**é—®é¢˜ï¼šå¤šä¸ªç­–ç•¥åŒ¹é…åŒä¸€é˜Ÿåˆ—**

**æŸ¥çœ‹ç­–ç•¥åº”ç”¨æƒ…å†µ**ï¼š
```bash
# æŸ¥çœ‹ç‰¹å®šé˜Ÿåˆ—çš„ç­–ç•¥åº”ç”¨
rabbitmqctl list_queues name policy effective_policy_definition
```

**è§£å†³ç­–ç•¥å†²çª**ï¼š
```bash
# æ–¹æ³•1ï¼šè°ƒæ•´ç­–ç•¥ä¼˜å…ˆçº§
rabbitmqctl set_policy high-priority "^critical\." \
  '{"ha-mode":"all"}' --priority 10

# æ–¹æ³•2ï¼šä½¿ç”¨æ›´ç²¾ç¡®çš„åŒ¹é…æ¨¡å¼
rabbitmqctl set_policy specific-pattern "^order\.payment\." \
  '{"ha-mode":"exactly","ha-params":3}'
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 ç­–ç•¥ç®¡ç†æ ¸å¿ƒå‘½ä»¤


```bash
# ğŸ”¸ åŸºç¡€ç­–ç•¥æ“ä½œ
rabbitmqctl set_policy {name} {pattern} {definition}    # è®¾ç½®ç­–ç•¥
rabbitmqctl list_policies                             # æŸ¥çœ‹ç­–ç•¥
rabbitmqctl clear_policy {name}                       # åˆ é™¤ç­–ç•¥

# ğŸ”¸ æ“ä½œå‘˜ç­–ç•¥æ“ä½œ  
rabbitmqctl set_operator_policy {name} {pattern} {definition}    # è®¾ç½®æ“ä½œå‘˜ç­–ç•¥
rabbitmqctl list_operator_policies                              # æŸ¥çœ‹æ“ä½œå‘˜ç­–ç•¥
rabbitmqctl clear_operator_policy {name}                        # åˆ é™¤æ“ä½œå‘˜ç­–ç•¥

# ğŸ”¸ ä»²è£é˜Ÿåˆ—æˆå‘˜ç®¡ç†
rabbitmq-queues add_member {queue} {node}             # æ·»åŠ æˆå‘˜
rabbitmq-queues delete_member {queue} {node}          # åˆ é™¤æˆå‘˜
rabbitmq-queues grow {queue} {node}                   # æ‰©å®¹é˜Ÿåˆ—
rabbitmq-queues shrink {queue} {node}                 # ç¼©å®¹é˜Ÿåˆ—
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç­–ç•¥åŒ¹é…æœºåˆ¶**
```
åŒ¹é…è§„åˆ™ï¼š
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é˜Ÿåˆ—å
- ä¼˜å…ˆçº§é«˜çš„ç­–ç•¥è¦†ç›–ä½ä¼˜å…ˆçº§
- æ“ä½œå‘˜ç­–ç•¥ä¼˜å…ˆçº§é«˜äºæ™®é€šç­–ç•¥
- åŒä¼˜å…ˆçº§æŒ‰è®¾ç½®æ—¶é—´æ’åº
```

**ğŸ”¹ ç­–ç•¥ç±»å‹é€‰æ‹©**
```
æ™®é€šç­–ç•¥ï¼š
âœ… ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„é…ç½®
âœ… è™šæ‹Ÿä¸»æœºçº§åˆ«çš„ç®¡ç†
âœ… å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ

æ“ä½œå‘˜ç­–ç•¥ï¼š  
âœ… é›†ç¾¤çº§åˆ«çš„èµ„æºæ§åˆ¶
âœ… å®‰å…¨å’Œæ€§èƒ½é™åˆ¶
âœ… ç”Ÿäº§ç¯å¢ƒçš„å…¨å±€ç­–ç•¥
```

**ğŸ”¹ ä»²è£é˜Ÿåˆ—ä¼˜åŠ¿**
```
ç›¸æ¯”é•œåƒé˜Ÿåˆ—çš„ä¼˜åŠ¿ï¼š
ğŸš€ æ›´å¥½çš„æ€§èƒ½è¡¨ç°
ğŸ›¡ï¸ å¼ºä¸€è‡´æ€§ä¿è¯
ğŸ”„ è‡ªåŠ¨æ•…éšœæ¢å¤
ğŸ“ˆ æ›´å¥½çš„æ‰©å±•æ€§

é€‚ç”¨åœºæ™¯ï¼š
ğŸ’° é‡‘èäº¤æ˜“æ•°æ®
ğŸ“¦ è®¢å•å¤„ç†æµç¨‹
ğŸ” å…³é”®ä¸šåŠ¡æ¶ˆæ¯
```

### 7.3 æœ€ä½³å®è·µå»ºè®®


**ç­–ç•¥å‘½åè§„èŒƒ**ï¼š
```
å»ºè®®å‘½åæ ¼å¼ï¼š
{ä¸šåŠ¡æ¨¡å—}-{ç­–ç•¥ç±»å‹}-{ç¯å¢ƒ}

ç¤ºä¾‹ï¼š
order-ha-prod       # è®¢å•é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒ
log-expire-dev      # æ—¥å¿—è¿‡æœŸå¼€å‘ç¯å¢ƒ
alert-priority-all  # å‘Šè­¦ä¼˜å…ˆçº§å…¨ç¯å¢ƒ
```

**ç­–ç•¥è®¾è®¡åŸåˆ™**ï¼š
```
ğŸ”¸ æœ€å°å½±å“åŸåˆ™ï¼šç­–ç•¥åªé…ç½®å¿…è¦çš„å‚æ•°
ğŸ”¸ ç¯å¢ƒéš”ç¦»åŸåˆ™ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒç­–ç•¥
ğŸ”¸ æ¸è¿›éƒ¨ç½²åŸåˆ™ï¼šå…ˆæµ‹è¯•ç¯å¢ƒéªŒè¯å†ç”Ÿäº§
ğŸ”¸ ç›‘æ§å‘Šè­¦åŸåˆ™ï¼šç­–ç•¥å˜æ›´è¦æœ‰ç›‘æ§è®°å½•
```

**å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š
```
æƒé™æ§åˆ¶ï¼š
- æ™®é€šç”¨æˆ·ï¼šåªèƒ½æŸ¥çœ‹ç­–ç•¥
- ç®¡ç†å‘˜ï¼šå¯ä»¥è®¾ç½®è™šæ‹Ÿä¸»æœºç­–ç•¥  
- è¶…çº§ç®¡ç†å‘˜ï¼šå¯ä»¥è®¾ç½®æ“ä½œå‘˜ç­–ç•¥

å˜æ›´ç®¡ç†ï¼š
- ç­–ç•¥å˜æ›´è¦æœ‰å®¡æ‰¹æµç¨‹
- é‡è¦å˜æ›´è¦æœ‰å›æ»šæ–¹æ¡ˆ
- å®šæœŸå®¡æŸ¥å’Œæ¸…ç†æ— ç”¨ç­–ç•¥
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç­–ç•¥ç®¡ç†æœ‰è§„å¾‹ï¼ŒåŒ¹é…æ¨¡å¼è¦ç²¾å‡†
æ™®é€šç­–ç•¥ç®¡ä¸šåŠ¡ï¼Œæ“ä½œå‘˜ç­–ç•¥æ§å…¨å±€
ä»²è£é˜Ÿåˆ—å¼ºä¸€è‡´ï¼Œæˆå‘˜ç®¡ç†ä¿å¯ç”¨
è®¾ç½®æŸ¥çœ‹åˆ é™¤æ¸…ï¼Œä¼˜å…ˆçº§åˆ«åˆ†ä¸»æ¬¡
```