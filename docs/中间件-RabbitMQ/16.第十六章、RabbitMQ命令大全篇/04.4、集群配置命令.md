---
title: 4ã€é›†ç¾¤é…ç½®å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-é›†ç¾¤ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [é›†ç¾¤èŠ‚ç‚¹æ“ä½œå‘½ä»¤](#2-é›†ç¾¤èŠ‚ç‚¹æ“ä½œå‘½ä»¤)
3. [é›†ç¾¤çŠ¶æ€ç›‘æ§å‘½ä»¤](#3-é›†ç¾¤çŠ¶æ€ç›‘æ§å‘½ä»¤)
4. [é˜Ÿåˆ—åŒæ­¥ç®¡ç†å‘½ä»¤](#4-é˜Ÿåˆ—åŒæ­¥ç®¡ç†å‘½ä»¤)
5. [é›†ç¾¤ç»´æŠ¤å‘½ä»¤](#5-é›†ç¾¤ç»´æŠ¤å‘½ä»¤)
6. [å®é™…åº”ç”¨åœºæ™¯](#6-å®é™…åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ é›†ç¾¤ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQé›†ç¾¤


**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä¸€ä¸ªå¿«é€’å…¬å¸ï¼ŒåŸæ¥åªæœ‰ä¸€ä¸ªåˆ†æ‹£ä¸­å¿ƒå¤„ç†æ‰€æœ‰åŒ…è£¹ã€‚ä½†éšç€ä¸šåŠ¡å¢é•¿ï¼Œä¸€ä¸ªåˆ†æ‹£ä¸­å¿ƒå¿™ä¸è¿‡æ¥äº†ï¼Œå°±éœ€è¦å»ºè®¾å¤šä¸ªåˆ†æ‹£ä¸­å¿ƒï¼Œå®ƒä»¬ä¹‹é—´ååŒå·¥ä½œã€‚RabbitMQé›†ç¾¤å°±æ˜¯è¿™æ ·çš„æ¦‚å¿µã€‚

```
å•ä¸ªRabbitMQèŠ‚ç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQ   â”‚ â† æ‰€æœ‰æ¶ˆæ¯éƒ½åœ¨è¿™é‡Œå¤„ç†
â”‚   æœåŠ¡å™¨    â”‚   é£é™©ï¼šå•ç‚¹æ•…éšœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RabbitMQé›†ç¾¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹1      â”‚  â”‚   èŠ‚ç‚¹2     â”‚  â”‚   èŠ‚ç‚¹3     â”‚
â”‚  (ä¸»èŠ‚ç‚¹)   â”‚â†â†’â”‚  (ä»èŠ‚ç‚¹)   â”‚â†â†’â”‚  (ä»èŠ‚ç‚¹)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                â†‘                â†‘
   å…±äº«å…ƒæ•°æ®      åˆ†æ‹…è´Ÿè½½        é«˜å¯ç”¨ä¿éšœ
```

### 1.2 é›†ç¾¤çš„æ ¸å¿ƒå¥½å¤„


**ğŸ¯ ä¸ºä»€ä¹ˆè¦ç”¨é›†ç¾¤**
- **é«˜å¯ç”¨æ€§**ï¼šä¸€å°æœåŠ¡å™¨æŒ‚äº†ï¼Œå…¶ä»–æœåŠ¡å™¨ç»§ç»­å·¥ä½œ
- **è´Ÿè½½åˆ†æ‹…**ï¼šå¤šå°æœåŠ¡å™¨åˆ†æ‹…æ¶ˆæ¯å¤„ç†å‹åŠ›  
- **æ¨ªå‘æ‰©å±•**ï¼šä¸šåŠ¡å¢é•¿æ—¶å¯ä»¥æ·»åŠ æ›´å¤šæœåŠ¡å™¨
- **æ•°æ®å¤‡ä»½**ï¼šæ¶ˆæ¯åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šæœ‰å¤‡ä»½

### 1.3 èŠ‚ç‚¹ç±»å‹ç†è§£


**ğŸ“‹ èŠ‚ç‚¹ç±»å‹è¯´æ˜**
```
ç£ç›˜èŠ‚ç‚¹ï¼ˆDisk Nodeï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®Œæ•´å­˜å‚¨æ•°æ®   â”‚ â† é˜Ÿåˆ—ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯éƒ½ä¿å­˜åœ¨ç£ç›˜
â”‚   å¯ä»¥ç‹¬ç«‹è¿è¡Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å†…å­˜èŠ‚ç‚¹ï¼ˆRAM Nodeï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å†…å­˜å­˜å‚¨æ•°æ®   â”‚ â† æ•°æ®ä¸»è¦åœ¨å†…å­˜ï¼Œæ€§èƒ½æ›´å¿«
â”‚   ä¾èµ–ç£ç›˜èŠ‚ç‚¹   â”‚ â† å¿…é¡»æœ‰ç£ç›˜èŠ‚ç‚¹æ‰èƒ½å·¥ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ” é€šä¿—è§£é‡Š**
- **ç£ç›˜èŠ‚ç‚¹**ï¼šåƒå›¾ä¹¦é¦†ï¼Œæ‰€æœ‰ä¹¦ç±ä¿¡æ¯éƒ½å®Œæ•´ä¿å­˜ï¼Œå³ä½¿åœç”µé‡å¯ä¹Ÿä¸ä¼šä¸¢å¤±
- **å†…å­˜èŠ‚ç‚¹**ï¼šåƒå¿«é€ŸæŸ¥è¯¢å°ï¼Œè®°ä½å¸¸ç”¨ä¿¡æ¯åœ¨å†…å­˜é‡Œï¼ŒæŸ¥è¯¢å¾ˆå¿«ä½†ä¾èµ–å›¾ä¹¦é¦†çš„å®Œæ•´è®°å½•

---

## 2. ğŸ”§ é›†ç¾¤èŠ‚ç‚¹æ“ä½œå‘½ä»¤


### 2.1 åŠ å…¥é›†ç¾¤å‘½ä»¤


**`rabbitmqctl join_cluster {cluster_node}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
è®©å½“å‰RabbitMQèŠ‚ç‚¹åŠ å…¥åˆ°æŒ‡å®šçš„é›†ç¾¤ä¸­ï¼Œå°±åƒè®©ä¸€ä¸ªæ–°å‘˜å·¥åŠ å…¥ç°æœ‰çš„å·¥ä½œå›¢é˜Ÿã€‚

**ğŸ’¡ ä½¿ç”¨æ–¹æ³•**
```bash
# åŸºæœ¬è¯­æ³•
rabbitmqctl join_cluster rabbit@èŠ‚ç‚¹å

# å®é™…ç¤ºä¾‹
rabbitmqctl join_cluster rabbit@server1
rabbitmqctl join_cluster --ram rabbit@server1  # ä»¥å†…å­˜èŠ‚ç‚¹èº«ä»½åŠ å…¥
```

**ğŸ“ è¯¦ç»†æ­¥éª¤**
```
æ­¥éª¤æ¼”ç¤ºï¼šå‡è®¾è¦è®©server2åŠ å…¥server1çš„é›†ç¾¤

1ï¸âƒ£ åœ¨server2ä¸Šåœæ­¢åº”ç”¨
rabbitmqctl stop_app

2ï¸âƒ£ é‡ç½®èŠ‚ç‚¹çŠ¶æ€ï¼ˆæ¸…ç©ºä¹‹å‰çš„æ•°æ®ï¼‰
rabbitmqctl reset

3ï¸âƒ£ åŠ å…¥é›†ç¾¤
rabbitmqctl join_cluster rabbit@server1

4ï¸âƒ£ å¯åŠ¨åº”ç”¨
rabbitmqctl start_app
```

**âš ï¸ é‡è¦æé†’**
- åŠ å…¥é›†ç¾¤å‰å¿…é¡»å…ˆåœæ­¢åº”ç”¨ï¼ˆ`stop_app`ï¼‰
- å»ºè®®å…ˆé‡ç½®èŠ‚ç‚¹ï¼ˆ`reset`ï¼‰é¿å…å†²çª
- ç¡®ä¿å„èŠ‚ç‚¹é—´ç½‘ç»œäº’é€š
- èŠ‚ç‚¹åç§°å¿…é¡»èƒ½å¤Ÿç›¸äº’è§£æ

### 2.2 æ›´æ”¹èŠ‚ç‚¹ç±»å‹å‘½ä»¤


**`rabbitmqctl change_cluster_node_type {type}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
æ”¹å˜å½“å‰èŠ‚ç‚¹åœ¨é›†ç¾¤ä¸­çš„è§’è‰²ç±»å‹ï¼Œå°±åƒå‘˜å·¥åœ¨å…¬å¸é‡Œæ¢å²—ä½ã€‚

```bash
# æ”¹ä¸ºç£ç›˜èŠ‚ç‚¹
rabbitmqctl change_cluster_node_type disc

# æ”¹ä¸ºå†…å­˜èŠ‚ç‚¹  
rabbitmqctl change_cluster_node_type ram
```

**ğŸ”„ æ“ä½œæ­¥éª¤**
```
å®Œæ•´æ“ä½œæµç¨‹ï¼š

1ï¸âƒ£ åœæ­¢åº”ç”¨
rabbitmqctl stop_app

2ï¸âƒ£ æ›´æ”¹èŠ‚ç‚¹ç±»å‹
rabbitmqctl change_cluster_node_type disc

3ï¸âƒ£ å¯åŠ¨åº”ç”¨
rabbitmqctl start_app
```

**ğŸ¯ ä½¿ç”¨åœºæ™¯**
- **å‡çº§ä¸ºç£ç›˜èŠ‚ç‚¹**ï¼šå½“é›†ç¾¤éœ€è¦æ›´å¤šæŒä¹…åŒ–å­˜å‚¨æ—¶
- **é™çº§ä¸ºå†…å­˜èŠ‚ç‚¹**ï¼šå½“éœ€è¦æé«˜æ€§èƒ½ä¸”å·²æœ‰è¶³å¤Ÿç£ç›˜èŠ‚ç‚¹æ—¶

### 2.3 æ›´æ–°é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯


**`rabbitmqctl update_cluster_nodes {nodes}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
æ›´æ–°å½“å‰èŠ‚ç‚¹è®°å½•çš„é›†ç¾¤æˆå‘˜ä¿¡æ¯ï¼Œç±»ä¼¼æ›´æ–°é€šè®¯å½•ä¸­çš„è”ç³»äººåˆ—è¡¨ã€‚

```bash
# æ›´æ–°é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨
rabbitmqctl update_cluster_nodes rabbit@server1

# æ›´æ–°å¤šä¸ªèŠ‚ç‚¹
rabbitmqctl update_cluster_nodes rabbit@server1,rabbit@server3
```

**ğŸ’¡ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨**
- é›†ç¾¤ä¸­æŸäº›èŠ‚ç‚¹çš„ç½‘ç»œåœ°å€å‘ç”Ÿå˜åŒ–
- èŠ‚ç‚¹é‡æ–°éƒ¨ç½²åéœ€è¦æ›´æ–°å¼•ç”¨
- ç½‘ç»œåˆ†åŒºæ¢å¤ååŒæ­¥èŠ‚ç‚¹ä¿¡æ¯

---

## 3. ğŸ“Š é›†ç¾¤çŠ¶æ€ç›‘æ§å‘½ä»¤


### 3.1 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€


**`rabbitmqctl cluster_status`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
æ˜¾ç¤ºå½“å‰é›†ç¾¤çš„å®Œæ•´çŠ¶æ€ä¿¡æ¯ï¼Œå°±åƒæŸ¥çœ‹å›¢é˜Ÿæˆå‘˜çš„å·¥ä½œçŠ¶æ€æŠ¥å‘Šã€‚

```bash
rabbitmqctl cluster_status
```

**ğŸ“‹ è¾“å‡ºä¿¡æ¯è§£è¯»**
```
Cluster status of node rabbit@server1 ...
Basics
Cluster name: rabbit@server1          â† é›†ç¾¤åç§°

Disk Nodes                           â† ç£ç›˜èŠ‚ç‚¹åˆ—è¡¨
rabbit@server1
rabbit@server2

RAM Nodes                            â† å†…å­˜èŠ‚ç‚¹åˆ—è¡¨  
rabbit@server3

Running Nodes                        â† æ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹
rabbit@server1
rabbit@server2
rabbit@server3

Versions                             â† å„èŠ‚ç‚¹RabbitMQç‰ˆæœ¬
rabbit@server1: RabbitMQ 3.8.0
rabbit@server2: RabbitMQ 3.8.0
rabbit@server3: RabbitMQ 3.8.0

Alarms                               â† å‘Šè­¦ä¿¡æ¯
(none)

Network Partitions                   â† ç½‘ç»œåˆ†åŒºä¿¡æ¯
(none)
```

**ğŸ” å…³é”®ä¿¡æ¯è§£é‡Š**
- **Running Nodes**ï¼šå½“å‰æ­£å¸¸å·¥ä½œçš„èŠ‚ç‚¹
- **Network Partitions**ï¼šç½‘ç»œåˆ†åŒºé—®é¢˜ï¼ˆè¿™ä¸ªå¾ˆé‡è¦ï¼ï¼‰
- **Alarms**ï¼šç³»ç»Ÿå‘Šè­¦ï¼Œå¦‚å†…å­˜ä¸è¶³ã€ç£ç›˜ç©ºé—´ä¸å¤Ÿç­‰

### 3.2 è®¾ç½®é›†ç¾¤åç§°


**`rabbitmqctl set_cluster_name {name}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
ä¸ºé›†ç¾¤è®¾ç½®ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿è¯†åˆ«å’Œç®¡ç†ã€‚

```bash
# è®¾ç½®é›†ç¾¤åç§°
rabbitmqctl set_cluster_name production-cluster

# è®¾ç½®å¼€å‘ç¯å¢ƒé›†ç¾¤å
rabbitmqctl set_cluster_name dev-rabbitmq-cluster
```

**ğŸ’¡ å‘½åå»ºè®®**
- ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼š`production-cluster`ã€`test-env`
- é¿å…ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿ç”¨å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦
- åæ˜ ç¯å¢ƒå’Œç”¨é€”ï¼š`order-service-cluster`

---

## 4. ğŸ”„ é˜Ÿåˆ—åŒæ­¥ç®¡ç†å‘½ä»¤


### 4.1 é˜Ÿåˆ—åŒæ­¥æ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯é˜Ÿåˆ—åŒæ­¥**
æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†æœ‰å¤šä¸ªåˆ†é¦†ï¼Œæ¯ä¸ªåˆ†é¦†éƒ½åº”è¯¥æœ‰ç›¸åŒçš„å›¾ä¹¦ç›®å½•ã€‚é˜Ÿåˆ—åŒæ­¥å°±æ˜¯ç¡®ä¿é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹å¯¹é˜Ÿåˆ—ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚

```
åŒæ­¥å‰ï¼šä¸åŒèŠ‚ç‚¹ä¸Šçš„é˜Ÿåˆ—çŠ¶æ€å¯èƒ½ä¸ä¸€è‡´
èŠ‚ç‚¹1: é˜Ÿåˆ—A [æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3]
èŠ‚ç‚¹2: é˜Ÿåˆ—A [æ¶ˆæ¯1, æ¶ˆæ¯2]        â† ç¼ºå°‘æ¶ˆæ¯3
èŠ‚ç‚¹3: é˜Ÿåˆ—A [æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3, æ¶ˆæ¯4] â† å¤šäº†æ¶ˆæ¯4

åŒæ­¥åï¼šæ‰€æœ‰èŠ‚ç‚¹ä¿æŒä¸€è‡´
èŠ‚ç‚¹1: é˜Ÿåˆ—A [æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3, æ¶ˆæ¯4]
èŠ‚ç‚¹2: é˜Ÿåˆ—A [æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3, æ¶ˆæ¯4]  
èŠ‚ç‚¹3: é˜Ÿåˆ—A [æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3, æ¶ˆæ¯4]
```

### 4.2 åŒæ­¥é˜Ÿåˆ—å‘½ä»¤


**`rabbitmqctl sync_queue {queue}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
æ‰‹åŠ¨è§¦å‘æŒ‡å®šé˜Ÿåˆ—åœ¨é›†ç¾¤ä¸­çš„åŒæ­¥æ“ä½œã€‚

```bash
# åŒæ­¥å•ä¸ªé˜Ÿåˆ—
rabbitmqctl sync_queue order_queue

# åŒæ­¥å¤šä¸ªé˜Ÿåˆ—ï¼ˆéœ€è¦åˆ†åˆ«æ‰§è¡Œï¼‰
rabbitmqctl sync_queue user_queue
rabbitmqctl sync_queue payment_queue
```

**ğŸ“‹ åŒæ­¥è¿‡ç¨‹è¯´æ˜**
```
åŒæ­¥è¿‡ç¨‹ï¼š

1ï¸âƒ£ ç¡®å®šä¸»èŠ‚ç‚¹
é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ•°æ®æº

2ï¸âƒ£ å¤åˆ¶æ•°æ®  
å°†ä¸»èŠ‚ç‚¹çš„é˜Ÿåˆ—æ•°æ®å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹

3ï¸âƒ£ éªŒè¯ä¸€è‡´æ€§
ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®å®Œå…¨ä¸€è‡´

4ï¸âƒ£ å®ŒæˆåŒæ­¥
é˜Ÿåˆ—åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šä¿æŒåŒæ­¥çŠ¶æ€
```

### 4.3 å–æ¶ˆé˜Ÿåˆ—åŒæ­¥


**`rabbitmqctl cancel_sync_queue {queue}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„é˜Ÿåˆ—åŒæ­¥æ“ä½œï¼Œç”¨äºè§£å†³åŒæ­¥å¡ä½æˆ–æ€§èƒ½é—®é¢˜ã€‚

```bash
# å–æ¶ˆé˜Ÿåˆ—åŒæ­¥
rabbitmqctl cancel_sync_queue order_queue
```

**âš ï¸ ä½¿ç”¨æ³¨æ„**
- åªåœ¨åŒæ­¥è¿‡ç¨‹å‡ºç°é—®é¢˜æ—¶ä½¿ç”¨
- å–æ¶ˆåé˜Ÿåˆ—å¯èƒ½åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šä¸ä¸€è‡´
- å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸé‡æ–°åŒæ­¥

---

## 5. ğŸ› ï¸ é›†ç¾¤ç»´æŠ¤å‘½ä»¤


### 5.1 å¼ºåˆ¶å¯åŠ¨é›†ç¾¤


**`rabbitmqctl force_boot`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
åœ¨é›†ç¾¤å‡ºç°é—®é¢˜æ—¶å¼ºåˆ¶å¯åŠ¨èŠ‚ç‚¹ï¼Œç±»ä¼¼ç´§æ€¥æƒ…å†µä¸‹çš„åº”æ€¥å¯åŠ¨ã€‚

```bash
rabbitmqctl force_boot
```

**ğŸš¨ ä½¿ç”¨åœºæ™¯**
```
ç´§æ€¥æƒ…å†µï¼š
- é›†ç¾¤ä¸­å¤§éƒ¨åˆ†èŠ‚ç‚¹éƒ½å®•æœºäº†
- æ­£å¸¸å¯åŠ¨å¤±è´¥ï¼Œéœ€è¦ç´§æ€¥æ¢å¤æœåŠ¡
- ç½‘ç»œåˆ†åŒºå¯¼è‡´æ— æ³•æ­£å¸¸å¯åŠ¨

è­¦å‘Šï¼š
âš ï¸ å¼ºåˆ¶å¯åŠ¨å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
âš ï¸ åªåœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨
âš ï¸ ä½¿ç”¨åéœ€è¦æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
```

### 5.2 ç§»é™¤é›†ç¾¤èŠ‚ç‚¹


**`rabbitmqctl forget_cluster_node {node}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
ä»é›†ç¾¤ä¸­æ°¸ä¹…ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç±»ä¼¼ä»å›¢é˜Ÿä¸­ç§»é™¤ä¸€ä¸ªæˆå‘˜ã€‚

```bash
# ç§»é™¤æŒ‡å®šèŠ‚ç‚¹
rabbitmqctl forget_cluster_node rabbit@server3
```

**ğŸ“ ç§»é™¤æ­¥éª¤**
```
å®‰å…¨ç§»é™¤èŠ‚ç‚¹æµç¨‹ï¼š

1ï¸âƒ£ åœ¨è¦ç§»é™¤çš„èŠ‚ç‚¹ä¸Šåœæ­¢åº”ç”¨
rabbitmqctl -n rabbit@server3 stop_app

2ï¸âƒ£ åœ¨å…¶ä»–æ­£å¸¸èŠ‚ç‚¹ä¸Šæ‰§è¡Œç§»é™¤
rabbitmqctl forget_cluster_node rabbit@server3

3ï¸âƒ£ ç¡®è®¤ç§»é™¤æˆåŠŸ
rabbitmqctl cluster_status
```

### 5.3 é‡å‘½åé›†ç¾¤èŠ‚ç‚¹


**`rabbitmqctl rename_cluster_node {old} {new}`**

**ğŸ”¸ å‘½ä»¤ä½œç”¨**
ä¿®æ”¹é›†ç¾¤ä¸­èŠ‚ç‚¹çš„åç§°ï¼Œé€šå¸¸ç”¨äºæœåŠ¡å™¨è¿ç§»æˆ–é‡å‘½åã€‚

```bash
# é‡å‘½åèŠ‚ç‚¹
rabbitmqctl rename_cluster_node rabbit@old-server rabbit@new-server
```

**ğŸ”„ é‡å‘½ååœºæ™¯**
- æœåŠ¡å™¨ä¸»æœºåå‘ç”Ÿå˜åŒ–
- è¿ç§»åˆ°æ–°çš„æœåŠ¡å™¨
- ç»Ÿä¸€å‘½åè§„èŒƒ

---

## 6. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 6.1 åœºæ™¯ä¸€ï¼šæ­å»ºæ–°é›†ç¾¤


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯**
å…¬å¸è¦éƒ¨ç½²RabbitMQé›†ç¾¤ï¼Œéœ€è¦3å°æœåŠ¡å™¨ååŒå·¥ä½œã€‚

**ğŸ”§ æ“ä½œæ­¥éª¤**
```bash
# åœ¨server1ä¸Šï¼ˆä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸éœ€è¦ç‰¹æ®Šæ“ä½œï¼‰
# server1ä½œä¸ºé›†ç¾¤çš„èµ·å§‹èŠ‚ç‚¹

# åœ¨server2ä¸ŠåŠ å…¥é›†ç¾¤
rabbitmqctl stop_app
rabbitmqctl reset  
rabbitmqctl join_cluster rabbit@server1
rabbitmqctl start_app

# åœ¨server3ä¸ŠåŠ å…¥é›†ç¾¤ï¼ˆä½œä¸ºå†…å­˜èŠ‚ç‚¹æå‡æ€§èƒ½ï¼‰
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl join_cluster --ram rabbit@server1  
rabbitmqctl start_app

# éªŒè¯é›†ç¾¤çŠ¶æ€
rabbitmqctl cluster_status
```

### 6.2 åœºæ™¯äºŒï¼šèŠ‚ç‚¹æ•…éšœæ¢å¤


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯**
é›†ç¾¤ä¸­çš„server2èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œéœ€è¦é‡æ–°åŠ å…¥é›†ç¾¤ã€‚

```bash
# 1. ç§»é™¤æ•…éšœèŠ‚ç‚¹ï¼ˆåœ¨æ­£å¸¸èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼‰
rabbitmqctl forget_cluster_node rabbit@server2

# 2. ä¿®å¤server2åé‡æ–°åŠ å…¥
# åœ¨server2ä¸Šæ‰§è¡Œ
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl join_cluster rabbit@server1
rabbitmqctl start_app
```

### 6.3 åœºæ™¯ä¸‰ï¼šé˜Ÿåˆ—æ•°æ®åŒæ­¥


**ğŸ’¼ ä¸šåŠ¡åœºæ™¯**
å‘ç°è®¢å•é˜Ÿåˆ—åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šæ•°æ®ä¸ä¸€è‡´ï¼Œéœ€è¦åŒæ­¥ã€‚

```bash
# æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€
rabbitmqctl list_queues name messages

# åŒæ­¥è®¢å•é˜Ÿåˆ—
rabbitmqctl sync_queue order_queue

# éªŒè¯åŒæ­¥ç»“æœ
rabbitmqctl cluster_status
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å‘½ä»¤åˆ†ç±»æ€»è§ˆ


| å‘½ä»¤ç±»å‹ | **ä¸»è¦å‘½ä»¤** | **æ ¸å¿ƒä½œç”¨** |
|---------|-------------|-------------|
| ğŸ”— **é›†ç¾¤åŠ å…¥** | `join_cluster` | å°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ |
| ğŸ“Š **çŠ¶æ€æŸ¥çœ‹** | `cluster_status` | æŸ¥çœ‹é›†ç¾¤è¿è¡ŒçŠ¶æ€ |
| ğŸ”„ **èŠ‚ç‚¹ç®¡ç†** | `change_cluster_node_type` | å˜æ›´èŠ‚ç‚¹ç±»å‹ |
| ğŸ”„ **é˜Ÿåˆ—åŒæ­¥** | `sync_queue` | åŒæ­¥é˜Ÿåˆ—æ•°æ® |
| ğŸ› ï¸ **ç»´æŠ¤æ“ä½œ** | `forget_cluster_node` | ç§»é™¤é—®é¢˜èŠ‚ç‚¹ |

### 7.2 å…³é”®æ“ä½œè¦ç‚¹


**ğŸ”¸ é›†ç¾¤æ“ä½œä¸‰æ­¥éª¤**
```
æ ‡å‡†æ“ä½œæµç¨‹ï¼š
1ï¸âƒ£ stop_app    - åœæ­¢åº”ç”¨
2ï¸âƒ£ æ‰§è¡Œå‘½ä»¤      - è¿›è¡Œé›†ç¾¤æ“ä½œ  
3ï¸âƒ£ start_app   - å¯åŠ¨åº”ç”¨
```

**ğŸ”¸ èŠ‚ç‚¹ç±»å‹é€‰æ‹©**
- **ç£ç›˜èŠ‚ç‚¹**ï¼šé€‚åˆæ•°æ®æŒä¹…åŒ–ï¼Œé›†ç¾¤è‡³å°‘éœ€è¦ä¸€ä¸ª
- **å†…å­˜èŠ‚ç‚¹**ï¼šé€‚åˆé«˜æ€§èƒ½åœºæ™¯ï¼Œä½†å¿…é¡»ä¾èµ–ç£ç›˜èŠ‚ç‚¹

**ğŸ”¸ å®‰å…¨æ“ä½œå»ºè®®**
- æ“ä½œå‰å…ˆå¤‡ä»½é‡è¦æ•°æ®
- åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œé›†ç¾¤ç»´æŠ¤
- é€ä¸ªèŠ‚ç‚¹æ“ä½œï¼Œé¿å…å…¨éƒ¨èŠ‚ç‚¹åŒæ—¶æ“ä½œ
- æ“ä½œåéªŒè¯é›†ç¾¤çŠ¶æ€å’Œæ•°æ®å®Œæ•´æ€§

### 7.3 å¸¸è§é—®é¢˜è§£å†³


**â“ èŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤**
```
å¯èƒ½åŸå› ï¼š
- ç½‘ç»œä¸é€šï¼šæ£€æŸ¥é˜²ç«å¢™å’Œç½‘ç»œè¿æ¥
- è®¤è¯é—®é¢˜ï¼šç¡®ä¿erlang cookieä¸€è‡´
- èŠ‚ç‚¹åè§£æï¼šæ£€æŸ¥hostsæ–‡ä»¶æˆ–DNSé…ç½®

è§£å†³æ–¹æ³•ï¼š
1. pingæµ‹è¯•ç½‘ç»œè¿é€šæ€§
2. æ£€æŸ¥/var/lib/rabbitmq/.erlang.cookieæ–‡ä»¶
3. ç¡®è®¤èŠ‚ç‚¹åç§°èƒ½å¤Ÿæ­£ç¡®è§£æ
```

**â“ é›†ç¾¤çŠ¶æ€å¼‚å¸¸**
```
æ£€æŸ¥æ­¥éª¤ï¼š
1. rabbitmqctl cluster_status æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ /var/log/rabbitmq/
3. éªŒè¯æ‰€æœ‰èŠ‚ç‚¹çš„æœåŠ¡çŠ¶æ€
4. å¿…è¦æ—¶é‡å¯æœ‰é—®é¢˜çš„èŠ‚ç‚¹
```

### 7.4 æœ€ä½³å®è·µå»ºè®®


**âœ¨ é›†ç¾¤è§„åˆ’**
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼ˆ3ä¸ªæˆ–5ä¸ªï¼‰
- è‡³å°‘ä¿è¯2ä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œé¿å…å•ç‚¹æ•…éšœ
- è€ƒè™‘ç½‘ç»œå»¶è¿Ÿï¼ŒèŠ‚ç‚¹é—´å»¶è¿Ÿåº”ä½äº20ms

**âœ¨ ç›‘æ§ç»´æŠ¤**
- å®šæœŸæ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ˆ`cluster_status`ï¼‰
- ç›‘æ§èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ
- è®¾ç½®å‘Šè­¦æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- å®šæœŸå¤‡ä»½é‡è¦é˜Ÿåˆ—æ•°æ®

**æ ¸å¿ƒè®°å¿†**ï¼š
- é›†ç¾¤æ“ä½œå¿…é¡»å…ˆåœåº”ç”¨å†æ“ä½œ
- è‡³å°‘ä¿è¯ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å­˜å‚¨æ•°æ®
- ç½‘ç»œåˆ†åŒºæ˜¯é›†ç¾¤æœ€å¤§çš„é£é™©
- å®šæœŸç›‘æ§çŠ¶æ€ä¿éšœé›†ç¾¤å¥åº·