---
title: 1ã€RabbitMQæœåŠ¡æ§åˆ¶å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [RabbitMQåŸºç¡€æ¦‚å¿µ](#1-RabbitMQåŸºç¡€æ¦‚å¿µ)
2. [æœåŠ¡ç®¡ç†å‘½ä»¤è¯¦è§£](#2-æœåŠ¡ç®¡ç†å‘½ä»¤è¯¦è§£)
3. [ç”¨æˆ·æƒé™ç®¡ç†](#3-ç”¨æˆ·æƒé™ç®¡ç†)
4. [è™šæ‹Ÿä¸»æœºæ“ä½œ](#4-è™šæ‹Ÿä¸»æœºæ“ä½œ)
5. [é˜Ÿåˆ—äº¤æ¢æœºç®¡ç†](#5-é˜Ÿåˆ—äº¤æ¢æœºç®¡ç†)
6. [ç›‘æ§è¯Šæ–­å‘½ä»¤](#6-ç›‘æ§è¯Šæ–­å‘½ä»¤)
7. [å®æˆ˜æ“ä½œæµç¨‹](#7-å®æˆ˜æ“ä½œæµç¨‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ° RabbitMQåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQ


**ğŸ”¸ é€šä¿—ç†è§£**

æŠŠRabbitMQæƒ³è±¡æˆä¸€ä¸ª**é‚®å±€ç³»ç»Ÿ**ï¼š
- **ç”Ÿäº§è€…** = å¯„ä¿¡äººï¼ˆå‘é€æ¶ˆæ¯çš„ç¨‹åºï¼‰
- **æ¶ˆè´¹è€…** = æ”¶ä¿¡äººï¼ˆæ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºï¼‰
- **é˜Ÿåˆ—** = é‚®ç®±ï¼ˆæš‚å­˜æ¶ˆæ¯çš„åœ°æ–¹ï¼‰
- **äº¤æ¢æœº** = é‚®å±€åˆ†æ‹£å‘˜ï¼ˆå†³å®šæ¶ˆæ¯é€åˆ°å“ªä¸ªé‚®ç®±ï¼‰

```
æ¶ˆæ¯æµè½¬è¿‡ç¨‹ç¤ºæ„å›¾ï¼š

ç”Ÿäº§è€… â”€â”€å‘é€æ¶ˆæ¯â”€â”€> äº¤æ¢æœº â”€â”€è·¯ç”±è§„åˆ™â”€â”€> é˜Ÿåˆ— â”€â”€æ¶ˆè´¹è€…è·å–â”€â”€> æ¶ˆè´¹è€…
 ğŸ“¤                   ğŸ“®              ğŸ“«                    ğŸ“¥
å‘ä»¶äºº               é‚®å±€åˆ†æ‹£         é‚®ç®±                  æ”¶ä»¶äºº
```

**ğŸ’¡ æ ¸å¿ƒä½œç”¨**

| **åœºæ™¯** | **é—®é¢˜** | **RabbitMQè§£å†³æ–¹æ¡ˆ** |
|---------|---------|---------------------|
| **ç³»ç»Ÿè§£è€¦** | `Aç³»ç»Ÿç›´æ¥è°ƒç”¨Bç³»ç»Ÿï¼Œä¸€æ—¦BæŒ‚äº†Aä¹Ÿå—å½±å“` | `Aå‘æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼ŒBä»é˜Ÿåˆ—å–ï¼Œäº’ä¸å½±å“` |
| **æµé‡å‰Šå³°** | `åŒ11ç¬é—´å¤§é‡è®¢å•å†²å®ç³»ç»Ÿ` | `è®¢å•å…ˆè¿›é˜Ÿåˆ—æ…¢æ…¢å¤„ç†ï¼Œç³»ç»Ÿä¸å´©æºƒ` |
| **å¼‚æ­¥å¤„ç†** | `ç”¨æˆ·æ³¨å†Œéœ€è¦å‘é‚®ä»¶ã€çŸ­ä¿¡ï¼Œç”¨æˆ·ç­‰å¾ˆä¹…` | `æ³¨å†ŒæˆåŠŸç«‹å³è¿”å›ï¼Œé‚®ä»¶çŸ­ä¿¡åå°æ…¢æ…¢å‘` |

### 1.2 RabbitMQæ ¸å¿ƒç»„ä»¶


**ğŸ—ï¸ æ¶æ„ç»„æˆå›¾**

```
RabbitMQå†…éƒ¨ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RabbitMQ Broker                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Virtual Host  â”‚    Exchange     â”‚       Queue         â”‚
â”‚     (vhost)     â”‚   (äº¤æ¢æœº)       â”‚      (é˜Ÿåˆ—)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ é€»è¾‘éš”ç¦»ç©ºé—´    â”‚â€¢ Directç›´è¿      â”‚â€¢ å­˜å‚¨æ¶ˆæ¯            â”‚
â”‚â€¢ ç±»ä¼¼å‘½åç©ºé—´    â”‚â€¢ Topicä¸»é¢˜       â”‚â€¢ FIFOå…ˆè¿›å…ˆå‡º        â”‚
â”‚â€¢ æƒé™ç®¡ç†å•ä½    â”‚â€¢ Fanoutå¹¿æ’­      â”‚â€¢ æŒä¹…åŒ–å¯é€‰          â”‚
â”‚â€¢ é»˜è®¤ä¸º /       â”‚â€¢ Headerså¤´éƒ¨     â”‚â€¢ æ¶ˆè´¹è€…ç«äº‰è·å–       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”§ ç»„ä»¶è¯¦è§£**

- **Broker**ï¼šå°±æ˜¯RabbitMQæœåŠ¡å™¨æœ¬èº«ï¼Œç±»ä¼¼ä¸€ä¸ªé‚®å±€æ€»éƒ¨
- **Virtual Host**ï¼šè™šæ‹Ÿä¸»æœºï¼Œåƒé‚®å±€çš„ä¸åŒåˆ†éƒ¨ï¼Œå¯ä»¥éš”ç¦»ä¸åŒé¡¹ç›®
- **Exchange**ï¼šäº¤æ¢æœºï¼Œåƒæ™ºèƒ½åˆ†æ‹£å‘˜ï¼Œæ ¹æ®è§„åˆ™æŠŠæ¶ˆæ¯é€åˆ°å¯¹åº”é˜Ÿåˆ—
- **Queue**ï¼šé˜Ÿåˆ—ï¼Œåƒå„ä¸ªé‚®ç®±ï¼Œå®é™…å­˜æ”¾æ¶ˆæ¯çš„åœ°æ–¹
- **Binding**ï¼šç»‘å®šå…³ç³»ï¼Œå‘Šè¯‰äº¤æ¢æœºè¿™ä¸ªæ¶ˆæ¯åº”è¯¥é€åˆ°å“ªä¸ªé˜Ÿåˆ—

---

## 2. âš™ï¸ æœåŠ¡ç®¡ç†å‘½ä»¤è¯¦è§£


### 2.1 å¯åŠ¨åœæ­¢æœåŠ¡


**ğŸš€ åŸºæœ¬æœåŠ¡æ§åˆ¶**

> **ä¸ºä»€ä¹ˆè¦å­¦è¿™äº›å‘½ä»¤ï¼Ÿ**  
> å°±åƒå¼€è½¦è¦ä¼šå¯åŠ¨ç†„ç«ä¸€æ ·ï¼Œç®¡ç†RabbitMQé¦–å…ˆè¦ä¼šå¯åŠ¨å’Œåœæ­¢æœåŠ¡ã€‚è¿™æ˜¯æœ€åŸºç¡€ä½†æœ€é‡è¦çš„æ“ä½œã€‚

```bash
# 1. å¯åŠ¨æœåŠ¡ï¼ˆç”Ÿäº§ç¯å¢ƒå¸¸ç”¨ï¼‰
systemctl start rabbitmq-server

# 2. åœæ­¢æœåŠ¡
systemctl stop rabbitmq-server

# 3. é‡å¯æœåŠ¡ï¼ˆé…ç½®ä¿®æ”¹åå¸¸ç”¨ï¼‰
systemctl restart rabbitmq-server

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼ˆæ’æŸ¥é—®é¢˜å¿…ç”¨ï¼‰
systemctl status rabbitmq-server
```

**ğŸ” å‘½ä»¤è§£æå¯¹æ¯”**

| **å‘½ä»¤** | **é€‚ç”¨åœºæ™¯** | **æ‰§è¡Œæ•ˆæœ** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| `systemctl start` | `æœåŠ¡å™¨é‡å¯åå¯åŠ¨` | `åå°å¯åŠ¨ï¼Œä¸å ç”¨ç»ˆç«¯` | `éœ€è¦rootæƒé™` |
| `rabbitmq-server` | `å¼€å‘è°ƒè¯•æ—¶` | `å‰å°å¯åŠ¨ï¼Œçœ‹åˆ°è¯¦ç»†æ—¥å¿—` | `å…³é—­ç»ˆç«¯æœåŠ¡å°±åœ` |
| `rabbitmq-server -detached` | `æ‰‹åŠ¨åå°å¯åŠ¨` | `åå°å¯åŠ¨ï¼Œé‡Šæ”¾ç»ˆç«¯` | `ä¸é€šè¿‡systemdç®¡ç†` |

### 2.2 å¼€æœºè‡ªå¯ç®¡ç†


**ğŸ”„ è‡ªå¯åŠ¨é…ç½®**

```bash
# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆç”Ÿäº§æœåŠ¡å™¨å¿…åšï¼‰
systemctl enable rabbitmq-server

# ç¦ç”¨å¼€æœºè‡ªå¯
systemctl disable rabbitmq-server

# æ£€æŸ¥æ˜¯å¦å·²è®¾ç½®è‡ªå¯
systemctl is-enabled rabbitmq-server
```

> **ğŸ’¡ ç”Ÿäº§ç¯å¢ƒæç¤º**ï¼š  
> æœåŠ¡å™¨é‡å¯åï¼Œå¦‚æœRabbitMQæ²¡æœ‰è‡ªåŠ¨å¯åŠ¨ï¼Œä¾èµ–å®ƒçš„åº”ç”¨å°±ä¼šè¿ä¸ä¸Šï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿç˜«ç—ªã€‚æ‰€ä»¥ç”Ÿäº§ç¯å¢ƒ**ä¸€å®šè¦è®¾ç½®å¼€æœºè‡ªå¯**ã€‚

### 2.3 ä¼˜é›…å…³é—­å‘½ä»¤


**âš¡ ä¸“ç”¨åœæ­¢å‘½ä»¤**

```bash
# åœæ­¢RabbitMQèŠ‚ç‚¹ï¼ˆæ¨èï¼‰
rabbitmqctl stop

# ä¼˜é›…å…³é—­èŠ‚ç‚¹ï¼ˆç­‰å¾…æ¶ˆæ¯å¤„ç†å®Œï¼‰
rabbitmqctl shutdown

# å¼ºåˆ¶åœæ­¢ç‰¹å®šèŠ‚ç‚¹
rabbitmqctl stop rabbit@hostname
```

**ğŸ¯ ä¸åŒåœæ­¢æ–¹å¼å¯¹æ¯”**

| **å‘½ä»¤** | **å¤„ç†æ–¹å¼** | **ä½¿ç”¨æ—¶æœº** |
|---------|-------------|-------------|
| `systemctl stop` | `ç³»ç»Ÿçº§åœæ­¢ï¼Œè¾ƒæ¸©å’Œ` | `æ—¥å¸¸ç»´æŠ¤` |
| `rabbitmqctl stop` | `RabbitMQä¸“ç”¨åœæ­¢` | `RabbitMQç»´æŠ¤` |
| `rabbitmqctl shutdown` | `ç­‰å¾…æ¶ˆæ¯å¤„ç†å®Œå†åœæ­¢` | `é‡è¦æ•°æ®ä¸èƒ½ä¸¢å¤±æ—¶` |

---

## 3. ğŸ‘¤ ç”¨æˆ·æƒé™ç®¡ç†


### 3.1 ç”¨æˆ·ç®¡ç†åŸºç¡€


**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦ç”¨æˆ·ç®¡ç†ï¼Ÿ**

æƒ³è±¡RabbitMQæ˜¯ä¸€ä¸ªå…¬å¸å¤§æ¥¼ï¼š
- **ç®¡ç†å‘˜** = æ¥¼ç®¡ï¼Œå¯ä»¥è¿›å‡ºæ‰€æœ‰æˆ¿é—´
- **æ™®é€šç”¨æˆ·** = å‘˜å·¥ï¼Œåªèƒ½è¿›å…¥è¢«æˆæƒçš„æˆ¿é—´
- **è®¿å®¢** = ä¸´æ—¶ç”¨æˆ·ï¼Œæƒé™æœ€å°‘

ä¸åŒçš„åº”ç”¨ç³»ç»Ÿåº”è¯¥æœ‰ä¸åŒçš„è´¦å·ï¼Œäº’ä¸å¹²æ‰°ï¼Œè¿™æ ·æ›´å®‰å…¨ã€‚

**ğŸ‘¥ ç”¨æˆ·æ“ä½œå‘½ä»¤**

```bash
# æ·»åŠ ç”¨æˆ·
rabbitmqctl add_user username password

# åˆ é™¤ç”¨æˆ·
rabbitmqctl delete_user username

# ä¿®æ”¹å¯†ç 
rabbitmqctl change_password username newpassword

# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
rabbitmqctl list_users
```

### 3.2 ç”¨æˆ·æ ‡ç­¾æƒé™


**ğŸ·ï¸ ç”¨æˆ·æƒé™ç­‰çº§**

```bash
# è®¾ç½®ç”¨æˆ·æ ‡ç­¾ï¼ˆæƒé™ç­‰çº§ï¼‰
rabbitmqctl set_user_tags username administrator

# æ¸…é™¤ç”¨æˆ·æ ‡ç­¾
rabbitmqctl set_user_tags username
```

**ğŸ“Š æƒé™ç­‰çº§è¯´æ˜**

| **æ ‡ç­¾** | **æƒé™èŒƒå›´** | **å…¸å‹ç”¨æˆ·** | **èƒ½åšä»€ä¹ˆ** |
|---------|-------------|-------------|-------------|
| `administrator` | `æœ€é«˜æƒé™` | `ç³»ç»Ÿç®¡ç†å‘˜` | `ç®¡ç†ç”¨æˆ·ã€vhostã€ç­–ç•¥ç­‰ä¸€åˆ‡` |
| `monitoring` | `ç›‘æ§æƒé™` | `è¿ç»´äººå‘˜` | `æŸ¥çœ‹æ‰€æœ‰é˜Ÿåˆ—ã€è¿æ¥çŠ¶æ€` |
| `policymaker` | `ç­–ç•¥æƒé™` | `æ¶æ„å¸ˆ` | `ç®¡ç†ç­–ç•¥å’Œå‚æ•°` |
| `management` | `ç®¡ç†æƒé™` | `å¼€å‘è´Ÿè´£äºº` | `ç®¡ç†è‡ªå·±vhostçš„èµ„æº` |
| `æ— æ ‡ç­¾` | `åŸºç¡€æƒé™` | `æ™®é€šåº”ç”¨` | `åªèƒ½å‘é€æ¥æ”¶æ¶ˆæ¯` |

### 3.3 è™šæ‹Ÿä¸»æœºæƒé™


**ğŸ  vhostæƒé™è®¾ç½®**

```bash
# ç»™ç”¨æˆ·åœ¨æŒ‡å®švhostè®¾ç½®æƒé™
rabbitmqctl set_permissions -p vhost_name username ".*" ".*" ".*"

# åˆ é™¤ç”¨æˆ·åœ¨vhostçš„æƒé™
rabbitmqctl clear_permissions -p vhost_name username

# æŸ¥çœ‹ç”¨æˆ·æƒé™
rabbitmqctl list_permissions -p vhost_name

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„æƒé™
rabbitmqctl list_user_permissions username
```

**ğŸ”‘ æƒé™å­—ç¬¦ä¸²è§£é‡Š**

æƒé™æ ¼å¼ï¼š`"é…ç½®æƒé™" "å†™æƒé™" "è¯»æƒé™"`

```bash
# ç¤ºä¾‹è§£é‡Š
rabbitmqctl set_permissions -p /test myapp "^myapp-.*" "^myapp-.*" "^myapp-.*"
```

| **æƒé™ä½ç½®** | **å«ä¹‰** | **ç¤ºä¾‹** | **è¯´æ˜** |
|-------------|---------|---------|---------|
| **ç¬¬1ä¸ªå‚æ•°** | `é…ç½®æƒé™` | `"^myapp-.*"` | `å¯ä»¥åˆ›å»ºåˆ é™¤ä»¥myapp-å¼€å¤´çš„èµ„æº` |
| **ç¬¬2ä¸ªå‚æ•°** | `å†™æƒé™` | `"^myapp-.*"` | `å¯ä»¥å‘ä»¥myapp-å¼€å¤´çš„é˜Ÿåˆ—å‘æ¶ˆæ¯` |
| **ç¬¬3ä¸ªå‚æ•°** | `è¯»æƒé™` | `"^myapp-.*"` | `å¯ä»¥ä»ä»¥myapp-å¼€å¤´çš„é˜Ÿåˆ—æ”¶æ¶ˆæ¯` |

---

## 4. ğŸ  è™šæ‹Ÿä¸»æœºæ“ä½œ


### 4.1 vhostæ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯è™šæ‹Ÿä¸»æœºï¼Ÿ**

è™šæ‹Ÿä¸»æœº(vhost)å°±åƒ**å…¬å¯“æ¥¼é‡Œçš„ä¸åŒå•å…ƒ**ï¼š
- æ¯ä¸ªå•å…ƒæœ‰ç‹¬ç«‹çš„é—¨ç‰Œå·ï¼ˆvhoståç§°ï¼‰
- å•å…ƒå†…çš„è®¾æ–½äº’ä¸å¹²æ‰°ï¼ˆé˜Ÿåˆ—ã€äº¤æ¢æœºéš”ç¦»ï¼‰
- ä¸åŒç§Ÿæˆ·æœ‰ä¸åŒçš„é’¥åŒ™ï¼ˆç”¨æˆ·æƒé™ï¼‰
- æ¥¼ç®¡å¯ä»¥è¿›å…¥æ‰€æœ‰å•å…ƒï¼ˆç®¡ç†å‘˜æƒé™ï¼‰

**ğŸ’¼ å®é™…åº”ç”¨åœºæ™¯**

```
ä¼ä¸šåº”ç”¨éš”ç¦»ç¤ºä¾‹ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RabbitMQæœåŠ¡å™¨                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   /production   â”‚      /test      â”‚      /dev       â”‚
â”‚   (ç”Ÿäº§ç¯å¢ƒ)     â”‚    (æµ‹è¯•ç¯å¢ƒ)    â”‚    (å¼€å‘ç¯å¢ƒ)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ è®¢å•ç³»ç»Ÿ        â”‚â€¢ åŠŸèƒ½æµ‹è¯•        â”‚â€¢ æ–°åŠŸèƒ½å¼€å‘      â”‚
â”‚â€¢ æ”¯ä»˜ç³»ç»Ÿ        â”‚â€¢ æ€§èƒ½æµ‹è¯•        â”‚â€¢ Bugè°ƒè¯•         â”‚
â”‚â€¢ åº“å­˜ç³»ç»Ÿ        â”‚â€¢ é›†æˆæµ‹è¯•        â”‚â€¢ ä»£ç éªŒè¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 vhostç®¡ç†å‘½ä»¤


**ğŸ—ï¸ åˆ›å»ºå’Œåˆ é™¤vhost**

```bash
# åˆ›å»ºè™šæ‹Ÿä¸»æœº
rabbitmqctl add_vhost /production
rabbitmqctl add_vhost /test
rabbitmqctl add_vhost /dev

# åˆ é™¤è™šæ‹Ÿä¸»æœºï¼ˆå±é™©æ“ä½œï¼ï¼‰
rabbitmqctl delete_vhost /test

# æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿä¸»æœº
rabbitmqctl list_vhosts

# æŸ¥çœ‹vhostè¯¦ç»†ä¿¡æ¯
rabbitmqctl list_vhosts name tracing
```

> **âš ï¸ é‡è¦æé†’**ï¼š  
> åˆ é™¤vhostä¼š**åˆ é™¤å…¶ä¸­æ‰€æœ‰çš„é˜Ÿåˆ—ã€äº¤æ¢æœºå’Œæ¶ˆæ¯**ï¼ç”Ÿäº§ç¯å¢ƒæ“ä½œå‰ä¸€å®šè¦å¤‡ä»½ã€‚

### 4.3 vhostæƒé™åˆ†é…


**ğŸ” å®Œæ•´æƒé™é…ç½®æµç¨‹**

```bash
# 1. åˆ›å»ºå¼€å‘ç¯å¢ƒvhost
rabbitmqctl add_vhost /dev

# 2. åˆ›å»ºä¸“ç”¨ç”¨æˆ·
rabbitmqctl add_user dev_user dev_password

# 3. è®¾ç½®ç”¨æˆ·æ ‡ç­¾
rabbitmqctl set_user_tags dev_user management

# 4. åˆ†é…vhostæƒé™
rabbitmqctl set_permissions -p /dev dev_user ".*" ".*" ".*"

# 5. éªŒè¯æƒé™è®¾ç½®
rabbitmqctl list_permissions -p /dev
```

---

## 5. ğŸ“® é˜Ÿåˆ—äº¤æ¢æœºç®¡ç†


### 5.1 é˜Ÿåˆ—ç®¡ç†å‘½ä»¤


**ğŸ“¦ é˜Ÿåˆ—åŸºæœ¬æ“ä½œ**

> **é˜Ÿåˆ—å°±åƒå¿«é€’æŸœ**ï¼šæ¶ˆæ¯å°±æ˜¯å¿«é€’åŒ…è£¹ï¼Œå…ˆæ”¾è¿›å»çš„å…ˆè¢«å–èµ°ã€‚é˜Ÿåˆ—å¯ä»¥è®¾ç½®å„ç§å±æ€§ï¼Œæ¯”å¦‚æ˜¯å¦æŒä¹…åŒ–ï¼ˆæ–­ç”µåæ•°æ®ä¸ä¸¢å¤±ï¼‰ã€‚

```bash
# å£°æ˜åˆ›å»ºé˜Ÿåˆ—
rabbitmqctl declare queue name=test_queue durable=true

# åˆ é™¤é˜Ÿåˆ—
rabbitmqctl delete queue name=test_queue

# æ¸…ç©ºé˜Ÿåˆ—æ¶ˆæ¯
rabbitmqctl purge queue name=test_queue

# æŸ¥çœ‹æ‰€æœ‰é˜Ÿåˆ—
rabbitmqctl list_queues

# æŸ¥çœ‹é˜Ÿåˆ—è¯¦ç»†ä¿¡æ¯
rabbitmqctl list_queues name messages consumers
```

**ğŸ“Š é˜Ÿåˆ—çŠ¶æ€ä¿¡æ¯è§£è¯»**

```bash
# è¯¦ç»†æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
rabbitmqctl list_queues name messages messages_ready messages_unacknowledged consumers
```

| **å­—æ®µ** | **å«ä¹‰** | **æ­£å¸¸å€¼** | **å¼‚å¸¸æç¤º** |
|---------|---------|-----------|-------------|
| `messages` | `é˜Ÿåˆ—ä¸­æ€»æ¶ˆæ¯æ•°` | `è¾ƒå°‘` | `æŒç»­å¢é•¿è¯´æ˜æ¶ˆè´¹ä¸è¿‡æ¥` |
| `messages_ready` | `å¾…æ¶ˆè´¹æ¶ˆæ¯æ•°` | `0æˆ–å°‘é‡` | `å¤§é‡å †ç§¯éœ€è¦æ£€æŸ¥æ¶ˆè´¹è€…` |
| `messages_unacknowledged` | `å·²å‘é€æœªç¡®è®¤æ¶ˆæ¯æ•°` | `å°‘é‡` | `è¿‡å¤šå¯èƒ½æ˜¯æ¶ˆè´¹è€…å¡ä½äº†` |
| `consumers` | `æ¶ˆè´¹è€…æ•°é‡` | `â‰¥1` | `ä¸º0è¯´æ˜æ²¡æœ‰æ¶ˆè´¹è€…è¿æ¥` |

### 5.2 äº¤æ¢æœºç®¡ç†


**ğŸ¯ äº¤æ¢æœºæ“ä½œå‘½ä»¤**

```bash
# å£°æ˜äº¤æ¢æœº
rabbitmqctl declare exchange name=my_exchange type=direct

# åˆ é™¤äº¤æ¢æœº
rabbitmqctl delete exchange name=my_exchange

# æŸ¥çœ‹æ‰€æœ‰äº¤æ¢æœº
rabbitmqctl list_exchanges

# æŸ¥çœ‹äº¤æ¢æœºè¯¦ç»†ä¿¡æ¯
rabbitmqctl list_exchanges name type
```

**ğŸ”€ äº¤æ¢æœºç±»å‹å¯¹æ¯”**

| **ç±»å‹** | **è·¯ç”±æ–¹å¼** | **ä½¿ç”¨åœºæ™¯** | **ä¸¾ä¾‹è¯´æ˜** |
|---------|-------------|-------------|-------------|
| `direct` | `ç²¾ç¡®åŒ¹é…routing_key` | `ç‚¹å¯¹ç‚¹å‘é€` | `è®¢å•æ¶ˆæ¯åªå‘ç»™è®¢å•å¤„ç†é˜Ÿåˆ—` |
| `topic` | `æ¨¡å¼åŒ¹é…routing_key` | `åˆ†ç±»å¹¿æ’­` | `log.errorã€log.infoå‘ç»™ä¸åŒé˜Ÿåˆ—` |
| `fanout` | `å¿½ç•¥routing_keyï¼Œå¹¿æ’­æ‰€æœ‰` | `å…¨å‘˜é€šçŸ¥` | `ç³»ç»Ÿå…¬å‘Šå‘ç»™æ‰€æœ‰ç”¨æˆ·` |
| `headers` | `åŒ¹é…æ¶ˆæ¯å¤´` | `å¤æ‚è·¯ç”±` | `æ ¹æ®åœ°åŒºã€ç”¨æˆ·ç±»å‹ç­‰å¤šæ¡ä»¶è·¯ç”±` |

### 5.3 ç»‘å®šå…³ç³»ç®¡ç†


**ğŸ”— é˜Ÿåˆ—ç»‘å®šæ“ä½œ**

```bash
# åˆ›å»ºç»‘å®šå…³ç³»
rabbitmqctl bind_queue exchange=my_exchange queue=my_queue routing_key=order

# è§£é™¤ç»‘å®šå…³ç³»
rabbitmqctl unbind_queue exchange=my_exchange queue=my_queue routing_key=order

# æŸ¥çœ‹ç»‘å®šå…³ç³»
rabbitmqctl list_bindings

# æŸ¥çœ‹ç‰¹å®šäº¤æ¢æœºçš„ç»‘å®š
rabbitmqctl list_bindings -p /dev | grep my_exchange
```

---

## 6. ğŸ“Š ç›‘æ§è¯Šæ–­å‘½ä»¤


### 6.1 çŠ¶æ€ç›‘æ§å‘½ä»¤


**ğŸ” ç³»ç»ŸçŠ¶æ€æŸ¥çœ‹**

```bash
# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
rabbitmqctl status

# æŸ¥çœ‹ç¯å¢ƒä¿¡æ¯
rabbitmqctl environment

# æŸ¥çœ‹è¿æ¥ä¿¡æ¯
rabbitmqctl list_connections

# æŸ¥çœ‹é€šé“ä¿¡æ¯
rabbitmqctl list_channels

# æŸ¥çœ‹æ¶ˆè´¹è€…ä¿¡æ¯
rabbitmqctl list_consumers
```

### 6.2 æ€§èƒ½ç›‘æ§


**âš¡ å…³é”®æ€§èƒ½æŒ‡æ ‡**

```bash
# å†…å­˜ä½¿ç”¨æƒ…å†µ
rabbitmqctl status | grep memory

# ç£ç›˜ä½¿ç”¨æƒ…å†µ
rabbitmqctl status | grep disk

# å®æ—¶ç»Ÿè®¡ä¿¡æ¯
rabbitmqctl eval 'rabbit_mgmt_db:get_overview(all, basic).'
```

**ğŸ“ˆ ç›‘æ§æŒ‡æ ‡è§£è¯»**

| **æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** | **å¤„ç†å»ºè®®** |
|---------|-------------|-------------|-------------|
| **å†…å­˜ä½¿ç”¨ç‡** | `< 40%` | `> 80%` | `å¢åŠ å†…å­˜æˆ–æ¸…ç†é˜Ÿåˆ—` |
| **ç£ç›˜ä½¿ç”¨ç‡** | `< 70%` | `> 90%` | `æ¸…ç†æ—¥å¿—æˆ–å¢åŠ ç£ç›˜` |
| **è¿æ¥æ•°** | `< 1000` | `> 5000` | `æ£€æŸ¥è¿æ¥æ± é…ç½®` |
| **æ¶ˆæ¯å †ç§¯** | `< 1000` | `> 10000` | `å¢åŠ æ¶ˆè´¹è€…æˆ–ä¼˜åŒ–å¤„ç†é€Ÿåº¦` |

### 6.3 æ•…éšœè¯Šæ–­


**ğŸš¨ å¸¸è§é—®é¢˜è¯Šæ–­**

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸
systemctl is-active rabbitmq-server

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/rabbitmq/rabbit@hostname.log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 5672

# æµ‹è¯•è¿æ¥
telnet localhost 5672
```

---

## 7. ğŸ› ï¸ å®æˆ˜æ“ä½œæµç¨‹


### 7.1 åˆå§‹åŒ–ç¯å¢ƒé…ç½®


**ğŸš€ ä»é›¶å¼€å§‹é…ç½®RabbitMQ**

```bash
# ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨æœåŠ¡
systemctl start rabbitmq-server
systemctl enable rabbitmq-server

# ç¬¬äºŒæ­¥ï¼šå¯ç”¨ç®¡ç†æ’ä»¶
rabbitmq-plugins enable rabbitmq_management

# ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
rabbitmqctl add_user admin admin123
rabbitmqctl set_user_tags admin administrator
rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"

# ç¬¬å››æ­¥ï¼šåˆ é™¤é»˜è®¤guestç”¨æˆ·ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
rabbitmqctl delete_user guest
```

> **ğŸ’¡ ä¸ºä»€ä¹ˆè¦åˆ é™¤guestç”¨æˆ·ï¼Ÿ**  
> guestç”¨æˆ·é»˜è®¤å¯†ç æ˜¯guestï¼Œä»»ä½•äººéƒ½çŸ¥é“ï¼Œä¿ç•™å®ƒå°±åƒæŠŠå®¶é—¨é’¥åŒ™æ”¾åœ¨é—¨å£ä¸€æ ·å±é™©ã€‚

### 7.2 åº”ç”¨ç¯å¢ƒéš”ç¦»é…ç½®


**ğŸ¢ å¤šç¯å¢ƒéƒ¨ç½²é…ç½®**

```bash
# åˆ›å»ºä¸åŒç¯å¢ƒçš„vhost
rabbitmqctl add_vhost /production
rabbitmqctl add_vhost /staging  
rabbitmqctl add_vhost /development

# åˆ›å»ºå¯¹åº”çš„ç”¨æˆ·
rabbitmqctl add_user prod_user prod_pass123
rabbitmqctl add_user stage_user stage_pass123
rabbitmqctl add_user dev_user dev_pass123

# åˆ†é…æƒé™
rabbitmqctl set_permissions -p /production prod_user ".*" ".*" ".*"
rabbitmqctl set_permissions -p /staging stage_user ".*" ".*" ".*"
rabbitmqctl set_permissions -p /development dev_user ".*" ".*" ".*"

# è®¾ç½®ç”¨æˆ·æ ‡ç­¾
rabbitmqctl set_user_tags prod_user management
rabbitmqctl set_user_tags stage_user management
rabbitmqctl set_user_tags dev_user management
```

### 7.3 æ—¥å¸¸ç»´æŠ¤æ“ä½œ


**ğŸ“… å®šæœŸç»´æŠ¤æ£€æŸ¥æ¸…å•**

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status rabbitmq-server

# 2. æ£€æŸ¥é˜Ÿåˆ—å †ç§¯
rabbitmqctl list_queues name messages

# 3. æ£€æŸ¥å†…å­˜ä½¿ç”¨
rabbitmqctl status | grep memory

# 4. æŸ¥çœ‹è¿æ¥æ•°
rabbitmqctl list_connections | wc -l

# 5. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 6. æŸ¥çœ‹æœ€è¿‘é”™è¯¯æ—¥å¿—
tail -n 50 /var/log/rabbitmq/rabbit@$(hostname).log
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```
ğŸ”¸ æœåŠ¡ç®¡ç†ï¼šsystemctl start/stop/restart/status rabbitmq-server
ğŸ”¸ ç”¨æˆ·ç®¡ç†ï¼šadd_user, delete_user, set_user_tags, set_permissions
ğŸ”¸ vhostç®¡ç†ï¼šadd_vhost, delete_vhost, list_vhosts
ğŸ”¸ é˜Ÿåˆ—ç®¡ç†ï¼šlist_queues, purge_queue, delete_queue
ğŸ”¸ ç›‘æ§è¯Šæ–­ï¼šstatus, list_connections, environment
ğŸ”¸ æ’ä»¶ç®¡ç†ï¼šrabbitmq-plugins enable/disable
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æƒé™æ¨¡å‹ç†è§£**
```
ç”¨æˆ· â†’ åœ¨vhostä¸­ â†’ å¯¹èµ„æº â†’ æœ‰æƒé™
ä»»ä½•æ“ä½œéƒ½è¦æ£€æŸ¥è¿™å››ä¸ªå±‚æ¬¡çš„æƒé™
```

**ğŸ”¹ æ¶ˆæ¯æµè½¬è·¯å¾„**
```
Producer â†’ Exchange â†’ Queue â†’ Consumer
ç”Ÿäº§è€… â†’ äº¤æ¢æœº â†’ é˜Ÿåˆ— â†’ æ¶ˆè´¹è€…
```

**ğŸ”¹ ç¯å¢ƒéš”ç¦»åŸåˆ™**
```
ä¸åŒé¡¹ç›®ç”¨ä¸åŒvhost
ä¸åŒç¯å¢ƒç”¨ä¸åŒç”¨æˆ·
ç”Ÿäº§ç¯å¢ƒæƒé™æœ€ä¸¥æ ¼
```

### 8.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**ğŸ›¡ï¸ å®‰å…¨é…ç½®**
- åˆ é™¤é»˜è®¤guestç”¨æˆ·
- ä¸ºæ¯ä¸ªåº”ç”¨åˆ›å»ºä¸“ç”¨ç”¨æˆ·
- ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
- å®šæœŸè½®æ¢å¯†ç 
- é™åˆ¶ç”¨æˆ·æƒé™èŒƒå›´

**âš¡ æ€§èƒ½ä¼˜åŒ–**
- ç›‘æ§é˜Ÿåˆ—å †ç§¯æƒ…å†µ
- åˆç†è®¾ç½®æ¶ˆæ¯TTL
- ä½¿ç”¨æŒä¹…åŒ–é˜Ÿåˆ—ä¿è¯æ•°æ®å®‰å…¨
- é…ç½®åˆé€‚çš„é¢„å–æ•°é‡
- å®šæœŸæ¸…ç†æ— ç”¨é˜Ÿåˆ—

**ğŸ”§ è¿ç»´ç›‘æ§**
- å¯ç”¨ç®¡ç†ç•Œé¢ç›‘æ§
- é…ç½®æ—¥å¿—è½®è½¬
- ç›‘æ§å†…å­˜å’Œç£ç›˜ä½¿ç”¨
- è®¾ç½®å‘Šè­¦é˜ˆå€¼
- å®šæœŸå¤‡ä»½é…ç½®

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**â“ è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 5672
# æ£€æŸ¥é˜²ç«å¢™
systemctl status firewalld
# æŸ¥çœ‹ç”¨æˆ·æƒé™
rabbitmqctl list_user_permissions username
```

**â“ æ¶ˆæ¯å †ç§¯**
```bash
# æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
rabbitmqctl list_queues name messages
# å¢åŠ æ¶ˆè´¹è€…æ•°é‡
# æ£€æŸ¥æ¶ˆè´¹è€…å¤„ç†æ€§èƒ½
```

**â“ å†…å­˜ä¸è¶³**
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
rabbitmqctl status | grep memory
# æ¸…ç†ä¸å¿…è¦çš„é˜Ÿåˆ—
# è°ƒæ•´å†…å­˜é˜ˆå€¼é…ç½®
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æœåŠ¡ç®¡ç†ç”¨systemctlï¼Œç”¨æˆ·æƒé™rabbitmqctl
vhostéš”ç¦»å¾ˆé‡è¦ï¼Œé˜Ÿåˆ—äº¤æ¢è¦ç»‘å®šå¥½
ç›‘æ§è¯Šæ–­çœ‹çŠ¶æ€ï¼Œæ—¥å¿—æ’é”™å°‘ä¸äº†
ç”Ÿäº§å®‰å…¨ç¬¬ä¸€ä½ï¼Œæ€§èƒ½ä¼˜åŒ–è«å¿˜è®°
```