---
title: 3ã€Spring Booté›†æˆ
---
## ğŸ“š ç›®å½•


1. [Spring Bootè‡ªåŠ¨é…ç½®åŸç†](#1-spring-bootè‡ªåŠ¨é…ç½®åŸç†)
2. [é…ç½®æ–‡ä»¶è¯¦è§£ä¸ä¼˜åŒ–](#2-é…ç½®æ–‡ä»¶è¯¦è§£ä¸ä¼˜åŒ–)
3. [è¿æ¥æ± é…ç½®ä¸æ€§èƒ½ä¼˜åŒ–](#3-è¿æ¥æ± é…ç½®ä¸æ€§èƒ½ä¼˜åŒ–)
4. [ç›‘æ§ç«¯ç‚¹é›†æˆå®è·µ](#4-ç›‘æ§ç«¯ç‚¹é›†æˆå®è·µ)
5. [æµ‹è¯•ç¯å¢ƒæ­å»ºæŒ‡å—](#5-æµ‹è¯•ç¯å¢ƒæ­å»ºæŒ‡å—)
6. [æœ€ä½³å®è·µæ€»ç»“](#6-æœ€ä½³å®è·µæ€»ç»“)

---

# 1. ğŸš€ Spring Bootè‡ªåŠ¨é…ç½®åŸç†



## 1.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é…ç½®



**ğŸ¯ é€šä¿—ç†è§£**
æƒ³è±¡ä½ ä¹°äº†ä¸€å°æ–°ç”µè„‘ï¼Œä»¥å‰éœ€è¦æ‰‹åŠ¨å®‰è£…å„ç§é©±åŠ¨ç¨‹åºï¼Œç°åœ¨çš„ç”µè„‘ä¼šè‡ªåŠ¨è¯†åˆ«ç¡¬ä»¶å¹¶å®‰è£…å¯¹åº”é©±åŠ¨ã€‚Spring Bootçš„è‡ªåŠ¨é…ç½®å°±æ˜¯è¿™ä¸ªé“ç† - å®ƒä¼šè‡ªåŠ¨è¯†åˆ«ä½ é¡¹ç›®ä¸­çš„ä¾èµ–ï¼Œç„¶åè‡ªåŠ¨é…ç½®å¥½ç›¸å…³çš„ç»„ä»¶ã€‚

**ğŸ“‹ è‡ªåŠ¨é…ç½®çš„æœ¬è´¨**
```
ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹åŠ¨åˆ›å»ºå„ç§Beanå’Œé…ç½®
è‡ªåŠ¨é…ç½®ï¼šSpring Bootæ ¹æ®classpathä¸­çš„jaråŒ…è‡ªåŠ¨é…ç½®

ä½ åªéœ€è¦ï¼š
1. æ·»åŠ spring-boot-starter-amqpä¾èµ–
2. å†™å‡ è¡Œé…ç½®
3. Spring Bootè‡ªåŠ¨å¸®ä½ é…ç½®å¥½RabbitMQç›¸å…³çš„æ‰€æœ‰ç»„ä»¶
```

## 1.2 RabbitMQè‡ªåŠ¨é…ç½®æœºåˆ¶



**ğŸ”§ æ ¸å¿ƒé…ç½®ç±»**
```
RabbitAutoConfigurationï¼šä¸»é…ç½®ç±»
â”œâ”€â”€ ConnectionFactoryï¼šè¿æ¥å·¥å‚
â”œâ”€â”€ RabbitTemplateï¼šæ¶ˆæ¯å‘é€æ¨¡æ¿  
â”œâ”€â”€ RabbitAdminï¼šç®¡ç†å·¥å…·
â””â”€â”€ SimpleRabbitListenerContainerFactoryï¼šç›‘å¬å™¨å®¹å™¨å·¥å‚
```

**ğŸ’¡ è‡ªåŠ¨é…ç½®è§¦å‘æ¡ä»¶**
```markdown
Spring Bootä¼šæ£€æŸ¥ï¼š
âœ… classpathä¸­æ˜¯å¦æœ‰RabbitMQç›¸å…³çš„ç±»
âœ… æ˜¯å¦æœ‰@EnableRabbitæ³¨è§£
âœ… é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦æœ‰spring.rabbitmqç›¸å…³é…ç½®

æ»¡è¶³æ¡ä»¶åè‡ªåŠ¨åˆ›å»ºæ‰€éœ€çš„Bean
```

**ğŸŒ° ç”Ÿæ´»ç±»æ¯”**
å°±åƒä½ ä½é…’åº—ï¼Œåªè¦æŠ¥æˆ¿é—´å·ï¼Œå‰å°å°±ä¼šè‡ªåŠ¨ç»™ä½ æˆ¿å¡ã€WiFiå¯†ç ç­‰å…¨å¥—æœåŠ¡ã€‚Spring Bootçœ‹åˆ°RabbitMQä¾èµ–ï¼Œå°±è‡ªåŠ¨ç»™ä½ é…ç½®å¥½è¿æ¥ã€æ¨¡æ¿ç­‰å…¨å¥—å·¥å…·ã€‚

## 1.3 ä¾èµ–æ·»åŠ å®è·µ



**ğŸ“¦ Mavenä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```

**ğŸ” è¿™ä¸ªstarteråŒ…å«ä»€ä¹ˆï¼Ÿ**
- `spring-rabbit`ï¼šSpringå¯¹RabbitMQçš„å°è£…
- `amqp-client`ï¼šRabbitMQå®˜æ–¹Javaå®¢æˆ·ç«¯
- è‡ªåŠ¨é…ç½®ç±»å’Œç›¸å…³å·¥å…·

> ğŸ’¡ **æ–°æ‰‹æç¤º**  
> starterå°±æ˜¯Spring Bootçš„"å¥—é¤"ï¼Œä¸€ä¸ªä¾èµ–åŒ…å«äº†æŸä¸ªåŠŸèƒ½æ‰€éœ€çš„æ‰€æœ‰ç»„ä»¶ï¼Œé¿å…ä½ ä¸€ä¸ªä¸ªæ·»åŠ ä¾èµ–ã€‚

---

# 2. âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£ä¸ä¼˜åŒ–



## 2.1 åŸºç¡€é…ç½®è¯¦è§£



**ğŸ“ application.ymlåŸºç¡€é…ç½®**
```yaml
spring:
  rabbitmq:
#    # è¿æ¥ä¿¡æ¯
    host: localhost          # RabbitMQæœåŠ¡å™¨åœ°å€
    port: 5672              # ç«¯å£å·ï¼Œé»˜è®¤5672
    username: guest         # ç”¨æˆ·å
    password: guest         # å¯†ç 
    virtual-host: /         # è™šæ‹Ÿä¸»æœºï¼Œé»˜è®¤æ˜¯ /
```

**ğŸ¤” è¿™äº›é…ç½®æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ**

| é…ç½®é¡¹ | **é€šä¿—è§£é‡Š** | **ä½œç”¨** |
|-------|------------|---------|
| `host` | `RabbitMQæœåŠ¡å™¨çš„IPåœ°å€` | `å‘Šè¯‰ç¨‹åºå»å“ªæ‰¾RabbitMQ` |
| `port` | `æœåŠ¡ç«¯å£å·` | `å°±åƒé—¨ç‰Œå·ï¼ŒæŒ‡å®šå…·ä½“å…¥å£` |
| `username/password` | `ç™»å½•è´¦å·å¯†ç ` | `è¿›å…¥RabbitMQéœ€è¦èº«ä»½éªŒè¯` |
| `virtual-host` | `è™šæ‹Ÿä¸»æœºå` | `åƒä¸åŒçš„æˆ¿é—´ï¼Œéš”ç¦»ä¸åŒé¡¹ç›®` |

## 2.2 é«˜çº§é…ç½®ä¼˜åŒ–



**ğŸ”§ ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®**
```yaml
spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: ${RABBITMQ_USERNAME:admin}
    password: ${RABBITMQ_PASSWORD:admin123}
    virtual-host: /prod
    
#    # è¿æ¥è¶…æ—¶é…ç½®
    connection-timeout: 60000       # è¿æ¥è¶…æ—¶60ç§’
    
#    # å‘å¸ƒè€…ç¡®è®¤æœºåˆ¶
    publisher-confirm-type: correlated  # å¼€å¯å‘å¸ƒç¡®è®¤
    publisher-returns: true             # å¼€å¯å‘å¸ƒè¿”å›
    
#    # æ¶ˆè´¹è€…é…ç½®
    listener:
      simple:
        concurrency: 3              # æœ€å°å¹¶å‘æ¶ˆè´¹è€…æ•°é‡
        max-concurrency: 10         # æœ€å¤§å¹¶å‘æ¶ˆè´¹è€…æ•°é‡
        retry:
          enabled: true             # å¼€å¯é‡è¯•æœºåˆ¶
          initial-interval: 1000    # ç¬¬ä¸€æ¬¡é‡è¯•é—´éš”1ç§’
          max-attempts: 3           # æœ€å¤šé‡è¯•3æ¬¡
        acknowledge-mode: manual    # æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯
```

**ğŸ“Š é…ç½®é¡¹è¯¦ç»†è¯´æ˜**

**ğŸ”¸ è¶…æ—¶é…ç½®**
```
connection-timeout: è¿æ¥å»ºç«‹è¶…æ—¶æ—¶é—´
å°±åƒæ‰“ç”µè¯ï¼Œå¦‚æœ60ç§’å†…æ¥ä¸é€šå°±æŒ‚æ–­
é¿å…ç¨‹åºä¸€ç›´ç­‰å¾…æ— å“åº”çš„æœåŠ¡å™¨
```

**ğŸ”¸ å‘å¸ƒç¡®è®¤é…ç½®**
```
publisher-confirm-type: correlated
- none: ä¸ç¡®è®¤ï¼ˆæœ€å¿«ï¼Œä½†å¯èƒ½ä¸¢æ¶ˆæ¯ï¼‰
- simple: åŒæ­¥ç¡®è®¤ï¼ˆæ…¢ä½†å¯é ï¼‰
- correlated: å¼‚æ­¥ç¡®è®¤ï¼ˆæ¨èï¼Œå¿«ä¸”å¯é ï¼‰

å°±åƒå‘å¿«é€’ï¼Œcorrelatedæ¨¡å¼ä¼šç»™ä½ å‘é€çŠ¶æ€é€šçŸ¥
```

**ğŸ”¸ æ¶ˆè´¹è€…å¹¶å‘é…ç½®**
```
concurrency: 3      # è‡³å°‘3ä¸ªæ¶ˆè´¹è€…åŒæ—¶å·¥ä½œ
max-concurrency: 10 # æœ€å¤š10ä¸ªæ¶ˆè´¹è€…

å°±åƒé¤å…æœåŠ¡å‘˜ï¼Œå¹³æ—¶3ä¸ªï¼Œå¿™çš„æ—¶å€™å¯ä»¥å¢åŠ åˆ°10ä¸ª
```

## 2.3 ç¯å¢ƒé…ç½®åˆ†ç¦»



**ğŸ—ï¸ å¤šç¯å¢ƒé…ç½®ç­–ç•¥**

**å¼€å‘ç¯å¢ƒ application-dev.yml**
```yaml
spring:
  rabbitmq:
    host: localhost
    username: guest
    password: guest
    virtual-host: /dev
```

**ç”Ÿäº§ç¯å¢ƒ application-prod.yml**
```yaml
spring:
  rabbitmq:
    host: ${RABBITMQ_HOST}
    username: ${RABBITMQ_USERNAME}
    password: ${RABBITMQ_PASSWORD}
    virtual-host: /prod
    ssl:
      enabled: true              # ç”Ÿäº§ç¯å¢ƒå¼€å¯SSL
```

> âš ï¸ **å®‰å…¨æé†’**  
> ç”Ÿäº§ç¯å¢ƒå¯†ç ç»ä¸è¦ç¡¬ç¼–ç åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒç®¡ç†æ•æ„Ÿä¿¡æ¯ã€‚

---

# 3. ğŸŠ è¿æ¥æ± é…ç½®ä¸æ€§èƒ½ä¼˜åŒ–



## 3.1 è¿æ¥æ± åŸºæœ¬æ¦‚å¿µ



**ğŸ¯ ä»€ä¹ˆæ˜¯è¿æ¥æ± ï¼Ÿ**

**ğŸŒ° ç”Ÿæ´»ç±»æ¯”**
```
æ²¡æœ‰è¿æ¥æ± ï¼šæ¯æ¬¡å‘æ¶ˆæ¯éƒ½è¦é‡æ–°å»ºç«‹è¿æ¥
å°±åƒæ¯æ¬¡æ‰“ç”µè¯éƒ½è¦é‡æ–°æ‹¨å·

æœ‰äº†è¿æ¥æ± ï¼šæå‰å»ºç«‹å¥½å¤šä¸ªè¿æ¥ï¼Œéœ€è¦æ—¶ç›´æ¥ä½¿ç”¨
å°±åƒå…¬å¸ç”µè¯äº¤æ¢æœºï¼Œå¤šæ¡çº¿è·¯éšæ—¶å¯ç”¨
```

**ğŸ“ˆ è¿æ¥æ± çš„å¥½å¤„**
- âœ… **å‡å°‘è¿æ¥å¼€é”€**ï¼šé¿å…é¢‘ç¹å»ºç«‹/å…³é—­è¿æ¥
- âœ… **æé«˜æ€§èƒ½**ï¼šè¿æ¥å¤ç”¨ï¼Œå“åº”æ›´å¿«
- âœ… **æ§åˆ¶èµ„æº**ï¼šé™åˆ¶æœ€å¤§è¿æ¥æ•°ï¼Œé¿å…èµ„æºè€—å°½

## 3.2 è¿æ¥æ± è¯¦ç»†é…ç½®



**ğŸ”§ å®Œæ•´è¿æ¥æ± é…ç½®**
```yaml
spring:
  rabbitmq:
#    # åŸºç¡€è¿æ¥é…ç½®
    host: localhost
    port: 5672
    username: admin
    password: admin123
    
#    # è¿æ¥æ± é…ç½®
    cache:
      connection:
        mode: channel           # è¿æ¥ç¼“å­˜æ¨¡å¼
        size: 25               # ç¼“å­˜è¿æ¥æ•°é‡
      channel:
        size: 25               # ç¼“å­˜é€šé“æ•°é‡
        checkout-timeout: 5000  # è·å–é€šé“è¶…æ—¶æ—¶é—´
    
#    # è¿æ¥å·¥å‚é…ç½®
    connection-timeout: 60000    # è¿æ¥è¶…æ—¶
    requested-heartbeat: 60      # å¿ƒè·³é—´éš”60ç§’
```

**ğŸ“‹ é…ç½®å‚æ•°è¯¦è§£**

| å‚æ•° | **é€šä¿—è§£é‡Š** | **æ¨èå€¼** | **ä½œç”¨** |
|-----|------------|----------|---------|
| `cache.connection.size` | `è¿æ¥æ± å¤§å°` | `25` | `åŒæ—¶ä¿æŒå¤šå°‘ä¸ªè¿æ¥` |
| `cache.channel.size` | `é€šé“æ± å¤§å°` | `25` | `æ¯ä¸ªè¿æ¥æœ‰å¤šå°‘ä¸ªé€šé“` |
| `checkout-timeout` | `è·å–é€šé“è¶…æ—¶` | `5000ms` | `ç­‰å¾…å¯ç”¨é€šé“çš„æœ€é•¿æ—¶é—´` |
| `requested-heartbeat` | `å¿ƒè·³é—´éš”` | `60ç§’` | `æ£€æŸ¥è¿æ¥æ˜¯å¦è¿˜æ´»ç€` |

## 3.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥



**âš¡ é«˜å¹¶å‘åœºæ™¯ä¼˜åŒ–**
```yaml
spring:
  rabbitmq:
#    # é€‚åˆé«˜å¹¶å‘çš„é…ç½®
    cache:
      connection:
        size: 50               # å¢åŠ è¿æ¥æ± å¤§å°
      channel:
        size: 100             # å¢åŠ é€šé“æ± å¤§å°
        checkout-timeout: 3000 # ç¼©çŸ­è¶…æ—¶æ—¶é—´
    
#    # æ¶ˆè´¹è€…ä¼˜åŒ–
    listener:
      simple:
        concurrency: 10        # å¢åŠ å¹¶å‘æ¶ˆè´¹è€…
        max-concurrency: 50    # æé«˜æœ€å¤§å¹¶å‘æ•°
        prefetch: 10          # æ¯ä¸ªæ¶ˆè´¹è€…é¢„å–10æ¡æ¶ˆæ¯
```

**ğŸ¯ ä¼˜åŒ–åŸåˆ™**
```
1. è¿æ¥æ•° = CPUæ ¸å¿ƒæ•° Ã— 2
2. é€šé“æ•° = è¿æ¥æ•° Ã— 4
3. æ¶ˆè´¹è€…å¹¶å‘æ•°æ ¹æ®ä¸šåŠ¡å¤„ç†èƒ½åŠ›è°ƒæ•´
4. é¢„å–æ•°é‡é¿å…è¿‡å¤§ï¼Œé˜²æ­¢æ¶ˆæ¯ç§¯å‹
```

**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```
éœ€è¦ç›‘æ§çš„å…³é”®æŒ‡æ ‡ï¼š
- è¿æ¥æ± ä½¿ç”¨ç‡
- é€šé“æ± ä½¿ç”¨ç‡  
- æ¶ˆæ¯å¤„ç†é€Ÿåº¦
- é”™è¯¯ç‡å’Œé‡è¯•æ¬¡æ•°
```

> ğŸ’¡ **æ€§èƒ½è°ƒä¼˜æç¤º**  
> ä¸è¦ç›²ç›®å¢å¤§è¿æ¥æ± ï¼Œè¦æ ¹æ®å®é™…ä¸šåŠ¡é‡å’ŒæœåŠ¡å™¨èµ„æºæ¥è°ƒæ•´ã€‚å…ˆç›‘æ§ï¼Œå†ä¼˜åŒ–ã€‚

---

# 4. ğŸ“Š ç›‘æ§ç«¯ç‚¹é›†æˆå®è·µ



## 4.1 Spring Boot Actuatoré›†æˆ



**ğŸ”§ æ·»åŠ ç›‘æ§ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**âš™ï¸ ç›‘æ§é…ç½®**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,rabbitmq,metrics  # æš´éœ²ç›‘æ§ç«¯ç‚¹
  endpoint:
    health:
      show-details: always               # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
    rabbitmq:
      enabled: true                      # å¯ç”¨RabbitMQç›‘æ§
```

## 4.2 å¥åº·æ£€æŸ¥ç«¯ç‚¹



**ğŸ¥ å¥åº·æ£€æŸ¥è®¿é—®**
```
è®¿é—®åœ°å€ï¼šhttp://localhost:8080/actuator/health
```

**ğŸ“‹ å¥åº·æ£€æŸ¥å“åº”ç¤ºä¾‹**
```json
{
  "status": "UP",
  "components": {
    "rabbitmq": {
      "status": "UP",
      "details": {
        "version": "3.8.9",
        "cluster_name": "rabbit@localhost"
      }
    }
  }
}
```

**ğŸ¯ å¥åº·çŠ¶æ€è¯´æ˜**
- `UP`ï¼šRabbitMQè¿æ¥æ­£å¸¸
- `DOWN`ï¼šRabbitMQè¿æ¥å¼‚å¸¸
- `UNKNOWN`ï¼šæ— æ³•ç¡®å®šçŠ¶æ€

## 4.3 è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡



**ğŸ“ˆ è‡ªå®šä¹‰å¥åº·æŒ‡æ ‡**
```java
@Component
public class RabbitMQHealthIndicator implements HealthIndicator {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @Override
    public Health health() {
        try {
            // æ£€æŸ¥è¿æ¥çŠ¶æ€
            Connection connection = rabbitTemplate
                .getConnectionFactory()
                .createConnection();
            
            if (connection.isOpen()) {
                return Health.up()
                    .withDetail("connection", "active")
                    .withDetail("channels", connection.getChannelMax())
                    .build();
            } else {
                return Health.down()
                    .withDetail("connection", "closed")
                    .build();
            }
        } catch (Exception e) {
            return Health.down()
                .withDetail("error", e.getMessage())
                .build();
        }
    }
}
```

**ğŸ” è¿™ä¸ªä»£ç åšä»€ä¹ˆï¼Ÿ**
```
1. åˆ›å»ºä¸€ä¸ªå¥åº·æ£€æŸ¥å™¨
2. å°è¯•è·å–RabbitMQè¿æ¥
3. æ£€æŸ¥è¿æ¥æ˜¯å¦æ­£å¸¸
4. è¿”å›è¯¦ç»†çš„å¥åº·çŠ¶æ€ä¿¡æ¯

å°±åƒåŒ»ç”Ÿæ£€æŸ¥èº«ä½“ï¼Œå®šæœŸæ£€æµ‹RabbitMQæ˜¯å¦å¥åº·
```

## 4.4 Prometheusç›‘æ§é›†æˆ



**ğŸ“Š PrometheusæŒ‡æ ‡é…ç½®**
```yaml
management:
  metrics:
    export:
      prometheus:
        enabled: true           # å¯ç”¨Prometheuså¯¼å‡º
    tags:
      application: my-service   # åº”ç”¨æ ‡ç­¾
```

**ğŸ”§ è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†**
```java
@Component
public class RabbitMQMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter messagesSent;
    private final Counter messagesReceived;
    
    public RabbitMQMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.messagesSent = Counter.builder("rabbitmq.messages.sent")
            .description("å‘é€çš„æ¶ˆæ¯æ•°é‡")
            .register(meterRegistry);
        this.messagesReceived = Counter.builder("rabbitmq.messages.received")
            .description("æ¥æ”¶çš„æ¶ˆæ¯æ•°é‡")
            .register(meterRegistry);
    }
    
    public void incrementSent() {
        messagesSent.increment();
    }
    
    public void incrementReceived() {
        messagesReceived.increment();
    }
}
```

---

# 5. ğŸ§ª æµ‹è¯•ç¯å¢ƒæ­å»ºæŒ‡å—



## 5.1 æµ‹è¯•ä¾èµ–é…ç½®



**ğŸ”§ æµ‹è¯•ç›¸å…³ä¾èµ–**
```xml
<dependencies>
    <!-- Spring Bootæµ‹è¯•å¯åŠ¨å™¨ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
    
    <!-- RabbitMQæµ‹è¯•å·¥å…· -->
    <dependency>
        <groupId>org.springframework.amqp</groupId>
        <artifactId>spring-rabbit-test</artifactId>
        <scope>test</scope>
    </dependency>
    
    <!-- åµŒå…¥å¼RabbitMQï¼ˆå¯é€‰ï¼‰ -->
    <dependency>
        <groupId>io.arivera.oss</groupId>
        <artifactId>embedded-rabbitmq</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>
```

## 5.2 æµ‹è¯•é…ç½®æ–‡ä»¶



**ğŸ“ application-test.yml**
```yaml
spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /test
    
#    # æµ‹è¯•ç¯å¢ƒç‰¹æ®Šé…ç½®
    listener:
      simple:
        acknowledge-mode: auto    # æµ‹è¯•ç¯å¢ƒè‡ªåŠ¨ç¡®è®¤
        retry:
          enabled: false         # æµ‹è¯•æ—¶ç¦ç”¨é‡è¯•
          
logging:
  level:
    org.springframework.amqp: DEBUG  # å¼€å¯AMQPè°ƒè¯•æ—¥å¿—
```

## 5.3 é›†æˆæµ‹è¯•ç¤ºä¾‹



**ğŸ§ª æ¶ˆæ¯å‘é€æµ‹è¯•**
```java
@SpringBootTest
@TestPropertySource(locations = "classpath:application-test.yml")
public class RabbitMQIntegrationTest {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @Autowired
    private RabbitAdmin rabbitAdmin;
    
    @Test
    public void testSendMessage() {
        // åˆ›å»ºæµ‹è¯•é˜Ÿåˆ—
        Queue testQueue = new Queue("test.queue", false);
        rabbitAdmin.declareQueue(testQueue);
        
        // å‘é€æµ‹è¯•æ¶ˆæ¯
        String message = "Hello RabbitMQ Test";
        rabbitTemplate.convertAndSend("test.queue", message);
        
        // æ¥æ”¶å¹¶éªŒè¯æ¶ˆæ¯
        String received = (String) rabbitTemplate.receiveAndConvert("test.queue");
        assertEquals(message, received);
        
        // æ¸…ç†æµ‹è¯•é˜Ÿåˆ—
        rabbitAdmin.deleteQueue("test.queue");
    }
}
```

**ğŸ” æµ‹è¯•ä»£ç è§£æ**
```
1. @SpringBootTestï¼šå¯åŠ¨å®Œæ•´çš„Spring Bootåº”ç”¨ä¸Šä¸‹æ–‡
2. åˆ›å»ºä¸´æ—¶æµ‹è¯•é˜Ÿåˆ—ï¼Œé¿å…å½±å“å…¶ä»–æµ‹è¯•
3. å‘é€æ¶ˆæ¯å¹¶ç«‹å³æ¥æ”¶éªŒè¯
4. æµ‹è¯•å®Œæˆåæ¸…ç†èµ„æº

å°±åƒåšå®éªŒï¼Œå‡†å¤‡å™¨æâ†’åšå®éªŒâ†’éªŒè¯ç»“æœâ†’æ¸…ç†å™¨æ
```

## 5.4 æ¨¡æ‹Ÿæµ‹è¯•ç¯å¢ƒ



**ğŸ­ ä½¿ç”¨TestContainers**
```java
@SpringBootTest
@Testcontainers
public class RabbitMQContainerTest {
    
    @Container
    static RabbitMQContainer rabbitmq = new RabbitMQContainer("rabbitmq:3.8-management")
            .withUser("test", "test")
            .withVhost("/test");
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.rabbitmq.host", rabbitmq::getHost);
        registry.add("spring.rabbitmq.port", rabbitmq::getAmqpPort);
        registry.add("spring.rabbitmq.username", () -> "test");
        registry.add("spring.rabbitmq.password", () -> "test");
        registry.add("spring.rabbitmq.virtual-host", () -> "/test");
    }
    
    @Test
    public void testWithRealRabbitMQ() {
        // ä½¿ç”¨çœŸå®çš„RabbitMQå®¹å™¨è¿›è¡Œæµ‹è¯•
        assertTrue(rabbitmq.isRunning());
        // ä½ çš„æµ‹è¯•é€»è¾‘...
    }
}
```

**ğŸŒŸ TestContainersçš„ä¼˜åŠ¿**
- âœ… **çœŸå®ç¯å¢ƒ**ï¼šä½¿ç”¨çœŸæ­£çš„RabbitMQï¼Œä¸æ˜¯æ¨¡æ‹Ÿ
- âœ… **éš”ç¦»æ€§**ï¼šæ¯æ¬¡æµ‹è¯•éƒ½æ˜¯ç‹¬ç«‹çš„å®¹å™¨
- âœ… **ä¸€è‡´æ€§**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´

---

# 6. ğŸ† æœ€ä½³å®è·µæ€»ç»“



## 6.1 é…ç½®æœ€ä½³å®è·µ



**ğŸ“‹ ç”Ÿäº§ç¯å¢ƒé…ç½®æ¸…å•**

```yaml
spring:
  rabbitmq:
#    # âœ… å¿…é¡»é…ç½®é¡¹
    host: ${RABBITMQ_HOST}
    username: ${RABBITMQ_USERNAME}  
    password: ${RABBITMQ_PASSWORD}
    virtual-host: /prod
    
#    # âœ… æ€§èƒ½é…ç½®
    cache:
      connection:
        size: 25
      channel:
        size: 50
    
#    # âœ… å¯é æ€§é…ç½®
    publisher-confirm-type: correlated
    publisher-returns: true
    
#    # âœ… æ¶ˆè´¹è€…é…ç½®
    listener:
      simple:
        acknowledge-mode: manual
        retry:
          enabled: true
          max-attempts: 3
```

## 6.2 å¼€å‘å®è·µå»ºè®®



**ğŸ¯ ä»£ç ç»„ç»‡å»ºè®®**
```
é¡¹ç›®ç»“æ„ï¼š
â”œâ”€â”€ config/
â”‚   â””â”€â”€ RabbitMQConfig.java        # RabbitMQé…ç½®ç±»
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ MessageProducer.java       # æ¶ˆæ¯å‘é€æœåŠ¡
â”‚   â””â”€â”€ MessageConsumer.java       # æ¶ˆæ¯æ¶ˆè´¹æœåŠ¡
â”œâ”€â”€ dto/
â”‚   â””â”€â”€ MessageDto.java           # æ¶ˆæ¯æ•°æ®ä¼ è¾“å¯¹è±¡
â””â”€â”€ test/
    â””â”€â”€ RabbitMQIntegrationTest.java # é›†æˆæµ‹è¯•
```

**ğŸ’¡ ç¼–ç å»ºè®®**
- âœ… **é…ç½®é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰RabbitMQé…ç½®æ”¾åœ¨ä¸“é—¨çš„é…ç½®ç±»ä¸­
- âœ… **æ¶ˆæ¯åºåˆ—åŒ–**ï¼šç»Ÿä¸€ä½¿ç”¨JSONæ ¼å¼ï¼Œä¾¿äºè°ƒè¯•å’Œå…¼å®¹æ€§
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… **æ—¥å¿—è®°å½•**ï¼šå…³é”®æ“ä½œéƒ½è¦è®°å½•æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜

## 6.3 ç›‘æ§å‘Šè­¦ç­–ç•¥



**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
```
è¿æ¥å±‚é¢ï¼š
- è¿æ¥æ•°é‡å’ŒçŠ¶æ€
- è¿æ¥å¤±è´¥ç‡
- å¿ƒè·³è¶…æ—¶æ¬¡æ•°

æ¶ˆæ¯å±‚é¢ï¼š
- æ¶ˆæ¯å‘é€æˆåŠŸç‡
- æ¶ˆæ¯æ¶ˆè´¹é€Ÿåº¦
- æ¶ˆæ¯å †ç§¯æ•°é‡
- æ­»ä¿¡æ¶ˆæ¯æ•°é‡

æ€§èƒ½å±‚é¢ï¼š
- å“åº”æ—¶é—´
- ååé‡
- èµ„æºä½¿ç”¨ç‡
```

**ğŸš¨ å‘Šè­¦é˜ˆå€¼å»ºè®®**
- ğŸ”´ **ä¸¥é‡å‘Šè­¦**ï¼šè¿æ¥å¤±è´¥ç‡ > 5%ï¼Œæ¶ˆæ¯å †ç§¯ > 10000
- ğŸŸ¡ **è­¦å‘Šå‘Šè­¦**ï¼šå“åº”æ—¶é—´ > 5ç§’ï¼Œååé‡ä¸‹é™ > 20%
- ğŸ”µ **ä¿¡æ¯å‘Šè­¦**ï¼šè¿æ¥æ•°æ¥è¿‘ä¸Šé™ï¼Œå†…å­˜ä½¿ç”¨ç‡ > 80%

## 6.4 æ•…éšœæ’æŸ¥æŒ‡å—



**ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥æ­¥éª¤**

**ğŸ”¸ è¿æ¥é—®é¢˜**
```
1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§ï¼šping RabbitMQæœåŠ¡å™¨
2. æ£€æŸ¥ç«¯å£å¼€æ”¾ï¼štelnet host 5672
3. æ£€æŸ¥ç”¨æˆ·æƒé™ï¼šç¡®è®¤ç”¨æˆ·åå¯†ç å’Œè™šæ‹Ÿä¸»æœºæƒé™
4. æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼šç¡®è®¤é…ç½®æ— è¯¯
```

**ğŸ”¸ æ¶ˆæ¯ä¸¢å¤±é—®é¢˜**
```
1. æ£€æŸ¥å‘å¸ƒç¡®è®¤ï¼špublisher-confirm-typeæ˜¯å¦å¼€å¯
2. æ£€æŸ¥æ¶ˆæ¯æŒä¹…åŒ–ï¼šé˜Ÿåˆ—å’Œæ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–
3. æ£€æŸ¥ç¡®è®¤æœºåˆ¶ï¼šæ¶ˆè´¹è€…æ˜¯å¦æ­£ç¡®ç¡®è®¤æ¶ˆæ¯
4. æ£€æŸ¥å¼‚å¸¸å¤„ç†ï¼šæ˜¯å¦æœ‰æœªæ•è·çš„å¼‚å¸¸å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±
```

**ğŸ”¸ æ€§èƒ½é—®é¢˜**
```
1. æ£€æŸ¥è¿æ¥æ± é…ç½®ï¼šæ˜¯å¦åˆç†è®¾ç½®äº†è¿æ¥æ•°å’Œé€šé“æ•°
2. æ£€æŸ¥æ¶ˆè´¹è€…å¹¶å‘ï¼šæ˜¯å¦è®¾ç½®äº†åˆé€‚çš„å¹¶å‘æ•°
3. æ£€æŸ¥æ¶ˆæ¯å¤§å°ï¼šæ˜¯å¦æœ‰è¿‡å¤§çš„æ¶ˆæ¯å½±å“æ€§èƒ½
4. æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿï¼šæ˜¯å¦æœ‰ç½‘ç»œç“¶é¢ˆ
```

> ğŸ¯ **æ ¸å¿ƒè®°å¿†**  
> Spring Boot + RabbitMQ = è‡ªåŠ¨é…ç½® + ç®€å•é…ç½® + å¼ºå¤§åŠŸèƒ½ã€‚è®°ä½ä¸‰ä¸ªå…³é”®ï¼šé…ç½®è¦åˆç†ã€ç›‘æ§è¦åˆ°ä½ã€æµ‹è¯•è¦å……åˆ†ã€‚

**ğŸ§  è®°å¿†å£è¯€**
```
Spring Booté›†æˆRabbitMQçœŸç®€å•ï¼Œ
æ·»åŠ ä¾èµ–å†™é…ç½®ï¼Œè‡ªåŠ¨è£…é…å…¨æå®šã€‚
è¿æ¥æ± è¦é…å¥½ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œ
æµ‹è¯•ç¯å¢ƒè¦éš”ç¦»ï¼Œç”Ÿäº§éƒ¨ç½²æ‰å®‰å¿ƒã€‚
```