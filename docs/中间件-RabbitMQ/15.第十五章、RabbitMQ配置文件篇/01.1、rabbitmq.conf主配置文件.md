---
title: 1、rabbitmq.conf主配置文件
---
## 📚 目录

1. [RabbitMQ配置文件概述](#1-RabbitMQ配置文件概述)
2. [主配置文件rabbitmq.conf](#2-主配置文件rabbitmq.conf)
3. [网络监听配置](#3-网络监听配置)
4. [管理界面配置](#4-管理界面配置)
5. [日志系统配置](#5-日志系统配置)
6. [存储与数据库配置](#6-存储与数据库配置)
7. [集群配置参数](#7-集群配置参数)
8. [资源限制配置](#8-资源限制配置)
9. [配置管理最佳实践](#9-配置管理最佳实践)
10. [核心要点总结](#10-核心要点总结)

---

## 1. 🐰 RabbitMQ配置文件概述


### 1.1 什么是RabbitMQ配置文件


**简单理解**：就像给RabbitMQ写一份"工作说明书"，告诉它应该在哪个端口工作、日志写到哪里、能用多少内存等等。

```
🏠 配置文件就像房子的设计图：
┌─────────────────────────────┐
│     RabbitMQ服务器          │
├─────────────────────────────┤
│  📄 rabbitmq.conf          │ ← 主配置文件（房子框架）
│  🔐 enabled_plugins        │ ← 插件配置（功能模块）
│  👥 rabbitmq-env.conf      │ ← 环境变量（基础设施）
│  🗄️  mnesia数据目录        │ ← 数据存储（家具摆放）
└─────────────────────────────┘
```

### 1.2 配置文件的重要性


**为什么需要配置文件？**
就像你搬进新房子要告诉快递员地址一样，RabbitMQ也需要知道自己的"工作地址"和"工作方式"。

```
🎯 配置文件解决的问题：

没有配置 = 使用默认设置：
❌ 可能端口冲突
❌ 日志位置不合适  
❌ 内存限制不合理
❌ 安全设置不够

有了配置 = 量身定制：
✅ 端口按需设置
✅ 日志集中管理
✅ 资源合理分配
✅ 安全策略到位
```

### 1.3 配置文件的位置


**🗂️ 配置文件在哪里？**

不同操作系统的配置文件位置：

| 操作系统 | **配置目录** | **说明** |
|---------|-------------|----------|
| **Linux** | `/etc/rabbitmq/` | `系统级配置目录` |
| **macOS** | `/usr/local/etc/rabbitmq/` | `Homebrew安装路径` |
| **Windows** | `%APPDATA%\RabbitMQ\` | `用户配置目录` |
| **Docker** | `/etc/rabbitmq/` | `容器内配置路径` |

**🔍 如何找到配置文件？**
```bash
# 查看RabbitMQ配置目录
sudo rabbitmq-diagnostics environment | grep config

# 检查当前配置文件位置
sudo rabbitmq-diagnostics status | grep -A5 "Config files"
```

---

## 2. 📄 主配置文件rabbitmq.conf


### 2.1 配置文件基本结构


**rabbitmq.conf文件格式**：
这个文件使用简单的"键=值"格式，就像填表格一样简单！

```ini
# 这是注释，以#开头，用来解释配置
# 格式：配置项 = 配置值

# 基本监听端口
listeners.tcp.default = 5672

# 管理界面端口  
management.tcp.port = 15672

# 日志级别
log.file.level = info
```

**💡 配置文件语法规则**：
```
语法特点：
✅ 一行一个配置项
✅ 用等号连接键和值
✅ #号开头表示注释
✅ 大小写敏感
✅ 空行会被忽略

示例格式：
参数名称 = 参数值
# 注释说明
```

### 2.2 创建和编辑配置文件


**🛠️ 创建配置文件步骤**：

如果你的系统还没有配置文件，需要手动创建：

```bash
# 第一步：确保配置目录存在
sudo mkdir -p /etc/rabbitmq

# 第二步：创建主配置文件
sudo touch /etc/rabbitmq/rabbitmq.conf

# 第三步：设置正确的文件权限
sudo chown rabbitmq:rabbitmq /etc/rabbitmq/rabbitmq.conf
sudo chmod 644 /etc/rabbitmq/rabbitmq.conf
```

**✏️ 编辑配置文件**：
```bash
# 使用你熟悉的编辑器
sudo nano /etc/rabbitmq/rabbitmq.conf
# 或者
sudo vim /etc/rabbitmq/rabbitmq.conf
```

### 2.3 配置生效机制


**🔄 配置如何生效？**

```
配置生效流程：
修改配置文件 → 重启RabbitMQ → 配置生效

┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  修改配置    │───▶│  重启服务    │───▶│  配置生效    │
│  文件       │    │  rabbitmq   │    │            │
└─────────────┘    └─────────────┘    └─────────────┘

重启命令：
sudo systemctl restart rabbitmq-server
```

**⚠️ 配置注意事项**：
```
重要提醒：
🔴 修改配置后必须重启服务才能生效
🟡 重启服务会断开所有客户端连接
🟢 建议在维护窗口期间修改配置
🔵 修改前最好备份原配置文件
```

---

## 3. 🌐 网络监听配置


### 3.1 TCP监听端口配置


**什么是监听端口？**
就像给RabbitMQ安装了"电话号码"，客户端通过这个号码来联系RabbitMQ。

**🔌 基本端口配置**：

```ini
# TCP监听端口（客户端连接用）
listeners.tcp.default = 5672

# 监听所有网卡接口
listeners.tcp.1 = 0.0.0.0:5672

# 只监听本地接口（更安全）
listeners.tcp.1 = 127.0.0.1:5672

# 监听指定IP地址
listeners.tcp.1 = 192.168.1.100:5672
```

**📡 多端口监听配置**：
```ini
# 同时监听多个端口
listeners.tcp.1 = 5672
listeners.tcp.2 = 5673
listeners.tcp.3 = 192.168.1.100:5674

# 为什么要多端口？
# 不同应用使用不同端口
# 内网和外网分别监听
# 负载均衡和故障切换
```

### 3.2 SSL/TLS加密连接


**🔐 为什么需要SSL？**
就像给邮件加密一样，SSL确保数据传输过程中不被窃听或篡改。

```ini
# 启用SSL监听
listeners.ssl.default = 5671

# SSL证书配置
ssl_options.certfile = /path/to/server_certificate.pem
ssl_options.keyfile = /path/to/server_key.pem
ssl_options.cacertfile = /path/to/ca_certificate.pem

# SSL验证模式
ssl_options.verify = verify_peer
ssl_options.fail_if_no_peer_cert = true
```

**🛡️ SSL安全等级**：
```
SSL配置安全等级：

基础级别：只加密传输
ssl_options.verify = verify_none

中等级别：验证服务器证书  
ssl_options.verify = verify_peer
ssl_options.fail_if_no_peer_cert = false

高等级别：双向证书验证
ssl_options.verify = verify_peer  
ssl_options.fail_if_no_peer_cert = true
```

### 3.3 网络性能优化


**⚡ 网络性能调优**：
```ini
# TCP缓冲区大小（影响吞吐量）
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true

# 连接超时设置
tcp_listen_options.keepalive = true

# 最大连接数限制
num_acceptors.tcp = 10
```

**💡 性能配置解释**：
```
性能参数说明：

backlog = 128
含义：等待连接队列长度
影响：高并发连接建立速度

nodelay = true  
含义：禁用Nagle算法
影响：降低延迟，提高响应速度

keepalive = true
含义：启用TCP保活机制
影响：及时发现断开的连接
```

---

## 4. 🖥️ 管理界面配置


### 4.1 管理界面基本配置


**什么是管理界面？**
就像给RabbitMQ装了一个"仪表盘"，你可以通过网页看到队列状态、消息数量等信息，还能进行各种管理操作。

```ini
# 管理界面端口
management.tcp.port = 15672

# 管理界面监听地址
management.tcp.ip = 0.0.0.0

# 启用管理界面（需要启用management插件）
# sudo rabbitmq-plugins enable rabbitmq_management
```

**🌐 访问管理界面**：
```
访问地址：http://服务器IP:15672

默认登录账号：
用户名：guest
密码：guest

⚠️ 安全提醒：
guest用户只能从localhost访问
生产环境必须创建新的管理员用户
```

### 4.2 管理界面安全配置


**🔒 生产环境安全设置**：

```bash
# 创建管理员用户
sudo rabbitmqctl add_user admin your_strong_password

# 设置用户为管理员
sudo rabbitmqctl set_user_tags admin administrator

# 设置用户权限
sudo rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"

# 删除默认guest用户（可选）
sudo rabbitmqctl delete_user guest
```

**🛡️ 访问控制配置**：
```ini
# 限制管理界面访问IP
management.tcp.ip = 192.168.1.100

# 禁用guest用户远程访问
loopback_users.guest = true

# 管理界面超时设置
management.http_log_dir = /var/log/rabbitmq/management
management.rates_mode = basic
```

### 4.3 管理界面功能介绍


**📊 管理界面主要功能**：

```
🏠 Overview（概览）：
- 服务器整体状态
- 消息速率统计  
- 节点信息

📬 Queues（队列）：
- 查看所有队列
- 消息数量统计
- 消费者信息

🔄 Exchanges（交换器）：
- 交换器列表
- 路由规则
- 绑定关系

👥 Admin（管理）：
- 用户管理
- 虚拟主机管理
- 权限设置
```

**💻 使用管理界面的好处**：
```
可视化监控：
✅ 实时查看消息队列状态
✅ 监控消息处理速度
✅ 观察消费者连接情况

便捷管理：
✅ 图形化创建队列和交换器
✅ 在线测试消息发送接收
✅ 快速排查问题

性能分析：
✅ 查看历史统计数据
✅ 分析系统瓶颈
✅ 优化配置参数
```

---

## 5. 📝 日志系统配置


### 5.1 日志级别配置


**日志级别是什么？**
就像汽车的仪表盘有不同的指示灯一样，日志级别决定RabbitMQ记录多详细的运行信息。

```ini
# 文件日志级别
log.file.level = info

# 控制台日志级别
log.console.level = info
```

**📊 日志级别详解**：

| 级别 | **详细程度** | **包含内容** | **适用场景** |
|------|-------------|-------------|-------------|
| **debug** | `最详细` | `所有调试信息` | `开发调试` |
| **info** | `中等` | `一般运行信息` | `生产监控` |
| **warning** | `较少` | `警告和错误` | `问题排查` |
| **error** | `最少` | `只记录错误` | `关键监控` |

**🎯 如何选择日志级别？**
```
开发环境：debug
- 需要详细的调试信息
- 磁盘空间充足
- 性能要求不高

生产环境：info  
- 平衡信息量和性能
- 记录重要操作
- 便于问题排查

监控环境：warning
- 只关注异常情况
- 减少日志量
- 节省存储空间
```

### 5.2 日志文件配置


**📁 日志文件位置设置**：

```ini
# 日志文件目录
log.dir = /var/log/rabbitmq

# 日志文件名前缀
log.file = rabbit

# 完整日志文件路径示例：
# /var/log/rabbitmq/rabbit@hostname.log
```

**🔄 日志轮转配置**：
```ini
# 启用日志轮转
log.file.rotation.date = $D0

# 日志文件最大大小
log.file.rotation.size = 10485760

# 保留日志文件数量
log.file.rotation.count = 5
```

**💡 日志轮转说明**：
```
轮转策略解释：

$D0 = 每天轮转
- 每天生成新的日志文件
- 旧文件自动重命名

size = 10485760 (10MB)
- 文件超过10MB时轮转
- 防止单个文件过大

count = 5
- 最多保留5个历史文件
- 超过数量的自动删除
```

### 5.3 日志格式配置


**📋 日志输出格式**：
```ini
# 日志格式设置
log.file.formatter = plaintext

# 时间戳格式
log.file.formatter.time_format = %Y-%m-%d %H:%M:%S

# 包含详细信息
log.file.formatter.use_colors = false
```

**🔍 日志内容示例**：
```
2024-09-20 15:30:25.123 [info] <0.123.0> Starting RabbitMQ 3.12.0
2024-09-20 15:30:25.456 [info] <0.124.0> Memory high watermark set to 1.6GB
2024-09-20 15:30:25.789 [info] <0.125.0> Disk free limit set to 50MB
```

---

## 6. 🗄️ 存储与数据库配置


### 6.1 数据存储目录


**Mnesia数据库是什么？**
Mnesia是RabbitMQ用来存储所有重要信息的"档案柜"，包括队列定义、用户信息、消息等。

```ini
# 数据库基础目录
mnesia_base = /var/lib/rabbitmq/mnesia

# 完整路径示例：
# /var/lib/rabbitmq/mnesia/rabbit@hostname/
```

**📂 数据目录结构**：
```
数据目录内容：
/var/lib/rabbitmq/mnesia/rabbit@hostname/
├── DECISION_TAB.LOG     # 决策日志
├── LATEST.LOG          # 最新日志
├── schema.DAT          # 数据库模式
├── rabbit_user.DCD     # 用户数据
├── rabbit_vhost.DCD    # 虚拟主机数据
└── rabbit_queue.DCD    # 队列数据
```

### 6.2 数据库性能配置


**⚡ 数据库调优参数**：
```ini
# 数据库同步频率
mnesia_table_loading_retry_timeout = 30000

# 数据库日志限制
mnesia_table_loading_retry_limit = 10

# 事务日志大小
log_levels.mnesia = info
```

**💾 存储性能优化建议**：
```
存储优化策略：

SSD硬盘：
✅ 提升数据库读写速度
✅ 减少消息持久化延迟
✅ 改善整体响应性能

分离存储：
✅ 数据目录放在独立磁盘
✅ 日志目录分开存储
✅ 避免IO竞争

定期备份：
✅ 定期备份mnesia目录
✅ 测试恢复流程
✅ 制定灾难恢复计划
```

### 6.3 消息持久化配置


**💌 消息持久化机制**：
```ini
# 消息存储目录
msg_store_file_size_limit = 16777216

# 消息索引嵌入阈值
queue_index_embed_msgs_below = 4096

# 持久化消息批量大小
msg_store_credit_disc_bound = 4000
```

**🔄 持久化工作原理**：
```
消息持久化流程：

生产者发送持久化消息
        ↓
写入消息存储文件(.rdq)
        ↓  
更新消息索引(.idx)
        ↓
确认消息已保存
        ↓
向生产者发送确认

好处：
✅ 服务器重启后消息不丢失
✅ 提供数据安全保障
✅ 支持事务性操作
```

---

## 7. 🔗 集群配置参数


### 7.1 集群发现机制


**什么是集群？**
就像建立一个"RabbitMQ联盟"，多台服务器协同工作，提供更高的可用性和性能。

```ini
# 集群发现方式
cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config

# 手动指定集群节点
cluster_formation.classic_config.nodes.1 = rabbit@node1
cluster_formation.classic_config.nodes.2 = rabbit@node2
cluster_formation.classic_config.nodes.3 = rabbit@node3
```

**🔍 集群发现方式对比**：

| 发现方式 | **适用场景** | **配置复杂度** | **自动化程度** |
|---------|-------------|---------------|---------------|
| **手动配置** | `小型集群` | `简单` | `低` |
| **DNS发现** | `云环境` | `中等` | `中` |
| **AWS发现** | `AWS云` | `中等` | `高` |
| **K8s发现** | `Kubernetes` | `复杂` | `高` |

### 7.2 集群名称和标识


**🏷️ 集群命名配置**：
```ini
# 集群名称
cluster_name = production-rabbitmq

# 节点名称（通常自动生成）
# 格式：rabbit@hostname
```

**💡 集群命名建议**：
```
命名规范：
✅ 使用有意义的名称（如：prod-rabbitmq）
✅ 包含环境标识（如：dev、test、prod）
✅ 避免特殊字符和空格
✅ 保持简洁明了

示例：
开发环境：dev-rabbitmq-cluster
测试环境：test-rabbitmq-cluster  
生产环境：prod-rabbitmq-cluster
```

### 7.3 集群网络配置


**🌐 集群通信配置**：
```ini
# 集群通信端口
cluster_formation.node_cleanup.interval = 30
cluster_formation.node_cleanup.only_log_warning = true

# 网络分区处理策略
cluster_partition_handling = ignore
```

**⚠️ 网络分区处理策略**：
```
分区策略选择：

ignore（默认）：
- 忽略网络分区
- 简单但可能导致数据不一致

pause_minority：
- 少数节点暂停工作
- 保证数据一致性

autoheal：
- 自动修复分区
- 可能丢失部分数据

选择建议：
小型集群：ignore
大型集群：pause_minority
```

---

## 8. ⚖️ 资源限制配置


### 8.1 内存使用控制


**🧠 内存水位阈值**：
内存水位就像水库的警戒线，当内存使用超过这个线时，RabbitMQ会采取保护措施。

```ini
# 内存高水位阈值（相对值）
vm_memory_high_watermark.relative = 0.4

# 内存高水位阈值（绝对值）
vm_memory_high_watermark.absolute = 1024MB
```

**📊 内存阈值设置建议**：
```
内存配置策略：

小内存服务器（<4GB）：
vm_memory_high_watermark.relative = 0.3
- 预留更多内存给操作系统

中等内存服务器（4-16GB）：
vm_memory_high_watermark.relative = 0.4  
- 平衡性能和稳定性

大内存服务器（>16GB）：
vm_memory_high_watermark.relative = 0.6
- 充分利用内存资源
```

**🚨 内存保护机制**：
```
内存超限时的保护措施：

第一阶段：触发内存警告
- 记录警告日志
- 开始监控内存使用

第二阶段：阻止新消息接收  
- 拒绝接收新消息
- 保护现有消息处理

第三阶段：强制消息分页
- 将消息写入磁盘
- 释放内存空间
```

### 8.2 磁盘空间限制


**💾 磁盘空间保护**：
```ini
# 磁盘可用空间最低限制（绝对值）
disk_free_limit.absolute = 50MB

# 磁盘可用空间最低限制（相对值）
disk_free_limit.relative = 1.0
```

**🔧 磁盘限制配置解释**：
```
磁盘空间设置：

绝对值设置：
disk_free_limit.absolute = 2GB
- 至少保留2GB可用空间
- 适合固定大小的应用

相对值设置：
disk_free_limit.relative = 1.0  
- 保留1倍RAM大小的磁盘空间
- 适合动态环境

推荐设置：
生产环境：2GB或1.0倍RAM（取较大值）
开发环境：500MB或0.5倍RAM
```

### 8.3 连接和通道限制


**🔌 连接数限制**：
```ini
# 最大并发连接数
num_acceptors.tcp = 10

# 每个连接的最大通道数
channel_max = 2047

# 连接超时设置
heartbeat = 60
```

**📈 资源限制建议**：
```
连接规划：

小型应用（<100连接）：
num_acceptors.tcp = 5
channel_max = 1000

中型应用（100-1000连接）：
num_acceptors.tcp = 10  
channel_max = 2047

大型应用（>1000连接）：
num_acceptors.tcp = 20
channel_max = 2047
考虑集群部署
```

---

## 9. 🛠️ 配置管理最佳实践


### 9.1 配置文件版本管理


**📚 配置版本控制策略**：

```bash
# 创建配置备份
sudo cp /etc/rabbitmq/rabbitmq.conf /etc/rabbitmq/rabbitmq.conf.backup.$(date +%Y%m%d)

# 使用Git管理配置
cd /etc/rabbitmq
sudo git init
sudo git add .
sudo git commit -m "Initial RabbitMQ configuration"
```

**🔄 配置变更流程**：
```
配置管理流程：

1. 备份当前配置
   └── 防止配置错误时快速恢复

2. 在测试环境验证
   └── 确保配置正确有效

3. 制定回滚计划
   └── 准备出现问题时的应对方案

4. 在维护窗口应用
   └── 减少对业务的影响

5. 验证配置生效
   └── 确认服务正常运行
```

### 9.2 环境配置分离


**🏗️ 多环境配置管理**：
```bash
# 开发环境配置
/etc/rabbitmq/rabbitmq-dev.conf

# 测试环境配置  
/etc/rabbitmq/rabbitmq-test.conf

# 生产环境配置
/etc/rabbitmq/rabbitmq-prod.conf

# 使用符号链接切换环境
sudo ln -sf rabbitmq-prod.conf rabbitmq.conf
```

**⚙️ 配置模板化**：
```ini
# 配置模板示例
# 监听端口
listeners.tcp.default = ${RABBITMQ_PORT:-5672}

# 管理界面端口
management.tcp.port = ${MANAGEMENT_PORT:-15672}

# 内存限制
vm_memory_high_watermark.relative = ${MEMORY_THRESHOLD:-0.4}

# 日志级别
log.file.level = ${LOG_LEVEL:-info}
```

### 9.3 配置验证和测试


**✅ 配置验证步骤**：
```bash
# 检查配置文件语法
sudo rabbitmq-diagnostics check_config_schema

# 验证配置参数
sudo rabbitmq-diagnostics environment

# 测试连接配置
sudo rabbitmq-diagnostics check_port_connectivity

# 检查集群状态
sudo rabbitmq-diagnostics cluster_status
```

**🧪 配置测试清单**：
```
配置测试项目：

✅ 服务启动测试
- RabbitMQ服务正常启动
- 无错误日志产生

✅ 网络连接测试  
- 客户端能正常连接
- 管理界面可访问

✅ 功能验证测试
- 消息发送接收正常
- 队列创建和删除正常

✅ 性能基准测试
- 内存使用在合理范围
- 响应时间符合预期

✅ 故障恢复测试
- 服务重启后配置保持
- 数据完整性验证
```

---

## 10. 📋 核心要点总结


### 10.1 必须掌握的配置项


```
🔸 网络配置：listeners.tcp.default（监听端口）
🔸 管理界面：management.tcp.port（管理端口）
🔸 日志配置：log.file.level（日志级别）
🔸 存储配置：mnesia_base（数据目录）
🔸 集群配置：cluster_name（集群名称）
🔸 资源限制：vm_memory_high_watermark（内存限制）
🔸 磁盘限制：disk_free_limit（磁盘空间限制）
```

### 10.2 配置优先级理解


**⚖️ 从重要到次要的配置顺序**：
```
1. 网络监听配置 ⭐⭐⭐⭐⭐
   - 决定服务是否可访问
   - 影响所有功能

2. 资源限制配置 ⭐⭐⭐⭐☆
   - 保护系统稳定性
   - 防止资源耗尽

3. 日志配置 ⭐⭐⭐☆☆
   - 问题排查必需
   - 运维监控基础

4. 存储配置 ⭐⭐⭐☆☆
   - 数据持久化
   - 性能优化

5. 集群配置 ⭐⭐☆☆☆
   - 高可用需求
   - 复杂环境应用
```

### 10.3 常见配置问题


**❓ 新手常见错误**：
```
端口冲突问题：
问题：RabbitMQ启动失败
原因：端口被其他程序占用
解决：检查端口占用，修改配置端口

权限问题：
问题：无法写入日志文件
原因：目录权限不正确
解决：设置正确的文件和目录权限

内存设置过高：
问题：系统内存不足
原因：内存阈值设置超过实际可用内存
解决：降低内存水位阈值

配置语法错误：
问题：服务启动失败
原因：配置文件格式错误
解决：检查语法，使用配置验证工具
```

### 10.4 生产环境建议


**🏭 生产环境配置清单**：
```
安全配置：
✅ 更改默认端口
✅ 启用SSL/TLS加密
✅ 删除默认用户
✅ 设置强密码策略

性能配置：
✅ 合理设置内存阈值
✅ 配置日志轮转
✅ 优化磁盘IO
✅ 调整网络参数

监控配置：
✅ 启用管理界面
✅ 配置详细日志
✅ 设置告警阈值
✅ 集成监控系统

备份配置：
✅ 定期备份配置文件
✅ 备份数据目录
✅ 测试恢复流程
✅ 制定应急预案
```

### 10.5 学习建议


**📚 配置学习路径**：
```
第一阶段：基础配置
• 掌握主要配置项的含义
• 学会修改基本参数
• 了解配置生效机制

第二阶段：性能调优
• 理解资源限制的作用
• 学会根据业务需求调整参数
• 掌握问题排查方法

第三阶段：集群配置
• 了解集群配置原理
• 掌握多环境管理
• 学会自动化配置部署

实践建议：
• 在测试环境多做实验
• 记录每次配置变更的效果
• 建立配置模板库
• 关注官方文档更新
```

**🧠 记忆要点**：
- 配置文件是RabbitMQ的"身份证"，决定了它的工作方式
- 网络监听和资源限制是最关键的配置项
- 修改配置后必须重启服务才能生效
- 生产环境要做好配置备份和版本管理
- 通过管理界面可以实时监控配置效果

**核心理念**：配置不是一成不变的，要根据实际业务需求和系统负载情况持续优化调整！