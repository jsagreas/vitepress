---
title: 4ã€æ¶ˆæ¯æ¶æ„æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [æ¶ˆæ¯æ¶æ„æ¨¡å¼æ¦‚è¿°](#1-æ¶ˆæ¯æ¶æ„æ¨¡å¼æ¦‚è¿°)
2. [äº‹ä»¶æº¯æºæ¨¡å¼è¯¦è§£](#2-äº‹ä»¶æº¯æºæ¨¡å¼è¯¦è§£)
3. [CQRSæ¶æ„æ¨¡å¼](#3-CQRSæ¶æ„æ¨¡å¼)
4. [å‘ä»¶ç®±æ¨¡å¼](#4-å‘ä»¶ç®±æ¨¡å¼)
5. [æ”¶ä»¶ç®±æ¨¡å¼](#5-æ”¶ä»¶ç®±æ¨¡å¼)
6. [è¡¥å¿äº‹åŠ¡æ¨¡å¼](#6-è¡¥å¿äº‹åŠ¡æ¨¡å¼)
7. [æ¨¡å¼é€‰æ‹©ä¸ç»„åˆåº”ç”¨](#7-æ¨¡å¼é€‰æ‹©ä¸ç»„åˆåº”ç”¨)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ æ¶ˆæ¯æ¶æ„æ¨¡å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¶æ„æ¨¡å¼


**ğŸ’¡ ç®€å•ç†è§£**ï¼šå°±åƒå»ºæˆ¿å­æœ‰ä¸åŒçš„è®¾è®¡å›¾çº¸ä¸€æ ·ï¼Œæ¶ˆæ¯ç³»ç»Ÿä¹Ÿæœ‰ä¸åŒçš„æ¶æ„æ¨¡å¼

```
ä¼ ç»Ÿç³»ç»Ÿçš„é—®é¢˜ï¼š
ç”¨æˆ·ä¸‹å• â†’ ç›´æ¥è°ƒç”¨åº“å­˜ â†’ ç›´æ¥è°ƒç”¨æ”¯ä»˜ â†’ ç›´æ¥è°ƒç”¨ç‰©æµ
é—®é¢˜ï¼šä¸€ä¸ªç¯èŠ‚å‡ºé”™ï¼Œæ•´ä¸ªæµç¨‹å¡ä½

æ¶ˆæ¯æ¶æ„çš„è§£å†³æ–¹æ¡ˆï¼š
ç”¨æˆ·ä¸‹å• â†’ å‘é€æ¶ˆæ¯ â†’ å„æœåŠ¡å¼‚æ­¥å¤„ç†
ä¼˜åŠ¿ï¼šè§£è€¦ã€å®¹é”™ã€å¯æ‰©å±•
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›æ¨¡å¼


**ğŸ¯ æ ¸å¿ƒè§£å†³çš„é—®é¢˜**ï¼š
- **ç³»ç»Ÿè€¦åˆ**ï¼šæœåŠ¡é—´ç›´æ¥è°ƒç”¨ï¼Œä¸€ä¸ªæŒ‚äº†å…¨æŒ‚
- **æ•°æ®ä¸€è‡´æ€§**ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚ä½•ä¿è¯æ•°æ®æ­£ç¡®
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šåŒæ­¥å¤„ç†é€Ÿåº¦æ…¢ï¼Œç”¨æˆ·ä½“éªŒå·®
- **æ•…éšœæ¢å¤**ï¼šå‡ºé”™åå¦‚ä½•å¿«é€Ÿæ¢å¤å’Œè¡¥å¿

**âœ¨ æ¶æ„æ¨¡å¼çš„ä»·å€¼**ï¼š
```
è§£è€¦åˆï¼šæœåŠ¡ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å½±å“
ææ€§èƒ½ï¼šå¼‚æ­¥å¤„ç†ï¼Œå“åº”æ›´å¿«
ä¿ä¸€è‡´ï¼šé€šè¿‡æ¶ˆæ¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§
æ˜“æ‰©å±•ï¼šæ–°åŠŸèƒ½é€šè¿‡æ¶ˆæ¯è½»æ¾é›†æˆ
```

### 1.3 äº”å¤§æ ¸å¿ƒæ¨¡å¼å¯¹æ¯”


| æ¨¡å¼åç§° | **ä¸»è¦ä½œç”¨** | **é€‚ç”¨åœºæ™¯** | **å¤æ‚åº¦** |
|---------|------------|-------------|-----------|
| ğŸ—‚ï¸ **äº‹ä»¶æº¯æº** | `è®°å½•æ‰€æœ‰å˜åŒ–äº‹ä»¶` | `éœ€è¦å®Œæ•´å†å²è®°å½•` | â­â­â­â­ |
| ğŸ”„ **CQRS** | `è¯»å†™åˆ†ç¦»ä¼˜åŒ–` | `è¯»å†™é¢‘ç‡å·®å¼‚å¤§` | â­â­â­ |
| ğŸ“¤ **å‘ä»¶ç®±** | `ä¿è¯æ¶ˆæ¯å¿…è¾¾` | `äº‹åŠ¡æ€§æ¶ˆæ¯å‘é€` | â­â­ |
| ğŸ“¥ **æ”¶ä»¶ç®±** | `é˜²é‡å¤å¤„ç†` | `æ¶ˆæ¯å»é‡åœºæ™¯` | â­â­ |
| ğŸ”§ **è¡¥å¿äº‹åŠ¡** | `åˆ†å¸ƒå¼äº‹åŠ¡å›æ»š` | `é•¿æµç¨‹äº‹åŠ¡å¤„ç†` | â­â­â­â­ |

---

## 2. ğŸ—‚ï¸ äº‹ä»¶æº¯æºæ¨¡å¼è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯äº‹ä»¶æº¯æº


**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒé“¶è¡Œè´¦æˆ·æµæ°´ï¼Œä¸ç›´æ¥è®°å½•ä½™é¢ï¼Œè€Œæ˜¯è®°å½•æ¯ä¸€ç¬”æ”¶å…¥æ”¯å‡º

```
ä¼ ç»Ÿæ–¹å¼è®°å½•è´¦æˆ·ï¼š
ç”¨æˆ·ä½™é¢ï¼š1000å…ƒ (åªçŸ¥é“ç»“æœï¼Œä¸çŸ¥é“è¿‡ç¨‹)

äº‹ä»¶æº¯æºæ–¹å¼ï¼š
äº‹ä»¶1ï¼šå¼€æˆ· +1000å…ƒ
äº‹ä»¶2ï¼šè´­ç‰© -200å…ƒ  
äº‹ä»¶3ï¼šè½¬è´¦ +500å…ƒ
äº‹ä»¶4ï¼šæç° -100å…ƒ
å½“å‰ä½™é¢ = 1000-200+500-100 = 1200å…ƒ
```

### 2.2 äº‹ä»¶æº¯æºçš„å·¥ä½œåŸç†


**ğŸ”„ æ ¸å¿ƒæµç¨‹å›¾ç¤º**ï¼š
```
ä¸šåŠ¡æ“ä½œ               äº‹ä»¶å­˜å‚¨               çŠ¶æ€é‡å»º
   |                     |                     |
ç”¨æˆ·ä¸‹å• â”€â”€â”€â”€â”€â†’ OrderCreatedäº‹ä»¶ â”€â”€â”€â”€â”€â†’ è®¢å•çŠ¶æ€ï¼šå·²åˆ›å»º
   |                     |                     |
æ”¯ä»˜æˆåŠŸ â”€â”€â”€â”€â”€â†’ OrderPaidäº‹ä»¶   â”€â”€â”€â”€â”€â†’ è®¢å•çŠ¶æ€ï¼šå·²æ”¯ä»˜
   |                     |                     |
å•†å“å‘è´§ â”€â”€â”€â”€â”€â†’ OrderShippedäº‹ä»¶ â”€â”€â”€â”€â†’ è®¢å•çŠ¶æ€ï¼šå·²å‘è´§
```

**ğŸ› ï¸ RabbitMQå®ç°ç¤ºä¾‹**ï¼š
```java
// äº‹ä»¶å‘å¸ƒå™¨
@Component
public class OrderEventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
    public void publishOrderCreated(OrderCreatedEvent event) {
        rabbitTemplate.convertAndSend(
            "order.events.exchange", 
            "order.created", 
            event
        );
    }
    
    // å‘å¸ƒæ”¯ä»˜å®Œæˆäº‹ä»¶
    public void publishOrderPaid(OrderPaidEvent event) {
        rabbitTemplate.convertAndSend(
            "order.events.exchange", 
            "order.paid", 
            event
        );
    }
}

// äº‹ä»¶å­˜å‚¨
@Entity
public class EventStore {
    private String eventId;
    private String aggregateId;  // èšåˆæ ¹IDï¼ˆå¦‚è®¢å•IDï¼‰
    private String eventType;    // äº‹ä»¶ç±»å‹
    private String eventData;    // äº‹ä»¶æ•°æ®
    private LocalDateTime timestamp;
}
```

### 2.3 äº‹ä»¶æº¯æºçš„ä¼˜åŠ¿ä¸æŒ‘æˆ˜


**âœ… ä¸»è¦ä¼˜åŠ¿**ï¼š
- **å®Œæ•´å†å²**ï¼šæ‰€æœ‰å˜åŒ–éƒ½æœ‰è®°å½•ï¼Œä¾¿äºå®¡è®¡
- **æ—¶é—´æ—…è¡Œ**ï¼šå¯ä»¥é‡å»ºä»»æ„æ—¶é—´ç‚¹çš„çŠ¶æ€
- **è°ƒè¯•å‹å¥½**ï¼šå‡ºé—®é¢˜æ—¶èƒ½è¿½è¸ªå®Œæ•´è¿‡ç¨‹
- **ä¸šåŠ¡æ´å¯Ÿ**ï¼šåˆ†æå†å²æ•°æ®å‘ç°ä¸šåŠ¡è§„å¾‹

**âš ï¸ é¢ä¸´æŒ‘æˆ˜**ï¼š
- **å­˜å‚¨å¼€é”€**ï¼šäº‹ä»¶æ•°æ®è¶Šæ¥è¶Šå¤š
- **æŸ¥è¯¢å¤æ‚**ï¼šéœ€è¦é‡æ”¾äº‹ä»¶æ‰èƒ½å¾—åˆ°å½“å‰çŠ¶æ€
- **äº‹ä»¶æ¼”åŒ–**ï¼šä¸šåŠ¡å˜åŒ–æ—¶å¦‚ä½•å¤„ç†è€äº‹ä»¶

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šäº‹ä»¶æº¯æºé€‚åˆå¯¹å†å²è®°å½•è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚é‡‘èç³»ç»Ÿã€å®¡è®¡ç³»ç»Ÿç­‰

---

## 3. ğŸ”„ CQRSæ¶æ„æ¨¡å¼


### 3.1 ä»€ä¹ˆæ˜¯CQRS


**ğŸ’¡ ç®€å•ç†è§£**ï¼šCQRSå°±æ˜¯è¯»å†™åˆ†ç¦»ï¼Œå†™æ“ä½œç”¨ä¸€å¥—æ–¹æ¡ˆï¼Œè¯»æ“ä½œç”¨å¦ä¸€å¥—æ–¹æ¡ˆ

```
CQRSå…¨ç§°ï¼šCommand Query Responsibility Segregation
ä¸­æ–‡ï¼šå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»

ä¼ ç»Ÿæ–¹å¼ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åŒä¸€ä¸ªæ•°æ®åº“ â†’ è¿”å›ç»“æœ
é—®é¢˜ï¼šè¯»å†™å†²çªï¼Œæ€§èƒ½ç“¶é¢ˆ

CQRSæ–¹å¼ï¼š
å†™æ“ä½œ â†’ å†™æ•°æ®åº“ â†’ å‘æ¶ˆæ¯ â†’ æ›´æ–°è¯»æ•°æ®åº“
è¯»æ“ä½œ â†’ ç›´æ¥ä»è¯»æ•°æ®åº“è·å–
ä¼˜åŠ¿ï¼šè¯»å†™ç‹¬ç«‹ä¼˜åŒ–
```

### 3.2 CQRSä¸RabbitMQçš„å®Œç¾ç»“åˆ


**ğŸ”— æ¶æ„æµç¨‹å›¾**ï¼š
```
Command Side (å†™ç«¯)          Message Bus          Query Side (è¯»ç«¯)
     |                         |                        |
[ç”¨æˆ·ä¸‹å•] â”€â”€â”€â”€â†’ [OrderService] â”€â”€â†’ [RabbitMQ] â”€â”€â†’ [ReadModelUpdater]
     |                         |                        |
[å†™å…¥äº‹åŠ¡DB] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 [æ›´æ–°æŸ¥è¯¢DB] â†â”€â”€â”˜
     |                                                   |
[PostgreSQL]                                      [MongoDB/Redis]
```

**ğŸ› ï¸ å®ç°ç¤ºä¾‹**ï¼š
```java
// å‘½ä»¤ç«¯ï¼šå¤„ç†å†™æ“ä½œ
@RestController
public class OrderCommandController {
    
    @Autowired
    private OrderCommandService orderService;
    
    @PostMapping("/orders")
    public ResponseEntity createOrder(@RequestBody CreateOrderCommand cmd) {
        // 1. æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå†™å…¥äº‹åŠ¡æ•°æ®åº“
        Order order = orderService.createOrder(cmd);
        
        // 2. å‘é€äº‹ä»¶åˆ°RabbitMQ
        OrderCreatedEvent event = new OrderCreatedEvent(order);
        rabbitTemplate.convertAndSend("order.events", "order.created", event);
        
        return ResponseEntity.ok(order.getId());
    }
}

// æŸ¥è¯¢ç«¯ï¼šå¤„ç†è¯»æ“ä½œ
@RestController  
public class OrderQueryController {
    
    @Autowired
    private OrderQueryService queryService;
    
    @GetMapping("/orders/{id}")
    public OrderView getOrder(@PathVariable String id) {
        // ç›´æ¥ä»è¯»å–ä¸“ç”¨çš„æ•°æ®åº“è·å–
        return queryService.getOrderView(id);
    }
}

// è¯»æ¨¡å‹æ›´æ–°å™¨ï¼šç›‘å¬æ¶ˆæ¯æ›´æ–°æŸ¥è¯¢æ•°æ®åº“
@RabbitListener(queues = "order.query.update.queue")
public class OrderReadModelUpdater {
    
    @Autowired
    private OrderViewRepository viewRepository;
    
    public void handle(OrderCreatedEvent event) {
        // æ ¹æ®äº‹ä»¶æ›´æ–°æŸ¥è¯¢ä¸“ç”¨çš„æ•°æ®ç»“æ„
        OrderView view = new OrderView();
        view.setOrderId(event.getOrderId());
        view.setCustomerName(event.getCustomerName());
        view.setStatus("å·²åˆ›å»º");
        
        viewRepository.save(view);
    }
}
```

### 3.3 CQRSçš„é€‚ç”¨åœºæ™¯


**ğŸ¯ æœ€é€‚åˆçš„åœºæ™¯**ï¼š
- **è¯»å†™é¢‘ç‡å·®å¼‚å¤§**ï¼šè¯»å¤šå†™å°‘æˆ–å†™å¤šè¯»å°‘
- **è¯»å†™å¤æ‚åº¦ä¸åŒ**ï¼šæŸ¥è¯¢éœ€è¦å¤æ‚èšåˆï¼Œå†™å…¥ç›¸å¯¹ç®€å•
- **æ€§èƒ½è¦æ±‚é«˜**ï¼šéœ€è¦é’ˆå¯¹è¯»å†™åˆ†åˆ«ä¼˜åŒ–

**ğŸ“Š è¯»å†™åˆ†ç¦»çš„å¥½å¤„**ï¼š
```
è¯»ç«¯ä¼˜åŒ–ï¼š
- ä½¿ç”¨NoSQLæå‡æŸ¥è¯¢é€Ÿåº¦
- æ•°æ®é¢„èšåˆå‡å°‘è®¡ç®—
- å¤šç§è§†å›¾æ»¡è¶³ä¸åŒæŸ¥è¯¢éœ€æ±‚

å†™ç«¯ä¼˜åŒ–ï¼š  
- å…³ç³»æ•°æ®åº“ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§
- ç®€åŒ–å†™æ“ä½œé€»è¾‘
- ä¸“æ³¨ä¸šåŠ¡è§„åˆ™éªŒè¯
```

> âš ï¸ **æ³¨æ„**ï¼šCQRSä¼šå¸¦æ¥æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸æ˜¯å¼ºä¸€è‡´æ€§ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚æƒè¡¡

---

## 4. ğŸ“¤ å‘ä»¶ç®±æ¨¡å¼


### 4.1 ä»€ä¹ˆæ˜¯å‘ä»¶ç®±æ¨¡å¼


**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒå‘é‚®ä»¶æ—¶å…ˆä¿å­˜åˆ°å‘ä»¶ç®±ï¼Œç¡®ä¿ç½‘ç»œé—®é¢˜æ—¶ä¸ä¼šä¸¢å¤±

```
æ²¡æœ‰å‘ä»¶ç®±æ¨¡å¼çš„é—®é¢˜ï¼š
1. æ›´æ–°æ•°æ®åº“ âœ“
2. å‘é€æ¶ˆæ¯åˆ°RabbitMQ âœ— (ç½‘ç»œæ•…éšœ)
ç»“æœï¼šæ•°æ®å·²æ”¹ï¼Œä½†æ¶ˆæ¯æ²¡å‘ï¼ŒçŠ¶æ€ä¸ä¸€è‡´

æœ‰å‘ä»¶ç®±æ¨¡å¼ï¼š
1. æ›´æ–°æ•°æ®åº“ + ä¿å­˜æ¶ˆæ¯åˆ°å‘ä»¶ç®±è¡¨ (åŒä¸€äº‹åŠ¡) âœ“
2. åå°ä»»åŠ¡è¯»å–å‘ä»¶ç®±ï¼Œé‡è¯•å‘é€æ¶ˆæ¯ âœ“
ç»“æœï¼šä¿è¯æ¶ˆæ¯æœ€ç»ˆä¸€å®šå‘é€æˆåŠŸ
```

### 4.2 å‘ä»¶ç®±æ¨¡å¼çš„å®ç°


**ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡**ï¼š
```sql
-- ä¸šåŠ¡è¡¨
CREATE TABLE orders (
    id VARCHAR(50) PRIMARY KEY,
    customer_id VARCHAR(50),
    total_amount DECIMAL(10,2),
    status VARCHAR(20)
);

-- å‘ä»¶ç®±è¡¨
CREATE TABLE outbox_events (
    id VARCHAR(50) PRIMARY KEY,
    aggregate_id VARCHAR(50),    -- å…³è”çš„ä¸šåŠ¡ID
    event_type VARCHAR(100),     -- äº‹ä»¶ç±»å‹
    event_data TEXT,             -- äº‹ä»¶æ•°æ®(JSON)
    created_at TIMESTAMP,        -- åˆ›å»ºæ—¶é—´
    processed_at TIMESTAMP,      -- å¤„ç†æ—¶é—´
    status VARCHAR(20)           -- çŠ¶æ€ï¼šPENDING, SENT, FAILED
);
```

**ğŸ› ï¸ Javaå®ç°ç¤ºä¾‹**ï¼š
```java
@Service
@Transactional
public class OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private OutboxEventRepository outboxRepository;
    
    public void createOrder(CreateOrderCommand command) {
        // 1. åˆ›å»ºè®¢å•
        Order order = new Order(command);
        orderRepository.save(order);
        
        // 2. åŒä¸€äº‹åŠ¡ä¸­ä¿å­˜æ¶ˆæ¯åˆ°å‘ä»¶ç®±
        OutboxEvent event = new OutboxEvent();
        event.setAggregateId(order.getId());
        event.setEventType("OrderCreated");
        event.setEventData(toJson(new OrderCreatedEvent(order)));
        event.setStatus("PENDING");
        
        outboxRepository.save(event);
        
        // æ³¨æ„ï¼šè¿™é‡Œä¸ç›´æ¥å‘é€æ¶ˆæ¯åˆ°RabbitMQ
        // è€Œæ˜¯ç”±åå°ä»»åŠ¡å¤„ç†å‘ä»¶ç®±ä¸­çš„æ¶ˆæ¯
    }
}

// å‘ä»¶ç®±å¤„ç†å™¨ï¼šåå°ä»»åŠ¡
@Component
public class OutboxProcessor {
    
    @Scheduled(fixedDelay = 5000) // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡
    public void processOutboxEvents() {
        
        List<OutboxEvent> pendingEvents = outboxRepository
            .findByStatusOrderByCreatedAt("PENDING");
            
        for (OutboxEvent event : pendingEvents) {
            try {
                // å‘é€æ¶ˆæ¯åˆ°RabbitMQ
                rabbitTemplate.convertAndSend(
                    "order.events.exchange",
                    getRoutingKey(event.getEventType()),
                    event.getEventData()
                );
                
                // æ ‡è®°ä¸ºå·²å‘é€
                event.setStatus("SENT");
                event.setProcessedAt(LocalDateTime.now());
                outboxRepository.save(event);
                
            } catch (Exception e) {
                // å‘é€å¤±è´¥ï¼Œä¿æŒPENDINGçŠ¶æ€ï¼Œä¸‹æ¬¡é‡è¯•
                log.error("å‘é€æ¶ˆæ¯å¤±è´¥: " + event.getId(), e);
            }
        }
    }
}
```

### 4.3 å‘ä»¶ç®±æ¨¡å¼çš„ä¼˜åŠ¿


**âœ… æ ¸å¿ƒä»·å€¼**ï¼š
- **äº‹åŠ¡ä¸€è‡´æ€§**ï¼šæ•°æ®åº“æ“ä½œå’Œæ¶ˆæ¯å‘é€è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥
- **æ¶ˆæ¯ä¸ä¸¢å¤±**ï¼šå³ä½¿RabbitMQä¸´æ—¶ä¸å¯ç”¨ï¼Œæ¶ˆæ¯ä¹Ÿä¼šä¿å­˜åœ¨æ•°æ®åº“ä¸­
- **è‡ªåŠ¨é‡è¯•**ï¼šåå°ä»»åŠ¡ä¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„æ¶ˆæ¯
- **é¡ºåºä¿è¯**ï¼šå¯ä»¥æŒ‰ç…§æ—¶é—´é¡ºåºå¤„ç†æ¶ˆæ¯

> ğŸ’¡ **é€‚ç”¨åœºæ™¯**ï¼šéœ€è¦å¼ºä¸€è‡´æ€§ä¿è¯çš„ä¸šåŠ¡æ“ä½œï¼Œå¦‚æ”¯ä»˜ã€è®¢å•å¤„ç†ç­‰å…³é”®ä¸šåŠ¡æµç¨‹

---

## 5. ğŸ“¥ æ”¶ä»¶ç®±æ¨¡å¼


### 5.1 ä»€ä¹ˆæ˜¯æ”¶ä»¶ç®±æ¨¡å¼


**ğŸ’¡ ç®€å•ç†è§£**ï¼šå°±åƒé‚®ä»¶æ”¶ä»¶ç®±ä¼šè¿‡æ»¤åƒåœ¾é‚®ä»¶ä¸€æ ·ï¼Œé˜²æ­¢é‡å¤å¤„ç†åŒä¸€æ¡æ¶ˆæ¯

```
æ²¡æœ‰æ”¶ä»¶ç®±æ¨¡å¼çš„é—®é¢˜ï¼š
æ¶ˆæ¯é‡å‘ â†’ ç”¨æˆ·è´¦æˆ· +100å…ƒ
æ¶ˆæ¯é‡å‘ â†’ ç”¨æˆ·è´¦æˆ· +100å…ƒ  (é‡å¤å¤„ç†äº†ï¼)
ç»“æœï¼šç”¨æˆ·è´¦æˆ·å¤šäº†100å…ƒ

æœ‰æ”¶ä»¶ç®±æ¨¡å¼ï¼š
æ¶ˆæ¯1 â†’ æ£€æŸ¥æ”¶ä»¶ç®± â†’ å¤„ç† â†’ è®°å½•å·²å¤„ç†
æ¶ˆæ¯1é‡å‘ â†’ æ£€æŸ¥æ”¶ä»¶ç®± â†’ å‘ç°å·²å¤„ç† â†’ å¿½ç•¥
ç»“æœï¼šç¡®ä¿åªå¤„ç†ä¸€æ¬¡
```

### 5.2 æ”¶ä»¶ç®±æ¨¡å¼å®ç°


**ğŸ—„ï¸ æ”¶ä»¶ç®±è¡¨è®¾è®¡**ï¼š
```sql
CREATE TABLE inbox_messages (
    message_id VARCHAR(50) PRIMARY KEY,  -- æ¶ˆæ¯å”¯ä¸€ID
    handler_name VARCHAR(100),           -- å¤„ç†å™¨åç§°
    message_data TEXT,                   -- æ¶ˆæ¯å†…å®¹
    processed_at TIMESTAMP,             -- å¤„ç†æ—¶é—´
    status VARCHAR(20),                  -- PROCESSING, COMPLETED, FAILED
    retry_count INT DEFAULT 0            -- é‡è¯•æ¬¡æ•°
);
```

**ğŸ› ï¸ å®ç°ç¤ºä¾‹**ï¼š
```java
@Component
public class PaymentEventHandler {
    
    @Autowired
    private InboxMessageRepository inboxRepository;
    
    @Autowired
    private PaymentService paymentService;
    
    @RabbitListener(queues = "payment.events.queue")
    public void handlePaymentEvent(PaymentCompletedEvent event, 
                                  @Header("messageId") String messageId) {
        
        // 1. æ£€æŸ¥æ”¶ä»¶ç®±ï¼Œçœ‹æ˜¯å¦å·²ç»å¤„ç†è¿‡
        if (inboxRepository.existsByMessageIdAndHandlerName(
                messageId, "PaymentEventHandler")) {
            log.info("æ¶ˆæ¯å·²å¤„ç†è¿‡ï¼Œå¿½ç•¥: " + messageId);
            return;
        }
        
        // 2. è®°å½•åˆ°æ”¶ä»¶ç®±ï¼Œæ ‡è®°ä¸ºå¤„ç†ä¸­
        InboxMessage inboxMessage = new InboxMessage();
        inboxMessage.setMessageId(messageId);
        inboxMessage.setHandlerName("PaymentEventHandler");
        inboxMessage.setMessageData(toJson(event));
        inboxMessage.setStatus("PROCESSING");
        
        inboxRepository.save(inboxMessage);
        
        try {
            // 3. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            paymentService.processPayment(event);
            
            // 4. æ ‡è®°ä¸ºå®Œæˆ
            inboxMessage.setStatus("COMPLETED");
            inboxMessage.setProcessedAt(LocalDateTime.now());
            inboxRepository.save(inboxMessage);
            
        } catch (Exception e) {
            // 5. å¤„ç†å¤±è´¥
            inboxMessage.setStatus("FAILED");
            inboxMessage.setRetryCount(inboxMessage.getRetryCount() + 1);
            inboxRepository.save(inboxMessage);
            
            throw e; // é‡æ–°æŠ›å‡ºï¼Œè§¦å‘RabbitMQé‡è¯•æœºåˆ¶
        }
    }
}
```

### 5.3 æ”¶ä»¶ç®±æ¨¡å¼çš„å…³é”®ç‚¹


**ğŸ”‘ å¹‚ç­‰æ€§ä¿è¯**ï¼š
```
å¹‚ç­‰æ€§ï¼šåŒä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤šæ¬¡ç»“æœä¸€æ ·

ç¤ºä¾‹ï¼š
ä½™é¢ +100å…ƒ (å¹‚ç­‰) âœ—   â†’ æ‰§è¡Œå¤šæ¬¡ç»“æœä¸åŒ
è®¾ç½®ä½™é¢ä¸º1000å…ƒ (å¹‚ç­‰) âœ“ â†’ æ‰§è¡Œå¤šæ¬¡ç»“æœç›¸åŒ
```

**âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
- **å®šæœŸæ¸…ç†**ï¼šåˆ é™¤è¿‡æœŸçš„å·²å¤„ç†æ¶ˆæ¯è®°å½•
- **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºmessage_idå’Œhandler_nameå»ºç«‹è”åˆç´¢å¼•  
- **æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡å¤„ç†å¤šæ¡æ¶ˆæ¯ï¼Œå‡å°‘æ•°æ®åº“äº¤äº’

> ğŸ’¡ **ä½¿ç”¨å»ºè®®**ï¼šæ”¶ä»¶ç®±æ¨¡å¼æ˜¯æ¶ˆæ¯ç³»ç»Ÿçš„æ ‡å‡†åšæ³•ï¼Œå‡ ä¹æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒéƒ½åº”è¯¥ä½¿ç”¨

---

## 6. ğŸ”§ è¡¥å¿äº‹åŠ¡æ¨¡å¼


### 6.1 ä»€ä¹ˆæ˜¯è¡¥å¿äº‹åŠ¡


**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒç½‘è´­åé€€è´§ï¼Œéœ€è¦æ’¤é”€ä¹‹å‰çš„æ‰€æœ‰æ“ä½œ

```
åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼š
ç”¨æˆ·ä¸‹å• â†’ æ‰£åº“å­˜ â†’ æ‰£ä½™é¢ â†’ åˆ›å»ºç‰©æµå•

å¦‚æœç‰©æµåˆ›å»ºå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
éœ€è¦è¡¥å¿ï¼šè¿˜åŸä½™é¢ â†’ è¿˜åŸåº“å­˜ â†’ å–æ¶ˆè®¢å•

è¿™å°±æ˜¯è¡¥å¿äº‹åŠ¡ï¼šé€šè¿‡åå‘æ“ä½œæ’¤é”€å·²å®Œæˆçš„æ­¥éª¤
```

### 6.2 Sagaè¡¥å¿äº‹åŠ¡æ¨¡å¼


**ğŸ”„ Sagaæ¨¡å¼å·¥ä½œæµç¨‹**ï¼š
```
æ­£å‘æµç¨‹ï¼š
æ­¥éª¤1ï¼šæ‰£åº“å­˜    [æˆåŠŸ] â†’ ç»§ç»­
æ­¥éª¤2ï¼šæ‰£ä½™é¢    [æˆåŠŸ] â†’ ç»§ç»­  
æ­¥éª¤3ï¼šåˆ›å»ºç‰©æµ  [å¤±è´¥] â†’ è§¦å‘è¡¥å¿

è¡¥å¿æµç¨‹ï¼š
è¡¥å¿2ï¼šé€€è¿˜ä½™é¢  [æˆåŠŸ]
è¡¥å¿1ï¼šæ¢å¤åº“å­˜  [æˆåŠŸ]
æœ€ç»ˆçŠ¶æ€ï¼šè®¢å•å¤±è´¥ï¼Œç”¨æˆ·æ— æŸå¤±
```

**ğŸ› ï¸ RabbitMQå®ç°Sagaæ¨¡å¼**ï¼š
```java
// Sagaåè°ƒå™¨
@Component
public class OrderSagaCoordinator {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    // å¼€å§‹è®¢å•Saga
    public void startOrderSaga(CreateOrderCommand command) {
        
        SagaTransaction saga = new SagaTransaction();
        saga.setTransactionId(UUID.randomUUID().toString());
        saga.setCurrentStep(1);
        saga.setOrderData(command);
        
        // å‘é€ç¬¬ä¸€æ­¥ï¼šæ‰£åº“å­˜
        InventoryDeductCommand inventoryCmd = new InventoryDeductCommand();
        inventoryCmd.setSagaId(saga.getTransactionId());
        inventoryCmd.setProductId(command.getProductId());
        inventoryCmd.setQuantity(command.getQuantity());
        
        rabbitTemplate.convertAndSend(
            "saga.exchange", 
            "inventory.deduct", 
            inventoryCmd
        );
    }
    
    // ç›‘å¬å„æ­¥éª¤çš„ç»“æœ
    @RabbitListener(queues = "saga.inventory.result.queue")
    public void handleInventoryResult(InventoryDeductResult result) {
        
        if (result.isSuccess()) {
            // åº“å­˜æ‰£å‡æˆåŠŸï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼šæ‰£ä½™é¢
            continueToPayment(result.getSagaId());
        } else {
            // åº“å­˜æ‰£å‡å¤±è´¥ï¼Œæ•´ä¸ªSagaå¤±è´¥
            markSagaFailed(result.getSagaId(), "åº“å­˜ä¸è¶³");
        }
    }
    
    @RabbitListener(queues = "saga.payment.result.queue")  
    public void handlePaymentResult(PaymentResult result) {
        
        if (result.isSuccess()) {
            // æ”¯ä»˜æˆåŠŸï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼šåˆ›å»ºç‰©æµ
            continueToShipping(result.getSagaId());
        } else {
            // æ”¯ä»˜å¤±è´¥ï¼Œéœ€è¦è¡¥å¿åº“å­˜
            compensateInventory(result.getSagaId());
        }
    }
    
    // è¡¥å¿æ“ä½œ
    private void compensateInventory(String sagaId) {
        InventoryCompensateCommand compensateCmd = new InventoryCompensateCommand();
        compensateCmd.setSagaId(sagaId);
        
        rabbitTemplate.convertAndSend(
            "saga.exchange",
            "inventory.compensate", 
            compensateCmd
        );
    }
}

// åº“å­˜æœåŠ¡
@RabbitListener(queues = "saga.inventory.deduct.queue")
public class InventoryService {
    
    public void deductInventory(InventoryDeductCommand command) {
        try {
            // æ‰§è¡Œåº“å­˜æ‰£å‡
            boolean success = doDeductInventory(
                command.getProductId(), 
                command.getQuantity()
            );
            
            // å‘é€ç»“æœ
            InventoryDeductResult result = new InventoryDeductResult();
            result.setSagaId(command.getSagaId());
            result.setSuccess(success);
            
            rabbitTemplate.convertAndSend(
                "saga.exchange",
                "inventory.result",
                result
            );
            
        } catch (Exception e) {
            // å‘é€å¤±è´¥ç»“æœ
            sendFailureResult(command.getSagaId(), e.getMessage());
        }
    }
    
    @RabbitListener(queues = "saga.inventory.compensate.queue")
    public void compensateInventory(InventoryCompensateCommand command) {
        // æ‰§è¡Œåº“å­˜è¡¥å¿ï¼ˆæ¢å¤åº“å­˜ï¼‰
        restoreInventory(command.getProductId(), command.getQuantity());
        
        // å‘é€è¡¥å¿å®Œæˆæ¶ˆæ¯
        sendCompensationComplete(command.getSagaId());
    }
}
```

### 6.3 è¡¥å¿äº‹åŠ¡çš„è®¾è®¡åŸåˆ™


**ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š

**1. è¡¥å¿æ“ä½œå¿…é¡»å¹‚ç­‰**
```java
// é”™è¯¯çš„è¡¥å¿æ“ä½œ
public void compensatePayment(String orderId, BigDecimal amount) {
    account.balance += amount; // å¤šæ¬¡æ‰§è¡Œä¼šé‡å¤åŠ é’±ï¼
}

// æ­£ç¡®çš„è¡¥å¿æ“ä½œ  
public void compensatePayment(String orderId, BigDecimal amount) {
    if (!isAlreadyCompensated(orderId)) {
        account.balance += amount;
        markAsCompensated(orderId);
    }
}
```

**2. ä¸šåŠ¡æ“ä½œè¦è®°å½•è¶³å¤Ÿçš„ä¿¡æ¯ç”¨äºè¡¥å¿**
```java
// æ‰£åº“å­˜æ—¶è®°å½•è¡¥å¿ä¿¡æ¯
public void deductInventory(String productId, int quantity) {
    // ä¸šåŠ¡æ“ä½œ
    inventory.quantity -= quantity;
    
    // è®°å½•è¡¥å¿ä¿¡æ¯
    CompensationInfo info = new CompensationInfo();
    info.setOperation("DEDUCT_INVENTORY");
    info.setProductId(productId);
    info.setQuantity(quantity);
    info.setTimestamp(now());
    
    compensationRepository.save(info);
}
```

**3. è¶…æ—¶å¤„ç†æœºåˆ¶**
```java
@Scheduled(fixedDelay = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
public void checkTimeoutSagas() {
    List<SagaTransaction> timeoutSagas = sagaRepository
        .findByStatusAndCreatedTimeBefore("PROCESSING", 
                                        now().minusMinutes(5));
    
    for (SagaTransaction saga : timeoutSagas) {
        log.warn("Sagaè¶…æ—¶ï¼Œå¼€å§‹è¡¥å¿: " + saga.getTransactionId());
        startCompensation(saga);
    }
}
```

> âš ï¸ **é‡è¦æé†’**ï¼šè¡¥å¿äº‹åŠ¡é€‚åˆé•¿æµç¨‹çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†ä¼šå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œéœ€è¦æƒè¡¡ä¸šåŠ¡éœ€æ±‚

---

## 7. ğŸ¯ æ¨¡å¼é€‰æ‹©ä¸ç»„åˆåº”ç”¨


### 7.1 å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¨¡å¼


**ğŸ“Š é€‰æ‹©å†³ç­–çŸ©é˜µ**ï¼š

| ä¸šåŠ¡éœ€æ±‚ | **æ¨èæ¨¡å¼** | **ç†ç”±è¯´æ˜** |
|---------|------------|-------------|
| ğŸ”„ **éœ€è¦å®Œæ•´å†å²è®°å½•** | `äº‹ä»¶æº¯æº` | `å®¡è®¡ã€ç›‘ç®¡è¦æ±‚` |
| ğŸ“ˆ **è¯»å†™æ€§èƒ½å·®å¼‚å¤§** | `CQRS` | `åˆ†åˆ«ä¼˜åŒ–è¯»å†™æ€§èƒ½` |
| ğŸ’¾ **æ¶ˆæ¯å¿…é¡»å¯é ** | `å‘ä»¶ç®±æ¨¡å¼` | `ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±` |
| ğŸ” **é˜²æ­¢é‡å¤å¤„ç†** | `æ”¶ä»¶ç®±æ¨¡å¼` | `ä¿è¯å¹‚ç­‰æ€§` |
| ğŸ”— **é•¿æµç¨‹äº‹åŠ¡** | `è¡¥å¿äº‹åŠ¡` | `åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§` |

### 7.2 æ¨¡å¼ç»„åˆä½¿ç”¨æ¡ˆä¾‹


**ğŸ›ï¸ ç”µå•†è®¢å•ç³»ç»Ÿå®Œæ•´æ¶æ„**ï¼š
```
ç”¨æˆ·ä¸‹å•æµç¨‹è®¾è®¡ï¼š

1. ã€å‘ä»¶ç®±æ¨¡å¼ã€‘ç¡®ä¿è®¢å•åˆ›å»ºæ¶ˆæ¯å¿…è¾¾
   â”œâ”€ åˆ›å»ºè®¢å• + ä¿å­˜åˆ°å‘ä»¶ç®± (åŒä¸€äº‹åŠ¡)
   â””â”€ åå°ä»»åŠ¡å‘é€æ¶ˆæ¯åˆ°RabbitMQ

2. ã€æ”¶ä»¶ç®±æ¨¡å¼ã€‘ç¡®ä¿å„æœåŠ¡ä¸é‡å¤å¤„ç†  
   â”œâ”€ åº“å­˜æœåŠ¡ï¼šæ£€æŸ¥æ”¶ä»¶ç®± â†’ æ‰£å‡åº“å­˜
   â”œâ”€ æ”¯ä»˜æœåŠ¡ï¼šæ£€æŸ¥æ”¶ä»¶ç®± â†’ å¤„ç†æ”¯ä»˜  
   â””â”€ ç‰©æµæœåŠ¡ï¼šæ£€æŸ¥æ”¶ä»¶ç®± â†’ åˆ›å»ºè¿å•

3. ã€è¡¥å¿äº‹åŠ¡ã€‘å¤„ç†å¤±è´¥å›æ»š
   â”œâ”€ å¦‚æœæ”¯ä»˜å¤±è´¥ â†’ æ¢å¤åº“å­˜
   â””â”€ å¦‚æœç‰©æµå¤±è´¥ â†’ é€€æ¬¾ + æ¢å¤åº“å­˜

4. ã€äº‹ä»¶æº¯æºã€‘è®°å½•å®Œæ•´è¿‡ç¨‹
   â”œâ”€ OrderCreatedäº‹ä»¶
   â”œâ”€ InventoryDeductedäº‹ä»¶  
   â”œâ”€ PaymentCompletedäº‹ä»¶
   â””â”€ OrderShippedäº‹ä»¶

5. ã€CQRSã€‘ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
   â”œâ”€ å†™ç«¯ï¼šå¤„ç†è®¢å•ä¸šåŠ¡é€»è¾‘
   â””â”€ è¯»ç«¯ï¼šæä¾›è®¢å•æŸ¥è¯¢è§†å›¾
```

### 7.3 æ¶æ„æ¼”è¿›è·¯å¾„


**ğŸš€ æ¨èçš„æ¼”è¿›ç­–ç•¥**ï¼š

**é˜¶æ®µ1ï¼šåŸºç¡€æ¶æ„ (æ–°æ‰‹æ¨è)**
```
âœ… æ”¶ä»¶ç®±æ¨¡å¼ï¼šé˜²é‡å¤å¤„ç†
âœ… å‘ä»¶ç®±æ¨¡å¼ï¼šä¿è¯æ¶ˆæ¯å¯é 
ç›®æ ‡ï¼šæ„å»ºç¨³å®šçš„æ¶ˆæ¯åŸºç¡€
```

**é˜¶æ®µ2ï¼šæ€§èƒ½ä¼˜åŒ–**  
```
âœ… CQRSæ¨¡å¼ï¼šè¯»å†™åˆ†ç¦»ä¼˜åŒ–æ€§èƒ½
ç›®æ ‡ï¼šè§£å†³æ€§èƒ½ç“¶é¢ˆ
```

**é˜¶æ®µ3ï¼šé«˜çº§ç‰¹æ€§**
```
âœ… äº‹ä»¶æº¯æºï¼šå®Œæ•´çš„ä¸šåŠ¡å®¡è®¡
âœ… è¡¥å¿äº‹åŠ¡ï¼šå¤æ‚åˆ†å¸ƒå¼äº‹åŠ¡
ç›®æ ‡ï¼šæ”¯æŒå¤æ‚ä¸šåŠ¡åœºæ™¯
```

> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šå…ˆæŒæ¡å‘ä»¶ç®±å’Œæ”¶ä»¶ç®±æ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªæ˜¯æ¶ˆæ¯ç³»ç»Ÿçš„åŸºç¡€ï¼Œå…¶ä»–æ¨¡å¼å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦é€æ­¥å¼•å…¥

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 äº”å¤§æ¨¡å¼æ ¸å¿ƒè¦ç‚¹


```
ğŸ—‚ï¸ äº‹ä»¶æº¯æºæ¨¡å¼ï¼š
æ ¸å¿ƒï¼šè®°å½•æ‰€æœ‰ä¸šåŠ¡å˜åŒ–äº‹ä»¶ï¼Œè€Œä¸æ˜¯æœ€ç»ˆçŠ¶æ€
ä»·å€¼ï¼šå®Œæ•´å†å²ã€æ—¶é—´æ—…è¡Œã€å®¡è®¡å‹å¥½
é€‚ç”¨ï¼šé‡‘èã€ç›‘ç®¡ã€å®¡è®¡ç­‰å¯¹å†å²è¦æ±‚é«˜çš„åœºæ™¯

ğŸ”„ CQRSæ¨¡å¼ï¼š
æ ¸å¿ƒï¼šè¯»å†™æ“ä½œåˆ†ç¦»ï¼Œåˆ†åˆ«ä¼˜åŒ–
ä»·å€¼ï¼šæ€§èƒ½ä¼˜åŒ–ã€å¤æ‚æŸ¥è¯¢æ”¯æŒã€è¯»å†™ç‹¬ç«‹æ‰©å±•  
é€‚ç”¨ï¼šè¯»å†™é¢‘ç‡å·®å¼‚å¤§ã€æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯

ğŸ“¤ å‘ä»¶ç®±æ¨¡å¼ï¼š
æ ¸å¿ƒï¼šæ¶ˆæ¯å’Œä¸šåŠ¡æ“ä½œåœ¨åŒä¸€äº‹åŠ¡ä¸­
ä»·å€¼ï¼šä¿è¯æ¶ˆæ¯å¿…è¾¾ã€äº‹åŠ¡ä¸€è‡´æ€§
é€‚ç”¨ï¼šæ‰€æœ‰éœ€è¦å¯é æ¶ˆæ¯å‘é€çš„åœºæ™¯

ğŸ“¥ æ”¶ä»¶ç®±æ¨¡å¼ï¼š  
æ ¸å¿ƒï¼šè®°å½•æ¶ˆæ¯å¤„ç†çŠ¶æ€ï¼Œé˜²é‡å¤å¤„ç†
ä»·å€¼ï¼šå¹‚ç­‰æ€§ä¿è¯ã€æ¶ˆæ¯å»é‡
é€‚ç”¨ï¼šå‡ ä¹æ‰€æœ‰æ¶ˆæ¯æ¶ˆè´¹åœºæ™¯

ğŸ”§ è¡¥å¿äº‹åŠ¡æ¨¡å¼ï¼š
æ ¸å¿ƒï¼šé€šè¿‡åå‘æ“ä½œæ’¤é”€å·²å®Œæˆæ­¥éª¤
ä»·å€¼ï¼šåˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ã€é•¿æµç¨‹æ”¯æŒ
é€‚ç”¨ï¼šå¤æ‚ä¸šåŠ¡æµç¨‹ã€åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯
```

### 8.2 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°æ‰‹å­¦ä¹ è·¯å¾„**ï¼š
1. **å…ˆç†è§£æ¦‚å¿µ**ï¼šæ¯ä¸ªæ¨¡å¼è§£å†³ä»€ä¹ˆé—®é¢˜
2. **åŠ¨æ‰‹å®è·µ**ï¼šä»ç®€å•çš„å‘ä»¶ç®±ã€æ”¶ä»¶ç®±å¼€å§‹  
3. **é€æ­¥è¿›é˜¶**ï¼šæ ¹æ®ä¸šåŠ¡éœ€è¦å¼•å…¥å…¶ä»–æ¨¡å¼
4. **ç»„åˆä½¿ç”¨**ï¼šåœ¨çœŸå®é¡¹ç›®ä¸­ç»„åˆå¤šç§æ¨¡å¼

**âš¡ å…³é”®è®°å¿†ç‚¹**ï¼š
- **å‘ä»¶ç®±**ï¼šä¿è¯æ¶ˆæ¯å‘å‡ºå»
- **æ”¶ä»¶ç®±**ï¼šä¿è¯æ¶ˆæ¯ä¸é‡å¤å¤„ç†  
- **äº‹ä»¶æº¯æº**ï¼šä¿å­˜å˜åŒ–å†å²
- **CQRS**ï¼šè¯»å†™åˆ†ç¦»ä¼˜åŒ–
- **è¡¥å¿äº‹åŠ¡**ï¼šåˆ†å¸ƒå¼å›æ»š

**ğŸ”§ å·¥ç¨‹å®è·µå»ºè®®**ï¼š
- å‘ä»¶ç®±å’Œæ”¶ä»¶ç®±æ˜¯åŸºç¡€ï¼Œå‡ ä¹å¿…ç”¨
- CQRSé€‚åˆæ€§èƒ½è¦æ±‚é«˜çš„ç³»ç»Ÿ
- äº‹ä»¶æº¯æºé€‚åˆå¯¹å†å²è®°å½•è¦æ±‚é«˜çš„ä¸šåŠ¡
- è¡¥å¿äº‹åŠ¡é€‚åˆå¤æ‚çš„é•¿æµç¨‹ä¸šåŠ¡
- æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦é€æ­¥å¼•å…¥ï¼Œä¸è¦ä¸€æ¬¡æ€§å…¨ä¸Š

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¶æ„æ¨¡å¼æ˜¯ä¸ºäº†è§£å†³ç‰¹å®šé—®é¢˜è€Œè®¾è®¡çš„æ–¹æ¡ˆ
- æ²¡æœ‰é“¶å¼¹ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ¨¡å¼
- ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥æ¼”è¿›ï¼Œé¿å…è¿‡åº¦è®¾è®¡
- ç†è§£åŸç†æ¯”è®°ä½ä»£ç æ›´é‡è¦