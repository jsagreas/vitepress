---
title: 1ã€è®¾è®¡è§„èŒƒæ ‡å‡†
---
## ğŸ“š ç›®å½•


1. [è®¾è®¡è§„èŒƒæ¦‚è¿°](#1-è®¾è®¡è§„èŒƒæ¦‚è¿°)
2. [æ¶ˆæ¯æ ¼å¼æ ‡å‡†](#2-æ¶ˆæ¯æ ¼å¼æ ‡å‡†)
3. [å‘½åè§„èŒƒåˆ¶å®š](#3-å‘½åè§„èŒƒåˆ¶å®š)
4. [ç‰ˆæœ¬ç®¡ç†ç­–ç•¥](#4-ç‰ˆæœ¬ç®¡ç†ç­–ç•¥)
5. [æ–‡æ¡£è§„èŒƒè¦æ±‚](#5-æ–‡æ¡£è§„èŒƒè¦æ±‚)
6. [ä»£ç è§„èŒƒæ ‡å‡†](#6-ä»£ç è§„èŒƒæ ‡å‡†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è®¾è®¡è§„èŒƒæ¦‚è¿°



### 1.1 ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡è§„èŒƒ



**ç°å®é—®é¢˜**ï¼šæƒ³è±¡ä¸€ä¸ªå¤§å…¬å¸é‡Œï¼Œå¼€å‘å›¢é˜Ÿå°±åƒä¸åŒçš„éƒ¨é—¨

```
æ²¡æœ‰è§„èŒƒçš„æƒ…å†µï¼š
é”€å”®éƒ¨é—¨ï¼šç”¨Excelå‘æ¶ˆæ¯ ğŸ“Š
æŠ€æœ¯éƒ¨é—¨ï¼šç”¨JSONå‘æ¶ˆæ¯ ğŸ’»  
è´¢åŠ¡éƒ¨é—¨ï¼šç”¨XMLå‘æ¶ˆæ¯ ğŸ“‹
å®¢æœéƒ¨é—¨ï¼šç”¨çº¯æ–‡æœ¬å‘æ¶ˆæ¯ ğŸ“

ç»“æœï¼šå¤§å®¶éƒ½å¬ä¸æ‡‚å¯¹æ–¹åœ¨è¯´ä»€ä¹ˆï¼
```

**è®¾è®¡è§„èŒƒçš„ä½œç”¨**ï¼š
- **ç»Ÿä¸€è¯­è¨€**ï¼šè®©æ‰€æœ‰ç³»ç»Ÿéƒ½è¯´"åŒä¸€ç§è¯"
- **å‡å°‘é”™è¯¯**ï¼šé¿å…å› ä¸ºæ ¼å¼ä¸ç»Ÿä¸€å¯¼è‡´çš„é—®é¢˜
- **æé«˜æ•ˆç‡**ï¼šæ–°äººå¿«é€Ÿä¸Šæ‰‹ï¼Œä¸ç”¨çŒœæµ‹è§„åˆ™
- **ä¾¿äºç»´æŠ¤**ï¼šä»£ç çœ‹èµ·æ¥æ•´é½ï¼Œå®¹æ˜“æ‰¾é—®é¢˜

> **ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
> è®¾è®¡è§„èŒƒå°±åƒäº¤é€šè§„åˆ™ï¼Œè™½ç„¶é™åˆ¶äº†ä½ çš„"è‡ªç”±"ï¼Œä½†è®©æ•´ä¸ªåŸå¸‚çš„äº¤é€šæ›´åŠ æœ‰åºå’Œå®‰å…¨

### 1.2 è§„èŒƒåˆ¶å®šçš„åŸºæœ¬åŸåˆ™



**å››å¤§æ ¸å¿ƒåŸåˆ™**ï¼š

```
ğŸ¯ ç®€å•æ˜“æ‡‚åŸåˆ™
- è§„èŒƒè¦ç®€å•æ˜äº†ï¼Œä¸è¦è¿‡äºå¤æ‚
- æ–°äººçœ‹ä¸€éå°±èƒ½ç†è§£

ğŸ”§ å®ç”¨æ€§åŸåˆ™  
- è§„èŒƒè¦èƒ½è§£å†³å®é™…é—®é¢˜
- ä¸æ˜¯ä¸ºäº†è§„èŒƒè€Œè§„èŒƒ

ğŸ“ˆ å¯æ‰©å±•åŸåˆ™
- è§„èŒƒè¦è€ƒè™‘æœªæ¥çš„å‘å±•
- èƒ½å¤Ÿé€‚åº”ä¸šåŠ¡çš„å˜åŒ–

âš–ï¸ ä¸€è‡´æ€§åŸåˆ™
- æ•´ä¸ªé¡¹ç›®ä¿æŒç»Ÿä¸€é£æ ¼
- ä¸èƒ½æœä»¤å¤•æ”¹
```

---

## 2. ğŸ“„ æ¶ˆæ¯æ ¼å¼æ ‡å‡†



### 2.1 æ¶ˆæ¯æ ¼å¼çš„é‡è¦æ€§



**ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ ¼å¼**ï¼š
æ¶ˆæ¯æ ¼å¼å°±æ˜¯å®šä¹‰"ä¿¡å°"é‡Œè£…ä»€ä¹ˆå†…å®¹ï¼Œæ€ä¹ˆè£…çš„è§„åˆ™

```
å°±åƒå†™ä¿¡ä¸€æ ·ï¼š
æ”¶ä»¶äººï¼šå¼ ä¸‰
å‘ä»¶äººï¼šæå››  
æ—¥æœŸï¼š2025å¹´9æœˆ20æ—¥
å†…å®¹ï¼šä½ å¥½ï¼Œæ˜å¤©å¼€ä¼š...
```

### 2.2 æ ‡å‡†æ¶ˆæ¯ç»“æ„è®¾è®¡



**ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼æ¨¡æ¿**ï¼š

```json
{
  "messageId": "msg_20250920_001",
  "timestamp": "2025-09-20T16:00:00Z",
  "source": "order-service",
  "eventType": "ORDER_CREATED",
  "version": "1.0",
  "data": {
    "orderId": "ORD001",
    "userId": "USER123",
    "amount": 99.99
  },
  "metadata": {
    "correlationId": "corr_123",
    "priority": "normal"
  }
}
```

**å„å­—æ®µçš„ä½œç”¨è§£é‡Š**ï¼š

| å­—æ®µ | **ä½œç”¨** | **ç±»æ¯”** |
|------|----------|----------|
| `messageId` | æ¶ˆæ¯çš„èº«ä»½è¯å· | å¿«é€’å•å· |
| `timestamp` | æ¶ˆæ¯å‘é€æ—¶é—´ | ä¿¡ä»¶æ—¥æœŸ |
| `source` | æ¶ˆæ¯æ¥æºç³»ç»Ÿ | å‘ä»¶äºº |
| `eventType` | æ¶ˆæ¯ç±»å‹ | ä¿¡ä»¶ä¸»é¢˜ |
| `version` | æ¶ˆæ¯æ ¼å¼ç‰ˆæœ¬ | åè®®ç‰ˆæœ¬ |
| `data` | å…·ä½“ä¸šåŠ¡æ•°æ® | ä¿¡ä»¶å†…å®¹ |
| `metadata` | é™„åŠ ä¿¡æ¯ | å¤‡æ³¨ä¿¡æ¯ |

### 2.3 ä¸åŒä¸šåŠ¡åœºæ™¯çš„æ¶ˆæ¯æ ¼å¼



**è®¢å•ç›¸å…³æ¶ˆæ¯**ï¼š
```json
{
  "eventType": "ORDER_CREATED",
  "data": {
    "orderId": "ORD001",
    "products": [
      {"id": "P001", "name": "è‹¹æœ", "price": 5.0}
    ],
    "totalAmount": 5.0,
    "status": "PENDING"
  }
}
```

**ç”¨æˆ·ç›¸å…³æ¶ˆæ¯**ï¼š
```json
{
  "eventType": "USER_REGISTERED", 
  "data": {
    "userId": "USER123",
    "email": "user@example.com",
    "registrationTime": "2025-09-20T16:00:00Z"
  }
}
```

> **ğŸ“Œ é‡ç‚¹æé†’**ï¼š
> ä¸åŒä¸šåŠ¡çš„æ¶ˆæ¯æ ¼å¼å¯ä»¥ä¸åŒï¼Œä½†åŸºæœ¬ç»“æ„è¦ä¿æŒä¸€è‡´ï¼Œå°±åƒä¸åŒç±»å‹çš„è¡¨æ ¼ï¼Œè¡¨å¤´æ ¼å¼æ˜¯ç»Ÿä¸€çš„

### 2.4 æ¶ˆæ¯æ ¼å¼éªŒè¯æœºåˆ¶



**ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯**ï¼š
é˜²æ­¢"åæ¶ˆæ¯"è¿›å…¥ç³»ç»Ÿï¼Œå°±åƒé—¨å«æ£€æŸ¥èº«ä»½è¯ä¸€æ ·

**éªŒè¯è§„åˆ™ç¤ºä¾‹**ï¼š
```
å¿…å¡«å­—æ®µæ£€æŸ¥ï¼š
âœ… messageId ä¸èƒ½ä¸ºç©º
âœ… timestamp å¿…é¡»æ˜¯æœ‰æ•ˆæ—¶é—´æ ¼å¼
âœ… eventType å¿…é¡»åœ¨å…è®¸åˆ—è¡¨ä¸­

æ•°æ®ç±»å‹æ£€æŸ¥ï¼š
âœ… amount å¿…é¡»æ˜¯æ•°å­—
âœ… email å¿…é¡»ç¬¦åˆé‚®ç®±æ ¼å¼
âœ… å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½è¶…è¿‡é™åˆ¶
```

---

## 3. ğŸ·ï¸ å‘½åè§„èŒƒåˆ¶å®š



### 3.1 å‘½åè§„èŒƒçš„é‡è¦æ€§



**å¥½åå­—çš„ä»·å€¼**ï¼š
å°±åƒç»™å­©å­èµ·åå­—ä¸€æ ·ï¼Œå¥½çš„åå­—è®©äººä¸€çœ‹å°±çŸ¥é“æ˜¯åšä»€ä¹ˆçš„

```
åçš„å‘½åï¼š
Queue: q1, q2, q3 (å®Œå…¨ä¸çŸ¥é“æ˜¯å¹²ä»€ä¹ˆçš„)
Exchange: ex, temp, abc

å¥½çš„å‘½åï¼š
Queue: user.registration.queue, order.payment.queue
Exchange: user.events, order.events
```

### 3.2 äº¤æ¢æœºå‘½åè§„èŒƒ



**å‘½åæ¨¡å¼**ï¼š`ä¸šåŠ¡åŸŸ.äº‹ä»¶ç±»å‹.exchange`

```
ç”¨æˆ·ç›¸å…³ï¼š
âœ… user.events.exchange      (ç”¨æˆ·äº‹ä»¶äº¤æ¢æœº)
âœ… user.notifications.exchange (ç”¨æˆ·é€šçŸ¥äº¤æ¢æœº)

è®¢å•ç›¸å…³ï¼š
âœ… order.lifecycle.exchange   (è®¢å•ç”Ÿå‘½å‘¨æœŸ)
âœ… order.payment.exchange     (è®¢å•æ”¯ä»˜)

ç³»ç»Ÿç›¸å…³ï¼š
âœ… system.monitoring.exchange (ç³»ç»Ÿç›‘æ§)
âœ… system.logs.exchange       (ç³»ç»Ÿæ—¥å¿—)
```

### 3.3 é˜Ÿåˆ—å‘½åè§„èŒƒ



**å‘½åæ¨¡å¼**ï¼š`æœåŠ¡å.ä¸šåŠ¡.queue`

```
å…·ä½“ç¤ºä¾‹ï¼š
âœ… email-service.notifications.queue
   (é‚®ä»¶æœåŠ¡çš„é€šçŸ¥é˜Ÿåˆ—)

âœ… order-service.payment.queue  
   (è®¢å•æœåŠ¡çš„æ”¯ä»˜é˜Ÿåˆ—)

âœ… user-service.registration.queue
   (ç”¨æˆ·æœåŠ¡çš„æ³¨å†Œé˜Ÿåˆ—)
```

**é˜Ÿåˆ—å‘½åæ£€æŸ¥æ¸…å•**ï¼š
- [ ] åŒ…å«æœåŠ¡åç§°
- [ ] åŒ…å«ä¸šåŠ¡åŠŸèƒ½  
- [ ] ä»¥`.queue`ç»“å°¾
- [ ] ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦
- [ ] é•¿åº¦æ§åˆ¶åœ¨50å­—ç¬¦ä»¥å†…

### 3.4 è·¯ç”±é”®å‘½åè§„èŒƒ



**å‘½åæ¨¡å¼**ï¼š`ä¸šåŠ¡åŸŸ.åŠ¨ä½œ.å¯¹è±¡`

```
ç”¨æˆ·ä¸šåŠ¡ï¼š
âœ… user.created.profile     (ç”¨æˆ·åˆ›å»ºæ¡£æ¡ˆ)
âœ… user.updated.email       (ç”¨æˆ·æ›´æ–°é‚®ç®±)
âœ… user.deleted.account     (ç”¨æˆ·åˆ é™¤è´¦æˆ·)

è®¢å•ä¸šåŠ¡ï¼š
âœ… order.created.new        (åˆ›å»ºæ–°è®¢å•)
âœ… order.updated.status     (æ›´æ–°è®¢å•çŠ¶æ€)  
âœ… order.cancelled.timeout  (è¶…æ—¶å–æ¶ˆè®¢å•)
```

> **ğŸ§  è®°å¿†æŠ€å·§**ï¼š
> è·¯ç”±é”®å°±åƒæ–‡ä»¶è·¯å¾„ï¼Œä»å¤§åˆ°å°ï¼š`ç±»åˆ«/åŠ¨ä½œ/å…·ä½“å†…å®¹`

### 3.5 å‘½åè§„èŒƒæ–‡æ¡£æ¨¡æ¿



**å›¢é˜Ÿå‘½åè§„èŒƒæ–‡æ¡£**ï¼š

```markdown
# å‘½åè§„èŒƒå¿«é€Ÿå‚è€ƒ



## äº¤æ¢æœºå‘½å


æ ¼å¼ï¼š{ä¸šåŠ¡åŸŸ}.{ç±»å‹}.exchange
ç¤ºä¾‹ï¼šuser.events.exchange

## é˜Ÿåˆ—å‘½å  


æ ¼å¼ï¼š{æœåŠ¡å}.{åŠŸèƒ½}.queue
ç¤ºä¾‹ï¼šemail-service.notifications.queue

## è·¯ç”±é”®å‘½å


æ ¼å¼ï¼š{ä¸šåŠ¡åŸŸ}.{åŠ¨ä½œ}.{å¯¹è±¡}
ç¤ºä¾‹ï¼šuser.created.profile

## ç¦ç”¨è¯æ±‡


âŒ temp, test, demo (ä¸´æ—¶æ€§è¯æ±‡)
âŒ æ•°å­—ç¼–å· (q1, q2, q3)
âŒ ç‰¹æ®Šå­—ç¬¦ (@, #, $)
```

---

## 4. ğŸ“‹ ç‰ˆæœ¬ç®¡ç†ç­–ç•¥



### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†



**ç°å®åœºæ™¯**ï¼š
æƒ³è±¡ä½ çš„æ‰‹æœºAPPéœ€è¦æ›´æ–°ï¼Œä½†ä¸èƒ½è®©è€ç‰ˆæœ¬APPé©¬ä¸Šåœæ­¢å·¥ä½œ

```
ç‰ˆæœ¬ç®¡ç†è§£å†³çš„é—®é¢˜ï¼š
ğŸ”„ æ–°è€ç³»ç»Ÿå¹¶å­˜
ğŸ”„ é€æ­¥å‡çº§è¿ç§»  
ğŸ”„ å‘åå…¼å®¹ä¿è¯
ğŸ”„ å›æ»šæœºåˆ¶æ”¯æŒ
```

> **ğŸ’­ ç”Ÿæ´»ç±»æ¯”**ï¼š
> ç‰ˆæœ¬ç®¡ç†å°±åƒåŸå¸‚é“è·¯æ”¹é€ ï¼Œæ–°è·¯ä¿®å¥½åï¼Œæ—§è·¯è¿˜è¦èƒ½èµ°ä¸€æ®µæ—¶é—´ï¼Œè®©å¤§å®¶æœ‰æ—¶é—´é€‚åº”

### 4.2 æ¶ˆæ¯ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥



**ç‰ˆæœ¬å·è§„åˆ™**ï¼šä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ `ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®å¤ç‰ˆæœ¬`

```
ç‰ˆæœ¬ç¤ºä¾‹ï¼š
v1.0.0 - åˆå§‹ç‰ˆæœ¬
v1.1.0 - å¢åŠ æ–°å­—æ®µï¼ˆå‘åå…¼å®¹ï¼‰  
v1.1.1 - ä¿®å¤bugï¼ˆå‘åå…¼å®¹ï¼‰
v2.0.0 - é‡å¤§å˜æ›´ï¼ˆä¸å…¼å®¹ï¼‰
```

**æ¶ˆæ¯ä¸­çš„ç‰ˆæœ¬æ ‡è¯†**ï¼š
```json
{
  "messageVersion": "1.2.0",
  "schemaVersion": "user-event-v1.2", 
  "data": {
    "userId": "123",
    "action": "register"
  }
}
```

### 4.3 å…¼å®¹æ€§å¤„ç†ç­–ç•¥



**å‘åå…¼å®¹åŸåˆ™**ï¼š

```
âœ… å¯ä»¥åšçš„å˜æ›´ï¼š
- æ·»åŠ æ–°çš„å¯é€‰å­—æ®µ
- æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹
- æ‰©å±•æšä¸¾å€¼

âŒ ä¸èƒ½åšçš„å˜æ›´ï¼š  
- åˆ é™¤ç°æœ‰å­—æ®µ
- ä¿®æ”¹å­—æ®µç±»å‹
- ä¿®æ”¹å¿…å¡«å­—æ®µä¸ºå¯é€‰
```

**å…¼å®¹æ€§å¤„ç†ä»£ç ç¤ºä¾‹**ï¼š
```java
public class MessageProcessor {
    
    public void processMessage(String message) {
        JsonNode msgNode = parseMessage(message);
        String version = msgNode.get("version").asText();
        
        switch(version) {
            case "1.0":
                processV1Message(msgNode);
                break;
            case "1.1": 
                processV1_1Message(msgNode);
                break;
            default:
                processLatestMessage(msgNode);
        }
    }
    
    // å¤„ç†è€ç‰ˆæœ¬æ¶ˆæ¯ï¼Œä¿æŒå…¼å®¹
    private void processV1Message(JsonNode msg) {
        // ä¸ºè€ç‰ˆæœ¬æ¶ˆæ¯æ·»åŠ é»˜è®¤å€¼
        String userId = msg.get("userId").asText();
        String email = msg.has("email") ? 
            msg.get("email").asText() : "unknown@example.com";
    }
}
```

### 4.4 ç‰ˆæœ¬å‡çº§è¿ç§»æµç¨‹



**å‡çº§æ­¥éª¤è§„åˆ’**ï¼š

```
é˜¶æ®µ1ï¼šå‡†å¤‡é˜¶æ®µ (1-2å‘¨)
â”œâ”€â”€ æ–°ç‰ˆæœ¬æ¶ˆæ¯æ ¼å¼è®¾è®¡
â”œâ”€â”€ å…¼å®¹æ€§æµ‹è¯•
â””â”€â”€ è¿ç§»è®¡åˆ’åˆ¶å®š

é˜¶æ®µ2ï¼šç°åº¦å‘å¸ƒ (1-2å‘¨)  
â”œâ”€â”€ éƒ¨åˆ†æœåŠ¡å‡çº§åˆ°æ–°ç‰ˆæœ¬
â”œâ”€â”€ æ–°è€ç‰ˆæœ¬å¹¶è¡Œè¿è¡Œ
â””â”€â”€ ç›‘æ§ç³»ç»Ÿç¨³å®šæ€§

é˜¶æ®µ3ï¼šå…¨é‡å‡çº§ (1å‘¨)
â”œâ”€â”€ æ‰€æœ‰æœåŠ¡å‡çº§å®Œæˆ
â”œâ”€â”€ åœæ­¢å‘é€è€ç‰ˆæœ¬æ¶ˆæ¯  
â””â”€â”€ ä¿ç•™è€ç‰ˆæœ¬å¤„ç†èƒ½åŠ›

é˜¶æ®µ4ï¼šæ¸…ç†é˜¶æ®µ (2-4å‘¨å)
â”œâ”€â”€ ç¡®è®¤æ— è€ç‰ˆæœ¬æ¶ˆæ¯
â”œâ”€â”€ ç§»é™¤è€ç‰ˆæœ¬å¤„ç†ä»£ç 
â””â”€â”€ æ›´æ–°æ–‡æ¡£
```

---

## 5. ğŸ“– æ–‡æ¡£è§„èŒƒè¦æ±‚



### 5.1 æ–‡æ¡£çš„é‡è¦æ€§



**æ–‡æ¡£å°±åƒè¯´æ˜ä¹¦**ï¼š
ä½ ä¹°äº†æ–°å®¶ç”µï¼Œæ²¡æœ‰è¯´æ˜ä¹¦å°±ä¸çŸ¥é“æ€ä¹ˆç”¨ï¼Œç³»ç»Ÿä¹Ÿæ˜¯ä¸€æ ·

```
å¥½æ–‡æ¡£çš„ç‰¹ç‚¹ï¼š
ğŸ“ çœ‹å¾—æ‡‚ - ç”¨äººè¯å†™ï¼Œä¸ç”¨ä¸“ä¸šæœ¯è¯­ç§€
ğŸ” æ‰¾å¾—åˆ° - ç»“æ„æ¸…æ™°ï¼Œå®¹æ˜“æŸ¥æ‰¾
âš¡ æ›´æ–°å¿« - ä»£ç æ”¹äº†ï¼Œæ–‡æ¡£ä¹Ÿè¦æ”¹
ğŸ¯ æœ‰é‡ç‚¹ - çªå‡ºé‡è¦ä¿¡æ¯
```

### 5.2 APIæ–‡æ¡£è§„èŒƒ



**æ¥å£æ–‡æ¡£æ¨¡æ¿**ï¼š

```markdown
# å‘é€ç”¨æˆ·æ³¨å†Œæ¶ˆæ¯



## åŸºæœ¬ä¿¡æ¯


- **äº¤æ¢æœº**: user.events.exchange
- **è·¯ç”±é”®**: user.created.profile  
- **é˜Ÿåˆ—**: user-service.registration.queue

## æ¶ˆæ¯æ ¼å¼


```json
{
  "messageId": "å¿…å¡«ï¼Œå­—ç¬¦ä¸²ï¼Œæ¶ˆæ¯å”¯ä¸€æ ‡è¯†",
  "timestamp": "å¿…å¡«ï¼ŒISO8601æ ¼å¼æ—¶é—´",
  "eventType": "å¿…å¡«ï¼Œå›ºå®šå€¼ï¼šUSER_REGISTERED", 
  "data": {
    "userId": "å¿…å¡«ï¼Œå­—ç¬¦ä¸²ï¼Œç”¨æˆ·ID",
    "email": "å¿…å¡«ï¼Œå­—ç¬¦ä¸²ï¼Œç”¨æˆ·é‚®ç®±",
    "phone": "å¯é€‰ï¼Œå­—ç¬¦ä¸²ï¼Œæ‰‹æœºå·ç "
  }
}
```

## ç¤ºä¾‹ä»£ç 


```java
// å‘é€æ³¨å†Œæ¶ˆæ¯
UserRegisteredEvent event = new UserRegisteredEvent();
event.setUserId("USER123");
event.setEmail("user@example.com");

messageProducer.send("user.events.exchange", 
                     "user.created.profile", 
                     event);
```

## é”™è¯¯å¤„ç†


- é‚®ç®±æ ¼å¼é”™è¯¯ï¼šè¿”å›400é”™è¯¯
- ç”¨æˆ·IDé‡å¤ï¼šè¿”å›409é”™è¯¯
```

### 5.3 æ¶æ„æ–‡æ¡£è§„èŒƒ



**ç³»ç»Ÿæ¶æ„å›¾è¯´æ˜**ï¼š

```
ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼š
Webå‰ç«¯ â”€â”€æ³¨å†Œè¯·æ±‚â”€â”€â–¶ ç”¨æˆ·æœåŠ¡ â”€â”€éªŒè¯é€šè¿‡â”€â”€â–¶ RabbitMQ
                                                    â”‚
é‚®ä»¶æœåŠ¡ â—€â”€â”€å‘é€é‚®ä»¶â”€â”€â”€â”€ é€šçŸ¥æœåŠ¡ â—€â”€â”€å¤„ç†æ¶ˆæ¯â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¶‰åŠç»„ä»¶ï¼š
â€¢ ç”¨æˆ·æœåŠ¡ï¼šå¤„ç†æ³¨å†Œé€»è¾‘
â€¢ é€šçŸ¥æœåŠ¡ï¼šå‘é€å„ç§é€šçŸ¥  
â€¢ é‚®ä»¶æœåŠ¡ï¼šä¸“é—¨å‘é€é‚®ä»¶
â€¢ RabbitMQï¼šæ¶ˆæ¯ä¸­è½¬ç«™
```

### 5.4 æ•…éšœæ’æŸ¥æ–‡æ¡£



**å¸¸è§é—®é¢˜è§£å†³æŒ‡å—**ï¼š

```markdown
# æ¶ˆæ¯å‘é€å¤±è´¥



## é—®é¢˜ç—‡çŠ¶


- ç”Ÿäº§è€…æŠ¥é”™ï¼šConnection refused
- æ¶ˆæ¯æ²¡æœ‰åˆ°è¾¾é˜Ÿåˆ—

## æ’æŸ¥æ­¥éª¤


1. æ£€æŸ¥RabbitMQæœåŠ¡çŠ¶æ€
   ```bash
   sudo systemctl status rabbitmq-server
   ```

2. æ£€æŸ¥è¿æ¥é…ç½®
   - ä¸»æœºåœ°å€æ˜¯å¦æ­£ç¡®
   - ç«¯å£å·æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤5672ï¼‰
   - ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®

3. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
   ```bash
   telnet rabbitmq-host 5672
   ```

## è§£å†³æ–¹æ¡ˆ


- é‡å¯RabbitMQæœåŠ¡
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- éªŒè¯ç”¨æˆ·æƒé™é…ç½®
```

---

## 6. ğŸ’» ä»£ç è§„èŒƒæ ‡å‡†



### 6.1 ä»£ç è§„èŒƒçš„ä»·å€¼



**ä¸ºä»€ä¹ˆéœ€è¦ä»£ç è§„èŒƒ**ï¼š
å°±åƒä¹¦æ³•è¦æœ‰ç¬”ç”»é¡ºåºï¼Œä»£ç ä¹Ÿè¦æœ‰ä¹¦å†™è§„èŒƒ

```
å¥½ä»£ç çš„ç‰¹ç‚¹ï¼š
ğŸ‘€ å¯è¯»æ€§å¼º - ä¸€çœ‹å°±æ‡‚åœ¨åšä»€ä¹ˆ
ğŸ”§ æ˜“äºç»´æŠ¤ - æ”¹bugä¸ç”¨çŒœä»£ç æ„æ€  
ğŸ¤ å›¢é˜Ÿåä½œ - å¤§å®¶å†™çš„ä»£ç é£æ ¼ç»Ÿä¸€
ğŸ“ˆ è´¨é‡ä¿è¯ - å‡å°‘ä½çº§é”™è¯¯
```

### 6.2 ç”Ÿäº§è€…ä»£ç è§„èŒƒ



**æ¶ˆæ¯å‘é€æ ‡å‡†æ¨¡æ¿**ï¼š

```java
@Service
@Slf4j
public class OrderEventProducer {
    
    private final RabbitTemplate rabbitTemplate;
    private final String EXCHANGE = "order.events.exchange";
    
    public OrderEventProducer(RabbitTemplate rabbitTemplate) {
        this.rabbitTemplate = rabbitTemplate;
    }
    
    /**
     * å‘é€è®¢å•åˆ›å»ºäº‹ä»¶
     * @param order è®¢å•ä¿¡æ¯
     */
    public void sendOrderCreated(Order order) {
        try {
            // 1. æ„å»ºæ¶ˆæ¯
            OrderCreatedEvent event = buildOrderCreatedEvent(order);
            
            // 2. è®¾ç½®æ¶ˆæ¯å±æ€§
            MessageProperties properties = new MessageProperties();
            properties.setCorrelationId(order.getId());
            properties.setPriority(1);
            
            // 3. å‘é€æ¶ˆæ¯
            rabbitTemplate.send(EXCHANGE, 
                              "order.created.new", 
                              new Message(toJson(event), properties));
            
            log.info("è®¢å•åˆ›å»ºäº‹ä»¶å‘é€æˆåŠŸ: orderId={}", order.getId());
            
        } catch (Exception e) {
            log.error("è®¢å•åˆ›å»ºäº‹ä»¶å‘é€å¤±è´¥: orderId={}, error={}", 
                     order.getId(), e.getMessage(), e);
            // æ ¹æ®ä¸šåŠ¡éœ€è¦å†³å®šæ˜¯å¦æŠ›å‡ºå¼‚å¸¸
            throw new MessageSendException("å‘é€è®¢å•äº‹ä»¶å¤±è´¥", e);
        }
    }
    
    private OrderCreatedEvent buildOrderCreatedEvent(Order order) {
        return OrderCreatedEvent.builder()
            .messageId(generateMessageId())
            .timestamp(Instant.now())
            .orderId(order.getId())
            .userId(order.getUserId())
            .amount(order.getAmount())
            .build();
    }
}
```

**ä»£ç è§„èŒƒè¦ç‚¹**ï¼š
- âœ… ç±»åæ¸…æ™°è¡¨è¾¾èŒè´£
- âœ… æ–¹æ³•åæè¿°å…·ä½“åŠ¨ä½œ  
- âœ… å¼‚å¸¸å¤„ç†è¦å®Œæ•´
- âœ… æ—¥å¿—è®°å½•å…³é”®ä¿¡æ¯
- âœ… æ³¨é‡Šè¯´æ˜é‡è¦é€»è¾‘

### 6.3 æ¶ˆè´¹è€…ä»£ç è§„èŒƒ



**æ¶ˆæ¯å¤„ç†æ ‡å‡†æ¨¡æ¿**ï¼š

```java
@Component
@RabbitListener(queues = "order-service.payment.queue")
@Slf4j
public class PaymentEventConsumer {
    
    private final PaymentService paymentService;
    
    public PaymentEventConsumer(PaymentService paymentService) {
        this.paymentService = paymentService;
    }
    
    /**
     * å¤„ç†æ”¯ä»˜äº‹ä»¶
     */
    @RabbitHandler
    public void handlePaymentEvent(
        @Payload String message,
        @Header Map<String, Object> headers,
        Channel channel,
        @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        
        String correlationId = (String) headers.get("correlationId");
        
        try {
            // 1. è§£ææ¶ˆæ¯
            PaymentEvent event = parsePaymentEvent(message);
            
            // 2. ä¸šåŠ¡å¤„ç†
            processPayment(event);
            
            // 3. æ‰‹åŠ¨ç¡®è®¤
            channel.basicAck(deliveryTag, false);
            
            log.info("æ”¯ä»˜äº‹ä»¶å¤„ç†æˆåŠŸ: correlationId={}, orderId={}", 
                    correlationId, event.getOrderId());
            
        } catch (BusinessException e) {
            // ä¸šåŠ¡å¼‚å¸¸ï¼Œæ‹’ç»æ¶ˆæ¯ä¸é‡è¯•
            rejectMessage(channel, deliveryTag, false, correlationId, e);
            
        } catch (Exception e) {
            // ç³»ç»Ÿå¼‚å¸¸ï¼Œæ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°å…¥é˜Ÿ
            rejectMessage(channel, deliveryTag, true, correlationId, e);
        }
    }
    
    private void rejectMessage(Channel channel, long deliveryTag, 
                              boolean requeue, String correlationId, 
                              Exception e) {
        try {
            channel.basicNack(deliveryTag, false, requeue);
            log.error("æ¶ˆæ¯å¤„ç†å¤±è´¥: correlationId={}, requeue={}, error={}", 
                     correlationId, requeue, e.getMessage(), e);
        } catch (IOException ioException) {
            log.error("æ‹’ç»æ¶ˆæ¯å¤±è´¥: {}", ioException.getMessage());
        }
    }
}
```

### 6.4 é…ç½®ç®¡ç†è§„èŒƒ



**é…ç½®æ–‡ä»¶ç»„ç»‡**ï¼š

```yaml
# application.yml

spring:
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: ${RABBITMQ_VHOST:/}
    
#    # è¿æ¥æ± é…ç½®
    cache:
      connection:
        mode: channel
        size: 50
    
#    # å‘é€ç¡®è®¤
    publisher-confirm-type: correlated
    publisher-returns: true
    
#    # æ¶ˆè´¹é…ç½®
    listener:
      simple:
        acknowledge-mode: manual
        retry:
          enabled: true
          max-attempts: 3
          initial-interval: 1000ms

# ä¸šåŠ¡ç›¸å…³é…ç½®

app:
  rabbitmq:
    exchanges:
      user-events: user.events.exchange
      order-events: order.events.exchange
    queues:
      user-registration: user-service.registration.queue
      order-payment: order-service.payment.queue
```

### 6.5 æµ‹è¯•è§„èŒƒæ ‡å‡†



**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š

```java
@ExtendWith(MockitoExtension.class)
class OrderEventProducerTest {
    
    @Mock
    private RabbitTemplate rabbitTemplate;
    
    @InjectMocks
    private OrderEventProducer producer;
    
    @Test
    @DisplayName("åº”è¯¥æˆåŠŸå‘é€è®¢å•åˆ›å»ºäº‹ä»¶")
    void shouldSendOrderCreatedEventSuccessfully() {
        // Given
        Order order = createTestOrder();
        
        // When
        producer.sendOrderCreated(order);
        
        // Then
        verify(rabbitTemplate).send(
            eq("order.events.exchange"),
            eq("order.created.new"),
            any(Message.class)
        );
    }
    
    @Test
    @DisplayName("å‘é€å¤±è´¥æ—¶åº”è¯¥æŠ›å‡ºå¼‚å¸¸")
    void shouldThrowExceptionWhenSendFails() {
        // Given
        Order order = createTestOrder();
        doThrow(new AmqpException("Connection failed"))
            .when(rabbitTemplate).send(anyString(), anyString(), any());
        
        // When & Then
        assertThatThrownBy(() -> producer.sendOrderCreated(order))
            .isInstanceOf(MessageSendException.class)
            .hasMessageContaining("å‘é€è®¢å•äº‹ä»¶å¤±è´¥");
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ è®¾è®¡è§„èŒƒï¼šç»Ÿä¸€å›¢é˜Ÿå¼€å‘æ ‡å‡†ï¼Œæé«˜åä½œæ•ˆç‡
ğŸ”¸ æ¶ˆæ¯æ ¼å¼ï¼šå®šä¹‰ç»Ÿä¸€çš„æ¶ˆæ¯ç»“æ„ï¼Œä¿è¯ç³»ç»Ÿäº’é€š
ğŸ”¸ å‘½åè§„èŒƒï¼šè®©ç»„ä»¶åç§°è§åçŸ¥æ„ï¼Œä¾¿äºç†è§£ç»´æŠ¤  
ğŸ”¸ ç‰ˆæœ¬ç®¡ç†ï¼šæ”¯æŒç³»ç»Ÿå¹³æ»‘å‡çº§ï¼Œä¿è¯å‘åå…¼å®¹
ğŸ”¸ æ–‡æ¡£è§„èŒƒï¼šå®Œå–„çš„æ–‡æ¡£ä½“ç³»ï¼Œé™ä½å­¦ä¹ æˆæœ¬
ğŸ”¸ ä»£ç è§„èŒƒï¼šç»Ÿä¸€ç¼–ç é£æ ¼ï¼Œæé«˜ä»£ç è´¨é‡
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ è§„èŒƒçš„æœ¬è´¨ä»·å€¼**
```
ä¸æ˜¯ä¸ºäº†é™åˆ¶å¼€å‘è€…çš„è‡ªç”±
è€Œæ˜¯ä¸ºäº†ï¼š
â€¢ é™ä½å›¢é˜Ÿåä½œæˆæœ¬
â€¢ å‡å°‘ç³»ç»Ÿç»´æŠ¤éš¾åº¦  
â€¢ æé«˜ä»£ç å¤ç”¨ä»·å€¼
â€¢ ä¿è¯ç³»ç»Ÿæ‰©å±•èƒ½åŠ›
```

**ğŸ”¹ è§„èŒƒå®æ–½çš„å…³é”®**
```
åˆ¶å®šé˜¶æ®µï¼š
â€¢ å……åˆ†è°ƒç ”ç°æœ‰é—®é¢˜
â€¢ å›¢é˜Ÿå……åˆ†è®¨è®ºç¡®è®¤
â€¢ è€ƒè™‘å®é™…å¯æ“ä½œæ€§

æ‰§è¡Œé˜¶æ®µï¼š
â€¢ ä»£ç å®¡æŸ¥ä¸¥æ ¼æŠŠå…³
â€¢ å·¥å…·è‡ªåŠ¨åŒ–æ£€æŸ¥
â€¢ å®šæœŸå›é¡¾ä¼˜åŒ–è§„èŒƒ
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ“Š è§„èŒƒæ”¶ç›Šè¯„ä¼°**ï¼š

| æ–¹é¢ | **æ— è§„èŒƒ** | **æœ‰è§„èŒƒ** | **æ”¹å–„ç¨‹åº¦** |
|------|------------|------------|--------------|
| æ–°äººä¸Šæ‰‹ | 2-4å‘¨ | 3-5å¤© | ğŸš€ **80%æå‡** |
| Bugæ’æŸ¥ | 2-3å°æ—¶ | 30åˆ†é’Ÿ | ğŸ¯ **75%æå‡** |
| ä»£ç å¤ç”¨ | 20% | 70% | ğŸ“ˆ **250%æå‡** |
| æ–‡æ¡£ç»´æŠ¤ | å¾ˆå°‘æ›´æ–° | åŠæ—¶åŒæ­¥ | âœ… **è´¨é‡ä¿è¯** |

**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **å¾®æœåŠ¡æ¶æ„**ï¼šç»Ÿä¸€æœåŠ¡é—´é€šä¿¡æ ‡å‡†
- **å›¢é˜Ÿåä½œ**ï¼šå‡å°‘æ²Ÿé€šæˆæœ¬ï¼Œæé«˜å¼€å‘æ•ˆç‡
- **ç³»ç»Ÿç»´æŠ¤**ï¼šå¿«é€Ÿå®šä½é—®é¢˜ï¼Œé™ä½ç»´æŠ¤æˆæœ¬
- **æ–°åŠŸèƒ½å¼€å‘**ï¼šåŸºäºè§„èŒƒå¿«é€Ÿå®ç°ï¼Œä¿è¯è´¨é‡

**ğŸ”§ å®æ–½å»ºè®®**
- **å¾ªåºæ¸è¿›**ï¼šä¸è¦ä¸€æ¬¡æ€§åˆ¶å®šå¤ªå¤šè§„èŒƒ
- **å·¥å…·æ”¯æŒ**ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ£€æŸ¥è§„èŒƒéµå®ˆæƒ…å†µ
- **æŒç»­æ”¹è¿›**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¸æ–­ä¼˜åŒ–è§„èŒƒ
- **å›¢é˜Ÿå…±è¯†**ï¼šç¡®ä¿æ‰€æœ‰æˆå‘˜ç†è§£å¹¶è®¤åŒè§„èŒƒä»·å€¼

**æ ¸å¿ƒè®°å¿†**ï¼š
- è®¾è®¡è§„èŒƒæ˜¯å›¢é˜Ÿåä½œçš„åŸºçŸ³ï¼Œä¸æ˜¯æŸç¼šè€Œæ˜¯èµ‹èƒ½
- å¥½çš„è§„èŒƒè®©å¤æ‚çš„ç³»ç»Ÿå˜å¾—ç®€å•å¯æ§
- è§„èŒƒçš„ä»·å€¼åœ¨äºæ‰§è¡Œï¼Œè€Œéåˆ¶å®š
- æŒç»­ä¼˜åŒ–è§„èŒƒï¼Œè®©å…¶çœŸæ­£æœåŠ¡äºä¸šåŠ¡å‘å±•