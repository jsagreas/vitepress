---
title: 6ã€CICDé›†æˆ
---
## ğŸ“š ç›®å½•

1. [DevOpsä¸RabbitMQé›†æˆæ¦‚è¿°](#1-devopsä¸rabbitmqé›†æˆæ¦‚è¿°)
2. [è‡ªåŠ¨åŒ–éƒ¨ç½²ç­–ç•¥](#2-è‡ªåŠ¨åŒ–éƒ¨ç½²ç­–ç•¥)
3. [é…ç½®ç®¡ç†æœ€ä½³å®è·µ](#3-é…ç½®ç®¡ç†æœ€ä½³å®è·µ)
4. [ç¯å¢ƒéš”ç¦»ç­–ç•¥](#4-ç¯å¢ƒéš”ç¦»ç­–ç•¥)
5. [è“ç»¿éƒ¨ç½²å®æ–½æ–¹æ¡ˆ](#5-è“ç»¿éƒ¨ç½²å®æ–½æ–¹æ¡ˆ)
6. [ç°åº¦å‘å¸ƒç­–ç•¥](#6-ç°åº¦å‘å¸ƒç­–ç•¥)
7. [CI/CDç®¡é“é›†æˆ](#7-cicdç®¡é“é›†æˆ)
8. [ç›‘æ§å‘Šè­¦é›†æˆ](#8-ç›‘æ§å‘Šè­¦é›†æˆ)
9. [æ•…éšœæ¢å¤ä¸å›æ»š](#9-æ•…éšœæ¢å¤ä¸å›æ»š)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ DevOpsä¸RabbitMQé›†æˆæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯DevOpsé›†æˆ


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µç†è§£**
```
DevOpsé›†æˆå°±åƒæ˜¯ï¼š
æŠŠè½¯ä»¶å¼€å‘å’Œè¿ç»´å·¥ä½œè¿æ¥èµ·æ¥ï¼Œè®©æ•´ä¸ªè¿‡ç¨‹æ›´é¡ºç•…

ä¼ ç»Ÿæ–¹å¼ vs DevOpsæ–¹å¼ï¼š
ä¼ ç»Ÿï¼šå¼€å‘å†™ä»£ç  â†’ æ‰”ç»™è¿ç»´ â†’ è¿ç»´éƒ¨ç½² â†’ å‡ºé—®é¢˜äº’ç›¸æ¨è´£
DevOpsï¼šå¼€å‘å’Œè¿ç»´ç´§å¯†åä½œ â†’ è‡ªåŠ¨åŒ–æµç¨‹ â†’ å¿«é€Ÿäº¤ä»˜ â†’ å…±åŒè´Ÿè´£

å¯¹äºRabbitMQæ¥è¯´ï¼š
- ä¸å†æ‰‹åŠ¨ä¸€å°å°æœåŠ¡å™¨å®‰è£…
- é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ï¼Œä¸€æ”¹å…¨æ”¹
- éƒ¨ç½²è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- å‡ºé—®é¢˜èƒ½å¿«é€Ÿå®šä½å’Œæ¢å¤
```

**ğŸ’¡ RabbitMQåœ¨DevOpsä¸­çš„é‡è¦æ€§**
```
ä¸ºä»€ä¹ˆRabbitMQéœ€è¦DevOpsé›†æˆï¼Ÿ

ä¸šåŠ¡ç—›ç‚¹ï¼š
â€¢ å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ ¸å¿ƒç»„ä»¶
â€¢ ä¸€æ—¦RabbitMQå‡ºé—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿå¯èƒ½ç˜«ç—ª
â€¢ æ‰‹åŠ¨éƒ¨ç½²æ•ˆç‡ä½ï¼Œå®¹æ˜“å‡ºé”™
â€¢ é…ç½®ä¸ä¸€è‡´å¯¼è‡´ç¯å¢ƒå·®å¼‚

DevOpsè§£å†³æ–¹æ¡ˆï¼š
â€¢ è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œ10åˆ†é’Ÿå®Œæˆé›†ç¾¤æ­å»º
â€¢ é…ç½®å³ä»£ç ï¼Œç‰ˆæœ¬æ§åˆ¶ç®¡ç†
â€¢ ç¯å¢ƒä¸€è‡´æ€§ï¼Œå¼€å‘æµ‹è¯•ç”Ÿäº§å®Œå…¨ç›¸åŒ
â€¢ å¿«é€Ÿæ‰©å®¹ç¼©å®¹ï¼Œåº”å¯¹æµé‡å˜åŒ–
```

### 1.2 DevOpsé›†æˆæ¶æ„å›¾


```
å¼€å‘é˜¶æ®µ                   æµ‹è¯•é˜¶æ®µ                   ç”Ÿäº§é˜¶æ®µ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»£ç ä»“åº“   â”‚           â”‚  æµ‹è¯•ç¯å¢ƒ   â”‚           â”‚  ç”Ÿäº§ç¯å¢ƒ   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚RabbitMQ â”‚ â”‚    CI     â”‚ â”‚RabbitMQ â”‚ â”‚    CD     â”‚ â”‚RabbitMQ â”‚ â”‚
â”‚ â”‚é…ç½®æ–‡ä»¶ â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚é›†ç¾¤æµ‹è¯• â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ â”‚é›†ç¾¤ç”Ÿäº§ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                         â†‘                         â†‘
   Gitç®¡ç†               è‡ªåŠ¨åŒ–æµ‹è¯•               ç›‘æ§å‘Šè­¦
   
æµç¨‹è¯´æ˜ï¼š
1. å¼€å‘äººå‘˜æäº¤é…ç½®æ›´æ”¹åˆ°Git
2. CIç³»ç»Ÿè‡ªåŠ¨æ„å»ºå’Œæµ‹è¯•
3. æµ‹è¯•é€šè¿‡åè‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
4. éªŒè¯æ— è¯¯åéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
5. å…¨ç¨‹ç›‘æ§ï¼Œé—®é¢˜è‡ªåŠ¨å‘Šè­¦
```

### 1.3 é›†æˆå¸¦æ¥çš„æ ¸å¿ƒä»·å€¼


**ğŸ“ˆ æ•ˆç‡æå‡å¯¹æ¯”**
| ä¼ ç»Ÿæ–¹å¼ | DevOpsæ–¹å¼ | æ”¹å–„æ•ˆæœ |
|---------|-----------|---------|
| **éƒ¨ç½²æ—¶é—´** | `2-4å°æ—¶æ‰‹åŠ¨éƒ¨ç½²` | `10-15åˆ†é’Ÿè‡ªåŠ¨éƒ¨ç½²` | `æå‡90%` |
| **é”™è¯¯ç‡** | `äººå·¥æ“ä½œæ˜“å‡ºé”™` | `è‡ªåŠ¨åŒ–æ ‡å‡†æµç¨‹` | `é™ä½80%` |
| **å›æ»šæ—¶é—´** | `30-60åˆ†é’Ÿ` | `2-5åˆ†é’Ÿ` | `æå‡85%` |
| **ç¯å¢ƒä¸€è‡´æ€§** | `ç»å¸¸ä¸ä¸€è‡´` | `å®Œå…¨ä¸€è‡´` | `é—®é¢˜å‡å°‘95%` |

---

## 2. ğŸ”§ è‡ªåŠ¨åŒ–éƒ¨ç½²ç­–ç•¥


### 2.1 åŸºç¡€è®¾æ–½å³ä»£ç (IaC)


**ğŸ—ï¸ ä»€ä¹ˆæ˜¯åŸºç¡€è®¾æ–½å³ä»£ç **
```
ç®€å•ç†è§£ï¼š
æŠŠæœåŠ¡å™¨ã€ç½‘ç»œã€å­˜å‚¨ç­‰åŸºç¡€è®¾æ–½çš„é…ç½®å†™æˆä»£ç 
å°±åƒå†™ç¨‹åºä¸€æ ·ç®¡ç†åŸºç¡€è®¾æ–½

å¥½å¤„ï¼š
â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼šå¯ä»¥çœ‹åˆ°æ¯æ¬¡æ”¹äº†ä»€ä¹ˆ
â€¢ é‡å¤ä½¿ç”¨ï¼šä¸€å¥—é…ç½®å¯ä»¥åˆ›å»ºå¤šä¸ªç›¸åŒç¯å¢ƒ
â€¢ è‡ªåŠ¨åŒ–ï¼šä¸éœ€è¦æ‰‹åŠ¨ç‚¹å‡»ç•Œé¢é…ç½®
â€¢ æ ‡å‡†åŒ–ï¼šæ‰€æœ‰ç¯å¢ƒå®Œå…¨ä¸€è‡´
```

**ğŸ› ï¸ Terraforméƒ¨ç½²RabbitMQé›†ç¾¤**
```hcl
# terraform/rabbitmq-cluster.tf
# åˆ›å»ºRabbitMQé›†ç¾¤çš„åŸºç¡€è®¾æ–½

# å®šä¹‰å˜é‡
variable "cluster_size" {
  description = "RabbitMQé›†ç¾¤èŠ‚ç‚¹æ•°é‡"
  default     = 3
}

variable "instance_type" {
  description = "æœåŠ¡å™¨è§„æ ¼"
  default     = "t3.medium"
}

# åˆ›å»ºå®‰å…¨ç»„
resource "aws_security_group" "rabbitmq" {
  name = "rabbitmq-cluster-sg"
  
  # RabbitMQç®¡ç†ç•Œé¢
  ingress {
    from_port   = 15672
    to_port     = 15672
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }
  
  # RabbitMQæœåŠ¡ç«¯å£
  ingress {
    from_port   = 5672
    to_port     = 5672
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }
  
  # é›†ç¾¤é€šä¿¡ç«¯å£
  ingress {
    from_port   = 25672
    to_port     = 25672
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }
}

# åˆ›å»ºRabbitMQæœåŠ¡å™¨
resource "aws_instance" "rabbitmq" {
  count           = var.cluster_size
  ami             = "ami-0c55b159cbfafe1d0"  # Ubuntu 20.04
  instance_type   = var.instance_type
  security_groups = [aws_security_group.rabbitmq.name]
  
  tags = {
    Name = "rabbitmq-node-${count.index + 1}"
    Type = "rabbitmq"
  }
  
  # å¯åŠ¨åè‡ªåŠ¨å®‰è£…RabbitMQ
  user_data = file("install-rabbitmq.sh")
}
```

### 2.2 å®¹å™¨åŒ–éƒ¨ç½²


**ğŸ³ Docker Composeæ–¹å¼**
```yaml
# docker-compose.yml
# ç®€å•æ˜“æ‡‚çš„RabbitMQé›†ç¾¤é…ç½®

version: '3.8'

services:
  # ç¬¬ä¸€ä¸ªRabbitMQèŠ‚ç‚¹
  rabbitmq1:
    image: rabbitmq:3.11-management
    hostname: rabbit1
    environment:
      # é›†ç¾¤é…ç½®
      RABBITMQ_ERLANG_COOKIE: 'secret_cookie_string'
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: password123
    volumes:
      # æ•°æ®æŒä¹…åŒ–
      - rabbitmq1_data:/var/lib/rabbitmq
      # é…ç½®æ–‡ä»¶
      - ./config/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf
    ports:
      - "5672:5672"    # æœåŠ¡ç«¯å£
      - "15672:15672"  # ç®¡ç†ç•Œé¢
    networks:
      - rabbitmq_cluster

  # ç¬¬äºŒä¸ªRabbitMQèŠ‚ç‚¹
  rabbitmq2:
    image: rabbitmq:3.11-management
    hostname: rabbit2
    environment:
      RABBITMQ_ERLANG_COOKIE: 'secret_cookie_string'
    volumes:
      - rabbitmq2_data:/var/lib/rabbitmq
      - ./config/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf
    depends_on:
      - rabbitmq1
    networks:
      - rabbitmq_cluster

  # ç¬¬ä¸‰ä¸ªRabbitMQèŠ‚ç‚¹
  rabbitmq3:
    image: rabbitmq:3.11-management
    hostname: rabbit3
    environment:
      RABBITMQ_ERLANG_COOKIE: 'secret_cookie_string'
    volumes:
      - rabbitmq3_data:/var/lib/rabbitmq
      - ./config/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf
    depends_on:
      - rabbitmq1
    networks:
      - rabbitmq_cluster

# ç½‘ç»œé…ç½®
networks:
  rabbitmq_cluster:
    driver: bridge

# æ•°æ®å·é…ç½®
volumes:
  rabbitmq1_data:
  rabbitmq2_data:
  rabbitmq3_data:
```

### 2.3 Kuberneteséƒ¨ç½²


**âš™ï¸ Helm Chartéƒ¨ç½²**
```yaml
# values.yaml
# RabbitMQçš„Helmé…ç½®æ–‡ä»¶

# é›†ç¾¤é…ç½®
replicaCount: 3

# é•œåƒé…ç½®
image:
  repository: rabbitmq
  tag: "3.11-management"
  pullPolicy: IfNotPresent

# æœåŠ¡é…ç½®
service:
  type: ClusterIP
  port: 5672
  managementPort: 15672

# æŒä¹…åŒ–å­˜å‚¨
persistence:
  enabled: true
  size: 10Gi
  storageClass: "standard"

# èµ„æºé…ç½®
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "500m"

# è®¤è¯é…ç½®
auth:
  username: admin
  password: "password123"
  erlangCookie: "secret_cookie_string"

# é«˜å¯ç”¨é…ç½®
clustering:
  enabled: true
  rebalance: true
```

**ğŸš€ éƒ¨ç½²å‘½ä»¤**
```bash
# æ·»åŠ RabbitMQ Helmä»“åº“
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# éƒ¨ç½²RabbitMQé›†ç¾¤
helm install my-rabbitmq bitnami/rabbitmq \
  --values values.yaml \
  --namespace rabbitmq \
  --create-namespace

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
kubectl get pods -n rabbitmq
kubectl get svc -n rabbitmq
```

---

## 3. âš™ï¸ é…ç½®ç®¡ç†æœ€ä½³å®è·µ


### 3.1 é…ç½®å³ä»£ç 


**ğŸ“ é…ç½®æ–‡ä»¶ç‰ˆæœ¬åŒ–ç®¡ç†**
```
ä¸ºä»€ä¹ˆè¦æŠŠé…ç½®å½“ä½œä»£ç ç®¡ç†ï¼Ÿ

ä¼ ç»Ÿç—›ç‚¹ï¼š
â€¢ é…ç½®æ–‡ä»¶æ•£è½åœ¨å„ä¸ªæœåŠ¡å™¨ä¸Š
â€¢ ä¿®æ”¹é…ç½®éœ€è¦é€å°ç™»å½•æœåŠ¡å™¨
â€¢ ä¸çŸ¥é“è°ä»€ä¹ˆæ—¶å€™æ”¹äº†ä»€ä¹ˆ
â€¢ å‡ºé—®é¢˜æ—¶éš¾ä»¥å¿«é€Ÿå›æ»š

é…ç½®å³ä»£ç çš„å¥½å¤„ï¼š
â€¢ æ‰€æœ‰é…ç½®éƒ½åœ¨Gité‡Œï¼Œæœ‰å†å²è®°å½•
â€¢ ä¿®æ”¹é…ç½®å°±åƒä¿®æ”¹ä»£ç ï¼Œéœ€è¦å®¡æ ¸
â€¢ ä¸€æ¬¡ä¿®æ”¹ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰æœåŠ¡å™¨
â€¢ å¯ä»¥å¿«é€Ÿå›æ»šåˆ°ä»»ä½•å†å²ç‰ˆæœ¬
```

**ğŸ”§ RabbitMQé…ç½®æ–‡ä»¶ç»“æ„**
```
config/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ rabbitmq.conf          # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”‚   â””â”€â”€ definitions.json       # é˜Ÿåˆ—ã€äº¤æ¢æœºå®šä¹‰
â”‚   â”œâ”€â”€ test/
â”‚   â”‚   â”œâ”€â”€ rabbitmq.conf          # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”‚   â””â”€â”€ definitions.json
â”‚   â””â”€â”€ prod/
â”‚       â”œâ”€â”€ rabbitmq.conf          # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚       â””â”€â”€ definitions.json
â”œâ”€â”€ common/
â”‚   â””â”€â”€ base.conf                  # é€šç”¨é…ç½®
â””â”€â”€ templates/
    â””â”€â”€ rabbitmq.conf.j2           # é…ç½®æ¨¡æ¿
```

### 3.2 ç¯å¢ƒé…ç½®å·®å¼‚åŒ–ç®¡ç†


**ğŸ¯ ä¸åŒç¯å¢ƒçš„é…ç½®ç­–ç•¥**
```yaml
# config/environments/dev/config.yaml
# å¼€å‘ç¯å¢ƒé…ç½® - æ³¨é‡å¼€å‘ä¾¿åˆ©æ€§

rabbitmq:
  # é›†ç¾¤é…ç½®
  cluster:
    nodes: 1                    # å¼€å‘ç¯å¢ƒå•èŠ‚ç‚¹å³å¯
    
  # æ€§èƒ½é…ç½®
  vm_memory_high_watermark: 0.6  # å†…å­˜ä½¿ç”¨é˜ˆå€¼ç¨é«˜
  disk_free_limit: 1GB           # ç£ç›˜ç©ºé—´è¦æ±‚è¾ƒä½
  
  # æ—¥å¿—é…ç½®
  log_level: debug              # è¯¦ç»†æ—¥å¿—ä¾¿äºè°ƒè¯•
  
  # ç®¡ç†ç•Œé¢
  management:
    enabled: true
    port: 15672
    
  # å¼€å‘ä¾¿åˆ©è®¾ç½®
  default_user: dev
  default_pass: dev123
```

```yaml
# config/environments/prod/config.yaml  
# ç”Ÿäº§ç¯å¢ƒé…ç½® - æ³¨é‡ç¨³å®šæ€§å’Œå®‰å…¨

rabbitmq:
  # é›†ç¾¤é…ç½®
  cluster:
    nodes: 3                    # ç”Ÿäº§ç¯å¢ƒé«˜å¯ç”¨
    
  # æ€§èƒ½é…ç½®
  vm_memory_high_watermark: 0.4  # æ›´ä¿å®ˆçš„å†…å­˜ä½¿ç”¨
  disk_free_limit: 10GB          # æ›´å¤§çš„ç£ç›˜ç©ºé—´ç¼“å†²
  
  # æ—¥å¿—é…ç½®
  log_level: info               # é€‚ä¸­çš„æ—¥å¿—çº§åˆ«
  
  # å®‰å…¨é…ç½®
  default_user: ${RABBITMQ_USER}     # ä»ç¯å¢ƒå˜é‡è¯»å–
  default_pass: ${RABBITMQ_PASS}     # å¯†ç ä¸å†™æ­»åœ¨é…ç½®é‡Œ
  
  # SSLé…ç½®
  ssl:
    enabled: true
    cert_file: /etc/ssl/certs/rabbitmq.crt
    key_file: /etc/ssl/private/rabbitmq.key
```

### 3.3 åŠ¨æ€é…ç½®æ›´æ–°


**ğŸ”„ é…ç½®çƒ­æ›´æ–°æœºåˆ¶**
```bash
#!/bin/bash
# scripts/update-config.sh
# é…ç½®æ›´æ–°è„šæœ¬

set -e

ENVIRONMENT=$1
CONFIG_FILE="config/environments/${ENVIRONMENT}/rabbitmq.conf"

if [ -z "$ENVIRONMENT" ]; then
    echo "ç”¨æ³•: $0 <environment>"
    echo "æ”¯æŒçš„ç¯å¢ƒ: dev, test, prod"
    exit 1
fi

echo "å¼€å§‹æ›´æ–° $ENVIRONMENT ç¯å¢ƒçš„RabbitMQé…ç½®..."

# 1. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
echo "éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•..."
if ! rabbitmq-diagnostics check_config $CONFIG_FILE; then
    echo "é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼"
    exit 1
fi

# 2. å¤‡ä»½å½“å‰é…ç½®
BACKUP_DIR="/backup/rabbitmq/$(date +%Y%m%d_%H%M%S)"
mkdir -p $BACKUP_DIR
cp /etc/rabbitmq/rabbitmq.conf $BACKUP_DIR/

# 3. åº”ç”¨æ–°é…ç½®
echo "åº”ç”¨æ–°é…ç½®..."
cp $CONFIG_FILE /etc/rabbitmq/rabbitmq.conf

# 4. é‡æ–°åŠ è½½é…ç½®ï¼ˆä¸é‡å¯æœåŠ¡ï¼‰
echo "é‡æ–°åŠ è½½é…ç½®..."
rabbitmqctl eval 'application:stop(rabbitmq_management), application:start(rabbitmq_management).'

# 5. éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
echo "éªŒè¯é…ç½®..."
if rabbitmqctl status > /dev/null 2>&1; then
    echo "é…ç½®æ›´æ–°æˆåŠŸï¼"
else
    echo "é…ç½®æ›´æ–°å¤±è´¥ï¼Œæ­£åœ¨å›æ»š..."
    cp $BACKUP_DIR/rabbitmq.conf /etc/rabbitmq/
    rabbitmqctl stop_app
    rabbitmqctl start_app
    echo "å·²å›æ»šåˆ°ä¹‹å‰çš„é…ç½®"
    exit 1
fi
```

---

## 4. ğŸ¢ ç¯å¢ƒéš”ç¦»ç­–ç•¥


### 4.1 ç½‘ç»œå±‚é¢éš”ç¦»


**ğŸŒ ç½‘ç»œéš”ç¦»æ¶æ„**
```
å¤šç¯å¢ƒç½‘ç»œéš”ç¦»ç¤ºæ„å›¾ï¼š

ç”Ÿäº§ç¯å¢ƒ VPC (10.0.0.0/16)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿäº§RabbitMQé›†ç¾¤               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Node1â”‚ â”‚Node2â”‚ â”‚Node3â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æµ‹è¯•ç¯å¢ƒ VPC (10.1.0.0/16)  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµ‹è¯•RabbitMQé›†ç¾¤               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚Node1â”‚ â”‚Node2â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¼€å‘ç¯å¢ƒ VPC (10.2.0.0/16)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼€å‘RabbitMQ                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚Node1â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éš”ç¦»æ•ˆæœï¼š
- ä¸åŒç¯å¢ƒå®Œå…¨éš”ç¦»ï¼Œç›¸äº’æ— æ³•è®¿é—®
- å³ä½¿é…ç½®é”™è¯¯ä¹Ÿä¸ä¼šå½±å“å…¶ä»–ç¯å¢ƒ
- å¯ä»¥ç‹¬ç«‹æµ‹è¯•ç½‘ç»œç­–ç•¥
```

### 4.2 å‘½åç©ºé—´éš”ç¦»


**ğŸ·ï¸ Kuberneteså‘½åç©ºé—´éš”ç¦»**
```yaml
# namespace-isolation.yaml
# åˆ›å»ºä¸åŒç¯å¢ƒçš„å‘½åç©ºé—´

# å¼€å‘ç¯å¢ƒå‘½åç©ºé—´
apiVersion: v1
kind: Namespace
metadata:
  name: rabbitmq-dev
  labels:
    environment: development
    team: backend

---
# æµ‹è¯•ç¯å¢ƒå‘½åç©ºé—´  
apiVersion: v1
kind: Namespace
metadata:
  name: rabbitmq-test
  labels:
    environment: testing
    team: backend

---
# ç”Ÿäº§ç¯å¢ƒå‘½åç©ºé—´
apiVersion: v1
kind: Namespace
metadata:
  name: rabbitmq-prod
  labels:
    environment: production
    team: backend

---
# ç½‘ç»œç­–ç•¥ - ç¯å¢ƒé—´éš”ç¦»
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-cross-environment
  namespace: rabbitmq-prod
spec:
  podSelector: {}  # åº”ç”¨åˆ°æ‰€æœ‰Pod
  policyTypes:
  - Ingress
  - Egress
  ingress:
  # åªå…è®¸åŒä¸€å‘½åç©ºé—´å†…çš„è®¿é—®
  - from:
    - namespaceSelector:
        matchLabels:
          name: rabbitmq-prod
```

### 4.3 æ•°æ®éš”ç¦»


**ğŸ’¾ æ•°æ®å­˜å‚¨éš”ç¦»ç­–ç•¥**
```yaml
# storage-isolation.yaml
# ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„å­˜å‚¨

# å¼€å‘ç¯å¢ƒå­˜å‚¨
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: rabbitmq-data-dev
  namespace: rabbitmq-dev
spec:
  storageClassName: fast-ssd
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi

---
# ç”Ÿäº§ç¯å¢ƒå­˜å‚¨
apiVersion: v1  
kind: PersistentVolumeClaim
metadata:
  name: rabbitmq-data-prod
  namespace: rabbitmq-prod
spec:
  storageClassName: enterprise-ssd
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi  # ç”Ÿäº§ç¯å¢ƒéœ€è¦æ›´å¤§å­˜å‚¨
```

**ğŸ”’ æƒé™éš”ç¦»**
```yaml
# rbac-isolation.yaml
# åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

# å¼€å‘å›¢é˜Ÿè§’è‰²
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: rabbitmq-dev-admin
  namespace: rabbitmq-dev
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps"]
  verbs: ["get", "list", "create", "update", "delete"]

---
# è¿ç»´å›¢é˜Ÿè§’è‰²ï¼ˆå¯ä»¥è®¿é—®æ‰€æœ‰ç¯å¢ƒï¼‰
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: rabbitmq-ops-admin
rules:
- apiGroups: [""]
  resources: ["*"]
  verbs: ["*"]
```

---

## 5. ğŸ”„ è“ç»¿éƒ¨ç½²å®æ–½æ–¹æ¡ˆ


### 5.1 è“ç»¿éƒ¨ç½²æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è“ç»¿éƒ¨ç½²**
```
è“ç»¿éƒ¨ç½²å°±åƒæ˜¯ï¼š
å‡†å¤‡ä¸¤å¥—å®Œå…¨ç›¸åŒçš„ç¯å¢ƒï¼Œä¸€å¥—æ­£åœ¨æœåŠ¡ç”¨æˆ·ï¼ˆè“ï¼‰ï¼Œä¸€å¥—å¾…æœºï¼ˆç»¿ï¼‰

éƒ¨ç½²æµç¨‹ï¼š
1. è“ç¯å¢ƒæ­£åœ¨æœåŠ¡ç”¨æˆ·
2. åœ¨ç»¿ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬
3. æµ‹è¯•ç»¿ç¯å¢ƒæ²¡é—®é¢˜
4. åˆ‡æ¢æµé‡åˆ°ç»¿ç¯å¢ƒ
5. è“ç¯å¢ƒå˜æˆå¾…æœºçŠ¶æ€

å¥½å¤„ï¼š
â€¢ é›¶åœæœºéƒ¨ç½² - ç”¨æˆ·æ„Ÿè§‰ä¸åˆ°æœåŠ¡ä¸­æ–­
â€¢ å¿«é€Ÿå›æ»š - å‡ºé—®é¢˜ç«‹å³åˆ‡å›åŸç¯å¢ƒ
â€¢ é£é™©é™ä½ - æ–°ç‰ˆæœ¬é—®é¢˜ä¸å½±å“ç”¨æˆ·
```

### 5.2 RabbitMQè“ç»¿éƒ¨ç½²æ¶æ„


```
è“ç»¿éƒ¨ç½²æ¶æ„å›¾ï¼š

             è´Ÿè½½å‡è¡¡å™¨
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼
  è“ç¯å¢ƒ (Blue)      ç»¿ç¯å¢ƒ (Green)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RabbitMQ      â”‚ â”‚   RabbitMQ      â”‚
â”‚   é›†ç¾¤ v1.0     â”‚ â”‚   é›†ç¾¤ v2.0     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚Node1â”‚Node2â”‚   â”‚ â”‚ â”‚Node1â”‚Node2â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     å½“å‰æœåŠ¡            å¾…éƒ¨ç½²ç‰ˆæœ¬

éƒ¨ç½²æ­¥éª¤ï¼š
1. è“ç¯å¢ƒæ­£å¸¸æœåŠ¡
2. ç»¿ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬
3. å¥åº·æ£€æŸ¥é€šè¿‡ååˆ‡æ¢æµé‡
4. è“ç¯å¢ƒä¿ç•™ä¸€æ®µæ—¶é—´ç”¨äºå›æ»š
```

### 5.3 è´Ÿè½½å‡è¡¡å™¨é…ç½®


**âš™ï¸ HAProxyè“ç»¿åˆ‡æ¢é…ç½®**
```
# haproxy.cfg
# HAProxyé…ç½®æ–‡ä»¶æ”¯æŒè“ç»¿éƒ¨ç½²

global
    daemon
    log stdout local0 info

defaults
    mode tcp
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

# RabbitMQå‰ç«¯é…ç½®
frontend rabbitmq_frontend
    bind *:5672
    # æ ¹æ®ACLè§„åˆ™é€‰æ‹©åç«¯
    use_backend rabbitmq_green if { env(ACTIVE_ENV) eq green }
    default_backend rabbitmq_blue

# è“ç¯å¢ƒåç«¯
backend rabbitmq_blue
    balance roundrobin
    option tcp-check
    # å¥åº·æ£€æŸ¥
    tcp-check connect port 5672
    server blue1 10.0.1.10:5672 check
    server blue2 10.0.1.11:5672 check

# ç»¿ç¯å¢ƒåç«¯  
backend rabbitmq_green
    balance roundrobin
    option tcp-check
    tcp-check connect port 5672
    server green1 10.0.2.10:5672 check
    server green2 10.0.2.11:5672 check

# ç®¡ç†ç•Œé¢å‰ç«¯
frontend rabbitmq_mgmt_frontend
    bind *:15672
    use_backend rabbitmq_mgmt_green if { env(ACTIVE_ENV) eq green }
    default_backend rabbitmq_mgmt_blue

# è“ç¯å¢ƒç®¡ç†åç«¯
backend rabbitmq_mgmt_blue
    balance roundrobin
    option httpchk GET /api/health/checks/virtual-hosts
    server blue1 10.0.1.10:15672 check
    server blue2 10.0.1.11:15672 check

# ç»¿ç¯å¢ƒç®¡ç†åç«¯
backend rabbitmq_mgmt_green
    balance roundrobin  
    option httpchk GET /api/health/checks/virtual-hosts
    server green1 10.0.2.10:15672 check
    server green2 10.0.2.11:15672 check
```

### 5.4 è‡ªåŠ¨åŒ–è“ç»¿åˆ‡æ¢è„šæœ¬


**ğŸ”„ åˆ‡æ¢æµç¨‹è‡ªåŠ¨åŒ–**
```bash
#!/bin/bash
# scripts/blue-green-deploy.sh
# è“ç»¿éƒ¨ç½²è‡ªåŠ¨åŒ–è„šæœ¬

set -e

# é…ç½®å˜é‡
BLUE_ENV="rabbitmq-blue"
GREEN_ENV="rabbitmq-green"
CURRENT_ENV=$(curl -s http://admin:password@localhost:15672/api/nodes | jq -r '.[0].name' | cut -d'@' -f2)

echo "å¼€å§‹è“ç»¿éƒ¨ç½²æµç¨‹..."

# 1. ç¡®å®šå½“å‰ç¯å¢ƒå’Œç›®æ ‡ç¯å¢ƒ
if [[ $CURRENT_ENV == *"blue"* ]]; then
    CURRENT="blue"
    TARGET="green"
    TARGET_NAMESPACE=$GREEN_ENV
else
    CURRENT="green"  
    TARGET="blue"
    TARGET_NAMESPACE=$BLUE_ENV
fi

echo "å½“å‰ç¯å¢ƒ: $CURRENT"
echo "ç›®æ ‡ç¯å¢ƒ: $TARGET"

# 2. éƒ¨ç½²æ–°ç‰ˆæœ¬åˆ°ç›®æ ‡ç¯å¢ƒ
echo "æ­£åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬åˆ° $TARGET ç¯å¢ƒ..."
helm upgrade --install rabbitmq-$TARGET bitnami/rabbitmq \
    --namespace $TARGET_NAMESPACE \
    --values config/environments/$TARGET/values.yaml \
    --wait --timeout=600s

# 3. å¥åº·æ£€æŸ¥
echo "è¿›è¡Œå¥åº·æ£€æŸ¥..."
for i in {1..30}; do
    if kubectl exec -n $TARGET_NAMESPACE rabbitmq-$TARGET-0 -- \
       rabbitmq-diagnostics ping > /dev/null 2>&1; then
        echo "å¥åº·æ£€æŸ¥é€šè¿‡"
        break
    fi
    echo "ç­‰å¾…æœåŠ¡å¯åŠ¨... ($i/30)"
    sleep 10
done

# 4. åˆ‡æ¢æµé‡
echo "åˆ‡æ¢æµé‡åˆ° $TARGET ç¯å¢ƒ..."
# æ›´æ–°HAProxyé…ç½®
export ACTIVE_ENV=$TARGET
docker exec haproxy sh -c "export ACTIVE_ENV=$TARGET && /usr/local/bin/reload-haproxy.sh"

# 5. éªŒè¯åˆ‡æ¢ç»“æœ
echo "éªŒè¯æµé‡åˆ‡æ¢..."
sleep 30
NEW_ENV=$(curl -s http://admin:password@localhost:15672/api/nodes | jq -r '.[0].name' | cut -d'@' -f2)

if [[ $NEW_ENV == *"$TARGET"* ]]; then
    echo "âœ… è“ç»¿éƒ¨ç½²æˆåŠŸï¼å½“å‰ç¯å¢ƒ: $TARGET"
    
    # 6. ä¿ç•™æ—§ç¯å¢ƒ30åˆ†é’Ÿç”¨äºå¿«é€Ÿå›æ»š
    echo "æ—§ç¯å¢ƒå°†åœ¨30åˆ†é’Ÿåè‡ªåŠ¨æ¸…ç†"
    (sleep 1800 && helm uninstall rabbitmq-$CURRENT -n $CURRENT_NAMESPACE) &
else
    echo "âŒ è“ç»¿éƒ¨ç½²å¤±è´¥ï¼Œæ­£åœ¨å›æ»š..."
    export ACTIVE_ENV=$CURRENT
    docker exec haproxy sh -c "export ACTIVE_ENV=$CURRENT && /usr/local/bin/reload-haproxy.sh"
    exit 1
fi
```

---

## 6. ğŸ“Š ç°åº¦å‘å¸ƒç­–ç•¥


### 6.1 ç°åº¦å‘å¸ƒæ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ**
```
ç°åº¦å‘å¸ƒå°±åƒæ˜¯ï¼š
æ–°åŠŸèƒ½ä¸æ˜¯ä¸€ä¸‹å­ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œè€Œæ˜¯å…ˆç»™ä¸€å°éƒ¨åˆ†ç”¨æˆ·è¯•ç”¨

å‘å¸ƒç­–ç•¥ï¼š
â€¢ 5%ç”¨æˆ·å…ˆè¯•ç”¨æ–°ç‰ˆæœ¬
â€¢ è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œæ²¡é—®é¢˜å†æ‰©å¤§åˆ°20%
â€¢ é€æ­¥å¢åŠ åˆ°50%ã€80%ã€100%
â€¢ ä»»ä½•æ—¶å€™å‘ç°é—®é¢˜éƒ½å¯ä»¥å¿«é€Ÿå›æ»š

å¯¹äºRabbitMQçš„ç°åº¦å‘å¸ƒï¼š
â€¢ éƒ¨åˆ†æ¶ˆæ¯è·¯ç”±åˆ°æ–°ç‰ˆæœ¬RabbitMQ
â€¢ å¤§éƒ¨åˆ†æ¶ˆæ¯ä»èµ°è€ç‰ˆæœ¬
â€¢ é€æ­¥å¢åŠ æ–°ç‰ˆæœ¬çš„æµé‡æ¯”ä¾‹
â€¢ ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€æ€§èƒ½ç¨³å®š
```

### 6.2 åŸºäºæ¶ˆæ¯è·¯ç”±çš„ç°åº¦ç­–ç•¥


**ğŸ¯ æ¶ˆæ¯è·¯ç”±ç°åº¦æ–¹æ¡ˆ**
```yaml
# ç°åº¦å‘å¸ƒçš„æ¶ˆæ¯è·¯ç”±é…ç½®
# é€šè¿‡æ¶ˆæ¯è·¯ç”±é”®å®ç°æµé‡åˆ†æµ

# ç”Ÿäº§è€…ç«¯ç°åº¦é…ç½®
gray_release:
  # ç°åº¦æ¯”ä¾‹é…ç½®
  traffic_split:
    stable_version: 80    # 80%æµé‡èµ°ç¨³å®šç‰ˆæœ¬
    canary_version: 20    # 20%æµé‡èµ°ç°åº¦ç‰ˆæœ¬
  
  # è·¯ç”±è§„åˆ™
  routing_rules:
    # ç‰¹å®šç”¨æˆ·IDèµ°ç°åº¦ç‰ˆæœ¬
    canary_users: [10001, 10002, 10003]
    # ç‰¹å®šåœ°åŒºèµ°ç°åº¦ç‰ˆæœ¬  
    canary_regions: ["beijing", "shanghai"]
    # æµ‹è¯•æ¶ˆæ¯èµ°ç°åº¦ç‰ˆæœ¬
    test_message_pattern: "test.*"
```

**ğŸ“¨ åº”ç”¨å±‚ç°åº¦é€»è¾‘**
```java
@Service
public class GrayReleaseMessageProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @Value("${gray.release.canary.percentage:10}")
    private int canaryPercentage;
    
    public void sendMessage(String message, String userId) {
        // å†³å®šæ¶ˆæ¯è·¯ç”±ç­–ç•¥
        String exchange = determineExchange(userId, message);
        
        // å‘é€æ¶ˆæ¯
        rabbitTemplate.convertAndSend(exchange, "routing.key", message);
        
        // è®°å½•ç°åº¦æ—¥å¿—
        logGrayReleaseInfo(exchange, userId, message);
    }
    
    private String determineExchange(String userId, String message) {
        // 1. æ£€æŸ¥æ˜¯å¦æ˜¯ç°åº¦ç”¨æˆ·
        if (isCanaryUser(userId)) {
            return "exchange.canary";
        }
        
        // 2. æ£€æŸ¥æ˜¯å¦æ˜¯æµ‹è¯•æ¶ˆæ¯
        if (message.startsWith("test.")) {
            return "exchange.canary";
        }
        
        // 3. æŒ‰ç™¾åˆ†æ¯”éšæœºåˆ†æµ
        if (ThreadLocalRandom.current().nextInt(100) < canaryPercentage) {
            return "exchange.canary";
        }
        
        // 4. é»˜è®¤èµ°ç¨³å®šç‰ˆæœ¬
        return "exchange.stable";
    }
    
    private boolean isCanaryUser(String userId) {
        // ç°åº¦ç”¨æˆ·åˆ—è¡¨ï¼ˆå¯ä»¥ä»é…ç½®ä¸­å¿ƒè¯»å–ï¼‰
        Set<String> canaryUsers = Set.of("10001", "10002", "10003");
        return canaryUsers.contains(userId);
    }
    
    private void logGrayReleaseInfo(String exchange, String userId, String message) {
        String version = exchange.contains("canary") ? "canary" : "stable";
        log.info("Gray Release - User: {}, Version: {}, Message: {}", 
                userId, version, message.substring(0, Math.min(50, message.length())));
    }
}
```

### 6.3 ç°åº¦å‘å¸ƒç›‘æ§


**ğŸ“ˆ ç°åº¦è¿‡ç¨‹ç›‘æ§æŒ‡æ ‡**
```yaml
# prometheusç›‘æ§é…ç½®
# monitoring/gray-release-metrics.yaml

# ç°åº¦å‘å¸ƒç›¸å…³æŒ‡æ ‡
gray_release_metrics:
  # æµé‡åˆ†å¸ƒç›‘æ§
  traffic_distribution:
    - metric: rabbitmq_messages_published_total
      labels: [exchange, version]
      description: "å„ç‰ˆæœ¬æ¶ˆæ¯å‘å¸ƒé‡"
    
    - metric: rabbitmq_messages_consumed_total  
      labels: [queue, version]
      description: "å„ç‰ˆæœ¬æ¶ˆæ¯æ¶ˆè´¹é‡"
  
  # æ€§èƒ½æŒ‡æ ‡ç›‘æ§
  performance_metrics:
    - metric: rabbitmq_message_latency_seconds
      labels: [version]
      description: "æ¶ˆæ¯å»¶è¿Ÿå¯¹æ¯”"
      
    - metric: rabbitmq_connection_count
      labels: [version]
      description: "è¿æ¥æ•°å¯¹æ¯”"
  
  # é”™è¯¯ç‡ç›‘æ§
  error_metrics:
    - metric: rabbitmq_messages_returned_total
      labels: [version, reason]
      description: "æ¶ˆæ¯é€€å›æ•°"
      
    - metric: application_errors_total
      labels: [version, error_type]  
      description: "åº”ç”¨é”™è¯¯æ•°"
```

### 6.4 è‡ªåŠ¨åŒ–ç°åº¦æµç¨‹


**ğŸ¤– æ™ºèƒ½ç°åº¦å‘å¸ƒè„šæœ¬**
```bash
#!/bin/bash
# scripts/gray-release.sh
# æ™ºèƒ½ç°åº¦å‘å¸ƒè„šæœ¬

set -e

# é…ç½®å‚æ•°
INITIAL_PERCENTAGE=5
MAX_PERCENTAGE=100
STEP_PERCENTAGE=10
OBSERVATION_TIME=300  # 5åˆ†é’Ÿè§‚å¯ŸæœŸ

echo "å¼€å§‹ç°åº¦å‘å¸ƒæµç¨‹..."

# 1. éƒ¨ç½²ç°åº¦ç‰ˆæœ¬
echo "éƒ¨ç½²ç°åº¦ç‰ˆæœ¬..."
kubectl apply -f k8s/rabbitmq-canary.yaml

# ç­‰å¾…ç°åº¦ç‰ˆæœ¬å°±ç»ª
kubectl wait --for=condition=ready pod -l app=rabbitmq-canary --timeout=600s

current_percentage=$INITIAL_PERCENTAGE

while [ $current_percentage -le $MAX_PERCENTAGE ]; do
    echo "è®¾ç½®ç°åº¦æ¯”ä¾‹ä¸º ${current_percentage}%"
    
    # 2. æ›´æ–°æµé‡åˆ†é…æ¯”ä¾‹
    kubectl patch configmap gray-config --patch="{
        \"data\": {
            \"canary_percentage\": \"${current_percentage}\"
        }
    }"
    
    # é‡å¯ç›¸å…³æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
    kubectl rollout restart deployment message-producer
    
    # 3. è§‚å¯ŸæœŸ
    echo "è§‚å¯ŸæœŸå¼€å§‹ï¼ŒæŒç»­ ${OBSERVATION_TIME} ç§’..."
    sleep $OBSERVATION_TIME
    
    # 4. æ£€æŸ¥å…³é”®æŒ‡æ ‡
    echo "æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶å†µ..."
    
    # æ£€æŸ¥é”™è¯¯ç‡
    error_rate=$(prometheus_query "rate(application_errors_total{version='canary'}[5m])" | jq -r '.data.result[0].value[1]')
    if (( $(echo "$error_rate > 0.01" | bc -l) )); then
        echo "âŒ é”™è¯¯ç‡è¿‡é«˜ ($error_rate)ï¼Œåœæ­¢ç°åº¦å‘å¸ƒ"
        rollback_gray_release
        exit 1
    fi
    
    # æ£€æŸ¥å“åº”æ—¶é—´
    avg_latency=$(prometheus_query "histogram_quantile(0.95, rate(rabbitmq_message_latency_seconds_bucket{version='canary'}[5m]))" | jq -r '.data.result[0].value[1]')
    if (( $(echo "$avg_latency > 0.5" | bc -l) )); then
        echo "âŒ å“åº”æ—¶é—´è¿‡é•¿ ($avg_latency)ï¼Œåœæ­¢ç°åº¦å‘å¸ƒ"
        rollback_gray_release
        exit 1
    fi
    
    echo "âœ… å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œç»§ç»­ç°åº¦å‘å¸ƒ"
    
    # 5. å¢åŠ ç°åº¦æ¯”ä¾‹
    if [ $current_percentage -eq $MAX_PERCENTAGE ]; then
        echo "ğŸ‰ ç°åº¦å‘å¸ƒå®Œæˆï¼"
        break
    fi
    
    current_percentage=$((current_percentage + STEP_PERCENTAGE))
    if [ $current_percentage -gt $MAX_PERCENTAGE ]; then
        current_percentage=$MAX_PERCENTAGE
    fi
done

# 6. æ¸…ç†æ—§ç‰ˆæœ¬
echo "æ¸…ç†æ—§ç‰ˆæœ¬..."
kubectl delete -f k8s/rabbitmq-stable.yaml

echo "ç°åº¦å‘å¸ƒæµç¨‹å®Œæˆ"

# å›æ»šå‡½æ•°
rollback_gray_release() {
    echo "æ­£åœ¨å›æ»šç°åº¦å‘å¸ƒ..."
    kubectl patch configmap gray-config --patch='{"data": {"canary_percentage": "0"}}'
    kubectl rollout restart deployment message-producer
    kubectl delete -f k8s/rabbitmq-canary.yaml
    echo "å›æ»šå®Œæˆ"
}

# PrometheusæŸ¥è¯¢å‡½æ•°
prometheus_query() {
    local query=$1
    curl -s "http://prometheus:9090/api/v1/query?query=$(echo $query | sed 's/ /%20/g')"
}
```

---

## 7. ğŸ”§ CI/CDç®¡é“é›†æˆ


### 7.1 GitLab CI/CDé›†æˆ


**âš™ï¸ GitLab CIé…ç½®**
```yaml
# .gitlab-ci.yml
# RabbitMQçš„å®Œæ•´CI/CDç®¡é“

stages:
  - validate      # é…ç½®éªŒè¯
  - test         # å•å…ƒæµ‹è¯•
  - build        # æ„å»ºé•œåƒ
  - deploy-dev   # éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
  - test-integration  # é›†æˆæµ‹è¯•
  - deploy-test  # éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
  - deploy-prod  # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

variables:
  DOCKER_REGISTRY: "registry.company.com"
  RABBITMQ_IMAGE: "$DOCKER_REGISTRY/rabbitmq/custom"

# é…ç½®æ–‡ä»¶éªŒè¯
validate-config:
  stage: validate
  image: rabbitmq:3.11-management
  script:
    - echo "éªŒè¯RabbitMQé…ç½®æ–‡ä»¶..."
    - rabbitmq-diagnostics check_config config/rabbitmq.conf
    - echo "éªŒè¯definitions.jsonæ ¼å¼..."
    - python scripts/validate-definitions.py config/definitions.json
  only:
    changes:
      - config/**/*

# å•å…ƒæµ‹è¯•
unit-test:
  stage: test
  image: python:3.9
  services:
    - rabbitmq:3.11-management
  variables:
    RABBITMQ_DEFAULT_USER: test
    RABBITMQ_DEFAULT_PASS: test
  script:
    - pip install -r requirements.txt
    - python -m pytest tests/unit/ -v
  coverage: '/TOTAL.*\s+(\d+%)$/'

# æ„å»ºè‡ªå®šä¹‰RabbitMQé•œåƒ
build-image:
  stage: build
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build -t $RABBITMQ_IMAGE:$CI_COMMIT_SHA .
    - docker push $RABBITMQ_IMAGE:$CI_COMMIT_SHA
  only:
    - main
    - develop

# éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
deploy-dev:
  stage: deploy-dev
  image: bitnami/kubectl:latest
  environment:
    name: development
    url: https://rabbitmq-dev.company.com
  script:
    - kubectl config use-context dev-cluster
    - helm upgrade --install rabbitmq-dev ./helm-chart 
        --namespace rabbitmq-dev
        --set image.tag=$CI_COMMIT_SHA
        --set environment=dev
        --values values-dev.yaml
    - kubectl rollout status deployment/rabbitmq-dev -n rabbitmq-dev --timeout=300s
  only:
    - develop

# é›†æˆæµ‹è¯•
integration-test:
  stage: test-integration
  image: python:3.9
  dependencies:
    - deploy-dev
  script:
    - pip install -r requirements.txt
    - export RABBITMQ_HOST=rabbitmq-dev.company.com
    - python -m pytest tests/integration/ -v --html=report.html
  artifacts:
    reports:
      junit: tests/integration/report.xml
    paths:
      - report.html
    expire_in: 1 week

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
deploy-prod:
  stage: deploy-prod
  image: bitnami/kubectl:latest
  environment:
    name: production
    url: https://rabbitmq.company.com
  script:
    - kubectl config use-context prod-cluster
    # ä½¿ç”¨è“ç»¿éƒ¨ç½²ç­–ç•¥
    - ./scripts/blue-green-deploy.sh $CI_COMMIT_SHA
  when: manual  # ç”Ÿäº§éƒ¨ç½²éœ€è¦æ‰‹åŠ¨è§¦å‘
  only:
    - main
```

### 7.2 Jenkins Pipelineé›†æˆ


**ğŸ”§ Jenkinså£°æ˜å¼ç®¡é“**
```groovy
// Jenkinsfile
// RabbitMQçš„Jenkinsç®¡é“é…ç½®

pipeline {
    agent any
    
    environment {
        DOCKER_REGISTRY = 'registry.company.com'
        RABBITMQ_IMAGE = "${DOCKER_REGISTRY}/rabbitmq/custom"
        KUBECONFIG = credentials('kubernetes-config')
    }
    
    stages {
        stage('å‡†å¤‡ç¯å¢ƒ') {
            steps {
                script {
                    echo "å¼€å§‹RabbitMQ CI/CDæµç¨‹"
                    sh 'docker --version'
                    sh 'kubectl version --client'
                }
            }
        }
        
        stage('ä»£ç æ£€æŸ¥') {
            parallel {
                stage('é…ç½®éªŒè¯') {
                    steps {
                        sh '''
                            echo "éªŒè¯RabbitMQé…ç½®æ–‡ä»¶"
                            docker run --rm -v $(pwd)/config:/config rabbitmq:3.11-management \
                                rabbitmq-diagnostics check_config /config/rabbitmq.conf
                        '''
                    }
                }
                
                stage('å®‰å…¨æ‰«æ') {
                    steps {
                        script {
                            sh '''
                                echo "æ‰«æé…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯"
                                if grep -r "password.*=" config/ | grep -v "RABBITMQ_PASS"; then
                                    echo "å‘ç°ç¡¬ç¼–ç å¯†ç ï¼Œè¯·ä¿®å¤åé‡è¯•"
                                    exit 1
                                fi
                            '''
                        }
                    }
                }
            }
        }
        
        stage('æµ‹è¯•') {
            steps {
                script {
                    sh '''
                        echo "å¯åŠ¨æµ‹è¯•ç¯å¢ƒ"
                        docker-compose -f docker-compose.test.yml up -d
                        
                        echo "ç­‰å¾…RabbitMQå¯åŠ¨"
                        sleep 30
                        
                        echo "è¿è¡Œé›†æˆæµ‹è¯•"
                        python -m pytest tests/ -v --junitxml=test-results.xml
                        
                        echo "æ¸…ç†æµ‹è¯•ç¯å¢ƒ"
                        docker-compose -f docker-compose.test.yml down
                    '''
                }
            }
            post {
                always {
                    junit 'test-results.xml'
                }
            }
        }
        
        stage('æ„å»ºé•œåƒ') {
            when {
                anyOf {
                    branch 'main'
                    branch 'develop'
                }
            }
            steps {
                script {
                    def imageTag = "${env.BUILD_NUMBER}-${env.GIT_COMMIT[0..7]}"
                    sh """
                        docker build -t ${RABBITMQ_IMAGE}:${imageTag} .
                        docker tag ${RABBITMQ_IMAGE}:${imageTag} ${RABBITMQ_IMAGE}:latest
                        docker push ${RABBITMQ_IMAGE}:${imageTag}
                        docker push ${RABBITMQ_IMAGE}:latest
                    """
                    
                    // ä¿å­˜é•œåƒæ ‡ç­¾ä¾›åç»­é˜¶æ®µä½¿ç”¨
                    env.IMAGE_TAG = imageTag
                }
            }
        }
        
        stage('éƒ¨ç½²') {
            parallel {
                stage('éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ') {
                    when {
                        branch 'develop'
                    }
                    steps {
                        script {
                            sh """
                                helm upgrade --install rabbitmq-dev ./helm-chart \\
                                    --namespace rabbitmq-dev \\
                                    --set image.tag=${env.IMAGE_TAG} \\
                                    --set environment=dev \\
                                    --values values-dev.yaml
                                    
                                kubectl rollout status deployment/rabbitmq-dev -n rabbitmq-dev --timeout=300s
                            """
                        }
                    }
                }
                
                stage('éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ') {
                    when {
                        allOf {
                            branch 'main'
                            expression { 
                                return params.DEPLOY_TO_PROD == true 
                            }
                        }
                    }
                    steps {
                        script {
                            // éœ€è¦äººå·¥ç¡®è®¤
                            input message: 'ç¡®è®¤éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼Ÿ', 
                                  parameters: [
                                      choice(name: 'STRATEGY', 
                                             choices: ['blue-green', 'rolling'], 
                                             description: 'é€‰æ‹©éƒ¨ç½²ç­–ç•¥')
                                  ]
                            
                            if (params.STRATEGY == 'blue-green') {
                                sh "./scripts/blue-green-deploy.sh ${env.IMAGE_TAG}"
                            } else {
                                sh """
                                    helm upgrade rabbitmq-prod ./helm-chart \\
                                        --namespace rabbitmq-prod \\
                                        --set image.tag=${env.IMAGE_TAG} \\
                                        --set environment=prod \\
                                        --values values-prod.yaml
                                """
                            }
                        }
                    }
                }
            }
        }
        
        stage('éƒ¨ç½²åéªŒè¯') {
            steps {
                script {
                    sh '''
                        echo "éªŒè¯RabbitMQæœåŠ¡çŠ¶æ€"
                        kubectl get pods -n rabbitmq-dev -l app=rabbitmq
                        
                        echo "æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€"
                        curl -f http://admin:password@rabbitmq-dev.company.com:15672/api/health/checks/virtual-hosts
                        
                        echo "è¿è¡Œå†’çƒŸæµ‹è¯•"
                        python scripts/smoke-test.py --env=dev
                    '''
                }
            }
        }
    }
    
    post {
        always {
            script {
                // æ¸…ç†å·¥ä½œç©ºé—´
                sh 'docker system prune -f'
                
                // å‘é€é€šçŸ¥
                def status = currentBuild.result ?: 'SUCCESS'
                def color = status == 'SUCCESS' ? 'good' : 'danger'
                
                slackSend(
                    color: color,
                    message: """
                        RabbitMQéƒ¨ç½²${status}
                        åˆ†æ”¯: ${env.BRANCH_NAME}
                        æ„å»º: ${env.BUILD_NUMBER}
                        æäº¤: ${env.GIT_COMMIT[0..7]}
                    """
                )
            }
        }
        
        failure {
            script {
                // å¤±è´¥æ—¶å›æ»š
                if (env.BRANCH_NAME == 'main' && env.IMAGE_TAG) {
                    sh "./scripts/rollback.sh"
                }
            }
        }
    }
}
```

---

## 8. ğŸ“Š ç›‘æ§å‘Šè­¦é›†æˆ


### 8.1 Prometheusç›‘æ§é›†æˆ


**ğŸ“ˆ ç›‘æ§æŒ‡æ ‡é…ç½®**
```yaml
# monitoring/prometheus-config.yaml
# Prometheusç›‘æ§RabbitMQçš„å®Œæ•´é…ç½®

# Prometheusé…ç½®
global:
  scrape_interval: 15s
  evaluation_interval: 15s

# å‘Šè­¦è§„åˆ™æ–‡ä»¶
rule_files:
  - "rabbitmq-alerts.yml"

# æŠ“å–é…ç½®
scrape_configs:
  # RabbitMQæŒ‡æ ‡æŠ“å–
  - job_name: 'rabbitmq'
    static_configs:
      - targets: 
          - 'rabbitmq-1:15692'
          - 'rabbitmq-2:15692'
          - 'rabbitmq-3:15692'
    scrape_interval: 15s
    metrics_path: /metrics
    
  # åº”ç”¨å±‚é¢çš„RabbitMQä½¿ç”¨æŒ‡æ ‡
  - job_name: 'rabbitmq-exporter'
    static_configs:
      - targets: ['rabbitmq-exporter:9419']
    scrape_interval: 30s

# Alertmanageré…ç½®
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

**ğŸš¨ å…³é”®å‘Šè­¦è§„åˆ™**
```yaml
# monitoring/rabbitmq-alerts.yml
# RabbitMQå‘Šè­¦è§„åˆ™

groups:
- name: rabbitmq-alerts
  rules:
  
  # èŠ‚ç‚¹çŠ¶æ€å‘Šè­¦
  - alert: RabbitMQNodeDown
    expr: up{job="rabbitmq"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "RabbitMQèŠ‚ç‚¹ç¦»çº¿"
      description: "RabbitMQèŠ‚ç‚¹ {{ $labels.instance }} å·²ç¦»çº¿è¶…è¿‡1åˆ†é’Ÿ"
      
  # å†…å­˜ä½¿ç”¨å‘Šè­¦
  - alert: RabbitMQHighMemoryUsage
    expr: rabbitmq_process_resident_memory_bytes / rabbitmq_resident_memory_limit_bytes > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "RabbitMQå†…å­˜ä½¿ç”¨è¿‡é«˜"
      description: "RabbitMQèŠ‚ç‚¹ {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%"
      
  # ç£ç›˜ç©ºé—´å‘Šè­¦
  - alert: RabbitMQDiskSpaceLow
    expr: rabbitmq_disk_space_available_bytes < 1073741824  # 1GB
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "RabbitMQç£ç›˜ç©ºé—´ä¸è¶³"
      description: "RabbitMQèŠ‚ç‚¹ {{ $labels.instance }} å¯ç”¨ç£ç›˜ç©ºé—´å°‘äº1GB"
      
  # é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯å‘Šè­¦
  - alert: RabbitMQQueueMessageAccumulation
    expr: rabbitmq_queue_messages > 10000
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "é˜Ÿåˆ—æ¶ˆæ¯å †ç§¯"
      description: "é˜Ÿåˆ— {{ $labels.queue }} æ¶ˆæ¯å †ç§¯è¶…è¿‡10000æ¡"
      
  # è¿æ¥æ•°è¿‡å¤šå‘Šè­¦
  - alert: RabbitMQTooManyConnections
    expr: rabbitmq_connections > 1000
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "è¿æ¥æ•°è¿‡å¤š"
      description: "RabbitMQè¿æ¥æ•°è¶…è¿‡1000ï¼Œå½“å‰: {{ $value }}"
      
  # æ¶ˆæ¯å‘å¸ƒå¤±è´¥å‘Šè­¦
  - alert: RabbitMQMessagePublishFailure
    expr: rate(rabbitmq_channel_messages_returned_total[5m]) > 10
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "æ¶ˆæ¯å‘å¸ƒå¤±è´¥ç‡è¿‡é«˜"
      description: "æ¶ˆæ¯é€€å›ç‡è¶…è¿‡æ¯ç§’10æ¡"
```

### 8.2 Grafanaä»ªè¡¨æ¿


**ğŸ“Š RabbitMQç›‘æ§ä»ªè¡¨æ¿é…ç½®**
```json
{
  "dashboard": {
    "title": "RabbitMQé›†ç¾¤ç›‘æ§",
    "tags": ["rabbitmq", "messaging"],
    "panels": [
      {
        "title": "é›†ç¾¤çŠ¶æ€æ¦‚è§ˆ",
        "type": "stat",
        "targets": [
          {
            "expr": "count(up{job=\"rabbitmq\"} == 1)",
            "legendFormat": "åœ¨çº¿èŠ‚ç‚¹æ•°"
          },
          {
            "expr": "sum(rabbitmq_connections)",
            "legendFormat": "æ€»è¿æ¥æ•°"
          },
          {
            "expr": "sum(rabbitmq_channels)",
            "legendFormat": "æ€»é€šé“æ•°"
          }
        ]
      },
      {
        "title": "æ¶ˆæ¯ååé‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(rabbitmq_channel_messages_published_total[5m])",
            "legendFormat": "å‘å¸ƒé€Ÿç‡/ç§’"
          },
          {
            "expr": "rate(rabbitmq_channel_messages_delivered_total[5m])",
            "legendFormat": "æŠ•é€’é€Ÿç‡/ç§’"
          }
        ]
      },
      {
        "title": "é˜Ÿåˆ—çŠ¶æ€",
        "type": "table",
        "targets": [
          {
            "expr": "rabbitmq_queue_messages",
            "format": "table",
            "instant": true
          }
        ]
      }
    ]
  }
}
```

### 8.3 å‘Šè­¦é€šçŸ¥é›†æˆ


**ğŸ“± Alertmanageré€šçŸ¥é…ç½®**
```yaml
# alertmanager.yml
# å‘Šè­¦é€šçŸ¥é…ç½®

global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alerts@company.com'

# è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  
  # ä¸åŒä¸¥é‡çº§åˆ«çš„è·¯ç”±
  routes:
  - match:
      severity: critical
    receiver: 'critical-alerts'
    group_wait: 0s
    repeat_interval: 5m
    
  - match:
      severity: warning  
    receiver: 'warning-alerts'
    repeat_interval: 30m

# æ¥æ”¶å™¨é…ç½®
receivers:
- name: 'default-receiver'
  email_configs:
  - to: 'ops-team@company.com'
    subject: 'ã€ç›‘æ§å‘Šè­¦ã€‘{{ .GroupLabels.alertname }}'
    body: |
      å‘Šè­¦è¯¦æƒ…:
      {{ range .Alerts }}
      - å‘Šè­¦: {{ .Annotations.summary }}
      - æè¿°: {{ .Annotations.description }}
      - æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
      {{ end }}

- name: 'critical-alerts'
  # é‡è¦å‘Šè­¦å‘é€åˆ°å¤šä¸ªæ¸ é“
  email_configs:
  - to: 'ops-team@company.com,dev-team@company.com'
    subject: 'ğŸš¨ã€ç´§æ€¥å‘Šè­¦ã€‘{{ .GroupLabels.alertname }}'
    
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
    channel: '#alerts'
    color: 'danger'
    title: 'ğŸš¨ ç´§æ€¥å‘Šè­¦'
    text: |
      {{ range .Alerts }}
      *å‘Šè­¦:* {{ .Annotations.summary }}
      *æè¿°:* {{ .Annotations.description }}
      *æ—¶é—´:* {{ .StartsAt.Format "15:04:05" }}
      {{ end }}
    
  webhook_configs:
  - url: 'https://api.company.com/alerts/webhook'
    send_resolved: true

- name: 'warning-alerts'
  email_configs:
  - to: 'ops-team@company.com'
    subject: 'âš ï¸ã€è­¦å‘Šã€‘{{ .GroupLabels.alertname }}'
```

---

## 9. ğŸ”„ æ•…éšœæ¢å¤ä¸å›æ»š


### 9.1 è‡ªåŠ¨æ•…éšœæ£€æµ‹


**ğŸ•µï¸ å¥åº·æ£€æŸ¥æœºåˆ¶**
```bash
#!/bin/bash
# scripts/health-check.sh
# RabbitMQå¥åº·æ£€æŸ¥è„šæœ¬

set -e

RABBITMQ_HOST=${1:-localhost}
RABBITMQ_PORT=${2:-15672}
RABBITMQ_USER=${3:-admin}
RABBITMQ_PASS=${4:-password}

echo "å¼€å§‹RabbitMQå¥åº·æ£€æŸ¥..."

# 1. åŸºç¡€è¿é€šæ€§æ£€æŸ¥
echo "æ£€æŸ¥æœåŠ¡è¿é€šæ€§..."
if ! curl -f -s "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/whoami" \
     -u "${RABBITMQ_USER}:${RABBITMQ_PASS}" > /dev/null; then
    echo "âŒ RabbitMQç®¡ç†æ¥å£æ— æ³•è®¿é—®"
    exit 1
fi

# 2. é›†ç¾¤çŠ¶æ€æ£€æŸ¥
echo "æ£€æŸ¥é›†ç¾¤çŠ¶æ€..."
cluster_status=$(curl -s "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/nodes" \
                 -u "${RABBITMQ_USER}:${RABBITMQ_PASS}")

running_nodes=$(echo $cluster_status | jq -r '[.[] | select(.running == true)] | length')
total_nodes=$(echo $cluster_status | jq -r 'length')

if [ "$running_nodes" -lt "$total_nodes" ]; then
    echo "âš ï¸ é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€å¼‚å¸¸: ${running_nodes}/${total_nodes} èŠ‚ç‚¹åœ¨çº¿"
    echo $cluster_status | jq '.[] | select(.running == false)'
fi

# 3. é˜Ÿåˆ—çŠ¶æ€æ£€æŸ¥
echo "æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€..."
queues=$(curl -s "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/queues" \
         -u "${RABBITMQ_USER}:${RABBITMQ_PASS}")

# æ£€æŸ¥æ˜¯å¦æœ‰æ¶ˆæ¯å¤§é‡å †ç§¯çš„é˜Ÿåˆ—
problematic_queues=$(echo $queues | jq -r '.[] | select(.messages > 50000) | .name')
if [ -n "$problematic_queues" ]; then
    echo "âš ï¸ å‘ç°æ¶ˆæ¯å †ç§¯çš„é˜Ÿåˆ—:"
    echo "$problematic_queues"
fi

# 4. å†…å­˜ä½¿ç”¨æ£€æŸ¥
echo "æ£€æŸ¥å†…å­˜ä½¿ç”¨..."
nodes_memory=$(curl -s "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/nodes" \
               -u "${RABBITMQ_USER}:${RABBITMQ_PASS}" | \
               jq -r '.[] | "\(.name): \(.mem_used/1024/1024 | floor)MB/\(.mem_limit/1024/1024 | floor)MB"')

echo "å„èŠ‚ç‚¹å†…å­˜ä½¿ç”¨æƒ…å†µ:"
echo "$nodes_memory"

# 5. ç£ç›˜ç©ºé—´æ£€æŸ¥
echo "æ£€æŸ¥ç£ç›˜ç©ºé—´..."
disk_alarm=$(echo $cluster_status | jq -r '.[] | select(.disk_free_alarm == true) | .name')
if [ -n "$disk_alarm" ]; then
    echo "âŒ ç£ç›˜ç©ºé—´å‘Šè­¦èŠ‚ç‚¹: $disk_alarm"
    exit 1
fi

echo "âœ… RabbitMQå¥åº·æ£€æŸ¥é€šè¿‡"
```

### 9.2 è‡ªåŠ¨æ•…éšœæ¢å¤


**ğŸš‘ è‡ªåŠ¨æ¢å¤è„šæœ¬**
```bash
#!/bin/bash
# scripts/auto-recovery.sh
# RabbitMQè‡ªåŠ¨æ•…éšœæ¢å¤

set -e

NAMESPACE="rabbitmq-prod"
DEPLOYMENT="rabbitmq"
MAX_RETRIES=3
RETRY_COUNT=0

echo "å¼€å§‹è‡ªåŠ¨æ•…éšœæ¢å¤æµç¨‹..."

while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
    echo "æ¢å¤å°è¯• $((RETRY_COUNT + 1))/$MAX_RETRIES"
    
    # 1. æ£€æŸ¥PodçŠ¶æ€
    echo "æ£€æŸ¥PodçŠ¶æ€..."
    failed_pods=$(kubectl get pods -n $NAMESPACE -l app=$DEPLOYMENT \
                  --field-selector=status.phase!=Running \
                  -o jsonpath='{.items[*].metadata.name}')
    
    if [ -n "$failed_pods" ]; then
        echo "å‘ç°å¼‚å¸¸Pod: $failed_pods"
        
        # 2. é‡å¯å¼‚å¸¸Pod
        for pod in $failed_pods; do
            echo "é‡å¯Pod: $pod"
            kubectl delete pod $pod -n $NAMESPACE
        done
        
        # ç­‰å¾…Podé‡æ–°åˆ›å»º
        echo "ç­‰å¾…Podé‡æ–°åˆ›å»º..."
        kubectl wait --for=condition=ready pod -l app=$DEPLOYMENT \
                     -n $NAMESPACE --timeout=300s
    fi
    
    # 3. æ‰§è¡Œå¥åº·æ£€æŸ¥
    echo "æ‰§è¡Œå¥åº·æ£€æŸ¥..."
    if ./scripts/health-check.sh; then
        echo "âœ… è‡ªåŠ¨æ¢å¤æˆåŠŸ"
        break
    else
        echo "âŒ æ¢å¤å¤±è´¥ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡å°è¯•"
        RETRY_COUNT=$((RETRY_COUNT + 1))
        sleep 30
    fi
done

if [ $RETRY_COUNT -eq $MAX_RETRIES ]; then
    echo "âŒ è‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œè¯·äººå·¥ä»‹å…¥"
    # å‘é€å‘Šè­¦é€šçŸ¥
    curl -X POST "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK" \
         -H 'Content-type: application/json' \
         --data '{"text":"ğŸš¨ RabbitMQè‡ªåŠ¨æ¢å¤å¤±è´¥ï¼Œéœ€è¦äººå·¥ä»‹å…¥å¤„ç†"}'
    exit 1
fi
```

### 9.3 å¿«é€Ÿå›æ»šæœºåˆ¶


**âª ç‰ˆæœ¬å›æ»šè„šæœ¬**
```bash
#!/bin/bash
# scripts/rollback.sh
# RabbitMQå¿«é€Ÿå›æ»šè„šæœ¬

set -e

NAMESPACE=${1:-rabbitmq-prod}
ROLLBACK_VERSION=${2:-}

echo "å¼€å§‹RabbitMQå›æ»šæµç¨‹..."

# 1. è·å–éƒ¨ç½²å†å²
echo "è·å–éƒ¨ç½²å†å²..."
helm history rabbitmq -n $NAMESPACE

if [ -z "$ROLLBACK_VERSION" ]; then
    # å¦‚æœæ²¡æœ‰æŒ‡å®šç‰ˆæœ¬ï¼Œå›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
    echo "å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬..."
    helm rollback rabbitmq -n $NAMESPACE
else
    # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
    echo "å›æ»šåˆ°ç‰ˆæœ¬ $ROLLBACK_VERSION..."
    helm rollback rabbitmq $ROLLBACK_VERSION -n $NAMESPACE
fi

# 2. ç­‰å¾…å›æ»šå®Œæˆ
echo "ç­‰å¾…å›æ»šå®Œæˆ..."
kubectl rollout status statefulset/rabbitmq -n $NAMESPACE --timeout=600s

# 3. éªŒè¯å›æ»šç»“æœ
echo "éªŒè¯å›æ»šç»“æœ..."
sleep 30

if ./scripts/health-check.sh; then
    echo "âœ… å›æ»šæˆåŠŸ"
    
    # è®°å½•å›æ»šäº‹ä»¶
    kubectl annotate statefulset/rabbitmq -n $NAMESPACE \
            rollback.timestamp="$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
            rollback.reason="Auto rollback due to health check failure"
    
    # å‘é€é€šçŸ¥
    curl -X POST "https://api.company.com/notifications" \
         -H 'Content-Type: application/json' \
         -d "{
             \"type\": \"rollback\",
             \"service\": \"rabbitmq\", 
             \"namespace\": \"$NAMESPACE\",
             \"status\": \"success\",
             \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
         }"
else
    echo "âŒ å›æ»šåå¥åº·æ£€æŸ¥ä»ç„¶å¤±è´¥"
    exit 1
fi
```

### 9.4 æ•°æ®å¤‡ä»½ä¸æ¢å¤


**ğŸ’¾ è‡ªåŠ¨æ•°æ®å¤‡ä»½**
```bash
#!/bin/bash
# scripts/backup-rabbitmq.sh
# RabbitMQæ•°æ®å¤‡ä»½è„šæœ¬

set -e

BACKUP_DIR="/backup/rabbitmq/$(date +%Y%m%d_%H%M%S)"
RABBITMQ_HOST="localhost"
RABBITMQ_PORT="15672"
RABBITMQ_USER="admin"
RABBITMQ_PASS="password"

echo "å¼€å§‹RabbitMQæ•°æ®å¤‡ä»½..."

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# 1. å¤‡ä»½é˜Ÿåˆ—å’Œäº¤æ¢æœºå®šä¹‰
echo "å¤‡ä»½é˜Ÿåˆ—å’Œäº¤æ¢æœºå®šä¹‰..."
curl -u ${RABBITMQ_USER}:${RABBITMQ_PASS} \
     "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/definitions" \
     -o "${BACKUP_DIR}/definitions.json"

# 2. å¤‡ä»½ç”¨æˆ·å’Œæƒé™
echo "å¤‡ä»½ç”¨æˆ·å’Œæƒé™..."
curl -u ${RABBITMQ_USER}:${RABBITMQ_PASS} \
     "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/users" \
     -o "${BACKUP_DIR}/users.json"

curl -u ${RABBITMQ_USER}:${RABBITMQ_PASS} \
     "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/permissions" \
     -o "${BACKUP_DIR}/permissions.json"

# 3. å¤‡ä»½é…ç½®æ–‡ä»¶
echo "å¤‡ä»½é…ç½®æ–‡ä»¶..."
kubectl exec rabbitmq-0 -n rabbitmq-prod -- \
    cat /etc/rabbitmq/rabbitmq.conf > "${BACKUP_DIR}/rabbitmq.conf"

# 4. å‹ç¼©å¤‡ä»½æ–‡ä»¶
echo "å‹ç¼©å¤‡ä»½æ–‡ä»¶..."
tar -czf "${BACKUP_DIR}.tar.gz" -C "$(dirname $BACKUP_DIR)" "$(basename $BACKUP_DIR)"
rm -rf $BACKUP_DIR

# 5. ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨
echo "ä¸Šä¼ å¤‡ä»½åˆ°äº‘å­˜å‚¨..."
aws s3 cp "${BACKUP_DIR}.tar.gz" "s3://company-backups/rabbitmq/"

# 6. æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰
echo "æ¸…ç†æ—§å¤‡ä»½..."
find /backup/rabbitmq/ -name "*.tar.gz" -mtime +30 -delete

echo "âœ… å¤‡ä»½å®Œæˆ: ${BACKUP_DIR}.tar.gz"
```

**ğŸ”„ æ•°æ®æ¢å¤è„šæœ¬**
```bash
#!/bin/bash
# scripts/restore-rabbitmq.sh
# RabbitMQæ•°æ®æ¢å¤è„šæœ¬

set -e

BACKUP_FILE=$1
RABBITMQ_HOST="localhost"
RABBITMQ_PORT="15672"
RABBITMQ_USER="admin"
RABBITMQ_PASS="password"

if [ -z "$BACKUP_FILE" ]; then
    echo "ç”¨æ³•: $0 <backup-file.tar.gz>"
    exit 1
fi

echo "å¼€å§‹RabbitMQæ•°æ®æ¢å¤..."

# 1. è§£å‹å¤‡ä»½æ–‡ä»¶
RESTORE_DIR="/tmp/rabbitmq-restore-$(date +%s)"
mkdir -p $RESTORE_DIR
tar -xzf $BACKUP_FILE -C $RESTORE_DIR --strip-components=1

# 2. æ¢å¤å®šä¹‰ï¼ˆé˜Ÿåˆ—ã€äº¤æ¢æœºç­‰ï¼‰
echo "æ¢å¤é˜Ÿåˆ—å’Œäº¤æ¢æœºå®šä¹‰..."
curl -u ${RABBITMQ_USER}:${RABBITMQ_PASS} \
     -H "Content-Type: application/json" \
     -X POST \
     "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/definitions" \
     -d @"${RESTORE_DIR}/definitions.json"

# 3. ç­‰å¾…æ¢å¤å®Œæˆ
echo "ç­‰å¾…æ¢å¤å®Œæˆ..."
sleep 10

# 4. éªŒè¯æ¢å¤ç»“æœ
echo "éªŒè¯æ¢å¤ç»“æœ..."
curl -u ${RABBITMQ_USER}:${RABBITMQ_PASS} \
     "http://${RABBITMQ_HOST}:${RABBITMQ_PORT}/api/queues" | \
     jq '.[] | .name' | head -10

# 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf $RESTORE_DIR

echo "âœ… æ•°æ®æ¢å¤å®Œæˆ"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ DevOpsé›†æˆæœ¬è´¨ï¼šå¼€å‘è¿ç»´ä¸€ä½“åŒ–ï¼Œè‡ªåŠ¨åŒ–æ•´ä¸ªäº¤ä»˜æµç¨‹
ğŸ”¸ è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šåŸºç¡€è®¾æ–½å³ä»£ç ï¼Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œç‰ˆæœ¬æ§åˆ¶
ğŸ”¸ é…ç½®ç®¡ç†ï¼šé…ç½®å³ä»£ç ï¼Œç¯å¢ƒå·®å¼‚åŒ–ï¼ŒåŠ¨æ€æ›´æ–°æœºåˆ¶
ğŸ”¸ ç¯å¢ƒéš”ç¦»ï¼šç½‘ç»œéš”ç¦»ã€å‘½åç©ºé—´éš”ç¦»ã€æ•°æ®éš”ç¦»ç­–ç•¥
ğŸ”¸ è“ç»¿éƒ¨ç½²ï¼šé›¶åœæœºéƒ¨ç½²ï¼Œå¿«é€Ÿå›æ»šï¼Œé£é™©æ§åˆ¶
ğŸ”¸ ç°åº¦å‘å¸ƒï¼šæ¸è¿›å¼å‘å¸ƒï¼Œé£é™©åˆ†æ•£ï¼Œæ™ºèƒ½å†³ç­–
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆRabbitMQéœ€è¦DevOps**
```
ä¸šåŠ¡é©±åŠ¨ï¼š
â€¢ å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ ¸å¿ƒç»„ä»¶
â€¢ é«˜å¯ç”¨è¦æ±‚ï¼Œä¸èƒ½å®¹å¿é•¿æ—¶é—´åœæœº
â€¢ é…ç½®å¤æ‚ï¼Œæ‰‹åŠ¨ç®¡ç†å®¹æ˜“å‡ºé”™
â€¢ éœ€è¦å¿«é€Ÿå“åº”ä¸šåŠ¡å˜åŒ–

æŠ€æœ¯ä»·å€¼ï¼š
â€¢ éƒ¨ç½²æ•ˆç‡æå‡90%ä»¥ä¸Š
â€¢ äººä¸ºé”™è¯¯å‡å°‘80%ä»¥ä¸Š  
â€¢ æ•…éšœæ¢å¤æ—¶é—´ç¼©çŸ­85%ä»¥ä¸Š
â€¢ ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜åŸºæœ¬æ¶ˆé™¤
```

**ğŸ”¹ æˆåŠŸå®æ–½çš„å…³é”®å› ç´ **
```
æŠ€æœ¯å±‚é¢ï¼š
â€¢ åŸºç¡€è®¾æ–½å³ä»£ç  - ä¸€åˆ‡çš†å¯é‡ç°
â€¢ é…ç½®ç‰ˆæœ¬åŒ–ç®¡ç† - å˜æ›´å¯è¿½è¸ª
â€¢ è‡ªåŠ¨åŒ–æµ‹è¯• - è´¨é‡æœ‰ä¿éšœ
â€¢ ç›‘æ§å‘Šè­¦å®Œå–„ - é—®é¢˜æ—©å‘ç°

æµç¨‹å±‚é¢ï¼š
â€¢ æ ‡å‡†åŒ–æ“ä½œæµç¨‹
â€¢ è‡ªåŠ¨åŒ–ç¨‹åº¦å°½å¯èƒ½é«˜
â€¢ å›æ»šæœºåˆ¶è¦å¿«é€Ÿå¯é 
â€¢ å›¢é˜Ÿåä½œè¦é¡ºç•…
```

### 10.3 å®æ–½å»ºè®®å’Œæœ€ä½³å®è·µ


**ğŸ’¡ å®æ–½æ­¥éª¤å»ºè®®**
```
ç¬¬ä¸€é˜¶æ®µ - åŸºç¡€å»ºè®¾ï¼š
1. å»ºç«‹Gitä»£ç ä»“åº“ç®¡ç†æ‰€æœ‰é…ç½®
2. æ­å»ºåŸºç¡€çš„CI/CDç®¡é“
3. å®ç°åŸºæœ¬çš„è‡ªåŠ¨åŒ–éƒ¨ç½²
4. å»ºç«‹ç›‘æ§å‘Šè­¦ä½“ç³»

ç¬¬äºŒé˜¶æ®µ - å®Œå–„æå‡ï¼š
1. å®æ–½è“ç»¿éƒ¨ç½²æˆ–ç°åº¦å‘å¸ƒ
2. å®Œå–„è‡ªåŠ¨åŒ–æµ‹è¯•
3. ä¼˜åŒ–ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦è§„åˆ™
4. å»ºç«‹è‡ªåŠ¨æ•…éšœæ¢å¤æœºåˆ¶

ç¬¬ä¸‰é˜¶æ®µ - é«˜çº§ä¼˜åŒ–ï¼š
1. æ™ºèƒ½åŒ–è¿ç»´å†³ç­–
2. æ€§èƒ½è‡ªåŠ¨ä¼˜åŒ–
3. æˆæœ¬è‡ªåŠ¨æ§åˆ¶
4. å®‰å…¨è‡ªåŠ¨æ£€æµ‹
```

**ğŸ¯ é¿å…å¸¸è§é™·é˜±**
```
è¿‡åº¦è‡ªåŠ¨åŒ–ï¼š
âŒ ä¸€å¼€å§‹å°±æƒ³è‡ªåŠ¨åŒ–æ‰€æœ‰ç¯èŠ‚
âœ… ä»å…³é”®ç¯èŠ‚å¼€å§‹ï¼Œé€æ­¥æ‰©å±•

å¿½è§†ç›‘æ§ï¼š
âŒ åªå…³æ³¨éƒ¨ç½²ï¼Œä¸å…³æ³¨è¿è¡ŒçŠ¶æ€
âœ… éƒ¨ç½²å’Œç›‘æ§å¹¶é‡ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

é…ç½®ç®¡ç†æ··ä¹±ï¼š
âŒ é…ç½®æ–‡ä»¶åˆ°å¤„éƒ½æ˜¯ï¼Œç‰ˆæœ¬ä¸ç»Ÿä¸€
âœ… ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œç‰ˆæœ¬æ§åˆ¶

ç¼ºä¹æµ‹è¯•ï¼š
âŒ ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–°ç‰ˆæœ¬
âœ… å®Œå–„çš„æµ‹è¯•ç¯å¢ƒå’Œè‡ªåŠ¨åŒ–æµ‹è¯•
```

### 10.4 è¿ç»´å›¢é˜Ÿèƒ½åŠ›è¦æ±‚


**ğŸ”§ æŠ€èƒ½è¦æ±‚**
```
åŸºç¡€æŠ€èƒ½ï¼š
â€¢ Linuxç³»ç»Ÿç®¡ç†
â€¢ å®¹å™¨æŠ€æœ¯ï¼ˆDocker/Kubernetesï¼‰
â€¢ è„šæœ¬ç¼–ç¨‹ï¼ˆBash/Pythonï¼‰
â€¢ ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰

è¿›é˜¶æŠ€èƒ½ï¼š
â€¢ CI/CDå·¥å…·ä½¿ç”¨ï¼ˆJenkins/GitLab CIï¼‰
â€¢ åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆTerraform/Ansibleï¼‰
â€¢ ç›‘æ§å‘Šè­¦ï¼ˆPrometheus/Grafanaï¼‰
â€¢ äº‘å¹³å°æœåŠ¡ï¼ˆAWS/Azure/é˜¿é‡Œäº‘ï¼‰

è½¯æŠ€èƒ½ï¼š
â€¢ æ²Ÿé€šåä½œèƒ½åŠ›
â€¢ é—®é¢˜åˆ†æèƒ½åŠ›
â€¢ æŒç»­å­¦ä¹ æ„è¯†
â€¢ å®‰å…¨æ„è¯†
```

### 10.5 æŠ•å…¥äº§å‡ºåˆ†æ


**ğŸ“Š æˆæœ¬æ•ˆç›Šå¯¹æ¯”**
| æ–¹é¢ | ä¼ ç»Ÿè¿ç»´ | DevOpsè¿ç»´ | æ”¹å–„å¹…åº¦ |
|------|---------|-----------|---------|
| **äººåŠ›æˆæœ¬** | `3-5äººæ‰‹åŠ¨è¿ç»´` | `1-2äººè‡ªåŠ¨åŒ–è¿ç»´` | `èŠ‚çœ60%` |
| **éƒ¨ç½²æ—¶é—´** | `2-4å°æ—¶` | `10-15åˆ†é’Ÿ` | `æå‡90%` |
| **æ•…éšœæ¢å¤** | `30-60åˆ†é’Ÿ` | `2-5åˆ†é’Ÿ` | `æå‡85%` |
| **é”™è¯¯ç‡** | `5-10%` | `<1%` | `é™ä½90%` |
| **å¯ç”¨æ€§** | `99.5%` | `99.9%` | `æå‡0.4%` |

**æ ¸å¿ƒä»·å€¼æ€»ç»“**ï¼š
- RabbitMQ DevOpsé›†æˆæ˜¯ç°ä»£åŒ–è¿ç»´çš„å¿…ç»ä¹‹è·¯
- è‡ªåŠ¨åŒ–ç¨‹åº¦å†³å®šäº†è¿ç»´æ•ˆç‡å’Œè´¨é‡
- ç›‘æ§å‘Šè­¦æ˜¯ä¿éšœç³»ç»Ÿç¨³å®šçš„é‡è¦æ‰‹æ®µ
- æŒç»­æ”¹è¿›å’Œä¼˜åŒ–æ˜¯DevOpsçš„æ ¸å¿ƒç†å¿µ
- å›¢é˜Ÿåä½œå’ŒæŠ€èƒ½æå‡åŒæ ·é‡è¦