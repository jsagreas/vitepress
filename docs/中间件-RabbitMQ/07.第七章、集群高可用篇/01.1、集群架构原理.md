---
title: 1ã€é›†ç¾¤æ¶æ„åŸç†
---
## ğŸ“š ç›®å½•


1. [é›†ç¾¤åŸºç¡€æ¦‚å¿µ](#1-é›†ç¾¤åŸºç¡€æ¦‚å¿µ)
2. [é›†ç¾¤èŠ‚ç‚¹ç±»å‹è¯¦è§£](#2-é›†ç¾¤èŠ‚ç‚¹ç±»å‹è¯¦è§£)
3. [ç£ç›˜èŠ‚ç‚¹ vs å†…å­˜èŠ‚ç‚¹](#3-ç£ç›˜èŠ‚ç‚¹-vs-å†…å­˜èŠ‚ç‚¹)
4. [Erlang Cookieæœºåˆ¶](#4-erlang-cookieæœºåˆ¶)
5. [èŠ‚ç‚¹å‘ç°ä¸é€šä¿¡](#5-èŠ‚ç‚¹å‘ç°ä¸é€šä¿¡)
6. [é›†ç¾¤å½¢æˆè¿‡ç¨‹](#6-é›†ç¾¤å½¢æˆè¿‡ç¨‹)
7. [é›†ç¾¤ç®¡ç†å®è·µ](#7-é›†ç¾¤ç®¡ç†å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡RabbitMQåŸºç¡€æ¦‚å¿µã€é˜Ÿåˆ—æœºåˆ¶ â†’ **å½“å‰å†…å®¹**ï¼šé›†ç¾¤æ¶æ„åŸç† â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ é•œåƒé˜Ÿåˆ—ã€é«˜å¯ç”¨é…ç½®

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡45åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**ï¼š`#é›†ç¾¤æ¶æ„` `#é«˜å¯ç”¨` `#åˆ†å¸ƒå¼` `#å¿…æŒæ¡`

---

## 1. ğŸ—ï¸ é›†ç¾¤åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯RabbitMQé›†ç¾¤



**ğŸ”¸ é€šä¿—ç†è§£**
æƒ³è±¡ä¸€ä¸ªå¿«é€’å…¬å¸ï¼š
- **å•ä¸ªç½‘ç‚¹**ï¼ˆå•æœºï¼‰ï¼šå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œä¸€æ—¦æ•…éšœå°±å…¨éƒ¨åœæ‘†
- **å¤šä¸ªç½‘ç‚¹**ï¼ˆé›†ç¾¤ï¼‰ï¼šåˆ†å·¥åä½œï¼ŒæŸä¸ªç½‘ç‚¹å‡ºé—®é¢˜ï¼Œå…¶ä»–ç½‘ç‚¹ç»§ç»­å·¥ä½œ

RabbitMQé›†ç¾¤å°±æ˜¯æŠŠ**å¤šä¸ªRabbitMQæœåŠ¡å™¨è¿æ¥èµ·æ¥**ï¼Œè®©å®ƒä»¬åƒä¸€ä¸ªæ•´ä½“ä¸€æ ·å·¥ä½œã€‚

**ğŸ’¡ æ ¸å¿ƒå®šä¹‰**
```
RabbitMQé›†ç¾¤ï¼šå¤šä¸ªRabbitMQèŠ‚ç‚¹ç»„æˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿ
ç›®æ ‡ï¼šæé«˜å¯ç”¨æ€§ã€æ‰©å±•æ€§å’Œå®¹é”™èƒ½åŠ›
åŸç†ï¼šèŠ‚ç‚¹é—´å…±äº«é˜Ÿåˆ—å®šä¹‰ï¼Œåˆ†æ‹…è´Ÿè½½å‹åŠ›
```

### 1.2 é›†ç¾¤çš„æ ¸å¿ƒä¼˜åŠ¿



**ğŸŒŸ ä¸»è¦å¥½å¤„**
- **é«˜å¯ç”¨æ€§**ï¼šä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œå…¶ä»–èŠ‚ç‚¹ç»§ç»­æœåŠ¡
- **è´Ÿè½½åˆ†æ‹…**ï¼šå¤šä¸ªèŠ‚ç‚¹åˆ†æ‘Šå¤„ç†å‹åŠ›
- **æ¨ªå‘æ‰©å±•**ï¼šéœ€è¦æ›´å¤šå¤„ç†èƒ½åŠ›æ—¶ï¼ŒåŠ å…¥æ–°èŠ‚ç‚¹
- **æ•°æ®å†—ä½™**ï¼šé‡è¦æ•°æ®åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šæœ‰å¤‡ä»½

### 1.3 é›†ç¾¤vså•æœºå¯¹æ¯”



```
å•æœºRabbitMQæ¶æ„ï¼š
    åº”ç”¨ â†’ RabbitMQ â†’ å­˜å‚¨
    
é›†ç¾¤RabbitMQæ¶æ„ï¼š
         â”Œâ”€â”€â”€ èŠ‚ç‚¹A â”€â”€â”€ å­˜å‚¨A
    åº”ç”¨ â”€â”¤â”€â”€â”€ èŠ‚ç‚¹B â”€â”€â”€ å­˜å‚¨B  
         â””â”€â”€â”€ èŠ‚ç‚¹C â”€â”€â”€ å­˜å‚¨C
```

| **å¯¹æ¯”ç»´åº¦** | **å•æœºéƒ¨ç½²** | **é›†ç¾¤éƒ¨ç½²** |
|-------------|-------------|-------------|
| **å¯ç”¨æ€§** | â­â­ å•ç‚¹æ•…éšœ | â­â­â­â­â­ é«˜å¯ç”¨ |
| **æ€§èƒ½** | â­â­â­ å—é™äºå•æœº | â­â­â­â­ æ°´å¹³æ‰©å±• |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­â­ ç®€å• | â­â­â­ è¾ƒå¤æ‚ |
| **æ•°æ®å®‰å…¨** | â­â­ é£é™©è¾ƒé«˜ | â­â­â­â­ å¤šé‡å¤‡ä»½ |

---

## 2. ğŸ” é›†ç¾¤èŠ‚ç‚¹ç±»å‹è¯¦è§£



### 2.1 èŠ‚ç‚¹ç±»å‹æ¦‚è§ˆ



RabbitMQé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

**ğŸ“‹ èŠ‚ç‚¹åˆ†ç±»**
```
æ ¹æ®å­˜å‚¨æ–¹å¼ï¼š
â”œâ”€â”€ ç£ç›˜èŠ‚ç‚¹ï¼ˆDisk Nodeï¼‰
â””â”€â”€ å†…å­˜èŠ‚ç‚¹ï¼ˆRAM Nodeï¼‰

æ ¹æ®åŠŸèƒ½è§’è‰²ï¼š
â”œâ”€â”€ ä¸»èŠ‚ç‚¹ï¼ˆPrimaryï¼‰
â”œâ”€â”€ ä»èŠ‚ç‚¹ï¼ˆSecondaryï¼‰  
â””â”€â”€ ä»²è£èŠ‚ç‚¹ï¼ˆQuorumï¼‰
```

### 2.2 ç£ç›˜èŠ‚ç‚¹ï¼ˆDisk Nodeï¼‰



**ğŸ’¾ ç£ç›˜èŠ‚ç‚¹ç‰¹ç‚¹**
- **æŒä¹…åŒ–å­˜å‚¨**ï¼šæ‰€æœ‰é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šä¿¡æ¯éƒ½ä¿å­˜åˆ°ç£ç›˜
- **æ•°æ®å®‰å…¨**ï¼šé‡å¯åæ•°æ®ä¸ä¸¢å¤±
- **æ€§èƒ½è¾ƒæ…¢**ï¼šè¯»å†™ç£ç›˜æ¯”å†…å­˜æ…¢
- **é›†ç¾¤åŸºç¡€**ï¼šé›†ç¾¤ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹

**ğŸ¯ é€‚ç”¨åœºæ™¯**
```
âœ… ç”Ÿäº§ç¯å¢ƒçš„æ ¸å¿ƒèŠ‚ç‚¹
âœ… éœ€è¦æ•°æ®æŒä¹…åŒ–çš„ä¸šåŠ¡
âœ… é‡è¦é…ç½®ä¿¡æ¯çš„å­˜å‚¨
âœ… é›†ç¾¤å…ƒæ•°æ®çš„ç®¡ç†
```

### 2.3 å†…å­˜èŠ‚ç‚¹ï¼ˆRAM Nodeï¼‰



**âš¡ å†…å­˜èŠ‚ç‚¹ç‰¹ç‚¹**
- **å†…å­˜å­˜å‚¨**ï¼šé˜Ÿåˆ—ã€äº¤æ¢æœºä¿¡æ¯ä¸»è¦å­˜åœ¨å†…å­˜ä¸­
- **é«˜æ€§èƒ½**ï¼šè¯»å†™é€Ÿåº¦å¿«ï¼Œå»¶è¿Ÿä½
- **æ˜“å¤±æ€§**ï¼šé‡å¯åéæŒä¹…åŒ–æ•°æ®ä¼šä¸¢å¤±
- **ä¾èµ–ç£ç›˜èŠ‚ç‚¹**ï¼šé›†ç¾¤å…ƒæ•°æ®åŒæ­¥ä¾èµ–ç£ç›˜èŠ‚ç‚¹

**ğŸ¯ é€‚ç”¨åœºæ™¯**
```
âœ… é«˜å¹¶å‘è¯»å†™æ“ä½œ
âœ… ä¸´æ—¶é˜Ÿåˆ—å¤„ç†
âœ… å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨
âœ… è®¡ç®—å¯†é›†å‹å¤„ç†
```

### 2.4 èŠ‚ç‚¹ç±»å‹é€‰æ‹©ç­–ç•¥



```
ğŸ“Š æ¨èé…ç½®æ–¹æ¡ˆï¼š

å°å‹é›†ç¾¤ï¼ˆ3èŠ‚ç‚¹ï¼‰ï¼š
â”œâ”€â”€ 2ä¸ªç£ç›˜èŠ‚ç‚¹ï¼ˆä¿è¯æ•°æ®å®‰å…¨ï¼‰
â””â”€â”€ 1ä¸ªå†…å­˜èŠ‚ç‚¹ï¼ˆæå‡æ€§èƒ½ï¼‰

ä¸­å‹é›†ç¾¤ï¼ˆ5èŠ‚ç‚¹ï¼‰ï¼š
â”œâ”€â”€ 3ä¸ªç£ç›˜èŠ‚ç‚¹ï¼ˆå¥‡æ•°ä¾¿äºé€‰ä¸¾ï¼‰
â””â”€â”€ 2ä¸ªå†…å­˜èŠ‚ç‚¹ï¼ˆè´Ÿè½½åˆ†æ‹…ï¼‰

å¤§å‹é›†ç¾¤ï¼ˆ7+èŠ‚ç‚¹ï¼‰ï¼š
â”œâ”€â”€ 3-5ä¸ªç£ç›˜èŠ‚ç‚¹ï¼ˆæ ¸å¿ƒç¨³å®šï¼‰
â””â”€â”€ å…¶ä½™å†…å­˜èŠ‚ç‚¹ï¼ˆæ€§èƒ½æ‰©å±•ï¼‰
```

---

## 3. âš–ï¸ ç£ç›˜èŠ‚ç‚¹ vs å†…å­˜èŠ‚ç‚¹



### 3.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”



| **å¯¹æ¯”é¡¹ç›®** | **ç£ç›˜èŠ‚ç‚¹** | **å†…å­˜èŠ‚ç‚¹** |
|-------------|-------------|-------------|
| **æ•°æ®å­˜å‚¨** | ç£ç›˜æŒä¹…åŒ– | å†…å­˜ä¸´æ—¶å­˜å‚¨ |
| **è¯»å†™æ€§èƒ½** | â­â­â­ è¾ƒæ…¢ | â­â­â­â­â­ å¾ˆå¿« |
| **æ•°æ®å®‰å…¨** | â­â­â­â­â­ å¾ˆå®‰å…¨ | â­â­ é‡å¯ä¸¢å¤± |
| **å¯åŠ¨é€Ÿåº¦** | â­â­ éœ€è¦åŠ è½½ç£ç›˜ | â­â­â­â­â­ å¿«é€Ÿ |
| **èµ„æºæ¶ˆè€—** | ç£ç›˜IOè¾ƒé«˜ | å†…å­˜æ¶ˆè€—è¾ƒé«˜ |

### 3.2 æ•°æ®å­˜å‚¨å·®å¼‚



**ç£ç›˜èŠ‚ç‚¹çš„æ•°æ®ç®¡ç†**
```
é˜Ÿåˆ—å®šä¹‰ â†’ å†™å…¥ç£ç›˜æ–‡ä»¶
æ¶ˆæ¯å†…å®¹ â†’ æ ¹æ®æŒä¹…åŒ–è®¾ç½®å†³å®š
äº¤æ¢æœºé…ç½® â†’ æŒä¹…åŒ–åˆ°ç£ç›˜
ç»‘å®šå…³ç³» â†’ ä¿å­˜åœ¨æ•°æ®åº“ä¸­
é›†ç¾¤çŠ¶æ€ â†’ å…ƒæ•°æ®æŒä¹…åŒ–
```

**å†…å­˜èŠ‚ç‚¹çš„æ•°æ®ç®¡ç†**
```
é˜Ÿåˆ—å®šä¹‰ â†’ å­˜å‚¨åœ¨å†…å­˜ä¸­
æ¶ˆæ¯å†…å®¹ â†’ ä¸´æ—¶ç¼“å­˜åœ¨å†…å­˜
äº¤æ¢æœºé…ç½® â†’ å†…å­˜ç¼“å­˜
ç»‘å®šå…³ç³» â†’ å†…å­˜æ˜ å°„
é›†ç¾¤çŠ¶æ€ â†’ ä»ç£ç›˜èŠ‚ç‚¹åŒæ­¥
```

### 3.3 æ€§èƒ½å½±å“åˆ†æ



**ğŸ”„ ç”Ÿæ´»ç±»æ¯”ç†è§£**
```
ç£ç›˜èŠ‚ç‚¹åƒ"å›¾ä¹¦é¦†"ï¼š
- æ‰€æœ‰ä¹¦ç±éƒ½åˆ†ç±»å­˜æ”¾åœ¨ä¹¦æ¶ä¸Š
- æŸ¥æ‰¾éœ€è¦æ—¶é—´ï¼Œä½†ä¿¡æ¯ä¸ä¼šä¸¢å¤±
- é€‚åˆé•¿æœŸä¿å­˜é‡è¦èµ„æ–™

å†…å­˜èŠ‚ç‚¹åƒ"å·¥ä½œå°"ï¼š
- å¸¸ç”¨å·¥å…·æ”¾åœ¨æ‰‹è¾¹ï¼Œä½¿ç”¨å¿«é€Ÿ
- æ•ˆç‡å¾ˆé«˜ï¼Œä½†ä¸œè¥¿å¯èƒ½ä¼šä¸¢å¤±
- é€‚åˆä¸´æ—¶å¤„ç†é«˜é¢‘ä»»åŠ¡
```

### 3.4 é›†ç¾¤é…ç½®å»ºè®®



**âš ï¸ é‡è¦åŸåˆ™**
```
é›†ç¾¤å¿…å¤‡è§„åˆ™ï¼š
âœ… è‡³å°‘1ä¸ªç£ç›˜èŠ‚ç‚¹ï¼ˆä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼‰
âœ… å»ºè®®å¥‡æ•°ä¸ªç£ç›˜èŠ‚ç‚¹ï¼ˆä¾¿äºé€‰ä¸¾å†³ç­–ï¼‰
âœ… å†…å­˜èŠ‚ç‚¹æ•°é‡å¯ä»¥çµæ´»è°ƒæ•´
âœ… ç”Ÿäº§ç¯å¢ƒå»ºè®®2+ç£ç›˜èŠ‚ç‚¹
```

---

## 4. ğŸ” Erlang Cookieæœºåˆ¶



### 4.1 ä»€ä¹ˆæ˜¯Erlang Cookie



**ğŸª é€šä¿—ç†è§£**
æƒ³è±¡Erlang Cookieåƒæ˜¯ä¸€ä¸ª"æš—å·"ï¼š
- å°±åƒç§˜å¯†åŸºåœ°çš„**é€šå…³å¯†ç **
- åªæœ‰çŸ¥é“æ­£ç¡®æš—å·çš„äººæ‰èƒ½åŠ å…¥å›¢é˜Ÿ
- æ‰€æœ‰é›†ç¾¤æˆå‘˜å¿…é¡»ä½¿ç”¨**ç›¸åŒçš„æš—å·**

**ğŸ’¡ æŠ€æœ¯å®šä¹‰**
```
Erlang Cookieï¼šRabbitMQé›†ç¾¤èŠ‚ç‚¹é—´çš„è®¤è¯ä»¤ç‰Œ
ä½œç”¨ï¼šç¡®ä¿åªæœ‰æˆæƒçš„èŠ‚ç‚¹æ‰èƒ½åŠ å…¥é›†ç¾¤
æœ¬è´¨ï¼šä¸€ä¸ªéšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²æ ‡è¯†
ä½ç½®ï¼šå­˜å‚¨åœ¨ç³»ç»Ÿç‰¹å®šç›®å½•çš„.erlang.cookieæ–‡ä»¶ä¸­
```

### 4.2 Cookieçš„å·¥ä½œåŸç†



**ğŸ”„ è®¤è¯æµç¨‹**
```
èŠ‚ç‚¹Aæƒ³åŠ å…¥é›†ç¾¤ï¼š
1. èŠ‚ç‚¹Aï¼šå‘é€åŠ å…¥è¯·æ±‚ + æœ¬åœ°Cookie
2. é›†ç¾¤ï¼šæ£€æŸ¥Cookieæ˜¯å¦åŒ¹é…
3. åŒ¹é…æˆåŠŸï¼šå…è®¸åŠ å…¥ï¼Œå¼€å§‹åŒæ­¥æ•°æ®
4. åŒ¹é…å¤±è´¥ï¼šæ‹’ç»è¿æ¥ï¼Œè¿”å›è®¤è¯é”™è¯¯
```

### 4.3 Cookieæ–‡ä»¶ä½ç½®



**ğŸ“ å¸¸è§å­˜å‚¨ä½ç½®**
```bash
# Linuxç³»ç»Ÿ

/var/lib/rabbitmq/.erlang.cookie
# æˆ–è€…ç”¨æˆ·ä¸»ç›®å½•

~/.erlang.cookie

# Windowsç³»ç»Ÿ  

C:\Users\ç”¨æˆ·å\.erlang.cookie
# æˆ–è€…RabbitMQå®‰è£…ç›®å½•

```

### 4.4 Cookieç®¡ç†å®è·µ



**ğŸ› ï¸ Cookieè®¾ç½®æ­¥éª¤**
1. **åœæ­¢æ‰€æœ‰RabbitMQèŠ‚ç‚¹**
2. **è®¾ç½®ç›¸åŒçš„Cookieå€¼**ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰
3. **è°ƒæ•´æ–‡ä»¶æƒé™**ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»ï¼‰
4. **é‡å¯RabbitMQæœåŠ¡**
5. **éªŒè¯é›†ç¾¤è¿é€šæ€§**

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
Cookieå®‰å…¨è¦æ±‚ï¼š
âœ… ä½¿ç”¨éšæœºå¤æ‚å­—ç¬¦ä¸²
âœ… å®šæœŸæ›´æ¢Cookieå€¼
âœ… é™åˆ¶æ–‡ä»¶è®¿é—®æƒé™ï¼ˆ600ï¼‰
âœ… ä¸è¦åœ¨æ—¥å¿—ä¸­æš´éœ²Cookie
âŒ é¿å…ä½¿ç”¨ç®€å•å¯†ç 
âŒ ä¸è¦é€šè¿‡ç½‘ç»œæ˜æ–‡ä¼ è¾“
```

---

## 5. ğŸŒ èŠ‚ç‚¹å‘ç°ä¸é€šä¿¡



### 5.1 èŠ‚ç‚¹å‘ç°æœºåˆ¶



**ğŸ” å‘ç°æ–¹å¼æ¦‚è§ˆ**
```
é™æ€é…ç½®å‘ç°ï¼š
- æ‰‹åŠ¨åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šèŠ‚ç‚¹åˆ—è¡¨
- é€‚åˆå°è§„æ¨¡ã€ç¨³å®šçš„é›†ç¾¤ç¯å¢ƒ

åŠ¨æ€å‘ç°ï¼š
- DNSå‘ç°ï¼šé€šè¿‡DNSè®°å½•è‡ªåŠ¨å‘ç°èŠ‚ç‚¹
- Consulå‘ç°ï¼šä½¿ç”¨ConsulæœåŠ¡æ³¨å†Œä¸­å¿ƒ
- etcdå‘ç°ï¼šåŸºäºetcdçš„æœåŠ¡å‘ç°
```

### 5.2 èŠ‚ç‚¹é€šä¿¡åè®®



**ğŸ“¡ é€šä¿¡åŸºç¡€**
RabbitMQåŸºäº**Erlangåˆ†å¸ƒå¼ç³»ç»Ÿ**ï¼ŒèŠ‚ç‚¹é—´é€šä¿¡ä½¿ç”¨ï¼š
- **TCPè¿æ¥**ï¼šå¯é çš„ç‚¹å¯¹ç‚¹é€šä¿¡
- **Erlangæ¶ˆæ¯ä¼ é€’**ï¼šé«˜æ•ˆçš„è¿›ç¨‹é—´é€šä¿¡
- **å¿ƒè·³æ£€æµ‹**ï¼šå®šæœŸæ£€æŸ¥èŠ‚ç‚¹å­˜æ´»çŠ¶æ€

**ğŸ”„ é€šä¿¡ç«¯å£**
```
é»˜è®¤ç«¯å£é…ç½®ï¼š
- 5672ï¼šAMQPå®¢æˆ·ç«¯è¿æ¥
- 15672ï¼šWebç®¡ç†ç•Œé¢  
- 25672ï¼šèŠ‚ç‚¹é—´é€šä¿¡ï¼ˆErlangåˆ†å¸ƒå¼ï¼‰
- 4369ï¼šErlangç«¯å£æ˜ å°„å®ˆæŠ¤è¿›ç¨‹(epmd)
```

### 5.3 ç½‘ç»œåˆ†åŒºå¤„ç†



**âš ï¸ ç½‘ç»œåˆ†åŒºé—®é¢˜**
å½“é›†ç¾¤èŠ‚ç‚¹é—´ç½‘ç»œå‡ºç°æ•…éšœæ—¶ï¼Œå¯èƒ½å‘ç”Ÿ**"è„‘è£‚"**ç°è±¡ï¼š

```
æ­£å¸¸æƒ…å†µï¼š
èŠ‚ç‚¹A â†â†’ èŠ‚ç‚¹B â†â†’ èŠ‚ç‚¹C

ç½‘ç»œåˆ†åŒºï¼š
èŠ‚ç‚¹A â†â†’ èŠ‚ç‚¹B    èŠ‚ç‚¹Cï¼ˆå­¤ç«‹ï¼‰
```

**ğŸ›¡ï¸ åˆ†åŒºå¤„ç†ç­–ç•¥**
- **ignore**ï¼šå¿½ç•¥åˆ†åŒºï¼Œå„è‡ªç‹¬ç«‹è¿è¡Œ
- **pause_minority**ï¼šå°‘æ•°èŠ‚ç‚¹æš‚åœæœåŠ¡
- **pause_if_all_down**ï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½æ— æ³•é€šä¿¡æ—¶æš‚åœ
- **autoheal**ï¼šè‡ªåŠ¨ä¿®å¤ï¼Œé‡æ–°åŒæ­¥æ•°æ®

---

## 6. ğŸ”„ é›†ç¾¤å½¢æˆè¿‡ç¨‹



### 6.1 é›†ç¾¤å½¢æˆæ­¥éª¤



**ğŸ“‹ æ ‡å‡†é›†ç¾¤æ­å»ºæµç¨‹**

```
ç¬¬1æ­¥ï¼šç¯å¢ƒå‡†å¤‡
â”œâ”€â”€ ç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹æ—¶é—´åŒæ­¥
â”œâ”€â”€ é…ç½®ç½‘ç»œè¿é€šæ€§
â”œâ”€â”€ å®‰è£…ç›¸åŒç‰ˆæœ¬çš„RabbitMQ
â””â”€â”€ è®¾ç½®ä¸»æœºåè§£æ

ç¬¬2æ­¥ï¼šCookieåŒæ­¥
â”œâ”€â”€ ç”Ÿæˆæˆ–é€‰æ‹©ä¸€ä¸ªCookieå€¼
â”œâ”€â”€ å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„Cookieæ–‡ä»¶
â”œâ”€â”€ è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
â””â”€â”€ é‡å¯RabbitMQæœåŠ¡

ç¬¬3æ­¥ï¼šé›†ç¾¤åŠ å…¥
â”œâ”€â”€ é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºåŸºç¡€èŠ‚ç‚¹
â”œâ”€â”€ å…¶ä»–èŠ‚ç‚¹é€ä¸ªåŠ å…¥é›†ç¾¤
â”œâ”€â”€ éªŒè¯é›†ç¾¤çŠ¶æ€
â””â”€â”€ é…ç½®é•œåƒé˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰
```

### 6.2 å®é™…æ“ä½œæ¼”ç¤º



**ğŸ¯ 3èŠ‚ç‚¹é›†ç¾¤æ­å»ºç¤ºä¾‹**

å‡è®¾æœ‰ä¸‰å°æœåŠ¡å™¨ï¼š
- rabbit1: 192.168.1.10
- rabbit2: 192.168.1.11  
- rabbit3: 192.168.1.12

**ç¬¬ä¸€æ­¥ï¼šåŸºç¡€ç¯å¢ƒé…ç½®**
```bash
# æ‰€æœ‰èŠ‚ç‚¹é…ç½®ä¸»æœºåæ˜ å°„

echo "192.168.1.10 rabbit1" >> /etc/hosts
echo "192.168.1.11 rabbit2" >> /etc/hosts
echo "192.168.1.12 rabbit3" >> /etc/hosts
```

**ç¬¬äºŒæ­¥ï¼šCookieåŒæ­¥**
```bash
# åœ¨rabbit1ä¸Šç”ŸæˆCookie

sudo systemctl stop rabbitmq-server
sudo echo "my_secret_cookie_123456" > /var/lib/rabbitmq/.erlang.cookie
sudo chmod 600 /var/lib/rabbitmq/.erlang.cookie
sudo chown rabbitmq:rabbitmq /var/lib/rabbitmq/.erlang.cookie

# å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ï¼ˆrabbit2ã€rabbit3é‡å¤ç›¸åŒæ“ä½œï¼‰

```

**ç¬¬ä¸‰æ­¥ï¼šé›†ç¾¤åŠ å…¥**
```bash
# rabbit1ä½œä¸ºåŸºç¡€èŠ‚ç‚¹ï¼Œå¯åŠ¨æœåŠ¡

sudo systemctl start rabbitmq-server

# rabbit2åŠ å…¥é›†ç¾¤

sudo systemctl start rabbitmq-server
sudo rabbitmqctl stop_app
sudo rabbitmqctl join_cluster rabbit@rabbit1
sudo rabbitmqctl start_app

# rabbit3åŠ å…¥é›†ç¾¤

sudo systemctl start rabbitmq-server  
sudo rabbitmqctl stop_app
sudo rabbitmqctl join_cluster rabbit@rabbit1
sudo rabbitmqctl start_app
```

### 6.3 é›†ç¾¤çŠ¶æ€éªŒè¯



**âœ… æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€**
```bash
# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

sudo rabbitmqctl cluster_status

# é¢„æœŸè¾“å‡ºç¤ºä¾‹ï¼š

Cluster status of node rabbit@rabbit1
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]},
         {ram,[rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]},
 {cluster_name,<<"rabbit@rabbit1">>},
 {partitions,[]},
 {alarms,[]}]
```

**ğŸ” çŠ¶æ€è§£è¯»**
- **discèŠ‚ç‚¹**ï¼šç£ç›˜èŠ‚ç‚¹åˆ—è¡¨
- **ramèŠ‚ç‚¹**ï¼šå†…å­˜èŠ‚ç‚¹åˆ—è¡¨  
- **running_nodes**ï¼šå½“å‰è¿è¡Œçš„èŠ‚ç‚¹
- **partitions**ï¼šç½‘ç»œåˆ†åŒºæƒ…å†µï¼ˆåº”ä¸ºç©ºï¼‰
- **alarms**ï¼šå‘Šè­¦ä¿¡æ¯ï¼ˆåº”ä¸ºç©ºï¼‰

---

## 7. ğŸ› ï¸ é›†ç¾¤ç®¡ç†å®è·µ



### 7.1 æ—¥å¸¸ç®¡ç†å‘½ä»¤



**ğŸ“‹ å¸¸ç”¨ç®¡ç†æ“ä½œ**
```bash
# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

rabbitmqctl cluster_status

# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯

rabbitmqctl node_health_check

# åœæ­¢èŠ‚ç‚¹åº”ç”¨ï¼ˆä¸å…³é—­Erlangè™šæ‹Ÿæœºï¼‰

rabbitmqctl stop_app

# å¯åŠ¨èŠ‚ç‚¹åº”ç”¨

rabbitmqctl start_app

# é‡ç½®èŠ‚ç‚¹ï¼ˆæ¸…é™¤æ‰€æœ‰æ•°æ®ï¼‰

rabbitmqctl reset

# å¼ºåˆ¶é‡ç½®ï¼ˆå¿½ç•¥é›†ç¾¤çŠ¶æ€ï¼‰

rabbitmqctl force_reset
```

### 7.2 èŠ‚ç‚¹ç»´æŠ¤æ“ä½œ



**ğŸ”„ èŠ‚ç‚¹ä¸‹çº¿ç»´æŠ¤**
```bash
# å®‰å…¨ä¸‹çº¿æ­¥éª¤ï¼š

1. åœæ­¢åº”ç”¨æ¥æ”¶æ–°æ¶ˆæ¯
2. ç­‰å¾…å½“å‰æ¶ˆæ¯å¤„ç†å®Œæˆ
3. åœæ­¢RabbitMQåº”ç”¨
4. æ‰§è¡Œç»´æŠ¤æ“ä½œ
5. é‡æ–°å¯åŠ¨åŠ å…¥é›†ç¾¤
```

**âš¡ ç´§æ€¥æ¢å¤å¤„ç†**
```bash
# é›†ç¾¤å®Œå…¨æ•…éšœæ¢å¤ï¼š

1. é€‰æ‹©æ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹
2. å¼ºåˆ¶å¯åŠ¨è¯¥èŠ‚ç‚¹
   rabbitmqctl force_boot
3. å…¶ä»–èŠ‚ç‚¹é‡æ–°åŠ å…¥é›†ç¾¤
4. éªŒè¯æ•°æ®å®Œæ•´æ€§
```

### 7.3 é›†ç¾¤ç›‘æ§è¦ç‚¹



**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
- **èŠ‚ç‚¹å­˜æ´»çŠ¶æ€**ï¼šæ‰€æœ‰èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸è¿è¡Œ
- **å†…å­˜ä½¿ç”¨ç‡**ï¼šé¿å…å†…å­˜è€—å°½å¯¼è‡´é˜»å¡
- **ç£ç›˜ä½¿ç”¨ç‡**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿå­˜å‚¨ç©ºé—´
- **ç½‘ç»œè¿é€šæ€§**ï¼šèŠ‚ç‚¹é—´é€šä¿¡æ˜¯å¦æ­£å¸¸
- **é˜Ÿåˆ—å †ç§¯æƒ…å†µ**ï¼šæ¶ˆæ¯æ˜¯å¦æ­£å¸¸å¤„ç†

**âš ï¸ å‘Šè­¦é˜ˆå€¼å»ºè®®**
```
å†…å­˜ä½¿ç”¨ç‡ > 80%ï¼šè­¦å‘Š
å†…å­˜ä½¿ç”¨ç‡ > 90%ï¼šä¸¥é‡å‘Šè­¦
ç£ç›˜ä½¿ç”¨ç‡ > 85%ï¼šè­¦å‘Š
èŠ‚ç‚¹ç¦»çº¿è¶…è¿‡5åˆ†é’Ÿï¼šç´§æ€¥å‘Šè­¦
é˜Ÿåˆ—å †ç§¯è¶…è¿‡10000æ¡ï¼šè­¦å‘Š
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ é›†ç¾¤æœ¬è´¨ï¼šå¤šä¸ªRabbitMQèŠ‚ç‚¹ååŒå·¥ä½œçš„åˆ†å¸ƒå¼ç³»ç»Ÿ
ğŸ”¸ èŠ‚ç‚¹ç±»å‹ï¼šç£ç›˜èŠ‚ç‚¹ï¼ˆæŒä¹…åŒ–ï¼‰vs å†…å­˜èŠ‚ç‚¹ï¼ˆé«˜æ€§èƒ½ï¼‰
ğŸ”¸ Cookieæœºåˆ¶ï¼šé›†ç¾¤èŠ‚ç‚¹é—´çš„èº«ä»½è®¤è¯å‡­è¯
ğŸ”¸ èŠ‚ç‚¹å‘ç°ï¼šé™æ€é…ç½®æˆ–åŠ¨æ€å‘ç°çš„èŠ‚ç‚¹åŠ å…¥æ–¹å¼
ğŸ”¸ é›†ç¾¤å½¢æˆï¼šæœ‰åºçš„èŠ‚ç‚¹åŠ å…¥å’ŒçŠ¶æ€åŒæ­¥è¿‡ç¨‹
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦é›†ç¾¤**
```
ä¸šåŠ¡éœ€æ±‚ï¼š
- é«˜å¯ç”¨æ€§ï¼šå•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“æœåŠ¡
- è´Ÿè½½åˆ†æ‹…ï¼šå¤šèŠ‚ç‚¹åˆ†æ‘Šå¤„ç†å‹åŠ›
- æ°´å¹³æ‰©å±•ï¼šæŒ‰éœ€å¢åŠ å¤„ç†èƒ½åŠ›
- æ•°æ®å®‰å…¨ï¼šå¤šé‡å¤‡ä»½ä¿è¯æ•°æ®ä¸ä¸¢å¤±
```

**ğŸ”¹ ç£ç›˜èŠ‚ç‚¹vså†…å­˜èŠ‚ç‚¹é€‰æ‹©**
```
ç£ç›˜èŠ‚ç‚¹é€‚ç”¨äºï¼š
- æ ¸å¿ƒä¸šåŠ¡æ•°æ®å­˜å‚¨
- é›†ç¾¤å…ƒæ•°æ®ç®¡ç†
- é‡è¦é…ç½®ä¿¡æ¯ä¿å­˜

å†…å­˜èŠ‚ç‚¹é€‚ç”¨äºï¼š
- é«˜å¹¶å‘æ¶ˆæ¯å¤„ç†
- ä¸´æ—¶é˜Ÿåˆ—æ“ä½œ
- è®¡ç®—å¯†é›†å‹ä»»åŠ¡
```

**ğŸ”¹ Cookieå®‰å…¨çš„é‡è¦æ€§**
```
å®‰å…¨é£é™©ï¼š
- Cookieæ³„éœ²å¯èƒ½å¯¼è‡´æœªæˆæƒèŠ‚ç‚¹åŠ å…¥
- é›†ç¾¤æ•°æ®å¯èƒ½è¢«æ¶æ„è®¿é—®
- å½±å“æ•´ä¸ªæ¶ˆæ¯ç³»ç»Ÿå®‰å…¨

é˜²æŠ¤æªæ–½ï¼š
- ä½¿ç”¨å¤æ‚éšæœºCookie
- ä¸¥æ ¼æ§åˆ¶æ–‡ä»¶æƒé™
- å®šæœŸæ›´æ¢Cookieå€¼
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ ç”Ÿäº§ç¯å¢ƒåº”ç”¨**
- **ç”µå•†å¹³å°**ï¼šè®¢å•å¤„ç†çš„é«˜å¯ç”¨ä¿éšœ
- **é‡‘èç³»ç»Ÿ**ï¼šäº¤æ˜“æ¶ˆæ¯çš„å¯é ä¼ é€’
- **ç‰©è”ç½‘**ï¼šè®¾å¤‡æ•°æ®çš„åˆ†å¸ƒå¼å¤„ç†
- **å¾®æœåŠ¡æ¶æ„**ï¼šæœåŠ¡é—´é€šä¿¡çš„ç¨³å®šæ”¯æ’‘

**ğŸ› ï¸ æœ€ä½³å®è·µå»ºè®®**
```
é›†ç¾¤è§„åˆ’ï¼š
- å°å‹ä¸šåŠ¡ï¼š3èŠ‚ç‚¹ï¼ˆ2ç£ç›˜+1å†…å­˜ï¼‰
- ä¸­å‹ä¸šåŠ¡ï¼š5èŠ‚ç‚¹ï¼ˆ3ç£ç›˜+2å†…å­˜ï¼‰
- å¤§å‹ä¸šåŠ¡ï¼š7+èŠ‚ç‚¹ï¼ˆå¥‡æ•°ç£ç›˜èŠ‚ç‚¹ï¼‰

è¿ç»´è¦ç‚¹ï¼š
- å®šæœŸç›‘æ§é›†ç¾¤å¥åº·çŠ¶æ€
- åˆ¶å®šèŠ‚ç‚¹æ•…éšœåº”æ€¥é¢„æ¡ˆ
- å»ºç«‹å®Œå–„çš„å¤‡ä»½æ¢å¤æœºåˆ¶
- åˆç†é…ç½®èµ„æºå‘Šè­¦é˜ˆå€¼
```

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



- [ ] ç†è§£é›†ç¾¤çš„åŸºæœ¬æ¦‚å¿µå’Œä¼˜åŠ¿
- [ ] æŒæ¡ç£ç›˜èŠ‚ç‚¹å’Œå†…å­˜èŠ‚ç‚¹çš„åŒºåˆ«
- [ ] äº†è§£Erlang Cookieçš„ä½œç”¨æœºåˆ¶
- [ ] ä¼šé…ç½®å’Œç®¡ç†é›†ç¾¤èŠ‚ç‚¹
- [ ] èƒ½å¤„ç†å¸¸è§çš„é›†ç¾¤æ•…éšœ
- [ ] æŒæ¡é›†ç¾¤ç›‘æ§çš„å…³é”®æŒ‡æ ‡

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> é›†ç¾¤åä½œä¿é«˜å¯ç”¨ï¼Œç£ç›˜å†…å­˜å„æœ‰åˆ†å·¥
> Cookieè®¤è¯é˜²å…¥ä¾µï¼ŒèŠ‚ç‚¹å‘ç°é é€šä¿¡
> ç»„å»ºé›†ç¾¤æŒ‰æ­¥éª¤ï¼Œç›‘æ§ç»´æŠ¤ä¸èƒ½åœ

**ğŸ’¡ å»¶ä¼¸å­¦ä¹ å»ºè®®**
- å­¦ä¹ é•œåƒé˜Ÿåˆ—é…ç½®å’Œç®¡ç†
- äº†è§£RabbitMQçš„é«˜å¯ç”¨æ–¹æ¡ˆ
- ç ”ç©¶åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜
- æŒæ¡å®¹å™¨åŒ–é›†ç¾¤éƒ¨ç½²æ–¹æ³•