---
title: 31ã€æ•…éšœæ’æŸ¥å·¥å…·ä¸æ–¹æ³•
---
## ğŸ“š ç›®å½•

1. [æ•…éšœæ’æŸ¥å·¥å…·ä¸æ–¹æ³•](#1-æ•…éšœæ’æŸ¥å·¥å…·ä¸æ–¹æ³•)
2. [è¿æ¥ä¸è®¤è¯é—®é¢˜](#2-è¿æ¥ä¸è®¤è¯é—®é¢˜)
3. [æ¶ˆæ¯é˜Ÿåˆ—é—®é¢˜](#3-æ¶ˆæ¯é˜Ÿåˆ—é—®é¢˜)
4. [æ€§èƒ½ä¸èµ„æºé—®é¢˜](#4-æ€§èƒ½ä¸èµ„æºé—®é¢˜)
5. [é›†ç¾¤ä¸é«˜å¯ç”¨é—®é¢˜](#5-é›†ç¾¤ä¸é«˜å¯ç”¨é—®é¢˜)
6. [ç›‘æ§ä¸æ—¥å¿—åˆ†æ](#6-ç›‘æ§ä¸æ—¥å¿—åˆ†æ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ æ•…éšœæ’æŸ¥å·¥å…·ä¸æ–¹æ³•


### 1.1 RabbitMQ ç®¡ç†å·¥å…·æ¦‚è§ˆ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ•…éšœæ’æŸ¥**
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ RabbitMQ å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°é—®é¢˜çš„æ ¹æºå¹¶è§£å†³å®ƒã€‚å°±åƒåŒ»ç”Ÿç»™ç—…äººçœ‹ç—…ä¸€æ ·ï¼Œéœ€è¦å…ˆæ£€æŸ¥ç—‡çŠ¶ï¼Œç„¶åæ‰¾åˆ°ç—…å› ï¼Œæœ€åå¯¹ç—‡ä¸‹è¯ã€‚

**ğŸ’¡ æ•…éšœæ’æŸ¥çš„åŸºæœ¬æ€è·¯**
```
å‘ç°é—®é¢˜ â†’ æ”¶é›†ä¿¡æ¯ â†’ åˆ†æåŸå›  â†’ è§£å†³é—®é¢˜ â†’ éªŒè¯ç»“æœ

å°±åƒè§£å†³ç”Ÿæ´»ä¸­çš„é—®é¢˜ï¼š
1. ç”µè„‘æ…¢äº†ï¼ˆå‘ç°é—®é¢˜ï¼‰
2. çœ‹ä»»åŠ¡ç®¡ç†å™¨ï¼ˆæ”¶é›†ä¿¡æ¯ï¼‰
3. å‘ç°æŸä¸ªç¨‹åºå ç”¨å¤ªå¤šå†…å­˜ï¼ˆåˆ†æåŸå› ï¼‰
4. å…³é—­è¿™ä¸ªç¨‹åºï¼ˆè§£å†³é—®é¢˜ï¼‰
5. ç”µè„‘å˜å¿«äº†ï¼ˆéªŒè¯ç»“æœï¼‰
```

### 1.2 åŸºç¡€æ’æŸ¥å‘½ä»¤è¯¦è§£


**ğŸ”¸ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥å‘½ä»¤**

| å‘½ä»¤ | **ä½œç”¨** | **ä»€ä¹ˆæ—¶å€™ç”¨** |
|------|---------|---------------|
| `rabbitmqctl status` | `æŸ¥çœ‹ RabbitMQ æ•´ä½“è¿è¡ŒçŠ¶æ€` | `æ€€ç–‘æœåŠ¡æœ‰é—®é¢˜æ—¶` |
| `rabbitmqctl cluster_status` | `æŸ¥çœ‹é›†ç¾¤çŠ¶æ€` | `é›†ç¾¤ç¯å¢ƒä¸‹çš„é—®é¢˜` |
| `rabbitmqctl list_queues` | `æŸ¥çœ‹æ‰€æœ‰é˜Ÿåˆ—æƒ…å†µ` | `æ¶ˆæ¯å †ç§¯æˆ–é˜Ÿåˆ—å¼‚å¸¸` |
| `rabbitmqctl list_exchanges` | `æŸ¥çœ‹äº¤æ¢æœºçŠ¶æ€` | `æ¶ˆæ¯è·¯ç”±é—®é¢˜` |

**ğŸ’» å®ç”¨ç¤ºä¾‹ï¼šæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ­£å¸¸**
```bash
# ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥ RabbitMQ æ˜¯å¦æ­£å¸¸è¿è¡Œ
rabbitmqctl status

# ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
# Status of node rabbit@hostname ...
# [{pid,12345},
#  {running_applications,
#   [{rabbit,"RabbitMQ","3.11.0"},
#    {mnesia,"MNESIA  CXC 138 12","4.20.4"}]}]

# å¦‚æœçœ‹åˆ° running çŠ¶æ€ï¼Œè¯´æ˜æœåŠ¡æ­£å¸¸
# å¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œè¯´æ˜ RabbitMQ å¯èƒ½æ²¡å¯åŠ¨
```

**ğŸ”¸ è¿æ¥å’Œé€šé“æ£€æŸ¥**

> ğŸ’¡ **ç®€å•ç†è§£**ï¼šè¿æ¥å°±åƒæ˜¯ä½ å’Œ RabbitMQ ä¹‹é—´çš„"ç”µè¯çº¿"ï¼Œé€šé“å°±åƒæ˜¯åœ¨è¿™æ¡ç”µè¯çº¿ä¸Šå¯ä»¥åŒæ—¶æ‰“å¤šä¸ª"åˆ†æœºç”µè¯"

```bash
# æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘å®¢æˆ·ç«¯è¿æ¥åˆ° RabbitMQ
rabbitmqctl list_connections

# æŸ¥çœ‹æ¯ä¸ªè¿æ¥ä¸Šå¼€äº†å¤šå°‘ä¸ªé€šé“
rabbitmqctl list_channels

# æŸ¥çœ‹æœ‰å“ªäº›æ¶ˆè´¹è€…åœ¨ç›‘å¬é˜Ÿåˆ—
rabbitmqctl list_consumers
```

### 1.3 å†…å­˜å’Œç£ç›˜ç›‘æ§


**ğŸ”¸ èµ„æºä½¿ç”¨æƒ…å†µæ£€æŸ¥**

RabbitMQ å°±åƒæ˜¯ä¸€ä¸ªä»“åº“ï¼Œéœ€è¦ç›‘æ§"ä»“åº“"çš„å­˜å‚¨ç©ºé—´å’Œè¿è¡ŒçŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
rabbitmqctl status | grep memory

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ  
rabbitmqctl status | grep disk

# æŸ¥çœ‹è¯¦ç»†çš„èŠ‚ç‚¹ä¿¡æ¯
rabbitmqctl environment
```

**âš ï¸ èµ„æºå‘Šè­¦é˜ˆå€¼**

| èµ„æºç±»å‹ | **æ­£å¸¸èŒƒå›´** | **éœ€è¦å…³æ³¨** | **ç´§æ€¥å¤„ç†** |
|---------|-------------|-------------|-------------|
| **å†…å­˜ä½¿ç”¨ç‡** | `< 70%` | `70-85%` | `> 85%` |
| **ç£ç›˜ä½¿ç”¨ç‡** | `< 80%` | `80-90%` | `> 90%` |
| **è¿æ¥æ•°** | `< 1000` | `1000-5000` | `> 5000` |

---

## 2. ğŸ”Œ è¿æ¥ä¸è®¤è¯é—®é¢˜


### 2.1 è¿æ¥å¤±è´¥å¸¸è§åŸå› 


**ğŸ”¸ ç½‘ç»œè¿æ¥é—®é¢˜**

æœ€å¸¸è§çš„é—®é¢˜å°±æ˜¯"è¿ä¸ä¸Š"ï¼Œå°±åƒæ‰“ç”µè¯æ‰“ä¸é€šä¸€æ ·ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š

```
å¸¸è§è¿æ¥å¤±è´¥åœºæ™¯ï¼š

âŒ è¿æ¥è¢«æ‹’ç»
åŸå› ï¼šRabbitMQ æœåŠ¡æ²¡å¯åŠ¨æˆ–ç«¯å£è¢«å ç”¨
è§£å†³ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œé‡å¯æœåŠ¡

âŒ è¶…æ—¶è¿æ¥  
åŸå› ï¼šç½‘ç»œå»¶è¿Ÿå¤§æˆ–é˜²ç«å¢™é˜»æŒ¡
è§£å†³ï¼šæ£€æŸ¥ç½‘ç»œå’Œé˜²ç«å¢™è®¾ç½®

âŒ è®¤è¯å¤±è´¥
åŸå› ï¼šç”¨æˆ·åå¯†ç é”™è¯¯æˆ–æƒé™ä¸è¶³  
è§£å†³ï¼šæ£€æŸ¥ç”¨æˆ·å‡­æ®å’Œæƒé™é…ç½®
```

**ğŸ’» è¿æ¥æµ‹è¯•æ–¹æ³•**
```bash
# æµ‹è¯•ç«¯å£æ˜¯å¦å¼€æ”¾ï¼ˆé»˜è®¤ç«¯å£ 5672ï¼‰
telnet localhost 5672

# æµ‹è¯•ç®¡ç†ç•Œé¢ç«¯å£ï¼ˆé»˜è®¤ 15672ï¼‰
telnet localhost 15672

# å¦‚æœè¿æ¥æˆåŠŸï¼Œä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# Trying 127.0.0.1...
# Connected to localhost.
```

### 2.2 ç”¨æˆ·æƒé™é—®é¢˜æ’æŸ¥


**ğŸ”¸ æƒé™ç³»ç»Ÿè§£é‡Š**

RabbitMQ çš„æƒé™ç³»ç»Ÿå°±åƒå…¬å¸çš„é—¨ç¦å¡ï¼š
- **ç”¨æˆ·**ï¼šå°±æ˜¯ä½ çš„å‘˜å·¥å¡
- **è™šæ‹Ÿä¸»æœº**ï¼šå°±åƒå…¬å¸çš„ä¸åŒæ¥¼å±‚
- **æƒé™**ï¼šå†³å®šä½ èƒ½åœ¨å“ªä¸ªæ¥¼å±‚åšä»€ä¹ˆäº‹

```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
rabbitmqctl list_users

# æŸ¥çœ‹ç”¨æˆ·æƒé™
rabbitmqctl list_permissions

# æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„æƒé™
rabbitmqctl list_user_permissions username
```

**ğŸ”§ æƒé™é…ç½®ç¤ºä¾‹**
```bash
# åˆ›å»ºæ–°ç”¨æˆ·
rabbitmqctl add_user myuser mypassword

# è®¾ç½®ç”¨æˆ·æ ‡ç­¾ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
rabbitmqctl set_user_tags myuser administrator

# ç»™ç”¨æˆ·åˆ†é…æƒé™ï¼ˆåœ¨é»˜è®¤è™šæ‹Ÿä¸»æœº / ä¸Šï¼‰
# æ ¼å¼ï¼šé…ç½®æƒé™ å†™æƒé™ è¯»æƒé™
rabbitmqctl set_permissions -p / myuser ".*" ".*" ".*"
```

**ğŸ’¡ æƒé™è¯´æ˜**

| æƒé™ç±»å‹ | **å«ä¹‰** | **å®é™…ç”¨é€”** |
|---------|---------|-------------|
| **é…ç½®æƒé™** | `èƒ½å¦åˆ›å»º/åˆ é™¤é˜Ÿåˆ—å’Œäº¤æ¢æœº` | `".*" è¡¨ç¤ºå¯ä»¥æ“ä½œæ‰€æœ‰èµ„æº` |
| **å†™æƒé™** | `èƒ½å¦å‘é€æ¶ˆæ¯` | `".*" è¡¨ç¤ºå¯ä»¥å‘æ‰€æœ‰é˜Ÿåˆ—å‘æ¶ˆæ¯` |
| **è¯»æƒé™** | `èƒ½å¦æ¥æ”¶æ¶ˆæ¯` | `".*" è¡¨ç¤ºå¯ä»¥ä»æ‰€æœ‰é˜Ÿåˆ—æ”¶æ¶ˆæ¯` |

### 2.3 SSL/TLS è¿æ¥é—®é¢˜


**ğŸ”¸ å®‰å…¨è¿æ¥é…ç½®**

å½“ä½ éœ€è¦åŠ å¯†è¿æ¥æ—¶ï¼ˆå°±åƒ HTTPS å’Œ HTTP çš„åŒºåˆ«ï¼‰ï¼Œå¯èƒ½é‡åˆ°è¯ä¹¦é—®é¢˜ï¼š

> âš ï¸ **å¸¸è§ SSL é”™è¯¯**  
> `SSL handshake failed` - é€šå¸¸æ˜¯è¯ä¹¦é…ç½®é—®é¢˜  
> `Certificate verification failed` - è¯ä¹¦ä¸è¢«ä¿¡ä»»

**ğŸ”§ SSL é—®é¢˜æ’æŸ¥æ­¥éª¤**
```bash
# 1. æ£€æŸ¥ SSL ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ 5671ï¼‰
netstat -tlnp | grep 5671

# 2. æµ‹è¯• SSL è¿æ¥
openssl s_client -connect localhost:5671

# 3. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in /path/to/cert.pem -text -noout
```

---

## 3. ğŸ“¬ æ¶ˆæ¯é˜Ÿåˆ—é—®é¢˜


### 3.1 æ¶ˆæ¯å †ç§¯é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ¶ˆæ¯å †ç§¯**

æƒ³è±¡ä¸€ä¸‹é‚®å±€çš„æƒ…å†µï¼šå¦‚æœå¯„ä¿¡çš„äººå¾ˆå¤šï¼Œä½†å–ä¿¡çš„äººå¾ˆå°‘ï¼Œé‚®ç®±å°±ä¼šçˆ†æ»¡ã€‚RabbitMQ ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå½“ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦æ—¶ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šè¶Šç§¯è¶Šå¤šã€‚

```
æ­£å¸¸æƒ…å†µï¼šç”Ÿäº§é€Ÿåº¦ â‰ˆ æ¶ˆè´¹é€Ÿåº¦
æ¶ˆæ¯å †ç§¯ï¼šç”Ÿäº§é€Ÿåº¦ > æ¶ˆè´¹é€Ÿåº¦

é‚®å±€ç±»æ¯”ï¼š
ğŸ“® ç”Ÿäº§è€… = å¯„ä¿¡çš„äºº
ğŸ“ª é˜Ÿåˆ— = é‚®ç®±  
ğŸ‘¤ æ¶ˆè´¹è€… = å–ä¿¡çš„äºº
```

**ğŸ“Š ç›‘æ§æ¶ˆæ¯å †ç§¯**
```bash
# æŸ¥çœ‹é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°é‡
rabbitmqctl list_queues name messages consumers

# è¾“å‡ºç¤ºä¾‹ï¼š
# Listing queues for vhost / ...
# my_queue    1500    2    <- é˜Ÿåˆ—æœ‰1500æ¡æ¶ˆæ¯ï¼Œ2ä¸ªæ¶ˆè´¹è€…
```

**ğŸ”§ è§£å†³æ¶ˆæ¯å †ç§¯çš„æ–¹æ³•**

| è§£å†³æ–¹æ¡ˆ | **é€‚ç”¨åœºæ™¯** | **å®æ–½æ–¹æ³•** |
|---------|-------------|-------------|
| **å¢åŠ æ¶ˆè´¹è€…** | `ä¸´æ—¶æµé‡é«˜å³°` | `å¯åŠ¨æ›´å¤šæ¶ˆè´¹è€…å®ä¾‹` |
| **ä¼˜åŒ–æ¶ˆè´¹é€»è¾‘** | `æ¶ˆè´¹å¤„ç†æ…¢` | `æ”¹è¿›ä»£ç ï¼Œå‡å°‘å¤„ç†æ—¶é—´` |
| **åˆ†æ‰¹å¤„ç†** | `æ¶ˆæ¯å¤„ç†å¤æ‚` | `ä¸€æ¬¡å¤„ç†å¤šæ¡æ¶ˆæ¯` |
| **æ¶ˆæ¯è¿‡æœŸ** | `å†å²æ¶ˆæ¯å¤ªå¤š` | `è®¾ç½®æ¶ˆæ¯ TTL` |

### 3.2 æ¶ˆæ¯ä¸¢å¤±é—®é¢˜


**ğŸ”¸ æ¶ˆæ¯ä¸¢å¤±çš„å¸¸è§åŸå› **

æ¶ˆæ¯ä¸¢å¤±å°±åƒå¿«é€’ä¸¢å¤±ä¸€æ ·ï¼Œå¯èƒ½åœ¨å„ä¸ªç¯èŠ‚å‡ºé—®é¢˜ï¼š

```
æ¶ˆæ¯ä¼ é€’é“¾è·¯ï¼š
ç”Ÿäº§è€… â†’ RabbitMQ â†’ æ¶ˆè´¹è€…

å¯èƒ½ä¸¢å¤±çš„åœ°æ–¹ï¼š
1. ç”Ÿäº§è€…å‘é€å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ï¼‰
2. RabbitMQ é‡å¯æ—¶å†…å­˜æ¶ˆæ¯ä¸¢å¤±
3. æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶å´©æºƒ
```

**ğŸ’¡ æ¶ˆæ¯æŒä¹…åŒ–é…ç½®**
```java
// Java ç¤ºä¾‹ï¼šç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±
public class MessageProducer {
    public void sendMessage(String message) {
        // 1. å£°æ˜æŒä¹…åŒ–é˜Ÿåˆ—
        channel.queueDeclare("my_queue", 
            true,    // durable: é˜Ÿåˆ—æŒä¹…åŒ–
            false,   // exclusive
            false,   // autoDelete  
            null);
        
        // 2. å‘é€æŒä¹…åŒ–æ¶ˆæ¯
        channel.basicPublish("", "my_queue",
            MessageProperties.PERSISTENT_TEXT_PLAIN,  // æ¶ˆæ¯æŒä¹…åŒ–
            message.getBytes());
    }
}
```

**âœ… æ¶ˆæ¯ç¡®è®¤æœºåˆ¶**
```java
// æ¶ˆè´¹è€…æ‰‹åŠ¨ç¡®è®¤
public class MessageConsumer {
    public void consumeMessage() {
        channel.basicConsume("my_queue", 
            false,  // autoAck: falseï¼Œæ‰‹åŠ¨ç¡®è®¤
            (consumerTag, delivery) -> {
                try {
                    // å¤„ç†æ¶ˆæ¯
                    String message = new String(delivery.getBody());
                    processMessage(message);
                    
                    // å¤„ç†æˆåŠŸåç¡®è®¤
                    channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
                } catch (Exception e) {
                    // å¤„ç†å¤±è´¥ï¼Œæ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°å…¥é˜Ÿ
                    channel.basicNack(delivery.getEnvelope().getDeliveryTag(), 
                        false, true);
                }
            });
    }
}
```

### 3.3 æ­»ä¿¡é˜Ÿåˆ—é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—**

æ­»ä¿¡é˜Ÿåˆ—å°±åƒæ˜¯"é—®é¢˜ä»¶å¤„ç†ä¸­å¿ƒ"ï¼Œå½“æ¶ˆæ¯æ— æ³•æ­£å¸¸å¤„ç†æ—¶ï¼Œä¼šè¢«é€åˆ°è¿™é‡Œï¼š

```
æ¶ˆæ¯å˜æˆæ­»ä¿¡çš„åŸå› ï¼š
1. æ¶ˆæ¯è¢«æ‹’ç»ä¸”ä¸é‡æ–°å…¥é˜Ÿ
2. æ¶ˆæ¯è¿‡æœŸï¼ˆTTL è¶…æ—¶ï¼‰
3. é˜Ÿåˆ—é•¿åº¦è¶…è¿‡é™åˆ¶

å°±åƒå¿«é€’ï¼š
ğŸ“¦ æ­£å¸¸æ¶ˆæ¯ = æ­£å¸¸æ´¾é€çš„åŒ…è£¹
ğŸ’€ æ­»ä¿¡æ¶ˆæ¯ = æ— æ³•æ´¾é€çš„é—®é¢˜ä»¶
ğŸ¢ æ­»ä¿¡é˜Ÿåˆ— = å¿«é€’å…¬å¸çš„é—®é¢˜ä»¶ä»“åº“
```

**ğŸ”§ æ­»ä¿¡é˜Ÿåˆ—é…ç½®**
```java
// é…ç½®æ­»ä¿¡é˜Ÿåˆ—
Map<String, Object> args = new HashMap<>();
args.put("x-dead-letter-exchange", "dlx.exchange");  // æ­»ä¿¡äº¤æ¢æœº
args.put("x-dead-letter-routing-key", "dlx.key");    // æ­»ä¿¡è·¯ç”±é”®
args.put("x-message-ttl", 60000);                    // æ¶ˆæ¯è¿‡æœŸæ—¶é—´

channel.queueDeclare("normal_queue", true, false, false, args);
```

---

## 4. ğŸš€ æ€§èƒ½ä¸èµ„æºé—®é¢˜


### 4.1 å†…å­˜ä½¿ç”¨é—®é¢˜


**ğŸ”¸ å†…å­˜é—®é¢˜çš„è¡¨ç°**

RabbitMQ å°±åƒæ˜¯ä½ çš„æ‰‹æœºï¼Œå½“å†…å­˜ä¸å¤Ÿæ—¶ä¼šå‡ºç°å„ç§é—®é¢˜ï¼š

```
å†…å­˜ä¸è¶³çš„ç—‡çŠ¶ï¼š
ğŸ“± æ‰‹æœºå¡é¡¿ â†’ ğŸ° RabbitMQ å“åº”æ…¢
ğŸ“± åº”ç”¨é—ªé€€ â†’ ğŸ° è¿æ¥è¢«å¼ºåˆ¶å…³é—­  
ğŸ“± ç³»ç»Ÿé‡å¯ â†’ ğŸ° RabbitMQ æœåŠ¡é‡å¯
```

**ğŸ“Š å†…å­˜ç›‘æ§æŒ‡æ ‡**
```bash
# æŸ¥çœ‹è¯¦ç»†å†…å­˜ä½¿ç”¨æƒ…å†µ
rabbitmqctl status | grep -A 20 memory

# ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# {memory,
#  [{connection_readers,1048576},     # è¿æ¥è¯»å–å ç”¨å†…å­˜
#   {connection_writers,524288},      # è¿æ¥å†™å…¥å ç”¨å†…å­˜  
#   {queue_procs,2097152},           # é˜Ÿåˆ—è¿›ç¨‹å ç”¨å†…å­˜
#   {plugins,1048576},               # æ’ä»¶å ç”¨å†…å­˜
#   {total,52428800}]}               # æ€»å†…å­˜ä½¿ç”¨é‡
```

**ğŸ”§ å†…å­˜ä¼˜åŒ–ç­–ç•¥**

| ä¼˜åŒ–æ–¹æ³• | **ä½œç”¨æœºåˆ¶** | **ä½¿ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| **è®¾ç½®å†…å­˜é˜ˆå€¼** | `è¾¾åˆ°é˜ˆå€¼æ—¶æš‚åœæ¥æ”¶æ¶ˆæ¯` | `é˜²æ­¢å†…å­˜æº¢å‡º` |
| **æ¶ˆæ¯åˆ†é¡µ** | `å¤§æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜` | `å¤„ç†å¤§é‡å°æ¶ˆæ¯` |
| **æƒ°æ€§é˜Ÿåˆ—** | `æ¶ˆæ¯ç›´æ¥å­˜å‚¨åˆ°ç£ç›˜` | `æ¶ˆæ¯é‡ç‰¹åˆ«å¤§çš„åœºæ™¯` |

### 4.2 ç£ç›˜ç©ºé—´é—®é¢˜


**ğŸ”¸ ç£ç›˜ç©ºé—´ç®¡ç†**

```bash
# æŸ¥çœ‹ RabbitMQ æ•°æ®ç›®å½•å¤§å°
du -sh /var/lib/rabbitmq/

# æŸ¥çœ‹å„ä¸ªé˜Ÿåˆ—çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ
rabbitmqctl list_queues name messages_persistent_size
```

**âš ï¸ ç£ç›˜å‘Šè­¦å¤„ç†**
```bash
# å½“ç£ç›˜ç©ºé—´ä¸è¶³æ—¶ï¼ŒRabbitMQ ä¼šè¿›å…¥æµæ§æ¨¡å¼
# æ£€æŸ¥ç£ç›˜å‘Šè­¦
rabbitmqctl status | grep disk_free

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
find /var/log/rabbitmq -name "*.log" -mtime +7 -delete

# è®¾ç½®ç£ç›˜å‘Šè­¦é˜ˆå€¼ï¼ˆå‰©ä½™ç©ºé—´å°äº 2GB æ—¶å‘Šè­¦ï¼‰
rabbitmqctl set_disk_free_limit 2000000000
```

### 4.3 è¿æ¥æ•°é™åˆ¶é—®é¢˜


**ğŸ”¸ è¿æ¥æ•°è¿‡å¤šçš„å½±å“**

æƒ³è±¡ä¸€ä¸‹ç”µè¯æ€»æœºï¼Œå¦‚æœåŒæ—¶æ‰“è¿›æ¥çš„ç”µè¯å¤ªå¤šï¼Œå°±ä¼šå‡ºç°å¿™éŸ³ï¼š

```bash
# æŸ¥çœ‹å½“å‰è¿æ¥æ•°
rabbitmqctl list_connections | wc -l

# æŸ¥çœ‹ç³»ç»Ÿé™åˆ¶
ulimit -n    # æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦é™åˆ¶

# è®¾ç½® RabbitMQ è¿æ¥æ•°é™åˆ¶
# åœ¨ /etc/rabbitmq/rabbitmq.conf ä¸­æ·»åŠ ï¼š
# tcp_listen_options.backlog = 128
# vm_memory_high_watermark.relative = 0.6
```

---

## 5. ğŸ¢ é›†ç¾¤ä¸é«˜å¯ç”¨é—®é¢˜


### 5.1 é›†ç¾¤èŠ‚ç‚¹é—®é¢˜


**ğŸ”¸ é›†ç¾¤çš„åŸºæœ¬æ¦‚å¿µ**

RabbitMQ é›†ç¾¤å°±åƒæ˜¯ä¸€ä¸ªå¿«é€’å…¬å¸çš„å¤šä¸ªè¥ä¸šç‚¹ï¼Œå®ƒä»¬äº’ç›¸åä½œå¤„ç†ä¸šåŠ¡ï¼š

```
å•èŠ‚ç‚¹ï¼šä¸€ä¸ªè¥ä¸šç‚¹å¤„ç†æ‰€æœ‰ä¸šåŠ¡
é›†ç¾¤ï¼šå¤šä¸ªè¥ä¸šç‚¹åˆ†å·¥åˆä½œ

ä¼˜åŠ¿ï¼š
âœ… é«˜å¯ç”¨ï¼šä¸€ä¸ªè¥ä¸šç‚¹å…³é—­ï¼Œå…¶ä»–è¿˜èƒ½å·¥ä½œ
âœ… è´Ÿè½½åˆ†æ‹…ï¼šä¸šåŠ¡å‹åŠ›åˆ†æ‘Šåˆ°å¤šä¸ªèŠ‚ç‚¹
âœ… æ‰©å±•æ€§ï¼šä¸šåŠ¡å¢é•¿æ—¶å¯ä»¥å¢åŠ èŠ‚ç‚¹
```

**ğŸ”§ é›†ç¾¤çŠ¶æ€æ£€æŸ¥**
```bash
# æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
rabbitmqctl cluster_status

# å…¸å‹è¾“å‡ºï¼š
# Cluster status of node rabbit@node1 ...
# Basics
# Cluster name: rabbit@node1
# Disk Nodes: rabbit@node1, rabbit@node2, rabbit@node3
# Running Nodes: rabbit@node1, rabbit@node2
# Versions: rabbit@node1: RabbitMQ 3.11.0
```

### 5.2 è„‘è£‚é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯è„‘è£‚**

è„‘è£‚å°±åƒæ˜¯å…¬å¸æ€»éƒ¨å’Œåˆ†éƒ¨å¤±å»è”ç³»ï¼Œå„è‡ªéƒ½è®¤ä¸ºè‡ªå·±æ˜¯"è€å¤§"ï¼š

```
æ­£å¸¸æƒ…å†µï¼š
èŠ‚ç‚¹1 â†â†’ èŠ‚ç‚¹2 â†â†’ èŠ‚ç‚¹3
(éƒ½çŸ¥é“é›†ç¾¤çŠ¶æ€)

è„‘è£‚æƒ…å†µï¼š
èŠ‚ç‚¹1 â†â†’ èŠ‚ç‚¹2    èŠ‚ç‚¹3
(ç½‘ç»œæ–­å¼€ï¼Œåˆ†æˆä¸¤ä¸ª"é›†ç¾¤")
```

**ğŸ”§ è„‘è£‚é¢„é˜²å’Œè§£å†³**
```bash
# æ£€æŸ¥ç½‘ç»œåˆ†åŒº
rabbitmqctl cluster_status | grep partitions

# å¦‚æœå‘ç°åˆ†åŒºï¼Œæ‰‹åŠ¨å¤„ç†
rabbitmqctl forget_cluster_node rabbit@failed_node

# åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®åˆ†åŒºå¤„ç†ç­–ç•¥
# cluster_partition_handling = pause_minority
```

### 5.3 æ•°æ®åŒæ­¥é—®é¢˜


**ğŸ”¸ é˜Ÿåˆ—é•œåƒé…ç½®**

é•œåƒé˜Ÿåˆ—å°±åƒæ˜¯é‡è¦æ–‡ä»¶çš„å¤‡ä»½ï¼Œç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ï¼š

```bash
# è®¾ç½®é•œåƒç­–ç•¥ï¼ˆæ‰€æœ‰é˜Ÿåˆ—åœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰å‰¯æœ¬ï¼‰
rabbitmqctl set_policy ha-all ".*" '{"ha-mode":"all"}'

# è®¾ç½®é•œåƒç­–ç•¥ï¼ˆé˜Ÿåˆ—åœ¨2ä¸ªèŠ‚ç‚¹æœ‰å‰¯æœ¬ï¼‰
rabbitmqctl set_policy ha-two ".*" '{"ha-mode":"exactly","ha-params":2}'

# æŸ¥çœ‹å½“å‰ç­–ç•¥
rabbitmqctl list_policies
```

---

## 6. ğŸ“Š ç›‘æ§ä¸æ—¥å¿—åˆ†æ


### 6.1 æ—¥å¿—æ–‡ä»¶åˆ†æ


**ğŸ”¸ æ—¥å¿—æ–‡ä»¶ä½ç½®**

RabbitMQ çš„æ—¥å¿—å°±åƒæ˜¯ç³»ç»Ÿçš„"æ—¥è®°æœ¬"ï¼Œè®°å½•äº†æ‰€æœ‰é‡è¦äº‹ä»¶ï¼š

```bash
# ä¸»è¦æ—¥å¿—æ–‡ä»¶ä½ç½®
/var/log/rabbitmq/rabbit@hostname.log          # ä¸»æ—¥å¿—
/var/log/rabbitmq/rabbit@hostname-sasl.log     # ç³»ç»Ÿæ—¥å¿—  
/var/log/rabbitmq/startup_log                  # å¯åŠ¨æ—¥å¿—
/var/log/rabbitmq/startup_err                  # å¯åŠ¨é”™è¯¯æ—¥å¿—
```

**ğŸ” å¸¸è§é”™è¯¯æ¨¡å¼**
```bash
# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯ä¿¡æ¯
tail -f /var/log/rabbitmq/rabbit@hostname.log | grep ERROR

# æŸ¥æ‰¾å†…å­˜å‘Šè­¦
grep "memory alarm" /var/log/rabbitmq/rabbit@hostname.log

# æŸ¥æ‰¾è¿æ¥å¤±è´¥
grep "failed to connect" /var/log/rabbitmq/rabbit@hostname.log

# æŸ¥æ‰¾è®¤è¯å¤±è´¥  
grep "authentication failed" /var/log/rabbitmq/rabbit@hostname.log
```

### 6.2 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**

| æŒ‡æ ‡ç±»å‹ | **ç›‘æ§é¡¹** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|---------|-----------|-------------|-------------|
| **æ¶ˆæ¯å¤„ç†** | `æ¶ˆæ¯å‘å¸ƒé€Ÿç‡` | `ç¨³å®šå˜åŒ–` | `çªç„¶ä¸‹é™æˆ–æ¿€å¢` |
| **é˜Ÿåˆ—çŠ¶æ€** | `é˜Ÿåˆ—é•¿åº¦` | `< 1000` | `> 10000` |
| **èµ„æºä½¿ç”¨** | `å†…å­˜ä½¿ç”¨ç‡` | `< 70%` | `> 85%` |
| **è¿æ¥çŠ¶æ€** | `æ´»è·ƒè¿æ¥æ•°` | `ç¨³å®š` | `çªç„¶å¤§é‡æ–­å¼€` |

**ğŸ’» ç›‘æ§è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# RabbitMQ å¥åº·æ£€æŸ¥è„šæœ¬

echo "=== RabbitMQ å¥åº·æ£€æŸ¥ ==="

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
if rabbitmqctl status > /dev/null 2>&1; then
    echo "âœ… RabbitMQ æœåŠ¡è¿è¡Œæ­£å¸¸"
else
    echo "âŒ RabbitMQ æœåŠ¡å¼‚å¸¸"
    exit 1
fi

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
MEMORY_USED=$(rabbitmqctl status | grep -o '"memory",[0-9]*' | cut -d',' -f2)
if [ $MEMORY_USED -gt 1000000000 ]; then  # 1GB
    echo "âš ï¸  å†…å­˜ä½¿ç”¨è¿‡é«˜: ${MEMORY_USED} bytes"
fi

# æ£€æŸ¥é˜Ÿåˆ—å †ç§¯
QUEUE_MESSAGES=$(rabbitmqctl list_queues messages | awk '{sum+=$2} END {print sum}')
if [ $QUEUE_MESSAGES -gt 10000 ]; then
    echo "âš ï¸  æ¶ˆæ¯å †ç§¯ä¸¥é‡: $QUEUE_MESSAGES æ¡æ¶ˆæ¯"
fi

echo "âœ… å¥åº·æ£€æŸ¥å®Œæˆ"
```

### 6.3 å‘Šè­¦é…ç½®


**ğŸš¨ å‘Šè­¦è§„åˆ™è®¾ç½®**

å»ºç«‹å‘Šè­¦å°±åƒæ˜¯ç»™ RabbitMQ å®‰è£…"çƒŸé›¾æŠ¥è­¦å™¨"ï¼ŒåŠæ—¶å‘ç°é—®é¢˜ï¼š

```bash
# è®¾ç½®å†…å­˜å‘Šè­¦é˜ˆå€¼ï¼ˆå†…å­˜ä½¿ç”¨è¶…è¿‡80%æ—¶å‘Šè­¦ï¼‰
rabbitmqctl set_vm_memory_high_watermark 0.8

# è®¾ç½®ç£ç›˜å‘Šè­¦é˜ˆå€¼ï¼ˆå‰©ä½™ç©ºé—´å°‘äº1GBæ—¶å‘Šè­¦ï¼‰  
rabbitmqctl set_disk_free_limit 1000000000

# æŸ¥çœ‹å½“å‰å‘Šè­¦çŠ¶æ€
rabbitmqctl status | grep alarms
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 æ•…éšœæ’æŸ¥çš„åŸºæœ¬æµç¨‹


```
ğŸ” é—®é¢˜å‘ç°
â†“
ğŸ“Š ä¿¡æ¯æ”¶é›†ï¼ˆæ—¥å¿—ã€çŠ¶æ€ã€ç›‘æ§ï¼‰
â†“  
ğŸ¯ åŸå› åˆ†æï¼ˆç½‘ç»œã€æƒé™ã€èµ„æºã€é…ç½®ï¼‰
â†“
ğŸ”§ è§£å†³æ–¹æ¡ˆï¼ˆé‡å¯ã€é…ç½®ã€æ‰©å®¹ã€ä¼˜åŒ–ï¼‰
â†“
âœ… éªŒè¯ç»“æœï¼ˆæµ‹è¯•ã€ç›‘æ§ï¼‰
```

### 7.2 å¿…é¡»æŒæ¡çš„æ’æŸ¥å‘½ä»¤


> ğŸ’¡ **è®°å¿†å£è¯€**ï¼šçŠ¶æ€åˆ—è¡¨æƒé™æŸ¥ï¼Œè¿æ¥é€šé“æ¶ˆè´¹è€…ï¼Œå†…å­˜ç£ç›˜è¦ç›‘æ§

**ğŸ”¸ åŸºç¡€çŠ¶æ€æ£€æŸ¥**
- `rabbitmqctl status` - æ•´ä½“å¥åº·çŠ¶å†µ
- `rabbitmqctl cluster_status` - é›†ç¾¤çŠ¶æ€  
- `rabbitmqctl list_queues` - é˜Ÿåˆ—æƒ…å†µ

**ğŸ”¸ è¿æ¥å’Œæƒé™**
- `rabbitmqctl list_connections` - è¿æ¥çŠ¶æ€
- `rabbitmqctl list_users` - ç”¨æˆ·ç®¡ç†
- `rabbitmqctl list_permissions` - æƒé™æ£€æŸ¥

### 7.3 å¸¸è§é—®é¢˜å¿«é€Ÿå®šä½


| é—®é¢˜ç—‡çŠ¶ | **å¯èƒ½åŸå› ** | **å¿«é€Ÿæ£€æŸ¥å‘½ä»¤** |
|---------|-------------|-----------------|
| **è¿æ¥å¤±è´¥** | `æœåŠ¡æœªå¯åŠ¨/ç½‘ç»œé—®é¢˜` | `rabbitmqctl status` |
| **è®¤è¯å¤±è´¥** | `ç”¨æˆ·åå¯†ç é”™è¯¯` | `rabbitmqctl list_users` |
| **æ¶ˆæ¯å †ç§¯** | `æ¶ˆè´¹è€…å¤„ç†æ…¢` | `rabbitmqctl list_queues` |
| **å†…å­˜å‘Šè­¦** | `æ¶ˆæ¯å¤ªå¤š/å†…å­˜æ³„æ¼` | `rabbitmqctl status \| grep memory` |

### 7.4 é¢„é˜²æ€§ç»´æŠ¤å»ºè®®


**ğŸ›¡ï¸ æ—¥å¸¸ç»´æŠ¤æ¸…å•**

- [x] **å®šæœŸæ£€æŸ¥**ï¼šæ¯æ—¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œèµ„æºä½¿ç”¨
- [x] **æ—¥å¿—è½®è½¬**ï¼šé¿å…æ—¥å¿—æ–‡ä»¶å æ»¡ç£ç›˜
- [x] **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼  
- [x] **å¤‡ä»½ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½é…ç½®å’Œé‡è¦æ•°æ®
- [x] **ç‰ˆæœ¬æ›´æ–°**ï¼šåŠæ—¶æ›´æ–°åˆ°ç¨³å®šç‰ˆæœ¬

**âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹**

> ğŸš¨ **é‡è¦æé†’**  
> åœ¨ç”Ÿäº§ç¯å¢ƒæ“ä½œæ—¶ï¼ŒåŠ¡å¿…å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œé¿å…å½±å“ä¸šåŠ¡

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- **è¯Šæ–­å·¥å…·**ï¼šrabbitmqctl æ˜¯ä½ æœ€å¥½çš„æœ‹å‹
- **æ—¥å¿—åˆ†æ**ï¼šé”™è¯¯æ—¥å¿—é€šå¸¸èƒ½ç›´æ¥æŒ‡å‡ºé—®é¢˜
- **èµ„æºç›‘æ§**ï¼šå†…å­˜å’Œç£ç›˜æ˜¯æœ€å®¹æ˜“å‡ºé—®é¢˜çš„åœ°æ–¹  
- **é›†ç¾¤ç»´æŠ¤**ï¼šç½‘ç»œç¨³å®šæ€§æ˜¯é›†ç¾¤çš„ç”Ÿå‘½çº¿
- **é¢„é˜²ä¸ºä¸»**ï¼šå¥½çš„ç›‘æ§èƒœè¿‡å‡ºè‰²çš„æ•…éšœå¤„ç†