---
title: 1ã€RabbitMQæœåŠ¡å¯åŠ¨å¤±è´¥
---
## ğŸ“š ç›®å½•

1. [RabbitMQæ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ](#1-RabbitMQæ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ)
2. [å¯åŠ¨ä¸è¿æ¥é—®é¢˜è¯¦è§£](#2-å¯åŠ¨ä¸è¿æ¥é—®é¢˜è¯¦è§£)
3. [ç«¯å£å ç”¨ä¸ç½‘ç»œé…ç½®](#3-ç«¯å£å ç”¨ä¸ç½‘ç»œé…ç½®)
4. [ç¯å¢ƒå…¼å®¹æ€§é—®é¢˜](#4-ç¯å¢ƒå…¼å®¹æ€§é—®é¢˜)
5. [æƒé™ä¸èµ„æºé…ç½®](#5-æƒé™ä¸èµ„æºé…ç½®)
6. [æ•°æ®å®Œæ•´æ€§é—®é¢˜](#6-æ•°æ®å®Œæ•´æ€§é—®é¢˜)
7. [å®ç”¨æ’æŸ¥å·¥å…·ç®±](#7-å®ç”¨æ’æŸ¥å·¥å…·ç®±)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ° RabbitMQæ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQ


> ğŸ’¡ **ç®€å•ç†è§£**ï¼šRabbitMQå°±åƒä¸€ä¸ªé‚®å±€ï¼Œè´Ÿè´£æ¥æ”¶ã€å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯

**æ ¸å¿ƒä½œç”¨**ï¼š
```
å‘é€æ–¹ â†’ RabbitMQé‚®å±€ â†’ æ¥æ”¶æ–¹

çœŸå®åœºæ™¯ç±»æ¯”ï¼š
è®¢å•ç³»ç»Ÿ â†’ RabbitMQ â†’ åº“å­˜ç³»ç»Ÿ
              â†“
            æ”¯ä»˜ç³»ç»Ÿ
```

**ä¸ºä»€ä¹ˆéœ€è¦RabbitMQ**ï¼š
- **è§£è€¦åˆ**ï¼šç³»ç»Ÿä¹‹é—´ä¸ç›´æ¥å¯¹è¯ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¸­è½¬
- **å¼‚æ­¥å¤„ç†**ï¼šå‘é€æ¶ˆæ¯åç«‹å³è¿”å›ï¼Œä¸ç”¨ç­‰å¾…å¤„ç†å®Œæˆ
- **å‰Šå³°å¡«è°·**ï¼šé«˜å³°æœŸå…ˆå­˜æ¶ˆæ¯ï¼Œæ…¢æ…¢å¤„ç†

### 1.2 RabbitMQåŸºæœ¬æ¶æ„


```
RabbitMQæœåŠ¡æ¶æ„ç®€å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RabbitMQèŠ‚ç‚¹                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Exchange  â”‚    â”‚    Queue    â”‚    â”‚
â”‚  â”‚  (äº¤æ¢æœº)   â”‚â”€â”€â”€â”€â–¶â”‚   (é˜Ÿåˆ—)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â–²                    â”‚         â”‚
â”‚         â”‚                    â–¼         â”‚
â”‚    ç”Ÿäº§è€…å‘é€            æ¶ˆè´¹è€…æ¥æ”¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç«¯å£åˆ†å·¥ï¼š
â€¢ 5672  ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£ï¼ˆAMQPåè®®ï¼‰
â€¢ 15672 ï¼šWebç®¡ç†ç•Œé¢ç«¯å£
â€¢ 25672 ï¼šé›†ç¾¤é€šä¿¡ç«¯å£
```

**æ ¸å¿ƒç»„ä»¶è¯´æ˜**ï¼š
- **Producerï¼ˆç”Ÿäº§è€…ï¼‰**ï¼šå‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº
- **Exchangeï¼ˆäº¤æ¢æœºï¼‰**ï¼šæ¶ˆæ¯è·¯ç”±å™¨ï¼Œå†³å®šæ¶ˆæ¯å‘å¾€å“ªä¸ªé˜Ÿåˆ—
- **Queueï¼ˆé˜Ÿåˆ—ï¼‰**ï¼šå­˜å‚¨æ¶ˆæ¯çš„å®¹å™¨
- **Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰**ï¼šæ¥æ”¶å¤„ç†æ¶ˆæ¯çš„åº”ç”¨ç¨‹åº

---

## 2. ğŸš€ å¯åŠ¨ä¸è¿æ¥é—®é¢˜è¯¦è§£


### 2.1 æœåŠ¡å¯åŠ¨å¤±è´¥çš„å¸¸è§åŸå› 


**é—®é¢˜ç°è±¡**ï¼š
```bash
# å¯åŠ¨å‘½ä»¤æ— å“åº”æˆ–æŠ¥é”™
sudo systemctl start rabbitmq-server
# æˆ–è€…
rabbitmq-server start
```

#### ğŸ”§ åŸå› ä¸€ï¼šç«¯å£è¢«å ç”¨


**è¯Šæ–­æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
netstat -tulpn | grep :5672
netstat -tulpn | grep :15672
netstat -tulpn | grep :25672

# æˆ–è€…ä½¿ç”¨sså‘½ä»¤
ss -tulpn | grep :5672
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹æ¡ˆ1ï¼šæ€æ‰å ç”¨è¿›ç¨‹
sudo lsof -i :5672
sudo kill -9 <è¿›ç¨‹ID>

# æ–¹æ¡ˆ2ï¼šä¿®æ”¹RabbitMQç«¯å£é…ç½®
# ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/rabbitmq/rabbitmq.conf
listeners.tcp.default = 5673  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

#### ğŸ”§ åŸå› äºŒï¼šErlangç‰ˆæœ¬ä¸å…¼å®¹


**è¯Šæ–­æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹Erlangç‰ˆæœ¬
erl -version

# æŸ¥çœ‹RabbitMQç‰ˆæœ¬
rabbitmq-server -version
```

**ç‰ˆæœ¬å¯¹åº”å…³ç³»**ï¼š
| RabbitMQç‰ˆæœ¬ | æ”¯æŒçš„Erlangç‰ˆæœ¬ | **æ¨èæ­é…** |
|-------------|-----------------|-------------|
| 3.11.x | 25.0-26.x | `Erlang 25.3` |
| 3.10.x | 23.2-26.x | `Erlang 24.3` |
| 3.9.x | 23.2-25.x | `Erlang 24.2` |

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# Ubuntu/Debianç³»ç»Ÿ
sudo apt remove erlang-base
sudo apt install erlang=1:24.3.4.2+dfsg-1ubuntu0.1

# CentOS/RHELç³»ç»Ÿ
sudo yum remove erlang
sudo yum install erlang-24.3
```

#### ğŸ”§ åŸå› ä¸‰ï¼šå†…å­˜ä¸è¶³


**è¯Šæ–­æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹ç³»ç»Ÿå†…å­˜
free -h

# æŸ¥çœ‹RabbitMQå†…å­˜ä½¿ç”¨
rabbitmq-diagnostics memory_breakdown
```

**å†…å­˜è¦æ±‚**ï¼š
```
æœ€å°å†…å­˜è¦æ±‚ï¼š
â€¢ å¼€å‘ç¯å¢ƒï¼šè‡³å°‘ 512MB å¯ç”¨å†…å­˜
â€¢ ç”Ÿäº§ç¯å¢ƒï¼šè‡³å°‘ 2GB å¯ç”¨å†…å­˜
â€¢ æ¨èé…ç½®ï¼š4GB+ å†…å­˜

å†…å­˜åˆ†é…ç¤ºä¾‹ï¼š
æ€»å†…å­˜8GB â†’ RabbitMQå¯ç”¨3.2GBï¼ˆé»˜è®¤40%é™åˆ¶ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# è°ƒæ•´å†…å­˜é™åˆ¶ï¼ˆè°¨æ…æ“ä½œï¼‰
# ç¼–è¾‘ /etc/rabbitmq/rabbitmq.conf
vm_memory_high_watermark.absolute = 1GB

# æˆ–è€…ä½¿ç”¨ç™¾åˆ†æ¯”
vm_memory_high_watermark.relative = 0.6  # 60%å†…å­˜é™åˆ¶
```

### 2.2 è¿æ¥æ‹’ç»é—®é¢˜


**é—®é¢˜ç°è±¡**ï¼š
```
Connection refused - connect(2) for 127.0.0.1:5672
```

#### ğŸ” æ’æŸ¥æ­¥éª¤


**ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æœåŠ¡çŠ¶æ€**
```bash
# æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
sudo systemctl status rabbitmq-server

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep rabbitmq
```

**ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ç›‘å¬ç«¯å£**
```bash
# ç¡®è®¤ç«¯å£æ˜¯å¦ç›‘å¬
sudo ss -tulpn | grep rabbitmq-server
```

**ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•è¿æ¥**
```bash
# æœ¬åœ°è¿æ¥æµ‹è¯•
telnet localhost 5672

# è¿œç¨‹è¿æ¥æµ‹è¯•
telnet <æœåŠ¡å™¨IP> 5672
```

---

## 3. ğŸŒ ç«¯å£å ç”¨ä¸ç½‘ç»œé…ç½®


### 3.1 RabbitMQç«¯å£è¯¦è§£


```
RabbitMQç«¯å£ç”¨é€”è¯´æ˜ï¼š

ğŸ“¡ AMQPç«¯å£ï¼ˆ5672ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    AMQPåè®®    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯åº”ç”¨    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   RabbitMQ     â”‚
â”‚ (ç”Ÿäº§è€…/æ¶ˆè´¹è€…) â”‚     5672      â”‚     æœåŠ¡å™¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸŒ Webç®¡ç†ç«¯å£ï¼ˆ15672ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨è®¿é—®    â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  ç®¡ç†ç•Œé¢æœåŠ¡   â”‚
â”‚ 192.168.1.100   â”‚    15672      â”‚   (Web UI)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”— é›†ç¾¤é€šä¿¡ç«¯å£ï¼ˆ25672ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å†…éƒ¨é€šä¿¡     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQèŠ‚ç‚¹1  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  RabbitMQèŠ‚ç‚¹2  â”‚
â”‚   (ä¸»èŠ‚ç‚¹)      â”‚    25672      â”‚   (ä»èŠ‚ç‚¹)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç«¯å£å†²çªè§£å†³æ–¹æ¡ˆ


#### ğŸ”§ åœºæ™¯ä¸€ï¼šWebæœåŠ¡å ç”¨15672ç«¯å£


**å¸¸è§å†²çª**ï¼š
- Apache/Nginxçš„æŸä¸ªè™šæ‹Ÿä¸»æœº
- å…¶ä»–åº”ç”¨çš„ç®¡ç†ç•Œé¢
- å¼€å‘ç¯å¢ƒçš„è°ƒè¯•ç«¯å£

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ–¹æ³•1ï¼šä¿®æ”¹RabbitMQç®¡ç†ç«¯å£
# ç¼–è¾‘ /etc/rabbitmq/rabbitmq.conf
management.tcp.port = 15673

# æ–¹æ³•2ï¼šä¿®æ”¹å†²çªåº”ç”¨ç«¯å£
# å¯¹äºNginxè™šæ‹Ÿä¸»æœº
sudo nano /etc/nginx/sites-available/your-site
# å°† listen 15672; æ”¹ä¸ºå…¶ä»–ç«¯å£
```

#### ğŸ”§ åœºæ™¯äºŒï¼šåº”ç”¨ç«¯å£å†²çª5672


**è¯†åˆ«å†²çªè¿›ç¨‹**ï¼š
```bash
# è¯¦ç»†æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :5672 -P -n
# è¾“å‡ºç¤ºä¾‹ï¼š
# COMMAND   PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME
# java     1234 app    52u  IPv6   12345      0t0  TCP *:5672 (LISTEN)
```

**è§£å†³ç­–ç•¥**ï¼š
```bash
# ç­–ç•¥1ï¼šåœæ­¢å†²çªåº”ç”¨
sudo systemctl stop <å†²çªæœåŠ¡å>

# ç­–ç•¥2ï¼šä¿®æ”¹RabbitMQç«¯å£
# åœ¨ rabbitmq.conf ä¸­æ·»åŠ ï¼š
listeners.tcp.default = 5673
```

### 3.3 é˜²ç«å¢™é…ç½®


**Ubuntu/Debiané˜²ç«å¢™è®¾ç½®**ï¼š
```bash
# å¼€æ”¾RabbitMQç«¯å£
sudo ufw allow 5672/tcp comment 'RabbitMQ AMQP'
sudo ufw allow 15672/tcp comment 'RabbitMQ Management'

# ä»…å…è®¸ç‰¹å®šIPè®¿é—®ç®¡ç†ç•Œé¢ï¼ˆæ¨èï¼‰
sudo ufw allow from 192.168.1.0/24 to any port 15672
```

**CentOS/RHELé˜²ç«å¢™è®¾ç½®**ï¼š
```bash
# æ°¸ä¹…å¼€æ”¾ç«¯å£
sudo firewall-cmd --permanent --add-port=5672/tcp
sudo firewall-cmd --permanent --add-port=15672/tcp
sudo firewall-cmd --reload

# éªŒè¯è®¾ç½®
sudo firewall-cmd --list-ports
```

---

## 4. âš™ï¸ ç¯å¢ƒå…¼å®¹æ€§é—®é¢˜


### 4.1 Erlangç¯å¢ƒé—®é¢˜


#### ğŸ¯ ç‰ˆæœ¬åŒ¹é…é‡è¦æ€§


> âš ï¸ **å…³é”®ç†è§£**ï¼šRabbitMQæ˜¯ç”¨Erlangè¯­è¨€ç¼–å†™çš„ï¼Œå°±åƒJavaç¨‹åºéœ€è¦JVMä¸€æ ·ï¼ŒRabbitMQéœ€è¦Erlangè™šæ‹Ÿæœºè¿è¡Œ

**å¸¸è§ç‰ˆæœ¬é—®é¢˜**ï¼š
```
é—®é¢˜ç°è±¡ï¼š
{"init terminating in do_boot",{rabbit,failure_during_boot,{error,{rabbit,failure_during_boot,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit_app,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot,{error,{rabbit,failure_during_boot,{error,{cannot_start_application,rabbit
```

**è¯Šæ–­å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥Erlangå®‰è£…
which erl
erl -eval 'erlang:display(erlang:system_info(otp_release)), halt().' -noshell

# æ£€æŸ¥RabbitMQå¯¹Erlangçš„ä¾èµ–
rabbitmq-diagnostics erlang_version
```

#### ğŸ”§ è§£å†³æ­¥éª¤


**æ­¥éª¤1ï¼šå¸è½½ä¸å…¼å®¹ç‰ˆæœ¬**
```bash
# Debian/Ubuntuç³»ç»Ÿ
sudo apt remove --purge rabbitmq-server erlang*
sudo apt autoremove

# CentOS/RHELç³»ç»Ÿ  
sudo yum remove rabbitmq-server erlang*
```

**æ­¥éª¤2ï¼šå®‰è£…å…¼å®¹ç‰ˆæœ¬**
```bash
# æ¨èï¼šä½¿ç”¨å®˜æ–¹ä»“åº“å®‰è£…
# æ·»åŠ RabbitMQå®˜æ–¹ä»“åº“
curl -fsSL https://github.com/rabbitmq/signing-keys/releases/download/2.0/rabbitmq-release-signing-key.asc | sudo apt-key add -

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
sudo apt install rabbitmq-server=3.11.10-1 erlang-base=1:25.3.2+dfsg-1
```

### 4.2 æ“ä½œç³»ç»Ÿå…¼å®¹æ€§


**æ”¯æŒçš„æ“ä½œç³»ç»Ÿ**ï¼š
| æ“ä½œç³»ç»Ÿ | **æ”¯æŒç‰ˆæœ¬** | **æ¨èç‰ˆæœ¬** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|-------------|
| Ubuntu | 18.04+ | `20.04 LTS` | `å®˜æ–¹é‡ç‚¹æ”¯æŒ` |
| CentOS | 7.x, 8.x | `CentOS 8` | `æ³¨æ„EOLæ—¶é—´` |
| RHEL | 7.x, 8.x, 9.x | `RHEL 8.x` | `ä¼ä¸šçº§æ¨è` |
| Debian | 10+, 11+ | `Debian 11` | `ç¨³å®šæ€§å¥½` |

**ä¸åŒç³»ç»Ÿçš„ç‰¹æ®Šé—®é¢˜**ï¼š
```bash
# CentOS 7 ç‰¹æ®Šå¤„ç†ï¼ˆErlangç‰ˆæœ¬è¾ƒè€ï¼‰
sudo yum install epel-release
sudo yum install https://packages.erlang-solutions.com/erlang-solutions-2.0-1.noarch.rpm

# Ubuntuç‰¹æ®Šå¤„ç†ï¼ˆæŸäº›ç‰ˆæœ¬ä¾èµ–é—®é¢˜ï¼‰
sudo apt install --fix-broken
sudo apt update && sudo apt upgrade
```

---

## 5. ğŸ” æƒé™ä¸èµ„æºé…ç½®


### 5.1 æ–‡ä»¶æƒé™é—®é¢˜


#### ğŸ“ RabbitMQå…³é”®ç›®å½•


**ç›®å½•ç»“æ„è¯´æ˜**ï¼š
```
RabbitMQæ–‡ä»¶ç³»ç»Ÿå¸ƒå±€ï¼š
/var/lib/rabbitmq/          â† æ•°æ®ç›®å½•
â”œâ”€â”€ mnesia/                 â† æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ rabbit@hostname/    â† èŠ‚ç‚¹æ•°æ®
â”‚   â””â”€â”€ cluster_nodes.config
â”œâ”€â”€ plugins/                â† æ’ä»¶ç›®å½•  
â””â”€â”€ logs/                   â† æ—¥å¿—ç›®å½•
    â”œâ”€â”€ rabbit@hostname.log
    â””â”€â”€ rabbit@hostname-sasl.log

/etc/rabbitmq/              â† é…ç½®ç›®å½•
â”œâ”€â”€ rabbitmq.conf          â† ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ enabled_plugins        â† å¯ç”¨æ’ä»¶åˆ—è¡¨
â””â”€â”€ rabbitmq-env.conf      â† ç¯å¢ƒå˜é‡
```

#### ğŸ”§ æƒé™ä¿®å¤


**è¯Šæ–­æƒé™é—®é¢˜**ï¼š
```bash
# æ£€æŸ¥å…³é”®ç›®å½•æƒé™
ls -la /var/lib/rabbitmq/
ls -la /var/log/rabbitmq/
ls -la /etc/rabbitmq/

# æŸ¥çœ‹RabbitMQç”¨æˆ·
id rabbitmq
```

**ä¿®å¤æƒé™**ï¼š
```bash
# è®¾ç½®æ­£ç¡®çš„ç›®å½•æ‰€æœ‰è€…
sudo chown -R rabbitmq:rabbitmq /var/lib/rabbitmq
sudo chown -R rabbitmq:rabbitmq /var/log/rabbitmq  
sudo chown -R rabbitmq:rabbitmq /etc/rabbitmq

# è®¾ç½®æ­£ç¡®çš„æƒé™
sudo chmod 755 /var/lib/rabbitmq
sudo chmod 644 /etc/rabbitmq/rabbitmq.conf
```

### 5.2 ç³»ç»Ÿèµ„æºé™åˆ¶


#### ğŸšï¸ ulimité…ç½®


> ğŸ’¡ **æ¦‚å¿µè§£é‡Š**ï¼šulimitæ˜¯Linuxç³»ç»Ÿé™åˆ¶è¿›ç¨‹èµ„æºä½¿ç”¨çš„æœºåˆ¶ï¼ŒRabbitMQä½œä¸ºæ¶ˆæ¯æœåŠ¡å™¨éœ€è¦è¶³å¤Ÿçš„æ–‡ä»¶æè¿°ç¬¦å’Œè¿›ç¨‹æ•°

**æŸ¥çœ‹å½“å‰é™åˆ¶**ï¼š
```bash
# æŸ¥çœ‹RabbitMQè¿›ç¨‹çš„èµ„æºé™åˆ¶
sudo -u rabbitmq bash -c 'ulimit -a'

# é‡ç‚¹å…³æ³¨è¿™å‡ é¡¹ï¼š
# -n: file descriptors          (æ¨è65536+)
# -u: max user processes        (æ¨è32768+)  
# -c: core file size           (å¯è®¾ä¸ºunlimited)
```

**é…ç½®ç³»ç»Ÿé™åˆ¶**ï¼š
```bash
# ç¼–è¾‘ /etc/security/limits.conf
sudo nano /etc/security/limits.conf

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
rabbitmq soft nofile 65536
rabbitmq hard nofile 65536
rabbitmq soft nproc 32768  
rabbitmq hard nproc 32768
```

**systemdæœåŠ¡é™åˆ¶**ï¼š
```bash
# åˆ›å»ºoverrideé…ç½®
sudo systemctl edit rabbitmq-server

# åœ¨ç¼–è¾‘å™¨ä¸­æ·»åŠ ï¼š
[Service]
LimitNOFILE=65536
LimitNPROC=32768
```

### 5.3 ç£ç›˜ç©ºé—´ç®¡ç†


**ç£ç›˜ç©ºé—´æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h /var/lib/rabbitmq

# æ£€æŸ¥RabbitMQæ•°æ®ç›®å½•å¤§å°
du -sh /var/lib/rabbitmq/mnesia

# å®æ—¶ç›‘æ§ç£ç›˜å†™å…¥
iostat -x 1
```

**ç£ç›˜é˜ˆå€¼é…ç½®**ï¼š
```bash
# åœ¨ rabbitmq.conf ä¸­è®¾ç½®
disk_free_limit.absolute = 2GB
# æˆ–ä½¿ç”¨ç™¾åˆ†æ¯”
disk_free_limit.relative = 1.0  # ä¿ç•™10%ç©ºé—´
```

---

## 6. ğŸ—„ï¸ æ•°æ®å®Œæ•´æ€§é—®é¢˜


### 6.1 æ•°æ®åº“æ–‡ä»¶æŸå


#### ğŸ” æŸåç—‡çŠ¶è¯†åˆ«


**å¸¸è§é”™è¯¯ä¿¡æ¯**ï¼š
```
{'EXIT',{rabbit,failure_during_boot,{error,{database_corrupted,{error,{bad_header,rabbit_durable_queue}}}}
```

**è¯Šæ–­æ­¥éª¤**ï¼š
```bash
# åœæ­¢RabbitMQæœåŠ¡
sudo systemctl stop rabbitmq-server

# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶å®Œæ•´æ€§
sudo -u rabbitmq rabbitmq-diagnostics check_running
sudo -u rabbitmq rabbitmq-diagnostics status

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/rabbitmq/rabbit@hostname.log
```

#### ğŸ”§ æ•°æ®æ¢å¤æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šé‡ç½®æ•°æ®åº“ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰**
```bash
# âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œä¼šä¸¢å¤±æ‰€æœ‰é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç”¨æˆ·æ•°æ®
sudo systemctl stop rabbitmq-server
sudo -u rabbitmq rabbitmq-server -detached
sudo rabbitmqctl stop_app
sudo rabbitmqctl reset  # æ¸…ç©ºæ‰€æœ‰æ•°æ®
sudo rabbitmqctl start_app
```

**æ–¹æ¡ˆäºŒï¼šé€‰æ‹©æ€§æ¢å¤**
```bash
# å¤‡ä»½å½“å‰æ•°æ®ï¼ˆå³ä½¿æŸåä¹Ÿè¦å¤‡ä»½ï¼‰
sudo cp -r /var/lib/rabbitmq/mnesia /var/lib/rabbitmq/mnesia.backup.$(date +%Y%m%d)

# å°è¯•ä¿®å¤ç‰¹å®šè¡¨
sudo -u rabbitmq erl -mnesia dir '"/var/lib/rabbitmq/mnesia/rabbit@hostname"' -s mnesia
```

### 6.2 èŠ‚ç‚¹åç§°å†²çª


#### ğŸ¯ ç†è§£èŠ‚ç‚¹åç§°


> ğŸ’¡ **æ¦‚å¿µè¯´æ˜**ï¼šRabbitMQèŠ‚ç‚¹åç§°æ ¼å¼ä¸º `rabbit@hostname`ï¼Œç”¨äºé›†ç¾¤è¯†åˆ«å’Œæ•°æ®å­˜å‚¨è·¯å¾„

**æŸ¥çœ‹å½“å‰èŠ‚ç‚¹å**ï¼š
```bash
# æŸ¥çœ‹èŠ‚ç‚¹åç§°
sudo rabbitmqctl status | grep Node
# è¾“å‡ºç±»ä¼¼ï¼š{rabbit,"RabbitMQ","3.11.10"}
#         Node: rabbit@server1
```

**èŠ‚ç‚¹åå†²çªåœºæ™¯**ï¼š
```
æƒ…å†µ1ï¼šhostnameå˜æ›´å¯¼è‡´çš„å†²çª
æ—§èŠ‚ç‚¹åï¼šrabbit@oldname
æ–°èŠ‚ç‚¹åï¼šrabbit@newname  
æ•°æ®è·¯å¾„ï¼š/var/lib/rabbitmq/mnesia/rabbit@oldname (æ‰¾ä¸åˆ°)

æƒ…å†µ2ï¼šå¤šå®ä¾‹è¿è¡Œå†²çª
å®ä¾‹1ï¼šrabbit@server1
å®ä¾‹2ï¼šrabbit@server1  (ç›¸åŒèŠ‚ç‚¹å)
```

#### ğŸ”§ è§£å†³èŠ‚ç‚¹åå†²çª


**æ–¹æ¡ˆä¸€ï¼šè®¾ç½®å›ºå®šèŠ‚ç‚¹å**
```bash
# ç¼–è¾‘ /etc/rabbitmq/rabbitmq-env.conf
NODENAME=rabbit@myserver

# æˆ–è€…åœ¨å¯åŠ¨æ—¶æŒ‡å®š
RABBITMQ_NODENAME=rabbit@myserver rabbitmq-server
```

**æ–¹æ¡ˆäºŒï¼šæ•°æ®è¿ç§»**
```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop rabbitmq-server

# é‡å‘½åæ•°æ®ç›®å½•
sudo mv /var/lib/rabbitmq/mnesia/rabbit@oldname \
        /var/lib/rabbitmq/mnesia/rabbit@newname

# å¯åŠ¨æœåŠ¡
sudo systemctl start rabbitmq-server
```

---

## 7. ğŸ”§ å®ç”¨æ’æŸ¥å·¥å…·ç®±


### 7.1 è¯Šæ–­å‘½ä»¤é›†åˆ


#### ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥


```bash
# RabbitMQè¯Šæ–­å·¥å…·åŒ…
# 1. åŸºç¡€çŠ¶æ€æ£€æŸ¥
sudo rabbitmq-diagnostics status
sudo rabbitmq-diagnostics ping  
sudo rabbitmq-diagnostics check_running

# 2. è¯¦ç»†ä¿¡æ¯æ”¶é›†
sudo rabbitmq-diagnostics environment
sudo rabbitmq-diagnostics report > /tmp/rabbitmq-report.txt

# 3. æ€§èƒ½ç›‘æ§
sudo rabbitmq-diagnostics memory_breakdown
sudo rabbitmq-diagnostics list_connections
sudo rabbitmq-diagnostics list_queues name messages consumers
```

#### ğŸ” æ—¥å¿—åˆ†ææŠ€å·§


**å…³é”®æ—¥å¿—ä½ç½®**ï¼š
```bash
# ä¸»è¦æ—¥å¿—æ–‡ä»¶
tail -f /var/log/rabbitmq/rabbit@hostname.log          # ä¸»æ—¥å¿—
tail -f /var/log/rabbitmq/rabbit@hostname-sasl.log     # ç³»ç»Ÿæ—¥å¿—

# æŒ‰çº§åˆ«è¿‡æ»¤æ—¥å¿—
grep -i error /var/log/rabbitmq/rabbit@hostname.log
grep -i warning /var/log/rabbitmq/rabbit@hostname.log
```

**å¸¸è§é”™è¯¯æ¨¡å¼**ï¼š
```bash
# è¿æ¥ç›¸å…³é”™è¯¯
grep "connection_closed" /var/log/rabbitmq/rabbit@hostname.log

# è®¤è¯å¤±è´¥
grep "authentication_failure" /var/log/rabbitmq/rabbit@hostname.log

# å†…å­˜å‘Šè­¦
grep "memory_alarm" /var/log/rabbitmq/rabbit@hostname.log
```

### 7.2 å¿«é€Ÿé—®é¢˜å®šä½


#### âš¡ ä¸€é”®æ£€æŸ¥è„šæœ¬


```bash
#!/bin/bash
# RabbitMQå¥åº·æ£€æŸ¥è„šæœ¬

echo "=== RabbitMQå¥åº·æ£€æŸ¥ ==="

# 1. æœåŠ¡çŠ¶æ€
echo "1. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š"
systemctl is-active rabbitmq-server

# 2. ç«¯å£ç›‘å¬
echo "2. æ£€æŸ¥ç«¯å£ç›‘å¬ï¼š"
ss -tulpn | grep -E "(5672|15672|25672)"

# 3. è¿›ç¨‹çŠ¶æ€
echo "3. æ£€æŸ¥è¿›ç¨‹ï¼š"
ps aux | grep "[r]abbitmq" | head -3

# 4. å†…å­˜ä½¿ç”¨
echo "4. å†…å­˜ä½¿ç”¨æƒ…å†µï¼š"
sudo rabbitmq-diagnostics memory_breakdown | head -5

# 5. ç£ç›˜ç©ºé—´
echo "5. ç£ç›˜ç©ºé—´ï¼š"
df -h /var/lib/rabbitmq

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

#### ğŸ¯ é—®é¢˜æ’æŸ¥æµç¨‹å›¾


```
RabbitMQé—®é¢˜æ’æŸ¥æµç¨‹ï¼š

å¯åŠ¨å¤±è´¥ï¼Ÿ
    â”œâ”€ YES â†’ æ£€æŸ¥ç«¯å£å ç”¨
    â”‚           â”œâ”€ æœ‰å†²çª â†’ ä¿®æ”¹ç«¯å£/åœæ­¢å†²çªè¿›ç¨‹
    â”‚           â””â”€ æ— å†²çª â†’ æ£€æŸ¥Erlangç‰ˆæœ¬
    â”‚                        â”œâ”€ ä¸å…¼å®¹ â†’ é‡è£…åŒ¹é…ç‰ˆæœ¬
    â”‚                        â””â”€ å…¼å®¹ â†’ æ£€æŸ¥æƒé™å’Œç£ç›˜
    â”‚
    â””â”€ NO â†’ è¿æ¥å¤±è´¥ï¼Ÿ
             â”œâ”€ YES â†’ æ£€æŸ¥é˜²ç«å¢™
             â”‚          â”œâ”€ è¢«é˜»æ–­ â†’ å¼€æ”¾ç«¯å£
             â”‚          â””â”€ æ­£å¸¸ â†’ æ£€æŸ¥è®¤è¯é…ç½®
             â”‚
             â””â”€ NO â†’ æ€§èƒ½é—®é¢˜ï¼Ÿ
                      â”œâ”€ å†…å­˜ä¸è¶³ â†’ è°ƒæ•´å†…å­˜é™åˆ¶
                      â”œâ”€ ç£ç›˜æ»¡ â†’ æ¸…ç†æ—¥å¿—/æ•°æ®
                      â””â”€ ç½‘ç»œå»¶è¿Ÿ â†’ ä¼˜åŒ–ç½‘ç»œé…ç½®
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ’æŸ¥æŠ€èƒ½


```
ğŸ”¸ æœåŠ¡çŠ¶æ€è¯Šæ–­ï¼šä½¿ç”¨systemctlå’Œrabbitmq-diagnostics
ğŸ”¸ ç«¯å£å†²çªå¤„ç†ï¼šnetstat/sså‘½ä»¤è¯†åˆ«å ç”¨è¿›ç¨‹  
ğŸ”¸ ç‰ˆæœ¬å…¼å®¹æ£€æŸ¥ï¼šç¡®ä¿RabbitMQä¸Erlangç‰ˆæœ¬åŒ¹é…
ğŸ”¸ æƒé™é—®é¢˜ä¿®å¤ï¼šæ­£ç¡®è®¾ç½®ç”¨æˆ·å’Œç›®å½•æƒé™
ğŸ”¸ èµ„æºé™åˆ¶è°ƒæ•´ï¼šé…ç½®ulimitå’Œsystemdé™åˆ¶
ğŸ”¸ æ—¥å¿—åˆ†æèƒ½åŠ›ï¼šå¿«é€Ÿå®šä½é”™è¯¯ä¿¡æ¯
```

### 8.2 é—®é¢˜é¢„é˜²æœ€ä½³å®è·µ


**ğŸ”¹ å®‰è£…å‰å‡†å¤‡**
```
ç¯å¢ƒæ£€æŸ¥æ¸…å•ï¼š
âœ… ç¡®è®¤æ“ä½œç³»ç»Ÿç‰ˆæœ¬æ”¯æŒ
âœ… é¢„ç•™è¶³å¤Ÿç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘5GBï¼‰
âœ… é…ç½®åˆé€‚çš„å†…å­˜é™åˆ¶  
âœ… æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
âœ… è®¾ç½®æ­£ç¡®çš„ç”¨æˆ·æƒé™
```

**ğŸ”¹ é…ç½®æ–‡ä»¶ç®¡ç†**
```
é…ç½®ç®¡ç†å»ºè®®ï¼š
â€¢ å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶
â€¢ ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®
â€¢ æ³¨é‡Šé‡è¦é…ç½®é¡¹çš„ä½œç”¨
â€¢ åˆ†ç¯å¢ƒç®¡ç†é…ç½®ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
```

**ğŸ”¹ ç›‘æ§å‘Šè­¦è®¾ç½®**
```
å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
ğŸ“Š å†…å­˜ä½¿ç”¨ç‡ â†’ è®¾ç½®80%å‘Šè­¦
ğŸ“Š ç£ç›˜ä½¿ç”¨ç‡ â†’ è®¾ç½®85%å‘Šè­¦  
ğŸ“Š è¿æ¥æ•°é‡ â†’ è®¾ç½®é˜ˆå€¼å‘Šè­¦
ğŸ“Š é˜Ÿåˆ—é•¿åº¦ â†’ è®¾ç½®ç§¯å‹å‘Šè­¦
ğŸ“Š é”™è¯¯æ—¥å¿— â†’ å®æ—¶å‘Šè­¦
```

### 8.3 å¿«é€Ÿè§£å†³é—®é¢˜çš„æ€è·¯


**ğŸ”¹ ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•**
```
ç¬¬ä¸€å±‚ï¼šåŸºç¡€ç¯å¢ƒ
â†’ æ“ä½œç³»ç»Ÿã€Erlangç‰ˆæœ¬ã€æƒé™ã€èµ„æº

ç¬¬äºŒå±‚ï¼šç½‘ç»œé€šä¿¡  
â†’ ç«¯å£ç›‘å¬ã€é˜²ç«å¢™ã€DNSè§£æ

ç¬¬ä¸‰å±‚ï¼šåº”ç”¨é…ç½®
â†’ é…ç½®æ–‡ä»¶ã€æ’ä»¶ã€ç”¨æˆ·è®¤è¯

ç¬¬å››å±‚ï¼šæ•°æ®å®Œæ•´æ€§
â†’ æ•°æ®åº“æ–‡ä»¶ã€èŠ‚ç‚¹çŠ¶æ€ã€é›†ç¾¤åŒæ­¥
```

**ğŸ”¹ åº”æ€¥å¤„ç†åŸåˆ™**
```
ç´§æ€¥æƒ…å†µä¸‹çš„å¤„ç†é¡ºåºï¼š
1. ç¡®ä¿æœåŠ¡å¯ç”¨æ€§ï¼ˆé‡å¯/åˆ‡æ¢ï¼‰
2. ä¿æŠ¤æ•°æ®å®Œæ•´æ€§ï¼ˆå¤‡ä»½/åªè¯»ï¼‰
3. å¿«é€Ÿå®šä½æ ¹å› ï¼ˆæ—¥å¿—/ç›‘æ§ï¼‰
4. ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆé™çº§/ç»•è¿‡ï¼‰
5. æ ¹æœ¬æ€§ä¿®å¤ï¼ˆé…ç½®/å‡çº§ï¼‰
```

### 8.4 å­¦ä¹ å»ºè®®


> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šä»ç®€å•ç¯å¢ƒå¼€å§‹ï¼Œé€æ­¥ç†è§£æ¯ä¸ªç»„ä»¶çš„ä½œç”¨

**å­¦ä¹ è·¯å¾„**ï¼š
```
å…¥é—¨çº§ â†’ å•æœºéƒ¨ç½² â†’ åŸºç¡€é…ç½® â†’ ç®€å•åº”ç”¨
è¿›é˜¶çº§ â†’ é›†ç¾¤éƒ¨ç½² â†’ æ€§èƒ½è°ƒä¼˜ â†’ æ•…éšœå¤„ç†  
é«˜çº§çº§ â†’ æ¶æ„è®¾è®¡ â†’ è¿ç»´è‡ªåŠ¨åŒ– â†’ å®¹ç¾å¤‡ä»½
```

**å®è·µå»ºè®®**ï¼š
- ğŸ§ª **åŠ¨æ‰‹å®éªŒ**ï¼šåœ¨è™šæ‹Ÿæœºä¸­æ¨¡æ‹Ÿå„ç§æ•…éšœåœºæ™¯
- ğŸ“š **æ–‡æ¡£é˜…è¯»**ï¼šç†Ÿæ‚‰å®˜æ–¹æ–‡æ¡£å’Œé…ç½®å‚æ•°
- ğŸ¤ **ç¤¾åŒºå‚ä¸**ï¼šå…³æ³¨RabbitMQç¤¾åŒºå’ŒæŠ€æœ¯åšå®¢
- ğŸ”§ **å·¥å…·ç†Ÿç»ƒ**ï¼šæŒæ¡å¸¸ç”¨çš„è¯Šæ–­å’Œç›‘æ§å·¥å…·

### 8.5 æ ¸å¿ƒè®°å¿†è¦ç‚¹


> ğŸ”‘ **ä¸€å¥è¯æ€»ç»“**ï¼šRabbitMQæ•…éšœ90%æ¥æºäºç¯å¢ƒé…ç½®é—®é¢˜ï¼ŒæŒæ¡ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•æ˜¯å…³é”®

**è®°å¿†å£è¯€**ï¼š
```
ç«¯å£ç‰ˆæœ¬æƒé™æŸ¥ï¼Œæ—¥å¿—ç›‘æ§ä¸èƒ½æ‹‰
ç³»ç»Ÿèµ„æºè¦å……è¶³ï¼Œé…ç½®å¤‡ä»½é˜²ä¸‡ä¸€
é—®é¢˜å®šä½æœ‰å±‚æ¬¡ï¼Œåº”æ€¥å¤„ç†è¦å†·é™
```

**æœ€é‡è¦çš„3ä¸ªè¯Šæ–­å‘½ä»¤**ï¼š
1. `sudo systemctl status rabbitmq-server` - æŸ¥çœ‹æœåŠ¡çŠ¶æ€
2. `sudo rabbitmq-diagnostics status` - æŸ¥çœ‹åº”ç”¨çŠ¶æ€  
3. `tail -f /var/log/rabbitmq/rabbit@hostname.log` - æŸ¥çœ‹å®æ—¶æ—¥å¿—

**æ ¸å¿ƒæ€ç»´**ï¼š
- ğŸ¯ **ç³»ç»Ÿæ€§æ€è€ƒ**ï¼šä»ç¯å¢ƒåˆ°åº”ç”¨ï¼Œä»åº•å±‚åˆ°ä¸Šå±‚
- ğŸ” **è¯æ®å¯¼å‘**ï¼šåŸºäºæ—¥å¿—å’Œç›‘æ§æ•°æ®åˆ¤æ–­
- âš¡ **å¿«é€Ÿæ¢å¤**ï¼šä¼˜å…ˆä¿è¯æœåŠ¡å¯ç”¨æ€§
- ğŸ“ **è®°å½•æ€»ç»“**ï¼šæ¯æ¬¡æ•…éšœéƒ½è¦å½¢æˆçŸ¥è¯†ç§¯ç´¯