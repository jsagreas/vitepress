---
title: 23ã€Shovelé“²å­å·¥å…·é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [Shovelé“²å­å·¥å…·åŸºç¡€æ¦‚å¿µ](#1-shovelé“²å­å·¥å…·åŸºç¡€æ¦‚å¿µ)
2. [æºé˜Ÿåˆ—é…ç½®é—®é¢˜æ’æŸ¥](#2-æºé˜Ÿåˆ—é…ç½®é—®é¢˜æ’æŸ¥)
3. [ç›®æ ‡é˜Ÿåˆ—é…ç½®é—®é¢˜è§£å†³](#3-ç›®æ ‡é˜Ÿåˆ—é…ç½®é—®é¢˜è§£å†³)
4. [è¿æ¥å‚æ•°é…ç½®é”™è¯¯å¤„ç†](#4-è¿æ¥å‚æ•°é…ç½®é”™è¯¯å¤„ç†)
5. [æ¶ˆæ¯è½¬æ¢è§„åˆ™é—®é¢˜](#5-æ¶ˆæ¯è½¬æ¢è§„åˆ™é—®é¢˜)
6. [ç¡®è®¤æ¨¡å¼é…ç½®ä¼˜åŒ–](#6-ç¡®è®¤æ¨¡å¼é…ç½®ä¼˜åŒ–)
7. [é‡è¿ç­–ç•¥ä¸æ•…éšœæ¢å¤](#7-é‡è¿ç­–ç•¥ä¸æ•…éšœæ¢å¤)
8. [æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜](#8-æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜)
9. [æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶](#9-æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ Shovelé“²å­å·¥å…·åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Shovelé“²å­å·¥å…·


**ğŸ”¸ é€šä¿—ç†è§£**
```
æƒ³è±¡ä¸€ä¸‹æ¬å®¶çš„åœºæ™¯ï¼š
ä½ éœ€è¦æŠŠAæˆ¿é—´çš„ä¸œè¥¿æ¬åˆ°Bæˆ¿é—´
Shovelå°±æ˜¯è¿™ä¸ª"æ¬è¿å·¥"

RabbitMQçš„Shovel = æ¶ˆæ¯æ¬è¿å·¥
ä½œç”¨ï¼šå°†æ¶ˆæ¯ä»ä¸€ä¸ªåœ°æ–¹è‡ªåŠ¨æ¬è¿åˆ°å¦ä¸€ä¸ªåœ°æ–¹
```

**ğŸ“‹ æ ¸å¿ƒå®šä¹‰**
- **Shovelæ’ä»¶**ï¼šRabbitMQå®˜æ–¹æä¾›çš„æ¶ˆæ¯ä¼ è¾“å·¥å…·
- **ä¸»è¦åŠŸèƒ½**ï¼šåœ¨ä¸åŒé˜Ÿåˆ—ã€äº¤æ¢æœºä¹‹é—´æ¬è¿æ¶ˆæ¯
- **ä½¿ç”¨åœºæ™¯**ï¼šæ•°æ®è¿ç§»ã€é›†ç¾¤åŒæ­¥ã€å¼‚åœ°å¤‡ä»½

### 1.2 Shovelå·¥ä½œåŸç†


**ğŸ”„ å·¥ä½œæµç¨‹å›¾**
```
æºç«¯ï¼ˆSourceï¼‰          Shovelæ’ä»¶          ç›®æ ‡ç«¯ï¼ˆDestinationï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é˜Ÿåˆ—A     â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚  æ¶ˆæ¯æ¬è¿   â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚   é˜Ÿåˆ—B     â”‚
â”‚   æ¶ˆæ¯1     â”‚        â”‚     å¤„ç†    â”‚        â”‚   æ¶ˆæ¯1     â”‚
â”‚   æ¶ˆæ¯2     â”‚        â”‚     è½¬æ¢    â”‚        â”‚   æ¶ˆæ¯2     â”‚
â”‚   æ¶ˆæ¯3     â”‚        â”‚     æŠ•é€’    â”‚        â”‚   æ¶ˆæ¯3     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å·¥ä½œæœºåˆ¶**
1. **ç›‘å¬æºé˜Ÿåˆ—**ï¼šæŒç»­ç›‘å¬æŒ‡å®šçš„æºé˜Ÿåˆ—
2. **è·å–æ¶ˆæ¯**ï¼šä»æºé˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯
3. **å¤„ç†è½¬æ¢**ï¼šæ ¹æ®è§„åˆ™è½¬æ¢æ¶ˆæ¯æ ¼å¼
4. **æŠ•é€’æ¶ˆæ¯**ï¼šå°†æ¶ˆæ¯å‘é€åˆ°ç›®æ ‡é˜Ÿåˆ—
5. **ç¡®è®¤æœºåˆ¶**ï¼šç¡®ä¿æ¶ˆæ¯ä¼ è¾“çš„å¯é æ€§

### 1.3 Shovelçš„ä¼˜åŠ¿ç‰¹ç‚¹


| ç‰¹ç‚¹ | **è¯´æ˜** | **é€‚ç”¨åœºæ™¯** |
|------|---------|-------------|
| ğŸ”„ **è‡ªåŠ¨åŒ–** | `æ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨æ¬è¿æ¶ˆæ¯` | `æ•°æ®åŒæ­¥ã€å¤‡ä»½` |
| ğŸŒ **è·¨ç½‘ç»œ** | `æ”¯æŒä¸åŒç½‘ç»œç¯å¢ƒä¹‹é—´çš„ä¼ è¾“` | `å¼‚åœ°å¤‡ä»½ã€å¤šæœºæˆ¿` |
| âš¡ **é«˜æ•ˆç‡** | `ä¸“é—¨ä¼˜åŒ–çš„ä¼ è¾“æ€§èƒ½` | `å¤§æ‰¹é‡æ•°æ®è¿ç§»` |
| ğŸ›¡ï¸ **å¯é æ€§** | `æ”¯æŒç¡®è®¤æœºåˆ¶ï¼Œä¿è¯ä¸ä¸¢å¤±` | `é‡è¦æ•°æ®ä¼ è¾“` |
| ğŸ”§ **çµæ´»æ€§** | `æ”¯æŒå¤šç§é…ç½®é€‰é¡¹` | `å¤æ‚ä¸šåŠ¡åœºæ™¯` |

---

## 2. ğŸ“ æºé˜Ÿåˆ—é…ç½®é—®é¢˜æ’æŸ¥


### 2.1 å¸¸è§æºé˜Ÿåˆ—é…ç½®é”™è¯¯


**ğŸ”¸ é˜Ÿåˆ—åç§°é”™è¯¯**
```bash
# âŒ é”™è¯¯é…ç½®ç¤ºä¾‹
"source": {
    "queue": "order_queu"  # é˜Ÿåˆ—åæ‹¼å†™é”™è¯¯
}

# âœ… æ­£ç¡®é…ç½®
"source": {
    "queue": "order_queue"  # ç¡®ä¿é˜Ÿåˆ—åæ­£ç¡®
}
```

**ğŸš¨ é—®é¢˜è¡¨ç°**
- ShovelçŠ¶æ€æ˜¾ç¤º `terminated`
- æ—¥å¿—æç¤ºï¼š`NOT_FOUND - no queue 'order_queu'`
- æ¶ˆæ¯æ— æ³•ä»æºç«¯è·å–

**ğŸ”§ æ’æŸ¥æ­¥éª¤**
1. **éªŒè¯é˜Ÿåˆ—å­˜åœ¨æ€§**
```bash
# æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨
rabbitmqctl list_queues name messages
```

2. **æ£€æŸ¥é˜Ÿåˆ—æƒé™**
```bash
# æ£€æŸ¥ç”¨æˆ·æƒé™
rabbitmqctl list_user_permissions shovel_user
```

### 2.2 æºé˜Ÿåˆ—æƒé™é—®é¢˜


**ğŸ”‘ æƒé™é…ç½®è¦æ±‚**
```json
{
    "name": "my-shovel",
    "source": {
        "queue": "source_queue",
        "connection": {
            "username": "shovel_user",
            "password": "shovel_pass"
        }
    }
}
```

**ğŸ’¡ æƒé™æ£€æŸ¥æ¸…å•**
- âœ… ç”¨æˆ·æ˜¯å¦å­˜åœ¨
- âœ… ç”¨æˆ·æ˜¯å¦æœ‰è¯»å–æƒé™
- âœ… é˜Ÿåˆ—æ˜¯å¦åœ¨æ­£ç¡®çš„vhostä¸­
- âœ… ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 2.3 æºé˜Ÿåˆ—å‚æ•°é…ç½®


**ğŸ“Š é‡è¦é…ç½®å‚æ•°**

| å‚æ•° | **ä½œç”¨** | **æ¨èå€¼** | **æ³¨æ„äº‹é¡¹** |
|------|---------|-----------|-------------|
| `prefetch-count` | `é¢„å–æ¶ˆæ¯æ•°é‡` | `100-1000` | `æ ¹æ®æ¶ˆæ¯å¤§å°è°ƒæ•´` |
| `auto-delete` | `è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—` | `false` | `é¿å…è¯¯åˆ é˜Ÿåˆ—` |
| `exclusive` | `ç‹¬å é˜Ÿåˆ—` | `false` | `å…è®¸å¤šä¸ªè¿æ¥` |
| `durable` | `æŒä¹…åŒ–é˜Ÿåˆ—` | `true` | `é‡å¯åä¿ç•™é˜Ÿåˆ—` |

```json
{
    "source": {
        "queue": "my_queue",
        "prefetch-count": 500,
        "auto-delete": false,
        "exclusive": false,
        "durable": true
    }
}
```

---

## 3. ğŸ¯ ç›®æ ‡é˜Ÿåˆ—é…ç½®é—®é¢˜è§£å†³


### 3.1 ç›®æ ‡é˜Ÿåˆ—åˆ›å»ºé—®é¢˜


**ğŸ”¸ è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—é…ç½®**
```json
{
    "destination": {
        "queue": "target_queue",
        "add-forward-headers": true,
        "publish-properties": {
            "delivery_mode": 2
        },
        "add-timestamp-header": true
    }
}
```

**ğŸš¨ å¸¸è§åˆ›å»ºå¤±è´¥åŸå› **
1. **æƒé™ä¸è¶³**ï¼šç”¨æˆ·æ²¡æœ‰åˆ›å»ºé˜Ÿåˆ—çš„æƒé™
2. **åç§°å†²çª**ï¼šé˜Ÿåˆ—åå·²å­˜åœ¨ä½†å±æ€§ä¸åŒ¹é…
3. **èµ„æºé™åˆ¶**ï¼šè¾¾åˆ°é˜Ÿåˆ—æ•°é‡é™åˆ¶
4. **ç½‘ç»œé—®é¢˜**ï¼šæ— æ³•è¿æ¥åˆ°ç›®æ ‡æœåŠ¡å™¨

### 3.2 ç›®æ ‡é˜Ÿåˆ—å±æ€§åŒ¹é…


**âš ï¸ å±æ€§ä¸åŒ¹é…é—®é¢˜**
```
é”™è¯¯ä¿¡æ¯ï¼šPRECONDITION_FAILED - 
inequivalent arg 'durable' for queue 'target_queue'
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**
```json
{
    "destination": {
        "queue": "target_queue",
        "declarations": {
            "queues": [
                {
                    "name": "target_queue",
                    "durable": true,
                    "auto-delete": false,
                    "exclusive": false
                }
            ]
        }
    }
}
```

### 3.3 ç›®æ ‡è¿æ¥é…ç½®ä¼˜åŒ–


**ğŸŒ è¿æ¥æ± é…ç½®**
```json
{
    "destination": {
        "connection": {
            "host": "target-server",
            "port": 5672,
            "username": "target_user",
            "password": "target_pass",
            "connection-timeout": 60000,
            "heartbeat": 30,
            "max-hops": 1
        }
    }
}
```

**ğŸ’¡ è¿æ¥ä¼˜åŒ–å»ºè®®**
- ğŸ”¹ **åˆç†è®¾ç½®è¶…æ—¶**ï¼šé¿å…è¿æ¥ç­‰å¾…è¿‡é•¿
- ğŸ”¹ **å¯ç”¨å¿ƒè·³æ£€æµ‹**ï¼šåŠæ—¶å‘ç°è¿æ¥æ–­å¼€
- ğŸ”¹ **é…ç½®é‡è¿ç­–ç•¥**ï¼šè‡ªåŠ¨æ¢å¤è¿æ¥
- ğŸ”¹ **ç›‘æ§è¿æ¥çŠ¶æ€**ï¼šå®æ—¶æŒæ¡è¿æ¥æƒ…å†µ

---

## 4. ğŸ”Œ è¿æ¥å‚æ•°é…ç½®é”™è¯¯å¤„ç†


### 4.1 è¿æ¥è¶…æ—¶é—®é¢˜


**ğŸ• è¶…æ—¶é…ç½®è¯¦è§£**
```json
{
    "source": {
        "connection": {
            "connection-timeout": 60000,    // è¿æ¥è¶…æ—¶ï¼š60ç§’
            "heartbeat": 30,                // å¿ƒè·³é—´éš”ï¼š30ç§’  
            "channel-max": 2047,            // æœ€å¤§é€šé“æ•°
            "frame-max": 131072             // æœ€å¤§å¸§å¤§å°ï¼š128KB
        }
    }
}
```

**ğŸš¨ è¶…æ—¶é—®é¢˜ç—‡çŠ¶**
- è¿æ¥å»ºç«‹ç¼“æ…¢æˆ–å¤±è´¥
- æ—¥å¿—æç¤ºï¼š`connection_timeout`
- ShovelçŠ¶æ€ä¸ç¨³å®š

**ğŸ”§ ä¼˜åŒ–ç­–ç•¥**
```
ç½‘ç»œç¯å¢ƒå¥½ï¼šconnection-timeout = 30000 (30ç§’)
ç½‘ç»œç¯å¢ƒå·®ï¼šconnection-timeout = 90000 (90ç§’)
å±€åŸŸç½‘ç¯å¢ƒï¼šconnection-timeout = 15000 (15ç§’)
```

### 4.2 è®¤è¯å‚æ•°é”™è¯¯


**ğŸ”‘ è®¤è¯é…ç½®ç¤ºä¾‹**
```json
{
    "source": {
        "connection": {
            "host": "source-server",
            "port": 5672,
            "vhost": "/production",
            "username": "shovel_source",
            "password": "secure_password_123"
        }
    },
    "destination": {
        "connection": {
            "host": "target-server", 
            "port": 5672,
            "vhost": "/backup",
            "username": "shovel_target",
            "password": "secure_password_456"
        }
    }
}
```

**ğŸš¨ è®¤è¯å¤±è´¥å¤„ç†**
```bash
# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
rabbitmqctl list_users

# æ£€æŸ¥ç”¨æˆ·æƒé™
rabbitmqctl list_user_permissions shovel_source

# é‡ç½®ç”¨æˆ·å¯†ç 
rabbitmqctl change_password shovel_source new_password
```

### 4.3 SSL/TLSé…ç½®é—®é¢˜


**ğŸ”’ SSLè¿æ¥é…ç½®**
```json
{
    "source": {
        "connection": {
            "host": "secure-server",
            "port": 5671,
            "ssl-options": {
                "verify": "verify_peer",
                "cacertfile": "/path/to/ca.pem",
                "certfile": "/path/to/client.pem", 
                "keyfile": "/path/to/client.key"
            }
        }
    }
}
```

**ğŸ’¡ SSLé…ç½®è¦ç‚¹**
- ğŸ”¹ **è¯ä¹¦è·¯å¾„æ­£ç¡®**ï¼šç¡®ä¿æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»
- ğŸ”¹ **è¯ä¹¦æœ‰æ•ˆæœŸ**ï¼šæ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ
- ğŸ”¹ **æƒé™è®¾ç½®**ï¼šè¯ä¹¦æ–‡ä»¶æƒé™é€‚å½“
- ğŸ”¹ **ä¸»æœºååŒ¹é…**ï¼šè¯ä¹¦CNä¸ä¸»æœºåä¸€è‡´

---

## 5. ğŸ”„ æ¶ˆæ¯è½¬æ¢è§„åˆ™é—®é¢˜


### 5.1 æ¶ˆæ¯å¤´è½¬æ¢é…ç½®


**ğŸ“‹ è½¬æ¢è§„åˆ™ç¤ºä¾‹**
```json
{
    "name": "header-transform-shovel",
    "source": {
        "queue": "source_queue"
    },
    "destination": {
        "queue": "dest_queue",
        "add-forward-headers": true,
        "add-timestamp-header": true,
        "publish-properties": {
            "headers": {
                "x-shovel-source": "production",
                "x-transfer-time": "${timestamp}"
            }
        }
    }
}
```

**ğŸ”¸ å¸¸ç”¨è½¬æ¢é€‰é¡¹**

| é€‰é¡¹ | **ä½œç”¨** | **ç¤ºä¾‹å€¼** |
|------|---------|-----------|
| `add-forward-headers` | `æ·»åŠ è½¬å‘å¤´ä¿¡æ¯` | `true/false` |
| `add-timestamp-header` | `æ·»åŠ æ—¶é—´æˆ³å¤´` | `true/false` |
| `publish-properties` | `è‡ªå®šä¹‰å‘å¸ƒå±æ€§` | `{headers: {...}}` |

### 5.2 æ¶ˆæ¯æ ¼å¼è½¬æ¢é—®é¢˜


**âš ï¸ æ ¼å¼ä¸å…¼å®¹å¤„ç†**
```json
{
    "destination": {
        "publish-properties": {
            "content_type": "application/json",
            "content_encoding": "utf-8",
            "delivery_mode": 2,
            "priority": 0
        }
    }
}
```

**ğŸ”§ å¸¸è§è½¬æ¢åœºæ™¯**
- **æ–‡æœ¬ç¼–ç è½¬æ¢**ï¼šUTF-8 â†” GBK
- **æ¶ˆæ¯æ ¼å¼è½¬æ¢**ï¼šJSON â†” XML
- **å‹ç¼©å¤„ç†**ï¼šå¯ç”¨/ç¦ç”¨æ¶ˆæ¯å‹ç¼©
- **ä¼˜å…ˆçº§è®¾ç½®**ï¼šè°ƒæ•´æ¶ˆæ¯ä¼˜å…ˆçº§

### 5.3 æ¶ˆæ¯è¿‡æ»¤è§„åˆ™


**ğŸ¯ åŸºäºå†…å®¹è¿‡æ»¤**
```json
{
    "source": {
        "queue": "all_events",
        "consumer-tag": "filtered-consumer"
    },
    "destination": {
        "queue": "important_events"  
    },
    "publish-fields": [
        "routing-key",
        "timestamp"
    ]
}
```

> ğŸ’¡ **æ³¨æ„**ï¼šShovelæœ¬èº«ä¸æ”¯æŒå¤æ‚çš„æ¶ˆæ¯è¿‡æ»¤ï¼Œå¤æ‚è¿‡æ»¤é€»è¾‘å»ºè®®åœ¨åº”ç”¨å±‚å®ç°

---

## 6. âœ… ç¡®è®¤æ¨¡å¼é…ç½®ä¼˜åŒ–


### 6.1 ç¡®è®¤æ¨¡å¼ç±»å‹å¯¹æ¯”


| æ¨¡å¼ | **å¯é æ€§** | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|------|-----------|---------|-------------|
| ğŸ”„ **on-confirm** | `æœ€é«˜` | `è¾ƒä½` | `é‡è¦æ•°æ®ä¼ è¾“` |
| âš¡ **on-publish** | `ä¸­ç­‰` | `è¾ƒé«˜` | `ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯` |
| ğŸš€ **no-ack** | `æœ€ä½` | `æœ€é«˜` | `æ—¥å¿—ã€ç›‘æ§æ•°æ®` |

### 6.2 é«˜å¯é æ€§ç¡®è®¤é…ç½®


**ğŸ›¡ï¸ æœ€å®‰å…¨çš„é…ç½®**
```json
{
    "name": "reliable-shovel",
    "source": {
        "queue": "critical_data",
        "prefetch-count": 10
    },
    "destination": {
        "queue": "backup_critical",
        "publish-properties": {
            "delivery_mode": 2
        }
    },
    "ack-mode": "on-confirm"
}
```

**ğŸ“Š ç¡®è®¤æ¨¡å¼è¯¦è§£**
- **on-confirm**ï¼šç­‰å¾…ç›®æ ‡ç¡®è®¤åæ‰ä»æºé˜Ÿåˆ—åˆ é™¤
- **on-publish**ï¼šå‘å¸ƒåˆ°ç›®æ ‡åç«‹å³ä»æºé˜Ÿåˆ—åˆ é™¤  
- **no-ack**ï¼šè·å–æ¶ˆæ¯åç«‹å³ä»æºé˜Ÿåˆ—åˆ é™¤

### 6.3 æ€§èƒ½ä¸å¯é æ€§å¹³è¡¡


**âš–ï¸ å¹³è¡¡é…ç½®ç­–ç•¥**
```json
{
    "ack-mode": "on-confirm",
    "prefetch-count": 100,
    "destination": {
        "publish-properties": {
            "delivery_mode": 2
        }
    },
    "reconnect-delay": 5
}
```

**ğŸ’¡ ä¼˜åŒ–å»ºè®®**
- ğŸ”¹ **é‡è¦æ•°æ®**ï¼šä½¿ç”¨ `on-confirm` + å°æ‰¹é‡
- ğŸ”¹ **ä¸€èˆ¬æ•°æ®**ï¼šä½¿ç”¨ `on-publish` + ä¸­æ‰¹é‡  
- ğŸ”¹ **æ—¥å¿—æ•°æ®**ï¼šä½¿ç”¨ `no-ack` + å¤§æ‰¹é‡

---

## 7. ğŸ”„ é‡è¿ç­–ç•¥ä¸æ•…éšœæ¢å¤


### 7.1 é‡è¿ç­–ç•¥é…ç½®


**ğŸ”§ åŸºç¡€é‡è¿é…ç½®**
```json
{
    "name": "resilient-shovel",
    "reconnect-delay": 5,
    "source": {
        "connection": {
            "heartbeat": 30,
            "connection-timeout": 60000
        }
    },
    "destination": {
        "connection": {
            "heartbeat": 30,
            "connection-timeout": 60000
        }
    }
}
```

**ğŸ“ˆ é‡è¿å»¶è¿Ÿç­–ç•¥**
```
ç¬¬1æ¬¡é‡è¿ï¼š5ç§’å
ç¬¬2æ¬¡é‡è¿ï¼š10ç§’å  
ç¬¬3æ¬¡é‡è¿ï¼š20ç§’å
ç¬¬4æ¬¡é‡è¿ï¼š40ç§’å
æœ€å¤§å»¶è¿Ÿï¼š60ç§’
```

### 7.2 æ•…éšœæ£€æµ‹æœºåˆ¶


**ğŸ” å¥åº·æ£€æŸ¥é…ç½®**
```json
{
    "source": {
        "connection": {
            "heartbeat": 30,           // 30ç§’å¿ƒè·³
            "blocked-connection-timeout": 30000  // é˜»å¡è¶…æ—¶
        }
    }
}
```

**ğŸš¨ æ•…éšœæ£€æµ‹æŒ‡æ ‡**
- **å¿ƒè·³è¶…æ—¶**ï¼šè¿æ¥æ˜¯å¦æ´»è·ƒ
- **é˜»å¡æ£€æµ‹**ï¼šè¿æ¥æ˜¯å¦è¢«é˜»å¡
- **æ¶ˆæ¯ç§¯å‹**ï¼šé˜Ÿåˆ—æ¶ˆæ¯æ˜¯å¦å¢é•¿è¿‡å¿«
- **é”™è¯¯è®¡æ•°**ï¼šä¼ è¾“é”™è¯¯é¢‘ç‡

### 7.3 è‡ªåŠ¨æ¢å¤æœºåˆ¶


**âš¡ æ¢å¤æµç¨‹å›¾**
```
è¿æ¥æ–­å¼€ â†’ ç­‰å¾…é‡è¿å»¶è¿Ÿ â†’ å°è¯•é‡æ–°è¿æ¥ â†’ æ¢å¤ä¼ è¾“
    â†“              â†“              â†“           â†“
è®°å½•çŠ¶æ€      æŒ‡æ•°é€€é¿ç®—æ³•      éªŒè¯è¿æ¥      ç»§ç»­å·¥ä½œ
```

**ğŸ”§ æ¢å¤é…ç½®ä¼˜åŒ–**
```json
{
    "reconnect-delay": 5,
    "source": {
        "delete-after": "never"
    },
    "destination": {
        "add-forward-headers": true
    }
}
```

---

## 8. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜


### 8.1 å…³é”®æ€§èƒ½æŒ‡æ ‡


**ğŸ“ˆ ç›‘æ§æŒ‡æ ‡æ¸…å•**

| æŒ‡æ ‡ | **å«ä¹‰** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸å¤„ç†** |
|------|---------|-------------|-------------|
| `Messages/sec` | `æ¯ç§’ä¼ è¾“æ¶ˆæ¯æ•°` | `æ ¹æ®ä¸šåŠ¡` | `è°ƒæ•´prefetch-count` |
| `Connection status` | `è¿æ¥çŠ¶æ€` | `running` | `æ£€æŸ¥ç½‘ç»œå’Œé…ç½®` |
| `Queue length` | `é˜Ÿåˆ—é•¿åº¦` | `< 1000` | `å¢åŠ å¹¶å‘æˆ–ä¼˜åŒ–` |
| `Error rate` | `é”™è¯¯ç‡` | `< 1%` | `æ£€æŸ¥é…ç½®å’Œç½‘ç»œ` |

### 8.2 æ€§èƒ½è°ƒä¼˜å‚æ•°


**âš¡ é«˜æ€§èƒ½é…ç½®**
```json
{
    "source": {
        "prefetch-count": 1000,
        "connection": {
            "frame-max": 131072,
            "channel-max": 2047
        }
    },
    "destination": {
        "publish-properties": {
            "delivery_mode": 1  // éæŒä¹…åŒ–ï¼Œæå‡æ€§èƒ½
        }
    }
}
```

**ğŸ”§ è°ƒä¼˜ç­–ç•¥**
- **ç½‘ç»œå¸¦å®½å……è¶³**ï¼šå¢å¤§ `prefetch-count` å’Œ `frame-max`
- **CPUèµ„æºå……è¶³**ï¼šå¯ç”¨å¤šä¸ªShovelå®ä¾‹å¹¶è¡Œ
- **å†…å­˜å—é™**ï¼šå‡å°é¢„å–æ•°é‡ï¼Œå¯ç”¨æµæ§
- **ç£ç›˜IOå—é™**ï¼šä½¿ç”¨éæŒä¹…åŒ–æ¨¡å¼

### 8.3 ç›‘æ§å‘½ä»¤ä¸å·¥å…·


**ğŸ“Š ç›‘æ§å‘½ä»¤**
```bash
# æŸ¥çœ‹ShovelçŠ¶æ€
rabbitmqctl eval 'rabbit_shovel_status:status().'

# æŸ¥çœ‹Shovelæ€§èƒ½ç»Ÿè®¡
rabbitmq-plugins enable rabbitmq_shovel_management

# é€šè¿‡APIè·å–çŠ¶æ€
curl -u admin:password http://localhost:15672/api/shovels
```

**ğŸ” æ€§èƒ½åˆ†æè„šæœ¬**
```bash
#!/bin/bash
# Shovelæ€§èƒ½ç›‘æ§è„šæœ¬
while true; do
    echo "=== $(date) ==="
    rabbitmqctl eval 'rabbit_shovel_status:status().' | grep -E "(running|terminated)"
    sleep 60
done
```

---

## 9. ğŸ›¡ï¸ æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶


### 9.1 ä¸€è‡´æ€§çº§åˆ«é€‰æ‹©


**ğŸ¯ ä¸€è‡´æ€§ç­‰çº§å¯¹æ¯”**

| çº§åˆ« | **ä¿è¯** | **æ€§èƒ½å½±å“** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|-------------|-------------|
| ğŸ”’ **å¼ºä¸€è‡´æ€§** | `on-confirm + æŒä¹…åŒ–` | `è¾ƒå¤§` | `é‡‘èäº¤æ˜“æ•°æ®` |
| âš–ï¸ **æœ€ç»ˆä¸€è‡´æ€§** | `on-publish + æŒä¹…åŒ–` | `ä¸­ç­‰` | `ä¸šåŠ¡æ•°æ®åŒæ­¥` |
| ğŸš€ **æ€§èƒ½ä¼˜å…ˆ** | `no-ack + éæŒä¹…åŒ–` | `æœ€å°` | `æ—¥å¿—ç›‘æ§æ•°æ®` |

### 9.2 æ•°æ®å®Œæ•´æ€§æ£€æŸ¥


**âœ… å®Œæ•´æ€§éªŒè¯é…ç½®**
```json
{
    "source": {
        "queue": "source_data",
        "prefetch-count": 100
    },
    "destination": {
        "queue": "target_data",
        "add-forward-headers": true,
        "add-timestamp-header": true,
        "publish-properties": {
            "headers": {
                "x-shovel-id": "${shovel_name}",
                "x-source-queue": "${source_queue}"
            }
        }
    },
    "ack-mode": "on-confirm"
}
```

**ğŸ” æ•°æ®æ ¡éªŒç­–ç•¥**
- **æ¶ˆæ¯è®¡æ•°**ï¼šå¯¹æ¯”æºé˜Ÿåˆ—å’Œç›®æ ‡é˜Ÿåˆ—æ¶ˆæ¯æ•°
- **æ ¡éªŒå’ŒéªŒè¯**ï¼šåœ¨æ¶ˆæ¯å¤´æ·»åŠ æ ¡éªŒä¿¡æ¯  
- **æ—¶é—´æˆ³æ£€æŸ¥**ï¼šéªŒè¯æ¶ˆæ¯ä¼ è¾“æ—¶æ•ˆæ€§
- **é‡å¤æ£€æµ‹**ï¼šé¿å…æ¶ˆæ¯é‡å¤ä¼ è¾“

### 9.3 æ•…éšœæ¢å¤ä¸€è‡´æ€§


**ğŸ”„ æ¢å¤ä¸€è‡´æ€§ä¿è¯**
```json
{
    "source": {
        "delete-after": "never"
    },
    "destination": {
        "declarations": {
            "queues": [
                {
                    "name": "backup_queue",
                    "durable": true,
                    "arguments": {
                        "x-message-deduplication": true
                    }
                }
            ]
        }
    }
}
```

**ğŸ’¡ ä¸€è‡´æ€§æœ€ä½³å®è·µ**
- ğŸ”¹ **å¹‚ç­‰è®¾è®¡**ï¼šç¡®ä¿é‡å¤ä¼ è¾“ä¸å½±å“ç»“æœ
- ğŸ”¹ **çŠ¶æ€è¿½è¸ª**ï¼šè®°å½•ä¼ è¾“çŠ¶æ€å’Œè¿›åº¦
- ğŸ”¹ **å®šæœŸæ ¡éªŒ**ï¼šå‘¨æœŸæ€§éªŒè¯æ•°æ®ä¸€è‡´æ€§
- ğŸ”¹ **å›æ»šæœºåˆ¶**ï¼šæ”¯æŒé”™è¯¯æ•°æ®çš„å›æ»š

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ Shovelæœ¬è´¨ï¼šRabbitMQçš„æ¶ˆæ¯æ¬è¿å·¥å…·ï¼Œå®ç°è·¨é˜Ÿåˆ—ã€è·¨é›†ç¾¤çš„æ¶ˆæ¯ä¼ è¾“
ğŸ”¸ é…ç½®æ ¸å¿ƒï¼šæºç«¯é…ç½® + ç›®æ ‡ç«¯é…ç½® + ä¼ è¾“ç­–ç•¥é…ç½®
ğŸ”¸ å¯é æ€§ä¿è¯ï¼šé€šè¿‡ç¡®è®¤æ¨¡å¼å’Œé‡è¿ç­–ç•¥ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±
ğŸ”¸ æ€§èƒ½è°ƒä¼˜ï¼šå¹³è¡¡ä¼ è¾“æ•ˆç‡ä¸èµ„æºæ¶ˆè€—
ğŸ”¸ ç›‘æ§ç»´æŠ¤ï¼šå®æ—¶ç›‘æ§çŠ¶æ€ï¼ŒåŠæ—¶å¤„ç†å¼‚å¸¸
```

### 10.2 æ•…éšœæ’æŸ¥æ€è·¯


**ğŸ” æ’æŸ¥æµç¨‹**
```
1. æ£€æŸ¥ShovelçŠ¶æ€ â†’ ç¡®è®¤æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. éªŒè¯è¿æ¥é…ç½® â†’ ç¡®ä¿ç½‘ç»œå’Œè®¤è¯æ­£å¸¸  
3. æ£€æŸ¥é˜Ÿåˆ—é…ç½® â†’ éªŒè¯æºé˜Ÿåˆ—å’Œç›®æ ‡é˜Ÿåˆ—
4. åˆ†æé”™è¯¯æ—¥å¿— â†’ å®šä½å…·ä½“é—®é¢˜åŸå› 
5. æµ‹è¯•é…ç½®ä¿®æ”¹ â†’ éªŒè¯è§£å†³æ–¹æ¡ˆæœ‰æ•ˆæ€§
```

**ğŸ¯ å¸¸è§é—®é¢˜è§£å†³**
- **è¿æ¥å¤±è´¥** â†’ æ£€æŸ¥ç½‘ç»œã€è®¤è¯ã€æƒé™
- **é…ç½®é”™è¯¯** â†’ éªŒè¯JSONæ ¼å¼ã€å‚æ•°å€¼
- **æ€§èƒ½é—®é¢˜** â†’ è°ƒæ•´prefetch-countã€è¿æ¥å‚æ•°
- **æ•°æ®ä¸¢å¤±** â†’ ä½¿ç”¨on-confirmæ¨¡å¼ã€å¯ç”¨æŒä¹…åŒ–

### 10.3 æœ€ä½³å®è·µå»ºè®®


**ğŸŒŸ é…ç½®å»ºè®®**
- âœ… **æµ‹è¯•ç¯å¢ƒéªŒè¯**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®
- âœ… **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®ShovelçŠ¶æ€ç›‘æ§å’Œå‘Šè­¦
- âœ… **æ–‡æ¡£è®°å½•**ï¼šè¯¦ç»†è®°å½•é…ç½®å‚æ•°å’Œå˜æ›´å†å²
- âœ… **å®šæœŸæ£€æŸ¥**ï¼šå‘¨æœŸæ€§æ£€æŸ¥Shovelè¿è¡ŒçŠ¶æ€

**âš ï¸ æ³¨æ„äº‹é¡¹**
- ğŸ”¹ **æƒé™æœ€å°åŒ–**ï¼šåªæˆäºˆå¿…è¦çš„æƒé™
- ğŸ”¹ **å¯†ç å®‰å…¨**ï¼šä½¿ç”¨å¼ºå¯†ç ï¼Œå®šæœŸæ›´æ¢
- ğŸ”¹ **ç½‘ç»œå®‰å…¨**ï¼šåœ¨ä¸å®‰å…¨ç½‘ç»œä¸­ä½¿ç”¨SSL/TLS
- ğŸ”¹ **èµ„æºç›‘æ§**ï¼šç›‘æ§CPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨æƒ…å†µ

### 10.4 æ•…éšœé¢„é˜²ç­–ç•¥


**ğŸ›¡ï¸ é¢„é˜²æªæ–½**
- **å¤‡ä»½é…ç½®**ï¼šä¿å­˜Shovelé…ç½®æ–‡ä»¶å¤‡ä»½
- **æµ‹è¯•æµç¨‹**ï¼šå»ºç«‹é…ç½®å˜æ›´æµ‹è¯•æµç¨‹  
- **ç›‘æ§ä½“ç³»**ï¼šå®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- **åº”æ€¥é¢„æ¡ˆ**ï¼šåˆ¶å®šæ•…éšœåº”æ€¥å¤„ç†é¢„æ¡ˆ

**æ ¸å¿ƒè®°å¿†**ï¼š
- Shovelæ˜¯æ¶ˆæ¯æ¬è¿å·¥ï¼Œé…ç½®è¦ç»†å¿ƒ
- è¿æ¥è®¤è¯å¾ˆé‡è¦ï¼Œæƒé™æ£€æŸ¥ä¸èƒ½å°‘
- ç¡®è®¤æ¨¡å¼ä¿å¯é ï¼Œæ€§èƒ½è°ƒä¼˜è¦å¹³è¡¡
- ç›‘æ§å‘Šè­¦è¦åˆ°ä½ï¼Œæ•…éšœå¤„ç†è¦åŠæ—¶