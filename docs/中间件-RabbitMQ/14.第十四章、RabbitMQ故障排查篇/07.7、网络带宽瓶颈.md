---
title: 7ã€ç½‘ç»œå¸¦å®½ç“¶é¢ˆ
---
## ğŸ“š ç›®å½•

1. [ç½‘ç»œç“¶é¢ˆåŸºç¡€æ¦‚å¿µ](#1-ç½‘ç»œç“¶é¢ˆåŸºç¡€æ¦‚å¿µ)
2. [æ¶ˆæ¯å¤§å°ä¼˜åŒ–ç­–ç•¥](#2-æ¶ˆæ¯å¤§å°ä¼˜åŒ–ç­–ç•¥)
3. [æ‰¹é‡å‘é€ä¸ä¼ è¾“ä¼˜åŒ–](#3-æ‰¹é‡å‘é€ä¸ä¼ è¾“ä¼˜åŒ–)
4. [ç½‘ç»œå‹ç¼©æŠ€æœ¯åº”ç”¨](#4-ç½‘ç»œå‹ç¼©æŠ€æœ¯åº”ç”¨)
5. [TCPä¸è¿æ¥å±‚ä¼˜åŒ–](#5-TCPä¸è¿æ¥å±‚ä¼˜åŒ–)
6. [ç½‘ç»œç›‘æ§ä¸æ•…éšœæ’æŸ¥](#6-ç½‘ç»œç›‘æ§ä¸æ•…éšœæ’æŸ¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ ç½‘ç»œç“¶é¢ˆåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œç“¶é¢ˆ


> **ğŸ’¡ ç®€å•ç†è§£**
> ç½‘ç»œç“¶é¢ˆå°±åƒé«˜é€Ÿå…¬è·¯å µè½¦ä¸€æ · - è½¦å¤šè·¯çª„å°±ä¼šå µã€‚åœ¨RabbitMQä¸­ï¼Œå°±æ˜¯æ¶ˆæ¯ä¼ è¾“é‡è¶…è¿‡äº†ç½‘ç»œæ‰¿è½½èƒ½åŠ›ã€‚

**ğŸ”¸ ç½‘ç»œç“¶é¢ˆçš„æœ¬è´¨**
```
å‘é€é€Ÿåº¦ > ç½‘ç»œä¼ è¾“èƒ½åŠ› = ç“¶é¢ˆ
```

**å¸¸è§ç“¶é¢ˆè¡¨ç°ï¼š**
- æ¶ˆæ¯å‘é€å˜æ…¢ï¼Œå»¶è¿Ÿå¢åŠ 
- é˜Ÿåˆ—ç§¯å‹æ¶ˆæ¯è¶Šæ¥è¶Šå¤š
- å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶é¢‘ç¹
- ç½‘ç»œå¸¦å®½ä½¿ç”¨ç‡æ¥è¿‘100%

### 1.2 ç“¶é¢ˆäº§ç”Ÿçš„åŸå› 


**ğŸ”¸ å¸¦å®½é™åˆ¶**
```
ç½‘ç»œç¯å¢ƒåˆ†æï¼š
å†…ç½‘ç¯å¢ƒï¼šé€šå¸¸1Gbps-10Gbpsï¼ˆ125MB/s-1.25GB/sï¼‰
å…¬ç½‘ç¯å¢ƒï¼šé€šå¸¸10Mbps-100Mbpsï¼ˆ1.25MB/s-12.5MB/sï¼‰
äº‘ç¯å¢ƒï¼šæ ¹æ®å®ä¾‹è§„æ ¼æœ‰ä¸åŒé™åˆ¶
```

**ğŸ”¸ å»¶è¿Ÿé—®é¢˜**
- **å†…ç½‘å»¶è¿Ÿ**ï¼šé€šå¸¸ < 1ms
- **åŒåŸå»¶è¿Ÿ**ï¼šé€šå¸¸ 1-10ms  
- **è·¨åœ°åŒºå»¶è¿Ÿ**ï¼šé€šå¸¸ 20-100ms
- **è·¨å›½å»¶è¿Ÿ**ï¼šé€šå¸¸ 100-500ms

### 1.3 ç½‘ç»œç“¶é¢ˆçš„è¯†åˆ«


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

| æŒ‡æ ‡ç±»å‹ | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** | **è¯´æ˜** |
|---------|-------------|-------------|---------|
| `å¸¦å®½ä½¿ç”¨ç‡` | `< 70%` | `> 80%` | `è¶…è¿‡80%å¼€å§‹å½±å“æ€§èƒ½` |
| `ç½‘ç»œå»¶è¿Ÿ` | `< 10ms` | `> 50ms` | `å»¶è¿Ÿè¿‡é«˜å½±å“ååé‡` |
| `ä¸¢åŒ…ç‡` | `< 0.01%` | `> 0.1%` | `ä¸¢åŒ…å¯¼è‡´é‡ä¼ ï¼Œæ€§èƒ½ä¸‹é™` |
| `è¿æ¥æ•°` | `ç¨³å®š` | `é¢‘ç¹å˜åŒ–` | `è¿æ¥ä¸ç¨³å®šå½±å“ä¼ è¾“` |

---

## 2. ğŸ“¦ æ¶ˆæ¯å¤§å°ä¼˜åŒ–ç­–ç•¥


### 2.1 æ¶ˆæ¯å¤§å°å¯¹æ€§èƒ½çš„å½±å“


> **ğŸ¯ æ ¸å¿ƒç†è§£**
> æƒ³è±¡å¯„å¿«é€’ï¼šå‘1000ä¸ªå°åŒ…è£¹ vs å‘1ä¸ªå¤§åŒ…è£¹ï¼Œå“ªä¸ªæ•ˆç‡æ›´é«˜ï¼Ÿç­”æ¡ˆå–å†³äºå…·ä½“æƒ…å†µã€‚

**ğŸ”¸ å¤§æ¶ˆæ¯ vs å°æ¶ˆæ¯çš„æƒè¡¡**

```
å°æ¶ˆæ¯ç‰¹ç‚¹ï¼š
âœ… å•ä¸ªå¤„ç†å¿«
âœ… å†…å­˜å ç”¨å°‘
âŒ ç½‘ç»œå¼€é”€å¤§ï¼ˆæ¯æ¡æ¶ˆæ¯éƒ½æœ‰å¤´éƒ¨ä¿¡æ¯ï¼‰
âŒ å¤§é‡å°æ¶ˆæ¯ä¼šå¢åŠ ç½‘ç»œäº¤äº’æ¬¡æ•°

å¤§æ¶ˆæ¯ç‰¹ç‚¹ï¼š
âœ… ç½‘ç»œå¼€é”€ç›¸å¯¹å°
âœ… å‡å°‘äº¤äº’æ¬¡æ•°
âŒ å•ä¸ªå¤„ç†æ…¢
âŒ å†…å­˜å ç”¨å¤§
âŒ å¯èƒ½è¶…è¿‡RabbitMQé™åˆ¶
```

### 2.2 æ¶ˆæ¯å¤§å°æœ€ä½³å®è·µ


**âš¡ æ¨èå¤§å°èŒƒå›´**
- **å°æ¶ˆæ¯**ï¼š1KB - 10KBï¼ˆé€‚åˆé¢‘ç¹ã€å®æ—¶æ¶ˆæ¯ï¼‰
- **ä¸­æ¶ˆæ¯**ï¼š10KB - 100KBï¼ˆæ¨èèŒƒå›´ï¼Œå¹³è¡¡æ€§èƒ½ï¼‰
- **å¤§æ¶ˆæ¯**ï¼š100KB - 1MBï¼ˆæ‰¹é‡æ•°æ®ï¼Œä½†è¦æ³¨æ„é™åˆ¶ï¼‰

> **âš ï¸ é‡è¦é™åˆ¶**
> RabbitMQé»˜è®¤æœ€å¤§æ¶ˆæ¯å¤§å°æ˜¯128MBï¼Œä½†å®é™…å»ºè®®ä¸è¶…è¿‡1MB

### 2.3 æ¶ˆæ¯å‹ç¼©ä¼˜åŒ–


**åŸºæœ¬æ¶ˆæ¯å‹ç¼©ç¤ºä¾‹ï¼š**
```java
// å‘é€ç«¯å‹ç¼©
public void sendCompressedMessage(String message) {
    // 1. å‹ç¼©æ¶ˆæ¯å†…å®¹
    byte[] compressed = gzipCompress(message);
    
    // 2. è®¾ç½®å‹ç¼©æ ‡è¯†
    AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()
        .headers(Map.of("compressed", "gzip"))
        .build();
    
    // 3. å‘é€å‹ç¼©æ¶ˆæ¯
    channel.basicPublish("", queueName, props, compressed);
}

// æ¥æ”¶ç«¯è§£å‹
@RabbitListener(queues = "my-queue")
public void handleMessage(@Payload byte[] body, 
                         @Header Map<String, Object> headers) {
    // 1. æ£€æŸ¥æ˜¯å¦å‹ç¼©
    if ("gzip".equals(headers.get("compressed"))) {
        // 2. è§£å‹æ¶ˆæ¯
        String message = gzipDecompress(body);
        // 3. å¤„ç†è§£å‹åçš„æ¶ˆæ¯
        processMessage(message);
    }
}
```

**ğŸ”¸ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‹ç¼©**
- æ¶ˆæ¯å†…å®¹é‡å¤åº¦é«˜ï¼ˆå¦‚JSONã€XMLï¼‰
- ç½‘ç»œå¸¦å®½æœ‰é™
- æ¶ˆæ¯å¤§å° > 10KBæ—¶æ•ˆæœæ˜æ˜¾

---

## 3. ğŸš€ æ‰¹é‡å‘é€ä¸ä¼ è¾“ä¼˜åŒ–


### 3.1 æ‰¹é‡å‘é€çš„æ¦‚å¿µ


> **ğŸ“ ç”Ÿæ´»ç±»æ¯”**
> æ‰¹é‡å‘é€å°±åƒæ‹¼è½¦å‡ºè¡Œ - ç­‰äººåæ»¡å†èµ°ï¼Œæ¯”ä¸€ä¸ªäººä¸€è¾†è½¦æ•ˆç‡é«˜å¾ˆå¤šã€‚

**ğŸ”¸ æ‰¹é‡å‘é€çš„å¥½å¤„**
```
ç½‘ç»œæ•ˆç‡æå‡ï¼š
å•æ¡å‘é€ï¼šæ¯æ¡æ¶ˆæ¯éƒ½è¦å»ºç«‹ç½‘ç»œè¿æ¥
æ‰¹é‡å‘é€ï¼šä¸€æ¬¡è¿æ¥å‘é€å¤šæ¡æ¶ˆæ¯

æ€§èƒ½å¯¹æ¯”ï¼š
å•æ¡å‘é€ï¼š1000æ¬¡ç½‘ç»œè°ƒç”¨
æ‰¹é‡å‘é€ï¼š1æ¬¡ç½‘ç»œè°ƒç”¨å‘é€1000æ¡
```

### 3.2 æ‰¹é‡å‘é€å®ç°ç­–ç•¥


**æ–¹æ¡ˆä¸€ï¼šæ—¶é—´çª—å£æ‰¹é‡**
```java
public class TimeBatchSender {
    private List<String> messageBuffer = new ArrayList<>();
    private ScheduledExecutorService scheduler = 
        Executors.newScheduledThreadPool(1);
    
    public TimeBatchSender() {
        // æ¯5ç§’å‘é€ä¸€æ¬¡æ‰¹é‡æ¶ˆæ¯
        scheduler.scheduleAtFixedRate(this::flushMessages, 
                                    5, 5, TimeUnit.SECONDS);
    }
    
    public synchronized void addMessage(String message) {
        messageBuffer.add(message);
    }
    
    private synchronized void flushMessages() {
        if (!messageBuffer.isEmpty()) {
            sendBatchMessages(new ArrayList<>(messageBuffer));
            messageBuffer.clear();
        }
    }
}
```

**æ–¹æ¡ˆäºŒï¼šæ•°é‡é˜ˆå€¼æ‰¹é‡**
```java
public class CountBatchSender {
    private static final int BATCH_SIZE = 100;
    private List<String> messageBuffer = new ArrayList<>();
    
    public synchronized void addMessage(String message) {
        messageBuffer.add(message);
        
        // è¾¾åˆ°æ‰¹é‡å¤§å°å°±å‘é€
        if (messageBuffer.size() >= BATCH_SIZE) {
            sendBatchMessages(new ArrayList<>(messageBuffer));
            messageBuffer.clear();
        }
    }
}
```

### 3.3 Publisher Confirmsæ‰¹é‡ç¡®è®¤


**ğŸ”¸ ä»€ä¹ˆæ˜¯Publisher Confirms**
Publisher Confirmsæ˜¯RabbitMQæä¾›çš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯è¢«æˆåŠŸæ¥æ”¶ã€‚

```java
// å¯ç”¨å‘å¸ƒç¡®è®¤
channel.confirmSelect();

// æ‰¹é‡å‘é€åç­‰å¾…ç¡®è®¤
public void sendWithBatchConfirm(List<String> messages) {
    try {
        // 1. æ‰¹é‡å‘é€æ¶ˆæ¯
        for (String message : messages) {
            channel.basicPublish("", queueName, null, 
                               message.getBytes());
        }
        
        // 2. ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯ç¡®è®¤ï¼ˆæœ€å¤šç­‰å¾…5ç§’ï¼‰
        boolean allConfirmed = channel.waitForConfirms(5000);
        
        if (allConfirmed) {
            System.out.println("æ‰€æœ‰æ¶ˆæ¯å‘é€æˆåŠŸ");
        } else {
            System.out.println("éƒ¨åˆ†æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œéœ€è¦é‡è¯•");
        }
    } catch (Exception e) {
        System.out.println("å‘é€å¼‚å¸¸ï¼š" + e.getMessage());
    }
}
```

---

## 4. ğŸ—œï¸ ç½‘ç»œå‹ç¼©æŠ€æœ¯åº”ç”¨


### 4.1 RabbitMQå‹ç¼©æœºåˆ¶


> **ğŸ”§ å®ç”¨æŠ€å·§**
> RabbitMQæœ¬èº«ä¸ä¼šè‡ªåŠ¨å‹ç¼©æ¶ˆæ¯ï¼Œä½†å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯å®ç°å‹ç¼©ï¼Œå°±åƒç»™æ–‡ä»¶æ‰“åŒ…ä¸€æ ·ã€‚

**ğŸ”¸ å‹ç¼©çš„é€‚ç”¨åœºæ™¯**
- æ–‡æœ¬ç±»æ¶ˆæ¯ï¼ˆJSONã€XMLã€æ—¥å¿—ï¼‰
- é‡å¤å†…å®¹è¾ƒå¤šçš„æ•°æ®
- ç½‘ç»œå¸¦å®½å—é™çš„ç¯å¢ƒ
- è·¨åœ°åŒºä¼ è¾“çš„æ¶ˆæ¯

### 4.2 å¸¸ç”¨å‹ç¼©ç®—æ³•å¯¹æ¯”


| å‹ç¼©ç®—æ³• | **å‹ç¼©ç‡** | **é€Ÿåº¦** | **CPUæ¶ˆè€—** | **é€‚ç”¨åœºæ™¯** |
|----------|-----------|---------|-------------|-------------|
| `GZIP` | `é«˜` | `ä¸­ç­‰` | `ä¸­ç­‰` | `é€šç”¨åœºæ™¯ï¼Œå¹³è¡¡æ€§èƒ½` |
| `LZ4` | `ä¸­ç­‰` | `å¾ˆå¿«` | `ä½` | `å®æ—¶æ€§è¦æ±‚é«˜` |
| `Snappy` | `ä¸­ç­‰` | `å¿«` | `ä½` | `Googleæ¨èï¼Œç¨³å®š` |
| `ZSTD` | `å¾ˆé«˜` | `å¿«` | `ä¸­ç­‰` | `æ–°ç®—æ³•ï¼Œæ•ˆæœå¥½` |

### 4.3 å‹ç¼©å®ç°ç¤ºä¾‹


**å®Œæ•´çš„å‹ç¼©å‘é€ç¤ºä¾‹ï¼š**
```java
public class CompressedMessageSender {
    
    // GZIPå‹ç¼©
    private byte[] compress(String data) throws IOException {
        ByteArrayOutputStream out = new ByteArrayOutputStream();
        try (GZIPOutputStream gzip = new GZIPOutputStream(out)) {
            gzip.write(data.getBytes(StandardCharsets.UTF_8));
        }
        return out.toByteArray();
    }
    
    // æ™ºèƒ½å‹ç¼©ï¼šæ ¹æ®å¤§å°å†³å®šæ˜¯å¦å‹ç¼©
    public void smartSend(String message) throws IOException {
        byte[] originalBytes = message.getBytes(StandardCharsets.UTF_8);
        
        // å°äº1KBçš„æ¶ˆæ¯ä¸å‹ç¼©
        if (originalBytes.length < 1024) {
            channel.basicPublish("", queueName, null, originalBytes);
            return;
        }
        
        // å¤§æ¶ˆæ¯è¿›è¡Œå‹ç¼©
        byte[] compressed = compress(message);
        
        // å‹ç¼©æ•ˆæœä¸å¥½å°±ä¸å‹ç¼©
        if (compressed.length >= originalBytes.length * 0.9) {
            channel.basicPublish("", queueName, null, originalBytes);
        } else {
            // è®¾ç½®å‹ç¼©æ ‡è¯†å¹¶å‘é€
            AMQP.BasicProperties props = new AMQP.BasicProperties.Builder()
                .headers(Map.of("compressed", "gzip"))
                .build();
            channel.basicPublish("", queueName, props, compressed);
        }
    }
}
```

---

## 5. ğŸ”— TCPä¸è¿æ¥å±‚ä¼˜åŒ–


### 5.1 TCPç¼“å†²åŒºè°ƒæ•´


> **ğŸ’¡ ç®€å•ç†è§£**
> TCPç¼“å†²åŒºå°±åƒæ°´ç®¡çš„ç²—ç»†ï¼Œç®¡å­è¶Šç²—ï¼ŒåŒæ—¶æµè¿‡çš„æ°´å°±è¶Šå¤šã€‚

**ğŸ”¸ ä»€ä¹ˆæ˜¯TCPç¼“å†²åŒº**
TCPç¼“å†²åŒºæ˜¯æ“ä½œç³»ç»Ÿä¸ºç½‘ç»œè¿æ¥åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œç”¨äºæš‚å­˜å‘é€å’Œæ¥æ”¶çš„æ•°æ®ã€‚

**å®¢æˆ·ç«¯ç¼“å†²åŒºè°ƒæ•´ï¼š**
```java
// è®¾ç½®Socketç¼“å†²åŒºå¤§å°
ConnectionFactory factory = new ConnectionFactory();
factory.setHost("localhost");

// è®¾ç½®æ¥æ”¶ç¼“å†²åŒºï¼ˆé»˜è®¤64KBï¼Œå¯è°ƒæ•´åˆ°1MBï¼‰
factory.setRequestedChannelMax(0);
factory.setRequestedFrameMax(1048576); // 1MB

// è‡ªå®šä¹‰Socketå·¥å‚
factory.setSocketFactory(new SocketFactory() {
    @Override
    public Socket createSocket() throws IOException {
        Socket socket = new Socket();
        // è®¾ç½®å‘é€ç¼“å†²åŒºä¸º1MB
        socket.setSendBufferSize(1024 * 1024);
        // è®¾ç½®æ¥æ”¶ç¼“å†²åŒºä¸º1MB  
        socket.setReceiveBufferSize(1024 * 1024);
        // ç¦ç”¨Nagleç®—æ³•ï¼Œå‡å°‘å»¶è¿Ÿ
        socket.setTcpNoDelay(true);
        return socket;
    }
});
```

### 5.2 è¿æ¥å¤ç”¨ä¼˜åŒ–


**ğŸ”¸ è¿æ¥å¤ç”¨çš„é‡è¦æ€§**
```
è¿æ¥åˆ›å»ºæˆæœ¬åˆ†æï¼š
å»ºç«‹è¿æ¥ï¼š3æ¬¡æ¡æ‰‹ + SSLæ¡æ‰‹ï¼ˆå¦‚æœå¯ç”¨ï¼‰
è®¤è¯è¿‡ç¨‹ï¼šç”¨æˆ·åå¯†ç éªŒè¯
èµ„æºåˆ†é…ï¼šå†…å­˜ã€æ–‡ä»¶æè¿°ç¬¦ç­‰

å¤ç”¨å¥½å¤„ï¼š
å‡å°‘è¿æ¥å¼€é”€
æé«˜å¹¶å‘æ€§èƒ½
é™ä½æœåŠ¡å™¨å‹åŠ›
```

**è¿æ¥æ± é…ç½®ç¤ºä¾‹ï¼š**
```java
@Configuration
public class RabbitConfig {
    
    @Bean
    public CachingConnectionFactory connectionFactory() {
        CachingConnectionFactory factory = new CachingConnectionFactory("localhost");
        factory.setUsername("guest");
        factory.setPassword("guest");
        
        // è¿æ¥æ± é…ç½®
        factory.setChannelCacheSize(50);        // ç¼“å­˜50ä¸ªChannel
        factory.setConnectionCacheSize(5);      // ç¼“å­˜5ä¸ªConnection
        factory.setChannelCheckoutTimeout(5000); // è·å–Channelè¶…æ—¶5ç§’
        
        // å¿ƒè·³é…ç½®
        factory.setRequestedHeartBeat(60);      // 60ç§’å¿ƒè·³
        factory.setConnectionTimeout(30000);    // è¿æ¥è¶…æ—¶30ç§’
        
        return factory;
    }
}
```

### 5.3 ç½‘ç»œå»¶è¿Ÿå¤„ç†


**ğŸ”¸ é«˜å»¶è¿Ÿç½‘ç»œä¼˜åŒ–ç­–ç•¥**

> **ğŸ“Š å»¶è¿Ÿå½±å“åˆ†æ**
> é«˜å»¶è¿Ÿç½‘ç»œä¸‹ï¼Œæ¯æ¬¡æ¶ˆæ¯ç¡®è®¤éƒ½è¦ç­‰å¾…å¾€è¿”æ—¶é—´ï¼Œä¸¥é‡å½±å“ååé‡ã€‚

```
å»¶è¿Ÿä¼˜åŒ–æ–¹æ¡ˆï¼š

1. å¼‚æ­¥å‘é€ï¼šä¸ç­‰å¾…ç¡®è®¤å°±å‘é€ä¸‹ä¸€æ¡
2. æ‰¹é‡ç¡®è®¤ï¼šä¸€æ¬¡ç¡®è®¤å¤šæ¡æ¶ˆæ¯  
3. ç®¡é“æŠ€æœ¯ï¼šåœ¨ç­‰å¾…ç¡®è®¤çš„åŒæ—¶å‘é€æ–°æ¶ˆæ¯
4. æœ¬åœ°ç¼“å­˜ï¼šå‡å°‘ç½‘ç»œäº¤äº’æ¬¡æ•°
```

**å¼‚æ­¥å‘é€ç¤ºä¾‹ï¼š**
```java
public class AsyncSender {
    private Channel channel;
    private final Map<Long, String> unconfirmedMessages = 
        new ConcurrentHashMap<>();
    
    public void setupAsyncConfirms() throws IOException {
        channel.confirmSelect();
        
        // è®¾ç½®ç¡®è®¤ç›‘å¬å™¨
        channel.addConfirmListener(new ConfirmListener() {
            @Override
            public void handleAck(long deliveryTag, boolean multiple) {
                // æ¶ˆæ¯ç¡®è®¤æˆåŠŸ
                if (multiple) {
                    // æ‰¹é‡ç¡®è®¤
                    unconfirmedMessages.entrySet()
                        .removeIf(entry -> entry.getKey() <= deliveryTag);
                } else {
                    // å•æ¡ç¡®è®¤
                    unconfirmedMessages.remove(deliveryTag);
                }
            }
            
            @Override
            public void handleNack(long deliveryTag, boolean multiple) {
                // æ¶ˆæ¯ç¡®è®¤å¤±è´¥ï¼Œéœ€è¦é‡è¯•
                System.out.println("æ¶ˆæ¯å‘é€å¤±è´¥ï¼š" + deliveryTag);
            }
        });
    }
    
    public void sendAsync(String message) throws IOException {
        long nextSeqNo = channel.getNextPublishSeqNo();
        unconfirmedMessages.put(nextSeqNo, message);
        
        // å¼‚æ­¥å‘é€ï¼Œä¸ç­‰å¾…ç¡®è®¤
        channel.basicPublish("", queueName, null, message.getBytes());
    }
}
```

---

## 6. ğŸ“ˆ ç½‘ç»œç›‘æ§ä¸æ•…éšœæ’æŸ¥


### 6.1 å…³é”®ç›‘æ§æŒ‡æ ‡


**ğŸ”¸ RabbitMQç®¡ç†ç•Œé¢ç›‘æ§**

```
å…³é”®æŒ‡æ ‡è§£è¯»ï¼š

Message ratesï¼ˆæ¶ˆæ¯é€Ÿç‡ï¼‰ï¼š
- Publishï¼šæ¯ç§’å‘é€æ¶ˆæ¯æ•°
- Deliverï¼šæ¯ç§’æ¶ˆè´¹æ¶ˆæ¯æ•°  
- Ackï¼šæ¯ç§’ç¡®è®¤æ¶ˆæ¯æ•°

å¦‚æœ Publish > Deliverï¼Œè¯´æ˜æ¶ˆæ¯ç§¯å‹
å¦‚æœ Ack < Deliverï¼Œè¯´æ˜æ¶ˆè´¹ç«¯æœ‰é—®é¢˜
```

**ğŸ”¸ ç³»ç»Ÿçº§ç½‘ç»œç›‘æ§**
```bash
# æŸ¥çœ‹ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µ
iftop -i eth0

# æŸ¥çœ‹è¿æ¥çŠ¶æ€
netstat -an | grep 5672

# æŸ¥çœ‹ç½‘ç»œå»¶è¿Ÿ
ping rabbitmq-server

# æŸ¥çœ‹TCPè¿æ¥è¯¦æƒ…
ss -i | grep 5672
```

### 6.2 å¸¸è§ç½‘ç»œé—®é¢˜è¯Šæ–­


**â“ é—®é¢˜ä¸€ï¼šæ¶ˆæ¯å‘é€æ…¢**

**è¯Šæ–­æ­¥éª¤ï¼š**
1. **æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ**ï¼š`ping`æµ‹è¯•å»¶è¿Ÿæ˜¯å¦æ­£å¸¸
2. **æ£€æŸ¥å¸¦å®½ä½¿ç”¨**ï¼š`iftop`æŸ¥çœ‹æ˜¯å¦æ¥è¿‘å¸¦å®½ä¸Šé™
3. **æ£€æŸ¥æ¶ˆæ¯å¤§å°**ï¼šæ˜¯å¦æœ‰å¼‚å¸¸å¤§çš„æ¶ˆæ¯
4. **æ£€æŸ¥è¿æ¥æ•°**ï¼šæ˜¯å¦è¿æ¥æ•°è¿‡å¤šå¯¼è‡´æ€§èƒ½ä¸‹é™

**â“ é—®é¢˜äºŒï¼šè¿æ¥é¢‘ç¹æ–­å¼€**

**å¯èƒ½åŸå› ï¼š**
- ç½‘ç»œä¸ç¨³å®šï¼Œä¸¢åŒ…ç‡é«˜
- å¿ƒè·³è®¾ç½®ä¸åˆç†
- é˜²ç«å¢™æˆ–è´Ÿè½½å‡è¡¡å™¨é…ç½®é—®é¢˜
- RabbitMQæœåŠ¡å™¨èµ„æºä¸è¶³

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// è°ƒæ•´å¿ƒè·³å’Œè¶…æ—¶è®¾ç½®
factory.setRequestedHeartBeat(30);     // ç¼©çŸ­å¿ƒè·³é—´éš”
factory.setConnectionTimeout(10000);   // å‡å°‘è¿æ¥è¶…æ—¶
factory.setNetworkRecoveryInterval(5000); // è‡ªåŠ¨æ¢å¤é—´éš”
factory.setAutomaticRecoveryEnabled(true); // å¯ç”¨è‡ªåŠ¨æ¢å¤
```

### 6.3 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•


**ğŸ“‹ ç½‘ç»œä¼˜åŒ–æ£€æŸ¥é¡¹**

- [ ] **æ¶ˆæ¯å¤§å°**ï¼šæ˜¯å¦åœ¨10KB-100KBçš„æ¨èèŒƒå›´å†…
- [ ] **æ‰¹é‡å‘é€**ï¼šæ˜¯å¦å¯ç”¨äº†æ‰¹é‡å‘é€ç­–ç•¥
- [ ] **å‹ç¼©è®¾ç½®**ï¼šå¤§æ¶ˆæ¯æ˜¯å¦å¯ç”¨äº†å‹ç¼©
- [ ] **è¿æ¥å¤ç”¨**ï¼šæ˜¯å¦ä½¿ç”¨äº†è¿æ¥æ± 
- [ ] **TCPä¼˜åŒ–**ï¼šæ˜¯å¦è°ƒæ•´äº†ç¼“å†²åŒºå¤§å°
- [ ] **å¼‚æ­¥ç¡®è®¤**ï¼šæ˜¯å¦ä½¿ç”¨äº†å¼‚æ­¥å‘é€æ¨¡å¼
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šæ˜¯å¦è®¾ç½®äº†ç½‘ç»œæ€§èƒ½ç›‘æ§
- [ ] **å®¹é‡è§„åˆ’**ï¼šæ˜¯å¦é¢„ä¼°äº†å¸¦å®½éœ€æ±‚

> **ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
> ç½‘ç»œä¼˜åŒ–æ˜¯ä¸€ä¸ªæ¸è¿›è¿‡ç¨‹ï¼Œå»ºè®®å…ˆä»å½±å“æœ€å¤§çš„ä¼˜åŒ–ç‚¹å¼€å§‹ï¼Œé€æ­¥æ”¹å–„æ•´ä½“æ€§èƒ½ã€‚

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ ç½‘ç»œç“¶é¢ˆè¯†åˆ«ï¼šå¸¦å®½ä½¿ç”¨ç‡>80%ï¼Œå»¶è¿Ÿ>50mséœ€è¦ä¼˜åŒ–
ğŸ”¸ æ¶ˆæ¯å¤§å°ä¼˜åŒ–ï¼šæ¨è10KB-100KBï¼Œé¿å…è¿‡å¤§è¿‡å°æ¶ˆæ¯
ğŸ”¸ æ‰¹é‡å‘é€ç­–ç•¥ï¼šæ—¶é—´çª—å£+æ•°é‡é˜ˆå€¼çš„ç»„åˆç­–ç•¥æœ€æœ‰æ•ˆ
ğŸ”¸ ç½‘ç»œå‹ç¼©åº”ç”¨ï¼šæ–‡æœ¬ç±»æ¶ˆæ¯å‹ç¼©æ•ˆæœå¥½ï¼ŒäºŒè¿›åˆ¶æ•°æ®æ•ˆæœæœ‰é™
ğŸ”¸ è¿æ¥å±‚ä¼˜åŒ–ï¼šè¿æ¥å¤ç”¨+TCPç¼“å†²åŒºè°ƒæ•´+å¼‚æ­¥ç¡®è®¤
ğŸ”¸ ç›‘æ§ä½“ç³»å»ºè®¾ï¼šå®æ—¶ç›‘æ§+å‘Šè­¦+å®šæœŸä¼˜åŒ–
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„å¹³è¡¡è‰ºæœ¯**
```
ä¼˜åŒ–æƒè¡¡ï¼š
æ¶ˆæ¯å¤§å° â†” ç½‘ç»œå¼€é”€
å®æ—¶æ€§ â†” æ‰¹é‡æ•ˆç‡  
å‹ç¼©æ”¶ç›Š â†” CPUæ¶ˆè€—
è¿æ¥æ•°é‡ â†” èµ„æºå ç”¨
```

**ğŸ”¹ é—®é¢˜æ’æŸ¥çš„ç³»ç»Ÿæ–¹æ³•**
```
æ’æŸ¥æ­¥éª¤ï¼š
1. ç°è±¡è§‚å¯Ÿï¼šå…·ä½“ä»€ä¹ˆæ…¢ï¼Ÿå¤šæ…¢ï¼Ÿ
2. æŒ‡æ ‡æ”¶é›†ï¼šç½‘ç»œã€ç³»ç»Ÿã€åº”ç”¨å±‚æŒ‡æ ‡
3. ç“¶é¢ˆå®šä½ï¼šæ˜¯å¸¦å®½ã€å»¶è¿Ÿè¿˜æ˜¯è¿æ¥é—®é¢˜ï¼Ÿ
4. æ–¹æ¡ˆåˆ¶å®šï¼šé’ˆå¯¹æ€§ä¼˜åŒ–æ–¹æ¡ˆ
5. æ•ˆæœéªŒè¯ï¼šä¼˜åŒ–å‰åå¯¹æ¯”
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ åº”ç”¨åœºæ™¯æŒ‡å¯¼**

- **é«˜é¢‘å°æ¶ˆæ¯åœºæ™¯**ï¼šé‡ç‚¹ä¼˜åŒ–æ‰¹é‡å‘é€å’Œè¿æ¥å¤ç”¨
- **å¤§æ–‡ä»¶ä¼ è¾“åœºæ™¯**ï¼šé‡ç‚¹ä¼˜åŒ–æ¶ˆæ¯å‹ç¼©å’ŒTCPç¼“å†²åŒº
- **è·¨åœ°åŒºä¼ è¾“åœºæ™¯**ï¼šé‡ç‚¹ä¼˜åŒ–å¼‚æ­¥ç¡®è®¤å’Œç½‘ç»œå»¶è¿Ÿå¤„ç†
- **é«˜å¹¶å‘åœºæ™¯**ï¼šé‡ç‚¹ä¼˜åŒ–è¿æ¥æ± å’Œç½‘ç»œç›‘æ§

**ğŸ”§ è¿ç»´å®è·µè¦ç‚¹**

- **é¢„é˜²ä¸ºä¸»**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»ï¼Œæå‰å‘ç°é—®é¢˜
- **æ¸è¿›ä¼˜åŒ–**ï¼šä»å½±å“æœ€å¤§çš„ç‚¹å¼€å§‹ï¼Œé¿å…è¿‡åº¦ä¼˜åŒ–
- **æµ‹è¯•éªŒè¯**ï¼šæ¯æ¬¡ä¼˜åŒ–éƒ½è¦æœ‰æ€§èƒ½å¯¹æ¯”æ•°æ®
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•ä¼˜åŒ–æ–¹æ¡ˆå’Œæ•ˆæœï¼Œä¾¿äºåç»­ç»´æŠ¤

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ç½‘ç»œç“¶é¢ˆè¦ç›‘æ§ï¼ŒæŒ‡æ ‡å¼‚å¸¸åŠæ—¶çŸ¥
- æ¶ˆæ¯å¤§å°è¦é€‚ä¸­ï¼Œæ‰¹é‡å‹ç¼©æ•ˆç‡é«˜  
- è¿æ¥å¤ç”¨å‡å¼€é”€ï¼Œå¼‚æ­¥å‘é€ååå¥½
- é—®é¢˜æ’æŸ¥æœ‰æ–¹æ³•ï¼Œç³»ç»Ÿä¼˜åŒ–è§æˆæ•ˆ