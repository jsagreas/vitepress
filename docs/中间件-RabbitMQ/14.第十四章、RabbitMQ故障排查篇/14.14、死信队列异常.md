---
title: 14ã€æ­»ä¿¡é˜Ÿåˆ—å¼‚å¸¸
---
## ğŸ“š ç›®å½•

1. [æ­»ä¿¡é˜Ÿåˆ—åŸºç¡€æ¦‚å¿µ](#1-æ­»ä¿¡é˜Ÿåˆ—åŸºç¡€æ¦‚å¿µ)
2. [å¸¸è§æ­»ä¿¡è§¦å‘åœºæ™¯](#2-å¸¸è§æ­»ä¿¡è§¦å‘åœºæ™¯)
3. [é…ç½®é—®é¢˜æ’æŸ¥](#3-é…ç½®é—®é¢˜æ’æŸ¥)
4. [è·¯ç”±å¼‚å¸¸è¯Šæ–­](#4-è·¯ç”±å¼‚å¸¸è¯Šæ–­)
5. [æ¶ˆæ¯å¤„ç†é—®é¢˜](#5-æ¶ˆæ¯å¤„ç†é—®é¢˜)
6. [ç›‘æ§ä¸è¿ç»´](#6-ç›‘æ§ä¸è¿ç»´)
7. [æœ€ä½³å®è·µæ€»ç»“](#7-æœ€ä½³å®è·µæ€»ç»“)

---

## 1. ğŸ’€ æ­»ä¿¡é˜Ÿåˆ—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ­»ä¿¡é˜Ÿåˆ—


**ç®€å•ç†è§£**ï¼šæ­»ä¿¡é˜Ÿåˆ—å°±åƒæ˜¯æ¶ˆæ¯çš„"åƒåœ¾æ¡¶"ï¼Œå½“æ­£å¸¸é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å‡ºç°é—®é¢˜æ—¶ï¼ŒRabbitMQä¼šæŠŠè¿™äº›"åæ‰"çš„æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—é‡Œã€‚

```
æ­£å¸¸æµç¨‹ï¼šç”Ÿäº§è€… â†’ Exchange â†’ Queue â†’ æ¶ˆè´¹è€…

å‡ºç°é—®é¢˜ï¼šç”Ÿäº§è€… â†’ Exchange â†’ Queue â†’ [æ¶ˆæ¯å¼‚å¸¸] â†’ æ­»ä¿¡Exchange â†’ æ­»ä¿¡Queue

å°±åƒå¿«é€’é…é€ï¼š
- æ­£å¸¸æƒ…å†µï¼šå¿«é€’ â†’ åˆ†æ‹£ä¸­å¿ƒ â†’ æ´¾é€ç«™ â†’ æ”¶ä»¶äºº
- å¼‚å¸¸æƒ…å†µï¼šå¿«é€’ â†’ åˆ†æ‹£ä¸­å¿ƒ â†’ æ´¾é€ç«™ â†’ [åœ°å€é”™è¯¯] â†’ é€€ä»¶å¤„ç†ä¸­å¿ƒ
```

### 1.2 æ­»ä¿¡çš„äº§ç”ŸåŸå› 


**æ ¸å¿ƒè§¦å‘æ¡ä»¶**ï¼š
- **æ¶ˆæ¯è¢«æ‹’ç»** - æ¶ˆè´¹è€…ä¸»åŠ¨æ‹’ç»æ¶ˆæ¯ä¸”ä¸é‡æ–°å…¥é˜Ÿ
- **æ¶ˆæ¯è¿‡æœŸ** - æ¶ˆæ¯è¶…è¿‡è®¾å®šçš„TTLæ—¶é—´
- **é˜Ÿåˆ—æ»¡äº†** - é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦é™åˆ¶

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ğŸ  æ¶ˆæ¯è¢«æ‹’ç» = å¿«é€’å‘˜é€è´§ï¼Œæ”¶ä»¶äººæ‹’æ”¶
â° æ¶ˆæ¯è¿‡æœŸ = ç‰›å¥¶è¿‡äº†ä¿è´¨æœŸï¼Œä¸èƒ½å†å–
ğŸ“¦ é˜Ÿåˆ—æ»¡äº† = ä»“åº“è£…ä¸ä¸‹äº†ï¼Œæ–°è´§ç‰©å¾—å¦å¤–å¤„ç†
```

### 1.3 æ­»ä¿¡é˜Ÿåˆ—çš„ä½œç”¨


**æ ¸å¿ƒä»·å€¼**ï¼š
- **æ¶ˆæ¯ä¿æŠ¤** - é˜²æ­¢é‡è¦æ¶ˆæ¯ä¸¢å¤±
- **é—®é¢˜æ’æŸ¥** - ä¿ç•™å¼‚å¸¸æ¶ˆæ¯ç”¨äºåˆ†æ
- **ç³»ç»Ÿç¨³å®š** - é¿å…åæ¶ˆæ¯å½±å“æ­£å¸¸å¤„ç†
- **ä¸šåŠ¡è¡¥å¿** - æ”¯æŒäººå·¥å¤„ç†æˆ–é‡è¯•æœºåˆ¶

---

## 2. ğŸš¨ å¸¸è§æ­»ä¿¡è§¦å‘åœºæ™¯


### 2.1 æ¶ˆæ¯TTLè¿‡æœŸé—®é¢˜


**é—®é¢˜ç°è±¡**ï¼šæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­åœç•™æ—¶é—´è¿‡é•¿ï¼Œè‡ªåŠ¨è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—

```java
// è®¾ç½®æ¶ˆæ¯TTLç¤ºä¾‹
channel.basicPublish(
    "normal.exchange",
    "normal.key", 
    new AMQP.BasicProperties.Builder()
        .expiration("60000")  // 60ç§’è¿‡æœŸ
        .build(),
    "Hello World".getBytes()
);
```

**å¸¸è§åŸå› åˆ†æ**ï¼š
- â±ï¸ **TTLè®¾ç½®è¿‡çŸ­** - æ¶ˆè´¹è€…æ¥ä¸åŠå¤„ç†
- ğŸŒ **æ¶ˆè´¹è€…å¤„ç†æ…¢** - ä¸šåŠ¡é€»è¾‘å¤æ‚å¯¼è‡´å¤„ç†è¶…æ—¶
- ğŸ“Š **æ¶ˆæ¯ç§¯å‹** - ç”Ÿäº§é€Ÿåº¦è¿œå¤§äºæ¶ˆè´¹é€Ÿåº¦
- ğŸ”§ **ç³»ç»Ÿè´Ÿè½½é«˜** - æœåŠ¡å™¨èµ„æºä¸è¶³å½±å“å¤„ç†é€Ÿåº¦

### 2.2 é˜Ÿåˆ—é•¿åº¦é™åˆ¶é—®é¢˜


**é—®é¢˜æè¿°**ï¼šé˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼Œæ–°æ¶ˆæ¯è¢«è½¬ä¸ºæ­»ä¿¡

```bash
# å£°æ˜å¸¦é•¿åº¦é™åˆ¶çš„é˜Ÿåˆ—
rabbitmqctl eval 'rabbit_amqqueue:declare(
    {resource, <<"/">>, queue, <<"normal.queue">>},
    true, false,
    [{<<"x-max-length">>, long, 1000}],  % æœ€å¤§1000æ¡æ¶ˆæ¯
    none
).'
```

**æ’æŸ¥æ€è·¯**ï¼š
```
æ£€æŸ¥é˜Ÿåˆ—çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Queue Info      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Messages: 1000  â”‚ â† è¾¾åˆ°ä¸Šé™
â”‚ Max-length: 1000â”‚ â† è®¾ç½®çš„é™åˆ¶
â”‚ Consumers: 0    â”‚ â† æ²¡æœ‰æ¶ˆè´¹è€…ï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è§£å†³æ–¹æ¡ˆï¼š
1. å¢åŠ æ¶ˆè´¹è€…æ•°é‡
2. è°ƒæ•´é˜Ÿåˆ—é•¿åº¦é™åˆ¶
3. ä¼˜åŒ–æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦
```

### 2.3 æ¶ˆè´¹è€…æ‹’ç»æ¶ˆæ¯


**å…¸å‹åœºæ™¯**ï¼šæ¶ˆè´¹è€…å¤„ç†å¤±è´¥ï¼Œæ‹’ç»æ¶ˆæ¯ä¸”ä¸é‡æ–°å…¥é˜Ÿ

```java
// æ¶ˆè´¹è€…æ‹’ç»æ¶ˆæ¯çš„ä»£ç ç¤ºä¾‹
public void handleMessage(String message) {
    try {
        // ä¸šåŠ¡å¤„ç†é€»è¾‘
        processBusinessLogic(message);
        
        // å¤„ç†æˆåŠŸï¼Œç¡®è®¤æ¶ˆæ¯
        channel.basicAck(deliveryTag, false);
        
    } catch (BusinessException e) {
        // ä¸šåŠ¡å¼‚å¸¸ï¼Œæ‹’ç»æ¶ˆæ¯ï¼Œä¸é‡æ–°å…¥é˜Ÿ â†’ è¿›å…¥æ­»ä¿¡
        channel.basicNack(deliveryTag, false, false);
        
    } catch (SystemException e) {
        // ç³»ç»Ÿå¼‚å¸¸ï¼Œæ‹’ç»æ¶ˆæ¯ï¼Œé‡æ–°å…¥é˜Ÿ â†’ é‡è¯•
        channel.basicNack(deliveryTag, false, true);
    }
}
```

---

## 3. âš™ï¸ é…ç½®é—®é¢˜æ’æŸ¥


### 3.1 æ­»ä¿¡Exchangeé…ç½®ç¼ºå¤±


**é—®é¢˜ç°è±¡**ï¼šæ¶ˆæ¯åº”è¯¥è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œä½†å´ç›´æ¥ä¸¢å¤±äº†

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥æ™®é€šé˜Ÿåˆ—çš„æ­»ä¿¡é…ç½®
rabbitmqctl list_queues name arguments

# æ­£ç¡®çš„è¾“å‡ºåº”è¯¥åŒ…å«ï¼š
# normal.queue  [{"x-dead-letter-exchange","dlx.exchange"}]
```

**é…ç½®ç¤ºä¾‹**ï¼š
```java
// æ­£ç¡®çš„æ­»ä¿¡é…ç½®
Map<String, Object> args = new HashMap<>();
args.put("x-dead-letter-exchange", "dlx.exchange");
args.put("x-dead-letter-routing-key", "dead.message");

channel.queueDeclare(
    "normal.queue",    // é˜Ÿåˆ—å
    true,             // æŒä¹…åŒ–
    false,            // éç‹¬å 
    false,            // ä¸è‡ªåŠ¨åˆ é™¤
    args              // æ­»ä¿¡é…ç½®å‚æ•°
);
```

### 3.2 æ­»ä¿¡è·¯ç”±é”®è®¾ç½®é”™è¯¯


**é—®é¢˜åˆ†æ**ï¼šæ­»ä¿¡Exchangeå­˜åœ¨ï¼Œä½†æ¶ˆæ¯æ— æ³•è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—

**è¯Šæ–­æ–¹æ³•**ï¼š
```
æ¶ˆæ¯æµå‘æ£€æŸ¥ï¼š
æ­£å¸¸é˜Ÿåˆ— â†’ [è§¦å‘æ­»ä¿¡] â†’ æ­»ä¿¡Exchange â†’ [è·¯ç”±å¤±è´¥] â†’ æ¶ˆæ¯ä¸¢å¤±

æ£€æŸ¥è¦ç‚¹ï¼š
âœ… æ­»ä¿¡Exchangeæ˜¯å¦å­˜åœ¨
âœ… æ­»ä¿¡è·¯ç”±é”®æ˜¯å¦æ­£ç¡®
âœ… æ­»ä¿¡é˜Ÿåˆ—æ˜¯å¦ç»‘å®šåˆ°Exchange
âœ… ç»‘å®šçš„è·¯ç”±é”®æ˜¯å¦åŒ¹é…
```

**é…ç½®å¯¹æ¯”**ï¼š
```java
// âŒ é”™è¯¯é…ç½® - è·¯ç”±é”®ä¸åŒ¹é…
// æ™®é€šé˜Ÿåˆ—é…ç½®
args.put("x-dead-letter-routing-key", "dead.message");

// æ­»ä¿¡é˜Ÿåˆ—ç»‘å®š
channel.queueBind("dead.queue", "dlx.exchange", "error.message");
// è·¯ç”±é”®ä¸åŒ¹é…ï¼šdead.message â‰  error.message

// âœ… æ­£ç¡®é…ç½® - è·¯ç”±é”®åŒ¹é…
// æ™®é€šé˜Ÿåˆ—é…ç½®
args.put("x-dead-letter-routing-key", "dead.message");

// æ­»ä¿¡é˜Ÿåˆ—ç»‘å®š
channel.queueBind("dead.queue", "dlx.exchange", "dead.message");
// è·¯ç”±é”®åŒ¹é…ï¼šdead.message = dead.message
```

### 3.3 æƒé™é—®é¢˜è¯Šæ–­


**é—®é¢˜è¡¨ç°**ï¼šé…ç½®çœ‹èµ·æ¥æ­£ç¡®ï¼Œä½†æ­»ä¿¡é˜Ÿåˆ—æ²¡æœ‰æ¶ˆæ¯

**æƒé™æ£€æŸ¥æ¸…å•**ï¼š
- ğŸ” **ç”¨æˆ·æƒé™** - åº”ç”¨ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®æ­»ä¿¡Exchange
- ğŸ·ï¸ **Exchangeæƒé™** - æ˜¯å¦æœ‰æƒé™å‘æ­»ä¿¡Exchangeå‘å¸ƒæ¶ˆæ¯
- ğŸ“® **é˜Ÿåˆ—æƒé™** - æ˜¯å¦æœ‰æƒé™å‘æ­»ä¿¡é˜Ÿåˆ—å†™å…¥æ¶ˆæ¯

```bash
# æ£€æŸ¥ç”¨æˆ·æƒé™
rabbitmqctl list_user_permissions your_app_user

# è¾“å‡ºç¤ºä¾‹ï¼š
# Listing permissions for user "app_user" ...
# vhost   configure   write       read
# /       .*          .*          .*
```

---

## 4. ğŸ”€ è·¯ç”±å¼‚å¸¸è¯Šæ–­


### 4.1 æ­»ä¿¡å¾ªç¯è·¯ç”±é—®é¢˜


**å±é™©åœºæ™¯**ï¼šæ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯åˆè¢«è·¯ç”±å›åŸé˜Ÿåˆ—ï¼Œå½¢æˆæ— é™å¾ªç¯

```
æ­»ä¿¡å¾ªç¯ç¤ºæ„å›¾ï¼š
æ™®é€šé˜Ÿåˆ— â†’ [æ¶ˆæ¯å¤±è´¥] â†’ æ­»ä¿¡é˜Ÿåˆ— â†’ [å†æ¬¡å¤±è´¥] â†’ æ™®é€šé˜Ÿåˆ— â†’ ...
    â†‘                                                    â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ— é™å¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¢„é˜²æªæ–½**ï¼š
```java
// âœ… å®‰å…¨çš„æ­»ä¿¡é…ç½® - æ­»ä¿¡é˜Ÿåˆ—ä¸è®¾ç½®æ­»ä¿¡Exchange
Map<String, Object> normalArgs = new HashMap<>();
normalArgs.put("x-dead-letter-exchange", "dlx.exchange");

Map<String, Object> deadArgs = new HashMap<>();
// æ­»ä¿¡é˜Ÿåˆ—ä¸è®¾ç½® x-dead-letter-exchangeï¼Œé¿å…å¾ªç¯

channel.queueDeclare("normal.queue", true, false, false, normalArgs);
channel.queueDeclare("dead.queue", true, false, false, deadArgs);
```

### 4.2 Exchangeç±»å‹åŒ¹é…é—®é¢˜


**å¸¸è§é”™è¯¯**ï¼šæ­»ä¿¡Exchangeç±»å‹ä¸è·¯ç”±è§„åˆ™ä¸åŒ¹é…

| Exchangeç±»å‹ | è·¯ç”±è§„åˆ™ | é€‚ç”¨åœºæ™¯ |
|-------------|---------|----------|
| **direct** | ç²¾ç¡®åŒ¹é…è·¯ç”±é”® | `ç®€å•è·¯ç”±ï¼Œä¸€å¯¹ä¸€ç»‘å®š` |
| **topic** | æ¨¡å¼åŒ¹é…è·¯ç”±é”® | `å¤æ‚è·¯ç”±ï¼Œæ”¯æŒé€šé…ç¬¦` |
| **fanout** | å¿½ç•¥è·¯ç”±é”®ï¼Œå¹¿æ’­ | `å¹¿æ’­æ¨¡å¼ï¼Œæ‰€æœ‰ç»‘å®šé˜Ÿåˆ—` |
| **headers** | åŒ¹é…æ¶ˆæ¯å¤´å±æ€§ | `åŸºäºæ¶ˆæ¯å±æ€§è·¯ç”±` |

**å®è·µå»ºè®®**ï¼š
```java
// æ¨èä½¿ç”¨ direct ç±»å‹çš„æ­»ä¿¡Exchangeï¼Œç®€å•å¯é 
channel.exchangeDeclare("dlx.exchange", "direct", true);

// é¿å…ä½¿ç”¨å¤æ‚çš„è·¯ç”±è§„åˆ™
channel.queueBind("dead.queue", "dlx.exchange", "dead");
```

---

## 5. ğŸ”§ æ¶ˆæ¯å¤„ç†é—®é¢˜


### 5.1 æ¶ˆæ¯æ ¼å¼å¼‚å¸¸å¤„ç†


**é—®é¢˜åœºæ™¯**ï¼šæ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ ¼å¼å‘ç”Ÿå˜åŒ–ï¼Œå½±å“åç»­å¤„ç†

**æ¶ˆæ¯å±æ€§å¯¹æ¯”**ï¼š
```java
// åŸå§‹æ¶ˆæ¯å±æ€§
MessageProperties original = new MessageProperties();
original.setContentType("application/json");
original.setDeliveryMode(2);  // æŒä¹…åŒ–
original.setHeaders(Map.of("source", "order-service"));

// æ­»ä¿¡æ¶ˆæ¯å¯èƒ½çš„å˜åŒ–
// 1. æ·»åŠ æ­»ä¿¡åŸå› å¤´ä¿¡æ¯
// 2. ä¿ç•™åŸå§‹è·¯ç”±é”®ä¿¡æ¯
// 3. æ—¶é—´æˆ³å¯èƒ½æ›´æ–°
```

**å¤„ç†å»ºè®®**ï¼š
```java
public void handleDeadMessage(Message message) {
    MessageProperties props = message.getMessageProperties();
    
    // æ£€æŸ¥æ­»ä¿¡åŸå› 
    List<Map<String, Object>> xDeathHeader = 
        (List<Map<String, Object>>) props.getHeaders().get("x-death");
    
    if (xDeathHeader != null && !xDeathHeader.isEmpty()) {
        Map<String, Object> deathInfo = xDeathHeader.get(0);
        String reason = (String) deathInfo.get("reason");
        String originalQueue = (String) deathInfo.get("queue");
        
        System.out.println("æ­»ä¿¡åŸå› : " + reason);
        System.out.println("åŸå§‹é˜Ÿåˆ—: " + originalQueue);
    }
}
```

### 5.2 æ­»ä¿¡æ¶ˆæ¯é‡è¯•ç­–ç•¥


**é‡è¯•æœºåˆ¶è®¾è®¡**ï¼š
```
é‡è¯•ç­–ç•¥æµç¨‹ï¼š
æ­»ä¿¡é˜Ÿåˆ— â†’ æ£€æŸ¥é‡è¯•æ¬¡æ•° â†’ å†³å®šå¤„ç†æ–¹å¼

â”œâ”€ é‡è¯•æ¬¡æ•° < 3 â†’ å»¶è¿Ÿé‡æ–°å‘é€åˆ°åŸé˜Ÿåˆ—
â”œâ”€ é‡è¯•æ¬¡æ•° â‰¥ 3 â†’ å‘é€åˆ°äººå·¥å¤„ç†é˜Ÿåˆ—  
â””â”€ ç‰¹æ®Šé”™è¯¯ç±»å‹ â†’ ç›´æ¥ä¸¢å¼ƒæˆ–ç‰¹æ®Šå¤„ç†
```

**å®ç°ç¤ºä¾‹**ï¼š
```java
public void retryDeadMessage(Message message) {
    MessageProperties props = message.getMessageProperties();
    
    // è·å–é‡è¯•æ¬¡æ•°
    Integer retryCount = (Integer) props.getHeaders().getOrDefault("retry-count", 0);
    
    if (retryCount < 3) {
        // å¢åŠ é‡è¯•æ¬¡æ•°
        props.getHeaders().put("retry-count", retryCount + 1);
        
        // å»¶è¿Ÿé‡æ–°å‘é€åˆ°åŸé˜Ÿåˆ—
        scheduleRetry(message, calculateDelay(retryCount));
        
    } else {
        // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œå‘é€åˆ°äººå·¥å¤„ç†é˜Ÿåˆ—
        sendToManualProcessing(message);
    }
}
```

---

## 6. ğŸ“Š ç›‘æ§ä¸è¿ç»´


### 6.1 æ­»ä¿¡ç»Ÿè®¡ç›‘æ§


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
- ğŸ“ˆ **æ­»ä¿¡äº§ç”Ÿé€Ÿç‡** - æ¯å°æ—¶/æ¯å¤©çš„æ­»ä¿¡æ•°é‡
- ğŸ“Š **æ­»ä¿¡åŸå› åˆ†å¸ƒ** - TTLè¿‡æœŸã€æ‹’ç»æ¶ˆæ¯ã€é˜Ÿåˆ—æ»¡ç­‰æ¯”ä¾‹
- â±ï¸ **æ­»ä¿¡å¤„ç†å»¶è¿Ÿ** - ä»äº§ç”Ÿåˆ°å¤„ç†çš„æ—¶é—´é—´éš”
- ğŸ”„ **é‡è¯•æˆåŠŸç‡** - æ­»ä¿¡é‡è¯•çš„æˆåŠŸæ¯”ä¾‹

**ç›‘æ§å®ç°**ï¼š
```java
// ç®€å•çš„æ­»ä¿¡ç›‘æ§ç»Ÿè®¡
public class DeadLetterMonitor {
    private final AtomicLong deadLetterCount = new AtomicLong(0);
    private final Map<String, AtomicLong> reasonStats = new ConcurrentHashMap<>();
    
    public void recordDeadLetter(String reason) {
        deadLetterCount.incrementAndGet();
        reasonStats.computeIfAbsent(reason, k -> new AtomicLong(0))
                   .incrementAndGet();
    }
    
    public void printStats() {
        System.out.println("æ€»æ­»ä¿¡æ•°é‡: " + deadLetterCount.get());
        reasonStats.forEach((reason, count) -> 
            System.out.println(reason + ": " + count.get()));
    }
}
```

### 6.2 æ­»ä¿¡æ¸…ç†ç­–ç•¥


**æ¸…ç†ç­–ç•¥é€‰æ‹©**ï¼š

| ç­–ç•¥ç±»å‹ | é€‚ç”¨åœºæ™¯ | å®æ–½æ–¹æ³• |
|---------|---------|----------|
| **æ—¶é—´æ¸…ç†** | `å®šæœŸæ¸…ç†è¿‡æœŸæ­»ä¿¡` | `TTL + è‡ªåŠ¨åˆ é™¤` |
| **æ•°é‡æ¸…ç†** | `æ§åˆ¶æ­»ä¿¡é˜Ÿåˆ—å¤§å°` | `max-length é™åˆ¶` |
| **æ‰‹åŠ¨æ¸…ç†** | `ç‰¹å®šæ¡ä»¶ä¸‹æ¸…ç†` | `ç®¡ç†è„šæœ¬æ‰§è¡Œ` |
| **å½’æ¡£æ¸…ç†** | `é‡è¦æ•°æ®ä¿ç•™` | `è½¬å­˜ååˆ é™¤` |

**è‡ªåŠ¨æ¸…ç†é…ç½®**ï¼š
```java
// ä¸ºæ­»ä¿¡é˜Ÿåˆ—è®¾ç½®TTLå’Œé•¿åº¦é™åˆ¶
Map<String, Object> deadQueueArgs = new HashMap<>();
deadQueueArgs.put("x-message-ttl", 7 * 24 * 60 * 60 * 1000); // 7å¤©TTL
deadQueueArgs.put("x-max-length", 10000); // æœ€å¤§10000æ¡æ¶ˆæ¯

channel.queueDeclare("dead.queue", true, false, false, deadQueueArgs);
```

---

## 7. ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“


### 7.1 é…ç½®æœ€ä½³å®è·µ


**æ ¸å¿ƒé…ç½®åŸåˆ™**ï¼š
- âœ… **æ˜ç¡®æ­»ä¿¡Exchange** - ä¸ºæ¯ä¸ªä¸šåŠ¡åŸŸè®¾ç½®ä¸“é—¨çš„æ­»ä¿¡Exchange
- âœ… **åˆç†è®¾ç½®TTL** - æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è®¾ç½®åˆé€‚çš„æ¶ˆæ¯è¿‡æœŸæ—¶é—´
- âœ… **é¿å…å¾ªç¯è·¯ç”±** - æ­»ä¿¡é˜Ÿåˆ—ä¸è¦å†è®¾ç½®æ­»ä¿¡Exchange
- âœ… **æƒé™æœ€å°åŒ–** - åªç»™å¿…è¦çš„æƒé™ï¼Œæé«˜å®‰å…¨æ€§

### 7.2 è¿ç»´æœ€ä½³å®è·µ


**æ—¥å¸¸è¿ç»´è¦ç‚¹**ï¼š
```
ç›‘æ§æ£€æŸ¥æ¸…å•ï¼š
â˜‘ï¸ æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡è¶‹åŠ¿
â˜‘ï¸ æ­»ä¿¡äº§ç”ŸåŸå› åˆ†æ
â˜‘ï¸ æ­»ä¿¡å¤„ç†æˆåŠŸç‡ç»Ÿè®¡
â˜‘ï¸ ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
â˜‘ï¸ æ¶ˆè´¹è€…å¥åº·çŠ¶æ€æ£€æŸ¥
```

### 7.3 æ•…éšœå¤„ç†æµç¨‹


**æ ‡å‡†å¤„ç†æµç¨‹**ï¼š
```
æ•…éšœå‘ç° â†’ é—®é¢˜å®šä½ â†’ åº”æ€¥å¤„ç† â†’ æ ¹å› åˆ†æ â†’ é¢„é˜²æªæ–½

1ï¸âƒ£ æ•…éšœå‘ç°ï¼šç›‘æ§å‘Šè­¦ã€ç”¨æˆ·åé¦ˆ
2ï¸âƒ£ é—®é¢˜å®šä½ï¼šæ£€æŸ¥é…ç½®ã€åˆ†ææ—¥å¿—
3ï¸âƒ£ åº”æ€¥å¤„ç†ï¼šæ¢å¤æœåŠ¡ã€æ‰‹åŠ¨å¤„ç†æ­»ä¿¡
4ï¸âƒ£ æ ¹å› åˆ†æï¼šæ‰¾å‡ºæ ¹æœ¬åŸå› 
5ï¸âƒ£ é¢„é˜²æªæ–½ï¼šæ”¹è¿›é…ç½®ã€ä¼˜åŒ–ç›‘æ§
```

### 7.4 å¼€å‘å»ºè®®


**ä»£ç å¼€å‘è¦ç‚¹**ï¼š
- ğŸ¯ **å¼‚å¸¸å¤„ç†åˆ†ç±»** - åŒºåˆ†å¯é‡è¯•å’Œä¸å¯é‡è¯•çš„å¼‚å¸¸
- ğŸ”„ **é‡è¯•æœºåˆ¶è®¾è®¡** - å®ç°åˆç†çš„é€€é¿é‡è¯•ç­–ç•¥
- ğŸ“ **æ—¥å¿—è®°å½•å®Œå–„** - è®°å½•è¯¦ç»†çš„æ­»ä¿¡äº§ç”Ÿå’Œå¤„ç†æ—¥å¿—
- ğŸ§ª **å……åˆ†æµ‹è¯•** - æµ‹è¯•å„ç§æ­»ä¿¡è§¦å‘åœºæ™¯

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
```
æ­»ä¿¡é˜Ÿåˆ—ä¸‰å¤§è§¦å‘ï¼šæ‹’ç»ã€è¿‡æœŸã€é˜Ÿåˆ—æ»¡
é…ç½®ä¸‰è¦ç´ ï¼šExchangeã€è·¯ç”±é”®ã€æƒé™
ç›‘æ§ä¸‰é‡ç‚¹ï¼šæ•°é‡ã€åŸå› ã€å¤„ç†æ•ˆæœ
è¿ç»´ä¸‰æ­¥èµ°ï¼šé¢„é˜²ã€å‘ç°ã€å¤„ç†
```

---

> **ğŸ’¡ æ¸©é¦¨æç¤º**  
> æ­»ä¿¡é˜Ÿåˆ—æ˜¯RabbitMQçš„å®‰å…¨ç½‘æœºåˆ¶ï¼Œæ­£ç¡®é…ç½®å’Œç›‘æ§æ­»ä¿¡é˜Ÿåˆ—èƒ½å¤Ÿå¤§å¤§æé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯è§‚æµ‹æ€§ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä¸ºæ¯ä¸ªé‡è¦çš„ä¸šåŠ¡é˜Ÿåˆ—éƒ½é…ç½®ç›¸åº”çš„æ­»ä¿¡å¤„ç†æœºåˆ¶ã€‚