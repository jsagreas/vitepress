---
title: 32ã€æ—¥å¿—åˆ†æé‡ç‚¹é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [æ—¥å¿—åˆ†æåŸºç¡€çŸ¥è¯†](#1-æ—¥å¿—åˆ†æåŸºç¡€çŸ¥è¯†)
2. [å¯åŠ¨ç›¸å…³é—®é¢˜æ’æŸ¥](#2-å¯åŠ¨ç›¸å…³é—®é¢˜æ’æŸ¥)
3. [è¿æ¥å»ºç«‹é—®é¢˜è§£å†³](#3-è¿æ¥å»ºç«‹é—®é¢˜è§£å†³)
4. [å†…å­˜ä¸ç£ç›˜å‘Šè­¦å¤„ç†](#4-å†…å­˜ä¸ç£ç›˜å‘Šè­¦å¤„ç†)
5. [é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€é—®é¢˜](#5-é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€é—®é¢˜)
6. [è®¤è¯ä¸æƒé™é—®é¢˜](#6-è®¤è¯ä¸æƒé™é—®é¢˜)
7. [æ—¥å¿—åˆ†æå®æˆ˜æŠ€å·§](#7-æ—¥å¿—åˆ†æå®æˆ˜æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“‹ æ—¥å¿—åˆ†æåŸºç¡€çŸ¥è¯†


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQæ—¥å¿—åˆ†æ


**ğŸ” ç®€å•ç†è§£**ï¼šå°±åƒåŒ»ç”Ÿçœ‹ç—…å†ä¸€æ ·ï¼Œå½“RabbitMQå‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹å®ƒçš„"ç—…å†"â€”â€”ä¹Ÿå°±æ˜¯æ—¥å¿—æ–‡ä»¶ï¼Œä»ä¸­æ‰¾å‡ºé—®é¢˜çš„åŸå› ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—åˆ†æ**
```
ç°å®åœºæ™¯ä¸¾ä¾‹ï¼š
ä½ å¼€äº†ä¸€å®¶é¤å…ï¼ˆRabbitMQæœåŠ¡ï¼‰
å®¢äººæŠ±æ€¨ä¸Šèœæ…¢ï¼ˆæ¶ˆæ¯å¤„ç†æ…¢ï¼‰
ä½ éœ€è¦æŸ¥çœ‹ï¼š
- å¨æˆ¿è®°å½•ï¼ˆå¯åŠ¨æ—¥å¿—ï¼‰â†’ çœ‹å¨æˆ¿è®¾å¤‡æ˜¯å¦æ­£å¸¸å¯åŠ¨
- è®¢å•è®°å½•ï¼ˆè¿æ¥æ—¥å¿—ï¼‰â†’ çœ‹å®¢äººç‚¹é¤æ˜¯å¦æˆåŠŸ
- åº“å­˜è®°å½•ï¼ˆå†…å­˜æ—¥å¿—ï¼‰â†’ çœ‹é£Ÿææ˜¯å¦å……è¶³
- å‘˜å·¥è®°å½•ï¼ˆé›†ç¾¤æ—¥å¿—ï¼‰â†’ çœ‹å›¢é˜Ÿåä½œæ˜¯å¦æ­£å¸¸
```

### 1.2 RabbitMQæ—¥å¿—æ–‡ä»¶ä½ç½®


**ğŸ“‚ æ—¥å¿—æ–‡ä»¶åœ¨å“ªé‡Œæ‰¾**
```
Linuxç³»ç»Ÿå¸¸è§ä½ç½®ï¼š
/var/log/rabbitmq/          â† ä¸»è¦æ—¥å¿—ç›®å½•
â”œâ”€â”€ rabbit@hostname.log     â† ä¸»è¦è¿è¡Œæ—¥å¿—
â”œâ”€â”€ rabbit@hostname_sasl.log â† ç³»ç»Ÿæ—¥å¿—
â””â”€â”€ startup_log             â† å¯åŠ¨æ—¥å¿—

Windowsç³»ç»Ÿï¼š
C:\Users\ç”¨æˆ·å\AppData\Roaming\RabbitMQ\log\

Dockerå®¹å™¨ä¸­ï¼š
/var/log/rabbitmq/
```

**ğŸ”§ å¦‚ä½•æŸ¥çœ‹æ—¥å¿—**
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—ï¼ˆæœ€å¸¸ç”¨ï¼‰
tail -f /var/log/rabbitmq/rabbit@hostname.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
tail -100 /var/log/rabbitmq/rabbit@hostname.log

# æœç´¢ç‰¹å®šé”™è¯¯ä¿¡æ¯
grep "error\|ERROR" /var/log/rabbitmq/rabbit@hostname.log
```

### 1.3 æ—¥å¿—çº§åˆ«ç†è§£


**ğŸ“Š æ—¥å¿—é‡è¦ç¨‹åº¦åˆ†çº§**

| çº§åˆ« | **å«ä¹‰** | **ä»€ä¹ˆæ—¶å€™çœ‹** | **ä¸¾ä¾‹è¯´æ˜** |
|------|---------|-------------|-------------|
| ğŸ”´ **ERROR** | `ä¸¥é‡é”™è¯¯` | `æœåŠ¡å¼‚å¸¸æ—¶å¿…çœ‹` | `è¿æ¥æ•°æ®åº“å¤±è´¥ã€ç£ç›˜ç©ºé—´ä¸è¶³` |
| ğŸŸ¡ **WARNING** | `è­¦å‘Šä¿¡æ¯` | `æ€§èƒ½ä¸‹é™æ—¶å…³æ³¨` | `å†…å­˜ä½¿ç”¨ç‡é«˜ã€è¿æ¥æ•°è¿‡å¤š` |
| ğŸ”µ **INFO** | `ä¸€èˆ¬ä¿¡æ¯` | `äº†è§£è¿è¡ŒçŠ¶æ€` | `æœåŠ¡å¯åŠ¨æˆåŠŸã€ç”¨æˆ·ç™»å½•` |
| âšª **DEBUG** | `è°ƒè¯•ä¿¡æ¯` | `å¼€å‘è°ƒè¯•æ—¶ç”¨` | `è¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹` |

---

## 2. ğŸš€ å¯åŠ¨ç›¸å…³é—®é¢˜æ’æŸ¥


### 2.1 å¯åŠ¨å¤±è´¥å¸¸è§åŸå› 


**âŒ å…¸å‹å¯åŠ¨é”™è¯¯åœºæ™¯**

```
å¯åŠ¨å¤±è´¥å°±åƒæ±½è½¦æ‰“ä¸ç€ç«ï¼š
ğŸ”§ ç«¯å£è¢«å ç”¨ â†’ è½¦ä½è¢«åˆ«çš„è½¦å äº†
ğŸ”§ é…ç½®æ–‡ä»¶é”™è¯¯ â†’ é’¥åŒ™é…ä¸ä¸Šé”
ğŸ”§ æƒé™ä¸è¶³ â†’ æ²¡æœ‰é©¾é©¶è¯
ğŸ”§ ä¾èµ–æœåŠ¡å¼‚å¸¸ â†’ æ²¡æ²¹äº†
```

### 2.2 ç«¯å£å ç”¨é—®é¢˜è§£å†³


**ğŸ” é—®é¢˜è¡¨ç°**
```
é”™è¯¯æ—¥å¿—ç¤ºä¾‹ï¼š
ERROR: Could not bind to port 5672
ERROR: eaddrinuse (address already in use)
```

**ğŸ’¡ æ’æŸ¥æ­¥éª¤**
```bash
# ç¬¬1æ­¥ï¼šæ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
netstat -tulpn | grep 5672
# æˆ–è€…ä½¿ç”¨
ss -tulpn | grep 5672

# ç¬¬2æ­¥ï¼šæŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5672

# ç¬¬3æ­¥ï¼šå¤„ç†å ç”¨è¿›ç¨‹
kill -9 è¿›ç¨‹ID
# æˆ–è€…ä¿®æ”¹RabbitMQç«¯å£é…ç½®
```

**âœ… è§£å†³æ–¹æ¡ˆ**
```bash
# æ–¹æ¡ˆ1ï¼šæ€æ‰å ç”¨è¿›ç¨‹ï¼ˆæ¨èï¼‰
sudo kill -9 $(lsof -t -i:5672)

# æ–¹æ¡ˆ2ï¼šä¿®æ”¹RabbitMQç«¯å£
# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /etc/rabbitmq/rabbitmq.conf
# æ·»åŠ å†…å®¹ï¼š
listeners.tcp.default = 5673
```

### 2.3 æƒé™é—®é¢˜è§£å†³


**ğŸ” é—®é¢˜è¡¨ç°**
```
å¸¸è§æƒé™é”™è¯¯æ—¥å¿—ï¼š
ERROR: Permission denied to create directory
ERROR: Failed to write to log file
ERROR: Cannot access database directory
```

**ğŸ’¡ åŸå› åˆ†æ**
```
æƒé™é—®é¢˜å°±åƒï¼š
ğŸ  ç”¨æˆ·æƒ³è¿›å…¥æˆ¿é—´ï¼Œä½†æ²¡æœ‰é’¥åŒ™
ğŸ“ æƒ³åœ¨æ–‡ä»¶å¤¹é‡Œå†™æ–‡ä»¶ï¼Œä½†æ²¡æœ‰å†™å…¥æƒé™
ğŸ—„ï¸ æƒ³è®¿é—®æ•°æ®åº“ï¼Œä½†æ²¡æœ‰è¯»å–æƒé™
```

**âœ… è§£å†³æ–¹æ¡ˆ**
```bash
# æ£€æŸ¥RabbitMQç”¨æˆ·å’Œç›®å½•æƒé™
ls -la /var/lib/rabbitmq/
ls -la /var/log/rabbitmq/

# ä¿®æ­£ç›®å½•æƒé™
sudo chown -R rabbitmq:rabbitmq /var/lib/rabbitmq/
sudo chown -R rabbitmq:rabbitmq /var/log/rabbitmq/
sudo chmod -R 755 /var/lib/rabbitmq/
sudo chmod -R 755 /var/log/rabbitmq/
```

### 2.4 é…ç½®æ–‡ä»¶é”™è¯¯


**ğŸ” å¸¸è§é…ç½®é”™è¯¯**
```
é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯ï¼š
- ç¼ºå°‘å¼•å·æˆ–æ‹¬å·
- å‚æ•°åæ‹¼å†™é”™è¯¯  
- æ•°å€¼æ ¼å¼ä¸æ­£ç¡®
- è·¯å¾„ä¸å­˜åœ¨
```

**âœ… é…ç½®æ–‡ä»¶æ£€æŸ¥**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
rabbitmq-diagnostics check_config_schema

# æŸ¥çœ‹å½“å‰æœ‰æ•ˆé…ç½®
rabbitmq-diagnostics environment

# é‡ç½®ä¸ºé»˜è®¤é…ç½®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
sudo mv /etc/rabbitmq/rabbitmq.conf /etc/rabbitmq/rabbitmq.conf.bak
```

---

## 3. ğŸ”Œ è¿æ¥å»ºç«‹é—®é¢˜è§£å†³


### 3.1 è¿æ¥å¤±è´¥åŸå› åˆ†æ


**ğŸ” è¿æ¥å¤±è´¥å°±åƒæ‰“ç”µè¯æ‰“ä¸é€š**
```
å¸¸è§è¿æ¥é—®é¢˜ï¼š
ğŸ“ å·ç é”™è¯¯ â†’ IPåœ°å€æˆ–ç«¯å£é”™è¯¯
ğŸ“ å¯¹æ–¹å…³æœº â†’ RabbitMQæœåŠ¡æœªå¯åŠ¨
ğŸ“ ä¿¡å·ä¸å¥½ â†’ ç½‘ç»œè¿æ¥é—®é¢˜
ğŸ“ å¿™çº¿ä¸­ â†’ è¿æ¥æ•°è¶…é™
ğŸ“ è¢«æ‹‰é»‘ â†’ è®¤è¯æˆ–æƒé™é—®é¢˜
```

### 3.2 ç½‘ç»œè¿æ¥é—®é¢˜æ’æŸ¥


**ğŸ” é—®é¢˜è¡¨ç°**
```
è¿æ¥å¤±è´¥æ—¥å¿—ç¤ºä¾‹ï¼š
ERROR: Connection refused by server
ERROR: Timeout waiting for connection
ERROR: Network unreachable
```

**ğŸ’¡ æ’æŸ¥ç½‘ç»œè¿é€šæ€§**
```bash
# ç¬¬1æ­¥ï¼šæ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status rabbitmq-server

# ç¬¬2æ­¥ï¼šæ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tulpn | grep :5672

# ç¬¬3æ­¥ï¼šæµ‹è¯•ç½‘ç»œè¿é€šæ€§
telnet rabbitmqæœåŠ¡å™¨IP 5672
# æˆ–è€…
nc -zv rabbitmqæœåŠ¡å™¨IP 5672

# ç¬¬4æ­¥ï¼šæ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
sudo iptables -L
```

**âœ… ç½‘ç»œé—®é¢˜è§£å†³**
```bash
# å¼€æ”¾RabbitMQç«¯å£
sudo ufw allow 5672
sudo ufw allow 15672  # ç®¡ç†ç•Œé¢ç«¯å£

# æˆ–è€…ä½¿ç”¨iptables
sudo iptables -A INPUT -p tcp --dport 5672 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 15672 -j ACCEPT
```

### 3.3 è¿æ¥æ•°é™åˆ¶é—®é¢˜


**ğŸ” é—®é¢˜è¡¨ç°**
```
è¿æ¥æ•°è¶…é™æ—¥å¿—ï¼š
ERROR: Maximum number of connections reached
WARNING: High connection count: 900 connections
```

**ğŸ’¡ è¿æ¥æ•°ç®¡ç†ç­–ç•¥**
```
è¿æ¥æ•°å°±åƒé¤å…åº§ä½ï¼š
ğŸª‘ åº§ä½æœ‰é™ â†’ æœ€å¤§è¿æ¥æ•°é™åˆ¶
ğŸª‘ æ’é˜Ÿç­‰ä½ â†’ è¿æ¥é˜Ÿåˆ—
ğŸª‘ é¢„çº¦åº§ä½ â†’ è¿æ¥æ± ç®¡ç†
ğŸª‘ å¢åŠ åº§ä½ â†’ è°ƒæ•´è¿æ¥æ•°é™åˆ¶
```

**âœ… è¿æ¥æ•°ä¼˜åŒ–**
```bash
# æŸ¥çœ‹å½“å‰è¿æ¥æ•°
rabbitmqctl list_connections

# æŸ¥çœ‹è¿æ¥æ•°é™åˆ¶
rabbitmqctl eval 'rabbit_networking:connection_info_all().'

# è°ƒæ•´è¿æ¥æ•°é™åˆ¶ï¼ˆé…ç½®æ–‡ä»¶ï¼‰
# /etc/rabbitmq/rabbitmq.conf
num_acceptors.tcp = 10
tcp_listen_options.backlog = 128
```

**ğŸ”§ è¿æ¥æ± é…ç½®ç¤ºä¾‹**
```python
# Pythonå®¢æˆ·ç«¯è¿æ¥æ± é…ç½®
import pika
from pika.pool import QueuedPool

# è¿æ¥å‚æ•°
connection_params = pika.ConnectionParameters(
    host='localhost',
    port=5672,
    heartbeat=600,          # å¿ƒè·³é—´éš”
    blocked_connection_timeout=300,  # é˜»å¡è¶…æ—¶
)

# åˆ›å»ºè¿æ¥æ± 
pool = QueuedPool(
    create_function=lambda: pika.BlockingConnection(connection_params),
    max_size=10,           # æœ€å¤§è¿æ¥æ•°
    max_overflow=0,        # è¶…å‡ºæ—¶çš„é¢å¤–è¿æ¥æ•°
    timeout=10,            # è·å–è¿æ¥è¶…æ—¶æ—¶é—´
    recycle=-1,           # è¿æ¥å›æ”¶æ—¶é—´
)
```

---

## 4. ğŸ’¾ å†…å­˜ä¸ç£ç›˜å‘Šè­¦å¤„ç†


### 4.1 å†…å­˜ä½¿ç”¨å‘Šè­¦


**ğŸ” å†…å­˜å‘Šè­¦çš„å«ä¹‰**
```
å†…å­˜å‘Šè­¦å°±åƒæ‰‹æœºå­˜å‚¨ç©ºé—´ä¸è¶³ï¼š
ğŸ“± ç…§ç‰‡å¤ªå¤š â†’ æ¶ˆæ¯ç§¯å‹å¤ªå¤š
ğŸ“± åº”ç”¨å ç”¨å¤§ â†’ é˜Ÿåˆ—å ç”¨å†…å­˜å¤§
ğŸ“± ç¼“å­˜æœªæ¸…ç† â†’ å†…å­˜æ³„æ¼
ğŸ“± éœ€è¦æ¸…ç†ç©ºé—´ â†’ éœ€è¦é‡Šæ”¾å†…å­˜
```

**ğŸš¨ å†…å­˜å‘Šè­¦æ—¥å¿—ç¤ºä¾‹**
```
WARNING: Memory usage is above threshold
ERROR: VM memory high watermark reached
WARNING: Free disk space is low
ERROR: Disk space is critically low
```

### 4.2 å†…å­˜ä½¿ç”¨åˆ†æ


**ğŸ“Š å†…å­˜ä½¿ç”¨æƒ…å†µæŸ¥çœ‹**
```bash
# æŸ¥çœ‹æ•´ä½“å†…å­˜ä½¿ç”¨æƒ…å†µ
rabbitmqctl status | grep memory

# è¯¦ç»†å†…å­˜ä½¿ç”¨åˆ†æ
rabbitmqctl eval 'rabbit_vm:memory().'

# æŸ¥çœ‹å„ä¸ªç»„ä»¶å†…å­˜å ç”¨
rabbitmqctl list_queues name memory messages
```

**ğŸ’¡ å†…å­˜å ç”¨åˆ†æ**
```
RabbitMQå†…å­˜ä¸»è¦ç”¨äºï¼š
ğŸ§  æ¶ˆæ¯å­˜å‚¨ â†’ é˜Ÿåˆ—ä¸­æœªå¤„ç†çš„æ¶ˆæ¯
ğŸ§  è¿æ¥ç®¡ç† â†’ å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯
ğŸ§  è·¯ç”±è¡¨ â†’ Exchangeå’ŒBindingä¿¡æ¯
ğŸ§  ç»Ÿè®¡æ•°æ® â†’ ç›‘æ§å’Œç®¡ç†æ•°æ®
ğŸ§  ç³»ç»Ÿç¼“å­˜ â†’ æé«˜æ€§èƒ½çš„ç¼“å­˜
```

### 4.3 å†…å­˜å‘Šè­¦è§£å†³æ–¹æ¡ˆ


**âœ… ç«‹å³é‡Šæ”¾å†…å­˜çš„æ–¹æ³•**
```bash
# æ–¹æ³•1ï¼šæ¸…ç†ç©ºé˜Ÿåˆ—
rabbitmqctl list_queues | grep " 0 0$" | awk '{print $1}' | xargs -I {} rabbitmqctl delete_queue {}

# æ–¹æ³•2ï¼šé‡å¯é«˜å†…å­˜å ç”¨çš„è¿æ¥
rabbitmqctl list_connections pid recv_oct send_oct state | grep running | head -5

# æ–¹æ³•3ï¼šå¼ºåˆ¶åƒåœ¾å›æ”¶
rabbitmqctl eval 'garbage_collect().'
```

**ğŸ”§ é…ç½®å†…å­˜é™åˆ¶**
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶ /etc/rabbitmq/rabbitmq.conf
vm_memory_high_watermark.relative = 0.6  # è®¾ç½®ä¸º60%
vm_memory_high_watermark_paging_ratio = 0.5  # åˆ†é¡µæ¯”ä¾‹

# æˆ–è€…ä½¿ç”¨ç»å¯¹å€¼
vm_memory_high_watermark.absolute = 2GB
```

### 4.4 ç£ç›˜ç©ºé—´ç®¡ç†


**ğŸ” ç£ç›˜ç©ºé—´æ£€æŸ¥**
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h /var/lib/rabbitmq/

# æŸ¥çœ‹RabbitMQæ•°æ®ç›®å½•å¤§å°
du -sh /var/lib/rabbitmq/

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°
du -sh /var/log/rabbitmq/
```

**âœ… ç£ç›˜ç©ºé—´æ¸…ç†**
```bash
# æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
find /var/log/rabbitmq/ -name "*.log.*" -mtime +7 -delete

# å‹ç¼©å†å²æ—¥å¿—
gzip /var/log/rabbitmq/*.log.1

# è®¾ç½®æ—¥å¿—è½®è½¬
sudo nano /etc/logrotate.d/rabbitmq-server
```

**ğŸ”§ ç£ç›˜å‘Šè­¦é…ç½®**
```bash
# é…ç½®ç£ç›˜ç©ºé—´å‘Šè­¦é˜ˆå€¼
disk_free_limit.absolute = 2GB
disk_free_limit.relative = 1.0  # ç›¸å¯¹äºå†…å­˜å¤§å°çš„å€æ•°
```

---

## 5. ğŸŒ é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€é—®é¢˜


### 5.1 é›†ç¾¤åŸºç¡€æ¦‚å¿µ


**ğŸ” é›†ç¾¤å°±åƒå›¢é˜Ÿåˆä½œ**
```
RabbitMQé›†ç¾¤åƒä¸€ä¸ªå·¥ä½œå›¢é˜Ÿï¼š
ğŸ‘¥ å¤šä¸ªèŠ‚ç‚¹ â†’ å¤šä¸ªå›¢é˜Ÿæˆå‘˜
ğŸ‘¥ å…±äº«ä»»åŠ¡ â†’ å…±äº«é˜Ÿåˆ—å’Œæ¶ˆæ¯
ğŸ‘¥ ååŒå·¥ä½œ â†’ æ•°æ®åŒæ­¥
ğŸ‘¥ æ•…éšœè½¬ç§» â†’ æˆå‘˜ç¦»å¼€æ—¶å…¶ä»–äººæ¥æ‰‹
ğŸ‘¥ çŠ¶æ€åŒæ­¥ â†’ ä¿¡æ¯å…±äº«
```

### 5.2 é›†ç¾¤çŠ¶æ€æ£€æŸ¥


**ğŸ“Š é›†ç¾¤çŠ¶æ€æŸ¥çœ‹å‘½ä»¤**
```bash
# æŸ¥çœ‹é›†ç¾¤æ•´ä½“çŠ¶æ€
rabbitmqctl cluster_status

# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
rabbitmqctl eval 'rabbit_nodes:all().'

# æ£€æŸ¥èŠ‚ç‚¹å¥åº·çŠ¶æ€
rabbitmqctl node_health_check

# æŸ¥çœ‹åˆ†åŒºä¿¡æ¯
rabbitmqctl eval 'rabbit_node_monitor:partitions().'
```

**ğŸ’¡ çŠ¶æ€è§£è¯»**
```
é›†ç¾¤çŠ¶æ€ä¿¡æ¯è§£è¯»ï¼š
ğŸŸ¢ running â†’ èŠ‚ç‚¹æ­£å¸¸è¿è¡Œ
ğŸŸ¡ down â†’ èŠ‚ç‚¹ç¦»çº¿ä½†å¯æ¢å¤
ğŸ”´ partitioned â†’ ç½‘ç»œåˆ†åŒºï¼Œéœ€è¦ä¿®å¤
âšª stopped â†’ èŠ‚ç‚¹å·²åœæ­¢
```

### 5.3 ç½‘ç»œåˆ†åŒºé—®é¢˜


**ğŸ” ä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒº**
```
ç½‘ç»œåˆ†åŒºåƒå›¢é˜Ÿå¤±è”ï¼š
ğŸ“ Aç»„å’ŒBç»„æ— æ³•é€šä¿¡ â†’ ç½‘ç»œåˆ†åŒº
ğŸ“ å„ç»„ä»¥ä¸ºå¯¹æ–¹ç¦»çº¿ â†’ è„‘è£‚ç°è±¡
ğŸ“ ç‹¬ç«‹å¤„ç†ä»»åŠ¡ â†’ æ•°æ®ä¸ä¸€è‡´
ğŸ“ æ¢å¤é€šä¿¡åå†²çª â†’ éœ€è¦æ‰‹åŠ¨ä¿®å¤
```

**ğŸš¨ åˆ†åŒºæ£€æµ‹**
```bash
# æ£€æŸ¥æ˜¯å¦å­˜åœ¨åˆ†åŒº
rabbitmqctl eval 'rabbit_node_monitor:partitions().'

# æŸ¥çœ‹é›†ç¾¤ä¸­çš„åˆ†åŒºæƒ…å†µ
rabbitmqctl cluster_status | grep partitions
```

**âœ… åˆ†åŒºä¿®å¤**
```bash
# æ–¹æ³•1ï¼šé‡å¯åˆ†åŒºèŠ‚ç‚¹ï¼ˆæ¨èï¼‰
sudo systemctl stop rabbitmq-server
sudo systemctl start rabbitmq-server

# æ–¹æ³•2ï¼šæ‰‹åŠ¨ä¿®å¤åˆ†åŒº
rabbitmqctl stop_app
rabbitmqctl join_cluster rabbit@ä¸»èŠ‚ç‚¹å
rabbitmqctl start_app

# æ–¹æ³•3ï¼šå¿½ç•¥åˆ†åŒºï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
rabbitmqctl forget_cluster_node rabbit@é—®é¢˜èŠ‚ç‚¹å
```

### 5.4 èŠ‚ç‚¹åŒæ­¥é—®é¢˜


**ğŸ” åŒæ­¥å¤±è´¥çš„åŸå› **
```
èŠ‚ç‚¹åŒæ­¥å°±åƒå›¢é˜Ÿä¿¡æ¯å…±äº«ï¼š
ğŸ“‹ æ–°æˆå‘˜åŠ å…¥ â†’ éœ€è¦è·å–æœ€æ–°ä¿¡æ¯
ğŸ“‹ ç½‘ç»œå»¶è¿Ÿ â†’ ä¿¡æ¯ä¼ é€’æ…¢
ğŸ“‹ æ•°æ®å†²çª â†’ ç‰ˆæœ¬ä¸ä¸€è‡´
ğŸ“‹ æƒé™é—®é¢˜ â†’ æ— æ³•è®¿é—®å…±äº«èµ„æº
```

**âœ… åŒæ­¥ä¿®å¤æ–¹æ³•**
```bash
# å¼ºåˆ¶åŒæ­¥é˜Ÿåˆ—
rabbitmqctl sync_queue é˜Ÿåˆ—å

# åŒæ­¥æ‰€æœ‰é˜Ÿåˆ—
rabbitmqctl eval 'rabbit_mirror_queue_sync:sync_all().'

# æ£€æŸ¥åŒæ­¥çŠ¶æ€
rabbitmqctl list_queues name slave_pids synchronised_slave_pids
```

---

## 6. ğŸ” è®¤è¯ä¸æƒé™é—®é¢˜


### 6.1 è®¤è¯å¤±è´¥é—®é¢˜


**ğŸ” è®¤è¯å°±åƒé—¨ç¦ç³»ç»Ÿ**
```
RabbitMQè®¤è¯åƒåŠå…¬æ¥¼é—¨ç¦ï¼š
ğŸ¢ åˆ·å¡è¿›å…¥ â†’ ç”¨æˆ·åå¯†ç éªŒè¯
ğŸ¢ æƒé™ä¸è¶³ â†’ æ— æ³•è®¿é—®ç‰¹å®šåŒºåŸŸ
ğŸ¢ å¡ç‰‡å¤±æ•ˆ â†’ è´¦å·è¿‡æœŸæˆ–è¢«ç¦ç”¨
ğŸ¢ æƒé™å˜æ›´ â†’ è§’è‰²å’Œæƒé™ä¿®æ”¹
```

**ğŸš¨ è®¤è¯å¤±è´¥æ—¥å¿—**
```
å¸¸è§è®¤è¯é”™è¯¯æ—¥å¿—ï¼š
ERROR: Authentication failed for user 'username'
ERROR: Access refused for user 'username' to vhost '/'
WARNING: Invalid credentials provided
ERROR: Connection denied due to authentication failure
```

### 6.2 ç”¨æˆ·ç®¡ç†æ“ä½œ


**ğŸ‘¤ ç”¨æˆ·è´¦å·ç®¡ç†**
```bash
# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
rabbitmqctl list_users

# åˆ›å»ºæ–°ç”¨æˆ·
rabbitmqctl add_user ç”¨æˆ·å å¯†ç 

# ä¿®æ”¹ç”¨æˆ·å¯†ç 
rabbitmqctl change_password ç”¨æˆ·å æ–°å¯†ç 

# åˆ é™¤ç”¨æˆ·
rabbitmqctl delete_user ç”¨æˆ·å

# è®¾ç½®ç”¨æˆ·è§’è‰²
rabbitmqctl set_user_tags ç”¨æˆ·å administrator
```

**ğŸ’¡ ç”¨æˆ·è§’è‰²è¯´æ˜**
```
RabbitMQç”¨æˆ·è§’è‰²å±‚çº§ï¼š
ğŸ‘‘ administrator â†’ è¶…çº§ç®¡ç†å‘˜ï¼Œå¯ä»¥åšä»»ä½•æ“ä½œ
ğŸ› ï¸ management â†’ ç®¡ç†å‘˜ï¼Œå¯ä»¥ç®¡ç†è‡ªå·±èƒ½è®¿é—®çš„vhost
ğŸ“Š policymaker â†’ ç­–ç•¥åˆ¶å®šè€…ï¼Œå¯ä»¥è®¾ç½®ç­–ç•¥
ğŸ” monitoring â†’ ç›‘æ§è€…ï¼Œåªèƒ½æŸ¥çœ‹ä¿¡æ¯
âšª none â†’ æ™®é€šç”¨æˆ·ï¼Œåªèƒ½è¿æ¥åº”ç”¨
```

### 6.3 æƒé™é…ç½®è¯¦è§£


**ğŸ”§ è™šæ‹Ÿä¸»æœºæƒé™ç®¡ç†**
```bash
# æŸ¥çœ‹è™šæ‹Ÿä¸»æœº
rabbitmqctl list_vhosts

# åˆ›å»ºè™šæ‹Ÿä¸»æœº
rabbitmqctl add_vhost /dev

# æŸ¥çœ‹ç”¨æˆ·æƒé™
rabbitmqctl list_permissions -p /

# è®¾ç½®ç”¨æˆ·æƒé™
rabbitmqctl set_permissions -p / ç”¨æˆ·å ".*" ".*" ".*"
# æ ¼å¼ï¼šconfigureæƒé™ writeæƒé™ readæƒé™
```

**ğŸ’¡ æƒé™å«ä¹‰è§£é‡Š**
```
æƒé™ä¸‰å…ƒç»„è§£é‡Šï¼š
ğŸ”§ configure â†’ åˆ›å»ºå’Œåˆ é™¤é˜Ÿåˆ—ã€äº¤æ¢å™¨
âœï¸ write â†’ å‘å¸ƒæ¶ˆæ¯åˆ°äº¤æ¢å™¨
ğŸ‘ï¸ read â†’ ä»é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯

æƒé™æ­£åˆ™è¡¨è¾¾å¼ï¼š
".*" â†’ å…è®¸æ‰€æœ‰æ“ä½œ
"^prefix_.*" â†’ åªå…è®¸ä»¥prefix_å¼€å¤´çš„èµ„æº
"" â†’ ä¸å…è®¸ä»»ä½•æ“ä½œ
```

### 6.4 æƒé™é—®é¢˜æ’æŸ¥


**ğŸ” æƒé™æ£€æŸ¥æ­¥éª¤**
```bash
# ç¬¬1æ­¥ï¼šç¡®è®¤ç”¨æˆ·å­˜åœ¨
rabbitmqctl list_users | grep ç”¨æˆ·å

# ç¬¬2æ­¥ï¼šæ£€æŸ¥ç”¨æˆ·è§’è‰²
rabbitmqctl list_users | grep ç”¨æˆ·å

# ç¬¬3æ­¥ï¼šæ£€æŸ¥vhostæƒé™
rabbitmqctl list_permissions -p vhostå

# ç¬¬4æ­¥ï¼šæµ‹è¯•è¿æ¥
rabbitmqctl eval 'rabbit_auth_backend_internal:check_user_login(<<"ç”¨æˆ·å">>, []).'
```

**âœ… æƒé™ä¿®å¤ç¤ºä¾‹**
```bash
# å¸¸è§æƒé™ä¿®å¤æ“ä½œ
# ç»™ç”¨æˆ·å®Œå…¨æƒé™
rabbitmqctl set_permissions -p / myuser ".*" ".*" ".*"

# ç»™ç”¨æˆ·ç®¡ç†å‘˜è§’è‰²
rabbitmqctl set_user_tags myuser administrator

# é‡ç½®guestç”¨æˆ·ï¼ˆä»…é™æœ¬åœ°è®¿é—®ï¼‰
rabbitmqctl change_password guest guest
rabbitmqctl set_user_tags guest administrator
```

---

## 7. ğŸ”¬ æ—¥å¿—åˆ†æå®æˆ˜æŠ€å·§


### 7.1 æ—¥å¿—åˆ†æå·¥å…·å’ŒæŠ€å·§


**ğŸ› ï¸ å¸¸ç”¨åˆ†æå‘½ä»¤**
```bash
# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f /var/log/rabbitmq/rabbit@hostname.log

# æŒ‰æ—¶é—´æ®µæŸ¥çœ‹æ—¥å¿—
sed -n '/2024-09-20 10:00/,/2024-09-20 11:00/p' rabbit@hostname.log

# ç»Ÿè®¡é”™è¯¯æ¬¡æ•°
grep -c "ERROR" /var/log/rabbitmq/rabbit@hostname.log

# æŸ¥æ‰¾ç‰¹å®šé”™è¯¯æ¨¡å¼
grep -E "(connection_closed_abruptly|timeout)" rabbit@hostname.log
```

### 7.2 æ€§èƒ½åˆ†æå…³é”®æŒ‡æ ‡


**ğŸ“Š å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```
é‡è¦ç›‘æ§æŒ‡æ ‡ï¼š
ğŸ“ˆ æ¶ˆæ¯å‘å¸ƒé€Ÿç‡ â†’ messages/second
ğŸ“ˆ æ¶ˆæ¯æ¶ˆè´¹é€Ÿç‡ â†’ ack/second  
ğŸ“ˆ é˜Ÿåˆ—é•¿åº¦ â†’ ç§¯å‹æ¶ˆæ¯æ•°é‡
ğŸ“ˆ è¿æ¥æ•° â†’ å¹¶å‘è¿æ¥æ•°é‡
ğŸ“ˆ å†…å­˜ä½¿ç”¨ç‡ â†’ memory usage %
ğŸ“ˆ ç£ç›˜ä½¿ç”¨ç‡ â†’ disk usage %
```

**ğŸ” æ€§èƒ½é—®é¢˜å®šä½**
```bash
# æŸ¥çœ‹æ¶ˆæ¯é€Ÿç‡
rabbitmqctl list_queues name messages_ready message_rates

# ç›‘æ§è¿æ¥æ€§èƒ½
rabbitmqctl list_connections recv_oct send_oct state

# æŸ¥çœ‹äº¤æ¢å™¨ç»Ÿè®¡
rabbitmqctl list_exchanges name message_stats.publish_in
```

### 7.3 æ—¥å¿—è½®è½¬å’Œæ¸…ç†


**ğŸ”„ æ—¥å¿—ç®¡ç†ç­–ç•¥**
```bash
# é…ç½®æ—¥å¿—è½®è½¬ /etc/logrotate.d/rabbitmq-server
/var/log/rabbitmq/*.log {
    weekly          # æ¯å‘¨è½®è½¬
    rotate 52       # ä¿ç•™52å‘¨
    compress        # å‹ç¼©æ—§æ—¥å¿—
    delaycompress   # å»¶è¿Ÿå‹ç¼©
    missingok       # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    notifempty      # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 0644 rabbitmq rabbitmq  # åˆ›å»ºæ–°æ–‡ä»¶æƒé™
}
```

**ğŸ§¹ æ‰‹åŠ¨æ¸…ç†æ—¥å¿—**
```bash
# æ¸…ç†7å¤©å‰çš„æ—¥å¿—
find /var/log/rabbitmq/ -name "*.log.*" -mtime +7 -delete

# æ¸…ç†å¤§äº100MBçš„æ—¥å¿—æ–‡ä»¶
find /var/log/rabbitmq/ -name "*.log" -size +100M -exec truncate -s 0 {} \;

# å‹ç¼©å½“å‰æ—¥å¿—
gzip /var/log/rabbitmq/rabbit@hostname.log.1
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ’æŸ¥æ€è·¯


```
ğŸ” é—®é¢˜æ’æŸ¥ä¸‡èƒ½ä¸‰æ­¥æ³•ï¼š
ç¬¬1æ­¥ï¼šçœ‹ç°è±¡ â†’ æ”¶é›†é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
ç¬¬2æ­¥ï¼šæ‰¾åŸå›  â†’ åˆ†ææ—¥å¿—ç¡®å®šæ ¹æœ¬åŸå›   
ç¬¬3æ­¥ï¼šè§£é—®é¢˜ â†’ åº”ç”¨å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ
```

### 8.2 å¸¸è§é—®é¢˜å¿«é€Ÿå®šä½


**ğŸ“‹ é—®é¢˜åˆ†ç±»é€ŸæŸ¥è¡¨**

| é—®é¢˜ç±»å‹ | **å…³é”®è¯** | **æŸ¥çœ‹ä½ç½®** | **è§£å†³æ–¹å‘** |
|---------|-----------|-------------|-------------|
| ğŸš€ **å¯åŠ¨å¤±è´¥** | `eaddrinuse, permission denied` | `startup_log` | `ç«¯å£ã€æƒé™ã€é…ç½®` |
| ğŸ”Œ **è¿æ¥é—®é¢˜** | `connection refused, timeout` | `ä¸»æ—¥å¿—æ–‡ä»¶` | `ç½‘ç»œã€é˜²ç«å¢™ã€æœåŠ¡çŠ¶æ€` |
| ğŸ’¾ **èµ„æºå‘Šè­¦** | `memory high, disk space low` | `ä¸»æ—¥å¿—æ–‡ä»¶` | `æ¸…ç†ã€æ‰©å®¹ã€é…ç½®è°ƒæ•´` |
| ğŸŒ **é›†ç¾¤é—®é¢˜** | `partitioned, node down` | `é›†ç¾¤çŠ¶æ€å‘½ä»¤` | `ç½‘ç»œã€åŒæ­¥ã€é‡å¯` |
| ğŸ” **è®¤è¯æƒé™** | `authentication failed, access refused` | `ä¸»æ—¥å¿—æ–‡ä»¶` | `ç”¨æˆ·ã€è§’è‰²ã€æƒé™` |

### 8.3 é¢„é˜²æ€§ç»´æŠ¤å»ºè®®


**ğŸ›¡ï¸ æ—¥å¸¸ç»´æŠ¤æ¸…å•**
```
æ¯æ—¥æ£€æŸ¥ï¼š
âœ… æœåŠ¡çŠ¶æ€æ˜¯å¦æ­£å¸¸
âœ… é”™è¯¯æ—¥å¿—æ˜¯å¦æœ‰æ–°å¢
âœ… å†…å­˜å’Œç£ç›˜ä½¿ç”¨ç‡
âœ… è¿æ¥æ•°å’Œæ¶ˆæ¯ç§¯å‹æƒ…å†µ

æ¯å‘¨ç»´æŠ¤ï¼š
âœ… æ¸…ç†è¿‡æœŸæ—¥å¿—æ–‡ä»¶
âœ… æ£€æŸ¥é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€
âœ… å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶
âœ… æ›´æ–°ç›‘æ§é˜ˆå€¼

æ¯æœˆç»´æŠ¤ï¼š
âœ… åˆ†ææ€§èƒ½è¶‹åŠ¿
âœ… ä¼˜åŒ–é…ç½®å‚æ•°
âœ… æ£€æŸ¥å®‰å…¨ç­–ç•¥
âœ… è®¡åˆ’å®¹é‡æ‰©å±•
```

### 8.4 ç´§æ€¥æ•…éšœå¤„ç†æµç¨‹


**ğŸš¨ æ•…éšœåº”æ€¥å¤„ç†æ­¥éª¤**
```
ç´§æ€¥æ•…éšœå¤„ç†SOPï¼š

1ï¸âƒ£ ç«‹å³å“åº”ï¼ˆ2åˆ†é’Ÿå†…ï¼‰
   - ç¡®è®¤æ•…éšœèŒƒå›´å’Œå½±å“
   - æŸ¥çœ‹å®æ—¶æ—¥å¿—å’Œç›‘æ§

2ï¸âƒ£ å¿«é€Ÿè¯Šæ–­ï¼ˆ5åˆ†é’Ÿå†…ï¼‰  
   - æ£€æŸ¥æœåŠ¡çŠ¶æ€
   - åˆ†æå…³é”®é”™è¯¯æ—¥å¿—
   - ç¡®å®šæ•…éšœç±»å‹

3ï¸âƒ£ åº”æ€¥å¤„ç†ï¼ˆ10åˆ†é’Ÿå†…ï¼‰
   - é‡å¯æœåŠ¡ï¼ˆå¦‚æœå®‰å…¨ï¼‰
   - åˆ‡æ¢å¤‡ç”¨èŠ‚ç‚¹
   - ä¸´æ—¶æ‰©å®¹èµ„æº

4ï¸âƒ£ æ ¹æœ¬ä¿®å¤ï¼ˆ30åˆ†é’Ÿå†…ï¼‰
   - åº”ç”¨å…·ä½“è§£å†³æ–¹æ¡ˆ
   - éªŒè¯ä¿®å¤æ•ˆæœ
   - æ¢å¤æ­£å¸¸æœåŠ¡

5ï¸âƒ£ æ€»ç»“æ”¹è¿›ï¼ˆ1å°æ—¶å†…ï¼‰
   - è®°å½•æ•…éšœåŸå› 
   - æ›´æ–°ç›‘æ§é˜ˆå€¼
   - å®Œå–„é¢„é˜²æªæ–½
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ—¥å¿—åˆ†ææ‰¾æ ¹å› ï¼Œç°è±¡åŸå› è§£å†³å…¨
- å¯åŠ¨è¿æ¥èµ„æºæƒï¼Œé›†ç¾¤èŠ‚ç‚¹çŠ¶æ€æ£€
- ç›‘æ§æ¸…ç†é˜²ä¸ºå…ˆï¼Œåº”æ€¥æµç¨‹è®°å¿ƒé—´
- å·¥å…·å‘½ä»¤è¦ç†Ÿç»ƒï¼Œæ’æŸ¥æ€è·¯è¦æ¸…æ™°