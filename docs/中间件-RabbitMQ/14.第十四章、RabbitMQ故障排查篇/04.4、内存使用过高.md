---
title: 4ã€å†…å­˜ä½¿ç”¨è¿‡é«˜
---
## ğŸ“š ç›®å½•

1. [å†…å­˜ä½¿ç”¨è¿‡é«˜é—®é¢˜æ¦‚è¿°](#1-å†…å­˜ä½¿ç”¨è¿‡é«˜é—®é¢˜æ¦‚è¿°)
2. [å†…å­˜å ç”¨çš„ä¸»è¦åŸå› ](#2-å†…å­˜å ç”¨çš„ä¸»è¦åŸå› )
3. [å†…å­˜é—®é¢˜è¯Šæ–­æ–¹æ³•](#3-å†…å­˜é—®é¢˜è¯Šæ–­æ–¹æ³•)
4. [é˜Ÿåˆ—æ¶ˆæ¯ç§¯å‹å¤„ç†](#4-é˜Ÿåˆ—æ¶ˆæ¯ç§¯å‹å¤„ç†)
5. [æ¶ˆè´¹è€…æ€§èƒ½ä¼˜åŒ–](#5-æ¶ˆè´¹è€…æ€§èƒ½ä¼˜åŒ–)
6. [å†…å­˜é…ç½®ä¸ä¼˜åŒ–](#6-å†…å­˜é…ç½®ä¸ä¼˜åŒ–)
7. [ç›‘æ§ä¸é¢„é˜²æªæ–½](#7-ç›‘æ§ä¸é¢„é˜²æªæ–½)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å†…å­˜ä½¿ç”¨è¿‡é«˜é—®é¢˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯RabbitMQå†…å­˜ä½¿ç”¨è¿‡é«˜


**ç®€å•ç†è§£**ï¼šRabbitMQå°±åƒä¸€ä¸ªé‚®å±€ï¼Œå½“é‚®ä»¶å¤ªå¤šã€å¤„ç†å¤ªæ…¢æˆ–è€…é…ç½®ä¸å½“æ—¶ï¼Œé‚®å±€å°±ä¼š"è£…ä¸ä¸‹"ï¼Œå¯¼è‡´å†…å­˜ä½¿ç”¨è¿‡é«˜ã€‚

**ğŸ¯ å…¸å‹è¡¨ç°**ï¼š
- RabbitMQæœåŠ¡å™¨å“åº”å˜æ…¢
- æ¶ˆæ¯å‘é€å¤±è´¥æˆ–è¶…æ—¶
- ç³»ç»Ÿå‡ºç°å†…å­˜å‘Šè­¦
- æœåŠ¡å¯èƒ½å´©æºƒé‡å¯

**â­ ä¸¥é‡ç¨‹åº¦**ï¼šğŸ”´ **é«˜å±é—®é¢˜** - å¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­

### 1.2 å†…å­˜é—®é¢˜çš„å½±å“


**å¯¹ç³»ç»Ÿçš„å½±å“**ï¼š
```
æœåŠ¡å™¨å±‚é¢ï¼š
â€¢ å†…å­˜ä¸è¶³å¯¼è‡´ç³»ç»Ÿå˜æ…¢
â€¢ å¯èƒ½è§¦å‘æ“ä½œç³»ç»ŸOOMæ€è¿›ç¨‹
â€¢ å½±å“å…¶ä»–æœåŠ¡çš„æ­£å¸¸è¿è¡Œ

åº”ç”¨å±‚é¢ï¼š
â€¢ æ¶ˆæ¯å¤„ç†å»¶è¿Ÿå¢åŠ 
â€¢ æ¶ˆæ¯ä¸¢å¤±é£é™©ä¸Šå‡
â€¢ ç”¨æˆ·ä½“éªŒä¸¥é‡ä¸‹é™
```

**ä¸šåŠ¡å½±å“**ï¼š
- ğŸ“‰ **æ€§èƒ½ä¸‹é™**ï¼šæ¶ˆæ¯å¤„ç†å˜æ…¢
- ğŸš¨ **æœåŠ¡ä¸­æ–­**ï¼šä¸¥é‡æ—¶å¯èƒ½åœæœ
- ğŸ’° **æˆæœ¬å¢åŠ **ï¼šéœ€è¦ç´§æ€¥æ‰©å®¹

---

## 2. ğŸ” å†…å­˜å ç”¨çš„ä¸»è¦åŸå› 


### 2.1 é˜Ÿåˆ—æ¶ˆæ¯ç§¯å‹è¿‡å¤š


**ğŸ”¸ é—®é¢˜æè¿°**ï¼šæ¶ˆæ¯ç”Ÿäº§é€Ÿåº¦ > æ¶ˆè´¹é€Ÿåº¦ï¼Œå¯¼è‡´æ¶ˆæ¯å †ç§¯

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
æƒ³è±¡ä¸€ä¸ªå¿«é¤åº—ï¼š
â€¢ ç‚¹é¤çš„äººå¾ˆå¤šï¼ˆç”Ÿäº§è€…å‘æ¶ˆæ¯ï¼‰
â€¢ åšèœçš„å¨å¸ˆåªæœ‰1ä¸ªï¼ŒåŠ¨ä½œå¾ˆæ…¢ï¼ˆæ¶ˆè´¹è€…å¤„ç†æ…¢ï¼‰
â€¢ è®¢å•è¶Šå †è¶Šå¤šï¼Œå¨æˆ¿è¢«è®¢å•å•æ®å æ»¡ï¼ˆé˜Ÿåˆ—ç§¯å‹ï¼‰
```

**å¸¸è§åœºæ™¯**ï¼š
- **ä¿ƒé”€æ´»åŠ¨**ï¼šè®¢å•é‡çªç„¶æš´å¢
- **ç³»ç»Ÿæ•…éšœ**ï¼šæ¶ˆè´¹è€…æœåŠ¡æŒ‚æ‰
- **å¤„ç†å¤æ‚**ï¼šå•ä¸ªæ¶ˆæ¯å¤„ç†æ—¶é—´å¾ˆé•¿

**å†…å­˜å ç”¨è®¡ç®—**ï¼š
```
é˜Ÿåˆ—å†…å­˜ä½¿ç”¨ â‰ˆ æ¶ˆæ¯æ•°é‡ Ã— å¹³å‡æ¶ˆæ¯å¤§å°

ç¤ºä¾‹ï¼š
â€¢ 100ä¸‡æ¡æ¶ˆæ¯ Ã— 1KB/æ¡ = 1GBå†…å­˜
â€¢ å¦‚æœæ¶ˆæ¯æ›´å¤§ï¼ˆ10KBï¼‰ï¼Œåˆ™éœ€è¦10GBå†…å­˜
```

### 2.2 æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦è¿‡æ…¢


**ğŸ”¸ æ ¹æœ¬åŸå› **ï¼šæ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›è·Ÿä¸ä¸Šæ¶ˆæ¯äº§ç”Ÿçš„é€Ÿåº¦

**å¸¸è§åŸå› **ï¼š
```
ä»£ç å±‚é¢ï¼š
â€¢ æ¶ˆè´¹è€…é€»è¾‘å¤æ‚ï¼Œå¤„ç†æ—¶é—´é•¿
â€¢ æ•°æ®åº“æŸ¥è¯¢æ…¢ï¼Œæˆä¸ºç“¶é¢ˆ
â€¢ å¤–éƒ¨APIè°ƒç”¨è€—æ—¶
â€¢ æ²¡æœ‰åˆç†çš„å¹¶å‘å¤„ç†

é…ç½®å±‚é¢ï¼š
â€¢ æ¶ˆè´¹è€…æ•°é‡ä¸å¤Ÿ
â€¢ prefetchè®¾ç½®ä¸å½“
â€¢ è¿æ¥æ•°é™åˆ¶
```

**ğŸ’¡ è¯†åˆ«æ–¹æ³•**ï¼š
- æŸ¥çœ‹æ¶ˆè´¹é€Ÿç‡ï¼šæ¶ˆæ¯/ç§’
- ç›‘æ§å¤„ç†æ—¶é—´ï¼šå¹³å‡è€—æ—¶
- è§‚å¯Ÿç§¯å‹è¶‹åŠ¿ï¼šæ˜¯å¦æŒç»­å¢é•¿

### 2.3 å¤§æ¶ˆæ¯ä½“å ç”¨å†…å­˜


**ğŸ”¸ é—®é¢˜è¯´æ˜**ï¼šå•ä¸ªæ¶ˆæ¯å¤ªå¤§ï¼Œå°‘é‡æ¶ˆæ¯å°±å ç”¨å¤§é‡å†…å­˜

**å…¸å‹åœºæ™¯**ï¼š
- **æ–‡ä»¶ä¼ è¾“**ï¼šé€šè¿‡æ¶ˆæ¯ä¼ é€’å¤§æ–‡ä»¶
- **æ•°æ®åŒæ­¥**ï¼šä¸€æ¬¡æ€§ä¼ è¾“å¤§é‡æ•°æ®
- **å›¾ç‰‡è§†é¢‘**ï¼šå¤šåª’ä½“å†…å®¹ä¼ è¾“

**å†…å­˜å½±å“**ï¼š
```
å°æ¶ˆæ¯åœºæ™¯ï¼š
â€¢ 1ä¸‡æ¡ Ã— 1KB = 10MB

å¤§æ¶ˆæ¯åœºæ™¯ï¼š
â€¢ 100æ¡ Ã— 1MB = 100MB
â€¢ å†…å­˜å ç”¨æ˜¯å°æ¶ˆæ¯çš„10å€ï¼
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šæ¶ˆæ¯åº”è¯¥è½»é‡åŒ–ï¼Œå¤§æ–‡ä»¶é€šè¿‡æ–‡ä»¶ç³»ç»Ÿä¼ é€’ï¼Œæ¶ˆæ¯åªä¼ é€’æ–‡ä»¶è·¯å¾„

### 2.4 è¿æ¥æ•°è¿‡å¤š


**ğŸ”¸ é—®é¢˜æè¿°**ï¼šè¿‡å¤šçš„å®¢æˆ·ç«¯è¿æ¥å ç”¨å†…å­˜èµ„æº

**å†…å­˜å¼€é”€ç»„æˆ**ï¼š
```
æ¯ä¸ªè¿æ¥åŒ…å«ï¼š
â€¢ TCPè¿æ¥ç¼“å†²åŒºï¼šé»˜è®¤çº¦64KB
â€¢ RabbitMQè¿æ¥çŠ¶æ€ï¼šçº¦10-20KB
â€¢ è®¤è¯ä¿¡æ¯å’Œæƒé™æ•°æ®
â€¢ å¿ƒè·³å’Œç›‘æ§æ•°æ®

1000ä¸ªè¿æ¥ â‰ˆ 80-100MBå†…å­˜å¼€é”€
```

**è¿æ¥è¿‡å¤šçš„åŸå› **ï¼š
- åº”ç”¨æ²¡æœ‰æ­£ç¡®å¤ç”¨è¿æ¥
- è¿æ¥æ± é…ç½®ä¸å½“
- çŸ­è¿æ¥ä½¿ç”¨è¿‡å¤š
- è¿æ¥æ³„æ¼ï¼ˆæ²¡æœ‰æ­£ç¡®å…³é—­ï¼‰

### 2.5 é˜Ÿåˆ—æ•°é‡è¿‡å¤š


**ğŸ”¸ å½±å“åˆ†æ**ï¼šæ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰å…ƒæ•°æ®å¼€é”€

**é˜Ÿåˆ—å…ƒæ•°æ®åŒ…å«**ï¼š
```
åŸºç¡€ä¿¡æ¯ï¼š
â€¢ é˜Ÿåˆ—åç§°å’Œå±æ€§
â€¢ ç»Ÿè®¡è®¡æ•°å™¨
â€¢ è®¢é˜…è€…åˆ—è¡¨
â€¢ æ¶ˆæ¯ç´¢å¼•

å†…å­˜ä¼°ç®—ï¼š
â€¢ ç©ºé˜Ÿåˆ—ï¼šçº¦2-5KB
â€¢ 1ä¸‡ä¸ªé˜Ÿåˆ— â‰ˆ 20-50MBåŸºç¡€å¼€é”€
```

**âš ï¸ å¸¸è§è¯¯åŒº**ï¼šä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸“å±é˜Ÿåˆ—

**æ­£ç¡®åšæ³•**ï¼š
- åˆç†è®¾è®¡é˜Ÿåˆ—ç»“æ„
- ä½¿ç”¨è·¯ç”±é”®åŒºåˆ†æ¶ˆæ¯
- å®šæœŸæ¸…ç†ä¸ç”¨çš„é˜Ÿåˆ—

---

## 3. ğŸ”§ å†…å­˜é—®é¢˜è¯Šæ–­æ–¹æ³•


### 3.1 å†…å­˜ä½¿ç”¨æƒ…å†µæ£€æŸ¥


**ğŸ”¸ ç®¡ç†ç•Œé¢æŸ¥çœ‹**ï¼š

è®¿é—®RabbitMQç®¡ç†ç•Œé¢ï¼ˆé»˜è®¤15672ç«¯å£ï¼‰ï¼š
```
http://your-server:15672

å…³é”®æŒ‡æ ‡ï¼š
â€¢ Memory usedï¼šå½“å‰å†…å­˜ä½¿ç”¨
â€¢ Memory limitï¼šå†…å­˜é™åˆ¶
â€¢ Memory alarmï¼šæ˜¯å¦å†…å­˜å‘Šè­¦
```

**ğŸ”¸ å‘½ä»¤è¡Œè¯Šæ–­**ï¼š

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¯¦æƒ…
rabbitmqctl status

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨åˆ†è§£
rabbitmqctl environment | grep memory

# æŸ¥çœ‹é˜Ÿåˆ—å†…å­˜ä½¿ç”¨
rabbitmqctl list_queues name memory messages
```

### 3.2 é˜Ÿåˆ—ç§¯å‹è¯Šæ–­


**ğŸ”¸ è¯†åˆ«ç§¯å‹é˜Ÿåˆ—**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰é˜Ÿåˆ—çš„æ¶ˆæ¯æ•°é‡
rabbitmqctl list_queues name messages messages_ready messages_unacknowledged

# æŒ‰æ¶ˆæ¯æ•°é‡æ’åºï¼ˆæ‰¾å‡ºç§¯å‹æœ€ä¸¥é‡çš„é˜Ÿåˆ—ï¼‰
rabbitmqctl list_queues name messages | sort -k2 -nr
```

**ğŸ”¸ åˆ†æç§¯å‹åŸå› **ï¼š

| æŒ‡æ ‡ | å«ä¹‰ | åˆ†æ |
|------|------|------|
| `messages_ready` | ç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯ | æ•°é‡å¤§è¯´æ˜æ¶ˆè´¹è·Ÿä¸ä¸Š |
| `messages_unacknowledged` | å·²å‘é€æœªç¡®è®¤çš„æ¶ˆæ¯ | æ•°é‡å¤§è¯´æ˜å¤„ç†æ…¢ |
| `message_stats.publish_rate` | æ¶ˆæ¯å‘å¸ƒé€Ÿç‡ | ç”Ÿäº§é€Ÿåº¦ |
| `message_stats.deliver_rate` | æ¶ˆæ¯æ¶ˆè´¹é€Ÿç‡ | æ¶ˆè´¹é€Ÿåº¦ |

### 3.3 è¿æ¥å’Œæ¶ˆè´¹è€…è¯Šæ–­


**ğŸ”¸ æ£€æŸ¥è¿æ¥æ•°**ï¼š

```bash
# æŸ¥çœ‹è¿æ¥æ•°é‡
rabbitmqctl list_connections

# æŸ¥çœ‹æ¯ä¸ªè¿æ¥çš„è¯¦ç»†ä¿¡æ¯
rabbitmqctl list_connections name peer_host peer_port state channels
```

**ğŸ”¸ æ£€æŸ¥æ¶ˆè´¹è€…çŠ¶æ€**ï¼š

```bash
# æŸ¥çœ‹æ¶ˆè´¹è€…åˆ—è¡¨
rabbitmqctl list_consumers

# æŸ¥çœ‹æ¶ˆè´¹è€…è¯¦ç»†ä¿¡æ¯
rabbitmqctl list_consumers queue_name channel_details consumer_tag
```

---

## 4. ğŸ“‹ é˜Ÿåˆ—æ¶ˆæ¯ç§¯å‹å¤„ç†


### 4.1 å¿«é€Ÿæ’ç©ºç§¯å‹é˜Ÿåˆ—


**ğŸ”¸ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**ï¼š

å½“é˜Ÿåˆ—ç§¯å‹ä¸¥é‡æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹åº”æ€¥æªæ–½ï¼š

```bash
# 1. å¢åŠ æ¶ˆè´¹è€…æ•°é‡ï¼ˆæœ€ç›´æ¥çš„æ–¹æ³•ï¼‰
# å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹æ¥åŠ å¿«å¤„ç†

# 2. æ¸…ç©ºé˜Ÿåˆ—ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰
rabbitmqctl purge_queue queue_name

# 3. è®¾ç½®é˜Ÿåˆ—é•¿åº¦é™åˆ¶
rabbitmqctl eval "rabbit_policy:set(0, <<\"max-length\">>, 
    <<\".*\">>, [{<<\"max-length\">>, 10000}])."
```

> âš ï¸ **é‡è¦æé†’**ï¼šæ¸…ç©ºé˜Ÿåˆ—ä¼šä¸¢å¤±æ‰€æœ‰æ¶ˆæ¯ï¼Œåªåœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨

**ğŸ”¸ æ¸è¿›å¼å¤„ç†**ï¼š

```
ç­–ç•¥1ï¼šåˆ†æ‰¹å¤„ç†
â€¢ æš‚åœç”Ÿäº§è€…å‘é€æ–°æ¶ˆæ¯
â€¢ ä¸“æ³¨æ¶ˆè´¹ç§¯å‹çš„æ¶ˆæ¯
â€¢ ç§¯å‹æ¸…ç†åæ¢å¤æ­£å¸¸

ç­–ç•¥2ï¼šå¢åŠ å¤„ç†èƒ½åŠ›
â€¢ æ°´å¹³æ‰©å±•ï¼šå¯åŠ¨æ›´å¤šæ¶ˆè´¹è€…å®ä¾‹
â€¢ å‚ç›´æ‰©å±•ï¼šæå‡å•ä¸ªæ¶ˆè´¹è€…æ€§èƒ½
â€¢ ä¼˜åŒ–ä»£ç ï¼šå‡å°‘å¤„ç†æ—¶é—´
```

### 4.2 æ¶ˆæ¯å¤„ç†ä¼˜åŒ–


**ğŸ”¸ æ‰¹é‡å¤„ç†**ï¼š

```java
// æ‰¹é‡ç¡®è®¤æ¶ˆæ¯ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
@RabbitListener(queues = "my.queue")
public void processMessages(List<Message> messages, Channel channel) {
    try {
        // æ‰¹é‡å¤„ç†æ¶ˆæ¯
        processBatch(messages);
        
        // æ‰¹é‡ç¡®è®¤
        channel.basicAck(messages.get(messages.size()-1).getMessageProperties()
            .getDeliveryTag(), true);
    } catch (Exception e) {
        // é”™è¯¯å¤„ç†
        channel.basicNack(messages.get(0).getMessageProperties()
            .getDeliveryTag(), true, true);
    }
}
```

**ğŸ”¸ å¼‚æ­¥å¤„ç†**ï¼š

```java
@Component
public class AsyncMessageProcessor {
    
    @Async("messageExecutor")
    @RabbitListener(queues = "heavy.task.queue")
    public void processHeavyTask(String message) {
        // è€—æ—¶æ“ä½œå¼‚æ­¥å¤„ç†
        performHeavyOperation(message);
    }
    
    // é…ç½®çº¿ç¨‹æ± 
    @Bean("messageExecutor")
    public Executor messageExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);
        executor.setMaxPoolSize(20);
        executor.setQueueCapacity(100);
        return executor;
    }
}
```

---

## 5. âš¡ æ¶ˆè´¹è€…æ€§èƒ½ä¼˜åŒ–


### 5.1 åˆç†è®¾ç½®prefetch


**ğŸ”¸ prefetchæ¦‚å¿µç†è§£**ï¼š

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
æƒ³è±¡é¤å…æœåŠ¡å‘˜ï¼š
â€¢ prefetch=1ï¼šä¸€æ¬¡åªæ‹¿1ä¸ªèœï¼Œé€å®Œå†æ‹¿ä¸‹ä¸€ä¸ª
â€¢ prefetch=10ï¼šä¸€æ¬¡æ‹¿10ä¸ªèœï¼Œæé«˜æ•ˆç‡
â€¢ ä½†æ‹¿å¤ªå¤šä¼šç´¯ï¼Œåè€Œå˜æ…¢
```

**é…ç½®ç¤ºä¾‹**ï¼š

```java
@RabbitListener(queues = "my.queue")
@RabbitHandler
public void handleMessage(String message, 
    @Header Map<String, Object> headers, Channel channel) {
    
    // æ ¹æ®æ¶ˆæ¯å¤„ç†æ—¶é—´è°ƒæ•´prefetch
    // å¿«é€Ÿå¤„ç†ï¼šprefetchå¯ä»¥è®¾å¤§ä¸€ç‚¹(50-100)
    // æ…¢é€Ÿå¤„ç†ï¼šprefetchè®¾å°ä¸€ç‚¹(1-10)
}

// åœ¨é…ç½®ä¸­è®¾ç½®
@Configuration
public class RabbitConfig {
    
    @Bean
    public SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory() {
        SimpleRabbitListenerContainerFactory factory = 
            new SimpleRabbitListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory());
        factory.setPrefetchCount(10); // è®¾ç½®prefetch
        return factory;
    }
}
```

**ğŸ¯ prefetchè®¾ç½®åŸåˆ™**ï¼š

| å¤„ç†æ—¶é—´ | å»ºè®®prefetch | è¯´æ˜ |
|----------|-------------|------|
| < 10ms | 50-100 | å¿«é€Ÿå¤„ç†ï¼Œå¯ä»¥é¢„å–å¤šç‚¹ |
| 10ms-100ms | 10-20 | ä¸­ç­‰å¤„ç†æ—¶é—´ |
| > 100ms | 1-5 | æ…¢å¤„ç†ï¼Œé¿å…ç§¯å‹ |

### 5.2 å¤šçº¿ç¨‹æ¶ˆè´¹ä¼˜åŒ–


**ğŸ”¸ é…ç½®å¹¶å‘æ¶ˆè´¹è€…**ï¼š

```java
@Configuration
public class RabbitMQConfig {
    
    @Bean
    public SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory() {
        SimpleRabbitListenerContainerFactory factory = 
            new SimpleRabbitListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory());
        
        // è®¾ç½®å¹¶å‘æ¶ˆè´¹è€…æ•°é‡
        factory.setConcurrentConsumers(5);    // åˆå§‹æ¶ˆè´¹è€…æ•°
        factory.setMaxConcurrentConsumers(10); // æœ€å¤§æ¶ˆè´¹è€…æ•°
        
        return factory;
    }
}
```

**ğŸ”¸ æ¶ˆè´¹è€…æ€§èƒ½ç›‘æ§**ï¼š

```java
@Component
public class MessageProcessor {
    
    private final MeterRegistry meterRegistry;
    
    @RabbitListener(queues = "performance.queue")
    public void processMessage(String message) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            // å¤„ç†æ¶ˆæ¯
            doProcess(message);
            
            // è®°å½•æˆåŠŸ
            meterRegistry.counter("message.processed", "status", "success")
                .increment();
        } catch (Exception e) {
            // è®°å½•å¤±è´¥
            meterRegistry.counter("message.processed", "status", "error")
                .increment();
        } finally {
            // è®°å½•å¤„ç†æ—¶é—´
            sample.stop(Timer.builder("message.processing.time")
                .register(meterRegistry));
        }
    }
}
```

---

## 6. ğŸ› ï¸ å†…å­˜é…ç½®ä¸ä¼˜åŒ–


### 6.1 å†…å­˜æ°´ä½é…ç½®


**ğŸ”¸ ç†è§£å†…å­˜æ°´ä½**ï¼š

RabbitMQä½¿ç”¨æ°´ä½æœºåˆ¶æ§åˆ¶å†…å­˜ä½¿ç”¨ï¼š
```
é«˜æ°´ä½ï¼ˆé»˜è®¤40%ï¼‰ï¼šå¼€å§‹é™åˆ¶è¿æ¥
ä½æ°´ä½ï¼ˆé»˜è®¤20%ï¼‰ï¼šæ¢å¤æ­£å¸¸æ“ä½œ

è®¡ç®—ç¤ºä¾‹ï¼š
æœåŠ¡å™¨16GBå†…å­˜ Ã— 40% = 6.4GB è§¦å‘é™åˆ¶
æœåŠ¡å™¨16GBå†…å­˜ Ã— 20% = 3.2GB æ¢å¤æ­£å¸¸
```

**ğŸ”¸ é…ç½®å†…å­˜é™åˆ¶**ï¼š

```bash
# æ–¹æ³•1ï¼šåœ¨rabbitmq.confä¸­é…ç½®
vm_memory_high_watermark.relative = 0.6  # è®¾ç½®ä¸º60%

# æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œè®¾ç½®
rabbitmqctl set_vm_memory_high_watermark 0.6

# æ–¹æ³•3ï¼šè®¾ç½®ç»å¯¹å€¼ï¼ˆä¾‹å¦‚8GBï¼‰
rabbitmqctl set_vm_memory_high_watermark absolute "8GB"
```

**ğŸ¯ æ°´ä½è®¾ç½®å»ºè®®**ï¼š

| æœåŠ¡å™¨å†…å­˜ | å»ºè®®æ°´ä½ | RabbitMQå¯ç”¨å†…å­˜ | è¯´æ˜ |
|------------|----------|------------------|------|
| 4GB | 50% | 2GB | å°å‹éƒ¨ç½² |
| 8GB | 60% | 4.8GB | ä¸­å‹éƒ¨ç½² |
| 16GB+ | 70% | 11.2GB+ | å¤§å‹éƒ¨ç½² |

### 6.2 æ¶ˆæ¯æŒä¹…åŒ–ç­–ç•¥


**ğŸ”¸ æŒä¹…åŒ–å¯¹å†…å­˜çš„å½±å“**ï¼š

```
éæŒä¹…åŒ–æ¶ˆæ¯ï¼šå®Œå…¨åœ¨å†…å­˜ä¸­
æŒä¹…åŒ–æ¶ˆæ¯ï¼šå†…å­˜+ç£ç›˜ï¼Œå†…å­˜å ç”¨è¾ƒå°‘

å†…å­˜ä½¿ç”¨å¯¹æ¯”ï¼š
â€¢ éæŒä¹…åŒ–ï¼š100%å†…å­˜å­˜å‚¨
â€¢ æŒä¹…åŒ–ï¼šå¤§éƒ¨åˆ†åœ¨ç£ç›˜ï¼Œå†…å­˜åªå­˜ç´¢å¼•
```

**ğŸ”¸ é…ç½®æ¶ˆæ¯æŒä¹…åŒ–**ï¼š

```java
@Configuration
public class MessageConfig {
    
    // æŒä¹…åŒ–é˜Ÿåˆ—é…ç½®
    @Bean
    public Queue durableQueue() {
        return QueueBuilder.durable("persistent.queue")
            .build();
    }
    
    // æŒä¹…åŒ–äº¤æ¢æœº
    @Bean
    public DirectExchange durableExchange() {
        return ExchangeBuilder.directExchange("persistent.exchange")
            .durable(true)
            .build();
    }
}

// å‘é€æŒä¹…åŒ–æ¶ˆæ¯
@Service
public class MessageSender {
    
    public void sendPersistentMessage(String message) {
        rabbitTemplate.convertAndSend("persistent.exchange", 
            "routing.key", message, messagePostProcessor -> {
                // è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ–
                messagePostProcessor.getMessageProperties()
                    .setDeliveryMode(MessageDeliveryMode.PERSISTENT);
                return messagePostProcessor;
            });
    }
}
```

### 6.3 æ¶ˆæ¯TTLè®¾ç½®


**ğŸ”¸ TTLï¼ˆTime To Liveï¼‰ä½œç”¨**ï¼š

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
TTLå°±åƒé£Ÿç‰©çš„ä¿è´¨æœŸï¼š
â€¢ è¿‡æœŸçš„é£Ÿç‰©è‡ªåŠ¨æ‰”æ‰ï¼ˆè¿‡æœŸæ¶ˆæ¯è‡ªåŠ¨åˆ é™¤ï¼‰
â€¢ é¿å…å†°ç®±è¢«è¿‡æœŸé£Ÿç‰©å æ»¡ï¼ˆé¿å…å†…å­˜è¢«è¿‡æœŸæ¶ˆæ¯å ç”¨ï¼‰
```

**ğŸ”¸ TTLé…ç½®æ–¹å¼**ï¼š

```java
// æ–¹æ³•1ï¼šé˜Ÿåˆ—çº§åˆ«TTL
@Bean
public Queue queueWithTTL() {
    return QueueBuilder.durable("ttl.queue")
        .ttl(300000)  // 5åˆ†é’ŸTTL
        .build();
}

// æ–¹æ³•2ï¼šæ¶ˆæ¯çº§åˆ«TTL
public void sendMessageWithTTL(String message) {
    rabbitTemplate.convertAndSend("exchange", "routing.key", message, 
        messagePostProcessor -> {
            messagePostProcessor.getMessageProperties()
                .setExpiration("60000"); // 1åˆ†é’ŸTTL
            return messagePostProcessor;
        });
}

// æ–¹æ³•3ï¼šé€šè¿‡Policyè®¾ç½®
rabbitmqctl set_policy TTL ".*" '{"message-ttl":60000}' --apply-to queues
```

---

## 7. ğŸ“Š ç›‘æ§ä¸é¢„é˜²æªæ–½


### 7.1 å†…å­˜ç›‘æ§æŒ‡æ ‡


**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

```
ç³»ç»Ÿçº§æŒ‡æ ‡ï¼š
â€¢ æ€»å†…å­˜ä½¿ç”¨é‡
â€¢ å†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”
â€¢ å†…å­˜å¢é•¿è¶‹åŠ¿
â€¢ GCé¢‘ç‡å’Œè€—æ—¶

RabbitMQçº§æŒ‡æ ‡ï¼š
â€¢ é˜Ÿåˆ—æ¶ˆæ¯æ•°é‡
â€¢ æœªç¡®è®¤æ¶ˆæ¯æ•°é‡
â€¢ æ¶ˆæ¯å‘å¸ƒ/æ¶ˆè´¹é€Ÿç‡
â€¢ è¿æ¥æ•°å’Œé€šé“æ•°
```

**ğŸ”¸ ç›‘æ§å·¥å…·é…ç½®**ï¼š

ä½¿ç”¨Prometheus + Grafanaç›‘æ§ï¼š

```yaml
# docker-compose.yml
version: '3'
services:
  rabbitmq:
    image: rabbitmq:3-management
    plugins:
      - rabbitmq_prometheus
    ports:
      - "15692:15692"  # Prometheus metricsç«¯å£
      
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
```

### 7.2 å‘Šè­¦è®¾ç½®


**ğŸ”¸ å†…å­˜å‘Šè­¦è§„åˆ™**ï¼š

```yaml
# prometheuså‘Šè­¦è§„åˆ™
groups:
- name: rabbitmq
  rules:
  - alert: RabbitMQHighMemoryUsage
    expr: rabbitmq_node_mem_used / rabbitmq_node_mem_limit > 0.8
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "RabbitMQå†…å­˜ä½¿ç”¨è¿‡é«˜"
      
  - alert: RabbitMQQueueGrowing
    expr: increase(rabbitmq_queue_messages[5m]) > 1000
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "é˜Ÿåˆ—æ¶ˆæ¯ç§¯å‹ä¸¥é‡"
```

**ğŸ”¸ è‡ªåŠ¨åŒ–å“åº”**ï¼š

```bash
#!/bin/bash
# å†…å­˜å‘Šè­¦è‡ªåŠ¨å¤„ç†è„šæœ¬

MEMORY_USAGE=$(rabbitmqctl status | grep "Memory used" | awk '{print $3}')
THRESHOLD="8GB"

if [ "$MEMORY_USAGE" -gt "$THRESHOLD" ]; then
    echo "å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œæ‰§è¡Œæ¸…ç†æ“ä½œ..."
    
    # 1. æ¸…ç†ç©ºé˜Ÿåˆ—
    rabbitmqctl list_queues name messages | grep " 0$" | awk '{print $1}' | \
        xargs -I {} rabbitmqctl delete_queue {}
    
    # 2. å¼ºåˆ¶GC
    rabbitmqctl eval "garbage_collect()."
    
    # 3. å‘é€å‘Šè­¦é€šçŸ¥
    curl -X POST "https://your-alert-webhook.com/alert" \
        -d "message=RabbitMQå†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œå·²æ‰§è¡Œè‡ªåŠ¨æ¸…ç†"
fi
```

### 7.3 é¢„é˜²æ€§é…ç½®


**ğŸ”¸ é˜Ÿåˆ—é•¿åº¦é™åˆ¶**ï¼š

```bash
# è®¾ç½®é˜Ÿåˆ—æœ€å¤§é•¿åº¦ç­–ç•¥
rabbitmqctl set_policy max-length ".*" \
    '{"max-length":10000,"overflow":"reject-publish"}' \
    --apply-to queues
```

**ğŸ”¸ è¿æ¥æ•°é™åˆ¶**ï¼š

```bash
# åœ¨rabbitmq.confä¸­é…ç½®
connection_max = 1000

# æˆ–ä½¿ç”¨å‘½ä»¤è®¾ç½®
rabbitmqctl eval "application:set_env(rabbit, connection_max, 1000)."
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å†…å­˜é—®é¢˜çš„æ ¹æºç†è§£


**ğŸ”¸ æ ¸å¿ƒåŸå› æ€»ç»“**ï¼š
```
ğŸ“ˆ æ¶ˆæ¯ç§¯å‹ï¼šç”Ÿäº§>æ¶ˆè´¹ï¼Œæ¶ˆæ¯å †ç§¯å å†…å­˜
ğŸŒ å¤„ç†ç¼“æ…¢ï¼šæ¶ˆè´¹è€…æ€§èƒ½ä¸è¶³ï¼Œå¤„ç†è·Ÿä¸ä¸Š
ğŸ“¦ æ¶ˆæ¯è¿‡å¤§ï¼šå•ä¸ªæ¶ˆæ¯ä½“ç§¯å¤§ï¼Œå°‘é‡æ¶ˆæ¯å ç”¨å¤§é‡å†…å­˜
ğŸ”— è¿æ¥è¿‡å¤šï¼šå®¢æˆ·ç«¯è¿æ¥æ•°è¿‡å¤šï¼Œè¿æ¥å¼€é”€ç´¯ç§¯
ğŸ“‹ é˜Ÿåˆ—è¿‡å¤šï¼šé˜Ÿåˆ—æ•°é‡å¤šï¼Œå…ƒæ•°æ®å¼€é”€ç´¯ç§¯
â° TTLä¸å½“ï¼šæ¶ˆæ¯ä¸è¿‡æœŸï¼Œé•¿æœŸå ç”¨å†…å­˜
```

### 8.2 è§£å†³æ€è·¯ä¼˜å…ˆçº§


**ğŸ¯ å¤„ç†ä¼˜å…ˆçº§**ï¼š

| ä¼˜å…ˆçº§ | å¤„ç†æ–¹å‘ | å…·ä½“æªæ–½ | æ•ˆæœ |
|--------|----------|----------|------|
| **1. ç´§æ€¥** | å¿«é€Ÿé™ä½å†…å­˜ | å¢åŠ æ¶ˆè´¹è€…ã€æ¸…ç†ç§¯å‹ | âš¡ ç«‹å³è§æ•ˆ |
| **2. æ²»æœ¬** | æå‡å¤„ç†èƒ½åŠ› | ä¼˜åŒ–ä»£ç ã€è°ƒæ•´prefetch | ğŸ¯ æ ¹æœ¬è§£å†³ |
| **3. é¢„é˜²** | å®Œå–„ç›‘æ§å‘Šè­¦ | è®¾ç½®é™åˆ¶ã€ç›‘æ§æŒ‡æ ‡ | ğŸ›¡ï¸ é¿å…å¤å‘ |

### 8.3 æœ€ä½³å®è·µæ¸…å•


**âœ… é…ç½®ä¼˜åŒ–**ï¼š
- åˆç†è®¾ç½®å†…å­˜æ°´ä½ï¼ˆ50-70%ï¼‰
- é…ç½®æ¶ˆæ¯TTLé¿å…å †ç§¯
- è®¾ç½®é˜Ÿåˆ—é•¿åº¦é™åˆ¶
- å¯ç”¨æ¶ˆæ¯æŒä¹…åŒ–

**âœ… ä»£ç ä¼˜åŒ–**ï¼š
- ä¼˜åŒ–æ¶ˆè´¹è€…å¤„ç†é€»è¾‘
- åˆç†è®¾ç½®prefetchå€¼
- ä½¿ç”¨å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
- æ­£ç¡®å¤„ç†æ¶ˆæ¯ç¡®è®¤

**âœ… è¿ç»´ç®¡ç†**ï¼š
- å»ºç«‹å®Œæ•´ç›‘æ§ä½“ç³»
- è®¾ç½®å†…å­˜å‘Šè­¦æœºåˆ¶
- å®šæœŸæ¸…ç†æ— ç”¨é˜Ÿåˆ—
- åˆ¶å®šåº”æ€¥å¤„ç†é¢„æ¡ˆ

### 8.4 å¸¸è§è¯¯åŒºé¿å…


**âŒ å¸¸è§é”™è¯¯åšæ³•**ï¼š
```
é”™è¯¯1ï¼šç›²ç›®å¢åŠ å†…å­˜
æ­£ç¡®ï¼šå…ˆåˆ†æåŸå› ï¼Œé’ˆå¯¹æ€§è§£å†³

é”™è¯¯2ï¼šæ¸…ç©ºæ‰€æœ‰é˜Ÿåˆ—
æ­£ç¡®ï¼šä¼˜å…ˆä¼˜åŒ–æ¶ˆè´¹è€…æ€§èƒ½

é”™è¯¯3ï¼šè®¾ç½®è¿‡å¤§çš„prefetch
æ­£ç¡®ï¼šæ ¹æ®å¤„ç†æ—¶é—´åˆç†è®¾ç½®

é”™è¯¯4ï¼šå¿½ç•¥ç›‘æ§å‘Šè­¦
æ­£ç¡®ï¼šä¸»åŠ¨ç›‘æ§ï¼Œæå‰é¢„é˜²
```

**ğŸ’¡ è®°å¿†å£è¯€**ï¼š
> **"ç§¯å‹é—®é¢˜å…ˆæ‰¾å› ï¼Œæ¶ˆè´¹ä¼˜åŒ–æ˜¯å…³é”®"**
> **"å†…å­˜ç›‘æ§è¦åŠæ—¶ï¼Œé¢„é˜²èƒœè¿‡æ€¥æ•‘æ²»"**

### 8.5 é—®é¢˜æ’æŸ¥æ£€æŸ¥æ¸…å•


**ğŸ” å¿«é€Ÿè¯Šæ–­æ­¥éª¤**ï¼š
- [ ] æ£€æŸ¥å†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”
- [ ] æŸ¥çœ‹é˜Ÿåˆ—æ¶ˆæ¯ç§¯å‹æƒ…å†µ
- [ ] ç¡®è®¤æ¶ˆè´¹è€…è¿è¡ŒçŠ¶æ€  
- [ ] åˆ†ææ¶ˆæ¯å¤„ç†é€Ÿç‡
- [ ] æ£€æŸ¥è¿æ¥æ•°æ˜¯å¦å¼‚å¸¸
- [ ] ç¡®è®¤TTLé…ç½®æ˜¯å¦åˆç†
- [ ] æŸ¥çœ‹æ˜¯å¦æœ‰å¤§æ¶ˆæ¯
- [ ] æ£€æŸ¥é˜Ÿåˆ—æ•°é‡æ˜¯å¦è¿‡å¤š

**ğŸš¨ ç´§æ€¥å¤„ç†æ­¥éª¤**ï¼š
- [ ] ç«‹å³å¢åŠ æ¶ˆè´¹è€…å®ä¾‹
- [ ] æš‚åœéå…³é”®ä¸šåŠ¡çš„æ¶ˆæ¯å‘é€
- [ ] æ¸…ç†ç©ºé˜Ÿåˆ—å’Œè¿‡æœŸæ¶ˆæ¯
- [ ] è°ƒæ•´å†…å­˜æ°´ä½é…ç½®
- [ ] ç›‘æ§å†…å­˜ä½¿ç”¨è¶‹åŠ¿
- [ ] é€šçŸ¥ç›¸å…³å›¢é˜ŸååŠ©å¤„ç†

---

> ğŸ’¡ **å­¦ä¹ å°è´´å£«**ï¼šå†…å­˜é—®é¢˜å¾€å¾€æ˜¯ç³»ç»Ÿè®¾è®¡å’Œé…ç½®çš„ç»¼åˆä½“ç°ï¼Œè§£å†³æ—¶è¦æ—¢æ²»æ ‡åˆæ²»æœ¬ï¼Œé€šè¿‡ç›‘æ§é¢„é˜²æ¯”äº‹åå¤„ç†æ›´é‡è¦ã€‚

> ğŸ¯ **å®è·µå»ºè®®**ï¼šå»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿé«˜è´Ÿè½½åœºæ™¯ï¼Œæå‰éªŒè¯å†…å­˜é…ç½®çš„åˆç†æ€§ï¼Œé¿å…ç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜ã€‚