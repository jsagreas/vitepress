---
title: 7ã€æ•°æ®åŒæ­¥æ–¹æ¡ˆ
---
## ğŸ“š ç›®å½•

1. [æ•°æ®åŒæ­¥åŸºç¡€æ¦‚å¿µ](#1-æ•°æ®åŒæ­¥åŸºç¡€æ¦‚å¿µ)
2. [æ•°æ®å˜æ›´æ•è·æœºåˆ¶](#2-æ•°æ®å˜æ›´æ•è·æœºåˆ¶)
3. [ç¼“å­˜æ›´æ–°ç­–ç•¥](#3-ç¼“å­˜æ›´æ–°ç­–ç•¥)
4. [æœç´¢å¼•æ“åŒæ­¥æ–¹æ¡ˆ](#4-æœç´¢å¼•æ“åŒæ­¥æ–¹æ¡ˆ)
5. [æ•°æ®ä»“åº“ETLæµç¨‹](#5-æ•°æ®ä»“åº“ETLæµç¨‹)
6. [å†²çªè§£å†³æœºåˆ¶](#6-å†²çªè§£å†³æœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ•°æ®åŒæ­¥åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åŒæ­¥


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> æ•°æ®åŒæ­¥å°±æ˜¯è®©å¤šä¸ªç³»ç»Ÿä¹‹é—´çš„æ•°æ®ä¿æŒä¸€è‡´çš„è¿‡ç¨‹ï¼Œå°±åƒè®©å¤šä¸ªäººçš„é€šè®¯å½•éƒ½ä¿æŒæœ€æ–°çŠ¶æ€ä¸€æ ·

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
```
æƒ³è±¡ä½ æœ‰å¤šä¸ªæ‰‹æœºï¼ˆå¾®æœåŠ¡ï¼‰ï¼š
- ä¸»æ‰‹æœºï¼ˆä¸»æ•°æ®åº“ï¼‰ï¼šå­˜å‚¨å®Œæ•´è”ç³»äººä¿¡æ¯
- å¤‡ç”¨æ‰‹æœºï¼ˆç¼“å­˜ï¼‰ï¼šå­˜å‚¨å¸¸ç”¨è”ç³»äººï¼Œå¿«é€ŸæŸ¥æ‰¾
- å·¥ä½œæ‰‹æœºï¼ˆæœç´¢å¼•æ“ï¼‰ï¼šä¸“é—¨å­˜å‚¨å·¥ä½œç›¸å…³è”ç³»äºº
- å®¶ç”¨å¹³æ¿ï¼ˆæ•°æ®ä»“åº“ï¼‰ï¼šå­˜å‚¨æ‰€æœ‰å†å²é€šè¯è®°å½•

å½“ä½ åœ¨ä¸»æ‰‹æœºä¸Šæ·»åŠ æ–°è”ç³»äººæ—¶ï¼Œå…¶ä»–è®¾å¤‡ä¹Ÿè¦åŒæ­¥æ›´æ–°
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®åŒæ­¥


**ğŸ”¸ ä¸šåŠ¡åœºæ™¯åˆ†æ**ï¼š
```
ç”µå•†ç³»ç»Ÿç¤ºä¾‹ï¼š
ç”¨æˆ·åœ¨æ‰‹æœºAPPä¸‹å•è´­ä¹°å•†å“
â”œâ”€â”€ è®¢å•æœåŠ¡ â”€â”€> åˆ›å»ºè®¢å•è®°å½•
â”œâ”€â”€ åº“å­˜æœåŠ¡ â”€â”€> æ‰£å‡å•†å“åº“å­˜  
â”œâ”€â”€ ç¼“å­˜ç³»ç»Ÿ â”€â”€> æ›´æ–°çƒ­é—¨å•†å“ç¼“å­˜
â”œâ”€â”€ æœç´¢å¼•æ“ â”€â”€> æ›´æ–°å•†å“æœç´¢ç´¢å¼•
â””â”€â”€ æ•°æ®ä»“åº“ â”€â”€> è®°å½•é”€å”®æ•°æ®ç”¨äºåˆ†æ

å¦‚æœä¸åŒæ­¥ï¼Œå°±ä¼šå‡ºç°ï¼š
âŒ ç”¨æˆ·çœ‹åˆ°çš„åº“å­˜æ•°é‡ä¸å‡†ç¡®
âŒ æœç´¢ç»“æœæ˜¾ç¤ºå·²å”®å®Œçš„å•†å“
âŒ æ•°æ®åˆ†ææŠ¥è¡¨å»¶è¿Ÿæˆ–é”™è¯¯
```

### 1.3 æ•°æ®åŒæ­¥çš„æ ¸å¿ƒæŒ‘æˆ˜


**âš ï¸ å¸¸è§é—®é¢˜**ï¼š
- **æ—¶é—´å·®é—®é¢˜**ï¼šæ•°æ®æ›´æ–°æœ‰å…ˆåé¡ºåº
- **ç½‘ç»œå»¶è¿Ÿ**ï¼šæ¶ˆæ¯ä¼ è¾“éœ€è¦æ—¶é—´
- **ç³»ç»Ÿæ•…éšœ**ï¼šæŸä¸ªæœåŠ¡å¯èƒ½æš‚æ—¶æ— æ³•æ¥æ”¶æ•°æ®
- **æ•°æ®å†²çª**ï¼šå¤šä¸ªåœ°æ–¹åŒæ—¶ä¿®æ”¹åŒä¸€ä»½æ•°æ®

```
æ—¶é—´çº¿ç¤ºä¾‹ï¼š
æ—¶åˆ»1: ç”¨æˆ·ä¸‹å• â”€â”€> ä¸»æ•°æ®åº“æ›´æ–°
æ—¶åˆ»2: å‘é€åŒæ­¥æ¶ˆæ¯ â”€â”€> RabbitMQ
æ—¶åˆ»3: ç¼“å­˜æ”¶åˆ°æ¶ˆæ¯ â”€â”€> æ›´æ–°ç¼“å­˜
æ—¶åˆ»4: æœç´¢å¼•æ“æ”¶åˆ° â”€â”€> æ›´æ–°ç´¢å¼•

é—®é¢˜ï¼šæ—¶åˆ»1åˆ°æ—¶åˆ»4ä¹‹é—´ï¼Œä¸åŒç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´
```

---

## 2. ğŸ“¡ æ•°æ®å˜æ›´æ•è·æœºåˆ¶


### 2.1 ä»€ä¹ˆæ˜¯æ•°æ®å˜æ›´æ•è·ï¼ˆCDCï¼‰


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> CDCå°±åƒç»™æ•°æ®åº“å®‰è£…ä¸€ä¸ª"ç›‘æ§æ‘„åƒå¤´"ï¼Œä¸€æ—¦æ•°æ®å‘ç”Ÿå˜åŒ–å°±ç«‹å³"æ‹ç…§"å¹¶é€šçŸ¥ç›¸å…³ç³»ç»Ÿ

### 2.2 åŸºäºè§¦å‘å™¨çš„å˜æ›´æ•è·


**ğŸ”§ å·¥ä½œåŸç†**ï¼š
```
æ•°æ®åº“è¡¨ç»“æ„ï¼š
users è¡¨ï¼š
- id (ä¸»é”®)
- name (å§“å)  
- email (é‚®ç®±)
- updated_at (æ›´æ–°æ—¶é—´)

åˆ›å»ºè§¦å‘å™¨ï¼š
å½“ users è¡¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶
â”œâ”€â”€ è‡ªåŠ¨è®°å½•å˜æ›´ä¿¡æ¯åˆ° change_log è¡¨
â”œâ”€â”€ å‘é€æ¶ˆæ¯åˆ° RabbitMQ
â””â”€â”€ é€šçŸ¥ç›¸å…³æœåŠ¡è¿›è¡ŒåŒæ­¥
```

**ğŸ’» ç®€åŒ–ç¤ºä¾‹**ï¼š
```sql
-- åˆ›å»ºå˜æ›´è®°å½•è¡¨
CREATE TABLE user_changes (
    id INT PRIMARY KEY,
    user_id INT,
    operation VARCHAR(10), -- INSERT/UPDATE/DELETE
    old_data JSON,         -- å˜æ›´å‰æ•°æ®
    new_data JSON,         -- å˜æ›´åæ•°æ®
    change_time TIMESTAMP
);

-- åˆ›å»ºè§¦å‘å™¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
CREATE TRIGGER user_change_trigger
AFTER UPDATE ON users
FOR EACH ROW
BEGIN
    -- è®°å½•å˜æ›´
    INSERT INTO user_changes VALUES (
        NULL, NEW.id, 'UPDATE', 
        JSON_OBJECT('name', OLD.name, 'email', OLD.email),
        JSON_OBJECT('name', NEW.name, 'email', NEW.email),
        NOW()
    );
    
    -- å‘é€åŒæ­¥æ¶ˆæ¯ï¼ˆé€šè¿‡å­˜å‚¨è¿‡ç¨‹ï¼‰
    CALL send_sync_message('user.updated', NEW.id);
END;
```

### 2.3 åŸºäºBinlogçš„å˜æ›´æ•è·


**ğŸ’¡ æ›´é«˜çº§çš„æ–¹æ¡ˆ**ï¼š
```
MySQL Binlog å·¥ä½œæµç¨‹ï¼š
æ•°æ®åº“å†™å…¥ â”€â”€> Binlogè®°å½• â”€â”€> CDCå·¥å…·è¯»å– â”€â”€> è§£æå˜æ›´ â”€â”€> å‘é€åˆ°MQ

ä¼˜åŠ¿å¯¹æ¯”ï¼š
è§¦å‘å™¨æ–¹æ¡ˆï¼š
âœ… å®ç°ç®€å•ï¼Œå®¹æ˜“ç†è§£
âŒ å¢åŠ æ•°æ®åº“è´Ÿæ‹…
âŒ ä¸ä¸šåŠ¡ä»£ç è€¦åˆ

Binlogæ–¹æ¡ˆï¼š  
âœ… å¯¹æ•°æ®åº“æ€§èƒ½å½±å“å°
âœ… ä¸ä¸šåŠ¡ä»£ç è§£è€¦
âŒ å®ç°å¤æ‚
âŒ éœ€è¦ä¸“é—¨çš„CDCå·¥å…·
```

### 2.4 åº”ç”¨å±‚å˜æ›´æ•è·


**ğŸ¯ æœ€å®ç”¨çš„æ–¹æ¡ˆ**ï¼šåœ¨ä¸šåŠ¡ä»£ç ä¸­ä¸»åŠ¨å‘é€å˜æ›´æ¶ˆæ¯

```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired  
    private RabbitTemplate rabbitTemplate;
    
    public void updateUser(User user) {
        // 1. è·å–æ›´æ–°å‰çš„æ•°æ®
        User oldUser = userRepository.findById(user.getId());
        
        // 2. æ‰§è¡Œæ•°æ®åº“æ›´æ–°
        userRepository.save(user);
        
        // 3. å‘é€å˜æ›´æ¶ˆæ¯
        UserChangeEvent event = new UserChangeEvent();
        event.setUserId(user.getId());
        event.setOperation("UPDATE");
        event.setOldData(oldUser);
        event.setNewData(user);
        event.setTimestamp(System.currentTimeMillis());
        
        // å‘é€åˆ°RabbitMQ
        rabbitTemplate.convertAndSend(
            "user.exchange", 
            "user.updated", 
            event
        );
    }
}
```

**ğŸ”¸ å˜æ›´äº‹ä»¶æ ‡å‡†æ ¼å¼**ï¼š
```json
{
    "eventId": "uuid-1234-5678",
    "source": "user-service",
    "operation": "UPDATE",
    "entityType": "User",
    "entityId": "12345",
    "timestamp": "2024-03-20T10:30:00Z",
    "oldData": {
        "name": "å¼ ä¸‰",
        "email": "zhangsan@old.com"
    },
    "newData": {
        "name": "å¼ ä¸‰ä¸°", 
        "email": "zhangsanfeng@new.com"
    }
}
```

---

## 3. ğŸš€ ç¼“å­˜æ›´æ–°ç­–ç•¥


### 3.1 ç¼“å­˜æ›´æ–°çš„åŸºæœ¬æ¨¡å¼


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> ç¼“å­˜å°±åƒä¾¿åˆ©åº—ï¼Œæ•°æ®åº“å°±åƒå¤§è¶…å¸‚ã€‚ä¾¿åˆ©åº—å•†å“è¦åŠæ—¶æ›´æ–°ï¼Œä¸èƒ½å–è¿‡æœŸå•†å“

### 3.2 Cache-Aside æ¨¡å¼ï¼ˆæ—è·¯ç¼“å­˜ï¼‰


**ğŸ’¡ å·¥ä½œæµç¨‹**ï¼š
```
å†™å…¥æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€> æ›´æ–°æ•°æ®åº“ â”€â”€> åˆ é™¤ç¼“å­˜ â”€â”€> è¿”å›ç»“æœ

è¯»å–æµç¨‹ï¼š  
ç”¨æˆ·è¯·æ±‚ â”€â”€> æŸ¥è¯¢ç¼“å­˜
â”œâ”€â”€ ç¼“å­˜å‘½ä¸­ â”€â”€> ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®
â””â”€â”€ ç¼“å­˜æœªå‘½ä¸­ â”€â”€> æŸ¥è¯¢æ•°æ®åº“ â”€â”€> å†™å…¥ç¼“å­˜ â”€â”€> è¿”å›æ•°æ®
```

**ğŸ”§ RabbitMQå®ç°æ–¹æ¡ˆ**ï¼š
```java
// ç¼“å­˜æ›´æ–°æ¶ˆæ¯å¤„ç†å™¨
@RabbitListener(queues = "cache.user.update")
public class UserCacheUpdateHandler {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    public void handleUserUpdate(UserChangeEvent event) {
        String cacheKey = "user:" + event.getEntityId();
        
        switch (event.getOperation()) {
            case "UPDATE":
                // åˆ é™¤ç¼“å­˜ï¼Œè®©ä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡æ–°åŠ è½½
                redisTemplate.delete(cacheKey);
                
                // æˆ–è€…ç›´æ¥æ›´æ–°ç¼“å­˜
                redisTemplate.opsForValue().set(
                    cacheKey, 
                    event.getNewData(), 
                    Duration.ofHours(1)
                );
                break;
                
            case "DELETE":
                redisTemplate.delete(cacheKey);
                break;
        }
        
        log.info("ç¼“å­˜æ›´æ–°å®Œæˆ: {}", cacheKey);
    }
}
```

### 3.3 Write-Through æ¨¡å¼ï¼ˆå†™é€ç¼“å­˜ï¼‰


**ğŸ’¡ åŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â”€â”€> æœåŠ¡å±‚
â”œâ”€â”€ æ›´æ–°æ•°æ®åº“
â”œâ”€â”€ æ›´æ–°ç¼“å­˜  
â””â”€â”€ å‘é€åŒæ­¥æ¶ˆæ¯ï¼ˆé€šçŸ¥å…¶ä»–æœåŠ¡ï¼‰
```

### 3.4 Write-Behind æ¨¡å¼ï¼ˆå†™å›ç¼“å­˜ï¼‰


**ğŸ’¡ å…ˆæ›´æ–°ç¼“å­˜ï¼Œå¼‚æ­¥æ›´æ–°æ•°æ®åº“**ï¼š
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… å†™å…¥é¢‘ç¹çš„åœºæ™¯ï¼ˆå¦‚ç‚¹å‡»è®¡æ•°ã€æµè§ˆç»Ÿè®¡ï¼‰
âœ… å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é‚£ä¹ˆä¸¥æ ¼
âŒ ä¸é€‚åˆé‡‘èç­‰å¼ºä¸€è‡´æ€§åœºæ™¯

å·¥ä½œæµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â”€â”€> æ›´æ–°ç¼“å­˜ â”€â”€> ç«‹å³è¿”å›
            â†“
    å¼‚æ­¥æ‰¹é‡å†™å…¥æ•°æ®åº“ï¼ˆé€šè¿‡MQè°ƒåº¦ï¼‰
```

### 3.5 ç¼“å­˜æ›´æ–°çš„æ¶ˆæ¯è·¯ç”±è®¾è®¡


```
Exchange: cache.exchange (topicç±»å‹)

è·¯ç”±è§„åˆ™ï¼š
cache.user.#     â”€â”€> ç”¨æˆ·ç›¸å…³ç¼“å­˜é˜Ÿåˆ—
cache.product.#  â”€â”€> å•†å“ç›¸å…³ç¼“å­˜é˜Ÿåˆ—  
cache.order.#    â”€â”€> è®¢å•ç›¸å…³ç¼“å­˜é˜Ÿåˆ—

å…·ä½“æ¶ˆæ¯ï¼š
cache.user.update     â”€â”€> ç”¨æˆ·ä¿¡æ¯æ›´æ–°
cache.user.delete     â”€â”€> ç”¨æˆ·åˆ é™¤
cache.product.stock   â”€â”€> å•†å“åº“å­˜å˜åŒ–
cache.product.price   â”€â”€> å•†å“ä»·æ ¼å˜åŒ–
```

**ğŸ¯ å¤šçº§ç¼“å­˜åŒæ­¥**ï¼š
```
L1ç¼“å­˜ï¼ˆæœ¬åœ°ï¼‰â”€â”€> L2ç¼“å­˜ï¼ˆRedisï¼‰â”€â”€> L3ç¼“å­˜ï¼ˆCDNï¼‰
     â†‘              â†‘               â†‘
     â””â”€â”€â”€â”€ é€šè¿‡MQåŒæ­¥æ›´æ–°æ‰€æœ‰çº§åˆ« â”€â”€â”€â”€â”˜
```

---

## 4. ğŸ” æœç´¢å¼•æ“åŒæ­¥æ–¹æ¡ˆ


### 4.1 æœç´¢å¼•æ“åŒæ­¥çš„ç‰¹ç‚¹


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> æœç´¢å¼•æ“å°±åƒå›¾ä¹¦é¦†çš„ç›®å½•å¡ç‰‡ï¼Œå½“æ–°ä¹¦å…¥åº“æˆ–ä¹¦ç±ä¿¡æ¯æ›´æ”¹æ—¶ï¼Œç›®å½•ä¹Ÿè¦åŠæ—¶æ›´æ–°

**ğŸ”¸ ä¸ç¼“å­˜åŒæ­¥çš„åŒºåˆ«**ï¼š
```
ç¼“å­˜åŒæ­¥ï¼š
- ä¸»è¦ç›®çš„ï¼šæé«˜æŸ¥è¯¢é€Ÿåº¦
- æ•°æ®æ ¼å¼ï¼šä¸åŸæ•°æ®ç›¸åŒ
- æ›´æ–°ç­–ç•¥ï¼šå¯ä»¥ç›´æ¥åˆ é™¤ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡æ–°åŠ è½½

æœç´¢å¼•æ“åŒæ­¥ï¼š
- ä¸»è¦ç›®çš„ï¼šæ”¯æŒå¤æ‚æœç´¢æŸ¥è¯¢
- æ•°æ®æ ¼å¼ï¼šéœ€è¦å»ºç«‹ç´¢å¼•ç»“æ„  
- æ›´æ–°ç­–ç•¥ï¼šå¿…é¡»ç»´æŠ¤ç´¢å¼•å®Œæ•´æ€§
```

### 4.2 ElasticSearchåŒæ­¥æ¶æ„


**ğŸ—ï¸ ç³»ç»Ÿæ¶æ„å›¾**ï¼š
```
ä¸šåŠ¡æœåŠ¡ â”€â”€> RabbitMQ â”€â”€> ESåŒæ­¥æœåŠ¡ â”€â”€> ElasticSearch
    â”‚                          â”‚
    â”‚                          â”œâ”€â”€> åˆ›å»º/æ›´æ–°æ–‡æ¡£
    â”‚                          â”œâ”€â”€> åˆ é™¤æ–‡æ¡£  
    â”‚                          â””â”€â”€> æ‰¹é‡æ“ä½œ
    â”‚
    â””â”€â”€> æ•°æ®åº“ï¼ˆä¸»è¦æ•°æ®å­˜å‚¨ï¼‰
```

### 4.3 å•†å“æœç´¢åŒæ­¥å®ç°


```java
@Component
public class ProductSearchSyncHandler {
    
    @Autowired
    private ElasticsearchRestTemplate esTemplate;
    
    @RabbitListener(queues = "search.product.sync")
    public void syncProductToES(ProductChangeEvent event) {
        
        switch (event.getOperation()) {
            case "CREATE":
            case "UPDATE":
                syncProductDocument(event.getNewData());
                break;
                
            case "DELETE":  
                deleteProductDocument(event.getEntityId());
                break;
        }
    }
    
    private void syncProductDocument(Product product) {
        // æ„å»ºESæ–‡æ¡£
        ProductDocument doc = ProductDocument.builder()
            .id(product.getId())
            .name(product.getName())
            .description(product.getDescription())
            .price(product.getPrice())
            .category(product.getCategory())
            .tags(Arrays.asList(product.getTags().split(",")))
            .createTime(product.getCreateTime())
            .updateTime(System.currentTimeMillis())
            .build();
            
        // ä¿å­˜åˆ°ES
        esTemplate.save(doc);
        log.info("å•†å“å·²åŒæ­¥åˆ°ES: {}", product.getId());
    }
}
```

### 4.4 å¢é‡åŒæ­¥ä¸å…¨é‡åŒæ­¥


**ğŸ“Š å¯¹æ¯”åˆ†æ**ï¼š

| åŒæ­¥æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|---------|---------|
| ğŸ“ˆ **å¢é‡åŒæ­¥** | `æ—¥å¸¸æ•°æ®å˜æ›´` | `å®æ—¶æ€§å¥½ï¼Œæ€§èƒ½é«˜` | `å¯èƒ½ä¸¢å¤±æ•°æ®ï¼Œå®ç°å¤æ‚` |
| ğŸ“‹ **å…¨é‡åŒæ­¥** | `ç³»ç»Ÿåˆå§‹åŒ–ï¼Œæ•°æ®ä¿®å¤` | `æ•°æ®å®Œæ•´ï¼Œå®ç°ç®€å•` | `è€—æ—¶é•¿ï¼Œå½±å“æ€§èƒ½` |

**â° å®šæ—¶å…¨é‡åŒæ­¥ç­–ç•¥**ï¼š
```java
@Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹
public void fullSyncToES() {
    log.info("å¼€å§‹å…¨é‡åŒæ­¥å•†å“æ•°æ®åˆ°ES");
    
    // 1. åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰å•†å“
    int pageSize = 1000;
    int pageNum = 0;
    
    while (true) {
        List<Product> products = productService.findByPage(pageNum, pageSize);
        if (products.isEmpty()) break;
        
        // 2. æ‰¹é‡å‘é€åŒæ­¥æ¶ˆæ¯
        for (Product product : products) {
            ProductChangeEvent event = new ProductChangeEvent();
            event.setOperation("SYNC");
            event.setEntityId(product.getId());
            event.setNewData(product);
            
            rabbitTemplate.convertAndSend(
                "search.exchange",
                "search.product.sync", 
                event
            );
        }
        
        pageNum++;
        Thread.sleep(100); // é¿å…å¯¹æ•°æ®åº“é€ æˆå¤ªå¤§å‹åŠ›
    }
    
    log.info("å…¨é‡åŒæ­¥ä»»åŠ¡å®Œæˆ");
}
```

### 4.5 æœç´¢ç»“æœä¸€è‡´æ€§ä¿éšœ


**ğŸ¯ ä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶**ï¼š
```java
@Component
public class SearchConsistencyChecker {
    
    // å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkConsistency() {
        
        // 1. éšæœºæŠ½å–ä¸€äº›å•†å“ID
        List<Long> sampleIds = productService.getRandomProductIds(100);
        
        for (Long productId : sampleIds) {
            // 2. æ¯”è¾ƒæ•°æ®åº“å’ŒESä¸­çš„æ•°æ®
            Product dbProduct = productService.findById(productId);
            ProductDocument esProduct = esTemplate.get(productId.toString(), ProductDocument.class);
            
            if (!isConsistent(dbProduct, esProduct)) {
                // 3. å‘ç°ä¸ä¸€è‡´ï¼Œè§¦å‘é‡æ–°åŒæ­¥
                log.warn("å‘ç°æ•°æ®ä¸ä¸€è‡´ï¼Œå•†å“ID: {}", productId);
                triggerResync(productId);
            }
        }
    }
    
    private void triggerResync(Long productId) {
        // å‘é€é‡æ–°åŒæ­¥æ¶ˆæ¯
        rabbitTemplate.convertAndSend(
            "search.exchange",
            "search.product.resync",
            productId
        );
    }
}
```

---

## 5. ğŸ­ æ•°æ®ä»“åº“ETLæµç¨‹


### 5.1 ä»€ä¹ˆæ˜¯ETL


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> ETLå°±åƒå·¥å‚çš„ç”Ÿäº§æµæ°´çº¿ï¼šExtractï¼ˆæå–åŸæ–™ï¼‰ã€Transformï¼ˆåŠ å·¥å¤„ç†ï¼‰ã€Loadï¼ˆè£…ç®±å…¥åº“ï¼‰

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
```
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶æœæ±åº—ï¼š
Extractï¼ˆæå–ï¼‰ï¼šä»ä¸åŒä¾›åº”å•†é‡‡è´­å„ç§æ°´æœ
Transformï¼ˆè½¬æ¢ï¼‰ï¼šæ¸…æ´—ã€åˆ‡å—ã€æ¦¨æ±ã€è°ƒå‘³ã€è¿‡æ»¤  
Loadï¼ˆåŠ è½½ï¼‰ï¼šè£…ç“¶ã€è´´æ ‡ç­¾ã€æ”¾å…¥å†·è—åº“

æ•°æ®ä»“åº“ETLï¼š
Extractï¼šä»å„ä¸ªä¸šåŠ¡ç³»ç»Ÿæå–æ•°æ®
Transformï¼šæ¸…æ´—ã€æ ¼å¼åŒ–ã€èšåˆã€è®¡ç®—
Loadï¼šåŠ è½½åˆ°æ•°æ®ä»“åº“ä¾›åˆ†æä½¿ç”¨
```

### 5.2 åŸºäºRabbitMQçš„ETLæ¶æ„


**ğŸ—ï¸ ETLæµç¨‹æ¶æ„**ï¼š
```
ä¸šåŠ¡ç³»ç»Ÿæ•°æ®å˜æ›´
        â†“
    RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—
        â†“
    ETLå¤„ç†æœåŠ¡
    â”œâ”€â”€ Extractï¼šæå–å˜æ›´æ•°æ®
    â”œâ”€â”€ Transformï¼šæ•°æ®è½¬æ¢å¤„ç†  
    â””â”€â”€ Loadï¼šåŠ è½½åˆ°æ•°æ®ä»“åº“
        â†“
    æ•°æ®ä»“åº“ï¼ˆç”¨äºåˆ†æå’ŒæŠ¥è¡¨ï¼‰
```

### 5.3 å®æ—¶ETLå¤„ç†å®ç°


```java
@Component
public class RealtimeETLProcessor {
    
    @RabbitListener(queues = "etl.order.queue")
    public void processOrderData(OrderChangeEvent event) {
        
        try {
            // 1. Extract - æå–æ•°æ®
            OrderData rawData = extractOrderData(event);
            
            // 2. Transform - æ•°æ®è½¬æ¢
            OrderFactData factData = transformOrderData(rawData);
            
            // 3. Load - åŠ è½½åˆ°æ•°æ®ä»“åº“
            loadToDataWarehouse(factData);
            
        } catch (Exception e) {
            log.error("ETLå¤„ç†å¤±è´¥: {}", event.getEntityId(), e);
            // å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—è¿›è¡Œäººå·¥å¤„ç†
            handleETLFailure(event);
        }
    }
    
    private OrderFactData transformOrderData(OrderData raw) {
        return OrderFactData.builder()
            .orderId(raw.getId())
            .customerId(raw.getCustomerId())
            .productId(raw.getProductId())
            .orderAmount(raw.getAmount())
            .discountAmount(raw.getDiscountAmount())
            .finalAmount(raw.getAmount() - raw.getDiscountAmount())
            .orderDate(raw.getCreateTime())
            .orderHour(raw.getCreateTime().getHour())
            .orderWeekday(raw.getCreateTime().getDayOfWeek().getValue())
            .customerProvince(raw.getCustomerAddress().getProvince())
            .customerCity(raw.getCustomerAddress().getCity())
            .build();
    }
}
```

### 5.4 æ‰¹é‡ETLå¤„ç†


**â° å®šæ—¶æ‰¹é‡å¤„ç†**ï¼š
```java
@Component
public class BatchETLProcessor {
    
    @Scheduled(cron = "0 0 1 * * ?") // æ¯å¤©å‡Œæ™¨1ç‚¹
    public void processDailyBatch() {
        log.info("å¼€å§‹æ¯æ—¥æ‰¹é‡ETLå¤„ç†");
        
        // å¤„ç†æ˜¨å¤©çš„æ‰€æœ‰è®¢å•æ•°æ®
        LocalDate yesterday = LocalDate.now().minusDays(1);
        
        // 1. ä»æ¶ˆæ¯é˜Ÿåˆ—æ”¶é›†ä¸€å¤©çš„æ•°æ®
        List<OrderChangeEvent> dayEvents = collectDayEvents(yesterday);
        
        // 2. æ‰¹é‡è½¬æ¢å¤„ç†
        List<OrderFactData> factDataList = new ArrayList<>();
        for (OrderChangeEvent event : dayEvents) {
            OrderFactData factData = transformOrderData(event.getNewData());
            factDataList.add(factData);
        }
        
        // 3. æ‰¹é‡åŠ è½½åˆ°æ•°æ®ä»“åº“
        dataWarehouseService.batchInsert(factDataList);
        
        // 4. ç”Ÿæˆæ—¥æŠ¥æ•°æ®
        generateDailyReport(yesterday);
        
        log.info("æ¯æ—¥æ‰¹é‡ETLå¤„ç†å®Œæˆï¼Œå¤„ç†è®°å½•æ•°: {}", factDataList.size());
    }
}
```

### 5.5 ç»´åº¦è¡¨åŒæ­¥


**ğŸ“Š ç»´åº¦è¡¨ç®¡ç†**ï¼š
```
äº‹å®è¡¨ï¼šè®°å½•ä¸šåŠ¡äº‹ä»¶ï¼ˆå¦‚è®¢å•ã€æ”¯ä»˜ï¼‰
ç»´åº¦è¡¨ï¼šè®°å½•æè¿°ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ï¼‰

åŒæ­¥ç­–ç•¥ï¼š
ç”¨æˆ·ç»´åº¦è¡¨ â”€â”€> å½“ç”¨æˆ·ä¿¡æ¯å˜æ›´æ—¶ï¼ŒåŒæ­¥æ›´æ–°ç»´åº¦è¡¨
å•†å“ç»´åº¦è¡¨ â”€â”€> å½“å•†å“ä¿¡æ¯å˜æ›´æ—¶ï¼ŒåŒæ­¥æ›´æ–°ç»´åº¦è¡¨
æ—¶é—´ç»´åº¦è¡¨ â”€â”€> é¢„å…ˆç”Ÿæˆï¼ŒåŒ…å«æ—¥æœŸã€å‘¨ã€æœˆã€å­£åº¦ç­‰ä¿¡æ¯
```

```java
@RabbitListener(queues = "etl.dimension.user")
public void syncUserDimension(UserChangeEvent event) {
    
    UserDimension dimension = UserDimension.builder()
        .userId(event.getEntityId())
        .userName(event.getNewData().getName())
        .userAge(calculateAge(event.getNewData().getBirthday()))
        .userGender(event.getNewData().getGender())
        .userProvince(event.getNewData().getAddress().getProvince())
        .userCity(event.getNewData().getAddress().getCity())
        .userLevel(calculateUserLevel(event.getNewData()))
        .lastUpdateTime(System.currentTimeMillis())
        .build();
        
    // æ›´æ–°æ•°æ®ä»“åº“ä¸­çš„ç”¨æˆ·ç»´åº¦è¡¨
    dimensionService.saveOrUpdate(dimension);
}
```

---

## 6. âš”ï¸ å†²çªè§£å†³æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯æ•°æ®å†²çª


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> æ•°æ®å†²çªå°±åƒä¸¤ä¸ªäººåŒæ—¶ç¼–è¾‘åŒä¸€ä»½æ–‡æ¡£ï¼Œå¦‚æœä¸åè°ƒå°±ä¼šå‡ºç°æ··ä¹±

**ğŸ’¡ å¸¸è§å†²çªåœºæ™¯**ï¼š
```
åœºæ™¯1ï¼šå¹¶å‘æ›´æ–°å†²çª
ç”¨æˆ·A: 10:01 ä¿®æ”¹å•†å“ä»·æ ¼ä¸º 100å…ƒ
ç”¨æˆ·B: 10:02 ä¿®æ”¹å•†å“ä»·æ ¼ä¸º 120å…ƒ
é—®é¢˜ï¼šæœ€ç»ˆä»·æ ¼åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ

åœºæ™¯2ï¼šç½‘ç»œå»¶è¿Ÿå¯¼è‡´çš„ä¹±åº
æ¶ˆæ¯1: 10:01 åˆ›å»ºè®¢å•
æ¶ˆæ¯2: 10:02 å–æ¶ˆè®¢å•  
é—®é¢˜ï¼šå¦‚æœæ¶ˆæ¯2å…ˆåˆ°è¾¾ï¼Œä¼šå°è¯•å–æ¶ˆä¸å­˜åœ¨çš„è®¢å•

åœºæ™¯3ï¼šé‡å¤æ¶ˆæ¯
ç”±äºç½‘ç»œé‡ä¼ ï¼ŒåŒä¸€ä¸ªæ›´æ–°æ¶ˆæ¯è¢«å¤„ç†äº†ä¸¤æ¬¡
é—®é¢˜ï¼šå¯èƒ½å¯¼è‡´æ•°æ®é”™è¯¯ç´¯ç§¯
```

### 6.2 åŸºäºæ—¶é—´æˆ³çš„å†²çªè§£å†³


**â° æœ€åå†™å…¥è·èƒœï¼ˆLast Write Winsï¼‰**ï¼š
```java
@Component
public class TimestampBasedConflictResolver {
    
    @RabbitListener(queues = "sync.product.update")
    public void handleProductUpdate(ProductChangeEvent event) {
        
        // è·å–å½“å‰æ•°æ®åº“ä¸­çš„è®°å½•
        Product currentProduct = productService.findById(event.getEntityId());
        
        // æ¯”è¾ƒæ—¶é—´æˆ³
        if (currentProduct != null && 
            currentProduct.getUpdateTime() > event.getTimestamp()) {
            
            log.warn("æ”¶åˆ°è¿‡æœŸçš„æ›´æ–°æ¶ˆæ¯ï¼Œå¿½ç•¥å¤„ç†. äº§å“ID: {}, " +
                    "å½“å‰æ—¶é—´æˆ³: {}, æ¶ˆæ¯æ—¶é—´æˆ³: {}", 
                    event.getEntityId(), 
                    currentProduct.getUpdateTime(), 
                    event.getTimestamp());
            return;
        }
        
        // åº”ç”¨æ›´æ–°
        Product updatedProduct = event.getNewData();
        updatedProduct.setUpdateTime(event.getTimestamp());
        productService.save(updatedProduct);
        
        log.info("äº§å“æ›´æ–°æˆåŠŸ: {}", event.getEntityId());
    }
}
```

### 6.3 åŸºäºç‰ˆæœ¬å·çš„å†²çªè§£å†³


**ğŸ”¢ ä¹è§‚é”æœºåˆ¶**ï¼š
```java
// æ•°æ®å®ä½“å¢åŠ ç‰ˆæœ¬å­—æ®µ
@Entity
public class Product {
    private Long id;
    private String name;
    private BigDecimal price;
    
    @Version
    private Long version; // ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°è‡ªåŠ¨é€’å¢
    
    // getter/setter...
}

// å†²çªè§£å†³å¤„ç†
@RabbitListener(queues = "sync.product.version")
public void handleVersionBasedUpdate(ProductVersionEvent event) {
    
    try {
        Product product = event.getProductData();
        
        // è®¾ç½®æœŸæœ›çš„ç‰ˆæœ¬å·
        product.setVersion(event.getExpectedVersion());
        
        // å°è¯•æ›´æ–°ï¼ˆå¦‚æœç‰ˆæœ¬ä¸åŒ¹é…ä¼šæŠ›å¼‚å¸¸ï¼‰
        productService.updateWithVersion(product);
        
        log.info("ç‰ˆæœ¬åŒ–æ›´æ–°æˆåŠŸ: äº§å“ID={}, ç‰ˆæœ¬={}", 
                product.getId(), product.getVersion());
                
    } catch (OptimisticLockingFailureException e) {
        
        log.warn("ç‰ˆæœ¬å†²çªï¼Œè§¦å‘å†²çªè§£å†³æµç¨‹: {}", event.getProductId());
        
        // å‘é€å†²çªè§£å†³æ¶ˆæ¯
        ConflictResolutionEvent conflictEvent = new ConflictResolutionEvent();
        conflictEvent.setEntityType("Product");
        conflictEvent.setEntityId(event.getProductId());
        conflictEvent.setConflictType("VERSION_MISMATCH");
        conflictEvent.setOriginalEvent(event);
        
        rabbitTemplate.convertAndSend(
            "conflict.exchange",
            "conflict.resolution",
            conflictEvent
        );
    }
}
```

### 6.4 åŸºäºä¸šåŠ¡è§„åˆ™çš„å†²çªè§£å†³


**ğŸ¯ ä¸šåŠ¡ä¼˜å…ˆçº§è§£å†³**ï¼š
```java
@Component
public class BusinessRuleConflictResolver {
    
    @RabbitListener(queues = "conflict.resolution")
    public void resolveConflict(ConflictResolutionEvent event) {
        
        if ("Product".equals(event.getEntityType())) {
            resolveProductConflict(event);
        }
    }
    
    private void resolveProductConflict(ConflictResolutionEvent event) {
        
        // è·å–å†²çªçš„ä¸¤ä¸ªç‰ˆæœ¬
        Product currentVersion = productService.findById(event.getEntityId());
        Product eventVersion = event.getOriginalEvent().getProductData();
        
        // åº”ç”¨ä¸šåŠ¡è§„åˆ™è§£å†³å†²çª
        Product resolvedProduct = new Product();
        resolvedProduct.setId(currentVersion.getId());
        
        // è§„åˆ™1ï¼šä»·æ ¼å–è¾ƒé«˜å€¼ï¼ˆä¿æŠ¤æ”¶ç›Šï¼‰
        resolvedProduct.setPrice(
            currentVersion.getPrice().compareTo(eventVersion.getPrice()) > 0 
                ? currentVersion.getPrice() 
                : eventVersion.getPrice()
        );
        
        // è§„åˆ™2ï¼šåº“å­˜å–è¾ƒä½å€¼ï¼ˆé¿å…è¶…å–ï¼‰
        resolvedProduct.setStock(
            Math.min(currentVersion.getStock(), eventVersion.getStock())
        );
        
        // è§„åˆ™3ï¼šæè¿°ä¿¡æ¯å–æœ€æ–°ç‰ˆæœ¬
        resolvedProduct.setDescription(
            currentVersion.getUpdateTime() > eventVersion.getUpdateTime()
                ? currentVersion.getDescription()
                : eventVersion.getDescription()
        );
        
        // å¼ºåˆ¶æ›´æ–°ï¼ˆè·³è¿‡ç‰ˆæœ¬æ£€æŸ¥ï¼‰
        productService.forceUpdate(resolvedProduct);
        
        log.info("ä¸šåŠ¡è§„åˆ™å†²çªè§£å†³å®Œæˆ: {}", event.getEntityId());
    }
}
```

### 6.5 æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ


**ğŸ”„ é˜²æ­¢é‡å¤å¤„ç†**ï¼š
```java
@Component
public class IdempotentMessageHandler {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @RabbitListener(queues = "sync.order.payment")
    public void handlePaymentSync(PaymentEvent event) {
        
        // æ„å»ºå¹‚ç­‰æ€§æ£€æŸ¥key
        String idempotentKey = "payment:processed:" + event.getEventId();
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡
        Boolean isProcessed = redisTemplate.opsForValue()
            .setIfAbsent(idempotentKey, "1", Duration.ofHours(24));
            
        if (!isProcessed) {
            log.info("æ¶ˆæ¯å·²å¤„ç†è¿‡ï¼Œè·³è¿‡: {}", event.getEventId());
            return;
        }
        
        try {
            // å¤„ç†æ”¯ä»˜åŒæ­¥é€»è¾‘
            processPaymentSync(event);
            
            log.info("æ”¯ä»˜åŒæ­¥å¤„ç†å®Œæˆ: {}", event.getEventId());
            
        } catch (Exception e) {
            // å¤„ç†å¤±è´¥ï¼Œåˆ é™¤å¹‚ç­‰æ€§æ ‡è®°ï¼Œå…è®¸é‡è¯•
            redisTemplate.delete(idempotentKey);
            throw e;
        }
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®åŒæ­¥æœ¬è´¨ï¼šè®©å¤šä¸ªç³»ç»Ÿä¿æŒæ•°æ®ä¸€è‡´æ€§
ğŸ”¸ å˜æ›´æ•è·ï¼šç›‘æ§æ•°æ®å˜åŒ–å¹¶åŠæ—¶é€šçŸ¥ç›¸å…³ç³»ç»Ÿ  
ğŸ”¸ ç¼“å­˜åŒæ­¥ï¼šä¿è¯ç¼“å­˜æ•°æ®ä¸ä¸»æ•°æ®åº“ä¸€è‡´
ğŸ”¸ æœç´¢åŒæ­¥ï¼šç»´æŠ¤æœç´¢å¼•æ“ç´¢å¼•çš„å‡†ç¡®æ€§
ğŸ”¸ ETLæµç¨‹ï¼šæå–ã€è½¬æ¢ã€åŠ è½½æ•°æ®åˆ°æ•°æ®ä»“åº“
ğŸ”¸ å†²çªè§£å†³ï¼šå¤„ç†å¹¶å‘æ›´æ–°å’Œæ•°æ®ä¸ä¸€è‡´é—®é¢˜
```

### 7.2 å…³é”®è®¾è®¡åŸåˆ™


**ğŸ¯ å¯é æ€§ä¼˜å…ˆ**ï¼š
```
æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼š
âœ… ç”Ÿäº§è€…ç¡®è®¤ï¼šç¡®ä¿æ¶ˆæ¯æˆåŠŸå‘é€åˆ°MQ
âœ… æ¶ˆè´¹è€…ç¡®è®¤ï¼šç¡®ä¿æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†
âœ… æŒä¹…åŒ–ä¿è¯ï¼šæ¶ˆæ¯ä¸ä¼šå› ä¸ºé‡å¯è€Œä¸¢å¤±

é”™è¯¯å¤„ç†ï¼š
âœ… é‡è¯•æœºåˆ¶ï¼šä¸´æ—¶å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
âœ… æ­»ä¿¡é˜Ÿåˆ—ï¼šå¤„ç†æœ€ç»ˆå¤±è´¥çš„æ¶ˆæ¯
âœ… ç›‘æ§å‘Šè­¦ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†å¼‚å¸¸
```

**âš¡ æ€§èƒ½è€ƒè™‘**ï¼š
```
æ‰¹é‡å¤„ç†ï¼š
âœ… æ‰¹é‡å‘é€æ¶ˆæ¯å‡å°‘ç½‘ç»œå¼€é”€
âœ… æ‰¹é‡æ›´æ–°æ•°æ®åº“å‡å°‘IOå¼€é”€
âœ… æ‰¹é‡ç´¢å¼•æ›´æ–°æé«˜æœç´¢å¼•æ“æ€§èƒ½

å¼‚æ­¥å¤„ç†ï¼š
âœ… ä¸é˜»å¡ä¸»ä¸šåŠ¡æµç¨‹
âœ… é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ç³»ç»Ÿ
âœ… æé«˜ç³»ç»Ÿæ•´ä½“ååé‡
```

### 7.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ“Š åŒæ­¥ç­–ç•¥é€‰æ‹©**ï¼š

| ä¸šåŠ¡åœºæ™¯ | **æ¨èç­–ç•¥** | **åŸå› ** |
|---------|------------|---------|
| ğŸ’° **é‡‘èäº¤æ˜“** | `å¼ºä¸€è‡´æ€§åŒæ­¥` | `æ•°æ®å‡†ç¡®æ€§è¦æ±‚æé«˜` |
| ğŸ›’ **ç”µå•†å•†å“** | `æœ€ç»ˆä¸€è‡´æ€§` | `å…è®¸çŸ­æš‚ä¸ä¸€è‡´ï¼Œæ€§èƒ½ä¼˜å…ˆ` |  
| ğŸ“Š **æ•°æ®åˆ†æ** | `æ‰¹é‡ETL` | `å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œæ•°æ®é‡å¤§` |
| ğŸ” **æœç´¢åŠŸèƒ½** | `å‡†å®æ—¶åŒæ­¥` | `å¹³è¡¡å®æ—¶æ€§å’Œæ€§èƒ½` |

**ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®**ï¼š
```
å°å‹ç³»ç»Ÿï¼ˆ<10ä¸‡ç”¨æˆ·ï¼‰ï¼š
â”œâ”€â”€ åº”ç”¨å±‚å˜æ›´æ•è·
â”œâ”€â”€ Redisç¼“å­˜åŒæ­¥
â”œâ”€â”€ ç®€å•çš„ESåŒæ­¥
â””â”€â”€ å®šæ—¶æ‰¹é‡ETL

ä¸­å‹ç³»ç»Ÿï¼ˆ10ä¸‡-100ä¸‡ç”¨æˆ·ï¼‰ï¼š
â”œâ”€â”€ æ•°æ®åº“è§¦å‘å™¨ + MQ
â”œâ”€â”€ å¤šçº§ç¼“å­˜åŒæ­¥
â”œâ”€â”€ å®æ—¶æœç´¢ç´¢å¼•æ›´æ–°
â””â”€â”€ æµå¼ETLå¤„ç†

å¤§å‹ç³»ç»Ÿï¼ˆ>100ä¸‡ç”¨æˆ·ï¼‰ï¼š
â”œâ”€â”€ CDC + Kafka/RabbitMQ
â”œâ”€â”€ åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤
â”œâ”€â”€ æœç´¢å¼•æ“é›†ç¾¤åŒæ­¥
â””â”€â”€ å®æ—¶æ•°æ®ä»“åº“
```

### 7.4 ç›‘æ§å’Œè¿ç»´è¦ç‚¹


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```
æ¶ˆæ¯å¤„ç†æŒ‡æ ‡ï¼š
- æ¶ˆæ¯å‘é€æˆåŠŸç‡
- æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ  
- é˜Ÿåˆ—ç§¯å‹æ•°é‡
- æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦

æ•°æ®ä¸€è‡´æ€§æŒ‡æ ‡ï¼š
- åŒæ­¥å»¶è¿Ÿæ—¶é—´
- æ•°æ®ä¸ä¸€è‡´æ¬¡æ•°
- å†²çªè§£å†³æˆåŠŸç‡
- é‡è¯•å’Œå¤±è´¥æ¬¡æ•°
```

**ğŸš¨ å‘Šè­¦è®¾ç½®**ï¼š
```python
# ç›‘æ§è§„åˆ™ç¤ºä¾‹
å‘Šè­¦è§„åˆ™ï¼š
- é˜Ÿåˆ—ç§¯å‹ > 1000æ¡æ¶ˆæ¯
- åŒæ­¥å»¶è¿Ÿ > 5åˆ†é’Ÿ  
- æ•°æ®ä¸ä¸€è‡´ç‡ > 0.1%
- è¿ç»­å¤±è´¥ > 10æ¬¡

å¤„ç†æ­¥éª¤ï¼š
1. ç«‹å³é€šçŸ¥ç›¸å…³è´Ÿè´£äºº
2. è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ–¹æ¡ˆ
3. è®°å½•è¯¦ç»†æ—¥å¿—ä¾¿äºæ’æŸ¥
4. ç”Ÿæˆæ•…éšœæŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®
```

**ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“**ï¼š
- **è®¾è®¡æ—¶è€ƒè™‘å¤±è´¥**ï¼šå‡è®¾ç½‘ç»œä¼šæ–­å¼€ã€æœåŠ¡ä¼šå´©æºƒ
- **å°æ­¥å¿«è·‘**ï¼šå…ˆå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå†é€æ­¥ä¼˜åŒ–
- **ç›‘æ§å…ˆè¡Œ**ï¼šåœ¨å‡ºé—®é¢˜ä¹‹å‰å°±è¦çŸ¥é“å¯èƒ½å‡ºé—®é¢˜
- **æ–‡æ¡£é½å…¨**ï¼šæ¸…æ¥šè®°å½•æ¯ä¸ªæ¶ˆæ¯çš„æ ¼å¼å’Œå¤„ç†é€»è¾‘

**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
æ•°æ®åŒæ­¥è¦å¯é ï¼Œæ¶ˆæ¯ç¡®è®¤ä¸èƒ½å°‘
ç¼“å­˜æœç´¢è¦åŠæ—¶ï¼ŒETLæ‰¹é‡æ•ˆç‡é«˜  
å†²çªè§£å†³æœ‰ç­–ç•¥ï¼Œå¹‚ç­‰å¤„ç†é˜²é‡å¤
ç›‘æ§å‘Šè­¦è¦åˆ°ä½ï¼Œæ•…éšœæ’æŸ¥æœ‰ä¾æ®
```