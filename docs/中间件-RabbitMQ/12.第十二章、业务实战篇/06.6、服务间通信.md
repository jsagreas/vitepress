---
title: 6ã€æœåŠ¡é—´é€šä¿¡
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡é€šä¿¡åŸºç¡€æ¦‚å¿µ](#1-å¾®æœåŠ¡é€šä¿¡åŸºç¡€æ¦‚å¿µ)
2. [äº‹ä»¶é©±åŠ¨æ¶æ„åŸç†](#2-äº‹ä»¶é©±åŠ¨æ¶æ„åŸç†)
3. [æœåŠ¡è§£è€¦è®¾è®¡æ¨¡å¼](#3-æœåŠ¡è§£è€¦è®¾è®¡æ¨¡å¼)
4. [æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶](#4-æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶)
5. [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ç­–ç•¥](#5-åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ç­–ç•¥)
6. [æœåŠ¡æ²»ç†æœ€ä½³å®è·µ](#6-æœåŠ¡æ²»ç†æœ€ä½³å®è·µ)
7. [å®æˆ˜åº”ç”¨æ¡ˆä¾‹](#7-å®æˆ˜åº”ç”¨æ¡ˆä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å¾®æœåŠ¡é€šä¿¡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡é€šä¿¡


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸ªå¤§å‹è´­ç‰©ä¸­å¿ƒï¼Œæ¯ä¸ªåº—é“ºéƒ½æ˜¯ç‹¬ç«‹çš„"å¾®æœåŠ¡"ã€‚é¡¾å®¢ä¸‹å•ä¹°è¡£æœæ—¶ï¼Œæœè£…åº—éœ€è¦é€šçŸ¥ä»“åº“å‘è´§ï¼Œä»“åº“éœ€è¦å‘Šè¯‰ç‰©æµé…é€ï¼Œç‰©æµå®Œæˆåè¦é€šçŸ¥è´¢åŠ¡ç»“ç®—ã€‚è¿™äº›åº—é“ºä¹‹é—´çš„"æ¶ˆæ¯ä¼ é€’"å°±æ˜¯å¾®æœåŠ¡é€šä¿¡ã€‚

**ğŸ’¡ æ ¸å¿ƒå®šä¹‰**
```
å¾®æœåŠ¡é€šä¿¡ï¼šä¸åŒæœåŠ¡ä¹‹é—´ä¼ é€’ä¿¡æ¯å’Œåè°ƒå·¥ä½œçš„æ–¹å¼

ä¸ºä»€ä¹ˆéœ€è¦é€šä¿¡ï¼Ÿ
- ä¸šåŠ¡æµç¨‹ï¼šä¸€ä¸ªç”¨æˆ·æ“ä½œå¯èƒ½æ¶‰åŠå¤šä¸ªæœåŠ¡
- æ•°æ®å…±äº«ï¼šæœåŠ¡é—´éœ€è¦äº¤æ¢å¿…è¦çš„ä¿¡æ¯
- çŠ¶æ€åŒæ­¥ï¼šä¿æŒå„æœåŠ¡æ•°æ®çš„ä¸€è‡´æ€§
```

### 1.2 ä¼ ç»Ÿæ–¹å¼ vs RabbitMQæ–¹å¼


**ğŸ“Š å¯¹æ¯”åˆ†æ**

| é€šä¿¡æ–¹å¼ | **ä¼ ç»ŸHTTPè°ƒç”¨** | **RabbitMQæ¶ˆæ¯** |
|---------|----------------|-----------------|
| ğŸ”— **è¿æ¥æ–¹å¼** | `ç›´æ¥è°ƒç”¨API` | `æ¶ˆæ¯é˜Ÿåˆ—ä¸­è½¬` |
| â±ï¸ **å“åº”è¦æ±‚** | `åŒæ­¥ç­‰å¾…ç»“æœ` | `å¼‚æ­¥å¤„ç†æ¶ˆæ¯` |
| ğŸ”§ **æ•…éšœå¤„ç†** | `è°ƒç”¨å¤±è´¥æ•´ä½“å¤±è´¥` | `æ¶ˆæ¯å¯é‡è¯•å’ŒæŒä¹…åŒ–` |
| ğŸ“ˆ **æ‰©å±•æ€§** | `æœåŠ¡æ•°é‡å¢åŠ å¤æ‚åº¦æ¿€å¢` | `æ–°å¢æœåŠ¡åªéœ€è®¢é˜…æ¶ˆæ¯` |
| ğŸ¯ **è€¦åˆåº¦** | `æœåŠ¡é—´ç´§è€¦åˆ` | `æ¾è€¦åˆï¼ŒæœåŠ¡ç‹¬ç«‹` |

**ğŸ” æ·±å…¥ç†è§£**
```
ä¼ ç»Ÿæ–¹å¼é—®é¢˜ï¼š
ç”¨æˆ·ä¸‹å• â†’ ç›´æ¥è°ƒç”¨åº“å­˜æœåŠ¡ â†’ ç›´æ¥è°ƒç”¨æ”¯ä»˜æœåŠ¡ â†’ ç›´æ¥è°ƒç”¨ç‰©æµæœåŠ¡

å¦‚æœæ”¯ä»˜æœåŠ¡æŒ‚äº†ï¼Œæ•´ä¸ªæµç¨‹å°±å¡ä½äº†ï¼

RabbitMQæ–¹å¼ä¼˜åŠ¿ï¼š
ç”¨æˆ·ä¸‹å• â†’ å‘é€"è®¢å•åˆ›å»º"æ¶ˆæ¯
åº“å­˜æœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ å¤„ç†åº“å­˜ â†’ å‘é€"åº“å­˜ç¡®è®¤"æ¶ˆæ¯
æ”¯ä»˜æœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ å¤„ç†æ”¯ä»˜ â†’ å‘é€"æ”¯ä»˜å®Œæˆ"æ¶ˆæ¯
ç‰©æµæœåŠ¡æ”¶åˆ°æ¶ˆæ¯ â†’ å®‰æ’å‘è´§

å³ä½¿æŸä¸ªæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œæ¶ˆæ¯ä¼šç­‰å¾…å®ƒæ¢å¤åå¤„ç†
```

### 1.3 å¾®æœåŠ¡é€šä¿¡çš„æŒ‘æˆ˜


**âš ï¸ å¸¸è§é—®é¢˜**
- **ç½‘ç»œå»¶è¿Ÿ**ï¼šæœåŠ¡åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Š
- **æœåŠ¡æ•…éšœ**ï¼šæŸä¸ªæœåŠ¡å¯èƒ½ä¸´æ—¶ä¸å¯ç”¨
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå¦‚ä½•ä¿è¯æ‰€æœ‰æœåŠ¡æ•°æ®åŒæ­¥
- **æ¶ˆæ¯ä¸¢å¤±**ï¼šç½‘ç»œé—®é¢˜å¯èƒ½å¯¼è‡´æ¶ˆæ¯å¤±æ•ˆ
- **é‡å¤å¤„ç†**ï¼šåŒä¸€æ¶ˆæ¯å¯èƒ½è¢«å¤šæ¬¡å¤„ç†

**ğŸ¯ RabbitMQçš„è§£å†³æ–¹æ¡ˆ**
```
å¯é æ€§ä¿è¯ï¼š
âœ… æ¶ˆæ¯æŒä¹…åŒ– - é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±
âœ… ç¡®è®¤æœºåˆ¶ - ä¿è¯æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†
âœ… é‡è¯•ç­–ç•¥ - å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
âœ… æ­»ä¿¡é˜Ÿåˆ— - å¤„ç†æ— æ³•å¤„ç†çš„æ¶ˆæ¯
```

---

## 2. ğŸš€ äº‹ä»¶é©±åŠ¨æ¶æ„åŸç†


### 2.1 ä»€ä¹ˆæ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> å°±åƒä½ å®¶çš„æ™ºèƒ½å®¶å±…ç³»ç»Ÿï¼šé—¨é”æ„Ÿåº”åˆ°ä½ å›å®¶äº†ï¼ˆäº‹ä»¶ï¼‰ï¼Œè‡ªåŠ¨å¼€ç¯ã€è°ƒèŠ‚æ¸©åº¦ã€æ’­æ”¾éŸ³ä¹ï¼ˆå“åº”ï¼‰ã€‚æ¯ä¸ªè®¾å¤‡ä¸éœ€è¦çŸ¥é“å…¶ä»–è®¾å¤‡çš„å­˜åœ¨ï¼Œåªéœ€è¦å¯¹"ä¸»äººå›å®¶"è¿™ä¸ªäº‹ä»¶åšå‡ºè‡ªå·±çš„å“åº”ã€‚

**ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µ**
```
äº‹ä»¶ï¼ˆEventï¼‰ï¼šç³»ç»Ÿä¸­å‘ç”Ÿçš„é‡è¦äº‹æƒ…
æ¯”å¦‚ï¼šç”¨æˆ·æ³¨å†Œã€è®¢å•æ”¯ä»˜ã€å•†å“åº“å­˜å˜åŒ–

äº‹ä»¶å‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼šäº§ç”Ÿäº‹ä»¶çš„æœåŠ¡
æ¯”å¦‚ï¼šç”¨æˆ·æœåŠ¡å‘å¸ƒ"ç”¨æˆ·æ³¨å†Œ"äº‹ä»¶

äº‹ä»¶è®¢é˜…è€…ï¼ˆSubscriberï¼‰ï¼šå¤„ç†äº‹ä»¶çš„æœåŠ¡  
æ¯”å¦‚ï¼šé‚®ä»¶æœåŠ¡è®¢é˜…"ç”¨æˆ·æ³¨å†Œ"äº‹ä»¶ï¼Œå‘é€æ¬¢è¿é‚®ä»¶
```

### 2.2 äº‹ä»¶é©±åŠ¨æ¶æ„çš„æ ¸å¿ƒä¼˜åŠ¿


**ğŸ” æ·±å…¥åˆ†æ**

**ä¼˜åŠ¿1ï¼šè§£è€¦åˆ**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç”¨æˆ·æ³¨å†Œ â†’ ç”¨æˆ·æœåŠ¡ç›´æ¥è°ƒç”¨é‚®ä»¶æœåŠ¡
         â†’ ç”¨æˆ·æœåŠ¡ç›´æ¥è°ƒç”¨ç§¯åˆ†æœåŠ¡
         â†’ ç”¨æˆ·æœåŠ¡ç›´æ¥è°ƒç”¨æ¨èæœåŠ¡

é—®é¢˜ï¼šç”¨æˆ·æœåŠ¡éœ€è¦çŸ¥é“æ‰€æœ‰ç›¸å…³æœåŠ¡

äº‹ä»¶é©±åŠ¨æ–¹å¼ï¼š
ç”¨æˆ·æ³¨å†Œ â†’ ç”¨æˆ·æœåŠ¡å‘å¸ƒ"ç”¨æˆ·æ³¨å†Œ"äº‹ä»¶
é‚®ä»¶æœåŠ¡è‡ªåŠ¨æ”¶åˆ°äº‹ä»¶ â†’ å‘é€æ¬¢è¿é‚®ä»¶
ç§¯åˆ†æœåŠ¡è‡ªåŠ¨æ”¶åˆ°äº‹ä»¶ â†’ èµ é€æ–°ç”¨æˆ·ç§¯åˆ†
æ¨èæœåŠ¡è‡ªåŠ¨æ”¶åˆ°äº‹ä»¶ â†’ ç”Ÿæˆä¸ªæ€§åŒ–æ¨è

ä¼˜åŠ¿ï¼šç”¨æˆ·æœåŠ¡åªéœ€å‘å¸ƒäº‹ä»¶ï¼Œä¸å…³å¿ƒè°æ¥å¤„ç†
```

**ä¼˜åŠ¿2ï¼šå¯æ‰©å±•æ€§**
```
æ–°å¢åŠŸèƒ½åœºæ™¯ï¼š
éœ€æ±‚ï¼šæ–°ç”¨æˆ·æ³¨å†Œåï¼Œèµ é€ä¼˜æƒ åˆ¸

ä¼ ç»Ÿæ–¹å¼ï¼šä¿®æ”¹ç”¨æˆ·æœåŠ¡ä»£ç ï¼Œå¢åŠ è°ƒç”¨ä¼˜æƒ åˆ¸æœåŠ¡
äº‹ä»¶é©±åŠ¨ï¼šä¼˜æƒ åˆ¸æœåŠ¡ç›´æ¥è®¢é˜…"ç”¨æˆ·æ³¨å†Œ"äº‹ä»¶å³å¯

æ— éœ€ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç ï¼
```

### 2.3 äº‹ä»¶è®¾è®¡æœ€ä½³å®è·µ


**ğŸ“ äº‹ä»¶å‘½åè§„èŒƒ**
```
åŠ¨è¯è¿‡å»å¼ + ä¸»ä½“ + è¯¦ç»†ä¿¡æ¯

å¥½çš„äº‹ä»¶åï¼š
- UserRegisteredï¼ˆç”¨æˆ·å·²æ³¨å†Œï¼‰
- OrderPaidï¼ˆè®¢å•å·²æ”¯ä»˜ï¼‰  
- ProductStockUpdatedï¼ˆå•†å“åº“å­˜å·²æ›´æ–°ï¼‰

é¿å…çš„äº‹ä»¶åï¼š
- Userï¼ˆå¤ªæ¨¡ç³Šï¼‰
- RegisterUserï¼ˆå‘½ä»¤å¼ï¼Œä¸æ˜¯äº‹ä»¶ï¼‰
- UserInfoï¼ˆä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼‰
```

**ğŸ’¡ äº‹ä»¶å†…å®¹è®¾è®¡**
```json
{
  "eventId": "uuid-1234",           // äº‹ä»¶å”¯ä¸€ID
  "eventType": "UserRegistered",    // äº‹ä»¶ç±»å‹
  "timestamp": "2024-01-01T10:00:00Z", // å‘ç”Ÿæ—¶é—´
  "source": "user-service",         // äº‹ä»¶æ¥æº
  "data": {                         // äº‹ä»¶æ•°æ®
    "userId": "12345",
    "email": "user@example.com",
    "registrationTime": "2024-01-01T10:00:00Z"
  }
}
```

**ğŸ¯ å…³é”®è®¾è®¡åŸåˆ™**
- **æœ€å°å¿…è¦ä¿¡æ¯**ï¼šåªåŒ…å«å¤„ç†äº‹ä»¶éœ€è¦çš„æ ¸å¿ƒæ•°æ®
- **ä¸å¯å˜æ€§**ï¼šäº‹ä»¶ä¸€æ—¦å‘å¸ƒå°±ä¸èƒ½ä¿®æ”¹
- **å‘åå…¼å®¹**ï¼šæ–°ç‰ˆæœ¬äº‹ä»¶è¦å…¼å®¹æ—§ç‰ˆæœ¬çš„å¤„ç†å™¨

---

## 3. ğŸ”§ æœåŠ¡è§£è€¦è®¾è®¡æ¨¡å¼


### 3.1 è§£è€¦çš„æœ¬è´¨ç†è§£


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> ä¼ ç»Ÿçš„ç´§è€¦åˆå°±åƒæ‰€æœ‰å®¶ç”µéƒ½ç”¨ä¸€æ ¹ç”µçº¿ä¸²è”ï¼Œä¸€ä¸ªåäº†å…¨éƒ¨åœç”µã€‚è§£è€¦åçš„ç³»ç»Ÿå°±åƒæ¯ä¸ªå®¶ç”µéƒ½æœ‰ç‹¬ç«‹æ’åº§ï¼Œäº’ä¸å½±å“ï¼Œè¿˜å¯ä»¥éšæ—¶å¢åŠ æ–°ç”µå™¨ã€‚

**ğŸ’¡ è§£è€¦çš„æ ¸å¿ƒä»·å€¼**
```
ç‹¬ç«‹æ€§ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±•
çµæ´»æ€§ï¼šå¯ä»¥éšæ—¶å¢åŠ ã€ç§»é™¤ã€ä¿®æ”¹æœåŠ¡
å¯é æ€§ï¼šå•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿ
å¯æµ‹è¯•æ€§ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥ç‹¬ç«‹æµ‹è¯•
```

### 3.2 å¸¸ç”¨è§£è€¦æ¨¡å¼


#### ğŸ“¬ å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆPub/Subï¼‰


**åŸºæœ¬åŸç†**
```
å‘å¸ƒè€… â†’ äº¤æ¢æœº â†’ é˜Ÿåˆ—1ï¼ˆè®¢é˜…è€…Aï¼‰
                â†’ é˜Ÿåˆ—2ï¼ˆè®¢é˜…è€…Bï¼‰
                â†’ é˜Ÿåˆ—3ï¼ˆè®¢é˜…è€…Cï¼‰

ç‰¹ç‚¹ï¼š
- ä¸€ä¸ªäº‹ä»¶å¯ä»¥è¢«å¤šä¸ªæœåŠ¡å¤„ç†
- å‘å¸ƒè€…ä¸çŸ¥é“æœ‰å“ªäº›è®¢é˜…è€…
- æ–°å¢è®¢é˜…è€…ä¸å½±å“å‘å¸ƒè€…
```

**å®é™…åº”ç”¨ç¤ºä¾‹**
```java
// å‘å¸ƒè€…ï¼šè®¢å•æœåŠ¡
public class OrderService {
    public void createOrder(Order order) {
        // å¤„ç†è®¢å•é€»è¾‘
        saveOrder(order);
        
        // å‘å¸ƒäº‹ä»¶ï¼Œä¸å…³å¿ƒè°æ¥å¤„ç†
        eventPublisher.publish("OrderCreated", order);
    }
}

// è®¢é˜…è€…1ï¼šåº“å­˜æœåŠ¡
public class InventoryService {
    @EventListener("OrderCreated")
    public void handleOrderCreated(Order order) {
        // å‡å°‘åº“å­˜
        updateInventory(order.getItems());
    }
}

// è®¢é˜…è€…2ï¼šé‚®ä»¶æœåŠ¡
public class EmailService {
    @EventListener("OrderCreated")
    public void handleOrderCreated(Order order) {
        // å‘é€ç¡®è®¤é‚®ä»¶
        sendConfirmationEmail(order);
    }
}
```

#### ğŸ”„ è¯·æ±‚-å“åº”æ¨¡å¼ï¼ˆRequest/Replyï¼‰


**ä½¿ç”¨åœºæ™¯**
```
éœ€è¦è·å–è¿”å›ç»“æœçš„åœºæ™¯ï¼š
- ç”¨æˆ·æŸ¥è¯¢è®¢å•çŠ¶æ€
- è®¡ç®—å•†å“ä»·æ ¼
- éªŒè¯ç”¨æˆ·æƒé™

å®ç°æ–¹å¼ï¼š
è¯·æ±‚é˜Ÿåˆ—ï¼šuser.query.request
å“åº”é˜Ÿåˆ—ï¼šuser.query.response.{correlationId}
```

#### ğŸ“¨ ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼ˆPoint-to-Pointï¼‰


**ä½¿ç”¨åœºæ™¯**
```
ä¸€å¯¹ä¸€ä»»åŠ¡åˆ†å‘ï¼š
- è®¢å•å¤„ç†ä»»åŠ¡
- æ–‡ä»¶ä¸Šä¼ å¤„ç†
- æ•°æ®åŒæ­¥ä»»åŠ¡

ç‰¹ç‚¹ï¼š
- ä¸€ä¸ªæ¶ˆæ¯åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†
- é€‚åˆå·¥ä½œé˜Ÿåˆ—åœºæ™¯
- æ”¯æŒè´Ÿè½½å‡è¡¡
```

### 3.3 è§£è€¦è®¾è®¡çš„å®æ–½ç­–ç•¥


**ğŸ“Š æ¸è¿›å¼è§£è€¦è·¯å¾„**

```
ç¬¬ä¸€é˜¶æ®µï¼šè¯†åˆ«è¾¹ç•Œ
ç°æœ‰ç³»ç»Ÿ â†’ è¯†åˆ«æœåŠ¡è¾¹ç•Œ â†’ å®šä¹‰æ¥å£

ç¬¬äºŒé˜¶æ®µï¼šå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—
åŒæ­¥è°ƒç”¨ â†’ å¼‚æ­¥æ¶ˆæ¯ â†’ é€æ­¥æ›¿æ¢

ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå…¨è§£è€¦
ç›´æ¥ä¾èµ– â†’ äº‹ä»¶é©±åŠ¨ â†’ æœåŠ¡è‡ªæ²»
```

**âš ï¸ è§£è€¦æ³¨æ„äº‹é¡¹**
- **ä¸è¦è¿‡åº¦è§£è€¦**ï¼šä¸æ˜¯æ‰€æœ‰äº¤äº’éƒ½éœ€è¦å¼‚æ­¥
- **ä¿æŒäº‹åŠ¡è¾¹ç•Œ**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¦ä¿æŒä¸€è‡´æ€§
- **ç›‘æ§å¤æ‚åº¦**ï¼šå¼‚æ­¥ç³»ç»Ÿçš„è°ƒè¯•å’Œç›‘æ§æ›´å¤æ‚

---

## 4. ğŸ›¡ï¸ æ•°æ®ä¸€è‡´æ€§ä¿è¯æœºåˆ¶


### 4.1 ä¸€è‡´æ€§é—®é¢˜çš„æœ¬è´¨


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä½ åœ¨ç½‘ä¸Šä¹°ä¸œè¥¿ï¼Œè®¢å•æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸï¼Œä½†é“¶è¡Œè´¦æˆ·æ²¡æ‰£æ¬¾ï¼Œåº“å­˜ä¹Ÿæ²¡å‡å°‘ã€‚è¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œå¦‚ä½•ä¿è¯è¿™äº›æ•°æ®åº“çš„ä¿¡æ¯ä¸€è‡´æ˜¯ä¸ªå¤§æŒ‘æˆ˜ã€‚

**ğŸ’¡ ä¸€è‡´æ€§çš„ç±»å‹**
```
å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼‰ï¼š
æ‰€æœ‰æœåŠ¡åŒæ—¶çœ‹åˆ°ç›¸åŒçš„æ•°æ®
ä¼˜ç‚¹ï¼šæ•°æ®ç»å¯¹å‡†ç¡®
ç¼ºç‚¹ï¼šæ€§èƒ½å·®ï¼Œå¯ç”¨æ€§ä½

å¼±ä¸€è‡´æ€§ï¼ˆWeak Consistencyï¼‰ï¼š
å…è®¸çŸ­æ—¶é—´å†…æ•°æ®ä¸ä¸€è‡´
ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼Œå¯ç”¨æ€§é«˜
ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°ä¸´æ—¶çš„æ•°æ®å·®å¼‚

æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰ï¼š
ä¿è¯åœ¨æ²¡æœ‰æ–°æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œæœ€ç»ˆæ‰€æœ‰æ•°æ®ä¼šä¸€è‡´
ä¼˜ç‚¹ï¼šå¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§
ç¼ºç‚¹ï¼šéœ€è¦å¤„ç†ä¸­é—´æ€
```

### 4.2 RabbitMQå®ç°ä¸€è‡´æ€§çš„ç­–ç•¥


#### âœ… æ¶ˆæ¯ç¡®è®¤æœºåˆ¶


**å‘å¸ƒè€…ç¡®è®¤**
```java
// ç¡®ä¿æ¶ˆæ¯æˆåŠŸå‘é€åˆ°äº¤æ¢æœº
@Service
public class OrderService {
    
    public void createOrder(Order order) {
        try {
            // ä¿å­˜è®¢å•åˆ°æ•°æ®åº“
            orderRepository.save(order);
            
            // å‘é€æ¶ˆæ¯å¹¶ç­‰å¾…ç¡®è®¤
            ConfirmCallback callback = (correlationData, ack, cause) -> {
                if (!ack) {
                    // æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œéœ€è¦å›æ»šæˆ–é‡è¯•
                    log.error("æ¶ˆæ¯å‘é€å¤±è´¥: {}", cause);
                    handleSendFailure(order);
                }
            };
            
            rabbitTemplate.setConfirmCallback(callback);
            rabbitTemplate.convertAndSend("order.exchange", "order.created", order);
            
        } catch (Exception e) {
            // å¤„ç†å¼‚å¸¸
            rollbackOrder(order);
        }
    }
}
```

**æ¶ˆè´¹è€…ç¡®è®¤**
```java
@RabbitListener(queues = "inventory.queue", ackMode = "MANUAL")
public void handleOrderCreated(Order order, Channel channel, 
                              @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
    try {
        // å¤„ç†åº“å­˜é€»è¾‘
        inventoryService.reduceStock(order.getItems());
        
        // æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸ
        channel.basicAck(deliveryTag, false);
        
    } catch (Exception e) {
        // å¤„ç†å¤±è´¥ï¼Œæ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°æ’é˜Ÿ
        channel.basicNack(deliveryTag, false, true);
    }
}
```

#### ğŸ”„ è¡¥å¿æœºåˆ¶ï¼ˆSagaæ¨¡å¼ï¼‰


**åŸç†è§£é‡Š**
```
æ­£å‘æ“ä½œï¼šA â†’ B â†’ C
å¦‚æœCå¤±è´¥ï¼šæ‰§è¡Œè¡¥å¿ C' â†’ B' â†’ A'

å®é™…ä¾‹å­ï¼š
ä¸‹å•æµç¨‹ï¼š
1. åˆ›å»ºè®¢å• â†’ 2. æ‰£å‡åº“å­˜ â†’ 3. å¤„ç†æ”¯ä»˜

å¦‚æœæ”¯ä»˜å¤±è´¥ï¼š
3. é€€æ¬¾ â†’ 2. æ¢å¤åº“å­˜ â†’ 1. å–æ¶ˆè®¢å•
```

**å®ç°ç¤ºä¾‹**
```java
@Component
public class OrderSagaOrchestrator {
    
    public void processOrder(Order order) {
        SagaTransaction saga = SagaTransaction.builder()
            .step("createOrder", () -> orderService.create(order))
            .compensate("cancelOrder", () -> orderService.cancel(order))
            
            .step("reduceInventory", () -> inventoryService.reduce(order))
            .compensate("restoreInventory", () -> inventoryService.restore(order))
            
            .step("processPayment", () -> paymentService.charge(order))
            .compensate("refundPayment", () -> paymentService.refund(order))
            
            .build();
            
        saga.execute();
    }
}
```

### 4.3 å®ç”¨çš„ä¸€è‡´æ€§ä¿è¯æŠ€å·§


**ğŸ“ æ£€æŸ¥æ¸…å•**
- [ ] **å¹‚ç­‰æ€§è®¾è®¡**ï¼šåŒä¸€æ“ä½œå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒ
- [ ] **çŠ¶æ€æœºè®¾è®¡**ï¼šæ˜ç¡®å®šä¹‰æ•°æ®çš„å„ç§çŠ¶æ€
- [ ] **è¶…æ—¶å¤„ç†**ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šåŠæ—¶å‘ç°ä¸€è‡´æ€§é—®é¢˜

**ğŸ¯ æœ€ä½³å®è·µ**
```
1. è®¾è®¡å¹‚ç­‰æ¶ˆè´¹è€…
æ¯ä¸ªæ¶ˆæ¯å¤„ç†éƒ½è¦æ”¯æŒé‡å¤æ‰§è¡Œ

2. ä½¿ç”¨ä¸šåŠ¡ä¸»é”®
é¿å…ä¾èµ–è‡ªå¢IDï¼Œä½¿ç”¨ä¸šåŠ¡å”¯ä¸€æ ‡è¯†

3. å®ç°è¡¥å¿é€»è¾‘
æ¯ä¸ªæ“ä½œéƒ½è¦æœ‰å¯¹åº”çš„æ’¤é”€æ“ä½œ

4. ç›‘æ§æ•°æ®å·®å¼‚
å®šæœŸæ£€æŸ¥å„æœåŠ¡é—´æ•°æ®çš„ä¸€è‡´æ€§
```

---

## 5. ğŸ’¼ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ç­–ç•¥


### 5.1 åˆ†å¸ƒå¼äº‹åŠ¡çš„æŒ‘æˆ˜


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä½ è¦åŒæ—¶åœ¨ä¸¤å®¶é“¶è¡Œä¹‹é—´è½¬è´¦ï¼šä»Aé“¶è¡Œæ‰£æ¬¾1000å…ƒï¼Œå‘Bé“¶è¡Œå­˜æ¬¾1000å…ƒã€‚å¦‚æœAé“¶è¡Œæ‰£æ¬¾æˆåŠŸä½†Bé“¶è¡Œå­˜æ¬¾å¤±è´¥ï¼Œå°±ä¼šå‡ºç°é’±"æ¶ˆå¤±"çš„é—®é¢˜ã€‚è¿™å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡è¦è§£å†³çš„é—®é¢˜ï¼šç¡®ä¿è·¨å¤šä¸ªç³»ç»Ÿçš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚

**ğŸ’¡ æ ¸å¿ƒæŒ‘æˆ˜**
```
ç½‘ç»œåˆ†åŒºï¼šæœåŠ¡é—´ç½‘ç»œå¯èƒ½ä¸­æ–­
æœåŠ¡æ•…éšœï¼šæŸä¸ªæœåŠ¡å¯èƒ½ä¸´æ—¶ä¸å¯ç”¨
æ•°æ®ä¸€è‡´æ€§ï¼šå¦‚ä½•ä¿è¯å¤šä¸ªæœåŠ¡çš„æ•°æ®åŒæ­¥
æ€§èƒ½å½±å“ï¼šå¼ºä¸€è‡´æ€§é€šå¸¸å½±å“ç³»ç»Ÿæ€§èƒ½
```

### 5.2 åŸºäºRabbitMQçš„äº‹åŠ¡æ¨¡å¼


#### ğŸ“‹ Outboxæ¨¡å¼


**æ ¸å¿ƒæ€æƒ³**
```
ä¸ç›´æ¥å‘é€æ¶ˆæ¯åˆ°MQï¼Œè€Œæ˜¯ï¼š
1. åœ¨æœ¬åœ°æ•°æ®åº“ä¸­åŒæ—¶ä¿å­˜ä¸šåŠ¡æ•°æ®å’Œå¾…å‘é€æ¶ˆæ¯
2. åå°ä»»åŠ¡å®šæœŸæ‰«æå¹¶å‘é€æ¶ˆæ¯
3. å‘é€æˆåŠŸåæ ‡è®°æ¶ˆæ¯ä¸ºå·²å‘é€

ä¼˜åŠ¿ï¼šåˆ©ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
```

**å®ç°ç¤ºä¾‹**
```java
// 1. æ•°æ®åº“è¡¨è®¾è®¡
CREATE TABLE outbox_events (
    id BIGINT PRIMARY KEY,
    event_type VARCHAR(100),
    event_data TEXT,
    created_at TIMESTAMP,
    processed BOOLEAN DEFAULT FALSE
);

// 2. ä¸šåŠ¡æœåŠ¡å®ç°
@Service
@Transactional
public class OrderService {
    
    public void createOrder(Order order) {
        // åœ¨åŒä¸€äº‹åŠ¡ä¸­ä¿å­˜è®¢å•å’Œäº‹ä»¶
        orderRepository.save(order);
        
        OutboxEvent event = OutboxEvent.builder()
            .eventType("OrderCreated")
            .eventData(JsonUtils.toJson(order))
            .build();
        outboxRepository.save(event);
    }
}

// 3. æ¶ˆæ¯å‘é€ä»»åŠ¡
@Component
public class OutboxPublisher {
    
    @Scheduled(fixedDelay = 5000) // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡
    public void publishPendingEvents() {
        List<OutboxEvent> events = outboxRepository.findUnprocessedEvents();
        
        for (OutboxEvent event : events) {
            try {
                // å‘é€æ¶ˆæ¯åˆ°RabbitMQ
                rabbitTemplate.convertAndSend(
                    "order.exchange", 
                    "order.created", 
                    event.getEventData()
                );
                
                // æ ‡è®°ä¸ºå·²å¤„ç†
                event.setProcessed(true);
                outboxRepository.save(event);
                
            } catch (Exception e) {
                log.error("å‘é€æ¶ˆæ¯å¤±è´¥", e);
                // å¯ä»¥å®ç°é‡è¯•é€»è¾‘
            }
        }
    }
}
```

#### ğŸ”„ Two-Phase Commit (2PC) ç®€åŒ–ç‰ˆ


**RabbitMQäº‹åŠ¡æ”¯æŒ**
```java
@Service
public class TransactionalMessageService {
    
    public void sendTransactionalMessage(Order order) {
        // å¼€å¯RabbitMQäº‹åŠ¡
        rabbitTemplate.execute(channel -> {
            try {
                channel.txSelect(); // å¼€å§‹äº‹åŠ¡
                
                // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                orderService.processOrder(order);
                
                // å‘é€æ¶ˆæ¯
                channel.basicPublish("order.exchange", "order.created", 
                                    null, JsonUtils.toBytes(order));
                
                channel.txCommit(); // æäº¤äº‹åŠ¡
                return null;
                
            } catch (Exception e) {
                channel.txRollback(); // å›æ»šäº‹åŠ¡
                throw new RuntimeException("äº‹åŠ¡å¤„ç†å¤±è´¥", e);
            }
        });
    }
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
RabbitMQäº‹åŠ¡çš„é™åˆ¶ï¼š
- æ€§èƒ½å¼€é”€å¤§ï¼ˆæ¯”ç¡®è®¤æœºåˆ¶æ…¢çº¦250å€ï¼‰
- ä¸èƒ½è·¨æ•°æ®åº“äº‹åŠ¡
- å»ºè®®åªåœ¨ç‰¹æ®Šåœºæ™¯ä½¿ç”¨

æ¨èæ›¿ä»£æ–¹æ¡ˆï¼š
- å‘å¸ƒè€…ç¡®è®¤ + è¡¥å¿æœºåˆ¶
- Outboxæ¨¡å¼
- Sagaæ¨¡å¼
```

### 5.3 äº‹åŠ¡å¤±è´¥çš„æ¢å¤ç­–ç•¥


**ğŸ”§ è‡ªåŠ¨æ¢å¤æœºåˆ¶**
```java
@Component
public class TransactionRecoveryService {
    
    // 1. è¶…æ—¶æ£€æµ‹
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkTimeoutTransactions() {
        List<Order> timeoutOrders = orderRepository.findTimeoutOrders();
        
        for (Order order : timeoutOrders) {
            // æ£€æŸ¥å„ä¸ªæœåŠ¡çš„å¤„ç†çŠ¶æ€
            checkAndRecoverOrder(order);
        }
    }
    
    // 2. çŠ¶æ€æ ¸å¯¹
    private void checkAndRecoverOrder(Order order) {
        boolean inventoryReduced = inventoryService.isReduced(order.getId());
        boolean paymentProcessed = paymentService.isProcessed(order.getId());
        
        if (inventoryReduced && !paymentProcessed) {
            // åº“å­˜å·²æ‰£ä½†æœªæ”¯ä»˜ï¼Œæ¢å¤åº“å­˜
            inventoryService.restore(order.getId());
        } else if (!inventoryReduced && paymentProcessed) {
            // å·²æ”¯ä»˜ä½†æœªæ‰£åº“å­˜ï¼Œæ‰£å‡åº“å­˜
            inventoryService.reduce(order.getId());
        }
    }
}
```

**ğŸ“Š äº‹åŠ¡çŠ¶æ€ç›‘æ§**
```java
@RestController
public class TransactionMonitorController {
    
    @GetMapping("/transaction/status/{orderId}")
    public TransactionStatus getTransactionStatus(@PathVariable String orderId) {
        return TransactionStatus.builder()
            .orderId(orderId)
            .orderStatus(orderService.getStatus(orderId))
            .inventoryStatus(inventoryService.getStatus(orderId))
            .paymentStatus(paymentService.getStatus(orderId))
            .overallStatus(calculateOverallStatus(orderId))
            .build();
    }
}
```

---

## 6. ğŸ¯ æœåŠ¡æ²»ç†æœ€ä½³å®è·µ


### 6.1 æœåŠ¡æ²»ç†çš„æ ¸å¿ƒè¦ç´ 


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æœåŠ¡æ²»ç†å°±åƒåŸå¸‚ç®¡ç†ï¼šéœ€è¦äº¤é€šè§„åˆ™ï¼ˆé€šä¿¡è§„èŒƒï¼‰ã€çº¢ç»¿ç¯ï¼ˆæµé‡æ§åˆ¶ï¼‰ã€è·¯æ ‡æŒ‡ç¤ºï¼ˆæœåŠ¡å‘ç°ï¼‰ã€åº”æ€¥é¢„æ¡ˆï¼ˆæ•…éšœå¤„ç†ï¼‰ã€åŸå¸‚è§„åˆ’ï¼ˆæ¶æ„è®¾è®¡ï¼‰ã€‚

**ğŸ’¡ æ²»ç†ä½“ç³»æ¡†æ¶**
```
æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šæœåŠ¡å¦‚ä½•æ‰¾åˆ°å½¼æ­¤
é…ç½®ç®¡ç†ï¼šç»Ÿä¸€ç®¡ç†å„æœåŠ¡çš„é…ç½®
è´Ÿè½½å‡è¡¡ï¼šåˆç†åˆ†é…è¯·æ±‚æµé‡
ç†”æ–­é™çº§ï¼šé˜²æ­¢æœåŠ¡é›ªå´©
ç›‘æ§å‘Šè­¦ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†é—®é¢˜
```

### 6.2 åŸºäºRabbitMQçš„æœåŠ¡æ²»ç†


#### ğŸ“‹ æœåŠ¡æ³¨å†Œä¸å‘ç°


**åŠ¨æ€é˜Ÿåˆ—ç®¡ç†**
```java
@Component
public class ServiceRegistry {
    
    // æœåŠ¡å¯åŠ¨æ—¶æ³¨å†Œ
    @PostConstruct
    public void registerService() {
        String serviceName = "user-service";
        String instanceId = getInstanceId();
        
        // åˆ›å»ºæœåŠ¡ä¸“ç”¨é˜Ÿåˆ—
        String queueName = serviceName + "." + instanceId;
        Queue queue = QueueBuilder.durable(queueName).build();
        rabbitAdmin.declareQueue(queue);
        
        // ç»‘å®šåˆ°æœåŠ¡äº¤æ¢æœº
        Binding binding = BindingBuilder
            .bind(queue)
            .to(DirectExchange(serviceName + ".exchange"))
            .with(instanceId);
        rabbitAdmin.declareBinding(binding);
        
        // æ³¨å†Œå¿ƒè·³æœºåˆ¶
        scheduleHeartbeat(queueName);
    }
    
    // å®šæœŸå‘é€å¿ƒè·³
    private void scheduleHeartbeat(String queueName) {
        ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);
        scheduler.scheduleAtFixedRate(() -> {
            try {
                ServiceHeartbeat heartbeat = ServiceHeartbeat.builder()
                    .serviceName("user-service")
                    .instanceId(getInstanceId())
                    .timestamp(System.currentTimeMillis())
                    .status("HEALTHY")
                    .build();
                    
                rabbitTemplate.convertAndSend("heartbeat.exchange", "", heartbeat);
            } catch (Exception e) {
                log.error("å¿ƒè·³å‘é€å¤±è´¥", e);
            }
        }, 0, 30, TimeUnit.SECONDS);
    }
}
```

#### ğŸ”„ è´Ÿè½½å‡è¡¡ç­–ç•¥


**åŸºäºé˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡**
```java
// 1. å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ - è‡ªç„¶è´Ÿè½½å‡è¡¡
@RabbitListener(queues = "task.queue", concurrency = "3-10")
public void processTask(Task task) {
    // RabbitMQè‡ªåŠ¨å°†ä»»åŠ¡åˆ†å‘ç»™ç©ºé—²çš„æ¶ˆè´¹è€…
    taskProcessor.process(task);
}

// 2. åŸºäºæœåŠ¡èƒ½åŠ›çš„è´Ÿè½½å‡è¡¡
@Component
public class CapacityBasedConsumer {
    
    @RabbitListener(queues = "order.queue")
    public void handleOrder(Order order, Channel channel, 
                           @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        
        if (isOverloaded()) {
            // æœåŠ¡è¿‡è½½ï¼Œæ‹’ç»æ¶ˆæ¯å¹¶é‡æ–°æ’é˜Ÿ
            channel.basicNack(deliveryTag, false, true);
            return;
        }
        
        try {
            processOrder(order);
            channel.basicAck(deliveryTag, false);
        } catch (Exception e) {
            channel.basicNack(deliveryTag, false, false);
        }
    }
    
    private boolean isOverloaded() {
        return getCurrentLoad() > 0.8; // è´Ÿè½½è¶…è¿‡80%
    }
}
```

#### âš¡ ç†”æ–­é™çº§æœºåˆ¶


**æ¶ˆæ¯çº§åˆ«çš„ç†”æ–­**
```java
@Component
public class CircuitBreakerMessageHandler {
    
    private final CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults("messageHandler");
    
    @RabbitListener(queues = "payment.queue")
    public void handlePayment(Payment payment) {
        
        // ä½¿ç”¨ç†”æ–­å™¨ä¿æŠ¤æ¶ˆæ¯å¤„ç†
        Supplier<String> decoratedSupplier = CircuitBreaker
            .decorateSupplier(circuitBreaker, () -> {
                return paymentService.process(payment);
            });
            
        try {
            String result = decoratedSupplier.get();
            log.info("æ”¯ä»˜å¤„ç†æˆåŠŸ: {}", result);
            
        } catch (CircuitBreakerOpenException e) {
            // ç†”æ–­å™¨æ‰“å¼€ï¼Œæ‰§è¡Œé™çº§é€»è¾‘
            handlePaymentFallback(payment);
            
        } catch (Exception e) {
            // å…¶ä»–å¼‚å¸¸å¤„ç†
            log.error("æ”¯ä»˜å¤„ç†å¤±è´¥", e);
            throw e;
        }
    }
    
    private void handlePaymentFallback(Payment payment) {
        // é™çº§å¤„ç†ï¼šè®°å½•åˆ°å»¶è¿Ÿå¤„ç†é˜Ÿåˆ—
        rabbitTemplate.convertAndSend("payment.retry.queue", payment);
        log.info("æ”¯ä»˜æœåŠ¡é™çº§ï¼Œè®¢å•{}å·²è¿›å…¥é‡è¯•é˜Ÿåˆ—", payment.getOrderId());
    }
}
```

### 6.3 ç›‘æ§ä¸è¿ç»´


#### ğŸ“Š å…³é”®æŒ‡æ ‡ç›‘æ§


**æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```java
@Component
public class MessageMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter messageProcessedCounter;
    private final Timer messageProcessingTimer;
    
    public MessageMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.messageProcessedCounter = Counter.builder("messages.processed")
            .tag("service", "user-service")
            .register(meterRegistry);
        this.messageProcessingTimer = Timer.builder("message.processing.time")
            .register(meterRegistry);
    }
    
    @EventListener
    public void onMessageProcessed(MessageProcessedEvent event) {
        messageProcessedCounter.increment(
            Tags.of(
                "queue", event.getQueueName(),
                "status", event.isSuccess() ? "success" : "failed"
            )
        );
        
        messageProcessingTimer.record(event.getProcessingTime(), TimeUnit.MILLISECONDS);
    }
}
```

**ğŸ¯ ç›‘æ§æœ€ä½³å®è·µ**
```
æ ¸å¿ƒæŒ‡æ ‡ï¼š
- æ¶ˆæ¯å¤„ç†é€Ÿåº¦ï¼ˆTPSï¼‰
- æ¶ˆæ¯ç§¯å‹æ•°é‡
- å¤„ç†æˆåŠŸç‡
- å¹³å‡å¤„ç†æ—¶é—´
- é”™è¯¯ç‡å’Œé”™è¯¯ç±»å‹

å‘Šè­¦è§„åˆ™ï¼š
- é˜Ÿåˆ—ç§¯å‹è¶…è¿‡é˜ˆå€¼
- å¤„ç†æˆåŠŸç‡ä½äº95%
- å¹³å‡å¤„ç†æ—¶é—´è¶…è¿‡é¢„æœŸ
- è¿æ¥æ•°å¼‚å¸¸
```

---

## 7. ğŸ› ï¸ å®æˆ˜åº”ç”¨æ¡ˆä¾‹


### 7.1 ç”µå•†è®¢å•å¤„ç†ç³»ç»Ÿ


**ğŸ¢ ä¸šåŠ¡åœºæ™¯**
```
ç”¨æˆ·ä¸‹å•æµç¨‹ï¼š
1. ç”¨æˆ·æäº¤è®¢å•
2. éªŒè¯å•†å“åº“å­˜
3. è®¡ç®—è®¢å•é‡‘é¢
4. å¤„ç†æ”¯ä»˜
5. æ‰£å‡åº“å­˜
6. åˆ›å»ºç‰©æµå•
7. å‘é€ç¡®è®¤é€šçŸ¥
```

**æ¶æ„è®¾è®¡**
```
æœåŠ¡æ‹†åˆ†ï¼š
- è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰
- åº“å­˜æœåŠ¡ï¼ˆInventory Serviceï¼‰
- æ”¯ä»˜æœåŠ¡ï¼ˆPayment Serviceï¼‰
- ç‰©æµæœåŠ¡ï¼ˆLogistics Serviceï¼‰
- é€šçŸ¥æœåŠ¡ï¼ˆNotification Serviceï¼‰

æ¶ˆæ¯æµè®¾è®¡ï¼š
è®¢å•åˆ›å»º â†’ order.created äº‹ä»¶
         â†’ inventory.check å‘½ä»¤
         â†’ payment.process å‘½ä»¤
         â†’ logistics.create å‘½ä»¤
         â†’ notification.send å‘½ä»¤
```

**å…·ä½“å®ç°**
```java
// 1. è®¢å•æœåŠ¡ - äº‹ä»¶å‘å¸ƒ
@Service
public class OrderService {
    
    public Order createOrder(CreateOrderRequest request) {
        // åˆ›å»ºè®¢å•
        Order order = Order.builder()
            .id(UUID.randomUUID().toString())
            .userId(request.getUserId())
            .items(request.getItems())
            .status(OrderStatus.CREATED)
            .createdAt(Instant.now())
            .build();
            
        orderRepository.save(order);
        
        // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
        OrderCreatedEvent event = OrderCreatedEvent.builder()
            .orderId(order.getId())
            .userId(order.getUserId())
            .items(order.getItems())
            .totalAmount(order.getTotalAmount())
            .build();
            
        eventPublisher.publish("order.created", event);
        
        return order;
    }
}

// 2. åº“å­˜æœåŠ¡ - äº‹ä»¶å¤„ç†
@Component
public class InventoryEventHandler {
    
    @RabbitListener(queues = "inventory.order.created")
    public void handleOrderCreated(OrderCreatedEvent event) {
        try {
            // æ£€æŸ¥åº“å­˜
            InventoryCheckResult result = inventoryService.checkAndReserve(
                event.getOrderId(), 
                event.getItems()
            );
            
            if (result.isSuccess()) {
                // åº“å­˜å……è¶³ï¼Œå‘å¸ƒåº“å­˜é¢„ç•™æˆåŠŸäº‹ä»¶
                publishInventoryReserved(event.getOrderId(), result);
            } else {
                // åº“å­˜ä¸è¶³ï¼Œå‘å¸ƒåº“å­˜ä¸è¶³äº‹ä»¶
                publishInventoryInsufficient(event.getOrderId(), result);
            }
            
        } catch (Exception e) {
            log.error("åº“å­˜å¤„ç†å¤±è´¥", e);
            publishInventoryError(event.getOrderId(), e.getMessage());
        }
    }
    
    private void publishInventoryReserved(String orderId, InventoryCheckResult result) {
        InventoryReservedEvent event = InventoryReservedEvent.builder()
            .orderId(orderId)
            .reservationId(result.getReservationId())
            .items(result.getReservedItems())
            .build();
            
        eventPublisher.publish("inventory.reserved", event);
    }
}

// 3. æ”¯ä»˜æœåŠ¡ - äº‹ä»¶å¤„ç†
@Component
public class PaymentEventHandler {
    
    @RabbitListener(queues = "payment.inventory.reserved")
    public void handleInventoryReserved(InventoryReservedEvent event) {
        try {
            // å¤„ç†æ”¯ä»˜
            PaymentResult result = paymentService.processPayment(
                event.getOrderId(),
                getOrderAmount(event.getOrderId())
            );
            
            if (result.isSuccess()) {
                publishPaymentSuccess(event.getOrderId(), result);
            } else {
                publishPaymentFailed(event.getOrderId(), result);
                // é‡Šæ”¾åº“å­˜
                inventoryService.releaseReservation(event.getReservationId());
            }
            
        } catch (Exception e) {
            log.error("æ”¯ä»˜å¤„ç†å¤±è´¥", e);
            // é‡Šæ”¾åº“å­˜å¹¶å‘å¸ƒæ”¯ä»˜é”™è¯¯äº‹ä»¶
            inventoryService.releaseReservation(event.getReservationId());
            publishPaymentError(event.getOrderId(), e.getMessage());
        }
    }
}
```

### 7.2 ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿ


**ğŸ“Š ä¸šåŠ¡åœºæ™¯**
```
å®æ—¶åˆ†æç”¨æˆ·è¡Œä¸ºï¼š
- é¡µé¢è®¿é—®ç»Ÿè®¡
- å•†å“æµè§ˆè®°å½•
- è´­ä¹°è½¬åŒ–åˆ†æ
- ä¸ªæ€§åŒ–æ¨è
```

**äº‹ä»¶é©±åŠ¨è®¾è®¡**
```java
// 1. è¡Œä¸ºäº‹ä»¶å®šä¹‰
public abstract class UserBehaviorEvent {
    private String userId;
    private String sessionId;
    private Instant timestamp;
    private String eventType;
}

public class PageViewEvent extends UserBehaviorEvent {
    private String pageUrl;
    private String referrer;
    private Duration stayTime;
}

public class ProductViewEvent extends UserBehaviorEvent {
    private String productId;
    private String category;
    private String source;
}

// 2. äº‹ä»¶æ”¶é›†æœåŠ¡
@RestController
public class EventCollectionController {
    
    @PostMapping("/events/pageview")
    public ResponseEntity<Void> trackPageView(@RequestBody PageViewRequest request) {
        PageViewEvent event = PageViewEvent.builder()
            .userId(request.getUserId())
            .sessionId(request.getSessionId())
            .pageUrl(request.getPageUrl())
            .timestamp(Instant.now())
            .build();
            
        // å¼‚æ­¥å‘é€åˆ°åˆ†æé˜Ÿåˆ—
        eventPublisher.publish("user.behavior.pageview", event);
        
        return ResponseEntity.ok().build();
    }
}

// 3. å®æ—¶åˆ†æå¤„ç†
@Component
public class BehaviorAnalysisHandler {
    
    @RabbitListener(queues = "analytics.pageview")
    public void analyzePageView(PageViewEvent event) {
        // æ›´æ–°é¡µé¢è®¿é—®ç»Ÿè®¡
        pageViewStatsService.increment(event.getPageUrl());
        
        // æ›´æ–°ç”¨æˆ·ç”»åƒ
        userProfileService.updatePageViewHistory(event.getUserId(), event);
        
        // è§¦å‘å®æ—¶æ¨èè®¡ç®—
        if (isProductPage(event.getPageUrl())) {
            recommendationService.updateRealTimeRecommendation(event.getUserId());
        }
    }
    
    @RabbitListener(queues = "analytics.productview")
    public void analyzeProductView(ProductViewEvent event) {
        // å•†å“çƒ­åº¦ç»Ÿè®¡
        productStatsService.incrementViewCount(event.getProductId());
        
        // ç”¨æˆ·å…´è¶£æ ‡ç­¾æ›´æ–°
        userInterestService.updateInterest(event.getUserId(), event.getCategory());
        
        // å®æ—¶æ¨èæ›´æ–°
        recommendationService.addProductInteraction(event.getUserId(), event.getProductId());
    }
}
```

### 7.3 æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–


**ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**

**æ‰¹é‡å¤„ç†ä¼˜åŒ–**
```java
@Component
public class BatchMessageProcessor {
    
    private final List<OrderEvent> batchBuffer = new ArrayList<>();
    private final int BATCH_SIZE = 100;
    
    @RabbitListener(queues = "order.batch.processing")
    public void handleOrderEvent(OrderEvent event) {
        synchronized (batchBuffer) {
            batchBuffer.add(event);
            
            if (batchBuffer.size() >= BATCH_SIZE) {
                processBatch(new ArrayList<>(batchBuffer));
                batchBuffer.clear();
            }
        }
    }
    
    @Scheduled(fixedDelay = 5000) // æ¯5ç§’å¤„ç†ä¸€æ¬¡
    public void processRemaining() {
        synchronized (batchBuffer) {
            if (!batchBuffer.isEmpty()) {
                processBatch(new ArrayList<>(batchBuffer));
                batchBuffer.clear();
            }
        }
    }
    
    private void processBatch(List<OrderEvent> events) {
        // æ‰¹é‡å¤„ç†ï¼Œæé«˜æ•°æ®åº“æ“ä½œæ•ˆç‡
        orderAnalyticsService.batchUpdate(events);
    }
}
```

**è¿æ¥æ± ä¼˜åŒ–**
```java
@Configuration
public class RabbitMQConfig {
    
    @Bean
    public CachingConnectionFactory connectionFactory() {
        CachingConnectionFactory factory = new CachingConnectionFactory("localhost");
        
        // è¿æ¥æ± é…ç½®
        factory.setChannelCacheSize(50);  // ç¼“å­˜50ä¸ªchannel
        factory.setConnectionCacheSize(10); // ç¼“å­˜10ä¸ªconnection
        
        // æ€§èƒ½ä¼˜åŒ–
        factory.setChannelCheckoutTimeout(30000); // 30ç§’è¶…æ—¶
        factory.setPublisherConfirms(true); // å¯ç”¨å‘å¸ƒè€…ç¡®è®¤
        factory.setPublisherReturns(true);  // å¯ç”¨å‘å¸ƒè€…è¿”å›
        
        return factory;
    }
    
    @Bean
    public RabbitTemplate rabbitTemplate(CachingConnectionFactory connectionFactory) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        
        // æ€§èƒ½é…ç½®
        template.setMandatory(true); // ç¡®ä¿æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—
        template.setRetryTemplate(retryTemplate()); // é‡è¯•æœºåˆ¶
        
        return template;
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šé€šè¿‡äº‹ä»¶å®ç°æœåŠ¡é—´çš„æ¾è€¦åˆé€šä¿¡
ğŸ”¸ æœåŠ¡è§£è€¦ï¼šé™ä½æœåŠ¡é—´çš„ç›´æ¥ä¾èµ–ï¼Œæé«˜ç³»ç»Ÿçµæ´»æ€§
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¿è¯æ•°æ®çš„å‡†ç¡®å’ŒåŒæ­¥
ğŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡ï¼šç¡®ä¿è·¨æœåŠ¡æ“ä½œçš„åŸå­æ€§
ğŸ”¸ æœåŠ¡æ²»ç†ï¼šç®¡ç†å’Œç›‘æ§å¾®æœåŠ¡ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ç”¨äº‹ä»¶é©±åŠ¨**
```
è§£å†³çš„é—®é¢˜ï¼š
- æœåŠ¡é—´ç´§è€¦åˆ
- ç³»ç»Ÿæ‰©å±•å›°éš¾
- å•ç‚¹æ•…éšœå½±å“å…¨å±€
- ä¸šåŠ¡é€»è¾‘äº¤ç»‡å¤æ‚

å¸¦æ¥çš„ä»·å€¼ï¼š
- æœåŠ¡ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- ç³»ç»Ÿæ›´å®¹æ˜“ç»´æŠ¤
- æ•…éšœéš”ç¦»èƒ½åŠ›å¼º
- æ”¯æŒä¸šåŠ¡å¿«é€Ÿè¿­ä»£
```

**ğŸ”¹ æ•°æ®ä¸€è‡´æ€§çš„å¹³è¡¡**
```
é€‰æ‹©åŸåˆ™ï¼š
- æ ¸å¿ƒä¸šåŠ¡ï¼šä¼˜å…ˆä¿è¯å¼ºä¸€è‡´æ€§
- è¾…åŠ©åŠŸèƒ½ï¼šå¯ä»¥æ¥å—æœ€ç»ˆä¸€è‡´æ€§
- æŸ¥è¯¢æ“ä½œï¼šé€šå¸¸å¯ä»¥æ¥å—å¼±ä¸€è‡´æ€§
- åˆ†æç»Ÿè®¡ï¼šå»¶è¿Ÿä¸€è‡´æ€§é€šå¸¸å¯æ¥å—
```

**ğŸ”¹ æœåŠ¡æ²»ç†çš„é‡è¦æ€§**
```
æ²¡æœ‰æ²»ç†çš„å¾®æœåŠ¡ = åˆ†å¸ƒå¼çš„å•ä½“åº”ç”¨

å¿…å¤‡è¦ç´ ï¼š
- æœåŠ¡å‘ç°å’Œæ³¨å†Œ
- é…ç½®ç»Ÿä¸€ç®¡ç†
- è´Ÿè½½å‡è¡¡ç­–ç•¥
- ç†”æ–­é™çº§æœºåˆ¶
- å…¨é“¾è·¯ç›‘æ§
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ è®¾è®¡å†³ç­–æ¡†æ¶**
```
é€‰æ‹©é€šä¿¡æ¨¡å¼ï¼š
åŒæ­¥è°ƒç”¨ â† éœ€è¦ç«‹å³å“åº”ï¼Œå¼ºä¸€è‡´æ€§è¦æ±‚
å¼‚æ­¥æ¶ˆæ¯ â† å¯ä»¥å»¶è¿Ÿå¤„ç†ï¼Œå…è®¸æœ€ç»ˆä¸€è‡´æ€§

é€‰æ‹©ä¸€è‡´æ€§ç­–ç•¥ï¼š
å¼ºä¸€è‡´æ€§ â† é‡‘èäº¤æ˜“ã€æ ¸å¿ƒä¸šåŠ¡æ•°æ®
æœ€ç»ˆä¸€è‡´æ€§ â† ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ã€æ¨èè®¡ç®—
å¼±ä¸€è‡´æ€§ â† é¡µé¢æµè§ˆè®¡æ•°ã€éå…³é”®æŒ‡æ ‡
```

**ğŸš€ å®æ–½è·¯å¾„å»ºè®®**
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½
- æ­å»ºRabbitMQé›†ç¾¤
- å»ºç«‹æ¶ˆæ¯è§„èŒƒ
- å®ç°åŸºç¡€ç›‘æ§

ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½
- æ”¹é€ å…³é”®ä¸šåŠ¡æµç¨‹
- å®ç°äº‹ä»¶é©±åŠ¨æ¶æ„
- å»ºç«‹ä¸€è‡´æ€§ä¿è¯æœºåˆ¶

ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå–„æ²»ç†
- å®Œå–„ç›‘æ§ä½“ç³»
- ä¼˜åŒ–æ€§èƒ½
- å»ºç«‹è¿ç»´è§„èŒƒ
```

**ğŸ“ é¿å…å¸¸è§é™·é˜±**
```
è¿‡åº¦è®¾è®¡ï¼š
âŒ æ‰€æœ‰äº¤äº’éƒ½ç”¨å¼‚æ­¥æ¶ˆæ¯
âœ… æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼

å¿½ç•¥ç›‘æ§ï¼š
âŒ åªå…³æ³¨åŠŸèƒ½å®ç°
âœ… åŒæ­¥å»ºè®¾ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

æ•°æ®ä¸ä¸€è‡´ï¼š
âŒ å‡è®¾ç½‘ç»œå’ŒæœåŠ¡æ€»æ˜¯å¯é çš„
âœ… è®¾è®¡å®¹é”™å’Œæ¢å¤æœºåˆ¶
```

### 8.4 æŒç»­å­¦ä¹ å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**
- **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**ï¼šæ›´å¥½åœ°åˆ’åˆ†æœåŠ¡è¾¹ç•Œ
- **CQRSæ¨¡å¼**ï¼šåˆ†ç¦»å‘½ä»¤å’ŒæŸ¥è¯¢çš„è´£ä»»
- **Event Sourcing**ï¼šåŸºäºäº‹ä»¶å­˜å‚¨çš„æ¶æ„æ¨¡å¼
- **Kubernetes**ï¼šå®¹å™¨åŒ–éƒ¨ç½²å’Œç®¡ç†å¾®æœåŠ¡

**ğŸ› ï¸ å®è·µå»ºè®®**
- ä»å°è§„æ¨¡é¡¹ç›®å¼€å§‹å®è·µ
- é‡è§†ç›‘æ§å’Œæ—¥å¿—
- å»ºç«‹ä»£ç å’Œæ¶æ„reviewæœºåˆ¶
- å®šæœŸè¿›è¡Œæ¶æ„æ¼”è¿›å’Œé‡æ„

**ğŸ¯ æ ¸å¿ƒè®°å¿†**
```
äº‹ä»¶é©±åŠ¨è§£è€¦åˆï¼Œå¼‚æ­¥æ¶ˆæ¯ä¼ å››æ–¹
æ•°æ®ä¸€è‡´é è®¾è®¡ï¼Œè¡¥å¿æœºåˆ¶ä¿å®‰å…¨  
æœåŠ¡æ²»ç†æ˜¯å…³é”®ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘
å®è·µä¸­å­¦çœŸçŸ¥ï¼Œå¾ªåºæ¸è¿›æœ€é‡è¦
```

**æœ€ç»ˆå»ºè®®**ï¼šå¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦åœ¨å®è·µä¸­ä¸æ–­å­¦ä¹ å’Œä¼˜åŒ–ã€‚ä»ç®€å•åœºæ™¯å¼€å§‹ï¼Œé€æ­¥ç§¯ç´¯ç»éªŒï¼Œé‡è§†ç›‘æ§å’Œè¿ç»´ï¼Œæ‰èƒ½çœŸæ­£å‘æŒ¥å¾®æœåŠ¡æ¶æ„çš„ä»·å€¼ã€‚