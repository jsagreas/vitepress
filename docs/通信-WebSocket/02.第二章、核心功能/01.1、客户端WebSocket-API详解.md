---
title: 1ã€å®¢æˆ·ç«¯WebSocket-APIè¯¦è§£
---
## ğŸ“š ç›®å½•

1. [WebSocketæ„é€ å‡½æ•°](#1-WebSocketæ„é€ å‡½æ•°)
2. [è¿æ¥çŠ¶æ€è¯¦è§£](#2-è¿æ¥çŠ¶æ€è¯¦è§£)
3. [æ ¸å¿ƒäº‹ä»¶æœºåˆ¶](#3-æ ¸å¿ƒäº‹ä»¶æœºåˆ¶)
4. [æ•°æ®å‘é€ä¸æ¥æ”¶](#4-æ•°æ®å‘é€ä¸æ¥æ”¶)
5. [è¿æ¥ç®¡ç†æ“ä½œ](#5-è¿æ¥ç®¡ç†æ“ä½œ)
6. [å®æˆ˜æ¡ˆä¾‹](#6-å®æˆ˜æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ WebSocketæ„é€ å‡½æ•°


### 1.1 åˆ›å»ºè¿æ¥çš„åŸºæœ¬æ–¹å¼


**ğŸ”¸ æ„é€ å‡½æ•°è¯­æ³•**
```javascript
const ws = new WebSocket(url)
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
å°±åƒæ‰“ç”µè¯ä¸€æ ·ï¼Œä½ è¦å…ˆæ‹¨å·æ‰èƒ½é€šè¯ã€‚`new WebSocket()` å°±æ˜¯åœ¨"æ‹¨å·"ï¼Œå‘Šè¯‰æµè§ˆå™¨è¦è¿æ¥åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚

### 1.2 URLåœ°å€æ ¼å¼è¯¦è§£


**ğŸŒ WebSocketä¸“ç”¨åè®®**
```javascript
// æ™®é€šè¿æ¥ï¼ˆç±»ä¼¼HTTPï¼‰
const ws = new WebSocket('ws://localhost:8080')

// åŠ å¯†è¿æ¥ï¼ˆç±»ä¼¼HTTPSï¼‰  
const wss = new WebSocket('wss://chat.example.com/room')
```

**ğŸ“ åœ°å€æ ¼å¼å¯¹æ¯”**

| åè®®ç±»å‹ | **ç¤ºä¾‹åœ°å€** | **å®‰å…¨æ€§** | **ä½¿ç”¨åœºæ™¯** |
|---------|------------|-----------|-------------|
| `ws://` | `ws://localhost:3000` | ğŸ”“ ä¸åŠ å¯† | å¼€å‘æµ‹è¯• |
| `wss://` | `wss://api.example.com` | ğŸ”’ åŠ å¯†ä¼ è¾“ | ç”Ÿäº§ç¯å¢ƒ |

**ğŸ”¥ é‡è¦æé†’**ï¼š
> âš ï¸ **å®‰å…¨å»ºè®®**  
> ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ `wss://` åŠ å¯†è¿æ¥ï¼Œå°±åƒç½‘ç«™è¦ç”¨HTTPSä¸€æ ·ï¼

### 1.3 å®é™…åˆ›å»ºç¤ºä¾‹


```javascript
// 1. æœ€ç®€å•çš„è¿æ¥
const socket = new WebSocket('ws://localhost:8080')

// 2. è¿æ¥åˆ°èŠå¤©å®¤
const chatSocket = new WebSocket('ws://localhost:3000/chat')

// 3. ç”Ÿäº§ç¯å¢ƒè¿æ¥
const prodSocket = new WebSocket('wss://api.myapp.com/websocket')
```

---

## 2. ğŸ“Š è¿æ¥çŠ¶æ€è¯¦è§£


### 2.1 å››ä¸ªè¿æ¥çŠ¶æ€æ€»è§ˆ


WebSocketå°±åƒä¸€æ‰‡é—¨ï¼Œæœ‰å››ç§çŠ¶æ€ï¼š

```
ğŸšª é—¨çš„çŠ¶æ€å˜åŒ–è¿‡ç¨‹
æ­£åœ¨å¼€é—¨ â†’ é—¨å·²æ‰“å¼€ â†’ æ­£åœ¨å…³é—¨ â†’ é—¨å·²å…³é—­
   â†“         â†“         â†“         â†“
CONNECTING â†’ OPEN â†’ CLOSING â†’ CLOSED
    0        1        2        3
```

### 2.2 çŠ¶æ€è¯¦ç»†è¯´æ˜


**ğŸ”¸ CONNECTING (0) - æ­£åœ¨è¿æ¥**
```javascript
console.log(ws.readyState === WebSocket.CONNECTING) // åˆšåˆ›å»ºæ—¶ä¸ºtrue
```
- **å«ä¹‰**ï¼šåˆšåˆšåˆ›å»ºWebSocketï¼Œæ­£åœ¨å’ŒæœåŠ¡å™¨"æ¡æ‰‹"
- **ç±»æ¯”**ï¼šå°±åƒæ‰“ç”µè¯æ—¶å¬åˆ°"å˜Ÿå˜Ÿå˜Ÿ"çš„æ‹¨å·éŸ³
- **æ³¨æ„**ï¼šè¿™æ—¶å€™ä¸èƒ½å‘æ¶ˆæ¯ï¼Œè¦ç­‰è¿æ¥æˆåŠŸ

**ğŸ”¸ OPEN (1) - è¿æ¥å·²å»ºç«‹**
```javascript 
console.log(ws.readyState === WebSocket.OPEN) // è¿æ¥æˆåŠŸåä¸ºtrue
```
- **å«ä¹‰**ï¼šè¿æ¥æˆåŠŸï¼å¯ä»¥æ­£å¸¸æ”¶å‘æ¶ˆæ¯äº†
- **ç±»æ¯”**ï¼šç”µè¯æ¥é€šäº†ï¼ŒåŒæ–¹å¯ä»¥è¯´è¯
- **å¯ä»¥åš**ï¼šå‘é€æ¶ˆæ¯ `send()`ã€æ¥æ”¶æ¶ˆæ¯

**ğŸ”¸ CLOSING (2) - æ­£åœ¨å…³é—­**
```javascript
ws.close() // è°ƒç”¨å…³é—­åï¼ŒçŠ¶æ€å˜ä¸ºCLOSING
console.log(ws.readyState === WebSocket.CLOSING)
```
- **å«ä¹‰**ï¼šæ­£åœ¨å’ŒæœåŠ¡å™¨è¯´"å†è§"ï¼Œå‡†å¤‡æ–­å¼€
- **ç±»æ¯”**ï¼šæŒ‚ç”µè¯å‰è¯´"æ‹œæ‹œ"çš„è¿‡ç¨‹
- **æ³¨æ„**ï¼šä¸èƒ½å†å‘æ–°æ¶ˆæ¯äº†

**ğŸ”¸ CLOSED (3) - è¿æ¥å·²å…³é—­**
```javascript
// è¿æ¥å®Œå…¨å…³é—­å
console.log(ws.readyState === WebSocket.CLOSED) // true
```
- **å«ä¹‰**ï¼šè¿æ¥å½»åº•æ–­å¼€ï¼Œä»€ä¹ˆéƒ½åšä¸äº†
- **ç±»æ¯”**ï¼šç”µè¯æŒ‚æ–­äº†
- **çŠ¶æ€**ï¼šWebSocketå¯¹è±¡åŸºæœ¬"åºŸäº†"ï¼Œè¦é‡æ–°åˆ›å»º

### 2.3 çŠ¶æ€æ£€æŸ¥å®ç”¨å‡½æ•°


```javascript
// æ£€æŸ¥è¿æ¥çŠ¶æ€çš„å°å·¥å…·
function getConnectionStatus(ws) {
    switch(ws.readyState) {
        case WebSocket.CONNECTING:
            return 'ğŸ”„ æ­£åœ¨è¿æ¥...'
        case WebSocket.OPEN:
            return 'âœ… è¿æ¥æˆåŠŸ'
        case WebSocket.CLOSING:
            return 'â³ æ­£åœ¨å…³é—­...'
        case WebSocket.CLOSED:
            return 'âŒ è¿æ¥å·²æ–­å¼€'
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const ws = new WebSocket('ws://localhost:8080')
console.log(getConnectionStatus(ws)) // ğŸ”„ æ­£åœ¨è¿æ¥...
```

---

## 3. ğŸ¯ æ ¸å¿ƒäº‹ä»¶æœºåˆ¶


### 3.1 äº‹ä»¶ç›‘å¬çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ’¡ ä»€ä¹ˆæ˜¯äº‹ä»¶ç›‘å¬ï¼Ÿ**
å°±åƒç»™æ‰‹æœºè®¾ç½®é“ƒå£°ä¸€æ ·ï¼š
- æœ‰äººæ‰“ç”µè¯ï¼ˆäº‹ä»¶å‘ç”Ÿï¼‰â†’ æ‰‹æœºå“é“ƒï¼ˆè§¦å‘å¤„ç†å‡½æ•°ï¼‰
- WebSocketæœ‰æ¶ˆæ¯ï¼ˆäº‹ä»¶å‘ç”Ÿï¼‰â†’ æ‰§è¡Œä½ å†™çš„ä»£ç ï¼ˆè§¦å‘å¤„ç†å‡½æ•°ï¼‰

### 3.2 å››å¤§æ ¸å¿ƒäº‹ä»¶è¯¦è§£


#### ğŸŸ¢ onopen - è¿æ¥å»ºç«‹æˆåŠŸ


```javascript
const ws = new WebSocket('ws://localhost:8080')

ws.onopen = function() {
    console.log('ğŸ‰ è¿æ¥æˆåŠŸï¼å¯ä»¥å¼€å§‹èŠå¤©äº†')
    // è¿æ¥æˆåŠŸåå¯ä»¥å‘é€æ¶ˆæ¯
    ws.send('Hello Server!')
}
```

**ğŸ”¸ ä»€ä¹ˆæ—¶å€™è§¦å‘**ï¼š
- å’ŒæœåŠ¡å™¨æ¡æ‰‹æˆåŠŸ
- çŠ¶æ€ä» `CONNECTING` å˜ä¸º `OPEN`

**ğŸ”¸ é€šå¸¸åœ¨è¿™é‡Œåšä»€ä¹ˆ**ï¼š
- æç¤ºç”¨æˆ·"è¿æ¥æˆåŠŸ"
- å‘é€ç™»å½•ä¿¡æ¯
- å¼€å§‹å¿ƒè·³æ£€æµ‹

#### ğŸ“¨ onmessage - æ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯


```javascript
ws.onmessage = function(event) {
    console.log('ğŸ“¬ æ”¶åˆ°æ¶ˆæ¯:', event.data)
    
    // æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢
    const chatBox = document.getElementById('chat')
    chatBox.innerHTML += `<div>æœåŠ¡å™¨è¯´ï¼š${event.data}</div>`
}
```

**ğŸ”¸ event.data æ˜¯ä»€ä¹ˆ**ï¼š
- æœåŠ¡å™¨å‘é€è¿‡æ¥çš„æ¶ˆæ¯å†…å®¹
- å¯èƒ½æ˜¯æ–‡å­—ã€JSONå­—ç¬¦ä¸²ç­‰

**ğŸ”¸ é€šå¸¸åœ¨è¿™é‡Œåšä»€ä¹ˆ**ï¼š
- è§£ææ¶ˆæ¯å†…å®¹
- æ›´æ–°ç•Œé¢æ˜¾ç¤º
- å¤„ç†ä¸šåŠ¡é€»è¾‘

#### âŒ onerror - å¤„ç†é”™è¯¯


```javascript
ws.onerror = function(error) {
    console.log('ğŸ’¥ è¿æ¥å‡ºé”™äº†:', error)
    alert('è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œï¼')
}
```

**ğŸ”¸ ä»€ä¹ˆæ—¶å€™è§¦å‘**ï¼š
- ç½‘ç»œæ–­å¼€
- æœåŠ¡å™¨å…³é—­
- è¿æ¥åœ°å€é”™è¯¯

**ğŸ”¸ é€šå¸¸åœ¨è¿™é‡Œåšä»€ä¹ˆ**ï¼š
- æç¤ºç”¨æˆ·å‡ºé”™äº†
- å°è¯•é‡æ–°è¿æ¥
- è®°å½•é”™è¯¯æ—¥å¿—

#### ğŸšª onclose - è¿æ¥å…³é—­


```javascript
ws.onclose = function(event) {
    console.log('ğŸ‘‹ è¿æ¥å…³é—­äº†')
    console.log('å…³é—­ä»£ç :', event.code)
    console.log('å…³é—­åŸå› :', event.reason)
    
    if (event.code === 1000) {
        console.log('æ­£å¸¸å…³é—­')
    } else {
        console.log('å¼‚å¸¸å…³é—­ï¼Œå¯èƒ½éœ€è¦é‡è¿')
    }
}
```

**ğŸ”¸ eventå¯¹è±¡åŒ…å«**ï¼š
- `code`: å…³é—­ä»£ç ï¼ˆ1000è¡¨ç¤ºæ­£å¸¸å…³é—­ï¼‰
- `reason`: å…³é—­åŸå› è¯´æ˜

### 3.3 äº‹ä»¶ç›‘å¬çš„ä¸¤ç§å†™æ³•


**æ–¹å¼ä¸€ï¼šç›´æ¥èµ‹å€¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰**
```javascript
ws.onopen = function() { console.log('è¿æ¥æˆåŠŸ') }
```

**æ–¹å¼äºŒï¼šaddEventListenerï¼ˆæ›´çµæ´»ï¼‰**
```javascript
ws.addEventListener('open', function() {
    console.log('è¿æ¥æˆåŠŸ')
})
```

---

## 4. ğŸ’¬ æ•°æ®å‘é€ä¸æ¥æ”¶


### 4.1 send() æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```javascript
ws.send(data)
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
`send()` å°±åƒå‘å¾®ä¿¡æ¶ˆæ¯ï¼ŒæŠŠä½ æƒ³è¯´çš„è¯å‘ç»™å¯¹æ–¹ã€‚

### 4.2 å¯ä»¥å‘é€çš„æ•°æ®ç±»å‹


```javascript
// 1. å‘é€æ–‡å­—æ¶ˆæ¯ï¼ˆæœ€å¸¸ç”¨ï¼‰
ws.send('Hello World!')

// 2. å‘é€JSONæ•°æ®
const message = {
    type: 'chat',
    content: 'ä½ å¥½',
    from: 'user123'
}
ws.send(JSON.stringify(message))

// 3. å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
const blob = new Blob(['binary data'])
ws.send(blob)
```

### 4.3 å®‰å…¨å‘é€çš„æ­£ç¡®åšæ³•


```javascript
function safeSend(ws, message) {
    // æ£€æŸ¥è¿æ¥çŠ¶æ€
    if (ws.readyState === WebSocket.OPEN) {
        ws.send(message)
        console.log('âœ… æ¶ˆæ¯å·²å‘é€:', message)
    } else {
        console.log('âŒ è¿æ¥æœªå°±ç»ªï¼Œæ— æ³•å‘é€')
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const ws = new WebSocket('ws://localhost:8080')
safeSend(ws, 'Hello') // âŒ è¿æ¥æœªå°±ç»ªï¼Œæ— æ³•å‘é€

ws.onopen = function() {
    safeSend(ws, 'Hello') // âœ… æ¶ˆæ¯å·²å‘é€: Hello
}
```

### 4.4 æ¥æ”¶æ¶ˆæ¯çš„å¤„ç†


```javascript
ws.onmessage = function(event) {
    const message = event.data
    
    try {
        // å°è¯•è§£æä¸ºJSON
        const data = JSON.parse(message)
        console.log('æ”¶åˆ°JSONæ¶ˆæ¯:', data)
        
        // æ ¹æ®æ¶ˆæ¯ç±»å‹å¤„ç†
        if (data.type === 'chat') {
            showChatMessage(data.content)
        }
    } catch (e) {
        // æ™®é€šæ–‡å­—æ¶ˆæ¯
        console.log('æ”¶åˆ°æ–‡å­—æ¶ˆæ¯:', message)
        showTextMessage(message)
    }
}
```

---

## 5. ğŸ”§ è¿æ¥ç®¡ç†æ“ä½œ


### 5.1 close() æ–¹æ³•è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```javascript
ws.close()                    // ç®€å•å…³é—­
ws.close(code, reason)        // å¸¦å‚æ•°å…³é—­
```

**ğŸ”¸ å‚æ•°è¯´æ˜**
```javascript
// æ­£å¸¸å…³é—­
ws.close(1000, 'ç”¨æˆ·ä¸»åŠ¨é€€å‡º')

// å¼‚å¸¸å…³é—­
ws.close(1001, 'é¡µé¢åˆ·æ–°')
```

**ğŸ“‹ å¸¸ç”¨å…³é—­ä»£ç **

| ä»£ç  | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|-------------|
| `1000` | æ­£å¸¸å…³é—­ | ç”¨æˆ·ç‚¹å‡»å…³é—­æŒ‰é’® |
| `1001` | ç«¯ç‚¹ç¦»å¼€ | é¡µé¢åˆ·æ–°/è·³è½¬ |
| `1002` | åè®®é”™è¯¯ | æ•°æ®æ ¼å¼é”™è¯¯ |

### 5.2 è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†


```javascript
class WebSocketManager {
    constructor(url) {
        this.url = url
        this.ws = null
        this.connect()
    }
    
    connect() {
        console.log('ğŸ”„ æ­£åœ¨è¿æ¥...')
        this.ws = new WebSocket(this.url)
        
        this.ws.onopen = () => {
            console.log('âœ… è¿æ¥æˆåŠŸ')
        }
        
        this.ws.onclose = () => {
            console.log('âŒ è¿æ¥å…³é—­')
        }
        
        this.ws.onerror = () => {
            console.log('ğŸ’¥ è¿æ¥é”™è¯¯')
        }
    }
    
    // å®‰å…¨å‘é€æ¶ˆæ¯
    send(message) {
        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
            this.ws.send(message)
            return true
        }
        return false
    }
    
    // å…³é—­è¿æ¥
    close() {
        if (this.ws) {
            this.ws.close(1000, 'ç”¨æˆ·ä¸»åŠ¨å…³é—­')
        }
    }
}
```

---

## 6. ğŸ® å®æˆ˜æ¡ˆä¾‹


### 6.1 æœ€å°å¯è¿è¡Œç¤ºä¾‹


**ğŸ“„ HTMLé¡µé¢ (chat.html)**
```html
<!DOCTYPE html>
<html>
<head>
    <title>WebSocketèŠå¤©å®¤</title>
    <style>
        #chatBox { 
            border: 1px solid #ccc; 
            height: 300px; 
            padding: 10px; 
            overflow-y: auto;
            margin-bottom: 10px;
        }
        #messageInput { 
            width: 70%; 
            padding: 5px; 
        }
        button { 
            padding: 5px 15px; 
        }
    </style>
</head>
<body>
    <h2>ğŸ’¬ ç®€å•èŠå¤©å®¤</h2>
    <div id="status">ğŸ”„ æ­£åœ¨è¿æ¥...</div>
    <div id="chatBox"></div>
    <input type="text" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯...">
    <button onclick="sendMessage()">å‘é€</button>
    <button onclick="disconnect()">æ–­å¼€è¿æ¥</button>
    
    <script>
        // åˆ›å»ºWebSocketè¿æ¥
        const ws = new WebSocket('ws://localhost:8080')
        const statusDiv = document.getElementById('status')
        const chatBox = document.getElementById('chatBox')
        const messageInput = document.getElementById('messageInput')
        
        // è¿æ¥æˆåŠŸ
        ws.onopen = function() {
            statusDiv.textContent = 'âœ… è¿æ¥æˆåŠŸ'
            statusDiv.style.color = 'green'
            addMessage('ç³»ç»Ÿ', 'æ¬¢è¿è¿›å…¥èŠå¤©å®¤ï¼')
        }
        
        // æ”¶åˆ°æ¶ˆæ¯
        ws.onmessage = function(event) {
            addMessage('æœåŠ¡å™¨', event.data)
        }
        
        // è¿æ¥é”™è¯¯
        ws.onerror = function() {
            statusDiv.textContent = 'âŒ è¿æ¥å¤±è´¥'
            statusDiv.style.color = 'red'
        }
        
        // è¿æ¥å…³é—­
        ws.onclose = function() {
            statusDiv.textContent = 'ğŸšª è¿æ¥å·²å…³é—­'
            statusDiv.style.color = 'gray'
        }
        
        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const message = messageInput.value.trim()
            
            if (message && ws.readyState === WebSocket.OPEN) {
                ws.send(message)
                addMessage('æˆ‘', message)
                messageInput.value = ''
            } else if (!message) {
                alert('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹')
            } else {
                alert('è¿æ¥æœªå°±ç»ªï¼Œæ— æ³•å‘é€æ¶ˆæ¯')
            }
        }
        
        // æ–­å¼€è¿æ¥
        function disconnect() {
            ws.close(1000, 'ç”¨æˆ·ä¸»åŠ¨æ–­å¼€')
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function addMessage(sender, content) {
            const messageDiv = document.createElement('div')
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${content}`
            messageDiv.style.marginBottom = '5px'
            chatBox.appendChild(messageDiv)
            chatBox.scrollTop = chatBox.scrollHeight
        }
        
        // å›è½¦å‘é€æ¶ˆæ¯
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage()
            }
        })
    </script>
</body>
</html>
```

### 6.2 ä»£ç è§£æ


**ğŸ”¸ å…³é”®ä»£ç è¯´æ˜**

```javascript
// 1. åˆ›å»ºè¿æ¥
const ws = new WebSocket('ws://localhost:8080')

// 2. ç›‘å¬å››å¤§äº‹ä»¶
ws.onopen = function() { /* è¿æ¥æˆåŠŸå¤„ç† */ }
ws.onmessage = function(event) { /* æ¥æ”¶æ¶ˆæ¯å¤„ç† */ }  
ws.onerror = function() { /* é”™è¯¯å¤„ç† */ }
ws.onclose = function() { /* å…³é—­å¤„ç† */ }

// 3. å®‰å…¨å‘é€æ¶ˆæ¯
if (ws.readyState === WebSocket.OPEN) {
    ws.send(message)
}

// 4. ä¸»åŠ¨å…³é—­è¿æ¥
ws.close(1000, 'ç”¨æˆ·ä¸»åŠ¨æ–­å¼€')
```

### 6.3 æµ‹è¯•æ–¹æ³•


**æ­¥éª¤ 1ï¸âƒ£ï¼š** å¯åŠ¨WebSocketæœåŠ¡å™¨ï¼ˆéœ€è¦åç«¯æ”¯æŒï¼‰
**æ­¥éª¤ 2ï¸âƒ£ï¼š** ç”¨æµè§ˆå™¨æ‰“å¼€HTMLæ–‡ä»¶  
**æ­¥éª¤ 3ï¸âƒ£ï¼š** è§‚å¯Ÿè¿æ¥çŠ¶æ€å˜åŒ–
**æ­¥éª¤ 4ï¸âƒ£ï¼š** å°è¯•å‘é€æ¶ˆæ¯æµ‹è¯•

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»è®°ä½çš„å…³é”®ç‚¹


```
ğŸ”¸ åˆ›å»ºè¿æ¥ï¼šnew WebSocket(url)
ğŸ”¸ å››ä¸ªçŠ¶æ€ï¼šCONNECTING â†’ OPEN â†’ CLOSING â†’ CLOSED  
ğŸ”¸ å››å¤§äº‹ä»¶ï¼šonopenã€onmessageã€onerrorã€onclose
ğŸ”¸ å‘é€æ•°æ®ï¼šsend() æ–¹æ³•ï¼ˆéœ€æ£€æŸ¥è¿æ¥çŠ¶æ€ï¼‰
ğŸ”¸ å…³é—­è¿æ¥ï¼šclose() æ–¹æ³•
```

### 7.2 æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**
```javascript
// 1. å‘é€å‰æ£€æŸ¥çŠ¶æ€
if (ws.readyState === WebSocket.OPEN) {
    ws.send(message)
}

// 2. å¤„ç†æ‰€æœ‰äº‹ä»¶
ws.onopen = function() { /* è¿æ¥æˆåŠŸ */ }
ws.onmessage = function(event) { /* å¤„ç†æ¶ˆæ¯ */ }
ws.onerror = function() { /* é”™è¯¯å¤„ç† */ }
ws.onclose = function() { /* æ¸…ç†èµ„æº */ }

// 3. ä¼˜é›…å…³é—­
ws.close(1000, 'æ­£å¸¸å…³é—­')
```

**âŒ å¸¸è§é”™è¯¯**
```javascript
// é”™è¯¯ï¼šè¿æ¥æœªå°±ç»ªå°±å‘é€
const ws = new WebSocket(url)
ws.send('hello') // âŒ å¯èƒ½å¤±è´¥

// é”™è¯¯ï¼šä¸æ£€æŸ¥çŠ¶æ€
ws.send(message) // âŒ è¿æ¥å…³é—­æ—¶ä¼šæŠ¥é”™

// é”™è¯¯ï¼šå¿˜è®°äº‹ä»¶å¤„ç†
// âŒ æ²¡æœ‰onerrorå¤„ç†ï¼Œå‡ºé”™æ—¶ç”¨æˆ·ä¸çŸ¥é“
```

### 7.3 å­¦ä¹ è¦ç‚¹


**ğŸ§  è®°å¿†æŠ€å·§**
> *"æ–°å»ºè¿æ¥è¦ç­‰å¼€ï¼Œå››ä¸ªäº‹ä»¶å…¨ç›‘å¬ï¼Œå‘é€ä¹‹å‰æŸ¥çŠ¶æ€ï¼Œå…³é—­è®°å¾—å¸¦å‚æ•°"*

**ğŸ¯ æ ¸å¿ƒç†è§£**
- WebSocketå°±åƒæ‰“ç”µè¯ï¼šæ‹¨å·â†’æ¥é€šâ†’é€šè¯â†’æŒ‚æ–­
- äº‹ä»¶ç›‘å¬å°±åƒè®¾ç½®æé†’ï¼šæœ‰æƒ…å†µå°±é€šçŸ¥ä½ 
- çŠ¶æ€æ£€æŸ¥å¾ˆé‡è¦ï¼šç¡®ä¿"çº¿è·¯ç•…é€š"å†è¯´è¯

**ğŸ’¡ å®é™…åº”ç”¨ä»·å€¼**
- **å³æ—¶é€šè®¯**ï¼šèŠå¤©ã€æ¶ˆæ¯æ¨é€
- **å®æ—¶æ›´æ–°**ï¼šè‚¡ä»·ã€æ¸¸æˆçŠ¶æ€  
- **ååŒå·¥ä½œ**ï¼šåœ¨çº¿æ–‡æ¡£ã€ç™½æ¿
- **ç›‘æ§ç³»ç»Ÿ**ï¼šå®æ—¶æ•°æ®å±•ç¤º

**æ ¸å¿ƒè®°å¿†**ï¼š
- WebSocket APIç®€å•å®ç”¨ï¼ŒæŒæ¡æ„é€ å‡½æ•°å’Œå››å¤§äº‹ä»¶å°±èƒ½ä¸Šæ‰‹
- çŠ¶æ€ç®¡ç†æ˜¯å…³é”®ï¼Œå‘é€å‰å¿…é¡»æ£€æŸ¥è¿æ¥çŠ¶æ€
- å®æˆ˜ä¸­è¦å¤„ç†æ‰€æœ‰å¯èƒ½çš„æƒ…å†µï¼šæˆåŠŸã€å¤±è´¥ã€é”™è¯¯ã€å…³é—­