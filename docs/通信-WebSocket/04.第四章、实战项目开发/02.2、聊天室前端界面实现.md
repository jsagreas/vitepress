---
title: 2ã€èŠå¤©å®¤å‰ç«¯ç•Œé¢å®ç°
---
## ğŸ“š ç›®å½•

1. [èŠå¤©ç•Œé¢æ•´ä½“å¸ƒå±€](#1-èŠå¤©ç•Œé¢æ•´ä½“å¸ƒå±€)
2. [æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸå®ç°](#2-æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸå®ç°)
3. [æ¶ˆæ¯è¾“å…¥ä¸å‘é€åŠŸèƒ½](#3-æ¶ˆæ¯è¾“å…¥ä¸å‘é€åŠŸèƒ½)
4. [ç”¨æˆ·ç•Œé¢äº¤äº’ä¼˜åŒ–](#4-ç”¨æˆ·ç•Œé¢äº¤äº’ä¼˜åŒ–)
5. [å‰ç«¯æ¡†æ¶é›†æˆå®ç°](#5-å‰ç«¯æ¡†æ¶é›†æˆå®ç°)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¬ èŠå¤©ç•Œé¢æ•´ä½“å¸ƒå±€


### 1.1 HTMLç»“æ„è®¾è®¡


**ğŸ”¸ ä»€ä¹ˆæ˜¯èŠå¤©ç•Œé¢å¸ƒå±€ï¼Ÿ**
ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠèŠå¤©å®¤åˆ†æˆå‡ ä¸ªåŒºåŸŸï¼š**é¡¶éƒ¨æ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯**ï¼Œ**ä¸­é—´æ˜¾ç¤ºèŠå¤©æ¶ˆæ¯**ï¼Œ**åº•éƒ¨è¾“å…¥æ¶ˆæ¯**ã€‚å°±åƒæˆ‘ä»¬ç”¨å¾®ä¿¡ä¸€æ ·çš„å¸ƒå±€ã€‚

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocketèŠå¤©å®¤</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- èŠå¤©å®¤å®¹å™¨ -->
    <div class="chat-container">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="chat-header">
            <h2>ğŸ’¬ èŠå¤©å®¤</h2>
            <span class="online-count">åœ¨çº¿ï¼š<span id="userCount">0</span>äºº</span>
        </div>
        
        <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="chat-messages" id="messages">
            <!-- æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
        </div>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="chat-input">
            <input type="text" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." maxlength="500">
            <button id="sendBtn">å‘é€</button>
        </div>
    </div>
</body>
</html>
```

### 1.2 CSSå“åº”å¼å¸ƒå±€


**ğŸ”¸ ä»€ä¹ˆæ˜¯å“åº”å¼å¸ƒå±€ï¼Ÿ**
å°±æ˜¯è®©èŠå¤©å®¤åœ¨**æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘**ä¸Šéƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä¸ä¼šå› ä¸ºå±å¹•å¤§å°ä¸åŒå°±å˜å½¢æˆ–è€…çœ‹ä¸æ¸…ã€‚

```css
/* èŠå¤©å®¤æ•´ä½“å®¹å™¨ */
.chat-container {
    max-width: 800px;
    margin: 0 auto;
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: #f5f5f5;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* é¡¶éƒ¨ä¿¡æ¯æ  */
.chat-header {
    background: #4CAF50;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ - è¿™æ˜¯å…³é”®éƒ¨åˆ† */
.chat-messages {
    flex: 1;              /* è‡ªåŠ¨å æ»¡å‰©ä½™ç©ºé—´ */
    overflow-y: auto;     /* æ¶ˆæ¯å¤šäº†å¯ä»¥æ»šåŠ¨ */
    padding: 20px;
    background: white;
}

/* è¾“å…¥åŒºåŸŸ */
.chat-input {
    padding: 15px 20px;
    background: #f8f9fa;
    display: flex;
    gap: 10px;
}

/* å“åº”å¼è®¾è®¡ - æ‰‹æœºç«¯é€‚é… */
@media (max-width: 768px) {
    .chat-container {
        height: 100vh;
        border-radius: 0;     /* æ‰‹æœºä¸Šå»æ‰åœ†è§’ */
        max-width: 100%;
    }
    
    .chat-header h2 {
        font-size: 18px;     /* æ‰‹æœºä¸Šå­—ä½“å°ä¸€ç‚¹ */
    }
    
    .chat-input input {
        font-size: 16px;     /* é˜²æ­¢iOSç¼©æ”¾ */
    }
}
```

> ğŸ’¡ **å¸ƒå±€æŠ€å·§**: ä½¿ç”¨ `flex: 1` è®©æ¶ˆæ¯åŒºåŸŸè‡ªåŠ¨å æ»¡ä¸­é—´ç©ºé—´ï¼Œè¿™æ ·ä¸ç®¡å±å¹•å¤šé«˜ï¼Œè¾“å…¥æ¡†éƒ½ä¼šåœ¨åº•éƒ¨ã€‚

---

## 2. ğŸ“ æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸå®ç°


### 2.1 æ¶ˆæ¯æ ·å¼è®¾è®¡


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ ·å¼åŒºåˆ†ï¼Ÿ**
å°±æ˜¯è®©**è‡ªå·±å‘çš„æ¶ˆæ¯**å’Œ**åˆ«äººå‘çš„æ¶ˆæ¯**çœ‹èµ·æ¥ä¸ä¸€æ ·ï¼Œ**ç³»ç»Ÿæ¶ˆæ¯**ä¹Ÿè¦æœ‰ç‰¹åˆ«çš„æ ·å¼ã€‚å°±åƒå¾®ä¿¡é‡Œè‡ªå·±çš„æ¶ˆæ¯åœ¨å³è¾¹ï¼Œåˆ«äººçš„åœ¨å·¦è¾¹ã€‚

```css
/* æ¶ˆæ¯åŸºç¡€æ ·å¼ */
.message {
    margin-bottom: 15px;
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 70%;
    word-wrap: break-word;
    position: relative;
}

/* è‡ªå·±å‘çš„æ¶ˆæ¯ - å³å¯¹é½ï¼Œè“è‰² */
.message.own {
    background: #007AFF;
    color: white;
    margin-left: auto;
    margin-right: 0;
}

/* åˆ«äººå‘çš„æ¶ˆæ¯ - å·¦å¯¹é½ï¼Œç°è‰² */
.message.other {
    background: #E5E5EA;
    color: #333;
    margin-left: 0;
    margin-right: auto;
}

/* ç³»ç»Ÿæ¶ˆæ¯ - å±…ä¸­ï¼Œç‰¹æ®Šé¢œè‰² */
.message.system {
    background: #FFF3CD;
    color: #856404;
    text-align: center;
    margin: 10px auto;
    font-size: 14px;
    max-width: 300px;
}

/* æ¶ˆæ¯å¤´éƒ¨ä¿¡æ¯ */
.message-header {
    font-size: 12px;
    margin-bottom: 5px;
    opacity: 0.7;
}

.message-time {
    font-size: 11px;
    opacity: 0.6;
    margin-top: 4px;
}
```

### 2.2 åŠ¨æ€æ¶ˆæ¯æ·»åŠ 


**ğŸ”¸ ä»€ä¹ˆæ˜¯åŠ¨æ€æ·»åŠ æ¶ˆæ¯ï¼Ÿ**
å°±æ˜¯å½“æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶ï¼Œç”¨JavaScriptæŠŠæ¶ˆæ¯**è‡ªåŠ¨æ·»åŠ åˆ°èŠå¤©ç•Œé¢**ä¸Šï¼Œç”¨æˆ·å°±èƒ½çœ‹åˆ°æ–°æ¶ˆæ¯äº†ã€‚

```javascript
// æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢çš„å‡½æ•°
function addMessage(data) {
    const messagesDiv = document.getElementById('messages');
    const messageDiv = document.createElement('div');
    
    // åˆ¤æ–­æ¶ˆæ¯ç±»å‹ï¼Œæ·»åŠ å¯¹åº”çš„æ ·å¼
    if (data.type === 'system') {
        // ç³»ç»Ÿæ¶ˆæ¯ï¼šç”¨æˆ·è¿›å…¥ã€ç¦»å¼€ç­‰
        messageDiv.className = 'message system';
        messageDiv.innerHTML = `ğŸ“¢ ${data.content}`;
    } else {
        // æ™®é€šèŠå¤©æ¶ˆæ¯
        const isOwn = data.userId === currentUserId;
        messageDiv.className = `message ${isOwn ? 'own' : 'other'}`;
        
        messageDiv.innerHTML = `
            <div class="message-header">
                ${isOwn ? 'æˆ‘' : data.nickname}
            </div>
            <div class="message-content">${data.content}</div>
            <div class="message-time">${formatTime(data.timestamp)}</div>
        `;
    }
    
    // æ·»åŠ åˆ°æ¶ˆæ¯åŒºåŸŸ
    messagesDiv.appendChild(messageDiv);
    
    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆé‡è¦ï¼ï¼‰
    scrollToBottom();
}
```

### 2.3 æ—¶é—´æˆ³æ ¼å¼åŒ–


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ—¶é—´æˆ³æ ¼å¼åŒ–ï¼Ÿ**
æœåŠ¡å™¨å‘æ¥çš„æ—¶é—´æ˜¯æ•°å­—æ ¼å¼ï¼ˆå¦‚1642234567890ï¼‰ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒ**è½¬æ¢æˆäººèƒ½çœ‹æ‡‚çš„æ—¶é—´**ï¼Œæ¯”å¦‚"14:30"æˆ–"æ˜¨å¤© 15:20"ã€‚

```javascript
function formatTime(timestamp) {
    const now = new Date();
    const msgTime = new Date(timestamp);
    const diff = now - msgTime;
    
    // 1åˆ†é’Ÿå†…æ˜¾ç¤º"åˆšåˆš"
    if (diff < 60000) {
        return 'åˆšåˆš';
    }
    
    // 1å°æ—¶å†…æ˜¾ç¤º"Xåˆ†é’Ÿå‰"
    if (diff < 3600000) {
        return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
    }
    
    // ä»Šå¤©çš„æ¶ˆæ¯æ˜¾ç¤ºæ—¶åˆ†
    if (msgTime.toDateString() === now.toDateString()) {
        return msgTime.toLocaleTimeString('zh-CN', {
            hour: '2-digit',
            minute: '2-digit'
        });
    }
    
    // æ˜¨å¤©çš„æ¶ˆæ¯
    const yesterday = new Date(now - 86400000);
    if (msgTime.toDateString() === yesterday.toDateString()) {
        return `æ˜¨å¤© ${msgTime.toLocaleTimeString('zh-CN', {
            hour: '2-digit',
            minute: '2-digit'
        })}`;
    }
    
    // æ›´æ—©çš„æ¶ˆæ¯æ˜¾ç¤ºæ—¥æœŸæ—¶é—´
    return msgTime.toLocaleString('zh-CN');
}
```

### 2.4 è‡ªåŠ¨æ»šåŠ¨åŠŸèƒ½


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨æ»šåŠ¨ï¼Ÿ**
å½“æ–°æ¶ˆæ¯æ¥äº†ï¼Œå¦‚æœä¸è‡ªåŠ¨æ»šåŠ¨ï¼Œç”¨æˆ·å¯èƒ½çœ‹ä¸åˆ°æœ€æ–°çš„æ¶ˆæ¯ï¼ˆå› ä¸ºè¿˜åœç•™åœ¨ä¸Šé¢çš„èŠå¤©è®°å½•ï¼‰ã€‚å°±åƒå¾®ä¿¡ä¼šè‡ªåŠ¨è·³åˆ°æœ€æ–°æ¶ˆæ¯ä¸€æ ·ã€‚

```javascript
function scrollToBottom() {
    const messagesDiv = document.getElementById('messages');
    // å¹³æ»‘æ»šåŠ¨åˆ°åº•éƒ¨
    messagesDiv.scrollTo({
        top: messagesDiv.scrollHeight,
        behavior: 'smooth'
    });
}

// ä¼˜åŒ–ç‰ˆæœ¬ï¼šåªæœ‰åœ¨æ¥è¿‘åº•éƒ¨æ—¶æ‰è‡ªåŠ¨æ»šåŠ¨
function smartScrollToBottom() {
    const messagesDiv = document.getElementById('messages');
    const isNearBottom = messagesDiv.scrollTop + messagesDiv.clientHeight 
                        >= messagesDiv.scrollHeight - 50;
    
    // å¦‚æœç”¨æˆ·æ­£åœ¨æŸ¥çœ‹å†å²æ¶ˆæ¯ï¼Œå°±ä¸è¦å¼ºåˆ¶æ»šåŠ¨
    if (isNearBottom) {
        scrollToBottom();
    }
}
```

---

## 3. âœï¸ æ¶ˆæ¯è¾“å…¥ä¸å‘é€åŠŸèƒ½


### 3.1 è¾“å…¥æ¡†åŸºç¡€åŠŸèƒ½


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¾“å…¥æ¡†åŠŸèƒ½ï¼Ÿ**
å°±æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿ**è¾“å…¥æ–‡å­—**ã€**æŒ‰å›è½¦å‘é€**ã€**ç‚¹å‡»æŒ‰é’®å‘é€**ï¼Œè¿˜è¦é˜²æ­¢å‘é€ç©ºæ¶ˆæ¯ã€‚

```javascript
class ChatInput {
    constructor() {
        this.messageInput = document.getElementById('messageInput');
        this.sendBtn = document.getElementById('sendBtn');
        this.setupEventListeners();
    }
    
    setupEventListeners() {
        // å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        this.sendBtn.addEventListener('click', () => {
            this.sendMessage();
        });
        
        // å›è½¦é”®å‘é€ï¼ˆä½†Shift+å›è½¦æ¢è¡Œï¼‰
        this.messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤æ¢è¡Œ
                this.sendMessage();
            }
        });
        
        // è¾“å…¥æ—¶çš„å®æ—¶åé¦ˆ
        this.messageInput.addEventListener('input', () => {
            this.updateSendButton();
        });
    }
    
    sendMessage() {
        const content = this.messageInput.value.trim();
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºç©º
        if (!content) {
            this.showTip('è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹');
            return;
        }
        
        // æ£€æŸ¥é•¿åº¦
        if (content.length > 500) {
            this.showTip('æ¶ˆæ¯å¤ªé•¿äº†ï¼Œè¯·åˆ†æ¡å‘é€');
            return;
        }
        
        // å‘é€æ¶ˆæ¯ï¼ˆé€šè¿‡WebSocketï¼‰
        if (websocket && websocket.readyState === WebSocket.OPEN) {
            websocket.send(JSON.stringify({
                type: 'message',
                content: content
            }));
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            this.messageInput.value = '';
            this.updateSendButton();
        } else {
            this.showTip('è¿æ¥å·²æ–­å¼€ï¼Œè¯·åˆ·æ–°é¡µé¢');
        }
    }
    
    updateSendButton() {
        const hasContent = this.messageInput.value.trim().length > 0;
        this.sendBtn.disabled = !hasContent;
        this.sendBtn.style.opacity = hasContent ? '1' : '0.5';
    }
}
```

### 3.2 ç”¨æˆ·æ˜µç§°è®¾ç½®


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ˜µç§°è®¾ç½®ï¼Ÿ**
ç”¨æˆ·è¿›å…¥èŠå¤©å®¤å‰ï¼Œéœ€è¦**è®¾ç½®ä¸€ä¸ªæ˜µç§°**ï¼Œè¿™æ ·å…¶ä»–äººå°±çŸ¥é“æ˜¯è°åœ¨è¯´è¯ã€‚å¯ä»¥åšæˆå¼¹çª—å½¢å¼ã€‚

```html
<!-- æ˜µç§°è®¾ç½®å¼¹çª— -->
<div class="nickname-modal" id="nicknameModal">
    <div class="modal-content">
        <h3>è®¾ç½®æ˜µç§°</h3>
        <input type="text" id="nicknameInput" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" maxlength="20">
        <div class="modal-buttons">
            <button id="confirmBtn">è¿›å…¥èŠå¤©å®¤</button>
        </div>
    </div>
</div>
```

```css
.nickname-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    text-align: center;
}
```

```javascript
class NicknameManager {
    constructor() {
        this.modal = document.getElementById('nicknameModal');
        this.input = document.getElementById('nicknameInput');
        this.confirmBtn = document.getElementById('confirmBtn');
        this.setupEvents();
    }
    
    setupEvents() {
        this.confirmBtn.addEventListener('click', () => {
            this.setNickname();
        });
        
        this.input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                this.setNickname();
            }
        });
    }
    
    setNickname() {
        const nickname = this.input.value.trim();
        
        if (!nickname) {
            this.showError('è¯·è¾“å…¥æ˜µç§°');
            return;
        }
        
        if (nickname.length > 20) {
            this.showError('æ˜µç§°å¤ªé•¿äº†');
            return;
        }
        
        // ä¿å­˜æ˜µç§°å¹¶éšè—å¼¹çª—
        currentUser.nickname = nickname;
        this.modal.style.display = 'none';
        
        // è¿æ¥WebSocket
        connectWebSocket();
    }
}
```

### 3.3 è¾“å…¥é˜²æŠ–ä¼˜åŒ–


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¾“å…¥é˜²æŠ–ï¼Ÿ**
é˜²æŠ–å°±æ˜¯é˜²æ­¢ç”¨æˆ·**è¿ç»­å¿«é€Ÿæ“ä½œ**ã€‚æ¯”å¦‚ç”¨æˆ·ç–¯ç‹‚ç‚¹å‡»å‘é€æŒ‰é’®ï¼Œæˆ‘ä»¬è¦é¿å…å‘é€é‡å¤æ¶ˆæ¯ã€‚

```javascript
class InputDebounce {
    constructor(delay = 300) {
        this.delay = delay;
        this.timers = new Map();
    }
    
    // é˜²æŠ–å‘é€æ¶ˆæ¯
    debounceSend(callback) {
        if (this.timers.has('send')) {
            return; // è¿˜åœ¨é˜²æŠ–æœŸå†…ï¼Œå¿½ç•¥è¿™æ¬¡ç‚¹å‡»
        }
        
        callback();
        
        // è®¾ç½®é˜²æŠ–
        this.timers.set('send', setTimeout(() => {
            this.timers.delete('send');
        }, this.delay));
    }
    
    // é˜²æŠ–è¾“å…¥æç¤º
    debounceInput(callback) {
        if (this.timers.has('input')) {
            clearTimeout(this.timers.get('input'));
        }
        
        this.timers.set('input', setTimeout(() => {
            callback();
            this.timers.delete('input');
        }, this.delay));
    }
}

// ä½¿ç”¨é˜²æŠ–
const debounce = new InputDebounce(500);

sendBtn.addEventListener('click', () => {
    debounce.debounceSend(() => {
        sendMessage();
    });
});
```

---

## 4. ğŸ¯ ç”¨æˆ·ç•Œé¢äº¤äº’ä¼˜åŒ–


### 4.1 æ¶ˆæ¯å‘é€çŠ¶æ€æç¤º


**ğŸ”¸ ä»€ä¹ˆæ˜¯å‘é€çŠ¶æ€æç¤ºï¼Ÿ**
å°±æ˜¯å‘Šè¯‰ç”¨æˆ·æ¶ˆæ¯**å‘é€ä¸­**ã€**å‘é€æˆåŠŸ**è¿˜æ˜¯**å‘é€å¤±è´¥**ï¼Œå°±åƒå¾®ä¿¡æ—è¾¹çš„å°åœˆåœˆå’Œå‹¾å‹¾ã€‚

```javascript
class MessageStatus {
    addMessage(content) {
        const messageId = Date.now() + Math.random();
        const messageDiv = this.createMessageElement(content, messageId);
        
        // æ·»åŠ å‘é€ä¸­çŠ¶æ€
        this.setMessageStatus(messageDiv, 'sending');
        
        // å‘é€æ¶ˆæ¯
        this.sendToServer(content)
            .then(() => {
                this.setMessageStatus(messageDiv, 'sent');
            })
            .catch(() => {
                this.setMessageStatus(messageDiv, 'failed');
            });
        
        return messageDiv;
    }
    
    setMessageStatus(messageDiv, status) {
        const statusIcon = messageDiv.querySelector('.message-status');
        
        switch (status) {
            case 'sending':
                statusIcon.innerHTML = 'â³';
                statusIcon.title = 'å‘é€ä¸­...';
                break;
            case 'sent':
                statusIcon.innerHTML = 'âœ…';
                statusIcon.title = 'å·²å‘é€';
                break;
            case 'failed':
                statusIcon.innerHTML = 'âŒ';
                statusIcon.title = 'å‘é€å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                statusIcon.style.cursor = 'pointer';
                break;
        }
    }
}
```

### 4.2 åœ¨çº¿ç”¨æˆ·æ•°æ˜¾ç¤º


**ğŸ”¸ ä»€ä¹ˆæ˜¯åœ¨çº¿ç”¨æˆ·æ•°ï¼Ÿ**
å°±æ˜¯åœ¨èŠå¤©å®¤é¡¶éƒ¨æ˜¾ç¤º**å½“å‰æœ‰å¤šå°‘äººåœ¨çº¿**ï¼Œè®©ç”¨æˆ·çŸ¥é“èŠå¤©å®¤çš„æ´»è·ƒç¨‹åº¦ã€‚

```javascript
class OnlineCounter {
    constructor() {
        this.countElement = document.getElementById('userCount');
        this.count = 0;
    }
    
    updateCount(newCount) {
        this.count = newCount;
        this.countElement.textContent = newCount;
        
        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        this.countElement.style.transform = 'scale(1.2)';
        setTimeout(() => {
            this.countElement.style.transform = 'scale(1)';
        }, 200);
    }
    
    // å½“æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯æ—¶è°ƒç”¨
    handleServerMessage(data) {
        if (data.type === 'userCount') {
            this.updateCount(data.count);
        } else if (data.type === 'userJoin') {
            this.updateCount(this.count + 1);
            this.showNotification(`${data.nickname} åŠ å…¥äº†èŠå¤©å®¤`);
        } else if (data.type === 'userLeave') {
            this.updateCount(this.count - 1);
            this.showNotification(`${data.nickname} ç¦»å¼€äº†èŠå¤©å®¤`);
        }
    }
}
```

### 4.3 é”™è¯¯æç¤ºå’Œé‡è¿æœºåˆ¶


**ğŸ”¸ ä»€ä¹ˆæ˜¯é”™è¯¯æç¤ºï¼Ÿ**
å½“ç½‘ç»œæ–­å¼€æˆ–å‘é€å¤±è´¥æ—¶ï¼Œè¦**å‹å¥½åœ°å‘Šè¯‰ç”¨æˆ·å‡ºä»€ä¹ˆé—®é¢˜äº†**ï¼Œå¹¶æä¾›è§£å†³æ–¹æ³•ã€‚

```javascript
class ConnectionManager {
    constructor() {
        this.reconnectAttempts = 0;
        this.maxReconnectAttempts = 5;
        this.isReconnecting = false;
    }
    
    showConnectionStatus(status, message) {
        const statusBar = document.getElementById('connectionStatus');
        statusBar.className = `connection-status ${status}`;
        
        switch (status) {
            case 'connected':
                statusBar.innerHTML = 'ğŸŸ¢ å·²è¿æ¥';
                statusBar.style.display = 'none'; // è¿æ¥æ­£å¸¸æ—¶éšè—
                break;
            case 'connecting':
                statusBar.innerHTML = 'ğŸŸ¡ è¿æ¥ä¸­...';
                statusBar.style.display = 'block';
                break;
            case 'disconnected':
                statusBar.innerHTML = 'ğŸ”´ è¿æ¥æ–­å¼€ï¼Œæ­£åœ¨é‡è¿...';
                statusBar.style.display = 'block';
                this.attemptReconnect();
                break;
            case 'failed':
                statusBar.innerHTML = 'âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
                statusBar.style.display = 'block';
                break;
        }
    }
    
    attemptReconnect() {
        if (this.isReconnecting) return;
        
        this.isReconnecting = true;
        const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);
        
        setTimeout(() => {
            if (this.reconnectAttempts < this.maxReconnectAttempts) {
                this.reconnectAttempts++;
                connectWebSocket(); // é‡æ–°è¿æ¥
            } else {
                this.showConnectionStatus('failed');
            }
            this.isReconnecting = false;
        }, delay);
    }
}
```

---

## 5. ğŸš€ å‰ç«¯æ¡†æ¶é›†æˆå®ç°


### 5.1 Vue.jsé›†æˆç¤ºä¾‹


**ğŸ”¸ ä¸ºä»€ä¹ˆç”¨Vueï¼Ÿ**
Vueå¯ä»¥è®©æˆ‘ä»¬æ›´**ç®€å•åœ°ç®¡ç†èŠå¤©ç•Œé¢çš„æ•°æ®**ï¼Œæ¯”å¦‚æ¶ˆæ¯åˆ—è¡¨ã€ç”¨æˆ·ä¿¡æ¯ç­‰ï¼Œæ•°æ®å˜äº†ç•Œé¢è‡ªåŠ¨æ›´æ–°ã€‚

```vue
<template>
  <div class="chat-container">
    <!-- å¤´éƒ¨ -->
    <div class="chat-header">
      <h2>ğŸ’¬ èŠå¤©å®¤</h2>
      <span class="online-count">åœ¨çº¿ï¼š{{ onlineCount }}äºº</span>
    </div>
    
    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <div class="chat-messages" ref="messagesContainer">
      <div 
        v-for="message in messages" 
        :key="message.id"
        :class="getMessageClass(message)"
        class="message"
      >
        <div v-if="message.type !== 'system'" class="message-header">
          {{ message.isOwn ? 'æˆ‘' : message.nickname }}
        </div>
        <div class="message-content">{{ message.content }}</div>
        <div class="message-time">{{ formatTime(message.timestamp) }}</div>
      </div>
    </div>
    
    <!-- è¾“å…¥åŒºåŸŸ -->
    <div class="chat-input">
      <input 
        v-model="inputMessage"
        @keydown.enter="sendMessage"
        placeholder="è¾“å…¥æ¶ˆæ¯..."
        maxlength="500"
      >
      <button @click="sendMessage" :disabled="!inputMessage.trim()">
        å‘é€
      </button>
    </div>
  </div>
</template>

<script>
export default {
  name: 'ChatRoom',
  data() {
    return {
      messages: [],           // æ¶ˆæ¯åˆ—è¡¨
      inputMessage: '',       // è¾“å…¥çš„æ¶ˆæ¯
      onlineCount: 0,         // åœ¨çº¿äººæ•°
      websocket: null,        // WebSocketè¿æ¥
      currentUser: {          // å½“å‰ç”¨æˆ·ä¿¡æ¯
        id: null,
        nickname: ''
      }
    }
  },
  
  mounted() {
    this.initWebSocket();
  },
  
  methods: {
    // åˆå§‹åŒ–WebSocketè¿æ¥
    initWebSocket() {
      this.websocket = new WebSocket('ws://localhost:8080');
      
      this.websocket.onopen = () => {
        console.log('WebSocketè¿æ¥æˆåŠŸ');
      };
      
      this.websocket.onmessage = (event) => {
        const data = JSON.parse(event.data);
        this.handleMessage(data);
      };
      
      this.websocket.onclose = () => {
        console.log('WebSocketè¿æ¥å…³é—­');
      };
    },
    
    // å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯
    handleMessage(data) {
      switch (data.type) {
        case 'message':
          this.addMessage(data);
          break;
        case 'userCount':
          this.onlineCount = data.count;
          break;
        case 'system':
          this.addSystemMessage(data.content);
          break;
      }
    },
    
    // æ·»åŠ æ¶ˆæ¯
    addMessage(data) {
      const message = {
        id: Date.now() + Math.random(),
        ...data,
        isOwn: data.userId === this.currentUser.id
      };
      
      this.messages.push(message);
      
      // Vueçš„nextTickç¡®ä¿DOMæ›´æ–°åå†æ»šåŠ¨
      this.$nextTick(() => {
        this.scrollToBottom();
      });
    },
    
    // å‘é€æ¶ˆæ¯
    sendMessage() {
      const content = this.inputMessage.trim();
      if (!content) return;
      
      const message = {
        type: 'message',
        content: content
      };
      
      this.websocket.send(JSON.stringify(message));
      this.inputMessage = ''; // æ¸…ç©ºè¾“å…¥æ¡†
    },
    
    // è·å–æ¶ˆæ¯æ ·å¼ç±»
    getMessageClass(message) {
      if (message.type === 'system') return 'system';
      return message.isOwn ? 'own' : 'other';
    },
    
    // æ»šåŠ¨åˆ°åº•éƒ¨
    scrollToBottom() {
      const container = this.$refs.messagesContainer;
      container.scrollTop = container.scrollHeight;
    },
    
    // æ ¼å¼åŒ–æ—¶é—´
    formatTime(timestamp) {
      return new Date(timestamp).toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit'
      });
    }
  }
}
</script>
```

### 5.2 React Hooksé›†æˆç¤ºä¾‹


**ğŸ”¸ Reactå®ç°æ€è·¯**
ç”¨React Hooksæ¥ç®¡ç†èŠå¤©å®¤çš„çŠ¶æ€ï¼Œ`useState`ç®¡ç†æ•°æ®ï¼Œ`useEffect`å¤„ç†WebSocketè¿æ¥ã€‚

```jsx
import React, { useState, useEffect, useRef } from 'react';

function ChatRoom() {
  // çŠ¶æ€ç®¡ç†
  const [messages, setMessages] = useState([]);
  const [inputMessage, setInputMessage] = useState('');
  const [onlineCount, setOnlineCount] = useState(0);
  const [isConnected, setIsConnected] = useState(false);
  
  // å¼•ç”¨
  const websocketRef = useRef(null);
  const messagesEndRef = useRef(null);
  
  // åˆå§‹åŒ–WebSocket
  useEffect(() => {
    const ws = new WebSocket('ws://localhost:8080');
    websocketRef.current = ws;
    
    ws.onopen = () => {
      setIsConnected(true);
      console.log('è¿æ¥æˆåŠŸ');
    };
    
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      handleMessage(data);
    };
    
    ws.onclose = () => {
      setIsConnected(false);
      console.log('è¿æ¥å…³é—­');
    };
    
    // æ¸…ç†å‡½æ•°
    return () => {
      ws.close();
    };
  }, []);
  
  // å¤„ç†æ¶ˆæ¯
  const handleMessage = (data) => {
    switch (data.type) {
      case 'message':
        setMessages(prev => [...prev, {
          ...data,
          id: Date.now() + Math.random(),
          isOwn: data.userId === currentUserId
        }]);
        break;
      case 'userCount':
        setOnlineCount(data.count);
        break;
    }
  };
  
  // å‘é€æ¶ˆæ¯
  const sendMessage = () => {
    if (!inputMessage.trim() || !isConnected) return;
    
    websocketRef.current.send(JSON.stringify({
      type: 'message',
      content: inputMessage
    }));
    
    setInputMessage('');
  };
  
  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);
  
  return (
    <div className="chat-container">
      <div className="chat-header">
        <h2>ğŸ’¬ èŠå¤©å®¤</h2>
        <span>åœ¨çº¿ï¼š{onlineCount}äºº</span>
      </div>
      
      <div className="chat-messages">
        {messages.map((message) => (
          <div 
            key={message.id}
            className={`message ${message.isOwn ? 'own' : 'other'}`}
          >
            <div className="message-content">{message.content}</div>
            <div className="message-time">
              {new Date(message.timestamp).toLocaleTimeString()}
            </div>
          </div>
        ))}
        <div ref={messagesEndRef} />
      </div>
      
      <div className="chat-input">
        <input
          value={inputMessage}
          onChange={(e) => setInputMessage(e.target.value)}
          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
          placeholder="è¾“å…¥æ¶ˆæ¯..."
        />
        <button onClick={sendMessage} disabled={!inputMessage.trim()}>
          å‘é€
        </button>
      </div>
    </div>
  );
}

export default ChatRoom;
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¸ƒå±€è®¾è®¡ï¼šå¤´éƒ¨ä¿¡æ¯æ  + æ¶ˆæ¯æ˜¾ç¤ºåŒº + è¾“å…¥åŒºåŸŸçš„ç»å…¸ä¸‰æ®µå¼å¸ƒå±€
ğŸ”¸ æ¶ˆæ¯æ ·å¼ï¼šè‡ªå·±çš„æ¶ˆæ¯ã€åˆ«äººçš„æ¶ˆæ¯ã€ç³»ç»Ÿæ¶ˆæ¯çš„ä¸åŒå±•ç¤ºæ–¹å¼
ğŸ”¸ åŠ¨æ€æ›´æ–°ï¼šJavaScriptåŠ¨æ€æ·»åŠ æ¶ˆæ¯åˆ°ç•Œé¢ï¼Œå®æ—¶æ›´æ–°èŠå¤©å†…å®¹
ğŸ”¸ è‡ªåŠ¨æ»šåŠ¨ï¼šæ–°æ¶ˆæ¯æ¥æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
ğŸ”¸ è¾“å…¥ä¼˜åŒ–ï¼šé˜²æŠ–å¤„ç†ã€çŠ¶æ€æç¤ºã€é”™è¯¯å¤„ç†ç­‰ç”¨æˆ·äº¤äº’ä¼˜åŒ–
ğŸ”¸ æ¡†æ¶é›†æˆï¼šVue/Reactç­‰å‰ç«¯æ¡†æ¶çš„é›†æˆä½¿ç”¨æ–¹æ³•
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç•Œé¢å¸ƒå±€çš„æ ¸å¿ƒæ€è·¯**
```
è®¾è®¡åŸåˆ™ï¼š
- æ¶ˆæ¯åŒºåŸŸå ä¸»è¦ç©ºé—´ï¼ˆflex: 1ï¼‰
- è¾“å…¥æ¡†å›ºå®šåœ¨åº•éƒ¨ï¼Œä¸éšæ»šåŠ¨æ¶ˆå¤±
- å“åº”å¼è®¾è®¡é€‚é…ä¸åŒè®¾å¤‡
- æ¸…æ™°çš„è§†è§‰å±‚æ¬¡å’Œä¿¡æ¯åˆ†ç»„
```

**ğŸ”¹ æ¶ˆæ¯æ ·å¼è®¾è®¡çš„è¦ç‚¹**
```
æ ·å¼åŒºåˆ†ï¼š
- è‡ªå·±çš„æ¶ˆæ¯ï¼šå³å¯¹é½ + è“è‰²èƒŒæ™¯
- åˆ«äººçš„æ¶ˆæ¯ï¼šå·¦å¯¹é½ + ç°è‰²èƒŒæ™¯  
- ç³»ç»Ÿæ¶ˆæ¯ï¼šå±…ä¸­ + ç‰¹æ®Šé¢œè‰²
- æ—¶é—´æˆ³ï¼šç»Ÿä¸€çš„å°å­—ä½“æ˜¾ç¤º
```

**ğŸ”¹ ç”¨æˆ·ä½“éªŒä¼˜åŒ–ç»†èŠ‚**
```
ä½“éªŒæå‡ï¼š
- æ¶ˆæ¯å‘é€çŠ¶æ€æç¤ºï¼ˆå‘é€ä¸­/æˆåŠŸ/å¤±è´¥ï¼‰
- æ™ºèƒ½æ»šåŠ¨ï¼ˆæ¥è¿‘åº•éƒ¨æ—¶æ‰è‡ªåŠ¨æ»šåŠ¨ï¼‰
- è¾“å…¥é˜²æŠ–ï¼ˆé˜²æ­¢é‡å¤æ“ä½œï¼‰
- è¿æ¥çŠ¶æ€æ˜¾ç¤ºå’Œé‡è¿æœºåˆ¶
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’» çº¯JavaScriptå®ç°**ï¼š
- é€‚åˆç®€å•é¡¹ç›®å’Œå­¦ä¹ ç†è§£
- ç›´æ¥æ“ä½œDOMï¼Œæ€§èƒ½è¾ƒå¥½
- ä»£ç é‡ç›¸å¯¹è¾ƒå¤šï¼ŒçŠ¶æ€ç®¡ç†å¤æ‚

**ğŸš€ æ¡†æ¶é›†æˆå®ç°**ï¼š
- Vue/Reactç­‰æä¾›å“åº”å¼æ•°æ®ç»‘å®š
- ç»„ä»¶åŒ–å¼€å‘ï¼Œä»£ç æ›´æ¸…æ™°
- çŠ¶æ€ç®¡ç†æ›´ç®€å•ï¼Œæ˜“äºç»´æŠ¤

**ğŸ“± ç§»åŠ¨ç«¯é€‚é…**ï¼š
- å“åº”å¼å¸ƒå±€é€‚é…ä¸åŒå±å¹•
- è§¦æ‘¸å‹å¥½çš„äº¤äº’è®¾è®¡
- è™šæ‹Ÿé”®ç›˜é€‚é…å¤„ç†

**ğŸ”§ æ€§èƒ½ä¼˜åŒ–**ï¼š
- æ¶ˆæ¯åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ¶ˆæ¯å¾ˆå¤šæ—¶ï¼‰
- å›¾ç‰‡æ¶ˆæ¯æ‡’åŠ è½½
- é˜²æŠ–å’ŒèŠ‚æµä¼˜åŒ–ç”¨æˆ·æ“ä½œ

**æ ¸å¿ƒè®°å¿†**ï¼š
- èŠå¤©ç•Œé¢ä¸‰æ®µå¼å¸ƒå±€æ˜¯ç»å…¸è®¾è®¡
- æ¶ˆæ¯æ ·å¼è¦åŒºåˆ†è‡ªå·±å’Œä»–äºº
- è‡ªåŠ¨æ»šåŠ¨å’ŒçŠ¶æ€æç¤ºæå‡ä½“éªŒ
- å‰ç«¯æ¡†æ¶èƒ½ç®€åŒ–çŠ¶æ€ç®¡ç†
- ç§»åŠ¨ç«¯é€‚é…å’Œæ€§èƒ½ä¼˜åŒ–å¾ˆé‡è¦