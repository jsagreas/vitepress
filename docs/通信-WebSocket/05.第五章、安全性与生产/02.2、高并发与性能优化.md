---
title: 2ã€é«˜å¹¶å‘ä¸æ€§èƒ½ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [è¿æ¥æ•°ç®¡ç†ç­–ç•¥](#1-è¿æ¥æ•°ç®¡ç†ç­–ç•¥)
2. [æ¶ˆæ¯é¢‘ç‡æ§åˆ¶](#2-æ¶ˆæ¯é¢‘ç‡æ§åˆ¶)
3. [å†…å­˜æ³„æ¼é¢„é˜²](#3-å†…å­˜æ³„æ¼é¢„é˜²)
4. [è¿æ¥æ± ç®¡ç†](#4-è¿æ¥æ± ç®¡ç†)
5. [æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†](#5-æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†)
6. [è´Ÿè½½å‡è¡¡ä¸æ•°æ®ä¼ è¾“](#6-è´Ÿè½½å‡è¡¡ä¸æ•°æ®ä¼ è¾“)
7. [æ€§èƒ½ç›‘æ§ä¸æ—¥å¿—](#7-æ€§èƒ½ç›‘æ§ä¸æ—¥å¿—)
8. [ä¼˜é›…å…³é—­å¤„ç†](#8-ä¼˜é›…å…³é—­å¤„ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”¢ è¿æ¥æ•°ç®¡ç†ç­–ç•¥


### 1.1 ä»€ä¹ˆæ˜¯è¿æ¥æ•°ç®¡ç†


**ç®€å•ç†è§£**ï¼šå°±åƒé¤å…éœ€è¦æ§åˆ¶å®¢äººæ•°é‡ä¸€æ ·ï¼ŒWebSocketæœåŠ¡å™¨ä¹Ÿéœ€è¦æ§åˆ¶åŒæ—¶è¿æ¥çš„ç”¨æˆ·æ•°é‡ï¼Œé˜²æ­¢æœåŠ¡å™¨"æ’‘çˆ†"ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦ç®¡ç†è¿æ¥æ•°**ï¼š
- ğŸ”¸ **å†…å­˜é™åˆ¶**ï¼šæ¯ä¸ªè¿æ¥éƒ½è¦å ç”¨å†…å­˜ï¼Œè¿æ¥å¤ªå¤šæœåŠ¡å™¨å°±å¡äº†
- ğŸ”¸ **æ€§èƒ½ä¿éšœ**ï¼šè¿æ¥æ•°åˆç†ï¼Œæ¯ä¸ªç”¨æˆ·ä½“éªŒæ‰å¥½
- ğŸ”¸ **èµ„æºå…¬å¹³**ï¼šé¿å…è¢«æ¶æ„ç”¨æˆ·è€—å°½æœåŠ¡å™¨èµ„æº

### 1.2 è¿æ¥æ•°é™åˆ¶çš„å®ç°


**åŸºç¡€è¿æ¥æ•°æ§åˆ¶**ï¼š
```javascript
class WebSocketManager {
    constructor() {
        this.connections = new Map(); // å­˜æ”¾æ‰€æœ‰è¿æ¥
        this.maxConnections = 1000;   // æœ€å¤§å…è®¸1000ä¸ªè¿æ¥
    }
    
    // æ–°ç”¨æˆ·è¿æ¥æ—¶çš„æ£€æŸ¥
    handleConnection(ws, userId) {
        // è¶…è¿‡é™åˆ¶å°±æ‹’ç»
        if (this.connections.size >= this.maxConnections) {
            ws.close(1000, 'æœåŠ¡å™¨è¿æ¥å·²æ»¡ï¼Œè¯·ç¨åé‡è¯•');
            return;
        }
        
        // å­˜å‚¨è¿æ¥ä¿¡æ¯
        this.connections.set(userId, {
            socket: ws,
            connectTime: Date.now()
        });
    }
}
```

### 1.3 ä¸åŒç±»å‹çš„è¿æ¥é™åˆ¶


**æŒ‰ç”¨æˆ·ç±»å‹é™åˆ¶**ï¼š
```javascript
// VIPç”¨æˆ·å’Œæ™®é€šç”¨æˆ·åˆ†åˆ«é™åˆ¶
const limits = {
    vip: 100,      // VIPç”¨æˆ·æœ€å¤š100ä¸ªè¿æ¥
    normal: 50,    // æ™®é€šç”¨æˆ·æœ€å¤š50ä¸ªè¿æ¥
    guest: 10      // æ¸¸å®¢æœ€å¤š10ä¸ªè¿æ¥
};

function checkUserLimit(userType) {
    const currentCount = getCurrentConnections(userType);
    return currentCount < limits[userType];
}
```

### 1.4 è¿æ¥æ•°ç›‘æ§é¢æ¿


```
å®æ—¶è¿æ¥çŠ¶æ€ç›‘æ§ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      WebSocketè¿æ¥ç›‘æ§          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰è¿æ¥æ•°ï¼š856 / 1000         â”‚
â”‚ VIPè¿æ¥ï¼š89 / 100              â”‚
â”‚ æ™®é€šè¿æ¥ï¼š712 / 800            â”‚
â”‚ æ¸¸å®¢è¿æ¥ï¼š55 / 100             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€ï¼šğŸŸ¢ æ­£å¸¸                   â”‚
â”‚ å†…å­˜ä½¿ç”¨ï¼š67%                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš¡ æ¶ˆæ¯é¢‘ç‡æ§åˆ¶


### 2.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯é¢‘ç‡æ§åˆ¶


**é€šä¿—è§£é‡Š**ï¼šå°±åƒé™åˆ¶ä¸€ä¸ªäººè¯´è¯çš„é€Ÿåº¦ï¼Œé˜²æ­¢æœ‰äººç–¯ç‹‚å‘æ¶ˆæ¯æŠŠæœåŠ¡å™¨"åˆ·çˆ†"ã€‚

**å¸¸è§çš„æ¶ˆæ¯è½°ç‚¸é—®é¢˜**ï¼š
- ğŸ”¸ **æ¶æ„åˆ·å±**ï¼šæœ‰äººæ•…æ„å¿«é€Ÿå‘é€å¤§é‡æ¶ˆæ¯
- ğŸ”¸ **ç¨‹åºBug**ï¼šå®¢æˆ·ç«¯ä»£ç å‡ºé”™ï¼Œæ— é™å¾ªç¯å‘æ¶ˆæ¯  
- ğŸ”¸ **ç½‘ç»œé‡å¤**ï¼šç½‘ç»œé—®é¢˜å¯¼è‡´æ¶ˆæ¯é‡å¤å‘é€

### 2.2 ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°


**ä»¤ç‰Œæ¡¶åŸç†**ï¼šæƒ³è±¡ä¸€ä¸ªæ¡¶ï¼Œæ¯ç§’é’Ÿå¾€é‡Œæ”¾å‡ ä¸ªä»¤ç‰Œï¼Œå‘æ¶ˆæ¯éœ€è¦æ¶ˆè€—ä»¤ç‰Œï¼Œæ²¡ä»¤ç‰Œå°±ä¸èƒ½å‘ã€‚

```javascript
class TokenBucket {
    constructor(capacity = 10, refillRate = 2) {
        this.capacity = capacity;      // æ¡¶å®¹é‡ï¼ˆæœ€å¤šå­˜10ä¸ªä»¤ç‰Œï¼‰
        this.tokens = capacity;        // å½“å‰ä»¤ç‰Œæ•°
        this.refillRate = refillRate;  // æ¯ç§’è¡¥å……2ä¸ªä»¤ç‰Œ
        this.lastRefill = Date.now();
    }
    
    // å°è¯•æ¶ˆè´¹ä¸€ä¸ªä»¤ç‰Œ
    consume() {
        this.refill(); // å…ˆè¡¥å……ä»¤ç‰Œ
        
        if (this.tokens > 0) {
            this.tokens--;
            return true;  // å¯ä»¥å‘æ¶ˆæ¯
        }
        return false;     // ä»¤ç‰Œä¸è¶³ï¼Œæ‹’ç»
    }
    
    // è¡¥å……ä»¤ç‰Œ
    refill() {
        const now = Date.now();
        const timePassed = (now - this.lastRefill) / 1000;
        const tokensToAdd = Math.floor(timePassed * this.refillRate);
        
        this.tokens = Math.min(this.capacity, this.tokens + tokensToAdd);
        this.lastRefill = now;
    }
}
```

### 2.3 æ¶ˆæ¯é¢‘ç‡é™åˆ¶åº”ç”¨


```javascript
class MessageRateLimit {
    constructor() {
        this.userBuckets = new Map(); // æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªä»¤ç‰Œæ¡¶
    }
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥å‘æ¶ˆæ¯
    canSendMessage(userId) {
        if (!this.userBuckets.has(userId)) {
            // æ–°ç”¨æˆ·åˆ›å»ºä»¤ç‰Œæ¡¶ï¼šæ¯ç§’æœ€å¤š5æ¡æ¶ˆæ¯ï¼Œçªå‘æœ€å¤š10æ¡
            this.userBuckets.set(userId, new TokenBucket(10, 5));
        }
        
        return this.userBuckets.get(userId).consume();
    }
    
    // å¤„ç†æ¶ˆæ¯
    handleMessage(userId, message) {
        if (!this.canSendMessage(userId)) {
            return { success: false, reason: 'å‘é€å¤ªå¿«äº†ï¼Œè¯·æ…¢ä¸€ç‚¹' };
        }
        
        // æ­£å¸¸å¤„ç†æ¶ˆæ¯
        return { success: true, data: message };
    }
}
```

### 2.4 ä¸åŒåœºæ™¯çš„é¢‘ç‡ç­–ç•¥


| åœºæ™¯ç±»å‹ | é¢‘ç‡é™åˆ¶ | è¯´æ˜ |
|---------|----------|------|
| **æ™®é€šèŠå¤©** | `5æ¡/ç§’` | æ­£å¸¸èŠå¤©å¤Ÿç”¨ |
| **æ¸¸æˆæ“ä½œ** | `20æ¡/ç§’` | æ¸¸æˆéœ€è¦é«˜é¢‘äº’åŠ¨ |
| **æ–‡ä»¶ä¼ è¾“** | `100æ¡/ç§’` | æ•°æ®ä¼ è¾“éœ€è¦é«˜é¢‘ |
| **ç³»ç»Ÿé€šçŸ¥** | `1æ¡/ç§’` | é€šçŸ¥ä¸éœ€è¦å¤ªé¢‘ç¹ |

---

## 3. ğŸ§  å†…å­˜æ³„æ¼é¢„é˜²


### 3.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šå°±åƒæˆ¿é—´é‡Œçš„åƒåœ¾è¶Šç§¯è¶Šå¤šï¼Œæœ€åæŠŠæˆ¿é—´å¡æ»¡äº†ã€‚åœ¨ç¨‹åºé‡Œï¼Œå°±æ˜¯ä¸ç”¨çš„æ•°æ®æ²¡æœ‰åŠæ—¶æ¸…ç†ï¼Œå ç€å†…å­˜ä¸é‡Šæ”¾ã€‚

**WebSocketå¸¸è§çš„å†…å­˜æ³„æ¼**ï¼š
- ğŸ”¸ **è¿æ¥å¯¹è±¡æ²¡æ¸…ç†**ï¼šç”¨æˆ·æ–­å¼€äº†ï¼Œä½†æœåŠ¡å™¨è¿˜è®°ç€è¿™ä¸ªè¿æ¥
- ğŸ”¸ **æ¶ˆæ¯ç¼“å­˜å †ç§¯**ï¼šå‘é€å¤±è´¥çš„æ¶ˆæ¯ä¸€ç›´å­˜ç€ä¸åˆ é™¤
- ğŸ”¸ **äº‹ä»¶ç›‘å¬å™¨æ²¡ç§»é™¤**ï¼šç»™è¿æ¥ç»‘å®šçš„äº‹ä»¶æ²¡æœ‰è§£ç»‘

### 3.2 è¿æ¥æ¸…ç†æœºåˆ¶


```javascript
class ConnectionManager {
    constructor() {
        this.connections = new Map();
        this.messageCache = new Map();
        
        // å®šæœŸæ¸…ç†æ— æ•ˆè¿æ¥
        setInterval(() => this.cleanupConnections(), 30000); // 30ç§’æ£€æŸ¥ä¸€æ¬¡
    }
    
    // æ·»åŠ è¿æ¥æ—¶åšå¥½è®°å½•
    addConnection(userId, ws) {
        // å¦‚æœç”¨æˆ·å·²æœ‰è¿æ¥ï¼Œå…ˆæ¸…ç†æ—§çš„
        if (this.connections.has(userId)) {
            this.removeConnection(userId);
        }
        
        const connectionInfo = {
            socket: ws,
            lastActive: Date.now(),
            messageCount: 0
        };
        
        this.connections.set(userId, connectionInfo);
        
        // ç»‘å®šæ–­å¼€äº‹ä»¶ï¼Œè‡ªåŠ¨æ¸…ç†
        ws.on('close', () => this.removeConnection(userId));
    }
    
    // å½»åº•æ¸…ç†è¿æ¥ç›¸å…³çš„æ‰€æœ‰æ•°æ®
    removeConnection(userId) {
        const connection = this.connections.get(userId);
        if (connection) {
            // æ¸…ç†Socketè¿æ¥
            if (connection.socket && connection.socket.readyState === 1) {
                connection.socket.close();
            }
            
            // æ¸…ç†æ¶ˆæ¯ç¼“å­˜
            this.messageCache.delete(userId);
            
            // ä»è¿æ¥åˆ—è¡¨ç§»é™¤
            this.connections.delete(userId);
            
            console.log(`ç”¨æˆ· ${userId} è¿æ¥å·²å®Œå…¨æ¸…ç†`);
        }
    }
    
    // å®šæœŸæ¸…ç†åƒµå°¸è¿æ¥
    cleanupConnections() {
        const now = Date.now();
        const timeout = 5 * 60 * 1000; // 5åˆ†é’Ÿæ— æ´»åŠ¨å°±ç®—åƒµå°¸è¿æ¥
        
        for (let [userId, connection] of this.connections) {
            if (now - connection.lastActive > timeout) {
                console.log(`æ¸…ç†åƒµå°¸è¿æ¥: ${userId}`);
                this.removeConnection(userId);
            }
        }
    }
}
```

### 3.3 æ¶ˆæ¯ç¼“å­˜ç®¡ç†


```javascript
class MessageCache {
    constructor() {
        this.cache = new Map();
        this.maxCacheSize = 1000; // æ¯ä¸ªç”¨æˆ·æœ€å¤šç¼“å­˜1000æ¡æ¶ˆæ¯
        
        // å®šæœŸæ¸…ç†è¿‡æœŸæ¶ˆæ¯
        setInterval(() => this.cleanExpiredMessages(), 60000);
    }
    
    // æ·»åŠ æ¶ˆæ¯åˆ°ç¼“å­˜
    addMessage(userId, message) {
        if (!this.cache.has(userId)) {
            this.cache.set(userId, []);
        }
        
        const userCache = this.cache.get(userId);
        
        // å¦‚æœç¼“å­˜å¤ªå¤šï¼Œåˆ é™¤æœ€è€çš„
        if (userCache.length >= this.maxCacheSize) {
            userCache.shift(); // åˆ é™¤ç¬¬ä¸€ä¸ªï¼ˆæœ€è€çš„ï¼‰
        }
        
        userCache.push({
            ...message,
            timestamp: Date.now()
        });
    }
    
    // æ¸…ç†è¿‡æœŸæ¶ˆæ¯
    cleanExpiredMessages() {
        const oneHour = 60 * 60 * 1000;
        const now = Date.now();
        
        for (let [userId, messages] of this.cache) {
            // è¿‡æ»¤æ‰1å°æ—¶å‰çš„æ¶ˆæ¯
            const validMessages = messages.filter(msg => 
                now - msg.timestamp < oneHour
            );
            
            if (validMessages.length === 0) {
                this.cache.delete(userId); // æ²¡æœ‰æœ‰æ•ˆæ¶ˆæ¯å°±åˆ é™¤æ•´ä¸ªç”¨æˆ·ç¼“å­˜
            } else {
                this.cache.set(userId, validMessages);
            }
        }
    }
}
```

---

## 4. ğŸŠ è¿æ¥æ± ç®¡ç†


### 4.1 ä»€ä¹ˆæ˜¯è¿æ¥æ± 


**ç®€å•æ¯”å–»**ï¼šå°±åƒå…±äº«å•è½¦ï¼Œä¸æ˜¯æ¯ä¸ªäººéƒ½ä¹°ä¸€è¾†è‡ªè¡Œè½¦ï¼Œè€Œæ˜¯å¤§å®¶å…±ç”¨ä¸€å †å•è½¦ï¼Œç”¨å®Œè¿˜å›å»ï¼Œåˆ«äººç»§ç»­ç”¨ã€‚

**è¿æ¥æ± çš„å¥½å¤„**ï¼š
- ğŸ”¸ **èŠ‚çœèµ„æº**ï¼šä¸ç”¨é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥
- ğŸ”¸ **æé«˜æ€§èƒ½**ï¼šå¤ç”¨è¿æ¥ï¼Œå“åº”æ›´å¿«
- ğŸ”¸ **æ§åˆ¶æ•°é‡**ï¼šç»Ÿä¸€ç®¡ç†ï¼Œä¸ä¼šè¿æ¥å¤ªå¤š

### 4.2 WebSocketè¿æ¥æ± å®ç°


```javascript
class WebSocketPool {
    constructor(maxSize = 50) {
        this.maxSize = maxSize;           // æ± å­æœ€å¤§å®¹é‡
        this.availableConnections = [];   // å¯ç”¨çš„è¿æ¥
        this.busyConnections = new Set(); // æ­£åœ¨ä½¿ç”¨çš„è¿æ¥
        this.createConnection = null;     // åˆ›å»ºè¿æ¥çš„å‡½æ•°
    }
    
    // è®¾ç½®å¦‚ä½•åˆ›å»ºæ–°è¿æ¥
    setCreateFunction(createFn) {
        this.createConnection = createFn;
    }
    
    // è·å–ä¸€ä¸ªè¿æ¥
    async getConnection() {
        // å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰å¯ç”¨çš„
        if (this.availableConnections.length > 0) {
            const connection = this.availableConnections.pop();
            this.busyConnections.add(connection);
            return connection;
        }
        
        // æ²¡æœ‰å¯ç”¨çš„ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥åˆ›å»ºæ–°çš„
        if (this.getTotalConnections() < this.maxSize) {
            const newConnection = await this.createConnection();
            this.busyConnections.add(newConnection);
            return newConnection;
        }
        
        // è¿æ¥æ± æ»¡äº†ï¼Œç­‰å¾…æœ‰è¿æ¥é‡Šæ”¾
        return this.waitForConnection();
    }
    
    // é‡Šæ”¾è¿æ¥å›æ± å­
    releaseConnection(connection) {
        if (this.busyConnections.has(connection)) {
            this.busyConnections.delete(connection);
            
            // æ£€æŸ¥è¿æ¥æ˜¯å¦è¿˜å¥åº·
            if (this.isConnectionHealthy(connection)) {
                this.availableConnections.push(connection);
            } else {
                // è¿æ¥åäº†ï¼Œå…³é—­å®ƒ
                connection.close();
            }
        }
    }
    
    // æ£€æŸ¥è¿æ¥å¥åº·çŠ¶æ€
    isConnectionHealthy(connection) {
        return connection.readyState === WebSocket.OPEN;
    }
    
    // è·å–æ± å­çŠ¶æ€
    getStatus() {
        return {
            available: this.availableConnections.length,
            busy: this.busyConnections.size,
            total: this.getTotalConnections()
        };
    }
    
    getTotalConnections() {
        return this.availableConnections.length + this.busyConnections.size;
    }
}
```

### 4.3 è¿æ¥æ± ä½¿ç”¨ç¤ºä¾‹


```javascript
// åˆ›å»ºè¿æ¥æ± 
const wsPool = new WebSocketPool(20);

// è®¾ç½®å¦‚ä½•åˆ›å»ºè¿æ¥
wsPool.setCreateFunction(async () => {
    const ws = new WebSocket('ws://localhost:8080');
    await new Promise((resolve) => {
        ws.onopen = resolve;
    });
    return ws;
});

// ä½¿ç”¨è¿æ¥
async function sendMessage(message) {
    const connection = await wsPool.getConnection();
    
    try {
        connection.send(JSON.stringify(message));
        // å¤„ç†å“åº”...
    } finally {
        // ä½¿ç”¨å®Œåä¸€å®šè¦é‡Šæ”¾
        wsPool.releaseConnection(connection);
    }
}
```

---

## 5. ğŸ“® æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—


**ç”Ÿæ´»ä¾‹å­**ï¼šå°±åƒå¿«é€’ç«™çš„åŒ…è£¹ï¼Œä¸æ˜¯æ¥ä¸€ä¸ªé©¬ä¸Šé€ä¸€ä¸ªï¼Œè€Œæ˜¯å…ˆå †åœ¨ä»“åº“é‡Œï¼Œç„¶åæŒ‰é¡ºåºã€æŒ‰è·¯çº¿ç»Ÿä¸€é…é€ã€‚

**æ¶ˆæ¯é˜Ÿåˆ—è§£å†³çš„é—®é¢˜**ï¼š
- ğŸ”¸ **æµé‡å‰Šå³°**ï¼šé«˜å³°æœŸæ¶ˆæ¯å¤ªå¤šï¼Œæ’é˜Ÿæ…¢æ…¢å¤„ç†
- ğŸ”¸ **ä¿è¯é¡ºåº**ï¼šé‡è¦æ¶ˆæ¯æŒ‰é¡ºåºé€è¾¾
- ğŸ”¸ **å¤±è´¥é‡è¯•**ï¼šå‘é€å¤±è´¥çš„æ¶ˆæ¯å¯ä»¥é‡æ–°å‘

### 5.2 ç®€å•æ¶ˆæ¯é˜Ÿåˆ—å®ç°


```javascript
class MessageQueue {
    constructor() {
        this.queues = new Map(); // æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªé˜Ÿåˆ—
        this.processing = new Set(); // æ­£åœ¨å¤„ç†çš„ç”¨æˆ·
        this.maxQueueSize = 100; // æ¯ä¸ªé˜Ÿåˆ—æœ€å¤š100æ¡æ¶ˆæ¯
    }
    
    // æ·»åŠ æ¶ˆæ¯åˆ°é˜Ÿåˆ—
    addMessage(userId, message) {
        if (!this.queues.has(userId)) {
            this.queues.set(userId, []);
        }
        
        const userQueue = this.queues.get(userId);
        
        // é˜Ÿåˆ—å¤ªé•¿å°±ä¸¢å¼ƒæœ€è€çš„æ¶ˆæ¯
        if (userQueue.length >= this.maxQueueSize) {
            userQueue.shift();
            console.log(`ç”¨æˆ· ${userId} æ¶ˆæ¯é˜Ÿåˆ—å·²æ»¡ï¼Œä¸¢å¼ƒæœ€è€æ¶ˆæ¯`);
        }
        
        userQueue.push({
            ...message,
            timestamp: Date.now(),
            retryCount: 0
        });
        
        // å¼€å§‹å¤„ç†è¿™ä¸ªç”¨æˆ·çš„é˜Ÿåˆ—
        this.processQueue(userId);
    }
    
    // å¤„ç†ç”¨æˆ·é˜Ÿåˆ—
    async processQueue(userId) {
        // å¦‚æœæ­£åœ¨å¤„ç†ï¼Œå°±ä¸é‡å¤å¤„ç†
        if (this.processing.has(userId)) {
            return;
        }
        
        this.processing.add(userId);
        
        try {
            const userQueue = this.queues.get(userId);
            
            while (userQueue && userQueue.length > 0) {
                const message = userQueue[0]; // å–ç¬¬ä¸€æ¡æ¶ˆæ¯
                
                try {
                    await this.sendMessage(userId, message);
                    userQueue.shift(); // å‘é€æˆåŠŸï¼Œç§»é™¤æ¶ˆæ¯
                } catch (error) {
                    // å‘é€å¤±è´¥ï¼Œé‡è¯•æœºåˆ¶
                    message.retryCount++;
                    
                    if (message.retryCount >= 3) {
                        console.log('æ¶ˆæ¯é‡è¯•3æ¬¡ä»å¤±è´¥ï¼Œä¸¢å¼ƒ:', message);
                        userQueue.shift(); // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œä¸¢å¼ƒ
                    } else {
                        console.log(`æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œç¨åé‡è¯• (${message.retryCount}/3)`);
                        break; // åœæ­¢å¤„ç†ï¼Œç­‰ä¸‹æ¬¡é‡è¯•
                    }
                }
            }
        } finally {
            this.processing.delete(userId);
        }
    }
    
    // å®é™…å‘é€æ¶ˆæ¯çš„å‡½æ•°
    async sendMessage(userId, message) {
        const connection = connectionManager.getConnection(userId);
        
        if (!connection || connection.readyState !== WebSocket.OPEN) {
            throw new Error('è¿æ¥ä¸å¯ç”¨');
        }
        
        connection.send(JSON.stringify(message));
    }
}
```

### 5.3 ä¼˜å…ˆçº§æ¶ˆæ¯é˜Ÿåˆ—


```javascript
class PriorityMessageQueue {
    constructor() {
        this.highPriority = [];   // é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—
        this.normalPriority = []; // æ™®é€šä¼˜å…ˆçº§é˜Ÿåˆ—
        this.lowPriority = [];    // ä½ä¼˜å…ˆçº§é˜Ÿåˆ—
    }
    
    addMessage(message, priority = 'normal') {
        const messageWithTimestamp = {
            ...message,
            timestamp: Date.now()
        };
        
        switch (priority) {
            case 'high':
                this.highPriority.push(messageWithTimestamp);
                break;
            case 'low':
                this.lowPriority.push(messageWithTimestamp);
                break;
            default:
                this.normalPriority.push(messageWithTimestamp);
        }
        
        this.processMessages();
    }
    
    // æŒ‰ä¼˜å…ˆçº§å¤„ç†æ¶ˆæ¯
    processMessages() {
        // å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§
        if (this.highPriority.length > 0) {
            return this.processQueue(this.highPriority);
        }
        
        // å†å¤„ç†æ™®é€šä¼˜å…ˆçº§
        if (this.normalPriority.length > 0) {
            return this.processQueue(this.normalPriority);
        }
        
        // æœ€åå¤„ç†ä½ä¼˜å…ˆçº§
        if (this.lowPriority.length > 0) {
            return this.processQueue(this.lowPriority);
        }
    }
}
```

---

## 6. âš–ï¸ è´Ÿè½½å‡è¡¡ä¸æ•°æ®ä¼ è¾“


### 6.1 è´Ÿè½½å‡è¡¡æ˜¯ä»€ä¹ˆ


**ç®€å•ç†è§£**ï¼šå°±åƒé“¶è¡Œæœ‰å¤šä¸ªçª—å£ï¼Œé¡¾å®¢ä¸æ˜¯éƒ½æŒ¤åˆ°ä¸€ä¸ªçª—å£ï¼Œè€Œæ˜¯åˆ†æ•£åˆ°å„ä¸ªçª—å£ï¼Œè¿™æ ·å¤§å®¶éƒ½ä¸ç”¨ç­‰å¤ªä¹…ã€‚

**WebSocketè´Ÿè½½å‡è¡¡çš„æŒ‘æˆ˜**ï¼š
- ğŸ”¸ **é•¿è¿æ¥ç‰¹æ€§**ï¼šä¸åƒHTTPè¯·æ±‚å®Œå°±æ–­å¼€ï¼ŒWebSocketè¦ä¿æŒè¿æ¥
- ğŸ”¸ **çŠ¶æ€ä¿æŒ**ï¼šç”¨æˆ·çš„èŠå¤©è®°å½•ã€æ¸¸æˆçŠ¶æ€è¦è®°ä½
- ğŸ”¸ **æ¶ˆæ¯è·¯ç”±**ï¼šè¦çŸ¥é“ç”¨æˆ·è¿åœ¨å“ªå°æœåŠ¡å™¨ä¸Š

### 6.2 è´Ÿè½½å‡è¡¡ç­–ç•¥


```javascript
class WebSocketLoadBalancer {
    constructor() {
        this.servers = [
            { id: 'server1', url: 'ws://192.168.1.10:8080', connections: 0, capacity: 1000 },
            { id: 'server2', url: 'ws://192.168.1.11:8080', connections: 0, capacity: 1000 },
            { id: 'server3', url: 'ws://192.168.1.12:8080', connections: 0, capacity: 1000 }
        ];
        this.userServerMap = new Map(); // è®°å½•ç”¨æˆ·åœ¨å“ªå°æœåŠ¡å™¨
    }
    
    // ä¸ºæ–°ç”¨æˆ·é€‰æ‹©æœåŠ¡å™¨
    selectServer(userId) {
        // å¦‚æœç”¨æˆ·ä¹‹å‰è¿è¿‡ï¼Œå°½é‡ç”¨åŒä¸€å°æœåŠ¡å™¨
        if (this.userServerMap.has(userId)) {
            const serverId = this.userServerMap.get(userId);
            const server = this.servers.find(s => s.id === serverId);
            if (server && server.connections < server.capacity) {
                return server;
            }
        }
        
        // é€‰æ‹©è¿æ¥æ•°æœ€å°‘çš„æœåŠ¡å™¨
        const availableServers = this.servers.filter(s => s.connections < s.capacity);
        if (availableServers.length === 0) {
            throw new Error('æ‰€æœ‰æœåŠ¡å™¨éƒ½æ»¡äº†');
        }
        
        const selectedServer = availableServers.reduce((min, server) => 
            server.connections < min.connections ? server : min
        );
        
        return selectedServer;
    }
    
    // ç”¨æˆ·è¿æ¥åˆ°æœåŠ¡å™¨
    connectUser(userId) {
        const server = this.selectServer(userId);
        server.connections++;
        this.userServerMap.set(userId, server.id);
        
        console.log(`ç”¨æˆ· ${userId} è¿æ¥åˆ° ${server.id}, å½“å‰è¿æ¥æ•°: ${server.connections}`);
        return server;
    }
    
    // ç”¨æˆ·æ–­å¼€è¿æ¥
    disconnectUser(userId) {
        if (this.userServerMap.has(userId)) {
            const serverId = this.userServerMap.get(userId);
            const server = this.servers.find(s => s.id === serverId);
            if (server) {
                server.connections--;
                this.userServerMap.delete(userId);
            }
        }
    }
}
```

### 6.3 å¤§æ•°æ®ä¼ è¾“ä¼˜åŒ–


**åˆ†å—ä¼ è¾“**ï¼š
```javascript
class DataTransmission {
    // å¤§æ–‡ä»¶åˆ†å—å‘é€
    sendLargeData(ws, data, chunkSize = 64 * 1024) { // 64KBä¸€å—
        const chunks = this.splitIntoChunks(data, chunkSize);
        const totalChunks = chunks.length;
        const sessionId = this.generateSessionId();
        
        // å…ˆå‘é€æ–‡ä»¶ä¿¡æ¯
        ws.send(JSON.stringify({
            type: 'file_start',
            sessionId,
            totalChunks,
            totalSize: data.length
        }));
        
        // é€å—å‘é€
        chunks.forEach((chunk, index) => {
            setTimeout(() => {
                ws.send(JSON.stringify({
                    type: 'file_chunk',
                    sessionId,
                    chunkIndex: index,
                    data: chunk,
                    isLastChunk: index === totalChunks - 1
                }));
            }, index * 10); // æ¯10mså‘ä¸€å—ï¼Œé¿å…å‘é€å¤ªå¿«
        });
    }
    
    // æ•°æ®åˆ†å—
    splitIntoChunks(data, chunkSize) {
        const chunks = [];
        for (let i = 0; i < data.length; i += chunkSize) {
            chunks.push(data.slice(i, i + chunkSize));
        }
        return chunks;
    }
    
    generateSessionId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }
}
```

---

## 7. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸æ—¥å¿—


### 7.1 å…³é”®æ€§èƒ½æŒ‡æ ‡


**éœ€è¦ç›‘æ§çš„é‡è¦æ•°æ®**ï¼š
- ğŸ”¸ **è¿æ¥æ•°ç»Ÿè®¡**ï¼šå½“å‰æœ‰å¤šå°‘ç”¨æˆ·åœ¨çº¿
- ğŸ”¸ **æ¶ˆæ¯ååé‡**ï¼šæ¯ç§’å¤„ç†å¤šå°‘æ¡æ¶ˆæ¯
- ğŸ”¸ **å“åº”æ—¶é—´**ï¼šæ¶ˆæ¯ä»å‘é€åˆ°æ¥æ”¶çš„æ—¶é—´
- ğŸ”¸ **é”™è¯¯ç‡**ï¼šè¿æ¥å¤±è´¥ã€æ¶ˆæ¯å¤±è´¥çš„æ¯”ä¾‹
- ğŸ”¸ **å†…å­˜ä½¿ç”¨**ï¼šæœåŠ¡å™¨å†…å­˜å ç”¨æƒ…å†µ

### 7.2 æ€§èƒ½ç›‘æ§å®ç°


```javascript
class PerformanceMonitor {
    constructor() {
        this.metrics = {
            connections: 0,
            messagesPerSecond: 0,
            averageResponseTime: 0,
            errorRate: 0,
            memoryUsage: 0
        };
        
        this.messageCount = 0;
        this.responseTimes = [];
        this.errors = 0;
        this.totalRequests = 0;
        
        // æ¯ç§’æ›´æ–°ä¸€æ¬¡ç»Ÿè®¡
        setInterval(() => this.updateMetrics(), 1000);
    }
    
    // è®°å½•æ–°è¿æ¥
    recordConnection() {
        this.metrics.connections++;
    }
    
    // è®°å½•è¿æ¥æ–­å¼€
    recordDisconnection() {
        this.metrics.connections--;
    }
    
    // è®°å½•æ¶ˆæ¯
    recordMessage(responseTime) {
        this.messageCount++;
        this.responseTimes.push(responseTime);
        this.totalRequests++;
        
        // åªä¿ç•™æœ€è¿‘100æ¬¡çš„å“åº”æ—¶é—´
        if (this.responseTimes.length > 100) {
            this.responseTimes.shift();
        }
    }
    
    // è®°å½•é”™è¯¯
    recordError() {
        this.errors++;
        this.totalRequests++;
    }
    
    // æ›´æ–°æŒ‡æ ‡
    updateMetrics() {
        // æ¯ç§’æ¶ˆæ¯æ•°
        this.metrics.messagesPerSecond = this.messageCount;
        this.messageCount = 0;
        
        // å¹³å‡å“åº”æ—¶é—´
        if (this.responseTimes.length > 0) {
            const sum = this.responseTimes.reduce((a, b) => a + b, 0);
            this.metrics.averageResponseTime = Math.round(sum / this.responseTimes.length);
        }
        
        // é”™è¯¯ç‡
        if (this.totalRequests > 0) {
            this.metrics.errorRate = (this.errors / this.totalRequests * 100).toFixed(2);
        }
        
        // å†…å­˜ä½¿ç”¨
        const memUsage = process.memoryUsage();
        this.metrics.memoryUsage = Math.round(memUsage.heapUsed / 1024 / 1024); // MB
        
        // è¾“å‡ºç›‘æ§é¢æ¿
        this.displayDashboard();
    }
    
    // æ˜¾ç¤ºç›‘æ§é¢æ¿
    displayDashboard() {
        console.clear();
        console.log('ğŸ“Š WebSocketæ€§èƒ½ç›‘æ§é¢æ¿');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log(`ğŸ”— å½“å‰è¿æ¥æ•°: ${this.metrics.connections}`);
        console.log(`ğŸ“¨ æ¶ˆæ¯/ç§’: ${this.metrics.messagesPerSecond}`);
        console.log(`â±ï¸  å¹³å‡å“åº”æ—¶é—´: ${this.metrics.averageResponseTime}ms`);
        console.log(`âŒ é”™è¯¯ç‡: ${this.metrics.errorRate}%`);
        console.log(`ğŸ§  å†…å­˜ä½¿ç”¨: ${this.metrics.memoryUsage}MB`);
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    }
    
    // è·å–å®Œæ•´æŠ¥å‘Š
    getReport() {
        return {
            timestamp: new Date().toISOString(),
            ...this.metrics,
            health: this.getHealthStatus()
        };
    }
    
    // å¥åº·çŠ¶æ€è¯„ä¼°
    getHealthStatus() {
        if (this.metrics.errorRate > 5) return 'ğŸ”´ å¼‚å¸¸';
        if (this.metrics.averageResponseTime > 1000) return 'ğŸŸ¡ ç¼“æ…¢';
        if (this.metrics.memoryUsage > 500) return 'ğŸŸ¡ å†…å­˜é«˜';
        return 'ğŸŸ¢ å¥åº·';
    }
}
```

### 7.3 æ—¥å¿—è®°å½•ç³»ç»Ÿ


```javascript
class WebSocketLogger {
    constructor() {
        this.logs = [];
        this.maxLogs = 10000; // æœ€å¤šä¿å­˜1ä¸‡æ¡æ—¥å¿—
    }
    
    // è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—
    info(message, data = {}) {
        this.log('INFO', message, data);
    }
    
    warn(message, data = {}) {
        this.log('WARN', message, data);
    }
    
    error(message, data = {}) {
        this.log('ERROR', message, data);
    }
    
    // ç»Ÿä¸€æ—¥å¿—æ ¼å¼
    log(level, message, data) {
        const logEntry = {
            timestamp: new Date().toISOString(),
            level,
            message,
            data,
            memoryUsage: process.memoryUsage().heapUsed
        };
        
        this.logs.push(logEntry);
        
        // æ—¥å¿—å¤ªå¤šæ—¶åˆ é™¤æ—§çš„
        if (this.logs.length > this.maxLogs) {
            this.logs.shift();
        }
        
        // è¾“å‡ºåˆ°æ§åˆ¶å°
        const colors = {
            INFO: '\x1b[36m',  // é’è‰²
            WARN: '\x1b[33m',  // é»„è‰²
            ERROR: '\x1b[31m'  // çº¢è‰²
        };
        
        console.log(
            `${colors[level]}[${level}]${'\x1b[0m'} ${logEntry.timestamp} - ${message}`,
            Object.keys(data).length > 0 ? data : ''
        );
    }
    
    // æœç´¢æ—¥å¿—
    searchLogs(keyword, level = null) {
        return this.logs.filter(log => {
            const matchKeyword = log.message.includes(keyword) || 
                                JSON.stringify(log.data).includes(keyword);
            const matchLevel = !level || log.level === level;
            
            return matchKeyword && matchLevel;
        });
    }
}
```

---

## 8. ğŸ‘‹ ä¼˜é›…å…³é—­å¤„ç†


### 8.1 ä»€ä¹ˆæ˜¯ä¼˜é›…å…³é—­


**ç”Ÿæ´»æ¯”å–»**ï¼šå°±åƒå•†åº—å…³é—¨å‰ä¼šå…ˆé€šçŸ¥é¡¾å®¢ï¼Œè®©ä»–ä»¬ä¹°å®Œä¸œè¥¿å†å…³é—¨ï¼Œè€Œä¸æ˜¯çªç„¶æ‹‰é—¸æ–­ç”µã€‚

**ä¼˜é›…å…³é—­è¦åšçš„äº‹**ï¼š
- ğŸ”¸ **é€šçŸ¥ç”¨æˆ·**ï¼šå‘Šè¯‰æ‰€æœ‰ç”¨æˆ·æœåŠ¡å™¨è¦å…³é—­äº†
- ğŸ”¸ **å¤„ç†å®Œå½“å‰ä»»åŠ¡**ï¼šæŠŠæ­£åœ¨å‘é€çš„æ¶ˆæ¯å‘å®Œ
- ğŸ”¸ **ä¿å­˜é‡è¦æ•°æ®**ï¼šæŠŠéœ€è¦ä¿å­˜çš„æ•°æ®å†™åˆ°æ•°æ®åº“
- ğŸ”¸ **é‡Šæ”¾èµ„æº**ï¼šå…³é—­è¿æ¥ã€æ¸…ç†å†…å­˜

### 8.2 ä¼˜é›…å…³é—­å®ç°


```javascript
class GracefulShutdown {
    constructor(server) {
        this.server = server;
        this.connections = new Set();
        this.isShuttingDown = false;
        this.shutdownTimeout = 30000; // 30ç§’è¶…æ—¶
        
        // ç›‘å¬å…³é—­ä¿¡å·
        process.on('SIGTERM', () => this.shutdown('SIGTERM'));
        process.on('SIGINT', () => this.shutdown('SIGINT'));
    }
    
    // æ·»åŠ è¿æ¥åˆ°ç®¡ç†åˆ—è¡¨
    addConnection(ws) {
        this.connections.add(ws);
        
        ws.on('close', () => {
            this.connections.delete(ws);
        });
    }
    
    // å¼€å§‹ä¼˜é›…å…³é—­
    async shutdown(signal) {
        if (this.isShuttingDown) {
            console.log('å…³é—­å·²åœ¨è¿›è¡Œä¸­...');
            return;
        }
        
        this.isShuttingDown = true;
        console.log(`ğŸ“¢ æ”¶åˆ°${signal}ä¿¡å·ï¼Œå¼€å§‹ä¼˜é›…å…³é—­...`);
        
        try {
            // ç¬¬1æ­¥ï¼šåœæ­¢æ¥å—æ–°è¿æ¥
            this.server.close(() => {
                console.log('âœ… æœåŠ¡å™¨å·²åœæ­¢æ¥å—æ–°è¿æ¥');
            });
            
            // ç¬¬2æ­¥ï¼šé€šçŸ¥æ‰€æœ‰ç”¨æˆ·
            await this.notifyAllUsers();
            
            // ç¬¬3æ­¥ï¼šç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆ
            await this.waitForTasksToComplete();
            
            // ç¬¬4æ­¥ï¼šä¿å­˜é‡è¦æ•°æ®
            await this.saveImportantData();
            
            // ç¬¬5æ­¥ï¼šå…³é—­æ‰€æœ‰è¿æ¥
            await this.closeAllConnections();
            
            console.log('âœ… ä¼˜é›…å…³é—­å®Œæˆ');
            process.exit(0);
            
        } catch (error) {
            console.error('âŒ ä¼˜é›…å…³é—­å¤±è´¥:', error);
            process.exit(1);
        }
    }
    
    // é€šçŸ¥æ‰€æœ‰ç”¨æˆ·æœåŠ¡å™¨å°†å…³é—­
    async notifyAllUsers() {
        const message = JSON.stringify({
            type: 'server_shutdown',
            message: 'æœåŠ¡å™¨å°†åœ¨30ç§’åå…³é—­ï¼Œè¯·ä¿å­˜æ‚¨çš„å·¥ä½œ',
            countdown: 30
        });
        
        const notifications = Array.from(this.connections).map(ws => {
            if (ws.readyState === WebSocket.OPEN) {
                return new Promise(resolve => {
                    ws.send(message, resolve);
                });
            }
        });
        
        await Promise.all(notifications.filter(Boolean));
        console.log(`âœ… å·²é€šçŸ¥ ${notifications.length} ä¸ªç”¨æˆ·`);
    }
    
    // ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆ
    async waitForTasksToComplete() {
        console.log('â³ ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆ...');
        
        // è®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´
        const timeout = setTimeout(() => {
            console.log('âš ï¸ ç­‰å¾…è¶…æ—¶ï¼Œå¼ºåˆ¶ç»§ç»­å…³é—­æµç¨‹');
        }, this.shutdownTimeout);
        
        // è¿™é‡Œå¯ä»¥æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºç­‰
        await new Promise(resolve => setTimeout(resolve, 5000)); // ç®€å•ç­‰å¾…5ç§’
        
        clearTimeout(timeout);
        console.log('âœ… å½“å‰ä»»åŠ¡å¤„ç†å®Œæˆ');
    }
    
    // ä¿å­˜é‡è¦æ•°æ®
    async saveImportantData() {
        console.log('ğŸ’¾ ä¿å­˜é‡è¦æ•°æ®...');
        
        // è¿™é‡Œå¯ä»¥ä¿å­˜ç”¨æˆ·çŠ¶æ€ã€æœªå‘é€æ¶ˆæ¯ç­‰
        // ç¤ºä¾‹ï¼šä¿å­˜è¿æ¥ç»Ÿè®¡
        const stats = {
            shutdownTime: new Date().toISOString(),
            activeConnections: this.connections.size,
            reason: 'graceful_shutdown'
        };
        
        // æ¨¡æ‹Ÿä¿å­˜åˆ°æ•°æ®åº“
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        console.log('âœ… é‡è¦æ•°æ®ä¿å­˜å®Œæˆ');
    }
    
    // å…³é—­æ‰€æœ‰è¿æ¥
    async closeAllConnections() {
        console.log('ğŸ”Œ å…³é—­æ‰€æœ‰è¿æ¥...');
        
        const closePromises = Array.from(this.connections).map(ws => {
            return new Promise(resolve => {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.close(1001, 'æœåŠ¡å™¨å…³é—­');
                }
                resolve();
            });
        });
        
        await Promise.all(closePromises);
        console.log(`âœ… å·²å…³é—­ ${closePromises.length} ä¸ªè¿æ¥`);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const gracefulShutdown = new GracefulShutdown(server);

// æ¯ä¸ªæ–°è¿æ¥éƒ½è¦æ³¨å†Œ
wss.on('connection', (ws) => {
    gracefulShutdown.addConnection(ws);
    // ... å…¶ä»–è¿æ¥å¤„ç†é€»è¾‘
});
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒè¦ç‚¹


**ğŸ”¢ è¿æ¥æ•°ç®¡ç†**
- è®¾ç½®åˆç†çš„æœ€å¤§è¿æ¥æ•°é™åˆ¶
- æŒ‰ç”¨æˆ·ç±»å‹åˆ†åˆ«æ§åˆ¶
- å®šæœŸæ¸…ç†åƒµå°¸è¿æ¥
- ç›‘æ§è¿æ¥çŠ¶æ€

**âš¡ æ¶ˆæ¯é¢‘ç‡æ§åˆ¶**  
- ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•é˜²æ­¢æ¶ˆæ¯è½°ç‚¸
- ä¸åŒåœºæ™¯è®¾ç½®ä¸åŒé¢‘ç‡é™åˆ¶
- è¶…é™æ—¶ç»™å‡ºå‹å¥½æç¤º
- è®°å½•æ¶æ„è¡Œä¸º

**ğŸ§  å†…å­˜æ³„æ¼é¢„é˜²**
- è¿æ¥æ–­å¼€æ—¶å½»åº•æ¸…ç†ç›¸å…³æ•°æ®
- è®¾ç½®æ¶ˆæ¯ç¼“å­˜ä¸Šé™
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
- ç§»é™¤äº‹ä»¶ç›‘å¬å™¨

**ğŸŠ è¿æ¥æ± ç®¡ç†**
- å¤ç”¨è¿æ¥å‡å°‘åˆ›å»ºå¼€é”€
- æ§åˆ¶æ± å­å¤§å°é¿å…èµ„æºæµªè´¹
- æ£€æŸ¥è¿æ¥å¥åº·çŠ¶æ€
- å®ç°è¿æ¥ç­‰å¾…æœºåˆ¶

### 9.2 ç”Ÿäº§ç¯å¢ƒå®è·µ


**ğŸ“® æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†**
- å®ç°æ¶ˆæ¯æ’é˜Ÿæœºåˆ¶
- æ”¯æŒæ¶ˆæ¯é‡è¯•
- æŒ‰ä¼˜å…ˆçº§å¤„ç†æ¶ˆæ¯
- ç›‘æ§é˜Ÿåˆ—é•¿åº¦

**âš–ï¸ è´Ÿè½½å‡è¡¡ç­–ç•¥**
- å¤šæœåŠ¡å™¨åˆ†æ‘Šå‹åŠ›
- æ™ºèƒ½é€‰æ‹©æœ€ä¼˜æœåŠ¡å™¨
- ä¿æŒç”¨æˆ·ä¼šè¯çŠ¶æ€
- å®ç°æ•…éšœè½¬ç§»

**ğŸ“Š ç›‘æ§ä¸æ—¥å¿—**
- å®æ—¶ç›‘æ§å…³é”®æŒ‡æ ‡
- è®°å½•è¯¦ç»†æ“ä½œæ—¥å¿—
- è®¾ç½®å‘Šè­¦é˜ˆå€¼
- æä¾›å¯è§†åŒ–é¢æ¿

**ğŸ‘‹ ä¼˜é›…å…³é—­**
- æå‰é€šçŸ¥ç”¨æˆ·
- å¤„ç†å®Œå½“å‰ä»»åŠ¡
- ä¿å­˜é‡è¦æ•°æ®
- å®‰å…¨å…³é—­è¿æ¥

### 9.3 è®°å¿†è¦ç‚¹


**æ€§èƒ½ä¼˜åŒ–ä¸‰å¤§åŸåˆ™**ï¼š
1. **æ§åˆ¶èµ„æº**ï¼šè¿æ¥æ•°ã€æ¶ˆæ¯é¢‘ç‡ã€å†…å­˜ä½¿ç”¨
2. **æé«˜æ•ˆç‡**ï¼šè¿æ¥æ± ã€æ¶ˆæ¯é˜Ÿåˆ—ã€è´Ÿè½½å‡è¡¡  
3. **ä¿éšœç¨³å®š**ï¼šç›‘æ§å‘Šè­¦ã€ä¼˜é›…å…³é—­ã€æ•…éšœæ¢å¤

**å…³é”®æ•°å­—**ï¼š
- è¿æ¥æ•°é™åˆ¶ï¼š`1000-5000`ä¸ª
- æ¶ˆæ¯é¢‘ç‡ï¼š`5-20æ¡/ç§’`
- ç¼“å­˜å¤§å°ï¼š`100-1000æ¡`
- ç›‘æ§é¢‘ç‡ï¼š`1ç§’/æ¬¡`

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼šWebSocketé«˜å¹¶å‘ä¼˜åŒ–å°±æ˜¯åœ¨**èµ„æºæœ‰é™**çš„æƒ…å†µä¸‹ï¼Œè®©**æ›´å¤šç”¨æˆ·**è·å¾—**æ›´å¥½ä½“éªŒ**ï¼Œå…³é”®æ˜¯æ‰¾åˆ°**æ€§èƒ½**å’Œ**ç¨³å®šæ€§**çš„å¹³è¡¡ç‚¹ã€‚