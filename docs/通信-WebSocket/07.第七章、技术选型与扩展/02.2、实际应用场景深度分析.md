---
title: 2ã€å®é™…åº”ç”¨åœºæ™¯æ·±åº¦åˆ†æ
---
## ğŸ“š ç›®å½•

1. [å³æ—¶èŠå¤©åº”ç”¨](#1-å³æ—¶èŠå¤©åº”ç”¨)
2. [å®æ—¶é€šçŸ¥ç³»ç»Ÿ](#2-å®æ—¶é€šçŸ¥ç³»ç»Ÿ)
3. [åœ¨çº¿åä½œå·¥å…·](#3-åœ¨çº¿åä½œå·¥å…·)
4. [å®æ—¶æ•°æ®ç›‘æ§](#4-å®æ—¶æ•°æ®ç›‘æ§)
5. [åœ¨çº¿æ¸¸æˆé€šä¿¡](#5-åœ¨çº¿æ¸¸æˆé€šä¿¡)
6. [ç›´æ’­å¼¹å¹•ç³»ç»Ÿ](#6-ç›´æ’­å¼¹å¹•ç³»ç»Ÿ)
7. [è‚¡ç¥¨è¡Œæƒ…æ¨é€](#7-è‚¡ç¥¨è¡Œæƒ…æ¨é€)
8. [åœºæ™¯é€‰å‹å¯¹æ¯”](#8-åœºæ™¯é€‰å‹å¯¹æ¯”)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¬ å³æ—¶èŠå¤©åº”ç”¨


### 1.1 ä»€ä¹ˆæ˜¯å³æ—¶èŠå¤©åº”ç”¨


**ğŸ”¸ ç®€å•ç†è§£**
```
æƒ³è±¡å¾®ä¿¡èŠå¤©ï¼š
ä½ å‘ä¸ª"ä½ å¥½" â†’ å¯¹æ–¹é©¬ä¸Šæ”¶åˆ°
å¯¹æ–¹å›å¤"Hi"  â†’ ä½ ç«‹å³çœ‹åˆ°

è¿™å°±æ˜¯å³æ—¶èŠå¤©ï¼Œæ¶ˆæ¯å®æ—¶åŒå‘ä¼ é€
```

**ğŸ’¡ æ ¸å¿ƒç‰¹ç‚¹**
- **å®æ—¶æ€§** - æ¶ˆæ¯å‘é€åç«‹å³åˆ°è¾¾
- **åŒå‘æ€§** - ä»»ä½•äººéƒ½å¯ä»¥å‘é€å’Œæ¥æ”¶
- **å¤šäººæ€§** - ç¾¤èŠæ”¯æŒå¤šäººåŒæ—¶äº¤æµ
- **æŒä¹…æ€§** - æ¶ˆæ¯éœ€è¦ä¿å­˜å†å²è®°å½•

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦WebSocket


**ğŸ¤” ä¼ ç»ŸHTTPçš„é—®é¢˜**
```
HTTPæ–¹å¼èŠå¤©çš„å›°å¢ƒï¼š

å®¢æˆ·ç«¯A: "ä½ å¥½"
         â†“ (å‘é€HTTPè¯·æ±‚)
æœåŠ¡å™¨:   æ”¶åˆ°æ¶ˆæ¯ï¼Œå­˜å‚¨

å®¢æˆ·ç«¯B: æ€ä¹ˆçŸ¥é“æœ‰æ–°æ¶ˆæ¯ï¼Ÿ
         â†“ (åªèƒ½ä¸æ–­è¯¢é—®æœåŠ¡å™¨)
         "æœ‰æ–°æ¶ˆæ¯å—ï¼Ÿ" "æœ‰æ–°æ¶ˆæ¯å—ï¼Ÿ" "æœ‰æ–°æ¶ˆæ¯å—ï¼Ÿ"

é—®é¢˜ï¼šè¦ä¹ˆå»¶è¿Ÿå¤§ï¼Œè¦ä¹ˆèµ„æºæµªè´¹ä¸¥é‡
```

**âš¡ WebSocketçš„ä¼˜åŠ¿**
```
WebSocketæ–¹å¼ï¼š

å®¢æˆ·ç«¯A â†â€”â€”â€”â€”â€”â€”â€”â€”â†’ æœåŠ¡å™¨ â†â€”â€”â€”â€”â€”â€”â€”â€”â†’ å®¢æˆ·ç«¯B
        å®æ—¶åŒå‘è¿æ¥        å®æ—¶åŒå‘è¿æ¥

æµç¨‹ï¼š
1. Aå‘é€"ä½ å¥½" â†’ æœåŠ¡å™¨ç«‹å³æ¨é€ç»™B
2. Bå‘é€"Hi"   â†’ æœåŠ¡å™¨ç«‹å³æ¨é€ç»™A

ä¼˜åŠ¿ï¼šçœŸæ­£çš„å®æ—¶ï¼Œæ— éœ€è½®è¯¢
```

### 1.3 å³æ—¶èŠå¤©æŠ€æœ¯è¦ç‚¹


#### ğŸ”§ **è¿æ¥ç®¡ç†**

```javascript
// å®¢æˆ·ç«¯è¿æ¥ç®¡ç†
class ChatClient {
    constructor(userId) {
        this.userId = userId;
        this.ws = null;
        this.connect();
    }
    
    connect() {
        this.ws = new WebSocket(`ws://localhost:8080/chat?userId=${this.userId}`);
        
        this.ws.onopen = () => {
            console.log('èŠå¤©è¿æ¥å·²å»ºç«‹');
        };
        
        this.ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            this.displayMessage(message);
        };
        
        // æ–­çº¿é‡è¿
        this.ws.onclose = () => {
            setTimeout(() => this.connect(), 3000);
        };
    }
    
    sendMessage(content, targetUser) {
        const message = {
            from: this.userId,
            to: targetUser,
            content: content,
            timestamp: new Date().getTime()
        };
        this.ws.send(JSON.stringify(message));
    }
}
```

#### ğŸ“¨ **æ¶ˆæ¯è·¯ç”±**

```javascript
// æœåŠ¡ç«¯æ¶ˆæ¯åˆ†å‘
class ChatServer {
    constructor() {
        this.connections = new Map(); // userId -> websocketè¿æ¥
    }
    
    handleMessage(ws, message) {
        const data = JSON.parse(message);
        
        // æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·çš„è¿æ¥
        const targetWs = this.connections.get(data.to);
        
        if (targetWs && targetWs.readyState === WebSocket.OPEN) {
            // è½¬å‘æ¶ˆæ¯ç»™ç›®æ ‡ç”¨æˆ·
            targetWs.send(JSON.stringify({
                from: data.from,
                content: data.content,
                timestamp: data.timestamp
            }));
        }
        
        // ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®åº“
        this.saveMessage(data);
    }
}
```

#### ğŸ‘¥ **ç¾¤èŠå®ç°**

```javascript
// ç¾¤èŠæˆ¿é—´ç®¡ç†
class ChatRoom {
    constructor(roomId) {
        this.roomId = roomId;
        this.members = new Set(); // æˆ¿é—´æˆå‘˜
    }
    
    // ç”¨æˆ·åŠ å…¥ç¾¤èŠ
    join(userId, ws) {
        this.members.add({userId, ws});
        
        // é€šçŸ¥å…¶ä»–äººæœ‰æ–°æˆå‘˜åŠ å…¥
        this.broadcast({
            type: 'user_joined',
            userId: userId,
            message: `${userId} åŠ å…¥äº†ç¾¤èŠ`
        }, userId);
    }
    
    // ç¾¤å‘æ¶ˆæ¯
    broadcast(message, excludeUserId) {
        this.members.forEach(member => {
            if (member.userId !== excludeUserId && 
                member.ws.readyState === WebSocket.OPEN) {
                member.ws.send(JSON.stringify(message));
            }
        });
    }
}
```

### 1.4 èŠå¤©åº”ç”¨æ¶æ„è®¾è®¡


```
ç”¨æˆ·ç•Œé¢å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠå¤©çª—å£  â”‚  è”ç³»äººåˆ—è¡¨  â”‚  ç¾¤ç»„åˆ—è¡¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†• WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           WebSocketæœåŠ¡å™¨            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è¿æ¥ç®¡ç†  â”‚ â”‚    æ¶ˆæ¯è·¯ç”±      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ¶ˆæ¯å­˜å‚¨ï¼ˆæ•°æ®åº“/ç¼“å­˜ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”” å®æ—¶é€šçŸ¥ç³»ç»Ÿ


### 2.1 ä»€ä¹ˆæ˜¯å®æ—¶é€šçŸ¥ç³»ç»Ÿ


**ğŸ”¸ ç”Ÿæ´»ä¸­çš„ä¾‹å­**
```
æƒ³æƒ³ä½ çš„æ‰‹æœºé€šçŸ¥ï¼š
ğŸ“± å¾®ä¿¡æ¶ˆæ¯æ¥äº† â†’ ç«‹å³å¼¹å‡ºé€šçŸ¥
ğŸ“§ é‚®ä»¶åˆ°äº†     â†’ é©¬ä¸Šæ˜¾ç¤ºçº¢ç‚¹
ğŸ›’ è®¢å•çŠ¶æ€å˜äº† â†’ å®æ—¶æ¨é€æ›´æ–°

è¿™äº›éƒ½æ˜¯å®æ—¶é€šçŸ¥ç³»ç»Ÿçš„åº”ç”¨
```

**ğŸ’¡ æ ¸å¿ƒä½œç”¨**
- **åŠæ—¶æé†’** - é‡è¦äº‹ä»¶å‘ç”Ÿæ—¶ç«‹å³é€šçŸ¥ç”¨æˆ·
- **çŠ¶æ€åŒæ­¥** - å¤šè®¾å¤‡é—´çŠ¶æ€å®æ—¶åŒæ­¥
- **ç”¨æˆ·ä½“éªŒ** - å‡å°‘ç”¨æˆ·ä¸»åŠ¨æŸ¥è¯¢çš„éœ€è¦

### 2.2 é€šçŸ¥ç³»ç»Ÿçš„æŒ‘æˆ˜


**ğŸ¤¯ ä¼ ç»Ÿè½®è¯¢çš„é—®é¢˜**
```
ç”¨æˆ·æ“ä½œï¼šä¸‹å•è´­ä¹°å•†å“

ä¼ ç»Ÿæ–¹å¼çš„å›°å¢ƒï¼š
ç”¨æˆ·: "æˆ‘çš„è®¢å•çŠ¶æ€å¦‚ä½•ï¼Ÿ"
æœåŠ¡å™¨: "æ­£åœ¨å¤„ç†ä¸­"

(è¿‡5ç§’)
ç”¨æˆ·: "ç°åœ¨çŠ¶æ€å¦‚ä½•ï¼Ÿ"  
æœåŠ¡å™¨: "è¿˜åœ¨å¤„ç†ä¸­"

(è¿‡5ç§’)  
ç”¨æˆ·: "ç°åœ¨å‘¢ï¼Ÿ"
æœåŠ¡å™¨: "å·²å‘è´§"

é—®é¢˜ï¼šå»¶è¿Ÿ5ç§’æ‰çŸ¥é“ï¼Œä¸”æµªè´¹å¤§é‡è¯·æ±‚
```

**âš¡ WebSocketå®æ—¶æ¨é€**
```
WebSocketæ–¹å¼ï¼š

ç”¨æˆ·ä¸‹å• â†’ æœåŠ¡å™¨å¼€å§‹å¤„ç†
              â†“ (çŠ¶æ€å˜åŒ–æ—¶ä¸»åŠ¨æ¨é€)
ç”¨æˆ· â† "è®¢å•ç¡®è®¤" 
ç”¨æˆ· â† "å¼€å§‹å¤‡è´§"
ç”¨æˆ· â† "å·²å‘è´§"
ç”¨æˆ· â† "é…é€ä¸­"

ä¼˜åŠ¿ï¼šçŠ¶æ€å˜åŒ–ç«‹å³çŸ¥é“ï¼Œæ— å»¶è¿Ÿ
```

### 2.3 å®æ—¶é€šçŸ¥æ¨é€ç³»ç»Ÿè®¾è®¡


#### ğŸ¯ **é€šçŸ¥åˆ†ç±»ç®¡ç†**

```javascript
// é€šçŸ¥ç±»å‹å®šä¹‰
const NotificationTypes = {
    ORDER: 'order',           // è®¢å•é€šçŸ¥
    SYSTEM: 'system',         // ç³»ç»Ÿé€šçŸ¥  
    MESSAGE: 'message',       // æ¶ˆæ¯é€šçŸ¥
    ACTIVITY: 'activity'      // æ´»åŠ¨é€šçŸ¥
};

// é€šçŸ¥ç®¡ç†å™¨
class NotificationManager {
    constructor() {
        this.subscribers = new Map(); // userId -> è®¢é˜…åˆ—è¡¨
    }
    
    // ç”¨æˆ·è®¢é˜…é€šçŸ¥ç±»å‹
    subscribe(userId, notificationType, ws) {
        if (!this.subscribers.has(userId)) {
            this.subscribers.set(userId, new Map());
        }
        
        this.subscribers.get(userId).set(notificationType, ws);
    }
    
    // å‘é€é€šçŸ¥
    notify(userId, type, data) {
        const userSubscriptions = this.subscribers.get(userId);
        
        if (userSubscriptions && userSubscriptions.has(type)) {
            const ws = userSubscriptions.get(type);
            
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: type,
                    data: data,
                    timestamp: new Date().getTime()
                }));
            }
        }
    }
}
```

#### ğŸ”„ **ä¸šåŠ¡äº‹ä»¶è§¦å‘**

```javascript
// è®¢å•çŠ¶æ€å˜æ›´è§¦å‘é€šçŸ¥
class OrderService {
    constructor(notificationManager) {
        this.notifications = notificationManager;
    }
    
    updateOrderStatus(orderId, newStatus, userId) {
        // æ›´æ–°è®¢å•çŠ¶æ€
        this.updateDatabase(orderId, newStatus);
        
        // è§¦å‘å®æ—¶é€šçŸ¥
        this.notifications.notify(userId, NotificationTypes.ORDER, {
            orderId: orderId,
            status: newStatus,
            message: this.getStatusMessage(newStatus)
        });
    }
    
    getStatusMessage(status) {
        const messages = {
            'confirmed': 'è®¢å•å·²ç¡®è®¤ï¼Œæ­£åœ¨å‡†å¤‡å‘è´§',
            'shipped': 'è®¢å•å·²å‘è´§ï¼Œè¯·æ³¨æ„æŸ¥æ”¶',
            'delivered': 'è®¢å•å·²é€è¾¾ï¼Œæ„Ÿè°¢æ‚¨çš„è´­ä¹°'
        };
        return messages[status];
    }
}
```

#### ğŸ“± **å®¢æˆ·ç«¯é€šçŸ¥å¤„ç†**

```javascript
// å®¢æˆ·ç«¯é€šçŸ¥æ¥æ”¶
class NotificationClient {
    constructor(userId) {
        this.userId = userId;
        this.init();
    }
    
    init() {
        this.ws = new WebSocket(`ws://localhost:8080/notifications?userId=${this.userId}`);
        
        this.ws.onmessage = (event) => {
            const notification = JSON.parse(event.data);
            this.showNotification(notification);
        };
    }
    
    showNotification(notification) {
        // æ ¹æ®é€šçŸ¥ç±»å‹æ˜¾ç¤ºä¸åŒæ ·å¼
        switch(notification.type) {
            case 'order':
                this.showOrderNotification(notification.data);
                break;
            case 'system':
                this.showSystemNotification(notification.data);
                break;
            default:
                this.showDefaultNotification(notification.data);
        }
    }
    
    showOrderNotification(data) {
        // æ˜¾ç¤ºè®¢å•é€šçŸ¥ï¼ˆå¼¹çª—ã€å£°éŸ³ã€å¾½ç« ç­‰ï¼‰
        const toast = document.createElement('div');
        toast.className = 'notification order-notification';
        toast.innerHTML = `
            <h4>è®¢å•æ›´æ–°</h4>
            <p>è®¢å• ${data.orderId}: ${data.message}</p>
        `;
        document.body.appendChild(toast);
        
        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => toast.remove(), 3000);
    }
}
```

### 2.4 é€šçŸ¥ç³»ç»Ÿæ¶æ„


```
ä¸šåŠ¡ç³»ç»Ÿè§¦å‘äº‹ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•ç³»ç»Ÿ â”‚ æ”¯ä»˜ç³»ç»Ÿ â”‚ ç‰©æµç³»ç»Ÿ â”‚ å…¶ä»– â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ äº‹ä»¶è§¦å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         é€šçŸ¥ä¸­å¿ƒæœåŠ¡å™¨              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ äº‹ä»¶ç›‘å¬å¤„ç† â”‚ â”‚ ç”¨æˆ·è®¢é˜…ç®¡ç† â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ WebSocketæ¨é€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è®¾å¤‡ï¼ˆWebã€Appã€æ¡Œé¢ç«¯ï¼‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ¤ åœ¨çº¿åä½œå·¥å…·


### 3.1 ä»€ä¹ˆæ˜¯åœ¨çº¿åä½œå·¥å…·


**ğŸ”¸ å¸¸è§çš„åä½œåœºæ™¯**
```
å¤šäººç¼–è¾‘æ–‡æ¡£ï¼š
ğŸ‘¨â€ğŸ’» å°æ˜åœ¨å†™ç¬¬ä¸€æ®µ
ğŸ‘©â€ğŸ’» å°çº¢åœ¨å†™ç¬¬äºŒæ®µ
ğŸ‘¨â€ğŸ“ è€å¸ˆåœ¨æ‰¹æ³¨ç¬¬ä¸‰æ®µ

å®æ—¶çœ‹åˆ°ï¼š
- è°åœ¨ç¼–è¾‘å“ªé‡Œ
- å†…å®¹å®æ—¶æ›´æ–°
- å…‰æ ‡ä½ç½®æ˜¾ç¤º
```

**ğŸ’¡ åä½œçš„æ ¸å¿ƒéœ€æ±‚**
- **å®æ—¶åŒæ­¥** - ä¸€ä¸ªäººçš„æ“ä½œå…¶ä»–äººç«‹å³çœ‹åˆ°
- **å†²çªå¤„ç†** - å¤šäººåŒæ—¶ç¼–è¾‘ä¸ä¼šå‡ºé”™
- **çŠ¶æ€å…±äº«** - çŸ¥é“å…¶ä»–äººåœ¨åšä»€ä¹ˆ
- **å†å²è®°å½•** - å¯ä»¥æ’¤é”€å’Œå›é€€

### 3.2 ä¸ºä»€ä¹ˆWebSocketé€‚åˆåä½œ


**ğŸš« ä¼ ç»Ÿæ–¹å¼çš„å±€é™**
```
HTTPè½®è¯¢æ–¹å¼çš„é—®é¢˜ï¼š

ç”¨æˆ·A: è¾“å…¥"Hello"
       â†“ (ç­‰å¾…1ç§’åå‘é€)
æœåŠ¡å™¨: æ”¶åˆ°æ›´æ–°

ç”¨æˆ·B: ï¼Ÿï¼Ÿï¼Ÿ
       â†“ (è½®è¯¢æ£€æŸ¥)
       "æœ‰æ›´æ–°å—ï¼Ÿ"
æœåŠ¡å™¨: "æœ‰ï¼Œå†…å®¹æ˜¯Hello"

é—®é¢˜ï¼šå»¶è¿Ÿå¤§ï¼Œä½“éªŒå·®ï¼Œåƒåœ¨çœ‹å¹»ç¯ç‰‡
```

**âœ… WebSocketçš„å®æ—¶æ€§**
```
WebSocketåä½œï¼š

ç”¨æˆ·A: è¾“å…¥"H" â†’ ç«‹å³æ¨é€ç»™æ‰€æœ‰äºº
ç”¨æˆ·A: è¾“å…¥"e" â†’ ç«‹å³æ¨é€ç»™æ‰€æœ‰äºº  
ç”¨æˆ·A: è¾“å…¥"l" â†’ ç«‹å³æ¨é€ç»™æ‰€æœ‰äºº

å…¶ä»–ç”¨æˆ·å®æ—¶çœ‹åˆ°ï¼š
"H" â†’ "He" â†’ "Hel" â†’ "Hell" â†’ "Hello"

ä½“éªŒï¼šå°±åƒååœ¨æ—è¾¹ä¸€èµ·å†™ä½œä¸š
```

### 3.3 åœ¨çº¿åä½œå·¥å…·å®ç°è¦ç‚¹


#### âœï¸ **å®æ—¶æ–‡æ¡£ç¼–è¾‘**

```javascript
// åä½œæ–‡æ¡£å®¢æˆ·ç«¯
class CollaborativeEditor {
    constructor(documentId, userId) {
        this.documentId = documentId;
        this.userId = userId;
        this.content = '';
        this.cursors = new Map(); // å…¶ä»–ç”¨æˆ·å…‰æ ‡ä½ç½®
        this.init();
    }
    
    init() {
        this.ws = new WebSocket(`ws://localhost:8080/doc/${this.documentId}?userId=${this.userId}`);
        
        this.ws.onmessage = (event) => {
            const operation = JSON.parse(event.data);
            this.handleRemoteOperation(operation);
        };
        
        // ç›‘å¬æœ¬åœ°ç¼–è¾‘
        this.editor.addEventListener('input', (e) => {
            this.handleLocalEdit(e);
        });
    }
    
    // å¤„ç†æœ¬åœ°ç¼–è¾‘
    handleLocalEdit(event) {
        const operation = {
            type: 'edit',
            userId: this.userId,
            position: event.target.selectionStart,
            action: 'insert', // æˆ– 'delete'
            content: event.data,
            timestamp: Date.now()
        };
        
        // å‘é€ç»™æœåŠ¡å™¨
        this.ws.send(JSON.stringify(operation));
    }
    
    // å¤„ç†è¿œç¨‹æ“ä½œ
    handleRemoteOperation(operation) {
        switch(operation.type) {
            case 'edit':
                this.applyEdit(operation);
                break;
            case 'cursor':
                this.updateCursor(operation);
                break;
        }
    }
    
    applyEdit(operation) {
        // åœ¨æŒ‡å®šä½ç½®æ’å…¥æˆ–åˆ é™¤æ–‡æœ¬
        const editor = this.editor;
        const currentPos = editor.selectionStart;
        
        if (operation.action === 'insert') {
            const before = this.content.substring(0, operation.position);
            const after = this.content.substring(operation.position);
            this.content = before + operation.content + after;
        }
        
        // æ›´æ–°ç¼–è¾‘å™¨å†…å®¹
        editor.value = this.content;
        
        // è°ƒæ•´å…‰æ ‡ä½ç½®ï¼ˆé¿å…è·³åŠ¨ï¼‰
        if (currentPos >= operation.position) {
            editor.selectionStart = currentPos + operation.content.length;
        }
    }
}
```

#### ğŸ‘¥ **å¤šç”¨æˆ·çŠ¶æ€ç®¡ç†**

```javascript
// åä½œä¼šè¯ç®¡ç†
class CollaborationSession {
    constructor(documentId) {
        this.documentId = documentId;
        this.users = new Map();      // åœ¨çº¿ç”¨æˆ·
        this.operations = [];        // æ“ä½œå†å²
        this.content = '';          // å½“å‰æ–‡æ¡£å†…å®¹
    }
    
    // ç”¨æˆ·åŠ å…¥åä½œ
    userJoin(userId, ws) {
        this.users.set(userId, {
            ws: ws,
            cursor: 0,
            color: this.assignColor(),  // åˆ†é…é¢œè‰²
            joinTime: Date.now()
        });
        
        // å‘é€å½“å‰çŠ¶æ€ç»™æ–°ç”¨æˆ·
        ws.send(JSON.stringify({
            type: 'init',
            content: this.content,
            users: Array.from(this.users.keys())
        }));
        
        // é€šçŸ¥å…¶ä»–ç”¨æˆ·æœ‰æ–°äººåŠ å…¥
        this.broadcastToOthers(userId, {
            type: 'user_joined',
            userId: userId,
            color: this.users.get(userId).color
        });
    }
    
    // å¤„ç†ç¼–è¾‘æ“ä½œ
    handleEdit(userId, operation) {
        // è®°å½•æ“ä½œ
        this.operations.push({
            ...operation,
            userId: userId,
            timestamp: Date.now()
        });
        
        // åº”ç”¨æ“ä½œåˆ°æ–‡æ¡£
        this.applyOperation(operation);
        
        // å¹¿æ’­ç»™å…¶ä»–ç”¨æˆ·
        this.broadcastToOthers(userId, operation);
    }
    
    // åˆ†é…ç”¨æˆ·é¢œè‰²
    assignColor() {
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57'];
        return colors[this.users.size % colors.length];
    }
}
```

#### ğŸ¨ **å…‰æ ‡å’Œé€‰æ‹©æ˜¾ç¤º**

```javascript
// å…‰æ ‡ä½ç½®åŒæ­¥
class CursorManager {
    constructor(editor, collaborationClient) {
        this.editor = editor;
        this.client = collaborationClient;
        this.remoteCursors = new Map();
        this.init();
    }
    
    init() {
        // ç›‘å¬æœ¬åœ°å…‰æ ‡ç§»åŠ¨
        this.editor.addEventListener('selectionchange', () => {
            this.sendCursorUpdate();
        });
    }
    
    // å‘é€å…‰æ ‡ä½ç½®æ›´æ–°
    sendCursorUpdate() {
        const selection = this.editor.selectionStart;
        
        this.client.send({
            type: 'cursor',
            position: selection,
            userId: this.client.userId
        });
    }
    
    // æ˜¾ç¤ºå…¶ä»–ç”¨æˆ·çš„å…‰æ ‡
    showRemoteCursor(userId, position, color) {
        // åˆ›å»ºå…‰æ ‡å…ƒç´ 
        const cursor = document.createElement('div');
        cursor.className = 'remote-cursor';
        cursor.style.backgroundColor = color;
        cursor.style.left = this.getPositionX(position) + 'px';
        cursor.style.top = this.getPositionY(position) + 'px';
        
        // æ·»åŠ ç”¨æˆ·æ ‡ç­¾
        const label = document.createElement('div');
        label.className = 'cursor-label';
        label.textContent = userId;
        label.style.backgroundColor = color;
        cursor.appendChild(label);
        
        // æ›´æ–°å…‰æ ‡ä½ç½®
        if (this.remoteCursors.has(userId)) {
            this.remoteCursors.get(userId).remove();
        }
        
        this.remoteCursors.set(userId, cursor);
        this.editor.parentNode.appendChild(cursor);
    }
}
```

### 3.4 åä½œå·¥å…·æ¶æ„


```
å®¢æˆ·ç«¯ç¼–è¾‘å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·Aç¼–è¾‘å™¨ â”‚ ç”¨æˆ·Bç¼–è¾‘å™¨ â”‚ ç”¨æˆ·Cç¼–è¾‘å™¨ â”‚
â”‚ å®æ—¶è¾“å…¥   â”‚ å®æ—¶è¾“å…¥   â”‚ å®æ—¶è¾“å…¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†• WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åä½œæœåŠ¡å™¨                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ“ä½œè½¬æ¢å¼•æ“ â”‚ â”‚ å†²çªè§£å†³æœºåˆ¶ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–‡æ¡£å­˜å‚¨ + æ“ä½œå†å²è®°å½•           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ğŸ“Š å®æ—¶æ•°æ®ç›‘æ§


### 4.1 ä»€ä¹ˆæ˜¯å®æ—¶æ•°æ®ç›‘æ§


**ğŸ”¸ ç›‘æ§çš„æœ¬è´¨**
```
æƒ³è±¡æ±½è½¦ä»ªè¡¨ç›˜ï¼š
ğŸš— é€Ÿåº¦è¡¨ - å®æ—¶æ˜¾ç¤ºå½“å‰é€Ÿåº¦
â›½ æ²¹é‡è¡¨ - å®æ—¶æ˜¾ç¤ºå‰©ä½™æ²¹é‡
ğŸŒ¡ï¸ æ¸©åº¦è¡¨ - å®æ—¶æ˜¾ç¤ºå¼•æ“æ¸©åº¦

æ•°æ®ç›‘æ§ä¹Ÿä¸€æ ·ï¼š
ğŸ’» æœåŠ¡å™¨CPU - å®æ—¶æ˜¾ç¤ºä½¿ç”¨ç‡
ğŸ“ˆ ç½‘ç«™è®¿é—®é‡ - å®æ—¶æ˜¾ç¤ºåœ¨çº¿äººæ•°
ğŸ’° é”€å”®æ•°æ® - å®æ—¶æ˜¾ç¤ºä»Šæ—¥æ”¶å…¥
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å®æ—¶ç›‘æ§**
- **åŠæ—¶å‘ç°é—®é¢˜** - ç³»ç»Ÿå¼‚å¸¸ç«‹å³çŸ¥é“
- **æ€§èƒ½ä¼˜åŒ–** - æ ¹æ®å®æ—¶æ•°æ®è°ƒæ•´ç­–ç•¥
- **ä¸šåŠ¡å†³ç­–** - åŸºäºæœ€æ–°æ•°æ®åšå†³å®š
- **ç”¨æˆ·ä½“éªŒ** - è®©ç”¨æˆ·çœ‹åˆ°æœ€æ–°çŠ¶æ€

### 4.2 ä¼ ç»Ÿç›‘æ§çš„é—®é¢˜


**ğŸ“‰ é¡µé¢åˆ·æ–°çš„å›°æ‰°**
```
ä¼ ç»Ÿç›‘æ§é¡µé¢ï¼š

ç®¡ç†å‘˜: æ‰“å¼€ç›‘æ§é¡µé¢ï¼Œçœ‹åˆ°æ•°æ®
        (è¿‡äº†5åˆ†é’Ÿ)
ç®¡ç†å‘˜: æ‰‹åŠ¨åˆ·æ–°é¡µé¢ï¼Œçœ‹æ–°æ•°æ®
        (åˆè¿‡äº†5åˆ†é’Ÿ)  
ç®¡ç†å‘˜: å†æ¬¡æ‰‹åŠ¨åˆ·æ–°...

é—®é¢˜ï¼š
- ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å‡ºé—®é¢˜
- éœ€è¦ä¸æ–­æ‰‹åŠ¨åˆ·æ–°
- å¯èƒ½é”™è¿‡å…³é”®æ—¶åˆ»
```

**âš¡ WebSocketå®æ—¶æ¨é€**
```
å®æ—¶ç›‘æ§ï¼š

æ•°æ®å˜åŒ– â†’ æœåŠ¡å™¨ç«‹å³æ¨é€ â†’ é¡µé¢è‡ªåŠ¨æ›´æ–°

ä¼˜åŠ¿ï¼š
- æ•°æ®ä¸€å˜åŒ–å°±çŸ¥é“
- æ— éœ€æ‰‹åŠ¨æ“ä½œ  
- ä¸ä¼šé”™è¿‡ä»»ä½•å¼‚å¸¸
```

### 4.3 å®æ—¶æ•°æ®ç›‘æ§ä»ªè¡¨æ¿


#### ğŸ“ˆ **æ•°æ®é‡‡é›†ä¸æ¨é€**

```javascript
// ç›‘æ§æ•°æ®é‡‡é›†å™¨
class MonitoringCollector {
    constructor() {
        this.metrics = new Map();
        this.subscribers = new Set();
        this.startCollection();
    }
    
    // å¼€å§‹æ•°æ®é‡‡é›†
    startCollection() {
        setInterval(() => {
            this.collectSystemMetrics();
            this.pushToSubscribers();
        }, 1000); // æ¯ç§’é‡‡é›†ä¸€æ¬¡
    }
    
    // é‡‡é›†ç³»ç»ŸæŒ‡æ ‡
    collectSystemMetrics() {
        const metrics = {
            cpu: this.getCPUUsage(),
            memory: this.getMemoryUsage(),
            disk: this.getDiskUsage(),
            network: this.getNetworkTraffic(),
            timestamp: Date.now()
        };
        
        this.metrics.set('system', metrics);
    }
    
    // æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…
    pushToSubscribers() {
        const data = {
            type: 'metrics_update',
            data: Object.fromEntries(this.metrics),
            timestamp: Date.now()
        };
        
        this.subscribers.forEach(ws => {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify(data));
            }
        });
    }
    
    // è·å–CPUä½¿ç”¨ç‡ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
    getCPUUsage() {
        return Math.floor(Math.random() * 100); // å®é™…åº”è¯¥è°ƒç”¨ç³»ç»ŸAPI
    }
}
```

#### ğŸ“Š **ä»ªè¡¨æ¿å®¢æˆ·ç«¯**

```javascript
// ç›‘æ§ä»ªè¡¨æ¿
class MonitoringDashboard {
    constructor() {
        this.charts = new Map();
        this.init();
    }
    
    init() {
        this.ws = new WebSocket('ws://localhost:8080/monitoring');
        
        this.ws.onmessage = (event) => {
            const update = JSON.parse(event.data);
            this.updateDashboard(update);
        };
        
        this.createCharts();
    }
    
    // åˆ›å»ºå›¾è¡¨
    createCharts() {
        // CPUä½¿ç”¨ç‡å›¾è¡¨
        this.charts.set('cpu', new RealtimeChart('cpu-chart', {
            title: 'CPUä½¿ç”¨ç‡',
            unit: '%',
            max: 100,
            color: '#FF6B6B'
        }));
        
        // å†…å­˜ä½¿ç”¨å›¾è¡¨
        this.charts.set('memory', new RealtimeChart('memory-chart', {
            title: 'å†…å­˜ä½¿ç”¨',
            unit: 'GB',
            max: 16,
            color: '#4ECDC4'
        }));
    }
    
    // æ›´æ–°ä»ªè¡¨æ¿
    updateDashboard(data) {
        if (data.type === 'metrics_update') {
            const systemData = data.data.system;
            
            // æ›´æ–°CPUå›¾è¡¨
            this.charts.get('cpu').addPoint({
                time: systemData.timestamp,
                value: systemData.cpu
            });
            
            // æ›´æ–°å†…å­˜å›¾è¡¨  
            this.charts.get('memory').addPoint({
                time: systemData.timestamp,
                value: systemData.memory
            });
            
            // æ£€æŸ¥å‘Šè­¦æ¡ä»¶
            this.checkAlerts(systemData);
        }
    }
    
    // æ£€æŸ¥å‘Šè­¦
    checkAlerts(data) {
        if (data.cpu > 90) {
            this.showAlert('CPUä½¿ç”¨ç‡è¿‡é«˜', 'warning');
        }
        if (data.memory > 80) {
            this.showAlert('å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜', 'warning');
        }
    }
}
```

#### ğŸ“º **å®æ—¶å›¾è¡¨ç»„ä»¶**

```javascript
// å®æ—¶å›¾è¡¨ç±»
class RealtimeChart {
    constructor(containerId, options) {
        this.container = document.getElementById(containerId);
        this.options = options;
        this.dataPoints = [];
        this.maxPoints = 60; // ä¿ç•™60ä¸ªæ•°æ®ç‚¹
        this.init();
    }
    
    init() {
        // åˆ›å»ºå›¾è¡¨å®¹å™¨
        this.canvas = document.createElement('canvas');
        this.canvas.width = 400;
        this.canvas.height = 200;
        this.container.appendChild(this.canvas);
        
        this.ctx = this.canvas.getContext('2d');
        this.draw();
    }
    
    // æ·»åŠ æ–°æ•°æ®ç‚¹
    addPoint(point) {
        this.dataPoints.push(point);
        
        // ä¿æŒæ•°æ®ç‚¹æ•°é‡é™åˆ¶
        if (this.dataPoints.length > this.maxPoints) {
            this.dataPoints.shift();
        }
        
        this.draw();
    }
    
    // ç»˜åˆ¶å›¾è¡¨
    draw() {
        const ctx = this.ctx;
        const canvas = this.canvas;
        
        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (this.dataPoints.length < 2) return;
        
        // ç»˜åˆ¶æŠ˜çº¿
        ctx.strokeStyle = this.options.color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        this.dataPoints.forEach((point, index) => {
            const x = (index / this.maxPoints) * canvas.width;
            const y = canvas.height - (point.value / this.options.max) * canvas.height;
            
            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });
        
        ctx.stroke();
        
        // æ˜¾ç¤ºå½“å‰å€¼
        const currentValue = this.dataPoints[this.dataPoints.length - 1].value;
        ctx.font = '16px Arial';
        ctx.fillStyle = this.options.color;
        ctx.fillText(`${currentValue}${this.options.unit}`, 10, 30);
    }
}
```

### 4.4 ç›‘æ§ç³»ç»Ÿæ¶æ„


```
æ•°æ®æº
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»ŸæŒ‡æ ‡ â”‚ åº”ç”¨æ—¥å¿— â”‚ ä¸šåŠ¡æ•°æ® â”‚ ä¼ æ„Ÿå™¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ æ•°æ®é‡‡é›†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç›‘æ§æœåŠ¡å™¨                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ•°æ®å¤„ç†å¼•æ“ â”‚ â”‚ å‘Šè­¦è§„åˆ™å¼•æ“ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ WebSocketæ¨é€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ç›‘æ§ä»ªè¡¨æ¿                    â”‚
â”‚  å®æ—¶å›¾è¡¨ â”‚ å‘Šè­¦é¢æ¿ â”‚ æ•°æ®å¤§å±      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ğŸ® åœ¨çº¿æ¸¸æˆé€šä¿¡


### 5.1 ä»€ä¹ˆæ˜¯åœ¨çº¿æ¸¸æˆé€šä¿¡


**ğŸ”¸ æ¸¸æˆä¸­çš„å®æ—¶äº¤äº’**
```
æƒ³è±¡ç‹è€…è£è€€æ¸¸æˆï¼š
ğŸ‘¤ ä½ ç§»åŠ¨è§’è‰² â†’ é˜Ÿå‹ç«‹å³çœ‹åˆ°ä½ çš„ä½ç½®
âš”ï¸ ä½ é‡Šæ”¾æŠ€èƒ½ â†’ æ•Œäººç«‹å³å—åˆ°å½±å“  
ğŸ’¬ ä½ å‘é€ä¿¡å· â†’ é˜Ÿå‹ç«‹å³æ”¶åˆ°æç¤º

è¿™äº›éƒ½éœ€è¦æ¯«ç§’çº§çš„å®æ—¶é€šä¿¡
```

**ğŸ’¡ æ¸¸æˆé€šä¿¡çš„ç‰¹ç‚¹**
- **è¶…ä½å»¶è¿Ÿ** - é€šå¸¸è¦æ±‚50msä»¥å†…
- **é«˜é¢‘ç‡** - æ¯ç§’å¯èƒ½å‡ åä¸Šç™¾æ¬¡æ“ä½œ
- **åŒæ­¥æ€§** - æ‰€æœ‰ç©å®¶çœ‹åˆ°çš„å¿…é¡»ä¸€è‡´
- **å¯é æ€§** - å…³é”®æ“ä½œä¸èƒ½ä¸¢å¤±

### 5.2 ä¸ºä»€ä¹ˆWebSocketé€‚åˆæ¸¸æˆ


**â±ï¸ å»¶è¿Ÿå¯¹æ¯”**
```
HTTPè¯·æ±‚æ–¹å¼ï¼š
ç©å®¶æ“ä½œ â†’ å»ºç«‹è¿æ¥ â†’ å‘é€æ•°æ® â†’ ç­‰å¾…å“åº” â†’ å…³é—­è¿æ¥
æ€»å»¶è¿Ÿï¼š100-500msï¼ˆä¸å¯æ¥å—ï¼‰

WebSocketæ–¹å¼ï¼š
ç©å®¶æ“ä½œ â†’ ç›´æ¥å‘é€æ•°æ® â†’ ç«‹å³å“åº”
æ€»å»¶è¿Ÿï¼š10-50msï¼ˆå¯æ¥å—ï¼‰
```

**ğŸ“Š æ•°æ®é‡å¯¹æ¯”**
```
HTTPå¤´éƒ¨å¼€é”€ï¼š
æ¯æ¬¡è¯·æ±‚éƒ½è¦å‘é€å®Œæ•´HTTPå¤´ï¼ˆå‡ ç™¾å­—èŠ‚ï¼‰
æ¸¸æˆæ•°æ®å¯èƒ½åªæœ‰å‡ å­—èŠ‚
å¼€é”€æ¯”ä¾‹ï¼š90%ä»¥ä¸Šæ˜¯æ— ç”¨çš„å¤´éƒ¨ä¿¡æ¯

WebSocketå¼€é”€ï¼š
å»ºç«‹è¿æ¥ååªå‘é€æ¸¸æˆæ•°æ®
å‡ ä¹é›¶å¼€é”€ï¼Œæ•ˆç‡æé«˜
```

### 5.3 åœ¨çº¿æ¸¸æˆé€šä¿¡æœºåˆ¶


#### ğŸ¯ **ç©å®¶æ“ä½œåŒæ­¥**

```javascript
// æ¸¸æˆå®¢æˆ·ç«¯
class GameClient {
    constructor(playerId) {
        this.playerId = playerId;
        this.gameState = {};
        this.lastSyncTime = 0;
        this.init();
    }
    
    init() {
        this.ws = new WebSocket(`ws://localhost:8080/game?playerId=${this.playerId}`);
        
        this.ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            this.handleServerMessage(message);
        };
        
        // ç›‘å¬ç©å®¶æ“ä½œ
        this.bindControls();
        
        // å®šæ—¶å‘é€ä½ç½®åŒæ­¥
        setInterval(() => {
            this.sendPositionUpdate();
        }, 50); // 20æ¬¡/ç§’
    }
    
    // ç»‘å®šæ¸¸æˆæ§åˆ¶
    bindControls() {
        document.addEventListener('keydown', (e) => {
            const action = this.keyToAction(e.key);
            if (action) {
                this.sendAction(action);
            }
        });
    }
    
    // å‘é€ç©å®¶åŠ¨ä½œ
    sendAction(action) {
        const message = {
            type: 'action',
            playerId: this.playerId,
            action: action,
            timestamp: Date.now()
        };
        
        this.ws.send(JSON.stringify(message));
    }
    
    // å‘é€ä½ç½®æ›´æ–°
    sendPositionUpdate() {
        if (this.hasPositionChanged()) {
            const message = {
                type: 'position',
                playerId: this.playerId,
                x: this.player.x,
                y: this.player.y,
                timestamp: Date.now()
            };
            
            this.ws.send(JSON.stringify(message));
        }
    }
    
    // å¤„ç†æœåŠ¡å™¨æ¶ˆæ¯
    handleServerMessage(message) {
        switch(message.type) {
            case 'gameState':
                this.updateGameState(message.data);
                break;
            case 'playerAction':
                this.renderPlayerAction(message);
                break;
        }
    }
}
```

#### ğŸ›ï¸ **æ¸¸æˆæœåŠ¡å™¨å¤„ç†**

```javascript
// æ¸¸æˆæˆ¿é—´ç®¡ç†
class GameRoom {
    constructor(roomId) {
        this.roomId = roomId;
        this.players = new Map();
        this.gameState = {
            players: {},
            objects: {},
            timestamp: Date.now()
        };
        
        // æ¸¸æˆå¾ªç¯
        this.startGameLoop();
    }
    
    // ç©å®¶åŠ å…¥æˆ¿é—´
    addPlayer(playerId, ws) {
        this.players.set(playerId, {
            ws: ws,
            x: Math.random() * 800,  // éšæœºåˆå§‹ä½ç½®
            y: Math.random() * 600,
            health: 100,
            lastUpdate: Date.now()
        });
        
        // å‘é€å½“å‰æ¸¸æˆçŠ¶æ€ç»™æ–°ç©å®¶
        this.sendGameState(ws);
        
        // é€šçŸ¥å…¶ä»–ç©å®¶æœ‰æ–°ç©å®¶åŠ å…¥
        this.broadcast({
            type: 'playerJoined',
            playerId: playerId
        }, playerId);
    }
    
    // å¤„ç†ç©å®¶åŠ¨ä½œ
    handlePlayerAction(playerId, action) {
        const player = this.players.get(playerId);
        if (!player) return;
        
        // æ ¹æ®åŠ¨ä½œç±»å‹æ›´æ–°ç©å®¶çŠ¶æ€
        switch(action.action) {
            case 'move':
                this.movePlayer(playerId, action.direction);
                break;
            case 'attack':
                this.playerAttack(playerId, action.target);
                break;
        }
        
        // å¹¿æ’­åŠ¨ä½œç»™å…¶ä»–ç©å®¶
        this.broadcast({
            type: 'playerAction',
            playerId: playerId,
            action: action
        }, playerId);
    }
    
    // æ¸¸æˆä¸»å¾ªç¯
    startGameLoop() {
        setInterval(() => {
            this.updateGame();
            this.broadcastGameState();
        }, 1000/30); // 30FPS
    }
    
    // å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰ç©å®¶
    broadcast(message, excludePlayerId) {
        this.players.forEach((player, playerId) => {
            if (playerId !== excludePlayerId && 
                player.ws.readyState === WebSocket.OPEN) {
                player.ws.send(JSON.stringify(message));
            }
        });
    }
}
```

#### âš–ï¸ **çŠ¶æ€åŒæ­¥ç­–ç•¥**

```javascript
// æ¸¸æˆçŠ¶æ€åŒæ­¥ç®¡ç†
class GameStateSync {
    constructor(gameRoom) {
        this.gameRoom = gameRoom;
        this.syncStrategies = {
            'position': this.syncPosition.bind(this),
            'health': this.syncImmediate.bind(this),
            'inventory': this.syncLazy.bind(this)
        };
    }
    
    // ä½ç½®åŒæ­¥ï¼šæ’å€¼å¹³æ»‘
    syncPosition(playerId, newPosition) {
        const player = this.gameRoom.players.get(playerId);
        
        // å®¢æˆ·ç«¯é¢„æµ‹ + æœåŠ¡å™¨æ ¡æ­£
        if (this.isReasonablePosition(newPosition, player.lastPosition)) {
            player.x = newPosition.x;
            player.y = newPosition.y;
        } else {
            // ä½ç½®å¼‚å¸¸ï¼Œå¼ºåˆ¶æ ¡æ­£
            this.sendPositionCorrection(playerId, player);
        }
    }
    
    // ç«‹å³åŒæ­¥ï¼šé‡è¦çŠ¶æ€å˜åŒ–
    syncImmediate(playerId, data) {
        // ç”Ÿå‘½å€¼å˜åŒ–ç­‰é‡è¦ä¿¡æ¯ç«‹å³å¹¿æ’­
        this.gameRoom.broadcast({
            type: 'immediateSync',
            playerId: playerId,
            data: data
        });
    }
    
    // å»¶è¿ŸåŒæ­¥ï¼šä¸é‡è¦çš„çŠ¶æ€
    syncLazy(playerId, data) {
        // ç‰©å“æ å˜åŒ–ç­‰ä¸ç´§æ€¥ä¿¡æ¯æ‰¹é‡å‘é€
        this.pendingUpdates.push({
            playerId: playerId,
            data: data,
            timestamp: Date.now()
        });
    }
}
```

### 5.4 æ¸¸æˆé€šä¿¡æ¶æ„


```
æ¸¸æˆå®¢æˆ·ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç©å®¶A â”‚ ç©å®¶B â”‚ ç©å®¶C â”‚ ç©å®¶D â”‚ ... â”‚
â”‚ è¾“å…¥  â”‚ è¾“å…¥  â”‚ è¾“å…¥  â”‚ è¾“å…¥  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†• WebSocket (ä½å»¶è¿Ÿ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ¸¸æˆæœåŠ¡å™¨                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ¸¸æˆé€»è¾‘å¼•æ“ â”‚ â”‚ çŠ¶æ€åŒæ­¥å¼•æ“ â”‚ â”‚
â”‚  â”‚ ç‰©ç†æ¨¡æ‹Ÿ     â”‚ â”‚ å†²çªè§£å†³     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ¸¸æˆæ•°æ®å­˜å‚¨ + æ’è¡Œæ¦œ + ç»Ÿè®¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ğŸ“º ç›´æ’­å¼¹å¹•ç³»ç»Ÿ


### 6.1 ä»€ä¹ˆæ˜¯ç›´æ’­å¼¹å¹•ç³»ç»Ÿ


**ğŸ”¸ å¼¹å¹•çš„ç‰¹ç‚¹**
```
æƒ³è±¡Bç«™ç›´æ’­é—´ï¼š
è§‚ä¼—A: "666" â†’ å¼¹å¹•é£è¿‡å±å¹•
è§‚ä¼—B: "ä¸»æ’­å‰å®³" â†’ ç´§è·Ÿç€é£è¿‡  
è§‚ä¼—C: "å…³æ³¨äº†" â†’ ç»§ç»­é£è¿‡

ç‰¹ç‚¹ï¼š
- æ¶ˆæ¯é‡å¤§ï¼ˆæ¯ç§’å‡ åƒæ¡ï¼‰
- å®æ—¶æ€§å¼ºï¼ˆå‘é€ç«‹å³æ˜¾ç¤ºï¼‰
- è§‚ä¼—äº’åŠ¨ï¼ˆç¾¤ä½“å‚ä¸æ„Ÿï¼‰
```

**ğŸ’¡ å¼¹å¹•ç³»ç»Ÿçš„æŒ‘æˆ˜**
- **é«˜å¹¶å‘** - åŒæ—¶å‡ ä¸‡äººå‘å¼¹å¹•
- **å®æ—¶æ€§** - å‘é€åç«‹å³æ˜¾ç¤º
- **æµé‡æ§åˆ¶** - é¿å…åˆ·å±å’Œæ¶æ„æ¶ˆæ¯
- **æ€§èƒ½ä¼˜åŒ–** - ä¸èƒ½å½±å“ç›´æ’­æµç•…åº¦

### 6.2 å¼¹å¹•ç³»ç»Ÿçš„æŠ€æœ¯éš¾ç‚¹


**ğŸ“Š æ•°æ®é‡çº§**
```
çƒ­é—¨ç›´æ’­é—´æ•°æ®ï¼š
åœ¨çº¿è§‚ä¼—ï¼š100,000äºº
æ´»è·ƒå‘è¨€ï¼š10%ï¼ˆ10,000äººï¼‰
å¹³å‡é¢‘ç‡ï¼šæ¯äººæ¯åˆ†é’Ÿ1æ¡
å¼¹å¹•é¢‘ç‡ï¼š10,000/60 â‰ˆ 167æ¡/ç§’

å³°å€¼æƒ…å†µï¼ˆç²¾å½©æ—¶åˆ»ï¼‰ï¼š
çŸ­æ—¶é—´å†…å¯èƒ½è¾¾åˆ°1000æ¡/ç§’ä»¥ä¸Š
```

**âš¡ ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**
```
HTTPè½®è¯¢ï¼š
æ¯ä¸ªå®¢æˆ·ç«¯æ¯ç§’è¯·æ±‚ä¸€æ¬¡è·å–æ–°å¼¹å¹•
100,000 Ã— 1 = 100,000æ¬¡è¯·æ±‚/ç§’
æœåŠ¡å™¨å‹åŠ›å·¨å¤§ï¼Œéš¾ä»¥æ‰¿å—

WebSocketä¼˜åŠ¿ï¼š
æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ï¼Œæ— éœ€å®¢æˆ·ç«¯è¯·æ±‚
å¤§å¤§å‡å°‘æœåŠ¡å™¨å‹åŠ›
```

### 6.3 ç›´æ’­å¼¹å¹•ç³»ç»Ÿæ¶æ„


#### ğŸ’¬ **å¼¹å¹•å‘é€ä¸æ¥æ”¶**

```javascript
// å¼¹å¹•å®¢æˆ·ç«¯
class DanmakuClient {
    constructor(roomId, userId) {
        this.roomId = roomId;
        this.userId = userId;
        this.init();
    }
    
    init() {
        this.ws = new WebSocket(`ws://localhost:8080/danmaku/${this.roomId}`);
        
        this.ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            this.handleDanmaku(message);
        };
        
        this.bindSendButton();
    }
    
    // å‘é€å¼¹å¹•
    sendDanmaku(content) {
        // æœ¬åœ°è¿‡æ»¤æ£€æŸ¥
        if (!this.isValidDanmaku(content)) {
            return;
        }
        
        const danmaku = {
            type: 'danmaku',
            userId: this.userId,
            content: content,
            color: this.selectedColor,
            timestamp: Date.now()
        };
        
        this.ws.send(JSON.stringify(danmaku));
    }
    
    // å¤„ç†æ¥æ”¶åˆ°çš„å¼¹å¹•
    handleDanmaku(message) {
        switch(message.type) {
            case 'danmaku':
                this.displayDanmaku(message);
                break;
            case 'batch_danmaku':
                // æ‰¹é‡å¼¹å¹•ï¼ˆè¿½èµ¶æ¨¡å¼ï¼‰
                message.danmakus.forEach(d => this.displayDanmaku(d));
                break;
        }
    }
    
    // æ˜¾ç¤ºå¼¹å¹•åŠ¨ç”»
    displayDanmaku(danmaku) {
        const danmakuElement = document.createElement('div');
        danmakuElement.className = 'danmaku-item';
        danmakuElement.style.color = danmaku.color || '#fff';
        danmakuElement.textContent = danmaku.content;
        
        // éšæœºé€‰æ‹©å¼¹å¹•è½¨é“
        const track = this.selectTrack();
        danmakuElement.style.top = track + 'px';
        
        // æ·»åŠ åˆ°å¼¹å¹•å®¹å™¨
        this.danmakuContainer.appendChild(danmakuElement);
        
        // å¯åŠ¨é£è¡ŒåŠ¨ç”»
        this.animateDanmaku(danmakuElement);
    }
    
    // å¼¹å¹•é£è¡ŒåŠ¨ç”»
    animateDanmaku(element) {
        const containerWidth = this.danmakuContainer.offsetWidth;
        element.style.right = `-${element.offsetWidth}px`;
        
        const duration = 8000; // 8ç§’é£å®Œ
        element.animate([
            { right: `-${element.offsetWidth}px` },
            { right: `${containerWidth}px` }
        ], {
            duration: duration,
            easing: 'linear'
        }).addEventListener('finish', () => {
            element.remove();
        });
    }
}
```

#### ğŸ­ **å¼¹å¹•æœåŠ¡å™¨å¤„ç†**

```javascript
// å¼¹å¹•æˆ¿é—´ç®¡ç†
class DanmakuRoom {
    constructor(roomId) {
        this.roomId = roomId;
        this.viewers = new Set();
        this.danmakuQueue = [];
        this.rateLimit = new Map(); // ç”¨æˆ·é™æµ
        
        // æ‰¹é‡å‘é€å¼¹å¹•
        this.startBatchSending();
    }
    
    // ç”¨æˆ·åŠ å…¥æˆ¿é—´
    addViewer(userId, ws) {
        this.viewers.add({userId, ws});
        
        // å‘é€æœ€è¿‘çš„å¼¹å¹•å†å²
        this.sendRecentDanmaku(ws);
    }
    
    // å¤„ç†å¼¹å¹•æ¶ˆæ¯
    handleDanmaku(userId, danmaku) {
        // é™æµæ£€æŸ¥
        if (!this.checkRateLimit(userId)) {
            return { error: 'å‘é€å¤ªé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•' };
        }
        
        // å†…å®¹è¿‡æ»¤
        if (!this.contentFilter(danmaku.content)) {
            return { error: 'åŒ…å«ä¸å½“å†…å®¹' };
        }
        
        // æ·»åŠ åˆ°é˜Ÿåˆ—
        const processedDanmaku = {
            ...danmaku,
            userId: userId,
            id: this.generateId(),
            timestamp: Date.now()
        };
        
        this.danmakuQueue.push(processedDanmaku);
        
        // å­˜å‚¨åˆ°æ•°æ®åº“ï¼ˆå¼‚æ­¥ï¼‰
        this.saveDanmaku(processedDanmaku);
        
        return { success: true };
    }
    
    // æ‰¹é‡å‘é€å¼¹å¹•
    startBatchSending() {
        setInterval(() => {
            if (this.danmakuQueue.length > 0) {
                const batch = this.danmakuQueue.splice(0, 50); // æ¯æ¬¡æœ€å¤š50æ¡
                
                this.broadcastToViewers({
                    type: 'batch_danmaku',
                    danmakus: batch
                });
            }
        }, 200); // æ¯200mså‘é€ä¸€æ‰¹
    }
    
    // é™æµæ§åˆ¶
    checkRateLimit(userId) {
        const now = Date.now();
        const userLimit = this.rateLimit.get(userId) || [];
        
        // æ¸…é™¤1åˆ†é’Ÿå‰çš„è®°å½•
        const recentMessages = userLimit.filter(time => now - time < 60000);
        
        // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼ˆæ¯åˆ†é’Ÿæœ€å¤š20æ¡ï¼‰
        if (recentMessages.length >= 20) {
            return false;
        }
        
        recentMessages.push(now);
        this.rateLimit.set(userId, recentMessages);
        return true;
    }
    
    // å†…å®¹è¿‡æ»¤
    contentFilter(content) {
        const forbidden = ['åƒåœ¾è¯1', 'åƒåœ¾è¯2']; // å®é™…åº”è¯¥æ˜¯æ›´å®Œå–„çš„è¿‡æ»¤ç³»ç»Ÿ
        return !forbidden.some(word => content.includes(word));
    }
}
```

#### ğŸ¨ **å¼¹å¹•è½¨é“ç®¡ç†**

```javascript
// å¼¹å¹•è½¨é“ç³»ç»Ÿ
class DanmakuTrackManager {
    constructor(containerHeight) {
        this.trackHeight = 30;
        this.trackCount = Math.floor(containerHeight / this.trackHeight);
        this.tracks = Array(this.trackCount).fill().map(() => ({
            occupied: false,
            lastUsed: 0
        }));
    }
    
    // é€‰æ‹©å¯ç”¨è½¨é“
    selectTrack() {
        const now = Date.now();
        
        // æŸ¥æ‰¾ç©ºé—²è½¨é“
        for (let i = 0; i < this.tracks.length; i++) {
            if (!this.tracks[i].occupied || 
                now - this.tracks[i].lastUsed > 3000) {
                
                this.tracks[i].occupied = true;
                this.tracks[i].lastUsed = now;
                
                // 3ç§’åé‡Šæ”¾è½¨é“
                setTimeout(() => {
                    this.tracks[i].occupied = false;
                }, 3000);
                
                return i * this.trackHeight;
            }
        }
        
        // æ‰€æœ‰è½¨é“éƒ½å ç”¨ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª
        const randomTrack = Math.floor(Math.random() * this.trackCount);
        return randomTrack * this.trackHeight;
    }
    
    // åŠ¨æ€è°ƒæ•´è½¨é“æ•°é‡
    adjustTrackCount(newHeight) {
        const newTrackCount = Math.floor(newHeight / this.trackHeight);
        
        if (newTrackCount > this.trackCount) {
            // å¢åŠ è½¨é“
            for (let i = this.trackCount; i < newTrackCount; i++) {
                this.tracks.push({
                    occupied: false,
                    lastUsed: 0
                });
            }
        } else if (newTrackCount < this.trackCount) {
            // å‡å°‘è½¨é“
            this.tracks = this.tracks.slice(0, newTrackCount);
        }
        
        this.trackCount = newTrackCount;
    }
}
```

### 6.4 å¼¹å¹•ç³»ç»Ÿæ¶æ„


```
ç›´æ’­è§‚ä¼—ç«¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§‚ä¼—A â”‚ è§‚ä¼—B â”‚ è§‚ä¼—C â”‚ ... â”‚ è§‚ä¼—N  â”‚
â”‚ å‘å¼¹å¹• â”‚ çœ‹å¼¹å¹• â”‚ äº’åŠ¨  â”‚     â”‚ å‚ä¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†• WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¼¹å¹•æœåŠ¡å™¨é›†ç¾¤               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ¶ˆæ¯é˜Ÿåˆ—å¤„ç† â”‚ â”‚ å†…å®¹è¿‡æ»¤ç³»ç»Ÿ â”‚ â”‚
â”‚  â”‚ é™æµæ§åˆ¶     â”‚ â”‚ è½¨é“åˆ†é…     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å¼¹å¹•å­˜å‚¨ + ç”¨æˆ·ç®¡ç† + ç»Ÿè®¡åˆ†æ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ğŸ“ˆ è‚¡ç¥¨è¡Œæƒ…æ¨é€


### 7.1 ä»€ä¹ˆæ˜¯è‚¡ç¥¨è¡Œæƒ…æ¨é€


**ğŸ”¸ è‚¡ç¥¨æ•°æ®çš„ç‰¹ç‚¹**
```
è‚¡ç¥¨ä»·æ ¼å˜åŒ–ï¼š
è‹¹æœå…¬å¸è‚¡ç¥¨: $150.25 â†’ $150.30 â†’ $150.28
å˜åŒ–é¢‘ç‡: æ¯ç§’å¯èƒ½å˜åŒ–å‡ æ¬¡ç”šè‡³å‡ åæ¬¡
æ•°æ®é‡è¦æ€§: æ¯ä¸€åˆ†æ¯ä¸€ç§’çš„ä»·æ ¼éƒ½å½±å“æŠ•èµ„å†³ç­–
```

**ğŸ’¡ å®æ—¶æ€§è¦æ±‚**
- **æ¯«ç§’çº§å»¶è¿Ÿ** - æ™šä¸€ç§’å¯èƒ½æŸå¤±å·¨å¤§
- **æ•°æ®å‡†ç¡®** - ä»·æ ¼é”™è¯¯ä¼šè¯¯å¯¼æŠ•èµ„
- **é«˜é¢‘æ›´æ–°** - äº¤æ˜“æ—¶é—´å†…æŒç»­æ¨é€
- **å¤§å¹¶å‘** - æ•°ä¸‡äººåŒæ—¶çœ‹åŒä¸€åªè‚¡ç¥¨

### 7.2 ä¸ºä»€ä¹ˆéœ€è¦WebSocket


**ğŸ“‰ ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**
```
HTTPè½®è¯¢è‚¡ç¥¨ä»·æ ¼ï¼š

æŠ•èµ„è€…: "è‹¹æœè‚¡ç¥¨ç°ä»·å¤šå°‘ï¼Ÿ"
æœåŠ¡å™¨: "$150.25"

(5ç§’å)
æŠ•èµ„è€…: "ç°åœ¨å¤šå°‘ï¼Ÿ"  
æœåŠ¡å™¨: "$150.30"ï¼ˆå®é™…å¯èƒ½å·²ç»å˜äº†å¥½å‡ æ¬¡ï¼‰

é—®é¢˜ï¼šé”™è¿‡ä¸­é—´çš„ä»·æ ¼å˜åŒ–ï¼Œå¯èƒ½é”™å¤±äº¤æ˜“æœºä¼š
```

**âš¡ WebSocketå®æ—¶æ¨é€**
```
å®æ—¶è¡Œæƒ…æ¨é€ï¼š

è‚¡ä»·å˜åŒ–: $150.25 â†’ ç«‹å³æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…
è‚¡ä»·å˜åŒ–: $150.30 â†’ ç«‹å³æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…  
è‚¡ä»·å˜åŒ–: $150.28 â†’ ç«‹å³æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…

ä¼˜åŠ¿ï¼šæ¯æ¬¡å˜åŒ–éƒ½èƒ½å®æ—¶çŸ¥é“ï¼Œä¸é”™è¿‡ä»»ä½•æœºä¼š
```

### 7.3 è‚¡ç¥¨è¡Œæƒ…å®æ—¶æ¨é€


#### ğŸ“Š **è¡Œæƒ…æ•°æ®è®¢é˜…**

```javascript
// è‚¡ç¥¨è¡Œæƒ…å®¢æˆ·ç«¯
class StockPriceClient {
    constructor() {
        this.subscriptions = new Set(); // è®¢é˜…çš„è‚¡ç¥¨ä»£ç 
        this.priceData = new Map();     // è‚¡ç¥¨ä»·æ ¼æ•°æ®
        this.init();
    }
    
    init() {
        this.ws = new WebSocket('ws://localhost:8080/stock-price');
        
        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.handlePriceUpdate(data);
        };
        
        this.ws.onopen = () => {
            // é‡æ–°è®¢é˜…ä¹‹å‰å…³æ³¨çš„è‚¡ç¥¨
            this.resubscribeAll();
        };
    }
    
    // è®¢é˜…è‚¡ç¥¨
    subscribe(stockCode) {
        this.subscriptions.add(stockCode);
        
        const message = {
            type: 'subscribe',
            stockCode: stockCode
        };
        
        this.ws.send(JSON.stringify(message));
    }
    
    // å–æ¶ˆè®¢é˜…
    unsubscribe(stockCode) {
        this.subscriptions.delete(stockCode);
        
        const message = {
            type: 'unsubscribe',
            stockCode: stockCode
        };
        
        this.ws.send(JSON.stringify(message));
    }
    
    // å¤„ç†ä»·æ ¼æ›´æ–°
    handlePriceUpdate(data) {
        if (data.type === 'price_update') {
            const { stockCode, price, change, volume, timestamp } = data;
            
            // æ›´æ–°æœ¬åœ°æ•°æ®
            const oldData = this.priceData.get(stockCode);
            this.priceData.set(stockCode, {
                price: price,
                change: change,
                volume: volume,
                timestamp: timestamp,
                trend: this.calculateTrend(oldData, price)
            });
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            this.updatePriceDisplay(stockCode);
            
            // æ£€æŸ¥ä»·æ ¼å‘Šè­¦
            this.checkPriceAlert(stockCode, price);
        }
    }
    
    // è®¡ç®—ä»·æ ¼è¶‹åŠ¿
    calculateTrend(oldData, newPrice) {
        if (!oldData) return 'neutral';
        
        if (newPrice > oldData.price) return 'up';
        if (newPrice < oldData.price) return 'down';
        return 'neutral';
    }
    
    // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
    updatePriceDisplay(stockCode) {
        const data = this.priceData.get(stockCode);
        const element = document.getElementById(`stock-${stockCode}`);
        
        if (element) {
            element.innerHTML = `
                <div class="stock-price ${data.trend}">
                    <span class="code">${stockCode}</span>
                    <span class="price">$${data.price}</span>
                    <span class="change ${data.change >= 0 ? 'positive' : 'negative'}">
                        ${data.change >= 0 ? '+' : ''}${data.change}
                    </span>
                </div>
            `;
            
            // æ·»åŠ é—ªçƒæ•ˆæœ
            element.classList.add('updated');
            setTimeout(() => element.classList.remove('updated'), 500);
        }
    }
}
```

#### ğŸ­ **è¡Œæƒ…æ•°æ®æœåŠ¡å™¨**

```javascript
// è‚¡ç¥¨è¡Œæƒ…æœåŠ¡å™¨
class StockPriceServer {
    constructor() {
        this.subscriptions = new Map(); // stockCode -> Set of WebSocket connections
        this.priceFeeds = new Map();    // ä»·æ ¼æ•°æ®æº
        this.startPriceFeeds();
    }
    
    // å¯åŠ¨ä»·æ ¼æ•°æ®æº
    startPriceFeeds() {
        // æ¨¡æ‹Ÿä»äº¤æ˜“æ‰€è·å–å®æ—¶æ•°æ®
        setInterval(() => {
            this.updatePrices();
        }, 100); // æ¯100msæ›´æ–°ä¸€æ¬¡
    }
    
    // æ›´æ–°è‚¡ç¥¨ä»·æ ¼
    updatePrices() {
        const activeStocks = Array.from(this.subscriptions.keys());
        
        activeStocks.forEach(stockCode => {
            const newPrice = this.generatePrice(stockCode);
            const oldPrice = this.priceFeeds.get(stockCode)?.price || newPrice;
            
            const priceData = {
                stockCode: stockCode,
                price: newPrice,
                change: newPrice - oldPrice,
                volume: Math.floor(Math.random() * 1000000),
                timestamp: Date.now()
            };
            
            this.priceFeeds.set(stockCode, priceData);
            
            // æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…
            this.broadcastPrice(stockCode, priceData);
        });
    }
    
    // ç”Ÿæˆæ¨¡æ‹Ÿä»·æ ¼ï¼ˆå®é™…åº”è¯¥ä»äº¤æ˜“æ‰€APIè·å–ï¼‰
    generatePrice(stockCode) {
        const basePrice = this.getBasePrice(stockCode);
        const volatility = 0.001; // 0.1%çš„æ³¢åŠ¨
        const change = (Math.random() - 0.5) * 2 * volatility;
        
        return Math.round((basePrice * (1 + change)) * 100) / 100;
    }
    
    // å¤„ç†å®¢æˆ·ç«¯è®¢é˜…
    handleSubscription(ws, message) {
        const { type, stockCode } = message;
        
        if (type === 'subscribe') {
            // æ·»åŠ è®¢é˜…
            if (!this.subscriptions.has(stockCode)) {
                this.subscriptions.set(stockCode, new Set());
            }
            this.subscriptions.get(stockCode).add(ws);
            
            // å‘é€å½“å‰ä»·æ ¼
            const currentPrice = this.priceFeeds.get(stockCode);
            if (currentPrice) {
                ws.send(JSON.stringify({
                    type: 'price_update',
                    ...currentPrice
                }));
            }
            
        } else if (type === 'unsubscribe') {
            // å–æ¶ˆè®¢é˜…
            const subscribers = this.subscriptions.get(stockCode);
            if (subscribers) {
                subscribers.delete(ws);
                if (subscribers.size === 0) {
                    this.subscriptions.delete(stockCode);
                }
            }
        }
    }
    
    // å¹¿æ’­ä»·æ ¼æ›´æ–°
    broadcastPrice(stockCode, priceData) {
        const subscribers = this.subscriptions.get(stockCode);
        
        if (subscribers) {
            const message = JSON.stringify({
                type: 'price_update',
                ...priceData
            });
            
            subscribers.forEach(ws => {
                if (ws.readyState === WebSocket.OPEN) {
                    ws.send(message);
                }
            });
        }
    }
}
```

#### âš ï¸ **ä»·æ ¼å‘Šè­¦ç³»ç»Ÿ**

```javascript
// ä»·æ ¼å‘Šè­¦ç®¡ç†
class PriceAlertManager {
    constructor(stockClient) {
        this.stockClient = stockClient;
        this.alerts = new Map(); // userId -> alerts
        this.init();
    }
    
    // åˆ›å»ºä»·æ ¼å‘Šè­¦
    createAlert(userId, stockCode, condition, targetPrice) {
        const alertId = this.generateAlertId();
        const alert = {
            id: alertId,
            userId: userId,
            stockCode: stockCode,
            condition: condition, // 'above', 'below'
            targetPrice: targetPrice,
            isActive: true,
            createTime: Date.now()
        };
        
        if (!this.alerts.has(userId)) {
            this.alerts.set(userId, []);
        }
        
        this.alerts.get(userId).push(alert);
        
        // è®¢é˜…è‚¡ç¥¨ä»·æ ¼æ›´æ–°
        this.stockClient.subscribe(stockCode);
        
        return alertId;
    }
    
    // æ£€æŸ¥ä»·æ ¼å‘Šè­¦
    checkPriceAlert(stockCode, currentPrice) {
        this.alerts.forEach((userAlerts, userId) => {
            userAlerts.forEach(alert => {
                if (alert.stockCode === stockCode && alert.isActive) {
                    let shouldAlert = false;
                    
                    if (alert.condition === 'above' && currentPrice >= alert.targetPrice) {
                        shouldAlert = true;
                    } else if (alert.condition === 'below' && currentPrice <= alert.targetPrice) {
                        shouldAlert = true;
                    }
                    
                    if (shouldAlert) {
                        this.triggerAlert(alert, currentPrice);
                        alert.isActive = false; // é¿å…é‡å¤å‘Šè­¦
                    }
                }
            });
        });
    }
    
    // è§¦å‘å‘Šè­¦é€šçŸ¥
    triggerAlert(alert, currentPrice) {
        const message = {
            type: 'price_alert',
            stockCode: alert.stockCode,
            condition: alert.condition,
            targetPrice: alert.targetPrice,
            currentPrice: currentPrice,
            message: `${alert.stockCode} ä»·æ ¼å·²${alert.condition === 'above' ? 'è¾¾åˆ°' : 'è·Œè‡³'} ${currentPrice}`
        };
        
        // å‘é€å‘Šè­¦é€šçŸ¥ï¼ˆå¯ä»¥é€šè¿‡WebSocketã€é‚®ä»¶ã€çŸ­ä¿¡ç­‰æ–¹å¼ï¼‰
        this.sendAlertNotification(alert.userId, message);
    }
}
```

#### ğŸ“ˆ **å®æ—¶Kçº¿å›¾è¡¨**

```javascript
// å®æ—¶Kçº¿å›¾è¡¨
class RealtimeKLineChart {
    constructor(containerId, stockCode) {
        this.container = document.getElementById(containerId);
        this.stockCode = stockCode;
        this.priceHistory = [];
        this.candleData = [];
        this.init();
    }
    
    init() {
        this.canvas = document.createElement('canvas');
        this.canvas.width = 800;
        this.canvas.height = 400;
        this.container.appendChild(this.canvas);
        
        this.ctx = this.canvas.getContext('2d');
        
        // è®¢é˜…è‚¡ç¥¨ä»·æ ¼
        this.stockClient = new StockPriceClient();
        this.stockClient.subscribe(this.stockCode);
        
        // ç›‘å¬ä»·æ ¼æ›´æ–°
        this.stockClient.onPriceUpdate = (data) => {
            if (data.stockCode === this.stockCode) {
                this.updateChart(data);
            }
        };
    }
    
    // æ›´æ–°å›¾è¡¨æ•°æ®
    updateChart(priceData) {
        this.priceHistory.push({
            price: priceData.price,
            timestamp: priceData.timestamp,
            volume: priceData.volume
        });
        
        // ä¿æŒæœ€è¿‘1000ä¸ªæ•°æ®ç‚¹
        if (this.priceHistory.length > 1000) {
            this.priceHistory.shift();
        }
        
        // ç”ŸæˆKçº¿æ•°æ®ï¼ˆä»¥1åˆ†é’Ÿä¸ºå‘¨æœŸï¼‰
        this.updateCandleData();
        
        // é‡ç»˜å›¾è¡¨
        this.draw();
    }
    
    // æ›´æ–°Kçº¿æ•°æ®
    updateCandleData() {
        const now = Date.now();
        const oneMinute = 60 * 1000;
        const currentCandle = Math.floor(now / oneMinute) * oneMinute;
        
        // è·å–å½“å‰åˆ†é’Ÿçš„ä»·æ ¼æ•°æ®
        const currentMinutePrices = this.priceHistory.filter(p => 
            Math.floor(p.timestamp / oneMinute) * oneMinute === currentCandle
        );
        
        if (currentMinutePrices.length > 0) {
            const prices = currentMinutePrices.map(p => p.price);
            const volumes = currentMinutePrices.map(p => p.volume);
            
            const candleIndex = this.candleData.findIndex(c => c.time === currentCandle);
            const newCandle = {
                time: currentCandle,
                open: prices[0],
                high: Math.max(...prices),
                low: Math.min(...prices),
                close: prices[prices.length - 1],
                volume: volumes.reduce((sum, v) => sum + v, 0)
            };
            
            if (candleIndex >= 0) {
                // æ›´æ–°ç°æœ‰Kçº¿
                this.candleData[candleIndex] = newCandle;
            } else {
                // æ·»åŠ æ–°Kçº¿
                this.candleData.push(newCandle);
            }
        }
    }
    
    // ç»˜åˆ¶Kçº¿å›¾
    draw() {
        const ctx = this.ctx;
        const canvas = this.canvas;
        
        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (this.candleData.length < 2) return;
        
        const candleWidth = canvas.width / this.candleData.length * 0.8;
        const prices = this.candleData.flatMap(c => [c.high, c.low]);
        const minPrice = Math.min(...prices);
        const maxPrice = Math.max(...prices);
        const priceRange = maxPrice - minPrice;
        
        // ç»˜åˆ¶Kçº¿
        this.candleData.forEach((candle, index) => {
            const x = index * (canvas.width / this.candleData.length);
            
            const openY = canvas.height - ((candle.open - minPrice) / priceRange) * canvas.height;
            const closeY = canvas.height - ((candle.close - minPrice) / priceRange) * canvas.height;
            const highY = canvas.height - ((candle.high - minPrice) / priceRange) * canvas.height;
            const lowY = canvas.height - ((candle.low - minPrice) / priceRange) * canvas.height;
            
            // ç¡®å®šé¢œè‰²ï¼ˆçº¢æ¶¨ç»¿è·Œï¼‰
            const isRising = candle.close > candle.open;
            ctx.fillStyle = isRising ? '#00ff00' : '#ff0000';
            ctx.strokeStyle = isRising ? '#00ff00' : '#ff0000';
            
            // ç»˜åˆ¶å½±çº¿
            ctx.beginPath();
            ctx.moveTo(x + candleWidth/2, highY);
            ctx.lineTo(x + candleWidth/2, lowY);
            ctx.stroke();
            
            // ç»˜åˆ¶å®ä½“
            const bodyTop = Math.min(openY, closeY);
            const bodyHeight = Math.abs(openY - closeY);
            ctx.fillRect(x, bodyTop, candleWidth, bodyHeight);
        });
    }
}
```

### 7.4 è‚¡ç¥¨è¡Œæƒ…ç³»ç»Ÿæ¶æ„


```
äº¤æ˜“æ‰€æ•°æ®æº
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº³æ–¯è¾¾å…‹ â”‚ çº½äº¤æ‰€ â”‚ ä¸Šäº¤æ‰€ â”‚ æ·±äº¤æ‰€  â”‚
â”‚ å®æ—¶æŠ¥ä»· â”‚ æˆäº¤é‡ â”‚ ä¹°å–ç›˜ â”‚ æŒ‡æ•°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ æ•°æ®æ¥å…¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è¡Œæƒ…æœåŠ¡å™¨é›†ç¾¤               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ•°æ®æ¸…æ´—å¤„ç† â”‚ â”‚ è®¢é˜…ç®¡ç†ç³»ç»Ÿ â”‚ â”‚
â”‚  â”‚ å‘Šè­¦å¼•æ“     â”‚ â”‚ æ¨é€åˆ†å‘     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ WebSocketå®æ—¶æ¨é€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æŠ•èµ„è€…ç»ˆç«¯                       â”‚
â”‚  å®æ—¶è¡Œæƒ… â”‚ Kçº¿å›¾è¡¨ â”‚ ä»·æ ¼å‘Šè­¦       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ğŸ”„ åœºæ™¯é€‰å‹å¯¹æ¯”


### 8.1 ä¸åŒåœºæ™¯çš„æŠ€æœ¯ç‰¹ç‚¹å¯¹æ¯”


| **åº”ç”¨åœºæ™¯** | **å®æ—¶æ€§è¦æ±‚** | **å¹¶å‘é‡** | **æ•°æ®é¢‘ç‡** | **æ ¸å¿ƒæŒ‘æˆ˜** |
|-------------|---------------|-----------|-------------|-------------|
| ğŸ’¬ **å³æ—¶èŠå¤©** | `é«˜(1-2ç§’)` | `ä¸­ç­‰(åƒçº§)` | `ä¸­ç­‰` | `æ¶ˆæ¯è·¯ç”±ï¼Œç¦»çº¿å­˜å‚¨` |
| ğŸ”” **å®æ—¶é€šçŸ¥** | `ä¸­ç­‰(2-5ç§’)` | `é«˜(ä¸‡çº§)` | `ä½-ä¸­ç­‰` | `å¤§è§„æ¨¡æ¨é€ï¼Œåˆ†ç±»ç®¡ç†` |
| ğŸ¤ **åœ¨çº¿åä½œ** | `æé«˜(<1ç§’)` | `ä½(åçº§)` | `æé«˜` | `å†²çªè§£å†³ï¼ŒçŠ¶æ€åŒæ­¥` |
| ğŸ“Š **æ•°æ®ç›‘æ§** | `ä¸­ç­‰(1-5ç§’)` | `ä¸­ç­‰(ç™¾çº§)` | `é«˜` | `æ•°æ®å¯è§†åŒ–ï¼Œå‘Šè­¦æœºåˆ¶` |
| ğŸ® **åœ¨çº¿æ¸¸æˆ** | `æé«˜(<50ms)` | `ä¸­ç­‰(ç™¾çº§)` | `æé«˜` | `ä½å»¶è¿Ÿï¼ŒçŠ¶æ€ä¸€è‡´æ€§` |
| ğŸ“º **ç›´æ’­å¼¹å¹•** | `é«˜(1ç§’å†…)` | `æé«˜(åä¸‡çº§)` | `æé«˜` | `é«˜å¹¶å‘ï¼Œæµé‡æ§åˆ¶` |
| ğŸ“ˆ **è‚¡ç¥¨è¡Œæƒ…** | `æé«˜(<100ms)` | `é«˜(ä¸‡çº§)` | `æé«˜` | `æ•°æ®å‡†ç¡®æ€§ï¼Œæ¯«ç§’çº§æ¨é€` |

### 8.2 æŠ€æœ¯é€‰å‹å»ºè®®


#### ğŸ¯ **æ ¹æ®å®æ—¶æ€§è¦æ±‚é€‰æ‹©**


**âš¡ æé«˜å®æ—¶æ€§ï¼ˆ<100msï¼‰**
```
é€‚ç”¨åœºæ™¯ï¼šåœ¨çº¿æ¸¸æˆã€è‚¡ç¥¨äº¤æ˜“ã€åä½œç¼–è¾‘

æŠ€æœ¯æ–¹æ¡ˆï¼š
âœ… WebSocket + ä¸“ç”¨åè®®
âœ… æœåŠ¡å™¨ç«¯ä¼˜åŒ–ï¼ˆC++/Rustï¼‰
âœ… å†…å­˜æ•°æ®åº“ï¼ˆRedisï¼‰
âœ… CDNè¾¹ç¼˜è®¡ç®—
âŒ é¿å…å¤æ‚çš„æ•°æ®å¤„ç†
```

**ğŸ”¥ é«˜å®æ—¶æ€§ï¼ˆ1-2ç§’ï¼‰**
```
é€‚ç”¨åœºæ™¯ï¼šå³æ—¶èŠå¤©ã€ç›´æ’­å¼¹å¹•

æŠ€æœ¯æ–¹æ¡ˆï¼š
âœ… WebSocket + JSONåè®®
âœ… Node.js/GoæœåŠ¡å™¨
âœ… æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQ/Kafkaï¼‰
âœ… æ•°æ®åº“è¯»å†™åˆ†ç¦»
```

**ğŸ“Š ä¸­ç­‰å®æ—¶æ€§ï¼ˆ2-5ç§’ï¼‰**
```
é€‚ç”¨åœºæ™¯ï¼šå®æ—¶é€šçŸ¥ã€ç›‘æ§å‘Šè­¦

æŠ€æœ¯æ–¹æ¡ˆï¼š
âœ… WebSocketæˆ–Server-Sent Events
âœ… å¸¸è§„WebæœåŠ¡å™¨ï¼ˆJava/Pythonï¼‰
âœ… å…³ç³»å‹æ•°æ®åº“
âœ… ç¼“å­˜å±‚ä¼˜åŒ–
```

#### ğŸ—ï¸ **æ ¹æ®å¹¶å‘é‡é€‰æ‹©æ¶æ„**


**ğŸ”¥ è¶…é«˜å¹¶å‘ï¼ˆ10ä¸‡+ï¼‰**
```
æ¶æ„ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è´Ÿè½½å‡è¡¡å™¨     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WebSocketé›†ç¾¤   â”‚ â† æ°´å¹³æ‰©å±•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ¶ˆæ¯ä¸­é—´ä»¶     â”‚ â† å¼‚æ­¥å¤„ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åˆ†å¸ƒå¼å­˜å‚¨     â”‚ â† æ•°æ®åˆ†ç‰‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®æŠ€æœ¯ï¼š
â€¢ è¿æ¥æ± ç®¡ç†
â€¢ æ¶ˆæ¯é˜Ÿåˆ—
â€¢ æ•°æ®åº“åˆ†ç‰‡
â€¢ ç¼“å­˜ç­–ç•¥
```

**ğŸ“ˆ ä¸­ç­‰å¹¶å‘ï¼ˆ1ä¸‡-10ä¸‡ï¼‰**
```
æ¶æ„ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åå‘ä»£ç†       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¤šå®ä¾‹éƒ¨ç½²      â”‚ â† å‚ç›´+æ°´å¹³æ‰©å±•
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸»ä»æ•°æ®åº“      â”‚ â† è¯»å†™åˆ†ç¦»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®æŠ€æœ¯ï¼š
â€¢ è¿›ç¨‹æ± /çº¿ç¨‹æ± 
â€¢ æ•°æ®åº“ä¼˜åŒ–
â€¢ ç¼“å­˜å±‚
â€¢ ç›‘æ§å‘Šè­¦
```

### 8.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”


#### ğŸ“Š **ä¸åŒåœºæ™¯çš„ä¼˜åŒ–é‡ç‚¹**


```
èŠå¤©åº”ç”¨ä¼˜åŒ–é‡ç‚¹ï¼š
ğŸ”¸ æ¶ˆæ¯è·¯ç”±æ•ˆç‡
ğŸ”¸ ç¦»çº¿æ¶ˆæ¯å­˜å‚¨
ğŸ”¸ ç¾¤èŠæ€§èƒ½ä¼˜åŒ–
ğŸ”¸ æ–‡ä»¶ä¼ è¾“ä¼˜åŒ–

åä½œå·¥å…·ä¼˜åŒ–é‡ç‚¹ï¼š
ğŸ”¸ å†²çªè§£å†³ç®—æ³•
ğŸ”¸ æ“ä½œè½¬æ¢æ•ˆç‡
ğŸ”¸ çŠ¶æ€åŒæ­¥æœºåˆ¶
ğŸ”¸ æ’¤é”€/é‡åšåŠŸèƒ½

æ¸¸æˆåº”ç”¨ä¼˜åŒ–é‡ç‚¹ï¼š
ğŸ”¸ ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–
ğŸ”¸ å®¢æˆ·ç«¯é¢„æµ‹
ğŸ”¸ æœåŠ¡å™¨æƒå¨æ€§
ğŸ”¸ ä½œå¼Šæ£€æµ‹æœºåˆ¶

ç›‘æ§ç³»ç»Ÿä¼˜åŒ–é‡ç‚¹ï¼š
ğŸ”¸ æ•°æ®é‡‡é›†æ•ˆç‡
ğŸ”¸ å®æ—¶è®¡ç®—ä¼˜åŒ–
ğŸ”¸ å›¾è¡¨æ¸²æŸ“æ€§èƒ½
ğŸ”¸ å†å²æ•°æ®å‹ç¼©

å¼¹å¹•ç³»ç»Ÿä¼˜åŒ–é‡ç‚¹ï¼š
ğŸ”¸ é«˜å¹¶å‘å¤„ç†
ğŸ”¸ é™æµé˜²åˆ·ç­–ç•¥
ğŸ”¸ å†…å®¹è¿‡æ»¤æ•ˆç‡
ğŸ”¸ å®¢æˆ·ç«¯æ¸²æŸ“ä¼˜åŒ–
```

#### âš¡ **é€šç”¨ä¼˜åŒ–ç­–ç•¥**


**ğŸ”§ æœåŠ¡å™¨ç«¯ä¼˜åŒ–**
```javascript
// è¿æ¥æ± ç®¡ç†
class ConnectionPool {
    constructor(maxConnections = 10000) {
        this.maxConnections = maxConnections;
        this.activeConnections = new Set();
        this.connectionQueue = [];
    }
    
    addConnection(ws) {
        if (this.activeConnections.size >= this.maxConnections) {
            // è¾¾åˆ°ä¸Šé™ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—æˆ–æ‹’ç»
            ws.close(1013, 'Server overloaded');
            return false;
        }
        
        this.activeConnections.add(ws);
        
        ws.on('close', () => {
            this.activeConnections.delete(ws);
            this.processQueue();
        });
        
        return true;
    }
    
    processQueue() {
        if (this.connectionQueue.length > 0 && 
            this.activeConnections.size < this.maxConnections) {
            const waitingWs = this.connectionQueue.shift();
            this.addConnection(waitingWs);
        }
    }
}

// æ¶ˆæ¯æ‰¹é‡å¤„ç†
class MessageBatcher {
    constructor(batchSize = 50, flushInterval = 100) {
        this.batchSize = batchSize;
        this.flushInterval = flushInterval;
        this.batch = [];
        this.timer = null;
    }
    
    addMessage(message) {
        this.batch.push(message);
        
        if (this.batch.length >= this.batchSize) {
            this.flush();
        } else if (!this.timer) {
            this.timer = setTimeout(() => this.flush(), this.flushInterval);
        }
    }
    
    flush() {
        if (this.batch.length > 0) {
            this.processBatch(this.batch.splice(0));
        }
        
        if (this.timer) {
            clearTimeout(this.timer);
            this.timer = null;
        }
    }
}
```

**ğŸ¨ å®¢æˆ·ç«¯ä¼˜åŒ–**
```javascript
// å®¢æˆ·ç«¯ç¼“å­˜ç®¡ç†
class ClientCache {
    constructor(maxSize = 1000) {
        this.maxSize = maxSize;
        this.cache = new Map();
        this.accessOrder = [];
    }
    
    set(key, value) {
        if (this.cache.has(key)) {
            // æ›´æ–°è®¿é—®é¡ºåº
            const index = this.accessOrder.indexOf(key);
            this.accessOrder.splice(index, 1);
        } else if (this.cache.size >= this.maxSize) {
            // LRUæ·˜æ±°
            const oldest = this.accessOrder.shift();
            this.cache.delete(oldest);
        }
        
        this.cache.set(key, value);
        this.accessOrder.push(key);
    }
    
    get(key) {
        if (this.cache.has(key)) {
            // æ›´æ–°è®¿é—®é¡ºåº
            const index = this.accessOrder.indexOf(key);
            this.accessOrder.splice(index, 1);
            this.accessOrder.push(key);
            
            return this.cache.get(key);
        }
        return null;
    }
}

// é˜²æŠ–å’ŒèŠ‚æµ
class RateLimiter {
    constructor() {
        this.lastCall = new Map();
        this.timers = new Map();
    }
    
    // é˜²æŠ–ï¼šåœ¨è¿ç»­è§¦å‘ä¸­ï¼Œåªæ‰§è¡Œæœ€åä¸€æ¬¡
    debounce(key, fn, delay = 300) {
        if (this.timers.has(key)) {
            clearTimeout(this.timers.get(key));
        }
        
        const timer = setTimeout(() => {
            fn();
            this.timers.delete(key);
        }, delay);
        
        this.timers.set(key, timer);
    }
    
    // èŠ‚æµï¼šåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œåªæ‰§è¡Œä¸€æ¬¡
    throttle(key, fn, delay = 300) {
        const now = Date.now();
        const lastCall = this.lastCall.get(key) || 0;
        
        if (now - lastCall >= delay) {
            fn();
            this.lastCall.set(key, now);
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ WebSocketé€‚ç”¨åœºæ™¯ï¼šéœ€è¦å®æ—¶åŒå‘é€šä¿¡çš„æ‰€æœ‰åº”ç”¨
ğŸ”¸ æŠ€æœ¯é€‰å‹åŸåˆ™ï¼šæ ¹æ®å®æ—¶æ€§ã€å¹¶å‘é‡ã€æ•°æ®é¢‘ç‡é€‰æ‹©æ–¹æ¡ˆ
ğŸ”¸ æ¶æ„è®¾è®¡æ€è·¯ï¼šå®¢æˆ·ç«¯+WebSocketæœåŠ¡å™¨+ä¸šåŠ¡åç«¯+æ•°æ®å­˜å‚¨
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼šè¿æ¥ç®¡ç†ã€æ¶ˆæ¯æ‰¹å¤„ç†ã€ç¼“å­˜æœºåˆ¶ã€é™æµæ§åˆ¶
ğŸ”¸ ç”¨æˆ·ä½“éªŒè®¾è®¡ï¼šå®æ—¶åé¦ˆã€çŠ¶æ€åŒæ­¥ã€å¼‚å¸¸å¤„ç†ã€æ–­çº¿é‡è¿
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®æ—¶é€šä¿¡çš„æœ¬è´¨ä»·å€¼**
```
ä¼ ç»Ÿæ–¹å¼ vs WebSocketï¼š
â€¢ HTTPè½®è¯¢ï¼šå»¶è¿Ÿå¤§ã€èµ„æºæµªè´¹ã€ä½“éªŒå·®
â€¢ WebSocketï¼šå®æ—¶ã€é«˜æ•ˆã€ç”¨æˆ·ä½“éªŒå¥½

æ ¸å¿ƒä¼˜åŠ¿ï¼š
â€¢ çœŸæ­£çš„å®æ—¶æ€§ï¼šæ¯«ç§’çº§å“åº”
â€¢ åŒå‘é€šä¿¡ï¼šæœåŠ¡å™¨ä¸»åŠ¨æ¨é€
â€¢ èµ„æºé«˜æ•ˆï¼šé¿å…æ— æ•ˆè¯·æ±‚
â€¢ ç”¨æˆ·ä½“éªŒï¼šå³æ—¶åé¦ˆå’Œäº’åŠ¨
```

**ğŸ”¹ ä¸åŒåœºæ™¯çš„å·®å¼‚åŒ–éœ€æ±‚**
```
èŠå¤©åº”ç”¨ï¼šé‡ç‚¹åœ¨æ¶ˆæ¯å¯é æ€§å’Œè·¯ç”±æ•ˆç‡
åä½œå·¥å…·ï¼šé‡ç‚¹åœ¨å†²çªè§£å†³å’ŒçŠ¶æ€åŒæ­¥  
æ¸¸æˆåº”ç”¨ï¼šé‡ç‚¹åœ¨ä½å»¶è¿Ÿå’Œæ•°æ®ä¸€è‡´æ€§
ç›‘æ§ç³»ç»Ÿï¼šé‡ç‚¹åœ¨æ•°æ®å¤„ç†å’Œå¯è§†åŒ–
å¼¹å¹•ç³»ç»Ÿï¼šé‡ç‚¹åœ¨é«˜å¹¶å‘å’Œæµé‡æ§åˆ¶
è‚¡ç¥¨è¡Œæƒ…ï¼šé‡ç‚¹åœ¨æ•°æ®å‡†ç¡®æ€§å’Œå®æ—¶æ€§
```

**ğŸ”¹ æŠ€æœ¯é€‰å‹çš„æƒè¡¡è€ƒè™‘**
```
æ€§èƒ½ vs å¤æ‚åº¦ï¼š
â€¢ é«˜æ€§èƒ½æ–¹æ¡ˆé€šå¸¸å®ç°å¤æ‚
â€¢ éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚æƒè¡¡

æˆæœ¬ vs æ•ˆæœï¼š
â€¢ è€ƒè™‘å¼€å‘æˆæœ¬ã€è¿ç»´æˆæœ¬
â€¢ é€‰æ‹©æ€§ä»·æ¯”æœ€é«˜çš„æ–¹æ¡ˆ

æ‰©å±•æ€§ vs å½“å‰éœ€æ±‚ï¼š
â€¢ ä¸ºæœªæ¥å¢é•¿é¢„ç•™ç©ºé—´
â€¢ é¿å…è¿‡åº¦è®¾è®¡
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ åœºæ™¯é€‰æ‹©å»ºè®®**
```
å¦‚æœä½ åœ¨åšï¼š

ğŸ“± ç¤¾äº¤åº”ç”¨ â†’ é€‰æ‹©å³æ—¶èŠå¤©æŠ€æœ¯
ğŸ¢ ä¼ä¸šç³»ç»Ÿ â†’ é€‰æ‹©å®æ—¶é€šçŸ¥æŠ€æœ¯  
ğŸ“ åä½œå¹³å° â†’ é€‰æ‹©åœ¨çº¿åä½œæŠ€æœ¯
ğŸ“Š ç›‘æ§å¹³å° â†’ é€‰æ‹©æ•°æ®ç›‘æ§æŠ€æœ¯
ğŸ® æ¸¸æˆå¼€å‘ â†’ é€‰æ‹©æ¸¸æˆé€šä¿¡æŠ€æœ¯
ğŸ“º ç›´æ’­å¹³å° â†’ é€‰æ‹©å¼¹å¹•ç³»ç»ŸæŠ€æœ¯
ğŸ’° é‡‘èå¹³å° â†’ é€‰æ‹©è¡Œæƒ…æ¨é€æŠ€æœ¯
```

**ğŸ”§ å®æ–½æ­¥éª¤å»ºè®®**
```
ç¬¬ä¸€æ­¥ï¼šéœ€æ±‚åˆ†æ
â€¢ æ˜ç¡®å®æ—¶æ€§è¦æ±‚
â€¢ è¯„ä¼°å¹¶å‘é‡è§„æ¨¡  
â€¢ ç¡®å®šæ ¸å¿ƒåŠŸèƒ½

ç¬¬äºŒæ­¥ï¼šæŠ€æœ¯é€‰å‹
â€¢ é€‰æ‹©åˆé€‚çš„æ¶æ„æ–¹æ¡ˆ
â€¢ ç¡®å®šæŠ€æœ¯æ ˆ
â€¢ è®¾è®¡ç³»ç»Ÿæ¶æ„

ç¬¬ä¸‰æ­¥ï¼šåŸå‹å¼€å‘
â€¢ å®ç°æ ¸å¿ƒåŠŸèƒ½
â€¢ éªŒè¯æŠ€æœ¯æ–¹æ¡ˆ
â€¢ æ€§èƒ½æµ‹è¯•

ç¬¬å››æ­¥ï¼šä¼˜åŒ–è¿­ä»£
â€¢ æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–
â€¢ å®Œå–„ç”¨æˆ·ä½“éªŒ
â€¢ å‡†å¤‡ç”Ÿäº§éƒ¨ç½²
```

**ğŸš€ æ€§èƒ½ä¼˜åŒ–è·¯çº¿**
```
åŸºç¡€ä¼˜åŒ–ï¼š
1. é€‰æ‹©åˆé€‚çš„æœåŠ¡å™¨è¯­è¨€å’Œæ¡†æ¶
2. å®ç°åŸºæœ¬çš„è¿æ¥ç®¡ç†
3. æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—å’Œç¼“å­˜

è¿›é˜¶ä¼˜åŒ–ï¼š
1. å®ç°è´Ÿè½½å‡è¡¡å’Œé›†ç¾¤éƒ¨ç½²
2. æ·»åŠ ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
3. ä¼˜åŒ–æ•°æ®åº“å’Œå­˜å‚¨

é«˜çº§ä¼˜åŒ–ï¼š
1. CDNå’Œè¾¹ç¼˜è®¡ç®—
2. è‡ªå®šä¹‰åè®®ä¼˜åŒ–
3. ç¡¬ä»¶åŠ é€Ÿå’Œä¸“ç”¨è®¾å¤‡
```

### 9.4 å­¦ä¹ å»ºè®®


**ğŸ“š å­¦ä¹ è·¯å¾„**
```
åŸºç¡€é˜¶æ®µï¼š
â€¢ æŒæ¡WebSocketåŸºæœ¬æ¦‚å¿µ
â€¢ å®ç°ç®€å•çš„èŠå¤©åº”ç”¨
â€¢ äº†è§£å¸¸è§çš„æŠ€æœ¯é—®é¢˜

è¿›é˜¶é˜¶æ®µï¼š  
â€¢ å­¦ä¹ ä¸åŒåœºæ™¯çš„å®ç°æ–¹å¼
â€¢ æŒæ¡æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯
â€¢ äº†è§£æ¶æ„è®¾è®¡æ¨¡å¼

é«˜çº§é˜¶æ®µï¼š
â€¢ æ·±å…¥ç†è§£åè®®åŸç†
â€¢ æŒæ¡å¤§è§„æ¨¡éƒ¨ç½²æŠ€æœ¯
â€¢ å…·å¤‡æ¶æ„è®¾è®¡èƒ½åŠ›
```

**ğŸ’¡ å®è·µå»ºè®®**
```
åŠ¨æ‰‹ç»ƒä¹ ï¼š
â€¢ ä»ç®€å•åœºæ™¯å¼€å§‹å®è·µ
â€¢ é€æ­¥å¢åŠ åŠŸèƒ½å¤æ‚åº¦
â€¢ æµ‹è¯•ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥

é¡¹ç›®ç»éªŒï¼š
â€¢ å‚ä¸å®é™…é¡¹ç›®å¼€å‘
â€¢ è§£å†³çœŸå®ä¸šåŠ¡é—®é¢˜
â€¢ ç§¯ç´¯è¿ç»´ç»éªŒ

æŠ€æœ¯äº¤æµï¼š
â€¢ å…³æ³¨ç›¸å…³æŠ€æœ¯ç¤¾åŒº
â€¢ å‚ä¸å¼€æºé¡¹ç›®
â€¢ åˆ†äº«å®è·µç»éªŒ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- WebSocketè®©å®æ—¶é€šä¿¡å˜å¾—ç®€å•é«˜æ•ˆ
- ä¸åŒåœºæ™¯æœ‰ä¸åŒçš„æŠ€æœ¯é‡ç‚¹å’Œä¼˜åŒ–ç­–ç•¥  
- æŠ€æœ¯é€‰å‹éœ€è¦ç»¼åˆè€ƒè™‘å¤šä¸ªå› ç´ 
- ç”¨æˆ·ä½“éªŒæ˜¯å®æ—¶åº”ç”¨çš„æ ¸å¿ƒä»·å€¼
- å®è·µæ˜¯æŒæ¡æŠ€æœ¯çš„æœ€ä½³é€”å¾„