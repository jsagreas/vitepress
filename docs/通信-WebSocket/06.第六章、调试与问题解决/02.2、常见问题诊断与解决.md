---
title: 2ã€å¸¸è§é—®é¢˜è¯Šæ–­ä¸è§£å†³
---
## ğŸ“š ç›®å½•

1. [è¿æ¥å¤±è´¥é—®é¢˜åˆ†æ](#1-è¿æ¥å¤±è´¥é—®é¢˜åˆ†æ)
2. [WebSocketé”™è¯¯ç è¯¦è§£](#2-websocketé”™è¯¯ç è¯¦è§£)
3. [å…¸å‹é—®é¢˜è¯Šæ–­æµç¨‹](#3-å…¸å‹é—®é¢˜è¯Šæ–­æµç¨‹)
4. [æ–­çº¿é‡è¿æœºåˆ¶](#4-æ–­çº¿é‡è¿æœºåˆ¶)
5. [ç½‘ç»œç¯å¢ƒé—®é¢˜æ’æŸ¥](#5-ç½‘ç»œç¯å¢ƒé—®é¢˜æ’æŸ¥)
6. [å¿ƒè·³æœºåˆ¶ä¿æ´»](#6-å¿ƒè·³æœºåˆ¶ä¿æ´»)
7. [å®‰å…¨æ³¨æ„äº‹é¡¹](#7-å®‰å…¨æ³¨æ„äº‹é¡¹)
8. [ç§»åŠ¨ç«¯å…¼å®¹æ€§](#8-ç§»åŠ¨ç«¯å…¼å®¹æ€§)
9. [ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•](#9-ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ è¿æ¥å¤±è´¥é—®é¢˜åˆ†æ


### 1.1 ä¸ºä»€ä¹ˆè¿æ¥ä¼šå¤±è´¥ï¼Ÿ


**ğŸ’¡ è¿æ¥å¤±è´¥å°±åƒæ‰“ç”µè¯æ‰“ä¸é€š**
```
æ‰“ç”µè¯æ‰“ä¸é€šçš„åŸå› ï¼š
- å¯¹æ–¹ç”µè¯å·ç é”™äº† â†’ WebSocketåœ°å€é”™è¯¯
- å¯¹æ–¹æ‰‹æœºå…³æœºäº†   â†’ æœåŠ¡å™¨æ²¡å¯åŠ¨
- ç½‘ç»œä¿¡å·ä¸å¥½     â†’ ç½‘ç»œè¿æ¥é—®é¢˜
- å¯¹æ–¹æ‹’æ¥ç”µè¯     â†’ æœåŠ¡å™¨æ‹’ç»è¿æ¥
```

### 1.2 æœ€å¸¸è§çš„è¿æ¥å¤±è´¥åŸå› 


**ğŸ”¸ åœ°å€é”™è¯¯é—®é¢˜**
```javascript
// âŒ é”™è¯¯ç¤ºä¾‹ - å¸¸è§åœ°å€é”™è¯¯
const ws1 = new WebSocket('http://localhost:8080/ws');  // ç”¨äº†httpè€Œä¸æ˜¯ws
const ws2 = new WebSocket('ws://localhost:8080');       // å°‘äº†è·¯å¾„
const ws3 = new WebSocket('ws://localhost:3000/ws');    // ç«¯å£å·å†™é”™äº†

// âœ… æ­£ç¡®ç¤ºä¾‹
const ws = new WebSocket('ws://localhost:8080/ws');

// ğŸ’¡ å°è´´å£«ï¼šæ£€æŸ¥åœ°å€çš„æ–¹æ³•
console.log('å°è¯•è¿æ¥:', 'ws://localhost:8080/ws');
```

**ğŸ”¸ æœåŠ¡å™¨æ²¡å¯åŠ¨é—®é¢˜**
```
ç°è±¡ï¼šæµè§ˆå™¨æ˜¾ç¤ºè¿æ¥å¤±è´¥
åŸå› ï¼šå°±åƒç»™å…³æœºçš„æ‰‹æœºæ‰“ç”µè¯

æ£€æŸ¥æ–¹æ³•ï¼š
1ï¸âƒ£ ç¡®è®¤æœåŠ¡å™¨ç¨‹åºæ­£åœ¨è¿è¡Œ
2ï¸âƒ£ æ£€æŸ¥æœåŠ¡å™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3ï¸âƒ£ ç”¨æµè§ˆå™¨è®¿é—® http://localhost:8080 çœ‹æœåŠ¡å™¨æ˜¯å¦å“åº”
```

**ğŸ”¸ è·¨åŸŸé—®é¢˜**
```javascript
// æµè§ˆå™¨é¡µé¢åœ¨ http://localhost:3000
// ä½†æ˜¯è¿æ¥ ws://192.168.1.100:8080
// å¯èƒ½é‡åˆ°è·¨åŸŸé™åˆ¶

// ğŸ“š éœ€è¦æŒæ¡ï¼šè·¨åŸŸå°±æ˜¯ä¸åŒç½‘å€ä¹‹é—´çš„è®¿é—®é™åˆ¶
// è§£å†³æ–¹æ¡ˆï¼šæœåŠ¡å™¨è®¾ç½®å…è®¸è·¨åŸŸ
```

### 1.3 å¿«é€Ÿè¯Šæ–­è¿æ¥é—®é¢˜


**ğŸ” è¯Šæ–­æ­¥éª¤**
```
ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
```javascript
const ws = new WebSocket('ws://localhost:8080/ws');

ws.onerror = function(error) {
    console.log('âŒ è¿æ¥å‡ºé”™äº†:', error);
    // è¿™é‡Œä¼šæ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯
};
```

**ğŸ“Š å¸¸è§é”™è¯¯ä¿¡æ¯å¯¹ç…§è¡¨**

| é”™è¯¯ä¿¡æ¯ | **é€šä¿—è§£é‡Š** | **è§£å†³æ–¹æ³•** |
|---------|------------|-------------|
| `net::ERR_CONNECTION_REFUSED` | `æœåŠ¡å™¨æ‹’ç»è¿æ¥ï¼ˆå¯èƒ½æ²¡å¯åŠ¨ï¼‰` | `æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ` |
| `net::ERR_CONNECTION_TIMED_OUT` | `è¿æ¥è¶…æ—¶ï¼ˆç½‘ç»œå¤ªæ…¢æˆ–æœåŠ¡å™¨æ— å“åº”ï¼‰` | `æ£€æŸ¥ç½‘ç»œå’ŒæœåŠ¡å™¨çŠ¶æ€` |
| `Unexpected response code: 404` | `æ‰¾ä¸åˆ°WebSocketæ¥å£` | `æ£€æŸ¥URLè·¯å¾„æ˜¯å¦æ­£ç¡®` |

---

## 2. ğŸ“ WebSocketé”™è¯¯ç è¯¦è§£


### 2.1 é”™è¯¯ç æ˜¯ä»€ä¹ˆï¼Ÿ


**ğŸ’­ é”™è¯¯ç å°±åƒåŒ»ç”Ÿçš„è¯Šæ–­ç¼–å·**
```
å°±åƒçœ‹ç—…æ—¶ï¼š
- åŒ»ç”Ÿè¯´"ä½ æ˜¯æ„Ÿå†’ï¼Œç¼–å·A01" â†’ WebSocketè¯´"è¿æ¥å…³é—­ï¼Œé”™è¯¯ç 1006"
- é€šè¿‡ç¼–å·èƒ½å¿«é€ŸçŸ¥é“å…·ä½“é—®é¢˜ â†’ é€šè¿‡é”™è¯¯ç èƒ½å¿«é€Ÿå®šä½é—®é¢˜åŸå› 
```

### 2.2 æœ€é‡è¦çš„ä¸‰ä¸ªé”™è¯¯ç 


**ğŸ”¸ é”™è¯¯ç  1006 - è¿æ¥å¼‚å¸¸å…³é—­**
```javascript
ws.onclose = function(event) {
    if (event.code === 1006) {
        console.log('âš ï¸ è¿æ¥å¼‚å¸¸å…³é—­ - æœ€å¸¸è§çš„é”™è¯¯');
        console.log('å¯èƒ½åŸå› ï¼š');
        console.log('- ç½‘ç»œçªç„¶æ–­äº†');
        console.log('- æœåŠ¡å™¨çªç„¶å…³é—­äº†');
        console.log('- æµè§ˆå™¨æ ‡ç­¾é¡µè¢«å…³é—­');
    }
};

// ğŸ’¡ ç†è§£è¦ç‚¹ï¼š1006æ˜¯æœ€å¸¸è§çš„é”™è¯¯ï¼Œé€šå¸¸æ˜¯ç½‘ç»œé—®é¢˜
```

**ğŸ”¸ é”™è¯¯ç  1001 - ç«¯ç‚¹ç¦»å¼€**
```javascript
ws.onclose = function(event) {
    if (event.code === 1001) {
        console.log('ğŸ‘‹ å¯¹æ–¹ä¸»åŠ¨ç¦»å¼€äº†');
        console.log('å°±åƒå¯¹æ–¹æŒ‚æ–­äº†ç”µè¯');
        // è¿™æ˜¯æ­£å¸¸æƒ…å†µï¼Œä¸éœ€è¦æ‹…å¿ƒ
    }
};

// ğŸ“š éœ€è¦æŒæ¡ï¼šç«¯ç‚¹å°±æ˜¯è¿æ¥çš„ä¸€ç«¯ï¼ˆä½ æˆ–æœåŠ¡å™¨ï¼‰
```

**ğŸ”¸ é”™è¯¯ç  1000 - æ­£å¸¸å…³é—­**
```javascript
ws.onclose = function(event) {
    if (event.code === 1000) {
        console.log('âœ… æ­£å¸¸å…³é—­è¿æ¥');
        console.log('å°±åƒç¤¼è²Œåœ°è¯´å†è§åæŒ‚ç”µè¯');
        // è¿™æ˜¯æœ€ç†æƒ³çš„æƒ…å†µ
    }
};
```

### 2.3 é”™è¯¯ç å¤„ç†å®è·µ


**ğŸ› ï¸ æ ¹æ®é”™è¯¯ç åšä¸åŒå¤„ç†**
```javascript
function handleConnectionClose(event) {
    console.log('è¿æ¥å…³é—­ï¼Œé”™è¯¯ç :', event.code);
    
    switch(event.code) {
        case 1000:
            console.log('âœ… æ­£å¸¸å…³é—­ï¼Œæ— éœ€é‡è¿');
            break;
            
        case 1001:
            console.log('ğŸ‘‹ å¯¹æ–¹ç¦»å¼€ï¼Œå¯ä»¥å°è¯•é‡è¿');
            attemptReconnect();
            break;
            
        case 1006:
            console.log('âš ï¸ å¼‚å¸¸æ–­å¼€ï¼Œéœ€è¦é‡è¿');
            attemptReconnect();
            break;
            
        default:
            console.log('ğŸ¤” å…¶ä»–åŸå› å…³é—­ï¼Œå°è¯•é‡è¿');
            attemptReconnect();
    }
}

// ä½¿ç”¨æ–¹æ³•
ws.onclose = handleConnectionClose;
```

---

## 3. ğŸ” å…¸å‹é—®é¢˜è¯Šæ–­æµç¨‹


### 3.1 è¿æ¥å»ºç«‹å¤±è´¥


**ğŸ“‹ è¯Šæ–­æµç¨‹å›¾**
```
è¿æ¥å¤±è´¥
    â†“
æ£€æŸ¥åœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ
    â”œâ”€ å¦ â†’ ä¿®æ­£WebSocketåœ°å€
    â†“
æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ï¼Ÿ
    â”œâ”€ å¦ â†’ å¯åŠ¨WebSocketæœåŠ¡å™¨
    â†“
æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Ÿ
    â”œâ”€ å¦ â†’ æ£€æŸ¥ç½‘ç»œè®¾ç½®
    â†“
æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Ÿ
    â”œâ”€ å¦ â†’ è°ƒæ•´é˜²ç«å¢™è§„åˆ™
    â†“
é—®é¢˜è§£å†³ âœ…
```

**ğŸ”§ å®é™…æ“ä½œæ­¥éª¤**
```javascript
// ç¬¬ä¸€æ­¥ï¼šè®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
const ws = new WebSocket('ws://localhost:8080/ws');

ws.onopen = function() {
    console.log('âœ… è¿æ¥æˆåŠŸï¼');
};

ws.onerror = function(error) {
    console.log('âŒ è¿æ¥å¤±è´¥è¯¦æƒ…:', error);
    console.log('è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥ï¼š');
    console.log('1. æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ï¼Ÿ');
    console.log('2. åœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ');
    console.log('3. ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼Ÿ');
};

ws.onclose = function(event) {
    console.log(`å…³é—­åŸå› : é”™è¯¯ç ${event.code} - ${event.reason}`);
};
```

### 3.2 æ¶ˆæ¯å‘é€å¤±è´¥


**ğŸ”¸ ä¸ºä»€ä¹ˆæ¶ˆæ¯å‘ä¸å‡ºå»ï¼Ÿ**
```javascript
// ğŸ’¡ æ¶ˆæ¯å‘é€å°±åƒå¯„ä¿¡
// ä¿¡å¯„ä¸å‡ºå»çš„åŸå› ï¼š
// 1. é‚®å±€å…³é—¨äº† â†’ WebSocketè¿æ¥æ–­äº†
// 2. åœ°å€å†™é”™äº† â†’ æ¶ˆæ¯æ ¼å¼ä¸å¯¹
// 3. ä¿¡å¤ªå¤§äº†   â†’ æ¶ˆæ¯å¤ªé•¿

function safeSendMessage(message) {
    // ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥è¿æ¥çŠ¶æ€
    if (ws.readyState !== WebSocket.OPEN) {
        console.log('âŒ è¿æ¥æœªæ‰“å¼€ï¼Œæ— æ³•å‘é€æ¶ˆæ¯');
        console.log('å½“å‰çŠ¶æ€:', getConnectionState());
        return false;
    }
    
    // ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ¶ˆæ¯å¤§å°
    if (message.length > 64 * 1024) { // 64KB
        console.log('âš ï¸ æ¶ˆæ¯å¤ªå¤§ï¼Œå»ºè®®åˆ†æ®µå‘é€');
        return false;
    }
    
    // ç¬¬ä¸‰æ­¥ï¼šå®‰å…¨å‘é€
    try {
        ws.send(message);
        console.log('âœ… æ¶ˆæ¯å‘é€æˆåŠŸ');
        return true;
    } catch (error) {
        console.log('âŒ å‘é€å¤±è´¥:', error.message);
        return false;
    }
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–è¿æ¥çŠ¶æ€è¯´æ˜
function getConnectionState() {
    const states = {
        0: 'æ­£åœ¨è¿æ¥ä¸­...',
        1: 'å·²è¿æ¥ï¼Œå¯ä»¥å‘é€æ¶ˆæ¯',
        2: 'æ­£åœ¨å…³é—­è¿æ¥...',
        3: 'è¿æ¥å·²å…³é—­'
    };
    return states[ws.readyState];
}
```

### 3.3 æ„å¤–æ–­å¼€è¿æ¥


**ğŸ”¸ è¿æ¥ä¸ºä»€ä¹ˆä¼šçªç„¶æ–­å¼€ï¼Ÿ**
```
å¸¸è§æ–­å¼€åŸå› ï¼ˆé€šä¿—ç†è§£ï¼‰ï¼š
ğŸ“± æ‰‹æœºä¿¡å·ä¸å¥½     â†’ ç½‘ç»œä¸ç¨³å®š
ğŸ”‹ æ‰‹æœºæ²¡ç”µäº†       â†’ æœåŠ¡å™¨é‡å¯äº†
ğŸ“ å¯¹æ–¹æŒ‚ç”µè¯äº†     â†’ æœåŠ¡å™¨ä¸»åŠ¨å…³é—­
ğŸƒ äººèµ°å¼€äº†         â†’ æµè§ˆå™¨æ ‡ç­¾é¡µå…³é—­
```

**ğŸ› ï¸ æ£€æµ‹å’Œå¤„ç†æ–­å¼€**
```javascript
let connectionLostTime = null;

ws.onclose = function(event) {
    connectionLostTime = new Date();
    console.log(`âš ï¸ ${connectionLostTime.toLocaleTimeString()} è¿æ¥æ–­å¼€`);
    
    // åˆ†ææ–­å¼€åŸå› 
    if (event.code === 1006) {
        console.log('å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨é—®é¢˜');
        showUserMessage('ç½‘ç»œè¿æ¥ä¸­æ–­ï¼Œæ­£åœ¨å°è¯•é‡è¿...');
    } else if (event.code === 1001) {
        console.log('æœåŠ¡å™¨ä¸»åŠ¨å…³é—­è¿æ¥');
        showUserMessage('æœåŠ¡å™¨è¿æ¥å…³é—­');
    }
    
    // å¯åŠ¨é‡è¿
    startReconnection();
};

function showUserMessage(message) {
    // å‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½çš„æç¤ºä¿¡æ¯
    console.log('ğŸ’¬ ç”¨æˆ·æç¤º:', message);
}
```

---

## 4. ğŸ”„ æ–­çº¿é‡è¿æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯æ–­çº¿é‡è¿ï¼Ÿ


**ğŸ’­ é‡è¿å°±åƒç”µè¯æ–­äº†å†æ‹¨**
```
ç”Ÿæ´»ä¸­çš„é‡è¿ï¼š
ç”µè¯çªç„¶æ–­äº† â†’ é‡æ–°æ‹¨å· â†’ ç»§ç»­èŠå¤©
ç½‘ç»œæ–­äº†    â†’ é‡æ–°è¿æ¥ â†’ ç»§ç»­é€šä¿¡

é‡è¿çš„å…³é”®ï¼š
- æ£€æµ‹åˆ°æ–­å¼€
- ç­‰å¾…ä¸€æ®µæ—¶é—´
- å°è¯•é‡æ–°è¿æ¥
- é‡è¿æˆåŠŸåæ¢å¤æ­£å¸¸
```

### 4.2 ç®€å•é‡è¿å®ç°


**ğŸ”§ åŸºç¡€é‡è¿ä»£ç **
```javascript
let reconnectAttempts = 0;        // é‡è¿å°è¯•æ¬¡æ•°
const maxReconnectAttempts = 5;   // æœ€å¤šå°è¯•5æ¬¡
let reconnectInterval = 3000;     // æ¯æ¬¡ç­‰å¾…3ç§’

function connectWebSocket() {
    const ws = new WebSocket('ws://localhost:8080/ws');
    
    ws.onopen = function() {
        console.log('ğŸ‰ è¿æ¥æˆåŠŸï¼');
        reconnectAttempts = 0; // é‡ç½®é‡è¿æ¬¡æ•°
        showUserMessage('è¿æ¥å·²æ¢å¤');
    };
    
    ws.onclose = function(event) {
        console.log('è¿æ¥å…³é—­ï¼Œå‡†å¤‡é‡è¿...');
        attemptReconnect();
    };
    
    ws.onerror = function(error) {
        console.log('è¿æ¥é”™è¯¯:', error);
    };
    
    return ws;
}

function attemptReconnect() {
    if (reconnectAttempts >= maxReconnectAttempts) {
        console.log('âŒ é‡è¿å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åå†è¯•');
        showUserMessage('æ— æ³•è¿æ¥æœåŠ¡å™¨ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        return;
    }
    
    reconnectAttempts++;
    console.log(`ğŸ”„ ç¬¬${reconnectAttempts}æ¬¡å°è¯•é‡è¿...`);
    showUserMessage(`æ­£åœ¨é‡è¿... (${reconnectAttempts}/${maxReconnectAttempts})`);
    
    setTimeout(function() {
        connectWebSocket();
    }, reconnectInterval);
}

// ğŸ’¡ å°è´´å£«ï¼šä½¿ç”¨æ–¹æ³•
let ws = connectWebSocket();
```

### 4.3 æ™ºèƒ½é‡è¿ç­–ç•¥


**ğŸ§  æ›´èªæ˜çš„é‡è¿æ–¹å¼**
```javascript
// é€’å¢å»¶è¿Ÿï¼šæ¯æ¬¡å¤±è´¥åç­‰å¾…æ—¶é—´å¢åŠ 
function getReconnectDelay(attempt) {
    const baseDelay = 1000; // åŸºç¡€å»¶è¿Ÿ1ç§’
    const maxDelay = 30000; // æœ€é•¿ç­‰å¾…30ç§’
    
    // è®¡ç®—å»¶è¿Ÿï¼š1ç§’, 2ç§’, 4ç§’, 8ç§’, 16ç§’, 30ç§’...
    const delay = Math.min(baseDelay * Math.pow(2, attempt), maxDelay);
    
    console.log(`â° ç­‰å¾… ${delay/1000} ç§’åé‡è¿`);
    return delay;
}

function smartReconnect() {
    if (reconnectAttempts >= maxReconnectAttempts) {
        console.log('âŒ è¾¾åˆ°æœ€å¤§é‡è¿æ¬¡æ•°ï¼Œåœæ­¢å°è¯•');
        return;
    }
    
    const delay = getReconnectDelay(reconnectAttempts);
    reconnectAttempts++;
    
    setTimeout(function() {
        console.log('ğŸ”„ å°è¯•é‡è¿...');
        connectWebSocket();
    }, delay);
}

// ğŸ’¡ ç†è§£è¦ç‚¹ï¼š
// åˆšå¼€å§‹å¿«é€Ÿé‡è¿ï¼Œå¦‚æœä¸€ç›´å¤±è´¥å°±æ…¢æ…¢å‡å°‘é¢‘ç‡
// é¿å…ç»™æœåŠ¡å™¨é€ æˆå¤ªå¤§å‹åŠ›
```

---

## 5. ğŸŒ ç½‘ç»œç¯å¢ƒé—®é¢˜æ’æŸ¥


### 5.1 ä»£ç†æœåŠ¡å™¨é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Ÿ**
```
ä»£ç†æœåŠ¡å™¨å°±åƒä¸­ä»‹ï¼š
ä½  â†’ ä¸­ä»‹ â†’ ç›®æ ‡æœåŠ¡å™¨

æ­£å¸¸æƒ…å†µï¼šä½ ç›´æ¥å’ŒæœåŠ¡å™¨é€šè¯
æœ‰ä»£ç†ï¼šä½ é€šè¿‡ä¸­ä»‹å’ŒæœåŠ¡å™¨é€šè¯

é—®é¢˜ï¼šæœ‰äº›ä¸­ä»‹ä¸æ”¯æŒWebSocketè¿™ç§"æŒç»­é€šè¯"
```

**ğŸ” æ£€æŸ¥ä»£ç†é—®é¢˜**
```javascript
// æ£€æŸ¥æ˜¯å¦åœ¨ä»£ç†ç¯å¢ƒä¸‹
function checkProxyEnvironment() {
    // ä¼ä¸šç½‘ç»œå¸¸ç”¨ä»£ç†ç«¯å£
    const commonProxyPorts = ['8080', '3128', '8888'];
    const currentUrl = window.location.href;
    
    console.log('å½“å‰é¡µé¢åœ°å€:', currentUrl);
    console.log('ğŸ’¡ å¦‚æœåœ¨å…¬å¸ç½‘ç»œç¯å¢ƒï¼Œå¯èƒ½æœ‰ä»£ç†æœåŠ¡å™¨');
    console.log('è§£å†³æ–¹æ¡ˆï¼š');
    console.log('1. è”ç³»ITç®¡ç†å‘˜é…ç½®WebSocketä»£ç†');
    console.log('2. ä½¿ç”¨æ‰‹æœºçƒ­ç‚¹æµ‹è¯•');
    console.log('3. æ”¹ç”¨wss://åŠ å¯†è¿æ¥');
}

// ğŸ’¡ å°è´´å£«ï¼šå¦‚ä½•åˆ¤æ–­æ˜¯ä»£ç†é—®é¢˜
// ç°è±¡ï¼šHTTPè¯·æ±‚æ­£å¸¸ï¼ŒWebSocketè¿æ¥å¤±è´¥
```

### 5.2 é˜²ç«å¢™é˜»æŒ¡é—®é¢˜


**ğŸ”¸ é˜²ç«å¢™å°±åƒé—¨å«**
```
é˜²ç«å¢™çš„ä½œç”¨ï¼š
- æ£€æŸ¥æ¯ä¸ªè¿›å‡ºçš„ç½‘ç»œè¿æ¥
- åªå…è®¸"å®‰å…¨"çš„è¿æ¥é€šè¿‡
- å¯èƒ½æŠŠWebSocketå½“ä½œ"å¯ç–‘è¿æ¥"é˜»æŒ¡

å¸¸è§é˜»æŒ¡æƒ…å†µï¼š
ğŸ¢ å…¬å¸é˜²ç«å¢™ï¼šé˜»æŒ¡éæ ‡å‡†ç«¯å£
ğŸ  å®¶åº­è·¯ç”±å™¨ï¼šé»˜è®¤è®¾ç½®å¯èƒ½é˜»æŒ¡
ğŸ’» ç”µè„‘é˜²ç«å¢™ï¼šå®‰å…¨è½¯ä»¶å¯èƒ½é˜»æŒ¡
```

**ğŸ”§ é˜²ç«å¢™é—®é¢˜æ’æŸ¥**
```javascript
// æµ‹è¯•ä¸åŒç«¯å£çš„è¿æ¥
function testDifferentPorts() {
    const testPorts = [8080, 80, 443, 9000];
    
    testPorts.forEach(port => {
        console.log(`æµ‹è¯•ç«¯å£ ${port}...`);
        
        const testWs = new WebSocket(`ws://localhost:${port}/ws`);
        
        testWs.onopen = function() {
            console.log(`âœ… ç«¯å£ ${port} è¿æ¥æˆåŠŸ`);
            testWs.close();
        };
        
        testWs.onerror = function() {
            console.log(`âŒ ç«¯å£ ${port} è¿æ¥å¤±è´¥`);
        };
    });
    
    console.log('ğŸ’¡ æç¤ºï¼šå¦‚æœ80æˆ–443ç«¯å£èƒ½è¿é€šï¼Œå…¶ä»–ç«¯å£ä¸è¡Œï¼Œå¯èƒ½æ˜¯é˜²ç«å¢™é—®é¢˜');
}
```

### 5.3 DNSè§£æé—®é¢˜


**ğŸ”¸ DNSå°±åƒç”µè¯ç°¿**
```
DNSçš„ä½œç”¨ï¼š
æŠŠåŸŸåï¼ˆwww.example.comï¼‰è½¬æ¢æˆIPåœ°å€ï¼ˆ192.168.1.100ï¼‰
å°±åƒé€šè¿‡å§“åæ‰¾åˆ°ç”µè¯å·ç 

DNSé—®é¢˜ç°è±¡ï¼š
- ç”¨IPåœ°å€èƒ½è¿æ¥ï¼Œç”¨åŸŸåè¿ä¸äº†
- æœ‰æ—¶èƒ½è¿ï¼Œæœ‰æ—¶è¿ä¸äº†
```

**ğŸ” DNSé—®é¢˜æ£€æŸ¥**
```javascript
// æµ‹è¯•DNSè§£æ
function testDNSResolution() {
    const domain = 'localhost';
    const ip = '127.0.0.1';
    
    console.log('æµ‹è¯•DNSè§£æ...');
    
    // ç”¨åŸŸåè¿æ¥
    const wsDomain = new WebSocket(`ws://${domain}:8080/ws`);
    wsDomain.onerror = () => console.log('âŒ åŸŸåè¿æ¥å¤±è´¥');
    wsDomain.onopen = () => {
        console.log('âœ… åŸŸåè¿æ¥æˆåŠŸ');
        wsDomain.close();
    };
    
    // ç”¨IPè¿æ¥
    const wsIP = new WebSocket(`ws://${ip}:8080/ws`);
    wsIP.onerror = () => console.log('âŒ IPè¿æ¥å¤±è´¥');
    wsIP.onopen = () => {
        console.log('âœ… IPè¿æ¥æˆåŠŸ');
        wsIP.close();
    };
}
```

---

## 6. â¤ï¸ å¿ƒè·³æœºåˆ¶ä¿æ´»


### 6.1 ä»€ä¹ˆæ˜¯å¿ƒè·³æœºåˆ¶ï¼Ÿ


**ğŸ’“ å¿ƒè·³å°±åƒå®šæ—¶è¯´"æˆ‘è¿˜åœ¨"**
```
ç”Ÿæ´»ä¸­çš„å¿ƒè·³ï¼š
æ‰“é•¿é€”ç”µè¯æ—¶å¶å°”è¯´"å–‚ï¼Œä½ è¿˜åœ¨å—ï¼Ÿ" â†’ ç¡®è®¤å¯¹æ–¹è¿˜åœ¨çº¿
WebSocketå¿ƒè·³ï¼šå®šæ—¶å‘é€pingæ¶ˆæ¯ â†’ ç¡®è®¤è¿æ¥è¿˜æ´»ç€

ä¸ºä»€ä¹ˆéœ€è¦å¿ƒè·³ï¼š
- ç½‘ç»œè®¾å¤‡å¯èƒ½å…³é—­"å®‰é™"çš„è¿æ¥
- åŠæ—¶å‘ç°è¿æ¥æ–­å¼€
- ä¿æŒè¿æ¥æ´»è·ƒçŠ¶æ€
```

### 6.2 ç®€å•å¿ƒè·³å®ç°


**ğŸ’— åŸºç¡€å¿ƒè·³ä»£ç **
```javascript
let heartbeatInterval = null;
let heartbeatTimer = 30000; // 30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³

function startHeartbeat() {
    heartbeatInterval = setInterval(function() {
        if (ws.readyState === WebSocket.OPEN) {
            console.log('ğŸ’“ å‘é€å¿ƒè·³');
            ws.send('ping');
        } else {
            console.log('ğŸ’” è¿æ¥å·²æ–­å¼€ï¼Œåœæ­¢å¿ƒè·³');
            stopHeartbeat();
        }
    }, heartbeatTimer);
}

function stopHeartbeat() {
    if (heartbeatInterval) {
        clearInterval(heartbeatInterval);
        heartbeatInterval = null;
        console.log('â¹ï¸ å¿ƒè·³å·²åœæ­¢');
    }
}

// è¿æ¥æˆåŠŸåå¯åŠ¨å¿ƒè·³
ws.onopen = function() {
    console.log('è¿æ¥æˆåŠŸï¼Œå¯åŠ¨å¿ƒè·³');
    startHeartbeat();
};

// è¿æ¥å…³é—­ååœæ­¢å¿ƒè·³
ws.onclose = function() {
    console.log('è¿æ¥å…³é—­ï¼Œåœæ­¢å¿ƒè·³');
    stopHeartbeat();
};

// ğŸ’¡ ä½¿ç”¨è¦ç‚¹ï¼š
// 1. è¿æ¥æˆåŠŸåç«‹å³å¯åŠ¨å¿ƒè·³
// 2. è¿æ¥æ–­å¼€ååŠæ—¶åœæ­¢å¿ƒè·³
// 3. å¿ƒè·³é—´éš”ä¸è¦å¤ªçŸ­ï¼ˆæµªè´¹èµ„æºï¼‰ä¹Ÿä¸è¦å¤ªé•¿ï¼ˆå‘ç°æ–­å¼€å¤ªæ…¢ï¼‰
```

### 6.3 æ™ºèƒ½å¿ƒè·³æœºåˆ¶


**ğŸ§  æ›´èªæ˜çš„å¿ƒè·³**
```javascript
let lastPongTime = Date.now(); // æœ€åæ”¶åˆ°pongçš„æ—¶é—´
let missedPings = 0;           // è¿ç»­æœªæ”¶åˆ°pongçš„æ¬¡æ•°
const maxMissedPings = 3;      // æœ€å¤šå…è®¸3æ¬¡æœªå“åº”

function smartHeartbeat() {
    if (ws.readyState !== WebSocket.OPEN) {
        stopHeartbeat();
        return;
    }
    
    // æ£€æŸ¥æ˜¯å¦å¤ªä¹…æ²¡æ”¶åˆ°å“åº”
    const now = Date.now();
    if (now - lastPongTime > heartbeatTimer * maxMissedPings) {
        console.log('ğŸ’” å¿ƒè·³è¶…æ—¶ï¼Œå¯èƒ½è¿æ¥å·²æ–­å¼€');
        ws.close();
        return;
    }
    
    console.log('ğŸ’“ å‘é€å¿ƒè·³ ping');
    ws.send(JSON.stringify({type: 'ping', timestamp: now}));
    missedPings++;
}

// å¤„ç†æœåŠ¡å™¨çš„pongå“åº”
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    
    if (data.type === 'pong') {
        console.log('ğŸ’— æ”¶åˆ°å¿ƒè·³å“åº” pong');
        lastPongTime = Date.now();
        missedPings = 0; // é‡ç½®è®¡æ•°
    } else {
        // å¤„ç†å…¶ä»–ç±»å‹çš„æ¶ˆæ¯
        handleOtherMessage(data);
    }
};

// ğŸ’¡ ç†è§£è¦ç‚¹ï¼š
// è¿™ç§å¿ƒè·³èƒ½å¤Ÿæ£€æµ‹åˆ°"å‡æ´»"çš„è¿æ¥
// å³è¿æ¥çœ‹ä¼¼æ­£å¸¸ï¼Œä½†å®é™…ä¸ŠæœåŠ¡å™¨å·²ç»æ”¶ä¸åˆ°æ¶ˆæ¯
```

---

## 7. ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹


### 7.1 ä½¿ç”¨wss://åŠ å¯†è¿æ¥


**ğŸ” ä¸ºä»€ä¹ˆè¦ç”¨åŠ å¯†è¿æ¥ï¼Ÿ**
```
HTTP vs HTTPS ç±»æ¯”ï¼š
HTTPï¼šæ˜æ–‡ä¼ è¾“ï¼Œåƒå¤§å£°è¯´è¯ï¼Œåˆ«äººéƒ½èƒ½å¬åˆ°
HTTPSï¼šåŠ å¯†ä¼ è¾“ï¼Œåƒæ‚„æ‚„è¯ï¼Œåªæœ‰å¯¹æ–¹èƒ½å¬åˆ°

WS vs WSS åŒæ ·é“ç†ï¼š
ws://ï¼šæ˜æ–‡WebSocketï¼Œæ•°æ®å¯èƒ½è¢«çªƒå¬
wss://ï¼šåŠ å¯†WebSocketï¼Œæ•°æ®ç»è¿‡åŠ å¯†ä¿æŠ¤
```

**ğŸ› ï¸ ä½¿ç”¨wss://è¿æ¥**
```javascript
// âŒ ä¸å®‰å…¨çš„è¿æ¥
const unsafeWs = new WebSocket('ws://example.com/ws');

// âœ… å®‰å…¨çš„åŠ å¯†è¿æ¥
const safeWs = new WebSocket('wss://example.com/ws');

// ğŸ’¡ å®é™…ä½¿ç”¨ä¸­çš„è‡ªåŠ¨é€‰æ‹©
function createSecureWebSocket(host, path) {
    // æ ¹æ®å½“å‰é¡µé¢åè®®è‡ªåŠ¨é€‰æ‹©
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const url = `${protocol}//${host}${path}`;
    
    console.log('åˆ›å»ºå®‰å…¨è¿æ¥:', url);
    return new WebSocket(url);
}

// ä½¿ç”¨ç¤ºä¾‹
const ws = createSecureWebSocket('localhost:8080', '/ws');
```

### 7.2 èº«ä»½æ ¡éªŒï¼ˆTokenè®¤è¯ï¼‰


**ğŸ« Tokenå°±åƒé—¨ç¥¨**
```
è¿›å…¥åœºæ‰€éœ€è¦é—¨ç¥¨ï¼š
æœ‰æ•ˆé—¨ç¥¨ â†’ å…è®¸è¿›å…¥
æ— æ•ˆé—¨ç¥¨ â†’ æ‹’ç»è¿›å…¥
è¿‡æœŸé—¨ç¥¨ â†’ éœ€è¦é‡æ–°è´­ä¹°

WebSocket Tokenè®¤è¯ï¼š
æœ‰æ•ˆToken â†’ å…è®¸è¿æ¥
æ— æ•ˆToken â†’ æ‹’ç»è¿æ¥
è¿‡æœŸToken â†’ éœ€è¦é‡æ–°è·å–
```

**ğŸ”§ Tokenè®¤è¯å®ç°**
```javascript
function connectWithAuth(token) {
    // æ–¹å¼1ï¼šé€šè¿‡URLå‚æ•°ä¼ é€’Token
    const ws = new WebSocket(`wss://api.example.com/ws?token=${token}`);
    
    ws.onopen = function() {
        console.log('âœ… è®¤è¯æˆåŠŸï¼Œè¿æ¥å»ºç«‹');
    };
    
    ws.onerror = function() {
        console.log('âŒ è®¤è¯å¤±è´¥æˆ–è¿æ¥é”™è¯¯');
    };
    
    return ws;
}

// æ–¹å¼2ï¼šè¿æ¥åå‘é€è®¤è¯æ¶ˆæ¯
function connectThenAuth(token) {
    const ws = new WebSocket('wss://api.example.com/ws');
    
    ws.onopen = function() {
        // è¿æ¥æˆåŠŸåç«‹å³å‘é€è®¤è¯ä¿¡æ¯
        const authMessage = {
            type: 'auth',
            token: token,
            timestamp: Date.now()
        };
        
        console.log('ğŸ« å‘é€è®¤è¯ä¿¡æ¯');
        ws.send(JSON.stringify(authMessage));
    };
    
    ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        
        if (data.type === 'auth_result') {
            if (data.success) {
                console.log('âœ… èº«ä»½è®¤è¯æˆåŠŸ');
            } else {
                console.log('âŒ èº«ä»½è®¤è¯å¤±è´¥:', data.message);
                ws.close();
            }
        }
    };
    
    return ws;
}

// ğŸ’¡ å®‰å…¨æç¤ºï¼š
// 1. Tokenè¦å®šæœŸæ›´æ–°
// 2. ä¸è¦åœ¨æ§åˆ¶å°æ‰“å°Token
// 3. ä½¿ç”¨HTTPSé¡µé¢è®¿é—®WSSè¿æ¥
```

---

## 8. ğŸ“± ç§»åŠ¨ç«¯å…¼å®¹æ€§æ³¨æ„äº‹é¡¹


### 8.1 ç§»åŠ¨ç½‘ç»œç¯å¢ƒç‰¹ç‚¹


**ğŸ“¶ ç§»åŠ¨ç½‘ç»œçš„ç‰¹æ®Šæ€§**
```
ç§»åŠ¨ç½‘ç»œ vs WiFiç½‘ç»œï¼š
ğŸ“¶ ç§»åŠ¨ç½‘ç»œï¼šä¿¡å·ä¸ç¨³å®šï¼Œç»å¸¸åˆ‡æ¢åŸºç«™
ğŸ  WiFiç½‘ç»œï¼šç›¸å¯¹ç¨³å®š

ç§»åŠ¨è®¾å¤‡ç‰¹ç‚¹ï¼š
ğŸ”‹ çœç”µæ¨¡å¼ï¼šç³»ç»Ÿå¯èƒ½æš‚åœåå°è¿æ¥
ğŸ“± åˆ‡æ¢åº”ç”¨ï¼šWebSocketå¯èƒ½è¢«æš‚åœ
ğŸš¶ ç§»åŠ¨ä¸­ï¼šç½‘ç»œç»å¸¸æ–­å¼€é‡è¿
```

### 8.2 ç§»åŠ¨ç«¯å¸¸è§é—®é¢˜


**ğŸ”¸ åå°æš‚åœé—®é¢˜**
```javascript
// ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        console.log('ğŸ“± é¡µé¢åˆ‡æ¢åˆ°åå°');
        // é¡µé¢ä¸å¯è§æ—¶ï¼Œå‡å°‘å¿ƒè·³é¢‘ç‡æˆ–æš‚åœéå¿…è¦æ“ä½œ
        stopHeartbeat();
    } else {
        console.log('ğŸ“± é¡µé¢åˆ‡æ¢åˆ°å‰å°');
        // é¡µé¢å¯è§æ—¶ï¼Œæ¢å¤æ­£å¸¸æ“ä½œ
        if (ws.readyState === WebSocket.OPEN) {
            startHeartbeat();
        } else {
            // å¦‚æœè¿æ¥æ–­å¼€äº†ï¼Œå°è¯•é‡è¿
            connectWebSocket();
        }
    }
});

// ğŸ’¡ ç†è§£è¦ç‚¹ï¼šç§»åŠ¨è®¾å¤‡ä¸ºäº†çœç”µä¼šæš‚åœåå°åº”ç”¨
```

**ğŸ”¸ ç½‘ç»œåˆ‡æ¢é—®é¢˜**
```javascript
// ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–ï¼ˆéœ€è¦ç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰
if ('connection' in navigator) {
    navigator.connection.addEventListener('change', function() {
        console.log('ğŸ“¶ ç½‘ç»œçŠ¶æ€å˜åŒ–:', navigator.connection.effectiveType);
        
        // ç½‘ç»œå˜åŒ–æ—¶æ£€æŸ¥è¿æ¥çŠ¶æ€
        if (ws.readyState !== WebSocket.OPEN) {
            console.log('ç½‘ç»œå˜åŒ–ï¼Œå°è¯•é‡è¿');
            attemptReconnect();
        }
    });
}

// ç›‘å¬åœ¨çº¿/ç¦»çº¿çŠ¶æ€
window.addEventListener('online', function() {
    console.log('ğŸŒ ç½‘ç»œå·²è¿æ¥');
    if (ws.readyState !== WebSocket.OPEN) {
        attemptReconnect();
    }
});

window.addEventListener('offline', function() {
    console.log('ğŸ“µ ç½‘ç»œå·²æ–­å¼€');
    showUserMessage('ç½‘ç»œè¿æ¥ä¸­æ–­');
});
```

### 8.3 ç§»åŠ¨ç«¯ä¼˜åŒ–ç­–ç•¥


**âš¡ é’ˆå¯¹ç§»åŠ¨ç«¯çš„ä¼˜åŒ–**
```javascript
// ç§»åŠ¨ç«¯ä¸“ç”¨çš„WebSocketé…ç½®
function createMobileOptimizedWebSocket() {
    const ws = new WebSocket('wss://api.example.com/ws');
    
    // æ›´é•¿çš„å¿ƒè·³é—´éš”ï¼ˆèŠ‚çœç”µé‡å’Œæµé‡ï¼‰
    const mobileHeartbeatInterval = 60000; // 60ç§’
    
    // æ›´å°‘çš„é‡è¿æ¬¡æ•°ï¼ˆé¿å…è€—ç”µï¼‰
    const mobileMaxReconnects = 3;
    
    // æ›´æ™ºèƒ½çš„é‡è¿ç­–ç•¥
    function shouldReconnect() {
        // å¦‚æœé¡µé¢ä¸å¯è§ï¼Œä¸ç«‹å³é‡è¿
        if (document.hidden) {
            console.log('é¡µé¢åœ¨åå°ï¼Œå»¶è¿Ÿé‡è¿');
            return false;
        }
        
        // å¦‚æœæ²¡æœ‰ç½‘ç»œï¼Œä¸é‡è¿
        if (!navigator.onLine) {
            console.log('ç¦»çº¿çŠ¶æ€ï¼Œä¸é‡è¿');
            return false;
        }
        
        return true;
    }
    
    return ws;
}

// ğŸ’¡ ç§»åŠ¨ç«¯æœ€ä½³å®è·µï¼š
// 1. å‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“
// 2. æ™ºèƒ½å¤„ç†åå°æš‚åœ
// 3. è€ƒè™‘ç”¨æˆ·çš„æµé‡æ¶ˆè€—
```

---

## 9. ğŸ”§ ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•


### 9.1 åˆ†å±‚æ’æŸ¥æ³•


**ğŸ“‹ ä»åº•å±‚åˆ°åº”ç”¨å±‚é€æ­¥æ£€æŸ¥**
```
ç½‘ç»œå±‚æ’æŸ¥ï¼š
ç¬¬1å±‚ï¼šç‰©ç†è¿æ¥
  â”œâ”€ ç½‘çº¿æ˜¯å¦æ’å¥½ï¼Ÿ
  â”œâ”€ WiFiæ˜¯å¦è¿æ¥ï¼Ÿ
  â””â”€ æ‰‹æœºä¿¡å·æ˜¯å¦æ­£å¸¸ï¼Ÿ

ç¬¬2å±‚ï¼šç½‘ç»œé…ç½®
  â”œâ”€ IPåœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ
  â”œâ”€ DNSæ˜¯å¦å¯ç”¨ï¼Ÿ
  â””â”€ é˜²ç«å¢™æ˜¯å¦é˜»æŒ¡ï¼Ÿ

ç¬¬3å±‚ï¼šæœåŠ¡å™¨çŠ¶æ€
  â”œâ”€ æœåŠ¡å™¨æ˜¯å¦è¿è¡Œï¼Ÿ
  â”œâ”€ ç«¯å£æ˜¯å¦å¼€æ”¾ï¼Ÿ
  â””â”€ æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Ÿ

ç¬¬4å±‚ï¼šåº”ç”¨å±‚é—®é¢˜
  â”œâ”€ WebSocketåœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ
  â”œâ”€ æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿ
  â””â”€ ä¸šåŠ¡é€»è¾‘æ˜¯å¦æœ‰é—®é¢˜ï¼Ÿ
```

### 9.2 å·¥å…·è¾…åŠ©æ’æŸ¥


**ğŸ› ï¸ ä½¿ç”¨æµè§ˆå™¨å¼€å‘å·¥å…·**
```javascript
// 1. æ§åˆ¶å°è°ƒè¯•
function debugWebSocket() {
    console.group('ğŸ” WebSocketè°ƒè¯•ä¿¡æ¯');
    console.log('è¿æ¥åœ°å€:', ws.url);
    console.log('è¿æ¥çŠ¶æ€:', getConnectionState());
    console.log('åè®®ç‰ˆæœ¬:', ws.protocol);
    console.log('æ‰©å±•ä¿¡æ¯:', ws.extensions);
    console.groupEnd();
}

// 2. ç½‘ç»œé¢æ¿æ£€æŸ¥
// F12 â†’ Network â†’ WS â†’ æŸ¥çœ‹WebSocketè¿æ¥è¯¦æƒ…

// 3. æ¶ˆæ¯ç›‘æ§
function monitorMessages() {
    const originalSend = ws.send;
    const originalOnMessage = ws.onmessage;
    
    // ç›‘æ§å‘é€çš„æ¶ˆæ¯
    ws.send = function(data) {
        console.log('ğŸ“¤ å‘é€æ¶ˆæ¯:', data);
        return originalSend.call(this, data);
    };
    
    // ç›‘æ§æ¥æ”¶çš„æ¶ˆæ¯
    ws.onmessage = function(event) {
        console.log('ğŸ“¥ æ¥æ”¶æ¶ˆæ¯:', event.data);
        if (originalOnMessage) {
            return originalOnMessage.call(this, event);
        }
    };
}
```

### 9.3 é—®é¢˜è®°å½•å’Œåˆ†æ


**ğŸ“ å»ºç«‹é—®é¢˜è®°å½•**
```javascript
const problemLog = [];

function logProblem(type, description, solution) {
    const record = {
        timestamp: new Date().toISOString(),
        type: type,
        description: description,
        solution: solution,
        userAgent: navigator.userAgent,
        url: window.location.href
    };
    
    problemLog.push(record);
    console.log('ğŸ“ é—®é¢˜è®°å½•:', record);
    
    // å¯ä»¥å‘é€åˆ°æœåŠ¡å™¨è¿›è¡Œåˆ†æ
    // sendProblemToServer(record);
}

// ä½¿ç”¨ç¤ºä¾‹
ws.onerror = function(error) {
    logProblem('è¿æ¥é”™è¯¯', 'æ— æ³•å»ºç«‹WebSocketè¿æ¥', 'æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€å’Œç½‘ç»œè¿æ¥');
};

// ğŸ’¡ å¥½å¤„ï¼š
// 1. è®°å½•é—®é¢˜æ¨¡å¼ï¼Œä¾¿äºæ‰¾åˆ°è§£å†³æ–¹æ¡ˆ
// 2. ç»Ÿè®¡é—®é¢˜é¢‘ç‡ï¼Œè¯†åˆ«ç³»ç»Ÿæ€§é—®é¢˜
// 3. ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„é”™è¯¯æç¤º
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ è¿æ¥å¤±è´¥ä¸‰å¤§åŸå› ï¼šåœ°å€é”™è¯¯ã€æœåŠ¡å™¨æœªå¯åŠ¨ã€ç½‘ç»œé—®é¢˜
ğŸ”¸ é‡è¦é”™è¯¯ç ï¼š1006å¼‚å¸¸å…³é—­ã€1001ç«¯ç‚¹ç¦»å¼€ã€1000æ­£å¸¸å…³é—­  
ğŸ”¸ æ–­çº¿é‡è¿ï¼šæ£€æµ‹æ–­å¼€â†’ç­‰å¾…å»¶è¿Ÿâ†’å°è¯•é‡è¿â†’æˆåŠŸæ¢å¤
ğŸ”¸ å¿ƒè·³æœºåˆ¶ï¼šå®šæ—¶å‘é€pingæ¶ˆæ¯ä¿æŒè¿æ¥æ´»è·ƒ
ğŸ”¸ å®‰å…¨è¿æ¥ï¼šä½¿ç”¨wss://åŠ å¯† + Tokenèº«ä»½è®¤è¯
ğŸ”¸ ç§»åŠ¨ç«¯ç‰¹ç‚¹ï¼šåå°æš‚åœã€ç½‘ç»œåˆ‡æ¢ã€çœç”µä¼˜åŒ–
```

### 10.2 é—®é¢˜æ’æŸ¥æ€è·¯


**ğŸ¯ è®°ä½è¿™ä¸ªæ’æŸ¥é¡ºåº**
```
ç¬¬ä¸€æ­¥ï¼šçœ‹é”™è¯¯ä¿¡æ¯ â†’ å¿«é€Ÿå®šä½é—®é¢˜ç±»å‹
ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥åŸºç¡€ç¯å¢ƒ â†’ åœ°å€ã€æœåŠ¡å™¨ã€ç½‘ç»œ
ç¬¬ä¸‰æ­¥ï¼šåˆ†æé”™è¯¯ç  â†’ åˆ¤æ–­å…·ä½“æ–­å¼€åŸå›   
ç¬¬å››æ­¥ï¼šæŸ¥çœ‹ç½‘ç»œç¯å¢ƒ â†’ ä»£ç†ã€é˜²ç«å¢™ã€DNS
ç¬¬äº”æ­¥ï¼šæ£€æŸ¥ä»£ç é€»è¾‘ â†’ é‡è¿ã€å¿ƒè·³ã€è®¤è¯
```

### 10.3 æœ€ä½³å®è·µè¦ç‚¹


**âœ… æ¨èåšæ³•**
- **æ™ºèƒ½é‡è¿**ï¼šé€’å¢å»¶è¿Ÿï¼Œé™åˆ¶æ¬¡æ•°
- **å‹å¥½æç¤º**ï¼šå‘ç”¨æˆ·æ˜¾ç¤ºè¿æ¥çŠ¶æ€
- **å¿ƒè·³ä¿æ´»**ï¼š30-60ç§’é—´éš”åˆé€‚
- **å®‰å…¨è¿æ¥**ï¼šç”Ÿäº§ç¯å¢ƒå¿…ç”¨wss://
- **é”™è¯¯å¤„ç†**ï¼šæ¯ä¸ªäº‹ä»¶éƒ½è¦å¤„ç†

**âŒ é¿å…çš„é”™è¯¯**
- **æ— é™é‡è¿**ï¼šæ²¡æœ‰æ¬¡æ•°é™åˆ¶ä¼šæµªè´¹èµ„æº
- **é¢‘ç¹å¿ƒè·³**ï¼šå¤ªé¢‘ç¹ä¼šæµªè´¹æµé‡å’Œç”µé‡
- **å¿½ç•¥é”™è¯¯**ï¼šä¸å¤„ç†é”™è¯¯äº‹ä»¶
- **æ˜æ–‡ä¼ è¾“**ï¼šç”Ÿäº§ç¯å¢ƒä¸ç”¨ws://
- **æ²¡æœ‰æç¤º**ï¼šç”¨æˆ·ä¸çŸ¥é“è¿æ¥çŠ¶æ€

### 10.4 å®ç”¨è°ƒè¯•æŠ€å·§


**ğŸ”§ å¿«é€Ÿè°ƒè¯•æ–¹æ³•**
```javascript
// ä¸€é”®è°ƒè¯•å‡½æ•°
function quickDebug() {
    console.log('ğŸ” WebSocketå¿«é€Ÿè¯Šæ–­ï¼š');
    console.log('1. è¿æ¥çŠ¶æ€:', ws.readyState);
    console.log('2. è¿æ¥åœ°å€:', ws.url);
    console.log('3. æµè§ˆå™¨ç‰ˆæœ¬:', navigator.userAgent);
    console.log('4. ç½‘ç»œçŠ¶æ€:', navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿');
    console.log('5. é¡µé¢å¯è§:', document.hidden ? 'åå°' : 'å‰å°');
}

// ğŸ’¡ é‡åˆ°é—®é¢˜æ—¶ç«‹å³è¿è¡Œè¿™ä¸ªå‡½æ•°
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è¿æ¥å¤±è´¥å…ˆçœ‹ç ï¼Œåœ°å€æœåŠ¡ç½‘ç»œæŸ¥
é‡è¿å¿ƒè·³è¦æ™ºèƒ½ï¼Œå®‰å…¨è®¤è¯ä¸èƒ½å¿˜
ç§»åŠ¨ç«¯ä¸Šå¤šæ³¨æ„ï¼Œé—®é¢˜æ’æŸ¥æœ‰æ–¹æ³•
è°ƒè¯•å·¥å…·è¦å–„ç”¨ï¼Œç”¨æˆ·ä½“éªŒæœ€é‡è¦
```