---
title: 2ã€è®¤è¯åŠ å¯†æŠ€æœ¯
---
## ğŸ“š ç›®å½•

1. [è®¤è¯åŠ å¯†çš„å¿…è¦æ€§](#1-è®¤è¯åŠ å¯†çš„å¿…è¦æ€§)
2. [Encrypt-then-MACèŒƒå¼](#2-encrypt-then-macèŒƒå¼)
3. [AEADç®—æ³•è¯¦è§£](#3-aeadç®—æ³•è¯¦è§£)
4. [å…³è”æ•°æ®è®¤è¯](#4-å…³è”æ•°æ®è®¤è¯)
5. [å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ](#5-å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ è®¤è¯åŠ å¯†çš„å¿…è¦æ€§


### 1.1 ä»€ä¹ˆæ˜¯è®¤è¯åŠ å¯†


**ğŸ”¸ é€šä¿—ç†è§£**
è®¤è¯åŠ å¯†å°±åƒæ˜¯ç»™é‡è¦æ–‡ä»¶æ—¢åŠ é”åˆç›–ç« ï¼š
- **åŠ å¯†**ï¼šæŠŠå†…å®¹é”èµ·æ¥ï¼Œåˆ«äººçœ‹ä¸æ‡‚ï¼ˆä¿å¯†æ€§ï¼‰
- **è®¤è¯**ï¼šç›–ä¸Šå°ç« ï¼Œè¯æ˜æ²¡è¢«ç¯¡æ”¹ï¼ˆå®Œæ•´æ€§ï¼‰

```
æ™®é€šåŠ å¯†ï¼š   æ˜æ–‡ â†’ åŠ å¯† â†’ å¯†æ–‡
è®¤è¯åŠ å¯†ï¼š   æ˜æ–‡ â†’ åŠ å¯†+è®¤è¯ â†’ å¯†æ–‡+è®¤è¯æ ‡ç­¾
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è®¤è¯åŠ å¯†


**ğŸš« ä»…ä»…åŠ å¯†çš„é—®é¢˜**

æƒ³è±¡ä½ ç»™æœ‹å‹å‘ä¸€å°åŠ å¯†çš„æƒ…ä¹¦ï¼š

```
åŸå§‹æƒ…ä¹¦ï¼šã€Œæˆ‘çˆ±ä½ ã€
åŠ å¯†åï¼š  ã€ŒXYZ123ã€
```

ä½†å¦‚æœæœ‰äººæ¶æ„ä¿®æ”¹äº†å¯†æ–‡ï¼š
```
è¢«ç¯¡æ”¹ï¼š  ã€ŒABC456ã€
è§£å¯†åï¼š  ã€Œæˆ‘æ¨ä½ ã€
```

**ğŸ˜± é—®é¢˜æ‰€åœ¨**ï¼š
- åŠ å¯†åªèƒ½é˜²æ­¢**çªƒå¬**ï¼Œä¸èƒ½é˜²æ­¢**ç¯¡æ”¹**
- æ”»å‡»è€…å¯èƒ½ä¸çŸ¥é“å†…å®¹ï¼Œä½†å¯ä»¥ç›²ç›®ä¿®æ”¹
- æ¥æ”¶æ–¹æ— æ³•çŸ¥é“æ¶ˆæ¯æ˜¯å¦è¢«åŠ¨è¿‡æ‰‹è„š

### 1.3 è®¤è¯åŠ å¯†è§£å†³çš„å®‰å…¨å¨èƒ


**ğŸ¯ æ ¸å¿ƒå®‰å…¨ç›®æ ‡**

| å®‰å…¨å±æ€§ | **è¯´æ˜** | **å¨èƒ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|---------|---------|-------------|
| ğŸ”’ **ä¿å¯†æ€§** | `å†…å®¹ä¸è¢«çªƒå¬` | `çªƒå¬æ”»å‡»` | `åŠ å¯†ç®—æ³•` |
| âœ… **å®Œæ•´æ€§** | `å†…å®¹ä¸è¢«ç¯¡æ”¹` | `ç¯¡æ”¹æ”»å‡»` | `æ¶ˆæ¯è®¤è¯ç ` |
| ğŸ†” **è®¤è¯æ€§** | `ç¡®è®¤å‘é€è€…èº«ä»½` | `ä¼ªé€ æ”»å‡»` | `æ•°å­—ç­¾å/MAC` |
| ğŸš« **æŠ—é‡æ”¾** | `é˜²æ­¢æ¶ˆæ¯é‡å¤ä½¿ç”¨` | `é‡æ”¾æ”»å‡»` | `æ—¶é—´æˆ³/åºåˆ—å·` |

**ğŸ”¥ å®é™…æ”»å‡»åœºæ™¯**

```
ç½‘ä¸Šé“¶è¡Œè½¬è´¦ï¼š
åŸå§‹æŒ‡ä»¤ï¼šã€Œè½¬è´¦1000å…ƒç»™å¼ ä¸‰ã€
æ”»å‡»è€…ä¿®æ”¹ï¼šã€Œè½¬è´¦10000å…ƒç»™æå››ã€
```

å¦‚æœåªæœ‰åŠ å¯†æ²¡æœ‰è®¤è¯ï¼Œè¿™ç§ç¯¡æ”¹å¯èƒ½æˆåŠŸï¼

### 1.4 ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆçš„é—®é¢˜


**âŒ å…ˆåŠ å¯†åè®¤è¯ï¼ˆEncrypt-then-Authenticateï¼‰**
```
æ˜æ–‡ â†’ åŠ å¯† â†’ å¯†æ–‡ â†’ è®¡ç®—MAC â†’ å¯†æ–‡+MAC
```
é—®é¢˜ï¼šå¯èƒ½æ³„éœ²éƒ¨åˆ†æ˜æ–‡ä¿¡æ¯

**âŒ å…ˆè®¤è¯ååŠ å¯†ï¼ˆAuthenticate-then-Encryptï¼‰**
```
æ˜æ–‡ â†’ è®¡ç®—MAC â†’ æ˜æ–‡+MAC â†’ åŠ å¯† â†’ å¯†æ–‡
```
é—®é¢˜ï¼šMACå¯èƒ½æš´éœ²æ˜æ–‡é•¿åº¦ä¿¡æ¯

**âŒ åŒæ—¶åŠ å¯†å’Œè®¤è¯ï¼ˆEncrypt-and-Authenticateï¼‰**
```
æ˜æ–‡ â†’ åˆ†åˆ«åŠ å¯†å’Œè®¡ç®—MAC â†’ å¯†æ–‡+MAC
```
é—®é¢˜ï¼šè®¾è®¡å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™

---

## 2. ğŸ” Encrypt-then-MACèŒƒå¼


### 2.1 ä»€ä¹ˆæ˜¯Encrypt-then-MAC


**ğŸ”¸ åŸºæœ¬æ€æƒ³**
"å…ˆåŠ å¯†ï¼Œå†è®¤è¯"ï¼Œæ˜¯ç›®å‰æœ€å®‰å…¨çš„è®¤è¯åŠ å¯†æ–¹å¼ã€‚

```
Encrypt-then-MACæµç¨‹ï¼š
æ˜æ–‡ â†’ åŠ å¯† â†’ å¯†æ–‡ â†’ å¯¹å¯†æ–‡è®¡ç®—MAC â†’ å¯†æ–‡+MACæ ‡ç­¾
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**
å°±åƒå¯„è´µé‡ç‰©å“ï¼š
1. **å…ˆè£…ç®±å¯†å°**ï¼ˆåŠ å¯†ï¼‰
2. **å†è´´é˜²æ‹†å°æ¡**ï¼ˆMACè®¤è¯ï¼‰
3. æ”¶ä»¶äººå…ˆæ£€æŸ¥å°æ¡ï¼Œå†å¼€ç®±

### 2.2 å·¥ä½œåŸç†è¯¦è§£


**ğŸ“‹ åŠ å¯†è¿‡ç¨‹**

```
æ­¥éª¤1ï¼šåŠ å¯†
E_k1(æ˜æ–‡) = å¯†æ–‡

æ­¥éª¤2ï¼šè®¤è¯  
MAC_k2(å¯†æ–‡) = è®¤è¯æ ‡ç­¾

æ­¥éª¤3ï¼šç»„åˆ
æœ€ç»ˆè¾“å‡º = å¯†æ–‡ || è®¤è¯æ ‡ç­¾
```

**ğŸ“‹ è§£å¯†éªŒè¯è¿‡ç¨‹**

```
æ­¥éª¤1ï¼šåˆ†ç¦»
æ¥æ”¶åˆ°ï¼šå¯†æ–‡ || è®¤è¯æ ‡ç­¾

æ­¥éª¤2ï¼šéªŒè¯
è®¡ç®—ï¼šMAC_k2(å¯†æ–‡)
æ¯”è¾ƒï¼šè®¡ç®—å€¼ == æ¥æ”¶çš„æ ‡ç­¾ ï¼Ÿ

æ­¥éª¤3ï¼šè§£å¯†ï¼ˆä»…éªŒè¯é€šè¿‡åï¼‰
å¦‚æœéªŒè¯é€šè¿‡ï¼šD_k1(å¯†æ–‡) = æ˜æ–‡
å¦‚æœéªŒè¯å¤±è´¥ï¼šæ‹’ç»å¤„ç†
```

### 2.3 å…³é”®è®¾è®¡åŸåˆ™


**ğŸ”‘ å¯†é’¥ç‹¬ç«‹æ€§**
```
åŠ å¯†å¯†é’¥ï¼šk1
è®¤è¯å¯†é’¥ï¼šk2
è¦æ±‚ï¼šk1 â‰  k2ï¼ˆå¿…é¡»ä¸åŒï¼‰
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸åŒå¯†é’¥ï¼Ÿ**
- é¿å…å¯†é’¥é‡ç”¨å¯¼è‡´çš„å®‰å…¨æ¼æ´
- åˆ†ç¦»åŠ å¯†å’Œè®¤è¯çš„å®‰å…¨åŸŸ
- å³ä½¿ä¸€ä¸ªå¯†é’¥æ³„éœ²ï¼Œå¦ä¸€ä¸ªä»ç„¶å®‰å…¨

**âš¡ ç®€åŒ–å®ç°**
```python
# ä¼ªä»£ç ç¤ºä¾‹
def encrypt_then_mac(plaintext, key):
    # ä»ä¸»å¯†é’¥æ´¾ç”Ÿä¸¤ä¸ªå­å¯†é’¥
    k1 = derive_key(key, "encryption")
    k2 = derive_key(key, "authentication")
    
    # å…ˆåŠ å¯†
    ciphertext = encrypt(plaintext, k1)
    
    # åè®¤è¯
    tag = mac(ciphertext, k2)
    
    return ciphertext + tag

def decrypt_and_verify(data, key):
    # æ´¾ç”Ÿå¯†é’¥
    k1 = derive_key(key, "encryption") 
    k2 = derive_key(key, "authentication")
    
    # åˆ†ç¦»å¯†æ–‡å’Œæ ‡ç­¾
    ciphertext = data[:-16]  # å‡è®¾MACé•¿åº¦16å­—èŠ‚
    received_tag = data[-16:]
    
    # å…ˆéªŒè¯
    computed_tag = mac(ciphertext, k2)
    if computed_tag != received_tag:
        raise Exception("è®¤è¯å¤±è´¥ï¼")
    
    # åè§£å¯†
    return decrypt(ciphertext, k1)
```

### 2.4 Encrypt-then-MACçš„ä¼˜åŠ¿


**âœ… å®‰å…¨æ€§ä¼˜åŠ¿**
- **æœ€é«˜å®‰å…¨ä¿è¯**ï¼šè¢«è¯æ˜æ˜¯æœ€å®‰å…¨çš„èŒƒå¼
- **é˜²æ­¢é€‰æ‹©å¯†æ–‡æ”»å‡»**ï¼šæ”»å‡»è€…æ— æ³•æ„é€ æœ‰æ•ˆå¯†æ–‡
- **æ—©æœŸé”™è¯¯æ£€æµ‹**ï¼šæ— éœ€è§£å¯†å³å¯å‘ç°ç¯¡æ”¹

**âœ… å®ç”¨æ€§ä¼˜åŠ¿**
- **æ¸…æ™°çš„å®‰å…¨è¾¹ç•Œ**ï¼šåŠ å¯†å’Œè®¤è¯èŒè´£åˆ†ç¦»
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå¯ä»¥ç‹¬ç«‹é€‰æ‹©åŠ å¯†å’ŒMACç®—æ³•
- **æ˜“äºå®ç°**ï¼šé€»è¾‘ç®€å•ï¼Œä¸å®¹æ˜“å‡ºé”™

---

## 3. ğŸ¯ AEADç®—æ³•è¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯AEAD


**ğŸ”¸ AEADå®šä¹‰**
AEAD = **Authenticated Encryption with Associated Data**
**å¸¦å…³è”æ•°æ®çš„è®¤è¯åŠ å¯†**

```
ä¼ ç»Ÿè®¤è¯åŠ å¯†ï¼š  æ˜æ–‡ â†’ å¯†æ–‡+è®¤è¯æ ‡ç­¾
AEADï¼š          æ˜æ–‡+å…³è”æ•°æ® â†’ å¯†æ–‡+è®¤è¯æ ‡ç­¾
                     â†‘
              è¿™éƒ¨åˆ†ä¸åŠ å¯†ï¼Œä½†è¦è®¤è¯
```

**ğŸ’¡ ç”Ÿæ´»åœºæ™¯ç†è§£**
å‘é€å¿«é€’åŒ…è£¹ï¼š
- **åŒ…è£¹å†…å®¹**ï¼ˆæ˜æ–‡ï¼‰ï¼šéœ€è¦åŠ å¯†ä¿æŠ¤
- **å¿«é€’å•ä¿¡æ¯**ï¼ˆå…³è”æ•°æ®ï¼‰ï¼šåœ°å€ã€æ”¶ä»¶äººç­‰ï¼Œä¸éœ€è¦åŠ å¯†ä½†è¦é˜²ç¯¡æ”¹

### 3.2 GCMç®—æ³•è¯¦è§£


**ğŸ”¸ GCMåŸºæœ¬æ¦‚å¿µ**
GCM = **Galois/Counter Mode**ï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„AEADç®—æ³•ã€‚

**âš™ï¸ GCMå·¥ä½œåŸç†**

```
GCM = CTRåŠ å¯†æ¨¡å¼ + GHASHè®¤è¯
```

**CTRæ¨¡å¼åŠ å¯†ï¼š**
```
æ˜æ–‡å—1    æ˜æ–‡å—2    æ˜æ–‡å—3
   âŠ•        âŠ•        âŠ•
CTR(1)    CTR(2)    CTR(3)
   â†“        â†“        â†“
å¯†æ–‡å—1    å¯†æ–‡å—2    å¯†æ–‡å—3
```

**GHASHè®¤è¯ï¼š**
```
å¯¹ä»¥ä¸‹å†…å®¹è®¡ç®—è®¤è¯æ ‡ç­¾ï¼š
- å…³è”æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
- å¯†æ–‡
- é•¿åº¦ä¿¡æ¯
```

**ğŸ”§ GCMå®Œæ•´æµç¨‹**

```python
def gcm_encrypt(plaintext, key, iv, aad=b""):
    """
    plaintext: æ˜æ–‡
    key: å¯†é’¥
    iv: åˆå§‹åŒ–å‘é‡
    aad: å…³è”æ•°æ®ï¼ˆä¸åŠ å¯†ä½†è¦è®¤è¯ï¼‰
    """
    # ç¬¬1æ­¥ï¼šCTRæ¨¡å¼åŠ å¯†
    ciphertext = ctr_encrypt(plaintext, key, iv)
    
    # ç¬¬2æ­¥ï¼šGHASHè®¤è¯
    # è®¤è¯å†…å®¹åŒ…æ‹¬ï¼šå…³è”æ•°æ® + å¯†æ–‡ + é•¿åº¦ä¿¡æ¯
    auth_data = aad + ciphertext + encode_lengths(len(aad), len(ciphertext))
    tag = ghash(auth_data, derive_hash_key(key))
    
    return ciphertext, tag

def gcm_decrypt(ciphertext, tag, key, iv, aad=b""):
    # ç¬¬1æ­¥ï¼šéªŒè¯è®¤è¯æ ‡ç­¾
    auth_data = aad + ciphertext + encode_lengths(len(aad), len(ciphertext))
    computed_tag = ghash(auth_data, derive_hash_key(key))
    
    if computed_tag != tag:
        raise Exception("GCMè®¤è¯å¤±è´¥ï¼")
    
    # ç¬¬2æ­¥ï¼šCTRæ¨¡å¼è§£å¯†
    plaintext = ctr_decrypt(ciphertext, key, iv)
    return plaintext
```

**ğŸš€ GCMçš„ä¼˜åŠ¿**
- **é«˜æ€§èƒ½**ï¼šå¯ä»¥å¹¶è¡Œè®¡ç®—ï¼Œç¡¬ä»¶åŠ é€Ÿå‹å¥½
- **çµæ´»æ€§**ï¼šæ”¯æŒä»»æ„é•¿åº¦çš„æ˜æ–‡å’Œå…³è”æ•°æ®
- **å®‰å…¨æ€§**ï¼šç»è¿‡ä¸¥æ ¼çš„å¯†ç å­¦è¯æ˜

### 3.3 CCMç®—æ³•è¯¦è§£


**ğŸ”¸ CCMåŸºæœ¬æ¦‚å¿µ**
CCM = **Counter with CBC-MAC**ï¼Œå¦ä¸€ç§é‡è¦çš„AEADç®—æ³•ã€‚

**âš™ï¸ CCMå·¥ä½œåŸç†**

```
CCM = CTRåŠ å¯†æ¨¡å¼ + CBC-MACè®¤è¯
```

**ğŸ“‹ CCMæ‰§è¡Œæµç¨‹**

```
ç¬¬1é˜¶æ®µï¼šCBC-MACè®¤è¯
- å¯¹å…³è”æ•°æ®å’Œæ˜æ–‡è®¡ç®—CBC-MAC
- å¾—åˆ°è®¤è¯æ ‡ç­¾

ç¬¬2é˜¶æ®µï¼šCTRæ¨¡å¼åŠ å¯†  
- åŠ å¯†æ˜æ–‡å¾—åˆ°å¯†æ–‡
- åŠ å¯†è®¤è¯æ ‡ç­¾å¾—åˆ°æœ€ç»ˆæ ‡ç­¾
```

**ğŸ”§ CCMç‰¹ç‚¹å¯¹æ¯”**

| ç‰¹æ€§ | **GCM** | **CCM** |
|------|---------|---------|
| ğŸš€ **æ€§èƒ½** | `æ›´å¿«ï¼Œå¯å¹¶è¡Œ` | `è¾ƒæ…¢ï¼Œä¸²è¡Œå¤„ç†` |
| ğŸ›¡ï¸ **å®‰å…¨æ€§** | `é«˜` | `é«˜` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `è¾ƒå¤š` | `è¾ƒå°‘` |
| ğŸ”§ **å®ç°å¤æ‚åº¦** | `ä¸­ç­‰` | `ç®€å•` |
| ğŸ“± **ç¡¬ä»¶æ”¯æŒ** | `å¹¿æ³›` | `ä¸€èˆ¬` |

### 3.4 OCBç®—æ³•ç®€ä»‹


**ğŸ”¸ OCBåŸºæœ¬æ¦‚å¿µ**
OCB = **Offset Codebook**ï¼Œä¸“åˆ©ä¿æŠ¤çš„é«˜æ€§èƒ½AEADç®—æ³•ã€‚

**âš¡ OCBç‰¹ç‚¹**
- **æœ€é«˜æ€§èƒ½**ï¼šç†è®ºä¸Šæœ€å¿«çš„AEADç®—æ³•
- **ä¸“åˆ©é™åˆ¶**ï¼šå•†ä¸šä½¿ç”¨éœ€è¦æˆæƒ
- **ä¸€éå¤„ç†**ï¼šåªéœ€è¦ä¸€æ¬¡éå†å°±èƒ½å®ŒæˆåŠ å¯†å’Œè®¤è¯

**ğŸ“Š AEADç®—æ³•æ€§èƒ½å¯¹æ¯”**

```
æ€§èƒ½æ’åºï¼ˆä»å¿«åˆ°æ…¢ï¼‰ï¼š
OCB > GCM > CCM

å®é™…é€‰æ‹©å»ºè®®ï¼š
- å¼€æºé¡¹ç›®ï¼šGCMï¼ˆæ— ä¸“åˆ©é™åˆ¶ï¼‰
- å•†ä¸šäº§å“ï¼šå¯è€ƒè™‘OCBï¼ˆéœ€æˆæƒï¼‰
- åµŒå…¥å¼è®¾å¤‡ï¼šCCMï¼ˆå†…å­˜å‹å¥½ï¼‰
```

---

## 4. ğŸ”— å…³è”æ•°æ®è®¤è¯


### 4.1 ä»€ä¹ˆæ˜¯å…³è”æ•°æ®


**ğŸ”¸ å…³è”æ•°æ®å®šä¹‰**
å…³è”æ•°æ®ï¼ˆAssociated Dataï¼ŒADï¼‰æ˜¯éœ€è¦è®¤è¯ä½†ä¸éœ€è¦åŠ å¯†çš„æ•°æ®ã€‚

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**

```
ç½‘ç»œé€šä¿¡åŒ…å¤´ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åŒ…å¤´ä¿¡æ¯      â”‚    è´Ÿè½½æ•°æ®      â”‚
â”‚  (å…³è”æ•°æ®)     â”‚   (éœ€è¦åŠ å¯†)     â”‚
â”‚  ä¸åŠ å¯†ä½†è®¤è¯    â”‚   åŠ å¯†ä¸”è®¤è¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾‹å¦‚ï¼š
- IPåœ°å€ã€ç«¯å£å·ï¼ˆä¸èƒ½åŠ å¯†ï¼Œè·¯ç”±éœ€è¦ï¼‰
- åè®®ç‰ˆæœ¬ã€é•¿åº¦å­—æ®µï¼ˆå¿…é¡»å¯è§ï¼‰
- æ—¶é—´æˆ³ã€åºåˆ—å·ï¼ˆç”¨äºé˜²é‡æ”¾ï¼‰
```

### 4.2 å…³è”æ•°æ®çš„ä½œç”¨


**ğŸ›¡ï¸ å®‰å…¨ä½œç”¨**

1. **é˜²æ­¢å¤´éƒ¨ç¯¡æ”¹**
```
HTTPè¯·æ±‚ï¼š
GET /api/transfer?amount=1000    â† å…³è”æ•°æ®ï¼Œè¦è®¤è¯
{"to": "account123"}             â† è´Ÿè½½æ•°æ®ï¼Œè¦åŠ å¯†+è®¤è¯
```

2. **åè®®å®Œæ•´æ€§ä¿æŠ¤**
```
TLSè®°å½•ï¼š
[ç‰ˆæœ¬å·][ç±»å‹][é•¿åº¦] + [åŠ å¯†çš„åº”ç”¨æ•°æ®]
     â†‘                      â†‘
  å…³è”æ•°æ®                è´Ÿè½½æ•°æ®
```

3. **ä¸Šä¸‹æ–‡ç»‘å®š**
```
ç¡®ä¿å¯†æ–‡åªèƒ½åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼š
- ç‰¹å®šçš„åè®®ç‰ˆæœ¬
- ç‰¹å®šçš„é€šä¿¡åŒæ–¹
- ç‰¹å®šçš„æ—¶é—´çª—å£
```

### 4.3 å…³è”æ•°æ®å¤„ç†æµç¨‹


**ğŸ“‹ åŠ å¯†æ—¶çš„å¤„ç†**

```python
def aead_encrypt(plaintext, key, iv, associated_data):
    """
    plaintext: è¦åŠ å¯†çš„æ•°æ®
    associated_data: è¦è®¤è¯ä½†ä¸åŠ å¯†çš„æ•°æ®
    """
    # ç¬¬1æ­¥ï¼šåŠ å¯†æ˜æ–‡
    ciphertext = encrypt(plaintext, key, iv)
    
    # ç¬¬2æ­¥ï¼šè®¡ç®—è®¤è¯æ ‡ç­¾
    # æ³¨æ„ï¼šè®¤è¯æ ‡ç­¾è¦†ç›–å…³è”æ•°æ®å’Œå¯†æ–‡
    auth_input = associated_data + ciphertext
    tag = compute_auth_tag(auth_input, key)
    
    return ciphertext, tag

def aead_decrypt(ciphertext, tag, key, iv, associated_data):
    # ç¬¬1æ­¥ï¼šéªŒè¯è®¤è¯æ ‡ç­¾
    auth_input = associated_data + ciphertext
    computed_tag = compute_auth_tag(auth_input, key)
    
    if computed_tag != tag:
        raise Exception("å…³è”æ•°æ®æˆ–å¯†æ–‡è¢«ç¯¡æ”¹ï¼")
    
    # ç¬¬2æ­¥ï¼šè§£å¯†
    plaintext = decrypt(ciphertext, key, iv)
    return plaintext
```

### 4.4 å…³è”æ•°æ®çš„å®é™…åº”ç”¨


**ğŸŒ TLSåè®®ä¸­çš„åº”ç”¨**

```
TLSè®°å½•æ ¼å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TLSè®°å½•å¤´       â”‚   åŠ å¯†è´Ÿè½½      â”‚
â”‚ [ç±»å‹][ç‰ˆæœ¬][é•¿åº¦] â”‚   [åº”ç”¨æ•°æ®]    â”‚
â”‚   (å…³è”æ•°æ®)      â”‚   (åŠ å¯†æ•°æ®)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½œç”¨ï¼š
- é˜²æ­¢è®°å½•å¤´è¢«ç¯¡æ”¹
- ç¡®ä¿è®°å½•çš„å®Œæ•´æ€§
- é˜²æ­¢è®°å½•é‡æ’æ”»å‡»
```

**ğŸ’³ æ”¯ä»˜ç³»ç»Ÿä¸­çš„åº”ç”¨**

```
æ”¯ä»˜è¯·æ±‚ï¼š
å…³è”æ•°æ®ï¼š{
  "merchant_id": "12345",
  "timestamp": "2025-08-09T16:00:00Z",
  "transaction_id": "tx_789"
}

åŠ å¯†æ•°æ®ï¼š{
  "card_number": "4111111111111111",
  "amount": 100.00,
  "currency": "USD"
}

å¥½å¤„ï¼š
- å•†æˆ·IDã€æ—¶é—´æˆ³ç­‰å¯ä»¥è¢«è·¯ç”±ç³»ç»Ÿè¯»å–
- æ•æ„Ÿçš„å¡å·ã€é‡‘é¢ç­‰å¾—åˆ°åŠ å¯†ä¿æŠ¤
- æ•´ä¸ªè¯·æ±‚çš„å®Œæ•´æ€§éƒ½å¾—åˆ°ä¿è¯
```

---

## 5. ğŸš€ å®é™…åº”ç”¨ä¸æœ€ä½³å®è·µ


### 5.1 é€‰æ‹©åˆé€‚çš„AEADç®—æ³•


**ğŸ“Š ç®—æ³•é€‰æ‹©æŒ‡å—**

```
Webåº”ç”¨ï¼ˆHTTPSï¼‰ï¼š
æ¨èï¼šAES-GCM
åŸå› ï¼šæµè§ˆå™¨æ”¯æŒå¥½ï¼Œæ€§èƒ½é«˜

ç§»åŠ¨åº”ç”¨ï¼š
æ¨èï¼šChaCha20-Poly1305
åŸå› ï¼šåœ¨ARMå¤„ç†å™¨ä¸Šæ€§èƒ½æ›´å¥½

IoTè®¾å¤‡ï¼š  
æ¨èï¼šAES-CCM
åŸå› ï¼šå†…å­˜å ç”¨å°ï¼Œå®ç°ç®€å•

é«˜æ€§èƒ½æœåŠ¡å™¨ï¼š
æ¨èï¼šAES-GCMï¼ˆç¡¬ä»¶åŠ é€Ÿï¼‰
åŸå› ï¼šç°ä»£CPUæœ‰ä¸“é—¨æŒ‡ä»¤
```

**âš ï¸ å¸¸è§é€‰æ‹©è¯¯åŒº**

```
âŒ é”™è¯¯ï¼šåªçœ‹ç®—æ³•åç§°é€‰æ‹©
âœ… æ­£ç¡®ï¼šæ ¹æ®å®é™…åº”ç”¨åœºæ™¯é€‰æ‹©

âŒ é”™è¯¯ï¼šè‡ªå·±å®ç°AEADç®—æ³•
âœ… æ­£ç¡®ï¼šä½¿ç”¨ç»è¿‡éªŒè¯çš„åº“

âŒ é”™è¯¯ï¼šé‡ç”¨å¯†é’¥å’ŒIV
âœ… æ­£ç¡®ï¼šæ¯æ¬¡åŠ å¯†ä½¿ç”¨ä¸åŒçš„IV
```

### 5.2 å¯†é’¥å’ŒIVç®¡ç†


**ğŸ”‘ å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ**

```python
# âœ… æ­£ç¡®çš„å¯†é’¥æ´¾ç”Ÿ
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.hazmat.primitives import hashes

def derive_key(password, salt):
    kdf = PBKDF2HMAC(
        algorithm=hashes.SHA256(),
        length=32,  # AES-256éœ€è¦32å­—èŠ‚å¯†é’¥
        salt=salt,
        iterations=100000,  # è¶³å¤Ÿçš„è¿­ä»£æ¬¡æ•°
    )
    return kdf.derive(password.encode())

# âœ… æ­£ç¡®çš„IVç”Ÿæˆ
import os

def generate_iv():
    return os.urandom(12)  # GCMæ¨è96ä½IV
```

**ğŸ”„ IVé‡ç”¨çš„å±é™©æ€§**

```
å±é™©ç¤ºä¾‹ï¼š
ç›¸åŒå¯†é’¥ + ç›¸åŒIV + ä¸åŒæ˜æ–‡ = å®‰å…¨ç¾éš¾

æ˜æ–‡1ï¼šã€Œè½¬è´¦1000å…ƒã€
æ˜æ–‡2ï¼šã€Œè½¬è´¦2000å…ƒã€
ä½¿ç”¨ç›¸åŒIVåŠ å¯†åï¼Œæ”»å‡»è€…å¯èƒ½ï¼š
1. æ¨æ–­å‡ºæ˜æ–‡çš„å·®å¼‚
2. æ„é€ æ–°çš„æœ‰æ•ˆå¯†æ–‡
3. å®Œå…¨ç ´è§£åŠ å¯†ç³»ç»Ÿ
```

### 5.3 å®é™…ä»£ç ç¤ºä¾‹


**ğŸ”§ Pythonå®ç°ç¤ºä¾‹**

```python
from cryptography.hazmat.primitives.ciphers.aead import AESGCM
import os

class SecureMessaging:
    def __init__(self, key=None):
        if key is None:
            key = AESGCM.generate_key(bit_length=256)
        self.aead = AESGCM(key)
    
    def encrypt_message(self, message, context_info=None):
        """
        åŠ å¯†æ¶ˆæ¯
        message: è¦åŠ å¯†çš„æ¶ˆæ¯
        context_info: ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆå…³è”æ•°æ®ï¼‰
        """
        # ç”ŸæˆéšæœºIV
        iv = os.urandom(12)
        
        # å‡†å¤‡å…³è”æ•°æ®
        associated_data = context_info.encode() if context_info else b""
        
        # AEADåŠ å¯†
        ciphertext = self.aead.encrypt(
            nonce=iv,
            data=message.encode(),
            associated_data=associated_data
        )
        
        return {
            'iv': iv.hex(),
            'ciphertext': ciphertext.hex(),
            'context': context_info
        }
    
    def decrypt_message(self, encrypted_data):
        """
        è§£å¯†æ¶ˆæ¯
        """
        iv = bytes.fromhex(encrypted_data['iv'])
        ciphertext = bytes.fromhex(encrypted_data['ciphertext'])
        context = encrypted_data.get('context', '')
        
        associated_data = context.encode() if context else b""
        
        try:
            plaintext = self.aead.decrypt(
                nonce=iv,
                data=ciphertext,
                associated_data=associated_data
            )
            return plaintext.decode()
        except Exception:
            raise Exception("è§£å¯†å¤±è´¥ï¼šæ¶ˆæ¯å¯èƒ½è¢«ç¯¡æ”¹")

# ä½¿ç”¨ç¤ºä¾‹
messenger = SecureMessaging()

# åŠ å¯†
encrypted = messenger.encrypt_message(
    message="è½¬è´¦1000å…ƒç»™å¼ ä¸‰",
    context_info="mobile_banking_v2.1"
)

# è§£å¯†
decrypted = messenger.decrypt_message(encrypted)
print(f"è§£å¯†ç»“æœï¼š{decrypted}")
```

### 5.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**

```python
# ğŸš€ æ‰¹é‡å¤„ç†ä¼˜åŒ–
def encrypt_bulk_data(data_list, key):
    aead = AESGCM(key)
    results = []
    
    for data in data_list:
        iv = os.urandom(12)
        ciphertext = aead.encrypt(iv, data, b"")
        results.append((iv, ciphertext))
    
    return results

# ğŸš€ ç¡¬ä»¶åŠ é€Ÿæ£€æŸ¥
def check_hardware_acceleration():
    """æ£€æŸ¥æ˜¯å¦æ”¯æŒAES-NIæŒ‡ä»¤"""
    import cpuinfo
    info = cpuinfo.get_cpu_info()
    return 'aes' in info.get('flags', [])

# ğŸš€ ç®—æ³•é€‰æ‹©ä¼˜åŒ–
def choose_optimal_aead():
    if check_hardware_acceleration():
        return "AES-GCM"  # ç¡¬ä»¶åŠ é€Ÿ
    else:
        return "ChaCha20-Poly1305"  # è½¯ä»¶å®ç°æ›´å¿«
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è®¤è¯åŠ å¯†æœ¬è´¨ï¼šåŒæ—¶æä¾›ä¿å¯†æ€§å’Œå®Œæ•´æ€§ä¿æŠ¤
ğŸ”¸ Encrypt-then-MACï¼šæœ€å®‰å…¨çš„ä¼ ç»Ÿè®¤è¯åŠ å¯†èŒƒå¼  
ğŸ”¸ AEADç®—æ³•ï¼šç°ä»£è®¤è¯åŠ å¯†çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆ
ğŸ”¸ å…³è”æ•°æ®ï¼šéœ€è¦è®¤è¯ä½†ä¸éœ€è¦åŠ å¯†çš„æ•°æ®
ğŸ”¸ ç®—æ³•é€‰æ‹©ï¼šæ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„AEADç®—æ³•
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è®¤è¯åŠ å¯†**
```
ç°å®å¨èƒï¼š
- ç½‘ç»œä¼ è¾“ä¸­çš„æ•°æ®ç¯¡æ”¹
- æ¶æ„ä¿®æ”¹åŠ å¯†æ¶ˆæ¯å†…å®¹  
- é‡æ”¾æ”»å‡»å’Œä¼ªé€ æ”»å‡»

è§£å†³æ–¹æ¡ˆï¼š
- åŠ å¯†ä¿æŠ¤ä¿å¯†æ€§
- è®¤è¯ä¿æŠ¤å®Œæ•´æ€§
- ä¸¤è€…ç»“åˆæä¾›å…¨é¢ä¿æŠ¤
```

**ğŸ”¹ AEADçš„æ ¸å¿ƒä¼˜åŠ¿**
```
ä¸€ä½“åŒ–è®¾è®¡ï¼š
- ä¸€æ¬¡è°ƒç”¨å®ŒæˆåŠ å¯†å’Œè®¤è¯
- é¿å…äº†ä¼ ç»Ÿæ–¹æ¡ˆçš„ç»„åˆé”™è¯¯
- æ€§èƒ½æ›´å¥½ï¼Œå®‰å…¨æ€§æ›´é«˜

å…³è”æ•°æ®æ”¯æŒï¼š
- ä¿æŠ¤åè®®å¤´éƒ¨ä¿¡æ¯
- æä¾›ä¸Šä¸‹æ–‡ç»‘å®š
- é˜²æ­¢æ¶ˆæ¯é‡æ’æ”»å‡»
```

**ğŸ”¹ å®é™…åº”ç”¨è¦ç‚¹**
```
å¯†é’¥ç®¡ç†ï¼š
- ä½¿ç”¨å¼ºå¯†é’¥æ´¾ç”Ÿå‡½æ•°
- ç»ä¸é‡ç”¨IV/Nonce
- å®šæœŸè½®æ¢åŠ å¯†å¯†é’¥

ç®—æ³•é€‰æ‹©ï¼š
- Webåº”ç”¨ï¼šAES-GCM
- ç§»åŠ¨è®¾å¤‡ï¼šChaCha20-Poly1305  
- åµŒå…¥å¼ï¼šAES-CCM
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ åº”ç”¨åœºæ™¯**
- **HTTPS/TLS**ï¼šWebå®‰å…¨é€šä¿¡çš„åŸºç¡€
- **VPNéš§é“**ï¼šç½‘ç»œå±‚å®‰å…¨ä¼ è¾“
- **æ–‡ä»¶åŠ å¯†**ï¼šæ•æ„Ÿæ–‡ä»¶çš„å®‰å…¨å­˜å‚¨
- **å³æ—¶é€šè®¯**ï¼šèŠå¤©æ¶ˆæ¯çš„ç«¯åˆ°ç«¯åŠ å¯†
- **ç§»åŠ¨æ”¯ä»˜**ï¼šé‡‘èäº¤æ˜“çš„å®‰å…¨ä¿æŠ¤

**ğŸ”§ å·¥ç¨‹å®è·µ**
- **é€‰æ‹©æˆç†Ÿåº“**ï¼šä½¿ç”¨ç»è¿‡éªŒè¯çš„åŠ å¯†åº“
- **æ­£ç¡®å‚æ•°é…ç½®**ï¼šå¯†é’¥é•¿åº¦ã€IVç®¡ç†ã€è¿­ä»£æ¬¡æ•°
- **é”™è¯¯å¤„ç†**ï¼šè®¤è¯å¤±è´¥æ—¶çš„å®‰å…¨å“åº”
- **æ€§èƒ½ç›‘æ§**ï¼šåŠ å¯†è§£å¯†æ“ä½œçš„æ€§èƒ½å½±å“

**æ ¸å¿ƒè®°å¿†**ï¼š
- è®¤è¯åŠ å¯† = åŠ å¯† + è®¤è¯ï¼Œä¸¤è€…ç¼ºä¸€ä¸å¯
- AEADç®—æ³•æ˜¯ç°ä»£æ ‡å‡†ï¼Œä¸€æ¬¡è°ƒç”¨è§£å†³æ‰€æœ‰é—®é¢˜
- å…³è”æ•°æ®è®©åè®®å¤´éƒ¨ä¹Ÿèƒ½å¾—åˆ°ä¿æŠ¤
- æ­£ç¡®çš„å¯†é’¥å’ŒIVç®¡ç†æ˜¯å®‰å…¨çš„å‰æ