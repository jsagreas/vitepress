---
title: 1ã€æ¶ˆæ¯è®¤è¯ç (HMAC)
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯HMAC](#1-ä»€ä¹ˆæ˜¯HMAC)
2. [HMACæ„é€ åŸç†](#2-HMACæ„é€ åŸç†)
3. [ä¸æ™®é€šå“ˆå¸Œçš„åŒºåˆ«](#3-ä¸æ™®é€šå“ˆå¸Œçš„åŒºåˆ«)
4. [HMACç®—æ³•å®ç°](#4-HMACç®—æ³•å®ç°)
5. [åº”ç”¨åœºæ™¯åˆ†æ](#5-åº”ç”¨åœºæ™¯åˆ†æ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä»€ä¹ˆæ˜¯HMAC


### 1.1 åŸºæœ¬æ¦‚å¿µ


**HMACï¼ˆHash-based Message Authentication Codeï¼‰**ï¼Œä¸­æ–‡å«åš**åŸºäºå“ˆå¸Œçš„æ¶ˆæ¯è®¤è¯ç **ã€‚

ğŸ¯ **é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ä½ ç»™æœ‹å‹å¯„åŒ…è£¹ï¼š
- æ™®é€šåŒ…è£¹ï¼šä»»ä½•äººéƒ½èƒ½æ‰“å¼€çœ‹å†…å®¹
- åŠ äº†HMACçš„åŒ…è£¹ï¼šåªæœ‰ä½ å’Œæœ‹å‹çŸ¥é“çš„"æš—å·"æ‰èƒ½éªŒè¯åŒ…è£¹æ²¡è¢«åŠ¨è¿‡

HMACå°±æ˜¯è¿™ä¸ª"æš—å·"ï¼Œç”¨æ¥è¯æ˜ï¼š
âœ… æ¶ˆæ¯ç¡®å®æ˜¯ä½ å‘çš„ï¼ˆèº«ä»½è®¤è¯ï¼‰
âœ… æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡è¢«ç¯¡æ”¹ï¼ˆå®Œæ•´æ€§éªŒè¯ï¼‰
```

### 1.2 HMACè§£å†³çš„æ ¸å¿ƒé—®é¢˜


**ğŸš« æ™®é€šå“ˆå¸Œçš„é—®é¢˜**ï¼š
```
æ™®é€šå“ˆå¸Œï¼ˆå¦‚MD5ã€SHA1ï¼‰ï¼š
æ¶ˆæ¯ï¼š"Hello World" â†’ å“ˆå¸Œå€¼ï¼šb10a8db164e0754105b7a99be72e3fe5

é—®é¢˜ï¼šä»»ä½•äººéƒ½èƒ½è®¡ç®—è¿™ä¸ªå“ˆå¸Œå€¼
æ”»å‡»è€…å¯ä»¥ï¼š
1. ä¿®æ”¹æ¶ˆæ¯ä¸ºï¼š"Hello Hacker"  
2. é‡æ–°è®¡ç®—å“ˆå¸Œå€¼
3. æ¥æ”¶æ–¹æ— æ³•å‘ç°æ¶ˆæ¯è¢«ç¯¡æ”¹
```

**âœ… HMACçš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
HMACéœ€è¦ä¸€ä¸ªå¯†é’¥ï¼ˆåªæœ‰å‘é€æ–¹å’Œæ¥æ”¶æ–¹çŸ¥é“ï¼‰ï¼š
æ¶ˆæ¯ï¼š"Hello World" + å¯†é’¥ï¼š"secret123" â†’ HMACå€¼ï¼šxxx

æ”»å‡»è€…å³ä½¿çœ‹åˆ°æ¶ˆæ¯å’ŒHMACå€¼ï¼Œä½†ä¸çŸ¥é“å¯†é’¥ï¼Œå°±æ— æ³•ï¼š
âŒ ä¼ªé€ æœ‰æ•ˆçš„HMACå€¼
âŒ ç¯¡æ”¹æ¶ˆæ¯åç”Ÿæˆæ­£ç¡®çš„HMAC
```

### 1.3 HMACçš„æ ¸å¿ƒç‰¹æ€§


| ç‰¹æ€§ | **è¯´æ˜** | **ä½œç”¨** |
|------|---------|---------|
| ğŸ”‘ **å¯†é’¥ä¾èµ–** | `å¿…é¡»çŸ¥é“å¯†é’¥æ‰èƒ½è®¡ç®—å’ŒéªŒè¯` | `é˜²æ­¢ä¼ªé€ å’Œç¯¡æ”¹` |
| ğŸ›¡ï¸ **æŠ—ç¢°æ’** | `å¾ˆéš¾æ‰¾åˆ°ä¸¤ä¸ªä¸åŒæ¶ˆæ¯äº§ç”Ÿç›¸åŒHMAC` | `ä¿è¯å”¯ä¸€æ€§` |
| âš¡ **é«˜æ•ˆæ€§** | `è®¡ç®—é€Ÿåº¦å¿«ï¼Œé€‚åˆå¤§é‡æ•°æ®` | `å®ç”¨æ€§å¼º` |
| ğŸ”’ **ä¸å¯é€†** | `ä»HMACå€¼æ¨ä¸å‡ºåŸå§‹æ¶ˆæ¯æˆ–å¯†é’¥` | `å®‰å…¨æ€§ä¿éšœ` |

---

## 2. âš™ï¸ HMACæ„é€ åŸç†


### 2.1 HMACçš„æ•°å­¦å…¬å¼


**ğŸ“‹ æ ‡å‡†å…¬å¼**ï¼š
```
HMAC(K, M) = H((K âŠ• opad) âˆ¥ H((K âŠ• ipad) âˆ¥ M))

å…¶ä¸­ï¼š
K = å¯†é’¥
M = æ¶ˆæ¯
H = å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚SHA-256ï¼‰
âŠ• = å¼‚æˆ–è¿ç®—
âˆ¥ = è¿æ¥æ“ä½œ
ipad = å†…éƒ¨å¡«å……ï¼ˆ0x36é‡å¤ï¼‰
opad = å¤–éƒ¨å¡«å……ï¼ˆ0x5Cé‡å¤ï¼‰
```

ğŸ¤” **å¬èµ·æ¥å¤æ‚ï¼Ÿè®©æˆ‘ä»¬ç”¨ç®€å•çš„è¯è§£é‡Š**ï¼š

### 2.2 HMACæ„é€ æ­¥éª¤è¯¦è§£


**ğŸ”¸ æ­¥éª¤1ï¼šå¯†é’¥é¢„å¤„ç†**
```
å¦‚æœå¯†é’¥å¤ªçŸ­ï¼šç”¨0å¡«å……åˆ°å“ˆå¸Œå‡½æ•°çš„å—å¤§å°
å¦‚æœå¯†é’¥å¤ªé•¿ï¼šå…ˆå“ˆå¸Œä¸€éï¼Œå†ç”¨0å¡«å……

ä¾‹å¦‚SHA-256çš„å—å¤§å°æ˜¯64å­—èŠ‚ï¼š
å¯†é’¥"secret" â†’ å¡«å……åå˜æˆ64å­—èŠ‚çš„å¯†é’¥
```

**ğŸ”¸ æ­¥éª¤2ï¼šç”Ÿæˆå†…éƒ¨å’Œå¤–éƒ¨å¯†é’¥**
```
å†…éƒ¨å¯†é’¥ = å¯†é’¥ âŠ• ipadï¼ˆ0x36363636...ï¼‰
å¤–éƒ¨å¯†é’¥ = å¯†é’¥ âŠ• opadï¼ˆ0x5C5C5C5C...ï¼‰

ğŸ’¡ ä¸ºä»€ä¹ˆè¦å¼‚æˆ–ï¼Ÿ
- è®©å†…éƒ¨å’Œå¤–éƒ¨å¯†é’¥ä¸åŒ
- å¢åŠ å®‰å…¨æ€§ï¼Œé˜²æ­¢æŸäº›ç‰¹æ®Šæ”»å‡»
```

**ğŸ”¸ æ­¥éª¤3ï¼šä¸¤è½®å“ˆå¸Œè®¡ç®—**
```
ç¬¬ä¸€è½®ï¼ˆå†…éƒ¨ï¼‰ï¼š
H1 = SHA-256(å†…éƒ¨å¯†é’¥ + æ¶ˆæ¯)

ç¬¬äºŒè½®ï¼ˆå¤–éƒ¨ï¼‰ï¼š
HMAC = SHA-256(å¤–éƒ¨å¯†é’¥ + H1)
```

### 2.3 å›¾è§£HMACæ„é€ è¿‡ç¨‹


```
åŸå§‹å¯†é’¥: "secret123"
æ¶ˆæ¯å†…å®¹: "Hello World"

ç¬¬1æ­¥ï¼šå¯†é’¥é¢„å¤„ç†
å¯†é’¥ â†’ [å¡«å……åˆ°64å­—èŠ‚] â†’ K

ç¬¬2æ­¥ï¼šç”Ÿæˆä¸¤ä¸ªä¸åŒçš„å¯†é’¥  
K âŠ• 0x36363636... â†’ å†…éƒ¨å¯†é’¥ (ikey)
K âŠ• 0x5C5C5C5C... â†’ å¤–éƒ¨å¯†é’¥ (okey)

ç¬¬3æ­¥ï¼šä¸¤è½®å“ˆå¸Œ
ikey + "Hello World" â†’ SHA-256 â†’ ä¸­é—´å“ˆå¸Œå€¼
okey + ä¸­é—´å“ˆå¸Œå€¼ â†’ SHA-256 â†’ æœ€ç»ˆHMACå€¼
```

### 2.4 ä¸ºä»€ä¹ˆè¦è®¾è®¡å¾—è¿™ä¹ˆå¤æ‚ï¼Ÿ


**ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘**ï¼š
```
å•è½®å“ˆå¸Œçš„é—®é¢˜ï¼š
ç®€å•çš„ SHA-256(å¯†é’¥ + æ¶ˆæ¯) å®¹æ˜“å—åˆ°"é•¿åº¦æ‰©å±•æ”»å‡»"

åŒè½®å“ˆå¸Œçš„ä¼˜åŠ¿ï¼š
âœ… é˜²æ­¢é•¿åº¦æ‰©å±•æ”»å‡»
âœ… å³ä½¿éƒ¨åˆ†ä¿¡æ¯æ³„éœ²ï¼Œä»ç„¶å®‰å…¨
âœ… ç¬¦åˆå¯†ç å­¦çš„å®‰å…¨è¯æ˜
```

---

## 3. ğŸ” ä¸æ™®é€šå“ˆå¸Œçš„åŒºåˆ«


### 3.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”


| ç»´åº¦ | **æ™®é€šå“ˆå¸Œ** | **HMAC** |
|------|-------------|----------|
| ğŸ”‘ **å¯†é’¥éœ€æ±‚** | `æ— éœ€å¯†é’¥` | `å¿…é¡»æœ‰å¯†é’¥` |
| ğŸ¯ **ä¸»è¦ç”¨é€”** | `æ•°æ®æŒ‡çº¹ã€å®Œæ•´æ€§æ£€æŸ¥` | `èº«ä»½è®¤è¯ã€æ¶ˆæ¯è®¤è¯` |
| ğŸ›¡ï¸ **å®‰å…¨æ€§** | `ä»»ä½•äººéƒ½èƒ½è®¡ç®—` | `åªæœ‰çŸ¥é“å¯†é’¥çš„äººèƒ½è®¡ç®—` |
| âš¡ **è®¡ç®—å¤æ‚åº¦** | `ä¸€æ¬¡å“ˆå¸Œ` | `ä¸¤æ¬¡å“ˆå¸Œ` |
| ğŸ”’ **é˜²ä¼ªé€ ** | `æ— æ³•é˜²ä¼ªé€ ` | `èƒ½æœ‰æ•ˆé˜²ä¼ªé€ ` |

### 3.2 å®é™…åº”ç”¨å¯¹æ¯”


**ğŸ”¸ æ™®é€šå“ˆå¸Œçš„åº”ç”¨åœºæ™¯**ï¼š
```
æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥ï¼š
ä¸‹è½½æ–‡ä»¶ â†’ è®¡ç®—SHA-256 â†’ ä¸å®˜æ–¹æä¾›çš„å“ˆå¸Œå€¼å¯¹æ¯”
ç›®çš„ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå

å±€é™æ€§ï¼š
âŒ æ— æ³•ç¡®è®¤æ–‡ä»¶æ¥æºæ˜¯å¦å¯ä¿¡
âŒ æ”»å‡»è€…å¯ä»¥æ›¿æ¢æ–‡ä»¶å’Œå“ˆå¸Œå€¼
```

**ğŸ”¸ HMACçš„åº”ç”¨åœºæ™¯**ï¼š
```
APIæ¥å£è®¤è¯ï¼š
è¯·æ±‚å‚æ•° + å¯†é’¥ â†’ è®¡ç®—HMAC â†’ é™„åŠ åˆ°è¯·æ±‚ä¸­
æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ â†’ ç”¨ç›¸åŒå¯†é’¥éªŒè¯HMAC

ä¼˜åŠ¿ï¼š
âœ… ç¡®è®¤è¯·æ±‚æ¥æºå¯ä¿¡
âœ… é˜²æ­¢è¯·æ±‚è¢«ç¯¡æ”¹
âœ… å³ä½¿è¯·æ±‚è¢«æˆªè·ï¼Œä¹Ÿæ— æ³•ä¼ªé€ 
```

### 3.3 å®‰å…¨æ€§å¯¹æ¯”ç¤ºä¾‹


**ğŸš« æ™®é€šå“ˆå¸Œè¢«æ”»å‡»çš„ä¾‹å­**ï¼š
```
åŸå§‹åœºæ™¯ï¼š
å®¢æˆ·ç«¯å‘é€ï¼š{"amount": 100, "hash": "abc123"}
æœåŠ¡å™¨éªŒè¯ï¼šè®¡ç®—{"amount": 100}çš„å“ˆå¸Œï¼Œä¸abc123å¯¹æ¯”

æ”»å‡»è¿‡ç¨‹ï¼š
1. æ”»å‡»è€…æˆªè·æ¶ˆæ¯
2. ä¿®æ”¹ä¸ºï¼š{"amount": 1000000}
3. é‡æ–°è®¡ç®—å“ˆå¸Œï¼šSHA-256("amount=1000000") = "def456"
4. å‘é€ï¼š{"amount": 1000000, "hash": "def456"}
5. æœåŠ¡å™¨éªŒè¯é€šè¿‡ï¼âŒ
```

**âœ… HMACé˜²æŠ¤çš„ä¾‹å­**ï¼š
```
å®‰å…¨åœºæ™¯ï¼š
å®¢æˆ·ç«¯å‘é€ï¼š{"amount": 100, "hmac": "xyz789"}
å…¶ä¸­hmac = HMAC_SHA256(secret, "amount=100")

æ”»å‡»å¤±è´¥ï¼š
1. æ”»å‡»è€…æˆªè·æ¶ˆæ¯
2. ä¿®æ”¹ä¸ºï¼š{"amount": 1000000}
3. æ— æ³•è®¡ç®—æ­£ç¡®çš„HMACï¼ˆä¸çŸ¥é“secretï¼‰
4. æœåŠ¡å™¨éªŒè¯å¤±è´¥ï¼âœ…
```

---

## 4. ğŸ’» HMACç®—æ³•å®ç°


### 4.1 Pythonå®ç°ç¤ºä¾‹


```python
import hashlib
import hmac

def simple_hmac_demo():
    """ç®€å•çš„HMACä½¿ç”¨ç¤ºä¾‹"""
    # å¯†é’¥å’Œæ¶ˆæ¯
    secret_key = "my_secret_key_123"
    message = "Hello, HMAC World!"
    
    # ä½¿ç”¨Pythonå†…ç½®çš„hmacåº“
    hmac_value = hmac.new(
        secret_key.encode('utf-8'),     # å¯†é’¥
        message.encode('utf-8'),        # æ¶ˆæ¯
        hashlib.sha256                  # å“ˆå¸Œç®—æ³•
    ).hexdigest()
    
    print(f"æ¶ˆæ¯: {message}")
    print(f"å¯†é’¥: {secret_key}")
    print(f"HMAC: {hmac_value}")
    
    return hmac_value

def hmac_verification_demo():
    """HMACéªŒè¯ç¤ºä¾‹"""
    secret = "shared_secret"
    
    # å‘é€æ–¹è®¡ç®—HMAC
    original_msg = "transfer 1000 to account B"
    sender_hmac = hmac.new(
        secret.encode(), 
        original_msg.encode(), 
        hashlib.sha256
    ).hexdigest()
    
    print("=" * 50)
    print("å‘é€æ–¹:")
    print(f"æ¶ˆæ¯: {original_msg}")
    print(f"HMAC: {sender_hmac}")
    
    # æ¥æ”¶æ–¹éªŒè¯HMAC
    received_msg = "transfer 1000 to account B"  # å‡è®¾æ¶ˆæ¯æœªè¢«ç¯¡æ”¹
    receiver_hmac = hmac.new(
        secret.encode(), 
        received_msg.encode(), 
        hashlib.sha256
    ).hexdigest()
    
    print("\næ¥æ”¶æ–¹:")
    print(f"æ”¶åˆ°æ¶ˆæ¯: {received_msg}")
    print(f"è®¡ç®—HMAC: {receiver_hmac}")
    print(f"éªŒè¯ç»“æœ: {'âœ… é€šè¿‡' if sender_hmac == receiver_hmac else 'âŒ å¤±è´¥'}")

# è¿è¡Œç¤ºä¾‹
simple_hmac_demo()
hmac_verification_demo()
```

### 4.2 æ‰‹åŠ¨å®ç°HMACï¼ˆæ•™å­¦ç”¨ï¼‰


```python
import hashlib

def manual_hmac(key, message, hash_func=hashlib.sha256):
    """
    æ‰‹åŠ¨å®ç°HMACï¼Œå¸®åŠ©ç†è§£åŸç†
    æ³¨æ„ï¼šå®é™…é¡¹ç›®è¯·ä½¿ç”¨æ ‡å‡†åº“
    """
    # 1. å¯†é’¥é¢„å¤„ç†
    block_size = 64  # SHA-256çš„å—å¤§å°
    if len(key) > block_size:
        key = hash_func(key).digest()  # å¯†é’¥å¤ªé•¿å°±å…ˆå“ˆå¸Œ
    
    key = key.ljust(block_size, b'\x00')  # å¡«å……åˆ°å—å¤§å°
    
    # 2. ç”Ÿæˆå†…éƒ¨å’Œå¤–éƒ¨å¯†é’¥
    ipad = bytes([0x36] * block_size)  # å†…éƒ¨å¡«å……
    opad = bytes([0x5C] * block_size)  # å¤–éƒ¨å¡«å……
    
    inner_key = bytes([k ^ i for k, i in zip(key, ipad)])
    outer_key = bytes([k ^ o for k, o in zip(key, opad)])
    
    # 3. ä¸¤è½®å“ˆå¸Œ
    inner_hash = hash_func(inner_key + message.encode()).digest()
    final_hmac = hash_func(outer_key + inner_hash).hexdigest()
    
    return final_hmac

# æµ‹è¯•æ‰‹åŠ¨å®ç°
test_key = "test_key"
test_msg = "test message"
manual_result = manual_hmac(test_key.encode(), test_msg)
standard_result = hmac.new(
    test_key.encode(), 
    test_msg.encode(), 
    hashlib.sha256
).hexdigest()

print(f"æ‰‹åŠ¨å®ç°: {manual_result}")
print(f"æ ‡å‡†åº“:   {standard_result}")
print(f"ç»“æœä¸€è‡´: {'âœ…' if manual_result == standard_result else 'âŒ'}")
```

### 4.3 JavaScriptå®ç°ç¤ºä¾‹


```javascript
// æµè§ˆå™¨ç¯å¢ƒä¸‹çš„HMACå®ç°
async function calculateHMAC(key, message) {
    // å°†å­—ç¬¦ä¸²è½¬ä¸ºArrayBuffer
    const encoder = new TextEncoder();
    const keyData = encoder.encode(key);
    const messageData = encoder.encode(message);
    
    // å¯¼å…¥å¯†é’¥
    const cryptoKey = await crypto.subtle.importKey(
        'raw',
        keyData,
        { name: 'HMAC', hash: 'SHA-256' },
        false,
        ['sign']
    );
    
    // è®¡ç®—HMAC
    const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);
    
    // è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
    const hashArray = Array.from(new Uint8Array(signature));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    
    return hashHex;
}

// ä½¿ç”¨ç¤ºä¾‹
calculateHMAC("my_secret", "Hello HMAC").then(result => {
    console.log("HMACç»“æœ:", result);
});
```

---

## 5. ğŸ¯ åº”ç”¨åœºæ™¯åˆ†æ


### 5.1 APIç­¾åè®¤è¯


**ğŸ”¸ åœºæ™¯æè¿°**ï¼š
```
é—®é¢˜ï¼šå¦‚ä½•ç¡®ä¿APIè¯·æ±‚çš„å®‰å…¨æ€§ï¼Ÿ
- é˜²æ­¢è¯·æ±‚è¢«ç¯¡æ”¹
- éªŒè¯è¯·æ±‚æ¥æº
- é˜²æ­¢é‡æ”¾æ”»å‡»
```

**ğŸ”¸ HMACè§£å†³æ–¹æ¡ˆ**ï¼š
```python
import time
import hmac
import hashlib
import json

def generate_api_signature(api_key, api_secret, params):
    """ç”ŸæˆAPIç­¾å"""
    # 1. æ·»åŠ æ—¶é—´æˆ³é˜²é‡æ”¾
    params['timestamp'] = int(time.time())
    
    # 2. å‚æ•°æ’åºå¹¶æ‹¼æ¥
    sorted_params = sorted(params.items())
    query_string = '&'.join([f"{k}={v}" for k, v in sorted_params])
    
    # 3. è®¡ç®—HMACç­¾å
    signature = hmac.new(
        api_secret.encode(),
        query_string.encode(),
        hashlib.sha256
    ).hexdigest()
    
    return signature, query_string

# å®¢æˆ·ç«¯ä½¿ç”¨
api_params = {
    'user_id': '12345',
    'action': 'transfer',
    'amount': '1000'
}

signature, query = generate_api_signature(
    'my_api_key', 
    'my_api_secret', 
    api_params
)

print(f"è¯·æ±‚å‚æ•°: {query}")
print(f"ç­¾å: {signature}")
```

**ğŸ”¸ æœåŠ¡å™¨ç«¯éªŒè¯**ï¼š
```python
def verify_api_signature(received_signature, api_secret, received_params):
    """æœåŠ¡å™¨ç«¯éªŒè¯ç­¾å"""
    # 1. æ£€æŸ¥æ—¶é—´æˆ³ï¼ˆé˜²é‡æ”¾æ”»å‡»ï¼‰
    current_time = int(time.time())
    if current_time - received_params.get('timestamp', 0) > 300:  # 5åˆ†é’Ÿè¶…æ—¶
        return False, "è¯·æ±‚è¶…æ—¶"
    
    # 2. é‡æ–°è®¡ç®—ç­¾å
    sorted_params = sorted(received_params.items())
    query_string = '&'.join([f"{k}={v}" for k, v in sorted_params])
    
    expected_signature = hmac.new(
        api_secret.encode(),
        query_string.encode(),
        hashlib.sha256
    ).hexdigest()
    
    # 3. æ¯”è¾ƒç­¾å
    if hmac.compare_digest(received_signature, expected_signature):
        return True, "éªŒè¯é€šè¿‡"
    else:
        return False, "ç­¾åä¸åŒ¹é…"
```

### 5.2 æ•°æ®å®Œæ•´æ€§æ ¡éªŒ


**ğŸ”¸ æ–‡ä»¶ä¼ è¾“æ ¡éªŒ**ï¼š
```python
def secure_file_transfer():
    """å®‰å…¨æ–‡ä»¶ä¼ è¾“ç¤ºä¾‹"""
    shared_secret = "file_transfer_secret"
    
    # å‘é€æ–¹
    file_content = "è¿™æ˜¯é‡è¦çš„æ–‡ä»¶å†…å®¹..."
    file_hmac = hmac.new(
        shared_secret.encode(),
        file_content.encode(),
        hashlib.sha256
    ).hexdigest()
    
    print("å‘é€æ–‡ä»¶:")
    print(f"å†…å®¹: {file_content}")
    print(f"HMAC: {file_hmac}")
    
    # æ¨¡æ‹Ÿä¼ è¾“ï¼ˆå¯èƒ½è¢«ç¯¡æ”¹ï¼‰
    received_content = "è¿™æ˜¯é‡è¦çš„æ–‡ä»¶å†…å®¹..."  # å‡è®¾æœªè¢«ç¯¡æ”¹
    received_hmac = file_hmac
    
    # æ¥æ”¶æ–¹éªŒè¯
    calculated_hmac = hmac.new(
        shared_secret.encode(),
        received_content.encode(),
        hashlib.sha256
    ).hexdigest()
    
    if hmac.compare_digest(received_hmac, calculated_hmac):
        print("âœ… æ–‡ä»¶å®Œæ•´ï¼Œæœªè¢«ç¯¡æ”¹")
    else:
        print("âŒ æ–‡ä»¶å¯èƒ½è¢«ç¯¡æ”¹ï¼Œæ‹’ç»æ¥æ”¶")

secure_file_transfer()
```

### 5.3 JWT Tokenç­¾å


**ğŸ”¸ ç®€åŒ–çš„JWT HMACç­¾å**ï¼š
```python
import base64
import json

def create_jwt_token(payload, secret):
    """åˆ›å»ºJWT Tokenï¼ˆç®€åŒ–ç‰ˆï¼‰"""
    # JWT Header
    header = {
        "alg": "HS256",
        "typ": "JWT"
    }
    
    # Base64ç¼–ç 
    header_b64 = base64.urlsafe_b64encode(
        json.dumps(header).encode()
    ).decode().rstrip('=')
    
    payload_b64 = base64.urlsafe_b64encode(
        json.dumps(payload).encode()
    ).decode().rstrip('=')
    
    # åˆ›å»ºç­¾å
    message = f"{header_b64}.{payload_b64}"
    signature = hmac.new(
        secret.encode(),
        message.encode(),
        hashlib.sha256
    ).digest()
    
    signature_b64 = base64.urlsafe_b64encode(signature).decode().rstrip('=')
    
    # å®Œæ•´Token
    token = f"{header_b64}.{payload_b64}.{signature_b64}"
    return token

# ä½¿ç”¨ç¤ºä¾‹
user_payload = {
    "user_id": "12345",
    "username": "john_doe",
    "exp": int(time.time()) + 3600  # 1å°æ—¶åè¿‡æœŸ
}

jwt_token = create_jwt_token(user_payload, "jwt_secret_key")
print(f"JWT Token: {jwt_token}")
```

### 5.4 åº”ç”¨åœºæ™¯å¯¹æ¯”è¡¨


| åº”ç”¨åœºæ™¯ | **HMACä½œç”¨** | **å…·ä½“ä»·å€¼** | **å®‰å…¨çº§åˆ«** |
|---------|-------------|-------------|-------------|
| ğŸŒ **APIè®¤è¯** | `éªŒè¯è¯·æ±‚åˆæ³•æ€§` | `é˜²æ­¢APIæ»¥ç”¨å’Œç¯¡æ”¹` | `â­â­â­â­â­` |
| ğŸ“ **æ–‡ä»¶ä¼ è¾“** | `æ ¡éªŒæ–‡ä»¶å®Œæ•´æ€§` | `ç¡®ä¿æ–‡ä»¶æœªè¢«ç¯¡æ”¹` | `â­â­â­â­` |
| ğŸ« **Tokenç­¾å** | `é˜²æ­¢Tokenä¼ªé€ ` | `ç¡®ä¿ç”¨æˆ·èº«ä»½å¯ä¿¡` | `â­â­â­â­â­` |
| ğŸ’¾ **æ•°æ®åº“è®¤è¯** | `è¿æ¥å­—ç¬¦ä¸²ç­¾å` | `é˜²æ­¢æ•°æ®åº“è¿æ¥è¢«åŠ«æŒ` | `â­â­â­â­` |
| ğŸ“§ **é‚®ä»¶éªŒè¯** | `é‚®ä»¶å†…å®¹ç­¾å` | `é˜²æ­¢é’“é±¼é‚®ä»¶` | `â­â­â­` |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ HMACæœ¬è´¨ï¼šåŸºäºå“ˆå¸Œçš„æ¶ˆæ¯è®¤è¯ç ï¼Œéœ€è¦å¯†é’¥æ‰èƒ½è®¡ç®—
ğŸ”¸ æ ¸å¿ƒä½œç”¨ï¼šèº«ä»½è®¤è¯ + æ¶ˆæ¯å®Œæ•´æ€§éªŒè¯
ğŸ”¸ æ„é€ åŸç†ï¼šä¸¤è½®å“ˆå¸Œï¼ˆå†…éƒ¨+å¤–éƒ¨ï¼‰ï¼Œä½¿ç”¨ä¸åŒçš„å¯†é’¥å˜æ¢
ğŸ”¸ å®‰å…¨ä¼˜åŠ¿ï¼šé˜²ä¼ªé€ ã€é˜²ç¯¡æ”¹ã€éœ€è¦å¯†é’¥æ‰èƒ½éªŒè¯
ğŸ”¸ åº”ç”¨ä»·å€¼ï¼šAPIç­¾åã€æ–‡ä»¶æ ¡éªŒã€Tokenè®¤è¯
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ HMAC vs æ™®é€šå“ˆå¸Œ**ï¼š
```
è®°å¿†æ–¹æ³•ï¼š
- æ™®é€šå“ˆå¸Œ = æŒ‡çº¹è¯†åˆ«ï¼ˆä»»ä½•äººéƒ½èƒ½çœ‹ï¼‰
- HMAC = å¯†ç é”ï¼ˆåªæœ‰çŸ¥é“å¯†ç çš„äººèƒ½å¼€ï¼‰

å®é™…åŒºåˆ«ï¼š
- æ™®é€šå“ˆå¸Œï¼šå…¬å¼€è®¡ç®—ï¼Œæ— æ³•é˜²ä¼ªé€ 
- HMACï¼šéœ€è¦å¯†é’¥ï¼Œèƒ½æœ‰æ•ˆé˜²ä¼ªé€ 
```

**ğŸ”¹ ä¸ºä»€ä¹ˆè¦ä¸¤è½®å“ˆå¸Œ**ï¼š
```
å•è½®é—®é¢˜ï¼š
- ç®€å•çš„Hash(å¯†é’¥+æ¶ˆæ¯)å®¹æ˜“å—æ”»å‡»
- é•¿åº¦æ‰©å±•æ”»å‡»ç­‰å®‰å…¨æ¼æ´

åŒè½®ä¼˜åŠ¿ï¼š
- å†…éƒ¨å’Œå¤–éƒ¨ä½¿ç”¨ä¸åŒå¯†é’¥å˜æ¢
- ç¬¦åˆå¯†ç å­¦å®‰å…¨è¯æ˜
- æŠµæŠ—å·²çŸ¥çš„å„ç§æ”»å‡»
```

**ğŸ”¹ å¯†é’¥ç®¡ç†çš„é‡è¦æ€§**ï¼š
```
å¯†é’¥å®‰å…¨ = HMACå®‰å…¨ï¼š
âœ… å¯†é’¥è¶³å¤Ÿéšæœºå’Œå¤æ‚
âœ… å¯†é’¥å®‰å…¨å­˜å‚¨å’Œä¼ è¾“
âœ… å®šæœŸæ›´æ¢å¯†é’¥
âŒ å¯†é’¥æ³„éœ² = ç³»ç»Ÿå®Œå…¨ä¸å®‰å…¨
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨HMAC**ï¼š
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… éœ€è¦éªŒè¯æ¶ˆæ¯æ¥æºå¯ä¿¡
âœ… éœ€è¦æ£€æµ‹æ¶ˆæ¯æ˜¯å¦è¢«ç¯¡æ”¹
âœ… åŒæ–¹å¯ä»¥å®‰å…¨å…±äº«å¯†é’¥
âœ… å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ æ— æ³•å®‰å…¨å…±äº«å¯†é’¥
âŒ éœ€è¦ä¸å¯å¦è®¤æ€§ï¼ˆç”¨æ•°å­—ç­¾åï¼‰
âŒ åªéœ€è¦æ•°æ®æŒ‡çº¹ï¼ˆç”¨æ™®é€šå“ˆå¸Œï¼‰
```

**ğŸ”§ å®ç°æœ€ä½³å®è·µ**ï¼š
```
å®‰å…¨å»ºè®®ï¼š
1. ä½¿ç”¨å¼ºå“ˆå¸Œç®—æ³•ï¼ˆSHA-256æˆ–æ›´é«˜ï¼‰
2. å¯†é’¥é•¿åº¦è‡³å°‘32å­—èŠ‚
3. ä½¿ç”¨æ’å®šæ—¶é—´æ¯”è¾ƒå‡½æ•°ï¼ˆhmac.compare_digestï¼‰
4. æ·»åŠ æ—¶é—´æˆ³é˜²é‡æ”¾æ”»å‡»
5. ç»“åˆHTTPSç­‰ä¼ è¾“å±‚å®‰å…¨
```

**ğŸ’¡ å¸¸è§é”™è¯¯é¿å…**ï¼š
```
æ–°æ‰‹æ˜“é”™ç‚¹ï¼š
âŒ ç›´æ¥å­—ç¬¦ä¸²æ¯”è¾ƒHMACï¼ˆæ—¶åºæ”»å‡»é£é™©ï¼‰
âŒ å¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
âŒ å¿½ç•¥æ—¶é—´æˆ³éªŒè¯
âŒ ä½¿ç”¨å¼±å“ˆå¸Œç®—æ³•ï¼ˆMD5ã€SHA1ï¼‰
âŒ å¯†é’¥ç®¡ç†ä¸å½“
```

### 6.4 ä¸å…¶ä»–æŠ€æœ¯çš„å…³ç³»


```
HMACåœ¨å®‰å…¨ä½“ç³»ä¸­çš„ä½ç½®ï¼š
ğŸ” å¯¹ç§°åŠ å¯†ï¼šä¿æŠ¤æ•°æ®å†…å®¹ä¸è¢«çœ‹åˆ°
ğŸ”‘ HMACï¼šéªŒè¯æ•°æ®æ¥æºå’Œå®Œæ•´æ€§
ğŸ“œ æ•°å­—ç­¾åï¼šæä¾›ä¸å¯å¦è®¤æ€§
ğŸ›¡ï¸ æ•°å­—è¯ä¹¦ï¼šéªŒè¯å…¬é’¥çœŸå®æ€§

ç»„åˆä½¿ç”¨æ•ˆæœæ›´ä½³ï¼š
HTTPS = TLS(å¯¹ç§°åŠ å¯†) + æ•°å­—è¯ä¹¦ + HMACç­‰
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- HMACæ˜¯å¸¦å¯†é’¥çš„å“ˆå¸Œï¼Œä¸“é—¨ç”¨æ¥è®¤è¯
- ä¸¤è½®å“ˆå¸Œä¿å®‰å…¨ï¼Œå†…å¤–å¯†é’¥ä¸ç›¸åŒ  
- APIç­¾åæ–‡ä»¶æ ¡éªŒï¼Œé˜²ç¯¡æ”¹é˜²ä¼ªé€ å¼º
- å¯†é’¥ç®¡ç†æ˜¯å…³é”®ï¼Œæ³„éœ²äº†å°±å…¨å®Œè›‹