---
title: 3ã€å¯†ç å­¦å®ç°å®‰å…¨
---
## ğŸ“š ç›®å½•

1. [å¯†ç å­¦å®ç°å®‰å…¨æ¦‚è¿°](#1-å¯†ç å­¦å®ç°å®‰å…¨æ¦‚è¿°)
2. [å®‰å…¨ç¼–ç¨‹æŒ‡å—](#2-å®‰å…¨ç¼–ç¨‹æŒ‡å—)
3. [å¸¸è§å®ç°é”™è¯¯](#3-å¸¸è§å®ç°é”™è¯¯)
4. [ä»£ç å®¡è®¡è¦ç‚¹](#4-ä»£ç å®¡è®¡è¦ç‚¹)
5. [æ€§èƒ½ä¸å®‰å…¨å¹³è¡¡](#5-æ€§èƒ½ä¸å®‰å…¨å¹³è¡¡)
6. [å®æˆ˜å®‰å…¨æ¡ˆä¾‹](#6-å®æˆ˜å®‰å…¨æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å¯†ç å­¦å®ç°å®‰å…¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¯†ç å­¦å®ç°å®‰å…¨


**ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ**
```
ç†è®ºå®‰å…¨ â‰  å®ç°å®‰å…¨

ç†è®ºä¸Šå®‰å…¨çš„ç®—æ³•ï¼Œå¦‚æœå®ç°æœ‰é—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¸å®‰å…¨äº†
å°±åƒè®¾è®¡äº†å®Œç¾çš„é”ï¼Œä½†æ˜¯åˆ¶é€ å·¥è‰ºæœ‰ç¼ºé™·ï¼Œé”è¿˜æ˜¯ä¼šè¢«è½»æ˜“æ‰“å¼€
```

**ğŸ’¡ ç®€å•ç†è§£**
```
å¯†ç å­¦ç®—æ³• = èœè°±ï¼ˆç†è®ºï¼‰
ä»£ç å®ç° = åšèœè¿‡ç¨‹ï¼ˆå®è·µï¼‰

å³ä½¿èœè°±å®Œç¾ï¼Œåšèœæ—¶çš„æ¯ä¸ªç»†èŠ‚éƒ½å¯èƒ½å½±å“æœ€ç»ˆæ•ˆæœï¼š
- ç«å€™æŒæ§ä¸å½“ï¼ˆæ—¶åºæ”»å‡»ï¼‰
- é£Ÿæå¤„ç†ä¸å¹²å‡€ï¼ˆå†…å­˜æ³„éœ²ï¼‰
- å·¥å…·ä½¿ç”¨é”™è¯¯ï¼ˆAPIè¯¯ç”¨ï¼‰
- é…æ–™æ¯”ä¾‹é”™è¯¯ï¼ˆå‚æ•°é…ç½®ï¼‰
```

### 1.2 å®ç°å®‰å…¨çš„é‡è¦æ€§


**ğŸš¨ çœŸå®å¨èƒç¤ºä¾‹**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ”»å‡»å±‚æ¬¡å›¾                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç®—æ³•å±‚æ”»å‡»  â”‚ å¾ˆéš¾ â”‚ éœ€è¦æ•°å­¦çªç ´    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åè®®å±‚æ”»å‡»  â”‚ å›°éš¾ â”‚ éœ€è¦æ·±åº¦åˆ†æ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ç°å±‚æ”»å‡»  â”‚ å®¹æ˜“ â”‚ ç¼–ç¨‹é”™è¯¯å¾ˆå¸¸è§  â”‚ â†æœ€å¸¸è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç‰©ç†å±‚æ”»å‡»  â”‚ å¤æ‚ â”‚ éœ€è¦ç¡¬ä»¶æ¥è§¦    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¤§éƒ¨åˆ†å®é™…æ”»å‡»éƒ½å‘ç”Ÿåœ¨å®ç°å±‚ï¼
```

**ğŸ“Š å®ç°é”™è¯¯çš„å±å®³**
- **ğŸ”“ å¯†é’¥æ³„éœ²**ï¼šå†…å­˜ä¸­çš„å¯†é’¥è¢«æ¶æ„ç¨‹åºè¯»å–
- **â±ï¸ æ—¶åºæ”»å‡»**ï¼šé€šè¿‡æµ‹é‡è¿è¡Œæ—¶é—´æ¨æ–­å¯†é’¥ä¿¡æ¯
- **ğŸ”‹ ä¾§ä¿¡é“æ”»å‡»**ï¼šé€šè¿‡åŠŸè€—ã€ç”µç£è¾å°„ç­‰æ¨æ–­æ•°æ®
- **ğŸ’¥ ç¼“å†²åŒºæº¢å‡º**ï¼šæ¶æ„è¾“å…¥å¯¼è‡´ç¨‹åºå´©æºƒæˆ–è¢«æ§åˆ¶

### 1.3 å®ç°å®‰å…¨çš„åŸºæœ¬åŸåˆ™


**ğŸ›¡ï¸ æ ¸å¿ƒåŸåˆ™**
```
ğŸ”¸ æœ€å°æƒé™åŸåˆ™
åªç»™ç¨‹åºè¿è¡Œå¿…éœ€çš„æœ€å°‘æƒé™ï¼Œä¸è¦è´ªå›¾æ–¹ä¾¿ç»™è¿‡å¤šæƒé™

ğŸ”¸ çºµæ·±é˜²å¾¡åŸåˆ™  
å¤šå±‚é˜²æŠ¤ï¼Œä¸€å±‚è¢«çªç ´è¿˜æœ‰å…¶ä»–å±‚ä¿æŠ¤

ğŸ”¸ é»˜è®¤å®‰å…¨åŸåˆ™
ç³»ç»Ÿé»˜è®¤é…ç½®å°±åº”è¯¥æ˜¯å®‰å…¨çš„ï¼Œè€Œä¸æ˜¯æ–¹ä¾¿çš„

ğŸ”¸ å¼€æ”¾è®¾è®¡åŸåˆ™
å®‰å…¨æ€§ä¸åº”ä¾èµ–äºç®—æ³•æˆ–å®ç°çš„ä¿å¯†
```

---

## 2. ğŸ“ å®‰å…¨ç¼–ç¨‹æŒ‡å—


### 2.1 å®‰å…¨çš„å¯†é’¥ç®¡ç†


**ğŸ”‘ å¯†é’¥ç”Ÿæˆå®‰å…¨å®è·µ**

> ğŸ’¡ **æ ¸å¿ƒè¦æ±‚**ï¼šå¯†é’¥å¿…é¡»çœŸæ­£éšæœºï¼Œä¸èƒ½æœ‰ä»»ä½•å¯é¢„æµ‹æ€§

```python
# âŒ é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨å¼±éšæœºæ•°
import random
key = random.randint(0, 2**128)  # ä¼ªéšæœºï¼Œå¯é¢„æµ‹

# âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨å¯†ç å­¦å®‰å…¨éšæœºæ•°
import secrets
key = secrets.randbits(128)  # å¯†ç å­¦å®‰å…¨éšæœºæ•°
```

**ğŸ—ƒï¸ å¯†é’¥å­˜å‚¨å®‰å…¨å®è·µ**

```python
# âŒ é”™è¯¯ï¼šå¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
SECRET_KEY = "my_super_secret_key_123"

# âŒ é”™è¯¯ï¼šå¯†é’¥å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­
config = {"secret_key": "my_secret_key"}

# âœ… æ­£ç¡®ï¼šä»ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†ç³»ç»Ÿè·å–
import os
SECRET_KEY = os.environ.get('SECRET_KEY')

# âœ… æ›´å¥½ï¼šä½¿ç”¨ä¸“ä¸šå¯†é’¥ç®¡ç†æœåŠ¡
from azure.keyvault.secrets import SecretClient
secret = client.get_secret("my-secret-key")
```

**ğŸ§¹ å¯†é’¥æ¸…ç†å®‰å…¨å®è·µ**

```python
# âŒ é”™è¯¯ï¼šå¯†é’¥ä½¿ç”¨åæ²¡æœ‰æ¸…ç†
password = "user_password_123"
# ... ä½¿ç”¨å¯†é’¥ ...
# å¯†é’¥ä»ç„¶åœ¨å†…å­˜ä¸­ï¼Œå¯èƒ½è¢«æ¶æ„ç¨‹åºè¯»å–

# âœ… æ­£ç¡®ï¼šä½¿ç”¨åç«‹å³æ¸…ç†
password = bytearray("user_password_123", 'utf-8')
try:
    # ... ä½¿ç”¨å¯†é’¥ ...
    pass
finally:
    # ç”¨éšæœºæ•°æ®è¦†ç›–å†…å­˜
    for i in range(len(password)):
        password[i] = secrets.randbits(8)
    del password
```

### 2.2 å®‰å…¨çš„éšæœºæ•°ä½¿ç”¨


**ğŸ² éšæœºæ•°è´¨é‡è¦æ±‚**

> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼š
> - **ä¼ªéšæœºæ•°**ï¼šç®—æ³•ç”Ÿæˆï¼Œæœ‰è§„å¾‹å¯å¾ªï¼Œé€‚åˆä¸€èˆ¬ç¼–ç¨‹
> - **å¯†ç å­¦éšæœºæ•°**ï¼šçœŸæ­£ä¸å¯é¢„æµ‹ï¼Œé€‚åˆå¯†ç å­¦åº”ç”¨

```python
# ğŸ“Š éšæœºæ•°è´¨é‡å¯¹æ¯”è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½¿ç”¨åœºæ™¯    â”‚  ä¼ªéšæœºæ•°   â”‚ å¯†ç å­¦éšæœºæ•° â”‚   çœŸéšæœºæ•°    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¸¸æˆã€æ¨¡æ‹Ÿ   â”‚     âœ…      â”‚     âœ…      â”‚      âœ…      â”‚
â”‚ å¯†é’¥ç”Ÿæˆ     â”‚     âŒ      â”‚     âœ…      â”‚      âœ…      â”‚
â”‚ ç›å€¼ç”Ÿæˆ     â”‚     âŒ      â”‚     âœ…      â”‚      âœ…      â”‚
â”‚ ä¼šè¯IDç”Ÿæˆ   â”‚     âŒ      â”‚     âœ…      â”‚      âœ…      â”‚
â”‚ éªŒè¯ç ç”Ÿæˆ   â”‚     âŒ      â”‚     âœ…      â”‚      âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ æ­£ç¡®çš„éšæœºæ•°ä½¿ç”¨**

```python
import secrets
import os

# âœ… ç”Ÿæˆå¯†ç å­¦å®‰å…¨çš„éšæœºæ•°
def generate_secure_token():
    return secrets.token_urlsafe(32)  # 32å­—èŠ‚ï¼ŒURLå®‰å…¨çš„éšæœºå­—ç¬¦ä¸²

# âœ… ç”Ÿæˆéšæœºç›å€¼
def generate_salt():
    return os.urandom(16)  # 16å­—èŠ‚éšæœºæ•°æ®

# âœ… ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡(IV)
def generate_iv():
    return secrets.randbits(128)  # 128ä½éšæœºæ•°
```

### 2.3 å®‰å…¨çš„åŠ å¯†å®ç°


**ğŸ”’ å¯¹ç§°åŠ å¯†å®‰å…¨å®è·µ**

```python
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
import base64
import os

# âœ… å®‰å…¨çš„AESåŠ å¯†å®ç°
class SecureEncryption:
    def __init__(self, password: str):
        # ç”Ÿæˆéšæœºç›å€¼
        self.salt = os.urandom(16)
        
        # ä½¿ç”¨PBKDF2ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=self.salt,
            iterations=100000,  # è¶³å¤Ÿçš„è¿­ä»£æ¬¡æ•°
        )
        key = base64.urlsafe_b64encode(kdf.derive(password.encode()))
        self.cipher = Fernet(key)
    
    def encrypt(self, data: str) -> bytes:
        # Fernetè‡ªåŠ¨ç”ŸæˆéšæœºIV
        return self.cipher.encrypt(data.encode())
    
    def decrypt(self, encrypted_data: bytes) -> str:
        return self.cipher.decrypt(encrypted_data).decode()
```

**ğŸ” éå¯¹ç§°åŠ å¯†å®‰å…¨å®è·µ**

```python
from cryptography.hazmat.primitives.asymmetric import rsa, padding
from cryptography.hazmat.primitives import hashes, serialization

# âœ… å®‰å…¨çš„RSAå¯†é’¥ç”Ÿæˆå’Œä½¿ç”¨
class SecureRSA:
    def __init__(self):
        # ç”Ÿæˆè¶³å¤Ÿé•¿çš„å¯†é’¥
        self.private_key = rsa.generate_private_key(
            public_exponent=65537,  # æ ‡å‡†æŒ‡æ•°
            key_size=2048,          # æœ€å°æ¨èé•¿åº¦
        )
        self.public_key = self.private_key.public_key()
    
    def encrypt(self, message: str) -> bytes:
        # ä½¿ç”¨OAEPå¡«å……ï¼Œæ›´å®‰å…¨
        return self.public_key.encrypt(
            message.encode(),
            padding.OAEP(
                mgf=padding.MGF1(algorithm=hashes.SHA256()),
                algorithm=hashes.SHA256(),
                label=None
            )
        )
```

### 2.4 å®‰å…¨çš„å“ˆå¸Œå®ç°


**#ï¸âƒ£ å¯†ç å“ˆå¸Œå®‰å…¨å®è·µ**

> âš ï¸ **é‡è¦è­¦å‘Š**ï¼šæ°¸è¿œä¸è¦ç›´æ¥ç”¨MD5æˆ–SHA1æ¥å­˜å‚¨å¯†ç ï¼

```python
import bcrypt
import hashlib
import secrets

# âŒ æå…¶å±é™©çš„å¯†ç å­˜å‚¨æ–¹å¼
def bad_password_storage(password):
    return hashlib.md5(password.encode()).hexdigest()

# âœ… å®‰å…¨çš„å¯†ç å­˜å‚¨æ–¹å¼
def secure_password_storage(password: str) -> str:
    # bcryptè‡ªåŠ¨å¤„ç†ç›å€¼å’Œæ…¢å“ˆå¸Œ
    salt = bcrypt.gensalt(rounds=12)  # æˆæœ¬å› å­12
    return bcrypt.hashpw(password.encode(), salt).decode()

def verify_password(password: str, stored_hash: str) -> bool:
    return bcrypt.checkpw(password.encode(), stored_hash.encode())
```

**ğŸ§‚ ç›å€¼ä½¿ç”¨æœ€ä½³å®è·µ**

```python
# âœ… æ­£ç¡®çš„ç›å€¼ä½¿ç”¨
def hash_with_salt(data: str) -> tuple:
    salt = secrets.randbits(128)  # æ¯æ¬¡éƒ½ç”Ÿæˆæ–°ç›å€¼
    
    # å°†ç›å€¼å’Œæ•°æ®ç»„åˆåå“ˆå¸Œ
    combined = salt.to_bytes(16, 'big') + data.encode()
    hash_value = hashlib.sha256(combined).hexdigest()
    
    return salt, hash_value  # è¿”å›ç›å€¼å’Œå“ˆå¸Œå€¼ï¼Œéƒ½éœ€è¦å­˜å‚¨

# éªŒè¯æ—¶éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç›å€¼
def verify_hash(data: str, salt: int, stored_hash: str) -> bool:
    combined = salt.to_bytes(16, 'big') + data.encode()
    computed_hash = hashlib.sha256(combined).hexdigest()
    return computed_hash == stored_hash
```

---

## 3. âš ï¸ å¸¸è§å®ç°é”™è¯¯


### 3.1 å¯†é’¥ç®¡ç†é”™è¯¯


**ğŸ”‘ é”™è¯¯1ï¼šç¡¬ç¼–ç å¯†é’¥**

```python
# âŒ å…¸å‹é”™è¯¯ç¤ºä¾‹
class APIClient:
    def __init__(self):
        # å¯†é’¥ç›´æ¥å†™åœ¨ä»£ç é‡Œ
        self.api_key = "ak_12345678_secret_key_abcdefgh"
        self.secret = "my_super_secret_password_123"

# ğŸš¨ å±å®³è¯´æ˜ï¼š
# 1. æºä»£ç è¢«æ³„éœ²æ—¶ï¼Œå¯†é’¥ä¹Ÿä¸€èµ·æ³„éœ²
# 2. ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ç•™ä¸‹å¯†é’¥å†å²è®°å½•
# 3. ç¼–è¯‘åçš„ç¨‹åºä¸­ä»å¯èƒ½æå–å‡ºå¯†é’¥
```

**ğŸ”‘ é”™è¯¯2ï¼šå¯†é’¥é‡ç”¨**

```python
# âŒ é”™è¯¯ï¼šå¤šä¸ªç”¨é€”ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥
master_key = generate_key()

# ç”¨åŒä¸€ä¸ªå¯†é’¥åšä¸åŒçš„äº‹æƒ…
encryption_key = master_key  # ç”¨äºæ•°æ®åŠ å¯†
signing_key = master_key     # ç”¨äºæ•°å­—ç­¾å
auth_key = master_key        # ç”¨äºèº«ä»½è®¤è¯

# âœ… æ­£ç¡®ï¼šä¸ºä¸åŒç”¨é€”æ´¾ç”Ÿä¸åŒå¯†é’¥
def derive_key(master_key: bytes, purpose: str) -> bytes:
    return hashlib.sha256(master_key + purpose.encode()).digest()

encryption_key = derive_key(master_key, "encryption")
signing_key = derive_key(master_key, "signing")
auth_key = derive_key(master_key, "authentication")
```

**ğŸ”‘ é”™è¯¯3ï¼šå¯†é’¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å½“**

```python
# âŒ é”™è¯¯ï¼šå¯†é’¥ç”¨å®Œåä¸æ¸…ç†
def process_sensitive_data(password):
    key = derive_key_from_password(password)
    encrypted_data = encrypt(data, key)
    # keyè¿˜åœ¨å†…å­˜ä¸­ï¼Œå¯èƒ½è¢«æ”»å‡»è€…è¯»å–
    return encrypted_data

# âœ… æ­£ç¡®ï¼šåŠæ—¶æ¸…ç†å¯†é’¥
def process_sensitive_data(password):
    key = bytearray(derive_key_from_password(password))
    try:
        encrypted_data = encrypt(data, key)
        return encrypted_data
    finally:
        # ç”¨éšæœºæ•°æ®è¦†ç›–å¯†é’¥
        for i in range(len(key)):
            key[i] = secrets.randbits(8)
        del key
```

### 3.2 éšæœºæ•°ä½¿ç”¨é”™è¯¯


**ğŸ² é”™è¯¯1ï¼šä½¿ç”¨å¼±éšæœºæ•°ç”Ÿæˆå™¨**

```python
import random
import time

# âŒ æå…¶å±é™©çš„éšæœºæ•°ä½¿ç”¨
def generate_session_id():
    random.seed(int(time.time()))  # ç§å­å¯é¢„æµ‹
    return random.randint(1000000, 9999999)

# âŒ ä»ç„¶ä¸å®‰å…¨çš„åšæ³•  
def generate_token():
    return str(random.random())  # ä¼ªéšæœºï¼Œå¯é¢„æµ‹

# âœ… æ­£ç¡®çš„åšæ³•
import secrets

def generate_secure_session_id():
    return secrets.token_urlsafe(16)  # å¯†ç å­¦å®‰å…¨éšæœº
```

**ğŸ² é”™è¯¯2ï¼šéšæœºæ•°ç§å­å¯é¢„æµ‹**

```python
# âŒ å±é™©ï¼šä½¿ç”¨æ—¶é—´ä½œä¸ºç§å­
import random
import time

random.seed(int(time.time()))  # æ”»å‡»è€…å¯ä»¥çŒœæµ‹æ—¶é—´

# âŒ å±é™©ï¼šä½¿ç”¨ç”¨æˆ·è¾“å…¥ä½œä¸ºç§å­
user_id = get_user_id()
random.seed(user_id)  # æ”»å‡»è€…çŸ¥é“user_idå°±èƒ½é¢„æµ‹éšæœºæ•°

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ç³»ç»Ÿæä¾›çš„å®‰å…¨éšæœºæ•°
# ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ç§å­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†
secure_random = secrets.randbits(128)
```

### 3.3 åŠ å¯†æ¨¡å¼å’Œå¡«å……é”™è¯¯


**ğŸ”’ é”™è¯¯1ï¼šä½¿ç”¨ä¸å®‰å…¨çš„åŠ å¯†æ¨¡å¼**

```python
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes

# âŒ å±é™©ï¼šä½¿ç”¨ECBæ¨¡å¼
def encrypt_ecb(data, key):
    cipher = Cipher(
        algorithms.AES(key),
        modes.ECB()  # ECBæ¨¡å¼ä¸å®‰å…¨ï¼Œç›¸åŒæ˜æ–‡äº§ç”Ÿç›¸åŒå¯†æ–‡
    )
    # ...

# âœ… æ­£ç¡®ï¼šä½¿ç”¨å®‰å…¨çš„åŠ å¯†æ¨¡å¼
def encrypt_cbc(data, key):
    iv = os.urandom(16)  # éšæœºåˆå§‹åŒ–å‘é‡
    cipher = Cipher(
        algorithms.AES(key),
        modes.CBC(iv)  # CBCæ¨¡å¼æ›´å®‰å…¨
    )
    # ...
```

**ğŸ”’ é”™è¯¯2ï¼šåˆå§‹åŒ–å‘é‡(IV)é‡ç”¨**

```python
# âŒ å±é™©ï¼šé‡ç”¨IV
class BadEncryption:
    def __init__(self, key):
        self.key = key
        self.iv = b'1234567890123456'  # å›ºå®šIVï¼Œéå¸¸å±é™©
    
    def encrypt(self, data):
        # æ¯æ¬¡åŠ å¯†éƒ½ç”¨ç›¸åŒçš„IV
        cipher = Cipher(algorithms.AES(self.key), modes.CBC(self.iv))
        # ...

# âœ… æ­£ç¡®ï¼šæ¯æ¬¡ç”Ÿæˆæ–°çš„éšæœºIV
class GoodEncryption:
    def __init__(self, key):
        self.key = key
    
    def encrypt(self, data):
        iv = os.urandom(16)  # æ¯æ¬¡éƒ½ç”Ÿæˆæ–°çš„éšæœºIV
        cipher = Cipher(algorithms.AES(self.key), modes.CBC(iv))
        # ... è®°å¾—æŠŠIVå’Œå¯†æ–‡ä¸€èµ·è¿”å›
```

### 3.4 æ—¶åºæ”»å‡»æ¼æ´


**â±ï¸ ä»€ä¹ˆæ˜¯æ—¶åºæ”»å‡»**

> ğŸ“– **é€šä¿—è§£é‡Š**ï¼šæ—¶åºæ”»å‡»æ˜¯é€šè¿‡æµ‹é‡ç¨‹åºè¿è¡Œæ—¶é—´æ¥æ¨æ–­ç§˜å¯†ä¿¡æ¯çš„æ”»å‡»æ–¹å¼

```python
# âŒ å­˜åœ¨æ—¶åºæ”»å‡»æ¼æ´çš„å¯†ç éªŒè¯
def vulnerable_password_check(input_password, correct_password):
    if len(input_password) != len(correct_password):
        return False
    
    # é€å­—ç¬¦æ¯”è¾ƒï¼Œä¸€æ—¦å‘ç°ä¸åŒ¹é…å°±ç«‹å³è¿”å›
    for i in range(len(input_password)):
        if input_password[i] != correct_password[i]:
            return False  # è¿™é‡Œä¼šå¯¼è‡´æ—¶åºå·®å¼‚
    
    return True

# ğŸš¨ æ”»å‡»åŸç†ï¼š
# å¦‚æœç¬¬1ä¸ªå­—ç¬¦é”™è¯¯ï¼Œå‡½æ•°å¾ˆå¿«è¿”å›False
# å¦‚æœå‰3ä¸ªå­—ç¬¦æ­£ç¡®ï¼Œç¬¬4ä¸ªé”™è¯¯ï¼Œå‡½æ•°è¿è¡Œæ—¶é—´ç¨é•¿
# æ”»å‡»è€…å¯ä»¥é€šè¿‡æµ‹é‡æ—¶é—´é€ä¸ªçŒœæµ‹å‡ºæ­£ç¡®å¯†ç 
```

**ğŸ›¡ï¸ é˜²å¾¡æ—¶åºæ”»å‡»**

```python
import hmac

# âœ… é˜²å¾¡æ—¶åºæ”»å‡»çš„å¯†ç éªŒè¯
def secure_password_check(input_password, correct_password):
    # ä½¿ç”¨hmac.compare_digestè¿›è¡Œå¸¸æ—¶é—´æ¯”è¾ƒ
    return hmac.compare_digest(input_password, correct_password)

# âœ… è‡ªå·±å®ç°å¸¸æ—¶é—´æ¯”è¾ƒ
def constant_time_compare(a, b):
    if len(a) != len(b):
        return False
    
    result = 0
    # æ€»æ˜¯æ¯”è¾ƒå®Œæ‰€æœ‰å­—ç¬¦ï¼Œæ— è®ºä½•æ—¶å‘ç°ä¸åŒ¹é…
    for x, y in zip(a, b):
        result |= ord(x) ^ ord(y)
    
    return result == 0  # åªæœ‰æ‰€æœ‰å­—ç¬¦éƒ½ç›¸åŒæ—¶resultæ‰ä¸º0
```

---

## 4. ğŸ” ä»£ç å®¡è®¡è¦ç‚¹


### 4.1 å¯†é’¥ç®¡ç†å®¡è®¡


**ğŸ”‘ å®¡è®¡æ£€æŸ¥æ¸…å•**

```
âœ… å¯†é’¥ç”Ÿæˆæ£€æŸ¥ï¼š
â–¡ æ˜¯å¦ä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Ÿ
â–¡ å¯†é’¥é•¿åº¦æ˜¯å¦ç¬¦åˆå½“å‰å®‰å…¨æ ‡å‡†ï¼Ÿ
â–¡ æ˜¯å¦é¿å…äº†å¼±å¯†é’¥æˆ–å¯é¢„æµ‹å¯†é’¥ï¼Ÿ

âœ… å¯†é’¥å­˜å‚¨æ£€æŸ¥ï¼š
â–¡ å¯†é’¥æ˜¯å¦ç¡¬ç¼–ç åœ¨æºä»£ç ä¸­ï¼Ÿ
â–¡ å¯†é’¥æ˜¯å¦ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ï¼Ÿ
â–¡ æ˜¯å¦ä½¿ç”¨äº†ä¸“ä¸šçš„å¯†é’¥ç®¡ç†ç³»ç»Ÿï¼Ÿ

âœ… å¯†é’¥ä½¿ç”¨æ£€æŸ¥ï¼š
â–¡ ä¸åŒç”¨é€”æ˜¯å¦ä½¿ç”¨äº†ä¸åŒçš„å¯†é’¥ï¼Ÿ
â–¡ å¯†é’¥æ˜¯å¦åœ¨ä¸å®‰å…¨çš„æ—¥å¿—ä¸­è¾“å‡ºï¼Ÿ
â–¡ å¯†é’¥ä¼ è¾“æ˜¯å¦ä½¿ç”¨äº†å®‰å…¨é€šé“ï¼Ÿ

âœ… å¯†é’¥é”€æ¯æ£€æŸ¥ï¼š
â–¡ å¯†é’¥ä½¿ç”¨å®Œæ¯•åæ˜¯å¦åŠæ—¶æ¸…ç†ï¼Ÿ
â–¡ å†…å­˜ä¸­çš„å¯†é’¥æ•°æ®æ˜¯å¦è¢«è¦†ç›–ï¼Ÿ
â–¡ æ˜¯å¦è€ƒè™‘äº†äº¤æ¢æ–‡ä»¶ä¸­çš„å¯†é’¥æ®‹ç•™ï¼Ÿ
```

**ğŸ” ä»£ç å®¡è®¡ç¤ºä¾‹**

```python
# å®¡è®¡ç›®æ ‡ä»£ç 
def user_login(username, password):
    # ğŸš© å®¡è®¡ç‚¹1ï¼šå¯†ç å¤„ç†
    stored_hash = get_user_password_hash(username)
    
    # ğŸš© å®¡è®¡ç‚¹2ï¼šå¯†ç æ¯”è¾ƒæ–¹å¼
    if hash_password(password) == stored_hash:
        # ğŸš© å®¡è®¡ç‚¹3ï¼šä¼šè¯ç®¡ç†
        session_token = generate_session_token()
        
        # ğŸš© å®¡è®¡ç‚¹4ï¼šæ—¥å¿—è®°å½•
        log.info(f"User {username} logged in with token {session_token}")
        
        return session_token
    return None

# å®¡è®¡å‘ç°çš„é—®é¢˜ï¼š
# âŒ é—®é¢˜1ï¼šå¯†ç å¯èƒ½ä½¿ç”¨äº†ä¸å®‰å…¨çš„å“ˆå¸Œç®—æ³•
# âŒ é—®é¢˜2ï¼šå¯†ç æ¯”è¾ƒå¯èƒ½å­˜åœ¨æ—¶åºæ”»å‡»
# âŒ é—®é¢˜3ï¼šä¼šè¯ä»¤ç‰Œç”Ÿæˆæ–¹å¼ä¸æ˜
# âŒ é—®é¢˜4ï¼šæ•æ„Ÿä¿¡æ¯è¢«è®°å½•åˆ°æ—¥å¿—
```

### 4.2 åŠ å¯†å®ç°å®¡è®¡


**ğŸ”’ åŠ å¯†ç®—æ³•ä½¿ç”¨å®¡è®¡**

```python
# å®¡è®¡åŠ å¯†å®ç°çš„å¸¸è§é—®é¢˜
def audit_encryption_implementation():
    """
    ğŸ” åŠ å¯†å®ç°å®¡è®¡è¦ç‚¹ï¼š
    
    1. ç®—æ³•é€‰æ‹©ï¼š
       âŒ æ˜¯å¦ä½¿ç”¨äº†å·²çŸ¥ä¸å®‰å…¨çš„ç®—æ³•ï¼ˆDESã€MD5ã€SHA1ï¼‰
       âŒ æ˜¯å¦ä½¿ç”¨äº†è‡ªåˆ¶çš„åŠ å¯†ç®—æ³•
       âœ… æ˜¯å¦ä½¿ç”¨äº†ä¸šç•Œè®¤å¯çš„æ ‡å‡†ç®—æ³•
    
    2. å‚æ•°é…ç½®ï¼š
       âŒ å¯†é’¥é•¿åº¦æ˜¯å¦è¿‡çŸ­
       âŒ æ˜¯å¦ä½¿ç”¨äº†é»˜è®¤çš„ã€ä¸å®‰å…¨çš„å‚æ•°
       âœ… å‚æ•°æ˜¯å¦ç¬¦åˆå½“å‰å®‰å…¨æ ‡å‡†
    
    3. æ¨¡å¼é€‰æ‹©ï¼š
       âŒ æ˜¯å¦ä½¿ç”¨äº†ECBç­‰ä¸å®‰å…¨æ¨¡å¼
       âŒ IV/nonceæ˜¯å¦é‡ç”¨æˆ–å¯é¢„æµ‹
       âœ… æ˜¯å¦ä½¿ç”¨äº†è®¤è¯åŠ å¯†æ¨¡å¼
    
    4. é”™è¯¯å¤„ç†ï¼š
       âŒ æ˜¯å¦é€šè¿‡é”™è¯¯ä¿¡æ¯æ³„éœ²äº†æ•æ„Ÿä¿¡æ¯
       âŒ æ˜¯å¦å­˜åœ¨Padding Oracleæ”»å‡»å¯èƒ½
       âœ… é”™è¯¯å¤„ç†æ˜¯å¦ç»Ÿä¸€ä¸”å®‰å…¨
    """
    pass
```

**ğŸ” å®é™…å®¡è®¡æ¡ˆä¾‹**

```python
# å¾…å®¡è®¡çš„åŠ å¯†ä»£ç 
class FileEncryption:
    def __init__(self, password):
        # ğŸš© å®¡è®¡ç‚¹1ï¼šå¯†é’¥æ´¾ç”Ÿ
        self.key = hashlib.md5(password.encode()).digest()[:16]
        
        # ğŸš© å®¡è®¡ç‚¹2ï¼šIVç®¡ç†
        self.iv = b'1234567890123456'
    
    def encrypt_file(self, filename):
        try:
            # ğŸš© å®¡è®¡ç‚¹3ï¼šåŠ å¯†æ¨¡å¼
            cipher = AES.new(self.key, AES.MODE_CBC, self.iv)
            
            with open(filename, 'rb') as f:
                data = f.read()
            
            # ğŸš© å®¡è®¡ç‚¹4ï¼šå¡«å……æ–¹å¼
            padded_data = data + b'0' * (16 - len(data) % 16)
            encrypted = cipher.encrypt(padded_data)
            
            return encrypted
        except Exception as e:
            # ğŸš© å®¡è®¡ç‚¹5ï¼šé”™è¯¯å¤„ç†
            print(f"Encryption failed: {e}")
            return None

# å®¡è®¡ç»“æœï¼š
# âŒ ä¸¥é‡é—®é¢˜1ï¼šä½¿ç”¨MD5æ´¾ç”Ÿå¯†é’¥ï¼Œæä¸å®‰å…¨
# âŒ ä¸¥é‡é—®é¢˜2ï¼šå›ºå®šIVï¼Œå¯¼è‡´ç›¸åŒæ–‡ä»¶äº§ç”Ÿç›¸åŒå¯†æ–‡
# âŒ é—®é¢˜3ï¼šä½¿ç”¨CBCæ¨¡å¼ä½†æ²¡æœ‰è®¤è¯ï¼Œå¯èƒ½å­˜åœ¨å¡«å……æ”»å‡»
# âŒ é—®é¢˜4ï¼šè‡ªåˆ¶å¡«å……æ–¹å¼ï¼Œä¸ç¬¦åˆæ ‡å‡†
# âŒ é—®é¢˜5ï¼šé”™è¯¯ä¿¡æ¯å¯èƒ½æ³„éœ²ç³»ç»Ÿä¿¡æ¯
```

### 4.3 éšæœºæ•°ä½¿ç”¨å®¡è®¡


**ğŸ² éšæœºæ•°è´¨é‡å®¡è®¡**

```python
# éšæœºæ•°ä½¿ç”¨å®¡è®¡æ£€æŸ¥è¡¨
def audit_random_number_usage():
    """
    ğŸ¯ éšæœºæ•°å®¡è®¡è¦ç‚¹ï¼š
    
    âœ… ç”Ÿæˆå™¨ç±»å‹æ£€æŸ¥ï¼š
    â–¡ å¯†ç å­¦ç”¨é€”æ˜¯å¦ä½¿ç”¨äº†å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Ÿ
    â–¡ æ˜¯å¦é¿å…äº†randomæ¨¡å—åœ¨å®‰å…¨åœºæ™¯ä¸­çš„ä½¿ç”¨ï¼Ÿ
    â–¡ æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº†os.urandom()æˆ–secretsæ¨¡å—ï¼Ÿ
    
    âœ… ç§å­ç®¡ç†æ£€æŸ¥ï¼š
    â–¡ æ˜¯å¦æ‰‹åŠ¨è®¾ç½®äº†å¯é¢„æµ‹çš„ç§å­ï¼Ÿ
    â–¡ ç§å­æ¥æºæ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„ç†µï¼Ÿ
    â–¡ æ˜¯å¦å­˜åœ¨ç§å­é‡ç”¨é—®é¢˜ï¼Ÿ
    
    âœ… éšæœºæ•°ç”¨é€”æ£€æŸ¥ï¼š
    â–¡ ä¼šè¯IDã€ä»¤ç‰Œç”Ÿæˆæ˜¯å¦ä½¿ç”¨äº†å®‰å…¨éšæœºæ•°ï¼Ÿ
    â–¡ å¯†é’¥ç”Ÿæˆæ˜¯å¦ä½¿ç”¨äº†é«˜è´¨é‡éšæœºæ•°ï¼Ÿ
    â–¡ ç›å€¼ã€IVç”Ÿæˆæ˜¯å¦çœŸæ­£éšæœºï¼Ÿ
    
    âœ… éšæœºæ•°èŒƒå›´æ£€æŸ¥ï¼š
    â–¡ éšæœºæ•°èŒƒå›´æ˜¯å¦åˆé€‚ï¼Ÿ
    â–¡ æ˜¯å¦å­˜åœ¨æ¨¡è¿ç®—å¯¼è‡´çš„åå·®ï¼Ÿ
    â–¡ éšæœºæ•°é•¿åº¦æ˜¯å¦è¶³å¤Ÿï¼Ÿ
    """
    pass
```

---

## 5. âš–ï¸ æ€§èƒ½ä¸å®‰å…¨å¹³è¡¡


### 5.1 æ€§èƒ½ä¸å®‰å…¨çš„æƒè¡¡


**ğŸƒâ€â™‚ï¸ å¸¸è§çš„æ€§èƒ½å®‰å…¨æƒè¡¡**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ€§èƒ½ vs å®‰å…¨æƒè¡¡è¡¨              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    åœºæ™¯     â”‚   æ€§èƒ½ä¼˜å…ˆ   â”‚    å®‰å…¨ä¼˜å…ˆ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯†é’¥é•¿åº¦    â”‚ 1024ä½RSA   â”‚ 2048ä½æˆ–ä»¥ä¸ŠRSA â”‚
â”‚ å“ˆå¸Œè½®æ•°    â”‚ 1000è½®      â”‚ 10000è½®ä»¥ä¸Š     â”‚
â”‚ åŠ å¯†æ¨¡å¼    â”‚ ECB(å¿«)     â”‚ GCM/CBC(æ…¢ä½†å®‰å…¨)â”‚
â”‚ éšæœºæ•°è´¨é‡  â”‚ ä¼ªéšæœº      â”‚ å¯†ç å­¦å®‰å…¨éšæœº   â”‚
â”‚ å¯†é’¥æ´¾ç”Ÿ    â”‚ ç®€å•å“ˆå¸Œ    â”‚ PBKDF2/scrypt   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å®é™…æƒè¡¡ç­–ç•¥**

> ğŸ¯ **åŸºæœ¬åŸåˆ™**ï¼šåœ¨æ»¡è¶³å®‰å…¨éœ€æ±‚çš„å‰æä¸‹ä¼˜åŒ–æ€§èƒ½ï¼Œè€Œä¸æ˜¯åœ¨æ»¡è¶³æ€§èƒ½éœ€æ±‚çš„å‰æä¸‹å…¼é¡¾å®‰å…¨

```python
# ç¤ºä¾‹ï¼šæ ¹æ®æ•°æ®æ•æ„Ÿæ€§é€‰æ‹©ä¸åŒçš„å®‰å…¨çº§åˆ«
class DataProcessor:
    def __init__(self):
        # ä¸ºä¸åŒæ•æ„Ÿçº§åˆ«çš„æ•°æ®å®šä¹‰ä¸åŒçš„åŠ å¯†ç­–ç•¥
        self.encryption_policies = {
            'public': {
                'algorithm': 'AES-128-GCM',
                'key_derivation_rounds': 1000,
                'require_authentication': False
            },
            'internal': {
                'algorithm': 'AES-256-GCM', 
                'key_derivation_rounds': 10000,
                'require_authentication': True
            },
            'confidential': {
                'algorithm': 'AES-256-GCM',
                'key_derivation_rounds': 100000,
                'require_authentication': True,
                'require_audit_log': True
            }
        }
    
    def encrypt_data(self, data, sensitivity_level):
        policy = self.encryption_policies[sensitivity_level]
        # æ ¹æ®æ•æ„Ÿçº§åˆ«ä½¿ç”¨ä¸åŒçš„åŠ å¯†å¼ºåº¦
        return self._encrypt_with_policy(data, policy)
```

### 5.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**âš¡ å®‰å…¨çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•**

```python
# æŠ€å·§1ï¼šç¼“å­˜æ˜‚è´µçš„å¯†é’¥æ´¾ç”Ÿæ“ä½œ
class OptimizedAuthentication:
    def __init__(self):
        # ä½¿ç”¨LRUç¼“å­˜æ¥ç¼“å­˜å¯†é’¥æ´¾ç”Ÿç»“æœ
        from functools import lru_cache
        self._derive_key = lru_cache(maxsize=100)(self._derive_key_impl)
    
    def _derive_key_impl(self, password, salt):
        # æ˜‚è´µçš„å¯†é’¥æ´¾ç”Ÿæ“ä½œ
        return pbkdf2_hmac('sha256', password.encode(), salt, 100000)
    
    def authenticate(self, password, salt):
        # ç¼“å­˜é¿å…é‡å¤è®¡ç®—ï¼Œä½†ä¸ç‰ºç‰²å®‰å…¨æ€§
        key = self._derive_key(password, salt)
        # ...

# æŠ€å·§2ï¼šæ‰¹é‡å¤„ç†å‡å°‘åŠ å¯†å¼€é”€
def encrypt_multiple_files(files, key):
    # ä¸€æ¬¡æ€§åˆå§‹åŒ–åŠ å¯†å™¨ï¼Œé¿å…é‡å¤åˆå§‹åŒ–å¼€é”€
    cipher = Cipher(algorithms.AES(key), modes.GCM(iv))
    
    results = []
    for file in files:
        # é‡ç”¨åŠ å¯†å™¨å¯¹è±¡ï¼Œä½†æ¯ä¸ªæ–‡ä»¶ä½¿ç”¨ä¸åŒçš„IV
        iv = os.urandom(12)  # æ¯ä¸ªæ–‡ä»¶æ–°çš„IV
        encryptor = cipher.encryptor()
        encrypted = encryptor.update(file.data) + encryptor.finalize()
        results.append((encrypted, encryptor.tag, iv))
    
    return results
```

**ğŸ¯ ç¡¬ä»¶åŠ é€Ÿåˆ©ç”¨**

```python
# æŠ€å·§3ï¼šåˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿ
import hashlib

def optimized_hashing(data):
    # ç°ä»£CPUé€šå¸¸æœ‰SHAç¡¬ä»¶åŠ é€Ÿ
    # Pythonçš„hashlibä¼šè‡ªåŠ¨ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆå¦‚æœå¯ç”¨ï¼‰
    return hashlib.sha256(data).digest()

# æŠ€å·§4ï¼šé€‰æ‹©ç¡¬ä»¶å‹å¥½çš„ç®—æ³•
def choose_algorithm_for_hardware():
    """
    ğŸ”§ ç¡¬ä»¶åŠ é€Ÿæ”¯æŒæƒ…å†µï¼š
    
    âœ… ç°ä»£CPUé€šå¸¸æ”¯æŒï¼š
    - AES-NIï¼šAESåŠ å¯†ç¡¬ä»¶åŠ é€Ÿ
    - SHAæ‰©å±•ï¼šSHA-1/SHA-256ç¡¬ä»¶åŠ é€Ÿ
    - RDRANDï¼šç¡¬ä»¶éšæœºæ•°ç”Ÿæˆå™¨
    
    ğŸ’¡ é€‰æ‹©å»ºè®®ï¼š
    - ä¼˜å…ˆé€‰æ‹©æœ‰ç¡¬ä»¶åŠ é€Ÿçš„ç®—æ³•ï¼ˆAESã€SHA-256ï¼‰
    - é¿å…çº¯è½¯ä»¶å®ç°çš„å¤æ‚ç®—æ³•ï¼ˆé™¤éå¿…è¦ï¼‰
    - æµ‹è¯•å®é™…ç¯å¢ƒçš„æ€§èƒ½è¡¨ç°
    """
    pass
```

### 5.3 æ€§èƒ½æµ‹è¯•ä¸ç›‘æ§


**ğŸ“Š åŠ å¯†æ€§èƒ½åŸºå‡†æµ‹è¯•**

```python
import time
import secrets
from cryptography.fernet import Fernet

def benchmark_encryption_performance():
    # ç”Ÿæˆæµ‹è¯•æ•°æ®
    test_data = secrets.token_bytes(1024 * 1024)  # 1MBæµ‹è¯•æ•°æ®
    key = Fernet.generate_key()
    cipher = Fernet(key)
    
    # æµ‹è¯•åŠ å¯†æ€§èƒ½
    start_time = time.time()
    for _ in range(100):
        encrypted = cipher.encrypt(test_data)
    encryption_time = time.time() - start_time
    
    # æµ‹è¯•è§£å¯†æ€§èƒ½  
    start_time = time.time()
    for _ in range(100):
        decrypted = cipher.decrypt(encrypted)
    decryption_time = time.time() - start_time
    
    # è®¡ç®—æ€§èƒ½æŒ‡æ ‡
    throughput_mbps = (100 * len(test_data)) / (encryption_time * 1024 * 1024)
    
    print(f"åŠ å¯†ååé‡: {throughput_mbps:.2f} MB/s")
    print(f"åŠ å¯†å»¶è¿Ÿ: {encryption_time*10:.2f} ms (æ¯MB)")
    print(f"è§£å¯†å»¶è¿Ÿ: {decryption_time*10:.2f} ms (æ¯MB)")
```

**ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒç›‘æ§**

```python
# æ€§èƒ½ç›‘æ§è£…é¥°å™¨
import functools
import time

def monitor_crypto_performance(operation_name):
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            start_time = time.time()
            try:
                result = func(*args, **kwargs)
                success = True
                error = None
            except Exception as e:
                success = False
                error = str(e)
                raise
            finally:
                duration = time.time() - start_time
                
                # è®°å½•æ€§èƒ½æŒ‡æ ‡
                log_crypto_metrics(
                    operation=operation_name,
                    duration=duration,
                    success=success,
                    error=error
                )
            
            return result
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@monitor_crypto_performance("password_hashing")
def hash_password(password):
    return bcrypt.hashpw(password.encode(), bcrypt.gensalt())

@monitor_crypto_performance("data_encryption") 
def encrypt_sensitive_data(data):
    # åŠ å¯†å®ç°
    pass
```

---

## 6. ğŸ› ï¸ å®æˆ˜å®‰å…¨æ¡ˆä¾‹


### 6.1 å®‰å…¨çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ


**ğŸ” å®Œæ•´çš„å®‰å…¨è®¤è¯å®ç°**

```python
import bcrypt
import secrets
import hmac
import hashlib
import time
from datetime import datetime, timedelta

class SecureAuthSystem:
    def __init__(self):
        self.failed_attempts = {}  # è®°å½•å¤±è´¥å°è¯•
        self.session_tokens = {}   # ç®¡ç†ä¼šè¯ä»¤ç‰Œ
    
    def register_user(self, username, password):
        """å®‰å…¨çš„ç”¨æˆ·æ³¨å†Œ"""
        # 1. å¯†ç å¼ºåº¦æ£€æŸ¥
        if not self._is_strong_password(password):
            raise ValueError("å¯†ç å¼ºåº¦ä¸è¶³")
        
        # 2. ä½¿ç”¨bcryptå®‰å…¨å“ˆå¸Œå¯†ç 
        password_hash = bcrypt.hashpw(
            password.encode(), 
            bcrypt.gensalt(rounds=12)  # æˆæœ¬å› å­12
        )
        
        # 3. å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼ˆå®é™…é¡¹ç›®ä¸­å­˜åˆ°æ•°æ®åº“ï¼‰
        self._store_user(username, password_hash)
        
        return "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ"
    
    def authenticate_user(self, username, password):
        """å®‰å…¨çš„ç”¨æˆ·è®¤è¯"""
        # 1. æ£€æŸ¥æ˜¯å¦è¢«é”å®šï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
        if self._is_account_locked(username):
            raise ValueError("è´¦æˆ·å·²è¢«é”å®šï¼Œè¯·ç¨åå†è¯•")
        
        # 2. è·å–å­˜å‚¨çš„å¯†ç å“ˆå¸Œ
        stored_hash = self._get_password_hash(username)
        if not stored_hash:
            # å³ä½¿ç”¨æˆ·ä¸å­˜åœ¨ä¹Ÿè¦æ‰§è¡Œå“ˆå¸Œè¿ç®—ï¼Œé˜²æ­¢æ—¶åºæ”»å‡»
            bcrypt.checkpw(b"dummy", bcrypt.gensalt())
            self._record_failed_attempt(username)
            raise ValueError("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
        
        # 3. éªŒè¯å¯†ç ï¼ˆé˜²æ—¶åºæ”»å‡»ï¼‰
        if bcrypt.checkpw(password.encode(), stored_hash):
            # è®¤è¯æˆåŠŸï¼Œæ¸…é™¤å¤±è´¥è®°å½•
            self._clear_failed_attempts(username)
            
            # ç”Ÿæˆå®‰å…¨çš„ä¼šè¯ä»¤ç‰Œ
            session_token = self._generate_session_token(username)
            return session_token
        else:
            # è®¤è¯å¤±è´¥ï¼Œè®°å½•å¤±è´¥å°è¯•
            self._record_failed_attempt(username)
            raise ValueError("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
    
    def _is_strong_password(self, password):
        """æ£€æŸ¥å¯†ç å¼ºåº¦"""
        return (len(password) >= 8 and 
                any(c.isupper() for c in password) and
                any(c.islower() for c in password) and
                any(c.isdigit() for c in password))
    
    def _generate_session_token(self, username):
        """ç”Ÿæˆå®‰å…¨çš„ä¼šè¯ä»¤ç‰Œ"""
        # ä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°
        token = secrets.token_urlsafe(32)
        
        # è®¾ç½®è¿‡æœŸæ—¶é—´
        expires_at = datetime.now() + timedelta(hours=2)
        
        # å­˜å‚¨ä¼šè¯ä¿¡æ¯
        self.session_tokens[token] = {
            'username': username,
            'expires_at': expires_at,
            'created_at': datetime.now()
        }
        
        return token
    
    def _is_account_locked(self, username):
        """æ£€æŸ¥è´¦æˆ·æ˜¯å¦è¢«é”å®š"""
        if username not in self.failed_attempts:
            return False
        
        attempts = self.failed_attempts[username]
        # 5æ¬¡å¤±è´¥åé”å®š30åˆ†é’Ÿ
        if len(attempts) >= 5:
            last_attempt = max(attempts)
            lock_until = last_attempt + timedelta(minutes=30)
            return datetime.now() < lock_until
        
        return False
```

### 6.2 å®‰å…¨çš„æ–‡ä»¶åŠ å¯†ç³»ç»Ÿ


**ğŸ“ å®ç”¨çš„æ–‡ä»¶åŠ å¯†å·¥å…·**

```python
import os
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
import base64

class SecureFileEncryption:
    def __init__(self):
        self.chunk_size = 64 * 1024  # 64KBå—å¤§å°ï¼Œé€‚åˆå¤§æ–‡ä»¶
    
    def _derive_key_from_password(self, password: str, salt: bytes) -> bytes:
        """ä»å¯†ç å®‰å…¨åœ°æ´¾ç”ŸåŠ å¯†å¯†é’¥"""
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=salt,
            iterations=100000,  # 10ä¸‡æ¬¡è¿­ä»£ï¼Œå¢åŠ ç ´è§£éš¾åº¦
        )
        return base64.urlsafe_b64encode(kdf.derive(password.encode()))
    
    def encrypt_file(self, file_path: str, password: str) -> str:
        """åŠ å¯†æ–‡ä»¶"""
        # 1. ç”Ÿæˆéšæœºç›å€¼
        salt = os.urandom(16)
        
        # 2. ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
        key = self._derive_key_from_password(password, salt)
        cipher = Fernet(key)
        
        # 3. å‡†å¤‡è¾“å‡ºæ–‡ä»¶è·¯å¾„
        encrypted_file_path = file_path + '.encrypted'
        
        # 4. åˆ†å—åŠ å¯†å¤§æ–‡ä»¶
        with open(file_path, 'rb') as infile, \
             open(encrypted_file_path, 'wb') as outfile:
            
            # å…ˆå†™å…¥ç›å€¼ï¼Œè§£å¯†æ—¶éœ€è¦
            outfile.write(salt)
            
            # åˆ†å—å¤„ç†æ–‡ä»¶å†…å®¹
            while True:
                chunk = infile.read(self.chunk_size)
                if not chunk:
                    break
                
                # åŠ å¯†æ•°æ®å—
                encrypted_chunk = cipher.encrypt(chunk)
                outfile.write(encrypted_chunk)
        
        return encrypted_file_path
    
    def decrypt_file(self, encrypted_file_path: str, password: str) -> str:
        """è§£å¯†æ–‡ä»¶"""
        # 1. è¯»å–ç›å€¼
        with open(encrypted_file_path, 'rb') as infile:
            salt = infile.read(16)
            
            # 2. ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
            key = self._derive_key_from_password(password, salt)
            cipher = Fernet(key)
            
            # 3. å‡†å¤‡è¾“å‡ºæ–‡ä»¶
            decrypted_file_path = encrypted_file_path.replace('.encrypted', '.decrypted')
            
            with open(decrypted_file_path, 'wb') as outfile:
                # 4. åˆ†å—è§£å¯†
                while True:
                    # FernetåŠ å¯†åçš„æ•°æ®æœ‰å›ºå®šå¼€é”€ï¼Œéœ€è¦è°ƒæ•´è¯»å–å¤§å°
                    encrypted_chunk = infile.read(self.chunk_size + 60)  # Fernetå¼€é”€çº¦60å­—èŠ‚
                    if not encrypted_chunk:
                        break
                    
                    # è§£å¯†æ•°æ®å—
                    try:
                        decrypted_chunk = cipher.decrypt(encrypted_chunk)
                        outfile.write(decrypted_chunk)
                    except Exception as e:
                        raise ValueError("è§£å¯†å¤±è´¥ï¼Œå¯èƒ½æ˜¯å¯†ç é”™è¯¯") from e
        
        return decrypted_file_path

# ä½¿ç”¨ç¤ºä¾‹
def demo_file_encryption():
    encryptor = SecureFileEncryption()
    
    # åŠ å¯†æ–‡ä»¶
    password = "my_super_secure_password_123"
    encrypted_file = encryptor.encrypt_file("sensitive_document.pdf", password)
    print(f"æ–‡ä»¶å·²åŠ å¯†: {encrypted_file}")
    
    # è§£å¯†æ–‡ä»¶
    decrypted_file = encryptor.decrypt_file(encrypted_file, password)
    print(f"æ–‡ä»¶å·²è§£å¯†: {decrypted_file}")
```

### 6.3 å®‰å…¨çš„APIé€šä¿¡


**ğŸŒ å®‰å…¨çš„APIå®¢æˆ·ç«¯å®ç°**

```python
import requests
import hmac
import hashlib
import time
import json
from urllib.parse import urlencode

class SecureAPIClient:
    def __init__(self, api_key: str, secret_key: str, base_url: str):
        self.api_key = api_key
        self.secret_key = secret_key.encode()
        self.base_url = base_url
        self.session = requests.Session()
        
        # è®¾ç½®å®‰å…¨çš„HTTPå¤´
        self.session.headers.update({
            'User-Agent': 'SecureAPIClient/1.0',
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        })
    
    def _generate_signature(self, method: str, path: str, params: dict, timestamp: int) -> str:
        """ç”ŸæˆAPIè¯·æ±‚ç­¾å"""
        # 1. æ„é€ å¾…ç­¾åå­—ç¬¦ä¸²
        query_string = urlencode(sorted(params.items()))
        sign_string = f"{method}\n{path}\n{query_string}\n{timestamp}"
        
        # 2. ä½¿ç”¨HMAC-SHA256ç”Ÿæˆç­¾å
        signature = hmac.new(
            self.secret_key,
            sign_string.encode(),
            hashlib.sha256
        ).hexdigest()
        
        return signature
    
    def _make_authenticated_request(self, method: str, path: str, data: dict = None):
        """å‘é€ç»è¿‡è®¤è¯çš„APIè¯·æ±‚"""
        # 1. å‡†å¤‡è¯·æ±‚å‚æ•°
        timestamp = int(time.time())
        params = data.copy() if data else {}
        params['api_key'] = self.api_key
        params['timestamp'] = timestamp
        
        # 2. ç”Ÿæˆç­¾å
        signature = self._generate_signature(method, path, params, timestamp)
        params['signature'] = signature
        
        # 3. å‘é€è¯·æ±‚
        url = f"{self.base_url}{path}"
        
        if method.upper() == 'GET':
            response = self.session.get(url, params=params)
        elif method.upper() == 'POST':
            response = self.session.post(url, json=params)
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„HTTPæ–¹æ³•: {method}")
        
        # 4. æ£€æŸ¥å“åº”
        if response.status_code != 200:
            raise ValueError(f"APIè¯·æ±‚å¤±è´¥: {response.status_code} - {response.text}")
        
        return response.json()
    
    def get_user_info(self, user_id: str):
        """è·å–ç”¨æˆ·ä¿¡æ¯"""
        return self._make_authenticated_request('GET', '/api/user', {'user_id': user_id})
    
    def create_order(self, order_data: dict):
        """åˆ›å»ºè®¢å•"""
        return self._make_authenticated_request('POST', '/api/order', order_data)

# ä½¿ç”¨ç¤ºä¾‹
def demo_secure_api():
    client = SecureAPIClient(
        api_key="your_api_key",
        secret_key="your_secret_key", 
        base_url="https://api.example.com"
    )
    
    # å®‰å…¨åœ°è°ƒç”¨API
    user_info = client.get_user_info("12345")
    print("ç”¨æˆ·ä¿¡æ¯:", user_info)
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„å®‰å…¨ç¼–ç¨‹åŸåˆ™


```
ğŸ”¸ å¯†é’¥ç®¡ç†å®‰å…¨ï¼šç”Ÿæˆã€å­˜å‚¨ã€ä½¿ç”¨ã€é”€æ¯å…¨ç”Ÿå‘½å‘¨æœŸä¿æŠ¤
ğŸ”¸ éšæœºæ•°å®‰å…¨ï¼šå¯†ç å­¦ç”¨é€”å¿…é¡»ä½¿ç”¨å¯†ç å­¦å®‰å…¨éšæœºæ•°
ğŸ”¸ å®ç°ç»†èŠ‚å®‰å…¨ï¼šé˜²æ­¢æ—¶åºæ”»å‡»ã€ä¾§ä¿¡é“æ”»å‡»ã€å†…å­˜æ³„éœ²
ğŸ”¸ é”™è¯¯å¤„ç†å®‰å…¨ï¼šç»Ÿä¸€é”™è¯¯å“åº”ï¼Œé¿å…ä¿¡æ¯æ³„éœ²
ğŸ”¸ æ€§èƒ½å®‰å…¨å¹³è¡¡ï¼šåœ¨ä¿è¯å®‰å…¨çš„å‰æä¸‹ä¼˜åŒ–æ€§èƒ½
```

### 7.2 å…³é”®å®è·µè¦ç‚¹


**ğŸ”¹ å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ**
- âœ… ä½¿ç”¨ä¸“ä¸šå¯†é’¥ç®¡ç†ç³»ç»Ÿï¼Œé¿å…ç¡¬ç¼–ç 
- âœ… ä¸åŒç”¨é€”ä½¿ç”¨ä¸åŒå¯†é’¥ï¼Œé¿å…å¯†é’¥é‡ç”¨  
- âœ… åŠæ—¶æ¸…ç†å†…å­˜ä¸­çš„å¯†é’¥æ•°æ®
- âœ… ä½¿ç”¨è¶³å¤Ÿå¼ºåº¦çš„å¯†é’¥æ´¾ç”Ÿç®—æ³•

**ğŸ”¹ åŠ å¯†å®ç°æœ€ä½³å®è·µ**
- âœ… é€‰æ‹©ä¸šç•Œè®¤å¯çš„æ ‡å‡†ç®—æ³•å’Œåº“
- âœ… ä½¿ç”¨å®‰å…¨çš„åŠ å¯†æ¨¡å¼å’Œå‚æ•°é…ç½®
- âœ… æ¯æ¬¡åŠ å¯†ä½¿ç”¨æ–°çš„éšæœºIV/nonce
- âœ… è€ƒè™‘ä½¿ç”¨è®¤è¯åŠ å¯†é¿å…ç¯¡æ”¹æ”»å‡»

**ğŸ”¹ ä»£ç å®¡è®¡æœ€ä½³å®è·µ**
- âœ… å»ºç«‹ç³»ç»ŸåŒ–çš„å®‰å…¨ä»£ç å®¡è®¡æµç¨‹
- âœ… ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·è¾…åŠ©äººå·¥å®¡è®¡
- âœ… é‡ç‚¹å…³æ³¨å¯†é’¥ã€éšæœºæ•°ã€åŠ å¯†å®ç°
- âœ… å®šæœŸæ›´æ–°å®‰å…¨çŸ¥è¯†å’Œå¨èƒæ¨¡å‹

### 7.3 å¸¸è§é”™è¯¯é¢„é˜²


```
âŒ ç»å¯¹ä¸è¦åšçš„äº‹æƒ…ï¼š
â€¢ ç¡¬ç¼–ç å¯†é’¥å’Œå¯†ç 
â€¢ ä½¿ç”¨å¼±éšæœºæ•°ç”Ÿæˆå™¨ç”Ÿæˆå¯†é’¥
â€¢ é‡ç”¨IVæˆ–ä½¿ç”¨å›ºå®šIV
â€¢ è‡ªå·±å®ç°åŠ å¯†ç®—æ³•
â€¢ å¿½ç•¥æ—¶åºæ”»å‡»é˜²æŠ¤
â€¢ åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯

âœ… å¿…é¡»è¦åšçš„äº‹æƒ…ï¼š
â€¢ ä½¿ç”¨ç»è¿‡éªŒè¯çš„å¯†ç å­¦åº“
â€¢ ä¸ºä¸åŒç”¨é€”ç”Ÿæˆä¸åŒçš„å¯†é’¥
â€¢ åŠæ—¶æ¸…ç†å†…å­˜ä¸­çš„æ•æ„Ÿæ•°æ®
â€¢ å®æ–½é€‚å½“çš„é”™è¯¯å¤„ç†
â€¢ å®šæœŸè¿›è¡Œå®‰å…¨æµ‹è¯•å’Œå®¡è®¡
â€¢ ä¿æŒå¯†ç å­¦çŸ¥è¯†çš„æ›´æ–°
```

### 7.4 å­¦ä¹ å»ºè®®


**ğŸ“š è¿›é˜¶å­¦ä¹ è·¯å¾„**
1. **æ·±å…¥ç†è§£å¯†ç å­¦åŸç†** - å­¦ä¹ ç®—æ³•èƒŒåçš„æ•°å­¦åŸºç¡€
2. **ç ”ç©¶å®é™…æ”»å‡»æ¡ˆä¾‹** - äº†è§£çœŸå®ä¸–ç•Œçš„å®‰å…¨å¨èƒ
3. **å®è·µå®‰å…¨ç¼–ç¨‹** - åœ¨é¡¹ç›®ä¸­åº”ç”¨å®‰å…¨ç¼–ç¨‹åŸåˆ™
4. **å‚ä¸å®‰å…¨ç¤¾åŒº** - å…³æ³¨æœ€æ–°çš„å®‰å…¨ç ”ç©¶å’Œæ¼æ´æŠ«éœ²
5. **è¿›è¡Œæ¸—é€æµ‹è¯•** - ä»æ”»å‡»è€…è§’åº¦ç†è§£å®‰å…¨é—®é¢˜

**ğŸ¯ å®ç”¨æŠ€èƒ½å‘å±•**
- æŒæ¡è‡³å°‘ä¸€ç§ä¸“ä¸šçš„å¯†ç å­¦åº“ä½¿ç”¨
- èƒ½å¤Ÿè¿›è¡ŒåŸºæœ¬çš„å®‰å…¨ä»£ç å®¡è®¡
- äº†è§£å¸¸è§çš„å®‰å…¨æµ‹è¯•å·¥å…·å’Œæ–¹æ³•
- å…·å¤‡åŸºæœ¬çš„å¨èƒå»ºæ¨¡èƒ½åŠ›
- ä¿æŒå¯¹æ–°å…´å®‰å…¨å¨èƒçš„æ•æ„Ÿåº¦

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å¯†é’¥ç®¡ç†è¦è§„èŒƒï¼Œç”Ÿå­˜ä½¿é”€å…¨æµç¨‹
- éšæœºæ•°å­—è¦å®‰å…¨ï¼Œå¯†ç å­¦çº§æ˜¯æ ‡å‡†  
- å®ç°ç»†èŠ‚é˜²æ”»å‡»ï¼Œæ—¶åºä¾§ä¿¡è¦æ³¨æ„
- é”™è¯¯å¤„ç†è¦ç»Ÿä¸€ï¼Œæ•æ„Ÿä¿¡æ¯ä¸æ³„éœ²
- æ€§èƒ½å®‰å…¨è¦å¹³è¡¡ï¼Œä»£ç å®¡è®¡ä¸å¯å°‘