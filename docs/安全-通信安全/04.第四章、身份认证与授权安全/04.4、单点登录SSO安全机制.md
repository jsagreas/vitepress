---
title: 4ã€å•ç‚¹ç™»å½•SSOå®‰å…¨æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [SSOåŸºæœ¬æ¦‚å¿µ](#1-SSOåŸºæœ¬æ¦‚å¿µ)
2. [SSOå®ç°åŸç†](#2-SSOå®ç°åŸç†)
3. [SAMLåè®®è¯¦è§£](#3-SAMLåè®®è¯¦è§£)
4. [CASåè®®å®ç°](#4-CASåè®®å®ç°)
5. [Token vs Ticketæœºåˆ¶](#5-Token-vs-Ticketæœºåˆ¶)
6. [SSOå®‰å…¨æŒ‘æˆ˜](#6-SSOå®‰å…¨æŒ‘æˆ˜)
7. [ä¼ä¸šçº§SSOéƒ¨ç½²](#7-ä¼ä¸šçº§SSOéƒ¨ç½²)
8. [å®è·µæ¶æ„è®¾è®¡](#8-å®è·µæ¶æ„è®¾è®¡)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ SSOåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•


**ç®€å•ç†è§£**ï¼šSSOå°±åƒä¸€å¼ ä¸‡èƒ½é’¥åŒ™ï¼Œä¸€æ¬¡ç™»å½•åèƒ½æ‰“å¼€æ‰€æœ‰ç›¸å…³ç³»ç»Ÿçš„é—¨

```
æ²¡æœ‰SSOçš„ç—›è‹¦ï¼š
ç”¨æˆ·è¦è®°ä½ï¼š
- é‚®ç®±ç³»ç»Ÿï¼šç”¨æˆ·å+å¯†ç 
- è´¢åŠ¡ç³»ç»Ÿï¼šå·¥å·+å¯†ç   
- OAç³»ç»Ÿï¼šå‘˜å·¥å·+å¯†ç 
- CRMç³»ç»Ÿï¼šè´¦å·+å¯†ç 

æœ‰äº†SSOçš„ä¾¿åˆ©ï¼š
ç”¨æˆ·åªéœ€è®°ä½ä¸€å¥—ï¼šå…¬å¸ç»Ÿä¸€è´¦å·+å¯†ç 
ç™»å½•ä¸€æ¬¡ï¼Œè‡ªåŠ¨è®¿é—®æ‰€æœ‰ç³»ç»Ÿï¼
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
SSOï¼ˆSingle Sign-Onï¼‰ï¼šå•ç‚¹ç™»å½•
æœ¬è´¨ï¼šç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±èƒ½è®¿é—®å¤šä¸ªç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿ
ç›®æ ‡ï¼šæå‡ç”¨æˆ·ä½“éªŒï¼Œå‡å°‘å¯†ç ç®¡ç†è´Ÿæ‹…ï¼Œå¢å¼ºå®‰å…¨æ€§
```

### 1.2 SSOè§£å†³çš„é—®é¢˜


**ç”¨æˆ·è§’åº¦çš„é—®é¢˜**ï¼š
- âŒ **å¯†ç ç–²åŠ³**ï¼šéœ€è¦è®°ä½å¤šå¥—ç”¨æˆ·åå¯†ç 
- âŒ **é‡å¤ç™»å½•**ï¼šæ¯ä¸ªç³»ç»Ÿéƒ½è¦å•ç‹¬ç™»å½•
- âŒ **å®‰å…¨é£é™©**ï¼šç”¨æˆ·å€¾å‘äºä½¿ç”¨ç®€å•å¯†ç æˆ–é‡å¤å¯†ç 

**ä¼ä¸šè§’åº¦çš„é—®é¢˜**ï¼š
- âŒ **ç®¡ç†å¤æ‚**ï¼šæ¯ä¸ªç³»ç»Ÿéƒ½è¦ç»´æŠ¤ç”¨æˆ·è´¦å·
- âŒ **å®‰å…¨æ¼æ´**ï¼šåˆ†æ•£çš„è®¤è¯å¢åŠ æ”»å‡»é¢
- âŒ **æˆæœ¬é«˜æ˜‚**ï¼šå¤šå¥—ç”¨æˆ·ç®¡ç†ç³»ç»Ÿçš„ç»´æŠ¤æˆæœ¬

### 1.3 å•ç‚¹ç™»å½• vs å•ç‚¹ç™»å‡º


**ğŸ” ç™»å½•æ€åŒæ­¥æœºåˆ¶**
```
ç”¨æˆ·åœ¨ç³»ç»ŸAç™»å½•æˆåŠŸï¼š
ç³»ç»ŸA â†’ è®¤è¯ä¸­å¿ƒï¼šæŠ¥å‘Šç™»å½•çŠ¶æ€
è®¤è¯ä¸­å¿ƒ â†’ å…¶ä»–ç³»ç»Ÿï¼šåŒæ­¥ç™»å½•çŠ¶æ€
ç»“æœï¼šç”¨æˆ·è®¿é—®ç³»ç»ŸBã€Cã€Dæ—¶è‡ªåŠ¨å·²ç™»å½•

ç™»å½•æ€åŒæ­¥ç¤ºæ„ï¼š
è®¤è¯ä¸­å¿ƒ
    â†“ åŒæ­¥ç™»å½•çŠ¶æ€
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ç³»ç»ŸAâ”‚ç³»ç»ŸBâ”‚ç³»ç»ŸCâ”‚ç³»ç»ŸDâ”‚
â”‚âœ…ç™»å½•â”‚âœ…è‡ªåŠ¨â”‚âœ…è‡ªåŠ¨â”‚âœ…è‡ªåŠ¨â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

**ğŸšª ç™»å‡ºå®‰å…¨ç®¡ç†**
```
ç”¨æˆ·åœ¨ä»»æ„ç³»ç»Ÿç™»å‡ºï¼š
ç³»ç»ŸA â†’ è®¤è¯ä¸­å¿ƒï¼šæŠ¥å‘Šç™»å‡º
è®¤è¯ä¸­å¿ƒ â†’ æ‰€æœ‰ç³»ç»Ÿï¼šé”€æ¯ä¼šè¯
ç»“æœï¼šæ‰€æœ‰ç³»ç»ŸåŒæ—¶ç™»å‡º

å®‰å…¨è¦ç‚¹ï¼š
âœ… ç™»å‡ºå¿…é¡»æ˜¯å…¨å±€çš„
âœ… ä¼šè¯ä»¤ç‰Œç«‹å³å¤±æ•ˆ
âœ… é˜²æ­¢ä¼šè¯åŠ«æŒç»§ç»­è®¿é—®
```

---

## 2. âš™ï¸ SSOå®ç°åŸç†


### 2.1 ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ


**ğŸ¢ è®¤è¯ä¸­å¿ƒçš„ä½œç”¨**
```
è®¤è¯ä¸­å¿ƒå°±åƒå…¬å¸çš„é—¨å«ï¼š
- éªŒè¯å‘˜å·¥èº«ä»½ï¼ˆç”¨æˆ·åå¯†ç ï¼‰
- å‘æ”¾é€šè¡Œè¯ï¼ˆè®¿é—®ä»¤ç‰Œï¼‰
- è®°å½•è¿›å‡ºè®°å½•ï¼ˆä¼šè¯ç®¡ç†ï¼‰
- æ§åˆ¶è®¿é—®æƒé™ï¼ˆæˆæƒæ£€æŸ¥ï¼‰
```

**æ ¸å¿ƒç»„ä»¶æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ç”¨æˆ·éªŒè¯  â”‚  â”‚  ä»¤ç‰Œç­¾å‘   â”‚   â”‚
â”‚  â”‚æ¨¡å—     â”‚  â”‚  æ¨¡å—       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ä¼šè¯ç®¡ç†  â”‚  â”‚  æƒé™æ§åˆ¶   â”‚   â”‚
â”‚  â”‚æ¨¡å—     â”‚  â”‚  æ¨¡å—       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ ä¿¡ä»»å…³ç³» â†“
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚åº”ç”¨Aâ”‚åº”ç”¨Bâ”‚åº”ç”¨Câ”‚åº”ç”¨Dâ”‚åº”ç”¨Eâ”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

### 2.2 Ticketä¼ é€’æœºåˆ¶


**ğŸ« Ticketçš„å·¥ä½œåŸç†**
```
Ticketå°±åƒæ¼”å”±ä¼šé—¨ç¥¨ï¼š
1. ç”¨æˆ·åœ¨å”®ç¥¨å¤„ï¼ˆè®¤è¯ä¸­å¿ƒï¼‰ä¹°ç¥¨
2. æ‹¿ç€ç¥¨å»æ¼”å”±ä¼šç°åœºï¼ˆåº”ç”¨ç³»ç»Ÿï¼‰
3. å·¥ä½œäººå‘˜éªŒç¥¨åæ”¾è¡Œï¼ˆåº”ç”¨éªŒè¯Ticketï¼‰
4. ä¸€å¼ ç¥¨å¯ä»¥åœ¨å¤šä¸ªå…¥å£ä½¿ç”¨ï¼ˆå¤šç³»ç»Ÿè®¿é—®ï¼‰
```

**Ticketä¼ é€’æµç¨‹**ï¼š
```
ç”¨æˆ·æµè§ˆå™¨                è®¤è¯ä¸­å¿ƒ                åº”ç”¨ç³»ç»Ÿ
     |                       |                      |
     |--[1]è®¿é—®åº”ç”¨A--------->|                      |
     |<--[2]é‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒ---|                      |
     |                       |                      |
     |--[3]è¾“å…¥ç”¨æˆ·åå¯†ç ----->|                      |
     |<--[4]è¿”å›Ticket--------|                      |
     |                       |                      |
     |--[5]æºå¸¦Ticketè®¿é—®-----|--------------------->|
     |                       |<--[6]éªŒè¯Ticket------|
     |                       |--[7]ç¡®è®¤æœ‰æ•ˆ-------->|
     |<--[8]è¿”å›åº”ç”¨å†…å®¹-----|<---------------------|
```

### 2.3 åŸŸé—´ä¿¡ä»»å…³ç³»


**ğŸ¤ ä¿¡ä»»å…³ç³»å»ºç«‹**
```
ä¿¡ä»»å…³ç³»å°±åƒåˆä½œä¼™ä¼´åè®®ï¼š

å•å‘ä¿¡ä»»ï¼š
åº”ç”¨A â†’ è®¤è¯ä¸­å¿ƒï¼ˆAä¿¡ä»»è®¤è¯ä¸­å¿ƒçš„éªŒè¯ç»“æœï¼‰

åŒå‘ä¿¡ä»»ï¼š
åº”ç”¨A â†” è®¤è¯ä¸­å¿ƒï¼ˆç›¸äº’ä¿¡ä»»ï¼Œç›¸äº’éªŒè¯ï¼‰

ä¼ é€’ä¿¡ä»»ï¼š
åº”ç”¨A â†’ è®¤è¯ä¸­å¿ƒ â†’ åº”ç”¨B
ï¼ˆAé€šè¿‡è®¤è¯ä¸­å¿ƒä¿¡ä»»Bï¼‰
```

### 2.4 ä¼šè¯è”åŠ¨æœºåˆ¶


**ğŸ“‹ ä¼šè¯çŠ¶æ€åŒæ­¥**
```java
// ä¼šè¯ç®¡ç†ç¤ºä¾‹ï¼ˆç®€åŒ–ï¼‰
public class SSOSessionManager {
    // å…¨å±€ä¼šè¯å­˜å‚¨
    private Map<String, UserSession> globalSessions;
    
    // ç”¨æˆ·ç™»å½•
    public String login(String username, String password) {
        // éªŒè¯ç”¨æˆ·å‡­æ®
        if (validateUser(username, password)) {
            // åˆ›å»ºå…¨å±€ä¼šè¯
            String sessionId = generateSessionId();
            UserSession session = new UserSession(username, sessionId);
            globalSessions.put(sessionId, session);
            
            // é€šçŸ¥æ‰€æœ‰æ³¨å†Œçš„åº”ç”¨ç³»ç»Ÿ
            notifyAllApplications(sessionId, "LOGIN");
            
            return sessionId;
        }
        return null;
    }
    
    // ç”¨æˆ·ç™»å‡º
    public void logout(String sessionId) {
        if (globalSessions.containsKey(sessionId)) {
            // åˆ é™¤å…¨å±€ä¼šè¯
            globalSessions.remove(sessionId);
            
            // é€šçŸ¥æ‰€æœ‰åº”ç”¨ç³»ç»Ÿç™»å‡º
            notifyAllApplications(sessionId, "LOGOUT");
        }
    }
}
```

---

## 3. ğŸ“œ SAMLåè®®è¯¦è§£


### 3.1 SAMLåè®®åŸºç¡€


**ğŸ”¸ SAMLæ˜¯ä»€ä¹ˆ**
```
SAMLï¼ˆSecurity Assertion Markup Languageï¼‰ï¼šå®‰å…¨æ–­è¨€æ ‡è®°è¯­è¨€
ç®€å•ç†è§£ï¼šä¸€ç§"èº«ä»½è¯æ˜ä¹¦"çš„æ ‡å‡†æ ¼å¼

å°±åƒæ ‡å‡†åŒ–çš„èº«ä»½è¯ï¼š
- æœ‰å›ºå®šçš„æ ¼å¼ï¼ˆXMLç»“æ„ï¼‰
- åŒ…å«æ ‡å‡†ä¿¡æ¯ï¼ˆèº«ä»½ã€æƒé™ã€æœ‰æ•ˆæœŸï¼‰
- å„åœ°éƒ½è®¤å¯ï¼ˆè·¨ç³»ç»Ÿé€šç”¨ï¼‰
- é˜²ä¼ªæŠ€æœ¯ï¼ˆæ•°å­—ç­¾åï¼‰
```

### 3.2 SPå’ŒIdPè§’è‰²


**ğŸ‘¥ æ ¸å¿ƒè§’è‰²è¯´æ˜**
```
IdPï¼ˆIdentity Providerï¼‰ï¼šèº«ä»½æä¾›è€…
- ä½œç”¨ï¼šå°±åƒå…¬å®‰å±€ï¼Œè´Ÿè´£éªŒè¯å’Œè¯æ˜èº«ä»½
- èŒè´£ï¼šç”¨æˆ·è®¤è¯ã€é¢å‘èº«ä»½æ–­è¨€ã€ç®¡ç†ç”¨æˆ·ä¿¡æ¯

SPï¼ˆService Providerï¼‰ï¼šæœåŠ¡æä¾›è€…  
- ä½œç”¨ï¼šå°±åƒé“¶è¡Œï¼Œéœ€è¦éªŒè¯å®¢æˆ·èº«ä»½æ‰æä¾›æœåŠ¡
- èŒè´£ï¼šæ¥æ”¶èº«ä»½æ–­è¨€ã€æˆæƒç”¨æˆ·è®¿é—®ã€æä¾›ä¸šåŠ¡æœåŠ¡

å…³ç³»å›¾ï¼š
    ç”¨æˆ·
     â†“ ç™»å½•è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IdP   â”‚ â†â”€â”€â†’ â”‚   SP    â”‚
â”‚èº«ä»½æä¾›è€…â”‚ ä¿¡ä»»å…³ç³» â”‚æœåŠ¡æä¾›è€…â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 SAMLæ–­è¨€ç»“æ„


**ğŸ“‹ æ–­è¨€å†…å®¹ç»„æˆ**
```xml
<!-- SAMLæ–­è¨€ç¤ºä¾‹ï¼ˆç®€åŒ–ï¼‰ -->
<saml:Assertion>
  <!-- æ–­è¨€åŸºæœ¬ä¿¡æ¯ -->
  <saml:Issuer>https://idp.company.com</saml:Issuer>
  <saml:Subject>
    <saml:NameID>user@company.com</saml:NameID>
  </saml:Subject>
  
  <!-- è®¤è¯å£°æ˜ï¼šç”¨æˆ·å¦‚ä½•è®¤è¯çš„ -->
  <saml:AuthnStatement>
    <saml:AuthnContext>
      <saml:AuthnContextClassRef>
        urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
      </saml:AuthnContextClassRef>
    </saml:AuthnContext>
  </saml:AuthnStatement>
  
  <!-- å±æ€§å£°æ˜ï¼šç”¨æˆ·çš„å±æ€§ä¿¡æ¯ -->
  <saml:AttributeStatement>
    <saml:Attribute Name="Department">
      <saml:AttributeValue>Engineering</saml:AttributeValue>
    </saml:Attribute>
  </saml:AttributeStatement>
</saml:Assertion>
```

### 3.4 SAML SSOæµç¨‹


**ğŸ”„ å®Œæ•´è®¤è¯æµç¨‹**
```
æ­¥éª¤è¯¦è§£ï¼š

1ï¸âƒ£ ç”¨æˆ·è®¿é—®SPåº”ç”¨
ç”¨æˆ· â†’ SPï¼šæˆ‘è¦è®¿é—®åº”ç”¨
SP â†’ ç”¨æˆ·ï¼šä½ éœ€è¦å…ˆåœ¨IdPç™»å½•

2ï¸âƒ£ é‡å®šå‘åˆ°IdP
SP â†’ ç”¨æˆ·ï¼šè¯·å‰å¾€IdPè®¤è¯ï¼ˆé™„å¸¦SAMLè¯·æ±‚ï¼‰

3ï¸âƒ£ IdPè®¤è¯ç”¨æˆ·
ç”¨æˆ· â†’ IdPï¼šè¾“å…¥ç”¨æˆ·åå¯†ç 
IdPï¼šéªŒè¯ç”¨æˆ·èº«ä»½

4ï¸âƒ£ IdPé¢å‘æ–­è¨€
IdP â†’ ç”¨æˆ·ï¼šè®¤è¯æˆåŠŸï¼Œç»™ä½ SAMLæ–­è¨€
ï¼ˆæ–­è¨€åŒ…å«ï¼šèº«ä»½ä¿¡æ¯ã€æƒé™ã€æœ‰æ•ˆæœŸç­‰ï¼‰

5ï¸âƒ£ ç”¨æˆ·å›åˆ°SP
ç”¨æˆ· â†’ SPï¼šæˆ‘æœ‰IdPçš„èº«ä»½è¯æ˜
SPï¼šéªŒè¯æ–­è¨€ç­¾åå’Œæœ‰æ•ˆæ€§

6ï¸âƒ£ æˆæƒè®¿é—®
SP â†’ ç”¨æˆ·ï¼šæ¬¢è¿ä½¿ç”¨åº”ç”¨ï¼
```

---

## 4. ğŸª CASåè®®å®ç°


### 4.1 CASç³»ç»Ÿæ¶æ„


**ğŸ¯ CASæ˜¯ä»€ä¹ˆ**
```
CASï¼ˆCentral Authentication Serviceï¼‰ï¼šä¸­å¤®è®¤è¯æœåŠ¡
ç®€å•ç†è§£ï¼šä¸€ä¸ªä¸“é—¨åšèº«ä»½è®¤è¯çš„"æœåŠ¡å°"

ç‰¹ç‚¹ï¼š
âœ… å¼€æºå…è´¹
âœ… æ˜“äºéƒ¨ç½²
âœ… æ”¯æŒå¤šç§è®¤è¯æ–¹å¼
âœ… å¹¿æ³›çš„åº”ç”¨æ”¯æŒ
```

**ç³»ç»Ÿæ¶æ„å›¾**ï¼š
```
              CASæœåŠ¡å™¨
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  è®¤è¯ç«¯ç‚¹        â”‚
         â”‚  /login         â”‚
         â”‚  /logout        â”‚
         â”‚  /validate      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†‘
              ä¿¡ä»»å…³ç³»
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨1   â”‚  åº”ç”¨2   â”‚  åº”ç”¨3   â”‚  åº”ç”¨4   â”‚
â”‚CASå®¢æˆ·ç«¯ â”‚CASå®¢æˆ·ç«¯ â”‚CASå®¢æˆ·ç«¯ â”‚CASå®¢æˆ·ç«¯ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 TGTå’ŒSTæœºåˆ¶


**ğŸ« Ticketæœºåˆ¶è¯¦è§£**
```
TGTï¼ˆTicket Granting Ticketï¼‰ï¼šç¥¨æ®æˆäºˆç¥¨æ®
- ä½œç”¨ï¼šå°±åƒä¼šå‘˜å¡ï¼Œè¯æ˜ä½ å·²ç»ç™»å½•äº†
- ç‰¹ç‚¹ï¼šé•¿æœŸæœ‰æ•ˆï¼Œå­˜å‚¨åœ¨CASæœåŠ¡å™¨
- ç”¨é€”ï¼šç”¨æ¥ç”³è¯·è®¿é—®å…·ä½“åº”ç”¨çš„ç¥¨æ®

STï¼ˆService Ticketï¼‰ï¼šæœåŠ¡ç¥¨æ®
- ä½œç”¨ï¼šå°±åƒæ™¯ç‚¹é—¨ç¥¨ï¼Œå…è®¸è®¿é—®ç‰¹å®šåº”ç”¨
- ç‰¹ç‚¹ï¼šä¸€æ¬¡æ€§ä½¿ç”¨ï¼ŒçŸ­æœŸæœ‰æ•ˆ
- ç”¨é€”ï¼šåº”ç”¨éªŒè¯ç”¨æˆ·èº«ä»½çš„å‡­è¯

å…³ç³»å›¾ï¼š
      ç”¨æˆ·ç™»å½•
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   TGT   â”‚ â† é•¿æœŸä¼šå‘˜å¡
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ ç”³è¯·è®¿é—®åº”ç”¨
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ST    â”‚ â† ä¸´æ—¶é—¨ç¥¨
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
      è®¿é—®åº”ç”¨
```

### 4.3 CASè®¤è¯æµç¨‹


**ğŸ”„ è¯¦ç»†è®¤è¯è¿‡ç¨‹**
```
ç”¨æˆ·          CASæœåŠ¡å™¨         åº”ç”¨ç³»ç»Ÿ
 |               |               |
 |--[1]è®¿é—®åº”ç”¨------------------>|
 |<--[2]é‡å®šå‘åˆ°CASç™»å½•é¡µé¢-------|
 |               |               |
 |--[3]æäº¤ç™»å½•ä¿¡æ¯-------------->|
 |<--[4]åˆ›å»ºTGTï¼Œè¿”å›ST----------|
 |               |               |
 |--[5]æºå¸¦STè®¿é—®åº”ç”¨-------------|--------------->|
 |               |<--[6]éªŒè¯ST------------------|
 |               |--[7]STæœ‰æ•ˆè¿”å›ç”¨æˆ·ä¿¡æ¯------>|
 |<--[8]å…è®¸è®¿é—®åº”ç”¨-------------|<---------------|

å…³é”®æ­¥éª¤è¯´æ˜ï¼š
[1-2] åº”ç”¨å‘ç°ç”¨æˆ·æœªç™»å½•ï¼Œé‡å®šå‘åˆ°CAS
[3-4] CASéªŒè¯ç”¨æˆ·ï¼Œåˆ›å»ºä¼šè¯ï¼Œé¢å‘ä¸´æ—¶ç¥¨æ®
[5-7] åº”ç”¨æ”¶åˆ°ç¥¨æ®ï¼Œå‘CASéªŒè¯ç¥¨æ®æœ‰æ•ˆæ€§
[8]   éªŒè¯é€šè¿‡ï¼Œç”¨æˆ·è·å¾—åº”ç”¨è®¿é—®æƒé™
```

### 4.4 CASé…ç½®ç¤ºä¾‹


**ğŸ”§ åŸºç¡€é…ç½®**
```properties
# CASæœåŠ¡å™¨é…ç½®
# æœåŠ¡å™¨åœ°å€
cas.server.name=https://cas.company.com:8443
cas.server.prefix=https://cas.company.com:8443/cas

# ç™»å½•é¡µé¢
cas.view.cas.login=/WEB-INF/view/jsp/default/ui/casLoginView.jsp

# è®¤è¯å¤„ç†å™¨
cas.authn.accept.users=admin::123456,user1::password1

# ç¥¨æ®æœ‰æ•ˆæœŸ
# TGTæœ‰æ•ˆæœŸï¼ˆ8å°æ—¶ï¼‰
cas.ticket.tgt.maxTimeToLiveInSeconds=28800
# STæœ‰æ•ˆæœŸï¼ˆ10ç§’ï¼‰
cas.ticket.st.maxTimeToLiveInSeconds=10
```

---

## 5. ğŸ”„ Token vs Ticketæœºåˆ¶


### 5.1 åŸºæœ¬æ¦‚å¿µå¯¹æ¯”


**ğŸ†š Tokenå’ŒTicketçš„åŒºåˆ«**

| ç‰¹æ€§ | **Tokenä»¤ç‰Œ** | **Ticketç¥¨æ®** |
|------|-------------|--------------|
| **æœ¬è´¨** | `è‡ªåŒ…å«çš„èº«ä»½ä¿¡æ¯` | `æˆæƒå‡­è¯çš„å¼•ç”¨` |
| **éªŒè¯æ–¹å¼** | `æœ¬åœ°éªŒè¯ï¼ˆJWTç­‰ï¼‰` | `éœ€è¦å›è°ƒéªŒè¯æœåŠ¡` |
| **ä¿¡æ¯é‡** | `åŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œæƒé™` | `åªæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦` |
| **ç½‘ç»œä¾èµ–** | `éªŒè¯æ—¶æ— éœ€ç½‘ç»œ` | `éªŒè¯æ—¶éœ€è¦ç½‘ç»œè¯·æ±‚` |
| **å®‰å…¨æ€§** | `ä¿¡æ¯å¯èƒ½æ³„éœ²` | `æ³„éœ²åå±å®³è¾ƒå°` |

### 5.2 Tokenå®ç°æ–¹å¼


**ğŸ” JWT Token SSO**
```javascript
// JWT Tokenç¤ºä¾‹
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "user123",
    "name": "å¼ ä¸‰", 
    "dept": "æŠ€æœ¯éƒ¨",
    "exp": 1640995200,
    "iat": 1640908800
  },
  "signature": "ç­¾åæ•°æ®"
}

// TokenéªŒè¯æµç¨‹
ç”¨æˆ·ç™»å½• â†’ è®¤è¯ä¸­å¿ƒéªŒè¯ â†’ é¢å‘JWT Token â†’ 
ç”¨æˆ·è®¿é—®åº”ç”¨ â†’ åº”ç”¨æœ¬åœ°éªŒè¯Token â†’ æˆæƒè®¿é—®
```

**ä¼˜åŠ¿**ï¼š
- âœ… **æ€§èƒ½å¥½**ï¼šæ— éœ€æ¯æ¬¡éƒ½è°ƒç”¨è®¤è¯ä¸­å¿ƒ
- âœ… **æ‰©å±•æ€§å¼º**ï¼šé€‚åˆå¾®æœåŠ¡æ¶æ„
- âœ… **ç¦»çº¿éªŒè¯**ï¼šåº”ç”¨å¯ä»¥ç‹¬ç«‹éªŒè¯

**åŠ£åŠ¿**ï¼š
- âŒ **ä¿¡æ¯æ³„éœ²é£é™©**ï¼šTokenåŒ…å«æ•æ„Ÿä¿¡æ¯
- âŒ **æ’¤é”€å›°éš¾**ï¼šæ— æ³•ç«‹å³æ’¤é”€å·²é¢å‘çš„Token
- âŒ **å¤§å°é™åˆ¶**ï¼šTokenè¿‡å¤§å½±å“ä¼ è¾“æ•ˆç‡

### 5.3 Ticketå®ç°æ–¹å¼


**ğŸ« Ticketå¼•ç”¨æœºåˆ¶**
```java
// TicketéªŒè¯ç¤ºä¾‹
public class TicketValidator {
    public UserInfo validateTicket(String ticket) {
        // è°ƒç”¨è®¤è¯ä¸­å¿ƒéªŒè¯Ticket
        HttpResponse response = httpClient.get(
            "https://cas-server/validate?ticket=" + ticket
        );
        
        if (response.getStatus() == 200) {
            return parseUserInfo(response.getBody());
        }
        return null;
    }
}

// TicketéªŒè¯æµç¨‹
ç”¨æˆ·ç™»å½• â†’ è®¤è¯ä¸­å¿ƒéªŒè¯ â†’ é¢å‘Ticket â†’ 
ç”¨æˆ·è®¿é—®åº”ç”¨ â†’ åº”ç”¨è¯·æ±‚è®¤è¯ä¸­å¿ƒéªŒè¯Ticket â†’ 
è®¤è¯ä¸­å¿ƒè¿”å›éªŒè¯ç»“æœ â†’ åº”ç”¨æˆæƒè®¿é—®
```

**ä¼˜åŠ¿**ï¼š
- âœ… **å®‰å…¨æ€§é«˜**ï¼šTicketæœ¬èº«ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- âœ… **å¯æ§æ€§å¼º**ï¼šå¯ä»¥éšæ—¶æ’¤é”€Ticket
- âœ… **å®¡è®¡å‹å¥½**ï¼šæ‰€æœ‰éªŒè¯éƒ½æœ‰è®°å½•

**åŠ£åŠ¿**ï¼š
- âŒ **æ€§èƒ½å¼€é”€**ï¼šæ¯æ¬¡éªŒè¯éƒ½éœ€è¦ç½‘ç»œè¯·æ±‚
- âŒ **å•ç‚¹ä¾èµ–**ï¼šè®¤è¯ä¸­å¿ƒä¸å¯ç”¨å½±å“å…¨å±€
- âŒ **ç½‘ç»œå»¶è¿Ÿ**ï¼šå¢åŠ äº†éªŒè¯çš„å“åº”æ—¶é—´

### 5.4 é€‰æ‹©ç­–ç•¥


**ğŸ¯ ä½¿ç”¨åœºæ™¯å»ºè®®**

```
é€‰æ‹©Tokenæ–¹å¼ï¼š
âœ… å¾®æœåŠ¡æ¶æ„
âœ… ç§»åŠ¨ç«¯åº”ç”¨
âœ… é«˜æ€§èƒ½è¦æ±‚
âœ… ç¦»çº¿åœºæ™¯

é€‰æ‹©Ticketæ–¹å¼ï¼š
âœ… ä¼ ç»Ÿä¼ä¸šåº”ç”¨
âœ… é«˜å®‰å…¨è¦æ±‚
âœ… é›†ä¸­ç®¡æ§éœ€æ±‚
âœ… å¼ºå®¡è®¡è¦æ±‚

æ··åˆæ–¹å¼ï¼š
âœ… å†…ç½‘ç”¨Tokenï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰
âœ… å¤–ç½‘ç”¨Ticketï¼ˆå®‰å…¨ä¼˜å…ˆï¼‰
âœ… æ•æ„Ÿæ“ä½œç”¨TicketéªŒè¯
âœ… æ™®é€šæ“ä½œç”¨TokenéªŒè¯
```

---

## 6. âš ï¸ SSOå®‰å…¨æŒ‘æˆ˜


### 6.1 å•ç‚¹æ•…éšœé£é™©


**ğŸš¨ è®¤è¯ä¸­å¿ƒå®•æœºå½±å“**
```
å•ç‚¹æ•…éšœåœºæ™¯ï¼š
è®¤è¯ä¸­å¿ƒæ•…éšœ â†’ æ— æ³•éªŒè¯ç”¨æˆ·èº«ä»½ â†’ æ‰€æœ‰åº”ç”¨æ— æ³•è®¿é—®

å½±å“èŒƒå›´ï¼š
âŒ æ–°ç”¨æˆ·æ— æ³•ç™»å½•
âŒ ç°æœ‰ä¼šè¯æ— æ³•ç»­æœŸ  
âŒ ç™»å‡ºåæ— æ³•é‡æ–°ç™»å½•
âŒ è·¨åº”ç”¨è®¿é—®ä¸­æ–­

é£é™©ç¤ºæ„ï¼š
      âŒè®¤è¯ä¸­å¿ƒ
         â†“ æ•…éšœå½±å“
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚åº”ç”¨Aâ”‚åº”ç”¨Bâ”‚åº”ç”¨Câ”‚åº”ç”¨Dâ”‚
â”‚æ— æ³• â”‚æ— æ³• â”‚æ— æ³• â”‚æ— æ³• â”‚
â”‚è®¤è¯ â”‚è®¤è¯ â”‚è®¤è¯ â”‚è®¤è¯ â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

**ğŸ›¡ï¸ é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ**
```
ä¸»ä»æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ä¸»è®¤è¯ä¸­å¿ƒâ”‚â”â”â”â”â”‚ä»è®¤è¯ä¸­å¿ƒâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“              â†“
   æ­£å¸¸æœåŠ¡      æ•…éšœåˆ‡æ¢

é›†ç¾¤æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚èŠ‚ç‚¹1â”‚èŠ‚ç‚¹2â”‚èŠ‚ç‚¹3â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
    â†“   â†“   â†“
   è´Ÿè½½å‡è¡¡åˆ†å‘
```

### 6.2 æƒé™åŒæ­¥é—®é¢˜


**ğŸ”„ æƒé™å˜æ›´å»¶è¿Ÿ**
```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·èŒä½å˜åŠ¨ â†’ æƒé™éœ€è¦è°ƒæ•´ â†’ å¤šç³»ç»ŸåŒæ­¥å»¶è¿Ÿ

é£é™©ï¼š
âŒ ç¦»èŒå‘˜å·¥ä»èƒ½è®¿é—®ç³»ç»Ÿ
âŒ æƒé™æå‡å»¶è¿Ÿå½±å“å·¥ä½œ
âŒ ä¸åŒç³»ç»Ÿæƒé™ä¸ä¸€è‡´
âŒ æƒé™æ”¶å›ä¸åŠæ—¶
```

**ğŸ“‹ æƒé™åŒæ­¥ç­–ç•¥**
```java
// æƒé™åŒæ­¥ç®¡ç†
public class PermissionSyncManager {
    // å®æ—¶åŒæ­¥ï¼šæƒé™å˜æ›´ç«‹å³æ¨é€
    public void syncPermissionRealtime(String userId, Permission newPerm) {
        // æ›´æ–°è®¤è¯ä¸­å¿ƒæƒé™
        authCenter.updatePermission(userId, newPerm);
        
        // ç«‹å³é€šçŸ¥æ‰€æœ‰åº”ç”¨ç³»ç»Ÿ
        for (Application app : applications) {
            app.updateUserPermission(userId, newPerm);
        }
    }
    
    // å®šæœŸåŒæ­¥ï¼šé˜²æ­¢æ•°æ®ä¸ä¸€è‡´
    @Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ‰§è¡Œ
    public void syncPermissionBatch() {
        // æ‰¹é‡åŒæ­¥æ‰€æœ‰ç”¨æˆ·æƒé™
        List<User> users = authCenter.getAllUsers();
        for (Application app : applications) {
            app.batchUpdatePermissions(users);
        }
    }
}
```

### 6.3 ç™»å‡ºå®‰å…¨é£é™©


**ğŸšª ä¸å®Œå…¨ç™»å‡ºé—®é¢˜**
```
é£é™©åœºæ™¯ï¼š
ç”¨æˆ·åœ¨åº”ç”¨Aç™»å‡º â†’ ä½†åº”ç”¨Bã€Cä»ä¿æŒç™»å½•çŠ¶æ€

å®‰å…¨éšæ‚£ï¼š
âŒ å…±äº«ç”µè„‘ä¸Šçš„ä¼šè¯æ®‹ç•™
âŒ æ¶æ„ç”¨æˆ·ç»§ç»­è®¿é—®å…¶ä»–ç³»ç»Ÿ
âŒ æƒé™å›æ”¶ä¸å½»åº•
âŒ å®¡è®¡è®°å½•ä¸å®Œæ•´
```

**âœ… å®‰å…¨ç™»å‡ºå®ç°**
```java
// å…¨å±€ç™»å‡ºå¤„ç†
public class GlobalLogoutHandler {
    public void performGlobalLogout(String sessionId) {
        // 1. æ ‡è®°å…¨å±€ä¼šè¯ä¸ºæ— æ•ˆ
        globalSessionManager.invalidateSession(sessionId);
        
        // 2. é€šçŸ¥æ‰€æœ‰åº”ç”¨ç³»ç»Ÿ
        List<String> logoutUrls = getApplicationLogoutUrls();
        for (String url : logoutUrls) {
            // å¼‚æ­¥é€šçŸ¥å„åº”ç”¨ç³»ç»Ÿç™»å‡º
            httpClient.postAsync(url, "sessionId=" + sessionId);
        }
        
        // 3. æ¸…é™¤ç›¸å…³ç¼“å­˜
        cacheManager.evict("user_sessions", sessionId);
        
        // 4. è®°å½•ç™»å‡ºå®¡è®¡æ—¥å¿—
        auditLogger.logLogout(sessionId, new Date());
    }
}
```

### 6.4 è·¨åŸŸä¼šè¯ç®¡ç†


**ğŸŒ è·¨åŸŸè®¿é—®æŒ‘æˆ˜**
```
è·¨åŸŸé—®é¢˜ï¼š
- ä¸åŒåŸŸåä¸‹çš„Cookieæ— æ³•å…±äº«
- æµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶
- HTTPSå’ŒHTTPæ··ç”¨é—®é¢˜
- å­åŸŸåè®¿é—®æ§åˆ¶

è§£å†³æ–¹æ¡ˆï¼š
âœ… ç»Ÿä¸€é¡¶çº§åŸŸå
âœ… ä½¿ç”¨CORSé…ç½®
âœ… Tokenä¼ é€’æœºåˆ¶
âœ… PostMessageé€šä¿¡
```

---

## 7. ğŸ¢ ä¼ä¸šçº§SSOéƒ¨ç½²


### 7.1 LDAPé›†æˆ


**ğŸ“ LDAPç”¨æˆ·ç®¡ç†**
```
LDAPï¼ˆLightweight Directory Access Protocolï¼‰ï¼šè½»é‡çº§ç›®å½•è®¿é—®åè®®
ç®€å•ç†è§£ï¼šä¼ä¸šçš„"ç”µè¯ç°¿"ï¼Œå­˜å‚¨æ‰€æœ‰å‘˜å·¥ä¿¡æ¯

LDAPç›®å½•ç»“æ„ï¼š
dc=company,dc=com
â”œâ”€â”€ ou=users
â”‚   â”œâ”€â”€ cn=zhangsan,ou=users,dc=company,dc=com
â”‚   â”œâ”€â”€ cn=lisi,ou=users,dc=company,dc=com
â”‚   â””â”€â”€ cn=wangwu,ou=users,dc=company,dc=com
â””â”€â”€ ou=groups
    â”œâ”€â”€ cn=developers,ou=groups,dc=company,dc=com
    â””â”€â”€ cn=managers,ou=groups,dc=company,dc=com
```

**ğŸ”— LDAPé›†æˆé…ç½®**
```properties
# LDAPæœåŠ¡å™¨é…ç½®
ldap.url=ldap://ldap.company.com:389
ldap.base=dc=company,dc=com
ldap.userDn=cn=admin,dc=company,dc=com
ldap.password=adminpassword

# ç”¨æˆ·æœç´¢é…ç½®
ldap.user.searchBase=ou=users
ldap.user.searchFilter=(uid={0})
ldap.user.dnPattern=cn={0},ou=users,dc=company,dc=com

# ç»„æœç´¢é…ç½®
ldap.group.searchBase=ou=groups
ldap.group.searchFilter=(member={0})
```

### 7.2 ADåŸŸè®¤è¯


**ğŸ¢ Active Directoryé›†æˆ**
```
ADåŸŸè®¤è¯ä¼˜åŠ¿ï¼š
âœ… ä¸Windowsç³»ç»Ÿæ·±åº¦é›†æˆ
âœ… æ”¯æŒKerberosåè®®
âœ… ç»„ç­–ç•¥ç®¡ç†
âœ… å•ç‚¹ç™»å½•åˆ°Windowsæ¡Œé¢

ADåŸŸè®¤è¯æµç¨‹ï¼š
ç”¨æˆ·å¼€æœº â†’ WindowsåŸŸç™»å½• â†’ è·å–Kerberosç¥¨æ® â†’ 
è®¿é—®ä¼ä¸šåº”ç”¨ â†’ åº”ç”¨éªŒè¯Kerberosç¥¨æ® â†’ è‡ªåŠ¨ç™»å½•
```

### 7.3 å¤šç³»ç»Ÿé›†æˆæ¶æ„


**ğŸ”— ä¼ä¸šçº§é›†æˆæ¶æ„**
```
                ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   CAS/SAML  â”‚
                â”‚   æœåŠ¡å™¨     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†‘
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“        â†“        â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   LDAP  â”‚   ADåŸŸ  â”‚  æ•°æ®åº“  â”‚
         â”‚  ç”¨æˆ·åº“  â”‚  è®¤è¯   â”‚ ç”¨æˆ·å­˜å‚¨ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        åº”ç”¨ç³»ç»Ÿé›†ç¾¤              â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚  OAç³»ç»Ÿ  â”‚ ERPç³»ç»Ÿ â”‚  é‚®ç®±ç³»ç»Ÿ   â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ CRMç³»ç»Ÿ â”‚ è´¢åŠ¡ç³»ç»Ÿ â”‚  é¡¹ç›®ç®¡ç†   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 æƒé™æ˜ å°„ç­–ç•¥


**ğŸ—‚ï¸ ç”¨æˆ·æƒé™æ˜ å°„**
```java
// æƒé™æ˜ å°„é…ç½®
public class PermissionMapper {
    // LDAPç»„åˆ°åº”ç”¨è§’è‰²çš„æ˜ å°„
    private Map<String, List<String>> groupRoleMapping = Map.of(
        "cn=developers,ou=groups,dc=company,dc=com", 
        List.of("developer", "user"),
        
        "cn=managers,ou=groups,dc=company,dc=com", 
        List.of("manager", "approver", "user"),
        
        "cn=admins,ou=groups,dc=company,dc=com", 
        List.of("admin", "manager", "user")
    );
    
    // æ ¹æ®LDAPç»„è·å–åº”ç”¨æƒé™
    public List<String> mapLdapGroupsToRoles(List<String> ldapGroups) {
        return ldapGroups.stream()
            .flatMap(group -> groupRoleMapping.getOrDefault(group, List.of()).stream())
            .distinct()
            .collect(Collectors.toList());
    }
}
```

---

## 8. ğŸ—ï¸ å®è·µæ¶æ„è®¾è®¡


### 8.1 SSOç³»ç»Ÿæ¶æ„å›¾


**ğŸ¯ å®Œæ•´æ¶æ„è®¾è®¡**
```
                    ã€ç”¨æˆ·è®¿é—®å±‚ã€‘
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   ç”¨æˆ·æµè§ˆå™¨     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    ã€è´Ÿè½½å‡è¡¡å±‚ã€‘
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Nginx/HAProxy  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    ã€è®¤è¯æœåŠ¡å±‚ã€‘
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ CASæœåŠ¡å™¨1   â”‚ CASæœåŠ¡å™¨2   â”‚
            â”‚  (ä¸»èŠ‚ç‚¹)   â”‚  (å¤‡èŠ‚ç‚¹)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    ã€ä¼šè¯å­˜å‚¨å±‚ã€‘
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Redisé›†ç¾¤      â”‚
                 â”‚  (ä¼šè¯ç¼“å­˜)     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    ã€ç”¨æˆ·æ•°æ®å±‚ã€‘
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    LDAP     â”‚   MySQL     â”‚
            â”‚   ç”¨æˆ·ç›®å½•   â”‚  é…ç½®æ•°æ®åº“  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    ã€åº”ç”¨æ¥å…¥å±‚ã€‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  åº”ç”¨A   â”‚  åº”ç”¨B   â”‚  åº”ç”¨C   â”‚  åº”ç”¨D   â”‚
        â”‚CASå®¢æˆ·ç«¯ â”‚CASå®¢æˆ·ç«¯ â”‚CASå®¢æˆ·ç«¯ â”‚CASå®¢æˆ·ç«¯ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 CASæ¡†æ¶å®ç°


**ğŸ”§ CASæœåŠ¡ç«¯éƒ¨ç½²**
```yaml
# docker-compose.yml
version: '3.8'
services:
  cas-server:
    image: apereo/cas:6.6.0
    ports:
      - "8443:8443"
    environment:
      - SPRING_PROFILES_ACTIVE=standalone
    volumes:
      - ./cas-config:/etc/cas/config
      - ./cas-logs:/var/log
    depends_on:
      - redis
      - mysql

  redis:
    image: redis:6.2
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: cas
    ports:
      - "3306:3306"
```

**ğŸ”Œ åº”ç”¨ç³»ç»Ÿé›†æˆ**
```java
// Spring Bootåº”ç”¨é›†æˆCAS
@Configuration
@EnableWebSecurity
public class CasSecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/public/**").permitAll()
                .anyRequest().authenticated()
            .and()
            .apply(new CasAuthenticationConfigurer())
                .casAuthenticationProvider(casAuthenticationProvider())
                .casProcessingUrl("/login/cas")
                .casLoginUrl("https://cas-server:8443/cas/login")
                .casLogoutUrl("https://cas-server:8443/cas/logout")
                .casService("http://localhost:8080/login/cas");
    }
    
    @Bean
    public CasAuthenticationProvider casAuthenticationProvider() {
        CasAuthenticationProvider provider = new CasAuthenticationProvider();
        provider.setTicketValidator(ticketValidator());
        provider.setUserDetailsService(userDetailsService());
        return provider;
    }
}
```

### 8.3 ä¼ä¸šåº”ç”¨åœºæ™¯


**ğŸ“Š å…¸å‹éƒ¨ç½²åœºæ™¯**

| åœºæ™¯ç±»å‹ | **ç”¨æˆ·è§„æ¨¡** | **åº”ç”¨æ•°é‡** | **æ¨èæ–¹æ¡ˆ** | **å…³é”®ç‰¹æ€§** |
|---------|------------|------------|------------|------------|
| **å°å‹ä¼ä¸š** | `< 500äºº` | `< 10ä¸ªåº”ç”¨` | `å•èŠ‚ç‚¹CAS` | `ç®€å•éƒ¨ç½²ï¼Œæˆæœ¬ä½` |
| **ä¸­å‹ä¼ä¸š** | `500-5000äºº` | `10-50ä¸ªåº”ç”¨` | `CASé›†ç¾¤` | `é«˜å¯ç”¨ï¼Œè´Ÿè½½å‡è¡¡` |
| **å¤§å‹ä¼ä¸š** | `> 5000äºº` | `> 50ä¸ªåº”ç”¨` | `ä¼ä¸šçº§SSOå¹³å°` | `å¤šæ•°æ®ä¸­å¿ƒï¼Œç¾å¤‡` |
| **é›†å›¢å…¬å¸** | `> 10000äºº` | `> 100ä¸ªåº”ç”¨` | `è”é‚¦è®¤è¯` | `å¤šåŸŸä¿¡ä»»ï¼Œç»Ÿä¸€ç®¡æ§` |

**ğŸ¯ å®æ–½ç­–ç•¥**
```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€SSO
âœ… æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿæ¥å…¥
âœ… åŸºæœ¬çš„ç™»å½•ç™»å‡ºåŠŸèƒ½
âœ… LDAPç”¨æˆ·åŒæ­¥

ç¬¬äºŒé˜¶æ®µï¼šåŠŸèƒ½å®Œå–„
âœ… æƒé™ç»†åŒ–ç®¡ç†
âœ… å®¡è®¡æ—¥å¿—å®Œå–„
âœ… ç§»åŠ¨ç«¯æ”¯æŒ

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§
âœ… å¤šå› å­è®¤è¯
âœ… é£é™©è¯„ä¼°
âœ… é›¶ä¿¡ä»»æ¶æ„
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SSOæœ¬è´¨ï¼šä¸€æ¬¡ç™»å½•ï¼Œå¤šç³»ç»Ÿè®¿é—®çš„ç»Ÿä¸€è®¤è¯æœºåˆ¶
ğŸ”¸ æ ¸å¿ƒç»„ä»¶ï¼šè®¤è¯ä¸­å¿ƒã€ä»¤ç‰Œä¼ é€’ã€ä¼šè¯ç®¡ç†ã€ä¿¡ä»»å…³ç³»
ğŸ”¸ ä¸»æµåè®®ï¼šSAMLï¼ˆæ ‡å‡†åŒ–ï¼‰ã€CASï¼ˆç®€å•æ˜“ç”¨ï¼‰
ğŸ”¸ å®ç°æ–¹å¼ï¼šTokenï¼ˆè‡ªåŒ…å«ï¼‰vs Ticketï¼ˆå¼•ç”¨éªŒè¯ï¼‰
ğŸ”¸ å®‰å…¨æŒ‘æˆ˜ï¼šå•ç‚¹æ•…éšœã€æƒé™åŒæ­¥ã€ç™»å‡ºå®‰å…¨ã€è·¨åŸŸé—®é¢˜
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ SSOçš„æ ¸å¿ƒä»·å€¼**
```
ç”¨æˆ·ä½“éªŒï¼š
- å‡å°‘å¯†ç è®°å¿†è´Ÿæ‹…
- æ— ç¼è®¿é—®å¤šä¸ªç³»ç»Ÿ
- æå‡å·¥ä½œæ•ˆç‡

ä¼ä¸šç®¡ç†ï¼š
- ç»Ÿä¸€ç”¨æˆ·ç®¡ç†
- é›†ä¸­æƒé™æ§åˆ¶
- é™ä½ç®¡ç†æˆæœ¬

å®‰å…¨æå‡ï¼š
- å‡å°‘å¯†ç æ³„éœ²é£é™©
- ç»Ÿä¸€å®‰å…¨ç­–ç•¥
- å®Œæ•´å®¡è®¡è¿½è¸ª
```

**ğŸ”¹ æŠ€æœ¯é€‰å‹è€ƒè™‘**
```
é€‰æ‹©SAMLï¼š
âœ… æ ‡å‡†åŒ–ç¨‹åº¦é«˜
âœ… è·¨ç»„ç»‡ä¿¡ä»»
âœ… åŠŸèƒ½ä¸°å¯Œå®Œæ•´
âŒ é…ç½®ç›¸å¯¹å¤æ‚

é€‰æ‹©CASï¼š
âœ… éƒ¨ç½²ç®€å•å¿«é€Ÿ
âœ… ç¤¾åŒºæ”¯æŒæ´»è·ƒ
âœ… ä¸­æ–‡èµ„æ–™ä¸°å¯Œ
âŒ åŠŸèƒ½ç›¸å¯¹å•ä¸€

é€‰æ‹©è‡ªç ”ï¼š
âœ… å®Œå…¨ç¬¦åˆéœ€æ±‚
âœ… å¯æ§æ€§å¼º
âŒ å¼€å‘æˆæœ¬é«˜
âŒ å®‰å…¨é£é™©å¤§
```

**ğŸ”¹ éƒ¨ç½²å®æ–½è¦ç‚¹**
```
è§„åˆ’é˜¶æ®µï¼š
- æ¢³ç†ç°æœ‰ç³»ç»Ÿ
- åˆ¶å®šæ¥å…¥ä¼˜å…ˆçº§
- è®¾è®¡æƒé™æ¨¡å‹
- å‡†å¤‡åŸºç¡€è®¾æ–½

å®æ–½é˜¶æ®µï¼š
- åˆ†æ‰¹æ¬¡æ¥å…¥
- å……åˆ†æµ‹è¯•éªŒè¯
- åˆ¶å®šå›é€€æ–¹æ¡ˆ
- åŸ¹è®­è¿ç»´äººå‘˜

è¿ç»´é˜¶æ®µï¼š
- ç›‘æ§ç³»ç»Ÿå¥åº·
- å®šæœŸæƒé™å®¡æŸ¥
- å®‰å…¨æ¼æ´ä¿®å¤
- æ€§èƒ½ä¼˜åŒ–è°ƒæ•´
```

### 9.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ**
- âœ… **å¤šå› å­è®¤è¯**ï¼šå¯†ç +çŸ­ä¿¡/é‚®ç®±/ç¡¬ä»¶ä»¤ç‰Œ
- âœ… **ä¼šè¯ç®¡ç†**ï¼šåˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œå®‰å…¨çš„ç™»å‡º
- âœ… **ä¼ è¾“åŠ å¯†**ï¼šå…¨ç¨‹HTTPSï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»
- âœ… **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰è®¤è¯å’Œæˆæƒæ“ä½œ
- âœ… **å¼‚å¸¸æ£€æµ‹**ï¼šç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º

**âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- âœ… **ç¼“å­˜æœºåˆ¶**ï¼šç”¨æˆ·ä¿¡æ¯å’Œæƒé™ç¼“å­˜
- âœ… **è´Ÿè½½å‡è¡¡**ï¼šå¤šèŠ‚ç‚¹åˆ†æ‹…è®¤è¯å‹åŠ›
- âœ… **å°±è¿‘éƒ¨ç½²**ï¼šå‡å°‘ç½‘ç»œå»¶è¿Ÿ
- âœ… **å¼‚æ­¥å¤„ç†**ï¼šéå…³é”®æ“ä½œå¼‚æ­¥æ‰§è¡Œ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- SSOç»Ÿä¸€è®¤è¯é—¨ï¼Œä¸€æ¬¡ç™»å½•èµ°å¤©ä¸‹
- è®¤è¯ä¸­å¿ƒæ˜¯æ ¸å¿ƒï¼Œç¥¨æ®ä¼ é€’å»ºä¿¡ä»»
- å®‰å…¨ä¾¿åˆ©è¦å¹³è¡¡ï¼Œç›‘æ§å®¡è®¡ä¸èƒ½å°‘