---
title: 1ã€HTTPå®‰å…¨å“åº”å¤´é…ç½®
---
## ğŸ“š ç›®å½•

1. [HTTPå®‰å…¨å“åº”å¤´æ¦‚è¿°](#1-HTTPå®‰å…¨å“åº”å¤´æ¦‚è¿°)
2. [X-Frame-Optionsï¼šé˜²æ­¢ç‚¹å‡»åŠ«æŒ](#2-X-Frame-Optionsé˜²æ­¢ç‚¹å‡»åŠ«æŒ)
3. [Content-Security-Policyï¼šå†…å®¹å®‰å…¨ç­–ç•¥](#3-Content-Security-Policyå†…å®¹å®‰å…¨ç­–ç•¥)
4. [X-Content-Type-Optionsï¼šMIMEç±»å‹é˜²æŠ¤](#4-X-Content-Type-Options-MIMEç±»å‹é˜²æŠ¤)
5. [Strict-Transport-Securityï¼šå¼ºåˆ¶HTTPS](#5-Strict-Transport-Securityå¼ºåˆ¶HTTPS)
6. [X-XSS-Protectionï¼šXSSè¿‡æ»¤å™¨æ§åˆ¶](#6-X-XSS-Protection-XSSè¿‡æ»¤å™¨æ§åˆ¶)
7. [Referrer-Policyï¼šéšç§ä¿¡æ¯æ§åˆ¶](#7-Referrer-Policyéšç§ä¿¡æ¯æ§åˆ¶)
8. [Permissions-Policyï¼šæµè§ˆå™¨ç‰¹æ€§æ§åˆ¶](#8-Permissions-Policyæµè§ˆå™¨ç‰¹æ€§æ§åˆ¶)
9. [å®æˆ˜é…ç½®éƒ¨ç½²](#9-å®æˆ˜é…ç½®éƒ¨ç½²)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ HTTPå®‰å…¨å“åº”å¤´æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯HTTPå®‰å…¨å“åº”å¤´


**ç®€å•ç†è§£**ï¼šHTTPå®‰å…¨å“åº”å¤´å°±åƒç»™ä½ çš„ç½‘ç«™åŠ ä¸Šäº†ä¸€é“é“"å®‰å…¨é”"

```
æ™®é€šç½‘ç«™ â†’ æµè§ˆå™¨ï¼šè¿™æ˜¯æˆ‘çš„ç½‘é¡µå†…å®¹
å®‰å…¨ç½‘ç«™ â†’ æµè§ˆå™¨ï¼šè¿™æ˜¯æˆ‘çš„ç½‘é¡µå†…å®¹ + è¿™äº›æ˜¯æˆ‘çš„å®‰å…¨è§„åˆ™

æµè§ˆå™¨æ”¶åˆ°å®‰å…¨è§„åˆ™åï¼š
"å¥½çš„ï¼Œæˆ‘æŒ‰ç…§ä½ çš„è§„åˆ™æ¥ä¿æŠ¤ç”¨æˆ·"
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸš« **é˜»æ­¢æ¶æ„æ”»å‡»**ï¼šé˜²æ­¢XSSã€ç‚¹å‡»åŠ«æŒç­‰æ”»å‡»
- ğŸ”’ **æ§åˆ¶èµ„æºåŠ è½½**ï¼šé™åˆ¶å“ªäº›å†…å®¹å¯ä»¥åœ¨ä½ çš„ç½‘ç«™ä¸Šè¿è¡Œ
- ğŸ›¡ï¸ **å¢å¼ºæµè§ˆå™¨é˜²æŠ¤**ï¼šè®©æµè§ˆå™¨å¸®ä½ æ‹¦æˆªå±é™©æ“ä½œ
- ğŸ” **å¼ºåŒ–ä¼ è¾“å®‰å…¨**ï¼šç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨å“åº”å¤´


**ç°å®åœºæ™¯**ï¼š
```
âŒ æ²¡æœ‰å®‰å…¨å“åº”å¤´çš„ç½‘ç«™ï¼š
ç”¨æˆ·è®¿é—® â†’ æµè§ˆå™¨æ˜¾ç¤ºå†…å®¹ â†’ å¯èƒ½è¢«æ¶æ„iframeåµŒå¥—ã€XSSæ”»å‡»

âœ… æœ‰å®‰å…¨å“åº”å¤´çš„ç½‘ç«™ï¼š
ç”¨æˆ·è®¿é—® â†’ æµè§ˆå™¨æ£€æŸ¥å®‰å…¨è§„åˆ™ â†’ æŒ‰è§„åˆ™ä¿æŠ¤ç”¨æˆ· â†’ å®‰å…¨æ˜¾ç¤ºå†…å®¹
```

### 1.3 å¸¸è§å®‰å…¨å“åº”å¤´ä¸€è§ˆ


| å“åº”å¤´åç§° | **ä¸»è¦ä½œç”¨** | **é˜²æŠ¤ç›®æ ‡** |
|------------|-------------|-------------|
| `X-Frame-Options` | **é˜²æ­¢é¡µé¢è¢«åµŒå…¥iframe** | ç‚¹å‡»åŠ«æŒæ”»å‡» |
| `Content-Security-Policy` | **æ§åˆ¶èµ„æºåŠ è½½ç­–ç•¥** | XSSã€ä»£ç æ³¨å…¥ |
| `X-Content-Type-Options` | **ç¦æ­¢MIMEç±»å‹å—…æ¢** | æ–‡ä»¶ç±»å‹æ”»å‡» |
| `Strict-Transport-Security` | **å¼ºåˆ¶ä½¿ç”¨HTTPS** | ä¸­é—´äººæ”»å‡» |
| `X-XSS-Protection` | **å¯ç”¨XSSè¿‡æ»¤å™¨** | åå°„å‹XSS |
| `Referrer-Policy` | **æ§åˆ¶Refererä¿¡æ¯** | ä¿¡æ¯æ³„éœ² |
| `Permissions-Policy` | **æ§åˆ¶æµè§ˆå™¨API** | æ¶æ„ç‰¹æ€§æ»¥ç”¨ |

---

## 2. ğŸ–¼ï¸ X-Frame-Optionsï¼šé˜²æ­¢ç‚¹å‡»åŠ«æŒ


### 2.1 ä»€ä¹ˆæ˜¯ç‚¹å‡»åŠ«æŒ


**é€šä¿—è§£é‡Š**ï¼šç‚¹å‡»åŠ«æŒå°±åƒ"å·æ¢æ¢æŸ±"çš„æŠŠæˆ

```
æ”»å‡»åœºæ™¯ï¼š
æ¶æ„ç½‘ç«™A â†’ ç”¨æˆ·çœ‹åˆ°ï¼š"ç‚¹å‡»é¢†å–çº¢åŒ…"
å®é™…æƒ…å†µï¼šæ¶æ„ç½‘ç«™Aç”¨é€æ˜iframeåµŒå¥—äº†é“¶è¡Œç½‘ç«™B
ç”¨æˆ·ç‚¹å‡» â†’ å®é™…ç‚¹å‡»çš„æ˜¯é“¶è¡Œç½‘ç«™çš„"è½¬è´¦"æŒ‰é’®

ç”¨æˆ·ä»¥ä¸ºï¼šç‚¹å‡»é¢†çº¢åŒ…
å®é™…ç»“æœï¼šé’±è¢«è½¬èµ°äº†ï¼
```

### 2.2 X-Frame-Optionsé…ç½®è¯¦è§£


**ä¸‰ç§é…ç½®å€¼**ï¼š

**ğŸš« DENYï¼šå®Œå…¨ç¦æ­¢**
```
X-Frame-Options: DENY

å«ä¹‰ï¼šè¿™ä¸ªé¡µé¢ä¸å…è®¸è¢«ä»»ä½•ç½‘ç«™ç”¨iframeåµŒå¥—
é€‚ç”¨ï¼šé“¶è¡Œã€æ”¯ä»˜ç­‰é«˜å®‰å…¨æ€§é¡µé¢
```

**ğŸ  SAMEORIGINï¼šåŒæºå…è®¸**
```
X-Frame-Options: SAMEORIGIN

å«ä¹‰ï¼šåªå…è®¸åŒä¸€ä¸ªç½‘ç«™çš„å…¶ä»–é¡µé¢åµŒå¥—
é€‚ç”¨ï¼šç½‘ç«™å†…éƒ¨é¡µé¢äº’ç›¸åµŒå¥—
```

**ğŸ¯ ALLOW-FROMï¼šæŒ‡å®šåŸŸå**
```
X-Frame-Options: ALLOW-FROM https://trusted-site.com

å«ä¹‰ï¼šåªå…è®¸æŒ‡å®šçš„ç½‘ç«™åµŒå¥—
é€‚ç”¨ï¼šä¸å¯ä¿¡ç¬¬ä¸‰æ–¹åˆä½œçš„åœºæ™¯
```

### 2.3 å®é™…é…ç½®ç¤ºä¾‹


**Nginxé…ç½®**ï¼š
```nginx
# åœ¨æœåŠ¡å™¨é…ç½®ä¸­æ·»åŠ 
server {
    # ç¦æ­¢æ‰€æœ‰iframeåµŒå¥—
    add_header X-Frame-Options "DENY" always;
    
    # æˆ–è€…åªå…è®¸åŒæºåµŒå¥—
    # add_header X-Frame-Options "SAMEORIGIN" always;
}
```

**åº”ç”¨å±‚é…ç½®ï¼ˆExpress.jsï¼‰**ï¼š
```javascript
app.use((req, res, next) => {
    res.setHeader('X-Frame-Options', 'DENY');
    next();
});
```

### 2.4 é…ç½®æ•ˆæœéªŒè¯


**æµ‹è¯•æ–¹æ³•**ï¼š
```html
<!-- åœ¨å…¶ä»–ç½‘ç«™å°è¯•åµŒå¥—ä½ çš„é¡µé¢ -->
<iframe src="https://your-protected-site.com"></iframe>

<!-- é…ç½®æ­£ç¡®çš„è¯ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºé”™è¯¯ï¼š-->
<!-- "Refused to display in a frame because it set 'X-Frame-Options' to 'DENY'" -->
```

---

## 3. ğŸ›¡ï¸ Content-Security-Policyï¼šå†…å®¹å®‰å…¨ç­–ç•¥


### 3.1 CSPæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šCSPå°±åƒç»™ä½ çš„ç½‘ç«™åˆ¶å®š"å®‰å…¨è§„ç« åˆ¶åº¦"

```
æ²¡æœ‰CSPçš„ç½‘ç«™ï¼šä»»ä½•JavaScriptã€CSSã€å›¾ç‰‡éƒ½å¯ä»¥åŠ è½½å’Œæ‰§è¡Œ
æœ‰CSPçš„ç½‘ç«™ï¼šåªæœ‰ç¬¦åˆè§„åˆ™çš„å†…å®¹æ‰èƒ½åŠ è½½å’Œæ‰§è¡Œ

å°±åƒï¼š
æ²¡æœ‰é—¨ç¦çš„å¤§æ¥¼ vs æœ‰ä¸¥æ ¼é—¨ç¦åˆ¶åº¦çš„å¤§æ¥¼
```

### 3.2 CSPæŒ‡ä»¤è¯¦è§£


**ğŸ”§ default-srcï¼šé»˜è®¤ç­–ç•¥**
```
Content-Security-Policy: default-src 'self'

å«ä¹‰ï¼šæ‰€æœ‰èµ„æºåªèƒ½ä»è‡ªå·±çš„ç½‘ç«™åŠ è½½
æ•ˆæœï¼šscriptã€imageã€styleç­‰å¦‚æœæ²¡æœ‰å•ç‹¬è®¾ç½®ï¼Œéƒ½éµå¾ªè¿™ä¸ªè§„åˆ™
```

**ğŸ“œ script-srcï¼šè„šæœ¬ç­–ç•¥**
```javascript
// åªå…è®¸è‡ªå·±ç½‘ç«™çš„è„šæœ¬
script-src 'self'

// å…è®¸æŒ‡å®šCDNçš„è„šæœ¬
script-src 'self' https://cdn.jsdelivr.net

// å…è®¸å†…è”è„šæœ¬ï¼ˆä¸æ¨èï¼‰
script-src 'self' 'unsafe-inline'

// ä½¿ç”¨nonceæœºåˆ¶ï¼ˆæ¨èï¼‰
script-src 'self' 'nonce-abc123'
```

**ğŸ–¼ï¸ img-srcï¼šå›¾ç‰‡ç­–ç•¥**
```javascript
// å›¾ç‰‡å¯ä»¥ä»ä»»ä½•åœ°æ–¹åŠ è½½
img-src *

// åªå…è®¸HTTPSå›¾ç‰‡
img-src https:

// å…è®¸data URIå›¾ç‰‡
img-src 'self' data:
```

**ğŸ¨ style-srcï¼šæ ·å¼ç­–ç•¥**
```javascript
// æ ·å¼è¡¨ç­–ç•¥
style-src 'self' https://fonts.googleapis.com

// å…è®¸å†…è”æ ·å¼
style-src 'self' 'unsafe-inline'
```

### 3.3 nonceæœºåˆ¶è¯¦è§£


**ä»€ä¹ˆæ˜¯nonce**ï¼šä¸€æ¬¡æ€§éšæœºä»¤ç‰Œï¼Œç¡®ä¿è„šæœ¬çš„åˆæ³•æ€§

```html
<!-- æœåŠ¡å™¨ç”Ÿæˆéšæœºnonce -->
<script nonce="abc123def456">
    console.log('è¿™ä¸ªè„šæœ¬æ˜¯å®‰å…¨çš„');
</script>

<!-- CSPé…ç½® -->
<meta http-equiv="Content-Security-Policy" 
      content="script-src 'self' 'nonce-abc123def456'">
```

**nonceçš„å¥½å¤„**ï¼š
- âœ… **ç²¾ç¡®æ§åˆ¶**ï¼šåªæœ‰å¸¦æ­£ç¡®nonceçš„è„šæœ¬æ‰èƒ½æ‰§è¡Œ
- âœ… **é˜²XSS**ï¼šæ¶æ„æ³¨å…¥çš„è„šæœ¬æ²¡æœ‰æ­£ç¡®nonceï¼Œæ— æ³•æ‰§è¡Œ
- âœ… **çµæ´»æ€§**ï¼šå¯ä»¥å…è®¸ç‰¹å®šçš„å†…è”è„šæœ¬

### 3.4 CSPå®æˆ˜é…ç½®


**åŸºç¡€å®‰å…¨é…ç½®**ï¼š
```
Content-Security-Policy: 
    default-src 'self';
    script-src 'self' https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    img-src 'self' data: https:;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self' https://api.example.com;
```

**ä¸¥æ ¼å®‰å…¨é…ç½®**ï¼š
```
Content-Security-Policy: 
    default-src 'none';
    script-src 'self' 'nonce-{random}';
    style-src 'self';
    img-src 'self' data:;
    font-src 'self';
    connect-src 'self';
```

---

## 4. ğŸ” X-Content-Type-Optionsï¼šMIMEç±»å‹é˜²æŠ¤


### 4.1 ä»€ä¹ˆæ˜¯MIMEç±»å‹å—…æ¢


**é€šä¿—ç†è§£**ï¼šæµè§ˆå™¨"çŒœæµ‹"æ–‡ä»¶ç±»å‹çš„è¡Œä¸º

```
æ­£å¸¸æƒ…å†µï¼š
æœåŠ¡å™¨è¯´ï¼š"è¿™æ˜¯ä¸€ä¸ªCSSæ–‡ä»¶" â†’ æµè§ˆå™¨ï¼š"å¥½çš„ï¼Œæˆ‘æŒ‰CSSå¤„ç†"

MIMEå—…æ¢ï¼š
æœåŠ¡å™¨è¯´ï¼š"è¿™æ˜¯ä¸€ä¸ªCSSæ–‡ä»¶" â†’ æµè§ˆå™¨ï¼š"è®©æˆ‘çœ‹çœ‹å†…å®¹...å“¦ï¼Œè¿™åƒJavaScriptï¼Œæˆ‘æŒ‰JSæ‰§è¡Œ"
```

### 4.2 MIMEå—…æ¢çš„å®‰å…¨é£é™©


**æ”»å‡»åœºæ™¯**ï¼š
```
1. æ”»å‡»è€…ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ â†’ upload/avatar.jpg
2. ä½†å›¾ç‰‡æ–‡ä»¶é‡Œè—ç€JavaScriptä»£ç 
3. æœåŠ¡å™¨æ ‡è®°ä¸º Content-Type: image/jpeg
4. æµè§ˆå™¨å—…æ¢å‘ç°åƒJSä»£ç  â†’ æ‰§è¡Œæ¶æ„è„šæœ¬
5. ç”¨æˆ·é­å—XSSæ”»å‡»
```

### 4.3 nosniffé…ç½®


**é…ç½®æ–¹æ³•**ï¼š
```
X-Content-Type-Options: nosniff

å«ä¹‰ï¼šå‘Šè¯‰æµè§ˆå™¨"ä¸è¦çŒœæµ‹ï¼Œä¸¥æ ¼æŒ‰ç…§Content-Typeå¤„ç†"
```

**Nginxé…ç½®**ï¼š
```nginx
server {
    add_header X-Content-Type-Options "nosniff" always;
}
```

**åº”ç”¨å±‚é…ç½®**ï¼š
```javascript
// Express.js
app.use((req, res, next) => {
    res.setHeader('X-Content-Type-Options', 'nosniff');
    next();
});
```

### 4.4 é…ç½®æ•ˆæœ


**é…ç½®å‰**ï¼š
```
ç”¨æˆ·ä¸Šä¼ ï¼šmalicious.jpgï¼ˆå†…å«JSä»£ç ï¼‰
æµè§ˆå™¨ï¼šæ£€æµ‹åˆ°JSç‰¹å¾ â†’ æ‰§è¡Œæ¶æ„ä»£ç  âŒ
```

**é…ç½®å**ï¼š
```
ç”¨æˆ·ä¸Šä¼ ï¼šmalicious.jpgï¼ˆå†…å«JSä»£ç ï¼‰
æœåŠ¡å™¨ï¼šContent-Type: image/jpeg + X-Content-Type-Options: nosniff
æµè§ˆå™¨ï¼šä¸¥æ ¼æŒ‰å›¾ç‰‡å¤„ç† â†’ æ¶æ„ä»£ç æ— æ³•æ‰§è¡Œ âœ…
```

---

## 5. ğŸ”’ Strict-Transport-Securityï¼šå¼ºåˆ¶HTTPS


### 5.1 ä»€ä¹ˆæ˜¯HSTS


**é€šä¿—ç†è§£**ï¼šHSTSå°±åƒç»™ä½ çš„ç½‘ç«™è´´ä¸Š"åªèµ°å®‰å…¨é€šé“"çš„æ ‡ç­¾

```
æ²¡æœ‰HSTSï¼š
ç”¨æˆ·è¾“å…¥ http://example.com â†’ å¯èƒ½è¢«åŠ«æŒ
ç”¨æˆ·ç‚¹å‡» http://é“¾æ¥ â†’ å¯èƒ½è¢«ä¸­é—´äººæ”»å‡»

æœ‰HSTSï¼š
æµè§ˆå™¨è®°ä½ï¼š"è¿™ä¸ªç½‘ç«™åªèƒ½ç”¨HTTPSè®¿é—®"
è‡ªåŠ¨è·³è½¬ï¼šhttp://example.com â†’ https://example.com
```

### 5.2 HSTSé…ç½®è¯¦è§£


**åŸºç¡€é…ç½®**ï¼š
```
Strict-Transport-Security: max-age=31536000

å«ä¹‰ï¼š
- max-age=31536000ï¼šè®°ä½365å¤©ï¼ˆ31536000ç§’ï¼‰
- 365å¤©å†…ï¼Œæµè§ˆå™¨åªç”¨HTTPSè®¿é—®è¿™ä¸ªç½‘ç«™
```

**å®Œæ•´é…ç½®**ï¼š
```
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload

å‚æ•°è¯´æ˜ï¼š
- max-ageï¼šç”Ÿæ•ˆæ—¶é—´ï¼ˆç§’ï¼‰
- includeSubDomainsï¼šåŒ…å«æ‰€æœ‰å­åŸŸå
- preloadï¼šå¯ä»¥æäº¤åˆ°æµè§ˆå™¨é¢„åŠ è½½åˆ—è¡¨
```

### 5.3 é…ç½®å‚æ•°è¯´æ˜


**â° max-ageè®¾ç½®å»ºè®®**ï¼š
```
æµ‹è¯•æœŸï¼šmax-age=300 ï¼ˆ5åˆ†é’Ÿï¼‰
çŸ­æœŸï¼šmax-age=86400 ï¼ˆ1å¤©ï¼‰
é•¿æœŸï¼šmax-age=31536000 ï¼ˆ1å¹´ï¼‰
æ°¸ä¹…ï¼šmax-age=63072000 ï¼ˆ2å¹´ï¼‰
```

**ğŸŒ includeSubDomainså½±å“**ï¼š
```
æ²¡æœ‰includeSubDomainsï¼š
- https://example.com âœ… å¼ºåˆ¶HTTPS
- https://api.example.com âŒ ä¸å¼ºåˆ¶

æœ‰includeSubDomainsï¼š
- https://example.com âœ… å¼ºåˆ¶HTTPS  
- https://api.example.com âœ… å¼ºåˆ¶HTTPS
- https://cdn.example.com âœ… å¼ºåˆ¶HTTPS
```

### 5.4 å®æˆ˜é…ç½®


**Nginxé…ç½®**ï¼š
```nginx
server {
    listen 443 ssl;
    
    # HSTSé…ç½®
    add_header Strict-Transport-Security 
               "max-age=31536000; includeSubDomains; preload" always;
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ **åªåœ¨HTTPSé¡µé¢æ·»åŠ **ï¼šHTTPé¡µé¢æ·»åŠ HSTSæ— æ•ˆ
- âš ï¸ **è°¨æ…è®¾ç½®max-age**ï¼šè®¾ç½®è¿‡é•¿å¯èƒ½å¯¼è‡´é—®é¢˜éš¾ä»¥å›æ»š
- âš ï¸ **å­åŸŸåè€ƒè™‘**ï¼šincludeSubDomainsä¼šå½±å“æ‰€æœ‰å­åŸŸå

---

## 6. ğŸ›¡ï¸ X-XSS-Protectionï¼šXSSè¿‡æ»¤å™¨æ§åˆ¶


### 6.1 ä»€ä¹ˆæ˜¯XSSè¿‡æ»¤å™¨


**é€šä¿—ç†è§£**ï¼šæµè§ˆå™¨å†…ç½®çš„"å±é™©è„šæœ¬æ£€æµ‹å™¨"

```
ç”¨æˆ·è¾“å…¥ï¼š<script>alert('xss')</script>
XSSè¿‡æ»¤å™¨æ£€æµ‹ï¼šå‘ç°å¯ç–‘è„šæœ¬ â†’ é˜»æ­¢æ‰§è¡Œ
```

### 6.2 X-XSS-Protectioné…ç½®


**é…ç½®é€‰é¡¹**ï¼š
```
X-XSS-Protection: 0        # å…³é—­XSSè¿‡æ»¤å™¨
X-XSS-Protection: 1        # å¯ç”¨XSSè¿‡æ»¤å™¨ï¼ˆé»˜è®¤ï¼‰
X-XSS-Protection: 1; mode=block  # å¯ç”¨å¹¶é˜»æ­¢æ•´ä¸ªé¡µé¢åŠ è½½
```

**æ¨èé…ç½®**ï¼š
```
X-XSS-Protection: 1; mode=block

æ•ˆæœï¼šå‘ç°XSSæ”»å‡»æ—¶ï¼Œå®Œå…¨é˜»æ­¢é¡µé¢åŠ è½½
```

### 6.3 å®é™…é…ç½®


**Nginxé…ç½®**ï¼š
```nginx
server {
    add_header X-XSS-Protection "1; mode=block" always;
}
```

**åº”ç”¨å±‚é…ç½®**ï¼š
```javascript
app.use((req, res, next) => {
    res.setHeader('X-XSS-Protection', '1; mode=block');
    next();
});
```

### 6.4 æ³¨æ„äº‹é¡¹


> **âš ï¸ é‡è¦æé†’**ï¼šç°ä»£æµè§ˆå™¨å·²ç»é€æ­¥åºŸå¼ƒX-XSS-Protectionï¼Œæ¨èä½¿ç”¨CSPç­–ç•¥

---

## 7. ğŸ” Referrer-Policyï¼šéšç§ä¿¡æ¯æ§åˆ¶


### 7.1 ä»€ä¹ˆæ˜¯Referrerä¿¡æ¯


**é€šä¿—ç†è§£**ï¼šReferrerå°±åƒ"æ¥è·¯ä¿¡æ¯"

```
ç”¨æˆ·åœ¨Aç½‘ç«™ç‚¹å‡»é“¾æ¥ â†’ è·³è½¬åˆ°Bç½‘ç«™
Bç½‘ç«™æ”¶åˆ°ï¼šè¿™ä¸ªç”¨æˆ·æ˜¯ä»Aç½‘ç«™æ¥çš„

Referrerä¿¡æ¯åŒ…å«ï¼š
- æ¥æºç½‘ç«™åœ°å€
- å¯èƒ½åŒ…å«æ•æ„Ÿå‚æ•°ï¼ˆtokenã€ç”¨æˆ·IDç­‰ï¼‰
```

### 7.2 Referreræ³„éœ²é£é™©


**éšç§æ³„éœ²åœºæ™¯**ï¼š
```
æ•æ„ŸURLï¼šhttps://bank.com/account?token=abc123&userid=12345
ç”¨æˆ·ç‚¹å‡»å¤–é“¾ â†’ ç¬¬ä¸‰æ–¹ç½‘ç«™çœ‹åˆ°å®Œæ•´URL
ç¬¬ä¸‰æ–¹ç½‘ç«™è·å¾—ï¼šç”¨æˆ·çš„tokenå’ŒIDä¿¡æ¯ âŒ
```

### 7.3 Referrer-Policyé…ç½®


**å¸¸ç”¨ç­–ç•¥**ï¼š

**ğŸš« no-referrerï¼šä¸å‘é€**
```
Referrer-Policy: no-referrer

æ•ˆæœï¼šå®Œå…¨ä¸å‘é€Referrerä¿¡æ¯
é€‚ç”¨ï¼šé«˜éšç§è¦æ±‚åœºæ™¯
```

**ğŸ  same-originï¼šåŒæºå‘é€**
```
Referrer-Policy: same-origin

æ•ˆæœï¼šåªåœ¨åŒä¸€ç½‘ç«™å†…å‘é€Referrer
é€‚ç”¨ï¼šå¤§å¤šæ•°ç½‘ç«™çš„æ¨èé…ç½®
```

**ğŸŒ strict-originï¼šå®‰å…¨ç­‰çº§å‘é€**
```
Referrer-Policy: strict-origin

æ•ˆæœï¼š
- HTTPS â†’ HTTPSï¼šå‘é€åŸŸåï¼ˆä¸å«è·¯å¾„ï¼‰
- HTTP â†’ HTTPSï¼šå‘é€åŸŸå
- HTTPS â†’ HTTPï¼šä¸å‘é€
```

### 7.4 å®æˆ˜é…ç½®


**æ¨èé…ç½®**ï¼š
```nginx
server {
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
}
```

**é…ç½®æ•ˆæœå¯¹æ¯”**ï¼š
```
åŸå§‹URLï¼šhttps://example.com/user/profile?id=123

no-referrer â†’ ç¬¬ä¸‰æ–¹ç½‘ç«™æ”¶åˆ°ï¼šï¼ˆç©ºï¼‰
same-origin â†’ åŒç«™é“¾æ¥æ”¶åˆ°ï¼šhttps://example.com/user/profile?id=123
strict-origin â†’ ç¬¬ä¸‰æ–¹ç½‘ç«™æ”¶åˆ°ï¼šhttps://example.com
```

---

## 8. ğŸ›ï¸ Permissions-Policyï¼šæµè§ˆå™¨ç‰¹æ€§æ§åˆ¶


### 8.1 ä»€ä¹ˆæ˜¯Permissions Policy


**é€šä¿—ç†è§£**ï¼šæ§åˆ¶ç½‘ç«™å¯ä»¥ä½¿ç”¨å“ªäº›æµè§ˆå™¨åŠŸèƒ½

```
æ²¡æœ‰Permissions Policyï¼š
ç½‘ç«™å¯ä»¥éšæ„ä½¿ç”¨æ‘„åƒå¤´ã€éº¦å…‹é£ã€å®šä½ç­‰åŠŸèƒ½

æœ‰Permissions Policyï¼š
ç½‘ç«™å¿…é¡»è·å¾—æ˜ç¡®æˆæƒæ‰èƒ½ä½¿ç”¨è¿™äº›åŠŸèƒ½
```

### 8.2 å¸¸ç”¨åŠŸèƒ½æ§åˆ¶


**ğŸ“¸ æ‘„åƒå¤´æ§åˆ¶**ï¼š
```
Permissions-Policy: camera=()         # å®Œå…¨ç¦ç”¨
Permissions-Policy: camera=(self)     # åªå…è®¸å½“å‰åŸŸå
Permissions-Policy: camera=(self "https://trusted.com")  # å…è®¸æŒ‡å®šåŸŸå
```

**ğŸ¤ éº¦å…‹é£æ§åˆ¶**ï¼š
```
Permissions-Policy: microphone=()     # ç¦ç”¨éº¦å…‹é£
Permissions-Policy: microphone=(self) # åªå…è®¸å½“å‰åŸŸå
```

**ğŸ“ åœ°ç†ä½ç½®æ§åˆ¶**ï¼š
```
Permissions-Policy: geolocation=()    # ç¦ç”¨å®šä½
Permissions-Policy: geolocation=(self) # åªå…è®¸å½“å‰åŸŸå
```

### 8.3 ç»¼åˆé…ç½®ç¤ºä¾‹


**ä¸¥æ ¼å®‰å…¨é…ç½®**ï¼š
```
Permissions-Policy: 
    camera=(), 
    microphone=(), 
    geolocation=(), 
    usb=(), 
    payment=()

æ•ˆæœï¼šç¦ç”¨æ‰€æœ‰æ•æ„ŸåŠŸèƒ½ï¼Œé˜²æ­¢æ¶æ„ä½¿ç”¨
```

**çµæ´»é…ç½®**ï¼š
```
Permissions-Policy: 
    camera=(self), 
    microphone=(self), 
    geolocation=(self "https://maps.googleapis.com")

æ•ˆæœï¼šå…è®¸è‡ªå·±ä½¿ç”¨ï¼Œåœ°ç†ä½ç½®åŠŸèƒ½å…è®¸è°·æ­Œåœ°å›¾
```

---

## 9. ğŸ› ï¸ å®æˆ˜é…ç½®éƒ¨ç½²


### 9.1 Nginxå®Œæ•´é…ç½®


```nginx
server {
    listen 443 ssl http2;
    server_name example.com;
    
    # SSLé…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/private.key;
    
    # å®‰å…¨å“åº”å¤´é…ç½®
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # CSPé…ç½®
    add_header Content-Security-Policy 
        "default-src 'self'; 
         script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; 
         style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
         img-src 'self' data: https:; 
         font-src 'self' https://fonts.gstatic.com;" always;
    
    # Permissions Policyé…ç½®
    add_header Permissions-Policy 
        "camera=(), microphone=(), geolocation=()" always;
    
    location / {
        root /var/www/html;
        index index.html;
    }
}
```

### 9.2 Express.jsé…ç½®


```javascript
const express = require('express');
const app = express();

// å®‰å…¨å“åº”å¤´ä¸­é—´ä»¶
app.use((req, res, next) => {
    // åŸºç¡€å®‰å…¨å¤´
    res.setHeader('X-Frame-Options', 'DENY');
    res.setHeader('X-Content-Type-Options', 'nosniff');
    res.setHeader('X-XSS-Protection', '1; mode=block');
    res.setHeader('Referrer-Policy', 'strict-origin-when-cross-origin');
    
    // åªåœ¨HTTPSç¯å¢ƒä¸‹è®¾ç½®HSTS
    if (req.secure) {
        res.setHeader('Strict-Transport-Security', 
            'max-age=31536000; includeSubDomains; preload');
    }
    
    // CSPç­–ç•¥
    res.setHeader('Content-Security-Policy', 
        "default-src 'self'; script-src 'self' 'unsafe-inline'");
    
    // Permissions Policy
    res.setHeader('Permissions-Policy', 
        'camera=(), microphone=(), geolocation=()');
    
    next();
});

app.get('/', (req, res) => {
    res.send('Hello Secure World!');
});

app.listen(3000, () => {
    console.log('å®‰å…¨æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£3000');
});
```

### 9.3 Spring Booté…ç½®


```java
@Configuration
public class SecurityHeadersConfig {
    
    @Bean
    public FilterRegistrationBean<SecurityHeadersFilter> securityHeadersFilter() {
        FilterRegistrationBean<SecurityHeadersFilter> registrationBean = 
            new FilterRegistrationBean<>();
        registrationBean.setFilter(new SecurityHeadersFilter());
        registrationBean.addUrlPatterns("/*");
        return registrationBean;
    }
}

@Component
public class SecurityHeadersFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, 
                        FilterChain chain) throws IOException, ServletException {
        
        HttpServletResponse httpResponse = (HttpServletResponse) response;
        
        // è®¾ç½®å®‰å…¨å“åº”å¤´
        httpResponse.setHeader("X-Frame-Options", "DENY");
        httpResponse.setHeader("X-Content-Type-Options", "nosniff");
        httpResponse.setHeader("X-XSS-Protection", "1; mode=block");
        httpResponse.setHeader("Referrer-Policy", "strict-origin-when-cross-origin");
        
        // CSPç­–ç•¥
        httpResponse.setHeader("Content-Security-Policy", 
            "default-src 'self'; script-src 'self'");
        
        // HSTSï¼ˆä»…HTTPSï¼‰
        if (((HttpServletRequest) request).isSecure()) {
            httpResponse.setHeader("Strict-Transport-Security", 
                "max-age=31536000; includeSubDomains");
        }
        
        chain.doFilter(request, response);
    }
}
```

### 9.4 é…ç½®éªŒè¯æ–¹æ³•


**ğŸ“Š åœ¨çº¿æ£€æµ‹å·¥å…·**ï¼š
- **Security Headers**ï¼šhttps://securityheaders.com
- **Mozilla Observatory**ï¼šhttps://observatory.mozilla.org

**ğŸ” æµè§ˆå™¨æ£€æŸ¥**ï¼š
```
1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. ç‚¹å‡»ä¸»é¡µé¢è¯·æ±‚
5. æŸ¥çœ‹Response Headerséƒ¨åˆ†
6. ç¡®è®¤å®‰å…¨å“åº”å¤´æ˜¯å¦æ­£ç¡®è®¾ç½®
```

**âœ… å®Œæ•´æ€§æ£€æŸ¥æ¸…å•**ï¼š
- [ ] X-Frame-Options å·²é…ç½®
- [ ] Content-Security-Policy å·²è®¾ç½®
- [ ] X-Content-Type-Options: nosniff å·²å¯ç”¨
- [ ] Strict-Transport-Security å·²é…ç½®ï¼ˆHTTPSï¼‰
- [ ] Referrer-Policy å·²è®¾ç½®
- [ ] æ‰€æœ‰headeråœ¨æ‰€æœ‰é¡µé¢éƒ½ç”Ÿæ•ˆ

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„å®‰å…¨å“åº”å¤´


```
ğŸ”¸ X-Frame-Optionsï¼šé˜²æ­¢ç‚¹å‡»åŠ«æŒï¼Œæ¨èè®¾ç½®DENYæˆ–SAMEORIGIN
ğŸ”¸ Content-Security-Policyï¼šæ§åˆ¶èµ„æºåŠ è½½ï¼Œé˜²XSSçš„æ ¸å¿ƒæ­¦å™¨
ğŸ”¸ X-Content-Type-Optionsï¼šè®¾ç½®nosniffï¼Œé˜²æ­¢MIMEç±»å‹å—…æ¢æ”»å‡»
ğŸ”¸ Strict-Transport-Securityï¼šå¼ºåˆ¶HTTPSï¼Œé˜²ä¸­é—´äººæ”»å‡»
ğŸ”¸ Referrer-Policyï¼šæ§åˆ¶æ¥æºä¿¡æ¯æ³„éœ²ï¼Œä¿æŠ¤ç”¨æˆ·éšç§
ğŸ”¸ Permissions-Policyï¼šæ§åˆ¶æµè§ˆå™¨åŠŸèƒ½ä½¿ç”¨æƒé™
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å®‰å…¨å“åº”å¤´çš„æœ¬è´¨**ï¼š
```
ä½œç”¨æœºåˆ¶ï¼šæœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨å®‰å…¨è§„åˆ™ â†’ æµè§ˆå™¨æ‰§è¡Œä¿æŠ¤æªæ–½
æ ¸å¿ƒæ€æƒ³ï¼šçºµæ·±é˜²å¾¡ï¼Œå¤šå±‚ä¿æŠ¤
å®æ–½åŸåˆ™ï¼šé»˜è®¤æ‹’ç»ï¼Œæ˜ç¡®å…è®¸
```

**ğŸ”¹ é…ç½®ç­–ç•¥é€‰æ‹©**ï¼š
```
é«˜å®‰å…¨æ€§ç½‘ç«™ï¼ˆé“¶è¡Œã€æ”¯ä»˜ï¼‰ï¼š
- ä¸¥æ ¼çš„CSPç­–ç•¥
- X-Frame-Options: DENY
- ç¦ç”¨å¤§éƒ¨åˆ†æµè§ˆå™¨åŠŸèƒ½

ä¸€èˆ¬ä¸šåŠ¡ç½‘ç«™ï¼š
- å¹³è¡¡çš„CSPç­–ç•¥
- X-Frame-Options: SAMEORIGIN
- ä¿ç•™å¿…è¦çš„æµè§ˆå™¨åŠŸèƒ½

å¼€å‘æµ‹è¯•ç¯å¢ƒï¼š
- å®½æ¾çš„ç­–ç•¥ä¾¿äºè°ƒè¯•
- è¾ƒçŸ­çš„HSTSæ—¶é—´
- è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š
```

**ğŸ”¹ éƒ¨ç½²æ³¨æ„äº‹é¡¹**ï¼š
```
æ¸è¿›å¼éƒ¨ç½²ï¼š
1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
2. ä½¿ç”¨Report-Onlyæ¨¡å¼è§‚å¯Ÿ
3. é€æ­¥æ”¶ç´§å®‰å…¨ç­–ç•¥
4. ç›‘æ§é”™è¯¯å’Œç”¨æˆ·åé¦ˆ

å…¼å®¹æ€§è€ƒè™‘ï¼š
- æ—§ç‰ˆæµè§ˆå™¨æ”¯æŒç¨‹åº¦
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆéœ€æ±‚
- ç°æœ‰åŠŸèƒ½çš„å½±å“è¯„ä¼°
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… æ¨èçš„åŸºç¡€é…ç½®**ï¼š
```nginx
# é€‚åˆå¤§å¤šæ•°ç½‘ç«™çš„å®‰å…¨é…ç½®
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'" always;
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³**ï¼š
- **CSPé˜»æ­¢å†…è”è„šæœ¬**ï¼šä½¿ç”¨nonceæˆ–å¤–éƒ¨æ–‡ä»¶
- **iframeåµŒå¥—å¤±è´¥**ï¼šæ£€æŸ¥X-Frame-Optionsè®¾ç½®
- **ç¬¬ä¸‰æ–¹èµ„æºåŠ è½½å¤±è´¥**ï¼šè°ƒæ•´CSPçš„img-srcã€script-srcç­‰
- **HSTSå¯¼è‡´æ— æ³•å›é€€HTTP**ï¼šè®¾ç½®è¾ƒçŸ­çš„max-ageè¿›è¡Œæµ‹è¯•

**ğŸ“ˆ å®‰å…¨ç­‰çº§å»ºè®®**ï¼š
```
åŸºç¡€çº§ï¼ˆå¿…é¡»ï¼‰ï¼š
âœ“ X-Content-Type-Options: nosniff
âœ“ X-Frame-Options: SAMEORIGIN
âœ“ Referrer-Policy: strict-origin-when-cross-origin

è¿›é˜¶çº§ï¼ˆæ¨èï¼‰ï¼š
âœ“ åŸºç¡€çº§ + Content-Security-Policy
âœ“ Strict-Transport-Securityï¼ˆHTTPSç½‘ç«™ï¼‰

é«˜çº§çº§ï¼ˆä¸¥æ ¼ï¼‰ï¼š
âœ“ è¿›é˜¶çº§ + Permissions-Policy
âœ“ ä¸¥æ ¼çš„CSPç­–ç•¥
âœ“ å®Œæ•´çš„å®‰å…¨ç›‘æ§
```

### 10.4 ç›‘æ§ä¸ç»´æŠ¤


**ğŸ” å®šæœŸæ£€æŸ¥é¡¹ç›®**ï¼š
- å®‰å…¨å“åº”å¤´é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
- CSPè¿è§„æŠ¥å‘Šåˆ†æ
- æ–°åŠŸèƒ½å¯¹å®‰å…¨ç­–ç•¥çš„å½±å“
- æµè§ˆå™¨å…¼å®¹æ€§æ›´æ–°

**ğŸ“Š æ•ˆæœè¯„ä¼°æŒ‡æ ‡**ï¼š
- å®‰å…¨æ‰«æå·¥å…·è¯„åˆ†æå‡
- XSSç­‰æ”»å‡»æ£€æµ‹æ•°é‡ä¸‹é™
- ç”¨æˆ·éšç§ä¿æŠ¤å¢å¼º
- åˆè§„æ€§è¦æ±‚æ»¡è¶³ç¨‹åº¦

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- HTTPå®‰å…¨å“åº”å¤´æ˜¯æµè§ˆå™¨ç«¯å®‰å…¨é˜²æŠ¤çš„é‡è¦æ‰‹æ®µ
- æ¯ä¸ªå“åº”å¤´éƒ½æœ‰ç‰¹å®šçš„é˜²æŠ¤ç›®æ ‡å’Œé…ç½®æ–¹æ³•
- å®‰å…¨ç­–ç•¥éœ€è¦åœ¨é˜²æŠ¤æ•ˆæœå’ŒåŠŸèƒ½ä¾¿åˆ©æ€§é—´å¹³è¡¡
- éƒ¨ç½²å‰å……åˆ†æµ‹è¯•ï¼Œéƒ¨ç½²åæŒç»­ç›‘æ§ä¼˜åŒ–