---
title: 2ã€CORSè·¨åŸŸèµ„æºå…±äº«æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [CORSåŸºç¡€æ¦‚å¿µç†è§£](#1-CORSåŸºç¡€æ¦‚å¿µç†è§£)
2. [åŒæºç­–ç•¥ä¸è·¨åŸŸé—®é¢˜](#2-åŒæºç­–ç•¥ä¸è·¨åŸŸé—®é¢˜)
3. [CORSå·¥ä½œåŸç†æ·±åº¦è§£æ](#3-CORSå·¥ä½œåŸç†æ·±åº¦è§£æ)
4. [CORSå“åº”å¤´å®Œæ•´é…ç½®](#4-CORSå“åº”å¤´å®Œæ•´é…ç½®)
5. [é¢„æ£€è¯·æ±‚å®‰å…¨æœºåˆ¶](#5-é¢„æ£€è¯·æ±‚å®‰å…¨æœºåˆ¶)
6. [å‡­è¯è¯·æ±‚å¤„ç†ç­–ç•¥](#6-å‡­è¯è¯·æ±‚å¤„ç†ç­–ç•¥)
7. [CORSå®‰å…¨é…ç½®æœ€ä½³å®è·µ](#7-CORSå®‰å…¨é…ç½®æœ€ä½³å®è·µ)
8. [CORSæ”»å‡»æ‰‹æ³•ä¸é˜²æŠ¤](#8-CORSæ”»å‡»æ‰‹æ³•ä¸é˜²æŠ¤)
9. [å®æˆ˜é…ç½®ç¤ºä¾‹](#9-å®æˆ˜é…ç½®ç¤ºä¾‹)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ CORSåŸºç¡€æ¦‚å¿µç†è§£


### 1.1 ä»€ä¹ˆæ˜¯CORS


**ğŸ”¸ CORSå…¨ç§°**: Cross-Origin Resource Sharingï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰

**ğŸ”¸ é€šä¿—ç†è§£**: 
CORSå°±åƒæ˜¯**ç½‘ç«™ä¹‹é—´çš„é€šè¡Œè¯ç³»ç»Ÿ**ã€‚æƒ³è±¡ä¸€ä¸‹ï¼š
- ä½ åœ¨Aç½‘ç«™(`https://myapp.com`)
- æƒ³è¦è·å–Bç½‘ç«™(`https://api.example.com`)çš„æ•°æ®
- æµè§ˆå™¨é»˜è®¤**ä¸å…è®¸**è¿™ç§è·¨ç½‘ç«™çš„æ•°æ®è¯·æ±‚ï¼ˆå‡ºäºå®‰å…¨è€ƒè™‘ï¼‰
- CORSå°±æ˜¯è®©Bç½‘ç«™**ä¸»åŠ¨æˆæƒ**ï¼š"æˆ‘å…è®¸Aç½‘ç«™æ¥è®¿é—®æˆ‘çš„æ•°æ®"

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦CORS


**ğŸ¤” ç°å®åœºæ™¯ä¸¾ä¾‹**:
```
ç”¨æˆ·åœºæ™¯ï¼š
1. ä½ åœ¨è´­ç‰©ç½‘ç«™ www.shop.com æµè§ˆå•†å“
2. ç½‘ç«™éœ€è¦è°ƒç”¨æ”¯ä»˜API pay.alipay.com å®Œæˆæ”¯ä»˜
3. è¿˜è¦è°ƒç”¨ç‰©æµAPI logistics.sf.com æŸ¥è¯¢é…é€ä¿¡æ¯

é—®é¢˜ï¼šè¿™äº›éƒ½æ˜¯ä¸åŒçš„åŸŸåï¼Œæµè§ˆå™¨é»˜è®¤ç¦æ­¢è·¨åŸŸè®¿é—®ï¼
è§£å†³ï¼šå„ä¸ªAPIæœåŠ¡é€šè¿‡CORSæˆæƒï¼Œå…è®¸shop.comè®¿é—®
```

**ğŸ¯ æ ¸å¿ƒä½œç”¨**:
- **çªç ´è·¨åŸŸé™åˆ¶**: å…è®¸åˆæ³•çš„è·¨åŸŸæ•°æ®è®¿é—®
- **ä¿éšœå®‰å…¨**: æœåŠ¡ç«¯ä¸»åŠ¨æ§åˆ¶å“ªäº›ç½‘ç«™å¯ä»¥è®¿é—®
- **çµæ´»é…ç½®**: å¯ä»¥ç²¾ç¡®æ§åˆ¶è®¿é—®æƒé™å’ŒèŒƒå›´

---

## 2. ğŸš« åŒæºç­–ç•¥ä¸è·¨åŸŸé—®é¢˜


### 2.1 åŒæºç­–ç•¥æ˜¯ä»€ä¹ˆ


**ğŸ”¸ åŒæºå®šä¹‰**: ä¸‰ä¸ªè¦ç´ å®Œå…¨ç›¸åŒæ‰ç®—"åŒæº"
```
åè®® + åŸŸå + ç«¯å£ = åŒæº

âœ… åŒæºç¤ºä¾‹ï¼š
https://www.example.com:443/page1
https://www.example.com:443/page2
â†’ åè®®(https)ã€åŸŸå(www.example.com)ã€ç«¯å£(443)éƒ½ç›¸åŒ

âŒ è·¨åŸŸç¤ºä¾‹ï¼š
https://www.example.com â†’ http://www.example.com (åè®®ä¸åŒ)
https://www.example.com â†’ https://api.example.com (åŸŸåä¸åŒ)  
https://www.example.com:443 â†’ https://www.example.com:8080 (ç«¯å£ä¸åŒ)
```

### 2.2 åŒæºç­–ç•¥çš„é™åˆ¶


**ğŸ”’ æµè§ˆå™¨é™åˆ¶å†…å®¹**:
```
è¢«é™åˆ¶çš„æ“ä½œï¼š
1. ğŸ“¡ Ajaxè¯·æ±‚æ— æ³•å‘é€åˆ°å…¶ä»–åŸŸ
2. ğŸª æ— æ³•è¯»å–å…¶ä»–åŸŸçš„Cookie
3. ğŸ“¦ æ— æ³•è®¿é—®å…¶ä»–åŸŸçš„localStorage
4. ğŸªŸ æ— æ³•æ“ä½œå…¶ä»–åŸŸé¡µé¢çš„DOM
```

**ğŸŒ° ç”Ÿæ´»ç±»æ¯”**: 
åŒæºç­–ç•¥å°±åƒ**å°åŒºé—¨ç¦ç³»ç»Ÿ**ï¼Œåªæœ‰æœ¬å°åŒºçš„ä½æˆ·æ‰èƒ½è‡ªç”±è¿›å‡ºï¼Œå¤–æ¥äººå‘˜éœ€è¦ç‰¹æ®Šæˆæƒã€‚

### 2.3 è·¨åŸŸé—®é¢˜çš„è¡¨ç°


**âš ï¸ å¸¸è§é”™è¯¯ä¿¡æ¯**:
```javascript
// æµè§ˆå™¨æ§åˆ¶å°å¸¸è§é”™è¯¯
Access to XMLHttpRequest at 'https://api.example.com/data' 
from origin 'https://myapp.com' has been blocked by CORS policy: 
No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

**ğŸ” é—®é¢˜åˆ†æ**: 
- æµè§ˆå™¨å‘ç°è¿™æ˜¯è·¨åŸŸè¯·æ±‚
- æ£€æŸ¥å“åº”ä¸­æ˜¯å¦æœ‰CORSæˆæƒå¤´
- æ²¡æœ‰æ‰¾åˆ°æˆæƒï¼Œç›´æ¥é˜»æ­¢å¹¶æŠ¥é”™

---

## 3. âš™ï¸ CORSå·¥ä½œåŸç†æ·±åº¦è§£æ


### 3.1 CORSè¯·æ±‚åˆ†ç±»


CORSæŠŠè·¨åŸŸè¯·æ±‚åˆ†æˆä¸¤å¤§ç±»ï¼Œå°±åƒ**å¿«é€’åˆ†æ‹£**ä¸€æ ·ï¼š

**ğŸŸ¢ ç®€å•è¯·æ±‚** (å¯ä»¥ç›´æ¥é€šè¿‡)
```
ç®€å•è¯·æ±‚æ¡ä»¶ï¼ˆå¿…é¡»åŒæ—¶æ»¡è¶³ï¼‰ï¼š
âœ… è¯·æ±‚æ–¹æ³•ï¼šGETã€POSTã€HEAD
âœ… è¯·æ±‚å¤´åªèƒ½æ˜¯åŸºæœ¬å¤´ï¼š
   - Accept
   - Accept-Language  
   - Content-Language
   - Content-Type (ä»…é™text/plainã€multipart/form-dataã€application/x-www-form-urlencoded)

ğŸŒ° ç®€å•è¯·æ±‚ç¤ºä¾‹ï¼š
GET https://api.example.com/users
Accept: application/json
```

**ğŸŸ¡ å¤æ‚è¯·æ±‚** (éœ€è¦å…ˆ"æ•²é—¨"è¯¢é—®)
```
å¤æ‚è¯·æ±‚æƒ…å†µï¼ˆæ»¡è¶³ä»»ä¸€æ¡ä»¶ï¼‰ï¼š
âŒ è¯·æ±‚æ–¹æ³•ï¼šPUTã€DELETEã€PATCHç­‰
âŒ è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼šAuthorizationã€X-Custom-Headerç­‰
âŒ Content-Typeï¼šapplication/jsonç­‰

ğŸŒ° å¤æ‚è¯·æ±‚ç¤ºä¾‹ï¼š
POST https://api.example.com/users
Content-Type: application/json
Authorization: Bearer token123
```

### 3.2 ç®€å•è¯·æ±‚æµç¨‹


```
æµè§ˆå™¨                              æœåŠ¡å™¨
  â”‚                                  â”‚
  â”‚â”€â”€[1] å‘é€å®é™…è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚    GET /api/data                 â”‚
  â”‚    Origin: https://myapp.com     â”‚
  â”‚                                  â”‚
  â”‚â—€â”€[2] è¿”å›å“åº”+CORSå¤´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    Access-Control-Allow-Origin: * â”‚
  â”‚    å®é™…æ•°æ®                       â”‚
  â”‚                                  â”‚
```

**ğŸ’¡ ç®€å•è¯·æ±‚ç‰¹ç‚¹**:
- **ä¸€æ­¥åˆ°ä½**: ç›´æ¥å‘é€çœŸå®è¯·æ±‚
- **åéªŒè¯**: å‘é€åå†æ£€æŸ¥CORSå¤´
- **æ•ˆç‡é«˜**: å‡å°‘ç½‘ç»œå¾€è¿”

### 3.3 å¤æ‚è¯·æ±‚æµç¨‹ï¼ˆé¢„æ£€æœºåˆ¶ï¼‰


```
æµè§ˆå™¨                              æœåŠ¡å™¨
  â”‚                                  â”‚
  â”‚â”€â”€[1] å‘é€é¢„æ£€è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚    OPTIONS /api/data             â”‚
  â”‚    Origin: https://myapp.com     â”‚
  â”‚    Access-Control-Request-Method: POST â”‚
  â”‚    Access-Control-Request-Headers: Authorization â”‚
  â”‚                                  â”‚
  â”‚â—€â”€[2] è¿”å›é¢„æ£€å“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    Access-Control-Allow-Origin: https://myapp.com â”‚
  â”‚    Access-Control-Allow-Methods: POST â”‚
  â”‚    Access-Control-Allow-Headers: Authorization â”‚
  â”‚    Access-Control-Max-Age: 3600  â”‚
  â”‚                                  â”‚
  â”‚â”€â”€[3] å‘é€å®é™…è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚    POST /api/data                â”‚
  â”‚    Authorization: Bearer token   â”‚
  â”‚                                  â”‚
  â”‚â—€â”€[4] è¿”å›å®é™…å“åº”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    å®é™…æ•°æ®                       â”‚
```

**ğŸ” é¢„æ£€è¯·æ±‚æ·±åº¦ç†è§£**:

**OPTIONSæ–¹æ³•è¯¦è§£**:
```
OPTIONSè¯·æ±‚å°±åƒ"æ•²é—¨é—®è·¯"ï¼š
- æµè§ˆå™¨ï¼š"æˆ‘æƒ³ç”¨POSTæ–¹æ³•ï¼Œå¸¦Authorizationå¤´ï¼Œå¯ä»¥å—ï¼Ÿ"
- æœåŠ¡å™¨ï¼š"å¯ä»¥çš„ï¼Œæˆ‘å…è®¸POSTæ–¹æ³•å’ŒAuthorizationå¤´"
- æµè§ˆå™¨ï¼š"å¥½çš„ï¼Œé‚£æˆ‘å‘é€çœŸæ­£çš„è¯·æ±‚äº†"
```

**é¢„æ£€è¯·æ±‚å¤´å«ä¹‰**:
```javascript
// æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„é¢„æ£€è¯·æ±‚å¤´
Origin: https://myapp.com                    // è¯·æ±‚æ¥æº
Access-Control-Request-Method: POST          // å®é™…è¯·æ±‚è¦ç”¨çš„æ–¹æ³•
Access-Control-Request-Headers: Authorization // å®é™…è¯·æ±‚è¦å¸¦çš„è‡ªå®šä¹‰å¤´
```

---

## 4. ğŸ“‹ CORSå“åº”å¤´å®Œæ•´é…ç½®


### 4.1 æ ¸å¿ƒå“åº”å¤´è¯¦è§£


**ğŸ”¸ Access-Control-Allow-Origin**
```javascript
// æœ€é‡è¦çš„CORSå¤´ï¼Œå†³å®šè°å¯ä»¥è®¿é—®

// âœ… å…è®¸æ‰€æœ‰åŸŸï¼ˆæ…ç”¨ï¼ï¼‰
Access-Control-Allow-Origin: *

// âœ… å…è®¸ç‰¹å®šåŸŸ
Access-Control-Allow-Origin: https://myapp.com

// âœ… åŠ¨æ€å…è®¸ï¼ˆæ¨èï¼‰
Access-Control-Allow-Origin: https://trusted-site.com

// âŒ é”™è¯¯ç¤ºä¾‹ - ä¸èƒ½è®¾ç½®å¤šä¸ªå€¼
Access-Control-Allow-Origin: https://site1.com, https://site2.com
```

> ğŸ’¡ **é‡è¦æé†’**  
> `*` é€šé…ç¬¦è™½ç„¶æ–¹ä¾¿ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å­˜åœ¨å®‰å…¨é£é™©ï¼Œåº”è¯¥æ˜ç¡®æŒ‡å®šå…è®¸çš„åŸŸå

**ğŸ”¸ Access-Control-Allow-Methods**
```javascript
// æŒ‡å®šå…è®¸çš„HTTPæ–¹æ³•

// å¸¸ç”¨é…ç½®
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS

// é™åˆ¶æ€§é…ç½®ï¼ˆæ›´å®‰å…¨ï¼‰
Access-Control-Allow-Methods: GET, POST

// æ”¯æŒæ‰€æœ‰æ–¹æ³•ï¼ˆä¸æ¨èï¼‰
Access-Control-Allow-Methods: *
```

**ğŸ”¸ Access-Control-Allow-Headers**
```javascript
// æŒ‡å®šå…è®¸çš„è¯·æ±‚å¤´

// å¸¸è§ä¸šåŠ¡å¤´
Access-Control-Allow-Headers: Content-Type, Authorization, X-Requested-With

// è‡ªå®šä¹‰å¤´æ”¯æŒ
Access-Control-Allow-Headers: X-Custom-Token, X-API-Key

// æ”¯æŒæ‰€æœ‰å¤´ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
Access-Control-Allow-Headers: *
```

### 4.2 é«˜çº§å“åº”å¤´é…ç½®


**ğŸ”¸ Access-Control-Allow-Credentials**
```javascript
// æ§åˆ¶æ˜¯å¦å…è®¸å‘é€Cookieå’Œè®¤è¯ä¿¡æ¯

// å…è®¸æºå¸¦å‡­è¯
Access-Control-Allow-Credentials: true

// ä¸å…è®¸æºå¸¦å‡­è¯ï¼ˆé»˜è®¤ï¼‰
Access-Control-Allow-Credentials: false
```

> âš ï¸ **å®‰å…¨è­¦å‘Š**  
> å½“è®¾ç½® `Allow-Credentials: true` æ—¶ï¼Œ**ä¸èƒ½**åŒæ—¶è®¾ç½® `Allow-Origin: *`ï¼Œå¿…é¡»æŒ‡å®šå…·ä½“åŸŸå

**ğŸ”¸ Access-Control-Expose-Headers**
```javascript
// å…è®¸å‰ç«¯è®¿é—®çš„å“åº”å¤´ï¼ˆé»˜è®¤åªèƒ½è®¿é—®åŸºæœ¬å¤´ï¼‰

// æš´éœ²è‡ªå®šä¹‰å¤´
Access-Control-Expose-Headers: X-Total-Count, X-Rate-Limit

// å‰ç«¯å¯ä»¥é€šè¿‡response.headersè·å–è¿™äº›å¤´
```

**ğŸ”¸ Access-Control-Max-Age**
```javascript
// é¢„æ£€è¯·æ±‚ç»“æœç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰

Access-Control-Max-Age: 3600  // ç¼“å­˜1å°æ—¶
Access-Control-Max-Age: 86400 // ç¼“å­˜1å¤©

// å¥½å¤„ï¼šå‡å°‘é‡å¤çš„OPTIONSè¯·æ±‚ï¼Œæå‡æ€§èƒ½
```

### 4.3 é…ç½®ç¤ºä¾‹å¯¹æ¯”


**ğŸ”¹ å®½æ¾é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰**
```javascript
// å¼€å‘é˜¶æ®µçš„å®½æ¾é…ç½®
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', '*');
  res.header('Access-Control-Allow-Headers', '*');
  next();
});
```

**ğŸ”¹ ä¸¥æ ¼é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰**
```javascript
// ç”Ÿäº§ç¯å¢ƒçš„ä¸¥æ ¼é…ç½®
app.use((req, res, next) => {
  const allowedOrigins = ['https://myapp.com', 'https://admin.myapp.com'];
  const origin = req.headers.origin;
  
  if (allowedOrigins.includes(origin)) {
    res.header('Access-Control-Allow-Origin', origin);
  }
  
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  res.header('Access-Control-Allow-Credentials', 'true');
  res.header('Access-Control-Max-Age', '3600');
  
  next();
});
```

---

## 5. ğŸ” é¢„æ£€è¯·æ±‚å®‰å…¨æœºåˆ¶


### 5.1 é¢„æ£€è¯·æ±‚è§¦å‘æ¡ä»¶


**ğŸ”¸ ä»€ä¹ˆæ—¶å€™ä¼šå‘é€é¢„æ£€è¯·æ±‚**:
```javascript
// æƒ…å†µ1ï¼šä½¿ç”¨éç®€å•æ–¹æ³•
fetch('https://api.example.com/data', {
  method: 'PUT',  // è§¦å‘é¢„æ£€
  body: JSON.stringify({name: 'test'})
});

// æƒ…å†µ2ï¼šå‘é€JSONæ•°æ®
fetch('https://api.example.com/data', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'  // è§¦å‘é¢„æ£€
  },
  body: JSON.stringify({name: 'test'})
});

// æƒ…å†µ3ï¼šè‡ªå®šä¹‰è¯·æ±‚å¤´
fetch('https://api.example.com/data', {
  headers: {
    'X-Custom-Header': 'value'  // è§¦å‘é¢„æ£€
  }
});
```

### 5.2 é¢„æ£€è¯·æ±‚å®‰å…¨è€ƒé‡


**ğŸ”’ å®‰å…¨éªŒè¯æœºåˆ¶**:

**Originå¤´éªŒè¯**:
```javascript
// æœåŠ¡ç«¯éªŒè¯è¯·æ±‚æ¥æº
app.options('/api/*', (req, res) => {
  const origin = req.headers.origin;
  const allowedOrigins = ['https://myapp.com', 'https://admin.myapp.com'];
  
  if (!allowedOrigins.includes(origin)) {
    return res.status(403).json({error: 'Origin not allowed'});
  }
  
  // éªŒè¯é€šè¿‡ï¼Œè¿”å›CORSå¤´
  res.header('Access-Control-Allow-Origin', origin);
  res.header('Access-Control-Allow-Methods', 'POST, PUT, DELETE');
  res.status(200).end();
});
```

**è¯·æ±‚æ–¹æ³•æ£€æŸ¥**:
```javascript
// æ£€æŸ¥è¯·æ±‚çš„æ–¹æ³•æ˜¯å¦è¢«å…è®¸
app.options('/api/*', (req, res) => {
  const requestedMethod = req.headers['access-control-request-method'];
  const allowedMethods = ['GET', 'POST', 'PUT'];
  
  if (!allowedMethods.includes(requestedMethod)) {
    return res.status(405).json({error: 'Method not allowed'});
  }
  
  res.header('Access-Control-Allow-Methods', allowedMethods.join(', '));
  res.status(200).end();
});
```

**è‡ªå®šä¹‰å¤´éƒ¨éªŒè¯**:
```javascript
// éªŒè¯è‡ªå®šä¹‰å¤´æ˜¯å¦è¢«å…è®¸
app.options('/api/*', (req, res) => {
  const requestedHeaders = req.headers['access-control-request-headers'];
  const allowedHeaders = ['content-type', 'authorization', 'x-api-key'];
  
  if (requestedHeaders) {
    const headers = requestedHeaders.split(',').map(h => h.trim().toLowerCase());
    const forbidden = headers.filter(h => !allowedHeaders.includes(h));
    
    if (forbidden.length > 0) {
      return res.status(400).json({error: `Headers not allowed: ${forbidden.join(', ')}`});
    }
  }
  
  res.header('Access-Control-Allow-Headers', allowedHeaders.join(', '));
  res.status(200).end();
});
```

### 5.3 Max-Ageç¼“å­˜ä¼˜åŒ–


**ğŸš€ ç¼“å­˜ç­–ç•¥**:
```javascript
// åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´
res.header('Access-Control-Max-Age', '3600'); // 1å°æ—¶

// ç¼“å­˜çš„å¥½å¤„ï¼š
// 1. å‡å°‘é‡å¤çš„OPTIONSè¯·æ±‚
// 2. æå‡é¡µé¢åŠ è½½é€Ÿåº¦
// 3. å‡å°‘æœåŠ¡å™¨è´Ÿè½½
```

**ğŸ“Š ç¼“å­˜æ—¶é—´å»ºè®®**:
| åœºæ™¯ | **ç¼“å­˜æ—¶é—´** | **åŸå› ** |
|-----|------------|---------|
| ğŸ”§ **å¼€å‘ç¯å¢ƒ** | `0æˆ–å¾ˆçŸ­` | `é…ç½®ç»å¸¸å˜åŒ–` |
| ğŸ§ª **æµ‹è¯•ç¯å¢ƒ** | `300ç§’(5åˆ†é’Ÿ)` | `é…ç½®ç›¸å¯¹ç¨³å®š` |
| ğŸš€ **ç”Ÿäº§ç¯å¢ƒ** | `3600ç§’(1å°æ—¶)` | `é…ç½®å¾ˆå°‘å˜åŒ–` |

---

## 6. ğŸ” å‡­è¯è¯·æ±‚å¤„ç†ç­–ç•¥


### 6.1 ä»€ä¹ˆæ˜¯å‡­è¯è¯·æ±‚


**ğŸ”¸ å‡­è¯åŒ…å«çš„å†…å®¹**:
```
æµè§ˆå™¨è‡ªåŠ¨æºå¸¦çš„ä¿¡æ¯ï¼š
ğŸª Cookieï¼šç”¨æˆ·ç™»å½•çŠ¶æ€ã€åå¥½è®¾ç½®
ğŸ”‘ HTTPè®¤è¯ï¼šBasic Authã€Digest Auth
ğŸ“‹ å®¢æˆ·ç«¯è¯ä¹¦ï¼šTLSå®¢æˆ·ç«¯è¯ä¹¦
```

**ğŸŒ° å®é™…åœºæ™¯**:
```javascript
// ç”¨æˆ·åœ¨ https://myapp.com å·²ç™»å½•ï¼ŒCookieä¸­æœ‰sessionId
// ç°åœ¨è¦è°ƒç”¨ https://api.example.com çš„ç”¨æˆ·ä¿¡æ¯æ¥å£
// å¸Œæœ›APIèƒ½è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œå°±éœ€è¦æºå¸¦Cookie

fetch('https://api.example.com/user/profile', {
  credentials: 'include'  // å…³é”®ï¼šå‘Šè¯‰æµè§ˆå™¨æºå¸¦Cookie
});
```

### 6.2 withCredentialsè®¾ç½®è¯¦è§£


**ğŸ”¸ å‰ç«¯é…ç½®**:
```javascript
// æ–¹å¼1ï¼šfetch API
fetch('https://api.example.com/data', {
  credentials: 'include'  // æºå¸¦Cookie
});

// æ–¹å¼2ï¼šXMLHttpRequest
const xhr = new XMLHttpRequest();
xhr.withCredentials = true;  // æºå¸¦Cookie
xhr.open('GET', 'https://api.example.com/data');

// æ–¹å¼3ï¼šaxios
axios.defaults.withCredentials = true;
// æˆ–è€…å•ä¸ªè¯·æ±‚
axios.get('https://api.example.com/data', {
  withCredentials: true
});
```

**ğŸ”¸ credentialsé€‰é¡¹è¯´æ˜**:
```javascript
// ä¸‰ç§æ¨¡å¼
credentials: 'omit'      // æ°¸ä¸æºå¸¦å‡­è¯
credentials: 'same-origin'  // ä»…åŒæºæ—¶æºå¸¦ï¼ˆé»˜è®¤ï¼‰
credentials: 'include'   // æ€»æ˜¯æºå¸¦å‡­è¯
```

### 6.3 æœåŠ¡ç«¯Credentialsé…ç½®


**ğŸ”¸ æœåŠ¡ç«¯å¿…é¡»æ˜ç¡®å…è®¸**:
```javascript
// âœ… æ­£ç¡®é…ç½®ï¼šå…è®¸å‡­è¯è¯·æ±‚
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', 'https://myapp.com'); // å¿…é¡»æŒ‡å®šå…·ä½“åŸŸå
  res.header('Access-Control-Allow-Credentials', 'true');         // å…è®¸å‡­è¯
  next();
});

// âŒ é”™è¯¯é…ç½®ï¼šé€šé…ç¬¦å’Œå‡­è¯ä¸èƒ½åŒæ—¶ä½¿ç”¨
res.header('Access-Control-Allow-Origin', '*');
res.header('Access-Control-Allow-Credentials', 'true'); // æµè§ˆå™¨ä¼šæŠ¥é”™ï¼
```

**ğŸ”’ å®‰å…¨é™åˆ¶åŸå› **:
```
ä¸ºä»€ä¹ˆä¸èƒ½ç”¨ * é€šé…ç¬¦ï¼Ÿ

å¦‚æœå…è®¸ Origin: * + Credentials: trueï¼Œé‚£ä¹ˆï¼š
1. ä»»ä½•æ¶æ„ç½‘ç«™éƒ½èƒ½å‘é€æºå¸¦ç”¨æˆ·Cookieçš„è¯·æ±‚
2. å¯èƒ½å¯¼è‡´CSRFæ”»å‡»
3. ç”¨æˆ·éšç§å’Œå®‰å…¨å¾—ä¸åˆ°ä¿éšœ

æ‰€ä»¥æµè§ˆå™¨å¼ºåˆ¶è¦æ±‚ï¼šæºå¸¦å‡­è¯æ—¶å¿…é¡»æ˜ç¡®æŒ‡å®šå…è®¸çš„åŸŸå
```

### 6.4 å‡­è¯è¯·æ±‚å®Œæ•´ç¤ºä¾‹


**ğŸ”¹ åœºæ™¯**: å•ç‚¹ç™»å½•ç³»ç»Ÿï¼Œç”¨æˆ·åœ¨ä¸»ç«™ç™»å½•åè®¿é—®APIå­åŸŸ

```javascript
// å‰ç«¯ä»£ç  (https://app.company.com)
async function getUserInfo() {
  try {
    const response = await fetch('https://api.company.com/user', {
      credentials: 'include',  // æºå¸¦Cookie
      headers: {
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
    }
    
    const userData = await response.json();
    return userData;
  } catch (error) {
    console.error('è¯·æ±‚é”™è¯¯:', error);
  }
}
```

```javascript
// åç«¯ä»£ç  (https://api.company.com)
app.use((req, res, next) => {
  const origin = req.headers.origin;
  const allowedOrigins = [
    'https://app.company.com',
    'https://admin.company.com'
  ];
  
  if (allowedOrigins.includes(origin)) {
    res.header('Access-Control-Allow-Origin', origin);
    res.header('Access-Control-Allow-Credentials', 'true');
    res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  }
  
  next();
});

// ç”¨æˆ·ä¿¡æ¯æ¥å£
app.get('/user', (req, res) => {
  // ä»Cookieä¸­è·å–sessionä¿¡æ¯
  const sessionId = req.cookies.sessionId;
  
  if (!sessionId) {
    return res.status(401).json({error: 'æœªç™»å½•'});
  }
  
  // éªŒè¯sessionå¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯
  const user = getUserBySession(sessionId);
  res.json(user);
});
```

---

## 7. ğŸ›¡ï¸ CORSå®‰å…¨é…ç½®æœ€ä½³å®è·µ


### 7.1 ç™½åå•Originè®¾ç½®


**ğŸ”¸ åŠ¨æ€ç™½åå•é…ç½®**:
```javascript
// ç¯å¢ƒå˜é‡é…ç½®ç™½åå•
const allowedOrigins = process.env.ALLOWED_ORIGINS 
  ? process.env.ALLOWED_ORIGINS.split(',')
  : ['http://localhost:3000']; // å¼€å‘ç¯å¢ƒé»˜è®¤

function corsMiddleware(req, res, next) {
  const origin = req.headers.origin;
  
  // æ£€æŸ¥Originæ˜¯å¦åœ¨ç™½åå•ä¸­
  if (allowedOrigins.includes(origin)) {
    res.header('Access-Control-Allow-Origin', origin);
  }
  
  // å¤„ç†é¢„æ£€è¯·æ±‚
  if (req.method === 'OPTIONS') {
    res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
    res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');
    res.header('Access-Control-Max-Age', '3600');
    return res.status(200).end();
  }
  
  next();
}
```

**ğŸ”¸ åŸŸåæ¨¡å¼åŒ¹é…**:
```javascript
// æ”¯æŒå­åŸŸåçš„çµæ´»é…ç½®
function isOriginAllowed(origin) {
  const allowedDomains = [
    'company.com',
    'app.company.com',
    '*.company.com'  // æ”¯æŒé€šé…ç¬¦å­åŸŸå
  ];
  
  return allowedDomains.some(domain => {
    if (domain.startsWith('*.')) {
      const baseDomain = domain.slice(2);
      return origin.endsWith('.' + baseDomain) || origin === baseDomain;
    }
    return origin === 'https://' + domain;
  });
}
```

### 7.2 æœ€å°æƒé™åŸåˆ™


**ğŸ”¹ æŒ‰æ¥å£ç²¾ç¡®æ§åˆ¶**:
```javascript
// ä¸åŒæ¥å£ä½¿ç”¨ä¸åŒçš„CORSç­–ç•¥
app.get('/api/public/*', publicCorsConfig);     // å…¬å¼€æ¥å£ï¼Œè¾ƒå®½æ¾
app.post('/api/user/*', strictCorsConfig);      // ç”¨æˆ·æ¥å£ï¼Œä¸¥æ ¼é™åˆ¶
app.put('/api/admin/*', adminCorsConfig);       // ç®¡ç†æ¥å£ï¼Œæœ€ä¸¥æ ¼
```

**ğŸ”¹ è¯·æ±‚æ–¹æ³•æœ€å°åŒ–**:
```javascript
// æ ¹æ®æ¥å£ç±»å‹é™åˆ¶æ–¹æ³•
const apiCorsConfig = {
  '/api/read': ['GET'],                    // åªè¯»æ¥å£
  '/api/create': ['POST'],                 // åˆ›å»ºæ¥å£
  '/api/update': ['PUT', 'PATCH'],         // æ›´æ–°æ¥å£
  '/api/manage': ['GET', 'POST', 'PUT', 'DELETE'] // ç®¡ç†æ¥å£
};
```

### 7.3 å®‰å…¨ç›‘æ§ä¸æ—¥å¿—


**ğŸ” CORSè¯·æ±‚ç›‘æ§**:
```javascript
// è®°å½•CORSè¯·æ±‚æ—¥å¿—
function corsWithLogging(req, res, next) {
  const origin = req.headers.origin;
  const userAgent = req.headers['user-agent'];
  
  // è®°å½•è·¨åŸŸè¯·æ±‚
  if (origin && origin !== req.headers.host) {
    console.log(`CORS Request: ${origin} -> ${req.url}`, {
      method: req.method,
      userAgent: userAgent,
      timestamp: new Date().toISOString()
    });
  }
  
  // è®°å½•å¯ç–‘è¯·æ±‚
  if (origin && !isOriginAllowed(origin)) {
    console.warn(`Suspicious CORS Request from: ${origin}`, {
      ip: req.ip,
      url: req.url,
      headers: req.headers
    });
  }
  
  next();
}
```

---

## 8. âš ï¸ CORSæ”»å‡»æ‰‹æ³•ä¸é˜²æŠ¤


### 8.1 Originå¤´æ¬ºéª—æ”»å‡»


**ğŸ”¸ æ”»å‡»åŸç†**:
```
æ”»å‡»è€…çš„æ€è·¯ï¼š
1. å‘ç°ç›®æ ‡APIä½¿ç”¨äº†å®½æ¾çš„CORSé…ç½®
2. ä¼ªé€ Originå¤´ï¼Œè®©æœåŠ¡å™¨ä»¥ä¸ºè¯·æ±‚æ¥è‡ªå¯ä¿¡åŸŸå
3. ç»•è¿‡CORSé™åˆ¶ï¼Œè·å–æ•æ„Ÿæ•°æ®
```

**ğŸ”¹ æ”»å‡»ç¤ºä¾‹**:
```javascript
// æ¶æ„ç½‘ç«™çš„æ”»å‡»ä»£ç 
fetch('https://victim-api.com/sensitive-data', {
  method: 'GET',
  headers: {
    'Origin': 'https://trusted-domain.com'  // ä¼ªé€ å¯ä¿¡åŸŸå
  }
});
```

**ğŸ›¡ï¸ é˜²æŠ¤æªæ–½**:
```javascript
// ä¸¥æ ¼éªŒè¯Originå¤´
function validateOrigin(req, res, next) {
  const origin = req.headers.origin;
  const referer = req.headers.referer;
  
  // å¤šé‡éªŒè¯
  if (origin) {
    // éªŒè¯Originæ˜¯å¦åœ¨ç™½åå•
    if (!allowedOrigins.includes(origin)) {
      return res.status(403).json({error: 'Origin not allowed'});
    }
    
    // å¦‚æœæœ‰Refererï¼ŒéªŒè¯ä¸€è‡´æ€§
    if (referer && !referer.startsWith(origin)) {
      return res.status(403).json({error: 'Origin-Referer mismatch'});
    }
  }
  
  next();
}
```

### 8.2 åå°„å‹CORSæ”»å‡»


**ğŸ”¸ æ”»å‡»åŸç†**:
```javascript
// å±é™©çš„æœåŠ¡ç«¯é…ç½®ï¼šç›´æ¥åå°„Originå¤´
app.use((req, res, next) => {
  const origin = req.headers.origin;
  res.header('Access-Control-Allow-Origin', origin); // å±é™©ï¼ç›´æ¥åå°„
  res.header('Access-Control-Allow-Credentials', 'true');
  next();
});
```

**âš ï¸ æ”»å‡»åæœ**:
```
1. ä»»ä½•åŸŸåéƒ½å¯ä»¥å‘é€è·¨åŸŸè¯·æ±‚
2. å¯ä»¥æºå¸¦ç”¨æˆ·Cookie
3. å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²å’ŒCSRFæ”»å‡»
```

**ğŸ›¡ï¸ æ­£ç¡®é˜²æŠ¤**:
```javascript
// å®‰å…¨çš„OriginéªŒè¯
app.use((req, res, next) => {
  const origin = req.headers.origin;
  const allowedOrigins = ['https://myapp.com', 'https://admin.myapp.com'];
  
  // åªæœ‰ç™½åå•ä¸­çš„Originæ‰è¢«å…è®¸
  if (allowedOrigins.includes(origin)) {
    res.header('Access-Control-Allow-Origin', origin);
    res.header('Access-Control-Allow-Credentials', 'true');
  }
  
  next();
});
```

### 8.3 æ•æ„Ÿæ•°æ®æ³„éœ²é˜²æŠ¤


**ğŸ”¸ æ•°æ®åˆ†çº§å¤„ç†**:
```javascript
// æ ¹æ®æ•°æ®æ•æ„Ÿæ€§è®¾ç½®ä¸åŒçš„CORSç­–ç•¥
const corsConfigs = {
  public: {
    origins: ['*'],
    credentials: false
  },
  internal: {
    origins: ['https://app.company.com'],
    credentials: true
  },
  sensitive: {
    origins: ['https://admin.company.com'],
    credentials: true,
    headers: ['Authorization']
  }
};

// æ•æ„Ÿæ¥å£é¢å¤–éªŒè¯
app.get('/api/sensitive/*', (req, res, next) => {
  // é™¤äº†CORSéªŒè¯ï¼Œè¿˜è¦éªŒè¯è®¤è¯token
  const token = req.headers.authorization;
  if (!isValidAdminToken(token)) {
    return res.status(403).json({error: 'Insufficient privileges'});
  }
  next();
});
```

---

## 9. ğŸš€ å®æˆ˜é…ç½®ç¤ºä¾‹


### 9.1 å‰åç«¯åˆ†ç¦»æ¶æ„CORSé…ç½®


**ğŸ”¹ åœºæ™¯æè¿°**:
```
æ¶æ„ï¼š
å‰ç«¯ï¼šhttps://app.example.com (Reactåº”ç”¨)
åç«¯ï¼šhttps://api.example.com (Node.js API)
ç®¡ç†ç«¯ï¼šhttps://admin.example.com (Vueåº”ç”¨)

éœ€æ±‚ï¼š
1. å‰ç«¯å¯ä»¥è°ƒç”¨æ‰€æœ‰å…¬å¼€API
2. ç®¡ç†ç«¯å¯ä»¥è°ƒç”¨ç®¡ç†API
3. æ”¯æŒç”¨æˆ·ç™»å½•çŠ¶æ€(Cookie)
```

**ğŸ”¹ åç«¯é…ç½®**:
```javascript
const express = require('express');
const app = express();

// CORSé…ç½®ä¸­é—´ä»¶
function setupCORS() {
  const corsConfigs = {
    production: {
      'https://app.example.com': {
        methods: ['GET', 'POST'],
        headers: ['Content-Type'],
        credentials: false
      },
      'https://admin.example.com': {
        methods: ['GET', 'POST', 'PUT', 'DELETE'],
        headers: ['Content-Type', 'Authorization'],
        credentials: true
      }
    },
    development: {
      'http://localhost:3000': {
        methods: ['*'],
        headers: ['*'],
        credentials: true
      }
    }
  };

  const config = corsConfigs[process.env.NODE_ENV] || corsConfigs.development;

  return (req, res, next) => {
    const origin = req.headers.origin;
    const corsRule = config[origin];

    if (corsRule) {
      res.header('Access-Control-Allow-Origin', origin);
      
      if (corsRule.credentials) {
        res.header('Access-Control-Allow-Credentials', 'true');
      }
      
      if (req.method === 'OPTIONS') {
        res.header('Access-Control-Allow-Methods', 
          Array.isArray(corsRule.methods) ? corsRule.methods.join(', ') : corsRule.methods);
        res.header('Access-Control-Allow-Headers', 
          Array.isArray(corsRule.headers) ? corsRule.headers.join(', ') : corsRule.headers);
        res.header('Access-Control-Max-Age', '3600');
        return res.status(200).end();
      }
    }

    next();
  };
}

app.use(setupCORS());
```

**ğŸ”¹ å‰ç«¯é…ç½®**:
```javascript
// APIè¯·æ±‚å°è£…
class APIClient {
  constructor(baseURL, options = {}) {
    this.baseURL = baseURL;
    this.defaultOptions = {
      credentials: options.withCredentials ? 'include' : 'same-origin',
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      }
    };
  }

  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const config = {
      ...this.defaultOptions,
      ...options,
      headers: {
        ...this.defaultOptions.headers,
        ...options.headers
      }
    };

    try {
      const response = await fetch(url, config);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('APIè¯·æ±‚å¤±è´¥:', error);
      throw error;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const apiClient = new APIClient('https://api.example.com', {
  withCredentials: true  // ç®¡ç†ç«¯éœ€è¦æºå¸¦Cookie
});

// è°ƒç”¨API
apiClient.request('/user/profile').then(data => {
  console.log('ç”¨æˆ·ä¿¡æ¯:', data);
});
```

### 9.2 ç½‘å…³å±‚è·¨åŸŸå¤„ç†


**ğŸ”¹ æ¶æ„åœºæ™¯**:
```
                    ç½‘å…³å±‚
                  (nginx/kong)
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
    ç”¨æˆ·æœåŠ¡API    è®¢å•æœåŠ¡API    æ”¯ä»˜æœåŠ¡API
  user.api.com   order.api.com  pay.api.com
```

**ğŸ”¹ Nginxé…ç½®**:
```nginx
# ç½‘å…³ç»Ÿä¸€å¤„ç†CORS
server {
    listen 443 ssl;
    server_name api.example.com;

    # CORSé…ç½®
    location / {
        # é¢„æ£€è¯·æ±‚å¤„ç†
        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' $http_origin always;
            add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization, X-Requested-With' always;
            add_header 'Access-Control-Allow-Credentials' 'true' always;
            add_header 'Access-Control-Max-Age' 3600 always;
            add_header 'Content-Length' 0;
            return 204;
        }

        # å®é™…è¯·æ±‚å¤„ç†
        add_header 'Access-Control-Allow-Origin' $http_origin always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
        
        # è·¯ç”±åˆ°åç«¯æœåŠ¡
        location /api/user/ {
            proxy_pass http://user-service/;
        }
        
        location /api/order/ {
            proxy_pass http://order-service/;
        }
        
        location /api/pay/ {
            proxy_pass http://pay-service/;
        }
    }
}

# Originç™½åå•é…ç½®
map $http_origin $allowed_origin {
    default '';
    ~^https://app\.example\.com$ $http_origin;
    ~^https://admin\.example\.com$ $http_origin;
    ~^https://.*\.example\.com$ $http_origin;
}
```

**ğŸ”¹ Kongç½‘å…³é…ç½®**:
```yaml
# Kong CORSæ’ä»¶é…ç½®
plugins:
- name: cors
  config:
    origins:
      - https://app.example.com
      - https://admin.example.com
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    headers:
      - Content-Type
      - Authorization
      - X-Requested-With
    credentials: true
    max_age: 3600
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ CORSæœ¬è´¨ç†è§£**:
```
CORS = è·¨åŸŸèµ„æºå…±äº« = ç½‘ç«™é—´çš„"é€šè¡Œè¯"ç³»ç»Ÿ
ç›®çš„ï¼šåœ¨ä¿è¯å®‰å…¨çš„å‰æä¸‹ï¼Œå…è®¸åˆæ³•çš„è·¨åŸŸè®¿é—®
æ ¸å¿ƒï¼šæœåŠ¡ç«¯ä¸»åŠ¨æˆæƒï¼Œæµè§ˆå™¨æ‰§è¡Œæ£€æŸ¥
```

**ğŸ”¸ è¯·æ±‚åˆ†ç±»è®°å¿†**:
```
ç®€å•è¯·æ±‚ï¼šåŸºæœ¬çš„GET/POSTï¼Œç›´æ¥å‘é€
å¤æ‚è¯·æ±‚ï¼šé«˜çº§æ“ä½œï¼Œå…ˆå‘OPTIONSé¢„æ£€

åˆ¤æ–­æ ‡å‡†ï¼š
âœ… æ–¹æ³•ç®€å• + å¤´éƒ¨ç®€å• = ç®€å•è¯·æ±‚
âŒ ä»»ä¸€å¤æ‚ = å¤æ‚è¯·æ±‚ï¼ˆéœ€é¢„æ£€ï¼‰
```

**ğŸ”¸ æ ¸å¿ƒå“åº”å¤´ä½œç”¨**:
```
Access-Control-Allow-Origin     â†’ è°å¯ä»¥è®¿é—®æˆ‘
Access-Control-Allow-Methods    â†’ å…è®¸ä»€ä¹ˆæ“ä½œ
Access-Control-Allow-Headers    â†’ å…è®¸ä»€ä¹ˆå¤´éƒ¨
Access-Control-Allow-Credentials â†’ æ˜¯å¦å…è®¸æºå¸¦Cookie
```

### 10.2 å®‰å…¨é…ç½®è¦ç‚¹


**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒåŸåˆ™**:
```
1. ğŸ¯ ç²¾ç¡®æŒ‡å®šOriginï¼Œé¿å…ä½¿ç”¨ *
2. ğŸ”’ æœ€å°æƒé™åŸåˆ™ï¼Œåªå¼€æ”¾å¿…è¦çš„æ–¹æ³•å’Œå¤´éƒ¨
3. ğŸ“ è®°å½•CORSæ—¥å¿—ï¼Œç›‘æ§å¼‚å¸¸è¯·æ±‚
4. ğŸ›¡ï¸ é…åˆå…¶ä»–å®‰å…¨æªæ–½ï¼ˆè®¤è¯ã€æˆæƒç­‰ï¼‰
```

**ğŸ”¹ å¸¸è§å®‰å…¨é™·é˜±**:
```
âŒ Origin: * + Credentials: true
âŒ ç›´æ¥åå°„Originå¤´
âŒ è¿‡åº¦å®½æ¾çš„å¤´éƒ¨é…ç½®
âŒ å¿½ç•¥é¢„æ£€è¯·æ±‚çš„å®‰å…¨éªŒè¯
```

### 10.3 å®è·µåº”ç”¨å»ºè®®


**ğŸš€ å¼€å‘é˜¶æ®µ**:
- ä½¿ç”¨ç›¸å¯¹å®½æ¾çš„é…ç½®ä¾¿äºè°ƒè¯•
- è®°å½•æ‰€æœ‰CORSè¯·æ±‚ç”¨äºåˆ†æ
- é€æ­¥æ”¶ç´§é…ç½®æ¥è¿‘ç”Ÿäº§æ ‡å‡†

**ğŸ”§ ç”Ÿäº§éƒ¨ç½²**:
- ä¸¥æ ¼çš„ç™½åå•Originé…ç½®
- æŒ‰æ¥å£ç±»å‹è®¾ç½®ä¸åŒçš„CORSç­–ç•¥
- åœ¨ç½‘å…³å±‚ç»Ÿä¸€å¤„ç†CORS

**ğŸ“Š æ€§èƒ½ä¼˜åŒ–**:
- åˆç†è®¾ç½®Max-Ageå‡å°‘é¢„æ£€è¯·æ±‚
- é¿å…ä¸å¿…è¦çš„å¤æ‚è¯·æ±‚
- ä½¿ç”¨CDNæ—¶æ³¨æ„CORSé…ç½®ä¼ é€’

### 10.4 æ•…éšœæ’æŸ¥æ€è·¯


**ğŸ” å¸¸è§é—®é¢˜è¯Šæ–­**:
```
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤Originæ˜¯å¦åœ¨æœåŠ¡ç«¯ç™½åå•
3. éªŒè¯è¯·æ±‚æ–¹æ³•å’Œå¤´éƒ¨æ˜¯å¦è¢«å…è®¸
4. æ£€æŸ¥æ˜¯å¦æ­£ç¡®å¤„ç†OPTIONSé¢„æ£€è¯·æ±‚
5. ç¡®è®¤å‡­è¯é…ç½®çš„ä¸€è‡´æ€§
```

**ğŸ’¡ è°ƒè¯•æŠ€å·§**:
```
1. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·Networké¢æ¿æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
2. å¯¹æ¯”ç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚çš„è¡Œä¸ºå·®å¼‚
3. ä¸´æ—¶æ”¾å®½CORSé…ç½®ç¡®è®¤é—®é¢˜èŒƒå›´
4. æ£€æŸ¥æœåŠ¡ç«¯CORSä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**:
- CORSæ˜¯æµè§ˆå™¨å®‰å…¨æœºåˆ¶ï¼ŒæœåŠ¡ç«¯é…ç½®å†³å®šæƒé™
- ç®€å•è¯·æ±‚ç›´æ¥å‘é€ï¼Œå¤æ‚è¯·æ±‚éœ€è¦é¢„æ£€
- æºå¸¦å‡­è¯æ—¶ä¸èƒ½ä½¿ç”¨Originé€šé…ç¬¦
- å®‰å…¨é…ç½®éµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œç”Ÿäº§ç¯å¢ƒä¸¥æ ¼æ§åˆ¶