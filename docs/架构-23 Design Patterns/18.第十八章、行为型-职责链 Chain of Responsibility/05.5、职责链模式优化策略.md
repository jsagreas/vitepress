---
title: 5ã€èŒè´£é“¾æ¨¡å¼ä¼˜åŒ–ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [èŒè´£é“¾ä¼˜åŒ–æ¦‚è¿°](#1-èŒè´£é“¾ä¼˜åŒ–æ¦‚è¿°)
2. [é“¾è·¯æ€§èƒ½ä¼˜åŒ–](#2-é“¾è·¯æ€§èƒ½ä¼˜åŒ–)
3. [åŠ¨æ€é“¾é‡ç»„](#3-åŠ¨æ€é“¾é‡ç»„)
4. [å¤„ç†å™¨ç¼“å­˜](#4-å¤„ç†å™¨ç¼“å­˜)
5. [é“¾è·¯ç›‘æ§æœºåˆ¶](#5-é“¾è·¯ç›‘æ§æœºåˆ¶)
6. [å¼‚å¸¸å¤„ç†ç­–ç•¥](#6-å¼‚å¸¸å¤„ç†ç­–ç•¥)
7. [ç»¼åˆä¼˜åŒ–å®è·µ](#7-ç»¼åˆä¼˜åŒ–å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ èŒè´£é“¾ä¼˜åŒ–æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–èŒè´£é“¾


**ğŸ¤” æ–°æ‰‹ç–‘é—®**ï¼šèŒè´£é“¾æ¨¡å¼çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¼˜åŒ–ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨é“¶è¡ŒåŠä¸šåŠ¡ï¼š

```
æ™®é€šèŒè´£é“¾ï¼š
å®¢æˆ· â†’ æŸœå‘˜ â†’ ä¸»ç®¡ â†’ ç»ç† â†’ è¡Œé•¿
æ¯ä¸ªäººéƒ½è¦çœ‹ä¸€éä½ çš„ç”³è¯·ï¼Œå³ä½¿å‰é¢çš„äººå°±èƒ½å¤„ç†

ä¼˜åŒ–åçš„èŒè´£é“¾ï¼š
å®¢æˆ· â†’ æ™ºèƒ½åˆ†æµç³»ç»Ÿ â†’ ç›´æ¥æ‰¾åˆ°èƒ½å¤„ç†çš„äºº
è·³è¿‡ä¸å¿…è¦çš„ç¯èŠ‚ï¼Œå¤§å¤§æé«˜æ•ˆç‡
```

**ğŸ’¡ ä¼˜åŒ–çš„æ ¸å¿ƒç›®æ ‡**

| ä¼˜åŒ–æ–¹é¢ | **é—®é¢˜** | **ç›®æ ‡** | **æ•ˆæœ** |
|---------|---------|---------|---------|
| ğŸš€ **æ€§èƒ½** | `é“¾æ¡è¿‡é•¿ï¼Œå¤„ç†æ…¢` | `å¿«é€Ÿæ‰¾åˆ°åˆé€‚å¤„ç†å™¨` | `å“åº”æ—¶é—´å‡å°‘50-80%` |
| ğŸ”„ **çµæ´»æ€§** | `é“¾æ¡å›ºå®šï¼Œéš¾è°ƒæ•´` | `åŠ¨æ€è°ƒæ•´å¤„ç†é¡ºåº` | `é€‚åº”ä¸åŒä¸šåŠ¡åœºæ™¯` |
| ğŸ’¾ **èµ„æº** | `é‡å¤åˆ›å»ºå¤„ç†å™¨` | `ç¼“å­˜å¤ç”¨å¤„ç†å™¨` | `å†…å­˜ä½¿ç”¨é™ä½30%` |
| ğŸ“Š **ç›‘æ§** | `ä¸çŸ¥é“å“ªé‡Œæ…¢` | `å…¨é“¾è·¯æ€§èƒ½ç›‘æ§` | `é—®é¢˜å¿«é€Ÿå®šä½` |
| ğŸ›¡ï¸ **ç¨³å®šæ€§** | `ä¸€ä¸ªèŠ‚ç‚¹æŒ‚å…¨é“¾æŒ‚` | `å¼‚å¸¸éš”ç¦»å’Œæ¢å¤` | `ç³»ç»Ÿå¯ç”¨æ€§99.9%` |

### 1.2 ä¼˜åŒ–ç­–ç•¥æ€»è§ˆ


**ğŸ¨ ä¼˜åŒ–ç­–ç•¥å…¨æ™¯å›¾**

```
èŒè´£é“¾ä¼˜åŒ–ç­–ç•¥
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
â”‚   â”œâ”€â”€ çŸ­è·¯ä¼˜åŒ–ï¼ˆè·³è¿‡ä¸å¿…è¦çš„æ£€æŸ¥ï¼‰
â”‚   â”œâ”€â”€ å¹¶è¡Œå¤„ç†ï¼ˆåŒæ—¶æ‰§è¡Œå¤šä¸ªå¤„ç†å™¨ï¼‰
â”‚   â””â”€â”€ é¢„å¤„ç†ï¼ˆæå‰è¿‡æ»¤è¯·æ±‚ï¼‰
â”œâ”€â”€ åŠ¨æ€è°ƒæ•´
â”‚   â”œâ”€â”€ çƒ­æ’æ‹”ï¼ˆè¿è¡Œæ—¶æ·»åŠ /åˆ é™¤å¤„ç†å™¨ï¼‰
â”‚   â”œâ”€â”€ ä¼˜å…ˆçº§è°ƒæ•´ï¼ˆæ ¹æ®ä¸šåŠ¡è°ƒæ•´é¡ºåºï¼‰
â”‚   â””â”€â”€ è´Ÿè½½å‡è¡¡ï¼ˆåˆ†æ•£å¤„ç†å‹åŠ›ï¼‰
â”œâ”€â”€ ç¼“å­˜ç­–ç•¥
â”‚   â”œâ”€â”€ å¤„ç†å™¨ç¼“å­˜ï¼ˆå¤ç”¨å·²åˆ›å»ºçš„å¤„ç†å™¨ï¼‰
â”‚   â”œâ”€â”€ ç»“æœç¼“å­˜ï¼ˆç¼“å­˜å¤„ç†ç»“æœï¼‰
â”‚   â””â”€â”€ é“¾è·¯ç¼“å­˜ï¼ˆç¼“å­˜æ•´ä¸ªå¤„ç†é“¾ï¼‰
â”œâ”€â”€ ç›‘æ§ä½“ç³»
â”‚   â”œâ”€â”€ æ€§èƒ½ç›‘æ§ï¼ˆå“åº”æ—¶é—´ã€ååé‡ï¼‰
â”‚   â”œâ”€â”€ ä¸šåŠ¡ç›‘æ§ï¼ˆå¤„ç†æˆåŠŸç‡ã€å¼‚å¸¸ç‡ï¼‰
â”‚   â””â”€â”€ èµ„æºç›‘æ§ï¼ˆCPUã€å†…å­˜ä½¿ç”¨ï¼‰
â””â”€â”€ å¼‚å¸¸å¤„ç†
    â”œâ”€â”€ æ•…éšœéš”ç¦»ï¼ˆé˜²æ­¢å•ç‚¹æ•…éšœå½±å“å…¨é“¾ï¼‰
    â”œâ”€â”€ è‡ªåŠ¨æ¢å¤ï¼ˆæ£€æµ‹åˆ°æ•…éšœè‡ªåŠ¨é‡è¯•ï¼‰
    â””â”€â”€ é™çº§ç­–ç•¥ï¼ˆæä¾›å¤‡ç”¨å¤„ç†æ–¹æ¡ˆï¼‰
```

---

## 2. âš¡ é“¾è·¯æ€§èƒ½ä¼˜åŒ–


### 2.1 çŸ­è·¯ä¼˜åŒ–ç­–ç•¥


**ğŸ’¡ ä»€ä¹ˆæ˜¯çŸ­è·¯ä¼˜åŒ–ï¼Ÿ**

å°±åƒç”µè·¯ä¸­çš„çŸ­è·¯ä¸€æ ·ï¼Œå½“æˆ‘ä»¬ç¡®å®šæŸä¸ªå¤„ç†å™¨è‚¯å®šèƒ½æˆ–ä¸èƒ½å¤„ç†è¯·æ±‚æ—¶ï¼Œå°±ç›´æ¥è·³è¿‡åé¢çš„æ£€æŸ¥ã€‚

**ğŸ” å¿«é€Ÿåˆ¤æ–­æœºåˆ¶**

```java
// ä¼˜åŒ–å‰ï¼šæ¯ä¸ªå¤„ç†å™¨éƒ½è¦æ£€æŸ¥
public abstract class Handler {
    protected Handler nextHandler;
    
    public void handleRequest(Request request) {
        if (canHandle(request)) {  // æ¯æ¬¡éƒ½è¦æ‰§è¡Œå¤æ‚åˆ¤æ–­
            process(request);
        } else if (nextHandler != null) {
            nextHandler.handleRequest(request);
        }
    }
}

// ä¼˜åŒ–åï¼šå¿«é€Ÿé¢„åˆ¤æ–­
public abstract class OptimizedHandler {
    protected Handler nextHandler;
    private final Set<String> supportedTypes; // é¢„å®šä¹‰æ”¯æŒçš„ç±»å‹
    
    public void handleRequest(Request request) {
        // å¿«é€Ÿç±»å‹æ£€æŸ¥ï¼Œé¿å…å¤æ‚çš„canHandleé€»è¾‘
        if (supportedTypes.contains(request.getType())) {
            if (canHandle(request)) {
                process(request);
                return;
            }
        }
        
        // ç›´æ¥è·³åˆ°ä¸‹ä¸€ä¸ª
        if (nextHandler != null) {
            nextHandler.handleRequest(request);
        }
    }
}
```

**ğŸ“Š æ€§èƒ½æå‡å¯¹æ¯”**

| åœºæ™¯ | **ä¼˜åŒ–å‰è€—æ—¶** | **ä¼˜åŒ–åè€—æ—¶** | **æå‡å¹…åº¦** |
|------|--------------|--------------|-------------|
| `ç®€å•è¯·æ±‚` | `50ms` | `10ms` | `80%` |
| `å¤æ‚è¯·æ±‚` | `200ms` | `80ms` | `60%` |
| `æ‰¹é‡å¤„ç†` | `10s` | `3s` | `70%` |

### 2.2 é¢„å¤„ç†è¿‡æ»¤å™¨


**ğŸ¯ ä»€ä¹ˆæ˜¯é¢„å¤„ç†ï¼Ÿ**

åœ¨è¯·æ±‚è¿›å…¥èŒè´£é“¾ä¹‹å‰ï¼Œå…ˆç”¨ç®€å•å¿«é€Ÿçš„æ–¹æ³•è¿‡æ»¤æ‰æ˜æ˜¾ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚ã€‚

```java
// é¢„å¤„ç†è¿‡æ»¤å™¨
public class RequestFilter {
    // é»‘åå•ï¼šè¿™äº›ç±»å‹ç›´æ¥æ‹’ç»
    private static final Set<String> BLOCKED_TYPES = Set.of("SPAM", "INVALID");
    
    // ç™½åå•ï¼šè¿™äº›ç±»å‹ç›´æ¥æ”¾è¡Œåˆ°ç‰¹å®šå¤„ç†å™¨
    private static final Map<String, Class<?>> DIRECT_ROUTES = Map.of(
        "SIMPLE", SimpleHandler.class,
        "URGENT", UrgentHandler.class
    );
    
    public FilterResult preProcess(Request request) {
        String type = request.getType();
        
        // ğŸš« é»‘åå•æ£€æŸ¥
        if (BLOCKED_TYPES.contains(type)) {
            return FilterResult.reject("è¯·æ±‚ç±»å‹è¢«ç¦æ­¢");
        }
        
        // âœ… ç™½åå•ç›´è¾¾
        Class<?> directHandler = DIRECT_ROUTES.get(type);
        if (directHandler != null) {
            return FilterResult.directTo(directHandler);
        }
        
        // ğŸ”„ æ­£å¸¸æµç¨‹
        return FilterResult.continueChain();
    }
}
```

### 2.3 å¹¶è¡Œå¤„ç†ä¼˜åŒ–


**ğŸ”¥ å¹¶è¡Œå¤„ç†çš„æ ¸å¿ƒæ€æƒ³**

æœ‰äº›å¤„ç†å™¨ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œæœ€ååˆå¹¶ç»“æœã€‚

```
ä¼ ç»Ÿä¸²è¡Œå¤„ç†ï¼š
è¯·æ±‚ â†’ å¤„ç†å™¨A â†’ å¤„ç†å™¨B â†’ å¤„ç†å™¨C â†’ ç»“æœ
æ€»è€—æ—¶ï¼š100ms + 150ms + 80ms = 330ms

å¹¶è¡Œå¤„ç†ï¼š
         â”Œâ†’ å¤„ç†å™¨A(100ms) â”
è¯·æ±‚ â”€â”€â”€â”€â”¼â†’ å¤„ç†å™¨B(150ms) â”¼â†’ åˆå¹¶ç»“æœ
         â””â†’ å¤„ç†å™¨C(80ms)  â”˜
æ€»è€—æ—¶ï¼šmax(100,150,80) + åˆå¹¶æ—¶é—´ = 160ms
```

**âš¡ å¹¶è¡Œå¤„ç†å®ç°**

```java
public class ParallelChainProcessor {
    private final ExecutorService executor = 
        Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());
    
    public Result processParallel(Request request, List<Handler> handlers) {
        // ğŸ”„ æäº¤æ‰€æœ‰å¯å¹¶è¡Œçš„ä»»åŠ¡
        List<Future<ProcessResult>> futures = handlers.stream()
            .filter(handler -> handler.canHandle(request))
            .map(handler -> executor.submit(() -> {
                try {
                    return new ProcessResult(true, handler.process(request));
                } catch (Exception e) {
                    return new ProcessResult(false, e.getMessage());
                }
            }))
            .collect(Collectors.toList());
        
        // ğŸ“Š æ”¶é›†ç»“æœ
        List<ProcessResult> results = new ArrayList<>();
        for (Future<ProcessResult> future : futures) {
            try {
                ProcessResult result = future.get(5, TimeUnit.SECONDS); // è¶…æ—¶æ§åˆ¶
                results.add(result);
            } catch (TimeoutException e) {
                // è¶…æ—¶å¤„ç†
                future.cancel(true);
                results.add(new ProcessResult(false, "å¤„ç†è¶…æ—¶"));
            }
        }
        
        return mergeResults(results);
    }
}
```

---

## 3. ğŸ”„ åŠ¨æ€é“¾é‡ç»„


### 3.1 ä»€ä¹ˆæ˜¯åŠ¨æ€é“¾é‡ç»„


**ğŸ’­ é€šä¿—ç†è§£**

æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼š
- **é™æ€èœå•**ï¼šèœå“é¡ºåºå›ºå®šï¼Œå¨å¸ˆæŒ‰é¡ºåºåšèœ
- **åŠ¨æ€èœå•**ï¼šæ ¹æ®é£Ÿæä¾›åº”ã€å¨å¸ˆçŠ¶æ€ï¼Œå®æ—¶è°ƒæ•´èœå“åˆ¶ä½œé¡ºåº

åŠ¨æ€é“¾é‡ç»„å°±æ˜¯æ ¹æ®å®é™…æƒ…å†µï¼Œå®æ—¶è°ƒæ•´å¤„ç†å™¨çš„é¡ºåºå’Œç»„åˆã€‚

### 3.2 çƒ­æ’æ‹”æœºåˆ¶


**ğŸ”§ è¿è¡Œæ—¶æ·»åŠ /åˆ é™¤å¤„ç†å™¨**

```java
public class DynamicChainManager {
    // ğŸ”— ä½¿ç”¨é“¾è¡¨ä¾¿äºåŠ¨æ€ä¿®æ”¹
    private volatile LinkedList<Handler> handlerChain = new LinkedList<>();
    // ğŸ”’ è¯»å†™é”ä¿è¯çº¿ç¨‹å®‰å…¨
    private final ReadWriteLock chainLock = new ReentrantReadWriteLock();
    
    // â• åŠ¨æ€æ·»åŠ å¤„ç†å™¨
    public void addHandler(Handler handler, int position) {
        chainLock.writeLock().lock();
        try {
            if (position < 0 || position > handlerChain.size()) {
                handlerChain.addLast(handler); // é»˜è®¤æ·»åŠ åˆ°æœ«å°¾
            } else {
                handlerChain.add(position, handler);
            }
            
            // ğŸ”— é‡æ–°è¿æ¥é“¾æ¡
            rebuildChain();
            
            // ğŸ“ è®°å½•å˜æ›´
            logChainChange("ADD", handler.getClass().getSimpleName(), position);
        } finally {
            chainLock.writeLock().unlock();
        }
    }
    
    // â– åŠ¨æ€åˆ é™¤å¤„ç†å™¨
    public boolean removeHandler(Class<? extends Handler> handlerType) {
        chainLock.writeLock().lock();
        try {
            Iterator<Handler> iterator = handlerChain.iterator();
            while (iterator.hasNext()) {
                Handler handler = iterator.next();
                if (handlerType.isInstance(handler)) {
                    iterator.remove();
                    rebuildChain();
                    logChainChange("REMOVE", handlerType.getSimpleName(), -1);
                    return true;
                }
            }
            return false;
        } finally {
            chainLock.writeLock().unlock();
        }
    }
    
    // ğŸ”— é‡å»ºå¤„ç†é“¾
    private void rebuildChain() {
        for (int i = 0; i < handlerChain.size() - 1; i++) {
            handlerChain.get(i).setNext(handlerChain.get(i + 1));
        }
        // æœ€åä¸€ä¸ªå¤„ç†å™¨çš„nextè®¾ä¸ºnull
        if (!handlerChain.isEmpty()) {
            handlerChain.getLast().setNext(null);
        }
    }
}
```

### 3.3 æ™ºèƒ½ä¼˜å…ˆçº§è°ƒæ•´


**ğŸ§  åŸºäºå†å²æ•°æ®çš„åŠ¨æ€è°ƒæ•´**

```java
public class SmartChainOptimizer {
    // ğŸ“Š å¤„ç†å™¨æ€§èƒ½ç»Ÿè®¡
    private final Map<String, ProcessorStats> performanceStats = new ConcurrentHashMap<>();
    
    // ğŸ¯ æ ¹æ®æˆåŠŸç‡å’Œå“åº”æ—¶é—´è°ƒæ•´é¡ºåº
    public void optimizeChainOrder() {
        List<Handler> optimizedChain = handlerChain.stream()
            .sorted((h1, h2) -> {
                ProcessorStats stats1 = performanceStats.get(h1.getName());
                ProcessorStats stats2 = performanceStats.get(h2.getName());
                
                // ğŸ“ˆ è®¡ç®—ç»¼åˆè¯„åˆ†ï¼šæˆåŠŸç‡ * 0.6 + é€Ÿåº¦åˆ† * 0.4
                double score1 = stats1.getSuccessRate() * 0.6 + stats1.getSpeedScore() * 0.4;
                double score2 = stats2.getSuccessRate() * 0.6 + stats2.getSpeedScore() * 0.4;
                
                return Double.compare(score2, score1); // è¯„åˆ†é«˜çš„æ’å‰é¢
            })
            .collect(Collectors.toList());
        
        // ğŸ”„ åº”ç”¨æ–°çš„é¡ºåº
        updateChainOrder(optimizedChain);
    }
    
    // ğŸ“Š æ€§èƒ½ç»Ÿè®¡ç±»
    public static class ProcessorStats {
        private int totalRequests;
        private int successfulRequests;
        private long totalProcessingTime;
        
        public double getSuccessRate() {
            return totalRequests == 0 ? 0 : (double) successfulRequests / totalRequests;
        }
        
        public double getSpeedScore() {
            if (totalRequests == 0) return 0;
            double avgTime = (double) totalProcessingTime / totalRequests;
            return Math.max(0, 1.0 - (avgTime / 1000.0)); // 1ç§’å†…å®Œæˆå¾—1åˆ†
        }
    }
}
```

### 3.4 ä¸šåŠ¡åœºæ™¯é€‚é…


**ğŸ­ æ ¹æ®ä¸åŒä¸šåŠ¡åœºæ™¯åŠ¨æ€ç»„è£…é“¾æ¡**

```java
// åœºæ™¯é…ç½®
public enum BusinessScenario {
    NORMAL_HOURS("æ­£å¸¸æ—¶æ®µ", Arrays.asList("Auth", "Validate", "Process", "Log")),
    PEAK_HOURS("é«˜å³°æ—¶æ®µ", Arrays.asList("Auth", "Cache", "SimpleProcess", "AsyncLog")),
    EMERGENCY("ç´§æ€¥æƒ…å†µ", Arrays.asList("Auth", "EmergencyProcess"));
    
    private final String description;
    private final List<String> handlerNames;
    
    // æ„é€ å‡½æ•°...
}

public class ScenarioBasedChainBuilder {
    
    // ğŸ¯ æ ¹æ®å½“å‰åœºæ™¯æ„å»ºæœ€é€‚åˆçš„å¤„ç†é“¾
    public Handler buildChainForScenario(BusinessScenario scenario) {
        List<String> handlerNames = scenario.getHandlerNames();
        Handler firstHandler = null;
        Handler currentHandler = null;
        
        for (String handlerName : handlerNames) {
            Handler handler = handlerFactory.createHandler(handlerName);
            
            if (firstHandler == null) {
                firstHandler = handler;
                currentHandler = handler;
            } else {
                currentHandler.setNext(handler);
                currentHandler = handler;
            }
        }
        
        return firstHandler;
    }
    
    // â° è‡ªåŠ¨æ£€æµ‹å½“å‰åº”è¯¥ä½¿ç”¨å“ªä¸ªåœºæ™¯
    public BusinessScenario detectCurrentScenario() {
        LocalTime now = LocalTime.now();
        int currentLoad = systemMonitor.getCurrentLoad();
        
        if (systemMonitor.isEmergencyMode()) {
            return BusinessScenario.EMERGENCY;
        } else if (isPeakHours(now) || currentLoad > 80) {
            return BusinessScenario.PEAK_HOURS;
        } else {
            return BusinessScenario.NORMAL_HOURS;
        }
    }
}
```

---

## 4. ğŸ’¾ å¤„ç†å™¨ç¼“å­˜


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜å¤„ç†å™¨


**ğŸ¤” æ–°æ‰‹ç–‘é—®**ï¼šå¤„ç†å™¨ä¸å°±æ˜¯ä¸€ä¸ªå¯¹è±¡å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç¼“å­˜ï¼Ÿ

**å®é™…é—®é¢˜**ï¼š
- æœ‰äº›å¤„ç†å™¨åˆ›å»ºæˆæœ¬å¾ˆé«˜ï¼ˆæ¯”å¦‚éœ€è¦è¿æ¥æ•°æ®åº“ã€åŠ è½½é…ç½®ï¼‰
- é¢‘ç¹åˆ›å»ºé”€æ¯ä¼šäº§ç”Ÿåƒåœ¾å›æ”¶å‹åŠ›
- æŸäº›å¤„ç†å™¨éœ€è¦ç»´æŠ¤çŠ¶æ€ï¼ˆå¦‚è¿æ¥æ± ã€ç¼“å­˜ç­‰ï¼‰

### 4.2 å¤„ç†å™¨å¯¹è±¡ç¼“å­˜


**ğŸª å¤„ç†å™¨å·¥å‚ + å¯¹è±¡æ± **

```java
public class HandlerPool {
    // ğŸŠâ€â™‚ï¸ ä¸åŒç±»å‹å¤„ç†å™¨çš„å¯¹è±¡æ± 
    private final Map<String, Queue<Handler>> handlerPools = new ConcurrentHashMap<>();
    // âš™ï¸ æ± é…ç½®
    private final int maxPoolSize = 10;
    private final int corePoolSize = 3;
    
    // ğŸ“¦ è·å–å¤„ç†å™¨ï¼ˆä¼˜å…ˆä»æ± ä¸­è·å–ï¼‰
    public Handler borrowHandler(String handlerType) {
        Queue<Handler> pool = handlerPools.computeIfAbsent(handlerType, 
            k -> new ConcurrentLinkedQueue<>());
        
        Handler handler = pool.poll();
        if (handler == null) {
            // æ± ä¸­æ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„
            handler = createHandler(handlerType);
            logPoolMiss(handlerType);
        } else {
            logPoolHit(handlerType);
        }
        
        return handler;
    }
    
    // ğŸ”„ å½’è¿˜å¤„ç†å™¨
    public void returnHandler(String handlerType, Handler handler) {
        Queue<Handler> pool = handlerPools.get(handlerType);
        if (pool != null && pool.size() < maxPoolSize) {
            // ğŸ§¹ é‡ç½®å¤„ç†å™¨çŠ¶æ€
            handler.reset();
            pool.offer(handler);
        } else {
            // æ± æ»¡äº†ï¼Œç›´æ¥é”€æ¯
            handler.destroy();
        }
    }
    
    // ğŸ”¥ é¢„çƒ­å¤„ç†å™¨æ± 
    public void warmUpPool() {
        for (String handlerType : getCommonHandlerTypes()) {
            Queue<Handler> pool = handlerPools.computeIfAbsent(handlerType, 
                k -> new ConcurrentLinkedQueue<>());
            
            // é¢„åˆ›å»ºæ ¸å¿ƒæ•°é‡çš„å¤„ç†å™¨
            for (int i = 0; i < corePoolSize; i++) {
                Handler handler = createHandler(handlerType);
                pool.offer(handler);
            }
        }
    }
}
```

### 4.3 å¤„ç†ç»“æœç¼“å­˜


**âš¡ é¿å…é‡å¤å¤„ç†ç›¸åŒè¯·æ±‚**

```java
public class ResultCacheHandler extends BaseHandler {
    // ğŸ“Š ä½¿ç”¨LRUç¼“å­˜ï¼Œè‡ªåŠ¨æ·˜æ±°è€æ•°æ®
    private final Cache<String, ProcessResult> resultCache = 
        Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(10, TimeUnit.MINUTES) // 10åˆ†é’Ÿè¿‡æœŸ
            .recordStats() // è®°å½•ç¼“å­˜ç»Ÿè®¡
            .build();
    
    @Override
    public void handleRequest(Request request) {
        // ğŸ”‘ ç”Ÿæˆç¼“å­˜é”®
        String cacheKey = generateCacheKey(request);
        
        // ğŸ¯ å…ˆæŸ¥ç¼“å­˜
        ProcessResult cachedResult = resultCache.getIfPresent(cacheKey);
        if (cachedResult != null) {
            // ğŸ’¨ ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
            request.setResult(cachedResult);
            logCacheHit(cacheKey);
            return;
        }
        
        // ğŸ”„ ç¼“å­˜æœªå‘½ä¸­ï¼Œç»§ç»­å¤„ç†
        if (canHandle(request)) {
            ProcessResult result = process(request);
            
            // ğŸ’¾ å°†ç»“æœæ”¾å…¥ç¼“å­˜
            if (isCacheable(result)) {
                resultCache.put(cacheKey, result);
                logCachePut(cacheKey);
            }
            
            request.setResult(result);
        } else {
            // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
            super.handleRequest(request);
        }
    }
    
    // ğŸ”‘ ç”Ÿæˆç¼“å­˜é”®çš„ç­–ç•¥
    private String generateCacheKey(Request request) {
        // æ ¹æ®è¯·æ±‚çš„å…³é”®å­—æ®µç”Ÿæˆå”¯ä¸€é”®
        return String.format("%s_%s_%d", 
            request.getType(), 
            request.getUserId(), 
            request.getContent().hashCode());
    }
    
    // ğŸ“Š è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯
    public CacheStats getCacheStats() {
        return resultCache.stats();
    }
}
```

### 4.4 é“¾è·¯ç¼“å­˜ç­–ç•¥


**ğŸ”— ç¼“å­˜æ•´ä¸ªå¤„ç†é“¾çš„é…ç½®**

```java
public class ChainConfigCache {
    // ğŸ—‚ï¸ æŒ‰ä¸šåŠ¡åœºæ™¯ç¼“å­˜å¤„ç†é“¾é…ç½®
    private final Map<String, ChainConfig> chainConfigs = new ConcurrentHashMap<>();
    
    public static class ChainConfig {
        private final List<String> handlerTypes;
        private final Map<String, Object> parameters;
        private final LocalDateTime lastUsed;
        
        // æ„é€ å‡½æ•°å’Œgetter...
    }
    
    // ğŸ“‹ è·å–å¤„ç†é“¾é…ç½®
    public ChainConfig getChainConfig(String businessType, String userLevel) {
        String configKey = String.format("%s_%s", businessType, userLevel);
        
        ChainConfig config = chainConfigs.get(configKey);
        if (config == null) {
            // ğŸ”§ åŠ¨æ€ç”Ÿæˆé…ç½®
            config = buildChainConfig(businessType, userLevel);
            chainConfigs.put(configKey, config);
        }
        
        return config;
    }
    
    // ğŸ§¹ å®šæœŸæ¸…ç†ä¸å¸¸ç”¨çš„é…ç½®
    @Scheduled(fixedRate = 300000) // 5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void cleanupUnusedConfigs() {
        LocalDateTime cutoff = LocalDateTime.now().minusHours(1);
        
        chainConfigs.entrySet().removeIf(entry -> 
            entry.getValue().getLastUsed().isBefore(cutoff));
    }
}
```

---

## 5. ğŸ“Š é“¾è·¯ç›‘æ§æœºåˆ¶


### 5.1 ç›‘æ§çš„é‡è¦æ€§


**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ï¼Ÿ**

èŒè´£é“¾å°±åƒå·¥å‚çš„æµæ°´çº¿ï¼Œå¦‚æœæ²¡æœ‰ç›‘æ§ï¼š
- ä¸çŸ¥é“å“ªä¸ªç¯èŠ‚æœ€æ…¢
- å‡ºé—®é¢˜äº†ä¸çŸ¥é“åœ¨å“ªé‡Œ
- æ— æ³•ä¼˜åŒ–æ€§èƒ½
- å®¹é‡è§„åˆ’æ²¡æœ‰ä¾æ®

### 5.2 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**â±ï¸ å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰**

```java
public class ChainPerformanceMonitor {
    
    // ğŸ“Š æ ¸å¿ƒç›‘æ§æŒ‡æ ‡
    public static class PerformanceMetrics {
        // â±ï¸ æ—¶é—´ç›¸å…³
        private long totalProcessingTime;    // æ€»å¤„ç†æ—¶é—´
        private long avgResponseTime;        // å¹³å‡å“åº”æ—¶é—´
        private long maxResponseTime;        // æœ€å¤§å“åº”æ—¶é—´
        private long minResponseTime;        // æœ€å°å“åº”æ—¶é—´
        
        // ğŸ“ˆ ååé‡ç›¸å…³
        private long totalRequests;          // æ€»è¯·æ±‚æ•°
        private long successfulRequests;     // æˆåŠŸå¤„ç†æ•°
        private long failedRequests;         // å¤±è´¥å¤„ç†æ•°
        private double throughputPerSecond;  // æ¯ç§’å¤„ç†é‡
        
        // ğŸ¯ é“¾è·¯ç›¸å…³
        private Map<String, Long> handlerExecutionTime; // å„å¤„ç†å™¨è€—æ—¶
        private Map<String, Integer> handlerHitCount;   // å„å¤„ç†å™¨å‘½ä¸­æ¬¡æ•°
        
        // ğŸ“Š è®¡ç®—è¡ç”ŸæŒ‡æ ‡
        public double getSuccessRate() {
            return totalRequests == 0 ? 0 : 
                (double) successfulRequests / totalRequests * 100;
        }
        
        public double getErrorRate() {
            return 100 - getSuccessRate();
        }
    }
    
    // ğŸ“ˆ å®æ—¶æ”¶é›†æ€§èƒ½æ•°æ®
    public void recordRequest(String chainId, RequestContext context) {
        long startTime = System.currentTimeMillis();
        
        try {
            // å¤„ç†è¯·æ±‚...
            recordSuccess(chainId, startTime);
        } catch (Exception e) {
            recordFailure(chainId, startTime, e);
        }
    }
    
    // âœ… è®°å½•æˆåŠŸå¤„ç†
    private void recordSuccess(String chainId, long startTime) {
        long processingTime = System.currentTimeMillis() - startTime;
        
        PerformanceMetrics metrics = getMetrics(chainId);
        synchronized (metrics) {
            metrics.totalRequests++;
            metrics.successfulRequests++;
            metrics.totalProcessingTime += processingTime;
            
            // æ›´æ–°æœ€å¤§æœ€å°å€¼
            if (processingTime > metrics.maxResponseTime) {
                metrics.maxResponseTime = processingTime;
            }
            if (metrics.minResponseTime == 0 || processingTime < metrics.minResponseTime) {
                metrics.minResponseTime = processingTime;
            }
            
            // é‡è®¡ç®—å¹³å‡å€¼
            metrics.avgResponseTime = metrics.totalProcessingTime / metrics.totalRequests;
        }
    }
}
```

### 5.3 å®æ—¶ç›‘æ§çœ‹æ¿


**ğŸ“º ç›‘æ§æ•°æ®çš„å¯è§†åŒ–å±•ç¤º**

```java
public class MonitoringDashboard {
    
    // ğŸ“Š ç”Ÿæˆç›‘æ§æŠ¥å‘Š
    public String generateDashboard(String chainId) {
        PerformanceMetrics metrics = monitor.getMetrics(chainId);
        
        StringBuilder dashboard = new StringBuilder();
        dashboard.append("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n");
        dashboard.append("â•‘        èŒè´£é“¾ç›‘æ§çœ‹æ¿            â•‘\n");
        dashboard.append("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n");
        dashboard.append(String.format("â•‘ ğŸ¯ é“¾è·¯ID: %-20s â•‘\n", chainId));
        dashboard.append(String.format("â•‘ â±ï¸  å¹³å‡å“åº”: %-15dms â•‘\n", metrics.getAvgResponseTime()));
        dashboard.append(String.format("â•‘ ğŸ“ˆ æˆåŠŸç‡: %-18.1f%% â•‘\n", metrics.getSuccessRate()));
        dashboard.append(String.format("â•‘ ğŸš€ ååé‡: %-15.1f/s â•‘\n", metrics.getThroughputPerSecond()));
        dashboard.append("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n");
        dashboard.append("â•‘           å¤„ç†å™¨æ€§èƒ½              â•‘\n");
        dashboard.append("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n");
        
        // ğŸ† æ˜¾ç¤ºå„å¤„ç†å™¨æ€§èƒ½æ’è¡Œ
        metrics.getHandlerExecutionTime().entrySet().stream()
            .sorted(Map.Entry.<String, Long>comparingByValue().reversed())
            .limit(5)
            .forEach(entry -> {
                String handlerName = entry.getKey();
                long avgTime = entry.getValue() / metrics.getHandlerHitCount().get(handlerName);
                dashboard.append(String.format("â•‘ ğŸ“¦ %-12s: %8dms â•‘\n", handlerName, avgTime));
            });
        
        dashboard.append("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        
        return dashboard.toString();
    }
    
    // ğŸš¨ æ€§èƒ½å‘Šè­¦æ£€æŸ¥
    public void checkPerformanceAlerts(String chainId) {
        PerformanceMetrics metrics = monitor.getMetrics(chainId);
        
        // â° å“åº”æ—¶é—´å‘Šè­¦
        if (metrics.getAvgResponseTime() > 1000) {
            sendAlert("âš ï¸ å“åº”æ—¶é—´è¿‡é•¿", 
                String.format("é“¾è·¯ %s å¹³å‡å“åº”æ—¶é—´ %dms è¶…è¿‡é˜ˆå€¼", 
                    chainId, metrics.getAvgResponseTime()));
        }
        
        // ğŸ“‰ æˆåŠŸç‡å‘Šè­¦
        if (metrics.getSuccessRate() < 95.0) {
            sendAlert("ğŸš¨ æˆåŠŸç‡è¿‡ä½", 
                String.format("é“¾è·¯ %s æˆåŠŸç‡ %.1f%% ä½äºé˜ˆå€¼", 
                    chainId, metrics.getSuccessRate()));
        }
        
        // ğŸŒ ååé‡å‘Šè­¦
        if (metrics.getThroughputPerSecond() < 10.0) {
            sendAlert("ğŸ“‰ ååé‡è¿‡ä½", 
                String.format("é“¾è·¯ %s ååé‡ %.1f/s ä½äºé˜ˆå€¼", 
                    chainId, metrics.getThroughputPerSecond()));
        }
    }
}
```

### 5.4 é“¾è·¯è¿½è¸ªæœºåˆ¶


**ğŸ” è¯·æ±‚åœ¨é“¾è·¯ä¸­çš„å®Œæ•´è½¨è¿¹**

```java
public class ChainTracer {
    
    // ğŸ·ï¸ è¿½è¸ªä¸Šä¸‹æ–‡
    public static class TraceContext {
        private final String traceId;      // å…¨å±€è¿½è¸ªID
        private final String spanId;       // å½“å‰å¤„ç†å™¨ID
        private final long startTime;      // å¼€å§‹æ—¶é—´
        private final List<TraceSpan> spans; // å¤„ç†è½¨è¿¹
        
        public TraceContext(String traceId) {
            this.traceId = traceId;
            this.spanId = generateSpanId();
            this.startTime = System.currentTimeMillis();
            this.spans = new ArrayList<>();
        }
    }
    
    // ğŸ“ è¿½è¸ªèŠ‚ç‚¹
    public static class TraceSpan {
        private final String handlerName;
        private final long startTime;
        private final long endTime;
        private final boolean success;
        private final String errorMessage;
        
        // æ„é€ å‡½æ•°...
        
        public long getDuration() {
            return endTime - startTime;
        }
    }
    
    // ğŸ¯ åœ¨å¤„ç†å™¨ä¸­åŸ‹ç‚¹
    public void traceHandlerExecution(String handlerName, Runnable handlerLogic) {
        TraceContext context = getCurrentTraceContext();
        long startTime = System.currentTimeMillis();
        
        try {
            handlerLogic.run();
            // âœ… è®°å½•æˆåŠŸæ‰§è¡Œ
            context.addSpan(new TraceSpan(handlerName, startTime, 
                System.currentTimeMillis(), true, null));
        } catch (Exception e) {
            // âŒ è®°å½•æ‰§è¡Œå¤±è´¥
            context.addSpan(new TraceSpan(handlerName, startTime, 
                System.currentTimeMillis(), false, e.getMessage()));
            throw e;
        }
    }
    
    // ğŸ“‹ ç”Ÿæˆè¿½è¸ªæŠ¥å‘Š
    public String generateTraceReport(TraceContext context) {
        StringBuilder report = new StringBuilder();
        report.append(String.format("ğŸ” è¿½è¸ªID: %s\n", context.getTraceId()));
        report.append(String.format("â±ï¸  æ€»è€—æ—¶: %dms\n", context.getTotalDuration()));
        report.append("ğŸ“Š æ‰§è¡Œè½¨è¿¹:\n");
        
        for (TraceSpan span : context.getSpans()) {
            String status = span.isSuccess() ? "âœ…" : "âŒ";
            report.append(String.format("  %s %s: %dms", 
                status, span.getHandlerName(), span.getDuration()));
            
            if (!span.isSuccess()) {
                report.append(String.format(" (é”™è¯¯: %s)", span.getErrorMessage()));
            }
            report.append("\n");
        }
        
        return report.toString();
    }
}
```

---

## 6. ğŸ›¡ï¸ å¼‚å¸¸å¤„ç†ç­–ç•¥


### 6.1 æ•…éšœéš”ç¦»æœºåˆ¶


**ğŸ”’ é˜²æ­¢å•ç‚¹æ•…éšœå½±å“æ•´ä¸ªé“¾è·¯**

```java
public class CircuitBreakerHandler extends BaseHandler {
    
    // ğŸ›ï¸ æ–­è·¯å™¨çŠ¶æ€
    private enum CircuitState {
        CLOSED,    // æ­£å¸¸çŠ¶æ€
        OPEN,      // æ–­è·¯çŠ¶æ€ï¼ˆåœæ­¢è°ƒç”¨ï¼‰
        HALF_OPEN  // åŠå¼€çŠ¶æ€ï¼ˆå°è¯•æ¢å¤ï¼‰
    }
    
    private volatile CircuitState state = CircuitState.CLOSED;
    private final AtomicInteger failureCount = new AtomicInteger(0);
    private final AtomicInteger requestCount = new AtomicInteger(0);
    private volatile long lastFailureTime = 0;
    
    // âš™ï¸ æ–­è·¯å™¨é…ç½®
    private final int failureThreshold = 5;      // å¤±è´¥é˜ˆå€¼
    private final int requestThreshold = 10;     // è¯·æ±‚é˜ˆå€¼
    private final long timeoutMillis = 60000;    // è¶…æ—¶æ—¶é—´
    private final double failureRateThreshold = 0.5; // å¤±è´¥ç‡é˜ˆå€¼
    
    @Override
    public void handleRequest(Request request) {
        // ğŸš« æ–­è·¯å™¨å¼€å¯ï¼Œç›´æ¥æ‹’ç»
        if (state == CircuitState.OPEN) {
            if (shouldAttemptReset()) {
                state = CircuitState.HALF_OPEN;
            } else {
                throw new CircuitBreakerException("æ–­è·¯å™¨å¼€å¯ï¼ŒæœåŠ¡ä¸å¯ç”¨");
            }
        }
        
        try {
            // ğŸ¯ æ­£å¸¸å¤„ç†è¯·æ±‚
            if (canHandle(request)) {
                process(request);
                onSuccess();
            } else {
                // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
                super.handleRequest(request);
            }
        } catch (Exception e) {
            onFailure();
            throw e;
        }
    }
    
    // âœ… å¤„ç†æˆåŠŸ
    private void onSuccess() {
        requestCount.incrementAndGet();
        
        if (state == CircuitState.HALF_OPEN) {
            // åŠå¼€çŠ¶æ€ä¸‹æˆåŠŸï¼Œé‡ç½®æ–­è·¯å™¨
            reset();
        }
    }
    
    // âŒ å¤„ç†å¤±è´¥
    private void onFailure() {
        failureCount.incrementAndGet();
        requestCount.incrementAndGet();
        lastFailureTime = System.currentTimeMillis();
        
        // ğŸ” æ£€æŸ¥æ˜¯å¦éœ€è¦å¼€å¯æ–­è·¯å™¨
        if (shouldOpenCircuit()) {
            state = CircuitState.OPEN;
            logCircuitOpened();
        }
    }
    
    // ğŸ” åˆ¤æ–­æ˜¯å¦åº”è¯¥å¼€å¯æ–­è·¯å™¨
    private boolean shouldOpenCircuit() {
        int requests = requestCount.get();
        int failures = failureCount.get();
        
        // è¯·æ±‚æ•°å¤Ÿäº†æ‰åˆ¤æ–­
        if (requests < requestThreshold) {
            return false;
        }
        
        // å¤±è´¥æ¬¡æ•°è¶…è¿‡é˜ˆå€¼
        if (failures >= failureThreshold) {
            return true;
        }
        
        // å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼
        double failureRate = (double) failures / requests;
        return failureRate >= failureRateThreshold;
    }
}
```

### 6.2 è‡ªåŠ¨æ¢å¤æœºåˆ¶


**ğŸ”„ æ™ºèƒ½é‡è¯•å’Œæ¢å¤ç­–ç•¥**

```java
public class AutoRecoveryHandler extends BaseHandler {
    
    // ğŸ”„ é‡è¯•é…ç½®
    private static class RetryConfig {
        private final int maxRetries;
        private final long baseDelayMs;
        private final double backoffMultiplier;
        private final long maxDelayMs;
        
        public RetryConfig(int maxRetries, long baseDelayMs, double backoffMultiplier, long maxDelayMs) {
            this.maxRetries = maxRetries;
            this.baseDelayMs = baseDelayMs;
            this.backoffMultiplier = backoffMultiplier;
            this.maxDelayMs = maxDelayMs;
        }
    }
    
    private final RetryConfig retryConfig = new RetryConfig(3, 1000, 2.0, 10000);
    
    @Override
    public void handleRequest(Request request) {
        if (canHandle(request)) {
            executeWithRetry(request);
        } else {
            super.handleRequest(request);
        }
    }
    
    // ğŸ”„ å¸¦é‡è¯•çš„æ‰§è¡Œ
    private void executeWithRetry(Request request) {
        Exception lastException = null;
        
        for (int attempt = 0; attempt <= retryConfig.maxRetries; attempt++) {
            try {
                // ğŸ¯ å°è¯•å¤„ç†
                process(request);
                
                // âœ… æˆåŠŸäº†ï¼Œè®°å½•æ¢å¤
                if (attempt > 0) {
                    logRecovery(attempt);
                }
                return;
                
            } catch (Exception e) {
                lastException = e;
                
                // ğŸ“ è®°å½•é‡è¯•
                logRetryAttempt(attempt, e);
                
                // ğŸš« æœ€åä¸€æ¬¡é‡è¯•å¤±è´¥
                if (attempt == retryConfig.maxRetries) {
                    break;
                }
                
                // â° è®¡ç®—å»¶è¿Ÿæ—¶é—´
                long delay = calculateDelay(attempt);
                
                try {
                    Thread.sleep(delay);
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    throw new RuntimeException("é‡è¯•è¢«ä¸­æ–­", ie);
                }
            }
        }
        
        // ğŸš¨ æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥äº†
        throw new RuntimeException("å¤„ç†å¤±è´¥ï¼Œå·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°", lastException);
    }
    
    // ğŸ“Š è®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
    private long calculateDelay(int attempt) {
        long delay = (long) (retryConfig.baseDelayMs * Math.pow(retryConfig.backoffMultiplier, attempt));
        return Math.min(delay, retryConfig.maxDelayMs);
    }
}
```

### 6.3 é™çº§ç­–ç•¥


**ğŸ­ å½“ä¸»è¦å¤„ç†å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ**

```java
public class FallbackHandler extends BaseHandler {
    
    // ğŸ­ é™çº§ç­–ç•¥ç±»å‹
    public enum FallbackStrategy {
        DEFAULT_RESPONSE,    // è¿”å›é»˜è®¤å“åº”
        CACHE_RESPONSE,      // è¿”å›ç¼“å­˜å“åº”
        SIMPLIFIED_PROCESS,  // ç®€åŒ–å¤„ç†æµç¨‹
        ASYNC_PROCESS       // å¼‚æ­¥å¤„ç†
    }
    
    private final Map<String, FallbackStrategy> fallbackStrategies = new HashMap<>();
    private final Cache<String, Object> fallbackCache;
    
    public FallbackHandler() {
        this.fallbackCache = Caffeine.newBuilder()
            .maximumSize(1000)
            .expireAfterWrite(1, TimeUnit.HOURS)
            .build();
    }
    
    @Override
    public void handleRequest(Request request) {
        try {
            // ğŸ¯ æ­£å¸¸å¤„ç†
            if (canHandle(request)) {
                Object result = process(request);
                
                // ğŸ’¾ ç¼“å­˜æˆåŠŸç»“æœç”¨äºé™çº§
                cacheSuccessResult(request, result);
                
                request.setResult(result);
            } else {
                super.handleRequest(request);
            }
            
        } catch (Exception e) {
            // ğŸ›¡ï¸ æ‰§è¡Œé™çº§ç­–ç•¥
            handleFallback(request, e);
        }
    }
    
    // ğŸ›¡ï¸ é™çº§å¤„ç†
    private void handleFallback(Request request, Exception originalException) {
        String requestType = request.getType();
        FallbackStrategy strategy = fallbackStrategies.getOrDefault(requestType, 
            FallbackStrategy.DEFAULT_RESPONSE);
        
        switch (strategy) {
            case DEFAULT_RESPONSE:
                handleDefaultResponse(request);
                break;
                
            case CACHE_RESPONSE:
                handleCacheResponse(request, originalException);
                break;
                
            case SIMPLIFIED_PROCESS:
                handleSimplifiedProcess(request);
                break;
                
            case ASYNC_PROCESS:
                handleAsyncProcess(request);
                break;
        }
        
        // ğŸ“ è®°å½•é™çº§äº‹ä»¶
        logFallbackEvent(request, strategy, originalException);
    }
    
    // ğŸ“„ é»˜è®¤å“åº”é™çº§
    private void handleDefaultResponse(Request request) {
        Object defaultResult = createDefaultResult(request);
        request.setResult(defaultResult);
        request.setFallbackUsed(true);
    }
    
    // ğŸ’¾ ç¼“å­˜å“åº”é™çº§
    private void handleCacheResponse(Request request, Exception originalException) {
        String cacheKey = generateCacheKey(request);
        Object cachedResult = fallbackCache.getIfPresent(cacheKey);
        
        if (cachedResult != null) {
            request.setResult(cachedResult);
            request.setFallbackUsed(true);
            logCacheFallbackHit(cacheKey);
        } else {
            // ç¼“å­˜ä¹Ÿæ²¡æœ‰ï¼Œä½¿ç”¨é»˜è®¤å“åº”
            handleDefaultResponse(request);
        }
    }
    
    // âš¡ ç®€åŒ–å¤„ç†é™çº§
    private void handleSimplifiedProcess(Request request) {
        try {
            // ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬çš„å¤„ç†é€»è¾‘
            Object result = processSimplified(request);
            request.setResult(result);
            request.setFallbackUsed(true);
        } catch (Exception e) {
            // ç®€åŒ–å¤„ç†ä¹Ÿå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å“åº”
            handleDefaultResponse(request);
        }
    }
    
    // ğŸ”„ å¼‚æ­¥å¤„ç†é™çº§
    private void handleAsyncProcess(Request request) {
        // ç«‹å³è¿”å›é»˜è®¤å“åº”
        handleDefaultResponse(request);
        
        // å¼‚æ­¥å¤„ç†çœŸæ­£çš„è¯·æ±‚
        CompletableFuture.supplyAsync(() -> {
            try {
                return process(request);
            } catch (Exception e) {
                logAsyncFallbackFailure(request, e);
                return null;
            }
        }).thenAccept(result -> {
            if (result != null) {
                // å¤„ç†æˆåŠŸï¼Œæ›´æ–°ç¼“å­˜
                cacheSuccessResult(request, result);
                // å¯é€‰ï¼šé€šçŸ¥å®¢æˆ·ç«¯æœ‰æ–°ç»“æœ
                notifyClientIfNeeded(request, result);
            }
        });
    }
}
```

---

## 7. ğŸš€ ç»¼åˆä¼˜åŒ–å®è·µ


### 7.1 ä¼˜åŒ–æ•ˆæœå¯¹æ¯”


**ğŸ“Š ä¼˜åŒ–å‰åæ€§èƒ½å¯¹æ¯”**

| ä¼˜åŒ–é¡¹ç›® | **ä¼˜åŒ–å‰** | **ä¼˜åŒ–å** | **æå‡æ•ˆæœ** | **å®ç°æˆæœ¬** |
|----------|-----------|-----------|-------------|-------------|
| ğŸš€ **å“åº”æ—¶é—´** | `å¹³å‡500ms` | `å¹³å‡150ms` | `æå‡70%` | `ä¸­ç­‰` |
| ğŸ“ˆ **ååé‡** | `100 req/s` | `400 req/s` | `æå‡300%` | `ä¸­ç­‰` |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | `200MB` | `140MB` | `å‡å°‘30%` | `ä½` |
| ğŸ¯ **æˆåŠŸç‡** | `92%` | `99.5%` | `æå‡8%` | `é«˜` |
| âš¡ **ç³»ç»Ÿå¯ç”¨æ€§** | `95%` | `99.9%` | `æå‡5%` | `é«˜` |

### 7.2 æœ€ä½³å®è·µæ€»ç»“


**âœ… ä¼˜åŒ–å®æ–½å»ºè®®**

```
ğŸ¯ ä¼˜åŒ–ä¼˜å…ˆçº§å»ºè®®ï¼š
1. å…ˆå®æ–½ä½æˆæœ¬é«˜æ”¶ç›Šçš„ä¼˜åŒ–ï¼ˆç¼“å­˜ã€é¢„å¤„ç†ï¼‰
2. å†å®æ–½ä¸­ç­‰æˆæœ¬çš„ä¼˜åŒ–ï¼ˆæ€§èƒ½ç›‘æ§ã€åŠ¨æ€è°ƒæ•´ï¼‰
3. æœ€åå®æ–½é«˜æˆæœ¬çš„ä¼˜åŒ–ï¼ˆæ•…éšœéš”ç¦»ã€é™çº§ç­–ç•¥ï¼‰

â° åˆ†é˜¶æ®µå®æ–½ï¼š
ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼šåŸºç¡€ç¼“å­˜ + æ€§èƒ½ç›‘æ§
ç¬¬äºŒé˜¶æ®µï¼ˆ2-3å‘¨ï¼‰ï¼šåŠ¨æ€é“¾é‡ç»„ + å¼‚å¸¸å¤„ç†
ç¬¬ä¸‰é˜¶æ®µï¼ˆ3-4å‘¨ï¼‰ï¼šé«˜çº§åŠŸèƒ½ + å…¨é¢æµ‹è¯•

ğŸ“Š æ•ˆæœè¯„ä¼°ï¼š
- å»ºç«‹åŸºçº¿æŒ‡æ ‡
- æŒç»­ç›‘æ§å…³é”®KPI
- å®šæœŸæ€§èƒ½å›é¡¾
- ç”¨æˆ·ä½“éªŒåé¦ˆ
```

### 7.3 å®Œæ•´çš„ä¼˜åŒ–ç¤ºä¾‹


**ğŸ”§ é›†æˆæ‰€æœ‰ä¼˜åŒ–ç­–ç•¥çš„å®Œæ•´å®ç°**

```java
@Component
public class OptimizedChainProcessor {
    
    // ğŸ› ï¸ æ ¸å¿ƒç»„ä»¶
    private final HandlerPool handlerPool;
    private final DynamicChainManager chainManager;
    private final ChainPerformanceMonitor monitor;
    private final ChainTracer tracer;
    
    // ğŸ“Š å¤„ç†è¯·æ±‚çš„ä¸»å…¥å£
    public ProcessResult processRequest(Request request) {
        // ğŸ¯ ç”Ÿæˆè¿½è¸ªID
        String traceId = generateTraceId();
        TraceContext traceContext = new TraceContext(traceId);
        
        try {
            // ğŸ” é¢„å¤„ç†è¿‡æ»¤
            FilterResult filterResult = preFilter(request);
            if (!filterResult.shouldContinue()) {
                return filterResult.getResult();
            }
            
            // ğŸ—ï¸ æ ¹æ®åœºæ™¯æ„å»ºå¤„ç†é“¾
            BusinessScenario scenario = detectScenario(request);
            Handler processingChain = chainManager.buildChainForScenario(scenario);
            
            // â±ï¸ å¼€å§‹æ€§èƒ½ç›‘æ§
            long startTime = System.currentTimeMillis();
            
            // ğŸ”„ æ‰§è¡Œå¤„ç†é“¾
            ProcessResult result = executeChainWithFallback(processingChain, request, traceContext);
            
            // ğŸ“Š è®°å½•æ€§èƒ½æ•°æ®
            recordPerformanceMetrics(scenario.name(), startTime, result.isSuccess());
            
            return result;
            
        } catch (Exception e) {
            // ğŸ›¡ï¸ å¼‚å¸¸å¤„ç†å’Œé™çº§
            return handleException(request, e, traceContext);
        } finally {
            // ğŸ“ ç”Ÿæˆè¿½è¸ªæŠ¥å‘Š
            String traceReport = tracer.generateTraceReport(traceContext);
            logTraceReport(traceReport);
        }
    }
    
    // ğŸ”„ å¸¦é™çº§çš„é“¾è·¯æ‰§è¡Œ
    private ProcessResult executeChainWithFallback(Handler chain, Request request, TraceContext context) {
        try {
            // ğŸ¯ æ­£å¸¸æ‰§è¡Œå¤„ç†é“¾
            tracer.traceHandlerExecution("MainChain", () -> {
                chain.handleRequest(request);
            });
            
            return ProcessResult.success(request.getResult());
            
        } catch (Exception e) {
            // ğŸ›¡ï¸ æ‰§è¡Œé™çº§ç­–ç•¥
            return executeFallbackStrategy(request, e, context);
        }
    }
    
    // ğŸ›ï¸ æ™ºèƒ½åœºæ™¯æ£€æµ‹
    private BusinessScenario detectScenario(Request request) {
        // ğŸ“Š ç»¼åˆè€ƒè™‘å¤šä¸ªå› ç´ 
        ScenarioDetector detector = new ScenarioDetector()
            .withCurrentTime(LocalTime.now())
            .withSystemLoad(systemMonitor.getCurrentLoad())
            .withRequestType(request.getType())
            .withUserLevel(request.getUserLevel())
            .withHistoricalData(monitor.getHistoricalData());
        
        return detector.detect();
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 ğŸ¯ å¿…é¡»æŒæ¡çš„ä¼˜åŒ–ç­–ç•¥


```
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šçŸ­è·¯ä¼˜åŒ–ã€é¢„å¤„ç†è¿‡æ»¤ã€å¹¶è¡Œå¤„ç†
ğŸ”¸ åŠ¨æ€è°ƒæ•´ï¼šçƒ­æ’æ‹”ã€æ™ºèƒ½é‡ç»„ã€åœºæ™¯é€‚é…
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šå¯¹è±¡æ± ã€ç»“æœç¼“å­˜ã€é…ç½®ç¼“å­˜
ğŸ”¸ ç›‘æ§ä½“ç³»ï¼šæ€§èƒ½ç›‘æ§ã€é“¾è·¯è¿½è¸ªã€å®æ—¶å‘Šè­¦
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šæ•…éšœéš”ç¦»ã€è‡ªåŠ¨æ¢å¤ã€é™çº§ç­–ç•¥
```

### 8.2 ğŸ§  å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¼˜åŒ–çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ**
```
ä¸æ˜¯ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–ï¼Œè€Œæ˜¯è¦è§£å†³å®é™…é—®é¢˜ï¼š
- æ€§èƒ½ç“¶é¢ˆ â†’ æ‰¾å‡ºæœ€æ…¢çš„ç¯èŠ‚ï¼Œé‡ç‚¹ä¼˜åŒ–
- ç¨³å®šæ€§é—®é¢˜ â†’ å¢åŠ ç›‘æ§å’Œå¼‚å¸¸å¤„ç†
- èµ„æºæµªè´¹ â†’ é€šè¿‡ç¼“å­˜å’Œå¤ç”¨å‡å°‘å¼€é”€
- ç»´æŠ¤å›°éš¾ â†’ é€šè¿‡åŠ¨æ€é…ç½®ç®€åŒ–ç®¡ç†
```

**ğŸ”¹ ä¼˜åŒ–çš„æƒè¡¡åŸåˆ™**
```
å¤æ‚åº¦ vs æ”¶ç›Šï¼š
- ç®€å•ä¼˜åŒ–ä¼˜å…ˆï¼ˆç¼“å­˜ã€é¢„å¤„ç†ï¼‰
- å¤æ‚ä¼˜åŒ–éœ€è¦å……åˆ†è¯„ä¼°ROI

æ€§èƒ½ vs ç¨³å®šæ€§ï¼š
- ä¸èƒ½ä¸ºäº†æ€§èƒ½ç‰ºç‰²ç¨³å®šæ€§
- ç¨³å®šæ€§æ˜¯ç¬¬ä¸€è¦ç´ 

é€šç”¨æ€§ vs é’ˆå¯¹æ€§ï¼š
- å…ˆåšé€šç”¨ä¼˜åŒ–
- å†é’ˆå¯¹ç‰¹å®šåœºæ™¯æ·±åº¦ä¼˜åŒ–
```

### 8.3 ğŸ’¡ å®è·µæŒ‡å¯¼åŸåˆ™


**ğŸ¯ ä¼˜åŒ–å®æ–½æ­¥éª¤**
```
1. ğŸ“Š å»ºç«‹ç›‘æ§ï¼šå…ˆæœ‰æ•°æ®ï¼Œæ‰èƒ½ä¼˜åŒ–
2. ğŸ” æ‰¾å‡ºç“¶é¢ˆï¼šæ•°æ®é©±åŠ¨çš„ä¼˜åŒ–æ–¹å‘
3. ğŸš€ åˆ†æ­¥å®æ–½ï¼šå°æ­¥å¿«è·‘ï¼ŒæŒç»­æ”¹è¿›
4. ğŸ“ˆ æ•ˆæœéªŒè¯ï¼šå¯¹æ¯”ä¼˜åŒ–å‰åæ•°æ®
5. ğŸ”„ æŒç»­è¿­ä»£ï¼šä¼˜åŒ–æ˜¯æŒç»­çš„è¿‡ç¨‹
```

**âš ï¸ å¸¸è§ä¼˜åŒ–è¯¯åŒº**
```
âŒ è¿‡æ—©ä¼˜åŒ–ï¼šåœ¨æ²¡æœ‰æ€§èƒ½é—®é¢˜æ—¶å°±å¼€å§‹å¤æ‚ä¼˜åŒ–
âŒ ç›²ç›®ä¼˜åŒ–ï¼šä¸åŸºäºæ•°æ®ï¼Œå‡­æ„Ÿè§‰ä¼˜åŒ–
âŒ è¿‡åº¦ä¼˜åŒ–ï¼šä¸ºäº†å¾®å°æå‡å¼•å…¥å·¨å¤§å¤æ‚åº¦
âŒ å±€éƒ¨ä¼˜åŒ–ï¼šåªçœ‹å±€éƒ¨æ€§èƒ½ï¼Œå¿½ç•¥æ•´ä½“æ¶æ„
```

**ğŸ‰ ä¼˜åŒ–æˆåŠŸæ ‡å‡†**
```
âœ… æ€§èƒ½æŒ‡æ ‡ï¼šå“åº”æ—¶é—´ã€ååé‡ã€èµ„æºä½¿ç”¨ç‡
âœ… ç¨³å®šæ€§æŒ‡æ ‡ï¼šå¯ç”¨æ€§ã€é”™è¯¯ç‡ã€æ¢å¤æ—¶é—´
âœ… ç»´æŠ¤æ€§æŒ‡æ ‡ï¼šä»£ç å¤æ‚åº¦ã€é…ç½®çµæ´»æ€§
âœ… ä¸šåŠ¡æŒ‡æ ‡ï¼šç”¨æˆ·ä½“éªŒã€æˆæœ¬èŠ‚çº¦
```

### 8.4 ğŸš€ å­¦ä¹ å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ è·¯å¾„**
- æŒæ¡JVMæ€§èƒ½è°ƒä¼˜
- å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡
- äº†è§£ç¼“å­˜ç³»ç»ŸåŸç†
- æŒæ¡ç›‘æ§å’Œè¿ç»´æŠ€èƒ½

**ğŸ”§ åŠ¨æ‰‹å®è·µå»ºè®®**
- æ­å»ºæ€§èƒ½æµ‹è¯•ç¯å¢ƒ
- å®ç°ç®€å•çš„ç›‘æ§ç³»ç»Ÿ
- å°è¯•ä¸åŒçš„ç¼“å­˜ç­–ç•¥
- æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯æµ‹è¯•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> æ€§èƒ½ä¼˜åŒ–æ‰¾ç“¶é¢ˆï¼ŒåŠ¨æ€è°ƒæ•´è¦çµæ´»  
> ç¼“å­˜ç­–ç•¥çœèµ„æºï¼Œç›‘æ§å‘Šè­¦ä¿ç¨³å®š  
> å¼‚å¸¸å¤„ç†è¦å…¨é¢ï¼Œé™çº§æ¢å¤æ˜¯å…³é”®  
> æ•°æ®é©±åŠ¨åšå†³ç­–ï¼ŒæŒç»­æ”¹è¿›æ˜¯ç‹é“