---
title: 4ã€èŒè´£é“¾æ¨¡å¼å®é™…åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [èŒè´£é“¾æ¨¡å¼åœ¨å®é™…å¼€å‘ä¸­çš„ä»·å€¼](#1-èŒè´£é“¾æ¨¡å¼åœ¨å®é™…å¼€å‘ä¸­çš„ä»·å€¼)
2. [Webè¿‡æ»¤å™¨é“¾åº”ç”¨](#2-Webè¿‡æ»¤å™¨é“¾åº”ç”¨)
3. [å¼‚å¸¸å¤„ç†é“¾è®¾è®¡](#3-å¼‚å¸¸å¤„ç†é“¾è®¾è®¡)
4. [å®¡æ‰¹æµç¨‹é“¾å®ç°](#4-å®¡æ‰¹æµç¨‹é“¾å®ç°)
5. [æ—¥å¿—çº§åˆ«å¤„ç†é“¾](#5-æ—¥å¿—çº§åˆ«å¤„ç†é“¾)
6. [æ‹¦æˆªå™¨é“¾è®¾è®¡](#6-æ‹¦æˆªå™¨é“¾è®¾è®¡)
7. [å®é™…åº”ç”¨æœ€ä½³å®è·µ](#7-å®é™…åº”ç”¨æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ èŒè´£é“¾æ¨¡å¼åœ¨å®é™…å¼€å‘ä¸­çš„ä»·å€¼


### 1.1 ä»€ä¹ˆæ˜¯èŒè´£é“¾æ¨¡å¼çš„å®é™…åº”ç”¨


**é€šä¿—ç†è§£**ï¼šå°±åƒç”Ÿæ´»ä¸­çš„**å±‚å±‚å®¡æ‰¹**ä¸€æ ·

```
ç°å®ç”Ÿæ´»ä¸­çš„è¯·å‡æµç¨‹ï¼š
å‘˜å·¥è¯·å‡ â†’ ç›´å±é¢†å¯¼ â†’ éƒ¨é—¨ç»ç† â†’ äººäº‹å®¡æ‰¹ â†’ æœ€ç»ˆæ‰¹å‡†
         (1å¤©å†…)    (3å¤©å†…)    (7å¤©å†…)    (é•¿æœŸè¯·å‡)

æ¯ä¸ªç¯èŠ‚éƒ½æœ‰è‡ªå·±çš„å¤„ç†æƒé™ï¼Œè¶…å‡ºæƒé™å°±ä¼ é€’ç»™ä¸‹ä¸€çº§
```

### 1.2 ä¸ºä»€ä¹ˆè¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨èŒè´£é“¾


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- **ğŸ”¸ é¿å…è¯·æ±‚å‘é€è€…ä¸å¤„ç†è€…è€¦åˆ**ï¼šå‘è¯·æ±‚çš„äººä¸éœ€è¦çŸ¥é“è°æ¥å¤„ç†
- **ğŸ”¸ çµæ´»çš„å¤„ç†æµç¨‹**ï¼šå¯ä»¥éšæ—¶è°ƒæ•´å¤„ç†é¡ºåºï¼Œå¢åŠ æˆ–åˆ é™¤å¤„ç†ç¯èŠ‚  
- **ğŸ”¸ ç¬¦åˆå¼€é—­åŸåˆ™**ï¼šæ–°å¢å¤„ç†é€»è¾‘ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 

```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
if (amount < 1000) {
    manager.approve();
} else if (amount < 5000) {
    director.approve();
} else {
    ceo.approve();
}
// æ¯æ¬¡æ–°å¢å®¡æ‰¹çº§åˆ«éƒ½è¦ä¿®æ”¹è¿™æ®µä»£ç ï¼

èŒè´£é“¾æ–¹å¼ï¼š
request.process(); // è‡ªåŠ¨æ‰¾åˆ°åˆé€‚çš„å¤„ç†è€…
```

### 1.3 èŒè´£é“¾çš„æ ¸å¿ƒä»·å€¼


**ğŸ¯ å®é™…å¼€å‘æ”¶ç›Š**ï¼š

| æ”¶ç›Šç±»å‹ | å…·ä½“è¡¨ç° | ä¸¾ä¾‹è¯´æ˜ |
|---------|---------|---------|
| **çµæ´»æ€§** | åŠ¨æ€è°ƒæ•´å¤„ç†æµç¨‹ | å®¡æ‰¹æµç¨‹å¯é…ç½®åŒ– |
| **æ‰©å±•æ€§** | è½»æ¾æ·»åŠ æ–°çš„å¤„ç†è€… | æ–°å¢æƒé™çº§åˆ«æ— éœ€æ”¹ä»£ç  |
| **ç»´æŠ¤æ€§** | æ¯ä¸ªå¤„ç†è€…èŒè´£å•ä¸€ | ä¿®æ”¹æŸä¸ªå®¡æ‰¹ç¯èŠ‚ä¸å½±å“å…¶ä»– |
| **å¤ç”¨æ€§** | å¤„ç†è€…å¯ä»¥ç»„åˆä½¿ç”¨ | åŒä¸€ä¸ªå®¡æ‰¹è€…ç”¨äºå¤šç§æµç¨‹ |

---

## 2. ğŸŒ Webè¿‡æ»¤å™¨é“¾åº”ç”¨


### 2.1 Webè¿‡æ»¤å™¨é“¾çš„å·¥ä½œåŸç†


**ä»€ä¹ˆæ˜¯Webè¿‡æ»¤å™¨é“¾**ï¼š
Webå¼€å‘ä¸­ï¼Œ**ä¸€ä¸ªHTTPè¯·æ±‚**åœ¨åˆ°è¾¾æœ€ç»ˆå¤„ç†æ–¹æ³•ä¹‹å‰ï¼Œä¼šç»è¿‡**å¤šä¸ªè¿‡æ»¤å™¨**çš„å¤„ç†ï¼Œè¿™äº›è¿‡æ»¤å™¨å½¢æˆä¸€ä¸ª**å¤„ç†é“¾æ¡**ã€‚

```
HTTPè¯·æ±‚å¤„ç†æµç¨‹ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ â†’ ç¼–ç è¿‡æ»¤å™¨ â†’ è®¤è¯è¿‡æ»¤å™¨ â†’ æƒé™è¿‡æ»¤å™¨ â†’ æ—¥å¿—è¿‡æ»¤å™¨ â†’ ä¸šåŠ¡å¤„ç† â†’ å“åº”è¿”å›
            â†“           â†“           â†“           â†“           â†“
          è®¾ç½®ç¼–ç      æ£€æŸ¥ç™»å½•     éªŒè¯æƒé™     è®°å½•æ—¥å¿—     å®é™…å¤„ç†
```

### 2.2 å®é™…é¡¹ç›®ä¸­çš„è¿‡æ»¤å™¨é“¾å®ç°


**æ ¸å¿ƒç»„ä»¶è®¾è®¡**ï¼š

```java
// è¿‡æ»¤å™¨æ¥å£ - å®šä¹‰ç»Ÿä¸€çš„å¤„ç†è§„èŒƒ
public interface WebFilter {
    void doFilter(HttpRequest request, HttpResponse response, FilterChain chain);
}

// è¿‡æ»¤å™¨é“¾ - ç®¡ç†æ‰€æœ‰è¿‡æ»¤å™¨çš„æ‰§è¡Œ
public class FilterChain {
    private List<WebFilter> filters = new ArrayList<>();
    private int currentIndex = 0;
    
    public void addFilter(WebFilter filter) {
        filters.add(filter);
    }
    
    public void doFilter(HttpRequest request, HttpResponse response) {
        if (currentIndex < filters.size()) {
            WebFilter filter = filters.get(currentIndex++);
            filter.doFilter(request, response, this);
        } else {
            // æ‰€æœ‰è¿‡æ»¤å™¨éƒ½å¤„ç†å®Œäº†ï¼Œæ‰§è¡Œå®é™…çš„ä¸šåŠ¡é€»è¾‘
            handleRequest(request, response);
        }
    }
}
```

### 2.3 å¸¸è§è¿‡æ»¤å™¨ç±»å‹åŠå®ç°


**ğŸ” èº«ä»½è®¤è¯è¿‡æ»¤å™¨**ï¼š
```java
public class AuthenticationFilter implements WebFilter {
    @Override
    public void doFilter(HttpRequest request, HttpResponse response, FilterChain chain) {
        String token = request.getHeader("Authorization");
        
        if (token == null || !isValidToken(token)) {
            // è®¤è¯å¤±è´¥ï¼Œç›´æ¥è¿”å›é”™è¯¯
            response.setStatus(401);
            response.setBody("æœªç™»å½•æˆ–tokenæ— æ•ˆ");
            return;
        }
        
        // è®¤è¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†
        chain.doFilter(request, response);
    }
}
```

**ğŸ›¡ï¸ æƒé™éªŒè¯è¿‡æ»¤å™¨**ï¼š
```java
public class AuthorizationFilter implements WebFilter {
    @Override
    public void doFilter(HttpRequest request, HttpResponse response, FilterChain chain) {
        String url = request.getUrl();
        String userRole = getCurrentUserRole(request);
        
        if (!hasPermission(userRole, url)) {
            response.setStatus(403);
            response.setBody("æƒé™ä¸è¶³");
            return;
        }
        
        chain.doFilter(request, response);
    }
}
```

**ğŸ“ è¯·æ±‚æ—¥å¿—è¿‡æ»¤å™¨**ï¼š
```java
public class LoggingFilter implements WebFilter {
    @Override
    public void doFilter(HttpRequest request, HttpResponse response, FilterChain chain) {
        long startTime = System.currentTimeMillis();
        String requestInfo = String.format("è¯·æ±‚ï¼š%s %s", request.getMethod(), request.getUrl());
        
        System.out.println("å¼€å§‹å¤„ç† - " + requestInfo);
        
        // ç»§ç»­å¤„ç†è¯·æ±‚
        chain.doFilter(request, response);
        
        long endTime = System.currentTimeMillis();
        System.out.println("å¤„ç†å®Œæˆ - " + requestInfo + " è€—æ—¶ï¼š" + (endTime - startTime) + "ms");
    }
}
```

### 2.4 è¿‡æ»¤å™¨é“¾çš„é…ç½®ä½¿ç”¨


**å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class WebApplication {
    public static void main(String[] args) {
        FilterChain filterChain = new FilterChain();
        
        // æŒ‰é¡ºåºæ·»åŠ è¿‡æ»¤å™¨
        filterChain.addFilter(new CharacterEncodingFilter()); // 1. è®¾ç½®ç¼–ç 
        filterChain.addFilter(new AuthenticationFilter());    // 2. èº«ä»½è®¤è¯  
        filterChain.addFilter(new AuthorizationFilter());     // 3. æƒé™éªŒè¯
        filterChain.addFilter(new LoggingFilter());           // 4. æ—¥å¿—è®°å½•
        
        // å¤„ç†è¯·æ±‚
        HttpRequest request = new HttpRequest("/api/users", "GET");
        HttpResponse response = new HttpResponse();
        
        filterChain.doFilter(request, response);
    }
}
```

**ğŸ¯ è¿‡æ»¤å™¨é“¾çš„å®é™…ä»·å€¼**ï¼š
- **æ¨¡å—åŒ–**ï¼šæ¯ä¸ªè¿‡æ»¤å™¨èŒè´£å•ä¸€ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
- **å¯é…ç½®**ï¼šå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€è°ƒæ•´è¿‡æ»¤å™¨é¡ºåº
- **å¯å¤ç”¨**ï¼šåŒä¸€ä¸ªè¿‡æ»¤å™¨å¯ä»¥ç”¨åœ¨ä¸åŒçš„è¯·æ±‚è·¯å¾„ä¸Š

---

## 3. âš ï¸ å¼‚å¸¸å¤„ç†é“¾è®¾è®¡


### 3.1 å¼‚å¸¸å¤„ç†é“¾çš„åº”ç”¨åœºæ™¯


**ä»€ä¹ˆæ˜¯å¼‚å¸¸å¤„ç†é“¾**ï¼š
å½“ç³»ç»Ÿå‡ºç°å¼‚å¸¸æ—¶ï¼Œä¸åŒç±»å‹çš„å¼‚å¸¸éœ€è¦**ä¸åŒçš„å¤„ç†æ–¹å¼**ã€‚å¼‚å¸¸å¤„ç†é“¾è®©æˆ‘ä»¬å¯ä»¥**æŒ‰ä¼˜å…ˆçº§**å¤„ç†å„ç§å¼‚å¸¸ï¼Œæ¯ä¸ªå¤„ç†è€…åªç®¡è‡ªå·±èƒ½å¤„ç†çš„å¼‚å¸¸ç±»å‹ã€‚

```
å¼‚å¸¸å¤„ç†æµç¨‹ç¤ºæ„ï¼š
ç³»ç»Ÿå¼‚å¸¸ â†’ ç½‘ç»œå¼‚å¸¸å¤„ç†å™¨ â†’ æ•°æ®åº“å¼‚å¸¸å¤„ç†å™¨ â†’ ä¸šåŠ¡å¼‚å¸¸å¤„ç†å™¨ â†’ é€šç”¨å¼‚å¸¸å¤„ç†å™¨
          â†“              â†“                â†“                â†“
        è¶…æ—¶é‡è¯•        è¿æ¥æ± é‡å»º         ä¸šåŠ¡é€»è¾‘å›æ»š        è®°å½•æ—¥å¿—å¹¶é€šçŸ¥
```

### 3.2 å¼‚å¸¸å¤„ç†é“¾çš„è®¾è®¡å®ç°


**å¼‚å¸¸å¤„ç†å™¨æ¥å£**ï¼š
```java
public abstract class ExceptionHandler {
    protected ExceptionHandler nextHandler;
    
    public void setNext(ExceptionHandler handler) {
        this.nextHandler = handler;
    }
    
    public void handleException(Exception exception, String context) {
        if (canHandle(exception)) {
            doHandle(exception, context);
        } else if (nextHandler != null) {
            nextHandler.handleException(exception, context);
        } else {
            // æ²¡æœ‰å¤„ç†å™¨èƒ½å¤„ç†è¿™ä¸ªå¼‚å¸¸
            handleUnknownException(exception, context);
        }
    }
    
    protected abstract boolean canHandle(Exception exception);
    protected abstract void doHandle(Exception exception, String context);
    
    private void handleUnknownException(Exception exception, String context) {
        System.err.println("æœªçŸ¥å¼‚å¸¸ç±»å‹ï¼š" + exception.getClass().getName());
        exception.printStackTrace();
    }
}
```

### 3.3 å…·ä½“å¼‚å¸¸å¤„ç†å™¨å®ç°


**ğŸŒ ç½‘ç»œå¼‚å¸¸å¤„ç†å™¨**ï¼š
```java
public class NetworkExceptionHandler extends ExceptionHandler {
    @Override
    protected boolean canHandle(Exception exception) {
        return exception instanceof ConnectException || 
               exception instanceof SocketTimeoutException;
    }
    
    @Override
    protected void doHandle(Exception exception, String context) {
        System.out.println("ç½‘ç»œå¼‚å¸¸å¤„ç†ï¼š" + context);
        
        if (exception instanceof SocketTimeoutException) {
            System.out.println("æ‰§è¡Œè¶…æ—¶é‡è¯•æœºåˆ¶");
            // å®ç°é‡è¯•é€»è¾‘
        } else {
            System.out.println("æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€");
            // å®ç°ç½‘ç»œæ£€æŸ¥é€»è¾‘
        }
    }
}
```

**ğŸ’¾ æ•°æ®åº“å¼‚å¸¸å¤„ç†å™¨**ï¼š
```java
public class DatabaseExceptionHandler extends ExceptionHandler {
    @Override
    protected boolean canHandle(Exception exception) {
        return exception instanceof SQLException;
    }
    
    @Override
    protected void doHandle(Exception exception, String context) {
        SQLException sqlEx = (SQLException) exception;
        System.out.println("æ•°æ®åº“å¼‚å¸¸å¤„ç†ï¼š" + context);
        
        if (sqlEx.getErrorCode() == 1045) {
            System.out.println("æ•°æ®åº“è¿æ¥è®¤è¯å¤±è´¥ï¼Œæ£€æŸ¥ç”¨æˆ·åå¯†ç ");
        } else if (sqlEx.getErrorCode() == 1146) {
            System.out.println("è¡¨ä¸å­˜åœ¨ï¼Œæ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„");
        } else {
            System.out.println("æ‰§è¡Œæ•°æ®åº“è¿æ¥æ± é‡å»º");
        }
    }
}
```

**ğŸ’¼ ä¸šåŠ¡å¼‚å¸¸å¤„ç†å™¨**ï¼š
```java
public class BusinessExceptionHandler extends ExceptionHandler {
    @Override
    protected boolean canHandle(Exception exception) {
        return exception instanceof IllegalArgumentException ||
               exception instanceof IllegalStateException;
    }
    
    @Override
    protected void doHandle(Exception exception, String context) {
        System.out.println("ä¸šåŠ¡å¼‚å¸¸å¤„ç†ï¼š" + context);
        
        if (exception instanceof IllegalArgumentException) {
            System.out.println("å‚æ•°æ ¡éªŒå¤±è´¥ï¼Œè¿”å›å‹å¥½æç¤ºä¿¡æ¯");
        } else {
            System.out.println("ä¸šåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œæ‰§è¡Œæ•°æ®å›æ»š");
        }
    }
}
```

### 3.4 å¼‚å¸¸å¤„ç†é“¾çš„ä½¿ç”¨


**æ„å»ºå’Œä½¿ç”¨å¼‚å¸¸å¤„ç†é“¾**ï¼š
```java
public class ExceptionHandlerChain {
    private ExceptionHandler chainHead;
    
    public ExceptionHandlerChain() {
        // æ„å»ºå¤„ç†é“¾
        NetworkExceptionHandler networkHandler = new NetworkExceptionHandler();
        DatabaseExceptionHandler dbHandler = new DatabaseExceptionHandler();
        BusinessExceptionHandler businessHandler = new BusinessExceptionHandler();
        
        // è®¾ç½®å¤„ç†é¡ºåºï¼šç½‘ç»œ â†’ æ•°æ®åº“ â†’ ä¸šåŠ¡
        networkHandler.setNext(dbHandler);
        dbHandler.setNext(businessHandler);
        
        this.chainHead = networkHandler;
    }
    
    public void handleException(Exception exception, String context) {
        chainHead.handleException(exception, context);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class ServiceLayer {
    private ExceptionHandlerChain exceptionChain = new ExceptionHandlerChain();
    
    public void performOperation() {
        try {
            // æ‰§è¡Œå…·ä½“ä¸šåŠ¡æ“ä½œ
            doSomething();
        } catch (Exception e) {
            // ç»Ÿä¸€å¼‚å¸¸å¤„ç†
            exceptionChain.handleException(e, "ç”¨æˆ·æ•°æ®æ“ä½œ");
        }
    }
}
```

**ğŸ¯ å¼‚å¸¸å¤„ç†é“¾çš„ä¼˜åŠ¿**ï¼š
- **èŒè´£åˆ†ç¦»**ï¼šæ¯ä¸ªå¤„ç†å™¨åªå…³æ³¨ç‰¹å®šç±»å‹çš„å¼‚å¸¸
- **æ˜“äºæ‰©å±•**ï¼šæ–°å¢å¼‚å¸¸ç±»å‹åªéœ€è¦å¢åŠ æ–°çš„å¤„ç†å™¨
- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰å¼‚å¸¸éƒ½é€šè¿‡åŒä¸€ä¸ªå…¥å£è¿›å…¥å¤„ç†æµç¨‹

---

## 4. ğŸ“‹ å®¡æ‰¹æµç¨‹é“¾å®ç°


### 4.1 å®¡æ‰¹æµç¨‹çš„ä¸šåŠ¡åœºæ™¯


**å®é™…ä¸šåŠ¡éœ€æ±‚**ï¼š
å…¬å¸çš„å„ç§ç”³è¯·éƒ½éœ€è¦**å±‚å±‚å®¡æ‰¹**ï¼Œæ¯”å¦‚è¯·å‡ç”³è¯·ã€æŠ¥é”€ç”³è¯·ã€é‡‡è´­ç”³è¯·ç­‰ã€‚ä¸åŒé‡‘é¢æˆ–ç±»å‹çš„ç”³è¯·éœ€è¦**ä¸åŒçº§åˆ«çš„å®¡æ‰¹è€…**æ¥å¤„ç†ã€‚

```
å®¡æ‰¹æµç¨‹ç¤ºä¾‹ï¼š
è¯·å‡ç”³è¯·å¤„ç†æµç¨‹ï¼š
1å¤©å†…è¯·å‡   â†’ ç›´å±ä¸»ç®¡å®¡æ‰¹ â†’ ç»“æŸ
3å¤©å†…è¯·å‡   â†’ ç›´å±ä¸»ç®¡ â†’ éƒ¨é—¨ç»ç† â†’ ç»“æŸ  
7å¤©å†…è¯·å‡   â†’ ç›´å±ä¸»ç®¡ â†’ éƒ¨é—¨ç»ç† â†’ HR â†’ ç»“æŸ
7å¤©ä»¥ä¸Š     â†’ ç›´å±ä¸»ç®¡ â†’ éƒ¨é—¨ç»ç† â†’ HR â†’ æ€»ç»ç† â†’ ç»“æŸ
```

### 4.2 å®¡æ‰¹æµç¨‹é“¾çš„è®¾è®¡


**å®¡æ‰¹è¯·æ±‚å®ä½“**ï¼š
```java
public class ApprovalRequest {
    private String applicant;      // ç”³è¯·äºº
    private String type;          // ç”³è¯·ç±»å‹
    private String content;       // ç”³è¯·å†…å®¹  
    private double amount;        // é‡‘é¢ï¼ˆå¦‚æœæ¶‰åŠï¼‰
    private int days;            // å¤©æ•°ï¼ˆå¦‚æœæ˜¯è¯·å‡ï¼‰
    private String status;       // å®¡æ‰¹çŠ¶æ€
    
    // æ„é€ å‡½æ•°å’Œgetter/setteræ–¹æ³•
    public ApprovalRequest(String applicant, String type, String content, double amount, int days) {
        this.applicant = applicant;
        this.type = type;
        this.content = content;
        this.amount = amount;
        this.days = days;
        this.status = "å¾…å®¡æ‰¹";
    }
}
```

**å®¡æ‰¹è€…æŠ½è±¡ç±»**ï¼š
```java
public abstract class Approver {
    protected String name;           // å®¡æ‰¹è€…å§“å
    protected String position;       // èŒä½
    protected Approver nextApprover; // ä¸‹ä¸€çº§å®¡æ‰¹è€…
    
    public Approver(String name, String position) {
        this.name = name;
        this.position = position;
    }
    
    public void setNext(Approver approver) {
        this.nextApprover = approver;
    }
    
    public void processRequest(ApprovalRequest request) {
        if (canApprove(request)) {
            approve(request);
        } else if (nextApprover != null) {
            System.out.println(position + " " + name + " æƒé™ä¸è¶³ï¼Œè½¬äº¤ä¸Šçº§å¤„ç†");
            nextApprover.processRequest(request);
        } else {
            System.out.println("æ²¡æœ‰åˆé€‚çš„å®¡æ‰¹è€…ï¼Œç”³è¯·è¢«æ‹’ç»");
            request.setStatus("å®¡æ‰¹æ‹’ç»");
        }
    }
    
    protected abstract boolean canApprove(ApprovalRequest request);
    protected abstract void approve(ApprovalRequest request);
}
```

### 4.3 å…·ä½“å®¡æ‰¹è€…å®ç°


**ğŸ‘¨â€ğŸ’¼ ç›´å±ä¸»ç®¡**ï¼š
```java
public class Supervisor extends Approver {
    public Supervisor(String name) {
        super(name, "ç›´å±ä¸»ç®¡");
    }
    
    @Override
    protected boolean canApprove(ApprovalRequest request) {
        // ä¸»ç®¡å¯ä»¥å®¡æ‰¹ï¼š1å¤©å†…è¯·å‡ï¼Œ1000å…ƒä»¥å†…æŠ¥é”€
        return (request.getType().equals("è¯·å‡") && request.getDays() <= 1) ||
               (request.getType().equals("æŠ¥é”€") && request.getAmount() <= 1000);
    }
    
    @Override
    protected void approve(ApprovalRequest request) {
        System.out.println("ã€" + position + " " + name + "ã€‘å®¡æ‰¹é€šè¿‡ï¼š" + request.getContent());
        request.setStatus("å®¡æ‰¹é€šè¿‡ - " + position);
    }
}
```

**ğŸ‘” éƒ¨é—¨ç»ç†**ï¼š
```java
public class Manager extends Approver {
    public Manager(String name) {
        super(name, "éƒ¨é—¨ç»ç†");
    }
    
    @Override
    protected boolean canApprove(ApprovalRequest request) {
        // ç»ç†å¯ä»¥å®¡æ‰¹ï¼š3å¤©å†…è¯·å‡ï¼Œ5000å…ƒä»¥å†…æŠ¥é”€
        return (request.getType().equals("è¯·å‡") && request.getDays() <= 3) ||
               (request.getType().equals("æŠ¥é”€") && request.getAmount() <= 5000);
    }
    
    @Override
    protected void approve(ApprovalRequest request) {
        System.out.println("ã€" + position + " " + name + "ã€‘å®¡æ‰¹é€šè¿‡ï¼š" + request.getContent());
        request.setStatus("å®¡æ‰¹é€šè¿‡ - " + position);
    }
}
```

**ğŸ‘©â€ğŸ’¼ HRç»ç†**ï¼š
```java
public class HRManager extends Approver {
    public HRManager(String name) {
        super(name, "HRç»ç†");
    }
    
    @Override
    protected boolean canApprove(ApprovalRequest request) {
        // HRå¯ä»¥å®¡æ‰¹ï¼š7å¤©å†…è¯·å‡ï¼Œäººäº‹ç›¸å…³ç”³è¯·
        return (request.getType().equals("è¯·å‡") && request.getDays() <= 7) ||
                request.getType().equals("è½¬æ­£ç”³è¯·") ||
                request.getType().equals("è°ƒå²—ç”³è¯·");
    }
    
    @Override
    protected void approve(ApprovalRequest request) {
        System.out.println("ã€" + position + " " + name + "ã€‘å®¡æ‰¹é€šè¿‡ï¼š" + request.getContent());
        request.setStatus("å®¡æ‰¹é€šè¿‡ - " + position);
    }
}
```

**ğŸ¤µ æ€»ç»ç†**ï¼š
```java
public class CEO extends Approver {
    public CEO(String name) {
        super(name, "æ€»ç»ç†");
    }
    
    @Override
    protected boolean canApprove(ApprovalRequest request) {
        // æ€»ç»ç†å¯ä»¥å®¡æ‰¹æ‰€æœ‰ç”³è¯·
        return true;
    }
    
    @Override
    protected void approve(ApprovalRequest request) {
        System.out.println("ã€" + position + " " + name + "ã€‘æœ€ç»ˆå®¡æ‰¹é€šè¿‡ï¼š" + request.getContent());
        request.setStatus("æœ€ç»ˆå®¡æ‰¹é€šè¿‡");
    }
}
```

### 4.4 å®¡æ‰¹æµç¨‹çš„å®é™…ä½¿ç”¨


**æ„å»ºå®¡æ‰¹é“¾**ï¼š
```java
public class ApprovalSystem {
    private Approver approvalChain;
    
    public ApprovalSystem() {
        // æ„å»ºå®¡æ‰¹é“¾ï¼šä¸»ç®¡ â†’ ç»ç† â†’ HR â†’ æ€»ç»ç†
        Approver supervisor = new Supervisor("æä¸»ç®¡");
        Approver manager = new Manager("ç‹ç»ç†");
        Approver hrManager = new HRManager("å¼ HR");
        Approver ceo = new CEO("åˆ˜æ€»");
        
        supervisor.setNext(manager);
        manager.setNext(hrManager);
        hrManager.setNext(ceo);
        
        this.approvalChain = supervisor;
    }
    
    public void submitRequest(ApprovalRequest request) {
        System.out.println("\n=== å®¡æ‰¹æµç¨‹å¼€å§‹ ===");
        System.out.println("ç”³è¯·äººï¼š" + request.getApplicant());
        System.out.println("ç”³è¯·å†…å®¹ï¼š" + request.getContent());
        
        approvalChain.processRequest(request);
        
        System.out.println("æœ€ç»ˆçŠ¶æ€ï¼š" + request.getStatus());
        System.out.println("=== å®¡æ‰¹æµç¨‹ç»“æŸ ===\n");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class ApprovalDemo {
    public static void main(String[] args) {
        ApprovalSystem system = new ApprovalSystem();
        
        // æµ‹è¯•ä¸åŒç±»å‹çš„ç”³è¯·
        ApprovalRequest leaveRequest1 = new ApprovalRequest("å°æ˜", "è¯·å‡", "æ„Ÿå†’è¯·å‡1å¤©", 0, 1);
        ApprovalRequest leaveRequest2 = new ApprovalRequest("å°çº¢", "è¯·å‡", "å›å®¶æ¢äº²5å¤©", 0, 5);
        ApprovalRequest expenseRequest = new ApprovalRequest("å°æ", "æŠ¥é”€", "å‡ºå·®è´¹ç”¨æŠ¥é”€", 3000, 0);
        
        system.submitRequest(leaveRequest1);  // ä¸»ç®¡å¯ç›´æ¥å®¡æ‰¹
        system.submitRequest(leaveRequest2);  // éœ€è¦HRå®¡æ‰¹
        system.submitRequest(expenseRequest); // éœ€è¦ç»ç†å®¡æ‰¹
    }
}
```

**ğŸ¯ å®¡æ‰¹æµç¨‹é“¾çš„å®é™…ä»·å€¼**ï¼š
- **æµç¨‹è§„èŒƒåŒ–**ï¼šå®¡æ‰¹æµç¨‹æ¸…æ™°æ˜ç¡®ï¼Œé¿å…æƒé™æ··ä¹±
- **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢å®¡æ‰¹çº§åˆ«åªéœ€è¦æ·»åŠ æ–°çš„å®¡æ‰¹è€…ç±»
- **æƒé™æ§åˆ¶**ï¼šæ¯ä¸ªå®¡æ‰¹è€…åªå¤„ç†è‡ªå·±æƒé™èŒƒå›´å†…çš„ç”³è¯·

---

## 5. ğŸ“ æ—¥å¿—çº§åˆ«å¤„ç†é“¾


### 5.1 æ—¥å¿—ç³»ç»Ÿçš„å¤„ç†éœ€æ±‚


**ä»€ä¹ˆæ˜¯æ—¥å¿—çº§åˆ«å¤„ç†**ï¼š
åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®**æ—¥å¿—çš„é‡è¦ç¨‹åº¦**æ¥å†³å®šå¦‚ä½•å¤„ç†è¿™äº›æ—¥å¿—ã€‚æ¯”å¦‚ERRORçº§åˆ«éœ€è¦ç«‹å³å‘é€å‘Šè­¦ï¼Œè€ŒDEBUGçº§åˆ«åªåœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºã€‚

```
æ—¥å¿—çº§åˆ«å¤„ç†æµç¨‹ï¼š
æ—¥å¿—æ¶ˆæ¯ â†’ DEBUGå¤„ç†å™¨ â†’ INFOå¤„ç†å™¨ â†’ WARNå¤„ç†å™¨ â†’ ERRORå¤„ç†å™¨
          â†“            â†“           â†“            â†“
        æ§åˆ¶å°è¾“å‡º     æ–‡ä»¶è®°å½•     é‚®ä»¶é€šçŸ¥     çŸ­ä¿¡å‘Šè­¦
```

**æ—¥å¿—çº§åˆ«å®šä¹‰**ï¼š
- **DEBUG**ï¼šè°ƒè¯•ä¿¡æ¯ï¼Œä»…å¼€å‘ç¯å¢ƒéœ€è¦
- **INFO**ï¼šä¸€èˆ¬ä¿¡æ¯ï¼Œè®°å½•ç³»ç»Ÿè¿è¡ŒçŠ¶æ€  
- **WARN**ï¼šè­¦å‘Šä¿¡æ¯ï¼Œéœ€è¦å…³æ³¨ä½†ä¸ç´§æ€¥
- **ERROR**ï¼šé”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦ç«‹å³å¤„ç†

### 5.2 æ—¥å¿—å¤„ç†é“¾çš„è®¾è®¡å®ç°


**æ—¥å¿—æ¶ˆæ¯å®ä½“**ï¼š
```java
public class LogMessage {
    public enum LogLevel {
        DEBUG(1), INFO(2), WARN(3), ERROR(4);
        
        private int priority;
        
        LogLevel(int priority) {
            this.priority = priority;
        }
        
        public int getPriority() {
            return priority;
        }
    }
    
    private LogLevel level;
    private String message;
    private String className;
    private long timestamp;
    
    public LogMessage(LogLevel level, String message, String className) {
        this.level = level;
        this.message = message;
        this.className = className;
        this.timestamp = System.currentTimeMillis();
    }
}
```

**æ—¥å¿—å¤„ç†å™¨æŠ½è±¡ç±»**ï¼š
```java
public abstract class LogHandler {
    protected LogMessage.LogLevel handlerLevel;
    protected LogHandler nextHandler;
    
    public LogHandler(LogMessage.LogLevel level) {
        this.handlerLevel = level;
    }
    
    public void setNext(LogHandler handler) {
        this.nextHandler = handler;
    }
    
    public void handleLog(LogMessage logMessage) {
        // å¦‚æœå½“å‰å¤„ç†å™¨å¯ä»¥å¤„ç†è¿™ä¸ªçº§åˆ«çš„æ—¥å¿—
        if (logMessage.getLevel().getPriority() >= handlerLevel.getPriority()) {
            writeLog(logMessage);
        }
        
        // ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼ˆæ³¨æ„ï¼šæ—¥å¿—å¤„ç†é€šå¸¸ä¸ä¸­æ–­é“¾æ¡ï¼‰
        if (nextHandler != null) {
            nextHandler.handleLog(logMessage);
        }
    }
    
    protected abstract void writeLog(LogMessage logMessage);
}
```

### 5.3 å…·ä½“æ—¥å¿—å¤„ç†å™¨å®ç°


**ğŸ–¥ï¸ æ§åˆ¶å°æ—¥å¿—å¤„ç†å™¨**ï¼š
```java
public class ConsoleLogHandler extends LogHandler {
    public ConsoleLogHandler(LogMessage.LogLevel level) {
        super(level);
    }
    
    @Override
    protected void writeLog(LogMessage logMessage) {
        String timeStr = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date(logMessage.getTimestamp()));
        String logStr = String.format("[%s] %s - %s: %s", 
            timeStr, 
            logMessage.getLevel(), 
            logMessage.getClassName(),
            logMessage.getMessage()
        );
        
        if (logMessage.getLevel() == LogMessage.LogLevel.ERROR) {
            System.err.println("ğŸ”´ " + logStr);
        } else if (logMessage.getLevel() == LogMessage.LogLevel.WARN) {
            System.out.println("ğŸŸ¡ " + logStr);
        } else {
            System.out.println("âšª " + logStr);
        }
    }
}
```

**ğŸ“ æ–‡ä»¶æ—¥å¿—å¤„ç†å™¨**ï¼š
```java
public class FileLogHandler extends LogHandler {
    private String fileName;
    
    public FileLogHandler(LogMessage.LogLevel level, String fileName) {
        super(level);
        this.fileName = fileName;
    }
    
    @Override
    protected void writeLog(LogMessage logMessage) {
        try {
            String timeStr = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date(logMessage.getTimestamp()));
            String logStr = String.format("[%s] %s - %s: %s%n", 
                timeStr, 
                logMessage.getLevel(), 
                logMessage.getClassName(),
                logMessage.getMessage()
            );
            
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šä½¿ç”¨æ›´å¤æ‚çš„æ–‡ä»¶æ“ä½œ
            Files.write(Paths.get(fileName), logStr.getBytes(), StandardOpenOption.CREATE, StandardOpenOption.APPEND);
            
        } catch (Exception e) {
            System.err.println("å†™å…¥æ—¥å¿—æ–‡ä»¶å¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```

**ğŸ“§ é‚®ä»¶å‘Šè­¦å¤„ç†å™¨**ï¼š
```java
public class EmailLogHandler extends LogHandler {
    private String adminEmail;
    
    public EmailLogHandler(LogMessage.LogLevel level, String adminEmail) {
        super(level);
        this.adminEmail = adminEmail;
    }
    
    @Override
    protected void writeLog(LogMessage logMessage) {
        // åªå¤„ç†WARNçº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—
        if (logMessage.getLevel().getPriority() >= LogMessage.LogLevel.WARN.getPriority()) {
            sendEmail(logMessage);
        }
    }
    
    private void sendEmail(LogMessage logMessage) {
        // æ¨¡æ‹Ÿå‘é€é‚®ä»¶
        System.out.println("ğŸ“§ å‘é€é‚®ä»¶å‘Šè­¦åˆ°ï¼š" + adminEmail);
        System.out.println("   å‘Šè­¦çº§åˆ«ï¼š" + logMessage.getLevel());
        System.out.println("   å‘Šè­¦å†…å®¹ï¼š" + logMessage.getMessage());
        System.out.println("   æ¥æºç±»ï¼š" + logMessage.getClassName());
    }
}
```

**ğŸ“± çŸ­ä¿¡å‘Šè­¦å¤„ç†å™¨**ï¼š
```java
public class SMSLogHandler extends LogHandler {
    private String adminPhone;
    
    public SMSLogHandler(LogMessage.LogLevel level, String adminPhone) {
        super(level);
        this.adminPhone = adminPhone;
    }
    
    @Override
    protected void writeLog(LogMessage logMessage) {
        // åªå¤„ç†ERRORçº§åˆ«çš„æ—¥å¿—
        if (logMessage.getLevel() == LogMessage.LogLevel.ERROR) {
            sendSMS(logMessage);
        }
    }
    
    private void sendSMS(LogMessage logMessage) {
        // æ¨¡æ‹Ÿå‘é€çŸ­ä¿¡
        System.out.println("ğŸ“± å‘é€çŸ­ä¿¡å‘Šè­¦åˆ°ï¼š" + adminPhone);
        System.out.println("   ç´§æ€¥é”™è¯¯ï¼š" + logMessage.getMessage());
        System.out.println("   ç³»ç»Ÿç»„ä»¶ï¼š" + logMessage.getClassName());
    }
}
```

### 5.4 æ—¥å¿—ç³»ç»Ÿçš„å®Œæ•´ä½¿ç”¨


**æ„å»ºæ—¥å¿—å¤„ç†é“¾**ï¼š
```java
public class LoggerSystem {
    private LogHandler logChain;
    
    public LoggerSystem() {
        // æ„å»ºæ—¥å¿—å¤„ç†é“¾
        LogHandler consoleHandler = new ConsoleLogHandler(LogMessage.LogLevel.DEBUG);
        LogHandler fileHandler = new FileLogHandler(LogMessage.LogLevel.INFO, "application.log");
        LogHandler emailHandler = new EmailLogHandler(LogMessage.LogLevel.WARN, "admin@company.com");
        LogHandler smsHandler = new SMSLogHandler(LogMessage.LogLevel.ERROR, "13800138000");
        
        // è®¾ç½®å¤„ç†é“¾ï¼ˆæ³¨æ„ï¼šæ¯ä¸ªæ—¥å¿—éƒ½ä¼šç»è¿‡æ‰€æœ‰å¤„ç†å™¨ï¼‰
        consoleHandler.setNext(fileHandler);
        fileHandler.setNext(emailHandler);
        emailHandler.setNext(smsHandler);
        
        this.logChain = consoleHandler;
    }
    
    public void debug(String message, String className) {
        LogMessage logMessage = new LogMessage(LogMessage.LogLevel.DEBUG, message, className);
        logChain.handleLog(logMessage);
    }
    
    public void info(String message, String className) {
        LogMessage logMessage = new LogMessage(LogMessage.LogLevel.INFO, message, className);
        logChain.handleLog(logMessage);
    }
    
    public void warn(String message, String className) {
        LogMessage logMessage = new LogMessage(LogMessage.LogLevel.WARN, message, className);
        logChain.handleLog(logMessage);
    }
    
    public void error(String message, String className) {
        LogMessage logMessage = new LogMessage(LogMessage.LogLevel.ERROR, message, className);
        logChain.handleLog(logMessage);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class LogDemo {
    public static void main(String[] args) {
        LoggerSystem logger = new LoggerSystem();
        
        // æµ‹è¯•ä¸åŒçº§åˆ«çš„æ—¥å¿—
        logger.debug("ç³»ç»Ÿå¯åŠ¨ä¸­...", "Application");
        logger.info("ç”¨æˆ·ç™»å½•æˆåŠŸ", "UserService");
        logger.warn("æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡è¾ƒé«˜", "DatabasePool");
        logger.error("æ”¯ä»˜æ¥å£è°ƒç”¨å¤±è´¥", "PaymentService");
    }
}
```

**ğŸ¯ æ—¥å¿—å¤„ç†é“¾çš„å®é™…ä»·å€¼**ï¼š
- **çµæ´»é…ç½®**ï¼šå¯ä»¥æ ¹æ®ç¯å¢ƒè°ƒæ•´æ—¥å¿—è¾“å‡ºæ–¹å¼
- **çº§åˆ«æ§åˆ¶**ï¼šä¸åŒé‡è¦ç¨‹åº¦çš„æ—¥å¿—æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼
- **å‘Šè­¦æœºåˆ¶**ï¼šé‡è¦æ—¥å¿—èƒ½å¤ŸåŠæ—¶é€šçŸ¥è¿ç»´äººå‘˜

---

## 6. ğŸ›¡ï¸ æ‹¦æˆªå™¨é“¾è®¾è®¡


### 6.1 æ‹¦æˆªå™¨çš„åº”ç”¨åœºæ™¯


**ä»€ä¹ˆæ˜¯æ‹¦æˆªå™¨é“¾**ï¼š
æ‹¦æˆªå™¨é“¾ä¸»è¦ç”¨äºåœ¨**æ–¹æ³•è°ƒç”¨å‰å**æ‰§è¡Œä¸€äº›**é€šç”¨é€»è¾‘**ï¼Œæ¯”å¦‚æƒé™æ£€æŸ¥ã€æ€§èƒ½ç›‘æ§ã€å‚æ•°æ ¡éªŒç­‰ã€‚å®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¸ä¿®æ”¹ä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºæ–¹æ³•æ·»åŠ é¢å¤–åŠŸèƒ½ã€‚

```
æ‹¦æˆªå™¨é“¾å·¥ä½œæµç¨‹ï¼š
æ–¹æ³•è°ƒç”¨ â†’ å‚æ•°æ ¡éªŒæ‹¦æˆªå™¨ â†’ æƒé™æ£€æŸ¥æ‹¦æˆªå™¨ â†’ æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨ â†’ å®é™…æ–¹æ³•æ‰§è¡Œ â†’ è¿”å›å¤„ç†
         â†“               â†“               â†“               â†“           â†“
        æ£€æŸ¥å‚æ•°åˆæ³•æ€§      éªŒè¯ç”¨æˆ·æƒé™      è®°å½•å¼€å§‹æ—¶é—´      æ‰§è¡Œä¸šåŠ¡é€»è¾‘   è®°å½•ç»“æŸæ—¶é—´
```

### 6.2 æ‹¦æˆªå™¨é“¾çš„è®¾è®¡å®ç°


**æ–¹æ³•è°ƒç”¨ä¸Šä¸‹æ–‡**ï¼š
```java
public class MethodContext {
    private String methodName;
    private Object[] arguments;
    private Object target;
    private Object result;
    private Exception exception;
    private long startTime;
    private long endTime;
    
    public MethodContext(String methodName, Object[] arguments, Object target) {
        this.methodName = methodName;
        this.arguments = arguments;
        this.target = target;
        this.startTime = System.currentTimeMillis();
    }
    
    public void setResult(Object result) {
        this.result = result;
        this.endTime = System.currentTimeMillis();
    }
    
    public void setException(Exception exception) {
        this.exception = exception;
        this.endTime = System.currentTimeMillis();
    }
    
    public long getExecutionTime() {
        return endTime - startTime;
    }
}
```

**æ‹¦æˆªå™¨æ¥å£**ï¼š
```java
public interface Interceptor {
    // æ–¹æ³•æ‰§è¡Œå‰çš„æ‹¦æˆª
    boolean preHandle(MethodContext context) throws Exception;
    
    // æ–¹æ³•æ‰§è¡Œåçš„æ‹¦æˆªï¼ˆæ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šè°ƒç”¨ï¼‰
    void postHandle(MethodContext context) throws Exception;
    
    // æ–¹æ³•æ‰§è¡Œå®Œæˆåçš„æ‹¦æˆªï¼ˆåœ¨postHandleä¹‹åï¼‰
    void afterCompletion(MethodContext context) throws Exception;
}
```

**æ‹¦æˆªå™¨é“¾ç®¡ç†å™¨**ï¼š
```java
public class InterceptorChain {
    private List<Interceptor> interceptors = new ArrayList<>();
    
    public void addInterceptor(Interceptor interceptor) {
        interceptors.add(interceptor);
    }
    
    public Object executeMethod(String methodName, Object[] args, Object target, Callable<Object> method) {
        MethodContext context = new MethodContext(methodName, args, target);
        
        try {
            // 1. æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„preHandleæ–¹æ³•
            for (Interceptor interceptor : interceptors) {
                if (!interceptor.preHandle(context)) {
                    // å¦‚æœæŸä¸ªæ‹¦æˆªå™¨è¿”å›falseï¼Œä¸­æ–­æ‰§è¡Œ
                    return null;
                }
            }
            
            // 2. æ‰§è¡Œå®é™…æ–¹æ³•
            Object result = method.call();
            context.setResult(result);
            
            // 3. æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„postHandleæ–¹æ³•ï¼ˆé€†åºï¼‰
            for (int i = interceptors.size() - 1; i >= 0; i--) {
                interceptors.get(i).postHandle(context);
            }
            
            return result;
            
        } catch (Exception e) {
            context.setException(e);
            throw new RuntimeException("æ–¹æ³•æ‰§è¡Œå¤±è´¥", e);
        } finally {
            // 4. æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„afterCompletionæ–¹æ³•ï¼ˆé€†åºï¼‰
            for (int i = interceptors.size() - 1; i >= 0; i--) {
                try {
                    interceptors.get(i).afterCompletion(context);
                } catch (Exception e) {
                    System.err.println("æ‹¦æˆªå™¨afterCompletionæ‰§è¡Œå¤±è´¥ï¼š" + e.getMessage());
                }
            }
        }
    }
}
```

### 6.3 å…·ä½“æ‹¦æˆªå™¨å®ç°


**ğŸ“ å‚æ•°æ ¡éªŒæ‹¦æˆªå™¨**ï¼š
```java
public class ValidationInterceptor implements Interceptor {
    @Override
    public boolean preHandle(MethodContext context) throws Exception {
        System.out.println("ğŸ“ å‚æ•°æ ¡éªŒæ‹¦æˆªå™¨ - å¼€å§‹æ ¡éªŒ");
        
        Object[] args = context.getArguments();
        if (args != null) {
            for (int i = 0; i < args.length; i++) {
                if (args[i] == null) {
                    System.out.println("âŒ å‚æ•°æ ¡éªŒå¤±è´¥ï¼šç¬¬" + (i+1) + "ä¸ªå‚æ•°ä¸ºnull");
                    return false; // ä¸­æ–­æ‰§è¡Œ
                }
                
                if (args[i] instanceof String && ((String) args[i]).trim().isEmpty()) {
                    System.out.println("âŒ å‚æ•°æ ¡éªŒå¤±è´¥ï¼šç¬¬" + (i+1) + "ä¸ªå‚æ•°ä¸ºç©ºå­—ç¬¦ä¸²");
                    return false; // ä¸­æ–­æ‰§è¡Œ
                }
            }
        }
        
        System.out.println("âœ… å‚æ•°æ ¡éªŒé€šè¿‡");
        return true;
    }
    
    @Override
    public void postHandle(MethodContext context) throws Exception {
        System.out.println("ğŸ“ å‚æ•°æ ¡éªŒæ‹¦æˆªå™¨ - æ–¹æ³•æ‰§è¡Œå®Œæˆ");
    }
    
    @Override
    public void afterCompletion(MethodContext context) throws Exception {
        System.out.println("ğŸ“ å‚æ•°æ ¡éªŒæ‹¦æˆªå™¨ - æ¸…ç†æ ¡éªŒèµ„æº");
    }
}
```

**ğŸ›¡ï¸ æƒé™æ£€æŸ¥æ‹¦æˆªå™¨**ï¼š
```java
public class SecurityInterceptor implements Interceptor {
    private Set<String> allowedMethods = Set.of("getUserInfo", "updateProfile", "deleteData");
    
    @Override
    public boolean preHandle(MethodContext context) throws Exception {
        System.out.println("ğŸ›¡ï¸ æƒé™æ£€æŸ¥æ‹¦æˆªå™¨ - å¼€å§‹æ£€æŸ¥");
        
        String methodName = context.getMethodName();
        
        // æ¨¡æ‹Ÿæƒé™æ£€æŸ¥
        if (!allowedMethods.contains(methodName)) {
            System.out.println("âŒ æƒé™æ£€æŸ¥å¤±è´¥ï¼šæ²¡æœ‰æƒé™è°ƒç”¨æ–¹æ³• " + methodName);
            return false;
        }
        
        // æ¨¡æ‹Ÿç”¨æˆ·èº«ä»½éªŒè¯
        String currentUser = getCurrentUser(); // å‡è®¾çš„æ–¹æ³•
        if (currentUser == null) {
            System.out.println("âŒ æƒé™æ£€æŸ¥å¤±è´¥ï¼šç”¨æˆ·æœªç™»å½•");
            return false;
        }
        
        System.out.println("âœ… æƒé™æ£€æŸ¥é€šè¿‡ï¼Œç”¨æˆ·ï¼š" + currentUser);
        return true;
    }
    
    @Override
    public void postHandle(MethodContext context) throws Exception {
        System.out.println("ğŸ›¡ï¸ æƒé™æ£€æŸ¥æ‹¦æˆªå™¨ - è®°å½•æ“ä½œæ—¥å¿—");
        String user = getCurrentUser();
        System.out.println("   ç”¨æˆ· " + user + " è°ƒç”¨äº†æ–¹æ³• " + context.getMethodName());
    }
    
    @Override
    public void afterCompletion(MethodContext context) throws Exception {
        System.out.println("ğŸ›¡ï¸ æƒé™æ£€æŸ¥æ‹¦æˆªå™¨ - æ¸…ç†å®‰å…¨ä¸Šä¸‹æ–‡");
    }
    
    private String getCurrentUser() {
        // æ¨¡æ‹Ÿè·å–å½“å‰ç”¨æˆ·
        return "å¼ ä¸‰";
    }
}
```

**â±ï¸ æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨**ï¼š
```java
public class PerformanceInterceptor implements Interceptor {
    @Override
    public boolean preHandle(MethodContext context) throws Exception {
        System.out.println("â±ï¸ æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨ - å¼€å§‹ç›‘æ§");
        System.out.println("   æ–¹æ³•ï¼š" + context.getMethodName() + " å¼€å§‹æ‰§è¡Œ");
        return true;
    }
    
    @Override
    public void postHandle(MethodContext context) throws Exception {
        long executionTime = context.getExecutionTime();
        System.out.println("â±ï¸ æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨ - æ‰§è¡Œå®Œæˆ");
        System.out.println("   æ–¹æ³•ï¼š" + context.getMethodName() + " æ‰§è¡Œæ—¶é—´ï¼š" + executionTime + "ms");
        
        // æ€§èƒ½å‘Šè­¦
        if (executionTime > 1000) {
            System.out.println("âš ï¸ æ€§èƒ½å‘Šè­¦ï¼šæ–¹æ³•æ‰§è¡Œæ—¶é—´è¶…è¿‡1ç§’ï¼");
        }
    }
    
    @Override
    public void afterCompletion(MethodContext context) throws Exception {
        System.out.println("â±ï¸ æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨ - æ¸…ç†ç›‘æ§æ•°æ®");
        
        // è®°å½•æ€§èƒ½æ•°æ®åˆ°ç›‘æ§ç³»ç»Ÿ
        if (context.getException() != null) {
            System.out.println("   æ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼š" + context.getException().getMessage());
        } else {
            System.out.println("   æ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›å€¼ç±»å‹ï¼š" + 
                (context.getResult() != null ? context.getResult().getClass().getSimpleName() : "null"));
        }
    }
}
```

### 6.4 æ‹¦æˆªå™¨é“¾çš„å®é™…ä½¿ç”¨


**ä¸šåŠ¡æœåŠ¡ç±»**ï¼š
```java
public class UserService {
    public String getUserInfo(String userId) {
        // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†
        try {
            Thread.sleep(500); // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        return "ç”¨æˆ·ä¿¡æ¯ï¼šID=" + userId + ", å§“å=å¼ ä¸‰, éƒ¨é—¨=æŠ€æœ¯éƒ¨";
    }
    
    public boolean updateProfile(String userId, String newName) {
        // æ¨¡æ‹Ÿæ›´æ–°æ“ä½œ
        try {
            Thread.sleep(300);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        System.out.println("æ›´æ–°ç”¨æˆ· " + userId + " çš„å§“åä¸ºï¼š" + newName);
        return true;
    }
}
```

**æ‹¦æˆªå™¨é“¾ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class InterceptorDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæ‹¦æˆªå™¨é“¾
        InterceptorChain chain = new InterceptorChain();
        chain.addInterceptor(new ValidationInterceptor());
        chain.addInterceptor(new SecurityInterceptor());
        chain.addInterceptor(new PerformanceInterceptor());
        
        // åˆ›å»ºä¸šåŠ¡å¯¹è±¡
        UserService userService = new UserService();
        
        System.out.println("=== æµ‹è¯•æ­£å¸¸è°ƒç”¨ ===");
        // ä½¿ç”¨æ‹¦æˆªå™¨é“¾æ‰§è¡Œæ–¹æ³•
        Object result = chain.executeMethod("getUserInfo", new Object[]{"123"}, userService, () -> {
            return userService.getUserInfo("123");
        });
        System.out.println("æœ€ç»ˆç»“æœï¼š" + result);
        
        System.out.println("\n=== æµ‹è¯•å‚æ•°æ ¡éªŒå¤±è´¥ ===");
        // æµ‹è¯•å‚æ•°æ ¡éªŒå¤±è´¥çš„æƒ…å†µ
        chain.executeMethod("getUserInfo", new Object[]{null}, userService, () -> {
            return userService.getUserInfo(null);
        });
    }
}
```

**ğŸ¯ æ‹¦æˆªå™¨é“¾çš„å®é™…ä»·å€¼**ï¼š
- **æ¨ªåˆ‡å…³æ³¨ç‚¹**ï¼šå°†é€šç”¨åŠŸèƒ½ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥
- **ä»£ç å¤ç”¨**ï¼šåŒä¸€ä¸ªæ‹¦æˆªå™¨å¯ä»¥åº”ç”¨åˆ°å¤šä¸ªæ–¹æ³•ä¸Š
- **çµæ´»é…ç½®**ï¼šå¯ä»¥åŠ¨æ€æ·»åŠ æˆ–ç§»é™¤æ‹¦æˆªå™¨

---

## 7. ğŸ¯ å®é™…åº”ç”¨æœ€ä½³å®è·µ


### 7.1 è®¾è®¡åŸåˆ™å’Œæ³¨æ„äº‹é¡¹


**ğŸ“‹ è®¾è®¡æœ€ä½³å®è·µ**ï¼š

| åŸåˆ™ | è¯´æ˜ | å®é™…åº”ç”¨ |
|------|------|---------|
| **å•ä¸€èŒè´£** | æ¯ä¸ªå¤„ç†è€…åªè´Ÿè´£ä¸€ä»¶äº‹ | è®¤è¯æ‹¦æˆªå™¨åªç®¡è®¤è¯ï¼Œä¸ç®¡æƒé™ |
| **å¼€é—­åŸåˆ™** | å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ | æ–°å¢å¤„ç†è€…ä¸å½±å“ç°æœ‰ä»£ç  |
| **é¡ºåºé‡è¦** | å¤„ç†è€…çš„é¡ºåºå½±å“ç»“æœ | å…ˆè®¤è¯å†æˆæƒï¼Œå…ˆæ ¡éªŒå†å¤„ç† |
| **å¼‚å¸¸å¤„ç†** | è€ƒè™‘é“¾æ¡ä¸­æ–­çš„æƒ…å†µ | æŸä¸ªç¯èŠ‚å¤±è´¥åçš„å¤„ç†ç­–ç•¥ |

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š

```java
// âœ… å¥½çš„åšæ³•ï¼šç¼“å­˜å¤„ç†é“¾
public class OptimizedChain {
    private static final Map<String, List<Handler>> CHAIN_CACHE = new ConcurrentHashMap<>();
    
    public List<Handler> getChain(String type) {
        return CHAIN_CACHE.computeIfAbsent(type, this::buildChain);
    }
}

// âœ… å¥½çš„åšæ³•ï¼šé¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º
public class EfficientHandler {
    private static final ThreadLocal<StringBuilder> BUFFER = ThreadLocal.withInitial(StringBuilder::new);
    
    protected String formatMessage(String template, Object... args) {
        StringBuilder sb = BUFFER.get();
        sb.setLength(0); // é‡ç”¨StringBuilder
        return sb.append(String.format(template, args)).toString();
    }
}
```

### 7.3 å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ


**ğŸ”§ å¸¸è§é—®é¢˜å¤„ç†**ï¼š

```java
// é—®é¢˜1ï¼šé“¾æ¡è¿‡é•¿å¯¼è‡´æ€§èƒ½é—®é¢˜
// è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®æœ€å¤§å¤„ç†æ·±åº¦
public abstract class SafeHandler {
    private static final int MAX_DEPTH = 10;
    private int depth = 0;
    
    protected void checkDepth() {
        if (++depth > MAX_DEPTH) {
            throw new RuntimeException("å¤„ç†é“¾æ·±åº¦è¶…è¿‡é™åˆ¶");
        }
    }
}

// é—®é¢˜2ï¼šå¾ªç¯å¼•ç”¨å¯¼è‡´æ­»å¾ªç¯
// è§£å†³æ–¹æ¡ˆï¼šè®°å½•è®¿é—®è¿‡çš„å¤„ç†è€…
public class CircularSafeChain {
    private Set<Handler> visitedHandlers = new HashSet<>();
    
    public void process(Request request) {
        if (visitedHandlers.contains(this)) {
            throw new RuntimeException("æ£€æµ‹åˆ°å¾ªç¯å¼•ç”¨");
        }
        visitedHandlers.add(this);
        // å¤„ç†é€»è¾‘
    }
}
```

### 7.4 ä¸å…¶ä»–æ¨¡å¼çš„ç»“åˆä½¿ç”¨


**ğŸ”— æ¨¡å¼ç»„åˆåº”ç”¨**ï¼š

```
èŒè´£é“¾ + ç­–ç•¥æ¨¡å¼ï¼š
æ¯ä¸ªå¤„ç†è€…å†…éƒ¨ä½¿ç”¨ç­–ç•¥æ¨¡å¼é€‰æ‹©å¤„ç†ç®—æ³•

èŒè´£é“¾ + è£…é¥°å™¨æ¨¡å¼ï¼š
ä¸ºå¤„ç†è€…åŠ¨æ€æ·»åŠ é¢å¤–åŠŸèƒ½

èŒè´£é“¾ + è§‚å¯Ÿè€…æ¨¡å¼ï¼š
å¤„ç†å®Œæˆåé€šçŸ¥ç›¸å…³è§‚å¯Ÿè€…

èŒè´£é“¾ + å·¥å‚æ¨¡å¼ï¼š
ä½¿ç”¨å·¥å‚åˆ›å»ºä¸åŒç±»å‹çš„å¤„ç†é“¾
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ èŒè´£é“¾æœ¬è´¨ï¼šå°†è¯·æ±‚çš„å‘é€è€…å’Œå¤„ç†è€…è§£è€¦ï¼Œè®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚
ğŸ”¸ é“¾æ¡æ„å»ºï¼šæ¯ä¸ªå¤„ç†è€…éƒ½æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è€…çš„å¼•ç”¨ï¼Œå½¢æˆé“¾æ¡
ğŸ”¸ å¤„ç†æœºåˆ¶ï¼šæ¯ä¸ªå¤„ç†è€…åˆ¤æ–­è‡ªå·±èƒ½å¦å¤„ç†ï¼Œä¸èƒ½å¤„ç†å°±ä¼ ç»™ä¸‹ä¸€ä¸ª
ğŸ”¸ åº”ç”¨ä»·å€¼ï¼šæé«˜ä»£ç çš„çµæ´»æ€§ã€æ‰©å±•æ€§å’Œç»´æŠ¤æ€§
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šå•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€é¡ºåºé‡è¦æ€§
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨èŒè´£é“¾æ¨¡å¼**ï¼š
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚
âœ… å¤„ç†è€…çš„é¡ºåºå¾ˆé‡è¦
âœ… ä¸æƒ³è®©è¯·æ±‚å‘é€è€…çŸ¥é“å…·ä½“å“ªä¸ªå¤„ç†è€…ä¼šå¤„ç†
âœ… éœ€è¦åŠ¨æ€è°ƒæ•´å¤„ç†æµç¨‹

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ åªæœ‰ä¸€ä¸ªå›ºå®šçš„å¤„ç†è€…
âŒ å¤„ç†é€»è¾‘éå¸¸ç®€å•
âŒ æ€§èƒ½è¦æ±‚æé«˜ï¼ˆé“¾æ¡ä¼šæœ‰ä¸€å®šå¼€é”€ï¼‰
```

**ğŸ”¹ èŒè´£é“¾ä¸if-elseçš„åŒºåˆ«**ï¼š
```
ä¼ ç»Ÿif-elseï¼š
- å¤„ç†é€»è¾‘è€¦åˆåœ¨ä¸€èµ·
- æ–°å¢å¤„ç†ç±»å‹éœ€è¦ä¿®æ”¹ä»£ç 
- éš¾ä»¥åŠ¨æ€è°ƒæ•´å¤„ç†é¡ºåº

èŒè´£é“¾æ¨¡å¼ï¼š
- æ¯ä¸ªå¤„ç†è€…ç‹¬ç«‹å­˜åœ¨
- æ–°å¢å¤„ç†è€…ä¸å½±å“ç°æœ‰ä»£ç 
- å¯ä»¥çµæ´»è°ƒæ•´å¤„ç†é¡ºåº
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ å®æˆ˜åº”ç”¨å»ºè®®**ï¼š

```java
// 1. å®šä¹‰æ¸…æ™°çš„å¤„ç†æ¥å£
public interface RequestHandler {
    boolean canHandle(Request request);
    void handle(Request request);
    void setNext(RequestHandler next);
}

// 2. å»ºè®®çš„æŠ½è±¡åŸºç±»
public abstract class AbstractHandler implements RequestHandler {
    protected RequestHandler next;
    
    @Override
    public void setNext(RequestHandler next) {
        this.next = next;
    }
    
    @Override
    public final void handle(Request request) {
        if (canHandle(request)) {
            doHandle(request);
        } else if (next != null) {
            next.handle(request);
        } else {
            handleDefault(request);
        }
    }
    
    protected abstract void doHandle(Request request);
    protected void handleDefault(Request request) {
        // é»˜è®¤å¤„ç†é€»è¾‘
    }
}
```

### 8.4 è®°å¿†è¦ç‚¹


**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
èŒè´£é“¾æ¡å±‚å±‚ä¼ ï¼Œ
å„å¸å…¶èŒä¸ç›¸å¹²ï¼Œ
èƒ½å¤„ç†æ—¶å°±å‡ºæ‰‹ï¼Œ
ä¸èƒ½å¤„ç†ä¼ ä¸‹ç«™ã€‚

çµæ´»æ‰©å±•æ˜“ç»´æŠ¤ï¼Œ
è§£è€¦å‘é€å’Œå¤„ç†ï¼Œ
Webè¿‡æ»¤å®¡æ‰¹é“¾ï¼Œ
å¼‚å¸¸æ—¥å¿—éƒ½é€‚å®œã€‚
```

**ğŸ¯ æ ¸å¿ƒä»·å€¼**ï¼š
- **è§£è€¦åˆ**ï¼šè¯·æ±‚å‘é€è€…ä¸éœ€è¦çŸ¥é“è°æ¥å¤„ç†
- **æ˜“æ‰©å±•**ï¼šæ–°å¢å¤„ç†è€…ä¸å½±å“ç°æœ‰ä»£ç 
- **çµæ´»æ€§**ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´å¤„ç†æµç¨‹å’Œé¡ºåº
- **å¤ç”¨æ€§**ï¼šå¤„ç†è€…å¯ä»¥åœ¨ä¸åŒçš„é“¾ä¸­é‡å¤ä½¿ç”¨

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- ç¡®ä¿æœ‰å¤„ç†è€…èƒ½å¤Ÿå¤„ç†è¯·æ±‚ï¼Œé¿å…è¯·æ±‚è¢«ä¸¢å¼ƒ
- æ³¨æ„å¤„ç†è€…çš„é¡ºåºï¼Œé¡ºåºä¸å½“å¯èƒ½å¯¼è‡´é”™è¯¯ç»“æœ
- é¿å…é“¾æ¡è¿‡é•¿ï¼Œå½±å“æ€§èƒ½
- è€ƒè™‘å¼‚å¸¸æƒ…å†µçš„å¤„ç†æœºåˆ¶

èŒè´£é“¾æ¨¡å¼æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†**å¤šæ­¥éª¤æµç¨‹**å’Œ**æƒé™æ§åˆ¶**åœºæ™¯ã€‚æŒæ¡å¥½è¿™ä¸ªæ¨¡å¼ï¼Œèƒ½è®©ä½ çš„ä»£ç æ›´åŠ çµæ´»å’Œæ˜“äºç»´æŠ¤ï¼