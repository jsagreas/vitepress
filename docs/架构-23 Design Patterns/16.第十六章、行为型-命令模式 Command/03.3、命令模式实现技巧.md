---
title: 3ã€å‘½ä»¤æ¨¡å¼å®ç°æŠ€å·§
---
## ğŸ“š ç›®å½•


1. [å‘½ä»¤æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µå›é¡¾](#1-å‘½ä»¤æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µå›é¡¾)
2. [å‘½ä»¤å‚æ•°åŒ–æŠ€å·§](#2-å‘½ä»¤å‚æ•°åŒ–æŠ€å·§)
3. [æ’¤é”€æ“ä½œå®ç°](#3-æ’¤é”€æ“ä½œå®ç°)
4. [å‘½ä»¤é˜Ÿåˆ—ç®¡ç†](#4-å‘½ä»¤é˜Ÿåˆ—ç®¡ç†)
5. [å®å‘½ä»¤è®¾è®¡](#5-å®å‘½ä»¤è®¾è®¡)
6. [å‘½ä»¤æŒä¹…åŒ–](#6-å‘½ä»¤æŒä¹…åŒ–)
7. [é«˜çº§å®ç°æŠ€å·§](#7-é«˜çº§å®ç°æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šå‘½ä»¤æ¨¡å¼åŸºç¡€æ¦‚å¿µã€é¢å‘å¯¹è±¡ç¼–ç¨‹ â†’ **å½“å‰å†…å®¹**ï¼šå‘½ä»¤æ¨¡å¼å®ç°æŠ€å·§ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ ç­–ç•¥æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡45åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

ğŸ·ï¸ **çŸ¥è¯†æ ‡ç­¾**ï¼š`#è¡Œä¸ºå‹æ¨¡å¼` `#å‘½ä»¤å°è£…` `#æ’¤é”€é‡åš` `#é˜Ÿåˆ—ç®¡ç†`

---

## 1. ğŸª å‘½ä»¤æ¨¡å¼æ ¸å¿ƒæ¦‚å¿µå›é¡¾



### 1.1 å‘½ä»¤æ¨¡å¼æ˜¯ä»€ä¹ˆ



**ğŸ”¸ ç®€å•ç†è§£**
æƒ³è±¡ä½ åœ¨é¤å…ç‚¹èœï¼š
- **ä¼ ç»Ÿæ–¹å¼**ï¼šä½ ç›´æ¥è·Ÿå¨å¸ˆè¯´"ç»™æˆ‘åšä¸ªçº¢çƒ§è‚‰"
- **å‘½ä»¤æ¨¡å¼**ï¼šä½ å†™ä¸€å¼ ç‚¹èœå•ï¼ŒæœåŠ¡å‘˜æ‹¿ç€å•å­å»å¨æˆ¿

è¿™å¼ **ç‚¹èœå•**å°±æ˜¯å‘½ä»¤æ¨¡å¼ä¸­çš„"å‘½ä»¤"ï¼

**ğŸ’¡ æ ¸å¿ƒæ€æƒ³**
```
å‘½ä»¤æ¨¡å¼ï¼šå°†"è¯·æ±‚"åŒ…è£…æˆä¸€ä¸ªå¯¹è±¡
å¥½å¤„ï¼šå¯ä»¥æ’é˜Ÿã€å¯ä»¥æ’¤é”€ã€å¯ä»¥è®°å½•ã€å¯ä»¥é‡å¤æ‰§è¡Œ
æœ¬è´¨ï¼šæŠŠ"åšä»€ä¹ˆ"å’Œ"è°æ¥åš"åˆ†å¼€
```

### 1.2 å‘½ä»¤æ¨¡å¼çš„è§’è‰²



**ğŸ­ å››ä¸ªå…³é”®è§’è‰²**

| **è§’è‰²** | **æ¯”å–»** | **èŒè´£** | **ä¸¾ä¾‹** |
|---------|---------|---------|---------|
| **Commandå‘½ä»¤** | ç‚¹èœå• | å®šä¹‰è¦åšä»€ä¹ˆ | "åšçº¢çƒ§è‚‰" |
| **ConcreteCommandå…·ä½“å‘½ä»¤** | å…·ä½“çš„èœå• | çŸ¥é“å…·ä½“æ€ä¹ˆåš | çº¢çƒ§è‚‰åˆ¶ä½œå• |
| **Receiveræ¥æ”¶è€…** | å¨å¸ˆ | çœŸæ­£å¹²æ´»çš„äºº | å®é™…åšèœçš„å¨å¸ˆ |
| **Invokerè°ƒç”¨è€…** | æœåŠ¡å‘˜ | è´Ÿè´£æ‰§è¡Œå‘½ä»¤ | æ‹¿å•å­çš„æœåŠ¡å‘˜ |

### 1.3 ä¸ºä»€ä¹ˆè¦ç”¨å®ç°æŠ€å·§



**ğŸ¤” åŸºç¡€å®ç°çš„é™åˆ¶**
```
åŸºç¡€å‘½ä»¤æ¨¡å¼åªèƒ½ï¼š
âœ… æ‰§è¡Œç®€å•æ“ä½œ
âŒ ä¸èƒ½æ’¤é”€
âŒ ä¸èƒ½æ‰¹é‡æ‰§è¡Œ  
âŒ ä¸èƒ½ä¿å­˜å‘½ä»¤
âŒ å‚æ•°å›ºå®šä¸çµæ´»
```

**ğŸš€ é«˜çº§æŠ€å·§çš„ä»·å€¼**
é€šè¿‡å­¦ä¹ å®ç°æŠ€å·§ï¼Œå‘½ä»¤æ¨¡å¼å˜å¾—æ›´å¼ºå¤§ï¼š
- **å‚æ•°åŒ–**ï¼šä¸€ä¸ªå‘½ä»¤æ¨¡æ¿ï¼Œæ”¯æŒä¸åŒå‚æ•°
- **å¯æ’¤é”€**ï¼šåƒCtrl+Zä¸€æ ·æ’¤é”€æ“ä½œ
- **é˜Ÿåˆ—åŒ–**ï¼šæ‰¹é‡æ‰§è¡Œã€å»¶è¿Ÿæ‰§è¡Œ
- **æŒä¹…åŒ–**ï¼šä¿å­˜å‘½ä»¤ï¼Œä¸‹æ¬¡è¿˜èƒ½ç”¨

---

## 2. ğŸ›ï¸ å‘½ä»¤å‚æ•°åŒ–æŠ€å·§



### 2.1 ä»€ä¹ˆæ˜¯å‘½ä»¤å‚æ•°åŒ–



**ğŸ’­ ç”Ÿæ´»ç±»æ¯”**
å°±åƒç”µè§†é¥æ§å™¨ï¼š
- **å›ºå®šå‘½ä»¤**ï¼šåªæœ‰å¼€å…³æœºæŒ‰é’®ï¼ˆåŠŸèƒ½å›ºå®šï¼‰
- **å‚æ•°åŒ–å‘½ä»¤**ï¼šæœ‰éŸ³é‡è°ƒèŠ‚æ—‹é’®ï¼ˆå¯ä»¥è°ƒåˆ°ä»»æ„éŸ³é‡ï¼‰

**ğŸ”¸ å‚æ•°åŒ–çš„å¥½å¤„**
- **ä¸€ä¸ªå‘½ä»¤ç±»**ï¼Œæ”¯æŒå¤šç§å˜åŒ–
- **å‡å°‘ä»£ç é‡å¤**ï¼Œæé«˜å¤ç”¨æ€§
- **è¿è¡Œæ—¶çµæ´»**ï¼ŒåŠ¨æ€è®¾ç½®å‚æ•°

### 2.2 åŸºç¡€å‚æ•°åŒ–å®ç°



**ğŸ“ æ–‡æœ¬ç¼–è¾‘å™¨å‘½ä»¤ç¤ºä¾‹**
```java
// å‚æ•°åŒ–çš„æ–‡æœ¬å‘½ä»¤
public class TextCommand implements Command {
    private TextEditor editor;  // æ¥æ”¶è€…
    private String operation;   // æ“ä½œç±»å‹
    private String content;     // æ“ä½œå†…å®¹
    private int position;       // æ“ä½œä½ç½®
    
    public TextCommand(TextEditor editor, String operation, 
                      String content, int position) {
        this.editor = editor;
        this.operation = operation;
        this.content = content;
        this.position = position;
    }
    
    @Override
    public void execute() {
        switch (operation) {
            case "insert":
                editor.insert(content, position);
                break;
            case "delete":
                editor.delete(position, content.length());
                break;
            case "replace":
                editor.replace(content, position);
                break;
        }
    }
}
```

**ğŸ¯ ä½¿ç”¨ç¤ºä¾‹**
```java
TextEditor editor = new TextEditor();

// åŒä¸€ä¸ªå‘½ä»¤ç±»ï¼Œä¸åŒå‚æ•°
Command insertCmd = new TextCommand(editor, "insert", "Hello", 0);
Command deleteCmd = new TextCommand(editor, "delete", "", 5);
Command replaceCmd = new TextCommand(editor, "replace", "Hi", 0);

// çµæ´»æ‰§è¡Œ
insertCmd.execute();  // æ’å…¥"Hello"
replaceCmd.execute(); // æ›¿æ¢ä¸º"Hi"
```

### 2.3 å»ºé€ è€…æ¨¡å¼å¢å¼ºå‚æ•°åŒ–



**ğŸ—ï¸ å¤æ‚å‚æ•°çš„ä¼˜é›…å¤„ç†**
```java
public class FileCommand implements Command {
    private String filePath;
    private String operation;
    private String content;
    private boolean backup;
    private String encoding;
    
    // ç§æœ‰æ„é€ å‡½æ•°
    private FileCommand(Builder builder) {
        this.filePath = builder.filePath;
        this.operation = builder.operation;
        this.content = builder.content;
        this.backup = builder.backup;
        this.encoding = builder.encoding;
    }
    
    // å»ºé€ è€…ç±»
    public static class Builder {
        private String filePath;    // å¿…éœ€å‚æ•°
        private String operation;   // å¿…éœ€å‚æ•°
        private String content = "";
        private boolean backup = false;
        private String encoding = "UTF-8";
        
        public Builder(String filePath, String operation) {
            this.filePath = filePath;
            this.operation = operation;
        }
        
        public Builder content(String content) {
            this.content = content;
            return this;
        }
        
        public Builder withBackup() {
            this.backup = true;
            return this;
        }
        
        public Builder encoding(String encoding) {
            this.encoding = encoding;
            return this;
        }
        
        public FileCommand build() {
            return new FileCommand(this);
        }
    }
}
```

**âœ¨ ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„å‘½ä»¤**
```java
// å¤æ‚å‘½ä»¤çš„ä¼˜é›…åˆ›å»º
Command writeFile = new FileCommand.Builder("data.txt", "write")
    .content("é‡è¦æ•°æ®")
    .withBackup()
    .encoding("UTF-8")
    .build();

// ç®€å•å‘½ä»¤
Command deleteFile = new FileCommand.Builder("temp.txt", "delete")
    .build();
```

---

## 3. â†©ï¸ æ’¤é”€æ“ä½œå®ç°



### 3.1 æ’¤é”€æ“ä½œçš„æ ¸å¿ƒæ€è·¯



**ğŸ¯ æ’¤é”€çš„æœ¬è´¨**
æ’¤é”€å°±æ˜¯**åšç›¸åçš„æ“ä½œ**ï¼š
- æ’å…¥æ–‡å­— â†” åˆ é™¤æ–‡å­—
- æ‰“å¼€æ–‡ä»¶ â†” å…³é—­æ–‡ä»¶
- å‘å‰ç§»åŠ¨ â†” å‘åç§»åŠ¨

**ğŸ“Š æ’¤é”€å®ç°ç­–ç•¥å¯¹æ¯”**

| **ç­–ç•¥** | **å®ç°æ–¹å¼** | **å†…å­˜æ¶ˆè€—** | **å¤æ‚åº¦** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|-----------|-------------|
| **åå‘æ“ä½œ** | è®°ä½å¦‚ä½•æ’¤é”€ | ä½ | ç®€å• | å¯é€†æ“ä½œ |
| **å¿«ç…§å¤‡ä»½** | ä¿å­˜æ“ä½œå‰çŠ¶æ€ | é«˜ | ç®€å• | å¤æ‚çŠ¶æ€ |
| **å¢é‡è®°å½•** | è®°å½•å˜åŒ–å·®å¼‚ | ä¸­ç­‰ | å¤æ‚ | å¤§æ•°æ®æ“ä½œ |

### 3.2 å¯æ’¤é”€å‘½ä»¤æ¥å£è®¾è®¡



**ğŸª å¢å¼ºçš„å‘½ä»¤æ¥å£**
```java
public interface UndoableCommand extends Command {
    void execute();      // æ‰§è¡Œæ“ä½œ
    void undo();         // æ’¤é”€æ“ä½œ
    boolean canUndo();   // æ˜¯å¦å¯æ’¤é”€
    String getDescription(); // æ“ä½œæè¿°
}
```

### 3.3 æ–‡æœ¬ç¼–è¾‘çš„æ’¤é”€å®ç°



**ğŸ“ æ–‡æœ¬æ’å…¥å‘½ä»¤çš„æ’¤é”€**
```java
public class InsertTextCommand implements UndoableCommand {
    private TextEditor editor;
    private String text;
    private int position;
    
    public InsertTextCommand(TextEditor editor, String text, int position) {
        this.editor = editor;
        this.text = text;
        this.position = position;
    }
    
    @Override
    public void execute() {
        editor.insert(text, position);
    }
    
    @Override
    public void undo() {
        // æ’¤é”€æ’å…¥ = åˆ é™¤åˆšæ’å…¥çš„æ–‡å­—
        editor.delete(position, text.length());
    }
    
    @Override
    public boolean canUndo() {
        return true;  // æ’å…¥æ“ä½œæ€»æ˜¯å¯ä»¥æ’¤é”€çš„
    }
    
    @Override
    public String getDescription() {
        return "æ’å…¥æ–‡å­—: \"" + text + "\" åœ¨ä½ç½® " + position;
    }
}
```

### 3.4 å¤æ‚æ“ä½œçš„å¿«ç…§æ’¤é”€



**ğŸ“¸ çŠ¶æ€å¿«ç…§æ–¹å¼**
```java
public class FormatTextCommand implements UndoableCommand {
    private TextEditor editor;
    private int startPos;
    private int endPos;
    private String newStyle;
    private String oldContent;  // ä¿å­˜åŸå§‹çŠ¶æ€
    
    @Override
    public void execute() {
        // æ‰§è¡Œå‰ä¿å­˜å¿«ç…§
        oldContent = editor.getContent(startPos, endPos);
        
        // æ‰§è¡Œæ ¼å¼åŒ–
        editor.applyFormat(startPos, endPos, newStyle);
    }
    
    @Override
    public void undo() {
        // æ¢å¤åŸå§‹çŠ¶æ€
        editor.replaceContent(startPos, endPos, oldContent);
    }
}
```

### 3.5 æ’¤é”€å†å²ç®¡ç†



**ğŸ“š æ’¤é”€æ ˆçš„å®ç°**
```java
public class CommandHistory {
    private Stack<UndoableCommand> undoStack = new Stack<>();
    private Stack<UndoableCommand> redoStack = new Stack<>();
    private int maxHistorySize = 50;  // æœ€å¤§å†å²è®°å½•
    
    public void executeCommand(UndoableCommand command) {
        // æ‰§è¡Œå‘½ä»¤
        command.execute();
        
        // åŠ å…¥æ’¤é”€æ ˆ
        undoStack.push(command);
        
        // æ¸…ç©ºé‡åšæ ˆï¼ˆæ–°æ“ä½œä¼šè®©é‡åšå¤±æ•ˆï¼‰
        redoStack.clear();
        
        // é™åˆ¶å†å²è®°å½•å¤§å°
        if (undoStack.size() > maxHistorySize) {
            undoStack.remove(0);  // ç§»é™¤æœ€æ—§çš„è®°å½•
        }
    }
    
    public boolean undo() {
        if (undoStack.isEmpty()) {
            return false;
        }
        
        UndoableCommand command = undoStack.pop();
        command.undo();
        redoStack.push(command);  // å¯ä»¥é‡åš
        return true;
    }
    
    public boolean redo() {
        if (redoStack.isEmpty()) {
            return false;
        }
        
        UndoableCommand command = redoStack.pop();
        command.execute();
        undoStack.push(command);  // é‡æ–°åŠ å…¥æ’¤é”€æ ˆ
        return true;
    }
}
```

---

## 4. ğŸ“‹ å‘½ä»¤é˜Ÿåˆ—ç®¡ç†



### 4.1 å‘½ä»¤é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯



**ğŸ¯ é˜Ÿåˆ—çš„å…¸å‹ç”¨é€”**
- **æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡æ‰§è¡Œå¤šä¸ªæ–‡ä»¶æ“ä½œ
- **å»¶è¿Ÿæ‰§è¡Œ**ï¼šå®šæ—¶ä»»åŠ¡ã€å¼‚æ­¥å¤„ç†
- **ä¼˜å…ˆçº§è°ƒåº¦**ï¼šé‡è¦ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œ
- **è´Ÿè½½æ§åˆ¶**ï¼šé¿å…ç³»ç»Ÿè¿‡è½½

### 4.2 åŸºç¡€å‘½ä»¤é˜Ÿåˆ—å®ç°



**ğŸ“¦ ç®€å•çš„FIFOé˜Ÿåˆ—**
```java
public class CommandQueue {
    private Queue<Command> commandQueue = new LinkedList<>();
    private boolean isProcessing = false;
    
    public void addCommand(Command command) {
        commandQueue.offer(command);
        processNext();  // å°è¯•å¤„ç†ä¸‹ä¸€ä¸ªå‘½ä»¤
    }
    
    public void processNext() {
        if (isProcessing || commandQueue.isEmpty()) {
            return;
        }
        
        isProcessing = true;
        Command command = commandQueue.poll();
        
        try {
            command.execute();
        } catch (Exception e) {
            System.err.println("å‘½ä»¤æ‰§è¡Œå¤±è´¥: " + e.getMessage());
        } finally {
            isProcessing = false;
            // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå‘½ä»¤
            if (!commandQueue.isEmpty()) {
                processNext();
            }
        }
    }
}
```

### 4.3 å¸¦ä¼˜å…ˆçº§çš„å‘½ä»¤é˜Ÿåˆ—



**â­ ä¼˜å…ˆçº§é˜Ÿåˆ—è®¾è®¡**
```java
public class PriorityCommand implements Comparable<PriorityCommand> {
    private Command command;
    private int priority;  // æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    private long timestamp; // åŒä¼˜å…ˆçº§æŒ‰æ—¶é—´æ’åº
    
    public PriorityCommand(Command command, int priority) {
        this.command = command;
        this.priority = priority;
        this.timestamp = System.currentTimeMillis();
    }
    
    @Override
    public int compareTo(PriorityCommand other) {
        // å…ˆæ¯”è¾ƒä¼˜å…ˆçº§
        int result = Integer.compare(this.priority, other.priority);
        if (result == 0) {
            // ä¼˜å…ˆçº§ç›¸åŒï¼Œæ¯”è¾ƒæ—¶é—´æˆ³
            result = Long.compare(this.timestamp, other.timestamp);
        }
        return result;
    }
    
    public void execute() {
        command.execute();
    }
}

public class PriorityCommandQueue {
    private PriorityQueue<PriorityCommand> queue = new PriorityQueue<>();
    
    public void addHighPriorityCommand(Command command) {
        queue.offer(new PriorityCommand(command, 1));  // é«˜ä¼˜å…ˆçº§
    }
    
    public void addNormalCommand(Command command) {
        queue.offer(new PriorityCommand(command, 5));  // æ™®é€šä¼˜å…ˆçº§
    }
    
    public void addLowPriorityCommand(Command command) {
        queue.offer(new PriorityCommand(command, 10)); // ä½ä¼˜å…ˆçº§
    }
}
```

### 4.4 å¼‚æ­¥å‘½ä»¤æ‰§è¡Œå™¨



**ğŸ”„ å¤šçº¿ç¨‹å‘½ä»¤å¤„ç†**
```java
public class AsyncCommandExecutor {
    private ExecutorService executor;
    private BlockingQueue<Command> commandQueue;
    
    public AsyncCommandExecutor(int threadCount) {
        this.executor = Executors.newFixedThreadPool(threadCount);
        this.commandQueue = new LinkedBlockingQueue<>();
        
        // å¯åŠ¨å‘½ä»¤å¤„ç†çº¿ç¨‹
        startProcessingThread();
    }
    
    public void submitCommand(Command command) {
        try {
            commandQueue.put(command);  // é˜»å¡å¼æ·»åŠ 
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    private void startProcessingThread() {
        executor.submit(() -> {
            while (!Thread.currentThread().isInterrupted()) {
                try {
                    Command command = commandQueue.take();  // é˜»å¡å¼è·å–
                    executor.submit(command::execute);       // å¼‚æ­¥æ‰§è¡Œ
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    break;
                }
            }
        });
    }
}
```

---

## 5. ğŸ¨ å®å‘½ä»¤è®¾è®¡



### 5.1 å®å‘½ä»¤çš„æ¦‚å¿µ



**ğŸ’¡ å®å‘½ä»¤æ˜¯ä»€ä¹ˆ**
å®å‘½ä»¤å°±åƒ**æ’­æ”¾åˆ—è¡¨**ï¼š
- **å•ä¸ªå‘½ä»¤**ï¼šæ’­æ”¾ä¸€é¦–æ­Œ
- **å®å‘½ä»¤**ï¼šæ’­æ”¾æ•´ä¸ªä¸“è¾‘ï¼ˆåŒ…å«å¤šé¦–æ­Œï¼‰

**ğŸ¯ å®å‘½ä»¤çš„ä»·å€¼**
- **æ‰¹é‡æ“ä½œ**ï¼šä¸€æ¬¡æ‰§è¡Œå¤šä¸ªç›¸å…³å‘½ä»¤
- **äº‹åŠ¡æ€§**ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ’¤é”€
- **å¤åˆåŠŸèƒ½**ï¼šå°†å¤æ‚åŠŸèƒ½åˆ†è§£ä¸ºç®€å•å‘½ä»¤ç»„åˆ

### 5.2 åŸºç¡€å®å‘½ä»¤å®ç°



**ğŸ“¦ ç»„åˆæ¨¡å¼å®ç°å®å‘½ä»¤**
```java
public class MacroCommand implements UndoableCommand {
    private List<UndoableCommand> commands = new ArrayList<>();
    private String description;
    
    public MacroCommand(String description) {
        this.description = description;
    }
    
    public void addCommand(UndoableCommand command) {
        commands.add(command);
    }
    
    @Override
    public void execute() {
        for (UndoableCommand command : commands) {
            command.execute();
        }
    }
    
    @Override
    public void undo() {
        // å€’åºæ’¤é”€ï¼ˆå…ˆæ‰§è¡Œçš„åæ’¤é”€ï¼‰
        for (int i = commands.size() - 1; i >= 0; i--) {
            commands.get(i).undo();
        }
    }
    
    @Override
    public String getDescription() {
        return description + " (åŒ…å« " + commands.size() + " ä¸ªå‘½ä»¤)";
    }
}
```

### 5.3 äº‹åŠ¡æ€§å®å‘½ä»¤



**ğŸ”’ æ”¯æŒå›æ»šçš„äº‹åŠ¡å®å‘½ä»¤**
```java
public class TransactionalMacroCommand implements UndoableCommand {
    private List<UndoableCommand> commands = new ArrayList<>();
    private List<UndoableCommand> executedCommands = new ArrayList<>();
    private String description;
    
    @Override
    public void execute() {
        executedCommands.clear();
        
        try {
            for (UndoableCommand command : commands) {
                command.execute();
                executedCommands.add(command);  // è®°å½•å·²æ‰§è¡Œçš„å‘½ä»¤
            }
        } catch (Exception e) {
            // å¦‚æœä»»ä½•å‘½ä»¤å¤±è´¥ï¼Œå›æ»šå·²æ‰§è¡Œçš„å‘½ä»¤
            rollback();
            throw new RuntimeException("å®å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå·²å›æ»š", e);
        }
    }
    
    private void rollback() {
        // å€’åºæ’¤é”€å·²æ‰§è¡Œçš„å‘½ä»¤
        for (int i = executedCommands.size() - 1; i >= 0; i--) {
            try {
                executedCommands.get(i).undo();
            } catch (Exception e) {
                System.err.println("å›æ»šå‘½ä»¤å¤±è´¥: " + e.getMessage());
            }
        }
        executedCommands.clear();
    }
}
```

### 5.4 æ¡ä»¶å®å‘½ä»¤



**ğŸ² æ”¯æŒæ¡ä»¶æ‰§è¡Œçš„å®å‘½ä»¤**
```java
public class ConditionalMacroCommand implements UndoableCommand {
    
    private static class ConditionalStep {
        Predicate<Object> condition;  // æ‰§è¡Œæ¡ä»¶
        UndoableCommand command;      // è¦æ‰§è¡Œçš„å‘½ä»¤
        boolean wasExecuted = false;  // æ˜¯å¦è¢«æ‰§è¡Œäº†
        
        ConditionalStep(Predicate<Object> condition, UndoableCommand command) {
            this.condition = condition;
            this.command = command;
        }
    }
    
    private List<ConditionalStep> steps = new ArrayList<>();
    private Object context;  // æ¡ä»¶åˆ¤æ–­çš„ä¸Šä¸‹æ–‡
    
    public void addConditionalCommand(Predicate<Object> condition, 
                                    UndoableCommand command) {
        steps.add(new ConditionalStep(condition, command));
    }
    
    @Override
    public void execute() {
        for (ConditionalStep step : steps) {
            if (step.condition.test(context)) {
                step.command.execute();
                step.wasExecuted = true;
            }
        }
    }
    
    @Override
    public void undo() {
        // åªæ’¤é”€å®é™…æ‰§è¡Œè¿‡çš„å‘½ä»¤
        for (int i = steps.size() - 1; i >= 0; i--) {
            ConditionalStep step = steps.get(i);
            if (step.wasExecuted) {
                step.command.undo();
                step.wasExecuted = false;
            }
        }
    }
}
```

---

## 6. ğŸ’¾ å‘½ä»¤æŒä¹…åŒ–



### 6.1 å‘½ä»¤æŒä¹…åŒ–çš„ä»·å€¼



**ğŸ’­ ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–å‘½ä»¤**
æƒ³è±¡ä½ çš„æ‰‹æœºçªç„¶å…³æœºï¼š
- **æ²¡æœ‰æŒä¹…åŒ–**ï¼šæ­£åœ¨ç¼–è¾‘çš„æ–‡æ¡£å…¨éƒ¨ä¸¢å¤±
- **æœ‰æŒä¹…åŒ–**ï¼šé‡å¯åå¯ä»¥æ¢å¤ä¹‹å‰çš„æ“ä½œ

**ğŸ¯ æŒä¹…åŒ–çš„åº”ç”¨åœºæ™¯**
- **å´©æºƒæ¢å¤**ï¼šç³»ç»Ÿå¼‚å¸¸åæ¢å¤æ“ä½œå†å²
- **æ“ä½œé‡æ”¾**ï¼šé‡å¤æ‰§è¡Œä¹‹å‰çš„æ“ä½œåºåˆ—
- **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ
- **è¿œç¨‹åŒæ­¥**ï¼šåœ¨ä¸åŒè®¾å¤‡é—´åŒæ­¥æ“ä½œ

### 6.2 å¯åºåˆ—åŒ–å‘½ä»¤è®¾è®¡



**ğŸ“ å‘½ä»¤åºåˆ—åŒ–æ¥å£**
```java
public interface SerializableCommand extends UndoableCommand, Serializable {
    // è·å–å‘½ä»¤çš„å”¯ä¸€æ ‡è¯†
    String getCommandId();
    
    // è·å–å‘½ä»¤å‚æ•°
    Map<String, Object> getParameters();
    
    // ä»å‚æ•°é‡å»ºå‘½ä»¤
    static SerializableCommand fromParameters(String commandId, 
                                            Map<String, Object> parameters);
}
```

**ğŸ“¦ æ–‡ä»¶æ“ä½œå‘½ä»¤ç¤ºä¾‹**
```java
public class FileOperationCommand implements SerializableCommand {
    private static final long serialVersionUID = 1L;
    
    private String operation;  // "create", "delete", "modify"
    private String filePath;
    private String content;
    private String originalContent;  // ç”¨äºæ’¤é”€
    
    @Override
    public String getCommandId() {
        return "FileOperation";
    }
    
    @Override
    public Map<String, Object> getParameters() {
        Map<String, Object> params = new HashMap<>();
        params.put("operation", operation);
        params.put("filePath", filePath);
        params.put("content", content);
        return params;
    }
    
    @Override
    public void execute() {
        switch (operation) {
            case "create":
                // ä¿å­˜åŸå§‹çŠ¶æ€ç”¨äºæ’¤é”€
                originalContent = readFileIfExists(filePath);
                writeFile(filePath, content);
                break;
            // å…¶ä»–æ“ä½œ...
        }
    }
}
```

### 6.3 å‘½ä»¤å­˜å‚¨ç®¡ç†å™¨



**ğŸ—„ï¸ å‘½ä»¤æŒä¹…åŒ–ç®¡ç†å™¨**
```java
public class CommandPersistenceManager {
    private String storageDirectory;
    
    public CommandPersistenceManager(String storageDirectory) {
        this.storageDirectory = storageDirectory;
        ensureDirectoryExists();
    }
    
    public void saveCommand(SerializableCommand command) {
        String fileName = generateFileName(command);
        String filePath = storageDirectory + "/" + fileName;
        
        try (ObjectOutputStream oos = new ObjectOutputStream(
                new FileOutputStream(filePath))) {
            oos.writeObject(command);
        } catch (IOException e) {
            throw new RuntimeException("ä¿å­˜å‘½ä»¤å¤±è´¥", e);
        }
    }
    
    public void saveCommandHistory(List<SerializableCommand> commands) {
        String fileName = "command_history_" + System.currentTimeMillis() + ".dat";
        String filePath = storageDirectory + "/" + fileName;
        
        try (ObjectOutputStream oos = new ObjectOutputStream(
                new FileOutputStream(filePath))) {
            oos.writeObject(commands);
        } catch (IOException e) {
            throw new RuntimeException("ä¿å­˜å‘½ä»¤å†å²å¤±è´¥", e);
        }
    }
    
    @SuppressWarnings("unchecked")
    public List<SerializableCommand> loadCommandHistory(String fileName) {
        String filePath = storageDirectory + "/" + fileName;
        
        try (ObjectInputStream ois = new ObjectInputStream(
                new FileInputStream(filePath))) {
            return (List<SerializableCommand>) ois.readObject();
        } catch (IOException | ClassNotFoundException e) {
            throw new RuntimeException("åŠ è½½å‘½ä»¤å†å²å¤±è´¥", e);
        }
    }
}
```

### 6.4 JSONæ ¼å¼æŒä¹…åŒ–



**ğŸ“„ è½»é‡çº§JSONæŒä¹…åŒ–**
```java
public class JsonCommandPersistence {
    private Gson gson = new Gson();
    
    public void saveCommandAsJson(SerializableCommand command, String filePath) {
        CommandData data = new CommandData();
        data.commandId = command.getCommandId();
        data.parameters = command.getParameters();
        data.timestamp = System.currentTimeMillis();
        
        try (FileWriter writer = new FileWriter(filePath)) {
            gson.toJson(data, writer);
        } catch (IOException e) {
            throw new RuntimeException("ä¿å­˜JSONå‘½ä»¤å¤±è´¥", e);
        }
    }
    
    public SerializableCommand loadCommandFromJson(String filePath) {
        try (FileReader reader = new FileReader(filePath)) {
            CommandData data = gson.fromJson(reader, CommandData.class);
            return SerializableCommand.fromParameters(data.commandId, data.parameters);
        } catch (IOException e) {
            throw new RuntimeException("åŠ è½½JSONå‘½ä»¤å¤±è´¥", e);
        }
    }
    
    private static class CommandData {
        String commandId;
        Map<String, Object> parameters;
        long timestamp;
    }
}
```

---

## 7. ğŸš€ é«˜çº§å®ç°æŠ€å·§



### 7.1 å‘½ä»¤æ¨¡å¼ä¸è§‚å¯Ÿè€…æ¨¡å¼ç»“åˆ



**ğŸ“¡ å‘½ä»¤æ‰§è¡ŒçŠ¶æ€é€šçŸ¥**
```java
public interface CommandObserver {
    void onCommandExecuting(Command command);
    void onCommandExecuted(Command command);
    void onCommandFailed(Command command, Exception error);
}

public class ObservableCommand implements Command {
    private Command wrappedCommand;
    private List<CommandObserver> observers = new ArrayList<>();
    
    public void addObserver(CommandObserver observer) {
        observers.add(observer);
    }
    
    @Override
    public void execute() {
        notifyExecuting();
        try {
            wrappedCommand.execute();
            notifyExecuted();
        } catch (Exception e) {
            notifyFailed(e);
            throw e;
        }
    }
    
    private void notifyExecuting() {
        observers.forEach(observer -> observer.onCommandExecuting(this));
    }
}
```

### 7.2 å‘½ä»¤ç¼“å­˜ä¸å¤ç”¨



**ğŸ”„ æ™ºèƒ½å‘½ä»¤ç¼“å­˜**
```java
public class CommandCache {
    private Map<String, Command> cache = new ConcurrentHashMap<>();
    private int maxCacheSize = 100;
    
    public Command getOrCreateCommand(String key, Supplier<Command> factory) {
        return cache.computeIfAbsent(key, k -> {
            // æ£€æŸ¥ç¼“å­˜å¤§å°
            if (cache.size() >= maxCacheSize) {
                clearOldestEntries();
            }
            return factory.get();
        });
    }
    
    private void clearOldestEntries() {
        // ç®€å•å®ç°ï¼šæ¸…é™¤ä¸€åŠç¼“å­˜
        int toRemove = maxCacheSize / 2;
        cache.entrySet().stream()
            .limit(toRemove)
            .map(Map.Entry::getKey)
            .forEach(cache::remove);
    }
}
```

### 7.3 å‘½ä»¤æ‰§è¡Œæ—¶é—´ç›‘æ§



**â±ï¸ æ€§èƒ½ç›‘æ§è£…é¥°å™¨**
```java
public class TimedCommand implements Command {
    private Command command;
    private String commandName;
    
    public TimedCommand(Command command, String commandName) {
        this.command = command;
        this.commandName = commandName;
    }
    
    @Override
    public void execute() {
        long startTime = System.currentTimeMillis();
        
        try {
            command.execute();
        } finally {
            long endTime = System.currentTimeMillis();
            long duration = endTime - startTime;
            
            logExecutionTime(commandName, duration);
            
            if (duration > 5000) {  // è¶…è¿‡5ç§’çš„å‘½ä»¤
                System.out.println("âš ï¸ æ…¢å‘½ä»¤è­¦å‘Š: " + commandName + 
                                 " è€—æ—¶ " + duration + "ms");
            }
        }
    }
    
    private void logExecutionTime(String name, long duration) {
        System.out.println("ğŸ“Š å‘½ä»¤æ‰§è¡Œ: " + name + " è€—æ—¶ " + duration + "ms");
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ å‘½ä»¤å‚æ•°åŒ–ï¼šä¸€ä¸ªå‘½ä»¤ç±»æ”¯æŒå¤šç§å‚æ•°ï¼Œæé«˜å¤ç”¨æ€§
ğŸ”¸ æ’¤é”€æœºåˆ¶ï¼šé€šè¿‡åå‘æ“ä½œæˆ–çŠ¶æ€å¿«ç…§å®ç°Ctrl+ZåŠŸèƒ½
ğŸ”¸ å‘½ä»¤é˜Ÿåˆ—ï¼šæ‰¹é‡å¤„ç†ã€å¼‚æ­¥æ‰§è¡Œã€ä¼˜å…ˆçº§è°ƒåº¦
ğŸ”¸ å®å‘½ä»¤ï¼šå°†å¤šä¸ªå‘½ä»¤ç»„åˆæˆå¤æ‚æ“ä½œ
ğŸ”¸ å‘½ä»¤æŒä¹…åŒ–ï¼šä¿å­˜å‘½ä»¤åˆ°æ–‡ä»¶ï¼Œæ”¯æŒæ¢å¤å’Œé‡æ”¾
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ç”¨è¿™äº›æŠ€å·§**
```
å‚æ•°åŒ–ï¼šå½“å‘½ä»¤é€»è¾‘ç›¸ä¼¼ä½†å‚æ•°ä¸åŒæ—¶
æ’¤é”€ï¼šéœ€è¦"åæ‚”è¯"åŠŸèƒ½çš„åº”ç”¨
é˜Ÿåˆ—ï¼šæ‰¹é‡å¤„ç†æˆ–å¼‚æ­¥æ‰§è¡Œåœºæ™¯
å®å‘½ä»¤ï¼šå¤æ‚æ“ä½œéœ€è¦åŸå­æ€§æ‰§è¡Œ
æŒä¹…åŒ–ï¼šéœ€è¦æ“ä½œå†å²è®°å½•çš„ç³»ç»Ÿ
```

**ğŸ”¹ æŠ€å·§é€‰æ‹©çš„æƒè¡¡**
- **ç®€å•åœºæ™¯**ï¼šåŸºç¡€å‘½ä»¤æ¨¡å¼å°±å¤Ÿäº†
- **éœ€è¦æ’¤é”€**ï¼šå¢åŠ æ’¤é”€æ¥å£å’Œå†å²ç®¡ç†
- **æ‰¹é‡æ“ä½œ**ï¼šä½¿ç”¨é˜Ÿåˆ—å’Œå®å‘½ä»¤
- **é«˜å¯é æ€§**ï¼šæ·»åŠ æŒä¹…åŒ–æœºåˆ¶

### 8.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**
- **æ–‡æœ¬ç¼–è¾‘å™¨**ï¼šæ’¤é”€é‡åšã€å®å½•åˆ¶ã€æ‰¹é‡æ“ä½œ
- **å›¾å½¢è½¯ä»¶**ï¼šæ“ä½œå†å²ã€æ‰¹é‡å˜æ¢ã€è„šæœ¬å½•åˆ¶
- **æ•°æ®åº“å·¥å…·**ï¼šäº‹åŠ¡ç®¡ç†ã€SQLè„šæœ¬ã€å¤‡ä»½æ¢å¤
- **æ¸¸æˆå¼€å‘**ï¼šæŠ€èƒ½ç³»ç»Ÿã€å›æ”¾åŠŸèƒ½ã€AIè¡Œä¸º

**ğŸ› ï¸ å¼€å‘å®è·µå»ºè®®**
```
è®¾è®¡åŸåˆ™ï¼š
- ä¿æŒå‘½ä»¤æ¥å£ç®€å•
- ä¼˜å…ˆä½¿ç”¨åå‘æ“ä½œå®ç°æ’¤é”€
- åˆç†æ§åˆ¶å†…å­˜ä½¿ç”¨ï¼ˆå†å²è®°å½•æ•°é‡ï¼‰
- å¼‚å¸¸å¤„ç†è¦å®Œå–„

æ€§èƒ½è€ƒè™‘ï¼š
- å¤§å¯¹è±¡ä½¿ç”¨å¿«ç…§æ—¶è¦æ³¨æ„å†…å­˜
- å‘½ä»¤é˜Ÿåˆ—è¦æœ‰æµæ§æœºåˆ¶
- æŒä¹…åŒ–è¦è€ƒè™‘ç£ç›˜ç©ºé—´
- é€‚å½“ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤åˆ›å»º
```

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



- [ ] ç†è§£å‘½ä»¤å‚æ•°åŒ–çš„ä»·å€¼å’Œå®ç°æ–¹å¼
- [ ] æŒæ¡æ’¤é”€æ“ä½œçš„ä¸¤ç§ç­–ç•¥ï¼ˆåå‘æ“ä½œvså¿«ç…§ï¼‰
- [ ] ä¼šå®ç°åŸºæœ¬çš„å‘½ä»¤é˜Ÿåˆ—å’Œä¼˜å…ˆçº§é˜Ÿåˆ—
- [ ] äº†è§£å®å‘½ä»¤çš„ç»„åˆæ¨¡å¼å®ç°
- [ ] çŸ¥é“å‘½ä»¤æŒä¹…åŒ–çš„åŸºæœ¬æ–¹æ³•
- [ ] èƒ½å¤Ÿé€‰æ‹©åˆé€‚çš„æŠ€å·§è§£å†³å®é™…é—®é¢˜

**ğŸ”‘ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
> å‚æ•°åŒ–è®©å‘½ä»¤æ›´çµæ´»ï¼Œæ’¤é”€è®©ç”¨æˆ·æ›´å®‰å¿ƒ
> é˜Ÿåˆ—è®©å¤„ç†æ›´æœ‰åºï¼Œå®å‘½ä»¤è®©æ“ä½œæ›´ç®€å•
> æŒä¹…åŒ–è®©æ•°æ®æ›´å®‰å…¨ï¼ŒæŠ€å·§ç»„åˆè®©åŠŸèƒ½æ›´å¼ºå¤§

**ğŸ’¡ å»¶ä¼¸å­¦ä¹ å»ºè®®**
- ç»“åˆå®é™…é¡¹ç›®ç»ƒä¹ å„ç§æŠ€å·§
- å­¦ä¹ å…¶ä»–è¡Œä¸ºå‹æ¨¡å¼çš„ç»„åˆä½¿ç”¨
- ç ”ç©¶æˆç†Ÿè½¯ä»¶ä¸­å‘½ä»¤æ¨¡å¼çš„åº”ç”¨
- å…³æ³¨æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†æŠ€å·§