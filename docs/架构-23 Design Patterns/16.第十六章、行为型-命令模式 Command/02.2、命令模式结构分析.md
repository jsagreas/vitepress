---
title: 2ã€å‘½ä»¤æ¨¡å¼ç»“æ„åˆ†æ
---
## ğŸ“š ç›®å½•

1. [å‘½ä»¤æ¨¡å¼æ˜¯ä»€ä¹ˆ](#1-å‘½ä»¤æ¨¡å¼æ˜¯ä»€ä¹ˆ)
2. [ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼](#2-ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼)
3. [å‘½ä»¤æ¨¡å¼ç»“æ„åˆ†æ](#3-å‘½ä»¤æ¨¡å¼ç»“æ„åˆ†æ)
4. [å‘½ä»¤æ¨¡å¼å®ç°è¯¦è§£](#4-å‘½ä»¤æ¨¡å¼å®ç°è¯¦è§£)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [å‘½ä»¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹](#6-å‘½ä»¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å‘½ä»¤æ¨¡å¼æ˜¯ä»€ä¹ˆ


### 1.1 ç”Ÿæ´»ä¸­çš„å‘½ä»¤æ¨¡å¼


æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤çš„åœºæ™¯ï¼š

```
ç°å®ç”Ÿæ´»ä¸­çš„"å‘½ä»¤"ï¼š
é¡¾å®¢ â†’ ä¸‹å•ç»™æœåŠ¡å‘˜ â†’ æœåŠ¡å‘˜æŠŠå•å­äº¤ç»™å¨å¸ˆ â†’ å¨å¸ˆåšèœ

è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼š
â€¢ é¡¾å®¢ï¼šä¸éœ€è¦çŸ¥é“å¨å¸ˆæ˜¯è°ï¼Œæ€ä¹ˆåšèœ
â€¢ æœåŠ¡å‘˜ï¼šåªè´Ÿè´£ä¼ é€’è®¢å•ï¼Œä¸åšå…·ä½“å·¥ä½œ  
â€¢ å¨å¸ˆï¼šåªæ ¹æ®è®¢å•å†…å®¹æ¥æ‰§è¡Œ
â€¢ è®¢å•ï¼šåŒ…å«äº†"åšä»€ä¹ˆèœ"çš„å®Œæ•´ä¿¡æ¯
```

### 1.2 å‘½ä»¤æ¨¡å¼çš„æœ¬è´¨å®šä¹‰


> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šå‘½ä»¤æ¨¡å¼å°±æ˜¯æŠŠ"è¯·æ±‚"åŒ…è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œå„ç§æ“ä½œ

**ğŸ”¸ æ­£å¼å®šä¹‰**ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚

**ğŸ”¸ å¤§ç™½è¯è§£é‡Š**ï¼š
- æŠŠ"åšä»€ä¹ˆäº‹"å˜æˆä¸€ä¸ªå…·ä½“çš„å¯¹è±¡
- è°å‘å‡ºå‘½ä»¤å’Œè°æ‰§è¡Œå‘½ä»¤å®Œå…¨åˆ†å¼€
- å‘½ä»¤å¯ä»¥ä¿å­˜ã€ä¼ é€’ã€æ’¤é”€ã€é‡åš

### 1.3 å‘½ä»¤æ¨¡å¼è§£å†³çš„æ ¸å¿ƒé—®é¢˜


```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
è°ƒç”¨è€… â”€â”€ç›´æ¥è°ƒç”¨â”€â”€> æ¥æ”¶è€…
â†“
â€¢ è°ƒç”¨è€…å¿…é¡»çŸ¥é“æ¥æ”¶è€…çš„å…·ä½“æ–¹æ³•
â€¢ æ— æ³•çµæ´»åœ°ç®¡ç†è¯·æ±‚
â€¢ éš¾ä»¥æ”¯æŒæ’¤é”€ã€é‡åšç­‰åŠŸèƒ½

å‘½ä»¤æ¨¡å¼çš„è§£å†³ï¼š
è°ƒç”¨è€… â”€â”€å‘é€å‘½ä»¤å¯¹è±¡â”€â”€> å‘½ä»¤ â”€â”€æ‰§è¡Œâ”€â”€> æ¥æ”¶è€…
â†“
â€¢ è°ƒç”¨è€…åªéœ€è¦çŸ¥é“å‘½ä»¤æ¥å£
â€¢ å¯ä»¥çµæ´»ç®¡ç†å‘½ä»¤ï¼ˆä¿å­˜ã€æ’é˜Ÿã€æ’¤é”€ï¼‰
â€¢ æ”¯æŒå¤æ‚çš„æ“ä½œæ§åˆ¶
```

---

## 2. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼


### 2.1 è§£å†³è¯·æ±‚è€…ä¸æ‰§è¡Œè€…çš„è€¦åˆé—®é¢˜


**ğŸ”¸ ä¼ ç»Ÿç›´æ¥è°ƒç”¨çš„é—®é¢˜**ï¼š

```java
// ä¸å¥½çš„åšæ³•ï¼šç›´æ¥è€¦åˆ
class RemoteControl {
    private Light light;
    private Fan fan;
    
    public void pressButton1() {
        light.turnOn();  // ç›´æ¥ä¾èµ–å…·ä½“ç±»
    }
    
    public void pressButton2() {
        fan.start();     // é¥æ§å™¨å¿…é¡»çŸ¥é“æ‰€æœ‰è®¾å¤‡
    }
}
```

é—®é¢˜åˆ†æï¼š
- âŒ é¥æ§å™¨å¿…é¡»çŸ¥é“æ¯ä¸ªè®¾å¤‡çš„å…·ä½“æ–¹æ³•
- âŒ å¢åŠ æ–°è®¾å¤‡éœ€è¦ä¿®æ”¹é¥æ§å™¨ä»£ç 
- âŒ æ— æ³•æ”¯æŒæ’¤é”€åŠŸèƒ½
- âŒ æ— æ³•è®°å½•æ“ä½œå†å²

### 2.2 å‘½ä»¤æ¨¡å¼å¸¦æ¥çš„å¥½å¤„


**ğŸ”¸ è§£è€¦è°ƒç”¨è€…å’Œæ¥æ”¶è€…**ï¼š

```
é¥æ§å™¨ä¸éœ€è¦çŸ¥é“ï¼š
â€¢ ç¯æ˜¯æ€ä¹ˆäº®çš„
â€¢ é£æ‰‡æ˜¯æ€ä¹ˆè½¬çš„  
â€¢ éŸ³å“æ˜¯æ€ä¹ˆå·¥ä½œçš„

é¥æ§å™¨åªéœ€è¦çŸ¥é“ï¼š
â€¢ æœ‰ä¸€ä¸ª"å‘½ä»¤"æ¥å£
â€¢ è°ƒç”¨å‘½ä»¤çš„execute()æ–¹æ³•
```

**ğŸ”¸ æ”¯æŒä¸°å¯Œçš„æ“ä½œæ§åˆ¶**ï¼š
- âœ… **æ’¤é”€æ“ä½œ**ï¼šæ¯ä¸ªå‘½ä»¤éƒ½å¯ä»¥æ’¤é”€
- âœ… **é‡åšæ“ä½œ**ï¼šæ’¤é”€åå¯ä»¥é‡æ–°æ‰§è¡Œ
- âœ… **å®å‘½ä»¤**ï¼šæŠŠå¤šä¸ªå‘½ä»¤ç»„åˆæˆä¸€ä¸ª
- âœ… **æ“ä½œæ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰æ‰§è¡Œè¿‡çš„å‘½ä»¤
- âœ… **é˜Ÿåˆ—æ‰§è¡Œ**ï¼šå‘½ä»¤å¯ä»¥æ’é˜Ÿæ‰¹é‡å¤„ç†

### 2.3 å®é™…åº”ç”¨éœ€æ±‚


**åœºæ™¯1ï¼šå›¾å½¢ç¼–è¾‘å™¨**
```
ç”¨æˆ·æ“ä½œï¼šç§»åŠ¨å›¾å½¢ã€æ”¹å˜é¢œè‰²ã€è°ƒæ•´å¤§å°
éœ€æ±‚ï¼šæ”¯æŒCtrl+Zæ’¤é”€ï¼ŒCtrl+Yé‡åš
è§£å†³ï¼šæ¯ä¸ªæ“ä½œéƒ½æ˜¯ä¸€ä¸ªå‘½ä»¤å¯¹è±¡
```

**åœºæ™¯2ï¼šæ™ºèƒ½å®¶å±…ç³»ç»Ÿ**
```
ç”¨æˆ·æ“ä½œï¼šå¼€ç¯ã€å…³ç©ºè°ƒã€æ’­æ”¾éŸ³ä¹
éœ€æ±‚ï¼šå®šæ—¶æ‰§è¡Œã€æ‰¹é‡æ“ä½œã€è¿œç¨‹æ§åˆ¶
è§£å†³ï¼šæ‰€æœ‰æ“ä½œå°è£…æˆå‘½ä»¤
```

**åœºæ™¯3ï¼šæ•°æ®åº“äº‹åŠ¡**
```
ç”¨æˆ·æ“ä½œï¼šå¢åˆ æ”¹æŸ¥
éœ€æ±‚ï¼šäº‹åŠ¡å›æ»šã€æ“ä½œæ—¥å¿—ã€æ‰¹é‡æäº¤
è§£å†³ï¼šæ¯ä¸ªSQLæ“ä½œéƒ½æ˜¯å‘½ä»¤
```

---

## 3. ğŸ—ï¸ å‘½ä»¤æ¨¡å¼ç»“æ„åˆ†æ


### 3.1 æ ¸å¿ƒè§’è‰²è¯´æ˜


```
å‘½ä»¤æ¨¡å¼çš„å››ä¸ªæ ¸å¿ƒè§’è‰²ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è°ƒç”¨è€…     â”‚â”€â”€â”€>â”‚   æŠ½è±¡å‘½ä»¤   â”‚<â”€â”€â”€â”‚  å…·ä½“å‘½ä»¤   â”‚â”€â”€â”€>â”‚   æ¥æ”¶è€…     â”‚
â”‚  Invoker    â”‚    â”‚  Command    â”‚    â”‚ConcreteCmd  â”‚    â”‚  Receiver   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘                    â†‘                    â†‘                 â†‘
   é¥æ§å™¨              å‘½ä»¤æ¥å£            å…·ä½“çš„å‘½ä»¤           ç”µç¯ã€é£æ‰‡
```

### 3.2 æŠ½è±¡å‘½ä»¤æ¥å£è®¾è®¡


**ğŸ”¸ Commandæ¥å£çš„èŒè´£**ï¼š
```java
public interface Command {
    void execute();    // æ‰§è¡Œå‘½ä»¤
    void undo();      // æ’¤é”€å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
}
```

> ğŸ’¡ **è®¾è®¡è¦ç‚¹**ï¼šæ¥å£è¦è¶³å¤Ÿç®€å•ï¼Œåªå®šä¹‰æœ€æ ¸å¿ƒçš„æ–¹æ³•

### 3.3 å…·ä½“å‘½ä»¤å®ç°


**ğŸ”¸ å…·ä½“å‘½ä»¤ç±»çš„èŒè´£**ï¼š
- ä¿å­˜æ¥æ”¶è€…çš„å¼•ç”¨
- å®ç°å…·ä½“çš„æ‰§è¡Œé€»è¾‘
- å®ç°æ’¤é”€é€»è¾‘ï¼ˆå¦‚æœéœ€è¦ï¼‰

```java
// å¼€ç¯å‘½ä»¤
public class LightOnCommand implements Command {
    private Light light;  // æŒæœ‰æ¥æ”¶è€…å¼•ç”¨
    
    public LightOnCommand(Light light) {
        this.light = light;
    }
    
    @Override
    public void execute() {
        light.turnOn();   // å§”æ‰˜ç»™æ¥æ”¶è€…æ‰§è¡Œ
    }
    
    @Override
    public void undo() {
        light.turnOff();  // æ’¤é”€å°±æ˜¯æ‰§è¡Œç›¸åæ“ä½œ
    }
}
```

### 3.4 è°ƒç”¨è€…ç±»è®¾è®¡


**ğŸ”¸ Invokerçš„èŒè´£**ï¼š
- æŒæœ‰å‘½ä»¤å¯¹è±¡çš„å¼•ç”¨
- è°ƒç”¨å‘½ä»¤çš„execute()æ–¹æ³•
- ç®¡ç†å‘½ä»¤çš„ç”Ÿå‘½å‘¨æœŸ

```java
// ç®€å•çš„é¥æ§å™¨
public class RemoteControl {
    private Command command;
    
    public void setCommand(Command command) {
        this.command = command;
    }
    
    public void pressButton() {
        if (command != null) {
            command.execute();
        }
    }
}
```

### 3.5 æ¥æ”¶è€…ç±»è®¾è®¡


**ğŸ”¸ Receiverçš„èŒè´£**ï¼š
- å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
- ä¸éœ€è¦çŸ¥é“å‘½ä»¤æ¨¡å¼çš„å­˜åœ¨
- ä¸“æ³¨äºè‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½

```java
// ç”µç¯ç±» - æ¥æ”¶è€…
public class Light {
    private boolean isOn = false;
    
    public void turnOn() {
        isOn = true;
        System.out.println("ç”µç¯å·²æ‰“å¼€");
    }
    
    public void turnOff() {
        isOn = false;
        System.out.println("ç”µç¯å·²å…³é—­");
    }
}
```

### 3.6 å‘½ä»¤æ‰§è¡Œæµç¨‹


```
å®Œæ•´çš„å‘½ä»¤æ‰§è¡Œæµç¨‹ï¼š

1. å®¢æˆ·åˆ›å»ºå…·ä½“å‘½ä»¤å¯¹è±¡ï¼Œä¼ å…¥æ¥æ”¶è€…
   Command cmd = new LightOnCommand(light);

2. å®¢æˆ·å°†å‘½ä»¤è®¾ç½®ç»™è°ƒç”¨è€…
   remote.setCommand(cmd);

3. è°ƒç”¨è€…æ‰§è¡Œå‘½ä»¤
   remote.pressButton();
   
4. å‘½ä»¤å¯¹è±¡è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•
   light.turnOn();

æ•°æ®æµå‘ï¼š
å®¢æˆ·ç«¯ â†’ è°ƒç”¨è€… â†’ å‘½ä»¤å¯¹è±¡ â†’ æ¥æ”¶è€… â†’ å®é™…æ‰§è¡Œ
```

---

## 4. ğŸ’» å‘½ä»¤æ¨¡å¼å®ç°è¯¦è§£


### 4.1 åŸºç¡€å®ç°ç¤ºä¾‹


è®©æˆ‘ä»¬ç”¨æ™ºèƒ½å®¶å±…é¥æ§å™¨æ¥æ¼”ç¤ºå‘½ä»¤æ¨¡å¼ï¼š

```java
// 1. æŠ½è±¡å‘½ä»¤æ¥å£
public interface Command {
    void execute();
    void undo();
}

// 2. æ¥æ”¶è€…ç±» - ç”µç¯
public class Light {
    private String location;
    private boolean isOn = false;
    
    public Light(String location) {
        this.location = location;
    }
    
    public void turnOn() {
        isOn = true;
        System.out.println(location + "çš„ç”µç¯å·²æ‰“å¼€");
    }
    
    public void turnOff() {
        isOn = false;  
        System.out.println(location + "çš„ç”µç¯å·²å…³é—­");
    }
}

// 3. å…·ä½“å‘½ä»¤ - å¼€ç¯å‘½ä»¤
public class LightOnCommand implements Command {
    private Light light;
    
    public LightOnCommand(Light light) {
        this.light = light;
    }
    
    @Override
    public void execute() {
        light.turnOn();
    }
    
    @Override  
    public void undo() {
        light.turnOff();
    }
}

// 4. è°ƒç”¨è€… - é¥æ§å™¨
public class RemoteControl {
    private Command[] commands;
    private Command lastCommand;
    
    public RemoteControl() {
        commands = new Command[7];
        // åˆå§‹åŒ–ä¸ºç©ºå‘½ä»¤ï¼Œé¿å…nullæ£€æŸ¥
        Command noCommand = () -> {};
        for (int i = 0; i < 7; i++) {
            commands[i] = noCommand;
        }
    }
    
    public void setCommand(int slot, Command command) {
        commands[slot] = command;
    }
    
    public void pressButton(int slot) {
        commands[slot].execute();
        lastCommand = commands[slot];
    }
    
    public void pressUndo() {
        if (lastCommand != null) {
            lastCommand.undo();
        }
    }
}
```

### 4.2 æ”¯æŒæ’¤é”€çš„å®Œæ•´å®ç°


**ğŸ”¸ å¸¦çŠ¶æ€çš„æ’¤é”€æ“ä½œ**ï¼š

```java
// é£æ‰‡ç±» - æ”¯æŒå¤šæ¡£è°ƒé€Ÿ
public class Fan {
    public static final int OFF = 0;
    public static final int LOW = 1; 
    public static final int MEDIUM = 2;
    public static final int HIGH = 3;
    
    private int speed = OFF;
    private String location;
    
    public Fan(String location) {
        this.location = location;
    }
    
    public void setSpeed(int speed) {
        this.speed = speed;
        System.out.println(location + "é£æ‰‡é€Ÿåº¦è®¾ä¸ºï¼š" + getSpeedName());
    }
    
    public int getSpeed() {
        return speed;
    }
    
    private String getSpeedName() {
        switch(speed) {
            case OFF: return "å…³é—­";
            case LOW: return "ä½é€Ÿ"; 
            case MEDIUM: return "ä¸­é€Ÿ";
            case HIGH: return "é«˜é€Ÿ";
            default: return "æœªçŸ¥";
        }
    }
}

// é£æ‰‡å‘½ä»¤ - éœ€è¦è®°ä½ä¹‹å‰çš„çŠ¶æ€
public class FanCommand implements Command {
    private Fan fan;
    private int prevSpeed;  // è®°ä½æ’¤é”€å‰çš„çŠ¶æ€
    private int newSpeed;   // æ–°çš„é€Ÿåº¦
    
    public FanCommand(Fan fan, int speed) {
        this.fan = fan;
        this.newSpeed = speed;
    }
    
    @Override
    public void execute() {
        prevSpeed = fan.getSpeed();  // è®°ä½å½“å‰çŠ¶æ€
        fan.setSpeed(newSpeed);
    }
    
    @Override
    public void undo() {
        fan.setSpeed(prevSpeed);     // æ¢å¤ä¹‹å‰çŠ¶æ€
    }
}
```

### 4.3 å®å‘½ä»¤å®ç°


**ğŸ”¸ ç»„åˆå¤šä¸ªå‘½ä»¤**ï¼š

```java
// å®å‘½ä»¤ - å¯ä»¥æ‰§è¡Œä¸€ç»„å‘½ä»¤
public class MacroCommand implements Command {
    private Command[] commands;
    
    public MacroCommand(Command[] commands) {
        this.commands = commands;
    }
    
    @Override
    public void execute() {
        // ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
        for (Command command : commands) {
            command.execute();
        }
    }
    
    @Override
    public void undo() {
        // åå‘æ’¤é”€æ‰€æœ‰å‘½ä»¤
        for (int i = commands.length - 1; i >= 0; i--) {
            commands[i].undo();
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class SmartHomeDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè®¾å¤‡
        Light livingRoomLight = new Light("å®¢å…");
        Light kitchenLight = new Light("å¨æˆ¿");
        Fan ceilingFan = new Fan("å§å®¤");
        
        // åˆ›å»ºå‘½ä»¤
        Command lightOn1 = new LightOnCommand(livingRoomLight);
        Command lightOn2 = new LightOnCommand(kitchenLight);  
        Command fanHigh = new FanCommand(ceilingFan, Fan.HIGH);
        
        // åˆ›å»ºå®å‘½ä»¤ - "å›å®¶æ¨¡å¼"
        Command[] homeCommands = {lightOn1, lightOn2, fanHigh};
        MacroCommand homeMode = new MacroCommand(homeCommands);
        
        // è®¾ç½®åˆ°é¥æ§å™¨
        RemoteControl remote = new RemoteControl();
        remote.setCommand(0, homeMode);
        
        // æ‰§è¡Œ"å›å®¶æ¨¡å¼"
        System.out.println("=== æ‰§è¡Œå›å®¶æ¨¡å¼ ===");
        remote.pressButton(0);
        
        System.out.println("\n=== æ’¤é”€å›å®¶æ¨¡å¼ ===");
        remote.pressUndo();
    }
}
```

### 4.4 å‘½ä»¤é˜Ÿåˆ—å®ç°


**ğŸ”¸ æ”¯æŒæ‰¹é‡æ‰§è¡Œå’Œå»¶è¿Ÿæ‰§è¡Œ**ï¼š

```java
import java.util.*;
import java.util.concurrent.*;

// å‘½ä»¤é˜Ÿåˆ—ç®¡ç†å™¨
public class CommandQueue {
    private Queue<Command> commandQueue;
    private Stack<Command> history;
    private ExecutorService executor;
    
    public CommandQueue() {
        commandQueue = new LinkedList<>();
        history = new Stack<>();
        executor = Executors.newSingleThreadExecutor();
    }
    
    // æ·»åŠ å‘½ä»¤åˆ°é˜Ÿåˆ—
    public void addCommand(Command command) {
        commandQueue.offer(command);
    }
    
    // æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤
    public void executeAll() {
        while (!commandQueue.isEmpty()) {
            Command command = commandQueue.poll();
            command.execute();
            history.push(command);  // è®°å½•åˆ°å†å²
        }
    }
    
    // å¼‚æ­¥æ‰§è¡Œå‘½ä»¤
    public CompletableFuture<Void> executeAsync(Command command) {
        return CompletableFuture.runAsync(() -> {
            command.execute();
            history.push(command);
        }, executor);
    }
    
    // æ’¤é”€æœ€åä¸€ä¸ªå‘½ä»¤
    public void undoLast() {
        if (!history.isEmpty()) {
            Command lastCommand = history.pop();
            lastCommand.undo();
        }
    }
    
    public void shutdown() {
        executor.shutdown();
    }
}
```

---

## 5. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 5.1 å›¾å½¢ç¼–è¾‘å™¨ä¸­çš„åº”ç”¨


**ğŸ”¸ åœºæ™¯æè¿°**ï¼šç”¨æˆ·åœ¨å›¾å½¢ç¼–è¾‘å™¨ä¸­è¿›è¡Œå„ç§æ“ä½œï¼Œéœ€è¦æ”¯æŒæ’¤é”€é‡åš

```java
// å›¾å½¢å¯¹è±¡
class Shape {
    private int x, y;
    private String color;
    
    public void move(int deltaX, int deltaY) {
        x += deltaX;
        y += deltaY;
        System.out.println("å›¾å½¢ç§»åŠ¨åˆ°ï¼š(" + x + ", " + y + ")");
    }
    
    public void setColor(String color) {
        String oldColor = this.color;
        this.color = color;
        System.out.println("å›¾å½¢é¢œè‰²ä»" + oldColor + "æ”¹ä¸º" + color);
    }
    
    // getteræ–¹æ³•...
}

// ç§»åŠ¨å‘½ä»¤
class MoveCommand implements Command {
    private Shape shape;
    private int deltaX, deltaY;
    
    public MoveCommand(Shape shape, int deltaX, int deltaY) {
        this.shape = shape;
        this.deltaX = deltaX;
        this.deltaY = deltaY;
    }
    
    @Override
    public void execute() {
        shape.move(deltaX, deltaY);
    }
    
    @Override
    public void undo() {
        shape.move(-deltaX, -deltaY);  // åå‘ç§»åŠ¨
    }
}

// ç¼–è¾‘å™¨ç±»
class GraphicEditor {
    private Stack<Command> history = new Stack<>();
    private Stack<Command> redoStack = new Stack<>();
    
    public void executeCommand(Command command) {
        command.execute();
        history.push(command);
        redoStack.clear();  // æ‰§è¡Œæ–°å‘½ä»¤åæ¸…ç©ºé‡åšæ ˆ
    }
    
    public void undo() {
        if (!history.isEmpty()) {
            Command command = history.pop();
            command.undo();
            redoStack.push(command);
        }
    }
    
    public void redo() {
        if (!redoStack.isEmpty()) {
            Command command = redoStack.pop();
            command.execute();
            history.push(command);
        }
    }
}
```

### 5.2 çº¿ç¨‹æ± ä»»åŠ¡è°ƒåº¦


**ğŸ”¸ åœºæ™¯æè¿°**ï¼šå°†ä»»åŠ¡å°è£…æˆå‘½ä»¤ï¼Œæäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œ

```java
// ä»»åŠ¡å‘½ä»¤æ¥å£
interface TaskCommand extends Command {
    String getTaskName();
    boolean canRetry();
}

// å…·ä½“ä»»åŠ¡å‘½ä»¤
class DataProcessingTask implements TaskCommand {
    private String dataSource;
    private boolean executed = false;
    
    public DataProcessingTask(String dataSource) {
        this.dataSource = dataSource;
    }
    
    @Override
    public void execute() {
        System.out.println("å¼€å§‹å¤„ç†æ•°æ®ï¼š" + dataSource);
        // æ¨¡æ‹Ÿæ•°æ®å¤„ç†
        try {
            Thread.sleep(1000);
            executed = true;
            System.out.println("æ•°æ®å¤„ç†å®Œæˆï¼š" + dataSource);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
    
    @Override
    public void undo() {
        System.out.println("å›æ»šæ•°æ®å¤„ç†ï¼š" + dataSource);
        executed = false;
    }
    
    @Override
    public String getTaskName() {
        return "æ•°æ®å¤„ç†ä»»åŠ¡ï¼š" + dataSource;
    }
    
    @Override
    public boolean canRetry() {
        return !executed;
    }
}

// ä»»åŠ¡è°ƒåº¦å™¨
class TaskScheduler {
    private ExecutorService executor;
    private List<TaskCommand> completedTasks;
    
    public TaskScheduler() {
        executor = Executors.newFixedThreadPool(3);
        completedTasks = new ArrayList<>();
    }
    
    public void submitTask(TaskCommand task) {
        executor.submit(() -> {
            try {
                task.execute();
                completedTasks.add(task);
            } catch (Exception e) {
                System.err.println("ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼š" + task.getTaskName());
                if (task.canRetry()) {
                    System.out.println("é‡æ–°æäº¤ä»»åŠ¡ï¼š" + task.getTaskName());
                    submitTask(task);  // é‡è¯•
                }
            }
        });
    }
    
    public void rollbackAllTasks() {
        for (int i = completedTasks.size() - 1; i >= 0; i--) {
            completedTasks.get(i).undo();
        }
        completedTasks.clear();
    }
}
```

### 5.3 æ•°æ®åº“äº‹åŠ¡æ“ä½œ


**ğŸ”¸ åœºæ™¯æè¿°**ï¼šæ•°æ®åº“æ“ä½œå°è£…æˆå‘½ä»¤ï¼Œæ”¯æŒäº‹åŠ¡å›æ»š

```java
// æ•°æ®åº“æ“ä½œå‘½ä»¤
abstract class DatabaseCommand implements Command {
    protected String sql;
    protected Object[] parameters;
    protected boolean executed = false;
    
    public DatabaseCommand(String sql, Object... parameters) {
        this.sql = sql;
        this.parameters = parameters;
    }
    
    public abstract Object executeSQL();
    public abstract void rollbackSQL();
    
    @Override
    public void execute() {
        if (!executed) {
            executeSQL();
            executed = true;
        }
    }
    
    @Override
    public void undo() {
        if (executed) {
            rollbackSQL();
            executed = false;
        }
    }
}

// æ’å…¥å‘½ä»¤
class InsertCommand extends DatabaseCommand {
    private Long generatedId;
    
    public InsertCommand(String sql, Object... parameters) {
        super(sql, parameters);
    }
    
    @Override
    public Object executeSQL() {
        // æ¨¡æ‹Ÿæ•°æ®åº“æ’å…¥
        generatedId = System.currentTimeMillis();
        System.out.println("æ‰§è¡Œæ’å…¥ï¼š" + sql + " ç”ŸæˆIDï¼š" + generatedId);
        return generatedId;
    }
    
    @Override
    public void rollbackSQL() {
        System.out.println("å›æ»šæ’å…¥ï¼šåˆ é™¤IDä¸º" + generatedId + "çš„è®°å½•");
    }
}

// äº‹åŠ¡ç®¡ç†å™¨
class TransactionManager {
    private List<DatabaseCommand> commands = new ArrayList<>();
    private boolean committed = false;
    
    public void addCommand(DatabaseCommand command) {
        if (!committed) {
            commands.add(command);
        }
    }
    
    public void commit() {
        for (DatabaseCommand command : commands) {
            command.execute();
        }
        committed = true;
        System.out.println("äº‹åŠ¡æäº¤æˆåŠŸ");
    }
    
    public void rollback() {
        for (int i = commands.size() - 1; i >= 0; i--) {
            commands.get(i).undo();
        }
        commands.clear();
        committed = false;
        System.out.println("äº‹åŠ¡å›æ»šå®Œæˆ");
    }
}
```

---

## 6. âš–ï¸ å‘½ä»¤æ¨¡å¼çš„ä¼˜ç¼ºç‚¹


### 6.1 ä¸»è¦ä¼˜ç‚¹


| ä¼˜ç‚¹ | **å…·ä½“è¯´æ˜** | **å®é™…ä»·å€¼** |
|------|-------------|-------------|
| ğŸ”¸ **é™ä½è€¦åˆåº¦** | `è°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“æ¥æ”¶è€…çš„å…·ä½“å®ç°` | `é¥æ§å™¨ä¸ç”¨å…³å¿ƒç”µå™¨å†…éƒ¨åŸç†` |
| ğŸ”¸ **æ”¯æŒæ’¤é”€é‡åš** | `æ¯ä¸ªå‘½ä»¤éƒ½å¯ä»¥æ’¤é”€å’Œé‡æ–°æ‰§è¡Œ` | `ç¼–è¾‘å™¨çš„Ctrl+ZåŠŸèƒ½` |
| ğŸ”¸ **æ”¯æŒå®å‘½ä»¤** | `å¯ä»¥å°†å¤šä¸ªå‘½ä»¤ç»„åˆæˆä¸€ä¸ªå¤åˆå‘½ä»¤` | `ä¸€é”®æ‰§è¡Œ"å›å®¶æ¨¡å¼"` |
| ğŸ”¸ **æ”¯æŒæ—¥å¿—è®°å½•** | `å¯ä»¥è®°å½•æ‰€æœ‰æ‰§è¡Œè¿‡çš„å‘½ä»¤` | `ç³»ç»Ÿæ“ä½œå®¡è®¡å’Œæ¢å¤` |
| ğŸ”¸ **æ”¯æŒé˜Ÿåˆ—æ“ä½œ** | `å‘½ä»¤å¯ä»¥æ’é˜Ÿã€å»¶è¿Ÿæ‰§è¡Œ` | `æ‰¹é‡å¤„ç†å’Œä»»åŠ¡è°ƒåº¦` |
| ğŸ”¸ **æ˜“äºæ‰©å±•** | `æ–°å¢å‘½ä»¤ç±»ï¼Œä¸å½±å“ç°æœ‰ä»£ç ` | `æ·»åŠ æ–°è®¾å¤‡æ— éœ€æ”¹é¥æ§å™¨` |

### 6.2 ä¸»è¦ç¼ºç‚¹


**ğŸ”¸ ç±»æ•°é‡å¢åŠ **ï¼š
```
æ¯ç§æ“ä½œéƒ½éœ€è¦ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»
ç³»ç»Ÿä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šå°çš„å‘½ä»¤ç±»
ä»£ç æ–‡ä»¶æ•°é‡ä¼šæ˜¾è‘—å¢åŠ 
```

**ğŸ”¸ è®¾è®¡å¤æ‚åº¦æå‡**ï¼š
```
ç®€å•æ“ä½œå˜å¾—å¤æ‚åŒ–
éœ€è¦ç†è§£å‘½ä»¤æ¨¡å¼çš„è®¾è®¡æ€æƒ³
å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡å±‚æ¬¡
```

### 6.3 é€‚ç”¨åœºæ™¯åˆ¤æ–­


**âœ… é€‚åˆä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„åœºæ™¯**ï¼š
- éœ€è¦æ”¯æŒæ’¤é”€/é‡åšæ“ä½œ
- éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿã€è®°å½•æ—¥å¿—
- éœ€è¦æ”¯æŒå®æ“ä½œï¼ˆç»„åˆå‘½ä»¤ï¼‰
- è°ƒç”¨è€…å’Œæ¥æ”¶è€…éœ€è¦è§£è€¦
- éœ€è¦åœ¨ä¸åŒæ—¶é—´æ‰§è¡Œè¯·æ±‚

**âŒ ä¸é€‚åˆä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„åœºæ™¯**ï¼š
- æ“ä½œéå¸¸ç®€å•ï¼Œç›´æ¥è°ƒç”¨æ›´æ¸…æ™°
- ä¸éœ€è¦æ’¤é”€ã€æ—¥å¿—ç­‰é«˜çº§åŠŸèƒ½
- ç³»ç»Ÿè§„æ¨¡å¾ˆå°ï¼Œè¿‡åº¦è®¾è®¡
- æ€§èƒ½è¦æ±‚æé«˜ï¼Œä¸èƒ½å®¹å¿é¢å¤–å¼€é”€

### 6.4 ä¸å…¶ä»–æ¨¡å¼çš„å¯¹æ¯”


| æ¨¡å¼å¯¹æ¯” | **å‘½ä»¤æ¨¡å¼** | **ç­–ç•¥æ¨¡å¼** | **çŠ¶æ€æ¨¡å¼** |
|---------|-------------|-------------|-------------|
| ğŸ¯ **æ ¸å¿ƒç›®çš„** | `è§£è€¦è°ƒç”¨è€…å’Œæ¥æ”¶è€…` | `ç®—æ³•å¯æ›¿æ¢` | `çŠ¶æ€å˜åŒ–è¡Œä¸ºä¸åŒ` |
| ğŸ”§ **ä¸»è¦åŠŸèƒ½** | `å°è£…è¯·æ±‚ï¼Œæ”¯æŒæ’¤é”€` | `å°è£…ç®—æ³•æ—` | `å°è£…çŠ¶æ€è½¬æ¢` |
| ğŸ“ **ä½¿ç”¨åœºæ™¯** | `GUIæ“ä½œã€äº‹åŠ¡å¤„ç†` | `æ’åºç®—æ³•é€‰æ‹©` | `æ¸¸æˆè§’è‰²çŠ¶æ€` |
| ğŸ”„ **è¿è¡Œæ—¶è¡Œä¸º** | `æ‰§è¡Œåå¯æ’¤é”€` | `é€‰æ‹©åæ‰§è¡Œ` | `çŠ¶æ€é—´è½¬æ¢` |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å‘½ä»¤æ¨¡å¼æœ¬è´¨ï¼šå°†"è¯·æ±‚"å°è£…æˆå¯¹è±¡ï¼Œå®ç°è°ƒç”¨è€…ä¸æ¥æ”¶è€…è§£è€¦
ğŸ”¸ å››å¤§è§’è‰²ï¼šè°ƒç”¨è€…(Invoker)ã€å‘½ä»¤(Command)ã€å…·ä½“å‘½ä»¤ã€æ¥æ”¶è€…(Receiver)  
ğŸ”¸ æ ¸å¿ƒèƒ½åŠ›ï¼šæ’¤é”€é‡åšã€å®å‘½ä»¤ã€æ“ä½œæ—¥å¿—ã€é˜Ÿåˆ—æ‰§è¡Œ
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šå•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€ä¾èµ–å€’ç½®
ğŸ”¸ åº”ç”¨ä»·å€¼ï¼šGUIæ“ä½œã€äº‹åŠ¡å¤„ç†ã€ä»»åŠ¡è°ƒåº¦ã€æ™ºèƒ½æ§åˆ¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å‘½ä»¤æ¨¡å¼çš„ç²¾é«“**ï¼š
```
ä¸æ˜¯ç®€å•çš„æ–¹æ³•è°ƒç”¨å°è£…
è€Œæ˜¯å°†"æ“ä½œè¯·æ±‚"å˜æˆ"å¯æ“ä½œçš„å¯¹è±¡"
è¿™ä¸ªå¯¹è±¡å¯ä»¥ï¼š
â€¢ ä¿å­˜èµ·æ¥éšæ—¶æ‰§è¡Œ
â€¢ æ’¤é”€å·²ç»æ‰§è¡Œçš„æ“ä½œ  
â€¢ ä¸å…¶ä»–å‘½ä»¤ç»„åˆ
â€¢ è®°å½•åˆ°æ—¥å¿—ä¸­
â€¢ æ”¾å…¥é˜Ÿåˆ—æ‰¹é‡å¤„ç†
```

**ğŸ”¹ ä½•æ—¶è€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼**ï¼š
```
é—®è‡ªå·±è¿™äº›é—®é¢˜ï¼š
â€¢ éœ€è¦æ”¯æŒæ’¤é”€æ“ä½œå—ï¼Ÿ
â€¢ éœ€è¦è®°å½•æ“ä½œå†å²å—ï¼Ÿ
â€¢ éœ€è¦æ‰¹é‡æ‰§è¡Œæ“ä½œå—ï¼Ÿ
â€¢ è°ƒç”¨è€…éœ€è¦ä¸å…·ä½“æ‰§è¡Œè€…è§£è€¦å—ï¼Ÿ
â€¢ éœ€è¦åœ¨ä¸åŒæ—¶é—´æ‰§è¡Œè¯·æ±‚å—ï¼Ÿ

å¦‚æœæœ‰å¤šä¸ª"æ˜¯"ï¼Œè€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼
```

**ğŸ”¹ å®ç°æ—¶çš„æ³¨æ„äº‹é¡¹**ï¼š
```
å‘½ä»¤æ¥å£è¦ç®€æ´ï¼šé€šå¸¸åªæœ‰execute()å’Œundo()
å…·ä½“å‘½ä»¤è¦æŒæœ‰æ¥æ”¶è€…å¼•ç”¨ï¼šå‘½ä»¤çŸ¥é“è°æ¥æ‰§è¡Œ
è°ƒç”¨è€…åªçŸ¥é“å‘½ä»¤æ¥å£ï¼šä¸å…³å¿ƒå…·ä½“å®ç°
æ”¯æŒæ’¤é”€éœ€è¦ä¿å­˜çŠ¶æ€ï¼šè®°ä½æ“ä½œå‰çš„çŠ¶æ€
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨å»ºè®®**ï¼š

```
å°å‹é¡¹ç›®ï¼š
â€¢ åªåœ¨çœŸæ­£éœ€è¦æ’¤é”€åŠŸèƒ½æ—¶ä½¿ç”¨
â€¢ é¿å…è¿‡åº¦è®¾è®¡ï¼Œç®€å•æ“ä½œç›´æ¥è°ƒç”¨

ä¸­å‹é¡¹ç›®ï¼š  
â€¢ GUIåº”ç”¨ä¸­çš„æ“ä½œå†å²
â€¢ æ‰¹é‡æ•°æ®å¤„ç†ä»»åŠ¡
â€¢ ç”¨æˆ·æ“ä½œçš„å®¡è®¡æ—¥å¿—

å¤§å‹é¡¹ç›®ï¼š
â€¢ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
â€¢ å·¥ä½œæµå¼•æ“ä¸­çš„æ­¥éª¤
â€¢ å¾®æœåŠ¡é—´çš„å¼‚æ­¥å‘½ä»¤
```

**ğŸ”§ ä»£ç è´¨é‡å»ºè®®**ï¼š
- å‘½ä»¤ç±»ä¿æŒè½»é‡ï¼Œåªå°è£…å¿…è¦ä¿¡æ¯
- åˆç†ä½¿ç”¨ç©ºå¯¹è±¡æ¨¡å¼é¿å…nullæ£€æŸ¥
- è€ƒè™‘å‘½ä»¤çš„åºåˆ—åŒ–ï¼Œæ”¯æŒæŒä¹…åŒ–
- æ³¨æ„å†…å­˜æ³„æ¼ï¼ŒåŠæ—¶æ¸…ç†å‘½ä»¤å†å²

### 7.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**ï¼š
1. **æŒæ¡åŸºç¡€**ï¼šç†è§£å››å¤§è§’è‰²ï¼Œèƒ½å†™ç®€å•ç¤ºä¾‹
2. **å®è·µåº”ç”¨**ï¼šåœ¨å°é¡¹ç›®ä¸­å®ç°æ’¤é”€åŠŸèƒ½
3. **é«˜çº§ç‰¹æ€§**ï¼šå®å‘½ä»¤ã€å‘½ä»¤é˜Ÿåˆ—ã€å¼‚æ­¥æ‰§è¡Œ
4. **æ¡†æ¶æºç **ï¼šç ”ç©¶Springã€Androidä¸­çš„å‘½ä»¤æ¨¡å¼
5. **è®¾è®¡ä¼˜åŒ–**ï¼šç»“åˆå…¶ä»–æ¨¡å¼ï¼Œè§£å†³å¤æ‚åœºæ™¯

> ğŸ’¡ **æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š  
> è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œè°ƒç”¨æ‰§è¡Œè¦åˆ†ç¦»  
> æ’¤é”€é‡åšæˆä¸ºå¯èƒ½ï¼Œé˜Ÿåˆ—æ—¥å¿—éšå¿ƒæ„  
> é¥æ§ç”µå™¨æ˜¯å…¸å‹ï¼Œç¼–è¾‘æ“ä½œæœ€å¸¸è§  
> è§£è€¦çµæ´»å¥½æ‰©å±•ï¼Œå¤æ‚ç®€å•è¦æƒè¡¡

**ğŸ¯ ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼š
- å­¦ä¹ **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šäº†è§£å¯¹è±¡é—´çš„é€šçŸ¥æœºåˆ¶
- å­¦ä¹ **å¤‡å¿˜å½•æ¨¡å¼**ï¼šæ›´æ·±å…¥ç†è§£çŠ¶æ€ä¿å­˜
- å­¦ä¹ **è´£ä»»é“¾æ¨¡å¼**ï¼šè¯·æ±‚å¤„ç†çš„å¦ä¸€ç§æ–¹å¼