---
title: 4ã€å‘½ä»¤æ¨¡å¼å®é™…åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [å‘½ä»¤æ¨¡å¼åŸºç¡€å›é¡¾](#1-å‘½ä»¤æ¨¡å¼åŸºç¡€å›é¡¾)
2. [GUIæŒ‰é’®æ“ä½œåº”ç”¨](#2-GUIæŒ‰é’®æ“ä½œåº”ç”¨)
3. [æ’¤é”€é‡åšåŠŸèƒ½å®ç°](#3-æ’¤é”€é‡åšåŠŸèƒ½å®ç°)
4. [äº‹åŠ¡æ“ä½œç®¡ç†](#4-äº‹åŠ¡æ“ä½œç®¡ç†)
5. [ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ](#5-ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ)
6. [è¿œç¨‹è¿‡ç¨‹è°ƒç”¨](#6-è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)
7. [å®é™…é¡¹ç›®é€‰æ‹©æŒ‡å—](#7-å®é™…é¡¹ç›®é€‰æ‹©æŒ‡å—)

---

## 1. ğŸ¯ å‘½ä»¤æ¨¡å¼åŸºç¡€å›é¡¾


### 1.1 ä»€ä¹ˆæ˜¯å‘½ä»¤æ¨¡å¼


ğŸ’­ **ç®€å•ç†è§£**ï¼šæŠŠ"åšä»€ä¹ˆäº‹"å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œå°±åƒæŠŠèœè°±å†™åœ¨å¡ç‰‡ä¸Šä¸€æ ·ã€‚

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
é¤å…ç‚¹é¤ â†’ æœåŠ¡å‘˜æŠŠè®¢å•å†™åœ¨çº¸ä¸Š â†’ å¨å¸ˆæŒ‰è®¢å•åšèœ
                    â†‘
                 è¿™å°±æ˜¯å‘½ä»¤å¯¹è±¡
```

ğŸ” **æ ¸å¿ƒæ€æƒ³**ï¼š
- **è¯·æ±‚å°è£…**ï¼šæŠŠ"è¦åšçš„äº‹"åŒ…è£…æˆå¯¹è±¡
- **å‘é€è€…åˆ†ç¦»**ï¼šè°ä¸‹å‘½ä»¤å’Œè°æ‰§è¡Œå‘½ä»¤åˆ†å¼€
- **å‚æ•°åŒ–**ï¼šå¯ä»¥ç”¨ä¸åŒçš„å‘½ä»¤å¯¹è±¡åšä¸åŒçš„äº‹
- **æ’é˜Ÿæ‰§è¡Œ**ï¼šå‘½ä»¤å¯ä»¥å­˜èµ·æ¥ï¼Œæƒ³ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå°±ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ

### 1.2 å‘½ä»¤æ¨¡å¼çš„åŸºæœ¬ç»“æ„


```
åŸºæœ¬è§’è‰²å…³ç³»ï¼š
å®¢æˆ·ç«¯ â†’ è°ƒç”¨è€…(Invoker) â†’ å‘½ä»¤å¯¹è±¡(Command) â†’ æ¥æ”¶è€…(Receiver)
                                    â†“
                              å…·ä½“çš„æ‰§è¡Œé€»è¾‘
```

ğŸ·ï¸ **ä¸“ä¸šæœ¯è¯­è§£é‡Š**ï¼š
- **`Command`** = å‘½ä»¤æ¥å£ï¼Œå®šä¹‰"æ‰§è¡Œ"è¿™ä¸ªåŠ¨ä½œ
- **`ConcreteCommand`** = å…·ä½“å‘½ä»¤ï¼ŒçŸ¥é“è¦è°ƒç”¨å“ªä¸ªå¯¹è±¡çš„å“ªä¸ªæ–¹æ³•
- **`Invoker`** = è°ƒç”¨è€…ï¼Œè´Ÿè´£è§¦å‘å‘½ä»¤æ‰§è¡Œ
- **`Receiver`** = æ¥æ”¶è€…ï¼ŒçœŸæ­£å¹²æ´»çš„å¯¹è±¡

### 1.3 ä¸ºä»€ä¹ˆè¦ç”¨å‘½ä»¤æ¨¡å¼


âœ… **è§£å†³çš„é—®é¢˜**ï¼š
- è®©è°ƒç”¨æ“ä½œçš„å¯¹è±¡ä¸æ‰§è¡Œæ“ä½œçš„å¯¹è±¡åˆ†å¼€
- å¯ä»¥æŠŠè¯·æ±‚æ’é˜Ÿã€è®°å½•ã€æ’¤é”€
- æ”¯æŒå®å‘½ä»¤ï¼ˆç»„åˆå¤šä¸ªå‘½ä»¤ï¼‰

âŒ **ä¸ç”¨å‘½ä»¤æ¨¡å¼çš„é—®é¢˜**ï¼š
- è°ƒç”¨è€…å¿…é¡»çŸ¥é“æ¥æ”¶è€…çš„å…·ä½“æ–¹æ³•
- æ— æ³•å®ç°æ’¤é”€åŠŸèƒ½
- éš¾ä»¥å®ç°å‘½ä»¤çš„æ’é˜Ÿå’Œè®°å½•

---

## 2. ğŸ–±ï¸ GUIæŒ‰é’®æ“ä½œåº”ç”¨


### 2.1 ä¼ ç»ŸæŒ‰é’®äº‹ä»¶å¤„ç†çš„é—®é¢˜


ğŸ¤” **æƒ³æƒ³çœ‹**ï¼šå¦‚æœæ¯ä¸ªæŒ‰é’®éƒ½ç›´æ¥è°ƒç”¨å…·ä½“çš„ä¸šåŠ¡æ–¹æ³•ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ

```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
æŒ‰é’®A â†’ ç›´æ¥è°ƒç”¨ saveFile()
æŒ‰é’®B â†’ ç›´æ¥è°ƒç”¨ openFile()
æŒ‰é’®C â†’ ç›´æ¥è°ƒç”¨ printFile()

é—®é¢˜ï¼š
1. æŒ‰é’®å’Œå…·ä½“æ“ä½œå¼ºè€¦åˆ
2. æ— æ³•è®°å½•ç”¨æˆ·æ“ä½œå†å²
3. æ— æ³•å®ç°æ’¤é”€åŠŸèƒ½
4. éš¾ä»¥å®ç°å¿«æ·é”®å¤ç”¨
```

### 2.2 ä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„GUIè®¾è®¡


ğŸ—ï¸ **æ¶æ„è®¾è®¡**ï¼š
```
ç”¨æˆ·ç•Œé¢å±‚ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¿å­˜] [æ‰“å¼€] [æ‰“å°] [æ’¤é”€] [é‡åš]  â”‚
â”‚     â†“      â†“      â†“      â†“      â†“   â”‚
â”‚  Command Command Command Command    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
            CommandManager (è°ƒç”¨è€…)
                    â†“
              FileOperations (æ¥æ”¶è€…)
```

**ğŸ’» æ ¸å¿ƒä»£ç å®ç°**ï¼š

```java
// 1. å‘½ä»¤æ¥å£
interface Command {
    void execute();
    void undo();  // æ”¯æŒæ’¤é”€
}

// 2. æ–‡ä»¶æ“ä½œæ¥æ”¶è€…
class FileEditor {
    private String content = "";
    
    public void save(String filename) {
        System.out.println("ä¿å­˜æ–‡ä»¶: " + filename);
    }
    
    public void open(String filename) {
        System.out.println("æ‰“å¼€æ–‡ä»¶: " + filename);
        content = "æ–‡ä»¶å†…å®¹...";
    }
    
    public void copy() {
        System.out.println("å¤åˆ¶æ–‡æœ¬");
    }
}

// 3. å…·ä½“å‘½ä»¤
class SaveCommand implements Command {
    private FileEditor editor;
    private String filename;
    
    public SaveCommand(FileEditor editor, String filename) {
        this.editor = editor;
        this.filename = filename;
    }
    
    public void execute() {
        editor.save(filename);
    }
    
    public void undo() {
        System.out.println("æ’¤é”€ä¿å­˜æ“ä½œ");
    }
}

// 4. GUIæŒ‰é’®ç®¡ç†å™¨
class ButtonManager {
    private Command command;
    
    public void setCommand(Command command) {
        this.command = command;
    }
    
    public void clickButton() {
        if (command != null) {
            command.execute();
        }
    }
}
```

### 2.3 GUIåº”ç”¨çš„å®é™…å¥½å¤„


ğŸ¯ **å®é™…åº”ç”¨ä»·å€¼**ï¼š

**å¿«æ·é”®æ”¯æŒ**ï¼š
```
åŒä¸€ä¸ªSaveCommandå¯ä»¥è¢«ï¼š
- èœå•é¡¹è°ƒç”¨ â†’ ç‚¹å‡»"æ–‡ä»¶->ä¿å­˜"
- æŒ‰é’®è°ƒç”¨ â†’ ç‚¹å‡»ä¿å­˜æŒ‰é’®  
- å¿«æ·é”®è°ƒç”¨ â†’ æŒ‰Ctrl+S
```

**å·¥å…·æ åŠ¨æ€é…ç½®**ï¼š
```java
// ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å·¥å…·æ 
List<Command> toolbarCommands = Arrays.asList(
    new SaveCommand(editor, "doc.txt"),
    new CopyCommand(editor),
    new PrintCommand(editor)
);
```

**æ“ä½œè®°å½•**ï¼š
```java
// è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ
class OperationHistory {
    private List<Command> history = new ArrayList<>();
    
    public void record(Command command) {
        history.add(command);
        command.execute();
    }
}
```

---

## 3. â†©ï¸ æ’¤é”€é‡åšåŠŸèƒ½å®ç°


### 3.1 æ’¤é”€åŠŸèƒ½çš„æ ¸å¿ƒæ€è·¯


ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**ï¼šæ¯ä¸ªå‘½ä»¤éƒ½è¦è®°ä½"æ€ä¹ˆæ¢å¤"åŸæ¥çš„çŠ¶æ€ã€‚

```
æ’¤é”€çš„æœ¬è´¨ï¼š
æ‰§è¡Œå‘½ä»¤æ—¶ â†’ è®°å½•å½“å‰çŠ¶æ€ â†’ æ’¤é”€æ—¶æ¢å¤çŠ¶æ€

ä¾‹å¦‚ï¼š
åˆ é™¤æ–‡å­— â†’ è®°ä½åˆ é™¤çš„å†…å®¹å’Œä½ç½® â†’ æ’¤é”€æ—¶é‡æ–°æ’å…¥
ç§»åŠ¨æ–‡ä»¶ â†’ è®°ä½åŸæ¥çš„ä½ç½® â†’ æ’¤é”€æ—¶ç§»å›å»
```

### 2.2 æ–‡æœ¬ç¼–è¾‘å™¨çš„æ’¤é”€é‡åš


ğŸŒ° **å…·ä½“ä¾‹å­**ï¼šæ¨¡æ‹Ÿè®°äº‹æœ¬çš„æ’¤é”€é‡åšåŠŸèƒ½

```java
// æ–‡æœ¬ç¼–è¾‘å‘½ä»¤
class TextCommand implements Command {
    private TextEditor editor;
    private String backup;  // å¤‡ä»½å½“å‰çŠ¶æ€
    private int position;
    private String text;
    
    public TextCommand(TextEditor editor, int position, String text) {
        this.editor = editor;
        this.position = position;
        this.text = text;
    }
    
    public void execute() {
        backup = editor.getContent();  // æ‰§è¡Œå‰å¤‡ä»½
        editor.insertText(position, text);
    }
    
    public void undo() {
        editor.setContent(backup);  // æ¢å¤åˆ°æ‰§è¡Œå‰çŠ¶æ€
    }
}

// æ’¤é”€é‡åšç®¡ç†å™¨
class UndoRedoManager {
    private Stack<Command> undoStack = new Stack<>();
    private Stack<Command> redoStack = new Stack<>();
    
    public void executeCommand(Command command) {
        command.execute();
        undoStack.push(command);
        redoStack.clear();  // æ‰§è¡Œæ–°å‘½ä»¤åæ¸…ç©ºé‡åšæ ˆ
    }
    
    public void undo() {
        if (!undoStack.isEmpty()) {
            Command command = undoStack.pop();
            command.undo();
            redoStack.push(command);
        }
    }
    
    public void redo() {
        if (!redoStack.isEmpty()) {
            Command command = redoStack.pop();
            command.execute();
            undoStack.push(command);
        }
    }
}
```

### 3.3 ä¸åŒç±»å‹æ“ä½œçš„æ’¤é”€ç­–ç•¥


ğŸ“‹ **æ’¤é”€ç­–ç•¥å¯¹ç…§è¡¨**ï¼š

| æ“ä½œç±»å‹ | **æ’¤é”€ç­–ç•¥** | **éœ€è¦è®°å½•çš„ä¿¡æ¯** |
|---------|-------------|------------------|
| **æ–‡æœ¬æ’å…¥** | åˆ é™¤æ’å…¥çš„æ–‡æœ¬ | æ’å…¥ä½ç½®ã€æ’å…¥å†…å®¹ |
| **æ–‡æœ¬åˆ é™¤** | é‡æ–°æ’å…¥åˆ é™¤çš„æ–‡æœ¬ | åˆ é™¤ä½ç½®ã€åˆ é™¤å†…å®¹ |
| **æ–‡ä»¶ç§»åŠ¨** | ç§»å›åŸä½ç½® | åŸè·¯å¾„ã€æ–°è·¯å¾„ |
| **å±æ€§ä¿®æ”¹** | æ¢å¤åŸå±æ€§å€¼ | åŸå±æ€§å€¼ã€æ–°å±æ€§å€¼ |

### 3.4 æ’¤é”€åŠŸèƒ½çš„é«˜çº§ç‰¹æ€§


ğŸ”§ **é«˜çº§åŠŸèƒ½å®ç°**ï¼š

**åˆ†ç»„æ’¤é”€**ï¼š
```java
// æŠŠå¤šä¸ªç›¸å…³æ“ä½œä½œä¸ºä¸€ç»„æ’¤é”€
class MacroCommand implements Command {
    private List<Command> commands = new ArrayList<>();
    
    public void add(Command command) {
        commands.add(command);
    }
    
    public void execute() {
        for (Command cmd : commands) {
            cmd.execute();
        }
    }
    
    public void undo() {
        // é€†åºæ’¤é”€
        for (int i = commands.size() - 1; i >= 0; i--) {
            commands.get(i).undo();
        }
    }
}
```

**å†…å­˜ä¼˜åŒ–**ï¼š
```java
// é™åˆ¶æ’¤é”€æ ˆå¤§å°ï¼Œé¿å…å†…å­˜è¿‡å¤§
class LimitedUndoManager {
    private static final int MAX_UNDO_SIZE = 50;
    private LinkedList<Command> undoList = new LinkedList<>();
    
    public void executeCommand(Command command) {
        if (undoList.size() >= MAX_UNDO_SIZE) {
            undoList.removeFirst();  // ç§»é™¤æœ€è€çš„å‘½ä»¤
        }
        undoList.addLast(command);
        command.execute();
    }
}
```

---

## 4. ğŸ”„ äº‹åŠ¡æ“ä½œç®¡ç†


### 4.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡æ“ä½œ


ğŸ·ï¸ **äº‹åŠ¡** = ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸èƒ½åªæˆåŠŸä¸€åŠã€‚

ğŸŒ° **ç”Ÿæ´»ä¾‹å­**ï¼š
```
é“¶è¡Œè½¬è´¦äº‹åŠ¡ï¼š
1. ä»Aè´¦æˆ·æ‰£é’±
2. å‘Bè´¦æˆ·åŠ é’±
3. è®°å½•è½¬è´¦æ—¥å¿—

å¦‚æœç¬¬2æ­¥å¤±è´¥äº†ï¼Œç¬¬1æ­¥å¿…é¡»æ’¤é”€ï¼Œå¦åˆ™é’±å°±ä¸¢äº†ï¼
```

### 4.2 ç”¨å‘½ä»¤æ¨¡å¼å®ç°äº‹åŠ¡ç®¡ç†


ğŸ—ï¸ **äº‹åŠ¡ç®¡ç†æ¶æ„**ï¼š
```
äº‹åŠ¡ç®¡ç†å™¨
    â”œâ”€â”€ å¼€å§‹äº‹åŠ¡
    â”œâ”€â”€ æ‰§è¡Œå‘½ä»¤åºåˆ—
    â”œâ”€â”€ æäº¤äº‹åŠ¡ (å…¨éƒ¨æˆåŠŸ)
    â””â”€â”€ å›æ»šäº‹åŠ¡ (æœ‰å¤±è´¥æ—¶æ’¤é”€æ‰€æœ‰æ“ä½œ)
```

**æ ¸å¿ƒä»£ç å®ç°**ï¼š

```java
// å¯æ’¤é”€çš„æ•°æ®åº“å‘½ä»¤
abstract class DatabaseCommand implements Command {
    protected boolean executed = false;
    
    public abstract void execute() throws Exception;
    public abstract void rollback();
    
    public boolean isExecuted() {
        return executed;
    }
}

// äº‹åŠ¡ç®¡ç†å™¨
class TransactionManager {
    private List<DatabaseCommand> commands = new ArrayList<>();
    private boolean committed = false;
    
    public void addCommand(DatabaseCommand command) {
        commands.add(command);
    }
    
    public boolean executeTransaction() {
        try {
            // æ‰§è¡Œæ‰€æœ‰å‘½ä»¤
            for (DatabaseCommand cmd : commands) {
                cmd.execute();
            }
            committed = true;
            return true;
        } catch (Exception e) {
            // æœ‰ä»»ä½•å¤±è´¥å°±å›æ»šæ‰€æœ‰å·²æ‰§è¡Œçš„å‘½ä»¤
            rollback();
            return false;
        }
    }
    
    private void rollback() {
        // é€†åºå›æ»šå·²æ‰§è¡Œçš„å‘½ä»¤
        for (int i = commands.size() - 1; i >= 0; i--) {
            DatabaseCommand cmd = commands.get(i);
            if (cmd.isExecuted()) {
                cmd.rollback();
            }
        }
    }
}
```

### 4.3 å…·ä½“çš„æ•°æ®åº“äº‹åŠ¡ç¤ºä¾‹


```java
// è½¬è´¦äº‹åŠ¡ç¤ºä¾‹
class TransferCommand extends DatabaseCommand {
    private String fromAccount, toAccount;
    private double amount;
    private DatabaseService db;
    
    public void execute() throws Exception {
        db.updateBalance(fromAccount, -amount);  // æ‰£æ¬¾
        db.updateBalance(toAccount, amount);     // åŠ æ¬¾
        db.insertTransferLog(fromAccount, toAccount, amount);  // è®°å½•
        executed = true;
    }
    
    public void rollback() {
        if (executed) {
            db.updateBalance(fromAccount, amount);   // æ¢å¤æ‰£æ¬¾
            db.updateBalance(toAccount, -amount);    // æ¢å¤åŠ æ¬¾
            db.deleteTransferLog(fromAccount, toAccount, amount);  // åˆ é™¤è®°å½•
        }
    }
}

// ä½¿ç”¨æ–¹å¼
TransactionManager transaction = new TransactionManager();
transaction.addCommand(new TransferCommand("è´¦æˆ·A", "è´¦æˆ·B", 1000.0));
transaction.addCommand(new TransferCommand("è´¦æˆ·B", "è´¦æˆ·C", 500.0));

if (transaction.executeTransaction()) {
    System.out.println("è½¬è´¦æˆåŠŸ");
} else {
    System.out.println("è½¬è´¦å¤±è´¥ï¼Œå·²å›æ»š");
}
```

### 4.4 äº‹åŠ¡ç®¡ç†çš„å®é™…ä»·å€¼


â­ **æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **åŸå­æ€§ä¿è¯**ï¼šè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
- **ä¸€è‡´æ€§ç»´æŠ¤**ï¼šæ•°æ®å§‹ç»ˆä¿æŒæ­£ç¡®çŠ¶æ€
- **é”™è¯¯æ¢å¤**ï¼šå‡ºé”™æ—¶è‡ªåŠ¨å›æ»šåˆ°åˆå§‹çŠ¶æ€
- **æ“ä½œå®¡è®¡**ï¼šå¯ä»¥è®°å½•æ‰€æœ‰äº‹åŠ¡æ“ä½œå†å²

---

## 5. â° ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ


### 5.1 ä»»åŠ¡è°ƒåº¦çš„æ ¸å¿ƒéœ€æ±‚


ğŸ’­ **æƒ³æƒ³çœ‹**ï¼šä¼ä¸šç³»ç»Ÿä¸­æœ‰å¾ˆå¤šå®šæ—¶ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š
- æ¯å¤©å‡Œæ™¨å¤‡ä»½æ•°æ®åº“
- æ¯å°æ—¶å‘é€ç›‘æ§æŠ¥å‘Š
- æœˆåº•ç”Ÿæˆè´¢åŠ¡æŠ¥è¡¨

ğŸ” **è°ƒåº¦ç³»ç»Ÿè¦è§£å†³çš„é—®é¢˜**ï¼š
- **ä»»åŠ¡æ’é˜Ÿ**ï¼šå¤šä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ
- **å®šæ—¶æ‰§è¡Œ**ï¼šåœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œä»»åŠ¡
- **å¤±è´¥é‡è¯•**ï¼šä»»åŠ¡å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
- **ä»»åŠ¡ç›‘æ§**ï¼šæŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€

### 5.2 å‘½ä»¤æ¨¡å¼çš„ä»»åŠ¡è°ƒåº¦è®¾è®¡


ğŸ—ï¸ **è°ƒåº¦ç³»ç»Ÿæ¶æ„**ï¼š
```
ä»»åŠ¡è°ƒåº¦å™¨
    â”œâ”€â”€ ä»»åŠ¡é˜Ÿåˆ— (Command Queue)
    â”œâ”€â”€ å®šæ—¶å™¨ (Timer)
    â”œâ”€â”€ æ‰§è¡Œå™¨ (Executor)
    â””â”€â”€ ç›‘æ§å™¨ (Monitor)
```

**æ ¸å¿ƒå®ç°ä»£ç **ï¼š

```java
// å¯è°ƒåº¦çš„ä»»åŠ¡å‘½ä»¤
abstract class ScheduledCommand implements Command {
    private String taskId;
    private LocalDateTime scheduledTime;
    private int retryCount = 0;
    private int maxRetries = 3;
    
    public ScheduledCommand(String taskId, LocalDateTime scheduledTime) {
        this.taskId = taskId;
        this.scheduledTime = scheduledTime;
    }
    
    public abstract void doExecute() throws Exception;
    
    public void execute() {
        try {
            doExecute();
            System.out.println("ä»»åŠ¡ " + taskId + " æ‰§è¡ŒæˆåŠŸ");
        } catch (Exception e) {
            handleFailure(e);
        }
    }
    
    private void handleFailure(Exception e) {
        retryCount++;
        if (retryCount <= maxRetries) {
            System.out.println("ä»»åŠ¡ " + taskId + " å¤±è´¥ï¼Œå‡†å¤‡é‡è¯• " + retryCount);
            // é‡æ–°åŠ å…¥è°ƒåº¦é˜Ÿåˆ—
            TaskScheduler.getInstance().scheduleRetry(this);
        } else {
            System.out.println("ä»»åŠ¡ " + taskId + " å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œå–æ¶ˆæ‰§è¡Œ");
        }
    }
}

// ä»»åŠ¡è°ƒåº¦å™¨
class TaskScheduler {
    private PriorityQueue<ScheduledCommand> taskQueue;
    private ScheduledExecutorService executor;
    
    public void schedule(ScheduledCommand command) {
        taskQueue.offer(command);
    }
    
    public void start() {
        executor.scheduleWithFixedDelay(() -> {
            processPendingTasks();
        }, 0, 1, TimeUnit.SECONDS);
    }
    
    private void processPendingTasks() {
        LocalDateTime now = LocalDateTime.now();
        while (!taskQueue.isEmpty()) {
            ScheduledCommand task = taskQueue.peek();
            if (task.getScheduledTime().isBefore(now)) {
                taskQueue.poll();
                task.execute();
            } else {
                break; // é˜Ÿåˆ—æŒ‰æ—¶é—´æ’åºï¼Œåé¢çš„ä»»åŠ¡è¿˜æ²¡åˆ°æ—¶é—´
            }
        }
    }
}
```

### 5.3 å…·ä½“çš„ä»»åŠ¡ç±»å‹å®ç°


**æ•°æ®å¤‡ä»½ä»»åŠ¡**ï¼š
```java
class DatabaseBackupCommand extends ScheduledCommand {
    private DatabaseService dbService;
    private String backupPath;
    
    public DatabaseBackupCommand(LocalDateTime scheduledTime, String backupPath) {
        super("DB_BACKUP", scheduledTime);
        this.backupPath = backupPath;
    }
    
    public void doExecute() throws Exception {
        dbService.createBackup(backupPath);
        System.out.println("æ•°æ®åº“å¤‡ä»½å®Œæˆ: " + backupPath);
    }
}

class EmailReportCommand extends ScheduledCommand {
    private EmailService emailService;
    private String recipient;
    
    public void doExecute() throws Exception {
        String report = generateDailyReport();
        emailService.sendEmail(recipient, "æ—¥æŠ¥", report);
    }
}
```

### 5.4 ä»»åŠ¡è°ƒåº¦çš„é«˜çº§ç‰¹æ€§


**ä»»åŠ¡ä¾èµ–å…³ç³»**ï¼š
```java
class DependentCommand extends ScheduledCommand {
    private List<String> dependsOn;  // ä¾èµ–çš„ä»»åŠ¡ID
    
    public boolean canExecute() {
        // æ£€æŸ¥ä¾èµ–çš„ä»»åŠ¡æ˜¯å¦éƒ½å·²å®Œæˆ
        return TaskScheduler.getInstance().areTasksCompleted(dependsOn);
    }
}
```

**ä»»åŠ¡ä¼˜å…ˆçº§**ï¼š
```java
class PriorityCommand extends ScheduledCommand implements Comparable<PriorityCommand> {
    private int priority;  // æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    
    public int compareTo(PriorityCommand other) {
        return Integer.compare(this.priority, other.priority);
    }
}
```

---

## 6. ğŸŒ è¿œç¨‹è¿‡ç¨‹è°ƒç”¨


### 6.1 è¿œç¨‹è°ƒç”¨çš„åŸºæœ¬æ¦‚å¿µ


ğŸ·ï¸ **è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)** = è®©ä½ èƒ½å¤Ÿè°ƒç”¨å…¶ä»–æœºå™¨ä¸Šçš„æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚

ğŸŒ° **ç”Ÿæ´»ç±»æ¯”**ï¼š
```
æœ¬åœ°è°ƒç”¨ = è‡ªå·±åšé¥­
è¿œç¨‹è°ƒç”¨ = æ‰“ç”µè¯å«å¤–å–

æ‰“ç”µè¯å«å¤–å–çš„è¿‡ç¨‹ï¼š
1. ä½ æ‰“ç”µè¯(å‘é€è¯·æ±‚)
2. é¤å…æ¥ç”µè¯(æ¥æ”¶è¯·æ±‚)  
3. é¤å…åšèœ(æ‰§è¡Œæ–¹æ³•)
4. é€é¤åˆ°ä½ å®¶(è¿”å›ç»“æœ)
```

### 6.2 å‘½ä»¤æ¨¡å¼åœ¨RPCä¸­çš„åº”ç”¨


ğŸ” **ä¸ºä»€ä¹ˆç”¨å‘½ä»¤æ¨¡å¼**ï¼š
- **è¯·æ±‚å°è£…**ï¼šæŠŠè¿œç¨‹è°ƒç”¨çš„å‚æ•°å’Œæ–¹æ³•åå°è£…æˆå¯¹è±¡
- **å¼‚æ­¥æ‰§è¡Œ**ï¼šå¯ä»¥æŠŠè¯·æ±‚æ”¾åˆ°é˜Ÿåˆ—ä¸­æ…¢æ…¢å¤„ç†
- **é‡è¯•æœºåˆ¶**ï¼šç½‘ç»œå¤±è´¥æ—¶å¯ä»¥é‡æ–°å‘é€å‘½ä»¤
- **æ‰¹é‡æ“ä½œ**ï¼šå¯ä»¥æŠŠå¤šä¸ªè¯·æ±‚æ‰“åŒ…ä¸€èµ·å‘é€

### 6.3 RPCå‘½ä»¤æ¨¡å¼å®ç°


**åŸºç¡€æ¶æ„è®¾è®¡**ï¼š
```
å®¢æˆ·ç«¯                           æœåŠ¡ç«¯
RemoteCommand  â†’  Network  â†’  CommandProcessor
     â†“                             â†“
CommandProxy                 RealService
```

**æ ¸å¿ƒä»£ç å®ç°**ï¼š

```java
// è¿œç¨‹å‘½ä»¤æ¥å£
interface RemoteCommand extends Serializable {
    String getMethodName();
    Object[] getParameters();
    Class<?>[] getParameterTypes();
    Object execute(Object target) throws Exception;
}

// å…·ä½“è¿œç¨‹å‘½ä»¤
class GetUserCommand implements RemoteCommand {
    private int userId;
    
    public GetUserCommand(int userId) {
        this.userId = userId;
    }
    
    public String getMethodName() {
        return "getUser";
    }
    
    public Object[] getParameters() {
        return new Object[]{userId};
    }
    
    public Object execute(Object target) throws Exception {
        UserService service = (UserService) target;
        return service.getUser(userId);
    }
}

// RPCå®¢æˆ·ç«¯
class RpcClient {
    private String serverUrl;
    
    public Object invoke(RemoteCommand command) {
        try {
            // åºåˆ—åŒ–å‘½ä»¤
            byte[] data = serialize(command);
            
            // å‘é€åˆ°æœåŠ¡å™¨
            byte[] response = sendToServer(data);
            
            // ååºåˆ—åŒ–ç»“æœ
            return deserialize(response);
        } catch (Exception e) {
            throw new RuntimeException("RPCè°ƒç”¨å¤±è´¥", e);
        }
    }
}

// RPCæœåŠ¡ç«¯
class RpcServer {
    private Map<String, Object> services = new HashMap<>();
    
    public void registerService(String name, Object service) {
        services.put(name, service);
    }
    
    public Object processCommand(RemoteCommand command) {
        try {
            String serviceName = extractServiceName(command.getMethodName());
            Object service = services.get(serviceName);
            return command.execute(service);
        } catch (Exception e) {
            return new ErrorResult(e.getMessage());
        }
    }
}
```

### 6.4 å¼‚æ­¥RPCå’Œæ‰¹é‡è°ƒç”¨


**å¼‚æ­¥è°ƒç”¨å®ç°**ï¼š
```java
class AsyncRpcClient {
    private ExecutorService executor = Executors.newCachedThreadPool();
    
    public Future<Object> invokeAsync(RemoteCommand command) {
        return executor.submit(() -> {
            return invoke(command);
        });
    }
    
    // æ‰¹é‡å¼‚æ­¥è°ƒç”¨
    public List<Future<Object>> invokeBatch(List<RemoteCommand> commands) {
        return commands.stream()
                .map(this::invokeAsync)
                .collect(Collectors.toList());
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// å¼‚æ­¥è·å–ç”¨æˆ·ä¿¡æ¯
AsyncRpcClient client = new AsyncRpcClient();
Future<Object> userFuture = client.invokeAsync(new GetUserCommand(123));
Future<Object> orderFuture = client.invokeAsync(new GetOrdersCommand(123));

// ç­‰å¾…ç»“æœ
User user = (User) userFuture.get();
List<Order> orders = (List<Order>) orderFuture.get();
```

### 6.5 RPCä¸­å‘½ä»¤æ¨¡å¼çš„ä¼˜åŠ¿


âœ… **å®é™…åº”ç”¨ä»·å€¼**ï¼š

**ç½‘ç»œé‡è¯•**ï¼š
```java
class RetryableRpcCommand implements RemoteCommand {
    private RemoteCommand innerCommand;
    private int maxRetries = 3;
    
    public Object executeWithRetry() {
        Exception lastException = null;
        for (int i = 0; i < maxRetries; i++) {
            try {
                return rpcClient.invoke(innerCommand);
            } catch (NetworkException e) {
                lastException = e;
                try { Thread.sleep(1000 * i); } catch (InterruptedException ie) {}
            }
        }
        throw new RuntimeException("RPCè°ƒç”¨å¤±è´¥", lastException);
    }
}
```

**è¯·æ±‚ç¼“å­˜**ï¼š
```java
class CachedRpcCommand implements RemoteCommand {
    private RemoteCommand innerCommand;
    private Cache<String, Object> cache;
    
    public Object execute(Object target) throws Exception {
        String key = generateCacheKey();
        Object cached = cache.get(key);
        if (cached != null) {
            return cached;
        }
        
        Object result = innerCommand.execute(target);
        cache.put(key, result);
        return result;
    }
}
```

---

## 7. ğŸ¯ å®é™…é¡¹ç›®é€‰æ‹©æŒ‡å—


### 7.1 ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å‘½ä»¤æ¨¡å¼


âœ… **é€‚åˆä½¿ç”¨çš„åœºæ™¯**ï¼š

```
ğŸ“‹ éœ€è¦æ’¤é”€åŠŸèƒ½çš„åº”ç”¨
â†’ æ–‡æœ¬ç¼–è¾‘å™¨ã€å›¾å½¢è®¾è®¡è½¯ä»¶ã€CADå·¥å…·

ğŸ”„ éœ€è¦äº‹åŠ¡ç®¡ç†çš„ç³»ç»Ÿ  
â†’ æ•°æ®åº“æ“ä½œã€é‡‘èç³»ç»Ÿã€ç”µå•†è®¢å•

â° éœ€è¦ä»»åŠ¡è°ƒåº¦çš„ç³»ç»Ÿ
â†’ å®šæ—¶ä»»åŠ¡ã€æ‰¹å¤„ç†ã€å·¥ä½œæµå¼•æ“

ğŸŒ åˆ†å¸ƒå¼ç³»ç»Ÿ
â†’ å¾®æœåŠ¡è°ƒç”¨ã€æ¶ˆæ¯é˜Ÿåˆ—ã€RPCæ¡†æ¶

ğŸ® éœ€è¦å®å‘½ä»¤çš„åœºæ™¯
â†’ æ¸¸æˆæŠ€èƒ½ç»„åˆã€è‡ªåŠ¨åŒ–è„šæœ¬ã€æ‰¹é‡æ“ä½œ
```

### 7.2 ä¸é€‚åˆä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„åœºæ™¯


âŒ **ä¸å»ºè®®ä½¿ç”¨çš„æƒ…å†µ**ï¼š

```
ç®€å•çš„æ–¹æ³•è°ƒç”¨ï¼š
- åªæ˜¯ç®€å•çš„getter/setter
- ä¸€æ¬¡æ€§çš„æ“ä½œï¼Œä¸éœ€è¦æ’¤é”€
- æ²¡æœ‰å¤æ‚çš„è°ƒç”¨å…³ç³»

æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯ï¼š
- æ¯ç§’ç™¾ä¸‡æ¬¡çš„ç®€å•æ“ä½œ
- å†…å­˜éå¸¸ç´§å¼ çš„åµŒå…¥å¼ç³»ç»Ÿ
- å¯¹è±¡åˆ›å»ºå¼€é”€ä¸èƒ½æ¥å—çš„åœºæ™¯
```

### 7.3 å‘½ä»¤æ¨¡å¼çš„æœ€ä½³å®è·µ


ğŸ¯ **è®¾è®¡å»ºè®®**ï¼š

**å‘½ä»¤ç²’åº¦æ§åˆ¶**ï¼š
```java
// âœ… æ¨èï¼šåˆé€‚çš„ç²’åº¦
class SaveDocumentCommand implements Command {
    // ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡æ“ä½œ
}

// âŒ é¿å…ï¼šç²’åº¦è¿‡å°
class SetTitleCommand implements Command {
    // åªè®¾ç½®ä¸€ä¸ªå±æ€§ï¼Œå¤ªç»†äº†
}

// âŒ é¿å…ï¼šç²’åº¦è¿‡å¤§  
class ProcessAllDataCommand implements Command {
    // åŒ…å«å¤ªå¤šä¸ç›¸å…³çš„æ“ä½œ
}
```

**å†…å­˜ç®¡ç†**ï¼š
```java
// é™åˆ¶å‘½ä»¤å†å²å¤§å°
class CommandHistory {
    private static final int MAX_HISTORY = 100;
    private Deque<Command> history = new ArrayDeque<>();
    
    public void add(Command command) {
        if (history.size() >= MAX_HISTORY) {
            history.removeFirst();
        }
        history.addLast(command);
    }
}
```

**é”™è¯¯å¤„ç†**ï¼š
```java
// ä¸ºå‘½ä»¤æ·»åŠ é”™è¯¯å¤„ç†
interface Command {
    void execute() throws CommandException;
    void undo() throws CommandException;
    boolean canExecute();  // æ‰§è¡Œå‰æ£€æŸ¥
    boolean canUndo();     // æ’¤é”€å‰æ£€æŸ¥
}
```

### 7.4 å‘½ä»¤æ¨¡å¼ä¸å…¶ä»–æ¨¡å¼çš„é…åˆ


ğŸ”— **å¸¸è§ç»„åˆä½¿ç”¨**ï¼š

**å‘½ä»¤æ¨¡å¼ + è§‚å¯Ÿè€…æ¨¡å¼**ï¼š
```java
// å‘½ä»¤æ‰§è¡Œæ—¶é€šçŸ¥è§‚å¯Ÿè€…
class ObservableCommand implements Command {
    private List<CommandObserver> observers = new ArrayList<>();
    
    public void execute() {
        notifyBefore();
        doExecute();
        notifyAfter();
    }
}
```

**å‘½ä»¤æ¨¡å¼ + ç­–ç•¥æ¨¡å¼**ï¼š
```java
// æ ¹æ®ä¸åŒç­–ç•¥é€‰æ‹©ä¸åŒçš„å‘½ä»¤
class CommandFactory {
    public Command createCommand(String type, Object... params) {
        switch (type) {
            case "save": return new SaveCommand(params);
            case "load": return new LoadCommand(params);
            default: throw new IllegalArgumentException();
        }
    }
}
```

**å‘½ä»¤æ¨¡å¼ + è£…é¥°å™¨æ¨¡å¼**ï¼š
```java
// ä¸ºå‘½ä»¤æ·»åŠ é¢å¤–åŠŸèƒ½
class LoggingCommandDecorator implements Command {
    private Command command;
    
    public void execute() {
        log("å¼€å§‹æ‰§è¡Œ: " + command.getClass().getSimpleName());
        command.execute();
        log("æ‰§è¡Œå®Œæˆ");
    }
}
```

## ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### æ ¸å¿ƒæ¦‚å¿µç†è§£

```
ğŸ”¸ å‘½ä»¤æ¨¡å¼æœ¬è´¨ï¼šæŠŠè¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œå®ç°è°ƒç”¨è€…ä¸æ¥æ”¶è€…è§£è€¦
ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿ï¼šæ”¯æŒæ’¤é”€ã€æ’é˜Ÿã€æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†
ğŸ”¸ é€‚ç”¨åœºæ™¯ï¼šGUIæ“ä½œã€äº‹åŠ¡ç³»ç»Ÿã€ä»»åŠ¡è°ƒåº¦ã€RPCè°ƒç”¨
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šåˆé€‚çš„å‘½ä»¤ç²’åº¦ã€è‰¯å¥½çš„é”™è¯¯å¤„ç†ã€é€‚å½“çš„å†…å­˜ç®¡ç†
```

### å®é™…åº”ç”¨æŒ‡å¯¼

- **GUIå¼€å‘**ï¼šå®ç°æ’¤é”€é‡åšï¼Œæ”¯æŒå¿«æ·é”®å’Œå·¥å…·æ 
- **ç³»ç»Ÿé›†æˆ**ï¼šäº‹åŠ¡ç®¡ç†ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **ä»»åŠ¡å¤„ç†**ï¼šæ„å»ºå¯é çš„è°ƒåº¦å’Œæ‰§è¡Œç³»ç»Ÿ
- **åˆ†å¸ƒå¼ç³»ç»Ÿ**ï¼šå®ç°å¯é çš„è¿œç¨‹è°ƒç”¨å’Œæ¶ˆæ¯ä¼ é€’

ğŸ’¡ **è®°å¿†è¦ç‚¹**ï¼šå‘½ä»¤æ¨¡å¼å°±åƒç”Ÿæ´»ä¸­çš„"é¥æ§å™¨"ï¼ŒæŠŠå„ç§æ“ä½œå˜æˆæŒ‰é’®ï¼Œå¯ä»¥éšæ—¶æŒ‰ï¼Œä¹Ÿå¯ä»¥æ’¤é”€ï¼Œè¿˜èƒ½å½•åˆ¶å®æ“ä½œï¼