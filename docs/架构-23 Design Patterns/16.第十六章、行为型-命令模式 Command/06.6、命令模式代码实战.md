---
title: 6ã€å‘½ä»¤æ¨¡å¼ä»£ç å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å‘½ä»¤æ¨¡å¼](#1-ä»€ä¹ˆæ˜¯å‘½ä»¤æ¨¡å¼)
2. [ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼](#2-ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼)
3. [å‘½ä»¤æ¨¡å¼çš„æ ¸å¿ƒè§’è‰²](#3-å‘½ä»¤æ¨¡å¼çš„æ ¸å¿ƒè§’è‰²)
4. [åŸºç¡€å®ç°æ¼”ç¤º](#4-åŸºç¡€å®ç°æ¼”ç¤º)
5. [æ’¤é”€åŠŸèƒ½å®ç°](#5-æ’¤é”€åŠŸèƒ½å®ç°)
6. [å‘½ä»¤é˜Ÿåˆ—ä¸æ‰¹å¤„ç†](#6-å‘½ä»¤é˜Ÿåˆ—ä¸æ‰¹å¤„ç†)
7. [å®å‘½ä»¤ç»„åˆåº”ç”¨](#7-å®å‘½ä»¤ç»„åˆåº”ç”¨)
8. [æ–‡æœ¬ç¼–è¾‘å™¨å®æˆ˜æ¡ˆä¾‹](#8-æ–‡æœ¬ç¼–è¾‘å™¨å®æˆ˜æ¡ˆä¾‹)
9. [åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ](#9-åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯å‘½ä»¤æ¨¡å¼


### 1.1 ç”Ÿæ´»ä¸­çš„å‘½ä»¤æ¨¡å¼


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> å‘½ä»¤æ¨¡å¼å°±åƒé¤å…ç‚¹èœï¼šä½ ä¸ç›´æ¥å‘Šè¯‰å¨å¸ˆæ€ä¹ˆåšèœï¼Œè€Œæ˜¯å†™ä¸€å¼ èœå•å•å­ç»™æœåŠ¡å‘˜ï¼ŒæœåŠ¡å‘˜å†æŠŠå•å­ä¼ ç»™å¨å¸ˆã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥æ’é˜Ÿã€å¯ä»¥å–æ¶ˆã€å¯ä»¥é‡åšã€‚

**ç°å®åœºæ™¯å¯¹æ¯”**ï¼š
```
ç›´æ¥æ¨¡å¼ï¼šå®¢æˆ· â†’ å¨å¸ˆï¼ˆç´§å¯†è€¦åˆï¼‰
å‘½ä»¤æ¨¡å¼ï¼šå®¢æˆ· â†’ è®¢å•å•å­ â†’ æœåŠ¡å‘˜ â†’ å¨å¸ˆï¼ˆè§£è€¦ï¼‰

ä¼˜åŠ¿ï¼š
ğŸ”¸ å¯ä»¥æ’é˜Ÿå¤„ç†å¤šä¸ªè®¢å•
ğŸ”¸ å¯ä»¥å–æ¶ˆè¿˜æ²¡åšçš„èœ
ğŸ”¸ å¯ä»¥é‡æ–°åˆ¶ä½œåŒæ ·çš„èœ
ğŸ”¸ å¯ä»¥æ‰¹é‡å¤„ç†è®¢å•
```

### 1.2 ç¨‹åºä¸­çš„å‘½ä»¤æ¨¡å¼


**å®šä¹‰**ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥å°†ä¸åŒçš„è¯·æ±‚ã€é˜Ÿåˆ—è¯·æ±‚ã€è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒæ’¤é”€æ“ä½œã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š
- **è¯·æ±‚å°è£…**ï¼šæŠŠ"åšä»€ä¹ˆ"åŒ…è£…æˆä¸€ä¸ªå¯¹è±¡
- **è°ƒç”¨è§£è€¦**ï¼šè°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“å…·ä½“æ€ä¹ˆæ‰§è¡Œ
- **æ“ä½œè®°å½•**ï¼šå¯ä»¥ä¿å­˜ã€æ’¤é”€ã€é‡åšæ“ä½œ

### 1.3 å‘½ä»¤æ¨¡å¼çš„ä»·å€¼


```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç›´æ¥è°ƒç”¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¥æ§å™¨    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   ç”µè§†æœº    â”‚
â”‚  (è°ƒç”¨è€…)   â”‚               â”‚  (æ¥æ”¶è€…)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šé¥æ§å™¨å¿…é¡»çŸ¥é“æ¯ä¸ªè®¾å¤‡çš„å…·ä½“æ“ä½œæ–¹æ³•

å‘½ä»¤æ¨¡å¼çš„è§£å†³ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é¥æ§å™¨    â”‚â”€â”€â”€â†’â”‚   å‘½ä»¤å¯¹è±¡   â”‚â”€â”€â”€â†’â”‚   ç”µè§†æœº    â”‚
â”‚  (è°ƒç”¨è€…)   â”‚    â”‚ (å°è£…è¯·æ±‚)  â”‚    â”‚  (æ¥æ”¶è€…)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜åŠ¿ï¼šé¥æ§å™¨åªéœ€è¦è°ƒç”¨å‘½ä»¤çš„execute()æ–¹æ³•
```

---

## 2. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å‘½ä»¤æ¨¡å¼


### 2.1 è§£å†³çš„æ ¸å¿ƒé—®é¢˜


> **âš ï¸ å¸¸è§é—®é¢˜**  
> æ²¡æœ‰å‘½ä»¤æ¨¡å¼æ—¶ï¼Œè°ƒç”¨è€…å’Œæ¥æ”¶è€…ç´§å¯†è€¦åˆï¼Œä»£ç éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•

**é—®é¢˜åœºæ™¯**ï¼š
```java
// âŒ æ²¡æœ‰å‘½ä»¤æ¨¡å¼çš„é—®é¢˜ä»£ç 
class RemoteControl {
    private TV tv;
    private AirConditioner ac;
    
    public void buttonPressed(String device, String action) {
        if(device.equals("TV")) {
            if(action.equals("ON")) {
                tv.turnOn();
            } else if(action.equals("OFF")) {
                tv.turnOff();
            }
        } else if(device.equals("AC")) {
            if(action.equals("ON")) {
                ac.powerOn();
            } else if(action.equals("OFF")) {
                ac.powerOff();
            }
        }
        // æ¯å¢åŠ ä¸€ä¸ªè®¾å¤‡ï¼Œè¿™é‡Œå°±è¦ä¿®æ”¹ä»£ç ï¼
    }
}
```

**é—®é¢˜åˆ†æ**ï¼š
- ğŸ”´ **é«˜è€¦åˆ**ï¼šé¥æ§å™¨å¿…é¡»çŸ¥é“æ‰€æœ‰è®¾å¤‡çš„å…·ä½“æ–¹æ³•
- ğŸ”´ **éš¾æ‰©å±•**ï¼šæ·»åŠ æ–°è®¾å¤‡éœ€è¦ä¿®æ”¹é¥æ§å™¨ä»£ç 
- ğŸ”´ **æ— æ³•æ’¤é”€**ï¼šæ‰§è¡Œåæ— æ³•å›é€€æ“ä½œ
- ğŸ”´ **æ— æ³•æ’é˜Ÿ**ï¼šä¸èƒ½å»¶è¿Ÿæˆ–æ‰¹é‡æ‰§è¡Œ

### 2.2 å‘½ä»¤æ¨¡å¼çš„è§£å†³æ–¹æ¡ˆ


**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

| é—®é¢˜ | ä¼ ç»Ÿæ–¹å¼ | å‘½ä»¤æ¨¡å¼ | æ”¹å–„æ•ˆæœ |
|------|---------|----------|----------|
| **è€¦åˆåº¦** | è°ƒç”¨è€…ç›´æ¥ä¾èµ–æ¥æ”¶è€… | è°ƒç”¨è€…åªä¾èµ–å‘½ä»¤æ¥å£ | â­â­â­â­â­ |
| **æ‰©å±•æ€§** | ä¿®æ”¹è°ƒç”¨è€…ä»£ç  | åªéœ€æ·»åŠ æ–°å‘½ä»¤ç±» | â­â­â­â­â­ |
| **æ’¤é”€æ“ä½œ** | æ— æ³•å®ç° | å‘½ä»¤è®°å½•çŠ¶æ€ä¿¡æ¯ | â­â­â­â­â­ |
| **æ‰¹å¤„ç†** | æ— æ³•å®ç° | å‘½ä»¤é˜Ÿåˆ—æ‰§è¡Œ | â­â­â­â­â­ |

---

## 3. ğŸ—ï¸ å‘½ä»¤æ¨¡å¼çš„æ ¸å¿ƒè§’è‰²


### 3.1 è§’è‰²èŒè´£åˆ†å·¥


```
å‘½ä»¤æ¨¡å¼è§’è‰²å…³ç³»å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ä½¿ç”¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è°ƒç”¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   è°ƒç”¨è€…    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   å‘½ä»¤æ¥å£   â”‚
â”‚  (Client)   â”‚          â”‚ (Invoker)   â”‚          â”‚ (Command)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼ å®ç°
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ“ä½œ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚  å…·ä½“å‘½ä»¤   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   æ¥æ”¶è€…    â”‚
                                                 â”‚(ConcreteCmd)â”‚          â”‚ (Receiver)  â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å„è§’è‰²è¯¦ç»†è¯´æ˜


**ğŸ”¸ Commandï¼ˆå‘½ä»¤æ¥å£ï¼‰**
```java
// å®šä¹‰ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£
interface Command {
    void execute();    // æ‰§è¡Œå‘½ä»¤
    void undo();      // æ’¤é”€å‘½ä»¤ï¼ˆå¯é€‰ï¼‰
}
```
> **ä½œç”¨**ï¼šè§„å®šæ‰€æœ‰å‘½ä»¤å¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œä¿è¯è°ƒç”¨è€…å¯ä»¥ç»Ÿä¸€å¤„ç†

**ğŸ”¸ ConcreteCommandï¼ˆå…·ä½“å‘½ä»¤ï¼‰**
```java
// å…·ä½“çš„å‘½ä»¤å®ç°
class TurnOnTVCommand implements Command {
    private TV tv;  // æŒæœ‰æ¥æ”¶è€…å¼•ç”¨
    
    public TurnOnTVCommand(TV tv) {
        this.tv = tv;
    }
    
    public void execute() {
        tv.turnOn();  // è°ƒç”¨æ¥æ”¶è€…çš„æ–¹æ³•
    }
}
```
> **ä½œç”¨**ï¼šå°è£…å…·ä½“çš„æ“ä½œï¼Œå°†è°ƒç”¨è€…å’Œæ¥æ”¶è€…è§£è€¦

**ğŸ”¸ Receiverï¼ˆæ¥æ”¶è€…ï¼‰**
```java
// çœŸæ­£æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡
class TV {
    public void turnOn() {
        System.out.println("ç”µè§†å·²æ‰“å¼€");
    }
    
    public void turnOff() {
        System.out.println("ç”µè§†å·²å…³é—­");
    }
}
```
> **ä½œç”¨**ï¼šçŸ¥é“å¦‚ä½•æ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡æ“ä½œ

**ğŸ”¸ Invokerï¼ˆè°ƒç”¨è€…ï¼‰**
```java
// è§¦å‘å‘½ä»¤æ‰§è¡Œçš„å¯¹è±¡
class RemoteControl {
    private Command command;
    
    public void setCommand(Command command) {
        this.command = command;
    }
    
    public void pressButton() {
        command.execute();  // ä¸å…³å¿ƒå…·ä½“æ‰§è¡Œä»€ä¹ˆ
    }
}
```
> **ä½œç”¨**ï¼šè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Œä½†ä¸çŸ¥é“å‘½ä»¤çš„å…·ä½“å†…å®¹

---

## 4. ğŸ’» åŸºç¡€å®ç°æ¼”ç¤º


### 4.1 ç®€å•çš„å®¶ç”µæ§åˆ¶ç³»ç»Ÿ


> **ğŸ“‹ å®è·µåœºæ™¯**
> åˆ›å»ºä¸€ä¸ªé¥æ§å™¨ï¼Œå¯ä»¥æ§åˆ¶ç”µè§†å’Œç©ºè°ƒçš„å¼€å…³

**æ­¥éª¤1ï¼šå®šä¹‰æ¥æ”¶è€…ï¼ˆå®¶ç”µè®¾å¤‡ï¼‰**
```java
// ç”µè§†æœº
class Television {
    private boolean isOn = false;
    
    public void turnOn() {
        isOn = true;
        System.out.println("ğŸ“º ç”µè§†å·²æ‰“å¼€ï¼Œæ­£åœ¨æ’­æ”¾èŠ‚ç›®");
    }
    
    public void turnOff() {
        isOn = false;
        System.out.println("ğŸ“º ç”µè§†å·²å…³é—­");
    }
    
    public boolean isOn() {
        return isOn;
    }
}

// ç©ºè°ƒ
class AirConditioner {
    private boolean isRunning = false;
    
    public void powerOn() {
        isRunning = true;
        System.out.println("â„ï¸ ç©ºè°ƒå·²å¯åŠ¨ï¼Œå¼€å§‹åˆ¶å†·");
    }
    
    public void powerOff() {
        isRunning = false;
        System.out.println("â„ï¸ ç©ºè°ƒå·²å…³é—­");
    }
}
```

**æ­¥éª¤2ï¼šåˆ›å»ºå‘½ä»¤ç±»**
```java
// æ‰“å¼€ç”µè§†å‘½ä»¤
class TurnOnTVCommand implements Command {
    private Television tv;
    
    public TurnOnTVCommand(Television tv) {
        this.tv = tv;
    }
    
    @Override
    public void execute() {
        tv.turnOn();
    }
    
    @Override
    public void undo() {
        tv.turnOff();  // æ’¤é”€å°±æ˜¯æ‰§è¡Œç›¸åæ“ä½œ
    }
}

// ç©ºè°ƒå¼€å¯å‘½ä»¤
class PowerOnACCommand implements Command {
    private AirConditioner ac;
    
    public PowerOnACCommand(AirConditioner ac) {
        this.ac = ac;
    }
    
    @Override
    public void execute() {
        ac.powerOn();
    }
    
    @Override
    public void undo() {
        ac.powerOff();
    }
}
```

**æ­¥éª¤3ï¼šä½¿ç”¨æ¼”ç¤º**
```java
public class CommandPatternDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè®¾å¤‡
        Television tv = new Television();
        AirConditioner ac = new AirConditioner();
        
        // åˆ›å»ºå‘½ä»¤
        Command tvOnCommand = new TurnOnTVCommand(tv);
        Command acOnCommand = new PowerOnACCommand(ac);
        
        // åˆ›å»ºé¥æ§å™¨
        RemoteControl remote = new RemoteControl();
        
        // è®¾ç½®å‘½ä»¤å¹¶æ‰§è¡Œ
        remote.setCommand(tvOnCommand);
        remote.pressButton();  // è¾“å‡ºï¼šğŸ“º ç”µè§†å·²æ‰“å¼€ï¼Œæ­£åœ¨æ’­æ”¾èŠ‚ç›®
        
        remote.setCommand(acOnCommand);
        remote.pressButton();  // è¾“å‡ºï¼šâ„ï¸ ç©ºè°ƒå·²å¯åŠ¨ï¼Œå¼€å§‹åˆ¶å†·
    }
}
```

### 4.2 ç©ºå‘½ä»¤æ¨¡å¼


> **ğŸ’¡ ç¼–ç¨‹æŠ€å·§**
> ä½¿ç”¨ç©ºå‘½ä»¤é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå®ç”¨çš„è®¾è®¡æŠ€å·§

```java
// ç©ºå‘½ä»¤ç±»ï¼šä»€ä¹ˆéƒ½ä¸åš
class NoCommand implements Command {
    @Override
    public void execute() {
        // ä»€ä¹ˆéƒ½ä¸åš
    }
    
    @Override
    public void undo() {
        // ä»€ä¹ˆéƒ½ä¸åš
    }
}

// æ”¹è¿›çš„é¥æ§å™¨
class SmartRemoteControl {
    private Command[] commands = new Command[7];  // 7ä¸ªæŒ‰é’®
    
    public SmartRemoteControl() {
        // åˆå§‹åŒ–æ—¶éƒ½è®¾ä¸ºç©ºå‘½ä»¤ï¼Œé¿å…ç©ºæŒ‡é’ˆ
        Command noCommand = new NoCommand();
        for(int i = 0; i < 7; i++) {
            commands[i] = noCommand;
        }
    }
    
    public void setCommand(int slot, Command command) {
        commands[slot] = command;
    }
    
    public void buttonPressed(int slot) {
        commands[slot].execute();  // ä¸ç”¨æ‹…å¿ƒç©ºæŒ‡é’ˆäº†
    }
}
```

---

## 5. â†©ï¸ æ’¤é”€åŠŸèƒ½å®ç°


### 5.1 æ’¤é”€åŠŸèƒ½çš„æ ¸å¿ƒæ€è·¯


> **ğŸ” æ·±å…¥æ€è€ƒ**
> æ’¤é”€åŠŸèƒ½çš„å…³é”®æ˜¯è®°ä½"ä¹‹å‰çš„çŠ¶æ€"ï¼Œç„¶ååœ¨æ’¤é”€æ—¶æ¢å¤åˆ°é‚£ä¸ªçŠ¶æ€

**æ’¤é”€å®ç°çš„ä¸¤ç§æ–¹å¼**ï¼š

```
æ–¹å¼ä¸€ï¼šè®°å½•çŠ¶æ€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    è®°å½•çŠ¶æ€    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰§è¡Œå‰    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  å‘½ä»¤å¯¹è±¡   â”‚
â”‚   çŠ¶æ€A     â”‚               â”‚ ä¿å­˜çŠ¶æ€A   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                               æ’¤é”€æ—¶æ¢å¤çŠ¶æ€A
                                      â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   æ‰§è¡Œå    â”‚
                              â”‚   çŠ¶æ€B     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹å¼äºŒï¼šç›¸åæ“ä½œ
æ‰§è¡Œæ“ä½œï¼šå¢åŠ éŸ³é‡ â†’ æ’¤é”€æ“ä½œï¼šå‡å°‘éŸ³é‡
æ‰§è¡Œæ“ä½œï¼šæ‰“å¼€è®¾å¤‡ â†’ æ’¤é”€æ“ä½œï¼šå…³é—­è®¾å¤‡
```

### 5.2 æ”¯æŒæ’¤é”€çš„éŸ³å“æ§åˆ¶


```java
// éŸ³å“è®¾å¤‡
class Stereo {
    private int volume = 0;
    private boolean isOn = false;
    
    public void on() {
        isOn = true;
        System.out.println("ğŸµ éŸ³å“å·²æ‰“å¼€");
    }
    
    public void off() {
        isOn = false;
        System.out.println("ğŸµ éŸ³å“å·²å…³é—­");
    }
    
    public void setVolume(int volume) {
        this.volume = volume;
        System.out.println("ğŸ”Š éŸ³é‡è®¾ç½®ä¸º: " + volume);
    }
    
    public int getVolume() {
        return volume;
    }
}

// éŸ³é‡æ§åˆ¶å‘½ä»¤ï¼ˆè®°å½•çŠ¶æ€æ–¹å¼ï¼‰
class VolumeCommand implements Command {
    private Stereo stereo;
    private int prevVolume;  // è®°å½•æ‰§è¡Œå‰çš„éŸ³é‡
    private int newVolume;   // è¦è®¾ç½®çš„æ–°éŸ³é‡
    
    public VolumeCommand(Stereo stereo, int volume) {
        this.stereo = stereo;
        this.newVolume = volume;
    }
    
    @Override
    public void execute() {
        prevVolume = stereo.getVolume();  // è®°å½•å½“å‰çŠ¶æ€
        stereo.setVolume(newVolume);      // æ‰§è¡Œæ“ä½œ
    }
    
    @Override
    public void undo() {
        stereo.setVolume(prevVolume);     // æ¢å¤ä¹‹å‰çš„çŠ¶æ€
    }
}
```

### 5.3 å¢å¼ºç‰ˆé¥æ§å™¨ï¼ˆæ”¯æŒæ’¤é”€ï¼‰


```java
class UndoableRemoteControl {
    private Command[] commands = new Command[7];
    private Command lastCommand;  // è®°å½•æœ€åæ‰§è¡Œçš„å‘½ä»¤
    
    public UndoableRemoteControl() {
        Command noCommand = new NoCommand();
        for(int i = 0; i < 7; i++) {
            commands[i] = noCommand;
        }
        lastCommand = noCommand;
    }
    
    public void setCommand(int slot, Command command) {
        commands[slot] = command;
    }
    
    public void buttonPressed(int slot) {
        commands[slot].execute();
        lastCommand = commands[slot];  // è®°å½•æœ€åçš„å‘½ä»¤
    }
    
    public void undoButtonPressed() {
        lastCommand.undo();            // æ’¤é”€æœ€åçš„å‘½ä»¤
    }
}
```

**ä½¿ç”¨æ¼”ç¤º**ï¼š
```java
public class UndoDemo {
    public static void main(String[] args) {
        Stereo stereo = new Stereo();
        UndoableRemoteControl remote = new UndoableRemoteControl();
        
        // è®¾ç½®éŸ³é‡å‘½ä»¤
        Command volumeUp = new VolumeCommand(stereo, 20);
        remote.setCommand(0, volumeUp);
        
        // æ‰§è¡Œå’Œæ’¤é”€
        remote.buttonPressed(0);    // ğŸ”Š éŸ³é‡è®¾ç½®ä¸º: 20
        remote.undoButtonPressed(); // ğŸ”Š éŸ³é‡è®¾ç½®ä¸º: 0 (æ¢å¤åˆ°ä¹‹å‰)
    }
}
```

---

## 6. ğŸ“‹ å‘½ä»¤é˜Ÿåˆ—ä¸æ‰¹å¤„ç†


### 6.1 å‘½ä»¤é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯


> **ğŸ’¡ å®é™…åº”ç”¨**
> å‘½ä»¤é˜Ÿåˆ—åœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœ‰åº”ç”¨ï¼š
> - æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦
> - æ•°æ®åº“çš„äº‹åŠ¡å¤„ç†  
> - ç½‘ç»œè¯·æ±‚çš„æ‰¹å¤„ç†
> - æ¸¸æˆä¸­çš„æŠ€èƒ½è¿æ‹›

### 6.2 å®ç°å‘½ä»¤é˜Ÿåˆ—


```java
import java.util.*;

class CommandQueue {
    private Queue<Command> commandQueue = new LinkedList<>();
    private List<Command> executedCommands = new ArrayList<>();
    
    // æ·»åŠ å‘½ä»¤åˆ°é˜Ÿåˆ—
    public void addCommand(Command command) {
        commandQueue.offer(command);
        System.out.println("ğŸ“ å‘½ä»¤å·²åŠ å…¥é˜Ÿåˆ—ï¼Œå½“å‰é˜Ÿåˆ—é•¿åº¦: " + commandQueue.size());
    }
    
    // æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤
    public void executeAll() {
        System.out.println("ğŸš€ å¼€å§‹æ‰§è¡Œå‘½ä»¤é˜Ÿåˆ—...");
        
        while(!commandQueue.isEmpty()) {
            Command command = commandQueue.poll();
            command.execute();
            executedCommands.add(command);  // è®°å½•å·²æ‰§è¡Œçš„å‘½ä»¤
        }
        
        System.out.println("âœ… æ‰€æœ‰å‘½ä»¤æ‰§è¡Œå®Œæˆ");
    }
    
    // æ’¤é”€æ‰€æœ‰å·²æ‰§è¡Œçš„å‘½ä»¤
    public void undoAll() {
        System.out.println("â†©ï¸ å¼€å§‹æ’¤é”€æ‰€æœ‰å‘½ä»¤...");
        
        // é€†åºæ’¤é”€
        Collections.reverse(executedCommands);
        for(Command command : executedCommands) {
            command.undo();
        }
        
        executedCommands.clear();
        System.out.println("âœ… æ‰€æœ‰å‘½ä»¤å·²æ’¤é”€");
    }
}
```

### 6.3 å»¶è¿Ÿæ‰§è¡Œå’Œå®šæ—¶ä»»åŠ¡


```java
import java.util.concurrent.*;

class DelayedCommandExecutor {
    private ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(2);
    
    // å»¶è¿Ÿæ‰§è¡Œå‘½ä»¤
    public void executeAfter(Command command, long delay, TimeUnit unit) {
        scheduler.schedule(() -> {
            System.out.println("â° å®šæ—¶æ‰§è¡Œå‘½ä»¤...");
            command.execute();
        }, delay, unit);
    }
    
    // å‘¨æœŸæ€§æ‰§è¡Œå‘½ä»¤
    public void executeEvery(Command command, long period, TimeUnit unit) {
        scheduler.scheduleAtFixedRate(() -> {
            System.out.println("ğŸ”„ å‘¨æœŸæ‰§è¡Œå‘½ä»¤...");
            command.execute();
        }, 0, period, unit);
    }
    
    public void shutdown() {
        scheduler.shutdown();
    }
}
```

**é˜Ÿåˆ—ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class QueueDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè®¾å¤‡å’Œå‘½ä»¤
        Television tv = new Television();
        AirConditioner ac = new AirConditioner();
        
        Command tvOn = new TurnOnTVCommand(tv);
        Command acOn = new PowerOnACCommand(ac);
        
        // ä½¿ç”¨å‘½ä»¤é˜Ÿåˆ—
        CommandQueue queue = new CommandQueue();
        queue.addCommand(tvOn);
        queue.addCommand(acOn);
        
        queue.executeAll();  // æ‰¹é‡æ‰§è¡Œ
        
        // å»¶è¿Ÿ5ç§’åæ’¤é”€æ‰€æœ‰æ“ä½œ
        new Timer().schedule(new TimerTask() {
            public void run() {
                queue.undoAll();
            }
        }, 5000);
    }
}
```

---

## 7. ğŸ¯ å®å‘½ä»¤ç»„åˆåº”ç”¨


### 7.1 ä»€ä¹ˆæ˜¯å®å‘½ä»¤


> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> å®å‘½ä»¤å°±åƒ"ä¸€é”®å›å®¶"åŠŸèƒ½ï¼šæŒ‰ä¸€ä¸ªæŒ‰é’®ï¼ŒåŒæ—¶æ‰§è¡Œå¼€ç¯ã€å¼€ç©ºè°ƒã€æ‰“å¼€ç”µè§†ã€æ’­æ”¾éŸ³ä¹ç­‰å¤šä¸ªæ“ä½œ

### 7.2 å®å‘½ä»¤çš„å®ç°


```java
// å®å‘½ä»¤ï¼šç»„åˆå¤šä¸ªå‘½ä»¤
class MacroCommand implements Command {
    private Command[] commands;
    
    public MacroCommand(Command[] commands) {
        this.commands = commands;
    }
    
    @Override
    public void execute() {
        System.out.println("ğŸ­ æ‰§è¡Œå®å‘½ä»¤ - å¼€å§‹æ‰¹é‡æ“ä½œ");
        for(Command command : commands) {
            command.execute();
        }
        System.out.println("ğŸ­ å®å‘½ä»¤æ‰§è¡Œå®Œæˆ");
    }
    
    @Override
    public void undo() {
        System.out.println("ğŸ­ æ’¤é”€å®å‘½ä»¤ - å¼€å§‹æ‰¹é‡æ’¤é”€");
        // æ³¨æ„ï¼šæ’¤é”€æ—¶è¦é€†åºæ‰§è¡Œ
        for(int i = commands.length - 1; i >= 0; i--) {
            commands[i].undo();
        }
        System.out.println("ğŸ­ å®å‘½ä»¤æ’¤é”€å®Œæˆ");
    }
}
```

### 7.3 æ™ºèƒ½å®¶å±…åœºæ™¯åº”ç”¨


```java
// ç¯å…‰æ§åˆ¶
class Light {
    private String location;
    private boolean isOn = false;
    
    public Light(String location) {
        this.location = location;
    }
    
    public void on() {
        isOn = true;
        System.out.println("ğŸ’¡ " + location + "çš„ç¯å·²æ‰“å¼€");
    }
    
    public void off() {
        isOn = false;
        System.out.println("ğŸ’¡ " + location + "çš„ç¯å·²å…³é—­");
    }
}

// ç¯å…‰å‘½ä»¤
class LightOnCommand implements Command {
    private Light light;
    
    public LightOnCommand(Light light) {
        this.light = light;
    }
    
    public void execute() { light.on(); }
    public void undo() { light.off(); }
}

// åˆ›å»ºæ™ºèƒ½å®¶å±…å®å‘½ä»¤
public class SmartHomeDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè®¾å¤‡
        Light livingRoomLight = new Light("å®¢å…");
        Light kitchenLight = new Light("å¨æˆ¿");
        Television tv = new Television();
        AirConditioner ac = new AirConditioner();
        
        // åˆ›å»ºå•ä¸ªå‘½ä»¤
        Command livingRoomLightOn = new LightOnCommand(livingRoomLight);
        Command kitchenLightOn = new LightOnCommand(kitchenLight);
        Command tvOn = new TurnOnTVCommand(tv);
        Command acOn = new PowerOnACCommand(ac);
        
        // åˆ›å»º"å›å®¶æ¨¡å¼"å®å‘½ä»¤
        Command[] homeCommands = {
            livingRoomLightOn, kitchenLightOn, tvOn, acOn
        };
        MacroCommand homeMode = new MacroCommand(homeCommands);
        
        // è®¾ç½®åˆ°é¥æ§å™¨
        UndoableRemoteControl remote = new UndoableRemoteControl();
        remote.setCommand(0, homeMode);
        
        // ä¸€é”®æ‰§è¡Œå›å®¶æ¨¡å¼
        System.out.println("ğŸ  æŒ‰ä¸‹å›å®¶æ¨¡å¼æŒ‰é’®...");
        remote.buttonPressed(0);
        
        System.out.println("\nâ±ï¸ 5ç§’åæ’¤é”€æ‰€æœ‰æ“ä½œ...");
        // ä¸€é”®æ’¤é”€æ‰€æœ‰æ“ä½œ
        remote.undoButtonPressed();
    }
}
```

**è¾“å‡ºæ•ˆæœ**ï¼š
```
ğŸ  æŒ‰ä¸‹å›å®¶æ¨¡å¼æŒ‰é’®...
ğŸ­ æ‰§è¡Œå®å‘½ä»¤ - å¼€å§‹æ‰¹é‡æ“ä½œ
ğŸ’¡ å®¢å…çš„ç¯å·²æ‰“å¼€
ğŸ’¡ å¨æˆ¿çš„ç¯å·²å…³é—­
ğŸ“º ç”µè§†å·²æ‰“å¼€ï¼Œæ­£åœ¨æ’­æ”¾èŠ‚ç›®
â„ï¸ ç©ºè°ƒå·²å¯åŠ¨ï¼Œå¼€å§‹åˆ¶å†·
ğŸ­ å®å‘½ä»¤æ‰§è¡Œå®Œæˆ

â±ï¸ 5ç§’åæ’¤é”€æ‰€æœ‰æ“ä½œ...
ğŸ­ æ’¤é”€å®å‘½ä»¤ - å¼€å§‹æ‰¹é‡æ’¤é”€
â„ï¸ ç©ºè°ƒå·²å…³é—­
ğŸ“º ç”µè§†å·²å…³é—­
ğŸ’¡ å¨æˆ¿çš„ç¯å·²å…³é—­
ğŸ’¡ å®¢å…çš„ç¯å·²å…³é—­
ğŸ­ å®å‘½ä»¤æ’¤é”€å®Œæˆ
```

---

## 8. ğŸ“ æ–‡æœ¬ç¼–è¾‘å™¨å®æˆ˜æ¡ˆä¾‹


### 8.1 éœ€æ±‚åˆ†æ


> **ğŸ“‹ é¡¹ç›®éœ€æ±‚**
> åˆ›å»ºä¸€ä¸ªç®€å•çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒï¼š
> - æ’å…¥æ–‡æœ¬
> - åˆ é™¤æ–‡æœ¬  
> - æ’¤é”€/é‡åšæ“ä½œ
> - ä¿å­˜æ“ä½œå†å²

### 8.2 æ–‡æœ¬ç¼–è¾‘å™¨æ ¸å¿ƒå®ç°


```java
// æ–‡æ¡£ç±»ï¼ˆæ¥æ”¶è€…ï¼‰
class Document {
    private StringBuilder content = new StringBuilder();
    
    public void insertText(int position, String text) {
        content.insert(position, text);
        System.out.println("âœï¸ æ’å…¥æ–‡æœ¬: \"" + text + "\" åœ¨ä½ç½® " + position);
        System.out.println("ğŸ“„ å½“å‰å†…å®¹: " + content.toString());
    }
    
    public String deleteText(int position, int length) {
        String deleted = content.substring(position, position + length);
        content.delete(position, position + length);
        System.out.println("ğŸ—‘ï¸ åˆ é™¤æ–‡æœ¬: \"" + deleted + "\" ä»ä½ç½® " + position);
        System.out.println("ğŸ“„ å½“å‰å†…å®¹: " + content.toString());
        return deleted;
    }
    
    public String getContent() {
        return content.toString();
    }
    
    public int getLength() {
        return content.length();
    }
}

// æ’å…¥æ–‡æœ¬å‘½ä»¤
class InsertTextCommand implements Command {
    private Document document;
    private int position;
    private String text;
    
    public InsertTextCommand(Document document, int position, String text) {
        this.document = document;
        this.position = position;
        this.text = text;
    }
    
    @Override
    public void execute() {
        document.insertText(position, text);
    }
    
    @Override
    public void undo() {
        // æ’¤é”€æ’å…¥å°±æ˜¯åˆ é™¤åˆšæ’å…¥çš„æ–‡æœ¬
        document.deleteText(position, text.length());
    }
}

// åˆ é™¤æ–‡æœ¬å‘½ä»¤
class DeleteTextCommand implements Command {
    private Document document;
    private int position;
    private int length;
    private String deletedText;  // ä¿å­˜è¢«åˆ é™¤çš„æ–‡æœ¬
    
    public DeleteTextCommand(Document document, int position, int length) {
        this.document = document;
        this.position = position;
        this.length = length;
    }
    
    @Override
    public void execute() {
        deletedText = document.deleteText(position, length);
    }
    
    @Override
    public void undo() {
        // æ’¤é”€åˆ é™¤å°±æ˜¯é‡æ–°æ’å…¥è¢«åˆ é™¤çš„æ–‡æœ¬
        document.insertText(position, deletedText);
    }
}
```

### 8.3 ç¼–è¾‘å™¨æ“ä½œç®¡ç†å™¨


```java
import java.util.*;

class EditorInvoker {
    private Stack<Command> undoStack = new Stack<>();
    private Stack<Command> redoStack = new Stack<>();
    private final int MAX_HISTORY = 50;  // æœ€å¤§å†å²è®°å½•æ•°
    
    public void executeCommand(Command command) {
        command.execute();
        
        // æ·»åŠ åˆ°æ’¤é”€æ ˆ
        undoStack.push(command);
        
        // æ¸…ç©ºé‡åšæ ˆï¼ˆå› ä¸ºæ‰§è¡Œäº†æ–°å‘½ä»¤ï¼‰
        redoStack.clear();
        
        // é™åˆ¶å†å²è®°å½•å¤§å°
        if(undoStack.size() > MAX_HISTORY) {
            undoStack.remove(0);
        }
        
        System.out.println("ğŸ“Š æ’¤é”€æ ˆå¤§å°: " + undoStack.size());
    }
    
    public void undo() {
        if(undoStack.isEmpty()) {
            System.out.println("âš ï¸ æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ");
            return;
        }
        
        Command command = undoStack.pop();
        command.undo();
        redoStack.push(command);
        
        System.out.println("â†©ï¸ æ’¤é”€æ“ä½œå®Œæˆ");
    }
    
    public void redo() {
        if(redoStack.isEmpty()) {
            System.out.println("âš ï¸ æ²¡æœ‰å¯é‡åšçš„æ“ä½œ");
            return;
        }
        
        Command command = redoStack.pop();
        command.execute();
        undoStack.push(command);
        
        System.out.println("â†ªï¸ é‡åšæ“ä½œå®Œæˆ");
    }
    
    public void showHistory() {
        System.out.println("ğŸ“š æ“ä½œå†å²:");
        System.out.println("  å¯æ’¤é”€æ“ä½œæ•°: " + undoStack.size());
        System.out.println("  å¯é‡åšæ“ä½œæ•°: " + redoStack.size());
    }
}
```

### 8.4 å®Œæ•´ä½¿ç”¨æ¼”ç¤º


```java
public class TextEditorDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæ–‡æ¡£å’Œç¼–è¾‘å™¨
        Document document = new Document();
        EditorInvoker editor = new EditorInvoker();
        
        System.out.println("=== æ–‡æœ¬ç¼–è¾‘å™¨æ¼”ç¤º ===\n");
        
        // æ‰§è¡Œä¸€ç³»åˆ—ç¼–è¾‘æ“ä½œ
        Command insert1 = new InsertTextCommand(document, 0, "Hello ");
        Command insert2 = new InsertTextCommand(document, 6, "World!");
        Command insert3 = new InsertTextCommand(document, 6, "Beautiful ");
        
        editor.executeCommand(insert1);
        editor.executeCommand(insert2);
        editor.executeCommand(insert3);
        
        System.out.println("\n--- å½“å‰æ–‡æ¡£çŠ¶æ€ ---");
        System.out.println("å†…å®¹: \"" + document.getContent() + "\"");
        
        // åˆ é™¤æ“ä½œ
        Command delete1 = new DeleteTextCommand(document, 6, 10);  // åˆ é™¤"Beautiful "
        editor.executeCommand(delete1);
        
        // æ˜¾ç¤ºå†å²
        editor.showHistory();
        
        // æ’¤é”€æ“ä½œæ¼”ç¤º
        System.out.println("\n=== æ’¤é”€æ“ä½œæ¼”ç¤º ===");
        editor.undo();  // æ’¤é”€åˆ é™¤
        editor.undo();  // æ’¤é”€æ’å…¥"Beautiful "
        
        // é‡åšæ“ä½œæ¼”ç¤º
        System.out.println("\n=== é‡åšæ“ä½œæ¼”ç¤º ===");
        editor.redo();  // é‡åšæ’å…¥"Beautiful "
        
        System.out.println("\n--- æœ€ç»ˆæ–‡æ¡£çŠ¶æ€ ---");
        System.out.println("å†…å®¹: \"" + document.getContent() + "\"");
    }
}
```

---

## 9. ğŸš€ åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ


### 9.1 å‘½ä»¤æ¨¡å¼çš„å…¸å‹åº”ç”¨åœºæ™¯


> **ğŸ“‹ å¿«é€Ÿå‚è€ƒ**
> 
> âœ… **é€‚åˆä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„åœºæ™¯**ï¼š
> - éœ€è¦æ’¤é”€/é‡åšåŠŸèƒ½
> - éœ€è¦å»¶è¿Ÿæ‰§è¡Œæ“ä½œ  
> - éœ€è¦è®°å½•æ“ä½œæ—¥å¿—
> - éœ€è¦æ”¯æŒæ‰¹å¤„ç†
> - è°ƒç”¨è€…å’Œæ¥æ”¶è€…éœ€è¦è§£è€¦

| åº”ç”¨é¢†åŸŸ | å…·ä½“åœºæ™¯ | å‘½ä»¤æ¨¡å¼çš„ä»·å€¼ |
|---------|----------|---------------|
| **å›¾å½¢ç•Œé¢** | èœå•ã€æŒ‰é’®ã€å¿«æ·é”® | ç»Ÿä¸€çš„å‘½ä»¤å¤„ç†ï¼Œæ”¯æŒæ’¤é”€ |
| **æ–‡æœ¬ç¼–è¾‘** | Wordã€ä»£ç ç¼–è¾‘å™¨ | ç¼–è¾‘æ“ä½œçš„æ’¤é”€/é‡åš |
| **æ•°æ®åº“** | äº‹åŠ¡å¤„ç†ã€SQLæ‰§è¡Œ | æ“ä½œå°è£…ï¼Œå›æ»šæ”¯æŒ |
| **æ¸¸æˆå¼€å‘** | æŠ€èƒ½ç³»ç»Ÿã€å›æ”¾ç³»ç»Ÿ | æ“ä½œè®°å½•ï¼ŒçŠ¶æ€å›é€€ |
| **ç½‘ç»œé€šä¿¡** | è¯·æ±‚é˜Ÿåˆ—ã€æ‰¹å¤„ç† | è¯·æ±‚ç¼“å­˜ï¼Œå»¶è¿Ÿæ‰§è¡Œ |

### 9.2 è®¾è®¡æ¨¡å¼æœ€ä½³å®è·µ


**ğŸ”¸ å‘½ä»¤æ¥å£è®¾è®¡åŸåˆ™**
```java
// âœ… å¥½çš„å‘½ä»¤æ¥å£è®¾è®¡
interface Command {
    void execute();
    void undo();            // æ”¯æŒæ’¤é”€
    String getDescription(); // æ“ä½œæè¿°
    boolean canUndo();      // æ˜¯å¦å¯æ’¤é”€
}

// âŒ è¿‡äºå¤æ‚çš„å‘½ä»¤æ¥å£
interface BadCommand {
    void execute(Context context, Map<String, Object> params);
    void undo(Context context, UndoInfo info);
    void redo(Context context);
    ValidationResult validate(Context context);
    // å¤ªå¤šèŒè´£ï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™
}
```

**ğŸ”¸ å‘½ä»¤ç±»çš„è®¾è®¡æŠ€å·§**
```java
// ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºå‘½ä»¤
class CommandFactory {
    public static Command createFileCommand(String operation, File file) {
        switch(operation.toLowerCase()) {
            case "open": return new OpenFileCommand(file);
            case "save": return new SaveFileCommand(file);
            case "delete": return new DeleteFileCommand(file);
            default: return new NoCommand();
        }
    }
}

// å‘½ä»¤ç±»è¦ä¿æŒè½»é‡
class LightWeightCommand implements Command {
    private final Receiver receiver;
    private final String action;
    
    // åªä¿å­˜å¿…è¦çš„ä¿¡æ¯
    public LightWeightCommand(Receiver receiver, String action) {
        this.receiver = receiver;
        this.action = action;
    }
}
```

### 9.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ”¸ å†…å­˜ç®¡ç†**
```java
class OptimizedCommandHistory {
    private static final int MAX_HISTORY = 100;
    private LinkedList<Command> history = new LinkedList<>();
    
    public void addCommand(Command command) {
        history.addLast(command);
        
        // è‡ªåŠ¨æ¸…ç†è¿‡å¤šçš„å†å²è®°å½•
        if(history.size() > MAX_HISTORY) {
            history.removeFirst();
        }
    }
    
    // æä¾›æ¸…ç†æ–¹æ³•
    public void clearHistory() {
        history.clear();
        System.gc(); // å»ºè®®åƒåœ¾å›æ”¶
    }
}
```

**ğŸ”¸ å‘½ä»¤æ± åŒ–**
```java
// å¯¹äºé¢‘ç¹åˆ›å»ºçš„ç®€å•å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡æ± 
class CommandPool {
    private Queue<SimpleCommand> pool = new LinkedList<>();
    
    public SimpleCommand getCommand() {
        SimpleCommand cmd = pool.poll();
        return cmd != null ? cmd : new SimpleCommand();
    }
    
    public void returnCommand(SimpleCommand cmd) {
        cmd.reset();  // é‡ç½®çŠ¶æ€
        pool.offer(cmd);
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> **ğŸ’¡ æ ¸å¿ƒè®°å¿†**
> å‘½ä»¤æ¨¡å¼ = è¯·æ±‚å°è£… + è°ƒç”¨è§£è€¦ + æ“ä½œè®°å½•

```
ğŸ”¸ æ ¸å¿ƒæ€æƒ³ï¼šå°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œå®ç°è°ƒç”¨è€…å’Œæ¥æ”¶è€…çš„è§£è€¦
ğŸ”¸ å…³é”®è§’è‰²ï¼šCommand(å‘½ä»¤æ¥å£)ã€ConcreteCommand(å…·ä½“å‘½ä»¤)ã€Invoker(è°ƒç”¨è€…)ã€Receiver(æ¥æ”¶è€…)
ğŸ”¸ ä¸»è¦ä¼˜åŠ¿ï¼šæ”¯æŒæ’¤é”€ã€æ”¯æŒé˜Ÿåˆ—ã€æ”¯æŒæ—¥å¿—ã€æ˜“äºæ‰©å±•
ğŸ”¸ å…¸å‹åº”ç”¨ï¼šæ–‡æœ¬ç¼–è¾‘å™¨ã€å›¾å½¢ç•Œé¢ã€æ¸¸æˆç³»ç»Ÿã€äº‹åŠ¡å¤„ç†
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å‘½ä»¤æ¨¡å¼çš„æœ¬è´¨ä»·å€¼**
```
ä¼ ç»Ÿæ–¹å¼ï¼šè°ƒç”¨è€…ç›´æ¥è°ƒç”¨æ¥æ”¶è€…æ–¹æ³•
â”œâ”€ ç´§å¯†è€¦åˆï¼Œéš¾ä»¥æ‰©å±•
â”œâ”€ æ— æ³•æ’¤é”€æ“ä½œ
â””â”€ æ— æ³•æ‰¹é‡å¤„ç†

å‘½ä»¤æ¨¡å¼ï¼šè°ƒç”¨è€…é€šè¿‡å‘½ä»¤å¯¹è±¡é—´æ¥è°ƒç”¨
â”œâ”€ æ¾æ•£è€¦åˆï¼Œæ˜“äºæ‰©å±•
â”œâ”€ æ”¯æŒæ’¤é”€/é‡åš
â”œâ”€ æ”¯æŒé˜Ÿåˆ—/æ‰¹å¤„ç†
â””â”€ æ”¯æŒæ“ä½œè®°å½•
```

**ğŸ”¹ æ’¤é”€åŠŸèƒ½çš„å®ç°ç­–ç•¥**
```
çŠ¶æ€è®°å½•æ–¹å¼ï¼š
â€¢ æ‰§è¡Œå‰è®°ä½çŠ¶æ€
â€¢ æ’¤é”€æ—¶æ¢å¤çŠ¶æ€
â€¢ é€‚åˆçŠ¶æ€ç®€å•çš„åœºæ™¯

ç›¸åæ“ä½œæ–¹å¼ï¼š
â€¢ æ¯ä¸ªæ“ä½œå®šä¹‰ç›¸åæ“ä½œ
â€¢ æ’¤é”€æ—¶æ‰§è¡Œç›¸åæ“ä½œ
â€¢ é€‚åˆæ“ä½œå¯¹ç§°çš„åœºæ™¯
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é€‚åˆä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„åˆ¤æ–­æ ‡å‡†**
- éœ€è¦å°†è°ƒç”¨è€…å’Œæ¥æ”¶è€…è§£è€¦
- éœ€è¦æ”¯æŒæ’¤é”€/é‡åšåŠŸèƒ½
- éœ€è¦æ”¯æŒæ“ä½œé˜Ÿåˆ—æˆ–æ‰¹å¤„ç†
- éœ€è¦è®°å½•æ“ä½œå†å²æˆ–æ—¥å¿—
- éœ€è¦æ”¯æŒå»¶è¿Ÿæ‰§è¡Œæˆ–å®šæ—¶æ‰§è¡Œ

**âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯**
- ç®€å•çš„æ–¹æ³•è°ƒç”¨ï¼Œä¸éœ€è¦è§£è€¦
- æ“ä½œæ— æ³•æ’¤é”€ä¸”ä¸éœ€è¦è®°å½•
- æ€§èƒ½è¦æ±‚æé«˜ï¼Œä¸èƒ½æ‰¿å—é¢å¤–å¼€é”€
- å‘½ä»¤æ•°é‡å¾ˆå°‘ä¸”åŸºæœ¬ä¸å˜

### 10.4 ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»


```
å‘½ä»¤æ¨¡å¼çš„æœ‹å‹åœˆï¼š

ğŸ¤ ç»å¸¸åˆä½œï¼š
â€¢ ä¸ç»„åˆæ¨¡å¼ï¼šå®ç°å®å‘½ä»¤
â€¢ ä¸å¤‡å¿˜å½•æ¨¡å¼ï¼šä¿å­˜å‘½ä»¤æ‰§è¡ŒçŠ¶æ€
â€¢ ä¸ç­–ç•¥æ¨¡å¼ï¼šå‘½ä»¤å¯ä»¥çœ‹ä½œç­–ç•¥çš„æ‰©å±•

ğŸ”„ å¯èƒ½æ··æ·†ï¼š
â€¢ ç­–ç•¥æ¨¡å¼ï¼šå…³æ³¨ç®—æ³•æ›¿æ¢
â€¢ å‘½ä»¤æ¨¡å¼ï¼šå…³æ³¨è¯·æ±‚å°è£…

ğŸ“š å­¦ä¹ è·¯å¾„ï¼š
å‘½ä»¤æ¨¡å¼ â†’ è´£ä»»é“¾æ¨¡å¼ â†’ ä¸­ä»‹è€…æ¨¡å¼
(éƒ½æ¶‰åŠè¯·æ±‚çš„å¤„ç†å’Œä¼ é€’)
```

### 10.5 é¢è¯•å¸¸è€ƒè¦ç‚¹


> **ğŸ“Œ é¢è¯•å‡†å¤‡**
> 
> **Q1: å‘½ä»¤æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„åŒºåˆ«ï¼Ÿ**
> - ç­–ç•¥æ¨¡å¼ï¼šå°è£…ç®—æ³•ï¼Œå…³æ³¨"æ€ä¹ˆåš"
> - å‘½ä»¤æ¨¡å¼ï¼šå°è£…è¯·æ±‚ï¼Œå…³æ³¨"åšä»€ä¹ˆ"
> 
> **Q2: æ’¤é”€åŠŸèƒ½å¦‚ä½•å®ç°ï¼Ÿ**
> - çŠ¶æ€è®°å½•ï¼šä¿å­˜æ‰§è¡Œå‰çŠ¶æ€
> - ç›¸åæ“ä½œï¼šå®šä¹‰é€†å‘æ“ä½œ
> 
> **Q3: å‘½ä»¤æ¨¡å¼çš„ç¼ºç‚¹ï¼Ÿ**
> - ç±»æ•°é‡å¢åŠ ï¼šæ¯ä¸ªæ“ä½œéƒ½è¦åˆ›å»ºå‘½ä»¤ç±»
> - å†…å­˜å¼€é”€ï¼šéœ€è¦ä¿å­˜å‘½ä»¤å†å²

**ğŸ¯ è®°å¿†å£è¯€**ï¼š
```
å‘½ä»¤æ¨¡å¼å¥½ç†è§£ï¼Œè¯·æ±‚å°è£…æˆå¯¹è±¡
è°ƒç”¨æ¥æ”¶è¦è§£è€¦ï¼Œæ’¤é”€é‡åšä¸ç”¨æ„
é˜Ÿåˆ—æ‰¹å¤„ç†è½»æ¾ï¼Œæ‰©å±•ç»´æŠ¤éƒ½ç®€å•
```

**æ ¸å¿ƒä»·å€¼**ï¼šå‘½ä»¤æ¨¡å¼é€šè¿‡å°†è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œå®ç°äº†è°ƒç”¨è€…å’Œæ¥æ”¶è€…çš„è§£è€¦ï¼Œä¸ºç³»ç»Ÿæä¾›äº†æ’¤é”€ã€é˜Ÿåˆ—ã€æ—¥å¿—ç­‰é«˜çº§åŠŸèƒ½ï¼Œæ˜¯æ„å»ºçµæ´»å¯æ‰©å±•ç³»ç»Ÿçš„é‡è¦å·¥å…·ã€‚