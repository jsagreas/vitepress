---
title: 4ã€çŠ¶æ€æ¨¡å¼å®é™…åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [è®¢å•çŠ¶æ€ç®¡ç†](#1-è®¢å•çŠ¶æ€ç®¡ç†)
2. [æ¸¸æˆè§’è‰²çŠ¶æ€](#2-æ¸¸æˆè§’è‰²çŠ¶æ€)
3. [ç½‘ç»œè¿æ¥çŠ¶æ€](#3-ç½‘ç»œè¿æ¥çŠ¶æ€)
4. [å·¥ä½œæµçŠ¶æ€æœº](#4-å·¥ä½œæµçŠ¶æ€æœº)
5. [TCPè¿æ¥çŠ¶æ€](#5-TCPè¿æ¥çŠ¶æ€)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›’ è®¢å•çŠ¶æ€ç®¡ç†


### 1.1 è®¢å•çŠ¶æ€çš„ç”Ÿæ´»ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯è®¢å•çŠ¶æ€ï¼Ÿ**
æƒ³è±¡ä½ åœ¨ç½‘ä¸Šä¹°ä¸œè¥¿ï¼Œä»ä¸‹å•åˆ°æ”¶è´§æœ‰å¾ˆå¤šæ­¥éª¤ï¼šä¸‹å•â†’ä»˜æ¬¾â†’å‘è´§â†’è¿è¾“â†’ç­¾æ”¶ã€‚æ¯ä¸ªæ­¥éª¤å°±æ˜¯ä¸€ä¸ª**çŠ¶æ€**ï¼Œä¸åŒçŠ¶æ€ä¸‹èƒ½åšçš„æ“ä½œä¸ä¸€æ ·ã€‚

```
ç°å®åœºæ™¯ï¼š
åˆšä¸‹å•æ—¶ â†’ å¯ä»¥å–æ¶ˆè®¢å•ï¼Œä¸èƒ½ç”³è¯·é€€è´§
å·²å‘è´§æ—¶ â†’ ä¸èƒ½å–æ¶ˆï¼Œå¯ä»¥æŸ¥çœ‹ç‰©æµ
å·²ç­¾æ”¶æ—¶ â†’ ä¸èƒ½å–æ¶ˆï¼Œå¯ä»¥ç”³è¯·é€€è´§

è¿™å°±æ˜¯çŠ¶æ€æ¨¡å¼çš„å…¸å‹åº”ç”¨ï¼
```

### 1.2 è®¢å•çŠ¶æ€è®¾è®¡æ€è·¯


**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€æ¨¡å¼ï¼Ÿ**
ä¼ ç»Ÿçš„if-elseæ–¹å¼å¤„ç†è®¢å•çŠ¶æ€ä¼šå¾ˆæ··ä¹±ï¼š

```java
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šå¤æ‚çš„if-elseåˆ¤æ–­
public class Order {
    private String status; // "created", "paid", "shipped", "delivered"
    
    public void cancel() {
        if ("created".equals(status) || "paid".equals(status)) {
            // å¯ä»¥å–æ¶ˆ
        } else {
            // ä¸èƒ½å–æ¶ˆ
        }
    }
    
    public void ship() {
        if ("paid".equals(status)) {
            // å¯ä»¥å‘è´§
        } else {
            // ä¸èƒ½å‘è´§
        }
    }
    // æ›´å¤šæ–¹æ³•ï¼Œæ›´å¤šif-else...
}
```

**âœ… ç”¨çŠ¶æ€æ¨¡å¼æ›´æ¸…æ™°ï¼š**

â”Œâ”€ çŠ¶æ€æ¨¡å¼è§£å†³æ–¹æ¡ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¯ä¸ªçŠ¶æ€æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»       â”‚
â”‚ 2. æ¯ä¸ªçŠ¶æ€ç±»å¤„ç†è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ â”‚
â”‚ 3. çŠ¶æ€è½¬æ¢è§„åˆ™æ›´æ¸…æ™°           â”‚
â”‚ 4. æ–°å¢çŠ¶æ€ä¸å½±å“ç°æœ‰ä»£ç        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 1.3 è®¢å•çŠ¶æ€å…·ä½“å®ç°


**ğŸ“‹ çŠ¶æ€æ¥å£å®šä¹‰**
```java
// è®¢å•çŠ¶æ€æ¥å£
public interface OrderState {
    void cancel(OrderContext order);    // å–æ¶ˆè®¢å•
    void pay(OrderContext order);       // æ”¯ä»˜è®¢å•  
    void ship(OrderContext order);      // å‘è´§
    void deliver(OrderContext order);   // ç¡®è®¤æ”¶è´§
    void refund(OrderContext order);    // ç”³è¯·é€€æ¬¾
    String getStateName();              // è·å–çŠ¶æ€åç§°
}
```

**ğŸ—ï¸ è®¢å•ä¸Šä¸‹æ–‡**
```java
public class OrderContext {
    private OrderState currentState;
    private String orderId;
    private double amount;
    
    public OrderContext(String orderId, double amount) {
        this.orderId = orderId;
        this.amount = amount;
        // è®¢å•åˆ›å»ºæ—¶çš„åˆå§‹çŠ¶æ€
        this.currentState = new CreatedState();
    }
    
    // çŠ¶æ€è½¬æ¢æ–¹æ³•
    public void setState(OrderState state) {
        this.currentState = state;
        System.out.println("è®¢å•çŠ¶æ€å˜æ›´ä¸ºï¼š" + state.getStateName());
    }
    
    // å§”æ‰˜ç»™å½“å‰çŠ¶æ€å¤„ç†
    public void cancel() { currentState.cancel(this); }
    public void pay() { currentState.pay(this); }
    public void ship() { currentState.ship(this); }
    public void deliver() { currentState.deliver(this); }
    public void refund() { currentState.refund(this); }
    
    // getteræ–¹æ³•
    public String getOrderId() { return orderId; }
    public double getAmount() { return amount; }
}
```

**ğŸ”¸ å…·ä½“çŠ¶æ€å®ç°ç¤ºä¾‹**
```java
// å·²åˆ›å»ºçŠ¶æ€
public class CreatedState implements OrderState {
    @Override
    public void cancel(OrderContext order) {
        System.out.println("è®¢å•å–æ¶ˆæˆåŠŸ");
        order.setState(new CancelledState());
    }
    
    @Override
    public void pay(OrderContext order) {
        System.out.println("æ”¯ä»˜æˆåŠŸï¼Œç­‰å¾…å‘è´§");
        order.setState(new PaidState());
    }
    
    @Override
    public void ship(OrderContext order) {
        System.out.println("è¯·å…ˆæ”¯ä»˜è®¢å•");
    }
    
    // å…¶ä»–æ“ä½œç±»ä¼¼...
    @Override
    public String getStateName() { return "å·²åˆ›å»º"; }
}

// å·²æ”¯ä»˜çŠ¶æ€
public class PaidState implements OrderState {
    @Override
    public void cancel(OrderContext order) {
        System.out.println("å·²æ”¯ä»˜è®¢å•ï¼Œé€€æ¬¾å¤„ç†ä¸­");
        order.setState(new RefundingState());
    }
    
    @Override
    public void ship(OrderContext order) {
        System.out.println("è®¢å•å·²å‘è´§");
        order.setState(new ShippedState());
    }
    
    // å…¶ä»–æ“ä½œ...
    @Override
    public String getStateName() { return "å·²æ”¯ä»˜"; }
}
```

### 1.4 è®¢å•çŠ¶æ€æµè½¬å›¾


```
è®¢å•çŠ¶æ€æµè½¬ï¼š

  å·²åˆ›å»º â”€â”€pay()â”€â”€â†’ å·²æ”¯ä»˜ â”€â”€ship()â”€â”€â†’ å·²å‘è´§ â”€â”€deliver()â”€â”€â†’ å·²å®Œæˆ
    â”‚                 â”‚                  â”‚
    â”‚                 â”‚                  â”‚
  cancel()          cancel()           refund()
    â”‚                 â”‚                  â”‚
    â†“                 â†“                  â†“
  å·²å–æ¶ˆ           é€€æ¬¾ä¸­             å·²å®Œæˆ
                     â”‚
                   refund()
                     â”‚
                     â†“
                  å·²é€€æ¬¾
```

**ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿**
- **æ¸…æ™°æ˜äº†**ï¼šæ¯ä¸ªçŠ¶æ€çš„è¡Œä¸ºä¸€ç›®äº†ç„¶
- **æ˜“äºæ‰©å±•**ï¼šæ–°å¢çŠ¶æ€åªéœ€æ·»åŠ æ–°çš„çŠ¶æ€ç±»
- **ç»´æŠ¤ç®€å•**ï¼šä¿®æ”¹æŸä¸ªçŠ¶æ€ä¸å½±å“å…¶ä»–çŠ¶æ€
- **ä¸šåŠ¡å¯¹åº”**ï¼šä»£ç ç»“æ„ç›´æ¥å¯¹åº”ä¸šåŠ¡æµç¨‹

---

## 2. ğŸ® æ¸¸æˆè§’è‰²çŠ¶æ€


### 2.1 æ¸¸æˆè§’è‰²çŠ¶æ€çš„ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯è§’è‰²çŠ¶æ€ï¼Ÿ**
ç©è¿‡æ¸¸æˆçš„éƒ½çŸ¥é“ï¼Œæ¸¸æˆè§’è‰²æœ‰ä¸åŒçŠ¶æ€ï¼šæ­£å¸¸ã€å—ä¼¤ã€æ­»äº¡ã€æ— æ•Œç­‰ã€‚ä¸åŒçŠ¶æ€ä¸‹è§’è‰²çš„è¡Œä¸ºå®Œå…¨ä¸åŒã€‚

```
ğŸ§™â€â™‚ï¸ æ³•å¸ˆè§’è‰²çŠ¶æ€ç¤ºä¾‹ï¼š
æ­£å¸¸çŠ¶æ€ï¼šå¯ä»¥ç§»åŠ¨ã€æ”»å‡»ã€æ–½æ³•
å—ä¼¤çŠ¶æ€ï¼šç§»åŠ¨å˜æ…¢ã€æ”»å‡»åŠ›ä¸‹é™
çœ©æ™•çŠ¶æ€ï¼šä¸èƒ½ç§»åŠ¨ã€ä¸èƒ½æ”»å‡»
æ­»äº¡çŠ¶æ€ï¼šä»€ä¹ˆéƒ½ä¸èƒ½åšï¼Œç­‰å¾…å¤æ´»
```

### 2.2 è§’è‰²çŠ¶æ€è®¾è®¡


**ğŸ“‹ çŠ¶æ€æ¥å£**
```java
public interface CharacterState {
    void move(GameCharacter character);      // ç§»åŠ¨
    void attack(GameCharacter character);    // æ”»å‡»
    void defend(GameCharacter character);    // é˜²å¾¡
    void useSkill(GameCharacter character);  // ä½¿ç”¨æŠ€èƒ½
    String getStateName();                   // çŠ¶æ€åç§°
}
```

**ğŸ—ï¸ æ¸¸æˆè§’è‰²ä¸Šä¸‹æ–‡**
```java
public class GameCharacter {
    private CharacterState currentState;
    private String name;
    private int health;
    private int mana;
    
    public GameCharacter(String name) {
        this.name = name;
        this.health = 100;
        this.mana = 50;
        this.currentState = new NormalState(); // åˆå§‹ä¸ºæ­£å¸¸çŠ¶æ€
    }
    
    public void setState(CharacterState state) {
        this.currentState = state;
        System.out.println(name + " è¿›å…¥ " + state.getStateName() + " çŠ¶æ€");
    }
    
    // å§”æ‰˜ç»™çŠ¶æ€å¤„ç†
    public void move() { currentState.move(this); }
    public void attack() { currentState.attack(this); }
    public void defend() { currentState.defend(this); }
    public void useSkill() { currentState.useSkill(this); }
    
    // çŠ¶æ€å˜åŒ–æ¡ä»¶æ£€æŸ¥
    public void takeDamage(int damage) {
        health -= damage;
        if (health <= 0) {
            setState(new DeadState());
        } else if (health < 20) {
            setState(new InjuredState());
        }
    }
    
    // getter/setteræ–¹æ³•
    public String getName() { return name; }
    public int getHealth() { return health; }
    public void setHealth(int health) { this.health = health; }
}
```

### 2.3 å…·ä½“çŠ¶æ€å®ç°


**ğŸ”¸ æ­£å¸¸çŠ¶æ€**
```java
public class NormalState implements CharacterState {
    @Override
    public void move(GameCharacter character) {
        System.out.println(character.getName() + " æ­£å¸¸ç§»åŠ¨");
    }
    
    @Override
    public void attack(GameCharacter character) {
        System.out.println(character.getName() + " å‘åŠ¨æ”»å‡»ï¼");
    }
    
    @Override
    public void useSkill(GameCharacter character) {
        System.out.println(character.getName() + " æ–½æ”¾æŠ€èƒ½ï¼");
    }
    
    @Override
    public String getStateName() { return "æ­£å¸¸"; }
}
```

**ğŸ”¸ å—ä¼¤çŠ¶æ€**
```java
public class InjuredState implements CharacterState {
    @Override
    public void move(GameCharacter character) {
        System.out.println(character.getName() + " ç¼“æ…¢ç§»åŠ¨ï¼ˆå—ä¼¤çŠ¶æ€ï¼‰");
    }
    
    @Override
    public void attack(GameCharacter character) {
        System.out.println(character.getName() + " è™šå¼±æ”»å‡»ï¼ˆæ”»å‡»åŠ›å‡åŠï¼‰");
    }
    
    @Override
    public void useSkill(GameCharacter character) {
        System.out.println(character.getName() + " æŠ€èƒ½æ–½æ”¾å¤±è´¥ï¼ˆé­”æ³•ä¸è¶³ï¼‰");
    }
    
    @Override
    public String getStateName() { return "å—ä¼¤"; }
}
```

### 2.4 çŠ¶æ€è½¬æ¢ç¤ºæ„


```
è§’è‰²çŠ¶æ€è½¬æ¢ï¼š

  æ­£å¸¸çŠ¶æ€ â”€â”€å—åˆ°ä¼¤å®³â”€â”€â†’ å—ä¼¤çŠ¶æ€ â”€â”€ç»§ç»­å—ä¼¤â”€â”€â†’ æ­»äº¡çŠ¶æ€
     â†‘                     â†‘                      â”‚
     â”‚                     â”‚                      â”‚
   æ¢å¤è¡€é‡               æ¢å¤è¡€é‡               å¤æ´»é“å…·
     â”‚                     â”‚                      â”‚
     â”‚                     â”‚                      â†“
  è·å¾—BUFF â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å—ä¼¤çŠ¶æ€              æ­»äº¡çŠ¶æ€
     â”‚
     â”‚
   æ— æ•ŒçŠ¶æ€
```

**ğŸ¯ çŠ¶æ€æ¨¡å¼çš„æ¸¸æˆä¼˜åŠ¿**
- **è¡Œä¸ºè‡ªç„¶**ï¼šä¸åŒçŠ¶æ€ä¸‹çš„è¡Œä¸ºç¬¦åˆæ¸¸æˆé€»è¾‘
- **æ˜“äºå¹³è¡¡**ï¼šè°ƒæ•´æŸä¸ªçŠ¶æ€ä¸å½±å“å…¶ä»–çŠ¶æ€
- **æ‰©å±•æ€§å¼º**ï¼šå®¹æ˜“æ·»åŠ æ–°çš„çŠ¶æ€æ•ˆæœ
- **ç»´æŠ¤ç®€å•**ï¼šæ¯ä¸ªçŠ¶æ€ç‹¬ç«‹ï¼Œä¾¿äºè°ƒè¯•

---

## 3. ğŸŒ ç½‘ç»œè¿æ¥çŠ¶æ€


### 3.1 ç½‘ç»œè¿æ¥çŠ¶æ€ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯ç½‘ç»œè¿æ¥çŠ¶æ€ï¼Ÿ**
å°±åƒæ‰‹æœºçš„ç½‘ç»œä¿¡å·ï¼Œæœ‰ä¸åŒçŠ¶æ€ï¼šæœªè¿æ¥ã€è¿æ¥ä¸­ã€å·²è¿æ¥ã€æ–­å¼€ä¸­ã€‚æ¯ä¸ªçŠ¶æ€ä¸‹èƒ½åšçš„æ“ä½œä¸åŒã€‚

```
ğŸ“± æ‰‹æœºç½‘ç»œçŠ¶æ€ç±»æ¯”ï¼š
æœªè¿æ¥ï¼šä¸èƒ½ä¸Šç½‘ï¼Œå¯ä»¥å°è¯•è¿æ¥
è¿æ¥ä¸­ï¼šæ­£åœ¨å»ºç«‹è¿æ¥ï¼Œä¸èƒ½å‘é€æ•°æ®
å·²è¿æ¥ï¼šå¯ä»¥æ­£å¸¸æ”¶å‘æ•°æ®
æ–­å¼€ä¸­ï¼šæ­£åœ¨æ–­å¼€ï¼Œä¸æ¥å—æ–°è¯·æ±‚
```

### 3.2 ç½‘ç»œè¿æ¥çŠ¶æ€è®¾è®¡


**ğŸ“‹ è¿æ¥çŠ¶æ€æ¥å£**
```java
public interface ConnectionState {
    void connect(NetworkConnection connection);     // å»ºç«‹è¿æ¥
    void disconnect(NetworkConnection connection);  // æ–­å¼€è¿æ¥
    void sendData(NetworkConnection connection, String data);  // å‘é€æ•°æ®
    void receiveData(NetworkConnection connection); // æ¥æ”¶æ•°æ®
    String getStateName();
}
```

**ğŸ—ï¸ ç½‘ç»œè¿æ¥ä¸Šä¸‹æ–‡**
```java
public class NetworkConnection {
    private ConnectionState currentState;
    private String serverAddress;
    private boolean isConnected;
    
    public NetworkConnection(String serverAddress) {
        this.serverAddress = serverAddress;
        this.currentState = new DisconnectedState(); // åˆå§‹ä¸ºæ–­å¼€çŠ¶æ€
        this.isConnected = false;
    }
    
    public void setState(ConnectionState state) {
        this.currentState = state;
        System.out.println("ç½‘ç»œçŠ¶æ€ï¼š" + state.getStateName());
    }
    
    // æ“ä½œå§”æ‰˜
    public void connect() { currentState.connect(this); }
    public void disconnect() { currentState.disconnect(this); }
    public void sendData(String data) { currentState.sendData(this, data); }
    public void receiveData() { currentState.receiveData(this); }
    
    // çŠ¶æ€å±æ€§
    public void setConnected(boolean connected) { this.isConnected = connected; }
    public boolean isConnected() { return isConnected; }
    public String getServerAddress() { return serverAddress; }
}
```

### 3.3 å…·ä½“è¿æ¥çŠ¶æ€


**ğŸ”¸ æ–­å¼€çŠ¶æ€**
```java
public class DisconnectedState implements ConnectionState {
    @Override
    public void connect(NetworkConnection connection) {
        System.out.println("å¼€å§‹è¿æ¥åˆ°ï¼š" + connection.getServerAddress());
        connection.setState(new ConnectingState());
        // æ¨¡æ‹Ÿè¿æ¥è¿‡ç¨‹
        simulateConnection(connection);
    }
    
    @Override
    public void sendData(NetworkConnection connection, String data) {
        System.out.println("æ— æ³•å‘é€æ•°æ®ï¼šæœªè¿æ¥åˆ°æœåŠ¡å™¨");
    }
    
    private void simulateConnection(NetworkConnection connection) {
        // æ¨¡æ‹Ÿè¿æ¥æˆåŠŸ
        new Thread(() -> {
            try {
                Thread.sleep(2000); // æ¨¡æ‹Ÿè¿æ¥è€—æ—¶
                connection.setConnected(true);
                connection.setState(new ConnectedState());
            } catch (InterruptedException e) {
                connection.setState(new DisconnectedState());
            }
        }).start();
    }
    
    @Override
    public String getStateName() { return "æœªè¿æ¥"; }
}
```

**ğŸ”¸ å·²è¿æ¥çŠ¶æ€**
```java
public class ConnectedState implements ConnectionState {
    @Override
    public void connect(NetworkConnection connection) {
        System.out.println("å·²ç»è¿æ¥ï¼Œæ— éœ€é‡å¤è¿æ¥");
    }
    
    @Override
    public void sendData(NetworkConnection connection, String data) {
        System.out.println("å‘é€æ•°æ®ï¼š" + data);
        // æ¨¡æ‹Ÿç½‘ç»œå¼‚å¸¸
        if (Math.random() < 0.1) { // 10%æ¦‚ç‡ç½‘ç»œå¼‚å¸¸
            System.out.println("ç½‘ç»œå¼‚å¸¸ï¼Œè¿æ¥æ–­å¼€");
            connection.setState(new DisconnectedState());
        }
    }
    
    @Override
    public void disconnect(NetworkConnection connection) {
        System.out.println("æ­£åœ¨æ–­å¼€è¿æ¥...");
        connection.setState(new DisconnectingState());
    }
    
    @Override
    public String getStateName() { return "å·²è¿æ¥"; }
}
```

### 3.4 ç½‘ç»œçŠ¶æ€è½¬æ¢å›¾


```
ç½‘ç»œè¿æ¥çŠ¶æ€è½¬æ¢ï¼š

    æœªè¿æ¥ â”€â”€connect()â”€â”€â†’ è¿æ¥ä¸­ â”€â”€æˆåŠŸâ”€â”€â†’ å·²è¿æ¥
       â†‘                   â”‚              â”‚
       â”‚                 å¤±è´¥            â”‚
       â”‚                   â”‚              â”‚
    æ–­å¼€å®Œæˆ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è¿æ¥å¤±è´¥    disconnect()
       â†‘                                  â”‚
       â”‚                                  â†“
    æ–­å¼€ä¸­ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ–­å¼€ä¸­
```

**ğŸ’¡ çŠ¶æ€æ¨¡å¼ç½‘ç»œåº”ç”¨ä¼˜åŠ¿**
- **çŠ¶æ€æ¸…æ™°**ï¼šç½‘ç»œçŠ¶æ€ä¸€ç›®äº†ç„¶
- **æ“ä½œå®‰å…¨**ï¼šé¿å…åœ¨é”™è¯¯çŠ¶æ€ä¸‹æ‰§è¡Œæ“ä½œ
- **å¼‚å¸¸å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸æ—¶çŠ¶æ€è½¬æ¢è‡ªç„¶
- **é‡è¿æœºåˆ¶**ï¼šå®¹æ˜“å®ç°è‡ªåŠ¨é‡è¿é€»è¾‘

---

## 4. ğŸ“‹ å·¥ä½œæµçŠ¶æ€æœº


### 4.1 å·¥ä½œæµçŠ¶æ€ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯å·¥ä½œæµçŠ¶æ€ï¼Ÿ**
å·¥ä½œæµå°±åƒå…¬å¸çš„å®¡æ‰¹æµç¨‹ï¼šç”³è¯·â†’éƒ¨é—¨å®¡æ‰¹â†’è´¢åŠ¡å®¡æ‰¹â†’æ€»ç»ç†å®¡æ‰¹â†’å®Œæˆã€‚æ¯ä¸ªç¯èŠ‚å°±æ˜¯ä¸€ä¸ªçŠ¶æ€ã€‚

```
ğŸ“‹ è¯·å‡ç”³è¯·æµç¨‹ï¼š
æäº¤ç”³è¯· â†’ éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹ â†’ HRå®¡æ‰¹ â†’ æ€»ç»ç†å®¡æ‰¹ â†’ ç”³è¯·å®Œæˆ
    â”‚           â”‚           â”‚           â”‚
  å¯æ’¤å›      å¯é©³å›      å¯é©³å›      å¯é©³å›
    â”‚           â”‚           â”‚           â”‚
    â†“           â†“           â†“           â†“
  å·²æ’¤å›      å·²é©³å›      å·²é©³å›      å·²é©³å›
```

### 4.2 å·¥ä½œæµçŠ¶æ€è®¾è®¡


**ğŸ“‹ å·¥ä½œæµçŠ¶æ€æ¥å£**
```java
public interface WorkflowState {
    void submit(WorkflowContext workflow);      // æäº¤
    void approve(WorkflowContext workflow);     // å®¡æ‰¹é€šè¿‡
    void reject(WorkflowContext workflow);      // å®¡æ‰¹é©³å›
    void withdraw(WorkflowContext workflow);    // æ’¤å›
    String getStateName();
    String getCurrentHandler();                 // å½“å‰å¤„ç†äºº
}
```

**ğŸ—ï¸ å·¥ä½œæµä¸Šä¸‹æ–‡**
```java
public class WorkflowContext {
    private WorkflowState currentState;
    private String applicant;      // ç”³è¯·äºº
    private String content;        // ç”³è¯·å†…å®¹
    private String rejectionReason; // é©³å›åŸå› 
    
    public WorkflowContext(String applicant, String content) {
        this.applicant = applicant;
        this.content = content;
        this.currentState = new DraftState(); // åˆå§‹ä¸ºè‰ç¨¿çŠ¶æ€
    }
    
    public void setState(WorkflowState state) {
        this.currentState = state;
        System.out.println("å·¥ä½œæµçŠ¶æ€ï¼š" + state.getStateName());
        System.out.println("å½“å‰å¤„ç†äººï¼š" + state.getCurrentHandler());
    }
    
    // æ“ä½œå§”æ‰˜
    public void submit() { currentState.submit(this); }
    public void approve() { currentState.approve(this); }
    public void reject() { currentState.reject(this); }
    public void withdraw() { currentState.withdraw(this); }
    
    // å±æ€§è®¿é—®
    public String getApplicant() { return applicant; }
    public String getContent() { return content; }
    public void setRejectionReason(String reason) { this.rejectionReason = reason; }
}
```

### 4.3 å…·ä½“å·¥ä½œæµçŠ¶æ€


**ğŸ”¸ è‰ç¨¿çŠ¶æ€**
```java
public class DraftState implements WorkflowState {
    @Override
    public void submit(WorkflowContext workflow) {
        System.out.println("ç”³è¯·å·²æäº¤ï¼Œç­‰å¾…éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹");
        workflow.setState(new DepartmentReviewState());
    }
    
    @Override
    public void approve(WorkflowContext workflow) {
        System.out.println("è‰ç¨¿çŠ¶æ€æ— æ³•å®¡æ‰¹");
    }
    
    @Override
    public void withdraw(WorkflowContext workflow) {
        System.out.println("ç”³è¯·å·²æ’¤å›");
        workflow.setState(new WithdrawnState());
    }
    
    @Override
    public String getStateName() { return "è‰ç¨¿"; }
    
    @Override
    public String getCurrentHandler() { return workflow.getApplicant(); }
}
```

**ğŸ”¸ éƒ¨é—¨å®¡æ‰¹çŠ¶æ€**
```java
public class DepartmentReviewState implements WorkflowState {
    @Override
    public void approve(WorkflowContext workflow) {
        System.out.println("éƒ¨é—¨ä¸»ç®¡å®¡æ‰¹é€šè¿‡ï¼Œæäº¤HRå®¡æ‰¹");
        workflow.setState(new HRReviewState());
    }
    
    @Override
    public void reject(WorkflowContext workflow) {
        System.out.println("éƒ¨é—¨ä¸»ç®¡é©³å›ç”³è¯·");
        workflow.setState(new RejectedState());
    }
    
    @Override
    public void submit(WorkflowContext workflow) {
        System.out.println("ç”³è¯·å·²åœ¨å®¡æ‰¹ä¸­ï¼Œæ— éœ€é‡å¤æäº¤");
    }
    
    @Override
    public String getStateName() { return "éƒ¨é—¨å®¡æ‰¹ä¸­"; }
    
    @Override
    public String getCurrentHandler() { return "éƒ¨é—¨ä¸»ç®¡"; }
}
```

### 4.4 å·¥ä½œæµçŠ¶æ€è½¬æ¢


```
å·¥ä½œæµçŠ¶æ€è½¬æ¢å›¾ï¼š

è‰ç¨¿ â”€â”€submit()â”€â”€â†’ éƒ¨é—¨å®¡æ‰¹ â”€â”€approve()â”€â”€â†’ HRå®¡æ‰¹ â”€â”€approve()â”€â”€â†’ æ€»ç»ç†å®¡æ‰¹ â”€â”€approve()â”€â”€â†’ å·²å®Œæˆ
 â”‚                    â”‚                     â”‚                        â”‚
 â”‚                    â”‚                     â”‚                        â”‚
withdraw()          reject()              reject()                 reject()
 â”‚                    â”‚                     â”‚                        â”‚
 â†“                    â†“                     â†“                        â†“
å·²æ’¤å›              å·²é©³å›                å·²é©³å›                   å·²é©³å›
```

**ğŸ¯ å·¥ä½œæµçŠ¶æ€æ¨¡å¼ä¼˜åŠ¿**
- **æµç¨‹æ¸…æ™°**ï¼šæ¯ä¸ªå®¡æ‰¹ç¯èŠ‚èŒè´£æ˜ç¡®
- **æƒé™æ§åˆ¶**ï¼šä¸åŒçŠ¶æ€ä¸‹çš„æ“ä½œæƒé™ä¸åŒ
- **æ‰©å±•å®¹æ˜“**ï¼šå¢åŠ å®¡æ‰¹ç¯èŠ‚åªéœ€æ·»åŠ æ–°çŠ¶æ€
- **è·Ÿè¸ªæ–¹ä¾¿**ï¼šéšæ—¶çŸ¥é“ç”³è¯·åœ¨å“ªä¸ªç¯èŠ‚

---

## 5. ğŸ”— TCPè¿æ¥çŠ¶æ€


### 5.1 TCPè¿æ¥çŠ¶æ€ç†è§£


**ğŸ¯ ä»€ä¹ˆæ˜¯TCPè¿æ¥çŠ¶æ€ï¼Ÿ**
TCPè¿æ¥å°±åƒæ‰“ç”µè¯ï¼šæ‹¨å·â†’ç­‰å¾…æ¥å¬â†’é€šè¯â†’æŒ‚æ–­ã€‚æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç‰¹å®šçš„çŠ¶æ€å’Œè¡Œä¸ºã€‚

```
ğŸ“ TCPè¿æ¥ç±»æ¯”æ‰“ç”µè¯ï¼š
CLOSED    â†’ ç”µè¯æŒ‚æ–­çŠ¶æ€ï¼Œå¯ä»¥æ‹¨å·
LISTEN    â†’ ç­‰å¾…æ¥ç”µï¼ˆæœåŠ¡å™¨çŠ¶æ€ï¼‰
SYN_SENT  â†’ æ­£åœ¨æ‹¨å·ï¼ˆå®¢æˆ·ç«¯å‘èµ·è¿æ¥ï¼‰
ESTABLISHED â†’ é€šè¯ä¸­ï¼Œå¯ä»¥ä¼ è¾“æ•°æ®
FIN_WAIT  â†’ å‡†å¤‡æŒ‚æ–­ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤
CLOSED    â†’ ç”µè¯å·²æŒ‚æ–­
```

### 5.2 TCPçŠ¶æ€è®¾è®¡æ€è·¯


**ğŸ” ä¸ºä»€ä¹ˆTCPéœ€è¦çŠ¶æ€ç®¡ç†ï¼Ÿ**
TCPè¿æ¥çš„å»ºç«‹å’Œæ–­å¼€æ˜¯ä¸ªå¤æ‚è¿‡ç¨‹ï¼Œéœ€è¦å¤šæ¬¡æ¡æ‰‹ã€‚çŠ¶æ€æ¨¡å¼å¸®åŠ©ç®¡ç†è¿™ä¸ªè¿‡ç¨‹ï¼š

â”Œâ”€ TCPçŠ¶æ€ç®¡ç†çš„é‡è¦æ€§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç¡®ä¿è¿æ¥çš„å¯é æ€§           â”‚
â”‚ 2. é˜²æ­¢æ•°æ®ä¸¢å¤±               â”‚
â”‚ 3. æ­£ç¡®å¤„ç†å¼‚å¸¸æƒ…å†µ           â”‚
â”‚ 4. èµ„æºçš„åˆç†åˆ†é…å’Œé‡Šæ”¾       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 5.3 TCPçŠ¶æ€ç®€åŒ–å®ç°


**ğŸ“‹ TCPçŠ¶æ€æ¥å£**
```java
public interface TCPState {
    void open(TCPConnection connection);        // ä¸»åŠ¨å»ºç«‹è¿æ¥
    void close(TCPConnection connection);       // ä¸»åŠ¨å…³é—­è¿æ¥  
    void acknowledge(TCPConnection connection); // æ”¶åˆ°ç¡®è®¤
    void synchronize(TCPConnection connection); // æ”¶åˆ°åŒæ­¥è¯·æ±‚
    String getStateName();
}
```

**ğŸ—ï¸ TCPè¿æ¥ä¸Šä¸‹æ–‡**
```java
public class TCPConnection {
    private TCPState currentState;
    private String localAddress;
    private String remoteAddress;
    
    public TCPConnection(String localAddr, String remoteAddr) {
        this.localAddress = localAddr;
        this.remoteAddress = remoteAddr;
        this.currentState = new ClosedState(); // åˆå§‹ä¸ºå…³é—­çŠ¶æ€
    }
    
    public void setState(TCPState state) {
        this.currentState = state;
        System.out.println("TCPçŠ¶æ€ï¼š" + state.getStateName());
    }
    
    // æ“ä½œå§”æ‰˜
    public void activeOpen() { currentState.open(this); }
    public void close() { currentState.close(this); }
    public void receiveAck() { currentState.acknowledge(this); }
    public void receiveSyn() { currentState.synchronize(this); }
    
    public String getLocalAddress() { return localAddress; }
    public String getRemoteAddress() { return remoteAddress; }
}
```

### 5.4 æ ¸å¿ƒTCPçŠ¶æ€å®ç°


**ğŸ”¸ å…³é—­çŠ¶æ€ï¼ˆCLOSEDï¼‰**
```java
public class ClosedState implements TCPState {
    @Override
    public void open(TCPConnection connection) {
        System.out.println("å‘é€SYNï¼Œå»ºç«‹è¿æ¥");
        connection.setState(new SynSentState());
    }
    
    @Override
    public void synchronize(TCPConnection connection) {
        System.out.println("æ”¶åˆ°SYNï¼Œå‘é€SYN+ACK");
        connection.setState(new SynReceivedState());
    }
    
    @Override
    public String getStateName() { return "CLOSED"; }
}
```

**ğŸ”¸ å·²å»ºç«‹çŠ¶æ€ï¼ˆESTABLISHEDï¼‰**
```java
public class EstablishedState implements TCPState {
    @Override
    public void close(TCPConnection connection) {
        System.out.println("å‘é€FINï¼Œå¼€å§‹å…³é—­è¿æ¥");
        connection.setState(new FinWait1State());
    }
    
    @Override
    public void open(TCPConnection connection) {
        System.out.println("è¿æ¥å·²å»ºç«‹ï¼Œæ— éœ€é‡å¤è¿æ¥");
    }
    
    public void sendData(String data) {
        System.out.println("å‘é€æ•°æ®ï¼š" + data);
    }
    
    @Override
    public String getStateName() { return "ESTABLISHED"; }
}
```

### 5.5 TCPçŠ¶æ€è½¬æ¢å›¾


```
TCPè¿æ¥çŠ¶æ€è½¬æ¢ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

    CLOSED â”€â”€â”€â”€â”€activeOpen()â”€â”€â”€â”€â”€â†’ SYN_SENT â”€â”€receiveAck()â”€â”€â†’ ESTABLISHED
       â†‘                             â”‚                            â”‚
       â”‚                           timeout                       â”‚
       â”‚                             â”‚                            â”‚
   closeComplete()                    â†“                       close()
       â”‚                          CLOSED                         â”‚
       â”‚                                                         â†“
    CLOSED â†â”€â”€â”€â”€receiveAck()â”€â”€â”€â”€â”€ FIN_WAIT â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FIN_WAIT
```

**ğŸ”¸ ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹**
```
å®¢æˆ·ç«¯çŠ¶æ€å˜åŒ–ï¼š
CLOSED â†’ (å‘é€SYN) â†’ SYN_SENT â†’ (æ”¶åˆ°SYN+ACK) â†’ ESTABLISHED

æœåŠ¡ç«¯çŠ¶æ€å˜åŒ–ï¼š  
CLOSED â†’ LISTEN â†’ (æ”¶åˆ°SYN) â†’ SYN_RECEIVED â†’ (æ”¶åˆ°ACK) â†’ ESTABLISHED
```

**ğŸ¯ TCPçŠ¶æ€æ¨¡å¼çš„æ„ä¹‰**
- **åè®®æ­£ç¡®æ€§**ï¼šç¡®ä¿æŒ‰åè®®è§„èŒƒå¤„ç†æ¯ä¸ªçŠ¶æ€
- **å¼‚å¸¸å¤„ç†**ï¼šç½‘ç»œå¼‚å¸¸æ—¶çŠ¶æ€è½¬æ¢æ¸…æ™°
- **èµ„æºç®¡ç†**ï¼šåŠæ—¶é‡Šæ”¾æ— ç”¨è¿æ¥èµ„æº
- **è°ƒè¯•æ–¹ä¾¿**ï¼šé—®é¢˜å®šä½æ—¶çŠ¶æ€ä¿¡æ¯å¾ˆé‡è¦

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 çŠ¶æ€æ¨¡å¼å®é™…åº”ç”¨çš„å…±åŒç‰¹ç‚¹


**ğŸ” ä»€ä¹ˆåœºæ™¯é€‚åˆç”¨çŠ¶æ€æ¨¡å¼ï¼Ÿ**

âœ… **é€‚ç”¨åœºæ™¯**ï¼š
- å¯¹è±¡è¡Œä¸ºæ ¹æ®çŠ¶æ€å˜åŒ–è€Œå˜åŒ–
- çŠ¶æ€è½¬æ¢è§„åˆ™å¤æ‚
- é¿å…å¤§é‡if-elseåˆ¤æ–­
- çŠ¶æ€ç›¸å…³çš„è¡Œä¸ºéœ€è¦ç‹¬ç«‹å˜åŒ–

âŒ **ä¸é€‚ç”¨åœºæ™¯**ï¼š
- çŠ¶æ€å¾ˆå°‘ä¸”ç¨³å®šä¸å˜
- çŠ¶æ€è½¬æ¢é€»è¾‘ç®€å•
- æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯

### 6.2 çŠ¶æ€æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼


**ğŸ’¡ è§£å†³çš„æ ¹æœ¬é—®é¢˜**

â”Œâ”€ çŠ¶æ€æ¨¡å¼æ ¸å¿ƒä»·å€¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¶ˆé™¤å¤æ‚çš„æ¡ä»¶åˆ¤æ–­è¯­å¥       â”‚
â”‚ 2. è®©çŠ¶æ€è½¬æ¢é€»è¾‘æ›´æ¸…æ™°         â”‚
â”‚ 3. æ¯ä¸ªçŠ¶æ€çš„èŒè´£æ›´å•ä¸€         â”‚
â”‚ 4. æ–°å¢çŠ¶æ€ä¸å½±å“ç°æœ‰ä»£ç        â”‚
â”‚ 5. çŠ¶æ€ç›¸å…³è¡Œä¸ºæ›´å®¹æ˜“ç»´æŠ¤       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

### 6.3 å®é™…åº”ç”¨ä¸­çš„æ³¨æ„äº‹é¡¹


**ğŸ¯ è®¾è®¡è¦ç‚¹**

```
çŠ¶æ€æ¥å£è®¾è®¡ï¼š
- å®šä¹‰æ‰€æœ‰å¯èƒ½çš„æ“ä½œæ–¹æ³•
- æ¯ä¸ªæ–¹æ³•éƒ½è¦åœ¨æ‰€æœ‰çŠ¶æ€ä¸­å®ç°
- è€ƒè™‘çŠ¶æ€è½¬æ¢çš„è§¦å‘æ¡ä»¶

ä¸Šä¸‹æ–‡ç±»è®¾è®¡ï¼š
- ç»´æŠ¤å½“å‰çŠ¶æ€çš„å¼•ç”¨
- æä¾›çŠ¶æ€è½¬æ¢çš„æ–¹æ³•
- å§”æ‰˜å…·ä½“æ“ä½œç»™çŠ¶æ€å¯¹è±¡

çŠ¶æ€ç±»è®¾è®¡ï¼š
- å®ç°ç‰¹å®šçŠ¶æ€ä¸‹çš„è¡Œä¸º
- å¤„ç†çŠ¶æ€è½¬æ¢é€»è¾‘
- åŒ…å«å¿…è¦çš„çŠ¶æ€æ•°æ®
```

**âš ï¸ å¸¸è§é™·é˜±**

ğŸ”¸ **çŠ¶æ€è†¨èƒ€**ï¼šçŠ¶æ€å¤ªå¤šæ—¶ç®¡ç†å¤æ‚
- è§£å†³ï¼šåˆå¹¶ç›¸ä¼¼çŠ¶æ€ï¼Œæˆ–ä½¿ç”¨çŠ¶æ€å±‚æ¬¡

ğŸ”¸ **è½¬æ¢æ··ä¹±**ï¼šçŠ¶æ€è½¬æ¢è§„åˆ™ä¸æ¸…æ™°
- è§£å†³ï¼šç»˜åˆ¶çŠ¶æ€å›¾ï¼Œæ˜ç¡®è½¬æ¢æ¡ä»¶

ğŸ”¸ **èŒè´£ä¸æ¸…**ï¼šçŠ¶æ€ç±»èŒè´£åˆ’åˆ†ä¸æ˜ç¡®
- è§£å†³ï¼šå•ä¸€èŒè´£åŸåˆ™ï¼Œä¸€ä¸ªçŠ¶æ€ä¸€ä¸ªèŒè´£

### 6.4 çŠ¶æ€æ¨¡å¼ vs ç­–ç•¥æ¨¡å¼


| ç‰¹å¾ | çŠ¶æ€æ¨¡å¼ | ç­–ç•¥æ¨¡å¼ |
|------|----------|----------|
| **æ ¸å¿ƒç›®çš„** | ç®¡ç†å¯¹è±¡çŠ¶æ€å˜åŒ– | ç®—æ³•çš„çµæ´»åˆ‡æ¢ |
| **è¡Œä¸ºå˜åŒ–** | çŠ¶æ€é©±åŠ¨è¡Œä¸ºå˜åŒ– | å¤–éƒ¨é€‰æ‹©ç®—æ³• |
| **å¯¹è±¡å…³ç³»** | çŠ¶æ€å¯¹è±¡çŸ¥é“ä¸Šä¸‹æ–‡ | ç­–ç•¥å¯¹è±¡ç‹¬ç«‹ |
| **ç”Ÿå‘½å‘¨æœŸ** | çŠ¶æ€æœ‰ç”Ÿå‘½å‘¨æœŸ | ç­–ç•¥ç›¸å¯¹ç¨³å®š |
| **å…¸å‹åº”ç”¨** | å·¥ä½œæµã€æ¸¸æˆçŠ¶æ€ | æ’åºç®—æ³•ã€æ”¯ä»˜æ–¹å¼ |

### 6.5 å®é™…é¡¹ç›®ä¸­çš„æœ€ä½³å®è·µ


**ğŸš€ å®ç”¨å»ºè®®**

1. **å…ˆç”»çŠ¶æ€å›¾**ï¼šä»£ç å®ç°å‰å…ˆç”»æ¸…æ¥šçŠ¶æ€è½¬æ¢å›¾
2. **çŠ¶æ€æšä¸¾**ï¼šç”¨æšä¸¾å®šä¹‰çŠ¶æ€å¸¸é‡ï¼Œé¿å…å­—ç¬¦ä¸²ç¡¬ç¼–ç 
3. **çŠ¶æ€æŒä¹…åŒ–**ï¼šè€ƒè™‘çŠ¶æ€çš„å­˜å‚¨å’Œæ¢å¤æœºåˆ¶
4. **å¼‚å¸¸å¤„ç†**ï¼šæ¯ä¸ªçŠ¶æ€éƒ½è¦è€ƒè™‘å¼‚å¸¸æƒ…å†µçš„å¤„ç†
5. **æ—¥å¿—è®°å½•**ï¼šçŠ¶æ€è½¬æ¢æ—¶è®°å½•æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

**ğŸ“Š æ€§èƒ½è€ƒè™‘**

- çŠ¶æ€å¯¹è±¡å¯ä»¥è€ƒè™‘å•ä¾‹æ¨¡å¼ï¼ˆå¦‚æœæ— çŠ¶æ€æ•°æ®ï¼‰
- çŠ¶æ€è½¬æ¢é¢‘ç¹æ—¶ï¼Œé¿å…è¿‡å¤šçš„å¯¹è±¡åˆ›å»º
- å¤æ‚çŠ¶æ€æœºå¯ä»¥è€ƒè™‘ç¼“å­˜çŠ¶æ€è½¬æ¢ç»“æœ

**ğŸ¯ è®°ä½è¿™å¥è¯**ï¼š
çŠ¶æ€æ¨¡å¼è®©å¯¹è±¡åœ¨ä¸åŒçŠ¶æ€ä¸‹è¡¨ç°ä¸åŒè¡Œä¸ºï¼Œå°±åƒäººåœ¨ä¸åŒæƒ…å†µä¸‹ä¼šæœ‰ä¸åŒååº”ä¸€æ ·è‡ªç„¶ã€‚å…³é”®æ˜¯è®©æ¯ä¸ªçŠ¶æ€éƒ½ä¸“æ³¨äºè‡ªå·±è¯¥åšçš„äº‹ï¼Œè¿™æ ·æ•´ä¸ªç³»ç»Ÿå°±ä¼šå˜å¾—æ¸…æ™°å¯ç»´æŠ¤ã€‚