---
title: 2ã€å¤‡å¿˜å½•æ¨¡å¼ç»“æ„åˆ†æ
---
## ğŸ“š ç›®å½•

1. [å¤‡å¿˜å½•æ¨¡å¼åŸºç¡€æ¦‚å¿µ](#1-å¤‡å¿˜å½•æ¨¡å¼åŸºç¡€æ¦‚å¿µ)
2. [å‘èµ·äººç±»è®¾è®¡è¯¦è§£](#2-å‘èµ·äººç±»è®¾è®¡è¯¦è§£)
3. [å¤‡å¿˜å½•ç±»è®¾è®¡è¯¦è§£](#3-å¤‡å¿˜å½•ç±»è®¾è®¡è¯¦è§£)
4. [ç®¡ç†è€…ç±»è®¾è®¡è¯¦è§£](#4-ç®¡ç†è€…ç±»è®¾è®¡è¯¦è§£)
5. [çŠ¶æ€ä¿å­˜æœºåˆ¶æ·±å…¥åˆ†æ](#5-çŠ¶æ€ä¿å­˜æœºåˆ¶æ·±å…¥åˆ†æ)
6. [çŠ¶æ€æ¢å¤æœºåˆ¶æ·±å…¥åˆ†æ](#6-çŠ¶æ€æ¢å¤æœºåˆ¶æ·±å…¥åˆ†æ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§  å¤‡å¿˜å½•æ¨¡å¼åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¤‡å¿˜å½•æ¨¡å¼


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå¤‡å¿˜å½•æ¨¡å¼å°±åƒæ¸¸æˆä¸­çš„"å­˜æ¡£"åŠŸèƒ½ï¼Œå¯ä»¥åœ¨å…³é”®æ—¶åˆ»ä¿å­˜å½“å‰çŠ¶æ€ï¼Œéœ€è¦æ—¶èƒ½å¤Ÿæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€

**ğŸ¯ æ ¸å¿ƒä½œç”¨**ï¼š
```
å¤‡å¿˜å½•æ¨¡å¼ = çŠ¶æ€å¿«ç…§ + çŠ¶æ€æ¢å¤
ç›®çš„ï¼šåœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·å¹¶ä¿å­˜å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€
åº”ç”¨ï¼šæ’¤é”€æ“ä½œã€äº‹åŠ¡å›æ»šã€æ¸¸æˆå­˜æ¡£ç­‰
```

### 1.2 ç°å®ç”Ÿæ´»ä¸­çš„å¤‡å¿˜å½•æ¨¡å¼


**ğŸ“ ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
Wordæ–‡æ¡£çš„æ’¤é”€åŠŸèƒ½ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ å½“å‰æ–‡æ¡£çŠ¶æ€                â”‚
â”‚ â”œâ”€ ç¬¬1æ®µï¼šé¡¹ç›®ä»‹ç»             â”‚
â”‚ â”œâ”€ ç¬¬2æ®µï¼šæŠ€æœ¯æ–¹æ¡ˆ             â”‚
â”‚ â””â”€ ç¬¬3æ®µï¼šå®æ–½è®¡åˆ’             â”‚
â”‚                                 â”‚
â”‚ ğŸ’¾ å¤‡å¿˜å½•ï¼ˆå­˜æ¡£ç‚¹ï¼‰            â”‚
â”‚ â”œâ”€ å­˜æ¡£1ï¼šåªæœ‰ç¬¬1æ®µ            â”‚
â”‚ â”œâ”€ å­˜æ¡£2ï¼šæœ‰ç¬¬1ã€2æ®µ           â”‚
â”‚ â””â”€ å­˜æ¡£3ï¼šå®Œæ•´çš„ä¸‰æ®µ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·æŒ‰ä¸‹Ctrl+Z â†’ æ¢å¤åˆ°å­˜æ¡£2çŠ¶æ€
```

### 1.3 å¤‡å¿˜å½•æ¨¡å¼çš„ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²


**ğŸ­ è§’è‰²å…³ç³»å›¾**ï¼š
```
å‘èµ·äºº(Originator)     ç®¡ç†è€…(Caretaker)
      â”‚                      â”‚
      â”‚ åˆ›å»º/ä½¿ç”¨             â”‚ å­˜å‚¨/ç®¡ç†
      â–¼                      â–¼
   å¤‡å¿˜å½•(Memento) â†â”€â”€â”€â”€â”€â”€â”€ å¤‡å¿˜å½•åˆ—è¡¨

è§’è‰²è¯´æ˜ï¼š
ğŸ”¸ å‘èµ·äººï¼šéœ€è¦ä¿å­˜çŠ¶æ€çš„å¯¹è±¡ï¼ˆå¦‚æ–‡æ¡£ç¼–è¾‘å™¨ï¼‰
ğŸ”¸ å¤‡å¿˜å½•ï¼šä¿å­˜çŠ¶æ€ä¿¡æ¯çš„å¯¹è±¡ï¼ˆå¦‚å­˜æ¡£æ–‡ä»¶ï¼‰
ğŸ”¸ ç®¡ç†è€…ï¼šè´Ÿè´£ç®¡ç†å¤‡å¿˜å½•çš„å¯¹è±¡ï¼ˆå¦‚å­˜æ¡£ç®¡ç†å™¨ï¼‰
```

---

## 2. ğŸ‘¤ å‘èµ·äººç±»è®¾è®¡è¯¦è§£


### 2.1 å‘èµ·äººç±»çš„æ ¸å¿ƒèŒè´£


**ğŸ¯ ä¸»è¦èŒè´£**ï¼š
- **çŠ¶æ€ç»´æŠ¤**ï¼šç®¡ç†è‡ªå·±çš„å†…éƒ¨çŠ¶æ€
- **å¤‡å¿˜å½•åˆ›å»º**ï¼šç”ŸæˆåŒ…å«å½“å‰çŠ¶æ€çš„å¤‡å¿˜å½•å¯¹è±¡
- **çŠ¶æ€æ¢å¤**ï¼šä»å¤‡å¿˜å½•ä¸­æ¢å¤ä¹‹å‰çš„çŠ¶æ€

### 2.2 å‘èµ·äººç±»çš„åŸºæœ¬ç»“æ„


```java
// å‘èµ·äººç±» - æ¸¸æˆè§’è‰²ç¤ºä¾‹
public class GameCharacter {
    // å†…éƒ¨çŠ¶æ€ - è¿™äº›æ˜¯éœ€è¦ä¿å­˜å’Œæ¢å¤çš„æ•°æ®
    private String name;        // è§’è‰²åç§°
    private int level;          // ç­‰çº§
    private int health;         // è¡€é‡
    private int experience;     // ç»éªŒå€¼
    private String location;    // å½“å‰ä½ç½®
    
    // æ„é€ æ–¹æ³•
    public GameCharacter(String name) {
        this.name = name;
        this.level = 1;
        this.health = 100;
        this.experience = 0;
        this.location = "æ–°æ‰‹æ‘";
    }
    
    // åˆ›å»ºå¤‡å¿˜å½• - ä¿å­˜å½“å‰çŠ¶æ€
    public GameMemento createMemento() {
        return new GameMemento(name, level, health, experience, location);
    }
    
    // ä»å¤‡å¿˜å½•æ¢å¤çŠ¶æ€
    public void restoreFromMemento(GameMemento memento) {
        this.name = memento.getName();
        this.level = memento.getLevel();
        this.health = memento.getHealth();
        this.experience = memento.getExperience();
        this.location = memento.getLocation();
    }
    
    // ä¸šåŠ¡æ–¹æ³• - ä¼šæ”¹å˜å†…éƒ¨çŠ¶æ€
    public void fightMonster() {
        this.health -= 20;
        this.experience += 50;
        if (this.experience >= 100) {
            levelUp();
        }
    }
    
    private void levelUp() {
        this.level++;
        this.health = 100; // å‡çº§åæ»¡è¡€
        this.experience = 0;
    }
}
```

### 2.3 å‘èµ·äººç±»è®¾è®¡è¦ç‚¹


**ğŸ”‘ è®¾è®¡åŸåˆ™**ï¼š

> ğŸ“Œ **å°è£…æ€§**ï¼šå‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ä¸åº”è¯¥ç›´æ¥æš´éœ²ç»™å¤–éƒ¨

> âš ï¸ **è´£ä»»å•ä¸€**ï¼šå‘èµ·äººåªè´Ÿè´£è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£å¤‡å¿˜å½•çš„ç®¡ç†

> ğŸ¯ **æ¥å£ç®€æ´**ï¼šåªæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤çŠ¶æ€ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•

**ğŸ’¡ å¸¸è§è®¾è®¡æ¨¡å¼**ï¼š
```
åˆ›å»ºå¤‡å¿˜å½•çš„æ—¶æœºï¼š
â”œâ”€ å…³é”®æ“ä½œå‰ï¼šé‡è¦æ“ä½œæ‰§è¡Œå‰è‡ªåŠ¨åˆ›å»º
â”œâ”€ ç”¨æˆ·è¯·æ±‚æ—¶ï¼šç”¨æˆ·ä¸»åŠ¨ä¿å­˜å½“å‰çŠ¶æ€  
â”œâ”€ å®šæ—¶ä¿å­˜ï¼šæŒ‰æ—¶é—´é—´éš”è‡ªåŠ¨åˆ›å»º
â””â”€ çŠ¶æ€å˜åŒ–æ—¶ï¼šæ£€æµ‹åˆ°é‡è¦çŠ¶æ€å˜åŒ–æ—¶åˆ›å»º
```

---

## 3. ğŸ’¾ å¤‡å¿˜å½•ç±»è®¾è®¡è¯¦è§£


### 3.1 å¤‡å¿˜å½•ç±»çš„æ ¸å¿ƒç‰¹å¾


**ğŸ”’ æ ¸å¿ƒç‰¹å¾**ï¼š
- **ä¸å¯å˜æ€§**ï¼šåˆ›å»ºåä¸èƒ½ä¿®æ”¹å†…éƒ¨æ•°æ®
- **æ•°æ®å®Œæ•´æ€§**ï¼šåŒ…å«å‘èµ·äººçš„å®Œæ•´çŠ¶æ€ä¿¡æ¯
- **è®¿é—®æ§åˆ¶**ï¼šåªæœ‰å‘èµ·äººèƒ½å¤Ÿè®¿é—®å†…éƒ¨çŠ¶æ€

### 3.2 å¤‡å¿˜å½•ç±»çš„å®ç°æ–¹å¼


**æ–¹å¼ä¸€ï¼šç®€å•å¤‡å¿˜å½•**
```java
// ç®€å•å¤‡å¿˜å½•å®ç°
public class GameMemento {
    // çŠ¶æ€æ•°æ® - å¯¹åº”å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€
    private final String name;
    private final int level;
    private final int health;
    private final int experience;
    private final String location;
    private final long timestamp; // åˆ›å»ºæ—¶é—´æˆ³
    
    // æ„é€ æ–¹æ³• - åªèƒ½é€šè¿‡å‘èµ·äººåˆ›å»º
    public GameMemento(String name, int level, int health, 
                      int experience, String location) {
        this.name = name;
        this.level = level;
        this.health = health;
        this.experience = experience;
        this.location = location;
        this.timestamp = System.currentTimeMillis();
    }
    
    // åªæä¾›getteræ–¹æ³•ï¼Œç¡®ä¿ä¸å¯å˜æ€§
    public String getName() { return name; }
    public int getLevel() { return level; }
    public int getHealth() { return health; }
    public int getExperience() { return experience; }
    public String getLocation() { return location; }
    public long getTimestamp() { return timestamp; }
    
    // è¾…åŠ©æ–¹æ³• - è·å–å¤‡å¿˜å½•æè¿°
    public String getDescription() {
        return String.format("ç­‰çº§%d %s åœ¨%s (è¡€é‡:%d)", 
                           level, name, location, health);
    }
}
```

**æ–¹å¼äºŒï¼šæ·±æ‹·è´å¤‡å¿˜å½•**
```java
// æ·±æ‹·è´å¤‡å¿˜å½• - é€‚ç”¨äºå¤æ‚å¯¹è±¡
public class ComplexGameMemento {
    private final Map<String, Object> stateData;
    
    public ComplexGameMemento(Map<String, Object> originalState) {
        // æ·±æ‹·è´çŠ¶æ€æ•°æ®ï¼Œé˜²æ­¢å¤–éƒ¨ä¿®æ”¹
        this.stateData = new HashMap<>();
        for (Map.Entry<String, Object> entry : originalState.entrySet()) {
            this.stateData.put(entry.getKey(), deepCopy(entry.getValue()));
        }
    }
    
    public Map<String, Object> getStateData() {
        // è¿”å›å‰¯æœ¬ï¼Œä¿æŠ¤å†…éƒ¨æ•°æ®
        return new HashMap<>(stateData);
    }
    
    private Object deepCopy(Object obj) {
        // å®ç°æ·±æ‹·è´é€»è¾‘ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        return obj; // å®é™…åº”è¯¥è¿›è¡Œæ·±æ‹·è´
    }
}
```

### 3.3 å¤‡å¿˜å½•ç±»è®¾è®¡è€ƒè™‘


**ğŸ¯ è®¾è®¡è€ƒè™‘è¦ç‚¹**ï¼š

```
æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… å¿…é¡»ä¿å­˜ï¼šæ ¸å¿ƒä¸šåŠ¡çŠ¶æ€      â”‚
â”‚ âŒ å¯ä»¥å¿½ç•¥ï¼šä¸´æ—¶è®¡ç®—ç»“æœ      â”‚
â”‚ âŒ å¯ä»¥å¿½ç•¥ï¼šUIæ˜¾ç¤ºçŠ¶æ€        â”‚
â”‚ âŒ å¯ä»¥å¿½ç•¥ï¼šç¼“å­˜æ•°æ®          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š
â”œâ”€ çŠ¶æ€å‹ç¼©ï¼šåªä¿å­˜å˜åŒ–çš„çŠ¶æ€
â”œâ”€ å¢é‡å¤‡å¿˜å½•ï¼šåŸºäºå·®å¼‚çš„å¤‡å¿˜å½•
â”œâ”€ å»¶è¿Ÿåºåˆ—åŒ–ï¼šéœ€è¦æ—¶æ‰åºåˆ—åŒ–
â””â”€ å†…å­˜ç®¡ç†ï¼šé™åˆ¶å¤‡å¿˜å½•æ•°é‡
```

---

## 4. ğŸ—‚ï¸ ç®¡ç†è€…ç±»è®¾è®¡è¯¦è§£


### 4.1 ç®¡ç†è€…ç±»çš„æ ¸å¿ƒèŒè´£


**ğŸ“‹ ä¸»è¦èŒè´£**ï¼š
- **å¤‡å¿˜å½•å­˜å‚¨**ï¼šä¿å­˜å¤šä¸ªå¤‡å¿˜å½•å¯¹è±¡
- **å¤‡å¿˜å½•æ£€ç´¢**ï¼šæ ¹æ®æ¡ä»¶æŸ¥æ‰¾ç‰¹å®šå¤‡å¿˜å½•
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šæ§åˆ¶å¤‡å¿˜å½•çš„åˆ›å»ºå’Œé”€æ¯

> ğŸ’¡ **é‡è¦ç†è§£**ï¼šç®¡ç†è€…æ°¸è¿œä¸èƒ½è®¿é—®å¤‡å¿˜å½•çš„å†…éƒ¨æ•°æ®ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª"ä¿é™©ç®±ç®¡ç†å‘˜"

### 4.2 ç®¡ç†è€…ç±»çš„åŸºæœ¬å®ç°


```java
// ç®¡ç†è€…ç±» - æ¸¸æˆå­˜æ¡£ç®¡ç†å™¨
public class GameSaveManager {
    private final List<GameMemento> saveSlots;    // å­˜æ¡£åˆ—è¡¨
    private final int maxSaveCount;               // æœ€å¤§å­˜æ¡£æ•°é‡
    private int currentIndex;                     // å½“å‰ä½ç½®ç´¢å¼•
    
    public GameSaveManager(int maxSaveCount) {
        this.maxSaveCount = maxSaveCount;
        this.saveSlots = new ArrayList<>();
        this.currentIndex = -1;
    }
    
    // ä¿å­˜å¤‡å¿˜å½•
    public void saveMemento(GameMemento memento) {
        // æ£€æŸ¥æ˜¯å¦è¶…å‡ºæœ€å¤§æ•°é‡
        if (saveSlots.size() >= maxSaveCount) {
            saveSlots.remove(0); // ç§»é™¤æœ€æ—§çš„å­˜æ¡£
        }
        
        saveSlots.add(memento);
        currentIndex = saveSlots.size() - 1;
        
        System.out.println("âœ… æ¸¸æˆå·²ä¿å­˜: " + memento.getDescription());
    }
    
    // è·å–æœ€æ–°çš„å¤‡å¿˜å½•
    public GameMemento getLatestMemento() {
        if (saveSlots.isEmpty()) {
            System.out.println("âŒ æ²¡æœ‰å¯ç”¨çš„å­˜æ¡£");
            return null;
        }
        return saveSlots.get(saveSlots.size() - 1);
    }
    
    // è·å–æŒ‡å®šä½ç½®çš„å¤‡å¿˜å½•
    public GameMemento getMementoAt(int index) {
        if (index < 0 || index >= saveSlots.size()) {
            System.out.println("âŒ å­˜æ¡£ä½ç½®æ— æ•ˆ: " + index);
            return null;
        }
        return saveSlots.get(index);
    }
    
    // æ’¤é”€æ“ä½œ - è¿”å›ä¸Šä¸€ä¸ªçŠ¶æ€
    public GameMemento undo() {
        if (currentIndex > 0) {
            currentIndex--;
            return saveSlots.get(currentIndex);
        }
        System.out.println("âŒ æ²¡æœ‰æ›´æ—©çš„å­˜æ¡£å¯ä»¥æ’¤é”€");
        return null;
    }
    
    // é‡åšæ“ä½œ - è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€
    public GameMemento redo() {
        if (currentIndex < saveSlots.size() - 1) {
            currentIndex++;
            return saveSlots.get(currentIndex);
        }
        System.out.println("âŒ æ²¡æœ‰æ›´æ–°çš„å­˜æ¡£å¯ä»¥é‡åš");
        return null;
    }
    
    // æ˜¾ç¤ºæ‰€æœ‰å­˜æ¡£ä¿¡æ¯
    public void listAllSaves() {
        System.out.println("ğŸ“‹ å­˜æ¡£åˆ—è¡¨:");
        for (int i = 0; i < saveSlots.size(); i++) {
            String indicator = (i == currentIndex) ? "ğŸ‘‰ " : "   ";
            System.out.println(indicator + (i + 1) + ". " + 
                             saveSlots.get(i).getDescription());
        }
    }
}
```

### 4.3 é«˜çº§ç®¡ç†è€…è®¾è®¡


**ğŸ”§ å¸¦æœ‰ç­–ç•¥çš„ç®¡ç†è€…**ï¼š
```java
// é«˜çº§ç®¡ç†è€… - æ”¯æŒä¸åŒå­˜å‚¨ç­–ç•¥
public class AdvancedMementoManager {
    private final Map<String, GameMemento> namedSaves;     // å‘½åå­˜æ¡£
    private final Queue<GameMemento> autoSaves;            // è‡ªåŠ¨å­˜æ¡£
    private final Stack<GameMemento> undoStack;            // æ’¤é”€æ ˆ
    
    public AdvancedMementoManager() {
        this.namedSaves = new HashMap<>();
        this.autoSaves = new LinkedList<>();
        this.undoStack = new Stack<>();
    }
    
    // å‘½åä¿å­˜
    public void saveWithName(String name, GameMemento memento) {
        namedSaves.put(name, memento);
        System.out.println("ğŸ’¾ å·²ä¿å­˜ä¸º: " + name);
    }
    
    // è‡ªåŠ¨ä¿å­˜
    public void autoSave(GameMemento memento) {
        autoSaves.offer(memento);
        undoStack.push(memento);
        
        // ä¿æŒè‡ªåŠ¨å­˜æ¡£æ•°é‡é™åˆ¶
        if (autoSaves.size() > 5) {
            autoSaves.poll();
        }
    }
    
    // æŒ‰åç§°åŠ è½½
    public GameMemento loadByName(String name) {
        return namedSaves.get(name);
    }
    
    // è·å–å¯ç”¨çš„å­˜æ¡£åç§°
    public Set<String> getAvailableSaveNames() {
        return namedSaves.keySet();
    }
}
```

---

## 5. ğŸ’¿ çŠ¶æ€ä¿å­˜æœºåˆ¶æ·±å…¥åˆ†æ


### 5.1 çŠ¶æ€ä¿å­˜çš„æ—¶æœºé€‰æ‹©


**â° ä¿å­˜æ—¶æœºç­–ç•¥**ï¼š

```
è‡ªåŠ¨ä¿å­˜æ—¶æœºï¼š
â”œâ”€ ğŸ• å®šæ—¶ä¿å­˜ï¼šæ¯éš”å›ºå®šæ—¶é—´è‡ªåŠ¨ä¿å­˜
â”œâ”€ ğŸ¯ å…³é”®èŠ‚ç‚¹ï¼šè¿›å…¥æ–°åœºæ™¯ã€å®Œæˆä»»åŠ¡æ—¶
â”œâ”€ âš ï¸ é£é™©æ“ä½œï¼šæ‰§è¡Œå±é™©æ“ä½œå‰
â””â”€ ğŸ“Š çŠ¶æ€å˜åŒ–ï¼šé‡è¦å±æ€§å‘ç”Ÿå˜åŒ–æ—¶

æ‰‹åŠ¨ä¿å­˜æ—¶æœºï¼š
â”œâ”€ ğŸ® ç”¨æˆ·è¯·æ±‚ï¼šç©å®¶ä¸»åŠ¨ä¿å­˜æ¸¸æˆ
â”œâ”€ ğŸ“ ç¼–è¾‘æ£€æŸ¥ç‚¹ï¼šæ–‡æ¡£ç¼–è¾‘çš„å…³é”®èŠ‚ç‚¹
â”œâ”€ ğŸ”„ äº‹åŠ¡è¾¹ç•Œï¼šæ•°æ®åº“äº‹åŠ¡æäº¤å‰
â””â”€ ğŸ¯ æµ‹è¯•èŠ‚ç‚¹ï¼šè½¯ä»¶æµ‹è¯•çš„æ£€æŸ¥ç‚¹
```

### 5.2 çŠ¶æ€ä¿å­˜çš„å®ç°ç»†èŠ‚


**ğŸ”„ å®Œæ•´çš„ä¿å­˜æµç¨‹**ï¼š
```
çŠ¶æ€ä¿å­˜æµç¨‹ï¼š
ç”¨æˆ·æ“ä½œ â†’ è§¦å‘ä¿å­˜ â†’ åˆ›å»ºå¤‡å¿˜å½• â†’ å­˜å‚¨ç®¡ç† â†’ ç¡®è®¤ä¿å­˜

è¯¦ç»†æ­¥éª¤ï¼š
æ­¥éª¤1ï¸âƒ£ æ£€æŸ¥ä¿å­˜æ¡ä»¶ï¼ˆæ˜¯å¦éœ€è¦ä¿å­˜ï¼‰
æ­¥éª¤2ï¸âƒ£ æ”¶é›†å½“å‰çŠ¶æ€ï¼ˆè·å–æ‰€æœ‰éœ€è¦ä¿å­˜çš„æ•°æ®ï¼‰
æ­¥éª¤3ï¸âƒ£ åˆ›å»ºå¤‡å¿˜å½•å¯¹è±¡ï¼ˆå°è£…çŠ¶æ€æ•°æ®ï¼‰
æ­¥éª¤4ï¸âƒ£ éªŒè¯æ•°æ®å®Œæ•´æ€§ï¼ˆç¡®ä¿æ•°æ®æ­£ç¡®ï¼‰
æ­¥éª¤5ï¸âƒ£ å­˜å‚¨åˆ°ç®¡ç†å™¨ï¼ˆæ·»åŠ åˆ°å­˜å‚¨å®¹å™¨ï¼‰
æ­¥éª¤6ï¸âƒ£ æ›´æ–°ç´¢å¼•ä¿¡æ¯ï¼ˆç»´æŠ¤å­˜æ¡£åˆ—è¡¨ï¼‰
æ­¥éª¤7ï¸âƒ£ è¿”å›ä¿å­˜ç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ä¿¡æ¯ï¼‰
```

**ğŸ’¾ çŠ¶æ€ä¿å­˜ç¤ºä¾‹**ï¼š
```java
// å®Œæ•´çš„çŠ¶æ€ä¿å­˜å®ç°
public class GameStateManager {
    private GameCharacter character;
    private GameSaveManager saveManager;
    
    // æ™ºèƒ½ä¿å­˜ - æ ¹æ®æƒ…å†µå†³å®šæ˜¯å¦ä¿å­˜
    public boolean smartSave(String reason) {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦ä¿å­˜
        if (!shouldSave()) {
            return false;
        }
        
        try {
            // åˆ›å»ºå¤‡å¿˜å½•
            GameMemento memento = character.createMemento();
            
            // æ·»åŠ ä¿å­˜åŸå› æ ‡è®°
            System.out.println("ğŸ’¾ ä¿å­˜åŸå› : " + reason);
            
            // å­˜å‚¨å¤‡å¿˜å½•
            saveManager.saveMemento(memento);
            
            return true;
        } catch (Exception e) {
            System.out.println("âŒ ä¿å­˜å¤±è´¥: " + e.getMessage());
            return false;
        }
    }
    
    private boolean shouldSave() {
        // ä¿å­˜æ¡ä»¶åˆ¤æ–­é€»è¾‘
        GameMemento latest = saveManager.getLatestMemento();
        if (latest == null) return true; // é¦–æ¬¡ä¿å­˜
        
        // æ£€æŸ¥çŠ¶æ€æ˜¯å¦æœ‰æ˜¾è‘—å˜åŒ–
        return hasSignificantChange(latest);
    }
    
    private boolean hasSignificantChange(GameMemento lastSave) {
        // æ¯”è¾ƒå½“å‰çŠ¶æ€ä¸ä¸Šæ¬¡ä¿å­˜çš„å·®å¼‚
        return character.getLevel() != lastSave.getLevel() ||
               Math.abs(character.getHealth() - lastSave.getHealth()) > 10;
    }
}
```

### 5.3 çŠ¶æ€ä¿å­˜çš„ä¼˜åŒ–ç­–ç•¥


**âš¡ æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

> ğŸ“Š **å¢é‡ä¿å­˜**ï¼šåªä¿å­˜å˜åŒ–çš„éƒ¨åˆ†ï¼Œå‡å°‘å­˜å‚¨ç©ºé—´

> ğŸ—œï¸ **æ•°æ®å‹ç¼©**ï¼šå¯¹å¤§å‹çŠ¶æ€æ•°æ®è¿›è¡Œå‹ç¼©å¤„ç†

> â±ï¸ **å¼‚æ­¥ä¿å­˜**ï¼šåœ¨åå°çº¿ç¨‹æ‰§è¡Œä¿å­˜æ“ä½œï¼Œä¸é˜»å¡ä¸»æµç¨‹

> ğŸ¯ **é€‰æ‹©æ€§ä¿å­˜**ï¼šæ ¹æ®é‡è¦æ€§åªä¿å­˜å…³é”®çŠ¶æ€

---

## 6. ğŸ”„ çŠ¶æ€æ¢å¤æœºåˆ¶æ·±å…¥åˆ†æ


### 6.1 çŠ¶æ€æ¢å¤çš„è§¦å‘æ¡ä»¶


**ğŸ¯ æ¢å¤è§¦å‘åœºæ™¯**ï¼š
```
ç”¨æˆ·ä¸»åŠ¨æ¢å¤ï¼š
â”œâ”€ ğŸ® åŠ è½½å­˜æ¡£ï¼šæ¸¸æˆä¸­é€‰æ‹©å­˜æ¡£åŠ è½½
â”œâ”€ â†©ï¸ æ’¤é”€æ“ä½œï¼šç¼–è¾‘å™¨ä¸­çš„Ctrl+Z
â”œâ”€ ğŸ”„ é‡åšæ“ä½œï¼šç¼–è¾‘å™¨ä¸­çš„Ctrl+Y
â””â”€ ğŸ  å›æ»šæ“ä½œï¼šæ•°æ®åº“äº‹åŠ¡å›æ»š

ç³»ç»Ÿè‡ªåŠ¨æ¢å¤ï¼š
â”œâ”€ ğŸ’¥ å¼‚å¸¸æ¢å¤ï¼šç¨‹åºå´©æºƒåè‡ªåŠ¨æ¢å¤
â”œâ”€ ğŸ”§ æ•…éšœåˆ‡æ¢ï¼šç³»ç»Ÿæ•…éšœæ—¶åˆ‡æ¢åˆ°å¤‡ä»½çŠ¶æ€
â”œâ”€ ğŸ§ª æµ‹è¯•æ¢å¤ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ä¸­çš„çŠ¶æ€é‡ç½®
â””â”€ â° å®šæ—¶æ¢å¤ï¼šæŒ‰è®¡åˆ’æ¢å¤åˆ°ç‰¹å®šçŠ¶æ€
```

### 6.2 çŠ¶æ€æ¢å¤çš„å®ç°æµç¨‹


**ğŸ”§ æ¢å¤æ“ä½œæµç¨‹**ï¼š
```java
// çŠ¶æ€æ¢å¤çš„å®Œæ•´å®ç°
public class GameStateRestorer {
    private GameCharacter character;
    private GameSaveManager saveManager;
    
    // æ¢å¤åˆ°æŒ‡å®šå­˜æ¡£
    public boolean restoreToSave(int saveIndex) {
        try {
            // æ­¥éª¤1ï¼šè·å–ç›®æ ‡å¤‡å¿˜å½•
            GameMemento targetMemento = saveManager.getMementoAt(saveIndex);
            if (targetMemento == null) {
                System.out.println("âŒ å­˜æ¡£ä¸å­˜åœ¨: " + saveIndex);
                return false;
            }
            
            // æ­¥éª¤2ï¼šå¤‡ä»½å½“å‰çŠ¶æ€ï¼ˆä»¥é˜²æ¢å¤å¤±è´¥ï¼‰
            GameMemento currentBackup = character.createMemento();
            
            // æ­¥éª¤3ï¼šæ‰§è¡ŒçŠ¶æ€æ¢å¤
            character.restoreFromMemento(targetMemento);
            
            // æ­¥éª¤4ï¼šéªŒè¯æ¢å¤ç»“æœ
            if (verifyRestoreSuccess(targetMemento)) {
                System.out.println("âœ… å·²æ¢å¤åˆ°å­˜æ¡£: " + 
                                 targetMemento.getDescription());
                return true;
            } else {
                // æ¢å¤å¤±è´¥ï¼Œå›æ»šåˆ°å¤‡ä»½çŠ¶æ€
                character.restoreFromMemento(currentBackup);
                System.out.println("âŒ æ¢å¤å¤±è´¥ï¼Œå·²å›æ»šåˆ°åŸçŠ¶æ€");
                return false;
            }
            
        } catch (Exception e) {
            System.out.println("âŒ æ¢å¤è¿‡ç¨‹å‘ç”Ÿå¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    // å¿«é€Ÿæ’¤é”€åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€
    public boolean quickUndo() {
        GameMemento previousState = saveManager.undo();
        if (previousState != null) {
            character.restoreFromMemento(previousState);
            System.out.println("â†©ï¸ å·²æ’¤é”€åˆ°: " + previousState.getDescription());
            return true;
        }
        return false;
    }
    
    // éªŒè¯æ¢å¤æ˜¯å¦æˆåŠŸ
    private boolean verifyRestoreSuccess(GameMemento expected) {
        return character.getLevel() == expected.getLevel() &&
               character.getHealth() == expected.getHealth() &&
               character.getName().equals(expected.getName());
    }
}
```

### 6.3 çŠ¶æ€æ¢å¤çš„å®‰å…¨æœºåˆ¶


**ğŸ” å®‰å…¨æ¢å¤ç­–ç•¥**ï¼š

```
æ¢å¤å‰æ£€æŸ¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… å¤‡å¿˜å½•å®Œæ•´æ€§ï¼šæ•°æ®æ˜¯å¦å®Œæ•´   â”‚
â”‚ âœ… ç‰ˆæœ¬å…¼å®¹æ€§ï¼šæ˜¯å¦æ”¯æŒè¯¥ç‰ˆæœ¬   â”‚
â”‚ âœ… æƒé™éªŒè¯ï¼šæ˜¯å¦æœ‰æ¢å¤æƒé™     â”‚
â”‚ âœ… çŠ¶æ€æœ‰æ•ˆæ€§ï¼šçŠ¶æ€æ˜¯å¦åˆæ³•     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¢å¤åéªŒè¯ï¼š
â”œâ”€ ğŸ” æ•°æ®ä¸€è‡´æ€§ï¼šæ¢å¤åæ•°æ®æ˜¯å¦æ­£ç¡®
â”œâ”€ ğŸ§ª åŠŸèƒ½æµ‹è¯•ï¼šæ ¸å¿ƒåŠŸèƒ½æ˜¯å¦æ­£å¸¸
â”œâ”€ ğŸ“Š çŠ¶æ€æ£€æŸ¥ï¼šå¯¹è±¡çŠ¶æ€æ˜¯å¦ç¨³å®š
â””â”€ ğŸ”„ å›æ»šå‡†å¤‡ï¼šå¤±è´¥æ—¶èƒ½å¦å®‰å…¨å›æ»š
```

**âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶**ï¼š
```java
// å¸¦æœ‰å®Œæ•´å¼‚å¸¸å¤„ç†çš„æ¢å¤æœºåˆ¶
public class SafeStateRestorer {
    
    public boolean safeRestore(GameMemento memento) {
        GameMemento backup = null;
        try {
            // åˆ›å»ºå®‰å…¨å¤‡ä»½
            backup = character.createMemento();
            
            // æ‰§è¡Œæ¢å¤æ“ä½œ
            character.restoreFromMemento(memento);
            
            // æ‰§è¡ŒéªŒè¯æµ‹è¯•
            if (!performSafetyChecks()) {
                throw new RestoreException("å®‰å…¨æ£€æŸ¥å¤±è´¥");
            }
            
            return true;
            
        } catch (Exception e) {
            // å¼‚å¸¸æ—¶è‡ªåŠ¨å›æ»š
            if (backup != null) {
                character.restoreFromMemento(backup);
                System.out.println("ğŸ”„ å·²è‡ªåŠ¨å›æ»šåˆ°å®‰å…¨çŠ¶æ€");
            }
            
            System.out.println("âŒ æ¢å¤å¤±è´¥: " + e.getMessage());
            return false;
        }
    }
    
    private boolean performSafetyChecks() {
        // æ‰§è¡Œå„ç§å®‰å…¨æ£€æŸ¥
        return character.isValid() && character.isConsistent();
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¸‰å¤§è§’è‰²ï¼šå‘èµ·äººã€å¤‡å¿˜å½•ã€ç®¡ç†è€…ï¼Œå„å¸å…¶èŒ
ğŸ”¸ å°è£…åŸåˆ™ï¼šå¤‡å¿˜å½•å†…éƒ¨çŠ¶æ€åªæœ‰å‘èµ·äººèƒ½è®¿é—®
ğŸ”¸ ä¸å¯å˜æ€§ï¼šå¤‡å¿˜å½•åˆ›å»ºåä¸èƒ½ä¿®æ”¹å†…éƒ¨æ•°æ®
ğŸ”¸ ç®¡ç†ç­–ç•¥ï¼šç®¡ç†è€…è´Ÿè´£å­˜å‚¨ä½†ä¸èƒ½è®¿é—®å¤‡å¿˜å½•å†…å®¹
ğŸ”¸ æ—¶æœºé€‰æ‹©ï¼šåˆç†é€‰æ‹©çŠ¶æ€ä¿å­˜å’Œæ¢å¤çš„æ—¶æœº
ğŸ”¸ å®‰å…¨æœºåˆ¶ï¼šæ¢å¤æ“ä½œè¦æœ‰å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œå›æ»šæœºåˆ¶
```

### 7.2 è®¾è®¡è¦ç‚¹å½’çº³


**ğŸ¯ å‘èµ·äººç±»è®¾è®¡è¦ç‚¹**ï¼š
```
èŒè´£æ˜ç¡®ï¼š
â”œâ”€ âœ… ç®¡ç†è‡ªèº«çŠ¶æ€
â”œâ”€ âœ… åˆ›å»ºå¤‡å¿˜å½•
â”œâ”€ âœ… ä»å¤‡å¿˜å½•æ¢å¤
â””â”€ âŒ ä¸ç®¡ç†å¤‡å¿˜å½•å­˜å‚¨

æ¥å£è®¾è®¡ï¼š
â”œâ”€ createMemento()ï¼šåˆ›å»ºå½“å‰çŠ¶æ€å¿«ç…§
â”œâ”€ restoreFromMemento()ï¼šä»å¿«ç…§æ¢å¤çŠ¶æ€
â””â”€ ä¸šåŠ¡æ–¹æ³•ï¼šæ­£å¸¸çš„ä¸šåŠ¡åŠŸèƒ½æ–¹æ³•
```

**ğŸ’¾ å¤‡å¿˜å½•ç±»è®¾è®¡è¦ç‚¹**ï¼š
```
æ•°æ®ç‰¹æ€§ï¼š
â”œâ”€ ğŸ”’ ä¸å¯å˜ï¼šåˆ›å»ºåä¸èƒ½ä¿®æ”¹
â”œâ”€ ğŸ“¦ å®Œæ•´æ€§ï¼šåŒ…å«å®Œæ•´çš„çŠ¶æ€ä¿¡æ¯
â”œâ”€ ğŸ• æ—¶é—´æˆ³ï¼šè®°å½•åˆ›å»ºæ—¶é—´
â””â”€ ğŸ“ æè¿°ä¿¡æ¯ï¼šä¾¿äºè¯†åˆ«çš„æè¿°

è®¿é—®æ§åˆ¶ï¼š
â”œâ”€ âœ… å‘èµ·äººå¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®
â”œâ”€ âŒ ç®¡ç†è€…åªèƒ½å­˜å‚¨ï¼Œä¸èƒ½è®¿é—®å†…å®¹
â””â”€ âŒ å…¶ä»–å¯¹è±¡ä¸èƒ½ç›´æ¥è®¿é—®
```

**ğŸ—‚ï¸ ç®¡ç†è€…ç±»è®¾è®¡è¦ç‚¹**ï¼š
```
å­˜å‚¨ç­–ç•¥ï¼š
â”œâ”€ ğŸ“š åˆ—è¡¨å­˜å‚¨ï¼šç®€å•çš„é¡ºåºå­˜å‚¨
â”œâ”€ ğŸ”„ æ ˆç»“æ„ï¼šæ”¯æŒæ’¤é”€/é‡åšæ“ä½œ
â”œâ”€ ğŸ—ƒï¸ æ˜ å°„å­˜å‚¨ï¼šæ”¯æŒå‘½åå­˜æ¡£
â””â”€ â° é˜Ÿåˆ—ç»“æ„ï¼šæ”¯æŒè‡ªåŠ¨å­˜æ¡£è½®æ¢

ç®¡ç†åŠŸèƒ½ï¼š
â”œâ”€ ğŸ“¥ å­˜å‚¨å¤‡å¿˜å½•
â”œâ”€ ğŸ“¤ æ£€ç´¢å¤‡å¿˜å½•
â”œâ”€ ğŸ”¢ æ•°é‡é™åˆ¶
â””â”€ ğŸ—‘ï¸ æ¸…ç†è¿‡æœŸå¤‡å¿˜å½•
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é€‚ç”¨åœºæ™¯**ï¼š
- **æ’¤é”€é‡åšåŠŸèƒ½**ï¼šæ–‡æœ¬ç¼–è¾‘å™¨ã€å›¾å½¢è®¾è®¡è½¯ä»¶
- **æ¸¸æˆå­˜æ¡£ç³»ç»Ÿ**ï¼šè§’è‰²çŠ¶æ€ã€æ¸¸æˆè¿›åº¦ä¿å­˜
- **äº‹åŠ¡å¤„ç†**ï¼šæ•°æ®åº“æ“ä½œçš„å›æ»šæœºåˆ¶
- **é…ç½®ç®¡ç†**ï¼šç³»ç»Ÿé…ç½®çš„ç‰ˆæœ¬ç®¡ç†
- **å·¥ä½œæµç¨‹**ï¼šä¸šåŠ¡æµç¨‹çš„çŠ¶æ€æ£€æŸ¥ç‚¹

**âŒ ä¸é€‚ç”¨åœºæ™¯**ï¼š
- çŠ¶æ€æ•°æ®é‡æå¤§ï¼ˆå†…å­˜å¼€é”€è¿‡å¤§ï¼‰
- çŠ¶æ€å˜åŒ–é¢‘ç¹ï¼ˆæ€§èƒ½å¼€é”€è¿‡å¤§ï¼‰
- ç®€å•çš„æ•°æ®ç±»å‹ï¼ˆä½¿ç”¨ç®€å•æ‹·è´å³å¯ï¼‰
- ä¸éœ€è¦å†å²è®°å½•çš„åœºæ™¯

### 7.4 å¸¸è§å®ç°é™·é˜±


**âš ï¸ éœ€è¦é¿å…çš„é—®é¢˜**ï¼š

> ğŸš« **ç ´åå°è£…**ï¼šç®¡ç†è€…ç›´æ¥è®¿é—®å¤‡å¿˜å½•å†…éƒ¨æ•°æ®

> ğŸš« **å†…å­˜æ³„æ¼**ï¼šæ— é™åˆ¶åœ°å­˜å‚¨å¤‡å¿˜å½•å¯¹è±¡

> ğŸš« **çŠ¶æ€ä¸ä¸€è‡´**ï¼šæ¢å¤åå¯¹è±¡çŠ¶æ€ä¸å¤‡å¿˜å½•ä¸ç¬¦

> ğŸš« **æ·±æµ…æ‹·è´é—®é¢˜**ï¼šå¤æ‚å¯¹è±¡çš„çŠ¶æ€æ‹·è´ä¸å®Œæ•´

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**ï¼š
```
æ€§èƒ½ä¼˜åŒ–ï¼š
â”œâ”€ ğŸ¯ å¢é‡å¤‡å¿˜å½•ï¼šåªä¿å­˜å˜åŒ–çš„éƒ¨åˆ†
â”œâ”€ ğŸ—œï¸ æ•°æ®å‹ç¼©ï¼šå¯¹å¤§æ•°æ®è¿›è¡Œå‹ç¼©
â”œâ”€ â±ï¸ å»¶è¿Ÿåˆ›å»ºï¼šéœ€è¦æ—¶æ‰åˆ›å»ºå¤‡å¿˜å½•
â””â”€ ğŸ”„ å¯¹è±¡æ± ï¼šé‡ç”¨å¤‡å¿˜å½•å¯¹è±¡

å®‰å…¨ä¿éšœï¼š
â”œâ”€ ğŸ” è®¿é—®æ§åˆ¶ï¼šä¸¥æ ¼æ§åˆ¶å¤‡å¿˜å½•è®¿é—®æƒé™
â”œâ”€ ğŸ§ª å®Œæ•´æ€§æ£€æŸ¥ï¼šéªŒè¯æ¢å¤åçš„çŠ¶æ€æ­£ç¡®æ€§
â”œâ”€ ğŸ”„ å¼‚å¸¸å›æ»šï¼šæ¢å¤å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
â””â”€ ğŸ“ æ“ä½œæ—¥å¿—ï¼šè®°å½•æ‰€æœ‰çŠ¶æ€å˜æ›´æ“ä½œ
```

**ğŸ§  è®°å¿†å£è¯€**ï¼š
- å¤‡å¿˜å½•æ¨¡å¼ä¸‰è§’è‰²ï¼Œå‘èµ·äººç®¡çŠ¶æ€å˜
- å¤‡å¿˜å½•å­˜çŠ¶æ€å¿«ç…§ï¼Œç®¡ç†è€…åªç®¡å­˜å–
- ä¿å­˜æ—¶æœºè¦é€‰å¥½ï¼Œæ¢å¤å®‰å…¨æœ€é‡è¦
- å°è£…åŸåˆ™éœ€éµå®ˆï¼Œæ€§èƒ½ä¼˜åŒ–ä¸èƒ½å¿˜