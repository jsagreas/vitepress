---
title: 6ã€å¤‡å¿˜å½•æ¨¡å¼ä»£ç å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å¤‡å¿˜å½•æ¨¡å¼åŸºç¡€å›é¡¾](#1-å¤‡å¿˜å½•æ¨¡å¼åŸºç¡€å›é¡¾)
2. [å®Œæ•´ä»£ç ç¤ºä¾‹å®ç°](#2-å®Œæ•´ä»£ç ç¤ºä¾‹å®ç°)
3. [æ’¤é”€åŠŸèƒ½æ·±åº¦å®ç°](#3-æ’¤é”€åŠŸèƒ½æ·±åº¦å®ç°)
4. [å¤šçº§å¤‡å¿˜å½•è¿›é˜¶åº”ç”¨](#4-å¤šçº§å¤‡å¿˜å½•è¿›é˜¶åº”ç”¨)
5. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#5-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
6. [æ–‡æœ¬ç¼–è¾‘å™¨å®æˆ˜åº”ç”¨](#6-æ–‡æœ¬ç¼–è¾‘å™¨å®æˆ˜åº”ç”¨)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¤‡å¿˜å½•æ¨¡å¼åŸºç¡€å›é¡¾


### 1.1 ä»€ä¹ˆæ˜¯å¤‡å¿˜å½•æ¨¡å¼


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä½ åœ¨å†™ä½œä¸šæ—¶ç”¨é“…ç¬”ï¼Œå†™é”™äº†å¯ä»¥ç”¨æ©¡çš®æ“¦æ‰ï¼Œä½†æœ‰æ—¶ä½ æƒ³å›åˆ°ä¹‹å‰çš„æŸä¸ªç‰ˆæœ¬ã€‚èªæ˜çš„åšæ³•æ˜¯æ¯å†™ä¸€æ®µå°±ç”¨å¤å°æœºå¤å°ä¸€ä»½å­˜èµ·æ¥ï¼Œéœ€è¦æ—¶æ‹¿å‡ºæ¥æ¢å¤ã€‚å¤‡å¿˜å½•æ¨¡å¼å°±æ˜¯è½¯ä»¶ä¸­çš„"å¤å°æœº"ã€‚

**ğŸ“ æ ¸å¿ƒå®šä¹‰**
```
å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰ï¼š
åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œ
å¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åæ¢å¤åˆ°è¿™ä¸ªçŠ¶æ€ã€‚
```

**ğŸ” æ¨¡å¼è¦è§£å†³çš„é—®é¢˜**
- **çŠ¶æ€æ¢å¤**ï¼šç¨‹åºå‡ºé”™æ—¶èƒ½å›åˆ°ä¹‹å‰çš„æ­£ç¡®çŠ¶æ€
- **æ’¤é”€æ“ä½œ**ï¼šç”¨æˆ·æ“ä½œå¤±è¯¯æ—¶èƒ½å¤Ÿæ’¤é”€
- **ç‰ˆæœ¬ç®¡ç†**ï¼šä¿å­˜å¯¹è±¡åœ¨ä¸åŒæ—¶é—´ç‚¹çš„çŠ¶æ€
- **å°è£…ä¿æŠ¤**ï¼šä¸æš´éœ²å¯¹è±¡å†…éƒ¨å®ç°ç»†èŠ‚

### 1.2 ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²


**ğŸ­ è§’è‰²åˆ†å·¥**
```
å‘èµ·äººï¼ˆOriginatorï¼‰     â†â†’     å¤‡å¿˜å½•ï¼ˆMementoï¼‰
        â†“                           â†‘
    ç®¡ç†è€…ï¼ˆCaretakerï¼‰  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å°±åƒï¼š
ä½œè€…ï¼ˆå‘èµ·äººï¼‰ â†â†’ è‰ç¨¿ï¼ˆå¤‡å¿˜å½•ï¼‰
        â†“              â†‘
    ç¼–è¾‘å™¨ï¼ˆç®¡ç†è€…ï¼‰ â†â”€â”€â”˜
```

| è§’è‰² | **èŒè´£** | **ç”Ÿæ´»ç±»æ¯”** |
|------|---------|-------------|
| ğŸ¨ **å‘èµ·äºº** | `åˆ›å»ºå’Œæ¢å¤è‡ªå·±çš„çŠ¶æ€` | `å†™ä½œçš„ä½œè€…` |
| ğŸ“¦ **å¤‡å¿˜å½•** | `å­˜å‚¨å‘èµ·äººçš„çŠ¶æ€å¿«ç…§` | `ä¿å­˜çš„è‰ç¨¿` |
| ğŸ—‚ï¸ **ç®¡ç†è€…** | `ç®¡ç†å¤‡å¿˜å½•çš„å­˜å‚¨å’Œè·å–` | `æ–‡ä»¶ç®¡ç†å™¨` |

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦å¤‡å¿˜å½•æ¨¡å¼


**âŒ æ²¡æœ‰å¤‡å¿˜å½•æ¨¡å¼çš„é—®é¢˜**
```java
// ä¸å¥½çš„åšæ³•ï¼šç›´æ¥è®¿é—®å†…éƒ¨çŠ¶æ€
class TextEditor {
    public String content;  // æš´éœ²äº†å†…éƒ¨çŠ¶æ€
    public int cursorPosition;  // å¤–éƒ¨å¯ä»¥éšæ„ä¿®æ”¹
}

// å¤–éƒ¨ä»£ç 
TextEditor editor = new TextEditor();
String backup = editor.content;  // ç›´æ¥è®¿é—®ï¼Œç ´åå°è£…
```

**âœ… ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼çš„å¥½å¤„**
- **å°è£…ä¿æŠ¤**ï¼šå¯¹è±¡å†…éƒ¨çŠ¶æ€ä¸è¢«å¤–éƒ¨ç›´æ¥è®¿é—®
- **çŠ¶æ€å®‰å…¨**ï¼šå¤‡å¿˜å½•å¯¹è±¡æ˜¯ä¸å¯å˜çš„
- **æ“ä½œç®€å•**ï¼šæ’¤é”€/æ¢å¤æ“ä½œå¯¹ç”¨æˆ·é€æ˜
- **çµæ´»æ‰©å±•**ï¼šå¯ä»¥ä¿å­˜å¤šä¸ªå†å²çŠ¶æ€

---

## 2. ğŸ’» å®Œæ•´ä»£ç ç¤ºä¾‹å®ç°


### 2.1 åŸºç¡€ç‰ˆæœ¬ï¼šæ–‡æ¡£ç¼–è¾‘å™¨


**ğŸ“ å¤‡å¿˜å½•ç±»ï¼šä¿å­˜æ–‡æ¡£çŠ¶æ€**
```java
/**
 * å¤‡å¿˜å½•ç±» - ä¿å­˜æ–‡æ¡£çš„å®Œæ•´çŠ¶æ€
 * ç‰¹ç‚¹ï¼šä¸å¯å˜å¯¹è±¡ï¼Œä¿è¯çŠ¶æ€å®‰å…¨
 */
public class DocumentMemento {
    private final String content;      // æ–‡æ¡£å†…å®¹
    private final int cursorPosition;  // å…‰æ ‡ä½ç½®
    private final long timestamp;      // ä¿å­˜æ—¶é—´
    
    public DocumentMemento(String content, int cursorPosition) {
        this.content = content;
        this.cursorPosition = cursorPosition;
        this.timestamp = System.currentTimeMillis();
    }
    
    // åªæä¾›getteræ–¹æ³•ï¼Œä¿è¯ä¸å¯å˜æ€§
    public String getContent() { return content; }
    public int getCursorPosition() { return cursorPosition; }
    public long getTimestamp() { return timestamp; }
}
```

**ğŸ¨ å‘èµ·äººç±»ï¼šæ–‡æ¡£å¯¹è±¡**
```java
/**
 * å‘èµ·äººç±» - æ–‡æ¡£ç¼–è¾‘å™¨æ ¸å¿ƒç±»
 * è´Ÿè´£åˆ›å»ºå¤‡å¿˜å½•å’Œä»å¤‡å¿˜å½•æ¢å¤çŠ¶æ€
 */
public class Document {
    private String content;
    private int cursorPosition;
    
    public Document() {
        this.content = "";
        this.cursorPosition = 0;
    }
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šç¼–è¾‘æ–‡æ¡£
    public void write(String text) {
        String beforeCursor = content.substring(0, cursorPosition);
        String afterCursor = content.substring(cursorPosition);
        content = beforeCursor + text + afterCursor;
        cursorPosition += text.length();
    }
    
    // åˆ›å»ºå¤‡å¿˜å½•ï¼šä¿å­˜å½“å‰çŠ¶æ€
    public DocumentMemento createMemento() {
        return new DocumentMemento(content, cursorPosition);
    }
    
    // ä»å¤‡å¿˜å½•æ¢å¤çŠ¶æ€
    public void restoreFromMemento(DocumentMemento memento) {
        this.content = memento.getContent();
        this.cursorPosition = memento.getCursorPosition();
    }
    
    // è¾…åŠ©æ–¹æ³•
    public void setCursorPosition(int position) {
        this.cursorPosition = Math.max(0, Math.min(position, content.length()));
    }
    
    @Override
    public String toString() {
        return String.format("å†…å®¹: '%s', å…‰æ ‡ä½ç½®: %d", content, cursorPosition);
    }
}
```

**ğŸ—‚ï¸ ç®¡ç†è€…ç±»ï¼šå¤‡å¿˜å½•ç®¡ç†å™¨**
```java
/**
 * ç®¡ç†è€…ç±» - è´Ÿè´£å¤‡å¿˜å½•çš„å­˜å‚¨å’Œç®¡ç†
 * æä¾›æ’¤é”€/é‡åšåŠŸèƒ½
 */
public class DocumentHistory {
    private Stack<DocumentMemento> undoStack;  // æ’¤é”€æ ˆ
    private Stack<DocumentMemento> redoStack;  // é‡åšæ ˆ
    private int maxHistorySize;                // æœ€å¤§å†å²è®°å½•æ•°
    
    public DocumentHistory(int maxHistorySize) {
        this.undoStack = new Stack<>();
        this.redoStack = new Stack<>();
        this.maxHistorySize = maxHistorySize;
    }
    
    // ä¿å­˜çŠ¶æ€åˆ°å†å²è®°å½•
    public void saveState(DocumentMemento memento) {
        // æ–°æ“ä½œä¼šæ¸…ç©ºé‡åšæ ˆ
        redoStack.clear();
        
        // é™åˆ¶å†å²è®°å½•å¤§å°
        if (undoStack.size() >= maxHistorySize) {
            undoStack.remove(0);  // ç§»é™¤æœ€æ—§çš„è®°å½•
        }
        
        undoStack.push(memento);
    }
    
    // æ’¤é”€æ“ä½œ
    public DocumentMemento undo() {
        if (undoStack.isEmpty()) {
            return null;  // æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ
        }
        
        DocumentMemento memento = undoStack.pop();
        redoStack.push(memento);
        return memento;
    }
    
    // é‡åšæ“ä½œ
    public DocumentMemento redo() {
        if (redoStack.isEmpty()) {
            return null;  // æ²¡æœ‰å¯é‡åšçš„æ“ä½œ
        }
        
        DocumentMemento memento = redoStack.pop();
        undoStack.push(memento);
        return memento;
    }
    
    // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ’¤é”€/é‡åš
    public boolean canUndo() { return !undoStack.isEmpty(); }
    public boolean canRedo() { return !redoStack.isEmpty(); }
    
    // è·å–å†å²è®°å½•ä¿¡æ¯
    public int getHistorySize() { return undoStack.size(); }
}
```

### 2.2 ä½¿ç”¨ç¤ºä¾‹ï¼šå®Œæ•´çš„ç¼–è¾‘æµç¨‹


```java
/**
 * å¤‡å¿˜å½•æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹
 */
public class MementoPatternDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæ–‡æ¡£å’Œå†å²ç®¡ç†å™¨
        Document document = new Document();
        DocumentHistory history = new DocumentHistory(10);
        
        System.out.println("=== æ–‡æ¡£ç¼–è¾‘æ¼”ç¤º ===");
        
        // ç¼–è¾‘æ“ä½œ1ï¼šå†™å…¥ç¬¬ä¸€æ®µæ–‡å­—
        System.out.println("\n1. å†™å…¥ï¼š'Hello'");
        document.write("Hello");
        history.saveState(document.createMemento());
        System.out.println("å½“å‰çŠ¶æ€ï¼š" + document);
        
        // ç¼–è¾‘æ“ä½œ2ï¼šç»§ç»­å†™å…¥
        System.out.println("\n2. å†™å…¥ï¼š' World'");
        document.write(" World");
        history.saveState(document.createMemento());
        System.out.println("å½“å‰çŠ¶æ€ï¼š" + document);
        
        // ç¼–è¾‘æ“ä½œ3ï¼šå†™å…¥æ›´å¤šå†…å®¹
        System.out.println("\n3. å†™å…¥ï¼š'!'");
        document.write("!");
        history.saveState(document.createMemento());
        System.out.println("å½“å‰çŠ¶æ€ï¼š" + document);
        
        // æ’¤é”€æ“ä½œæ¼”ç¤º
        System.out.println("\n=== æ’¤é”€æ“ä½œæ¼”ç¤º ===");
        
        if (history.canUndo()) {
            System.out.println("\næ‰§è¡Œæ’¤é”€...");
            DocumentMemento memento = history.undo();
            if (memento != null) {
                document.restoreFromMemento(memento);
                System.out.println("æ’¤é”€åçŠ¶æ€ï¼š" + document);
            }
        }
        
        // é‡åšæ“ä½œæ¼”ç¤º
        System.out.println("\n=== é‡åšæ“ä½œæ¼”ç¤º ===");
        
        if (history.canRedo()) {
            System.out.println("\næ‰§è¡Œé‡åš...");
            DocumentMemento memento = history.redo();
            if (memento != null) {
                document.restoreFromMemento(memento);
                System.out.println("é‡åšåçŠ¶æ€ï¼š" + document);
            }
        }
        
        // æ˜¾ç¤ºå†å²è®°å½•ç»Ÿè®¡
        System.out.println("\n=== å†å²è®°å½•ç»Ÿè®¡ ===");
        System.out.println("å¯æ’¤é”€æ“ä½œæ•°ï¼š" + (history.canUndo() ? "æœ‰" : "æ— "));
        System.out.println("å¯é‡åšæ“ä½œæ•°ï¼š" + (history.canRedo() ? "æœ‰" : "æ— "));
        System.out.println("å†å²è®°å½•æ€»æ•°ï¼š" + history.getHistorySize());
    }
}
```

**ğŸ¯ è¿è¡Œç»“æœ**
```
=== æ–‡æ¡£ç¼–è¾‘æ¼”ç¤º ===

1. å†™å…¥ï¼š'Hello'
å½“å‰çŠ¶æ€ï¼šå†…å®¹: 'Hello', å…‰æ ‡ä½ç½®: 5

2. å†™å…¥ï¼š' World'
å½“å‰çŠ¶æ€ï¼šå†…å®¹: 'Hello World', å…‰æ ‡ä½ç½®: 11

3. å†™å…¥ï¼š'!'
å½“å‰çŠ¶æ€ï¼šå†…å®¹: 'Hello World!', å…‰æ ‡ä½ç½®: 12

=== æ’¤é”€æ“ä½œæ¼”ç¤º ===

æ‰§è¡Œæ’¤é”€...
æ’¤é”€åçŠ¶æ€ï¼šå†…å®¹: 'Hello World', å…‰æ ‡ä½ç½®: 11

=== é‡åšæ“ä½œæ¼”ç¤º ===

æ‰§è¡Œé‡åš...
é‡åšåçŠ¶æ€ï¼šå†…å®¹: 'Hello World!', å…‰æ ‡ä½ç½®: 12

=== å†å²è®°å½•ç»Ÿè®¡ ===
å¯æ’¤é”€æ“ä½œæ•°ï¼šæœ‰
å¯é‡åšæ“ä½œæ•°ï¼šæ— 
å†å²è®°å½•æ€»æ•°ï¼š3
```

---

## 3. â†©ï¸ æ’¤é”€åŠŸèƒ½æ·±åº¦å®ç°


### 3.1 å‘½ä»¤æ¨¡å¼ç»“åˆå¤‡å¿˜å½•æ¨¡å¼


**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> å•çº¯çš„å¤‡å¿˜å½•æ¨¡å¼åªèƒ½ä¿å­˜çŠ¶æ€ï¼Œä½†è¦å®ç°å®Œæ•´çš„æ’¤é”€åŠŸèƒ½ï¼Œæœ€å¥½ç»“åˆå‘½ä»¤æ¨¡å¼ã€‚æ¯ä¸ªå‘½ä»¤æ‰§è¡Œå‰ä¿å­˜çŠ¶æ€ï¼Œæ’¤é”€æ—¶æ¢å¤åˆ°æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚

**ğŸ”§ å‘½ä»¤æ¥å£å®šä¹‰**
```java
/**
 * å¯æ’¤é”€çš„å‘½ä»¤æ¥å£
 */
public interface UndoableCommand {
    void execute();     // æ‰§è¡Œå‘½ä»¤
    void undo();        // æ’¤é”€å‘½ä»¤
    String getDescription();  // å‘½ä»¤æè¿°
}
```

**ğŸ“ å…·ä½“å‘½ä»¤å®ç°ï¼šæ’å…¥æ–‡æœ¬å‘½ä»¤**
```java
/**
 * æ’å…¥æ–‡æœ¬å‘½ä»¤ - ç»“åˆå¤‡å¿˜å½•æ¨¡å¼å®ç°æ’¤é”€
 */
public class InsertTextCommand implements UndoableCommand {
    private Document document;
    private String textToInsert;
    private DocumentMemento beforeState;  // æ‰§è¡Œå‰çš„çŠ¶æ€
    
    public InsertTextCommand(Document document, String text) {
        this.document = document;
        this.textToInsert = text;
    }
    
    @Override
    public void execute() {
        // æ‰§è¡Œå‰ä¿å­˜çŠ¶æ€
        beforeState = document.createMemento();
        // æ‰§è¡Œæ’å…¥æ“ä½œ
        document.write(textToInsert);
    }
    
    @Override
    public void undo() {
        if (beforeState != null) {
            document.restoreFromMemento(beforeState);
        }
    }
    
    @Override
    public String getDescription() {
        return "æ’å…¥æ–‡æœ¬: '" + textToInsert + "'";
    }
}
```

**ğŸ—‚ï¸ å¢å¼ºç‰ˆå‘½ä»¤ç®¡ç†å™¨**
```java
/**
 * å‘½ä»¤å†å²ç®¡ç†å™¨ - æ”¯æŒå‘½ä»¤çº§åˆ«çš„æ’¤é”€é‡åš
 */
public class CommandHistory {
    private Stack<UndoableCommand> undoStack;
    private Stack<UndoableCommand> redoStack;
    private int maxCommandHistory;
    
    public CommandHistory(int maxHistory) {
        this.undoStack = new Stack<>();
        this.redoStack = new Stack<>();
        this.maxCommandHistory = maxHistory;
    }
    
    // æ‰§è¡Œå¹¶è®°å½•å‘½ä»¤
    public void executeCommand(UndoableCommand command) {
        // æ‰§è¡Œå‘½ä»¤
        command.execute();
        
        // æ¸…ç©ºé‡åšæ ˆ
        redoStack.clear();
        
        // ä¿å­˜åˆ°æ’¤é”€æ ˆ
        if (undoStack.size() >= maxCommandHistory) {
            undoStack.remove(0);
        }
        undoStack.push(command);
    }
    
    // æ’¤é”€æœ€åä¸€ä¸ªå‘½ä»¤
    public boolean undo() {
        if (undoStack.isEmpty()) {
            return false;
        }
        
        UndoableCommand command = undoStack.pop();
        command.undo();
        redoStack.push(command);
        
        System.out.println("æ’¤é”€æ“ä½œ: " + command.getDescription());
        return true;
    }
    
    // é‡åšæœ€åä¸€ä¸ªæ’¤é”€çš„å‘½ä»¤
    public boolean redo() {
        if (redoStack.isEmpty()) {
            return false;
        }
        
        UndoableCommand command = redoStack.pop();
        command.execute();
        undoStack.push(command);
        
        System.out.println("é‡åšæ“ä½œ: " + command.getDescription());
        return true;
    }
    
    // è·å–å¯æ’¤é”€çš„å‘½ä»¤åˆ—è¡¨
    public List<String> getUndoableCommands() {
        return undoStack.stream()
                       .map(UndoableCommand::getDescription)
                       .collect(Collectors.toList());
    }
}
```

### 3.2 é«˜çº§æ’¤é”€åŠŸèƒ½ç¤ºä¾‹


```java
/**
 * é«˜çº§æ’¤é”€åŠŸèƒ½æ¼”ç¤º
 */
public class AdvancedUndoDemo {
    public static void main(String[] args) {
        Document document = new Document();
        CommandHistory commandHistory = new CommandHistory(20);
        
        System.out.println("=== é«˜çº§æ’¤é”€åŠŸèƒ½æ¼”ç¤º ===");
        System.out.println("åˆå§‹çŠ¶æ€: " + document);
        
        // æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤
        UndoableCommand cmd1 = new InsertTextCommand(document, "è®¾è®¡æ¨¡å¼");
        UndoableCommand cmd2 = new InsertTextCommand(document, "å¾ˆé‡è¦");
        UndoableCommand cmd3 = new InsertTextCommand(document, "!");
        
        System.out.println("\næ‰§è¡Œå‘½ä»¤åºåˆ—...");
        commandHistory.executeCommand(cmd1);
        System.out.println("æ‰§è¡Œå: " + document);
        
        commandHistory.executeCommand(cmd2);
        System.out.println("æ‰§è¡Œå: " + document);
        
        commandHistory.executeCommand(cmd3);
        System.out.println("æ‰§è¡Œå: " + document);
        
        // æ˜¾ç¤ºå¯æ’¤é”€çš„å‘½ä»¤
        System.out.println("\nå¯æ’¤é”€çš„æ“ä½œ:");
        List<String> undoableCommands = commandHistory.getUndoableCommands();
        for (int i = undoableCommands.size() - 1; i >= 0; i--) {
            System.out.println("  " + (undoableCommands.size() - i) + ". " + undoableCommands.get(i));
        }
        
        // æ‰§è¡Œæ’¤é”€æ“ä½œ
        System.out.println("\n=== æ’¤é”€æ“ä½œ ===");
        commandHistory.undo();
        System.out.println("æ’¤é”€åçŠ¶æ€: " + document);
        
        commandHistory.undo();
        System.out.println("æ’¤é”€åçŠ¶æ€: " + document);
        
        // æ‰§è¡Œé‡åšæ“ä½œ
        System.out.println("\n=== é‡åšæ“ä½œ ===");
        commandHistory.redo();
        System.out.println("é‡åšåçŠ¶æ€: " + document);
    }
}
```

---

## 4. ğŸ“š å¤šçº§å¤‡å¿˜å½•è¿›é˜¶åº”ç”¨


### 4.1 ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå®ç°


**ğŸŒŸ å¤šçº§å¤‡å¿˜å½•æ¦‚å¿µ**
```
ç‰ˆæœ¬æ§åˆ¶å°±åƒæ˜¯å¼ºåŒ–ç‰ˆçš„å¤‡å¿˜å½•æ¨¡å¼ï¼š

æ—¶é—´çº¿:  v1.0 â”€â”€â†’ v1.1 â”€â”€â†’ v1.2 â”€â”€â†’ v2.0
         â”‚       â”‚       â”‚       â”‚
å¤‡å¿˜å½•:  M1      M2      M3      M4

ç‰¹ç‚¹:
â€¢ æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰å®Œæ•´çš„çŠ¶æ€å¿«ç…§
â€¢ å¯ä»¥è·³è½¬åˆ°ä»»æ„å†å²ç‰ˆæœ¬
â€¢ æ”¯æŒåˆ†æ”¯å’Œåˆå¹¶ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
```

**ğŸ“¦ ç‰ˆæœ¬åŒ–å¤‡å¿˜å½•ç±»**
```java
/**
 * ç‰ˆæœ¬åŒ–å¤‡å¿˜å½• - å¸¦ç‰ˆæœ¬å·å’Œæè¿°ä¿¡æ¯
 */
public class VersionedMemento {
    private final String content;
    private final int cursorPosition;
    private final String version;
    private final String description;
    private final long timestamp;
    private final String author;
    
    public VersionedMemento(String content, int cursorPosition, 
                           String version, String description, String author) {
        this.content = content;
        this.cursorPosition = cursorPosition;
        this.version = version;
        this.description = description;
        this.author = author;
        this.timestamp = System.currentTimeMillis();
    }
    
    // Getters
    public String getContent() { return content; }
    public int getCursorPosition() { return cursorPosition; }
    public String getVersion() { return version; }
    public String getDescription() { return description; }
    public String getAuthor() { return author; }
    public long getTimestamp() { return timestamp; }
    
    @Override
    public String toString() {
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        return String.format("ç‰ˆæœ¬ %s: %s (ä½œè€…: %s, æ—¶é—´: %s)", 
                           version, description, author, sdf.format(new Date(timestamp)));
    }
}
```

**ğŸ—‚ï¸ ç‰ˆæœ¬æ§åˆ¶ç®¡ç†å™¨**
```java
/**
 * ç‰ˆæœ¬æ§åˆ¶ç®¡ç†å™¨ - ç®¡ç†å¤šä¸ªç‰ˆæœ¬çš„å¤‡å¿˜å½•
 */
public class VersionControl {
    private List<VersionedMemento> versions;
    private int currentVersionIndex;
    private int versionCounter;
    
    public VersionControl() {
        this.versions = new ArrayList<>();
        this.currentVersionIndex = -1;
        this.versionCounter = 1;
    }
    
    // æäº¤æ–°ç‰ˆæœ¬
    public String commit(Document document, String description, String author) {
        String version = "v1." + versionCounter++;
        VersionedMemento memento = new VersionedMemento(
            document.toString(), 
            document.getCursorPosition(),
            version, 
            description, 
            author
        );
        
        // å¦‚æœå½“å‰ä¸åœ¨æœ€æ–°ç‰ˆæœ¬ï¼Œéœ€è¦å¤„ç†åˆ†æ”¯
        if (currentVersionIndex < versions.size() - 1) {
            // ç®€åŒ–å¤„ç†ï¼šç§»é™¤å½“å‰ä½ç½®ä¹‹åçš„ç‰ˆæœ¬
            versions = versions.subList(0, currentVersionIndex + 1);
        }
        
        versions.add(memento);
        currentVersionIndex = versions.size() - 1;
        
        System.out.println("âœ… å·²æäº¤ç‰ˆæœ¬: " + memento);
        return version;
    }
    
    // å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬
    public VersionedMemento checkout(String version) {
        for (int i = 0; i < versions.size(); i++) {
            if (versions.get(i).getVersion().equals(version)) {
                currentVersionIndex = i;
                return versions.get(i);
            }
        }
        return null;
    }
    
    // å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
    public VersionedMemento previous() {
        if (currentVersionIndex > 0) {
            currentVersionIndex--;
            return versions.get(currentVersionIndex);
        }
        return null;
    }
    
    // å‰è¿›åˆ°ä¸‹ä¸€ä¸ªç‰ˆæœ¬
    public VersionedMemento next() {
        if (currentVersionIndex < versions.size() - 1) {
            currentVersionIndex++;
            return versions.get(currentVersionIndex);
        }
        return null;
    }
    
    // è·å–ç‰ˆæœ¬å†å²
    public List<VersionedMemento> getVersionHistory() {
        return new ArrayList<>(versions);
    }
    
    // è·å–å½“å‰ç‰ˆæœ¬ä¿¡æ¯
    public VersionedMemento getCurrentVersion() {
        if (currentVersionIndex >= 0 && currentVersionIndex < versions.size()) {
            return versions.get(currentVersionIndex);
        }
        return null;
    }
}
```

### 4.2 ç‰ˆæœ¬æ§åˆ¶ä½¿ç”¨ç¤ºä¾‹


```java
/**
 * ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¼”ç¤º
 */
public class VersionControlDemo {
    public static void main(String[] args) {
        Document document = new Document();
        VersionControl versionControl = new VersionControl();
        
        System.out.println("=== ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¼”ç¤º ===");
        
        // ç¬¬ä¸€æ¬¡æäº¤
        document.write("é¡¹ç›®åˆå§‹åŒ–");
        versionControl.commit(document, "é¡¹ç›®åˆå§‹åŒ–", "å¼ ä¸‰");
        
        // ç¬¬äºŒæ¬¡æäº¤
        document.write("\næ·»åŠ åŸºç¡€åŠŸèƒ½");
        versionControl.commit(document, "æ·»åŠ åŸºç¡€åŠŸèƒ½", "æå››");
        
        // ç¬¬ä¸‰æ¬¡æäº¤
        document.write("\nä¿®å¤bug");
        versionControl.commit(document, "ä¿®å¤é‡è¦bug", "ç‹äº”");
        
        System.out.println("\nå½“å‰æ–‡æ¡£çŠ¶æ€:");
        System.out.println(document);
        
        // æ˜¾ç¤ºç‰ˆæœ¬å†å²
        System.out.println("\n=== ç‰ˆæœ¬å†å² ===");
        List<VersionedMemento> history = versionControl.getVersionHistory();
        for (int i = 0; i < history.size(); i++) {
            String indicator = (i == history.size() - 1) ? " â† å½“å‰ç‰ˆæœ¬" : "";
            System.out.println((i + 1) + ". " + history.get(i) + indicator);
        }
        
        // å›é€€åˆ°ç¬¬ä¸€ä¸ªç‰ˆæœ¬
        System.out.println("\n=== å›é€€åˆ° v1.1 ç‰ˆæœ¬ ===");
        VersionedMemento oldVersion = versionControl.checkout("v1.1");
        if (oldVersion != null) {
            // è¿™é‡Œåº”è¯¥æ¢å¤æ–‡æ¡£çŠ¶æ€ï¼Œç®€åŒ–æ¼”ç¤ºåªæ˜¾ç¤ºä¿¡æ¯
            System.out.println("å·²åˆ‡æ¢åˆ°: " + oldVersion);
            System.out.println("ç‰ˆæœ¬å†…å®¹: " + oldVersion.getContent());
        }
        
        // æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬ä¿¡æ¯
        System.out.println("\n=== å½“å‰ç‰ˆæœ¬ä¿¡æ¯ ===");
        VersionedMemento current = versionControl.getCurrentVersion();
        if (current != null) {
            System.out.println("å½“å‰ç‰ˆæœ¬: " + current.getVersion());
            System.out.println("æäº¤æè¿°: " + current.getDescription());
            System.out.println("æäº¤ä½œè€…: " + current.getAuthor());
        }
    }
}
```

---

## 5. âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 5.1 å†…å­˜ä¼˜åŒ–ï¼šå¢é‡å¤‡å¿˜å½•


**ğŸ¤” æ€§èƒ½é—®é¢˜åˆ†æ**
```
ä¼ ç»Ÿå¤‡å¿˜å½•æ¨¡å¼çš„é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯æ¬¡ä¿å­˜å®Œæ•´çŠ¶æ€                â”‚
â”‚ å†…å­˜ä½¿ç”¨é‡ = çŠ¶æ€å¤§å° Ã— å¤‡å¿˜å½•æ•°  â”‚
â”‚ å¤§æ–‡æ¡£ + é¢‘ç¹æ“ä½œ = å†…å­˜çˆ†ç‚¸     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŒ–æ€è·¯ï¼š
åªä¿å­˜å˜åŒ–çš„éƒ¨åˆ†ï¼ˆå¢é‡ï¼‰ï¼Œéœ€è¦æ—¶é‡æ–°æ„å»ºå®Œæ•´çŠ¶æ€
```

**ğŸ“Š å¢é‡å¤‡å¿˜å½•å®ç°**
```java
/**
 * å¢é‡å¤‡å¿˜å½• - åªä¿å­˜å˜åŒ–çš„éƒ¨åˆ†
 */
public class IncrementalMemento {
    private final String operationType;  // æ“ä½œç±»å‹ï¼šINSERT, DELETE, REPLACE
    private final int position;          // æ“ä½œä½ç½®
    private final String oldContent;     // è¢«æ›¿æ¢/åˆ é™¤çš„å†…å®¹
    private final String newContent;     // æ–°æ’å…¥/æ›¿æ¢çš„å†…å®¹
    private final long timestamp;
    
    public IncrementalMemento(String operationType, int position, 
                             String oldContent, String newContent) {
        this.operationType = operationType;
        this.position = position;
        this.oldContent = oldContent;
        this.newContent = newContent;
        this.timestamp = System.currentTimeMillis();
    }
    
    // åº”ç”¨å¢é‡å˜åŒ–ï¼ˆæ­£å‘ï¼‰
    public String applyForward(String content) {
        switch (operationType) {
            case "INSERT":
                return content.substring(0, position) + newContent + content.substring(position);
            case "DELETE":
                return content.substring(0, position) + content.substring(position + oldContent.length());
            case "REPLACE":
                return content.substring(0, position) + newContent + content.substring(position + oldContent.length());
            default:
                return content;
        }
    }
    
    // æ’¤é”€å¢é‡å˜åŒ–ï¼ˆåå‘ï¼‰
    public String applyBackward(String content) {
        switch (operationType) {
            case "INSERT":
                return content.substring(0, position) + content.substring(position + newContent.length());
            case "DELETE":
                return content.substring(0, position) + oldContent + content.substring(position);
            case "REPLACE":
                return content.substring(0, position) + oldContent + content.substring(position + newContent.length());
            default:
                return content;
        }
    }
    
    // Getters...
    public String getOperationType() { return operationType; }
    public int getPosition() { return position; }
    public long getTimestamp() { return timestamp; }
}
```

**âš¡ æ€§èƒ½ä¼˜åŒ–çš„æ–‡æ¡£ç±»**
```java
/**
 * æ€§èƒ½ä¼˜åŒ–ç‰ˆæ–‡æ¡£ç±» - æ”¯æŒå¢é‡å¤‡å¿˜å½•
 */
public class OptimizedDocument {
    private String content;
    private int cursorPosition;
    private List<IncrementalMemento> baselineState;  // åŸºçº¿çŠ¶æ€
    private String baselineContent;                   // åŸºçº¿å†…å®¹
    
    public OptimizedDocument() {
        this.content = "";
        this.cursorPosition = 0;
        this.baselineState = new ArrayList<>();
        this.baselineContent = "";
    }
    
    // æ’å…¥æ–‡æœ¬å¹¶åˆ›å»ºå¢é‡å¤‡å¿˜å½•
    public IncrementalMemento insertText(String text) {
        String oldContent = content.substring(cursorPosition, cursorPosition);
        IncrementalMemento memento = new IncrementalMemento(
            "INSERT", cursorPosition, "", text
        );
        
        // åº”ç”¨å˜åŒ–
        content = memento.applyForward(content);
        cursorPosition += text.length();
        
        return memento;
    }
    
    // åˆ é™¤æ–‡æœ¬å¹¶åˆ›å»ºå¢é‡å¤‡å¿˜å½•
    public IncrementalMemento deleteText(int length) {
        if (cursorPosition + length > content.length()) {
            length = content.length() - cursorPosition;
        }
        
        String deletedContent = content.substring(cursorPosition, cursorPosition + length);
        IncrementalMemento memento = new IncrementalMemento(
            "DELETE", cursorPosition, deletedContent, ""
        );
        
        // åº”ç”¨å˜åŒ–
        content = memento.applyForward(content);
        
        return memento;
    }
    
    // ä»å¢é‡å¤‡å¿˜å½•æ¢å¤çŠ¶æ€
    public void restoreFromIncremental(List<IncrementalMemento> mementos) {
        // ä»åŸºçº¿å¼€å§‹é‡æ–°æ„å»º
        content = baselineContent;
        
        // æŒ‰é¡ºåºåº”ç”¨æ‰€æœ‰å¢é‡å˜åŒ–
        for (IncrementalMemento memento : mementos) {
            content = memento.applyForward(content);
        }
        
        // é‡ç½®å…‰æ ‡ä½ç½®
        cursorPosition = Math.min(cursorPosition, content.length());
    }
    
    // è®¾ç½®æ–°çš„åŸºçº¿ï¼ˆå‹ç¼©å†å²ï¼‰
    public void createBaseline() {
        baselineContent = content;
        baselineState.clear();
    }
    
    @Override
    public String toString() {
        return String.format("å†…å®¹: '%s', å…‰æ ‡: %d", content, cursorPosition);
    }
}
```

### 5.2 æ™ºèƒ½å‹ç¼©ç­–ç•¥


**ğŸ“ˆ æ€§èƒ½ç›‘æ§å’Œè‡ªåŠ¨ä¼˜åŒ–**
```java
/**
 * æ™ºèƒ½å¤‡å¿˜å½•ç®¡ç†å™¨ - è‡ªåŠ¨æ€§èƒ½ä¼˜åŒ–
 */
public class SmartMementoManager {
    private OptimizedDocument document;
    private List<IncrementalMemento> incrementalHistory;
    private int compressionThreshold;  // å‹ç¼©é˜ˆå€¼
    private long lastCompressionTime;
    
    public SmartMementoManager(OptimizedDocument document, int threshold) {
        this.document = document;
        this.incrementalHistory = new ArrayList<>();
        this.compressionThreshold = threshold;
        this.lastCompressionTime = System.currentTimeMillis();
    }
    
    // æ‰§è¡Œæ“ä½œå¹¶æ™ºèƒ½ç®¡ç†å¤‡å¿˜å½•
    public void executeOperation(Supplier<IncrementalMemento> operation) {
        IncrementalMemento memento = operation.get();
        incrementalHistory.add(memento);
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦å‹ç¼©
        checkAndCompress();
    }
    
    // æ™ºèƒ½å‹ç¼©æ£€æŸ¥
    private void checkAndCompress() {
        long currentTime = System.currentTimeMillis();
        boolean shouldCompress = 
            incrementalHistory.size() >= compressionThreshold ||           // æ•°é‡è¾¾åˆ°é˜ˆå€¼
            (currentTime - lastCompressionTime) > 300000;                 // æˆ–è€…5åˆ†é’Ÿåå¼ºåˆ¶å‹ç¼©
        
        if (shouldCompress) {
            compress();
        }
    }
    
    // æ‰§è¡Œå‹ç¼©ï¼šå°†å¢é‡å†å²åˆå¹¶ä¸ºæ–°åŸºçº¿
    private void compress() {
        System.out.println("ğŸ”„ æ‰§è¡Œæ™ºèƒ½å‹ç¼©ï¼Œå‹ç¼© " + incrementalHistory.size() + " ä¸ªå¢é‡æ“ä½œ");
        
        // åˆ›å»ºæ–°åŸºçº¿
        document.createBaseline();
        
        // æ¸…ç©ºå¢é‡å†å²
        incrementalHistory.clear();
        lastCompressionTime = System.currentTimeMillis();
        
        // è®°å½•å†…å­˜ä½¿ç”¨æƒ…å†µ
        Runtime runtime = Runtime.getRuntime();
        long usedMemory = runtime.totalMemory() - runtime.freeMemory();
        System.out.println("ğŸ“Š å‹ç¼©åå†…å­˜ä½¿ç”¨: " + (usedMemory / 1024 / 1024) + " MB");
    }
    
    // æ’¤é”€æ“ä½œ
    public boolean undo() {
        if (incrementalHistory.isEmpty()) {
            return false;
        }
        
        // ç§»é™¤æœ€åä¸€ä¸ªæ“ä½œ
        IncrementalMemento lastMemento = incrementalHistory.remove(incrementalHistory.size() - 1);
        
        // é‡æ–°æ„å»ºçŠ¶æ€
        document.restoreFromIncremental(incrementalHistory);
        
        System.out.println("â†©ï¸ æ’¤é”€æ“ä½œ: " + lastMemento.getOperationType());
        return true;
    }
    
    // è·å–æ€§èƒ½ç»Ÿè®¡
    public void printPerformanceStats() {
        System.out.println("\nğŸ“ˆ æ€§èƒ½ç»Ÿè®¡:");
        System.out.println("  å½“å‰å¢é‡æ“ä½œæ•°: " + incrementalHistory.size());
        System.out.println("  å‹ç¼©é˜ˆå€¼: " + compressionThreshold);
        System.out.println("  ä¸Šæ¬¡å‹ç¼©æ—¶é—´: " + new Date(lastCompressionTime));
        
        Runtime runtime = Runtime.getRuntime();
        long usedMemory = runtime.totalMemory() - runtime.freeMemory();
        System.out.println("  å½“å‰å†…å­˜ä½¿ç”¨: " + (usedMemory / 1024 / 1024) + " MB");
    }
}
```

---

## 6. ğŸ“ æ–‡æœ¬ç¼–è¾‘å™¨å®æˆ˜åº”ç”¨


### 6.1 å®Œæ•´çš„æ–‡æœ¬ç¼–è¾‘å™¨å®ç°


**ğŸ¨ æ–‡æœ¬ç¼–è¾‘å™¨ä¸»ç±»**
```java
/**
 * å®Œæ•´çš„æ–‡æœ¬ç¼–è¾‘å™¨å®ç°
 * ç»“åˆå¤‡å¿˜å½•æ¨¡å¼æä¾›å®Œæ•´çš„ç¼–è¾‘åŠŸèƒ½
 */
public class TextEditor {
    private Document document;
    private CommandHistory commandHistory;
    private VersionControl versionControl;
    private SmartMementoManager mementoManager;
    private Scanner scanner;
    
    public TextEditor() {
        this.document = new Document();
        this.commandHistory = new CommandHistory(50);
        this.versionControl = new VersionControl();
        this.scanner = new Scanner(System.in);
        
        // ä¼˜åŒ–ç‰ˆæ–‡æ¡£ç”¨äºæ€§èƒ½æµ‹è¯•
        OptimizedDocument optimizedDoc = new OptimizedDocument();
        this.mementoManager = new SmartMementoManager(optimizedDoc, 10);
    }
    
    // ä¸»è¿è¡Œå¾ªç¯
    public void run() {
        System.out.println("ğŸ‰ æ¬¢è¿ä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼æ–‡æœ¬ç¼–è¾‘å™¨ï¼");
        System.out.println("è¾“å…¥ 'help' æŸ¥çœ‹å¯ç”¨å‘½ä»¤");
        
        while (true) {
            System.out.print("\nğŸ“ ç¼–è¾‘å™¨> ");
            String input = scanner.nextLine().trim();
            
            if (input.equalsIgnoreCase("exit") || input.equalsIgnoreCase("quit")) {
                System.out.println("ğŸ‘‹ å†è§ï¼");
                break;
            }
            
            processCommand(input);
        }
    }
    
    // å¤„ç†ç”¨æˆ·å‘½ä»¤
    private void processCommand(String input) {
        String[] parts = input.split(" ", 2);
        String command = parts[0].toLowerCase();
        String parameter = parts.length > 1 ? parts[1] : "";
        
        switch (command) {
            case "help":
                showHelp();
                break;
            case "write":
                if (!parameter.isEmpty()) {
                    executeWrite(parameter);
                } else {
                    System.out.println("âŒ è¯·æä¾›è¦å†™å…¥çš„æ–‡æœ¬ï¼Œä¾‹å¦‚: write Hello");
                }
                break;
            case "show":
                showDocument();
                break;
            case "undo":
                executeUndo();
                break;
            case "redo":
                executeRedo();
                break;
            case "commit":
                if (!parameter.isEmpty()) {
                    executeCommit(parameter);
                } else {
                    System.out.println("âŒ è¯·æä¾›æäº¤æè¿°ï¼Œä¾‹å¦‚: commit åˆå§‹ç‰ˆæœ¬");
                }
                break;
            case "history":
                showHistory();
                break;
            case "versions":
                showVersions();
                break;
            case "checkout":
                if (!parameter.isEmpty()) {
                    executeCheckout(parameter);
                } else {
                    System.out.println("âŒ è¯·æä¾›ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚: checkout v1.1");
                }
                break;
            case "stats":
                showStats();
                break;
            default:
                System.out.println("âŒ æœªçŸ¥å‘½ä»¤: " + command + "ï¼Œè¾“å…¥ 'help' æŸ¥çœ‹å¸®åŠ©");
        }
    }
    
    // æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
    private void showHelp() {
        System.out.println("\nğŸ“š å¯ç”¨å‘½ä»¤:");
        System.out.println("  write <æ–‡æœ¬>     - å†™å…¥æ–‡æœ¬");
        System.out.println("  show            - æ˜¾ç¤ºå½“å‰æ–‡æ¡£");
        System.out.println("  undo            - æ’¤é”€ä¸Šä¸€ä¸ªæ“ä½œ");
        System.out.println("  redo            - é‡åšä¸Šä¸€ä¸ªæ’¤é”€");
        System.out.println("  commit <æè¿°>   - æäº¤å½“å‰ç‰ˆæœ¬");
        System.out.println("  history         - æ˜¾ç¤ºæ“ä½œå†å²");
        System.out.println("  versions        - æ˜¾ç¤ºç‰ˆæœ¬å†å²");
        System.out.println("  checkout <ç‰ˆæœ¬> - åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬");
        System.out.println("  stats           - æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯");
        System.out.println("  exit            - é€€å‡ºç¼–è¾‘å™¨");
    }
    
    // æ‰§è¡Œå†™å…¥å‘½ä»¤
    private void executeWrite(String text) {
        UndoableCommand writeCommand = new InsertTextCommand(document, text);
        commandHistory.executeCommand(writeCommand);
        System.out.println("âœ… å·²å†™å…¥: '" + text + "'");
        showDocument();
    }
    
    // æ˜¾ç¤ºæ–‡æ¡£å†…å®¹
    private void showDocument() {
        System.out.println("ğŸ“„ å½“å‰æ–‡æ¡£: " + document);
    }
    
    // æ‰§è¡Œæ’¤é”€
    private void executeUndo() {
        if (commandHistory.undo()) {
            showDocument();
        } else {
            System.out.println("âŒ æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ");
        }
    }
    
    // æ‰§è¡Œé‡åš
    private void executeRedo() {
        if (commandHistory.redo()) {
            showDocument();
        } else {
            System.out.println("âŒ æ²¡æœ‰å¯é‡åšçš„æ“ä½œ");
        }
    }
    
    // æ‰§è¡Œæäº¤
    private void executeCommit(String description) {
        String version = versionControl.commit(document, description, "ç”¨æˆ·");
        System.out.println("âœ… å·²æäº¤ç‰ˆæœ¬: " + version);
    }
    
    // æ˜¾ç¤ºæ“ä½œå†å²
    private void showHistory() {
        List<String> undoableCommands = commandHistory.getUndoableCommands();
        if (undoableCommands.isEmpty()) {
            System.out.println("ğŸ“‹ æ“ä½œå†å²ä¸ºç©º");
            return;
        }
        
        System.out.println("\nğŸ“‹ æ“ä½œå†å² (æœ€æ–°åœ¨ä¸Š):");
        for (int i = undoableCommands.size() - 1; i >= 0; i--) {
            System.out.println("  " + (undoableCommands.size() - i) + ". " + undoableCommands.get(i));
        }
    }
    
    // æ˜¾ç¤ºç‰ˆæœ¬å†å²
    private void showVersions() {
        List<VersionedMemento> versions = versionControl.getVersionHistory();
        if (versions.isEmpty()) {
            System.out.println("ğŸ“‹ ç‰ˆæœ¬å†å²ä¸ºç©º");
            return;
        }
        
        System.out.println("\nğŸ“‹ ç‰ˆæœ¬å†å²:");
        VersionedMemento current = versionControl.getCurrentVersion();
        for (int i = 0; i < versions.size(); i++) {
            String indicator = versions.get(i).equals(current) ? " â† å½“å‰ç‰ˆæœ¬" : "";
            System.out.println("  " + (i + 1) + ". " + versions.get(i) + indicator);
        }
    }
    
    // æ‰§è¡Œç‰ˆæœ¬åˆ‡æ¢
    private void executeCheckout(String version) {
        VersionedMemento memento = versionControl.checkout(version);
        if (memento != null) {
            // å®é™…åº”ç”¨ä¸­åº”è¯¥æ¢å¤æ–‡æ¡£çŠ¶æ€
            System.out.println("âœ… å·²åˆ‡æ¢åˆ°ç‰ˆæœ¬: " + memento.getVersion());
            System.out.println("ğŸ“„ ç‰ˆæœ¬æè¿°: " + memento.getDescription());
        } else {
            System.out.println("âŒ æœªæ‰¾åˆ°ç‰ˆæœ¬: " + version);
        }
    }
    
    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
    private void showStats() {
        System.out.println("\nğŸ“Š ç¼–è¾‘å™¨ç»Ÿè®¡:");
        System.out.println("  æ–‡æ¡£é•¿åº¦: " + document.toString().length() + " å­—ç¬¦");
        System.out.println("  æ“ä½œå†å²æ•°: " + commandHistory.getUndoableCommands().size());
        System.out.println("  ç‰ˆæœ¬æ•°: " + versionControl.getVersionHistory().size());
        
        VersionedMemento current = versionControl.getCurrentVersion();
        if (current != null) {
            System.out.println("  å½“å‰ç‰ˆæœ¬: " + current.getVersion());
        }
        
        // æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡
        mementoManager.printPerformanceStats();
    }
}
```

### 6.2 ç¼–è¾‘å™¨ä½¿ç”¨æ¼”ç¤º


```java
/**
 * æ–‡æœ¬ç¼–è¾‘å™¨æ¼”ç¤ºç¨‹åº
 */
public class TextEditorDemo {
    public static void main(String[] args) {
        // åˆ›å»ºå¹¶å¯åŠ¨ç¼–è¾‘å™¨
        TextEditor editor = new TextEditor();
        
        // æ¼”ç¤ºæ¨¡å¼ï¼ˆéäº¤äº’å¼ï¼‰
        demonstrateEditor();
        
        // äº¤äº’æ¨¡å¼
        // editor.run();
    }
    
    private static void demonstrateEditor() {
        System.out.println("=== æ–‡æœ¬ç¼–è¾‘å™¨æ¼”ç¤ºæ¨¡å¼ ===");
        
        Document document = new Document();
        CommandHistory commandHistory = new CommandHistory(10);
        VersionControl versionControl = new VersionControl();
        
        // æ¨¡æ‹Ÿç¼–è¾‘ä¼šè¯
        System.out.println("1. å¼€å§‹ç¼–å†™æ–‡æ¡£...");
        
        UndoableCommand cmd1 = new InsertTextCommand(document, "å¤‡å¿˜å½•æ¨¡å¼");
        commandHistory.executeCommand(cmd1);
        System.out.println("   å½“å‰å†…å®¹: " + document);
        
        UndoableCommand cmd2 = new InsertTextCommand(document, "å¾ˆæœ‰ç”¨");
        commandHistory.executeCommand(cmd2);
        System.out.println("   å½“å‰å†…å®¹: " + document);
        
        // æäº¤ç¬¬ä¸€ä¸ªç‰ˆæœ¬
        versionControl.commit(document, "å®ŒæˆåŸºç¡€å†…å®¹", "å¼€å‘è€…");
        
        // ç»§ç»­ç¼–è¾‘
        UndoableCommand cmd3 = new InsertTextCommand(document, "ï¼Œç‰¹åˆ«é€‚åˆå®ç°æ’¤é”€åŠŸèƒ½");
        commandHistory.executeCommand(cmd3);
        System.out.println("   å½“å‰å†…å®¹: " + document);
        
        // æ¼”ç¤ºæ’¤é”€
        System.out.println("\n2. æ¼”ç¤ºæ’¤é”€åŠŸèƒ½...");
        commandHistory.undo();
        System.out.println("   æ’¤é”€å: " + document);
        
        // æ¼”ç¤ºé‡åš
        System.out.println("\n3. æ¼”ç¤ºé‡åšåŠŸèƒ½...");
        commandHistory.redo();
        System.out.println("   é‡åšå: " + document);
        
        // æäº¤æœ€ç»ˆç‰ˆæœ¬
        versionControl.commit(document, "å®Œæˆè¯¦ç»†è¯´æ˜", "å¼€å‘è€…");
        
        // æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
        System.out.println("\n4. æœ€ç»ˆç»Ÿè®¡ä¿¡æ¯:");
        System.out.println("   æ–‡æ¡£æœ€ç»ˆå†…å®¹: " + document);
        System.out.println("   å¯æ’¤é”€æ“ä½œæ•°: " + commandHistory.getUndoableCommands().size());
        System.out.println("   ç‰ˆæœ¬æ€»æ•°: " + versionControl.getVersionHistory().size());
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ **å¤‡å¿˜å½•æ¨¡å¼æœ¬è´¨**
å­˜å‚¨å¯¹è±¡çŠ¶æ€å¿«ç…§ï¼Œæ”¯æŒçŠ¶æ€æ¢å¤ï¼Œä¸ç ´åå°è£…æ€§

ğŸ”‘ **ä¸‰å¤§æ ¸å¿ƒè§’è‰²**
â€¢ å‘èµ·äººï¼šåˆ›å»ºå’Œæ¢å¤çŠ¶æ€çš„å¯¹è±¡
â€¢ å¤‡å¿˜å½•ï¼šä¿å­˜çŠ¶æ€å¿«ç…§çš„è½½ä½“  
â€¢ ç®¡ç†è€…ï¼šè´Ÿè´£å¤‡å¿˜å½•çš„å­˜å‚¨å’Œç®¡ç†

ğŸ’¡ **å…³é”®ç‰¹æ€§**
â€¢ çŠ¶æ€æ¢å¤ï¼šèƒ½å¤Ÿå›åˆ°å†å²çŠ¶æ€
â€¢ å°è£…ä¿æŠ¤ï¼šä¸æš´éœ²å¯¹è±¡å†…éƒ¨ç»“æ„
â€¢ ä¸å¯å˜æ€§ï¼šå¤‡å¿˜å½•å¯¹è±¡åˆ›å»ºåä¸å¯ä¿®æ”¹
```

### 7.2 å®ç°è¦ç‚¹ä¸æœ€ä½³å®è·µ


**ğŸ”¹ è®¾è®¡åŸåˆ™**
- [ ] **å°è£…æ€§**ï¼šå¤‡å¿˜å½•åªèƒ½ç”±å‘èµ·äººåˆ›å»ºå’Œè§£é‡Š
- [ ] **ä¸å¯å˜**ï¼šå¤‡å¿˜å½•åˆ›å»ºåä¸å…è®¸ä¿®æ”¹
- [ ] **è½»é‡åŒ–**ï¼šæ ¹æ®éœ€è¦é€‰æ‹©å®Œæ•´å¤‡å¿˜å½•æˆ–å¢é‡å¤‡å¿˜å½•
- [ ] **ç”Ÿå‘½å‘¨æœŸ**ï¼šåˆç†ç®¡ç†å¤‡å¿˜å½•çš„å­˜å‚¨å’Œæ¸…ç†

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
å†…å­˜ä¼˜åŒ–ï¼š
â”œâ”€â”€ å¢é‡å¤‡å¿˜å½•ï¼šåªä¿å­˜å˜åŒ–éƒ¨åˆ†
â”œâ”€â”€ æ™ºèƒ½å‹ç¼©ï¼šå®šæœŸåˆå¹¶å†å²è®°å½•
â”œâ”€â”€ å®¹é‡é™åˆ¶ï¼šè®¾ç½®æœ€å¤§å¤‡å¿˜å½•æ•°é‡
â””â”€â”€ å»¶è¿Ÿæ¸…ç†ï¼šå¼‚æ­¥æ¸…ç†è¿‡æœŸå¤‡å¿˜å½•

æ—¶é—´ä¼˜åŒ–ï¼š
â”œâ”€â”€ å¿«é€Ÿåˆ›å»ºï¼šé¿å…æ·±æ‹·è´å¼€é”€
â”œâ”€â”€ æ‰¹é‡æ“ä½œï¼šåˆå¹¶å¤šä¸ªå°æ“ä½œ
â””â”€â”€ ç´¢å¼•ä¼˜åŒ–ï¼šå¿«é€Ÿå®šä½å†å²çŠ¶æ€
```

### 7.3 é€‚ç”¨åœºæ™¯åˆ¤æ–­


**âœ… æœ€é€‚åˆçš„åœºæ™¯**
- **æ–‡æœ¬ç¼–è¾‘å™¨**ï¼šæ’¤é”€/é‡åšåŠŸèƒ½
- **æ¸¸æˆå­˜æ¡£**ï¼šä¿å­˜æ¸¸æˆè¿›åº¦
- **æ•°æ®åº“äº‹åŠ¡**ï¼šå›æ»šæœºåˆ¶
- **é…ç½®ç®¡ç†**ï¼šç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- **ç”»å›¾è½¯ä»¶**ï¼šæ“ä½œå†å²è®°å½•

**âŒ ä¸é€‚åˆçš„åœºæ™¯**
- **çŠ¶æ€ç®€å•**ï¼šåªæœ‰å‡ ä¸ªç®€å•å±æ€§çš„å¯¹è±¡
- **å†…å­˜å—é™**ï¼šç§»åŠ¨è®¾å¤‡æˆ–åµŒå…¥å¼ç³»ç»Ÿ
- **å®æ—¶æ€§è¦æ±‚é«˜**ï¼šå¤‡å¿˜å½•åˆ›å»ºå¼€é”€ä¸èƒ½æ¥å—
- **çŠ¶æ€å˜åŒ–é¢‘ç¹**ï¼šä¼šäº§ç”Ÿå¤§é‡å¤‡å¿˜å½•

### 7.4 ä¸å…¶ä»–æ¨¡å¼çš„åä½œ


**ğŸ¤ å¸¸è§ç»„åˆæ¨¡å¼**
```
å¤‡å¿˜å½• + å‘½ä»¤æ¨¡å¼ï¼š
å®Œæ•´çš„æ’¤é”€/é‡åšåŠŸèƒ½å®ç°

å¤‡å¿˜å½• + åŸå‹æ¨¡å¼ï¼š
é€šè¿‡å…‹éš†å¿«é€Ÿåˆ›å»ºå¤‡å¿˜å½•

å¤‡å¿˜å½• + ä¸­ä»‹è€…æ¨¡å¼ï¼š
å¤æ‚ç³»ç»Ÿçš„çŠ¶æ€åè°ƒç®¡ç†

å¤‡å¿˜å½• + è§‚å¯Ÿè€…æ¨¡å¼ï¼š
çŠ¶æ€å˜åŒ–çš„é€šçŸ¥æœºåˆ¶
```

### 7.5 è®°å¿†è¦ç‚¹


**ğŸ¯ ä¸€åˆ†é’ŸæŒæ¡**
1. **æ ¸å¿ƒç›®çš„**ï¼šä¿å­˜å’Œæ¢å¤å¯¹è±¡çŠ¶æ€
2. **ä¸‰ä¸ªè§’è‰²**ï¼šå‘èµ·äººã€å¤‡å¿˜å½•ã€ç®¡ç†è€…
3. **å…³é”®ç‰¹æ€§**ï¼šå°è£…æ€§ã€ä¸å¯å˜æ€§ã€å¯æ¢å¤æ€§

**â­ å¿…é¡»ç†è§£**
- å¤‡å¿˜å½•ä¸æ˜¯ç®€å•çš„æ•°æ®æ‹·è´ï¼Œè€Œæ˜¯çŠ¶æ€çš„å®Œæ•´å¿«ç…§
- ç®¡ç†è€…è´Ÿè´£å¤‡å¿˜å½•çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸åº”è¯¥ä¿®æ”¹å¤‡å¿˜å½•å†…å®¹
- æ€§èƒ½ä¼˜åŒ–æ˜¯å®é™…åº”ç”¨ä¸­çš„é‡è¦è€ƒè™‘å› ç´ 

**ğŸš¨ æ³¨æ„äº‹é¡¹**
- å†…å­˜ä½¿ç”¨é‡å¯èƒ½å¾ˆå¤§ï¼Œéœ€è¦åˆç†æ§åˆ¶å¤‡å¿˜å½•æ•°é‡
- æ·±æ‹·è´å’Œæµ…æ‹·è´çš„é€‰æ‹©è¦æ ¹æ®å¯¹è±¡å¤æ‚åº¦å†³å®š
- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¦æ³¨æ„å¤‡å¿˜å½•çš„çº¿ç¨‹å®‰å…¨æ€§

**æ ¸å¿ƒè®°å¿†å£è¯€**
> å¤‡å¿˜å¿«ç…§å­˜çŠ¶æ€ï¼Œä¸‰è§’åä½œä¸åˆ†ç¦»  
> å‘èµ·åˆ›å»ºèƒ½æ¢å¤ï¼Œç®¡ç†å­˜å–æŠ¤éšç§  
> æ’¤é”€é‡åšæœ€å¸¸è§ï¼Œæ€§èƒ½ä¼˜åŒ–è¦ç‰¢è®°

---

## ğŸª å­¦ä¹ æ£€æŸ¥ç‚¹


**ğŸ“ è‡ªæˆ‘æ£€æµ‹**
- [ ] èƒ½å¤Ÿè§£é‡Šå¤‡å¿˜å½•æ¨¡å¼çš„ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²åŠå…¶èŒè´£
- [ ] ç†è§£ä¸ºä»€ä¹ˆå¤‡å¿˜å½•è¦è®¾è®¡æˆä¸å¯å˜å¯¹è±¡
- [ ] æŒæ¡å®Œæ•´å¤‡å¿˜å½•å’Œå¢é‡å¤‡å¿˜å½•çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯
- [ ] èƒ½å¤Ÿå®ç°åŸºç¡€çš„æ’¤é”€/é‡åšåŠŸèƒ½
- [ ] äº†è§£æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦ç­–ç•¥

**ğŸ’ª å®è·µæŒ‘æˆ˜**
å°è¯•ä¸ºä¸€ä¸ªç®€å•çš„ç”»å›¾ç¨‹åºå®ç°æ’¤é”€åŠŸèƒ½ï¼Œè¦æ±‚ï¼š
1. æ”¯æŒç»˜åˆ¶ç›´çº¿ã€çŸ©å½¢ã€åœ†å½¢
2. æ”¯æŒæ’¤é”€æœ€è¿‘10æ­¥æ“ä½œ
3. è€ƒè™‘å†…å­˜ä½¿ç”¨ä¼˜åŒ–

**ğŸ“š æ‰©å±•å­¦ä¹ **
- ğŸ“– æ·±å…¥å­¦ä¹ ï¼šè®¾è®¡æ¨¡å¼ä¸è½¯ä»¶æ¶æ„
- ğŸ¥ æ¨èè§‚çœ‹ï¼šé‡æ„æŠ€å·§ä¸æœ€ä½³å®è·µ
- ğŸ’» å®æˆ˜é¡¹ç›®ï¼šå¼€å‘ä¸€ä¸ªæ”¯æŒåä½œç¼–è¾‘çš„æ–‡æ¡£ç³»ç»Ÿ