---
title: 4ã€ä»£ç†æ¨¡å¼å®é™…åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [ä»£ç†æ¨¡å¼å®é™…åº”ç”¨æ¦‚è¿°](#1-ä»£ç†æ¨¡å¼å®é™…åº”ç”¨æ¦‚è¿°)
2. [è¿œç¨‹ä»£ç†ï¼ˆRPCï¼‰](#2-è¿œç¨‹ä»£ç†RPC)
3. [è™šæ‹Ÿä»£ç†ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰](#3-è™šæ‹Ÿä»£ç†å»¶è¿ŸåŠ è½½)
4. [ä¿æŠ¤ä»£ç†ï¼ˆæƒé™æ§åˆ¶ï¼‰](#4-ä¿æŠ¤ä»£ç†æƒé™æ§åˆ¶)
5. [æ™ºèƒ½å¼•ç”¨ä»£ç†](#5-æ™ºèƒ½å¼•ç”¨ä»£ç†)
6. [ç¼“å­˜ä»£ç†è®¾è®¡](#6-ç¼“å­˜ä»£ç†è®¾è®¡)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»£ç†æ¨¡å¼å®é™…åº”ç”¨æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼çš„å®é™…åº”ç”¨


**é€šä¿—ç†è§£**ï¼šä»£ç†æ¨¡å¼å°±åƒç°å®ç”Ÿæ´»ä¸­çš„"ä»£ç†äºº"

```
ç°å®ç”Ÿæ´»ä¸­çš„ä»£ç†ï¼š
ä½ æƒ³ä¹°æˆ¿ â†’ æ‰¾æˆ¿äº§ä¸­ä»‹ â†’ ä¸­ä»‹å¸®ä½ æ‰¾æˆ¿
ä½ æœ¬äºº     ä»£ç†(ä¸­ä»‹)     çœŸæ­£çš„æˆ¿æº

ç¨‹åºä¸­çš„ä»£ç†ï¼š
å®¢æˆ·ç«¯ â†’ ä»£ç†å¯¹è±¡ â†’ çœŸå®å¯¹è±¡
è°ƒç”¨è€…   ä¸­é—´å±‚      å®é™…æ‰§è¡Œè€…
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä»£ç†æ¨¡å¼


**æ ¸å¿ƒä½œç”¨**ï¼šåœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä¸ºå…¶æ·»åŠ é¢å¤–åŠŸèƒ½

```
è§£å†³çš„é—®é¢˜ï¼š
ğŸ”¸ è¿œç¨‹è®¿é—®ï¼šè®¿é—®è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡
ğŸ”¸ å»¶è¿Ÿåˆ›å»ºï¼šç­‰åˆ°çœŸæ­£éœ€è¦æ—¶æ‰åˆ›å»ºå¯¹è±¡
ğŸ”¸ æƒé™æ§åˆ¶ï¼šæ§åˆ¶å¯¹æ•æ„Ÿå¯¹è±¡çš„è®¿é—®
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ·»åŠ ç¼“å­˜ã€æ—¥å¿—ç­‰åŠŸèƒ½
ğŸ”¸ æ™ºèƒ½ç®¡ç†ï¼šè‡ªåŠ¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
```

### 1.3 ä»£ç†æ¨¡å¼çš„äº”å¤§åº”ç”¨ç±»å‹


| ä»£ç†ç±»å‹ | **æ ¸å¿ƒä½œç”¨** | **åº”ç”¨åœºæ™¯** | **å…¸å‹ä¾‹å­** |
|---------|------------|-------------|-------------|
| ğŸŒ **è¿œç¨‹ä»£ç†** | `è·¨ç½‘ç»œè®¿é—®` | `åˆ†å¸ƒå¼ç³»ç»Ÿ` | `RPCè°ƒç”¨ã€WebæœåŠ¡` |
| â° **è™šæ‹Ÿä»£ç†** | `å»¶è¿Ÿåˆ›å»º` | `æ€§èƒ½ä¼˜åŒ–` | `å›¾ç‰‡æ‡’åŠ è½½ã€å¯¹è±¡æ± ` |
| ğŸ”’ **ä¿æŠ¤ä»£ç†** | `æƒé™æ§åˆ¶` | `å®‰å…¨ç®¡ç†` | `è®¿é—®æ§åˆ¶ã€æƒé™éªŒè¯` |
| ğŸ§  **æ™ºèƒ½å¼•ç”¨** | `è‡ªåŠ¨ç®¡ç†` | `èµ„æºç®¡ç†` | `å¼•ç”¨è®¡æ•°ã€è‡ªåŠ¨é‡Šæ”¾` |
| ğŸ’¾ **ç¼“å­˜ä»£ç†** | `æ€§èƒ½æå‡` | `æ•°æ®ç¼“å­˜` | `æ•°æ®åº“ç¼“å­˜ã€HTTPç¼“å­˜` |

---

## 2. ğŸŒ è¿œç¨‹ä»£ç†ï¼ˆRPCï¼‰


### 2.1 è¿œç¨‹ä»£ç†çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯è¿œç¨‹ä»£ç†**ï¼šå¸®ä½ è®¿é—®è¿œç¨‹æœåŠ¡å™¨ä¸Šå¯¹è±¡çš„"ä»£ç†äºº"

```
æ²¡æœ‰ä»£ç†çš„è¿œç¨‹è°ƒç”¨ï¼š
å®¢æˆ·ç«¯ ----ç½‘ç»œå¤æ‚å¤„ç†----> è¿œç¨‹æœåŠ¡å™¨
       (æ‰‹åŠ¨å¤„ç†ç½‘ç»œã€åºåˆ—åŒ–ç­‰)

æœ‰äº†è¿œç¨‹ä»£ç†ï¼š
å®¢æˆ·ç«¯ â†’ è¿œç¨‹ä»£ç† ----ç½‘ç»œ----> è¿œç¨‹æœåŠ¡å™¨
       (åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•)
```

### 2.2 è¿œç¨‹ä»£ç†çš„å·¥ä½œåŸç†


**æ ¸å¿ƒæœºåˆ¶**ï¼šè®©è¿œç¨‹è°ƒç”¨çœ‹èµ·æ¥åƒæœ¬åœ°è°ƒç”¨

```
è¿œç¨‹ä»£ç†å·¥ä½œæµç¨‹ï¼š

å®¢æˆ·ç«¯è°ƒç”¨                è¿œç¨‹ä»£ç†                è¿œç¨‹æœåŠ¡å™¨
    |                       |                        |
    |--è°ƒç”¨æ–¹æ³•------------->|                        |
    |  getData("123")       |--åºåˆ—åŒ–è¯·æ±‚----------->|
    |                       |  ç½‘ç»œä¼ è¾“               |--æ‰§è¡ŒçœŸå®æ–¹æ³•
    |                       |<-åºåˆ—åŒ–å“åº”------------|  getData("123")
    |<-è¿”å›ç»“æœ-------------|                        |
    |  "Hello World"        |                        |
```

### 2.3 è¿œç¨‹ä»£ç†å®ç°ç¤ºä¾‹


**æ¥å£å®šä¹‰**ï¼š
```java
// è¿œç¨‹æœåŠ¡æ¥å£
public interface UserService {
    User getUserById(String id);
    List<User> getAllUsers();
    boolean saveUser(User user);
}
```

**è¿œç¨‹ä»£ç†å®ç°**ï¼š
```java
// è¿œç¨‹ä»£ç†ç±»
public class UserServiceProxy implements UserService {
    private String serverUrl;
    private HttpClient httpClient;
    
    public UserServiceProxy(String serverUrl) {
        this.serverUrl = serverUrl;
        this.httpClient = new HttpClient();
    }
    
    @Override
    public User getUserById(String id) {
        try {
            // 1. æ„å»ºè¯·æ±‚
            String url = serverUrl + "/users/" + id;
            
            // 2. å‘é€HTTPè¯·æ±‚
            String response = httpClient.get(url);
            
            // 3. ååºåˆ—åŒ–å“åº”
            return JSON.parseObject(response, User.class);
            
        } catch (Exception e) {
            throw new RuntimeException("è¿œç¨‹è°ƒç”¨å¤±è´¥", e);
        }
    }
}
```

**å®¢æˆ·ç«¯ä½¿ç”¨**ï¼š
```java
public class ClientDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè¿œç¨‹ä»£ç†
        UserService userService = new UserServiceProxy("http://api.example.com");
        
        // åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ä½¿ç”¨
        User user = userService.getUserById("123");
        System.out.println("ç”¨æˆ·åï¼š" + user.getName());
    }
}
```

### 2.4 è¿œç¨‹ä»£ç†çš„ä¼˜åŠ¿


**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… **é€æ˜æ€§**ï¼šå®¢æˆ·ç«¯æ— éœ€å…³å¿ƒç½‘ç»œç»†èŠ‚
- âœ… **ç®€åŒ–å¼€å‘**ï¼šå±è”½å¤æ‚çš„ç½‘ç»œç¼–ç¨‹
- âœ… **ç»Ÿä¸€æ¥å£**ï¼šæœ¬åœ°å’Œè¿œç¨‹è°ƒç”¨æ¥å£ä¸€è‡´
- âœ… **é”™è¯¯å¤„ç†**ï¼šé›†ä¸­å¤„ç†ç½‘ç»œå¼‚å¸¸

---

## 3. â° è™šæ‹Ÿä»£ç†ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰


### 3.1 è™šæ‹Ÿä»£ç†çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯è™šæ‹Ÿä»£ç†**ï¼šæ¨è¿Ÿåˆ›å»ºè€—æ—¶å¯¹è±¡ï¼Œç­‰åˆ°çœŸæ­£éœ€è¦æ—¶å†åˆ›å»º

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç¨‹åºå¯åŠ¨ â†’ ç«‹å³åˆ›å»ºæ‰€æœ‰å¯¹è±¡ â†’ å†…å­˜å ç”¨å¤§ï¼Œå¯åŠ¨æ…¢

è™šæ‹Ÿä»£ç†æ–¹å¼ï¼š
ç¨‹åºå¯åŠ¨ â†’ åˆ›å»ºä»£ç†å¯¹è±¡(è½»é‡) â†’ çœŸæ­£ä½¿ç”¨æ—¶æ‰åˆ›å»ºçœŸå®å¯¹è±¡
```

### 3.2 è™šæ‹Ÿä»£ç†çš„åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
ğŸ”¸ å›¾ç‰‡å»¶è¿ŸåŠ è½½ï¼šç½‘é¡µå›¾ç‰‡ç­‰åˆ°ç”¨æˆ·æ»šåŠ¨åˆ°æ‰åŠ è½½
ğŸ”¸ å¤§æ–‡ä»¶å¤„ç†ï¼šè§†é¢‘æ–‡ä»¶ç­‰åˆ°æ’­æ”¾æ—¶æ‰åŠ è½½åˆ°å†…å­˜
ğŸ”¸ æ•°æ®åº“è¿æ¥ï¼šç­‰åˆ°çœŸæ­£æŸ¥è¯¢æ—¶æ‰å»ºç«‹è¿æ¥
ğŸ”¸ æŠ¥è¡¨ç”Ÿæˆï¼šç­‰åˆ°ç”¨æˆ·ç‚¹å‡»æŸ¥çœ‹æ—¶æ‰å¼€å§‹è®¡ç®—
```

### 3.3 å›¾ç‰‡å»¶è¿ŸåŠ è½½ç¤ºä¾‹


**å›¾ç‰‡æ¥å£**ï¼š
```java
// å›¾ç‰‡æ¥å£
public interface Image {
    void display();
    int getWidth();
    int getHeight();
}
```

**çœŸå®å›¾ç‰‡ç±»**ï¼š
```java
// çœŸå®å›¾ç‰‡ç±»ï¼ˆåˆ›å»ºè€—æ—¶ï¼‰
public class RealImage implements Image {
    private String filename;
    private byte[] imageData;
    
    public RealImage(String filename) {
        this.filename = filename;
        // æ¨¡æ‹Ÿè€—æ—¶çš„å›¾ç‰‡åŠ è½½
        loadImageFromDisk();
    }
    
    private void loadImageFromDisk() {
        System.out.println("æ­£åœ¨ä»ç£ç›˜åŠ è½½å›¾ç‰‡: " + filename);
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        try {
            Thread.sleep(2000); // æ¨¡æ‹Ÿ2ç§’åŠ è½½æ—¶é—´
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println("å›¾ç‰‡åŠ è½½å®Œæˆ: " + filename);
    }
    
    @Override
    public void display() {
        System.out.println("æ˜¾ç¤ºå›¾ç‰‡: " + filename);
    }
}
```

**è™šæ‹Ÿä»£ç†ç±»**ï¼š
```java
// å›¾ç‰‡è™šæ‹Ÿä»£ç†
public class ImageProxy implements Image {
    private String filename;
    private RealImage realImage; // çœŸå®å›¾ç‰‡å¯¹è±¡
    
    public ImageProxy(String filename) {
        this.filename = filename;
        // æ³¨æ„ï¼šè¿™é‡Œä¸åˆ›å»ºçœŸå®å¯¹è±¡
    }
    
    @Override
    public void display() {
        // å»¶è¿Ÿåˆ›å»ºï¼šåªæœ‰åœ¨çœŸæ­£æ˜¾ç¤ºæ—¶æ‰åˆ›å»ºçœŸå®å¯¹è±¡
        if (realImage == null) {
            realImage = new RealImage(filename);
        }
        realImage.display();
    }
    
    @Override
    public int getWidth() {
        // å¯ä»¥è¿”å›é¢„è®¾å€¼ï¼Œé¿å…åˆ›å»ºçœŸå®å¯¹è±¡
        return 800; // é¢„è®¾å®½åº¦
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class VirtualProxyDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆå¾ˆå¿«ï¼Œä¸åŠ è½½å›¾ç‰‡ï¼‰
        Image image1 = new ImageProxy("photo1.jpg");
        Image image2 = new ImageProxy("photo2.jpg");
        
        System.out.println("ä»£ç†å¯¹è±¡åˆ›å»ºå®Œæˆï¼Œç¨‹åºå¯åŠ¨å¿«");
        
        // åªæœ‰åœ¨çœŸæ­£æ˜¾ç¤ºæ—¶æ‰åŠ è½½å›¾ç‰‡
        System.out.println("ç”¨æˆ·æ»šåŠ¨åˆ°å›¾ç‰‡ä½ç½®...");
        image1.display(); // è¿™æ—¶æ‰çœŸæ­£åŠ è½½å›¾ç‰‡
    }
}
```

### 3.4 è™šæ‹Ÿä»£ç†çš„æ€§èƒ½ä¼˜åŠ¿


**æ€§èƒ½å¯¹æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼š
ç¨‹åºå¯åŠ¨æ—¶é—´ = æ‰€æœ‰å¯¹è±¡åˆ›å»ºæ—¶é—´æ€»å’Œ
å†…å­˜å ç”¨ = æ‰€æœ‰å¯¹è±¡å†…å­˜æ€»å’Œ

è™šæ‹Ÿä»£ç†æ–¹å¼ï¼š
ç¨‹åºå¯åŠ¨æ—¶é—´ â‰ˆ 0ï¼ˆåªåˆ›å»ºè½»é‡ä»£ç†ï¼‰
å†…å­˜å ç”¨ = å®é™…ä½¿ç”¨å¯¹è±¡çš„å†…å­˜
```

---

## 4. ğŸ”’ ä¿æŠ¤ä»£ç†ï¼ˆæƒé™æ§åˆ¶ï¼‰


### 4.1 ä¿æŠ¤ä»£ç†çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ä¿æŠ¤ä»£ç†**ï¼šåœ¨è®¿é—®å¯¹è±¡å‰è¿›è¡Œæƒé™æ£€æŸ¥çš„"å®‰ä¿"

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
è¿›å…¥é“¶è¡Œé‡‘åº“ â†’ å®‰ä¿æ£€æŸ¥èº«ä»½ â†’ å…è®¸è¿›å…¥/æ‹’ç»è®¿é—®

ç¨‹åºä¸­çš„ä¿æŠ¤ä»£ç†ï¼š
è°ƒç”¨æ•æ„Ÿæ–¹æ³• â†’ ä»£ç†æ£€æŸ¥æƒé™ â†’ å…è®¸è°ƒç”¨/æŠ›å‡ºå¼‚å¸¸
```

### 4.2 ä¿æŠ¤ä»£ç†çš„åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨**ï¼š
```
ğŸ”¸ ç®¡ç†å‘˜åŠŸèƒ½ï¼šåªæœ‰ç®¡ç†å‘˜æ‰èƒ½åˆ é™¤ç”¨æˆ·
ğŸ”¸ æ•æ„Ÿæ•°æ®ï¼šåªæœ‰ç‰¹å®šè§’è‰²æ‰èƒ½æŸ¥çœ‹å·¥èµ„ä¿¡æ¯
ğŸ”¸ æ“ä½œé™åˆ¶ï¼šæ™®é€šç”¨æˆ·ä¸èƒ½æ‰§è¡Œç³»ç»Ÿé…ç½®
ğŸ”¸ APIä¿æŠ¤ï¼šé˜²æ­¢æœªæˆæƒçš„æ¥å£è°ƒç”¨
```

### 4.3 ç”¨æˆ·ç®¡ç†ä¿æŠ¤ä»£ç†ç¤ºä¾‹


**ç”¨æˆ·ç®¡ç†æ¥å£**ï¼š
```java
// ç”¨æˆ·ç®¡ç†æ¥å£
public interface UserManager {
    void createUser(User user);
    void deleteUser(String userId);
    User getUserInfo(String userId);
    void updateSalary(String userId, double salary);
}
```

**çœŸå®ç”¨æˆ·ç®¡ç†ç±»**ï¼š
```java
// çœŸå®çš„ç”¨æˆ·ç®¡ç†å®ç°
public class RealUserManager implements UserManager {
    
    @Override
    public void createUser(User user) {
        System.out.println("åˆ›å»ºç”¨æˆ·: " + user.getName());
    }
    
    @Override
    public void deleteUser(String userId) {
        System.out.println("åˆ é™¤ç”¨æˆ·: " + userId);
    }
    
    @Override
    public void updateSalary(String userId, double salary) {
        System.out.println("æ›´æ–°ç”¨æˆ·è–ªèµ„: " + userId + " -> " + salary);
    }
}
```

**ä¿æŠ¤ä»£ç†ç±»**ï¼š
```java
// ç”¨æˆ·ç®¡ç†ä¿æŠ¤ä»£ç†
public class UserManagerProxy implements UserManager {
    private RealUserManager realManager;
    private String currentUserRole; // å½“å‰ç”¨æˆ·è§’è‰²
    
    public UserManagerProxy(String userRole) {
        this.realManager = new RealUserManager();
        this.currentUserRole = userRole;
    }
    
    @Override
    public void createUser(User user) {
        if (hasPermission("CREATE_USER")) {
            realManager.createUser(user);
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼šæ— æ³•åˆ›å»ºç”¨æˆ·");
        }
    }
    
    @Override
    public void deleteUser(String userId) {
        if (hasPermission("DELETE_USER")) {
            realManager.deleteUser(userId);
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼šæ— æ³•åˆ é™¤ç”¨æˆ·");
        }
    }
    
    @Override
    public void updateSalary(String userId, double salary) {
        if (hasPermission("UPDATE_SALARY")) {
            realManager.updateSalary(userId, salary);
        } else {
            throw new SecurityException("æƒé™ä¸è¶³ï¼šæ— æ³•ä¿®æ”¹è–ªèµ„");
        }
    }
    
    // æƒé™æ£€æŸ¥æ–¹æ³•
    private boolean hasPermission(String operation) {
        switch (currentUserRole) {
            case "ADMIN":
                return true; // ç®¡ç†å‘˜æœ‰æ‰€æœ‰æƒé™
            case "HR":
                return "UPDATE_SALARY".equals(operation); // HRåªèƒ½æ”¹è–ªèµ„
            case "USER":
                return false; // æ™®é€šç”¨æˆ·æ²¡æœ‰ç®¡ç†æƒé™
            default:
                return false;
        }
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class ProtectionProxyDemo {
    public static void main(String[] args) {
        // ç®¡ç†å‘˜ç”¨æˆ·
        UserManager adminManager = new UserManagerProxy("ADMIN");
        adminManager.createUser(new User("å¼ ä¸‰")); // æˆåŠŸ
        adminManager.deleteUser("123"); // æˆåŠŸ
        
        // æ™®é€šç”¨æˆ·
        UserManager userManager = new UserManagerProxy("USER");
        try {
            userManager.deleteUser("123"); // æŠ›å‡ºå¼‚å¸¸
        } catch (SecurityException e) {
            System.out.println("æ“ä½œå¤±è´¥: " + e.getMessage());
        }
    }
}
```

### 4.4 ä¿æŠ¤ä»£ç†çš„å®‰å…¨ä¼˜åŠ¿


**å®‰å…¨ä¿éšœ**ï¼š
- âœ… **é›†ä¸­æ§åˆ¶**ï¼šæ‰€æœ‰æƒé™æ£€æŸ¥åœ¨ä»£ç†ä¸­ç»Ÿä¸€å¤„ç†
- âœ… **é€æ˜ä¿æŠ¤**ï¼šçœŸå®å¯¹è±¡æ— éœ€å…³å¿ƒæƒé™é€»è¾‘
- âœ… **çµæ´»é…ç½®**ï¼šå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´æƒé™ç­–ç•¥
- âœ… **å®¡è®¡è¿½è¸ª**ï¼šå¯ä»¥è®°å½•æ‰€æœ‰è®¿é—®å°è¯•

---

## 5. ğŸ§  æ™ºèƒ½å¼•ç”¨ä»£ç†


### 5.1 æ™ºèƒ½å¼•ç”¨ä»£ç†çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ™ºèƒ½å¼•ç”¨ä»£ç†**ï¼šè‡ªåŠ¨ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„"æ™ºèƒ½ç®¡å®¶"

```
æ™®é€šå¼•ç”¨ï¼š
åˆ›å»ºå¯¹è±¡ â†’ ä½¿ç”¨å¯¹è±¡ â†’ æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼ˆå®¹æ˜“å¿˜è®°ï¼‰

æ™ºèƒ½å¼•ç”¨ï¼š
åˆ›å»ºå¯¹è±¡ â†’ ä½¿ç”¨å¯¹è±¡ â†’ è‡ªåŠ¨é‡Šæ”¾èµ„æºï¼ˆæ™ºèƒ½ç®¡ç†ï¼‰
```

### 5.2 æ™ºèƒ½å¼•ç”¨çš„åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨**ï¼š
```
ğŸ”¸ å¼•ç”¨è®¡æ•°ï¼šè·Ÿè¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°
ğŸ”¸ è‡ªåŠ¨é‡Šæ”¾ï¼šå½“æ²¡æœ‰å¼•ç”¨æ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
ğŸ”¸ è®¿é—®ç»Ÿè®¡ï¼šè®°å½•å¯¹è±¡è¢«è®¿é—®çš„æ¬¡æ•°å’Œæ—¶é—´
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼šç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨è®¿é—®
```

### 5.3 å¼•ç”¨è®¡æ•°æ™ºèƒ½ä»£ç†ç¤ºä¾‹


**èµ„æºæ¥å£**ï¼š
```java
// é‡è¦èµ„æºæ¥å£ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥ï¼‰
public interface DatabaseConnection {
    void query(String sql);
    void close();
}
```

**çœŸå®èµ„æºç±»**ï¼š
```java
// çœŸå®çš„æ•°æ®åº“è¿æ¥
public class RealDatabaseConnection implements DatabaseConnection {
    private String connectionId;
    
    public RealDatabaseConnection(String connectionId) {
        this.connectionId = connectionId;
        System.out.println("åˆ›å»ºæ•°æ®åº“è¿æ¥: " + connectionId);
    }
    
    @Override
    public void query(String sql) {
        System.out.println("æ‰§è¡ŒæŸ¥è¯¢: " + sql);
    }
    
    @Override
    public void close() {
        System.out.println("å…³é—­æ•°æ®åº“è¿æ¥: " + connectionId);
    }
}
```

**æ™ºèƒ½å¼•ç”¨ä»£ç†**ï¼š
```java
// æ™ºèƒ½å¼•ç”¨ä»£ç†
public class SmartConnectionProxy implements DatabaseConnection {
    private RealDatabaseConnection realConnection;
    private static int referenceCount = 0; // å¼•ç”¨è®¡æ•°
    private int accessCount = 0; // è®¿é—®è®¡æ•°
    private long lastAccessTime; // æœ€åè®¿é—®æ—¶é—´
    
    public SmartConnectionProxy(String connectionId) {
        this.realConnection = new RealDatabaseConnection(connectionId);
        referenceCount++; // å¢åŠ å¼•ç”¨è®¡æ•°
        this.lastAccessTime = System.currentTimeMillis();
        System.out.println("å½“å‰å¼•ç”¨è®¡æ•°: " + referenceCount);
    }
    
    @Override
    public void query(String sql) {
        // æ›´æ–°è®¿é—®ä¿¡æ¯
        accessCount++;
        lastAccessTime = System.currentTimeMillis();
        
        System.out.println("ç¬¬" + accessCount + "æ¬¡è®¿é—®");
        realConnection.query(sql);
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç†
        checkAndCleanup();
    }
    
    @Override
    public void close() {
        realConnection.close();
        referenceCount--; // å‡å°‘å¼•ç”¨è®¡æ•°
        System.out.println("å¼•ç”¨è®¡æ•°å‡å°‘: " + referenceCount);
        
        if (referenceCount == 0) {
            System.out.println("æ‰€æœ‰å¼•ç”¨å·²é‡Šæ”¾ï¼Œæ¸…ç†èµ„æº");
        }
    }
    
    // æ™ºèƒ½æ¸…ç†æ£€æŸ¥
    private void checkAndCleanup() {
        long currentTime = System.currentTimeMillis();
        long idleTime = currentTime - lastAccessTime;
        
        // å¦‚æœç©ºé—²æ—¶é—´è¶…è¿‡5åˆ†é’Ÿï¼Œå‘å‡ºè­¦å‘Š
        if (idleTime > 5 * 60 * 1000) {
            System.out.println("è­¦å‘Šï¼šè¿æ¥ç©ºé—²æ—¶é—´è¿‡é•¿ï¼Œå»ºè®®é‡Šæ”¾");
        }
    }
    
    // è·å–ç»Ÿè®¡ä¿¡æ¯
    public void printStats() {
        System.out.println("=== è¿æ¥ç»Ÿè®¡ä¿¡æ¯ ===");
        System.out.println("è®¿é—®æ¬¡æ•°: " + accessCount);
        System.out.println("å½“å‰å¼•ç”¨æ•°: " + referenceCount);
        System.out.println("æœ€åè®¿é—®: " + new Date(lastAccessTime));
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class SmartReferenceDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæ™ºèƒ½ä»£ç†
        SmartConnectionProxy conn1 = new SmartConnectionProxy("DB-001");
        SmartConnectionProxy conn2 = new SmartConnectionProxy("DB-002");
        
        // ä½¿ç”¨è¿æ¥
        conn1.query("SELECT * FROM users");
        conn1.query("SELECT * FROM orders");
        
        // æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
        conn1.printStats();
        
        // é‡Šæ”¾è¿æ¥
        conn1.close();
        conn2.close();
    }
}
```

### 5.4 æ™ºèƒ½å¼•ç”¨çš„è‡ªåŠ¨åŒ–ä¼˜åŠ¿


**è‡ªåŠ¨åŒ–ç®¡ç†**ï¼š
- âœ… **è‡ªåŠ¨ç»Ÿè®¡**ï¼šè·Ÿè¸ªå¯¹è±¡ä½¿ç”¨æƒ…å†µ
- âœ… **è‡ªåŠ¨æ¸…ç†**ï¼šåœ¨åˆé€‚æ—¶æœºé‡Šæ”¾èµ„æº
- âœ… **è‡ªåŠ¨ä¼˜åŒ–**ï¼šæ ¹æ®ä½¿ç”¨æ¨¡å¼ä¼˜åŒ–æ€§èƒ½
- âœ… **è‡ªåŠ¨ç›‘æ§**ï¼šå‘ç°æ½œåœ¨çš„èµ„æºæ³„éœ²é—®é¢˜

---

## 6. ğŸ’¾ ç¼“å­˜ä»£ç†è®¾è®¡


### 6.1 ç¼“å­˜ä»£ç†çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç¼“å­˜ä»£ç†**ï¼šåœ¨çœŸå®å¯¹è±¡å‰åŠ ä¸€å±‚ç¼“å­˜çš„"è®°å¿†åŠ©æ‰‹"

```
æ²¡æœ‰ç¼“å­˜ï¼š
æ¯æ¬¡è¯·æ±‚ â†’ ç›´æ¥è®¿é—®æ•°æ®æº â†’ è¿”å›ç»“æœï¼ˆæ¯æ¬¡éƒ½å¾ˆæ…¢ï¼‰

æœ‰äº†ç¼“å­˜ä»£ç†ï¼š
ç¬¬ä¸€æ¬¡è¯·æ±‚ â†’ è®¿é—®æ•°æ®æº â†’ ç¼“å­˜ç»“æœ â†’ è¿”å›ç»“æœ
åç»­è¯·æ±‚ â†’ ç›´æ¥ä»ç¼“å­˜è·å– â†’ è¿”å›ç»“æœï¼ˆå¾ˆå¿«ï¼‰
```

### 6.2 ç¼“å­˜ä»£ç†çš„åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨**ï¼š
```
ğŸ”¸ æ•°æ®åº“æŸ¥è¯¢ï¼šç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ
ğŸ”¸ ç½‘ç»œè¯·æ±‚ï¼šç¼“å­˜APIè°ƒç”¨ç»“æœ
ğŸ”¸ æ–‡ä»¶è¯»å–ï¼šç¼“å­˜æ–‡ä»¶å†…å®¹
ğŸ”¸ è®¡ç®—ç»“æœï¼šç¼“å­˜å¤æ‚è®¡ç®—çš„ç»“æœ
```

### 6.3 æ•°æ®æŸ¥è¯¢ç¼“å­˜ä»£ç†ç¤ºä¾‹


**æ•°æ®æœåŠ¡æ¥å£**ï¼š
```java
// æ•°æ®æœåŠ¡æ¥å£
public interface DataService {
    String getData(String key);
    List<String> getDataList(String category);
    void clearCache();
}
```

**çœŸå®æ•°æ®æœåŠ¡**ï¼š
```java
// çœŸå®æ•°æ®æœåŠ¡ï¼ˆè®¿é—®æ•°æ®åº“ï¼‰
public class RealDataService implements DataService {
    
    @Override
    public String getData(String key) {
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢è€—æ—¶
        System.out.println("ä»æ•°æ®åº“æŸ¥è¯¢: " + key);
        try {
            Thread.sleep(1000); // æ¨¡æ‹Ÿ1ç§’æŸ¥è¯¢æ—¶é—´
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return "æ•°æ®å†…å®¹-" + key;
    }
    
    @Override
    public List<String> getDataList(String category) {
        System.out.println("ä»æ•°æ®åº“æŸ¥è¯¢åˆ—è¡¨: " + category);
        try {
            Thread.sleep(1500); // æ¨¡æ‹Ÿ1.5ç§’æŸ¥è¯¢æ—¶é—´
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return Arrays.asList("æ•°æ®1", "æ•°æ®2", "æ•°æ®3");
    }
}
```

**ç¼“å­˜ä»£ç†ç±»**ï¼š
```java
// æ•°æ®æœåŠ¡ç¼“å­˜ä»£ç†
public class CacheDataServiceProxy implements DataService {
    private RealDataService realService;
    private Map<String, Object> cache; // ç¼“å­˜å­˜å‚¨
    private Map<String, Long> cacheTime; // ç¼“å­˜æ—¶é—´
    private long cacheTimeout = 5 * 60 * 1000; // 5åˆ†é’Ÿè¶…æ—¶
    
    public CacheDataServiceProxy() {
        this.realService = new RealDataService();
        this.cache = new HashMap<>();
        this.cacheTime = new HashMap<>();
    }
    
    @Override
    public String getData(String key) {
        // æ£€æŸ¥ç¼“å­˜
        if (isValidCache(key)) {
            System.out.println("ä»ç¼“å­˜è·å–: " + key);
            return (String) cache.get(key);
        }
        
        // ç¼“å­˜missï¼Œä»çœŸå®æœåŠ¡è·å–
        String result = realService.getData(key);
        
        // å­˜å…¥ç¼“å­˜
        cache.put(key, result);
        cacheTime.put(key, System.currentTimeMillis());
        System.out.println("æ•°æ®å·²ç¼“å­˜: " + key);
        
        return result;
    }
    
    @Override
    public List<String> getDataList(String category) {
        String cacheKey = "list_" + category;
        
        if (isValidCache(cacheKey)) {
            System.out.println("ä»ç¼“å­˜è·å–åˆ—è¡¨: " + category);
            return (List<String>) cache.get(cacheKey);
        }
        
        List<String> result = realService.getDataList(category);
        
        // å­˜å…¥ç¼“å­˜
        cache.put(cacheKey, result);
        cacheTime.put(cacheKey, System.currentTimeMillis());
        System.out.println("åˆ—è¡¨å·²ç¼“å­˜: " + category);
        
        return result;
    }
    
    // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
    private boolean isValidCache(String key) {
        if (!cache.containsKey(key)) {
            return false; // ç¼“å­˜ä¸å­˜åœ¨
        }
        
        long cachedTime = cacheTime.get(key);
        long currentTime = System.currentTimeMillis();
        
        if (currentTime - cachedTime > cacheTimeout) {
            // ç¼“å­˜è¶…æ—¶ï¼Œæ¸…ç†
            cache.remove(key);
            cacheTime.remove(key);
            System.out.println("ç¼“å­˜å·²è¿‡æœŸ: " + key);
            return false;
        }
        
        return true; // ç¼“å­˜æœ‰æ•ˆ
    }
    
    @Override
    public void clearCache() {
        cache.clear();
        cacheTime.clear();
        System.out.println("ç¼“å­˜å·²æ¸…ç©º");
    }
    
    // è·å–ç¼“å­˜ç»Ÿè®¡
    public void printCacheStats() {
        System.out.println("=== ç¼“å­˜ç»Ÿè®¡ ===");
        System.out.println("ç¼“å­˜é¡¹æ•°é‡: " + cache.size());
        System.out.println("ç¼“å­˜é”®åˆ—è¡¨: " + cache.keySet());
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class CacheProxyDemo {
    public static void main(String[] args) {
        CacheDataServiceProxy dataService = new CacheDataServiceProxy();
        
        System.out.println("=== ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ˆä»æ•°æ®åº“ï¼‰ ===");
        long start1 = System.currentTimeMillis();
        String result1 = dataService.getData("user_123");
        long end1 = System.currentTimeMillis();
        System.out.println("ç»“æœ: " + result1);
        System.out.println("è€—æ—¶: " + (end1 - start1) + "ms");
        
        System.out.println("\n=== ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ˆä»ç¼“å­˜ï¼‰ ===");
        long start2 = System.currentTimeMillis();
        String result2 = dataService.getData("user_123");
        long end2 = System.currentTimeMillis();
        System.out.println("ç»“æœ: " + result2);
        System.out.println("è€—æ—¶: " + (end2 - start2) + "ms");
        
        // æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
        dataService.printCacheStats();
    }
}
```

### 6.4 ç¼“å­˜ä»£ç†çš„æ€§èƒ½ä¼˜åŠ¿


**æ€§èƒ½æå‡æ•ˆæœ**ï¼š
```
ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š1000msï¼ˆæ•°æ®åº“æŸ¥è¯¢ï¼‰
åç»­æŸ¥è¯¢ï¼š1-5msï¼ˆå†…å­˜ç¼“å­˜ï¼‰
æ€§èƒ½æå‡ï¼š200-1000å€

å†…å­˜ä½¿ç”¨ï¼šé€‚ä¸­ï¼ˆåªç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼‰
å‘½ä¸­ç‡ï¼šé€šå¸¸å¯è¾¾80-95%
```

### 6.5 ç¼“å­˜ç­–ç•¥ä¼˜åŒ–


**å¸¸ç”¨ç¼“å­˜ç­–ç•¥**ï¼š
```
ğŸ”¸ LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ï¼šæ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®
ğŸ”¸ TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ï¼šè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´
ğŸ”¸ LFUï¼ˆæœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼‰ï¼šæ·˜æ±°ä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ•°æ®
ğŸ”¸ åˆ†å±‚ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜ + åˆ†å¸ƒå¼ç¼“å­˜
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 äº”ç§ä»£ç†åº”ç”¨å¯¹æ¯”


| ä»£ç†ç±»å‹ | **ä¸»è¦ç›®çš„** | **ä½¿ç”¨æ—¶æœº** | **æ€§èƒ½å½±å“** | **å¤æ‚åº¦** |
|---------|------------|-------------|-------------|-----------|
| ğŸŒ **è¿œç¨‹ä»£ç†** | `ç®€åŒ–è¿œç¨‹è°ƒç”¨` | `åˆ†å¸ƒå¼ç³»ç»Ÿ` | `ç½‘ç»œå»¶è¿Ÿ` | `ä¸­ç­‰` |
| â° **è™šæ‹Ÿä»£ç†** | `å»¶è¿Ÿåˆ›å»ºå¯¹è±¡` | `èµ„æºæ˜‚è´µ` | `æ˜¾è‘—æå‡` | `ç®€å•` |
| ğŸ”’ **ä¿æŠ¤ä»£ç†** | `æ§åˆ¶è®¿é—®æƒé™` | `å®‰å…¨è¦æ±‚` | `è½»å¾®å½±å“` | `ç®€å•` |
| ğŸ§  **æ™ºèƒ½å¼•ç”¨** | `è‡ªåŠ¨èµ„æºç®¡ç†` | `å¤æ‚ç”Ÿå‘½å‘¨æœŸ` | `ä¼˜åŒ–ç®¡ç†` | `å¤æ‚` |
| ğŸ’¾ **ç¼“å­˜ä»£ç†** | `æå‡è®¿é—®é€Ÿåº¦` | `é¢‘ç¹é‡å¤è®¿é—®` | `æ˜¾è‘—æå‡` | `ä¸­ç­‰` |

### 7.2 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä»£ç†çš„æœ¬è´¨ï¼šä¸æ”¹å˜åŸå¯¹è±¡ï¼Œå¢åŠ é¢å¤–åŠŸèƒ½çš„ä¸­é—´å±‚
ğŸ”¸ é€æ˜æ€§åŸåˆ™ï¼šå®¢æˆ·ç«¯æ— æ„ŸçŸ¥ï¼Œæ¥å£ä¿æŒä¸€è‡´
ğŸ”¸ å»¶è¿Ÿåˆå§‹åŒ–ï¼šæ¨è¿Ÿèµ„æºåˆ›å»ºåˆ°çœŸæ­£éœ€è¦çš„æ—¶å€™
ğŸ”¸ æƒé™æ§åˆ¶ï¼šåœ¨ä»£ç†å±‚ç»Ÿä¸€å¤„ç†å®‰å…¨ç­–ç•¥
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡ç¼“å­˜ç­‰æ‰‹æ®µæå‡ç³»ç»Ÿæ€§èƒ½
```

### 7.3 å®é™…åº”ç”¨é€‰æ‹©æŒ‡å—


**é€‰æ‹©æ ‡å‡†**ï¼š
```
éœ€è¦è¿œç¨‹è®¿é—® â†’ ä½¿ç”¨è¿œç¨‹ä»£ç†
èµ„æºåˆ›å»ºæ˜‚è´µ â†’ ä½¿ç”¨è™šæ‹Ÿä»£ç†
éœ€è¦æƒé™æ§åˆ¶ â†’ ä½¿ç”¨ä¿æŠ¤ä»£ç†
èµ„æºç®¡ç†å¤æ‚ â†’ ä½¿ç”¨æ™ºèƒ½å¼•ç”¨ä»£ç†
è®¿é—®é¢‘ç¹é‡å¤ â†’ ä½¿ç”¨ç¼“å­˜ä»£ç†

å¤šç§éœ€æ±‚ â†’ å¯ä»¥ç»„åˆä½¿ç”¨å¤šç§ä»£ç†
```

### 7.4 ä»£ç†æ¨¡å¼çš„å…³é”®ä¼˜åŠ¿


**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… **åŠŸèƒ½å¢å¼º**ï¼šåœ¨ä¸ä¿®æ”¹åŸå¯¹è±¡çš„åŸºç¡€ä¸Šå¢åŠ åŠŸèƒ½
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡ç¼“å­˜ã€å»¶è¿ŸåŠ è½½ç­‰æ‰‹æ®µæå‡æ€§èƒ½
- âœ… **å®‰å…¨æ§åˆ¶**ï¼šç»Ÿä¸€çš„æƒé™æ£€æŸ¥å’Œè®¿é—®æ§åˆ¶
- âœ… **èµ„æºç®¡ç†**ï¼šæ™ºèƒ½çš„èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… **ç³»ç»Ÿè§£è€¦**ï¼šå®¢æˆ·ç«¯ä¸çœŸå®å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆ

### 7.5 å®é™…é¡¹ç›®åº”ç”¨å»ºè®®


**æœ€ä½³å®è·µ**ï¼š
```
ğŸ”¸ æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ä»£ç†ç±»å‹
ğŸ”¸ æ³¨æ„ä»£ç†å±‚ä¸è¦è¿‡åº¦å¤æ‚åŒ–
ğŸ”¸ ç¼“å­˜ä»£ç†è¦è€ƒè™‘å†…å­˜ä½¿ç”¨å’Œè¿‡æœŸç­–ç•¥
ğŸ”¸ æƒé™ä»£ç†è¦ç¡®ä¿å®‰å…¨ç­–ç•¥çš„å®Œæ•´æ€§
ğŸ”¸ å¯ä»¥å°†å¤šç§ä»£ç†æ¨¡å¼ç»„åˆä½¿ç”¨
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ä»£ç†æ¨¡å¼æ˜¯å¯¹è±¡è®¿é—®çš„"ä¸­é—´äºº"ï¼Œæä¾›é¢å¤–åŠŸèƒ½è€Œä¸æ”¹å˜åŸå¯¹è±¡
- äº”ç§ä¸»è¦åº”ç”¨ï¼šè¿œç¨‹è®¿é—®ã€å»¶è¿Ÿåˆ›å»ºã€æƒé™æ§åˆ¶ã€æ™ºèƒ½ç®¡ç†ã€ç¼“å­˜ä¼˜åŒ–
- å…³é”®åœ¨äºé€‰æ‹©åˆé€‚çš„ä»£ç†ç±»å‹è§£å†³å…·ä½“é—®é¢˜
- ä»£ç†çš„é€æ˜æ€§è®©å®¢æˆ·ç«¯ä½¿ç”¨èµ·æ¥å°±åƒç›´æ¥è®¿é—®åŸå¯¹è±¡ä¸€æ ·ç®€å•