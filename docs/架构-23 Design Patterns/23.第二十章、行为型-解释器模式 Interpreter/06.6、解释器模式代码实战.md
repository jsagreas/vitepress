---
title: 6ã€è§£é‡Šå™¨æ¨¡å¼ä»£ç å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [è§£é‡Šå™¨æ¨¡å¼æ ¸å¿ƒç†è§£](#1-è§£é‡Šå™¨æ¨¡å¼æ ¸å¿ƒç†è§£)
2. [åŸºç¡€ä»£ç æ¡†æ¶](#2-åŸºç¡€ä»£ç æ¡†æ¶)
3. [æ•°å­¦è¡¨è¾¾å¼è§£æå™¨](#3-æ•°å­¦è¡¨è¾¾å¼è§£æå™¨)
4. [ç®€å•è„šæœ¬è§£é‡Šå™¨](#4-ç®€å•è„šæœ¬è§£é‡Šå™¨)
5. [é…ç½®è§£æå™¨å®ç°](#5-é…ç½®è§£æå™¨å®ç°)
6. [æ€§èƒ½æµ‹è¯•å¯¹æ¯”](#6-æ€§èƒ½æµ‹è¯•å¯¹æ¯”)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è§£é‡Šå™¨æ¨¡å¼æ ¸å¿ƒç†è§£


### 1.1 ä»€ä¹ˆæ˜¯è§£é‡Šå™¨æ¨¡å¼

**é€šä¿—ç†è§£**ï¼šè§£é‡Šå™¨æ¨¡å¼å°±åƒæ˜¯ä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼Œå®ƒèƒ½æŠŠäººç±»å®¹æ˜“ç†è§£çš„è¯­è¨€ï¼ˆæ¯”å¦‚æ•°å­¦å…¬å¼ã€é…ç½®è¯­å¥ï¼‰ç¿»è¯‘æˆè®¡ç®—æœºèƒ½æ‰§è¡Œçš„æ“ä½œã€‚

```
ç°å®ç”Ÿæ´»ä¸­çš„è§£é‡Šå™¨ï¼š
äººç±»è¯­è¨€: "ä»Šå¤©å¤©æ°”çœŸå¥½"
ç¿»è¯‘å®˜ â†’ è‹±è¯­: "The weather is really nice today"

ç¼–ç¨‹ä¸­çš„è§£é‡Šå™¨ï¼š
ç”¨æˆ·è¾“å…¥: "2 + 3 * 4"  
è§£é‡Šå™¨ â†’ è®¡ç®—ç»“æœ: 14
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è§£é‡Šå™¨æ¨¡å¼

**è§£å†³çš„é—®é¢˜**ï¼š
- ğŸ”¸ è®©ç”¨æˆ·ç”¨ç®€å•çš„è¯­è¨€è¡¨è¾¾å¤æ‚çš„é€»è¾‘
- ğŸ”¸ æŠŠæ–‡æœ¬æŒ‡ä»¤è½¬æ¢æˆç¨‹åºèƒ½ç†è§£çš„æ“ä½œ
- ğŸ”¸ æä¾›ä¸€ç§çµæ´»çš„é…ç½®å’Œè„šæœ¬æœºåˆ¶

**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
ğŸ“Š æ•°å­¦è®¡ç®—å™¨ï¼šè¾“å…¥ "1+2*3"ï¼Œè¾“å‡ºç»“æœ 7
âš™ï¸ é…ç½®æ–‡ä»¶ï¼šdatabase.host = localhost
ğŸ” æœç´¢è¯­æ³•ï¼šname="å¼ ä¸‰" AND age>25
ğŸ“ æ¨¡æ¿å¼•æ“ï¼šHello {{username}}ï¼Œæ¬¢è¿å›æ¥ï¼
```

### 1.3 è§£é‡Šå™¨æ¨¡å¼çš„å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥æ–‡æœ¬
      â†“
   è¯æ³•åˆ†æ (æŠŠæ–‡æœ¬åˆ‡åˆ†æˆå•è¯)
      â†“  
   è¯­æ³•åˆ†æ (ç†è§£å•è¯é—´çš„å…³ç³»)
      â†“
   æ„å»ºè¯­æ³•æ ‘ (ç”¨æ ‘ç»“æ„è¡¨ç¤ºå«ä¹‰)
      â†“
   æ‰§è¡Œè§£é‡Š (éå†æ ‘å¹¶è®¡ç®—ç»“æœ)
      â†“
   è¿”å›ç»“æœ
```

---

## 2. ğŸ—ï¸ åŸºç¡€ä»£ç æ¡†æ¶


### 2.1 æŠ½è±¡è¡¨è¾¾å¼æ¥å£

**æ ¸å¿ƒæ€æƒ³**ï¼šæ‰€æœ‰çš„è¡¨è¾¾å¼éƒ½èƒ½è¢«"è§£é‡Š"æ‰§è¡Œ

```java
/**
 * æŠ½è±¡è¡¨è¾¾å¼ - è§£é‡Šå™¨çš„æ ¸å¿ƒæ¥å£
 * å°±åƒæ˜¯ä¸€ä¸ªé€šç”¨çš„"ç¿»è¯‘è§„åˆ™"
 */
public interface Expression {
    /**
     * è§£é‡Šæ–¹æ³• - æŠŠè¡¨è¾¾å¼è½¬æ¢æˆå…·ä½“çš„å€¼
     * @param context ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆå­˜å‚¨å˜é‡å€¼ç­‰ï¼‰
     * @return è§£é‡Šåçš„ç»“æœ
     */
    int interpret(Context context);
}
```

### 2.2 ä¸Šä¸‹æ–‡ç¯å¢ƒç±»

**ä½œç”¨**ï¼šå­˜å‚¨è§£é‡Šè¿‡ç¨‹ä¸­éœ€è¦çš„å˜é‡å’ŒçŠ¶æ€

```java
/**
 * ä¸Šä¸‹æ–‡ - è§£é‡Šå™¨çš„"è®°å¿†"
 * å°±åƒè®¡ç®—å™¨çš„å­˜å‚¨å™¨ï¼Œè®°ä½å˜é‡çš„å€¼
 */
public class Context {
    private Map<String, Integer> variables = new HashMap<>();
    
    // è®¾ç½®å˜é‡å€¼
    public void setVariable(String name, int value) {
        variables.put(name, value);
    }
    
    // è·å–å˜é‡å€¼
    public int getVariable(String name) {
        return variables.getOrDefault(name, 0);
    }
}
```

### 2.3 ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰

**å«ä¹‰**ï¼šä¸èƒ½å†ç»†åˆ†çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚æ•°å­—ã€å˜é‡

```java
// æ•°å­—è¡¨è¾¾å¼ - è¡¨ç¤ºå…·ä½“çš„æ•°å€¼
public class NumberExpression implements Expression {
    private int number;
    
    public NumberExpression(int number) {
        this.number = number;
    }
    
    @Override
    public int interpret(Context context) {
        return number;  // æ•°å­—ç›´æ¥è¿”å›è‡ªå·±çš„å€¼
    }
}

// å˜é‡è¡¨è¾¾å¼ - è¡¨ç¤ºä¸€ä¸ªå˜é‡
public class VariableExpression implements Expression {
    private String variableName;
    
    public VariableExpression(String variableName) {
        this.variableName = variableName;
    }
    
    @Override
    public int interpret(Context context) {
        return context.getVariable(variableName);  // ä»ä¸Šä¸‹æ–‡è·å–å˜é‡å€¼
    }
}
```

### 2.4 éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆåˆ†æ”¯èŠ‚ç‚¹ï¼‰

**å«ä¹‰**ï¼šåŒ…å«å…¶ä»–è¡¨è¾¾å¼çš„å¤åˆè¡¨è¾¾å¼ï¼Œæ¯”å¦‚åŠ æ³•ã€ä¹˜æ³•

```java
// åŠ æ³•è¡¨è¾¾å¼ - è¡¨ç¤ºä¸¤ä¸ªè¡¨è¾¾å¼ç›¸åŠ 
public class AddExpression implements Expression {
    private Expression left;   // å·¦è¾¹çš„è¡¨è¾¾å¼
    private Expression right;  // å³è¾¹çš„è¡¨è¾¾å¼
    
    public AddExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }
    
    @Override
    public int interpret(Context context) {
        // å…ˆè§£é‡Šå·¦å³ä¸¤è¾¹ï¼Œå†æŠŠç»“æœç›¸åŠ 
        return left.interpret(context) + right.interpret(context);
    }
}

// ä¹˜æ³•è¡¨è¾¾å¼ - è¡¨ç¤ºä¸¤ä¸ªè¡¨è¾¾å¼ç›¸ä¹˜  
public class MultiplyExpression implements Expression {
    private Expression left;
    private Expression right;
    
    public MultiplyExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }
    
    @Override
    public int interpret(Context context) {
        return left.interpret(context) * right.interpret(context);
    }
}
```

---

## 3. ğŸ§® æ•°å­¦è¡¨è¾¾å¼è§£æå™¨


### 3.1 è¡¨è¾¾å¼è§£æå™¨

**åŠŸèƒ½**ï¼šæŠŠå­—ç¬¦ä¸²"1+2*3"è½¬æ¢æˆå¯æ‰§è¡Œçš„è¡¨è¾¾å¼æ ‘

```java
/**
 * æ•°å­¦è¡¨è¾¾å¼è§£æå™¨
 * å°±åƒæ˜¯ä¸€ä¸ªæ•°å­¦è€å¸ˆï¼Œèƒ½ç†è§£å„ç§æ•°å­¦è¡¨è¾¾å¼
 */
public class MathExpressionParser {
    
    /**
     * è§£ææ•°å­¦è¡¨è¾¾å¼å­—ç¬¦ä¸²
     * ä¾‹å¦‚ï¼š"1 + 2 * 3" â†’ è¡¨è¾¾å¼æ ‘
     */
    public Expression parse(String expression) {
        // å»é™¤ç©ºæ ¼ï¼Œæ–¹ä¾¿å¤„ç†
        expression = expression.replaceAll("\\s+", "");
        
        // ç®€å•çš„é€’å½’ä¸‹é™è§£æ
        return parseAddition(expression, new int[]{0});
    }
    
    // è§£æåŠ æ³•ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰
    private Expression parseAddition(String expr, int[] pos) {
        Expression left = parseMultiplication(expr, pos);
        
        while (pos[0] < expr.length() && expr.charAt(pos[0]) == '+') {
            pos[0]++; // è·³è¿‡'+'
            Expression right = parseMultiplication(expr, pos);
            left = new AddExpression(left, right);
        }
        
        return left;
    }
    
    // è§£æä¹˜æ³•ï¼ˆä¼˜å…ˆçº§è¾ƒé«˜ï¼‰
    private Expression parseMultiplication(String expr, int[] pos) {
        Expression left = parseNumber(expr, pos);
        
        while (pos[0] < expr.length() && expr.charAt(pos[0]) == '*') {
            pos[0]++; // è·³è¿‡'*'
            Expression right = parseNumber(expr, pos);
            left = new MultiplyExpression(left, right);
        }
        
        return left;
    }
    
    // è§£ææ•°å­—
    private Expression parseNumber(String expr, int[] pos) {
        int start = pos[0];
        while (pos[0] < expr.length() && Character.isDigit(expr.charAt(pos[0]))) {
            pos[0]++;
        }
        
        int number = Integer.parseInt(expr.substring(start, pos[0]));
        return new NumberExpression(number);
    }
}
```

### 3.2 æ•°å­¦è®¡ç®—å™¨ä½¿ç”¨ç¤ºä¾‹

```java
public class MathCalculatorDemo {
    public static void main(String[] args) {
        // åˆ›å»ºè§£æå™¨å’Œä¸Šä¸‹æ–‡
        MathExpressionParser parser = new MathExpressionParser();
        Context context = new Context();
        
        // æµ‹è¯•å„ç§æ•°å­¦è¡¨è¾¾å¼
        String[] expressions = {
            "1 + 2",           // æœŸæœ›ç»“æœï¼š3
            "2 * 3",           // æœŸæœ›ç»“æœï¼š6  
            "1 + 2 * 3",       // æœŸæœ›ç»“æœï¼š7 (ä¹˜æ³•ä¼˜å…ˆ)
            "10 + 5 * 2"       // æœŸæœ›ç»“æœï¼š20
        };
        
        for (String expr : expressions) {
            Expression expression = parser.parse(expr);
            int result = expression.interpret(context);
            System.out.println(expr + " = " + result);
        }
    }
}
```

**è¾“å‡ºç»“æœ**ï¼š
```
1 + 2 = 3
2 * 3 = 6
1 + 2 * 3 = 7
10 + 5 * 2 = 20
```

---

## 4. ğŸ“ ç®€å•è„šæœ¬è§£é‡Šå™¨


### 4.1 è„šæœ¬è¯­è¨€å®šä¹‰

æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç®€å•çš„è„šæœ¬è¯­è¨€ï¼Œæ”¯æŒï¼š
- å˜é‡èµ‹å€¼ï¼š`set x 10`
- å˜é‡è¾“å‡ºï¼š`print x`
- æ•°å­¦è¿ç®—ï¼š`add x 5`

### 4.2 è„šæœ¬æŒ‡ä»¤è¡¨è¾¾å¼

```java
// èµ‹å€¼æŒ‡ä»¤ï¼šset å˜é‡å å€¼
public class SetCommand implements Expression {
    private String variableName;
    private int value;
    
    public SetCommand(String variableName, int value) {
        this.variableName = variableName;
        this.value = value;
    }
    
    @Override
    public int interpret(Context context) {
        context.setVariable(variableName, value);
        return value;  // è¿”å›è®¾ç½®çš„å€¼
    }
}

// æ‰“å°æŒ‡ä»¤ï¼šprint å˜é‡å
public class PrintCommand implements Expression {
    private String variableName;
    
    public PrintCommand(String variableName) {
        this.variableName = variableName;
    }
    
    @Override
    public int interpret(Context context) {
        int value = context.getVariable(variableName);
        System.out.println(variableName + " = " + value);
        return value;
    }
}

// åŠ æ³•æŒ‡ä»¤ï¼šadd å˜é‡å å¢åŠ å€¼
public class AddCommand implements Expression {
    private String variableName;
    private int addValue;
    
    public AddCommand(String variableName, int addValue) {
        this.variableName = variableName;
        this.addValue = addValue;
    }
    
    @Override
    public int interpret(Context context) {
        int currentValue = context.getVariable(variableName);
        int newValue = currentValue + addValue;
        context.setVariable(variableName, newValue);
        return newValue;
    }
}
```

### 4.3 è„šæœ¬è§£æå™¨

```java
/**
 * ç®€å•è„šæœ¬è§£æå™¨
 * èƒ½ç†è§£setã€printã€addç­‰ç®€å•æŒ‡ä»¤
 */
public class ScriptParser {
    
    public Expression parseCommand(String command) {
        String[] parts = command.trim().split("\\s+");
        
        if (parts.length == 0) {
            throw new IllegalArgumentException("ç©ºæŒ‡ä»¤");
        }
        
        String instruction = parts[0].toLowerCase();
        
        switch (instruction) {
            case "set":
                if (parts.length != 3) {
                    throw new IllegalArgumentException("setæŒ‡ä»¤æ ¼å¼ï¼šset å˜é‡å å€¼");
                }
                return new SetCommand(parts[1], Integer.parseInt(parts[2]));
                
            case "print":
                if (parts.length != 2) {
                    throw new IllegalArgumentException("printæŒ‡ä»¤æ ¼å¼ï¼šprint å˜é‡å");
                }
                return new PrintCommand(parts[1]);
                
            case "add":
                if (parts.length != 3) {
                    throw new IllegalArgumentException("addæŒ‡ä»¤æ ¼å¼ï¼šadd å˜é‡å å¢åŠ å€¼");
                }
                return new AddCommand(parts[1], Integer.parseInt(parts[2]));
                
            default:
                throw new IllegalArgumentException("æœªçŸ¥æŒ‡ä»¤ï¼š" + instruction);
        }
    }
    
    // æ‰§è¡Œå¤šè¡Œè„šæœ¬
    public void executeScript(String script) {
        String[] lines = script.split("\n");
        Context context = new Context();
        
        for (String line : lines) {
            line = line.trim();
            if (!line.isEmpty() && !line.startsWith("#")) {  // å¿½ç•¥ç©ºè¡Œå’Œæ³¨é‡Š
                try {
                    Expression command = parseCommand(line);
                    command.interpret(context);
                } catch (Exception e) {
                    System.err.println("æ‰§è¡Œé”™è¯¯ [" + line + "]: " + e.getMessage());
                }
            }
        }
    }
}
```

### 4.4 è„šæœ¬æ‰§è¡Œç¤ºä¾‹

```java
public class ScriptDemo {
    public static void main(String[] args) {
        ScriptParser parser = new ScriptParser();
        
        String script = """
            # è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è„šæœ¬ç¤ºä¾‹
            set x 10
            print x
            add x 5
            print x
            set y 3
            add y 7
            print y
            """;
        
        System.out.println("æ‰§è¡Œè„šæœ¬ï¼š");
        parser.executeScript(script);
    }
}
```

**è¾“å‡ºç»“æœ**ï¼š
```
æ‰§è¡Œè„šæœ¬ï¼š
x = 10
x = 15
y = 10
```

---

## 5. âš™ï¸ é…ç½®è§£æå™¨å®ç°


### 5.1 é…ç½®è¯­æ³•è®¾è®¡

æ”¯æŒç®€å•çš„é…ç½®è¯­æ³•ï¼š
- é”®å€¼å¯¹ï¼š`database.host = localhost`
- æ•°ç»„ï¼š`servers = [web1, web2, web3]`
- æ•°å­—ï¼š`port = 8080`

### 5.2 é…ç½®è¡¨è¾¾å¼ç±»

```java
// é…ç½®é¡¹è¡¨è¾¾å¼
public class ConfigItem {
    private String key;
    private Object value;
    
    public ConfigItem(String key, Object value) {
        this.key = key;
        this.value = value;
    }
    
    // Getters
    public String getKey() { return key; }
    public Object getValue() { return value; }
}

// é…ç½®è§£æå™¨
public class ConfigParser {
    private Map<String, Object> config = new HashMap<>();
    
    /**
     * è§£æé…ç½®è¡Œ
     * ä¾‹å¦‚ï¼šdatabase.host = localhost
     */
    public ConfigItem parseConfigLine(String line) {
        line = line.trim();
        
        // å¿½ç•¥æ³¨é‡Šå’Œç©ºè¡Œ
        if (line.isEmpty() || line.startsWith("#")) {
            return null;
        }
        
        // æŸ¥æ‰¾ç­‰å·
        int equalIndex = line.indexOf('=');
        if (equalIndex == -1) {
            throw new IllegalArgumentException("é…ç½®æ ¼å¼é”™è¯¯ï¼Œç¼ºå°‘ç­‰å·ï¼š" + line);
        }
        
        String key = line.substring(0, equalIndex).trim();
        String valueStr = line.substring(equalIndex + 1).trim();
        
        Object value = parseValue(valueStr);
        
        return new ConfigItem(key, value);
    }
    
    /**
     * è§£æé…ç½®å€¼ï¼Œæ”¯æŒå­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„
     */
    private Object parseValue(String valueStr) {
        // æ•°ç»„æ ¼å¼ï¼š[item1, item2, item3]
        if (valueStr.startsWith("[") && valueStr.endsWith("]")) {
            String arrayContent = valueStr.substring(1, valueStr.length() - 1);
            if (arrayContent.trim().isEmpty()) {
                return new String[0];  // ç©ºæ•°ç»„
            }
            
            String[] items = arrayContent.split(",");
            for (int i = 0; i < items.length; i++) {
                items[i] = items[i].trim();
            }
            return items;
        }
        
        // æ•°å­—æ ¼å¼
        try {
            return Integer.parseInt(valueStr);
        } catch (NumberFormatException e) {
            // ä¸æ˜¯æ•°å­—ï¼Œå½“ä½œå­—ç¬¦ä¸²å¤„ç†
        }
        
        // å­—ç¬¦ä¸²æ ¼å¼ï¼ˆå»æ‰å¼•å·ï¼‰
        if ((valueStr.startsWith("\"") && valueStr.endsWith("\"")) ||
            (valueStr.startsWith("'") && valueStr.endsWith("'"))) {
            return valueStr.substring(1, valueStr.length() - 1);
        }
        
        return valueStr;  // æ™®é€šå­—ç¬¦ä¸²
    }
    
    /**
     * è§£ææ•´ä¸ªé…ç½®æ–‡ä»¶
     */
    public Map<String, Object> parseConfig(String configText) {
        String[] lines = configText.split("\n");
        
        for (String line : lines) {
            ConfigItem item = parseConfigLine(line);
            if (item != null) {
                config.put(item.getKey(), item.getValue());
            }
        }
        
        return new HashMap<>(config);
    }
}
```

### 5.3 é…ç½®è§£æç¤ºä¾‹

```java
public class ConfigDemo {
    public static void main(String[] args) {
        ConfigParser parser = new ConfigParser();
        
        String configText = """
            # æ•°æ®åº“é…ç½®
            database.host = localhost
            database.port = 3306
            database.name = "myapp"
            
            # æœåŠ¡å™¨é…ç½®
            servers = [web1, web2, web3]
            max.connections = 100
            
            # åŠŸèƒ½å¼€å…³
            debug.enabled = true
            """;
        
        System.out.println("è§£æé…ç½®æ–‡ä»¶ï¼š");
        Map<String, Object> config = parser.parseConfig(configText);
        
        // è¾“å‡ºè§£æç»“æœ
        for (Map.Entry<String, Object> entry : config.entrySet()) {
            String key = entry.getKey();
            Object value = entry.getValue();
            
            if (value instanceof String[]) {
                System.out.println(key + " = " + Arrays.toString((String[]) value));
            } else {
                System.out.println(key + " = " + value + " (" + value.getClass().getSimpleName() + ")");
            }
        }
    }
}
```

**è¾“å‡ºç»“æœ**ï¼š
```
è§£æé…ç½®æ–‡ä»¶ï¼š
database.host = localhost (String)
database.port = 3306 (Integer)
database.name = myapp (String)
servers = [web1, web2, web3]
max.connections = 100 (Integer)
debug.enabled = true (String)
```

---

## 6. ğŸ“Š æ€§èƒ½æµ‹è¯•å¯¹æ¯”


### 6.1 æ€§èƒ½æµ‹è¯•è®¾è®¡

æˆ‘ä»¬æ¯”è¾ƒä¸‰ç§ä¸åŒçš„æ•°å­¦è¡¨è¾¾å¼è®¡ç®—æ–¹å¼ï¼š

```java
public class PerformanceTest {
    private static final int TEST_ITERATIONS = 100000;
    
    public static void main(String[] args) {
        String expression = "1 + 2 * 3 + 4 * 5";
        
        System.out.println("è¡¨è¾¾å¼ï¼š" + expression);
        System.out.println("æµ‹è¯•æ¬¡æ•°ï¼š" + TEST_ITERATIONS);
        System.out.println();
        
        // 1. è§£é‡Šå™¨æ¨¡å¼
        testInterpreterPattern(expression);
        
        // 2. ç›´æ¥è®¡ç®—
        testDirectCalculation();
        
        // 3. JavaScriptå¼•æ“
        testJavaScriptEngine(expression);
    }
    
    /**
     * æµ‹è¯•è§£é‡Šå™¨æ¨¡å¼æ€§èƒ½
     */
    private static void testInterpreterPattern(String expr) {
        MathExpressionParser parser = new MathExpressionParser();
        Context context = new Context();
        
        long startTime = System.currentTimeMillis();
        
        // è§£æä¸€æ¬¡ï¼Œæ‰§è¡Œå¤šæ¬¡
        Expression expression = parser.parse(expr);
        
        for (int i = 0; i < TEST_ITERATIONS; i++) {
            int result = expression.interpret(context);
        }
        
        long endTime = System.currentTimeMillis();
        System.out.println("è§£é‡Šå™¨æ¨¡å¼è€—æ—¶ï¼š" + (endTime - startTime) + "ms");
    }
    
    /**
     * æµ‹è¯•ç›´æ¥è®¡ç®—æ€§èƒ½
     */
    private static void testDirectCalculation() {
        long startTime = System.currentTimeMillis();
        
        for (int i = 0; i < TEST_ITERATIONS; i++) {
            int result = 1 + 2 * 3 + 4 * 5;  // ç›´æ¥è®¡ç®—
        }
        
        long endTime = System.currentTimeMillis();
        System.out.println("ç›´æ¥è®¡ç®—è€—æ—¶ï¼š" + (endTime - startTime) + "ms");
    }
    
    /**
     * æµ‹è¯•JavaScriptå¼•æ“æ€§èƒ½
     */
    private static void testJavaScriptEngine(String expr) {
        try {
            ScriptEngineManager manager = new ScriptEngineManager();
            ScriptEngine engine = manager.getEngineByName("JavaScript");
            
            long startTime = System.currentTimeMillis();
            
            for (int i = 0; i < TEST_ITERATIONS; i++) {
                Object result = engine.eval(expr);
            }
            
            long endTime = System.currentTimeMillis();
            System.out.println("JavaScriptå¼•æ“è€—æ—¶ï¼š" + (endTime - startTime) + "ms");
            
        } catch (Exception e) {
            System.out.println("JavaScriptå¼•æ“æµ‹è¯•å¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```

### 6.2 æ€§èƒ½æµ‹è¯•ç»“æœåˆ†æ

**å…¸å‹æµ‹è¯•ç»“æœ**ï¼š
```
è¡¨è¾¾å¼ï¼š1 + 2 * 3 + 4 * 5
æµ‹è¯•æ¬¡æ•°ï¼š100000

è§£é‡Šå™¨æ¨¡å¼è€—æ—¶ï¼š45ms
ç›´æ¥è®¡ç®—è€—æ—¶ï¼š2ms  
JavaScriptå¼•æ“è€—æ—¶ï¼š1250ms
```

### 6.3 æ€§èƒ½å¯¹æ¯”åˆ†æè¡¨


| æ–¹æ¡ˆ | **è€—æ—¶** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|------|---------|----------|----------|-------------|
| ğŸ”§ **è§£é‡Šå™¨æ¨¡å¼** | `45ms` | `çµæ´»å¯æ‰©å±•ï¼Œæ”¯æŒåŠ¨æ€è¡¨è¾¾å¼` | `æ¯”ç›´æ¥è®¡ç®—æ…¢20å€` | `ç”¨æˆ·è‡ªå®šä¹‰å…¬å¼ï¼Œé…ç½®é©±åŠ¨` |
| âš¡ **ç›´æ¥è®¡ç®—** | `2ms` | `æ€§èƒ½æœ€ä¼˜ï¼Œç¼–è¯‘æ—¶ä¼˜åŒ–` | `ä¸æ”¯æŒåŠ¨æ€è¡¨è¾¾å¼` | `å›ºå®šè®¡ç®—é€»è¾‘` |
| ğŸŒ **JavaScriptå¼•æ“** | `1250ms` | `åŠŸèƒ½å¼ºå¤§ï¼Œè¯­æ³•ä¸°å¯Œ` | `æ€§èƒ½æœ€å·®ï¼Œèµ„æºæ¶ˆè€—å¤§` | `å¤æ‚è„šæœ¬ï¼Œå¿«é€ŸåŸå‹` |

### 6.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ’¡ è§£é‡Šå™¨æ¨¡å¼ä¼˜åŒ–ç­–ç•¥**ï¼š
```java
// 1. è¡¨è¾¾å¼ç¼“å­˜ - é¿å…é‡å¤è§£æ
public class CachedMathParser {
    private Map<String, Expression> cache = new HashMap<>();
    private MathExpressionParser parser = new MathExpressionParser();
    
    public Expression parse(String expression) {
        return cache.computeIfAbsent(expression, parser::parse);
    }
}

// 2. é¢„ç¼–è¯‘ä¼˜åŒ– - ç¼–è¯‘æ—¶è®¡ç®—å¸¸é‡
public class OptimizedExpression implements Expression {
    private Expression original;
    private Integer cachedResult;  // ç¼“å­˜å¸¸é‡è¡¨è¾¾å¼çš„ç»“æœ
    
    public OptimizedExpression(Expression original) {
        this.original = original;
        // å¦‚æœæ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œé¢„å…ˆè®¡ç®—ç»“æœ
        if (isConstant(original)) {
            this.cachedResult = original.interpret(new Context());
        }
    }
    
    @Override
    public int interpret(Context context) {
        if (cachedResult != null) {
            return cachedResult;  // ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ
        }
        return original.interpret(context);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 è§£é‡Šå™¨æ¨¡å¼çš„æœ¬è´¨ç†è§£


**ğŸ¯ æ ¸å¿ƒæ€æƒ³**ï¼š
```
è§£é‡Šå™¨æ¨¡å¼ = ç¿»è¯‘å®˜ + è¯­æ³•æ ‘
â€¢ æŠŠç”¨æˆ·å‹å¥½çš„æ–‡æœ¬è½¬æ¢æˆç¨‹åºèƒ½æ‰§è¡Œçš„æ“ä½œ
â€¢ é€šè¿‡é€’å½’ç»“æ„å¤„ç†å¤æ‚çš„åµŒå¥—è¡¨è¾¾å¼
â€¢ åˆ†ç¦»è¯­æ³•è§£æå’Œè¯­ä¹‰æ‰§è¡Œ
```

### 7.2 å®ç°è¦ç‚¹æ€»ç»“


**ğŸ”§ å…³é”®ç»„ä»¶**ï¼š
- **æŠ½è±¡è¡¨è¾¾å¼**ï¼šå®šä¹‰è§£é‡Šæ¥å£ï¼Œæ‰€æœ‰è¡¨è¾¾å¼éƒ½è¦å®ç°
- **ç»ˆç»“ç¬¦è¡¨è¾¾å¼**ï¼šå¶å­èŠ‚ç‚¹ï¼Œå¦‚æ•°å­—ã€å˜é‡
- **éç»ˆç»“ç¬¦è¡¨è¾¾å¼**ï¼šåˆ†æ”¯èŠ‚ç‚¹ï¼Œå¦‚åŠ æ³•ã€ä¹˜æ³•
- **ä¸Šä¸‹æ–‡ç¯å¢ƒ**ï¼šå­˜å‚¨è§£é‡Šè¿‡ç¨‹ä¸­çš„çŠ¶æ€å’Œå˜é‡
- **å®¢æˆ·ç«¯è§£æå™¨**ï¼šæŠŠæ–‡æœ¬è½¬æ¢æˆè¡¨è¾¾å¼æ ‘

**ğŸ“Š ä»£ç ç»“æ„å›¾**ï¼š
```
Expression (æ¥å£)
    â”œâ”€â”€ NumberExpression (æ•°å­—)
    â”œâ”€â”€ VariableExpression (å˜é‡)  
    â”œâ”€â”€ AddExpression (åŠ æ³•)
    â””â”€â”€ MultiplyExpression (ä¹˜æ³•)

Context (ä¸Šä¸‹æ–‡)
    â””â”€â”€ Map<String, Integer> variables

Parser (è§£æå™¨)
    â””â”€â”€ String â†’ Expression Tree
```

### 7.3 é€‚ç”¨åœºæ™¯åˆ¤æ–­


**âœ… é€‚åˆä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼çš„æƒ…å†µ**ï¼š
- éœ€è¦è§£æç”¨æˆ·è¾“å…¥çš„è¡¨è¾¾å¼æˆ–è„šæœ¬
- è¯­æ³•ç›¸å¯¹ç®€å•ä¸”ç¨³å®š
- éœ€è¦æ”¯æŒåŠ¨æ€è¡¨è¾¾å¼æ±‚å€¼
- é…ç½®æ–‡ä»¶è§£æå’Œæ¨¡æ¿å¼•æ“

**âŒ ä¸é€‚åˆä½¿ç”¨çš„æƒ…å†µ**ï¼š
- è¯­æ³•éå¸¸å¤æ‚ï¼ˆè€ƒè™‘ä½¿ç”¨ANTLRç­‰å·¥å…·ï¼‰
- æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
- è¯­æ³•å˜åŒ–é¢‘ç¹
- ç®€å•çš„å­—ç¬¦ä¸²æ“ä½œå°±èƒ½è§£å†³

### 7.4 å®æˆ˜å¼€å‘å»ºè®®


**ğŸ¨ è®¾è®¡å»ºè®®**ï¼š
```
1. å…ˆè®¾è®¡è¯­æ³•è§„åˆ™ï¼Œå†ç¼–å†™ä»£ç 
2. ä½¿ç”¨é€’å½’ä¸‹é™è§£æå™¨å¤„ç†ä¼˜å…ˆçº§
3. åˆç†è®¾è®¡ä¸Šä¸‹æ–‡ï¼Œé¿å…å…¨å±€çŠ¶æ€
4. è€ƒè™‘é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µ
5. é¢„ç•™æ‰©å±•ç‚¹ï¼Œä¾¿äºæ·»åŠ æ–°è¯­æ³•
```

**âš¡ æ€§èƒ½å»ºè®®**ï¼š
```
1. ç¼“å­˜è§£æç»“æœï¼Œé¿å…é‡å¤è§£æ
2. é¢„ç¼–è¯‘å¸¸é‡è¡¨è¾¾å¼
3. ä½¿ç”¨å¯¹è±¡æ± å‡å°‘GCå‹åŠ›
4. è€ƒè™‘ç¼–è¯‘æˆå­—èŠ‚ç æå‡æ€§èƒ½
```

**ğŸ” è°ƒè¯•å»ºè®®**ï¼š
```
1. å®ç°è¡¨è¾¾å¼çš„toString()æ–¹æ³•
2. æ·»åŠ è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
3. æä¾›è¯­æ³•æ ‘å¯è§†åŒ–åŠŸèƒ½
4. è®°å½•è§£é‡Šæ‰§è¡Œè¿‡ç¨‹
```

### 7.5 ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»


**ğŸ”„ ç»„åˆä½¿ç”¨**ï¼š
- **ç»„åˆæ¨¡å¼**ï¼šè¡¨è¾¾å¼æ ‘æœ¬èº«å°±æ˜¯ç»„åˆæ¨¡å¼çš„åº”ç”¨
- **è®¿é—®è€…æ¨¡å¼**ï¼šå¯ä»¥ç”¨è®¿é—®è€…æ¨¡å¼éå†è¡¨è¾¾å¼æ ‘
- **å·¥å‚æ¨¡å¼**ï¼šè§£æå™¨ä¸­åˆ›å»ºè¡¨è¾¾å¼å¯¹è±¡
- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒçš„è§£é‡Šç­–ç•¥

### 7.6 æ ¸å¿ƒè®°å¿†å£è¯€


```
ğŸ¯ è§£é‡Šå™¨æ¨¡å¼è®°å¿†æ³•ï¼š
"æ–‡æœ¬è¾“å…¥å˜æŒ‡ä»¤ï¼Œè¯­æ³•æ ‘ä¸­æ‰¾è§„å¾‹
ç»ˆç»“éç»ˆç»“åˆ†æ¸…ï¼Œä¸Šä¸‹æ–‡ä¸­å­˜çŠ¶æ€  
é€’å½’è§£æå±‚å±‚è½¬ï¼Œç¿»è¯‘æ‰§è¡Œä¸€æ¡é¾™"
```

**é‡ç‚¹ç†è§£**ï¼š
- è§£é‡Šå™¨æ¨¡å¼æ˜¯æŠŠæ–‡æœ¬è½¬æ¢æˆå¯æ‰§è¡Œæ“ä½œçš„æ¡¥æ¢
- æ ¸å¿ƒæ˜¯æ„å»ºè¡¨è¾¾å¼æ ‘å’Œé€’å½’è§£é‡Šæ‰§è¡Œ
- å¹³è¡¡çµæ´»æ€§å’Œæ€§èƒ½ï¼Œé€‰æ‹©åˆé€‚çš„åº”ç”¨åœºæ™¯
- é‡ç‚¹åœ¨äºè¯­æ³•è®¾è®¡å’Œè§£æç®—æ³•çš„å®ç°