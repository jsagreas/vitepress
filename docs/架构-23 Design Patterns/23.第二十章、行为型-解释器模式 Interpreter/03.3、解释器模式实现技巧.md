---
title: 3ã€è§£é‡Šå™¨æ¨¡å¼å®ç°æŠ€å·§
---
## ğŸ“š ç›®å½•

1. [è§£é‡Šå™¨æ¨¡å¼æ¦‚è¿°](#1-è§£é‡Šå™¨æ¨¡å¼æ¦‚è¿°)
2. [æ–‡æ³•è®¾è®¡åŸåˆ™](#2-æ–‡æ³•è®¾è®¡åŸåˆ™)
3. [è¡¨è¾¾å¼æ ‘æ„å»º](#3-è¡¨è¾¾å¼æ ‘æ„å»º)
4. [é€’å½’è§£é‡Šå®ç°](#4-é€’å½’è§£é‡Šå®ç°)
5. [ç¬¦å·è¡¨ç®¡ç†](#5-ç¬¦å·è¡¨ç®¡ç†)
6. [é”™è¯¯å¤„ç†æœºåˆ¶](#6-é”™è¯¯å¤„ç†æœºåˆ¶)
7. [å®æˆ˜åº”ç”¨åœºæ™¯](#7-å®æˆ˜åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” è§£é‡Šå™¨æ¨¡å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è§£é‡Šå™¨æ¨¡å¼


**é€šä¿—è§£é‡Š**ï¼šè§£é‡Šå™¨æ¨¡å¼å°±åƒæ˜¯ä¸€ä¸ª**è¯­è¨€ç¿»è¯‘å™¨**ï¼Œå®ƒèƒ½ç†è§£ç‰¹å®šçš„"è¯­è¨€è§„åˆ™"ï¼Œç„¶åæŠŠè¿™äº›è§„åˆ™ç¿»è¯‘æˆè®¡ç®—æœºèƒ½æ‰§è¡Œçš„æ“ä½œã€‚

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
è®¡ç®—å™¨è¾“å…¥ï¼š"2 + 3 * 4"
è§£é‡Šå™¨å·¥ä½œè¿‡ç¨‹ï¼š
1. ç†è§£æ•°å­—ï¼š2, 3, 4
2. ç†è§£è¿ç®—ç¬¦ï¼š+, *  
3. ç†è§£ä¼˜å…ˆçº§ï¼šå…ˆç®—ä¹˜æ³•ï¼Œåç®—åŠ æ³•
4. è®¡ç®—ç»“æœï¼š2 + 12 = 14

ç¨‹åºä¸­çš„è§£é‡Šå™¨åšçš„å°±æ˜¯ç±»ä¼¼çš„äº‹æƒ…ï¼
```

### 1.2 è§£é‡Šå™¨æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³


**ğŸ¯ æ ¸å¿ƒç†å¿µ**ï¼šä¸ºè¯­è¨€ä¸­çš„æ¯ä¸ªè¯­æ³•è§„åˆ™åˆ›å»ºä¸€ä¸ªç±»ï¼Œç”¨è¿™äº›ç±»æ¥è§£é‡Šå’Œæ‰§è¡Œè¯­è¨€

```
ç®€å•ç†è§£ï¼š
è¯­è¨€è§„åˆ™ â†’ Javaç±» â†’ æ‰§è¡Œé€»è¾‘

ä¾‹å¦‚æ•°å­¦è¡¨è¾¾å¼ï¼š
- æ•°å­— â†’ NumberExpressionç±»
- åŠ æ³• â†’ AddExpressionç±»  
- ä¹˜æ³• â†’ MultiplyExpressionç±»
```

### 1.3 é€‚ç”¨åœºæ™¯åˆ¤æ–­


**âœ… é€‚åˆä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼çš„æƒ…å†µ**ï¼š
- éœ€è¦è§£æç®€å•çš„è¯­æ³•è§„åˆ™
- è¯­æ³•è§„åˆ™ç›¸å¯¹ç¨³å®šï¼Œä¸ç»å¸¸å˜åŒ–
- æ€§èƒ½è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜
- éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰è¡¨è¾¾å¼æˆ–è§„åˆ™

**âŒ ä¸é€‚åˆçš„æƒ…å†µ**ï¼š
- è¯­æ³•è§„åˆ™å¤æ‚ä¸”ç»å¸¸å˜åŒ–
- å¯¹æ€§èƒ½è¦æ±‚æé«˜
- ç®€å•çš„if-elseå°±èƒ½è§£å†³çš„é—®é¢˜

---

## 2. ğŸ“ æ–‡æ³•è®¾è®¡åŸåˆ™


### 2.1 ä»€ä¹ˆæ˜¯æ–‡æ³•


**é€šä¿—è§£é‡Š**ï¼šæ–‡æ³•å°±æ˜¯**è¯­è¨€çš„è¯­æ³•è§„åˆ™**ï¼Œå°±åƒä¸­æ–‡æœ‰ä¸»è°“å®¾ç»“æ„ï¼Œè‹±æ–‡æœ‰è¯­æ³•è§„åˆ™ä¸€æ ·ã€‚

```
æ•°å­¦è¡¨è¾¾å¼çš„æ–‡æ³•ç¤ºä¾‹ï¼š
è¡¨è¾¾å¼ = é¡¹ + é¡¹ | é¡¹ - é¡¹ | é¡¹
é¡¹ = å› å­ * å› å­ | å› å­ / å› å­ | å› å­  
å› å­ = æ•°å­— | (è¡¨è¾¾å¼)

ç¿»è¯‘æˆäººè¯ï¼š
- è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸¤ä¸ªé¡¹ç›¸åŠ ã€ç›¸å‡ï¼Œæˆ–è€…å°±æ˜¯ä¸€ä¸ªé¡¹
- é¡¹å¯ä»¥æ˜¯ä¸¤ä¸ªå› å­ç›¸ä¹˜ã€ç›¸é™¤ï¼Œæˆ–è€…å°±æ˜¯ä¸€ä¸ªå› å­
- å› å­å¯ä»¥æ˜¯æ•°å­—ï¼Œæˆ–è€…æ‹¬å·é‡Œçš„è¡¨è¾¾å¼
```

### 2.2 æ–‡æ³•è®¾è®¡çš„åŸºæœ¬åŸåˆ™


**ğŸ”¸ ç®€å•æ€§åŸåˆ™**
```
âœ… å¥½çš„è®¾è®¡ï¼šè§„åˆ™ç®€å•æ˜äº†
expression = term ('+' term | '-' term)*

âŒ å¤æ‚çš„è®¾è®¡ï¼šè§„åˆ™ç¹çéš¾æ‡‚  
expression = complex_term_with_multiple_operators_and_precedence_rules
```

**ğŸ”¸ å±‚æ¬¡æ€§åŸåˆ™**
```
æŒ‰ä¼˜å…ˆçº§åˆ†å±‚è®¾è®¡ï¼š

é«˜ä¼˜å…ˆçº§ â†’ å› å­å±‚ï¼ˆæ•°å­—ã€æ‹¬å·ï¼‰
ä¸­ä¼˜å…ˆçº§ â†’ é¡¹å±‚ï¼ˆä¹˜é™¤è¿ç®—ï¼‰  
ä½ä¼˜å…ˆçº§ â†’ è¡¨è¾¾å¼å±‚ï¼ˆåŠ å‡è¿ç®—ï¼‰

è¿™æ ·è®¾è®¡è‡ªç„¶å°±å¤„ç†äº†è¿ç®—ä¼˜å…ˆçº§ï¼
```

**ğŸ”¸ å¯æ‰©å±•æ€§åŸåˆ™**
```java
// åŸºç¡€æ¥å£è®¾è®¡è¦è€ƒè™‘æ‰©å±•
interface Expression {
    int interpret();  // åŸºæœ¬è§£é‡Šæ–¹æ³•
    String toString(); // ç”¨äºè°ƒè¯•
}

// æ·»åŠ æ–°è¿ç®—ç¬¦æ—¶ï¼Œåªéœ€å®ç°è¿™ä¸ªæ¥å£
class PowerExpression implements Expression {
    // å¹‚è¿ç®—çš„å®ç°
}
```

### 2.3 æ–‡æ³•è¡¨ç¤ºæ–¹æ³•


**BNFèŒƒå¼è¡¨ç¤º**ï¼ˆäº†è§£å³å¯ï¼Œä¸ç”¨æ·±ç©¶ï¼‰ï¼š
```
<expression> ::= <term> (('+' | '-') <term>)*
<term> ::= <factor> (('*' | '/') <factor>)*  
<factor> ::= <number> | '(' <expression> ')'
<number> ::= [0-9]+
```

**æ ‘å½¢ç»“æ„è¡¨ç¤º**ï¼ˆæ›´ç›´è§‚ï¼‰ï¼š
```
è¡¨è¾¾å¼: "2 + 3 * 4"

    è¡¨è¾¾å¼
   /   |   \
  2    +    é¡¹
          /  |  \
         3   *   4

è¿™ä¸ªæ ‘å°±æ˜¯è§£é‡Šå™¨è¦æ„å»ºçš„ï¼
```

---

## 3. ğŸŒ³ è¡¨è¾¾å¼æ ‘æ„å»º


### 3.1 ä»€ä¹ˆæ˜¯è¡¨è¾¾å¼æ ‘


**é€šä¿—è§£é‡Š**ï¼šè¡¨è¾¾å¼æ ‘å°±æ˜¯æŠŠæ•°å­¦è¡¨è¾¾å¼ç”¨æ ‘çš„å½¢å¼è¡¨ç¤ºå‡ºæ¥ï¼Œ**å¶å­èŠ‚ç‚¹æ˜¯æ•°å­—ï¼Œä¸­é—´èŠ‚ç‚¹æ˜¯è¿ç®—ç¬¦**ã€‚

```
è¡¨è¾¾å¼ï¼š"(2 + 3) * 4"

æ„å»ºçš„æ ‘ï¼š
      *
    /   \
   +     4
  / \
 2   3

è®¡ç®—è¿‡ç¨‹ï¼š
1. å…ˆç®—å·¦å­æ ‘ï¼š2 + 3 = 5
2. å†ç®—æ•´ä¸ªæ ‘ï¼š5 * 4 = 20
```

### 3.2 è¡¨è¾¾å¼æ ‘çš„åŸºæœ¬ç»“æ„


**ğŸ”¸ èŠ‚ç‚¹ç±»å‹è®¾è®¡**

```java
// æŠ½è±¡è¡¨è¾¾å¼ - æ‰€æœ‰èŠ‚ç‚¹çš„å…±åŒæ¥å£
abstract class Expression {
    public abstract int interpret();
}

// æ•°å­—èŠ‚ç‚¹ - å¶å­èŠ‚ç‚¹
class NumberExpression extends Expression {
    private int number;
    
    public NumberExpression(int number) {
        this.number = number;
    }
    
    public int interpret() {
        return number;  // æ•°å­—èŠ‚ç‚¹ç›´æ¥è¿”å›å€¼
    }
}

// åŠ æ³•èŠ‚ç‚¹ - ä¸­é—´èŠ‚ç‚¹
class AddExpression extends Expression {
    private Expression left;   // å·¦å­æ ‘
    private Expression right;  // å³å­æ ‘
    
    public AddExpression(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }
    
    public int interpret() {
        return left.interpret() + right.interpret();
    }
}
```

### 3.3 æ„å»ºè¡¨è¾¾å¼æ ‘çš„è¿‡ç¨‹


**æ­¥éª¤åˆ†è§£**ï¼š
```
è¾“å…¥ï¼š"2 + 3 * 4"

ç¬¬1æ­¥ï¼šè¯æ³•åˆ†æï¼ˆæŠŠå­—ç¬¦ä¸²åˆ†è§£æˆtokenï¼‰
tokens: [2, +, 3, *, 4]

ç¬¬2æ­¥ï¼šè¯­æ³•åˆ†æï¼ˆæŒ‰æ–‡æ³•è§„åˆ™æ„å»ºæ ‘ï¼‰
æŒ‰ä¼˜å…ˆçº§å¤„ç†ï¼š
- å…ˆå¤„ç† 3 * 4 â†’ MultiplyExpression(3, 4)
- å†å¤„ç† 2 + (3*4) â†’ AddExpression(2, multiply_node)

ç¬¬3æ­¥ï¼šå¾—åˆ°è¡¨è¾¾å¼æ ‘
      +
    /   \
   2     *
        / \
       3   4
```

**ğŸ”¸ é€’å½’ä¸‹é™è§£ææ³•**
```java
public class ExpressionParser {
    private String[] tokens;
    private int current = 0;
    
    // è§£æè¡¨è¾¾å¼ï¼ˆå¤„ç† + å’Œ -ï¼‰
    public Expression parseExpression() {
        Expression left = parseTerm();
        
        while (current < tokens.length && 
               (tokens[current].equals("+") || tokens[current].equals("-"))) {
            String operator = tokens[current++];
            Expression right = parseTerm();
            
            if (operator.equals("+")) {
                left = new AddExpression(left, right);
            } else {
                left = new SubtractExpression(left, right);
            }
        }
        return left;
    }
    
    // è§£æé¡¹ï¼ˆå¤„ç† * å’Œ /ï¼‰
    public Expression parseTerm() {
        Expression left = parseFactor();
        
        while (current < tokens.length && 
               (tokens[current].equals("*") || tokens[current].equals("/"))) {
            String operator = tokens[current++];
            Expression right = parseFactor();
            
            if (operator.equals("*")) {
                left = new MultiplyExpression(left, right);
            } else {
                left = new DivideExpression(left, right);
            }
        }
        return left;
    }
    
    // è§£æå› å­ï¼ˆæ•°å­—æˆ–æ‹¬å·è¡¨è¾¾å¼ï¼‰
    public Expression parseFactor() {
        if (tokens[current].equals("(")) {
            current++; // è·³è¿‡ '('
            Expression expr = parseExpression();
            current++; // è·³è¿‡ ')'
            return expr;
        } else {
            return new NumberExpression(Integer.parseInt(tokens[current++]));
        }
    }
}
```

---

## 4. ğŸ”„ é€’å½’è§£é‡Šå®ç°


### 4.1 é€’å½’è§£é‡Šçš„åŸºæœ¬æ€æƒ³


**é€šä¿—è§£é‡Š**ï¼šé€’å½’è§£é‡Šå°±åƒ**ä¿„ç½—æ–¯å¥—å¨ƒ**ï¼Œå¤§å¨ƒå¨ƒé‡Œé¢æœ‰å°å¨ƒå¨ƒï¼Œè¦æ‰“å¼€å¤§å¨ƒå¨ƒå°±è¦å…ˆæ‰“å¼€é‡Œé¢çš„å°å¨ƒå¨ƒã€‚

```
è¡¨è¾¾å¼ï¼š"(2 + 3) * 4"çš„è§£é‡Šè¿‡ç¨‹ï¼š

è§£é‡Š MultiplyExpression:
â”œâ”€â”€ è§£é‡Šå·¦å­æ ‘ AddExpression:
â”‚   â”œâ”€â”€ è§£é‡Šå·¦å­æ ‘ï¼šNumberExpression(2) â†’ è¿”å› 2
â”‚   â”œâ”€â”€ è§£é‡Šå³å­æ ‘ï¼šNumberExpression(3) â†’ è¿”å› 3  
â”‚   â””â”€â”€ è®¡ç®—ï¼š2 + 3 = 5
â”œâ”€â”€ è§£é‡Šå³å­æ ‘ï¼šNumberExpression(4) â†’ è¿”å› 4
â””â”€â”€ è®¡ç®—ï¼š5 * 4 = 20

æ¯ä¸€å±‚éƒ½åœ¨è°ƒç”¨æ›´æ·±å±‚çš„è§£é‡Šï¼Œè¿™å°±æ˜¯é€’å½’ï¼
```

### 4.2 é€’å½’è§£é‡Šçš„å®ç°æ¨¡å¼


**ğŸ”¸ åŸºæœ¬æ¨¡å¼**
```java
abstract class Expression {
    // æ¯ä¸ªè¡¨è¾¾å¼éƒ½è¦å®ç°è§£é‡Šæ–¹æ³•
    public abstract int interpret();
}

// ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆé€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼‰
class NumberExpression extends Expression {
    private int value;
    
    public int interpret() {
        return value;  // ç›´æ¥è¿”å›ï¼Œä¸å†é€’å½’
    }
}

// éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆé€’å½’çš„ä¸»ä½“ï¼‰
class AddExpression extends Expression {
    private Expression left, right;
    
    public int interpret() {
        // é€’å½’è§£é‡Šå­è¡¨è¾¾å¼ï¼Œç„¶ååˆå¹¶ç»“æœ
        int leftValue = left.interpret();   // é€’å½’è°ƒç”¨
        int rightValue = right.interpret(); // é€’å½’è°ƒç”¨
        return leftValue + rightValue;      // åˆå¹¶ç»“æœ
    }
}
```

### 4.3 é€’å½’æ·±åº¦æ§åˆ¶


**é—®é¢˜**ï¼šå¦‚æœè¡¨è¾¾å¼å¤ªå¤æ‚ï¼Œå¯èƒ½å¯¼è‡´æ ˆæº¢å‡º

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
class SafeExpression extends Expression {
    private static final int MAX_DEPTH = 1000;
    private static ThreadLocal<Integer> depth = new ThreadLocal<Integer>() {
        protected Integer initialValue() {
            return 0;
        }
    };
    
    public int interpret() {
        int currentDepth = depth.get();
        if (currentDepth > MAX_DEPTH) {
            throw new RuntimeException("è¡¨è¾¾å¼å¤ªå¤æ‚ï¼Œé€’å½’æ·±åº¦è¶…é™");
        }
        
        depth.set(currentDepth + 1);
        try {
            return doInterpret();  // å®é™…çš„è§£é‡Šé€»è¾‘
        } finally {
            depth.set(currentDepth);  // æ¢å¤æ·±åº¦
        }
    }
    
    protected abstract int doInterpret();
}
```

---

## 5. ğŸ“Š ç¬¦å·è¡¨ç®¡ç†


### 5.1 ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨


**é€šä¿—è§£é‡Š**ï¼šç¬¦å·è¡¨å°±åƒæ˜¯ä¸€ä¸ª**å­—å…¸**ï¼Œè®°å½•å˜é‡åå’Œå®ƒä»¬çš„å€¼ã€‚æ¯”å¦‚ x=5, y=10 è¿™æ ·çš„å¯¹åº”å…³ç³»ã€‚

```
è¡¨è¾¾å¼ï¼š"x + y * 2"
ç¬¦å·è¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å˜é‡å   â”‚  å€¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   x     â”‚   5   â”‚
â”‚   y     â”‚  10   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜

è§£é‡Šè¿‡ç¨‹ï¼š
1. æŸ¥ç¬¦å·è¡¨ï¼šx â†’ 5
2. æŸ¥ç¬¦å·è¡¨ï¼šy â†’ 10  
3. è®¡ç®—ï¼š5 + 10 * 2 = 25
```

### 5.2 ç¬¦å·è¡¨çš„åŸºæœ¬å®ç°


**ğŸ”¸ ç®€å•ç¬¦å·è¡¨**
```java
import java.util.HashMap;
import java.util.Map;

public class SymbolTable {
    private Map<String, Integer> variables;
    
    public SymbolTable() {
        this.variables = new HashMap<>();
    }
    
    // è®¾ç½®å˜é‡å€¼
    public void setValue(String name, int value) {
        variables.put(name, value);
    }
    
    // è·å–å˜é‡å€¼
    public int getValue(String name) {
        if (!variables.containsKey(name)) {
            throw new RuntimeException("æœªå®šä¹‰çš„å˜é‡: " + name);
        }
        return variables.get(name);
    }
    
    // æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨
    public boolean hasVariable(String name) {
        return variables.containsKey(name);
    }
}
```

**ğŸ”¸ å˜é‡è¡¨è¾¾å¼çš„å®ç°**
```java
class VariableExpression extends Expression {
    private String variableName;
    private SymbolTable symbolTable;
    
    public VariableExpression(String name, SymbolTable table) {
        this.variableName = name;
        this.symbolTable = table;
    }
    
    public int interpret() {
        return symbolTable.getValue(variableName);
    }
}
```

### 5.3 ä½œç”¨åŸŸç®¡ç†


**é—®é¢˜**ï¼šåœ¨å¤æ‚çš„è¯­è¨€ä¸­ï¼Œå˜é‡æœ‰ä½œç”¨åŸŸæ¦‚å¿µ
```
{
    int x = 5;
    {
        int y = 10;  // å†…å±‚ä½œç”¨åŸŸ
        // è¿™é‡Œèƒ½è®¿é—® x å’Œ y
    }
    // è¿™é‡Œåªèƒ½è®¿é—® xï¼Œä¸èƒ½è®¿é—® y
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼šæ ˆå¼ç¬¦å·è¡¨
```java
public class ScopedSymbolTable {
    private Stack<Map<String, Integer>> scopes;
    
    public ScopedSymbolTable() {
        this.scopes = new Stack<>();
        pushScope(); // åˆ›å»ºå…¨å±€ä½œç”¨åŸŸ
    }
    
    // è¿›å…¥æ–°ä½œç”¨åŸŸ
    public void pushScope() {
        scopes.push(new HashMap<>());
    }
    
    // é€€å‡ºå½“å‰ä½œç”¨åŸŸ
    public void popScope() {
        if (scopes.size() > 1) {  // ä¿ç•™å…¨å±€ä½œç”¨åŸŸ
            scopes.pop();
        }
    }
    
    // åœ¨å½“å‰ä½œç”¨åŸŸè®¾ç½®å˜é‡
    public void setValue(String name, int value) {
        scopes.peek().put(name, value);
    }
    
    // æŸ¥æ‰¾å˜é‡ï¼ˆä»å†…åˆ°å¤–æŸ¥æ‰¾ï¼‰
    public int getValue(String name) {
        for (int i = scopes.size() - 1; i >= 0; i--) {
            Map<String, Integer> scope = scopes.get(i);
            if (scope.containsKey(name)) {
                return scope.get(name);
            }
        }
        throw new RuntimeException("æœªå®šä¹‰çš„å˜é‡: " + name);
    }
}
```

---

## 6. âš ï¸ é”™è¯¯å¤„ç†æœºåˆ¶


### 6.1 å¸¸è§é”™è¯¯ç±»å‹


**ğŸ”¸ è¯æ³•é”™è¯¯**ï¼ˆå­—ç¬¦è¯†åˆ«é”™è¯¯ï¼‰
```
è¾“å…¥ï¼š"2 + 3 & 4"  // & ä¸æ˜¯åˆæ³•çš„è¿ç®—ç¬¦
é”™è¯¯ä¿¡æ¯ï¼š"ç¬¬5ä¸ªå­—ç¬¦ '&' ä¸æ˜¯æœ‰æ•ˆçš„è¿ç®—ç¬¦"
```

**ğŸ”¸ è¯­æ³•é”™è¯¯**ï¼ˆç»“æ„é”™è¯¯ï¼‰
```
è¾“å…¥ï¼š"2 + + 3"    // ä¸¤ä¸ªè¿ç»­çš„è¿ç®—ç¬¦
é”™è¯¯ä¿¡æ¯ï¼š"ç¬¬4ä¸ªä½ç½®ï¼šæœŸæœ›æ•°å­—æˆ–å˜é‡ï¼Œä½†å‘ç°è¿ç®—ç¬¦ '+'"
```

**ğŸ”¸ è¯­ä¹‰é”™è¯¯**ï¼ˆé€»è¾‘é”™è¯¯ï¼‰
```
è¾“å…¥ï¼š"5 / 0"      // é™¤é›¶é”™è¯¯
é”™è¯¯ä¿¡æ¯ï¼š"é™¤é›¶é”™è¯¯ï¼šä¸èƒ½é™¤ä»¥0"

è¾“å…¥ï¼š"x + 3"      // æœªå®šä¹‰å˜é‡
é”™è¯¯ä¿¡æ¯ï¼š"æœªå®šä¹‰çš„å˜é‡ï¼šx"
```

### 6.2 é”™è¯¯å¤„ç†ç­–ç•¥


**ğŸ”¸ è‡ªå®šä¹‰å¼‚å¸¸ç±»**
```java
// è§£é‡Šå™¨å¼‚å¸¸åŸºç±»
class InterpreterException extends Exception {
    private int position;  // é”™è¯¯ä½ç½®
    
    public InterpreterException(String message, int position) {
        super(message);
        this.position = position;
    }
    
    public String getDetailedMessage() {
        return String.format("ä½ç½® %d: %s", position, getMessage());
    }
}

// å…·ä½“å¼‚å¸¸ç±»å‹
class SyntaxException extends InterpreterException {
    public SyntaxException(String message, int position) {
        super("è¯­æ³•é”™è¯¯: " + message, position);
    }
}

class UndefinedVariableException extends InterpreterException {
    public UndefinedVariableException(String variableName, int position) {
        super("æœªå®šä¹‰çš„å˜é‡: " + variableName, position);
    }
}
```

**ğŸ”¸ é”™è¯¯æ¢å¤æœºåˆ¶**
```java
public class RobustParser {
    
    public Expression parseExpression() {
        try {
            return doParseExpression();
        } catch (SyntaxException e) {
            // å°è¯•æ¢å¤ï¼šè·³è¿‡é”™è¯¯tokenï¼Œç»§ç»­è§£æ
            skipToNextValidToken();
            return parseExpression();
        }
    }
    
    private void skipToNextValidToken() {
        // è·³è¿‡éæ³•å­—ç¬¦ï¼Œæ‰¾åˆ°ä¸‹ä¸€ä¸ªæœ‰æ•ˆtoken
        while (current < tokens.length && !isValidToken(tokens[current])) {
            current++;
        }
    }
    
    private boolean isValidToken(String token) {
        return token.matches("[0-9]+") ||          // æ•°å­—
               token.matches("[a-zA-Z]+") ||       // å˜é‡å
               "+-*/()".contains(token);           // è¿ç®—ç¬¦
    }
}
```

### 6.3 å‹å¥½çš„é”™è¯¯æç¤º


**ğŸ”¸ å¸¦ä¸Šä¸‹æ–‡çš„é”™è¯¯ä¿¡æ¯**
```java
public class ErrorReporter {
    private String originalInput;
    
    public void reportError(InterpreterException e) {
        System.err.println("è§£æé”™è¯¯ï¼š");
        System.err.println("è¾“å…¥ï¼š" + originalInput);
        
        // æ˜¾ç¤ºé”™è¯¯ä½ç½®
        StringBuilder pointer = new StringBuilder();
        for (int i = 0; i < e.getPosition(); i++) {
            pointer.append(" ");
        }
        pointer.append("^");
        
        System.err.println("     " + pointer.toString());
        System.err.println("é”™è¯¯ï¼š" + e.getMessage());
        
        // ç»™å‡ºä¿®æ”¹å»ºè®®
        suggestFix(e);
    }
    
    private void suggestFix(InterpreterException e) {
        if (e instanceof UndefinedVariableException) {
            System.err.println("å»ºè®®ï¼šè¯·å…ˆå®šä¹‰å˜é‡ï¼Œæˆ–æ£€æŸ¥å˜é‡åæ‹¼å†™");
        } else if (e instanceof SyntaxException) {
            System.err.println("å»ºè®®ï¼šæ£€æŸ¥è¿ç®—ç¬¦å’Œæ‹¬å·æ˜¯å¦é…å¯¹");
        }
    }
}
```

---

## 7. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 7.1 è®¡ç®—å™¨åº”ç”¨


**å®Œæ•´ç¤ºä¾‹**ï¼šä¸€ä¸ªæ”¯æŒå˜é‡çš„è®¡ç®—å™¨
```java
public class Calculator {
    private SymbolTable symbolTable;
    private ExpressionParser parser;
    
    public Calculator() {
        this.symbolTable = new SymbolTable();
        this.parser = new ExpressionParser();
    }
    
    // è®¾ç½®å˜é‡
    public void setVariable(String name, int value) {
        symbolTable.setValue(name, value);
    }
    
    // è®¡ç®—è¡¨è¾¾å¼
    public int calculate(String expression) {
        try {
            Expression expr = parser.parse(expression, symbolTable);
            return expr.interpret();
        } catch (Exception e) {
            throw new RuntimeException("è®¡ç®—é”™è¯¯: " + e.getMessage());
        }
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public static void main(String[] args) {
        Calculator calc = new Calculator();
        
        // è®¾ç½®å˜é‡
        calc.setVariable("x", 10);
        calc.setVariable("y", 5);
        
        // è®¡ç®—è¡¨è¾¾å¼
        System.out.println(calc.calculate("x + y"));      // 15
        System.out.println(calc.calculate("x * 2 + y"));  // 25
        System.out.println(calc.calculate("(x + y) * 2")); // 30
    }
}
```

### 7.2 é…ç½®æ–‡ä»¶è§£æ


**åœºæ™¯**ï¼šè§£æç±»ä¼¼ "rule: age > 18 AND score > 80" çš„è§„åˆ™
```java
// å¸ƒå°”è¡¨è¾¾å¼åŸºç±»
abstract class BooleanExpression {
    public abstract boolean evaluate(Map<String, Object> context);
}

// æ¯”è¾ƒè¡¨è¾¾å¼
class ComparisonExpression extends BooleanExpression {
    private String field;
    private String operator;
    private Object value;
    
    public boolean evaluate(Map<String, Object> context) {
        Object fieldValue = context.get(field);
        
        switch (operator) {
            case ">":
                return ((Integer)fieldValue) > ((Integer)value);
            case ">=":
                return ((Integer)fieldValue) >= ((Integer)value);
            case "==":
                return fieldValue.equals(value);
            default:
                throw new IllegalArgumentException("ä¸æ”¯æŒçš„æ“ä½œç¬¦: " + operator);
        }
    }
}

// ANDè¡¨è¾¾å¼
class AndExpression extends BooleanExpression {
    private BooleanExpression left, right;
    
    public boolean evaluate(Map<String, Object> context) {
        return left.evaluate(context) && right.evaluate(context);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public void testRule() {
    // æ„å»ºè§„åˆ™ï¼šage > 18 AND score > 80
    BooleanExpression ageCheck = new ComparisonExpression("age", ">", 18);
    BooleanExpression scoreCheck = new ComparisonExpression("score", ">", 80);
    BooleanExpression rule = new AndExpression(ageCheck, scoreCheck);
    
    // æµ‹è¯•æ•°æ®
    Map<String, Object> person = new HashMap<>();
    person.put("age", 25);
    person.put("score", 85);
    
    boolean result = rule.evaluate(person);  // true
    System.out.println("è§„åˆ™åŒ¹é…: " + result);
}
```

### 7.3 SQLæŸ¥è¯¢æ¡ä»¶è§£æ


**ç®€åŒ–çš„WHEREæ¡ä»¶è§£æå™¨**
```java
// WHEREæ¡ä»¶è¡¨è¾¾å¼
abstract class WhereExpression {
    public abstract boolean matches(Map<String, Object> row);
}

// å­—æ®µæ¡ä»¶
class FieldCondition extends WhereExpression {
    private String fieldName;
    private String operator;
    private Object value;
    
    public boolean matches(Map<String, Object> row) {
        Object fieldValue = row.get(fieldName);
        // æ ¹æ®operatoræ‰§è¡Œæ¯”è¾ƒé€»è¾‘
        return compare(fieldValue, operator, value);
    }
    
    private boolean compare(Object left, String op, Object right) {
        // å®ç°å„ç§æ¯”è¾ƒæ“ä½œ
        // è¿™é‡Œç®€åŒ–å¤„ç†
        return true;
    }
}

// ç»„åˆæ¡ä»¶
class CompositeCondition extends WhereExpression {
    private WhereExpression left, right;
    private String logicalOperator; // AND, OR
    
    public boolean matches(Map<String, Object> row) {
        boolean leftResult = left.matches(row);
        boolean rightResult = right.matches(row);
        
        return "AND".equals(logicalOperator) ? 
               leftResult && rightResult : 
               leftResult || rightResult;
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è§£é‡Šå™¨æ¨¡å¼æœ¬è´¨ï¼šä¸ºè¯­è¨€çš„æ¯ä¸ªè¯­æ³•è§„åˆ™åˆ›å»ºä¸€ä¸ªç±»
ğŸ”¸ è¡¨è¾¾å¼æ ‘ï¼šç”¨æ ‘å½¢ç»“æ„è¡¨ç¤ºè¯­æ³•ç»“æ„ï¼Œå¶å­æ˜¯ç»ˆç»“ç¬¦ï¼ŒèŠ‚ç‚¹æ˜¯éç»ˆç»“ç¬¦
ğŸ”¸ é€’å½’è§£é‡Šï¼šé€šè¿‡é€’å½’è°ƒç”¨å­è¡¨è¾¾å¼çš„è§£é‡Šæ–¹æ³•æ¥è®¡ç®—ç»“æœ
ğŸ”¸ ç¬¦å·è¡¨ï¼šç®¡ç†å˜é‡å’Œå®ƒä»¬çš„å€¼çš„æ˜ å°„å…³ç³»
ğŸ”¸ æ–‡æ³•è®¾è®¡ï¼šå®šä¹‰è¯­è¨€çš„è¯­æ³•è§„åˆ™ï¼Œè¦è€ƒè™‘ç®€å•æ€§å’Œæ‰©å±•æ€§
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™ç”¨è§£é‡Šå™¨æ¨¡å¼**
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… éœ€è¦è§£é‡Šç®€å•çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰
âœ… è¯­æ³•è§„åˆ™ç›¸å¯¹å›ºå®šï¼Œä¸ç»å¸¸å˜åŒ–  
âœ… æ›´æ³¨é‡çµæ´»æ€§è€Œä¸æ˜¯æè‡´æ€§èƒ½
âœ… éœ€è¦æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™æˆ–è¡¨è¾¾å¼

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ è¯­æ³•éå¸¸å¤æ‚ï¼ˆè€ƒè™‘ç”¨ä¸“ä¸šçš„è§£æå™¨ç”Ÿæˆå·¥å…·ï¼‰
âŒ æ€§èƒ½è¦æ±‚æé«˜ï¼ˆè§£é‡Šå™¨æ¨¡å¼æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼‰
âŒ ç®€å•çš„æ¡ä»¶åˆ¤æ–­ï¼ˆç”¨if-elseæ›´ç®€å•ï¼‰
```

**ğŸ”¹ æ–‡æ³•è®¾è®¡çš„å…³é”®ç‚¹**
```
è®¾è®¡åŸåˆ™ï¼š
- ç®€å•æ˜äº†ï¼šè§„åˆ™å®¹æ˜“ç†è§£å’Œå®ç°
- å±‚æ¬¡æ¸…æ™°ï¼šæŒ‰ä¼˜å…ˆçº§åˆ†å±‚ï¼Œè‡ªç„¶å¤„ç†ä¼˜å…ˆçº§
- æ˜“äºæ‰©å±•ï¼šæ·»åŠ æ–°è§„åˆ™æ—¶ä¸å½±å“ç°æœ‰ä»£ç 
- é”™è¯¯å‹å¥½ï¼šèƒ½ç»™å‡ºæ¸…æ™°çš„é”™è¯¯æç¤º
```

**ğŸ”¹ å®ç°ä¸­çš„æ³¨æ„äº‹é¡¹**
```
å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š
- é€’å½’æ·±åº¦è¿‡å¤§ â†’ æ·»åŠ æ·±åº¦é™åˆ¶æ£€æŸ¥
- å˜é‡ä½œç”¨åŸŸæ··ä¹± â†’ ä½¿ç”¨æ ˆå¼ç¬¦å·è¡¨
- é”™è¯¯ä¿¡æ¯ä¸å‹å¥½ â†’ è®°å½•ä½ç½®ä¿¡æ¯ï¼Œæä¾›ä¿®æ”¹å»ºè®®
- æ€§èƒ½é—®é¢˜ â†’ è€ƒè™‘ç¼“å­˜å·²è§£æçš„è¡¨è¾¾å¼
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åº”ç”¨åœºæ™¯**
- **è§„åˆ™å¼•æ“**ï¼šä¸šåŠ¡è§„åˆ™çš„åŠ¨æ€é…ç½®å’Œæ‰§è¡Œ
- **é…ç½®ç³»ç»Ÿ**ï¼šå¤æ‚é…ç½®æ¡ä»¶çš„è§£æ
- **è®¡ç®—å™¨åº”ç”¨**ï¼šæ”¯æŒå˜é‡å’Œå‡½æ•°çš„è¡¨è¾¾å¼è®¡ç®—
- **æ•°æ®è¿‡æ»¤**ï¼šåŠ¨æ€æŸ¥è¯¢æ¡ä»¶çš„æ„å»ºå’Œæ‰§è¡Œ
- **è„šæœ¬å¼•æ“**ï¼šç®€å•è„šæœ¬è¯­è¨€çš„è§£é‡Šæ‰§è¡Œ

**ğŸ”§ å¼€å‘å®è·µ**
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªè¯­æ³•è§„åˆ™ç‹¬ç«‹å®ç°ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
- **é”™è¯¯å¤„ç†**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ¢å¤æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¯¹å¸¸ç”¨è¡¨è¾¾å¼è¿›è¡Œç¼“å­˜
- **æ‰©å±•æ€§**ï¼šä¸ºå°†æ¥å¯èƒ½çš„è¯­æ³•æ‰©å±•é¢„ç•™æ¥å£

### 8.4 å­¦ä¹ è¿›é˜¶å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ æ–¹å‘**
- **ç¼–è¯‘åŸç†**ï¼šäº†è§£è¯æ³•åˆ†æã€è¯­æ³•åˆ†æçš„æ›´å¤šæŠ€æœ¯
- **ANTLR/JavaCC**ï¼šå­¦ä¹ ä¸“ä¸šçš„è§£æå™¨ç”Ÿæˆå·¥å…·
- **å‡½æ•°å¼ç¼–ç¨‹**ï¼šè§£é‡Šå™¨æ¨¡å¼ä¸å‡½æ•°å¼ç¼–ç¨‹çš„ç»“åˆ
- **é¢†åŸŸç‰¹å®šè¯­è¨€**ï¼šå¦‚ä½•è®¾è®¡å’Œå®ç°DSL

**ğŸ” ç›¸å…³æ¨¡å¼**
- **å‘½ä»¤æ¨¡å¼**ï¼šè§£é‡Šåçš„è¡¨è¾¾å¼å¯ä»¥å°è£…æˆå‘½ä»¤
- **è®¿é—®è€…æ¨¡å¼**ï¼šéå†å’Œæ“ä½œè¡¨è¾¾å¼æ ‘
- **ç»„åˆæ¨¡å¼**ï¼šè¡¨è¾¾å¼æ ‘æœ¬èº«å°±æ˜¯ç»„åˆæ¨¡å¼çš„åº”ç”¨

**æ ¸å¿ƒè®°å¿†**ï¼š
- è§£é‡Šå™¨å¦‚ç¿»è¯‘å®˜ï¼Œè¯­æ³•è§„åˆ™å˜ç±»å®ç°
- è¡¨è¾¾å¼æ ‘æ˜¾ç»“æ„ï¼Œé€’å½’è§£é‡Šç®—ç»“æœ  
- ç¬¦å·è¡¨ç®¡å˜é‡å€¼ï¼Œé”™è¯¯å¤„ç†è¦å‹å¥½
- é€‚ç”¨ç®€å•DSLåœºæ™¯ï¼Œå¤æ‚è¯­æ³•éœ€å·¥å…·

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šå…ˆå®ç°ä¸€ä¸ªç®€å•çš„æ•°å­¦è¡¨è¾¾å¼è®¡ç®—å™¨ï¼Œç†è§£åŸºæœ¬åŸç†åå†é€æ­¥å¢åŠ å˜é‡ã€å‡½æ•°ç­‰é«˜çº§ç‰¹æ€§ã€‚é€šè¿‡å®é™…ç¼–ç æ¥åŠ æ·±å¯¹è§£é‡Šå™¨æ¨¡å¼çš„ç†è§£ã€‚