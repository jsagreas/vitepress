---
title: 6ã€å•ä¾‹æ¨¡å¼ä»£ç å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å®Œæ•´ä»£ç ç¤ºä¾‹](#1-å®Œæ•´ä»£ç ç¤ºä¾‹)
2. [å•å…ƒæµ‹è¯•ç¼–å†™](#2-å•å…ƒæµ‹è¯•ç¼–å†™)
3. [æ€§èƒ½æµ‹è¯•å¯¹æ¯”](#3-æ€§èƒ½æµ‹è¯•å¯¹æ¯”)
4. [å®é™…é¡¹ç›®é›†æˆ](#4-å®é™…é¡¹ç›®é›†æˆ)
5. [å¸¸è§é”™è¯¯é¿å…](#5-å¸¸è§é”™è¯¯é¿å…)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’» å®Œæ•´ä»£ç ç¤ºä¾‹


### 1.1 å•ä¾‹æ¨¡å¼çš„æœ¬è´¨ç†è§£


**ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿ**
> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šå°±åƒä¸€ä¸ªå…¬å¸åªèƒ½æœ‰ä¸€ä¸ªCEOï¼Œä¸€ä¸ªå›½å®¶åªèƒ½æœ‰ä¸€ä¸ªæ€»ç»Ÿä¸€æ ·ï¼Œå•ä¾‹æ¨¡å¼ç¡®ä¿æŸä¸ªç±»åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦å•ä¾‹ï¼Ÿ**
```
æ—¥å¸¸ç”Ÿæ´»ä¸­çš„å•ä¾‹æ¦‚å¿µï¼š
- ğŸ¢ å…¬å¸çš„CEOï¼šåªèƒ½æœ‰ä¸€ä¸ª
- ğŸ–¥ï¸ ç”µè„‘çš„ä»»åŠ¡ç®¡ç†å™¨ï¼šåªèƒ½æ‰“å¼€ä¸€ä¸ªçª—å£
- ğŸ“± æ‰‹æœºçš„ç³»ç»Ÿè®¾ç½®ï¼šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªè®¾ç½®ç•Œé¢
- ğŸ® æ¸¸æˆä¸­çš„æ¸¸æˆç®¡ç†å™¨ï¼šæ§åˆ¶æ•´ä¸ªæ¸¸æˆçŠ¶æ€

ç¨‹åºä¸­çš„å•ä¾‹éœ€æ±‚ï¼š
- ğŸ“Š æ—¥å¿—ç®¡ç†å™¨ï¼šç»Ÿä¸€è®°å½•ç³»ç»Ÿæ—¥å¿—
- âš™ï¸ é…ç½®ç®¡ç†å™¨ï¼šå…¨å±€é…ç½®ä¿¡æ¯
- ğŸ”— æ•°æ®åº“è¿æ¥æ± ï¼šæ§åˆ¶æ•°æ®åº“è¿æ¥
```

### 1.2 æ‡’æ±‰å¼å•ä¾‹ï¼ˆæ¨èæ–¹æ¡ˆï¼‰


```java
/**
 * æ‡’æ±‰å¼å•ä¾‹ - çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬
 * ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼šéœ€è¦çš„æ—¶å€™æ‰åˆ›å»ºï¼Œè€Œä¸”ä¿è¯çº¿ç¨‹å®‰å…¨
 */
public class DatabaseManager {
    // ğŸ”’ volatileå…³é”®å­—ï¼šç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§
    private static volatile DatabaseManager instance;
    
    // ğŸš« ç§æœ‰æ„é€ å‡½æ•°ï¼šé˜²æ­¢å¤–éƒ¨ç›´æ¥åˆ›å»ºå¯¹è±¡
    private DatabaseManager() {
        // æ¨¡æ‹Ÿåˆå§‹åŒ–è€—æ—¶æ“ä½œ
        System.out.println("ğŸ“š æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“è¿æ¥...");
        try {
            Thread.sleep(100); // æ¨¡æ‹Ÿè€—æ—¶
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        System.out.println("âœ… æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆï¼");
    }
    
    // ğŸ¯ è·å–å®ä¾‹çš„å”¯ä¸€å…¥å£
    public static DatabaseManager getInstance() {
        // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼šé¿å…ä¸å¿…è¦çš„åŒæ­¥
        if (instance == null) {
            // ğŸ” åŒæ­¥ä»£ç å—ï¼šç¡®ä¿çº¿ç¨‹å®‰å…¨
            synchronized (DatabaseManager.class) {
                // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼šé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»º
                if (instance == null) {
                    instance = new DatabaseManager();
                }
            }
        }
        return instance;
    }
    
    // ğŸ“‹ ä¸šåŠ¡æ–¹æ³•ç¤ºä¾‹
    public void executeQuery(String sql) {
        System.out.println("ğŸ” æ‰§è¡ŒSQLæŸ¥è¯¢: " + sql);
    }
    
    public void closeConnection() {
        System.out.println("ğŸ”Œ å…³é—­æ•°æ®åº“è¿æ¥");
    }
}
```

**ä»£ç è§£é‡Šï¼š**
- **`volatile`å…³é”®å­—**ï¼šç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹instanceåï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°
- **åŒé‡æ£€æŸ¥é”å®š**ï¼šå…ˆæ£€æŸ¥æ˜¯å¦ä¸ºnullï¼Œé¿å…æ¯æ¬¡éƒ½è¿›å…¥åŒæ­¥å—ï¼Œæé«˜æ€§èƒ½
- **ç§æœ‰æ„é€ å‡½æ•°**ï¼šé˜²æ­¢å¤–éƒ¨é€šè¿‡newå…³é”®å­—åˆ›å»ºæ–°å®ä¾‹

### 1.3 é¥¿æ±‰å¼å•ä¾‹ï¼ˆç®€å•ç²—æš´ï¼‰


```java
/**
 * é¥¿æ±‰å¼å•ä¾‹ - ç±»åŠ è½½æ—¶å°±åˆ›å»º
 * ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼šç¨‹åºå¯åŠ¨å°±åˆ›å»ºå¥½ï¼Œç®€å•ä½†å¯èƒ½æµªè´¹å†…å­˜
 */
public class LogManager {
    // ğŸš€ ç¨‹åºå¯åŠ¨æ—¶å°±åˆ›å»ºå®ä¾‹
    private static final LogManager instance = new LogManager();
    
    private LogManager() {
        System.out.println("ğŸ“ æ—¥å¿—ç®¡ç†å™¨å·²å¯åŠ¨");
    }
    
    public static LogManager getInstance() {
        return instance;
    }
    
    public void log(String message) {
        System.out.println("ğŸ“„ [LOG] " + message);
    }
}
```

### 1.4 æšä¸¾å•ä¾‹ï¼ˆæœ€å®‰å…¨æ–¹æ¡ˆï¼‰


```java
/**
 * æšä¸¾å•ä¾‹ - å¤©ç„¶é˜²æ­¢åå°„å’Œåºåˆ—åŒ–æ”»å‡»
 * ğŸ’¡ æ ¸å¿ƒæ€æƒ³ï¼šåˆ©ç”¨æšä¸¾çš„ç‰¹æ€§ï¼ŒJVMä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹
 */
public enum ConfigManager {
    INSTANCE; // è¿™å°±æ˜¯æˆ‘ä»¬çš„å•ä¾‹å®ä¾‹
    
    private String appName;
    private String version;
    
    // ğŸ“‹ ä¸šåŠ¡æ–¹æ³•
    public void setConfig(String appName, String version) {
        this.appName = appName;
        this.version = version;
        System.out.println("âš™ï¸ é…ç½®å·²æ›´æ–°: " + appName + " v" + version);
    }
    
    public String getAppInfo() {
        return appName + " " + version;
    }
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**
```java
// ç›´æ¥é€šè¿‡INSTANCEè®¿é—®
ConfigManager.INSTANCE.setConfig("MyApp", "1.0.0");
String info = ConfigManager.INSTANCE.getAppInfo();
```

---

## 2. ğŸ§ª å•å…ƒæµ‹è¯•ç¼–å†™


### 2.1 æµ‹è¯•å•ä¾‹ç‰¹æ€§


```java
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.DisplayName;
import static org.junit.jupiter.api.Assertions.*;

public class SingletonTest {
    
    @Test
    @DisplayName("æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹ - ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹")
    public void testLazySingletonUniqueness() {
        // ğŸ¯ æ ¸å¿ƒæµ‹è¯•ï¼šå¤šæ¬¡è·å–åº”è¯¥æ˜¯åŒä¸€ä¸ªå¯¹è±¡
        DatabaseManager db1 = DatabaseManager.getInstance();
        DatabaseManager db2 = DatabaseManager.getInstance();
        
        // âœ… éªŒè¯æ˜¯åŒä¸€ä¸ªå®ä¾‹
        assertSame(db1, db2, "ä¸¤æ¬¡è·å–çš„å®ä¾‹åº”è¯¥æ˜¯åŒä¸€ä¸ªå¯¹è±¡");
        
        // âœ… éªŒè¯å“ˆå¸Œç ç›¸åŒ
        assertEquals(db1.hashCode(), db2.hashCode(), 
                    "åŒä¸€ä¸ªå¯¹è±¡çš„å“ˆå¸Œç åº”è¯¥ç›¸åŒ");
    }
    
    @Test
    @DisplayName("æµ‹è¯•é¥¿æ±‰å¼å•ä¾‹ - ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹")
    public void testEagerSingletonUniqueness() {
        LogManager log1 = LogManager.getInstance();
        LogManager log2 = LogManager.getInstance();
        
        assertSame(log1, log2, "æ—¥å¿—ç®¡ç†å™¨åº”è¯¥æ˜¯å•ä¾‹");
    }
    
    @Test
    @DisplayName("æµ‹è¯•æšä¸¾å•ä¾‹ - ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹")
    public void testEnumSingletonUniqueness() {
        ConfigManager config1 = ConfigManager.INSTANCE;
        ConfigManager config2 = ConfigManager.INSTANCE;
        
        assertSame(config1, config2, "æšä¸¾å•ä¾‹åº”è¯¥æ˜¯åŒä¸€ä¸ªå®ä¾‹");
    }
}
```

### 2.2 å¤šçº¿ç¨‹å®‰å…¨æµ‹è¯•


```java
import java.util.concurrent.*;
import java.util.Set;
import java.util.concurrent.ConcurrentHashMap;

@Test
@DisplayName("æµ‹è¯•å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å•ä¾‹å®‰å…¨æ€§")
public void testThreadSafety() throws InterruptedException {
    // ğŸ”¢ æµ‹è¯•å‚æ•°
    int threadCount = 100;
    ExecutorService executor = Executors.newFixedThreadPool(threadCount);
    
    // ğŸ“¦ ç”¨Setæ”¶é›†æ‰€æœ‰åˆ›å»ºçš„å®ä¾‹
    Set<DatabaseManager> instances = ConcurrentHashMap.newKeySet();
    
    // ğŸš€ å¯åŠ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–å•ä¾‹
    for (int i = 0; i < threadCount; i++) {
        executor.submit(() -> {
            DatabaseManager instance = DatabaseManager.getInstance();
            instances.add(instance);
        });
    }
    
    // â³ ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
    executor.shutdown();
    assertTrue(executor.awaitTermination(5, TimeUnit.SECONDS), 
              "æµ‹è¯•åº”è¯¥åœ¨5ç§’å†…å®Œæˆ");
    
    // âœ… éªŒè¯åªåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹
    assertEquals(1, instances.size(), 
                "å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åº”è¯¥åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»º");
}
```

---

## 3. âš¡ æ€§èƒ½æµ‹è¯•å¯¹æ¯”


### 3.1 ä¸åŒå®ç°æ–¹å¼çš„æ€§èƒ½å¯¹æ¯”


```java
public class SingletonPerformanceTest {
    
    private static final int TEST_COUNT = 1_000_000; // 100ä¸‡æ¬¡è°ƒç”¨
    
    @Test
    @DisplayName("æ€§èƒ½æµ‹è¯•ï¼šå¯¹æ¯”ä¸åŒå•ä¾‹å®ç°æ–¹å¼")
    public void performanceComparison() {
        System.out.println("ğŸ å¼€å§‹æ€§èƒ½æµ‹è¯•...\n");
        
        // æµ‹è¯•é¥¿æ±‰å¼æ€§èƒ½
        long eagerTime = testEagerSingleton();
        
        // æµ‹è¯•æ‡’æ±‰å¼æ€§èƒ½
        long lazyTime = testLazySingleton();
        
        // æµ‹è¯•æšä¸¾å¼æ€§èƒ½
        long enumTime = testEnumSingleton();
        
        // ğŸ“Š ç»“æœåˆ†æ
        printPerformanceResults(eagerTime, lazyTime, enumTime);
    }
    
    private long testEagerSingleton() {
        long startTime = System.nanoTime();
        
        for (int i = 0; i < TEST_COUNT; i++) {
            LogManager.getInstance();
        }
        
        long endTime = System.nanoTime();
        return endTime - startTime;
    }
    
    private long testLazySingleton() {
        long startTime = System.nanoTime();
        
        for (int i = 0; i < TEST_COUNT; i++) {
            DatabaseManager.getInstance();
        }
        
        long endTime = System.nanoTime();
        return endTime - startTime;
    }
    
    private long testEnumSingleton() {
        long startTime = System.nanoTime();
        
        for (int i = 0; i < TEST_COUNT; i++) {
            ConfigManager config = ConfigManager.INSTANCE;
        }
        
        long endTime = System.nanoTime();
        return endTime - startTime;
    }
    
    private void printPerformanceResults(long eager, long lazy, long enumTime) {
        System.out.println("ğŸ“ˆ æ€§èƒ½æµ‹è¯•ç»“æœï¼ˆ" + TEST_COUNT + "æ¬¡è°ƒç”¨ï¼‰:");
        System.out.println("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
        System.out.println("â”‚   å®ç°æ–¹å¼      â”‚   è€—æ—¶(ms)  â”‚   ç›¸å¯¹æ€§èƒ½  â”‚");
        System.out.println("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤");
        System.out.printf("â”‚ é¥¿æ±‰å¼å•ä¾‹      â”‚ %10.2f  â”‚     åŸºå‡†    â”‚%n", 
                         eager / 1_000_000.0);
        System.out.printf("â”‚ æ‡’æ±‰å¼å•ä¾‹      â”‚ %10.2f  â”‚   %.2fx     â”‚%n", 
                         lazy / 1_000_000.0, (double)lazy / eager);
        System.out.printf("â”‚ æšä¸¾å¼å•ä¾‹      â”‚ %10.2f  â”‚   %.2fx     â”‚%n", 
                         enumTime / 1_000_000.0, (double)enumTime / eager);
        System.out.println("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");
        
        System.out.println("\nğŸ’¡ æ€§èƒ½åˆ†æ:");
        System.out.println("â€¢ é¥¿æ±‰å¼ï¼šæ€§èƒ½æœ€å¥½ï¼Œæ— åŒæ­¥å¼€é”€");
        System.out.println("â€¢ æ‡’æ±‰å¼ï¼šæœ‰åŒæ­¥å¼€é”€ï¼Œä½†æŒ‰éœ€åˆ›å»º");  
        System.out.println("â€¢ æšä¸¾å¼ï¼šæ€§èƒ½å¥½ä¸”æœ€å®‰å…¨");
    }
}
```

### 3.2 å†…å­˜ä½¿ç”¨åˆ†æ


```java
@Test
@DisplayName("å†…å­˜ä½¿ç”¨æµ‹è¯•")
public void memoryUsageTest() {
    Runtime runtime = Runtime.getRuntime();
    
    // ğŸ§¹ æ¸…ç†å†…å­˜
    System.gc();
    long beforeMemory = runtime.totalMemory() - runtime.freeMemory();
    
    // ğŸ“¦ åˆ›å»º1000ä¸ªå•ä¾‹å¼•ç”¨
    DatabaseManager[] managers = new DatabaseManager[1000];
    for (int i = 0; i < 1000; i++) {
        managers[i] = DatabaseManager.getInstance();
    }
    
    long afterMemory = runtime.totalMemory() - runtime.freeMemory();
    long memoryUsed = afterMemory - beforeMemory;
    
    System.out.println("ğŸ’¾ å†…å­˜ä½¿ç”¨åˆ†æ:");
    System.out.println("åˆ›å»ºå‰å†…å­˜: " + beforeMemory / 1024 + " KB");
    System.out.println("åˆ›å»ºåå†…å­˜: " + afterMemory / 1024 + " KB");
    System.out.println("æ–°å¢å†…å­˜: " + memoryUsed / 1024 + " KB");
    System.out.println("âœ… éªŒè¯ï¼š1000ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå†…å­˜å¢åŠ å¾ˆå°‘");
}
```

---

## 4. ğŸ—ï¸ å®é™…é¡¹ç›®é›†æˆ


### 4.1 Springæ¡†æ¶ä¸­çš„å•ä¾‹åº”ç”¨


> ğŸ“– **çŸ¥è¯†ç‚¹**ï¼šSpringæ¡†æ¶ä¸­çš„Beané»˜è®¤å°±æ˜¯å•ä¾‹æ¨¡å¼ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„å•ä¾‹åº”ç”¨åœºæ™¯ã€‚

```java
/**
 * ğŸŒ± SpringæœåŠ¡ç±» - é»˜è®¤å•ä¾‹
 * åœ¨Springå®¹å™¨ä¸­ï¼Œè¿™ä¸ªç±»åªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹
 */
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    // ğŸ“‹ ä¸šåŠ¡æ–¹æ³•
    public User findUserById(Long id) {
        return userRepository.findById(id);
    }
    
    public void saveUser(User user) {
        userRepository.save(user);
    }
}
```

### 4.2 æ—¥å¿—ç³»ç»Ÿé›†æˆç¤ºä¾‹


```java
/**
 * ğŸ“ åº”ç”¨çº§æ—¥å¿—ç®¡ç†å™¨
 * æ•´ä¸ªåº”ç”¨å…±ç”¨ä¸€ä¸ªæ—¥å¿—å®ä¾‹ï¼Œç»Ÿä¸€ç®¡ç†æ—¥å¿—è¾“å‡º
 */
public class ApplicationLogger {
    private static volatile ApplicationLogger instance;
    private final String loggerName;
    
    private ApplicationLogger() {
        this.loggerName = "APP-LOGGER-" + System.currentTimeMillis();
        initializeLogger();
    }
    
    public static ApplicationLogger getInstance() {
        if (instance == null) {
            synchronized (ApplicationLogger.class) {
                if (instance == null) {
                    instance = new ApplicationLogger();
                }
            }
        }
        return instance;
    }
    
    private void initializeLogger() {
        System.out.println("ğŸ”§ åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ: " + loggerName);
    }
    
    // ğŸ“„ ä¸åŒçº§åˆ«çš„æ—¥å¿—æ–¹æ³•
    public void info(String message) {
        System.out.println("â„¹ï¸ [INFO] " + getCurrentTime() + " - " + message);
    }
    
    public void error(String message) {
        System.err.println("âŒ [ERROR] " + getCurrentTime() + " - " + message);
    }
    
    public void warn(String message) {
        System.out.println("âš ï¸ [WARN] " + getCurrentTime() + " - " + message);
    }
    
    private String getCurrentTime() {
        return java.time.LocalDateTime.now().toString();
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```java
public class OrderService {
    private ApplicationLogger logger = ApplicationLogger.getInstance();
    
    public void processOrder(Order order) {
        logger.info("å¼€å§‹å¤„ç†è®¢å•: " + order.getId());
        
        try {
            // å¤„ç†è®¢å•é€»è¾‘
            validateOrder(order);
            saveOrder(order);
            logger.info("è®¢å•å¤„ç†æˆåŠŸ: " + order.getId());
        } catch (Exception e) {
            logger.error("è®¢å•å¤„ç†å¤±è´¥: " + e.getMessage());
            throw e;
        }
    }
}
```

### 4.3 é…ç½®ç®¡ç†å™¨å®é™…åº”ç”¨


```java
/**
 * âš™ï¸ åº”ç”¨é…ç½®ç®¡ç†å™¨
 * ç®¡ç†æ•´ä¸ªåº”ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°
 */
public class AppConfigManager {
    private static volatile AppConfigManager instance;
    private final Map<String, String> configs;
    
    private AppConfigManager() {
        this.configs = new ConcurrentHashMap<>();
        loadDefaultConfigs();
    }
    
    public static AppConfigManager getInstance() {
        if (instance == null) {
            synchronized (AppConfigManager.class) {
                if (instance == null) {
                    instance = new AppConfigManager();
                }
            }
        }
        return instance;
    }
    
    private void loadDefaultConfigs() {
        configs.put("app.name", "MyApplication");
        configs.put("app.version", "1.0.0");
        configs.put("db.url", "jdbc:mysql://localhost:3306/mydb");
        configs.put("cache.size", "1000");
    }
    
    // ğŸ“– è·å–é…ç½®
    public String getConfig(String key) {
        return configs.get(key);
    }
    
    public String getConfig(String key, String defaultValue) {
        return configs.getOrDefault(key, defaultValue);
    }
    
    // âœï¸ æ›´æ–°é…ç½®
    public void setConfig(String key, String value) {
        configs.put(key, value);
        System.out.println("ğŸ“ é…ç½®å·²æ›´æ–°: " + key + " = " + value);
    }
    
    // ğŸ“‹ è·å–æ‰€æœ‰é…ç½®
    public Map<String, String> getAllConfigs() {
        return new HashMap<>(configs);
    }
}
```

---

## 5. âš ï¸ å¸¸è§é”™è¯¯é¿å…


### 5.1 é”™è¯¯ç¤ºä¾‹ï¼šçº¿ç¨‹ä¸å®‰å…¨çš„æ‡’æ±‰å¼


```java
// âŒ é”™è¯¯å®ç°ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šåˆ›å»ºå¤šä¸ªå®ä¾‹
public class UnsafeSingleton {
    private static UnsafeSingleton instance;
    
    private UnsafeSingleton() {}
    
    // ğŸš« å±é™©ï¼šæ²¡æœ‰åŒæ­¥æ§åˆ¶
    public static UnsafeSingleton getInstance() {
        if (instance == null) {
            // âš ï¸ é—®é¢˜ï¼šå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶æ‰§è¡Œåˆ°è¿™é‡Œ
            instance = new UnsafeSingleton();
        }
        return instance;
    }
}
```

**é—®é¢˜åˆ†æï¼š**
```
çº¿ç¨‹æ‰§è¡Œæ—¶åºé—®é¢˜ï¼š
çº¿ç¨‹A: æ£€æŸ¥instance == null âœ“ 
çº¿ç¨‹B: æ£€æŸ¥instance == null âœ“  (åŒæ—¶è¿›å…¥)
çº¿ç¨‹A: åˆ›å»ºæ–°å®ä¾‹ â†’ instance = new UnsafeSingleton()
çº¿ç¨‹B: åˆ›å»ºæ–°å®ä¾‹ â†’ instance = new UnsafeSingleton() (è¦†ç›–Açš„å®ä¾‹)

ç»“æœï¼šåˆ›å»ºäº†å¤šä¸ªå®ä¾‹ï¼Œè¿èƒŒå•ä¾‹åŸåˆ™
```

### 5.2 é”™è¯¯ç¤ºä¾‹ï¼šè¿‡åº¦åŒæ­¥


```java
// âŒ é”™è¯¯å®ç°ï¼šæ€§èƒ½ä½ä¸‹çš„åŒæ­¥æ–¹å¼
public class OverSynchronizedSingleton {
    private static OverSynchronizedSingleton instance;
    
    private OverSynchronizedSingleton() {}
    
    // ğŸŒ æ€§èƒ½é—®é¢˜ï¼šæ¯æ¬¡è°ƒç”¨éƒ½è¦åŒæ­¥
    public static synchronized OverSynchronizedSingleton getInstance() {
        if (instance == null) {
            instance = new OverSynchronizedSingleton();
        }
        return instance;
    }
}
```

**é—®é¢˜åˆ†æï¼š**
- ğŸŒ **æ€§èƒ½ä½ä¸‹**ï¼šå³ä½¿å®ä¾‹å·²åˆ›å»ºï¼Œæ¯æ¬¡è°ƒç”¨ä»éœ€è·å–é”
- ğŸ”’ **ä¸å¿…è¦çš„é˜»å¡**ï¼šå¤šä¸ªçº¿ç¨‹è¯»å–å·²åˆ›å»ºçš„å®ä¾‹æ—¶ä¹Ÿä¼šæ’é˜Ÿç­‰å¾…

### 5.3 é”™è¯¯ç¤ºä¾‹ï¼šå¿˜è®°å¤„ç†åå°„æ”»å‡»


```java
// âŒ è„†å¼±å®ç°ï¼šå®¹æ˜“è¢«åå°„æ”»å‡»
public class VulnerableSingleton {
    private static VulnerableSingleton instance = new VulnerableSingleton();
    
    private VulnerableSingleton() {
        // ğŸš« æ²¡æœ‰é˜²æŠ¤æªæ–½
    }
    
    public static VulnerableSingleton getInstance() {
        return instance;
    }
}

// ğŸ’€ æ”»å‡»ä»£ç ç¤ºä¾‹
public class ReflectionAttack {
    public static void main(String[] args) throws Exception {
        // æ­£å¸¸è·å–å•ä¾‹
        VulnerableSingleton instance1 = VulnerableSingleton.getInstance();
        
        // ğŸ˜ˆ åå°„æ”»å‡»ï¼šå¼ºåˆ¶åˆ›å»ºæ–°å®ä¾‹
        Constructor<VulnerableSingleton> constructor = 
            VulnerableSingleton.class.getDeclaredConstructor();
        constructor.setAccessible(true);
        VulnerableSingleton instance2 = constructor.newInstance();
        
        // ğŸ’¥ ç»“æœï¼šç ´åäº†å•ä¾‹ç‰¹æ€§
        System.out.println("å®ä¾‹1: " + instance1.hashCode());
        System.out.println("å®ä¾‹2: " + instance2.hashCode());
        System.out.println("æ˜¯å¦ç›¸åŒ: " + (instance1 == instance2)); // false
    }
}
```

### 5.4 é˜²æŠ¤æªæ–½ï¼šå®‰å…¨çš„å•ä¾‹å®ç°


```java
// âœ… å®‰å…¨å®ç°ï¼šé˜²åå°„æ”»å‡»çš„å•ä¾‹
public class SecureSingleton {
    private static volatile SecureSingleton instance;
    
    private SecureSingleton() {
        // ğŸ›¡ï¸ é˜²åå°„æ”»å‡»
        if (instance != null) {
            throw new RuntimeException("âš ï¸ å•ä¾‹å·²å­˜åœ¨ï¼Œç¦æ­¢é€šè¿‡åå°„åˆ›å»ºæ–°å®ä¾‹ï¼");
        }
    }
    
    public static SecureSingleton getInstance() {
        if (instance == null) {
            synchronized (SecureSingleton.class) {
                if (instance == null) {
                    instance = new SecureSingleton();
                }
            }
        }
        return instance;
    }
}
```

### 5.5 æœ€ä½³å®è·µæ€»ç»“


| å®ç°æ–¹å¼ | **çº¿ç¨‹å®‰å…¨** | **æ€§èƒ½** | **é˜²åå°„** | **æ¨èç¨‹åº¦** |
|---------|-------------|---------|-----------|-------------|
| ğŸŒ **åŒæ­¥æ–¹æ³•** | `âœ… å®‰å…¨` | `âŒ è¾ƒæ…¢` | `âŒ è„†å¼±` | `â­â­` |
| âš¡ **åŒé‡æ£€æŸ¥** | `âœ… å®‰å…¨` | `âœ… è¾ƒå¥½` | `âŒ è„†å¼±` | `â­â­â­â­` |
| ğŸš€ **é¥¿æ±‰å¼** | `âœ… å®‰å…¨` | `âœ… æœ€å¥½` | `âŒ è„†å¼±` | `â­â­â­` |
| ğŸ›¡ï¸ **æšä¸¾å¼** | `âœ… å®‰å…¨` | `âœ… å¾ˆå¥½` | `âœ… å®‰å…¨` | `â­â­â­â­â­` |

> ğŸ’¡ **æ¨èç­–ç•¥**ï¼š
> - **ä¸€èˆ¬æƒ…å†µ**ï¼šä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šçš„æ‡’æ±‰å¼
> - **è¦æ±‚æœ€é«˜å®‰å…¨æ€§**ï¼šä½¿ç”¨æšä¸¾å•ä¾‹
> - **è¿½æ±‚æè‡´æ€§èƒ½**ï¼šä½¿ç”¨é¥¿æ±‰å¼ï¼ˆå¦‚æœå†…å­˜ä¸æ˜¯é—®é¢˜ï¼‰

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ å•ä¾‹æ¨¡å¼æœ¬è´¨ï¼šç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæä¾›ç»Ÿä¸€è®¿é—®ç‚¹
ğŸ”¸ æ ¸å¿ƒè¦ç´ ï¼šç§æœ‰æ„é€ å‡½æ•° + é™æ€è·å–æ–¹æ³• + é™æ€å®ä¾‹å˜é‡
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¿…é¡»è€ƒè™‘åŒæ­¥é—®é¢˜
ğŸ”¸ æ€§èƒ½å¹³è¡¡ï¼šåœ¨çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šé˜²æ­¢åå°„ã€åºåˆ—åŒ–ç­‰æ–¹å¼ç ´åå•ä¾‹ç‰¹æ€§
```

### 6.2 å®ç°æ–¹å¼é€‰æ‹©æŒ‡å—


**ğŸ¯ é€‰æ‹©å†³ç­–æ ‘ï¼š**
```
æ˜¯å¦è¦æ±‚æ‡’åŠ è½½ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ˜¯å¦è¦æ±‚æœ€é«˜å®‰å…¨æ€§ï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ æšä¸¾å•ä¾‹ â­â­â­â­â­
â”‚   â””â”€ å¦ â†’ åŒé‡æ£€æŸ¥é”å®š â­â­â­â­
â””â”€ å¦ â†’ é¥¿æ±‰å¼å•ä¾‹ â­â­â­
```

### 6.3 åº”ç”¨åœºæ™¯åˆ¤æ–­


**âœ… é€‚åˆä½¿ç”¨å•ä¾‹çš„åœºæ™¯ï¼š**
- ğŸ“ **æ—¥å¿—ç®¡ç†å™¨**ï¼šå…¨å±€ç»Ÿä¸€æ—¥å¿—è®°å½•
- âš™ï¸ **é…ç½®ç®¡ç†å™¨**ï¼šåº”ç”¨é…ç½®ä¿¡æ¯ç®¡ç†
- ğŸ”— **æ•°æ®åº“è¿æ¥æ± **ï¼šæ§åˆ¶æ•°æ®åº“è¿æ¥æ•°é‡
- ğŸ® **æ¸¸æˆç®¡ç†å™¨**ï¼šæ¸¸æˆçŠ¶æ€å’Œé€»è¾‘æ§åˆ¶
- ğŸ–¨ï¸ **æ‰“å°æœºç®¡ç†**ï¼šæ§åˆ¶æ‰“å°ä»»åŠ¡é˜Ÿåˆ—

**âŒ ä¸é€‚åˆä½¿ç”¨å•ä¾‹çš„åœºæ™¯ï¼š**
- ğŸ‘¤ **ç”¨æˆ·å¯¹è±¡**ï¼šæ¯ä¸ªç”¨æˆ·éƒ½æ˜¯ç‹¬ç«‹çš„
- ğŸ“¦ **è®¢å•å¯¹è±¡**ï¼šæ¯ä¸ªè®¢å•éƒ½æ˜¯å”¯ä¸€çš„
- ğŸ² **éšæœºæ•°ç”Ÿæˆå™¨**ï¼šå¯èƒ½éœ€è¦å¤šä¸ªç‹¬ç«‹çš„ç”Ÿæˆå™¨
- ğŸ“Š **æ•°æ®ä¼ è¾“å¯¹è±¡**ï¼šçº¯æ•°æ®è½½ä½“ï¼Œæ— çŠ¶æ€ç®¡ç†éœ€æ±‚

### 6.4 å­¦ä¹ è·¯å¾„å»ºè®®


```
é˜¶æ®µ1: åŸºç¡€ç†è§£ ğŸ“š
â””â”€ ç†è§£å•ä¾‹æ¦‚å¿µå’Œåº”ç”¨åœºæ™¯

é˜¶æ®µ2: å®ç°æŒæ¡ ğŸ’»  
â””â”€ æŒæ¡3ç§ä¸»è¦å®ç°æ–¹å¼

é˜¶æ®µ3: é—®é¢˜è§£å†³ ğŸ”§
â””â”€ äº†è§£çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½é—®é¢˜

é˜¶æ®µ4: å®æˆ˜åº”ç”¨ ğŸš€
â””â”€ åœ¨çœŸå®é¡¹ç›®ä¸­åˆç†ä½¿ç”¨å•ä¾‹

é˜¶æ®µ5: æ·±å…¥ä¼˜åŒ– âš¡
â””â”€ å¤„ç†é«˜çº§é—®é¢˜ï¼ˆåå°„æ”»å‡»ã€åºåˆ—åŒ–ç­‰ï¼‰
```

### 6.5 é¢è¯•é‡ç‚¹


**ğŸ’¼ å¸¸è§é¢è¯•é—®é¢˜ï¼š**
1. **æ¦‚å¿µç†è§£**ï¼šä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ
2. **å®ç°æ–¹å¼**ï¼šè¯´å‡ºå‡ ç§å•ä¾‹å®ç°æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹
3. **çº¿ç¨‹å®‰å…¨**ï¼šå¦‚ä½•ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å•ä¾‹å®‰å…¨ï¼Ÿ
4. **æ€§èƒ½è€ƒè™‘**ï¼šåŒé‡æ£€æŸ¥é”å®šçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
5. **å®é™…åº”ç”¨**ï¼šåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Ÿ

**ğŸ¯ å›ç­”è¦ç‚¹ï¼š**
- ä»**ç”Ÿæ´»ä¾‹å­**å¼€å§‹è§£é‡Šæ¦‚å¿µ
- é‡ç‚¹è¯´æ˜**çº¿ç¨‹å®‰å…¨**çš„é‡è¦æ€§
- èƒ½å¤Ÿ**æ‰‹å†™ä»£ç **å¹¶è§£é‡Šå…³é”®ç‚¹
- ç»“åˆ**å®é™…é¡¹ç›®ç»éªŒ**è°ˆåº”ç”¨

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
- å•ä¾‹æ¨¡å¼ä¿å”¯ä¸€ï¼Œå…¨å±€è®¿é—®ç»Ÿä¸€ç‚¹
- ç§æœ‰æ„é€ é˜²å¤–è°ƒï¼Œé™æ€æ–¹æ³•è·å®ä¾‹
- çº¿ç¨‹å®‰å…¨è¦è€ƒè™‘ï¼ŒåŒé‡æ£€æŸ¥æ˜¯å…³é”®
- æšä¸¾å®ç°æœ€å®‰å…¨ï¼Œé€‰æ‹©æ–¹æ¡ˆçœ‹éœ€æ±‚