---
title: 3ã€å·¥å‚æ–¹æ³•æ¨¡å¼å®ç°æŠ€å·§
---
## ğŸ“š ç›®å½•

1. [å·¥å‚ç±»è®¾è®¡è¦ç‚¹](#1-å·¥å‚ç±»è®¾è®¡è¦ç‚¹)
2. [äº§å“ç±»å±‚æ¬¡ç»“æ„](#2-äº§å“ç±»å±‚æ¬¡ç»“æ„)
3. [å·¥å‚æ³¨å†Œæœºåˆ¶](#3-å·¥å‚æ³¨å†Œæœºåˆ¶)
4. [åå°„åŠ¨æ€åˆ›å»º](#4-åå°„åŠ¨æ€åˆ›å»º)
5. [é…ç½®æ–‡ä»¶é©±åŠ¨](#5-é…ç½®æ–‡ä»¶é©±åŠ¨)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ­ å·¥å‚ç±»è®¾è®¡è¦ç‚¹


### 1.1 ä»€ä¹ˆæ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸‹ç°å®ä¸­çš„å·¥å‚ï¼Œæ¯”å¦‚æ±½è½¦å·¥å‚

```
ç°å®ä¸­çš„æ±½è½¦å·¥å‚ï¼š                ä»£ç ä¸­çš„å·¥å‚æ–¹æ³•ï¼š
    
    æ±½è½¦å·¥å‚                        æŠ½è±¡å·¥å‚ç±»
   (ç”Ÿäº§æ±½è½¦)                      (åˆ›å»ºäº§å“æ–¹æ³•)
       |                              |
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”                      â”Œâ”€â”€â”€â”´â”€â”€â”€â”
  å¥”é©°å·¥å‚  å®é©¬å·¥å‚                å¥”é©°å·¥å‚  å®é©¬å·¥å‚
 (ç”Ÿäº§å¥”é©°)(ç”Ÿäº§å®é©¬)              (åˆ›å»ºå¥”é©°)(åˆ›å»ºå®é©¬)
       |        |                      |        |
     å¥”é©°è½¦    å®é©¬è½¦                  å¥”é©°å¯¹è±¡  å®é©¬å¯¹è±¡
```

**æ ¸å¿ƒæ€æƒ³**ï¼šæ¯ç§äº§å“éƒ½æœ‰è‡ªå·±ä¸“é—¨çš„å·¥å‚æ¥ç”Ÿäº§ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå·¥å‚ç”Ÿäº§æ‰€æœ‰äº§å“

### 1.2 å·¥å‚ç±»çš„è®¾è®¡åŸåˆ™


**ğŸ“‹ è®¾è®¡è¦ç‚¹**ï¼š

```
ğŸ”¸ å•ä¸€èŒè´£ï¼šæ¯ä¸ªå·¥å‚åªè´Ÿè´£åˆ›å»ºä¸€ç§äº§å“
ğŸ”¸ å¼€é—­åŸåˆ™ï¼šå¢åŠ æ–°äº§å“æ—¶ï¼Œåªéœ€æ·»åŠ æ–°å·¥å‚ï¼Œä¸ä¿®æ”¹ç°æœ‰ä»£ç 
ğŸ”¸ ä¾èµ–å€’ç½®ï¼šä¾èµ–æŠ½è±¡å·¥å‚ï¼Œè€Œä¸æ˜¯å…·ä½“å·¥å‚
ğŸ”¸ é‡Œæ°æ›¿æ¢ï¼šä»»ä½•å…·ä½“å·¥å‚éƒ½å¯ä»¥æ›¿æ¢æŠ½è±¡å·¥å‚
```

### 1.3 åŸºç¡€å·¥å‚ç±»ç»“æ„


**ğŸ—ï¸ æŠ½è±¡å·¥å‚ç±»**ï¼šå®šä¹‰åˆ›å»ºäº§å“çš„æ ‡å‡†

```java
// æŠ½è±¡å·¥å‚ï¼šå®šä¹‰ç”Ÿäº§äº§å“çš„è§„èŒƒ
public abstract class VehicleFactory {
    
    // å·¥å‚æ–¹æ³•ï¼šå­ç±»å¿…é¡»å®ç°çš„åˆ›å»ºæ–¹æ³•
    public abstract Vehicle createVehicle();
    
    // æ¨¡æ¿æ–¹æ³•ï¼šé€šç”¨çš„ä¸šåŠ¡æµç¨‹
    public Vehicle orderVehicle() {
        System.out.println("å¼€å§‹ç”Ÿäº§è½¦è¾†...");
        
        // è°ƒç”¨å·¥å‚æ–¹æ³•åˆ›å»ºå…·ä½“äº§å“
        Vehicle vehicle = createVehicle();
        
        // é€šç”¨çš„åå¤„ç†æµç¨‹
        vehicle.assemble();  // ç»„è£…
        vehicle.test();      // æµ‹è¯•
        vehicle.deliver();   // äº¤ä»˜
        
        System.out.println("è½¦è¾†ç”Ÿäº§å®Œæˆï¼");
        return vehicle;
    }
}
```

**ğŸ”§ å…·ä½“å·¥å‚ç±»**ï¼šå®ç°å…·ä½“äº§å“çš„åˆ›å»º

```java
// å¥”é©°å·¥å‚ï¼šä¸“é—¨ç”Ÿäº§å¥”é©°è½¦
public class BenzFactory extends VehicleFactory {
    @Override
    public Vehicle createVehicle() {
        System.out.println("å¥”é©°å·¥å‚å¼€å§‹ç”Ÿäº§å¥”é©°è½¦");
        return new BenzCar();
    }
}

// å®é©¬å·¥å‚ï¼šä¸“é—¨ç”Ÿäº§å®é©¬è½¦
public class BMWFactory extends VehicleFactory {
    @Override
    public Vehicle createVehicle() {
        System.out.println("å®é©¬å·¥å‚å¼€å§‹ç”Ÿäº§å®é©¬è½¦");
        return new BMWCar();
    }
}
```

### 1.4 å·¥å‚ç±»è®¾è®¡æŠ€å·§


**ğŸ’¡ è®¾è®¡æŠ€å·§å¯¹æ¯”**ï¼š

| è®¾è®¡æ–¹é¢ | **ä¸å¥½çš„è®¾è®¡** | **å¥½çš„è®¾è®¡** | **ä¸ºä»€ä¹ˆè¿™æ ·åš** |
|---------|--------------|-------------|----------------|
| **æ–¹æ³•å‘½å** | `create()` | `createVehicle()` | `æ˜ç¡®è¡¨è¾¾åˆ›å»ºçš„æ˜¯ä»€ä¹ˆ` |
| **å‚æ•°è®¾è®¡** | `create(String type, Map params)` | `createSportsCar(String color)` | `ç±»å‹å®‰å…¨ï¼Œå‚æ•°æ¸…æ™°` |
| **å¼‚å¸¸å¤„ç†** | `è¿”å›null` | `æŠ›å‡ºå¼‚å¸¸` | `æ˜ç¡®è¡¨è¾¾å¤±è´¥åŸå› ` |
| **æ—¥å¿—è®°å½•** | `æ— æ—¥å¿—` | `è®°å½•åˆ›å»ºè¿‡ç¨‹` | `ä¾¿äºè°ƒè¯•å’Œç›‘æ§` |

**ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```java
// æ”¹è¿›åçš„å·¥å‚è®¾è®¡
public class BenzFactory extends VehicleFactory {
    
    @Override
    public Vehicle createVehicle() {
        try {
            // è®°å½•åˆ›å»ºè¿‡ç¨‹
            logger.info("å¼€å§‹åˆ›å»ºå¥”é©°è½¦è¾†");
            
            // åˆ›å»ºäº§å“
            BenzCar car = new BenzCar();
            
            // è®¾ç½®é»˜è®¤é…ç½®
            car.setEngine("V8å¼•æ“");
            car.setColor("é»‘è‰²");
            
            logger.info("å¥”é©°è½¦è¾†åˆ›å»ºæˆåŠŸ");
            return car;
            
        } catch (Exception e) {
            logger.error("åˆ›å»ºå¥”é©°è½¦è¾†å¤±è´¥: " + e.getMessage());
            throw new VehicleCreationException("æ— æ³•åˆ›å»ºå¥”é©°è½¦è¾†", e);
        }
    }
}
```

---

## 2. ğŸŒ³ äº§å“ç±»å±‚æ¬¡ç»“æ„


### 2.1 äº§å“ç±»å±‚æ¬¡çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦å±‚æ¬¡ç»“æ„**ï¼šå°±åƒç”Ÿç‰©åˆ†ç±»å­¦ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç»™äº§å“åˆ†ç±»

```
ç”Ÿç‰©åˆ†ç±»ï¼š                    äº§å“åˆ†ç±»ï¼š
    
   åŠ¨ç‰©ç•Œ                       äº¤é€šå·¥å…·
     |                           |
   å“ºä¹³ç±»                       è½¦è¾†ç±»
  /     \                      /     \
 çŒ«ç§‘   çŠ¬ç§‘                  è½¿è½¦   å¡è½¦
 |       |                    |      |
è€è™   ç‹®å­                  å¥”é©°   å®é©¬
```

### 2.2 äº§å“æ¥å£è®¾è®¡


**ğŸ”¸ æŠ½è±¡äº§å“æ¥å£**ï¼šå®šä¹‰æ‰€æœ‰äº§å“çš„å…±åŒè¡Œä¸º

```java
// è½¦è¾†æ¥å£ï¼šå®šä¹‰æ‰€æœ‰è½¦è¾†çš„åŸºæœ¬è¡Œä¸º
public interface Vehicle {
    
    // åŸºæœ¬æ“ä½œ
    void start();           // å¯åŠ¨
    void stop();            // åœæ­¢
    void accelerate();      // åŠ é€Ÿ
    
    // ç”Ÿäº§æµç¨‹æ–¹æ³•
    void assemble();        // ç»„è£…
    void test();            // æµ‹è¯•  
    void deliver();         // äº¤ä»˜
    
    // è·å–è½¦è¾†ä¿¡æ¯
    String getBrand();      // å“ç‰Œ
    String getModel();      // å‹å·
    double getPrice();      // ä»·æ ¼
}
```

### 2.3 å…·ä½“äº§å“ç±»å®ç°


**ğŸš— å…·ä½“äº§å“ç±»**ï¼šå®ç°æŠ½è±¡äº§å“çš„å…·ä½“è¡Œä¸º

```java
// å¥”é©°è½¦çš„å…·ä½“å®ç°
public class BenzCar implements Vehicle {
    
    private String model = "å¥”é©°Eçº§";
    private double price = 500000;
    
    @Override
    public void start() {
        System.out.println("å¥”é©°è½¦å¯åŠ¨ï¼šå¼•æ“å£°éŸ³ä½æ²‰æœ‰åŠ›");
    }
    
    @Override
    public void accelerate() {
        System.out.println("å¥”é©°è½¦åŠ é€Ÿï¼šå¹³ç¨³è€Œå¼ºåŠ²");
    }
    
    @Override
    public String getBrand() {
        return "å¥”é©°";
    }
    
    // å¥”é©°ç‰¹æœ‰çš„æ–¹æ³•
    public void activateAutoPilot() {
        System.out.println("æ¿€æ´»å¥”é©°è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿ");
    }
}
```

### 2.4 äº§å“ç³»åˆ—è®¾è®¡


**ğŸ¯ äº§å“ç³»åˆ—åŒ–ç®¡ç†**ï¼šå°†ç›¸å…³äº§å“ç»„ç»‡æˆç³»åˆ—

```java
// æŒ‰è½¦å‹ç³»åˆ—åˆ’åˆ†
public abstract class SportsCarSeries implements Vehicle {
    protected int horsepower;    // é©¬åŠ›
    protected int topSpeed;      // æœ€é«˜é€Ÿåº¦
    
    // è·‘è½¦é€šç”¨è¡Œä¸º
    public void drift() {
        System.out.println("è·‘è½¦æ¼‚ç§»ä¸­...");
    }
}

public abstract class SUVSeries implements Vehicle {
    protected int groundClearance;  // ç¦»åœ°é—´éš™
    protected boolean fourWheelDrive; // å››é©±
    
    // SUVé€šç”¨è¡Œä¸º
    public void offRoad() {
        System.out.println("SUVè¶Šé‡ä¸­...");
    }
}
```

**ğŸ”— äº§å“å…³ç³»å›¾ç¤º**ï¼š

```
Vehicleæ¥å£
    |
    â”œâ”€â”€ SportsCarSeriesï¼ˆè·‘è½¦ç³»åˆ—ï¼‰
    |    â”œâ”€â”€ BenzSportsCar
    |    â””â”€â”€ BMWSportsCar
    |
    â”œâ”€â”€ SUVSeriesï¼ˆSUVç³»åˆ—ï¼‰
    |    â”œâ”€â”€ BenzSUV
    |    â””â”€â”€ BMWSUV
    |
    â””â”€â”€ SedanSeriesï¼ˆè½¿è½¦ç³»åˆ—ï¼‰
         â”œâ”€â”€ BenzSedan
         â””â”€â”€ BMWSedan
```

---

## 3. ğŸ“ å·¥å‚æ³¨å†Œæœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯å·¥å‚æ³¨å†Œæœºåˆ¶


**é€šä¿—ç†è§£**ï¼šå°±åƒç”µè¯ç°¿ä¸€æ ·ï¼ŒæŠŠæ‰€æœ‰å·¥å‚çš„"ç”µè¯å·ç "è®°å½•ä¸‹æ¥

```
ä¼ ç»Ÿæ–¹å¼ï¼š                    æ³¨å†Œæœºåˆ¶ï¼š
å®¢æˆ·æƒ³è¦å®é©¬è½¦                å®¢æˆ·æƒ³è¦å®é©¬è½¦
    â†“                           â†“
ç›´æ¥æ‰¾å®é©¬å·¥å‚               æŸ¥æ‰¾å·¥å‚æ³¨å†Œè¡¨
(ç¡¬ç¼–ç è€¦åˆ)                (åŠ¨æ€æŸ¥æ‰¾)
    â†“                           â†“
new BMWFactory()            registry.getFactory("BMW")
```

### 3.2 å·¥å‚æ³¨å†Œè¡¨è®¾è®¡


**ğŸ—‚ï¸ æ³¨å†Œè¡¨å®ç°**ï¼š

```java
// å·¥å‚æ³¨å†Œè¡¨ï¼šç®¡ç†æ‰€æœ‰å·¥å‚
public class FactoryRegistry {
    
    // å·¥å‚å­˜å‚¨å®¹å™¨ï¼šå“ç‰Œå -> å·¥å‚å®ä¾‹
    private static Map<String, VehicleFactory> factories = new HashMap<>();
    
    // æ³¨å†Œå·¥å‚
    public static void registerFactory(String brand, VehicleFactory factory) {
        if (brand == null || factory == null) {
            throw new IllegalArgumentException("å“ç‰Œå’Œå·¥å‚éƒ½ä¸èƒ½ä¸ºç©º");
        }
        
        factories.put(brand.toLowerCase(), factory);
        System.out.println("å·¥å‚æ³¨å†ŒæˆåŠŸï¼š" + brand);
    }
    
    // è·å–å·¥å‚
    public static VehicleFactory getFactory(String brand) {
        VehicleFactory factory = factories.get(brand.toLowerCase());
        
        if (factory == null) {
            throw new FactoryNotFoundException("æœªæ‰¾åˆ°å“ç‰Œå·¥å‚ï¼š" + brand);
        }
        
        return factory;
    }
    
    // è·å–æ‰€æœ‰å·²æ³¨å†Œçš„å“ç‰Œ
    public static Set<String> getAvailableBrands() {
        return new HashSet<>(factories.keySet());
    }
}
```

### 3.3 è‡ªåŠ¨æ³¨å†Œæœºåˆ¶


**ğŸ”„ è‡ªåŠ¨æ³¨å†Œå®ç°**ï¼šè®©å·¥å‚åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ³¨å†Œè‡ªå·±

```java
// å¯æ³¨å†Œçš„å·¥å‚æ¥å£
public interface RegisterableFactory {
    String getBrandName();  // è·å–å“ç‰Œåç§°
    int getPriority();      // è·å–ä¼˜å…ˆçº§
}

// å¥”é©°å·¥å‚å®ç°è‡ªåŠ¨æ³¨å†Œ
public class BenzFactory extends VehicleFactory implements RegisterableFactory {
    
    // é™æ€ä»£ç å—ï¼šç±»åŠ è½½æ—¶è‡ªåŠ¨æ³¨å†Œ
    static {
        FactoryRegistry.registerFactory("benz", new BenzFactory());
    }
    
    @Override
    public String getBrandName() {
        return "benz";
    }
    
    @Override
    public int getPriority() {
        return 1;  // ä¼˜å…ˆçº§ï¼šæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
    }
    
    @Override
    public Vehicle createVehicle() {
        return new BenzCar();
    }
}
```

### 3.4 æ³¨å†Œæœºåˆ¶çš„ä½¿ç”¨åœºæ™¯


**ğŸ¯ å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```java
// å®¢æˆ·ç«¯ä½¿ç”¨æ³¨å†Œæœºåˆ¶
public class VehicleOrderService {
    
    public Vehicle orderVehicle(String brand) {
        try {
            // ä»æ³¨å†Œè¡¨è·å–å¯¹åº”å·¥å‚
            VehicleFactory factory = FactoryRegistry.getFactory(brand);
            
            // ä½¿ç”¨å·¥å‚åˆ›å»ºè½¦è¾†
            return factory.orderVehicle();
            
        } catch (FactoryNotFoundException e) {
            System.out.println("æŠ±æ­‰ï¼Œæˆ‘ä»¬ä¸ç”Ÿäº§" + brand + "å“ç‰Œçš„è½¦è¾†");
            System.out.println("å¯é€‰å“ç‰Œï¼š" + FactoryRegistry.getAvailableBrands());
            return null;
        }
    }
}
```

**âœ… æ³¨å†Œæœºåˆ¶çš„ä¼˜ç‚¹**ï¼š

- **æ¾è€¦åˆ**ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“å·¥å‚ç±»
- **æ˜“æ‰©å±•**ï¼šæ–°å¢å·¥å‚åªéœ€æ³¨å†Œå³å¯
- **é…ç½®åŒ–**ï¼šå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†å·¥å‚
- **åŠ¨æ€æ€§**ï¼šè¿è¡Œæ—¶å¯ä»¥å¢å‡å·¥å‚

---

## 4. ğŸ” åå°„åŠ¨æ€åˆ›å»º


### 4.1 ä»€ä¹ˆæ˜¯åå°„åŠ¨æ€åˆ›å»º


**é€šä¿—ç†è§£**ï¼šåå°„å°±åƒæ˜¯ä¸€é¢é­”é•œï¼Œèƒ½å¤Ÿæ ¹æ®åå­—å˜å‡ºå¯¹åº”çš„ä¸œè¥¿

```
ä¼ ç»Ÿåˆ›å»ºæ–¹å¼ï¼š                åå°„åˆ›å»ºæ–¹å¼ï¼š
çŸ¥é“å…·ä½“ç±»å                  åªçŸ¥é“ç±»åå­—ç¬¦ä¸²
    â†“                           â†“
new BenzFactory()             Class.forName("BenzFactory")
(ç¼–è¯‘æ—¶ç¡®å®š)                   .newInstance()
                              (è¿è¡Œæ—¶ç¡®å®š)
```

### 4.2 åå°„å·¥å‚å®ç°


**ğŸª åå°„å·¥å‚ç±»**ï¼š

```java
// åå°„å·¥å‚ï¼šæ ¹æ®ç±»ååŠ¨æ€åˆ›å»ºå·¥å‚
public class ReflectiveFactory {
    
    // å·¥å‚ç±»åŒ…è·¯å¾„
    private static final String FACTORY_PACKAGE = "com.example.factory.";
    
    /**
     * æ ¹æ®å“ç‰ŒååŠ¨æ€åˆ›å»ºå·¥å‚
     * @param brandName å“ç‰Œåï¼ˆå¦‚ï¼š"benz", "bmw"ï¼‰
     * @return å¯¹åº”çš„å·¥å‚å®ä¾‹
     */
    public static VehicleFactory createFactory(String brandName) {
        try {
            // æ„é€ å·¥å‚ç±»åï¼šbenz -> BenzFactory
            String factoryClassName = FACTORY_PACKAGE + 
                capitalize(brandName) + "Factory";
            
            // ä½¿ç”¨åå°„åŠ è½½ç±»
            Class<?> factoryClass = Class.forName(factoryClassName);
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯VehicleFactoryçš„å­ç±»
            if (!VehicleFactory.class.isAssignableFrom(factoryClass)) {
                throw new IllegalArgumentException(
                    factoryClassName + " ä¸æ˜¯æœ‰æ•ˆçš„è½¦è¾†å·¥å‚ç±»");
            }
            
            // åˆ›å»ºå·¥å‚å®ä¾‹
            return (VehicleFactory) factoryClass.newInstance();
            
        } catch (ClassNotFoundException e) {
            throw new FactoryNotFoundException(
                "æœªæ‰¾åˆ°å“ç‰Œ " + brandName + " å¯¹åº”çš„å·¥å‚ç±»", e);
        } catch (Exception e) {
            throw new FactoryCreationException(
                "åˆ›å»ºå·¥å‚å®ä¾‹å¤±è´¥: " + brandName, e);
        }
    }
    
    // é¦–å­—æ¯å¤§å†™å·¥å…·æ–¹æ³•
    private static String capitalize(String str) {
        if (str == null || str.isEmpty()) {
            return str;
        }
        return str.substring(0, 1).toUpperCase() + str.substring(1).toLowerCase();
    }
}
```

### 4.3 å¸¦å‚æ•°çš„åå°„åˆ›å»º


**ğŸ”§ å‚æ•°åŒ–åå°„å·¥å‚**ï¼š

```java
// æ”¯æŒå‚æ•°çš„åå°„å·¥å‚
public class ParameterizedReflectiveFactory {
    
    /**
     * æ ¹æ®å“ç‰Œå’Œé…ç½®åˆ›å»ºå·¥å‚
     * @param brandName å“ç‰Œå
     * @param config é…ç½®å‚æ•°
     * @return é…ç½®å¥½çš„å·¥å‚å®ä¾‹
     */
    public static VehicleFactory createFactory(String brandName, 
                                             Map<String, Object> config) {
        try {
            String factoryClassName = "com.example.factory." + 
                capitalize(brandName) + "Factory";
            
            Class<?> factoryClass = Class.forName(factoryClassName);
            
            // æŸ¥æ‰¾å¸¦é…ç½®å‚æ•°çš„æ„é€ å™¨
            Constructor<?> constructor = factoryClass
                .getConstructor(Map.class);
            
            // ä½¿ç”¨æ„é€ å™¨åˆ›å»ºå®ä¾‹
            return (VehicleFactory) constructor.newInstance(config);
            
        } catch (NoSuchMethodException e) {
            // å¦‚æœæ²¡æœ‰å¸¦å‚æ„é€ å™¨ï¼Œä½¿ç”¨é»˜è®¤æ„é€ å™¨
            return createFactory(brandName);
        } catch (Exception e) {
            throw new FactoryCreationException(
                "åˆ›å»ºå‚æ•°åŒ–å·¥å‚å¤±è´¥: " + brandName, e);
        }
    }
}
```

### 4.4 åå°„ç¼“å­˜ä¼˜åŒ–


**âš¡ ç¼“å­˜ä¼˜åŒ–ç­–ç•¥**ï¼š

```java
// å¸¦ç¼“å­˜çš„åå°„å·¥å‚
public class CachedReflectiveFactory {
    
    // å·¥å‚ç±»ç¼“å­˜ï¼šé¿å…é‡å¤åå°„
    private static final Map<String, Class<?>> classCache = new ConcurrentHashMap<>();
    
    // å·¥å‚å®ä¾‹ç¼“å­˜ï¼šå¤ç”¨å·¥å‚å®ä¾‹
    private static final Map<String, VehicleFactory> instanceCache = new ConcurrentHashMap<>();
    
    public static VehicleFactory getFactory(String brandName) {
        // å…ˆä»å®ä¾‹ç¼“å­˜è·å–
        VehicleFactory cachedFactory = instanceCache.get(brandName);
        if (cachedFactory != null) {
            return cachedFactory;
        }
        
        // ä»ç±»ç¼“å­˜è·å–Classå¯¹è±¡
        Class<?> factoryClass = classCache.computeIfAbsent(brandName, brand -> {
            try {
                String className = "com.example.factory." + 
                    capitalize(brand) + "Factory";
                return Class.forName(className);
            } catch (ClassNotFoundException e) {
                throw new FactoryNotFoundException("æœªæ‰¾åˆ°å·¥å‚ç±»: " + brand, e);
            }
        });
        
        // åˆ›å»ºå®ä¾‹å¹¶ç¼“å­˜
        try {
            VehicleFactory factory = (VehicleFactory) factoryClass.newInstance();
            instanceCache.put(brandName, factory);
            return factory;
        } catch (Exception e) {
            throw new FactoryCreationException("åˆ›å»ºå·¥å‚å®ä¾‹å¤±è´¥: " + brandName, e);
        }
    }
}
```

**ğŸ¯ åå°„æœºåˆ¶çš„åº”ç”¨åœºæ™¯**ï¼š

- **æ’ä»¶ç³»ç»Ÿ**ï¼šåŠ¨æ€åŠ è½½æ–°çš„å·¥å‚ç±»
- **é…ç½®é©±åŠ¨**ï¼šæ ¹æ®é…ç½®æ–‡ä»¶åˆ›å»ºä¸åŒå·¥å‚
- **æ¡†æ¶å¼€å‘**ï¼šä¸ºæ¡†æ¶ç”¨æˆ·æä¾›æ‰©å±•ç‚¹
- **æµ‹è¯•ç¯å¢ƒ**ï¼šåŠ¨æ€åˆ‡æ¢ä¸åŒçš„å·¥å‚å®ç°

---

## 5. âš™ï¸ é…ç½®æ–‡ä»¶é©±åŠ¨


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®æ–‡ä»¶é©±åŠ¨


**é€šä¿—ç†è§£**ï¼šé…ç½®æ–‡ä»¶å°±åƒæ˜¯å·¥å‚çš„"èœå•"ï¼Œå‘Šè¯‰ç³»ç»Ÿæœ‰å“ªäº›å·¥å‚å¯ç”¨

```
ç¡¬ç¼–ç æ–¹å¼ï¼š                  é…ç½®æ–‡ä»¶æ–¹å¼ï¼š
ä»£ç ä¸­å†™æ­»å·¥å‚ç±»              ä»é…ç½®æ–‡ä»¶è¯»å–å·¥å‚ä¿¡æ¯
    â†“                           â†“
ä¿®æ”¹éœ€è¦é‡æ–°ç¼–è¯‘               ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯
(ä¸çµæ´»)                      (çµæ´»å¯é…ç½®)
```

### 5.2 é…ç½®æ–‡ä»¶æ ¼å¼è®¾è®¡


**ğŸ“‹ YAMLé…ç½®ç¤ºä¾‹**ï¼š

```yaml
# factory-config.yml - å·¥å‚é…ç½®æ–‡ä»¶
factories:
  # å¥”é©°å·¥å‚é…ç½®
  benz:
    className: com.example.factory.BenzFactory
    enabled: true
    priority: 1
    properties:
      quality: premium
      warranty: 3years
      
  # å®é©¬å·¥å‚é…ç½®  
  bmw:
    className: com.example.factory.BMWFactory
    enabled: true
    priority: 2
    properties:
      quality: luxury
      warranty: 4years
      
  # ç‰¹æ–¯æ‹‰å·¥å‚é…ç½®ï¼ˆæš‚æ—¶ç¦ç”¨ï¼‰
  tesla:
    className: com.example.factory.TeslaFactory
    enabled: false
    priority: 3
    properties:
      type: electric
      autopilot: true

# å…¨å±€é…ç½®
global:
  defaultFactory: benz
  enableCaching: true
  logLevel: INFO
```

**ğŸ“‹ JSONé…ç½®ç¤ºä¾‹**ï¼š

```json
{
  "factories": {
    "benz": {
      "className": "com.example.factory.BenzFactory",
      "enabled": true,
      "priority": 1,
      "properties": {
        "quality": "premium",
        "warranty": "3years"
      }
    },
    "bmw": {
      "className": "com.example.factory.BMWFactory", 
      "enabled": true,
      "priority": 2,
      "properties": {
        "quality": "luxury",
        "warranty": "4years"
      }
    }
  },
  "global": {
    "defaultFactory": "benz",
    "enableCaching": true
  }
}
```

### 5.3 é…ç½®åŠ è½½å™¨å®ç°


**ğŸ”§ é…ç½®åŠ è½½å™¨**ï¼š

```java
// å·¥å‚é…ç½®ç±»
public class FactoryConfig {
    private String className;
    private boolean enabled;
    private int priority;
    private Map<String, Object> properties;
    
    // getter/setteræ–¹æ³•...
}

// é…ç½®åŠ è½½å™¨
public class FactoryConfigLoader {
    
    private static final String CONFIG_FILE = "factory-config.yml";
    
    /**
     * åŠ è½½å·¥å‚é…ç½®
     */
    public static Map<String, FactoryConfig> loadConfig() {
        try {
            // è¯»å–é…ç½®æ–‡ä»¶
            InputStream inputStream = FactoryConfigLoader.class
                .getClassLoader()
                .getResourceAsStream(CONFIG_FILE);
                
            if (inputStream == null) {
                throw new ConfigurationException("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: " + CONFIG_FILE);
            }
            
            // è§£æYAMLé…ç½®
            Yaml yaml = new Yaml();
            Map<String, Object> configData = yaml.load(inputStream);
            
            // æå–å·¥å‚é…ç½®
            Map<String, Object> factoriesData = 
                (Map<String, Object>) configData.get("factories");
                
            Map<String, FactoryConfig> factoryConfigs = new HashMap<>();
            
            for (Map.Entry<String, Object> entry : factoriesData.entrySet()) {
                String brandName = entry.getKey();
                Map<String, Object> factoryData = (Map<String, Object>) entry.getValue();
                
                FactoryConfig config = parseFactoryConfig(factoryData);
                factoryConfigs.put(brandName, config);
            }
            
            return factoryConfigs;
            
        } catch (Exception e) {
            throw new ConfigurationException("åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥", e);
        }
    }
    
    private static FactoryConfig parseFactoryConfig(Map<String, Object> data) {
        FactoryConfig config = new FactoryConfig();
        config.setClassName((String) data.get("className"));
        config.setEnabled((Boolean) data.getOrDefault("enabled", true));
        config.setPriority((Integer) data.getOrDefault("priority", 0));
        config.setProperties((Map<String, Object>) data.get("properties"));
        return config;
    }
}
```

### 5.4 é…ç½®é©±åŠ¨çš„å·¥å‚ç®¡ç†å™¨


**ğŸ­ é…ç½®é©±åŠ¨å·¥å‚ç®¡ç†å™¨**ï¼š

```java
public class ConfigDrivenFactoryManager {
    
    private Map<String, FactoryConfig> factoryConfigs;
    private Map<String, VehicleFactory> factoryInstances;
    
    public ConfigDrivenFactoryManager() {
        this.factoryConfigs = FactoryConfigLoader.loadConfig();
        this.factoryInstances = new ConcurrentHashMap<>();
        
        // åˆå§‹åŒ–æ‰€æœ‰å¯ç”¨çš„å·¥å‚
        initializeFactories();
    }
    
    /**
     * åˆå§‹åŒ–å·¥å‚å®ä¾‹
     */
    private void initializeFactories() {
        for (Map.Entry<String, FactoryConfig> entry : factoryConfigs.entrySet()) {
            String brandName = entry.getKey();
            FactoryConfig config = entry.getValue();
            
            // åªåˆå§‹åŒ–å¯ç”¨çš„å·¥å‚
            if (config.isEnabled()) {
                try {
                    VehicleFactory factory = createFactoryFromConfig(config);
                    factoryInstances.put(brandName, factory);
                    
                    System.out.println("å·¥å‚åˆå§‹åŒ–æˆåŠŸ: " + brandName);
                } catch (Exception e) {
                    System.err.println("å·¥å‚åˆå§‹åŒ–å¤±è´¥: " + brandName + ", " + e.getMessage());
                }
            }
        }
    }
    
    /**
     * æ ¹æ®é…ç½®åˆ›å»ºå·¥å‚å®ä¾‹
     */
    private VehicleFactory createFactoryFromConfig(FactoryConfig config) {
        try {
            Class<?> factoryClass = Class.forName(config.getClassName());
            VehicleFactory factory = (VehicleFactory) factoryClass.newInstance();
            
            // è®¾ç½®å·¥å‚å±æ€§
            configureFactory(factory, config.getProperties());
            
            return factory;
        } catch (Exception e) {
            throw new FactoryCreationException("æ ¹æ®é…ç½®åˆ›å»ºå·¥å‚å¤±è´¥", e);
        }
    }
    
    /**
     * é…ç½®å·¥å‚å±æ€§
     */
    private void configureFactory(VehicleFactory factory, Map<String, Object> properties) {
        if (properties == null || properties.isEmpty()) {
            return;
        }
        
        // ä½¿ç”¨åå°„è®¾ç½®å±æ€§ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        for (Map.Entry<String, Object> prop : properties.entrySet()) {
            try {
                String propertyName = prop.getKey();
                Object propertyValue = prop.getValue();
                
                // æŸ¥æ‰¾setteræ–¹æ³•
                String setterName = "set" + capitalize(propertyName);
                Method setter = factory.getClass().getMethod(setterName, propertyValue.getClass());
                setter.invoke(factory, propertyValue);
                
            } catch (Exception e) {
                System.err.println("è®¾ç½®å·¥å‚å±æ€§å¤±è´¥: " + prop.getKey());
            }
        }
    }
    
    /**
     * è·å–å·¥å‚å®ä¾‹
     */
    public VehicleFactory getFactory(String brandName) {
        VehicleFactory factory = factoryInstances.get(brandName);
        
        if (factory == null) {
            throw new FactoryNotFoundException("å·¥å‚æœªæ‰¾åˆ°æˆ–æœªå¯ç”¨: " + brandName);
        }
        
        return factory;
    }
    
    /**
     * è·å–æ‰€æœ‰å¯ç”¨çš„å·¥å‚å“ç‰Œ
     */
    public Set<String> getAvailableBrands() {
        return factoryInstances.keySet();
    }
}
```

### 5.5 é…ç½®çƒ­æ›´æ–°æœºåˆ¶


**ğŸ”„ çƒ­æ›´æ–°å®ç°**ï¼š

```java
public class HotReloadFactoryManager extends ConfigDrivenFactoryManager {
    
    private FileWatcher configFileWatcher;
    
    public HotReloadFactoryManager() {
        super();
        setupConfigFileWatcher();
    }
    
    /**
     * è®¾ç½®é…ç½®æ–‡ä»¶ç›‘å¬å™¨
     */
    private void setupConfigFileWatcher() {
        configFileWatcher = new FileWatcher("factory-config.yml");
        
        configFileWatcher.addListener(new FileChangeListener() {
            @Override
            public void onFileChanged() {
                System.out.println("æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å˜æ›´ï¼Œé‡æ–°åŠ è½½å·¥å‚é…ç½®...");
                reloadFactories();
            }
        });
        
        configFileWatcher.start();
    }
    
    /**
     * é‡æ–°åŠ è½½å·¥å‚é…ç½®
     */
    private synchronized void reloadFactories() {
        try {
            // é‡æ–°åŠ è½½é…ç½®
            Map<String, FactoryConfig> newConfigs = FactoryConfigLoader.loadConfig();
            
            // æ¸…ç†æ—§çš„å·¥å‚å®ä¾‹
            factoryInstances.clear();
            
            // é‡æ–°åˆå§‹åŒ–å·¥å‚
            this.factoryConfigs = newConfigs;
            initializeFactories();
            
            System.out.println("å·¥å‚é…ç½®é‡æ–°åŠ è½½å®Œæˆ");
            
        } catch (Exception e) {
            System.err.println("é‡æ–°åŠ è½½å·¥å‚é…ç½®å¤±è´¥: " + e.getMessage());
        }
    }
}
```

**ğŸ¯ é…ç½®æ–‡ä»¶é©±åŠ¨çš„ä¼˜åŠ¿**ï¼š

- **çµæ´»æ€§**ï¼šæ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´å·¥å‚é…ç½®
- **å¯ç»´æŠ¤æ€§**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰å·¥å‚é…ç½®
- **ç¯å¢ƒé€‚åº”æ€§**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®æ–‡ä»¶
- **åŠ¨æ€æ€§**ï¼šæ”¯æŒè¿è¡Œæ—¶é…ç½®å˜æ›´

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å·¥å‚ç±»è®¾è®¡ï¼šå•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€æŠ½è±¡å·¥å‚+å…·ä½“å·¥å‚
ğŸ”¸ äº§å“å±‚æ¬¡ç»“æ„ï¼šæŠ½è±¡äº§å“æ¥å£+å…·ä½“äº§å“å®ç°+äº§å“ç³»åˆ—
ğŸ”¸ å·¥å‚æ³¨å†Œæœºåˆ¶ï¼šåŠ¨æ€å·¥å‚ç®¡ç†ã€æ¾è€¦åˆã€æ˜“æ‰©å±•
ğŸ”¸ åå°„åŠ¨æ€åˆ›å»ºï¼šè¿è¡Œæ—¶ç±»åŠ è½½ã€å‚æ•°åŒ–åˆ›å»ºã€ç¼“å­˜ä¼˜åŒ–
ğŸ”¸ é…ç½®æ–‡ä»¶é©±åŠ¨ï¼šå¤–éƒ¨åŒ–é…ç½®ã€çƒ­æ›´æ–°ã€ç¯å¢ƒéš”ç¦»
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡**ï¼š
```
ä¼ ç»Ÿåˆ›å»ºæ–¹å¼çš„é—®é¢˜ï¼š
- ç¡¬ç¼–ç ï¼šnew BenzFactory() å†™æ­»åœ¨ä»£ç ä¸­
- éš¾æ‰©å±•ï¼šæ–°å¢å·¥å‚éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
- é«˜è€¦åˆï¼šå®¢æˆ·ç«¯ä¾èµ–å…·ä½“å·¥å‚ç±»

å·¥å‚æ–¹æ³•æ¨¡å¼çš„è§£å†³æ–¹æ¡ˆï¼š
- æŠ½è±¡åŒ–ï¼šå®šä¹‰æŠ½è±¡å·¥å‚æ¥å£
- å¤šæ€æ€§ï¼šé€šè¿‡ç»§æ‰¿å®ç°ä¸åŒå·¥å‚
- é…ç½®åŒ–ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†å·¥å‚
```

**ğŸ”¹ å„ç§æŠ€å·§çš„ä½¿ç”¨åœºæ™¯**ï¼š
```
å·¥å‚æ³¨å†Œæœºåˆ¶ â†’ æ’ä»¶ç³»ç»Ÿã€æ¨¡å—åŒ–æ¶æ„
åå°„åŠ¨æ€åˆ›å»º â†’ æ¡†æ¶å¼€å‘ã€é€šç”¨ç»„ä»¶
é…ç½®æ–‡ä»¶é©±åŠ¨ â†’ ä¼ä¸šåº”ç”¨ã€å¤šç¯å¢ƒéƒ¨ç½²
äº§å“å±‚æ¬¡ç»“æ„ â†’ å¤æ‚äº§å“ä½“ç³»ã€äº§å“æ—ç®¡ç†
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| åº”ç”¨åœºæ™¯ | **é€‚ç”¨æŠ€å·§** | **è§£å†³çš„é—®é¢˜** | **å¸¦æ¥çš„ä»·å€¼** |
|---------|-------------|---------------|---------------|
| **Webæ¡†æ¶** | `åå°„+æ³¨å†Œæœºåˆ¶` | `åŠ¨æ€åŠ è½½æ§åˆ¶å™¨` | `æ’ä»¶åŒ–æ¶æ„` |
| **æ•°æ®åº“è¿æ¥** | `é…ç½®æ–‡ä»¶é©±åŠ¨` | `å¤šæ•°æ®æºåˆ‡æ¢` | `ç¯å¢ƒéš”ç¦»` |
| **æ¶ˆæ¯é˜Ÿåˆ—** | `å·¥å‚æ³¨å†Œ` | `å¤šç§MQæ”¯æŒ` | `æŠ€æœ¯é€‰å‹çµæ´»` |
| **æ–‡ä»¶å¤„ç†** | `äº§å“å±‚æ¬¡` | `å¤šæ ¼å¼æ”¯æŒ` | `åŠŸèƒ½æ‰©å±•æ€§` |

**ğŸ”§ å®è·µå»ºè®®**ï¼š

```
åˆå­¦è€…é˜¶æ®µï¼š
âœ… å…ˆæŒæ¡åŸºæœ¬çš„æŠ½è±¡å·¥å‚+å…·ä½“å·¥å‚è®¾è®¡
âœ… ç†è§£å·¥å‚æ–¹æ³•ä¸ç®€å•å·¥å‚çš„åŒºåˆ«
âœ… ç»ƒä¹ äº§å“æ¥å£çš„æŠ½è±¡è®¾è®¡

è¿›é˜¶é˜¶æ®µï¼š
ğŸ”¸ å­¦ä¼šä½¿ç”¨å·¥å‚æ³¨å†Œæœºåˆ¶ç®¡ç†å¤šä¸ªå·¥å‚
ğŸ”¸ æŒæ¡åå°„æŠ€æœ¯å®ç°åŠ¨æ€å·¥å‚åˆ›å»º
ğŸ”¸ ç†è§£é…ç½®æ–‡ä»¶é©±åŠ¨çš„è®¾è®¡æ€æƒ³

é«˜çº§é˜¶æ®µï¼š
ğŸš€ è®¾è®¡æ”¯æŒçƒ­æ›´æ–°çš„å·¥å‚ç³»ç»Ÿ
ğŸš€ ç»“åˆSpringç­‰æ¡†æ¶çš„å·¥å‚æ¨¡å¼åº”ç”¨
ğŸš€ åœ¨å¤§å‹é¡¹ç›®ä¸­åº”ç”¨å·¥å‚æ¨¡å¼è§£å†³å®é™…é—®é¢˜
```

**ğŸ’¡ è®°å¿†è¦ç‚¹**ï¼š
- **å·¥å‚æ–¹æ³•æ¨¡å¼ = æ¯ç§äº§å“æœ‰ä¸“é—¨çš„å·¥å‚**
- **æ³¨å†Œæœºåˆ¶ = å·¥å‚ç”µè¯ç°¿ï¼ŒæŒ‰éœ€æŸ¥æ‰¾**
- **åå°„åˆ›å»º = é­”é•œå˜é­”æœ¯ï¼Œåå­—å˜å®ç‰©**
- **é…ç½®é©±åŠ¨ = å·¥å‚èœå•ï¼Œå¤–éƒ¨å¯è°ƒæ•´**

**æ ¸å¿ƒä»·å€¼**ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼é€šè¿‡è¿™äº›å®ç°æŠ€å·§ï¼ŒçœŸæ­£å®ç°äº†"å¼€é—­åŸåˆ™"â€”â€” **å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­**ï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•ã€‚