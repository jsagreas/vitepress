---
title: 3ã€è£…é¥°å™¨æ¨¡å¼å®ç°æŠ€å·§
---
## ğŸ¨ è£…é¥°å™¨æ¨¡å¼å®ç°æŠ€å·§

### ğŸ“š ç›®å½•
1. [è£…é¥°å™¨æ¨¡å¼æ ¸å¿ƒç†è§£](#1-è£…é¥°å™¨æ¨¡å¼æ ¸å¿ƒç†è§£)
2. [è£…é¥°å™¨é“¾è®¾è®¡](#2-è£…é¥°å™¨é“¾è®¾è®¡)
3. [é€æ˜æ€§ä¿è¯æœºåˆ¶](#3-é€æ˜æ€§ä¿è¯æœºåˆ¶)
4. [è£…é¥°é¡ºåºæ§åˆ¶](#4-è£…é¥°é¡ºåºæ§åˆ¶)
5. [çŠ¶æ€ç®¡ç†æœºåˆ¶](#5-çŠ¶æ€ç®¡ç†æœºåˆ¶)
6. [æ€§èƒ½ä¼˜åŒ–è€ƒè™‘](#6-æ€§èƒ½ä¼˜åŒ–è€ƒè™‘)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

### 1. ğŸ¯ è£…é¥°å™¨æ¨¡å¼æ ¸å¿ƒç†è§£

#### 1.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨æ¨¡å¼
**ğŸ” ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£**
æƒ³è±¡ä½ ä¹°äº†ä¸€æ¯åŸºç¡€å’–å•¡ï¼Œç„¶åå¯ä»¥ï¼š
```
åŸºç¡€å’–å•¡ â†’ åŠ ç³– â†’ åŠ å¥¶ â†’ åŠ å·§å…‹åŠ› â†’ æœ€ç»ˆå’–å•¡
```
æ¯ä¸€æ­¥éƒ½æ˜¯åœ¨åŸæœ‰åŸºç¡€ä¸Š"è£…é¥°"ï¼Œè€Œä¸æ˜¯é‡æ–°åšä¸€æ¯å’–å•¡ã€‚

**â­ æ ¸å¿ƒå®šä¹‰**
è£…é¥°å™¨æ¨¡å¼å°±æ˜¯ç»™å¯¹è±¡åŠ¨æ€åœ°æ·»åŠ æ–°åŠŸèƒ½ï¼Œè€Œä¸æ”¹å˜åŸæ¥çš„ä»£ç ç»“æ„ã€‚

#### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨æ¨¡å¼

**ğŸš« ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**
```
é—®é¢˜åœºæ™¯ï¼šç»™æ–‡æœ¬ç¼–è¾‘å™¨æ·»åŠ åŠŸèƒ½

ç»§æ‰¿æ–¹å¼çš„å›°å¢ƒï¼š
åŸºç¡€ç¼–è¾‘å™¨
â”œâ”€â”€ åŠ ç²—ç¼–è¾‘å™¨
â”œâ”€â”€ æ–œä½“ç¼–è¾‘å™¨  
â”œâ”€â”€ åŠ ç²—+æ–œä½“ç¼–è¾‘å™¨
â”œâ”€â”€ ä¸‹åˆ’çº¿ç¼–è¾‘å™¨
â”œâ”€â”€ åŠ ç²—+ä¸‹åˆ’çº¿ç¼–è¾‘å™¨
â””â”€â”€ ... (ç»„åˆçˆ†ç‚¸ï¼)
```

**âœ… è£…é¥°å™¨æ¨¡å¼çš„ä¼˜åŠ¿**
- **çµæ´»ç»„åˆ**ï¼šå¯ä»¥ä»»æ„æ­é…åŠŸèƒ½
- **åŠ¨æ€æ·»åŠ **ï¼šè¿è¡Œæ—¶å†³å®šè¦ä»€ä¹ˆåŠŸèƒ½
- **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªè£…é¥°å™¨åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **æ— éœ€ä¿®æ”¹åŸä»£ç **ï¼šç¬¦åˆå¼€é—­åŸåˆ™

#### 1.3 è£…é¥°å™¨æ¨¡å¼ç»“æ„å›¾

```
åŸºç¡€ç»„ä»¶æ¥å£
     â”‚
     â”œâ”€â”€ å…·ä½“ç»„ä»¶ï¼ˆå’–å•¡ï¼‰
     â”‚
     â””â”€â”€ è£…é¥°å™¨åŸºç±»
         â”‚
         â”œâ”€â”€ ç³–è£…é¥°å™¨
         â”œâ”€â”€ å¥¶è£…é¥°å™¨
         â””â”€â”€ å·§å…‹åŠ›è£…é¥°å™¨
```

**ğŸ”¢ é‡è¦åº¦è¯„ä¼°**
- ä½¿ç”¨é¢‘ç‡ï¼šâ­â­â­â­â­ (è¶…é«˜é¢‘)
- å­¦ä¹ éš¾åº¦ï¼šâ­â­â­â˜†â˜† (ä¸­ç­‰)
- å®ç”¨ä»·å€¼ï¼šâ­â­â­â­â­ (æé«˜)

---

### 2. ğŸ”— è£…é¥°å™¨é“¾è®¾è®¡

#### 2.1 é“¾å¼è°ƒç”¨çš„æ ¸å¿ƒåŸç†

**ğŸ’¡ é“¾å¼è°ƒç”¨å°±åƒå¥—å¨ƒ**
```
æœ€å¤–å±‚å¨ƒå¨ƒ(å·§å…‹åŠ›è£…é¥°å™¨)
  â””â”€â”€ ä¸­é—´å¨ƒå¨ƒ(å¥¶è£…é¥°å™¨)
      â””â”€â”€ æœ€å†…å±‚å¨ƒå¨ƒ(ç³–è£…é¥°å™¨)
          â””â”€â”€ æ ¸å¿ƒå¨ƒå¨ƒ(åŸºç¡€å’–å•¡)
```

#### 2.2 åŸºç¡€é“¾è®¾è®¡å®ç°

```java
// 1. å®šä¹‰å…±åŒæ¥å£
interface Coffee {
    String getDescription();  // è·å–æè¿°
    double getCost();        // è·å–ä»·æ ¼
}

// 2. åŸºç¡€å’–å•¡å®ç°
class BasicCoffee implements Coffee {
    public String getDescription() {
        return "åŸºç¡€å’–å•¡";
    }
    
    public double getCost() {
        return 10.0;
    }
}
```

#### 2.3 è£…é¥°å™¨åŸºç±»è®¾è®¡

```java
// è£…é¥°å™¨åŸºç±» - å…³é”®è®¾è®¡
abstract class CoffeeDecorator implements Coffee {
    protected Coffee coffee;  // æŒæœ‰è¢«è£…é¥°çš„å¯¹è±¡
    
    public CoffeeDecorator(Coffee coffee) {
        this.coffee = coffee;
    }
    
    // é»˜è®¤å®ç°ï¼šç›´æ¥å§”æ‰˜ç»™è¢«è£…é¥°å¯¹è±¡
    public String getDescription() {
        return coffee.getDescription();
    }
    
    public double getCost() {
        return coffee.getCost();
    }
}
```

#### 2.4 å…·ä½“è£…é¥°å™¨å®ç°

```java
// ç³–è£…é¥°å™¨
class SugarDecorator extends CoffeeDecorator {
    public SugarDecorator(Coffee coffee) {
        super(coffee);
    }
    
    public String getDescription() {
        return coffee.getDescription() + " + ç³–";
    }
    
    public double getCost() {
        return coffee.getCost() + 2.0;
    }
}

// å¥¶è£…é¥°å™¨
class MilkDecorator extends CoffeeDecorator {
    public MilkDecorator(Coffee coffee) {
        super(coffee);
    }
    
    public String getDescription() {
        return coffee.getDescription() + " + å¥¶";
    }
    
    public double getCost() {
        return coffee.getCost() + 3.0;
    }
}
```

#### 2.5 é“¾å¼è°ƒç”¨ä½¿ç”¨ç¤ºä¾‹

```java
public class DecoratorChainDemo {
    public static void main(String[] args) {
        // åŸºç¡€å’–å•¡
        Coffee coffee = new BasicCoffee();
        System.out.println(coffee.getDescription() + " = " + coffee.getCost());
        
        // åŠ ç³–
        coffee = new SugarDecorator(coffee);
        System.out.println(coffee.getDescription() + " = " + coffee.getCost());
        
        // å†åŠ å¥¶
        coffee = new MilkDecorator(coffee);
        System.out.println(coffee.getDescription() + " = " + coffee.getCost());
        
        // è¾“å‡ºï¼š
        // åŸºç¡€å’–å•¡ = 10.0
        // åŸºç¡€å’–å•¡ + ç³– = 12.0  
        // åŸºç¡€å’–å•¡ + ç³– + å¥¶ = 15.0
    }
}
```

**ğŸ§  è®°å¿†æŠ€å·§**
> **é“¾å¼è£…é¥°å£è¯€**ï¼šä¸€å±‚å¥—ä¸€å±‚ï¼ŒåŠŸèƒ½å åŠ å¢ï¼Œå†…æ ¸ä¸å˜æ ·ï¼Œå¤–è¡¨æ›´ä¸°å¯Œ

---

### 3. ğŸ” é€æ˜æ€§ä¿è¯æœºåˆ¶

#### 3.1 ä»€ä¹ˆæ˜¯é€æ˜æ€§

**ğŸ“ é€æ˜æ€§çš„å«ä¹‰**
ç”¨æˆ·ä½¿ç”¨è£…é¥°åçš„å¯¹è±¡ï¼Œå°±åƒä½¿ç”¨åŸå§‹å¯¹è±¡ä¸€æ ·ï¼Œæ„Ÿè§‰ä¸åˆ°åŒºåˆ«ã€‚

```
ç”¨æˆ·è§†è§’ï¼š
coffee.getDescription()  // ä¸ç®¡å’–å•¡è¢«è£…é¥°äº†å‡ å±‚
coffee.getCost()         // è°ƒç”¨æ–¹å¼å®Œå…¨ä¸€æ ·
```

#### 3.2 é€æ˜æ€§è®¾è®¡è¦ç‚¹

**âœ… ä¿è¯é€æ˜æ€§çš„å…³é”®åŸåˆ™**

| åŸåˆ™ | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| **æ¥å£ä¸€è‡´** | è£…é¥°å™¨å’Œè¢«è£…é¥°å¯¹è±¡å®ç°ç›¸åŒæ¥å£ | â­â­â­â­â­ |
| **è¡Œä¸ºä¿æŒ** | è£…é¥°å™¨ä¸æ”¹å˜æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ | â­â­â­â­â­ |
| **å§”æ‰˜æœºåˆ¶** | è£…é¥°å™¨å°†è¯·æ±‚å§”æ‰˜ç»™è¢«è£…é¥°å¯¹è±¡ | â­â­â­â­â˜† |
| **åŠŸèƒ½å¢å¼º** | åªåœ¨åŸåŠŸèƒ½åŸºç¡€ä¸Šå¢åŠ ï¼Œä¸æ›¿æ¢ | â­â­â­â­â˜† |

#### 3.3 é€æ˜æ€§å®ç°æŠ€å·§

**ğŸ”§ æŠ€å·§1ï¼šä¸¥æ ¼æ¥å£çº¦æŸ**
```java
// å¥½çš„è®¾è®¡ï¼šæ‰€æœ‰è£…é¥°å™¨éƒ½å®ç°ç›¸åŒæ¥å£
interface Component {
    void operation();
}

class ConcreteComponent implements Component {
    public void operation() {
        System.out.println("åŸºç¡€æ“ä½œ");
    }
}

class Decorator implements Component {
    private Component component;
    
    public void operation() {
        component.operation();  // å§”æ‰˜ç»™åŸå¯¹è±¡
        // å¯ä»¥åœ¨å‰åæ·»åŠ é¢å¤–åŠŸèƒ½
    }
}
```

**ğŸ”§ æŠ€å·§2ï¼šæ–¹æ³•ç­¾åä¿æŒä¸€è‡´**
```java
// é”™è¯¯ç¤ºä¾‹ï¼šæ”¹å˜äº†æ–¹æ³•ç­¾å
class BadDecorator extends Component {
    public String operation(int param) {  // âŒ ç­¾åå˜äº†
        return "modified";
    }
}

// æ­£ç¡®ç¤ºä¾‹ï¼šä¿æŒåŸæœ‰ç­¾å
class GoodDecorator extends Component {
    public void operation() {  // âœ… ç­¾åä¸€è‡´
        super.operation();
        System.out.println("å¢å¼ºåŠŸèƒ½");
    }
}
```

#### 3.4 é€æ˜æ€§éªŒè¯æ–¹æ³•

**ğŸ§ª é€æ˜æ€§æµ‹è¯•æ£€æŸ¥æ¸…å•**
- [ ] è£…é¥°å‰åæ¥å£è°ƒç”¨æ–¹å¼ç›¸åŒ
- [ ] æ ¸å¿ƒåŠŸèƒ½è¡Œä¸ºä¸å˜
- [ ] å¯ä»¥éšæ„åµŒå¥—è£…é¥°å™¨
- [ ] å®¢æˆ·ç«¯ä»£ç æ— éœ€ä¿®æ”¹

**âš ï¸ å¸¸è§é€æ˜æ€§ç ´å**
```java
// å±é™©åšæ³•ï¼šæš´éœ²è£…é¥°å™¨ç‰¹æœ‰æ–¹æ³•
class BadDecorator extends CoffeeDecorator {
    public void decoratorSpecificMethod() {  // âŒ ç ´åé€æ˜æ€§
        // è¿™ä¸ªæ–¹æ³•åªæœ‰è£…é¥°å™¨æœ‰ï¼ŒåŸå¯¹è±¡æ²¡æœ‰
    }
}
```

> ğŸ’¡ **é€æ˜æ€§è®°å¿†æ³•**ï¼šè£…é¥°å™¨åƒéšå½¢çœ¼é•œï¼Œå¢å¼ºè§†åŠ›ä½†ä½ æ„Ÿè§‰ä¸åˆ°å®ƒçš„å­˜åœ¨

---

### 4. ğŸ¯ è£…é¥°é¡ºåºæ§åˆ¶

#### 4.1 ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦

**ğŸ¨ è£…é¥°é¡ºåºå½±å“æœ€ç»ˆæ•ˆæœ**
```
åœºæ™¯ï¼šç»™æ–‡æœ¬æ·»åŠ æ ¼å¼

é¡ºåº1ï¼šæ–‡æœ¬ â†’ åŠ ç²— â†’ æ–œä½“
ç»“æœï¼š***ç²—æ–œä½“æ–‡æœ¬***

é¡ºåº2ï¼šæ–‡æœ¬ â†’ æ–œä½“ â†’ åŠ ç²—  
ç»“æœï¼š***æ–œç²—ä½“æ–‡æœ¬***
```

è™½ç„¶çœ‹èµ·æ¥ç›¸ä¼¼ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹é¡ºåºä¼šæ˜¾è‘—å½±å“ç»“æœã€‚

#### 4.2 é¡ºåºæ§åˆ¶ç­–ç•¥

**ğŸ”¢ ç­–ç•¥1ï¼šä¼˜å…ˆçº§æ’åº**
```java
// å®šä¹‰è£…é¥°å™¨ä¼˜å…ˆçº§
enum DecoratorPriority {
    VALIDATION(1),    // éªŒè¯è£…é¥°å™¨ä¼˜å…ˆçº§æœ€é«˜
    CACHING(2),       // ç¼“å­˜æ¬¡ä¹‹
    LOGGING(3),       // æ—¥å¿—æœ€å
    SECURITY(0);      // å®‰å…¨æ£€æŸ¥æœ€ä¼˜å…ˆ
    
    private final int priority;
    DecoratorPriority(int priority) {
        this.priority = priority;
    }
}
```

**ğŸ”§ ç­–ç•¥2ï¼šå»ºé€ è€…æ¨¡å¼æ§åˆ¶é¡ºåº**
```java
class CoffeeBuilder {
    private Coffee coffee;
    
    public CoffeeBuilder(Coffee baseCoffee) {
        this.coffee = baseCoffee;
    }
    
    // æŒ‰ç…§å›ºå®šé¡ºåºæ·»åŠ è£…é¥°
    public CoffeeBuilder addSugar() {
        coffee = new SugarDecorator(coffee);
        return this;
    }
    
    public CoffeeBuilder addMilk() {
        coffee = new MilkDecorator(coffee);
        return this;
    }
    
    public Coffee build() {
        return coffee;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
Coffee coffee = new CoffeeBuilder(new BasicCoffee())
    .addSugar()    // å…ˆåŠ ç³–
    .addMilk()     // ååŠ å¥¶
    .build();
```

#### 4.3 æ™ºèƒ½é¡ºåºç®¡ç†

**ğŸ¤– è‡ªåŠ¨é¡ºåºè°ƒæ•´å™¨**
```java
class SmartDecoratorManager {
    private List<DecoratorInfo> decorators = new ArrayList<>();
    
    public void addDecorator(DecoratorInfo decorator) {
        decorators.add(decorator);
        // æ ¹æ®ä¼˜å…ˆçº§è‡ªåŠ¨æ’åº
        decorators.sort((a, b) -> 
            Integer.compare(a.priority, b.priority));
    }
    
    public Coffee applyDecorators(Coffee baseCoffee) {
        Coffee result = baseCoffee;
        for (DecoratorInfo info : decorators) {
            result = info.createDecorator(result);
        }
        return result;
    }
}
```

**ğŸ“‹ é¡ºåºæ§åˆ¶æœ€ä½³å®è·µ**

| è£…é¥°å™¨ç±»å‹ | å»ºè®®é¡ºåº | åŸå›  |
|------------|----------|------|
| **å®‰å…¨æ£€æŸ¥** | æœ€å¤–å±‚ | ä¼˜å…ˆéªŒè¯æƒé™ |
| **å‚æ•°éªŒè¯** | ç¬¬äºŒå±‚ | æ—©æœŸå‘ç°é”™è¯¯ |
| **ç¼“å­˜** | ä¸­é—´å±‚ | å‡å°‘é‡å¤è®¡ç®— |
| **æ—¥å¿—** | å†…å±‚ | è®°å½•å®é™…æ‰§è¡Œ |
| **æ ¸å¿ƒä¸šåŠ¡** | æœ€å†…å±‚ | å®é™…åŠŸèƒ½æ‰§è¡Œ |

> ğŸ§  **é¡ºåºè®°å¿†å£è¯€**ï¼šå®‰å…¨éªŒè¯åœ¨æœ€å¤–ï¼Œç¼“å­˜æ—¥å¿—ç´§è·Ÿéšï¼Œæ ¸å¿ƒä¸šåŠ¡åœ¨æœ€é‡Œï¼Œå±‚å±‚ä¿æŠ¤æ‰å®‰å…¨

---

### 5. ğŸ“Š çŠ¶æ€ç®¡ç†æœºåˆ¶

#### 5.1 è£…é¥°å™¨çŠ¶æ€åˆ†ç±»

**ğŸ·ï¸ çŠ¶æ€ç±»å‹ç†è§£**
```
1. æ— çŠ¶æ€è£…é¥°å™¨ï¼šæ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„
   ç¤ºä¾‹ï¼šåŠ æ³•è£…é¥°å™¨ï¼ˆåŠ å›ºå®šæ•°å€¼ï¼‰

2. æœ‰çŠ¶æ€è£…é¥°å™¨ï¼šéœ€è¦è®°ä½ä¹‹å‰çš„æ“ä½œ
   ç¤ºä¾‹ï¼šè®¡æ•°è£…é¥°å™¨ï¼ˆè®°å½•è°ƒç”¨æ¬¡æ•°ï¼‰

3. å…±äº«çŠ¶æ€è£…é¥°å™¨ï¼šå¤šä¸ªè£…é¥°å™¨å…±äº«æ•°æ®
   ç¤ºä¾‹ï¼šç»Ÿè®¡è£…é¥°å™¨ï¼ˆå…¨å±€è®¡æ•°ï¼‰
```

#### 5.2 æ— çŠ¶æ€è£…é¥°å™¨è®¾è®¡

**âœ… æ— çŠ¶æ€è£…é¥°å™¨ç‰¹ç‚¹**
- çº¿ç¨‹å®‰å…¨
- å¯ä»¥é‡å¤ä½¿ç”¨
- æ€§èƒ½å¥½

```java
// æ— çŠ¶æ€è£…é¥°å™¨ç¤ºä¾‹
class PriceDiscountDecorator extends CoffeeDecorator {
    private final double discountRate;  // ä¸å˜çš„æŠ˜æ‰£ç‡
    
    public PriceDiscountDecorator(Coffee coffee, double discountRate) {
        super(coffee);
        this.discountRate = discountRate;
    }
    
    public double getCost() {
        return coffee.getCost() * discountRate;  // æ¯æ¬¡é‡æ–°è®¡ç®—
    }
}
```

#### 5.3 æœ‰çŠ¶æ€è£…é¥°å™¨è®¾è®¡

**âš ï¸ æœ‰çŠ¶æ€è£…é¥°å™¨æ³¨æ„äº‹é¡¹**
- éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨
- çŠ¶æ€å¯èƒ½éœ€è¦é‡ç½®
- è¦é¿å…å†…å­˜æ³„æ¼

```java
// æœ‰çŠ¶æ€è£…é¥°å™¨ç¤ºä¾‹
class CallCountDecorator extends CoffeeDecorator {
    private int callCount = 0;  // çŠ¶æ€å˜é‡
    
    public CallCountDecorator(Coffee coffee) {
        super(coffee);
    }
    
    public String getDescription() {
        callCount++;  // ä¿®æ”¹çŠ¶æ€
        return coffee.getDescription() + 
               " (ç¬¬" + callCount + "æ¬¡è°ƒç”¨)";
    }
    
    // æä¾›çŠ¶æ€æŸ¥è¯¢æ–¹æ³•
    public int getCallCount() {
        return callCount;
    }
    
    // æä¾›çŠ¶æ€é‡ç½®æ–¹æ³•
    public void resetCount() {
        callCount = 0;
    }
}
```

#### 5.4 çŠ¶æ€åŒæ­¥æœºåˆ¶

**ğŸ”„ å¤šè£…é¥°å™¨çŠ¶æ€åè°ƒ**
```java
// çŠ¶æ€å…±äº«æœºåˆ¶
class SharedState {
    private int totalOperations = 0;
    
    public synchronized int incrementAndGet() {
        return ++totalOperations;
    }
    
    public int getTotal() {
        return totalOperations;
    }
}

class StatefulDecorator extends CoffeeDecorator {
    private static SharedState sharedState = new SharedState();
    
    public String getDescription() {
        int opNumber = sharedState.incrementAndGet();
        return coffee.getDescription() + 
               " [å…¨å±€æ“ä½œ#" + opNumber + "]";
    }
}
```

**ğŸ“Š çŠ¶æ€ç®¡ç†ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æ— çŠ¶æ€** | çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½ | åŠŸèƒ½æœ‰é™ | ç®€å•è½¬æ¢ |
| **æœ¬åœ°çŠ¶æ€** | åŠŸèƒ½å¼ºå¤§ï¼Œéš”ç¦»æ€§å¥½ | å¤æ‚åº¦é«˜ | å•å¯¹è±¡è·Ÿè¸ª |
| **å…±äº«çŠ¶æ€** | å¯ä»¥åè°ƒå¤šå¯¹è±¡ | çº¿ç¨‹å®‰å…¨å¤æ‚ | å…¨å±€ç»Ÿè®¡ |

> ğŸ’¡ **çŠ¶æ€ç®¡ç†æé†’**ï¼šçŠ¶æ€è¶Šå°‘è¶Šå¥½ï¼Œå¿…é¡»æœ‰çŠ¶æ€æ—¶è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨

---

### 6. âš¡ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘

#### 6.1 è£…é¥°å™¨æ€§èƒ½å½±å“åˆ†æ

**ğŸ“ˆ æ€§èƒ½å¼€é”€æ¥æº**
```
æ¯å¢åŠ ä¸€å±‚è£…é¥°å™¨ï¼š
1. å¤šä¸€æ¬¡æ–¹æ³•è°ƒç”¨
2. å¤šä¸€ä¸ªå¯¹è±¡åˆ›å»º
3. å¤šä¸€å±‚å †æ ˆæ·±åº¦
4. å¯èƒ½çš„å†…å­˜å¼€é”€
```

**ğŸ” æ€§èƒ½æµ‹è¯•ç¤ºä¾‹**
```java
// æ€§èƒ½æµ‹è¯•ä»£ç 
public class PerformanceTest {
    public static void main(String[] args) {
        Coffee baseCoffee = new BasicCoffee();
        
        // æµ‹è¯•æ— è£…é¥°å™¨æ€§èƒ½
        long start = System.nanoTime();
        for (int i = 0; i < 1000000; i++) {
            baseCoffee.getCost();
        }
        long baseTime = System.nanoTime() - start;
        
        // æµ‹è¯•å¤šå±‚è£…é¥°å™¨æ€§èƒ½
        Coffee decoratedCoffee = baseCoffee;
        for (int i = 0; i < 10; i++) {
            decoratedCoffee = new SugarDecorator(decoratedCoffee);
        }
        
        start = System.nanoTime();
        for (int i = 0; i < 1000000; i++) {
            decoratedCoffee.getCost();
        }
        long decoratedTime = System.nanoTime() - start;
        
        System.out.println("æ€§èƒ½æ¯”è¾ƒï¼š" + (decoratedTime / baseTime) + "å€");
    }
}
```

#### 6.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§

**ğŸš€ ä¼˜åŒ–æŠ€å·§1ï¼šç»“æœç¼“å­˜**
```java
class CachedDecorator extends CoffeeDecorator {
    private String cachedDescription;
    private Double cachedCost;
    private boolean isCacheValid = false;
    
    public String getDescription() {
        if (!isCacheValid) {
            cachedDescription = coffee.getDescription() + " + ä¼˜åŒ–ç³–";
            isCacheValid = true;
        }
        return cachedDescription;
    }
    
    public double getCost() {
        if (cachedCost == null) {
            cachedCost = coffee.getCost() + 2.0;
        }
        return cachedCost;
    }
}
```

**ğŸš€ ä¼˜åŒ–æŠ€å·§2ï¼šè£…é¥°å™¨æ± åŒ–**
```java
class DecoratorPool {
    private static final Map<String, Queue<CoffeeDecorator>> pool = 
        new ConcurrentHashMap<>();
    
    public static <T extends CoffeeDecorator> T getDecorator(
            Class<T> decoratorClass, Coffee coffee) {
        Queue<CoffeeDecorator> queue = pool.get(decoratorClass.getName());
        if (queue != null && !queue.isEmpty()) {
            T decorator = (T) queue.poll();
            decorator.resetWith(coffee);  // é‡ç½®è£…é¥°å™¨
            return decorator;
        }
        // å¦‚æœæ± ä¸­æ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„
        return createNewDecorator(decoratorClass, coffee);
    }
    
    public static void returnDecorator(CoffeeDecorator decorator) {
        String className = decorator.getClass().getName();
        pool.computeIfAbsent(className, k -> new ConcurrentLinkedQueue<>())
            .offer(decorator);
    }
}
```

#### 6.3 å†…å­˜ä¼˜åŒ–ç­–ç•¥

**ğŸ’¾ å†…å­˜ä¼˜åŒ–è¦ç‚¹**

| ä¼˜åŒ–æ–¹å‘ | æŠ€å·§ | æ•ˆæœ |
|----------|------|------|
| **å¯¹è±¡é‡ç”¨** | è£…é¥°å™¨æ± åŒ– | å‡å°‘GCå‹åŠ› |
| **å»¶è¿Ÿè®¡ç®—** | ç»“æœç¼“å­˜ | é¿å…é‡å¤è®¡ç®— |
| **è½»é‡çº§è£…é¥°å™¨** | å‡å°‘æˆå‘˜å˜é‡ | é™ä½å†…å­˜å ç”¨ |
| **åˆå¹¶è£…é¥°å™¨** | ç»„åˆå¤šä¸ªåŠŸèƒ½ | å‡å°‘åµŒå¥—å±‚æ•° |

**ğŸ”§ è½»é‡çº§è£…é¥°å™¨ç¤ºä¾‹**
```java
// é‡é‡çº§è£…é¥°å™¨ï¼ˆä¸æ¨èï¼‰
class HeavyDecorator extends CoffeeDecorator {
    private String prefix;
    private String suffix;
    private double multiplier;
    private boolean enabled;
    private List<String> logs;  // ä¸å¿…è¦çš„æˆå‘˜
    
    // æ„é€ å‡½æ•°å’Œæ–¹æ³•...
}

// è½»é‡çº§è£…é¥°å™¨ï¼ˆæ¨èï¼‰
class LightDecorator extends CoffeeDecorator {
    private final double addedCost;  // åªä¿ç•™å¿…è¦çš„çŠ¶æ€
    
    public LightDecorator(Coffee coffee, double addedCost) {
        super(coffee);
        this.addedCost = addedCost;
    }
    
    public double getCost() {
        return coffee.getCost() + addedCost;
    }
}
```

#### 6.4 æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜

**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```java
class PerformanceMonitor {
    private static final AtomicLong totalCalls = new AtomicLong(0);
    private static final AtomicLong totalTime = new AtomicLong(0);
    
    public static void recordCall(long executionTime) {
        totalCalls.incrementAndGet();
        totalTime.addAndGet(executionTime);
    }
    
    public static double getAverageTime() {
        long calls = totalCalls.get();
        return calls > 0 ? (double) totalTime.get() / calls : 0;
    }
}

// åœ¨è£…é¥°å™¨ä¸­ä½¿ç”¨ç›‘æ§
class MonitoredDecorator extends CoffeeDecorator {
    public double getCost() {
        long start = System.nanoTime();
        try {
            return coffee.getCost() + 2.0;
        } finally {
            PerformanceMonitor.recordCall(System.nanoTime() - start);
        }
    }
}
```

> âš¡ **æ€§èƒ½ä¼˜åŒ–é‡‘å¥**ï¼šè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºï¼Œä½†äº†è§£æ€§èƒ½å½±å“æ˜¯å¿…è¦çš„

---

### 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“

#### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

**ğŸ¯ è£…é¥°å™¨æ¨¡å¼æ ¸å¿ƒç†å¿µ**
```
âœ… åŠ¨æ€åŠŸèƒ½æ‰©å±•ï¼šè¿è¡Œæ—¶æ·»åŠ æ–°åŠŸèƒ½
âœ… é€æ˜æ€§åŸåˆ™ï¼šä½¿ç”¨æ–¹å¼ä¸åŸå¯¹è±¡ç›¸åŒ
âœ… èŒè´£å•ä¸€ï¼šæ¯ä¸ªè£…é¥°å™¨åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
âœ… çµæ´»ç»„åˆï¼šå¯ä»¥ä»»æ„ç»„åˆå¤šä¸ªè£…é¥°å™¨
âœ… å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
```

#### 7.2 å…³é”®å®ç°æŠ€å·§æ±‡æ€»

**ğŸ”§ æŠ€å·§æ¸…å•**

| æŠ€å·§ç±»å‹ | æ ¸å¿ƒè¦ç‚¹ | å®ç”¨æ€§ |
|----------|----------|--------|
| **é“¾å¼è®¾è®¡** | è£…é¥°å™¨åŸºç±»+å…·ä½“è£…é¥°å™¨ | â­â­â­â­â­ |
| **é€æ˜æ€§ä¿è¯** | æ¥å£ä¸€è‡´+å§”æ‰˜æœºåˆ¶ | â­â­â­â­â­ |
| **é¡ºåºæ§åˆ¶** | ä¼˜å…ˆçº§+å»ºé€ è€…æ¨¡å¼ | â­â­â­â­â˜† |
| **çŠ¶æ€ç®¡ç†** | æ— çŠ¶æ€ä¼˜å…ˆ+çº¿ç¨‹å®‰å…¨ | â­â­â­â˜†â˜† |
| **æ€§èƒ½ä¼˜åŒ–** | ç¼“å­˜+æ± åŒ–+ç›‘æ§ | â­â­â­â˜†â˜† |

#### 7.3 å®é™…åº”ç”¨åœºæ™¯

**ğŸŒŸ è£…é¥°å™¨æ¨¡å¼çš„å…¸å‹åº”ç”¨**
- **Java IOæµ**ï¼šBufferedReaderè£…é¥°FileReader
- **Webæ¡†æ¶**ï¼šFilteré“¾è£…é¥°è¯·æ±‚å¤„ç†
- **ç¼“å­˜ç³»ç»Ÿ**ï¼šå¤šçº§ç¼“å­˜è£…é¥°
- **GUIç»„ä»¶**ï¼šè¾¹æ¡†ã€æ»šåŠ¨æ¡è£…é¥°
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šæ ¼å¼åŒ–ã€è¿‡æ»¤è£…é¥°

#### 7.4 å­¦ä¹ æ£€æŸ¥æ¸…å•

**ğŸ“ è‡ªæˆ‘æ£€æµ‹æ¸…å•**
- [ ] èƒ½è§£é‡Šè£…é¥°å™¨æ¨¡å¼è§£å†³ä»€ä¹ˆé—®é¢˜
- [ ] ä¼šè®¾è®¡åŸºç¡€çš„è£…é¥°å™¨é“¾
- [ ] ç†è§£é€æ˜æ€§çš„é‡è¦æ€§å’Œå®ç°æ–¹æ³•
- [ ] çŸ¥é“å¦‚ä½•æ§åˆ¶è£…é¥°å™¨çš„åº”ç”¨é¡ºåº
- [ ] äº†è§£çŠ¶æ€ç®¡ç†çš„æ³¨æ„äº‹é¡¹
- [ ] æŒæ¡åŸºæœ¬çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§

#### 7.5 å¸¸è§é”™è¯¯ä¸é™·é˜±

**âš ï¸ æ–°æ‰‹å¸¸çŠ¯é”™è¯¯**
```
âŒ ç ´åé€æ˜æ€§ï¼šè£…é¥°å™¨æš´éœ²ç‰¹æœ‰æ–¹æ³•
âŒ çŠ¶æ€æ··ä¹±ï¼šå¤šä¸ªè£…é¥°å™¨å…±äº«å¯å˜çŠ¶æ€
âŒ è¿‡åº¦è£…é¥°ï¼šæ·»åŠ å¤ªå¤šå±‚è£…é¥°å™¨å½±å“æ€§èƒ½
âŒ é¡ºåºæ··ä¹±ï¼šä¸è€ƒè™‘è£…é¥°å™¨çš„åº”ç”¨é¡ºåº
âŒ å¿˜è®°å§”æ‰˜ï¼šè£…é¥°å™¨æ²¡æœ‰è°ƒç”¨è¢«è£…é¥°å¯¹è±¡çš„æ–¹æ³•
```

**âœ… æœ€ä½³å®è·µæé†’**
```
âœ… ä¿æŒæ¥å£ä¸€è‡´æ€§
âœ… ä¼˜å…ˆé€‰æ‹©æ— çŠ¶æ€è£…é¥°å™¨
âœ… è€ƒè™‘è£…é¥°å™¨çš„åº”ç”¨é¡ºåº
âœ… é€‚å½“ä½¿ç”¨æ€§èƒ½ä¼˜åŒ–æŠ€å·§
âœ… æä¾›æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜
```

#### 7.6 è¿›é˜¶å­¦ä¹ æ–¹å‘

**ğŸš€ æ·±å…¥å­¦ä¹ å»ºè®®**
1. **æºç åˆ†æ**ï¼šç ”ç©¶Java IOæµçš„è£…é¥°å™¨å®ç°
2. **æ¡†æ¶åº”ç”¨**ï¼šäº†è§£Spring AOPä¸­çš„è£…é¥°å™¨æ€æƒ³
3. **è®¾è®¡å˜ç§**ï¼šå­¦ä¹ åŠé€æ˜è£…é¥°å™¨ç­‰å˜ç§
4. **æ€§èƒ½è°ƒä¼˜**ï¼šæ·±å…¥ç ”ç©¶å¤§è§„æ¨¡åº”ç”¨çš„æ€§èƒ½ä¼˜åŒ–
5. **æ¨¡å¼ç»„åˆ**ï¼šè£…é¥°å™¨ä¸å…¶ä»–è®¾è®¡æ¨¡å¼çš„ç»„åˆä½¿ç”¨

**ğŸ“ æ ¸å¿ƒè®°å¿†å£è¯€**
> **è£…é¥°å™¨ç²¾é«“**ï¼šä¸€å±‚å¥—ä¸€å±‚ï¼ŒåŠŸèƒ½å åŠ å¢ï¼Œ
> æ¥å£è¦ä¸€è‡´ï¼Œå§”æ‰˜æ˜¯æ ¸å¿ƒï¼Œ
> é¡ºåºéœ€è€ƒè™‘ï¼ŒçŠ¶æ€è¦å°å¿ƒï¼Œ
> æ€§èƒ½åˆ«å¿˜è®°ï¼Œé€æ˜æœ€å…³é”®ï¼

---

**ğŸ“– å­¦ä¹ å»ºè®®**
è£…é¥°å™¨æ¨¡å¼æ˜¯è®¾è®¡æ¨¡å¼ä¸­çš„ç»å…¸ä¹‹ä¸€ï¼Œå»ºè®®ï¼š
1. **å…ˆç†è§£æ€æƒ³**ï¼šæ˜ç™½ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨
2. **å¤šå†™ä»£ç **ï¼šé€šè¿‡å®è·µåŠ æ·±ç†è§£
3. **åˆ†ææºç **ï¼šçœ‹çœ‹æˆç†Ÿæ¡†æ¶å¦‚ä½•ä½¿ç”¨
4. **ç»“åˆå®é™…**ï¼šæ€è€ƒåœ¨é¡¹ç›®ä¸­å¦‚ä½•åº”ç”¨

> ğŸ’¡ **æœ€åæé†’**ï¼šè£…é¥°å™¨æ¨¡å¼çš„æ ¸å¿ƒæ˜¯åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šï¼ŒåŠ¨æ€åœ°æ‰©å±•å¯¹è±¡åŠŸèƒ½ã€‚æŒæ¡è¿™ä¸ªæ ¸å¿ƒæ€æƒ³ï¼Œå…·ä½“çš„å®ç°æŠ€å·§éƒ½æ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…ï¼