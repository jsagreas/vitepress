---
title: 5ã€ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡è¦ç‚¹
---
## ğŸ“š ç›®å½•

1. [ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡æŒ‘æˆ˜æ¦‚è¿°](#1-ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡æŒ‘æˆ˜æ¦‚è¿°)
2. [ä¸­ä»‹è€…å¤æ‚åº¦æ§åˆ¶](#2-ä¸­ä»‹è€…å¤æ‚åº¦æ§åˆ¶)
3. [åŒäº‹ç±»è§£è€¦ç¨‹åº¦æŠŠæ¡](#3-åŒäº‹ç±»è§£è€¦ç¨‹åº¦æŠŠæ¡)
4. [é€šä¿¡æ•ˆç‡ä¼˜åŒ–ç­–ç•¥](#4-é€šä¿¡æ•ˆç‡ä¼˜åŒ–ç­–ç•¥)
5. [å•ç‚¹æ•…éšœé¿å…æ–¹æ¡ˆ](#5-å•ç‚¹æ•…éšœé¿å…æ–¹æ¡ˆ)
6. [å¯æµ‹è¯•æ€§è®¾è®¡åŸåˆ™](#6-å¯æµ‹è¯•æ€§è®¾è®¡åŸåˆ™)
7. [è®¾è®¡è¦ç‚¹ç»¼åˆåº”ç”¨](#7-è®¾è®¡è¦ç‚¹ç»¼åˆåº”ç”¨)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡æŒ‘æˆ˜æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨è®¾è®¡è¦ç‚¹


**ç†è§£æ ¸å¿ƒé—®é¢˜**ï¼š
ä¸­ä»‹è€…æ¨¡å¼å°±åƒç°å®ä¸­çš„**äº¤é€šæŒ‡æŒ¥ä¸­å¿ƒ**ï¼Œå¦‚æœè®¾è®¡ä¸å¥½ï¼ŒæŒ‡æŒ¥ä¸­å¿ƒæœ¬èº«å°±ä¼šå˜æˆäº¤é€šå µå¡çš„æºå¤´ï¼

```
ğŸš¦ äº¤é€šæŒ‡æŒ¥ä¸­å¿ƒç±»æ¯”ï¼š
è®¾è®¡è‰¯å¥½çš„æŒ‡æŒ¥ä¸­å¿ƒï¼š
â€¢ å„è·¯å£è½¦è¾†åªéœ€å…³æ³¨ä¿¡å·ç¯
â€¢ æŒ‡æŒ¥ä¸­å¿ƒåè°ƒå…¨åŸäº¤é€š
â€¢ ç³»ç»Ÿé«˜æ•ˆè¿è¡Œ

è®¾è®¡ç³Ÿç³•çš„æŒ‡æŒ¥ä¸­å¿ƒï¼š
â€¢ æŒ‡æŒ¥ä¸­å¿ƒé€»è¾‘æ··ä¹±
â€¢ å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Š
â€¢ æ•´ä¸ªäº¤é€šç³»ç»Ÿç˜«ç—ª
```

### 1.2 ä¸­ä»‹è€…æ¨¡å¼å¸¸è§è®¾è®¡é™·é˜±


**âš ï¸ æ–°æ‰‹å®¹æ˜“çŠ¯çš„é”™è¯¯**ï¼š

```
âŒ é™·é˜±1ï¼šä¸­ä»‹è€…å˜æˆ"ä¸Šå¸ç±»"
é—®é¢˜ï¼šæŠŠæ‰€æœ‰é€»è¾‘éƒ½å¡è¿›ä¸­ä»‹è€…
åæœï¼šä¸­ä»‹è€…å˜å¾—å·¨å¤§å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤

âŒ é™·é˜±2ï¼šè¿‡åº¦è§£è€¦
é—®é¢˜ï¼šç®€å•çš„ç›´æ¥è°ƒç”¨ä¹Ÿè¦ç»è¿‡ä¸­ä»‹è€…
åæœï¼šç³»ç»Ÿå˜å¾—ç¹çï¼Œæ€§èƒ½ä¸‹é™

âŒ é™·é˜±3ï¼šå¿½è§†é€šä¿¡å¼€é”€
é—®é¢˜ï¼šæ‰€æœ‰æ¶ˆæ¯éƒ½ç»è¿‡ä¸­ä»‹è€…è½¬å‘
åæœï¼šç³»ç»Ÿå“åº”å˜æ…¢ï¼Œèµ„æºæµªè´¹

âŒ é™·é˜±4ï¼šç¼ºä¹å®¹é”™æœºåˆ¶
é—®é¢˜ï¼šä¸­ä»‹è€…å‡ºé—®é¢˜æ•´ä¸ªç³»ç»Ÿå´©æºƒ
åæœï¼šå•ç‚¹æ•…éšœï¼Œç³»ç»Ÿå¯é æ€§å·®
```

### 1.3 ä¼˜ç§€è®¾è®¡çš„ç‰¹å¾


**âœ… è‰¯å¥½è®¾è®¡çš„æ ‡å¿—**ï¼š
```
èŒè´£æ¸…æ™°ï¼š
â€¢ ä¸­ä»‹è€…åªè´Ÿè´£åè°ƒå’Œè½¬å‘
â€¢ ä¸šåŠ¡é€»è¾‘ä»åœ¨å„ä¸ªåŒäº‹ç±»ä¸­
â€¢ æ¯ä¸ªç±»éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ

æ€§èƒ½åˆç†ï¼š
â€¢ é‡è¦çš„ç›´æ¥é€šä¿¡ä¿ç•™
â€¢ å¤æ‚çš„å¤šæ–¹äº¤äº’é€šè¿‡ä¸­ä»‹è€…
â€¢ é€šä¿¡å¼€é”€åœ¨å¯æ¥å—èŒƒå›´å†…

å¯æ‰©å±•æ€§å¼ºï¼š
â€¢ æ–°å¢åŒäº‹ç±»å®¹æ˜“
â€¢ ä¿®æ”¹äº¤äº’è§„åˆ™æ–¹ä¾¿
â€¢ ç³»ç»Ÿæ¶æ„ç¨³å®š
```

---

## 2. ğŸ§  ä¸­ä»‹è€…å¤æ‚åº¦æ§åˆ¶


### 2.1 å¤æ‚åº¦äº§ç”Ÿçš„æ ¹æº


**ä¸­ä»‹è€…ä¸ºä»€ä¹ˆä¼šå˜å¤æ‚ï¼Ÿ**
æƒ³è±¡ä¸€ä¸ª**å®¢æœä¸­å¿ƒ**ï¼Œå¦‚æœä»€ä¹ˆé—®é¢˜éƒ½è¦å®¢æœå¤„ç†ï¼Œå®¢æœå°±ä¼šè¢«ç´¯æ­»ï¼

```
å¤æ‚åº¦ç´¯ç§¯è¿‡ç¨‹ï¼š
åˆå§‹çŠ¶æ€ï¼š2ä¸ªåŒäº‹ç±»ï¼Œ1ç§äº¤äº’
ç¬¬ä¸€æ¬¡æ‰©å±•ï¼š4ä¸ªåŒäº‹ç±»ï¼Œ6ç§äº¤äº’  
ç¬¬äºŒæ¬¡æ‰©å±•ï¼š8ä¸ªåŒäº‹ç±»ï¼Œ28ç§äº¤äº’
ç¬¬ä¸‰æ¬¡æ‰©å±•ï¼š16ä¸ªåŒäº‹ç±»ï¼Œ120ç§äº¤äº’ â† çˆ†ç‚¸ï¼

æ•°å­¦åŸç†ï¼š
nä¸ªå¯¹è±¡çš„ä¸¤ä¸¤äº¤äº’ = nÃ—(n-1)/2
å¯¹è±¡æ•°é‡çº¿æ€§å¢é•¿ï¼Œäº¤äº’å¤æ‚åº¦å¹³æ–¹å¢é•¿
```

### 2.2 åˆ†å±‚åˆ†çº§æ§åˆ¶ç­–ç•¥


**ğŸ—ï¸ å±‚æ¬¡åŒ–ä¸­ä»‹è€…æ¶æ„**ï¼š

```
åˆ†å±‚ä¸­ä»‹è€…è®¾è®¡ï¼š
                 ä¸»ä¸­ä»‹è€…
                /   |   \
           å­ä¸­ä»‹è€…A å­ä¸­ä»‹è€…B å­ä¸­ä»‹è€…C
           /  |  \    /  |  \    /  |  \
        åŒäº‹1 åŒäº‹2 åŒäº‹3 åŒäº‹4 åŒäº‹5 åŒäº‹6

ä¼˜åŠ¿åˆ†æï¼š
âœ… æ¯ä¸ªå­ä¸­ä»‹è€…ç®¡ç†å°‘é‡åŒäº‹ç±»
âœ… ä¸»ä¸­ä»‹è€…åªåè°ƒå­ä¸­ä»‹è€…
âœ… å¤æ‚åº¦åˆ†æ•£ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
âœ… å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•å„ä¸ªå­ç³»ç»Ÿ
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
ä»¥èŠå¤©å®¤ç³»ç»Ÿä¸ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åˆ†å±‚æ§åˆ¶å¤æ‚åº¦ï¼š

```java
// ä¸»ä¸­ä»‹è€…ï¼šèŠå¤©å®¤ç³»ç»Ÿç®¡ç†å™¨
public class ChatSystemMediator {
    private Map<String, RoomMediator> rooms = new HashMap<>();
    private UserManager userManager = new UserManager();
    
    // åªå¤„ç†æˆ¿é—´çº§åˆ«çš„åè°ƒ
    public void createRoom(String roomId) {
        rooms.put(roomId, new RoomMediator(roomId, this));
    }
    
    public void userJoinRoom(User user, String roomId) {
        RoomMediator room = rooms.get(roomId);
        if (room != null) {
            room.addUser(user);  // å§”æ‰˜ç»™å­ä¸­ä»‹è€…
        }
    }
}

// å­ä¸­ä»‹è€…ï¼šå•ä¸ªèŠå¤©å®¤
public class RoomMediator {
    private List<User> users = new ArrayList<>();
    private ChatSystemMediator parent;
    
    // åªå¤„ç†æˆ¿é—´å†…éƒ¨çš„ç”¨æˆ·äº¤äº’
    public void sendMessage(User sender, String message) {
        for (User user : users) {
            if (user != sender) {
                user.receiveMessage(sender.getName() + ": " + message);
            }
        }
    }
}
```

### 2.3 åŠŸèƒ½æ¨¡å—åŒ–æ‹†åˆ†


**ğŸ”§ æŒ‰åŠŸèƒ½åŸŸåˆ’åˆ†ä¸­ä»‹è€…**ï¼š

```
åŠŸèƒ½å¯¼å‘çš„æ‹†åˆ†ç­–ç•¥ï¼š

å•ä¸€èŒè´£ä¸­ä»‹è€…ï¼š
â€¢ æ¶ˆæ¯ä¸­ä»‹è€…ï¼šä¸“é—¨å¤„ç†æ¶ˆæ¯ä¼ é€’
â€¢ æƒé™ä¸­ä»‹è€…ï¼šä¸“é—¨å¤„ç†æƒé™éªŒè¯  
â€¢ çŠ¶æ€ä¸­ä»‹è€…ï¼šä¸“é—¨å¤„ç†çŠ¶æ€åŒæ­¥
â€¢ äº‹ä»¶ä¸­ä»‹è€…ï¼šä¸“é—¨å¤„ç†äº‹ä»¶åˆ†å‘

åä½œæ–¹å¼ï¼š
æ¶ˆæ¯å‘é€ â†’ æƒé™ä¸­ä»‹è€…éªŒè¯ â†’ æ¶ˆæ¯ä¸­ä»‹è€…è½¬å‘ â†’ çŠ¶æ€ä¸­ä»‹è€…åŒæ­¥

å¥½å¤„ï¼š
âœ… æ¯ä¸ªä¸­ä»‹è€…èŒè´£å•ä¸€
âœ… å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–æ€§èƒ½
âœ… å®¹æ˜“å•å…ƒæµ‹è¯•
âœ… å¯ä»¥é€‰æ‹©æ€§ä½¿ç”¨åŠŸèƒ½
```

### 2.4 é…ç½®é©±åŠ¨çš„ä¸­ä»‹è€…


**ğŸ“‹ ç”¨é…ç½®æ–‡ä»¶æ§åˆ¶å¤æ‚åº¦**ï¼š

```java
// é€šè¿‡é…ç½®å®šä¹‰äº¤äº’è§„åˆ™ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç 
public class ConfigurableMediator {
    private Map<String, List<String>> interactionRules;
    
    public ConfigurableMediator(String configFile) {
        this.interactionRules = loadConfig(configFile);
    }
    
    public void notify(String sender, String event, Object data) {
        List<String> receivers = interactionRules.get(sender + "." + event);
        if (receivers != null) {
            for (String receiverId : receivers) {
                Component receiver = components.get(receiverId);
                receiver.handleEvent(event, data);
            }
        }
    }
}
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š
```yaml
# interaction-rules.yml
rules:
  UserPanel.login:
    - AuthService
    - LoggingService
  UserPanel.logout:
    - AuthService
    - SessionManager
  OrderPanel.submit:
    - PaymentService
    - InventoryService
    - NotificationService
```

---

## 3. ğŸ”— åŒäº‹ç±»è§£è€¦ç¨‹åº¦æŠŠæ¡


### 3.1 è§£è€¦çš„åº¦é‡æ ‡å‡†


**ä»€ä¹ˆæ˜¯åˆé€‚çš„è§£è€¦ç¨‹åº¦ï¼Ÿ**
è§£è€¦å°±åƒæœ‹å‹ä¹‹é—´çš„å…³ç³»ï¼Œ**å¤ªç”Ÿç–äº†ä¸åˆ©äºåˆä½œï¼Œå¤ªäº²å¯†äº†å¤±å»ç‹¬ç«‹æ€§**ã€‚

```
ğŸ¯ è§£è€¦ç¨‹åº¦è¯„ä¼°ï¼š

è¿‡åº¦è€¦åˆï¼ˆâŒï¼‰ï¼š
UserPanel panel = new UserPanel();
OrderService service = new OrderService();
panel.orderService = service;        // ç›´æ¥ä¾èµ–
service.userPanel = panel;           // å¾ªç¯ä¾èµ–
panel.updateOrder(service.getOrder()); // ç´§å¯†è°ƒç”¨

é€‚åº¦è§£è€¦ï¼ˆâœ…ï¼‰ï¼š
// é€šè¿‡ä¸­ä»‹è€…åè°ƒ
mediator.notify("UserPanel", "orderRequested", orderData);
// ä¸­ä»‹è€…è½¬å‘ç»™OrderService
// OrderServiceå¤„ç†å®Œé€šçŸ¥ä¸­ä»‹è€…
// ä¸­ä»‹è€…å†é€šçŸ¥UserPanelæ›´æ–°

è¿‡åº¦è§£è€¦ï¼ˆâŒï¼‰ï¼š
// è¿ç®€å•çš„getterè°ƒç”¨ä¹Ÿè¦é€šè¿‡ä¸­ä»‹è€…
mediator.notify("UserPanel", "getUserName", null);
// ä¸ºäº†è·å–ä¸€ä¸ªç”¨æˆ·åä¹Ÿè¦èµ°ä¸­ä»‹è€…ï¼Œå¤ªç¹çäº†ï¼
```

### 3.2 ç›´æ¥é€šä¿¡ vs ä¸­ä»‹é€šä¿¡çš„é€‰æ‹©


**ğŸ¤” ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ä¸­ä»‹è€…ï¼Ÿ**

```
å†³ç­–æ ‘æŒ‡å—ï¼š

è¿™æ˜¯ç®€å•çš„æ•°æ®æŸ¥è¯¢å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ç›´æ¥è°ƒç”¨ï¼ˆå¦‚ï¼šgetUserName()ï¼‰
â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­

è¿™ä¼šå½±å“å¤šä¸ªå¯¹è±¡çš„çŠ¶æ€å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ä¸­ä»‹è€…
â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­

è¿™æ˜¯ä¸´æ—¶çš„ä¸€æ¬¡æ€§äº¤äº’å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ç›´æ¥è°ƒç”¨
â””â”€ å¦ â†’ ä½¿ç”¨ä¸­ä»‹è€…

è¿™ç§äº¤äº’æ¨¡å¼ä¼šé‡å¤å‡ºç°å—ï¼Ÿ
â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ä¸­ä»‹è€…
â””â”€ å¦ â†’ ç›´æ¥è°ƒç”¨
```

**å®é™…åˆ¤æ–­ç¤ºä¾‹**ï¼š
```java
// âœ… é€‚åˆç›´æ¥è°ƒç”¨
String userName = user.getName();           // ç®€å•æŸ¥è¯¢
boolean isValid = validator.check(data);    // æ— çŠ¶æ€éªŒè¯

// âœ… é€‚åˆä½¿ç”¨ä¸­ä»‹è€…  
mediator.notify("User", "login", userData);     // å½±å“å¤šä¸ªç³»ç»Ÿ
mediator.notify("Order", "statusChanged", order); // éœ€è¦å¹¿æ’­é€šçŸ¥
```

### 3.3 æ¥å£è®¾è®¡çš„è§£è€¦æŠ€å·§


**ğŸ¨ ä¼˜é›…çš„æ¥å£è®¾è®¡**ï¼š

```java
// âŒ ç´§è€¦åˆçš„è®¾è®¡
public class BadColleague {
    private ConcreteMediator mediator;  // ä¾èµ–å…·ä½“å®ç°
    
    public void doSomething() {
        mediator.specificMethod();     // è°ƒç”¨ç‰¹å®šæ–¹æ³•
    }
}

// âœ… æ¾è€¦åˆçš„è®¾è®¡
public abstract class SmartColleague {
    protected MediatorInterface mediator;  // ä¾èµ–æŠ½è±¡æ¥å£
    
    protected void notify(String event, Object data) {
        mediator.notify(this, event, data);  // é€šç”¨é€šçŸ¥æœºåˆ¶
    }
}

// å…·ä½“åŒäº‹ç±»åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä¸šåŠ¡
public class UserPanel extends SmartColleague {
    public void userLogin() {
        // å¤„ç†è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘
        String userData = collectUserInput();
        
        // é€šçŸ¥å…¶ä»–å¯¹è±¡ï¼Œä½†ä¸éœ€è¦çŸ¥é“å…·ä½“æ˜¯è°
        notify("userLogin", userData);
    }
}
```

### 3.4 äº‹ä»¶é©±åŠ¨çš„æ¾æ•£è€¦åˆ


**ğŸ“¡ åŸºäºäº‹ä»¶çš„é€šä¿¡æœºåˆ¶**ï¼š

```java
// äº‹ä»¶å®šä¹‰
public class LoginEvent {
    private String userId;
    private Date timestamp;
    // ... äº‹ä»¶æ•°æ®
}

// å‘å¸ƒ-è®¢é˜…æ¨¡å¼çš„ä¸­ä»‹è€…
public class EventMediator {
    private Map<Class<?>, List<EventHandler>> handlers = new HashMap<>();
    
    public void subscribe(Class<?> eventType, EventHandler handler) {
        handlers.computeIfAbsent(eventType, k -> new ArrayList<>()).add(handler);
    }
    
    public void publish(Object event) {
        List<EventHandler> eventHandlers = handlers.get(event.getClass());
        if (eventHandlers != null) {
            for (EventHandler handler : eventHandlers) {
                handler.handle(event);
            }
        }
    }
}
```

è¿™ç§è®¾è®¡çš„å¥½å¤„ï¼š
- **å‘å¸ƒè€…ä¸çŸ¥é“è°åœ¨ç›‘å¬**ï¼šå®Œå…¨è§£è€¦
- **è®¢é˜…è€…å¯ä»¥åŠ¨æ€å¢å‡**ï¼šçµæ´»æ€§é«˜
- **äº‹ä»¶ç±»å‹æ˜ç¡®**ï¼šæ˜“äºç†è§£å’Œè°ƒè¯•

---

## 4. âš¡ é€šä¿¡æ•ˆç‡ä¼˜åŒ–ç­–ç•¥


### 4.1 é€šä¿¡å¼€é”€åˆ†æ


**ç†è§£æ€§èƒ½ç“¶é¢ˆ**ï¼š
ä¸­ä»‹è€…æ¨¡å¼å°±åƒ**é‚®å±€ç³»ç»Ÿ**ï¼Œå¦‚æœæ¯å°ä¿¡éƒ½è¦ç»è¿‡æ€»é‚®å±€è½¬å‘ï¼Œæ•ˆç‡è‚¯å®šæ¯”ç›´æ¥æŠ•é€’è¦ä½ã€‚

```
ğŸƒ æ€§èƒ½å¯¹æ¯”åˆ†æï¼š

ç›´æ¥è°ƒç”¨ï¼š
å¯¹è±¡A â†’ å¯¹è±¡B
è°ƒç”¨æ ˆï¼š1å±‚
å†…å­˜å¼€é”€ï¼šæœ€å°
æ‰§è¡Œæ—¶é—´ï¼šæœ€å¿«

ä¸­ä»‹è€…è°ƒç”¨ï¼š
å¯¹è±¡A â†’ ä¸­ä»‹è€… â†’ å¯¹è±¡B â†’ ä¸­ä»‹è€… â†’ å¯¹è±¡A
è°ƒç”¨æ ˆï¼š3-4å±‚  
å†…å­˜å¼€é”€ï¼šä¸­ç­‰
æ‰§è¡Œæ—¶é—´ï¼š2-3å€äºç›´æ¥è°ƒç”¨

å¼‚æ­¥ä¸­ä»‹è€…ï¼š
å¯¹è±¡A â†’ ä¸­ä»‹è€…ï¼ˆé˜Ÿåˆ—ï¼‰â†’ å¼‚æ­¥å¤„ç† â†’ å¯¹è±¡B
è°ƒç”¨æ ˆï¼šåˆ†ç¦»
å†…å­˜å¼€é”€ï¼šè¾ƒå¤§ï¼ˆé˜Ÿåˆ—ç¼“å†²ï¼‰
æ‰§è¡Œæ—¶é—´ï¼šçœ‹æƒ…å†µï¼ˆå¯èƒ½æ›´å¿«æˆ–æ›´æ…¢ï¼‰
```

### 4.2 æ‰¹é‡å¤„ç†ä¼˜åŒ–


**ğŸ“¦ æ‰¹å¤„ç†å‡å°‘é€šä¿¡æ¬¡æ•°**ï¼š

```java
// âŒ ä½æ•ˆçš„é€ä¸ªå¤„ç†
public class InefficientMediator {
    public void processUsers(List<User> users) {
        for (User user : users) {
            notify("UserService", "process", user);  // æ¯æ¬¡éƒ½è¦é€šä¿¡
        }
    }
}

// âœ… é«˜æ•ˆçš„æ‰¹é‡å¤„ç†
public class EfficientMediator {
    private List<Object> pendingEvents = new ArrayList<>();
    
    public void addEvent(String target, String action, Object data) {
        pendingEvents.add(new Event(target, action, data));
        
        // è¾¾åˆ°æ‰¹é‡å¤§å°æ—¶ç»Ÿä¸€å¤„ç†
        if (pendingEvents.size() >= BATCH_SIZE) {
            processBatch();
        }
    }
    
    private void processBatch() {
        // æŒ‰ç›®æ ‡å¯¹è±¡åˆ†ç»„ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢
        Map<String, List<Event>> grouped = pendingEvents.stream()
            .collect(Collectors.groupingBy(Event::getTarget));
        
        for (Map.Entry<String, List<Event>> entry : grouped.entrySet()) {
            Component target = components.get(entry.getKey());
            target.processBatch(entry.getValue());  // æ‰¹é‡å¤„ç†
        }
        
        pendingEvents.clear();
    }
}
```

### 4.3 ç¼“å­˜å’Œé¢„å¤„ç†


**ğŸ—„ï¸ æ™ºèƒ½ç¼“å­˜ç­–ç•¥**ï¼š

```java
public class CachedMediator {
    private Map<String, Object> resultCache = new LRUCache<>(1000);
    private Map<String, List<String>> routeCache = new HashMap<>();
    
    public Object notify(String sender, String action, Object data) {
        // ç”Ÿæˆç¼“å­˜é”®
        String cacheKey = sender + ":" + action + ":" + data.hashCode();
        
        // æ£€æŸ¥ç»“æœç¼“å­˜
        Object cachedResult = resultCache.get(cacheKey);
        if (cachedResult != null) {
            return cachedResult;  // ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ
        }
        
        // æ£€æŸ¥è·¯ç”±ç¼“å­˜
        String routeKey = sender + ":" + action;
        List<String> targets = routeCache.get(routeKey);
        
        if (targets == null) {
            // é¦–æ¬¡è®¡ç®—è·¯ç”±ï¼Œå¹¶ç¼“å­˜
            targets = calculateTargets(sender, action);
            routeCache.put(routeKey, targets);
        }
        
        // æ‰§è¡Œå¹¶ç¼“å­˜ç»“æœ
        Object result = executeNotification(targets, data);
        resultCache.put(cacheKey, result);
        return result;
    }
}
```

### 4.4 å¼‚æ­¥é€šä¿¡ä¼˜åŒ–


**ğŸ”„ å¼‚æ­¥å¤„ç†æ¨¡å¼**ï¼š

```java
public class AsyncMediator {
    private ExecutorService executor = Executors.newFixedThreadPool(10);
    private BlockingQueue<MediatorEvent> eventQueue = new ArrayBlockingQueue<>(1000);
    
    // éé˜»å¡é€šçŸ¥
    public void notifyAsync(String sender, String action, Object data) {
        MediatorEvent event = new MediatorEvent(sender, action, data);
        
        try {
            eventQueue.offer(event, 100, TimeUnit.MILLISECONDS);
        } catch (InterruptedException e) {
            // å¤„ç†é˜Ÿåˆ—æ»¡çš„æƒ…å†µ
            handleQueueFull(event);
        }
    }
    
    // åå°å¤„ç†å™¨
    @PostConstruct
    public void startEventProcessor() {
        executor.submit(() -> {
            while (!Thread.currentThread().isInterrupted()) {
                try {
                    MediatorEvent event = eventQueue.take();
                    processEvent(event);
                } catch (InterruptedException e) {
                    Thread.currentThread().interrupt();
                    break;
                }
            }
        });
    }
    
    // éœ€è¦ç«‹å³å“åº”çš„åŒæ­¥æ–¹æ³•
    public Object notifySync(String sender, String action, Object data) {
        return processEventDirectly(new MediatorEvent(sender, action, data));
    }
}
```

**å¼‚æ­¥é€šä¿¡çš„é€‚ç”¨åœºæ™¯**ï¼š
```
âœ… é€‚åˆå¼‚æ­¥çš„æƒ…å†µï¼š
â€¢ æ—¥å¿—è®°å½•å’Œå®¡è®¡
â€¢ æ•°æ®åŒæ­¥å’Œå¤‡ä»½  
â€¢ é€šçŸ¥å’Œæé†’å‘é€
â€¢ ç»Ÿè®¡æ•°æ®æ›´æ–°

âŒ ä¸é€‚åˆå¼‚æ­¥çš„æƒ…å†µï¼š
â€¢ ç”¨æˆ·ç•Œé¢äº¤äº’
â€¢ æ•°æ®éªŒè¯æ£€æŸ¥
â€¢ å…³é”®ä¸šåŠ¡æµç¨‹
â€¢ éœ€è¦ç«‹å³åé¦ˆçš„æ“ä½œ
```

---

## 5. ğŸ›¡ï¸ å•ç‚¹æ•…éšœé¿å…æ–¹æ¡ˆ


### 5.1 å•ç‚¹æ•…éšœçš„å±å®³


**ç†è§£å•ç‚¹æ•…éšœé£é™©**ï¼š
ä¸­ä»‹è€…æ¨¡å¼çš„æœ€å¤§é£é™©å°±æ˜¯**ä¸­ä»‹è€…æˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆå’Œå•ç‚¹æ•…éšœ**ï¼Œå°±åƒåŸå¸‚åªæœ‰ä¸€ä¸ªäº¤é€šæ§åˆ¶ä¸­å¿ƒï¼Œä¸€æ—¦å‡ºé—®é¢˜æ•´ä¸ªåŸå¸‚äº¤é€šç˜«ç—ªã€‚

```
ğŸš¨ å•ç‚¹æ•…éšœåœºæ™¯ï¼š

åœºæ™¯1ï¼šä¸­ä»‹è€…å´©æºƒ
åŸå› ï¼šå†…å­˜æº¢å‡ºã€é€»è¾‘é”™è¯¯ã€ç¡¬ä»¶æ•…éšœ
å½±å“ï¼šæ‰€æœ‰åŒäº‹ç±»æ— æ³•é€šä¿¡ï¼Œæ•´ä¸ªç³»ç»Ÿåœæ­¢å·¥ä½œ

åœºæ™¯2ï¼šä¸­ä»‹è€…è¿‡è½½
åŸå› ï¼šè¯·æ±‚é‡è¶…è¿‡å¤„ç†èƒ½åŠ›
å½±å“ï¼šå“åº”æ—¶é—´æ€¥å‰§å¢é•¿ï¼Œç”¨æˆ·ä½“éªŒæ¶åŒ–

åœºæ™¯3ï¼šä¸­ä»‹è€…é€»è¾‘é”™è¯¯
åŸå› ï¼šBugå¯¼è‡´æ¶ˆæ¯è½¬å‘é”™è¯¯
å½±å“ï¼šç³»ç»Ÿè¡Œä¸ºå¼‚å¸¸ï¼Œæ•°æ®ä¸ä¸€è‡´
```

### 5.2 ä¸­ä»‹è€…é›†ç¾¤åŒ–


**ğŸ—ï¸ ä¸»å¤‡æ¨¡å¼è®¾è®¡**ï¼š

```java
public class HAMediatorCluster {
    private MediatorNode primaryNode;
    private List<MediatorNode> backupNodes;
    private HealthChecker healthChecker;
    
    public Object notify(String sender, String action, Object data) {
        try {
            // ä¼˜å…ˆä½¿ç”¨ä¸»èŠ‚ç‚¹
            if (healthChecker.isHealthy(primaryNode)) {
                return primaryNode.notify(sender, action, data);
            }
            
            // ä¸»èŠ‚ç‚¹ä¸å¯ç”¨ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹
            for (MediatorNode backup : backupNodes) {
                if (healthChecker.isHealthy(backup)) {
                    promoteToPrimary(backup);  // æå‡ä¸ºä¸»èŠ‚ç‚¹
                    return backup.notify(sender, action, data);
                }
            }
            
            throw new SystemException("æ‰€æœ‰ä¸­ä»‹è€…èŠ‚ç‚¹éƒ½ä¸å¯ç”¨");
            
        } catch (Exception e) {
            // è®°å½•é”™è¯¯å¹¶å°è¯•é™çº§å¤„ç†
            logger.error("ä¸­ä»‹è€…é€šä¿¡å¤±è´¥", e);
            return handleFallback(sender, action, data);
        }
    }
    
    // é™çº§å¤„ç†ï¼šå…è®¸æŸäº›ç›´æ¥é€šä¿¡
    private Object handleFallback(String sender, String action, Object data) {
        if (isCriticalOperation(action)) {
            // å…³é”®æ“ä½œå…è®¸ç›´æ¥è°ƒç”¨
            return directCall(sender, action, data);
        }
        return null;  // éå…³é”®æ“ä½œå¯ä»¥å¤±è´¥
    }
}
```

### 5.3 æ–­è·¯å™¨æ¨¡å¼é›†æˆ


**âš¡ æ•…éšœå¿«é€Ÿæ£€æµ‹ä¸éš”ç¦»**ï¼š

```java
public class CircuitBreakerMediator {
    private Map<String, CircuitBreaker> circuitBreakers = new HashMap<>();
    
    public Object notify(String sender, String action, Object data) {
        String operationKey = sender + ":" + action;
        CircuitBreaker breaker = circuitBreakers.computeIfAbsent(
            operationKey, k -> new CircuitBreaker(operationKey)
        );
        
        return breaker.execute(() -> {
            return processNotification(sender, action, data);
        });
    }
}

class CircuitBreaker {
    private enum State { CLOSED, OPEN, HALF_OPEN }
    
    private State state = State.CLOSED;
    private int failureCount = 0;
    private long lastFailureTime = 0;
    private final int failureThreshold = 5;
    private final long timeout = 60000; // 1åˆ†é’Ÿ
    
    public Object execute(Supplier<Object> operation) {
        if (state == State.OPEN) {
            if (System.currentTimeMillis() - lastFailureTime > timeout) {
                state = State.HALF_OPEN;  // å°è¯•æ¢å¤
            } else {
                throw new CircuitOpenException("æ–­è·¯å™¨å¼€å¯ï¼Œæ“ä½œè¢«æ‹’ç»");
            }
        }
        
        try {
            Object result = operation.get();
            onSuccess();
            return result;
        } catch (Exception e) {
            onFailure();
            throw e;
        }
    }
    
    private void onSuccess() {
        failureCount = 0;
        state = State.CLOSED;
    }
    
    private void onFailure() {
        failureCount++;
        lastFailureTime = System.currentTimeMillis();
        if (failureCount >= failureThreshold) {
            state = State.OPEN;
        }
    }
}
```

### 5.4 ä¼˜é›…é™çº§ç­–ç•¥


**ğŸ“‰ ç³»ç»Ÿé™çº§æ–¹æ¡ˆ**ï¼š

```java
public class GracefulDegradationMediator {
    private enum DegradationLevel {
        NORMAL,      // æ­£å¸¸æ¨¡å¼ï¼šæ‰€æœ‰åŠŸèƒ½å¯ç”¨
        DEGRADED,    // é™çº§æ¨¡å¼ï¼šéå…³é”®åŠŸèƒ½ç¦ç”¨
        MINIMAL      // æœ€å°æ¨¡å¼ï¼šåªä¿ç•™æ ¸å¿ƒåŠŸèƒ½
    }
    
    private DegradationLevel currentLevel = DegradationLevel.NORMAL;
    private SystemMonitor monitor = new SystemMonitor();
    
    public Object notify(String sender, String action, Object data) {
        // æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´é™çº§ç­‰çº§
        updateDegradationLevel();
        
        switch (currentLevel) {
            case NORMAL:
                return processNormally(sender, action, data);
            
            case DEGRADED:
                if (isCriticalOperation(action)) {
                    return processNormally(sender, action, data);
                } else {
                    return processWithCache(sender, action, data);  // ä½¿ç”¨ç¼“å­˜
                }
            
            case MINIMAL:
                if (isEssentialOperation(action)) {
                    return processDirectly(sender, action, data);   // ç›´æ¥è°ƒç”¨
                } else {
                    return getDefaultResponse(action);              // è¿”å›é»˜è®¤å€¼
                }
        }
        
        return null;
    }
    
    private void updateDegradationLevel() {
        SystemHealth health = monitor.getCurrentHealth();
        
        if (health.getCpuUsage() > 90 || health.getMemoryUsage() > 90) {
            currentLevel = DegradationLevel.MINIMAL;
        } else if (health.getCpuUsage() > 70 || health.getMemoryUsage() > 70) {
            currentLevel = DegradationLevel.DEGRADED;
        } else {
            currentLevel = DegradationLevel.NORMAL;
        }
    }
}
```

---

## 6. ğŸ§ª å¯æµ‹è¯•æ€§è®¾è®¡åŸåˆ™


### 6.1 æµ‹è¯•å‹å¥½çš„æ¶æ„è®¾è®¡


**ä¸ºä»€ä¹ˆä¸­ä»‹è€…éš¾ä»¥æµ‹è¯•ï¼Ÿ**
ä¸­ä»‹è€…è¿æ¥äº†å¤ªå¤šå¯¹è±¡ï¼Œå°±åƒæµ‹è¯•ä¸€ä¸ª**å¤§å‹æœºå™¨çš„ä¼ åŠ¨ç³»ç»Ÿ**ï¼Œå¾ˆéš¾å•ç‹¬æµ‹è¯•æŸä¸ªé½¿è½®ã€‚

```
æµ‹è¯•æŒ‘æˆ˜åˆ†æï¼š

âŒ éš¾ä»¥æµ‹è¯•çš„è®¾è®¡ï¼š
â€¢ ä¸­ä»‹è€…ç›´æ¥ä¾èµ–å…·ä½“çš„åŒäº‹ç±»
â€¢ æ‰€æœ‰é€»è¾‘éƒ½åœ¨ä¸€ä¸ªå¤§æ–¹æ³•é‡Œ
â€¢ æ²¡æœ‰æ¸…æ™°çš„è¾“å…¥è¾“å‡ºè¾¹ç•Œ
â€¢ ä¾èµ–å¤–éƒ¨èµ„æºï¼ˆæ•°æ®åº“ã€ç½‘ç»œï¼‰

âœ… æ˜“äºæµ‹è¯•çš„è®¾è®¡ï¼š
â€¢ ä¾èµ–æ³¨å…¥æ‰€æœ‰å¤–éƒ¨ä¾èµ–
â€¢ åŠŸèƒ½æ‹†åˆ†ä¸ºå°çš„å¯æµ‹è¯•å•å…ƒ
â€¢ æ˜ç¡®çš„æ¥å£å’Œå¥‘çº¦
â€¢ å¯ä»¥æ¨¡æ‹Ÿæ‰€æœ‰å¤–éƒ¨äº¤äº’
```

### 6.2 ä¾èµ–æ³¨å…¥ä¸æ¨¡æ‹Ÿæµ‹è¯•


**ğŸ”§ å¯æµ‹è¯•çš„ä¸­ä»‹è€…è®¾è®¡**ï¼š

```java
// å¯æµ‹è¯•çš„ä¸­ä»‹è€…æ¥å£
public interface TestableMediator {
    void addColleague(String id, Colleague colleague);
    Object notify(String sender, String action, Object data);
    List<String> getNotificationHistory();  // ç”¨äºæµ‹è¯•éªŒè¯
}

// å…·ä½“å®ç°
public class ProductionMediator implements TestableMediator {
    private Map<String, Colleague> colleagues;
    private NotificationLogger logger;
    private MessageValidator validator;
    
    // æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼ˆä¾¿äºæµ‹è¯•æ—¶æ›¿æ¢ï¼‰
    public ProductionMediator(NotificationLogger logger, 
                            MessageValidator validator) {
        this.colleagues = new HashMap<>();
        this.logger = logger;
        this.validator = validator;
    }
    
    @Override
    public Object notify(String sender, String action, Object data) {
        // éªŒè¯è¾“å…¥
        if (!validator.isValid(sender, action, data)) {
            throw new IllegalArgumentException("æ— æ•ˆçš„é€šçŸ¥å‚æ•°");
        }
        
        // è®°å½•é€šçŸ¥ï¼ˆä¾¿äºæµ‹è¯•éªŒè¯ï¼‰
        logger.log(sender, action, data);
        
        // å¤„ç†é€šçŸ¥é€»è¾‘
        return processNotification(sender, action, data);
    }
    
    // æµ‹è¯•è¾…åŠ©æ–¹æ³•
    @Override
    public List<String> getNotificationHistory() {
        return logger.getHistory();
    }
}
```

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š
```java
public class MediatorTest {
    private TestableMediator mediator;
    private MockNotificationLogger mockLogger;
    private MockMessageValidator mockValidator;
    private MockColleague mockColleague;
    
    @BeforeEach
    void setUp() {
        mockLogger = new MockNotificationLogger();
        mockValidator = new MockMessageValidator();
        mediator = new ProductionMediator(mockLogger, mockValidator);
        
        mockColleague = new MockColleague();
        mediator.addColleague("testColleague", mockColleague);
    }
    
    @Test
    void shouldNotifyColleagueWhenValidMessage() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        String sender = "userPanel";
        String action = "login";
        Object data = new LoginData("testUser");
        
        // é…ç½®æ¨¡æ‹Ÿå¯¹è±¡
        mockValidator.setValid(true);
        
        // æ‰§è¡Œæµ‹è¯•
        Object result = mediator.notify(sender, action, data);
        
        // éªŒè¯ç»“æœ
        assertThat(result).isNotNull();
        assertThat(mockLogger.getHistory()).hasSize(1);
        assertThat(mockColleague.getReceivedMessages()).hasSize(1);
    }
    
    @Test
    void shouldRejectInvalidMessage() {
        // é…ç½®æ¨¡æ‹Ÿå¯¹è±¡è¿”å›éªŒè¯å¤±è´¥
        mockValidator.setValid(false);
        
        // éªŒè¯å¼‚å¸¸æŠ›å‡º
        assertThrows(IllegalArgumentException.class, () -> {
            mediator.notify("invalid", "action", null);
        });
        
        // éªŒè¯æ²¡æœ‰å¤„ç†æ¶ˆæ¯
        assertThat(mockColleague.getReceivedMessages()).isEmpty();
    }
}
```

### 6.3 çŠ¶æ€éªŒè¯ä¸è¡Œä¸ºéªŒè¯


**ğŸ“Š æµ‹è¯•ç­–ç•¥å¯¹æ¯”**ï¼š

```
çŠ¶æ€éªŒè¯æµ‹è¯•ï¼š
é‡ç‚¹ï¼šéªŒè¯æ“ä½œåå¯¹è±¡çš„çŠ¶æ€å˜åŒ–
ä¼˜åŠ¿ï¼šç®€å•ç›´è§‚ï¼Œå®¹æ˜“ç†è§£
ç¼ºç‚¹ï¼šéœ€è¦æš´éœ²å†…éƒ¨çŠ¶æ€

è¡Œä¸ºéªŒè¯æµ‹è¯•ï¼š
é‡ç‚¹ï¼šéªŒè¯å¯¹è±¡é—´çš„äº¤äº’è¿‡ç¨‹
ä¼˜åŠ¿ï¼šæµ‹è¯•çœŸå®çš„åä½œè¡Œä¸º
ç¼ºç‚¹ï¼šéœ€è¦å¤æ‚çš„æ¨¡æ‹Ÿè®¾ç½®
```

**è¡Œä¸ºéªŒè¯ç¤ºä¾‹**ï¼š
```java
@Test
void shouldCoordinateLoginProcess() {
    // ä½¿ç”¨MockitoéªŒè¯äº¤äº’è¡Œä¸º
    AuthService mockAuthService = mock(AuthService.class);
    SessionManager mockSessionManager = mock(SessionManager.class);
    
    mediator.addColleague("authService", mockAuthService);
    mediator.addColleague("sessionManager", mockSessionManager);
    
    // æ‰§è¡Œç™»å½•æ“ä½œ
    LoginData loginData = new LoginData("user", "password");
    mediator.notify("userPanel", "login", loginData);
    
    // éªŒè¯è°ƒç”¨é¡ºåºå’Œå‚æ•°
    InOrder inOrder = inOrder(mockAuthService, mockSessionManager);
    inOrder.verify(mockAuthService).authenticate("user", "password");
    inOrder.verify(mockSessionManager).createSession("user");
}
```

### 6.4 é›†æˆæµ‹è¯•ç­–ç•¥


**ğŸ”— ç«¯åˆ°ç«¯æµ‹è¯•è®¾è®¡**ï¼š

```java
@SpringBootTest
public class MediatorIntegrationTest {
    
    @Autowired
    private ChatRoomMediator chatMediator;
    
    @Test
    void shouldHandleCompleteConversationFlow() {
        // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
        User alice = new User("alice");
        User bob = new User("bob");
        
        // ç”¨æˆ·åŠ å…¥èŠå¤©å®¤
        chatMediator.userJoin(alice, "room1");
        chatMediator.userJoin(bob, "room1");
        
        // Aliceå‘é€æ¶ˆæ¯
        chatMediator.sendMessage(alice, "room1", "Hello Bob!");
        
        // éªŒè¯Bobæ”¶åˆ°æ¶ˆæ¯
        List<String> bobMessages = bob.getReceivedMessages();
        assertThat(bobMessages).hasSize(1);
        assertThat(bobMessages.get(0)).contains("alice: Hello Bob!");
        
        // Bobå›å¤æ¶ˆæ¯
        chatMediator.sendMessage(bob, "room1", "Hi Alice!");
        
        // éªŒè¯Aliceæ”¶åˆ°å›å¤
        List<String> aliceMessages = alice.getReceivedMessages();
        assertThat(aliceMessages).hasSize(1);
        assertThat(aliceMessages.get(0)).contains("bob: Hi Alice!");
    }
    
    @Test
    void shouldHandleUserLeaving() {
        // æµ‹è¯•ç”¨æˆ·ç¦»å¼€çš„å®Œæ•´æµç¨‹
        User user = new User("testUser");
        chatMediator.userJoin(user, "room1");
        
        // éªŒè¯ç”¨æˆ·åœ¨æˆ¿é—´ä¸­
        assertThat(chatMediator.getRoomUsers("room1")).contains(user);
        
        // ç”¨æˆ·ç¦»å¼€
        chatMediator.userLeave(user, "room1");
        
        // éªŒè¯ç”¨æˆ·å·²ä¸åœ¨æˆ¿é—´ä¸­
        assertThat(chatMediator.getRoomUsers("room1")).doesNotContain(user);
    }
}
```

---

## 7. ğŸ¯ è®¾è®¡è¦ç‚¹ç»¼åˆåº”ç”¨


### 7.1 å®é™…é¡¹ç›®æ¡ˆä¾‹åˆ†æ


**æ¡ˆä¾‹ï¼šä¼ä¸šå·¥ä½œæµç®¡ç†ç³»ç»Ÿ**

è¿™ä¸ªç³»ç»Ÿéœ€è¦åè°ƒå¤šä¸ªéƒ¨é—¨çš„å®¡æ‰¹æµç¨‹ï¼Œæ˜¯åº”ç”¨ä¸­ä»‹è€…æ¨¡å¼çš„å…¸å‹åœºæ™¯ã€‚

```
ç³»ç»Ÿå‚ä¸è€…ï¼š
ğŸ‘¤ ç”³è¯·äºº (Applicant)
ğŸ‘¨â€ğŸ’¼ éƒ¨é—¨ç»ç† (DepartmentManager)  
ğŸ‘©â€ğŸ’¼ äººäº‹ä¸»ç®¡ (HRManager)
ğŸ‘¨â€ğŸ’» ITç®¡ç†å‘˜ (ITAdmin)
ğŸ“Š è´¢åŠ¡ç³»ç»Ÿ (FinanceSystem)
ğŸ“§ é€šçŸ¥ç³»ç»Ÿ (NotificationSystem)
```

**å¤æ‚åº¦æ§åˆ¶åº”ç”¨**ï¼š
```java
// åˆ†å±‚ä¸­ä»‹è€…è®¾è®¡
public class WorkflowMediatorSystem {
    // ä¸»åè°ƒå™¨ï¼šç®¡ç†æ•´ä¸ªå®¡æ‰¹æµç¨‹
    private WorkflowCoordinator mainCoordinator;
    
    // å­åè°ƒå™¨ï¼šç®¡ç†ç‰¹å®šé¢†åŸŸ
    private ApprovalMediator approvalMediator;      // å®¡æ‰¹ç¯èŠ‚åè°ƒ
    private NotificationMediator notificationMediator; // é€šçŸ¥ç¯èŠ‚åè°ƒ
    private DocumentMediator documentMediator;      // æ–‡æ¡£ç®¡ç†åè°ƒ
    
    public void startWorkflow(WorkflowRequest request) {
        // ä¸»åè°ƒå™¨å†³å®šæµç¨‹è·¯å¾„
        WorkflowPath path = mainCoordinator.planWorkflow(request);
        
        // å§”æ‰˜ç»™å­åè°ƒå™¨æ‰§è¡Œ
        for (WorkflowStep step : path.getSteps()) {
            switch (step.getType()) {
                case APPROVAL:
                    approvalMediator.processApproval(step);
                    break;
                case NOTIFICATION:
                    notificationMediator.sendNotification(step);
                    break;
                case DOCUMENT:
                    documentMediator.processDocument(step);
                    break;
            }
        }
    }
}
```

### 7.2 è§£è€¦ç¨‹åº¦å®è·µ


**æ™ºèƒ½è§£è€¦ç­–ç•¥**ï¼š
```java
public class SmartApprovalMediator {
    
    public void processApprovalRequest(ApprovalRequest request) {
        // ç®€å•æŸ¥è¯¢ï¼šç›´æ¥è°ƒç”¨ï¼Œä¸ç»è¿‡ä¸­ä»‹è€…
        User applicant = userService.getUser(request.getApplicantId());
        
        // å¤æ‚ä¸šåŠ¡æµç¨‹ï¼šä½¿ç”¨ä¸­ä»‹è€…åè°ƒ
        if (request.getAmount() > 10000) {
            // å¤§é¢ç”³è¯·éœ€è¦å¤šçº§å®¡æ‰¹
            coordinateMultiLevelApproval(request, applicant);
        } else {
            // å°é¢ç”³è¯·ç®€åŒ–æµç¨‹
            coordinateSimpleApproval(request, applicant);
        }
    }
    
    private void coordinateMultiLevelApproval(ApprovalRequest request, User applicant) {
        // é€šçŸ¥æ‰€æœ‰ç›¸å…³æ–¹ï¼Œä½†å„è‡ªç‹¬ç«‹å†³ç­–
        notify("DepartmentManager", "approvalRequired", request);
        notify("HRManager", "reviewRequired", request);
        notify("FinanceSystem", "budgetCheck", request);
        
        // ç­‰å¾…æ‰€æœ‰å®¡æ‰¹å®Œæˆåç»Ÿä¸€å¤„ç†ç»“æœ
        aggregateApprovalResults(request);
    }
}
```

### 7.3 æ€§èƒ½ä¼˜åŒ–å®è·µ


**ç»¼åˆæ€§èƒ½ç­–ç•¥**ï¼š
```java
public class HighPerformanceMediator {
    // æ‰¹é‡å¤„ç†ä¼˜åŒ–
    private BatchProcessor batchProcessor = new BatchProcessor();
    
    // ç¼“å­˜ä¼˜åŒ–
    private Cache<String, Object> resultCache = CacheBuilder.newBuilder()
        .maximumSize(1000)
        .expireAfterWrite(30, TimeUnit.MINUTES)
        .build();
    
    // å¼‚æ­¥å¤„ç†ä¼˜åŒ–
    private AsyncProcessor asyncProcessor = new AsyncProcessor();
    
    public Object notify(String sender, String action, Object data) {
        String cacheKey = generateCacheKey(sender, action, data);
        
        // å°è¯•ä»ç¼“å­˜è·å–ç»“æœ
        Object cachedResult = resultCache.getIfPresent(cacheKey);
        if (cachedResult != null) {
            return cachedResult;
        }
        
        // åˆ¤æ–­æ˜¯å¦å¯ä»¥å¼‚æ­¥å¤„ç†
        if (isAsyncOperation(action)) {
            asyncProcessor.processAsync(sender, action, data);
            return AsyncResult.inProgress();
        }
        
        // åˆ¤æ–­æ˜¯å¦å¯ä»¥æ‰¹é‡å¤„ç†
        if (isBatchable(action)) {
            batchProcessor.addToBatch(sender, action, data);
            return BatchResult.queued();
        }
        
        // åŒæ­¥å¤„ç†å¹¶ç¼“å­˜ç»“æœ
        Object result = processSync(sender, action, data);
        resultCache.put(cacheKey, result);
        return result;
    }
}
```

### 7.4 å®¹é”™è®¾è®¡å®è·µ


**å¤šå±‚å®¹é”™æœºåˆ¶**ï¼š
```java
public class ResilientMediator {
    private CircuitBreaker circuitBreaker = new CircuitBreaker();
    private RetryPolicy retryPolicy = new RetryPolicy();
    private FallbackHandler fallbackHandler = new FallbackHandler();
    
    public Object notify(String sender, String action, Object data) {
        return circuitBreaker.execute(() -> {
            return retryPolicy.execute(() -> {
                try {
                    return processNotification(sender, action, data);
                } catch (Exception e) {
                    // è®°å½•é”™è¯¯
                    logger.error("é€šçŸ¥å¤„ç†å¤±è´¥", e);
                    
                    // å°è¯•é™çº§å¤„ç†
                    return fallbackHandler.handle(sender, action, data, e);
                }
            });
        });
    }
}

class FallbackHandler {
    public Object handle(String sender, String action, Object data, Exception error) {
        // æ ¹æ®é”™è¯¯ç±»å‹å’Œæ“ä½œé‡è¦æ€§å†³å®šé™çº§ç­–ç•¥
        if (isCriticalOperation(action)) {
            // å…³é”®æ“ä½œï¼šå°è¯•ç›´æ¥è°ƒç”¨
            return directCall(sender, action, data);
        } else if (isReadOperation(action)) {
            // è¯»æ“ä½œï¼šè¿”å›ç¼“å­˜æ•°æ®æˆ–é»˜è®¤å€¼
            return getCachedOrDefault(action, data);
        } else {
            // å…¶ä»–æ“ä½œï¼šè®°å½•åˆ°é˜Ÿåˆ—ç¨åå¤„ç†
            scheduleForLaterProcessing(sender, action, data);
            return null;
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è®¾è®¡è¦ç‚¹æ ¸å¿ƒåŸåˆ™


```
ğŸ¯ ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡çš„äº”å¤§æ ¸å¿ƒè¦ç‚¹ï¼š

1. å¤æ‚åº¦æ§åˆ¶ï¼š
   â€¢ åˆ†å±‚åˆ†çº§ç®¡ç†ä¸­ä»‹è€…èŒè´£
   â€¢ æŒ‰åŠŸèƒ½åŸŸæ‹†åˆ†ä¸­ä»‹è€…æ¨¡å—  
   â€¢ ç”¨é…ç½®é©±åŠ¨è€Œéç¡¬ç¼–ç 
   â€¢ é¿å…ä¸­ä»‹è€…æˆä¸º"ä¸Šå¸ç±»"

2. è§£è€¦ç¨‹åº¦æŠŠæ¡ï¼š
   â€¢ å¤æ‚å¤šæ–¹äº¤äº’ä½¿ç”¨ä¸­ä»‹è€…
   â€¢ ç®€å•åŒæ–¹è°ƒç”¨ä¿æŒç›´æ¥é€šä¿¡
   â€¢ åŸºäºäº‹ä»¶çš„æ¾æ•£è€¦åˆ
   â€¢ æ¥å£æŠ½è±¡éšè—å®ç°ç»†èŠ‚

3. é€šä¿¡æ•ˆç‡ä¼˜åŒ–ï¼š
   â€¢ æ‰¹é‡å¤„ç†å‡å°‘é€šä¿¡æ¬¡æ•°
   â€¢ æ™ºèƒ½ç¼“å­˜æå‡å“åº”é€Ÿåº¦
   â€¢ å¼‚æ­¥å¤„ç†åº”å¯¹é«˜å¹¶å‘
   â€¢ é¿å…ä¸å¿…è¦çš„ä¸­ä»‹è½¬å‘

4. å•ç‚¹æ•…éšœé¿å…ï¼š
   â€¢ ä¸­ä»‹è€…é›†ç¾¤åŒ–éƒ¨ç½²
   â€¢ æ–­è·¯å™¨æ¨¡å¼å¿«é€Ÿæ•…éšœéš”ç¦»
   â€¢ ä¼˜é›…é™çº§ä¿è¯æ ¸å¿ƒåŠŸèƒ½
   â€¢ å¤šå±‚å®¹é”™æœºåˆ¶

5. å¯æµ‹è¯•æ€§è®¾è®¡ï¼š
   â€¢ ä¾èµ–æ³¨å…¥ä¾¿äºæ¨¡æ‹Ÿæµ‹è¯•
   â€¢ æ¸…æ™°çš„æ¥å£å¥‘çº¦
   â€¢ çŠ¶æ€å’Œè¡Œä¸ºéªŒè¯ç»“åˆ
   â€¢ é›†æˆæµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯æµç¨‹
```

### 8.2 å…³é”®è®¾è®¡å†³ç­–


**ğŸ¤” è®¾è®¡æ—¶éœ€è¦è€ƒè™‘çš„å…³é”®é—®é¢˜**ï¼š

```
æ¶æ„å±‚é¢ï¼š
Q: éœ€è¦å‡ å±‚ä¸­ä»‹è€…ï¼Ÿ
A: æ ¹æ®ç³»ç»Ÿå¤æ‚åº¦ï¼Œç®€å•ç³»ç»Ÿå•å±‚ï¼Œå¤æ‚ç³»ç»Ÿåˆ†å±‚

Q: ä¸­ä»‹è€…çš„èŒè´£è¾¹ç•Œåœ¨å“ªï¼Ÿ
A: åªè´Ÿè´£åè°ƒè½¬å‘ï¼Œä¸šåŠ¡é€»è¾‘ç•™åœ¨åŒäº‹ç±»

Q: å¦‚ä½•å¹³è¡¡è§£è€¦å’Œæ€§èƒ½ï¼Ÿ
A: å…³é”®è·¯å¾„ç›´æ¥è°ƒç”¨ï¼Œå¤æ‚äº¤äº’ä½¿ç”¨ä¸­ä»‹è€…

å®ç°å±‚é¢ï¼š
Q: åŒæ­¥è¿˜æ˜¯å¼‚æ­¥é€šä¿¡ï¼Ÿ
A: ç”¨æˆ·äº¤äº’åŒæ­¥ï¼Œåå°ä»»åŠ¡å¼‚æ­¥

Q: å¦‚ä½•å¤„ç†é€šä¿¡å¤±è´¥ï¼Ÿ
A: é‡è¯•+é™çº§+å…œåº•æ–¹æ¡ˆ

Q: å¦‚ä½•ä¿è¯ç³»ç»Ÿå¯é æ€§ï¼Ÿ
A: é›†ç¾¤+ç›‘æ§+è‡ªåŠ¨æ¢å¤
```

### 8.3 å¸¸è§è®¾è®¡é™·é˜±ä¸é¿å…æ–¹æ³•


**âš ï¸ æ–°æ‰‹å¸¸çŠ¯çš„é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ**ï¼š

```
é™·é˜±1ï¼šä¸­ä»‹è€…åŒ…åŠä¸€åˆ‡
é”™è¯¯ï¼šæŠŠæ‰€æœ‰é€»è¾‘éƒ½æ”¾åœ¨ä¸­ä»‹è€…é‡Œ
è§£å†³ï¼šä¸­ä»‹è€…åªç®¡åè°ƒï¼Œä¸šåŠ¡é€»è¾‘å½’å±åŸå¯¹è±¡

é™·é˜±2ï¼šè¿‡åº¦æŠ½è±¡
é”™è¯¯ï¼šä¸ºäº†è§£è€¦è€Œè§£è€¦ï¼Œç®€å•äº‹æƒ…å¤æ‚åŒ–
è§£å†³ï¼šæ ¹æ®å®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„è§£è€¦ç¨‹åº¦

é™·é˜±3ï¼šå¿½è§†æ€§èƒ½
é”™è¯¯ï¼šæ‰€æœ‰é€šä¿¡éƒ½èµ°ä¸­ä»‹è€…ï¼Œä¸è€ƒè™‘æ•ˆç‡
è§£å†³ï¼šåŒºåˆ†åœºæ™¯ï¼Œå…³é”®è·¯å¾„ä¼˜åŒ–å¤„ç†

é™·é˜±4ï¼šç¼ºä¹å®¹é”™
é”™è¯¯ï¼šæ²¡è€ƒè™‘ä¸­ä»‹è€…æ•…éšœæƒ…å†µ
è§£å†³ï¼šè®¾è®¡å¤šå±‚å®¹é”™å’Œé™çº§æœºåˆ¶

é™·é˜±5ï¼šéš¾ä»¥æµ‹è¯•
é”™è¯¯ï¼šä¸­ä»‹è€…ä¸å¤–éƒ¨ç³»ç»Ÿç´§è€¦åˆ
è§£å†³ï¼šä¾èµ–æ³¨å…¥+æ¥å£æŠ½è±¡+æ¨¡æ‹Ÿæµ‹è¯•
```

### 8.4 æœ€ä½³å®è·µæ€»ç»“


**âœ… ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡æœ€ä½³å®è·µ**ï¼š

```
è®¾è®¡é˜¶æ®µï¼š
â€¢ æ˜ç¡®èŒè´£è¾¹ç•Œï¼Œé¿å…ä¸­ä»‹è€…è¿‡äºå¤æ‚
â€¢ é¢„ç•™æ‰©å±•ç‚¹ï¼Œè€ƒè™‘æœªæ¥ç³»ç»Ÿæ¼”åŒ–
â€¢ è®¾è®¡æ¸…æ™°çš„æ¥å£å’Œäº‹ä»¶å®šä¹‰
â€¢ è§„åˆ’å¥½é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

å®ç°é˜¶æ®µï¼š
â€¢ ä½¿ç”¨ä¾èµ–æ³¨å…¥æé«˜å¯æµ‹è¯•æ€§
â€¢ å®ç°æ™ºèƒ½è·¯ç”±å’Œç¼“å­˜æœºåˆ¶
â€¢ æ·»åŠ ç›‘æ§å’Œæ—¥å¿—ä¾¿äºè¿ç»´
â€¢ ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

è¿ç»´é˜¶æ®µï¼š
â€¢ ç›‘æ§ä¸­ä»‹è€…æ€§èƒ½å’Œå¯ç”¨æ€§
â€¢ å®šæœŸè¯„ä¼°å’Œä¼˜åŒ–é€šä¿¡è·¯å¾„
â€¢ å»ºç«‹æ•…éšœåº”æ€¥å¤„ç†æµç¨‹
â€¢ æŒç»­ä¼˜åŒ–ç³»ç»Ÿæ¶æ„

å›¢é˜Ÿåä½œï¼š
â€¢ åˆ¶å®šä¸­ä»‹è€…ä½¿ç”¨è§„èŒƒ
â€¢ å»ºç«‹ä»£ç å®¡æŸ¥æœºåˆ¶
â€¢ å®šæœŸæŠ€æœ¯åˆ†äº«å’ŒåŸ¹è®­
â€¢ æ–‡æ¡£åŒ–è®¾è®¡å†³ç­–å’Œå˜æ›´
```

### 8.5 å­¦ä¹ å»ºè®®


**ğŸ“š æŒæ¡ä¸­ä»‹è€…æ¨¡å¼è®¾è®¡è¦ç‚¹çš„å­¦ä¹ è·¯å¾„**ï¼š

```
åŸºç¡€é˜¶æ®µï¼š
â€¢ ç†è§£ä¸­ä»‹è€…æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³
â€¢ æŒæ¡åŸºæœ¬çš„å®ç°æ–¹å¼
â€¢ äº†è§£å¸¸è§çš„åº”ç”¨åœºæ™¯

è¿›é˜¶é˜¶æ®µï¼š
â€¢ å­¦ä¹ å¤æ‚åº¦æ§åˆ¶æŠ€å·§
â€¢ æŒæ¡æ€§èƒ½ä¼˜åŒ–æ–¹æ³•
â€¢ äº†è§£å®¹é”™è®¾è®¡åŸç†

é«˜çº§é˜¶æ®µï¼š
â€¢ ç ”ç©¶å¤§å‹ç³»ç»Ÿä¸­çš„åº”ç”¨
â€¢ å­¦ä¹ åˆ†å¸ƒå¼ä¸­ä»‹è€…è®¾è®¡
â€¢ å…³æ³¨æ–°æŠ€æœ¯å’Œå‘å±•è¶‹åŠ¿

å®è·µå»ºè®®ï¼š
â€¢ ä»ç®€å•åœºæ™¯å¼€å§‹ç»ƒä¹ 
â€¢ é€æ­¥å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
â€¢ å¤šå‚è€ƒå¼€æºé¡¹ç›®å®ç°
â€¢ æ€»ç»“é¡¹ç›®ç»éªŒæ•™è®­
```

**ğŸ§  æ ¸å¿ƒè®°å¿†ç‚¹**ï¼š
- ä¸­ä»‹è€…è¦"ç®¡è€Œä¸æ§"ï¼šåè°ƒäº¤äº’ä½†ä¸æ‰¿æ‹…ä¸šåŠ¡é€»è¾‘
- è§£è€¦è¦é€‚åº¦ï¼šä¸æ˜¯æ‰€æœ‰é€šä¿¡éƒ½éœ€è¦ç»è¿‡ä¸­ä»‹è€…
- æ€§èƒ½å¾ˆé‡è¦ï¼šæ‰¹é‡ã€ç¼“å­˜ã€å¼‚æ­¥æ˜¯ä¼˜åŒ–çš„ä¸‰æ¿æ–§
- å®¹é”™æ˜¯å¿…é¡»ï¼šä¸­ä»‹è€…æ˜¯å…³é”®èŠ‚ç‚¹ï¼Œå¿…é¡»é«˜å¯ç”¨
- å¯æµ‹è¯•æ€§ï¼šå¥½çš„è®¾è®¡ä»ä¸€å¼€å§‹å°±è€ƒè™‘å¦‚ä½•æµ‹è¯•

è®°ä½ï¼š**è®¾è®¡æ¨¡å¼ä¸æ˜¯ä¸ºäº†ç‚«æŠ€ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³å®é™…é—®é¢˜**ã€‚ä¸­ä»‹è€…æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼åœ¨äºç®€åŒ–å¤æ‚çš„å¯¹è±¡é—´äº¤äº’ï¼Œä½†å¦‚æœè®¾è®¡ä¸å½“ï¼Œä¸­ä»‹è€…æœ¬èº«å°±ä¼šæˆä¸ºé—®é¢˜çš„æºå¤´ã€‚æŒæ¡è¿™äº›è®¾è®¡è¦ç‚¹ï¼Œæ‰èƒ½çœŸæ­£å‘æŒ¥ä¸­ä»‹è€…æ¨¡å¼çš„å¨åŠ›ï¼