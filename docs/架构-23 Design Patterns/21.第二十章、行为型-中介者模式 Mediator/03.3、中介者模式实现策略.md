---
title: 3ã€ä¸­ä»‹è€…æ¨¡å¼å®ç°ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [ä¸­ä»‹è€…èŒè´£è®¾è®¡](#1-ä¸­ä»‹è€…èŒè´£è®¾è®¡)
2. [é€šä¿¡åè®®å®šä¹‰](#2-é€šä¿¡åè®®å®šä¹‰)
3. [äº‹ä»¶åˆ†å‘æœºåˆ¶](#3-äº‹ä»¶åˆ†å‘æœºåˆ¶)
4. [çŠ¶æ€åŒæ­¥ç­–ç•¥](#4-çŠ¶æ€åŒæ­¥ç­–ç•¥)
5. [æ‰©å±•æ€§ä¿è¯](#5-æ‰©å±•æ€§ä¿è¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä¸­ä»‹è€…èŒè´£è®¾è®¡


### 1.1 ä»€ä¹ˆæ˜¯ä¸­ä»‹è€…çš„èŒè´£

ğŸ¢ **ç®€å•ç†è§£**ï¼šä¸­ä»‹è€…å°±åƒæˆ¿å±‹ä¸­ä»‹ï¼Œè´Ÿè´£ä¹°å–åŒæ–¹çš„æ²Ÿé€šåè°ƒ

```
ç°å®ç”Ÿæ´»ä¸­çš„ä¸­ä»‹è€…ï¼š
æˆ¿å±‹ä¸­ä»‹ â†’ åè°ƒä¹°æ–¹å’Œå–æ–¹ï¼Œå¤„ç†äº¤æ˜“æµç¨‹
å©šä»‹æ‰€   â†’ å¸®åŠ©ç”·å¥³åŒæ–¹è®¤è¯†ï¼Œå®‰æ’ç›¸äº²
æ—…è¡Œç¤¾   â†’ åè°ƒé…’åº—ã€äº¤é€šã€æ™¯ç‚¹ï¼Œå®‰æ’è¡Œç¨‹

è½¯ä»¶ä¸­çš„ä¸­ä»‹è€…ï¼š
èŠå¤©å®¤ç®¡ç†å™¨ â†’ åè°ƒå¤šä¸ªç”¨æˆ·ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’
å¯¹è¯æ¡†æ§åˆ¶å™¨ â†’ ç®¡ç†æŒ‰é’®ã€è¾“å…¥æ¡†ç­‰æ§ä»¶çš„äº¤äº’
å·¥ä½œæµå¼•æ“   â†’ åè°ƒå„ä¸ªæ­¥éª¤ä¹‹é—´çš„æ‰§è¡Œé¡ºåº
```

**ğŸ”¸ ä¸­ä»‹è€…çš„æ ¸å¿ƒèŒè´£**
- **æ¶ˆæ¯è½¬å‘**ï¼šæ¥æ”¶ä¸€ä¸ªå¯¹è±¡çš„æ¶ˆæ¯ï¼Œè½¬å‘ç»™ç›¸å…³å¯¹è±¡
- **é€»è¾‘åè°ƒ**ï¼šå¤„ç†å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„å¤æ‚äº¤äº’é€»è¾‘
- **çŠ¶æ€ç®¡ç†**ï¼šç»´æŠ¤æ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€ä¿¡æ¯
- **è§„åˆ™æ‰§è¡Œ**ï¼šæŒ‰ç…§ä¸šåŠ¡è§„åˆ™æ§åˆ¶å¯¹è±¡é—´çš„äº¤äº’

### 1.2 èŒè´£è¾¹ç•Œåˆ’åˆ†åŸåˆ™

**âš–ï¸ æ˜ç¡®ä¸­ä»‹è€…åº”è¯¥ç®¡ä»€ä¹ˆï¼Œä¸åº”è¯¥ç®¡ä»€ä¹ˆ**

| ä¸­ä»‹è€…åº”è¯¥è´Ÿè´£ | **å…·ä½“å†…å®¹** | ä¸­ä»‹è€…ä¸åº”è¯¥è´Ÿè´£ | **å…·ä½“å†…å®¹** |
|---------------|-------------|----------------|-------------|
| ğŸ”¸ **æ¶ˆæ¯è·¯ç”±** | `å†³å®šæ¶ˆæ¯å‘ç»™è°` | ğŸ”¸ **ä¸šåŠ¡é€»è¾‘** | `å…·ä½“çš„ä¸šåŠ¡è®¡ç®—` |
| ğŸ”¸ **äº¤äº’åè°ƒ** | `æ§åˆ¶äº¤äº’æ—¶æœº` | ğŸ”¸ **æ•°æ®å­˜å‚¨** | `æŒä¹…åŒ–å…·ä½“æ•°æ®` |
| ğŸ”¸ **çŠ¶æ€åŒæ­¥** | `ä¿æŒçŠ¶æ€ä¸€è‡´` | ğŸ”¸ **ç•Œé¢æ¸²æŸ“** | `å…·ä½“çš„æ˜¾ç¤ºé€»è¾‘` |
| ğŸ”¸ **è§„åˆ™æ‰§è¡Œ** | `æŒ‰è§„åˆ™æ§åˆ¶æµç¨‹` | ğŸ”¸ **æ•°æ®éªŒè¯** | `å­—æ®µæ ¼å¼æ£€æŸ¥` |

**ğŸ’¡ èŒè´£è®¾è®¡çš„å®é™…æ¡ˆä¾‹**
```
èŠå¤©å®¤ç¤ºä¾‹ï¼š

ä¸­ä»‹è€…ï¼ˆèŠå¤©å®¤ç®¡ç†å™¨ï¼‰è´Ÿè´£ï¼š
âœ… ç”¨æˆ·æ¶ˆæ¯çš„è½¬å‘å’Œå¹¿æ’­
âœ… ç”¨æˆ·è¿›å…¥/ç¦»å¼€çš„é€šçŸ¥
âœ… ç¦è¨€ã€è¸¢äººç­‰ç®¡ç†åŠŸèƒ½
âœ… æ¶ˆæ¯è¿‡æ»¤å’Œå®‰å…¨æ£€æŸ¥

ä¸­ä»‹è€…ä¸è´Ÿè´£ï¼š
âŒ æ¶ˆæ¯çš„å…·ä½“å†…å®¹ç”Ÿæˆ
âŒ ç”¨æˆ·ç•Œé¢çš„æ˜¾ç¤ºæ ·å¼
âŒ æ¶ˆæ¯çš„æ•°æ®åº“å­˜å‚¨
âŒ ç”¨æˆ·å¯†ç çš„éªŒè¯é€»è¾‘
```

### 1.3 ä¸­ä»‹è€…èŒè´£çš„å±‚æ¬¡åˆ’åˆ†

**ğŸ“Š æŒ‰å¤æ‚åº¦åˆ’åˆ†ä¸­ä»‹è€…èŒè´£**

ğŸŸ¢ **ç®€å•ä¸­ä»‹è€…**ï¼šåªåšæ¶ˆæ¯è½¬å‘
```
ç‰¹ç‚¹ï¼šç±»ä¼¼é‚®é€’å‘˜ï¼Œåªè´Ÿè´£æŠŠæ¶ˆæ¯é€åˆ°
é€‚ç”¨ï¼šç®€å•çš„é€šçŸ¥æœºåˆ¶
ä¾‹å­ï¼šäº‹ä»¶æ€»çº¿ã€æ¶ˆæ¯é˜Ÿåˆ—
```

ğŸŸ¡ **æ ‡å‡†ä¸­ä»‹è€…**ï¼šæ¶ˆæ¯è½¬å‘ + ç®€å•é€»è¾‘
```
ç‰¹ç‚¹ï¼šæœ‰ä¸€å®šçš„åˆ¤æ–­å’Œå¤„ç†èƒ½åŠ›
é€‚ç”¨ï¼šå¸¸è§çš„ä¸šåŠ¡åœºæ™¯
ä¾‹å­ï¼šå¯¹è¯æ¡†æ§åˆ¶å™¨ã€å·¥ä½œæµå¼•æ“
```

ğŸ”´ **å¤æ‚ä¸­ä»‹è€…**ï¼šå…¨é¢çš„åè°ƒå’Œç®¡ç†
```
ç‰¹ç‚¹ï¼šåŒ…å«å¤æ‚çš„ä¸šåŠ¡è§„åˆ™å’ŒçŠ¶æ€ç®¡ç†
é€‚ç”¨ï¼šæ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ
ä¾‹å­ï¼šäº¤æ˜“ç³»ç»Ÿã€æ¸¸æˆæœåŠ¡å™¨
```

---

## 2. ğŸ“¡ é€šä¿¡åè®®å®šä¹‰


### 2.1 æ¶ˆæ¯æ ¼å¼è®¾è®¡

**ğŸ“ æ ‡å‡†åŒ–çš„æ¶ˆæ¯ç»“æ„**

```
ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼çš„é‡è¦æ€§ï¼š
å°±åƒå¯„ä¿¡éœ€è¦æ ‡å‡†ä¿¡å°æ ¼å¼ä¸€æ ·
æ¶ˆæ¯ä¹Ÿéœ€è¦ç»Ÿä¸€çš„"åŒ…è£…"æ ¼å¼

åŸºæœ¬æ¶ˆæ¯ç»“æ„ï¼š
è°å‘çš„ï¼ˆå‘é€è€…ï¼‰+ å‘ç»™è°ï¼ˆæ¥æ”¶è€…ï¼‰+ ä»€ä¹ˆå†…å®¹ï¼ˆæ¶ˆæ¯ä½“ï¼‰+ ä»€ä¹ˆæ—¶å€™ï¼ˆæ—¶é—´æˆ³ï¼‰
```

**ğŸ”§ æ¶ˆæ¯åè®®è®¾è®¡å®ä¾‹**
```java
// åŸºç¡€æ¶ˆæ¯æ¥å£
public interface Message {
    String getSender();      // å‘é€è€…æ ‡è¯†
    String getReceiver();    // æ¥æ”¶è€…æ ‡è¯†ï¼ˆå¯é€‰ï¼‰
    String getType();        // æ¶ˆæ¯ç±»å‹
    Object getContent();     // æ¶ˆæ¯å†…å®¹
    long getTimestamp();     // å‘é€æ—¶é—´
}

// å…·ä½“æ¶ˆæ¯å®ç°
public class ChatMessage implements Message {
    private String sender;
    private String receiver;  // nullè¡¨ç¤ºç¾¤å‘
    private String content;
    private long timestamp;
    
    // æ„é€ å‡½æ•°å’Œgetter/setteræ–¹æ³•
}

// ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯
public class SystemNotification implements Message {
    private String type = "SYSTEM";
    private String notificationType;  // USER_JOIN, USER_LEAVEç­‰
    private Object data;
    
    // å®ç°Messageæ¥å£æ–¹æ³•
}
```

### 2.2 æ¶ˆæ¯ç±»å‹åˆ†ç±»

**ğŸ“‹ ä¸åŒç±»å‹æ¶ˆæ¯çš„å¤„ç†ç­–ç•¥**

**ğŸ”¸ æŒ‰ç´§æ€¥ç¨‹åº¦åˆ†ç±»**
- **ç«‹å³å¤„ç†**ï¼šç³»ç»Ÿé”™è¯¯ã€å®‰å…¨è­¦æŠ¥
- **ä¼˜å…ˆå¤„ç†**ï¼šç”¨æˆ·æ“ä½œå“åº”ã€é‡è¦é€šçŸ¥  
- **æ™®é€šå¤„ç†**ï¼šæ—¥å¸¸æ¶ˆæ¯ã€çŠ¶æ€æ›´æ–°
- **å»¶è¿Ÿå¤„ç†**ï¼šæ—¥å¿—è®°å½•ã€ç»Ÿè®¡ä¿¡æ¯

**ğŸ”¸ æŒ‰ä¼ æ’­èŒƒå›´åˆ†ç±»**
- **ç‚¹å¯¹ç‚¹æ¶ˆæ¯**ï¼šç§èŠã€ä¸ªäººé€šçŸ¥
- **ç»„æ’­æ¶ˆæ¯**ï¼šç¾¤èŠã€éƒ¨é—¨é€šçŸ¥
- **å¹¿æ’­æ¶ˆæ¯**ï¼šç³»ç»Ÿå…¬å‘Šã€å…¨å‘˜é€šçŸ¥

**ğŸ”¸ æŒ‰å¤„ç†æ–¹å¼åˆ†ç±»**
- **åŒæ­¥æ¶ˆæ¯**ï¼šéœ€è¦ç«‹å³å›å¤çš„è¯·æ±‚
- **å¼‚æ­¥æ¶ˆæ¯**ï¼šä¸éœ€è¦ç«‹å³å›å¤çš„é€šçŸ¥
- **å•å‘æ¶ˆæ¯**ï¼šåªå‘é€ä¸éœ€è¦å›å¤

### 2.3 åè®®æ‰©å±•æœºåˆ¶

**ğŸ”„ æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•çš„è®¾è®¡**

```java
// å¯æ‰©å±•çš„æ¶ˆæ¯å¤„ç†å™¨
public interface MessageHandler {
    boolean canHandle(Message message);
    void handle(Message message, Mediator mediator);
}

// æ³¨å†Œä¸åŒç±»å‹çš„å¤„ç†å™¨
public class ExtensibleMediator {
    private List<MessageHandler> handlers = new ArrayList<>();
    
    public void registerHandler(MessageHandler handler) {
        handlers.add(handler);
    }
    
    public void processMessage(Message message) {
        for (MessageHandler handler : handlers) {
            if (handler.canHandle(message)) {
                handler.handle(message, this);
                break;  // æˆ–è€…continueï¼Œå–å†³äºæ˜¯å¦å…è®¸å¤šä¸ªå¤„ç†å™¨
            }
        }
    }
}

// å…·ä½“çš„å¤„ç†å™¨å®ç°
public class ChatMessageHandler implements MessageHandler {
    public boolean canHandle(Message message) {
        return message instanceof ChatMessage;
    }
    
    public void handle(Message message, Mediator mediator) {
        ChatMessage chatMsg = (ChatMessage) message;
        // å¤„ç†èŠå¤©æ¶ˆæ¯çš„å…·ä½“é€»è¾‘
        mediator.broadcastToRoom(chatMsg);
    }
}
```

---

## 3. âš¡ äº‹ä»¶åˆ†å‘æœºåˆ¶


### 3.1 äº‹ä»¶åˆ†å‘çš„åŸºæœ¬åŸç†

**ğŸª ç†è§£äº‹ä»¶åˆ†å‘ï¼šåƒæ¼”å‡ºçš„æŒ‡æŒ¥è°ƒåº¦**

```
æ¼”å‡ºç°åœºçš„è°ƒåº¦ï¼š
å¯¼æ¼”ï¼ˆä¸­ä»‹è€…ï¼‰â†’ åè°ƒæ¼”å‘˜ã€ç¯å…‰ã€éŸ³å“
å½“æ¼”å‘˜Aå®Œæˆè¡¨æ¼” â†’ å¯¼æ¼”é€šçŸ¥ç¯å…‰å¸ˆåˆ‡æ¢
å½“éŸ³ä¹ç»“æŸ â†’ å¯¼æ¼”é€šçŸ¥ä¸‹ä¸€ä¸ªæ¼”å‘˜ä¸Šåœº

è½¯ä»¶ä¸­çš„äº‹ä»¶åˆ†å‘ï¼š
äº‹ä»¶å‘ç”Ÿ â†’ ä¸­ä»‹è€…æ¥æ”¶äº‹ä»¶
ä¸­ä»‹è€…åˆ†æ â†’ ç¡®å®šéœ€è¦é€šçŸ¥çš„å¯¹è±¡
å‘é€é€šçŸ¥ â†’ ç›¸å…³å¯¹è±¡å“åº”å’Œå¤„ç†
```

**ğŸ”¸ äº‹ä»¶åˆ†å‘çš„æ ¸å¿ƒæµç¨‹**
```
1. äº‹ä»¶æ³¨å†Œï¼šå¯¹è±¡å‘Šè¯‰ä¸­ä»‹è€…"æˆ‘å…³å¿ƒå“ªäº›äº‹ä»¶"
2. äº‹ä»¶è§¦å‘ï¼šæŸä¸ªå¯¹è±¡å‘ç”Ÿäº†äº‹æƒ…ï¼Œé€šçŸ¥ä¸­ä»‹è€…
3. äº‹ä»¶åˆ†å‘ï¼šä¸­ä»‹è€…å†³å®šæŠŠäº‹ä»¶å‘ç»™è°
4. äº‹ä»¶å¤„ç†ï¼šæ¥æ”¶å¯¹è±¡å¤„ç†äº‹ä»¶å¹¶å¯èƒ½äº§ç”Ÿæ–°äº‹ä»¶
```

### 3.2 è®¢é˜…å‘å¸ƒæ¨¡å¼åœ¨ä¸­ä»‹è€…ä¸­çš„åº”ç”¨

**ğŸ“® å®ç°çµæ´»çš„äº‹ä»¶è®¢é˜…æœºåˆ¶**

```java
// äº‹ä»¶è®¢é˜…æ¥å£
public interface EventListener {
    void onEvent(String eventType, Object eventData);
}

// æ”¯æŒè®¢é˜…çš„ä¸­ä»‹è€…
public class EventMediator {
    // å­˜å‚¨äº‹ä»¶ç±»å‹å’Œç›‘å¬è€…çš„å¯¹åº”å…³ç³»
    private Map<String, List<EventListener>> listeners = new HashMap<>();
    
    // è®¢é˜…äº‹ä»¶
    public void subscribe(String eventType, EventListener listener) {
        listeners.computeIfAbsent(eventType, k -> new ArrayList<>()).add(listener);
    }
    
    // å–æ¶ˆè®¢é˜…
    public void unsubscribe(String eventType, EventListener listener) {
        List<EventListener> eventListeners = listeners.get(eventType);
        if (eventListeners != null) {
            eventListeners.remove(listener);
        }
    }
    
    // å‘å¸ƒäº‹ä»¶
    public void publish(String eventType, Object eventData) {
        List<EventListener> eventListeners = listeners.get(eventType);
        if (eventListeners != null) {
            for (EventListener listener : eventListeners) {
                try {
                    listener.onEvent(eventType, eventData);
                } catch (Exception e) {
                    // å¤„ç†å¼‚å¸¸ï¼Œä¸è®©ä¸€ä¸ªç›‘å¬å™¨çš„é”™è¯¯å½±å“å…¶ä»–ç›‘å¬å™¨
                    System.err.println("äº‹ä»¶å¤„ç†å¼‚å¸¸: " + e.getMessage());
                }
            }
        }
    }
}
```

### 3.3 ä¼˜å…ˆçº§å’Œè¿‡æ»¤æœºåˆ¶

**ğŸš¦ æ§åˆ¶äº‹ä»¶å¤„ç†çš„é¡ºåºå’Œæ¡ä»¶**

**ğŸ”¸ ä¼˜å…ˆçº§å¤„ç†**
```java
// å¸¦ä¼˜å…ˆçº§çš„äº‹ä»¶ç›‘å¬å™¨
public interface PriorityEventListener extends EventListener {
    int getPriority();  // æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
}

// ä¼˜å…ˆçº§ä¸­ä»‹è€…
public class PriorityMediator extends EventMediator {
    @Override
    public void publish(String eventType, Object eventData) {
        List<EventListener> eventListeners = listeners.get(eventType);
        if (eventListeners != null) {
            // æŒ‰ä¼˜å…ˆçº§æ’åº
            eventListeners.sort((a, b) -> {
                int priorityA = (a instanceof PriorityEventListener) ? 
                    ((PriorityEventListener) a).getPriority() : Integer.MAX_VALUE;
                int priorityB = (b instanceof PriorityEventListener) ? 
                    ((PriorityEventListener) b).getPriority() : Integer.MAX_VALUE;
                return Integer.compare(priorityA, priorityB);
            });
            
            // æŒ‰é¡ºåºå¤„ç†
            for (EventListener listener : eventListeners) {
                listener.onEvent(eventType, eventData);
            }
        }
    }
}
```

**ğŸ”¸ äº‹ä»¶è¿‡æ»¤æœºåˆ¶**
```java
// äº‹ä»¶è¿‡æ»¤å™¨æ¥å£
public interface EventFilter {
    boolean shouldProcess(String eventType, Object eventData);
}

// å¸¦è¿‡æ»¤çš„ä¸­ä»‹è€…
public class FilteringMediator extends EventMediator {
    private List<EventFilter> filters = new ArrayList<>();
    
    public void addFilter(EventFilter filter) {
        filters.add(filter);
    }
    
    @Override
    public void publish(String eventType, Object eventData) {
        // æ£€æŸ¥æ‰€æœ‰è¿‡æ»¤å™¨
        for (EventFilter filter : filters) {
            if (!filter.shouldProcess(eventType, eventData)) {
                return;  // è¢«è¿‡æ»¤å™¨æ‹¦æˆªï¼Œä¸å¤„ç†
            }
        }
        
        super.publish(eventType, eventData);
    }
}

// å…·ä½“çš„è¿‡æ»¤å™¨å®ç°
public class SecurityFilter implements EventFilter {
    public boolean shouldProcess(String eventType, Object eventData) {
        // å®‰å…¨æ£€æŸ¥é€»è¾‘
        if ("USER_MESSAGE".equals(eventType)) {
            String message = (String) eventData;
            return !message.contains("æ•æ„Ÿè¯");
        }
        return true;
    }
}
```

---

## 4. ğŸ”„ çŠ¶æ€åŒæ­¥ç­–ç•¥


### 4.1 çŠ¶æ€åŒæ­¥çš„å¿…è¦æ€§

**ğŸ­ ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€åŒæ­¥ï¼šä¿æŒ"æ¼”å‡º"çš„åè°ƒä¸€è‡´**

```
ç†è§£çŠ¶æ€åŒæ­¥ï¼š
éŸ³ä¹ä¼šä¸­ï¼ŒæŒ‡æŒ¥å®¶ç¡®ä¿æ‰€æœ‰ä¹æ‰‹åœ¨åŒä¸€æ‹å­ä¸Š
å¦‚æœå°æç´å¿«äº†ï¼Œå¤§æç´æ…¢äº†ï¼ŒéŸ³ä¹å°±ä¹±äº†

è½¯ä»¶ç³»ç»Ÿä¸­ï¼š
ç”¨æˆ·ç•Œé¢æ˜¾ç¤º"å·²ç™»å½•"ï¼Œä½†åå°çŠ¶æ€æ˜¯"æœªç™»å½•" â†’ çŠ¶æ€ä¸ä¸€è‡´
èŠå¤©å®¤æ˜¾ç¤º5ä¸ªäººï¼Œå®é™…åªæœ‰3ä¸ªäººåœ¨çº¿ â†’ çŠ¶æ€ä¸åŒæ­¥
è´­ç‰©è½¦æ˜¾ç¤º3ä»¶å•†å“ï¼Œç»“ç®—æ—¶å˜æˆ2ä»¶ â†’ çŠ¶æ€å†²çª
```

**ğŸ”¸ çŠ¶æ€ä¸ä¸€è‡´çš„å¸¸è§é—®é¢˜**
- **æ˜¾ç¤ºé”™è¯¯**ï¼šç•Œé¢æ˜¾ç¤ºä¸å®é™…çŠ¶æ€ä¸ç¬¦
- **æ“ä½œå¤±è´¥**ï¼šåŸºäºé”™è¯¯çŠ¶æ€çš„æ“ä½œæ— æ³•æ‰§è¡Œ  
- **æ•°æ®å†²çª**ï¼šå¤šä¸ªåœ°æ–¹çš„åŒä¸€æ•°æ®ä¸ä¸€è‡´
- **ç”¨æˆ·å›°æƒ‘**ï¼šç”¨æˆ·çœ‹åˆ°çŸ›ç›¾çš„ä¿¡æ¯

### 4.2 çŠ¶æ€åŒæ­¥çš„å®ç°ç­–ç•¥

**âš™ï¸ ä¸åŒåœºæ™¯ä¸‹çš„åŒæ­¥æ–¹æ³•**

**ğŸ”¸ ç«‹å³åŒæ­¥ç­–ç•¥**
```
ç‰¹ç‚¹ï¼šçŠ¶æ€ä¸€å˜åŒ–å°±ç«‹å³é€šçŸ¥æ‰€æœ‰ç›¸å…³å¯¹è±¡
ä¼˜ç‚¹ï¼šä¿è¯çŠ¶æ€å®æ—¶ä¸€è‡´
ç¼ºç‚¹ï¼šå¯èƒ½äº§ç”Ÿå¤§é‡é€šä¿¡å¼€é”€
é€‚ç”¨ï¼šå…³é”®çŠ¶æ€ã€å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯
```

**ğŸ”¸ æ‰¹é‡åŒæ­¥ç­–ç•¥**
```
ç‰¹ç‚¹ï¼šæ”¶é›†ä¸€æ®µæ—¶é—´å†…çš„çŠ¶æ€å˜åŒ–ï¼Œæ‰¹é‡åŒæ­¥
ä¼˜ç‚¹ï¼šå‡å°‘é€šä¿¡æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡
ç¼ºç‚¹ï¼šå¯èƒ½å­˜åœ¨çŸ­æš‚çš„çŠ¶æ€ä¸ä¸€è‡´
é€‚ç”¨ï¼šéå…³é”®çŠ¶æ€ã€å¯å®¹å¿çŸ­æš‚å»¶è¿Ÿçš„åœºæ™¯
```

**ğŸ”¸ æŒ‰éœ€åŒæ­¥ç­–ç•¥**
```
ç‰¹ç‚¹ï¼šåªæœ‰åœ¨éœ€è¦æ—¶æ‰è·å–æœ€æ–°çŠ¶æ€
ä¼˜ç‚¹ï¼šæœ€å°åŒ–åŒæ­¥å¼€é”€
ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°ä¸´æ—¶çš„çŠ¶æ€è½å
é€‚ç”¨ï¼šæŸ¥è¯¢è¾ƒå°‘ã€çŠ¶æ€å˜åŒ–é¢‘ç¹çš„åœºæ™¯
```

### 4.3 çŠ¶æ€åŒæ­¥çš„å…·ä½“å®ç°

**ğŸ› ï¸ å®ç”¨çš„çŠ¶æ€ç®¡ç†ä»£ç ç¤ºä¾‹**

```java
// çŠ¶æ€ç®¡ç†æ¥å£
public interface StateManager {
    void updateState(String key, Object value);
    Object getState(String key);
    void addStateListener(String key, StateChangeListener listener);
}

// çŠ¶æ€å˜åŒ–ç›‘å¬å™¨
public interface StateChangeListener {
    void onStateChanged(String key, Object oldValue, Object newValue);
}

// ä¸­ä»‹è€…ä¸­çš„çŠ¶æ€ç®¡ç†
public class StatefulMediator implements StateManager {
    private Map<String, Object> states = new ConcurrentHashMap<>();
    private Map<String, List<StateChangeListener>> stateListeners = new ConcurrentHashMap<>();
    
    @Override
    public void updateState(String key, Object value) {
        Object oldValue = states.get(key);
        states.put(key, value);
        
        // é€šçŸ¥çŠ¶æ€å˜åŒ–
        notifyStateChange(key, oldValue, value);
    }
    
    @Override
    public Object getState(String key) {
        return states.get(key);
    }
    
    @Override
    public void addStateListener(String key, StateChangeListener listener) {
        stateListeners.computeIfAbsent(key, k -> new ArrayList<>()).add(listener);
    }
    
    private void notifyStateChange(String key, Object oldValue, Object newValue) {
        List<StateChangeListener> listeners = stateListeners.get(key);
        if (listeners != null) {
            for (StateChangeListener listener : listeners) {
                listener.onStateChanged(key, oldValue, newValue);
            }
        }
    }
}
```

### 4.4 å†²çªè§£å†³æœºåˆ¶

**âš–ï¸ å¤„ç†çŠ¶æ€å†²çªçš„ç­–ç•¥**

**ğŸ”¸ å†²çªæ£€æµ‹**
```java
// ç‰ˆæœ¬æ§åˆ¶çš„çŠ¶æ€é¡¹
public class VersionedState {
    private Object value;
    private long version;
    private long timestamp;
    
    public boolean updateIfNewer(Object newValue, long newVersion) {
        if (newVersion > this.version) {
            this.value = newValue;
            this.version = newVersion;
            this.timestamp = System.currentTimeMillis();
            return true;
        }
        return false;  // ç‰ˆæœ¬è¾ƒæ—§ï¼Œæ‹’ç»æ›´æ–°
    }
}
```

**ğŸ”¸ å†²çªè§£å†³ç­–ç•¥**
- **æœ€åå†™å…¥è·èƒœ**ï¼šç®€å•ä½†å¯èƒ½ä¸¢å¤±æ•°æ®
- **ç‰ˆæœ¬å·æ§åˆ¶**ï¼šåŸºäºç‰ˆæœ¬å·å†³å®šæ˜¯å¦æ›´æ–°
- **æ—¶é—´æˆ³ä¼˜å…ˆ**ï¼šè¾ƒæ–°çš„æ—¶é—´æˆ³ä¼˜å…ˆ
- **æ‰‹åŠ¨è§£å†³**ï¼šæç¤ºç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©

---

## 5. ğŸš€ æ‰©å±•æ€§ä¿è¯


### 5.1 æ‰©å±•æ€§è®¾è®¡åŸåˆ™

**ğŸ”§ è®©ä¸­ä»‹è€…æ¨¡å¼é€‚åº”æœªæ¥å˜åŒ–**

```
æ‰©å±•æ€§è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š
ä»Šå¤©çš„ç³»ç»Ÿè¦èƒ½é€‚åº”æ˜å¤©çš„éœ€æ±‚

è®¾è®¡æ—¶è¦è€ƒè™‘ï¼š
æ–°å¢å¯¹è±¡ç±»å‹ â†’ ä¸­ä»‹è€…èƒ½å¦è½»æ¾æ”¯æŒï¼Ÿ
æ–°å¢äº¤äº’è§„åˆ™ â†’ æ˜¯å¦éœ€è¦å¤§é‡ä¿®æ”¹ä»£ç ï¼Ÿ
æ–°å¢æ¶ˆæ¯ç±»å‹ â†’ åè®®æ˜¯å¦è¶³å¤Ÿçµæ´»ï¼Ÿ
æ€§èƒ½è¦æ±‚æå‡ â†’ æ¶æ„æ˜¯å¦å¯ä»¥ä¼˜åŒ–ï¼Ÿ
```

**ğŸ”¸ å¼€é—­åŸåˆ™åœ¨ä¸­ä»‹è€…ä¸­çš„åº”ç”¨**
```
å¯¹æ‰©å±•å¼€æ”¾ï¼š
âœ… å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„å‚ä¸è€…ç±»å‹
âœ… å¯ä»¥å¢åŠ æ–°çš„æ¶ˆæ¯å¤„ç†é€»è¾‘
âœ… å¯ä»¥å¼•å…¥æ–°çš„äº‹ä»¶ç±»å‹

å¯¹ä¿®æ”¹å°é—­ï¼š
âœ… æ·»åŠ æ–°åŠŸèƒ½ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
âœ… ç°æœ‰çš„å‚ä¸è€…ä¸å—æ–°å¢å‚ä¸è€…å½±å“
âœ… æ ¸å¿ƒçš„ä¸­ä»‹é€»è¾‘ä¿æŒç¨³å®š
```

### 5.2 æ’ä»¶åŒ–æ¶æ„è®¾è®¡

**ğŸ”Œ è®©ä¸­ä»‹è€…æ”¯æŒæ’ä»¶å¼æ‰©å±•**

```java
// æ’ä»¶æ¥å£
public interface MediatorPlugin {
    String getName();
    String getVersion();
    void initialize(Mediator mediator);
    void shutdown();
}

// å¯æ‰©å±•çš„ä¸­ä»‹è€…
public class PluggableMediator implements Mediator {
    private List<MediatorPlugin> plugins = new ArrayList<>();
    private Map<String, MessageHandler> messageHandlers = new HashMap<>();
    
    // åŠ è½½æ’ä»¶
    public void loadPlugin(MediatorPlugin plugin) {
        plugin.initialize(this);
        plugins.add(plugin);
        System.out.println("æ’ä»¶åŠ è½½æˆåŠŸ: " + plugin.getName() + " v" + plugin.getVersion());
    }
    
    // æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨ï¼ˆä¾›æ’ä»¶ä½¿ç”¨ï¼‰
    public void registerMessageHandler(String messageType, MessageHandler handler) {
        messageHandlers.put(messageType, handler);
    }
    
    // å¤„ç†æ¶ˆæ¯æ—¶æŸ¥æ‰¾å¯¹åº”çš„å¤„ç†å™¨
    @Override
    public void processMessage(Message message) {
        MessageHandler handler = messageHandlers.get(message.getType());
        if (handler != null) {
            handler.handle(message, this);
        } else {
            System.out.println("æœªæ‰¾åˆ°å¤„ç†å™¨: " + message.getType());
        }
    }
}

// å…·ä½“çš„æ’ä»¶å®ç°
public class ChatPlugin implements MediatorPlugin {
    @Override
    public String getName() { return "èŠå¤©æ’ä»¶"; }
    
    @Override
    public String getVersion() { return "1.0.0"; }
    
    @Override
    public void initialize(Mediator mediator) {
        // æ³¨å†ŒèŠå¤©æ¶ˆæ¯å¤„ç†å™¨
        if (mediator instanceof PluggableMediator) {
            ((PluggableMediator) mediator).registerMessageHandler("CHAT", 
                new ChatMessageHandler());
        }
    }
    
    @Override
    public void shutdown() {
        // æ¸…ç†èµ„æº
    }
}
```

### 5.3 é…ç½®é©±åŠ¨çš„æ‰©å±•

**ğŸ“‹ é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ä¸­ä»‹è€…è¡Œä¸º**

```java
// é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆYAMLæ ¼å¼ï¼‰
/*
mediator:
  name: "èŠå¤©å®¤ä¸­ä»‹è€…"
  plugins:
    - name: "chat"
      class: "com.example.ChatPlugin"
      enabled: true
    - name: "moderation"
      class: "com.example.ModerationPlugin"
      enabled: true
  
  message_handlers:
    CHAT: "com.example.ChatMessageHandler"
    SYSTEM: "com.example.SystemMessageHandler"
  
  event_filters:
    - "com.example.SecurityFilter"
    - "com.example.SpamFilter"
  
  settings:
    max_message_length: 500
    enable_history: true
    history_size: 100
*/

// é…ç½®é©±åŠ¨çš„ä¸­ä»‹è€…
public class ConfigurableMediator {
    private MediatorConfig config;
    
    public void loadConfiguration(String configFile) {
        this.config = ConfigLoader.load(configFile);
        
        // æ ¹æ®é…ç½®åŠ è½½æ’ä»¶
        for (PluginConfig pluginConfig : config.getPlugins()) {
            if (pluginConfig.isEnabled()) {
                MediatorPlugin plugin = createPlugin(pluginConfig.getClassName());
                loadPlugin(plugin);
            }
        }
        
        // æ ¹æ®é…ç½®è®¾ç½®è¿‡æ»¤å™¨
        for (String filterClass : config.getEventFilters()) {
            EventFilter filter = createFilter(filterClass);
            addFilter(filter);
        }
    }
    
    // æ”¯æŒè¿è¡Œæ—¶é‡æ–°åŠ è½½é…ç½®
    public void reloadConfiguration() {
        shutdown();  // æ¸…ç†ç°æœ‰é…ç½®
        loadConfiguration(config.getConfigFile());
    }
}
```

### 5.4 æ€§èƒ½ä¼˜åŒ–å’Œæ‰©å±•

**âš¡ å¤„ç†é«˜å¹¶å‘å’Œå¤§è§„æ¨¡åœºæ™¯**

**ğŸ”¸ å¼‚æ­¥å¤„ç†ä¼˜åŒ–**
```java
// å¼‚æ­¥æ¶ˆæ¯å¤„ç†
public class AsyncMediator extends BaseMediator {
    private ExecutorService executorService = Executors.newFixedThreadPool(10);
    
    @Override
    public void processMessage(Message message) {
        // å¼‚æ­¥å¤„ç†æ¶ˆæ¯ï¼Œé¿å…é˜»å¡
        executorService.submit(() -> {
            try {
                super.processMessage(message);
            } catch (Exception e) {
                handleError(message, e);
            }
        });
    }
    
    public void shutdown() {
        executorService.shutdown();
        try {
            if (!executorService.awaitTermination(60, TimeUnit.SECONDS)) {
                executorService.shutdownNow();
            }
        } catch (InterruptedException e) {
            executorService.shutdownNow();
        }
    }
}
```

**ğŸ”¸ åˆ†å¸ƒå¼æ‰©å±•æ”¯æŒ**
```java
// åˆ†å¸ƒå¼ä¸­ä»‹è€…æ¥å£
public interface DistributedMediator extends Mediator {
    void joinCluster(String clusterAddress);
    void leaveCluster();
    void broadcastToCluster(Message message);
}

// ç®€å•çš„åˆ†å¸ƒå¼å®ç°
public class ClusterMediator implements DistributedMediator {
    private Set<String> clusterNodes = new HashSet<>();
    private MessageSender messageSender;
    
    @Override
    public void broadcastToCluster(Message message) {
        for (String node : clusterNodes) {
            messageSender.sendToNode(node, message);
        }
    }
    
    // å¤„ç†æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æ¶ˆæ¯
    public void handleRemoteMessage(Message message) {
        // æ ‡è®°ä¸ºæ¥è‡ªè¿œç¨‹ï¼Œé¿å…é‡å¤å¹¿æ’­
        message.setRemote(true);
        processMessage(message);
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¸­ä»‹è€…èŒè´£ï¼šæ¶ˆæ¯è½¬å‘ã€é€»è¾‘åè°ƒã€çŠ¶æ€ç®¡ç†ã€è§„åˆ™æ‰§è¡Œ
ğŸ”¸ é€šä¿¡åè®®ï¼šç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼ã€ç±»å‹åˆ†ç±»ã€æ‰©å±•æœºåˆ¶
ğŸ”¸ äº‹ä»¶åˆ†å‘ï¼šè®¢é˜…å‘å¸ƒæ¨¡å¼ã€ä¼˜å…ˆçº§æ§åˆ¶ã€è¿‡æ»¤æœºåˆ¶
ğŸ”¸ çŠ¶æ€åŒæ­¥ï¼šç«‹å³åŒæ­¥ã€æ‰¹é‡åŒæ­¥ã€æŒ‰éœ€åŒæ­¥ç­–ç•¥
ğŸ”¸ æ‰©å±•æ€§ä¿è¯ï¼šæ’ä»¶åŒ–æ¶æ„ã€é…ç½®é©±åŠ¨ã€æ€§èƒ½ä¼˜åŒ–
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸­ä»‹è€…æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼**
```
è§£è€¦å¤æ‚äº¤äº’ï¼š
- å¯¹è±¡ä¹‹é—´ä¸ç›´æ¥é€šä¿¡ï¼Œé€šè¿‡ä¸­ä»‹è€…åè°ƒ
- é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦å’Œå¤æ‚æ€§
- ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

é›†ä¸­ç®¡ç†é€»è¾‘ï¼š
- å¤æ‚çš„äº¤äº’é€»è¾‘é›†ä¸­åœ¨ä¸­ä»‹è€…ä¸­
- ä¾¿äºç»Ÿä¸€ç®¡ç†å’Œä¿®æ”¹ä¸šåŠ¡è§„åˆ™
- æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§

çµæ´»çš„æ‰©å±•ï¼š
- æ–°å¢å¯¹è±¡ç±»å‹æ—¶ä¸å½±å“ç°æœ‰ä»£ç 
- æ”¯æŒæ’ä»¶åŒ–å’Œé…ç½®åŒ–æ‰©å±•
- é€‚åº”ä¸æ–­å˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚
```

**ğŸ”¹ å®ç°ç­–ç•¥çš„é€‰æ‹©åŸåˆ™**
```
èŒè´£è®¾è®¡ï¼š
- æ˜ç¡®ä¸­ä»‹è€…çš„è´£ä»»è¾¹ç•Œ
- é¿å…ä¸­ä»‹è€…å˜æˆ"ä¸‡èƒ½ç±»"
- ä¿æŒå•ä¸€èŒè´£åŸåˆ™

é€šä¿¡åè®®ï¼š
- è®¾è®¡ç»Ÿä¸€ä¸”å¯æ‰©å±•çš„æ¶ˆæ¯æ ¼å¼
- è€ƒè™‘ä¸åŒç±»å‹æ¶ˆæ¯çš„å¤„ç†éœ€æ±‚
- æ”¯æŒåè®®çš„ç‰ˆæœ¬æ¼”è¿›

çŠ¶æ€ç®¡ç†ï¼š
- æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åŒæ­¥ç­–ç•¥
- å¤„ç†å¥½çŠ¶æ€å†²çªå’Œä¸€è‡´æ€§
- å¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§è¦æ±‚
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ é€‚ç”¨åœºæ™¯**
- **ç”¨æˆ·ç•Œé¢**ï¼šç®¡ç†å¤æ‚ç•Œé¢ä¸­å¤šä¸ªæ§ä»¶çš„äº¤äº’
- **èŠå¤©ç³»ç»Ÿ**ï¼šåè°ƒå¤šä¸ªç”¨æˆ·ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’  
- **å·¥ä½œæµç³»ç»Ÿ**ï¼šç®¡ç†å¤šä¸ªæ­¥éª¤ä¹‹é—´çš„æµè½¬
- **æ¸¸æˆå¼€å‘**ï¼šå¤„ç†æ¸¸æˆå¯¹è±¡ä¹‹é—´çš„å¤æ‚äº¤äº’
- **ç³»ç»Ÿé›†æˆ**ï¼šåè°ƒä¸åŒå­ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡

**ğŸ”§ å®è·µå»ºè®®**
- **æ¸è¿›å¼è®¾è®¡**ï¼šä»ç®€å•ä¸­ä»‹è€…å¼€å§‹ï¼Œé€æ­¥å¢åŠ åŠŸèƒ½
- **æ¥å£ä¼˜å…ˆ**ï¼šå…ˆå®šä¹‰æ¸…æ™°çš„æ¥å£ï¼Œå†å®ç°å…·ä½“é€»è¾‘  
- **æµ‹è¯•é©±åŠ¨**ï¼šä¸ºå¤æ‚çš„äº¤äº’é€»è¾‘ç¼–å†™å……åˆ†çš„æµ‹è¯•
- **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†è®°å½•æ¶ˆæ¯æ ¼å¼å’Œäº¤äº’è§„åˆ™
- **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨ä¸­ä»‹è€…çš„æ€§èƒ½ç“¶é¢ˆå’Œèµ„æºæ¶ˆè€—

**ğŸ“ˆ å‘å±•è¶‹åŠ¿**
- **å¾®æœåŠ¡æ¶æ„**ï¼šä¸­ä»‹è€…æ¨¡å¼åœ¨å¾®æœåŠ¡é€šä¿¡ä¸­çš„åº”ç”¨
- **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šåŸºäºäº‹ä»¶çš„ç³»ç»Ÿè®¾è®¡æ¨¡å¼
- **å“åº”å¼ç¼–ç¨‹**ï¼šç»“åˆå“åº”å¼æ¡†æ¶å®ç°é«˜æ•ˆçš„äº‹ä»¶å¤„ç†
- **äº‘åŸç”Ÿåº”ç”¨**ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ä¸­ä»‹è€…å®ç°

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¸­ä»‹åè°ƒå¤šå¯¹è±¡ï¼ŒèŒè´£æ¸…æ™°ä¸è¶Šç•Œ
- ç»Ÿä¸€åè®®ä¿é€šä¿¡ï¼Œäº‹ä»¶åˆ†å‘æœ‰ç­–ç•¥  
- çŠ¶æ€åŒæ­¥ä¿ä¸€è‡´ï¼Œæ‰©å±•è®¾è®¡å‘æœªæ¥
- æ’ä»¶é…ç½®å¢çµæ´»ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸å¯å°‘