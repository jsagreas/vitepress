---
title: 3ã€ç»„åˆæ¨¡å¼å®ç°æ–¹å¼
---
## ğŸ“š ç›®å½•

1. [å®ç°æ–¹å¼æ¦‚è¿°](#1-å®ç°æ–¹å¼æ¦‚è¿°)
2. [é€æ˜ç»„åˆæ¨¡å¼](#2-é€æ˜ç»„åˆæ¨¡å¼)
3. [å®‰å…¨ç»„åˆæ¨¡å¼](#3-å®‰å…¨ç»„åˆæ¨¡å¼)
4. [é€’å½’æ“ä½œå®ç°](#4-é€’å½’æ“ä½œå®ç°)
5. [èŠ‚ç‚¹éå†ç­–ç•¥](#5-èŠ‚ç‚¹éå†ç­–ç•¥)
6. [çŠ¶æ€ç®¡ç†æœºåˆ¶](#6-çŠ¶æ€ç®¡ç†æœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å®ç°æ–¹å¼æ¦‚è¿°


### 1.1 ç»„åˆæ¨¡å¼çš„ä¸¤ç§å®ç°æ€è·¯


ç»„åˆæ¨¡å¼å°±åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç®€å•çš„å°å—ç»„è£…æˆå¤æ‚çš„å¤§å—ã€‚åœ¨ç¼–ç¨‹ä¸–ç•Œé‡Œï¼Œç»„åˆæ¨¡å¼ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š

**ğŸ”¸ é€æ˜ç»„åˆæ¨¡å¼**
- æŠŠæ‰€æœ‰æ“ä½œéƒ½æ”¾åœ¨ç»Ÿä¸€çš„æ¥å£é‡Œ
- å°±åƒä¸‡èƒ½é¥æ§å™¨ï¼Œä¸ç®¡æ˜¯ç”µè§†è¿˜æ˜¯ç©ºè°ƒï¼ŒæŒ‰é’®éƒ½ä¸€æ ·

**ğŸ”¸ å®‰å…¨ç»„åˆæ¨¡å¼**  
- åªåœ¨éœ€è¦çš„åœ°æ–¹æä¾›å¯¹åº”çš„æ“ä½œ
- å°±åƒä¸“ç”¨é¥æ§å™¨ï¼Œç”µè§†é¥æ§å™¨å°±åªèƒ½æ§åˆ¶ç”µè§†

```
ç°å®ç±»æ¯”ï¼š

æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯å…¸å‹çš„ç»„åˆæ¨¡å¼
æ–‡ä»¶å¤¹ â† å¯ä»¥åŒ…å«æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹
æ–‡ä»¶   â† ä¸èƒ½åŒ…å«å…¶ä»–ä¸œè¥¿

é€æ˜æ–¹å¼ï¼šæ–‡ä»¶å’Œæ–‡ä»¶å¤¹éƒ½æœ‰"æ·»åŠ å­é¡¹"æ“ä½œ
å®‰å…¨æ–¹å¼ï¼šåªæœ‰æ–‡ä»¶å¤¹æ‰æœ‰"æ·»åŠ å­é¡¹"æ“ä½œ
```

### 1.2 é€‰æ‹©æ ‡å‡†


| å®ç°æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ”“ **é€æ˜ç»„åˆ** | `ç»Ÿä¸€æ¥å£ï¼Œä½¿ç”¨ç®€å•` | `å¯èƒ½è°ƒç”¨æ— æ•ˆæ“ä½œ` | `ç»“æ„ç›¸å¯¹ç®€å•ï¼Œæ³¨é‡ä¸€è‡´æ€§` |
| ğŸ”’ **å®‰å…¨ç»„åˆ** | `ç±»å‹å®‰å…¨ï¼Œä¸ä¼šè¯¯ç”¨` | `éœ€è¦åˆ¤æ–­èŠ‚ç‚¹ç±»å‹` | `å¤æ‚ç³»ç»Ÿï¼Œæ³¨é‡å®‰å…¨æ€§` |

---

## 2. ğŸ”“ é€æ˜ç»„åˆæ¨¡å¼


### 2.1 ä»€ä¹ˆæ˜¯é€æ˜ç»„åˆæ¨¡å¼


é€æ˜ç»„åˆæ¨¡å¼å°±æ˜¯**è®©æ‰€æœ‰ç»„ä»¶çœ‹èµ·æ¥éƒ½ä¸€æ ·**ã€‚ä¸ç®¡æ˜¯å¶å­èŠ‚ç‚¹ï¼ˆå•ä¸ªç»„ä»¶ï¼‰è¿˜æ˜¯å®¹å™¨èŠ‚ç‚¹ï¼ˆç»„åˆç»„ä»¶ï¼‰ï¼Œå®ƒä»¬éƒ½å®ç°ç›¸åŒçš„æ¥å£ï¼Œå¯¹å¤–æä¾›ç»Ÿä¸€çš„æ“ä½œæ–¹æ³•ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦åŒºåˆ†å¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡è¿˜æ˜¯ç»„åˆå¯¹è±¡

### 2.2 é€æ˜ç»„åˆç»“æ„å›¾


```
æŠ½è±¡ç»„ä»¶æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component                      â”‚
â”‚  + operation()                  â”‚
â”‚  + add(Component)               â”‚  â† æ‰€æœ‰ç»„ä»¶éƒ½æœ‰è¿™äº›æ–¹æ³•
â”‚  + remove(Component)            â”‚
â”‚  + getChild(int): Component     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–²
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Leaf  â”‚      â”‚Compositeâ”‚
â”‚å¶å­ç»„ä»¶â”‚      â”‚å®¹å™¨ç»„ä»¶  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ åŒ…å«å¤šä¸ª
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Component   â”‚ â† å¯ä»¥æ˜¯å¶å­æˆ–å®¹å™¨
              â”‚ Component   â”‚
              â”‚ Component   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 é€æ˜ç»„åˆä»£ç å®ç°


```java
// ç»Ÿä¸€çš„ç»„ä»¶æ¥å£ - æ‰€æœ‰ç»„ä»¶éƒ½è¦å®ç°è¿™äº›æ–¹æ³•
abstract class MenuComponent {
    protected String name;
    
    // åŸºæœ¬æ“ä½œ - æ‰€æœ‰ç»„ä»¶éƒ½éœ€è¦
    public abstract void display();
    
    // å®¹å™¨æ“ä½œ - å¶å­èŠ‚ç‚¹ä¼šæä¾›é»˜è®¤å®ç°
    public void add(MenuComponent component) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒæ·»åŠ æ“ä½œ");
    }
    
    public void remove(MenuComponent component) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒåˆ é™¤æ“ä½œ");
    }
    
    public MenuComponent getChild(int index) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒè·å–å­é¡¹");
    }
}

// å¶å­ç»„ä»¶ - èœå•é¡¹
class MenuItem extends MenuComponent {
    private double price;
    
    public MenuItem(String name, double price) {
        this.name = name;
        this.price = price;
    }
    
    @Override
    public void display() {
        System.out.println("èœå“ï¼š" + name + " - ï¿¥" + price);
    }
}

// å®¹å™¨ç»„ä»¶ - èœå•åˆ†ç±»
class Menu extends MenuComponent {
    private List<MenuComponent> components = new ArrayList<>();
    
    public Menu(String name) {
        this.name = name;
    }
    
    @Override
    public void add(MenuComponent component) {
        components.add(component);
    }
    
    @Override
    public void remove(MenuComponent component) {
        components.remove(component);
    }
    
    @Override
    public MenuComponent getChild(int index) {
        return components.get(index);
    }
    
    @Override
    public void display() {
        System.out.println("\n=== " + name + " ===");
        for (MenuComponent component : components) {
            component.display(); // é€’å½’æ˜¾ç¤º
        }
    }
}
```

### 2.4 é€æ˜ç»„åˆä½¿ç”¨ç¤ºä¾‹


```java
public class TransparentCompositeDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä¸»èœå•
        MenuComponent mainMenu = new Menu("é¤å…èœå•");
        
        // åˆ›å»ºå­èœå•
        MenuComponent hotDishes = new Menu("çƒ­èœ");
        MenuComponent coldDishes = new Menu("å‡‰èœ");
        
        // æ·»åŠ å…·ä½“èœå“
        hotDishes.add(new MenuItem("å®«ä¿é¸¡ä¸", 28.0));
        hotDishes.add(new MenuItem("éº»å©†è±†è…", 18.0));
        
        coldDishes.add(new MenuItem("æ‹é»„ç“œ", 8.0));
        coldDishes.add(new MenuItem("å‡‰æ‹Œæµ·å¸¦", 12.0));
        
        // ç»„è£…èœå•
        mainMenu.add(hotDishes);
        mainMenu.add(coldDishes);
        
        // ç»Ÿä¸€æ˜¾ç¤º - ä¸éœ€è¦å…³å¿ƒæ˜¯å®¹å™¨è¿˜æ˜¯å¶å­
        mainMenu.display();
    }
}
```

**ğŸ”¥ é€æ˜ç»„åˆçš„å…³é”®ç‰¹ç‚¹**ï¼š
- **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰ç»„ä»¶éƒ½æœ‰ç›¸åŒçš„æ–¹æ³•
- **ç®€å•ä½¿ç”¨**ï¼šå®¢æˆ·ç«¯ä»£ç ä¸éœ€è¦åŒºåˆ†ç»„ä»¶ç±»å‹
- **è¿è¡Œæ—¶æ£€æŸ¥**ï¼šé€šè¿‡å¼‚å¸¸å¤„ç†æ— æ•ˆæ“ä½œ

---

## 3. ğŸ”’ å®‰å…¨ç»„åˆæ¨¡å¼


### 3.1 ä»€ä¹ˆæ˜¯å®‰å…¨ç»„åˆæ¨¡å¼


å®‰å…¨ç»„åˆæ¨¡å¼å°±æ˜¯**åªåœ¨åˆé€‚çš„åœ°æ–¹æä¾›åˆé€‚çš„æ–¹æ³•**ã€‚å¶å­èŠ‚ç‚¹åªæœ‰å¶å­èŠ‚ç‚¹çš„æ–¹æ³•ï¼Œå®¹å™¨èŠ‚ç‚¹æ‰æœ‰ç®¡ç†å­ç»„ä»¶çš„æ–¹æ³•ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šåœ¨ç¼–è¯‘æœŸå°±èƒ½å‘ç°ç±»å‹é”™è¯¯ï¼Œé¿å…è¿è¡Œæ—¶å¼‚å¸¸

### 3.2 å®‰å…¨ç»„åˆç»“æ„å›¾


```
æŠ½è±¡ç»„ä»¶æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component                      â”‚
â”‚  + operation()                  â”‚  â† åªæœ‰å…¬å…±æ–¹æ³•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–²
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Leaf  â”‚      â”‚Compositeâ”‚
â”‚å¶å­ç»„ä»¶â”‚      â”‚å®¹å™¨ç»„ä»¶  â”‚
â”‚       â”‚      â”‚+ add()  â”‚ â† åªæœ‰å®¹å™¨æ‰æœ‰ç®¡ç†æ–¹æ³•
â”‚       â”‚      â”‚+ remove()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚+ getChild()â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ åŒ…å«å¤šä¸ª
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Component   â”‚
              â”‚ Component   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å®‰å…¨ç»„åˆä»£ç å®ç°


```java
// æŠ½è±¡ç»„ä»¶ - åªå®šä¹‰å…¬å…±æ–¹æ³•
abstract class SafeMenuComponent {
    protected String name;
    
    public SafeMenuComponent(String name) {
        this.name = name;
    }
    
    // æ‰€æœ‰ç»„ä»¶éƒ½æœ‰çš„åŸºæœ¬æ“ä½œ
    public abstract void display();
    public abstract int getSize();
}

// å¶å­ç»„ä»¶ - åªæœ‰å¶å­ç›¸å…³çš„æ–¹æ³•
class SafeMenuItem extends SafeMenuComponent {
    private double price;
    
    public SafeMenuItem(String name, double price) {
        super(name);
        this.price = price;
    }
    
    @Override
    public void display() {
        System.out.println("èœå“ï¼š" + name + " - ï¿¥" + price);
    }
    
    @Override
    public int getSize() {
        return 1; // å¶å­èŠ‚ç‚¹å¤§å°ä¸º1
    }
    
    public double getPrice() {
        return price;
    }
}

// å®¹å™¨ç»„ä»¶ - æœ‰ç®¡ç†å­ç»„ä»¶çš„æ–¹æ³•
class SafeMenu extends SafeMenuComponent {
    private List<SafeMenuComponent> components = new ArrayList<>();
    
    public SafeMenu(String name) {
        super(name);
    }
    
    // å®¹å™¨ç‰¹æœ‰çš„ç®¡ç†æ–¹æ³•
    public void add(SafeMenuComponent component) {
        components.add(component);
    }
    
    public void remove(SafeMenuComponent component) {
        components.remove(component);
    }
    
    public SafeMenuComponent getChild(int index) {
        return components.get(index);
    }
    
    @Override
    public void display() {
        System.out.println("\n=== " + name + " ===");
        for (SafeMenuComponent component : components) {
            component.display();
        }
    }
    
    @Override
    public int getSize() {
        int total = 0;
        for (SafeMenuComponent component : components) {
            total += component.getSize();
        }
        return total;
    }
}
```

### 3.4 å®‰å…¨ç»„åˆä½¿ç”¨ç¤ºä¾‹


```java
public class SafeCompositeDemo {
    public static void main(String[] args) {
        // åˆ›å»ºèœå•ï¼ˆå¿…é¡»æ˜ç¡®ç±»å‹ï¼‰
        SafeMenu mainMenu = new SafeMenu("é¤å…èœå•");
        SafeMenu hotDishes = new SafeMenu("çƒ­èœ");
        
        // åˆ›å»ºèœå“
        SafeMenuItem dish1 = new SafeMenuItem("å®«ä¿é¸¡ä¸", 28.0);
        SafeMenuItem dish2 = new SafeMenuItem("éº»å©†è±†è…", 18.0);
        
        // æ·»åŠ èœå“åˆ°åˆ†ç±»
        hotDishes.add(dish1);
        hotDishes.add(dish2);
        
        // æ·»åŠ åˆ†ç±»åˆ°ä¸»èœå•
        mainMenu.add(hotDishes);
        
        // æ˜¾ç¤ºèœå•
        mainMenu.display();
        System.out.println("æ€»èœå“æ•°ï¼š" + mainMenu.getSize());
        
        // ç¼–è¯‘æœŸå®‰å…¨ - ä¸‹é¢çš„ä»£ç æ— æ³•ç¼–è¯‘é€šè¿‡
        // dish1.add(dish2); // ç¼–è¯‘é”™è¯¯ï¼å¶å­èŠ‚ç‚¹æ²¡æœ‰addæ–¹æ³•
    }
}
```

**ğŸ”¥ å®‰å…¨ç»„åˆçš„å…³é”®ç‰¹ç‚¹**ï¼š
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æœŸå°±èƒ½å‘ç°é”™è¯¯
- **æ¥å£åˆ†ç¦»**ï¼šä¸åŒç»„ä»¶æœ‰ä¸åŒçš„æ¥å£
- **æ˜ç¡®èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªæä¾›è‡ªå·±éœ€è¦çš„æ–¹æ³•

---

## 4. ğŸ”„ é€’å½’æ“ä½œå®ç°


### 4.1 é€’å½’æ“ä½œçš„æ ¸å¿ƒæ€æƒ³


é€’å½’æ“ä½œæ˜¯ç»„åˆæ¨¡å¼çš„**çµé­‚æ‰€åœ¨**ã€‚å°±åƒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ï¼Œæ¯ä¸€å±‚éƒ½åšåŒæ ·çš„äº‹æƒ…ï¼Œç›´åˆ°æœ€é‡Œé¢çš„é‚£ä¸ªå¨ƒå¨ƒã€‚

**é€’å½’ä¸‰è¦ç´ **ï¼š
1. **é€’å½’è¾¹ç•Œ**ï¼šä»€ä¹ˆæ—¶å€™åœæ­¢ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
2. **é€’å½’è°ƒç”¨**ï¼šå¦‚ä½•è°ƒç”¨è‡ªå·±ï¼ˆå®¹å™¨èŠ‚ç‚¹è°ƒç”¨å­ç»„ä»¶ï¼‰
3. **çŠ¶æ€ä¼ é€’**ï¼šå¦‚ä½•ä¼ é€’å’Œæ±‡æ€»ç»“æœ

### 4.2 é€’å½’æ“ä½œæ¨¡å¼


```
é€’å½’æ“ä½œçš„é€šç”¨æ¨¡å¼ï¼š

processNode(node) {
    if (nodeæ˜¯å¶å­èŠ‚ç‚¹) {
        // è¾¹ç•Œæ¡ä»¶ï¼šç›´æ¥å¤„ç†
        return handleLeaf(node);
    } else {
        // é€’å½’æ¡ä»¶ï¼šå¤„ç†å®¹å™¨
        result = initResult();
        for (child in node.children) {
            childResult = processNode(child); // é€’å½’è°ƒç”¨
            result = combineResult(result, childResult);
        }
        return result;
    }
}
```

### 4.3 å¸¸è§é€’å½’æ“ä½œå®ç°


```java
// æ‰©å±•å®‰å…¨ç»„åˆæ¨¡å¼ï¼Œå¢åŠ æ›´å¤šé€’å½’æ“ä½œ
class AdvancedMenu extends SafeMenuComponent {
    private List<SafeMenuComponent> components = new ArrayList<>();
    
    public AdvancedMenu(String name) {
        super(name);
    }
    
    public void add(SafeMenuComponent component) {
        components.add(component);
    }
    
    // é€’å½’è®¡ç®—æ€»ä»·æ ¼
    public double getTotalPrice() {
        double total = 0.0;
        for (SafeMenuComponent component : components) {
            if (component instanceof AdvancedMenuItem) {
                total += ((AdvancedMenuItem) component).getPrice();
            } else if (component instanceof AdvancedMenu) {
                total += ((AdvancedMenu) component).getTotalPrice(); // é€’å½’
            }
        }
        return total;
    }
    
    // é€’å½’æŸ¥æ‰¾èœå“
    public SafeMenuComponent findItem(String itemName) {
        for (SafeMenuComponent component : components) {
            if (component.name.equals(itemName)) {
                return component; // æ‰¾åˆ°äº†
            }
            
            // å¦‚æœæ˜¯å®¹å™¨ï¼Œé€’å½’æŸ¥æ‰¾
            if (component instanceof AdvancedMenu) {
                SafeMenuComponent found = ((AdvancedMenu) component).findItem(itemName);
                if (found != null) {
                    return found;
                }
            }
        }
        return null; // æ²¡æ‰¾åˆ°
    }
    
    // é€’å½’è·å–æ‰€æœ‰å¶å­èŠ‚ç‚¹
    public List<SafeMenuComponent> getAllItems() {
        List<SafeMenuComponent> allItems = new ArrayList<>();
        
        for (SafeMenuComponent component : components) {
            if (component instanceof AdvancedMenuItem) {
                allItems.add(component); // å¶å­èŠ‚ç‚¹ç›´æ¥æ·»åŠ 
            } else if (component instanceof AdvancedMenu) {
                // å®¹å™¨èŠ‚ç‚¹é€’å½’è·å–
                allItems.addAll(((AdvancedMenu) component).getAllItems());
            }
        }
        
        return allItems;
    }
    
    @Override
    public void display() {
        System.out.println("\n=== " + name + " ===");
        for (SafeMenuComponent component : components) {
            component.display(); // é€’å½’æ˜¾ç¤º
        }
    }
    
    @Override
    public int getSize() {
        int total = 0;
        for (SafeMenuComponent component : components) {
            total += component.getSize(); // é€’å½’è®¡ç®—å¤§å°
        }
        return total;
    }
}
```

### 4.4 é€’å½’æ“ä½œæœ€ä½³å®è·µ


**âš ï¸ é€’å½’æ“ä½œæ³¨æ„äº‹é¡¹**ï¼š

1. **é˜²æ­¢æ— é™é€’å½’**ï¼šç¡®ä¿æœ‰æ˜ç¡®çš„è¾¹ç•Œæ¡ä»¶
2. **æ€§èƒ½è€ƒè™‘**ï¼šæ·±åº¦è¿‡æ·±å¯èƒ½å¯¼è‡´æ ˆæº¢å‡º
3. **çŠ¶æ€ä¸€è‡´æ€§**ï¼šé€’å½’è¿‡ç¨‹ä¸­è¦ä¿æŒæ•°æ®ä¸€è‡´æ€§

```java
// å®‰å…¨çš„é€’å½’å®ç°ç¤ºä¾‹
public SafeMenuComponent findItemSafely(String itemName, int maxDepth) {
    return findItemWithDepth(itemName, 0, maxDepth);
}

private SafeMenuComponent findItemWithDepth(String itemName, int currentDepth, int maxDepth) {
    // é˜²æ­¢é€’å½’è¿‡æ·±
    if (currentDepth > maxDepth) {
        return null;
    }
    
    for (SafeMenuComponent component : components) {
        if (component.name.equals(itemName)) {
            return component;
        }
        
        if (component instanceof AdvancedMenu) {
            SafeMenuComponent found = ((AdvancedMenu) component)
                .findItemWithDepth(itemName, currentDepth + 1, maxDepth);
            if (found != null) {
                return found;
            }
        }
    }
    
    return null;
}
```

---

## 5. ğŸ—ºï¸ èŠ‚ç‚¹éå†ç­–ç•¥


### 5.1 éå†ç­–ç•¥æ¦‚è¿°


ç»„åˆæ¨¡å¼ä¸­çš„éå†å°±åƒ**æ¸¸è§ˆä¸€ä¸ªå¤§æ¥¼**ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸åŒçš„è·¯çº¿ï¼š
- **æ·±åº¦ä¼˜å…ˆ**ï¼šä¸€å£æ°”èµ°åˆ°åº•ï¼Œå†å›å¤´çœ‹åˆ«çš„
- **å¹¿åº¦ä¼˜å…ˆ**ï¼šä¸€å±‚ä¸€å±‚åœ°çœ‹ï¼Œæ¯å±‚éƒ½çœ‹å®Œå†å¾€ä¸‹

### 5.2 æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰


**å·¥ä½œåŸç†**ï¼šå…ˆæ·±å…¥åˆ°æœ€åº•å±‚ï¼Œå†é€å±‚è¿”å›

```
æ·±åº¦ä¼˜å…ˆéå†ç¤ºæ„ï¼š

    A               è®¿é—®é¡ºåºï¼šA â†’ B â†’ D â†’ E â†’ C â†’ F
   / \              
  B   C             è·¯å¾„ï¼šAè¿›å…¥ â†’ Bè¿›å…¥ â†’ Då¤„ç† â†’ Eå¤„ç† 
 /|   |                   â†’ Bé€€å‡º â†’ Cè¿›å…¥ â†’ Få¤„ç† â†’ Cé€€å‡º â†’ Aé€€å‡º
D E   F
```

```java
// æ·±åº¦ä¼˜å…ˆéå†å®ç°
public class DFSTraversal {
    
    // å‰åºéå†ï¼šæ ¹ â†’ å·¦ â†’ å³
    public void preorderTraversal(SafeMenuComponent component) {
        // å…ˆå¤„ç†å½“å‰èŠ‚ç‚¹
        System.out.println("è®¿é—®ï¼š" + component.name);
        
        // å¦‚æœæ˜¯å®¹å™¨ï¼Œé€’å½’å¤„ç†å­èŠ‚ç‚¹
        if (component instanceof AdvancedMenu) {
            AdvancedMenu menu = (AdvancedMenu) component;
            for (int i = 0; i < menu.getChildCount(); i++) {
                preorderTraversal(menu.getChild(i));
            }
        }
    }
    
    // ååºéå†ï¼šå·¦ â†’ å³ â†’ æ ¹
    public void postorderTraversal(SafeMenuComponent component) {
        // å¦‚æœæ˜¯å®¹å™¨ï¼Œå…ˆå¤„ç†å­èŠ‚ç‚¹
        if (component instanceof AdvancedMenu) {
            AdvancedMenu menu = (AdvancedMenu) component;
            for (int i = 0; i < menu.getChildCount(); i++) {
                postorderTraversal(menu.getChild(i));
            }
        }
        
        // æœ€åå¤„ç†å½“å‰èŠ‚ç‚¹
        System.out.println("è®¿é—®ï¼š" + component.name);
    }
}
```

### 5.3 å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰


**å·¥ä½œåŸç†**ï¼šä¸€å±‚ä¸€å±‚åœ°è®¿é—®ï¼Œç”¨é˜Ÿåˆ—æ¥æ§åˆ¶é¡ºåº

```
å¹¿åº¦ä¼˜å…ˆéå†ç¤ºæ„ï¼š

    A               è®¿é—®é¡ºåºï¼šA â†’ B â†’ C â†’ D â†’ E â†’ F
   / \              
  B   C             å±‚æ¬¡ï¼šç¬¬1å±‚(A) â†’ ç¬¬2å±‚(B,C) â†’ ç¬¬3å±‚(D,E,F)
 /|   |             
D E   F
```

```java
// å¹¿åº¦ä¼˜å…ˆéå†å®ç°
public class BFSTraversal {
    
    public void breadthFirstTraversal(SafeMenuComponent root) {
        if (root == null) return;
        
        Queue<SafeMenuComponent> queue = new LinkedList<>();
        queue.offer(root);
        
        while (!queue.isEmpty()) {
            SafeMenuComponent current = queue.poll();
            
            // å¤„ç†å½“å‰èŠ‚ç‚¹
            System.out.println("è®¿é—®ï¼š" + current.name);
            
            // å¦‚æœæ˜¯å®¹å™¨ï¼Œå°†æ‰€æœ‰å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—
            if (current instanceof AdvancedMenu) {
                AdvancedMenu menu = (AdvancedMenu) current;
                for (int i = 0; i < menu.getChildCount(); i++) {
                    queue.offer(menu.getChild(i));
                }
            }
        }
    }
    
    // æŒ‰å±‚éå†ï¼ˆæ›´è¯¦ç»†çš„å¹¿åº¦éå†ï¼‰
    public void levelOrderTraversal(SafeMenuComponent root) {
        if (root == null) return;
        
        Queue<SafeMenuComponent> queue = new LinkedList<>();
        queue.offer(root);
        int level = 1;
        
        while (!queue.isEmpty()) {
            int levelSize = queue.size();
            System.out.println("ç¬¬" + level + "å±‚ï¼š");
            
            // å¤„ç†å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹
            for (int i = 0; i < levelSize; i++) {
                SafeMenuComponent current = queue.poll();
                System.out.print(current.name + " ");
                
                // å°†ä¸‹ä¸€å±‚èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—
                if (current instanceof AdvancedMenu) {
                    AdvancedMenu menu = (AdvancedMenu) current;
                    for (int j = 0; j < menu.getChildCount(); j++) {
                        queue.offer(menu.getChild(j));
                    }
                }
            }
            
            System.out.println();
            level++;
        }
    }
}
```

### 5.4 éå†ç­–ç•¥é€‰æ‹©


| éå†æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|-------------|---------|---------|
| ğŸ” **æ·±åº¦ä¼˜å…ˆ** | `æ–‡ä»¶ç³»ç»Ÿæœç´¢ã€æ ‘å½¢ç»“æ„åˆ†æ` | `å†…å­˜å ç”¨å°‘ï¼Œæ˜“äºå®ç°` | `å¯èƒ½å¾ˆä¹…æ‰èƒ½æ‰¾åˆ°ç›®æ ‡` |
| ğŸŒŠ **å¹¿åº¦ä¼˜å…ˆ** | `æœ€çŸ­è·¯å¾„æŸ¥æ‰¾ã€å±‚æ¬¡åˆ†æ` | `èƒ½æ‰¾åˆ°æœ€è¿‘çš„ç»“æœ` | `å†…å­˜å ç”¨å¤§ï¼Œéœ€è¦é˜Ÿåˆ—` |

---

## 6. ğŸ“Š çŠ¶æ€ç®¡ç†æœºåˆ¶


### 6.1 çŠ¶æ€ç®¡ç†çš„é‡è¦æ€§


åœ¨ç»„åˆæ¨¡å¼ä¸­ï¼Œ**çŠ¶æ€ç®¡ç†**å°±åƒç®¡ç†ä¸€ä¸ªå¤§å®¶åº­ï¼Œä½ éœ€è¦çŸ¥é“ï¼š
- æ¯ä¸ªæˆå‘˜çš„çŠ¶æ€ï¼ˆä¸ªä½“çŠ¶æ€ï¼‰
- æ•´ä¸ªå®¶åº­çš„çŠ¶æ€ï¼ˆç»„åˆçŠ¶æ€ï¼‰  
- çŠ¶æ€æ”¹å˜æ—¶å¦‚ä½•é€šçŸ¥ç›¸å…³äººå‘˜ï¼ˆçŠ¶æ€åŒæ­¥ï¼‰

### 6.2 çŠ¶æ€ç®¡ç†ç­–ç•¥


**ğŸ”¸ å‘ä¸Šä¼ æ’­ç­–ç•¥**ï¼šå­ç»„ä»¶çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥çˆ¶ç»„ä»¶
**ğŸ”¸ å‘ä¸‹ä¼ æ’­ç­–ç•¥**ï¼šçˆ¶ç»„ä»¶çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰å­ç»„ä»¶
**ğŸ”¸ è§‚å¯Ÿè€…æ¨¡å¼ç»“åˆ**ï¼šä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å®ç°çŠ¶æ€é€šçŸ¥

### 6.3 çŠ¶æ€ç®¡ç†å®ç°


```java
// æ”¯æŒçŠ¶æ€ç®¡ç†çš„ç»„åˆæ¨¡å¼
interface ComponentStateListener {
    void onStateChanged(SafeMenuComponent component, String state);
}

abstract class StatefulMenuComponent extends SafeMenuComponent {
    protected String state = "normal";
    protected ComponentStateListener parent;
    protected List<ComponentStateListener> listeners = new ArrayList<>();
    
    public StatefulMenuComponent(String name) {
        super(name);
    }
    
    // çŠ¶æ€ç®¡ç†æ–¹æ³•
    public void setState(String newState) {
        String oldState = this.state;
        this.state = newState;
        
        System.out.println(name + " çŠ¶æ€ä» " + oldState + " å˜ä¸º " + newState);
        
        // é€šçŸ¥çˆ¶ç»„ä»¶
        if (parent != null) {
            parent.onStateChanged(this, newState);
        }
        
        // é€šçŸ¥ç›‘å¬å™¨
        for (ComponentStateListener listener : listeners) {
            listener.onStateChanged(this, newState);
        }
    }
    
    public String getState() {
        return state;
    }
    
    public void setParent(ComponentStateListener parent) {
        this.parent = parent;
    }
    
    public void addStateListener(ComponentStateListener listener) {
        listeners.add(listener);
    }
}

// æœ‰çŠ¶æ€çš„å®¹å™¨ç»„ä»¶
class StatefulMenu extends StatefulMenuComponent implements ComponentStateListener {
    private List<StatefulMenuComponent> components = new ArrayList<>();
    
    public StatefulMenu(String name) {
        super(name);
    }
    
    public void add(StatefulMenuComponent component) {
        components.add(component);
        component.setParent(this); // è®¾ç½®çˆ¶å­å…³ç³»
    }
    
    public void remove(StatefulMenuComponent component) {
        components.remove(component);
        component.setParent(null);
    }
    
    // å®ç°çŠ¶æ€ç›‘å¬
    @Override
    public void onStateChanged(SafeMenuComponent component, String state) {
        System.out.println("çˆ¶ç»„ä»¶ " + name + " æ”¶åˆ°å­ç»„ä»¶ " + 
                          component.name + " çš„çŠ¶æ€å˜åŒ–ï¼š" + state);
        
        // æ ¹æ®å­ç»„ä»¶çŠ¶æ€å†³å®šè‡ªå·±çš„çŠ¶æ€
        updateOwnState();
    }
    
    private void updateOwnState() {
        // å¦‚æœæœ‰ä»»ä½•å­ç»„ä»¶æ˜¯é”™è¯¯çŠ¶æ€ï¼Œçˆ¶ç»„ä»¶ä¹Ÿå˜ä¸ºé”™è¯¯çŠ¶æ€
        for (StatefulMenuComponent component : components) {
            if ("error".equals(component.getState())) {
                setState("error");
                return;
            }
        }
        
        // å¦‚æœæ‰€æœ‰å­ç»„ä»¶éƒ½æ­£å¸¸ï¼Œçˆ¶ç»„ä»¶ä¹Ÿæ­£å¸¸
        setState("normal");
    }
    
    // çŠ¶æ€å‘ä¸‹ä¼ æ’­
    public void propagateStateToChildren(String state) {
        System.out.println("å‘æ‰€æœ‰å­ç»„ä»¶ä¼ æ’­çŠ¶æ€ï¼š" + state);
        for (StatefulMenuComponent component : components) {
            component.setState(state);
        }
    }
    
    @Override
    public void display() {
        System.out.println("\n=== " + name + " [çŠ¶æ€:" + state + "] ===");
        for (StatefulMenuComponent component : components) {
            component.display();
        }
    }
    
    @Override
    public int getSize() {
        return components.stream().mapToInt(SafeMenuComponent::getSize).sum();
    }
}

// æœ‰çŠ¶æ€çš„å¶å­ç»„ä»¶
class StatefulMenuItem extends StatefulMenuComponent {
    private double price;
    
    public StatefulMenuItem(String name, double price) {
        super(name);
        this.price = price;
    }
    
    @Override
    public void display() {
        System.out.println("èœå“ï¼š" + name + " [çŠ¶æ€:" + state + "] - ï¿¥" + price);
    }
    
    @Override
    public int getSize() {
        return 1;
    }
    
    // æ¨¡æ‹Ÿèœå“çŠ¶æ€å˜åŒ–ï¼ˆæ¯”å¦‚å”®ç½„ï¼‰
    public void soldOut() {
        setState("sold_out");
    }
    
    public void restock() {
        setState("available");
    }
}
```

### 6.4 çŠ¶æ€ç®¡ç†ä½¿ç”¨ç¤ºä¾‹


```java
public class StateManagementDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæœ‰çŠ¶æ€çš„èœå•ç»“æ„
        StatefulMenu mainMenu = new StatefulMenu("ä¸»èœå•");
        StatefulMenu hotDishes = new StatefulMenu("çƒ­èœ");
        
        StatefulMenuItem dish1 = new StatefulMenuItem("å®«ä¿é¸¡ä¸", 28.0);
        StatefulMenuItem dish2 = new StatefulMenuItem("éº»å©†è±†è…", 18.0);
        
        // æ„å»ºå±‚æ¬¡ç»“æ„
        hotDishes.add(dish1);
        hotDishes.add(dish2);
        mainMenu.add(hotDishes);
        
        // æ˜¾ç¤ºåˆå§‹çŠ¶æ€
        mainMenu.display();
        
        System.out.println("\n--- æ¨¡æ‹Ÿèœå“å”®ç½„ ---");
        dish1.soldOut(); // çŠ¶æ€ä¼šå‘ä¸Šä¼ æ’­
        
        System.out.println("\n--- èœå“è¡¥è´§ ---");
        dish1.restock(); // çŠ¶æ€æ¢å¤
        
        System.out.println("\n--- æ•´ä¸ªåˆ†ç±»æš‚åœä¾›åº” ---");
        hotDishes.propagateStateToChildren("suspended"); // çŠ¶æ€å‘ä¸‹ä¼ æ’­
    }
}
```

### 6.5 çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ


**ğŸ’¡ çŠ¶æ€ç®¡ç†è¦ç‚¹**ï¼š

1. **æ˜ç¡®çŠ¶æ€å±‚æ¬¡**ï¼šå“ªäº›çŠ¶æ€å±äºä¸ªä½“ï¼Œå“ªäº›å±äºæ•´ä½“
2. **é¿å…çŠ¶æ€å†²çª**ï¼šçˆ¶å­çŠ¶æ€è¦ä¿æŒä¸€è‡´æ€§
3. **æ€§èƒ½è€ƒè™‘**ï¼šé¢‘ç¹çŠ¶æ€å˜åŒ–å¯èƒ½å½±å“æ€§èƒ½
4. **å¼‚å¸¸å¤„ç†**ï¼šçŠ¶æ€å˜åŒ–è¿‡ç¨‹ä¸­è¦å¤„ç†å¼‚å¸¸æƒ…å†µ

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å®ç°æ–¹å¼å¯¹æ¯”æ€»ç»“


```
ğŸ”“ é€æ˜ç»„åˆæ¨¡å¼ï¼š
  ä¼˜ç‚¹ï¼šæ¥å£ç»Ÿä¸€ï¼Œä½¿ç”¨ç®€å•
  ç¼ºç‚¹ï¼šå¯èƒ½è°ƒç”¨æ— æ•ˆæ“ä½œ
  é€‚ç”¨ï¼šç®€å•åœºæ™¯ï¼Œæ³¨é‡ä¸€è‡´æ€§

ğŸ”’ å®‰å…¨ç»„åˆæ¨¡å¼ï¼š
  ä¼˜ç‚¹ï¼šç±»å‹å®‰å…¨ï¼ŒèŒè´£æ˜ç¡®  
  ç¼ºç‚¹ï¼šéœ€è¦ç±»å‹åˆ¤æ–­
  é€‚ç”¨ï¼šå¤æ‚åœºæ™¯ï¼Œæ³¨é‡å®‰å…¨æ€§
```

### 7.2 æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹


**ğŸ”¹ é€’å½’æ“ä½œç²¾é«“**ï¼š
- **è¾¹ç•Œæ¡ä»¶**ï¼šä»€ä¹ˆæ—¶å€™åœæ­¢é€’å½’
- **é€’å½’è°ƒç”¨**ï¼šå¦‚ä½•æ­£ç¡®åœ°è°ƒç”¨è‡ªå·±
- **ç»“æœæ±‡æ€»**ï¼šå¦‚ä½•åˆå¹¶é€’å½’ç»“æœ

**ğŸ”¹ éå†ç­–ç•¥é€‰æ‹©**ï¼š
- **æ·±åº¦ä¼˜å…ˆ**ï¼šé€‚åˆæœç´¢å’Œæ ‘å½¢åˆ†æ
- **å¹¿åº¦ä¼˜å…ˆ**ï¼šé€‚åˆå±‚æ¬¡åˆ†æå’Œæœ€çŸ­è·¯å¾„

**ğŸ”¹ çŠ¶æ€ç®¡ç†æ ¸å¿ƒ**ï¼š
- **çŠ¶æ€ä¼ æ’­**ï¼šå‘ä¸Šæ±‡æŠ¥ï¼Œå‘ä¸‹åˆ†å‘
- **çŠ¶æ€ä¸€è‡´æ€§**ï¼šçˆ¶å­çŠ¶æ€è¦åè°ƒ
- **æ€§èƒ½å¹³è¡¡**ï¼šçŠ¶æ€æ›´æ–°ä¸èƒ½å¤ªé¢‘ç¹

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**âœ… é€‰æ‹©é€æ˜ç»„åˆå½“**ï¼š
- ç³»ç»Ÿç»“æ„ç›¸å¯¹ç®€å•
- æ³¨é‡ä½¿ç”¨çš„ä¸€è‡´æ€§
- å®¢æˆ·ç«¯ä¸æƒ³å¤„ç†ç±»å‹åˆ¤æ–­

**âœ… é€‰æ‹©å®‰å…¨ç»„åˆå½“**ï¼š
- ç³»ç»Ÿç»“æ„å¤æ‚
- ç±»å‹å®‰å…¨è¦æ±‚é«˜
- éœ€è¦ç¼–è¯‘æœŸé”™è¯¯æ£€æŸ¥

**âœ… ä½¿ç”¨é€’å½’æ“ä½œå½“**ï¼š
- éœ€è¦å¤„ç†æ•´ä¸ªæ ‘ç»“æ„
- æ“ä½œå…·æœ‰é€’å½’æ€§è´¨
- ç»“æœéœ€è¦ä»åº•å±‚æ±‡æ€»

**âœ… å®ç°çŠ¶æ€ç®¡ç†å½“**ï¼š
- ç»„ä»¶çŠ¶æ€ä¼šåŠ¨æ€å˜åŒ–
- éœ€è¦çŠ¶æ€è”åŠ¨æ•ˆæœ
- è¦ç›‘æ§æ•´ä½“çŠ¶æ€

### 7.4 è®°å¿†è¦ç‚¹


**ğŸ¯ ç»„åˆæ¨¡å¼å®ç°å£è¯€**ï¼š
- é€æ˜ç»Ÿä¸€å¥½ä½¿ç”¨ï¼Œå®‰å…¨åˆ†ç¦»æ›´å¯é 
- é€’å½’æ“ä½œæ˜¯æ ¸å¿ƒï¼Œè¾¹ç•Œæ¡ä»¶è¦è®°ç‰¢  
- éå†ç­–ç•¥æœ‰ä¸¤ç§ï¼Œæ·±åº¦å¹¿åº¦å„æœ‰æ•ˆ
- çŠ¶æ€ç®¡ç†å¾ˆé‡è¦ï¼Œä¼ æ’­ä¸€è‡´æ€§èƒ½å¥½

**æ ¸å¿ƒç†è§£**ï¼šç»„åˆæ¨¡å¼çš„å®ç°æ–¹å¼å„æœ‰ç‰¹ç‚¹ï¼Œé€‰æ‹©åˆé€‚çš„å®ç°æ–¹å¼å’ŒæŠ€æœ¯ç­–ç•¥ï¼Œèƒ½è®©ä½ çš„ä»£ç æ—¢çµæ´»åˆå®‰å…¨ï¼Œæ—¢é«˜æ•ˆåˆæ˜“ç»´æŠ¤ã€‚å…³é”®æ˜¯è¦æ ¹æ®å…·ä½“åœºæ™¯çš„éœ€æ±‚æ¥åšå‡ºæœ€ä½³é€‰æ‹©ã€‚