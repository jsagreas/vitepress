---
title: 6ã€ç»„åˆæ¨¡å¼ä»£ç å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [å®Œæ•´ä»£ç ç¤ºä¾‹](#1-å®Œæ•´ä»£ç ç¤ºä¾‹)
2. [æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿ](#2-æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿ)
3. [GUIç»„ä»¶å®ç°](#3-GUIç»„ä»¶å®ç°)
4. [é€’å½’ç®—æ³•ä¼˜åŒ–](#4-é€’å½’ç®—æ³•ä¼˜åŒ–)
5. [å®é™…é¡¹ç›®é›†æˆ](#5-å®é™…é¡¹ç›®é›†æˆ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ å®Œæ•´ä»£ç ç¤ºä¾‹


### 1.1 ä»€ä¹ˆæ˜¯ç»„åˆæ¨¡å¼çš„å®Œæ•´å®ç°


ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰è¯´ç™½äº†å°±æ˜¯**æŠŠå•ä¸ªå¯¹è±¡å’Œä¸€ç¾¤å¯¹è±¡ç”¨åŒæ ·çš„æ–¹å¼æ¥å¤„ç†**ã€‚å°±åƒä½ æ“ä½œä¸€ä¸ªæ–‡ä»¶å’Œæ“ä½œä¸€ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€æ ·çš„é“ç†ã€‚

**ğŸ”¸ æ ¸å¿ƒæ€æƒ³**
```
æŠŠå¯¹è±¡ç»„ç»‡æˆæ ‘å½¢ç»“æ„ï¼š
â€¢ å¶å­èŠ‚ç‚¹ï¼šå•ä¸ªå¯¹è±¡ï¼ˆæ–‡ä»¶ï¼‰
â€¢ å®¹å™¨èŠ‚ç‚¹ï¼šåŒ…å«å…¶ä»–å¯¹è±¡çš„å¯¹è±¡ï¼ˆæ–‡ä»¶å¤¹ï¼‰
â€¢ ç»Ÿä¸€æ¥å£ï¼šå¯¹å¶å­å’Œå®¹å™¨éƒ½ç”¨ç›¸åŒæ–¹æ³•æ“ä½œ
```

### 1.2 åŸºç¡€ç»„ä»¶æ¥å£è®¾è®¡


```java
// ç»„ä»¶æ¥å£ - å®šä¹‰äº†å¶å­å’Œå®¹å™¨çš„å…±åŒè¡Œä¸º
public abstract class FileSystemComponent {
    protected String name;
    
    public FileSystemComponent(String name) {
        this.name = name;
    }
    
    // æ‰€æœ‰ç»„ä»¶éƒ½æ”¯æŒçš„åŸºæœ¬æ“ä½œ
    public abstract void display(int depth);
    public abstract long getSize();
    
    // å®¹å™¨æ‰æ”¯æŒçš„æ“ä½œ - å¶å­èŠ‚ç‚¹æŠ›å¼‚å¸¸
    public void add(FileSystemComponent component) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒæ·»åŠ æ“ä½œ");
    }
    
    public void remove(FileSystemComponent component) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹ä¸æ”¯æŒåˆ é™¤æ“ä½œ");
    }
    
    public FileSystemComponent getChild(int index) {
        throw new UnsupportedOperationException("å¶å­èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹");
    }
}
```

**ğŸ’¡ è®¾è®¡è¦ç‚¹è§£é‡Š**
- **ç»Ÿä¸€æ¥å£**ï¼šæ— è®ºæ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œéƒ½æœ‰ `display()` å’Œ `getSize()` æ–¹æ³•
- **é»˜è®¤å¼‚å¸¸**ï¼šå¶å­èŠ‚ç‚¹å¯¹å®¹å™¨æ“ä½œæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯å®‰å…¨çš„åšæ³•
- **æŠ½è±¡åŸºç±»**ï¼šä½¿ç”¨æŠ½è±¡ç±»è€Œéæ¥å£ï¼Œå¯ä»¥æä¾›é»˜è®¤å®ç°

### 1.3 å¶å­èŠ‚ç‚¹å®ç°


```java
// æ–‡ä»¶ç±» - å¶å­èŠ‚ç‚¹
public class File extends FileSystemComponent {
    private long size;
    
    public File(String name, long size) {
        super(name);
        this.size = size;
    }
    
    @Override
    public void display(int depth) {
        // ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»
        StringBuilder indent = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            indent.append("  ");
        }
        System.out.println(indent + "ğŸ“„ " + name + " (" + size + " bytes)");
    }
    
    @Override
    public long getSize() {
        return size;
    }
}
```

**ğŸ¯ å¶å­èŠ‚ç‚¹ç‰¹ç‚¹**
- **ç®€å•å®ç°**ï¼šåªéœ€è¦å®ç°è‡ªå·±çš„åŸºæœ¬è¡Œä¸º
- **ä¸èƒ½åŒ…å«å­å¯¹è±¡**ï¼šç»§æ‰¿çš„å®¹å™¨æ–¹æ³•ä¼šæŠ›å¼‚å¸¸
- **å…·ä½“æ•°æ®**ï¼šæœ‰è‡ªå·±çš„å±æ€§ï¼ˆå¦‚æ–‡ä»¶å¤§å°ï¼‰

### 1.4 å®¹å™¨èŠ‚ç‚¹å®ç°


```java
// æ–‡ä»¶å¤¹ç±» - å®¹å™¨èŠ‚ç‚¹
public class Folder extends FileSystemComponent {
    private List<FileSystemComponent> children;
    
    public Folder(String name) {
        super(name);
        this.children = new ArrayList<>();
    }
    
    @Override
    public void add(FileSystemComponent component) {
        children.add(component);
    }
    
    @Override
    public void remove(FileSystemComponent component) {
        children.remove(component);
    }
    
    @Override
    public FileSystemComponent getChild(int index) {
        return children.get(index);
    }
    
    @Override
    public void display(int depth) {
        StringBuilder indent = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            indent.append("  ");
        }
        System.out.println(indent + "ğŸ“ " + name + "/");
        
        // é€’å½’æ˜¾ç¤ºæ‰€æœ‰å­ç»„ä»¶
        for (FileSystemComponent child : children) {
            child.display(depth + 1);
        }
    }
    
    @Override
    public long getSize() {
        long totalSize = 0;
        // é€’å½’è®¡ç®—æ‰€æœ‰å­ç»„ä»¶çš„å¤§å°
        for (FileSystemComponent child : children) {
            totalSize += child.getSize();
        }
        return totalSize;
    }
    
    public int getChildCount() {
        return children.size();
    }
}
```

**âš¡ å®¹å™¨èŠ‚ç‚¹è¦ç‚¹**
- **é€’å½’å¤„ç†**ï¼šå¯¹å­ç»„ä»¶çš„æ“ä½œéƒ½æ˜¯é€’å½’çš„
- **ç®¡ç†å­å¯¹è±¡**ï¼šç»´æŠ¤ä¸€ä¸ªå­ç»„ä»¶åˆ—è¡¨
- **é€æ˜æ€§**ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“æ“ä½œçš„æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹

---

## 2. ğŸ—‚ï¸ æ–‡ä»¶ç³»ç»Ÿæ¨¡æ‹Ÿ


### 2.1 æ„å»ºæ–‡ä»¶ç³»ç»Ÿæ ‘


```java
public class FileSystemDemo {
    public static void main(String[] args) {
        // åˆ›å»ºæ ¹ç›®å½•
        Folder root = new Folder("ç³»ç»Ÿç›˜(C:)");
        
        // åˆ›å»ºç¨‹åºæ–‡ä»¶å¤¹
        Folder programFiles = new Folder("Program Files");
        programFiles.add(new File("notepad.exe", 2048));
        programFiles.add(new File("calc.exe", 1024));
        
        // åˆ›å»ºç”¨æˆ·æ–‡ä»¶å¤¹
        Folder users = new Folder("Users");
        Folder userProfile = new Folder("å¼ ä¸‰");
        
        // ç”¨æˆ·æ¡Œé¢
        Folder desktop = new Folder("Desktop");
        desktop.add(new File("å·¥ä½œæŠ¥å‘Š.docx", 5120));
        desktop.add(new File("åº¦å‡ç…§ç‰‡.jpg", 8192));
        
        // ç”¨æˆ·æ–‡æ¡£
        Folder documents = new Folder("Documents");
        documents.add(new File("ç®€å†.pdf", 1536));
        documents.add(new File("é¡¹ç›®è®¡åˆ’.xlsx", 2560));
        
        // ç»„è£…ç›®å½•ç»“æ„
        userProfile.add(desktop);
        userProfile.add(documents);
        users.add(userProfile);
        
        root.add(programFiles);
        root.add(users);
        
        // æ˜¾ç¤ºæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ
        System.out.println("=== æ–‡ä»¶ç³»ç»Ÿç»“æ„ ===");
        root.display(0);
        
        System.out.println("\n=== ç³»ç»Ÿç›˜æ€»å¤§å°: " + root.getSize() + " bytes ===");
    }
}
```

**ğŸŒ³ è¿è¡Œç»“æœå±•ç¤º**
```
=== æ–‡ä»¶ç³»ç»Ÿç»“æ„ ===
ğŸ“ ç³»ç»Ÿç›˜(C:)/
  ğŸ“ Program Files/
    ğŸ“„ notepad.exe (2048 bytes)
    ğŸ“„ calc.exe (1024 bytes)
  ğŸ“ Users/
    ğŸ“ å¼ ä¸‰/
      ğŸ“ Desktop/
        ğŸ“„ å·¥ä½œæŠ¥å‘Š.docx (5120 bytes)
        ğŸ“„ åº¦å‡ç…§ç‰‡.jpg (8192 bytes)
      ğŸ“ Documents/
        ğŸ“„ ç®€å†.pdf (1536 bytes)
        ğŸ“„ é¡¹ç›®è®¡åˆ’.xlsx (2560 bytes)

=== ç³»ç»Ÿç›˜æ€»å¤§å°: 20480 bytes ===
```

### 2.2 é«˜çº§æ–‡ä»¶æ“ä½œ


```java
// æ‰©å±•çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œç±»
public class FileSystemManager {
    
    // æŸ¥æ‰¾æ–‡ä»¶
    public static FileSystemComponent findFile(FileSystemComponent root, String fileName) {
        if (root.name.equals(fileName)) {
            return root;
        }
        
        // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œé€’å½’æœç´¢å­èŠ‚ç‚¹
        if (root instanceof Folder) {
            Folder folder = (Folder) root;
            for (int i = 0; i < folder.getChildCount(); i++) {
                FileSystemComponent result = findFile(folder.getChild(i), fileName);
                if (result != null) {
                    return result;
                }
            }
        }
        return null;
    }
    
    // ç»Ÿè®¡æ–‡ä»¶æ•°é‡
    public static int countFiles(FileSystemComponent component) {
        if (component instanceof File) {
            return 1;
        }
        
        int count = 0;
        if (component instanceof Folder) {
            Folder folder = (Folder) component;
            for (int i = 0; i < folder.getChildCount(); i++) {
                count += countFiles(folder.getChild(i));
            }
        }
        return count;
    }
    
    // è·å–æœ€å¤§æ–‡ä»¶
    public static File getLargestFile(FileSystemComponent component) {
        if (component instanceof File) {
            return (File) component;
        }
        
        File largest = null;
        if (component instanceof Folder) {
            Folder folder = (Folder) component;
            for (int i = 0; i < folder.getChildCount(); i++) {
                File candidate = getLargestFile(folder.getChild(i));
                if (candidate != null && 
                    (largest == null || candidate.getSize() > largest.getSize())) {
                    largest = candidate;
                }
            }
        }
        return largest;
    }
}
```

---

## 3. ğŸ¨ GUIç»„ä»¶å®ç°


### 3.1 GUIç»„ä»¶çš„ç»„åˆæ¨¡å¼åº”ç”¨


åœ¨å›¾å½¢ç•Œé¢ä¸­ï¼Œ**çª—å£å¯ä»¥åŒ…å«æŒ‰é’®ã€æ–‡æœ¬æ¡†ç­‰**ï¼Œ**é¢æ¿ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–ç»„ä»¶**ï¼Œè¿™æ­£æ˜¯ç»„åˆæ¨¡å¼çš„å…¸å‹åº”ç”¨ã€‚

```java
// GUIç»„ä»¶åŸºç±»
public abstract class UIComponent {
    protected String name;
    protected int x, y, width, height;
    
    public UIComponent(String name, int x, int y, int width, int height) {
        this.name = name;
        this.x = x; this.y = y;
        this.width = width; this.height = height;
    }
    
    // æ‰€æœ‰ç»„ä»¶éƒ½éœ€è¦çš„æ–¹æ³•
    public abstract void render();
    public abstract void handleClick(int mouseX, int mouseY);
    
    // å®¹å™¨ç»„ä»¶æ‰éœ€è¦çš„æ–¹æ³•
    public void addComponent(UIComponent component) {
        throw new UnsupportedOperationException("åŸºç¡€ç»„ä»¶ä¸æ”¯æŒæ·»åŠ å­ç»„ä»¶");
    }
    
    public void removeComponent(UIComponent component) {
        throw new UnsupportedOperationException("åŸºç¡€ç»„ä»¶ä¸æ”¯æŒåˆ é™¤å­ç»„ä»¶");
    }
    
    // åˆ¤æ–­ç‚¹å‡»æ˜¯å¦åœ¨ç»„ä»¶èŒƒå›´å†…
    protected boolean isPointInBounds(int mouseX, int mouseY) {
        return mouseX >= x && mouseX <= x + width && 
               mouseY >= y && mouseY <= y + height;
    }
}
```

### 3.2 å¶å­ç»„ä»¶å®ç°


```java
// æŒ‰é’®ç»„ä»¶ - å¶å­èŠ‚ç‚¹
public class Button extends UIComponent {
    private String text;
    
    public Button(String name, String text, int x, int y, int width, int height) {
        super(name, x, y, width, height);
        this.text = text;
    }
    
    @Override
    public void render() {
        System.out.println("æ¸²æŸ“æŒ‰é’®: " + text + " ä½ç½®(" + x + "," + y + ") å¤§å°(" + width + "x" + height + ")");
    }
    
    @Override
    public void handleClick(int mouseX, int mouseY) {
        if (isPointInBounds(mouseX, mouseY)) {
            System.out.println("æŒ‰é’® [" + text + "] è¢«ç‚¹å‡»äº†!");
        }
    }
}

// æ–‡æœ¬æ¡†ç»„ä»¶ - å¶å­èŠ‚ç‚¹
public class TextBox extends UIComponent {
    private String content;
    
    public TextBox(String name, int x, int y, int width, int height) {
        super(name, x, y, width, height);
        this.content = "";
    }
    
    @Override
    public void render() {
        System.out.println("æ¸²æŸ“æ–‡æœ¬æ¡†: " + name + " å†…å®¹[" + content + "] ä½ç½®(" + x + "," + y + ")");
    }
    
    @Override
    public void handleClick(int mouseX, int mouseY) {
        if (isPointInBounds(mouseX, mouseY)) {
            System.out.println("æ–‡æœ¬æ¡† [" + name + "] è·å¾—ç„¦ç‚¹");
        }
    }
    
    public void setText(String text) {
        this.content = text;
    }
}
```

### 3.3 å®¹å™¨ç»„ä»¶å®ç°


```java
// é¢æ¿ç»„ä»¶ - å®¹å™¨èŠ‚ç‚¹
public class Panel extends UIComponent {
    private List<UIComponent> children;
    private String backgroundColor;
    
    public Panel(String name, int x, int y, int width, int height, String bgColor) {
        super(name, x, y, width, height);
        this.children = new ArrayList<>();
        this.backgroundColor = bgColor;
    }
    
    @Override
    public void addComponent(UIComponent component) {
        children.add(component);
    }
    
    @Override
    public void removeComponent(UIComponent component) {
        children.remove(component);
    }
    
    @Override
    public void render() {
        System.out.println("æ¸²æŸ“é¢æ¿: " + name + " èƒŒæ™¯è‰²:" + backgroundColor + 
                          " ä½ç½®(" + x + "," + y + ") å¤§å°(" + width + "x" + height + ")");
        
        // æ¸²æŸ“æ‰€æœ‰å­ç»„ä»¶
        for (UIComponent child : children) {
            child.render();
        }
    }
    
    @Override
    public void handleClick(int mouseX, int mouseY) {
        // å°†ç‚¹å‡»äº‹ä»¶ä¼ é€’ç»™æ‰€æœ‰å­ç»„ä»¶
        for (UIComponent child : children) {
            child.handleClick(mouseX, mouseY);
        }
    }
}
```

### 3.4 æ„å»ºGUIç•Œé¢


```java
public class GUIDemo {
    public static void main(String[] args) {
        // åˆ›å»ºä¸»çª—å£ï¼ˆæ ¹å®¹å™¨ï¼‰
        Panel mainWindow = new Panel("ä¸»çª—å£", 0, 0, 800, 600, "ç™½è‰²");
        
        // åˆ›å»ºé¡¶éƒ¨å·¥å…·æ 
        Panel toolbar = new Panel("å·¥å…·æ ", 0, 0, 800, 60, "ç°è‰²");
        toolbar.addComponent(new Button("btn1", "æ–°å»º", 10, 15, 80, 30));
        toolbar.addComponent(new Button("btn2", "ä¿å­˜", 100, 15, 80, 30));
        toolbar.addComponent(new Button("btn3", "æ‰“å¼€", 190, 15, 80, 30));
        
        // åˆ›å»ºå·¦ä¾§é¢æ¿
        Panel leftPanel = new Panel("å·¦ä¾§é¢æ¿", 0, 60, 200, 540, "æµ…ç°è‰²");
        leftPanel.addComponent(new Button("btn4", "æ–‡ä»¶", 10, 10, 180, 40));
        leftPanel.addComponent(new Button("btn5", "ç¼–è¾‘", 10, 60, 180, 40));
        leftPanel.addComponent(new Button("btn6", "è§†å›¾", 10, 110, 180, 40));
        
        // åˆ›å»ºä¸»ç¼–è¾‘åŒºåŸŸ
        Panel editArea = new Panel("ç¼–è¾‘åŒºåŸŸ", 200, 60, 600, 540, "ç™½è‰²");
        editArea.addComponent(new TextBox("æ–‡æ¡£æ ‡é¢˜", 220, 80, 560, 30));
        editArea.addComponent(new TextBox("æ–‡æ¡£å†…å®¹", 220, 120, 560, 400));
        
        // ç»„è£…ç•Œé¢
        mainWindow.addComponent(toolbar);
        mainWindow.addComponent(leftPanel);
        mainWindow.addComponent(editArea);
        
        // æ¸²æŸ“æ•´ä¸ªç•Œé¢
        System.out.println("=== æ¸²æŸ“GUIç•Œé¢ ===");
        mainWindow.render();
        
        // æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»
        System.out.println("\n=== æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ ===");
        System.out.println("ç‚¹å‡»ä½ç½® (50, 30):");
        mainWindow.handleClick(50, 30);
        
        System.out.println("\nç‚¹å‡»ä½ç½® (400, 100):");
        mainWindow.handleClick(400, 100);
    }
}
```

---

## 4. ğŸ”„ é€’å½’ç®—æ³•ä¼˜åŒ–


### 4.1 ä¸ºä»€ä¹ˆç»„åˆæ¨¡å¼éœ€è¦ä¼˜åŒ–é€’å½’


ç»„åˆæ¨¡å¼çš„æ ¸å¿ƒå°±æ˜¯**é€’å½’å¤„ç†**ï¼Œä½†é€’å½’å¦‚æœä¸ä¼˜åŒ–ï¼Œå¯èƒ½ä¼šæœ‰è¿™äº›é—®é¢˜ï¼š

**ğŸš¨ å¸¸è§é—®é¢˜**
```
1. æ ˆæº¢å‡ºï¼šæ ‘å¤ªæ·±æ—¶é€’å½’è°ƒç”¨è¿‡å¤š
2. é‡å¤è®¡ç®—ï¼šç›¸åŒå­æ ‘è¢«å¤šæ¬¡éå†
3. æ€§èƒ½ä½ä¸‹ï¼šå¤§é‡çš„æ–¹æ³•è°ƒç”¨å¼€é”€
4. å†…å­˜æµªè´¹ï¼šæ¯å±‚é€’å½’éƒ½å ç”¨æ ˆç©ºé—´
```

### 4.2 è¿­ä»£ç‰ˆæœ¬æ›¿ä»£é€’å½’


```java
// ä¼˜åŒ–çš„æ–‡ä»¶ç³»ç»Ÿéå†
public class OptimizedFileSystem {
    
    // ç”¨æ ˆæ›¿ä»£é€’å½’è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†
    public static void displayIterative(FileSystemComponent root) {
        Stack<ComponentWithDepth> stack = new Stack<>();
        stack.push(new ComponentWithDepth(root, 0));
        
        while (!stack.isEmpty()) {
            ComponentWithDepth current = stack.pop();
            
            // æ˜¾ç¤ºå½“å‰ç»„ä»¶
            displayComponent(current.component, current.depth);
            
            // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œå°†å­ç»„ä»¶åŠ å…¥æ ˆï¼ˆé€†åºæ·»åŠ ä¿è¯æ­£ç¡®é¡ºåºï¼‰
            if (current.component instanceof Folder) {
                Folder folder = (Folder) current.component;
                for (int i = folder.getChildCount() - 1; i >= 0; i--) {
                    stack.push(new ComponentWithDepth(
                        folder.getChild(i), 
                        current.depth + 1
                    ));
                }
            }
        }
    }
    
    // è¾…åŠ©ç±»ï¼šç»„ä»¶å’Œæ·±åº¦çš„ç»„åˆ
    private static class ComponentWithDepth {
        FileSystemComponent component;
        int depth;
        
        ComponentWithDepth(FileSystemComponent component, int depth) {
            this.component = component;
            this.depth = depth;
        }
    }
    
    private static void displayComponent(FileSystemComponent component, int depth) {
        StringBuilder indent = new StringBuilder();
        for (int i = 0; i < depth; i++) {
            indent.append("  ");
        }
        
        String icon = component instanceof File ? "ğŸ“„" : "ğŸ“";
        String suffix = component instanceof Folder ? "/" : " (" + component.getSize() + " bytes)";
        System.out.println(indent + icon + " " + component.name + suffix);
    }
}
```

### 4.3 ç¼“å­˜ä¼˜åŒ–é¿å…é‡å¤è®¡ç®—


```java
// å¸¦ç¼“å­˜çš„æ–‡ä»¶ç³»ç»Ÿç»„ä»¶
public abstract class CachedFileSystemComponent extends FileSystemComponent {
    private Long cachedSize = null;  // ç¼“å­˜æ–‡ä»¶å¤§å°
    private boolean sizeDirty = true;  // å¤§å°æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—
    
    public CachedFileSystemComponent(String name) {
        super(name);
    }
    
    @Override
    public long getSize() {
        if (sizeDirty || cachedSize == null) {
            cachedSize = calculateSize();
            sizeDirty = false;
        }
        return cachedSize;
    }
    
    // å­ç±»å®ç°å…·ä½“çš„å¤§å°è®¡ç®—é€»è¾‘
    protected abstract long calculateSize();
    
    // å½“ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ ‡è®°ç¼“å­˜ä¸ºè„
    protected void markSizeDirty() {
        sizeDirty = true;
        cachedSize = null;
    }
}

// ä¼˜åŒ–çš„æ–‡ä»¶å¤¹å®ç°
public class CachedFolder extends CachedFileSystemComponent {
    private List<FileSystemComponent> children;
    
    public CachedFolder(String name) {
        super(name);
        this.children = new ArrayList<>();
    }
    
    @Override
    public void add(FileSystemComponent component) {
        children.add(component);
        markSizeDirty();  // æ·»åŠ å­ç»„ä»¶åæ ‡è®°ç¼“å­˜å¤±æ•ˆ
    }
    
    @Override
    public void remove(FileSystemComponent component) {
        children.remove(component);
        markSizeDirty();  // åˆ é™¤å­ç»„ä»¶åæ ‡è®°ç¼“å­˜å¤±æ•ˆ
    }
    
    @Override
    protected long calculateSize() {
        long totalSize = 0;
        for (FileSystemComponent child : children) {
            totalSize += child.getSize();
        }
        return totalSize;
    }
    
    // å…¶ä»–æ–¹æ³•å®ç°...
}
```

### 4.4 æ‰¹é‡æ“ä½œä¼˜åŒ–


```java
// æ‰¹é‡æ“ä½œçš„æ–‡ä»¶ç³»ç»Ÿç®¡ç†å™¨
public class BatchFileSystemManager {
    
    // æ‰¹é‡æ·»åŠ æ–‡ä»¶ï¼Œå‡å°‘ç¼“å­˜å¤±æ•ˆæ¬¡æ•°
    public static void addFiles(Folder parent, List<FileSystemComponent> files) {
        // æš‚åœç¼“å­˜æ›´æ–°
        if (parent instanceof CachedFolder) {
            CachedFolder cachedParent = (CachedFolder) parent;
            cachedParent.setBatchMode(true);
        }
        
        // æ‰¹é‡æ·»åŠ 
        for (FileSystemComponent file : files) {
            parent.add(file);
        }
        
        // æ¢å¤ç¼“å­˜æ›´æ–°
        if (parent instanceof CachedFolder) {
            CachedFolder cachedParent = (CachedFolder) parent;
            cachedParent.setBatchMode(false);
            cachedParent.markSizeDirty();  // æœ€åç»Ÿä¸€æ ‡è®°å¤±æ•ˆ
        }
    }
    
    // å¹¶è¡Œè®¡ç®—å¤§æ–‡ä»¶å¤¹çš„å¤§å°
    public static long getParallelSize(FileSystemComponent root) {
        if (root instanceof File) {
            return root.getSize();
        }
        
        if (root instanceof Folder) {
            Folder folder = (Folder) root;
            return folder.getChildren().parallelStream()
                    .mapToLong(FileSystemManager::getParallelSize)
                    .sum();
        }
        
        return 0;
    }
}
```

---

## 5. ğŸ—ï¸ å®é™…é¡¹ç›®é›†æˆ


### 5.1 Spring Booté¡¹ç›®ä¸­çš„åº”ç”¨


åœ¨å®é™…çš„Spring Booté¡¹ç›®ä¸­ï¼Œç»„åˆæ¨¡å¼ç»å¸¸ç”¨äºæ„å»º**èœå•ç³»ç»Ÿ**ã€**æƒé™ç®¡ç†**ç­‰åœºæ™¯ã€‚

```java
// èœå•ç»„ä»¶æ¥å£
@Component
public abstract class MenuComponent {
    protected String id;
    protected String name;
    protected String icon;
    protected String url;
    
    public MenuComponent(String id, String name, String icon, String url) {
        this.id = id;
        this.name = name;
        this.icon = icon;
        this.url = url;
    }
    
    // è½¬æ¢ä¸ºå‰ç«¯éœ€è¦çš„JSONæ ¼å¼
    public abstract Map<String, Object> toJson();
    
    // æƒé™æ£€æŸ¥
    public abstract boolean hasPermission(String userId);
    
    // å®¹å™¨ç‰¹æœ‰æ–¹æ³•
    public void addChild(MenuComponent child) {
        throw new UnsupportedOperationException("å¶å­èœå•ä¸æ”¯æŒæ·»åŠ å­èœå•");
    }
    
    public List<MenuComponent> getChildren() {
        throw new UnsupportedOperationException("å¶å­èœå•æ²¡æœ‰å­èœå•");
    }
}

// èœå•é¡¹å®ç°ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
@Component
public class MenuItem extends MenuComponent {
    private String permission;
    
    public MenuItem(String id, String name, String icon, String url, String permission) {
        super(id, name, icon, url);
        this.permission = permission;
    }
    
    @Override
    public Map<String, Object> toJson() {
        Map<String, Object> json = new HashMap<>();
        json.put("id", id);
        json.put("name", name);
        json.put("icon", icon);
        json.put("url", url);
        json.put("type", "item");
        return json;
    }
    
    @Override
    public boolean hasPermission(String userId) {
        // è°ƒç”¨æƒé™æœåŠ¡æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™
        return PermissionService.checkPermission(userId, permission);
    }
}

// èœå•ç»„å®ç°ï¼ˆå®¹å™¨èŠ‚ç‚¹ï¼‰
@Component
public class MenuGroup extends MenuComponent {
    private List<MenuComponent> children;
    
    public MenuGroup(String id, String name, String icon) {
        super(id, name, icon, null);
        this.children = new ArrayList<>();
    }
    
    @Override
    public void addChild(MenuComponent child) {
        children.add(child);
    }
    
    @Override
    public List<MenuComponent> getChildren() {
        return new ArrayList<>(children);
    }
    
    @Override
    public Map<String, Object> toJson() {
        Map<String, Object> json = new HashMap<>();
        json.put("id", id);
        json.put("name", name);
        json.put("icon", icon);
        json.put("type", "group");
        
        // é€’å½’æ„å»ºå­èœå•JSON
        List<Map<String, Object>> childrenJson = new ArrayList<>();
        for (MenuComponent child : children) {
            if (child.hasPermission(getCurrentUserId())) {
                childrenJson.add(child.toJson());
            }
        }
        json.put("children", childrenJson);
        
        return json;
    }
    
    @Override
    public boolean hasPermission(String userId) {
        // èœå•ç»„åªè¦æœ‰ä¸€ä¸ªå­èœå•æœ‰æƒé™å°±æ˜¾ç¤º
        return children.stream().anyMatch(child -> child.hasPermission(userId));
    }
    
    private String getCurrentUserId() {
        // ä»Spring Securityè·å–å½“å‰ç”¨æˆ·ID
        return SecurityContextHolder.getContext().getAuthentication().getName();
    }
}
```

### 5.2 RESTful APIæ§åˆ¶å™¨


```java
@RestController
@RequestMapping("/api/menu")
public class MenuController {
    
    @Autowired
    private MenuService menuService;
    
    // è·å–ç”¨æˆ·èœå•
    @GetMapping("/user")
    public ResponseEntity<Map<String, Object>> getUserMenu() {
        String userId = getCurrentUserId();
        MenuComponent rootMenu = menuService.buildUserMenu(userId);
        
        return ResponseEntity.ok(rootMenu.toJson());
    }
    
    // è·å–å®Œæ•´èœå•ç»“æ„ï¼ˆç®¡ç†å‘˜ç”¨ï¼‰
    @GetMapping("/admin/all")
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<Map<String, Object>> getAllMenus() {
        MenuComponent rootMenu = menuService.buildCompleteMenu();
        
        return ResponseEntity.ok(rootMenu.toJson());
    }
}

@Service
public class MenuService {
    
    public MenuComponent buildUserMenu(String userId) {
        // æ„å»ºç³»ç»Ÿä¸»èœå•
        MenuGroup root = new MenuGroup("root", "ç³»ç»Ÿèœå•", "menu");
        
        // ç”¨æˆ·ç®¡ç†æ¨¡å—
        MenuGroup userMgmt = new MenuGroup("user", "ç”¨æˆ·ç®¡ç†", "users");
        userMgmt.addChild(new MenuItem("user-list", "ç”¨æˆ·åˆ—è¡¨", "list", "/user/list", "USER_VIEW"));
        userMgmt.addChild(new MenuItem("user-add", "æ·»åŠ ç”¨æˆ·", "plus", "/user/add", "USER_ADD"));
        
        // ç³»ç»Ÿè®¾ç½®æ¨¡å—
        MenuGroup systemMgmt = new MenuGroup("system", "ç³»ç»Ÿè®¾ç½®", "settings");
        systemMgmt.addChild(new MenuItem("config", "ç³»ç»Ÿé…ç½®", "config", "/system/config", "SYSTEM_CONFIG"));
        systemMgmt.addChild(new MenuItem("logs", "ç³»ç»Ÿæ—¥å¿—", "file-text", "/system/logs", "SYSTEM_LOGS"));
        
        // åªæ·»åŠ ç”¨æˆ·æœ‰æƒé™çš„èœå•ç»„
        if (userMgmt.hasPermission(userId)) {
            root.addChild(userMgmt);
        }
        if (systemMgmt.hasPermission(userId)) {
            root.addChild(systemMgmt);
        }
        
        return root;
    }
}
```

### 5.3 å‰ç«¯Vue.jsé›†æˆ


```javascript
// å‰ç«¯èœå•ç»„ä»¶
export default {
  name: 'DynamicMenu',
  data() {
    return {
      menuData: null
    }
  },
  
  async mounted() {
    // ä»åç«¯è·å–èœå•æ•°æ®
    const response = await this.$http.get('/api/menu/user');
    this.menuData = response.data;
  },
  
  methods: {
    // é€’å½’æ¸²æŸ“èœå•
    renderMenu(menuItem) {
      if (menuItem.type === 'item') {
        return (
          <el-menu-item 
            key={menuItem.id} 
            index={menuItem.url}
            onClick={() => this.$router.push(menuItem.url)}
          >
            <i class={`icon-${menuItem.icon}`}></i>
            <span>{menuItem.name}</span>
          </el-menu-item>
        );
      } else {
        return (
          <el-submenu key={menuItem.id} index={menuItem.id}>
            <template slot="title">
              <i class={`icon-${menuItem.icon}`}></i>
              <span>{menuItem.name}</span>
            </template>
            {menuItem.children.map(child => this.renderMenu(child))}
          </el-submenu>
        );
      }
    }
  },
  
  render() {
    if (!this.menuData) {
      return <div>åŠ è½½ä¸­...</div>;
    }
    
    return (
      <el-menu default-active="/" mode="vertical">
        {this.menuData.children.map(item => this.renderMenu(item))}
      </el-menu>
    );
  }
}
```

### 5.4 æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡


```java
// èœå•ç»Ÿè®¡å·¥å…·
@Component
public class MenuStatsCollector {
    
    // ç»Ÿè®¡èœå•ä½¿ç”¨æƒ…å†µ
    public MenuStats collectMenuStats(MenuComponent root, String userId) {
        MenuStats stats = new MenuStats();
        collectStatsRecursive(root, userId, stats);
        return stats;
    }
    
    private void collectStatsRecursive(MenuComponent menu, String userId, MenuStats stats) {
        stats.totalMenus++;
        
        if (menu.hasPermission(userId)) {
            stats.visibleMenus++;
            
            if (menu instanceof MenuItem) {
                stats.accessibleItems++;
            } else if (menu instanceof MenuGroup) {
                stats.accessibleGroups++;
                
                for (MenuComponent child : menu.getChildren()) {
                    collectStatsRecursive(child, userId, stats);
                }
            }
        }
    }
    
    // ç”Ÿæˆèœå•æ ‘çš„æ–‡æœ¬è¡¨ç¤ºï¼ˆè°ƒè¯•ç”¨ï¼‰
    public String generateMenuTree(MenuComponent root) {
        StringBuilder sb = new StringBuilder();
        generateTreeRecursive(root, sb, "", true);
        return sb.toString();
    }
    
    private void generateTreeRecursive(MenuComponent menu, StringBuilder sb, 
                                     String prefix, boolean isLast) {
        String icon = menu instanceof MenuItem ? "ğŸ“„" : "ğŸ“";
        String connector = isLast ? "â””â”€â”€ " : "â”œâ”€â”€ ";
        sb.append(prefix).append(connector).append(icon).append(" ").append(menu.name).append("\n");
        
        if (menu instanceof MenuGroup) {
            MenuGroup group = (MenuGroup) menu;
            String childPrefix = prefix + (isLast ? "    " : "â”‚   ");
            
            List<MenuComponent> children = group.getChildren();
            for (int i = 0; i < children.size(); i++) {
                boolean isLastChild = (i == children.size() - 1);
                generateTreeRecursive(children.get(i), sb, childPrefix, isLastChild);
            }
        }
    }
}

// ç»Ÿè®¡æ•°æ®ç±»
public class MenuStats {
    public int totalMenus = 0;
    public int visibleMenus = 0;
    public int accessibleItems = 0;
    public int accessibleGroups = 0;
    
    @Override
    public String toString() {
        return String.format(
            "èœå•ç»Ÿè®¡: æ€»æ•°=%d, å¯è§=%d, å¯è®¿é—®èœå•é¡¹=%d, å¯è®¿é—®èœå•ç»„=%d",
            totalMenus, visibleMenus, accessibleItems, accessibleGroups
        );
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 ç»„åˆæ¨¡å¼çš„å®æˆ˜è¦ç‚¹


**ğŸ¯ è®¾è®¡åŸåˆ™**
```
ç»Ÿä¸€æ¥å£ï¼šå¶å­å’Œå®¹å™¨ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•
é€’å½’ç»“æ„ï¼šå®¹å™¨å¯ä»¥åŒ…å«å¶å­æˆ–å…¶ä»–å®¹å™¨
é€æ˜æ€§ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦åŒºåˆ†å¶å­è¿˜æ˜¯å®¹å™¨
å®‰å…¨æ€§ï¼šå¶å­èŠ‚ç‚¹å¯¹å®¹å™¨æ“ä½œæŠ›å‡ºå¼‚å¸¸
```

**âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
ç¼“å­˜æœºåˆ¶ï¼šé¿å…é‡å¤è®¡ç®—
è¿­ä»£æ›¿ä»£ï¼šé˜²æ­¢æ·±é€’å½’æ ˆæº¢å‡º
æ‰¹é‡æ“ä½œï¼šå‡å°‘é¢‘ç¹çš„ç¼“å­˜å¤±æ•ˆ
å¹¶è¡Œå¤„ç†ï¼šåˆ©ç”¨å¤šæ ¸CPUè®¡ç®—å¤§æ ‘
```

### 6.2 å®é™…åº”ç”¨æ€»ç»“


| åº”ç”¨åœºæ™¯ | **å¶å­èŠ‚ç‚¹** | **å®¹å™¨èŠ‚ç‚¹** | **æ ¸å¿ƒä»·å€¼** |
|---------|-------------|-------------|-------------|
| ğŸ—‚ï¸ **æ–‡ä»¶ç³»ç»Ÿ** | `æ–‡ä»¶` | `æ–‡ä»¶å¤¹` | `ç»Ÿä¸€çš„æ“ä½œæ¥å£` |
| ğŸ¨ **GUIç»„ä»¶** | `æŒ‰é’®ã€æ–‡æœ¬æ¡†` | `é¢æ¿ã€çª—å£` | `é€’å½’çš„äº‹ä»¶å¤„ç†` |
| ğŸ“‹ **èœå•ç³»ç»Ÿ** | `èœå•é¡¹` | `èœå•ç»„` | `æƒé™æ§åˆ¶çš„é€æ˜æ€§` |
| ğŸ¢ **ç»„ç»‡æ¶æ„** | `å‘˜å·¥` | `éƒ¨é—¨` | `å±‚çº§å…³ç³»çš„ç»Ÿä¸€ç®¡ç†` |

### 6.3 ä»£ç å®æˆ˜ç»éªŒ


**âœ… æœ€ä½³å®è·µ**
- ğŸ”¸ ä½¿ç”¨æŠ½è±¡åŸºç±»æä¾›é»˜è®¤å®ç°
- ğŸ”¸ å®¹å™¨æ“ä½œåœ¨å¶å­èŠ‚ç‚¹æŠ›å‡ºå¼‚å¸¸
- ğŸ”¸ é€’å½’æ–¹æ³•è¦è€ƒè™‘æ·±åº¦é™åˆ¶
- ğŸ”¸ å¤§æ ‘ç»“æ„è¦è€ƒè™‘æ€§èƒ½ä¼˜åŒ–
- ğŸ”¸ ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯è®¾è®¡æ¥å£

**âŒ å¸¸è§é™·é˜±**
- ğŸš¨ å¿˜è®°å¤„ç†ç©ºå¼•ç”¨å¯¼è‡´NullPointerException
- ğŸš¨ é€’å½’è¿‡æ·±å¯¼è‡´StackOverflowError
- ğŸš¨ æ²¡æœ‰è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜
- ğŸš¨ ç¼“å­˜ç­–ç•¥ä¸å½“å¯¼è‡´å†…å­˜æ³„æ¼
- ğŸš¨ æ¥å£è®¾è®¡è¿‡äºå¤æ‚è¿èƒŒé€æ˜æ€§åŸåˆ™

### 6.4 å­¦ä¹ è®°å¿†è¦ç‚¹


**ğŸ§  æ ¸å¿ƒè®°å¿†**
```
ç»„åˆæ¨¡å¼åƒæ–‡ä»¶å¤¹ï¼š
- æ–‡ä»¶å¤¹èƒ½åŒ…å«æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹
- æ“ä½œæ–‡ä»¶å¤¹å°±åƒæ“ä½œå•ä¸ªæ–‡ä»¶ä¸€æ ·
- é€’å½’å¤„ç†æ˜¯æ ¸å¿ƒæ€æƒ³
- ç»Ÿä¸€æ¥å£æ˜¯å…³é”®è®¾è®¡
```

**ğŸ“ å¿«é€Ÿåˆ¤æ–­ä½¿ç”¨åœºæ™¯**
```
ä»€ä¹ˆæ—¶å€™ç”¨ç»„åˆæ¨¡å¼ï¼Ÿ
âœ… éœ€è¦è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"å±‚æ¬¡ç»“æ„
âœ… å¸Œæœ›ç”¨æˆ·å¿½ç•¥å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„å·®å¼‚
âœ… éœ€è¦é€’å½’å¤„ç†æ ‘å½¢ç»“æ„
âœ… è¦ç»Ÿä¸€å¤„ç†å¶å­èŠ‚ç‚¹å’Œå®¹å™¨èŠ‚ç‚¹
```

**æ ¸å¿ƒè¦è¯€**ï¼šç»„åˆæ¨¡å¼å°±æ˜¯**æŠŠå¤æ‚çš„æ ‘å½¢ç»“æ„ç®€å•åŒ–**ï¼Œè®©ä½ **ç”¨æ“ä½œå•ä¸ªå¯¹è±¡çš„æ–¹å¼æ¥æ“ä½œæ•´æ£µæ ‘**ï¼Œå…³é”®åœ¨äº**é€’å½’å’Œç»Ÿä¸€æ¥å£**ï¼