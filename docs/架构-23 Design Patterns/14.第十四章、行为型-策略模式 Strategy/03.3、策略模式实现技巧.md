---
title: 3ã€ç­–ç•¥æ¨¡å¼å®ç°æŠ€å·§
---
## ğŸ“š ç›®å½•

1. [ç­–ç•¥æ³¨å†Œæœºåˆ¶](#1-ç­–ç•¥æ³¨å†Œæœºåˆ¶)
2. [å·¥å‚æ¨¡å¼ç»“åˆ](#2-å·¥å‚æ¨¡å¼ç»“åˆ)
3. [æ³¨è§£é©±åŠ¨ç­–ç•¥](#3-æ³¨è§£é©±åŠ¨ç­–ç•¥)
4. [é…ç½®åŒ–ç­–ç•¥é€‰æ‹©](#4-é…ç½®åŒ–ç­–ç•¥é€‰æ‹©)
5. [ç­–ç•¥ç¼“å­˜ä¼˜åŒ–](#5-ç­–ç•¥ç¼“å­˜ä¼˜åŒ–)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç­–ç•¥æ³¨å†Œæœºåˆ¶


### 1.1 ä»€ä¹ˆæ˜¯ç­–ç•¥æ³¨å†Œæœºåˆ¶


**ğŸ’¡ é€šä¿—ç†è§£**
> æƒ³è±¡ä½ åœ¨é¤å…ç‚¹èœï¼ŒæœåŠ¡å‘˜ä¼šæ ¹æ®ä½ çš„è¦æ±‚ä»èœå•ä¸Šæ‰¾åˆ°å¯¹åº”çš„èœå“ã€‚ç­–ç•¥æ³¨å†Œæœºåˆ¶å°±åƒæ˜¯ä¸€ä¸ª"ç­–ç•¥èœå•"ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶æŠŠæ‰€æœ‰å¯ç”¨çš„ç­–ç•¥éƒ½"ç™»è®°"åœ¨å†Œï¼Œéœ€è¦æ—¶ç›´æ¥æŒ‰åå­—æŸ¥æ‰¾ä½¿ç”¨ã€‚

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
ç­–ç•¥æ³¨å†Œæœºåˆ¶ = ç­–ç•¥ä»“åº“ + è‡ªåŠ¨å‘ç° + æŒ‰éœ€è°ƒç”¨

ä¼ ç»Ÿæ–¹å¼ï¼šif-else ç¡¬ç¼–ç é€‰æ‹©ç­–ç•¥
æ³¨å†Œæœºåˆ¶ï¼šåŠ¨æ€æ³¨å†Œã€ç»Ÿä¸€ç®¡ç†ã€çµæ´»è°ƒç”¨
```

### 1.2 æ³¨å†Œæœºåˆ¶çš„åŸºæœ¬åŸç†


**ğŸ—ï¸ å·¥ä½œæµç¨‹**
```
åº”ç”¨å¯åŠ¨
    â†“
æ‰«ææ‰€æœ‰ç­–ç•¥ç±»
    â†“
æŒ‰ç­–ç•¥æ ‡è¯†æ³¨å†Œåˆ°Mapä¸­
    â†“
ä¸šåŠ¡è°ƒç”¨æ—¶æŒ‰æ ‡è¯†è·å–
    â†“
æ‰§è¡Œå…·ä½“ç­–ç•¥
```

**ğŸ“‹ åŸºæœ¬å®ç°**
```java
// ç­–ç•¥æ³¨å†Œå™¨ - ç›¸å½“äºç­–ç•¥ç®¡ç†å‘˜
public class StrategyRegistry {
    // ç­–ç•¥ä»“åº“ï¼škeyæ˜¯ç­–ç•¥åç§°ï¼Œvalueæ˜¯ç­–ç•¥å¯¹è±¡
    private Map<String, PaymentStrategy> strategies = new HashMap<>();
    
    // æ³¨å†Œç­–ç•¥ - æŠŠç­–ç•¥æ”¾åˆ°ä»“åº“é‡Œ
    public void register(String name, PaymentStrategy strategy) {
        strategies.put(name, strategy);
    }
    
    // è·å–ç­–ç•¥ - ä»ä»“åº“é‡Œå–å‡ºç­–ç•¥
    public PaymentStrategy getStrategy(String name) {
        return strategies.get(name);
    }
}
```

### 1.3 Springæ¡†æ¶ä¸­çš„è‡ªåŠ¨æ³¨å†Œ


**ğŸŒŸ Springçš„ä¾¿åˆ©ä¹‹å¤„**
> Springæ¡†æ¶å°±åƒä¸€ä¸ªèªæ˜çš„ç®¡å®¶ï¼Œå®ƒä¼šè‡ªåŠ¨å‘ç°ä½ å†™çš„ç­–ç•¥ç±»ï¼Œå¹¶å¸®ä½ å®Œæˆæ³¨å†Œï¼Œä½ åªéœ€è¦æ‰“ä¸ªæ ‡è®°å°±è¡Œäº†ã€‚

```java
// 1. æ ‡è®°ç­–ç•¥ç»„ä»¶
@Component("alipay")  // è¿™å°±æ˜¯ç»™ç­–ç•¥èµ·ä¸ªåå­—
public class AlipayStrategy implements PaymentStrategy {
    // æ”¯ä»˜å®æ”¯ä»˜é€»è¾‘
}

@Component("wechat")  // å¾®ä¿¡ç­–ç•¥çš„åå­—
public class WechatStrategy implements PaymentStrategy {
    // å¾®ä¿¡æ”¯ä»˜é€»è¾‘
}

// 2. è‡ªåŠ¨æ”¶é›†æ‰€æœ‰ç­–ç•¥
@Service
public class PaymentService {
    // Springä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰PaymentStrategyçš„å®ç°ç±»è£…è¿›è¿™ä¸ªMap
    // Mapçš„keyå°±æ˜¯@Componentæ³¨è§£çš„value
    @Autowired
    private Map<String, PaymentStrategy> strategyMap;
    
    public void pay(String type, double amount) {
        PaymentStrategy strategy = strategyMap.get(type);
        strategy.pay(amount);
    }
}
```

### 1.4 æ³¨å†Œæœºåˆ¶çš„ä¼˜åŠ¿


| **ä¼˜åŠ¿** | **ä¼ ç»Ÿif-else** | **æ³¨å†Œæœºåˆ¶** |
|---------|-----------------|-------------|
| **å¯æ‰©å±•æ€§** | ğŸ”´ æ¯æ–°å¢ç­–ç•¥éƒ½è¦æ”¹ä»£ç  | ğŸŸ¢ æ–°å¢ç­–ç•¥æ— éœ€æ”¹åŸä»£ç  |
| **ç»´æŠ¤æ€§** | ğŸ”´ ç­–ç•¥æ•£è½å„å¤„ï¼Œéš¾ä»¥ç®¡ç† | ğŸŸ¢ ç»Ÿä¸€ç®¡ç†ï¼Œæ¸…æ™°æ˜äº† |
| **æµ‹è¯•æ€§** | ğŸ”´ æµ‹è¯•éœ€è¦è¦†ç›–æ‰€æœ‰åˆ†æ”¯ | ğŸŸ¢ æ¯ä¸ªç­–ç•¥ç‹¬ç«‹æµ‹è¯• |
| **æ€§èƒ½** | ğŸŸ¡ æ¯æ¬¡éƒ½è¦æ‰§è¡Œåˆ¤æ–­é€»è¾‘ | ğŸŸ¢ ç›´æ¥MapæŸ¥æ‰¾ï¼Œå¿«é€Ÿå®šä½ |

---

## 2. ğŸ­ å·¥å‚æ¨¡å¼ç»“åˆ


### 2.1 ä¸ºä»€ä¹ˆè¦ç»“åˆå·¥å‚æ¨¡å¼


**ğŸ¤” æ€è€ƒåœºæ™¯**
> ä½ å¼€äº†ä¸€å®¶æ±½è½¦ä¿®ç†å‚ï¼Œå®¢æˆ·æ¥ä¿®è½¦æ—¶ï¼Œä½ éœ€è¦ï¼š
> 1. å…ˆåˆ¤æ–­æ˜¯ä»€ä¹ˆè½¦å‹ï¼ˆç­–ç•¥é€‰æ‹©ï¼‰
> 2. æ‰¾åˆ°å¯¹åº”çš„ä¿®ç†å¸ˆå‚…ï¼ˆç­–ç•¥åˆ›å»ºï¼‰
> 3. è®©å¸ˆå‚…å¼€å§‹ä¿®è½¦ï¼ˆç­–ç•¥æ‰§è¡Œï¼‰
> 
> å·¥å‚æ¨¡å¼å°±æ˜¯è´Ÿè´£ç¬¬2æ­¥çš„"äººäº‹ç»ç†"ï¼Œä¸“é—¨ç®¡ç†å„ç§å¸ˆå‚…çš„åˆ†é…ã€‚

**ğŸ’¡ æ ¸å¿ƒä»·å€¼**
```
ç­–ç•¥æ¨¡å¼ï¼šè§£å†³"åšä»€ä¹ˆ"çš„é—®é¢˜
å·¥å‚æ¨¡å¼ï¼šè§£å†³"æ€ä¹ˆåˆ›å»º"çš„é—®é¢˜
ä¸¤è€…ç»“åˆï¼šæ—¢çµæ´»é€‰æ‹©ï¼Œåˆä¾¿äºç®¡ç†
```

### 2.2 ç®€å•å·¥å‚ + ç­–ç•¥æ¨¡å¼


```java
// ç­–ç•¥å·¥å‚ - ä¸“é—¨è´Ÿè´£åˆ›å»ºç­–ç•¥å¯¹è±¡
public class PaymentStrategyFactory {
    
    public static PaymentStrategy createStrategy(String paymentType) {
        switch (paymentType.toLowerCase()) {
            case "alipay":
                return new AlipayStrategy();
            case "wechat":
                return new WechatStrategy();
            case "bank":
                return new BankCardStrategy();
            default:
                throw new IllegalArgumentException("ä¸æ”¯æŒçš„æ”¯ä»˜æ–¹å¼: " + paymentType);
        }
    }
}

// æ”¯ä»˜æœåŠ¡ - ä½¿ç”¨å·¥å‚åˆ›å»ºç­–ç•¥
public class PaymentService {
    
    public void processPayment(String paymentType, double amount) {
        // é€šè¿‡å·¥å‚è·å–ç­–ç•¥
        PaymentStrategy strategy = PaymentStrategyFactory.createStrategy(paymentType);
        
        // æ‰§è¡Œæ”¯ä»˜
        strategy.pay(amount);
    }
}
```

### 2.3 æŠ½è±¡å·¥å‚ + ç­–ç•¥æ—


**ğŸ¯ é€‚ç”¨åœºæ™¯**
> å½“ä½ çš„ç­–ç•¥ä¸æ˜¯å•ä¸€çš„ï¼Œè€Œæ˜¯æˆå¥—çš„ã€‚æ¯”å¦‚æ”¯ä»˜ä¸ä»…æœ‰æ”¯ä»˜ç­–ç•¥ï¼Œè¿˜æœ‰é€€æ¬¾ç­–ç•¥ã€æŸ¥è¯¢ç­–ç•¥ç­‰ã€‚

```java
// æ”¯ä»˜ç­–ç•¥æ—çš„æŠ½è±¡å·¥å‚
public interface PaymentFactory {
    PaymentStrategy createPaymentStrategy();      // æ”¯ä»˜ç­–ç•¥
    RefundStrategy createRefundStrategy();        // é€€æ¬¾ç­–ç•¥
    QueryStrategy createQueryStrategy();          // æŸ¥è¯¢ç­–ç•¥
}

// æ”¯ä»˜å®ç­–ç•¥æ—å·¥å‚
public class AlipayFactory implements PaymentFactory {
    public PaymentStrategy createPaymentStrategy() {
        return new AlipayPaymentStrategy();
    }
    
    public RefundStrategy createRefundStrategy() {
        return new AlipayRefundStrategy();
    }
    
    public QueryStrategy createQueryStrategy() {
        return new AlipayQueryStrategy();
    }
}
```

### 2.4 å·¥å‚æ³¨å†Œå™¨æ¨¡å¼


**âš¡ æœ€ä½³å®è·µç»„åˆ**
> æŠŠå·¥å‚ä¹Ÿæ³¨å†Œèµ·æ¥ï¼Œå®ç°åŒé‡çµæ´»æ€§

```java
// å·¥å‚æ³¨å†Œå™¨
public class FactoryRegistry {
    private Map<String, PaymentFactory> factories = new HashMap<>();
    
    // æ³¨å†Œå·¥å‚
    public void registerFactory(String type, PaymentFactory factory) {
        factories.put(type, factory);
    }
    
    // è·å–ç­–ç•¥ï¼ˆé€šè¿‡å·¥å‚ï¼‰
    public PaymentStrategy getPaymentStrategy(String type) {
        PaymentFactory factory = factories.get(type);
        return factory != null ? factory.createPaymentStrategy() : null;
    }
}
```

---

## 3. ğŸ·ï¸ æ³¨è§£é©±åŠ¨ç­–ç•¥


### 3.1 æ³¨è§£é©±åŠ¨çš„æ ¸å¿ƒæ€æƒ³


**ğŸ’­ ä¸ºä»€ä¹ˆç”¨æ³¨è§£**
> ä¼ ç»Ÿæ–¹å¼åƒæ˜¯åœ¨æ¯ä¸ªç­–ç•¥ç±»é‡Œå†™è¯´æ˜ä¹¦ï¼Œå‘Šè¯‰åˆ«äºº"æˆ‘æ˜¯è°"ã€"æˆ‘èƒ½å¹²ä»€ä¹ˆ"ã€‚æ³¨è§£é©±åŠ¨å°±åƒç»™æ¯ä¸ªç­–ç•¥è´´ä¸ªæ ‡ç­¾ï¼Œç³»ç»Ÿä¸€æ‰«æå°±çŸ¥é“è¿™ä¸ªç­–ç•¥çš„æ‰€æœ‰ä¿¡æ¯ã€‚

**ğŸ”¸ æ³¨è§£çš„ä¼˜åŠ¿**
```
å£°æ˜å¼ç¼–ç¨‹ï¼šç”¨æ ‡ç­¾è¯´æ˜æ„å›¾ï¼Œè€Œä¸æ˜¯å†™ä»£ç é€»è¾‘
å…ƒæ•°æ®é©±åŠ¨ï¼šæŠŠé…ç½®ä¿¡æ¯å†™åœ¨ä»£ç æ—è¾¹ï¼Œä¾¿äºç»´æŠ¤
è‡ªåŠ¨å‘ç°ï¼šæ¡†æ¶å¯ä»¥è‡ªåŠ¨æ‰«æå¹¶å¤„ç†å¸¦æ³¨è§£çš„ç±»
```

### 3.2 è‡ªå®šä¹‰ç­–ç•¥æ³¨è§£


```java
// è‡ªå®šä¹‰ç­–ç•¥æ³¨è§£
@Target(ElementType.TYPE)  // ç”¨åœ¨ç±»ä¸Š
@Retention(RetentionPolicy.RUNTIME)  // è¿è¡Œæ—¶å¯ç”¨
public @interface PaymentStrategy {
    String value();           // ç­–ç•¥åç§°
    String description() default "";  // ç­–ç•¥æè¿°
    int priority() default 0; // ç­–ç•¥ä¼˜å…ˆçº§
}

// ä½¿ç”¨æ³¨è§£æ ‡è®°ç­–ç•¥
@PaymentStrategy(value = "alipay", description = "æ”¯ä»˜å®æ”¯ä»˜", priority = 1)
@Component
public class AlipayPaymentImpl implements Payment {
    public void pay(double amount) {
        System.out.println("ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜: " + amount);
    }
}

@PaymentStrategy(value = "wechat", description = "å¾®ä¿¡æ”¯ä»˜", priority = 2)
@Component
public class WechatPaymentImpl implements Payment {
    public void pay(double amount) {
        System.out.println("ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜: " + amount);
    }
}
```

### 3.3 æ³¨è§£å¤„ç†å™¨


```java
// ç­–ç•¥æ‰«æå™¨ - è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œå¸¦æ³¨è§£çš„ç­–ç•¥
@Component
public class StrategyScanner implements ApplicationContextAware {
    
    private Map<String, Payment> strategyMap = new HashMap<>();
    
    @Override
    public void setApplicationContext(ApplicationContext context) {
        // æ‰«ææ‰€æœ‰å¸¦@PaymentStrategyæ³¨è§£çš„Bean
        Map<String, Object> beans = context.getBeansWithAnnotation(PaymentStrategy.class);
        
        for (Object bean : beans.values()) {
            PaymentStrategy annotation = bean.getClass().getAnnotation(PaymentStrategy.class);
            String strategyName = annotation.value();
            
            // æ³¨å†Œç­–ç•¥
            strategyMap.put(strategyName, (Payment) bean);
        }
    }
    
    public Payment getStrategy(String name) {
        return strategyMap.get(name);
    }
}
```

### 3.4 æ¡ä»¶åŒ–ç­–ç•¥æ³¨è§£


**ğŸ¯ é«˜çº§ç”¨æ³•**
> æ ¹æ®ä¸åŒæ¡ä»¶è‡ªåŠ¨é€‰æ‹©ç­–ç•¥ï¼Œè®©ç³»ç»Ÿæ›´æ™ºèƒ½

```java
// æ¡ä»¶ç­–ç•¥æ³¨è§£
@PaymentStrategy("smart_pay")
@ConditionalOnProperty(name = "payment.smart.enabled", havingValue = "true")
public class SmartPaymentStrategy implements Payment {
    // æ™ºèƒ½æ”¯ä»˜ç­–ç•¥ï¼Œåªæœ‰åœ¨é…ç½®å¼€å¯æ—¶æ‰ç”Ÿæ•ˆ
}

// ç¯å¢ƒç›¸å…³çš„ç­–ç•¥
@PaymentStrategy("test_pay")
@Profile("test")  // åªåœ¨æµ‹è¯•ç¯å¢ƒç”Ÿæ•ˆ
public class TestPaymentStrategy implements Payment {
    // æµ‹è¯•ä¸“ç”¨çš„æ”¯ä»˜ç­–ç•¥
}
```

---

## 4. âš™ï¸ é…ç½®åŒ–ç­–ç•¥é€‰æ‹©


### 4.1 é…ç½®åŒ–çš„åŸºæœ¬æ¦‚å¿µ


**ğŸŒŸ ä»€ä¹ˆæ˜¯é…ç½®åŒ–ç­–ç•¥**
> æƒ³è±¡ä½ å®¶é‡Œæœ‰ä¸ªä¸‡èƒ½é¥æ§å™¨ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ¥æ§åˆ¶ä¸åŒçš„å®¶ç”µã€‚é…ç½®åŒ–ç­–ç•¥å°±æ˜¯ç»™ä½ çš„ç¨‹åºè£…ä¸ª"ä¸‡èƒ½é¥æ§å™¨"ï¼Œé€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶å°±èƒ½æ”¹å˜ç¨‹åºçš„è¡Œä¸ºï¼Œä¸ç”¨é‡æ–°ç¼–å†™ä»£ç ã€‚

**ğŸ“Š é…ç½®åŒ–çš„å±‚æ¬¡**
```
é™æ€é…ç½®ï¼šå†™åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œç¨‹åºå¯åŠ¨æ—¶è¯»å–
åŠ¨æ€é…ç½®ï¼šå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶ä¿®æ”¹ï¼Œç«‹å³ç”Ÿæ•ˆ
æ™ºèƒ½é…ç½®ï¼šæ ¹æ®ç¯å¢ƒæˆ–æ¡ä»¶è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥
```

### 4.2 åŸºäºé…ç½®æ–‡ä»¶çš„ç­–ç•¥é€‰æ‹©


**ğŸ“ YAMLé…ç½®ç¤ºä¾‹**
```yaml
# application.yml
payment:
  default-strategy: "alipay"
  strategies:
    alipay:
      enabled: true
      priority: 1
      config:
        app-id: "your_app_id"
        private-key: "your_private_key"
    wechat:
      enabled: true
      priority: 2
      config:
        app-id: "your_wechat_app_id"
        merchant-id: "your_merchant_id"
```

**ğŸ”§ é…ç½®è¯»å–å™¨**
```java
// ç­–ç•¥é…ç½®ç±»
@ConfigurationProperties(prefix = "payment")
@Component
public class PaymentConfig {
    private String defaultStrategy;
    private Map<String, StrategyConfig> strategies;
    
    // getterå’Œsetter...
    
    public static class StrategyConfig {
        private boolean enabled;
        private int priority;
        private Map<String, String> config;
        // getterå’Œsetter...
    }
}

// é…ç½®åŒ–ç­–ç•¥é€‰æ‹©å™¨
@Service
public class ConfigurablePaymentService {
    
    @Autowired
    private PaymentConfig paymentConfig;
    
    @Autowired
    private Map<String, Payment> paymentStrategies;
    
    public void pay(double amount) {
        // æ ¹æ®é…ç½®é€‰æ‹©ç­–ç•¥
        String strategyName = paymentConfig.getDefaultStrategy();
        Payment strategy = paymentStrategies.get(strategyName);
        
        if (strategy != null) {
            strategy.pay(amount);
        }
    }
}
```

### 4.3 åŠ¨æ€é…ç½®æ›´æ–°


**âš¡ å®æ—¶é…ç½®å˜æ›´**
> è®©ä½ çš„ç¨‹åºåƒæ™ºèƒ½éŸ³ç®±ä¸€æ ·ï¼Œå¯ä»¥éšæ—¶æ¥æ”¶æ–°æŒ‡ä»¤å¹¶æ”¹å˜è¡Œä¸º

```java
// é…ç½®ç›‘å¬å™¨
@Component
public class PaymentConfigListener {
    
    @Autowired
    private PaymentService paymentService;
    
    // ç›‘å¬é…ç½®å˜åŒ–
    @EventListener
    public void onConfigChanged(ConfigChangeEvent event) {
        if (event.getKey().startsWith("payment.")) {
            // é‡æ–°åŠ è½½æ”¯ä»˜ç­–ç•¥é…ç½®
            paymentService.reloadStrategies();
            System.out.println("æ”¯ä»˜ç­–ç•¥é…ç½®å·²æ›´æ–°");
        }
    }
}
```

### 4.4 è§„åˆ™å¼•æ“ç»“åˆ


**ğŸ§  æ™ºèƒ½ç­–ç•¥é€‰æ‹©**
```java
// ç­–ç•¥é€‰æ‹©è§„åˆ™
public class PaymentRuleEngine {
    
    public String selectStrategy(PaymentContext context) {
        double amount = context.getAmount();
        String userLevel = context.getUserLevel();
        
        // æ ¹æ®é‡‘é¢å’Œç”¨æˆ·ç­‰çº§é€‰æ‹©ç­–ç•¥
        if (amount > 1000 && "VIP".equals(userLevel)) {
            return "priority_pay";  // VIPå¤§é¢ä¼˜å…ˆæ”¯ä»˜
        } else if (amount < 100) {
            return "quick_pay";     // å°é¢å¿«é€Ÿæ”¯ä»˜
        } else {
            return "standard_pay";  // æ ‡å‡†æ”¯ä»˜
        }
    }
}
```

---

## 5. âš¡ ç­–ç•¥ç¼“å­˜ä¼˜åŒ–


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ç­–ç•¥ç¼“å­˜


**ğŸ’¡ ç¼“å­˜çš„å¿…è¦æ€§**
> æƒ³è±¡ä½ æ˜¯ä¸ªå›¾ä¹¦ç®¡ç†å‘˜ï¼Œå¦‚æœæ¯æ¬¡æœ‰äººå€Ÿä¹¦éƒ½è¦å»ä»“åº“æ‰¾ï¼Œä¼šå¾ˆæ…¢ã€‚èªæ˜çš„åšæ³•æ˜¯æŠŠå¸¸å€Ÿçš„ä¹¦æ”¾åœ¨å‰å°ï¼Œè¿™æ ·æ‹¿å–å°±å¾ˆå¿«ã€‚ç­–ç•¥ç¼“å­˜å°±æ˜¯æŠŠå¸¸ç”¨çš„ç­–ç•¥å¯¹è±¡"æ”¾åœ¨å‰å°"ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚

**ğŸ“ˆ æ€§èƒ½å¯¹æ¯”**
```
æ— ç¼“å­˜ï¼šæ¯æ¬¡éƒ½è¦ åˆ›å»ºå¯¹è±¡ â†’ åˆå§‹åŒ– â†’ æ‰§è¡Œ â†’ é”€æ¯
æœ‰ç¼“å­˜ï¼šé¦–æ¬¡åˆ›å»ºåï¼Œç›´æ¥ è·å– â†’ æ‰§è¡Œ

æ€§èƒ½æå‡ï¼š10å€ä»¥ä¸Šï¼ˆå–å†³äºç­–ç•¥åˆ›å»ºå¤æ‚åº¦ï¼‰
```

### 5.2 ç®€å•ç­–ç•¥ç¼“å­˜


```java
// ç­–ç•¥ç¼“å­˜ç®¡ç†å™¨
public class StrategyCacheManager {
    
    // ç¼“å­˜å®¹å™¨ - ç”¨ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨
    private final Map<String, PaymentStrategy> cache = new ConcurrentHashMap<>();
    
    // è·å–ç­–ç•¥ï¼ˆå¸¦ç¼“å­˜ï¼‰
    public PaymentStrategy getStrategy(String strategyType) {
        return cache.computeIfAbsent(strategyType, this::createStrategy);
    }
    
    // åˆ›å»ºç­–ç•¥çš„å…·ä½“é€»è¾‘
    private PaymentStrategy createStrategy(String type) {
        switch (type) {
            case "alipay":
                System.out.println("åˆ›å»ºæ”¯ä»˜å®ç­–ç•¥å¯¹è±¡"); // æ¨¡æ‹Ÿåˆ›å»ºè¿‡ç¨‹
                return new AlipayStrategy();
            case "wechat":
                System.out.println("åˆ›å»ºå¾®ä¿¡ç­–ç•¥å¯¹è±¡");
                return new WechatStrategy();
            default:
                throw new IllegalArgumentException("æœªçŸ¥ç­–ç•¥: " + type);
        }
    }
    
    // æ¸…é™¤ç¼“å­˜
    public void clearCache() {
        cache.clear();
    }
}
```

### 5.3 LRUç¼“å­˜ç­–ç•¥


**ğŸ”„ æœ€è¿‘æœ€å°‘ä½¿ç”¨ç¼“å­˜**
> å½“ç¼“å­˜æ»¡äº†ï¼Œä¼˜å…ˆæ·˜æ±°æœ€ä¹…æ²¡ç”¨çš„ç­–ç•¥å¯¹è±¡

```java
// LRUç­–ç•¥ç¼“å­˜
public class LRUStrategyCache {
    
    private final int maxSize;
    private final LinkedHashMap<String, PaymentStrategy> cache;
    
    public LRUStrategyCache(int maxSize) {
        this.maxSize = maxSize;
        // LinkedHashMapçš„ç‰¹æ®Šæ„é€ ï¼Œæ”¯æŒLRU
        this.cache = new LinkedHashMap<String, PaymentStrategy>(16, 0.75f, true) {
            @Override
            protected boolean removeEldestEntry(Map.Entry<String, PaymentStrategy> eldest) {
                return size() > LRUStrategyCache.this.maxSize;
            }
        };
    }
    
    public synchronized PaymentStrategy getStrategy(String type) {
        PaymentStrategy strategy = cache.get(type);
        if (strategy == null) {
            strategy = createStrategy(type);
            cache.put(type, strategy);
        }
        return strategy;
    }
}
```

### 5.4 Springç¼“å­˜é›†æˆ


**ğŸŒŸ ä½¿ç”¨Spring Cache**
```java
@Service
@CacheConfig(cacheNames = "paymentStrategies")
public class CachedPaymentService {
    
    // è‡ªåŠ¨ç¼“å­˜ç­–ç•¥å¯¹è±¡
    @Cacheable(key = "#strategyType")
    public PaymentStrategy getStrategy(String strategyType) {
        System.out.println("ä»æ•°æ®åº“æˆ–å·¥å‚åˆ›å»ºç­–ç•¥: " + strategyType);
        return createExpensiveStrategy(strategyType);
    }
    
    // æ¸…é™¤æŒ‡å®šç­–ç•¥çš„ç¼“å­˜
    @CacheEvict(key = "#strategyType")
    public void removeStrategy(String strategyType) {
        System.out.println("æ¸…é™¤ç­–ç•¥ç¼“å­˜: " + strategyType);
    }
    
    // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
    @CacheEvict(allEntries = true)
    public void clearAllStrategies() {
        System.out.println("æ¸…é™¤æ‰€æœ‰ç­–ç•¥ç¼“å­˜");
    }
}
```

### 5.5 ç¼“å­˜ç­–ç•¥çš„é€‰æ‹©


| **ç¼“å­˜ç±»å‹** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-------------|-------------|----------|----------|
| **HashMapç¼“å­˜** | ç­–ç•¥æ•°é‡å°‘ï¼Œæ°¸ä¸è¿‡æœŸ | ğŸŸ¢ ç®€å•å¿«é€Ÿ | ğŸ”´ å†…å­˜å¯èƒ½æº¢å‡º |
| **LRUç¼“å­˜** | ç­–ç•¥è¾ƒå¤šï¼Œæœ‰å†·çƒ­åŒºåˆ« | ğŸŸ¢ è‡ªåŠ¨æ·˜æ±°ï¼Œæ§åˆ¶å†…å­˜ | ğŸŸ¡ å®ç°ç›¸å¯¹å¤æ‚ |
| **å®šæ—¶è¿‡æœŸç¼“å­˜** | ç­–ç•¥æœ‰æ—¶æ•ˆæ€§ | ğŸŸ¢ è‡ªåŠ¨æ¸…ç†è¿‡æœŸå¯¹è±¡ | ğŸŸ¡ éœ€è¦é¢å¤–å®šæ—¶ä»»åŠ¡ |
| **å¼±å¼•ç”¨ç¼“å­˜** | å†…å­˜æ•æ„Ÿåº”ç”¨ | ğŸŸ¢ JVMè‡ªåŠ¨å›æ”¶ | ğŸ”´ å¯èƒ½é¢‘ç¹é‡å»º |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæŠ€å·§


```
ğŸ”¸ ç­–ç•¥æ³¨å†Œï¼šæŠŠç­–ç•¥ç»Ÿä¸€ç®¡ç†ï¼Œåƒé€šè®¯å½•ä¸€æ ·æŒ‰åæŸ¥æ‰¾
ğŸ”¸ å·¥å‚ç»“åˆï¼šè®©ç­–ç•¥åˆ›å»ºæ›´çµæ´»ï¼ŒèŒè´£æ›´æ¸…æ™°
ğŸ”¸ æ³¨è§£é©±åŠ¨ï¼šç”¨æ ‡ç­¾ç®€åŒ–é…ç½®ï¼Œè®©ä»£ç æ›´ä¼˜é›…
ğŸ”¸ é…ç½®åŒ–é€‰æ‹©ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶ç­–ç•¥ï¼Œçµæ´»åˆ‡æ¢
ğŸ”¸ ç¼“å­˜ä¼˜åŒ–ï¼šé¿å…é‡å¤åˆ›å»ºï¼Œæå‡ç³»ç»Ÿæ€§èƒ½
```

### 6.2 æŠ€å·§é€‰æ‹©æŒ‡å—


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨ä»€ä¹ˆæŠ€å·§**

```
é¡¹ç›®åˆæœŸ/ç®€å•åœºæ™¯ï¼š
â†’ ç­–ç•¥æ³¨å†Œæœºåˆ¶ + ç®€å•å·¥å‚

ä¸­ç­‰å¤æ‚åº¦é¡¹ç›®ï¼š
â†’ æ³¨è§£é©±åŠ¨ + Springè‡ªåŠ¨æ³¨å†Œ

å¤§å‹ä¼ä¸šé¡¹ç›®ï¼š
â†’ é…ç½®åŒ–ç­–ç•¥ + ç¼“å­˜ä¼˜åŒ– + å·¥å‚æ¨¡å¼

é«˜æ€§èƒ½è¦æ±‚ï¼š
â†’ å¿…é¡»åŠ å…¥ç¼“å­˜ä¼˜åŒ–

éœ€è¦è¿è¡Œæ—¶åˆ‡æ¢ï¼š
â†’ é…ç½®åŒ–ç­–ç•¥é€‰æ‹©

ç­–ç•¥æ—å¾ˆå¤æ‚ï¼š
â†’ æŠ½è±¡å·¥å‚ + ç­–ç•¥æ¨¡å¼
```

### 6.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**
- ä¼˜å…ˆä½¿ç”¨Springçš„è‡ªåŠ¨æ³¨å†Œï¼Œå‡å°‘æ‰‹å·¥ç¼–ç 
- ç­–ç•¥æ¥å£è¦ç®€æ´ï¼Œå•ä¸€èŒè´£
- å–„ç”¨ç¼“å­˜ï¼Œä½†è¦æ³¨æ„å†…å­˜ç®¡ç†
- é…ç½®è¦æœ‰é»˜è®¤å€¼ï¼Œå¢å¼ºç³»ç»Ÿå¥å£®æ€§

**âš ï¸ å¸¸è§é™·é˜±**
- ä¸è¦ä¸ºäº†ç”¨è®¾è®¡æ¨¡å¼è€Œç”¨ï¼Œç®€å•åœºæ™¯ç›´æ¥if-elseå³å¯
- ç¼“å­˜ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œè¦è¯„ä¼°ç¼“å­˜æ”¶ç›Š
- æ³¨è§£ä¸è¦è¿‡åº¦è®¾è®¡ï¼Œä¿æŒç®€å•æ˜äº†
- é…ç½®é¡¹ä¸è¦è¿‡å¤šï¼Œå½±å“ç»´æŠ¤æ€§

### 6.4 è¿›é˜¶å­¦ä¹ è·¯å¾„


```
ğŸ“š å­¦ä¹ è·¯çº¿ï¼š
åŸºç¡€é˜¶æ®µï¼šæŒæ¡åŸºæœ¬çš„ç­–ç•¥æ³¨å†Œå’Œå·¥å‚ç»“åˆ
è¿›é˜¶é˜¶æ®µï¼šå­¦ä¼šæ³¨è§£é©±åŠ¨å’Œé…ç½®åŒ–é€‰æ‹©
é«˜çº§é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥
ä¸“å®¶é˜¶æ®µï¼šä¸å…¶ä»–è®¾è®¡æ¨¡å¼çš„ç»„åˆè¿ç”¨

â±ï¸ é¢„æœŸæ—¶é—´ï¼š
ç†è§£æ¦‚å¿µï¼š1-2å¤©
åŠ¨æ‰‹å®è·µï¼š3-5å¤©
ç†Ÿç»ƒè¿ç”¨ï¼š2-3å‘¨
èä¼šè´¯é€šï¼šæŒç»­å®è·µ
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†**
> ç­–ç•¥æ¨¡å¼çš„å®ç°æŠ€å·§å°±åƒè£…ä¿®æˆ¿å­çš„å·¥å…·ç®±ï¼š
> - æ³¨å†Œæœºåˆ¶æ˜¯å·¥å…·æ¶ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰
> - å·¥å‚æ¨¡å¼æ˜¯åˆ¶é€ æœºï¼ˆä¸“ä¸šåˆ›å»ºï¼‰  
> - æ³¨è§£é©±åŠ¨æ˜¯æ™ºèƒ½æ ‡ç­¾ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰
> - é…ç½®åŒ–æ˜¯é¥æ§å™¨ï¼ˆçµæ´»æ§åˆ¶ï¼‰
> - ç¼“å­˜ä¼˜åŒ–æ˜¯å·¥å…·æŸœï¼ˆå¿«é€Ÿå–ç”¨ï¼‰
> 
> æ ¹æ®é¡¹ç›®éœ€è¦ï¼Œçµæ´»ç»„åˆä½¿ç”¨è¿™äº›"å·¥å…·"ï¼