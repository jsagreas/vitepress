---
title: 5ã€è®¿é—®è€…æ¨¡å¼è®¾è®¡è¦ç‚¹
---
## ğŸ“š ç›®å½•

1. [è®¿é—®è€…æ¨¡å¼æ ¸å¿ƒç†å¿µ](#1-è®¿é—®è€…æ¨¡å¼æ ¸å¿ƒç†å¿µ)
2. [å…ƒç´ ç»“æ„ç¨³å®šæ€§è®¾è®¡](#2-å…ƒç´ ç»“æ„ç¨³å®šæ€§è®¾è®¡)
3. [è®¿é—®è€…æ‰©å±•æœºåˆ¶](#3-è®¿é—®è€…æ‰©å±•æœºåˆ¶)
4. [å¾ªç¯ä¾èµ–å¤„ç†ç­–ç•¥](#4-å¾ªç¯ä¾èµ–å¤„ç†ç­–ç•¥)
5. [å¼‚å¸¸å¤„ç†ç­–ç•¥](#5-å¼‚å¸¸å¤„ç†ç­–ç•¥)
6. [å¹¶å‘è®¿é—®æ§åˆ¶](#6-å¹¶å‘è®¿é—®æ§åˆ¶)
7. [å®é™…åº”ç”¨æŒ‡å¯¼](#7-å®é™…åº”ç”¨æŒ‡å¯¼)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è®¿é—®è€…æ¨¡å¼æ ¸å¿ƒç†å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è®¿é—®è€…æ¨¡å¼


ğŸ¤” **å…ˆæƒ³æƒ³è¿™ä¸ªåœºæ™¯**ï¼šä½ æ˜¯ä¸€ä¸ªå¯¼æ¸¸ï¼Œå¸¦ç€ä¸åŒçš„æ¸¸å®¢ï¼ˆæ‘„å½±å¸ˆã€å†å²å­¦å®¶ã€å»ºç­‘å¸ˆï¼‰å‚è§‚åŒä¸€ä¸ªå¤å»ºç­‘ç¾¤ã€‚æ¯ç§æ¸¸å®¢å…³æ³¨çš„ç‚¹ä¸åŒï¼š
- **æ‘„å½±å¸ˆ**ï¼šå…³æ³¨å…‰çº¿ã€è§’åº¦ã€æ„å›¾
- **å†å²å­¦å®¶**ï¼šå…³æ³¨å¹´ä»£ã€èƒŒæ™¯ã€æ•…äº‹
- **å»ºç­‘å¸ˆ**ï¼šå…³æ³¨ç»“æ„ã€ææ–™ã€å·¥è‰º

å¤å»ºç­‘ç¾¤æœ¬èº«ä¸å˜ï¼Œä½†ä¸åŒçš„"è®¿é—®è€…"æœ‰ä¸åŒçš„"çœ‹æ³•"å’Œ"æ“ä½œ"ã€‚

ğŸ’¡ **è®¿é—®è€…æ¨¡å¼å°±æ˜¯è¿™ä¸ªé“ç†**ï¼š
```
å…ƒç´ ç»“æ„ï¼ˆå¤å»ºç­‘ï¼‰= æ•°æ®ç»“æ„ä¿æŒç¨³å®š
è®¿é—®è€…ï¼ˆæ¸¸å®¢ç±»å‹ï¼‰= å¯¹æ•°æ®çš„ä¸åŒæ“ä½œ
```

### 1.2 æ ¸å¿ƒæ€æƒ³è§£è¯»


**ğŸ”¸ åˆ†ç¦»å…³æ³¨ç‚¹**
```
æ•°æ®ç»“æ„ â†â†’ æ“ä½œé€»è¾‘
   ç¨³å®šçš„      å¯å˜çš„
   
ä¼ ç»Ÿåšæ³•ï¼šæŠŠæ“ä½œå†™åœ¨æ•°æ®ç±»é‡Œ
è®¿é—®è€…æ¨¡å¼ï¼šæŠŠæ“ä½œæå–åˆ°è®¿é—®è€…ç±»é‡Œ
```

**ğŸ”¸ å¼€é—­åŸåˆ™ä½“ç°**
- **å¯¹ä¿®æ”¹å…³é—­**ï¼šä¸ä¿®æ”¹ç°æœ‰å…ƒç´ ç±»
- **å¯¹æ‰©å±•å¼€æ”¾**ï¼šæ–°å¢è®¿é—®è€…ç±»å®ç°æ–°æ“ä½œ

**ğŸŒ° ä¸¾ä¸ªå…·ä½“ä¾‹å­**ï¼š
```
è´­ç‰©è½¦ç³»ç»Ÿï¼š
- å•†å“ç±»ï¼ˆå…ƒç´ ï¼‰ï¼šä¹¦ç±ã€ç”µå­äº§å“ã€æœè£…
- æ“ä½œç±»ï¼ˆè®¿é—®è€…ï¼‰ï¼šä»·æ ¼è®¡ç®—ã€åº“å­˜æ£€æŸ¥ã€ä¿ƒé”€å¤„ç†

æ–°å¢ä¸€ä¸ª"ç¨è´¹è®¡ç®—"åŠŸèƒ½ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šä¿®æ”¹æ¯ä¸ªå•†å“ç±»ï¼ŒåŠ å…¥ç¨è´¹è®¡ç®—æ–¹æ³•
è®¿é—®è€…æ–¹å¼ï¼šæ–°å¢ä¸€ä¸ªç¨è´¹è®¡ç®—è®¿é—®è€…ï¼Œä¸åŠ¨å•†å“ç±»
```

---

## 2. ğŸ—ï¸ å…ƒç´ ç»“æ„ç¨³å®šæ€§è®¾è®¡


### 2.1 ä¸ºä»€ä¹ˆè¦ä¿æŒå…ƒç´ ç»“æ„ç¨³å®š


ğŸ“ **æ ¸å¿ƒç†å¿µ**ï¼šè®¿é—®è€…æ¨¡å¼çš„å‰ææ˜¯**å…ƒç´ ç»“æ„ç›¸å¯¹ç¨³å®š**

**ğŸ“Š ç¨³å®šæ€§å¯¹æ¯”**ï¼š

| åœºæ™¯ç±»å‹ | **ç¨³å®šç¨‹åº¦** | **æ˜¯å¦é€‚åˆè®¿é—®è€…æ¨¡å¼** | **ä¸¾ä¾‹** |
|---------|-------------|---------------------|---------|
| **æ–‡æ¡£è§£æ** | `æç¨³å®š` | `âœ… éå¸¸é€‚åˆ` | `HTMLæ ‡ç­¾ã€ASTèŠ‚ç‚¹` |
| **ç¼–è¯‘å™¨** | `ç¨³å®š` | `âœ… é€‚åˆ` | `è¯­æ³•æ ‘èŠ‚ç‚¹ç±»å‹` |
| **æ¸¸æˆè§’è‰²** | `ä¸­ç­‰ç¨³å®š` | `âš ï¸ è°¨æ…ä½¿ç”¨` | `ç©å®¶ã€NPCã€æ€ªç‰©` |
| **ç”µå•†å•†å“** | `ä¸ç¨³å®š` | `âŒ ä¸é€‚åˆ` | `å•†å“ç±»å‹é¢‘ç¹å˜åŒ–` |

### 2.2 è®¾è®¡ç¨³å®šå…ƒç´ ç»“æ„çš„åŸåˆ™


**ğŸ”¸ æŠ½è±¡å±‚æ¬¡è¦åˆé€‚**
```
å¤ªå…·ä½“ï¼šBookElement, MagazineElement, NewspaperElement
åˆé€‚ï¼š  PrintedMaterialElement
å¤ªæŠ½è±¡ï¼šMaterialElement
```

**ğŸ”¸ èŒè´£å•ä¸€ä¸”æ¸…æ™°**
```java
// âœ… å¥½çš„è®¾è®¡ï¼šèŒè´£æ¸…æ™°
abstract class DocumentElement {
    abstract void accept(DocumentVisitor visitor);
    // åªåŒ…å«ç»“æ„æ€§ä¿¡æ¯ï¼Œä¸åŒ…å«æ“ä½œé€»è¾‘
}

// âŒ ä¸å¥½çš„è®¾è®¡ï¼šèŒè´£æ··ä¹±
abstract class DocumentElement {
    abstract void accept(DocumentVisitor visitor);
    abstract void calculateSize();  // è¿™åº”è¯¥åœ¨è®¿é—®è€…é‡Œ
    abstract void export();         // è¿™åº”è¯¥åœ¨è®¿é—®è€…é‡Œ
}
```

### 2.3 ä¿æŒç¨³å®šæ€§çš„å®è·µç­–ç•¥


**ğŸ“‹ è®¾è®¡æ£€æŸ¥æ¸…å•**ï¼š
- âœ… å…ƒç´ ç±»å‹æ˜¯å¦åœ¨å¯é¢„è§çš„æœªæ¥åŸºæœ¬ç¡®å®šï¼Ÿ
- âœ… æ–°å¢æ“ä½œçš„é¢‘ç‡æ˜¯å¦è¿œé«˜äºæ–°å¢å…ƒç´ ç±»å‹ï¼Ÿ
- âœ… å…ƒç´ ä¹‹é—´çš„å…³ç³»æ˜¯å¦ç¨³å®šï¼Ÿ
- âœ… æ˜¯å¦æœ‰æ˜ç¡®çš„å…ƒç´ å±‚æ¬¡ç»“æ„ï¼Ÿ

**ğŸ› ï¸ ç¨³å®šæ€§ä¿éšœæªæ–½**ï¼š
```java
// 1. ä½¿ç”¨æ¥å£éš”ç¦»
interface Visitable {
    void accept(Visitor visitor);
}

// 2. æœ€å°åŒ–å…ƒç´ æ¥å£
interface Element extends Visitable {
    String getName();      // åªæš´éœ²å¿…è¦ä¿¡æ¯
    ElementType getType(); // ç±»å‹æ ‡è¯†
}

// 3. ç‰ˆæœ¬åŒ–ç®¡ç†
interface ElementV1 extends Element {
    // ç¬¬ä¸€ç‰ˆå…ƒç´ æ¥å£
}
```

---

## 3. ğŸ”§ è®¿é—®è€…æ‰©å±•æœºåˆ¶


### 3.1 æ‰©å±•æœºåˆ¶çš„è®¾è®¡åŸç†


ğŸ’­ **æ€è€ƒä¸€ä¸‹**ï¼šä¸ºä»€ä¹ˆè®¿é—®è€…æ¨¡å¼è¢«ç§°ä¸º"è¡Œä¸ºæ‰©å±•ç¥å™¨"ï¼Ÿ

**æ ¸å¿ƒæœºåˆ¶**ï¼š
```
æ–°åŠŸèƒ½ = æ–°è®¿é—®è€…ç±»
ä¸æ”¹åŠ¨åŸæœ‰ä»£ç  = ç¬¦åˆå¼€é—­åŸåˆ™
```

### 3.2 æ ‡å‡†æ‰©å±•æ¨¡å¼


**ğŸ”¸ åŸºç¡€è®¿é—®è€…æ¥å£**
```java
interface Visitor {
    void visit(ConcreteElementA element);
    void visit(ConcreteElementB element);
    void visit(ConcreteElementC element);
}
```

**ğŸ”¸ åŠŸèƒ½æ‰©å±•ç¤ºä¾‹**
```java
// åœºæ™¯ï¼šä¸ºæ–‡æ¡£ç³»ç»Ÿæ·»åŠ ä¸åŒçš„å¯¼å‡ºåŠŸèƒ½

// åŸæœ‰çš„å¯¼å‡ºè®¿é—®è€…
class PDFExportVisitor implements Visitor {
    public void visit(TextElement element) {
        // PDFå¯¼å‡ºæ–‡æœ¬çš„é€»è¾‘
    }
    
    public void visit(ImageElement element) {
        // PDFå¯¼å‡ºå›¾ç‰‡çš„é€»è¾‘  
    }
}

// æ–°å¢çš„HTMLå¯¼å‡ºè®¿é—®è€…
class HTMLExportVisitor implements Visitor {
    public void visit(TextElement element) {
        // HTMLå¯¼å‡ºæ–‡æœ¬çš„é€»è¾‘
    }
    
    public void visit(ImageElement element) {
        // HTMLå¯¼å‡ºå›¾ç‰‡çš„é€»è¾‘
    }
}

// å†æ–°å¢Wordå¯¼å‡ºè®¿é—®è€…
class WordExportVisitor implements Visitor {
    // å®ç°å„ç§å…ƒç´ çš„Wordå¯¼å‡º...
}
```

### 3.3 é«˜çº§æ‰©å±•æŠ€å·§


**ğŸ¯ å‚æ•°åŒ–è®¿é—®è€…**
```java
// é€šç”¨çš„æ ¼å¼åŒ–è®¿é—®è€…ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼
class FormatterVisitor implements Visitor {
    private FormatterStrategy strategy;
    
    public FormatterVisitor(FormatterStrategy strategy) {
        this.strategy = strategy;
    }
    
    public void visit(TextElement element) {
        strategy.formatText(element.getText());
    }
}

// ä½¿ç”¨æ–¹å¼
Visitor pdfFormatter = new FormatterVisitor(new PDFStrategy());
Visitor htmlFormatter = new FormatterVisitor(new HTMLStrategy());
```

**ğŸ”— ç»„åˆè®¿é—®è€…æ¨¡å¼**
```java
class CompositeVisitor implements Visitor {
    private List<Visitor> visitors = new ArrayList<>();
    
    public void addVisitor(Visitor visitor) {
        visitors.add(visitor);
    }
    
    public void visit(TextElement element) {
        for (Visitor visitor : visitors) {
            visitor.visit(element);
        }
    }
}

// åŒæ—¶è¿›è¡Œç»Ÿè®¡å’Œå¯¼å‡º
CompositeVisitor composite = new CompositeVisitor();
composite.addVisitor(new StatisticsVisitor());
composite.addVisitor(new PDFExportVisitor());
```

### 3.4 æ‰©å±•æ—¶çš„æ³¨æ„äº‹é¡¹


**âš ï¸ æ¥å£æ¼”åŒ–é—®é¢˜**
```java
// é—®é¢˜ï¼šå½“æ·»åŠ æ–°å…ƒç´ ç±»å‹æ—¶ï¼Œæ‰€æœ‰è®¿é—®è€…éƒ½è¦ä¿®æ”¹
interface Visitor {
    void visit(ElementA element);
    void visit(ElementB element);
    // æ–°å¢ElementCæ—¶ï¼Œæ‰€æœ‰å®ç°ç±»éƒ½è¦æ”¹åŠ¨
    void visit(ElementC element); // è¿™ä¼šç ´åå·²æœ‰ä»£ç 
}

// è§£å†³æ–¹æ¡ˆï¼šé»˜è®¤æ–¹æ³•
interface Visitor {
    void visit(ElementA element);
    void visit(ElementB element);
    
    // æ–°å¢å…ƒç´ ç”¨é»˜è®¤æ–¹æ³•ï¼Œä¸ç ´åå…¼å®¹æ€§
    default void visit(ElementC element) {
        // é»˜è®¤å¤„ç†æˆ–æŠ›å‡ºæœªå®ç°å¼‚å¸¸
        throw new UnsupportedOperationException("ElementC not supported");
    }
}
```

---

## 4. âš¡ å¾ªç¯ä¾èµ–å¤„ç†ç­–ç•¥


### 4.1 å¾ªç¯ä¾èµ–äº§ç”Ÿçš„åŸå› 


ğŸ¤” **ä¸ºä»€ä¹ˆä¼šæœ‰å¾ªç¯ä¾èµ–**ï¼Ÿ

**å…¸å‹åœºæ™¯**ï¼š
```
æ–‡ä»¶ç³»ç»Ÿï¼š
æ–‡ä»¶å¤¹ â†’ åŒ…å«æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹
æ–‡ä»¶   â†’ å¯èƒ½å¼•ç”¨å…¶ä»–æ–‡ä»¶

è®¿é—®è¿‡ç¨‹ï¼š
è®¿é—®è€…è®¿é—®æ–‡ä»¶å¤¹ â†’ è®¿é—®å­å…ƒç´  â†’ å­æ–‡ä»¶å¤¹åˆåŒ…å«çˆ¶çº§å¼•ç”¨
```

**ğŸ”„ å¾ªç¯ä¾èµ–ç¤ºä¾‹**ï¼š
```
ç›®å½•A â†’ åŒ…å«ç›®å½•B
ç›®å½•B â†’ åŒ…å«ç›®å½•Açš„è½¯é“¾æ¥
è®¿é—®è€…éå†æ—¶ï¼šA â†’ B â†’ A â†’ B â†’ A... (æ— é™å¾ªç¯)
```

### 4.2 æ£€æµ‹å¾ªç¯ä¾èµ–


**ğŸ” è®¿é—®è·¯å¾„è·Ÿè¸ª**
```java
class CycleSafeVisitor implements Visitor {
    private Set<String> visitedElements = new HashSet<>();
    private Stack<String> currentPath = new Stack<>();
    
    public void visit(FolderElement folder) {
        String folderId = folder.getId();
        
        // æ£€æµ‹å¾ªç¯
        if (currentPath.contains(folderId)) {
            System.out.println("æ£€æµ‹åˆ°å¾ªç¯ä¾èµ–: " + currentPath + " -> " + folderId);
            return; // åœæ­¢è®¿é—®
        }
        
        // è®°å½•è®¿é—®è·¯å¾„
        currentPath.push(folderId);
        visitedElements.add(folderId);
        
        try {
            // è®¿é—®å­å…ƒç´ 
            for (Element child : folder.getChildren()) {
                child.accept(this);
            }
        } finally {
            // æ¸…ç†è·¯å¾„
            currentPath.pop();
        }
    }
}
```

### 4.3 å¾ªç¯ä¾èµ–å¤„ç†ç­–ç•¥


**ğŸ“‹ ç­–ç•¥å¯¹æ¯”è¡¨**ï¼š

| ç­–ç•¥ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|-------------|---------|---------|
| **å¿½ç•¥ç­–ç•¥** | `å·²è®¿é—®è¿‡å°±è·³è¿‡` | `ç®€å•é«˜æ•ˆ` | `å¯èƒ½é—æ¼ä¿¡æ¯` |
| **æ·±åº¦é™åˆ¶** | `é™åˆ¶è®¿é—®æ·±åº¦` | `ä¿è¯ç»ˆæ­¢` | `å¯èƒ½è®¿é—®ä¸å…¨` |
| **å¼•ç”¨è®¡æ•°** | `è·Ÿè¸ªå¼•ç”¨æ¬¡æ•°` | `ç²¾ç¡®æ§åˆ¶` | `å®ç°å¤æ‚` |
| **æ ‡è®°æ¸…é™¤** | `ç±»ä¼¼åƒåœ¾å›æ”¶` | `å®Œæ•´è®¿é—®` | `éœ€è¦å¤šè½®éå†` |

**ğŸ› ï¸ å®ç”¨çš„å¤„ç†æ–¹æ¡ˆ**ï¼š

```java
class SmartVisitor implements Visitor {
    private Map<String, Integer> visitCounts = new HashMap<>();
    private final int maxVisitCount = 3; // æœ€å¤§è®¿é—®æ¬¡æ•°
    
    public void visit(ComplexElement element) {
        String elementId = element.getId();
        int count = visitCounts.getOrDefault(elementId, 0);
        
        if (count >= maxVisitCount) {
            // è¶…è¿‡è®¿é—®æ¬¡æ•°é™åˆ¶ï¼Œè®°å½•ä½†ä¸ç»§ç»­
            logCyclicReference(elementId);
            return;
        }
        
        visitCounts.put(elementId, count + 1);
        
        // ç»§ç»­æ­£å¸¸è®¿é—®é€»è¾‘
        processElement(element);
        
        // è®¿é—®å­å…ƒç´ 
        for (Element child : element.getChildren()) {
            child.accept(this);
        }
    }
    
    private void logCyclicReference(String elementId) {
        System.out.println("å¯èƒ½çš„å¾ªç¯å¼•ç”¨: " + elementId);
    }
}
```

### 4.4 é¢„é˜²å¾ªç¯ä¾èµ–çš„è®¾è®¡


**ğŸ¯ ä»æºå¤´é¿å…**
```java
// 1. å•å‘å¼•ç”¨è®¾è®¡
class Parent {
    private List<Child> children; // åªæœ‰å‘ä¸‹å¼•ç”¨
}

class Child {
    private String parentId; // ç”¨IDå¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡å¼•ç”¨
}

// 2. åˆ†å±‚è®¾è®¡
interface LayeredElement {
    int getLayer(); // å…ƒç´ å±‚çº§ï¼Œé«˜å±‚ä¸èƒ½å¼•ç”¨ä½å±‚
}
```

---

## 5. ğŸ›¡ï¸ å¼‚å¸¸å¤„ç†ç­–ç•¥


### 5.1 è®¿é—®è€…æ¨¡å¼ä¸­çš„å¼‚å¸¸ç±»å‹


**ğŸ“Š å¸¸è§å¼‚å¸¸åˆ†ç±»**ï¼š

```
å…ƒç´ å¼‚å¸¸ï¼š
â”œâ”€â”€ å…ƒç´ çŠ¶æ€å¼‚å¸¸ï¼ˆå…ƒç´ æŸåã€ä¸å¯è®¿é—®ï¼‰
â”œâ”€â”€ å…ƒç´ ç±»å‹å¼‚å¸¸ï¼ˆæœªçŸ¥å…ƒç´ ç±»å‹ï¼‰
â””â”€â”€ å…ƒç´ æ•°æ®å¼‚å¸¸ï¼ˆæ•°æ®æ ¼å¼é”™è¯¯ï¼‰

è®¿é—®è€…å¼‚å¸¸ï¼š
â”œâ”€â”€ è®¿é—®æƒé™å¼‚å¸¸ï¼ˆæ— æƒé™è®¿é—®æŸäº›å…ƒç´ ï¼‰
â”œâ”€â”€ è®¿é—®é€»è¾‘å¼‚å¸¸ï¼ˆå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸šåŠ¡å¼‚å¸¸ï¼‰
â””â”€â”€ èµ„æºå¼‚å¸¸ï¼ˆå†…å­˜ä¸è¶³ã€æ–‡ä»¶æ— æ³•åˆ›å»ºï¼‰

ç»“æ„å¼‚å¸¸ï¼š
â”œâ”€â”€ å¾ªç¯å¼•ç”¨å¼‚å¸¸ï¼ˆä¸Šé¢è®²è¿‡çš„å¾ªç¯ä¾èµ–ï¼‰
â”œâ”€â”€ ç»“æ„ç ´åå¼‚å¸¸ï¼ˆéå†æ—¶ç»“æ„è¢«ä¿®æ”¹ï¼‰
â””â”€â”€ æ·±åº¦è¶…é™å¼‚å¸¸ï¼ˆç»“æ„åµŒå¥—è¿‡æ·±ï¼‰
```

### 5.2 å¼‚å¸¸å¤„ç†ç­–ç•¥è®¾è®¡


**ğŸ”¸ åˆ†å±‚å¼‚å¸¸å¤„ç†**
```java
class RobustVisitor implements Visitor {
    
    public void visit(FileElement file) {
        try {
            // è®¿é—®é€»è¾‘
            processFile(file);
        } catch (FileAccessException e) {
            // æ–‡ä»¶çº§å¼‚å¸¸ï¼šè®°å½•æ—¥å¿—ï¼Œç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶
            handleFileError(file, e);
        } catch (SecurityException e) {
            // å®‰å…¨å¼‚å¸¸ï¼šè®°å½•ä½†ä¸ä¸­æ–­
            handleSecurityError(file, e);
        } catch (OutOfMemoryError e) {
            // ç³»ç»Ÿçº§å¼‚å¸¸ï¼šéœ€è¦ä¸­æ–­å¤„ç†
            handleCriticalError(e);
            throw e; // é‡æ–°æŠ›å‡º
        }
    }
    
    private void handleFileError(FileElement file, Exception e) {
        logger.warn("å¤„ç†æ–‡ä»¶å¤±è´¥: {} - {}", file.getName(), e.getMessage());
        // å¯ä»¥é€‰æ‹©é‡è¯•æˆ–è·³è¿‡
    }
    
    private void handleCriticalError(Error e) {
        // æ¸…ç†èµ„æºï¼Œä¿å­˜è¿›åº¦ç­‰
        cleanup();
        notifyFailure(e);
    }
}
```

**ğŸ”¸ å¼‚å¸¸ä¼ æ’­æ§åˆ¶**
```java
class ControlledVisitor implements Visitor {
    private ErrorPolicy errorPolicy;
    private List<Exception> collectedErrors = new ArrayList<>();
    
    public enum ErrorPolicy {
        FAIL_FAST,      // é‡åˆ°å¼‚å¸¸ç«‹å³åœæ­¢
        CONTINUE,       // æ”¶é›†å¼‚å¸¸ï¼Œç»§ç»­å¤„ç†
        RETRY          // é‡è¯•æœºåˆ¶
    }
    
    public void visit(Element element) {
        try {
            element.process();
        } catch (Exception e) {
            switch (errorPolicy) {
                case FAIL_FAST:
                    throw new VisitorException("å¤„ç†å¤±è´¥", e);
                case CONTINUE:
                    collectedErrors.add(e);
                    break;
                case RETRY:
                    retryWithBackoff(element, e);
                    break;
            }
        }
    }
}
```

### 5.3 å¼‚å¸¸æ¢å¤æœºåˆ¶


**ğŸ”„ çŠ¶æ€æ¢å¤è®¾è®¡**
```java
class RecoverableVisitor implements Visitor {
    private Stack<VisitorState> stateStack = new Stack<>();
    
    public void visit(ComplexElement element) {
        // ä¿å­˜å½“å‰çŠ¶æ€
        VisitorState currentState = saveState();
        stateStack.push(currentState);
        
        try {
            processComplexElement(element);
        } catch (ProcessingException e) {
            // æ¢å¤åˆ°å¼‚å¸¸å‰çš„çŠ¶æ€
            restoreState(stateStack.pop());
            
            // å°è¯•é™çº§å¤„ç†
            processFallback(element);
        }
    }
    
    private void processFallback(ComplexElement element) {
        // ç®€åŒ–å¤„ç†é€»è¾‘ï¼Œç¡®ä¿åŸºæœ¬åŠŸèƒ½
        System.out.println("ä½¿ç”¨ç®€åŒ–æ¨¡å¼å¤„ç†: " + element.getName());
    }
}
```

### 5.4 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**ğŸ“ å®è·µæŒ‡å¯¼**ï¼š

```java
// âœ… å¥½çš„å¼‚å¸¸å¤„ç†
class WellDesignedVisitor implements Visitor {
    
    public void visit(DocumentElement doc) {
        // 1. é¢„æ£€æŸ¥
        if (!isValidDocument(doc)) {
            logWarning("æ–‡æ¡£æ ¼å¼å¼‚å¸¸ï¼Œè·³è¿‡å¤„ç†");
            return;
        }
        
        // 2. åˆ†æ®µå¤„ç†
        try {
            processHeader(doc.getHeader());
        } catch (Exception e) {
            logError("å¤´éƒ¨å¤„ç†å¤±è´¥", e);
            useDefaultHeader();
        }
        
        try {
            processContent(doc.getContent());
        } catch (Exception e) {
            logError("å†…å®¹å¤„ç†å¤±è´¥", e);
            // å†…å®¹æ˜¯æ ¸å¿ƒï¼Œå¤±è´¥å°±ä¸ç»§ç»­
            throw new VisitorException("æ ¸å¿ƒå¤„ç†å¤±è´¥", e);
        }
        
        // 3. å¯é€‰å¤„ç†
        try {
            processFooter(doc.getFooter());
        } catch (Exception e) {
            logWarning("é¡µè„šå¤„ç†å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤", e);
            useDefaultFooter();
        }
    }
}
```

---

## 6. ğŸ”’ å¹¶å‘è®¿é—®æ§åˆ¶


### 6.1 å¹¶å‘åœºæ™¯åˆ†æ


ğŸ¤” **ä»€ä¹ˆæ—¶å€™éœ€è¦è€ƒè™‘å¹¶å‘**ï¼Ÿ

**å…¸å‹å¹¶å‘åœºæ™¯**ï¼š
```
åœºæ™¯1ï¼šå¤šçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®ç»“æ„
åœºæ™¯2ï¼šè®¿é—®è¿‡ç¨‹ä¸­æ•°æ®ç»“æ„è¢«ä¿®æ”¹
åœºæ™¯3ï¼šå¤šä¸ªè®¿é—®è€…åŒæ—¶å·¥ä½œ
åœºæ™¯4ï¼šè®¿é—®è€…æœ¬èº«çš„çŠ¶æ€éœ€è¦ä¿æŠ¤
```

**ğŸŒ° å…·ä½“ä¾‹å­**ï¼š
```java
// åœºæ™¯ï¼šå¤šçº¿ç¨‹å¤„ç†å¤§å‹æ–‡æ¡£
Document document = loadLargeDocument();

// çº¿ç¨‹1ï¼šç»Ÿè®¡å­—æ•°
Thread thread1 = new Thread(() -> {
    WordCountVisitor counter = new WordCountVisitor();
    document.accept(counter);
});

// çº¿ç¨‹2ï¼šç”Ÿæˆç›®å½•
Thread thread2 = new Thread(() -> {
    TOCVisitor tocGenerator = new TOCVisitor();
    document.accept(tocGenerator);
});

// é—®é¢˜ï¼šä¸¤ä¸ªè®¿é—®è€…å¯èƒ½äº’ç›¸å¹²æ‰°
```

### 6.2 çº¿ç¨‹å®‰å…¨çš„è®¿é—®è€…è®¾è®¡


**ğŸ”¸ æ— çŠ¶æ€è®¿é—®è€…**ï¼ˆæ¨èï¼‰
```java
// âœ… çº¿ç¨‹å®‰å…¨ï¼šæ— çŠ¶æ€è®¾è®¡
class StatelessValidator implements Visitor {
    
    public void visit(TextElement element) {
        // åªåšéªŒè¯ï¼Œä¸ä¿å­˜çŠ¶æ€
        ValidationResult result = validateText(element.getText());
        
        if (!result.isValid()) {
            // ç»“æœé€šè¿‡å‚æ•°æˆ–è¿”å›å€¼ä¼ é€’
            throw new ValidationException(result.getError());
        }
    }
    
    private ValidationResult validateText(String text) {
        // çº¯å‡½æ•°ï¼Œçº¿ç¨‹å®‰å…¨
        return new ValidationResult(text != null && !text.trim().isEmpty());
    }
}
```

**ğŸ”¸ çº¿ç¨‹æœ¬åœ°çŠ¶æ€**
```java
class ThreadSafeStatefulVisitor implements Visitor {
    // ä½¿ç”¨ThreadLocalä¿è¯çº¿ç¨‹å®‰å…¨
    private ThreadLocal<VisitorContext> context = 
        ThreadLocal.withInitial(VisitorContext::new);
    
    public void visit(Element element) {
        VisitorContext ctx = context.get();
        ctx.incrementCount();
        
        processElement(element, ctx);
    }
    
    public int getProcessedCount() {
        return context.get().getCount();
    }
    
    public void cleanup() {
        context.remove(); // é˜²æ­¢å†…å­˜æ³„æ¼
    }
}
```

### 6.3 æ•°æ®ç»“æ„ä¿æŠ¤ç­–ç•¥


**ğŸ”¸ è¯»å†™åˆ†ç¦»**
```java
class ConcurrentSafeElement implements Element {
    private final ReadWriteLock lock = new ReentrantReadWriteLock();
    private volatile List<Element> children = new ArrayList<>();
    
    public void accept(Visitor visitor) {
        lock.readLock().lock();
        try {
            visitor.visit(this);
            
            // è®¿é—®å­å…ƒç´ æ—¶ä¹Ÿè¦åŠ é”
            for (Element child : children) {
                child.accept(visitor);
            }
        } finally {
            lock.readLock().unlock();
        }
    }
    
    public void addChild(Element child) {
        lock.writeLock().lock();
        try {
            List<Element> newChildren = new ArrayList<>(children);
            newChildren.add(child);
            children = newChildren; // åŸå­æ›¿æ¢
        } finally {
            lock.writeLock().unlock();
        }
    }
}
```

**ğŸ”¸ å¿«ç…§è®¿é—®æ¨¡å¼**
```java
class SnapshotVisitor implements Visitor {
    
    public void visitStructure(ComplexStructure structure) {
        // åˆ›å»ºç»“æ„å¿«ç…§ï¼Œé¿å…è®¿é—®è¿‡ç¨‹ä¸­çš„ä¿®æ”¹
        StructureSnapshot snapshot = structure.createSnapshot();
        
        // åŸºäºå¿«ç…§è¿›è¡Œè®¿é—®ï¼Œä¿è¯ä¸€è‡´æ€§
        for (Element element : snapshot.getElements()) {
            element.accept(this);
        }
    }
}
```

### 6.4 å¹¶å‘æ€§èƒ½ä¼˜åŒ–


**ğŸš€ å¹¶è¡Œè®¿é—®è®¾è®¡**
```java
class ParallelVisitor implements Visitor {
    private final ForkJoinPool pool = ForkJoinPool.commonPool();
    
    public void visit(ContainerElement container) {
        List<Element> children = container.getChildren();
        
        if (children.size() > 100) { // å¤§é›†åˆæ‰ä½¿ç”¨å¹¶è¡Œ
            children.parallelStream()
                   .forEach(child -> child.accept(this));
        } else {
            // å°é›†åˆç”¨ä¸²è¡Œï¼Œé¿å…çº¿ç¨‹å¼€é”€
            children.forEach(child -> child.accept(this));
        }
    }
}

class ForkJoinVisitor extends RecursiveAction {
    private final Element element;
    private final Visitor visitor;
    
    protected void compute() {
        if (shouldProcess(element)) {
            element.accept(visitor);
        } else {
            // åˆ†è§£ä»»åŠ¡
            List<ForkJoinVisitor> subtasks = createSubtasks();
            invokeAll(subtasks);
        }
    }
}
```

**âš¡ æ€§èƒ½ç›‘æ§**
```java
class MonitoredVisitor implements Visitor {
    private final AtomicLong visitCount = new AtomicLong();
    private final AtomicLong totalTime = new AtomicLong();
    
    public void visit(Element element) {
        long startTime = System.nanoTime();
        try {
            processElement(element);
        } finally {
            long endTime = System.nanoTime();
            visitCount.incrementAndGet();
            totalTime.addAndGet(endTime - startTime);
        }
    }
    
    public double getAverageVisitTime() {
        long count = visitCount.get();
        return count > 0 ? (double) totalTime.get() / count : 0;
    }
}
```

---

## 7. ğŸ› ï¸ å®é™…åº”ç”¨æŒ‡å¯¼


### 7.1 é€‰æ‹©è®¿é—®è€…æ¨¡å¼çš„æ—¶æœº


**ğŸ¯ é€‚ç”¨æ€§è¯„ä¼°è¡¨**ï¼š

| åˆ¤æ–­æ ‡å‡† | **é«˜é€‚ç”¨æ€§** | **ä¸­ç­‰é€‚ç”¨æ€§** | **ä¸é€‚ç”¨** |
|---------|-------------|--------------|-----------|
| **å…ƒç´ ç¨³å®šæ€§** | `å…ƒç´ ç±»å‹å¾ˆå°‘å˜åŒ–` | `å¶å°”æ–°å¢å…ƒç´ ` | `é¢‘ç¹ä¿®æ”¹å…ƒç´ ç»“æ„` |
| **æ“ä½œå˜åŒ–æ€§** | `ç»å¸¸æ–°å¢æ“ä½œ` | `æ“ä½œç›¸å¯¹ç¨³å®š` | `æ“ä½œå¾ˆå°‘å˜åŒ–` |
| **æ“ä½œå¤æ‚æ€§** | `æ“ä½œé€»è¾‘å¤æ‚` | `æ“ä½œä¸­ç­‰å¤æ‚` | `æ“ä½œéå¸¸ç®€å•` |
| **æ€§èƒ½è¦æ±‚** | `å¯¹æ‰©å±•æ€§è¦æ±‚é«˜` | `æ€§èƒ½è¦æ±‚ä¸€èˆ¬` | `å¯¹æ€§èƒ½è¦æ±‚æé«˜` |

### 7.2 å®é™…é¡¹ç›®åº”ç”¨æ¡ˆä¾‹


**ğŸ“Š ç¼–è¯‘å™¨è¯­æ³•æ ‘å¤„ç†**
```java
// æŠ½è±¡è¯­æ³•æ ‘èŠ‚ç‚¹
abstract class ASTNode {
    abstract void accept(ASTVisitor visitor);
}

class BinaryOpNode extends ASTNode {
    void accept(ASTVisitor visitor) {
        visitor.visit(this);
    }
}

// ä¸åŒçš„ç¼–è¯‘é˜¶æ®µç”¨ä¸åŒè®¿é—®è€…
class TypeCheckVisitor implements ASTVisitor {
    // ç±»å‹æ£€æŸ¥é€»è¾‘
}

class CodeGenVisitor implements ASTVisitor {
    // ä»£ç ç”Ÿæˆé€»è¾‘  
}

class OptimizationVisitor implements ASTVisitor {
    // ä»£ç ä¼˜åŒ–é€»è¾‘
}
```

**ğŸ® æ¸¸æˆå¯¹è±¡å¤„ç†ç³»ç»Ÿ**
```java
// æ¸¸æˆå¯¹è±¡
abstract class GameObject {
    abstract void accept(GameVisitor visitor);
}

// ä¸åŒçš„æ¸¸æˆç³»ç»Ÿç”¨ä¸åŒè®¿é—®è€…
class RenderVisitor implements GameVisitor {
    // æ¸²æŸ“é€»è¾‘
}

class PhysicsVisitor implements GameVisitor {
    // ç‰©ç†è®¡ç®—é€»è¾‘
}

class AIVisitor implements GameVisitor {
    // AIå†³ç­–é€»è¾‘
}
```

### 7.3 ä¸å…¶ä»–æ¨¡å¼çš„ç»“åˆ


**ğŸ”— è®¿é—®è€… + ç»„åˆæ¨¡å¼**
```java
class CompositeElement implements Element {
    private List<Element> children = new ArrayList<>();
    
    public void accept(Visitor visitor) {
        visitor.visit(this);
        
        // é€’å½’è®¿é—®å­å…ƒç´ 
        for (Element child : children) {
            child.accept(visitor);
        }
    }
}
```

**ğŸ”— è®¿é—®è€… + ç­–ç•¥æ¨¡å¼**
```java
class ConfigurableVisitor implements Visitor {
    private VisitStrategy strategy;
    
    public void setStrategy(VisitStrategy strategy) {
        this.strategy = strategy;
    }
    
    public void visit(Element element) {
        strategy.process(element);
    }
}
```

### 7.4 å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ


**âš ï¸ å¸¸è§é—®é¢˜æ¸…å•**ï¼š

```
é—®é¢˜1ï¼šè®¿é—®è€…æ¥å£è¿‡äºåºå¤§
è§£å†³ï¼šä½¿ç”¨æ¥å£åˆ†ç¦»ï¼ŒæŒ‰èŒè´£æ‹†åˆ†è®¿é—®è€…æ¥å£

é—®é¢˜2ï¼šå…ƒç´ ç±»å‹é¢‘ç¹å˜åŒ–
è§£å†³ï¼šé‡æ–°è€ƒè™‘æ˜¯å¦é€‚åˆä½¿ç”¨è®¿é—®è€…æ¨¡å¼

é—®é¢˜3ï¼šå¾ªç¯ä¾èµ–å¯¼è‡´æ ˆæº¢å‡º
è§£å†³ï¼šå®ç°å¾ªç¯æ£€æµ‹æœºåˆ¶

é—®é¢˜4ï¼šå¹¶å‘è®¿é—®å¯¼è‡´æ•°æ®ä¸ä¸€è‡´
è§£å†³ï¼šä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„è®¾è®¡æˆ–åŒæ­¥æœºåˆ¶

é—®é¢˜5ï¼šæ€§èƒ½é—®é¢˜
è§£å†³ï¼šè€ƒè™‘æ‰¹é‡å¤„ç†ã€å¹¶è¡Œå¤„ç†ç­‰ä¼˜åŒ–ç­–ç•¥
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è®¿é—®è€…æ¨¡å¼æœ¬è´¨ï¼šå°†æ•°æ®ç»“æ„ä¸æ“ä½œåˆ†ç¦»ï¼Œæ”¯æŒå¯¹ç¨³å®šç»“æ„çš„æ“ä½œæ‰©å±•
ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿ï¼šéµå¾ªå¼€é—­åŸåˆ™ï¼Œæ–°å¢æ“ä½œä¸ä¿®æ”¹å…ƒç´ ç±»
ğŸ”¸ é€‚ç”¨å‰æï¼šå…ƒç´ ç»“æ„ç¨³å®šï¼Œæ“ä½œå¤šå˜
ğŸ”¸ è®¾è®¡è¦ç‚¹ï¼šåŒåˆ†æ´¾æœºåˆ¶ï¼Œå…ƒç´ è°ƒç”¨è®¿é—®è€…ï¼Œè®¿é—®è€…å›è°ƒå…·ä½“æ–¹æ³•
ğŸ”¸ ä¸»è¦æŒ‘æˆ˜ï¼šæ¥å£æ¼”åŒ–ã€å¾ªç¯ä¾èµ–ã€å¹¶å‘æ§åˆ¶ã€å¼‚å¸¸å¤„ç†
```

### 8.2 å…³é”®è®¾è®¡åŸåˆ™


**ğŸ”¹ å…ƒç´ ç»“æ„ç¨³å®šæ€§åŸåˆ™**
```
è®¾è®¡ç›®æ ‡ï¼šè®©å…ƒç´ ç±»å‹åœ¨å¯é¢„è§çš„æœªæ¥ä¿æŒç¨³å®š
å®ç°æ–¹å¼ï¼šåˆç†çš„æŠ½è±¡å±‚æ¬¡ï¼Œæ¸…æ™°çš„èŒè´£åˆ’åˆ†
éªŒè¯æ ‡å‡†ï¼šæ–°å¢æ“ä½œé¢‘ç‡ >> æ–°å¢å…ƒç´ é¢‘ç‡
```

**ğŸ”¹ è®¿é—®è€…æ‰©å±•æ€§åŸåˆ™**  
```
è®¾è®¡ç›®æ ‡ï¼šè½»æ¾æ·»åŠ æ–°çš„æ“ä½œè€Œä¸ä¿®æ”¹ç°æœ‰ä»£ç 
å®ç°æ–¹å¼ï¼šæ ‡å‡†åŒ–çš„è®¿é—®è€…æ¥å£ï¼Œå‚æ•°åŒ–è®¾è®¡
æ³¨æ„äº‹é¡¹ï¼šæ¥å£æ¼”åŒ–å…¼å®¹æ€§ï¼Œé¿å…ç ´åç°æœ‰å®ç°
```

**ğŸ”¹ å¼‚å¸¸å’Œå¹¶å‘å®‰å…¨åŸåˆ™**
```
è®¾è®¡ç›®æ ‡ï¼šåœ¨å¤æ‚ç¯å¢ƒä¸‹ä¿è¯è®¿é—®è€…æ¨¡å¼çš„å¯é æ€§
å…³é”®è€ƒè™‘ï¼šå¼‚å¸¸éš”ç¦»ã€çŠ¶æ€ä¿æŠ¤ã€æ€§èƒ½ä¼˜åŒ–
å®ç°ç­–ç•¥ï¼šåˆ†å±‚å¤„ç†ã€çº¿ç¨‹å®‰å…¨è®¾è®¡ã€ç›‘æ§æœºåˆ¶
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¡ ä½•æ—¶é€‰æ‹©è®¿é—®è€…æ¨¡å¼**ï¼š
- **ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨**ï¼šè¯­æ³•æ ‘å¤„ç†ï¼Œä¸åŒç¼–è¯‘é˜¶æ®µ
- **æ–‡æ¡£å¤„ç†ç³»ç»Ÿ**ï¼šå¤šç§å¯¼å‡ºæ ¼å¼ï¼Œç»Ÿè®¡åˆ†æ  
- **æ¸¸æˆå¼•æ“**ï¼šå¯¹è±¡ç³»ç»Ÿçš„ä¸åŒå¤„ç†ç®¡é“
- **æ•°æ®åˆ†æå·¥å…·**ï¼šå¯¹æ•°æ®ç»“æ„çš„å¤šç§åˆ†æç®—æ³•

**ğŸš€ å¸¦æ¥çš„ä»·å€¼**ï¼š
- **å¯æ‰©å±•æ€§**ï¼šæ–°åŠŸèƒ½ä»¥æ’ä»¶æ–¹å¼æ·»åŠ 
- **ä»£ç ç»„ç»‡**ï¼šæŒ‰åŠŸèƒ½è€Œéæ•°æ®ç»„ç»‡ä»£ç 
- **èŒè´£åˆ†ç¦»**ï¼šæ•°æ®æ¨¡å‹ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»
- **å›¢é˜Ÿåä½œ**ï¼šä¸åŒå›¢é˜Ÿå¯ç‹¬ç«‹å¼€å‘è®¿é—®è€…

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ“š æŒæ¡è·¯å¾„**ï¼š
1. **ç†è§£æ ¸å¿ƒæ€æƒ³**ï¼šæ•°æ®ä¸æ“ä½œåˆ†ç¦»çš„è®¾è®¡å“²å­¦
2. **ç»ƒä¹ åŸºç¡€å®ç°**ï¼šç®€å•çš„æ–‡ä»¶ç³»ç»Ÿæˆ–è¡¨è¾¾å¼æ ‘
3. **å¤„ç†å¤æ‚åœºæ™¯**ï¼šå¾ªç¯ä¾èµ–ã€å¼‚å¸¸ã€å¹¶å‘é—®é¢˜
4. **ç»“åˆå…¶ä»–æ¨¡å¼**ï¼šç»„åˆæ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ç­‰
5. **å®é™…é¡¹ç›®åº”ç”¨**ï¼šåœ¨åˆé€‚çš„åœºæ™¯ä¸­è¿ç”¨

**ğŸ¯ é‡ç‚¹å…³æ³¨**ï¼š
- åˆ¤æ–­é€‚ç”¨æ€§æ¯”å®ç°æ›´é‡è¦
- è®¾è®¡ç¨³å®šçš„å…ƒç´ ç»“æ„æ˜¯æˆåŠŸçš„å…³é”®
- å¼‚å¸¸å¤„ç†å’Œå¹¶å‘æ§åˆ¶æ˜¯å·¥ç¨‹å®è·µçš„é‡ç‚¹
- ä¸å›¢é˜Ÿè®¨è®ºè®¾è®¡å†³ç­–ï¼Œé¿å…è¿‡åº¦è®¾è®¡

**æ ¸å¿ƒè®°å¿†**ï¼š
- è®¿é—®è€…æ¨¡å¼è®©"æ“ä½œ"ç‹¬ç«‹äº"æ•°æ®"
- ç¨³å®šçš„ç»“æ„ + å¤šå˜çš„æ“ä½œ = è®¿é—®è€…æ¨¡å¼çš„èˆå°  
- åŒåˆ†æ´¾æœºåˆ¶æ˜¯å®ç°çš„æŠ€æœ¯åŸºç¡€
- å·¥ç¨‹å®è·µä¸­è¦é‡ç‚¹å…³æ³¨å¼‚å¸¸ã€å¹¶å‘ã€æ€§èƒ½é—®é¢˜