---
title: 24ã€SessionåŸºæœ¬æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [Sessionæ˜¯ä»€ä¹ˆ](#1-Sessionæ˜¯ä»€ä¹ˆ)
2. [saveä¿å­˜å¯¹è±¡](#2-saveä¿å­˜å¯¹è±¡)
3. [updateæ›´æ–°å¯¹è±¡](#3-updateæ›´æ–°å¯¹è±¡)
4. [deleteåˆ é™¤å¯¹è±¡](#4-deleteåˆ é™¤å¯¹è±¡)
5. [getç«‹å³åŠ è½½](#5-getç«‹å³åŠ è½½)
6. [loadå»¶è¿ŸåŠ è½½](#6-loadå»¶è¿ŸåŠ è½½)
7. [persistæŒä¹…åŒ–](#7-persistæŒä¹…åŒ–)
8. [mergeåˆå¹¶æ“ä½œ](#8-mergeåˆå¹¶æ“ä½œ)
9. [evictæ¸…é™¤ç¼“å­˜](#9-evictæ¸…é™¤ç¼“å­˜)
10. [clearæ¸…ç©ºä¼šè¯](#10-clearæ¸…ç©ºä¼šè¯)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Sessionæ˜¯ä»€ä¹ˆ


### 1.1 Sessionçš„æœ¬è´¨ç†è§£


**ğŸ”¸ é€šä¿—è§£é‡Š**
```
Sessionå°±åƒæ˜¯ä½ å’Œæ•°æ®åº“ä¹‹é—´çš„"å·¥ä½œå°"ï¼š
- ä½ æƒ³å­˜æ•°æ®ï¼Ÿé€šè¿‡è¿™ä¸ªå·¥ä½œå°
- ä½ æƒ³æ”¹æ•°æ®ï¼Ÿè¿˜æ˜¯è¿™ä¸ªå·¥ä½œå°  
- ä½ æƒ³æŸ¥æ•°æ®ï¼Ÿä¾ç„¶æ˜¯è¿™ä¸ªå·¥ä½œå°

ç®€å•ç†è§£ï¼šSession = æ“ä½œæ•°æ®åº“çš„"ä¸­ä»‹"
```

**ğŸ“– ä¸“ä¸šå®šä¹‰**
> Sessionæ˜¯Hibernateä¸­æœ€æ ¸å¿ƒçš„æ¥å£ï¼Œä»£è¡¨åº”ç”¨ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„ä¸€æ¬¡ä¼šè¯ã€‚å®ƒè´Ÿè´£ç®¡ç†æŒä¹…åŒ–å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰§è¡ŒCRUDæ“ä½œã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Session


**ğŸ’¡ å®é™…åœºæ™¯ç±»æ¯”**
```
ä¼ ç»ŸJDBCæ“ä½œæ•°æ®åº“ï¼š
ä½  â†’ å†™SQL â†’ è®¾ç½®å‚æ•° â†’ æ‰§è¡Œ â†’ å¤„ç†ç»“æœ â†’ å…³é—­è¿æ¥
(æ¯ä¸€æ­¥éƒ½è¦æ‰‹åŠ¨æ“ä½œï¼Œå¾ˆéº»çƒ¦ï¼)

ä½¿ç”¨Hibernate Sessionï¼š
ä½  â†’ session.save(å¯¹è±¡) â†’ æå®šï¼
(Sessionå¸®ä½ å®ŒæˆSQLç”Ÿæˆã€å‚æ•°ç»‘å®šã€æ‰§è¡Œç­‰æ‰€æœ‰å·¥ä½œ)
```

**ğŸ¯ æ ¸å¿ƒä»·å€¼**
- **ç®€åŒ–æ“ä½œ**ï¼šä¸ç”¨å†™SQLè¯­å¥ï¼Œç›´æ¥æ“ä½œå¯¹è±¡
- **è‡ªåŠ¨ç®¡ç†**ï¼šè‡ªåŠ¨å¤„ç†äº‹åŠ¡ã€ç¼“å­˜ã€è¿æ¥
- **æé«˜æ•ˆç‡**ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œæå‡å¼€å‘é€Ÿåº¦

### 1.3 Sessionçš„å·¥ä½œæµç¨‹


**ğŸ”„ åŸºæœ¬ä½¿ç”¨æµç¨‹**
```
ç¬¬1æ­¥ï¼šè·å–Session
   â†“
ç¬¬2æ­¥ï¼šå¼€å¯äº‹åŠ¡
   â†“  
ç¬¬3æ­¥ï¼šæ‰§è¡Œæ“ä½œ(save/update/deleteç­‰)
   â†“
ç¬¬4æ­¥ï¼šæäº¤äº‹åŠ¡
   â†“
ç¬¬5æ­¥ï¼šå…³é—­Session
```

**ğŸ“‹ å®é™…ä»£ç ç¤ºä¾‹**
```java
// è·å–Session
Session session = sessionFactory.openSession();
// å¼€å¯äº‹åŠ¡
Transaction tx = session.beginTransaction();

// æ‰§è¡Œæ“ä½œ
User user = new User("å¼ ä¸‰", 25);
session.save(user);

// æäº¤äº‹åŠ¡
tx.commit();
// å…³é—­Session
session.close();
```

---

## 2. ğŸ’¾ saveä¿å­˜å¯¹è±¡


### 2.1 saveæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
saveå°±æ˜¯æŠŠJavaå¯¹è±¡"å­˜å‚¨"åˆ°æ•°æ®åº“ä¸­
æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ â†’ å˜æˆæ•°æ®åº“é‡Œçš„ä¸€è¡Œè®°å½•
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
Serializable save(Object entity)
// è¿”å›å€¼ï¼šä¿å­˜åå¯¹è±¡çš„ä¸»é”®ID
```

### 2.2 saveçš„æ‰§è¡Œè¿‡ç¨‹


**ğŸ”„ å†…éƒ¨å·¥ä½œæµç¨‹**
```
Step 1ï¼šæ£€æŸ¥å¯¹è±¡çŠ¶æ€
   â†“
Step 2ï¼šåˆ†é…ä¸»é”®IDï¼ˆå¦‚æœæ˜¯è‡ªå¢ï¼‰
   â†“
Step 3ï¼šç”ŸæˆINSERTè¯­å¥
   â†“
Step 4ï¼šæ‰§è¡ŒSQLæ’å…¥æ•°æ®åº“
   â†“
Step 5ï¼šå¯¹è±¡è¿›å…¥æŒä¹…åŒ–çŠ¶æ€
```

**ğŸ’» å®é™…ä½¿ç”¨ç¤ºä¾‹**
```java
// åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·å¯¹è±¡ï¼ˆæ­¤æ—¶è¿˜åœ¨å†…å­˜ä¸­ï¼‰
User user = new User();
user.setName("æå››");
user.setAge(28);

// é€šè¿‡saveä¿å­˜åˆ°æ•°æ®åº“
Long id = (Long) session.save(user);

// æ­¤æ—¶userå¯¹è±¡å·²ç»æœ‰äº†æ•°æ®åº“ID
System.out.println("ä¿å­˜æˆåŠŸï¼ŒIDä¸ºï¼š" + id);
```

### 2.3 saveçš„ç‰¹ç‚¹ä¸æ³¨æ„äº‹é¡¹


**âœ… æ ¸å¿ƒç‰¹ç‚¹**
| ç‰¹ç‚¹ | è¯´æ˜ | å®é™…æ„ä¹‰ |
|------|------|----------|
| ğŸ¯ **ç«‹å³æ‰§è¡Œ** | è°ƒç”¨saveåç«‹å³ç”ŸæˆSQL | å¯ä»¥é©¬ä¸Šæ‹¿åˆ°ä¸»é”®ID |
| ğŸ”„ **è¿”å›ä¸»é”®** | è¿”å›ä¿å­˜åçš„ä¸»é”®å€¼ | æ–¹ä¾¿åç»­æ“ä½œä½¿ç”¨ |
| ğŸ“ **å¿…é¡»äº‹åŠ¡** | éœ€è¦åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ | å¦åˆ™æ•°æ®ä¸ä¼šçœŸæ­£ä¿å­˜ |

**âš ï¸ å¸¸è§é—®é¢˜**
```
âŒ é—®é¢˜1ï¼šå¿˜è®°å¼€å¯äº‹åŠ¡
session.save(user); // çœ‹ä¼¼æˆåŠŸï¼Œå®é™…æ•°æ®åº“æ²¡æœ‰æ•°æ®

âœ… æ­£ç¡®åšæ³•ï¼š
Transaction tx = session.beginTransaction();
session.save(user);
tx.commit(); // å¿…é¡»æäº¤äº‹åŠ¡

---

âŒ é—®é¢˜2ï¼šå¯¹è±¡å·²æœ‰ID
User user = new User();
user.setId(100L); // æ‰‹åŠ¨è®¾ç½®ID
session.save(user); // å¯èƒ½æŠ¥é”™æˆ–IDå†²çª

âœ… æ­£ç¡®åšæ³•ï¼šè®©æ•°æ®åº“è‡ªåŠ¨ç”ŸæˆID
```

---

## 3. ğŸ”„ updateæ›´æ–°å¯¹è±¡


### 3.1 updateæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
updateå°±æ˜¯æŠŠJavaå¯¹è±¡çš„"æœ€æ–°æ•°æ®"åŒæ­¥åˆ°æ•°æ®åº“
ç›¸å½“äºï¼šæŠŠå†…å­˜ä¸­ä¿®æ”¹è¿‡çš„å¯¹è±¡ â†’ æ›´æ–°åˆ°æ•°æ®åº“å¯¹åº”çš„è®°å½•
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
void update(Object entity)
// æ— è¿”å›å€¼ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“
```

### 3.2 updateçš„ä½¿ç”¨åœºæ™¯


**ğŸ’¡ å…¸å‹åº”ç”¨åœºæ™¯**
```
åœºæ™¯1ï¼šä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
ä»æ•°æ®åº“æŸ¥å‡ºç”¨æˆ· â†’ ä¿®æ”¹å±æ€§ â†’ updateä¿å­˜ä¿®æ”¹

åœºæ™¯2ï¼šæ‰¹é‡æ›´æ–°æ•°æ®
å¾ªç¯å¤„ç†å¯¹è±¡é›†åˆ â†’ é€ä¸ªupdateæ›´æ–°

åœºæ™¯3ï¼šåˆ†ç¦»å¯¹è±¡æ›´æ–°
å¯¹è±¡å·²ç»è„±ç¦»Session â†’ é‡æ–°å…³è”å¹¶update
```

**ğŸ“Š ä¸‰ç§æ›´æ–°æ–¹å¼å¯¹æ¯”**
```
æ–¹å¼1ï¼šæŸ¥è¯¢åç›´æ¥ä¿®æ”¹ï¼ˆæ¨èï¼‰
User user = session.get(User.class, 1L);
user.setAge(30);
// ä¸éœ€è¦è°ƒç”¨updateï¼Œäº‹åŠ¡æäº¤æ—¶è‡ªåŠ¨æ›´æ–°

æ–¹å¼2ï¼šæ˜¾å¼è°ƒç”¨update
User user = new User();
user.setId(1L);
user.setAge(30);
session.update(user); // æ‰‹åŠ¨è°ƒç”¨update

æ–¹å¼3ï¼šå…ˆåˆ é™¤åä¿å­˜
// ä¸æ¨èï¼Œæ•ˆç‡ä½
```

### 3.3 updateå®æˆ˜ç¤ºä¾‹


**ğŸ’» å®Œæ•´ä»£ç ç¤ºä¾‹**
```java
// æ–¹å¼1ï¼šæŒä¹…åŒ–å¯¹è±¡è‡ªåŠ¨æ›´æ–°
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

User user = session.get(User.class, 1L);
user.setName("ä¿®æ”¹åçš„åå­—"); // ä¿®æ”¹å±æ€§
// ä¸éœ€è¦è°ƒç”¨updateï¼Œæäº¤äº‹åŠ¡æ—¶è‡ªåŠ¨æ›´æ–°

tx.commit();
session.close();
```

```java
// æ–¹å¼2ï¼šåˆ†ç¦»å¯¹è±¡æ‰‹åŠ¨æ›´æ–°
User user = new User();
user.setId(1L); // å¿…é¡»è®¾ç½®å·²å­˜åœ¨çš„ID
user.setName("æ–°åå­—");
user.setAge(30);

Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

session.update(user); // æ˜¾å¼æ›´æ–°

tx.commit();
session.close();
```

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```
ğŸ”¸ updateè¦æ±‚å¯¹è±¡å¿…é¡»æœ‰ID
å¦‚æœIDä¸å­˜åœ¨æˆ–ä¸ºnull â†’ æŠ¥é”™

ğŸ”¸ updateä¼šæ›´æ–°æ‰€æœ‰å­—æ®µ
å³ä½¿ä½ åªæ”¹äº†ä¸€ä¸ªå­—æ®µï¼ŒSQLä¹Ÿä¼šUPDATEæ‰€æœ‰åˆ—

ğŸ”¸ æŒä¹…åŒ–å¯¹è±¡ä¸éœ€è¦è°ƒç”¨update
Sessionç®¡ç†çš„å¯¹è±¡ï¼Œä¿®æ”¹åè‡ªåŠ¨åŒæ­¥æ•°æ®åº“
```

---

## 4. ğŸ—‘ï¸ deleteåˆ é™¤å¯¹è±¡


### 4.1 deleteæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
deleteå°±æ˜¯æŠŠæ•°æ®åº“é‡Œçš„è®°å½•"åˆ æ‰"
å¯¹åº”çš„Javaå¯¹è±¡ â†’ ä»æ•°æ®åº“ä¸­ç§»é™¤å¯¹åº”çš„æ•°æ®è¡Œ
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
void delete(Object entity)
// æ ¹æ®å¯¹è±¡çš„IDåˆ é™¤æ•°æ®åº“è®°å½•
```

### 4.2 deleteçš„ä¸¤ç§ä½¿ç”¨æ–¹å¼


**æ–¹å¼1ï¼šç›´æ¥åˆ é™¤æŸ¥è¯¢å‡ºçš„å¯¹è±¡**
```java
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

// å…ˆæŸ¥è¯¢å¯¹è±¡
User user = session.get(User.class, 1L);
// ç›´æ¥åˆ é™¤
session.delete(user);

tx.commit();
session.close();
```

**æ–¹å¼2ï¼šæ ¹æ®IDæ„é€ å¯¹è±¡åˆ é™¤**
```java
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

// æ„é€ ä¸€ä¸ªåªæœ‰IDçš„å¯¹è±¡
User user = new User();
user.setId(1L);
// åˆ é™¤è¿™ä¸ªå¯¹è±¡
session.delete(user);

tx.commit();
session.close();
```

### 4.3 deleteçš„æ‰§è¡Œæµç¨‹


**ğŸ”„ å†…éƒ¨å·¥ä½œåŸç†**
```
Step 1ï¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦æœ‰ID
   â†“
Step 2ï¼šç”ŸæˆDELETEè¯­å¥
   â†“
Step 3ï¼šæ‰§è¡ŒSQLåˆ é™¤æ•°æ®åº“è®°å½•
   â†“
Step 4ï¼šå¯¹è±¡è¿›å…¥åˆ é™¤çŠ¶æ€
   â†“
Step 5ï¼šä»Sessionç¼“å­˜ä¸­ç§»é™¤
```

**âš ï¸ åˆ é™¤æ³¨æ„äº‹é¡¹**
```
âŒ é—®é¢˜1ï¼šåˆ é™¤æ²¡æœ‰IDçš„å¯¹è±¡
User user = new User(); // æ²¡æœ‰ID
session.delete(user); // æŠ¥é”™ï¼

âœ… è§£å†³æ–¹æ³•ï¼šç¡®ä¿å¯¹è±¡æœ‰ID

---

âŒ é—®é¢˜2ï¼šé‡å¤åˆ é™¤
session.delete(user);
session.delete(user); // æŠ¥é”™ï¼å¯¹è±¡å·²åˆ é™¤

âœ… è§£å†³æ–¹æ³•ï¼šåˆ é™¤å‰æ£€æŸ¥å¯¹è±¡çŠ¶æ€

---

ğŸ”¸ çº§è”åˆ é™¤é—®é¢˜ï¼š
å¦‚æœé…ç½®äº†çº§è”åˆ é™¤ï¼Œåˆ é™¤çˆ¶å¯¹è±¡ä¼šè¿å¸¦åˆ é™¤å­å¯¹è±¡
éœ€è¦è°¨æ…ä½¿ç”¨ï¼
```

---

## 5. ğŸ” getç«‹å³åŠ è½½


### 5.1 getæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
getå°±æ˜¯"ç«‹åˆ»"ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®
è°ƒç”¨getæ–¹æ³• â†’ é©¬ä¸Šæ‰§è¡ŒSQL â†’ ç«‹å³è¿”å›å¯¹è±¡æˆ–null
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
<T> T get(Class<T> entityClass, Serializable id)
// è¿”å›æŸ¥è¯¢åˆ°çš„å¯¹è±¡ï¼ŒæŸ¥ä¸åˆ°è¿”å›null
```

### 5.2 getçš„æ‰§è¡Œç‰¹ç‚¹


**âš¡ ç«‹å³åŠ è½½çš„å«ä¹‰**
```
ç«‹å³åŠ è½½ = è°ƒç”¨æ–¹æ³•æ—¶é©¬ä¸ŠæŸ¥è¯¢æ•°æ®åº“

ä»£ç æ‰§è¡Œï¼š
User user = session.get(User.class, 1L);
          â†“
Hibernateç«‹å³æ‰§è¡Œï¼š
SELECT * FROM user WHERE id = 1
          â†“
è¿”å›ç»“æœå¯¹è±¡æˆ–null
```

**ğŸ’» å®é™…ä½¿ç”¨ç¤ºä¾‹**
```java
Session session = sessionFactory.openSession();

// è°ƒç”¨getæ—¶ç«‹å³æŸ¥è¯¢æ•°æ®åº“
User user = session.get(User.class, 1L);

if (user != null) {
    System.out.println("ç”¨æˆ·åï¼š" + user.getName());
} else {
    System.out.println("ç”¨æˆ·ä¸å­˜åœ¨");
}

session.close();
```

### 5.3 getæ–¹æ³•çš„ç‰¹ç‚¹


**âœ… æ ¸å¿ƒç‰¹ç‚¹æ€»ç»“**
| ç‰¹ç‚¹ | è¯´æ˜ | ä¼˜ç‚¹/ç¼ºç‚¹ |
|------|------|----------|
| ğŸš€ **ç«‹å³æŸ¥è¯¢** | è°ƒç”¨æ—¶é©¬ä¸Šæ‰§è¡ŒSQL | ğŸ‘ æ•°æ®å®æ—¶å‡†ç¡® |
| âœ… **è¿”å›null** | æ•°æ®ä¸å­˜åœ¨è¿”å›null | ğŸ‘ æ–¹ä¾¿åˆ¤æ–­æ˜¯å¦å­˜åœ¨ |
| ğŸ“¦ **è¿”å›çœŸå®å¯¹è±¡** | è¿”å›å®Œæ•´çš„å®ä½“å¯¹è±¡ | ğŸ‘ å¯ä»¥ç›´æ¥ä½¿ç”¨ |
| âš¡ **æ€§èƒ½å¼€é”€** | æ¯æ¬¡è°ƒç”¨éƒ½æŸ¥æ•°æ®åº“ | ğŸ‘ å¯èƒ½å½±å“æ€§èƒ½ |

**ğŸ¯ é€‚ç”¨åœºæ™¯**
```
âœ… é€‚åˆä½¿ç”¨getçš„æƒ…å†µï¼š
- ç¡®å®šæ•°æ®å­˜åœ¨ï¼Œéœ€è¦ç«‹å³ä½¿ç”¨
- éœ€è¦åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼ˆé€šè¿‡nullåˆ¤æ–­ï¼‰
- æ•°æ®é‡å°ï¼ŒæŸ¥è¯¢å¼€é”€ä¸å¤§

âŒ ä¸é€‚åˆä½¿ç”¨getçš„æƒ…å†µï¼š
- åªéœ€è¦å…³è”å…³ç³»ï¼Œä¸éœ€è¦å…·ä½“æ•°æ®ï¼ˆç”¨loadï¼‰
- é¢‘ç¹æŸ¥è¯¢åŒä¸€å¯¹è±¡ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰
```

---

## 6. ğŸŒ loadå»¶è¿ŸåŠ è½½


### 6.1 loadæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
loadæ˜¯"æ‡’åŠ è½½"ï¼Œä¸ç€æ€¥æŸ¥æ•°æ®åº“
è°ƒç”¨loadæ–¹æ³• â†’ å…ˆè¿”å›ä¸€ä¸ª"ä»£ç†å¯¹è±¡" â†’ çœŸæ­£ä½¿ç”¨æ—¶æ‰æŸ¥æ•°æ®åº“

å°±åƒï¼š"ä½ å…ˆæ‹¿ç€è¿™ä¸ªå‡­è¯ï¼Œç­‰ä½ çœŸè¦ç”¨çš„æ—¶å€™æˆ‘å†ç»™ä½ å–è´§"
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
<T> T load(Class<T> entityClass, Serializable id)
// è¿”å›ä»£ç†å¯¹è±¡ï¼Œä¸ç«‹å³æŸ¥è¯¢æ•°æ®åº“
```

### 6.2 loadçš„å»¶è¿ŸåŠ è½½æœºåˆ¶


**ğŸ”„ å»¶è¿ŸåŠ è½½å·¥ä½œåŸç†**
```
Step 1ï¼šè°ƒç”¨loadæ–¹æ³•
User user = session.load(User.class, 1L);
   â†“ï¼ˆæ­¤æ—¶ä¸æŸ¥æ•°æ®åº“ï¼Œè¿”å›ä»£ç†å¯¹è±¡ï¼‰
   
Step 2ï¼šå®é™…ä½¿ç”¨å¯¹è±¡å±æ€§æ—¶
String name = user.getName();
   â†“ï¼ˆæ­¤æ—¶æ‰çœŸæ­£æŸ¥è¯¢æ•°æ®åº“ï¼‰
   
Step 3ï¼šæ‰§è¡ŒSQLæŸ¥è¯¢
SELECT * FROM user WHERE id = 1
   â†“
Step 4ï¼šè¿”å›çœŸå®æ•°æ®
```

**ğŸ’¡ ä»£ç†å¯¹è±¡æ˜¯ä»€ä¹ˆ**
```
ä»£ç†å¯¹è±¡ = ä¸€ä¸ª"å ä½ç¬¦"å¯¹è±¡
- å®ƒæœ‰IDä¿¡æ¯
- å®ƒçŸ¥é“çœŸå®å¯¹è±¡çš„ç±»å‹
- ä½†å®ƒè¿˜æ²¡æœ‰å…·ä½“çš„å±æ€§æ•°æ®
- åªæœ‰å½“ä½ è®¿é—®å±æ€§æ—¶ï¼Œæ‰å»æ•°æ®åº“åŠ è½½çœŸå®æ•°æ®
```

### 6.3 loadçš„å®é™…åº”ç”¨


**ğŸ’» ä»£ç å¯¹æ¯”ç¤ºä¾‹**
```java
// getï¼šç«‹å³åŠ è½½
User user1 = session.get(User.class, 1L);
// è¿™é‡Œå·²ç»æ‰§è¡Œäº†SQLæŸ¥è¯¢
System.out.println("getæ‰§è¡Œå®Œæ¯•");

// loadï¼šå»¶è¿ŸåŠ è½½  
User user2 = session.load(User.class, 1L);
// è¿™é‡Œè¿˜æ²¡æ‰§è¡ŒSQLï¼Œuser2æ˜¯ä»£ç†å¯¹è±¡
System.out.println("loadæ‰§è¡Œå®Œæ¯•");

// è®¿é—®å±æ€§æ—¶æ‰çœŸæ­£æŸ¥è¯¢
String name = user2.getName(); // æ­¤æ—¶æ‰§è¡ŒSQL
```

**âš ï¸ loadçš„é‡è¦æ³¨æ„äº‹é¡¹**
```
ğŸ”¸ Sessionå…³é—­åä¸èƒ½ä½¿ç”¨loadå¯¹è±¡

Session session = sessionFactory.openSession();
User user = session.load(User.class, 1L);
session.close(); // å…³é—­Session

user.getName(); // æŠ¥é”™ï¼LazyInitializationException
// å› ä¸ºSessionå·²å…³é—­ï¼Œæ— æ³•å†æŸ¥è¯¢æ•°æ®åº“

âœ… è§£å†³æ–¹æ³•ï¼š
1. åœ¨Sessionå…³é—­å‰è®¿é—®æ‰€éœ€å±æ€§
2. ä½¿ç”¨getä»£æ›¿load
3. å¼€å¯OpenSessionInViewæ¨¡å¼

---

ğŸ”¸ loadæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ä¼šæŠ¥é”™

User user = session.load(User.class, 999L); // ä¸å­˜åœ¨çš„ID
user.getName(); // æŠ¥é”™ï¼ObjectNotFoundException

getæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®è¿”å›nullï¼ˆå®‰å…¨ï¼‰
```

### 6.4 get vs load æ ¸å¿ƒåŒºåˆ«


**ğŸ“Š å¯¹æ¯”æ€»ç»“**
| å¯¹æ¯”ç»´åº¦ | **getæ–¹æ³•** | **loadæ–¹æ³•** |
|---------|-------------|--------------|
| â° **æ‰§è¡Œæ—¶æœº** | ç«‹å³æŸ¥è¯¢æ•°æ®åº“ | å»¶è¿Ÿåˆ°ä½¿ç”¨æ—¶æ‰æŸ¥è¯¢ |
| ğŸ“¦ **è¿”å›å€¼** | è¿”å›çœŸå®å¯¹è±¡æˆ–null | è¿”å›ä»£ç†å¯¹è±¡ |
| â“ **æ•°æ®ä¸å­˜åœ¨** | è¿”å›null | æŠ›å‡ºå¼‚å¸¸ |
| ğŸ¯ **é€‚ç”¨åœºæ™¯** | ç¡®å®šéœ€è¦æ•°æ® | ä»…éœ€è¦IDå…³è” |
| ğŸ’¾ **æ€§èƒ½å½±å“** | å¯èƒ½å¤šæ¬¡æŸ¥è¯¢ | ä¼˜åŒ–æŸ¥è¯¢æ¬¡æ•° |

**ğŸ¯ ä½¿ç”¨å»ºè®®**
```
ä½¿ç”¨getçš„æƒ…å†µï¼š
âœ… éœ€è¦ç«‹å³åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨
âœ… é©¬ä¸Šè¦ä½¿ç”¨å¯¹è±¡çš„å±æ€§æ•°æ®
âœ… ä»£ç ç®€å•æ¸…æ™°ï¼Œä¸éœ€è¦è€ƒè™‘å»¶è¿ŸåŠ è½½

ä½¿ç”¨loadçš„æƒ…å†µï¼š
âœ… åªéœ€è¦è®¾ç½®å¤–é”®å…³è”ï¼ˆä¸éœ€è¦å…·ä½“æ•°æ®ï¼‰
âœ… ä¼˜åŒ–æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„æŸ¥è¯¢
âœ… æ˜ç¡®çŸ¥é“æ•°æ®ä¸€å®šå­˜åœ¨
```

---

## 7. ğŸ” persistæŒä¹…åŒ–


### 7.1 persistæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
persist = è®©å¯¹è±¡å˜æˆ"æŒä¹…åŒ–çŠ¶æ€"
ç®€å•è¯´ï¼šæŠŠä¸´æ—¶å¯¹è±¡å˜æˆHibernateç®¡ç†çš„æŒä¹…åŒ–å¯¹è±¡

persistå’Œsaveå¾ˆåƒï¼Œä½†æœ‰ç»†å¾®å·®åˆ«
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
void persist(Object entity)
// æ— è¿”å›å€¼ï¼Œä½¿å¯¹è±¡è¿›å…¥æŒä¹…åŒ–çŠ¶æ€
```

### 7.2 persistçš„å·¥ä½œæœºåˆ¶


**ğŸ”„ æ‰§è¡Œæµç¨‹**
```
Step 1ï¼šæ£€æŸ¥å¯¹è±¡çŠ¶æ€
   â†“
Step 2ï¼šå¯¹è±¡è¿›å…¥æŒä¹…åŒ–çŠ¶æ€
   â†“
Step 3ï¼šç”ŸæˆINSERTè¯­å¥ï¼ˆå¯èƒ½å»¶è¿Ÿï¼‰
   â†“
Step 4ï¼šåœ¨äº‹åŠ¡æäº¤æˆ–flushæ—¶æ‰§è¡ŒSQL
```

**ğŸ’» å®é™…ä½¿ç”¨ç¤ºä¾‹**
```java
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

User user = new User("ç‹äº”", 35);
session.persist(user); // å¯¹è±¡è¿›å…¥æŒä¹…åŒ–çŠ¶æ€

// æ­¤æ—¶å¯èƒ½è¿˜æ²¡æ‰§è¡ŒSQL
System.out.println("persistè°ƒç”¨å®Œæˆ");

tx.commit(); // æäº¤æ—¶æ‰çœŸæ­£æ‰§è¡ŒSQL
session.close();
```

### 7.3 persist vs save æ ¸å¿ƒåŒºåˆ«


**ğŸ“Š persistå’Œsaveçš„åŒºåˆ«**
| å¯¹æ¯”é¡¹ | **saveæ–¹æ³•** | **persistæ–¹æ³•** |
|--------|--------------|-----------------|
| ğŸ”„ **è¿”å›å€¼** | è¿”å›ä¸»é”®ID | æ— è¿”å›å€¼(void) |
| â° **æ‰§è¡Œæ—¶æœº** | ç«‹å³ç”ŸæˆSQL | å¯èƒ½å»¶è¿Ÿåˆ°flush |
| ğŸ“ **JPAæ ‡å‡†** | Hibernateç‰¹æœ‰ | JPAæ ‡å‡†æ–¹æ³• |
| ğŸ¯ **æ¨èä½¿ç”¨** | éœ€è¦ç«‹å³è·å–ID | JPAè§„èŒƒé¡¹ç›® |

**ğŸ”¸ ä½•æ—¶ä½¿ç”¨persist**
```
âœ… ä½¿ç”¨persistçš„åœºæ™¯ï¼š
1. éµå¾ªJPAè§„èŒƒçš„é¡¹ç›®ï¼ˆæ ‡å‡†åŒ–ï¼‰
2. ä¸éœ€è¦ç«‹å³è·å–ä¸»é”®ID
3. æ‰¹é‡æ’å…¥ä¼˜åŒ–ï¼ˆå‡å°‘SQLæ‰§è¡Œæ¬¡æ•°ï¼‰

âœ… ä½¿ç”¨saveçš„åœºæ™¯ï¼š
1. éœ€è¦ç«‹å³è·å–ç”Ÿæˆçš„ä¸»é”®ID
2. Hibernateä¸“å±é¡¹ç›®
3. å¯¹æ’å…¥æ—¶æœºæœ‰æ˜ç¡®è¦æ±‚
```

**ğŸ’¡ å®é™…å¯¹æ¯”ç¤ºä¾‹**
```java
// saveï¼šç«‹å³è¿”å›ID
Long id = (Long) session.save(user);
System.out.println("ä¿å­˜çš„IDï¼š" + id); // å¯ä»¥é©¬ä¸Šç”¨

// persistï¼šæ²¡æœ‰è¿”å›å€¼
session.persist(user);
// System.out.println(user.getId()); // å¯èƒ½ä¸ºnull
tx.commit(); // æäº¤åuser.getId()æ‰æœ‰å€¼
System.out.println("ä¿å­˜çš„IDï¼š" + user.getId());
```

---

## 8. ğŸ”„ mergeåˆå¹¶æ“ä½œ


### 8.1 mergeæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
merge = "åˆå¹¶"ä¸¤ä¸ªå¯¹è±¡çš„æ•°æ®
æŠŠä¸€ä¸ªå¯¹è±¡çš„æ•°æ® â†’ åˆå¹¶åˆ°æ•°æ®åº“å¯¹åº”çš„è®°å½•

å°±åƒï¼šä½ æœ‰ä¸€ä¸ªæ—§ç‰ˆæœ¬æ•°æ®ï¼Œåˆæœ‰ä¸€ä¸ªæ–°ç‰ˆæœ¬æ•°æ®
mergeå¸®ä½ æŠŠæ–°æ•°æ®è¦†ç›–åˆ°æ•°æ®åº“é‡Œ
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
<T> T merge(T entity)
// è¿”å›ä¸€ä¸ªæŒä¹…åŒ–çŠ¶æ€çš„å¯¹è±¡
```

### 8.2 mergeçš„ä½¿ç”¨åœºæ™¯


**ğŸ’¡ ä»€ä¹ˆæ—¶å€™éœ€è¦merge**
```
åœºæ™¯1ï¼šå¯¹è±¡è„±ç¦»äº†Sessionï¼ˆåˆ†ç¦»çŠ¶æ€ï¼‰
User user = session.get(User.class, 1L);
session.close(); // Sessionå…³é—­ï¼Œuserå˜æˆåˆ†ç¦»çŠ¶æ€

// é‡æ–°æ‰“å¼€Session
session = sessionFactory.openSession();
user.setName("æ–°åå­—"); // ä¿®æ”¹åˆ†ç¦»å¯¹è±¡
session.merge(user); // åˆå¹¶åˆ°æ•°æ®åº“

---

åœºæ™¯2ï¼šé¿å…é‡å¤å¯¹è±¡é—®é¢˜
Sessionä¸­å·²æœ‰ID=1çš„Userå¯¹è±¡
åˆnewäº†ä¸€ä¸ªID=1çš„Userå¯¹è±¡
ä½¿ç”¨mergeåˆå¹¶ï¼Œé¿å…å†²çª
```

### 8.3 mergeçš„å·¥ä½œåŸç†


**ğŸ”„ å†…éƒ¨æ‰§è¡Œæµç¨‹**
```
Step 1ï¼šæ£€æŸ¥Sessionä¸­æ˜¯å¦å·²å­˜åœ¨ç›¸åŒIDçš„å¯¹è±¡
   â†“
Step 2ï¼šå¦‚æœå­˜åœ¨ï¼ŒæŠŠä¼ å…¥å¯¹è±¡çš„æ•°æ®å¤åˆ¶åˆ°å·²å­˜åœ¨å¯¹è±¡
   â†“  
Step 3ï¼šå¦‚æœä¸å­˜åœ¨ï¼Œä»æ•°æ®åº“åŠ è½½å¯¹è±¡å†å¤åˆ¶æ•°æ®
   â†“
Step 4ï¼šè¿”å›æŒä¹…åŒ–çŠ¶æ€çš„å¯¹è±¡
   â†“
Step 5ï¼šäº‹åŠ¡æäº¤æ—¶æ›´æ–°æ•°æ®åº“
```

**ğŸ’» å®é™…ä»£ç ç¤ºä¾‹**
```java
// ç¬¬ä¸€ä¸ªSession
Session session1 = sessionFactory.openSession();
User user = session1.get(User.class, 1L);
session1.close(); // userå˜æˆåˆ†ç¦»çŠ¶æ€

// userç°åœ¨æ˜¯åˆ†ç¦»å¯¹è±¡ï¼Œä¿®æ”¹å®ƒ
user.setName("æå››");
user.setAge(30);

// ç¬¬äºŒä¸ªSession  
Session session2 = sessionFactory.openSession();
Transaction tx = session2.beginTransaction();

// ä½¿ç”¨mergeåˆå¹¶åˆ†ç¦»å¯¹è±¡
User mergedUser = session2.merge(user);
// mergedUseræ˜¯æŒä¹…åŒ–å¯¹è±¡ï¼Œuserè¿˜æ˜¯åˆ†ç¦»å¯¹è±¡

tx.commit();
session2.close();
```

### 8.4 merge vs update åŒºåˆ«


**ğŸ“Š æ ¸å¿ƒåŒºåˆ«å¯¹æ¯”**
| å¯¹æ¯”é¡¹ | **updateæ–¹æ³•** | **mergeæ–¹æ³•** |
|--------|---------------|---------------|
| ğŸ¯ **é€‚ç”¨å¯¹è±¡** | åªèƒ½ç”¨äºåˆ†ç¦»å¯¹è±¡ | åˆ†ç¦»æˆ–ä¸´æ—¶å¯¹è±¡éƒ½å¯ä»¥ |
| ğŸ”„ **è¿”å›å€¼** | æ— è¿”å›å€¼ | è¿”å›æŒä¹…åŒ–å¯¹è±¡ |
| âš ï¸ **å†²çªå¤„ç†** | åŒIDå¯¹è±¡å­˜åœ¨ä¼šæŠ¥é”™ | è‡ªåŠ¨åˆå¹¶æ•°æ® |
| ğŸ“ **åŸå¯¹è±¡çŠ¶æ€** | å˜æˆæŒä¹…åŒ–çŠ¶æ€ | ä¿æŒåŸçŠ¶æ€ä¸å˜ |

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
```
ğŸ”¸ mergeè¿”å›æ–°å¯¹è±¡ï¼ŒåŸå¯¹è±¡ä¸å˜

User user = new User();
user.setId(1L);
user.setName("å¼ ä¸‰");

User mergedUser = session.merge(user);

System.out.println(user == mergedUser); // false
// userè¿˜æ˜¯åˆ†ç¦»/ä¸´æ—¶çŠ¶æ€
// mergedUseræ‰æ˜¯æŒä¹…åŒ–çŠ¶æ€

---

ğŸ”¸ mergeåç»§ç»­ä½¿ç”¨è¿”å›çš„å¯¹è±¡

User mergedUser = session.merge(user);
mergedUser.setAge(25); // ä¿®æ”¹æŒä¹…åŒ–å¯¹è±¡
// äº‹åŠ¡æäº¤æ—¶ä¼šè‡ªåŠ¨æ›´æ–°æ•°æ®åº“

user.setAge(30); // ä¿®æ”¹åŸå¯¹è±¡
// è¿™ä¸ªä¿®æ”¹ä¸ä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼
```

---

## 9. ğŸ§¹ evictæ¸…é™¤ç¼“å­˜


### 9.1 evictæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
evict = æŠŠå¯¹è±¡ä»Sessionç¼“å­˜ä¸­"è¸¢å‡ºå»"
è®©å¯¹è±¡å˜æˆåˆ†ç¦»çŠ¶æ€ï¼Œä¸å†å—Sessionç®¡ç†

å°±åƒï¼šæŠŠå‘˜å·¥ä»å…¬å¸åå•ä¸­é™¤åï¼Œä»–ä¸å†æ˜¯å…¬å¸å‘˜å·¥
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
void evict(Object entity)
// å°†æŒ‡å®šå¯¹è±¡ä»Sessionç¼“å­˜ä¸­ç§»é™¤
```

### 9.2 ä»€ä¹ˆæ˜¯Sessionç¼“å­˜


**ğŸ’¡ Sessionç¼“å­˜è§£é‡Š**
```
Sessionæœ‰ä¸€ä¸ª"ä¸€çº§ç¼“å­˜"ï¼ˆå†…å­˜ç¼“å­˜ï¼‰ï¼š
- æŸ¥è¯¢çš„å¯¹è±¡ä¼šå­˜åœ¨è¿™ä¸ªç¼“å­˜é‡Œ
- ä¸‹æ¬¡æŸ¥åŒä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥ä»ç¼“å­˜æ‹¿ï¼Œä¸æŸ¥æ•°æ®åº“
- Sessionå…³é—­æ—¶ï¼Œç¼“å­˜è‡ªåŠ¨æ¸…ç©º

evictçš„ä½œç”¨ï¼šæ‰‹åŠ¨ä»ç¼“å­˜ä¸­ç§»é™¤æŸä¸ªå¯¹è±¡
```

**ğŸ”„ ç¼“å­˜å·¥ä½œç¤ºä¾‹**
```
ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š
User user1 = session.get(User.class, 1L);
// æ‰§è¡ŒSQLï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œç»“æœæ”¾å…¥ç¼“å­˜

ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼š
User user2 = session.get(User.class, 1L);  
// ä¸æ‰§è¡ŒSQLï¼Œç›´æ¥ä»ç¼“å­˜è·å–

System.out.println(user1 == user2); // true åŒä¸€ä¸ªå¯¹è±¡

ä½¿ç”¨evictåï¼š
session.evict(user1); // ä»ç¼“å­˜ç§»é™¤
User user3 = session.get(User.class, 1L);
// é‡æ–°æ‰§è¡ŒSQLæŸ¥è¯¢æ•°æ®åº“
```

### 9.3 evictçš„å®é™…åº”ç”¨


**ğŸ’» ä½¿ç”¨ç¤ºä¾‹**
```java
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

// æŸ¥è¯¢ç”¨æˆ·
User user = session.get(User.class, 1L);
System.out.println("ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š" + user.getName());

// ä¿®æ”¹å¯¹è±¡
user.setName("æ–°åå­—");

// å°†å¯¹è±¡ä»ç¼“å­˜ä¸­ç§»é™¤
session.evict(user);

// å¯¹è±¡å˜æˆåˆ†ç¦»çŠ¶æ€ï¼Œä¿®æ”¹ä¸ä¼šåŒæ­¥åˆ°æ•°æ®åº“
user.setAge(30); // è¿™ä¸ªä¿®æ”¹ä¸ä¼šä¿å­˜

tx.commit(); // åªä¼šä¿å­˜setNameçš„ä¿®æ”¹
session.close();
```

**ğŸ¯ evictçš„ä½¿ç”¨åœºæ™¯**
```
âœ… é€‚åˆä½¿ç”¨evictçš„æƒ…å†µï¼š

1. æ‰¹é‡æ“ä½œä¼˜åŒ–
å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼ŒåŠæ—¶æ¸…é™¤ç¼“å­˜ï¼Œé¿å…å†…å­˜æº¢å‡º

for (int i = 0; i < 10000; i++) {
    User user = new User(...);
    session.save(user);
    
    if (i % 50 == 0) {
        session.flush(); // æ‰§è¡ŒSQL
        session.clear(); // æ¸…ç©ºç¼“å­˜
    }
}

2. é˜²æ­¢è‡ªåŠ¨æ›´æ–°
ä¸æƒ³è®©æŸä¸ªå¯¹è±¡çš„ä¿®æ”¹åŒæ­¥åˆ°æ•°æ®åº“

User user = session.get(User.class, 1L);
session.evict(user); // ç§»é™¤ç¼“å­˜
user.setName("æµ‹è¯•"); // ä¸ä¼šæ›´æ–°æ•°æ®åº“
```

---

## 10. ğŸ—‘ï¸ clearæ¸…ç©ºä¼šè¯


### 10.1 clearæ–¹æ³•çš„ä½œç”¨


**ğŸ”¸ é€šä¿—ç†è§£**
```
clear = æ¸…ç©ºæ•´ä¸ªSessionç¼“å­˜
evictæ˜¯è¸¢æ‰ä¸€ä¸ªå¯¹è±¡ï¼Œclearæ˜¯æ¸…ç©ºæ‰€æœ‰å¯¹è±¡

å°±åƒï¼ševictæ˜¯å¼€é™¤ä¸€ä¸ªå‘˜å·¥ï¼Œclearæ˜¯å…¬å¸è§£æ•£
```

**ğŸ“– æ–¹æ³•ç­¾å**
```java
void clear()
// æ¸…ç©ºSessionä¸­çš„æ‰€æœ‰å¯¹è±¡
```

### 10.2 clear vs evict åŒºåˆ«


**ğŸ“Š æ ¸å¿ƒåŒºåˆ«**
| å¯¹æ¯”é¡¹ | **evict(Object)** | **clear()** |
|--------|-------------------|-------------|
| ğŸ¯ **ä½œç”¨èŒƒå›´** | ç§»é™¤å•ä¸ªå¯¹è±¡ | æ¸…ç©ºæ‰€æœ‰å¯¹è±¡ |
| ğŸ“ **æ€§èƒ½å½±å“** | å½±å“å° | å¯èƒ½å½±å“å¤§ |
| ğŸ”„ **ä½¿ç”¨åœºæ™¯** | ç²¾ç¡®æ§åˆ¶æŸä¸ªå¯¹è±¡ | æ‰¹é‡å¤„ç†æˆ–é‡ç½® |

**ğŸ’» å¯¹æ¯”ç¤ºä¾‹**
```java
Session session = sessionFactory.openSession();

// æŸ¥è¯¢å¤šä¸ªå¯¹è±¡
User user1 = session.get(User.class, 1L);
User user2 = session.get(User.class, 2L);
User user3 = session.get(User.class, 3L);

// evictï¼šåªç§»é™¤user1
session.evict(user1);
// user2å’Œuser3è¿˜åœ¨ç¼“å­˜ä¸­

// clearï¼šæ¸…ç©ºæ‰€æœ‰å¯¹è±¡
session.clear();  
// user1ã€user2ã€user3éƒ½è¢«ç§»é™¤
```

### 10.3 clearçš„å®é™…åº”ç”¨


**ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯**
```
åœºæ™¯1ï¼šæ‰¹é‡æ“ä½œæ€§èƒ½ä¼˜åŒ–

Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();

for (int i = 0; i < 10000; i++) {
    User user = new User("ç”¨æˆ·" + i, 20 + i);
    session.save(user);
    
    // æ¯100æ¡æ¸…ç©ºä¸€æ¬¡ç¼“å­˜
    if (i % 100 == 0) {
        session.flush(); // å…ˆåˆ·æ–°åˆ°æ•°æ®åº“
        session.clear(); // å†æ¸…ç©ºç¼“å­˜
        // é˜²æ­¢ç¼“å­˜ä¸­å¯¹è±¡è¿‡å¤šï¼Œå†…å­˜æº¢å‡º
    }
}

tx.commit();
session.close();

---

åœºæ™¯2ï¼šé‡ç½®SessionçŠ¶æ€

// Sessionä¸­å·²æœ‰ä¸€äº›å¯¹è±¡
User user1 = session.get(User.class, 1L);
user1.setName("ä¿®æ”¹1");

// ä¸æƒ³ä¿å­˜ä¹‹å‰çš„ä¿®æ”¹ï¼Œé‡ç½®Session
session.clear();

// æ‰€æœ‰ä¹‹å‰çš„å¯¹è±¡éƒ½è¢«æ¸…é™¤ï¼Œä¹‹å‰çš„ä¿®æ”¹ä¸ä¼šä¿å­˜
User user2 = session.get(User.class, 2L); // é‡æ–°å¼€å§‹
```

**âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹**
```
ğŸ”¸ clearåä¹‹å‰çš„å¯¹è±¡éƒ½å˜æˆåˆ†ç¦»çŠ¶æ€

User user = session.get(User.class, 1L);
session.clear();

user.setName("æ–°åå­—"); 
// ä¿®æ”¹ä¸ä¼šä¿å­˜ï¼Œå› ä¸ºuserå·²ç»æ˜¯åˆ†ç¦»çŠ¶æ€

---

ğŸ”¸ clearä¼šå½±å“æ‰€æœ‰å¯¹è±¡

Sessionä¸­æœ‰100ä¸ªå¯¹è±¡
è°ƒç”¨clear()ï¼Œå…¨éƒ¨æ¸…ç©º
å¦‚æœå…¶ä¸­æœ‰æœªä¿å­˜çš„ä¿®æ”¹ï¼Œéƒ½ä¼šä¸¢å¤±

âœ… å»ºè®®ï¼šclearå‰å…ˆflush()ä¿å­˜å·²æœ‰ä¿®æ”¹
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 ä¹å¤§æ ¸å¿ƒæ–¹æ³•é€ŸæŸ¥


**ğŸ”¸ æ–¹æ³•åŠŸèƒ½é€Ÿè®°**
| æ–¹æ³• | æ ¸å¿ƒä½œç”¨ | è¿”å›å€¼ | å…³é”®ç‰¹ç‚¹ |
|------|----------|--------|----------|
| **save** | ä¿å­˜æ–°å¯¹è±¡ | ä¸»é”®ID | ç«‹å³æ‰§è¡Œï¼Œè¿”å›ID |
| **update** | æ›´æ–°å¯¹è±¡ | æ—  | å…¨å­—æ®µæ›´æ–° |
| **delete** | åˆ é™¤å¯¹è±¡ | æ—  | ç‰©ç†åˆ é™¤è®°å½• |
| **get** | ç«‹å³æŸ¥è¯¢ | å¯¹è±¡/null | ç«‹å³æ‰§è¡ŒSQL |
| **load** | å»¶è¿ŸæŸ¥è¯¢ | ä»£ç†å¯¹è±¡ | ä½¿ç”¨æ—¶æ‰æŸ¥è¯¢ |
| **persist** | æŒä¹…åŒ–å¯¹è±¡ | æ—  | JPAæ ‡å‡† |
| **merge** | åˆå¹¶å¯¹è±¡ | æŒä¹…åŒ–å¯¹è±¡ | å¤„ç†åˆ†ç¦»çŠ¶æ€ |
| **evict** | ç§»é™¤å•ä¸ª | æ—  | å¯¹è±¡å˜åˆ†ç¦» |
| **clear** | æ¸…ç©ºæ‰€æœ‰ | æ—  | æ‰€æœ‰å¯¹è±¡åˆ†ç¦» |

### 11.2 å¸¸ç”¨æ“ä½œå¯¹æ¯”


**ğŸ“Š æŸ¥è¯¢æ–¹æ³•å¯¹æ¯”**
```
get vs loadï¼š
âœ… getï¼šéœ€è¦ç«‹å³ä½¿ç”¨æ•°æ® â†’ é©¬ä¸ŠæŸ¥æ•°æ®åº“ â†’ è¿”å›çœŸå®å¯¹è±¡/null
âœ… loadï¼šåªéœ€è¦IDå…³è” â†’ è¿”å›ä»£ç†å¯¹è±¡ â†’ ä½¿ç”¨æ—¶æ‰æŸ¥è¯¢

é€‰æ‹©å»ºè®®ï¼š
- ä¸ç¡®å®šæ•°æ®æ˜¯å¦å­˜åœ¨ â†’ ç”¨getï¼ˆè¿”å›nullåˆ¤æ–­ï¼‰
- ç¡®å®šæ•°æ®å­˜åœ¨ä¸”æš‚æ—¶ä¸ç”¨ â†’ ç”¨loadï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
```

**ğŸ“Š ä¿å­˜æ–¹æ³•å¯¹æ¯”**
```
save vs persistï¼š
âœ… saveï¼šéœ€è¦ç«‹å³è·å–ID â†’ è¿”å›ä¸»é”®å€¼
âœ… persistï¼šéµå¾ªJPAè§„èŒƒ â†’ æ— è¿”å›å€¼

é€‰æ‹©å»ºè®®ï¼š
- éœ€è¦é©¬ä¸Šç”¨åˆ°ç”Ÿæˆçš„ID â†’ ç”¨save
- JPAæ ‡å‡†é¡¹ç›®æˆ–ä¸éœ€è¦ID â†’ ç”¨persist
```

**ğŸ“Š æ›´æ–°æ–¹æ³•å¯¹æ¯”**
```
update vs mergeï¼š
âœ… updateï¼šç®€å•ç›´æ¥ â†’ åˆ†ç¦»å¯¹è±¡æ›´æ–°
âœ… mergeï¼šçµæ´»å®‰å…¨ â†’ è‡ªåŠ¨å¤„ç†å†²çª

é€‰æ‹©å»ºè®®ï¼š
- ç¡®å®šå¯¹è±¡æ˜¯åˆ†ç¦»çŠ¶æ€ â†’ ç”¨update
- å¯¹è±¡çŠ¶æ€ä¸ç¡®å®šæˆ–æœ‰å†²çªé£é™© â†’ ç”¨merge
```

### 11.3 Sessionç¼“å­˜ç®¡ç†


**ğŸ”„ ç¼“å­˜æ“ä½œå¯¹æ¯”**
```
evict vs clearï¼š
âœ… evictï¼šç²¾ç¡®æ§åˆ¶ â†’ ç§»é™¤å•ä¸ªå¯¹è±¡
âœ… clearï¼šæ‰¹é‡å¤„ç† â†’ æ¸…ç©ºæ‰€æœ‰å¯¹è±¡

ä½¿ç”¨åœºæ™¯ï¼š
- ä¸æƒ³æŸä¸ªå¯¹è±¡è‡ªåŠ¨æ›´æ–° â†’ ç”¨evict
- æ‰¹é‡æ“ä½œä¼˜åŒ–å†…å­˜ â†’ ç”¨clear
```

### 11.4 å®ç”¨è®°å¿†æŠ€å·§


**ğŸ§  è®°å¿†å£è¯€**
```
saveä¿å­˜è¿”å›IDï¼ŒpersistæŒä¹…ä¸è¿”å›
updateæ›´æ–°è¦æœ‰IDï¼Œmergeåˆå¹¶æ›´å®‰å…¨
getç«‹å³loadå»¶è¿Ÿï¼Œä¸€ä¸ªçœŸå®ä¸€ä¸ªå‡
deleteåˆ é™¤evictç§»ï¼Œclearæ¸…ç©ºå…¨éƒ¨è¸¢
```

**ğŸ¯ æ ¸å¿ƒåŸåˆ™**
```
1. æ‰€æœ‰æ“ä½œéƒ½éœ€è¦åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ
2. Sessionç”¨å®Œå¿…é¡»å…³é—­
3. æŒä¹…åŒ–å¯¹è±¡ä¿®æ”¹ä¼šè‡ªåŠ¨åŒæ­¥æ•°æ®åº“
4. åˆ†ç¦»å¯¹è±¡éœ€è¦updateæˆ–mergeæ‰èƒ½ä¿å­˜ä¿®æ”¹
5. æ‰¹é‡æ“ä½œè¦æ³¨æ„æ¸…ç†ç¼“å­˜ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º
```

### 11.5 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**
```
1. ä¼˜å…ˆä½¿ç”¨get/loadæŸ¥è¯¢
   - æ˜ç¡®éœ€è¦æ•°æ®ç”¨get
   - åªéœ€IDå…³è”ç”¨load

2. æ‰¹é‡æ“ä½œå®šæœŸflush+clear
   - æ¯50-100æ¡æ¸…ç†ä¸€æ¬¡ç¼“å­˜
   - é¿å…ä¸€çº§ç¼“å­˜å†…å­˜æº¢å‡º

3. ä½¿ç”¨JPAæ ‡å‡†æ–¹æ³•
   - persistä»£æ›¿save
   - mergeå¤„ç†åˆ†ç¦»å¯¹è±¡

4. åˆç†ä½¿ç”¨å»¶è¿ŸåŠ è½½
   - é…ç½®lazy=true
   - æ³¨æ„Sessionç”Ÿå‘½å‘¨æœŸ
```

**âŒ é¿å…çš„é”™è¯¯**
```
1. å¿˜è®°å¼€å¯äº‹åŠ¡
2. Sessionå…³é—­åä½¿ç”¨loadå¯¹è±¡
3. æ‰¹é‡æ“ä½œä¸æ¸…ç†ç¼“å­˜
4. åˆ†ç¦»å¯¹è±¡ç›´æ¥ä¿®æ”¹æœŸæœ›è‡ªåŠ¨æ›´æ–°
5. é‡å¤æ‰§è¡Œç›¸åŒçš„æ•°æ®åº“æ“ä½œ
```

**ğŸ”‘ å…³é”®è®°ä½**
- Sessionæ˜¯æ“ä½œæ•°æ®åº“çš„æ ¸å¿ƒå·¥å…·
- ç†è§£å¯¹è±¡çš„ä¸‰ç§çŠ¶æ€ï¼šä¸´æ—¶ã€æŒä¹…åŒ–ã€åˆ†ç¦»
- é€‰æ‹©åˆé€‚çš„æ–¹æ³•å®Œæˆä¸åŒçš„æ“ä½œéœ€æ±‚
- æ³¨æ„æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†
- éµå¾ªäº‹åŠ¡ç®¡ç†çš„åŸºæœ¬åŸåˆ™