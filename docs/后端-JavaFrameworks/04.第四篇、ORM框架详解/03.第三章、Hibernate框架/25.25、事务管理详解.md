---
title: 25ã€äº‹åŠ¡ç®¡ç†è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µ](#1-äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µ)
2. [Transactionæ¥å£è¯¦è§£](#2-Transactionæ¥å£è¯¦è§£)
3. [äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ](#3-äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ)
4. [ACIDç‰¹æ€§æ·±å…¥ç†è§£](#4-ACIDç‰¹æ€§æ·±å…¥ç†è§£)
5. [äº‹åŠ¡è¾¹ç•Œç®¡ç†](#5-äº‹åŠ¡è¾¹ç•Œç®¡ç†)
6. [å¼‚å¸¸å¤„ç†ä¸å›æ»š](#6-å¼‚å¸¸å¤„ç†ä¸å›æ»š)
7. [ç¼–ç¨‹å¼äº‹åŠ¡vså£°æ˜å¼äº‹åŠ¡](#7-ç¼–ç¨‹å¼äº‹åŠ¡vså£°æ˜å¼äº‹åŠ¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¡ äº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ


**ğŸ”¸ ç”Ÿæ´»åŒ–ç†è§£**
```
æƒ³è±¡ä½ åœ¨ATMæœºå–æ¬¾ï¼š
1. æŸ¥è¯¢ä½™é¢ï¼ˆè¯»æ“ä½œï¼‰
2. æ‰£é™¤è´¦æˆ·é‡‘é¢ï¼ˆå†™æ“ä½œï¼‰
3. åå‡ºç°é‡‘ï¼ˆç‰©ç†æ“ä½œï¼‰

å¦‚æœç¬¬2æ­¥æˆåŠŸä½†ç¬¬3æ­¥æœºå™¨å¡ä½äº†æ€ä¹ˆåŠï¼Ÿ
â†’ äº‹åŠ¡ä¿è¯ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨æ’¤é”€
```

**ğŸ“‹ ä¸“ä¸šå®šä¹‰**
> äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯æ•°æ®åº“æ“ä½œçš„æœ€å°å·¥ä½œå•å…ƒï¼Œå®ƒæŠŠå¤šä¸ªæ•°æ®åº“æ“ä½œç»„åˆæˆä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼š
- **åŸå­æ€§**ï¼šäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
- **ä¸€è‡´æ€§**ï¼šæ•°æ®ä»ä¸€ä¸ªæ­£ç¡®çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªæ­£ç¡®çŠ¶æ€
- **éš”ç¦»æ€§**ï¼šå¤šä¸ªäº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°
- **æŒä¹…æ€§**ï¼šæäº¤åçš„æ•°æ®æ°¸ä¹…ä¿å­˜

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡ï¼Ÿ


**ğŸ¯ å®é™…åœºæ™¯**

**åœºæ™¯1ï¼šè½¬è´¦æ“ä½œ**
```
Aè´¦æˆ·æ‰£æ¬¾1000å…ƒ â†’ å¦‚æœè¿™é‡ŒæˆåŠŸ
Bè´¦æˆ·åŠ æ¬¾1000å…ƒ â†’ ä½†è¿™é‡Œå¤±è´¥äº†

æ²¡æœ‰äº‹åŠ¡ï¼šé’±å‡­ç©ºæ¶ˆå¤±äº†ï¼
æœ‰äº‹åŠ¡ï¼šå¤±è´¥åè‡ªåŠ¨å›æ»šï¼Œé’±è¿˜åœ¨Aè´¦æˆ·
```

**åœºæ™¯2ï¼šè®¢å•ç³»ç»Ÿ**
```
åˆ›å»ºè®¢å•è®°å½• â†’ æˆåŠŸ
æ‰£å‡åº“å­˜æ•°é‡ â†’ æˆåŠŸ  
æ‰£å‡ç”¨æˆ·ä½™é¢ â†’ å¤±è´¥ï¼ˆä½™é¢ä¸è¶³ï¼‰

éœ€è¦äº‹åŠ¡ï¼šå‰ä¸¤æ­¥æ“ä½œä¹Ÿè¦æ’¤é”€
```

---

## 2. ğŸ”§ Transactionæ¥å£è¯¦è§£


### 2.1 Transactionæ ¸å¿ƒæ–¹æ³•


**æ¥å£ç»“æ„**
```
Transactionï¼ˆäº‹åŠ¡æ¥å£ï¼‰
    â”œâ”€â”€ begin()      - å¼€å¯äº‹åŠ¡
    â”œâ”€â”€ commit()     - æäº¤äº‹åŠ¡
    â”œâ”€â”€ rollback()   - å›æ»šäº‹åŠ¡
    â”œâ”€â”€ isActive()   - æ£€æŸ¥äº‹åŠ¡çŠ¶æ€
    â””â”€â”€ setTimeout() - è®¾ç½®è¶…æ—¶æ—¶é—´
```

**ğŸ”¸ Transactionçš„ä½œç”¨**
- ç®¡ç†æ•°æ®åº“äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ
- æä¾›ç»Ÿä¸€çš„äº‹åŠ¡æ“ä½œAPI
- å±è”½åº•å±‚æ•°æ®åº“çš„å·®å¼‚

### 2.2 è·å–Transactionå¯¹è±¡


**åŸºæœ¬ç”¨æ³•**
```java
// 1. è·å–Session
Session session = sessionFactory.openSession();

// 2. è·å–Transactionå¯¹è±¡
Transaction tx = session.beginTransaction();

// æ³¨æ„ï¼šbeginTransaction()æ—¢è·å–Transactionåˆå¼€å¯äº‹åŠ¡
```

**ğŸ¤” ä¸ºä»€ä¹ˆè¦é€šè¿‡Sessionè·å–ï¼Ÿ**
> Sessionä»£è¡¨ä¸æ•°æ®åº“çš„ä¸€æ¬¡ä¼šè¯ï¼Œäº‹åŠ¡æ˜¯ä¼šè¯å†…çš„æ“ä½œå•å…ƒï¼Œæ‰€ä»¥äº‹åŠ¡å¿…é¡»ä¾é™„äºSessionå­˜åœ¨ã€‚

---

## 3. âš™ï¸ äº‹åŠ¡çš„åŸºæœ¬æ“ä½œ


### 3.1 å¼€å§‹äº‹åŠ¡ - begin()


**ğŸ”¸ ä½œç”¨**ï¼šæ ‡è®°äº‹åŠ¡çš„èµ·ç‚¹ï¼Œä»è¿™ä¸€åˆ»å¼€å§‹æ‰€æœ‰æ“ä½œéƒ½åœ¨äº‹åŠ¡æ§åˆ¶ä¸‹

**ä½¿ç”¨æ–¹å¼**
```java
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction(); // è‡ªåŠ¨è°ƒç”¨begin()

// æˆ–è€…æ˜¾å¼è°ƒç”¨
Transaction tx = session.getTransaction();
tx.begin();
```

**ğŸ“Œ è®°å¿†è¦ç‚¹**
- `beginTransaction()` = è·å–Transaction + è‡ªåŠ¨begin()
- `getTransaction()` = ä»…è·å–ï¼Œéœ€æ‰‹åŠ¨begin()
- **æ¨èç”¨æ³•**ï¼šç›´æ¥ç”¨`beginTransaction()`æ›´ç®€æ´

### 3.2 æäº¤äº‹åŠ¡ - commit()


**ğŸ”¸ ä½œç”¨**ï¼šç¡®è®¤äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œå°†ä¿®æ”¹æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“

**å®Œæ•´ç¤ºä¾‹**
```java
Session session = null;
Transaction tx = null;

try {
    session = sessionFactory.openSession();
    tx = session.beginTransaction();
    
    // ä¸šåŠ¡æ“ä½œ
    User user = new User("å¼ ä¸‰", 25);
    session.save(user);
    
    // æäº¤äº‹åŠ¡
    tx.commit(); // â† è¿™é‡Œæ•°æ®æ‰çœŸæ­£å†™å…¥æ•°æ®åº“
    
} catch (Exception e) {
    e.printStackTrace();
}
```

**ğŸ’¡ æäº¤æ—¶æœºçš„ç†è§£**
```
æ²¡æäº¤å‰ï¼šæ•°æ®åœ¨å†…å­˜ä¸­ï¼ˆç¼“å­˜ï¼‰
æäº¤åï¼šæ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“è¡¨

ç±»æ¯”ï¼šWordæ–‡æ¡£
ç¼–è¾‘å†…å®¹ â†’ å†…å­˜ä¸­çš„ä¿®æ”¹ï¼ˆæœªä¿å­˜ï¼‰
ç‚¹å‡»ä¿å­˜ â†’ å†™å…¥ç£ç›˜æ–‡ä»¶ï¼ˆå·²ä¿å­˜ï¼‰
```

### 3.3 å›æ»šäº‹åŠ¡ - rollback()


**ğŸ”¸ ä½œç”¨**ï¼šæ’¤é”€äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€

**æ ‡å‡†ç”¨æ³•**
```java
Session session = null;
Transaction tx = null;

try {
    session = sessionFactory.openSession();
    tx = session.beginTransaction();
    
    // æ“ä½œ1ï¼šä¿å­˜ç”¨æˆ·
    User user = new User("æå››", 30);
    session.save(user);
    
    // æ“ä½œ2ï¼šå¯èƒ½å‡ºé”™çš„æ“ä½œ
    int result = 10 / 0; // äººä¸ºåˆ¶é€ å¼‚å¸¸
    
    tx.commit(); // ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
    
} catch (Exception e) {
    if (tx != null) {
        tx.rollback(); // â† æ’¤é”€æ‰€æœ‰æ“ä½œ
    }
    e.printStackTrace();
}
```

**ğŸ¬ å›æ»šåœºæ™¯å‰§åœº**
```
åœºæ™¯ï¼šè½¬è´¦æ“ä½œ

1. å¼€å§‹äº‹åŠ¡
2. Aè´¦æˆ·æ‰£æ¬¾ -1000 âœ“
3. Bè´¦æˆ·åŠ æ¬¾ +1000 âœ— (è´¦æˆ·è¢«å†»ç»“)
4. æ•è·å¼‚å¸¸
5. æ‰§è¡Œrollback()
6. Aè´¦æˆ·æ¢å¤åŸçŠ¶ï¼Œæ‰£æ¬¾æ“ä½œè¢«æ’¤é”€
```

---

## 4. ğŸ” ACIDç‰¹æ€§æ·±å…¥ç†è§£


### 4.1 åŸå­æ€§ï¼ˆAtomicityï¼‰


**ğŸ”¸ å®šä¹‰**ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°å•ä½ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥

**é€šä¿—ç†è§£**
```
åŸå­ = ä¸å¯å†åˆ†çš„æœ€å°å•ä½
äº‹åŠ¡çš„åŸå­æ€§ = ä¸èƒ½åªåšä¸€åŠ

å°±åƒä¹°å¥¶èŒ¶ï¼š
âœ“ ä»˜é’± + æ‹¿åˆ°å¥¶èŒ¶ â†’ äº¤æ˜“æˆåŠŸ
âœ— ä»˜é’± + æ²¡æ‹¿åˆ°å¥¶èŒ¶ â†’ å¿…é¡»é€€æ¬¾
âœ— æ‹¿åˆ°å¥¶èŒ¶ + æ²¡ä»˜é’± â†’ è¿™æ˜¯æŠ¢åŠ«
```

**ä»£ç ä½“ç°**
```java
tx.begin();
session.save(order);      // åˆ›å»ºè®¢å•
session.update(inventory); // å‡åº“å­˜
tx.commit(); // ä¸¤ä¸ªæ“ä½œä½œä¸ºæ•´ä½“æäº¤

// å¦‚æœå‡åº“å­˜å¤±è´¥ï¼Œè®¢å•åˆ›å»ºä¹Ÿä¼šè¢«æ’¤é”€
```

### 4.2 ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰


**ğŸ”¸ å®šä¹‰**ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®éƒ½å¤„äºåˆæ³•çš„ä¸€è‡´çŠ¶æ€

**é€šä¿—ç†è§£**
```
æ•°æ®åº“çš„è§„åˆ™ä¸èƒ½è¢«ç ´å

ä¾‹å¦‚è½¬è´¦ï¼š
è½¬è´¦å‰ï¼šAè´¦æˆ·1000 + Bè´¦æˆ·2000 = 3000
è½¬è´¦åï¼šAè´¦æˆ·0 + Bè´¦æˆ·3000 = 3000
æ€»é‡‘é¢å®ˆæ’ï¼

å¦‚æœå˜æˆï¼š
è½¬è´¦åï¼šAè´¦æˆ·0 + Bè´¦æˆ·2000 = 2000
â†’ é’±å‡­ç©ºæ¶ˆå¤±ï¼Œè¿åä¸€è‡´æ€§
```

**ä¸šåŠ¡è§„åˆ™ç¤ºä¾‹**
| è§„åˆ™ç±»å‹ | ç¤ºä¾‹ | ä¸€è‡´æ€§ä¿è¯ |
|---------|------|-----------|
| **å”¯ä¸€æ€§çº¦æŸ** | ç”¨æˆ·åä¸èƒ½é‡å¤ | æäº¤å‰æ£€æŸ¥ï¼Œå†²çªåˆ™å›æ»š |
| **å¤–é”®çº¦æŸ** | è®¢å•å¿…é¡»å…³è”ç”¨æˆ· | ç”¨æˆ·ä¸å­˜åœ¨åˆ™äº‹åŠ¡å¤±è´¥ |
| **ä¸šåŠ¡è§„åˆ™** | åº“å­˜ä¸èƒ½ä¸ºè´Ÿæ•° | æ‰£å‡å‰æ£€æŸ¥ï¼Œä¸è¶³åˆ™å›æ»š |

### 4.3 éš”ç¦»æ€§ï¼ˆIsolationï¼‰


**ğŸ”¸ å®šä¹‰**ï¼šå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°

**é€šä¿—ç†è§£**
```
é“¶è¡ŒæŸœå°ç±»æ¯”ï¼š
- æ¯ä¸ªçª—å£å¤„ç†ä¸€ä¸ªå®¢æˆ·ï¼ˆä¸€ä¸ªäº‹åŠ¡ï¼‰
- å„çª—å£ä¹‹é—´äº’ä¸å½±å“
- Aå®¢æˆ·çš„è½¬è´¦ä¸ä¼šå½±å“Bå®¢æˆ·çš„æŸ¥è¯¢
```

**å¹¶å‘é—®é¢˜åœºæ™¯**
```
é—®é¢˜1ï¼šè„è¯»
äº‹åŠ¡Aä¿®æ”¹æ•°æ® â†’ äº‹åŠ¡Bè¯»å– â†’ äº‹åŠ¡Aå›æ»š
â†’ Bè¯»åˆ°äº†"è„æ•°æ®"ï¼ˆä¸è¯¥å­˜åœ¨çš„æ•°æ®ï¼‰

é—®é¢˜2ï¼šä¸å¯é‡å¤è¯»  
äº‹åŠ¡Aè¯»å–æ•°æ® â†’ äº‹åŠ¡Bä¿®æ”¹æäº¤ â†’ äº‹åŠ¡Aå†è¯»å–
â†’ åŒä¸€äº‹åŠ¡ä¸¤æ¬¡è¯»å–ç»“æœä¸ä¸€æ ·

é—®é¢˜3ï¼šå¹»è¯»
äº‹åŠ¡AæŸ¥è¯¢10æ¡ â†’ äº‹åŠ¡Bæ’å…¥5æ¡ â†’ äº‹åŠ¡Aå†æŸ¥è¯¢
â†’ çªç„¶å¤šå‡ºäº†æ•°æ®ï¼Œåƒ"å¹»è§‰"
```

**ğŸ”§ éš”ç¦»çº§åˆ«å¯¹æ¯”**

| éš”ç¦»çº§åˆ« | **è„è¯»** | **ä¸å¯é‡å¤è¯»** | **å¹»è¯»** | **æ€§èƒ½** |
|---------|---------|--------------|---------|---------|
| **READ_UNCOMMITTED** | `å¯èƒ½å‘ç”Ÿ` | `å¯èƒ½å‘ç”Ÿ` | `å¯èƒ½å‘ç”Ÿ` | `æœ€é«˜` |
| **READ_COMMITTED** | `å·²è§£å†³` | `å¯èƒ½å‘ç”Ÿ` | `å¯èƒ½å‘ç”Ÿ` | `è¾ƒé«˜` |
| **REPEATABLE_READ** | `å·²è§£å†³` | `å·²è§£å†³` | `å¯èƒ½å‘ç”Ÿ` | `è¾ƒä½` |
| **SERIALIZABLE** | `å·²è§£å†³` | `å·²è§£å†³` | `å·²è§£å†³` | `æœ€ä½` |

**ğŸ“Œ è®°å¿†æŠ€å·§**
> éš”ç¦»çº§åˆ«è¶Šé«˜ = å®‰å…¨æ€§è¶Šé«˜ = æ€§èƒ½è¶Šä½
> å®é™…å¼€å‘ï¼šå¤§å¤šç”¨ READ_COMMITTEDï¼ˆOracleé»˜è®¤ï¼‰æˆ– REPEATABLE_READï¼ˆMySQLé»˜è®¤ï¼‰

### 4.4 æŒä¹…æ€§ï¼ˆDurabilityï¼‰


**ğŸ”¸ å®šä¹‰**ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œæ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„

**é€šä¿—ç†è§£**
```
å°±åƒåœ¨çº¸ä¸Šç­¾äº†å­—ï¼š
- ç­¾å­—å‰ï¼šå¯ä»¥æ“¦æ‰é‡å†™ï¼ˆæœªæäº¤ï¼‰
- ç­¾å­—åï¼šæ°¸ä¹…è®°å½•ï¼ˆå·²æäº¤ï¼‰

å³ä½¿ï¼š
- ç³»ç»Ÿæ–­ç”µ
- æ•°æ®åº“å´©æºƒ
- æœåŠ¡å™¨é‡å¯

å·²æäº¤çš„æ•°æ®ä¾ç„¶å­˜åœ¨ï¼
```

**æŠ€æœ¯å®ç°**
```
æ•°æ®åº“å¦‚ä½•ä¿è¯æŒä¹…æ€§ï¼Ÿ
1. äº‹åŠ¡æ—¥å¿—ï¼ˆRedo Logï¼‰ï¼šè®°å½•æ‰€æœ‰ä¿®æ”¹
2. æäº¤æ—¶å…ˆå†™æ—¥å¿—
3. æ—¥å¿—åŒæ­¥åˆ°ç£ç›˜
4. å´©æºƒåæ ¹æ®æ—¥å¿—æ¢å¤æ•°æ®
```

---

## 5. ğŸ¯ äº‹åŠ¡è¾¹ç•Œç®¡ç†


### 5.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡è¾¹ç•Œï¼Ÿ


**ğŸ”¸ å®šä¹‰**ï¼šäº‹åŠ¡çš„å¼€å§‹å’Œç»“æŸèŒƒå›´

**è¾¹ç•Œä¸‰è¦ç´ **
```
èµ·ç‚¹ï¼šbegin() æˆ– beginTransaction()
ç»ˆç‚¹ï¼šcommit() æˆ– rollback()
èŒƒå›´ï¼šä¸¤è€…ä¹‹é—´çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œ
```

**è¾¹ç•Œåˆ’åˆ†åŸåˆ™**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹åŠ¡è¾¹ç•Œåº”è¯¥åŒ…å«ï¼š               â”‚
â”‚                                 â”‚
â”‚ âœ“ ç›¸å…³è”çš„å¤šä¸ªæ•°æ®åº“æ“ä½œ         â”‚
â”‚ âœ“ å¿…é¡»ä¿è¯åŸå­æ€§çš„æ“ä½œç»„åˆ       â”‚
â”‚ âœ“ æœ‰ä¸šåŠ¡é€»è¾‘å…³è”çš„å¢åˆ æ”¹         â”‚
â”‚                                 â”‚
â”‚ âœ— ä¸åº”è¯¥åŒ…å«ï¼š                  â”‚
â”‚ âœ— æ— å…³çš„ç‹¬ç«‹æ“ä½œ                â”‚
â”‚ âœ— çº¯ç²¹çš„æŸ¥è¯¢æ“ä½œï¼ˆé€šå¸¸ä¸éœ€è¦ï¼‰   â”‚
â”‚ âœ— è¿‡é•¿çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå½±å“æ€§èƒ½ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 åˆç†çš„è¾¹ç•Œåˆ’åˆ†


**âŒ è¾¹ç•Œè¿‡å¤§ï¼ˆä¸æ¨èï¼‰**
```java
// é—®é¢˜ï¼šäº‹åŠ¡åŒ…å«äº†å¤ªå¤šæ“ä½œï¼ŒæŒç»­æ—¶é—´é•¿
tx.begin();
æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨();        // 100ms
å‘é€é‚®ä»¶é€šçŸ¥();        // 5000ms  â† ä¸è¯¥åœ¨äº‹åŠ¡å†…
ç”ŸæˆPDFæŠ¥å‘Š();         // 3000ms  â† ä¸è¯¥åœ¨äº‹åŠ¡å†…
æ›´æ–°ç”¨æˆ·çŠ¶æ€();        // 10ms
tx.commit();

// é—®é¢˜ï¼šäº‹åŠ¡æŒç»­8ç§’ï¼Œé”å®šèµ„æºæ—¶é—´è¿‡é•¿
```

**âŒ è¾¹ç•Œè¿‡å°ï¼ˆä¸æ¨èï¼‰**
```java
// é—®é¢˜ï¼šç›¸å…³æ“ä½œè¢«æ‹†åˆ†åˆ°å¤šä¸ªäº‹åŠ¡
tx1.begin();
ä¿å­˜è®¢å•();
tx1.commit();

tx2.begin();
æ‰£å‡åº“å­˜();  // å¦‚æœè¿™é‡Œå¤±è´¥ï¼Œè®¢å•å·²ç»ä¿å­˜äº†ï¼
tx2.commit();

// é—®é¢˜ï¼šæ— æ³•ä¿è¯æ•´ä½“çš„åŸå­æ€§
```

**âœ… åˆç†çš„è¾¹ç•Œï¼ˆæ¨èï¼‰**
```java
tx.begin();
// ä¸€ç»„ç›¸å…³çš„æ•°æ®åº“æ“ä½œ
ä¿å­˜è®¢å•();
æ‰£å‡åº“å­˜();
æ›´æ–°ç”¨æˆ·ç§¯åˆ†();
tx.commit();

// éæ•°æ®åº“æ“ä½œæ”¾åœ¨äº‹åŠ¡å¤–
å‘é€é‚®ä»¶é€šçŸ¥();  // å¼‚æ­¥å¤„ç†
ç”ŸæˆPDFæŠ¥å‘Š();   // ç‹¬ç«‹ä»»åŠ¡
```

### 5.3 Sessionä¸äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ


**ğŸ”„ æ ‡å‡†ç”Ÿå‘½å‘¨æœŸ**
```
å¼€å¯Session â†’ å¼€å¯äº‹åŠ¡ â†’ æ‰§è¡Œæ“ä½œ â†’ æäº¤/å›æ»š â†’ å…³é—­Session

Session session = factory.openSession();      // 1. å¼€å¯ä¼šè¯
Transaction tx = session.beginTransaction();  // 2. å¼€å¯äº‹åŠ¡
try {
    // 3. æ‰§è¡Œæ“ä½œ
    session.save(user);
    tx.commit();                              // 4. æäº¤
} catch (Exception e) {
    tx.rollback();                            // 4. å›æ»š
} finally {
    session.close();                          // 5. å…³é—­ä¼šè¯
}
```

**âš ï¸ æ˜“é”™é‡ç‚¹**
> Sessionå…³é—­åï¼Œäº‹åŠ¡ä¹Ÿéšä¹‹ç»“æŸ
> ä¸èƒ½åœ¨Sessionå…³é—­åå†commitæˆ–rollback

---

## 6. ğŸš¨ å¼‚å¸¸å¤„ç†ä¸å›æ»š


### 6.1 å¼‚å¸¸å¤„ç†çš„æ ‡å‡†æ¨¡å¼


**å®Œæ•´çš„å¼‚å¸¸å¤„ç†**
```java
Session session = null;
Transaction tx = null;

try {
    // 1. å¼€å¯èµ„æº
    session = sessionFactory.openSession();
    tx = session.beginTransaction();
    
    // 2. ä¸šåŠ¡æ“ä½œ
    User user = new User("ç‹äº”", 28);
    session.save(user);
    
    // 3. æäº¤äº‹åŠ¡
    tx.commit();
    
} catch (Exception e) {
    // 4. å‘ç”Ÿå¼‚å¸¸æ—¶å›æ»š
    if (tx != null && tx.isActive()) {
        tx.rollback();
    }
    
    // 5. è®°å½•æ—¥å¿—
    e.printStackTrace();
    // æˆ–ä½¿ç”¨æ—¥å¿—æ¡†æ¶ï¼šlogger.error("äº‹åŠ¡å¤±è´¥", e);
    
} finally {
    // 6. é‡Šæ”¾èµ„æº
    if (session != null && session.isOpen()) {
        session.close();
    }
}
```

**ğŸ“Œ å…³é”®æ£€æŸ¥**
- `tx != null` â†’ é˜²æ­¢Transactionæœªåˆå§‹åŒ–
- `tx.isActive()` â†’ é˜²æ­¢é‡å¤å›æ»šå·²ç»“æŸçš„äº‹åŠ¡
- `session.isOpen()` â†’ é˜²æ­¢å…³é—­å·²å…³é—­çš„Session

### 6.2 å¸¸è§å¼‚å¸¸åœºæ™¯


**åœºæ™¯1ï¼šçº¦æŸå†²çª**
```java
try {
    tx.begin();
    
    User user = new User();
    user.setUsername("admin"); // ç”¨æˆ·åå·²å­˜åœ¨
    session.save(user);
    
    tx.commit();
    
} catch (ConstraintViolationException e) {
    // å¤„ç†å”¯ä¸€æ€§çº¦æŸå†²çª
    tx.rollback();
    System.out.println("ç”¨æˆ·åå·²å­˜åœ¨ï¼");
}
```

**åœºæ™¯2ï¼šæ•°æ®éªŒè¯å¤±è´¥**
```java
try {
    tx.begin();
    
    Product product = new Product();
    product.setStock(-10); // åº“å­˜ä¸ºè´Ÿæ•°ï¼Œä¸åˆæ³•
    session.save(product);
    
    tx.commit();
    
} catch (ValidationException e) {
    tx.rollback();
    System.out.println("æ•°æ®éªŒè¯å¤±è´¥ï¼š" + e.getMessage());
}
```

**åœºæ™¯3ï¼šå¹¶å‘å†²çª**
```java
try {
    tx.begin();
    
    // ä¹è§‚é”ç‰ˆæœ¬å†²çª
    Product product = session.get(Product.class, 1L);
    product.setStock(product.getStock() - 1);
    session.update(product);
    
    tx.commit();
    
} catch (StaleObjectStateException e) {
    tx.rollback();
    System.out.println("æ•°æ®å·²è¢«å…¶ä»–ç”¨æˆ·ä¿®æ”¹ï¼Œè¯·é‡è¯•ï¼");
}
```

### 6.3 å›æ»šåçš„æ•°æ®çŠ¶æ€


**å›æ»šçš„å½±å“èŒƒå›´**
```
å›æ»šåï¼š
âœ“ æ•°æ®åº“æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€
âœ“ æ‰€æœ‰INSERT/UPDATE/DELETEè¢«æ’¤é”€
âœ— ä½†Javaå¯¹è±¡çš„çŠ¶æ€ä¸ä¼šè‡ªåŠ¨æ¢å¤ï¼
```

**ğŸ§ª åŠ¨æ‰‹éªŒè¯**
```java
User user = new User("æµ‹è¯•ç”¨æˆ·", 20);
user.setId(1L);

tx.begin();
session.save(user);
System.out.println("ä¿å­˜åID: " + user.getId()); // æœ‰IDå€¼

tx.rollback(); // å›æ»š
System.out.println("å›æ»šåID: " + user.getId()); // IDè¿˜åœ¨ï¼

// å†…å­˜ä¸­çš„å¯¹è±¡ä¸ä¼šå› ä¸ºå›æ»šè€Œæ”¹å˜
// ä½†æ•°æ®åº“ä¸­æ²¡æœ‰è¿™æ¡è®°å½•
```

---

## 7. ğŸ’» ç¼–ç¨‹å¼äº‹åŠ¡vså£°æ˜å¼äº‹åŠ¡


### 7.1 ç¼–ç¨‹å¼äº‹åŠ¡


**ğŸ”¸ ç‰¹ç‚¹**ï¼šåœ¨ä»£ç ä¸­æ˜¾å¼æ§åˆ¶äº‹åŠ¡çš„å¼€å¯ã€æäº¤ã€å›æ»š

**æ ‡å‡†å†™æ³•**
```java
public void saveUser(User user) {
    Session session = null;
    Transaction tx = null;
    
    try {
        session = sessionFactory.openSession();
        tx = session.beginTransaction();  // æ‰‹åŠ¨å¼€å¯
        
        session.save(user);
        
        tx.commit();  // æ‰‹åŠ¨æäº¤
        
    } catch (Exception e) {
        if (tx != null) {
            tx.rollback();  // æ‰‹åŠ¨å›æ»š
        }
    } finally {
        if (session != null) {
            session.close();
        }
    }
}
```

**ä¼˜ç¼ºç‚¹å¯¹æ¯”**
```
âœ… ä¼˜ç‚¹ï¼š
- æ§åˆ¶çµæ´»ï¼Œå¯ä»¥ç²¾ç¡®ç®¡ç†äº‹åŠ¡è¾¹ç•Œ
- é€‚åˆå¤æ‚çš„äº‹åŠ¡é€»è¾‘
- æ¸…æ™°æ˜äº†ï¼Œå®¹æ˜“è°ƒè¯•

âŒ ç¼ºç‚¹ï¼š
- ä»£ç é‡å¤ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½è¦å†™try-catch
- å®¹æ˜“é—æ¼ï¼Œå¿˜è®°commitæˆ–rollback
- ä¸ä¸šåŠ¡ä»£ç è€¦åˆ
```

### 7.2 å£°æ˜å¼äº‹åŠ¡


**ğŸ”¸ ç‰¹ç‚¹**ï¼šé€šè¿‡é…ç½®æˆ–æ³¨è§£å£°æ˜äº‹åŠ¡ï¼Œæ¡†æ¶è‡ªåŠ¨ç®¡ç†

**Springæ³¨è§£æ–¹å¼**
```java
@Transactional  // å£°æ˜å¼äº‹åŠ¡æ³¨è§£
public void saveUser(User user) {
    session.save(user);
    // ä¸éœ€è¦æ‰‹åŠ¨begin/commit/rollback
    // Springè‡ªåŠ¨ç®¡ç†äº‹åŠ¡
}
```

**XMLé…ç½®æ–¹å¼**
```xml
<!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ -->
<bean id="transactionManager" 
      class="org.springframework.orm.hibernate5.HibernateTransactionManager">
    <property name="sessionFactory" ref="sessionFactory"/>
</bean>

<!-- å¼€å¯äº‹åŠ¡æ³¨è§£ -->
<tx:annotation-driven transaction-manager="transactionManager"/>
```

**ä¼˜ç¼ºç‚¹å¯¹æ¯”**
```
âœ… ä¼˜ç‚¹ï¼š
- ä»£ç ç®€æ´ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
- å‡å°‘é‡å¤ä»£ç 
- ä¸šåŠ¡é€»è¾‘ä¸äº‹åŠ¡ç®¡ç†è§£è€¦
- æ˜“äºç»´æŠ¤å’Œä¿®æ”¹

âŒ ç¼ºç‚¹ï¼š
- çµæ´»æ€§è¾ƒä½
- éœ€è¦ç†è§£æ¡†æ¶çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶
- è°ƒè¯•ç›¸å¯¹å¤æ‚
```

### 7.3 ä¸¤ç§æ–¹å¼çš„é€‰æ‹©å»ºè®®


| åœºæ™¯ | **æ¨èæ–¹å¼** | **ç†ç”±** |
|-----|------------|---------|
| **ç®€å•CRUDæ“ä½œ** | `å£°æ˜å¼äº‹åŠ¡` | `ä»£ç ç®€æ´ï¼Œè‡ªåŠ¨ç®¡ç†` |
| **å¤æ‚ä¸šåŠ¡é€»è¾‘** | `ç¼–ç¨‹å¼äº‹åŠ¡` | `æ›´ç²¾ç»†çš„æ§åˆ¶` |
| **Springé¡¹ç›®** | `å£°æ˜å¼äº‹åŠ¡` | `ä¸æ¡†æ¶é›†æˆå¥½` |
| **ç‹¬ç«‹Hibernate** | `ç¼–ç¨‹å¼äº‹åŠ¡` | `æ— é¢å¤–ä¾èµ–` |
| **å­¦ä¹ é˜¶æ®µ** | `ç¼–ç¨‹å¼äº‹åŠ¡` | `ç†è§£äº‹åŠ¡åŸç†` |

**ğŸ¯ å®é™…å¼€å‘å»ºè®®**
> æ–°æ‰‹é˜¶æ®µï¼šå…ˆæŒæ¡ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œç†è§£äº‹åŠ¡åŸç†
> è¿›é˜¶é˜¶æ®µï¼šå­¦ä¹ å£°æ˜å¼äº‹åŠ¡ï¼Œæé«˜å¼€å‘æ•ˆç‡
> å®é™…é¡¹ç›®ï¼šæ ¹æ®åœºæ™¯æ··åˆä½¿ç”¨

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡æœ¬è´¨ï¼šæŠŠå¤šä¸ªæ“ä½œç»„åˆæˆåŸå­å•å…ƒ
ğŸ”¸ Transactionæ¥å£ï¼šbegin()ã€commit()ã€rollback()
ğŸ”¸ ACIDç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§
ğŸ”¸ äº‹åŠ¡è¾¹ç•Œï¼šåˆç†åˆ’åˆ†äº‹åŠ¡çš„å¼€å§‹å’Œç»“æŸèŒƒå›´
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šæ ‡å‡†çš„try-catch-finallyæ¨¡å¼
ğŸ”¸ ä¸¤ç§äº‹åŠ¡ï¼šç¼–ç¨‹å¼æ‰‹åŠ¨æ§åˆ¶ï¼Œå£°æ˜å¼æ¡†æ¶ç®¡ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡ï¼Ÿ**
```
é˜²æ­¢æ•°æ®ä¸ä¸€è‡´ï¼š
- è½¬è´¦æ—¶é˜²æ­¢é’±ä¸¢å¤±
- ä¸‹å•æ—¶ä¿è¯åº“å­˜å’Œè®¢å•åŒæ­¥
- æ‰¹é‡æ“ä½œæ—¶ä¿è¯å®Œæ•´æ€§
```

**ğŸ”¹ æäº¤å’Œå›æ»šçš„æ—¶æœº**
```
æäº¤ï¼ˆcommitï¼‰ï¼š
- æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸæ‰§è¡Œ
- æ•°æ®é€šè¿‡éªŒè¯
- ä¸šåŠ¡é€»è¾‘æ­£ç¡®

å›æ»šï¼ˆrollbackï¼‰ï¼š
- æ•è·åˆ°å¼‚å¸¸
- ä¸šåŠ¡è§„åˆ™ä¸æ»¡è¶³
- æ•°æ®éªŒè¯å¤±è´¥
```

**ğŸ”¹ äº‹åŠ¡è¾¹ç•Œçš„åŸåˆ™**
```
âœ“ åŒ…å«ç›¸å…³è”çš„æ“ä½œ
âœ“ å°½é‡çŸ­å°ç²¾æ‚
âœ“ é¿å…åŒ…å«è€—æ—¶æ“ä½œ

âœ— ä¸è¦è·¨è¶Šå¤šä¸ªä¸šåŠ¡æ¨¡å—
âœ— ä¸è¦åŒ…å«IOæ“ä½œ
âœ— ä¸è¦é•¿æ—¶é—´æŒæœ‰é”
```

### 8.3 å®æˆ˜æ£€éªŒæ¸…å•


**âœ… æœ¬ç« å­¦ä¹ æ£€æŸ¥**
- [ ] èƒ½è§£é‡Šäº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼ˆACIDï¼‰
- [ ] èƒ½å†™å‡ºæ ‡å‡†çš„äº‹åŠ¡å¤„ç†ä»£ç 
- [ ] ç†è§£commitå’Œrollbackçš„åŒºåˆ«
- [ ] æŒæ¡å¼‚å¸¸å¤„ç†çš„å®Œæ•´æµç¨‹
- [ ] äº†è§£ç¼–ç¨‹å¼å’Œå£°æ˜å¼äº‹åŠ¡çš„å·®å¼‚

**ğŸ“Š æŒæ¡åº¦è‡ªè¯„**
- ç†è®ºç†è§£ï¼šâ­â­â­â­â­ (5/5)
- ä»£ç ç¼–å†™ï¼šâ­â­â­â­â˜† (4/5)
- å¼‚å¸¸å¤„ç†ï¼šâ­â­â­â­â˜† (4/5)

### 8.4 å¸¸è§é—®é¢˜FAQ


**Q1ï¼šä¸ºä»€ä¹ˆæäº¤åå¼‚å¸¸ï¼Œæ•°æ®è¿˜æ˜¯ä¿å­˜äº†ï¼Ÿ**
```
Aï¼šcommit()æˆåŠŸåï¼Œæ•°æ®å·²æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“
   åç»­çš„å¼‚å¸¸æ— æ³•å½±å“å·²æäº¤çš„äº‹åŠ¡
   
è§£å†³ï¼šå°†å¯èƒ½å¼‚å¸¸çš„æ“ä½œæ”¾åœ¨commitä¹‹å‰
```

**Q2ï¼šSessionå…³é—­åè¿˜èƒ½å›æ»šå—ï¼Ÿ**
```
Aï¼šä¸èƒ½ï¼Sessionå…³é—­æ„å‘³ç€äº‹åŠ¡å·²ç»“æŸ
   
æ­£ç¡®åšæ³•ï¼š
1. å…ˆå¤„ç†äº‹åŠ¡ï¼ˆcommitæˆ–rollbackï¼‰
2. å†å…³é—­Session
```

**Q3ï¼šæŸ¥è¯¢æ“ä½œéœ€è¦äº‹åŠ¡å—ï¼Ÿ**
```
Aï¼šé€šå¸¸ä¸éœ€è¦ï¼Œä½†å»ºè®®å¼€å¯ï¼š
- ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆå¯é‡å¤è¯»ï¼‰
- æŸäº›æ•°æ®åº“è¦æ±‚å¿…é¡»åœ¨äº‹åŠ¡ä¸­
- å¤æ‚æŸ¥è¯¢æ—¶é¿å…è„è¯»
```

### 8.5 è¿›é˜¶å­¦ä¹ è·¯çº¿


**ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ **
```
1. äº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼ˆSpringï¼‰
2. åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆXAåè®®ï¼‰
3. äº‹åŠ¡éš”ç¦»çº§åˆ«è°ƒä¼˜
4. ä¹è§‚é”ä¸æ‚²è§‚é”
5. æ•°æ®åº“æ­»é”é—®é¢˜
```

**ğŸ“– æ¨èèµ„æº**
- Hibernateå®˜æ–¹æ–‡æ¡£ï¼šTransactionç« èŠ‚
- Springäº‹åŠ¡ç®¡ç†æ–‡æ¡£
- ã€ŠMySQLå¿…çŸ¥å¿…ä¼šã€‹ï¼šäº‹åŠ¡ç¯‡

---

**ğŸ¯ è®°å¿†é”šç‚¹**

> äº‹åŠ¡å°±åƒé“¶è¡Œè½¬è´¦ï¼šè¦ä¹ˆæˆåŠŸåˆ°è´¦ï¼Œè¦ä¹ˆå…¨é¢é€€å›ï¼Œç»ä¸ä¼šä¸¢é’±ï¼
> 
> **å››å­—å£è¯€**ï¼šåŸä¸€éš”æŒï¼ˆåŸå­ã€ä¸€è‡´ã€éš”ç¦»ã€æŒä¹…ï¼‰
> **æ“ä½œä¸‰æ­¥**ï¼šå¼€å§‹â†’æ‰§è¡Œâ†’æäº¤/å›æ»š
> **å¼‚å¸¸å¿…å›æ»š**ï¼šcatchä¸­å¿…æœ‰rollback

**æ ¸å¿ƒè®°ä½**ï¼šäº‹åŠ¡ç®¡ç†çš„æœ¬è´¨æ˜¯ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ï¼Œå®å¯æ“ä½œå¤±è´¥ï¼Œä¹Ÿä¸èƒ½æ•°æ®å‡ºé”™ï¼