---
title: 40ã€åŸç”ŸSQLæŸ¥è¯¢åŸºç¡€
---
## ğŸ“š ç›®å½•


1. [åŸç”ŸSQLåŸºç¡€æ¦‚å¿µ](#1-åŸç”ŸSQLåŸºç¡€æ¦‚å¿µ)
2. [createSQLQueryæ–¹æ³•è¯¦è§£](#2-createSQLQueryæ–¹æ³•è¯¦è§£)
3. [åŸç”ŸSQLæ‰§è¡Œæ–¹å¼](#3-åŸç”ŸSQLæ‰§è¡Œæ–¹å¼)
4. [ç»“æœæ˜ å°„æœºåˆ¶](#4-ç»“æœæ˜ å°„æœºåˆ¶)
5. [å®ä½“æ˜ å°„è¯¦è§£](#5-å®ä½“æ˜ å°„è¯¦è§£)
6. [æ ‡é‡ç»“æœå¤„ç†](#6-æ ‡é‡ç»“æœå¤„ç†)
7. [æ··åˆç»“æœå¤„ç†](#7-æ··åˆç»“æœå¤„ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šæŒæ¡HQLæŸ¥è¯¢ã€HibernateåŸºç¡€é…ç½® â†’ **å½“å‰å†…å®¹**ï¼šNative SQLæŸ¥è¯¢ â†’ **åç»­å­¦ä¹ **ï¼šCriteria APIæŸ¥è¯¢

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« çº¦45åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

---

## 1. ğŸŒŸ åŸç”ŸSQLåŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯åŸç”ŸSQLæŸ¥è¯¢



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
åŸç”ŸSQL (Native SQL)ï¼šç›´æ¥ä½¿ç”¨æ•°æ®åº“çš„SQLè¯­å¥è¿›è¡ŒæŸ¥è¯¢
åŒºåˆ«äºHQLï¼šHQLæ“ä½œçš„æ˜¯å¯¹è±¡ï¼ŒSQLæ“ä½œçš„æ˜¯æ•°æ®åº“è¡¨
ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦ç”¨æ•°æ®åº“ç‰¹å®šåŠŸèƒ½æˆ–ä¼˜åŒ–æ€§èƒ½æ—¶
```

**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼š
- **HQLæ–¹å¼**ï¼šå‘Šè¯‰æœåŠ¡å‘˜"æˆ‘è¦ç‰›æ’å¥—é¤"ï¼ŒæœåŠ¡å‘˜å¸®ä½ å¤„ç†ç»†èŠ‚
- **åŸç”ŸSQL**ï¼šç›´æ¥è¿›å¨æˆ¿ï¼Œè‡ªå·±æŒ‡å®šç”¨ä»€ä¹ˆé”…ã€ä»€ä¹ˆç«å€™ã€æ€ä¹ˆåš

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åŸç”ŸSQL



**ğŸ¯ ä½¿ç”¨åŸç”ŸSQLçš„ç†ç”±**

| åœºæ™¯ | HQLå¤Ÿç”¨å— | éœ€è¦åŸç”ŸSQLçš„åŸå›  |
|------|----------|------------------|
| **ç®€å•æŸ¥è¯¢** | âœ… å¤Ÿç”¨ | ä½¿ç”¨HQLæ›´æ–¹ä¾¿ |
| **æ•°æ®åº“ç‰¹å®šå‡½æ•°** | âŒ ä¸å¤Ÿ | å¦‚MySQLçš„`CONCAT_WS`ã€Oracleçš„`DECODE` |
| **å¤æ‚ç»Ÿè®¡æŠ¥è¡¨** | âŒ ä¸å¤Ÿ | éœ€è¦ç”¨åˆ°çª—å£å‡½æ•°ã€åˆ†ç»„ç»Ÿè®¡ |
| **æ€§èƒ½ä¼˜åŒ–** | âŒ ä¸å¤Ÿ | éœ€è¦æ•°æ®åº“ç‰¹å®šçš„ç´¢å¼•æç¤º |
| **é—ç•™ç³»ç»Ÿé›†æˆ** | âŒ ä¸å¤Ÿ | å·²æœ‰çš„SQLè¯­å¥éœ€è¦å¤ç”¨ |

**ğŸ’­ æ€è€ƒé—®é¢˜**
> ğŸ’¡ ä¸ºä»€ä¹ˆæœ‰äº†HQLè¿˜è¦ç”¨åŸç”ŸSQLï¼Ÿ
> ç­”ï¼šå°±åƒä¼šè¯´æ™®é€šè¯ï¼Œä½†æœ‰æ—¶è¿˜éœ€è¦è¯´æ–¹è¨€ã€‚HQLæ˜¯"æ™®é€šè¯"é€‚åˆå¤§éƒ¨åˆ†æƒ…å†µï¼ŒåŸç”ŸSQLæ˜¯"æ–¹è¨€"èƒ½å‘æŒ¥æ•°æ®åº“ç‰¹é•¿ã€‚

### 1.3 åŸç”ŸSQLçš„ä¼˜ç¼ºç‚¹



**âš–ï¸ æƒè¡¡åˆ†æ**

**ä¼˜åŠ¿ âœ…**
- å¯ä»¥ä½¿ç”¨æ•°æ®åº“ç‰¹æœ‰çš„é«˜çº§åŠŸèƒ½
- æ€§èƒ½ä¼˜åŒ–ç©ºé—´æ›´å¤§ï¼ˆå¯ä»¥ç²¾ç¡®æ§åˆ¶æ‰§è¡Œè®¡åˆ’ï¼‰
- å¯ä»¥ç›´æ¥å¤ç”¨å·²æœ‰çš„SQLä»£ç 
- æ”¯æŒå¤æ‚çš„è”è¡¨å’Œå­æŸ¥è¯¢

**åŠ£åŠ¿ âŒ**
- ä¸§å¤±æ•°æ®åº“æ— å…³æ€§ï¼ˆæ¢æ•°æ®åº“å¯èƒ½è¦æ”¹ä»£ç ï¼‰
- ä¸ç»è¿‡Hibernateç¼“å­˜ï¼ˆæ€§èƒ½å¯èƒ½ä¸‹é™ï¼‰
- ä»£ç ç»´æŠ¤éš¾åº¦å¢åŠ 
- å®¹æ˜“å‡ºç°SQLæ³¨å…¥é£é™©

---

## 2. ğŸ”§ createSQLQueryæ–¹æ³•è¯¦è§£



### 2.1 åŸºæœ¬ä½¿ç”¨æ–¹å¼



**ğŸ“ æ ¸å¿ƒæ–¹æ³•ä»‹ç»**
```
createSQLQuery()ï¼šHibernateæä¾›çš„æ‰§è¡ŒåŸç”ŸSQLçš„å…¥å£
ä½œç”¨ï¼šæŠŠSQLå­—ç¬¦ä¸²è½¬æ¢æˆå¯æ‰§è¡Œçš„æŸ¥è¯¢å¯¹è±¡
ä½ç½®ï¼šåœ¨Sessionå¯¹è±¡ä¸Šè°ƒç”¨
```

**ğŸ”¸ æœ€ç®€å•çš„ç”¨æ³•**
```java
// è·å–Sessionå¯¹è±¡
Session session = sessionFactory.openSession();

// åˆ›å»ºåŸç”ŸSQLæŸ¥è¯¢
String sql = "SELECT * FROM t_user WHERE age > 18";
Query query = session.createSQLQuery(sql);

// æ‰§è¡ŒæŸ¥è¯¢
List result = query.list();
```

**ğŸ’¡ ç±»æ¯”ç†è§£**
- `Session` å°±åƒä¸€ä¸ªå·¥å…·ç®±
- `createSQLQuery()` æ˜¯ä»å·¥å…·ç®±é‡Œæ‹¿å‡º"SQLæ‰§è¡Œå™¨"
- SQLå­—ç¬¦ä¸²æ˜¯"æ‰§è¡ŒæŒ‡ä»¤"

### 2.2 å‚æ•°ç»‘å®šæ–¹å¼



**ğŸ”¸ ä½ç½®å‚æ•°ç»‘å®š**
```java
// ä½¿ç”¨ ? ä½œä¸ºå ä½ç¬¦
String sql = "SELECT * FROM t_user WHERE age > ? AND city = ?";
Query query = session.createSQLQuery(sql);

// ä»0å¼€å§‹è®¾ç½®å‚æ•°
query.setParameter(0, 18);
query.setParameter(1, "åŒ—äº¬");

List result = query.list();
```

**ğŸ”¸ å‘½åå‚æ•°ç»‘å®šï¼ˆæ¨èï¼‰**
```java
// ä½¿ç”¨ :å‚æ•°å çš„å½¢å¼
String sql = "SELECT * FROM t_user WHERE age > :minAge AND city = :cityName";
Query query = session.createSQLQuery(sql);

// è®¾ç½®å‘½åå‚æ•°
query.setParameter("minAge", 18);
query.setParameter("cityName", "åŒ—äº¬");

List result = query.list();
```

**âš ï¸ å®‰å…¨æç¤º**
```
âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥æ‹¼æ¥SQLï¼ˆä¼šå¯¼è‡´SQLæ³¨å…¥ï¼‰
String sql = "SELECT * FROM t_user WHERE name = '" + username + "'";

âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å‚æ•°ç»‘å®š
String sql = "SELECT * FROM t_user WHERE name = :name";
query.setParameter("name", username);
```

### 2.3 è¿”å›ç±»å‹æŒ‡å®š



**ğŸ“Š ä¸‰ç§è¿”å›ç±»å‹**
```
1. è¿”å›Object[]æ•°ç»„ - é»˜è®¤æ–¹å¼
2. è¿”å›å®ä½“å¯¹è±¡ - ä½¿ç”¨addEntity()
3. è¿”å›Mapé›†åˆ - ä½¿ç”¨setResultTransformer()
```

**ğŸ”¸ ç¤ºä¾‹å¯¹æ¯”**
```java
// æ–¹å¼1ï¼šè¿”å›Object[]ï¼ˆé»˜è®¤ï¼‰
List<Object[]> list1 = session.createSQLQuery(
    "SELECT id, name FROM t_user"
).list();
// ç»“æœï¼š[[1, "å¼ ä¸‰"], [2, "æå››"]]

// æ–¹å¼2ï¼šè¿”å›å®ä½“å¯¹è±¡
List<User> list2 = session.createSQLQuery(
    "SELECT * FROM t_user"
).addEntity(User.class).list();
// ç»“æœï¼š[Userå¯¹è±¡1, Userå¯¹è±¡2]

// æ–¹å¼3ï¼šè¿”å›Map
List<Map> list3 = session.createSQLQuery(
    "SELECT id, name FROM t_user"
).setResultTransformer(Transformers.ALIAS_TO_ENTITY_MAP)
.list();
// ç»“æœï¼š[{id=1, name="å¼ ä¸‰"}, {id=2, name="æå››"}]
```

---

## 3. âš¡ åŸç”ŸSQLæ‰§è¡Œæ–¹å¼



### 3.1 æŸ¥è¯¢æ“ä½œæ‰§è¡Œ



**ğŸ” åŸºæœ¬æŸ¥è¯¢æ‰§è¡Œæµç¨‹**
```
SQLç¼–å†™ â†’ åˆ›å»ºQueryå¯¹è±¡ â†’ è®¾ç½®å‚æ•° â†’ æŒ‡å®šè¿”å›ç±»å‹ â†’ æ‰§è¡ŒæŸ¥è¯¢
```

**ğŸ“ å®Œæ•´ç¤ºä¾‹**
```java
public List<User> findUsersByAge(int minAge) {
    Session session = sessionFactory.openSession();
    
    try {
        // 1. ç¼–å†™SQL
        String sql = "SELECT * FROM t_user WHERE age >= :age ORDER BY age";
        
        // 2. åˆ›å»ºQuery
        Query query = session.createSQLQuery(sql);
        
        // 3. è®¾ç½®å‚æ•°
        query.setParameter("age", minAge);
        
        // 4. æŒ‡å®šè¿”å›ç±»å‹
        query.addEntity(User.class);
        
        // 5. æ‰§è¡ŒæŸ¥è¯¢
        return query.list();
        
    } finally {
        session.close();
    }
}
```

### 3.2 æ›´æ–°æ“ä½œæ‰§è¡Œ



**ğŸ”§ æ‰§è¡ŒUPDATE/DELETEè¯­å¥**
```java
public int updateUserCity(String oldCity, String newCity) {
    Session session = sessionFactory.openSession();
    Transaction tx = session.beginTransaction();
    
    try {
        String sql = "UPDATE t_user SET city = :newCity WHERE city = :oldCity";
        
        Query query = session.createSQLQuery(sql);
        query.setParameter("newCity", newCity);
        query.setParameter("oldCity", oldCity);
        
        // executeUpdate()è¿”å›å—å½±å“çš„è¡Œæ•°
        int count = query.executeUpdate();
        
        tx.commit();
        return count;
        
    } catch (Exception e) {
        tx.rollback();
        throw e;
    } finally {
        session.close();
    }
}
```

**ğŸ’¡ ç†è§£è¦ç‚¹**
- `list()` ç”¨äºæŸ¥è¯¢ï¼Œè¿”å›ç»“æœé›†
- `executeUpdate()` ç”¨äºå¢åˆ æ”¹ï¼Œè¿”å›å½±å“è¡Œæ•°

### 3.3 åˆ†é¡µæŸ¥è¯¢å®ç°



**ğŸ“„ åŸç”ŸSQLåˆ†é¡µ**
```java
public List<User> findUsersByPage(int pageNum, int pageSize) {
    Session session = sessionFactory.openSession();
    
    String sql = "SELECT * FROM t_user ORDER BY id";
    
    Query query = session.createSQLQuery(sql)
                        .addEntity(User.class);
    
    // è®¾ç½®åˆ†é¡µå‚æ•°
    query.setFirstResult((pageNum - 1) * pageSize);  // èµ·å§‹ä½ç½®
    query.setMaxResults(pageSize);                    // æ¯é¡µæ¡æ•°
    
    return query.list();
}
```

**ğŸ”¸ ä¸åŒæ•°æ®åº“çš„åˆ†é¡µSQL**
```sql
-- MySQLåˆ†é¡µ
SELECT * FROM t_user LIMIT 10 OFFSET 20;

-- Oracleåˆ†é¡µï¼ˆéœ€è¦ç”¨ROWNUMï¼‰
SELECT * FROM (
    SELECT ROWNUM rn, t.* FROM t_user t WHERE ROWNUM <= 30
) WHERE rn > 20;

-- SQL Serveråˆ†é¡µ
SELECT * FROM t_user 
ORDER BY id 
OFFSET 20 ROWS FETCH NEXT 10 ROWS ONLY;
```

**âš ï¸ æ•°æ®åº“å…¼å®¹æ€§**
> ä½¿ç”¨`setFirstResult()`å’Œ`setMaxResults()`æ˜¯è·¨æ•°æ®åº“çš„ï¼ŒHibernateä¼šè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”æ•°æ®åº“çš„åˆ†é¡µè¯­æ³•ã€‚

---

## 4. ğŸ—ºï¸ ç»“æœæ˜ å°„æœºåˆ¶



### 4.1 ä»€ä¹ˆæ˜¯ç»“æœæ˜ å°„



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
ç»“æœæ˜ å°„ï¼šæŠŠSQLæŸ¥è¯¢çš„ç»“æœè½¬æ¢æˆJavaå¯¹è±¡çš„è¿‡ç¨‹
ä¸ºä»€ä¹ˆéœ€è¦ï¼šSQLè¿”å›çš„æ˜¯è¡¨æ•°æ®ï¼ŒJavaéœ€è¦çš„æ˜¯å¯¹è±¡
Hibernateçš„ä½œç”¨ï¼šè‡ªåŠ¨å®Œæˆè¿™ä¸ªè½¬æ¢è¿‡ç¨‹
```

**ğŸ¨ æ˜ å°„è¿‡ç¨‹å›¾ç¤º**
```
SQLæŸ¥è¯¢ç»“æœï¼ˆè¡¨æ ¼å½¢å¼ï¼‰     â†’    Hibernateæ˜ å°„    â†’    Javaå¯¹è±¡
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                              Userå¯¹è±¡ï¼š
â”‚ id â”‚ name â”‚ age â”‚           è½¬æ¢è¿‡ç¨‹            - id: 1
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                              - name: "å¼ ä¸‰"
â”‚ 1  â”‚ å¼ ä¸‰ â”‚ 25  â”‚        =============>        - age: 25
â”‚ 2  â”‚ æå›› â”‚ 30  â”‚                              
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

### 4.2 è‡ªåŠ¨æ˜ å°„è§„åˆ™



**ğŸ“‹ Hibernateçš„è‡ªåŠ¨æ˜ å°„æœºåˆ¶**

**è§„åˆ™1ï¼šåˆ—ååŒ¹é…å±æ€§å**
```java
// å¦‚æœSQLä¸­çš„åˆ—åå’Œå®ä½“å±æ€§åä¸€è‡´ï¼Œè‡ªåŠ¨æ˜ å°„
SELECT id, name, age FROM t_user  
// ä¼šè‡ªåŠ¨æ˜ å°„åˆ°Userå¯¹è±¡çš„idã€nameã€ageå±æ€§
```

**è§„åˆ™2ï¼šä½¿ç”¨åˆ«åæ˜ å°„**
```java
// SQLåˆ—åå’Œå±æ€§åä¸ä¸€è‡´æ—¶ï¼Œç”¨åˆ«å
SELECT user_id AS id, user_name AS name FROM t_user
// user_idä¼šæ˜ å°„åˆ°idå±æ€§ï¼Œuser_nameæ˜ å°„åˆ°nameå±æ€§
```

**è§„åˆ™3ï¼šç±»å‹è‡ªåŠ¨è½¬æ¢**
```
æ•°æ®åº“INT    â†’  Java Integer/int
æ•°æ®åº“VARCHAR â†’  Java String  
æ•°æ®åº“DATE    â†’  Java Date
æ•°æ®åº“DECIMAL â†’  Java BigDecimal
```

### 4.3 æ‰‹åŠ¨æ˜ å°„é…ç½®



**ğŸ”§ ä½¿ç”¨addScalaræŒ‡å®šæ˜ å°„**
```java
String sql = "SELECT user_id, user_name, create_time FROM t_user";

List result = session.createSQLQuery(sql)
    .addScalar("user_id", IntegerType.INSTANCE)      // æŒ‡å®šä¸ºæ•´æ•°
    .addScalar("user_name", StringType.INSTANCE)     // æŒ‡å®šä¸ºå­—ç¬¦ä¸²
    .addScalar("create_time", TimestampType.INSTANCE) // æŒ‡å®šä¸ºæ—¶é—´æˆ³
    .list();
```

**ğŸ’¡ ä½•æ—¶éœ€è¦æ‰‹åŠ¨æ˜ å°„**
- åˆ—åæ— æ³•è‡ªåŠ¨åŒ¹é…æ—¶
- éœ€è¦æŒ‡å®šç‰¹æ®Šçš„æ•°æ®ç±»å‹æ—¶
- è¦è¿›è¡Œç±»å‹è½¬æ¢æ—¶

---

## 5. ğŸ¯ å®ä½“æ˜ å°„è¯¦è§£



### 5.1 å•è¡¨å®ä½“æ˜ å°„



**ğŸ”¸ æœ€ç®€å•çš„å®ä½“æ˜ å°„**
```java
// å‡è®¾æœ‰å®ä½“ç±»
@Entity
@Table(name = "t_user")
public class User {
    private Integer id;
    private String name;
    private Integer age;
    // getter/setterçœç•¥
}

// æ‰§è¡ŒSQLå¹¶æ˜ å°„åˆ°å®ä½“
String sql = "SELECT * FROM t_user WHERE age > 18";
List<User> users = session.createSQLQuery(sql)
                         .addEntity(User.class)  // å…³é”®ï¼šæŒ‡å®šæ˜ å°„çš„å®ä½“ç±»
                         .list();
```

**ğŸ’¡ ç†è§£addEntity()**
```
addEntity(User.class)çš„ä½œç”¨ï¼š
1. å‘Šè¯‰Hibernateç»“æœè¦è½¬æˆUserå¯¹è±¡
2. Hibernateä¼šæ ¹æ®Userçš„æ˜ å°„é…ç½®è¿›è¡Œè½¬æ¢
3. è‡ªåŠ¨å¤„ç†åˆ—åå’Œå±æ€§åçš„å¯¹åº”å…³ç³»
```

### 5.2 å¤šè¡¨è”æŸ¥æ˜ å°„



**ğŸ”— å…³è”å®ä½“æ˜ å°„**
```java
// ç”¨æˆ·å’Œè®¢å•æ˜¯ä¸€å¯¹å¤šå…³ç³»
String sql = "SELECT u.*, o.* FROM t_user u " +
             "LEFT JOIN t_order o ON u.id = o.user_id " +
             "WHERE u.id = :userId";

Query query = session.createSQLQuery(sql)
    .addEntity("u", User.class)      // uè¡¨æ˜ å°„åˆ°User
    .addJoin("o", "u.orders")        // oè¡¨æ˜ å°„åˆ°Userçš„ordersé›†åˆ
    .setParameter("userId", 1);

List result = query.list();
```

**ğŸ“Š ç»“æœç»“æ„**
```
æ¯ä¸ªç»“æœæ˜¯ä¸€ä¸ªObject[]æ•°ç»„ï¼š
result.get(0) = [Userå¯¹è±¡, Orderå¯¹è±¡1]
result.get(1) = [Userå¯¹è±¡, Orderå¯¹è±¡2]
...
```

### 5.3 ç»§æ‰¿å…³ç³»æ˜ å°„



**ğŸ—ï¸ å¤„ç†ç»§æ‰¿å®ä½“**
```java
// å‡è®¾Studentç»§æ‰¿è‡ªPerson
@Entity
@Table(name = "t_student")
public class Student extends Person {
    private String studentNo;
    // ...
}

// SQLæŸ¥è¯¢
String sql = "SELECT * FROM t_student";
List<Student> students = session.createSQLQuery(sql)
    .addEntity(Student.class)  // ä¼šè‡ªåŠ¨åŒ…å«çˆ¶ç±»çš„å±æ€§
    .list();
```

**ğŸ’­ ç»§æ‰¿æ˜ å°„è¦ç‚¹**
- å­ç±»æŸ¥è¯¢ä¼šè‡ªåŠ¨åŒ…å«çˆ¶ç±»å±æ€§
- SQLéœ€è¦åŒ…å«æ‰€æœ‰ç›¸å…³çš„åˆ—
- Hibernateä¼šæŒ‰ç»§æ‰¿å…³ç³»ç»„è£…å¯¹è±¡

---

## 6. ğŸ“Š æ ‡é‡ç»“æœå¤„ç†



### 6.1 ä»€ä¹ˆæ˜¯æ ‡é‡ç»“æœ



**ğŸ”¸ æ ‡é‡çš„å«ä¹‰**
```
æ ‡é‡(Scalar)ï¼šå•ä¸ªçš„å€¼ï¼Œä¸æ˜¯å®Œæ•´å¯¹è±¡
ä¾‹å¦‚ï¼šä¸€ä¸ªæ•°å­—ã€ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªæ—¥æœŸ
å¯¹æ¯”ï¼šå®ä½“æ˜ å°„è¿”å›çš„æ˜¯å®Œæ•´å¯¹è±¡
```

**ğŸ¯ æ ‡é‡æŸ¥è¯¢åœºæ™¯**
```
âœ… ç»Ÿè®¡æŸ¥è¯¢ï¼šSELECT COUNT(*) FROM t_user
âœ… æ±‚å’ŒæŸ¥è¯¢ï¼šSELECT SUM(price) FROM t_order
âœ… å•åˆ—æŸ¥è¯¢ï¼šSELECT name FROM t_user
âœ… èšåˆæŸ¥è¯¢ï¼šSELECT MAX(age), MIN(age) FROM t_user
```

### 6.2 å•ä¸ªæ ‡é‡å€¼è·å–



**ğŸ”¸ æŸ¥è¯¢å•ä¸ªå€¼**
```java
// ç»Ÿè®¡ç”¨æˆ·æ€»æ•°
String sql = "SELECT COUNT(*) FROM t_user";
Object count = session.createSQLQuery(sql).uniqueResult();
System.out.println("ç”¨æˆ·æ€»æ•°ï¼š" + count);

// æŸ¥è¯¢æœ€å¤§å¹´é¾„
String sql2 = "SELECT MAX(age) FROM t_user";
Integer maxAge = (Integer) session.createSQLQuery(sql2).uniqueResult();
```

**ğŸ’¡ uniqueResult()æ–¹æ³•**
```
ä½œç”¨ï¼šè¿”å›å•ä¸ªç»“æœ
ä½¿ç”¨åœºæ™¯ï¼šç¡®å®šæŸ¥è¯¢åªæœ‰ä¸€è¡Œä¸€åˆ—æ—¶
æ³¨æ„ï¼šå¦‚æœæŸ¥è¯¢ç»“æœä¸å”¯ä¸€ä¼šæŠ›å¼‚å¸¸
```

### 6.3 å¤šä¸ªæ ‡é‡å€¼è·å–



**ğŸ“‹ æŸ¥è¯¢å¤šä¸ªåˆ—çš„å€¼**
```java
// æŸ¥è¯¢å§“åå’Œå¹´é¾„
String sql = "SELECT name, age FROM t_user";
List<Object[]> result = session.createSQLQuery(sql).list();

// å¤„ç†ç»“æœ
for (Object[] row : result) {
    String name = (String) row[0];
    Integer age = (Integer) row[1];
    System.out.println(name + " - " + age + "å²");
}
```

### 6.4 æ ‡é‡ç»“æœè½¬Map



**ğŸ—‚ï¸ ä½¿ç”¨Mapæ¥æ”¶æ›´æ–¹ä¾¿**
```java
String sql = "SELECT id, name, age FROM t_user";

List<Map> result = session.createSQLQuery(sql)
    .setResultTransformer(Transformers.ALIAS_TO_ENTITY_MAP)
    .list();

// ä½¿ç”¨Mapè®¿é—®æ•°æ®
for (Map row : result) {
    System.out.println("ID: " + row.get("id"));
    System.out.println("å§“å: " + row.get("name"));
    System.out.println("å¹´é¾„: " + row.get("age"));
}
```

**ğŸ”¸ Mapæ–¹å¼çš„ä¼˜åŠ¿**
- é€šè¿‡é”®åè®¿é—®ï¼Œæ›´ç›´è§‚
- ä¸éœ€è¦è®°ä½æ•°ç»„ç´¢å¼•
- æ›´é€‚åˆåŠ¨æ€åˆ—çš„åœºæ™¯

---

## 7. ğŸ­ æ··åˆç»“æœå¤„ç†



### 7.1 ä»€ä¹ˆæ˜¯æ··åˆç»“æœ



**ğŸ”¸ æ··åˆç»“æœçš„å®šä¹‰**
```
æ··åˆç»“æœï¼šæŸ¥è¯¢ä¸­æ—¢æœ‰å®ä½“å¯¹è±¡ï¼Œåˆæœ‰æ ‡é‡å€¼
ä¾‹å¦‚ï¼šSELECT u.*, COUNT(o.id) FROM t_user u LEFT JOIN t_order o
     æ—¢è¦Userå¯¹è±¡ï¼Œåˆè¦è®¢å•æ•°é‡
```

**ğŸ¨ æ··åˆç»“æœç¤ºä¾‹**
```
SQL: SELECT u.*, COUNT(o.id) as orderCount 
     FROM t_user u LEFT JOIN t_order o GROUP BY u.id

ç»“æœï¼šæ¯è¡ŒåŒ…å« [Userå¯¹è±¡, è®¢å•æ•°é‡]
```

### 7.2 å®ä½“+æ ‡é‡æ··åˆ



**ğŸ“Š æŸ¥è¯¢ç”¨æˆ·åŠå…¶è®¢å•æ•°**
```java
String sql = "SELECT u.*, COUNT(o.id) as orderCount " +
             "FROM t_user u " +
             "LEFT JOIN t_order o ON u.id = o.user_id " +
             "GROUP BY u.id";

Query query = session.createSQLQuery(sql)
    .addEntity("u", User.class)           // å®ä½“æ˜ å°„
    .addScalar("orderCount", LongType.INSTANCE);  // æ ‡é‡æ˜ å°„

List<Object[]> result = query.list();

// å¤„ç†æ··åˆç»“æœ
for (Object[] row : result) {
    User user = (User) row[0];        // ç¬¬ä¸€ä¸ªæ˜¯Userå¯¹è±¡
    Long orderCount = (Long) row[1];   // ç¬¬äºŒä¸ªæ˜¯è®¢å•æ•°é‡
    
    System.out.println(user.getName() + " æœ‰ " + orderCount + " ä¸ªè®¢å•");
}
```

### 7.3 å¤šå®ä½“æ··åˆ



**ğŸ”— åŒæ—¶è¿”å›å¤šä¸ªå®ä½“**
```java
// æŸ¥è¯¢ç”¨æˆ·å’Œæœ€è¿‘çš„è®¢å•ä¿¡æ¯
String sql = "SELECT u.*, o.* " +
             "FROM t_user u " +
             "INNER JOIN t_order o ON u.id = o.user_id " +
             "WHERE o.create_time = (SELECT MAX(create_time) FROM t_order WHERE user_id = u.id)";

Query query = session.createSQLQuery(sql)
    .addEntity("u", User.class)
    .addEntity("o", Order.class);

List<Object[]> result = query.list();

for (Object[] row : result) {
    User user = (User) row[0];
    Order order = (Order) row[1];
    
    System.out.println(user.getName() + " çš„æœ€æ–°è®¢å•å·: " + order.getOrderNo());
}
```

### 7.4 è‡ªå®šä¹‰ç»“æœå°è£…



**ğŸ å°è£…æˆè‡ªå®šä¹‰å¯¹è±¡**
```java
// å®šä¹‰DTOç±»æ¥æ”¶æ··åˆç»“æœ
public class UserOrderDTO {
    private User user;
    private Long orderCount;
    
    public UserOrderDTO(User user, Long orderCount) {
        this.user = user;
        this.orderCount = orderCount;
    }
    // getter/setter
}

// ä½¿ç”¨ResultTransformerè½¬æ¢
List<UserOrderDTO> result = session.createSQLQuery(sql)
    .addEntity("u", User.class)
    .addScalar("orderCount", LongType.INSTANCE)
    .setResultTransformer(new ResultTransformer() {
        @Override
        public Object transformTuple(Object[] tuple, String[] aliases) {
            return new UserOrderDTO(
                (User) tuple[0],
                (Long) tuple[1]
            );
        }
        // å…¶ä»–æ–¹æ³•çœç•¥
    })
    .list();
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



**ğŸ”¸ å…³é”®çŸ¥è¯†ç‚¹**
```
1. åŸç”ŸSQLï¼šç›´æ¥ä½¿ç”¨æ•°æ®åº“SQLï¼Œå¯ç”¨æ•°æ®åº“ç‰¹å®šåŠŸèƒ½
2. createSQLQuery()ï¼šæ‰§è¡ŒåŸç”ŸSQLçš„å…¥å£æ–¹æ³•
3. å‚æ•°ç»‘å®šï¼šé¿å…SQLæ³¨å…¥ï¼Œä½¿ç”¨å‘½åå‚æ•°æœ€å®‰å…¨
4. ç»“æœæ˜ å°„ï¼šSQLç»“æœè½¬Javaå¯¹è±¡çš„è¿‡ç¨‹
5. å®ä½“æ˜ å°„ï¼šä½¿ç”¨addEntity()æ˜ å°„å®Œæ•´å¯¹è±¡
6. æ ‡é‡ç»“æœï¼šå•ä¸ªå€¼æˆ–å¤šåˆ—å€¼çš„æŸ¥è¯¢
7. æ··åˆç»“æœï¼šå®ä½“å’Œæ ‡é‡å€¼æ··åˆè¿”å›
```

### 8.2 ä½¿ç”¨åœºæ™¯å¯¹æ¯”



| æŸ¥è¯¢éœ€æ±‚ | æ¨èæ–¹å¼ | åŸå›  |
|---------|---------|------|
| ç®€å•çš„CRUD | HQL | ç®€æ´ã€é¢å‘å¯¹è±¡ |
| å¤æ‚ç»Ÿè®¡æŠ¥è¡¨ | åŸç”ŸSQL | å¯ç”¨èšåˆå‡½æ•°ã€åˆ†ç»„ |
| æ•°æ®åº“ç‰¹å®šåŠŸèƒ½ | åŸç”ŸSQL | HQLä¸æ”¯æŒ |
| è·¨æ•°æ®åº“åº”ç”¨ | HQL | æ•°æ®åº“æ— å…³æ€§ |
| æ€§èƒ½ä¼˜åŒ– | åŸç”ŸSQL | ç²¾ç¡®æ§åˆ¶æ‰§è¡Œè®¡åˆ’ |

### 8.3 æœ€ä½³å®è·µå»ºè®®



**âœ… æ¨èåšæ³•**
```java
// 1. ä½¿ç”¨å‘½åå‚æ•°ï¼Œé˜²æ­¢SQLæ³¨å…¥
String sql = "SELECT * FROM t_user WHERE name = :name";
query.setParameter("name", userName);

// 2. æ˜ç¡®æŒ‡å®šç»“æœç±»å‹
query.addEntity(User.class);  // è¿”å›å®ä½“
// æˆ–
query.addScalar("count", LongType.INSTANCE);  // è¿”å›æ ‡é‡

// 3. å¤æ‚SQLä½¿ç”¨å‘½åæŸ¥è¯¢ï¼ˆåœ¨æ˜ å°„æ–‡ä»¶ä¸­å®šä¹‰ï¼‰
@NamedNativeQuery(
    name = "findUserWithOrders",
    query = "SELECT u.*, COUNT(o.id) FROM t_user u...",
    resultSetMapping = "userOrderMapping"
)
```

**âŒ é¿å…çš„åšæ³•**
```java
// ä¸è¦ç›´æ¥æ‹¼æ¥SQL
String sql = "SELECT * FROM t_user WHERE id = " + id; // å±é™©ï¼

// ä¸è¦å¿½ç•¥è¿”å›ç±»å‹
List result = query.list();  // ä¸æ¸…æ¥šè¿”å›ä»€ä¹ˆç±»å‹

// ä¸è¦åœ¨ä»£ç ä¸­å†™è¶…é•¿SQL
String sql = "SELECT ... 100è¡Œçš„SQL...";  // éš¾ä»¥ç»´æŠ¤
```

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ“ çŸ¥è¯†æŒæ¡æ£€éªŒ**
- [ ] ç†è§£åŸç”ŸSQLå’ŒHQLçš„åŒºåˆ«
- [ ] ä¼šä½¿ç”¨createSQLQuery()æ‰§è¡ŒæŸ¥è¯¢
- [ ] æŒæ¡å‚æ•°ç»‘å®šçš„å®‰å…¨ç”¨æ³•
- [ ] èƒ½å°†ç»“æœæ˜ å°„ä¸ºå®ä½“å¯¹è±¡
- [ ] ä¼šå¤„ç†æ ‡é‡æŸ¥è¯¢ç»“æœ
- [ ] ç†è§£æ··åˆç»“æœçš„å¤„ç†æ–¹å¼
- [ ] çŸ¥é“ä½•æ—¶è¯¥ç”¨åŸç”ŸSQL

### 8.5 å¸¸è§é—®é¢˜è§£ç­”



**â“ é—®é¢˜1ï¼šåŸç”ŸSQLæŸ¥è¯¢çš„ç»“æœæ²¡æœ‰è¿›ç¼“å­˜æ€ä¹ˆåŠï¼Ÿ**
> ğŸ’¡ è§£ç­”ï¼šåŸç”ŸSQLé»˜è®¤ä¸èµ°Hibernateç¼“å­˜ã€‚å¦‚éœ€ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼š
> ```java
> query.setCacheable(true);
> query.setCacheRegion("queryCache");
> ```

**â“ é—®é¢˜2ï¼šå¦‚ä½•åœ¨åŸç”ŸSQLä¸­ä½¿ç”¨å ä½ç¬¦ï¼Ÿ**
> ğŸ’¡ è§£ç­”ï¼šä½¿ç”¨å‘½åå‚æ•°`:å‚æ•°å`æˆ–ä½ç½®å‚æ•°`?`ï¼Œæ¨èä½¿ç”¨å‘½åå‚æ•°æ›´æ¸…æ™°

**â“ é—®é¢˜3ï¼šåŸç”ŸSQLèƒ½å®ç°å»¶è¿ŸåŠ è½½å—ï¼Ÿ**
> ğŸ’¡ è§£ç­”ï¼šå¯ä»¥ï¼Œé€šè¿‡`addEntity()`æ˜ å°„çš„å…³è”å¯¹è±¡ä»ç„¶æ”¯æŒå»¶è¿ŸåŠ è½½

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> åŸç”ŸSQLåŠŸèƒ½å¼ºï¼Œæ•°æ®åº“ç‰¹æ€§èƒ½å‘æŒ¥  
> createSQLQueryæ¥åˆ›å»ºï¼Œå‚æ•°ç»‘å®šé˜²æ³¨å…¥  
> å®ä½“æ ‡é‡ä¸¤ç§æœï¼Œæ··åˆç»“æœæ›´çµæ´»  
> HQLä¸å¤Ÿç”¨æ—¶é€‰ï¼Œæ€§èƒ½ä¼˜åŒ–é åŸç”Ÿ

**ğŸ¯ å®æˆ˜å»ºè®®**
1. **ä¼˜å…ˆä½¿ç”¨HQL**ï¼šèƒ½ç”¨HQLå°±ä¸ç”¨åŸç”ŸSQL
2. **å‚æ•°å¿…é¡»ç»‘å®š**ï¼šæ°¸è¿œä¸è¦æ‹¼æ¥SQLå­—ç¬¦ä¸²
3. **æ˜ç¡®è¿”å›ç±»å‹**ï¼šä½¿ç”¨addEntity()æˆ–addScalar()
4. **æ³¨æ„æ•°æ®åº“å·®å¼‚**ï¼šåŸç”ŸSQLå¯èƒ½å½±å“è·¨æ•°æ®åº“å…¼å®¹æ€§