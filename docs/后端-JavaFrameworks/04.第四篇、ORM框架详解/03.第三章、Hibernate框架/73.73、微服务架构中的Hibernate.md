---
title: 73ã€å¾®æœåŠ¡æ¶æ„ä¸­çš„Hibernate
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡ä¸ORMçš„å…³ç³»ç†è§£](#1-å¾®æœåŠ¡ä¸ORMçš„å…³ç³»ç†è§£)
2. [å¾®æœåŠ¡æ•°æ®è®¿é—®æ¨¡å¼](#2-å¾®æœåŠ¡æ•°æ®è®¿é—®æ¨¡å¼)
3. [æ•°æ®åº“æ‹†åˆ†ç­–ç•¥](#3-æ•°æ®åº“æ‹†åˆ†ç­–ç•¥)
4. [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†](#4-åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†)
5. [æ•°æ®ä¸€è‡´æ€§ä¿è¯](#5-æ•°æ®ä¸€è‡´æ€§ä¿è¯)
6. [æœåŠ¡é—´é€šä¿¡](#6-æœåŠ¡é—´é€šä¿¡)
7. [ç¼“å­˜ç­–ç•¥](#7-ç¼“å­˜ç­–ç•¥)
8. [ç›‘æ§ä¸æ²»ç†](#8-ç›‘æ§ä¸æ²»ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å¾®æœåŠ¡ä¸ORMçš„å…³ç³»ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„


**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**

æƒ³è±¡ä¸€ä¸ªå¤§å‹è¶…å¸‚çš„è¿è¥æ–¹å¼ï¼š

```
ä¼ ç»Ÿå•ä½“åº”ç”¨ï¼ˆå¤§å–åœºæ¨¡å¼ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸€ä¸ªè¶…å¤§å‹å–åœº               â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”       â”‚
â”‚  â”‚æ”¶é“¶â”‚ â”‚åº“å­˜â”‚ â”‚ä¼šå‘˜â”‚ â”‚ä¿ƒé”€â”‚  ...  â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜       â”‚
â”‚         å…±ç”¨ä¸€ä¸ªæ•°æ®åº“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“ ä»»ä½•ä¸€ä¸ªæ¨¡å—å‡ºé—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿç˜«ç—ª


å¾®æœåŠ¡æ¶æ„ï¼ˆä¸“ä¸šåº—æ¨¡å¼ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚æ”¶é“¶æœâ”‚  â”‚åº“å­˜æœâ”‚  â”‚ä¼šå‘˜æœâ”‚  â”‚ä¿ƒé”€æœâ”‚
â”‚åŠ¡    â”‚  â”‚åŠ¡    â”‚  â”‚åŠ¡    â”‚  â”‚åŠ¡    â”‚
â”‚ DB1  â”‚  â”‚ DB2  â”‚  â”‚ DB3  â”‚  â”‚ DB4  â”‚
â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
    â†“ å„è‡ªç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œå„æœ‰ä¸“å±æ•°æ®åº“
```

**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹**

| ç‰¹æ€§ | å•ä½“åº”ç”¨ | å¾®æœåŠ¡æ¶æ„ |
|------|----------|-----------|
| **æ•°æ®åº“** | `ä¸€ä¸ªå…±äº«æ•°æ®åº“` | `æ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“` |
| **éƒ¨ç½²** | `æ•´ä½“éƒ¨ç½²` | `ç‹¬ç«‹éƒ¨ç½²` |
| **å½±å“èŒƒå›´** | `ä¸€å¤„æ•…éšœå…¨å±€å½±å“` | `æ•…éšœéš”ç¦»` |
| **æ‰©å±•æ€§** | `æ•´ä½“æ‰©å±•` | `æŒ‰éœ€æ‰©å±•å•ä¸ªæœåŠ¡` |
| **æŠ€æœ¯æ ˆ** | `ç»Ÿä¸€æŠ€æœ¯æ ˆ` | `å¯ä»¥ä¸åŒæŠ€æœ¯æ ˆ` |

### 1.2 Hibernateåœ¨å¾®æœåŠ¡ä¸­çš„è§’è‰²å˜åŒ–


**ä¼ ç»Ÿå•ä½“åº”ç”¨ä¸­çš„Hibernate**ï¼š
```
åº”ç”¨å±‚ â†’ Hibernate â†’ ä¸€ä¸ªå¤§æ•°æ®åº“
         â†“
    ç®¡ç†æ‰€æœ‰å®ä½“ç±»
    å¤„ç†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
```

**å¾®æœåŠ¡æ¶æ„ä¸­çš„Hibernate**ï¼š
```
è®¢å•æœåŠ¡ â†’ Hibernate â†’ è®¢å•æ•°æ®åº“ï¼ˆåªæœ‰è®¢å•ç›¸å…³è¡¨ï¼‰
ç”¨æˆ·æœåŠ¡ â†’ Hibernate â†’ ç”¨æˆ·æ•°æ®åº“ï¼ˆåªæœ‰ç”¨æˆ·ç›¸å…³è¡¨ï¼‰
åº“å­˜æœåŠ¡ â†’ Hibernate â†’ åº“å­˜æ•°æ®åº“ï¼ˆåªæœ‰åº“å­˜ç›¸å…³è¡¨ï¼‰
```

> ğŸ’¡ **å…³é”®ç†è§£**
> 
> åœ¨å¾®æœåŠ¡ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„Hibernateå®ä¾‹å’Œç‹¬ç«‹æ•°æ®åº“
> å°±åƒæ¯ä¸ªä¸“ä¸šåº—æœ‰è‡ªå·±çš„æ”¶é“¶ç³»ç»Ÿå’Œåº“å­˜ç³»ç»Ÿä¸€æ ·

### 1.3 é¢ä¸´çš„æ–°æŒ‘æˆ˜


**ğŸ”¸ æŒ‘æˆ˜æ¸…å•**

- âš ï¸ **æ•°æ®åˆ†æ•£** â†’ åŸæœ¬ä¸€ä¸ªè¡¨çš„æ•°æ®ç°åœ¨åˆ†å¸ƒåœ¨å¤šä¸ªæ•°æ®åº“
- âš ï¸ **å…³è”æŸ¥è¯¢** â†’ ä¸èƒ½ç›´æ¥ç”¨JOINï¼Œå› ä¸ºè¡¨åœ¨ä¸åŒæ•°æ®åº“
- âš ï¸ **äº‹åŠ¡ç®¡ç†** â†’ è·¨æœåŠ¡çš„äº‹åŠ¡å¦‚ä½•ä¿è¯ï¼Ÿ
- âš ï¸ **æ•°æ®ä¸€è‡´æ€§** â†’ å¤šä¸ªæ•°æ®åº“å¦‚ä½•ä¿æŒæ•°æ®åŒæ­¥ï¼Ÿ

```
âŒ ä»¥å‰å¯ä»¥è¿™æ ·åšï¼š
SELECT * FROM orders o 
JOIN users u ON o.user_id = u.id
JOIN products p ON o.product_id = p.id

âœ… ç°åœ¨éœ€è¦è¿™æ ·ï¼š
1. ä»è®¢å•æœåŠ¡è·å–è®¢å•
2. ä»ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
3. ä»å•†å“æœåŠ¡è·å–å•†å“ä¿¡æ¯
4. åº”ç”¨å±‚ç»„è£…æ•°æ®
```

---

## 2. ğŸ“Š å¾®æœåŠ¡æ•°æ®è®¿é—®æ¨¡å¼


### 2.1 æ¯æœåŠ¡ä¸€ä¸ªæ•°æ®åº“æ¨¡å¼


**ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼šDatabase per Service

```
ç”µå•†ç³»ç»Ÿæ‹†åˆ†ç¤ºä¾‹ï¼š

ç”¨æˆ·æœåŠ¡                è®¢å•æœåŠ¡                å•†å“æœåŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User    â”‚           â”‚ Order   â”‚           â”‚ Product â”‚
â”‚ Profile â”‚           â”‚ Item    â”‚           â”‚ Categoryâ”‚
â”‚ Address â”‚           â”‚ Payment â”‚           â”‚ Stock   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“                     â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç”¨æˆ·DB   â”‚           â”‚è®¢å•DB   â”‚           â”‚å•†å“DB   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… ä¼˜åŠ¿åˆ†æ**

- `ç‹¬ç«‹æ€§å¼º`ï¼šæœåŠ¡ä¹‹é—´å®Œå…¨è§£è€¦
- `æŠ€æœ¯è‡ªç”±`ï¼šå¯ä»¥ä¸ºä¸åŒæœåŠ¡é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®åº“
- `æ‰©å±•çµæ´»`ï¼šå¯ä»¥ç‹¬ç«‹æ‰©å±•æŸä¸ªæœåŠ¡çš„æ•°æ®åº“
- `æ•…éšœéš”ç¦»`ï¼šä¸€ä¸ªæ•°æ®åº“æ•…éšœä¸å½±å“å…¶ä»–æœåŠ¡

**âŒ æŒ‘æˆ˜åˆ†æ**

- `æ•°æ®å†—ä½™`ï¼šæŸäº›æ•°æ®å¯èƒ½éœ€è¦åœ¨å¤šä¸ªæ•°æ®åº“ä¸­å­˜å‚¨
- `æŸ¥è¯¢å¤æ‚`ï¼šæ— æ³•ä½¿ç”¨ä¼ ç»Ÿçš„JOINæŸ¥è¯¢
- `äº‹åŠ¡å›°éš¾`ï¼šè·¨æœåŠ¡äº‹åŠ¡éœ€è¦ç‰¹æ®Šå¤„ç†

### 2.2 æ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰éš”ç¦»


**ğŸ”¸ æœåŠ¡éš”ç¦»çš„å®ä½“ç±»è®¾è®¡**

```java
// âŒ é”™è¯¯ç¤ºèŒƒï¼šåœ¨è®¢å•æœåŠ¡ä¸­ç›´æ¥å¼•ç”¨ç”¨æˆ·å®ä½“
@Entity
public class Order {
    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;  // è·¨æœåŠ¡å¼•ç”¨ï¼Œè¿åå¾®æœåŠ¡åŸåˆ™ï¼
}

// âœ… æ­£ç¡®åšæ³•ï¼šåªå­˜å‚¨ç”¨æˆ·ID
@Entity
public class Order {
    @Column(name = "user_id")
    private Long userId;  // åªå­˜å‚¨å…³è”ID
    
    // éœ€è¦ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œé€šè¿‡æœåŠ¡è°ƒç”¨è·å–
    @Transient
    private UserDTO userInfo;  // ä¸´æ—¶æ•°æ®ï¼Œä¸å­˜æ•°æ®åº“
}
```

**ğŸ”§ DAOå±‚è®¾è®¡åŸåˆ™**

```
è®¢å•æœåŠ¡çš„Repositoryï¼š

public interface OrderRepository extends JpaRepository<Order, Long> {
    // âœ… åªæŸ¥è¯¢è®¢å•æœåŠ¡å†…çš„æ•°æ®
    List<Order> findByUserId(Long userId);
    
    // âœ… å¯ä»¥æ ¹æ®çŠ¶æ€æŸ¥è¯¢
    List<Order> findByStatus(String status);
    
    // âŒ ä¸è¦å†™è·¨æœåŠ¡çš„æŸ¥è¯¢
    // @Query("SELECT o FROM Order o JOIN User u ...")
    // è¿™ä¼šå¤±è´¥ï¼Œå› ä¸ºUseråœ¨å¦ä¸€ä¸ªæ•°æ®åº“
}
```

### 2.3 APIç»„åˆæ¨¡å¼


**ğŸ”¸ å·¥ä½œåŸç†**

```
å®¢æˆ·ç«¯è¯·æ±‚ï¼šè·å–è®¢å•è¯¦æƒ…ï¼ˆåŒ…å«ç”¨æˆ·å’Œå•†å“ä¿¡æ¯ï¼‰

æ­¥éª¤æµç¨‹ï¼š
å®¢æˆ·ç«¯
   â†“ â‘  è¯·æ±‚è®¢å•è¯¦æƒ…
APIç½‘å…³/BFFå±‚
   â†“ â‘¡ è°ƒç”¨è®¢å•æœåŠ¡
è®¢å•æœåŠ¡ â†’ è¿”å›è®¢å•åŸºæœ¬ä¿¡æ¯ï¼ˆuser_id=123, product_id=456ï¼‰
   â†“ â‘¢ æ‹¿åˆ°user_idï¼Œè°ƒç”¨ç”¨æˆ·æœåŠ¡
ç”¨æˆ·æœåŠ¡ â†’ è¿”å›ç”¨æˆ·ä¿¡æ¯
   â†“ â‘£ æ‹¿åˆ°product_idï¼Œè°ƒç”¨å•†å“æœåŠ¡
å•†å“æœåŠ¡ â†’ è¿”å›å•†å“ä¿¡æ¯
   â†“ â‘¤ ç»„è£…å®Œæ•´æ•°æ®
å®¢æˆ·ç«¯ â† è¿”å›å®Œæ•´è®¢å•è¯¦æƒ…
```

**ğŸ’» ä»£ç å®ç°ç¤ºä¾‹**

```java
@Service
public class OrderCompositeService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private UserServiceClient userClient;  // Feignå®¢æˆ·ç«¯
    
    @Autowired
    private ProductServiceClient productClient;
    
    public OrderDetailDTO getOrderDetail(Long orderId) {
        // â‘  æŸ¥è¯¢è®¢å•åŸºæœ¬ä¿¡æ¯
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new RuntimeException("è®¢å•ä¸å­˜åœ¨"));
        
        // â‘¡ è°ƒç”¨ç”¨æˆ·æœåŠ¡è·å–ç”¨æˆ·ä¿¡æ¯
        UserDTO user = userClient.getUserById(order.getUserId());
        
        // â‘¢ è°ƒç”¨å•†å“æœåŠ¡è·å–å•†å“ä¿¡æ¯
        ProductDTO product = productClient.getProductById(order.getProductId());
        
        // â‘£ ç»„è£…å®Œæ•´æ•°æ®
        OrderDetailDTO detail = new OrderDetailDTO();
        detail.setOrder(order);
        detail.setUser(user);
        detail.setProduct(product);
        
        return detail;
    }
}
```

> âš ï¸ **æ€§èƒ½æ³¨æ„**
> 
> APIç»„åˆæ¨¡å¼ä¼šäº§ç”Ÿå¤šæ¬¡ç½‘ç»œè°ƒç”¨ï¼Œè¦æ³¨æ„æ€§èƒ½é—®é¢˜
> å¯ä»¥è€ƒè™‘ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢ã€å¼‚æ­¥è°ƒç”¨æˆ–ç¼“å­˜ä¼˜åŒ–

### 2.4 CQRSæ¨¡å¼ï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰


**ğŸ”¸ æ ¸å¿ƒæ€æƒ³**

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆè¯»å†™æ··åˆï¼‰ï¼š
åº”ç”¨ â†’ Hibernate â†’ åŒä¸€ä¸ªæ•°æ®åº“ â† è¯»å†™éƒ½åœ¨è¿™é‡Œ

CQRSæ–¹å¼ï¼ˆè¯»å†™åˆ†ç¦»ï¼‰ï¼š
         å†™æ“ä½œ                     è¯»æ“ä½œ
åº”ç”¨ â†’ Hibernate â†’ å†™åº“     åº”ç”¨ â†’ è¯»åº“ï¼ˆå¯èƒ½æ˜¯ä¸åŒç»“æ„ï¼‰
              â†“                      â†‘
           æ•°æ®åŒæ­¥ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ã€CDCç­‰ï¼‰
```

**ğŸ“‹ é€‚ç”¨åœºæ™¯**

| åœºæ™¯ | æ˜¯å¦é€‚åˆCQRS | åŸå›  |
|------|-------------|------|
| `é«˜å¹¶å‘è¯»å–` | âœ… | è¯»åº“å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–å’Œæ‰©å±• |
| `å¤æ‚æŸ¥è¯¢` | âœ… | è¯»åº“å¯ä»¥åèŒƒå¼è®¾è®¡ |
| `ç®€å•CRUD` | âŒ | å¢åŠ å¤æ‚åº¦ï¼Œæ”¶ç›Šä¸å¤§ |
| `å®æ—¶æ€§è¦æ±‚é«˜` | âš ï¸ | éœ€è¦å¤„ç†æ•°æ®åŒæ­¥å»¶è¿Ÿ |

---

## 3. ğŸ”§ æ•°æ®åº“æ‹†åˆ†ç­–ç•¥


### 3.1 æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ï¼ˆDDDæ–¹æ³•ï¼‰


**ğŸ¯ é¢†åŸŸé©±åŠ¨è®¾è®¡æ€è·¯**

```
ç”µå•†ç³»ç»Ÿé¢†åŸŸåˆ’åˆ†ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”µå•†ä¸šåŠ¡å…¨æ™¯                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ç”¨æˆ·åŸŸ    â”‚è®¢å•åŸŸ    â”‚å•†å“åŸŸ    â”‚æ”¯ä»˜åŸŸ     â”‚
â”‚User      â”‚Order     â”‚Product   â”‚Payment    â”‚
â”‚Profile   â”‚OrderItem â”‚Category  â”‚Transactionâ”‚
â”‚Address   â”‚Cart      â”‚Inventory â”‚Refund     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“          â†“          â†“          â†“
  ç‹¬ç«‹DB      ç‹¬ç«‹DB      ç‹¬ç«‹DB      ç‹¬ç«‹DB
```

**âœ… æ‹†åˆ†åŸåˆ™**

- ğŸ¯ **é«˜å†…èš**ï¼šç›¸å…³æ€§å¼ºçš„è¡¨æ”¾åœ¨ä¸€èµ·
- ğŸ”— **ä½è€¦åˆ**ï¼šå°½é‡å‡å°‘è·¨åº“å…³è”
- ğŸ“Š **ä¸šåŠ¡å®Œæ•´æ€§**ï¼šä¸€ä¸ªä¸šåŠ¡æµç¨‹å°½é‡åœ¨ä¸€ä¸ªæœåŠ¡å†…å®Œæˆ
- âš¡ **è®¿é—®é¢‘ç‡**ï¼šç»å¸¸ä¸€èµ·æŸ¥è¯¢çš„è¡¨æ”¾åœ¨ä¸€èµ·

**å®æˆ˜ç¤ºä¾‹ï¼šè®¢å•é¢†åŸŸæ‹†åˆ†**

```java
// è®¢å•æœåŠ¡çš„å®ä½“è®¾è®¡
@Entity
@Table(name = "orders")
public class Order {
    @Id
    private Long id;
    
    // åªå­˜å‚¨å…¶ä»–æœåŠ¡çš„IDå¼•ç”¨
    private Long userId;        // æ¥è‡ªç”¨æˆ·æœåŠ¡
    private Long productId;     // æ¥è‡ªå•†å“æœåŠ¡
    
    // è®¢å•è‡ªå·±çš„å±æ€§
    private BigDecimal amount;
    private String status;
    private LocalDateTime createTime;
    
    // è®¢å•æ˜ç»†ï¼ˆåœ¨åŒä¸€ä¸ªæœåŠ¡å†…ï¼Œå¯ä»¥å…³è”ï¼‰
    @OneToMany(mappedBy = "order")
    private List<OrderItem> items;
}

@Entity
@Table(name = "order_items")
public class OrderItem {
    @Id
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "order_id")
    private Order order;  // âœ… åŒæœåŠ¡å†…å¯ä»¥å…³è”
    
    private Long productId;  // âœ… åªå­˜ID
    private Integer quantity;
    private BigDecimal price;
}
```

### 3.2 æ•°æ®å†—ä½™ä¸åŒæ­¥


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®å†—ä½™**

```
åœºæ™¯ï¼šè®¢å•æœåŠ¡éœ€è¦æ˜¾ç¤ºå•†å“åç§°

æ–¹æ¡ˆå¯¹æ¯”ï¼š

âŒ æ–¹æ¡ˆ1ï¼šæ¯æ¬¡éƒ½è°ƒç”¨å•†å“æœåŠ¡
è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡ â†’ è·å–å•†å“åç§°
é—®é¢˜ï¼šç½‘ç»œå¼€é”€å¤§ï¼Œå“åº”æ…¢ï¼Œå•†å“æœåŠ¡å‹åŠ›å¤§

âœ… æ–¹æ¡ˆ2ï¼šåœ¨è®¢å•ä¸­å†—ä½™å•†å“åç§°
è®¢å•è¡¨ç»“æ„ï¼š
- order_id
- product_id
- product_name     â† å†—ä½™å­—æ®µ
- product_price    â† å†—ä½™å­—æ®µï¼ˆä¸‹å•æ—¶çš„ä»·æ ¼ï¼‰
```

**ğŸ“‹ å†—ä½™ç­–ç•¥è¡¨**

| æ•°æ®ç±»å‹ | å†—ä½™ç­–ç•¥ | åŒæ­¥æ–¹å¼ | è¯´æ˜ |
|---------|---------|---------|------|
| `åŸºæœ¬ä¿¡æ¯` | `å†—ä½™å¿«ç…§` | `å†™å…¥æ—¶å¤åˆ¶` | å¦‚è®¢å•æ—¶çš„å•†å“åã€ä»·æ ¼ |
| `ç»Ÿè®¡æ•°æ®` | `å®šæœŸåŒæ­¥` | `å¼‚æ­¥æ‰¹é‡` | å¦‚ç”¨æˆ·è®¢å•æ•°ã€æ¶ˆè´¹é‡‘é¢ |
| `å®æ—¶æ•°æ®` | `ä¸å†—ä½™` | `å®æ—¶æŸ¥è¯¢` | å¦‚å•†å“åº“å­˜ |
| `å†å²è®°å½•` | `å®Œæ•´å†—ä½™` | `äº‹ä»¶é©±åŠ¨` | å¦‚æ“ä½œæ—¥å¿— |

**ğŸ”§ æ•°æ®åŒæ­¥å®ç°**

```java
// æ–¹å¼1ï¼šä¸‹å•æ—¶å†—ä½™å•†å“ä¿¡æ¯
@Service
public class OrderService {
    
    public Order createOrder(OrderRequest request) {
        // â‘  è°ƒç”¨å•†å“æœåŠ¡è·å–æœ€æ–°ä¿¡æ¯
        ProductDTO product = productClient.getProduct(request.getProductId());
        
        // â‘¡ åˆ›å»ºè®¢å•æ—¶å†—ä½™å•†å“ä¿¡æ¯
        Order order = new Order();
        order.setProductId(product.getId());
        order.setProductName(product.getName());      // å†—ä½™
        order.setProductPrice(product.getPrice());    // å†—ä½™
        order.setProductSnapshot(toJson(product));    // å®Œæ•´å¿«ç…§
        
        return orderRepository.save(order);
    }
}

// æ–¹å¼2ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥åŒæ­¥
@Component
public class ProductEventListener {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @RabbitListener(queues = "product.updated")
    public void onProductUpdated(ProductUpdateEvent event) {
        // å•†å“ä¿¡æ¯æ›´æ–°æ—¶ï¼ŒåŒæ­¥åˆ°è®¢å•çš„å†—ä½™å­—æ®µ
        List<Order> orders = orderRepository
            .findByProductId(event.getProductId());
        
        orders.forEach(order -> {
            order.setProductName(event.getNewName());
            // æ³¨æ„ï¼šä»·æ ¼ä¸æ›´æ–°ï¼Œä¿æŒå†å²è®°å½•
        });
        
        orderRepository.saveAll(orders);
    }
}
```

> ğŸ’¡ **æœ€ä½³å®è·µ**
> 
> - **å¿«ç…§åŸåˆ™**ï¼šä¸‹å•æ—¶çš„å•†å“ä¿¡æ¯è¦å®Œæ•´ä¿å­˜ï¼Œå³ä½¿å•†å“åæ¥æ”¹äº†ä¹Ÿä¸å½±å“å†å²è®¢å•
> - **é€‰æ‹©æ€§åŒæ­¥**ï¼šä¸æ˜¯æ‰€æœ‰å­—æ®µéƒ½è¦åŒæ­¥ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦å†³å®š
> - **ç‰ˆæœ¬æ§åˆ¶**ï¼šå†—ä½™æ•°æ®æœ€å¥½åŠ ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³

### 3.3 åˆ†åº“åˆ†è¡¨å¤„ç†


**ğŸ”¸ æ•°æ®é‡å¢é•¿çš„è§£å†³æ–¹æ¡ˆ**

```
å‚ç›´æ‹†åˆ†ï¼ˆæŒ‰ä¸šåŠ¡ï¼‰ï¼š
è®¢å•DB â† è®¢å•æœåŠ¡
ç”¨æˆ·DB â† ç”¨æˆ·æœåŠ¡
å•†å“DB â† å•†å“æœåŠ¡

æ°´å¹³æ‹†åˆ†ï¼ˆæŒ‰æ•°æ®é‡ï¼‰ï¼š
è®¢å•DB-1 â† è®¢å•æœåŠ¡ï¼ˆè®¢å•ID 1-100ä¸‡ï¼‰
è®¢å•DB-2 â† è®¢å•æœåŠ¡ï¼ˆè®¢å•ID 100-200ä¸‡ï¼‰
è®¢å•DB-3 â† è®¢å•æœåŠ¡ï¼ˆè®¢å•ID 200-300ä¸‡ï¼‰
```

**ğŸ”§ Hibernateé…åˆSharding-JDBC**

```java
// é…ç½®å¤šæ•°æ®æº
@Configuration
public class ShardingDataSourceConfig {
    
    @Bean
    public DataSource dataSource() {
        // é…ç½®åˆ†ç‰‡è§„åˆ™
        ShardingRuleConfiguration config = new ShardingRuleConfiguration();
        
        // è®¢å•è¡¨åˆ†ç‰‡è§„åˆ™ï¼šæŒ‰user_idå–æ¨¡
        TableRuleConfiguration orderRule = new TableRuleConfiguration(
            "orders", 
            "ds${0..2}.orders"  // 3ä¸ªæ•°æ®æº
        );
        
        // åˆ†ç‰‡ç®—æ³•ï¼šæ ¹æ®user_idè·¯ç”±
        orderRule.setDatabaseShardingStrategyConfig(
            new InlineShardingStrategyConfiguration(
                "user_id", 
                "ds${user_id % 3}"
            )
        );
        
        config.getTableRuleConfigs().add(orderRule);
        
        return ShardingDataSourceFactory.createDataSource(
            createDataSourceMap(), config, new Properties()
        );
    }
}

// Hibernateå®ä½“ç±»ä¸å˜
@Entity
@Table(name = "orders")
public class Order {
    @Id
    private Long id;
    private Long userId;  // åˆ†ç‰‡é”®
    // ...
}
```

**ğŸ“Š åˆ†ç‰‡ç­–ç•¥é€‰æ‹©**

| åˆ†ç‰‡æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|---------|------|------|
| `æŒ‰ç”¨æˆ·ID` | `ç”¨æˆ·ç»´åº¦æŸ¥è¯¢å¤š` | `æŸ¥è¯¢é›†ä¸­ï¼Œæ€§èƒ½å¥½` | `å¯èƒ½æ•°æ®å€¾æ–œ` |
| `æŒ‰æ—¶é—´` | `å†å²æ•°æ®å½’æ¡£` | `ä¾¿äºæ¸…ç†æ—§æ•°æ®` | `çƒ­ç‚¹æ•°æ®å‹åŠ›å¤§` |
| `æŒ‰åœ°åŸŸ` | `åŒºåŸŸæ€§ä¸šåŠ¡` | `å°±è¿‘è®¿é—®` | `è·¨åŒºåŸŸæŸ¥è¯¢å¤æ‚` |
| `å“ˆå¸Œå–æ¨¡` | `å‡åŒ€åˆ†å¸ƒ` | `è´Ÿè½½å‡è¡¡` | `æ‰©å®¹éº»çƒ¦` |

---

## 4. ğŸ”„ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†


### 4.1 åˆ†å¸ƒå¼äº‹åŠ¡çš„æŒ‘æˆ˜


**ğŸ”¸ ä»æœ¬åœ°äº‹åŠ¡åˆ°åˆ†å¸ƒå¼äº‹åŠ¡**

```
æœ¬åœ°äº‹åŠ¡ï¼ˆå•ä½“åº”ç”¨ï¼‰ï¼š
BEGIN TRANSACTION
  â‘  æ‰£å‡åº“å­˜
  â‘¡ åˆ›å»ºè®¢å•
  â‘¢ æ‰£å‡ä½™é¢
COMMIT / ROLLBACK
         â†“
  è¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ï¼ˆç®€å•ï¼ï¼‰


åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¾®æœåŠ¡ï¼‰ï¼š
åº“å­˜æœåŠ¡ â†’ æ‰£å‡åº“å­˜ âœ…
è®¢å•æœåŠ¡ â†’ åˆ›å»ºè®¢å• âœ…
æ”¯ä»˜æœåŠ¡ â†’ æ‰£å‡ä½™é¢ âŒ å¤±è´¥äº†ï¼
         â†“
  å‰é¢çš„æ“ä½œæ€ä¹ˆå›æ»šï¼Ÿï¼ˆå¤æ‚ï¼ï¼‰
```

**âš ï¸ ä¸èƒ½ç”¨ä¼ ç»Ÿäº‹åŠ¡çš„åŸå› **

- `è·¨æ•°æ®åº“`ï¼šACIDäº‹åŠ¡åªèƒ½åœ¨å•ä¸ªæ•°æ®åº“å†…ä¿è¯
- `è·¨ç½‘ç»œ`ï¼šç½‘ç»œå¯èƒ½å»¶è¿Ÿã€è¶…æ—¶ã€æ–­å¼€
- `ç‹¬ç«‹éƒ¨ç½²`ï¼šå„æœåŠ¡ç‹¬ç«‹ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†å™¨
- `æ€§èƒ½è€ƒè™‘`ï¼šé•¿æ—¶é—´é”å®šèµ„æºå½±å“ç³»ç»Ÿååé‡

### 4.2 Sagaæ¨¡å¼ï¼ˆæ¨èï¼‰


**ğŸ¯ æ ¸å¿ƒæ€æƒ³**ï¼šå°†é•¿äº‹åŠ¡æ‹†åˆ†æˆå¤šä¸ªæœ¬åœ°çŸ­äº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ

```
æ­£å‘æµç¨‹ï¼ˆHappy Pathï¼‰ï¼š

å¼€å§‹ â†’ â‘  æ‰£åº“å­˜ â†’ â‘¡ åˆ›å»ºè®¢å• â†’ â‘¢ æ‰£ä½™é¢ â†’ æˆåŠŸ
       âœ…          âœ…           âœ…

å¤±è´¥æµç¨‹ï¼ˆéœ€è¦è¡¥å¿ï¼‰ï¼š

å¼€å§‹ â†’ â‘  æ‰£åº“å­˜ â†’ â‘¡ åˆ›å»ºè®¢å• â†’ â‘¢ æ‰£ä½™é¢ â†’ âŒå¤±è´¥
       âœ…          âœ…           â†“
       â†‘           â†‘            è¡¥å¿æ“ä½œ
       â‘£ æ¢å¤åº“å­˜ â† â‘¢ å–æ¶ˆè®¢å•
```

**ğŸ”§ ä»£ç å®ç°ï¼ˆç¼–æ’å¼Sagaï¼‰**

```java
@Service
public class OrderSagaOrchestrator {
    
    @Autowired
    private InventoryService inventoryService;
    
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private PaymentService paymentService;
    
    public void createOrderWithSaga(OrderRequest request) {
        Long orderId = null;
        Long inventoryLockId = null;
        
        try {
            // â‘  ç¬¬ä¸€æ­¥ï¼šé”å®šåº“å­˜
            inventoryLockId = inventoryService.lockInventory(
                request.getProductId(), 
                request.getQuantity()
            );
            
            // â‘¡ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè®¢å•
            orderId = orderService.createOrder(request);
            
            // â‘¢ ç¬¬ä¸‰æ­¥ï¼šæ‰£æ¬¾
            paymentService.deductBalance(
                request.getUserId(), 
                request.getAmount()
            );
            
            // å…¨éƒ¨æˆåŠŸï¼Œç¡®è®¤åº“å­˜æ‰£å‡
            inventoryService.confirmInventory(inventoryLockId);
            
        } catch (Exception e) {
            // å‡ºé”™äº†ï¼Œæ‰§è¡Œè¡¥å¿æ“ä½œ
            if (orderId != null) {
                orderService.cancelOrder(orderId);  // å–æ¶ˆè®¢å•
            }
            if (inventoryLockId != null) {
                inventoryService.releaseInventory(inventoryLockId);  // é‡Šæ”¾åº“å­˜
            }
            
            throw new RuntimeException("è®¢å•åˆ›å»ºå¤±è´¥", e);
        }
    }
}
```

**ğŸ“‹ Sagaæ¨¡å¼å¯¹æ¯”**

| æ¨¡å¼ç±»å‹ | å®ç°æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|---------|------|------|
| `ç¼–æ’å¼` | `ä¸­å¤®åè°ƒå™¨æ§åˆ¶æµç¨‹` | `æµç¨‹æ¸…æ™°ï¼Œæ˜“äºç†è§£` | `ä¸­å¤®åè°ƒå™¨æˆä¸ºç“¶é¢ˆ` |
| `ç¼–èˆå¼` | `äº‹ä»¶é©±åŠ¨ï¼Œå„æœåŠ¡å“åº”` | `å»ä¸­å¿ƒåŒ–ï¼Œé«˜å¯ç”¨` | `æµç¨‹åˆ†æ•£ï¼Œéš¾ä»¥è¿½è¸ª` |

### 4.3 TCCæ¨¡å¼ï¼ˆä¸¤é˜¶æ®µæäº¤å˜ç§ï¼‰


**ğŸ”¸ TCCä¸‰ä¸ªé˜¶æ®µ**

```
Tryé˜¶æ®µï¼ˆé¢„ç•™èµ„æºï¼‰ï¼š
åº“å­˜æœåŠ¡ â†’ é”å®š100ä»¶å•†å“ âœ…
æ”¯ä»˜æœåŠ¡ â†’ å†»ç»“500å…ƒ âœ…

Confirmé˜¶æ®µï¼ˆç¡®è®¤æäº¤ï¼‰ï¼š
åº“å­˜æœåŠ¡ â†’ çœŸæ­£æ‰£å‡100ä»¶ âœ…
æ”¯ä»˜æœåŠ¡ â†’ çœŸæ­£æ‰£å‡500å…ƒ âœ…

Cancelé˜¶æ®µï¼ˆå–æ¶ˆå›æ»šï¼‰ï¼š
åº“å­˜æœåŠ¡ â†’ é‡Šæ”¾é”å®šçš„100ä»¶ âœ…
æ”¯ä»˜æœåŠ¡ â†’ è§£å†»500å…ƒ âœ…
```

**ğŸ’» TCCå®ç°ç¤ºä¾‹**

```java
// åº“å­˜æœåŠ¡çš„TCCå®ç°
@Service
public class InventoryTccService {
    
    // Tryï¼šé”å®šåº“å­˜
    public Long tryLockInventory(Long productId, Integer quantity) {
        // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
        Product product = productRepository.findById(productId).get();
        if (product.getStock() < quantity) {
            throw new RuntimeException("åº“å­˜ä¸è¶³");
        }
        
        // åˆ›å»ºåº“å­˜é”å®šè®°å½•
        InventoryLock lock = new InventoryLock();
        lock.setProductId(productId);
        lock.setQuantity(quantity);
        lock.setStatus("LOCKED");
        lock.setExpireTime(LocalDateTime.now().plusMinutes(5));
        
        return inventoryLockRepository.save(lock).getId();
    }
    
    // Confirmï¼šç¡®è®¤æ‰£å‡
    public void confirmInventory(Long lockId) {
        InventoryLock lock = inventoryLockRepository.findById(lockId).get();
        
        // çœŸæ­£æ‰£å‡åº“å­˜
        Product product = productRepository.findById(lock.getProductId()).get();
        product.setStock(product.getStock() - lock.getQuantity());
        productRepository.save(product);
        
        // åˆ é™¤é”å®šè®°å½•
        inventoryLockRepository.delete(lock);
    }
    
    // Cancelï¼šé‡Šæ”¾åº“å­˜
    public void cancelInventory(Long lockId) {
        // ç›´æ¥åˆ é™¤é”å®šè®°å½•ï¼Œåº“å­˜è‡ªåŠ¨é‡Šæ”¾
        inventoryLockRepository.deleteById(lockId);
    }
}
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**
> 
> - TCCè¦æ±‚æœåŠ¡æä¾›Tryã€Confirmã€Cancelä¸‰ä¸ªæ¥å£
> - Confirmå’ŒCancelæ“ä½œå¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼ˆé‡å¤è°ƒç”¨ç»“æœä¸€æ ·ï¼‰
> - éœ€è¦å¤„ç†ç½‘ç»œè¶…æ—¶ã€æœåŠ¡å®•æœºç­‰å¼‚å¸¸æƒ…å†µ

### 4.4 æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ


**ğŸ”¸ æ ¸å¿ƒç†å¿µ**

```
å¼ºä¸€è‡´æ€§ï¼ˆä¼ ç»Ÿäº‹åŠ¡ï¼‰ï¼š
æ•°æ®éšæ—¶éƒ½æ˜¯å‡†ç¡®çš„ï¼Œä½†æ€§èƒ½å·®

æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¾®æœåŠ¡ï¼‰ï¼š
å…è®¸çŸ­æš‚çš„ä¸ä¸€è‡´ï¼Œä½†æœ€ç»ˆä¼šä¸€è‡´ï¼Œæ€§èƒ½å¥½

ç¤ºä¾‹ï¼š
ä¸‹å•åï¼Œåº“å­˜ä¸æ˜¯ç«‹å³æ‰£å‡ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ‰£å‡
ç”¨æˆ·çœ‹åˆ°çš„åº“å­˜å¯èƒ½æœ‰å‡ ç§’å»¶è¿Ÿï¼Œä½†æœ€ç»ˆä¼šå‡†ç¡®
```

**ğŸ”§ åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°**

```java
// è®¢å•æœåŠ¡ï¼šå‘é€æ¶ˆæ¯
@Service
public class OrderService {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @Transactional
    public Order createOrder(OrderRequest request) {
        // â‘  æœ¬åœ°äº‹åŠ¡ï¼šåˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setStatus("PENDING");  // å¾…å¤„ç†çŠ¶æ€
        orderRepository.save(order);
        
        // â‘¡ å‘é€æ¶ˆæ¯ï¼šé€šçŸ¥å…¶ä»–æœåŠ¡
        OrderCreatedEvent event = new OrderCreatedEvent(
            order.getId(),
            request.getProductId(),
            request.getQuantity()
        );
        rabbitTemplate.convertAndSend("order.created", event);
        
        return order;
    }
}

// åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹æ¶ˆæ¯
@Component
public class InventoryEventListener {
    
    @RabbitListener(queues = "inventory.queue")
    @Transactional
    public void onOrderCreated(OrderCreatedEvent event) {
        try {
            // æ‰£å‡åº“å­˜
            Product product = productRepository.findById(event.getProductId()).get();
            product.setStock(product.getStock() - event.getQuantity());
            productRepository.save(product);
            
            // é€šçŸ¥è®¢å•æœåŠ¡ï¼šåº“å­˜æ‰£å‡æˆåŠŸ
            eventPublisher.publish(new InventoryDeductedEvent(event.getOrderId()));
            
        } catch (Exception e) {
            // åº“å­˜ä¸è¶³ï¼Œé€šçŸ¥è®¢å•æœåŠ¡å¤±è´¥
            eventPublisher.publish(new InventoryDeductFailedEvent(event.getOrderId()));
        }
    }
}
```

**ğŸ“Š ä¸€è‡´æ€§ä¿è¯æœºåˆ¶**

| æœºåˆ¶ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `æ¶ˆæ¯ç¡®è®¤` | `æ¶ˆè´¹æˆåŠŸæ‰ACKï¼Œå¤±è´¥é‡è¯•` | `ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±` |
| `å¹‚ç­‰æ€§` | `é‡å¤æ¶ˆè´¹ç»“æœä¸€æ ·` | `é˜²æ­¢é‡å¤æ‰£å‡` |
| `è¡¥å¿ä»»åŠ¡` | `å®šæ—¶æ£€æŸ¥å¼‚å¸¸æ•°æ®å¹¶ä¿®å¤` | `å…œåº•ä¿éšœ` |
| `çŠ¶æ€æœº` | `è®¢å•çŠ¶æ€æµè½¬æ§åˆ¶` | `é˜²æ­¢éæ³•çŠ¶æ€` |

---

## 5. ğŸ›¡ï¸ æ•°æ®ä¸€è‡´æ€§ä¿è¯


### 5.1 è¯»å†™ä¸€è‡´æ€§


**ğŸ”¸ é—®é¢˜åœºæ™¯**

```
åœºæ™¯ï¼šç”¨æˆ·ä¸‹å•åç«‹å³æŸ¥çœ‹è®¢å•

æ—¶é—´çº¿ï¼š
T1: ç”¨æˆ·ç‚¹å‡»ä¸‹å• â†’ è®¢å•æœåŠ¡å†™å…¥è®¢å•ï¼ˆä¸»åº“ï¼‰
T2: å‘é€æ¶ˆæ¯ â†’ åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜
T3: æ•°æ®åŒæ­¥ â†’ è®¢å•ä¸»åº“åŒæ­¥åˆ°ä»åº“ï¼ˆå»¶è¿Ÿ100msï¼‰
T4: ç”¨æˆ·æŸ¥è¯¢è®¢å• â†’ è¯»ä»åº“ï¼ˆè¿˜æ²¡åŒæ­¥å®Œï¼‰â†’ æŸ¥ä¸åˆ°è®¢å•ï¼
```

**âœ… è§£å†³æ–¹æ¡ˆ**

```java
// æ–¹æ¡ˆ1ï¼šå†™åè¯»ä¸»åº“ï¼ˆæ¨èï¼‰
@Service
public class OrderQueryService {
    
    @Autowired
    @Qualifier("masterDataSource")
    private DataSource masterDS;  // ä¸»åº“
    
    @Autowired
    @Qualifier("slaveDataSource")
    private DataSource slaveDS;   // ä»åº“
    
    public Order getOrder(Long orderId, boolean readMaster) {
        // åˆšåˆ›å»ºçš„è®¢å•ï¼Œå¼ºåˆ¶è¯»ä¸»åº“
        if (readMaster) {
            return masterOrderRepository.findById(orderId).get();
        }
        
        // æ™®é€šæŸ¥è¯¢ï¼Œè¯»ä»åº“
        return slaveOrderRepository.findById(orderId).get();
    }
}

// æ–¹æ¡ˆ2ï¼šå»¶è¿Ÿè¯»å–
@RestController
public class OrderController {
    
    @PostMapping("/orders")
    public OrderDTO createOrder(@RequestBody OrderRequest request) {
        Order order = orderService.createOrder(request);
        
        // è¿”å›åˆ›å»ºç»“æœæ—¶ï¼Œç›´æ¥è¿”å›å†…å­˜ä¸­çš„æ•°æ®
        // ä¸ä»æ•°æ®åº“å†æŸ¥ä¸€æ¬¡
        return toDTO(order);
    }
}
```

### 5.2 è·¨æœåŠ¡æ•°æ®ä¸€è‡´æ€§


**ğŸ”¸ åˆ†å¸ƒå¼é”æ–¹æ¡ˆ**

```java
// ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ä¿è¯ä¸€è‡´æ€§
@Service
public class OrderService {
    
    @Autowired
    private RedissonClient redisson;
    
    public void processOrder(Long orderId) {
        // è·å–åˆ†å¸ƒå¼é”
        RLock lock = redisson.getLock("order:" + orderId);
        
        try {
            // å°è¯•åŠ é”ï¼Œæœ€å¤šç­‰å¾…3ç§’ï¼Œé”10ç§’åè‡ªåŠ¨é‡Šæ”¾
            if (lock.tryLock(3, 10, TimeUnit.SECONDS)) {
                
                // â‘  æŸ¥è¯¢è®¢å•ï¼ˆåŠ é”åï¼Œä¿è¯è¯»åˆ°æœ€æ–°æ•°æ®ï¼‰
                Order order = orderRepository.findById(orderId).get();
                
                // â‘¡ è°ƒç”¨å…¶ä»–æœåŠ¡
                inventoryClient.deductStock(order.getProductId());
                
                // â‘¢ æ›´æ–°è®¢å•çŠ¶æ€
                order.setStatus("CONFIRMED");
                orderRepository.save(order);
            }
        } finally {
            lock.unlock();  // é‡Šæ”¾é”
        }
    }
}
```

**ğŸ“‹ ä¸€è‡´æ€§çº§åˆ«é€‰æ‹©**

| ä¸€è‡´æ€§çº§åˆ« | å®ç°æˆæœ¬ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|-----------|---------|------|---------|
| `å¼ºä¸€è‡´` | `é«˜ï¼ˆåˆ†å¸ƒå¼é”/2PCï¼‰` | `ä½` | `é‡‘èäº¤æ˜“` |
| `æœ€ç»ˆä¸€è‡´` | `ä¸­ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰` | `é«˜` | `è®¢å•å¤„ç†` |
| `å¼±ä¸€è‡´` | `ä½ï¼ˆå¼‚æ­¥ï¼‰` | `å¾ˆé«˜` | `æ—¥å¿—è®°å½•` |

### 5.3 æ•°æ®ä¿®å¤æœºåˆ¶


**ğŸ”¸ å¯¹è´¦ä¸è¡¥å¿**

```java
// å®šæ—¶å¯¹è´¦ä»»åŠ¡
@Component
public class DataReconciliationJob {
    
    // æ¯å¤©å‡Œæ™¨2ç‚¹å¯¹è´¦
    @Scheduled(cron = "0 0 2 * * ?")
    public void reconcileOrderAndInventory() {
        
        // â‘  æŸ¥è¯¢æ˜¨å¤©çš„æ‰€æœ‰è®¢å•
        LocalDate yesterday = LocalDate.now().minusDays(1);
        List<Order> orders = orderRepository.findByCreateDate(yesterday);
        
        for (Order order : orders) {
            // â‘¡ æ£€æŸ¥åº“å­˜æ‰£å‡è®°å½•
            InventoryLog log = inventoryClient.getLog(order.getId());
            
            if (log == null && "CONFIRMED".equals(order.getStatus())) {
                // â‘¢ å‘ç°ä¸ä¸€è‡´ï¼šè®¢å•å·²ç¡®è®¤ï¼Œä½†åº“å­˜æ²¡æ‰£
                log.warn("æ•°æ®ä¸ä¸€è‡´: orderId={}", order.getId());
                
                // â‘£ è¡¥å¿ï¼šé‡æ–°æ‰£å‡åº“å­˜
                inventoryClient.deductStock(order.getProductId(), order.getQuantity());
            }
        }
    }
}
```

> ğŸ’¡ **æœ€ä½³å®è·µ**
> 
> - **è®°å½•è¯¦ç»†æ—¥å¿—**ï¼šæ¯ä¸ªæ“ä½œéƒ½è¦æœ‰æ—¥å¿—ï¼Œæ–¹ä¾¿å¯¹è´¦
> - **è®¾ç½®åˆç†çš„å¯¹è´¦å‘¨æœŸ**ï¼šæ ¹æ®ä¸šåŠ¡é‡è¦æ€§å†³å®šï¼ˆå®æ—¶/å°æ—¶/å¤©ï¼‰
> - **äººå·¥ä»‹å…¥æœºåˆ¶**ï¼šè‡ªåŠ¨è¡¥å¿å¤±è´¥æ—¶ï¼Œè¦æœ‰äººå·¥å¤„ç†æµç¨‹

---

## 6. ğŸ”— æœåŠ¡é—´é€šä¿¡


### 6.1 åŒæ­¥é€šä¿¡ï¼ˆREST/gRPCï¼‰


**ğŸ”¸ Feignå®¢æˆ·ç«¯é›†æˆ**

```java
// â‘  å®šä¹‰Feignæ¥å£
@FeignClient(name = "user-service", fallback = UserServiceFallback.class)
public interface UserServiceClient {
    
    @GetMapping("/users/{id}")
    UserDTO getUserById(@PathVariable("id") Long id);
    
    @PostMapping("/users")
    UserDTO createUser(@RequestBody UserRequest request);
}

// â‘¡ é™çº§å¤„ç†
@Component
public class UserServiceFallback implements UserServiceClient {
    
    @Override
    public UserDTO getUserById(Long id) {
        // æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè¿”å›é»˜è®¤æ•°æ®
        UserDTO user = new UserDTO();
        user.setId(id);
        user.setName("æœªçŸ¥ç”¨æˆ·");  // é™çº§æ•°æ®
        return user;
    }
}

// â‘¢ åœ¨æœåŠ¡ä¸­ä½¿ç”¨
@Service
public class OrderService {
    
    @Autowired
    private UserServiceClient userClient;
    
    public OrderDTO getOrderWithUser(Long orderId) {
        Order order = orderRepository.findById(orderId).get();
        
        // è°ƒç”¨ç”¨æˆ·æœåŠ¡
        UserDTO user = userClient.getUserById(order.getUserId());
        
        OrderDTO dto = new OrderDTO();
        dto.setOrder(order);
        dto.setUser(user);
        return dto;
    }
}
```

**âš ï¸ åŒæ­¥è°ƒç”¨çš„é—®é¢˜**

```
é›ªå´©æ•ˆåº”ï¼š

å®¢æˆ·ç«¯è¯·æ±‚
    â†“ è°ƒç”¨è®¢å•æœåŠ¡ï¼ˆå“åº”æ—¶é—´: 2sï¼‰
è®¢å•æœåŠ¡
    â†“ è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼ˆå“åº”æ—¶é—´: 1sï¼‰
ç”¨æˆ·æœåŠ¡
    â†“ è°ƒç”¨ç§¯åˆ†æœåŠ¡ï¼ˆè¶…æ—¶: 30sï¼‰âŒ
ç§¯åˆ†æœåŠ¡å®•æœº
    â†“ 
æ‰€æœ‰æœåŠ¡éƒ½è¢«æ‹–æ…¢ï¼Œæœ€ç»ˆå…¨éƒ¨è¶…æ—¶ï¼
```

**âœ… è§£å†³æ–¹æ¡ˆï¼šç†”æ–­é™çº§**

```java
// Hystrixé…ç½®
@HystrixCommand(
    fallbackMethod = "getUserFallback",
    commandProperties = {
        @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", value = "2000"),
        @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", value = "10"),
        @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", value = "50")
    }
)
public UserDTO getUser(Long userId) {
    return userClient.getUserById(userId);
}

// é™çº§æ–¹æ³•
public UserDTO getUserFallback(Long userId) {
    // ä»ç¼“å­˜è·å–
    UserDTO cached = cacheService.get("user:" + userId);
    if (cached != null) {
        return cached;
    }
    
    // è¿”å›é»˜è®¤å€¼
    return UserDTO.builder()
        .id(userId)
        .name("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•")
        .build();
}
```

### 6.2 å¼‚æ­¥é€šä¿¡ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰


**ğŸ”¸ åŸºäºRabbitMQçš„äº‹ä»¶é©±åŠ¨**

```java
// â‘  å®šä¹‰äº‹ä»¶
@Data
public class OrderCreatedEvent {
    private Long orderId;
    private Long userId;
    private Long productId;
    private Integer quantity;
    private LocalDateTime createTime;
}

// â‘¡ å‘å¸ƒäº‹ä»¶ï¼ˆè®¢å•æœåŠ¡ï¼‰
@Service
public class OrderService {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @Transactional
    public Order createOrder(OrderRequest request) {
        // ä¿å­˜è®¢å•
        Order order = orderRepository.save(new Order(request));
        
        // å‘å¸ƒäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent();
        event.setOrderId(order.getId());
        event.setProductId(request.getProductId());
        event.setQuantity(request.getQuantity());
        
        rabbitTemplate.convertAndSend(
            "order.exchange",     // äº¤æ¢æœº
            "order.created",      // è·¯ç”±é”®
            event                 // æ¶ˆæ¯å†…å®¹
        );
        
        return order;
    }
}

// â‘¢ ç›‘å¬äº‹ä»¶ï¼ˆåº“å­˜æœåŠ¡ï¼‰
@Component
public class InventoryEventListener {
    
    @RabbitListener(queues = "inventory.order.queue")
    public void handleOrderCreated(OrderCreatedEvent event) {
        
        // æ‰£å‡åº“å­˜
        inventoryService.deduct(
            event.getProductId(), 
            event.getQuantity()
        );
        
        log.info("è®¢å•{}çš„åº“å­˜å·²æ‰£å‡", event.getOrderId());
    }
}
```

**ğŸ“Š åŒæ­¥vså¼‚æ­¥å¯¹æ¯”**

| é€šä¿¡æ–¹å¼ | å“åº”é€Ÿåº¦ | å¯é æ€§ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|---------|---------|--------|--------|---------|
| `åŒæ­¥è°ƒç”¨` | `å¿«ï¼ˆmsçº§ï¼‰` | `ä½ï¼ˆä¾èµ–å¯ç”¨æ€§ï¼‰` | `ç®€å•` | `æŸ¥è¯¢ç±»æ“ä½œ` |
| `å¼‚æ­¥æ¶ˆæ¯` | `æ…¢ï¼ˆsçº§ï¼‰` | `é«˜ï¼ˆæŒä¹…åŒ–ï¼‰` | `å¤æ‚` | `é€šçŸ¥ç±»æ“ä½œ` |

### 6.3 æ•°æ®ä¼ è¾“ä¼˜åŒ–


**ğŸ”¸ æ‰¹é‡æŸ¥è¯¢å‡å°‘è°ƒç”¨**

```java
// âŒ æ•ˆç‡ä½ï¼šN+1é—®é¢˜
public List<OrderDTO> getOrders(List<Long> orderIds) {
    List<OrderDTO> result = new ArrayList<>();
    
    for (Long orderId : orderIds) {
        Order order = orderRepository.findById(orderId).get();
        UserDTO user = userClient.getUserById(order.getUserId());  // Næ¬¡è°ƒç”¨ï¼
        
        OrderDTO dto = new OrderDTO(order, user);
        result.add(dto);
    }
    
    return result;
}

// âœ… æ•ˆç‡é«˜ï¼šæ‰¹é‡æŸ¥è¯¢
public List<OrderDTO> getOrdersOptimized(List<Long> orderIds) {
    // â‘  æ‰¹é‡æŸ¥è¯¢è®¢å•
    List<Order> orders = orderRepository.findAllById(orderIds);
    
    // â‘¡ æå–æ‰€æœ‰ç”¨æˆ·ID
    Set<Long> userIds = orders.stream()
        .map(Order::getUserId)
        .collect(Collectors.toSet());
    
    // â‘¢ æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·ï¼ˆä¸€æ¬¡è°ƒç”¨ï¼‰
    List<UserDTO> users = userClient.getUsersByIds(userIds);
    Map<Long, UserDTO> userMap = users.stream()
        .collect(Collectors.toMap(UserDTO::getId, u -> u));
    
    // â‘£ ç»„è£…æ•°æ®
    return orders.stream()
        .map(order -> new OrderDTO(order, userMap.get(order.getUserId())))
        .collect(Collectors.toList());
}
```

---

## 7. ğŸ’¾ ç¼“å­˜ç­–ç•¥


### 7.1 å¤šçº§ç¼“å­˜æ¶æ„


**ğŸ”¸ ç¼“å­˜å±‚æ¬¡è®¾è®¡**

```
è¯·æ±‚æµç¨‹ï¼š

å®¢æˆ·ç«¯
   â†“
â‘  æœ¬åœ°ç¼“å­˜ï¼ˆJVMå†…å­˜ï¼‰
   â†“ Miss
â‘¡ Redisç¼“å­˜ï¼ˆé›†ä¸­å¼ï¼‰
   â†“ Miss  
â‘¢ æ•°æ®åº“æŸ¥è¯¢ï¼ˆHibernateï¼‰
   â†“
è¿”å›ç»“æœ â†’ å†™å…¥Redis â†’ å†™å…¥æœ¬åœ°ç¼“å­˜
```

**ğŸ”§ ä»£ç å®ç°**

```java
@Service
public class ProductService {
    
    @Autowired
    private ProductRepository productRepository;
    
    @Autowired
    private RedisTemplate<String, ProductDTO> redisTemplate;
    
    // æœ¬åœ°ç¼“å­˜
    private Cache<Long, ProductDTO> localCache = CacheBuilder.newBuilder()
        .maximumSize(1000)
        .expireAfterWrite(5, TimeUnit.MINUTES)
        .build();
    
    public ProductDTO getProduct(Long productId) {
        
        // â‘  æŸ¥æœ¬åœ°ç¼“å­˜
        ProductDTO cached = localCache.getIfPresent(productId);
        if (cached != null) {
            log.debug("æœ¬åœ°ç¼“å­˜å‘½ä¸­: {}", productId);
            return cached;
        }
        
        // â‘¡ æŸ¥Redis
        String redisKey = "product:" + productId;
        cached = redisTemplate.opsForValue().get(redisKey);
        if (cached != null) {
            log.debug("Redisç¼“å­˜å‘½ä¸­: {}", productId);
            localCache.put(productId, cached);  // å›å†™æœ¬åœ°ç¼“å­˜
            return cached;
        }
        
        // â‘¢ æŸ¥æ•°æ®åº“
        Product product = productRepository.findById(productId)
            .orElseThrow(() -> new RuntimeException("å•†å“ä¸å­˜åœ¨"));
        
        ProductDTO dto = toDTO(product);
        
        // â‘£ å†™å…¥ç¼“å­˜
        redisTemplate.opsForValue().set(redisKey, dto, 1, TimeUnit.HOURS);
        localCache.put(productId, dto);
        
        return dto;
    }
}
```

### 7.2 ç¼“å­˜æ›´æ–°ç­–ç•¥


**ğŸ”¸ æ›´æ–°æ¨¡å¼å¯¹æ¯”**

```
æ¨¡å¼1: Cache-Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰
å†™æ“ä½œï¼š
  â‘  æ›´æ–°æ•°æ®åº“
  â‘¡ åˆ é™¤ç¼“å­˜
è¯»æ“ä½œï¼š
  â‘  æŸ¥ç¼“å­˜
  â‘¡ ç¼“å­˜miss â†’ æŸ¥æ•°æ®åº“ â†’ å†™ç¼“å­˜

æ¨¡å¼2: Write-Throughï¼ˆå†™ç©¿é€ï¼‰
å†™æ“ä½œï¼š
  â‘  æ›´æ–°ç¼“å­˜
  â‘¡ ç¼“å­˜æ›´æ–°æ•°æ®åº“
  
æ¨¡å¼3: Write-Behindï¼ˆå†™å›ï¼‰
å†™æ“ä½œï¼š
  â‘  æ›´æ–°ç¼“å­˜
  â‘¡ å¼‚æ­¥æ›´æ–°æ•°æ®åº“
```

**ğŸ’» å®ç°Cache-Asideæ¨¡å¼**

```java
@Service
public class ProductService {
    
    // æ›´æ–°å•†å“
    @Transactional
    public void updateProduct(Long productId, ProductUpdateRequest request) {
        
        // â‘  æ›´æ–°æ•°æ®åº“
        Product product = productRepository.findById(productId).get();
        product.setName(request.getName());
        product.setPrice(request.getPrice());
        productRepository.save(product);
        
        // â‘¡ åˆ é™¤ç¼“å­˜ï¼ˆè®©ä¸‹æ¬¡è¯»æ—¶é‡æ–°åŠ è½½ï¼‰
        String redisKey = "product:" + productId;
        redisTemplate.delete(redisKey);
        localCache.invalidate(productId);
        
        // â‘¢ å‘å¸ƒäº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–æœåŠ¡
        eventPublisher.publish(new ProductUpdatedEvent(productId));
    }
}
```

**âš ï¸ ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜**

```
å¹¶å‘åœºæ™¯ï¼š

çº¿ç¨‹A: æ›´æ–°æ•°æ®åº“ â†’ åˆ é™¤ç¼“å­˜
çº¿ç¨‹B:               æŸ¥è¯¢ï¼ˆç¼“å­˜missï¼‰â†’ æŸ¥æ•°æ®åº“ï¼ˆæ—§å€¼ï¼‰â†’ å†™ç¼“å­˜ï¼ˆæ—§å€¼ï¼‰
çº¿ç¨‹A:                                                  â† æ­¤æ—¶ç¼“å­˜æ˜¯æ—§æ•°æ®ï¼

è§£å†³æ–¹æ¡ˆï¼šå»¶è¿ŸåŒåˆ 
çº¿ç¨‹A: æ›´æ–°æ•°æ®åº“ â†’ åˆ é™¤ç¼“å­˜ â†’ sleep(500ms) â†’ å†æ¬¡åˆ é™¤ç¼“å­˜
```

```java
public void updateProductWithDoubleDelete(Long productId, ProductUpdateRequest request) {
    
    String redisKey = "product:" + productId;
    
    // ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜
    redisTemplate.delete(redisKey);
    
    // æ›´æ–°æ•°æ®åº“
    Product product = productRepository.findById(productId).get();
    product.setName(request.getName());
    productRepository.save(product);
    
    // å»¶è¿Ÿåå†åˆ é™¤ä¸€æ¬¡
    CompletableFuture.runAsync(() -> {
        try {
            Thread.sleep(500);  // ç­‰å¾…å¯èƒ½çš„å¹¶å‘æŸ¥è¯¢å®Œæˆ
            redisTemplate.delete(redisKey);
        } catch (InterruptedException e) {
            log.error("å»¶è¿Ÿåˆ é™¤ç¼“å­˜å¤±è´¥", e);
        }
    });
}
```

### 7.3 ç¼“å­˜é¢„çƒ­ä¸é™çº§


**ğŸ”¸ ç³»ç»Ÿå¯åŠ¨æ—¶é¢„çƒ­ç¼“å­˜**

```java
@Component
public class CacheWarmUpTask implements ApplicationListener<ContextRefreshedEvent> {
    
    @Autowired
    private ProductRepository productRepository;
    
    @Autowired
    private RedisTemplate<String, ProductDTO> redisTemplate;
    
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        log.info("å¼€å§‹é¢„çƒ­å•†å“ç¼“å­˜...");
        
        // æŸ¥è¯¢çƒ­é—¨å•†å“
        List<Product> hotProducts = productRepository.findTop100ByOrderBySalesDesc();
        
        // å†™å…¥Redis
        hotProducts.forEach(product -> {
            String key = "product:" + product.getId();
            redisTemplate.opsForValue().set(
                key, 
                toDTO(product), 
                1, 
                TimeUnit.HOURS
            );
        });
        
        log.info("ç¼“å­˜é¢„çƒ­å®Œæˆï¼Œå…±åŠ è½½{}ä¸ªå•†å“", hotProducts.size());
    }
}
```

**ğŸ”¸ ç¼“å­˜é™çº§ç­–ç•¥**

```java
@Service
public class ProductService {
    
    @Autowired
    private CircuitBreakerRegistry circuitBreakerRegistry;
    
    public ProductDTO getProduct(Long productId) {
        
        CircuitBreaker breaker = circuitBreakerRegistry.circuitBreaker("redis");
        
        return breaker.executeSupplier(() -> {
            try {
                // æ­£å¸¸ä»ç¼“å­˜è·å–
                return getFromCache(productId);
            } catch (Exception e) {
                // Redisæ•…éšœï¼Œé™çº§åˆ°æ•°æ®åº“
                log.warn("Rediså¼‚å¸¸ï¼Œé™çº§æŸ¥è¯¢æ•°æ®åº“", e);
                return getFromDatabase(productId);
            }
        });
    }
}
```

---

## 8. ğŸ“Š ç›‘æ§ä¸æ²»ç†


### 8.1 æ€§èƒ½ç›‘æ§


**ğŸ”¸ ç›‘æ§æŒ‡æ ‡ä½“ç³»**

```
åº”ç”¨å±‚æŒ‡æ ‡ï¼š
â”œâ”€ æ¥å£å“åº”æ—¶é—´
â”œâ”€ QPS/TPS
â”œâ”€ é”™è¯¯ç‡
â””â”€ æ…¢SQLç»Ÿè®¡

æ•°æ®åº“å±‚æŒ‡æ ‡ï¼š
â”œâ”€ è¿æ¥æ± ä½¿ç”¨ç‡
â”œâ”€ æŸ¥è¯¢æ‰§è¡Œæ—¶é—´
â”œâ”€ æ…¢æŸ¥è¯¢æ—¥å¿—
â””â”€ äº‹åŠ¡æ‰§è¡Œæ—¶é—´

ç¼“å­˜å±‚æŒ‡æ ‡ï¼š
â”œâ”€ å‘½ä¸­ç‡
â”œâ”€ ç¼“å­˜å¤§å°
â”œâ”€ é©±é€æ¬¡æ•°
â””â”€ è¿‡æœŸç­–ç•¥æ•ˆæœ
```

**ğŸ”§ Hibernateç»Ÿè®¡ä¿¡æ¯**

```java
@Configuration
public class HibernateMonitorConfig {
    
    @Bean
    public SessionFactory sessionFactory(EntityManagerFactory emf) {
        SessionFactory sf = emf.unwrap(SessionFactory.class);
        
        // å¼€å¯ç»Ÿè®¡
        sf.getStatistics().setStatisticsEnabled(true);
        
        return sf;
    }
}

@Component
public class HibernateMetricsCollector {
    
    @Autowired
    private SessionFactory sessionFactory;
    
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ”¶é›†ä¸€æ¬¡
    public void collectMetrics() {
        Statistics stats = sessionFactory.getStatistics();
        
        log.info("==== Hibernateç»Ÿè®¡ ====");
        log.info("æŸ¥è¯¢æ¬¡æ•°: {}", stats.getQueryExecutionCount());
        log.info("äºŒçº§ç¼“å­˜å‘½ä¸­: {}", stats.getSecondLevelCacheHitCount());
        log.info("äºŒçº§ç¼“å­˜æœªå‘½ä¸­: {}", stats.getSecondLevelCacheMissCount());
        log.info("æ…¢æŸ¥è¯¢: {}", stats.getSlowQueries());
        
        // ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿï¼ˆPrometheusã€InfluxDBç­‰ï¼‰
        metricsRegistry.gauge("hibernate.query.count", stats.getQueryExecutionCount());
        metricsRegistry.gauge("hibernate.cache.hit.rate", 
            (double)stats.getSecondLevelCacheHitCount() / 
            (stats.getSecondLevelCacheHitCount() + stats.getSecondLevelCacheMissCount())
        );
    }
}
```

### 8.2 é“¾è·¯è¿½è¸ª


**ğŸ”¸ åˆ†å¸ƒå¼è¿½è¸ªæ¶æ„**

```
ç”¨æˆ·è¯·æ±‚
   â†“ TraceId: abc123
ç½‘å…³æœåŠ¡ï¼ˆSpan1ï¼‰
   â†“ TraceId: abc123, SpanId: span1
è®¢å•æœåŠ¡ï¼ˆSpan2ï¼‰
   â†“ TraceId: abc123, SpanId: span2, ParentId: span1
ç”¨æˆ·æœåŠ¡ï¼ˆSpan3ï¼‰
   â†“ TraceId: abc123, SpanId: span3, ParentId: span2
æ•°æ®åº“æŸ¥è¯¢ï¼ˆSpan4ï¼‰
   â†“ TraceId: abc123, SpanId: span4, ParentId: span3

æœ€ç»ˆå½¢æˆå®Œæ•´è°ƒç”¨é“¾
```

**ğŸ’» é›†æˆSleuthå’ŒZipkin**

```java
// â‘  æ·»åŠ ä¾èµ–
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-sleuth</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-sleuth-zipkin</artifactId>
</dependency>

// â‘¡ é…ç½®
spring:
  sleuth:
    sampler:
      probability: 0.1  # 10%é‡‡æ ·ç‡
  zipkin:
    base-url: http://zipkin-server:9411

// â‘¢ ä½¿ç”¨ï¼ˆè‡ªåŠ¨æ³¨å…¥TraceIdï¼‰
@Service
public class OrderService {
    
    @Autowired
    private Tracer tracer;
    
    public Order createOrder(OrderRequest request) {
        Span span = tracer.currentSpan();
        span.tag("order.type", request.getType());
        span.tag("user.id", request.getUserId().toString());
        
        // ä¸šåŠ¡é€»è¾‘
        Order order = orderRepository.save(new Order(request));
        
        return order;
    }
}
```

### 8.3 æœåŠ¡æ²»ç†


**ğŸ”¸ é™æµé™çº§é…ç½®**

```java
@Configuration
public class RateLimitConfig {
    
    @Bean
    public RateLimiter orderServiceLimiter() {
        // æ¯ç§’æœ€å¤š100ä¸ªè¯·æ±‚
        return RateLimiter.create(100.0);
    }
}

@RestController
public class OrderController {
    
    @Autowired
    private RateLimiter rateLimiter;
    
    @PostMapping("/orders")
    public ResponseEntity<?> createOrder(@RequestBody OrderRequest request) {
        
        // å°è¯•è·å–ä»¤ç‰Œ
        if (!rateLimiter.tryAcquire(1, TimeUnit.SECONDS)) {
            return ResponseEntity.status(429)
                .body("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
        }
        
        // æ­£å¸¸å¤„ç†
        Order order = orderService.createOrder(request);
        return ResponseEntity.ok(order);
    }
}
```

**ğŸ“Š å¥åº·æ£€æŸ¥é…ç½®**

```java
@Component
public class DatabaseHealthIndicator implements HealthIndicator {
    
    @Autowired
    private DataSource dataSource;
    
    @Override
    public Health health() {
        try (Connection conn = dataSource.getConnection()) {
            // æ‰§è¡Œç®€å•æŸ¥è¯¢æµ‹è¯•è¿æ¥
            conn.prepareStatement("SELECT 1").execute();
            
            return Health.up()
                .withDetail("database", "MySQL")
                .withDetail("status", "connected")
                .build();
                
        } catch (Exception e) {
            return Health.down()
                .withDetail("error", e.getMessage())
                .build();
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¾®æœåŠ¡ç‰¹ç‚¹ï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼ŒæœåŠ¡é—´é€šè¿‡APIé€šä¿¡
ğŸ”¸ æ•°æ®è®¿é—®ï¼šDatabase per Serviceæ¨¡å¼ï¼Œé¿å…è·¨åº“JOIN
ğŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡ï¼šSagaæ¨¡å¼ã€TCCæ¨¡å¼ã€æœ€ç»ˆä¸€è‡´æ€§
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šè¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼é”ã€å¯¹è´¦è¡¥å¿
ğŸ”¸ æœåŠ¡é€šä¿¡ï¼šåŒæ­¥è°ƒç”¨ï¼ˆRESTï¼‰+ å¼‚æ­¥æ¶ˆæ¯ï¼ˆMQï¼‰
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šå¤šçº§ç¼“å­˜ã€Cache-Asideæ¨¡å¼ã€é¢„çƒ­é™çº§
ğŸ”¸ ç›‘æ§æ²»ç†ï¼šæ€§èƒ½ç›‘æ§ã€é“¾è·¯è¿½è¸ªã€é™æµç†”æ–­
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦æ‹†åˆ†æ•°æ®åº“**

- `ç‹¬ç«‹æ€§`ï¼šæœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²ã€æ‰©å±•
- `éš”ç¦»æ€§`ï¼šä¸€ä¸ªæœåŠ¡çš„æ•…éšœä¸å½±å“å…¶ä»–æœåŠ¡
- `æŠ€æœ¯é€‰å‹`ï¼šå¯ä»¥ä¸ºä¸åŒæœåŠ¡é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®åº“
- `å›¢é˜Ÿè‡ªæ²»`ï¼šæ¯ä¸ªå›¢é˜Ÿå®Œå…¨æŒæ§è‡ªå·±çš„æ•°æ®

**ğŸ”¹ åˆ†å¸ƒå¼äº‹åŠ¡çš„æƒè¡¡**

| æ–¹æ¡ˆ | ä¸€è‡´æ€§ | æ€§èƒ½ | å¤æ‚åº¦ | æ¨èåº¦ |
|------|--------|------|--------|--------|
| `2PC/XA` | `å¼ºä¸€è‡´` | `ä½` | `é«˜` | â­ |
| `TCC` | `å¼ºä¸€è‡´` | `ä¸­` | `é«˜` | â­â­â­ |
| `Saga` | `æœ€ç»ˆä¸€è‡´` | `é«˜` | `ä¸­` | â­â­â­â­ |
| `æ¶ˆæ¯é˜Ÿåˆ—` | `æœ€ç»ˆä¸€è‡´` | `é«˜` | `ä½` | â­â­â­â­â­ |

**ğŸ”¹ ç¼“å­˜ä½¿ç”¨çš„æ³¨æ„äº‹é¡¹**

```
âœ… æ­£ç¡®åšæ³•ï¼š
- ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆäºŒå…«å®šå¾‹ï¼‰
- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
- ç¼“å­˜æ›´æ–°æ—¶åˆ é™¤ç¼“å­˜
- ä½¿ç”¨å»¶è¿ŸåŒåˆ ä¿è¯ä¸€è‡´æ€§
- é¢„çƒ­é‡è¦æ•°æ®
- é™çº§ç­–ç•¥ä¿è¯å¯ç”¨æ€§

âŒ å¸¸è§é”™è¯¯ï¼š
- ç¼“å­˜ç©¿é€ï¼ˆæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼‰
- ç¼“å­˜é›ªå´©ï¼ˆå¤§é‡keyåŒæ—¶è¿‡æœŸï¼‰
- ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹keyè¿‡æœŸï¼‰
- ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå†…å­˜æº¢å‡ºï¼‰
```

### 9.3 å®æˆ˜æœ€ä½³å®è·µ


**ğŸ¯ æ¶æ„è®¾è®¡æ¸…å•**

- [ ] âœ… æœåŠ¡æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ï¼Œé«˜å†…èšä½è€¦åˆ
- [ ] âœ… æ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼Œé¿å…è·¨åº“å…³è”
- [ ] âœ… ä½¿ç”¨Sagaæˆ–æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡
- [ ] âœ… å…³é”®æ•°æ®è¦æœ‰å¯¹è´¦å’Œè¡¥å¿æœºåˆ¶
- [ ] âœ… åŒæ­¥è°ƒç”¨è¦æœ‰ç†”æ–­é™çº§
- [ ] âœ… å¼‚æ­¥æ¶ˆæ¯è¦ä¿è¯å¹‚ç­‰æ€§
- [ ] âœ… å¤šçº§ç¼“å­˜æå‡æ€§èƒ½
- [ ] âœ… å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦

**ğŸ’¡ å¼€å‘è§„èŒƒ**

```java
// 1. å®ä½“ç±»åªåŒ…å«æœ¬æœåŠ¡çš„æ•°æ®
@Entity
public class Order {
    private Long userId;  // âœ… åªå­˜ID
    // private User user; // âŒ ä¸è¦å…³è”å…¶ä»–æœåŠ¡çš„å®ä½“
}

// 2. æœåŠ¡è°ƒç”¨è¦æœ‰é™çº§
@HystrixCommand(fallbackMethod = "getUserFallback")
public UserDTO getUser(Long id) {
    return userClient.getUserById(id);
}

// 3. æ¶ˆæ¯æ¶ˆè´¹è¦ä¿è¯å¹‚ç­‰
@Transactional
public void onOrderCreated(OrderCreatedEvent event) {
    // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
    if (processedRepository.exists(event.getOrderId())) {
        return;  // å·²å¤„ç†ï¼Œç›´æ¥è¿”å›
    }
    
    // ä¸šåŠ¡é€»è¾‘
    // ...
    
    // è®°å½•å·²å¤„ç†
    processedRepository.save(event.getOrderId());
}
```

**ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®**

```
æ•°æ®åº“å±‚ï¼š
â€¢ åˆç†ä½¿ç”¨ç´¢å¼•
â€¢ é¿å…N+1æŸ¥è¯¢ï¼ˆæ‰¹é‡æŸ¥è¯¢ï¼‰
â€¢ è¯»å†™åˆ†ç¦»
â€¢ åˆ†åº“åˆ†è¡¨

ç¼“å­˜å±‚ï¼š
â€¢ æœ¬åœ°ç¼“å­˜ + Redis
â€¢ çƒ­ç‚¹æ•°æ®é¢„çƒ­
â€¢ åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´
â€¢ é™çº§ç­–ç•¥

é€šä¿¡å±‚ï¼š
â€¢ æ‰¹é‡è°ƒç”¨å‡å°‘ç½‘ç»œå¼€é”€
â€¢ å¼‚æ­¥åŒ–éæ ¸å¿ƒæµç¨‹
â€¢ ä½¿ç”¨è¿æ¥æ± 
â€¢ å¼€å¯å‹ç¼©

ç›‘æ§å±‚ï¼š
â€¢ æ…¢æŸ¥è¯¢ç›‘æ§
â€¢ æ¥å£å“åº”æ—¶é—´
â€¢ é”™è¯¯ç‡å‘Šè­¦
â€¢ èµ„æºä½¿ç”¨ç‡
```

### 9.4 å­¦ä¹ è·¯çº¿å»ºè®®


```
åˆçº§é˜¶æ®µ â­â­
â”œâ”€ ç†è§£å¾®æœåŠ¡åŸºæœ¬æ¦‚å¿µ
â”œâ”€ æŒæ¡Database per Serviceæ¨¡å¼
â”œâ”€ å­¦ä¼šä½¿ç”¨Feignè¿›è¡ŒæœåŠ¡è°ƒç”¨
â””â”€ äº†è§£åŸºæœ¬çš„ç¼“å­˜ä½¿ç”¨

ä¸­çº§é˜¶æ®µ â­â­â­
â”œâ”€ ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSagaã€TCCï¼‰
â”œâ”€ æŒæ¡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æœ€ç»ˆä¸€è‡´æ€§
â”œâ”€ å­¦ä¼šå¤šçº§ç¼“å­˜ç­–ç•¥
â””â”€ äº†è§£æ•°æ®åŒæ­¥å’Œå¯¹è´¦æœºåˆ¶

é«˜çº§é˜¶æ®µ â­â­â­â­
â”œâ”€ è®¾è®¡å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„
â”œâ”€ æ€§èƒ½è°ƒä¼˜å’Œé—®é¢˜æ’æŸ¥
â”œâ”€ ç›‘æ§ä½“ç³»å»ºè®¾
â””â”€ é«˜å¯ç”¨å’Œå®¹ç¾æ–¹æ¡ˆ
```

### 9.5 å¸¸è§é—®é¢˜FAQ


**Q1: å¾®æœåŠ¡ä¸­è¿˜èƒ½ç”¨Hibernateçš„å…³è”æ˜ å°„å—ï¼Ÿ**

```
A: åªèƒ½åœ¨åŒä¸€ä¸ªæœåŠ¡å†…ä½¿ç”¨

âœ… å¯ä»¥ï¼š
@Entity
public class Order {
    @OneToMany(mappedBy = "order")
    private List<OrderItem> items;  // åŒæœåŠ¡å†…
}

âŒ ä¸å¯ä»¥ï¼š
@Entity  
public class Order {
    @ManyToOne
    private User user;  // è·¨æœåŠ¡ï¼ŒUseråœ¨å¦ä¸€ä¸ªæ•°æ®åº“
}
```

**Q2: å¦‚ä½•å¤„ç†è·¨æœåŠ¡çš„å¤æ‚æŸ¥è¯¢ï¼Ÿ**

```
A: æœ‰ä¸‰ç§æ–¹æ¡ˆ

æ–¹æ¡ˆ1: APIç»„åˆï¼ˆé€‚åˆç®€å•åœºæ™¯ï¼‰
- å¤šæ¬¡è°ƒç”¨ä¸åŒæœåŠ¡
- åº”ç”¨å±‚ç»„è£…æ•°æ®

æ–¹æ¡ˆ2: CQRSï¼ˆé€‚åˆå¤æ‚æŸ¥è¯¢ï¼‰
- å†™æ“ä½œæ­£å¸¸å¤„ç†
- è¯»æ“ä½œä½¿ç”¨ä¸“é—¨çš„æŸ¥è¯¢æ•°æ®åº“

æ–¹æ¡ˆ3: æ•°æ®æ¹–/æ•°æ®ä»“åº“ï¼ˆé€‚åˆåˆ†æåœºæ™¯ï¼‰
- å„æœåŠ¡æ•°æ®åŒæ­¥åˆ°æ•°æ®ä»“åº“
- åœ¨æ•°æ®ä»“åº“è¿›è¡Œå¤æ‚æŸ¥è¯¢
```

**Q3: åˆ†å¸ƒå¼äº‹åŠ¡æ€§èƒ½å¤ªå·®æ€ä¹ˆåŠï¼Ÿ**

```
A: ä¼˜å…ˆè€ƒè™‘ä¸šåŠ¡è®¾è®¡ï¼Œé¿å…åˆ†å¸ƒå¼äº‹åŠ¡

è®¾è®¡åŸåˆ™ï¼š
1. å°½é‡æŠŠéœ€è¦äº‹åŠ¡çš„æ“ä½œæ”¾åœ¨åŒä¸€ä¸ªæœåŠ¡å†…
2. ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§ä»£æ›¿å¼ºä¸€è‡´æ€§
3. å¼‚æ­¥åŒ–éæ ¸å¿ƒæµç¨‹
4. ä½¿ç”¨è¡¥å¿æœºåˆ¶è€Œéåˆ†å¸ƒå¼é”

ç¤ºä¾‹ï¼š
âŒ ä¸‹å• â†’ æ‰£åº“å­˜ â†’ æ‰£ä½™é¢ï¼ˆ3ä¸ªæœåŠ¡ï¼Œå¼ºäº‹åŠ¡ï¼‰
âœ… ä¸‹å• â†’ é”å®šåº“å­˜ â†’ å¼‚æ­¥æ‰£æ¬¾ï¼ˆæ¾è€¦åˆï¼Œæœ€ç»ˆä¸€è‡´ï¼‰
```

**Q4: ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ**

```
A: é‡‡ç”¨å¤šç§æªæ–½ç»„åˆ

å®æ—¶ä¿è¯ï¼š
â€¢ å»¶è¿ŸåŒåˆ 
â€¢ åˆ†å¸ƒå¼é”
â€¢ è¯»å†™é”

æœ€ç»ˆä¸€è‡´ï¼š
â€¢ å®šæ—¶å¯¹è´¦
â€¢ è¡¥å¿ä»»åŠ¡
â€¢ ç¼“å­˜è¿‡æœŸ

å¯ä»¥æ¥å—ï¼š
â€¢ è®¾ç½®çŸ­è¿‡æœŸæ—¶é—´
â€¢ é‡è¦æ•°æ®ä¸ç¼“å­˜
```

**Q5: å¦‚ä½•ç›‘æ§å¾®æœåŠ¡ä¸­çš„Hibernateæ€§èƒ½ï¼Ÿ**

```
A: å¤šç»´åº¦ç›‘æ§

åº”ç”¨å±‚ï¼š
â€¢ å¼€å¯Hibernateç»Ÿè®¡
â€¢ è®°å½•æ…¢SQLæ—¥å¿—
â€¢ ç›‘æ§è¿æ¥æ± çŠ¶æ€

åŸºç¡€è®¾æ–½å±‚ï¼š
â€¢ æ•°æ®åº“ç›‘æ§ï¼ˆæ…¢æŸ¥è¯¢ã€è¿æ¥æ•°ï¼‰
â€¢ é“¾è·¯è¿½è¸ªï¼ˆSleuth/Zipkinï¼‰
â€¢ æŒ‡æ ‡æ”¶é›†ï¼ˆPrometheusï¼‰

ä¸šåŠ¡å±‚ï¼š
â€¢ æ¥å£å“åº”æ—¶é—´
â€¢ é”™è¯¯ç‡
â€¢ ä¸šåŠ¡æŒ‡æ ‡ï¼ˆè®¢å•é‡ã€æˆåŠŸç‡ç­‰ï¼‰
```

---

## ğŸ“ æ€»ç»“ä¸å±•æœ›


**æ ¸å¿ƒæ€æƒ³å›é¡¾**

å¾®æœåŠ¡æ¶æ„ä¸­ä½¿ç”¨Hibernateï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨**åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç®¡ç†æ•°æ®è®¿é—®**çš„é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦ï¼š

1. **è½¬å˜æ€ç»´**ï¼šä»å•ä½“çš„`JOINæŸ¥è¯¢`è½¬å‘`æœåŠ¡ç»„åˆ`
2. **æ¥å—æƒè¡¡**ï¼šç”¨`æœ€ç»ˆä¸€è‡´æ€§`æ¢å–`é«˜å¯ç”¨æ€§`å’Œ`å¯æ‰©å±•æ€§`
3. **å·¥ç¨‹åŒ–**ï¼šé€šè¿‡`ç¼“å­˜`ã€`å¼‚æ­¥`ã€`é™çº§`ç­‰æ‰‹æ®µä¿è¯æ€§èƒ½
4. **å®Œå–„ç›‘æ§**ï¼šåŠæ—¶å‘ç°å’Œè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é—®é¢˜

**å®è·µå»ºè®®**

```
ğŸ¯ å¾ªåºæ¸è¿›ï¼š
ç¬¬1æ­¥ï¼šç†è§£å¾®æœåŠ¡åŸºæœ¬æ¦‚å¿µï¼Œåšç®€å•çš„æœåŠ¡æ‹†åˆ†
ç¬¬2æ­¥ï¼šå®è·µDatabase per Serviceï¼Œä½“ä¼šæ•°æ®éš”ç¦»
ç¬¬3æ­¥ï¼šå¤„ç†è·¨æœåŠ¡æŸ¥è¯¢ï¼Œå­¦ä¹ APIç»„åˆæ¨¡å¼
ç¬¬4æ­¥ï¼šè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒæŒæ¡Saga/æ¶ˆæ¯é˜Ÿåˆ—
ç¬¬5æ­¥ï¼šä¼˜åŒ–æ€§èƒ½ï¼Œå¼•å…¥å¤šçº§ç¼“å­˜
ç¬¬6æ­¥ï¼šå»ºè®¾ç›‘æ§ï¼Œå½¢æˆå®Œæ•´é—­ç¯

ğŸ’¡ æŒç»­å­¦ä¹ ï¼š
â€¢ å…³æ³¨ç¤¾åŒºæœ€æ–°å®è·µ
â€¢ é˜…è¯»ä¼˜ç§€å¼€æºé¡¹ç›®æºç 
â€¢ åœ¨å®é™…é¡¹ç›®ä¸­ä¸æ–­æ€»ç»“
â€¢ å‚ä¸æŠ€æœ¯è®¨è®ºå’Œåˆ†äº«
```

> ğŸš€ **æœ€åçš„è¯**
> 
> å¾®æœåŠ¡æ¶æ„ä¸æ˜¯é“¶å¼¹ï¼Œå®ƒè§£å†³äº†ä¸€äº›é—®é¢˜ï¼Œä¹Ÿå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜
> 
> Hibernateåœ¨å¾®æœåŠ¡ä¸­ä»ç„¶æœ‰ä»·å€¼ï¼Œä½†éœ€è¦é…åˆæ­£ç¡®çš„è®¾è®¡æ¨¡å¼
> 
> æŠ€æœ¯é€‰å‹è¦åŸºäºå®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œä¸è¦ä¸ºäº†å¾®æœåŠ¡è€Œå¾®æœåŠ¡
> 
> è®°ä½ï¼š**ç®€å•ç³»ç»Ÿç”¨å•ä½“ï¼Œå¤æ‚ç³»ç»Ÿç”¨å¾®æœåŠ¡ï¼Œæ ¸å¿ƒæ˜¯è§£å†³ä¸šåŠ¡é—®é¢˜**

---

**ğŸ“š æ‰©å±•é˜…è¯»**

- ã€Šå¾®æœåŠ¡æ¶æ„è®¾è®¡æ¨¡å¼ã€‹ - Chris Richardson
- ã€Šåˆ†å¸ƒå¼ç³»ç»ŸåŸç†ä¸èŒƒå‹ã€‹ - Andrew S. Tanenbaum  
- Spring Cloudå®˜æ–¹æ–‡æ¡£
- Hibernateå®˜æ–¹æœ€ä½³å®è·µ
- Martin Fowlerçš„å¾®æœåŠ¡æ–‡ç« ç³»åˆ—

