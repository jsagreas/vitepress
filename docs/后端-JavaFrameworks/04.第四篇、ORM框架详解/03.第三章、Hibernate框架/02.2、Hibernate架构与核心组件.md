---
title: 2ã€Hibernateæ¶æ„ä¸æ ¸å¿ƒç»„ä»¶
---
## ğŸ“š ç›®å½•

1. [Hibernateæ˜¯ä»€ä¹ˆ](#1-Hibernateæ˜¯ä»€ä¹ˆ)
2. [Hibernateæ¶æ„æ€»è§ˆ](#2-Hibernateæ¶æ„æ€»è§ˆ)
3. [Configurationé…ç½®ç®¡ç†å™¨](#3-Configurationé…ç½®ç®¡ç†å™¨)
4. [SessionFactoryä¼šè¯å·¥å‚](#4-SessionFactoryä¼šè¯å·¥å‚)
5. [Sessionä¼šè¯å¯¹è±¡](#5-Sessionä¼šè¯å¯¹è±¡)
6. [Transactionäº‹åŠ¡ç®¡ç†](#6-Transactionäº‹åŠ¡ç®¡ç†)
7. [QueryæŸ¥è¯¢æ¥å£](#7-QueryæŸ¥è¯¢æ¥å£)
8. [Hibernateå·¥ä½œæµç¨‹](#8-Hibernateå·¥ä½œæµç¨‹)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Hibernateæ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£


æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¦å»è¶…å¸‚ä¹°ä¸œè¥¿ï¼š
- **ä¼ ç»ŸJDBCæ–¹å¼**ï¼šå°±åƒä½ è¦è‡ªå·±å¼€è½¦å»è¶…å¸‚ï¼Œæ‰¾åœè½¦ä½ï¼Œè®°ä½æ¯ä¸ªå•†å“åœ¨å“ªä¸ªè´§æ¶ï¼Œè‡ªå·±æ‹¿è´­ç‰©è¢‹è£…ä¸œè¥¿
- **Hibernateæ–¹å¼**ï¼šå°±åƒç”¨å¤–å–APPï¼Œä½ åªéœ€è¦è¯´è¦ä»€ä¹ˆï¼Œç³»ç»Ÿè‡ªåŠ¨å¸®ä½ æå®šä¸€åˆ‡

```
ä¼ ç»ŸJDBCå¼€å‘ç—›ç‚¹ï¼š

ç¨‹åºå‘˜ï¼šæˆ‘è¦ä¿å­˜ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯
        â†“
éœ€è¦åšçš„äº‹ï¼š
1. å†™SQLè¯­å¥ï¼šINSERT INTO user (name, age) VALUES (?, ?)
2. åˆ›å»ºè¿æ¥ï¼šConnection conn = ...
3. å‡†å¤‡è¯­å¥ï¼šPreparedStatement ps = ...
4. è®¾ç½®å‚æ•°ï¼šps.setString(1, "å¼ ä¸‰")...
5. æ‰§è¡ŒSQLï¼šps.executeUpdate()
6. å…³é—­èµ„æºï¼šps.close(), conn.close()
7. å¤„ç†å¼‚å¸¸ï¼štry-catchå„ç§æƒ…å†µ

å¤ªï¼éº»ï¼çƒ¦ï¼äº†ï¼
```

**Hibernateåšçš„äº‹**ï¼šæŠŠJavaå¯¹è±¡å’Œæ•°æ®åº“è¡¨è‡ªåŠ¨å…³è”èµ·æ¥

```java
// ä½¿ç”¨Hibernateï¼Œä¿å­˜ç”¨æˆ·åªéœ€è¦ï¼š
User user = new User("å¼ ä¸‰", 25);  // åˆ›å»ºå¯¹è±¡
session.save(user);                // ä¿å­˜ï¼å®Œäº‹ï¼

// Hibernateè‡ªåŠ¨å¸®ä½ ï¼š
// âœ… ç”ŸæˆSQLè¯­å¥
// âœ… ç®¡ç†æ•°æ®åº“è¿æ¥
// âœ… è®¾ç½®å‚æ•°
// âœ… æ‰§è¡ŒSQL
// âœ… å¤„ç†ç»“æœ
```

### 1.2 æ ¸å¿ƒæ¦‚å¿µ


**ORM - å¯¹è±¡å…³ç³»æ˜ å°„**
```
Javaä¸–ç•Œ                    æ•°æ®åº“ä¸–ç•Œ
   
Userç±»                  â†’   userè¡¨
â”œâ”€ id (æ•´æ•°)            â†’   â”œâ”€ id (INT)
â”œâ”€ name (å­—ç¬¦ä¸²)        â†’   â”œâ”€ name (VARCHAR)
â””â”€ age (æ•´æ•°)           â†’   â””â”€ age (INT)

ä¸€ä¸ªå¯¹è±¡  â†â†’  ä¸€æ¡è®°å½•
å¯¹è±¡å±æ€§  â†â†’  è¡¨å­—æ®µ
```

> **[æ ¸å¿ƒç†è§£]** ORMå°±æ˜¯ä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼ŒæŠŠJavaçš„å¯¹è±¡è¯­è¨€ç¿»è¯‘æˆæ•°æ®åº“çš„SQLè¯­è¨€

---

## 2. ğŸ—ï¸ Hibernateæ¶æ„æ€»è§ˆ


### 2.1 æ•´ä½“æ¶æ„å›¾


```
åº”ç”¨å±‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ä½ çš„Javaä»£ç ï¼ˆè°ƒç”¨Hibernate APIï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    â†“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Hibernateæ ¸å¿ƒå±‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Configuration  â†’  è¯»å–é…ç½®æ–‡ä»¶
         â†“
   SessionFactory â†’  åˆ›å»ºSessionçš„å·¥å‚
         â†“
      Session     â†’  æ“ä½œæ•°æ®åº“çš„ä¸»åŠ›
         â†“
   Transaction    â†’  ç®¡ç†äº‹åŠ¡
         â†“
      Query       â†’  æ‰§è¡ŒæŸ¥è¯¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    â†“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ•°æ®åº“å±‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         MySQL/Oracle/PostgreSQLç­‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### 2.2 æ ¸å¿ƒç»„ä»¶å…³ç³»


| ç»„ä»¶ | ä½œç”¨ | æ¯”å–» | æ•°é‡ |
|------|------|------|------|
| **Configuration** | è¯»å–é…ç½®æ–‡ä»¶ | `ğŸ“‹ è¯´æ˜ä¹¦` | å¯åŠ¨æ—¶åˆ›å»ºä¸€æ¬¡ |
| **SessionFactory** | åˆ›å»ºSession | `ğŸ­ ç”Ÿäº§è½¦é—´` | æ•´ä¸ªåº”ç”¨ä¸€ä¸ª |
| **Session** | æ“ä½œæ•°æ®åº“ | `ğŸ”§ æ“ä½œå·¥å…·` | æ¯æ¬¡æ“ä½œåˆ›å»º |
| **Transaction** | ç®¡ç†äº‹åŠ¡ | `ğŸ“¦ æ‰“åŒ…å‘è´§` | è·ŸéšSession |
| **Query** | æ‰§è¡ŒæŸ¥è¯¢ | `ğŸ” æœç´¢å¼•æ“` | éœ€è¦æ—¶åˆ›å»º |

### 2.3 ç»„ä»¶åä½œæµç¨‹


```
å¯åŠ¨é˜¶æ®µï¼š
Configurationé…ç½® â†’ è¯»å–hibernate.cfg.xml
         â†“
   åˆ›å»ºSessionFactoryï¼ˆé‡é‡çº§ï¼Œåªåˆ›å»ºä¸€æ¬¡ï¼‰

è¿è¡Œé˜¶æ®µï¼ˆæ¯æ¬¡æ“ä½œæ•°æ®åº“ï¼‰ï¼š
SessionFactory â†’ åˆ›å»ºSession
         â†“
      Session â†’ å¼€å¯Transaction
         â†“
æ‰§è¡Œæ“ä½œï¼ˆsave/update/delete/queryï¼‰
         â†“
   Transaction â†’ æäº¤æˆ–å›æ»š
         â†“
      Session â†’ å…³é—­é‡Šæ”¾èµ„æº
```

---

## 3. âš™ï¸ Configurationé…ç½®ç®¡ç†å™¨


### 3.1 Configurationæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šConfigurationå°±åƒè£…ä¿®æˆ¿å­å‰çš„è®¾è®¡å›¾çº¸ï¼Œå‘Šè¯‰Hibernateï¼š
- æ•°æ®åº“åœ¨å“ªé‡Œï¼ˆåœ°å€ï¼‰
- ç”¨ä»€ä¹ˆè´¦å·å¯†ç ï¼ˆé’¥åŒ™ï¼‰
- æœ‰å“ªäº›è¡¨å’Œå¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼ˆè£…ä¿®æ–¹æ¡ˆï¼‰

### 3.2 é…ç½®æ–‡ä»¶å†…å®¹


```xml
<!-- hibernate.cfg.xml é…ç½®æ–‡ä»¶ç¤ºä¾‹ -->
<hibernate-configuration>
    <session-factory>
        <!-- æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆå‘Šè¯‰Hibernateå»å“ªæ‰¾æ•°æ®åº“ï¼‰ -->
        <property name="hibernate.connection.driver_class">
            com.mysql.jdbc.Driver
        </property>
        <property name="hibernate.connection.url">
            jdbc:mysql://localhost:3306/mydb
        </property>
        <property name="hibernate.connection.username">root</property>
        <property name="hibernate.connection.password">123456</property>
        
        <!-- æ–¹è¨€ï¼ˆå‘Šè¯‰Hibernateç”¨ä»€ä¹ˆSQLè¯­æ³•ï¼‰ -->
        <property name="hibernate.dialect">
            org.hibernate.dialect.MySQL5Dialect
        </property>
        
        <!-- æ˜¾ç¤ºSQLï¼ˆå¼€å‘æ—¶çœ‹åˆ°æ‰§è¡Œçš„SQLè¯­å¥ï¼‰ -->
        <property name="hibernate.show_sql">true</property>
        
        <!-- æ˜ å°„æ–‡ä»¶ï¼ˆå“ªäº›ç±»å¯¹åº”å“ªäº›è¡¨ï¼‰ -->
        <mapping resource="User.hbm.xml"/>
    </session-factory>
</hibernate-configuration>
```

**é…ç½®é¡¹è§£é‡Š**ï¼š
- `driver_class` - æ•°æ®åº“é©±åŠ¨ï¼Œå°±åƒé€‰æ‹©äº¤é€šå·¥å…·ï¼ˆæ±½è½¦/ç«è½¦ï¼‰
- `connection.url` - æ•°æ®åº“åœ°å€ï¼Œå°±åƒé—¨ç‰Œå·
- `dialect` - æ–¹è¨€ï¼Œä¸åŒæ•°æ®åº“çš„SQLæœ‰å·®å¼‚ï¼Œå°±åƒæ™®é€šè¯å’Œç²¤è¯­

### 3.3 ä½¿ç”¨æ–¹å¼


```java
// åˆ›å»ºConfigurationå¯¹è±¡ï¼ˆè¯»å–é…ç½®ï¼‰
Configuration config = new Configuration();

// åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤æ‰¾hibernate.cfg.xmlï¼‰
config.configure();

// å¯ä»¥æ‰‹åŠ¨æ·»åŠ æ˜ å°„ï¼ˆå¦‚æœé…ç½®æ–‡ä»¶æ²¡å†™ï¼‰
config.addResource("User.hbm.xml");
```

> âš ï¸ **æ³¨æ„**ï¼šConfigurationåªåœ¨ç¨‹åºå¯åŠ¨æ—¶ç”¨ä¸€æ¬¡ï¼Œè¯»å®Œé…ç½®å°±å¯ä»¥æ‰”æ‰äº†

---

## 4. ğŸ­ SessionFactoryä¼šè¯å·¥å‚


### 4.1 SessionFactoryæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šSessionFactoryå°±åƒä¸€ä¸ª"é€ Sessionçš„å·¥å‚"
- å·¥å‚å¾ˆé‡ï¼ˆå å†…å­˜å¤§ï¼‰ï¼Œå»ºä¸€æ¬¡ç”¨ä¸€è¾ˆå­
- å·¥å‚èƒ½ç”Ÿäº§å¾ˆå¤šSessionï¼ˆå°å·¥å…·ï¼‰ï¼Œç”¨å®Œå°±æ‰”

```
SessionFactoryï¼ˆå·¥å‚ï¼‰
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â†“         â†“
Session1   Session2  Session3...ï¼ˆäº§å“ï¼‰
```

### 4.2 ä¸ºä»€ä¹ˆSessionFactoryé‡è¦


**SessionFactoryç‰¹ç‚¹**ï¼š
- â­â­â­ **é‡é‡çº§å¯¹è±¡** - åˆ›å»ºæ…¢ï¼Œå å†…å­˜å¤š
- â­â­â­ **çº¿ç¨‹å®‰å…¨** - å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±ç”¨
- â­â­â­ **å…¨å±€å”¯ä¸€** - æ•´ä¸ªåº”ç”¨åªåˆ›å»ºä¸€ä¸ª

```
âŒ é”™è¯¯åšæ³•ï¼ˆæ¯æ¬¡éƒ½åˆ›å»ºï¼‰ï¼š
void saveUser() {
    SessionFactory factory = config.buildSessionFactory(); // å¤ªæ…¢ï¼
    Session session = factory.openSession();
    // ...
}

âœ… æ­£ç¡®åšæ³•ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ï¼š
class HibernateUtil {
    private static SessionFactory factory;
    
    static {
        Configuration config = new Configuration().configure();
        factory = config.buildSessionFactory(); // åªåˆ›å»ºä¸€æ¬¡
    }
    
    public static SessionFactory getFactory() {
        return factory;
    }
}
```

### 4.3 SessionFactoryçš„èŒè´£


| èŒè´£ | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| **åˆ›å»ºSession** | ç”Ÿäº§æ“ä½œæ•°æ®åº“çš„å·¥å…· | â­â­â­ |
| **ç¼“å­˜å…ƒæ•°æ®** | ä¿å­˜æ˜ å°„ä¿¡æ¯ï¼Œä¸ç”¨é‡å¤è¯»é…ç½® | â­â­â­ |
| **ç®¡ç†äºŒçº§ç¼“å­˜** | åº”ç”¨çº§åˆ«çš„æ•°æ®ç¼“å­˜ | â­â­ |
| **ç”ŸæˆSQL** | æ ¹æ®æ–¹è¨€ç”Ÿæˆå¯¹åº”æ•°æ®åº“çš„SQL | â­â­â­ |

### 4.4 ä½¿ç”¨ç¤ºä¾‹


```java
// åˆ›å»ºSessionFactoryï¼ˆç¨‹åºå¯åŠ¨æ—¶ï¼‰
SessionFactory factory = new Configuration()
    .configure()
    .buildSessionFactory();

// ä½¿ç”¨SessionFactoryåˆ›å»ºSessionï¼ˆæ¯æ¬¡æ“ä½œæ—¶ï¼‰
Session session1 = factory.openSession();  // ç¬¬ä¸€æ¬¡æ“ä½œ
Session session2 = factory.openSession();  // ç¬¬äºŒæ¬¡æ“ä½œ

// Sessionç”¨å®Œè¦å…³é—­
session1.close();
session2.close();

// ç¨‹åºç»“æŸæ—¶å…³é—­å·¥å‚
factory.close();
```

---

## 5. ğŸ”§ Sessionä¼šè¯å¯¹è±¡


### 5.1 Sessionæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šSessionå°±åƒä½ çš„"æ•°æ®åº“æ“ä½œé¥æ§å™¨"
- æƒ³ä¿å­˜æ•°æ®ï¼ŸæŒ‰saveé”®
- æƒ³æŸ¥è¯¢æ•°æ®ï¼ŸæŒ‰geté”®
- æƒ³åˆ é™¤æ•°æ®ï¼ŸæŒ‰deleteé”®

```
ä½  â†’ Sessioné¥æ§å™¨ â†’ æ•°æ®åº“
     [save]          æ–°å¢
     [update]        ä¿®æ”¹
     [delete]        åˆ é™¤
     [get/load]      æŸ¥è¯¢
```

### 5.2 Sessionçš„æ ¸å¿ƒæ–¹æ³•


**å¢åˆ æ”¹æŸ¥æ“ä½œ**ï¼š

```java
Session session = factory.openSession();

// 1. ä¿å­˜ï¼ˆæ–°å¢ï¼‰
User user = new User("å¼ ä¸‰", 25);
session.save(user);  // ç›¸å½“äºï¼šINSERT INTO user...

// 2. æŸ¥è¯¢
User user = session.get(User.class, 1);  // æ ¹æ®IDæŸ¥
// ç›¸å½“äºï¼šSELECT * FROM user WHERE id = 1

// 3. æ›´æ–°
user.setAge(26);
session.update(user);  // ç›¸å½“äºï¼šUPDATE user SET age=26...

// 4. åˆ é™¤
session.delete(user);  // ç›¸å½“äºï¼šDELETE FROM user WHERE id=1
```

**æ–¹æ³•å¯¹æ¯”**ï¼š

| æ–¹æ³• | ä½œç”¨ | SQLç­‰ä»· | è¿”å›å€¼ |
|------|------|---------|--------|
| `save()` | ä¿å­˜æ–°å¯¹è±¡ | `INSERT` | ç”Ÿæˆçš„ID |
| `get()` | ç«‹å³æŸ¥è¯¢ | `SELECT` | å¯¹è±¡ï¼ˆæˆ–nullï¼‰ |
| `load()` | å»¶è¿ŸæŸ¥è¯¢ | `SELECT` | ä»£ç†å¯¹è±¡ |
| `update()` | æ›´æ–°å¯¹è±¡ | `UPDATE` | æ—  |
| `delete()` | åˆ é™¤å¯¹è±¡ | `DELETE` | æ—  |

### 5.3 Sessionçš„ç”Ÿå‘½å‘¨æœŸ


```
åˆ›å»ºSession
    â†“
å¼€å¯äº‹åŠ¡
    â†“
æ‰§è¡Œæ“ä½œï¼ˆsave/update...ï¼‰
    â†“
æäº¤äº‹åŠ¡
    â†“
å…³é—­Session
```

**è§„èŒƒå†™æ³•**ï¼š
```java
Session session = null;
Transaction tx = null;

try {
    // 1. è·å–Session
    session = factory.openSession();
    
    // 2. å¼€å¯äº‹åŠ¡
    tx = session.beginTransaction();
    
    // 3. ä¸šåŠ¡æ“ä½œ
    session.save(user);
    
    // 4. æäº¤äº‹åŠ¡
    tx.commit();
    
} catch (Exception e) {
    // 5. å‡ºé”™å›æ»š
    if (tx != null) tx.rollback();
    e.printStackTrace();
    
} finally {
    // 6. å…³é—­Session
    if (session != null) session.close();
}
```

### 5.4 Sessionçš„ç‰¹ç‚¹


âš ï¸ **é‡è¦ç‰¹æ€§**ï¼š
- **è½»é‡çº§** - åˆ›å»ºå¿«ï¼Œç”¨å®Œå°±æ‰”
- **éçº¿ç¨‹å®‰å…¨** - ä¸èƒ½å¤šçº¿ç¨‹å…±ç”¨ä¸€ä¸ªSession
- **ä¸€çº§ç¼“å­˜** - Sessionå†…éƒ¨æœ‰ç¼“å­˜ï¼ŒåŒä¸€ä¸ªå¯¹è±¡åªæŸ¥ä¸€æ¬¡æ•°æ®åº“

```java
// ä¸€çº§ç¼“å­˜æ¼”ç¤º
Session session = factory.openSession();

User user1 = session.get(User.class, 1);  // æŸ¥æ•°æ®åº“
User user2 = session.get(User.class, 1);  // ä¸æŸ¥ï¼ä»ç¼“å­˜æ‹¿

System.out.println(user1 == user2);  // trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡
```

---

## 6. ğŸ“¦ Transactionäº‹åŠ¡ç®¡ç†


### 6.1 Transactionæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šTransactionå°±åƒç½‘è´­çš„"æ‰“åŒ…å‘è´§"
- ä¹°å¤šä»¶å•†å“è¦ä¸€èµ·æ‰“åŒ…ï¼ˆå¤šä¸ªæ“ä½œè¦ä¸€èµ·æ‰§è¡Œï¼‰
- è¦ä¹ˆå…¨éƒ¨å‘å‡ºï¼Œè¦ä¹ˆå…¨éƒ¨é€€å›ï¼ˆè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ï¼‰

```
æ²¡æœ‰äº‹åŠ¡çš„é—®é¢˜ï¼š
è½¬è´¦æ“ä½œï¼š
1. å¼ ä¸‰è´¦æˆ· -100å…ƒ âœ…ï¼ˆæˆåŠŸï¼‰
2. ç¨‹åºå´©æºƒäº†ï¼ğŸ’¥
3. æå››è´¦æˆ· +100å…ƒ âŒï¼ˆæ²¡æ‰§è¡Œï¼‰
ç»“æœï¼šå¼ ä¸‰çš„é’±ä¸¢äº†ï¼

æœ‰äº‹åŠ¡çš„ä¿æŠ¤ï¼š
1. å¼€å¯äº‹åŠ¡
2. å¼ ä¸‰è´¦æˆ· -100å…ƒ
3. æå››è´¦æˆ· +100å…ƒ
4. æäº¤äº‹åŠ¡ï¼ˆä¸¤æ­¥éƒ½æˆåŠŸï¼‰
   æˆ–è€…å›æ»šï¼ˆå‘ç°é—®é¢˜ï¼Œä¸¤æ­¥éƒ½æ’¤é”€ï¼‰
```

### 6.2 äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰


| ç‰¹æ€§ | è‹±æ–‡ | é€šä¿—è§£é‡Š | ä¸¾ä¾‹ |
|------|------|----------|------|
| **åŸå­æ€§** | Atomicity | è¦ä¹ˆéƒ½åšï¼Œè¦ä¹ˆéƒ½ä¸åš | `è½¬è´¦ä¸¤æ­¥å¿…é¡»éƒ½æˆåŠŸ` |
| **ä¸€è‡´æ€§** | Consistency | æ•°æ®å‰åä¿æŒä¸€è‡´ | `è½¬è´¦å‰åæ€»é‡‘é¢ä¸å˜` |
| **éš”ç¦»æ€§** | Isolation | äº’ä¸å¹²æ‰° | `ä½ è½¬è´¦ä¸å½±å“æˆ‘è½¬è´¦` |
| **æŒä¹…æ€§** | Durability | æäº¤åæ°¸ä¹…ä¿å­˜ | `æ–­ç”µä¹Ÿä¸ä¼šä¸¢æ•°æ®` |

### 6.3 Transactionä½¿ç”¨æ–¹å¼


```java
Session session = factory.openSession();

// å¼€å¯äº‹åŠ¡
Transaction tx = session.beginTransaction();

try {
    // æ‰§è¡Œå¤šä¸ªæ“ä½œ
    session.save(user1);
    session.save(user2);
    session.update(user3);
    
    // å…¨éƒ¨æˆåŠŸï¼Œæäº¤
    tx.commit();
    
} catch (Exception e) {
    // å‡ºé”™äº†ï¼Œå›æ»š
    tx.rollback();
    throw e;
    
} finally {
    session.close();
}
```

**å¸¸ç”¨æ–¹æ³•**ï¼š
- `beginTransaction()` - å¼€å¯äº‹åŠ¡
- `commit()` - æäº¤äº‹åŠ¡ï¼ˆç¡®è®¤æ‰€æœ‰æ“ä½œï¼‰
- `rollback()` - å›æ»šäº‹åŠ¡ï¼ˆæ’¤é”€æ‰€æœ‰æ“ä½œï¼‰

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šæ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½åº”è¯¥åœ¨äº‹åŠ¡ä¸­è¿›è¡Œ

---

## 7. ğŸ” QueryæŸ¥è¯¢æ¥å£


### 7.1 Queryæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šQueryå°±åƒ"æœç´¢å¼•æ“"ï¼Œå¸®ä½ ä»æ•°æ®åº“ä¸­æ‰¾ä¸œè¥¿
- ç®€å•æŸ¥è¯¢ï¼šæ‰¾ä¸€ä¸ªäºº
- å¤æ‚æŸ¥è¯¢ï¼šæ‰¾æ‰€æœ‰å¹´é¾„å¤§äº18å²çš„ç”·æ€§ç”¨æˆ·

### 7.2 HQLæŸ¥è¯¢è¯­è¨€


**HQL vs SQL**ï¼š
```
SQLï¼ˆæ“ä½œè¡¨ï¼‰ï¼š
SELECT * FROM user WHERE age > 18

HQLï¼ˆæ“ä½œå¯¹è±¡ï¼‰ï¼š
FROM User WHERE age > 18
```

**HQLç‰¹ç‚¹**ï¼š
- âœ… é¢å‘å¯¹è±¡ï¼ˆå†™ç±»åï¼Œä¸å†™è¡¨åï¼‰
- âœ… æ•°æ®åº“æ— å…³ï¼ˆè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”æ•°æ®åº“çš„SQLï¼‰
- âœ… æ”¯æŒç»§æ‰¿å’Œå¤šæ€

### 7.3 Queryå¸¸ç”¨æ“ä½œ


**åŸºç¡€æŸ¥è¯¢**ï¼š
```java
// 1. åˆ›å»ºQueryå¯¹è±¡
Query query = session.createQuery("FROM User");

// 2. æ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å–ç»“æœ
List<User> users = query.list();
```

**å¸¦æ¡ä»¶æŸ¥è¯¢**ï¼š
```java
// æ–¹å¼1ï¼šä½ç½®å‚æ•°
Query query = session.createQuery("FROM User WHERE age > ?");
query.setParameter(0, 18);  // ç¬¬0ä¸ªé—®å·çš„å€¼
List<User> users = query.list();

// æ–¹å¼2ï¼šå‘½åå‚æ•°ï¼ˆæ¨èï¼‰
Query query = session.createQuery("FROM User WHERE age > :age");
query.setParameter("age", 18);  // :ageçš„å€¼
List<User> users = query.list();
```

**åˆ†é¡µæŸ¥è¯¢**ï¼š
```java
Query query = session.createQuery("FROM User");
query.setFirstResult(0);    // ä»ç¬¬0æ¡å¼€å§‹
query.setMaxResults(10);    // å–10æ¡
List<User> users = query.list();  // åˆ†é¡µç»“æœ
```

### 7.4 Queryæ–¹æ³•å¯¹æ¯”


| æ–¹æ³• | ä½œç”¨ | è¿”å›å€¼ | ä½¿ç”¨åœºæ™¯ |
|------|------|--------|----------|
| `list()` | è¿”å›æ‰€æœ‰ç»“æœ | `List<T>` | æŸ¥è¯¢å¤šæ¡è®°å½• |
| `uniqueResult()` | è¿”å›å•ä¸ªç»“æœ | `Object` | æŸ¥è¯¢ä¸€æ¡è®°å½• |
| `executeUpdate()` | æ‰¹é‡æ›´æ–°/åˆ é™¤ | `int` | æ›´æ–°æˆ–åˆ é™¤æ“ä½œ |

```java
// æŸ¥è¯¢å¤šæ¡
List<User> users = query.list();

// æŸ¥è¯¢ä¸€æ¡
User user = (User) query.uniqueResult();

// æ‰¹é‡æ›´æ–°
Query query = session.createQuery("UPDATE User SET age = 18");
int count = query.executeUpdate();  // è¿”å›å½±å“çš„è¡Œæ•°
```

---

## 8. ğŸ”„ Hibernateå·¥ä½œæµç¨‹


### 8.1 å®Œæ•´æ‰§è¡Œæµç¨‹


```
ç¨‹åºå¯åŠ¨é˜¶æ®µï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. åŠ è½½é…ç½®æ–‡ä»¶
   Configuration config = new Configuration().configure();
   
2. åˆ›å»ºSessionFactory
   SessionFactory factory = config.buildSessionFactory();
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æ¯æ¬¡æ“ä½œæ•°æ®åº“ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3. è·å–Session
   Session session = factory.openSession();
   
4. å¼€å¯äº‹åŠ¡
   Transaction tx = session.beginTransaction();
   
5. æ‰§è¡Œæ“ä½œ
   session.save(user);
   
6. æäº¤äº‹åŠ¡
   tx.commit();
   
7. å…³é—­Session
   session.close();
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### 8.2 å·¥ä½œåŸç†å›¾ç¤º


```
ä½ çš„ä»£ç 
    â†“
è°ƒç”¨ session.save(user)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Hibernateå¤„ç†æµç¨‹     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ£€æŸ¥å¯¹è±¡çŠ¶æ€         â”‚
â”‚ 2. ç”ŸæˆSQLè¯­å¥          â”‚
â”‚ 3. å¡«å……å‚æ•°             â”‚
â”‚ 4. æ‰§è¡ŒJDBCæ“ä½œ         â”‚
â”‚ 5. å¤„ç†è¿”å›ç»“æœ         â”‚
â”‚ 6. æ›´æ–°ç¼“å­˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ•°æ®åº“æ‰§è¡ŒSQL
    â†“
è¿”å›ç»“æœ
```

### 8.3 å®é™…å¼€å‘æµç¨‹ç¤ºä¾‹


**ä¿å­˜ç”¨æˆ·çš„å®Œæ•´æµç¨‹**ï¼š

```java
// å·¥å…·ç±»ï¼ˆç¨‹åºå¯åŠ¨æ—¶åˆå§‹åŒ–ï¼‰
class HibernateUtil {
    private static SessionFactory factory;
    
    static {
        Configuration config = new Configuration().configure();
        factory = config.buildSessionFactory();
    }
    
    public static Session getSession() {
        return factory.openSession();
    }
}

// ä¸šåŠ¡ä»£ç ï¼ˆæ¯æ¬¡ä¿å­˜ç”¨æˆ·æ—¶ï¼‰
public void saveUser(User user) {
    Session session = null;
    Transaction tx = null;
    
    try {
        // è·å–Session
        session = HibernateUtil.getSession();
        
        // å¼€å¯äº‹åŠ¡
        tx = session.beginTransaction();
        
        // ä¿å­˜ç”¨æˆ·
        session.save(user);
        
        // æäº¤
        tx.commit();
        
    } catch (Exception e) {
        if (tx != null) tx.rollback();
        throw e;
        
    } finally {
        if (session != null) session.close();
    }
}
```

### 8.4 å†…éƒ¨å·¥ä½œç»†èŠ‚


**Session.save()å†…éƒ¨åšäº†ä»€ä¹ˆ**ï¼š

```
1. å¯¹è±¡çŠ¶æ€æ£€æŸ¥
   â”œâ”€ æ˜¯æ–°å¯¹è±¡å—ï¼Ÿï¼ˆæ²¡æœ‰IDï¼‰
   â””â”€ å·²ç»æŒä¹…åŒ–äº†å—ï¼Ÿ

2. ç”ŸæˆSQL
   â”œâ”€ æ ¹æ®æ˜ å°„æ–‡ä»¶æ‰¾åˆ°è¡¨å
   â”œâ”€ æ ¹æ®å±æ€§ç”Ÿæˆå­—æ®µ
   â””â”€ æ„é€ INSERTè¯­å¥

3. å‚æ•°è®¾ç½®
   â”œâ”€ è®¾ç½®æ¯ä¸ªå­—æ®µçš„å€¼
   â””â”€ å¤„ç†ç±»å‹è½¬æ¢

4. æ‰§è¡ŒSQL
   â”œâ”€ é€šè¿‡JDBCæ‰§è¡Œ
   â””â”€ è·å–ç”Ÿæˆçš„ID

5. æ›´æ–°å¯¹è±¡
   â””â”€ æŠŠç”Ÿæˆçš„IDè®¾ç½®å›å¯¹è±¡

6. æ”¾å…¥ç¼“å­˜
   â””â”€ å­˜å…¥Sessionä¸€çº§ç¼“å­˜
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 æ ¸å¿ƒç»„ä»¶è®°å¿†å£è¯€


```
ğŸ“‹ Configuration - é…ç½®è¯»ä¸€æ¬¡
ğŸ­ SessionFactory - å·¥å‚å»ºä¸€ä¸ª  
ğŸ”§ Session - ä¼šè¯ç”¨å®Œæ‰”
ğŸ“¦ Transaction - äº‹åŠ¡è¦æäº¤
ğŸ” Query - æŸ¥è¯¢å¾ˆçµæ´»
```

### 9.2 é‡è¦æ¦‚å¿µå¯¹æ¯”


| å¯¹æ¯”é¡¹ | Configuration | SessionFactory | Session |
|--------|---------------|----------------|---------|
| **åˆ›å»ºæ—¶æœº** | ç¨‹åºå¯åŠ¨æ—¶ | å¯åŠ¨æ—¶ | æ¯æ¬¡æ“ä½œæ—¶ |
| **åˆ›å»ºæ¬¡æ•°** | ä¸€æ¬¡ | ä¸€æ¬¡ | å¤šæ¬¡ |
| **æ˜¯å¦é‡é‡çº§** | è½»é‡ | â­â­â­é‡é‡çº§ | è½»é‡ |
| **çº¿ç¨‹å®‰å…¨** | å¦ | âœ…æ˜¯ | âŒå¦ |
| **ä¸»è¦ä½œç”¨** | è¯»é…ç½® | åˆ›å»ºSession | æ“ä½œæ•°æ®åº“ |

### 9.3 å¼€å‘ä¸­çš„æœ€ä½³å®è·µ


âœ… **æ¨èåšæ³•**ï¼š
- SessionFactoryä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€å”¯ä¸€
- Sessionç”¨å®Œç«‹å³å…³é—­ï¼Œä¸è¦é•¿æ—¶é—´æŒæœ‰
- æ‰€æœ‰æ“ä½œéƒ½åœ¨äº‹åŠ¡ä¸­è¿›è¡Œ
- ä½¿ç”¨å‘½åå‚æ•°ï¼Œä¸ç”¨ä½ç½®å‚æ•°
- å¼€å‘æ—¶å¼€å¯show_sqlæŸ¥çœ‹SQL

âŒ **é¿å…é”™è¯¯**ï¼š
- ä¸è¦æ¯æ¬¡éƒ½åˆ›å»ºSessionFactory
- ä¸è¦åœ¨å¤šçº¿ç¨‹é—´å…±äº«Session
- ä¸è¦å¿˜è®°æäº¤äº‹åŠ¡
- ä¸è¦å¿˜è®°å…³é—­Session
- ä¸è¦æŠŠSessionå­˜åˆ°é™æ€å˜é‡

### 9.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


**åŸºç¡€ç†è§£**ï¼š
- â˜‘ï¸ ç†è§£ORMçš„æ¦‚å¿µå’Œä½œç”¨
- â˜‘ï¸ çŸ¥é“Hibernateçš„äº”å¤§æ ¸å¿ƒç»„ä»¶
- â˜‘ï¸ ç†è§£SessionFactoryå’ŒSessionçš„åŒºåˆ«
- â˜‘ï¸ æŒæ¡äº‹åŠ¡çš„åŸºæœ¬ç”¨æ³•

**å®è·µèƒ½åŠ›**ï¼š
- â˜‘ï¸ èƒ½å¤Ÿé…ç½®hibernate.cfg.xml
- â˜‘ï¸ èƒ½å¤Ÿæ­£ç¡®åˆ›å»ºå’Œå…³é—­Session
- â˜‘ï¸ èƒ½å¤Ÿä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
- â˜‘ï¸ èƒ½å¤Ÿä½¿ç”¨HQLè¿›è¡ŒåŸºæœ¬æŸ¥è¯¢

**è¿›é˜¶ç†è§£**ï¼š
- â˜‘ï¸ ç†è§£Hibernateçš„å·¥ä½œæµç¨‹
- â˜‘ï¸ ç†è§£ä¸€çº§ç¼“å­˜çš„ä½œç”¨
- â˜‘ï¸ çŸ¥é“ä»€ä¹ˆæ—¶å€™ç”¨Hibernateåˆé€‚

---

**ğŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
1. å…ˆç†è§£æ¯ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œä¸è¦æ­»è®°ç¡¬èƒŒ
2. å¤šåŠ¨æ‰‹å†™ä»£ç ï¼Œä½“ä¼šSessionçš„ä½¿ç”¨
3. æ³¨æ„è§‚å¯ŸHibernateç”Ÿæˆçš„SQLè¯­å¥
4. ç†è§£äº‹åŠ¡çš„é‡è¦æ€§ï¼Œå…»æˆä½¿ç”¨äº‹åŠ¡çš„ä¹ æƒ¯