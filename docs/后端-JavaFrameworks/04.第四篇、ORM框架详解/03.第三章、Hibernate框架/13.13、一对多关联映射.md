---
title: 13ã€ä¸€å¯¹å¤šå…³è”æ˜ å°„
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ä¸€å¯¹å¤šå…³è”](#1-ä»€ä¹ˆæ˜¯ä¸€å¯¹å¤šå…³è”)
2. [æ ¸å¿ƒæ³¨è§£è¯¦è§£](#2-æ ¸å¿ƒæ³¨è§£è¯¦è§£)
3. [å•å‘ä¸€å¯¹å¤šæ˜ å°„](#3-å•å‘ä¸€å¯¹å¤šæ˜ å°„)
4. [åŒå‘ä¸€å¯¹å¤šæ˜ å°„](#4-åŒå‘ä¸€å¯¹å¤šæ˜ å°„)
5. [å¤–é”®ç»´æŠ¤ç­–ç•¥](#5-å¤–é”®ç»´æŠ¤ç­–ç•¥)
6. [çº§è”æ“ä½œè¯¦è§£](#6-çº§è”æ“ä½œè¯¦è§£)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— ä»€ä¹ˆæ˜¯ä¸€å¯¹å¤šå…³è”


### 1.1 ç”Ÿæ´»ä¸­çš„ä¸€å¯¹å¤šå…³ç³»


**ç°å®åœºæ™¯ç†è§£**ï¼š
```
ä¸€ä¸ªç­çº§ â† å¤šä¸ªå­¦ç”Ÿ
  Class      Students

ä¸€ä¸ªéƒ¨é—¨ â† å¤šä¸ªå‘˜å·¥  
Department  Employees

ä¸€ä¸ªç”¨æˆ· â† å¤šæ¡è®¢å•
   User      Orders
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒä¸€ä¸ªå¦ˆå¦ˆå¯ä»¥æœ‰å¤šä¸ªå­©å­ï¼Œä½†æ¯ä¸ªå­©å­åªæœ‰ä¸€ä¸ªäº²å¦ˆã€‚è¿™å°±æ˜¯å…¸å‹çš„ä¸€å¯¹å¤šå…³ç³»ã€‚

### 1.2 æ•°æ®åº“ä¸­çš„è¡¨ç°å½¢å¼


**è¡¨ç»“æ„å…³ç³»**ï¼š
```
éƒ¨é—¨è¡¨ (Department)               å‘˜å·¥è¡¨ (Employee)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id (ä¸»é”®)      â”‚               â”‚ id (ä¸»é”®)           â”‚
â”‚ name           â”‚               â”‚ name                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ dept_id (å¤–é”®) â”€â”€â”€â”€â”€â”¼â”€â†’ æŒ‡å‘éƒ¨é—¨è¡¨çš„id
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸€ä¸ªéƒ¨é—¨è®°å½• â†’ å¯¹åº”å¤šä¸ªå‘˜å·¥è®°å½•ï¼ˆé€šè¿‡dept_idå…³è”ï¼‰
```

**å…³é”®ç†è§£**ï¼š
- **"ä¸€"çš„ä¸€æ–¹**ï¼šä¸éœ€è¦é¢å¤–å­—æ®µï¼Œå°±æ˜¯æ™®é€šè¡¨
- **"å¤š"çš„ä¸€æ–¹**ï¼šéœ€è¦ä¸€ä¸ªå¤–é”®å­—æ®µï¼ŒæŒ‡å‘"ä¸€"çš„ä¸»é”®
- **å¤–é”®å­˜æ”¾**ï¼šå¤–é”®æ°¸è¿œåœ¨"å¤š"çš„ä¸€æ–¹

### 1.3 Javaå¯¹è±¡ä¸­çš„è¡¨ç°


**å¯¹è±¡å…³ç³»æ˜ å°„**ï¼š
```java
// "ä¸€"çš„ä¸€æ–¹ - éƒ¨é—¨
public class Department {
    private Long id;
    private String name;
    private List<Employee> employees;  // é›†åˆï¼šåŒ…å«å¤šä¸ªå‘˜å·¥
}

// "å¤š"çš„ä¸€æ–¹ - å‘˜å·¥  
public class Employee {
    private Long id;
    private String name;
    private Department department;  // å¯¹è±¡ï¼šå±äºä¸€ä¸ªéƒ¨é—¨
}
```

> âš ï¸ **æ–°æ‰‹æ³¨æ„**ï¼šJavaå¯¹è±¡é‡Œç”¨é›†åˆï¼ˆList/Setï¼‰è¡¨ç¤º"å¤š"ï¼Œç”¨å•ä¸ªå¯¹è±¡è¡¨ç¤º"ä¸€"

---

## 2. ğŸ“‹ æ ¸å¿ƒæ³¨è§£è¯¦è§£


### 2.1 @OneToMany æ³¨è§£


**ä½œç”¨**ï¼šæ ‡è®°"ä¸€å¯¹å¤š"å…³ç³»ä¸­"ä¸€"çš„ä¸€æ–¹

**åŸºæœ¬è¯­æ³•**ï¼š
```java
@OneToMany(
    mappedBy = "å…³è”å±æ€§å",     // æŒ‡å®šç”±å¯¹æ–¹ç»´æŠ¤å…³ç³»
    cascade = CascadeType.ALL,   // çº§è”æ“ä½œç±»å‹
    fetch = FetchType.LAZY       // åŠ è½½ç­–ç•¥
)
private List<Employee> employees;
```

**å±æ€§è¯¦è§£**ï¼š

| å±æ€§ | å«ä¹‰ | å¸¸ç”¨å€¼ | è¯´æ˜ |
|------|------|--------|------|
| **mappedBy** | `å…³ç³»ç»´æŠ¤æ–¹` | `"department"` | æŒ‡å®šå¯¹æ–¹å®ä½“ä¸­çš„å±æ€§åï¼Œè¡¨ç¤ºæ”¾å¼ƒç»´æŠ¤æƒ |
| **cascade** | `çº§è”æ“ä½œ` | `CascadeType.ALL` | å¯¹çˆ¶å¯¹è±¡çš„æ“ä½œæ˜¯å¦å½±å“å­å¯¹è±¡ |
| **fetch** | `åŠ è½½ç­–ç•¥` | `LAZY/EAGER` | æ‡’åŠ è½½è¿˜æ˜¯ç«‹å³åŠ è½½ |
| **orphanRemoval** | `å­¤å„¿åˆ é™¤` | `true/false` | æ˜¯å¦åˆ é™¤å¤±å»å…³è”çš„å­å¯¹è±¡ |

### 2.2 @ManyToOne æ³¨è§£


**ä½œç”¨**ï¼šæ ‡è®°"ä¸€å¯¹å¤š"å…³ç³»ä¸­"å¤š"çš„ä¸€æ–¹

**åŸºæœ¬è¯­æ³•**ï¼š
```java
@ManyToOne(
    fetch = FetchType.LAZY,          // åŠ è½½ç­–ç•¥
    cascade = CascadeType.PERSIST    // çº§è”æ“ä½œ
)
@JoinColumn(name = "dept_id")        // æŒ‡å®šå¤–é”®åˆ—å
private Department department;
```

**æ ¸å¿ƒç†è§£**ï¼š
- ğŸ”¸ è°æœ‰`@ManyToOne`ï¼Œè°å°±è´Ÿè´£ç»´æŠ¤å¤–é”®
- ğŸ”¸ é€šå¸¸`@ManyToOne`å’Œ`@JoinColumn`æ­é…ä½¿ç”¨
- ğŸ”¸ é»˜è®¤æ˜¯`EAGER`åŠ è½½ï¼ˆç«‹å³åŠ è½½ï¼‰

### 2.3 @JoinColumn æ³¨è§£


**ä½œç”¨**ï¼šæŒ‡å®šå¤–é”®åˆ—çš„è¯¦ç»†é…ç½®

**å®Œæ•´é…ç½®**ï¼š
```java
@JoinColumn(
    name = "dept_id",              // æ•°æ®åº“ä¸­å¤–é”®åˆ—å
    referencedColumnName = "id",   // å¼•ç”¨çš„ä¸»é”®åˆ—åï¼ˆé€šå¸¸çœç•¥ï¼‰
    nullable = false,              // æ˜¯å¦å…è®¸ä¸ºç©º
    unique = false                 // æ˜¯å¦å”¯ä¸€
)
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```java
@ManyToOne
@JoinColumn(name = "department_id", nullable = false)
private Department department;
```
> ğŸ’¡ è¿™æ®µä»£ç çš„æ„æ€ï¼šå‘˜å·¥è¡¨ä¼šæœ‰ä¸€ä¸ª`department_id`å­—æ®µï¼Œä¸èƒ½ä¸ºç©ºï¼Œå…³è”åˆ°éƒ¨é—¨è¡¨çš„ä¸»é”®

### 2.4 mappedBy å±æ€§è¯¦è§£


**æ ¸å¿ƒä½œç”¨**ï¼šå£°æ˜"æˆ‘ä¸ç»´æŠ¤å…³ç³»ï¼Œç”±å¯¹æ–¹ç»´æŠ¤"

**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

```
æ²¡æœ‰ mappedByï¼ˆåŒæ–¹éƒ½ç»´æŠ¤ï¼‰ï¼š
Departmentè¡¨ â† â†’ Employeeè¡¨
    â†“              â†“
 å…³ç³»è¡¨1        å…³ç³»è¡¨2
ã€ä¼šäº§ç”Ÿæ··ä¹±ï¼ã€‘

ä½¿ç”¨ mappedByï¼ˆå•æ–¹ç»´æŠ¤ï¼‰ï¼š
Departmentè¡¨ï¼ˆä¸ç»´æŠ¤ï¼‰ â† â†’ Employeeè¡¨ï¼ˆç»´æŠ¤å¤–é”®ï¼‰
                            â†“
                        dept_idå­—æ®µ
ã€æ¸…æ™°æ˜äº†ï¼ã€‘
```

**æ­£ç¡®ç”¨æ³•**ï¼š
```java
// éƒ¨é—¨ç±»ï¼ˆ"ä¸€"çš„ä¸€æ–¹ï¼‰
@OneToMany(mappedBy = "department")  // ç”±Employeeçš„departmentå±æ€§ç»´æŠ¤
private List<Employee> employees;

// å‘˜å·¥ç±»ï¼ˆ"å¤š"çš„ä¸€æ–¹ï¼‰  
@ManyToOne
@JoinColumn(name = "dept_id")
private Department department;  // è¿™ä¸ªå±æ€§åè¦å’ŒmappedByçš„å€¼ä¸€è‡´
```

> âš ï¸ **é‡è¦**ï¼š`mappedBy`çš„å€¼å¿…é¡»æ˜¯å¯¹æ–¹å®ä½“ç±»ä¸­å…³è”å±æ€§çš„åå­—ï¼Œä¸æ˜¯æ•°æ®åº“å­—æ®µåï¼

---

## 3. ğŸ¯ å•å‘ä¸€å¯¹å¤šæ˜ å°„


### 3.1 ä»€ä¹ˆæ˜¯å•å‘å…³è”


**æ¦‚å¿µç†è§£**ï¼š
- **å•å‘**ï¼šåªæœ‰ä¸€æ–¹çŸ¥é“å…³ç³»çš„å­˜åœ¨
- **ç‰¹ç‚¹**ï¼šåªèƒ½ä»"ä¸€"çš„ä¸€æ–¹æŸ¥åˆ°"å¤š"ï¼Œåè¿‡æ¥æŸ¥ä¸åˆ°

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
å•å‘å…³ç³»ï¼šè€å¸ˆçŸ¥é“è‡ªå·±æœ‰å“ªäº›å­¦ç”Ÿï¼Œä½†å­¦ç”Ÿä¸çŸ¥é“è‡ªå·±çš„è€å¸ˆæ˜¯è°
åŒå‘å…³ç³»ï¼šè€å¸ˆçŸ¥é“è‡ªå·±çš„å­¦ç”Ÿï¼Œå­¦ç”Ÿä¹ŸçŸ¥é“è‡ªå·±çš„è€å¸ˆ
```

### 3.2 å•å‘ä¸€å¯¹å¤šå®ç°


**å®ä½“ç±»ä»£ç **ï¼š

```java
// éƒ¨é—¨ç±» - "ä¸€"çš„ä¸€æ–¹
@Entity
@Table(name = "department")
public class Department {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // ä¸€å¯¹å¤šå…³è”ï¼šä¸€ä¸ªéƒ¨é—¨æœ‰å¤šä¸ªå‘˜å·¥
    @OneToMany(cascade = CascadeType.ALL)
    @JoinColumn(name = "dept_id")  // æŒ‡å®šå¤–é”®åˆ—
    private List<Employee> employees = new ArrayList<>();
    
    // getter/setter...
}

// å‘˜å·¥ç±» - "å¤š"çš„ä¸€æ–¹
@Entity
@Table(name = "employee")
public class Employee {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // æ²¡æœ‰æŒ‡å‘Departmentçš„å±æ€§ - è¿™å°±æ˜¯"å•å‘"
    
    // getter/setter...
}
```

### 3.3 ç”Ÿæˆçš„è¡¨ç»“æ„


```sql
-- éƒ¨é—¨è¡¨
CREATE TABLE department (
    id BIGINT PRIMARY KEY,
    name VARCHAR(100)
);

-- å‘˜å·¥è¡¨
CREATE TABLE employee (
    id BIGINT PRIMARY KEY,
    name VARCHAR(100),
    dept_id BIGINT,  -- å¤–é”®ï¼šç”±@JoinColumnæŒ‡å®š
    FOREIGN KEY (dept_id) REFERENCES department(id)
);
```

### 3.4 ä½¿ç”¨ç¤ºä¾‹


```java
// åˆ›å»ºéƒ¨é—¨å’Œå‘˜å·¥
Department dept = new Department();
dept.setName("ç ”å‘éƒ¨");

Employee emp1 = new Employee();
emp1.setName("å¼ ä¸‰");

Employee emp2 = new Employee();
emp2.setName("æå››");

// å»ºç«‹å…³è”
dept.getEmployees().add(emp1);
dept.getEmployees().add(emp2);

// ä¿å­˜ï¼ˆä¼šçº§è”ä¿å­˜å‘˜å·¥ï¼‰
session.save(dept);

// âœ… å¯ä»¥è¿™æ ·æŸ¥ï¼šä»éƒ¨é—¨æŸ¥å‘˜å·¥
Department d = session.get(Department.class, 1L);
List<Employee> emps = d.getEmployees();  // èƒ½æŸ¥åˆ°

// âŒ ä¸èƒ½è¿™æ ·æŸ¥ï¼šä»å‘˜å·¥æŸ¥éƒ¨é—¨
Employee e = session.get(Employee.class, 1L);
// e.getDepartment();  // æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼å•å‘å…³ç³»
```

### 3.5 å•å‘ä¸€å¯¹å¤šçš„é—®é¢˜


> âš ï¸ **æ€§èƒ½é—®é¢˜**ï¼šHibernateä¼šæ‰§è¡Œå¤šæ¡UPDATEè¯­å¥

**æ‰§è¡Œè¿‡ç¨‹åˆ†æ**ï¼š
```sql
-- 1. ä¿å­˜éƒ¨é—¨
INSERT INTO department (name) VALUES ('ç ”å‘éƒ¨');

-- 2. ä¿å­˜å‘˜å·¥ï¼ˆå¤–é”®ä¸ºç©ºï¼‰
INSERT INTO employee (name, dept_id) VALUES ('å¼ ä¸‰', NULL);
INSERT INTO employee (name, dept_id) VALUES ('æå››', NULL);

-- 3. æ›´æ–°å¤–é”®ï¼ˆé¢å¤–æ“ä½œï¼ï¼‰
UPDATE employee SET dept_id = 1 WHERE id = 1;
UPDATE employee SET dept_id = 1 WHERE id = 2;
```

**ä¸ºä»€ä¹ˆä¼šè¿™æ ·**ï¼š
- å› ä¸ºEmployeeç±»æ²¡æœ‰departmentå±æ€§
- Hibernateä¸èƒ½åœ¨æ’å…¥æ—¶å°±è®¾ç½®å¤–é”®
- åªèƒ½å…ˆæ’å…¥ï¼Œå†é¢å¤–æ›´æ–°

> ğŸ’¡ **å»ºè®®**ï¼šå®é™…å¼€å‘ä¸­å¾ˆå°‘ç”¨å•å‘ä¸€å¯¹å¤šï¼Œæ¨èç”¨åŒå‘å…³è”

---

## 4. ğŸ”„ åŒå‘ä¸€å¯¹å¤šæ˜ å°„


### 4.1 ä»€ä¹ˆæ˜¯åŒå‘å…³è”


**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… ä¸¤è¾¹éƒ½çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨
- âœ… å¯ä»¥ä»ä»»æ„ä¸€æ–¹æŸ¥åˆ°å¦ä¸€æ–¹
- âœ… éœ€è¦æ˜ç¡®è°ç»´æŠ¤å…³ç³»ï¼ˆç”¨mappedByï¼‰

**å…³ç³»ç¤ºæ„**ï¼š
```
Department (éƒ¨é—¨)          Employee (å‘˜å·¥)
    â†“                         â†“
employeesé›†åˆ â†â”€â”€â”€â”€â”€â†’ departmentå¯¹è±¡
    â†“                         â†“
 @OneToMany              @ManyToOne
 mappedBy              @JoinColumn
 (ä¸ç»´æŠ¤)                (ç»´æŠ¤å¤–é”®)
```

### 4.2 åŒå‘ä¸€å¯¹å¤šå®ç°


**å®Œæ•´ä»£ç ç¤ºä¾‹**ï¼š

```java
// éƒ¨é—¨ç±» - "ä¸€"çš„ä¸€æ–¹
@Entity
@Table(name = "department")
public class Department {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // åŒå‘å…³è”ï¼šmappedByè¡¨ç¤ºç”±Employeeç»´æŠ¤å…³ç³»
    @OneToMany(
        mappedBy = "department",     // å¯¹åº”Employeeä¸­çš„departmentå±æ€§
        cascade = CascadeType.ALL,   // çº§è”æ‰€æœ‰æ“ä½œ
        orphanRemoval = true         // åˆ é™¤å­¤å„¿å¯¹è±¡
    )
    private List<Employee> employees = new ArrayList<>();
    
    // ä¾¿æ·æ–¹æ³•ï¼šæ·»åŠ å‘˜å·¥
    public void addEmployee(Employee employee) {
        employees.add(employee);
        employee.setDepartment(this);  // ç»´æŠ¤åŒå‘å…³ç³»
    }
    
    // ä¾¿æ·æ–¹æ³•ï¼šç§»é™¤å‘˜å·¥
    public void removeEmployee(Employee employee) {
        employees.remove(employee);
        employee.setDepartment(null);
    }
    
    // getter/setter...
}

// å‘˜å·¥ç±» - "å¤š"çš„ä¸€æ–¹
@Entity
@Table(name = "employee")
public class Employee {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // åŒå‘å…³è”ï¼šè¿™è¾¹ç»´æŠ¤å¤–é”®
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "dept_id", nullable = false)
    private Department department;
    
    // getter/setter...
}
```

### 4.3 å…³ç³»ç»´æŠ¤çš„å…³é”®


**åŒå‘å…³ç³»åŒæ­¥**ï¼š
```java
// âŒ é”™è¯¯åšæ³•ï¼šåªè®¾ç½®ä¸€è¾¹
department.getEmployees().add(employee);  // åªè®¾ç½®äº†éƒ¨é—¨è¿™è¾¹
// ç»“æœï¼šå…³ç³»ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¿å­˜å¤±è´¥

// âœ… æ­£ç¡®åšæ³•ï¼šä¸¤è¾¹éƒ½è¦è®¾ç½®
department.getEmployees().add(employee);  // éƒ¨é—¨è¿™è¾¹
employee.setDepartment(department);       // å‘˜å·¥è¿™è¾¹
// ç»“æœï¼šå…³ç³»ä¸€è‡´ï¼Œæ­£å¸¸ä¿å­˜

// ğŸŒŸ æœ€ä½³åšæ³•ï¼šç”¨ä¾¿æ·æ–¹æ³•
department.addEmployee(employee);  // æ–¹æ³•å†…éƒ¨åŒæ—¶ç»´æŠ¤ä¸¤è¾¹
```

**ä¸ºä»€ä¹ˆè¦ä¸¤è¾¹éƒ½è®¾ç½®**ï¼š
1. **Hibernateçš„å†…å­˜ç®¡ç†**ï¼šä¸¤ä¸ªå¯¹è±¡éƒ½åœ¨Sessionä¸­ï¼Œè¦ä¿æŒä¸€è‡´
2. **ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§**ï¼šç¡®ä¿å¯¹è±¡å›¾çš„å®Œæ•´æ€§
3. **é¿å…æ•°æ®ä¸¢å¤±**ï¼šè™½ç„¶åªæœ‰ä¸€æ–¹ç»´æŠ¤å¤–é”®ï¼Œä½†ä¸¤è¾¹éƒ½è¦çŸ¥é“

### 4.4 ä½¿ç”¨ç¤ºä¾‹å¯¹æ¯”


**åŒå‘å…³è”çš„ä¾¿åˆ©æ€§**ï¼š

```java
// 1. ä»éƒ¨é—¨æŸ¥å‘˜å·¥
Department dept = session.get(Department.class, 1L);
List<Employee> employees = dept.getEmployees();
System.out.println("ç ”å‘éƒ¨æœ‰ " + employees.size() + " ä¸ªå‘˜å·¥");

// 2. ä»å‘˜å·¥æŸ¥éƒ¨é—¨ï¼ˆå•å‘åšä¸åˆ°çš„ï¼ï¼‰
Employee emp = session.get(Employee.class, 1L);
Department department = emp.getDepartment();
System.out.println(emp.getName() + " å±äº " + department.getName());

// 3. æ·»åŠ æ–°å‘˜å·¥
Department dept = session.get(Department.class, 1L);
Employee newEmp = new Employee();
newEmp.setName("ç‹äº”");
dept.addEmployee(newEmp);  // ä¾¿æ·æ–¹æ³•ç»´æŠ¤åŒå‘å…³ç³»
session.save(dept);  // çº§è”ä¿å­˜å‘˜å·¥
```

### 4.5 ç”Ÿæˆçš„SQLåˆ†æ


```sql
-- åŒå‘å…³è”æ‰§è¡Œçš„SQLï¼ˆæ¯”å•å‘é«˜æ•ˆï¼‰
-- 1. ä¿å­˜éƒ¨é—¨
INSERT INTO department (name) VALUES ('ç ”å‘éƒ¨');

-- 2. ä¿å­˜å‘˜å·¥ï¼ˆç›´æ¥è®¾ç½®å¤–é”®ï¼‰
INSERT INTO employee (name, dept_id) VALUES ('å¼ ä¸‰', 1);
INSERT INTO employee (name, dept_id) VALUES ('æå››', 1);

-- æ²¡æœ‰é¢å¤–çš„UPDATEè¯­å¥ï¼
```

> âœ… **ä¼˜åŠ¿**ï¼šå› ä¸ºEmployeeç»´æŠ¤å¤–é”®ï¼Œæ’å…¥æ—¶å°±èƒ½è®¾ç½®dept_idï¼Œä¸éœ€è¦é¢å¤–UPDATE

---

## 5. ğŸ› ï¸ å¤–é”®ç»´æŠ¤ç­–ç•¥


### 5.1 è°æ¥ç»´æŠ¤å¤–é”®


**ä¸‰ç§æƒ…å†µå¯¹æ¯”**ï¼š

| ç»´æŠ¤æ–¹å¼ | é…ç½®æ–¹æ³• | ç”ŸæˆSQL | æ€§èƒ½ | æ¨èåº¦ |
|---------|---------|---------|------|--------|
| **"ä¸€"æ–¹ç»´æŠ¤** | `Departmentä¸Šæ— mappedBy` | `å¤šæ¡UPDATE` | âŒ å·® | â­ ä¸æ¨è |
| **"å¤š"æ–¹ç»´æŠ¤** | `Departmentä¸Šæœ‰mappedBy` | `ç›´æ¥INSERT` | âœ… å¥½ | â­â­â­â­â­ æ¨è |
| **åŒæ–¹éƒ½ç»´æŠ¤** | `éƒ½æ²¡æœ‰mappedBy` | `æ··ä¹±` | âŒ æœ€å·® | âŒ ç¦æ­¢ |

### 5.2 æ¨èé…ç½®æ¨¡å¼


**æœ€ä½³å®è·µ**ï¼š

```java
// "ä¸€"çš„ä¸€æ–¹ï¼šä½¿ç”¨mappedByï¼Œä¸ç»´æŠ¤
@OneToMany(mappedBy = "department", cascade = CascadeType.ALL)
private List<Employee> employees;

// "å¤š"çš„ä¸€æ–¹ï¼šä½¿ç”¨@JoinColumnï¼Œç»´æŠ¤å¤–é”®
@ManyToOne
@JoinColumn(name = "dept_id")
private Department department;
```

**æ ¸å¿ƒåŸåˆ™**ï¼š
> ğŸ¯ **è®©"å¤š"çš„ä¸€æ–¹ç»´æŠ¤å¤–é”®ï¼Œå› ä¸ºå¤–é”®æœ¬æ¥å°±åœ¨"å¤š"çš„è¡¨é‡Œ**

### 5.3 å¤–é”®åˆ—é…ç½®é€‰é¡¹


**å¸¸ç”¨é…ç½®**ï¼š

```java
@JoinColumn(
    name = "dept_id",              // å¤–é”®åˆ—å
    nullable = false,              // ä¸å…è®¸ä¸ºç©ºï¼ˆå‘˜å·¥å¿…é¡»å±äºæŸéƒ¨é—¨ï¼‰
    updatable = true,              // å…è®¸æ›´æ–°ï¼ˆå‘˜å·¥å¯ä»¥æ¢éƒ¨é—¨ï¼‰
    insertable = true,             // å…è®¸æ’å…¥
    columnDefinition = "BIGINT"    // åˆ—ç±»å‹å®šä¹‰
)
```

**ä¸šåŠ¡åœºæ™¯é…ç½®**ï¼š

```java
// åœºæ™¯1ï¼šå‘˜å·¥å¿…é¡»å±äºéƒ¨é—¨
@JoinColumn(name = "dept_id", nullable = false)

// åœºæ™¯2ï¼šå‘˜å·¥å¯ä»¥ä¸å±äºéƒ¨é—¨ï¼ˆä¸´æ—¶å·¥ï¼‰
@JoinColumn(name = "dept_id", nullable = true)

// åœºæ™¯3ï¼šå‘˜å·¥ä¸èƒ½æ¢éƒ¨é—¨
@JoinColumn(name = "dept_id", nullable = false, updatable = false)
```

### 5.4 å…³ç³»åŒæ­¥çš„è¾…åŠ©æ–¹æ³•


**å·¥å…·æ–¹æ³•æ¨¡æ¿**ï¼š

```java
@Entity
public class Department {
    @OneToMany(mappedBy = "department", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<Employee> employees = new ArrayList<>();
    
    // æ·»åŠ å‘˜å·¥ï¼ˆæ¨èï¼‰
    public void addEmployee(Employee employee) {
        employees.add(employee);           // éƒ¨é—¨è¿™è¾¹
        employee.setDepartment(this);      // å‘˜å·¥é‚£è¾¹
    }
    
    // ç§»é™¤å‘˜å·¥ï¼ˆæ¨èï¼‰
    public void removeEmployee(Employee employee) {
        employees.remove(employee);        // éƒ¨é—¨è¿™è¾¹
        employee.setDepartment(null);      // å‘˜å·¥é‚£è¾¹
    }
    
    // æ‰¹é‡è®¾ç½®å‘˜å·¥
    public void setEmployees(List<Employee> employees) {
        this.employees.clear();
        employees.forEach(this::addEmployee);
    }
}
```

> ğŸ’¡ **ä½¿ç”¨å»ºè®®**ï¼šä¸šåŠ¡ä»£ç ä¸­ç»Ÿä¸€ä½¿ç”¨è¿™äº›è¾…åŠ©æ–¹æ³•ï¼Œä¸è¦ç›´æ¥æ“ä½œé›†åˆ

---

## 6. ğŸ”„ çº§è”æ“ä½œè¯¦è§£


### 6.1 ä»€ä¹ˆæ˜¯çº§è”æ“ä½œ


**é€šä¿—ç†è§£**ï¼š
- **çº§è”**ï¼šå°±åƒå¤šç±³è¯ºéª¨ç‰Œï¼Œæ¨å€’ä¸€ä¸ªï¼Œåé¢è·Ÿç€å€’
- **Hibernateçº§è”**ï¼šå¯¹çˆ¶å¯¹è±¡æ“ä½œï¼Œå­å¯¹è±¡è‡ªåŠ¨è·Ÿç€æ“ä½œ

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
åˆ é™¤ä¸€ä¸ªéƒ¨é—¨ï¼š
âŒ ä¸çº§è”ï¼šéƒ¨é—¨åˆ äº†ï¼Œå‘˜å·¥è¿˜åœ¨ï¼ˆå˜æˆå­¤å„¿ï¼‰
âœ… çº§è”åˆ é™¤ï¼šéƒ¨é—¨åˆ äº†ï¼Œå‘˜å·¥ä¹Ÿè·Ÿç€åˆ é™¤
```

### 6.2 çº§è”ç±»å‹è¯¦è§£


**CascadeTypeæšä¸¾å€¼**ï¼š

| çº§è”ç±»å‹ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|---------|------|---------|------|
| **PERSIST** | `ä¿å­˜çº§è”` | ä¿å­˜éƒ¨é—¨æ—¶è‡ªåŠ¨ä¿å­˜å‘˜å·¥ | `ä¿å­˜éƒ¨é—¨â†’å‘˜å·¥ä¹Ÿä¿å­˜` |
| **MERGE** | `æ›´æ–°çº§è”` | æ›´æ–°éƒ¨é—¨æ—¶è‡ªåŠ¨æ›´æ–°å‘˜å·¥ | `æ›´æ–°éƒ¨é—¨â†’å‘˜å·¥ä¹Ÿæ›´æ–°` |
| **REMOVE** | `åˆ é™¤çº§è”` | åˆ é™¤éƒ¨é—¨æ—¶è‡ªåŠ¨åˆ é™¤å‘˜å·¥ | `åˆ é™¤éƒ¨é—¨â†’å‘˜å·¥ä¹Ÿåˆ é™¤` |
| **REFRESH** | `åˆ·æ–°çº§è”` | åˆ·æ–°éƒ¨é—¨æ—¶è‡ªåŠ¨åˆ·æ–°å‘˜å·¥ | `é‡æ–°åŠ è½½æ•°æ®` |
| **DETACH** | `åˆ†ç¦»çº§è”` | åˆ†ç¦»éƒ¨é—¨æ—¶è‡ªåŠ¨åˆ†ç¦»å‘˜å·¥ | `è„±ç¦»Sessionç®¡ç†` |
| **ALL** | `å…¨éƒ¨çº§è”` | åŒ…å«ä¸Šè¿°æ‰€æœ‰æ“ä½œ | `ä¸€åŠ³æ°¸é€¸` |

### 6.3 çº§è”é…ç½®ç¤ºä¾‹


**ä¸åŒåœºæ™¯çš„é…ç½®**ï¼š

```java
// åœºæ™¯1ï¼šå®Œå…¨çº§è”ï¼ˆæœ€å¸¸ç”¨ï¼‰
@OneToMany(
    mappedBy = "department",
    cascade = CascadeType.ALL,
    orphanRemoval = true  // åˆ é™¤å­¤å„¿
)
private List<Employee> employees;

// åœºæ™¯2ï¼šåªçº§è”ä¿å­˜å’Œæ›´æ–°ï¼ˆä¸çº§è”åˆ é™¤ï¼‰
@OneToMany(
    mappedBy = "department",
    cascade = {CascadeType.PERSIST, CascadeType.MERGE}
)
private List<Employee> employees;

// åœºæ™¯3ï¼šä¸çº§è”ä»»ä½•æ“ä½œ
@OneToMany(mappedBy = "department")
private List<Employee> employees;

// åœºæ™¯4ï¼š@ManyToOneè¿™è¾¹ä¹Ÿå¯ä»¥çº§è”
@ManyToOne(cascade = CascadeType.PERSIST)
@JoinColumn(name = "dept_id")
private Department department;
```

### 6.4 çº§è”æ“ä½œå®æˆ˜


**PERSISTçº§è”ï¼ˆä¿å­˜ï¼‰**ï¼š

```java
// åˆ›å»ºéƒ¨é—¨å’Œå‘˜å·¥
Department dept = new Department();
dept.setName("æŠ€æœ¯éƒ¨");

Employee emp1 = new Employee();
emp1.setName("å¼ ä¸‰");

Employee emp2 = new Employee();
emp2.setName("æå››");

dept.addEmployee(emp1);
dept.addEmployee(emp2);

// åªä¿å­˜éƒ¨é—¨ï¼Œå‘˜å·¥è‡ªåŠ¨çº§è”ä¿å­˜
session.save(dept);
// æ‰§è¡ŒSQLï¼š
// INSERT INTO department (name) VALUES ('æŠ€æœ¯éƒ¨');
// INSERT INTO employee (name, dept_id) VALUES ('å¼ ä¸‰', 1);
// INSERT INTO employee (name, dept_id) VALUES ('æå››', 1);
```

**REMOVEçº§è”ï¼ˆåˆ é™¤ï¼‰**ï¼š

```java
// åˆ é™¤éƒ¨é—¨ï¼Œå‘˜å·¥è‡ªåŠ¨çº§è”åˆ é™¤
Department dept = session.get(Department.class, 1L);
session.delete(dept);
// æ‰§è¡ŒSQLï¼š
// DELETE FROM employee WHERE dept_id = 1;
// DELETE FROM department WHERE id = 1;
```

**orphanRemovalï¼ˆå­¤å„¿åˆ é™¤ï¼‰**ï¼š

```java
// ä»é›†åˆä¸­ç§»é™¤å‘˜å·¥ï¼Œå‘˜å·¥ä¼šè¢«è‡ªåŠ¨åˆ é™¤
Department dept = session.get(Department.class, 1L);
Employee emp = dept.getEmployees().get(0);

dept.removeEmployee(emp);  // ä»é›†åˆç§»é™¤
session.update(dept);

// æ‰§è¡ŒSQLï¼š
// DELETE FROM employee WHERE id = ?;
// å› ä¸ºå‘˜å·¥å¤±å»äº†éƒ¨é—¨ï¼Œå˜æˆ"å­¤å„¿"ï¼Œè¢«è‡ªåŠ¨åˆ é™¤
```

### 6.5 çº§è”æ³¨æ„äº‹é¡¹


**å¸¸è§é™·é˜±**ï¼š

```java
// âš ï¸ é™·é˜±1ï¼šçº§è”åˆ é™¤è¦å°å¿ƒ
@OneToMany(cascade = CascadeType.ALL)  
private List<Employee> employees;
// åˆ é™¤éƒ¨é—¨ä¼šåˆ é™¤æ‰€æœ‰å‘˜å·¥ï¼ç¡®å®šè¦è¿™æ ·å—ï¼Ÿ

// âš ï¸ é™·é˜±2ï¼šåŒå‘çº§è”å¯èƒ½æ­»å¾ªç¯
// Departmentç«¯
@OneToMany(cascade = CascadeType.ALL)
private List<Employee> employees;

// Employeeç«¯ï¼ˆä¸è¦è¿™æ ·é…ç½®ï¼ï¼‰
@ManyToOne(cascade = CascadeType.ALL)  // å±é™©ï¼
private Department department;
// å¯èƒ½å¯¼è‡´ï¼šä¿å­˜å‘˜å·¥â†’çº§è”ä¿å­˜éƒ¨é—¨â†’çº§è”ä¿å­˜å‘˜å·¥â†’æ­»å¾ªç¯

// âœ… æ­£ç¡®åšæ³•ï¼šé€šå¸¸åªåœ¨"ä¸€"æ–¹é…ç½®çº§è”
@OneToMany(cascade = CascadeType.ALL)
private List<Employee> employees;

@ManyToOne  // "å¤š"æ–¹ä¸é…ç½®çº§è”
private Department department;
```

**çº§è”ä½¿ç”¨å»ºè®®**ï¼š

| æƒ…å†µ | æ¨èé…ç½® | è¯´æ˜ |
|------|---------|------|
| **å¼ºä¾èµ–å…³ç³»** | `cascade = ALL, orphanRemoval = true` | è®¢å•-è®¢å•é¡¹ |
| **å¼±ä¾èµ–å…³ç³»** | `cascade = {PERSIST, MERGE}` | éƒ¨é—¨-å‘˜å·¥ |
| **ç‹¬ç«‹å®ä½“** | `ä¸é…ç½®çº§è”` | ç”¨æˆ·-è§’è‰² |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ä¸€å¯¹å¤šæœ¬è´¨ï¼šä¸€ä¸ªçˆ¶å¯¹è±¡å¯¹åº”å¤šä¸ªå­å¯¹è±¡ï¼Œå¤–é”®åœ¨"å¤š"æ–¹
ğŸ”¸ å•å‘vsåŒå‘ï¼šå•å‘åªèƒ½å•è¾¹æŸ¥è¯¢ï¼ŒåŒå‘å¯ä»¥äº’ç›¸æŸ¥è¯¢
ğŸ”¸ å…³ç³»ç»´æŠ¤ï¼šæ¨èè®©"å¤š"æ–¹ç»´æŠ¤å¤–é”®ï¼Œ"ä¸€"æ–¹ç”¨mappedBy
ğŸ”¸ çº§è”æ“ä½œï¼šçˆ¶å¯¹è±¡æ“ä½œæ—¶ï¼Œå­å¯¹è±¡è‡ªåŠ¨è·Ÿéšæ“ä½œ
ğŸ”¸ å­¤å„¿åˆ é™¤ï¼šä»é›†åˆç§»é™¤çš„å¯¹è±¡ä¼šè¢«è‡ªåŠ¨åˆ é™¤
```

### 7.2 æ³¨è§£é…ç½®é€ŸæŸ¥è¡¨


**éƒ¨é—¨ç±»ï¼ˆ"ä¸€"æ–¹ï¼‰é…ç½®**ï¼š
```java
@OneToMany(
    mappedBy = "department",        // å¿…å¡«ï¼šå¯¹æ–¹å±æ€§å
    cascade = CascadeType.ALL,      // å¯é€‰ï¼šçº§è”ç±»å‹
    fetch = FetchType.LAZY,         // å¯é€‰ï¼šåŠ è½½ç­–ç•¥
    orphanRemoval = true            // å¯é€‰ï¼šå­¤å„¿åˆ é™¤
)
private List<Employee> employees = new ArrayList<>();
```

**å‘˜å·¥ç±»ï¼ˆ"å¤š"æ–¹ï¼‰é…ç½®**ï¼š
```java
@ManyToOne(
    fetch = FetchType.LAZY,         // å¯é€‰ï¼šåŠ è½½ç­–ç•¥
    cascade = CascadeType.PERSIST   // å¯é€‰ï¼šçº§è”ç±»å‹
)
@JoinColumn(
    name = "dept_id",               // å¿…å¡«ï¼šå¤–é”®åˆ—å
    nullable = false,               // å¯é€‰ï¼šæ˜¯å¦éç©º
    updatable = true                // å¯é€‰ï¼šæ˜¯å¦å¯æ›´æ–°
)
private Department department;
```

### 7.3 æœ€ä½³å®è·µæ¸…å•


**âœ… æ¨èåšæ³•**ï¼š
- [x] ä¼˜å…ˆä½¿ç”¨åŒå‘ä¸€å¯¹å¤šï¼ˆæ›´çµæ´»ï¼‰
- [x] è®©"å¤š"æ–¹ç»´æŠ¤å¤–é”®ï¼ˆæ€§èƒ½å¥½ï¼‰
- [x] ä½¿ç”¨è¾…åŠ©æ–¹æ³•ç»´æŠ¤åŒå‘å…³ç³»
- [x] çº§è”æ“ä½œæ ¹æ®ä¸šåŠ¡è°¨æ…é…ç½®
- [x] ä½¿ç”¨`FetchType.LAZY`å»¶è¿ŸåŠ è½½

**âŒ é¿å…åšæ³•**ï¼š
- [ ] ä¸è¦ç”¨å•å‘ä¸€å¯¹å¤šï¼ˆæ€§èƒ½å·®ï¼‰
- [ ] ä¸è¦è®©"ä¸€"æ–¹ç»´æŠ¤å¤–é”®
- [ ] ä¸è¦åŒå‘éƒ½é…ç½®çº§è”ALL
- [ ] ä¸è¦å¿˜è®°åŒæ­¥åŒå‘å…³ç³»
- [ ] ä¸è¦éšæ„ä½¿ç”¨orphanRemoval

### 7.4 å¸¸è§é—®é¢˜è§£å†³


**é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜**
```java
// âŒ é—®é¢˜ä»£ç 
List<Department> depts = session.createQuery("from Department").list();
for (Department dept : depts) {
    System.out.println(dept.getEmployees().size());  // æ¯æ¬¡éƒ½æŸ¥ä¸€æ¬¡æ•°æ®åº“
}

// âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨JOIN FETCH
List<Department> depts = session.createQuery(
    "from Department d left join fetch d.employees"
).list();
```

**é—®é¢˜2ï¼šçº§è”åˆ é™¤å¯¼è‡´æ•°æ®ä¸¢å¤±**
```java
// âŒ å±é™©é…ç½®
@OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)
private List<Employee> employees;

// åˆ é™¤éƒ¨é—¨ â†’ å‘˜å·¥å…¨åˆ é™¤äº†ï¼

// âœ… å®‰å…¨åšæ³•
@OneToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE})
private List<Employee> employees;
// åˆ é™¤éƒ¨é—¨ â†’ å‘˜å·¥ä¿ç•™ï¼Œåªæ˜¯dept_idå˜NULLï¼ˆå¦‚æœå…è®¸çš„è¯ï¼‰
```

**é—®é¢˜3ï¼šå¿˜è®°ç»´æŠ¤åŒå‘å…³ç³»**
```java
// âŒ é”™è¯¯
department.getEmployees().add(employee);
// employee.getDepartment() è¿˜æ˜¯nullï¼

// âœ… æ­£ç¡®
department.addEmployee(employee);  // è¾…åŠ©æ–¹æ³•å†…éƒ¨ç»´æŠ¤åŒå‘
```

### 7.5 è®°å¿†å£è¯€


```
ä¸€å¯¹å¤šå…³è”è®°å¿ƒé—´ï¼Œ
å¤–é”®æ°¸åœ¨å¤šæ–¹å®‰ã€‚
åŒå‘çµæ´»å•å‘ç®€ï¼Œ
mappedByå£°æ˜ä¸ç»´æƒã€‚

çº§è”æ“ä½œè¦å°å¿ƒï¼Œ
åˆ é™¤å­¤å„¿éœ€è°¨æ…ã€‚
è¾…åŠ©æ–¹æ³•æ¥å¸®å¿™ï¼Œ
åŒå‘åŒæ­¥ä¸ä¼šæ…Œã€‚
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- ğŸ”‘ **å¤–é”®åœ¨å¤šæ–¹** - æ•°æ®åº“åŸç†å†³å®š
- ğŸ”‘ **å¤šæ–¹ç»´æŠ¤** - æ€§èƒ½æœ€ä¼˜é…ç½®  
- ğŸ”‘ **åŒå‘åŒæ­¥** - é˜²æ­¢æ•°æ®ä¸ä¸€è‡´
- ğŸ”‘ **çº§è”è°¨æ…** - é¿å…æ„å¤–åˆ é™¤