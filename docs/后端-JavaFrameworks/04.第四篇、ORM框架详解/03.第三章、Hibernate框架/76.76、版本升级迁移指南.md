---
title: 76ã€ç‰ˆæœ¬å‡çº§è¿ç§»æŒ‡å—
---
## ğŸ“š ç›®å½•

1. [Hibernateç‰ˆæœ¬æ¼”è¿›æ¦‚è¿°](#1-hibernateç‰ˆæœ¬æ¼”è¿›æ¦‚è¿°)
2. [ç‰ˆæœ¬å·®å¼‚æ ¸å¿ƒè§£æ](#2-ç‰ˆæœ¬å·®å¼‚æ ¸å¿ƒè§£æ)
3. [å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ](#3-å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ)
4. [é…ç½®æ–‡ä»¶è¿ç§»å®æˆ˜](#4-é…ç½®æ–‡ä»¶è¿ç§»å®æˆ˜)
5. [APIå˜æ›´é€‚é…æŒ‡å—](#5-apiå˜æ›´é€‚é…æŒ‡å—)
6. [åºŸå¼ƒåŠŸèƒ½æ›¿æ¢æ–¹æ¡ˆ](#6-åºŸå¼ƒåŠŸèƒ½æ›¿æ¢æ–¹æ¡ˆ)
7. [å…¼å®¹æ€§æµ‹è¯•ç­–ç•¥](#7-å…¼å®¹æ€§æµ‹è¯•ç­–ç•¥)
8. [å›æ»šä¸åº”æ€¥æ–¹æ¡ˆ](#8-å›æ»šä¸åº”æ€¥æ–¹æ¡ˆ)
9. [å¹³æ»‘å‡çº§å®Œæ•´æ–¹æ¡ˆ](#9-å¹³æ»‘å‡çº§å®Œæ•´æ–¹æ¡ˆ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Hibernateç‰ˆæœ¬æ¼”è¿›æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç‰ˆæœ¬å‡çº§


ğŸŒ° **é€šä¿—ç†è§£**ï¼šå°±åƒæ‰‹æœºç³»ç»Ÿå‡çº§ä¸€æ ·ï¼ŒHibernateä¹Ÿä¼šæ¨å‡ºæ–°ç‰ˆæœ¬æ¥ä¿®å¤é—®é¢˜ã€å¢åŠ åŠŸèƒ½ã€‚å‡çº§å°±æ˜¯æŠŠé¡¹ç›®ä¸­ä½¿ç”¨çš„æ—§ç‰ˆæœ¬æ¢æˆæ–°ç‰ˆæœ¬ã€‚

**ä¸ºä»€ä¹ˆè¦å‡çº§ï¼Ÿ**
- ğŸ› **ä¿®å¤Bug**ï¼šæ—§ç‰ˆæœ¬çš„é—®é¢˜åœ¨æ–°ç‰ˆæœ¬ä¸­è§£å†³äº†
- âš¡ **æ€§èƒ½æå‡**ï¼šæ–°ç‰ˆæœ¬è¿è¡Œæ›´å¿«ï¼Œå ç”¨èµ„æºæ›´å°‘
- ğŸ **æ–°åŠŸèƒ½**ï¼šå¯ä»¥ä½¿ç”¨æ–°ç‰ˆæœ¬æä¾›çš„å¼ºå¤§åŠŸèƒ½
- ğŸ”’ **å®‰å…¨åŠ å›º**ï¼šä¿®å¤å®‰å…¨æ¼æ´ï¼Œè®©ç³»ç»Ÿæ›´å®‰å…¨

### 1.2 ä¸»è¦ç‰ˆæœ¬åˆ†ç±»


```
Hibernateç‰ˆæœ¬æ¼”è¿›è·¯çº¿ï¼š

Hibernate 3.x (2005-2010)
    â†“
Hibernate 4.x (2011-2015)  â† å¤§å¹…åº¦æ”¹è¿›
    â†“
Hibernate 5.x (2015-2021)  â† é‡å¤§å˜é©
    â†“
Hibernate 6.x (2022-è‡³ä»Š)  â† ç°ä»£åŒ–é‡æ„
```

**ğŸ”¸ ç‰ˆæœ¬è·¨åº¦è¯´æ˜**

| å‡çº§ç±»å‹ | **éš¾åº¦** | **å½±å“èŒƒå›´** | **å…¸å‹åœºæ™¯** |
|---------|---------|-------------|-------------|
| å°ç‰ˆæœ¬å‡çº§ | `ğŸŸ¢ ç®€å•` | `Bugä¿®å¤ä¸ºä¸»` | `5.6.1 â†’ 5.6.5` |
| æ¬¡ç‰ˆæœ¬å‡çº§ | `ğŸŸ¡ ä¸­ç­‰` | `åŠŸèƒ½å¢å¼º` | `5.5.x â†’ 5.6.x` |
| å¤§ç‰ˆæœ¬å‡çº§ | `ğŸ”´ å¤æ‚` | `æ¶æ„è°ƒæ•´` | `5.x â†’ 6.x` |

---

## 2. ğŸ“Š ç‰ˆæœ¬å·®å¼‚æ ¸å¿ƒè§£æ


### 2.1 Hibernate 5.x vs 6.x ä¸»è¦åŒºåˆ«


> ğŸ’¡ **æ–°æ‰‹æç¤º**  
> æˆ‘ä»¬é‡ç‚¹è®²è§£5.xåˆ°6.xçš„å‡çº§ï¼Œå› ä¸ºè¿™æ˜¯ç›®å‰æœ€å¸¸è§çš„å‡çº§åœºæ™¯

**ğŸ”¸ æ ¸å¿ƒå˜åŒ–å¯¹æ¯”**

```
Hibernate 5.x                    Hibernate 6.x
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
SessionFactory                   SessionFactory (å…¨æ–°å®ç°)
    â†“                                â†“
ä½¿ç”¨JPA 2.1/2.2                  ä½¿ç”¨JPA 3.0+
    â†“                                â†“
åŸºäºJava 8                       æœ€ä½è¦æ±‚Java 11
    â†“                                â†“
æ—§ç‰ˆç±»å‹ç³»ç»Ÿ                      å…¨æ–°ç±»å‹ç³»ç»Ÿ
```

**å…³é”®å·®å¼‚è¯´æ˜**ï¼š

**1ï¸âƒ£ Javaç‰ˆæœ¬è¦æ±‚**
```
Hibernate 5.x: æ”¯æŒJava 8åŠä»¥ä¸Š
Hibernate 6.x: è‡³å°‘éœ€è¦Java 11

ğŸŒ° å°±åƒæ¸¸æˆéœ€è¦æ˜¾å¡è¦æ±‚ä¸€æ ·ï¼Œæ–°ç‰ˆæœ¬å¯¹è¿è¡Œç¯å¢ƒæœ‰æ›´é«˜è¦æ±‚
```

**2ï¸âƒ£ ç±»å‹ç³»ç»Ÿé‡æ„**
```java
// Hibernate 5.x å†™æ³•
@Type(type = "org.hibernate.type.StringType")
private String name;

// Hibernate 6.x å†™æ³•ï¼ˆæ›´ç®€æ´ï¼‰
@Column
private String name;  // è‡ªåŠ¨è¯†åˆ«ç±»å‹
```

**3ï¸âƒ£ æŸ¥è¯¢è¯­è¨€å¢å¼º**
```
HQLåœ¨6.xä¸­æ›´å¼ºå¤§ï¼š
âœ… æ”¯æŒCTEï¼ˆå…¬ç”¨è¡¨è¡¨è¾¾å¼ï¼‰
âœ… æ›´å¥½çš„å‡½æ•°æ”¯æŒ
âœ… æ€§èƒ½ä¼˜åŒ–çš„SQLç”Ÿæˆ
```

### 2.2 ä¸å…¼å®¹çš„é‡å¤§å˜æ›´


> âš ï¸ **é‡è¦è­¦å‘Š**  
> ä»¥ä¸‹å˜æ›´ä¼šå¯¼è‡´æ—§ä»£ç æ— æ³•ç›´æ¥è¿è¡Œï¼Œå¿…é¡»ä¿®æ”¹

**ğŸ”´ å¿…é¡»å¤„ç†çš„å˜æ›´**

1. **åŒ…åå˜æ›´**
```java
// æ—§ç‰ˆæœ¬ (5.x)
import org.hibernate.criterion.Restrictions;

// æ–°ç‰ˆæœ¬ (6.x) - åŒ…è·¯å¾„æ”¹å˜äº†
import org.hibernate.query.criteria.JpaCriteriaQuery;
```

2. **é…ç½®å±æ€§é‡å‘½å**
```properties
# Hibernate 5.x

hibernate.dialect=org.hibernate.dialect.MySQL5Dialect

# Hibernate 6.xï¼ˆåç§°æ›´è§„èŒƒï¼‰

hibernate.dialect=org.hibernate.dialect.MySQLDialect
```

3. **åºŸå¼ƒAPIç§»é™¤**
```java
// 5.x å¯ç”¨ï¼Œ6.x å·²åˆ é™¤
session.createCriteria(User.class);  // âŒ ä¸å†æ”¯æŒ

// å¿…é¡»æ”¹ç”¨
session.createQuery("from User", User.class);  // âœ… æ­£ç¡®å†™æ³•
```

---

## 3. ğŸ› ï¸ å‡çº§å‰çš„å‡†å¤‡å·¥ä½œ


### 3.1 ç¯å¢ƒè¯„ä¼°æ£€æŸ¥å•


> ğŸ“‹ **å‡çº§å‰å¿…åšæ£€æŸ¥**  
> å°±åƒè£…ä¿®å‰è¦å…ˆéªŒæˆ¿ï¼Œå‡çº§å‰ä¹Ÿè¦å…¨é¢æ£€æŸ¥

**âœ… ç¯å¢ƒå…¼å®¹æ€§æ£€æŸ¥**
```
- [ ] Javaç‰ˆæœ¬ï¼šç¡®è®¤æ˜¯å¦æ»¡è¶³æœ€ä½ç‰ˆæœ¬è¦æ±‚
- [ ] ä¾èµ–æ¡†æ¶ï¼šæ£€æŸ¥Springã€JPAç­‰æ¡†æ¶ç‰ˆæœ¬
- [ ] æ•°æ®åº“é©±åŠ¨ï¼šç¡®è®¤é©±åŠ¨ç‰ˆæœ¬å…¼å®¹æ€§
- [ ] æ„å»ºå·¥å…·ï¼šMaven/Gradleç‰ˆæœ¬æ£€æŸ¥
- [ ] åº”ç”¨æœåŠ¡å™¨ï¼šTomcat/WebLogicç­‰ç‰ˆæœ¬
```

**ğŸ” å¿«é€Ÿæ£€æŸ¥è„šæœ¬**
```bash
# æ£€æŸ¥Javaç‰ˆæœ¬

java -version

# æ£€æŸ¥Mavenä¾èµ–æ ‘

mvn dependency:tree | grep hibernate

# æŸ¥æ‰¾ä½¿ç”¨äº†åºŸå¼ƒAPIçš„ä»£ç 

grep -r "createCriteria" src/
```

### 3.2 é¡¹ç›®ä¾èµ–åˆ†æ


**ğŸ”¸ ä¾èµ–å…³ç³»å›¾ç¤º**
```
ä½ çš„é¡¹ç›®
    â”œâ”€â”€ Hibernate 5.x
    â”œâ”€â”€ Spring Framework
    â”‚   â””â”€â”€ å¯èƒ½ä¾èµ–ç‰¹å®šHibernateç‰ˆæœ¬
    â”œâ”€â”€ Spring Data JPA
    â”‚   â””â”€â”€ ç»‘å®šHibernateç‰ˆæœ¬
    â””â”€â”€ å…¶ä»–ORMå·¥å…·
        â””â”€â”€ å¯èƒ½ä¸Hibernateå†²çª
```

**ä¾èµ–æ£€æŸ¥è¦ç‚¹**ï¼š
- **Springç‰ˆæœ¬åŒ¹é…**ï¼šSpring 5.x é… Hibernate 5.xï¼ŒSpring 6.x é… Hibernate 6.x
- **JPAç‰ˆæœ¬å¯¹é½**ï¼šç¡®ä¿JPAè§„èŒƒç‰ˆæœ¬ä¸€è‡´
- **ä¼ é€’ä¾èµ–å†²çª**ï¼šè§£å†³ç‰ˆæœ¬å†²çªé—®é¢˜

### 3.3 ä»£ç æ‰«æä¸è¯„ä¼°


**ğŸ“Š å½±å“èŒƒå›´è¯„ä¼°è¡¨**

| æ£€æŸ¥é¡¹ | **æ£€æŸ¥æ–¹æ³•** | **å½±å“ç¨‹åº¦** |
|--------|------------|-------------|
| é…ç½®æ–‡ä»¶ | `æœç´¢hibernate.cfg.xml` | `ğŸŸ¡ ä¸­ç­‰` |
| å®ä½“ç±»æ³¨è§£ | `æœç´¢@Typeç­‰æ³¨è§£` | `ğŸŸ¢ è¾ƒå°` |
| æŸ¥è¯¢ä»£ç  | `æœç´¢Criteria API` | `ğŸ”´ è¾ƒå¤§` |
| è‡ªå®šä¹‰ç±»å‹ | `æœç´¢UserTypeå®ç°` | `ğŸ”´ è¾ƒå¤§` |

---

## 4. ğŸ“ é…ç½®æ–‡ä»¶è¿ç§»å®æˆ˜


### 4.1 hibernate.cfg.xml é…ç½®è¿ç§»


**ğŸ”¸ é…ç½®å±æ€§å¯¹ç…§è¡¨**

```xml
<!-- Hibernate 5.x é…ç½® -->
<property name="hibernate.dialect">
    org.hibernate.dialect.MySQL5InnoDBDialect
</property>
<property name="hibernate.show_sql">true</property>
<property name="hibernate.format_sql">true</property>

<!-- Hibernate 6.x é…ç½®ï¼ˆç®€åŒ–äº†ï¼‰ -->
<property name="hibernate.dialect">
    org.hibernate.dialect.MySQLDialect
</property>
<property name="hibernate.show_sql">true</property>
<property name="hibernate.format_sql">true</property>
```

> ğŸ’¡ **å˜åŒ–è¯´æ˜**  
> 6.xç‰ˆæœ¬çš„æ–¹è¨€é…ç½®æ›´ç®€æ´ï¼Œå»æ‰äº†ç‰ˆæœ¬å·åç¼€ï¼ˆå¦‚MySQL5ã€MySQL8ç­‰ï¼‰ï¼ŒHibernateä¼šè‡ªåŠ¨è¯†åˆ«æ•°æ®åº“ç‰ˆæœ¬

**å¸¸è§é…ç½®è¿ç§»å¯¹ç…§**ï¼š

| Hibernate 5.x | Hibernate 6.x | **è¯´æ˜** |
|--------------|--------------|---------|
| `MySQL5Dialect` | `MySQLDialect` | `è‡ªåŠ¨é€‚é…ç‰ˆæœ¬` |
| `Oracle10gDialect` | `OracleDialect` | `è‡ªåŠ¨æ£€æµ‹` |
| `PostgreSQL9Dialect` | `PostgreSQLDialect` | `ç‰ˆæœ¬æ— å…³` |

### 4.2 application.properties è¿ç§»


```properties
# ===== Hibernate 5.x é…ç½® =====

spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5Dialect
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true

# ===== Hibernate 6.x é…ç½®ï¼ˆæ–°å†™æ³•ï¼‰=====

spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
# 6.xä¸å†éœ€è¦enable_lazy_load_no_transï¼ˆå·²åºŸå¼ƒï¼‰

```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> `enable_lazy_load_no_trans`åœ¨6.xä¸­è¢«ç§»é™¤ï¼Œéœ€è¦æ”¹ç”¨æ­£ç¡®çš„äº‹åŠ¡ç®¡ç†æ–¹å¼

---

## 5. ğŸ”„ APIå˜æ›´é€‚é…æŒ‡å—


### 5.1 Criteria API è¿ç§»


**æ—§ç‰ˆæœ¬å†™æ³•ï¼ˆ5.xï¼‰**ï¼š
```java
// âŒ Hibernate 6.x å·²ç§»é™¤
Criteria criteria = session.createCriteria(User.class);
criteria.add(Restrictions.eq("name", "å¼ ä¸‰"));
List<User> users = criteria.list();
```

**æ–°ç‰ˆæœ¬å†™æ³•ï¼ˆ6.xï¼‰**ï¼š
```java
// âœ… ä½¿ç”¨JPAæ ‡å‡†çš„Criteria API
CriteriaBuilder cb = session.getCriteriaBuilder();
CriteriaQuery<User> query = cb.createQuery(User.class);
Root<User> root = query.from(User.class);
query.select(root).where(cb.equal(root.get("name"), "å¼ ä¸‰"));

List<User> users = session.createQuery(query).getResultList();
```

ğŸŒ° **é€šä¿—ç†è§£**ï¼šæ—§APIå°±åƒè€å¼æ‰‹åŠ¨æŒ¡æ±½è½¦ï¼Œæ–°APIåƒè‡ªåŠ¨æŒ¡ï¼Œè™½ç„¶å¤æ‚ç‚¹ä½†æ›´æ ‡å‡†é€šç”¨

### 5.2 æŸ¥è¯¢æ–¹æ³•æ›¿æ¢


**ğŸ”¸ å¸¸ç”¨æŸ¥è¯¢APIå¯¹ç…§**

```java
// ========== 5.x æ—§å†™æ³• ==========
// æ–¹å¼1ï¼šä½¿ç”¨Criteriaï¼ˆå·²åºŸå¼ƒï¼‰
session.createCriteria(User.class)
    .add(Restrictions.like("name", "å¼ %"))
    .list();

// ========== 6.x æ–°å†™æ³• ==========
// æ–¹å¼1ï¼šHQLæŸ¥è¯¢ï¼ˆæ¨èï¼Œç®€å•ç›´è§‚ï¼‰
session.createQuery("from User where name like 'å¼ %'", User.class)
    .getResultList();

// æ–¹å¼2ï¼šJPA Criteriaï¼ˆç±»å‹å®‰å…¨ï¼‰
CriteriaBuilder cb = session.getCriteriaBuilder();
CriteriaQuery<User> cq = cb.createQuery(User.class);
Root<User> root = cq.from(User.class);
cq.where(cb.like(root.get("name"), "å¼ %"));
session.createQuery(cq).getResultList();
```

> ğŸ’¡ **é€‰æ‹©å»ºè®®**  
> - ç®€å•æŸ¥è¯¢ç”¨HQLï¼Œå†™èµ·æ¥å¿«
> - å¤æ‚åŠ¨æ€æŸ¥è¯¢ç”¨Criteriaï¼Œç±»å‹å®‰å…¨

### 5.3 ç±»å‹æ³¨è§£è¿ç§»


```java
// ========== 5.x å†™æ³• ==========
@Entity
public class Article {
    @Type(type = "org.hibernate.type.TextType")  // âŒ 6.xä¸æ”¯æŒ
    private String content;
    
    @Type(type = "yes_no")  // âŒ 6.xå·²ç§»é™¤
    private Boolean published;
}

// ========== 6.x å†™æ³• ==========
@Entity
public class Article {
    @Lob  // âœ… ä½¿ç”¨JPAæ ‡å‡†æ³¨è§£
    private String content;
    
    @Convert(converter = BooleanToYNConverter.class)  // âœ… ä½¿ç”¨è½¬æ¢å™¨
    private Boolean published;
}

// è½¬æ¢å™¨å®ç°
@Converter
public class BooleanToYNConverter 
    implements AttributeConverter<Boolean, String> {
    
    public String convertToDatabaseColumn(Boolean value) {
        return Boolean.TRUE.equals(value) ? "Y" : "N";
    }
    
    public Boolean convertToEntityAttribute(String value) {
        return "Y".equals(value);
    }
}
```

---

## 6. â™»ï¸ åºŸå¼ƒåŠŸèƒ½æ›¿æ¢æ–¹æ¡ˆ


### 6.1 å¸¸è§åºŸå¼ƒåŠŸèƒ½æ¸…å•


> ğŸš¨ **åºŸå¼ƒä¸ç­‰äºä¸èƒ½ç”¨**  
> æœ‰äº›åŠŸèƒ½è™½ç„¶æ ‡è®°ä¸ºåºŸå¼ƒï¼Œä½†6.xåˆæœŸç‰ˆæœ¬å¯èƒ½è¿˜èƒ½ç”¨ï¼Œä½†æœªæ¥ç‰ˆæœ¬ä¼šå½»åº•ç§»é™¤

**ğŸ”´ å·²å®Œå…¨ç§»é™¤çš„åŠŸèƒ½**

```
âŒ Criteria API (Legacy)
   æ›¿æ¢ â†’ JPA Criteria æˆ– HQL

âŒ hibernate.enable_lazy_load_no_trans
   æ›¿æ¢ â†’ æ­£ç¡®ä½¿ç”¨@Transactional

âŒ @Typeæ³¨è§£çš„typeå±æ€§
   æ›¿æ¢ â†’ @Lobæˆ–@Convert

âŒ hbm.xmlæ˜ å°„æ–‡ä»¶ï¼ˆä¸æ¨èï¼‰
   æ›¿æ¢ â†’ JPAæ³¨è§£
```

### 6.2 Sessionæ–¹æ³•æ›¿æ¢


**æ–¹æ³•å¯¹ç…§è¡¨**

| 5.x æ–¹æ³• | 6.x æ›¿ä»£æ–¹æ³• | **ä½¿ç”¨åœºæ™¯** |
|---------|------------|-------------|
| `save()` | `persist()` | `ä¿å­˜æ–°å®ä½“` |
| `update()` | `merge()` | `æ›´æ–°å®ä½“` |
| `saveOrUpdate()` | `merge()` | `ä¿å­˜æˆ–æ›´æ–°` |

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// ========== 5.x å†™æ³• ==========
session.save(user);           // ä¿å­˜
session.update(user);         // æ›´æ–°
session.saveOrUpdate(user);   // è‡ªåŠ¨åˆ¤æ–­

// ========== 6.x æ¨èå†™æ³• ==========
session.persist(user);        // ä¿å­˜ï¼ˆJPAæ ‡å‡†ï¼‰
session.merge(user);          // æ›´æ–°/ä¿å­˜ï¼ˆè‡ªåŠ¨åˆ¤æ–­ï¼‰
```

ğŸŒ° **ç†è§£åŒºåˆ«**ï¼š`persist`å°±åƒæ–°å»ºæ–‡ä»¶ï¼Œ`merge`åƒä¿å­˜æˆ–å¦å­˜ä¸ºï¼Œä¼šè‡ªåŠ¨åˆ¤æ–­

---

## 7. âœ… å…¼å®¹æ€§æµ‹è¯•ç­–ç•¥


### 7.1 æµ‹è¯•ç¯å¢ƒæ­å»º


**ğŸ”¸ æµ‹è¯•ç¯å¢ƒæ¶æ„**

```
å¼€å‘ç¯å¢ƒ          æµ‹è¯•ç¯å¢ƒ          ç”Ÿäº§ç¯å¢ƒ
   â†“                â†“                â†“
Hibernate 6.x   Hibernate 6.x    Hibernate 5.xï¼ˆæš‚ä¸å˜ï¼‰
   â†“                â†“                â†“
æµ‹è¯•æ•°æ®åº“      â†’ å®Œæ•´æµ‹è¯•  â†’    é€šè¿‡åå†å‡çº§
```

> ğŸ’¡ **æ¸è¿›å¼å‡çº§**  
> ä¸è¦ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒå‡çº§ï¼Œå…ˆåœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒéªŒè¯

### 7.2 æµ‹è¯•ç”¨ä¾‹è®¾è®¡


**ğŸ“‹ æ ¸å¿ƒæµ‹è¯•æ¸…å•**

```
âœ… åŠŸèƒ½æµ‹è¯•
   - [ ] CRUDæ“ä½œæ­£å¸¸
   - [ ] å…³è”æŸ¥è¯¢æ­£ç¡®
   - [ ] äº‹åŠ¡ç®¡ç†æœ‰æ•ˆ
   - [ ] æ‡’åŠ è½½åŠŸèƒ½æ­£å¸¸

âœ… æ€§èƒ½æµ‹è¯•  
   - [ ] æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”
   - [ ] æ‰¹é‡æ“ä½œæ•ˆç‡
   - [ ] å†…å­˜ä½¿ç”¨æƒ…å†µ
   - [ ] è¿æ¥æ± ç®¡ç†

âœ… å…¼å®¹æ€§æµ‹è¯•
   - [ ] ä¸åŒæ•°æ®åº“æµ‹è¯•
   - [ ] å¤šçº¿ç¨‹å¹¶å‘æµ‹è¯•
   - [ ] å¼‚å¸¸æƒ…å†µå¤„ç†
```

### 7.3 å›å½’æµ‹è¯•æ–¹æ¡ˆ


```java
// æµ‹è¯•ç¤ºä¾‹ï¼šç¡®ä¿å‡çº§ååŠŸèƒ½ä¸€è‡´
@Test
public void testUserCRUD() {
    // ä¿å­˜
    User user = new User("å¼ ä¸‰", 25);
    session.persist(user);
    
    // æŸ¥è¯¢
    User found = session.get(User.class, user.getId());
    assertEquals("å¼ ä¸‰", found.getName());
    
    // æ›´æ–°
    found.setAge(26);
    session.merge(found);
    
    // éªŒè¯
    session.refresh(found);
    assertEquals(26, found.getAge());
    
    // åˆ é™¤
    session.remove(found);
    assertNull(session.get(User.class, user.getId()));
}
```

---

## 8. ğŸ”™ å›æ»šä¸åº”æ€¥æ–¹æ¡ˆ


### 8.1 å›æ»šå‡†å¤‡å·¥ä½œ


> âš ï¸ **å‡çº§ä¿é™©æªæ–½**  
> å‡çº§å‰å¿…é¡»åšå¥½å›æ»šå‡†å¤‡ï¼Œå°±åƒç™»å±±å‰å‡†å¤‡ä¸‹å±±è·¯çº¿

**ğŸ”¸ å›æ»šæ£€æŸ¥æ¸…å•**

```
ğŸ“¦ ä»£ç ç‰ˆæœ¬æ§åˆ¶
   - [ ] Gitæ‰“ä¸Šå‡çº§å‰æ ‡ç­¾
   - [ ] åˆ†æ”¯ç­–ç•¥ï¼šä¿ç•™5.xåˆ†æ”¯

ğŸ’¾ æ•°æ®åº“å¤‡ä»½
   - [ ] å®Œæ•´æ•°æ®åº“å¤‡ä»½
   - [ ] Schemaç»“æ„å¯¼å‡º
   - [ ] æµ‹è¯•æ•°æ®å‡†å¤‡

ğŸ“‹ ä¾èµ–ç‰ˆæœ¬è®°å½•
   - [ ] pom.xmlå¤‡ä»½
   - [ ] ä¾èµ–å…³ç³»æ–‡æ¡£
   - [ ] é…ç½®æ–‡ä»¶å¿«ç…§
```

### 8.2 å›æ»šæ‰§è¡Œæ­¥éª¤


**å¿«é€Ÿå›æ»šæµç¨‹**

```
ç¬¬1æ­¥ï¼šåœæ­¢åº”ç”¨
    â†“
ç¬¬2æ­¥ï¼šè¿˜åŸä»£ç 
    git checkout tags/before-upgrade
    â†“
ç¬¬3æ­¥ï¼šè¿˜åŸä¾èµ–
    ä½¿ç”¨æ—§ç‰ˆæœ¬pom.xml
    â†“
ç¬¬4æ­¥ï¼šè¿˜åŸæ•°æ®åº“ï¼ˆå¦‚éœ€è¦ï¼‰
    mysql < backup.sql
    â†“
ç¬¬5æ­¥ï¼šé‡å¯éªŒè¯
    å¯åŠ¨åº”ç”¨ï¼Œæµ‹è¯•åŠŸèƒ½
```

**Gitå›æ»šå‘½ä»¤**ï¼š
```bash
# æŸ¥çœ‹å‡çº§å‰æ ‡ç­¾

git tag -l

# å›æ»šåˆ°å‡çº§å‰

git checkout tags/v1.0-before-hibernate6

# åˆ›å»ºå›æ»šåˆ†æ”¯ï¼ˆå¦‚éœ€ç»§ç»­å¼€å‘ï¼‰

git checkout -b rollback-branch
```

### 8.3 åº”æ€¥å¤„ç†é¢„æ¡ˆ


**ğŸš¨ å¸¸è§é—®é¢˜åº”æ€¥æ–¹æ¡ˆ**

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **åº”æ€¥æªæ–½** |
|---------|------------|-------------|
| å¯åŠ¨å¤±è´¥ | `ä¾èµ–å†²çª` | `æ£€æŸ¥ä¾èµ–æ ‘ï¼Œæ’é™¤å†²çª` |
| æŸ¥è¯¢æŠ¥é”™ | `APIä¸å…¼å®¹` | `é™çº§åˆ°5.xç‰ˆæœ¬` |
| æ€§èƒ½ä¸‹é™ | `é…ç½®ä¸å½“` | `è°ƒæ•´é…ç½®æˆ–å›æ»š` |
| æ•°æ®å¼‚å¸¸ | `ç±»å‹æ˜ å°„é—®é¢˜` | `ç«‹å³å›æ»šï¼Œæ¢å¤æ•°æ®` |

---

## 9. ğŸš€ å¹³æ»‘å‡çº§å®Œæ•´æ–¹æ¡ˆ


### 9.1 åˆ†é˜¶æ®µå‡çº§ç­–ç•¥


**ğŸ”¸ ä¸‰é˜¶æ®µå‡çº§æ³•**

```
é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰
    â”œâ”€â”€ ç¯å¢ƒæ£€æŸ¥
    â”œâ”€â”€ ä¾èµ–åˆ†æ
    â”œâ”€â”€ æµ‹è¯•ç¯å¢ƒæ­å»º
    â””â”€â”€ åŸ¹è®­å¼€å‘å›¢é˜Ÿ

é˜¶æ®µäºŒï¼šè¯•ç‚¹é˜¶æ®µï¼ˆ2-3å‘¨ï¼‰
    â”œâ”€â”€ é€‰æ‹©ä½é£é™©æ¨¡å—
    â”œâ”€â”€ å°èŒƒå›´å‡çº§æµ‹è¯•
    â”œâ”€â”€ æ”¶é›†é—®é¢˜åé¦ˆ
    â””â”€â”€ ä¼˜åŒ–å‡çº§æ–¹æ¡ˆ

é˜¶æ®µä¸‰ï¼šå…¨é¢å‡çº§ï¼ˆ1-2å‘¨ï¼‰
    â”œâ”€â”€ å…¨é‡ä»£ç è¿ç§»
    â”œâ”€â”€ å®Œæ•´æµ‹è¯•éªŒè¯
    â”œâ”€â”€ ç°åº¦å‘å¸ƒä¸Šçº¿
    â””â”€â”€ ç›‘æ§ä¸ä¼˜åŒ–
```

### 9.2 å‡çº§å®æ–½æ­¥éª¤


**ğŸ“‹ è¯¦ç»†æ“ä½œæ­¥éª¤**

**1ï¸âƒ£ ä¾èµ–ç‰ˆæœ¬å‡çº§**

```xml
<!-- pom.xml å‡çº§æ­¥éª¤ -->

<!-- ç¬¬1æ­¥ï¼šå‡çº§Hibernateç‰ˆæœ¬ -->
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-core</artifactId>
    <version>6.2.0.Final</version>  <!-- 5.x â†’ 6.x -->
</dependency>

<!-- ç¬¬2æ­¥ï¼šå‡çº§JPAç‰ˆæœ¬ -->
<dependency>
    <groupId>jakarta.persistence</groupId>
    <artifactId>jakarta.persistence-api</artifactId>
    <version>3.1.0</version>  <!-- æ³¨æ„ï¼šåŒ…åä»javaxæ”¹ä¸ºjakarta -->
</dependency>

<!-- ç¬¬3æ­¥ï¼šæ£€æŸ¥Springç‰ˆæœ¬å…¼å®¹æ€§ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
    <version>3.0.0</version>  <!-- ç¡®ä¿æ”¯æŒHibernate 6 -->
</dependency>
```

**2ï¸âƒ£ åŒ…åæ‰¹é‡æ›¿æ¢**

```bash
# ä½¿ç”¨IDEæˆ–å‘½ä»¤è¡Œæ‰¹é‡æ›¿æ¢


# javax.persistence â†’ jakarta.persistence

find . -type f -name "*.java" -exec sed -i 's/javax.persistence/jakarta.persistence/g' {} +

# Hibernateç‰¹å®šåŒ…åï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰

# ç¤ºä¾‹ï¼šæ—§CriteriaåŒ…è·¯å¾„æ›¿æ¢

```

**3ï¸âƒ£ ä»£ç é€æ­¥é€‚é…**

```java
// ğŸ”¸ é€‚é…æ£€æŸ¥æ¸…å•

// âœ… ç¬¬1é¡¹ï¼šå®ä½“ç±»æ³¨è§£æ£€æŸ¥
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // ç§»é™¤@Typeæ³¨è§£ï¼Œä½¿ç”¨@Lobæˆ–@Convert
}

// âœ… ç¬¬2é¡¹ï¼šæŸ¥è¯¢ä»£ç æ”¹é€ 
// å°†Criteriaæ”¹ä¸ºHQLæˆ–JPA Criteria

// âœ… ç¬¬3é¡¹ï¼šé…ç½®å±æ€§æ›´æ–°
// æ£€æŸ¥hibernate.propertiesä¸­çš„åºŸå¼ƒå±æ€§
```

### 9.3 ç°åº¦å‘å¸ƒæ–¹æ¡ˆ


**ğŸ”¸ ç°åº¦å‘å¸ƒæµç¨‹å›¾**

```
ç”¨æˆ·æµé‡
    â†“
è´Ÿè½½å‡è¡¡å™¨
    â”œâ”€â”€ 10% â†’ Hibernate 6.xæœåŠ¡å™¨ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
    â””â”€â”€ 90% â†’ Hibernate 5.xæœåŠ¡å™¨ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
             â†“
          è§‚å¯Ÿæ–°ç‰ˆæœ¬ç¨³å®šæ€§
             â†“
          é€æ­¥å¢åŠ æ–°ç‰ˆæœ¬æµé‡æ¯”ä¾‹
          20% â†’ 50% â†’ 100%
```

**å®æ–½è¦ç‚¹**ï¼š
- ğŸ¯ ä»å°‘é‡ç”¨æˆ·å¼€å§‹ï¼Œé€æ­¥æ‰©å¤§èŒƒå›´
- ğŸ“Š å¯†åˆ‡ç›‘æ§é”™è¯¯ç‡ã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡
- ğŸ”„ å‘ç°é—®é¢˜ç«‹å³å›æ»šåˆ°æ—§ç‰ˆæœ¬
- â±ï¸ æ¯ä¸ªé˜¶æ®µè‡³å°‘ç¨³å®šè¿è¡Œ24å°æ—¶

### 9.4 ç›‘æ§ä¸ä¼˜åŒ–


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**

```
æ€§èƒ½æŒ‡æ ‡
â”œâ”€â”€ SQLæ‰§è¡Œæ—¶é—´ï¼ˆå¯¹æ¯”å‡çº§å‰åï¼‰
â”œâ”€â”€ æ•°æ®åº“è¿æ¥æ•°
â”œâ”€â”€ å†…å­˜ä½¿ç”¨æƒ…å†µ
â””â”€â”€ æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡

ä¸šåŠ¡æŒ‡æ ‡  
â”œâ”€â”€ æ¥å£å“åº”æ—¶é—´
â”œâ”€â”€ é”™è¯¯ç‡ç»Ÿè®¡
â”œâ”€â”€ å¹¶å‘ç”¨æˆ·æ•°
â””â”€â”€ äº‹åŠ¡æˆåŠŸç‡

ç³»ç»ŸæŒ‡æ ‡
â”œâ”€â”€ CPUä½¿ç”¨ç‡
â”œâ”€â”€ JVMå †å†…å­˜
â”œâ”€â”€ GCé¢‘ç‡å’Œæ—¶é•¿
â””â”€â”€ çº¿ç¨‹æ± çŠ¶æ€
```

**ä¼˜åŒ–å»ºè®®**ï¼š
```properties
# å‡çº§åæ€§èƒ½è°ƒä¼˜é…ç½®ç¤ºä¾‹


# è¿æ¥æ± ä¼˜åŒ–

hibernate.connection.pool_size=20
hibernate.c3p0.min_size=5
hibernate.c3p0.max_size=20

# æ‰¹å¤„ç†ä¼˜åŒ–

hibernate.jdbc.batch_size=50
hibernate.order_inserts=true
hibernate.order_updates=true

# æŸ¥è¯¢ä¼˜åŒ–

hibernate.query.plan_cache_max_size=2048
hibernate.query.plan_parameter_metadata_max_size=128
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å‡çº§å…³é”®æ­¥éª¤å›é¡¾


**ğŸ¯ å‡çº§æ ¸å¿ƒæµç¨‹**

```
å‡çº§å‰å‡†å¤‡
    â†’ ç¯å¢ƒæ£€æŸ¥ + ä¾èµ–åˆ†æ + å¤‡ä»½
    â†“
é…ç½®æ–‡ä»¶è¿ç§»  
    â†’ å±æ€§æ›´æ–° + æ–¹è¨€ä¿®æ”¹
    â†“
ä»£ç é€‚é…æ”¹é€ 
    â†’ APIæ›¿æ¢ + æ³¨è§£è°ƒæ•´
    â†“
æµ‹è¯•éªŒè¯
    â†’ åŠŸèƒ½æµ‹è¯• + æ€§èƒ½æµ‹è¯• + å…¼å®¹æ€§æµ‹è¯•
    â†“
åˆ†é˜¶æ®µä¸Šçº¿
    â†’ ç°åº¦å‘å¸ƒ + ç›‘æ§ä¼˜åŒ–
    â†“
å®Œæˆå‡çº§ âœ…
```

### 10.2 å¿…é¡»è®°ä½çš„è¦ç‚¹


> ğŸ§  **å‡çº§è®°å¿†å£è¯€**
> 
> å‡†å¤‡å·¥ä½œè¦å……åˆ†ï¼Œå¤‡ä»½å›æ»šæ˜¯ä¿é™©  
> é…ç½®è¿ç§»çœ‹æ–‡æ¡£ï¼ŒAPIå˜æ›´è¦é€‚é…  
> æµ‹è¯•éªŒè¯è¦å…¨é¢ï¼Œç°åº¦å‘å¸ƒä¿å¹³ç¨³  
> ç›‘æ§ä¼˜åŒ–ä¸èƒ½åœï¼Œé—®é¢˜å¤„ç†è¦åŠæ—¶

**ğŸ”¸ æ ¸å¿ƒæ³¨æ„äº‹é¡¹**

1. **Javaç‰ˆæœ¬**ï¼šHibernate 6.x æœ€ä½éœ€è¦Java 11
2. **åŒ…åå˜æ›´**ï¼š`javax.persistence` â†’ `jakarta.persistence`
3. **APIåºŸå¼ƒ**ï¼šæ—§Criteria APIå¿…é¡»æ›¿æ¢
4. **é…ç½®ç®€åŒ–**ï¼šæ•°æ®åº“æ–¹è¨€å»æ‰ç‰ˆæœ¬å·
5. **ç±»å‹æ˜ å°„**ï¼šä½¿ç”¨`@Lob`æˆ–`@Convert`æ›¿ä»£`@Type`

### 10.3 å‡çº§æ”¶ç›Šè¯„ä¼°


**âœ… å‡çº§åçš„å¥½å¤„**

```
æ€§èƒ½æå‡ï¼š
â””â”€â”€ æŸ¥è¯¢ä¼˜åŒ–ï¼šSQLç”Ÿæˆæ›´é«˜æ•ˆ
â””â”€â”€ å†…å­˜ä¼˜åŒ–ï¼šå¯¹è±¡ç®¡ç†æ›´æ™ºèƒ½
â””â”€â”€ å¹¶å‘æå‡ï¼šé”æœºåˆ¶æ”¹è¿›

åŠŸèƒ½å¢å¼ºï¼š
â””â”€â”€ HQLå¢å¼ºï¼šæ”¯æŒæ›´å¤šSQLç‰¹æ€§
â””â”€â”€ ç±»å‹ç³»ç»Ÿï¼šæ›´å¼ºå¤§çš„ç±»å‹æ˜ å°„
â””â”€â”€ JPAå…¼å®¹ï¼šæ›´ç¬¦åˆæ ‡å‡†è§„èŒƒ

ç”Ÿæ€æ”¯æŒï¼š
â””â”€â”€ ç¤¾åŒºæ´»è·ƒï¼šé—®é¢˜è§£å†³æ›´å¿«
â””â”€â”€ é•¿æœŸç»´æŠ¤ï¼šæŒç»­æ›´æ–°æ”¯æŒ
â””â”€â”€ æŠ€æœ¯å‰æ²¿ï¼šä½¿ç”¨æœ€æ–°æŠ€æœ¯
```

**ğŸ“Š é£é™©ä¸æ”¶ç›Šæƒè¡¡**

| è€ƒè™‘å› ç´  | **åšæŒ5.x** | **å‡çº§6.x** |
|---------|-----------|-----------|
| ç¨³å®šæ€§ | `ğŸŸ¢ é«˜ï¼ˆæˆç†Ÿï¼‰` | `ğŸŸ¡ ä¸­ï¼ˆéœ€æµ‹è¯•ï¼‰` |
| æ€§èƒ½ | `ğŸŸ¡ ä¸­` | `ğŸŸ¢ é«˜ï¼ˆä¼˜åŒ–ï¼‰` |
| æ–°ç‰¹æ€§ | `ğŸ”´ æ— ` | `ğŸŸ¢ ä¸°å¯Œ` |
| ç»´æŠ¤æˆæœ¬ | `ğŸŸ¡ æ—§é—®é¢˜å·²çŸ¥` | `ğŸŸ¡ æ–°é—®é¢˜å­¦ä¹ ` |
| é•¿æœŸæ”¯æŒ | `ğŸ”´ é€æ­¥åœæ­¢` | `ğŸŸ¢ æŒç»­æ›´æ–°` |

### 10.4 åç»­å­¦ä¹ æ–¹å‘


**ğŸ”— æ‰©å±•å­¦ä¹ å»ºè®®**

```
æ·±å…¥å­¦ä¹ Hibernate 6.xæ–°ç‰¹æ€§
    â”œâ”€â”€ æ–°ç±»å‹ç³»ç»Ÿè¯¦è§£
    â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–æŠ€å·§
    â”œâ”€â”€ é«˜çº§æŸ¥è¯¢åŠŸèƒ½
    â””â”€â”€ ä¸Spring 6é›†æˆ

ç›¸å…³æŠ€æœ¯æ‹“å±•
    â”œâ”€â”€ JPA 3.0è§„èŒƒå­¦ä¹ 
    â”œâ”€â”€ Jakarta EEç”Ÿæ€äº†è§£
    â”œâ”€â”€ æ•°æ®åº“è°ƒä¼˜æŠ€å·§
    â””â”€â”€ å¾®æœåŠ¡æ¶æ„ä¸­çš„ORMé€‰å‹
```

---

**æ ¸å¿ƒå‡çº§åŸåˆ™**ï¼š
- âš¡ å‡çº§ä¸æ˜¯ç›®çš„ï¼Œç¨³å®šè¿è¡Œæ‰æ˜¯å…³é”®
- ğŸ§ª å……åˆ†æµ‹è¯•éªŒè¯ï¼Œä¸æ‰“æ— å‡†å¤‡ä¹‹ä»—
- ğŸ“ˆ ç›‘æ§æ•°æ®è¯´è¯ï¼Œç”¨æ•°æ®æŒ‡å¯¼å†³ç­–
- ğŸ”„ ä¿æŒæ•¬ç•ä¹‹å¿ƒï¼Œéšæ—¶å‡†å¤‡å›æ»šæ–¹æ¡ˆ