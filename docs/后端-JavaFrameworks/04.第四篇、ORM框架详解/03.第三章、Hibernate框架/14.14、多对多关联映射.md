---
title: 14ã€å¤šå¯¹å¤šå…³è”æ˜ å°„
---
## ğŸ“š ç›®å½•

1. [å¤šå¯¹å¤šå…³ç³»çš„æœ¬è´¨ç†è§£](#1-å¤šå¯¹å¤šå…³ç³»çš„æœ¬è´¨ç†è§£)
2. [ManyToManyæ³¨è§£è¯¦è§£](#2-ManyToManyæ³¨è§£è¯¦è§£)
3. [JoinTableä¸­é—´è¡¨é…ç½®](#3-JoinTableä¸­é—´è¡¨é…ç½®)
4. [å•å‘å¤šå¯¹å¤šæ˜ å°„](#4-å•å‘å¤šå¯¹å¤šæ˜ å°„)
5. [åŒå‘å¤šå¯¹å¤šæ˜ å°„](#5-åŒå‘å¤šå¯¹å¤šæ˜ å°„)
6. [ä¸­é—´è¡¨è®¾è®¡ç­–ç•¥](#6-ä¸­é—´è¡¨è®¾è®¡ç­–ç•¥)
7. [çº§è”æ“ä½œä¸åˆ é™¤ç­–ç•¥](#7-çº§è”æ“ä½œä¸åˆ é™¤ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— å¤šå¯¹å¤šå…³ç³»çš„æœ¬è´¨ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯å¤šå¯¹å¤šå…³ç³»


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
å­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿï¼š
- ä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰å¤šé—¨è¯¾ç¨‹ï¼ˆå­¦ç”Ÿ â†’ å¤šä¸ªè¯¾ç¨‹ï¼‰
- ä¸€é—¨è¯¾ç¨‹å¯ä»¥è¢«å¤šä¸ªå­¦ç”Ÿé€‰æ‹©ï¼ˆè¯¾ç¨‹ â†’ å¤šä¸ªå­¦ç”Ÿï¼‰
è¿™å°±æ˜¯å…¸å‹çš„å¤šå¯¹å¤šå…³ç³»ï¼

å†æ¯”å¦‚ï¼š
- æ¼”å‘˜å’Œç”µå½±ï¼šä¸€ä¸ªæ¼”å‘˜æ¼”å¤šéƒ¨ç”µå½±ï¼Œä¸€éƒ¨ç”µå½±æœ‰å¤šä¸ªæ¼”å‘˜
- ç”¨æˆ·å’Œè§’è‰²ï¼šä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²åˆ†é…ç»™å¤šä¸ªç”¨æˆ·
```

**å…³é”®ç†è§£**ï¼š
> ğŸ’¡ **å¤šå¯¹å¤šçš„æœ¬è´¨**ï¼šä¸¤ä¸ªå®ä½“ä¹‹é—´æ˜¯"åŒå‘çš„ä¸€å¯¹å¤š"å…³ç³»ï¼ŒAå¯ä»¥å…³è”å¤šä¸ªBï¼ŒBä¹Ÿå¯ä»¥å…³è”å¤šä¸ªA

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸­é—´è¡¨


**é—®é¢˜åœºæ™¯**ï¼š
```
å¦‚æœç›´æ¥åœ¨å­¦ç”Ÿè¡¨å­˜å‚¨è¯¾ç¨‹ä¿¡æ¯ï¼š

å­¦ç”Ÿè¡¨ï¼ˆâŒ é”™è¯¯è®¾è®¡ï¼‰ï¼š
å­¦ç”ŸID | å­¦ç”Ÿå | è¯¾ç¨‹åˆ—è¡¨
1     | å¼ ä¸‰   | æ•°å­¦,è‹±è¯­,ç‰©ç†  â† è¿åæ•°æ®åº“èŒƒå¼ï¼

é—®é¢˜ï¼š
1. è¯¾ç¨‹ä¿¡æ¯æ— æ³•è§„èŒƒå­˜å‚¨
2. æŸ¥è¯¢å’Œä¿®æ”¹å›°éš¾
3. æ•°æ®å†—ä½™ä¸¥é‡
```

**æ­£ç¡®è®¾è®¡**ï¼š
```
å­¦ç”Ÿè¡¨ï¼š           ä¸­é—´è¡¨ï¼š              è¯¾ç¨‹è¡¨ï¼š
å­¦ç”ŸID | å­¦ç”Ÿå    å­¦ç”ŸID | è¯¾ç¨‹ID       è¯¾ç¨‹ID | è¯¾ç¨‹å
1     | å¼ ä¸‰      1     | 101          101   | æ•°å­¦
2     | æå››      1     | 102          102   | è‹±è¯­
                 1     | 103          103   | ç‰©ç†
                 2     | 101

é€šè¿‡ä¸­é—´è¡¨å»ºç«‹å¤šå¯¹å¤šå…³ç³»ï¼
```

> âš ï¸ **æ ¸å¿ƒåŸåˆ™**ï¼šæ•°æ®åº“æ— æ³•ç›´æ¥è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»ï¼Œå¿…é¡»é€šè¿‡ç¬¬ä¸‰å¼ è¡¨ï¼ˆä¸­é—´è¡¨/å…³è”è¡¨ï¼‰æ¥å®ç°

### 1.3 ORMæ¡†æ¶çš„ä½œç”¨


**æ²¡æœ‰ORMçš„ç—›è‹¦**ï¼š
```java
// æ‰‹å†™SQLæŸ¥è¯¢å­¦ç”Ÿé€‰çš„è¯¾ç¨‹
String sql = "SELECT c.* FROM course c " +
             "JOIN student_course sc ON c.id = sc.course_id " +
             "WHERE sc.student_id = ?";
// è¿˜è¦æ‰‹åŠ¨å¤„ç†ç»“æœé›†...å¤ªéº»çƒ¦ï¼
```

**æœ‰äº†Hibernate**ï¼š
```java
// ç›´æ¥é€šè¿‡å¯¹è±¡å…³ç³»è·å–
Student student = session.get(Student.class, 1L);
Set<Course> courses = student.getCourses(); // è‡ªåŠ¨æŸ¥è¯¢ï¼
```

> âœ… **Hibernateçš„ä»·å€¼**ï¼šå¸®ä½ è‡ªåŠ¨ç®¡ç†ä¸­é—´è¡¨ï¼Œè®©ä½ åªå…³æ³¨å¯¹è±¡å…³ç³»ï¼Œä¸ç”¨å†™å¤æ‚SQL

---

## 2. ğŸ“Œ ManyToManyæ³¨è§£è¯¦è§£


### 2.1 æ³¨è§£åŸºæœ¬ç”¨æ³•


**@ManyToManyæ ¸å¿ƒå±æ€§**ï¼š

| å±æ€§ | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|------|------|--------|------|
| **cascade** | çº§è”æ“ä½œç±»å‹ | æ—  | `CascadeType.PERSIST` |
| **fetch** | åŠ è½½ç­–ç•¥ | `LAZY` | `FetchType.EAGER` |
| **mappedBy** | å…³ç³»ç»´æŠ¤æ–¹ | æ—  | `"students"` |
| **targetEntity** | ç›®æ ‡å®ä½“ç±» | è‡ªåŠ¨æ¨æ–­ | `Course.class` |

### 2.2 æ ¸å¿ƒæ¦‚å¿µè§£é‡Š


**çº§è”æ“ä½œï¼ˆCascadeï¼‰**ï¼š
> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå½“ä½ å¯¹ä¸»å®ä½“åšæ“ä½œæ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨å¯¹å…³è”å®ä½“åšåŒæ ·æ“ä½œ

```
ä¾‹å­ï¼šä¿å­˜å­¦ç”Ÿæ—¶æ˜¯å¦è‡ªåŠ¨ä¿å­˜ä»–é€‰çš„è¯¾ç¨‹ï¼Ÿ
- CascadeType.PERSISTï¼šä¿å­˜å­¦ç”Ÿæ—¶è‡ªåŠ¨ä¿å­˜æ–°è¯¾ç¨‹
- CascadeType.REMOVEï¼šåˆ é™¤å­¦ç”Ÿæ—¶è‡ªåŠ¨åˆ é™¤å…³è”ï¼ˆå±é™©ï¼ï¼‰
- CascadeType.ALLï¼šæ‰€æœ‰æ“ä½œéƒ½çº§è”
```

**åŠ è½½ç­–ç•¥ï¼ˆFetchï¼‰**ï¼š
> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šæŸ¥è¯¢ä¸»å®ä½“æ—¶ï¼Œå…³è”æ•°æ®æ˜¯ç«‹å³åŠ è½½è¿˜æ˜¯ç”¨åˆ°æ—¶å†åŠ è½½

```
- LAZYï¼ˆæ‡’åŠ è½½ï¼‰ï¼šé»˜è®¤ï¼Œç”¨åˆ°è¯¾ç¨‹æ•°æ®æ—¶æ‰æŸ¥è¯¢
  ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼Œä¸æµªè´¹
  ç¼ºç‚¹ï¼šsessionå…³é—­åæ— æ³•è®¿é—®
  
- EAGERï¼ˆç«‹å³åŠ è½½ï¼‰ï¼šæŸ¥å­¦ç”Ÿæ—¶ç«‹å³æŸ¥å‡ºæ‰€æœ‰è¯¾ç¨‹
  ä¼˜ç‚¹ï¼šæ•°æ®éƒ½åœ¨ï¼Œéšæ—¶èƒ½ç”¨
  ç¼ºç‚¹ï¼šå¯èƒ½æµªè´¹æ€§èƒ½
```

**å…³ç³»ç»´æŠ¤æ–¹ï¼ˆmappedByï¼‰**ï¼š
> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šåœ¨åŒå‘å…³ç³»ä¸­ï¼Œè°è´Ÿè´£ç®¡ç†ä¸­é—´è¡¨ï¼Ÿ

```
åŒå‘å…³ç³»ä¸­å¿…é¡»æŒ‡å®šä¸€æ–¹ä¸º"è¢«ç»´æŠ¤æ–¹"ï¼š
- ç»´æŠ¤æ–¹ï¼šè´Ÿè´£æ›´æ–°ä¸­é—´è¡¨ï¼ˆå†™@JoinTableï¼‰
- è¢«ç»´æŠ¤æ–¹ï¼šåªè¯»å…³ç³»ï¼ˆå†™mappedByï¼‰

ç±»æ¯”ï¼šå¤«å¦»å…±åŒè´¦æˆ·ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªäººç®¡è´¦æœ¬ï¼
```

### 2.3 ä½¿ç”¨å»ºè®®


**é€‰æ‹©ç­–ç•¥**ï¼š
```
ğŸ”¸ çº§è”æ“ä½œï¼š
  âœ… æ¨èï¼šCascadeType.PERSIST, MERGEï¼ˆä¿å­˜ã€æ›´æ–°ï¼‰
  âš ï¸ è°¨æ…ï¼šCascadeType.REMOVEï¼ˆå¯èƒ½è¯¯åˆ æ•°æ®ï¼‰
  âŒ é¿å…ï¼šCascadeType.ALLï¼ˆé™¤éæ˜ç¡®éœ€è¦ï¼‰

ğŸ”¸ åŠ è½½ç­–ç•¥ï¼š
  âœ… æ¨èï¼šFetchType.LAZYï¼ˆå¤§éƒ¨åˆ†æƒ…å†µï¼‰
  âš ï¸ è°¨æ…ï¼šFetchType.EAGERï¼ˆæ˜ç¡®éœ€è¦æ—¶æ‰ç”¨ï¼‰

ğŸ”¸ å…³ç³»ç»´æŠ¤ï¼š
  âœ… é€‰ä¸šåŠ¡ä¸»å¯¼æ–¹ä½œä¸ºç»´æŠ¤æ–¹
  âœ… è¢«ç»´æŠ¤æ–¹å¿…é¡»è®¾ç½®mappedBy
```

---

## 3. ğŸ—ƒï¸ JoinTableä¸­é—´è¡¨é…ç½®


### 3.1 JoinTableæ³¨è§£è¯¦è§£


**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š
```java
@ManyToMany
@JoinTable(
    name = "student_course",              // ä¸­é—´è¡¨åç§°
    joinColumns = @JoinColumn(            // å½“å‰å®ä½“çš„å¤–é”®åˆ—
        name = "student_id",
        referencedColumnName = "id"
    ),
    inverseJoinColumns = @JoinColumn(     // å¯¹æ–¹å®ä½“çš„å¤–é”®åˆ—
        name = "course_id",
        referencedColumnName = "id"
    )
)
private Set<Course> courses;
```

**å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | å«ä¹‰ | ä½œç”¨ |
|------|------|------|
| **name** | ä¸­é—´è¡¨è¡¨å | æŒ‡å®šå…³è”è¡¨åœ¨æ•°æ®åº“ä¸­çš„åç§° |
| **joinColumns** | ä¸»è¡¨å¤–é”® | æŒ‡å‘å½“å‰å®ä½“çš„å¤–é”®åˆ—é…ç½® |
| **inverseJoinColumns** | å…³è”è¡¨å¤–é”® | æŒ‡å‘å¯¹æ–¹å®ä½“çš„å¤–é”®åˆ—é…ç½® |

**JoinColumnè¯¦è§£**ï¼š

| å±æ€§ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **name** | å¤–é”®åˆ—å | `"student_id"` |
| **referencedColumnName** | å¼•ç”¨çš„ä¸»é”®åˆ— | `"id"` |
| **nullable** | æ˜¯å¦å¯ç©º | `false` |
| **unique** | æ˜¯å¦å”¯ä¸€ | `false` |

### 3.2 ä¸­é—´è¡¨ç»“æ„ç†è§£


**ç”Ÿæˆçš„è¡¨ç»“æ„**ï¼š
```sql
CREATE TABLE student_course (
    student_id BIGINT NOT NULL,    -- å­¦ç”ŸIDå¤–é”®
    course_id BIGINT NOT NULL,     -- è¯¾ç¨‹IDå¤–é”®
    PRIMARY KEY (student_id, course_id),  -- è”åˆä¸»é”®
    FOREIGN KEY (student_id) REFERENCES student(id),
    FOREIGN KEY (course_id) REFERENCES course(id)
);
```

**å­—æ®µè¯´æ˜**ï¼š
```
ğŸ”¸ student_idï¼šæŒ‡å‘å­¦ç”Ÿè¡¨çš„å¤–é”®
  - NOT NULLï¼šå¿…é¡»æœ‰å€¼
  - ä¸course_idç»„æˆè”åˆä¸»é”®

ğŸ”¸ course_idï¼šæŒ‡å‘è¯¾ç¨‹è¡¨çš„å¤–é”®
  - NOT NULLï¼šå¿…é¡»æœ‰å€¼
  - ä¸student_idç»„æˆè”åˆä¸»é”®

ğŸ”¸ è”åˆä¸»é”®ï¼šä¿è¯åŒä¸€å­¦ç”Ÿä¸ä¼šé‡å¤é€‰åŒä¸€é—¨è¯¾
```

**æ•°æ®ç¤ºä¾‹**ï¼š
```
å­¦ç”Ÿè¡¨ï¼š              ä¸­é—´è¡¨ï¼š               è¯¾ç¨‹è¡¨ï¼š
ID | å§“å            student_id | course_id   ID | è¯¾ç¨‹å
1  | å¼ ä¸‰            1         | 101         101 | æ•°å­¦
2  | æå››            1         | 102         102 | è‹±è¯­
                    2         | 101         103 | ç‰©ç†

å«ä¹‰ï¼šå¼ ä¸‰é€‰äº†æ•°å­¦å’Œè‹±è¯­ï¼Œæå››é€‰äº†æ•°å­¦
```

### 3.3 é…ç½®æœ€ä½³å®è·µ


**å‘½åè§„èŒƒ**ï¼š
```java
// âœ… æ¨èï¼šè¡¨å_è¡¨åæ ¼å¼
@JoinTable(name = "student_course")

// âœ… æ¨èï¼šå­—æ®µå_idæ ¼å¼
joinColumns = @JoinColumn(name = "student_id")

// âŒ é¿å…ï¼šå¤ªé•¿æˆ–ä¸è§„èŒƒçš„åå­—
@JoinTable(name = "t_student_has_course_relationship")
```

**å¤–é”®çº¦æŸ**ï¼š
```java
// ğŸ”¸ æ·»åŠ å¤–é”®çº¦æŸï¼ˆæ¨èï¼‰
@JoinColumn(
    name = "student_id",
    foreignKey = @ForeignKey(name = "fk_student_course_student")
)

// ä½œç”¨ï¼š
// 1. ä¿è¯æ•°æ®å®Œæ•´æ€§
// 2. é˜²æ­¢åˆ é™¤è¢«å¼•ç”¨çš„æ•°æ®
// 3. æ•°æ®åº“çº§åˆ«çš„çº¦æŸä¿æŠ¤
```

---

## 4. ğŸ”€ å•å‘å¤šå¯¹å¤šæ˜ å°„


### 4.1 ä»€ä¹ˆæ˜¯å•å‘å…³è”


**æ¦‚å¿µç†è§£**ï¼š
> ğŸ’¡ **å•å‘å…³è”**ï¼šåªåœ¨ä¸€æ–¹é…ç½®å…³ç³»ï¼Œå¦ä¸€æ–¹ä¸çŸ¥é“è¿™ä¸ªå…³ç³»çš„å­˜åœ¨

```
å•å‘å…³ç³»ç¤ºæ„ï¼š
å­¦ç”Ÿ â”€â”€â”€â”€â†’ è¯¾ç¨‹
    çŸ¥é“é€‰äº†å“ªäº›è¯¾

è¯¾ç¨‹å®ä½“ä¸çŸ¥é“è¢«å“ªäº›å­¦ç”Ÿé€‰äº†
```

**åº”ç”¨åœºæ™¯**ï¼š
```
âœ… é€‚ç”¨æƒ…å†µï¼š
- åªéœ€è¦ä»å­¦ç”ŸæŸ¥è¯¾ç¨‹ï¼Œä¸éœ€è¦ä»è¯¾ç¨‹æŸ¥å­¦ç”Ÿ
- ç®€åŒ–ä»£ç ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬
- å…³ç³»ä¸éœ€è¦åŒå‘å¯¼èˆª

âŒ ä¸é€‚ç”¨ï¼š
- éœ€è¦ä»è¯¾ç¨‹æŸ¥é€‰è¯¾å­¦ç”Ÿ
- éœ€è¦åŒå‘æ“ä½œå…³è”å…³ç³»
```

### 4.2 å®ä½“é…ç½®


**å­¦ç”Ÿå®ä½“ï¼ˆç»´æŠ¤å…³ç³»ï¼‰**ï¼š
```java
@Entity
@Table(name = "student")
public class Student {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @ManyToMany(cascade = CascadeType.PERSIST)
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private Set<Course> courses = new HashSet<>();
    
    // getter/setter...
}
```

**è¯¾ç¨‹å®ä½“ï¼ˆä¸é…ç½®å…³ç³»ï¼‰**ï¼š
```java
@Entity
@Table(name = "course")
public class Course {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String courseName;
    
    // æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰studentsé›†åˆï¼
    
    // getter/setter...
}
```

**é…ç½®è¯´æ˜**ï¼š
```
ğŸ”¸ å­¦ç”Ÿç«¯ï¼š
  - é…ç½®@ManyToMany
  - é…ç½®@JoinTableæŒ‡å®šä¸­é—´è¡¨
  - ä½¿ç”¨Seté›†åˆï¼ˆé¿å…é‡å¤ï¼‰
  
ğŸ”¸ è¯¾ç¨‹ç«¯ï¼š
  - ä¸é…ç½®ä»»ä½•å…³è”æ³¨è§£
  - æ˜¯æ™®é€šå®ä½“
  - ä¸çŸ¥é“å­¦ç”Ÿå…³ç³»
```

### 4.3 æ“ä½œç¤ºä¾‹


**ä¿å­˜å…³è”**ï¼š
```java
// åˆ›å»ºå­¦ç”Ÿå’Œè¯¾ç¨‹
Student student = new Student();
student.setName("å¼ ä¸‰");

Course math = new Course();
math.setCourseName("æ•°å­¦");

Course english = new Course();
english.setCourseName("è‹±è¯­");

// å»ºç«‹å…³è”
student.getCourses().add(math);
student.getCourses().add(english);

// ä¿å­˜ï¼ˆçº§è”ä¿å­˜è¯¾ç¨‹ï¼‰
session.save(student);

// ç”ŸæˆSQLï¼š
// INSERT INTO student...
// INSERT INTO course... (æ•°å­¦)
// INSERT INTO course... (è‹±è¯­)
// INSERT INTO student_course VALUES (student_id, math_id)
// INSERT INTO student_course VALUES (student_id, english_id)
```

**æŸ¥è¯¢å…³è”**ï¼š
```java
// æŸ¥è¯¢å­¦ç”Ÿ
Student student = session.get(Student.class, 1L);

// è·å–é€‰è¯¾ä¿¡æ¯
Set<Course> courses = student.getCourses();
for (Course course : courses) {
    System.out.println(course.getCourseName());
}

// ç”ŸæˆSQLï¼š
// SELECT * FROM student WHERE id = 1
// SELECT * FROM course c JOIN student_course sc 
//   ON c.id = sc.course_id WHERE sc.student_id = 1
```

**åˆ é™¤å…³è”**ï¼š
```java
// å–æ¶ˆé€‰è¯¾
student.getCourses().remove(math);
session.update(student);

// ç”ŸæˆSQLï¼š
// DELETE FROM student_course 
//   WHERE student_id = ? AND course_id = ?
```

### 4.4 å•å‘å…³è”çš„é™åˆ¶


**æ— æ³•åå‘æŸ¥è¯¢**ï¼š
```java
// âŒ è¯¾ç¨‹ç«¯æ— æ³•è¿™æ ·æŸ¥è¯¢
Course course = session.get(Course.class, 101L);
// course.getStudents(); // æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼

// âœ… åªèƒ½æ‰‹åŠ¨HQLæŸ¥è¯¢
String hql = "SELECT s FROM Student s " +
             "JOIN s.courses c WHERE c.id = :courseId";
List<Student> students = session.createQuery(hql)
    .setParameter("courseId", 101L)
    .list();
```

**ç»´æŠ¤é™åˆ¶**ï¼š
```java
// âŒ æ— æ³•ä»è¯¾ç¨‹ç«¯æ·»åŠ å­¦ç”Ÿ
Course course = session.get(Course.class, 101L);
// course.addStudent(student); // ä¸å­˜åœ¨ï¼

// âœ… åªèƒ½ä»å­¦ç”Ÿç«¯æ“ä½œ
student.getCourses().add(course);
```

---

## 5. ğŸ”„ åŒå‘å¤šå¯¹å¤šæ˜ å°„


### 5.1 ä»€ä¹ˆæ˜¯åŒå‘å…³è”


**æ¦‚å¿µç†è§£**ï¼š
> ğŸ’¡ **åŒå‘å…³è”**ï¼šä¸¤ä¸ªå®ä½“äº’ç›¸çŸ¥é“å¯¹æ–¹ï¼Œå¯ä»¥ä»ä»»æ„ä¸€æ–¹å¯¼èˆªåˆ°å¦ä¸€æ–¹

```
åŒå‘å…³ç³»ç¤ºæ„ï¼š
å­¦ç”Ÿ â†â”€â”€â”€â†’ è¯¾ç¨‹
    äº’ç›¸çŸ¥é“å¯¹æ–¹

å­¦ç”ŸçŸ¥é“é€‰äº†å“ªäº›è¯¾ï¼Œè¯¾ç¨‹ä¹ŸçŸ¥é“è¢«å“ªäº›å­¦ç”Ÿé€‰
```

**åŒå‘å…³è”çš„å¥½å¤„**ï¼š
```
âœ… çµæ´»æŸ¥è¯¢ï¼šå¯ä»¥ä»ä»»æ„æ–¹å‘æŸ¥è¯¢
âœ… æ“ä½œæ–¹ä¾¿ï¼šä¸¤ç«¯éƒ½èƒ½ç»´æŠ¤å…³ç³»
âœ… ç¬¦åˆä¸šåŠ¡ï¼šæ›´æ¥è¿‘çœŸå®ä¸šåŠ¡åœºæ™¯
```

### 5.2 å®ä½“é…ç½®


**å­¦ç”Ÿå®ä½“ï¼ˆå…³ç³»ç»´æŠ¤æ–¹ï¼‰**ï¼š
```java
@Entity
@Table(name = "student")
public class Student {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE})
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private Set<Course> courses = new HashSet<>();
    
    // ğŸ”¸ ä¾¿æ·æ–¹æ³•ï¼šç»´æŠ¤åŒå‘å…³ç³»
    public void addCourse(Course course) {
        this.courses.add(course);
        course.getStudents().add(this);
    }
    
    public void removeCourse(Course course) {
        this.courses.remove(course);
        course.getStudents().remove(this);
    }
}
```

**è¯¾ç¨‹å®ä½“ï¼ˆè¢«ç»´æŠ¤æ–¹ï¼‰**ï¼š
```java
@Entity
@Table(name = "course")
public class Course {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String courseName;
    
    @ManyToMany(mappedBy = "courses")  // ğŸ”¸ å…³é”®ï¼šæŒ‡å®šè¢«ç»´æŠ¤
    private Set<Student> students = new HashSet<>();
    
    // getter/setter...
}
```

**å…³é”®é…ç½®è¯´æ˜**ï¼š
```
ğŸ”¸ ç»´æŠ¤æ–¹ï¼ˆStudentï¼‰ï¼š
  - é…ç½®@JoinTable
  - è´Ÿè´£æ›´æ–°ä¸­é—´è¡¨
  - æ˜¯å…³ç³»çš„"ä¸»äºº"

ğŸ”¸ è¢«ç»´æŠ¤æ–¹ï¼ˆCourseï¼‰ï¼š
  - ä½¿ç”¨mappedByæŒ‡å‘ç»´æŠ¤æ–¹çš„å±æ€§å
  - åªè¯»å…³ç³»ï¼Œä¸èƒ½ç›´æ¥æ›´æ–°ä¸­é—´è¡¨
  - æ˜¯å…³ç³»çš„"ä»å±æ–¹"

âš ï¸ é‡è¦ï¼šmappedByçš„å€¼æ˜¯å¯¹æ–¹ç±»ä¸­é›†åˆå±æ€§çš„åå­—ï¼
```

### 5.3 å…³ç³»ç»´æŠ¤è¯¦è§£


**ä¸ºä»€ä¹ˆéœ€è¦ä¾¿æ·æ–¹æ³•**ï¼š
```java
// âŒ é”™è¯¯åšæ³•ï¼šåªç»´æŠ¤ä¸€ç«¯
student.getCourses().add(course);
session.save(student);
// é—®é¢˜ï¼šcourseç«¯çš„studentsé›†åˆä¸åŒæ­¥ï¼

// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ä¾¿æ·æ–¹æ³•ç»´æŠ¤åŒç«¯
student.addCourse(course);
session.save(student);
// ä¸¤ç«¯éƒ½åŒæ­¥äº†ï¼
```

**ä¾¿æ·æ–¹æ³•æ¨¡æ¿**ï¼š
```java
// æ·»åŠ å…³è”
public void addCourse(Course course) {
    this.courses.add(course);        // ç»´æŠ¤æœ¬ç«¯
    course.getStudents().add(this);  // åŒæ­¥å¯¹ç«¯
}

// åˆ é™¤å…³è”
public void removeCourse(Course course) {
    this.courses.remove(course);
    course.getStudents().remove(this);
}
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šæ°¸è¿œé€šè¿‡ä¾¿æ·æ–¹æ³•æ“ä½œå…³è”ï¼Œä¿è¯åŒç«¯åŒæ­¥

### 5.4 æ“ä½œç¤ºä¾‹


**åŒå‘ä¿å­˜**ï¼š
```java
Student student = new Student();
student.setName("å¼ ä¸‰");

Course math = new Course();
math.setCourseName("æ•°å­¦");

// ä½¿ç”¨ä¾¿æ·æ–¹æ³•å»ºç«‹å…³è”
student.addCourse(math);

// åªéœ€ä¿å­˜ç»´æŠ¤æ–¹
session.save(student);

// Hibernateè‡ªåŠ¨ï¼š
// 1. ä¿å­˜student
// 2. çº§è”ä¿å­˜math
// 3. åœ¨ä¸­é—´è¡¨æ’å…¥å…³è”è®°å½•
```

**åŒå‘æŸ¥è¯¢**ï¼š
```java
// ä»å­¦ç”ŸæŸ¥è¯¾ç¨‹
Student student = session.get(Student.class, 1L);
Set<Course> courses = student.getCourses();

// ä»è¯¾ç¨‹æŸ¥å­¦ç”Ÿï¼ˆåŒå‘å…³ç³»æ‰èƒ½åšåˆ°ï¼ï¼‰
Course course = session.get(Course.class, 101L);
Set<Student> students = course.getStudents();
```

**åˆ é™¤å…³è”**ï¼š
```java
// ä½¿ç”¨ä¾¿æ·æ–¹æ³•åˆ é™¤
student.removeCourse(math);
session.update(student);

// ä¸­é—´è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä¸¤ç«¯éƒ½åŒæ­¥
```

### 5.5 å¸¸è§é—®é¢˜


**é—®é¢˜1ï¼šmappedByé…ç½®é”™è¯¯**
```java
// âŒ é”™è¯¯
@ManyToMany(mappedBy = "course")  // ç±»åï¼
// âœ… æ­£ç¡®
@ManyToMany(mappedBy = "courses") // é›†åˆå±æ€§åï¼
```

**é—®é¢˜2ï¼šå¿˜è®°ç»´æŠ¤åŒç«¯**
```java
// âŒ å±é™©
student.getCourses().add(course);
// course.getStudents()ä¸åŒ…å«studentï¼

// âœ… å®‰å…¨
student.addCourse(course);
```

**é—®é¢˜3ï¼šçº§è”åˆ é™¤è¯¯ç”¨**
```java
// âŒ å±é™©ï¼šåˆ é™¤å­¦ç”Ÿä¼šåˆ é™¤è¯¾ç¨‹ï¼
@ManyToMany(cascade = CascadeType.ALL)

// âœ… å®‰å…¨ï¼šåªçº§è”ä¿å­˜å’Œæ›´æ–°
@ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE})
```

---

## 6. ğŸ—ï¸ ä¸­é—´è¡¨è®¾è®¡ç­–ç•¥


### 6.1 åŸºç¡€ä¸­é—´è¡¨è®¾è®¡


**æ ‡å‡†è®¾è®¡**ï¼š
```sql
CREATE TABLE student_course (
    student_id BIGINT NOT NULL,
    course_id BIGINT NOT NULL,
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES student(id),
    FOREIGN KEY (course_id) REFERENCES course(id)
);
```

**è®¾è®¡è¦ç‚¹**ï¼š
```
ğŸ”¸ è”åˆä¸»é”®ï¼š
  - ç”±ä¸¤ä¸ªå¤–é”®ç»„æˆ
  - è‡ªåŠ¨ä¿è¯å”¯ä¸€æ€§
  - é˜²æ­¢é‡å¤å…³è”

ğŸ”¸ å¤–é”®çº¦æŸï¼š
  - ä¿è¯å¼•ç”¨å®Œæ•´æ€§
  - é˜²æ­¢è„æ•°æ®
  - çº§è”åˆ é™¤éœ€è°¨æ…
```

### 6.2 æ‰©å±•å­—æ®µè®¾è®¡


**ä¸šåŠ¡éœ€æ±‚**ï¼š
```
é€‰è¯¾ç³»ç»Ÿå¯èƒ½éœ€è¦é¢å¤–ä¿¡æ¯ï¼š
- é€‰è¯¾æ—¶é—´
- æˆç»©
- é€‰è¯¾çŠ¶æ€
```

**æ‰©å±•è¡¨è®¾è®¡**ï¼š
```sql
CREATE TABLE student_course (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,  -- ç‹¬ç«‹ä¸»é”®
    student_id BIGINT NOT NULL,
    course_id BIGINT NOT NULL,
    enroll_date DATE,                      -- é€‰è¯¾æ—¶é—´
    score DECIMAL(5,2),                    -- æˆç»©
    status VARCHAR(20),                    -- çŠ¶æ€
    UNIQUE KEY uk_student_course (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES student(id),
    FOREIGN KEY (course_id) REFERENCES course(id)
);
```

**å®ä½“å»ºæ¨¡**ï¼š
```java
// éœ€è¦åˆ›å»ºç‹¬ç«‹çš„å…³è”å®ä½“
@Entity
@Table(name = "student_course")
public class Enrollment {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "student_id")
    private Student student;
    
    @ManyToOne
    @JoinColumn(name = "course_id")
    private Course course;
    
    @Column(name = "enroll_date")
    private LocalDate enrollDate;
    
    private BigDecimal score;
    
    private String status;
}
```

> âš ï¸ **æ³¨æ„**ï¼šä¸€æ—¦ä¸­é—´è¡¨æœ‰é¢å¤–å­—æ®µï¼Œå°±ä¸èƒ½ç”¨@ManyToManyäº†ï¼Œè¦æ”¹æˆä¸¤ä¸ª@ManyToOneï¼

### 6.3 è®¾è®¡é€‰æ‹©å»ºè®®


**ç®€å•å…³è”ç”¨@ManyToMany**ï¼š
```
âœ… é€‚ç”¨åœºæ™¯ï¼š
- ä¸­é—´è¡¨åªæœ‰ä¸¤ä¸ªå¤–é”®
- ä¸éœ€è¦é¢å¤–å­—æ®µ
- å…³ç³»ç®€å•çº¯ç²¹

ç¤ºä¾‹ï¼šç”¨æˆ·-è§’è‰²ï¼Œæ ‡ç­¾-æ–‡ç« 
```

**å¤æ‚å…³è”ç”¨ç‹¬ç«‹å®ä½“**ï¼š
```
âœ… é€‚ç”¨åœºæ™¯ï¼š
- éœ€è¦è®°å½•å…³è”æ—¶é—´
- éœ€è¦è®°å½•é¢å¤–å±æ€§
- å…³è”æœ¬èº«æœ‰ä¸šåŠ¡å«ä¹‰

ç¤ºä¾‹ï¼šå­¦ç”Ÿ-è¯¾ç¨‹ï¼ˆå«æˆç»©ï¼‰ï¼Œè®¢å•-å•†å“ï¼ˆå«æ•°é‡ï¼‰
```

### 6.4 ç´¢å¼•ä¼˜åŒ–


**å¿…è¦ç´¢å¼•**ï¼š
```sql
-- å¤–é”®åˆ—ç´¢å¼•ï¼ˆæå‡å…³è”æŸ¥è¯¢æ€§èƒ½ï¼‰
CREATE INDEX idx_student_course_student ON student_course(student_id);
CREATE INDEX idx_student_course_course ON student_course(course_id);

-- è”åˆç´¢å¼•ï¼ˆä¼˜åŒ–ç‰¹å®šæŸ¥è¯¢ï¼‰
CREATE INDEX idx_student_course_both ON student_course(student_id, course_id);
```

**ç´¢å¼•ç­–ç•¥**ï¼š
```
ğŸ”¸ å¤–é”®åˆ—å¿…é¡»åŠ ç´¢å¼•
ğŸ”¸ å¸¸ç”¨æŸ¥è¯¢æ¡ä»¶åŠ ç´¢å¼•
ğŸ”¸ é¿å…è¿‡å¤šç´¢å¼•å½±å“å†™å…¥æ€§èƒ½
ğŸ”¸ å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
```

---

## 7. ğŸ”§ çº§è”æ“ä½œä¸åˆ é™¤ç­–ç•¥


### 7.1 çº§è”æ“ä½œç±»å‹


**CascadeTypeè¯¦è§£**ï¼š

| ç±»å‹ | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ | é£é™©ç­‰çº§ |
|------|------|----------|----------|
| **PERSIST** | çº§è”ä¿å­˜ | ä¿å­˜ä¸»å®ä½“æ—¶ä¿å­˜å…³è”å®ä½“ | âœ… ä½ |
| **MERGE** | çº§è”æ›´æ–° | æ›´æ–°ä¸»å®ä½“æ—¶æ›´æ–°å…³è”å®ä½“ | âœ… ä½ |
| **REMOVE** | çº§è”åˆ é™¤ | åˆ é™¤ä¸»å®ä½“æ—¶åˆ é™¤å…³è”å®ä½“ | âš ï¸ é«˜ |
| **REFRESH** | çº§è”åˆ·æ–° | åˆ·æ–°ä¸»å®ä½“æ—¶åˆ·æ–°å…³è”å®ä½“ | âœ… ä½ |
| **DETACH** | çº§è”åˆ†ç¦» | åˆ†ç¦»ä¸»å®ä½“æ—¶åˆ†ç¦»å…³è”å®ä½“ | âœ… ä½ |
| **ALL** | æ‰€æœ‰æ“ä½œ | åŒ…å«ä¸Šè¿°æ‰€æœ‰ç±»å‹ | âš ï¸ é«˜ |

### 7.2 çº§è”ä¿å­˜ç­–ç•¥


**PERSISTç¤ºä¾‹**ï¼š
```java
@ManyToMany(cascade = CascadeType.PERSIST)
@JoinTable(...)
private Set<Course> courses;

// ä½¿ç”¨æ•ˆæœ
Student student = new Student();
Course course = new Course();  // æ–°è¯¾ç¨‹ï¼Œæœªä¿å­˜

student.getCourses().add(course);
session.save(student);  // è‡ªåŠ¨ä¿å­˜courseï¼

// ç”ŸæˆSQLï¼š
// INSERT INTO student...
// INSERT INTO course...      â† çº§è”ä¿å­˜
// INSERT INTO student_course...
```

**ä¸ä½¿ç”¨çº§è”çš„æƒ…å†µ**ï¼š
```java
@ManyToMany  // æ— cascade
private Set<Course> courses;

// å¿…é¡»æ‰‹åŠ¨ä¿å­˜
session.save(course);   // å…ˆä¿å­˜è¯¾ç¨‹
session.save(student);  // å†ä¿å­˜å­¦ç”Ÿ
```

**ä½¿ç”¨å»ºè®®**ï¼š
```
âœ… æ¨èä½¿ç”¨PERSISTï¼š
- å‡å°‘ä»£ç é‡
- è‡ªåŠ¨ç®¡ç†å…³è”
- ä¿è¯æ•°æ®ä¸€è‡´æ€§

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
- ç¡®ä¿å…³è”å®ä½“æ˜¯æ–°å¯¹è±¡
- é¿å…ä¿å­˜å·²å­˜åœ¨çš„å¯¹è±¡
```

### 7.3 çº§è”åˆ é™¤ç­–ç•¥


**REMOVEçš„å±é™©æ€§**ï¼š
```java
// âŒ å±é™©é…ç½®
@ManyToMany(cascade = CascadeType.REMOVE)
private Set<Course> courses;

// åˆ é™¤å­¦ç”Ÿ
session.delete(student);

// ç¾éš¾ï¼šæ‰€æœ‰ç›¸å…³è¯¾ç¨‹éƒ½è¢«åˆ é™¤ï¼
// DELETE FROM student_course WHERE student_id = ?
// DELETE FROM course WHERE id IN (...)  â† è¯¾ç¨‹è¢«åˆ ï¼
```

**æ­£ç¡®çš„åˆ é™¤ç­–ç•¥**ï¼š
```java
// âœ… ä¸è¦çº§è”åˆ é™¤
@ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE})
private Set<Course> courses;

// åˆ é™¤å­¦ç”Ÿ
session.delete(student);

// å®‰å…¨ï¼šåªåˆ é™¤ä¸­é—´è¡¨è®°å½•
// DELETE FROM student_course WHERE student_id = ?
// è¯¾ç¨‹ä¿ç•™ï¼
```

### 7.4 orphanRemovalè¯¦è§£


**orphanRemoval vs CascadeType.REMOVE**ï¼š
```java
// orphanRemovalï¼šç§»é™¤é›†åˆæ—¶åˆ é™¤å­¤å„¿å¯¹è±¡
@ManyToMany(orphanRemoval = true)
private Set<Course> courses;

// ä»é›†åˆç§»é™¤
student.getCourses().remove(course);
session.update(student);

// æ•ˆæœï¼šcourseè¢«åˆ é™¤ï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–å­¦ç”Ÿé€‰å®ƒï¼‰

// åŒºåˆ«ï¼š
// CascadeType.REMOVEï¼šåˆ é™¤ä¸»å®ä½“æ—¶åˆ é™¤å…³è”å®ä½“
// orphanRemovalï¼šä»é›†åˆç§»é™¤æ—¶åˆ é™¤å­¤å„¿å®ä½“
```

> âš ï¸ **å¤šå¯¹å¤šå…³ç³»æ…ç”¨orphanRemoval**ï¼šä¸€ä¸ªè¯¾ç¨‹å¯èƒ½è¢«å¤šä¸ªå­¦ç”Ÿé€‰ï¼Œä¸åº”è¯¥å› ä¸ºä¸€ä¸ªå­¦ç”Ÿé€€è¯¾å°±åˆ é™¤è¯¾ç¨‹ï¼

### 7.5 åˆ é™¤ç­–ç•¥æœ€ä½³å®è·µ


**æ•°æ®åº“å±‚é¢**ï¼š
```sql
-- é…ç½®å¤–é”®çº¦æŸ
ALTER TABLE student_course
ADD CONSTRAINT fk_student 
    FOREIGN KEY (student_id) 
    REFERENCES student(id) 
    ON DELETE CASCADE;  -- åˆ é™¤å­¦ç”Ÿæ—¶è‡ªåŠ¨åˆ ä¸­é—´è¡¨è®°å½•

ADD CONSTRAINT fk_course
    FOREIGN KEY (course_id)
    REFERENCES course(id)
    ON DELETE CASCADE;  -- åˆ é™¤è¯¾ç¨‹æ—¶è‡ªåŠ¨åˆ ä¸­é—´è¡¨è®°å½•
```

**åº”ç”¨å±‚é¢**ï¼š
```java
// âœ… æ¨èé…ç½®
@ManyToMany(cascade = {
    CascadeType.PERSIST,  // çº§è”ä¿å­˜
    CascadeType.MERGE     // çº§è”æ›´æ–°
})
// ä¸é…ç½®REMOVEå’ŒorphanRemoval

// åˆ é™¤æ—¶æ‰‹åŠ¨å¤„ç†
public void deleteStudent(Long studentId) {
    Student student = session.get(Student.class, studentId);
    
    // æ¸…ç©ºå…³è”ï¼ˆåˆ é™¤ä¸­é—´è¡¨è®°å½•ï¼‰
    student.getCourses().clear();
    session.update(student);
    
    // å†åˆ é™¤å­¦ç”Ÿ
    session.delete(student);
}
```

**åˆ†å±‚åˆ é™¤ç­–ç•¥**ï¼š
```
ğŸ”¸ åº”ç”¨å±‚ï¼š
  - ä¸é…ç½®çº§è”åˆ é™¤
  - æ‰‹åŠ¨æ§åˆ¶åˆ é™¤é€»è¾‘
  - ä¸šåŠ¡æ£€æŸ¥å’ŒéªŒè¯

ğŸ”¸ æ•°æ®åº“å±‚ï¼š
  - é…ç½®ON DELETE CASCADE
  - è‡ªåŠ¨æ¸…ç†ä¸­é—´è¡¨
  - ä¿è¯å¼•ç”¨å®Œæ•´æ€§
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤šå¯¹å¤šæœ¬è´¨ï¼šåŒå‘çš„ä¸€å¯¹å¤šï¼Œå¿…é¡»é€šè¿‡ä¸­é—´è¡¨å®ç°
ğŸ”¸ @ManyToManyï¼šé…ç½®å¤šå¯¹å¤šå…³è”çš„æ³¨è§£
ğŸ”¸ @JoinTableï¼šé…ç½®ä¸­é—´è¡¨ç»“æ„
ğŸ”¸ çº§è”æ“ä½œï¼šä¸»å®ä½“æ“ä½œæ—¶ï¼Œå…³è”å®ä½“çš„è‡ªåŠ¨å¤„ç†
ğŸ”¸ mappedByï¼šæŒ‡å®šå…³ç³»è¢«ç»´æŠ¤æ–¹ï¼Œé¿å…é‡å¤ç»´æŠ¤
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å•å‘vsåŒå‘çš„é€‰æ‹©**
```
å•å‘å…³è”ï¼š
âœ… ä»£ç ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿
âœ… é€‚åˆå•å‘å¯¼èˆªéœ€æ±‚
âŒ æ— æ³•åå‘æŸ¥è¯¢

åŒå‘å…³è”ï¼š
âœ… çµæ´»æŸ¥è¯¢ï¼ŒåŒå‘å¯¼èˆª
âœ… ç¬¦åˆä¸šåŠ¡é€»è¾‘
âŒ éœ€è¦ç»´æŠ¤åŒç«¯åŒæ­¥
```

**ğŸ”¹ ä¸­é—´è¡¨è®¾è®¡åŸåˆ™**
```
ç®€å•å…³è”ï¼š
- åªæœ‰ä¸¤ä¸ªå¤–é”®
- ä½¿ç”¨@ManyToMany
- è”åˆä¸»é”®

å¤æ‚å…³è”ï¼š
- æœ‰é¢å¤–å­—æ®µ
- åˆ›å»ºç‹¬ç«‹å®ä½“
- ä½¿ç”¨@ManyToOne
```

**ğŸ”¹ çº§è”æ“ä½œä½¿ç”¨å»ºè®®**
```
æ¨èé…ç½®ï¼š
âœ… CascadeType.PERSISTï¼ˆçº§è”ä¿å­˜ï¼‰
âœ… CascadeType.MERGEï¼ˆçº§è”æ›´æ–°ï¼‰

è°¨æ…ä½¿ç”¨ï¼š
âš ï¸ CascadeType.REMOVEï¼ˆå¯èƒ½è¯¯åˆ ï¼‰
âš ï¸ orphanRemovalï¼ˆå¤šå¯¹å¤šæ…ç”¨ï¼‰

é¿å…ä½¿ç”¨ï¼š
âŒ CascadeType.ALLï¼ˆé£é™©å¤ªå¤§ï¼‰
```

### 8.3 å®æˆ˜å¼€å‘å»ºè®®


**é…ç½®æ¨¡æ¿**ï¼š
```java
// ç»´æŠ¤æ–¹æ ‡å‡†é…ç½®
@ManyToMany(cascade = {CascadeType.PERSIST, CascadeType.MERGE})
@JoinTable(
    name = "è¡¨1_è¡¨2",
    joinColumns = @JoinColumn(name = "è¡¨1_id"),
    inverseJoinColumns = @JoinColumn(name = "è¡¨2_id")
)
private Set<å¯¹æ–¹å®ä½“> é›†åˆå;

// è¢«ç»´æŠ¤æ–¹æ ‡å‡†é…ç½®
@ManyToMany(mappedBy = "å¯¹æ–¹é›†åˆå±æ€§å")
private Set<å¯¹æ–¹å®ä½“> é›†åˆå;
```

**æ“ä½œè§„èŒƒ**ï¼š
```java
// 1. æ°¸è¿œä½¿ç”¨ä¾¿æ·æ–¹æ³•
public void addå…³è”(å¯¹æ–¹å®ä½“ entity) {
    this.é›†åˆ.add(entity);
    entity.geté›†åˆ().add(this);
}

// 2. ä½¿ç”¨Seté¿å…é‡å¤
private Set<å¯¹æ–¹å®ä½“> é›†åˆ = new HashSet<>();

// 3. åˆ é™¤å‰æ¸…ç†å…³è”
student.getCourses().clear();
session.delete(student);
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
```
ğŸ”¸ ä½¿ç”¨æ‡’åŠ è½½ï¼ˆFetchType.LAZYï¼‰
ğŸ”¸ é¿å…N+1æŸ¥è¯¢ï¼ˆJOIN FETCHï¼‰
ğŸ”¸ ä¸­é—´è¡¨å¤–é”®åŠ ç´¢å¼•
ğŸ”¸ åˆç†ä½¿ç”¨æ‰¹é‡æ“ä½œ
```

### 8.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| ä¸­é—´è¡¨é‡å¤æ’å…¥ | æœªä½¿ç”¨Seté›†åˆ | æ”¹ç”¨`Set<>`è€Œé`List<>` |
| mappedByæŠ¥é”™ | å±æ€§åé”™è¯¯ | æ£€æŸ¥å¯¹æ–¹é›†åˆå±æ€§å |
| çº§è”åˆ é™¤è¯¯åˆ æ•°æ® | ä½¿ç”¨REMOVE | ç§»é™¤REMOVEçº§è” |
| æ‡’åŠ è½½å¼‚å¸¸ | sessionå·²å…³é—­ | æ”¹ç”¨EAGERæˆ–JOIN FETCH |
| åŒå‘å…³ç³»ä¸åŒæ­¥ | åªç»´æŠ¤ä¸€ç«¯ | ä½¿ç”¨ä¾¿æ·æ–¹æ³•ç»´æŠ¤åŒç«¯ |

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¤šå¯¹å¤šå¿…ç”¨ä¸­é—´è¡¨ï¼Œ@JoinTableé…ç½®å…¨
- å•åŒå‘çœ‹éœ€æ±‚ï¼ŒmappedByåˆ«é…å
- çº§è”æ“ä½œè¦è°¨æ…ï¼Œåˆ é™¤ç­–ç•¥æƒ³å‘¨å…¨
- åŒç«¯åŒæ­¥å¾ˆé‡è¦ï¼Œä¾¿æ·æ–¹æ³•è®°å¿ƒé—´