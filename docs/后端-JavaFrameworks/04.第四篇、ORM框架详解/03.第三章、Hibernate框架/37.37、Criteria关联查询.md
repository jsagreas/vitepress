---
title: 37ã€Criteriaå…³è”æŸ¥è¯¢
---
## ğŸ“š ç›®å½•

1. [å…³è”æŸ¥è¯¢åŸºç¡€æ¦‚å¿µ](#1-å…³è”æŸ¥è¯¢åŸºç¡€æ¦‚å¿µ)
2. [createAliasåˆ«ååˆ›å»º](#2-createAliasåˆ«ååˆ›å»º)
3. [createCriteriaå…³è”æ¡ä»¶](#3-createCriteriaå…³è”æ¡ä»¶)
4. [å†…è¿æ¥æŸ¥è¯¢å®ç°](#4-å†…è¿æ¥æŸ¥è¯¢å®ç°)
5. [å¤–è¿æ¥æŸ¥è¯¢å®ç°](#5-å¤–è¿æ¥æŸ¥è¯¢å®ç°)
6. [åˆ«åä½¿ç”¨æŠ€å·§](#6-åˆ«åä½¿ç”¨æŠ€å·§)
7. [å…³è”æŸ¥è¯¢ä¼˜åŒ–](#7-å…³è”æŸ¥è¯¢ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— å…³è”æŸ¥è¯¢åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å…³è”æŸ¥è¯¢


**ğŸ”¸ é€šä¿—ç†è§£**
```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
å‡è®¾ä½ åœ¨ç½‘ä¸Šè´­ç‰©ï¼Œè¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰è®¢å•ä¿¡æ¯ï¼š

ç”¨æˆ·è¡¨ï¼ˆUserï¼‰          è®¢å•è¡¨ï¼ˆOrderï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id      â”‚            â”‚ id       â”‚
â”‚ name    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ user_id  â”‚
â”‚ email   â”‚  ä¸€å¯¹å¤šå…³ç³»  â”‚ amount   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³è”æŸ¥è¯¢å°±æ˜¯ï¼š
æŠŠç”¨æˆ·å’Œä»–çš„è®¢å•ä¿¡æ¯ä¸€èµ·æŸ¥å‡ºæ¥
è€Œä¸æ˜¯åˆ†ä¸¤æ¬¡æŸ¥è¯¢
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å…³è”æŸ¥è¯¢**
```
é—®é¢˜åœºæ™¯ï¼š
æŸ¥è¯¢ç”¨æˆ·"å¼ ä¸‰"çš„æ‰€æœ‰è®¢å•

ä¼ ç»Ÿåšæ³•ï¼ˆN+1é—®é¢˜ï¼‰ï¼š
1. å…ˆæŸ¥ç”¨æˆ·ï¼šSELECT * FROM User WHERE name='å¼ ä¸‰'
2. å†æŸ¥è®¢å•ï¼šSELECT * FROM Order WHERE user_id=?
   å¦‚æœæœ‰100ä¸ªç”¨æˆ·ï¼Œå°±è¦æ‰§è¡Œ101æ¬¡SQLï¼ˆæ€§èƒ½å·®ï¼‰

å…³è”æŸ¥è¯¢ï¼ˆä¸€æ¬¡æå®šï¼‰ï¼š
SELECT * FROM User u JOIN Order o ON u.id = o.user_id
WHERE u.name='å¼ ä¸‰'
åªæ‰§è¡Œ1æ¬¡SQLï¼Œæ•ˆç‡é«˜
```

### 1.2 Criteriaå…³è”æŸ¥è¯¢çš„ä¼˜åŠ¿


**ğŸ“Š å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼**

| æ–¹å¼ | å†™æ³• | çµæ´»æ€§ | ç±»å‹å®‰å…¨ |
|------|------|--------|---------|
| **HQLå­—ç¬¦ä¸²** | `"from User u join u.orders"` | ä¸€èˆ¬ | âŒ ç¼–è¯‘æœŸä¸æ£€æŸ¥ |
| **Criteria API** | `criteria.createAlias("orders", "o")` | é«˜ | âœ… ç¼–è¯‘æœŸæ£€æŸ¥ |

**ğŸ¯ Criteriaçš„ç‰¹ç‚¹**
- **é¢å‘å¯¹è±¡**ï¼šæ“ä½œçš„æ˜¯Javaå¯¹è±¡å’Œå±æ€§ï¼Œä¸æ˜¯SQLè¡¨å’Œå­—æ®µ
- **åŠ¨æ€æ„å»º**ï¼šå¯ä»¥æ ¹æ®æ¡ä»¶çµæ´»ç»„è£…æŸ¥è¯¢
- **ç±»å‹å®‰å…¨**ï¼šIDEèƒ½è‡ªåŠ¨æç¤ºï¼Œå‡å°‘æ‹¼å†™é”™è¯¯

---

## 2. ğŸ·ï¸ createAliasåˆ«ååˆ›å»º


### 2.1 åŸºæœ¬ç”¨æ³•ç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯åˆ«åï¼ˆAliasï¼‰**
```
åˆ«åå°±åƒç»™å…³è”å¯¹è±¡å–ä¸ª"å°å"ï¼Œæ–¹ä¾¿åç»­å¼•ç”¨

ä¸ç”¨åˆ«åçš„å†™æ³•ï¼ˆç¹çï¼‰ï¼š
criteria.add(Restrictions.eq("orders.status", "PAID"))

ä½¿ç”¨åˆ«ååï¼ˆç®€æ´ï¼‰ï¼š
criteria.createAlias("orders", "o")
criteria.add(Restrictions.eq("o.status", "PAID"))
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// åœºæ™¯ï¼šæŸ¥è¯¢æœ‰å·²æ”¯ä»˜è®¢å•çš„ç”¨æˆ·
Criteria criteria = session.createCriteria(User.class);

// ä¸ºorderså±æ€§åˆ›å»ºåˆ«å"o"
criteria.createAlias("orders", "o");

// ä½¿ç”¨åˆ«åæ·»åŠ æ¡ä»¶
criteria.add(Restrictions.eq("o.status", "PAID"));

List<User> users = criteria.list();
```

### 2.2 åˆ«åçš„æœ¬è´¨


**ğŸ” SQLç”Ÿæˆè¿‡ç¨‹**
```
Javaä»£ç ï¼š
criteria.createAlias("orders", "o")

ç”Ÿæˆçš„SQLï¼š
SELECT * FROM user u 
INNER JOIN order o ON u.id = o.user_id

ç†è§£è¦ç‚¹ï¼š
- "orders"ï¼šUserå®ä½“ä¸­çš„å…³è”å±æ€§å
- "o"ï¼šç»™å…³è”è¡¨èµ·çš„åˆ«å
- é»˜è®¤æ˜¯INNER JOINï¼ˆå†…è¿æ¥ï¼‰
```

### 2.3 å¤šçº§å…³è”åˆ«å


**ğŸ“¦ åµŒå¥—å…³è”å¤„ç†**
```java
// åœºæ™¯ï¼šç”¨æˆ· -> è®¢å• -> è®¢å•é¡¹
// User -> Order -> OrderItem

Criteria criteria = session.createCriteria(User.class);

// ç¬¬ä¸€çº§ï¼šç”¨æˆ·çš„è®¢å•
criteria.createAlias("orders", "o");

// ç¬¬äºŒçº§ï¼šè®¢å•çš„è®¢å•é¡¹
criteria.createAlias("o.items", "item");

// æŸ¥è¯¢ä¹°è¿‡ç‰¹å®šå•†å“çš„ç”¨æˆ·
criteria.add(Restrictions.eq("item.productName", "iPhone"));

List<User> users = criteria.list();
```

**ğŸŒ³ å…³è”å…³ç³»å›¾ç¤º**
```
Userï¼ˆç”¨æˆ·ï¼‰
  â””â”€> ordersï¼ˆè®¢å•åˆ—è¡¨ï¼‰åˆ«å"o"
        â””â”€> itemsï¼ˆè®¢å•é¡¹åˆ—è¡¨ï¼‰åˆ«å"item"

æŸ¥è¯¢è·¯å¾„ï¼š
User.orders.items.productName = "iPhone"
```

---

## 3. ğŸ¯ createCriteriaå…³è”æ¡ä»¶


### 3.1 ä¸createAliasçš„åŒºåˆ«


**ğŸ”¸ æ ¸å¿ƒåŒºåˆ«ç†è§£**
```
createAliasï¼š
- åªæ˜¯åˆ›å»ºå…³è”ï¼Œæœ¬èº«ä¸è¿”å›æ–°å¯¹è±¡
- ç»§ç»­åœ¨ä¸»å¯¹è±¡ä¸Šæ·»åŠ æ¡ä»¶
- é€‚åˆï¼šç®€å•çš„å…³è”æ¡ä»¶æŸ¥è¯¢

createCriteriaï¼š
- è¿”å›ä¸€ä¸ªæ–°çš„Criteriaå¯¹è±¡
- ä¸“é—¨æ“ä½œå…³è”å¯¹è±¡
- é€‚åˆï¼šå¤æ‚çš„å…³è”æ¡ä»¶ç»„åˆ
```

**ğŸ“Š å¯¹æ¯”ç¤ºä¾‹**
```java
// æ–¹å¼1ï¼šcreateAliasï¼ˆæ¨èç”¨äºç®€å•åœºæ™¯ï¼‰
Criteria criteria = session.createCriteria(User.class);
criteria.createAlias("orders", "o");
criteria.add(Restrictions.eq("o.status", "PAID"));

// æ–¹å¼2ï¼šcreateCriteriaï¼ˆæ¨èç”¨äºå¤æ‚åœºæ™¯ï¼‰
Criteria criteria = session.createCriteria(User.class);
Criteria orderCriteria = criteria.createCriteria("orders");
orderCriteria.add(Restrictions.eq("status", "PAID"));
orderCriteria.add(Restrictions.gt("amount", 1000));
```

### 3.2 createCriteriaå®æˆ˜


**ğŸ’» å¤æ‚æ¡ä»¶æŸ¥è¯¢**
```java
// åœºæ™¯ï¼šæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·
// æ¡ä»¶1ï¼šæœ‰è®¢å•é‡‘é¢>1000çš„
// æ¡ä»¶2ï¼šè®¢å•çŠ¶æ€æ˜¯å·²æ”¯ä»˜
// æ¡ä»¶3ï¼šç”¨æˆ·æ³¨å†Œæ—¶é—´åœ¨æœ€è¿‘ä¸€å¹´

Criteria userCriteria = session.createCriteria(User.class);

// åˆ›å»ºè®¢å•çš„å­æ¡ä»¶
Criteria orderCriteria = userCriteria.createCriteria("orders");
orderCriteria.add(Restrictions.gt("amount", 1000));
orderCriteria.add(Restrictions.eq("status", "PAID"));

// ç”¨æˆ·è‡ªèº«æ¡ä»¶
userCriteria.add(Restrictions.ge("registerDate", 
    new Date(System.currentTimeMillis() - 365L*24*60*60*1000)));

List<User> users = userCriteria.list();
```

### 3.3 è¿”å›å€¼çš„ä½¿ç”¨


**ğŸ”§ é“¾å¼è°ƒç”¨æŠ€å·§**
```java
// åˆ©ç”¨è¿”å›çš„Criteriaå¯¹è±¡é“¾å¼è°ƒç”¨
session.createCriteria(User.class)
    .createCriteria("orders")          // è¿”å›orderCriteria
        .add(Restrictions.eq("status", "PAID"))
        .add(Restrictions.gt("amount", 500))
    .createCriteria("address")         // è¿”å›addressCriteria  
        .add(Restrictions.eq("city", "åŒ—äº¬"))
    .list();
```

---

## 4. ğŸ”— å†…è¿æ¥æŸ¥è¯¢å®ç°


### 4.1 å†…è¿æ¥åŸºç¡€


**ğŸ”¸ ä»€ä¹ˆæ˜¯å†…è¿æ¥**
```
é€šä¿—ç†è§£ï¼š
åªæŸ¥è¯¢ä¸¤è¾¹éƒ½æœ‰åŒ¹é…æ•°æ®çš„è®°å½•

ç”¨æˆ·-è®¢å•ç¤ºä¾‹ï¼š
ç”¨æˆ·è¡¨               è®¢å•è¡¨
å¼ ä¸‰ â”€â”€â”€â”€åŒ¹é…â”€â”€â”€â†’ è®¢å•1  âœ… ä¼šæŸ¥å‡ºæ¥
æå›› â”€â”€â”€â”€åŒ¹é…â”€â”€â”€â†’ è®¢å•2  âœ… ä¼šæŸ¥å‡ºæ¥  
ç‹äº”ï¼ˆæ— è®¢å•ï¼‰              âŒ ä¸ä¼šæŸ¥å‡ºæ¥

å†…è¿æ¥ = åªè¦æœ‰è®¢å•çš„ç”¨æˆ·
```

**ğŸ“Š SQLå¯¹æ¯”**
```sql
-- å†…è¿æ¥SQL
SELECT u.*, o.* 
FROM user u 
INNER JOIN order o ON u.id = o.user_id
WHERE o.status = 'PAID'
```

### 4.2 Criteriaå†…è¿æ¥å®ç°


**ğŸ’» é»˜è®¤å†…è¿æ¥**
```java
// createAliasé»˜è®¤å°±æ˜¯å†…è¿æ¥
Criteria criteria = session.createCriteria(User.class);
criteria.createAlias("orders", "o");  // é»˜è®¤INNER JOIN

// ç­‰ä»·äºæ˜¾å¼æŒ‡å®š
criteria.createAlias("orders", "o", JoinType.INNER_JOIN);
```

**ğŸ¯ å®é™…åº”ç”¨åœºæ™¯**
```java
// åœºæ™¯ï¼šæŸ¥è¯¢æœ‰å·²æ”¯ä»˜è®¢å•çš„ç”¨æˆ·ï¼ˆæ’é™¤æ— è®¢å•ç”¨æˆ·ï¼‰
Criteria criteria = session.createCriteria(User.class);

// å†…è¿æ¥ï¼šåªæŸ¥æœ‰è®¢å•çš„ç”¨æˆ·
criteria.createAlias("orders", "o", JoinType.INNER_JOIN);
criteria.add(Restrictions.eq("o.status", "PAID"));

// æŠ•å½±æŸ¥è¯¢ï¼šåªè¿”å›éœ€è¦çš„å­—æ®µ
criteria.setProjection(Projections.projectionList()
    .add(Projections.property("id"))
    .add(Projections.property("name"))
    .add(Projections.property("o.orderNo"))
);

List<Object[]> results = criteria.list();
for (Object[] row : results) {
    System.out.println("ç”¨æˆ·ID: " + row[0]);
    System.out.println("ç”¨æˆ·å: " + row[1]);
    System.out.println("è®¢å•å·: " + row[2]);
}
```

---

## 5. ğŸŒ å¤–è¿æ¥æŸ¥è¯¢å®ç°


### 5.1 å¤–è¿æ¥åŸºç¡€


**ğŸ”¸ å·¦å¤–è¿æ¥ç†è§£**
```
é€šä¿—ç†è§£ï¼š
ä»¥å·¦è¡¨ä¸ºä¸»ï¼Œå³è¡¨æ²¡æœ‰ä¹Ÿæ˜¾ç¤º

ç”¨æˆ·-è®¢å•ç¤ºä¾‹ï¼ˆå·¦å¤–è¿æ¥ï¼‰ï¼š
ç”¨æˆ·è¡¨               è®¢å•è¡¨
å¼ ä¸‰ â”€â”€â”€â”€åŒ¹é…â”€â”€â”€â†’ è®¢å•1  âœ… æŸ¥å‡ºç”¨æˆ·+è®¢å•
æå›› â”€â”€â”€â”€åŒ¹é…â”€â”€â”€â†’ è®¢å•2  âœ… æŸ¥å‡ºç”¨æˆ·+è®¢å•
ç‹äº”ï¼ˆæ— è®¢å•ï¼‰              âœ… æŸ¥å‡ºç”¨æˆ·ï¼ˆè®¢å•ä¸ºnullï¼‰

å·¦å¤–è¿æ¥ = æ‰€æœ‰ç”¨æˆ·ï¼Œæœ‰è®¢å•çš„å¸¦ä¸Šè®¢å•
```

**ğŸ“Š å¤–è¿æ¥ç±»å‹**
```
LEFT JOINï¼ˆå·¦å¤–è¿æ¥ï¼‰ï¼š
- ä¿ç•™å·¦è¡¨æ‰€æœ‰è®°å½•
- å³è¡¨æ— åŒ¹é…æ˜¾ç¤ºnull

RIGHT JOINï¼ˆå³å¤–è¿æ¥ï¼‰ï¼š
- ä¿ç•™å³è¡¨æ‰€æœ‰è®°å½•  
- å·¦è¡¨æ— åŒ¹é…æ˜¾ç¤ºnull

FULL JOINï¼ˆå…¨å¤–è¿æ¥ï¼‰ï¼š
- ä¿ç•™ä¸¤è¾¹æ‰€æœ‰è®°å½•
- æ— åŒ¹é…çš„æ˜¾ç¤ºnull
```

### 5.2 Criteriaå¤–è¿æ¥å®ç°


**ğŸ’» å·¦å¤–è¿æ¥ç¤ºä¾‹**
```java
// åœºæ™¯ï¼šæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·åŠå…¶è®¢å•ï¼ˆåŒ…æ‹¬æ— è®¢å•ç”¨æˆ·ï¼‰
Criteria criteria = session.createCriteria(User.class);

// å·¦å¤–è¿æ¥ï¼šå³ä½¿ç”¨æˆ·æ²¡æœ‰è®¢å•ä¹Ÿä¼šæŸ¥å‡ºæ¥
criteria.createAlias("orders", "o", JoinType.LEFT_OUTER_JOIN);

// å¯é€‰ï¼šæ·»åŠ è®¢å•æ¡ä»¶ï¼ˆä¼šè¿‡æ»¤ç»“æœï¼‰
criteria.add(Restrictions.or(
    Restrictions.isNull("o.id"),           // æ— è®¢å•
    Restrictions.eq("o.status", "PAID")    // æˆ–å·²æ”¯ä»˜
));

List<User> users = criteria.list();
```

### 5.3 å¤–è¿æ¥çš„æ³¨æ„äº‹é¡¹


**âš ï¸ é‡è¦æç¤º**
```java
// é—®é¢˜ï¼šå¤–è¿æ¥+æ¡ä»¶å¯èƒ½å˜æˆå†…è¿æ¥
Criteria criteria = session.createCriteria(User.class);
criteria.createAlias("orders", "o", JoinType.LEFT_OUTER_JOIN);

// âŒ é”™è¯¯ï¼šè¿™ä¸ªæ¡ä»¶ä¼šè¿‡æ»¤æ‰æ— è®¢å•çš„ç”¨æˆ·
criteria.add(Restrictions.eq("o.status", "PAID"));

// âœ… æ­£ç¡®ï¼šå…è®¸è®¢å•ä¸ºnull
criteria.add(Restrictions.or(
    Restrictions.isNull("o.id"),
    Restrictions.eq("o.status", "PAID")
));
```

**ğŸ’¡ ä½¿ç”¨å»ºè®®**
```
é€‰æ‹©å†…è¿æ¥è¿˜æ˜¯å¤–è¿æ¥ï¼Ÿ

ä½¿ç”¨å†…è¿æ¥ï¼š
âœ… åªæŸ¥è¯¢æœ‰å…³è”æ•°æ®çš„è®°å½•
âœ… æŸ¥è¯¢æ€§èƒ½æ›´å¥½
âœ… ç»“æœé›†æ›´å°

ä½¿ç”¨å¤–è¿æ¥ï¼š
âœ… éœ€è¦ä¿ç•™ä¸»è¡¨æ‰€æœ‰è®°å½•
âœ… ç»Ÿè®¡åˆ†æåœºæ™¯ï¼ˆå¦‚ï¼šæ‰€æœ‰ç”¨æˆ·çš„è®¢å•æ•°é‡ï¼‰
âœ… æŠ¥è¡¨æŸ¥è¯¢
```

---

## 6. ğŸ¨ åˆ«åä½¿ç”¨æŠ€å·§


### 6.1 åˆ«åçš„å‘½åè§„èŒƒ


**ğŸ“ å‘½åå»ºè®®**
```java
// âœ… æ¨èï¼šè¯­ä¹‰æ¸…æ™°çš„åˆ«å
criteria.createAlias("orders", "order");
criteria.createAlias("user.address", "addr");
criteria.createAlias("order.items", "item");

// âŒ ä¸æ¨èï¼šå•å­—æ¯ï¼ˆé™¤éå…³ç³»å¾ˆç®€å•ï¼‰
criteria.createAlias("orders", "o");
criteria.createAlias("items", "i");

// å¤šçº§å…³è”æ—¶çš„å‘½å
criteria.createAlias("department.employees", "emp");
criteria.createAlias("emp.projects", "proj");
```

### 6.2 é¿å…åˆ«åå†²çª


**âš ï¸ å¸¸è§é”™è¯¯**
```java
// âŒ é”™è¯¯ï¼šé‡å¤ä½¿ç”¨ç›¸åŒåˆ«å
Criteria criteria = session.createCriteria(User.class);
criteria.createAlias("orders", "o");
criteria.createAlias("payments", "o");  // åˆ«åå†²çªï¼

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¸åŒåˆ«å
criteria.createAlias("orders", "order");
criteria.createAlias("payments", "payment");
```

### 6.3 åˆ«ååœ¨æŠ•å½±ä¸­çš„åº”ç”¨


**ğŸ’» ç»“æœé›†è½¬æ¢**
```java
// ä½¿ç”¨åˆ«åç®€åŒ–æŠ•å½±
Criteria criteria = session.createCriteria(User.class, "user");
criteria.createAlias("orders", "order");

// æŠ•å½±ï¼šé€‰æ‹©ç‰¹å®šå­—æ®µ
criteria.setProjection(Projections.projectionList()
    .add(Projections.property("user.name").as("userName"))
    .add(Projections.property("order.orderNo").as("orderNumber"))
    .add(Projections.property("order.amount").as("orderAmount"))
);

// ä½¿ç”¨ResultTransformerè½¬æ¢ç»“æœ
criteria.setResultTransformer(Transformers.aliasToBean(UserOrderDTO.class));

List<UserOrderDTO> results = criteria.list();
```

---

## 7. âš¡ å…³è”æŸ¥è¯¢ä¼˜åŒ–


### 7.1 N+1æŸ¥è¯¢é—®é¢˜


**ğŸ”¸ é—®é¢˜è¯Šæ–­**
```java
// âŒ å…¸å‹çš„N+1é—®é¢˜
List<User> users = session.createCriteria(User.class).list();

// éå†æ—¶è§¦å‘å»¶è¿ŸåŠ è½½ï¼ˆæ¯ä¸ªç”¨æˆ·éƒ½æŸ¥ä¸€æ¬¡è®¢å•ï¼‰
for (User user : users) {
    System.out.println(user.getOrders());  // é¢å¤–Næ¬¡SQL
}

// SQLæ‰§è¡Œæƒ…å†µï¼š
// 1æ¬¡ï¼šSELECT * FROM user
// Næ¬¡ï¼šSELECT * FROM order WHERE user_id = ?
// æ€»è®¡ï¼š1 + N æ¬¡æŸ¥è¯¢
```

**âœ… è§£å†³æ–¹æ¡ˆ**
```java
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨fetchå…³è”
Criteria criteria = session.createCriteria(User.class);
criteria.setFetchMode("orders", FetchMode.JOIN);
List<User> users = criteria.list();  // ä¸€æ¬¡SQLæå®š

// æ–¹æ¡ˆ2ï¼šcreateAlias + DISTINCT
criteria.createAlias("orders", "o", JoinType.LEFT_OUTER_JOIN);
criteria.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);
```

### 7.2 ä½¿ç”¨FetchModeä¼˜åŒ–


**ğŸ¯ FetchModeç­–ç•¥**
```java
// JOINï¼šç«‹å³åŠ è½½ï¼Œä½¿ç”¨SQL JOIN
criteria.setFetchMode("orders", FetchMode.JOIN);

// SELECTï¼šå»¶è¿ŸåŠ è½½ï¼Œè®¿é—®æ—¶å†æŸ¥ï¼ˆé»˜è®¤ï¼‰
criteria.setFetchMode("orders", FetchMode.SELECT);

// SUBSELECTï¼šå­æŸ¥è¯¢æ–¹å¼åŠ è½½
criteria.setFetchMode("orders", FetchMode.SUBSELECT);
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**
```
åœºæ™¯ï¼šæŸ¥è¯¢100ä¸ªç”¨æˆ·åŠå…¶è®¢å•

FetchMode.SELECTï¼ˆé»˜è®¤ï¼‰ï¼š
- SQLæ¬¡æ•°ï¼š1 + 100 = 101æ¬¡
- æ€§èƒ½ï¼šå·®

FetchMode.JOINï¼š
- SQLæ¬¡æ•°ï¼š1æ¬¡
- æ€§èƒ½ï¼šå¥½
- æ³¨æ„ï¼šå¯èƒ½äº§ç”Ÿç¬›å¡å°”ç§¯

FetchMode.SUBSELECTï¼š
- SQLæ¬¡æ•°ï¼š2æ¬¡
- æ€§èƒ½ï¼šè¾ƒå¥½
- é€‚åˆï¼šä¸€å¯¹å¤šä¸”æ•°æ®é‡å¤§
```

### 7.3 å»é‡å¤„ç†


**ğŸ”§ å¤„ç†é‡å¤è®°å½•**
```java
// é—®é¢˜ï¼šJOINæŸ¥è¯¢å¯èƒ½äº§ç”Ÿé‡å¤
Criteria criteria = session.createCriteria(User.class);
criteria.createAlias("orders", "o", JoinType.LEFT_OUTER_JOIN);
// å¯èƒ½æŸ¥å‡ºï¼šå¼ ä¸‰-è®¢å•1, å¼ ä¸‰-è®¢å•2ï¼ˆå¼ ä¸‰é‡å¤äº†ï¼‰

// è§£å†³ï¼šä½¿ç”¨DISTINCT_ROOT_ENTITY
criteria.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY);

List<User> users = criteria.list();  // è‡ªåŠ¨å»é‡
```

### 7.4 æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–


**âš¡ åˆ†æ‰¹æŸ¥è¯¢ç­–ç•¥**
```java
// å¤§æ•°æ®é‡æ—¶çš„ä¼˜åŒ–
Criteria criteria = session.createCriteria(User.class);
criteria.createAlias("orders", "o");

// åˆ†é¡µæŸ¥è¯¢
criteria.setFirstResult(0);     // èµ·å§‹ä½ç½®
criteria.setMaxResults(100);    // æ¯é¡µæ•°é‡

// å¯ç”¨æŸ¥è¯¢ç¼“å­˜
criteria.setCacheable(true);
criteria.setCacheRegion("userOrders");

List<User> users = criteria.list();
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å…³è”æŸ¥è¯¢ï¼šå°†å¤šä¸ªè¡¨çš„æ•°æ®é€šè¿‡å…³è”å…³ç³»ä¸€æ¬¡æŸ¥å‡º
ğŸ”¸ åˆ«åï¼ˆAliasï¼‰ï¼šä¸ºå…³è”å¯¹è±¡å–ç®€çŸ­åç§°ï¼Œæ–¹ä¾¿å¼•ç”¨
ğŸ”¸ å†…è¿æ¥ï¼šåªæŸ¥è¯¢ä¸¤è¾¹éƒ½æœ‰åŒ¹é…çš„æ•°æ®
ğŸ”¸ å¤–è¿æ¥ï¼šä¿ç•™ä¸»è¡¨æ‰€æœ‰æ•°æ®ï¼Œå…³è”è¡¨æ— åŒ¹é…æ˜¾ç¤ºnull
ğŸ”¸ N+1é—®é¢˜ï¼šä¸€æ¬¡ä¸»æŸ¥è¯¢+Næ¬¡å…³è”æŸ¥è¯¢çš„æ€§èƒ½é—®é¢˜
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ createAlias vs createCriteria**
```
createAliasï¼š
- åˆ›å»ºå…³è”åˆ«åï¼Œç®€åŒ–å±æ€§å¼•ç”¨
- ä¸è¿”å›æ–°å¯¹è±¡ï¼Œç»§ç»­æ“ä½œä¸»Criteria
- é€‚åˆç®€å•å…³è”æ¡ä»¶

createCriteriaï¼š
- åˆ›å»ºå…³è”çš„å­Criteriaå¯¹è±¡
- è¿”å›æ–°å¯¹è±¡ï¼Œä¸“é—¨æ“ä½œå…³è”å®ä½“
- é€‚åˆå¤æ‚å…³è”æ¡ä»¶ç»„åˆ
```

**ğŸ”¹ è¿æ¥ç±»å‹é€‰æ‹©**
```
INNER JOINï¼ˆå†…è¿æ¥ï¼‰ï¼š
âœ… åªè¦ä¸¤è¾¹éƒ½åŒ¹é…çš„æ•°æ®
âœ… ç»“æœé›†æ›´å°ï¼Œæ€§èƒ½æ›´å¥½
âŒ ä¼šè¿‡æ»¤æ‰æ— å…³è”çš„ä¸»è¡¨è®°å½•

LEFT OUTER JOINï¼ˆå·¦å¤–è¿æ¥ï¼‰ï¼š
âœ… ä¿ç•™å·¦è¡¨æ‰€æœ‰è®°å½•
âœ… é€‚åˆç»Ÿè®¡ã€æŠ¥è¡¨åœºæ™¯
âŒ ç»“æœé›†æ›´å¤§ï¼Œéœ€è¦å»é‡
```

### 8.3 å®ç”¨æŠ€å·§æ€»ç»“


**ğŸ’¡ æœ€ä½³å®è·µ**
```
åˆ«åå‘½åï¼š
âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼ˆorder, user, addrï¼‰
âœ… é¿å…å†²çªï¼Œä¿æŒå”¯ä¸€
âœ… å¤šçº§å…³è”æ—¶ä½“ç°å±‚çº§å…³ç³»

æ€§èƒ½ä¼˜åŒ–ï¼š
âœ… ä¼˜å…ˆä½¿ç”¨FetchMode.JOINé¿å…N+1
âœ… å¤§æ•°æ®é‡ä½¿ç”¨åˆ†é¡µ + æ‰¹é‡æŸ¥è¯¢
âœ… å¯ç”¨æŸ¥è¯¢ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
âœ… ä½¿ç”¨DISTINCT_ROOT_ENTITYå»é‡

é¿å…é™·é˜±ï¼š
âš ï¸ å¤–è¿æ¥+æ¡ä»¶å¯èƒ½å˜æˆå†…è¿æ¥æ•ˆæœ
âš ï¸ JOINå¯èƒ½äº§ç”Ÿç¬›å¡å°”ç§¯ï¼ˆæ•°æ®é‡å¤ï¼‰
âš ï¸ è¿‡åº¦ä½¿ç”¨å…³è”å½±å“æ€§èƒ½
```

### 8.4 å¿«é€Ÿå†³ç­–æŒ‡å—


```
é€‰æ‹©å…³è”æ–¹å¼ï¼š

ç®€å•åœºæ™¯ï¼ˆå•ä¸ªæ¡ä»¶ï¼‰ï¼š
â†’ createAlias + Restrictions

å¤æ‚åœºæ™¯ï¼ˆå¤šä¸ªæ¡ä»¶ï¼‰ï¼š
â†’ createCriteriaé“¾å¼è°ƒç”¨

éœ€è¦æ‰€æœ‰ä¸»è®°å½•ï¼š
â†’ LEFT_OUTER_JOIN + å»é‡

åªè¦æœ‰å…³è”çš„è®°å½•ï¼š
â†’ INNER_JOINï¼ˆé»˜è®¤ï¼‰

ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼š
â†’ FetchMode.JOIN + åˆ†é¡µ + ç¼“å­˜
```

**ğŸ¯ å­¦ä¹ å»ºè®®**
- å…ˆæŒæ¡createAliasï¼Œç†è§£åˆ«åæ¦‚å¿µ
- ç†Ÿç»ƒä½¿ç”¨å†…è¿æ¥ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„
- ç†è§£N+1é—®é¢˜ï¼Œå­¦ä¼šä½¿ç”¨FetchModeä¼˜åŒ–
- å¤šå®è·µï¼Œå¯¹æ¯”HQLå’ŒCriteriaçš„å¼‚åŒ
- ä½¿ç”¨SQLæ—¥å¿—è§‚å¯Ÿç”Ÿæˆçš„SQLè¯­å¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> åˆ«åå…³è”ç®€åŒ–å¼•ç”¨ï¼Œå†…å¤–è¿æ¥æŒ‰éœ€é€‰æ‹©  
> N+1ä¼˜åŒ–ç”¨FetchModeï¼Œå»é‡åˆ†é¡µæå‡æ€§èƒ½