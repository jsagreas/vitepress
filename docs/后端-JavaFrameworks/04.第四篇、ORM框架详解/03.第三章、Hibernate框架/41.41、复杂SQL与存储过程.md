---
title: 41ã€å¤æ‚SQLä¸å­˜å‚¨è¿‡ç¨‹
---
## ğŸ“š ç›®å½•

1. [Native SQLæ¦‚è¿°](#1-Native-SQLæ¦‚è¿°)
2. [å­˜å‚¨è¿‡ç¨‹è°ƒç”¨](#2-å­˜å‚¨è¿‡ç¨‹è°ƒç”¨)
3. [å‡½æ•°è°ƒç”¨](#3-å‡½æ•°è°ƒç”¨)
4. [å¤æ‚æŸ¥è¯¢å¤„ç†](#4-å¤æ‚æŸ¥è¯¢å¤„ç†)
5. [ç»“æœé›†æ˜ å°„](#5-ç»“æœé›†æ˜ å°„)
6. [è¾“å‡ºå‚æ•°å¤„ç†](#6-è¾“å‡ºå‚æ•°å¤„ç†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Native SQLæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Native SQL


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**

Native SQLå°±æ˜¯"åŸç”ŸSQL"ï¼Œè¯´ç™½äº†å°±æ˜¯ç›´æ¥å†™æ•°æ®åº“çš„SQLè¯­å¥ï¼Œè€Œä¸æ˜¯ç”¨HQLï¼ˆHibernateæŸ¥è¯¢è¯­è¨€ï¼‰ã€‚

```
é€šä¿—ç†è§£ï¼š
HQL = Hibernateçš„"æ™®é€šè¯"ï¼Œé¢å‘å¯¹è±¡
Native SQL = æ•°æ®åº“çš„"æ–¹è¨€"ï¼Œç›´æ¥æ“ä½œæ•°æ®åº“

å°±åƒï¼š
HQLï¼šfrom User where age > 18
Native SQLï¼šSELECT * FROM t_user WHERE age > 18
```

**ğŸ’­ ä¸ºä»€ä¹ˆéœ€è¦Native SQL**

| ä½¿ç”¨åœºæ™¯ | **è¯´æ˜** | **ä¾‹å­** |
|---------|---------|---------|
| ğŸ”¹ **å¤æ‚æŸ¥è¯¢** | HQLå†™ä¸å‡ºæ¥çš„å¤æ‚SQL | `å¤šè¡¨è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢` |
| ğŸ”¹ **æ€§èƒ½ä¼˜åŒ–** | éœ€è¦æ•°æ®åº“ç‰¹å®šä¼˜åŒ– | `ä½¿ç”¨æ•°æ®åº“ä¸“æœ‰å‡½æ•°` |
| ğŸ”¹ **å­˜å‚¨è¿‡ç¨‹** | è°ƒç”¨å·²æœ‰çš„å­˜å‚¨è¿‡ç¨‹ | `æ‰¹é‡æ•°æ®å¤„ç†` |
| ğŸ”¹ **é—ç•™ç³»ç»Ÿ** | å·²æœ‰SQLéœ€è¦å¤ç”¨ | `è€é¡¹ç›®è¿ç§»` |

### 1.2 Native SQLåŸºæœ¬ä½¿ç”¨


**ğŸ¯ åŸºç¡€ç¤ºä¾‹**

```java
// åˆ›å»ºNative SQLæŸ¥è¯¢
Session session = sessionFactory.openSession();

// æ–¹å¼1ï¼šæœ€ç®€å•çš„æŸ¥è¯¢
String sql = "SELECT * FROM t_user WHERE age > :age";
Query query = session.createNativeQuery(sql);
query.setParameter("age", 18);
List<Object[]> results = query.list();

// æ–¹å¼2ï¼šæ˜ å°„åˆ°å®ä½“ç±»
Query<User> query2 = session.createNativeQuery(sql, User.class);
query2.setParameter("age", 18);
List<User> users = query2.list();
```

**ğŸ” ç†è§£è¦ç‚¹**
- `createNativeQuery()`ï¼šå‘Šè¯‰Hibernate"æˆ‘è¦ç”¨åŸç”ŸSQL"
- `:age`ï¼šå‚æ•°å ä½ç¬¦ï¼Œå’ŒHQLä¸€æ ·çš„å†™æ³•
- `Object[]`ï¼šæ²¡æŒ‡å®šå®ä½“ç±»æ—¶ï¼Œè¿”å›æ•°ç»„
- `User.class`ï¼šå‘Šè¯‰HibernateæŠŠç»“æœæ˜ å°„æˆUserå¯¹è±¡

---

## 2. ğŸ“ å­˜å‚¨è¿‡ç¨‹è°ƒç”¨


### 2.1 å­˜å‚¨è¿‡ç¨‹æ˜¯ä»€ä¹ˆ


**ğŸŒ° ç”Ÿæ´»åŒ–ç†è§£**

```
å­˜å‚¨è¿‡ç¨‹ = æ•°æ®åº“é‡Œçš„"å¿«æ·æ–¹å¼"

å°±åƒä½ æ‰‹æœºé‡Œä¿å­˜çš„"ä¸€é”®æ‹¨å·"ï¼š
- æ™®é€šæ–¹å¼ï¼šæ‰“å¼€é€šè®¯å½• â†’ æ‰¾åˆ°å¼ ä¸‰ â†’ ç‚¹å‡»æ‹¨æ‰“
- å­˜å‚¨è¿‡ç¨‹ï¼šç‚¹å‡»å¿«æ·é”® â†’ ç›´æ¥æ‹¨æ‰“å¼ ä¸‰

å­˜å‚¨è¿‡ç¨‹ = æŠŠä¸€å †SQLæ“ä½œæ‰“åŒ…ï¼Œèµ·ä¸ªåå­—ï¼Œä»¥åç›´æ¥è°ƒç”¨
```

**ğŸ“‹ å­˜å‚¨è¿‡ç¨‹ç»“æ„**

```sql
-- æ•°æ®åº“ä¸­çš„å­˜å‚¨è¿‡ç¨‹ç¤ºä¾‹
CREATE PROCEDURE getUsersByAge(IN minAge INT, OUT totalCount INT)
BEGIN
    -- æŸ¥è¯¢æ•°æ®
    SELECT * FROM t_user WHERE age > minAge;
    
    -- ç»Ÿè®¡æ•°é‡
    SELECT COUNT(*) INTO totalCount FROM t_user WHERE age > minAge;
END
```

**ğŸ·ï¸ ä¸“ä¸šæœ¯è¯­è§£é‡Š**
- `INå‚æ•°`ï¼šè¾“å…¥å‚æ•°ï¼Œä½ ä¼ ç»™å­˜å‚¨è¿‡ç¨‹çš„å€¼
- `OUTå‚æ•°`ï¼šè¾“å‡ºå‚æ•°ï¼Œå­˜å‚¨è¿‡ç¨‹è¿”å›ç»™ä½ çš„å€¼
- `PROCEDURE`ï¼šå­˜å‚¨è¿‡ç¨‹çš„å…³é”®å­—

### 2.2 è°ƒç”¨å­˜å‚¨è¿‡ç¨‹


**âš¡ åŸºç¡€è°ƒç”¨æ–¹å¼**

```java
Session session = sessionFactory.openSession();

// è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
StoredProcedureQuery query = session.createStoredProcedureQuery("getUsersByAge");

// æ³¨å†Œè¾“å…¥å‚æ•°
query.registerStoredProcedureParameter("minAge", Integer.class, ParameterMode.IN);
query.setParameter("minAge", 18);

// æ³¨å†Œè¾“å‡ºå‚æ•°
query.registerStoredProcedureParameter("totalCount", Integer.class, ParameterMode.OUT);

// æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹
query.execute();

// è·å–ç»“æœ
List<Object[]> users = query.getResultList();
Integer count = (Integer) query.getOutputParameterValue("totalCount");

System.out.println("æŸ¥è¯¢åˆ° " + count + " ä¸ªç”¨æˆ·");
```

**ğŸ”„ æ‰§è¡Œæµç¨‹å›¾**

```
å¼€å§‹
  â†“
åˆ›å»ºå­˜å‚¨è¿‡ç¨‹æŸ¥è¯¢å¯¹è±¡
  â†“
æ³¨å†Œè¾“å…¥å‚æ•°ï¼ˆINï¼‰
  â†“
è®¾ç½®å‚æ•°å€¼
  â†“
æ³¨å†Œè¾“å‡ºå‚æ•°ï¼ˆOUTï¼‰
  â†“
æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹
  â†“
è·å–ç»“æœé›†å’Œè¾“å‡ºå‚æ•°
  â†“
ç»“æŸ
```

### 2.3 å¸¦è¿”å›ç»“æœé›†çš„å­˜å‚¨è¿‡ç¨‹


**ğŸ’¡ å®æˆ˜æ¡ˆä¾‹**

```java
// è°ƒç”¨è¿”å›ç”¨æˆ·åˆ—è¡¨çš„å­˜å‚¨è¿‡ç¨‹
StoredProcedureQuery query = session
    .createStoredProcedureQuery("getUsersByAge", User.class);

// è®¾ç½®å‚æ•°
query.registerStoredProcedureParameter("minAge", Integer.class, ParameterMode.IN);
query.setParameter("minAge", 18);

// æ‰§è¡Œå¹¶æ˜ å°„åˆ°å®ä½“
List<User> users = query.getResultList();

// éå†ç»“æœ
for (User user : users) {
    System.out.println("ç”¨æˆ·ï¼š" + user.getName() + "ï¼Œå¹´é¾„ï¼š" + user.getAge());
}
```

**ğŸ¯ å…³é”®ç‚¹**
- ç¬¬äºŒä¸ªå‚æ•°`User.class`ï¼šå‘Šè¯‰HibernateæŠŠç»“æœæ˜ å°„æˆUserå¯¹è±¡
- è‡ªåŠ¨æ˜ å°„ï¼šåˆ—åè¦å’Œå®ä½“å±æ€§åå¯¹åº”

---

## 3. ğŸ”§ å‡½æ•°è°ƒç”¨


### 3.1 æ•°æ®åº“å‡½æ•°vså­˜å‚¨è¿‡ç¨‹


**ğŸ“Š æ ¸å¿ƒåŒºåˆ«**

```
å­˜å‚¨è¿‡ç¨‹ï¼š
- å¯ä»¥æ‰§è¡Œå¤æ‚é€»è¾‘
- å¯ä»¥æœ‰å¤šä¸ªè¾“å‡ºå‚æ•°
- å¯ä»¥è¿”å›å¤šä¸ªç»“æœé›†
- ç”¨CALLè°ƒç”¨

å‡½æ•°ï¼š
- åªèƒ½è¿”å›ä¸€ä¸ªå€¼
- ç”¨SELECTè°ƒç”¨
- é€šå¸¸ç”¨äºè®¡ç®—

ç±»æ¯”ï¼š
å­˜å‚¨è¿‡ç¨‹ = å®Œæ•´çš„ç¨‹åº
å‡½æ•° = æ•°å­¦å…¬å¼
```

### 3.2 è°ƒç”¨æ•°æ®åº“å‡½æ•°


**âš¡ æ–¹å¼1ï¼šåœ¨Native SQLä¸­è°ƒç”¨**

```java
// è°ƒç”¨æ•°æ®åº“çš„å†…ç½®å‡½æ•°
String sql = "SELECT CONCAT(first_name, ' ', last_name) as fullName FROM t_user";
Query query = session.createNativeQuery(sql);
List<String> names = query.list();

// è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°
String sql2 = "SELECT calculateAge(birth_date) as age FROM t_user";
Query query2 = session.createNativeQuery(sql2);
List<Integer> ages = query2.list();
```

**âš¡ æ–¹å¼2ï¼šä½¿ç”¨function()è°ƒç”¨**

```java
// MySQLçš„è‡ªå®šä¹‰å‡½æ•°ç¤ºä¾‹
String sql = "SELECT id, name, getUserLevel(id) as level FROM t_user";
Query query = session.createNativeQuery(sql);

// è·å–ç»“æœ
List<Object[]> results = query.list();
for (Object[] row : results) {
    Long id = (Long) row[0];
    String name = (String) row[1];
    String level = (String) row[2];
    System.out.println(name + " çš„ç­‰çº§æ˜¯ï¼š" + level);
}
```

**ğŸŒ° å¸¸ç”¨æ•°æ®åº“å‡½æ•°**

| å‡½æ•°ç±»å‹ | **ç”¨é€”** | **ç¤ºä¾‹** |
|---------|---------|---------|
| ğŸ”¹ **å­—ç¬¦ä¸²å‡½æ•°** | `æ–‡æœ¬å¤„ç†` | `CONCAT(), SUBSTRING()` |
| ğŸ”¹ **æ•°å­¦å‡½æ•°** | `æ•°å€¼è®¡ç®—` | `ROUND(), ABS()` |
| ğŸ”¹ **æ—¥æœŸå‡½æ•°** | `æ—¶é—´å¤„ç†` | `NOW(), DATE_FORMAT()` |
| ğŸ”¹ **èšåˆå‡½æ•°** | `ç»Ÿè®¡åˆ†æ` | `COUNT(), SUM(), AVG()` |

---

## 4. ğŸ” å¤æ‚æŸ¥è¯¢å¤„ç†


### 4.1 å¤šè¡¨è”åˆæŸ¥è¯¢


**ğŸŒ° ä¸šåŠ¡åœºæ™¯**

```
éœ€æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ·åŠå…¶è®¢å•ä¿¡æ¯
æ¶‰åŠè¡¨ï¼š
- t_userï¼ˆç”¨æˆ·è¡¨ï¼‰
- t_orderï¼ˆè®¢å•è¡¨ï¼‰
- t_productï¼ˆå•†å“è¡¨ï¼‰

ä¼ ç»Ÿæ–¹å¼ï¼šå†™ä¸‰æ¡SQLåˆ†åˆ«æŸ¥è¯¢
Native SQLï¼šä¸€æ¡SQLæå®š
```

**ğŸ’» å®ç°ä»£ç **

```java
String sql = """
    SELECT 
        u.id as userId,
        u.name as userName,
        o.id as orderId,
        o.order_no as orderNo,
        p.name as productName,
        o.amount as amount
    FROM t_user u
    LEFT JOIN t_order o ON u.id = o.user_id
    LEFT JOIN t_product p ON o.product_id = p.id
    WHERE u.age > :minAge
    ORDER BY o.create_time DESC
    """;

Query query = session.createNativeQuery(sql);
query.setParameter("minAge", 18);

List<Object[]> results = query.list();

// å¤„ç†ç»“æœ
for (Object[] row : results) {
    System.out.println("ç”¨æˆ·ï¼š" + row[1] + 
                     "ï¼Œè®¢å•å·ï¼š" + row[3] + 
                     "ï¼Œå•†å“ï¼š" + row[4]);
}
```

**ğŸ” æŸ¥è¯¢ç»“æ„å›¾**

```
t_userï¼ˆç”¨æˆ·è¡¨ï¼‰
    â†“ (LEFT JOIN)
t_orderï¼ˆè®¢å•è¡¨ï¼‰
    â†“ (LEFT JOIN)
t_productï¼ˆå•†å“è¡¨ï¼‰
    â†“
ç»“æœé›†ï¼šç”¨æˆ·-è®¢å•-å•†å“ç»„åˆæ•°æ®
```

### 4.2 å­æŸ¥è¯¢å¤„ç†


**ğŸ“‹ ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹**

```java
// åœºæ™¯ï¼šæŸ¥è¯¢è´­ä¹°é‡‘é¢è¶…è¿‡å¹³å‡å€¼çš„è®¢å•
String sql = """
    SELECT o.*, u.name as userName
    FROM t_order o
    JOIN t_user u ON o.user_id = u.id
    WHERE o.amount > (
        SELECT AVG(amount) FROM t_order
    )
    ORDER BY o.amount DESC
    """;

Query query = session.createNativeQuery(sql);
List<Object[]> highValueOrders = query.list();
```

**ğŸ’­ ç†è§£å­æŸ¥è¯¢**
- å†…å±‚æŸ¥è¯¢ï¼š`SELECT AVG(amount) FROM t_order` â†’ è®¡ç®—å¹³å‡é‡‘é¢
- å¤–å±‚æŸ¥è¯¢ï¼šç”¨è¿™ä¸ªå¹³å‡å€¼åšæ¡ä»¶ç­›é€‰
- å°±åƒï¼šå…ˆç®—å‡ºç­çº§å¹³å‡åˆ†ï¼Œå†æ‰¾å‡ºé«˜äºå¹³å‡åˆ†çš„å­¦ç”Ÿ

### 4.3 åˆ†ç»„ç»Ÿè®¡æŸ¥è¯¢


**âš¡ å®æˆ˜æ¡ˆä¾‹**

```java
// ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°é‡å’Œæ€»é‡‘é¢
String sql = """
    SELECT 
        u.name as userName,
        COUNT(o.id) as orderCount,
        COALESCE(SUM(o.amount), 0) as totalAmount
    FROM t_user u
    LEFT JOIN t_order o ON u.id = o.user_id
    GROUP BY u.id, u.name
    HAVING COUNT(o.id) > 0
    ORDER BY totalAmount DESC
    """;

Query query = session.createNativeQuery(sql);
List<Object[]> statistics = query.list();

for (Object[] row : results) {
    System.out.println("ç”¨æˆ·ï¼š" + row[0] + 
                     "ï¼Œè®¢å•æ•°ï¼š" + row[1] + 
                     "ï¼Œæ€»é‡‘é¢ï¼š" + row[2]);
}
```

**ğŸ·ï¸ SQLå…³é”®å­—è§£é‡Š**
- `GROUP BY`ï¼šæŠŠæ•°æ®åˆ†ç»„ï¼ˆæŒ‰ç”¨æˆ·åˆ†ç»„ï¼‰
- `HAVING`ï¼šåˆ†ç»„åçš„æ¡ä»¶ç­›é€‰
- `COALESCE()`ï¼šå¤„ç†ç©ºå€¼ï¼Œæ²¡æœ‰è®¢å•æ—¶è¿”å›0

---

## 5. ğŸ¯ ç»“æœé›†æ˜ å°„


### 5.1 æ˜ å°„åˆ°å®ä½“ç±»


**ğŸ”¸ è‡ªåŠ¨æ˜ å°„**

```java
// å‰æï¼šSQLçš„åˆ—åè¦å’Œå®ä½“å±æ€§åä¸€è‡´
String sql = "SELECT id, name, age, email FROM t_user";

// ç›´æ¥æ˜ å°„åˆ°Userå®ä½“
Query<User> query = session.createNativeQuery(sql, User.class);
List<User> users = query.list();
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
- åˆ—åå¿…é¡»åŒ¹é…ï¼šæ•°æ®åº“çš„`user_name`è¦å¯¹åº”å®ä½“çš„`userName`
- å¯ä»¥ç”¨åˆ«åï¼š`SELECT user_name as userName FROM t_user`

### 5.2 ä½¿ç”¨ResultTransformerï¼ˆå·²è¿‡æ—¶ä½†å¸¸è§ï¼‰


**ğŸ’¡ çµæ´»æ˜ å°„**

```java
// æŸ¥è¯¢ç»“æœæ˜ å°„åˆ°Map
String sql = "SELECT id, name, age FROM t_user";
Query query = session.createNativeQuery(sql);

query.setResultTransformer(Transformers.ALIAS_TO_ENTITY_MAP);
List<Map<String, Object>> results = query.list();

for (Map<String, Object> row : results) {
    System.out.println("ID: " + row.get("id"));
    System.out.println("å§“å: " + row.get("name"));
}
```

**ğŸ”§ æ–°ç‰ˆæœ¬æ¨èæ–¹å¼**

```java
// Hibernate 5.2+æ¨èä½¿ç”¨ResultListTransformer
String sql = "SELECT id, name, age FROM t_user";
NativeQuery<User> query = session.createNativeQuery(sql);

query.setTupleTransformer((tuple, aliases) -> {
    User user = new User();
    user.setId((Long) tuple[0]);
    user.setName((String) tuple[1]);
    user.setAge((Integer) tuple[2]);
    return user;
});

List<User> users = query.list();
```

### 5.3 è‡ªå®šä¹‰ç»“æœæ˜ å°„


**ğŸ¯ ä½¿ç”¨@SqlResultSetMapping**

```java
// åœ¨å®ä½“ç±»ä¸Šå®šä¹‰æ˜ å°„
@Entity
@SqlResultSetMapping(
    name = "UserOrderMapping",
    classes = {
        @ConstructorResult(
            targetClass = UserOrderDTO.class,
            columns = {
                @ColumnResult(name = "userId", type = Long.class),
                @ColumnResult(name = "userName", type = String.class),
                @ColumnResult(name = "orderCount", type = Long.class),
                @ColumnResult(name = "totalAmount", type = BigDecimal.class)
            }
        )
    }
)
public class User {
    // å®ä½“å®šä¹‰...
}

// ä½¿ç”¨è‡ªå®šä¹‰æ˜ å°„
String sql = """
    SELECT 
        u.id as userId,
        u.name as userName,
        COUNT(o.id) as orderCount,
        SUM(o.amount) as totalAmount
    FROM t_user u
    LEFT JOIN t_order o ON u.id = o.user_id
    GROUP BY u.id
    """;

Query<UserOrderDTO> query = session
    .createNativeQuery(sql, "UserOrderMapping");
List<UserOrderDTO> results = query.list();
```

**ğŸ’­ ç†è§£è‡ªå®šä¹‰æ˜ å°„**
- `@SqlResultSetMapping`ï¼šå‘Šè¯‰Hibernate"ç»“æœè¯¥æ€ä¹ˆæ˜ å°„"
- `@ConstructorResult`ï¼šç”¨æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡
- `@ColumnResult`ï¼šæŒ‡å®šæ¯åˆ—å¯¹åº”çš„å­—æ®µ

---

## 6. ğŸ“¤ è¾“å‡ºå‚æ•°å¤„ç†


### 6.1 ä»€ä¹ˆæ˜¯è¾“å‡ºå‚æ•°


**ğŸŒ° ç”Ÿæ´»åŒ–ç†è§£**

```
è¾“å‡ºå‚æ•° = å­˜å‚¨è¿‡ç¨‹çš„"è¿”å›å€¼"

å°±åƒè°ƒç”¨å‡½æ•°ï¼š
int result = calculate(10, 20);  // resultæ˜¯è¿”å›å€¼

å­˜å‚¨è¿‡ç¨‹çš„è¾“å‡ºå‚æ•°å°±æ˜¯è¿™ä¸ªresult
ä½†å­˜å‚¨è¿‡ç¨‹å¯ä»¥æœ‰å¤šä¸ªè¾“å‡ºå‚æ•°
```

**ğŸ“‹ è¾“å‡ºå‚æ•°ç±»å‹**

| å‚æ•°æ¨¡å¼ | **è¯´æ˜** | **ç”¨é€”** |
|---------|---------|---------|
| ğŸ”¹ **IN** | `è¾“å…¥å‚æ•°` | `ä¼ å€¼ç»™å­˜å‚¨è¿‡ç¨‹` |
| ğŸ”¹ **OUT** | `è¾“å‡ºå‚æ•°` | `å­˜å‚¨è¿‡ç¨‹è¿”å›å€¼` |
| ğŸ”¹ **INOUT** | `è¾“å…¥è¾“å‡º` | `æ—¢ä¼ å…¥åˆè¿”å›` |

### 6.2 å¤„ç†å•ä¸ªè¾“å‡ºå‚æ•°


**âš¡ åŸºç¡€ç¤ºä¾‹**

```java
// å­˜å‚¨è¿‡ç¨‹ï¼šè®¡ç®—ç”¨æˆ·æ€»æ•°
// CREATE PROCEDURE countUsers(OUT total INT)
// BEGIN
//     SELECT COUNT(*) INTO total FROM t_user;
// END

StoredProcedureQuery query = session
    .createStoredProcedureQuery("countUsers");

// æ³¨å†Œè¾“å‡ºå‚æ•°
query.registerStoredProcedureParameter(
    "total",           // å‚æ•°å
    Integer.class,     // å‚æ•°ç±»å‹
    ParameterMode.OUT  // è¾“å‡ºå‚æ•°
);

// æ‰§è¡Œ
query.execute();

// è·å–è¾“å‡ºå‚æ•°çš„å€¼
Integer totalUsers = (Integer) query.getOutputParameterValue("total");
System.out.println("ç”¨æˆ·æ€»æ•°ï¼š" + totalUsers);
```

**ğŸ” æ‰§è¡Œæµç¨‹**

```
Javaä»£ç 
   â†“
è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
   â†“
æ•°æ®åº“æ‰§è¡Œ
   â†“
å°†ç»“æœæ”¾å…¥OUTå‚æ•°
   â†“
Javaè·å–OUTå‚æ•°å€¼
   â†“
ä½¿ç”¨ç»“æœ
```

### 6.3 å¤„ç†å¤šä¸ªè¾“å‡ºå‚æ•°


**ğŸ’» å¤æ‚åœºæ™¯**

```java
// å­˜å‚¨è¿‡ç¨‹ï¼šç»Ÿè®¡ç”¨æˆ·ä¿¡æ¯
// CREATE PROCEDURE getUserStats(
//     OUT totalUsers INT,
//     OUT avgAge DECIMAL(10,2),
//     OUT maxAge INT
// )

StoredProcedureQuery query = session
    .createStoredProcedureQuery("getUserStats");

// æ³¨å†Œå¤šä¸ªè¾“å‡ºå‚æ•°
query.registerStoredProcedureParameter("totalUsers", Integer.class, ParameterMode.OUT);
query.registerStoredProcedureParameter("avgAge", BigDecimal.class, ParameterMode.OUT);
query.registerStoredProcedureParameter("maxAge", Integer.class, ParameterMode.OUT);

// æ‰§è¡Œ
query.execute();

// è·å–æ‰€æœ‰è¾“å‡ºå‚æ•°
Integer total = (Integer) query.getOutputParameterValue("totalUsers");
BigDecimal avg = (BigDecimal) query.getOutputParameterValue("avgAge");
Integer max = (Integer) query.getOutputParameterValue("maxAge");

System.out.println("ç”¨æˆ·æ€»æ•°ï¼š" + total);
System.out.println("å¹³å‡å¹´é¾„ï¼š" + avg);
System.out.println("æœ€å¤§å¹´é¾„ï¼š" + max);
```

### 6.4 INOUTå‚æ•°å¤„ç†


**ğŸ”„ åŒå‘å‚æ•°**

```java
// å­˜å‚¨è¿‡ç¨‹ï¼šç»™å¹´é¾„åŠ ä¸ŠæŒ‡å®šå€¼
// CREATE PROCEDURE incrementAge(INOUT age INT, IN increment INT)
// BEGIN
//     SET age = age + increment;
// END

StoredProcedureQuery query = session
    .createStoredProcedureQuery("incrementAge");

// æ³¨å†ŒINOUTå‚æ•°
query.registerStoredProcedureParameter("age", Integer.class, ParameterMode.INOUT);
query.registerStoredProcedureParameter("increment", Integer.class, ParameterMode.IN);

// è®¾ç½®åˆå§‹å€¼
query.setParameter("age", 20);
query.setParameter("increment", 5);

// æ‰§è¡Œ
query.execute();

// è·å–ä¿®æ”¹åçš„å€¼
Integer newAge = (Integer) query.getOutputParameterValue("age");
System.out.println("æ–°å¹´é¾„ï¼š" + newAge);  // è¾“å‡ºï¼š25
```

**ğŸ’­ INOUTå‚æ•°ç†è§£**
- æ—¢æ˜¯è¾“å…¥åˆæ˜¯è¾“å‡º
- å¯ä»¥åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä¿®æ”¹
- ä¿®æ”¹åçš„å€¼ä¼šè¿”å›ç»™è°ƒç”¨è€…

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Native SQLï¼šç›´æ¥å†™æ•°æ®åº“SQLï¼Œçµæ´»å¼ºå¤§
ğŸ”¸ å­˜å‚¨è¿‡ç¨‹ï¼šæ•°æ®åº“ä¸­é¢„å®šä¹‰çš„SQLä»£ç å—
ğŸ”¸ å‡½æ•°è°ƒç”¨ï¼šåœ¨SQLä¸­è°ƒç”¨æ•°æ®åº“å‡½æ•°
ğŸ”¸ ç»“æœæ˜ å°„ï¼šæŠŠæŸ¥è¯¢ç»“æœè½¬æ¢æˆJavaå¯¹è±¡
ğŸ”¸ è¾“å‡ºå‚æ•°ï¼šå­˜å‚¨è¿‡ç¨‹è¿”å›çš„å€¼
```

### 7.2 å…³é”®ä½¿ç”¨åœºæ™¯


**ğŸ¯ ä½•æ—¶ä½¿ç”¨Native SQL**

| åœºæ™¯ | **HQL** | **Native SQL** | **æ¨è** |
|------|---------|---------------|---------|
| **ç®€å•CRUD** | âœ… ç®€æ´ | âŒ ç¹ç | `HQL` |
| **å¤æ‚è”è¡¨** | âŒ éš¾å†™ | âœ… çµæ´» | `Native SQL` |
| **å­˜å‚¨è¿‡ç¨‹** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ | `Native SQL` |
| **æ•°æ®åº“å‡½æ•°** | âš ï¸ å—é™ | âœ… å®Œå…¨æ”¯æŒ | `Native SQL` |
| **æ€§èƒ½ä¼˜åŒ–** | âš ï¸ æœ‰é™ | âœ… å¯æ§ | `Native SQL` |

### 7.3 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**
- ä¼˜å…ˆä½¿ç”¨HQLï¼Œå¤æ‚åœºæ™¯æ‰ç”¨Native SQL
- ä½¿ç”¨å‘½åå‚æ•°ï¼ˆ`:name`ï¼‰è€Œä¸æ˜¯ä½ç½®å‚æ•°ï¼ˆ`?`ï¼‰
- åˆç†ä½¿ç”¨ç»“æœæ˜ å°„ï¼Œé¿å…æ‰‹åŠ¨è½¬æ¢
- å­˜å‚¨è¿‡ç¨‹å‚æ•°è¦æ˜ç¡®æ ‡æ³¨ç±»å‹å’Œæ¨¡å¼

**âŒ é¿å…çš„å‘**
- ä¸è¦åœ¨Native SQLä¸­å†™æ­»æ•°æ®åº“ç‰¹å®šè¯­æ³•ï¼ˆç§»æ¤æ€§å·®ï¼‰
- åˆ«å¿˜è®°æ³¨å†Œè¾“å‡ºå‚æ•°ï¼Œå¦åˆ™æ‹¿ä¸åˆ°å€¼
- æ³¨æ„SQLæ³¨å…¥é£é™©ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- åˆ—åè¦å’Œå®ä½“å±æ€§åŒ¹é…ï¼Œå¦åˆ™æ˜ å°„å¤±è´¥

### 7.4 å®æˆ˜è®°å¿†æŠ€å·§


**ğŸ¯ å¿«é€Ÿè®°å¿†å£è¯€**

```
Native SQLä¸‰æ­¥èµ°ï¼š
1ï¸âƒ£ createNativeQuery - åˆ›å»ºæŸ¥è¯¢
2ï¸âƒ£ setParameter - è®¾ç½®å‚æ•°  
3ï¸âƒ£ getResultList - è·å–ç»“æœ

å­˜å‚¨è¿‡ç¨‹å››æ­¥æ›²ï¼š
1ï¸âƒ£ createStoredProcedureQuery - åˆ›å»ºè°ƒç”¨
2ï¸âƒ£ registerParameter - æ³¨å†Œå‚æ•°
3ï¸âƒ£ setParameter - è®¾ç½®è¾“å…¥å€¼
4ï¸âƒ£ getOutputParameter - è·å–è¾“å‡ºå€¼
```

**ğŸ”‘ å…³é”®è¯è®°å¿†**
- `Native` = åŸç”Ÿçš„ã€æ•°æ®åº“çš„
- `Stored Procedure` = å­˜å‚¨è¿‡ç¨‹
- `OUT` = è¾“å‡ºå‚æ•°
- `ResultMapping` = ç»“æœæ˜ å°„

**æ ¸å¿ƒç†è§£**ï¼š
- Native SQLå°±æ˜¯ç›´æ¥å†™SQLï¼Œä¸ç»è¿‡ORMç¿»è¯‘
- å­˜å‚¨è¿‡ç¨‹æ˜¯æ•°æ®åº“é‡Œçš„"å‡½æ•°"ï¼Œå¯ä»¥æœ‰è¾“å…¥è¾“å‡º
- ç»“æœæ˜ å°„æ˜¯æŠŠSQLç»“æœå˜æˆJavaå¯¹è±¡çš„è¿‡ç¨‹
- è¾“å‡ºå‚æ•°æ˜¯å­˜å‚¨è¿‡ç¨‹çš„"è¿”å›å€¼"ï¼Œå¯ä»¥æœ‰å¤šä¸ª