---
title: 72ã€æ¶æ„è®¾è®¡ä¸æ¨¡å¼
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯æ¶æ„è®¾è®¡æ¨¡å¼](#1-ä»€ä¹ˆæ˜¯æ¶æ„è®¾è®¡æ¨¡å¼)
2. [DAOæ¨¡å¼è¯¦è§£](#2-DAOæ¨¡å¼è¯¦è§£)
3. [Repositoryæ¨¡å¼](#3-Repositoryæ¨¡å¼)
4. [Serviceå±‚è®¾è®¡](#4-Serviceå±‚è®¾è®¡)
5. [é¢†åŸŸé©±åŠ¨è®¾è®¡DDD](#5-é¢†åŸŸé©±åŠ¨è®¾è®¡DDD)
6. [åˆ†å±‚æ¶æ„å®è·µ](#6-åˆ†å±‚æ¶æ„å®è·µ)
7. [ä¾èµ–æ³¨å…¥åœ¨ORMä¸­çš„åº”ç”¨](#7-ä¾èµ–æ³¨å…¥åœ¨ORMä¸­çš„åº”ç”¨)
8. [å¸¸ç”¨è®¾è®¡æ¨¡å¼åº”ç”¨](#8-å¸¸ç”¨è®¾è®¡æ¨¡å¼åº”ç”¨)
9. [è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ](#9-è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ä»€ä¹ˆæ˜¯æ¶æ„è®¾è®¡æ¨¡å¼


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦æ¶æ„è®¾è®¡æ¨¡å¼


**é€šä¿—ç†è§£**ï¼šå°±åƒç›–æˆ¿å­éœ€è¦è®¾è®¡å›¾çº¸ä¸€æ ·ï¼Œå¼€å‘ç³»ç»Ÿä¹Ÿéœ€è¦"è®¾è®¡è“å›¾"

```
æ²¡æœ‰è®¾è®¡æ¨¡å¼çš„ä»£ç ï¼šå°±åƒèƒ¡ä¹±å †ç Œçš„ç§¯æœ¨
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ æ‰€æœ‰ä»£ç  â”‚
                    â”‚æ··åœ¨ä¸€èµ· â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    
æœ‰è®¾è®¡æ¨¡å¼çš„ä»£ç ï¼šåƒè§„åˆ’å¥½çš„æ¥¼æˆ¿
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å‰ç«¯å±•ç¤ºå±‚  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚  ä¸šåŠ¡é€»è¾‘å±‚  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚  æ•°æ®è®¿é—®å±‚  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚   æ•°æ®åº“å±‚   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç›®çš„**ï¼š
- **ä»£ç æ›´æ¸…æ™°** - çŸ¥é“æ¯éƒ¨åˆ†ä»£ç æ”¾åœ¨å“ªé‡Œ
- **ç»´æŠ¤æ›´ç®€å•** - ä¿®æ”¹æŸä¸ªåŠŸèƒ½ä¸å½±å“å…¶ä»–éƒ¨åˆ†
- **å›¢é˜Ÿåä½œ** - å¤§å®¶æŒ‰ç»Ÿä¸€è§„èŒƒå†™ä»£ç 
- **å¤ç”¨æ€§é«˜** - ç›¸åŒçš„ä»£ç é€»è¾‘å¯ä»¥é‡å¤ä½¿ç”¨

### 1.2 æ¶æ„è®¾è®¡æ¨¡å¼çš„æœ¬è´¨


> **è®¾è®¡æ¨¡å¼**ï¼šå°±æ˜¯å‰äººæ€»ç»“å‡ºæ¥çš„"ä»£ç ç»„ç»‡ç»éªŒ"ï¼Œå‘Šè¯‰æˆ‘ä»¬å¦‚ä½•æŠŠä»£ç å†™å¾—æ›´ä¼˜é›…ã€æ›´æ˜“ç»´æŠ¤

**ä¸‰ä¸ªå…³é”®é—®é¢˜**ï¼š
1. **æ˜¯ä»€ä¹ˆ** - è¿™ä¸ªæ¨¡å¼çš„ä½œç”¨æ˜¯ä»€ä¹ˆ
2. **ä¸ºä»€ä¹ˆ** - ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªæ¨¡å¼
3. **æ€ä¹ˆç”¨** - å®é™…é¡¹ç›®ä¸­å¦‚ä½•åº”ç”¨

---

## 2. ğŸ“ DAOæ¨¡å¼è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯DAOæ¨¡å¼


**DAO = Data Access Objectï¼ˆæ•°æ®è®¿é—®å¯¹è±¡ï¼‰**

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
å°±åƒå›¾ä¹¦é¦†ç®¡ç†å‘˜ï¼š
- ä½ æƒ³å€Ÿä¹¦ â†’ å‘Šè¯‰ç®¡ç†å‘˜ä¹¦å
- ç®¡ç†å‘˜å»æ‰¾ä¹¦ â†’ ä»ä¹¦æ¶å–å‡º
- æŠŠä¹¦ç»™ä½  â†’ å®Œæˆå€Ÿé˜…

DAOå°±æ˜¯"æ•°æ®åº“ç®¡ç†å‘˜"ï¼š
- ä½ éœ€è¦æ•°æ® â†’ è°ƒç”¨DAOæ–¹æ³•
- DAOå»æ•°æ®åº“æŸ¥è¯¢ â†’ æ‰§è¡ŒSQL
- è¿”å›ç»“æœç»™ä½  â†’ å®Œæˆæ•°æ®è®¿é—®
```

### 2.2 DAOæ¨¡å¼çš„ç»“æ„


**æ ¸å¿ƒç»„æˆéƒ¨åˆ†**ï¼š

```
åº”ç”¨ç¨‹åº                     æ•°æ®åº“
    â”‚                         â”‚
    â”œâ†’ è°ƒç”¨ UserDAO          â”‚
    â”‚      â”œâ”€ save()          â”‚
    â”‚      â”œâ”€ findById()      â”‚
    â”‚      â”œâ”€ update()  â”€â”€â”€â”€â”€â†’â”‚ æ‰§è¡ŒSQL
    â”‚      â””â”€ delete()        â”‚
    â”‚                         â”‚
    â†â”€â”€â”€ è¿”å›Userå¯¹è±¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ‡å‡†DAOæ¥å£å®šä¹‰**ï¼š

```java
// ç”¨æˆ·DAOæ¥å£ - å®šä¹‰æ“ä½œè§„èŒƒ
public interface UserDAO {
    // ä¿å­˜ç”¨æˆ·
    void save(User user);
    
    // æ ¹æ®IDæŸ¥æ‰¾
    User findById(Long id);
    
    // æŸ¥æ‰¾æ‰€æœ‰
    List<User> findAll();
    
    // æ›´æ–°ç”¨æˆ·
    void update(User user);
    
    // åˆ é™¤ç”¨æˆ·
    void delete(Long id);
}
```

### 2.3 DAOæ¨¡å¼çš„å®ç°æ–¹å¼


**æ–¹å¼ä¸€ï¼šåŸºäºHibernate Session**

```java
public class UserDAOImpl implements UserDAO {
    
    // Hibernateçš„Sessionå°±åƒ"æ•°æ®åº“è¿æ¥å·¥å…·"
    private SessionFactory sessionFactory;
    
    @Override
    public void save(User user) {
        Session session = sessionFactory.getCurrentSession();
        session.save(user);  // Hibernateå¸®æˆ‘ä»¬å†™SQL
    }
    
    @Override
    public User findById(Long id) {
        Session session = sessionFactory.getCurrentSession();
        return session.get(User.class, id);
    }
}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨Spring Data JPAï¼ˆæ›´ç®€å•ï¼‰**

```java
// åªéœ€å®šä¹‰æ¥å£ï¼ŒSpringè‡ªåŠ¨å®ç°ï¼
public interface UserDAO extends JpaRepository<User, Long> {
    // ä¸éœ€è¦å†™å®ç°ä»£ç ï¼ŒSpringä¼šè‡ªåŠ¨ç”Ÿæˆ
}
```

### 2.4 DAOæ¨¡å¼çš„ä¼˜åŠ¿


| ä¼˜åŠ¿ | è¯´æ˜ | å®é™…æ•ˆæœ |
|-----|------|---------|
| **åˆ†ç¦»å…³æ³¨ç‚¹** | `ä¸šåŠ¡é€»è¾‘ä¸å…³å¿ƒSQLæ€ä¹ˆå†™` | ä¸šåŠ¡ä»£ç æ›´ç®€æ´ |
| **æ˜“äºæµ‹è¯•** | `å¯ä»¥Mock DAOè¿›è¡Œå•å…ƒæµ‹è¯•` | æµ‹è¯•æ›´æ–¹ä¾¿ |
| **åˆ‡æ¢æ•°æ®åº“** | `åªéœ€ä¿®æ”¹DAOå®ç°ï¼Œä¸šåŠ¡ä»£ç ä¸å˜` | çµæ´»æ€§é«˜ |
| **ä»£ç å¤ç”¨** | `ç›¸åŒçš„æ•°æ®æ“ä½œå¯ä»¥é‡å¤è°ƒç”¨` | å‡å°‘é‡å¤ä»£ç  |

---

## 3. ğŸ—‚ï¸ Repositoryæ¨¡å¼


### 3.1 Repository vs DAOçš„åŒºåˆ«


**é€šä¿—ç†è§£**ï¼š
- **DAO**ï¼šåƒ"æ•°æ®åº“æ“ä½œå·¥å…·" - ä¸“æ³¨äºæ•°æ®çš„å¢åˆ æ”¹æŸ¥
- **Repository**ï¼šåƒ"å¯¹è±¡ä»“åº“" - æ›´å…³æ³¨ä¸šåŠ¡å¯¹è±¡çš„ç®¡ç†

```
DAOæ€ç»´ï¼šæˆ‘è¦å¯¹æ•°æ®åº“åšä»€ä¹ˆæ“ä½œ
        â†“
        insertã€updateã€deleteã€select

Repositoryæ€ç»´ï¼šæˆ‘è¦å¯¹å¯¹è±¡åšä»€ä¹ˆæ“ä½œ
              â†“
              ä¿å­˜è®¢å•ã€æŸ¥æ‰¾ç”¨æˆ·ã€ç§»é™¤å•†å“
```

### 3.2 Repositoryæ¨¡å¼çš„ç‰¹ç‚¹


**æ ¸å¿ƒç†å¿µ**ï¼šæŠŠæ•°æ®åº“å½“æˆ"å¯¹è±¡ä»“åº“"æ¥ä½¿ç”¨

```
ä¼ ç»ŸDAOå†™æ³•ï¼š
userDAO.executeSQL("SELECT * FROM users WHERE age > 18");

Repositoryå†™æ³•ï¼š
userRepository.findAdultUsers();  // æ›´ç¬¦åˆä¸šåŠ¡è¯­è¨€
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```java
public interface UserRepository {
    
    // ä¸šåŠ¡åŒ–çš„æ–¹æ³•å â˜…
    User findByEmail(String email);
    
    List<User> findActiveUsers();
    
    List<User> findByAgeGreaterThan(int age);
    
    // å¤æ‚æŸ¥è¯¢ä¹Ÿç”¨ä¸šåŠ¡è¯­è¨€æè¿°
    List<User> findPremiumMembersInCity(String city);
}
```

### 3.3 Repositoryçš„å®ç°å±‚æ¬¡


```
é¢†åŸŸå±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
    â†“ è°ƒç”¨
UserRepositoryæ¥å£ï¼ˆå®šä¹‰ä¸šåŠ¡æ–¹æ³•ï¼‰
    â†“ å®ç°
UserRepositoryImplï¼ˆåº•å±‚ç”¨Hibernateï¼‰
    â†“ ä½¿ç”¨
Hibernate Sessionï¼ˆæ‰§è¡ŒSQLï¼‰
    â†“
æ•°æ®åº“
```

**å®ç°ç¤ºä¾‹**ï¼š

```java
public class UserRepositoryImpl implements UserRepository {
    
    @Autowired
    private SessionFactory sessionFactory;
    
    @Override
    public User findByEmail(String email) {
        return sessionFactory.getCurrentSession()
            .createQuery("FROM User WHERE email = :email", User.class)
            .setParameter("email", email)
            .uniqueResult();
    }
    
    @Override
    public List<User> findActiveUsers() {
        return sessionFactory.getCurrentSession()
            .createQuery("FROM User WHERE status = 'ACTIVE'", User.class)
            .list();
    }
}
```

### 3.4 ä½•æ—¶é€‰æ‹©Repository


âœ… **é€‚åˆä½¿ç”¨Repositoryçš„åœºæ™¯**ï¼š
- ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œéœ€è¦ä¸šåŠ¡åŒ–çš„æ–¹æ³•å
- éœ€è¦å°è£…å¤æ‚çš„æŸ¥è¯¢é€»è¾‘
- é‡‡ç”¨DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰
- å¼ºè°ƒä¸šåŠ¡æ¦‚å¿µè€Œéæ•°æ®åº“æ“ä½œ

âŒ **ç»§ç»­ä½¿ç”¨DAOçš„åœºæ™¯**ï¼š
- ç®€å•çš„CRUDæ“ä½œ
- æ•°æ®åº“æ“ä½œå¯¼å‘çš„ç³»ç»Ÿ
- ä¼ ç»Ÿä¸‰å±‚æ¶æ„

---

## 4. ğŸ¯ Serviceå±‚è®¾è®¡


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦Serviceå±‚


**ç”Ÿæ´»ç±»æ¯”**ï¼š

```
æ²¡æœ‰Serviceå±‚ï¼š
é¡¾å®¢ â†’ ç›´æ¥æ‰¾ä»“åº“ç®¡ç†å‘˜æ‹¿è´§
     ï¼ˆä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®æ··åœ¨ä¸€èµ·ï¼‰

æœ‰Serviceå±‚ï¼š
é¡¾å®¢ â†’ æ‰¾é”€å”®å‘˜ â†’ é”€å”®å‘˜åè°ƒä»“åº“
     ï¼ˆä¸šåŠ¡é€»è¾‘ â†’ Service â†’ DAO/Repositoryï¼‰
```

**Serviceå±‚çš„ä½œç”¨**ï¼š
- **ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ°** - æ‰€æœ‰ä¸šåŠ¡è§„åˆ™å†™åœ¨è¿™é‡Œ
- **äº‹åŠ¡ç®¡ç†** - æ§åˆ¶å¤šä¸ªæ“ä½œçš„ä¸€è‡´æ€§
- **è°ƒåº¦åè°ƒ** - è°ƒç”¨å¤šä¸ªDAO/Repositoryå®Œæˆå¤æ‚æ“ä½œ

### 4.2 Serviceå±‚çš„è®¾è®¡åŸåˆ™


**æ ‡å‡†ä¸‰å±‚ç»“æ„**ï¼š

```
Controllerï¼ˆæ§åˆ¶å™¨ï¼‰
    â†“ æ¥æ”¶è¯·æ±‚
Serviceï¼ˆä¸šåŠ¡å±‚ï¼‰â˜… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
    â†“ è°ƒç”¨
DAO/Repositoryï¼ˆæ•°æ®å±‚ï¼‰
    â†“
Databaseï¼ˆæ•°æ®åº“ï¼‰
```

**Serviceå±‚ç¤ºä¾‹**ï¼š

```java
@Service
public class OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private ProductRepository productRepository;
    
    @Autowired
    private UserRepository userRepository;
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šåˆ›å»ºè®¢å• â˜…
    @Transactional  // äº‹åŠ¡ç®¡ç†
    public Order createOrder(Long userId, Long productId, int quantity) {
        
        // 1. éªŒè¯ç”¨æˆ·
        User user = userRepository.findById(userId);
        if (user == null) {
            throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        }
        
        // 2. éªŒè¯å•†å“åº“å­˜
        Product product = productRepository.findById(productId);
        if (product.getStock() < quantity) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // 3. å‡å°‘åº“å­˜
        product.setStock(product.getStock() - quantity);
        productRepository.update(product);
        
        // 4. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUser(user);
        order.setProduct(product);
        order.setQuantity(quantity);
        orderRepository.save(order);
        
        return order;
    }
}
```

### 4.3 Serviceå±‚çš„äº‹åŠ¡ç®¡ç†


**äº‹åŠ¡å°±åƒ"é“¶è¡Œè½¬è´¦"**ï¼š

```
è½¬è´¦æ“ä½œå¿…é¡»"å…¨éƒ¨æˆåŠŸ"æˆ–"å…¨éƒ¨å¤±è´¥"ï¼š
1. ä»Aè´¦æˆ·æ‰£é’±  âœ“
2. ç»™Bè´¦æˆ·åŠ é’±  âœ“
â†’ éƒ½æˆåŠŸï¼Œæäº¤äº‹åŠ¡

å¦‚æœæ­¥éª¤2å¤±è´¥ï¼š
1. ä»Aè´¦æˆ·æ‰£é’±  âœ“
2. ç»™Bè´¦æˆ·åŠ é’±  âœ—
â†’ å›æ»šäº‹åŠ¡ï¼ŒAçš„é’±é€€å›
```

**Hibernateäº‹åŠ¡æ§åˆ¶**ï¼š

```java
@Transactional(rollbackFor = Exception.class)
public void transferMoney(Long fromId, Long toId, double amount) {
    
    Account from = accountRepository.findById(fromId);
    Account to = accountRepository.findById(toId);
    
    from.setBalance(from.getBalance() - amount);
    to.setBalance(to.getBalance() + amount);
    
    accountRepository.update(from);
    accountRepository.update(to);
    
    // å¦‚æœè¿™é‡ŒæŠ›å¼‚å¸¸ï¼Œå‰é¢çš„æ“ä½œéƒ½ä¼šå›æ»š
}
```

### 4.4 Serviceå±‚è®¾è®¡æœ€ä½³å®è·µ


**â­ æ ¸å¿ƒåŸåˆ™**ï¼š

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| **å•ä¸€èŒè´£** | ä¸€ä¸ªServiceåªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ | `UserService`åªç®¡ç”¨æˆ·ç›¸å…³ |
| **äº‹åŠ¡è¾¹ç•Œ** | äº‹åŠ¡åœ¨Serviceå±‚å¼€å¯å’Œæäº¤ | ç”¨`@Transactional`æ³¨è§£ |
| **ä¸ç›´æ¥æ“ä½œæ•°æ®åº“** | Serviceè°ƒç”¨DAO/Repository | ä¸åœ¨Serviceé‡Œå†™SQL |
| **ä¸šåŠ¡å¼‚å¸¸å¤„ç†** | æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸è€ŒéæŠ€æœ¯å¼‚å¸¸ | `throw new BusinessException()` |

---

## 5. ğŸ¨ é¢†åŸŸé©±åŠ¨è®¾è®¡DDD


### 5.1 ä»€ä¹ˆæ˜¯DDD


**DDD = Domain-Driven Designï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰**

**é€šä¿—è§£é‡Š**ï¼š
```
ä¼ ç»Ÿå¼€å‘æ€è·¯ï¼š
æ•°æ®åº“æœ‰ä»€ä¹ˆè¡¨ â†’ å°±åˆ›å»ºä»€ä¹ˆå¯¹è±¡ â†’ å›´ç»•è¡¨è®¾è®¡åŠŸèƒ½

DDDæ€è·¯ï¼š
ä¸šåŠ¡é¢†åŸŸæ˜¯ä»€ä¹ˆ â†’ å®šä¹‰é¢†åŸŸæ¨¡å‹ â†’ æ•°æ®åº“ä¸ºé¢†åŸŸæœåŠ¡
```

**ç”Ÿæ´»ç±»æ¯”**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼šåƒæŒ‰ç…§è¶…å¸‚è´§æ¶æ‘†æ”¾æ¥ç»„ç»‡è´­ç‰©æ¸…å•
DDDæ–¹å¼ï¼šåƒæŒ‰ç…§åšèœèœè°±æ¥å‡†å¤‡é£Ÿæ
```

### 5.2 DDDçš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å®ä½“ï¼ˆEntityï¼‰**ï¼šæœ‰å”¯ä¸€æ ‡è¯†çš„å¯¹è±¡

```java
// è®¢å•æ˜¯å®ä½“ï¼Œå› ä¸ºæœ‰å”¯ä¸€ID
@Entity
public class Order {
    @Id
    private Long orderId;  // å”¯ä¸€æ ‡è¯†
    
    private Date orderDate;
    private String status;
}
```

**ğŸ”¸ å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰**ï¼šæ²¡æœ‰å”¯ä¸€æ ‡è¯†ï¼Œç”±å±æ€§å€¼å†³å®š

```java
// åœ°å€æ˜¯å€¼å¯¹è±¡
public class Address {
    private String province;
    private String city;
    private String street;
    
    // ä¸¤ä¸ªåœ°å€æ‰€æœ‰å±æ€§ç›¸åŒå°±è®¤ä¸ºç›¸åŒ
}
```

**ğŸ”¸ èšåˆï¼ˆAggregateï¼‰**ï¼šä¸€ç»„å…³è”å¯¹è±¡çš„é›†åˆ

```java
// è®¢å•èšåˆï¼šè®¢å•æ˜¯èšåˆæ ¹
public class Order {
    @Id
    private Long id;
    
    // è®¢å•æ˜ç»†æ˜¯èšåˆçš„ä¸€éƒ¨åˆ†
    @OneToMany
    private List<OrderItem> items;
    
    // é€šè¿‡è®¢å•ï¼ˆèšåˆæ ¹ï¼‰æ“ä½œæ˜ç»†
    public void addItem(OrderItem item) {
        items.add(item);
    }
}
```

### 5.3 DDDåˆ†å±‚æ¶æ„


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·æ¥å£å±‚ï¼ˆUIï¼‰        â”‚ â† Controllerã€View
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨å±‚ï¼ˆApplicationï¼‰   â”‚ â† Serviceï¼ˆåè°ƒï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é¢†åŸŸå±‚ï¼ˆDomainï¼‰â˜…       â”‚ â† å®ä½“ã€å€¼å¯¹è±¡ã€é¢†åŸŸæœåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructureï¼‰â”‚ â† Repositoryå®ç°ã€Hibernate
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡ç‚¹â˜…**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ”¾åœ¨**é¢†åŸŸå±‚**

```java
// é¢†åŸŸå±‚ï¼šè®¢å•å®ä½“åŒ…å«ä¸šåŠ¡é€»è¾‘
@Entity
public class Order {
    
    private OrderStatus status;
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šå–æ¶ˆè®¢å•
    public void cancel() {
        if (status == OrderStatus.SHIPPED) {
            throw new BusinessException("å·²å‘è´§è®¢å•ä¸èƒ½å–æ¶ˆ");
        }
        this.status = OrderStatus.CANCELLED;
    }
    
    // ä¸šåŠ¡æ–¹æ³•ï¼šè®¡ç®—æ€»ä»·
    public double calculateTotal() {
        return items.stream()
                   .mapToDouble(item -> item.getPrice() * item.getQuantity())
                   .sum();
    }
}
```

### 5.4 DDDä¸Hibernateçš„ç»“åˆ


**Repositoryåœ¨DDDä¸­çš„è§’è‰²**ï¼š

```java
// é¢†åŸŸå±‚å®šä¹‰æ¥å£
public interface OrderRepository {
    Order findById(Long id);
    void save(Order order);
    List<Order> findByUser(User user);
}

// åŸºç¡€è®¾æ–½å±‚ç”¨Hibernateå®ç°
public class HibernateOrderRepository implements OrderRepository {
    
    @Autowired
    private SessionFactory sessionFactory;
    
    @Override
    public Order findById(Long id) {
        return sessionFactory.getCurrentSession()
                           .get(Order.class, id);
    }
}
```

---

## 6. ğŸ“Š åˆ†å±‚æ¶æ„å®è·µ


### 6.1 ç»å…¸ä¸‰å±‚æ¶æ„


**åŸºç¡€ç»“æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨ç°å±‚(Web)   â”‚ â† JSPã€Controllerã€REST API
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸šåŠ¡å±‚(Service)â”‚ â† ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŒä¹…å±‚(DAO)   â”‚ â† æ•°æ®è®¿é—®ã€Hibernate
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    æ•°æ®åº“
```

**ç›®å½•ç»“æ„ç¤ºä¾‹**ï¼š

```
com.example.project
â”œâ”€â”€ controller/          # è¡¨ç°å±‚
â”‚   â””â”€â”€ UserController.java
â”œâ”€â”€ service/            # ä¸šåŠ¡å±‚
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ UserServiceImpl.java
â”œâ”€â”€ dao/                # æŒä¹…å±‚
â”‚   â”œâ”€â”€ UserDAO.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ UserDAOImpl.java
â””â”€â”€ entity/             # å®ä½“ç±»
    â””â”€â”€ User.java
```

### 6.2 å››å±‚æ¶æ„ï¼ˆåŠ å…¥é¢†åŸŸå±‚ï¼‰


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡¨ç°å±‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨æœåŠ¡å±‚    â”‚ â† åè°ƒé¢†åŸŸå¯¹è±¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¢†åŸŸå±‚ â˜…      â”‚ â† æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºç¡€è®¾æ–½å±‚    â”‚ â† æ•°æ®è®¿é—®ã€æŠ€æœ¯å®ç°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 åˆ†å±‚çš„ä¾èµ–è§„åˆ™


**ä¾èµ–æ–¹å‘å›¾ç¤º**ï¼š

```
Controller â†’ Service â†’ DAO â†’ Hibernate
   â†“           â†“         â†“
 (è°ƒç”¨)      (è°ƒç”¨)    (ä½¿ç”¨)

âš ï¸ ç¦æ­¢åå‘ä¾èµ–ï¼
DAOä¸èƒ½è°ƒç”¨Service
Serviceä¸èƒ½ç›´æ¥ç”¨Controllerçš„ä¸œè¥¿
```

**ä¾èµ–æ³¨å…¥æ–¹å¼**ï¼š

```java
@Controller
public class UserController {
    
    @Autowired  // Springæ³¨å…¥Service
    private UserService userService;
    
    public String getUser(Long id) {
        User user = userService.findById(id);
        return "user-detail";
    }
}

@Service
public class UserServiceImpl implements UserService {
    
    @Autowired  // Springæ³¨å…¥DAO
    private UserDAO userDAO;
    
    public User findById(Long id) {
        return userDAO.findById(id);
    }
}
```

---

## 7. ğŸ’‰ ä¾èµ–æ³¨å…¥åœ¨ORMä¸­çš„åº”ç”¨


### 7.1 ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥


**é€šä¿—ç†è§£**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆè‡ªå·±newå¯¹è±¡ï¼‰ï¼š
public class UserService {
    private UserDAO userDAO = new UserDAOImpl();  // å†™æ­»äº†
}

ä¾èµ–æ³¨å…¥ï¼ˆåˆ«äººç»™ä½ å¯¹è±¡ï¼‰ï¼š
public class UserService {
    @Autowired
    private UserDAO userDAO;  // Springå¸®ä½ æ³¨å…¥
}
```

**å¥½å¤„**ï¼š
- âœ… è§£è€¦ï¼šä¸å†™æ­»å…·ä½“å®ç°
- âœ… æ˜“æµ‹è¯•ï¼šå¯ä»¥æ³¨å…¥Mockå¯¹è±¡
- âœ… çµæ´»ï¼šå¯ä»¥éšæ—¶åˆ‡æ¢å®ç°

### 7.2 Springç®¡ç†Hibernateçš„ä¾èµ–


**é…ç½®SessionFactory**ï¼š

```java
@Configuration
public class HibernateConfig {
    
    @Bean
    public SessionFactory sessionFactory() {
        return new Configuration()
                .configure()
                .buildSessionFactory();
    }
}
```

**æ³¨å…¥ä½¿ç”¨**ï¼š

```java
@Repository
public class UserDAOImpl implements UserDAO {
    
    @Autowired
    private SessionFactory sessionFactory;  // Springè‡ªåŠ¨æ³¨å…¥
    
    public User findById(Long id) {
        Session session = sessionFactory.getCurrentSession();
        return session.get(User.class, id);
    }
}
```

### 7.3 äº‹åŠ¡ç®¡ç†çš„ä¾èµ–æ³¨å…¥


```java
@Configuration
@EnableTransactionManagement  // å¼€å¯äº‹åŠ¡ç®¡ç†
public class TransactionConfig {
    
    @Bean
    public HibernateTransactionManager transactionManager(
            SessionFactory sessionFactory) {
        return new HibernateTransactionManager(sessionFactory);
    }
}
```

**ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡**ï¼š

```java
@Service
public class OrderService {
    
    @Transactional  // Springè‡ªåŠ¨ç®¡ç†äº‹åŠ¡
    public void createOrder(Order order) {
        // ä¸éœ€è¦æ‰‹åŠ¨å¼€å¯ã€æäº¤ã€å›æ»šäº‹åŠ¡
        orderDAO.save(order);
    }
}
```

---

## 8. ğŸ”§ å¸¸ç”¨è®¾è®¡æ¨¡å¼åº”ç”¨


### 8.1 å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰


**ä½œç”¨**ï¼šåˆ›å»ºå¯¹è±¡çš„å·¥å‚

```java
// SessionFactoryå°±æ˜¯å·¥å‚æ¨¡å¼
public class HibernateUtil {
    
    private static SessionFactory factory;
    
    static {
        factory = new Configuration()
                     .configure()
                     .buildSessionFactory();
    }
    
    public static Session getSession() {
        return factory.openSession();  // å·¥å‚ç”Ÿäº§Session
    }
}
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
- åˆ›å»ºä¸åŒç±»å‹çš„DAOå®ä¾‹
- æ ¹æ®é…ç½®åˆ›å»ºä¸åŒçš„æ•°æ®æº

### 8.2 ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰


**ä½œç”¨**ï¼šæ ¹æ®ä¸åŒæƒ…å†µä½¿ç”¨ä¸åŒçš„ç®—æ³•

```java
// ä¸åŒçš„æŸ¥è¯¢ç­–ç•¥
public interface QueryStrategy {
    List<User> execute(Session session);
}

// æŒ‰å¹´é¾„æŸ¥è¯¢
public class AgeQueryStrategy implements QueryStrategy {
    private int minAge;
    
    public List<User> execute(Session session) {
        return session.createQuery(
            "FROM User WHERE age >= :age", User.class)
            .setParameter("age", minAge)
            .list();
    }
}

// æŒ‰åŸå¸‚æŸ¥è¯¢
public class CityQueryStrategy implements QueryStrategy {
    private String city;
    
    public List<User> execute(Session session) {
        return session.createQuery(
            "FROM User WHERE city = :city", User.class)
            .setParameter("city", city)
            .list();
    }
}
```

### 8.3 è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰


**ä½œç”¨**ï¼šå¯¹è±¡çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨é€šçŸ¥å…¶ä»–å¯¹è±¡

**Hibernateäº‹ä»¶ç›‘å¬**ï¼š

```java
// å®ä½“å˜åŒ–ç›‘å¬å™¨
public class UserListener {
    
    @PrePersist  // ä¿å­˜ä¹‹å‰
    public void beforeSave(User user) {
        System.out.println("å³å°†ä¿å­˜ç”¨æˆ·ï¼š" + user.getName());
    }
    
    @PostPersist  // ä¿å­˜ä¹‹å
    public void afterSave(User user) {
        System.out.println("ç”¨æˆ·å·²ä¿å­˜ï¼š" + user.getId());
    }
}

// åœ¨å®ä½“ä¸Šä½¿ç”¨
@Entity
@EntityListeners(UserListener.class)
public class User {
    // ...
}
```

---

## 9. ğŸ“ è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ


### 9.1 SOLIDåŸåˆ™åœ¨ORMä¸­çš„åº”ç”¨


**ğŸ”¸ å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰**

```java
âŒ ä¸å¥½çš„è®¾è®¡ï¼š
public class UserService {
    public void saveUser() { }
    public void sendEmail() { }      // èŒè´£æ··ä¹±
    public void generateReport() { }
}

âœ… å¥½çš„è®¾è®¡ï¼š
public class UserService {
    public void saveUser() { }  // åªè´Ÿè´£ç”¨æˆ·ä¸šåŠ¡
}

public class EmailService {
    public void sendEmail() { }  // ä¸“é—¨è´Ÿè´£é‚®ä»¶
}
```

**ğŸ”¸ å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰**

```java
// å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
public interface UserRepository {
    User findById(Long id);
}

// å¯ä»¥å¢åŠ æ–°å®ç°ï¼Œä¸ä¿®æ”¹åŸæœ‰ä»£ç 
public class CachedUserRepository implements UserRepository {
    
    @Autowired
    private UserRepository delegate;  // å§”æ‰˜ç»™åŸå®ç°
    
    private Map<Long, User> cache = new HashMap<>();
    
    public User findById(Long id) {
        if (cache.containsKey(id)) {
            return cache.get(id);  // ä»ç¼“å­˜è¯»å–
        }
        User user = delegate.findById(id);
        cache.put(id, user);
        return user;
    }
}
```

**ğŸ”¸ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰**

```java
// ä¾èµ–æŠ½è±¡ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
public class OrderService {
    
    private OrderRepository repository;  // ä¾èµ–æ¥å£
    
    public OrderService(OrderRepository repository) {
        this.repository = repository;
    }
}
```

### 9.2 æœ€ä½³å®è·µæ¸…å•


âœ… **å¿…é¡»éµå®ˆçš„è§„èŒƒ**ï¼š

| å®è·µ | è¯´æ˜ | é‡è¦æ€§ |
|-----|------|--------|
| **äº‹åŠ¡åœ¨Serviceå±‚** | ä¸è¦åœ¨DAOå±‚å¼€äº‹åŠ¡ | â­â­â­ |
| **Sessionä¸è·¨å±‚ä¼ é€’** | Sessionåªåœ¨DAOå±‚ä½¿ç”¨ | â­â­â­ |
| **å®ä½“ç±»è¦åºåˆ—åŒ–** | å®ç°`Serializable`æ¥å£ | â­â­ |
| **å»¶è¿ŸåŠ è½½æ…ç”¨** | æ³¨æ„LazyInitializationException | â­â­â­ |
| **é¿å…N+1æŸ¥è¯¢** | ä½¿ç”¨JOIN FETCHä¼˜åŒ– | â­â­â­ |

**âš ï¸ å¸¸è§é”™è¯¯ç¤ºä¾‹**ï¼š

```java
âŒ é”™è¯¯ï¼šSessionè·¨å±‚ä¼ é€’
public class UserDAO {
    public Session getSession() {
        return sessionFactory.getCurrentSession();
    }
}

public class UserService {
    Session session = userDAO.getSession();  // ä¸è¦è¿™æ ·ï¼
}

âœ… æ­£ç¡®ï¼šå°è£…åœ¨DAOå†…éƒ¨
public class UserDAO {
    public User findById(Long id) {
        Session session = sessionFactory.getCurrentSession();
        return session.get(User.class, id);
    }
}
```

### 9.3 æ€§èƒ½ä¼˜åŒ–åŸåˆ™


**æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥**ï¼š

```java
// 1. é¿å…N+1é—®é¢˜
âŒ ä¸å¥½ï¼š
List<Order> orders = session.createQuery("FROM Order", Order.class).list();
for (Order order : orders) {
    order.getCustomer().getName();  // æ¯ä¸ªè®¢å•éƒ½æŸ¥ä¸€æ¬¡å®¢æˆ·ï¼
}

âœ… æ”¹è¿›ï¼š
List<Order> orders = session.createQuery(
    "FROM Order o JOIN FETCH o.customer", Order.class).list();
```

**ç¼“å­˜ä½¿ç”¨åŸåˆ™**ï¼š

```
ä¸€çº§ç¼“å­˜ï¼ˆSessionçº§åˆ«ï¼‰ï¼š
    â†’ è‡ªåŠ¨å¼€å¯ï¼ŒåŒä¸€Sessionå†…æœ‰æ•ˆ

äºŒçº§ç¼“å­˜ï¼ˆSessionFactoryçº§åˆ«ï¼‰ï¼š
    â†’ éœ€è¦é…ç½®ï¼Œé€‚åˆä¸å¸¸å˜çš„æ•°æ®
    â†’ è¯»å¤šå†™å°‘çš„åœºæ™¯

æŸ¥è¯¢ç¼“å­˜ï¼š
    â†’ ç¼“å­˜æŸ¥è¯¢ç»“æœ
    â†’ å‚æ•°ç›¸åŒæ—¶ç›´æ¥è¿”å›
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 æ¶æ„æ¨¡å¼å¯¹æ¯”


| æ¨¡å¼ | æ ¸å¿ƒä½œç”¨ | é€‚ç”¨åœºæ™¯ | å…³é”®ç‰¹ç‚¹ |
|-----|---------|---------|---------|
| **DAO** | `æ•°æ®è®¿é—®å°è£…` | ç®€å•CRUD | é¢å‘æ•°æ®åº“æ“ä½œ |
| **Repository** | `å¯¹è±¡ä»“åº“ç®¡ç†` | å¤æ‚ä¸šåŠ¡ | é¢å‘é¢†åŸŸå¯¹è±¡ |
| **Service** | `ä¸šåŠ¡é€»è¾‘ç¼–æ’` | æ‰€æœ‰é¡¹ç›® | äº‹åŠ¡ç®¡ç†ä¸­å¿ƒ |
| **DDD** | `é¢†åŸŸé©±åŠ¨è®¾è®¡` | å¤æ‚ç³»ç»Ÿ | ä¸šåŠ¡ä¸ºæ ¸å¿ƒ |

### 10.2 åˆ†å±‚æ¶æ„è¦ç‚¹


```
æ¶æ„åˆ†å±‚è®°å¿†æ³•ï¼š

è¡¨ç°å±‚ï¼šæ¥æ”¶è¯·æ±‚ï¼Œå±•ç¤ºç»“æœ
        â†“
ä¸šåŠ¡å±‚ï¼šå¤„ç†é€»è¾‘ï¼Œç®¡ç†äº‹åŠ¡ â˜… æ ¸å¿ƒ
        â†“
æŒä¹…å±‚ï¼šè®¿é—®æ•°æ®ï¼Œæ‰§è¡ŒSQL
        â†“
æ•°æ®åº“ï¼šå­˜å‚¨æ•°æ®
```

### 10.3 è®¾è®¡åŸåˆ™é€Ÿè®°


**äº”å¤§åŸåˆ™**ï¼š
1. **å•ä¸€èŒè´£** - ä¸€ä¸ªç±»åªåšä¸€ä»¶äº‹
2. **å¼€é—­åŸåˆ™** - å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
3. **é‡Œæ°æ›¿æ¢** - å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»
4. **æ¥å£éš”ç¦»** - æ¥å£è¦å°è€Œä¸“
5. **ä¾èµ–å€’ç½®** - ä¾èµ–æŠ½è±¡ä¸ä¾èµ–å…·ä½“

### 10.4 å®æˆ˜å…³é”®ç‚¹


> **äº‹åŠ¡ç®¡ç†**ï¼šæ”¾åœ¨Serviceå±‚ï¼Œç”¨`@Transactional`æ³¨è§£

> **ä¾èµ–æ³¨å…¥**ï¼šç”¨`@Autowired`æˆ–æ„é€ å™¨æ³¨å…¥

> **Sessionç®¡ç†**ï¼šä¸è¦è·¨å±‚ä¼ é€’ï¼Œå°è£…åœ¨DAOå†…éƒ¨

> **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨JOIN FETCHé¿å…N+1ï¼Œåˆç†ä½¿ç”¨ç¼“å­˜

**è®°å¿†å£è¯€**ï¼š
```
DAOè´Ÿè´£æ•°æ®è®¿é—®ï¼ŒRepositoryç®¡ç†å¯¹è±¡
Serviceç¼–æ’ä¸šåŠ¡é€»è¾‘ï¼Œåˆ†å±‚æ¶æ„è¦è®°ç‰¢
ä¾èµ–æ³¨å…¥è§£è€¦åˆï¼Œäº‹åŠ¡ç®¡ç†åœ¨æœåŠ¡å±‚
è®¾è®¡æ¨¡å¼çµæ´»ç”¨ï¼Œæ€§èƒ½ä¼˜åŒ–ä¸èƒ½å¿˜
```