---
title: 31ã€HQLè¯­æ³•åŸºç¡€
---
## ğŸ“š ç›®å½•

1. [HQLæ˜¯ä»€ä¹ˆ](#1-HQLæ˜¯ä»€ä¹ˆ)
2. [HQLåŸºç¡€è¯­æ³•](#2-HQLåŸºç¡€è¯­æ³•)
3. [FROMå­å¥è¯¦è§£](#3-FROMå­å¥è¯¦è§£)
4. [SELECTå­å¥è¯¦è§£](#4-SELECTå­å¥è¯¦è§£)
5. [WHEREæ¡ä»¶æŸ¥è¯¢](#5-WHEREæ¡ä»¶æŸ¥è¯¢)
6. [ORDER BYæ’åº](#6-ORDER-BYæ’åº)
7. [é¢å‘å¯¹è±¡æŸ¥è¯¢ç‰¹æ€§](#7-é¢å‘å¯¹è±¡æŸ¥è¯¢ç‰¹æ€§)
8. [HQLä¸SQLçš„åŒºåˆ«](#8-HQLä¸SQLçš„åŒºåˆ«)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ HQLæ˜¯ä»€ä¹ˆ


### 1.1 HQLçš„å®šä¹‰ä¸ä½œç”¨


> ğŸ“– **æ ¸å¿ƒæ¦‚å¿µ**  
> HQLï¼ˆHibernate Query Languageï¼‰æ˜¯Hibernateæ¡†æ¶æä¾›çš„**é¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€**ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ç”¨æ“ä½œJavaå¯¹è±¡çš„æ–¹å¼æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
```
ä¼ ç»ŸSQLæŸ¥è¯¢å°±åƒï¼š
"ç»™æˆ‘ä»studentè¡¨é‡Œæ‰¾æ‰€æœ‰å¹´é¾„å¤§äº20çš„è®°å½•"
â†’ ç›´æ¥æ“ä½œæ•°æ®åº“è¡¨å’Œå­—æ®µ

HQLæŸ¥è¯¢å°±åƒï¼š
"ç»™æˆ‘æ‰¾æ‰€æœ‰å¹´é¾„å¤§äº20çš„Studentå¯¹è±¡"
â†’ æ“ä½œçš„æ˜¯Javaç±»å’Œå±æ€§ï¼Œä¸å…³å¿ƒåº•å±‚è¡¨ç»“æ„
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦HQLï¼Ÿ


**âŒ ä¼ ç»ŸSQLæ–¹å¼çš„é—®é¢˜**ï¼š
```java
// ä½¿ç”¨åŸç”ŸSQLæŸ¥è¯¢
String sql = "SELECT * FROM t_student WHERE age > 20";
// é—®é¢˜1ï¼šéœ€è¦çŸ¥é“æ•°æ®åº“è¡¨åt_student
// é—®é¢˜2ï¼šéœ€è¦çŸ¥é“æ•°æ®åº“å­—æ®µåage
// é—®é¢˜3ï¼šæŸ¥è¯¢ç»“æœéœ€è¦æ‰‹åŠ¨è½¬æ¢ä¸ºJavaå¯¹è±¡
```

**âœ… HQLæ–¹å¼çš„ä¼˜åŠ¿**ï¼š
```java
// ä½¿ç”¨HQLæŸ¥è¯¢
String hql = "FROM Student WHERE age > 20";
// ä¼˜åŠ¿1ï¼šä½¿ç”¨Javaç±»åStudentï¼Œä¸ç”¨ç®¡è¡¨å
// ä¼˜åŠ¿2ï¼šä½¿ç”¨Javaå±æ€§åageï¼Œä¸ç”¨ç®¡å­—æ®µå
// ä¼˜åŠ¿3ï¼šè‡ªåŠ¨è¿”å›Studentå¯¹è±¡åˆ—è¡¨
```

### 1.3 HQLçš„æ ¸å¿ƒç‰¹ç‚¹


```
ğŸ¯ **é¢å‘å¯¹è±¡**
   æ“ä½œå¯¹è±¡ â†’ ä¸æ˜¯è¡¨
   æ“ä½œå±æ€§ â†’ ä¸æ˜¯å­—æ®µ
   
ğŸ’ª **æ•°æ®åº“æ— å…³æ€§**
   åŒä¸€å¥—HQL â†’ å¯ä»¥åœ¨MySQLã€Oracleç­‰æ•°æ®åº“ä¸Šè¿è¡Œ
   Hibernateè‡ªåŠ¨è½¬æ¢ â†’ é€‚é…ä¸åŒæ•°æ®åº“çš„SQLè¯­æ³•
   
ğŸ”„ **è‡ªåŠ¨æ˜ å°„**
   æŸ¥è¯¢ç»“æœ â†’ è‡ªåŠ¨å°è£…ä¸ºå¯¹è±¡
   å…³è”å¯¹è±¡ â†’ è‡ªåŠ¨åŠ è½½å’Œå¡«å……
```

---

## 2. ğŸ“ HQLåŸºç¡€è¯­æ³•


### 2.1 HQLè¯­æ³•è§„åˆ™


**åŸºæœ¬ç»“æ„**ï¼š
```
SELECT/FROM/WHERE/ORDER BYçš„ç»„åˆä½¿ç”¨

æœ€ç®€å•çš„HQLï¼š
FROM å®ä½“ç±»å

å®Œæ•´çš„HQLï¼š
SELECT å±æ€§
FROM å®ä½“ç±»å [åˆ«å]
WHERE æ¡ä»¶
ORDER BY æ’åºå­—æ®µ
```

### 2.2 å¤§å°å†™è§„åˆ™


> âš ï¸ **é‡è¦æé†’**  
> HQLå¯¹å¤§å°å†™çš„è¦æ±‚ï¼š
> - **ç±»åå’Œå±æ€§å**ï¼šä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼ˆå¿…é¡»å’ŒJavaç±»ä¿æŒä¸€è‡´ï¼‰
> - **å…³é”®å­—**ï¼šä¸åŒºåˆ†å¤§å°å†™ï¼ˆFROMã€fromã€Froméƒ½å¯ä»¥ï¼‰

**ç¤ºä¾‹å¯¹æ¯”**ï¼š
```java
// âœ… æ­£ç¡®å†™æ³•
"FROM Student WHERE name = 'Tom'"  // Studentæ˜¯ç±»åï¼Œnameæ˜¯å±æ€§

// âŒ é”™è¯¯å†™æ³•
"FROM student WHERE Name = 'Tom'"  // studentå°å†™ã€Nameå¤§å†™éƒ½é”™äº†
```

### 2.3 å‚æ•°ç»‘å®šæ–¹å¼


**æ–¹å¼ä¸€ï¼šä½ç½®å‚æ•°ï¼ˆä½¿ç”¨?å ä½ç¬¦ï¼‰**
```java
String hql = "FROM Student WHERE age > ? AND name = ?";
Query query = session.createQuery(hql);
query.setParameter(0, 20);      // ç¬¬ä¸€ä¸ª?çš„å€¼
query.setParameter(1, "Tom");   // ç¬¬äºŒä¸ª?çš„å€¼
```

**æ–¹å¼äºŒï¼šå‘½åå‚æ•°ï¼ˆä½¿ç”¨:å‚æ•°åï¼‰**
```java
String hql = "FROM Student WHERE age > :minAge AND name = :stuName";
Query query = session.createQuery(hql);
query.setParameter("minAge", 20);     // ç»™minAgeèµ‹å€¼
query.setParameter("stuName", "Tom"); // ç»™stuNameèµ‹å€¼
```

**ğŸ¯ æ¨èä½¿ç”¨å‘½åå‚æ•°**ï¼š
- å¯è¯»æ€§æ›´å¥½ï¼ˆä¸€çœ¼çœ‹å‡ºå‚æ•°å«ä¹‰ï¼‰
- ä¸å®¹æ˜“å‡ºé”™ï¼ˆä¸ç”¨è®°ä½ç½®ï¼‰
- å‚æ•°é¡ºåºå¯ä»¥éšæ„è°ƒæ•´

---

## 3. ğŸ” FROMå­å¥è¯¦è§£


### 3.1 FROMçš„åŸºæœ¬ç”¨æ³•


**æœ€ç®€å•çš„æŸ¥è¯¢**ï¼š
```java
// æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ
String hql = "FROM Student";
List<Student> students = session.createQuery(hql).list();

// ğŸ’¡ è¿™å¥è¯çš„æ„æ€ï¼š
// "ç»™æˆ‘æ‰€æœ‰çš„Studentå¯¹è±¡"
// Hibernateä¼šè‡ªåŠ¨ç¿»è¯‘æˆï¼šSELECT * FROM t_student
```

### 3.2 ä½¿ç”¨åˆ«å


**ä¸ºä»€ä¹ˆéœ€è¦åˆ«åï¼Ÿ**
```
å½“HQLè¯­å¥å¤æ‚æ—¶ï¼Œé‡å¤å†™é•¿é•¿çš„ç±»åå¾ˆéº»çƒ¦
ä½¿ç”¨åˆ«åå¯ä»¥ç®€åŒ–ä¹¦å†™
```

**åˆ«åä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// ä¸ç”¨åˆ«åï¼ˆéº»çƒ¦ï¼‰
String hql = "FROM Student WHERE Student.age > 20";

// ä½¿ç”¨åˆ«åï¼ˆç®€æ´ï¼‰
String hql = "FROM Student s WHERE s.age > 20";
//              â†‘ ç±»å  â†‘ åˆ«å  ç”¨sä»£æ›¿Student
```

**ğŸ”¸ åˆ«åè§„èŒƒ**ï¼š
- ä¹ æƒ¯ç”¨ç±»åé¦–å­—æ¯å°å†™ä½œä¸ºåˆ«å
- `Student â†’ s`
- `Teacher â†’ t`
- `Course â†’ c`

### 3.3 å¤šè¡¨æŸ¥è¯¢


**å…³è”æŸ¥è¯¢ï¼ˆä½¿ç”¨JOINï¼‰**ï¼š
```java
// æŸ¥è¯¢å­¦ç”ŸåŠå…¶æ‰€åœ¨ç­çº§
String hql = "FROM Student s JOIN s.clazz c";
//                            â†‘ s.clazzæ˜¯Studentç±»ä¸­çš„ç­çº§å±æ€§
//                            ä¸æ˜¯æ•°æ®åº“çš„å¤–é”®å­—æ®µï¼

// ğŸ’¡ è¿™é‡Œä½“ç°äº†é¢å‘å¯¹è±¡ï¼š
// é€šè¿‡Studentå¯¹è±¡çš„clazzå±æ€§æ¥å…³è”ï¼Œè€Œä¸æ˜¯é€šè¿‡å¤–é”®
```

**ğŸ”„ æŸ¥è¯¢æµç¨‹ç¤ºæ„**ï¼š
```
Javaå¯¹è±¡å±‚é¢ï¼š
Studentå¯¹è±¡ â”€â”€clazzå±æ€§â”€â”€> Clazzå¯¹è±¡

Hibernateè‡ªåŠ¨å¤„ç†ï¼š
Studentå¯¹è±¡ â”€â”€æ‰¾åˆ°å…³è”å…³ç³»â”€â”€> æŸ¥è¯¢æ˜ å°„é…ç½®
           â”€â”€ç”ŸæˆSQL JOINâ”€â”€> æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
           â”€â”€å°è£…ç»“æœâ”€â”€â”€â”€> è¿”å›å¯¹è±¡
```

---

## 4. ğŸ“Š SELECTå­å¥è¯¦è§£


### 4.1 æŸ¥è¯¢å®Œæ•´å¯¹è±¡ vs æŸ¥è¯¢éƒ¨åˆ†å±æ€§


**æŸ¥è¯¢å®Œæ•´å¯¹è±¡**ï¼š
```java
// æ–¹å¼1ï¼šçœç•¥SELECTï¼ˆé»˜è®¤æŸ¥è¯¢æ•´ä¸ªå¯¹è±¡ï¼‰
String hql = "FROM Student";
// è¿”å›ï¼šList<Student>ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«æ‰€æœ‰å±æ€§

// æ–¹å¼2ï¼šæ˜¾å¼æŒ‡å®šSELECT
String hql = "SELECT s FROM Student s";
// è¿”å›ï¼šList<Student>ï¼Œç»“æœä¸€æ ·
```

**æŸ¥è¯¢éƒ¨åˆ†å±æ€§**ï¼š
```java
// åªæŸ¥è¯¢å­¦ç”Ÿå§“åå’Œå¹´é¾„
String hql = "SELECT s.name, s.age FROM Student s";
// è¿”å›ï¼šList<Object[]>
// æ¯ä¸ªObject[]æ˜¯ï¼š[å§“å, å¹´é¾„]

// ä½¿ç”¨ç¤ºä¾‹
List<Object[]> results = session.createQuery(hql).list();
for (Object[] row : results) {
    String name = (String) row[0];  // ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å§“å
    Integer age = (Integer) row[1]; // ç¬¬äºŒä¸ªå…ƒç´ æ˜¯å¹´é¾„
    System.out.println(name + " - " + age);
}
```

### 4.2 æŸ¥è¯¢å•ä¸ªå±æ€§


```java
// æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå§“å
String hql = "SELECT s.name FROM Student s";
// è¿”å›ï¼šList<String>

// ä½¿ç”¨ç¤ºä¾‹
List<String> names = session.createQuery(hql).list();
for (String name : names) {
    System.out.println(name);
}
```

### 4.3 ä½¿ç”¨èšåˆå‡½æ•°


**å¸¸ç”¨èšåˆå‡½æ•°**ï¼š
```
count()  â†’ ç»Ÿè®¡æ•°é‡
sum()    â†’ æ±‚å’Œ
avg()    â†’ å¹³å‡å€¼
max()    â†’ æœ€å¤§å€¼
min()    â†’ æœ€å°å€¼
```

**ç¤ºä¾‹**ï¼š
```java
// ç»Ÿè®¡å­¦ç”Ÿæ€»æ•°
String hql = "SELECT count(*) FROM Student";
Long count = (Long) session.createQuery(hql).uniqueResult();

// è®¡ç®—å¹³å‡å¹´é¾„
String hql = "SELECT avg(s.age) FROM Student s";
Double avgAge = (Double) session.createQuery(hql).uniqueResult();

// æŸ¥è¯¢æœ€é«˜åˆ†
String hql = "SELECT max(s.score) FROM Student s";
Integer maxScore = (Integer) session.createQuery(hql).uniqueResult();
```

> ğŸ’¡ **uniqueResult()è¯´æ˜**  
> å½“ç¡®å®šæŸ¥è¯¢ç»“æœåªæœ‰ä¸€æ¡è®°å½•æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚countã€avgç­‰èšåˆæŸ¥è¯¢

---

## 5. ğŸ” WHEREæ¡ä»¶æŸ¥è¯¢


### 5.1 åŸºæœ¬æ¡ä»¶è¿ç®—ç¬¦


**æ¯”è¾ƒè¿ç®—ç¬¦**ï¼š
```
=     ç­‰äº
<>    ä¸ç­‰äº
>     å¤§äº
>=    å¤§äºç­‰äº
<     å°äº
<=    å°äºç­‰äº
```

**ç¤ºä¾‹**ï¼š
```java
// æŸ¥è¯¢å¹´é¾„å¤§äº20çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.age > 20";

// æŸ¥è¯¢æˆç»©ç­‰äº100çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.score = 100";

// æŸ¥è¯¢å¹´é¾„åœ¨18åˆ°25ä¹‹é—´çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.age >= 18 AND s.age <= 25";
```

### 5.2 é€»è¾‘è¿ç®—ç¬¦


```
AND  å¹¶ä¸”ï¼ˆåŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶ï¼‰
OR   æˆ–è€…ï¼ˆæ»¡è¶³ä»»ä¸€æ¡ä»¶ï¼‰
NOT  éï¼ˆä¸æ»¡è¶³æ¡ä»¶ï¼‰
```

**ç»„åˆä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// ANDï¼šå¹´é¾„å¤§äº20ä¸”æˆç»©å¤§äº80
String hql = "FROM Student s WHERE s.age > 20 AND s.score > 80";

// ORï¼šå¹´é¾„å°äº18æˆ–å¤§äº60
String hql = "FROM Student s WHERE s.age < 18 OR s.age > 60";

// NOTï¼šå¹´é¾„ä¸ç­‰äº20
String hql = "FROM Student s WHERE NOT s.age = 20";
// ç­‰ä»·äºï¼šWHERE s.age <> 20
```

### 5.3 ç‰¹æ®Šæ¡ä»¶


**ğŸ”¸ BETWEENèŒƒå›´æŸ¥è¯¢**ï¼š
```java
// å¹´é¾„åœ¨18åˆ°25ä¹‹é—´
String hql = "FROM Student s WHERE s.age BETWEEN 18 AND 25";

// ğŸ’¡ ç­‰ä»·äºï¼š
String hql = "FROM Student s WHERE s.age >= 18 AND s.age <= 25";
```

**ğŸ”¸ INåˆ—è¡¨æŸ¥è¯¢**ï¼š
```java
// æŸ¥è¯¢ç‰¹å®šå¹´é¾„çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.age IN (18, 20, 22)";

// ğŸ’¡ æ„æ€æ˜¯ï¼šå¹´é¾„æ˜¯18ã€20æˆ–22çš„å­¦ç”Ÿ
```

**ğŸ”¸ LIKEæ¨¡ç³ŠæŸ¥è¯¢**ï¼š
```java
// æŸ¥è¯¢å§“ååŒ…å«"Tom"çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.name LIKE '%Tom%'";

// % è¡¨ç¤ºä»»æ„å¤šä¸ªå­—ç¬¦
// _ è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦

// ç¤ºä¾‹ï¼š
"LIKE 'Tom%'"   â†’ ä»¥Tomå¼€å¤´çš„åå­—
"LIKE '%Tom'"   â†’ ä»¥Tomç»“å°¾çš„åå­—
"LIKE '%Tom%'"  â†’ åŒ…å«Tomçš„åå­—
"LIKE 'T_m'"    â†’ Tå’Œmä¹‹é—´ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚Timã€Tom
```

**ğŸ”¸ IS NULL/IS NOT NULL**ï¼š
```java
// æŸ¥è¯¢æ²¡æœ‰å¤‡æ³¨çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.remark IS NULL";

// æŸ¥è¯¢æœ‰å¤‡æ³¨çš„å­¦ç”Ÿ
String hql = "FROM Student s WHERE s.remark IS NOT NULL";
```

### 5.4 å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆé˜²SQLæ³¨å…¥ï¼‰


**âŒ å±é™©çš„å­—ç¬¦ä¸²æ‹¼æ¥**ï¼š
```java
// åƒä¸‡ä¸è¦è¿™æ ·å†™ï¼
String name = "Tom' OR '1'='1";  // æ¶æ„è¾“å…¥
String hql = "FROM Student WHERE name = '" + name + "'";
// ç”Ÿæˆçš„HQLï¼šFROM Student WHERE name = 'Tom' OR '1'='1'
// ç»“æœï¼šæŸ¥å‡ºæ‰€æœ‰å­¦ç”Ÿï¼ˆè¢«æ³¨å…¥æ”»å‡»ï¼‰
```

**âœ… å®‰å…¨çš„å‚æ•°ç»‘å®š**ï¼š
```java
// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å‚æ•°ç»‘å®š
String hql = "FROM Student s WHERE s.name = :name";
Query query = session.createQuery(hql);
query.setParameter("name", name);  // Hibernateä¼šè‡ªåŠ¨å¤„ç†ç‰¹æ®Šå­—ç¬¦
```

---

## 6. ğŸ“ˆ ORDER BYæ’åº


### 6.1 å•å­—æ®µæ’åº


**å‡åºæ’åˆ—ï¼ˆASCï¼Œé»˜è®¤ï¼‰**ï¼š
```java
// æŒ‰å¹´é¾„å‡åº
String hql = "FROM Student s ORDER BY s.age";
// æˆ–æ˜¾å¼æŒ‡å®šï¼š
String hql = "FROM Student s ORDER BY s.age ASC";

// ç»“æœï¼šå¹´é¾„ä»å°åˆ°å¤§æ’åˆ—
// 18, 19, 20, 21...
```

**é™åºæ’åˆ—ï¼ˆDESCï¼‰**ï¼š
```java
// æŒ‰æˆç»©é™åº
String hql = "FROM Student s ORDER BY s.score DESC";

// ç»“æœï¼šæˆç»©ä»é«˜åˆ°ä½æ’åˆ—
// 100, 95, 90, 85...
```

### 6.2 å¤šå­—æ®µæ’åº


```java
// å…ˆæŒ‰å¹´é¾„å‡åºï¼Œå¹´é¾„ç›¸åŒå†æŒ‰æˆç»©é™åº
String hql = "FROM Student s ORDER BY s.age ASC, s.score DESC";

// ğŸ’¡ æ’åºè§„åˆ™ï¼š
// 1. é¦–å…ˆæŒ‰å¹´é¾„ä»å°åˆ°å¤§
// 2. å¹´é¾„ç›¸åŒçš„å­¦ç”Ÿï¼ŒæŒ‰æˆç»©ä»é«˜åˆ°ä½
```

**ğŸ”„ æ‰§è¡Œæµç¨‹**ï¼š
```
æ•°æ®ï¼š
ID  å§“å   å¹´é¾„  æˆç»©
1   Tom    20    90
2   Jerry  20    95
3   Alice  19    88
4   Bob    20    85

æ‰§è¡Œï¼šORDER BY age ASC, score DESC

ç¬¬ä¸€æ­¥ï¼šæŒ‰ageå‡åº
19: Alice(88)
20: Tom(90), Jerry(95), Bob(85)

ç¬¬äºŒæ­¥ï¼šage=20çš„æŒ‰scoreé™åº
19: Alice(88)
20: Jerry(95), Tom(90), Bob(85)

æœ€ç»ˆç»“æœï¼š
Alice(19,88)
Jerry(20,95)
Tom(20,90)
Bob(20,85)
```

### 6.3 æ’åºæ³¨æ„äº‹é¡¹


> âš ï¸ **ç©ºå€¼å¤„ç†**  
> - MySQLï¼šNULLå€¼æ’åœ¨æœ€å‰é¢ï¼ˆå‡åºæ—¶ï¼‰
> - Oracleï¼šNULLå€¼æ’åœ¨æœ€åé¢ï¼ˆå‡åºæ—¶ï¼‰
> - Hibernateä¼šæ ¹æ®æ•°æ®åº“è‡ªåŠ¨å¤„ç†

---

## 7. ğŸ¨ é¢å‘å¯¹è±¡æŸ¥è¯¢ç‰¹æ€§


### 7.1 å¯¼èˆªæŸ¥è¯¢ï¼ˆå¯¹è±¡å±æ€§å¯¼èˆªï¼‰


**ğŸ’¡ æ ¸å¿ƒç†å¿µ**ï¼šé€šè¿‡å¯¹è±¡çš„å±æ€§æ¥è®¿é—®å…³è”å¯¹è±¡

**ç¤ºä¾‹åœºæ™¯**ï¼š
```
å®ä½“å…³ç³»ï¼š
Studentï¼ˆå­¦ç”Ÿï¼‰ â”€â”€å¤šå¯¹ä¸€â”€â”€> Clazzï¼ˆç­çº§ï¼‰
Studentç±»ä¸­æœ‰ï¼šprivate Clazz clazz å±æ€§
```

**å¯¼èˆªæŸ¥è¯¢å†™æ³•**ï¼š
```java
// é€šè¿‡å­¦ç”ŸæŸ¥è¯¢ç­çº§åç§°
String hql = "SELECT s.clazz.name FROM Student s";
//                    â†‘ å¯¹è±¡å¯¼èˆªï¼šstudent.clazz.name
//                    å…ˆè·å–å­¦ç”Ÿçš„ç­çº§å¯¹è±¡ï¼Œå†è·å–ç­çº§çš„åç§°å±æ€§

// ğŸ’¡ å¯¹æ¯”SQLå†™æ³•ï¼š
// SELECT c.name FROM t_student s 
// JOIN t_clazz c ON s.clazz_id = c.id
```

**å¤šçº§å¯¼èˆª**ï¼š
```java
// å­¦ç”Ÿ â†’ ç­çº§ â†’ å¹´çº§ â†’ å¹´çº§åç§°
String hql = "SELECT s.clazz.grade.name FROM Student s";
//                    s.clazz â†’ è·å–ç­çº§å¯¹è±¡
//                    .grade  â†’ è·å–å¹´çº§å¯¹è±¡  
//                    .name   â†’ è·å–å¹´çº§åç§°
```

**ğŸ¯ å¯¼èˆªçš„ä¼˜åŠ¿**ï¼š
```
âœ… ä¸éœ€è¦å†™JOIN
âœ… ä¸éœ€è¦çŸ¥é“å¤–é”®å­—æ®µ
âœ… é¢å‘å¯¹è±¡æ€ç»´ï¼Œæ›´ç›´è§‚
âœ… Hibernateè‡ªåŠ¨å¤„ç†å…³è”
```

### 7.2 å¤šæ€æŸ¥è¯¢


**ä»€ä¹ˆæ˜¯å¤šæ€æŸ¥è¯¢ï¼Ÿ**
```
å¦‚æœæœ‰ç»§æ‰¿å…³ç³»ï¼š
Personï¼ˆçˆ¶ç±»ï¼‰
  â†‘
  â”œâ”€ Studentï¼ˆå­ç±»ï¼‰
  â””â”€ Teacherï¼ˆå­ç±»ï¼‰
```

**å¤šæ€æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```java
// æŸ¥è¯¢Personæ—¶ï¼Œä¼šåŒæ—¶æŸ¥å‡ºStudentå’ŒTeacher
String hql = "FROM Person";
List<Person> list = session.createQuery(hql).list();

// ç»“æœåŒ…å«ï¼š
// - Personå¯¹è±¡
// - Studentå¯¹è±¡ï¼ˆæ˜¯Personçš„å­ç±»ï¼‰
// - Teacherå¯¹è±¡ï¼ˆæ˜¯Personçš„å­ç±»ï¼‰
```

**ğŸ”¸ æŸ¥è¯¢æŒ‡å®šå­ç±»**ï¼š
```java
// åªæŸ¥è¯¢Student
String hql = "FROM Student";  // åªè¿”å›Studentå¯¹è±¡

// åªæŸ¥è¯¢Teacher
String hql = "FROM Teacher";  // åªè¿”å›Teacherå¯¹è±¡
```

### 7.3 å…³è”æŸ¥è¯¢ä¼˜åŒ–


**LEFT JOIN FETCHï¼ˆè§£å†³N+1é—®é¢˜ï¼‰**ï¼š

**âŒ é—®é¢˜åœºæ™¯**ï¼š
```java
// æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ
String hql = "FROM Student s";
List<Student> students = session.createQuery(hql).list();

// éå†æ—¶è®¿é—®ç­çº§
for (Student s : students) {
    System.out.println(s.getClazz().getName()); // æ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“ï¼
}

// é—®é¢˜ï¼š10ä¸ªå­¦ç”Ÿ â†’ æ‰§è¡Œ11æ¬¡SQL
// 1æ¬¡æŸ¥å­¦ç”Ÿ + 10æ¬¡æŸ¥ç­çº§ = N+1é—®é¢˜
```

**âœ… è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// ä½¿ç”¨FETCHä¸€æ¬¡æ€§åŠ è½½
String hql = "FROM Student s LEFT JOIN FETCH s.clazz";
List<Student> students = session.createQuery(hql).list();

// éå†æ—¶ä¸å†æŸ¥è¯¢
for (Student s : students) {
    System.out.println(s.getClazz().getName()); // ç›´æ¥ä½¿ç”¨ï¼Œä¸æŸ¥åº“
}

// æ•ˆæœï¼š10ä¸ªå­¦ç”Ÿ â†’ åªæ‰§è¡Œ1æ¬¡SQL
// ä¸€æ¬¡æŸ¥è¯¢åŒæ—¶è·å–å­¦ç”Ÿå’Œç­çº§æ•°æ®
```

**ğŸ”„ æŸ¥è¯¢å¯¹æ¯”**ï¼š
```
ä¸ä½¿ç”¨FETCHï¼š
SQL1: SELECT * FROM t_student           (1æ¬¡)
SQL2: SELECT * FROM t_clazz WHERE id=1  (ç¬¬1ä¸ªå­¦ç”Ÿçš„ç­çº§)
SQL3: SELECT * FROM t_clazz WHERE id=1  (ç¬¬2ä¸ªå­¦ç”Ÿçš„ç­çº§)
...
æ€»è®¡ï¼š1 + N æ¬¡æŸ¥è¯¢

ä½¿ç”¨FETCHï¼š
SQL: SELECT s.*, c.* FROM t_student s 
     LEFT JOIN t_clazz c ON s.clazz_id = c.id
æ€»è®¡ï¼š1æ¬¡æŸ¥è¯¢
```

---

## 8. âš–ï¸ HQLä¸SQLçš„åŒºåˆ«


### 8.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”è¡¨


| å¯¹æ¯”é¡¹ | **SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰** | **HQLï¼ˆå¯¹è±¡æŸ¥è¯¢è¯­è¨€ï¼‰** |
|-------|------------------------|----------------------|
| **æ“ä½œå¯¹è±¡** | `æ•°æ®åº“è¡¨å’Œå­—æ®µ` | `Javaç±»å’Œå±æ€§` |
| **è¯­æ³•** | `SELECT * FROM t_student` | `FROM Student` |
| **å¤§å°å†™** | `ä¸åŒºåˆ†å¤§å°å†™` | `ç±»åå±æ€§ååŒºåˆ†å¤§å°å†™` |
| **å…³è”** | `é€šè¿‡å¤–é”®JOIN` | `é€šè¿‡å¯¹è±¡å±æ€§å¯¼èˆª` |
| **æ•°æ®åº“** | `ä¾èµ–å…·ä½“æ•°æ®åº“` | `æ•°æ®åº“æ— å…³` |
| **è¿”å›å€¼** | `ResultSetç»“æœé›†` | `å¯¹è±¡/å¯¹è±¡åˆ—è¡¨` |

### 8.2 å®é™…å¯¹æ¯”ç¤ºä¾‹


**åœºæ™¯ï¼šæŸ¥è¯¢å¹´é¾„å¤§äº20çš„å­¦ç”Ÿ**

**SQLå†™æ³•**ï¼š
```sql
-- éœ€è¦çŸ¥é“è¡¨åå’Œå­—æ®µå
SELECT student_id, student_name, student_age, clazz_id
FROM t_student
WHERE student_age > 20
ORDER BY student_age DESC;

-- é—®é¢˜ï¼š
-- 1. è¡¨åt_studentå¯èƒ½åœ¨ä¸åŒé¡¹ç›®ä¸­ä¸åŒ
-- 2. å­—æ®µåstudent_ageå¯èƒ½å«ageæˆ–stu_age
-- 3. è¿”å›ç»“æœéœ€è¦æ‰‹åŠ¨è½¬æ¢æˆå¯¹è±¡
```

**HQLå†™æ³•**ï¼š
```java
// åªéœ€è¦çŸ¥é“Javaç±»å’Œå±æ€§
String hql = "FROM Student s WHERE s.age > 20 ORDER BY s.age DESC";
List<Student> students = session.createQuery(hql).list();

// ä¼˜åŠ¿ï¼š
// 1. Studentæ˜¯Javaç±»åï¼Œä¸ä¼šå˜
// 2. ageæ˜¯Javaå±æ€§åï¼Œä¸ä¼šå˜
// 3. è‡ªåŠ¨è¿”å›Studentå¯¹è±¡åˆ—è¡¨
```

### 8.3 å…³è”æŸ¥è¯¢å¯¹æ¯”


**åœºæ™¯ï¼šæŸ¥è¯¢å­¦ç”ŸåŠç­çº§ä¿¡æ¯**

**SQLå†™æ³•**ï¼š
```sql
-- éœ€è¦çŸ¥é“å¤–é”®å…³ç³»
SELECT s.*, c.*
FROM t_student s
LEFT JOIN t_clazz c ON s.clazz_id = c.id
WHERE s.student_age > 20;

-- éœ€è¦å…³å¿ƒï¼š
-- 1. å¤–é”®å­—æ®µåclazz_id
-- 2. JOINçš„å†™æ³•
-- 3. è¡¨åˆ«åçš„å®šä¹‰
```

**HQLå†™æ³•**ï¼š
```java
// é€šè¿‡å¯¹è±¡å±æ€§å…³è”
String hql = "FROM Student s LEFT JOIN FETCH s.clazz WHERE s.age > 20";
List<Student> students = session.createQuery(hql).list();

// ä¼˜åŠ¿ï¼š
// 1. s.clazzç›´æ¥é€šè¿‡å¯¹è±¡å±æ€§å…³è”
// 2. ä¸éœ€è¦çŸ¥é“å¤–é”®å­—æ®µ
// 3. Hibernateè‡ªåŠ¨å¤„ç†JOIN
```

### 8.4 æ•°æ®åº“ç§»æ¤æ€§


**SQLçš„é—®é¢˜**ï¼š
```sql
-- MySQLçš„åˆ†é¡µ
SELECT * FROM t_student LIMIT 10 OFFSET 0;

-- Oracleçš„åˆ†é¡µï¼ˆå®Œå…¨ä¸åŒï¼‰
SELECT * FROM (
    SELECT ROWNUM rn, t.* FROM t_student t WHERE ROWNUM <= 10
) WHERE rn > 0;
```

**HQLçš„ä¼˜åŠ¿**ï¼š
```java
// ç»Ÿä¸€çš„åˆ†é¡µå†™æ³•
String hql = "FROM Student";
Query query = session.createQuery(hql);
query.setFirstResult(0);   // èµ·å§‹ä½ç½®
query.setMaxResults(10);   // æŸ¥è¯¢æ•°é‡

// Hibernateè‡ªåŠ¨è½¬æ¢æˆå¯¹åº”æ•°æ®åº“çš„SQL
// MySQL â†’ è‡ªåŠ¨ç”ŸæˆLIMITè¯­æ³•
// Oracle â†’ è‡ªåŠ¨ç”ŸæˆROWNUMè¯­æ³•
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºç¡€æ¦‚å¿µ


```
ğŸ¯ **HQLæœ¬è´¨**
   é¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€
   æ“ä½œJavaç±»ï¼Œä¸æ˜¯æ•°æ®åº“è¡¨
   
ğŸ”¸ **åŸºæœ¬è¯­æ³•ç»“æ„**
   FROM + WHERE + ORDER BY
   ç±»åå’Œå±æ€§ååŒºåˆ†å¤§å°å†™
   å…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™
   
ğŸ”¸ **å‚æ•°ç»‘å®š**
   ä½ç½®å‚æ•°ï¼š? + setParameter(ä½ç½®, å€¼)
   å‘½åå‚æ•°ï¼š:åç§° + setParameter("åç§°", å€¼)
   æ¨èä½¿ç”¨å‘½åå‚æ•°
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ FROMå­å¥**
```
âœ… æœ€ç®€å½¢å¼ï¼šFROM Student
âœ… ä½¿ç”¨åˆ«åï¼šFROM Student s
âœ… å…³è”æŸ¥è¯¢ï¼šFROM Student s JOIN s.clazz
âœ… ä¼˜åŒ–åŠ è½½ï¼šFROM Student s LEFT JOIN FETCH s.clazz
```

**ğŸ”¹ SELECTå­å¥**
```
âœ… æŸ¥è¯¢å¯¹è±¡ï¼šSELECT s FROM Student s
âœ… æŸ¥è¯¢å±æ€§ï¼šSELECT s.name FROM Student s
âœ… å¤šä¸ªå±æ€§ï¼šSELECT s.name, s.age FROM Student s
âœ… èšåˆå‡½æ•°ï¼šSELECT count(s) FROM Student s
```

**ğŸ”¹ WHEREæ¡ä»¶**
```
âœ… æ¯”è¾ƒè¿ç®—ï¼š= <> > >= < <=
âœ… é€»è¾‘è¿ç®—ï¼šAND OR NOT
âœ… èŒƒå›´æŸ¥è¯¢ï¼šBETWEEN ANDã€IN
âœ… æ¨¡ç³ŠæŸ¥è¯¢ï¼šLIKE '%å…³é”®å­—%'
âœ… ç©ºå€¼åˆ¤æ–­ï¼šIS NULLã€IS NOT NULL
```

**ğŸ”¹ ORDER BYæ’åº**
```
âœ… å‡åºï¼šORDER BY s.age (é»˜è®¤ASC)
âœ… é™åºï¼šORDER BY s.age DESC
âœ… å¤šå­—æ®µï¼šORDER BY s.age, s.score DESC
```

### 9.3 é¢å‘å¯¹è±¡ç‰¹æ€§


```
ğŸŒŸ **å¯¹è±¡å¯¼èˆª**
   s.clazz.name â†’ é€šè¿‡å±æ€§è®¿é—®å…³è”å¯¹è±¡
   ä¸éœ€è¦å†™JOINï¼ŒHibernateè‡ªåŠ¨å¤„ç†
   
ğŸŒŸ **å¤šæ€æŸ¥è¯¢**
   æŸ¥çˆ¶ç±» â†’ è‡ªåŠ¨åŒ…å«æ‰€æœ‰å­ç±»
   æŸ¥å­ç±» â†’ åªè¿”å›è¯¥å­ç±»
   
ğŸŒŸ **FETCHä¼˜åŒ–**
   LEFT JOIN FETCH â†’ ä¸€æ¬¡æŸ¥è¯¢åŠ è½½å…³è”
   è§£å†³N+1æŸ¥è¯¢é—®é¢˜
   æå‡æŸ¥è¯¢æ€§èƒ½
```

### 9.4 HQL vs SQLæ ¸å¿ƒåŒºåˆ«


```
ğŸ“Š **æ€ç»´æ–¹å¼ä¸åŒ**
SQLæ€ç»´ï¼šè¡¨ã€å­—æ®µã€å¤–é”®
HQLæ€ç»´ï¼šç±»ã€å±æ€§ã€å¯¹è±¡å…³ç³»

ğŸ“Š **ç§»æ¤æ€§ä¸åŒ**
SQLï¼šä¾èµ–æ•°æ®åº“è¯­æ³•
HQLï¼šæ•°æ®åº“æ— å…³ï¼Œè‡ªåŠ¨é€‚é…

ğŸ“Š **è¿”å›ç»“æœä¸åŒ**
SQLï¼šResultSetç»“æœé›†
HQLï¼šJavaå¯¹è±¡/å¯¹è±¡åˆ—è¡¨
```

### 9.5 å®è·µè¦ç‚¹


**ğŸ¯ æŸ¥è¯¢ä¼˜åŒ–å»ºè®®**
- åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼ˆSELECT s.name, s.ageï¼‰
- ä½¿ç”¨FETCHé¿å…N+1é—®é¢˜
- åˆç†ä½¿ç”¨WHEREæ¡ä»¶å‡å°‘æ•°æ®é‡
- åˆ†é¡µæŸ¥è¯¢å¤§æ•°æ®é›†

**ğŸ¯ å®‰å…¨æ³¨æ„äº‹é¡¹**
- æ°¸è¿œä½¿ç”¨å‚æ•°ç»‘å®šï¼Œä¸è¦æ‹¼æ¥å­—ç¬¦ä¸²
- é˜²æ­¢HQLæ³¨å…¥æ”»å‡»
- éªŒè¯ç”¨æˆ·è¾“å…¥

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
- ä½¿ç”¨æŠ•å½±æŸ¥è¯¢å‡å°‘æ•°æ®ä¼ è¾“
- åˆç†ä½¿ç”¨ç¼“å­˜
- æ‰¹é‡æ“ä½œä½¿ç”¨æ‰¹å¤„ç†
- ç›‘æ§å’Œåˆ†æç”Ÿæˆçš„SQL

**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
HQLé¢å‘å¯¹è±¡ä¸ç¢°è¡¨ï¼Œç±»åå±æ€§å¯¼èˆªæŸ¥
å‚æ•°ç»‘å®šé˜²æ³¨å…¥ï¼ŒFETCHä¼˜åŒ–N+1
SQLä¾èµ–åº“HQLä¸ï¼Œä¸€å¥—ä»£ç å¤„å¤„è·‘
```

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**  
> 1. ä»ç®€å•çš„FROMå¼€å§‹ç»ƒä¹ 
> 2. ç†è§£å¯¹è±¡å¯¼èˆªçš„æ¦‚å¿µ
> 3. å¯¹æ¯”SQLåŠ æ·±ç†è§£HQLçš„ä¼˜åŠ¿
> 4. å¤šå†™å¤šç»ƒï¼Œç†Ÿèƒ½ç”Ÿå·§
> 5. æ³¨æ„æŸ¥çœ‹Hibernateç”Ÿæˆçš„SQLï¼Œç†è§£è½¬æ¢è¿‡ç¨‹