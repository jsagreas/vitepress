---
title: 71ã€é¡¹ç›®å®æˆ˜æ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [ç”µå•†ç³»ç»Ÿå®æˆ˜è®¾è®¡](#1-ç”µå•†ç³»ç»Ÿå®æˆ˜è®¾è®¡)
2. [åšå®¢ç³»ç»Ÿå®æˆ˜è®¾è®¡](#2-åšå®¢ç³»ç»Ÿå®æˆ˜è®¾è®¡)
3. [è®ºå›ç³»ç»Ÿå®æˆ˜è®¾è®¡](#3-è®ºå›ç³»ç»Ÿå®æˆ˜è®¾è®¡)
4. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#4-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›’ ç”µå•†ç³»ç»Ÿå®æˆ˜è®¾è®¡


### 1.1 ç”µå•†ç³»ç»Ÿæ•´ä½“æ¶æ„


**ğŸ¯ ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—**

> ç”µå•†ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¸å‹çš„å¤šæ¨¡å—åä½œç³»ç»Ÿï¼Œæ¶‰åŠç”¨æˆ·ã€å•†å“ã€è®¢å•ã€è´­ç‰©è½¦ç­‰å¤šä¸ªæ ¸å¿ƒä¸šåŠ¡æ¨¡å—ã€‚é€šè¿‡Hibernateå¯ä»¥ä¼˜é›…åœ°å¤„ç†è¿™äº›æ¨¡å—ä¹‹é—´çš„å¤æ‚å…³ç³»ã€‚

```
ç”µå•†ç³»ç»Ÿæ¨¡å—å…³ç³»å›¾ï¼š

                    ç”µå•†å¹³å°æ ¸å¿ƒæ¶æ„
                           |
        +---------+--------+--------+---------+
        |         |        |        |         |
    ç”¨æˆ·æ¨¡å—  å•†å“æ¨¡å—  è®¢å•æ¨¡å—  è´­ç‰©è½¦  åº“å­˜ç®¡ç†
        |         |        |        |         |
        +----+----+---+----+---+----+----+----+
             |        |        |         |
          æƒé™ç®¡ç†  åˆ†ç±»ç®¡ç†  æ”¯ä»˜æµç¨‹  ä»“å‚¨ç³»ç»Ÿ
```

**ğŸ“‹ æ ¸å¿ƒå®ä½“å…³ç³»**

| **å®ä½“** | **ä½œç”¨** | **æ ¸å¿ƒå…³ç³»** | **ä¸šåŠ¡åœºæ™¯** |
|---------|---------|-------------|-------------|
| `User` | ç”¨æˆ·ä¿¡æ¯ | ä¸€å¯¹å¤šè®¢å•ã€ä¸€å¯¹ä¸€è´­ç‰©è½¦ | æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¸­å¿ƒ |
| `Product` | å•†å“ä¿¡æ¯ | å¤šå¯¹ä¸€åˆ†ç±»ã€ä¸€å¯¹å¤šåº“å­˜ | å•†å“å±•ç¤ºã€æœç´¢ |
| `Order` | è®¢å•ä¿¡æ¯ | å¤šå¯¹ä¸€ç”¨æˆ·ã€ä¸€å¯¹å¤šè®¢å•é¡¹ | ä¸‹å•ã€æ”¯ä»˜ã€å‘è´§ |
| `Cart` | è´­ç‰©è½¦ | ä¸€å¯¹ä¸€ç”¨æˆ·ã€ä¸€å¯¹å¤šè´­ç‰©é¡¹ | åŠ è´­ã€ç»“ç®— |
| `Category` | å•†å“åˆ†ç±» | ä¸€å¯¹å¤šå•†å“ã€è‡ªå…³è”çˆ¶å­åˆ†ç±» | åˆ†ç±»æµè§ˆã€ç­›é€‰ |

### 1.2 ç”¨æˆ·ç®¡ç†æ¨¡å—å®æˆ˜


**ğŸ‘¤ ç”¨æˆ·å®ä½“è®¾è®¡è¦ç‚¹**

ç”¨æˆ·ç®¡ç†æ˜¯æ•´ä¸ªç³»ç»Ÿçš„åŸºç¡€ï¼Œéœ€è¦è€ƒè™‘ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€æƒé™è§’è‰²ã€ä»¥åŠä¸å…¶ä»–æ¨¡å—çš„å…³è”å…³ç³»ã€‚

```java
@Entity
@Table(name = "t_user")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String username;  // ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
    
    @Column(nullable = false)
    private String password;  // å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    
    private String email;     // é‚®ç®±
    private String phone;     // æ‰‹æœºå·
    
    @Enumerated(EnumType.STRING)
    private UserStatus status;  // ç”¨æˆ·çŠ¶æ€ï¼ˆæ­£å¸¸/å†»ç»“/æ³¨é”€ï¼‰
    
    // ä¸€å¯¹å¤šï¼šä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè®¢å•
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
    private Set<Order> orders = new HashSet<>();
    
    // ä¸€å¯¹ä¸€ï¼šä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªè´­ç‰©è½¦
    @OneToOne(mappedBy = "user", cascade = CascadeType.ALL)
    private Cart cart;
    
    // å¤šå¯¹å¤šï¼šç”¨æˆ·ä¸è§’è‰²çš„å…³ç³»
    @ManyToMany(fetch = FetchType.LAZY)
    @JoinTable(
        name = "t_user_role",
        joinColumns = @JoinColumn(name = "user_id"),
        inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    private Set<Role> roles = new HashSet<>();
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date createTime;  // æ³¨å†Œæ—¶é—´
}
```

**ğŸ”‘ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**

ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼š
```
1. æ¥æ”¶ç”¨æˆ·ä¿¡æ¯ â†’ 2. æ•°æ®æ ¡éªŒ â†’ 3. å¯†ç åŠ å¯† â†’ 4. ä¿å­˜ç”¨æˆ·
                                                    â†“
5. åˆ›å»ºé»˜è®¤è´­ç‰©è½¦ â† 4. åˆ†é…é»˜è®¤è§’è‰² â† 4. åˆå§‹åŒ–ç”¨æˆ·çŠ¶æ€
```

**ğŸ’¡ å®ç°è¦ç‚¹è¯´æ˜**

- **å¯†ç å®‰å…¨**ï¼šå¯†ç ä¸èƒ½æ˜æ–‡å­˜å‚¨ï¼Œä½¿ç”¨BCryptç­‰åŠ å¯†ç®—æ³•
- **å”¯ä¸€æ€§çº¦æŸ**ï¼šç”¨æˆ·åã€é‚®ç®±ç­‰å­—æ®µéœ€è¦å”¯ä¸€ç´¢å¼•
- **å…³ç³»ç®¡ç†**ï¼šæ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºè´­ç‰©è½¦ï¼Œåˆ†é…é»˜è®¤ç”¨æˆ·è§’è‰²
- **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨æšä¸¾ç±»å‹ç®¡ç†ç”¨æˆ·çŠ¶æ€ï¼Œä¾¿äºåç»­æ‰©å±•

### 1.3 å•†å“åˆ†ç±»ç®¡ç†æ¨¡å—


**ğŸ“‚ åˆ†ç±»æ ‘å½¢ç»“æ„è®¾è®¡**

å•†å“åˆ†ç±»é€šå¸¸æ˜¯æ ‘å½¢ç»“æ„ï¼Œæ¯”å¦‚ï¼šç”µå­äº§å“ â†’ æ‰‹æœº â†’ æ™ºèƒ½æ‰‹æœº â†’ åä¸ºæ‰‹æœº

```
åˆ†ç±»å±‚çº§ç¤ºä¾‹ï¼š

        å…¨éƒ¨åˆ†ç±»ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰
             |
    +--------+--------+
    |        |        |
  ç”µå­äº§å“  æœè£…  é£Ÿå“
    |
    +-----+-----+
    |     |     |
   æ‰‹æœº  ç”µè„‘  ç›¸æœº
    |
    +---+---+
    |       |
  æ™ºèƒ½æ‰‹æœº åŠŸèƒ½æœº
```

```java
@Entity
@Table(name = "t_category")
public class Category {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;        // åˆ†ç±»åç§°
    
    private Integer level;      // åˆ†ç±»å±‚çº§ï¼ˆ1/2/3çº§ï¼‰
    
    // è‡ªå…³è”ï¼šçˆ¶åˆ†ç±»
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "parent_id")
    private Category parent;
    
    // è‡ªå…³è”ï¼šå­åˆ†ç±»åˆ—è¡¨
    @OneToMany(mappedBy = "parent", cascade = CascadeType.ALL)
    private Set<Category> children = new HashSet<>();
    
    // ä¸€å¯¹å¤šï¼šåˆ†ç±»ä¸‹çš„å•†å“
    @OneToMany(mappedBy = "category")
    private Set<Product> products = new HashSet<>();
    
    private Boolean isActive;   // æ˜¯å¦å¯ç”¨
    private Integer sortOrder;  // æ’åºå­—æ®µ
}
```

**ğŸ¯ åˆ†ç±»ç®¡ç†æ ¸å¿ƒåŠŸèƒ½**

| **åŠŸèƒ½** | **å®ç°è¦ç‚¹** | **åº”ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| **æ·»åŠ åˆ†ç±»** | `è®¾ç½®çˆ¶åˆ†ç±»ã€è®¡ç®—å±‚çº§` | æ–°å¢å•†å“ç±»ç›® |
| **åˆ é™¤åˆ†ç±»** | `æ£€æŸ¥æ˜¯å¦æœ‰å­åˆ†ç±»å’Œå•†å“` | æ¸…ç†åºŸå¼ƒåˆ†ç±» |
| **ç§»åŠ¨åˆ†ç±»** | `æ›´æ–°çˆ¶èŠ‚ç‚¹ã€é‡æ–°è®¡ç®—å±‚çº§` | è°ƒæ•´åˆ†ç±»ç»“æ„ |
| **æŸ¥è¯¢æ ‘å½¢** | `é€’å½’åŠ è½½æˆ–ä¸€æ¬¡æ€§åŠ è½½` | å‰ç«¯å±•ç¤ºåˆ†ç±»æ ‘ |

**âš ï¸ å®æˆ˜æ³¨æ„äº‹é¡¹**

- **å±‚çº§æ§åˆ¶**ï¼šä¸€èˆ¬é™åˆ¶3-4çº§ï¼Œé¿å…å±‚çº§è¿‡æ·±å½±å“æ€§èƒ½
- **åˆ é™¤æ£€æŸ¥**ï¼šåˆ é™¤åˆ†ç±»å‰å¿…é¡»æ£€æŸ¥æ˜¯å¦æœ‰å…³è”å•†å“å’Œå­åˆ†ç±»
- **æ‡’åŠ è½½ä¼˜åŒ–**ï¼šåˆ†ç±»æ ‘å¯èƒ½å¾ˆå¤§ï¼Œä½¿ç”¨æ‡’åŠ è½½é¿å…ä¸€æ¬¡åŠ è½½å…¨éƒ¨æ•°æ®
- **æ’åºå­—æ®µ**ï¼šæ·»åŠ sortOrderå­—æ®µï¼Œä¾¿äºå‰ç«¯æ§åˆ¶æ˜¾ç¤ºé¡ºåº

### 1.4 è®¢å•ç®¡ç†æ¨¡å—å®æˆ˜


**ğŸ“ è®¢å•å®ä½“è®¾è®¡**

è®¢å•æ˜¯ç”µå•†ç³»ç»Ÿæœ€æ ¸å¿ƒçš„ä¸šåŠ¡ï¼Œæ¶‰åŠè®¢å•ä¸»è¡¨ã€è®¢å•æ˜ç»†ã€æ”¯ä»˜ã€ç‰©æµç­‰å¤šä¸ªç¯èŠ‚ã€‚

```java
@Entity
@Table(name = "t_order")
public class Order {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private String orderNo;     // è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰
    
    // å¤šå¯¹ä¸€ï¼šè®¢å•å±äºæŸä¸ªç”¨æˆ·
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;
    
    // ä¸€å¯¹å¤šï¼šè®¢å•åŒ…å«å¤šä¸ªè®¢å•é¡¹
    @OneToMany(mappedBy = "order", cascade = CascadeType.ALL)
    private List<OrderItem> orderItems = new ArrayList<>();
    
    @Column(precision = 10, scale = 2)
    private BigDecimal totalAmount;  // è®¢å•æ€»é‡‘é¢
    
    @Enumerated(EnumType.STRING)
    private OrderStatus status;      // è®¢å•çŠ¶æ€
    
    private String shippingAddress;  // æ”¶è´§åœ°å€
    private String receiverName;     // æ”¶è´§äºº
    private String receiverPhone;    // è”ç³»ç”µè¯
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date createTime;         // ä¸‹å•æ—¶é—´
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date payTime;            // æ”¯ä»˜æ—¶é—´
}

// è®¢å•æ˜ç»†è¡¨
@Entity
@Table(name = "t_order_item")
public class OrderItem {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "order_id")
    private Order order;
    
    @ManyToOne
    @JoinColumn(name = "product_id")
    private Product product;
    
    private Integer quantity;        // è´­ä¹°æ•°é‡
    
    @Column(precision = 10, scale = 2)
    private BigDecimal price;        // å•ä»·
    
    @Column(precision = 10, scale = 2)
    private BigDecimal subtotal;     // å°è®¡
}
```

**ğŸ”„ è®¢å•çŠ¶æ€æµè½¬**

```
è®¢å•ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœºï¼š

å¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ â†’ å¾…å‘è´§ â†’ å·²å‘è´§ â†’ å¾…æ”¶è´§ â†’ å·²å®Œæˆ
  â†“        â†“        â†“        â†“        â†“
å·²å–æ¶ˆ   å·²å–æ¶ˆ   å·²å–æ¶ˆ   (é€€è´§)   (å”®å)
```

**ğŸ’¼ è®¢å•æ ¸å¿ƒä¸šåŠ¡åœºæ™¯**

**åœºæ™¯1ï¼šåˆ›å»ºè®¢å•**
```
æ­¥éª¤è¯´æ˜ï¼š
â‘  ä»è´­ç‰©è½¦è·å–é€‰ä¸­å•†å“
â‘¡ è®¡ç®—è®¢å•æ€»é‡‘é¢
â‘¢ åˆ›å»ºè®¢å•ä¸»è¡¨å’Œæ˜ç»†è¡¨
â‘£ ç”Ÿæˆå”¯ä¸€è®¢å•å·
â‘¤ å‡å°‘å•†å“åº“å­˜ï¼ˆå¯é€‰ï¼šæ”¯ä»˜åå†å‡ï¼‰
â‘¥ æ¸…ç©ºè´­ç‰©è½¦å¯¹åº”å•†å“
```

**åœºæ™¯2ï¼šè®¢å•æ”¯ä»˜**
```
æ­¥éª¤è¯´æ˜ï¼š
â‘  æ£€æŸ¥è®¢å•çŠ¶æ€ï¼ˆå¿…é¡»æ˜¯å¾…æ”¯ä»˜ï¼‰
â‘¡ è°ƒç”¨æ”¯ä»˜æ¥å£ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰
â‘¢ æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜
â‘£ è®°å½•æ”¯ä»˜æ—¶é—´
â‘¤ æ‰£å‡åº“å­˜ï¼ˆå¦‚æœä¸‹å•æ—¶æœªæ‰£å‡ï¼‰
â‘¥ è§¦å‘å‘è´§æµç¨‹
```

### 1.5 è´­ç‰©è½¦å®ç°


**ğŸ›’ è´­ç‰©è½¦å®ä½“è®¾è®¡**

è´­ç‰©è½¦æ˜¯ç”¨æˆ·ä¸´æ—¶å­˜æ”¾å¾…è´­å•†å“çš„åœ°æ–¹ï¼Œéœ€è¦æ”¯æŒå¢åˆ æ”¹æŸ¥ã€æ•°é‡è°ƒæ•´ç­‰åŠŸèƒ½ã€‚

```java
@Entity
@Table(name = "t_cart")
public class Cart {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // ä¸€å¯¹ä¸€ï¼šè´­ç‰©è½¦å±äºæŸä¸ªç”¨æˆ·
    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", unique = true)
    private User user;
    
    // ä¸€å¯¹å¤šï¼šè´­ç‰©è½¦åŒ…å«å¤šä¸ªè´­ç‰©é¡¹
    @OneToMany(mappedBy = "cart", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<CartItem> cartItems = new ArrayList<>();
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date updateTime;  // æœ€åæ›´æ–°æ—¶é—´
}

@Entity
@Table(name = "t_cart_item")
public class CartItem {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "cart_id")
    private Cart cart;
    
    @ManyToOne
    @JoinColumn(name = "product_id")
    private Product product;
    
    private Integer quantity;  // å•†å“æ•°é‡
    private Boolean selected;  // æ˜¯å¦é€‰ä¸­ï¼ˆç»“ç®—æ—¶ä½¿ç”¨ï¼‰
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date addTime;      // åŠ å…¥æ—¶é—´
}
```

**âš™ï¸ è´­ç‰©è½¦æ ¸å¿ƒæ“ä½œ**

| **æ“ä½œ** | **ä¸šåŠ¡é€»è¾‘** | **æ³¨æ„äº‹é¡¹** |
|---------|-------------|-------------|
| **æ·»åŠ å•†å“** | `æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨â†’å­˜åœ¨åˆ™å¢åŠ æ•°é‡ï¼Œä¸å­˜åœ¨åˆ™æ–°å¢` | æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³ |
| **ä¿®æ”¹æ•°é‡** | `ç›´æ¥æ›´æ–°æ•°é‡å­—æ®µ` | æ•°é‡ä¸èƒ½è¶…è¿‡åº“å­˜ |
| **åˆ é™¤å•†å“** | `ä»è´­ç‰©é¡¹åˆ—è¡¨ç§»é™¤` | ä½¿ç”¨orphanRemovalè‡ªåŠ¨åˆ é™¤ |
| **æ¸…ç©ºè´­ç‰©è½¦** | `æ¸…ç©ºæ‰€æœ‰è´­ç‰©é¡¹` | å¯é€‰ä¿ç•™æœªé€‰ä¸­çš„å•†å“ |
| **ç»“ç®—é€‰ä¸­** | `ç­›é€‰selected=trueçš„é¡¹ç”Ÿæˆè®¢å•` | éœ€è¦é”å®šåº“å­˜ |

**ğŸ’¡ è´­ç‰©è½¦è®¾è®¡è¦ç‚¹**

- **æŒä¹…åŒ–å­˜å‚¨**ï¼šç™»å½•ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œä¿è¯æ¢è®¾å¤‡ä¹Ÿèƒ½çœ‹åˆ°
- **æ•°é‡é™åˆ¶**ï¼šæ¯ä¸ªå•†å“çš„æ•°é‡ä¸èƒ½è¶…è¿‡åº“å­˜æ•°é‡
- **é€‰ä¸­çŠ¶æ€**ï¼šæ”¯æŒéƒ¨åˆ†å•†å“ç»“ç®—ï¼Œä½¿ç”¨Booleanå­—æ®µæ ‡è®°
- **è‡ªåŠ¨æ¸…ç†**ï¼šå¯ä»¥å®šæ—¶æ¸…ç†é•¿æ—¶é—´æœªæ“ä½œçš„è´­ç‰©è½¦æ•°æ®

### 1.6 åº“å­˜ç®¡ç†ç³»ç»Ÿ


**ğŸ“¦ åº“å­˜å®ä½“è®¾è®¡**

åº“å­˜ç®¡ç†æ˜¯ä¿è¯è®¢å•æ­£å¸¸å±¥è¡Œçš„å…³é”®ï¼Œéœ€è¦å‡†ç¡®è®°å½•å•†å“çš„å¯ç”¨åº“å­˜ã€å·²å”®åº“å­˜ç­‰ä¿¡æ¯ã€‚

```java
@Entity
@Table(name = "t_inventory")
public class Inventory {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @OneToOne
    @JoinColumn(name = "product_id", unique = true)
    private Product product;
    
    private Integer totalStock;      // æ€»åº“å­˜
    private Integer availableStock;  // å¯ç”¨åº“å­˜
    private Integer lockedStock;     // é”å®šåº“å­˜ï¼ˆå¾…æ”¯ä»˜è®¢å•ï¼‰
    private Integer soldStock;       // å·²å”®åº“å­˜
    
    @Version
    private Integer version;         // ä¹è§‚é”ç‰ˆæœ¬å·
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date updateTime;
}
```

**ğŸ” åº“å­˜æ“ä½œæ ¸å¿ƒæµç¨‹**

**æ‰£å‡åº“å­˜çš„ä¸¤ç§æ–¹æ¡ˆï¼š**

```
æ–¹æ¡ˆAï¼šä¸‹å•æ‰£åº“å­˜
ä¸‹å• â†’ æ‰£å‡åº“å­˜ â†’ ç”Ÿæˆè®¢å• â†’ æ”¯ä»˜
ä¼˜ç‚¹ï¼šåº“å­˜å‡†ç¡®
ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°æ¶æ„ä¸‹å•å ç”¨åº“å­˜

æ–¹æ¡ˆBï¼šæ”¯ä»˜æ‰£åº“å­˜  
ä¸‹å• â†’ é”å®šåº“å­˜ â†’ ç”Ÿæˆè®¢å• â†’ æ”¯ä»˜ â†’ æ‰£å‡åº“å­˜
ä¼˜ç‚¹ï¼šé˜²æ­¢æ¶æ„å ç”¨
ç¼ºç‚¹ï¼šéœ€è¦å®šæ—¶é‡Šæ”¾è¶…æ—¶æœªæ”¯ä»˜çš„é”å®šåº“å­˜
```

**âš ï¸ åº“å­˜å¹¶å‘é—®é¢˜è§£å†³**

åº“å­˜æ‰£å‡æ˜¯å…¸å‹çš„å¹¶å‘åœºæ™¯ï¼Œå¿…é¡»ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼š

| **æ–¹æ¡ˆ** | **å®ç°æ–¹å¼** | **ä¼˜ç¼ºç‚¹** |
|---------|-------------|-----------|
| **æ‚²è§‚é”** | `SELECT FOR UPDATE` | æ€§èƒ½è¾ƒä½ï¼Œå®‰å…¨æ€§é«˜ |
| **ä¹è§‚é”** | `@Versionç‰ˆæœ¬å·` | æ€§èƒ½é«˜ï¼Œéœ€è¦é‡è¯•æœºåˆ¶ |
| **Redisåˆ†å¸ƒå¼é”** | `ä½¿ç”¨Rediså®ç°åº“å­˜æ‰£å‡` | é«˜å¹¶å‘é¦–é€‰ï¼Œéœ€è¦é¢å¤–ä¸­é—´ä»¶ |

**ä½¿ç”¨ä¹è§‚é”æ‰£å‡åº“å­˜ç¤ºä¾‹ï¼š**
```java
public boolean reduceStock(Long productId, Integer quantity) {
    Inventory inventory = session.get(Inventory.class, productId);
    
    // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    if (inventory.getAvailableStock() < quantity) {
        return false;
    }
    
    // æ‰£å‡å¯ç”¨åº“å­˜ï¼Œå¢åŠ å·²å”®åº“å­˜
    inventory.setAvailableStock(inventory.getAvailableStock() - quantity);
    inventory.setSoldStock(inventory.getSoldStock() + quantity);
    
    try {
        session.update(inventory);  // ç‰ˆæœ¬å·ä¼šè‡ªåŠ¨+1å¹¶æ ¡éªŒ
        return true;
    } catch (OptimisticLockException e) {
        // ç‰ˆæœ¬å†²çªï¼Œè¯´æ˜åº“å­˜è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†
        return false;  // è¿”å›å¤±è´¥ï¼Œä¸šåŠ¡å±‚é‡è¯•
    }
}
```

---

## 2. ğŸ“ åšå®¢ç³»ç»Ÿå®æˆ˜è®¾è®¡


### 2.1 åšå®¢ç³»ç»Ÿæ•´ä½“æ¶æ„


**ğŸ“ ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—**

åšå®¢ç³»ç»Ÿæ˜¯å…¸å‹çš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼Œæ ¸å¿ƒæ˜¯æ–‡ç« çš„å‘å¸ƒã€å±•ç¤ºã€è¯„è®ºå’Œç”¨æˆ·äº’åŠ¨ã€‚

```
åšå®¢ç³»ç»Ÿæ¨¡å—æ¶æ„ï¼š

           åšå®¢å¹³å°æ ¸å¿ƒ
                |
    +-----------+-----------+
    |           |           |
ç”¨æˆ·æƒé™     å†…å®¹ç®¡ç†     äº’åŠ¨åŠŸèƒ½
    |           |           |
    |           |           |
è§’è‰²ç®¡ç†    æ–‡ç« ç®¡ç†     è¯„è®ºç³»ç»Ÿ
æƒé™æ§åˆ¶    åˆ†ç±»æ ‡ç­¾     ç‚¹èµæ”¶è—
           è‰ç¨¿ç®±        å…³æ³¨è®¢é˜…
```

**ğŸ“‹ æ ¸å¿ƒå®ä½“å…³ç³»**

| **å®ä½“** | **ä½œç”¨** | **æ ¸å¿ƒå…³ç³»** | **ä¸šåŠ¡åœºæ™¯** |
|---------|---------|-------------|-------------|
| `User` | ç”¨æˆ·/ä½œè€… | ä¸€å¯¹å¤šæ–‡ç« ã€ä¸€å¯¹å¤šè¯„è®º | æ³¨å†Œã€ç™»å½•ã€å‘æ–‡ |
| `Article` | æ–‡ç«  | å¤šå¯¹ä¸€ç”¨æˆ·ã€å¤šå¯¹å¤šæ ‡ç­¾ | å‘å¸ƒã€ç¼–è¾‘ã€æµè§ˆ |
| `Category` | åˆ†ç±» | ä¸€å¯¹å¤šæ–‡ç«  | æ–‡ç« åˆ†ç±»ç®¡ç† |
| `Tag` | æ ‡ç­¾ | å¤šå¯¹å¤šæ–‡ç«  | æ–‡ç« æ ‡ç­¾åŒ– |
| `Comment` | è¯„è®º | å¤šå¯¹ä¸€æ–‡ç« ã€å¤šå¯¹ä¸€ç”¨æˆ· | æ–‡ç« è¯„è®ºäº’åŠ¨ |

### 2.2 ç”¨æˆ·æƒé™ç®¡ç†


**ğŸ‘¥ RBACæƒé™æ¨¡å‹è®¾è®¡**

RBACï¼ˆRole-Based Access Controlï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œæ˜¯åšå®¢ç³»ç»Ÿæƒé™ç®¡ç†çš„æ ‡å‡†æ–¹æ¡ˆã€‚

```
RBACæƒé™æ¨¡å‹å…³ç³»ï¼š

ç”¨æˆ·(User) â†â†’ è§’è‰²(Role) â†â†’ æƒé™(Permission)
     n          n:n          n

ç¤ºä¾‹ï¼š
ç”¨æˆ·"å¼ ä¸‰" â†’ è§’è‰²"ç¼–è¾‘" â†’ æƒé™["å‘å¸ƒæ–‡ç« ", "ä¿®æ”¹æ–‡ç« ", "åˆ é™¤æ–‡ç« "]
ç”¨æˆ·"æå››" â†’ è§’è‰²"è¯»è€…" â†’ æƒé™["æµè§ˆæ–‡ç« ", "å‘è¡¨è¯„è®º"]
```

```java
@Entity
@Table(name = "t_user")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private String username;
    
    // å¤šå¯¹å¤šï¼šç”¨æˆ·æ‹¥æœ‰å¤šä¸ªè§’è‰²
    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
        name = "t_user_role",
        joinColumns = @JoinColumn(name = "user_id"),
        inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    private Set<Role> roles = new HashSet<>();
}

@Entity
@Table(name = "t_role")
public class Role {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String roleName;  // è§’è‰²åç§°ï¼šADMIN/EDITOR/USER
    
    // å¤šå¯¹å¤šï¼šè§’è‰²æ‹¥æœ‰å¤šä¸ªæƒé™
    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
        name = "t_role_permission",
        joinColumns = @JoinColumn(name = "role_id"),
        inverseJoinColumns = @JoinColumn(name = "permission_id")
    )
    private Set<Permission> permissions = new HashSet<>();
}

@Entity
@Table(name = "t_permission")
public class Permission {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String permissionName;  // æƒé™æ ‡è¯†ï¼šarticle:create
    private String description;     // æƒé™æè¿°ï¼šåˆ›å»ºæ–‡ç« 
}
```

**ğŸ”‘ æƒé™æ£€æŸ¥æµç¨‹**

```
ç”¨æˆ·è®¿é—®è¯·æ±‚ â†’ è·å–ç”¨æˆ·è§’è‰² â†’ è·å–è§’è‰²æƒé™ â†’ åŒ¹é…æ‰€éœ€æƒé™
                                                    â†“
                                           å…è®¸è®¿é—®/æ‹’ç»è®¿é—®
```

### 2.3 å†…å®¹ç®¡ç†ç³»ç»Ÿ(CMS)


**ğŸ“° æ–‡ç« å®ä½“è®¾è®¡**

```java
@Entity
@Table(name = "t_article")
public class Article {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String title;        // æ–‡ç« æ ‡é¢˜
    
    @Lob
    private String content;      // æ–‡ç« å†…å®¹ï¼ˆæ”¯æŒå¯Œæ–‡æœ¬ï¼‰
    
    private String summary;      // æ–‡ç« æ‘˜è¦
    private String coverImage;   // å°é¢å›¾ç‰‡URL
    
    // å¤šå¯¹ä¸€ï¼šæ–‡ç« å±äºæŸä¸ªä½œè€…
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "author_id")
    private User author;
    
    // å¤šå¯¹ä¸€ï¼šæ–‡ç« å±äºæŸä¸ªåˆ†ç±»
    @ManyToOne
    @JoinColumn(name = "category_id")
    private Category category;
    
    // å¤šå¯¹å¤šï¼šæ–‡ç« æœ‰å¤šä¸ªæ ‡ç­¾
    @ManyToMany
    @JoinTable(
        name = "t_article_tag",
        joinColumns = @JoinColumn(name = "article_id"),
        inverseJoinColumns = @JoinColumn(name = "tag_id")
    )
    private Set<Tag> tags = new HashSet<>();
    
    @Enumerated(EnumType.STRING)
    private ArticleStatus status;  // æ–‡ç« çŠ¶æ€ï¼šè‰ç¨¿/å·²å‘å¸ƒ/å·²ä¸‹æ¶
    
    private Integer viewCount;     // æµè§ˆæ¬¡æ•°
    private Integer likeCount;     // ç‚¹èµæ•°
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date createTime;       // åˆ›å»ºæ—¶é—´
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date publishTime;      // å‘å¸ƒæ—¶é—´
}
```

**âœï¸ æ–‡ç« å‘å¸ƒæµç¨‹**

```
åˆ›ä½œæµç¨‹ï¼š
ä¿å­˜è‰ç¨¿ â†’ é¢„è§ˆæ•ˆæœ â†’ é€‰æ‹©åˆ†ç±» â†’ æ·»åŠ æ ‡ç­¾ â†’ è®¾ç½®å°é¢ â†’ å‘å¸ƒæ–‡ç« 

çŠ¶æ€è½¬æ¢ï¼š
è‰ç¨¿(DRAFT) â†’ å·²å‘å¸ƒ(PUBLISHED) â†’ å·²ä¸‹æ¶(OFFLINE)
     â†“              â†“
  å¯ç»§ç»­ç¼–è¾‘      å¯è¯„è®ºæµè§ˆ
```

**ğŸ·ï¸ åˆ†ç±»ä¸æ ‡ç­¾çš„åŒºåˆ«**

| **ç‰¹æ€§** | **åˆ†ç±»(Category)** | **æ ‡ç­¾(Tag)** |
|---------|-------------------|--------------|
| **å…³ç³»** | ä¸€å¯¹å¤šï¼ˆä¸€ç¯‡æ–‡ç« åªèƒ½å±äºä¸€ä¸ªåˆ†ç±»ï¼‰ | å¤šå¯¹å¤šï¼ˆä¸€ç¯‡æ–‡ç« å¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼‰ |
| **ç»“æ„** | æ ‘å½¢å±‚çº§ç»“æ„ | æ‰å¹³åŒ–ç»“æ„ |
| **ç”¨é€”** | æ–‡ç« ä¸»è¦å½’ç±» | æ–‡ç« ç»†èŠ‚æ ‡è®° |
| **ç¤ºä¾‹** | åˆ†ç±»ï¼šæŠ€æœ¯æ–‡ç«  | æ ‡ç­¾ï¼šJavaã€Springã€æ•°æ®åº“ |

### 2.4 è¯„è®ºç³»ç»Ÿè®¾è®¡


**ğŸ’¬ è¯„è®ºå®ä½“è®¾è®¡**

è¯„è®ºç³»ç»Ÿæ”¯æŒå¤šçº§å›å¤ï¼Œå½¢æˆè¯„è®ºæ ‘ç»“æ„ã€‚

```java
@Entity
@Table(name = "t_comment")
public class Comment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String content;     // è¯„è®ºå†…å®¹
    
    // å¤šå¯¹ä¸€ï¼šè¯„è®ºå±äºæŸç¯‡æ–‡ç« 
    @ManyToOne
    @JoinColumn(name = "article_id")
    private Article article;
    
    // å¤šå¯¹ä¸€ï¼šè¯„è®ºç”±æŸä¸ªç”¨æˆ·å‘è¡¨
    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;
    
    // è‡ªå…³è”ï¼šçˆ¶è¯„è®ºï¼ˆç”¨äºå›å¤åŠŸèƒ½ï¼‰
    @ManyToOne
    @JoinColumn(name = "parent_id")
    private Comment parent;
    
    // è‡ªå…³è”ï¼šå­è¯„è®ºåˆ—è¡¨
    @OneToMany(mappedBy = "parent")
    private List<Comment> replies = new ArrayList<>();
    
    private Integer likeCount;  // ç‚¹èµæ•°
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date createTime;
}
```

**ğŸŒ² è¯„è®ºæ ‘å½¢ç»“æ„ç¤ºä¾‹**

```
è¯„è®ºAï¼ˆæ ¹è¯„è®ºï¼‰
  â”œâ”€ å›å¤A1ï¼ˆå›å¤è¯„è®ºAï¼‰
  â”‚   â””â”€ å›å¤A1-1ï¼ˆå›å¤A1ï¼‰
  â””â”€ å›å¤A2ï¼ˆå›å¤è¯„è®ºAï¼‰

è¯„è®ºBï¼ˆæ ¹è¯„è®ºï¼‰
  â””â”€ å›å¤B1ï¼ˆå›å¤è¯„è®ºBï¼‰
```

**ğŸ’¡ è¯„è®ºåŠ è½½ç­–ç•¥**

| **ç­–ç•¥** | **å®ç°æ–¹å¼** | **é€‚ç”¨åœºæ™¯** |
|---------|-------------|-------------|
| **ä¸€æ¬¡æ€§åŠ è½½** | `JOIN FETCHé€’å½’æŸ¥è¯¢` | è¯„è®ºæ•°é‡è¾ƒå°‘ |
| **åˆ†é¡µåŠ è½½** | `åªåŠ è½½ä¸€çº§è¯„è®ºï¼Œç‚¹å‡»å±•å¼€å­è¯„è®º` | è¯„è®ºæ•°é‡å¾ˆå¤š |
| **æ‡’åŠ è½½** | `åˆå§‹åªæ˜¾ç¤ºéƒ¨åˆ†ï¼Œæ»šåŠ¨åŠ è½½æ›´å¤š` | ç§»åŠ¨ç«¯ä¼˜åŒ– |

---

## 3. ğŸ’¬ è®ºå›ç³»ç»Ÿå®æˆ˜è®¾è®¡


### 3.1 è®ºå›ç³»ç»Ÿæ•´ä½“æ¶æ„


**ğŸ¯ è®ºå›æ ¸å¿ƒæ¨¡å—**

```
è®ºå›ç³»ç»Ÿæ¶æ„ï¼š

          è®ºå›å¹³å°
              |
    +---------+---------+
    |         |         |
æ¿å—ç®¡ç†  å¸–å­ç®¡ç†  ç”¨æˆ·äº’åŠ¨
    |         |         |
ç‰ˆå—åˆ†ç±»  ä¸»é¢˜å¸–    å›å¸–ç³»ç»Ÿ
æƒé™æ§åˆ¶  ç²¾åå¸–    ç§¯åˆ†ç­‰çº§
         ç½®é¡¶å¸–    ç§ä¿¡é€šçŸ¥
```

**ğŸ“‹ è®ºå›æ ¸å¿ƒå®ä½“**

| **å®ä½“** | **ä½œç”¨** | **æ ¸å¿ƒå…³ç³»** | **ä¸šåŠ¡åœºæ™¯** |
|---------|---------|-------------|-------------|
| `Forum` | æ¿å—/ç‰ˆå— | ä¸€å¯¹å¤šä¸»é¢˜å¸– | è®ºå›åˆ†åŒº |
| `Thread` | ä¸»é¢˜å¸– | å¤šå¯¹ä¸€æ¿å—ã€ä¸€å¯¹å¤šå›å¤ | å‘å¸–ã€æµè§ˆ |
| `Post` | å›å¸–/æ¥¼å±‚ | å¤šå¯¹ä¸€ä¸»é¢˜å¸– | å›å¤äº’åŠ¨ |
| `UserProfile` | ç”¨æˆ·èµ„æ–™ | ä¸€å¯¹ä¸€ç”¨æˆ·ã€ç§¯åˆ†ç­‰çº§ | ä¸ªäººä¸­å¿ƒ |

### 3.2 æ¿å—ä¸ä¸»é¢˜å¸–è®¾è®¡


**ğŸ“‚ è®ºå›æ¿å—å®ä½“**

```java
@Entity
@Table(name = "t_forum")
public class Forum {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;         // æ¿å—åç§°
    
    private String description;  // æ¿å—æè¿°
    private String icon;         // æ¿å—å›¾æ ‡
    
    // è‡ªå…³è”ï¼šçˆ¶æ¿å—
    @ManyToOne
    @JoinColumn(name = "parent_id")
    private Forum parent;
    
    // è‡ªå…³è”ï¼šå­æ¿å—
    @OneToMany(mappedBy = "parent")
    private List<Forum> children = new ArrayList<>();
    
    // ä¸€å¯¹å¤šï¼šæ¿å—ä¸‹çš„ä¸»é¢˜å¸–
    @OneToMany(mappedBy = "forum")
    private List<Thread> threads = new ArrayList<>();
    
    private Integer threadCount; // ä¸»é¢˜æ•°é‡
    private Integer postCount;   // å›å¸–æ•°é‡
    private Integer sortOrder;   // æ˜¾ç¤ºé¡ºåº
}
```

**ğŸ“ ä¸»é¢˜å¸–å®ä½“è®¾è®¡**

```java
@Entity
@Table(name = "t_thread")
public class Thread {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String title;    // ä¸»é¢˜æ ‡é¢˜
    
    @Lob
    private String content;  // ä¸»é¢˜å†…å®¹
    
    // å¤šå¯¹ä¸€ï¼šä¸»é¢˜å±äºæŸä¸ªæ¿å—
    @ManyToOne
    @JoinColumn(name = "forum_id")
    private Forum forum;
    
    // å¤šå¯¹ä¸€ï¼šä¸»é¢˜ç”±æŸä¸ªç”¨æˆ·å‘è¡¨
    @ManyToOne
    @JoinColumn(name = "user_id")
    private User author;
    
    // ä¸€å¯¹å¤šï¼šä¸»é¢˜çš„å›å¸–åˆ—è¡¨
    @OneToMany(mappedBy = "thread")
    @OrderBy("createTime ASC")
    private List<Post> posts = new ArrayList<>();
    
    private Boolean isTop;      // æ˜¯å¦ç½®é¡¶
    private Boolean isElite;    // æ˜¯å¦ç²¾å
    private Boolean isLocked;   // æ˜¯å¦é”å®šï¼ˆç¦æ­¢å›å¤ï¼‰
    
    private Integer viewCount;  // æµè§ˆæ¬¡æ•°
    private Integer replyCount; // å›å¤æ•°é‡
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date createTime;
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date lastReplyTime; // æœ€åå›å¤æ—¶é—´
}
```

### 3.3 å›å¸–ç³»ç»Ÿè®¾è®¡


**ğŸ’¬ å›å¸–å®ä½“ï¼ˆæ¥¼å±‚ï¼‰**

```java
@Entity
@Table(name = "t_post")
public class Post {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String content;      // å›å¸–å†…å®¹
    
    // å¤šå¯¹ä¸€ï¼šå›å¸–å±äºæŸä¸ªä¸»é¢˜
    @ManyToOne
    @JoinColumn(name = "thread_id")
    private Thread thread;
    
    // å¤šå¯¹ä¸€ï¼šå›å¸–ç”±æŸä¸ªç”¨æˆ·å‘è¡¨
    @ManyToOne
    @JoinColumn(name = "user_id")
    private User author;
    
    private Integer floor;       // æ¥¼å±‚å·ï¼ˆ1æ¥¼ã€2æ¥¼...ï¼‰
    
    // å¼•ç”¨å›å¤ï¼š@æŸäººçš„å›å¤
    @ManyToOne
    @JoinColumn(name = "quote_post_id")
    private Post quotePost;      // å¼•ç”¨çš„å¸–å­
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date createTime;
}
```

**ğŸ¢ æ¥¼å±‚å·è®¡ç®—é€»è¾‘**

```
æ¥¼å±‚å·ç”Ÿæˆè§„åˆ™ï¼š
1æ¥¼ â†’ ä¸»é¢˜å¸–å†…å®¹ï¼ˆä½œä¸ºç¬¬ä¸€å±‚ï¼‰
2æ¥¼ â†’ ç¬¬ä¸€æ¡å›å¤
3æ¥¼ â†’ ç¬¬äºŒæ¡å›å¤
...ä»¥æ­¤ç±»æ¨

å¼•ç”¨å›å¤ç¤ºä¾‹ï¼š
ç”¨æˆ·Båœ¨5æ¥¼å›å¤ï¼š"@3æ¥¼ï¼Œæˆ‘è®¤ä¸º..."
â””â”€ quotePostæŒ‡å‘3æ¥¼çš„Postè®°å½•
```

### 3.4 ç”¨æˆ·ç§¯åˆ†ä¸ç­‰çº§ç³»ç»Ÿ


**â­ ç”¨æˆ·æ‰©å±•èµ„æ–™**

```java
@Entity
@Table(name = "t_user_profile")
public class UserProfile {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @OneToOne
    @JoinColumn(name = "user_id", unique = true)
    private User user;
    
    private String avatar;       // å¤´åƒ
    private String signature;    // ä¸ªæ€§ç­¾å
    
    private Integer points;      // ç§¯åˆ†æ€»æ•°
    private Integer level;       // ç”¨æˆ·ç­‰çº§
    
    private Integer threadCount; // å‘å¸–æ•°
    private Integer postCount;   // å›å¸–æ•°
    
    @Temporal(TemporalType.TIMESTAMP)
    private Date lastLoginTime;  // æœ€åç™»å½•æ—¶é—´
}
```

**ğŸ“Š ç§¯åˆ†è§„åˆ™è®¾è®¡**

| **è¡Œä¸º** | **ç§¯åˆ†å˜åŒ–** | **è¯´æ˜** |
|---------|-------------|---------|
| å‘è¡¨ä¸»é¢˜ | `+5` | é¼“åŠ±å‘å¸– |
| å›å¤å¸–å­ | `+2` | é¼“åŠ±äº’åŠ¨ |
| æ¯æ—¥ç™»å½• | `+1` | æé«˜æ´»è·ƒåº¦ |
| å¸–å­è¢«ç‚¹èµ | `+1` | ä¼˜è´¨å†…å®¹å¥–åŠ± |
| è¿è§„æ‰£åˆ† | `-10` | æƒ©ç½šæœºåˆ¶ |

**ğŸ† ç­‰çº§è®¡ç®—è§„åˆ™**

```
ç­‰çº§æ™‹å‡è§„åˆ™ï¼š
0-100ç§¯åˆ†   â†’ æ–°æ‰‹(Lv1)
101-500ç§¯åˆ† â†’ åˆçº§ä¼šå‘˜(Lv2)  
501-1000ç§¯åˆ† â†’ ä¸­çº§ä¼šå‘˜(Lv3)
1001-3000ç§¯åˆ† â†’ é«˜çº§ä¼šå‘˜(Lv4)
3000+ç§¯åˆ†   â†’ VIPä¼šå‘˜(Lv5)
```

---

## 4. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 4.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®ä½“å…³ç³»è®¾è®¡ï¼šä¸€å¯¹å¤šã€å¤šå¯¹å¤šã€è‡ªå…³è”çš„çµæ´»è¿ç”¨
ğŸ”¸ çº§è”æ“ä½œï¼šCascadeTypeçš„åˆç†é…ç½®ï¼Œé¿å…è¯¯åˆ æ•°æ®
ğŸ”¸ æ‡’åŠ è½½ç­–ç•¥ï¼šFetchType.LAZYå‡å°‘ä¸å¿…è¦çš„æ•°æ®åŠ è½½
ğŸ”¸ ä¹è§‚é”åº”ç”¨ï¼š@Versionè§£å†³å¹¶å‘æ›´æ–°é—®é¢˜
ğŸ”¸ çŠ¶æ€ç®¡ç†ï¼šä½¿ç”¨æšä¸¾ç®¡ç†å®ä½“çš„çŠ¶æ€æµè½¬
ğŸ”¸ æ ‘å½¢ç»“æ„ï¼šè‡ªå…³è”å®ç°åˆ†ç±»æ ‘ã€è¯„è®ºæ ‘ç­‰å±‚çº§ç»“æ„
```

### 4.2 å…³é”®è®¾è®¡è¦ç‚¹


**ğŸ”¹ ç”µå•†ç³»ç»Ÿè®¾è®¡ç²¾é«“**
```
ç”¨æˆ·-è®¢å•-å•†å“ï¼šå¤šå¯¹å¤šå…³ç³»é€šè¿‡è®¢å•æ˜ç»†è¡¨å…³è”
åº“å­˜ç®¡ç†ï¼šä¹è§‚é”+ç‰ˆæœ¬å·è§£å†³å¹¶å‘æ‰£å‡é—®é¢˜
è´­ç‰©è½¦è®¾è®¡ï¼šorphanRemovalè‡ªåŠ¨æ¸…ç†å­¤å„¿è®°å½•
è®¢å•çŠ¶æ€ï¼šçŠ¶æ€æœºæ¨¡å¼ç®¡ç†è®¢å•ç”Ÿå‘½å‘¨æœŸ
```

**ğŸ”¹ åšå®¢ç³»ç»Ÿè®¾è®¡ç²¾é«“**
```
æƒé™ç®¡ç†ï¼šRBACæ¨¡å‹å®ç°çµæ´»çš„æƒé™æ§åˆ¶
åˆ†ç±»æ ‡ç­¾ï¼šåˆ†ç±»ç”¨ä¸€å¯¹å¤šï¼Œæ ‡ç­¾ç”¨å¤šå¯¹å¤š
æ–‡ç« çŠ¶æ€ï¼šè‰ç¨¿-å‘å¸ƒ-ä¸‹æ¶çš„çŠ¶æ€æµè½¬
è¯„è®ºç³»ç»Ÿï¼šè‡ªå…³è”å®ç°å¤šçº§è¯„è®ºæ ‘
```

**ğŸ”¹ è®ºå›ç³»ç»Ÿè®¾è®¡ç²¾é«“**
```
æ¿å—å±‚çº§ï¼šè‡ªå…³è”å®ç°æ¿å—æ ‘å½¢ç»“æ„
æ¥¼å±‚è®¡æ•°ï¼šä¸»é¢˜å¸–+å›å¸–å½¢æˆæ¥¼å±‚ç³»ç»Ÿ
å¼•ç”¨å›å¤ï¼šé€šè¿‡å¤–é”®å…³è”å®ç°@æŸäººåŠŸèƒ½
ç§¯åˆ†ç­‰çº§ï¼šç”¨æˆ·è¡Œä¸ºè§¦å‘ç§¯åˆ†å˜åŒ–å’Œç­‰çº§æ™‹å‡
```

### 4.3 å®æˆ˜å¼€å‘å»ºè®®


**ğŸ’¼ å¼€å‘æœ€ä½³å®è·µ**

| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **é¿å…é—®é¢˜** |
|---------|-------------|-------------|
| **å¹¶å‘åº“å­˜** | `ä¹è§‚é”+é‡è¯•` | è¶…å–é—®é¢˜ |
| **å¤§æ•°æ®é‡** | `æ‡’åŠ è½½+åˆ†é¡µ` | å†…å­˜æº¢å‡º |
| **æ ‘å½¢æŸ¥è¯¢** | `é€’å½’æŸ¥è¯¢æˆ–ä¸€æ¬¡åŠ è½½` | N+1æŸ¥è¯¢ |
| **çŠ¶æ€ç®¡ç†** | `æšä¸¾ç±»å‹` | é­”æ³•å€¼ |
| **çº§è”åˆ é™¤** | `æ…ç”¨ALLï¼Œæ˜ç¡®ä¸šåŠ¡` | è¯¯åˆ æ•°æ® |

**âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³**

```
é—®é¢˜1ï¼šN+1æŸ¥è¯¢
åŸå› ï¼šæ‡’åŠ è½½å¯¼è‡´å¾ªç¯æŸ¥è¯¢
è§£å†³ï¼šä½¿ç”¨JOIN FETCHä¸€æ¬¡æ€§åŠ è½½å…³è”æ•°æ®

é—®é¢˜2ï¼šåº“å­˜è¶…å–
åŸå› ï¼šå¹¶å‘æ‰£å‡æ²¡æœ‰åŠ é”
è§£å†³ï¼šä½¿ç”¨ä¹è§‚é”@Versionæˆ–æ‚²è§‚é”SELECT FOR UPDATE

é—®é¢˜3ï¼šè´­ç‰©è½¦æ•°æ®å†—ä½™
åŸå› ï¼šå·²åˆ å•†å“ä»åœ¨è´­ç‰©è½¦
è§£å†³ï¼šä½¿ç”¨orphanRemoval=trueè‡ªåŠ¨æ¸…ç†

é—®é¢˜4ï¼šè¯„è®ºæ ‘åŠ è½½æ…¢
åŸå› ï¼šé€’å½’æŸ¥è¯¢å±‚çº§è¿‡æ·±
è§£å†³ï¼šé™åˆ¶è¯„è®ºå±‚çº§æˆ–åˆ†é¡µåŠ è½½
```

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**

```
æ•°æ®åº“å±‚é¢ï¼š
âœ“ ä¸ºå¤–é”®å­—æ®µæ·»åŠ ç´¢å¼•
âœ“ åˆç†ä½¿ç”¨å¤åˆç´¢å¼•
âœ“ é¿å…è¿‡æ·±çš„JOINæŸ¥è¯¢
âœ“ ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼ˆäºŒçº§ç¼“å­˜ï¼‰

ä»£ç å±‚é¢ï¼š
âœ“ æ˜ç¡®æŒ‡å®šFetchType
âœ“ ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘SQLæ¬¡æ•°
âœ“ DTOæ¨¡å¼é¿å…è¿”å›å…¨é‡å®ä½“
âœ“ æ‡’åŠ è½½é…åˆæŒ‰éœ€æŸ¥è¯¢
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å®ä½“å…³ç³»ç†æ¸…æ¥šï¼Œä¸€å¤šå¤šå¤šè¦åˆ†æ˜
çº§è”æ“ä½œéœ€è°¨æ…ï¼Œè¯¯åˆ æ•°æ®æ‚”ç»ˆèº«
æ‡’åŠ è½½æ¥ä¼˜æ€§èƒ½ï¼ŒæŒ‰éœ€æŸ¥è¯¢æœ€èªæ˜
å¹¶å‘é—®é¢˜åŠ é”è§£ï¼Œä¹è§‚æ‚²è§‚å„æœ‰ç”¨
çŠ¶æ€ç®¡ç†ç”¨æšä¸¾ï¼Œæ ‘å½¢è‡ªå…³è”å®ç°
å®æˆ˜é¡¹ç›®å¤šç»ƒæ‰‹ï¼Œç†è®ºå®è·µä¸¤ä¸è¯¯
```