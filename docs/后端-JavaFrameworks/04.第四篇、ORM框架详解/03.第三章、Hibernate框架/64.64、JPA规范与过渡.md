---
title: 64ã€JPAè§„èŒƒä¸è¿‡æ¸¡
---
## ğŸ“š ç›®å½•

1. [JPAè§„èŒƒä»‹ç»](#1-JPAè§„èŒƒä»‹ç»)
2. [EntityManager vs Sessionå¯¹æ¯”](#2-EntityManager-vs-Sessionå¯¹æ¯”)
3. [PersistenceContextæ³¨è§£è¯¦è§£](#3-PersistenceContextæ³¨è§£è¯¦è§£)
4. [Spring Data JPAå¿«é€Ÿä¸Šæ‰‹](#4-Spring-Data-JPAå¿«é€Ÿä¸Šæ‰‹)
5. [Hibernateåˆ°JPAè¿ç§»ç­–ç•¥](#5-Hibernateåˆ°JPAè¿ç§»ç­–ç•¥)
6. [å…¼å®¹æ€§è€ƒè™‘ä¸æœ€ä½³å®è·µ](#6-å…¼å®¹æ€§è€ƒè™‘ä¸æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ JPAè§„èŒƒä»‹ç»


### 1.1 ä»€ä¹ˆæ˜¯JPAè§„èŒƒ


**é€šä¿—ç†è§£**ï¼šJPAå°±åƒæ˜¯ä¸€å¥—"ç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œæ ‡å‡†"

```
ç°å®ç±»æ¯”ï¼š
æ’åº§æ ‡å‡† = JPAè§„èŒƒ          ç”µå™¨ = ä½ çš„ç¨‹åº
æ’å¤´     = Hibernateå®ç°      ç”µå™¨æ’å¤´ = ä½ çš„ä»£ç 

åªè¦éµå¾ªç»Ÿä¸€æ ‡å‡†ï¼Œæ¢å“ªä¸ªç‰Œå­çš„æ’åº§éƒ½èƒ½ç”¨ï¼
åŒæ ·ï¼Œä½¿ç”¨JPAè§„èŒƒï¼Œæ¢å“ªä¸ªORMæ¡†æ¶éƒ½ä¸ç”¨æ”¹å¤ªå¤šä»£ç 
```

**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
JPA = Java Persistence APIï¼ˆJavaæŒä¹…åŒ–APIï¼‰
æœ¬è´¨ï¼šä¸€å¥—æ¥å£è§„èŒƒï¼Œä¸æ˜¯å…·ä½“å®ç°
ä½œç”¨ï¼šå®šä¹‰äº†Javaå¯¹è±¡å¦‚ä½•æ˜ å°„åˆ°æ•°æ®åº“è¡¨
ç›®æ ‡ï¼šè®©ä¸åŒORMæ¡†æ¶æœ‰ç»Ÿä¸€çš„ä½¿ç”¨æ–¹å¼
```

### 1.2 JPAè§„èŒƒçš„ä¸‰å¤§ç»„æˆéƒ¨åˆ†


**ğŸ“‹ æ ¸å¿ƒç»„ä»¶**

| ç»„ä»¶ | ä½œç”¨ | é€šä¿—ç†è§£ |
|------|------|----------|
| **ORMæ˜ å°„** | å®šä¹‰å®ä½“ç±»å¦‚ä½•æ˜ å°„è¡¨ | å‘Šè¯‰ç¨‹åº"è¿™ä¸ªJavaç±»å¯¹åº”å“ªå¼ è¡¨" |
| **EntityManager** | æ“ä½œå®ä½“çš„API | ç±»ä¼¼Hibernateçš„Sessionï¼Œç”¨æ¥å¢åˆ æ”¹æŸ¥ |
| **JPQLæŸ¥è¯¢è¯­è¨€** | é¢å‘å¯¹è±¡çš„æŸ¥è¯¢è¯­è¨€ | ç±»ä¼¼SQLï¼Œä½†æ“ä½œçš„æ˜¯Javaå¯¹è±¡è€Œéè¡¨ |

**ğŸ’¡ ä¸¾ä¸ªä¾‹å­**

```java
// è¿™æ˜¯JPAæ ‡å‡†çš„æ³¨è§£ï¼ˆé€šç”¨çš„ï¼‰
@Entity  // è¡¨æ˜è¿™æ˜¯ä¸ªæ•°æ®åº“è¡¨å¯¹åº”çš„ç±»
@Table(name = "users")
public class User {
    @Id  // ä¸»é”®
    @GeneratedValue  // è‡ªåŠ¨ç”Ÿæˆ
    private Long id;
    
    private String name;
    // getter/setter...
}
```

### 1.3 JPAè§„èŒƒ vs Hibernateçš„å…³ç³»


**ğŸ”— ç†è§£å®ƒä»¬çš„å…³ç³»**

```
å…³ç³»å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     JPAè§„èŒƒï¼ˆæ¥å£ï¼‰      â”‚  â† åˆ¶å®šæ ‡å‡†çš„äºº
â”‚   å®šä¹‰æ€ä¹ˆæ“ä½œæ•°æ®åº“     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ å®ç°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Hibernateå®ç°        â”‚  â† å¹²æ´»çš„äºº
â”‚   çœŸæ­£æ‰§è¡Œæ•°æ®åº“æ“ä½œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç±»æ¯”ï¼š
JPAè§„èŒƒ = å»ºç­‘è®¾è®¡å›¾çº¸
Hibernate = æ–½å·¥é˜Ÿï¼ˆæŒ‰å›¾çº¸æ–½å·¥ï¼‰
```

**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦JPAè§„èŒƒ**

- âœ… **åˆ‡æ¢æ–¹ä¾¿**ï¼šä»Hibernateæ¢åˆ°EclipseLinkï¼Œä»£ç æ”¹åŠ¨å°‘
- âœ… **å­¦ä¹ ç®€å•**ï¼šå­¦ä¼šJPAï¼Œå„ç§ORMæ¡†æ¶éƒ½ä¼šç”¨
- âœ… **è¡Œä¸šæ ‡å‡†**ï¼šä¼ä¸šçº§å¼€å‘æ™®éé‡‡ç”¨
- âœ… **Springå‹å¥½**ï¼šSpringæ¡†æ¶æ·±åº¦é›†æˆJPA

### 1.4 å¸¸è§çš„JPAå®ç°


**ğŸ”¸ ä¸»æµå®ç°å¯¹æ¯”**

```
Hibernateå®ç°ï¼š
â”œâ”€ æœ€æµè¡Œï¼ŒåŠŸèƒ½æœ€å…¨
â”œâ”€ æ€§èƒ½ä¼˜åŒ–æˆç†Ÿ
â””â”€ ç¤¾åŒºæ”¯æŒå¥½

EclipseLinkå®ç°ï¼š
â”œâ”€ JPAå‚è€ƒå®ç°ï¼ˆå®˜æ–¹ç¤ºèŒƒï¼‰
â”œâ”€ è½»é‡çº§
â””â”€ Oracleå®˜æ–¹æ”¯æŒ

OpenJPAå®ç°ï¼š
â”œâ”€ Apacheå¼€æº
â”œâ”€ ä¼ä¸šçº§åº”ç”¨
â””â”€ IBMæ”¯æŒ
```

> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šå…ˆå­¦JPAæ ‡å‡†æ³¨è§£å’ŒAPIï¼Œåº•å±‚ç”¨Hibernateå®ç°å°±å¥½ã€‚è¿™æ ·æ—¢èƒ½äº«å—Hibernateçš„å¼ºå¤§åŠŸèƒ½ï¼Œåˆèƒ½ä¿æŒä»£ç çš„å¯ç§»æ¤æ€§ã€‚

---

## 2. âš–ï¸ EntityManager vs Sessionå¯¹æ¯”


### 2.1 å®ƒä»¬æ˜¯ä»€ä¹ˆ


**ğŸ”¸ Sessionï¼ˆHibernateä¸“å±ï¼‰**
```
Session = Hibernateçš„"æ•°æ®åº“æ“ä½œå‘˜"
ç‰¹ç‚¹ï¼šHibernateæ¡†æ¶ç‰¹æœ‰çš„API
ä½œç”¨ï¼šç®¡ç†å®ä½“å¯¹è±¡çš„å¢åˆ æ”¹æŸ¥
```

**ğŸ”¸ EntityManagerï¼ˆJPAæ ‡å‡†ï¼‰**
```
EntityManager = JPAè§„èŒƒçš„"æ•°æ®åº“æ“ä½œå‘˜"
ç‰¹ç‚¹ï¼šJPAæ ‡å‡†æ¥å£ï¼Œä»»ä½•å®ç°éƒ½æœ‰
ä½œç”¨ï¼šä¹Ÿæ˜¯ç®¡ç†å®ä½“å¯¹è±¡çš„å¢åˆ æ”¹æŸ¥
```

**ğŸ“Š è§’è‰²å¯¹æ¯”**

```
Hibernateä½“ç³»ï¼š           JPAä½“ç³»ï¼š
Application              Application
     â†“                        â†“
  Session    â†å¯¹åº”â†’     EntityManager
     â†“                        â†“
  Hibernate                å®ç°å±‚ï¼ˆå¦‚Hibernateï¼‰
     â†“                        â†“
  Database                 Database
```

### 2.2 æ ¸å¿ƒAPIå¯¹æ¯”


**ğŸ”¸ å¸¸ç”¨æ“ä½œå¯¹ç…§è¡¨**

| æ“ä½œ | Hibernate Session | JPA EntityManager | è¯´æ˜ |
|------|-------------------|-------------------|------|
| **ä¿å­˜** | `session.save(obj)` | `em.persist(obj)` | æŠŠå¯¹è±¡å­˜å…¥æ•°æ®åº“ |
| **æŸ¥è¯¢** | `session.get(User.class, id)` | `em.find(User.class, id)` | æ ¹æ®IDæŸ¥æ‰¾ |
| **æ›´æ–°** | `session.update(obj)` | `em.merge(obj)` | æ›´æ–°å¯¹è±¡æ•°æ® |
| **åˆ é™¤** | `session.delete(obj)` | `em.remove(obj)` | åˆ é™¤æ•°æ® |
| **æŸ¥è¯¢è¯­è¨€** | HQL | JPQL | é¢å‘å¯¹è±¡çš„æŸ¥è¯¢ |

**ğŸ’¡ ä»£ç å¯¹æ¯”ç¤ºä¾‹**

```java
// Hibernateæ–¹å¼ï¼ˆSessionï¼‰
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
User user = new User("å¼ ä¸‰");
session.save(user);  // ä¿å­˜
tx.commit();
session.close();

// JPAæ–¹å¼ï¼ˆEntityManagerï¼‰
EntityManager em = emf.createEntityManager();
EntityTransaction tx = em.getTransaction();
tx.begin();
User user = new User("å¼ ä¸‰");
em.persist(user);  // ä¿å­˜ï¼ˆæ–¹æ³•åä¸åŒï¼‰
tx.commit();
em.close();
```

> âš ï¸ **æ³¨æ„**ï¼šæ–¹æ³•åè™½ç„¶ä¸åŒï¼Œä½†ä½œç”¨å®Œå…¨ä¸€æ ·ï¼

### 2.3 æŸ¥è¯¢æ–¹å¼å¯¹æ¯”


**ğŸ”¸ HQL vs JPQL**

```java
// Hibernateçš„HQLæŸ¥è¯¢
String hql = "FROM User WHERE name = :name";
Query query = session.createQuery(hql);
query.setParameter("name", "å¼ ä¸‰");
List<User> users = query.list();

// JPAçš„JPQLæŸ¥è¯¢ï¼ˆå‡ ä¹ä¸€æ ·ï¼‰
String jpql = "FROM User WHERE name = :name";
TypedQuery<User> query = em.createQuery(jpql, User.class);
query.setParameter("name", "å¼ ä¸‰");
List<User> users = query.getResultList();
```

**ğŸ¯ å…³é”®åŒºåˆ«**

| ç‰¹æ€§ | HQL | JPQL |
|------|-----|------|
| **è¯­æ³•** | Hibernateä¸“æœ‰æ‰©å±• | JPAæ ‡å‡†è¯­æ³• |
| **å¯ç§»æ¤æ€§** | åªèƒ½ç”¨äºHibernate | ä»»ä½•JPAå®ç°éƒ½æ”¯æŒ |
| **åŠŸèƒ½** | åŠŸèƒ½æ›´ä¸°å¯Œ | åŠŸèƒ½ç›¸å¯¹åŸºç¡€ |

### 2.4 ä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ª


**âœ… ä½¿ç”¨EntityManagerçš„åœºæ™¯**

- ğŸ¯ æ–°é¡¹ç›®ï¼Œæƒ³ä¿æŒæŠ€æœ¯é€‰å‹çµæ´»æ€§
- ğŸ¯ å¯èƒ½æ›´æ¢ORMæ¡†æ¶
- ğŸ¯ å›¢é˜Ÿç†Ÿæ‚‰JPAæ ‡å‡†
- ğŸ¯ Spring Data JPAé¡¹ç›®

**âœ… ä½¿ç”¨Sessionçš„åœºæ™¯**

- ğŸ¯ è€é¡¹ç›®å·²ç»ç”¨Hibernate
- ğŸ¯ éœ€è¦Hibernateç‰¹æœ‰åŠŸèƒ½
- ğŸ¯ å›¢é˜Ÿå¯¹Hibernateå¾ˆç†Ÿæ‚‰
- ğŸ¯ ä¸è€ƒè™‘åˆ‡æ¢ORMæ¡†æ¶

> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šæ–°é¡¹ç›®ä¼˜å…ˆå­¦ä¹ EntityManagerï¼ˆJPAæ ‡å‡†ï¼‰ï¼Œå› ä¸ºSpring Booté»˜è®¤å°±æ˜¯JPAæ–¹å¼ï¼

---

## 3. ğŸ”§ PersistenceContextæ³¨è§£è¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯@PersistenceContext


**é€šä¿—ç†è§£**ï¼šè¿™ä¸ªæ³¨è§£å°±æ˜¯å‘Šè¯‰Spring"å¸®æˆ‘æ³¨å…¥ä¸€ä¸ªæ•°æ®åº“æ“ä½œå‘˜ï¼ˆEntityManagerï¼‰"

```
ç±»æ¯”ç†è§£ï¼š
@Autowired = è¯·Springå¸®æˆ‘æ³¨å…¥ä¸€ä¸ªBean
@PersistenceContext = è¯·Springå¸®æˆ‘æ³¨å…¥ä¸€ä¸ªEntityManager

åŒºåˆ«ï¼š
@PersistenceContextæ˜¯JPAä¸“ç”¨çš„ï¼Œæ›´ä¸“ä¸š
```

**ğŸ”¸ åŸºæœ¬ç”¨æ³•**

```java
@Service
public class UserService {
    
    // Springä¼šè‡ªåŠ¨ç»™ä½ ä¸€ä¸ªEntityManager
    @PersistenceContext
    private EntityManager em;
    
    public void saveUser(User user) {
        em.persist(user);  // ç›´æ¥ç”¨å°±è¡Œ
    }
}
```

### 3.2 ä¸ºä»€ä¹ˆä¸ç”¨@Autowired


**ğŸ¤” å¸¸è§ç–‘é—®**

```java
// ä¸ºä»€ä¹ˆä¸è¿™æ ·å†™ï¼Ÿ
@Autowired
private EntityManager em;  // ä¹Ÿèƒ½ç”¨ï¼Œä½†ä¸æ¨è

// æ¨èè¿™æ ·å†™
@PersistenceContext
private EntityManager em;  // JPAæ ‡å‡†åšæ³•
```

**ğŸ“Š åŒºåˆ«å¯¹æ¯”**

| æ³¨è§£ | ä½œç”¨ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `@Autowired` | Springé€šç”¨æ³¨å…¥ | æ³¨å…¥ä»»ä½•Bean |
| `@PersistenceContext` | JPAä¸“ç”¨æ³¨å…¥ | æ³¨å…¥EntityManager |

**ğŸ¯ æ¨èç”¨@PersistenceContextçš„åŸå› **

- âœ… **çº¿ç¨‹å®‰å…¨**ï¼šè‡ªåŠ¨å¤„ç†EntityManagerçš„çº¿ç¨‹å®‰å…¨é—®é¢˜
- âœ… **äº‹åŠ¡æ„ŸçŸ¥**ï¼šèƒ½æ„ŸçŸ¥å½“å‰äº‹åŠ¡çŠ¶æ€
- âœ… **æ ‡å‡†åšæ³•**ï¼šJPAè§„èŒƒæ¨èçš„æ–¹å¼
- âœ… **è‡ªåŠ¨ç®¡ç†**ï¼šSpringè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

### 3.3 ä¸¤ç§ä¸Šä¸‹æ–‡ç±»å‹


**ğŸ”¸ Transactionç±»å‹ï¼ˆé»˜è®¤ï¼‰**

```java
@PersistenceContext(type = PersistenceContextType.TRANSACTION)
private EntityManager em;

ç‰¹ç‚¹ï¼š
â”œâ”€ æ¯ä¸ªäº‹åŠ¡ä¸€ä¸ªEntityManager
â”œâ”€ äº‹åŠ¡ç»“æŸè‡ªåŠ¨å…³é—­
â””â”€ æœ€å¸¸ç”¨ï¼Œä¹Ÿæ˜¯é»˜è®¤å€¼
```

**ğŸ”¸ Extendedç±»å‹ï¼ˆæ‰©å±•ï¼‰**

```java
@PersistenceContext(type = PersistenceContextType.EXTENDED)
private EntityManager em;

ç‰¹ç‚¹ï¼š
â”œâ”€ è·¨å¤šä¸ªäº‹åŠ¡
â”œâ”€ éœ€è¦æ‰‹åŠ¨ç®¡ç†
â””â”€ ç‰¹æ®Šåœºæ™¯æ‰ç”¨
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼š99%çš„æƒ…å†µç”¨é»˜è®¤çš„TRANSACTIONç±»å‹å°±å¤Ÿäº†ï¼

### 3.4 å®é™…ä½¿ç”¨ç¤ºä¾‹


**ğŸ”¸ å®Œæ•´çš„Serviceç±»å†™æ³•**

```java
@Service
@Transactional  // å£°æ˜è¿™ä¸ªç±»çš„æ–¹æ³•éƒ½è¦äº‹åŠ¡
public class UserService {
    
    @PersistenceContext
    private EntityManager em;
    
    // ä¿å­˜ç”¨æˆ·
    public void createUser(String name) {
        User user = new User(name);
        em.persist(user);
        // ä¸ç”¨æ‰‹åŠ¨commitï¼ŒSpringè‡ªåŠ¨å¤„ç†
    }
    
    // æŸ¥è¯¢ç”¨æˆ·
    public User findUser(Long id) {
        return em.find(User.class, id);
    }
    
    // JPQLæŸ¥è¯¢
    public List<User> findByName(String name) {
        return em.createQuery(
            "FROM User WHERE name = :name", User.class)
            .setParameter("name", name)
            .getResultList();
    }
}
```

**âš ï¸ å¸¸è§é”™è¯¯**

```java
// âŒ é”™è¯¯ï¼šå¿˜è®°åŠ @Transactional
public class UserService {
    @PersistenceContext
    private EntityManager em;
    
    public void saveUser(User user) {
        em.persist(user);  // æŠ¥é”™ï¼šæ²¡æœ‰äº‹åŠ¡ï¼
    }
}

// âœ… æ­£ç¡®ï¼šåŠ ä¸Š@Transactional
@Transactional
public class UserService {
    @PersistenceContext
    private EntityManager em;
    
    public void saveUser(User user) {
        em.persist(user);  // OKï¼
    }
}
```

---

## 4. ğŸš€ Spring Data JPAå¿«é€Ÿä¸Šæ‰‹


### 4.1 ä»€ä¹ˆæ˜¯Spring Data JPA


**é€šä¿—ç†è§£**ï¼šSpring Data JPAå°±æ˜¯"æ‡’äººç¥å™¨"ï¼Œè®©ä½ å†™æ›´å°‘çš„ä»£ç å¹²æ›´å¤šçš„äº‹

```
ä¼ ç»Ÿæ–¹å¼ï¼š
â”œâ”€ å†™EntityManagerä»£ç 
â”œâ”€ å†™JPQLè¯­å¥
â””â”€ å†™ä¸€å †é‡å¤ä»£ç 

Spring Data JPAï¼š
â”œâ”€ åªå®šä¹‰æ¥å£
â”œâ”€ æ–¹æ³•åè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢
â””â”€ å¸¸ç”¨åŠŸèƒ½å¼€ç®±å³ç”¨
```

**ğŸ”¸ æ ¸å¿ƒç†å¿µ**

```
ä½ åªéœ€è¦ï¼šå®šä¹‰æ¥å£
Springå¸®ä½ ï¼šå®ç°æ‰€æœ‰ä»£ç 

ç±»æ¯”ï¼š
ä½ è¯´"æˆ‘è¦æŸ¥ç”¨æˆ·" â†’ Springè‡ªåŠ¨å¸®ä½ å†™æŸ¥è¯¢ä»£ç 
```

### 4.2 å¿«é€Ÿå…¥é—¨ç¤ºä¾‹


**ğŸ”¸ ç¬¬ä¸€æ­¥ï¼šå®šä¹‰å®ä½“ç±»**

```java
@Entity
public class User {
    @Id
    @GeneratedValue
    private Long id;
    private String name;
    private Integer age;
    // getter/setter...
}
```

**ğŸ”¸ ç¬¬äºŒæ­¥ï¼šå®šä¹‰Repositoryæ¥å£**

```java
// åªéœ€è¦å®šä¹‰æ¥å£ï¼Œä¸ç”¨å†™å®ç°ï¼
public interface UserRepository extends JpaRepository<User, Long> {
    // ä»€ä¹ˆéƒ½ä¸ç”¨å†™ï¼Œå·²ç»æœ‰è¿™äº›æ–¹æ³•äº†ï¼š
    // save(user)          - ä¿å­˜
    // findById(id)        - æŸ¥è¯¢
    // findAll()           - æŸ¥æ‰€æœ‰
    // deleteById(id)      - åˆ é™¤
    // count()             - ç»Ÿè®¡
}
```

**ğŸ”¸ ç¬¬ä¸‰æ­¥ï¼šç›´æ¥ä½¿ç”¨**

```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepo;
    
    public void demo() {
        // ä¿å­˜
        User user = new User("å¼ ä¸‰", 25);
        userRepo.save(user);
        
        // æŸ¥è¯¢
        User found = userRepo.findById(1L).orElse(null);
        
        // æŸ¥æ‰€æœ‰
        List<User> all = userRepo.findAll();
        
        // åˆ é™¤
        userRepo.deleteById(1L);
    }
}
```

> ğŸ‰ **ç¥å¥‡ä¹‹å¤„**ï¼šä½ æ²¡å†™ä»»ä½•å®ç°ä»£ç ï¼Œä½†æ‰€æœ‰åŠŸèƒ½éƒ½èƒ½ç”¨ï¼

### 4.3 æ–¹æ³•åæŸ¥è¯¢ï¼ˆæœ€å¼ºå¤§çš„åŠŸèƒ½ï¼‰


**ğŸ”¸ æ ¹æ®æ–¹æ³•åè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢**

```java
public interface UserRepository extends JpaRepository<User, Long> {
    
    // æ ¹æ®åå­—æŸ¥è¯¢ï¼ˆè‡ªåŠ¨ç”ŸæˆSQLï¼‰
    User findByName(String name);
    
    // æ ¹æ®å¹´é¾„æŸ¥è¯¢
    List<User> findByAge(Integer age);
    
    // å¹´é¾„å¤§äºæŸå€¼
    List<User> findByAgeGreaterThan(Integer age);
    
    // åå­—åŒ…å«æŸå­—ç¬¦ä¸²
    List<User> findByNameContaining(String keyword);
    
    // åå­—å’Œå¹´é¾„ç»„åˆæŸ¥è¯¢
    User findByNameAndAge(String name, Integer age);
    
    // æŒ‰å¹´é¾„æ’åº
    List<User> findByNameOrderByAgeDesc(String name);
}
```

**ğŸ“‹ æ–¹æ³•åå…³é”®è¯å¯¹ç…§è¡¨**

| å…³é”®è¯ | ç¤ºä¾‹ | ç”Ÿæˆçš„SQLæ¡ä»¶ |
|--------|------|--------------|
| `findBy` | `findByName` | `WHERE name = ?` |
| `And` | `findByNameAndAge` | `WHERE name = ? AND age = ?` |
| `Or` | `findByNameOrAge` | `WHERE name = ? OR age = ?` |
| `GreaterThan` | `findByAgeGreaterThan` | `WHERE age > ?` |
| `LessThan` | `findByAgeLessThan` | `WHERE age < ?` |
| `Like` | `findByNameLike` | `WHERE name LIKE ?` |
| `Containing` | `findByNameContaining` | `WHERE name LIKE '%?%'` |
| `OrderBy` | `findByNameOrderByAge` | `ORDER BY age` |

### 4.4 è‡ªå®šä¹‰æŸ¥è¯¢


**ğŸ”¸ å¤æ‚æŸ¥è¯¢ç”¨@Query**

```java
public interface UserRepository extends JpaRepository<User, Long> {
    
    // ç®€å•JPQL
    @Query("FROM User WHERE age > ?1")
    List<User> findAdults(Integer age);
    
    // å‘½åå‚æ•°
    @Query("FROM User WHERE name = :name AND age = :age")
    User findByNameAndAge(@Param("name") String name, 
                          @Param("age") Integer age);
    
    // åŸç”ŸSQLï¼ˆnativeQuery = trueï¼‰
    @Query(value = "SELECT * FROM user WHERE age > ?1", 
           nativeQuery = true)
    List<User> findByAgeSql(Integer age);
}
```

**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨@Query**

- âœ… æ–¹æ³•åå¤ªé•¿å¤ªå¤æ‚
- âœ… éœ€è¦å¤æ‚çš„JOINæŸ¥è¯¢
- âœ… éœ€è¦èšåˆå‡½æ•°ï¼ˆCOUNTã€SUMç­‰ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–éœ€è¦å†™åŸç”ŸSQL

### 4.5 åˆ†é¡µå’Œæ’åº


**ğŸ”¸ åˆ†é¡µæŸ¥è¯¢**

```java
public interface UserRepository extends JpaRepository<User, Long> {
    
    // è‡ªåŠ¨æ”¯æŒåˆ†é¡µ
    Page<User> findByAge(Integer age, Pageable pageable);
}

// ä½¿ç”¨ç¤ºä¾‹
@Service
public class UserService {
    @Autowired
    private UserRepository repo;
    
    public void pageDemo() {
        // æŸ¥ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡
        Pageable pageable = PageRequest.of(0, 10);
        Page<User> page = repo.findByAge(25, pageable);
        
        System.out.println("æ€»è®°å½•æ•°ï¼š" + page.getTotalElements());
        System.out.println("æ€»é¡µæ•°ï¼š" + page.getTotalPages());
        System.out.println("å½“å‰é¡µæ•°æ®ï¼š" + page.getContent());
    }
}
```

**ğŸ”¸ æ’åºæŸ¥è¯¢**

```java
// æ–¹å¼1ï¼šæ–¹æ³•åæ’åº
List<User> findByAgeOrderByNameDesc(Integer age);

// æ–¹å¼2ï¼šSortå‚æ•°
List<User> users = repo.findAll(Sort.by("age").descending());
```

---

## 5. ğŸ”„ Hibernateåˆ°JPAè¿ç§»ç­–ç•¥


### 5.1 ä¸ºä»€ä¹ˆè¦è¿ç§»


**ğŸ¯ è¿ç§»çš„å¥½å¤„**

```
è¿ç§»å‰ï¼ˆçº¯Hibernateï¼‰ï¼š      è¿ç§»åï¼ˆJPAæ ‡å‡†ï¼‰ï¼š
â”œâ”€ ä»£ç ç»‘å®šHibernate         â”œâ”€ éµå¾ªJPAæ ‡å‡†
â”œâ”€ æ¢æ¡†æ¶è¦å¤§æ”¹              â”œâ”€ æ¢å®ç°æ”¹åŠ¨å°‘
â”œâ”€ å­¦ä¹ æˆæœ¬é«˜                â”œâ”€ é€šç”¨çŸ¥è¯†
â””â”€ Springé›†æˆéº»çƒ¦            â””â”€ Springå®Œç¾é›†æˆ
```

**ğŸ“Š è¿ç§»éš¾åº¦è¯„ä¼°**

| é¡¹ç›®è§„æ¨¡ | è¿ç§»éš¾åº¦ | é¢„è®¡å·¥ä½œé‡ |
|----------|----------|------------|
| å°é¡¹ç›®ï¼ˆ<10ä¸ªå®ä½“ï¼‰ | â­ ç®€å• | 1-2å¤© |
| ä¸­é¡¹ç›®ï¼ˆ10-50ä¸ªå®ä½“ï¼‰ | â­â­ ä¸€èˆ¬ | 1-2å‘¨ |
| å¤§é¡¹ç›®ï¼ˆ>50ä¸ªå®ä½“ï¼‰ | â­â­â­ è¾ƒéš¾ | 1-2æœˆ |

### 5.2 è¿ç§»æ­¥éª¤è¯¦è§£


**ğŸ”¸ ç¬¬ä¸€æ­¥ï¼šæ³¨è§£æ›¿æ¢**

```java
// åŸHibernateæ³¨è§£
import org.hibernate.annotations.*;
@Entity
@Table(name = "users")
public class User {
    @GenericGenerator(name = "uuid", strategy = "uuid2")
    @GeneratedValue(generator = "uuid")
    private String id;
}

// æ”¹ä¸ºJPAæ ‡å‡†æ³¨è§£
import javax.persistence.*;
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
}
```

**ğŸ“‹ æ³¨è§£å¯¹ç…§è¡¨**

| Hibernateä¸“æœ‰ | JPAæ ‡å‡† | è¯´æ˜ |
|--------------|---------|------|
| `@GenericGenerator` | `@GeneratedValue` | IDç”Ÿæˆç­–ç•¥ |
| `@Type` | `@Column` | å­—æ®µç±»å‹ |
| `@Formula` | `@Transient + getter` | è®¡ç®—å­—æ®µ |
| `@Cache` | æ— ï¼ˆä½¿ç”¨ç¼“å­˜é…ç½®ï¼‰ | äºŒçº§ç¼“å­˜ |

**ğŸ”¸ ç¬¬äºŒæ­¥ï¼šé…ç½®è¿ç§»**

```xml
<!-- åŸhibernate.cfg.xml -->
<hibernate-configuration>
    <property name="hibernate.dialect">
        org.hibernate.dialect.MySQL5Dialect
    </property>
    <property name="hibernate.show_sql">true</property>
</hibernate-configuration>

<!-- æ”¹ä¸ºpersistence.xml -->
<persistence>
    <persistence-unit name="myApp">
        <properties>
            <property name="javax.persistence.jdbc.driver" 
                      value="com.mysql.jdbc.Driver"/>
            <property name="hibernate.show_sql" value="true"/>
        </properties>
    </persistence-unit>
</persistence>
```

**ğŸ”¸ ç¬¬ä¸‰æ­¥ï¼šä»£ç è¿ç§»**

```java
// åŸHibernateä»£ç 
Session session = sessionFactory.openSession();
Transaction tx = session.beginTransaction();
User user = session.get(User.class, 1L);
session.update(user);
tx.commit();
session.close();

// æ”¹ä¸ºJPAä»£ç 
EntityManager em = emf.createEntityManager();
EntityTransaction tx = em.getTransaction();
tx.begin();
User user = em.find(User.class, 1L);
em.merge(user);
tx.commit();
em.close();
```

### 5.3 æ¸è¿›å¼è¿ç§»æ–¹æ¡ˆ


**ğŸ¯ æ··åˆä½¿ç”¨ç­–ç•¥ï¼ˆæ¨èï¼‰**

```
é˜¶æ®µ1ï¼šæ–°ä»£ç ç”¨JPA
â”œâ”€ æ–°æ¨¡å—ç”¨EntityManager
â”œâ”€ è€æ¨¡å—æš‚æ—¶ä¿ç•™Session
â””â”€ é€æ­¥æ›¿æ¢

é˜¶æ®µ2ï¼šé€æ­¥æ›¿æ¢è€ä»£ç 
â”œâ”€ ä»ç®€å•æ¨¡å—å¼€å§‹
â”œâ”€ ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ¨¡å—æ”¹
â””â”€ å……åˆ†æµ‹è¯•

é˜¶æ®µ3ï¼šå®Œå…¨åˆ‡æ¢
â”œâ”€ æ‰€æœ‰ä»£ç æ”¹ä¸ºJPA
â”œâ”€ ç§»é™¤Hibernateä¸“æœ‰ä¾èµ–
â””â”€ ç»Ÿä¸€ä»£ç é£æ ¼
```

**ğŸ’¡ å®é™…æ“ä½œç¤ºä¾‹**

```java
// è¿‡æ¸¡æœŸçš„Serviceç±»ï¼ˆåŒæ—¶æ”¯æŒä¸¤ç§æ–¹å¼ï¼‰
@Service
public class UserService {
    
    @PersistenceContext
    private EntityManager em;  // JPAæ–¹å¼
    
    @Autowired
    private SessionFactory sf;  // Hibernateæ–¹å¼ï¼ˆé€æ­¥ç§»é™¤ï¼‰
    
    // æ–°æ–¹æ³•ç”¨JPA
    public void createUserJPA(User user) {
        em.persist(user);
    }
    
    // è€æ–¹æ³•æš‚æ—¶ä¿ç•™Hibernate
    @Deprecated
    public void createUserHibernate(User user) {
        Session session = sf.getCurrentSession();
        session.save(user);
    }
}
```

### 5.4 è¿ç§»æ£€æŸ¥æ¸…å•


**âœ… è¿ç§»å‰å‡†å¤‡**

- [ ] å¤‡ä»½ä»£ç å’Œæ•°æ®åº“
- [ ] è¯„ä¼°è¿ç§»èŒƒå›´å’Œå·¥ä½œé‡
- [ ] å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
- [ ] å›¢é˜ŸåŸ¹è®­JPAçŸ¥è¯†

**âœ… è¿ç§»è¿‡ç¨‹æ£€æŸ¥**

- [ ] å®ä½“ç±»æ³¨è§£å·²æ›¿æ¢ä¸ºJPAæ ‡å‡†
- [ ] é…ç½®æ–‡ä»¶å·²ä¿®æ”¹ä¸ºJPAæ ¼å¼
- [ ] Sessionæ”¹ä¸ºEntityManager
- [ ] HQLæ”¹ä¸ºJPQL
- [ ] å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] åŠŸèƒ½å›å½’æµ‹è¯•é€šè¿‡

**âœ… è¿ç§»åéªŒè¯**

- [ ] æ€§èƒ½æµ‹è¯•å¯¹æ¯”
- [ ] æ—¥å¿—æ£€æŸ¥æ— å¼‚å¸¸
- [ ] ç”Ÿäº§ç¯å¢ƒè¯•è¿è¡Œ
- [ ] ç›‘æ§æ•°æ®æ­£å¸¸

---

## 6. ğŸ” å…¼å®¹æ€§è€ƒè™‘ä¸æœ€ä½³å®è·µ


### 6.1 ç‰ˆæœ¬å…¼å®¹æ€§


**ğŸ”¸ Hibernateç‰ˆæœ¬å¯¹åº”å…³ç³»**

| Hibernateç‰ˆæœ¬ | JPAç‰ˆæœ¬ | Spring Bootç‰ˆæœ¬ |
|--------------|---------|-----------------|
| 5.0-5.2 | JPA 2.1 | 2.0.x |
| 5.3-5.4 | JPA 2.2 | 2.1.x - 2.3.x |
| 5.6+ | JPA 2.2 | 2.4.x - 2.7.x |
| 6.0+ | JPA 3.0 | 3.0.x+ |

> âš ï¸ **é‡è¦æç¤º**ï¼šSpring Boot 3.xå¼€å§‹ï¼ŒJPAåŒ…åä»`javax.persistence`æ”¹ä¸º`jakarta.persistence`

**ğŸ”¸ åŒ…åå˜åŒ–**

```java
// Spring Boot 2.xï¼ˆæ—§ç‰ˆï¼‰
import javax.persistence.*;

// Spring Boot 3.xï¼ˆæ–°ç‰ˆï¼‰
import jakarta.persistence.*;
```

### 6.2 å¸¸è§å…¼å®¹æ€§é—®é¢˜


**âŒ é—®é¢˜1ï¼šIDç”Ÿæˆç­–ç•¥ä¸å…¼å®¹**

```java
// Hibernateç‰¹æœ‰çš„UUIDç”Ÿæˆå™¨
@GenericGenerator(name = "uuid", strategy = "uuid2")
@GeneratedValue(generator = "uuid")
private String id;

// æ”¹ä¸ºJPAæ ‡å‡†æ–¹å¼
@Id
@GeneratedValue(strategy = GenerationType.UUID)  // JPA 2.2+
private UUID id;
```

**âŒ é—®é¢˜2ï¼šæ‡’åŠ è½½é—®é¢˜**

```java
// Hibernateå¯ä»¥è¿™æ ·å†™
@OneToMany(fetch = FetchType.LAZY)
private Set<Order> orders;

public void demo() {
    User user = em.find(User.class, 1L);
    // äº‹åŠ¡å¤–è®¿é—®æ‡’åŠ è½½é›†åˆä¼šæŠ¥é”™
    user.getOrders().size();  // LazyInitializationException
}

// JPAæ ‡å‡†è§£å†³æ–¹æ¡ˆ
@OneToMany(fetch = FetchType.LAZY)
@BatchSize(size = 10)  // æ‰¹é‡åŠ è½½ä¼˜åŒ–
private Set<Order> orders;
```

**âŒ é—®é¢˜3ï¼šç¼“å­˜é…ç½®å·®å¼‚**

```java
// HibernateäºŒçº§ç¼“å­˜
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
@Entity
public class User { }

// JPAæ ‡å‡†åšæ³•ï¼ˆé€šè¿‡é…ç½®ï¼‰
// åœ¨persistence.xmlä¸­é…ç½®
<shared-cache-mode>ENABLE_SELECTIVE</shared-cache-mode>
```

### 6.3 æœ€ä½³å®è·µå»ºè®®


**âœ… ä»£ç ç¼–å†™è§„èŒƒ**

```java
// 1. ä¼˜å…ˆä½¿ç”¨JPAæ ‡å‡†æ³¨è§£
import jakarta.persistence.*;  // è€Œéorg.hibernate

// 2. å®ä½“ç±»ä¿æŒç®€å•
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false, length = 50)
    private String name;
    
    // åŸºæœ¬ç±»å‹ç”¨åŒ…è£…ç±»
    private Integer age;  // è€Œéint
}

// 3. Repositoryå±‚ä½¿ç”¨Spring Data JPA
public interface UserRepository extends JpaRepository<User, Long> {
    // æ–¹æ³•åæŸ¥è¯¢
    List<User> findByName(String name);
}

// 4. Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
@Service
@Transactional
public class UserService {
    @Autowired
    private UserRepository userRepo;
    
    public User createUser(String name) {
        User user = new User(name);
        return userRepo.save(user);
    }
}
```

**âœ… æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**

```
ğŸ”¸ æŸ¥è¯¢ä¼˜åŒ–ï¼š
â”œâ”€ é¿å…N+1æŸ¥è¯¢ï¼ˆç”¨JOIN FETCHï¼‰
â”œâ”€ ä½¿ç”¨åˆ†é¡µé¿å…ä¸€æ¬¡æŸ¥å¤ªå¤š
â””â”€ åˆç†ä½¿ç”¨æ‡’åŠ è½½

ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼š
â”œâ”€ ä¸€çº§ç¼“å­˜ï¼šEntityManagerè‡ªå¸¦
â”œâ”€ äºŒçº§ç¼“å­˜ï¼šé…ç½®Ehcacheæˆ–Redis
â””â”€ æŸ¥è¯¢ç¼“å­˜ï¼šé…ç½®æŸ¥è¯¢ç»“æœç¼“å­˜

ğŸ”¸ æ‰¹é‡æ“ä½œï¼š
â”œâ”€ æ‰¹é‡æ’å…¥ç”¨batch insert
â”œâ”€ æ‰¹é‡æ›´æ–°ç”¨JPQL UPDATE
â””â”€ æ‰¹é‡åˆ é™¤ç”¨JPQL DELETE
```

**âœ… é”™è¯¯å¤„ç†è§„èŒƒ**

```java
@Service
public class UserService {
    
    @PersistenceContext
    private EntityManager em;
    
    @Transactional
    public User updateUser(Long id, String newName) {
        User user = em.find(User.class, id);
        
        // æ£€æŸ¥å®ä½“æ˜¯å¦å­˜åœ¨
        if (user == null) {
            throw new EntityNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨");
        }
        
        // æ›´æ–°æ•°æ®
        user.setName(newName);
        return em.merge(user);
    }
}
```

### 6.4 Spring Booté…ç½®å»ºè®®


**ğŸ”¸ application.ymlæ ‡å‡†é…ç½®**

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: 123456
    
  jpa:
    # æ˜¾ç¤ºSQL
    show-sql: true
    # æ ¼å¼åŒ–SQL
    properties:
      hibernate:
        format_sql: true
    # DDLç­–ç•¥ï¼ˆå¼€å‘ç¯å¢ƒç”¨updateï¼Œç”Ÿäº§ç”¨noneï¼‰
    hibernate:
      ddl-auto: update
    # æ•°æ®åº“æ–¹è¨€
    database-platform: org.hibernate.dialect.MySQL8Dialect
    # å¼€å¯æ‡’åŠ è½½
    open-in-view: false
```

**ğŸ¯ ç¯å¢ƒåŒºåˆ†é…ç½®**

```yaml
# application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
spring:
  jpa:
    show-sql: true
    hibernate:
      ddl-auto: update

# application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
spring:
  jpa:
    show-sql: false
    hibernate:
      ddl-auto: none  # ç”Ÿäº§ç¯å¢ƒç¦æ­¢è‡ªåŠ¨å»ºè¡¨
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ JPAè§„èŒƒï¼šJavaæŒä¹…åŒ–çš„ç»Ÿä¸€æ ‡å‡†ï¼Œå®šä¹‰æ¥å£ä¸ç®¡å®ç°
ğŸ”¸ EntityManagerï¼šJPAçš„æ ¸å¿ƒAPIï¼Œç­‰åŒäºHibernateçš„Session
ğŸ”¸ @PersistenceContextï¼šæ³¨å…¥EntityManagerçš„æ ‡å‡†æ–¹å¼
ğŸ”¸ Spring Data JPAï¼šç®€åŒ–å¼€å‘çš„æ‡’äººç¥å™¨ï¼Œæ–¹æ³•åè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢
ğŸ”¸ è¿ç§»ç­–ç•¥ï¼šä»Hibernateåˆ°JPAå¯ä»¥æ¸è¿›å¼è¿ç§»ï¼Œä¸å¿…ä¸€æ­¥åˆ°ä½
ğŸ”¸ å…¼å®¹æ€§ï¼šæ³¨æ„ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼ŒSpring Boot 3.xæ”¹ç”¨jakartaåŒ…å
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ JPAä¸Hibernateçš„å…³ç³»**
```
è®°å¿†å…¬å¼ï¼š
JPA = æ¥å£è§„èŒƒï¼ˆåˆ¶å®šæ ‡å‡†ï¼‰
Hibernate = å®ç°ï¼ˆå¹²æ´»ï¼‰

ç±»æ¯”ï¼š
JPAåƒUSBæ ‡å‡†ï¼ŒHibernateæ˜¯é‡‘å£«é¡¿Uç›˜
æ¢ä¸ªå“ç‰Œçš„Uç›˜ï¼ˆEclipseLinkï¼‰ï¼Œæ¥å£è¿˜æ˜¯ä¸€æ ·ç”¨
```

**ğŸ”¹ EntityManager vs Session**
```
æ ¸å¿ƒåŒºåˆ«ï¼š
â”œâ”€ EntityManagerï¼šJPAæ ‡å‡†ï¼Œé€šç”¨
â”œâ”€ Sessionï¼šHibernateä¸“æœ‰ï¼ŒåŠŸèƒ½æ›´å¤š
â””â”€ å»ºè®®ï¼šæ–°é¡¹ç›®ç”¨EntityManagerï¼Œè€é¡¹ç›®å¯ä»¥æ··ç”¨

APIå¯¹åº”ï¼š
save()    â†’ persist()
get()     â†’ find()
update()  â†’ merge()
delete()  â†’ remove()
```

**ğŸ”¹ Spring Data JPAçš„é­”æ³•**
```
ä¸‰å±‚é­”æ³•ï¼š
1. ç»§æ‰¿JpaRepository = è·å¾—åŸºæœ¬CRUD
2. æ–¹æ³•åæŸ¥è¯¢ = è‡ªåŠ¨ç”ŸæˆSQL
3. @Queryæ³¨è§£ = è‡ªå®šä¹‰å¤æ‚æŸ¥è¯¢

è®°å¿†æŠ€å·§ï¼š
findByXxx â†’ WHERE xxx = ?
findByXxxAndYyy â†’ WHERE xxx = ? AND yyy = ?
```

### 7.3 å®é™…åº”ç”¨æŒ‡å—


**ğŸ¯ æŠ€æœ¯é€‰å‹å»ºè®®**

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **æ–°é¡¹ç›®** | Spring Data JPA | å¼€å‘æ•ˆç‡é«˜ï¼Œä»£ç ç®€æ´ |
| **è€é¡¹ç›®æ”¹é€ ** | æ¸è¿›å¼è¿ç§» | é£é™©å¯æ§ï¼Œé€æ­¥æ›¿æ¢ |
| **æ€§èƒ½è¦æ±‚é«˜** | JPA + åŸç”ŸSQL | çµæ´»æ€§å’Œæ€§èƒ½å…¼é¡¾ |
| **å›¢é˜Ÿç»éªŒå°‘** | Spring Data JPA | å­¦ä¹ æ›²çº¿å¹³ç¼“ |

**ğŸ”¹ å¼€å‘æµç¨‹å»ºè®®**

```
æ¨èæµç¨‹ï¼š
1. è®¾è®¡å®ä½“ç±»ï¼ˆ@Entityæ³¨è§£ï¼‰
2. å®šä¹‰Repositoryæ¥å£ï¼ˆç»§æ‰¿JpaRepositoryï¼‰
3. ç¼–å†™Serviceä¸šåŠ¡é€»è¾‘ï¼ˆ@Transactionalï¼‰
4. Controllerè°ƒç”¨Service
5. æµ‹è¯•éªŒè¯åŠŸèƒ½

é¿å…é™·é˜±ï¼š
âŒ ä¸è¦åœ¨Controllerç›´æ¥ç”¨Repository
âŒ ä¸è¦å¿˜è®°åŠ @Transactional
âŒ ä¸è¦è¿‡åº¦ä¾èµ–æ‡’åŠ è½½
âŒ ä¸è¦åœ¨å¾ªç¯é‡ŒæŸ¥æ•°æ®åº“ï¼ˆN+1é—®é¢˜ï¼‰
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–æ¸…å•**

```
âœ… æŸ¥è¯¢ä¼˜åŒ–ï¼š
- ä½¿ç”¨åˆ†é¡µï¼ˆPageableï¼‰
- JOIN FETCHé¿å…N+1
- æŠ•å½±æŸ¥è¯¢åªå–éœ€è¦çš„å­—æ®µ

âœ… ç¼“å­˜ä¼˜åŒ–ï¼š
- å¼€å¯äºŒçº§ç¼“å­˜
- æŸ¥è¯¢ç¼“å­˜
- Redisç¼“å­˜çƒ­ç‚¹æ•°æ®

âœ… å†™å…¥ä¼˜åŒ–ï¼š
- æ‰¹é‡æ“ä½œç”¨batch
- å¼‚æ­¥å¤„ç†éå…³é”®æ•°æ®
- åˆç†è®¾ç½®flushæ¨¡å¼
```

### 7.4 å­¦ä¹ è·¯çº¿å›¾


```
å…¥é—¨é˜¶æ®µï¼š
â”œâ”€ ç†è§£ORMæ¦‚å¿µ
â”œâ”€ æŒæ¡JPAåŸºç¡€æ³¨è§£
â”œâ”€ å­¦ä¼šEntityManageråŸºæœ¬æ“ä½œ
â””â”€ äº†è§£JPQLåŸºç¡€è¯­æ³•

è¿›é˜¶é˜¶æ®µï¼š
â”œâ”€ ç†Ÿç»ƒä½¿ç”¨Spring Data JPA
â”œâ”€ æŒæ¡æ–¹æ³•åæŸ¥è¯¢è§„åˆ™
â”œâ”€ ç†è§£äº‹åŠ¡å’Œæ‡’åŠ è½½
â””â”€ å­¦ä¼šæ€§èƒ½ä¼˜åŒ–æŠ€å·§

é«˜çº§é˜¶æ®µï¼š
â”œâ”€ æ·±å…¥ç†è§£JPAç”Ÿå‘½å‘¨æœŸ
â”œâ”€ æŒæ¡é«˜çº§æ˜ å°„å…³ç³»
â”œâ”€ è‡ªå®šä¹‰Repositoryå®ç°
â””â”€ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
JPAæ ‡å‡†æ¥å£å®šè§„èŒƒï¼Œ
Hibernateå®ç°æ¥å¹²æ´»ã€‚
EntityManageræ“ä½œåº“ï¼Œ
Spring Dataå¼€å‘å¿«ã€‚
æ³¨è§£é…ç½®è¦è§„èŒƒï¼Œ
äº‹åŠ¡ç®¡ç†ä¸èƒ½å¿˜ã€‚
æ€§èƒ½ä¼˜åŒ–è¦é‡è§†ï¼Œ
ç¼“å­˜åˆ†é¡µä¸å¯å°‘ã€‚
```

---

> ğŸ’¡ **æ–°æ‰‹å‹æƒ…æç¤º**ï¼š
> - JPAä¸éš¾ï¼Œå…³é”®æ˜¯ç†è§£"è§„èŒƒä¸å®ç°"çš„å…³ç³»
> - Spring Data JPAèƒ½è®©ä½ å°‘å†™80%çš„ä»£ç 
> - é‡åˆ°é—®é¢˜å…ˆçœ‹æ§åˆ¶å°çš„SQLæ—¥å¿—ï¼Œ90%çš„é—®é¢˜éƒ½èƒ½æ‰¾åˆ°åŸå› 
> - ä»å°é¡¹ç›®å¼€å§‹å®è·µï¼Œç†Ÿèƒ½ç”Ÿå·§ï¼