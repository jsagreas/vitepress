---
title: 69ã€å…¨æ–‡æœç´¢å®ç°
---
## ğŸ“š ç›®å½•

1. [å…¨æ–‡æœç´¢æ¦‚è¿°](#1-å…¨æ–‡æœç´¢æ¦‚è¿°)
2. [FullTextSessionæ ¸å¿ƒæ¥å£](#2-FullTextSessionæ ¸å¿ƒæ¥å£)
3. [QueryBuilderæŸ¥è¯¢æ„å»ºå™¨](#3-QueryBuilderæŸ¥è¯¢æ„å»ºå™¨)
4. [å…³é”®è¯æŸ¥è¯¢å®ç°](#4-å…³é”®è¯æŸ¥è¯¢å®ç°)
5. [èŒƒå›´æŸ¥è¯¢ä½¿ç”¨](#5-èŒƒå›´æŸ¥è¯¢ä½¿ç”¨)
6. [ç»„åˆæŸ¥è¯¢æŠ€å·§](#6-ç»„åˆæŸ¥è¯¢æŠ€å·§)
7. [æ’åºä¸åˆ†é¡µå¤„ç†](#7-æ’åºä¸åˆ†é¡µå¤„ç†)
8. [æœç´¢ç»“æœé«˜äº®æ˜¾ç¤º](#8-æœç´¢ç»“æœé«˜äº®æ˜¾ç¤º)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å…¨æ–‡æœç´¢æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å…¨æ–‡æœç´¢


**é€šä¿—ç†è§£**ï¼šå…¨æ–‡æœç´¢å°±åƒä½¿ç”¨ç™¾åº¦ã€Googleæœç´¢ä¸€æ ·ï¼Œåœ¨å¤§é‡æ–‡æœ¬æ•°æ®ä¸­å¿«é€Ÿæ‰¾åˆ°åŒ…å«å…³é”®è¯çš„å†…å®¹ã€‚

```
ä¼ ç»Ÿæ•°æ®åº“æŸ¥è¯¢ï¼š            å…¨æ–‡æœç´¢ï¼š
SELECT * FROM products      æœç´¢"è‹¹æœæ‰‹æœº"
WHERE name LIKE '%æ‰‹æœº%'     â†’ æ™ºèƒ½åŒ¹é…ï¼š
                              - Apple iPhone 13
æ€§èƒ½é—®é¢˜ï¼š                    - è‹¹æœ iPhone 12 Pro
- æ‰«ææ•´å¼ è¡¨                  - çº¢è‰²è‹¹æœæ‰‹æœºå£³
- æ— æ³•ä½¿ç”¨ç´¢å¼•                
- é€Ÿåº¦ææ…¢                   ä¼˜åŠ¿ï¼š
                            âœ… ä½¿ç”¨å€’æ’ç´¢å¼•ï¼Œé€Ÿåº¦å¿«
                            âœ… æ”¯æŒåˆ†è¯ã€åŒä¹‰è¯
                            âœ… ç»“æœç›¸å…³æ€§æ’åº
```

### 1.2 Hibernate Searchçš„ä½œç”¨


**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ğŸ”¸ **è‡ªåŠ¨ç´¢å¼•**ï¼šå®ä½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°æœç´¢ç´¢å¼•
- ğŸ”¸ **å¼ºå¤§æŸ¥è¯¢**ï¼šæ”¯æŒå¤šç§æŸ¥è¯¢æ–¹å¼å’Œæ¡ä»¶ç»„åˆ
- ğŸ”¸ **ä¸­æ–‡åˆ†è¯**ï¼šæ™ºèƒ½å¤„ç†ä¸­æ–‡æœç´¢
- ğŸ”¸ **é«˜äº®æ˜¾ç¤º**ï¼šæœç´¢ç»“æœä¸­å…³é”®è¯é«˜äº®

**ä¸æ•°æ®åº“æŸ¥è¯¢çš„å¯¹æ¯”**ï¼š

| å¯¹æ¯”é¡¹ | **ä¼ ç»Ÿ SQL LIKE** | **Hibernate Search** |
|--------|------------------|----------------------|
| æŸ¥è¯¢é€Ÿåº¦ | `æ…¢ï¼Œå…¨è¡¨æ‰«æ` | `å¿«ï¼Œä½¿ç”¨å€’æ’ç´¢å¼•` |
| ä¸­æ–‡æ”¯æŒ | `ä¸æ”¯æŒåˆ†è¯` | `æ™ºèƒ½ä¸­æ–‡åˆ†è¯` |
| ç›¸å…³æ€§ | `æ— ç›¸å…³æ€§æ’åº` | `æ™ºèƒ½ç›¸å…³æ€§è¯„åˆ†` |
| æ¨¡ç³ŠåŒ¹é… | `åªæ”¯æŒé€šé…ç¬¦` | `æ”¯æŒæ‹¼éŸ³ã€åŒä¹‰è¯` |
| é€‚ç”¨åœºæ™¯ | `ç®€å•ç²¾ç¡®æŸ¥è¯¢` | `å¤æ‚æ–‡æœ¬æœç´¢` |

---

## 2. ğŸ¯ FullTextSessionæ ¸å¿ƒæ¥å£


### 2.1 ä»€ä¹ˆæ˜¯FullTextSession


**ç®€å•ç†è§£**ï¼šFullTextSession æ˜¯ Hibernate Session çš„å¢å¼ºç‰ˆï¼Œä¸“é—¨ç”¨æ¥æ‰§è¡Œå…¨æ–‡æœç´¢æ“ä½œã€‚

```
æ™®é€šSessionï¼š                    FullTextSessionï¼š
session.createQuery()            fullTextSession.search()
  â†“                                â†“
æ‰§è¡Œæ•°æ®åº“SQLæŸ¥è¯¢                 æ‰§è¡Œå…¨æ–‡ç´¢å¼•æœç´¢
```

### 2.2 è·å–FullTextSession


```java
// ä»æ™®é€šSessionè½¬æ¢ä¸ºFullTextSession
Session session = sessionFactory.openSession();
FullTextSession fullTextSession = Search.getFullTextSession(session);

// å°±åƒç»™æ™®é€šSessionè£…ä¸Šäº†"æœç´¢å¼•æ“"åŠŸèƒ½
```

**ç±»æ¯”ç†è§£**ï¼š
- `Session` = æ™®é€šæ±½è½¦ï¼Œåªèƒ½åœ¨è·¯ä¸Šè·‘
- `FullTextSession` = ä¸¤æ –æ±½è½¦ï¼Œæ—¢èƒ½åœ¨è·¯ä¸Šè·‘ï¼Œåˆèƒ½åœ¨æ°´é‡Œæ¸¸ï¼ˆæœç´¢ï¼‰

### 2.3 åŸºæœ¬ä½¿ç”¨æµç¨‹


```
æ­¥éª¤1ï¼šè·å–FullTextSession
   â†“
æ­¥éª¤2ï¼šä½¿ç”¨QueryBuilderæ„å»ºæŸ¥è¯¢æ¡ä»¶
   â†“
æ­¥éª¤3ï¼šåˆ›å»ºLuceneæŸ¥è¯¢å¯¹è±¡
   â†“
æ­¥éª¤4ï¼šå°†LuceneæŸ¥è¯¢åŒ…è£…ä¸ºHibernateæŸ¥è¯¢
   â†“
æ­¥éª¤5ï¼šæ‰§è¡ŒæŸ¥è¯¢è·å–ç»“æœ
```

**å®Œæ•´ç¤ºä¾‹**ï¼š

```java
// 1. è·å–FullTextSession
FullTextSession fullTextSession = Search.getFullTextSession(session);

// 2. è·å–QueryBuilderï¼ˆæŸ¥è¯¢æ„å»ºå™¨ï¼‰
QueryBuilder qb = fullTextSession.getSearchFactory()
    .buildQueryBuilder()
    .forEntity(Product.class)  // æŒ‡å®šè¦æœç´¢çš„å®ä½“ç±»
    .get();

// 3. æ„å»ºæŸ¥è¯¢æ¡ä»¶
org.apache.lucene.search.Query luceneQuery = qb
    .keyword()
    .onField("name")           // åœ¨nameå­—æ®µæœç´¢
    .matching("æ‰‹æœº")          // æœç´¢å…³é”®è¯
    .createQuery();

// 4. åˆ›å»ºHibernateå…¨æ–‡æŸ¥è¯¢
FullTextQuery query = fullTextSession.createFullTextQuery(luceneQuery, Product.class);

// 5. è·å–ç»“æœ
List<Product> results = query.list();
```

---

## 3. ğŸ”§ QueryBuilderæŸ¥è¯¢æ„å»ºå™¨


### 3.1 QueryBuilderæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šQueryBuilder å°±åƒä¸€ä¸ª"æŸ¥è¯¢æ¡ä»¶åˆ¶é€ å™¨"ï¼Œå¸®ä½ æŠŠæœç´¢éœ€æ±‚ç¿»è¯‘æˆæœç´¢å¼•æ“èƒ½ç†è§£çš„è¯­è¨€ã€‚

```
ä½ çš„éœ€æ±‚ï¼š               QueryBuilderå¸®ä½ ç¿»è¯‘ï¼š
"æœç´¢åå­—é‡Œæœ‰æ‰‹æœºçš„"  â†’   keyword().onField("name").matching("æ‰‹æœº")
"ä»·æ ¼åœ¨1000-5000"    â†’   range().onField("price").from(1000).to(5000)
```

### 3.2 è·å–QueryBuilder


```java
// ä¸ºç‰¹å®šå®ä½“ç±»åˆ›å»ºQueryBuilder
QueryBuilder qb = fullTextSession.getSearchFactory()
    .buildQueryBuilder()
    .forEntity(Product.class)  // æŒ‡å®šæœç´¢å“ªä¸ªå®ä½“
    .get();

// è¿™ä¸ªqbå°±ä¸“é—¨ç”¨æ¥æœç´¢Productå®ä½“
```

### 3.3 å¸¸ç”¨æŸ¥è¯¢ç±»å‹


**æŸ¥è¯¢ç±»å‹æ€»è§ˆ**ï¼š

```
keyword()    - å…³é”®è¯æŸ¥è¯¢ï¼ˆæœ€å¸¸ç”¨ï¼‰
  â†“
range()      - èŒƒå›´æŸ¥è¯¢ï¼ˆä»·æ ¼åŒºé—´ã€æ—¥æœŸèŒƒå›´ï¼‰
  â†“
phrase()     - çŸ­è¯­æŸ¥è¯¢ï¼ˆå®Œæ•´åŒ¹é…ï¼‰
  â†“
wildcard()   - é€šé…ç¬¦æŸ¥è¯¢ï¼ˆ*ã€?ï¼‰
  â†“
fuzzy()      - æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå…è®¸æ‹¼å†™é”™è¯¯ï¼‰
```

---

## 4. ğŸ”‘ å…³é”®è¯æŸ¥è¯¢å®ç°


### 4.1 å•å­—æ®µå…³é”®è¯æŸ¥è¯¢


**æœ€åŸºç¡€çš„æœç´¢**ï¼šåœ¨æŸä¸ªå­—æ®µä¸­æœç´¢å…³é”®è¯

```java
// åœ¨å•†å“åç§°ä¸­æœç´¢"æ‰‹æœº"
Query query = qb
    .keyword()                    // ä½¿ç”¨å…³é”®è¯æŸ¥è¯¢
    .onField("name")              // åœ¨nameå­—æ®µæœç´¢
    .matching("æ‰‹æœº")             // æœç´¢å…³é”®è¯
    .createQuery();

// æ‰§è¡ŒæŸ¥è¯¢
FullTextQuery fullTextQuery = fullTextSession
    .createFullTextQuery(query, Product.class);
List<Product> products = fullTextQuery.list();
```

**æŸ¥è¯¢æ•ˆæœ**ï¼š
- âœ… ä¼šæ‰¾åˆ°ï¼š`"è‹¹æœæ‰‹æœº"`ã€`"åä¸ºæ‰‹æœº"`ã€`"å°ç±³æ‰‹æœºå£³"`
- âœ… æ™ºèƒ½åˆ†è¯ï¼š`"æ‰‹æœº"` ä¼šåŒ¹é…åŒ…å«è¿™ä¸ªè¯çš„æ‰€æœ‰è®°å½•

### 4.2 å¤šå­—æ®µå…³é”®è¯æŸ¥è¯¢


**åŒæ—¶åœ¨å¤šä¸ªå­—æ®µæœç´¢**ï¼š

```java
// åœ¨nameå’Œdescriptionå­—æ®µä¸­æœç´¢"æ‰‹æœº"
Query query = qb
    .keyword()
    .onFields("name", "description")  // å¤šä¸ªå­—æ®µ
    .matching("æ‰‹æœº")
    .createQuery();
```

**åº”ç”¨åœºæ™¯**ï¼š
```
ç”¨æˆ·æœç´¢"è‹¹æœ"ï¼š
- å•†å“åï¼šApple iPhone 13        âœ… åŒ¹é…
- æè¿°ï¼šæ–°é²œçš„çº¢è‹¹æœï¼Œäº§åœ°çƒŸå°    âœ… åŒ¹é…
- å“ç‰Œï¼šApple                    âœ… åŒ¹é…
```

### 4.3 å­—æ®µæƒé‡è®¾ç½®


**è®©æŸä¸ªå­—æ®µæ›´é‡è¦**ï¼š

```java
Query query = qb
    .keyword()
    .onFields("name", "description")
    .boostedTo(3.0f)              // nameå­—æ®µæƒé‡Ã—3
    .andField("brand")
    .boostedTo(2.0f)              // brandå­—æ®µæƒé‡Ã—2
    .matching("è‹¹æœ")
    .createQuery();
```

**æƒé‡æ•ˆæœ**ï¼š
```
æœç´¢ç»“æœæ’åºï¼š
1. nameåŒ…å«"è‹¹æœ"çš„å•†å“      â†’ æƒé‡æœ€é«˜ï¼Œæ’æœ€å‰
2. brandæ˜¯"è‹¹æœ"çš„å•†å“       â†’ æƒé‡å…¶æ¬¡
3. descriptionåŒ…å«"è‹¹æœ"çš„   â†’ æƒé‡æœ€ä½
```

### 4.4 å¿½ç•¥åˆ†æå™¨æŸ¥è¯¢


**ç²¾ç¡®åŒ¹é…ï¼Œä¸åˆ†è¯**ï¼š

```java
Query query = qb
    .keyword()
    .onField("code")              // å•†å“ç¼–ç å­—æ®µ
    .ignoreAnalyzer()             // ä¸åˆ†è¯ï¼Œç²¾ç¡®åŒ¹é…
    .matching("PROD-12345")
    .createQuery();
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- å•†å“ç¼–ç ï¼š`PROD-12345`
- è®¢å•å·ï¼š`ORD-2024-001`
- IDç±»å­—æ®µï¼šä¸éœ€è¦åˆ†è¯ï¼Œå®Œå…¨åŒ¹é…

---

## 5. ğŸ“Š èŒƒå›´æŸ¥è¯¢ä½¿ç”¨


### 5.1 æ•°å€¼èŒƒå›´æŸ¥è¯¢


**ä»·æ ¼åŒºé—´æœç´¢ç¤ºä¾‹**ï¼š

```java
// æŸ¥è¯¢ä»·æ ¼åœ¨1000åˆ°5000ä¹‹é—´çš„å•†å“
Query query = qb
    .range()                       // èŒƒå›´æŸ¥è¯¢
    .onField("price")              // ä»·æ ¼å­—æ®µ
    .from(1000.0)                  // æœ€ä½ä»·
    .to(5000.0)                    // æœ€é«˜ä»·
    .createQuery();
```

**æŸ¥è¯¢é€»è¾‘**ï¼š
```
price >= 1000 AND price <= 5000

ç¬¦åˆæ¡ä»¶çš„å•†å“ï¼š
- iPhone 13: Â¥4999    âœ…
- å°ç±³11: Â¥2999      âœ…  
- åä¸ºP50: Â¥5999     âŒ è¶…å‡ºèŒƒå›´
- çº¢ç±³Note: Â¥899     âŒ ä½äºèŒƒå›´
```

### 5.2 è¾¹ç•Œæ§åˆ¶


```java
// ä¸åŒ…å«è¾¹ç•Œå€¼ï¼ˆå¼€åŒºé—´ï¼‰
Query query = qb
    .range()
    .onField("price")
    .from(1000.0).excludeLimit()   // ä¸åŒ…å«1000
    .to(5000.0).excludeLimit()     // ä¸åŒ…å«5000
    .createQuery();
// ç›¸å½“äºï¼š1000 < price < 5000

// å•è¾¹èŒƒå›´
Query query1 = qb.range()
    .onField("price")
    .above(1000.0)                 // å¤§äº1000
    .createQuery();

Query query2 = qb.range()
    .onField("price")  
    .below(5000.0)                 // å°äº5000
    .createQuery();
```

### 5.3 æ—¥æœŸèŒƒå›´æŸ¥è¯¢


```java
// æŸ¥è¯¢2024å¹´1æœˆä»½çš„è®¢å•
Date startDate = new SimpleDateFormat("yyyy-MM-dd")
    .parse("2024-01-01");
Date endDate = new SimpleDateFormat("yyyy-MM-dd")
    .parse("2024-01-31");

Query query = qb
    .range()
    .onField("createTime")
    .from(startDate)
    .to(endDate)
    .createQuery();
```

**åº”ç”¨åœºæ™¯**ï¼š
- è®¢å•æ—¶é—´ç­›é€‰
- ä¼šå‘˜æ³¨å†Œæ—¶é—´æŸ¥è¯¢
- å•†å“ä¸Šæ¶æ—¶é—´è¿‡æ»¤

---

## 6. ğŸ”— ç»„åˆæŸ¥è¯¢æŠ€å·§


### 6.1 å¸ƒå°”ç»„åˆæŸ¥è¯¢


**ANDï¼ˆå¿…é¡»åŒæ—¶æ»¡è¶³ï¼‰**ï¼š

```java
// æŸ¥è¯¢ï¼šä»·æ ¼1000-5000 ä¸” å“ç‰Œæ˜¯"è‹¹æœ"
Query priceQuery = qb.range()
    .onField("price")
    .from(1000.0).to(5000.0)
    .createQuery();

Query brandQuery = qb.keyword()
    .onField("brand")
    .matching("è‹¹æœ")
    .createQuery();

Query combinedQuery = qb.bool()
    .must(priceQuery)              // å¿…é¡»æ»¡è¶³
    .must(brandQuery)              // å¿…é¡»æ»¡è¶³
    .createQuery();
```

**æŸ¥è¯¢é€»è¾‘**ï¼š
```
ç¬¦åˆæ¡ä»¶ï¼špriceåœ¨1000-5000 AND brand="è‹¹æœ"
- iPhone 13: Â¥4999, è‹¹æœ     âœ…
- è‹¹æœå……ç”µå™¨: Â¥199, è‹¹æœ      âŒ ä»·æ ¼ä¸ç¬¦
- å°ç±³11: Â¥2999, å°ç±³        âŒ å“ç‰Œä¸ç¬¦
```

**ORï¼ˆæ»¡è¶³ä»»ä¸€å³å¯ï¼‰**ï¼š

```java
// æŸ¥è¯¢ï¼šå“ç‰Œæ˜¯"è‹¹æœ" æˆ– "åä¸º"
Query appleQuery = qb.keyword()
    .onField("brand")
    .matching("è‹¹æœ")
    .createQuery();

Query huaweiQuery = qb.keyword()
    .onField("brand")
    .matching("åä¸º")
    .createQuery();

Query combinedQuery = qb.bool()
    .should(appleQuery)            // æˆ–
    .should(huaweiQuery)           // æˆ–
    .createQuery();
```

**NOTï¼ˆæ’é™¤æ¡ä»¶ï¼‰**ï¼š

```java
// æŸ¥è¯¢ï¼šæœ‰"æ‰‹æœº"ä½†æ’é™¤"è‹¹æœ"å“ç‰Œ
Query phoneQuery = qb.keyword()
    .onField("name")
    .matching("æ‰‹æœº")
    .createQuery();

Query appleQuery = qb.keyword()
    .onField("brand")
    .matching("è‹¹æœ")
    .createQuery();

Query combinedQuery = qb.bool()
    .must(phoneQuery)              // å¿…é¡»æœ‰æ‰‹æœº
    .must(appleQuery).not()        // æ’é™¤è‹¹æœ
    .createQuery();
```

### 6.2 å¤æ‚ç»„åˆç¤ºä¾‹


```java
// ç»¼åˆæŸ¥è¯¢ï¼š
// (å“ç‰Œæ˜¯"è‹¹æœ" OR "åä¸º") AND ä»·æ ¼2000-8000 AND éäºŒæ‰‹
Query brandQuery = qb.bool()
    .should(qb.keyword().onField("brand").matching("è‹¹æœ").createQuery())
    .should(qb.keyword().onField("brand").matching("åä¸º").createQuery())
    .createQuery();

Query priceQuery = qb.range()
    .onField("price")
    .from(2000.0).to(8000.0)
    .createQuery();

Query usedQuery = qb.keyword()
    .onField("condition")
    .matching("äºŒæ‰‹")
    .createQuery();

Query finalQuery = qb.bool()
    .must(brandQuery)
    .must(priceQuery)
    .must(usedQuery).not()
    .createQuery();
```

---

## 7. ğŸ“„ æ’åºä¸åˆ†é¡µå¤„ç†


### 7.1 ç»“æœæ’åº


**æŒ‰å­—æ®µæ’åº**ï¼š

```java
FullTextQuery query = fullTextSession
    .createFullTextQuery(luceneQuery, Product.class);

// æŒ‰ä»·æ ¼å‡åº
query.setSort(new Sort(
    new SortField("price", SortField.Type.DOUBLE)
));

// æŒ‰ä»·æ ¼é™åº
query.setSort(new Sort(
    new SortField("price", SortField.Type.DOUBLE, true)
));

List<Product> results = query.list();
```

**å¤šå­—æ®µæ’åº**ï¼š

```java
// å…ˆæŒ‰é”€é‡é™åºï¼Œé”€é‡ç›¸åŒå†æŒ‰ä»·æ ¼å‡åº
query.setSort(new Sort(
    new SortField("sales", SortField.Type.INT, true),    // é”€é‡é™åº
    new SortField("price", SortField.Type.DOUBLE, false) // ä»·æ ¼å‡åº
));
```

**æŒ‰ç›¸å…³æ€§è¯„åˆ†æ’åº**ï¼š

```java
// é»˜è®¤æŒ‰ç›¸å…³æ€§è¯„åˆ†é™åºï¼ˆæœ€ç›¸å…³çš„æ’å‰é¢ï¼‰
query.setSort(Sort.RELEVANCE);

// åŒæ—¶è·å–è¯„åˆ†
query.setProjection(FullTextQuery.SCORE, FullTextQuery.THIS);
List<Object[]> results = query.list();

for (Object[] result : results) {
    Float score = (Float) result[0];      // è¯„åˆ†
    Product product = (Product) result[1]; // å®ä½“
    System.out.println("ç›¸å…³æ€§: " + score + ", å•†å“: " + product.getName());
}
```

### 7.2 åˆ†é¡µæŸ¥è¯¢


```java
// ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡
int pageNum = 1;
int pageSize = 10;

FullTextQuery query = fullTextSession
    .createFullTextQuery(luceneQuery, Product.class);

// è®¾ç½®åˆ†é¡µå‚æ•°
query.setFirstResult((pageNum - 1) * pageSize);  // èµ·å§‹ä½ç½®
query.setMaxResults(pageSize);                   // æ¯é¡µæ•°é‡

// è·å–æ€»è®°å½•æ•°
int total = query.getResultSize();

// è·å–å½“å‰é¡µæ•°æ®
List<Product> pageData = query.list();

System.out.println("æ€»è®°å½•æ•°: " + total);
System.out.println("æ€»é¡µæ•°: " + (total + pageSize - 1) / pageSize);
System.out.println("å½“å‰é¡µæ•°æ®: " + pageData.size());
```

**åˆ†é¡µæ•ˆæœç¤ºæ„**ï¼š
```
æ€»å…±100æ¡è®°å½•ï¼Œæ¯é¡µ10æ¡ï¼š

ç¬¬1é¡µï¼šè®°å½• 1-10    â†’ setFirstResult(0),  setMaxResults(10)
ç¬¬2é¡µï¼šè®°å½• 11-20   â†’ setFirstResult(10), setMaxResults(10)
ç¬¬3é¡µï¼šè®°å½• 21-30   â†’ setFirstResult(20), setMaxResults(10)
...
ç¬¬10é¡µï¼šè®°å½• 91-100 â†’ setFirstResult(90), setMaxResults(10)
```

---

## 8. ğŸ¨ æœç´¢ç»“æœé«˜äº®æ˜¾ç¤º


### 8.1 ä»€ä¹ˆæ˜¯é«˜äº®æ˜¾ç¤º


**æ•ˆæœå±•ç¤º**ï¼š
```
æœç´¢å…³é”®è¯ï¼šæ‰‹æœº

æ™®é€šç»“æœï¼š
Apple iPhone 13 æ™ºèƒ½æ‰‹æœº

é«˜äº®ç»“æœï¼š
Apple iPhone 13 æ™ºèƒ½<em>æ‰‹æœº</em>
                    â†‘ å…³é”®è¯è¢«æ ‡ç­¾åŒ…è£¹
```

### 8.2 é…ç½®é«˜äº®å™¨


```java
import org.hibernate.search.query.dsl.QueryBuilder;
import org.apache.lucene.search.Query;
import org.apache.lucene.search.highlight.*;

// 1. åˆ›å»ºæŸ¥è¯¢
QueryBuilder qb = fullTextSession.getSearchFactory()
    .buildQueryBuilder()
    .forEntity(Product.class)
    .get();

Query luceneQuery = qb.keyword()
    .onField("name")
    .matching("æ‰‹æœº")
    .createQuery();

// 2. åˆ›å»ºé«˜äº®å™¨
SimpleHTMLFormatter formatter = new SimpleHTMLFormatter(
    "<span class='highlight'>",  // å‰ç¼€æ ‡ç­¾
    "</span>"                     // åç¼€æ ‡ç­¾
);

Highlighter highlighter = new Highlighter(
    formatter, 
    new QueryScorer(luceneQuery)
);

// 3. è®¾ç½®ç‰‡æ®µå¤§å°
highlighter.setTextFragmenter(
    new SimpleFragmenter(100)     // é«˜äº®ç‰‡æ®µé•¿åº¦
);
```

### 8.3 åº”ç”¨é«˜äº®


```java
FullTextQuery query = fullTextSession
    .createFullTextQuery(luceneQuery, Product.class);

List<Product> products = query.list();

for (Product product : products) {
    try {
        // å¯¹åŸæ–‡æœ¬åº”ç”¨é«˜äº®
        String highlightedName = highlighter.getBestFragment(
            new StandardAnalyzer(),
            "name",                    // å­—æ®µå
            product.getName()          // åŸæ–‡æœ¬
        );
        
        // å¦‚æœæœ‰é«˜äº®ç»“æœå°±ç”¨é«˜äº®çš„ï¼Œå¦åˆ™ç”¨åŸæ–‡æœ¬
        String displayName = highlightedName != null ? 
            highlightedName : product.getName();
            
        System.out.println("å•†å“å: " + displayName);
        
    } catch (Exception e) {
        e.printStackTrace();
    }
}
```

### 8.4 å¤šå­—æ®µé«˜äº®


```java
// åŒæ—¶é«˜äº®nameå’Œdescription
String[] fields = {"name", "description"};

for (Product product : products) {
    System.out.println("=== å•†å“ä¿¡æ¯ ===");
    
    // é«˜äº®nameå­—æ®µ
    String highlightedName = highlighter.getBestFragment(
        new StandardAnalyzer(), "name", product.getName()
    );
    System.out.println("åç§°: " + 
        (highlightedName != null ? highlightedName : product.getName()));
    
    // é«˜äº®descriptionå­—æ®µ  
    String highlightedDesc = highlighter.getBestFragment(
        new StandardAnalyzer(), "description", product.getDescription()
    );
    System.out.println("æè¿°: " + 
        (highlightedDesc != null ? highlightedDesc : product.getDescription()));
}
```

**è‡ªå®šä¹‰é«˜äº®æ ·å¼**ï¼š

```java
// è‡ªå®šä¹‰CSSæ ·å¼çš„é«˜äº®
SimpleHTMLFormatter formatter = new SimpleHTMLFormatter(
    "<span style='color:red; font-weight:bold;'>",
    "</span>"
);

// æˆ–ä½¿ç”¨classä¾¿äºå‰ç«¯æ§åˆ¶
SimpleHTMLFormatter formatter = new SimpleHTMLFormatter(
    "<mark class='search-highlight'>",
    "</mark>"
);
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ FullTextSessionï¼šHibernateçš„å…¨æ–‡æœç´¢å¢å¼ºæ¥å£
ğŸ”¸ QueryBuilderï¼šæŸ¥è¯¢æ¡ä»¶æ„å»ºå™¨ï¼Œç¿»è¯‘æœç´¢éœ€æ±‚
ğŸ”¸ å…³é”®è¯æŸ¥è¯¢ï¼šæœ€å¸¸ç”¨çš„æœç´¢æ–¹å¼ï¼Œæ”¯æŒåˆ†è¯
ğŸ”¸ èŒƒå›´æŸ¥è¯¢ï¼šæ•°å€¼ã€æ—¥æœŸåŒºé—´æœç´¢
ğŸ”¸ ç»„åˆæŸ¥è¯¢ï¼šANDã€ORã€NOTé€»è¾‘ç»„åˆ
ğŸ”¸ æ’åºåˆ†é¡µï¼šç»“æœæ’åºå’Œåˆ†é¡µå±•ç¤º
ğŸ”¸ é«˜äº®æ˜¾ç¤ºï¼šæœç´¢å…³é”®è¯çš„è§†è§‰çªå‡º
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å…¨æ–‡æœç´¢ vs æ•°æ®åº“æŸ¥è¯¢**
```
æ•°æ®åº“LIKEæŸ¥è¯¢ï¼š
- æ€§èƒ½å·®ï¼Œå…¨è¡¨æ‰«æ
- ä¸æ”¯æŒä¸­æ–‡åˆ†è¯
- æ— ç›¸å…³æ€§æ’åº

å…¨æ–‡æœç´¢ï¼š
- ä½¿ç”¨å€’æ’ç´¢å¼•ï¼Œé€Ÿåº¦å¿«
- æ™ºèƒ½ä¸­æ–‡åˆ†è¯
- ç›¸å…³æ€§è¯„åˆ†æ’åº
```

**ğŸ”¹ QueryBuilderçš„ä½œç”¨**
```
ä½ çš„éœ€æ±‚        â†’  QueryBuilder  â†’  LuceneæŸ¥è¯¢
"æœç´¢æ‰‹æœº"          .keyword()       Queryå¯¹è±¡
"ä»·æ ¼1000-5000"     .range()         Queryå¯¹è±¡  
"è‹¹æœä¸”éäºŒæ‰‹"      .bool()          Queryå¯¹è±¡
```

**ğŸ”¹ æŸ¥è¯¢ç±»å‹é€‰æ‹©**
```
âœ… keyword() - æ–‡æœ¬å…³é”®è¯æœç´¢ï¼ˆæœ€å¸¸ç”¨ï¼‰
âœ… range()   - æ•°å€¼ã€æ—¥æœŸèŒƒå›´æŸ¥è¯¢  
âœ… bool()    - å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢
âœ… phrase()  - å®Œæ•´çŸ­è¯­åŒ¹é…
```

### 9.3 å®é™…åº”ç”¨æŒ‡å—


**ç”µå•†æœç´¢åœºæ™¯**ï¼š
```java
// ç”¨æˆ·è¾“å…¥ï¼š"è‹¹æœæ‰‹æœº 2000-5000"
// å®ç°é€»è¾‘ï¼š

// 1. å…³é”®è¯æŸ¥è¯¢
Query keywordQuery = qb.keyword()
    .onFields("name", "description")
    .matching("è‹¹æœæ‰‹æœº")
    .createQuery();

// 2. ä»·æ ¼èŒƒå›´
Query priceQuery = qb.range()
    .onField("price")
    .from(2000.0).to(5000.0)
    .createQuery();

// 3. ç»„åˆæŸ¥è¯¢
Query finalQuery = qb.bool()
    .must(keywordQuery)
    .must(priceQuery)
    .createQuery();

// 4. æ’åºï¼ˆé”€é‡ä¼˜å…ˆï¼‰
query.setSort(new Sort(
    new SortField("sales", SortField.Type.INT, true)
));

// 5. åˆ†é¡µ
query.setFirstResult(0).setMaxResults(20);

// 6. é«˜äº®
// ... é«˜äº®æ˜¾ç¤ºä»£ç 
```

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**é—®é¢˜1ï¼šæœç´¢ä¸­æ–‡æ²¡ç»“æœ**
```java
// âŒ é”™è¯¯ï¼šæ²¡æœ‰é…ç½®ä¸­æ–‡åˆ†è¯å™¨
@Field
private String name;

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨
@Field(analyzer = @Analyzer(impl = IKAnalyzer.class))
private String name;
```

**é—®é¢˜2ï¼šæœç´¢ç»“æœä¸å‡†ç¡®**
```java
// ä¼˜åŒ–æ–¹æ¡ˆï¼š
// 1. è®¾ç½®å­—æ®µæƒé‡
.onFields("name").boostedTo(3.0f)
.andField("description").boostedTo(1.0f)

// 2. æŒ‰ç›¸å…³æ€§æ’åº
query.setSort(Sort.RELEVANCE);
```

**é—®é¢˜3ï¼šå¤§æ•°æ®é‡åˆ†é¡µæ…¢**
```java
// ä¼˜åŒ–ï¼šä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆé€‚åˆæ·±åº¦åˆ†é¡µï¼‰
FullTextQuery query = ...;
ScrollableResults results = query.scroll();

// æˆ–ä½¿ç”¨ESç­‰ä¸“ä¸šæœç´¢å¼•æ“
```

### 9.5 æœ€ä½³å®è·µå»ºè®®


- [x] **å­—æ®µé€‰æ‹©**ï¼šåªå¯¹éœ€è¦æœç´¢çš„å­—æ®µå»ºç«‹ç´¢å¼•
- [x] **åˆ†è¯å™¨é…ç½®**ï¼šä¸­æ–‡å­—æ®µå¿…é¡»é…ç½®ä¸­æ–‡åˆ†è¯å™¨
- [x] **æƒé‡è®¾ç½®**ï¼šé‡è¦å­—æ®µè®¾ç½®æ›´é«˜æƒé‡
- [x] **ç»„åˆæŸ¥è¯¢**ï¼šä½¿ç”¨bool()ç»„åˆå¤šä¸ªæ¡ä»¶
- [x] **åˆ†é¡µä¼˜åŒ–**ï¼šåˆç†è®¾ç½®æ¯é¡µå¤§å°ï¼Œé¿å…æ·±åº¦åˆ†é¡µ
- [x] **é«˜äº®ä¼˜åŒ–**ï¼šåªé«˜äº®å¿…è¦å­—æ®µï¼Œæ§åˆ¶ç‰‡æ®µé•¿åº¦

**å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
```
1ï¸âƒ£ æŒæ¡åŸºç¡€å…³é”®è¯æŸ¥è¯¢ï¼ˆkeywordï¼‰
    â†“
2ï¸âƒ£ å­¦ä¹ èŒƒå›´æŸ¥è¯¢ï¼ˆrangeï¼‰
    â†“
3ï¸âƒ£ ç†è§£ç»„åˆæŸ¥è¯¢ï¼ˆboolï¼‰
    â†“
4ï¸âƒ£ å®ç°æ’åºåˆ†é¡µ
    â†“
5ï¸âƒ£ åº”ç”¨é«˜äº®æ˜¾ç¤º
    â†“
6ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å…¨æ–‡æœç´¢ç”¨ç´¢å¼•ï¼Œé€Ÿåº¦å¿«è¿‡æ•°æ®åº“
- QueryBuilderæ˜¯æ¡¥æ¢ï¼Œéœ€æ±‚ç¿»è¯‘æˆæŸ¥è¯¢
- keywordæœ€å¸¸ç”¨ï¼Œrangeé…ç»„åˆ
- æ’åºåˆ†é¡µé«˜äº®ï¼Œç”¨æˆ·ä½“éªŒè¦åšå¥½