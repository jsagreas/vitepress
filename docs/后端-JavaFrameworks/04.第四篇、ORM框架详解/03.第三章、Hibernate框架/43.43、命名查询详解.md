---
title: 43ã€å‘½åæŸ¥è¯¢è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [å‘½åæŸ¥è¯¢åŸºç¡€æ¦‚å¿µ](#1-å‘½åæŸ¥è¯¢åŸºç¡€æ¦‚å¿µ)
2. [å‘½åæŸ¥è¯¢çš„é…ç½®æ–¹å¼](#2-å‘½åæŸ¥è¯¢çš„é…ç½®æ–¹å¼)
3. [å‘½åæŸ¥è¯¢çš„ä½¿ç”¨](#3-å‘½åæŸ¥è¯¢çš„ä½¿ç”¨)
4. [åŠ¨æ€æŸ¥è¯¢æŠ€æœ¯](#4-åŠ¨æ€æŸ¥è¯¢æŠ€æœ¯)
5. [æŸ¥è¯¢ä¼˜åŒ–ä¸æœ€ä½³å®è·µ](#5-æŸ¥è¯¢ä¼˜åŒ–ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å‘½åæŸ¥è¯¢åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å‘½åæŸ¥è¯¢


**é€šä¿—ç†è§£**ï¼š
> å‘½åæŸ¥è¯¢å°±åƒç»™å¸¸ç”¨çš„SQLè¯­å¥èµ·ä¸ªåå­—ä¿å­˜èµ·æ¥ï¼Œç”¨çš„æ—¶å€™ç›´æ¥å«åå­—å°±è¡Œï¼Œä¸ç”¨æ¯æ¬¡éƒ½å†™ä¸€éSQLã€‚

**ä¸“ä¸šå®šä¹‰**ï¼š
å‘½åæŸ¥è¯¢ï¼ˆNamed Queryï¼‰æ˜¯é¢„å…ˆå®šä¹‰å¹¶å‘½åçš„æŸ¥è¯¢è¯­å¥ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶å°±ç¼–è¯‘å¥½ï¼Œä½¿ç”¨æ—¶é€šè¿‡åç§°è°ƒç”¨ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œæ€§èƒ½ã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
å°±åƒé¤å…çš„èœå•ï¼š
âŒ æ¯æ¬¡éƒ½æè¿°ï¼šæˆ‘è¦ç•ªèŒ„ç‚’é¸¡è›‹ã€é¸¡è›‹ä¸¤ä¸ªã€ç•ªèŒ„åˆ‡å—ã€åŠ ç‚¹ç³–...
âœ… ç›´æ¥è¯´èœåï¼šæ¥ä»½ç•ªèŒ„ç‚’é¸¡è›‹ï¼ï¼ˆå¨å¸ˆçŸ¥é“æ€ä¹ˆåšï¼‰

å‘½åæŸ¥è¯¢ä¹Ÿæ˜¯ä¸€æ ·ï¼š
âŒ æ¯æ¬¡å†™SQLï¼šSELECT * FROM user WHERE age > 18 AND status = 1...
âœ… ç›´æ¥ç”¨åå­—ï¼šgetActiveAdultUsersï¼ˆHibernateçŸ¥é“æ‰§è¡Œä»€ä¹ˆSQLï¼‰
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å‘½åæŸ¥è¯¢


**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

ğŸ”¸ **ä»£ç å¤ç”¨**
- åŒä¸€ä¸ªæŸ¥è¯¢åœ¨å¤šå¤„ä½¿ç”¨ï¼Œåªéœ€å®šä¹‰ä¸€æ¬¡
- ä¿®æ”¹æŸ¥è¯¢é€»è¾‘åªéœ€æ”¹ä¸€å¤„ï¼Œé¿å…é—æ¼

ğŸ”¸ **æå‰ç¼–è¯‘**
- åº”ç”¨å¯åŠ¨æ—¶å°±æ£€æŸ¥è¯­æ³•é”™è¯¯
- é¿å…è¿è¡Œæ—¶æ‰å‘ç°SQLå†™é”™äº†

ğŸ”¸ **é›†ä¸­ç®¡ç†**
- æ‰€æœ‰æŸ¥è¯¢é›†ä¸­åœ¨å®ä½“ç±»æˆ–é…ç½®æ–‡ä»¶
- ä¾¿äºç»´æŠ¤å’ŒæŸ¥æ‰¾

ğŸ”¸ **æ€§èƒ½ä¼˜åŒ–**
- Hibernateä¼šç¼“å­˜æŸ¥è¯¢è®¡åˆ’
- æ‰§è¡Œæ•ˆç‡æ¯”åŠ¨æ€æ‹¼SQLé«˜

**å¯¹æ¯”ç†è§£**ï¼š
```
æ™®é€šæŸ¥è¯¢ï¼ˆæ¯æ¬¡éƒ½å†™ï¼‰ï¼š
String hql = "FROM User WHERE age > :age";
Query query = session.createQuery(hql);
// æ¯å¤„éƒ½è¦å†™è¿™æ®µä»£ç ï¼Œå®¹æ˜“å‡ºé”™

å‘½åæŸ¥è¯¢ï¼ˆå®šä¹‰ä¸€æ¬¡ï¼‰ï¼š
@NamedQuery(name="findAdultUsers", 
            query="FROM User WHERE age > :age")
// ä½¿ç”¨æ—¶ï¼š
Query query = session.getNamedQuery("findAdultUsers");
// ç®€æ´æ¸…æ™°ï¼Œä¸æ˜“å‡ºé”™
```

---

## 2. ğŸ“ å‘½åæŸ¥è¯¢çš„é…ç½®æ–¹å¼


### 2.1 ä½¿ç”¨@NamedQueryæ³¨è§£


**åŸºæœ¬ç”¨æ³•**ï¼š
åœ¨å®ä½“ç±»ä¸Šä½¿ç”¨`@NamedQuery`æ³¨è§£å®šä¹‰æŸ¥è¯¢

```java
@Entity
@NamedQuery(
    name = "User.findByAge",              // æŸ¥è¯¢åç§°
    query = "FROM User u WHERE u.age > :minAge"  // HQLè¯­å¥
)
public class User {
    @Id
    private Long id;
    private String name;
    private Integer age;
    // ... getter/setter
}
```

> **ğŸ’¡ å‘½åè§„èŒƒå»ºè®®**
> - ä½¿ç”¨"å®ä½“ç±»å.æ“ä½œæè¿°"æ ¼å¼ï¼š`User.findByAge`
> - è¯­ä¹‰æ¸…æ™°ï¼šä¸€çœ‹åå­—å°±çŸ¥é“å¹²ä»€ä¹ˆ
> - é¿å…é‡å¤ï¼šåŒä¸€ä¸ªSessionFactoryå†…åå­—å¿…é¡»å”¯ä¸€

**å‚æ•°è¯´æ˜**ï¼š
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `name` | **æŸ¥è¯¢çš„å”¯ä¸€æ ‡è¯†**ï¼Œä½¿ç”¨æ—¶é€šè¿‡è¿™ä¸ªåå­—è°ƒç”¨ | `"User.findActive"` |
| `query` | **HQLæˆ–JPQLæŸ¥è¯¢è¯­å¥**ï¼Œå¯ä»¥å¸¦å‚æ•° | `"FROM User WHERE status=1"` |

### 2.2 å®šä¹‰å¤šä¸ªå‘½åæŸ¥è¯¢


**ä½¿ç”¨@NamedQueriesæ³¨è§£**ï¼š
å½“ä¸€ä¸ªå®ä½“éœ€è¦å¤šä¸ªå‘½åæŸ¥è¯¢æ—¶ï¼Œç”¨`@NamedQueries`åŒ…è£¹

```java
@Entity
@NamedQueries({
    @NamedQuery(
        name = "User.findAll",
        query = "FROM User"
    ),
    @NamedQuery(
        name = "User.findByName",
        query = "FROM User u WHERE u.name LIKE :name"
    ),
    @NamedQuery(
        name = "User.countActive",
        query = "SELECT COUNT(u) FROM User u WHERE u.status = 1"
    )
})
public class User {
    // å®ä½“å®šä¹‰...
}
```

> **ğŸ” ç†è§£è¦ç‚¹**
> - ä¸€ä¸ª`@NamedQueries`é‡Œå¯ä»¥æ”¾å¤šä¸ª`@NamedQuery`
> - æ¯ä¸ªæŸ¥è¯¢éƒ½æœ‰ç‹¬ç«‹çš„åå­—å’ŒSQL
> - è¿™äº›æŸ¥è¯¢åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±ä¼šè¢«HibernateåŠ è½½å’ŒéªŒè¯

### 2.3 å‘½åSQLæŸ¥è¯¢


**ä»€ä¹ˆæ—¶å€™ç”¨åŸç”ŸSQL**ï¼š
æœ‰æ—¶å€™HQLè¡¨è¾¾ä¸äº†çš„å¤æ‚æŸ¥è¯¢ï¼Œéœ€è¦ç”¨åŸç”ŸSQL

```java
@Entity
@NamedNativeQuery(
    name = "User.complexStatistics",
    query = "SELECT u.department, COUNT(*), AVG(u.salary) " +
            "FROM t_user u " +
            "GROUP BY u.department " +
            "HAVING AVG(u.salary) > :minAvg",
    resultClass = Object[].class  // è¿”å›ç»“æœç±»å‹
)
public class User {
    // å®ä½“å®šä¹‰...
}
```

**HQL vs åŸç”ŸSQLå¯¹æ¯”**ï¼š
```
HQLæŸ¥è¯¢ï¼ˆé¢å‘å¯¹è±¡ï¼‰ï¼š
FROM User u WHERE u.age > 18
ç‰¹ç‚¹ï¼šå†™å®ä½“ç±»åå’Œå±æ€§å

åŸç”ŸSQLæŸ¥è¯¢ï¼ˆé¢å‘æ•°æ®åº“ï¼‰ï¼š
SELECT * FROM t_user WHERE age > 18
ç‰¹ç‚¹ï¼šå†™æ•°æ®åº“è¡¨åå’Œå­—æ®µå
```

---

## 3. ğŸš€ å‘½åæŸ¥è¯¢çš„ä½¿ç”¨


### 3.1 è·å–å‘½åæŸ¥è¯¢


**åŸºæœ¬ä½¿ç”¨æµç¨‹**ï¼š
```
ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æŸ¥è¯¢ï¼ˆåœ¨å®ä½“ç±»ä¸Šï¼‰
     â†“
ç¬¬äºŒæ­¥ï¼šè·å–æŸ¥è¯¢ï¼ˆé€šè¿‡åç§°ï¼‰
     â†“
ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®å‚æ•°ï¼ˆå¦‚æœæœ‰ï¼‰
     â†“
ç¬¬å››æ­¥ï¼šæ‰§è¡ŒæŸ¥è¯¢
```

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// 1. è·å–å‘½åæŸ¥è¯¢
Query<User> query = session.getNamedQuery("User.findByAge");

// 2. è®¾ç½®å‚æ•°
query.setParameter("minAge", 18);

// 3. æ‰§è¡ŒæŸ¥è¯¢
List<User> users = query.list();
```

> **âš ï¸ å¸¸è§é”™è¯¯**
> ```java
> // âŒ é”™è¯¯ï¼šæŸ¥è¯¢åç§°å†™é”™
> session.getNamedQuery("User.findByAges"); // å¤šäº†ä¸ªs
> 
> // âŒ é”™è¯¯ï¼šå‚æ•°åä¸åŒ¹é…
> query.setParameter("age", 18);  // å®šä¹‰çš„æ˜¯minAge
> 
> // âœ… æ­£ç¡®ï¼šåç§°å’Œå‚æ•°å®Œå…¨åŒ¹é…
> session.getNamedQuery("User.findByAge")
>        .setParameter("minAge", 18);
> ```

### 3.2 å‚æ•°ä¼ é€’


**ä½ç½®å‚æ•°**ï¼ˆä¸æ¨èï¼‰ï¼š
```java
@NamedQuery(
    name = "User.findByRange",
    query = "FROM User WHERE age >= ?1 AND age <= ?2"
)
// ä½¿ç”¨ï¼šæŒ‰ä½ç½®ä¼ å‚
query.setParameter(1, 18);
query.setParameter(2, 60);
```

**å‘½åå‚æ•°**ï¼ˆæ¨èï¼‰ï¼š
```java
@NamedQuery(
    name = "User.findByRange",
    query = "FROM User WHERE age >= :minAge AND age <= :maxAge"
)
// ä½¿ç”¨ï¼šæŒ‰åç§°ä¼ å‚ï¼Œæ›´æ¸…æ™°
query.setParameter("minAge", 18);
query.setParameter("maxAge", 60);
```

**ä¸ºä»€ä¹ˆæ¨èå‘½åå‚æ•°**ï¼š
```
ä½ç½®å‚æ•°ï¼šquery.setParameter(1, 18);
âŒ çœ‹ä¸å‡º18ä»£è¡¨ä»€ä¹ˆæ„æ€
âŒ å‚æ•°é¡ºåºé”™äº†å°±éº»çƒ¦äº†

å‘½åå‚æ•°ï¼šquery.setParameter("minAge", 18);
âœ… ä¸€çœ‹å°±çŸ¥é“æ˜¯æœ€å°å¹´é¾„
âœ… é¡ºåºæ— æ‰€è°“ï¼ŒæŒ‰åå­—å¯¹åº”
```

### 3.3 æŸ¥è¯¢ç»“æœå¤„ç†


**ä¸åŒæŸ¥è¯¢çš„ç»“æœç±»å‹**ï¼š

ğŸ”¸ **æŸ¥è¯¢å®ä½“åˆ—è¡¨**
```java
@NamedQuery(name = "User.findAll", query = "FROM User")
// è¿”å› List<User>
List<User> users = session.getNamedQuery("User.findAll").list();
```

ğŸ”¸ **æŸ¥è¯¢å•ä¸ªå®ä½“**
```java
@NamedQuery(
    name = "User.findById",
    query = "FROM User WHERE id = :id"
)
// è¿”å›å•ä¸ªUseræˆ–null
User user = session.getNamedQuery("User.findById")
                  .setParameter("id", 1L)
                  .uniqueResult();
```

ğŸ”¸ **ç»Ÿè®¡æŸ¥è¯¢**
```java
@NamedQuery(
    name = "User.countAll",
    query = "SELECT COUNT(u) FROM User u"
)
// è¿”å› Long ç±»å‹
Long count = (Long) session.getNamedQuery("User.countAll")
                          .uniqueResult();
```

---

## 4. ğŸ”„ åŠ¨æ€æŸ¥è¯¢æŠ€æœ¯


### 4.1 ä»€ä¹ˆæ˜¯åŠ¨æ€æŸ¥è¯¢


**æ¦‚å¿µç†è§£**ï¼š
> åŠ¨æ€æŸ¥è¯¢å°±æ˜¯æ ¹æ®ä¸åŒæ¡ä»¶ï¼Œæ‹¼æ¥å‡ºä¸åŒçš„SQLè¯­å¥ã€‚æ¯”å¦‚æœç´¢åŠŸèƒ½ï¼Œç”¨æˆ·å¯èƒ½åªå¡«å§“åï¼Œä¹Ÿå¯èƒ½å§“åå’Œå¹´é¾„éƒ½å¡«ï¼ŒSQLè¦è·Ÿç€å˜ã€‚

**å®é™…åœºæ™¯**ï¼š
```
ç”¨æˆ·æœç´¢ç•Œé¢ï¼š
[ å§“å: _____ ]  [ å¹´é¾„: _____ ]  [ çŠ¶æ€: â–¼ ]  [æœç´¢]

ç”¨æˆ·å¯èƒ½çš„æ“ä½œï¼š
1. åªå¡«å§“å  â†’ WHERE name LIKE '%å¼ %'
2. åªå¡«å¹´é¾„  â†’ WHERE age > 20
3. éƒ½å¡«äº†    â†’ WHERE name LIKE '%å¼ %' AND age > 20
4. éƒ½ä¸å¡«    â†’ æŸ¥è¯¢å…¨éƒ¨

è¿™å°±éœ€è¦åŠ¨æ€æŸ¥è¯¢ï¼
```

### 4.2 åŠ¨æ€æŸ¥è¯¢å®ç°æ–¹å¼


**æ–¹å¼ä¸€ï¼šå­—ç¬¦ä¸²æ‹¼æ¥**ï¼ˆä¸æ¨èï¼‰
```java
// âŒ è¿™ç§æ–¹å¼å®¹æ˜“å‡ºé”™ï¼Œä¸å®‰å…¨
String hql = "FROM User WHERE 1=1";
if (name != null) {
    hql += " AND name LIKE '%" + name + "%'";  // SQLæ³¨å…¥é£é™©ï¼
}
if (age != null) {
    hql += " AND age > " + age;
}
```

**æ–¹å¼äºŒï¼šCriteria API**ï¼ˆæ¨èï¼‰
```java
// âœ… ç±»å‹å®‰å…¨ï¼Œä¸ä¼šSQLæ³¨å…¥
CriteriaBuilder cb = session.getCriteriaBuilder();
CriteriaQuery<User> cq = cb.createQuery(User.class);
Root<User> root = cq.from(User.class);

// åŠ¨æ€æ·»åŠ æ¡ä»¶
List<Predicate> predicates = new ArrayList<>();

if (name != null) {
    predicates.add(cb.like(root.get("name"), "%" + name + "%"));
}
if (age != null) {
    predicates.add(cb.gt(root.get("age"), age));
}

// ç»„åˆæ¡ä»¶
cq.where(predicates.toArray(new Predicate[0]));
List<User> users = session.createQuery(cq).list();
```

**ä¸¤ç§æ–¹å¼å¯¹æ¯”**ï¼š
| ç‰¹æ€§ | å­—ç¬¦ä¸²æ‹¼æ¥ | Criteria API |
|------|-----------|--------------|
| **å®‰å…¨æ€§** | âŒ å®¹æ˜“SQLæ³¨å…¥ | âœ… ç±»å‹å®‰å…¨ |
| **ç¼–è¯‘æ£€æŸ¥** | âŒ è¿è¡Œæ—¶æ‰çŸ¥é“é”™è¯¯ | âœ… ç¼–è¯‘æœŸå°±èƒ½å‘ç°é”™è¯¯ |
| **ä»£ç å¯è¯»æ€§** | âŒ å­—ç¬¦ä¸²éš¾ç»´æŠ¤ | âœ… é¢å‘å¯¹è±¡ï¼Œæ¸…æ™° |
| **å­¦ä¹ æˆæœ¬** | âœ… ç®€å•ç›´è§‚ | âŒ APIè¾ƒå¤æ‚ |

### 4.3 Criteria APIè¯¦è§£


**åŸºæœ¬æ¦‚å¿µ**ï¼š
```
CriteriaBuilderï¼šæ¡ä»¶æ„å»ºå™¨ï¼Œç”¨æ¥åˆ›å»ºå„ç§æ¡ä»¶
     â†“
CriteriaQueryï¼šæŸ¥è¯¢å¯¹è±¡ï¼Œå®šä¹‰æŸ¥è¯¢çš„ç»“æ„
     â†“
Rootï¼šæŸ¥è¯¢çš„æ ¹å®ä½“ï¼Œä»£è¡¨FROMå­å¥
     â†“
Predicateï¼šæŸ¥è¯¢æ¡ä»¶ï¼Œä»£è¡¨WHEREå­å¥
```

**å¸¸ç”¨æ¡ä»¶æ„å»º**ï¼š
```java
CriteriaBuilder cb = session.getCriteriaBuilder();
CriteriaQuery<User> query = cb.createQuery(User.class);
Root<User> user = query.from(User.class);

// ç­‰äº
cb.equal(user.get("name"), "å¼ ä¸‰");

// ä¸ç­‰äº
cb.notEqual(user.get("status"), 0);

// å¤§äº/å°äº
cb.gt(user.get("age"), 18);      // age > 18
cb.lt(user.get("age"), 60);      // age < 60

// æ¨¡ç³ŠæŸ¥è¯¢
cb.like(user.get("name"), "%å¼ %"); // name LIKE '%å¼ %'

// èŒƒå›´æŸ¥è¯¢
cb.between(user.get("age"), 18, 60); // age BETWEEN 18 AND 60

// ç©ºå€¼åˆ¤æ–­
cb.isNull(user.get("email"));     // email IS NULL
cb.isNotNull(user.get("phone"));  // phone IS NOT NULL

// æ¡ä»¶ç»„åˆ
cb.and(æ¡ä»¶1, æ¡ä»¶2);  // AND
cb.or(æ¡ä»¶1, æ¡ä»¶2);   // OR
cb.not(æ¡ä»¶);          // NOT
```

---

## 5. âš¡ æŸ¥è¯¢ä¼˜åŒ–ä¸æœ€ä½³å®è·µ


### 5.1 æŸ¥è¯¢ç®¡ç†ç­–ç•¥


**é›†ä¸­ç®¡ç†åŸåˆ™**ï¼š

ğŸ”¸ **æŒ‰æ¨¡å—åˆ’åˆ†**
```java
// ç”¨æˆ·ç›¸å…³æŸ¥è¯¢
@NamedQueries({
    @NamedQuery(name = "User.findAll", ...),
    @NamedQuery(name = "User.findActive", ...),
    @NamedQuery(name = "User.searchByName", ...)
})
public class User { }

// è®¢å•ç›¸å…³æŸ¥è¯¢
@NamedQueries({
    @NamedQuery(name = "Order.findByUser", ...),
    @NamedQuery(name = "Order.findPending", ...)
})
public class Order { }
```

ğŸ”¸ **å‘½åè§„èŒƒ**
```
æ¨èæ ¼å¼ï¼šå®ä½“ç±»å.åŠ¨ä½œæè¿°

âœ… å¥½çš„å‘½åï¼š
User.findByAge          æ¸…æ¥šçŸ¥é“æŸ¥ç”¨æˆ·ï¼ŒæŒ‰å¹´é¾„æŸ¥
Order.findByDateRange   æŸ¥è®¢å•ï¼ŒæŒ‰æ—¥æœŸèŒƒå›´
Product.countInStock    ç»Ÿè®¡åº“å­˜å•†å“æ•°é‡

âŒ ä¸å¥½çš„å‘½åï¼š
query1                  å®Œå…¨ä¸çŸ¥é“å¹²ä»€ä¹ˆ
getUserInfo            ä¸ç¬¦åˆè§„èŒƒ
find                   å¤ªæ¨¡ç³Š
```

### 5.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**æŸ¥è¯¢ä¼˜åŒ–è¦ç‚¹**ï¼š

> **ğŸ’¡ æ ¸å¿ƒåŸåˆ™**
> 1. èƒ½ç”¨å‘½åæŸ¥è¯¢å°±ä¸ç”¨åŠ¨æ€æŸ¥è¯¢
> 2. èƒ½ç”¨HQLå°±ä¸ç”¨åŸç”ŸSQL
> 3. èƒ½æŸ¥éœ€è¦çš„å­—æ®µå°±ä¸æŸ¥å…¨éƒ¨
> 4. åˆç†ä½¿ç”¨ç¼“å­˜

**å…·ä½“å®è·µ**ï¼š

ğŸ”¹ **é¿å…N+1æŸ¥è¯¢é—®é¢˜**
```java
// âŒ N+1é—®é¢˜ï¼šæŸ¥1æ¬¡ç”¨æˆ·ï¼Œå†æŸ¥Næ¬¡è®¢å•
List<User> users = session.createQuery("FROM User").list();
for (User user : users) {
    user.getOrders().size(); // æ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“ï¼
}

// âœ… ä½¿ç”¨JOIN FETCHä¸€æ¬¡æŸ¥å‡º
@NamedQuery(
    name = "User.findWithOrders",
    query = "FROM User u LEFT JOIN FETCH u.orders"
)
```

ğŸ”¹ **åªæŸ¥éœ€è¦çš„å­—æ®µ**
```java
// âŒ æŸ¥å…¨éƒ¨å­—æ®µï¼Œæ•°æ®é‡å¤§
@NamedQuery(
    name = "User.getNames",
    query = "FROM User"  // æŸ¥äº†idã€nameã€ageã€email...
)

// âœ… åªæŸ¥éœ€è¦çš„
@NamedQuery(
    name = "User.getNames",
    query = "SELECT u.name FROM User u"  // åªæŸ¥name
)
```

ğŸ”¹ **åˆç†è®¾ç½®ç¼“å­˜**
```java
@NamedQuery(
    name = "User.findAll",
    query = "FROM User",
    hints = {
        @QueryHint(name = "org.hibernate.cacheable", value = "true"),
        @QueryHint(name = "org.hibernate.cacheRegion", value = "userCache")
    }
)
```

### 5.3 ä»£ç å¤ç”¨æŠ€å·§


**å°è£…æŸ¥è¯¢æœåŠ¡**ï¼š
```java
public class UserQueryService {
    
    private Session session;
    
    // æŒ‰å¹´é¾„æŸ¥è¯¢
    public List<User> findByAge(Integer minAge) {
        return session.getNamedQuery("User.findByAge")
                     .setParameter("minAge", minAge)
                     .list();
    }
    
    // æŒ‰åå­—æ¨¡ç³ŠæŸ¥è¯¢
    public List<User> searchByName(String keyword) {
        return session.getNamedQuery("User.searchByName")
                     .setParameter("name", "%" + keyword + "%")
                     .list();
    }
    
    // ç»Ÿè®¡æ´»è·ƒç”¨æˆ·
    public Long countActive() {
        return (Long) session.getNamedQuery("User.countActive")
                            .uniqueResult();
    }
}
```

**å¥½å¤„**ï¼š
- âœ… éšè—æŸ¥è¯¢ç»†èŠ‚ï¼Œè°ƒç”¨è€…åªå…³å¿ƒä¸šåŠ¡
- âœ… ç»Ÿä¸€å‚æ•°å¤„ç†å’Œå¼‚å¸¸ç®¡ç†
- âœ… æ–¹ä¾¿å•å…ƒæµ‹è¯•å’Œç»´æŠ¤

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**å‘½åæŸ¥è¯¢ä¸‰è¦ç´ **ï¼š
```
1ï¸âƒ£ å®šä¹‰ï¼šåœ¨å®ä½“ç±»ä¸Šç”¨@NamedQueryæ³¨è§£
2ï¸âƒ£ è·å–ï¼šé€šè¿‡session.getNamedQuery(åç§°)
3ï¸âƒ£ ä½¿ç”¨ï¼šè®¾ç½®å‚æ•°ï¼Œæ‰§è¡ŒæŸ¥è¯¢
```

**å‘½åæŸ¥è¯¢ vs åŠ¨æ€æŸ¥è¯¢**ï¼š
| å¯¹æ¯”é¡¹ | å‘½åæŸ¥è¯¢ | åŠ¨æ€æŸ¥è¯¢ |
|--------|---------|---------|
| **é€‚ç”¨åœºæ™¯** | SQLå›ºå®šï¼Œç»å¸¸ä½¿ç”¨ | SQLä¸ç¡®å®šï¼Œæ¡ä»¶å¯å˜ |
| **æ€§èƒ½** | â­â­â­â­â­ æå‰ç¼–è¯‘ | â­â­â­ è¿è¡Œæ—¶æ„å»º |
| **çµæ´»æ€§** | â­â­ ç›¸å¯¹å›ºå®š | â­â­â­â­â­ éå¸¸çµæ´» |
| **ç»´æŠ¤æ€§** | â­â­â­â­â­ é›†ä¸­ç®¡ç† | â­â­â­ åˆ†æ•£åœ¨ä»£ç ä¸­ |

### 6.2 å…³é”®ç†è§£è¦ç‚¹


> **ğŸ”‘ æ ¸å¿ƒç†è§£**
> 
> **å‘½åæŸ¥è¯¢**å°±åƒé¢„å®šçš„å¥—é¤ï¼š
> - èœå•ä¸Šå†™å¥½çš„ï¼Œç‚¹äº†å°±ä¸Šèœ
> - é€Ÿåº¦å¿«ï¼Œä¸ä¼šå‡ºé”™
> - ä½†èœå“å›ºå®šï¼Œä¸èƒ½æ”¹
> 
> **åŠ¨æ€æŸ¥è¯¢**å°±åƒè‡ªé€‰é¤ï¼š
> - æƒ³åƒä»€ä¹ˆè‡ªå·±é€‰
> - çµæ´»è‡ªç”±ï¼Œéšéœ€åº”å˜
> - ä½†è¦è‡ªå·±æ­é…ï¼Œå¯èƒ½å‡ºé”™

### 6.3 å®æˆ˜æ³¨æ„äº‹é¡¹


**ğŸ”” é‡è¦æé†’**ï¼š

âœ… **DOï¼ˆåº”è¯¥åšçš„ï¼‰**
- æŸ¥è¯¢åç§°è¦è§åçŸ¥æ„
- ä¼˜å…ˆä½¿ç”¨å‘½åå‚æ•°ï¼Œä¸ç”¨ä½ç½®å‚æ•°
- å¤æ‚æŸ¥è¯¢ç”¨Criteria APIï¼Œåˆ«æ‹¼å­—ç¬¦ä¸²
- æ³¨æ„æŸ¥è¯¢ç»“æœç±»å‹ï¼Œé¿å…ç±»å‹è½¬æ¢å¼‚å¸¸

âŒ **DON'Tï¼ˆä¸è¯¥åšçš„ï¼‰**
- ä¸è¦åœ¨å‘½åæŸ¥è¯¢é‡Œå†™ä¸šåŠ¡é€»è¾‘
- ä¸è¦å¿½ç•¥SQLæ³¨å…¥é£é™©
- ä¸è¦ç›²ç›®ä½¿ç”¨SELECT *
- ä¸è¦å¿˜è®°å¤„ç†æŸ¥è¯¢ç»“æœä¸ºç©ºçš„æƒ…å†µ

### 6.4 å­¦ä¹ è·¯çº¿å»ºè®®


**ğŸ“š å¾ªåºæ¸è¿›**ï¼š
```
ç¬¬1æ­¥ï¼šæŒæ¡@NamedQueryåŸºæœ¬ç”¨æ³•
   â†“
ç¬¬2æ­¥ï¼šç†è§£å‚æ•°ä¼ é€’å’Œç»“æœå¤„ç†
   â†“
ç¬¬3æ­¥ï¼šå­¦ä¼šä½¿ç”¨@NamedQueriesç®¡ç†å¤šæŸ¥è¯¢
   â†“
ç¬¬4æ­¥ï¼šäº†è§£åŸç”ŸSQLæŸ¥è¯¢åœºæ™¯
   â†“
ç¬¬5æ­¥ï¼šæŒæ¡Criteria APIåŠ¨æ€æŸ¥è¯¢
   â†“
ç¬¬6æ­¥ï¼šå®è·µæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§
```

**ğŸ¯ å®è·µå»ºè®®**ï¼š
- ä»ç®€å•æŸ¥è¯¢å¼€å§‹ç»ƒä¹ 
- å¯¹æ¯”å‘½åæŸ¥è¯¢å’Œæ™®é€šæŸ¥è¯¢çš„åŒºåˆ«
- å®é™…é¡¹ç›®ä¸­æ€»ç»“æŸ¥è¯¢æ¨¡å¼
- å…³æ³¨æŸ¥è¯¢æ€§èƒ½ï¼Œå­¦ä¼šä¼˜åŒ–

---

**ğŸ“ æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å‘½åæŸ¥è¯¢æå‰å®šï¼Œå¤ç”¨æ–¹ä¾¿æ€§èƒ½å¥½
åŠ¨æ€æŸ¥è¯¢æ¡ä»¶æ´»ï¼ŒCriteriaç±»å‹ä¿
å‚æ•°ä¼ é€’ç”¨å‘½åï¼Œç»“æœå¤„ç†è¦è®°ç‰¢
æŸ¥è¯¢ä¼˜åŒ–è«å¿½è§†ï¼Œåˆç†ä½¿ç”¨ä»£ç å·§
```