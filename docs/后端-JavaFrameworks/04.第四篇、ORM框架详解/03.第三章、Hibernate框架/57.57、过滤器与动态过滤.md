---
title: 57ã€è¿‡æ»¤å™¨ä¸åŠ¨æ€è¿‡æ»¤
---
## ğŸ“š ç›®å½•

1. [è¿‡æ»¤å™¨æœºåˆ¶æ¦‚è¿°](#1-è¿‡æ»¤å™¨æœºåˆ¶æ¦‚è¿°)
2. [@Filterè¿‡æ»¤å™¨è¯¦è§£](#2-Filterè¿‡æ»¤å™¨è¯¦è§£)
3. [@FilterDefè¿‡æ»¤å™¨å®šä¹‰](#3-FilterDefè¿‡æ»¤å™¨å®šä¹‰)
4. [åŠ¨æ€æ•°æ®è¿‡æ»¤å®æˆ˜](#4-åŠ¨æ€æ•°æ®è¿‡æ»¤å®æˆ˜)
5. [æ¡ä»¶è¿‡æ»¤åº”ç”¨](#5-æ¡ä»¶è¿‡æ»¤åº”ç”¨)
6. [å¤šç§Ÿæˆ·æ”¯æŒæ–¹æ¡ˆ](#6-å¤šç§Ÿæˆ·æ”¯æŒæ–¹æ¡ˆ)
7. [è½¯åˆ é™¤å®ç°](#7-è½¯åˆ é™¤å®ç°)
8. [æƒé™æ§åˆ¶å®è·µ](#8-æƒé™æ§åˆ¶å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¿‡æ»¤å™¨æœºåˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯è¿‡æ»¤å™¨


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ åœ¨å›¾ä¹¦é¦†å€Ÿä¹¦ï¼Œä½ åªæƒ³çœ‹"è®¡ç®—æœºç±»"çš„ä¹¦ï¼Œè€Œä¸æƒ³çœ‹åˆ°å…¶ä»–ç±»åˆ«çš„ä¹¦ã€‚è¿‡æ»¤å™¨å°±åƒæ˜¯ç»™æŸ¥è¯¢åŠ ä¸Šäº†"åªçœ‹æŸç±»ä¹¦"çš„çœ¼é•œï¼Œè‡ªåŠ¨å¸®ä½ ç­›é€‰æ•°æ®ã€‚

```
æ²¡æœ‰è¿‡æ»¤å™¨çš„æŸ¥è¯¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·æ•°æ®         â”‚
â”‚  â”œâ”€ æ­£å¸¸ç”¨æˆ·(status=1)   â”‚
â”‚  â”œâ”€ å·²åˆ é™¤ç”¨æˆ·(status=0) â”‚  â† éƒ½ä¼šæŸ¥å‡ºæ¥
â”‚  â”œâ”€ ç¦ç”¨ç”¨æˆ·(status=2)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½¿ç”¨è¿‡æ»¤å™¨åï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢ç”¨æˆ·æ•°æ®             â”‚
â”‚  â”œâ”€ æ­£å¸¸ç”¨æˆ·(status=1)   â”‚  â† åªæŸ¥å‡ºè¿™ä¸ª
â”‚  â””â”€ [è‡ªåŠ¨è¿‡æ»¤å…¶ä»–çŠ¶æ€]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 è¿‡æ»¤å™¨çš„æ ¸å¿ƒä½œç”¨


**ğŸ”¸ æ ¸å¿ƒåŠŸèƒ½**
- **è‡ªåŠ¨è¿‡æ»¤**ï¼šæŸ¥è¯¢æ—¶è‡ªåŠ¨æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼Œä¸ç”¨æ¯æ¬¡æ‰‹å†™WHERE
- **åŠ¨æ€æ§åˆ¶**ï¼šå¯ä»¥éšæ—¶å¼€å¯/å…³é—­è¿‡æ»¤å™¨
- **å…¨å±€ç”Ÿæ•ˆ**ï¼šä¸€å¤„å®šä¹‰ï¼Œæ‰€æœ‰æŸ¥è¯¢éƒ½ç”Ÿæ•ˆ
- **å‚æ•°åŒ–**ï¼šå¯ä»¥ä¼ å…¥å‚æ•°å®ç°çµæ´»è¿‡æ»¤

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**

| åœºæ™¯ | è¯´æ˜ | æ•ˆæœ |
|------|------|------|
| ğŸ—‘ï¸ **è½¯åˆ é™¤** | å·²åˆ é™¤çš„æ•°æ®ä¸æ˜¾ç¤º | ç”¨æˆ·çœ‹ä¸åˆ°è¢«"åˆ é™¤"çš„è®°å½• |
| ğŸ‘¥ **å¤šç§Ÿæˆ·** | æ¯ä¸ªç§Ÿæˆ·åªçœ‹è‡ªå·±çš„æ•°æ® | Aå…¬å¸çœ‹ä¸åˆ°Bå…¬å¸çš„æ•°æ® |
| ğŸ” **æƒé™æ§åˆ¶** | æ ¹æ®ç”¨æˆ·æƒé™è¿‡æ»¤æ•°æ® | æ™®é€šå‘˜å·¥çœ‹ä¸åˆ°æœºå¯†ä¿¡æ¯ |
| ğŸ“… **æ—¶é—´èŒƒå›´** | åªæŸ¥è¯¢ç‰¹å®šæ—¶é—´æ®µæ•°æ® | åªçœ‹æœ¬æœˆçš„è®¢å• |

### 1.3 è¿‡æ»¤å™¨ vs æ™®é€šæŸ¥è¯¢


```
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ¯æ¬¡éƒ½è¦å†™æ¡ä»¶ï¼‰ï¼š
String hql = "FROM User WHERE status = 1";  // æ¯ä¸ªæŸ¥è¯¢éƒ½è¦åŠ 
List<User> users = session.createQuery(hql).list();

ä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆè‡ªåŠ¨æ·»åŠ æ¡ä»¶ï¼‰ï¼š
session.enableFilter("activeUsersOnly");    // ä¸€æ¬¡å¼€å¯
List<User> users = session.createQuery("FROM User").list();  
// è‡ªåŠ¨å˜æˆï¼šFROM User WHERE status = 1
```

**å¯¹æ¯”ä¼˜åŠ¿**
- âœ… ä»£ç æ›´ç®€æ´ï¼Œä¸ç”¨é‡å¤å†™è¿‡æ»¤æ¡ä»¶
- âœ… æ›´å®‰å…¨ï¼Œä¸ä¼šå¿˜è®°åŠ è¿‡æ»¤æ¡ä»¶
- âœ… æ›´çµæ´»ï¼Œå¯ä»¥åŠ¨æ€å¼€å…³
- âœ… æ›´ç»Ÿä¸€ï¼Œæ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨åº”ç”¨

---

## 2. ğŸ” @Filterè¿‡æ»¤å™¨è¯¦è§£


### 2.1 @Filteræ³¨è§£çš„åŸºæœ¬ç”¨æ³•


**æ ¸å¿ƒæ¦‚å¿µ**ï¼š`@Filter`æ˜¯åº”ç”¨åœ¨å®ä½“ç±»ä¸Šçš„æ³¨è§£ï¼Œç”¨æ¥æŒ‡å®šè¿™ä¸ªå®ä½“ä½¿ç”¨å“ªä¸ªè¿‡æ»¤å™¨ã€‚

**ğŸ”¸ åŸºæœ¬è¯­æ³•**
```java
@Entity
@Table(name = "users")
@FilterDef(
    name = "activeFilter",           // è¿‡æ»¤å™¨åç§°
    parameters = @ParamDef(
        name = "status",              // å‚æ•°å
        type = Integer.class          // å‚æ•°ç±»å‹
    )
)
@Filter(
    name = "activeFilter",            // ä½¿ç”¨å“ªä¸ªè¿‡æ»¤å™¨
    condition = "status = :status"    // è¿‡æ»¤æ¡ä»¶ï¼ˆSQLç‰‡æ®µï¼‰
)
public class User {
    @Id
    private Long id;
    private String name;
    private Integer status;  // 0-åˆ é™¤ 1-æ­£å¸¸ 2-ç¦ç”¨
}
```

**ğŸ“ æ³¨è§£è¯´æ˜**
- `@FilterDef`ï¼š**å®šä¹‰**è¿‡æ»¤å™¨ï¼ˆå®šä¹‰è§„åˆ™ï¼‰
- `@Filter`ï¼š**åº”ç”¨**è¿‡æ»¤å™¨ï¼ˆä½¿ç”¨è§„åˆ™ï¼‰
- `condition`ï¼šè¿‡æ»¤æ¡ä»¶ï¼Œå°±æ˜¯SQLçš„WHEREåé¢çš„å†…å®¹

### 2.2 è¿‡æ»¤å™¨çš„å¯ç”¨æ–¹å¼


**ğŸ”¸ åœ¨ä»£ç ä¸­å¯ç”¨è¿‡æ»¤å™¨**
```java
// å¼€å¯è¿‡æ»¤å™¨
Session session = sessionFactory.openSession();
Filter filter = session.enableFilter("activeFilter");  // å¯ç”¨è¿‡æ»¤å™¨
filter.setParameter("status", 1);  // è®¾ç½®å‚æ•°å€¼

// æŸ¥è¯¢æ•°æ®ï¼ˆè‡ªåŠ¨åº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼‰
List<User> users = session.createQuery("FROM User").list();
// å®é™…æ‰§è¡Œï¼šSELECT * FROM users WHERE status = 1

session.close();
```

**å…³é”®ç‚¹ç†è§£**ï¼š
- `enableFilter()`ï¼šæ‰“å¼€è¿‡æ»¤å™¨å¼€å…³
- `setParameter()`ï¼šè®¾ç½®è¿‡æ»¤æ¡ä»¶çš„å€¼
- è¿‡æ»¤å™¨åªåœ¨å½“å‰Sessionæœ‰æ•ˆï¼ŒSessionå…³é—­åå¤±æ•ˆ

### 2.3 å¤šä¸ªè¿‡æ»¤å™¨ç»„åˆä½¿ç”¨


```java
@Entity
@FilterDef(name = "statusFilter", 
    parameters = @ParamDef(name = "status", type = Integer.class))
@FilterDef(name = "dateFilter",
    parameters = @ParamDef(name = "startDate", type = Date.class))
@Filter(name = "statusFilter", condition = "status = :status")
@Filter(name = "dateFilter", condition = "create_time >= :startDate")
public class Order {
    @Id
    private Long id;
    private Integer status;
    private Date createTime;
}

// ä½¿ç”¨æ—¶å¯ä»¥åŒæ—¶å¯ç”¨å¤šä¸ª
session.enableFilter("statusFilter").setParameter("status", 1);
session.enableFilter("dateFilter").setParameter("startDate", new Date());
// ä¸¤ä¸ªæ¡ä»¶ä¼šåŒæ—¶ç”Ÿæ•ˆï¼ˆANDå…³ç³»ï¼‰
```

---

## 3. ğŸ“ @FilterDefè¿‡æ»¤å™¨å®šä¹‰


### 3.1 è¿‡æ»¤å™¨å®šä¹‰çš„æ ¸å¿ƒè¦ç´ 


**@FilterDefå®Œæ•´ç»“æ„**ï¼š
```java
@FilterDef(
    name = "filterName",              // è¿‡æ»¤å™¨åç§°ï¼ˆå¿…å¡«ï¼‰
    defaultCondition = "status = 1",  // é»˜è®¤æ¡ä»¶ï¼ˆå¯é€‰ï¼‰
    parameters = {                     // å‚æ•°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
        @ParamDef(name = "param1", type = String.class),
        @ParamDef(name = "param2", type = Integer.class)
    }
)
```

**ğŸ”¸ å‚æ•°è¯´æ˜**

| å‚æ•° | ä½œç”¨ | å¿…å¡« | ç¤ºä¾‹ |
|------|------|------|------|
| `name` | è¿‡æ»¤å™¨çš„å”¯ä¸€æ ‡è¯† | âœ… | "activeFilter" |
| `defaultCondition` | é»˜è®¤è¿‡æ»¤æ¡ä»¶ | âŒ | "status = 1" |
| `parameters` | åŠ¨æ€å‚æ•°å®šä¹‰ | âŒ | çŠ¶æ€ã€æ—¥æœŸç­‰ |

### 3.2 å®šä¹‰ä½ç½®çš„é€‰æ‹©


**ä½ç½®1ï¼šå®ä½“ç±»ä¸Š**ï¼ˆæ¨èï¼‰
```java
@Entity
@FilterDef(name = "myFilter")  // å®šä¹‰åœ¨å®ä½“ç±»
@Filter(name = "myFilter", condition = "...")
public class User { }
```

**ä½ç½®2ï¼špackage-info.java**ï¼ˆå…¨å±€å®šä¹‰ï¼‰
```java
@FilterDef(
    name = "tenantFilter",
    parameters = @ParamDef(name = "tenantId", type = Long.class)
)
package com.example.entity;

import org.hibernate.annotations.*;
```

**ğŸ’¡ é€‰æ‹©å»ºè®®**ï¼š
- å•ä¸ªå®ä½“ç”¨ â†’ å®šä¹‰åœ¨å®ä½“ç±»ä¸Š
- å¤šä¸ªå®ä½“å…±ç”¨ â†’ å®šä¹‰åœ¨package-info.java

### 3.3 å‚æ•°ç±»å‹æ”¯æŒ


```java
@FilterDef(
    name = "complexFilter",
    parameters = {
        @ParamDef(name = "stringParam", type = String.class),    // å­—ç¬¦ä¸²
        @ParamDef(name = "intParam", type = Integer.class),      // æ•´æ•°
        @ParamDef(name = "longParam", type = Long.class),        // é•¿æ•´æ•°
        @ParamDef(name = "dateParam", type = Date.class),        // æ—¥æœŸ
        @ParamDef(name = "boolParam", type = Boolean.class)      // å¸ƒå°”å€¼
    }
)
```

**å¸¸ç”¨ç±»å‹å¯¹ç…§**ï¼š
- `String.class` â†’ SQLçš„VARCHAR
- `Integer.class` â†’ SQLçš„INT
- `Date.class` â†’ SQLçš„TIMESTAMP
- `Boolean.class` â†’ SQLçš„BOOLEAN/TINYINT

---

## 4. âš¡ åŠ¨æ€æ•°æ®è¿‡æ»¤å®æˆ˜


### 4.1 ä»€ä¹ˆæ˜¯åŠ¨æ€è¿‡æ»¤


**é€šä¿—è§£é‡Š**ï¼šåŠ¨æ€è¿‡æ»¤å°±åƒå¯ä»¥éšæ—¶è°ƒèŠ‚çš„æ°´é¾™å¤´ï¼Œä½ æƒ³å¼€å°±å¼€ï¼Œæƒ³å…³å°±å…³ï¼Œè¿˜èƒ½è°ƒèŠ‚æ°´æµå¤§å°ï¼ˆå‚æ•°ï¼‰ã€‚

```
é™æ€æŸ¥è¯¢ï¼ˆå†™æ­»çš„æ¡ä»¶ï¼‰ï¼š
SELECT * FROM users WHERE status = 1  â† æ¡ä»¶å›ºå®š

åŠ¨æ€è¿‡æ»¤ï¼ˆå¯å˜çš„æ¡ä»¶ï¼‰ï¼š
å¼€å¯è¿‡æ»¤å™¨ â†’ æŸ¥è¯¢åº”ç”¨æ¡ä»¶
å…³é—­è¿‡æ»¤å™¨ â†’ æŸ¥è¯¢ä¸åº”ç”¨æ¡ä»¶
æ”¹å˜å‚æ•° â†’ æ¡ä»¶å€¼å˜åŒ–
```

### 4.2 åŠ¨æ€å¯ç”¨ä¸ç¦ç”¨


**ğŸ”¸ è¿‡æ»¤å™¨æ§åˆ¶æµç¨‹**
```
Sessionç”Ÿå‘½å‘¨æœŸï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ‰“å¼€Session                       â”‚
â”‚ 2. enableFilter("xxx") - å¯ç”¨è¿‡æ»¤å™¨   â”‚
â”‚ 3. æ‰§è¡ŒæŸ¥è¯¢ï¼ˆè‡ªåŠ¨åº”ç”¨è¿‡æ»¤ï¼‰           â”‚
â”‚ 4. disableFilter("xxx") - ç¦ç”¨è¿‡æ»¤å™¨ â”‚
â”‚ 5. æ‰§è¡ŒæŸ¥è¯¢ï¼ˆä¸åº”ç”¨è¿‡æ»¤ï¼‰             â”‚
â”‚ 6. å…³é—­Session                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç ç¤ºä¾‹**
```java
Session session = sessionFactory.openSession();

// åœºæ™¯1ï¼šéœ€è¦è¿‡æ»¤æ—¶
session.enableFilter("activeFilter").setParameter("status", 1);
List<User> activeUsers = session.createQuery("FROM User").list();
// åªæŸ¥å‡ºstatus=1çš„ç”¨æˆ·

// åœºæ™¯2ï¼šéœ€è¦æŸ¥å…¨éƒ¨æ•°æ®æ—¶
session.disableFilter("activeFilter");
List<User> allUsers = session.createQuery("FROM User").list();
// æŸ¥å‡ºæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬å·²åˆ é™¤çš„

session.close();
```

### 4.3 å®æˆ˜æ¡ˆä¾‹ï¼šè®¢å•çŠ¶æ€è¿‡æ»¤


**ä¸šåŠ¡åœºæ™¯**ï¼šç”µå•†ç³»ç»Ÿä¸­ï¼Œå‰å°åªæ˜¾ç¤ºæœ‰æ•ˆè®¢å•ï¼Œåå°å¯ä»¥çœ‹åˆ°æ‰€æœ‰è®¢å•ã€‚

**å®ä½“å®šä¹‰**
```java
@Entity
@Table(name = "orders")
@FilterDef(
    name = "orderStatusFilter",
    parameters = @ParamDef(name = "statusList", type = String.class)
)
@Filter(
    name = "orderStatusFilter",
    condition = "status IN (:statusList)"  // æ”¯æŒå¤šçŠ¶æ€
)
public class Order {
    @Id
    private Long id;
    private String orderNo;
    private Integer status;  // 0-å–æ¶ˆ 1-å¾…ä»˜æ¬¾ 2-å·²ä»˜æ¬¾ 3-å·²å‘è´§
}
```

**å‰å°æŸ¥è¯¢**ï¼ˆåªçœ‹æœ‰æ•ˆè®¢å•ï¼‰
```java
public List<Order> getValidOrders() {
    Session session = sessionFactory.openSession();
    
    // è¿‡æ»¤æ¡ä»¶ï¼šåªçœ‹å¾…ä»˜æ¬¾ã€å·²ä»˜æ¬¾ã€å·²å‘è´§çš„è®¢å•
    session.enableFilter("orderStatusFilter")
           .setParameter("statusList", "1,2,3");
    
    List<Order> orders = session.createQuery("FROM Order").list();
    session.close();
    return orders;
}
```

**åå°æŸ¥è¯¢**ï¼ˆçœ‹æ‰€æœ‰è®¢å•ï¼‰
```java
public List<Order> getAllOrders() {
    Session session = sessionFactory.openSession();
    // ä¸å¯ç”¨è¿‡æ»¤å™¨ï¼ŒæŸ¥è¯¢å…¨éƒ¨
    List<Order> orders = session.createQuery("FROM Order").list();
    session.close();
    return orders;
}
```

---

## 5. ğŸ›ï¸ æ¡ä»¶è¿‡æ»¤åº”ç”¨


### 5.1 å¤æ‚æ¡ä»¶è¿‡æ»¤


**ğŸ”¸ å¤šæ¡ä»¶ç»„åˆ**
```java
@Entity
@FilterDef(
    name = "advancedFilter",
    parameters = {
        @ParamDef(name = "minPrice", type = BigDecimal.class),
        @ParamDef(name = "maxPrice", type = BigDecimal.class),
        @ParamDef(name = "category", type = String.class)
    }
)
@Filter(
    name = "advancedFilter",
    condition = "price BETWEEN :minPrice AND :maxPrice AND category = :category"
)
public class Product {
    @Id
    private Long id;
    private String name;
    private BigDecimal price;
    private String category;
}
```

**ä½¿ç”¨ç¤ºä¾‹**
```java
// æŸ¥è¯¢100-500å…ƒçš„ç”µå­äº§å“
session.enableFilter("advancedFilter")
       .setParameter("minPrice", new BigDecimal("100"))
       .setParameter("maxPrice", new BigDecimal("500"))
       .setParameter("category", "ç”µå­äº§å“");

List<Product> products = session.createQuery("FROM Product").list();
```

### 5.2 å…³è”å®ä½“è¿‡æ»¤


**åœºæ™¯**ï¼šç”¨æˆ·å’Œè®¢å•æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼ŒæŸ¥è¯¢ç”¨æˆ·æ—¶åªæƒ³çœ‹åˆ°ä»–çš„æœ‰æ•ˆè®¢å•ã€‚

```java
@Entity
public class User {
    @Id
    private Long id;
    
    @OneToMany(mappedBy = "user")
    @Filter(
        name = "validOrdersOnly",
        condition = "status != 0"  // åœ¨å…³è”é›†åˆä¸Šä¹Ÿåº”ç”¨è¿‡æ»¤
    )
    private Set<Order> orders;
}

@Entity
@FilterDef(name = "validOrdersOnly")
public class Order {
    @Id
    private Long id;
    private Integer status;
    
    @ManyToOne
    private User user;
}
```

**æŸ¥è¯¢æ•ˆæœ**
```java
session.enableFilter("validOrdersOnly");
User user = session.get(User.class, 1L);
// user.getOrders() åªåŒ…å«status != 0çš„è®¢å•
```

### 5.3 æ—¶é—´èŒƒå›´è¿‡æ»¤


**å®æˆ˜ï¼šæŸ¥è¯¢æœ€è¿‘30å¤©çš„æ•°æ®**
```java
@Entity
@FilterDef(
    name = "recentDataFilter",
    parameters = @ParamDef(name = "days", type = Integer.class)
)
@Filter(
    name = "recentDataFilter",
    condition = "create_time >= DATE_SUB(NOW(), INTERVAL :days DAY)"
)
public class Article {
    @Id
    private Long id;
    private String title;
    private Date createTime;
}

// ä½¿ç”¨
session.enableFilter("recentDataFilter").setParameter("days", 30);
List<Article> recentArticles = session.createQuery("FROM Article").list();
```

---

## 6. ğŸ‘¥ å¤šç§Ÿæˆ·æ”¯æŒæ–¹æ¡ˆ


### 6.1 å¤šç§Ÿæˆ·æ¦‚å¿µç†è§£


**é€šä¿—è§£é‡Š**ï¼šå°±åƒä¸€æ ‹å…¬å¯“æ¥¼ï¼Œæ¯æˆ·äººå®¶ï¼ˆç§Ÿæˆ·ï¼‰åªèƒ½çœ‹åˆ°å’Œæ“ä½œè‡ªå·±å®¶çš„ä¸œè¥¿ï¼Œçœ‹ä¸åˆ°åˆ«äººå®¶çš„ã€‚

```
å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§Ÿæˆ·A (tenantId=1)              â”‚
â”‚  â”œâ”€ ç”¨æˆ·æ•°æ®                     â”‚
â”‚  â”œâ”€ è®¢å•æ•°æ®     [åªèƒ½è®¿é—®è‡ªå·±çš„] â”‚
â”‚  â””â”€ äº§å“æ•°æ®                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç§Ÿæˆ·B (tenantId=2)              â”‚
â”‚  â”œâ”€ ç”¨æˆ·æ•°æ®                     â”‚
â”‚  â”œâ”€ è®¢å•æ•°æ®     [äº’ä¸å¹²æ‰°]      â”‚
â”‚  â””â”€ äº§å“æ•°æ®                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 åŸºäºè¿‡æ»¤å™¨çš„å¤šç§Ÿæˆ·å®ç°


**ğŸ”¸ æ•°æ®è¡¨è®¾è®¡**
```sql
-- æ¯å¼ è¡¨éƒ½åŠ ä¸Šç§Ÿæˆ·IDå­—æ®µ
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    name VARCHAR(50),
    tenant_id BIGINT,  -- ç§Ÿæˆ·æ ‡è¯†
    ...
);

CREATE TABLE orders (
    id BIGINT PRIMARY KEY,
    order_no VARCHAR(50),
    tenant_id BIGINT,  -- ç§Ÿæˆ·æ ‡è¯†
    ...
);
```

**ğŸ”¸ å®ä½“ç±»å®šä¹‰**
```java
// å®šä¹‰å…¨å±€ç§Ÿæˆ·è¿‡æ»¤å™¨ï¼ˆåœ¨package-info.javaä¸­ï¼‰
@FilterDef(
    name = "tenantFilter",
    parameters = @ParamDef(name = "tenantId", type = Long.class),
    defaultCondition = "tenant_id = :tenantId"
)
package com.example.entity;

// åœ¨æ¯ä¸ªéœ€è¦éš”ç¦»çš„å®ä½“ä¸Šåº”ç”¨
@Entity
@Filter(name = "tenantFilter", condition = "tenant_id = :tenantId")
public class User {
    @Id
    private Long id;
    private String name;
    
    @Column(name = "tenant_id")
    private Long tenantId;
}

@Entity
@Filter(name = "tenantFilter", condition = "tenant_id = :tenantId")
public class Order {
    @Id
    private Long id;
    private String orderNo;
    
    @Column(name = "tenant_id")
    private Long tenantId;
}
```

### 6.3 å¤šç§Ÿæˆ·æ‹¦æˆªå™¨è‡ªåŠ¨è®¾ç½®


**å®ç°æ€è·¯**ï¼šç”¨æˆ·ç™»å½•åï¼Œè‡ªåŠ¨åœ¨æ‰€æœ‰æ•°æ®åº“æ“ä½œä¸­æ·»åŠ ç§Ÿæˆ·è¿‡æ»¤ã€‚

```java
// 1. ä¿å­˜å½“å‰ç§Ÿæˆ·ä¿¡æ¯
public class TenantContext {
    private static ThreadLocal<Long> currentTenantId = new ThreadLocal<>();
    
    public static void setTenantId(Long tenantId) {
        currentTenantId.set(tenantId);
    }
    
    public static Long getTenantId() {
        return currentTenantId.get();
    }
    
    public static void clear() {
        currentTenantId.remove();
    }
}

// 2. Hibernateæ‹¦æˆªå™¨è‡ªåŠ¨å¯ç”¨è¿‡æ»¤å™¨
public class TenantInterceptor extends EmptyInterceptor {
    @Override
    public String onPrepareStatement(String sql) {
        Long tenantId = TenantContext.getTenantId();
        if (tenantId != null) {
            Session session = // è·å–å½“å‰session
            session.enableFilter("tenantFilter")
                   .setParameter("tenantId", tenantId);
        }
        return sql;
    }
}

// 3. ç”¨æˆ·ç™»å½•æ—¶è®¾ç½®ç§Ÿæˆ·
public void userLogin(Long userId) {
    User user = userService.findById(userId);
    TenantContext.setTenantId(user.getTenantId());  // è®¾ç½®ç§Ÿæˆ·ID
    
    // ä¹‹åæ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šè‡ªåŠ¨è¿‡æ»¤
    List<Order> orders = orderService.findAll();  // åªæŸ¥å½“å‰ç§Ÿæˆ·çš„è®¢å•
}
```

**ğŸ’¡ ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨éš”ç¦»ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†
- âœ… å®‰å…¨æ€§é«˜ï¼Œä¸ä¼šè¯¯æŸ¥å…¶ä»–ç§Ÿæˆ·æ•°æ®
- âœ… ä»£ç ç®€æ´ï¼Œä¸šåŠ¡é€»è¾‘ä¸ç”¨å…³å¿ƒç§Ÿæˆ·

---

## 7. ğŸ—‘ï¸ è½¯åˆ é™¤å®ç°


### 7.1 è½¯åˆ é™¤æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯è½¯åˆ é™¤**ï¼šä¸æ˜¯çœŸçš„ä»æ•°æ®åº“åˆ é™¤è®°å½•ï¼Œè€Œæ˜¯æ ‡è®°ä¸º"å·²åˆ é™¤"çŠ¶æ€ï¼Œæ•°æ®è¿˜åœ¨ï¼Œåªæ˜¯ä¸æ˜¾ç¤ºã€‚

```
ç¡¬åˆ é™¤ï¼ˆç‰©ç†åˆ é™¤ï¼‰ï¼š
DELETE FROM users WHERE id = 1;  â† æ•°æ®çœŸçš„æ²¡äº†

è½¯åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰ï¼š
UPDATE users SET deleted = 1 WHERE id = 1;  â† æ•°æ®è¿˜åœ¨ï¼Œåªæ˜¯æ‰“æ ‡è®°
```

**ä¸ºä»€ä¹ˆè¦è½¯åˆ é™¤**ï¼š
- ğŸ”¸ æ•°æ®æ¢å¤ï¼šè¯¯åˆ å¯ä»¥æ¢å¤
- ğŸ”¸ å®¡è®¡è¿½æº¯ï¼šçŸ¥é“è°åˆ äº†ä»€ä¹ˆ
- ğŸ”¸ æ•°æ®åˆ†æï¼šå·²åˆ é™¤çš„æ•°æ®ä¹Ÿæœ‰ä»·å€¼
- ğŸ”¸ å…³è”æ•°æ®ï¼šé¿å…å¤–é”®é—®é¢˜

### 7.2 åŸºäºè¿‡æ»¤å™¨çš„è½¯åˆ é™¤


**ğŸ”¸ å®ä½“å®šä¹‰**
```java
@Entity
@Table(name = "users")
@FilterDef(
    name = "notDeletedFilter",
    defaultCondition = "deleted = false"  // é»˜è®¤ä¸æŸ¥å·²åˆ é™¤çš„
)
@Filter(name = "notDeletedFilter", condition = "deleted = false")
@SQLDelete(sql = "UPDATE users SET deleted = true WHERE id = ?")  // åˆ é™¤æ”¹ä¸ºæ›´æ–°
public class User {
    @Id
    private Long id;
    private String name;
    
    @Column(name = "deleted")
    private Boolean deleted = false;  // é»˜è®¤æœªåˆ é™¤
}
```

**ğŸ”¸ å…³é”®æ³¨è§£è¯´æ˜**

| æ³¨è§£ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `@SQLDelete` | è‡ªå®šä¹‰åˆ é™¤SQL | UPDATEè€Œä¸æ˜¯DELETE |
| `@Where` | é™æ€è¿‡æ»¤æ¡ä»¶ | deleted = false |
| `@Filter` | åŠ¨æ€è¿‡æ»¤æ¡ä»¶ | å¯å¼€å…³çš„deletedè¿‡æ»¤ |

### 7.3 è½¯åˆ é™¤å®Œæ•´æ–¹æ¡ˆ


**ä¸šåŠ¡ä»£ç **
```java
@Service
public class UserService {
    
    // è½¯åˆ é™¤
    public void deleteUser(Long userId) {
        Session session = sessionFactory.openSession();
        Transaction tx = session.beginTransaction();
        
        User user = session.get(User.class, userId);
        session.delete(user);  // å®é™…æ‰§è¡ŒUPDATE users SET deleted=true
        
        tx.commit();
        session.close();
    }
    
    // æŸ¥è¯¢æœªåˆ é™¤çš„ç”¨æˆ·
    public List<User> getActiveUsers() {
        Session session = sessionFactory.openSession();
        session.enableFilter("notDeletedFilter");  // å¯ç”¨è¿‡æ»¤å™¨
        
        List<User> users = session.createQuery("FROM User").list();
        // åªæŸ¥deleted=falseçš„è®°å½•
        
        session.close();
        return users;
    }
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼ˆåŒ…æ‹¬å·²åˆ é™¤ï¼‰
    public List<User> getAllUsers() {
        Session session = sessionFactory.openSession();
        // ä¸å¯ç”¨è¿‡æ»¤å™¨ï¼ŒæŸ¥æ‰€æœ‰
        List<User> users = session.createQuery("FROM User").list();
        
        session.close();
        return users;
    }
    
    // æ¢å¤å·²åˆ é™¤çš„ç”¨æˆ·
    public void restoreUser(Long userId) {
        Session session = sessionFactory.openSession();
        Transaction tx = session.beginTransaction();
        
        // ä¸å¯ç”¨è¿‡æ»¤å™¨ï¼Œèƒ½æŸ¥åˆ°å·²åˆ é™¤çš„
        User user = session.get(User.class, userId);
        user.setDeleted(false);  // æ ‡è®°ä¸ºæœªåˆ é™¤
        session.update(user);
        
        tx.commit();
        session.close();
    }
}
```

**æ•°æ®çŠ¶æ€å˜åŒ–**
```
åˆå§‹çŠ¶æ€ï¼š
id | name  | deleted
1  | å¼ ä¸‰  | false
2  | æå››  | false

æ‰§è¡ŒdeleteUser(1)åï¼š
id | name  | deleted
1  | å¼ ä¸‰  | true    â† æ ‡è®°ä¸ºå·²åˆ é™¤
2  | æå››  | false

getActiveUsers()ç»“æœï¼š
åªè¿”å› {id:2, name:æå››}  â† è¿‡æ»¤å™¨èµ·ä½œç”¨

getAllUsers()ç»“æœï¼š
è¿”å›ä¸¤æ¡è®°å½•  â† æ²¡æœ‰è¿‡æ»¤å™¨
```

---

## 8. ğŸ” æƒé™æ§åˆ¶å®è·µ


### 8.1 åŸºäºè§’è‰²çš„æ•°æ®è¿‡æ»¤


**ä¸šåŠ¡åœºæ™¯**ï¼šä¸åŒè§’è‰²çœ‹åˆ°ä¸åŒèŒƒå›´çš„æ•°æ®ã€‚

```
æ•°æ®å¯è§æ€§è§„åˆ™ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¶…çº§ç®¡ç†å‘˜ï¼šçœ‹æ‰€æœ‰æ•°æ®        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  éƒ¨é—¨ç»ç†ï¼šçœ‹æœ¬éƒ¨é—¨æ•°æ®        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ™®é€šå‘˜å·¥ï¼šçœ‹è‡ªå·±çš„æ•°æ®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ å®ä½“å®šä¹‰**
```java
@Entity
@Table(name = "documents")
@FilterDef(
    name = "departmentFilter",
    parameters = @ParamDef(name = "deptId", type = Long.class)
)
@FilterDef(
    name = "ownerFilter",
    parameters = @ParamDef(name = "userId", type = Long.class)
)
@Filter(name = "departmentFilter", condition = "department_id = :deptId")
@Filter(name = "ownerFilter", condition = "owner_id = :userId")
public class Document {
    @Id
    private Long id;
    private String title;
    private Long departmentId;
    private Long ownerId;
}
```

### 8.2 æƒé™è¿‡æ»¤æœåŠ¡


```java
@Service
public class DocumentService {
    
    public List<Document> getDocuments(User currentUser) {
        Session session = sessionFactory.openSession();
        
        // æ ¹æ®è§’è‰²å¯ç”¨ä¸åŒè¿‡æ»¤å™¨
        if (currentUser.getRole().equals("ADMIN")) {
            // ç®¡ç†å‘˜ä¸å¯ç”¨è¿‡æ»¤å™¨ï¼Œçœ‹æ‰€æœ‰æ•°æ®
        } else if (currentUser.getRole().equals("MANAGER")) {
            // ç»ç†å¯ç”¨éƒ¨é—¨è¿‡æ»¤å™¨
            session.enableFilter("departmentFilter")
                   .setParameter("deptId", currentUser.getDepartmentId());
        } else {
            // æ™®é€šå‘˜å·¥å¯ç”¨ä¸ªäººè¿‡æ»¤å™¨
            session.enableFilter("ownerFilter")
                   .setParameter("userId", currentUser.getId());
        }
        
        List<Document> docs = session.createQuery("FROM Document").list();
        session.close();
        return docs;
    }
}
```

### 8.3 æ•°æ®æƒé™æ‹¦æˆªå™¨


**å…¨å±€æƒé™æ§åˆ¶**
```java
@Component
public class DataPermissionInterceptor extends EmptyInterceptor {
    
    @Override
    public String onPrepareStatement(String sql) {
        User currentUser = getCurrentUser();  // ä»ä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·
        Session session = getSession();
        
        // è‡ªåŠ¨æ ¹æ®ç”¨æˆ·è§’è‰²å¯ç”¨è¿‡æ»¤å™¨
        switch (currentUser.getRole()) {
            case "ADMIN":
                // ç®¡ç†å‘˜ä¸è¿‡æ»¤
                break;
            case "MANAGER":
                session.enableFilter("departmentFilter")
                       .setParameter("deptId", currentUser.getDepartmentId());
                break;
            default:
                session.enableFilter("ownerFilter")
                       .setParameter("userId", currentUser.getId());
        }
        
        return sql;
    }
}
```

**ğŸ’¡ ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨æƒé™æ§åˆ¶ï¼Œä¸šåŠ¡ä»£ç æ— éœ€å…³å¿ƒ
- âœ… ç»Ÿä¸€ç®¡ç†ï¼Œä¸ä¼šé—æ¼
- âœ… çµæ´»é…ç½®ï¼Œæ˜“äºæ‰©å±•

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 è¿‡æ»¤å™¨æœºåˆ¶æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿‡æ»¤å™¨æœ¬è´¨ï¼šè‡ªåŠ¨ç»™æŸ¥è¯¢æ·»åŠ WHEREæ¡ä»¶çš„æœºåˆ¶
ğŸ”¸ @FilterDefï¼šå®šä¹‰è¿‡æ»¤å™¨è§„åˆ™ï¼ˆåœ¨å“ªä¸ªå®ä½“ï¼Œä»€ä¹ˆæ¡ä»¶ï¼‰
ğŸ”¸ @Filterï¼šåº”ç”¨è¿‡æ»¤å™¨ï¼ˆæŠŠè§„åˆ™ç”¨åˆ°å®ä½“ä¸Šï¼‰
ğŸ”¸ åŠ¨æ€æ§åˆ¶ï¼šå¯ä»¥éšæ—¶å¯ç”¨/ç¦ç”¨è¿‡æ»¤å™¨
ğŸ”¸ å‚æ•°åŒ–ï¼šæ”¯æŒä¼ å…¥å‚æ•°å®ç°çµæ´»è¿‡æ»¤
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¿‡æ»¤å™¨çš„å·¥ä½œåŸç†**
```
æŸ¥è¯¢æµç¨‹ï¼š
1. åˆ›å»ºæŸ¥è¯¢ï¼ˆFROM Userï¼‰
2. æ£€æŸ¥æ˜¯å¦å¯ç”¨è¿‡æ»¤å™¨
3. æœ‰è¿‡æ»¤å™¨ â†’ è‡ªåŠ¨æ·»åŠ æ¡ä»¶ï¼ˆWHERE ...ï¼‰
4. æ²¡æœ‰è¿‡æ»¤å™¨ â†’ æ­£å¸¸æ‰§è¡ŒæŸ¥è¯¢

å®é™…SQLå˜åŒ–ï¼š
åŸå§‹HQLï¼šFROM User
å¯ç”¨è¿‡æ»¤å™¨åï¼šFROM User WHERE status = 1
```

**ğŸ”¹ è¿‡æ»¤å™¨ vs @Whereæ³¨è§£**

| å¯¹æ¯”é¡¹ | @Filterè¿‡æ»¤å™¨ | @Whereæ³¨è§£ |
|-------|--------------|-----------|
| **çµæ´»æ€§** | å¯åŠ¨æ€å¼€å…³ | å›ºå®šæ¡ä»¶ï¼Œä¸èƒ½å…³ |
| **å‚æ•°** | æ”¯æŒå‚æ•°åŒ– | ä¸æ”¯æŒå‚æ•° |
| **ä½¿ç”¨åœºæ™¯** | éœ€è¦åŠ¨æ€æ§åˆ¶çš„åœºæ™¯ | æ°¸ä¹…å›ºå®šçš„è¿‡æ»¤æ¡ä»¶ |
| **ç¤ºä¾‹** | è½¯åˆ é™¤ï¼ˆå¯æŸ¥å·²åˆ é™¤ï¼‰ | æ°¸ä¹…è¿‡æ»¤å·²åˆ é™¤æ•°æ® |

**ğŸ”¹ è¿‡æ»¤å™¨çš„ä½œç”¨èŒƒå›´**
```
Sessionçº§åˆ«ï¼š
- è¿‡æ»¤å™¨åœ¨enableFilter()æ—¶ç”Ÿæ•ˆ
- åªå¯¹å½“å‰Sessionæœ‰æ•ˆ
- Sessionå…³é—­åå¤±æ•ˆ
- ä¸å½±å“å…¶ä»–Session

æŸ¥è¯¢èŒƒå›´ï¼š
- HQLæŸ¥è¯¢ï¼šè‡ªåŠ¨åº”ç”¨
- CriteriaæŸ¥è¯¢ï¼šè‡ªåŠ¨åº”ç”¨
- SQLæŸ¥è¯¢ï¼šä¸åº”ç”¨ï¼ˆåŸç”ŸSQLä¸èµ°è¿‡æ»¤å™¨ï¼‰
- å…³è”åŠ è½½ï¼šå¯åº”ç”¨åˆ°å…³è”é›†åˆ
```

### 9.3 å®é™…åº”ç”¨æœ€ä½³å®è·µ


**âœ… é€‚ç”¨åœºæ™¯**
- è½¯åˆ é™¤ï¼šdeletedå­—æ®µè¿‡æ»¤
- å¤šç§Ÿæˆ·ï¼štenantIdè‡ªåŠ¨è¿‡æ»¤
- æƒé™æ§åˆ¶ï¼šæ ¹æ®è§’è‰²è¿‡æ»¤æ•°æ®
- æ—¶é—´èŒƒå›´ï¼šåªæŸ¥ç‰¹å®šæ—¶é—´æ®µ
- çŠ¶æ€è¿‡æ»¤ï¼šåªæŸ¥æœ‰æ•ˆæ•°æ®

**âŒ ä¸é€‚ç”¨åœºæ™¯**
- å¤æ‚çš„åŠ¨æ€æŸ¥è¯¢ï¼ˆç”¨Criteriaæ›´å¥½ï¼‰
- åŸç”ŸSQLæŸ¥è¯¢ï¼ˆè¿‡æ»¤å™¨ä¸ç”Ÿæ•ˆï¼‰
- æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯ï¼ˆå¤šä¸€å±‚è¿‡æ»¤é€»è¾‘ï¼‰

**ğŸ”§ ä½¿ç”¨å»ºè®®**

| åœºæ™¯ | å»ºè®®æ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| å›ºå®šæ¡ä»¶ | ç”¨`@Where` | ç®€å•ç›´æ¥ |
| å¯é€‰æ¡ä»¶ | ç”¨`@Filter` | çµæ´»æ§åˆ¶ |
| å…¨å±€è§„åˆ™ | æ‹¦æˆªå™¨+è¿‡æ»¤å™¨ | ç»Ÿä¸€ç®¡ç† |
| å¤æ‚é€»è¾‘ | Criteria API | æ›´å¼ºå¤§ |

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**é—®é¢˜1ï¼šè¿‡æ»¤å™¨ä¸ç”Ÿæ•ˆ**
```java
// âŒ é”™è¯¯ï¼šå¿˜è®°å¯ç”¨è¿‡æ»¤å™¨
List<User> users = session.createQuery("FROM User").list();

// âœ… æ­£ç¡®ï¼šå…ˆå¯ç”¨è¿‡æ»¤å™¨
session.enableFilter("activeFilter").setParameter("status", 1);
List<User> users = session.createQuery("FROM User").list();
```

**é—®é¢˜2ï¼šåŸç”ŸSQLä¸è¿‡æ»¤**
```java
// âŒ åŸç”ŸSQLä¸èµ°è¿‡æ»¤å™¨
session.createNativeQuery("SELECT * FROM users").list();

// âœ… ç”¨HQLæ‰èƒ½åº”ç”¨è¿‡æ»¤å™¨
session.createQuery("FROM User").list();
```

**é—®é¢˜3ï¼šå…³è”æ•°æ®æ²¡æœ‰è¿‡æ»¤**
```java
// éœ€è¦åœ¨å…³è”é›†åˆä¸Šä¹Ÿåº”ç”¨è¿‡æ»¤å™¨
@OneToMany
@Filter(name = "activeFilter", condition = "status = 1")
private Set<Order> orders;
```

### 9.5 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ğŸ”¸ ç´¢å¼•ä¼˜åŒ–**
```sql
-- ä¸ºè¿‡æ»¤å­—æ®µå»ºç´¢å¼•
CREATE INDEX idx_status ON users(status);
CREATE INDEX idx_tenant ON users(tenant_id);
CREATE INDEX idx_deleted ON users(deleted);
```

**ğŸ”¸ è¿‡æ»¤å™¨å¤ç”¨**
```java
// å®šä¹‰å¸¸ç”¨è¿‡æ»¤å™¨ï¼Œå¤šä¸ªå®ä½“å…±ç”¨
@FilterDef(name = "commonActiveFilter", ...)  // åœ¨package-info.java

@Entity
@Filter(name = "commonActiveFilter", ...)
public class User {}

@Entity
@Filter(name = "commonActiveFilter", ...)
public class Order {}
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
è¿‡æ»¤å™¨æœºåˆ¶ä¼¼çœ¼é•œï¼Œæˆ´ä¸Šåªçœ‹æƒ³çœ‹çš„
å®šä¹‰è§„åˆ™ç”¨FilterDefï¼Œåº”ç”¨è§„åˆ™ç”¨Filter
åŠ¨æ€å¼€å…³éšå¿ƒæ§ï¼Œå‚æ•°çµæ´»æ¡ä»¶æ´»
å¤šç§Ÿæˆ·ã€è½¯åˆ é™¤ã€æƒé™æ§ï¼Œæ ·æ ·ç²¾é€šæ•ˆç‡é«˜
```