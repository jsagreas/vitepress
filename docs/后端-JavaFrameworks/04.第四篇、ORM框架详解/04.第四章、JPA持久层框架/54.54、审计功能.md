---
title: 54ã€å®¡è®¡åŠŸèƒ½
---
## ğŸ“š ç›®å½•

1. [å®¡è®¡åŠŸèƒ½æ˜¯ä»€ä¹ˆ](#1-å®¡è®¡åŠŸèƒ½æ˜¯ä»€ä¹ˆ)
2. [ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡åŠŸèƒ½](#2-ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡åŠŸèƒ½)
3. [åŸºç¡€å®¡è®¡é…ç½®](#3-åŸºç¡€å®¡è®¡é…ç½®)
4. [æ—¶é—´å®¡è®¡](#4-æ—¶é—´å®¡è®¡)
5. [ç”¨æˆ·å®¡è®¡](#5-ç”¨æˆ·å®¡è®¡)
6. [å®Œæ•´å®¡è®¡å®æˆ˜](#6-å®Œæ•´å®¡è®¡å®æˆ˜)
7. [å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ](#7-å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” å®¡è®¡åŠŸèƒ½æ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£å®¡è®¡


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
å°±åƒä½ åœ¨ç¬”è®°æœ¬ä¸Šè®°å½•ï¼š
- è¿™ç¯‡æ—¥è®°æ˜¯ä»€ä¹ˆæ—¶å€™å†™çš„ï¼Ÿ        â†’ åˆ›å»ºæ—¶é—´
- è¿™ç¯‡æ—¥è®°æœ€åä¿®æ”¹æ—¶é—´ï¼Ÿ          â†’ ä¿®æ”¹æ—¶é—´
- è¿™ç¯‡æ—¥è®°æ˜¯è°å†™çš„ï¼Ÿ              â†’ åˆ›å»ºäºº
- æœ€åæ˜¯è°ä¿®æ”¹çš„ï¼Ÿ                â†’ ä¿®æ”¹äºº

æ•°æ®åº“å®¡è®¡å°±æ˜¯è‡ªåŠ¨å¸®ä½ è®°å½•è¿™äº›ä¿¡æ¯ï¼
```

**æœ¬è´¨**ï¼šå®¡è®¡ï¼ˆAuditï¼‰å°±æ˜¯**è‡ªåŠ¨è¿½è¸ªè®°å½•æ•°æ®çš„å˜åŒ–å†å²**ï¼Œè®©ä½ çŸ¥é“ï¼š
- ğŸ“… **ä»€ä¹ˆæ—¶å€™**ï¼šæ•°æ®ä½•æ—¶è¢«åˆ›å»ºã€ä¿®æ”¹
- ğŸ‘¤ **è°æ“ä½œçš„**ï¼šæ˜¯å“ªä¸ªç”¨æˆ·åˆ›å»ºã€ä¿®æ”¹çš„
- ğŸ” **åšäº†ä»€ä¹ˆ**ï¼šæ–¹ä¾¿åç»­è¿½è¸ªå’Œé—®è´£

### 1.2 JPAå®¡è®¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å®¡è®¡å°±æ˜¯è‡ªåŠ¨å¡«å……**

ä¼ ç»Ÿæ–¹å¼æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨å†™ï¼š
```java
// âŒ ä¼ ç»Ÿåšæ³•ï¼šæ¯æ¬¡ä¿å­˜éƒ½è¦æ‰‹åŠ¨è®¾ç½®
user.setCreateTime(new Date());
user.setCreateBy("admin");
userRepository.save(user);

// æ›´æ–°æ—¶åˆè¦æ‰‹åŠ¨è®¾ç½®
user.setUpdateTime(new Date());
user.setUpdateBy("admin");
userRepository.save(user);
```

ä½¿ç”¨JPAå®¡è®¡ï¼š
```java
// âœ… å®¡è®¡æ–¹å¼ï¼šè‡ªåŠ¨å¡«å……ï¼Œä¸ç”¨ç®¡
userRepository.save(user);  
// åˆ›å»ºæ—¶é—´ã€åˆ›å»ºäººã€ä¿®æ”¹æ—¶é—´ã€ä¿®æ”¹äººéƒ½è‡ªåŠ¨å¡«å……å¥½äº†ï¼
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ¨ **è‡ªåŠ¨åŒ–**ï¼šä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®æ—¶é—´å’Œç”¨æˆ·
- âœ¨ **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰å®ä½“ç”¨åŒæ ·çš„æ–¹å¼è®°å½•
- âœ¨ **é˜²æ­¢é—æ¼**ï¼šä¸ä¼šå¿˜è®°è®¾ç½®å®¡è®¡å­—æ®µ

---

## 2. ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡åŠŸèƒ½


### 2.1 å®é™…ä¸šåŠ¡åœºæ™¯


**åœºæ™¯1ï¼šç”µå•†è®¢å•ç³»ç»Ÿ**
```
ç”¨æˆ·æŠ•è¯‰ï¼šæˆ‘æ˜¨å¤©ä¸‹çš„è®¢å•ï¼Œæ€ä¹ˆå˜æˆä»Šå¤©çš„äº†ï¼Ÿ

æ²¡æœ‰å®¡è®¡ï¼š
âŒ ä¸çŸ¥é“è®¢å•ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„
âŒ ä¸çŸ¥é“è°ä¿®æ”¹äº†è®¢å•ä¿¡æ¯
âŒ æ— æ³•è¿½æº¯é—®é¢˜

æœ‰å®¡è®¡ï¼š
âœ… åˆ›å»ºæ—¶é—´ï¼š2024-01-15 10:30:00
âœ… åˆ›å»ºäººï¼šuser123
âœ… æœ€åä¿®æ”¹æ—¶é—´ï¼š2024-01-15 14:20:00
âœ… ä¿®æ”¹äººï¼šadmin
âœ… å¯ä»¥æ¸…æ¥šçœ‹åˆ°è®¢å•è¢«ç®¡ç†å‘˜ä¿®æ”¹è¿‡
```

**åœºæ™¯2ï¼šå†…å®¹ç®¡ç†ç³»ç»Ÿ**
```
æ–‡ç« æ•°æ®ï¼š
- åˆ›å»ºæ—¶é—´ï¼šçŸ¥é“æ–‡ç« å‘å¸ƒæ—¶é—´
- åˆ›å»ºäººï¼šçŸ¥é“è°å†™çš„æ–‡ç« 
- ä¿®æ”¹æ—¶é—´ï¼šçŸ¥é“æ–‡ç« æœ€åæ›´æ–°æ—¶é—´
- ä¿®æ”¹äººï¼šçŸ¥é“è°ä¿®æ”¹äº†æ–‡ç« 

è¿™äº›ä¿¡æ¯å¯¹ç”¨æˆ·å’Œç®¡ç†éƒ½å¾ˆé‡è¦ï¼
```

### 2.2 å®¡è®¡çš„ä»·å€¼


| ä»·å€¼ç‚¹ | **è¯´æ˜** | **å®é™…ç”¨é€”** |
|--------|----------|-------------|
| ğŸ” **è¿½æº¯æ€§** | è¿½è¸ªæ•°æ®å˜åŒ–å†å² | é—®é¢˜æ’æŸ¥ã€å®¡è®¡åˆè§„ |
| ğŸ‘¤ **é—®è´£åˆ¶** | æ˜ç¡®æ“ä½œè´£ä»»äºº | æ•°æ®å®‰å…¨ã€æƒé™ç®¡ç† |
| â° **æ—¶æ•ˆæ€§** | äº†è§£æ•°æ®æ—¶é—´çº¿ | ä¸šåŠ¡åˆ†æã€ç»Ÿè®¡æŠ¥è¡¨ |
| ğŸ›¡ï¸ **å®‰å…¨æ€§** | é˜²æ­¢æ¶æ„ç¯¡æ”¹ | æ—¥å¿—è®°å½•ã€è¯æ®ä¿å­˜ |

---

## 3. âš™ï¸ åŸºç¡€å®¡è®¡é…ç½®


### 3.1 å¼€å¯å®¡è®¡åŠŸèƒ½


**æ­¥éª¤1ï¼šå¯ç”¨JPAå®¡è®¡**

åœ¨å¯åŠ¨ç±»æˆ–é…ç½®ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼š
```java
@SpringBootApplication
@EnableJpaAuditing  // ğŸ‘ˆ å°±è¿™ä¸€è¡Œï¼Œå¼€å¯å®¡è®¡åŠŸèƒ½
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

**ğŸ’¡ ç†è§£**ï¼š
- `@EnableJpaAuditing` å°±åƒæ‰“å¼€ä¸€ä¸ªæ€»å¼€å…³
- æœ‰äº†è¿™ä¸ªæ³¨è§£ï¼ŒSpringæ‰ä¼šå»å¤„ç†å®¡è®¡ç›¸å…³çš„æ³¨è§£
- åªéœ€è¦é…ç½®ä¸€æ¬¡ï¼Œå…¨å±€ç”Ÿæ•ˆ

### 3.2 åˆ›å»ºå®¡è®¡åŸºç±»


**ä¸ºä»€ä¹ˆéœ€è¦åŸºç±»ï¼Ÿ**
```
é—®é¢˜ï¼šæ¯ä¸ªå®ä½“éƒ½å†™ä¸€éå®¡è®¡å­—æ®µå¤ªéº»çƒ¦
è§£å†³ï¼šåˆ›å»ºä¸€ä¸ªåŸºç±»ï¼Œå…¶ä»–å®ä½“ç»§æ‰¿å®ƒ

      BaseEntity
      (å®¡è®¡å­—æ®µ)
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  User      Order
  (ä¸šåŠ¡å­—æ®µ) (ä¸šåŠ¡å­—æ®µ)
```

**åŸºç¡€å®¡è®¡åŸºç±»**ï¼š
```java
@MappedSuperclass  // ğŸ‘ˆ è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªçˆ¶ç±»ï¼Œä¸å¯¹åº”æ•°æ®åº“è¡¨
@EntityListeners(AuditingEntityListener.class)  // ğŸ‘ˆ ç›‘å¬å®¡è®¡äº‹ä»¶
public abstract class BaseEntity {
    
    @CreatedDate  // ğŸ‘ˆ åˆ›å»ºæ—¶é—´è‡ªåŠ¨å¡«å……
    @Column(name = "create_time", nullable = false, updatable = false)
    private LocalDateTime createTime;
    
    @LastModifiedDate  // ğŸ‘ˆ ä¿®æ”¹æ—¶é—´è‡ªåŠ¨å¡«å……
    @Column(name = "update_time", nullable = false)
    private LocalDateTime updateTime;
    
    // getter/setterçœç•¥
}
```

**ğŸ”¸ æ³¨è§£è¯´æ˜**ï¼š

| æ³¨è§£ | **ä½œç”¨** | **ä»€ä¹ˆæ—¶å€™ç”Ÿæ•ˆ** |
|------|----------|-----------------|
| `@MappedSuperclass` | æ ‡è®°ä¸ºJPAçˆ¶ç±» | å­ç±»ç»§æ‰¿å­—æ®µä½†ä¸ç»§æ‰¿è¡¨ |
| `@EntityListeners` | æŒ‡å®šç›‘å¬å™¨ | Springå®¡è®¡ç›‘å¬å™¨å¤„ç† |
| `@CreatedDate` | è‡ªåŠ¨å¡«å……åˆ›å»ºæ—¶é—´ | ç¬¬ä¸€æ¬¡ä¿å­˜æ—¶ |
| `@LastModifiedDate` | è‡ªåŠ¨å¡«å……ä¿®æ”¹æ—¶é—´ | æ¯æ¬¡æ›´æ–°æ—¶ |

---

## 4. â° æ—¶é—´å®¡è®¡


### 4.1 åˆ›å»ºæ—¶é—´ä¸ä¿®æ”¹æ—¶é—´


**å®ä½“ç±»ä½¿ç”¨å®¡è®¡**ï¼š
```java
@Entity
@Table(name = "t_article")
public class Article extends BaseEntity {  // ğŸ‘ˆ ç»§æ‰¿å®¡è®¡åŸºç±»
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String title;
    private String content;
    
    // ä¸éœ€è¦å†™createTimeå’ŒupdateTime
    // å·²ç»ä»BaseEntityç»§æ‰¿äº†ï¼
}
```

**å®é™…è¿è¡Œæ•ˆæœ**ï¼š
```java
// åˆ›å»ºæ–‡ç« 
Article article = new Article();
article.setTitle("Springå­¦ä¹ ç¬”è®°");
article.setContent("ä»Šå¤©å­¦ä¹ äº†JPAå®¡è®¡...");

articleRepository.save(article);
// è‡ªåŠ¨å¡«å……ï¼š
// createTime = 2024-01-15 10:30:00
// updateTime = 2024-01-15 10:30:00

// ä¿®æ”¹æ–‡ç« 
article.setContent("æ›´æ–°å†…å®¹...");
articleRepository.save(article);
// è‡ªåŠ¨æ›´æ–°ï¼š
// createTime = 2024-01-15 10:30:00  (ä¸å˜)
// updateTime = 2024-01-15 14:20:00  (è‡ªåŠ¨æ›´æ–°ä¸ºå½“å‰æ—¶é—´)
```

### 4.2 æ—¶é—´å®¡è®¡çš„å·¥ä½œåŸç†


```
æ•°æ®ä¿å­˜æµç¨‹ï¼š

1. è°ƒç”¨save()æ–¹æ³•
      â†“
2. JPAæ£€æµ‹åˆ°@EntityListeners
      â†“
3. è§¦å‘AuditingEntityListenerç›‘å¬å™¨
      â†“
4. æ£€æŸ¥æ˜¯æ–°å¢è¿˜æ˜¯æ›´æ–°
      â†“
   æ–°å¢ï¼šå¡«å……@CreatedDateå’Œ@LastModifiedDate
   æ›´æ–°ï¼šåªæ›´æ–°@LastModifiedDate
      â†“
5. æ‰§è¡Œæ•°æ®åº“æ“ä½œ
```

**ğŸ”¸ å­—æ®µæ§åˆ¶**ï¼š
```java
@CreatedDate
@Column(updatable = false)  // ğŸ‘ˆ åˆ›å»ºåä¸å¯ä¿®æ”¹
private LocalDateTime createTime;

@LastModifiedDate
@Column(insertable = false)  // ğŸ‘ˆ åˆ›å»ºæ—¶å¯ä»¥ä¸è®¾ç½®ï¼ˆæŸäº›åœºæ™¯ï¼‰
private LocalDateTime updateTime;
```

---

## 5. ğŸ‘¤ ç”¨æˆ·å®¡è®¡


### 5.1 ä»€ä¹ˆæ˜¯ç”¨æˆ·å®¡è®¡


**éœ€æ±‚**ï¼šä¸ä»…è¦çŸ¥é“æ—¶é—´ï¼Œè¿˜è¦çŸ¥é“**æ˜¯è°**æ“ä½œçš„

**ç”Ÿæ´»åœºæ™¯**ï¼š
```
å…¬å¸æ–‡æ¡£ç³»ç»Ÿï¼š
- æ–‡æ¡£åˆ›å»ºè€…ï¼šå¼ ä¸‰
- æœ€åä¿®æ”¹äººï¼šæå››
- è¿™æ ·å¯ä»¥æ‰¾åˆ°è´£ä»»äºº

æ•°æ®åº“åŒç†ï¼š
- è®¢å•åˆ›å»ºäººï¼šuser_001
- è®¢å•ä¿®æ”¹äººï¼šadmin_002
```

### 5.2 æ·»åŠ ç”¨æˆ·å®¡è®¡å­—æ®µ


**å®Œæ•´å®¡è®¡åŸºç±»**ï¼š
```java
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class BaseEntity {
    
    // æ—¶é—´å®¡è®¡
    @CreatedDate
    @Column(name = "create_time", nullable = false, updatable = false)
    private LocalDateTime createTime;
    
    @LastModifiedDate
    @Column(name = "update_time", nullable = false)
    private LocalDateTime updateTime;
    
    // ç”¨æˆ·å®¡è®¡
    @CreatedBy  // ğŸ‘ˆ åˆ›å»ºäººè‡ªåŠ¨å¡«å……
    @Column(name = "create_by", nullable = false, updatable = false)
    private String createBy;
    
    @LastModifiedBy  // ğŸ‘ˆ ä¿®æ”¹äººè‡ªåŠ¨å¡«å……
    @Column(name = "update_by", nullable = false)
    private String updateBy;
    
    // getter/setterçœç•¥
}
```

### 5.3 å®ç°ç”¨æˆ·æä¾›è€…


**é—®é¢˜**ï¼šSpringæ€ä¹ˆçŸ¥é“å½“å‰ç”¨æˆ·æ˜¯è°ï¼Ÿ

**è§£å†³**ï¼šå®ç° `AuditorAware` æ¥å£å‘Šè¯‰Spring

**æ–¹å¼1ï¼šå›ºå®šç”¨æˆ·ï¼ˆæµ‹è¯•ç”¨ï¼‰**
```java
@Component
public class SimpleAuditorAware implements AuditorAware<String> {
    
    @Override
    public Optional<String> getCurrentAuditor() {
        // è¿”å›å½“å‰ç”¨æˆ·
        return Optional.of("system");  // ğŸ‘ˆ å›ºå®šè¿”å›"system"
    }
}
```

**æ–¹å¼2ï¼šä»Securityè·å–ï¼ˆå®é™…åº”ç”¨ï¼‰**
```java
@Component
public class SecurityAuditorAware implements AuditorAware<String> {
    
    @Override
    public Optional<String> getCurrentAuditor() {
        // ä»Spring Securityè·å–å½“å‰ç™»å½•ç”¨æˆ·
        Authentication authentication = 
            SecurityContextHolder.getContext().getAuthentication();
        
        if (authentication == null || !authentication.isAuthenticated()) {
            return Optional.of("anonymous");  // æœªç™»å½•
        }
        
        return Optional.of(authentication.getName());  // è¿”å›ç”¨æˆ·å
    }
}
```

**æ–¹å¼3ï¼šä»è¯·æ±‚ä¸Šä¸‹æ–‡è·å–**
```java
@Component
public class RequestAuditorAware implements AuditorAware<String> {
    
    @Autowired
    private HttpServletRequest request;
    
    @Override
    public Optional<String> getCurrentAuditor() {
        // ä»è¯·æ±‚å¤´æˆ–sessionè·å–ç”¨æˆ·ä¿¡æ¯
        String userId = request.getHeader("User-Id");
        
        if (userId == null) {
            userId = "guest";
        }
        
        return Optional.of(userId);
    }
}
```

**ğŸ’¡ ç†è§£**ï¼š
- `AuditorAware<String>` ä¸­çš„Stringæ˜¯ç”¨æˆ·æ ‡è¯†çš„ç±»å‹
- å¯ä»¥ç”¨Stringï¼ˆç”¨æˆ·åï¼‰ã€Longï¼ˆç”¨æˆ·IDï¼‰ç­‰
- `getCurrentAuditor()` è¿”å›å½“å‰æ“ä½œçš„ç”¨æˆ·
- Springä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•è·å–ç”¨æˆ·ï¼Œå¡«å……åˆ° `@CreatedBy` å’Œ `@LastModifiedBy`

---

## 6. ğŸš€ å®Œæ•´å®¡è®¡å®æˆ˜


### 6.1 å®Œæ•´é…ç½®ç¤ºä¾‹


**æ­¥éª¤1ï¼šå®¡è®¡åŸºç±»**
```java
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class BaseEntity {
    
    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createTime;
    
    @LastModifiedDate
    private LocalDateTime updateTime;
    
    @CreatedBy
    @Column(updatable = false)
    private String createBy;
    
    @LastModifiedBy
    private String updateBy;
    
    // getter/setter
}
```

**æ­¥éª¤2ï¼šç”¨æˆ·æä¾›è€…**
```java
@Component
public class AuditorConfig implements AuditorAware<String> {
    
    @Override
    public Optional<String> getCurrentAuditor() {
        // å®é™…é¡¹ç›®ä»Securityæˆ–Sessionè·å–
        return Optional.of("admin");
    }
}
```

**æ­¥éª¤3ï¼šå¯ç”¨å®¡è®¡**
```java
@SpringBootApplication
@EnableJpaAuditing
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### 6.2 å®ä½“ç±»åº”ç”¨


**è®¢å•å®ä½“**ï¼š
```java
@Entity
@Table(name = "t_order")
public class Order extends BaseEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String orderNo;      // è®¢å•å·
    private BigDecimal amount;   // é‡‘é¢
    private Integer status;      // çŠ¶æ€
    
    // ä¸éœ€è¦å†™å®¡è®¡å­—æ®µï¼Œå·²ç»ç»§æ‰¿äº†ï¼
}
```

### 6.3 æµ‹è¯•å®¡è®¡æ•ˆæœ


```java
@SpringBootTest
class OrderTest {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Test
    void testAudit() {
        // åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setOrderNo("ORD20240115001");
        order.setAmount(new BigDecimal("299.00"));
        order.setStatus(1);
        
        orderRepository.save(order);
        
        // æŸ¥çœ‹ç»“æœ
        Order saved = orderRepository.findById(order.getId()).get();
        System.out.println("åˆ›å»ºæ—¶é—´ï¼š" + saved.getCreateTime());  // è‡ªåŠ¨å¡«å……
        System.out.println("åˆ›å»ºäººï¼š" + saved.getCreateBy());      // è‡ªåŠ¨å¡«å……
        
        // ä¿®æ”¹è®¢å•
        saved.setStatus(2);
        orderRepository.save(saved);
        
        // å†æ¬¡æŸ¥çœ‹
        Order updated = orderRepository.findById(order.getId()).get();
        System.out.println("ä¿®æ”¹æ—¶é—´ï¼š" + updated.getUpdateTime());  // è‡ªåŠ¨æ›´æ–°
        System.out.println("ä¿®æ”¹äººï¼š" + updated.getUpdateBy());      // è‡ªåŠ¨æ›´æ–°
        System.out.println("åˆ›å»ºæ—¶é—´ï¼š" + updated.getCreateTime());  // ä¿æŒä¸å˜
    }
}
```

**è¾“å‡ºç»“æœ**ï¼š
```
åˆ›å»ºæ—¶é—´ï¼š2024-01-15T10:30:00
åˆ›å»ºäººï¼šadmin
ä¿®æ”¹æ—¶é—´ï¼š2024-01-15T14:20:00
ä¿®æ”¹äººï¼šadmin
åˆ›å»ºæ—¶é—´ï¼š2024-01-15T10:30:00
```

---

## 7. â“ å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ


### 7.1 å¸¸è§é—®é¢˜


**Q1ï¼šå®¡è®¡å­—æ®µæ²¡æœ‰è‡ªåŠ¨å¡«å……ï¼Ÿ**

æ£€æŸ¥æ¸…å•ï¼š
```
âœ… 1. æ˜¯å¦æ·»åŠ äº†@EnableJpaAuditingæ³¨è§£ï¼Ÿ
âœ… 2. å®ä½“ç±»æ˜¯å¦ç»§æ‰¿äº†å®¡è®¡åŸºç±»ï¼Ÿ
âœ… 3. å®¡è®¡åŸºç±»æ˜¯å¦æœ‰@EntityListenersæ³¨è§£ï¼Ÿ
âœ… 4. ç”¨æˆ·å®¡è®¡æ˜¯å¦å®ç°äº†AuditorAwareæ¥å£ï¼Ÿ
âœ… 5. AuditorAwareæ˜¯å¦æ³¨å†Œä¸ºSpring Beanï¼Ÿ
```

**Q2ï¼šä¿®æ”¹æ—¶åˆ›å»ºæ—¶é—´ä¹Ÿå˜äº†ï¼Ÿ**

```java
// âŒ é”™è¯¯ï¼šæ²¡æœ‰è®¾ç½®updatable = false
@CreatedDate
private LocalDateTime createTime;

// âœ… æ­£ç¡®ï¼šåˆ›å»ºåä¸å¯ä¿®æ”¹
@CreatedDate
@Column(updatable = false)
private LocalDateTime createTime;
```

**Q3ï¼šä¸åŒå®ä½“ç”¨ä¸åŒçš„ç”¨æˆ·ç±»å‹ï¼Ÿ**

```java
// Stringç±»å‹çš„ç”¨æˆ·å®¡è®¡
public class BaseEntity implements AuditorAware<String> { }

// Longç±»å‹çš„ç”¨æˆ·IDå®¡è®¡
public class BaseEntity implements AuditorAware<Long> { }
```

### 7.2 æœ€ä½³å®è·µ


**âœ¨ å®è·µ1ï¼šä½¿ç”¨åŸºç±»ç»Ÿä¸€ç®¡ç†**
```java
// æ‰€æœ‰éœ€è¦å®¡è®¡çš„å®ä½“éƒ½ç»§æ‰¿è¿™ä¸ªåŸºç±»
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class AuditEntity {
    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createTime;
    
    @LastModifiedDate
    private LocalDateTime updateTime;
}
```

**âœ¨ å®è·µ2ï¼šå®¡è®¡å­—æ®µå‘½åè§„èŒƒ**
```java
// æ¨èçš„å­—æ®µå‘½å
createTime / create_time   // åˆ›å»ºæ—¶é—´
updateTime / update_time   // ä¿®æ”¹æ—¶é—´
createBy / create_by       // åˆ›å»ºäºº
updateBy / update_by       // ä¿®æ”¹äºº
```

**âœ¨ å®è·µ3ï¼šåˆç†ä½¿ç”¨å®¡è®¡èŒƒå›´**

```java
// éœ€è¦å®¡è®¡çš„å®ä½“ï¼šè®¢å•ã€ç”¨æˆ·ã€æ–‡ç« ç­‰é‡è¦æ•°æ®
@Entity
public class Order extends AuditEntity { }

// ä¸éœ€è¦å®¡è®¡çš„å®ä½“ï¼šæ—¥å¿—ã€ä¸´æ—¶æ•°æ®ç­‰
@Entity
public class SystemLog {
    // ä¸ç»§æ‰¿AuditEntity
}
```

**âœ¨ å®è·µ4ï¼šå®¡è®¡ä¿¡æ¯å¯è§†åŒ–**
```java
@Entity
public class Order extends BaseEntity {
    
    // ä¸šåŠ¡å­—æ®µ...
    
    // æä¾›å®¡è®¡ä¿¡æ¯çš„å‹å¥½å±•ç¤º
    public String getAuditInfo() {
        return String.format("åˆ›å»ºï¼š%s by %s, ä¿®æ”¹ï¼š%s by %s",
            createTime, createBy, updateTime, updateBy);
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å®¡è®¡æœ¬è´¨ï¼šè‡ªåŠ¨è¿½è¸ªæ•°æ®å˜åŒ–çš„æ—¶é—´å’Œæ“ä½œäºº
ğŸ”¸ æ ¸å¿ƒæ³¨è§£ï¼š
   - @EnableJpaAuditingï¼šå¯ç”¨å®¡è®¡
   - @CreatedDateï¼šåˆ›å»ºæ—¶é—´
   - @LastModifiedDateï¼šä¿®æ”¹æ—¶é—´
   - @CreatedByï¼šåˆ›å»ºäºº
   - @LastModifiedByï¼šä¿®æ”¹äºº
ğŸ”¸ ç”¨æˆ·æä¾›ï¼šå®ç°AuditorAwareæ¥å£
ğŸ”¸ åŸºç±»ç»§æ‰¿ï¼šç»Ÿä¸€ç®¡ç†å®¡è®¡å­—æ®µ
```

### 8.2 å¿«é€Ÿé…ç½®ä¸‰æ­¥èµ°


```
æ­¥éª¤1ï¸âƒ£ï¼šå¯ç”¨å®¡è®¡
@EnableJpaAuditing

æ­¥éª¤2ï¸âƒ£ï¼šåˆ›å»ºåŸºç±»
@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class BaseEntity {
    @CreatedDate
    private LocalDateTime createTime;
    @LastModifiedDate
    private LocalDateTime updateTime;
}

æ­¥éª¤3ï¸âƒ£ï¼šå®ä½“ç»§æ‰¿
@Entity
public class MyEntity extends BaseEntity { }
```

### 8.3 å®¡è®¡åŠŸèƒ½å¯¹æ¯”


| æ–¹å¼ | **å®ç°æ–¹å¼** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|------------|---------|---------|
| **æ‰‹åŠ¨è®¾ç½®** | `entity.setCreateTime(new Date())` | çµæ´»æ§åˆ¶ | å®¹æ˜“é—æ¼ã€ä»£ç é‡å¤ |
| **æ•°æ®åº“è§¦å‘å™¨** | `CREATE TRIGGER...` | æ•°æ®åº“å±‚é¢ä¿è¯ | ä¸åŒæ•°æ®åº“è¯­æ³•ä¸åŒ |
| **JPAå®¡è®¡** | `@CreatedDate`ç­‰æ³¨è§£ | è‡ªåŠ¨åŒ–ã€ç»Ÿä¸€ç®¡ç† | éœ€è¦é…ç½® |

### 8.4 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯**ï¼š
- ğŸ“ **å†…å®¹ç®¡ç†**ï¼šæ–‡ç« åˆ›å»ºã€ä¿®æ”¹è¿½è¸ª
- ğŸ›’ **ç”µå•†ç³»ç»Ÿ**ï¼šè®¢å•å˜æ›´å†å²è®°å½•
- ğŸ‘¥ **ç”¨æˆ·ç³»ç»Ÿ**ï¼šè´¦å·æ“ä½œå®¡è®¡
- ğŸ“Š **æ•°æ®åˆ†æ**ï¼šç»Ÿè®¡æ•°æ®å˜æ›´è¶‹åŠ¿

**æ ¸å¿ƒè®°å¿†**ï¼š
```
å®¡è®¡å››è¦ç´ æ—¶åˆ»è®°ï¼Œ
æ—¶é—´äººå‘˜è‡ªåŠ¨å¡«ã€‚
åˆ›å»ºä¿®æ”¹ä¸¤æ—¶åˆ»ï¼Œ
æ“ä½œç”¨æˆ·è¦æ˜ç¡®ã€‚
åŸºç±»ç»§æ‰¿æœ€æ–¹ä¾¿ï¼Œ
å…¨å±€é…ç½®ä¸€æ¬¡æˆã€‚
```