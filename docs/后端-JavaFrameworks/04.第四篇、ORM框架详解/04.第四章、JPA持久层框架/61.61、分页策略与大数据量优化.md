---
title: 61ã€åˆ†é¡µç­–ç•¥ä¸å¤§æ•°æ®é‡ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [åˆ†é¡µçš„æœ¬è´¨ä¸æŒ‘æˆ˜](#1-åˆ†é¡µçš„æœ¬è´¨ä¸æŒ‘æˆ˜)
2. [ä¼ ç»Ÿåˆ†é¡µçš„æ€§èƒ½é—®é¢˜](#2-ä¼ ç»Ÿåˆ†é¡µçš„æ€§èƒ½é—®é¢˜)
3. [æ¸¸æ ‡åˆ†é¡µ(Keyset Pagination)](#3-æ¸¸æ ‡åˆ†é¡µkeyset-pagination)
4. [åŸºäºé”šç‚¹çš„åˆ†é¡µç­–ç•¥](#4-åŸºäºé”šç‚¹çš„åˆ†é¡µç­–ç•¥)
5. [countæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§](#5-countæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§)
6. [æ·±åˆ†é¡µé—®é¢˜è§£å†³æ–¹æ¡ˆ](#6-æ·±åˆ†é¡µé—®é¢˜è§£å†³æ–¹æ¡ˆ)
7. [æ— é™æ»šåŠ¨çš„å®ç°](#7-æ— é™æ»šåŠ¨çš„å®ç°)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åˆ†é¡µçš„æœ¬è´¨ä¸æŒ‘æˆ˜


### 1.1 ä»€ä¹ˆæ˜¯åˆ†é¡µ


**é€šä¿—ç†è§£**ï¼šåˆ†é¡µå°±åƒæŠŠä¸€æœ¬åšåšçš„ä¹¦åˆ†æˆä¸€é¡µä¸€é¡µæ¥çœ‹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ•´æœ¬ä¹¦éƒ½ç¿»å¼€ã€‚

```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ åœ¨ç½‘ä¸Šè´­ç‰©ï¼Œæœç´¢"æ‰‹æœº"ï¼Œæœ‰10ä¸‡æ¡å•†å“
- ä¸åˆ†é¡µï¼šä¸€æ¬¡æ€§åŠ è½½10ä¸‡æ¡ â†’ æµè§ˆå™¨å¡æ­» âŒ
- åˆ†é¡µï¼šæ¯é¡µ20æ¡ï¼Œåˆ†5000é¡µ â†’ æµç•…æµè§ˆ âœ…

è¿™å°±æ˜¯åˆ†é¡µçš„æ ¸å¿ƒä½œç”¨ï¼
```

**åˆ†é¡µçš„æ ¸å¿ƒç›®çš„**ï¼š
- ğŸ¯ **å‡å°‘å†…å­˜å‹åŠ›**ï¼šä¸ç”¨ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
- âš¡ **æå‡å“åº”é€Ÿåº¦**ï¼šæ¯æ¬¡åªæŸ¥è¯¢ä¸€å°éƒ¨åˆ†æ•°æ®
- ğŸ‘ï¸ **æ”¹å–„ç”¨æˆ·ä½“éªŒ**ï¼šæ•°æ®åˆ†æ‰¹å±•ç¤ºï¼Œé€æ­¥åŠ è½½

### 1.2 åˆ†é¡µçš„åº”ç”¨åœºæ™¯


**å¸¸è§ä½¿ç”¨åœºæ™¯**ï¼š

| åœºæ™¯ | è¯´æ˜ | å…¸å‹ç‰¹ç‚¹ |
|------|------|---------|
| ğŸ“± **ç”µå•†å•†å“åˆ—è¡¨** | æœç´¢ç»“æœå±•ç¤º | æ•°æ®é‡å¤§ï¼Œéœ€è¦æ’åº |
| ğŸ“§ **é‚®ä»¶åˆ—è¡¨** | æ”¶ä»¶ç®±å±•ç¤º | æŒ‰æ—¶é—´å€’åºï¼Œé¢‘ç¹æ›´æ–° |
| ğŸ“° **æ–°é—»èµ„è®¯** | æ–‡ç« åˆ—è¡¨ | æ— é™æ»šåŠ¨åŠ è½½ |
| ğŸ“Š **æ•°æ®æŠ¥è¡¨** | åå°ç®¡ç†ç³»ç»Ÿ | éœ€è¦ç²¾ç¡®é¡µç è·³è½¬ |
| ğŸ’¬ **è¯„è®ºåˆ—è¡¨** | ç¤¾äº¤äº’åŠ¨ | å®æ—¶æ€§è¦æ±‚é«˜ |

### 1.3 åˆ†é¡µé¢ä¸´çš„æ ¸å¿ƒæŒ‘æˆ˜


**ä¸‰å¤§æ ¸å¿ƒé—®é¢˜**ï¼š

```
ğŸ”¸ æ€§èƒ½é—®é¢˜ï¼š
   æ•°æ®åº“ï¼šSELECT * FROM products LIMIT 1000000, 20
   â†“
   MySQLéœ€è¦æ‰«æå‰1000020æ¡æ•°æ®ï¼Œç„¶åä¸¢å¼ƒå‰1000000æ¡
   è¿™å°±æ˜¯"æ·±åˆ†é¡µ"é—®é¢˜ï¼

ğŸ”¸ ä¸€è‡´æ€§é—®é¢˜ï¼š
   ç¬¬1é¡µæŸ¥è¯¢æ—¶é—´ï¼š12:00
   ç¬¬2é¡µæŸ¥è¯¢æ—¶é—´ï¼š12:01 
   â†“
   è¿™1åˆ†é’Ÿå†…å¦‚æœæœ‰æ–°æ•°æ®æ’å…¥ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®é‡å¤æˆ–é—æ¼

ğŸ”¸ ç»Ÿè®¡é—®é¢˜ï¼š
   COUNT(*) æŸ¥è¯¢åœ¨å¤§è¡¨ä¸Šéå¸¸æ…¢
   ç”¨æˆ·ç¿»åˆ°ç¬¬50é¡µæ—¶ï¼Œè¿˜è¦æ˜¾ç¤º"å…±1234567æ¡"
   æ¯æ¬¡éƒ½countä¸€éï¼Œæ•°æ®åº“åƒä¸æ¶ˆï¼
```

---

## 2. âš ï¸ ä¼ ç»Ÿåˆ†é¡µçš„æ€§èƒ½é—®é¢˜


### 2.1 OFFSET/LIMITçš„å·¥ä½œåŸç†


**ä¼ ç»Ÿåˆ†é¡µçš„SQLå†™æ³•**ï¼š

```sql
-- æŸ¥è¯¢ç¬¬1é¡µï¼ˆå‰20æ¡ï¼‰
SELECT * FROM orders 
ORDER BY create_time DESC 
LIMIT 20 OFFSET 0;

-- æŸ¥è¯¢ç¬¬2é¡µï¼ˆç¬¬21-40æ¡ï¼‰
SELECT * FROM orders 
ORDER BY create_time DESC 
LIMIT 20 OFFSET 20;

-- æŸ¥è¯¢ç¬¬1000é¡µï¼ˆç¬¬19981-20000æ¡ï¼‰
SELECT * FROM orders 
ORDER BY create_time DESC 
LIMIT 20 OFFSET 19980;
```

**åœ¨JPAä¸­çš„å®ç°**ï¼š

```java
// Repositoryå±‚
public interface OrderRepository extends JpaRepository<Order, Long> {
    Page<Order> findAll(Pageable pageable);
}

// Serviceå±‚ä½¿ç”¨
public Page<Order> getOrders(int pageNum) {
    // åˆ›å»ºåˆ†é¡µå‚æ•°ï¼šç¬¬pageNumé¡µï¼Œæ¯é¡µ20æ¡ï¼ŒæŒ‰åˆ›å»ºæ—¶é—´é™åº
    Pageable pageable = PageRequest.of(
        pageNum, 
        20, 
        Sort.by(Sort.Direction.DESC, "createTime")
    );
    
    return orderRepository.findAll(pageable);
}
```

### 2.2 æ€§èƒ½é—®é¢˜çš„æœ¬è´¨


**MySQLæ‰§è¡Œè¿‡ç¨‹è¯¦è§£**ï¼š

```
æŸ¥è¯¢ç¬¬1000é¡µçš„çœŸå®è¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å…¨è¡¨æ‰«æ orders è¡¨            â”‚
â”‚ 2. æŒ‰ create_time æ’åº          â”‚
â”‚ 3. æ‰«æå‰ 19980 æ¡æ•°æ®          â”‚
â”‚ 4. ä¸¢å¼ƒå‰ 19980 æ¡ âŒ           â”‚
â”‚ 5. è¿”å›ç¬¬ 19981-20000 æ¡ âœ…     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼šé¡µç è¶Šå¤§ï¼Œä¸¢å¼ƒçš„æ•°æ®è¶Šå¤šï¼
```

**æ€§èƒ½æµ‹è¯•æ•°æ®å¯¹æ¯”**ï¼š

| é¡µç  | OFFSETå€¼ | æŸ¥è¯¢è€—æ—¶ | æ‰«æè¡Œæ•° |
|------|---------|---------|---------|
| ç¬¬1é¡µ | 0 | 10ms | 20è¡Œ |
| ç¬¬100é¡µ | 1980 | 50ms | 2000è¡Œ |
| ç¬¬1000é¡µ | 19980 | 500ms | 20000è¡Œ |
| ç¬¬10000é¡µ | 199980 | ğŸ”¥5ç§’ | 200000è¡Œ |

> ğŸ’¡ **æ ¸å¿ƒé—®é¢˜**ï¼šOFFSETè¶Šå¤§ï¼Œæ•°æ®åº“éœ€è¦è·³è¿‡çš„è¡Œæ•°è¶Šå¤šï¼Œæ€§èƒ½å‘ˆçº¿æ€§ä¸‹é™ï¼

### 2.3 OFFSETåˆ†é¡µçš„é€‚ç”¨åœºæ™¯


**ä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨ä¼ ç»Ÿåˆ†é¡µ**ï¼š

âœ… **é€‚åˆä½¿ç”¨çš„åœºæ™¯**ï¼š
- æ•°æ®é‡è¾ƒå°ï¼ˆ< 1ä¸‡æ¡ï¼‰
- ç”¨æˆ·å¾ˆå°‘ç¿»åˆ°åé¢çš„é¡µç 
- å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„å†…éƒ¨ç³»ç»Ÿ
- éœ€è¦ç²¾ç¡®é¡µç è·³è½¬çš„åœºæ™¯

âŒ **ä¸é€‚åˆçš„åœºæ™¯**ï¼š
- å¤§æ•°æ®é‡è¡¨ï¼ˆ> 10ä¸‡æ¡ï¼‰
- ç”¨æˆ·ä¼šé¢‘ç¹è®¿é—®åé¢é¡µç 
- é«˜å¹¶å‘åœºæ™¯
- ç§»åŠ¨ç«¯æ— é™æ»šåŠ¨

---

## 3. ğŸš€ æ¸¸æ ‡åˆ†é¡µ(Keyset Pagination)


### 3.1 ä»€ä¹ˆæ˜¯æ¸¸æ ‡åˆ†é¡µ


**é€šä¿—ç†è§£**ï¼šæ¸¸æ ‡åˆ†é¡µå°±åƒ"ä¹¦ç­¾"ï¼Œä¸è®°å½•é¡µç ï¼Œè€Œæ˜¯è®°ä½ä¸Šæ¬¡è¯»åˆ°å“ªä¸€æ¡æ•°æ®ã€‚

```
ä¼ ç»Ÿåˆ†é¡µæ€ç»´ï¼š
"æˆ‘è¦çœ‹ç¬¬100é¡µ" â†’ æ•°æ®åº“è·³è¿‡å‰99é¡µ âŒ

æ¸¸æ ‡åˆ†é¡µæ€ç»´ï¼š
"æˆ‘ä¸Šæ¬¡çœ‹åˆ°ID=9999çš„æ•°æ®ï¼Œç»™æˆ‘ä¸‹ä¸€æ‰¹" â†’ ç›´æ¥ä»9999å¼€å§‹æŸ¥ âœ…
```

**æ ¸å¿ƒåŸç†å›¾ç¤º**ï¼š

```
ä¼ ç»Ÿåˆ†é¡µï¼š
[1-20] â†’ [21-40] â†’ [41-60] â†’ ... â†’ [9981-10000]
éœ€è¦è·³è¿‡9980æ¡æ•°æ® âŒ

æ¸¸æ ‡åˆ†é¡µï¼š
[1-20] â†’ è®°ä½æœ€åID=20
       â†“
[21-40] â†’ WHERE id > 20 LIMIT 20 âœ…
       â†“
[41-60] â†’ WHERE id > 40 LIMIT 20 âœ…
```

### 3.2 æ¸¸æ ‡åˆ†é¡µçš„å®ç°


**SQLå®ç°æ–¹å¼**ï¼š

```sql
-- ç¬¬ä¸€æ¬¡æŸ¥è¯¢
SELECT * FROM orders 
WHERE status = 'PAID' 
ORDER BY id ASC 
LIMIT 20;

-- å‡è®¾æœ€åä¸€æ¡è®°å½•çš„ id = 20
-- ç¬¬äºŒæ¬¡æŸ¥è¯¢
SELECT * FROM orders 
WHERE status = 'PAID' 
  AND id > 20          -- å…³é”®ï¼šä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­
ORDER BY id ASC 
LIMIT 20;

-- ç¬¬ä¸‰æ¬¡æŸ¥è¯¢ï¼ˆå‡è®¾ä¸Šæ¬¡æœ€åid = 40ï¼‰
SELECT * FROM orders 
WHERE status = 'PAID' 
  AND id > 40
ORDER BY id ASC 
LIMIT 20;
```

**JPAä¸­çš„å®ç°ä»£ç **ï¼š

```java
// 1. å®šä¹‰æ¸¸æ ‡åˆ†é¡µçš„è¯·æ±‚å‚æ•°
public class CursorPageRequest {
    private Long lastId;      // ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€åä¸€æ¡ID
    private Integer pageSize; // æ¯é¡µå¤§å°
    
    public CursorPageRequest(Long lastId, Integer pageSize) {
        this.lastId = lastId;
        this.pageSize = pageSize != null ? pageSize : 20;
    }
}

// 2. Repositoryå±‚å®ç°
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    // é¦–æ¬¡æŸ¥è¯¢ï¼ˆæ²¡æœ‰æ¸¸æ ‡ï¼‰
    @Query("SELECT o FROM Order o WHERE o.status = :status " +
           "ORDER BY o.id ASC")
    List<Order> findFirstPage(
        @Param("status") String status, 
        Pageable pageable
    );
    
    // åç»­æŸ¥è¯¢ï¼ˆå¸¦æ¸¸æ ‡ï¼‰
    @Query("SELECT o FROM Order o WHERE o.status = :status " +
           "AND o.id > :lastId " +
           "ORDER BY o.id ASC")
    List<Order> findNextPage(
        @Param("status") String status,
        @Param("lastId") Long lastId,
        Pageable pageable
    );
}

// 3. Serviceå±‚å°è£…
@Service
public class OrderService {
    
    public List<Order> getOrdersByCursor(CursorPageRequest request) {
        Pageable pageable = PageRequest.of(0, request.getPageSize());
        
        if (request.getLastId() == null) {
            // é¦–æ¬¡æŸ¥è¯¢
            return orderRepository.findFirstPage("PAID", pageable);
        } else {
            // åç»­æŸ¥è¯¢
            return orderRepository.findNextPage(
                "PAID", 
                request.getLastId(), 
                pageable
            );
        }
    }
}
```

### 3.3 å¤æ‚æ’åºçš„æ¸¸æ ‡åˆ†é¡µ


**å¤šå­—æ®µæ’åºåœºæ™¯**ï¼š

```java
// åœºæ™¯ï¼šæŒ‰åˆ›å»ºæ—¶é—´é™åº + IDé™åºæ’åˆ—
// (æ—¶é—´å¯èƒ½é‡å¤ï¼Œæ‰€ä»¥éœ€è¦IDè¾…åŠ©)

public class CursorPageRequest {
    private LocalDateTime lastCreateTime; // ä¸Šæ¬¡çš„åˆ›å»ºæ—¶é—´
    private Long lastId;                  // ä¸Šæ¬¡çš„ID
    private Integer pageSize;
}

// Repositoryå®ç°
@Query("SELECT o FROM Order o " +
       "WHERE (o.createTime < :lastTime) " +
       "   OR (o.createTime = :lastTime AND o.id < :lastId) " +
       "ORDER BY o.createTime DESC, o.id DESC")
List<Order> findNextPageByTime(
    @Param("lastTime") LocalDateTime lastTime,
    @Param("lastId") Long lastId,
    Pageable pageable
);
```

**ä¸ºä»€ä¹ˆè¿™æ ·å†™**ï¼š

```
å‡è®¾æ•°æ®ï¼š
ID  | create_time
----|------------------
10  | 2024-01-20 10:00
15  | 2024-01-20 10:00  â† æ—¶é—´ç›¸åŒï¼
20  | 2024-01-20 09:00

å¦‚æœåªç”¨æ—¶é—´æ¯”è¾ƒï¼š
WHERE create_time < '2024-01-20 10:00'
ä¼šæ¼æ‰ ID=15 çš„è®°å½•ï¼

æ­£ç¡®åšæ³•ï¼š
WHERE (create_time < '10:00') 
   OR (create_time = '10:00' AND id < 10)
è¿™æ ·ID=15å°±ä¸ä¼šè¢«æ¼æ‰
```

### 3.4 æ¸¸æ ‡åˆ†é¡µçš„ä¼˜ç¼ºç‚¹


**ä¼˜ç‚¹**ï¼š
- âœ… **æ€§èƒ½ç¨³å®š**ï¼šæ— è®ºæŸ¥è¯¢ç¬¬å‡ é¡µï¼Œé€Ÿåº¦éƒ½ä¸€æ ·å¿«
- âœ… **èµ°ç´¢å¼•**ï¼šå¯ä»¥å……åˆ†åˆ©ç”¨ä¸»é”®ç´¢å¼•
- âœ… **å¤§æ•°æ®å‹å¥½**ï¼šç™¾ä¸‡çº§æ•°æ®ä¾ç„¶æµç•…

**ç¼ºç‚¹**ï¼š
- âŒ **æ— æ³•è·³é¡µ**ï¼šä¸èƒ½ç›´æ¥è·³åˆ°ç¬¬100é¡µ
- âŒ **æ— æ³•æ˜¾ç¤ºæ€»é¡µæ•°**ï¼šä¸çŸ¥é“ä¸€å…±æœ‰å¤šå°‘é¡µ
- âŒ **å®ç°å¤æ‚**ï¼šå¤šå­—æ®µæ’åºæ—¶é€»è¾‘å¤æ‚

**é€‚ç”¨åœºæ™¯åˆ¤æ–­**ï¼š

| ç‰¹å¾ | ä¼ ç»Ÿåˆ†é¡µ | æ¸¸æ ‡åˆ†é¡µ |
|------|---------|---------|
| æ•°æ®é‡ | < 1ä¸‡ | > 10ä¸‡ |
| é¡µç è·³è½¬ | éœ€è¦ | ä¸éœ€è¦ |
| æ— é™æ»šåŠ¨ | ä¸é€‚åˆ | **æœ€ä½³é€‰æ‹©** |
| å®ç°éš¾åº¦ | ç®€å• | ä¸­ç­‰ |

---

## 4. ğŸ“ åŸºäºé”šç‚¹çš„åˆ†é¡µç­–ç•¥


### 4.1 é”šç‚¹åˆ†é¡µçš„æ ¸å¿ƒæ€æƒ³


**ä»€ä¹ˆæ˜¯é”šç‚¹åˆ†é¡µ**ï¼š

é”šç‚¹åˆ†é¡µæ˜¯æ¸¸æ ‡åˆ†é¡µçš„æ”¹è¿›ç‰ˆï¼Œä¸ä»…è®°å½•ä¸Šæ¬¡çš„ä½ç½®ï¼Œè¿˜è®°å½•"æ–¹å‘"ã€‚

```
åœºæ™¯ï¼šç”¨æˆ·æµè§ˆè®¢å•åˆ—è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¢å•100 â†å½“å‰æ˜¾ç¤º            â”‚
â”‚ è®¢å•99                       â”‚
â”‚ è®¢å•98                       â”‚
â”‚ ...                          â”‚
â”‚ è®¢å•81                       â”‚
â”‚ [ä¸Šä¸€é¡µ] [ä¸‹ä¸€é¡µ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é”šç‚¹ä¿¡æ¯ï¼š
- å½“å‰é”šç‚¹IDï¼š100
- æ–¹å‘ï¼šå¯ä»¥å¾€å‰(newer)æˆ–å¾€å(older)
```

### 4.2 åŒå‘åˆ†é¡µå®ç°


```java
// 1. å®šä¹‰é”šç‚¹è¯·æ±‚
public class AnchorPageRequest {
    private Long anchorId;          // é”šç‚¹ID
    private String direction;       // "newer" æˆ– "older"
    private Integer pageSize;
    
    public boolean isNewer() {
        return "newer".equals(direction);
    }
}

// 2. Repositoryå®ç°
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    // æŸ¥è¯¢æ¯”é”šç‚¹æ›´æ–°çš„æ•°æ®ï¼ˆä¸Šä¸€é¡µï¼‰
    @Query("SELECT o FROM Order o " +
           "WHERE o.id > :anchorId " +
           "ORDER BY o.id ASC")
    List<Order> findNewerThan(
        @Param("anchorId") Long anchorId,
        Pageable pageable
    );
    
    // æŸ¥è¯¢æ¯”é”šç‚¹æ›´è€çš„æ•°æ®ï¼ˆä¸‹ä¸€é¡µï¼‰
    @Query("SELECT o FROM Order o " +
           "WHERE o.id < :anchorId " +
           "ORDER BY o.id DESC")
    List<Order> findOlderThan(
        @Param("anchorId") Long anchorId,
        Pageable pageable
    );
}

// 3. Serviceå±‚å¤„ç†
@Service
public class OrderService {
    
    public List<Order> getOrdersByAnchor(AnchorPageRequest request) {
        Pageable pageable = PageRequest.of(0, request.getPageSize());
        List<Order> orders;
        
        if (request.isNewer()) {
            // æŸ¥è¯¢ä¸Šä¸€é¡µï¼ˆæ›´æ–°çš„æ•°æ®ï¼‰
            orders = orderRepository.findNewerThan(
                request.getAnchorId(), 
                pageable
            );
            // æ³¨æ„ï¼šéœ€è¦åè½¬é¡ºåº
            Collections.reverse(orders);
        } else {
            // æŸ¥è¯¢ä¸‹ä¸€é¡µï¼ˆæ›´è€çš„æ•°æ®ï¼‰
            orders = orderRepository.findOlderThan(
                request.getAnchorId(), 
                pageable
            );
        }
        
        return orders;
    }
}
```

### 4.3 å‰ç«¯é…åˆç¤ºä¾‹


```java
// è¿”å›ç»™å‰ç«¯çš„æ•°æ®ç»“æ„
public class AnchorPageResponse<T> {
    private List<T> data;           // æ•°æ®åˆ—è¡¨
    private Long firstId;           // ç¬¬ä¸€æ¡æ•°æ®çš„ID
    private Long lastId;            // æœ€åä¸€æ¡æ•°æ®çš„ID
    private Boolean hasNewer;       // æ˜¯å¦æœ‰æ›´æ–°çš„æ•°æ®
    private Boolean hasOlder;       // æ˜¯å¦æœ‰æ›´è€çš„æ•°æ®
}

// Controllerå±‚
@GetMapping("/orders/anchor")
public AnchorPageResponse<Order> getOrders(
    @RequestParam(required = false) Long anchorId,
    @RequestParam(defaultValue = "older") String direction,
    @RequestParam(defaultValue = "20") Integer pageSize
) {
    AnchorPageRequest request = new AnchorPageRequest(
        anchorId, direction, pageSize
    );
    
    List<Order> orders = orderService.getOrdersByAnchor(request);
    
    // æ„å»ºå“åº”
    AnchorPageResponse<Order> response = new AnchorPageResponse<>();
    response.setData(orders);
    
    if (!orders.isEmpty()) {
        response.setFirstId(orders.get(0).getId());
        response.setLastId(orders.get(orders.size() - 1).getId());
        
        // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
        response.setHasNewer(checkHasNewer(response.getFirstId()));
        response.setHasOlder(checkHasOlder(response.getLastId()));
    }
    
    return response;
}
```

---

## 5. ğŸ”¢ countæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§


### 5.1 countæŸ¥è¯¢çš„æ€§èƒ½é™·é˜±


**ä¸ºä»€ä¹ˆcountæ…¢**ï¼š

```sql
-- è¿™ä¸ªæŸ¥è¯¢åœ¨å¤§è¡¨ä¸Šéå¸¸æ…¢ï¼
SELECT COUNT(*) FROM orders WHERE status = 'PAID';

MySQLæ‰§è¡Œè¿‡ç¨‹ï¼š
1. å…¨è¡¨æ‰«æ orders è¡¨
2. é€è¡Œæ£€æŸ¥ status å­—æ®µ
3. ç´¯è®¡ç¬¦åˆæ¡ä»¶çš„è¡Œæ•°
4. è¿”å›ç»“æœ

é—®é¢˜ï¼š100ä¸‡æ¡æ•°æ®å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼
```

**å®é™…å½±å“**ï¼š

```java
// ä¼ ç»Ÿåˆ†é¡µéƒ½ä¼šæ‰§è¡ŒcountæŸ¥è¯¢
Page<Order> page = orderRepository.findAll(pageable);

// JPAä¼šæ‰§è¡Œä¸¤æ¡SQLï¼š
// 1. SELECT COUNT(*) FROM orders  â† å¯èƒ½å¾ˆæ…¢ï¼
// 2. SELECT * FROM orders LIMIT 20 OFFSET 0

// ç”¨æˆ·ä½“éªŒï¼š
// ç”¨æˆ·ç‚¹å‡»"ä¸‹ä¸€é¡µ"ï¼Œç­‰äº†3ç§’æ‰åŠ è½½å‡ºæ¥
// åŸå› ï¼šcountæŸ¥è¯¢å äº†2.8ç§’ï¼
```

### 5.2 ä¼˜åŒ–ç­–ç•¥1ï¼šç¼“å­˜countç»“æœ


```java
@Service
public class OrderService {
    
    @Autowired
    private RedisTemplate<String, Long> redisTemplate;
    
    public Page<Order> getOrdersWithCachedCount(Pageable pageable) {
        String cacheKey = "order:paid:count";
        
        // 1. å°è¯•ä»ç¼“å­˜è·å–æ€»æ•°
        Long totalCount = redisTemplate.opsForValue().get(cacheKey);
        
        if (totalCount == null) {
            // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
            totalCount = orderRepository.countByStatus("PAID");
            
            // 3. å†™å…¥ç¼“å­˜ï¼Œ5åˆ†é’Ÿè¿‡æœŸ
            redisTemplate.opsForValue().set(
                cacheKey, 
                totalCount, 
                5, 
                TimeUnit.MINUTES
            );
        }
        
        // 4. åªæŸ¥è¯¢å½“å‰é¡µæ•°æ®
        List<Order> orders = orderRepository.findByStatus(
            "PAID", 
            pageable
        ).getContent();
        
        // 5. æ‰‹åŠ¨æ„å»ºPageå¯¹è±¡
        return new PageImpl<>(orders, pageable, totalCount);
    }
}
```

> ğŸ’¡ **é€‚ç”¨åœºæ™¯**ï¼šæ•°æ®å˜åŒ–ä¸é¢‘ç¹ï¼Œå¯ä»¥æ¥å—å‡ åˆ†é’Ÿçš„å»¶è¿Ÿ

### 5.3 ä¼˜åŒ–ç­–ç•¥2ï¼šä¼°ç®—countå€¼


```java
// ä½¿ç”¨EXPLAINä¼°ç®—è¡Œæ•°
@Repository
public class OrderRepository {
    
    @PersistenceContext
    private EntityManager entityManager;
    
    public long estimateCount(String status) {
        String sql = "EXPLAIN SELECT * FROM orders WHERE status = :status";
        
        Query query = entityManager.createNativeQuery(sql);
        query.setParameter("status", status);
        
        Object[] result = (Object[]) query.getSingleResult();
        // EXPLAINçš„rowsåˆ—æ˜¯ä¼°ç®—å€¼
        Long estimatedRows = (Long) result[8]; 
        
        return estimatedRows;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public Page<Order> getOrdersWithEstimatedCount(Pageable pageable) {
    // ä½¿ç”¨ä¼°ç®—å€¼ä»£æ›¿ç²¾ç¡®count
    long estimatedTotal = orderRepository.estimateCount("PAID");
    
    List<Order> orders = orderRepository.findByStatus("PAID", pageable)
        .getContent();
    
    return new PageImpl<>(orders, pageable, estimatedTotal);
}
```

> âš ï¸ **æ³¨æ„**ï¼šä¼°ç®—å€¼å¯èƒ½ä¸å‡†ç¡®ï¼Œä½†é€Ÿåº¦å¿«å¾ˆå¤š

### 5.4 ä¼˜åŒ–ç­–ç•¥3ï¼šå»¶è¿ŸåŠ è½½count


```java
// åˆ†ç¦»æ•°æ®æŸ¥è¯¢å’ŒcountæŸ¥è¯¢
public class LazyPageResponse<T> {
    private List<T> data;
    private CompletableFuture<Long> totalCount; // å¼‚æ­¥count
    
    public LazyPageResponse(List<T> data, Supplier<Long> countSupplier) {
        this.data = data;
        // countæŸ¥è¯¢åœ¨åå°å¼‚æ­¥æ‰§è¡Œ
        this.totalCount = CompletableFuture.supplyAsync(countSupplier);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@GetMapping("/orders")
public LazyPageResponse<Order> getOrders(Pageable pageable) {
    // 1. ç«‹å³è¿”å›æ•°æ®
    List<Order> orders = orderRepository.findByStatus("PAID", pageable)
        .getContent();
    
    // 2. countå¼‚æ­¥è®¡ç®—
    return new LazyPageResponse<>(
        orders,
        () -> orderRepository.countByStatus("PAID")
    );
}
```

**å‰ç«¯å¤„ç†**ï¼š

```javascript
// å‰ç«¯å…ˆå±•ç¤ºæ•°æ®ï¼Œæ€»æ•°ååˆ°åå†æ›´æ–°
fetch('/api/orders')
  .then(res => res.json())
  .then(data => {
    // ç«‹å³æ˜¾ç¤ºæ•°æ®
    renderOrders(data.data);
    
    // ç­‰å¾…countç»“æœ
    data.totalCount.then(total => {
      updatePagination(total); // æ›´æ–°åˆ†é¡µç»„ä»¶
    });
  });
```

### 5.5 ä¼˜åŒ–ç­–ç•¥4ï¼šå»æ‰countæŸ¥è¯¢


**æ ¸å¿ƒæ€è·¯**ï¼šä¸æ˜¾ç¤ºæ€»é¡µæ•°ï¼Œåªæ˜¾ç¤º"ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µ"

```java
// æŸ¥è¯¢æ¯”éœ€è¦çš„å¤š1æ¡
public HasMoreResponse<Order> getOrdersWithoutCount(Pageable pageable) {
    int pageSize = pageable.getPageSize();
    
    // æŸ¥è¯¢pageSize + 1æ¡
    Pageable queryPageable = PageRequest.of(
        pageable.getPageNumber(),
        pageSize + 1,
        pageable.getSort()
    );
    
    List<Order> orders = orderRepository.findByStatus("PAID", queryPageable)
        .getContent();
    
    boolean hasMore = orders.size() > pageSize;
    
    if (hasMore) {
        orders = orders.subList(0, pageSize); // å»æ‰å¤šä½™çš„1æ¡
    }
    
    return new HasMoreResponse<>(orders, hasMore);
}

// å“åº”ç»“æ„
public class HasMoreResponse<T> {
    private List<T> data;
    private Boolean hasMore; // æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
    // ä¸éœ€è¦totalCountï¼
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨é¿å…countæŸ¥è¯¢
- âœ… æ€§èƒ½æœ€ä¼˜
- âœ… é€‚åˆç§»åŠ¨ç«¯æ— é™æ»šåŠ¨

---

## 6. ğŸ”ï¸ æ·±åˆ†é¡µé—®é¢˜è§£å†³æ–¹æ¡ˆ


### 6.1 ä»€ä¹ˆæ˜¯æ·±åˆ†é¡µ


**æ·±åˆ†é¡µå®šä¹‰**ï¼š

```
æµ…åˆ†é¡µï¼šç¬¬1-10é¡µ   â†’ OFFSET < 1000  âœ… å¿«é€Ÿ
ä¸­åˆ†é¡µï¼šç¬¬10-100é¡µ â†’ OFFSET < 10000 âš ï¸ å°šå¯
æ·±åˆ†é¡µï¼šç¬¬100+é¡µ   â†’ OFFSET > 10000 âŒ å¾ˆæ…¢

å®é™…æ¡ˆä¾‹ï¼š
ç”µå•†ç½‘ç«™æœç´¢"æ‰‹æœº"ï¼Œæœ‰50000ä¸ªç»“æœ
ç”¨æˆ·ç¿»åˆ°ç¬¬200é¡µ â†’ OFFSET 3980 â†’ æ•°æ®åº“æ‰«æ4000è¡Œï¼
```

### 6.2 è§£å†³æ–¹æ¡ˆ1ï¼šç¦æ­¢æ·±åˆ†é¡µ


```java
@Service
public class OrderService {
    
    private static final int MAX_PAGE = 100; // æœ€å¤š100é¡µ
    
    public Page<Order> getOrders(int pageNum, int pageSize) {
        // é™åˆ¶æœ€å¤§é¡µç 
        if (pageNum > MAX_PAGE) {
            throw new BusinessException("ä¸æ”¯æŒæŸ¥è¯¢ç¬¬" + pageNum + "é¡µï¼Œè¯·ä½¿ç”¨æœç´¢åŠŸèƒ½");
        }
        
        Pageable pageable = PageRequest.of(pageNum, pageSize);
        return orderRepository.findAll(pageable);
    }
}
```

**ç™¾åº¦/Googleçš„åšæ³•**ï¼š

```
æœç´¢ç»“æœæœ€å¤šæ˜¾ç¤º100é¡µ
è¶…è¿‡100é¡µæ˜¾ç¤ºï¼š
"ä¸ºäº†è·å¾—æ›´å‡†ç¡®çš„ç»“æœï¼Œè¯·ä½¿ç”¨æ›´å…·ä½“çš„æœç´¢è¯"
```

### 6.3 è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æœç´¢å¼•æ“


```java
// æ·±åˆ†é¡µåœºæ™¯å»ºè®®ä½¿ç”¨Elasticsearch
@Service
public class OrderSearchService {
    
    @Autowired
    private ElasticsearchTemplate esTemplate;
    
    public Page<Order> searchOrders(String keyword, Pageable pageable) {
        // ESçš„åˆ†é¡µæ€§èƒ½è¿œä¼˜äºMySQL
        NativeSearchQuery query = new NativeSearchQueryBuilder()
            .withQuery(QueryBuilders.matchQuery("orderNo", keyword))
            .withPageable(pageable)
            .build();
        
        SearchHits<Order> hits = esTemplate.search(query, Order.class);
        
        return new PageImpl<>(
            hits.stream().map(SearchHit::getContent).collect(Collectors.toList()),
            pageable,
            hits.getTotalHits()
        );
    }
}
```

> ğŸ’¡ **æ ¸å¿ƒåŸç†**ï¼šESåº•å±‚ä½¿ç”¨å€’æ’ç´¢å¼•ï¼Œæ·±åˆ†é¡µæ€§èƒ½è¿œè¶…MySQL

### 6.4 è§£å†³æ–¹æ¡ˆ3ï¼šå­æŸ¥è¯¢ä¼˜åŒ–


```java
// ä¼ ç»Ÿæ·±åˆ†é¡µï¼ˆæ…¢ï¼‰
SELECT * FROM orders 
ORDER BY id 
LIMIT 20 OFFSET 10000;  -- éœ€è¦æ‰«æ10020è¡Œ

// ä¼˜åŒ–åï¼ˆå¿«ï¼‰
SELECT * FROM orders 
WHERE id >= (
    SELECT id FROM orders 
    ORDER BY id 
    LIMIT 1 OFFSET 10000  -- åªæŸ¥IDï¼Œé€Ÿåº¦å¿«
)
ORDER BY id 
LIMIT 20;  -- åªæŸ¥20è¡Œ

// JPAå®ç°
@Query(value = 
    "SELECT o.* FROM orders o " +
    "WHERE o.id >= (" +
    "  SELECT t.id FROM orders t " +
    "  ORDER BY t.id " +
    "  LIMIT 1 OFFSET :offset" +
    ") " +
    "ORDER BY o.id " +
    "LIMIT :limit",
    nativeQuery = true)
List<Order> findBySubquery(
    @Param("offset") int offset,
    @Param("limit") int limit
);
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | OFFSET 10000 æŸ¥è¯¢æ—¶é—´ |
|------|---------------------|
| ç›´æ¥OFFSET | 500ms |
| å­æŸ¥è¯¢ä¼˜åŒ– | 50ms |
| æå‡å€æ•° | **10å€** |

---

## 7. ğŸ“± æ— é™æ»šåŠ¨çš„å®ç°


### 7.1 æ— é™æ»šåŠ¨çš„åŸç†


**ç”¨æˆ·ä½“éªŒ**ï¼š

```
ä¼ ç»Ÿåˆ†é¡µï¼š
[æ•°æ®1-20] â†’ ç‚¹å‡»"ä¸‹ä¸€é¡µ" â†’ é¡µé¢åˆ·æ–° â†’ [æ•°æ®21-40]

æ— é™æ»šåŠ¨ï¼š
[æ•°æ®1-20]
   â†“ æ»šåŠ¨åˆ°åº•éƒ¨
[æ•°æ®1-20]
[æ•°æ®21-40] â† è‡ªåŠ¨åŠ è½½ï¼Œä¸åˆ·æ–°é¡µé¢
   â†“ ç»§ç»­æ»šåŠ¨
[æ•°æ®1-20]
[æ•°æ®21-40]
[æ•°æ®41-60] â† ç»§ç»­è¿½åŠ 
```

### 7.2 åç«¯å®ç°


```java
// 1. å®šä¹‰æ— é™æ»šåŠ¨è¯·æ±‚
public class InfiniteScrollRequest {
    private Long lastId;      // ä¸Šæ¬¡æœ€åä¸€æ¡çš„ID
    private Integer pageSize; // æ¯æ¬¡åŠ è½½æ•°é‡
    
    public InfiniteScrollRequest(Long lastId, Integer pageSize) {
        this.lastId = lastId;
        this.pageSize = pageSize != null ? pageSize : 20;
    }
}

// 2. Repositoryå®ç°
public interface OrderRepository extends JpaRepository<Order, Long> {
    
    @Query("SELECT o FROM Order o " +
           "WHERE (:lastId IS NULL OR o.id < :lastId) " +
           "ORDER BY o.id DESC")
    List<Order> findForInfiniteScroll(
        @Param("lastId") Long lastId,
        Pageable pageable
    );
}

// 3. Serviceå°è£…
@Service
public class OrderService {
    
    public InfiniteScrollResponse<Order> loadMore(InfiniteScrollRequest request) {
        // æŸ¥è¯¢pageSize + 1æ¡ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤š
        Pageable pageable = PageRequest.of(0, request.getPageSize() + 1);
        
        List<Order> orders = orderRepository.findForInfiniteScroll(
            request.getLastId(),
            pageable
        );
        
        boolean hasMore = orders.size() > request.getPageSize();
        
        if (hasMore) {
            orders = orders.subList(0, request.getPageSize());
        }
        
        Long nextLastId = orders.isEmpty() ? null : 
            orders.get(orders.size() - 1).getId();
        
        return new InfiniteScrollResponse<>(orders, hasMore, nextLastId);
    }
}

// 4. å“åº”ç»“æ„
public class InfiniteScrollResponse<T> {
    private List<T> data;        // æ•°æ®åˆ—è¡¨
    private Boolean hasMore;     // æ˜¯å¦è¿˜æœ‰æ›´å¤š
    private Long nextLastId;     // ä¸‹æ¬¡è¯·æ±‚çš„lastId
}
```

### 7.3 å‰ç«¯é…åˆå®ç°


```java
// Controller
@GetMapping("/orders/scroll")
public InfiniteScrollResponse<OrderDTO> loadMoreOrders(
    @RequestParam(required = false) Long lastId,
    @RequestParam(defaultValue = "20") Integer pageSize
) {
    InfiniteScrollRequest request = new InfiniteScrollRequest(lastId, pageSize);
    
    InfiniteScrollResponse<Order> response = orderService.loadMore(request);
    
    // è½¬æ¢ä¸ºDTO
    List<OrderDTO> dtos = response.getData().stream()
        .map(OrderDTO::from)
        .collect(Collectors.toList());
    
    return new InfiniteScrollResponse<>(
        dtos, 
        response.getHasMore(), 
        response.getNextLastId()
    );
}
```

**å‰ç«¯ä¼ªä»£ç **ï¼š

```javascript
let lastId = null;
let loading = false;

// ç›‘å¬æ»šåŠ¨äº‹ä»¶
window.addEventListener('scroll', () => {
  if (isScrollToBottom() && !loading) {
    loadMoreData();
  }
});

async function loadMoreData() {
  loading = true;
  
  const response = await fetch(`/api/orders/scroll?lastId=${lastId}`);
  const data = await response.json();
  
  // è¿½åŠ æ•°æ®åˆ°åˆ—è¡¨
  appendToList(data.data);
  
  // æ›´æ–°lastId
  lastId = data.nextLastId;
  
  // å¦‚æœæ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
  if (!data.hasMore) {
    showNoMoreTip();
  }
  
  loading = false;
}
```

### 7.4 ä¼˜åŒ–ï¼šè™šæ‹Ÿæ»šåŠ¨


**é—®é¢˜**ï¼šåŠ è½½1000æ¡æ•°æ®åï¼ŒDOMèŠ‚ç‚¹å¤ªå¤šï¼Œé¡µé¢å¡é¡¿

**è§£å†³**ï¼šè™šæ‹Ÿæ»šåŠ¨ï¼Œåªæ¸²æŸ“å¯è§åŒºåŸŸçš„æ•°æ®

```
è§†å£é«˜åº¦ï¼š800px
æ¯æ¡æ•°æ®ï¼š100px
å¯è§æ•°é‡ï¼š8æ¡

è™šæ‹Ÿæ»šåŠ¨åŸç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšè—åŒºåŸŸ     â”‚ â† ä¸æ¸²æŸ“
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯è§æ•°æ®1    â”‚ â† æ¸²æŸ“
â”‚ å¯è§æ•°æ®2    â”‚
â”‚ ...          â”‚
â”‚ å¯è§æ•°æ®8    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ éšè—åŒºåŸŸ     â”‚ â† ä¸æ¸²æŸ“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ»šåŠ¨æ—¶åŠ¨æ€æ›¿æ¢å¯è§åŒºåŸŸçš„æ•°æ®
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†é¡µæœ¬è´¨ï¼šå°†å¤§æ•°æ®é›†åˆ†æ‰¹æ¬¡åŠ è½½ï¼Œæå‡æ€§èƒ½å’Œä½“éªŒ
ğŸ”¸ OFFSETé™·é˜±ï¼šé¡µç è¶Šå¤§ï¼Œæ€§èƒ½è¶Šå·®ï¼Œæ·±åˆ†é¡µå¿…ä¼˜åŒ–
ğŸ”¸ æ¸¸æ ‡åˆ†é¡µï¼šè®°å½•ä½ç½®è€Œéé¡µç ï¼Œæ€§èƒ½ç¨³å®š
ğŸ”¸ é”šç‚¹åˆ†é¡µï¼šæ”¯æŒåŒå‘ç¿»é¡µçš„æ¸¸æ ‡åˆ†é¡µæ”¹è¿›
ğŸ”¸ countä¼˜åŒ–ï¼šç¼“å­˜ã€ä¼°ç®—ã€å»¶è¿Ÿã€å»é™¤ç­‰å¤šç§ç­–ç•¥
ğŸ”¸ æ·±åˆ†é¡µï¼šé™åˆ¶é¡µæ•°ã€ç”¨ESã€å­æŸ¥è¯¢ä¼˜åŒ–
ğŸ”¸ æ— é™æ»šåŠ¨ï¼šç§»åŠ¨ç«¯æœ€ä½³å®è·µï¼Œé…åˆæ¸¸æ ‡åˆ†é¡µ
```

### 8.2 åˆ†é¡µæ–¹æ¡ˆé€‰æ‹©æŒ‡å—


| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | å…³é”®ç‰¹ç‚¹ |
|------|---------|---------|
| ğŸ“Š **åå°ç®¡ç†ç³»ç»Ÿ** | ä¼ ç»ŸOFFSETåˆ†é¡µ | éœ€è¦é¡µç è·³è½¬ |
| ğŸ“± **ç§»åŠ¨ç«¯åˆ—è¡¨** | æ¸¸æ ‡åˆ†é¡µ + æ— é™æ»šåŠ¨ | æ€§èƒ½ä¼˜å…ˆ |
| ğŸ›’ **ç”µå•†å•†å“åˆ—è¡¨** | é™åˆ¶é¡µæ•° + ESæœç´¢ | æ·±åˆ†é¡µç”¨æœç´¢ |
| ğŸ“§ **æ¶ˆæ¯/é‚®ä»¶åˆ—è¡¨** | é”šç‚¹åˆ†é¡µ | åŒå‘ç¿»é¡µ |
| ğŸ“° **èµ„è®¯Feedæµ** | æ¸¸æ ‡åˆ†é¡µ + è™šæ‹Ÿæ»šåŠ¨ | æµ·é‡æ•°æ® |

### 8.3 æ€§èƒ½ä¼˜åŒ–å£è¯€


```
åˆ†é¡µä¼˜åŒ–è®°å¿ƒé—´ï¼Œ
OFFSETæ·±åˆ†è¦é¿å…ï¼Œ
æ¸¸æ ‡é”šç‚¹èµ°ç´¢å¼•ï¼Œ
countæŸ¥è¯¢èƒ½çœåˆ™çœã€‚

æ— é™æ»šåŠ¨ç§»åŠ¨ç«¯ï¼Œ
è™šæ‹Ÿåˆ—è¡¨é˜²å¡é¡¿ï¼Œ
ç™¾ä¸‡æ•°æ®ä¸ç”¨æ…Œï¼Œ
ESæœç´¢æ¥å¸®å¿™ï¼
```

### 8.4 å®æˆ˜å»ºè®®


**æ–°æ‰‹å»ºè®®**ï¼š
1. å°æ•°æ®é‡ï¼ˆ<1ä¸‡ï¼‰ï¼šç›´æ¥ç”¨OFFSETåˆ†é¡µ
2. ä¸­ç­‰æ•°æ®é‡ï¼ˆ1-10ä¸‡ï¼‰ï¼šé™åˆ¶æœ€å¤§é¡µæ•° + ç¼“å­˜count
3. å¤§æ•°æ®é‡ï¼ˆ>10ä¸‡ï¼‰ï¼šå¿…é¡»ç”¨æ¸¸æ ‡åˆ†é¡µæˆ–ES

**ä¼˜åŒ–æ­¥éª¤**ï¼š
```
ç¬¬ä¸€æ­¥ï¼šç›‘æ§æ…¢æŸ¥è¯¢ï¼Œæ‰¾å‡ºåˆ†é¡µSQL
ç¬¬äºŒæ­¥ï¼šåˆ†ææ˜¯å¦æ·±åˆ†é¡µï¼Œè¯„ä¼°æ•°æ®é‡
ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼Œé€æ­¥ä¼˜åŒ–
ç¬¬å››æ­¥ï¼šå‰åç«¯é…åˆï¼Œå®Œå–„ç”¨æˆ·ä½“éªŒ
```

**å¸¸è§è¯¯åŒº**ï¼š
- âŒ æ‰€æœ‰åœºæ™¯éƒ½ç”¨OFFSETåˆ†é¡µ
- âŒ æ¯æ¬¡éƒ½æ‰§è¡ŒcountæŸ¥è¯¢
- âŒ æ·±åˆ†é¡µä¸é™åˆ¶ä¸ä¼˜åŒ–
- âŒ ç§»åŠ¨ç«¯è¿˜ç”¨ä¼ ç»Ÿåˆ†é¡µ

**è®°ä½**ï¼šåˆ†é¡µä¼˜åŒ–ä¸æ˜¯ä¸€è¹´è€Œå°±ï¼Œè¦æ ¹æ®å®é™…åœºæ™¯é€æ­¥ä¼˜åŒ–ï¼Œæ€§èƒ½å’Œä½“éªŒè¦å¹³è¡¡ï¼