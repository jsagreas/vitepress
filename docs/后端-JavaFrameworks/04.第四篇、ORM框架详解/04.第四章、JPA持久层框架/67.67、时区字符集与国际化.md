---
title: 67ã€æ—¶åŒºå­—ç¬¦é›†ä¸å›½é™…åŒ–
---
## ğŸ“š ç›®å½•

1. [å›½é™…åŒ–æ”¯æŒæ¦‚è¿°](#1-å›½é™…åŒ–æ”¯æŒæ¦‚è¿°)
2. [æ—¶åŒºå¤„ç†å®Œå…¨æŒ‡å—](#2-æ—¶åŒºå¤„ç†å®Œå…¨æŒ‡å—)
3. [å­—ç¬¦é›†ä¸æ’åºè§„åˆ™](#3-å­—ç¬¦é›†ä¸æ’åºè§„åˆ™)
4. [å¤šè¯­è¨€æ•°æ®å­˜å‚¨](#4-å¤šè¯­è¨€æ•°æ®å­˜å‚¨)
5. [å®æˆ˜æœ€ä½³å®è·µ](#5-å®æˆ˜æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ å›½é™…åŒ–æ”¯æŒæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å›½é™…åŒ–é—®é¢˜


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä½ å¼€å‘çš„åº”ç”¨è¦åŒæ—¶æœåŠ¡ä¸­å›½ã€ç¾å›½ã€æ¬§æ´²çš„ç”¨æˆ·ï¼š

```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·Aï¼ˆä¸­å›½åŒ—äº¬ï¼‰åˆ›å»ºè®¢å•ï¼š2024-01-15 14:00
ç”¨æˆ·Bï¼ˆç¾å›½çº½çº¦ï¼‰æŸ¥çœ‹è®¢å•ï¼šæ˜¾ç¤ºä»€ä¹ˆæ—¶é—´ï¼Ÿ
ç”¨æˆ·Cï¼ˆå¾·å›½æŸæ—ï¼‰è¾“å…¥å§“åï¼šMÃ¼ller - èƒ½æ­£ç¡®å­˜å‚¨å—ï¼Ÿ

è¿™å°±æ˜¯å›½é™…åŒ–è¦è§£å†³çš„é—®é¢˜ï¼
```

**æ ¸å¿ƒæŒ‘æˆ˜**ï¼š
- â° **æ—¶åŒºå·®å¼‚**ï¼šåŒä¸€æ—¶åˆ»åœ¨ä¸åŒåœ°åŒºæ˜¾ç¤ºä¸åŒæ—¶é—´
- ğŸ”¤ **å­—ç¬¦é›†é—®é¢˜**ï¼šä¸åŒè¯­è¨€çš„æ–‡å­—èƒ½å¦æ­£ç¡®å­˜å‚¨å’Œæ˜¾ç¤º
- ğŸ“Š **æ’åºè§„åˆ™**ï¼šä¸åŒè¯­è¨€çš„æ–‡å­—å¦‚ä½•æ­£ç¡®æ’åº
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**ï¼šåŒä¸€æ•°æ®éœ€è¦å¤šç§è¯­è¨€ç‰ˆæœ¬

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å…³æ³¨å›½é™…åŒ–


```
ä¼ ç»Ÿå•ä¸€åœ°åŒºåº”ç”¨ï¼š
ç”¨æˆ· â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“
      (åŒä¸€æ—¶åŒº)    (æœ¬åœ°å­—ç¬¦é›†)

å…¨çƒåŒ–åº”ç”¨ï¼š
ä¸­å›½ç”¨æˆ· â”€â”
ç¾å›½ç”¨æˆ· â”€â”¼â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“
æ¬§æ´²ç”¨æˆ· â”€â”˜   (UTCæ—¶é—´)    (UTF8å­—ç¬¦é›†)
              â†“
           æ­£ç¡®è½¬æ¢å„åœ°æ—¶åŒº
```

**ä¸å¤„ç†å›½é™…åŒ–çš„åæœ**ï¼š
- è®¢å•æ—¶é—´æ˜¾ç¤ºé”™ä¹±ï¼Œç”¨æˆ·æŠ•è¯‰
- ç”¨æˆ·å§“åå­˜å‚¨ä¹±ç ï¼Œæ— æ³•è¯†åˆ«
- æœç´¢ç»“æœæ’åºæ··ä¹±ï¼Œä½“éªŒå·®
- æ•°æ®è¿ç§»æ—¶ä¸¢å¤±ä¿¡æ¯

---

## 2. â° æ—¶åŒºå¤„ç†å®Œå…¨æŒ‡å—


### 2.1 æ—¶åŒºåŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ—¶åŒº**ï¼š

```
åœ°çƒè‡ªè½¬å¯¼è‡´ä¸åŒåœ°åŒºæ—¶é—´ä¸åŒï¼š

åŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰    14:00  â”€â”
çº½çº¦æ—¶é—´ï¼ˆUTC-5ï¼‰    01:00  â”€â”¼â”€ å®é™…æ˜¯åŒä¸€æ—¶åˆ»ï¼
ä¼¦æ•¦æ—¶é—´ï¼ˆUTC+0ï¼‰    06:00  â”€â”˜

UTCï¼šä¸–ç•Œåè°ƒæ—¶é—´ï¼Œæ˜¯å…¨çƒæ—¶é—´çš„ç»Ÿä¸€æ ‡å‡†
```

**æ—¶åŒºåœ¨åº”ç”¨ä¸­çš„ä½“ç°**ï¼š

| åœºæ™¯ | é—®é¢˜æè¿° | æ­£ç¡®åšæ³• |
|------|---------|---------|
| åˆ›å»ºè®¢å• | ç”¨æˆ·14ç‚¹ä¸‹å•ï¼Œå­˜ä»€ä¹ˆæ—¶é—´ï¼Ÿ | å­˜UTCæ—¶é—´ï¼Œæ ‡è®°ç”¨æˆ·æ—¶åŒº |
| æ˜¾ç¤ºè®¢å• | ä¸åŒåœ°åŒºç”¨æˆ·çœ‹åˆ°ä»€ä¹ˆï¼Ÿ | è½¬æ¢ä¸ºç”¨æˆ·æœ¬åœ°æ—¶åŒºæ˜¾ç¤º |
| å®šæ—¶ä»»åŠ¡ | æ¯å¤©8ç‚¹æ‰§è¡Œï¼Œè°çš„8ç‚¹ï¼Ÿ | æ˜ç¡®æŒ‡å®šæ—¶åŒºæˆ–ç”¨UTC |
| æ—¥å¿—è®°å½• | é”™è¯¯å‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶é—´ï¼Ÿ | ç»Ÿä¸€ç”¨UTCè®°å½• |

### 2.2 JPAæ—¶åŒºé…ç½®ç­–ç•¥


**ğŸ”¸ ç­–ç•¥ä¸€ï¼šæ•°æ®åº“ç»Ÿä¸€å­˜UTCï¼ˆæ¨èï¼‰**

```java
/**
 * å®ä½“é…ç½®ï¼šæ‰€æœ‰æ—¶é—´å­—æ®µå­˜å‚¨UTC
 */
@Entity
@Table(name = "orders")
public class Order {
    
    @Id
    private Long id;
    
    // åˆ›å»ºæ—¶é—´ï¼šå­˜UTCï¼Œè‡ªåŠ¨è½¬æ¢
    @Column(name = "created_at", nullable = false)
    @Temporal(TemporalType.TIMESTAMP)
    private Date createdAt;
    
    // ç”¨æˆ·æ—¶åŒºï¼šè®°å½•ç”¨æˆ·æ‰€åœ¨æ—¶åŒº
    @Column(name = "user_timezone")
    private String userTimezone;  // å¦‚ "Asia/Shanghai"
    
    // é¢„çº¦æ—¶é—´ï¼šä¸šåŠ¡æ—¶é—´ï¼Œéœ€è¦æ—¶åŒºä¿¡æ¯
    @Column(name = "appointment_time")
    private Instant appointmentTime;
}
```

**é…ç½®Hibernateæ—¶åŒº**ï¼š

```yaml
# application.yml
spring:
  jpa:
    properties:
      hibernate:
        # é…ç½®JDBCæ—¶åŒºä¸ºUTC
        jdbc:
          time_zone: UTC
  
  # é…ç½®Jacksonåºåˆ—åŒ–æ—¶åŒº
  jackson:
    time-zone: UTC
    date-format: yyyy-MM-dd'T'HH:mm:ss.SSS'Z'
```

**ğŸ”¸ ç­–ç•¥äºŒï¼šä½¿ç”¨Java 8æ—¶é—´APIï¼ˆæ›´æ¨èï¼‰**

```java
@Entity
public class Event {
    
    @Id
    private Long id;
    
    // Instantï¼šUTCæ—¶é—´æˆ³ï¼Œä¸å¸¦æ—¶åŒºä¿¡æ¯
    @Column(name = "event_time")
    private Instant eventTime;
    
    // ZonedDateTimeï¼šå¸¦æ—¶åŒºçš„å®Œæ•´æ—¶é—´
    @Column(name = "scheduled_time")
    private ZonedDateTime scheduledTime;
    
    // LocalDateTimeï¼šæœ¬åœ°æ—¶é—´ï¼Œä¸å¸¦æ—¶åŒº
    @Column(name = "display_time")
    private LocalDateTime displayTime;
}
```

**æ—¶é—´ç±»å‹å¯¹æ¯”**ï¼š

```
Instantï¼ˆæ¨èç”¨äºå­˜å‚¨ï¼‰ï¼š
- è¡¨ç¤ºï¼šUTCæ—¶é—´æˆ³
- å­˜å‚¨ï¼šTIMESTAMPç±»å‹
- ç‰¹ç‚¹ï¼šæ˜ç¡®æ— æ­§ä¹‰ï¼Œå…¨çƒç»Ÿä¸€
ç¤ºä¾‹ï¼š2024-01-15T06:00:00Z

ZonedDateTimeï¼ˆé€‚åˆä¸šåŠ¡é€»è¾‘ï¼‰ï¼š
- è¡¨ç¤ºï¼šå¸¦æ—¶åŒºçš„å®Œæ•´æ—¶é—´
- å­˜å‚¨ï¼šéœ€è¦é¢å¤–å­˜æ—¶åŒºä¿¡æ¯
- ç‰¹ç‚¹ï¼šå®Œæ•´ä¿ç•™æ—¶åŒºä¸Šä¸‹æ–‡
ç¤ºä¾‹ï¼š2024-01-15T14:00:00+08:00[Asia/Shanghai]

LocalDateTimeï¼ˆæ…ç”¨ï¼‰ï¼š
- è¡¨ç¤ºï¼šä¸å¸¦æ—¶åŒºçš„æœ¬åœ°æ—¶é—´
- å­˜å‚¨ï¼šTIMESTAMPç±»å‹
- ç‰¹ç‚¹ï¼šå®¹æ˜“äº§ç”Ÿæ­§ä¹‰ï¼Œæ˜“å‡ºé”™
ç¤ºä¾‹ï¼š2024-01-15T14:00:00ï¼ˆå“ªä¸ªæ—¶åŒºçš„14ç‚¹ï¼Ÿï¼‰
```

### 2.3 æ—¶åŒºè½¬æ¢æœ€ä½³å®è·µ


**å®Œæ•´çš„æ—¶åŒºå¤„ç†æµç¨‹**ï¼š

```
ç”¨æˆ·æ“ä½œæµç¨‹ï¼š

1. ç”¨æˆ·æäº¤æ—¶é—´ï¼ˆå¸¦æ—¶åŒºï¼‰
   â†“
   "2024-01-15 14:00 Asia/Shanghai"
   
2. åç«¯æ¥æ”¶å¹¶è½¬UTCå­˜å‚¨
   â†“
   è½¬æ¢ä¸º "2024-01-15 06:00 UTC"
   å­˜å…¥æ•°æ®åº“
   
3. å…¶ä»–ç”¨æˆ·æŸ¥è¯¢
   â†“
   è¯»å– "2024-01-15 06:00 UTC"
   
4. è½¬æ¢ä¸ºç”¨æˆ·æœ¬åœ°æ—¶åŒº
   â†“
   ç¾å›½ç”¨æˆ·çœ‹åˆ°ï¼š"2024-01-15 01:00 America/New_York"
   ä¸­å›½ç”¨æˆ·çœ‹åˆ°ï¼š"2024-01-15 14:00 Asia/Shanghai"
```

**ä»£ç å®ç°ç¤ºä¾‹**ï¼š

```java
@Service
public class OrderService {
    
    // åˆ›å»ºè®¢å•ï¼šæ¥æ”¶ç”¨æˆ·æ—¶åŒºçš„æ—¶é—´
    public Order createOrder(OrderDTO dto, String userTimezone) {
        Order order = new Order();
        
        // æ–¹å¼1ï¼šä½¿ç”¨Instantï¼ˆæ¨èï¼‰
        Instant now = Instant.now();  // è‡ªåŠ¨æ˜¯UTC
        order.setCreatedAt(now);
        order.setUserTimezone(userTimezone);
        
        // æ–¹å¼2ï¼šä»ç”¨æˆ·æ—¶åŒºè½¬UTC
        ZonedDateTime userTime = ZonedDateTime.parse(dto.getAppointmentTime());
        Instant appointmentUtc = userTime.toInstant();
        order.setAppointmentTime(appointmentUtc);
        
        return orderRepository.save(order);
    }
    
    // æŸ¥è¯¢è®¢å•ï¼šè¿”å›ç”¨æˆ·æ—¶åŒºçš„æ—¶é—´
    public OrderVO getOrder(Long orderId, String userTimezone) {
        Order order = orderRepository.findById(orderId).orElseThrow();
        
        OrderVO vo = new OrderVO();
        
        // è½¬æ¢ä¸ºç”¨æˆ·æ—¶åŒº
        ZoneId userZone = ZoneId.of(userTimezone);
        ZonedDateTime localTime = order.getCreatedAt()
            .atZone(userZone);
        
        vo.setCreatedAt(localTime.toString());
        return vo;
    }
}
```

### 2.4 å¸¸è§æ—¶åŒºé™·é˜±ä¸è§£å†³


**âš ï¸ é™·é˜±1ï¼šæ—¶é—´æ¼‚ç§»é—®é¢˜**

```java
// é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨new Date()
@PrePersist
public void onCreate() {
    this.createdAt = new Date();  // å¯èƒ½å—æœåŠ¡å™¨æ—¶åŒºå½±å“
}

// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨Instant
@PrePersist
public void onCreate() {
    this.createdAt = Instant.now();  // æ˜ç¡®çš„UTCæ—¶é—´
}
```

**âš ï¸ é™·é˜±2ï¼šå¤ä»¤æ—¶é—®é¢˜**

```
é—®é¢˜åœºæ™¯ï¼š
ç¾å›½å¤ä»¤æ—¶åˆ‡æ¢æ—¶ï¼Œæ—¶é—´ä¼š"è·³è·ƒ"æˆ–"é‡å¤"

2024å¹´3æœˆ10æ—¥å‡Œæ™¨2ç‚¹ â†’ ç›´æ¥è·³åˆ°3ç‚¹
2024å¹´11æœˆ3æ—¥å‡Œæ™¨2ç‚¹ â†’ ä¼šé‡å¤ä¸€æ¬¡

è§£å†³æ–¹æ¡ˆï¼š
- ä½¿ç”¨UTCå­˜å‚¨ï¼Œé¿å…å¤ä»¤æ—¶å½±å“
- ä¸šåŠ¡é€»è¾‘åŸºäºUTCè®¡ç®—
- ä»…åœ¨å±•ç¤ºæ—¶è½¬æ¢ç”¨æˆ·æ—¶åŒº
```

**âš ï¸ é™·é˜±3ï¼šæ•°æ®åº“è¿æ¥æ—¶åŒº**

```yaml
# é”™è¯¯é…ç½®ï¼šæœªæŒ‡å®šæ—¶åŒº
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb

# æ­£ç¡®é…ç½®ï¼šæ˜ç¡®æŒ‡å®šUTC
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb?serverTimezone=UTC
  jpa:
    properties:
      hibernate:
        jdbc:
          time_zone: UTC
```

---

## 3. ğŸ”¤ å­—ç¬¦é›†ä¸æ’åºè§„åˆ™


### 3.1 å­—ç¬¦é›†åŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å­—ç¬¦é›†**ï¼š

```
å­—ç¬¦é›†å°±æ˜¯"æ–‡å­—çš„ç¼–ç è¡¨"ï¼š

ASCIIï¼šåªæ”¯æŒè‹±æ–‡
- A â†’ 65
- B â†’ 66

UTF-8ï¼šæ”¯æŒå…¨çƒè¯­è¨€
- A â†’ 41
- ä¸­ â†’ E4B8AD
- Ã© â†’ C3A9
- ğŸ˜Š â†’ F09F988A

MySQLå­—ç¬¦é›†æ¼”è¿›ï¼š
latin1 â†’ utf8 â†’ utf8mb4ï¼ˆæ¨èï¼‰
```

**ä¸ºä»€ä¹ˆè¦ç”¨utf8mb4**ï¼š

| å­—ç¬¦é›† | æ”¯æŒèŒƒå›´ | å…¸å‹é—®é¢˜ | æ¨èåº¦ |
|--------|---------|---------|--------|
| `latin1` | ä»…è¥¿æ¬§è¯­è¨€ | ä¸­æ–‡ä¹±ç  | âŒ ä¸æ¨è |
| `utf8` | å¤§éƒ¨åˆ†Unicode | emojiå­˜å‚¨å¤±è´¥ | âš ï¸ æœ‰é™åˆ¶ |
| `utf8mb4` | å®Œæ•´Unicode | æ—  | âœ… å¼ºçƒˆæ¨è |

**å®é™…æ¡ˆä¾‹**ï¼š

```sql
-- utf8å­—ç¬¦é›†é—®é¢˜æ¼”ç¤º
CREATE TABLE user_utf8 (
    name VARCHAR(50) CHARACTER SET utf8
);

INSERT INTO user_utf8 VALUES ('å¼ ä¸‰');     -- âœ“ æˆåŠŸ
INSERT INTO user_utf8 VALUES ('John');     -- âœ“ æˆåŠŸ
INSERT INTO user_utf8 VALUES ('HelloğŸ˜Š');  -- âœ— å¤±è´¥ï¼Œemojiéœ€è¦4å­—èŠ‚

-- utf8mb4è§£å†³æ–¹æ¡ˆ
CREATE TABLE user_utf8mb4 (
    name VARCHAR(50) CHARACTER SET utf8mb4
);

INSERT INTO user_utf8mb4 VALUES ('HelloğŸ˜Š');  -- âœ“ æˆåŠŸ
```

### 3.2 MySQLå­—ç¬¦é›†é…ç½®


**å®Œæ•´é…ç½®æµç¨‹**ï¼š

```sql
-- 1. åˆ›å»ºæ•°æ®åº“æ—¶æŒ‡å®šå­—ç¬¦é›†
CREATE DATABASE mydb 
    CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;

-- 2. å»ºè¡¨æ—¶æŒ‡å®šå­—ç¬¦é›†ï¼ˆæ¨èæ˜ç¡®æŒ‡å®šï¼‰
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    name VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci,
    email VARCHAR(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 3. ä¿®æ”¹å·²æœ‰è¡¨çš„å­—ç¬¦é›†
ALTER TABLE users CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 4. ä¿®æ”¹å·²æœ‰å­—æ®µçš„å­—ç¬¦é›†
ALTER TABLE users MODIFY name VARCHAR(100) 
    CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**JPAé…ç½®æ–¹å¼**ï¼š

```java
@Entity
@Table(name = "products")
public class Product {
    
    @Id
    private Long id;
    
    // æ–¹å¼1ï¼šä½¿ç”¨@ColumnæŒ‡å®šå­—ç¬¦é›†ï¼ˆMySQLç‰¹å®šï¼‰
    @Column(
        name = "product_name", 
        length = 200,
        columnDefinition = "VARCHAR(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci"
    )
    private String productName;
    
    // æ–¹å¼2ï¼šå…¨å±€é…ç½®ï¼ˆæ¨èï¼‰
    @Column(name = "description", columnDefinition = "TEXT")
    private String description;
}
```

**application.ymlå…¨å±€é…ç½®**ï¼š

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC
    
  jpa:
    properties:
      hibernate:
        # å­—ç¬¦é›†é…ç½®
        connection:
          characterEncoding: utf-8
          CharSet: utf-8
          useUnicode: true
        
        # å»ºè¡¨æ—¶çš„é»˜è®¤å­—ç¬¦é›†
        dialect: org.hibernate.dialect.MySQL8Dialect
```

### 3.3 æ’åºè§„åˆ™è¯¦è§£


**ä»€ä¹ˆæ˜¯æ’åºè§„åˆ™ï¼ˆCollationï¼‰**ï¼š

```
æ’åºè§„åˆ™å†³å®šäº†å­—ç¬¦çš„æ¯”è¾ƒå’Œæ’åºæ–¹å¼ï¼š

ç¤ºä¾‹ï¼šå¾·è¯­å­—ç¬¦æ’åº
åå­—åˆ—è¡¨ï¼šMÃ¼ller, Mueller, Maier

utf8mb4_general_ciï¼š
Maier, Mueller, MÃ¼llerï¼ˆæŒ‰å­—æ¯è¡¨ï¼‰

utf8mb4_unicode_ciï¼š
Maier, Mueller, MÃ¼llerï¼ˆè¯­è¨€ä¹ æƒ¯ï¼‰

utf8mb4_german2_ciï¼š
Maier, MÃ¼ller, Muellerï¼ˆå¾·è¯­ä¹ æƒ¯ï¼ŒÃ¼=ueï¼‰
```

**å¸¸ç”¨æ’åºè§„åˆ™å¯¹æ¯”**ï¼š

| æ’åºè§„åˆ™ | ç‰¹ç‚¹ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|------|------|---------|
| `utf8mb4_general_ci` | ç®€å•å¿«é€Ÿ | é«˜ | å¯¹æ’åºå‡†ç¡®æ€§è¦æ±‚ä¸é«˜ |
| `utf8mb4_unicode_ci` | å‡†ç¡®æ ‡å‡† | ä¸­ | **é€šç”¨æ¨è** |
| `utf8mb4_bin` | äºŒè¿›åˆ¶æ¯”è¾ƒ | æœ€é«˜ | åŒºåˆ†å¤§å°å†™ï¼Œç²¾ç¡®åŒ¹é… |
| `utf8mb4_0900_ai_ci` | MySQL 8.0æ–°è§„åˆ™ | é«˜ | MySQL 8.0+ æ¨è |

**å®é™…å½±å“ç¤ºä¾‹**ï¼š

```sql
-- æµ‹è¯•ä¸åŒæ’åºè§„åˆ™
CREATE TABLE test_collation (
    id INT,
    name_general VARCHAR(50) COLLATE utf8mb4_general_ci,
    name_unicode VARCHAR(50) COLLATE utf8mb4_unicode_ci
);

INSERT INTO test_collation VALUES 
    (1, 'Apple', 'Apple'),
    (2, 'apple', 'apple'),
    (3, 'APPLE', 'APPLE');

-- general_ciï¼šä¸åŒºåˆ†å¤§å°å†™
SELECT * FROM test_collation WHERE name_general = 'apple';
-- è¿”å›æ‰€æœ‰3æ¡è®°å½•

-- å¦‚æœè¦åŒºåˆ†å¤§å°å†™ï¼Œä½¿ç”¨utf8mb4_bin
CREATE TABLE case_sensitive (
    name VARCHAR(50) COLLATE utf8mb4_bin
);
```

---

## 4. ğŸŒ å¤šè¯­è¨€æ•°æ®å­˜å‚¨


### 4.1 å¤šè¯­è¨€å­˜å‚¨æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šå•è¡¨å¤šåˆ—ï¼ˆé€‚åˆè¯­è¨€å°‘ï¼‰**

```java
@Entity
@Table(name = "products")
public class Product {
    
    @Id
    private Long id;
    
    // ä¸åŒè¯­è¨€çš„å­—æ®µ
    @Column(name = "name_zh_cn")
    private String nameZhCn;  // ä¸­æ–‡å
    
    @Column(name = "name_en_us")
    private String nameEnUs;  // è‹±æ–‡å
    
    @Column(name = "name_ja_jp")
    private String nameJaJp;  // æ—¥æ–‡å
    
    // æ ¹æ®å½“å‰è¯­è¨€è·å–åç§°
    public String getName(String locale) {
        return switch(locale) {
            case "zh-CN" -> nameZhCn;
            case "en-US" -> nameEnUs;
            case "ja-JP" -> nameJaJp;
            default -> nameEnUs;
        };
    }
}
```

**ä¼˜ç‚¹**ï¼š
- æŸ¥è¯¢ç®€å•ï¼Œæ€§èƒ½å¥½
- é€‚åˆå›ºå®šè¯­è¨€ç§ç±»

**ç¼ºç‚¹**ï¼š
- æ‰©å±•æ€§å·®ï¼Œæ–°å¢è¯­è¨€è¦åŠ å­—æ®µ
- è¡¨ç»“æ„è‡ƒè‚¿

**æ–¹æ¡ˆäºŒï¼šç‹¬ç«‹ç¿»è¯‘è¡¨ï¼ˆæ¨èï¼‰**

```java
// ä¸»å®ä½“
@Entity
@Table(name = "products")
public class Product {
    
    @Id
    private Long id;
    
    @Column(name = "product_code")
    private String productCode;
    
    // ä¸€å¯¹å¤šå…³ç³»ï¼šä¸€ä¸ªäº§å“å¤šä¸ªç¿»è¯‘
    @OneToMany(mappedBy = "product", cascade = CascadeType.ALL)
    private List<ProductTranslation> translations;
    
    // è¾…åŠ©æ–¹æ³•ï¼šè·å–æŒ‡å®šè¯­è¨€çš„ç¿»è¯‘
    public ProductTranslation getTranslation(String locale) {
        return translations.stream()
            .filter(t -> t.getLocale().equals(locale))
            .findFirst()
            .orElse(translations.get(0));  // é»˜è®¤è¿”å›ç¬¬ä¸€ä¸ª
    }
}

// ç¿»è¯‘å®ä½“
@Entity
@Table(name = "product_translations")
public class ProductTranslation {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne
    @JoinColumn(name = "product_id")
    private Product product;
    
    @Column(name = "locale", length = 10)
    private String locale;  // å¦‚ï¼šzh-CN, en-US
    
    @Column(name = "name")
    private String name;
    
    @Column(name = "description", columnDefinition = "TEXT")
    private String description;
}
```

**æ•°æ®ç¤ºä¾‹**ï¼š

```
productsè¡¨ï¼š
| id | product_code |
|----|--------------|
| 1  | PROD001      |

product_translationsè¡¨ï¼š
| id | product_id | locale | name      | description       |
|----|------------|--------|-----------|-------------------|
| 1  | 1          | zh-CN  | è‹¹æœæ‰‹æœº   | æœ€æ–°æ¬¾æ™ºèƒ½æ‰‹æœº     |
| 2  | 1          | en-US  | iPhone    | Latest smartphone |
| 3  | 1          | ja-JP  | ã‚¢ã‚¤ãƒ•ã‚©ãƒ³ | æœ€æ–°ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ |
```

**æ–¹æ¡ˆä¸‰ï¼šJSONå­—æ®µå­˜å‚¨ï¼ˆçµæ´»ä½†æ…ç”¨ï¼‰**

```java
@Entity
@Table(name = "articles")
public class Article {
    
    @Id
    private Long id;
    
    // ä½¿ç”¨JSONå­˜å‚¨å¤šè¯­è¨€å†…å®¹
    @Column(name = "content", columnDefinition = "JSON")
    @Convert(converter = JsonConverter.class)
    private Map<String, ArticleContent> contentMap;
    
    // å†…éƒ¨ç±»ï¼šæ–‡ç« å†…å®¹
    @Data
    public static class ArticleContent {
        private String title;
        private String body;
    }
    
    // è·å–æŒ‡å®šè¯­è¨€å†…å®¹
    public ArticleContent getContent(String locale) {
        return contentMap.getOrDefault(locale, contentMap.get("en-US"));
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@Service
public class ArticleService {
    
    public void createArticle() {
        Article article = new Article();
        
        Map<String, ArticleContent> contentMap = new HashMap<>();
        
        // ä¸­æ–‡å†…å®¹
        ArticleContent zhContent = new ArticleContent();
        zhContent.setTitle("æ¬¢è¿ä½¿ç”¨JPA");
        zhContent.setBody("è¿™æ˜¯ä¸€ç¯‡å…³äºJPAçš„æ–‡ç« ...");
        contentMap.put("zh-CN", zhContent);
        
        // è‹±æ–‡å†…å®¹
        ArticleContent enContent = new ArticleContent();
        enContent.setTitle("Welcome to JPA");
        enContent.setBody("This is an article about JPA...");
        contentMap.put("en-US", enContent);
        
        article.setContentMap(contentMap);
        articleRepository.save(article);
    }
}
```

### 4.2 å¤šè¯­è¨€æŸ¥è¯¢ä¼˜åŒ–


```java
@Repository
public interface ProductRepository extends JpaRepository<Product, Long> {
    
    // æŸ¥è¯¢æŒ‡å®šè¯­è¨€çš„äº§å“
    @Query("SELECT p FROM Product p " +
           "LEFT JOIN FETCH p.translations t " +
           "WHERE t.locale = :locale")
    List<Product> findAllWithTranslation(@Param("locale") String locale);
    
    // æœç´¢å¤šè¯­è¨€äº§å“
    @Query("SELECT DISTINCT p FROM Product p " +
           "JOIN p.translations t " +
           "WHERE t.locale = :locale " +
           "AND t.name LIKE %:keyword%")
    List<Product> searchByNameInLocale(
        @Param("keyword") String keyword,
        @Param("locale") String locale
    );
}
```

---

## 5. ğŸ› ï¸ å®æˆ˜æœ€ä½³å®è·µ


### 5.1 å®Œæ•´çš„å›½é™…åŒ–é…ç½®æ¸…å•


**â˜‘ï¸ æ•°æ®åº“å±‚é…ç½®**ï¼š

```sql
-- 1. æ•°æ®åº“å­—ç¬¦é›†
CREATE DATABASE myapp 
    CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;

-- 2. è¿æ¥é…ç½®
SET NAMES utf8mb4;
SET character_set_client = utf8mb4;
SET character_set_connection = utf8mb4;
SET character_set_results = utf8mb4;

-- 3. è¡¨ç»“æ„ç¤ºä¾‹
CREATE TABLE global_users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) CHARACTER SET utf8mb4,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    timezone VARCHAR(50) DEFAULT 'UTC',
    locale VARCHAR(10) DEFAULT 'en-US'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**â˜‘ï¸ åº”ç”¨å±‚é…ç½®**ï¼š

```yaml
# application.yml
spring:
  # æ•°æ®æºé…ç½®
  datasource:
    url: jdbc:mysql://localhost:3306/myapp?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC&useSSL=false
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  # JPAé…ç½®
  jpa:
    properties:
      hibernate:
        # æ—¶åŒºé…ç½®
        jdbc:
          time_zone: UTC
        # å­—ç¬¦é›†é…ç½®
        connection:
          characterEncoding: utf-8
          CharSet: utf-8
          useUnicode: true
    
    # å»ºè¡¨ç­–ç•¥ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
    hibernate:
      ddl-auto: validate
  
  # JSONåºåˆ—åŒ–é…ç½®
  jackson:
    time-zone: UTC
    date-format: yyyy-MM-dd'T'HH:mm:ss.SSS'Z'
    locale: en-US
```

**â˜‘ï¸ å®ä½“è®¾è®¡æ¨¡æ¿**ï¼š

```java
@MappedSuperclass
public abstract class I18nBaseEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // æ—¶é—´å­—æ®µï¼šç»Ÿä¸€ä½¿ç”¨Instant
    @Column(name = "created_at", nullable = false, updatable = false)
    private Instant createdAt;
    
    @Column(name = "updated_at")
    private Instant updatedAt;
    
    // åˆ›å»ºäººæ—¶åŒº
    @Column(name = "created_timezone", length = 50)
    private String createdTimezone;
    
    @PrePersist
    protected void onCreate() {
        this.createdAt = Instant.now();
    }
    
    @PreUpdate
    protected void onUpdate() {
        this.updatedAt = Instant.now();
    }
}
```

### 5.2 å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


**é—®é¢˜1ï¼šå·²æœ‰æ•°æ®è¿ç§»åˆ°UTF8MB4**

```sql
-- æ­¥éª¤1ï¼šå¤‡ä»½æ•°æ®
mysqldump -u root -p mydb > backup.sql

-- æ­¥éª¤2ï¼šè½¬æ¢æ•°æ®åº“
ALTER DATABASE mydb 
    CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;

-- æ­¥éª¤3ï¼šæ‰¹é‡è½¬æ¢è¡¨
SELECT CONCAT('ALTER TABLE ', table_name, 
    ' CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;')
FROM information_schema.tables
WHERE table_schema = 'mydb';

-- æ­¥éª¤4ï¼šéªŒè¯è½¬æ¢
SHOW CREATE TABLE your_table;
```

**é—®é¢˜2ï¼šæ—¶åŒºæ•°æ®ä¿®å¤**

```java
@Service
public class TimezoneMigrationService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    // ä¿®å¤æ—¶åŒºæ•°æ®
    @Transactional
    public void fixTimezoneData() {
        List<Order> orders = orderRepository.findAll();
        
        for (Order order : orders) {
            // å‡è®¾åŸæ¥å­˜çš„æ˜¯åŒ—äº¬æ—¶é—´ï¼Œç°åœ¨è¦è½¬UTC
            if (order.getUserTimezone() == null) {
                // åŸæ—¶é—´ - 8å°æ—¶ = UTCæ—¶é—´
                Instant utcTime = order.getCreatedAt()
                    .minus(8, ChronoUnit.HOURS);
                
                order.setCreatedAt(utcTime);
                order.setUserTimezone("Asia/Shanghai");
            }
        }
        
        orderRepository.saveAll(orders);
    }
}
```

**é—®é¢˜3ï¼šemojiå­˜å‚¨å¤±è´¥**

```java
// è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿å®Œæ•´é…ç½®é“¾è·¯
@Configuration
public class DatabaseConfig {
    
    @Bean
    public DataSource dataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/mydb" +
            "?useUnicode=true" +
            "&characterEncoding=UTF-8" +
            "&connectionCollation=utf8mb4_unicode_ci");
        
        // æ·»åŠ è¿æ¥åˆå§‹åŒ–SQL
        config.setConnectionInitSql(
            "SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci"
        );
        
        return new HikariDataSource(config);
    }
}
```

### 5.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ç´¢å¼•ä¼˜åŒ–**ï¼š

```sql
-- å¤šè¯­è¨€æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_translation_product_locale 
    ON product_translations(product_id, locale);

-- æ—¶åŒºæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_order_timezone_time 
    ON orders(user_timezone, created_at);
```

**æŸ¥è¯¢ä¼˜åŒ–**ï¼š

```java
@Repository
public interface ProductRepository extends JpaRepository<Product, Long> {
    
    // ä½¿ç”¨JOIN FETCHé¿å…N+1é—®é¢˜
    @Query("SELECT p FROM Product p " +
           "LEFT JOIN FETCH p.translations t " +
           "WHERE t.locale IN :locales")
    List<Product> findAllWithLocales(@Param("locales") List<String> locales);
    
    // ä½¿ç”¨DTOæŠ•å½±å‡å°‘æ•°æ®ä¼ è¾“
    @Query("SELECT new com.example.dto.ProductDTO(" +
           "p.id, t.name, t.description) " +
           "FROM Product p " +
           "JOIN p.translations t " +
           "WHERE t.locale = :locale")
    List<ProductDTO> findProductDTOs(@Param("locale") String locale);
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ—¶åŒºå¤„ç†ï¼šæ•°æ®åº“å­˜UTCï¼Œå±•ç¤ºæ—¶è½¬ç”¨æˆ·æ—¶åŒº
ğŸ”¸ å­—ç¬¦é›†é€‰æ‹©ï¼šç»Ÿä¸€ä½¿ç”¨utf8mb4ï¼Œé¿å…ä¹±ç 
ğŸ”¸ æ’åºè§„åˆ™ï¼šutf8mb4_unicode_cié€‚åˆå¤§å¤šæ•°åœºæ™¯
ğŸ”¸ å¤šè¯­è¨€æ–¹æ¡ˆï¼šç‹¬ç«‹ç¿»è¯‘è¡¨æœ€çµæ´»å¯æ‰©å±•
ğŸ”¸ æ—¶é—´ç±»å‹ï¼šä¼˜å…ˆä½¿ç”¨Instantï¼Œé¿å…LocalDateTime
```

### 6.2 å…³é”®é…ç½®æ£€æŸ¥æ¸…å•


**æ•°æ®åº“å±‚**ï¼š
- â˜‘ï¸ æ•°æ®åº“å­—ç¬¦é›†ï¼šutf8mb4
- â˜‘ï¸ æ’åºè§„åˆ™ï¼šutf8mb4_unicode_ci
- â˜‘ï¸ è¿æ¥å­—ç¬¦é›†ï¼šSET NAMES utf8mb4
- â˜‘ï¸ æ—¶åŒºå­˜å‚¨ï¼šæ‰€æœ‰TIMESTAMPç»Ÿä¸€UTC

**åº”ç”¨å±‚**ï¼š
- â˜‘ï¸ JDBCè¿æ¥ä¸²åŒ…å«å­—ç¬¦é›†å‚æ•°
- â˜‘ï¸ Hibernateé…ç½®jdbc.time_zone=UTC
- â˜‘ï¸ å®ä½“ä½¿ç”¨Instantç±»å‹å­˜å‚¨æ—¶é—´
- â˜‘ï¸ Jacksoné…ç½®time-zone=UTC

**ä¸šåŠ¡å±‚**ï¼š
- â˜‘ï¸ è®°å½•ç”¨æˆ·æ—¶åŒºä¿¡æ¯
- â˜‘ï¸ APIè¿”å›æ—¶è½¬æ¢æ—¶åŒº
- â˜‘ï¸ å®šæ—¶ä»»åŠ¡æ˜ç¡®æ—¶åŒº
- â˜‘ï¸ æ—¥å¿—ç»Ÿä¸€UTCæ—¶é—´

### 6.3 æœ€ä½³å®è·µæ€»ç»“


**æ—¶åŒºå¤„ç†é»„é‡‘æ³•åˆ™**ï¼š
```
å­˜å‚¨ï¼šæ°¸è¿œå­˜UTC
ä¼ è¾“ï¼šISO 8601æ ¼å¼ï¼ˆ2024-01-15T06:00:00Zï¼‰
å±•ç¤ºï¼šæ ¹æ®ç”¨æˆ·æ—¶åŒºè½¬æ¢
è®¡ç®—ï¼šåŸºäºUTCè¿›è¡Œæ‰€æœ‰æ—¶é—´è®¡ç®—
```

**å­—ç¬¦é›†é…ç½®åŸåˆ™**ï¼š
```
æ•°æ®åº“ï¼šutf8mb4 + utf8mb4_unicode_ci
è¿æ¥ï¼šæ˜ç¡®æŒ‡å®šcharacterEncoding=UTF-8
åº”ç”¨ï¼šç»Ÿä¸€UTF-8ç¼–ç 
æ ¡éªŒï¼šæµ‹è¯•emojiã€ä¸­æ–‡ã€ç‰¹æ®Šå­—ç¬¦
```

**å¤šè¯­è¨€è®¾è®¡å»ºè®®**ï¼š
```
å°‘é‡è¯­è¨€ï¼ˆâ‰¤3ç§ï¼‰ï¼šå•è¡¨å¤šåˆ—
å¤šç§è¯­è¨€ï¼ˆ>3ç§ï¼‰ï¼šç‹¬ç«‹ç¿»è¯‘è¡¨
åŠ¨æ€å†…å®¹ï¼šJSONå­—æ®µå­˜å‚¨
æ€§èƒ½æ•æ„Ÿï¼šæ·»åŠ é€‚å½“ç´¢å¼•
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ—¶åŒºå­˜å‚¨ç”¨UTCï¼Œå±•ç¤ºæ‰è½¬æœ¬åœ°æ—¶
å­—ç¬¦é›†ç”¨utf8mb4ï¼Œemojiä¸­æ–‡éƒ½ä¸æ€•
å¤šè¯­è¨€ç”¨ç¿»è¯‘è¡¨ï¼Œæ‰©å±•çµæ´»æ˜“ç»´æŠ¤
é…ç½®é“¾è·¯è¦å®Œæ•´ï¼Œä»åº“åˆ°åº”ç”¨å±‚
```