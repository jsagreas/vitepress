---
title: 40ã€åŸç”ŸSQLç»“æœé›†æ˜ å°„
---
## ğŸ“š ç›®å½•


1. [ç»“æœé›†æ˜ å°„åŸºç¡€æ¦‚å¿µ](#1-ç»“æœé›†æ˜ å°„åŸºç¡€æ¦‚å¿µ)
2. [@SqlResultSetMappingæ ¸å¿ƒæ³¨è§£](#2-sqlresultsetmappingæ ¸å¿ƒæ³¨è§£)
3. [å®ä½“ç»“æœæ˜ å°„-EntityResult](#3-å®ä½“ç»“æœæ˜ å°„-entityresult)
4. [å­—æ®µç»“æœæ˜ å°„-FieldResult](#4-å­—æ®µç»“æœæ˜ å°„-fieldresult)
5. [åˆ—ç»“æœæ˜ å°„-ColumnResult](#5-åˆ—ç»“æœæ˜ å°„-columnresult)
6. [æ ‡é‡ç»“æœå¤„ç†](#6-æ ‡é‡ç»“æœå¤„ç†)
7. [æ··åˆç»“æœé›†å¤„ç†](#7-æ··åˆç»“æœé›†å¤„ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡JPAåŸºç¡€ã€å®ä½“æ˜ å°„ã€JPQLæŸ¥è¯¢ â†’ **å½“å‰å†…å®¹**ï¼šåŸç”ŸSQLç»“æœé›†æ˜ å°„ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ å­˜å‚¨è¿‡ç¨‹è°ƒç”¨ã€æ‰¹é‡å¤„ç†

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡50åˆ†é’Ÿ | å®è·µç»ƒä¹ 30åˆ†é’Ÿ

---

## 1. ğŸ” ç»“æœé›†æ˜ å°„åŸºç¡€æ¦‚å¿µ



### 1.1 ä»€ä¹ˆæ˜¯ç»“æœé›†æ˜ å°„



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
ç»“æœé›†æ˜ å°„ï¼šæŠŠåŸç”ŸSQLæŸ¥è¯¢è¿”å›çš„æ•°æ®åº“ç»“æœè½¬æ¢æˆJavaå¯¹è±¡çš„è§„åˆ™
ä½œç”¨ï¼šè®©æ•°æ®åº“æŸ¥è¯¢ç»“æœèƒ½å¤Ÿè‡ªåŠ¨å˜æˆæˆ‘ä»¬éœ€è¦çš„Javaå®ä½“
æœ¬è´¨ï¼šå®šä¹‰"æ•°æ®åº“åˆ—"å’Œ"Javaå¯¹è±¡å±æ€§"ä¹‹é—´çš„å¯¹åº”å…³ç³»
```

**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä½ åœ¨ç½‘ä¸Šè´­ç‰©ï¼š
- **æ•°æ®åº“æŸ¥è¯¢ç»“æœ**ï¼šå°±åƒå¿«é€’åŒ…è£¹é‡Œçš„æ•£è£…å•†å“
- **ç»“æœé›†æ˜ å°„**ï¼šå°±åƒè£…ç®±å•ï¼Œå‘Šè¯‰ä½ å“ªä¸ªå•†å“æ”¾å“ªä¸ªç›’å­
- **Javaå¯¹è±¡**ï¼šå°±åƒæ•´ç†å¥½çš„æ”¶çº³ç›’ï¼Œæ¯æ ·ä¸œè¥¿éƒ½åœ¨è¯¥åœ¨çš„ä½ç½®

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç»“æœé›†æ˜ å°„



**ğŸ¯ è§£å†³çš„é—®é¢˜**

| **åœºæ™¯** | **é—®é¢˜** | **è§£å†³æ–¹æ¡ˆ** |
|---------|---------|------------|
| **JPQLæŸ¥è¯¢** | è‡ªåŠ¨æ˜ å°„ï¼Œç®€å•ä½†åŠŸèƒ½å—é™ | é€‚åˆæ ‡å‡†æŸ¥è¯¢ |
| **åŸç”ŸSQL** | çµæ´»å¼ºå¤§ï¼Œä½†è¿”å›Object[] | éœ€è¦ç»“æœé›†æ˜ å°„ |
| **å¤æ‚æŸ¥è¯¢** | å¤šè¡¨å…³è”ã€ç»Ÿè®¡è®¡ç®— | è‡ªå®šä¹‰æ˜ å°„è§„åˆ™ |

**ğŸ’­ å®é™…åœºæ™¯ä¸¾ä¾‹**
```
åœºæ™¯1ï¼šç»Ÿè®¡æŸ¥è¯¢
SQLï¼šSELECT user_name, COUNT(*) FROM orders GROUP BY user_name
è¿”å›ï¼šObject[] {ç”¨æˆ·å, è®¢å•æ•°}
éœ€è¦ï¼šè½¬æ¢æˆUserOrderStatså¯¹è±¡

åœºæ™¯2ï¼šå¤šè¡¨å…³è”
SQLï¼šSELECT u.*, o.* FROM user u LEFT JOIN orders o
è¿”å›ï¼šæ··åˆäº†ç”¨æˆ·å’Œè®¢å•çš„æ•°æ®
éœ€è¦ï¼šåˆ†åˆ«æ˜ å°„åˆ°Userå’ŒOrderå¯¹è±¡
```

### 1.3 æ˜ å°„æ–¹å¼å¯¹æ¯”



**ğŸ“Š ä¸‰ç§æ˜ å°„ç­–ç•¥**

```
ğŸ”¸ è‡ªåŠ¨å®ä½“æ˜ å°„
ç”¨é€”ï¼šæŸ¥è¯¢è¿”å›å®Œæ•´å®ä½“æ•°æ®
ä¼˜ç‚¹ï¼šæ— éœ€é…ç½®ï¼Œè‡ªåŠ¨æ˜ å°„
é™åˆ¶ï¼šåˆ—åå¿…é¡»å’Œå±æ€§åä¸€è‡´

ğŸ”¸ å­—æ®µçº§æ˜ å°„  
ç”¨é€”ï¼šåˆ—åå’Œå±æ€§åä¸ä¸€è‡´æ—¶
ä¼˜ç‚¹ï¼šç²¾ç¡®æ§åˆ¶æ¯ä¸ªå­—æ®µ
çµæ´»ï¼šæ”¯æŒå¤æ‚çš„å­—æ®µæ˜ å°„

ğŸ”¸ æ ‡é‡æ˜ å°„
ç”¨é€”ï¼šæŸ¥è¯¢ç»Ÿè®¡æ•°æ®ã€è®¡ç®—ç»“æœ
ä¼˜ç‚¹ï¼šç›´æ¥è¿”å›åŸºç¡€ç±»å‹
é€‚åˆï¼šèšåˆå‡½æ•°ã€countç­‰åœºæ™¯
```

---

## 2. ğŸ“‹ @SqlResultSetMappingæ ¸å¿ƒæ³¨è§£



### 2.1 æ³¨è§£åŸºæœ¬ç”¨æ³•



**ğŸ”¸ æ³¨è§£ç»“æ„è§£æ**
```java
@SqlResultSetMapping(
    name = "æ˜ å°„é…ç½®çš„åç§°",        // ç»™è¿™ä¸ªæ˜ å°„èµ·ä¸ªåå­—
    entities = {...},              // å®šä¹‰å®ä½“æ˜ å°„è§„åˆ™
    columns = {...}                // å®šä¹‰åˆ—æ˜ å°„è§„åˆ™
)
```

**ğŸ’¡ ç†è§£è¦ç‚¹**
- `name`ï¼šå°±åƒç»™æ˜ å°„è§„åˆ™èµ·ä¸ªIDï¼ŒæŸ¥è¯¢æ—¶ç”¨è¿™ä¸ªåå­—å¼•ç”¨
- `entities`ï¼šå‘Šè¯‰JPAå¦‚ä½•æŠŠæŸ¥è¯¢ç»“æœå˜æˆå®ä½“å¯¹è±¡
- `columns`ï¼šå‘Šè¯‰JPAå¦‚ä½•å¤„ç†æ™®é€šçš„åˆ—æ•°æ®

### 2.2 ç®€å•æ˜ å°„ç¤ºä¾‹



**ğŸ“ åŸºç¡€é…ç½®æ¡ˆä¾‹**
```java
// å®ä½“ç±»å®šä¹‰
@Entity
@Table(name = "users")
@SqlResultSetMapping(
    name = "UserMapping",              // æ˜ å°„åç§°
    entities = @EntityResult(          // å®ä½“æ˜ å°„é…ç½®
        entityClass = User.class       // æ˜ å°„åˆ°Userç±»
    )
)
public class User {
    @Id
    private Long id;
    
    @Column(name = "user_name")
    private String name;
    
    private String email;
}
```

**ğŸ” ä½¿ç”¨æ˜ å°„æ‰§è¡ŒæŸ¥è¯¢**
```java
// åœ¨Repositoryæˆ–Serviceä¸­ä½¿ç”¨
@PersistenceContext
private EntityManager em;

public List<User> findUsers() {
    String sql = "SELECT * FROM users WHERE active = 1";
    
    return em.createNativeQuery(sql, "UserMapping")
             .getResultList();
}
```

**ğŸ’­ ä»£ç ç†è§£**
- `@SqlResultSetMapping`ï¼šå®šä¹‰åœ¨å®ä½“ç±»ä¸Šï¼Œå£°æ˜æ˜ å°„è§„åˆ™
- `createNativeQuery(sql, "UserMapping")`ï¼šæ‰§è¡ŒSQLå¹¶ä½¿ç”¨æŒ‡å®šæ˜ å°„
- è¿”å›ç»“æœï¼šè‡ªåŠ¨è½¬æ¢æˆList<User>

### 2.3 æ³¨è§£ä½ç½®è¯´æ˜



**ğŸ“ æ³¨è§£æ”¾ç½®ä½ç½®**

```
ä½ç½®1ï¼šå®ä½“ç±»ä¸Šï¼ˆæœ€å¸¸ç”¨ï¼‰
@Entity
@SqlResultSetMapping(...)
public class User { }

ä½ç½®2ï¼šé…ç½®ç±»ä¸Šï¼ˆå¤šä¸ªæ˜ å°„ï¼‰
@SqlResultSetMappings({
    @SqlResultSetMapping(...),
    @SqlResultSetMapping(...)
})
public class JpaConfig { }
```

---

## 3. ğŸ¯ å®ä½“ç»“æœæ˜ å°„-EntityResult



### 3.1 @EntityResultåŸºæœ¬æ¦‚å¿µ



**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
```
@EntityResultï¼šæŠŠæŸ¥è¯¢ç»“æœæ˜ å°„æˆå®Œæ•´çš„å®ä½“å¯¹è±¡
æœ¬è´¨ï¼šå‘Šè¯‰JPA"è¿™äº›åˆ—æ•°æ®è¦ç»„è£…æˆä¸€ä¸ªå®ä½“"
ä½¿ç”¨åœºæ™¯ï¼šæŸ¥è¯¢è¿”å›çš„æ˜¯å®ä½“è¡¨çš„æ•°æ®
```

### 3.2 åŸºç¡€å®ä½“æ˜ å°„



**ğŸ“ æ ‡å‡†æ˜ å°„é…ç½®**
```java
@Entity
@SqlResultSetMapping(
    name = "UserBasicMapping",
    entities = @EntityResult(
        entityClass = User.class,        // æ˜ å°„ç›®æ ‡ï¼šUserç±»
        fields = {                       // å­—æ®µæ˜ å°„è§„åˆ™
            @FieldResult(
                name = "id",             // Javaå±æ€§å
                column = "user_id"       // æ•°æ®åº“åˆ—å
            ),
            @FieldResult(
                name = "name", 
                column = "user_name"
            )
        }
    )
)
public class User {
    @Id
    private Long id;
    private String name;
    private String email;
}
```

**ğŸ’¡ ç†è§£é‡ç‚¹**
- `entityClass`ï¼šæŒ‡å®šè¦åˆ›å»ºå“ªä¸ªç±»çš„å¯¹è±¡
- `fields`ï¼šå½“åˆ—åå’Œå±æ€§åä¸ä¸€è‡´æ—¶ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šå¯¹åº”å…³ç³»
- å¦‚æœåˆ—åå’Œå±æ€§åä¸€è‡´ï¼Œå¯ä»¥çœç•¥fieldsé…ç½®

### 3.3 å¤šå®ä½“æ˜ å°„



**ğŸ”— å…³è”æŸ¥è¯¢åœºæ™¯**
```java
@SqlResultSetMapping(
    name = "UserWithOrdersMapping",
    entities = {
        @EntityResult(
            entityClass = User.class,
            fields = {
                @FieldResult(name = "id", column = "user_id"),
                @FieldResult(name = "name", column = "user_name")
            }
        ),
        @EntityResult(
            entityClass = Order.class,
            fields = {
                @FieldResult(name = "id", column = "order_id"),
                @FieldResult(name = "amount", column = "order_amount")
            }
        )
    }
)
```

**ğŸ” ä½¿ç”¨ç¤ºä¾‹**
```java
public List<Object[]> findUsersWithOrders() {
    String sql = """
        SELECT 
            u.id as user_id,
            u.name as user_name,
            o.id as order_id,
            o.amount as order_amount
        FROM users u
        LEFT JOIN orders o ON u.id = o.user_id
        """;
    
    List<Object[]> results = em.createNativeQuery(sql, "UserWithOrdersMapping")
                               .getResultList();
    
    // è¿”å›ï¼šObject[] {Userå¯¹è±¡, Orderå¯¹è±¡}
    return results;
}
```

**ğŸ’­ å®è·µç†è§£**
- å¤šå®ä½“æ˜ å°„è¿”å›`Object[]`æ•°ç»„
- æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€ä¸ªå®ä½“å¯¹è±¡
- é€‚åˆå…³è”æŸ¥è¯¢ï¼Œä¸€æ¬¡è·å–å¤šä¸ªå®ä½“

---

## 4. ğŸ”§ å­—æ®µç»“æœæ˜ å°„-FieldResult



### 4.1 @FieldResultæ ¸å¿ƒä½œç”¨



**ğŸ”¸ è§£å†³çš„é—®é¢˜**
```
é—®é¢˜ï¼šæ•°æ®åº“åˆ—åå’ŒJavaå±æ€§åä¸ä¸€è‡´
ä¾‹å¦‚ï¼š
- æ•°æ®åº“ï¼šuser_nameï¼ˆä¸‹åˆ’çº¿é£æ ¼ï¼‰
- Javaï¼šnameï¼ˆé©¼å³°é£æ ¼ï¼‰

è§£å†³ï¼š@FieldResultæ˜ç¡®æŒ‡å®šå¯¹åº”å…³ç³»
```

### 4.2 å­—æ®µæ˜ å°„é…ç½®



**ğŸ“ å…¸å‹åº”ç”¨åœºæ™¯**
```java
@Entity
@Table(name = "products")
@SqlResultSetMapping(
    name = "ProductMapping",
    entities = @EntityResult(
        entityClass = Product.class,
        fields = {
            @FieldResult(name = "id", column = "product_id"),
            @FieldResult(name = "name", column = "product_name"),
            @FieldResult(name = "price", column = "unit_price"),
            @FieldResult(name = "stock", column = "stock_quantity")
        }
    )
)
public class Product {
    @Id
    private Long id;
    private String name;
    private BigDecimal price;
    private Integer stock;
}
```

**ğŸ’¡ é…ç½®è¯´æ˜**
| **å±æ€§** | **å«ä¹‰** | **ç¤ºä¾‹** |
|---------|---------|---------|
| `name` | Javaå®ä½“çš„å±æ€§å | "price" |
| `column` | æ•°æ®åº“çš„åˆ—å | "unit_price" |

### 4.3 åµŒå¥—å¯¹è±¡æ˜ å°„



**ğŸ”— å¤æ‚å¯¹è±¡å¤„ç†**
```java
// è®¢å•å®ä½“åŒ…å«ç”¨æˆ·ä¿¡æ¯
@Entity
@SqlResultSetMapping(
    name = "OrderWithUserMapping",
    entities = @EntityResult(
        entityClass = Order.class,
        fields = {
            @FieldResult(name = "id", column = "order_id"),
            @FieldResult(name = "amount", column = "total_amount"),
            // åµŒå¥—çš„ç”¨æˆ·å¯¹è±¡å­—æ®µæ˜ å°„
            @FieldResult(name = "user.id", column = "user_id"),
            @FieldResult(name = "user.name", column = "user_name")
        }
    )
)
public class Order {
    @Id
    private Long id;
    private BigDecimal amount;
    
    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;
}
```

**ğŸ’­ åµŒå¥—æ˜ å°„ç†è§£**
- ä½¿ç”¨ç‚¹å·`.`è¡¨ç¤ºåµŒå¥—å±æ€§
- `user.id`è¡¨ç¤ºOrderå¯¹è±¡ä¸­userå±æ€§çš„idå­—æ®µ
- æŸ¥è¯¢æ—¶ä¼šè‡ªåŠ¨å¡«å……å…³è”å¯¹è±¡

---

## 5. ğŸ“Š åˆ—ç»“æœæ˜ å°„-ColumnResult



### 5.1 @ColumnResultåŸºæœ¬æ¦‚å¿µ



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
@ColumnResultï¼šæ˜ å°„å•ä¸ªåˆ—çš„å€¼ï¼Œä¸æ˜¯å®Œæ•´å®ä½“
è¿”å›ç±»å‹ï¼šåŸºç¡€ç±»å‹ï¼ˆStringã€Integerã€BigDecimalç­‰ï¼‰
ä½¿ç”¨åœºæ™¯ï¼šç»Ÿè®¡æŸ¥è¯¢ã€èšåˆå‡½æ•°ç»“æœ
```

**ğŸ’¡ å’Œ@FieldResultçš„åŒºåˆ«**
```
@FieldResultï¼š
- æ˜ å°„åˆ°å®ä½“çš„å±æ€§
- ç”¨äºæ„å»ºå®Œæ•´å¯¹è±¡

@ColumnResultï¼š
- æ˜ å°„å•ç‹¬çš„åˆ—å€¼
- ç”¨äºè·å–æ ‡é‡æ•°æ®
```

### 5.2 æ ‡é‡å€¼æ˜ å°„



**ğŸ“ ç®€å•ç»Ÿè®¡æŸ¥è¯¢**
```java
@SqlResultSetMapping(
    name = "UserStatsMapping",
    columns = {
        @ColumnResult(name = "user_name", type = String.class),
        @ColumnResult(name = "order_count", type = Long.class),
        @ColumnResult(name = "total_amount", type = BigDecimal.class)
    }
)
```

**ğŸ” ä½¿ç”¨ç¤ºä¾‹**
```java
public List<Object[]> getUserStats() {
    String sql = """
        SELECT 
            u.name as user_name,
            COUNT(o.id) as order_count,
            SUM(o.amount) as total_amount
        FROM users u
        LEFT JOIN orders o ON u.id = o.user_id
        GROUP BY u.id, u.name
        """;
    
    List<Object[]> results = em.createNativeQuery(sql, "UserStatsMapping")
                               .getResultList();
    
    // è¿”å›ï¼šObject[] {ç”¨æˆ·å, è®¢å•æ•°, æ€»é‡‘é¢}
    return results;
}
```

**ğŸ’­ ç»“æœå¤„ç†**
```java
// è·å–ç»Ÿè®¡ç»“æœ
for (Object[] row : results) {
    String userName = (String) row[0];
    Long orderCount = (Long) row[1];
    BigDecimal totalAmount = (BigDecimal) row[2];
    
    System.out.printf("ç”¨æˆ·: %s, è®¢å•æ•°: %d, æ€»é‡‘é¢: %s%n", 
        userName, orderCount, totalAmount);
}
```

### 5.3 åˆ—æ˜ å°„ç±»å‹è¯´æ˜



**ğŸ“‹ å¸¸ç”¨ç±»å‹é…ç½®**

| **Javaç±»å‹** | **æ•°æ®åº“ç±»å‹** | **ç¤ºä¾‹** |
|------------|-------------|---------|
| `String.class` | VARCHAR | å§“åã€åœ°å€ |
| `Long.class` | BIGINT | IDã€è®¡æ•° |
| `Integer.class` | INT | å¹´é¾„ã€æ•°é‡ |
| `BigDecimal.class` | DECIMAL | é‡‘é¢ã€ä»·æ ¼ |
| `Date.class` | DATE | æ—¥æœŸ |
| `Timestamp.class` | DATETIME | æ—¶é—´æˆ³ |

---

## 6. ğŸ² æ ‡é‡ç»“æœå¤„ç†



### 6.1 ä»€ä¹ˆæ˜¯æ ‡é‡ç»“æœ



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
æ ‡é‡ç»“æœï¼šè¿”å›å•ä¸ªå€¼æˆ–ç®€å•æ•°æ®ç±»å‹çš„æŸ¥è¯¢ç»“æœ
ç‰¹ç‚¹ï¼šä¸æ˜¯å®Œæ•´çš„å®ä½“å¯¹è±¡ï¼Œè€Œæ˜¯åŸºç¡€ç±»å‹çš„å€¼
å¸¸è§åœºæ™¯ï¼šCOUNTã€SUMã€AVGç­‰èšåˆå‡½æ•°
```

**ğŸ’¡ ç”Ÿæ´»åŒ–ç†è§£**
å°±åƒå»è¶…å¸‚ä¹°ä¸œè¥¿ï¼š
- **å®ä½“æ˜ å°„**ï¼šä¹°äº†ä¸€æ•´å¥—å¨å…·ï¼ˆå®Œæ•´å¯¹è±¡ï¼‰
- **æ ‡é‡ç»“æœ**ï¼šåªä¹°äº†ä¸€ä¸ªå‹ºå­ï¼ˆå•ä¸ªå€¼ï¼‰

### 6.2 çº¯æ ‡é‡æŸ¥è¯¢é…ç½®



**ğŸ“ å•å€¼æŸ¥è¯¢ç¤ºä¾‹**
```java
@SqlResultSetMapping(
    name = "CountMapping",
    columns = @ColumnResult(name = "total", type = Long.class)
)

// ä½¿ç”¨é…ç½®
public Long getTotalUsers() {
    String sql = "SELECT COUNT(*) as total FROM users";
    
    return (Long) em.createNativeQuery(sql, "CountMapping")
                   .getSingleResult();
}
```

### 6.3 å¤šæ ‡é‡å€¼æŸ¥è¯¢



**ğŸ“Š å¤æ‚ç»Ÿè®¡åœºæ™¯**
```java
@SqlResultSetMapping(
    name = "ProductStatsMapping",
    columns = {
        @ColumnResult(name = "category", type = String.class),
        @ColumnResult(name = "total_products", type = Long.class),
        @ColumnResult(name = "avg_price", type = BigDecimal.class),
        @ColumnResult(name = "max_price", type = BigDecimal.class),
        @ColumnResult(name = "min_price", type = BigDecimal.class)
    }
)

// æŸ¥è¯¢å•†å“åˆ†ç±»ç»Ÿè®¡
public List<Object[]> getProductStatsByCategory() {
    String sql = """
        SELECT 
            category,
            COUNT(*) as total_products,
            AVG(price) as avg_price,
            MAX(price) as max_price,
            MIN(price) as min_price
        FROM products
        GROUP BY category
        """;
    
    return em.createNativeQuery(sql, "ProductStatsMapping")
            .getResultList();
}
```

**ğŸ’­ ç»“æœè½¬æ¢æŠ€å·§**
```java
// å°†Object[]è½¬æ¢ä¸ºDTO
public class CategoryStats {
    private String category;
    private Long totalProducts;
    private BigDecimal avgPrice;
    private BigDecimal maxPrice;
    private BigDecimal minPrice;
    
    // é™æ€å·¥å‚æ–¹æ³•
    public static CategoryStats from(Object[] row) {
        CategoryStats stats = new CategoryStats();
        stats.category = (String) row[0];
        stats.totalProducts = (Long) row[1];
        stats.avgPrice = (BigDecimal) row[2];
        stats.maxPrice = (BigDecimal) row[3];
        stats.minPrice = (BigDecimal) row[4];
        return stats;
    }
}

// ä½¿ç”¨è½¬æ¢
List<CategoryStats> stats = getProductStatsByCategory().stream()
    .map(CategoryStats::from)
    .collect(Collectors.toList());
```

---

## 7. ğŸ”€ æ··åˆç»“æœé›†å¤„ç†



### 7.1 æ··åˆæ˜ å°„æ¦‚å¿µ



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
æ··åˆç»“æœé›†ï¼šåŒæ—¶åŒ…å«å®ä½“å¯¹è±¡å’Œæ ‡é‡å€¼çš„æŸ¥è¯¢ç»“æœ
åº”ç”¨åœºæ™¯ï¼šæ—¢éœ€è¦å®ä½“ä¿¡æ¯ï¼Œåˆéœ€è¦ç»Ÿè®¡æ•°æ®
è¿”å›ç±»å‹ï¼šObject[]ï¼ŒåŒ…å«å®ä½“å’Œæ ‡é‡çš„æ··åˆ
```

**ğŸ’¡ å®é™…åœºæ™¯ä¸¾ä¾‹**
```
éœ€æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°
è¿”å›ï¼š{Userå¯¹è±¡, è®¢å•æ•°é‡}
```

### 7.2 å®ä½“+æ ‡é‡æ··åˆé…ç½®



**ğŸ“ æ··åˆæ˜ å°„é…ç½®**
```java
@SqlResultSetMapping(
    name = "UserWithOrderCountMapping",
    entities = @EntityResult(
        entityClass = User.class,
        fields = {
            @FieldResult(name = "id", column = "user_id"),
            @FieldResult(name = "name", column = "user_name"),
            @FieldResult(name = "email", column = "user_email")
        }
    ),
    columns = @ColumnResult(name = "order_count", type = Long.class)
)

// ä½¿ç”¨æ··åˆæ˜ å°„
public List<Object[]> getUsersWithOrderCount() {
    String sql = """
        SELECT 
            u.id as user_id,
            u.name as user_name,
            u.email as user_email,
            COUNT(o.id) as order_count
        FROM users u
        LEFT JOIN orders o ON u.id = o.user_id
        GROUP BY u.id, u.name, u.email
        """;
    
    List<Object[]> results = em.createNativeQuery(sql, "UserWithOrderCountMapping")
                               .getResultList();
    
    // è¿”å›ï¼šObject[] {Userå¯¹è±¡, Longè®¢å•æ•°}
    return results;
}
```

**ğŸ’­ ç»“æœå¤„ç†æ–¹å¼**
```java
// æ–¹å¼1ï¼šç›´æ¥ä½¿ç”¨Object[]
for (Object[] row : results) {
    User user = (User) row[0];
    Long orderCount = (Long) row[1];
    
    System.out.printf("ç”¨æˆ·: %s, è®¢å•æ•°: %d%n", 
        user.getName(), orderCount);
}

// æ–¹å¼2ï¼šè½¬æ¢ä¸ºä¸“ç”¨DTO
public class UserWithStats {
    private User user;
    private Long orderCount;
    
    public UserWithStats(User user, Long orderCount) {
        this.user = user;
        this.orderCount = orderCount;
    }
}

List<UserWithStats> userStats = results.stream()
    .map(row -> new UserWithStats((User)row[0], (Long)row[1]))
    .collect(Collectors.toList());
```

### 7.3 å¤æ‚æ··åˆæ˜ å°„å®ä¾‹



**ğŸ¯ å®æˆ˜æ¡ˆä¾‹ï¼šå•†å“è¯¦æƒ…é¡µæ•°æ®**
```java
@SqlResultSetMapping(
    name = "ProductDetailMapping",
    entities = {
        @EntityResult(
            entityClass = Product.class,
            fields = {
                @FieldResult(name = "id", column = "product_id"),
                @FieldResult(name = "name", column = "product_name"),
                @FieldResult(name = "price", column = "product_price")
            }
        ),
        @EntityResult(
            entityClass = Category.class,
            fields = {
                @FieldResult(name = "id", column = "category_id"),
                @FieldResult(name = "name", column = "category_name")
            }
        )
    },
    columns = {
        @ColumnResult(name = "review_count", type = Long.class),
        @ColumnResult(name = "avg_rating", type = BigDecimal.class),
        @ColumnResult(name = "total_sales", type = Integer.class)
    }
)

// æŸ¥è¯¢å•†å“è¯¦æƒ…
public List<Object[]> getProductDetails(Long productId) {
    String sql = """
        SELECT 
            p.id as product_id,
            p.name as product_name,
            p.price as product_price,
            c.id as category_id,
            c.name as category_name,
            COUNT(DISTINCT r.id) as review_count,
            AVG(r.rating) as avg_rating,
            COALESCE(SUM(oi.quantity), 0) as total_sales
        FROM products p
        LEFT JOIN categories c ON p.category_id = c.id
        LEFT JOIN reviews r ON p.id = r.product_id
        LEFT JOIN order_items oi ON p.id = oi.product_id
        WHERE p.id = :productId
        GROUP BY p.id, p.name, p.price, c.id, c.name
        """;
    
    return em.createNativeQuery(sql, "ProductDetailMapping")
            .setParameter("productId", productId)
            .getResultList();
}
```

**ğŸ“Š ç»“æœè§£æ**
```java
// è¿”å›æ ¼å¼ï¼šObject[] {Product, Category, è¯„è®ºæ•°, å¹³å‡è¯„åˆ†, æ€»é”€é‡}
Object[] result = getProductDetails(1L).get(0);

Product product = (Product) result[0];
Category category = (Category) result[1];
Long reviewCount = (Long) result[2];
BigDecimal avgRating = (BigDecimal) result[3];
Integer totalSales = (Integer) result[4];

// ç»„è£…å®Œæ•´çš„å•†å“è¯¦æƒ…DTO
ProductDetailDTO dto = ProductDetailDTO.builder()
    .product(product)
    .category(category)
    .reviewCount(reviewCount)
    .avgRating(avgRating)
    .totalSales(totalSales)
    .build();
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ ç»“æœé›†æ˜ å°„ï¼šæŠŠSQLæŸ¥è¯¢ç»“æœè½¬æ¢æˆJavaå¯¹è±¡çš„è§„åˆ™é…ç½®
ğŸ”¸ @SqlResultSetMappingï¼šå®šä¹‰æ˜ å°„è§„åˆ™çš„æ ¸å¿ƒæ³¨è§£
ğŸ”¸ @EntityResultï¼šå°†æŸ¥è¯¢ç»“æœæ˜ å°„ä¸ºå®Œæ•´å®ä½“å¯¹è±¡
ğŸ”¸ @FieldResultï¼šç²¾ç¡®æ§åˆ¶å­—æ®µå’Œåˆ—çš„å¯¹åº”å…³ç³»
ğŸ”¸ @ColumnResultï¼šæ˜ å°„æ ‡é‡å€¼ï¼ˆåŸºç¡€ç±»å‹ï¼‰
ğŸ”¸ æ··åˆæ˜ å°„ï¼šåŒæ—¶è¿”å›å®ä½“å¯¹è±¡å’Œæ ‡é‡å€¼
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦ç»“æœé›†æ˜ å°„**
```
åœºæ™¯1ï¼šåŸç”ŸSQLæŸ¥è¯¢
- JPQLä¸å¤Ÿç”¨ï¼Œéœ€è¦å†™å¤æ‚SQL
- éœ€è¦ä½¿ç”¨æ•°æ®åº“ç‰¹å®šåŠŸèƒ½
â†’ ä½¿ç”¨ç»“æœé›†æ˜ å°„å¤„ç†è¿”å›ç»“æœ

åœºæ™¯2ï¼šåˆ—åä¸ä¸€è‡´
- æ•°æ®åº“ï¼šuser_nameï¼ˆä¸‹åˆ’çº¿ï¼‰
- Javaï¼šnameï¼ˆé©¼å³°ï¼‰
â†’ ä½¿ç”¨@FieldResultæ˜ç¡®å¯¹åº”å…³ç³»

åœºæ™¯3ï¼šç»Ÿè®¡æŸ¥è¯¢
- COUNTã€SUMã€AVGç­‰èšåˆå‡½æ•°
- éœ€è¦è®¡ç®—ç»“æœè€Œéå®Œæ•´å®ä½“
â†’ ä½¿ç”¨@ColumnResultæ˜ å°„æ ‡é‡å€¼
```

**ğŸ”¹ æ˜ å°„é…ç½®çš„é€‰æ‹©ç­–ç•¥**

| **éœ€æ±‚** | **ä½¿ç”¨æ³¨è§£** | **è¿”å›ç±»å‹** |
|---------|------------|------------|
| æŸ¥è¯¢å®Œæ•´å®ä½“ | `@EntityResult` | å®ä½“å¯¹è±¡ |
| åˆ—åä¸åŒ¹é… | `@FieldResult` | å®ä½“å¯¹è±¡ |
| ç»Ÿè®¡èšåˆ | `@ColumnResult` | åŸºç¡€ç±»å‹ |
| å®ä½“+ç»Ÿè®¡ | æ··åˆé…ç½® | Object[] |

### 8.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ å¼€å‘åœºæ™¯åº”ç”¨**

**åœºæ™¯1ï¼šæŠ¥è¡¨æŸ¥è¯¢**
```java
// éœ€æ±‚ï¼šç”Ÿæˆé”€å”®æŠ¥è¡¨ï¼ˆå•†å“+é”€é‡+é‡‘é¢ï¼‰
@SqlResultSetMapping(
    name = "SalesReportMapping",
    entities = @EntityResult(entityClass = Product.class),
    columns = {
        @ColumnResult(name = "total_quantity", type = Integer.class),
        @ColumnResult(name = "total_revenue", type = BigDecimal.class)
    }
)
```

**åœºæ™¯2ï¼šå¤šè¡¨å…³è”æŸ¥è¯¢**
```java
// éœ€æ±‚ï¼šç”¨æˆ·è®¢å•è¯¦æƒ…ï¼ˆç”¨æˆ·ä¿¡æ¯+è®¢å•åˆ—è¡¨+ç»Ÿè®¡ï¼‰
@SqlResultSetMapping(
    name = "UserOrdersMapping",
    entities = {
        @EntityResult(entityClass = User.class),
        @EntityResult(entityClass = Order.class)
    },
    columns = @ColumnResult(name = "order_total", type = BigDecimal.class)
)
```

**åœºæ™¯3ï¼šæ€§èƒ½ä¼˜åŒ–**
```java
// éœ€æ±‚ï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œé¿å…åŠ è½½æ•´ä¸ªå®ä½“
@SqlResultSetMapping(
    name = "UserBasicInfoMapping",
    columns = {
        @ColumnResult(name = "user_id", type = Long.class),
        @ColumnResult(name = "user_name", type = String.class)
    }
)
```

### 8.4 æœ€ä½³å®è·µå»ºè®®



**âœ… æ¨èåšæ³•**
```
1. å‘½åè§„èŒƒ
   - æ˜ å°„åç§°ï¼šå®ä½“å + ç”¨é€” + "Mapping"
   - ä¾‹å¦‚ï¼šUserOrderStatsMapping

2. é…ç½®ä½ç½®
   - ç®€å•æ˜ å°„ï¼šå®šä¹‰åœ¨å®ä½“ç±»ä¸Š
   - å¤æ‚æ˜ å°„ï¼šå®šä¹‰åœ¨ä¸“é—¨çš„é…ç½®ç±»ä¸Š

3. ç±»å‹å®‰å…¨
   - @ColumnResultæ˜ç¡®æŒ‡å®štypeå±æ€§
   - é¿å…ç±»å‹è½¬æ¢é”™è¯¯

4. ç»“æœè½¬æ¢
   - å¤æ‚ç»“æœå»ºè®®è½¬æ¢ä¸ºDTO
   - ä½¿ç”¨Stream APIä¼˜é›…å¤„ç†
```

**âŒ å¸¸è§è¯¯åŒº**
```
è¯¯åŒº1ï¼šè¿‡åº¦ä½¿ç”¨åŸç”ŸSQL
- èƒ½ç”¨JPQLå°±ç”¨JPQL
- åŸç”ŸSQLä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨

è¯¯åŒº2ï¼šå¿˜è®°é…ç½®ç±»å‹
- @ColumnResultä¸€å®šè¦æŒ‡å®štype
- å¦åˆ™å¯èƒ½å‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸

è¯¯åŒº3ï¼šå­—æ®µåå†™é”™
- @FieldResultçš„nameæ˜¯Javaå±æ€§å
- columnæ‰æ˜¯æ•°æ®åº“åˆ—å
- é¡ºåºä¸è¦æå
```

### 8.5 å­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ“ çŸ¥è¯†ç‚¹è‡ªæ£€**
- [ ] ç†è§£ç»“æœé›†æ˜ å°„çš„ä½œç”¨å’Œåœºæ™¯
- [ ] æŒæ¡@SqlResultSetMappingåŸºæœ¬é…ç½®
- [ ] ä¼šä½¿ç”¨@EntityResultæ˜ å°„å®ä½“
- [ ] ä¼šä½¿ç”¨@FieldResultå¤„ç†åˆ—åä¸ä¸€è‡´
- [ ] ä¼šä½¿ç”¨@ColumnResultæ˜ å°„æ ‡é‡å€¼
- [ ] èƒ½å¤Ÿå¤„ç†æ··åˆç»“æœé›†
- [ ] çŸ¥é“å¦‚ä½•å°†Object[]è½¬æ¢ä¸ºDTO

**ğŸ¯ å®è·µç»ƒä¹ å»ºè®®**
```
ç»ƒä¹ 1ï¼šåŸºç¡€æ˜ å°„
ä»»åŠ¡ï¼šæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œå¤„ç†åˆ—åä¸ä¸€è‡´

ç»ƒä¹ 2ï¼šç»Ÿè®¡æŸ¥è¯¢
ä»»åŠ¡ï¼šæŒ‰åˆ†ç±»ç»Ÿè®¡å•†å“æ•°é‡å’Œå¹³å‡ä»·æ ¼

ç»ƒä¹ 3ï¼šæ··åˆæŸ¥è¯¢
ä»»åŠ¡ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯åŠå…¶è®¢å•ç»Ÿè®¡
```

### 8.6 æ ¸å¿ƒè®°å¿†è¦ç‚¹



**ğŸ”‘ è®°å¿†å£è¯€**
> SQLç»“æœè¦æ˜ å°„ï¼Œä¸‰å¤§æ³¨è§£è¦è®°ç‰¢
> Entityæ˜ å®ä½“ï¼ŒFieldå¤„ç†å­—æ®µç»•
> Columnå­˜æ ‡é‡ï¼Œæ··åˆæŸ¥è¯¢æœ€é«˜æ•ˆ

**ğŸ’¡ å¿«é€ŸæŸ¥æ‰¾æ‰‹å†Œ**

```
éœ€è¦æ˜ å°„å®Œæ•´å®ä½“ï¼Ÿ
â†’ ä½¿ç”¨ @EntityResult

åˆ—åå’Œå±æ€§åä¸ä¸€è‡´ï¼Ÿ
â†’ ä½¿ç”¨ @FieldResult

åªéœ€è¦ç»Ÿè®¡æ•°æ®ï¼Ÿ
â†’ ä½¿ç”¨ @ColumnResult

æ—¢è¦å®ä½“åˆè¦ç»Ÿè®¡ï¼Ÿ
â†’ æ··åˆä½¿ç”¨ entities + columns
```

**ğŸ“š æ‰©å±•å­¦ä¹ å»ºè®®**
- æ·±å…¥å­¦ä¹ ï¼šCriteria APIçš„ç±»å‹å®‰å…¨æŸ¥è¯¢
- è¿›é˜¶ä¸»é¢˜ï¼šSpring Data JPAçš„æŠ•å½±(Projection)
- æ€§èƒ½ä¼˜åŒ–ï¼šæŸ¥è¯¢ä¼˜åŒ–å’ŒN+1é—®é¢˜è§£å†³
- å®æˆ˜é¡¹ç›®ï¼šæ„å»ºå¤æ‚çš„æŠ¥è¡¨æŸ¥è¯¢ç³»ç»Ÿ