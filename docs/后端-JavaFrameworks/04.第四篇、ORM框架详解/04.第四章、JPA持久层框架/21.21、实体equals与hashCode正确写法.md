---
title: 21ã€å®ä½“equalsä¸hashCodeæ­£ç¡®å†™æ³•
---
## ğŸ“š ç›®å½•

1. [ä¸ºä»€ä¹ˆå®ä½“éœ€è¦é‡å†™equalså’ŒhashCode](#1-ä¸ºä»€ä¹ˆå®ä½“éœ€è¦é‡å†™equalså’ŒhashCode)
2. [åŸºäºä¸šåŠ¡å”¯ä¸€é”®å®ç°](#2-åŸºäºä¸šåŠ¡å”¯ä¸€é”®å®ç°)
3. [åŸºäºä¸å¯å˜é”®å®ç°](#3-åŸºäºä¸å¯å˜é”®å®ç°)
4. [é¿å…ä½¿ç”¨å»¶è¿ŸåŠ è½½å­—æ®µ](#4-é¿å…ä½¿ç”¨å»¶è¿ŸåŠ è½½å­—æ®µ)
5. [ä»£ç†å¯¹è±¡å…¼å®¹æ€§å¤„ç†](#5-ä»£ç†å¯¹è±¡å…¼å®¹æ€§å¤„ç†)
6. [Seté›†åˆå»é‡é™·é˜±](#6-Seté›†åˆå»é‡é™·é˜±)
7. [æ€§èƒ½ä¼˜åŒ–è€ƒè™‘](#7-æ€§èƒ½ä¼˜åŒ–è€ƒè™‘)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” ä¸ºä»€ä¹ˆå®ä½“éœ€è¦é‡å†™equalså’ŒhashCode


### 1.1 æ—¥å¸¸ç”Ÿæ´»ä¸­çš„"ç›¸ç­‰"æ¦‚å¿µ

æƒ³è±¡ä½ åœ¨è¶…å¸‚ä¹°è‹¹æœï¼Œä»€ä¹ˆæ—¶å€™ä¸¤ä¸ªè‹¹æœç®—"ç›¸åŒ"ï¼Ÿ

```
åœºæ™¯1ï¼šæ¯”è¾ƒä¸¤ä¸ªè‹¹æœ
æ–¹å¼Aï¼šçœ‹å†…å­˜åœ°å€ â†’ åªæœ‰æ˜¯åŒä¸€ä¸ªè‹¹æœæ‰ç®—ç›¸åŒï¼ˆ== æ¯”è¾ƒï¼‰
æ–¹å¼Bï¼šçœ‹å“ç§+äº§åœ° â†’ åŒå“ç§åŒäº§åœ°å°±ç®—ç›¸åŒï¼ˆequalsæ¯”è¾ƒï¼‰

JPAå®ä½“çš„æ¯”è¾ƒä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼š
- == æ¯”è¾ƒï¼šåªçœ‹å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå®ä¾‹
- equalsï¼šçœ‹ä¸šåŠ¡å«ä¹‰ä¸Šæ˜¯å¦ä»£è¡¨åŒä¸€ä¸ªäº‹ç‰©
```

### 1.2 JPAä¸­çš„å®é™…é—®é¢˜

**ğŸ¯ æ ¸å¿ƒé—®é¢˜**ï¼šJPAä¸­çš„å®ä½“å¯¹è±¡ä¼šé‡åˆ°è¿™äº›æƒ…å†µ

```
é—®é¢˜åœºæ™¯æ¼”ç¤ºï¼š

1. Seté›†åˆå»é‡é—®é¢˜
   Set<User> users = new HashSet<>();
   User user1 = userRepository.findById(1L);
   User user2 = userRepository.findById(1L);
   users.add(user1);
   users.add(user2);
   
   æœŸæœ›ï¼šSetä¸­åªæœ‰1ä¸ªç”¨æˆ·
   ç°å®ï¼šå¦‚æœæ²¡é‡å†™equals/hashCodeï¼Œå¯èƒ½æœ‰2ä¸ªï¼

2. å…³è”å…³ç³»æ¯”è¾ƒé—®é¢˜
   Order order = new Order();
   User user = userRepository.findById(1L);
   order.setUser(user);
   
   if (order.getUser().equals(æŸä¸ªuserå¯¹è±¡)) {
       // åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªç”¨æˆ·
   }
```

**ğŸ’¡ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™äº›é—®é¢˜**
```
JPAçš„å¯¹è±¡ç‰¹ç‚¹ï¼š

1. åŒä¸€ä¸ªæ•°æ®åº“è®°å½•å¯èƒ½å¯¹åº”å¤šä¸ªJavaå¯¹è±¡
   - ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼šåˆ›å»ºå¯¹è±¡A
   - ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼šåˆ›å»ºå¯¹è±¡B
   - å®ƒä»¬IDç›¸åŒï¼Œä½†æ˜¯ä¸åŒçš„Javaå¯¹è±¡

2. é›†åˆæ“ä½œä¾èµ–equalså’ŒhashCode
   - HashSetåˆ¤æ–­é‡å¤ï¼šå…ˆç”¨hashCodeå¿«é€Ÿç­›é€‰ï¼Œå†ç”¨equalsç¡®è®¤
   - Listçš„containsæ–¹æ³•ï¼šç”¨equalsæ¯”è¾ƒ
   - Mapçš„keyæŸ¥æ‰¾ï¼šç”¨hashCodeå’Œequalsé…åˆ
```

### 1.3 ä¸é‡å†™ä¼šå¯¼è‡´çš„åæœ

**âš ï¸ å¸¸è§é—®é¢˜åˆ—è¡¨**

| é—®é¢˜åœºæ™¯ | **è¡¨ç°** | **åæœ** |
|---------|---------|---------|
| ğŸ”¸ **Seté›†åˆ** | `åŒä¸€æ•°æ®å¤šæ¬¡æ·»åŠ ` | `å»é‡å¤±æ•ˆï¼Œæ•°æ®é‡å¤` |
| ğŸ”¸ **å…³è”å…³ç³»** | `containsåˆ¤æ–­å¤±è´¥` | `ä¸šåŠ¡é€»è¾‘é”™è¯¯` |
| ğŸ”¸ **ç¼“å­˜å¤±æ•ˆ** | `æ— æ³•è¯†åˆ«ç›¸åŒå¯¹è±¡` | `æ€§èƒ½ä¸‹é™` |
| ğŸ”¸ **çŠ¶æ€åŒæ­¥** | `å¯¹è±¡çŠ¶æ€ä¸ä¸€è‡´` | `æ•°æ®æ··ä¹±` |

---

## 2. ğŸ”‘ åŸºäºä¸šåŠ¡å”¯ä¸€é”®å®ç°


### 2.1 ä»€ä¹ˆæ˜¯ä¸šåŠ¡å”¯ä¸€é”®

**ğŸ“‹ é€šä¿—ç†è§£**ï¼šä¸šåŠ¡å”¯ä¸€é”®å°±æ˜¯èƒ½å”¯ä¸€æ ‡è¯†ä¸€ä¸ªäº‹ç‰©çš„ä¸šåŠ¡å±æ€§

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š

äººçš„å”¯ä¸€æ ‡è¯†ï¼š
- èº«ä»½è¯å· â† ä¸šåŠ¡å”¯ä¸€é”®ï¼ˆå›½å®¶å±‚é¢ï¼‰
- æ‰‹æœºå· â† ä¸šåŠ¡å”¯ä¸€é”®ï¼ˆé€šä¿¡å±‚é¢ï¼‰
- å‘˜å·¥å·¥å· â† ä¸šåŠ¡å”¯ä¸€é”®ï¼ˆå…¬å¸å†…éƒ¨ï¼‰

ç”µå•†è®¢å•çš„å”¯ä¸€æ ‡è¯†ï¼š
- è®¢å•å· â† ä¸šåŠ¡å”¯ä¸€é”®
- ä¸æ˜¯è®¢å•IDï¼ˆæ•°æ®åº“è‡ªå¢IDï¼‰

ç”¨æˆ·è´¦æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼š
- ç”¨æˆ·å â† ä¸šåŠ¡å”¯ä¸€é”®
- é‚®ç®± â† ä¹Ÿå¯ä»¥æ˜¯ä¸šåŠ¡å”¯ä¸€é”®
- ä¸æ˜¯ç”¨æˆ·ID
```

### 2.2 æ¨èåšæ³•ï¼šä½¿ç”¨ä¸šåŠ¡å”¯ä¸€é”®

**âœ… æœ€ä½³å®è·µç¤ºä¾‹**

```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String username;  // ä¸šåŠ¡å”¯ä¸€é”®
    
    private String email;
    private String nickname;
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;  // åŒä¸€ä¸ªå¯¹è±¡ç›´æ¥è¿”å›true
        if (o == null || getClass() != o.getClass()) return false;
        
        User user = (User) o;
        // åŸºäºä¸šåŠ¡å”¯ä¸€é”®usernameæ¯”è¾ƒ
        return username != null && username.equals(user.username);
    }
    
    @Override
    public int hashCode() {
        // ä½¿ç”¨å›ºå®šå€¼æˆ–ä¸šåŠ¡å”¯ä¸€é”®
        return username != null ? username.hashCode() : 0;
    }
}
```

**ğŸ” ä¸ºä»€ä¹ˆè¿™æ ·å†™**
```
è®¾è®¡æ€è·¯åˆ†æï¼š

1. ä¸ºä»€ä¹ˆä¸ç”¨IDï¼Ÿ
   æ–°å¯¹è±¡ï¼šid = null
   ä¿å­˜åï¼šid = 1
   
   é—®é¢˜ï¼šä¿å­˜å‰åhashCodeä¼šå˜åŒ–
   åæœï¼šåœ¨Setä¸­çš„å¯¹è±¡ä¼š"ä¸¢å¤±"
   
   Set<User> users = new HashSet<>();
   User user = new User("alice");  // id = null
   users.add(user);  // æ­¤æ—¶hashCodeåŸºäºnull
   userRepository.save(user);  // id = 1
   users.contains(user);  // æ‰¾ä¸åˆ°ï¼hashCodeå˜äº†

2. ä¸ºä»€ä¹ˆç”¨usernameï¼Ÿ
   ç‰¹ç‚¹ï¼šä¸€æ—¦è®¾ç½®å°±ä¸ä¼šå˜
   ä¿è¯ï¼šä¿å­˜å‰åhashCodeä¸å˜
   ä¸šåŠ¡ï¼šä»£è¡¨ç”¨æˆ·çš„çœŸå®èº«ä»½
```

### 2.3 å¤šå­—æ®µç»„åˆå”¯ä¸€é”®

**ğŸ”— å¤åˆä¸šåŠ¡é”®ç¤ºä¾‹**

```java
@Entity
public class OrderItem {
    @Id
    @GeneratedValue
    private Long id;
    
    @ManyToOne
    private Order order;      // è®¢å•
    
    @ManyToOne  
    private Product product;  // å•†å“
    
    private Integer quantity;
    
    // ä¸šåŠ¡è§„åˆ™ï¼šåŒä¸€è®¢å•ä¸­ï¼ŒåŒä¸€å•†å“åªèƒ½æœ‰ä¸€æ¡è®°å½•
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        
        OrderItem item = (OrderItem) o;
        
        // ç”¨orderå’Œproductç»„åˆåˆ¤æ–­
        return order != null && order.equals(item.order) &&
               product != null && product.equals(item.product);
    }
    
    @Override
    public int hashCode() {
        // ä½¿ç”¨Objects.hashç»„åˆå¤šä¸ªå­—æ®µ
        return Objects.hash(order, product);
    }
}
```

**ğŸ’¡ ç»„åˆé”®çš„é€‰æ‹©åŸåˆ™**
```
å¦‚ä½•é€‰æ‹©ç»„åˆå­—æ®µï¼š

âœ… å¥½çš„ç»„åˆé”®ç‰¹å¾ï¼š
- ä¸šåŠ¡ä¸Šèƒ½å”¯ä¸€ç¡®å®šå¯¹è±¡
- å­—æ®µå€¼ç¨³å®šï¼Œä¸ä¼šé¢‘ç¹å˜åŒ–
- å­—æ®µåœ¨å¯¹è±¡åˆ›å»ºæ—¶å°±èƒ½ç¡®å®š

âŒ ä¸å¥½çš„ç»„åˆé”®ï¼š
- åŒ…å«å¯èƒ½ä¸ºnullçš„å­—æ®µ
- åŒ…å«ç»å¸¸å˜åŒ–çš„å­—æ®µ
- åŒ…å«å»¶è¿ŸåŠ è½½çš„å…³è”å¯¹è±¡
```

---

## 3. ğŸ”’ åŸºäºä¸å¯å˜é”®å®ç°


### 3.1 ä»€ä¹ˆæ˜¯ä¸å¯å˜é”®

**ğŸ¯ ç®€å•ç†è§£**ï¼šä¸€æ—¦è®¾ç½®å°±æ°¸è¿œä¸ä¼šæ”¹å˜çš„å­—æ®µ

```
æ—¥å¸¸ç±»æ¯”ï¼š

å¯å˜çš„ä¸œè¥¿ï¼š
- äººçš„ä½“é‡ â† ä¼šå˜åŒ–
- æ‰‹æœºå·ç  â† å¯ä»¥æ¢å·
- å…¬å¸èŒä½ â† ä¼šå‡èŒé™èŒ

ä¸å¯å˜çš„ä¸œè¥¿ï¼š
- èº«ä»½è¯å· â† ç»ˆèº«ä¸å˜
- å‡ºç”Ÿæ—¥æœŸ â† æ°¸è¿œå›ºå®š
- UUID â† åˆ›å»ºæ—¶ç”Ÿæˆï¼Œä¸å†æ”¹å˜

JPAå®ä½“ä¸­çš„ä¸å¯å˜é”®ï¼š
- è‡ªç„¶ä¸»é”®ï¼ˆå¦‚èº«ä»½è¯å·ï¼‰
- UUIDå­—æ®µ
- åˆ›å»ºæ—¶é—´æˆ³
```

### 3.2 ä½¿ç”¨UUIDä½œä¸ºä¸å¯å˜é”®

**âœ… UUIDå®ç°æ–¹å¼**

```java
@Entity
public class Product {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    // UUIDä½œä¸ºä¸šåŠ¡å”¯ä¸€é”®ï¼ˆä¸å¯å˜ï¼‰
    @Column(unique = true, nullable = false, updatable = false)
    private String uuid;
    
    private String name;
    private BigDecimal price;
    
    // æ„é€ å‡½æ•°ä¸­ç”ŸæˆUUID
    public Product() {
        this.uuid = UUID.randomUUID().toString();
    }
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        
        Product product = (Product) o;
        return uuid != null && uuid.equals(product.uuid);
    }
    
    @Override
    public int hashCode() {
        return uuid != null ? uuid.hashCode() : 0;
    }
}
```

**ğŸ” UUIDçš„ä¼˜åŠ¿åˆ†æ**
```
ä¸ºä»€ä¹ˆUUIDæ˜¯å¥½é€‰æ‹©ï¼š

1. çœŸæ­£çš„ä¸å¯å˜æ€§
   åˆ›å»ºæ—¶ç”Ÿæˆ â†’ æ°¸è¿œä¸å˜
   æ•°æ®åº“çº¦æŸ â†’ updatable = false
   
2. å…¨å±€å”¯ä¸€æ€§
   ä¸ä¾èµ–æ•°æ®åº“ â†’ åˆ†å¸ƒå¼ç¯å¢ƒå‹å¥½
   ä¸ä¼šå†²çª â†’ åˆå¹¶æ•°æ®æ—¶å®‰å…¨
   
3. ç”Ÿå‘½å‘¨æœŸå®Œæ•´
   å¯¹è±¡åˆ›å»ºæ—¶å°±æœ‰å€¼ â†’ ä¸ä¼šæ˜¯null
   ä¿å­˜å‰åä¸å˜ â†’ hashCodeç¨³å®š

ä½¿ç”¨åœºæ™¯ï¼š
âœ… åˆ†å¸ƒå¼ç³»ç»Ÿ
âœ… éœ€è¦ç¦»çº¿æ“ä½œçš„åº”ç”¨
âœ… æ•°æ®éœ€è¦è·¨ç³»ç»Ÿä¼ è¾“
```

### 3.3 ä¸å¯å˜é”®çš„å®ç°è§„èŒƒ

**ğŸ“‹ è®¾ç½®ä¸å¯å˜æ€§çš„æ–¹æ³•**

```java
// æ–¹æ³•1ï¼šfinalå­—æ®µï¼ˆå¼ºåˆ¶ä¸å¯å˜ï¼‰
@Entity
public class Document {
    @Id
    @GeneratedValue
    private Long id;
    
    @Column(unique = true, nullable = false)
    private final String documentNumber;  // finalä¿®é¥°
    
    // å¿…é¡»é€šè¿‡æ„é€ å‡½æ•°è®¾ç½®
    public Document(String documentNumber) {
        this.documentNumber = documentNumber;
    }
    
    protected Document() {
        this.documentNumber = generateDocumentNumber();
    }
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Document doc = (Document) o;
        return documentNumber.equals(doc.documentNumber);
    }
    
    @Override
    public int hashCode() {
        return documentNumber.hashCode();
    }
}

// æ–¹æ³•2ï¼šæ•°æ®åº“çº¦æŸï¼ˆé˜²æ­¢ä¿®æ”¹ï¼‰
@Column(unique = true, nullable = false, updatable = false)
private String naturalKey;

// æ–¹æ³•3ï¼šä¸šåŠ¡é€»è¾‘ä¿æŠ¤
public void setBusinessKey(String key) {
    if (this.businessKey != null) {
        throw new IllegalStateException("ä¸šåŠ¡é”®ä¸å¯ä¿®æ”¹ï¼");
    }
    this.businessKey = key;
}
```

---

## 4. âš ï¸ é¿å…ä½¿ç”¨å»¶è¿ŸåŠ è½½å­—æ®µ


### 4.1 å»¶è¿ŸåŠ è½½å¸¦æ¥çš„é—®é¢˜

**ğŸ¯ é—®é¢˜æ ¹æº**ï¼šå»¶è¿ŸåŠ è½½çš„å­—æ®µå¯èƒ½è¿˜æ²¡åŠ è½½å°±è¦ç”¨

```
å…¸å‹é”™è¯¯ç¤ºä¾‹ï¼š

@Entity
public class Order {
    @Id
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)  // å»¶è¿ŸåŠ è½½
    private User user;
    
    // âŒ é”™è¯¯ï¼šåœ¨equalsä¸­ä½¿ç”¨å»¶è¿ŸåŠ è½½å­—æ®µ
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        
        Order order = (Order) o;
        return user.equals(order.user);  // å¯èƒ½è§¦å‘æ‡’åŠ è½½ï¼
    }
}

é—®é¢˜åœºæ™¯ï¼š
Set<Order> orders = new HashSet<>();
Order order1 = orderRepository.findById(1L);  // useræ˜¯ä»£ç†å¯¹è±¡
entityManager.detach(order1);  // è„±ç¦»æŒä¹…åŒ–ä¸Šä¸‹æ–‡

orders.add(order1);  // equalsè¢«è°ƒç”¨
// æ­¤æ—¶è®¿é—®userä¼šæŠ›å‡ºLazyInitializationExceptionï¼
```

**ğŸ’¥ å®é™…æŠ¥é”™å±•ç¤º**
```
org.hibernate.LazyInitializationException: 
could not initialize proxy - no Session

åŸå› åˆ†æï¼š
1. userå­—æ®µæ˜¯å»¶è¿ŸåŠ è½½çš„ä»£ç†å¯¹è±¡
2. å®ä½“å·²ç»è„±ç¦»Sessionï¼ˆdetachçŠ¶æ€ï¼‰
3. equalsæ–¹æ³•è®¿é—®userå±æ€§
4. ä»£ç†æ— æ³•åŠ è½½çœŸå®æ•°æ® â†’ å¼‚å¸¸
```

### 4.2 æ­£ç¡®çš„å­—æ®µé€‰æ‹©

**âœ… å®‰å…¨çš„equalså®ç°**

```java
@Entity
public class Order {
    @Id
    @GeneratedValue
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String orderNumber;  // ä¸šåŠ¡å”¯ä¸€é”®ï¼ˆéå»¶è¿Ÿï¼‰
    
    @ManyToOne(fetch = FetchType.LAZY)
    private User user;  // å…³è”å­—æ®µï¼ˆå»¶è¿ŸåŠ è½½ï¼‰
    
    @ManyToOne(fetch = FetchType.LAZY)
    private Address shippingAddress;
    
    // âœ… æ­£ç¡®ï¼šä½¿ç”¨éå»¶è¿Ÿå­—æ®µ
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        
        Order order = (Order) o;
        return orderNumber != null && 
               orderNumber.equals(order.orderNumber);
    }
    
    @Override
    public int hashCode() {
        return orderNumber != null ? orderNumber.hashCode() : 0;
    }
}
```

**ğŸ” å­—æ®µé€‰æ‹©æ£€æŸ¥æ¸…å•**
```
equals/hashCodeå­—æ®µé€‰æ‹©è§„åˆ™ï¼š

âœ… å¯ä»¥ä½¿ç”¨çš„å­—æ®µï¼š
- åŸºæœ¬ç±»å‹å­—æ®µï¼ˆString, Integerç­‰ï¼‰
- @Columnæ ‡æ³¨çš„æ™®é€šå­—æ®µ
- ç«‹å³åŠ è½½çš„å…³è”ï¼ˆFetchType.EAGERï¼‰
- ä¸å¯å˜çš„ä¸šåŠ¡å­—æ®µ

âŒ é¿å…ä½¿ç”¨çš„å­—æ®µï¼š
- @ManyToOne(fetch = LAZY)
- @OneToOne(fetch = LAZY)  
- @OneToMany é›†åˆ
- @ManyToMany é›†åˆ
- ä»»ä½•å¯èƒ½æ˜¯ä»£ç†å¯¹è±¡çš„å­—æ®µ
```

### 4.3 å…³è”å¯¹è±¡çš„ç‰¹æ®Šå¤„ç†

**ğŸ”§ å¦‚æœå¿…é¡»ç”¨å…³è”å¯¹è±¡**

```java
@Entity
public class OrderItem {
    @Id
    @GeneratedValue
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private Order order;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private Product product;
    
    // åœºæ™¯ï¼šä¸šåŠ¡ä¸Šéœ€è¦ç”¨orderå’Œproductç»„åˆä½œä¸ºå”¯ä¸€é”®
    
    // âœ… æ–¹æ¡ˆ1ï¼šä½¿ç”¨å…³è”å¯¹è±¡çš„IDï¼ˆæ¨èï¼‰
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        
        OrderItem item = (OrderItem) o;
        
        // ç›´æ¥è·å–IDï¼Œä¸è§¦å‘æ‡’åŠ è½½
        Long orderId = order != null ? order.getId() : null;
        Long itemOrderId = item.order != null ? item.order.getId() : null;
        
        Long productId = product != null ? product.getId() : null;
        Long itemProductId = item.product != null ? item.product.getId() : null;
        
        return Objects.equals(orderId, itemOrderId) &&
               Objects.equals(productId, itemProductId);
    }
    
    @Override
    public int hashCode() {
        Long orderId = order != null ? order.getId() : null;
        Long productId = product != null ? product.getId() : null;
        return Objects.hash(orderId, productId);
    }
    
    // âœ… æ–¹æ¡ˆ2ï¼šå†—ä½™ä¸šåŠ¡é”®å­—æ®µ
    @Column(name = "order_number")
    private String orderNumber;  // å†—ä½™orderçš„ä¸šåŠ¡é”®
    
    @Column(name = "product_code")
    private String productCode;  // å†—ä½™productçš„ä¸šåŠ¡é”®
    
    // ä½¿ç”¨å†—ä½™å­—æ®µå®ç°equals
    // ...
}
```

---

## 5. ğŸ­ ä»£ç†å¯¹è±¡å…¼å®¹æ€§å¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯ä»£ç†å¯¹è±¡

**ğŸ¯ ç®€å•ç†è§£**ï¼šHibernateçš„"æ›¿èº«"æœºåˆ¶

```
ç”Ÿæ´»ç±»æ¯”ï¼š

æ˜æ˜Ÿå’Œæ›¿èº«ï¼š
- ç²‰ä¸è¿œè¿œçœ‹ â†’ æ›¿èº«å°±å¤Ÿäº†ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰
- éœ€è¦ç­¾åæ—¶ â†’ çœŸäººå‡ºåœºï¼ˆè§¦å‘åŠ è½½ï¼‰

JPAçš„ä»£ç†å¯¹è±¡ï¼š
- ä¸è®¿é—®å±æ€§ â†’ ç”¨ä»£ç†å¯¹è±¡ï¼ˆèŠ‚çœå†…å­˜ï¼‰
- è®¿é—®å±æ€§æ—¶ â†’ åŠ è½½çœŸå®å¯¹è±¡ï¼ˆæŸ¥æ•°æ®åº“ï¼‰

ä»£ç†å¯¹è±¡çš„ç‰¹ç‚¹ï¼š
User user = entityManager.getReference(User.class, 1L);
// useræ˜¯ä»£ç†å¯¹è±¡ï¼Œä¸æ˜¯çœŸå®Userå¯¹è±¡
// user.getClass() != User.class
// user instanceof User â†’ true
```

### 5.2 ä»£ç†å¯¹è±¡å¯¼è‡´çš„equalsé—®é¢˜

**âŒ å¸¸è§é”™è¯¯åœºæ™¯**

```java
@Entity
public class Article {
    @Id
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private User author;
    
    // âŒ é—®é¢˜ä»£ç 
    @Override
    public boolean equals(Object o) {
        if (o == null || getClass() != o.getClass()) return false;
        // å½“authoræ˜¯ä»£ç†å¯¹è±¡æ—¶ï¼ŒgetClass()è¿”å›ä»£ç†ç±»
        // User$$HibernateProxy != User.class â†’ è¿”å›false
        
        Article article = (Article) o;
        return author.equals(article.author);
    }
}

// é—®é¢˜æ¼”ç¤º
Article article1 = new Article();
article1.setAuthor(realUserObject);  // çœŸå®Userå¯¹è±¡

Article article2 = new Article();  
article2.setAuthor(proxyUserObject);  // ä»£ç†Userå¯¹è±¡

article1.equals(article2);  // falseï¼å³ä½¿æ˜¯åŒä¸€ä¸ªç”¨æˆ·
```

### 5.3 å…¼å®¹ä»£ç†å¯¹è±¡çš„æ­£ç¡®å†™æ³•

**âœ… Hibernateæ¨èåšæ³•**

```java
@Entity
public class Article {
    @Id
    private Long id;
    
    private String title;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private User author;
    
    // âœ… æ–¹æ¡ˆ1ï¼šä½¿ç”¨instanceofï¼ˆæ¨èï¼‰
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null) return false;
        
        // ç”¨instanceofä»£æ›¿getClass()
        if (!(o instanceof Article)) return false;
        
        Article article = (Article) o;
        return id != null && id.equals(article.id);
    }
    
    // âœ… æ–¹æ¡ˆ2ï¼šä½¿ç”¨Hibernateå·¥å…·ç±»
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null) return false;
        
        // Hibernate.getClass()èƒ½è·å–ä»£ç†èƒŒåçš„çœŸå®ç±»
        if (Hibernate.getClass(this) != Hibernate.getClass(o)) {
            return false;
        }
        
        Article article = (Article) o;
        return id != null && id.equals(article.id);
    }
}
```

**ğŸ” ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| ğŸ”¸ **instanceof** | `ç®€å•ç›´æ¥ï¼Œæ— éœ€ä¾èµ–` | `å­ç±»å¯¹è±¡ä¹Ÿè¿”å›true` | `æ— ç»§æ‰¿å…³ç³»çš„å®ä½“` |
| ğŸ”¸ **Hibernate.getClass()** | `ç²¾ç¡®åˆ¤æ–­ç±»å‹` | `ä¾èµ–Hibernate API` | `æœ‰ç»§æ‰¿å…³ç³»çš„å®ä½“` |

### 5.4 å®Œæ•´çš„ä»£ç†å®‰å…¨å®ç°

**ğŸ›¡ï¸ ç”Ÿäº§çº§ä»£ç æ¨¡æ¿**

```java
@Entity
public class Order {
    @Id
    @GeneratedValue
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String orderNumber;
    
    @ManyToOne(fetch = FetchType.LAZY)
    private User user;
    
    @Override
    public boolean equals(Object o) {
        // 1. åŒä¸€å¯¹è±¡æ£€æŸ¥
        if (this == o) return true;
        
        // 2. nullæ£€æŸ¥
        if (o == null) return false;
        
        // 3. ç±»å‹æ£€æŸ¥ï¼ˆå…¼å®¹ä»£ç†ï¼‰
        if (!(o instanceof Order)) return false;
        
        Order order = (Order) o;
        
        // 4. ä¸šåŠ¡é”®æ¯”è¾ƒ
        return orderNumber != null && 
               orderNumber.equals(order.orderNumber);
    }
    
    @Override
    public int hashCode() {
        // ä½¿ç”¨å›ºå®šç®—æ³•ï¼Œå…¼å®¹ä»£ç†å¯¹è±¡
        return orderNumber != null ? orderNumber.hashCode() : 0;
    }
    
    // Lombokç”¨æˆ·æ³¨æ„ï¼šä¸è¦ç”¨@EqualsAndHashCode
    // è¦è‡ªå·±æ‰‹å†™æˆ–ç”¨@EqualsAndHashCode(onlyExplicitlyIncluded = true)
}
```

---

## 6. ğŸª£ Seté›†åˆå»é‡é™·é˜±


### 6.1 Setå»é‡çš„å·¥ä½œåŸç†

**ğŸ¯ åº•å±‚æœºåˆ¶è§£æ**

```
HashSetçš„å»é‡é€»è¾‘ï¼š

æ­¥éª¤1ï¼šè®¡ç®—hashCode
  object.hashCode() â†’ å¾—åˆ°å“ˆå¸Œå€¼

æ­¥éª¤2ï¼šæ‰¾åˆ°å¯¹åº”çš„"æ¡¶"
  hashValue % bucketSize â†’ ç¡®å®šå­˜å‚¨ä½ç½®

æ­¥éª¤3ï¼šæ£€æŸ¥"æ¡¶"å†…æ˜¯å¦æœ‰ç›¸åŒå¯¹è±¡
  éå†æ¡¶å†…å¯¹è±¡ï¼Œç”¨equalsæ¯”è¾ƒ

æ­¥éª¤4ï¼šå†³å®šæ˜¯å¦æ·»åŠ 
  - equalsè¿”å›true â†’ è®¤ä¸ºé‡å¤ï¼Œä¸æ·»åŠ 
  - equalsè¿”å›false â†’ ä¸é‡å¤ï¼Œæ·»åŠ è¿›å»

å…³é”®ç»“è®ºï¼š
hashCodeç›¸åŒ + equalsè¿”å›true â†’ æ‰ç®—é‡å¤
```

### 6.2 å…¸å‹é™·é˜±åœºæ™¯

**âŒ é—®é¢˜æ¡ˆä¾‹åˆ†æ**

```java
// é™·é˜±1ï¼šä½¿ç”¨å¯å˜å­—æ®µ
@Entity
public class User {
    @Id
    @GeneratedValue
    private Long id;
    
    private String username;  // å¯å˜å­—æ®µ
    private String email;
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return username.equals(user.username);  // åŸºäºusername
    }
    
    @Override
    public int hashCode() {
        return username.hashCode();  // hashCodeä¹ŸåŸºäºusername
    }
}

// é—®é¢˜æ¼”ç¤º
Set<User> users = new HashSet<>();
User user = new User();
user.setUsername("alice");
users.add(user);  // hashCode = "alice".hashCode()

user.setUsername("bob");  // ä¿®æ”¹äº†username
// æ­¤æ—¶ï¼šhashCodeå˜äº†ï¼Œä½†å¯¹è±¡è¿˜åœ¨åŸæ¥çš„æ¡¶é‡Œ
// ç»“æœï¼šåœ¨Setä¸­"ä¸¢å¤±"äº†è¿™ä¸ªå¯¹è±¡ï¼

users.contains(user);  // falseï¼æ‰¾ä¸åˆ°äº†
```

**ğŸ’¥ "ä¸¢å¤±"å¯¹è±¡çš„åæœ**
```
å®é™…å½±å“ï¼š

1. containsåˆ¤æ–­å¤±è´¥
   users.contains(user) â†’ false
   æ˜æ˜å¯¹è±¡åœ¨é›†åˆé‡Œï¼Œå´æ‰¾ä¸åˆ°

2. é‡å¤æ·»åŠ æˆåŠŸ
   users.add(user) â†’ æ·»åŠ æˆåŠŸ
   åŒä¸€ä¸ªå¯¹è±¡è¢«æ·»åŠ å¤šæ¬¡

3. removeå¤±è´¥
   users.remove(user) â†’ å¤±è´¥
   æ— æ³•åˆ é™¤"ä¸¢å¤±"çš„å¯¹è±¡

4. å†…å­˜æ³„æ¼
   å¯¹è±¡æ— æ³•è¢«æ­£å¸¸ç§»é™¤ â†’ æŒç»­å ç”¨å†…å­˜
```

### 6.3 æ­£ç¡®çš„Setä½¿ç”¨æ–¹å¼

**âœ… å®‰å…¨å®è·µæŒ‡å—**

```java
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨ä¸å¯å˜ä¸šåŠ¡é”®
@Entity  
public class Product {
    @Id
    @GeneratedValue
    private Long id;
    
    @Column(unique = true, nullable = false, updatable = false)
    private String productCode;  // ä¸å¯å˜
    
    private String name;  // å¯å˜ï¼Œä¸ç”¨äºequals
    private BigDecimal price;  // å¯å˜ï¼Œä¸ç”¨äºequals
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Product)) return false;
        Product product = (Product) o;
        return productCode != null && 
               productCode.equals(product.productCode);
    }
    
    @Override
    public int hashCode() {
        return productCode != null ? productCode.hashCode() : 0;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
Set<Product> products = new HashSet<>();
Product product = new Product();
product.setProductCode("P001");  // è®¾ç½®åä¸å†æ”¹å˜
products.add(product);

product.setName("New Name");  // ä¿®æ”¹å…¶ä»–å­—æ®µ
product.setPrice(new BigDecimal("99.99"));

products.contains(product);  // trueï¼Œèƒ½æ­£å¸¸æ‰¾åˆ°
```

**ğŸ”§ ç‰¹æ®Šåœºæ™¯å¤„ç†**
```java
// æ–¹æ¡ˆ2ï¼šä¿å­˜å‰ä¸æ”¾å…¥Set
Set<User> users = new HashSet<>();

// âŒ é”™è¯¯åšæ³•
User user = new User();
user.setUsername("alice");
users.add(user);  // id=nullæ—¶å°±åŠ å…¥Set
userRepository.save(user);  // idå˜ä¸º1ï¼ŒhashCodeå¯èƒ½å˜åŒ–

// âœ… æ­£ç¡®åšæ³•
User user = new User();
user.setUsername("alice");
userRepository.save(user);  // å…ˆä¿å­˜ï¼Œç¡®å®šæ‰€æœ‰å­—æ®µ
users.add(user);  // å­—æ®µç¨³å®šåå†åŠ å…¥Set

// æ–¹æ¡ˆ3ï¼šä½¿ç”¨Listä»£æ›¿Setï¼ˆå¦‚æœé¡ºåºé‡è¦ï¼‰
List<User> users = new ArrayList<>();
users.add(user);  // Listä¸ä¾èµ–hashCode
// æ‰‹åŠ¨å»é‡
users = users.stream().distinct().collect(Collectors.toList());
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘


### 7.1 hashCodeæ€§èƒ½ä¼˜åŒ–

**ğŸ¯ é«˜æ•ˆçš„å“ˆå¸Œè®¡ç®—**

```java
// âŒ æ€§èƒ½å·®çš„å†™æ³•
@Override
public int hashCode() {
    // æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡ï¼Œæ€§èƒ½å·®
    return Objects.hash(field1, field2, field3);
}

// âœ… ä¼˜åŒ–å†™æ³•1ï¼šç¼“å­˜hashCode
@Entity
public class Product {
    private String productCode;
    
    // ç¼“å­˜è®¡ç®—ç»“æœ
    private transient int cachedHashCode = 0;
    
    @Override
    public int hashCode() {
        if (cachedHashCode == 0 && productCode != null) {
            cachedHashCode = productCode.hashCode();
        }
        return cachedHashCode;
    }
}

// âœ… ä¼˜åŒ–å†™æ³•2ï¼šä½¿ç”¨å›ºå®šå€¼ï¼ˆæœ€å¿«ï¼‰
@Override
public int hashCode() {
    // å¯¹äºä¸å¯å˜çš„ä¸šåŠ¡é”®ï¼Œç›´æ¥è¿”å›å…¶hashCode
    return productCode != null ? productCode.hashCode() : 0;
}

// âœ… ä¼˜åŒ–å†™æ³•3ï¼šå¸¸é‡å“ˆå¸Œï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
@Override
public int hashCode() {
    // æ‰€æœ‰å®ä¾‹è¿”å›ç›¸åŒå€¼ï¼Œè®©equalsæ‰¿æ‹…åˆ¤æ–­
    // é€‚åˆå®ä½“æ•°é‡ä¸å¤šçš„åœºæ™¯
    return 31;
}
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ**

| æ–¹æ¡ˆ | **æ€§èƒ½** | **åˆ†å¸ƒ** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| ğŸ”¸ **æ¯æ¬¡è®¡ç®—** | `æ…¢` | `å¥½` | `å­—æ®µç»å¸¸å˜åŒ–` |
| ğŸ”¸ **ç¼“å­˜ç»“æœ** | `å¿«` | `å¥½` | `ä¸å¯å˜å­—æ®µ` |
| ğŸ”¸ **å›ºå®šå€¼** | `æœ€å¿«` | `å·®` | `å®ä½“æ•°é‡å°‘` |

### 7.2 equalsæ€§èƒ½ä¼˜åŒ–

**âš¡ é«˜æ•ˆçš„æ¯”è¾ƒé€»è¾‘**

```java
@Entity
public class Order {
    private String orderNumber;
    private LocalDateTime createTime;
    private User user;
    
    @Override
    public boolean equals(Object o) {
        // ä¼˜åŒ–1ï¼šå¿«é€Ÿè·¯å¾„ - åŒä¸€å¯¹è±¡
        if (this == o) return true;  // æœ€å¿«çš„åˆ¤æ–­
        
        // ä¼˜åŒ–2ï¼šå¿«é€Ÿæ‹’ç» - nullå’Œç±»å‹
        if (!(o instanceof Order)) return false;
        
        Order order = (Order) o;
        
        // ä¼˜åŒ–3ï¼šå…ˆæ¯”è¾ƒå¯èƒ½ä¸åŒçš„å­—æ®µ
        // orderNumberæ›´å¯èƒ½ä¸åŒï¼Œå…ˆæ¯”è¾ƒ
        if (!Objects.equals(orderNumber, order.orderNumber)) {
            return false;
        }
        
        // ä¼˜åŒ–4ï¼šæœ€åæ¯”è¾ƒå¤æ‚å­—æ®µ
        // æ—¶é—´æ¯”è¾ƒç›¸å¯¹å¤æ‚ï¼Œæ”¾åœ¨åé¢
        return Objects.equals(createTime, order.createTime);
    }
}
```

**ğŸ” å­—æ®µæ¯”è¾ƒé¡ºåºå»ºè®®**
```
æ¯”è¾ƒé¡ºåºä¼˜åŒ–åŸåˆ™ï¼š

1. å»‰ä»·å­—æ®µä¼˜å…ˆ
   - Stringæ¯”è¾ƒ > å¯¹è±¡æ¯”è¾ƒ
   - åŸºæœ¬ç±»å‹ > å¼•ç”¨ç±»å‹
   
2. åŒºåˆ†åº¦é«˜çš„å­—æ®µä¼˜å…ˆ
   - å”¯ä¸€é”® > æ™®é€šå­—æ®µ
   - å˜åŒ–å¤§çš„ > å›ºå®šå€¼
   
3. éç©ºå­—æ®µä¼˜å…ˆ
   - å¿…å¡«å­—æ®µ > å¯é€‰å­—æ®µ
   - é¿å…è¿‡å¤šnullåˆ¤æ–­

æ¨èé¡ºåºï¼š
1. ä¸šåŠ¡å”¯ä¸€é”®ï¼ˆStringï¼‰
2. æ•°å­—ID  
3. æšä¸¾å€¼
4. æ—¥æœŸæ—¶é—´
5. å…³è”å¯¹è±¡ï¼ˆæ…ç”¨ï¼‰
```

### 7.3 é›†åˆæ“ä½œæ€§èƒ½è€ƒè™‘

**ğŸ“ˆ å¤§æ•°æ®é‡åœºæ™¯ä¼˜åŒ–**

```java
// åœºæ™¯ï¼šéœ€è¦åœ¨å¤§é›†åˆä¸­æŸ¥æ‰¾å¯¹è±¡

// âŒ æ€§èƒ½å·®çš„åšæ³•
List<User> users = userRepository.findAll();  // 10ä¸‡æ¡
User target = new User();
target.setId(12345L);

// containsåœ¨Listä¸­æ˜¯O(n)å¤æ‚åº¦
if (users.contains(target)) {  // éå†10ä¸‡æ¬¡
    // ...
}

// âœ… ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šä½¿ç”¨HashSet
Set<User> userSet = new HashSet<>(users);  // O(n)è½¬æ¢æˆæœ¬
if (userSet.contains(target)) {  // O(1)æŸ¥æ‰¾
    // ...
}

// âœ… ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šä½¿ç”¨Map
Map<Long, User> userMap = users.stream()
    .collect(Collectors.toMap(User::getId, u -> u));
User found = userMap.get(12345L);  // O(1)æŸ¥æ‰¾

// âœ… ä¼˜åŒ–æ–¹æ¡ˆ3ï¼šæ•°æ®åº“å±‚é¢å¤„ç†
boolean exists = userRepository.existsById(12345L);  // æ•°æ®åº“ç´¢å¼•æŸ¥è¯¢
```

**âš™ï¸ æ‰¹é‡æ“ä½œä¼˜åŒ–**
```java
// åœºæ™¯ï¼šæ‰¹é‡æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨

// âŒ ä½æ•ˆåšæ³•
Set<User> uniqueUsers = new HashSet<>();
for (User user : allUsers) {  // å‡è®¾10ä¸‡æ¡
    if (!uniqueUsers.contains(user)) {  // æ¯æ¬¡O(1)
        uniqueUsers.add(user);
    }
}

// âœ… ä¼˜åŒ–åšæ³•
Set<User> uniqueUsers = new HashSet<>(allUsers);  // è‡ªåŠ¨å»é‡
// æˆ–
Set<User> uniqueUsers = allUsers.stream()
    .collect(Collectors.toSet());  // æµå¼å¤„ç†

// æ€§èƒ½æå‡ç‚¹ï¼š
// 1. å‡å°‘æ˜¾å¼containsè°ƒç”¨
// 2. åˆ©ç”¨Setå†…éƒ¨ä¼˜åŒ–
// 3. å¯èƒ½çš„å¹¶è¡Œå¤„ç†
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ equals/hashCodeå¥‘çº¦ï¼šç›¸ç­‰å¯¹è±¡å¿…é¡»æœ‰ç›¸åŒhashCode
ğŸ”¸ ä¸šåŠ¡å”¯ä¸€é”®ï¼šä½¿ç”¨ä¸å˜çš„ä¸šåŠ¡å­—æ®µä½œä¸ºæ¯”è¾ƒä¾æ®
ğŸ”¸ ä¸å¯å˜æ€§ï¼šequalsä½¿ç”¨çš„å­—æ®µä¸åº”è¯¥æ”¹å˜
ğŸ”¸ å»¶è¿ŸåŠ è½½é™·é˜±ï¼šé¿å…åœ¨equalsä¸­è®¿é—®æ‡’åŠ è½½å­—æ®µ
ğŸ”¸ ä»£ç†å¯¹è±¡å…¼å®¹ï¼šä½¿ç”¨instanceofè€ŒégetClass()
ğŸ”¸ Seté›†åˆå»é‡ï¼šhashCodeå˜åŒ–ä¼šå¯¼è‡´å¯¹è±¡"ä¸¢å¤±"
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šåˆç†é€‰æ‹©hashCodeè®¡ç®—ç­–ç•¥
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆä¸èƒ½ç”¨IDä½œä¸ºequalsä¾æ®**
```
æ ¸å¿ƒé—®é¢˜ï¼šIDåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå˜åŒ–

å¯¹è±¡çŠ¶æ€å˜åŒ–ï¼š
1. æ–°å»ºçŠ¶æ€ï¼šid = null
2. æŒä¹…åŒ–åï¼šid = 1  
3. æ”¾å…¥Setå‰åIDä¸åŒ â†’ hashCodeå˜åŒ– â†’ åœ¨Setä¸­ä¸¢å¤±

æ­£ç¡®åšæ³•ï¼š
- ä½¿ç”¨åˆ›å»ºæ—¶å°±æœ‰çš„ä¸šåŠ¡å­—æ®µ
- ä½¿ç”¨æ°¸è¿œä¸å˜çš„UUID
- ä½¿ç”¨æ•°æ®åº“çº§åˆ«çš„è‡ªç„¶é”®
```

**ğŸ”¹ Seté›†åˆå»é‡çš„å®Œæ•´é“¾è·¯**
```
å»é‡åˆ¤æ–­æµç¨‹ï¼š

æ­¥éª¤1ï¼šhashCodeåˆç­›
  è®¡ç®—å¯¹è±¡hashCode â†’ å®šä½å­˜å‚¨æ¡¶
  
æ­¥éª¤2ï¼šequalsç²¾ç¡®æ¯”è¾ƒ  
  ä¸æ¡¶å†…å¯¹è±¡é€ä¸ªæ¯”è¾ƒ â†’ åˆ¤æ–­æ˜¯å¦ç›¸ç­‰
  
æ­¥éª¤3ï¼šå†³å®šæ˜¯å¦æ·»åŠ 
  ç›¸ç­‰ â†’ ä¸æ·»åŠ ï¼ˆå»é‡æˆåŠŸï¼‰
  ä¸ç­‰ â†’ æ·»åŠ åˆ°é›†åˆ

å…³é”®ç‚¹ï¼š
- hashCodeä¸åŒ â†’ ä¸€å®šä¸ç›¸ç­‰ï¼ˆå¿«é€Ÿæ’é™¤ï¼‰
- hashCodeç›¸åŒ â†’ å¯èƒ½ç›¸ç­‰ï¼ˆéœ€è¦equalsç¡®è®¤ï¼‰
- equalsç›¸ç­‰ â†’ hashCodeå¿…é¡»ç›¸ç­‰ï¼ˆå¥‘çº¦è¦æ±‚ï¼‰
```

**ğŸ”¹ ä»£ç†å¯¹è±¡é—®é¢˜çš„æœ¬è´¨**
```
ä»£ç†å¯¹è±¡çš„ç‰¹ç‚¹ï¼š

çœŸå®å¯¹è±¡ï¼šUser.class
ä»£ç†å¯¹è±¡ï¼šUser$$HibernateProxy$xxx.class

getClass()æ¯”è¾ƒï¼š
User.class != User$$HibernateProxy â†’ falseï¼ˆé”™è¯¯ï¼‰

instanceofæ¯”è¾ƒï¼š
User$$HibernateProxy instanceof User â†’ trueï¼ˆæ­£ç¡®ï¼‰

ç»“è®ºï¼š
æ°¸è¿œä½¿ç”¨instanceofè¿›è¡Œç±»å‹æ£€æŸ¥
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**
- **ç”µå•†è®¢å•ç³»ç»Ÿ**ï¼šè®¢å•å·ä½œä¸ºä¸šåŠ¡å”¯ä¸€é”®ï¼Œé¿å…IDå¯¼è‡´çš„é—®é¢˜
- **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ**ï¼šç”¨æˆ·åæˆ–UUIDä½œä¸ºæ¯”è¾ƒä¾æ®
- **åº“å­˜ç®¡ç†**ï¼šå•†å“ç¼–ç ä½œä¸ºä¸å¯å˜ä¸šåŠ¡é”®
- **é‡‘èäº¤æ˜“**ï¼šäº¤æ˜“æµæ°´å·ä½œä¸ºå”¯ä¸€æ ‡è¯†

**ğŸ”§ å¼€å‘è§„èŒƒå»ºè®®**
- **ä»£ç å®¡æŸ¥é‡ç‚¹**ï¼šæ£€æŸ¥equalsæ˜¯å¦ç”¨äº†å»¶è¿ŸåŠ è½½å­—æ®µ
- **å•å…ƒæµ‹è¯•å¿…å¤‡**ï¼šæµ‹è¯•Setå»é‡ã€equalså¯¹ç§°æ€§ã€hashCodeä¸€è‡´æ€§
- **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨å¤§é›†åˆæ“ä½œçš„hashCodeè®¡ç®—å¼€é”€
- **å›¢é˜Ÿè§„èŒƒ**ï¼šç»Ÿä¸€equals/hashCodeå®ç°æ¨¡æ¿

**ğŸš€ è¿›é˜¶å­¦ä¹ æ–¹å‘**
- **Lomboké›†æˆ**ï¼š@EqualsAndHashCodeæ³¨è§£çš„æ­£ç¡®ç”¨æ³•
- **ç»§æ‰¿åœºæ™¯**ï¼šçˆ¶ç±»å­ç±»çš„equalså®ç°
- **å®¡è®¡éœ€æ±‚**ï¼šequalsç”¨äºå˜æ›´æ£€æµ‹
- **åˆ†å¸ƒå¼åœºæ™¯**ï¼šè·¨JVMçš„å¯¹è±¡æ¯”è¾ƒç­–ç•¥

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¸šåŠ¡å”¯ä¸€é”®ä½œä¾æ®ï¼Œä¸å¯å˜å­—æ®µæ˜¯é¦–é€‰
- å»¶è¿ŸåŠ è½½è¦é¿å¼€ï¼Œä»£ç†å¯¹è±¡ç”¨instanceof
- hashCodeç¨³å®šä¸èƒ½å˜ï¼ŒSeté›†åˆæ‰èƒ½å»é‡å®Œ
- æ€§èƒ½ä¼˜åŒ–çœ‹åœºæ™¯ï¼Œequalså…ˆå¿«åæ…¢æ¯”è¾ƒ