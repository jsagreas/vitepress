---
title: 17ã€å¤šå¯¹å¤šå…³ç³»æ˜ å°„
---
## ğŸ“š ç›®å½•

1. [å¤šå¯¹å¤šå…³ç³»çš„æœ¬è´¨ç†è§£](#1-å¤šå¯¹å¤šå…³ç³»çš„æœ¬è´¨ç†è§£)
2. [ä¸­é—´è¡¨çš„ä½œç”¨ä¸åŸç†](#2-ä¸­é—´è¡¨çš„ä½œç”¨ä¸åŸç†)
3. [@ManyToManyåŸºç¡€æ˜ å°„](#3-manytomanyåŸºç¡€æ˜ å°„)
4. [@JoinTableä¸­é—´è¡¨é…ç½®](#4-jointableä¸­é—´è¡¨é…ç½®)
5. [åŒå‘å¤šå¯¹å¤šå…³ç³»](#5-åŒå‘å¤šå¯¹å¤šå…³ç³»)
6. [ä¸­é—´è¡¨ç´¢å¼•ä¼˜åŒ–](#6-ä¸­é—´è¡¨ç´¢å¼•ä¼˜åŒ–)
7. [å¤šå¯¹å¤šçš„ä¸šåŠ¡å»ºæ¨¡å»ºè®®](#7-å¤šå¯¹å¤šçš„ä¸šåŠ¡å»ºæ¨¡å»ºè®®)
8. [ä½•æ—¶é¿å…ä½¿ç”¨å¤šå¯¹å¤š](#8-ä½•æ—¶é¿å…ä½¿ç”¨å¤šå¯¹å¤š)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”— å¤šå¯¹å¤šå…³ç³»çš„æœ¬è´¨ç†è§£


### 1.1 ä»€ä¹ˆæ˜¯å¤šå¯¹å¤šå…³ç³»


**é€šä¿—ç†è§£ï¼š** æƒ³è±¡ä¸€ä¸ªé€‰è¯¾ç³»ç»Ÿï¼Œä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰å¤šé—¨è¯¾ç¨‹ï¼Œä¸€é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥è¢«å¤šä¸ªå­¦ç”Ÿé€‰æ‹©ï¼Œè¿™å°±æ˜¯å…¸å‹çš„å¤šå¯¹å¤šå…³ç³»ã€‚

```
ç°å®åœºæ™¯ç¤ºä¾‹ï¼š

å­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿï¼š
å­¦ç”Ÿå¼ ä¸‰ â†’ é€‰äº†æ•°å­¦ã€è‹±è¯­ã€ç‰©ç†
å­¦ç”Ÿæå›› â†’ é€‰äº†è‹±è¯­ã€åŒ–å­¦
æ•°å­¦è¯¾ç¨‹ â†’ è¢«å¼ ä¸‰é€‰æ‹©
è‹±è¯­è¯¾ç¨‹ â†’ è¢«å¼ ä¸‰ã€æå››é€‰æ‹©

å…³ç³»ç‰¹ç‚¹ï¼š
â€¢ ä¸€ä¸ªå­¦ç”Ÿ â†’ å¤šé—¨è¯¾ç¨‹ï¼ˆä¸€å¯¹å¤šï¼‰
â€¢ ä¸€é—¨è¯¾ç¨‹ â†’ å¤šä¸ªå­¦ç”Ÿï¼ˆä¸€å¯¹å¤šï¼‰
â€¢ åˆèµ·æ¥å°±æ˜¯ï¼šå¤šå¯¹å¤š
```

**å…¶ä»–å¸¸è§åœºæ™¯ï¼š**
- ğŸ‘¥ **ç”¨æˆ·ä¸è§’è‰²**ï¼šä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²è¢«å¤šä¸ªç”¨æˆ·æ‹¥æœ‰
- ğŸ“¦ **è®¢å•ä¸å•†å“**ï¼šä¸€ä¸ªè®¢å•åŒ…å«å¤šä¸ªå•†å“ï¼Œä¸€ä¸ªå•†å“å‡ºç°åœ¨å¤šä¸ªè®¢å•ä¸­
- ğŸ·ï¸ **æ–‡ç« ä¸æ ‡ç­¾**ï¼šä¸€ç¯‡æ–‡ç« æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œä¸€ä¸ªæ ‡ç­¾å¯¹åº”å¤šç¯‡æ–‡ç« 

### 1.2 å¤šå¯¹å¤šåœ¨æ•°æ®åº“ä¸­çš„æŒ‘æˆ˜


**é—®é¢˜ï¼š** å…³ç³»å‹æ•°æ®åº“æ— æ³•ç›´æ¥è¡¨ç¤ºå¤šå¯¹å¤šå…³ç³»

```
é”™è¯¯çš„è®¾è®¡ï¼ˆè¡Œä¸é€šï¼‰ï¼š

å­¦ç”Ÿè¡¨                   è¯¾ç¨‹è¡¨
+----+------+           +----+--------+
| id | name |           | id | name   |
+----+------+           +----+--------+
| 1  | å¼ ä¸‰ |           | 1  | æ•°å­¦   |
| 2  | æå›› |           | 2  | è‹±è¯­   |
+----+------+           +----+--------+

é—®é¢˜ï¼šå¦‚ä½•è¡¨ç¤º"å¼ ä¸‰é€‰äº†æ•°å­¦å’Œè‹±è¯­"ï¼Ÿ
âŒ åœ¨å­¦ç”Ÿè¡¨åŠ è¯¾ç¨‹IDå­—æ®µï¼Ÿâ†’ æ— æ³•å­˜å‚¨å¤šä¸ªè¯¾ç¨‹
âŒ åœ¨è¯¾ç¨‹è¡¨åŠ å­¦ç”ŸIDå­—æ®µï¼Ÿâ†’ æ— æ³•å­˜å‚¨å¤šä¸ªå­¦ç”Ÿ
```

**è§£å†³æ–¹æ¡ˆï¼š** å¼•å…¥ä¸­é—´è¡¨ï¼ˆå…³è”è¡¨ï¼‰

```
æ­£ç¡®çš„è®¾è®¡ï¼š

å­¦ç”Ÿè¡¨              ä¸­é—´è¡¨(é€‰è¯¾è¡¨)         è¯¾ç¨‹è¡¨
+----+------+      +----+----+----+      +----+--------+
| id | name |      | id | å­¦ç”Ÿ | è¯¾ç¨‹ |    | id | name   |
+----+------+      +----+----+----+      +----+--------+
| 1  | å¼ ä¸‰ |      | 1  | 1  | 1  |      | 1  | æ•°å­¦   |
| 2  | æå›› |      | 2  | 1  | 2  |      | 2  | è‹±è¯­   |
+----+------+      | 3  | 2  | 2  |      +----+--------+
                   +----+----+----+

âœ… ä¸­é—´è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ª"é€‰è¯¾å…³ç³»"
âœ… å¯ä»¥çµæ´»è¡¨ç¤ºä»»æ„å¤šå¯¹å¤šå…³ç³»
```

---

## 2. ğŸ—‚ï¸ ä¸­é—´è¡¨çš„ä½œç”¨ä¸åŸç†


### 2.1 ä¸­é—´è¡¨çš„æ ¸å¿ƒä½œç”¨


**ä¸­é—´è¡¨ï¼ˆJoin Tableï¼‰** æ˜¯å¤šå¯¹å¤šå…³ç³»çš„æ¡¥æ¢ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š

> **å°†ä¸€ä¸ªå¤šå¯¹å¤šå…³ç³»ï¼Œæ‹†è§£æˆä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»**

```
å…³ç³»æ‹†è§£ç¤ºæ„å›¾ï¼š

åŸå§‹å¤šå¯¹å¤šï¼š
å­¦ç”Ÿ â†â†’ è¯¾ç¨‹

é€šè¿‡ä¸­é—´è¡¨æ‹†è§£ï¼š
å­¦ç”Ÿ â†’ é€‰è¯¾è®°å½• â† è¯¾ç¨‹
(ä¸€å¯¹å¤š)      (ä¸€å¯¹å¤š)

å…·ä½“ä½“ç°ï¼š
â€¢ ä¸€ä¸ªå­¦ç”Ÿ â†’ å¤šæ¡é€‰è¯¾è®°å½•ï¼ˆä¸€å¯¹å¤šï¼‰
â€¢ ä¸€é—¨è¯¾ç¨‹ â†’ å¤šæ¡é€‰è¯¾è®°å½•ï¼ˆä¸€å¯¹å¤šï¼‰
â€¢ é€‰è¯¾è®°å½•è¡¨å°±æ˜¯ä¸­é—´è¡¨
```

### 2.2 ä¸­é—´è¡¨çš„ç»„æˆ


ä¸­é—´è¡¨æœ€åŸºæœ¬çš„ç»“æ„åŒ…å«ï¼š

| å­—æ®µ | è¯´æ˜ | å¿…éœ€æ€§ |
|------|------|--------|
| **ä¸»é”®ID** | è®°å½•çš„å”¯ä¸€æ ‡è¯† | å¯é€‰ï¼ˆå»ºè®®æœ‰ï¼‰ |
| **å¤–é”®1** | æŒ‡å‘ç¬¬ä¸€ä¸ªå®ä½“ï¼ˆå¦‚å­¦ç”ŸIDï¼‰ | âœ… å¿…éœ€ |
| **å¤–é”®2** | æŒ‡å‘ç¬¬äºŒä¸ªå®ä½“ï¼ˆå¦‚è¯¾ç¨‹IDï¼‰ | âœ… å¿…éœ€ |
| **æ‰©å±•å­—æ®µ** | å…³ç³»çš„é™„åŠ ä¿¡æ¯ï¼ˆå¦‚é€‰è¯¾æ—¶é—´ï¼‰ | å¯é€‰ |

```
åŸºç¡€ä¸­é—´è¡¨ç¤ºä¾‹ï¼š

CREATE TABLE student_course (
    id BIGINT PRIMARY KEY,           -- ä¸»é”®
    student_id BIGINT NOT NULL,      -- å¤–é”®ï¼šå­¦ç”ŸID
    course_id BIGINT NOT NULL,       -- å¤–é”®ï¼šè¯¾ç¨‹ID
    FOREIGN KEY (student_id) REFERENCES student(id),
    FOREIGN KEY (course_id) REFERENCES course(id)
);
```

---

## 3. ğŸ”§ @ManyToManyåŸºç¡€æ˜ å°„


### 3.1 @ManyToManyæ³¨è§£çš„å«ä¹‰


`@ManyToMany` æ˜¯JPAæä¾›çš„æ³¨è§£ï¼Œç”¨äºå£°æ˜å®ä½“ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ã€‚

**æ ¸å¿ƒä½œç”¨ï¼š**
- ğŸ“‹ å‘Šè¯‰JPAï¼š"è¿™æ˜¯ä¸€ä¸ªå¤šå¯¹å¤šå…³ç³»"
- ğŸ”— è‡ªåŠ¨ç”Ÿæˆä¸­é—´è¡¨ï¼ˆå¦‚æœæ²¡æœ‰æ‰‹åŠ¨é…ç½®ï¼‰
- ğŸ”„ è‡ªåŠ¨ç»´æŠ¤å…³ç³»æ•°æ®

### 3.2 å•å‘å¤šå¯¹å¤šæ˜ å°„


**åœºæ™¯ï¼š** åªä»å­¦ç”Ÿè¿™è¾¹èƒ½æ‰¾åˆ°è¯¾ç¨‹ï¼Œè¯¾ç¨‹é‚£è¾¹ä¸å…³å¿ƒå“ªäº›å­¦ç”Ÿé€‰äº†å®ƒ

```java
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // å¤šå¯¹å¤šå…³ç³»å£°æ˜
    @ManyToMany
    private List<Course> courses;  // è¿™ä¸ªå­¦ç”Ÿé€‰çš„æ‰€æœ‰è¯¾ç¨‹
    
    // getter/setterçœç•¥
}

@Entity
public class Course {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // æ²¡æœ‰å…³è”åˆ°Studentï¼Œè¿™å°±æ˜¯"å•å‘"
    // getter/setterçœç•¥
}
```

**è‡ªåŠ¨ç”Ÿæˆçš„ä¸­é—´è¡¨ï¼š**

```
è¡¨åè§„åˆ™ï¼šå®ä½“1å_å®ä½“2åï¼ˆæŒ‰å­—æ¯æ’åºï¼‰
å­—æ®µè§„åˆ™ï¼šå®ä½“å_ä¸»é”®å

ç”Ÿæˆç»“æœï¼š
CREATE TABLE student_course (
    student_id BIGINT NOT NULL,
    courses_id BIGINT NOT NULL,
    FOREIGN KEY (student_id) REFERENCES student(id),
    FOREIGN KEY (courses_id) REFERENCES course(id)
);
```

### 3.3 ä½¿ç”¨ç¤ºä¾‹


```java
// åˆ›å»ºå­¦ç”Ÿå’Œè¯¾ç¨‹
Student student = new Student();
student.setName("å¼ ä¸‰");

Course math = new Course();
math.setName("æ•°å­¦");

Course english = new Course();
english.setName("è‹±è¯­");

// å»ºç«‹å¤šå¯¹å¤šå…³ç³»
student.setCourses(Arrays.asList(math, english));

// ä¿å­˜ï¼ˆJPAä¼šè‡ªåŠ¨ä¿å­˜å…³ç³»åˆ°ä¸­é—´è¡¨ï¼‰
studentRepository.save(student);

// æŸ¥è¯¢
Student found = studentRepository.findById(1L).get();
List<Course> courses = found.getCourses();  // è·å–è¯¥å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹
```

---

## 4. âš™ï¸ @JoinTableä¸­é—´è¡¨é…ç½®


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦@JoinTable


é»˜è®¤çš„ä¸­é—´è¡¨å‘½åå¯èƒ½ä¸ç¬¦åˆæˆ‘ä»¬çš„æ•°æ®åº“è§„èŒƒï¼Œæ¯”å¦‚ï¼š
- âŒ è¡¨åå¤ªé•¿ï¼š`student_course`
- âŒ å­—æ®µåä¸æ¸…æ™°ï¼š`courses_id`
- âŒ ç¼ºå°‘è‡ªå®šä¹‰ä¸»é”®

**@JoinTableçš„ä½œç”¨ï¼š** å®Œå…¨è‡ªå®šä¹‰ä¸­é—´è¡¨çš„ç»“æ„

### 4.2 @JoinTableè¯¦ç»†é…ç½®


```java
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @ManyToMany
    @JoinTable(
        name = "t_enrollment",  // â‘  ä¸­é—´è¡¨åç§°
        joinColumns = @JoinColumn(name = "student_id"),  // â‘¡ å½“å‰å®ä½“çš„å¤–é”®åˆ—
        inverseJoinColumns = @JoinColumn(name = "course_id")  // â‘¢ å¯¹æ–¹å®ä½“çš„å¤–é”®åˆ—
    )
    private List<Course> courses;
}
```

**å‚æ•°è¯¦è§£ï¼š**

| å‚æ•° | å«ä¹‰ | é€šä¿—ç†è§£ |
|------|------|----------|
| `name` | ä¸­é—´è¡¨çš„è¡¨å | ç»™è¿™å¼ å…³ç³»è¡¨èµ·ä¸ªåå­— |
| `joinColumns` | å½“å‰å®ä½“çš„å¤–é”®åˆ— | "æˆ‘"çš„IDåœ¨ä¸­é—´è¡¨é‡Œå«ä»€ä¹ˆ |
| `inverseJoinColumns` | å¯¹æ–¹å®ä½“çš„å¤–é”®åˆ— | "å¯¹æ–¹"çš„IDåœ¨ä¸­é—´è¡¨é‡Œå«ä»€ä¹ˆ |

```
ç”Ÿæˆçš„ä¸­é—´è¡¨ç»“æ„ï¼š

CREATE TABLE t_enrollment (
    student_id BIGINT NOT NULL,  -- joinColumnsé…ç½®çš„åˆ—å
    course_id BIGINT NOT NULL,   -- inverseJoinColumnsé…ç½®çš„åˆ—å
    FOREIGN KEY (student_id) REFERENCES student(id),
    FOREIGN KEY (course_id) REFERENCES course(id)
);
```

### 4.3 é…ç½®æŠ€å·§ä¸è§„èŒƒ


**å‘½åå»ºè®®ï¼š**

```java
// âœ… æ¨èï¼šè¯­ä¹‰åŒ–å‘½å
@JoinTable(
    name = "t_enrollment",              // è¡¨åï¼št_é€‰è¯¾
    joinColumns = @JoinColumn(name = "student_id"),
    inverseJoinColumns = @JoinColumn(name = "course_id")
)

// âŒ é¿å…ï¼šå«ä¹‰ä¸æ¸…
@JoinTable(
    name = "rel_table",
    joinColumns = @JoinColumn(name = "fk1"),
    inverseJoinColumns = @JoinColumn(name = "fk2")
)
```

**è®°å¿†æ–¹æ³•ï¼š**
- `joinColumns` â†’ "join"è¡¨ç¤º"åŠ å…¥"ï¼Œå°±æ˜¯"æˆ‘æ–¹"åŠ å…¥å…³ç³»
- `inverseJoinColumns` â†’ "inverse"è¡¨ç¤º"åå‘"ï¼Œå°±æ˜¯"å¯¹æ–¹"åŠ å…¥å…³ç³»

---

## 5. ğŸ”„ åŒå‘å¤šå¯¹å¤šå…³ç³»


### 5.1 ä»€ä¹ˆæ˜¯åŒå‘å¤šå¯¹å¤š


**å•å‘ vs åŒå‘ï¼š**

```
å•å‘ï¼šåªèƒ½ä»ä¸€è¾¹æŸ¥åˆ°å¦ä¸€è¾¹
Student â†’ courses âœ…
Course â†’ students âŒ (æŸ¥ä¸åˆ°)

åŒå‘ï¼šä¸¤è¾¹éƒ½èƒ½äº’ç›¸æŸ¥è¯¢
Student â†’ courses âœ…
Course â†’ students âœ…
```

**åº”ç”¨åœºæ™¯ï¼š** æ—¢è¦ä»å­¦ç”ŸæŸ¥è¯¾ç¨‹ï¼Œä¹Ÿè¦ä»è¯¾ç¨‹æŸ¥å­¦ç”Ÿ

### 5.2 åŒå‘å¤šå¯¹å¤šé…ç½®


```java
// å­¦ç”Ÿå®ä½“ï¼ˆå…³ç³»çš„æ‹¥æœ‰æ–¹ï¼‰
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @ManyToMany
    @JoinTable(
        name = "t_enrollment",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses;
}

// è¯¾ç¨‹å®ä½“ï¼ˆå…³ç³»çš„è¢«æ‹¥æœ‰æ–¹ï¼‰
@Entity
public class Course {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    @ManyToMany(mappedBy = "courses")  // å…³é”®ï¼šmappedByæŒ‡å‘å¯¹æ–¹çš„é›†åˆå±æ€§å
    private List<Student> students;
}
```

### 5.3 mappedByçš„å«ä¹‰


**mappedByçš„ä½œç”¨ï¼š** å‘Šè¯‰JPA"æˆ‘ä¸è´Ÿè´£ç»´æŠ¤å…³ç³»ï¼Œç”±å¯¹æ–¹è´Ÿè´£"

```
å…³ç³»ç»´æŠ¤æƒç¤ºæ„å›¾ï¼š

Student (æ‹¥æœ‰æ–¹)              Course (è¢«æ‹¥æœ‰æ–¹)
@ManyToMany                  @ManyToMany(mappedBy="courses")
@JoinTableé…ç½®                 â†‘
  â†“                          æŒ‡å‘å¯¹æ–¹çš„é›†åˆå±æ€§å
è´Ÿè´£ç»´æŠ¤ä¸­é—´è¡¨ âœ…              åªæ˜¯è¯»å–å…³ç³» âŒ
```

**é‡è¦è§„åˆ™ï¼š**
- âœ… åªèƒ½æœ‰ä¸€æ–¹é…ç½® `@JoinTable`
- âœ… å¦ä¸€æ–¹å¿…é¡»ç”¨ `mappedBy` æŒ‡å‘å¯¹æ–¹çš„é›†åˆå±æ€§å
- âš ï¸ `mappedBy` çš„å€¼æ˜¯**å¯¹æ–¹å®ä½“ä¸­çš„å±æ€§å**ï¼Œä¸æ˜¯è¡¨åæˆ–å­—æ®µå

```java
// é”™è¯¯ç¤ºä¾‹
@ManyToMany(mappedBy = "student")  // âŒ é”™è¯¯ï¼šå¯¹æ–¹å±æ€§åæ˜¯coursesä¸æ˜¯student
@ManyToMany(mappedBy = "t_enrollment")  // âŒ é”™è¯¯ï¼šä¸æ˜¯è¡¨å

// æ­£ç¡®ç¤ºä¾‹
@ManyToMany(mappedBy = "courses")  // âœ… æ­£ç¡®ï¼šå¯¹æ–¹å±æ€§åå°±æ˜¯courses
```

### 5.4 åŒå‘å…³ç³»çš„ä½¿ç”¨


```java
// ä»å­¦ç”ŸæŸ¥è¯¾ç¨‹
Student student = studentRepository.findById(1L).get();
List<Course> courses = student.getCourses();  // æŸ¥åˆ°è¯¥å­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹

// ä»è¯¾ç¨‹æŸ¥å­¦ç”Ÿ
Course course = courseRepository.findById(1L).get();
List<Student> students = course.getStudents();  // æŸ¥åˆ°é€‰è¿™é—¨è¯¾çš„æ‰€æœ‰å­¦ç”Ÿ

// å»ºç«‹å…³ç³»ï¼ˆåªéœ€è¦åœ¨æ‹¥æœ‰æ–¹æ“ä½œï¼‰
student.getCourses().add(newCourse);
studentRepository.save(student);  // å…³ç³»ä¼šè‡ªåŠ¨ä¿å­˜åˆ°ä¸­é—´è¡¨
```

---

## 6. ğŸš€ ä¸­é—´è¡¨ç´¢å¼•ä¼˜åŒ–


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç´¢å¼•


ä¸­é—´è¡¨çš„æŸ¥è¯¢éå¸¸é¢‘ç¹ï¼Œæ²¡æœ‰ç´¢å¼•ä¼šå¯¼è‡´ï¼š
- ğŸŒ æŸ¥è¯¢é€Ÿåº¦æ…¢
- ğŸ’¾ å…¨è¡¨æ‰«ææµªè´¹èµ„æº
- ğŸ“ˆ é«˜å¹¶å‘ä¸‹æ€§èƒ½æ€¥å‰§ä¸‹é™

**å¸¸è§æŸ¥è¯¢åœºæ™¯ï¼š**

```sql
-- åœºæ™¯1ï¼šæŸ¥æ‰¾æŸä¸ªå­¦ç”Ÿçš„æ‰€æœ‰è¯¾ç¨‹
SELECT * FROM t_enrollment WHERE student_id = 1;

-- åœºæ™¯2ï¼šæŸ¥æ‰¾æŸé—¨è¯¾ç¨‹çš„æ‰€æœ‰å­¦ç”Ÿ
SELECT * FROM t_enrollment WHERE course_id = 1;

-- åœºæ™¯3ï¼šåˆ¤æ–­æŸä¸ªå­¦ç”Ÿæ˜¯å¦é€‰äº†æŸé—¨è¯¾
SELECT * FROM t_enrollment WHERE student_id = 1 AND course_id = 5;
```

### 6.2 ç´¢å¼•é…ç½®æ–¹æ¡ˆ


```java
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToMany
    @JoinTable(
        name = "t_enrollment",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id"),
        // é…ç½®ç´¢å¼•
        indexes = {
            @Index(name = "idx_student", columnList = "student_id"),  // å•åˆ—ç´¢å¼•
            @Index(name = "idx_course", columnList = "course_id"),    // å•åˆ—ç´¢å¼•
            @Index(name = "idx_stu_course", columnList = "student_id, course_id")  // è”åˆç´¢å¼•
        }
    )
    private List<Course> courses;
}
```

### 6.3 ç´¢å¼•ç­–ç•¥åˆ†æ


| ç´¢å¼•ç±»å‹ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½å½±å“ |
|---------|---------|---------|
| **å•åˆ—ç´¢å¼•(student_id)** | ä»å­¦ç”ŸæŸ¥è¯¾ç¨‹ | åŠ é€Ÿå•å‘æŸ¥è¯¢ |
| **å•åˆ—ç´¢å¼•(course_id)** | ä»è¯¾ç¨‹æŸ¥å­¦ç”Ÿ | åŠ é€Ÿåå‘æŸ¥è¯¢ |
| **è”åˆç´¢å¼•(student_id, course_id)** | ç²¾ç¡®æŸ¥æ‰¾å…³ç³» | æœ€ä¼˜ï¼Œè¦†ç›–å‰ä¸¤ç§åœºæ™¯ |

**æ¨èæ–¹æ¡ˆï¼š**

```java
// æœ€ä½³å®è·µï¼šåªå»ºè”åˆç´¢å¼•å³å¯
indexes = {
    @Index(name = "idx_enrollment", columnList = "student_id, course_id")
}

// åŸå› ï¼šè”åˆç´¢å¼•å¯ä»¥è¦†ç›–å•åˆ—æŸ¥è¯¢ï¼ˆæœ€å·¦å‰ç¼€åŸåˆ™ï¼‰
```

### 6.4 å”¯ä¸€çº¦æŸ


é˜²æ­¢é‡å¤å…³ç³»ï¼ˆå¦‚å­¦ç”Ÿé‡å¤é€‰åŒä¸€é—¨è¯¾ï¼‰ï¼š

```java
@JoinTable(
    name = "t_enrollment",
    joinColumns = @JoinColumn(name = "student_id"),
    inverseJoinColumns = @JoinColumn(name = "course_id"),
    uniqueConstraints = @UniqueConstraint(
        name = "uk_student_course",
        columnNames = {"student_id", "course_id"}  // è”åˆå”¯ä¸€çº¦æŸ
    )
)
```

---

## 7. ğŸ’¡ å¤šå¯¹å¤šçš„ä¸šåŠ¡å»ºæ¨¡å»ºè®®


### 7.1 çº¯å¤šå¯¹å¤šçš„å±€é™æ€§


**é—®é¢˜åœºæ™¯ï¼š** é€‰è¯¾ç³»ç»Ÿéœ€è¦è®°å½•é€‰è¯¾æ—¶é—´ã€æˆç»©ç­‰ä¿¡æ¯

```
éœ€æ±‚å˜åŒ–ï¼š
å­¦ç”Ÿ - è¯¾ç¨‹ï¼ˆå¤šå¯¹å¤šï¼‰
     â†“
å­¦ç”Ÿ - [é€‰è¯¾æ—¶é—´ã€æˆç»©] - è¯¾ç¨‹
```

**çº¯å¤šå¯¹å¤šçš„å›°å¢ƒï¼š**

```java
@Entity
public class Student {
    @ManyToMany
    private List<Course> courses;  // âŒ æ— æ³•å­˜å‚¨é€‰è¯¾æ—¶é—´ã€æˆç»©
}
```

ä¸­é—´è¡¨åªæœ‰ä¸¤ä¸ªå¤–é”®ï¼Œæ— æ³•å­˜å‚¨é¢å¤–çš„ä¸šåŠ¡ä¿¡æ¯ï¼

### 7.2 æ¨èæ–¹æ¡ˆï¼šæ‹†è§£ä¸ºå®ä½“+ä¸¤ä¸ªå¤šå¯¹ä¸€


**æ ¸å¿ƒæ€æƒ³ï¼š** å°†ä¸­é—´è¡¨å‡çº§ä¸ºç‹¬ç«‹çš„ä¸šåŠ¡å®ä½“

```
åŸæ¥çš„è®¾è®¡ï¼š
å­¦ç”Ÿ â†â†’ è¯¾ç¨‹ï¼ˆå¤šå¯¹å¤šï¼‰

æ”¹è¿›çš„è®¾è®¡ï¼š
å­¦ç”Ÿ â† é€‰è¯¾è®°å½• â†’ è¯¾ç¨‹
    (å¤šå¯¹ä¸€)    (å¤šå¯¹ä¸€)
```

**å®ä½“å»ºæ¨¡ï¼š**

```java
// å­¦ç”Ÿå®ä½“
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // ä¸€å¯¹å¤šï¼šä¸€ä¸ªå­¦ç”Ÿæœ‰å¤šæ¡é€‰è¯¾è®°å½•
    @OneToMany(mappedBy = "student")
    private List<Enrollment> enrollments;
}

// è¯¾ç¨‹å®ä½“
@Entity
public class Course {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
    
    // ä¸€å¯¹å¤šï¼šä¸€é—¨è¯¾ç¨‹æœ‰å¤šæ¡é€‰è¯¾è®°å½•
    @OneToMany(mappedBy = "course")
    private List<Enrollment> enrollments;
}

// é€‰è¯¾è®°å½•å®ä½“ï¼ˆåŸæ¥çš„ä¸­é—´è¡¨å˜æˆç‹¬ç«‹å®ä½“ï¼‰
@Entity
public class Enrollment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne  // å¤šå¯¹ä¸€ï¼šå¤šæ¡è®°å½•å±äºä¸€ä¸ªå­¦ç”Ÿ
    @JoinColumn(name = "student_id")
    private Student student;
    
    @ManyToOne  // å¤šå¯¹ä¸€ï¼šå¤šæ¡è®°å½•å±äºä¸€é—¨è¯¾ç¨‹
    @JoinColumn(name = "course_id")
    private Course course;
    
    // é¢å¤–çš„ä¸šåŠ¡å­—æ®µ
    private LocalDateTime enrollTime;  // é€‰è¯¾æ—¶é—´
    private Integer score;             // æˆç»©
    private String status;             // çŠ¶æ€ï¼šå·²é€‰ã€å·²é€€é€‰
}
```

### 7.3 ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”


| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **çº¯å¤šå¯¹å¤š(@ManyToMany)** | é…ç½®ç®€å•ï¼Œä»£ç å°‘ | æ— æ³•æ‰©å±•å­—æ®µ | ç®€å•çš„æ ‡ç­¾ã€åˆ†ç±»ç³»ç»Ÿ |
| **æ‹†è§£ä¸ºå®ä½“+å¤šå¯¹ä¸€** | çµæ´»æ‰©å±•ï¼Œä¸šåŠ¡æ¸…æ™° | å®ä½“å¤šï¼Œä»£ç ç¨å¤æ‚ | éœ€è¦è®°å½•å…³ç³»ä¿¡æ¯çš„åœºæ™¯ |

**å†³ç­–å»ºè®®ï¼š**

```
é€‰æ‹©çº¯å¤šå¯¹å¤šï¼š
âœ… å…³ç³»ç®€å•ï¼Œåªéœ€è¦"æœ‰æ— "
âœ… æœªæ¥ä¸ä¼šæ·»åŠ å…³ç³»å±æ€§
âœ… ç¤ºä¾‹ï¼šæ–‡ç« æ ‡ç­¾ã€ç”¨æˆ·æƒé™

é€‰æ‹©æ‹†è§£æ–¹æ¡ˆï¼š
âœ… å…³ç³»æœ‰ä¸šåŠ¡å±æ€§ï¼ˆæ—¶é—´ã€çŠ¶æ€ã€æ•°é‡ç­‰ï¼‰
âœ… å…³ç³»æœ¬èº«æ˜¯é‡è¦çš„ä¸šåŠ¡å¯¹è±¡
âœ… ç¤ºä¾‹ï¼šè®¢å•å•†å“ã€é€‰è¯¾è®°å½•ã€å…³æ³¨å…³ç³»
```

---

## 8. âš ï¸ ä½•æ—¶é¿å…ä½¿ç”¨å¤šå¯¹å¤š


### 8.1 é¿å…ä½¿ç”¨çš„åœºæ™¯


**åœºæ™¯1ï¼šå…³ç³»éœ€è¦é¢å¤–å±æ€§**

```java
// âŒ é”™è¯¯ï¼šç”¨å¤šå¯¹å¤šå­˜å‚¨è®¢å•å•†å“
@Entity
public class Order {
    @ManyToMany
    private List<Product> products;  // æ— æ³•è®°å½•è´­ä¹°æ•°é‡ã€å•ä»·
}

// âœ… æ­£ç¡®ï¼šç”¨ç‹¬ç«‹å®ä½“
@Entity
public class OrderItem {
    @ManyToOne
    private Order order;
    
    @ManyToOne
    private Product product;
    
    private Integer quantity;  // è´­ä¹°æ•°é‡
    private BigDecimal price;  // è´­ä¹°æ—¶å•ä»·
}
```

**åœºæ™¯2ï¼šæ€§èƒ½æ•æ„Ÿçš„æ ¸å¿ƒä¸šåŠ¡**

å¤šå¯¹å¤šå…³ç³»çš„æŸ¥è¯¢æ¶‰åŠå¤šè¡¨å…³è”ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ï¼š

```
æŸ¥è¯¢å­¦ç”Ÿçš„è¯¾ç¨‹ï¼š
SELECT * FROM student s
JOIN t_enrollment e ON s.id = e.student_id
JOIN course c ON e.course_id = c.id
WHERE s.id = 1;

é—®é¢˜ï¼šä¸‰è¡¨å…³è”ï¼Œæ•°æ®é‡å¤§æ—¶æ€§èƒ½ä¸‹é™
```

**åœºæ™¯3ï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶å…³ç³»çš„ç”Ÿå‘½å‘¨æœŸ**

```java
// å¤šå¯¹å¤šçš„çº§è”æ“ä½œä¸å¥½æ§åˆ¶
@ManyToMany(cascade = CascadeType.ALL)  // âš ï¸ å±é™©ï¼šå¯èƒ½è¯¯åˆ æ•°æ®

// ç‹¬ç«‹å®ä½“å¯ä»¥ç²¾ç¡®æ§åˆ¶
@Entity
public class Enrollment {
    // å¯ä»¥å•ç‹¬æ§åˆ¶æ¯ä¸ªå…³ç³»çš„åˆ›å»ºã€åˆ é™¤
}
```

### 8.2 æ›¿ä»£æ–¹æ¡ˆæ€»ç»“


```
å¤šå¯¹å¤šçš„æ›¿ä»£è·¯å¾„ï¼š

éœ€æ±‚ï¼šAå’ŒBæ˜¯å¤šå¯¹å¤šå…³ç³»

æ–¹æ¡ˆ1ï¼šçº¯å¤šå¯¹å¤š
A â†â†’ B
é€‚ç”¨ï¼šç®€å•å…³è”ï¼Œæ— é¢å¤–å±æ€§

æ–¹æ¡ˆ2ï¼šä¸­é—´å®ä½“
A â† Relation â†’ B
é€‚ç”¨ï¼šå…³ç³»æœ‰ä¸šåŠ¡å±æ€§

æ–¹æ¡ˆ3ï¼šå†—ä½™è®¾è®¡
A.bIds (JSONå­—æ®µå­˜Bçš„IDåˆ—è¡¨)
é€‚ç”¨ï¼šè¯»å¤šå†™å°‘ï¼Œä¸éœ€è¦åŒå‘æŸ¥è¯¢
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¤šå¯¹å¤šå…³ç³»æœ¬è´¨


```
æ ¸å¿ƒç†è§£ï¼š
ğŸ”¸ å¤šå¯¹å¤š = ä¸¤ä¸ªä¸€å¯¹å¤šçš„ç»„åˆ
ğŸ”¸ ä¸­é—´è¡¨æ˜¯å…³ç³»çš„è½½ä½“
ğŸ”¸ å…³ç³»å‹æ•°æ®åº“æ— æ³•ç›´æ¥è¡¨ç¤ºå¤šå¯¹å¤š
ğŸ”¸ å¿…é¡»é€šè¿‡ä¸­é—´è¡¨ï¼ˆå…³è”è¡¨ï¼‰å®ç°
```

### 9.2 å…³é”®æ³¨è§£ç”¨æ³•


| æ³¨è§£ | ä½œç”¨ | ä½¿ç”¨ä½ç½® |
|------|------|---------|
| `@ManyToMany` | å£°æ˜å¤šå¯¹å¤šå…³ç³» | é›†åˆå±æ€§ä¸Š |
| `@JoinTable` | é…ç½®ä¸­é—´è¡¨ | å…³ç³»æ‹¥æœ‰æ–¹ |
| `mappedBy` | æŒ‡å®šå…³ç³»ç»´æŠ¤æ–¹ | å…³ç³»è¢«æ‹¥æœ‰æ–¹ |

**é…ç½®è¦ç‚¹ï¼š**

```java
// æ‹¥æœ‰æ–¹ï¼ˆä¸»æ§æ–¹ï¼‰
@ManyToMany
@JoinTable(
    name = "ä¸­é—´è¡¨å",
    joinColumns = @JoinColumn(name = "æˆ‘æ–¹å¤–é”®"),
    inverseJoinColumns = @JoinColumn(name = "å¯¹æ–¹å¤–é”®")
)
private List<å¯¹æ–¹å®ä½“> é›†åˆå±æ€§;

// è¢«æ‹¥æœ‰æ–¹ï¼ˆä»å±æ–¹ï¼‰
@ManyToMany(mappedBy = "å¯¹æ–¹çš„é›†åˆå±æ€§å")
private List<å¯¹æ–¹å®ä½“> é›†åˆå±æ€§;
```

### 9.3 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹


```
ä¼˜åŒ–ç­–ç•¥ï¼š
âœ… å»ºç«‹è”åˆç´¢å¼•ï¼š(å¤–é”®1, å¤–é”®2)
âœ… æ·»åŠ å”¯ä¸€çº¦æŸï¼šé˜²æ­¢é‡å¤å…³ç³»
âœ… åˆç†ä½¿ç”¨çº§è”ï¼šé¿å…è¯¯åˆ æ•°æ®
âœ… è€ƒè™‘æŸ¥è¯¢é¢‘ç‡ï¼šé«˜é¢‘æŸ¥è¯¢è€ƒè™‘å†—ä½™
```

### 9.4 ä¸šåŠ¡å»ºæ¨¡å†³ç­–


**å†³ç­–æ ‘ï¼š**

```
æ˜¯å¦éœ€è¦è®°å½•å…³ç³»ä¿¡æ¯ï¼Ÿ
  â”œâ”€ å¦ â†’ ä½¿ç”¨çº¯@ManyToMany
  â””â”€ æ˜¯ â†’ æ‹†è§£ä¸ºç‹¬ç«‹å®ä½“ + ä¸¤ä¸ª@ManyToOne
  
å…³ç³»æ˜¯å¦æ˜¯æ ¸å¿ƒä¸šåŠ¡ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ å¿…é¡»ç”¨ç‹¬ç«‹å®ä½“ï¼ˆå¦‚è®¢å•å•†å“ï¼‰
  â””â”€ å¦ â†’ å¯ä»¥ç”¨@ManyToManyï¼ˆå¦‚æ–‡ç« æ ‡ç­¾ï¼‰
  
æ€§èƒ½è¦æ±‚æ˜¯å¦ä¸¥æ ¼ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ è€ƒè™‘å†—ä½™æˆ–ç¼“å­˜æ–¹æ¡ˆ
  â””â”€ å¦ â†’ ç›´æ¥ä½¿ç”¨@ManyToMany
```

### 9.5 å¸¸è§è¯¯åŒºæé†’


```
âš ï¸ è¯¯åŒº1ï¼šä¸¤è¾¹éƒ½é…ç½®@JoinTable
æ­£ç¡®ï¼šåªåœ¨æ‹¥æœ‰æ–¹é…ç½®ï¼Œè¢«æ‹¥æœ‰æ–¹ç”¨mappedBy

âš ï¸ è¯¯åŒº2ï¼šmappedByå¡«é”™å€¼
æ­£ç¡®ï¼šå¡«å¯¹æ–¹å®ä½“çš„é›†åˆå±æ€§åï¼Œä¸æ˜¯è¡¨å

âš ï¸ è¯¯åŒº3ï¼šæ‰€æœ‰å¤šå¯¹å¤šéƒ½ç”¨@ManyToMany
æ­£ç¡®ï¼šæœ‰ä¸šåŠ¡å±æ€§æ—¶åº”æ‹†è§£ä¸ºç‹¬ç«‹å®ä½“

âš ï¸ è¯¯åŒº4ï¼šå¿˜è®°é…ç½®ç´¢å¼•
æ­£ç¡®ï¼šä¸­é—´è¡¨å¿…é¡»æœ‰ç´¢å¼•ï¼Œä¼˜å…ˆè”åˆç´¢å¼•
```

### 9.6 æœ€ä½³å®è·µå»ºè®®


**å®è·µæ¸…å•ï¼š**

â˜‘ï¸ **è¯„ä¼°éœ€æ±‚**ï¼šå…ˆåˆ¤æ–­æ˜¯å¦çœŸçš„éœ€è¦å¤šå¯¹å¤š  
â˜‘ï¸ **é€‰æ‹©æ–¹æ¡ˆ**ï¼šçº¯å¤šå¯¹å¤š vs ç‹¬ç«‹å®ä½“  
â˜‘ï¸ **é…ç½®ç´¢å¼•**ï¼šå¿…é¡»æ·»åŠ æŸ¥è¯¢ç´¢å¼•  
â˜‘ï¸ **å”¯ä¸€çº¦æŸ**ï¼šé˜²æ­¢é‡å¤å…³ç³»  
â˜‘ï¸ **æµ‹è¯•æ€§èƒ½**ï¼šéªŒè¯æŸ¥è¯¢æ•ˆç‡  
â˜‘ï¸ **æ–‡æ¡£è¯´æ˜**ï¼šæ³¨é‡Šå…³ç³»çš„ä¸šåŠ¡å«ä¹‰  

**æ ¸å¿ƒè®°å¿†ï¼š**
- å¤šå¯¹å¤šçš„æœ¬è´¨æ˜¯"ä¸­é—´è¡¨+ä¸¤ä¸ªå¤–é”®"
- ä¼˜å…ˆè€ƒè™‘æ‹†è§£ä¸ºç‹¬ç«‹å®ä½“ï¼Œä¿ç•™æ‰©å±•ç©ºé—´
- ç´¢å¼•å’Œå”¯ä¸€çº¦æŸä¸å¯å°‘
- ç®€å•åœºæ™¯ç”¨@ManyToManyï¼Œå¤æ‚åœºæ™¯æ‹†å®ä½“