---
title: 37ã€Criteriaæ¡ä»¶æ„å»º
---
## ğŸ“š ç›®å½•

1. [Criteriaæ¡ä»¶æ„å»ºåŸºç¡€](#1-Criteriaæ¡ä»¶æ„å»ºåŸºç¡€)
2. [åŸºæœ¬æ¯”è¾ƒæ¡ä»¶](#2-åŸºæœ¬æ¯”è¾ƒæ¡ä»¶)
3. [æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶](#3-æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶)
4. [èŒƒå›´æŸ¥è¯¢æ¡ä»¶](#4-èŒƒå›´æŸ¥è¯¢æ¡ä»¶)
5. [åˆ—è¡¨æŸ¥è¯¢æ¡ä»¶](#5-åˆ—è¡¨æŸ¥è¯¢æ¡ä»¶)
6. [ç©ºå€¼åˆ¤æ–­æ¡ä»¶](#6-ç©ºå€¼åˆ¤æ–­æ¡ä»¶)
7. [é€»è¾‘ç»„åˆæ¡ä»¶](#7-é€»è¾‘ç»„åˆæ¡ä»¶)
8. [å¤æ‚æ¡ä»¶ç»„åˆå®æˆ˜](#8-å¤æ‚æ¡ä»¶ç»„åˆå®æˆ˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Criteriaæ¡ä»¶æ„å»ºåŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯æ¡ä»¶æ„å»º


**ğŸ”¸ é€šä¿—ç†è§£**
```
Criteriaæ¡ä»¶æ„å»ºï¼Œå°±åƒæ˜¯ç”¨ä»£ç æ­ç§¯æœ¨æ¥è¡¨è¾¾æŸ¥è¯¢æ¡ä»¶ï¼š

ä¼ ç»ŸSQLæ–¹å¼ï¼š
WHERE age > 18 AND name LIKE '%å¼ %'

Criteriaæ–¹å¼ï¼š
ç”¨Javaå¯¹è±¡å’Œæ–¹æ³•æ¥è¡¨è¾¾åŒæ ·çš„æ¡ä»¶
- æ›´å®‰å…¨ï¼šç¼–è¯‘æœŸæ£€æŸ¥ï¼Œé¿å…SQLæ³¨å…¥
- æ›´çµæ´»ï¼šå¯ä»¥åŠ¨æ€ç»„è£…æ¡ä»¶
- æ›´ç±»å‹å®‰å…¨ï¼šå­—æ®µåé”™è¯¯ä¼šç›´æ¥æŠ¥é”™
```

### 1.2 åŸºæœ¬ä½¿ç”¨æµç¨‹


**ğŸ“‹ æ¡ä»¶æ„å»ºä¸‰æ­¥èµ°**
```
ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºCriteriaBuilderï¼ˆæ¡ä»¶æ„å»ºå™¨ï¼‰
â†“
ç¬¬äºŒæ­¥ï¼šä½¿ç”¨CriteriaBuilderæ„å»ºå„ç§æ¡ä»¶
â†“  
ç¬¬ä¸‰æ­¥ï¼šå°†æ¡ä»¶åº”ç”¨åˆ°æŸ¥è¯¢ä¸­

å°±åƒåšèœï¼š
- CriteriaBuilder = å¨å…·
- å„ç§æ¡ä»¶æ–¹æ³• = è°ƒæ–™
- æœ€ç»ˆæŸ¥è¯¢ = æˆå“èœè‚´
```

### 1.3 æ ¸å¿ƒå¯¹è±¡å…³ç³»å›¾


```
EntityManagerï¼ˆå®ä½“ç®¡ç†å™¨ï¼‰
    â†“ åˆ›å»º
CriteriaBuilderï¼ˆæ¡ä»¶æ„å»ºå™¨ï¼‰
    â†“ ä½¿ç”¨
å„ç§æ¡ä»¶æ–¹æ³•ï¼ˆequal, like, between...ï¼‰
    â†“ ç”Ÿæˆ
Predicateï¼ˆè°“è¯/æ¡ä»¶å¯¹è±¡ï¼‰
    â†“ åº”ç”¨åˆ°
CriteriaQueryï¼ˆæ¡ä»¶æŸ¥è¯¢ï¼‰
```

---

## 2. âš–ï¸ åŸºæœ¬æ¯”è¾ƒæ¡ä»¶


### 2.1 ç­‰äºæ¡ä»¶ equal


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
equal()ï¼šåˆ¤æ–­å­—æ®µå€¼æ˜¯å¦ç­‰äºæŸä¸ªå€¼
å°±åƒé—®ï¼šè¿™ä¸ªäººçš„å¹´é¾„æ˜¯ä¸æ˜¯18å²ï¼Ÿ

SQLç­‰ä»·ï¼šWHERE age = 18
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢å¹´é¾„ç­‰äº25å²çš„ç”¨æˆ·
CriteriaBuilder cb = entityManager.getCriteriaBuilder();
CriteriaQuery<User> query = cb.createQuery(User.class);
Root<User> root = query.from(User.class);

// æ„å»ºç­‰äºæ¡ä»¶ï¼šage = 25
Predicate condition = cb.equal(root.get("age"), 25);
query.where(condition);

List<User> users = entityManager.createQuery(query).getResultList();
```

**ğŸ¯ å®ç”¨åœºæ™¯**
```
å¸¸è§ç”¨é€”ï¼š
- æŒ‰IDæŸ¥è¯¢ï¼šequal(root.get("id"), userId)
- æŒ‰çŠ¶æ€æŸ¥è¯¢ï¼šequal(root.get("status"), "ACTIVE")
- æŒ‰ç±»å‹æŸ¥è¯¢ï¼šequal(root.get("type"), UserType.VIP)
```

### 2.2 ä¸ç­‰äºæ¡ä»¶ notEqual


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
notEqual()ï¼šåˆ¤æ–­å­—æ®µå€¼æ˜¯å¦ä¸ç­‰äºæŸä¸ªå€¼
å°±åƒé—®ï¼šè¿™ä¸ªäººçš„å¹´é¾„ä¸æ˜¯18å²å—ï¼Ÿ

SQLç­‰ä»·ï¼šWHERE age != 18 æˆ– WHERE age <> 18
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢çŠ¶æ€ä¸æ˜¯"å·²åˆ é™¤"çš„ç”¨æˆ·
Predicate condition = cb.notEqual(root.get("status"), "DELETED");
query.where(condition);

// ç­‰ä»·SQLï¼šWHERE status != 'DELETED'
```

### 2.3 å¤§äºæ¡ä»¶ greaterThan


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
greaterThan()ï¼šåˆ¤æ–­å­—æ®µå€¼æ˜¯å¦å¤§äºæŸä¸ªå€¼
greaterThanOrEqualTo()ï¼šå¤§äºæˆ–ç­‰äº

å°±åƒé—®ï¼šå¹´é¾„å¤§äº18å²å—ï¼Ÿ
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢å¹´é¾„å¤§äº18å²çš„ç”¨æˆ·
Predicate ageGt18 = cb.greaterThan(root.get("age"), 18);
query.where(ageGt18);

// æŸ¥è¯¢å¹´é¾„å¤§äºç­‰äº18å²
Predicate ageGte18 = cb.greaterThanOrEqualTo(root.get("age"), 18);
query.where(ageGte18);
```

**ğŸ“Š æ•°å€¼ç±»å‹å¯¹æ¯”**

| æ–¹æ³• | **å«ä¹‰** | **SQLç­‰ä»·** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|------------|-------------|
| `greaterThan` | å¤§äº | `>` | æŸ¥è¯¢æˆå¹´äººã€é«˜ä»·å•†å“ |
| `greaterThanOrEqualTo` | å¤§äºç­‰äº | `>=` | åŒ…å«è¾¹ç•Œå€¼çš„æŸ¥è¯¢ |
| `lessThan` | å°äº | `<` | æŸ¥è¯¢æœªæˆå¹´äººã€ä½ä»·å•†å“ |
| `lessThanOrEqualTo` | å°äºç­‰äº | `<=` | åŒ…å«è¾¹ç•Œå€¼çš„æŸ¥è¯¢ |

### 2.4 å°äºæ¡ä»¶ lessThan


**ğŸ’» å®Œæ•´ç¤ºä¾‹**
```java
// æŸ¥è¯¢ä»·æ ¼å°äº100çš„å•†å“
CriteriaBuilder cb = entityManager.getCriteriaBuilder();
CriteriaQuery<Product> query = cb.createQuery(Product.class);
Root<Product> root = query.from(Product.class);

// å°äº100
Predicate priceLt100 = cb.lessThan(root.get("price"), 100);

// å°äºç­‰äº100
Predicate priceLte100 = cb.lessThanOrEqualTo(root.get("price"), 100);

query.where(priceLt100);
```

---

## 3. ğŸ” æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶


### 3.1 likeæ¨¡ç³ŠåŒ¹é…


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
like()ï¼šæ¨¡ç³ŠåŒ¹é…ï¼Œå°±åƒåœ¨ä¸€å †åå­—ä¸­æ‰¾åŒ…å«æŸäº›å­—çš„äºº

é€šé…ç¬¦è¯´æ˜ï¼š
% = ä»»æ„å¤šä¸ªå­—ç¬¦ï¼ˆ0ä¸ªæˆ–å¤šä¸ªï¼‰
_ = å•ä¸ªå­—ç¬¦

ä¾‹å­ï¼š
- "å¼ %" = å§“å¼ çš„æ‰€æœ‰äººï¼ˆå¼ ä¸‰ã€å¼ ä¼Ÿã€å¼ å°æ˜...ï¼‰
- "%æ˜" = åå­—ä»¥æ˜ç»“å°¾ï¼ˆå°æ˜ã€å¤§æ˜ã€ç‹å°æ˜...ï¼‰
- "%å¼ %" = åå­—ä¸­åŒ…å«å¼ ï¼ˆå¼ ä¸‰ã€å¼ å°æ˜ã€æå¼ ä¼Ÿ...ï¼‰
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢å§“å¼ çš„ç”¨æˆ·
Predicate condition1 = cb.like(root.get("name"), "å¼ %");

// æŸ¥è¯¢åå­—ä¸­åŒ…å«"å°"çš„ç”¨æˆ·
Predicate condition2 = cb.like(root.get("name"), "%å°%");

// æŸ¥è¯¢åå­—ä»¥"æ˜"ç»“å°¾çš„ç”¨æˆ·
Predicate condition3 = cb.like(root.get("name"), "%æ˜");

query.where(condition1);
```

### 3.2 notLikeåå‘æ¨¡ç³ŠåŒ¹é…


**ğŸ’» æ’é™¤ç‰¹å®šæ¨¡å¼**
```java
// æŸ¥è¯¢åå­—ä¸­ä¸åŒ…å«"æµ‹è¯•"çš„ç”¨æˆ·
Predicate notTestUser = cb.notLike(root.get("name"), "%æµ‹è¯•%");
query.where(notTestUser);

// åº”ç”¨åœºæ™¯ï¼šæ’é™¤æµ‹è¯•è´¦å·ã€è¿‡æ»¤æ•æ„Ÿè¯ç­‰
```

### 3.3 å®ç”¨æ¨¡ç³ŠæŸ¥è¯¢æŠ€å·§


**ğŸ¯ åŠ¨æ€æ¨¡ç³ŠæŸ¥è¯¢**
```java
public List<User> searchUsers(String keyword) {
    CriteriaBuilder cb = entityManager.getCriteriaBuilder();
    CriteriaQuery<User> query = cb.createQuery(User.class);
    Root<User> root = query.from(User.class);
    
    if (keyword != null && !keyword.isEmpty()) {
        // åœ¨åå­—æˆ–é‚®ç®±ä¸­æœç´¢å…³é”®è¯
        String pattern = "%" + keyword + "%";
        Predicate nameLike = cb.like(root.get("name"), pattern);
        Predicate emailLike = cb.like(root.get("email"), pattern);
        
        // åå­—æˆ–é‚®ç®±åŒ¹é…å³å¯
        query.where(cb.or(nameLike, emailLike));
    }
    
    return entityManager.createQuery(query).getResultList();
}
```

---

## 4. ğŸ“Š èŒƒå›´æŸ¥è¯¢æ¡ä»¶


### 4.1 betweenèŒƒå›´æ¡ä»¶


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
between()ï¼šåˆ¤æ–­å€¼æ˜¯å¦åœ¨æŸä¸ªèŒƒå›´å†…ï¼ˆåŒ…å«è¾¹ç•Œï¼‰
å°±åƒé—®ï¼šå¹´é¾„åœ¨18åˆ°60å²ä¹‹é—´å—ï¼Ÿ

ç‰¹ç‚¹ï¼š
- åŒ…å«èµ·å§‹å€¼å’Œç»“æŸå€¼
- é€‚ç”¨äºæ•°å€¼ã€æ—¥æœŸç­‰å¯æ¯”è¾ƒç±»å‹

SQLç­‰ä»·ï¼šWHERE age BETWEEN 18 AND 60
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢å¹´é¾„åœ¨18åˆ°60å²ä¹‹é—´çš„ç”¨æˆ·
Predicate ageBetween = cb.between(root.get("age"), 18, 60);
query.where(ageBetween);

// æŸ¥è¯¢ä»·æ ¼åœ¨100åˆ°500ä¹‹é—´çš„å•†å“
Predicate priceBetween = cb.between(root.get("price"), 
    new BigDecimal("100"), 
    new BigDecimal("500"));
```

### 4.2 æ—¥æœŸèŒƒå›´æŸ¥è¯¢


**ğŸ“… æ—¥æœŸåŒºé—´å®æˆ˜**
```java
// æŸ¥è¯¢æœ€è¿‘30å¤©æ³¨å†Œçš„ç”¨æˆ·
LocalDateTime thirtyDaysAgo = LocalDateTime.now().minusDays(30);
LocalDateTime now = LocalDateTime.now();

Predicate dateRange = cb.between(
    root.get("registerTime"), 
    thirtyDaysAgo, 
    now
);
query.where(dateRange);
```

**ğŸ¯ å¸¸ç”¨æ—¥æœŸèŒƒå›´åœºæ™¯**
```
ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹ï¼š

é”€å”®ç»Ÿè®¡ï¼š
- æœ¬æœˆé”€å”®ï¼šbetween(firstDayOfMonth, lastDayOfMonth)
- æœ¬å­£åº¦ï¼šbetween(quarterStart, quarterEnd)
- æœ¬å¹´åº¦ï¼šbetween(yearStart, yearEnd)

æ•°æ®è¿‡æ»¤ï¼š
- æœ€è¿‘7å¤©æ´»è·ƒç”¨æˆ·
- æœ¬å‘¨æ–°å¢è®¢å•
- ä¸Šæœˆåˆ°æœŸä¼šå‘˜
```

---

## 5. ğŸ“ åˆ—è¡¨æŸ¥è¯¢æ¡ä»¶


### 5.1 inåˆ—è¡¨æ¡ä»¶


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
in()ï¼šåˆ¤æ–­å€¼æ˜¯å¦åœ¨æŒ‡å®šåˆ—è¡¨ä¸­
å°±åƒé—®ï¼šè¿™ä¸ªäººçš„åŸå¸‚æ˜¯åŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ä¸­çš„æŸä¸€ä¸ªå—ï¼Ÿ

SQLç­‰ä»·ï¼šWHERE city IN ('åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·')
```

**ğŸ’» åŸºç¡€ç”¨æ³•**
```java
// æŸ¥è¯¢æ¥è‡ªä¸€çº¿åŸå¸‚çš„ç”¨æˆ·
List<String> cities = Arrays.asList("åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³");
Predicate cityIn = root.get("city").in(cities);
query.where(cityIn);

// æŸ¥è¯¢ç‰¹å®šçŠ¶æ€çš„è®¢å•
List<String> statuses = Arrays.asList("PENDING", "PROCESSING", "CONFIRMED");
Predicate statusIn = root.get("status").in(statuses);
```

### 5.2 notInåå‘åˆ—è¡¨


**ğŸ’» æ’é™¤ç‰¹å®šå€¼**
```java
// æŸ¥è¯¢ä¸åœ¨é»‘åå•ä¸­çš„ç”¨æˆ·
List<Long> blacklist = Arrays.asList(100L, 200L, 300L);
Predicate notInBlacklist = cb.not(root.get("id").in(blacklist));
query.where(notInBlacklist);

// æˆ–è€…ç›´æ¥ä½¿ç”¨
Expression<Long> idExpression = root.get("id");
Predicate notIn = cb.not(idExpression.in(blacklist));
```

### 5.3 åŠ¨æ€åˆ—è¡¨æŸ¥è¯¢


**ğŸ¯ å®ç”¨åœºæ™¯**
```java
public List<Product> findByCategories(List<String> categoryNames) {
    CriteriaBuilder cb = entityManager.getCriteriaBuilder();
    CriteriaQuery<Product> query = cb.createQuery(Product.class);
    Root<Product> root = query.from(Product.class);
    
    if (categoryNames != null && !categoryNames.isEmpty()) {
        // æ ¹æ®ä¼ å…¥çš„ç±»åˆ«åˆ—è¡¨æŸ¥è¯¢
        Predicate categoryIn = root.get("category").in(categoryNames);
        query.where(categoryIn);
    }
    
    return entityManager.createQuery(query).getResultList();
}

// ä½¿ç”¨ç¤ºä¾‹
List<String> electronics = Arrays.asList("æ‰‹æœº", "ç”µè„‘", "å¹³æ¿");
List<Product> products = findByCategories(electronics);
```

---

## 6. â“ ç©ºå€¼åˆ¤æ–­æ¡ä»¶


### 6.1 isNullç©ºå€¼åˆ¤æ–­


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
isNull()ï¼šåˆ¤æ–­å­—æ®µå€¼æ˜¯å¦ä¸ºnull
å°±åƒé—®ï¼šè¿™ä¸ªäººæœ‰æ²¡æœ‰å¡«å†™é‚®ç®±ï¼Ÿï¼ˆé‚®ç®±å­—æ®µæ˜¯nullå—ï¼Ÿï¼‰

SQLç­‰ä»·ï¼šWHERE email IS NULL
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢æœªå¡«å†™é‚®ç®±çš„ç”¨æˆ·
Predicate emailIsNull = cb.isNull(root.get("email"));
query.where(emailIsNull);

// æŸ¥è¯¢æœªåˆ†é…éƒ¨é—¨çš„å‘˜å·¥
Predicate deptIsNull = cb.isNull(root.get("department"));
```

### 6.2 isNotNulléç©ºåˆ¤æ–­


**ğŸ’» æŸ¥è¯¢æœ‰å€¼çš„è®°å½•**
```java
// æŸ¥è¯¢å·²å¡«å†™æ‰‹æœºå·çš„ç”¨æˆ·
Predicate phoneNotNull = cb.isNotNull(root.get("phone"));
query.where(phoneNotNull);

// æŸ¥è¯¢å·²å®Œæˆçš„è®¢å•ï¼ˆå®Œæˆæ—¶é—´ä¸ä¸ºç©ºï¼‰
Predicate completedOrders = cb.isNotNull(root.get("completeTime"));
```

### 6.3 ç©ºå€¼å¤„ç†å®æˆ˜


**ğŸ¯ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**
```java
// æŸ¥è¯¢ä¿¡æ¯ä¸å®Œæ•´çš„ç”¨æˆ·ï¼ˆé‚®ç®±æˆ–æ‰‹æœºè‡³å°‘æœ‰ä¸€ä¸ªä¸ºç©ºï¼‰
Predicate emailNull = cb.isNull(root.get("email"));
Predicate phoneNull = cb.isNull(root.get("phone"));
Predicate infoIncomplete = cb.or(emailNull, phoneNull);
query.where(infoIncomplete);

// æŸ¥è¯¢å®Œæ•´ä¿¡æ¯çš„ç”¨æˆ·ï¼ˆé‚®ç®±å’Œæ‰‹æœºéƒ½ä¸ä¸ºç©ºï¼‰
Predicate emailNotNull = cb.isNotNull(root.get("email"));
Predicate phoneNotNull = cb.isNotNull(root.get("phone"));
Predicate infoComplete = cb.and(emailNotNull, phoneNotNull);
```

---

## 7. ğŸ”— é€»è¾‘ç»„åˆæ¡ä»¶


### 7.1 andé€»è¾‘ä¸


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
and()ï¼šæ‰€æœ‰æ¡ä»¶éƒ½å¿…é¡»æ»¡è¶³
å°±åƒæ‹›è˜è¦æ±‚ï¼šå¹´é¾„25-35å² AND æœ¬ç§‘ä»¥ä¸Š AND 3å¹´ç»éªŒ

ç‰¹ç‚¹ï¼š
- æ¡ä»¶è¶Šå¤šï¼Œç»“æœè¶Šå°‘
- æ‰€æœ‰æ¡ä»¶åŒæ—¶æˆç«‹æ‰è¿”å›æ•°æ®

SQLç­‰ä»·ï¼šWHERE age >= 25 AND age <= 35 AND education = 'æœ¬ç§‘'
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢å¹´é¾„åœ¨25-35ä¹‹é—´ä¸”å­¦å†ä¸ºæœ¬ç§‘çš„ç”¨æˆ·
Predicate ageGte25 = cb.greaterThanOrEqualTo(root.get("age"), 25);
Predicate ageLte35 = cb.lessThanOrEqualTo(root.get("age"), 35);
Predicate education = cb.equal(root.get("education"), "æœ¬ç§‘");

// ç»„åˆæ‰€æœ‰æ¡ä»¶
Predicate combined = cb.and(ageGte25, ageLte35, education);
query.where(combined);
```

**ğŸ“‹ å¤šæ¡ä»¶ç»„åˆ**
```java
// æ–¹å¼1ï¼šé€æ­¥ç»„åˆ
Predicate condition1 = cb.equal(root.get("status"), "ACTIVE");
Predicate condition2 = cb.greaterThan(root.get("score"), 80);
Predicate condition3 = cb.like(root.get("city"), "åŒ—äº¬%");
Predicate allConditions = cb.and(condition1, condition2, condition3);

// æ–¹å¼2ï¼šæ•°ç»„æ–¹å¼
Predicate[] conditions = {condition1, condition2, condition3};
query.where(cb.and(conditions));
```

### 7.2 oré€»è¾‘æˆ–


**ğŸ”¸ æ¦‚å¿µç†è§£**
```
or()ï¼šæ»¡è¶³ä»»æ„ä¸€ä¸ªæ¡ä»¶å³å¯
å°±åƒä¼˜æƒ æ´»åŠ¨ï¼šä¼šå‘˜ OR é¦–æ¬¡è´­ä¹° OR æ»¡100å…ƒ

ç‰¹ç‚¹ï¼š
- æ¡ä»¶è¶Šå¤šï¼Œç»“æœè¶Šå¤š
- åªè¦æœ‰ä¸€ä¸ªæ¡ä»¶æˆç«‹å°±è¿”å›æ•°æ®

SQLç­‰ä»·ï¼šWHERE is_vip = 1 OR is_first_order = 1 OR amount >= 100
```

**ğŸ’» ä»£ç ç¤ºä¾‹**
```java
// æŸ¥è¯¢VIPç”¨æˆ·æˆ–æ¶ˆè´¹è¶…è¿‡1000çš„ç”¨æˆ·
Predicate isVip = cb.equal(root.get("vipLevel"), "VIP");
Predicate highConsumer = cb.greaterThan(root.get("totalAmount"), 1000);

Predicate combined = cb.or(isVip, highConsumer);
query.where(combined);
```

### 7.3 é€»è¾‘é not


**ğŸ’» å–åæ“ä½œ**
```java
// æŸ¥è¯¢ä¸æ˜¯VIPçš„ç”¨æˆ·
Predicate notVip = cb.not(cb.equal(root.get("vipLevel"), "VIP"));

// æŸ¥è¯¢å¹´é¾„ä¸åœ¨18-60ä¹‹é—´çš„ç”¨æˆ·
Predicate ageBetween = cb.between(root.get("age"), 18, 60);
Predicate ageNotInRange = cb.not(ageBetween);
```

---

## 8. ğŸ¨ å¤æ‚æ¡ä»¶ç»„åˆå®æˆ˜


### 8.1 åµŒå¥—é€»è¾‘ç»„åˆ


**ğŸ”¸ ä¸šåŠ¡åœºæ™¯**
```
éœ€æ±‚ï¼šæŸ¥è¯¢ç¬¦åˆä»¥ä¸‹æ¡ä»¶çš„ç”¨æˆ·
- (å¹´é¾„18-30 AND åœ¨åŒ—äº¬) OR (å¹´é¾„30-50 AND VIPä¼šå‘˜)

åˆ†æï¼š
æ¡ä»¶ç»„1ï¼šå¹´è½»ç”¨æˆ·åœ¨åŒ—äº¬
æ¡ä»¶ç»„2ï¼šä¸­å¹´VIPç”¨æˆ·
ä¸¤ç»„æ»¡è¶³å…¶ä¸€å³å¯
```

**ğŸ’» å®ç°ä»£ç **
```java
// æ¡ä»¶ç»„1ï¼šå¹´è½»äººåœ¨åŒ—äº¬
Predicate young = cb.between(root.get("age"), 18, 30);
Predicate inBeijing = cb.equal(root.get("city"), "åŒ—äº¬");
Predicate group1 = cb.and(young, inBeijing);

// æ¡ä»¶ç»„2ï¼šä¸­å¹´VIP
Predicate middleAge = cb.between(root.get("age"), 30, 50);
Predicate isVip = cb.equal(root.get("vipLevel"), "VIP");
Predicate group2 = cb.and(middleAge, isVip);

// ç»„åˆä¸¤ç»„æ¡ä»¶ï¼ˆORå…³ç³»ï¼‰
Predicate finalCondition = cb.or(group1, group2);
query.where(finalCondition);
```

### 8.2 åŠ¨æ€æ¡ä»¶æ„å»º


**ğŸ¯ æ ¹æ®å‚æ•°åŠ¨æ€ç»„åˆ**
```java
public class UserSearchDTO {
    private String name;          // å§“åï¼ˆå¯é€‰ï¼‰
    private Integer minAge;       // æœ€å°å¹´é¾„ï¼ˆå¯é€‰ï¼‰
    private Integer maxAge;       // æœ€å¤§å¹´é¾„ï¼ˆå¯é€‰ï¼‰
    private String city;          // åŸå¸‚ï¼ˆå¯é€‰ï¼‰
    private List<String> statuses; // çŠ¶æ€åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
}

public List<User> dynamicSearch(UserSearchDTO searchDTO) {
    CriteriaBuilder cb = entityManager.getCriteriaBuilder();
    CriteriaQuery<User> query = cb.createQuery(User.class);
    Root<User> root = query.from(User.class);
    
    // ç”¨äºæ”¶é›†æ‰€æœ‰æ¡ä»¶
    List<Predicate> predicates = new ArrayList<>();
    
    // 1. å§“åæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå¦‚æœæä¾›ï¼‰
    if (searchDTO.getName() != null && !searchDTO.getName().isEmpty()) {
        predicates.add(cb.like(root.get("name"), "%" + searchDTO.getName() + "%"));
    }
    
    // 2. å¹´é¾„èŒƒå›´ï¼ˆå¦‚æœæä¾›ï¼‰
    if (searchDTO.getMinAge() != null) {
        predicates.add(cb.greaterThanOrEqualTo(root.get("age"), searchDTO.getMinAge()));
    }
    if (searchDTO.getMaxAge() != null) {
        predicates.add(cb.lessThanOrEqualTo(root.get("age"), searchDTO.getMaxAge()));
    }
    
    // 3. åŸå¸‚åŒ¹é…ï¼ˆå¦‚æœæä¾›ï¼‰
    if (searchDTO.getCity() != null && !searchDTO.getCity().isEmpty()) {
        predicates.add(cb.equal(root.get("city"), searchDTO.getCity()));
    }
    
    // 4. çŠ¶æ€åˆ—è¡¨ï¼ˆå¦‚æœæä¾›ï¼‰
    if (searchDTO.getStatuses() != null && !searchDTO.getStatuses().isEmpty()) {
        predicates.add(root.get("status").in(searchDTO.getStatuses()));
    }
    
    // å°†æ‰€æœ‰æ¡ä»¶ç”¨ANDç»„åˆ
    if (!predicates.isEmpty()) {
        query.where(cb.and(predicates.toArray(new Predicate[0])));
    }
    
    return entityManager.createQuery(query).getResultList();
}
```

### 8.3 å¤æ‚ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹


**ğŸ›ï¸ ç”µå•†å•†å“æœç´¢**
```java
// éœ€æ±‚ï¼šå•†å“æœç´¢åŠŸèƒ½
// - ä»·æ ¼åœ¨minPriceåˆ°maxPriceä¹‹é—´
// - åˆ†ç±»åœ¨æŒ‡å®šåˆ—è¡¨ä¸­
// - åº“å­˜å¤§äº0
// - (å“ç‰Œä¸ºæŒ‡å®šå“ç‰Œ OR è¯„åˆ†>=4.5)

public List<Product> searchProducts(
    BigDecimal minPrice, 
    BigDecimal maxPrice,
    List<String> categories,
    String brand
) {
    CriteriaBuilder cb = entityManager.getCriteriaBuilder();
    CriteriaQuery<Product> query = cb.createQuery(Product.class);
    Root<Product> root = query.from(Product.class);
    
    List<Predicate> conditions = new ArrayList<>();
    
    // ä»·æ ¼èŒƒå›´
    if (minPrice != null && maxPrice != null) {
        conditions.add(cb.between(root.get("price"), minPrice, maxPrice));
    }
    
    // åˆ†ç±»ç­›é€‰
    if (categories != null && !categories.isEmpty()) {
        conditions.add(root.get("category").in(categories));
    }
    
    // æœ‰åº“å­˜
    conditions.add(cb.greaterThan(root.get("stock"), 0));
    
    // å“ç‰Œæˆ–é«˜è¯„åˆ†
    if (brand != null) {
        Predicate brandMatch = cb.equal(root.get("brand"), brand);
        Predicate highRating = cb.greaterThanOrEqualTo(root.get("rating"), 4.5);
        conditions.add(cb.or(brandMatch, highRating));
    }
    
    query.where(cb.and(conditions.toArray(new Predicate[0])));
    
    // æŒ‰ä»·æ ¼å‡åºæ’åº
    query.orderBy(cb.asc(root.get("price")));
    
    return entityManager.createQuery(query).getResultList();
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 æ¡ä»¶æ–¹æ³•é€ŸæŸ¥è¡¨


| æ¡ä»¶ç±»å‹ | **æ–¹æ³•** | **å«ä¹‰** | **SQLç­‰ä»·** | **å…¸å‹åœºæ™¯** |
|---------|---------|---------|------------|-------------|
| **ç›¸ç­‰** | `equal` | ç­‰äº | `=` | ç²¾ç¡®åŒ¹é… |
| **ä¸ç­‰** | `notEqual` | ä¸ç­‰äº | `!=` | æ’é™¤ç‰¹å®šå€¼ |
| **æ¯”è¾ƒ** | `greaterThan` | å¤§äº | `>` | æ•°å€¼ã€æ—¥æœŸæ¯”è¾ƒ |
|  | `greaterThanOrEqualTo` | å¤§äºç­‰äº | `>=` |  |
|  | `lessThan` | å°äº | `<` |  |
|  | `lessThanOrEqualTo` | å°äºç­‰äº | `<=` |  |
| **æ¨¡ç³Š** | `like` | æ¨¡ç³ŠåŒ¹é… | `LIKE` | æ–‡æœ¬æœç´¢ |
|  | `notLike` | ä¸åŒ¹é… | `NOT LIKE` | æ’é™¤æ¨¡å¼ |
| **èŒƒå›´** | `between` | åŒºé—´èŒƒå›´ | `BETWEEN` | ä»·æ ¼ã€æ—¥æœŸåŒºé—´ |
| **åˆ—è¡¨** | `in` | åœ¨åˆ—è¡¨ä¸­ | `IN` | å¤šå€¼åŒ¹é… |
|  | `not(in)` | ä¸åœ¨åˆ—è¡¨ä¸­ | `NOT IN` | æ’é™¤å¤šå€¼ |
| **ç©ºå€¼** | `isNull` | ä¸ºç©º | `IS NULL` | æ•°æ®å®Œæ•´æ€§ |
|  | `isNotNull` | ä¸ä¸ºç©º | `IS NOT NULL` |  |
| **é€»è¾‘** | `and` | é€»è¾‘ä¸ | `AND` | æ¡ä»¶ç»„åˆ |
|  | `or` | é€»è¾‘æˆ– | `OR` |  |
|  | `not` | é€»è¾‘é | `NOT` | æ¡ä»¶å–å |

### 9.2 æœ€ä½³å®è·µå»ºè®®


**ğŸ’¡ æ¡ä»¶æ„å»ºåŸåˆ™**
```
1. ç±»å‹å®‰å…¨ä¼˜å…ˆ
   âœ… ä½¿ç”¨Metamodelé¿å…å­—ç¬¦ä¸²ç¡¬ç¼–ç 
   âœ… ç¼–è¯‘æœŸæ£€æŸ¥å­—æ®µåé”™è¯¯
   
2. åŠ¨æ€æ¡ä»¶ä½¿ç”¨Listæ”¶é›†
   âœ… çµæ´»æ·»åŠ å¯é€‰æ¡ä»¶
   âœ… æœ€åç”¨æ•°ç»„è½¬æ¢ç»Ÿä¸€å¤„ç†
   
3. å¤æ‚é€»è¾‘åˆ†ç»„æ¸…æ™°
   âœ… ç”¨å˜é‡å‘½åè¡¨è¾¾ä¸šåŠ¡å«ä¹‰
   âœ… å…ˆç»„åˆå°æ¡ä»¶ï¼Œå†ç»„åˆå¤§æ¡ä»¶
   
4. æ€§èƒ½è€ƒè™‘
   âœ… ç´¢å¼•å­—æ®µæ”¾åœ¨å‰é¢
   âœ… é¿å…å¯¹å¤§å­—æ®µä½¿ç”¨like
   âœ… åˆç†ä½¿ç”¨inçš„åˆ—è¡¨å¤§å°
```

**ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯æ€»ç»“**
```
æœç´¢åŠŸèƒ½ï¼š
- likeæ¨¡ç³ŠæŸ¥è¯¢ + åŠ¨æ€æ¡ä»¶ç»„åˆ
- å¤šå­—æ®µORå…³ç³»æœç´¢

æ•°æ®ç­›é€‰ï¼š
- betweenèŒƒå›´æ¡ä»¶
- inåˆ—è¡¨æ¡ä»¶
- andå¤šæ¡ä»¶è¿‡æ»¤

ä¸šåŠ¡è§„åˆ™ï¼š
- åµŒå¥—é€»è¾‘ç»„åˆ
- å¤æ‚æ¡ä»¶åˆ¤æ–­
- çŠ¶æ€æœºè½¬æ¢æŸ¥è¯¢
```

**ğŸ”§ è°ƒè¯•æŠ€å·§**
```java
// æ‰“å°ç”Ÿæˆçš„SQL
query.where(yourCondition);
TypedQuery<User> typedQuery = entityManager.createQuery(query);

// åœ¨æ—¥å¿—ä¸­æŸ¥çœ‹å®é™…SQL
// é…ç½®application.propertiesï¼š
// spring.jpa.show-sql=true
// spring.jpa.properties.hibernate.format_sql=true
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Criteriaæ¡ä»¶æ„å»º = ç”¨Javaä»£ç è¡¨è¾¾SQLçš„WHEREå­å¥
- CriteriaBuilderæä¾›æ‰€æœ‰æ¡ä»¶æ„å»ºæ–¹æ³•
- Predicateæ˜¯æ¡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ç”¨and/orç»„åˆ
- åŠ¨æ€æ¡ä»¶ç”¨Listæ”¶é›†ï¼Œæœ€åè½¬æ•°ç»„åº”ç”¨
- å¤æ‚æ¡ä»¶å…ˆåˆ†ç»„å†ç»„åˆï¼Œä¿æŒé€»è¾‘æ¸…æ™°