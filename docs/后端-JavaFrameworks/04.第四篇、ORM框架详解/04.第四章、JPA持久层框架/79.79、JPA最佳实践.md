---
title: 79ã€JPAæœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•


1. [å®ä½“è®¾è®¡åŸåˆ™](#1-å®ä½“è®¾è®¡åŸåˆ™)
2. [å…³ç³»æ˜ å°„é€‰æ‹©æŒ‡å—](#2-å…³ç³»æ˜ å°„é€‰æ‹©æŒ‡å—)
3. [æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æ¸…å•](#3-æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æ¸…å•)
4. [äº‹åŠ¡ç®¡ç†ç­–ç•¥](#4-äº‹åŠ¡ç®¡ç†ç­–ç•¥)
5. [ç¼“å­˜ä½¿ç”¨å»ºè®®](#5-ç¼“å­˜ä½¿ç”¨å»ºè®®)
6. [ç›‘æ§æŒ‡æ ‡è®¾ç½®](#6-ç›‘æ§æŒ‡æ ‡è®¾ç½®)
7. [ä»£ç ç»„ç»‡ç»“æ„](#7-ä»£ç ç»„ç»‡ç»“æ„)
8. [ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•](#8-ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å®ä½“è®¾è®¡åŸåˆ™



### 1.1 ä»€ä¹ˆæ˜¯å®ä½“è®¾è®¡åŸåˆ™



**é€šä¿—ç†è§£**ï¼šå°±åƒç›–æˆ¿å­è¦å…ˆè®¾è®¡å›¾çº¸ä¸€æ ·ï¼Œå†™JPAå®ä½“ç±»ä¹Ÿè¦éµå¾ªä¸€äº›"è®¾è®¡è§„èŒƒ"ï¼Œè¿™æ ·æ‰èƒ½é¿å…åæœŸå‡ºç°æ€§èƒ½é—®é¢˜å’Œç»´æŠ¤å›°éš¾ã€‚

**æ ¸å¿ƒç†å¿µ**ï¼š
```
å®ä½“è®¾è®¡ = æ•°æ®åº“è¡¨çš„Javaç‰ˆæœ¬
è®¾è®¡å¥½åç›´æ¥å½±å“ï¼š
â€¢ ç¨‹åºè¿è¡Œé€Ÿåº¦
â€¢ ä»£ç ç»´æŠ¤éš¾åº¦
â€¢ æ•°æ®åº“æ€§èƒ½
```

### 1.2 å®ä½“ç±»è®¾è®¡é»„é‡‘æ³•åˆ™



> ğŸ“Œ **æ ¸å¿ƒåŸåˆ™**  
> å®ä½“ç±»åº”è¯¥"è½»é‡çº§"ã€"èŒè´£å•ä¸€"ã€"å…³ç³»æ¸…æ™°"

**ğŸŒ± å…¥é—¨çº§ï¼šåŸºç¡€è®¾è®¡è§„èŒƒ**

**æ³•åˆ™1ï¼šä¿æŒå®ä½“ç±»ç®€å•çº¯ç²¹**
```
ä»€ä¹ˆæ„æ€ï¼Ÿ
å®ä½“ç±»åªè´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œä¸è¦å¡å…¥å¤æ‚çš„ä¸šåŠ¡é€»è¾‘

é”™è¯¯ç¤ºä¾‹ï¼šå®ä½“ç±»é‡Œå†™äº†è®¡ç®—æŠ˜æ‰£ã€å‘é€é‚®ä»¶çš„æ–¹æ³• âŒ
æ­£ç¡®åšæ³•ï¼šè¿™äº›é€»è¾‘åº”è¯¥åœ¨Serviceå±‚å¤„ç† âœ…
```

**æ³•åˆ™2ï¼šä¸»é”®ç­–ç•¥è¦æ…é‡é€‰æ‹©**

| ç­–ç•¥ç±»å‹ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|---------|---------|
| `AUTO` | å°å‹åº”ç”¨ | ç®€å•çœäº‹ | ä¸å¯æ§ï¼Œå¯èƒ½æ€§èƒ½å·® |
| `IDENTITY` | MySQLå¸¸ç”¨ | æ•°æ®åº“è‡ªå¢ï¼Œç®€å• | æ‰¹é‡æ’å…¥æ€§èƒ½å·® |
| `SEQUENCE` | Oracle/PostgreSQL | æ€§èƒ½å¥½ï¼Œæ”¯æŒæ‰¹é‡ | éœ€è¦æ•°æ®åº“æ”¯æŒ |
| `UUID` | åˆ†å¸ƒå¼ç³»ç»Ÿ | å…¨å±€å”¯ä¸€ï¼Œæ— å†²çª | å ç”¨ç©ºé—´å¤§ |

```java
// âœ… æ¨èï¼šæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©
@Id
@GeneratedValue(strategy = GenerationType.SEQUENCE)
private Long id;  // ç”¨äºOracle/PostgreSQL

@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)  
private Long id;  // ç”¨äºMySQL

@Id
@GeneratedValue(generator = "uuid2")
private String id;  // åˆ†å¸ƒå¼ç³»ç»Ÿç”¨UUID
```

**æ³•åˆ™3ï¼šå­—æ®µå‘½åè¦è§åçŸ¥æ„**
```
ä¸å¥½çš„å‘½åï¼šstr1, str2, data, info
å¥½çš„å‘½åï¼šuserName, orderDate, productPrice

åŸå› ï¼š
â€¢ ä»£ç å¯è¯»æ€§æ›´å¼º
â€¢ SQLæ—¥å¿—æ›´å®¹æ˜“çœ‹æ‡‚
â€¢ å›¢é˜Ÿåä½œæ›´é¡ºç•…
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šæ€§èƒ½ä¼˜åŒ–è®¾è®¡**

**æ³•åˆ™4ï¼šåˆç†ä½¿ç”¨æ‡’åŠ è½½**

```
ä»€ä¹ˆæ˜¯æ‡’åŠ è½½ï¼Ÿ
å°±åƒç½‘é¡µå›¾ç‰‡æ»šåŠ¨åˆ°æ‰åŠ è½½ï¼ŒJPAå…³è”æ•°æ®ä¹Ÿå¯ä»¥"ç”¨æ—¶å†æŸ¥"

ä½¿ç”¨å»ºè®®ï¼š
â€¢ ä¸€å¯¹å¤šå…³ç³»ï¼šé»˜è®¤ç”¨æ‡’åŠ è½½ @OneToMany(fetch = LAZY)
â€¢ å¤šå¯¹ä¸€å…³ç³»ï¼šçœ‹æƒ…å†µï¼Œå¸¸ç”¨çš„ç”¨ç«‹å³åŠ è½½
```

```java
// ä¾‹å­ï¼šè®¢å•å’Œè®¢å•è¯¦æƒ…çš„å…³ç³»
@Entity
public class Order {
    @Id
    private Long id;
    
    // âœ… è®¢å•è¯¦æƒ…ä¸å¸¸ç”¨ï¼Œæ‡’åŠ è½½
    @OneToMany(fetch = FetchType.LAZY)
    private List<OrderItem> items;
    
    // âœ… å®¢æˆ·ä¿¡æ¯ç»å¸¸è¦ç”¨ï¼Œç«‹å³åŠ è½½
    @ManyToOne(fetch = FetchType.EAGER)
    private Customer customer;
}
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> æ‡’åŠ è½½è™½å¥½ï¼Œä½†è¦æ³¨æ„"ä¼šè¯å…³é—­"é—®é¢˜  
> è§£å†³åŠæ³•ï¼šåœ¨éœ€è¦æ•°æ®çš„åœ°æ–¹æå‰åŠ è½½ï¼Œæˆ–è€…å¼€å¯OpenSessionInView

**æ³•åˆ™5ï¼šé¿å…åŒå‘å…³è”çš„é™·é˜±**

```
ä»€ä¹ˆæ˜¯åŒå‘å…³è”ï¼Ÿ
Aç±»é‡Œæœ‰Bï¼ŒBç±»é‡Œåˆæœ‰Aï¼Œäº’ç›¸å¼•ç”¨

é—®é¢˜ï¼š
â€¢ å®¹æ˜“æ­»å¾ªç¯ï¼ˆåºåˆ—åŒ–JSONæ—¶ï¼‰
â€¢ æ•°æ®åŠ è½½æ··ä¹±
â€¢ ä»£ç ç»´æŠ¤å›°éš¾

å»ºè®®ï¼š
èƒ½ç”¨å•å‘å°±åˆ«ç”¨åŒå‘ï¼
çœŸè¦ç”¨åŒå‘ï¼Œå¿…é¡»åŠ  @JsonIgnore é˜²æ­¢å¾ªç¯
```

### 1.3 å®ä½“è®¾è®¡å¸¸è§è¯¯åŒº



**âŒ è¯¯åŒº1ï¼šæ‰€æœ‰å­—æ®µéƒ½ç”¨åŸºæœ¬ç±»å‹**
```java
// ä¸æ¨è
private int age;       // åŸºæœ¬ç±»å‹ï¼Œæ•°æ®åº“NULLä¼šå‡ºé”™
private boolean active;

// æ¨è
private Integer age;   // åŒ…è£…ç±»å‹ï¼Œå¯ä»¥è¡¨ç¤ºNULL
private Boolean active;
```

**åŸå› **ï¼šæ•°æ®åº“å­—æ®µå¯èƒ½æ˜¯NULLï¼ŒåŸºæœ¬ç±»å‹æ— æ³•è¡¨ç¤ºNULLå€¼

**âŒ è¯¯åŒº2ï¼šå®ä½“ç±»ç»§æ‰¿è¿‡åº¦**
```
ä¸è¦ä¸ºäº†å¤ç”¨å‡ ä¸ªå­—æ®µå°±æç»§æ‰¿
JPAçš„ç»§æ‰¿æ˜ å°„ç­–ç•¥å¾ˆå¤æ‚ï¼Œå®¹æ˜“å‡ºé—®é¢˜

å»ºè®®ï¼š
â€¢ å…¬å…±å­—æ®µå°‘äº3ä¸ªï¼šç›´æ¥å¤åˆ¶ç²˜è´´
â€¢ å…¬å…±å­—æ®µå¾ˆå¤šï¼šè€ƒè™‘ç”¨@MappedSuperclass
â€¢ ä¸šåŠ¡é€»è¾‘å¤ç”¨ï¼šç”¨ç»„åˆè€Œéç»§æ‰¿
```

**âŒ è¯¯åŒº3ï¼šå¿½ç•¥ç´¢å¼•è®¾è®¡**
```java
// âœ… ç»å¸¸æŸ¥è¯¢çš„å­—æ®µè¦åŠ ç´¢å¼•
@Entity
@Table(indexes = {
    @Index(name = "idx_email", columnList = "email"),
    @Index(name = "idx_status", columnList = "status")
})
public class User {
    @Column(unique = true)  // å”¯ä¸€ç´¢å¼•
    private String email;
    
    private String status;   // æ™®é€šç´¢å¼•
}
```

---

## 2. ğŸ”— å…³ç³»æ˜ å°„é€‰æ‹©æŒ‡å—



### 2.1 å…³ç³»æ˜ å°„åŸºç¡€æ¦‚å¿µ



**é€šä¿—è§£é‡Š**ï¼šæ•°æ®åº“è¡¨ä¹‹é—´çš„å…³ç³»å°±åƒäººé™…å…³ç³»ï¼Œæœ‰"ä¸€å¯¹ä¸€"ï¼ˆå¤«å¦»ï¼‰ã€"ä¸€å¯¹å¤š"ï¼ˆçˆ¶æ¯ä¸å­å¥³ï¼‰ã€"å¤šå¯¹å¤š"ï¼ˆå­¦ç”Ÿä¸è¯¾ç¨‹ï¼‰ä¸‰ç§ã€‚

```
å…³ç³»æ˜ å°„ = å‘Šè¯‰JPAå¦‚ä½•å¤„ç†è¡¨ä¸è¡¨ä¹‹é—´çš„è¿æ¥

ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ
é€‰é”™å…³ç³»ç±»å‹ â†’ æ€§èƒ½å·®ã€æ•°æ®ä¹±ã€ä»£ç å¤æ‚
```

### 2.2 å…³ç³»ç±»å‹é€‰æ‹©å†³ç­–æ ‘



```
å¼€å§‹
  |
  â”œâ”€ æ˜¯å¦éœ€è¦å…³è”ï¼Ÿ
  |    |
  |    â”œâ”€ ä¸éœ€è¦ â†’ ä¸å»ºç«‹å…³ç³»ï¼Œä¿æŒç‹¬ç«‹ âœ…
  |    |
  |    â””â”€ éœ€è¦ â†’ ç»§ç»­åˆ¤æ–­
  |         |
  |         â”œâ”€ ä¸€æ¡è®°å½•å¯¹åº”ä¸€æ¡ï¼Ÿ
  |         |    â””â”€ æ˜¯ â†’ @OneToOne
  |         |
  |         â”œâ”€ ä¸€æ¡è®°å½•å¯¹åº”å¤šæ¡ï¼Ÿ
  |         |    â””â”€ æ˜¯ â†’ @OneToMany / @ManyToOne
  |         |
  |         â””â”€ å¤šæ¡è®°å½•å¯¹åº”å¤šæ¡ï¼Ÿ
  |              â””â”€ æ˜¯ â†’ @ManyToMany
```

### 2.3 å„å…³ç³»ç±»å‹ä½¿ç”¨å»ºè®®



**ğŸ”¸ @OneToOne ä¸€å¯¹ä¸€å…³ç³»**

> ğŸ“Œ **ä½¿ç”¨åœºæ™¯**  
> ç”¨æˆ·ä¸ç”¨æˆ·è¯¦æƒ…ã€è®¢å•ä¸å‘ç¥¨ã€å‘˜å·¥ä¸å·¥ä½

**æ€§èƒ½å»ºè®®**ï¼š
```
âœ… æ¨èåšæ³•ï¼š
â€¢ ä¸»è¡¨ç”¨ @OneToOne(fetch = LAZY)
â€¢ ä»è¡¨ç”¨ @MapsId å…±äº«ä¸»é”®

âŒ é¿å…åšæ³•ï¼š
â€¢ ä¸è¦ç”¨å¤–é”®å…³è”ï¼Œæ€§èƒ½å·®
â€¢ ä¸è¦åŒå‘å…³è”ï¼Œé™¤éå¿…è¦
```

```java
// âœ… é«˜æ€§èƒ½çš„ä¸€å¯¹ä¸€è®¾è®¡
@Entity
public class User {
    @Id
    private Long id;
    
    @OneToOne(fetch = FetchType.LAZY)
    @MapsId  // å…±äº«ä¸»é”®ï¼Œçœä¸€ä¸ªå­—æ®µ
    private UserProfile profile;
}

@Entity
public class UserProfile {
    @Id
    private Long id;  // å’ŒUserçš„idå€¼ç›¸åŒ
    
    private String bio;
    private String avatar;
}
```

**ğŸ”¸ @ManyToOne / @OneToMany ä¸€å¯¹å¤šå…³ç³»**

> ğŸ“Œ **é»„é‡‘æ³•åˆ™**  
> ä¼˜å…ˆä½¿ç”¨ @ManyToOneï¼ˆä»"å¤š"çš„ä¸€æ–¹å…³è”ï¼‰  
> é¿å…ç›´æ¥ç”¨ @OneToManyï¼Œé™¤éçœŸçš„éœ€è¦é›†åˆæ“ä½œ

| æ–¹å‘ | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|-----|---------|------------|
| @ManyToOne | âš¡âš¡âš¡ å¿« | æŸ¥è¯¢è®¢å•æ—¶é¡ºä¾¿æŸ¥å®¢æˆ· |
| @OneToMany | ğŸ¢ æ…¢ | æŸ¥å®¢æˆ·æ—¶è¦åŠ è½½æ‰€æœ‰è®¢å• |

```java
// âœ… æ¨èï¼šä»å¤šçš„ä¸€æ–¹å»ºç«‹å…³ç³»
@Entity
public class Order {
    @Id
    private Long id;
    
    @ManyToOne  // è®¢å•å±äºä¸€ä¸ªå®¢æˆ·
    private Customer customer;
}

// âŒ ä¸æ¨èï¼šä¸€å¯¹å¤šé›†åˆï¼Œå®¹æ˜“N+1é—®é¢˜
@Entity
public class Customer {
    @Id
    private Long id;
    
    @OneToMany(mappedBy = "customer")
    private List<Order> orders;  // æŸ¥å®¢æˆ·ä¼šåŠ è½½æ‰€æœ‰è®¢å•ï¼
}
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> çœŸéœ€è¦@OneToManyæ—¶ï¼Œè®°å¾—åŠ è¿™äº›ä¼˜åŒ–ï¼š
> - `@BatchSize(size = 10)` æ‰¹é‡åŠ è½½
> - `fetch = LAZY` æ‡’åŠ è½½
> - æˆ–è€…æ”¹ç”¨JPQLå•ç‹¬æŸ¥è¯¢

**ğŸ”¸ @ManyToMany å¤šå¯¹å¤šå…³ç³»**

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> å¤šå¯¹å¤šå…³ç³»æœ€å¤æ‚ï¼Œèƒ½é¿å…å°±é¿å…ï¼  
> å»ºè®®æ‹†æˆä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»

**å¯¹æ¯”æ–¹æ¡ˆ**ï¼š

```
æ–¹æ¡ˆAï¼šç›´æ¥ç”¨@ManyToMany
å­¦ç”Ÿ â†â†’ è¯¾ç¨‹
ä¼˜ç‚¹ï¼šä»£ç ç®€å•
ç¼ºç‚¹ï¼šæ— æ³•åŠ ä¸šåŠ¡å­—æ®µï¼ˆå¦‚é€‰è¯¾æ—¶é—´ã€æˆç»©ï¼‰

æ–¹æ¡ˆBï¼šæ‹†æˆä¸­é—´è¡¨å®ä½“ âœ…
å­¦ç”Ÿ â†’ é€‰è¯¾è®°å½• â† è¯¾ç¨‹
ä¼˜ç‚¹ï¼šçµæ´»ï¼Œå¯æ‰©å±•
ç¼ºç‚¹ï¼šå¤šå†™ä¸€ä¸ªå®ä½“ç±»
```

```java
// âŒ æ–¹æ¡ˆAï¼šç®€å•ä½†ä¸çµæ´»
@Entity
public class Student {
    @ManyToMany
    private Set<Course> courses;
}

// âœ… æ–¹æ¡ˆBï¼šçµæ´»ä¸”å¯æ‰©å±•ï¼ˆæ¨èï¼‰
@Entity
public class Student {
    @OneToMany(mappedBy = "student")
    private List<Enrollment> enrollments;
}

@Entity
public class Enrollment {  // ä¸­é—´è¡¨å®ä½“åŒ–
    @Id
    private Long id;
    
    @ManyToOne
    private Student student;
    
    @ManyToOne
    private Course course;
    
    // å¯ä»¥åŠ ä¸šåŠ¡å­—æ®µ
    private LocalDateTime enrollTime;
    private Integer score;
}
```

### 2.4 å…³ç³»æ˜ å°„æ€§èƒ½å¯¹æ¯”



| å…³ç³»ç±»å‹ | **æŸ¥è¯¢æ€§èƒ½** | **æ’å…¥æ€§èƒ½** | **ç»´æŠ¤éš¾åº¦** | **æ¨èåº¦** |
|---------|------------|------------|------------|----------|
| æ— å…³è” | âš¡âš¡âš¡ | âš¡âš¡âš¡ | â­ ç®€å• | â­â­â­â­â­ |
| @ManyToOne | âš¡âš¡ | âš¡âš¡ | â­â­ è¾ƒç®€å• | â­â­â­â­ |
| @OneToOne | âš¡âš¡ | âš¡âš¡ | â­â­ è¾ƒç®€å• | â­â­â­ |
| @OneToMany | ğŸ¢ | ğŸ¢ | â­â­â­ å¤æ‚ | â­â­ |
| @ManyToMany | ğŸŒ | ğŸŒ | â­â­â­â­ å¾ˆå¤æ‚ | â­ |

---

## 3. ğŸš€ æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æ¸…å•



### 3.1 N+1æŸ¥è¯¢é—®é¢˜



**ä»€ä¹ˆæ˜¯N+1é—®é¢˜ï¼Ÿ**
```
é€šä¿—è§£é‡Šï¼š
ä½ æŸ¥äº†10ä¸ªè®¢å•ï¼ˆ1æ¬¡æŸ¥è¯¢ï¼‰
ç„¶åä¸ºæ¯ä¸ªè®¢å•æŸ¥å®¢æˆ·ä¿¡æ¯ï¼ˆ10æ¬¡æŸ¥è¯¢ï¼‰
æ€»å…±11æ¬¡æŸ¥è¯¢ = 1 + 10ï¼ˆNï¼‰

è¿™å°±æ˜¯N+1é—®é¢˜ï¼
```

**é—®é¢˜æ¼”ç¤º**ï¼š
```java
// âŒ ä¼šäº§ç”ŸN+1é—®é¢˜çš„ä»£ç 
List<Order> orders = orderRepository.findAll();  // 1æ¬¡æŸ¥è¯¢
for (Order order : orders) {
    String name = order.getCustomer().getName();  // Næ¬¡æŸ¥è¯¢ï¼
}

// SQLæ—¥å¿—ä¼šçœ‹åˆ°ï¼š
SELECT * FROM orders;              -- 1æ¬¡
SELECT * FROM customer WHERE id=1; -- 
SELECT * FROM customer WHERE id=2; -- Næ¬¡
SELECT * FROM customer WHERE id=3; -- 
...
```

**âœ… è§£å†³æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | **SQLæ¬¡æ•°** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|-----|-----------|------------|----------|
| JOIN FETCH | 1æ¬¡ | æ•°æ®é‡å° | ç®€å•ï¼Œä½†å¯èƒ½ç¬›å¡å°”ç§¯ |
| @EntityGraph | 1æ¬¡ | çµæ´»æŒ‡å®šå­—æ®µ | æ¨èï¼ŒSpring Data JPAæ”¯æŒ |
| @BatchSize | 1+âŒˆN/æ‰¹æ¬¡âŒ‰ | æ•°æ®é‡å¤§ | æŠ˜ä¸­æ–¹æ¡ˆ |

```java
// æ–¹æ¡ˆ1ï¼šJOIN FETCHï¼ˆæ¨èï¼‰
@Query("SELECT o FROM Order o JOIN FETCH o.customer")
List<Order> findAllWithCustomer();

// æ–¹æ¡ˆ2ï¼š@EntityGraphï¼ˆæ›´çµæ´»ï¼‰
@EntityGraph(attributePaths = {"customer", "items"})
List<Order> findAll();

// æ–¹æ¡ˆ3ï¼šæ‰¹é‡åŠ è½½
@Entity
public class Order {
    @ManyToOne(fetch = LAZY)
    @BatchSize(size = 25)  // 25ä¸ªè®¢å•ä¸€èµ·æŸ¥å®¢æˆ·
    private Customer customer;
}
```

### 3.2 æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜æŠ€å·§



**ğŸŒ± å…¥é—¨çº§ï¼šåŸºç¡€ä¼˜åŒ–**

**æŠ€å·§1ï¼šåªæŸ¥éœ€è¦çš„å­—æ®µ**
```java
// âŒ æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œæµªè´¹
List<User> users = userRepository.findAll();

// âœ… åªæŸ¥éœ€è¦çš„å­—æ®µ
@Query("SELECT new com.example.dto.UserDTO(u.id, u.name) FROM User u")
List<UserDTO> findUserNames();
```

**æŠ€å·§2ï¼šç”¨åˆ†é¡µé¿å…å†…å­˜æº¢å‡º**
```java
// âŒ ä¸€æ¬¡æŸ¥10ä¸‡æ¡ï¼Œå†…å­˜çˆ†ç‚¸
List<Order> all = orderRepository.findAll();

// âœ… åˆ†é¡µæŸ¥è¯¢
Pageable pageable = PageRequest.of(0, 20);  // ç¬¬1é¡µï¼Œæ¯é¡µ20æ¡
Page<Order> page = orderRepository.findAll(pageable);
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šé«˜çº§ä¼˜åŒ–**

**æŠ€å·§3ï¼šåˆç†ä½¿ç”¨åŸç”ŸSQL**
```
ä»€ä¹ˆæ—¶å€™ç”¨åŸç”ŸSQLï¼Ÿ
â€¢ å¤æ‚ç»Ÿè®¡æŸ¥è¯¢
â€¢ æ‰¹é‡æ›´æ–°æ“ä½œ
â€¢ æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯

æ³¨æ„ï¼šèƒ½ç”¨JPQLå°±åˆ«ç”¨åŸç”ŸSQL
```

```java
// å¤æ‚ç»Ÿè®¡ç”¨åŸç”ŸSQLæ›´æ¸…æ™°
@Query(value = "SELECT DATE(o.create_time) as date, " +
               "COUNT(*) as count, SUM(o.amount) as total " +
               "FROM orders o " +
               "WHERE o.status = 'PAID' " +
               "GROUP BY DATE(o.create_time)", 
       nativeQuery = true)
List<Object[]> getDailySalesReport();
```

**æŠ€å·§4ï¼šæŸ¥è¯¢ç¼“å­˜çš„ä½¿ç”¨æ—¶æœº**

> ğŸ“Œ **ç¼“å­˜ä½¿ç”¨å»ºè®®**  
> ä¸æ˜¯æ‰€æœ‰æŸ¥è¯¢éƒ½é€‚åˆç¼“å­˜ï¼

```
âœ… é€‚åˆç¼“å­˜çš„æŸ¥è¯¢ï¼š
â€¢ é…ç½®æ•°æ®ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰
â€¢ å­—å…¸æ•°æ®ï¼ˆçœå¸‚åŒºï¼‰
â€¢ çƒ­ç‚¹æ•°æ®ï¼ˆé¦–é¡µå•†å“ï¼‰

âŒ ä¸é€‚åˆç¼“å­˜ï¼š
â€¢ å®æ—¶æ•°æ®ï¼ˆåº“å­˜ã€ä»·æ ¼ï¼‰
â€¢ ä¸ªæ€§åŒ–æ•°æ®ï¼ˆç”¨æˆ·è®¢å•ï¼‰
â€¢ ä½é¢‘æŸ¥è¯¢ï¼ˆä¸€å¤©è®¿é—®1æ¬¡ï¼‰
```

### 3.3 æŸ¥è¯¢æ€§èƒ½è‡ªæ£€æ¸…å•



```
âœ… æ€§èƒ½æ£€æŸ¥æ¸…å•ï¼š

â–¡ æ˜¯å¦å­˜åœ¨N+1æŸ¥è¯¢ï¼Ÿ
  â†’ æ£€æŸ¥æ—¥å¿—ï¼Œçœ‹SQLæ‰§è¡Œæ¬¡æ•°

â–¡ æ˜¯å¦æŸ¥è¯¢äº†ä¸éœ€è¦çš„å­—æ®µï¼Ÿ
  â†’ è€ƒè™‘ç”¨DTOæŠ•å½±

â–¡ æ˜¯å¦ä¸€æ¬¡åŠ è½½è¿‡å¤šæ•°æ®ï¼Ÿ
  â†’ ä½¿ç”¨åˆ†é¡µæˆ–é™åˆ¶æ•°é‡

â–¡ å…³è”æŸ¥è¯¢æ˜¯å¦åˆç†ï¼Ÿ
  â†’ JOIN FETCH vs å•ç‹¬æŸ¥è¯¢æƒè¡¡

â–¡ æ˜¯å¦æœ‰ç´¢å¼•æ”¯æŒï¼Ÿ
  â†’ å¸¸ç”¨æŸ¥è¯¢æ¡ä»¶è¦å»ºç´¢å¼•

â–¡ æ˜¯å¦å¯ä»¥ç”¨ç¼“å­˜ï¼Ÿ
  â†’ è¯„ä¼°æ•°æ®å˜åŒ–é¢‘ç‡
```

---

## 4. ğŸ’¼ äº‹åŠ¡ç®¡ç†ç­–ç•¥



### 4.1 äº‹åŠ¡åŸºç¡€æ¦‚å¿µ



**ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ**
```
é€šä¿—æ¯”å–»ï¼š
äº‹åŠ¡å°±åƒ"è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš"çš„ä¸€æ•´å¥—åŠ¨ä½œ

ä¾‹å­ï¼šé“¶è¡Œè½¬è´¦
1. Aè´¦æˆ·å‡1000å…ƒ
2. Bè´¦æˆ·åŠ 1000å…ƒ

è¦ä¹ˆä¸¤æ­¥éƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½ä¸åš
ä¸èƒ½åªåšä¸€åŠï¼
```

**äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ï¼ˆACIDï¼‰**ï¼š
```
A - Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
C - Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šæ•°æ®ä¿æŒæ­£ç¡®çŠ¶æ€
I - Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šå¤šä¸ªäº‹åŠ¡äº’ä¸å¹²æ‰°
D - Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šå®Œæˆçš„ä¿®æ”¹æ°¸ä¹…ä¿å­˜
```

### 4.2 Springäº‹åŠ¡ç®¡ç†å®æˆ˜



**ğŸŒ± å…¥é—¨çº§ï¼šåŸºç¡€ä½¿ç”¨**

**ä½¿ç”¨æ–¹å¼å¯¹æ¯”**ï¼š

| æ–¹å¼ | **å†™æ³•** | **é€‚ç”¨åœºæ™¯** | **æ¨èåº¦** |
|-----|---------|------------|----------|
| `@Transactional` | æ³¨è§£åœ¨æ–¹æ³•ä¸Š | ç®€å•ä¸šåŠ¡ | â­â­â­â­â­ |
| ç¼–ç¨‹å¼äº‹åŠ¡ | TransactionTemplate | å¤æ‚æ§åˆ¶ | â­â­ |
| XMLé…ç½® | AOPåˆ‡é¢ | è€é¡¹ç›®ç»´æŠ¤ | â­ |

```java
// âœ… æœ€å¸¸ç”¨ï¼šå£°æ˜å¼äº‹åŠ¡
@Service
public class OrderService {
    
    @Transactional  // è‡ªåŠ¨äº‹åŠ¡ç®¡ç†
    public void createOrder(Order order) {
        orderRepository.save(order);
        // æ‰£å‡åº“å­˜ã€å‘é€é€šçŸ¥ç­‰æ“ä½œ
        // ä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œå…¨éƒ¨å›æ»š
    }
}
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šäº‹åŠ¡ä¼ æ’­è¡Œä¸º**

**ä»€ä¹ˆæ˜¯äº‹åŠ¡ä¼ æ’­ï¼Ÿ**
```
åœºæ™¯ï¼šæ–¹æ³•Aè°ƒç”¨æ–¹æ³•Bï¼Œä¸¤ä¸ªéƒ½æœ‰@Transactional
é—®é¢˜ï¼šæ˜¯ç”¨ä¸€ä¸ªäº‹åŠ¡è¿˜æ˜¯ä¸¤ä¸ªäº‹åŠ¡ï¼Ÿ

è¿™å°±éœ€è¦"ä¼ æ’­è¡Œä¸º"æ¥å†³å®š
```

| ä¼ æ’­è¡Œä¸º | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** |
|---------|---------|------------|
| `REQUIRED` | æœ‰äº‹åŠ¡åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º | é»˜è®¤ï¼Œé€‚åˆ90%åœºæ™¯ |
| `REQUIRES_NEW` | æ€»æ˜¯æ–°å»ºäº‹åŠ¡ | æ—¥å¿—è®°å½•ï¼ˆå¿…é¡»ä¿å­˜ï¼‰ |
| `NESTED` | åµŒå¥—äº‹åŠ¡ï¼Œå¯ç‹¬ç«‹å›æ»š | éƒ¨åˆ†å¤±è´¥å¯æ¥å—çš„æ“ä½œ |
| `NOT_SUPPORTED` | æŒ‚èµ·äº‹åŠ¡ | é•¿æ—¶é—´æ“ä½œï¼Œé¿å…é”è¡¨ |

```java
// ç¤ºä¾‹ï¼šè®¢å•åˆ›å»º + æ—¥å¿—è®°å½•
@Service
public class OrderService {
    
    @Transactional  // é»˜è®¤REQUIRED
    public void createOrder(Order order) {
        orderRepository.save(order);
        
        // æ—¥å¿—å¿…é¡»ä¿å­˜ï¼Œç‹¬ç«‹äº‹åŠ¡
        logService.saveLog(order);  
    }
}

@Service
public class LogService {
    
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void saveLog(Order order) {
        // å³ä½¿è®¢å•åˆ›å»ºå¤±è´¥ï¼Œæ—¥å¿—ä¹Ÿè¦ä¿å­˜
        logRepository.save(new Log(order));
    }
}
```

### 4.3 äº‹åŠ¡å¸¸è§é—®é¢˜



**âŒ é™·é˜±1ï¼šäº‹åŠ¡ä¸ç”Ÿæ•ˆ**
```
åŸå› ï¼š
â€¢ @Transactionalæ”¾åœ¨privateæ–¹æ³• â†’ Springæ— æ³•ä»£ç†
â€¢ åŒç±»æ–¹æ³•è°ƒç”¨ â†’ ç»•è¿‡ä»£ç†

è§£å†³ï¼š
â€¢ æ–¹æ³•å¿…é¡»æ˜¯public
â€¢ è·¨ç±»è°ƒç”¨æˆ–ç”¨selfæ³¨å…¥
```

```java
// âŒ äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„ä¾‹å­
@Service
public class UserService {
    
    public void register(User user) {
        this.saveUser(user);  // åŒç±»è°ƒç”¨ï¼Œäº‹åŠ¡å¤±æ•ˆï¼
    }
    
    @Transactional
    private void saveUser(User user) {  // privateä¹Ÿä¸è¡Œ
        userRepository.save(user);
    }
}

// âœ… æ­£ç¡®åšæ³•
@Service
public class UserService {
    
    @Transactional
    public void register(User user) {
        userRepository.save(user);
    }
}
```

**âŒ é™·é˜±2ï¼šå¼‚å¸¸è¢«åäº†**
```java
// âŒ äº‹åŠ¡ä¸ä¼šå›æ»š
@Transactional
public void updateUser(User user) {
    try {
        userRepository.save(user);
    } catch (Exception e) {
        e.printStackTrace();  // å¼‚å¸¸è¢«åäº†ï¼
    }
}

// âœ… æ­£ç¡®å¤„ç†å¼‚å¸¸
@Transactional
public void updateUser(User user) {
    try {
        userRepository.save(user);
    } catch (Exception e) {
        // è®°å½•æ—¥å¿—
        log.error("ä¿å­˜å¤±è´¥", e);
        // é‡æ–°æŠ›å‡ºï¼Œè®©äº‹åŠ¡å›æ»š
        throw new RuntimeException("ä¿å­˜ç”¨æˆ·å¤±è´¥", e);
    }
}
```

> âš ï¸ **é‡è¦æç¤º**  
> @Transactionalé»˜è®¤åªå›æ»šRuntimeException  
> å¦‚æœæ˜¯å—æ£€å¼‚å¸¸ï¼Œè¦åŠ é…ç½®ï¼š`rollbackFor = Exception.class`

### 4.4 äº‹åŠ¡æ€§èƒ½ä¼˜åŒ–å»ºè®®



```
ğŸ”¸ ä¼˜åŒ–åŸåˆ™ï¼š

1. äº‹åŠ¡è¦çŸ­å°ç²¾æ‚
   âŒ é¿å…ï¼šäº‹åŠ¡é‡Œå‘HTTPè¯·æ±‚ã€è¯»æ–‡ä»¶
   âœ… å»ºè®®ï¼šåªåŒ…å«æ•°æ®åº“æ“ä½œ

2. åˆç†è®¾ç½®è¶…æ—¶
   @Transactional(timeout = 30)  // 30ç§’è¶…æ—¶

3. åªè¯»äº‹åŠ¡è¦æ ‡è®°
   @Transactional(readOnly = true)  // æå‡æ€§èƒ½

4. å‡å°‘äº‹åŠ¡èŒƒå›´
   âŒ æ•´ä¸ªControlleræ–¹æ³•åŠ äº‹åŠ¡
   âœ… åªåœ¨Serviceå…³é”®æ–¹æ³•åŠ äº‹åŠ¡
```

---

## 5. ğŸ’¾ ç¼“å­˜ä½¿ç”¨å»ºè®®



### 5.1 JPAç¼“å­˜æœºåˆ¶è¯¦è§£



**JPAçš„ä¸¤çº§ç¼“å­˜**ï¼š
```
ä¸€çº§ç¼“å­˜ï¼ˆSessionç¼“å­˜ï¼‰ï¼š
â€¢ ä½ç½®ï¼šåŒä¸€ä¸ªäº‹åŠ¡å†…
â€¢ èŒƒå›´ï¼šEntityManagerçº§åˆ«
â€¢ ç”Ÿå‘½å‘¨æœŸï¼šäº‹åŠ¡ç»“æŸå°±å¤±æ•ˆ
â€¢ è‡ªåŠ¨å¼€å¯ï¼Œæ— éœ€é…ç½®

äºŒçº§ç¼“å­˜ï¼ˆå…¨å±€ç¼“å­˜ï¼‰ï¼š
â€¢ ä½ç½®ï¼šåº”ç”¨çº§åˆ«
â€¢ èŒƒå›´ï¼šæ‰€æœ‰EntityManagerå…±äº«
â€¢ ç”Ÿå‘½å‘¨æœŸï¼šåº”ç”¨è¿è¡ŒæœŸé—´
â€¢ éœ€è¦æ‰‹åŠ¨é…ç½®
```

```
ä¸€çº§ç¼“å­˜å·¥ä½œç¤ºæ„ï¼š

äº‹åŠ¡å¼€å§‹
   |
   â”œâ”€ ç¬¬1æ¬¡æŸ¥è¯¢ id=1 â†’ è®¿é—®æ•°æ®åº“ â†’ å­˜å…¥ç¼“å­˜
   |                                    |
   â”œâ”€ ç¬¬2æ¬¡æŸ¥è¯¢ id=1 â†’ ç›´æ¥ä»ç¼“å­˜å– â†â”€â”€â”€â”€â”˜
   |
äº‹åŠ¡ç»“æŸï¼ˆç¼“å­˜æ¸…ç©ºï¼‰
```

### 5.2 ä¸€çº§ç¼“å­˜ä½¿ç”¨æŠ€å·§



**è‡ªåŠ¨ç”Ÿæ•ˆçš„åœºæ™¯**ï¼š
```java
@Transactional
public void updateUser(Long userId) {
    User user = userRepository.findById(userId).get();  // æŸ¥æ•°æ®åº“
    user.setName("æ–°åå­—");
    
    User same = userRepository.findById(userId).get();  // ä»ç¼“å­˜å–ï¼
    // same == userï¼Œæ˜¯åŒä¸€ä¸ªå¯¹è±¡
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
```
âœ… å¥½å¤„ï¼š
â€¢ åŒä¸€äº‹åŠ¡å†…å‡å°‘SQL
â€¢ ä¿è¯æ•°æ®ä¸€è‡´æ€§
â€¢ è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€é…ç½®

âš ï¸ é™åˆ¶ï¼š
â€¢ åªåœ¨åŒä¸€äº‹åŠ¡æœ‰æ•ˆ
â€¢ è·¨äº‹åŠ¡æ— æ•ˆ
â€¢ ä¸èƒ½è·¨åº”ç”¨èŠ‚ç‚¹
```

### 5.3 äºŒçº§ç¼“å­˜é…ç½®æŒ‡å—



**ğŸŒ± å…¥é—¨çº§ï¼šå¿«é€Ÿä¸Šæ‰‹**

**ç¬¬1æ­¥ï¼šæ·»åŠ ç¼“å­˜ä¾èµ–**
```xml
<!-- HibernateäºŒçº§ç¼“å­˜ -->
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-ehcache</artifactId>
</dependency>
```

**ç¬¬2æ­¥ï¼šå¼€å¯äºŒçº§ç¼“å­˜**
```yaml
# application.yml

spring:
  jpa:
    properties:
      hibernate:
        cache:
          use_second_level_cache: true      # å¼€å¯äºŒçº§ç¼“å­˜
          region.factory_class: ehcache     # ä½¿ç”¨EhCache
```

**ç¬¬3æ­¥ï¼šå®ä½“ç±»æ ‡è®°ç¼“å­˜**
```java
@Entity
@Cacheable  // æ ‡è®°å¯ç¼“å­˜
@org.hibernate.annotations.Cache(
    usage = CacheConcurrencyStrategy.READ_WRITE  // ç¼“å­˜ç­–ç•¥
)
public class Product {
    @Id
    private Long id;
    private String name;
}
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šç¼“å­˜ç­–ç•¥é€‰æ‹©**

| ç­–ç•¥ | **é€‚ç”¨åœºæ™¯** | **ç‰¹ç‚¹** |
|-----|------------|---------|
| `READ_ONLY` | é™æ€æ•°æ® | æœ€å¿«ï¼Œä½†ä¸èƒ½ä¿®æ”¹ |
| `READ_WRITE` | å¸¸è§„æ•°æ® | å¯è¯»å¯å†™ï¼Œæœ‰é”æœºåˆ¶ |
| `NONSTRICT_READ_WRITE` | å…è®¸çŸ­æš‚ä¸ä¸€è‡´ | æ€§èƒ½å¥½ï¼Œå¼±ä¸€è‡´æ€§ |
| `TRANSACTIONAL` | ä¸¥æ ¼ä¸€è‡´æ€§ | æœ€æ…¢ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ |

```java
// äº§å“ä¿¡æ¯ï¼šå¾ˆå°‘ä¿®æ”¹ï¼Œç”¨READ_WRITE
@Entity
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
public class Product { }

// é…ç½®æ•°æ®ï¼šåŸºæœ¬ä¸æ”¹ï¼Œç”¨READ_ONLY
@Entity
@Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
public class Config { }
```

### 5.4 ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ



**âœ… ä»€ä¹ˆæ•°æ®é€‚åˆç¼“å­˜ï¼Ÿ**
```
é€‚åˆç¼“å­˜ï¼š
â€¢ è¯»å¤šå†™å°‘ï¼ˆé…ç½®ã€å­—å…¸ã€å•†å“ï¼‰
â€¢ æ•°æ®ç¨³å®šï¼ˆçœå¸‚åŒºã€åˆ†ç±»ï¼‰
â€¢ çƒ­ç‚¹æ•°æ®ï¼ˆé¦–é¡µæ¨èï¼‰

ä¸é€‚åˆç¼“å­˜ï¼š
â€¢ å®æ—¶æ•°æ®ï¼ˆåº“å­˜ã€ä»·æ ¼ï¼‰
â€¢ ä¸ªæ€§åŒ–æ•°æ®ï¼ˆç”¨æˆ·è®¢å•ï¼‰
â€¢ å¤§æ•°æ®é‡ï¼ˆå¯èƒ½æ’‘çˆ†å†…å­˜ï¼‰
```

**âœ… ç¼“å­˜æ›´æ–°ç­–ç•¥**
```
ç­–ç•¥1ï¼šå®šæ—¶å¤±æ•ˆ
@Cache(... region="products", timeout=3600)  // 1å°æ—¶è¿‡æœŸ

ç­–ç•¥2ï¼šä¸»åŠ¨æ¸…é™¤
entityManager.getEntityManagerFactory()
    .getCache()
    .evict(Product.class, productId);  // åˆ é™¤æŒ‡å®šç¼“å­˜

ç­–ç•¥3ï¼šå…¨éƒ¨æ¸…ç©º
entityManager.getEntityManagerFactory()
    .getCache()
    .evictAll();  // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**  
> æ•°æ®ä¿®æ”¹æ—¶è®°å¾—æ¸…ç¼“å­˜ï¼Œå¦åˆ™ä¼šæŸ¥åˆ°æ—§æ•°æ®ï¼

---

## 6. ğŸ“Š ç›‘æ§æŒ‡æ ‡è®¾ç½®



### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§



**é€šä¿—ç†è§£**ï¼š
```
å¼€è½¦è¦çœ‹ä»ªè¡¨ç›˜ï¼šé€Ÿåº¦ã€æ²¹é‡ã€æ°´æ¸©
ç¨‹åºè¿è¡Œä¹Ÿè¦çœ‹æŒ‡æ ‡ï¼šSQLæ•°é‡ã€æ‰§è¡Œæ—¶é—´ã€ç¼“å­˜å‘½ä¸­ç‡

ä¸ç›‘æ§çš„åæœï¼š
â€¢ æ€§èƒ½é—®é¢˜ä¸çŸ¥é“
â€¢ æ•…éšœå‘ç°å¤ªæ™š
â€¢ ä¼˜åŒ–æ²¡æœ‰ä¾æ®
```

### 6.2 æ ¸å¿ƒç›‘æ§æŒ‡æ ‡



**ğŸ¯ å¿…é¡»ç›‘æ§çš„æŒ‡æ ‡**

| æŒ‡æ ‡ç±»åˆ« | **å…·ä½“æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **å¼‚å¸¸é¢„è­¦** |
|---------|------------|------------|------------|
| **SQLæ€§èƒ½** | æ…¢æŸ¥è¯¢æ•°é‡ | < 10æ¬¡/åˆ†é’Ÿ | > 50æ¬¡/åˆ†é’Ÿ |
| | å¹³å‡æ‰§è¡Œæ—¶é—´ | < 100ms | > 500ms |
| **ç¼“å­˜æ•ˆæœ** | å‘½ä¸­ç‡ | > 80% | < 50% |
| | ç¼“å­˜å¤§å° | < æ€»å†…å­˜30% | > 50% |
| **è¿æ¥æ± ** | æ´»è·ƒè¿æ¥æ•° | < æœ€å¤§å€¼70% | > 90% |
| | ç­‰å¾…æ—¶é—´ | < 10ms | > 100ms |
| **äº‹åŠ¡** | äº‹åŠ¡æ—¶é•¿ | < 3ç§’ | > 10ç§’ |
| | å›æ»šç‡ | < 1% | > 5% |

### 6.3 ç›‘æ§å·¥å…·é…ç½®



**ğŸŒ± å…¥é—¨çº§ï¼šSpring Boot Actuator**

```yaml
# application.yml

management:
  endpoints:
    web:
      exposure:
        include: metrics, health  # å¼€æ”¾ç›‘æ§ç«¯ç‚¹
  
  metrics:
    enable:
      jpa: true  # JPAæŒ‡æ ‡
      hikari: true  # è¿æ¥æ± æŒ‡æ ‡
```

**è®¿é—®ç›‘æ§æ•°æ®**ï¼š
```
http://localhost:8080/actuator/metrics
http://localhost:8080/actuator/metrics/jpa.queries
http://localhost:8080/actuator/metrics/hikaricp.connections
```

**ğŸŒ¿ è¿›é˜¶çº§ï¼šHibernateç»Ÿè®¡ä¿¡æ¯**

```java
@Configuration
public class JpaConfig {
    
    @Bean
    public HibernatePropertiesCustomizer hibernateCustomizer() {
        return hibernateProperties -> {
            // å¼€å¯ç»Ÿè®¡
            hibernateProperties.put("hibernate.generate_statistics", true);
            
            // è®°å½•æ…¢æŸ¥è¯¢
            hibernateProperties.put("hibernate.session.events.log", true);
        };
    }
}
```

**è·å–ç»Ÿè®¡ä¿¡æ¯**ï¼š
```java
@Service
public class MonitorService {
    
    @PersistenceUnit
    private EntityManagerFactory emf;
    
    public Map<String, Object> getJpaStats() {
        Statistics stats = emf.unwrap(SessionFactory.class)
                              .getStatistics();
        
        return Map.of(
            "æŸ¥è¯¢æ€»æ•°", stats.getQueryExecutionCount(),
            "æ…¢æŸ¥è¯¢æ•°", stats.getSlowQueries(),
            "äºŒçº§ç¼“å­˜å‘½ä¸­ç‡", stats.getSecondLevelCacheHitCount() * 100.0 
                           / stats.getSecondLevelCachePutCount()
        );
    }
}
```

### 6.4 SQLæ—¥å¿—åˆ†æ



**å¼€å¯SQLæ—¥å¿—**ï¼š
```yaml
spring:
  jpa:
    show-sql: true  # æ˜¾ç¤ºSQL
    properties:
      hibernate:
        format_sql: true  # æ ¼å¼åŒ–SQL
        use_sql_comments: true  # æ˜¾ç¤ºSQLæ¥æºæ³¨é‡Š
```

**æ—¥å¿—åˆ†æè¦ç‚¹**ï¼š
```
âœ… å…³æ³¨ç‚¹ï¼š

1. SQLæ‰§è¡Œæ¬¡æ•°
   ä¸€ä¸ªæ“ä½œæ‰§è¡Œ10+æ¡SQL â†’ å¯èƒ½N+1é—®é¢˜

2. SQLå¤æ‚åº¦
   JOINè¶…è¿‡3ä¸ªè¡¨ â†’ è€ƒè™‘æ‹†åˆ†æŸ¥è¯¢

3. å‚æ•°ç»‘å®š
   å‡ºç°?å ä½ç¬¦ â†’ æ­£å¸¸ï¼ˆé¢„ç¼–è¯‘ï¼‰
   å‡ºç°å…·ä½“å€¼ â†’ å¼‚å¸¸ï¼ˆSQLæ³¨å…¥é£é™©ï¼‰

4. é‡å¤SQL
   ç›¸åŒSQLåå¤æ‰§è¡Œ â†’ ç¼ºå°‘ç¼“å­˜
```

---

## 7. ğŸ—ï¸ ä»£ç ç»„ç»‡ç»“æ„



### 7.1 æ ‡å‡†åˆ†å±‚æ¶æ„



**ä»€ä¹ˆæ˜¯åˆ†å±‚ï¼Ÿ**
```
é€šä¿—æ¯”å–»ï¼š
é¤å…åˆ†å·¥ï¼šå‰å°æ¥å¾…ã€å¨å¸ˆåšèœã€é‡‡è´­å¤‡æ–™
ä»£ç ä¹Ÿè¦åˆ†å·¥ï¼šControlleræ¥è¯·æ±‚ã€Serviceå¤„ç†ä¸šåŠ¡ã€Repositoryè®¿é—®æ•°æ®

å¥½å¤„ï¼š
â€¢ èŒè´£æ¸…æ™°
â€¢ å®¹æ˜“ç»´æŠ¤
â€¢ æ–¹ä¾¿æµ‹è¯•
```

**æ ‡å‡†åˆ†å±‚ç»“æ„**ï¼š
```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ controller/     # æ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å“åº”
â”‚   â””â”€â”€ UserController.java
â”‚
â”œâ”€â”€ service/        # ä¸šåŠ¡é€»è¾‘å¤„ç†
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ impl/
â”‚       â””â”€â”€ UserServiceImpl.java
â”‚
â”œâ”€â”€ repository/     # æ•°æ®è®¿é—®
â”‚   â””â”€â”€ UserRepository.java
â”‚
â”œâ”€â”€ entity/         # å®ä½“ç±»ï¼ˆæ•°æ®åº“è¡¨ï¼‰
â”‚   â””â”€â”€ User.java
â”‚
â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ UserDTO.java
â”‚   â””â”€â”€ UserCreateRequest.java
â”‚
â””â”€â”€ config/         # é…ç½®ç±»
    â””â”€â”€ JpaConfig.java
```

### 7.2 å„å±‚èŒè´£è¯¦è§£



**ğŸ”¸ Controllerå±‚ï¼šæ¥å¾…å‘˜**
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // âœ… èŒè´£ï¼šæ¥æ”¶å‚æ•°ã€è°ƒç”¨æœåŠ¡ã€è¿”å›ç»“æœ
    @PostMapping
    public ResponseEntity<UserDTO> createUser(
            @RequestBody UserCreateRequest request) {
        
        // åªåšå‚æ•°æ ¡éªŒå’Œç±»å‹è½¬æ¢
        UserDTO user = userService.createUser(request);
        return ResponseEntity.ok(user);
    }
}
```

**âŒ Controllerä¸è¯¥åšä»€ä¹ˆï¼Ÿ**
```
Ã— ä¸è¦å†™ä¸šåŠ¡é€»è¾‘
Ã— ä¸è¦ç›´æ¥æ“ä½œæ•°æ®åº“
Ã— ä¸è¦å¤„ç†äº‹åŠ¡
Ã— ä¸è¦å†™å¤æ‚è®¡ç®—
```

**ğŸ”¸ Serviceå±‚ï¼šå¨å¸ˆ**
```java
@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Transactional  // âœ… äº‹åŠ¡åœ¨Serviceå±‚
    public UserDTO createUser(UserCreateRequest request) {
        // ä¸šåŠ¡é€»è¾‘ï¼šæ ¡éªŒã€è½¬æ¢ã€ä¿å­˜
        if (userRepository.existsByEmail(request.getEmail())) {
            throw new BusinessException("é‚®ç®±å·²å­˜åœ¨");
        }
        
        User user = new User();
        user.setEmail(request.getEmail());
        user.setPassword(encrypt(request.getPassword()));
        
        User saved = userRepository.save(user);
        return convertToDTO(saved);
    }
}
```

**âœ… Serviceè¦åšä»€ä¹ˆï¼Ÿ**
```
âˆš ç¼–å†™ä¸šåŠ¡é€»è¾‘
âˆš æ§åˆ¶äº‹åŠ¡
âˆš è°ƒç”¨Repository
âˆš æ•°æ®è½¬æ¢
```

**ğŸ”¸ Repositoryå±‚ï¼šä»“åº“ç®¡ç†å‘˜**
```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    
    // âœ… åªè´Ÿè´£æ•°æ®è®¿é—®ï¼Œä¸æ¶‰åŠä¸šåŠ¡
    boolean existsByEmail(String email);
    
    Optional<User> findByEmail(String email);
    
    @Query("SELECT u FROM User u WHERE u.status = :status")
    List<User> findByStatus(@Param("status") String status);
}
```

### 7.3 DTOä½¿ç”¨è§„èŒƒ



**ä¸ºä»€ä¹ˆéœ€è¦DTOï¼Ÿ**
```
é—®é¢˜ï¼šç›´æ¥ç”¨å®ä½“ç±»
â€¢ æš´éœ²æ•°æ®åº“ç»“æ„
â€¢ è¿”å›ä¸éœ€è¦çš„å­—æ®µï¼ˆå¯†ç ï¼‰
â€¢ å‰ç«¯éœ€è¦çš„å­—æ®µä¸ä¸€å®šæœ‰

è§£å†³ï¼šç”¨DTOä¼ è¾“æ•°æ®
â€¢ éš”ç¦»æ•°æ®åº“å˜åŒ–
â€¢ åªè¿”å›éœ€è¦çš„å­—æ®µ
â€¢ çµæ´»ç»„åˆæ•°æ®
```

**DTOè®¾è®¡ç¤ºä¾‹**ï¼š
```java
// âŒ ä¸è¦ç›´æ¥è¿”å›å®ä½“
@GetMapping("/{id}")
public User getUser(@PathVariable Long id) {
    return userRepository.findById(id).get();  // åŒ…å«password!
}

// âœ… ç”¨DTOè¿”å›
@GetMapping("/{id}")
public UserDTO getUser(@PathVariable Long id) {
    User user = userRepository.findById(id).get();
    return UserDTO.builder()
        .id(user.getId())
        .email(user.getEmail())
        .name(user.getName())
        // ä¸åŒ…å«å¯†ç 
        .build();
}
```

### 7.4 ä»£ç ç»„ç»‡æœ€ä½³å®è·µ



**âœ… æ¨èåšæ³•**ï¼š
```
1. æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†åŒ…
   user/
   â”œâ”€â”€ controller/
   â”œâ”€â”€ service/
   â”œâ”€â”€ repository/
   â””â”€â”€ dto/

2. æ¥å£å’Œå®ç°åˆ†ç¦»
   UserService.javaï¼ˆæ¥å£ï¼‰
   UserServiceImpl.javaï¼ˆå®ç°ï¼‰

3. é…ç½®ç±»ç»Ÿä¸€ç®¡ç†
   config/
   â”œâ”€â”€ JpaConfig.java
   â”œâ”€â”€ CacheConfig.java
   â””â”€â”€ SecurityConfig.java

4. å¸¸é‡ç»Ÿä¸€å®šä¹‰
   constant/
   â”œâ”€â”€ UserStatus.java
   â””â”€â”€ ErrorCode.java
```

---

## 8. ğŸš¦ ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•



### 8.1 ä¸Šçº¿å‰å¿…æŸ¥é¡¹



> âš ï¸ **é‡è¦æé†’**  
> ä»¥ä¸‹ä»»ä½•ä¸€é¡¹ä¸æ»¡è¶³ï¼Œéƒ½å¯èƒ½å¯¼è‡´ç”Ÿäº§äº‹æ•…ï¼

**ğŸ“‹ æ•°æ®åº“é…ç½®æ£€æŸ¥**

```yaml
âœ… æ£€æŸ¥æ¸…å•ï¼š

â–¡ è¿æ¥æ± é…ç½®åˆç†å—ï¼Ÿ
  spring:
    datasource:
      hikari:
        maximum-pool-size: 20      # æ ¹æ®å¹¶å‘è°ƒæ•´
        minimum-idle: 5
        connection-timeout: 30000  # 30ç§’è¶…æ—¶

â–¡ SQLæ—¥å¿—ç”Ÿäº§ç¯å¢ƒå…³é—­äº†å—ï¼Ÿ
  jpa:
    show-sql: false  # âš ï¸ å¿…é¡»å…³é—­ï¼Œå½±å“æ€§èƒ½

â–¡ æ•°æ®åº“ç´¢å¼•éƒ½å»ºäº†å—ï¼Ÿ
  æ£€æŸ¥å¸¸ç”¨æŸ¥è¯¢å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•

â–¡ DDLè‡ªåŠ¨æ›´æ–°å…³é—­äº†å—ï¼Ÿ
  jpa:
    hibernate:
      ddl-auto: none  # âš ï¸ ç”Ÿäº§ç¯å¢ƒç¦æ­¢è‡ªåŠ¨å»ºè¡¨
```

**ğŸ“‹ æ€§èƒ½é…ç½®æ£€æŸ¥**

```
âœ… æ£€æŸ¥æ¸…å•ï¼š

â–¡ æ‡’åŠ è½½é…ç½®æ­£ç¡®å—ï¼Ÿ
  @OneToMany(fetch = FetchType.LAZY)  # é»˜è®¤æ‡’åŠ è½½

â–¡ æ‰¹é‡æ“ä½œæœ‰ä¼˜åŒ–å—ï¼Ÿ
  hibernate:
    jdbc:
      batch_size: 50  # æ‰¹é‡æ’å…¥ä¼˜åŒ–

â–¡ äºŒçº§ç¼“å­˜å¼€å¯äº†å—ï¼Ÿï¼ˆå¦‚æœé€‚ç”¨ï¼‰
  cache:
    use_second_level_cache: true

â–¡ æŸ¥è¯¢è¶…æ—¶è®¾ç½®äº†å—ï¼Ÿ
  @Query(timeout = 30)  // 30ç§’è¶…æ—¶
```

### 8.2 å¸¸è§ç”Ÿäº§é—®é¢˜é¢„é˜²



**ğŸ”´ é—®é¢˜1ï¼šè¿æ¥æ± è€—å°½**

```
ç—‡çŠ¶ï¼šæŠ¥é”™ "æ— æ³•è·å–æ•°æ®åº“è¿æ¥"

åŸå› ï¼š
â€¢ è¿æ¥æ•°å¤ªå°
â€¢ æœ‰è¿æ¥æ³„æ¼ï¼ˆæ²¡å…³é—­ï¼‰
â€¢ æ…¢æŸ¥è¯¢å ç”¨è¿æ¥

é¢„é˜²æªæ–½ï¼š
```

```yaml
# 1. åŠ å¤§è¿æ¥æ± 

hikari:
  maximum-pool-size: 50  # æ ¹æ®å®é™…è°ƒæ•´

# 2. è®¾ç½®è¶…æ—¶

  connection-timeout: 20000
  
# 3. å¼€å¯è¿æ¥æ³„æ¼æ£€æµ‹

  leak-detection-threshold: 60000  # 60ç§’æœªå½’è¿˜æŠ¥è­¦
```

**ğŸ”´ é—®é¢˜2ï¼šå†…å­˜æº¢å‡º**

```
ç—‡çŠ¶ï¼šOutOfMemoryError

åŸå› ï¼š
â€¢ ä¸€æ¬¡æŸ¥è¯¢æ•°æ®å¤ªå¤š
â€¢ ç¼“å­˜æ•°æ®å¤ªå¤§
â€¢ å¾ªç¯å¼•ç”¨å¯¼è‡´æ— æ³•GC

é¢„é˜²æªæ–½ï¼š
```

```java
// 1. ç”¨åˆ†é¡µï¼Œä¸è¦ä¸€æ¬¡æŸ¥å…¨éƒ¨
Page<User> users = userRepository.findAll(
    PageRequest.of(0, 100)  // é™åˆ¶æ¯æ¬¡100æ¡
);

// 2. å¤§æ•°æ®ç”¨æµå¼å¤„ç†
@Query("SELECT u FROM User u")
Stream<User> streamAll();

try (Stream<User> stream = userRepository.streamAll()) {
    stream.forEach(user -> {
        // å¤„ç†æ¯æ¡æ•°æ®
    });
}

// 3. åŠæ—¶æ¸…ç†ç¼“å­˜
entityManager.clear();  // æ¸…ç©ºä¸€çº§ç¼“å­˜
```

**ğŸ”´ é—®é¢˜3ï¼šæ­»é”**

```
ç—‡çŠ¶ï¼šæ•°æ®åº“æ­»é”ï¼Œäº‹åŠ¡è¶…æ—¶

åŸå› ï¼š
â€¢ å¤šä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…
â€¢ æ›´æ–°é¡ºåºä¸ä¸€è‡´

é¢„é˜²æªæ–½ï¼š
```

```java
// 1. ç»Ÿä¸€æ›´æ–°é¡ºåº
@Transactional
public void transfer(Long from, Long to, BigDecimal amount) {
    // âœ… æ€»æ˜¯æŒ‰IDä»å°åˆ°å¤§é”å®š
    Long first = Math.min(from, to);
    Long second = Math.max(from, to);
    
    Account a1 = accountRepository.findById(first).get();
    Account a2 = accountRepository.findById(second).get();
    // ...
}

// 2. ç¼©çŸ­äº‹åŠ¡æ—¶é—´
@Transactional(timeout = 3)  // 3ç§’è¶…æ—¶è‡ªåŠ¨å›æ»š

// 3. ä½¿ç”¨æ‚²è§‚é”
@Lock(LockModeType.PESSIMISTIC_WRITE)
Account findById(Long id);
```

### 8.3 ç›‘æ§å‘Šè­¦é…ç½®



**å»ºè®®ç›‘æ§æŒ‡æ ‡**ï¼š
```yaml
ç›‘æ§é¡¹è®¾ç½®ï¼š

æ…¢æŸ¥è¯¢å‘Šè­¦ï¼š
  é˜ˆå€¼ï¼š> 500ms
  åŠ¨ä½œï¼šå‘é€é’‰é’‰/é‚®ä»¶é€šçŸ¥

è¿æ¥æ± ä½¿ç”¨ç‡ï¼š
  é˜ˆå€¼ï¼š> 80%
  åŠ¨ä½œï¼šè‡ªåŠ¨æ‰©å®¹æˆ–å‘Šè­¦

ç¼“å­˜å‘½ä¸­ç‡ï¼š
  é˜ˆå€¼ï¼š< 60%
  åŠ¨ä½œï¼šæ£€æŸ¥ç¼“å­˜é…ç½®

äº‹åŠ¡å›æ»šç‡ï¼š
  é˜ˆå€¼ï¼š> 5%
  åŠ¨ä½œï¼šæ’æŸ¥ä¸šåŠ¡å¼‚å¸¸
```

### 8.4 åº”æ€¥é¢„æ¡ˆ



**æ•…éšœåº”å¯¹æµç¨‹**ï¼š
```
1. å¿«é€Ÿæ­¢æŸ
   â”œâ”€ é™çº§ï¼šå…³é—­éæ ¸å¿ƒåŠŸèƒ½
   â”œâ”€ é™æµï¼šå‡å°‘å¹¶å‘è¯·æ±‚
   â””â”€ åˆ‡æ¢ï¼šå¤‡ç”¨æ•°æ®æº

2. é—®é¢˜å®šä½
   â”œâ”€ æŸ¥çœ‹æ—¥å¿—
   â”œâ”€ åˆ†æç›‘æ§
   â””â”€ æ£€æŸ¥SQL

3. ä¿®å¤ä¸Šçº¿
   â”œâ”€ ä»£ç ä¿®å¤
   â”œâ”€ ç°åº¦å‘å¸ƒ
   â””â”€ å…¨é‡å‘å¸ƒ

4. å¤ç›˜æ€»ç»“
   â”œâ”€ è®°å½•é—®é¢˜
   â”œâ”€ ä¼˜åŒ–æµç¨‹
   â””â”€ æ›´æ–°æ–‡æ¡£
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒåŸåˆ™



> ğŸ“Œ **é»„é‡‘æ³•åˆ™**  
> æ€§èƒ½ä¼˜åŒ–çš„æœ¬è´¨ï¼šå‡å°‘æ•°æ®åº“è®¿é—®ã€åˆç†ä½¿ç”¨ç¼“å­˜ã€æ§åˆ¶äº‹åŠ¡èŒƒå›´

**ğŸ”¸ å®ä½“è®¾è®¡ä¸‰è¦ç´ **
```
1. ä¿æŒç®€å•ï¼šåªè´Ÿè´£æ•°æ®å­˜å‚¨
2. ä¸»é”®æ…é‡ï¼šæ ¹æ®æ•°æ®åº“é€‰æ‹©ç­–ç•¥
3. å…³ç³»æ¸…æ™°ï¼šèƒ½ä¸å…³è”å°±ä¸å…³è”
```

**ğŸ”¸ å…³ç³»æ˜ å°„ä¼˜å…ˆçº§**
```
æ— å…³è” > @ManyToOne > @OneToOne > @OneToMany > @ManyToMany
              â†‘                                    â†‘
            æ¨èä½¿ç”¨                            èƒ½é¿å…å°±é¿å…
```

**ğŸ”¸ æŸ¥è¯¢ä¼˜åŒ–é“å¾‹**
```
1. é¿å…N+1ï¼šç”¨JOIN FETCHæˆ–@EntityGraph
2. åªæŸ¥éœ€è¦ï¼šç”¨DTOæŠ•å½±ï¼Œä¸è¦SELECT *
3. åˆç†åˆ†é¡µï¼šå¤§æ•°æ®å¿…é¡»åˆ†é¡µ
4. å–„ç”¨ç¼“å­˜ï¼šè¯»å¤šå†™å°‘æ‰ç¼“å­˜
```

**ğŸ”¸ äº‹åŠ¡ç®¡ç†åŸåˆ™**
```
1. äº‹åŠ¡è¦çŸ­ï¼šåªåŒ…å«æ•°æ®åº“æ“ä½œ
2. å¼‚å¸¸è¦æŠ›ï¼šè®©Springæ„ŸçŸ¥åˆ°æ‰å›æ»š
3. ä¼ æ’­è¦æ‡‚ï¼šç†è§£REQUIREDå’ŒREQUIRES_NEW
4. åªè¯»æ ‡è®°ï¼šæŸ¥è¯¢äº‹åŠ¡åŠ readOnly=true
```

### 9.2 æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥è¡¨



```
âœ… å¼€å‘é˜¶æ®µè‡ªæ£€ï¼š

â–¡ å®ä½“ç±»æ˜¯å¦è½»é‡çº§ï¼Ÿ
â–¡ æ‡’åŠ è½½é…ç½®åˆç†å—ï¼Ÿ
â–¡ æ˜¯å¦å­˜åœ¨N+1æŸ¥è¯¢ï¼Ÿ
â–¡ æŸ¥è¯¢å­—æ®µéƒ½æœ‰ç´¢å¼•å—ï¼Ÿ
â–¡ äº‹åŠ¡èŒƒå›´æœ€å°åŒ–äº†å—ï¼Ÿ
â–¡ ç¼“å­˜ç­–ç•¥åˆç†å—ï¼Ÿ
â–¡ æ‰¹é‡æ“ä½œæœ‰ä¼˜åŒ–å—ï¼Ÿ
â–¡ SQLæ—¥å¿—æ£€æŸ¥è¿‡äº†å—ï¼Ÿ
```

```
âœ… ä¸Šçº¿å‰æ£€æŸ¥ï¼š

â–¡ DDLè‡ªåŠ¨æ›´æ–°å…³é—­
â–¡ SQLæ—¥å¿—å·²å…³é—­
â–¡ è¿æ¥æ± é…ç½®åˆç†
â–¡ ç›‘æ§å‘Šè­¦å·²é…ç½®
â–¡ æ…¢æŸ¥è¯¢ä¼˜åŒ–å®Œæˆ
â–¡ å‹æµ‹ç»“æœè¾¾æ ‡
```

### 9.3 å­¦ä¹ è·¯çº¿å»ºè®®



**ğŸ“š è¿›é˜¶å­¦ä¹ è·¯å¾„**

```
ğŸŒ± åŸºç¡€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼š
â€¢ æŒæ¡å®ä½“æ˜ å°„å’ŒåŸºæœ¬CRUD
â€¢ ç†è§£äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ
â€¢ å­¦ä¼šä½¿ç”¨Repository

ğŸŒ¿ è¿›é˜¶é˜¶æ®µï¼ˆ2-4å‘¨ï¼‰ï¼š
â€¢ æ·±å…¥ç†è§£N+1é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
â€¢ æŒæ¡å¤æ‚æŸ¥è¯¢ç¼–å†™
â€¢ å­¦ä¹ ç¼“å­˜ä½¿ç”¨

ğŸŒ³ é«˜çº§é˜¶æ®µï¼ˆ1-2æœˆï¼‰ï¼š
â€¢ æ€§èƒ½è°ƒä¼˜å®æˆ˜
â€¢ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
â€¢ ç”Ÿäº§é—®é¢˜æ’æŸ¥
```

### 9.4 å®æˆ˜ç»éªŒæ€»ç»“



> ğŸ’¡ **è€å¸æœºçš„å»ºè®®**

```
1. ä¸è¦è¿‡åº¦è®¾è®¡
   â€¢ å°é¡¹ç›®ç›´æ¥ç”¨@ManyToOneå°±å¤Ÿäº†
   â€¢ ä¸è¦ä¸€ä¸Šæ¥å°±ä¸ŠäºŒçº§ç¼“å­˜
   â€¢ å…ˆè·‘é€šä¸šåŠ¡ï¼Œå†ä¼˜åŒ–æ€§èƒ½

2. æ—¥å¿—æ˜¯æœ€å¥½çš„è€å¸ˆ
   â€¢ å¼€å‘ç¯å¢ƒä¸€å®šå¼€show-sql
   â€¢ çœ‹æ—¥å¿—å­¦ä¹ JPAå¦‚ä½•ç”ŸæˆSQL
   â€¢ é€šè¿‡æ—¥å¿—å‘ç°æ€§èƒ½é—®é¢˜

3. æµ‹è¯•é©±åŠ¨ä¼˜åŒ–
   â€¢ å…ˆæœ‰æ€§èƒ½æŒ‡æ ‡ï¼Œå†ä¼˜åŒ–
   â€¢ å¯¹æ¯”ä¼˜åŒ–å‰åçš„æ•ˆæœ
   â€¢ ä¸è¦å‡­æ„Ÿè§‰ä¼˜åŒ–

4. æ–‡æ¡£å¾ˆé‡è¦
   â€¢ è®°å½•å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
   â€¢ æ€»ç»“æœ€ä½³å®è·µ
   â€¢ æ–°äººåŸ¹è®­èµ„æ–™
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å®ä½“è¦è½»é‡ï¼Œå…³ç³»è¦æ…é‡
æŸ¥è¯¢é˜²N+1ï¼Œç¼“å­˜è¦åˆç†
äº‹åŠ¡è¦ç®€çŸ­ï¼Œå¼‚å¸¸è¦å¤–æŠ›
ç´¢å¼•ä¸èƒ½å°‘ï¼Œç›‘æ§è¦åˆ°ä½
```

---

# ğŸ“– æ‰©å±•é˜…è¯»



**å®˜æ–¹æ–‡æ¡£**ï¼š
- [Spring Data JPA Reference](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [Hibernate User Guide](https://docs.jboss.org/hibernate/orm/current/userguide/html_single/Hibernate_User_Guide.html)

**æ¨èä¹¦ç±**ï¼š
- ã€ŠJava Persistence with Hibernateã€‹
- ã€ŠPro JPA 2 in Java EE 8ã€‹

**å®ç”¨å·¥å…·**ï¼š
- Spring Boot Actuator - æ€§èƒ½ç›‘æ§
- P6Spy - SQLç›‘æ§
- JPA Buddy - IDEAæ’ä»¶ï¼Œæå‡å¼€å‘æ•ˆç‡