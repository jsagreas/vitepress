---
title: 32、JPQL条件查询
---
## 📚 目录

1. [什么是条件查询](#1-什么是条件查询)
2. [基本比较运算符](#2-基本比较运算符)
3. [模糊查询LIKE](#3-模糊查询LIKE)
4. [范围查询BETWEEN](#4-范围查询BETWEEN)
5. [列表查询IN](#5-列表查询IN)
6. [空值查询IS NULL](#6-空值查询IS-NULL)
7. [逻辑运算符组合](#7-逻辑运算符组合)
8. [运算符优先级](#8-运算符优先级)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🎯 什么是条件查询


### 1.1 生活中的类比


想象你在图书馆找书，你不会把所有书都搬出来，而是会告诉管理员：

```
"我要找编程类的书"           → 这是分类条件
"价格在50元以下的"           → 这是范围条件  
"书名包含'Java'的"           → 这是模糊匹配
"作者是张三或李四的"         → 这是多选条件
```

**JPQL条件查询就是这个道理**：告诉数据库你要找什么样的数据，而不是把所有数据都取出来。

### 1.2 WHERE子句的作用


**核心概念**：WHERE子句就像一个"筛选器"，只让符合条件的数据通过。

```
基本语法结构：
SELECT 实体别名 
FROM 实体类名 实体别名 
WHERE 条件表达式
```

**通俗理解**：
- **SELECT**：我要什么东西
- **FROM**：从哪里找
- **WHERE**：必须满足什么条件

---

## 2. ⚖️ 基本比较运算符


### 2.1 六大基本运算符


| 运算符 | 含义 | 生活例子 | 使用场景 |
|--------|------|----------|----------|
| `=` | 等于 | `年龄 = 18` | 精确匹配 |
| `<>` | 不等于 | `状态 <> '删除'` | 排除某值 |
| `<` | 小于 | `价格 < 100` | 上限查询 |
| `>` | 大于 | `库存 > 0` | 下限查询 |
| `<=` | 小于等于 | `年龄 <= 60` | 包含上限 |
| `>=` | 大于等于 | `分数 >= 60` | 包含下限 |

### 2.2 实战示例


**场景1：查找特定价格的商品**
```java
// 查询价格正好是99.9元的商品
String jpql = "SELECT p FROM Product p WHERE p.price = 99.9";
List<Product> products = em.createQuery(jpql, Product.class)
                           .getResultList();
```

> **💡 新手提示**：`p.price`中的`p`是实体别名，`price`是实体类的属性名（不是数据库字段名）

**场景2：查找库存充足的商品**
```java
// 查询库存大于10的商品
String jpql = "SELECT p FROM Product p WHERE p.stock > 10";
```

**场景3：排除已删除的数据**
```java
// 查询状态不是"已删除"的用户
String jpql = "SELECT u FROM User u WHERE u.status <> '已删除'";
```

### 2.3 常见误区


```
❌ 错误写法：WHERE price = NULL
✅ 正确写法：WHERE price IS NULL

原因：NULL是特殊值，不能用=比较
```

---

## 3. 🔍 模糊查询LIKE


### 3.1 什么是模糊查询


**生活类比**：就像你在搜索引擎输入关键词，不需要完整输入，只要包含关键字就能找到。

**LIKE运算符**：用于搜索包含某些字符的数据，不需要完全匹配。

### 3.2 通配符详解


```
📌 两个核心通配符：

% → 代表任意多个字符（可以是0个）
_ → 代表恰好1个字符

记忆技巧：
% 像个胖子，能装很多字符
_ 像个瘦子，只能装1个字符
```

### 3.3 模糊匹配的四种模式


**模式1：前缀匹配（以...开头）**
```java
// 查询名字以"张"开头的用户
String jpql = "SELECT u FROM User u WHERE u.name LIKE '张%'";

// 能匹配：张三、张伟、张小明
// 不匹配：李四、王张三
```

**模式2：后缀匹配（以...结尾）**
```java
// 查询邮箱以@gmail.com结尾的用户
String jpql = "SELECT u FROM User u WHERE u.email LIKE '%@gmail.com'";

// 能匹配：abc@gmail.com、test@gmail.com
// 不匹配：abc@qq.com
```

**模式3：包含匹配（含有某些字符）**
```java
// 查询描述中包含"优惠"的商品
String jpql = "SELECT p FROM Product p WHERE p.description LIKE '%优惠%'";

// 能匹配：限时优惠、优惠活动、打折优惠中
```

**模式4：精确位置匹配**
```java
// 查询手机号第3-4位是"88"的用户
String jpql = "SELECT u FROM User u WHERE u.phone LIKE '__88%'";

// 能匹配：1388888888、1588666666
// 不匹配：1688888888（第3位不是8）
```

### 3.4 参数化查询（防SQL注入）


```java
// ✅ 安全的参数化写法
String keyword = "Java";
String jpql = "SELECT b FROM Book b WHERE b.title LIKE :keyword";
List<Book> books = em.createQuery(jpql, Book.class)
                     .setParameter("keyword", "%" + keyword + "%")
                     .getResultList();
```

> **⚠️ 重要提醒**：`%`通配符要在Java代码中拼接，不要写在JPQL字符串里

### 3.5 LIKE查询性能提示


```
性能从好到差：
✅ 前缀匹配：'Java%'     → 可以用索引
⚠️ 后缀匹配：'%Script'   → 索引效果差
❌ 包含匹配：'%Java%'     → 无法用索引（全表扫描）

建议：尽量使用前缀匹配
```

---

## 4. 📊 范围查询BETWEEN


### 4.1 BETWEEN的作用


**本质**：判断一个值是否在某个范围内（包含边界值）

**生活类比**：
```
商场活动："满100减20，满200减50"
数学表达：100 ≤ 金额 ≤ 200

BETWEEN就是这个"≥ 且 ≤"的组合
```

### 4.2 基本语法


```
标准格式：
WHERE 字段 BETWEEN 最小值 AND 最大值

等价写法：
WHERE 字段 >= 最小值 AND 字段 <= 最大值
```

### 4.3 数值范围查询


**场景：查询价格在100-500之间的商品**
```java
// 方式1：使用BETWEEN（推荐，更简洁）
String jpql = "SELECT p FROM Product p " +
              "WHERE p.price BETWEEN 100 AND 500";

// 方式2：使用比较运算符
String jpql = "SELECT p FROM Product p " +
              "WHERE p.price >= 100 AND p.price <= 500";
```

> **💡 关键理解**：BETWEEN包含边界值，即100和500都会被查询到

### 4.4 日期范围查询


**场景：查询本月注册的用户**
```java
LocalDate monthStart = LocalDate.of(2025, 9, 1);
LocalDate monthEnd = LocalDate.of(2025, 9, 30);

String jpql = "SELECT u FROM User u " +
              "WHERE u.registerDate BETWEEN :start AND :end";
              
List<User> users = em.createQuery(jpql, User.class)
                     .setParameter("start", monthStart)
                     .setParameter("end", monthEnd)
                     .getResultList();
```

### 4.5 NOT BETWEEN（反向范围）


**场景：查询价格不在100-500之间的商品**
```java
String jpql = "SELECT p FROM Product p " +
              "WHERE p.price NOT BETWEEN 100 AND 500";

// 等价于：
// WHERE p.price < 100 OR p.price > 500
```

### 4.6 使用技巧


```
📌 适用场景：
✅ 价格区间筛选
✅ 日期范围查询
✅ 年龄段统计
✅ 分数段查询

⚠️ 注意事项：
• 最小值必须在前，最大值在后
• 边界值会被包含在结果中
• 日期查询要注意时区问题
```

---

## 5. 📋 列表查询IN


### 5.1 IN运算符的作用


**生活类比**：
```
老师点名："张三、李四、王五来我办公室"
→ 只有名字在这个名单里的学生才去

IN运算符：判断值是否在指定列表中
```

### 5.2 基本语法


```
WHERE 字段 IN (值1, 值2, 值3, ...)

等价于：
WHERE 字段 = 值1 OR 字段 = 值2 OR 字段 = 值3
```

### 5.3 单值列表查询


**场景：查询特定城市的用户**
```java
String jpql = "SELECT u FROM User u " +
              "WHERE u.city IN ('北京', '上海', '深圳')";
List<User> users = em.createQuery(jpql, User.class)
                     .getResultList();
```

**场景：查询特定ID的商品**
```java
String jpql = "SELECT p FROM Product p " +
              "WHERE p.id IN (1, 5, 10, 20)";
```

### 5.4 参数化列表查询


**动态传入列表**
```java
List<String> cities = Arrays.asList("北京", "上海", "广州");

String jpql = "SELECT u FROM User u WHERE u.city IN :cities";
List<User> users = em.createQuery(jpql, User.class)
                     .setParameter("cities", cities)
                     .getResultList();
```

> **💡 重点理解**：`:cities`是集合参数，JPA会自动处理列表

### 5.5 子查询中的IN


**场景：查询购买过商品的用户**
```java
String jpql = "SELECT u FROM User u " +
              "WHERE u.id IN (" +
              "  SELECT DISTINCT o.user.id FROM Order o" +
              ")";
```

**解释**：
1. 内层查询找出所有下过单的用户ID
2. 外层查询找出ID在这个列表中的用户

### 5.6 NOT IN（排除列表）


**场景：查询不在黑名单中的用户**
```java
String jpql = "SELECT u FROM User u " +
              "WHERE u.id NOT IN (100, 200, 300)";
```

### 5.7 IN vs OR的选择


```
场景对比：

IN适用：
✅ 值的个数较多（3个以上）
✅ 值来自动态列表
✅ 需要与子查询配合

OR适用：
✅ 只有1-2个值
✅ 条件字段不同（如：WHERE age=18 OR status='VIP'）
```

---

## 6. ⭕ 空值查询IS NULL


### 6.1 NULL的特殊性


**NULL是什么**：表示"没有值"或"未知"，不是0，不是空字符串，是一种特殊状态。

**生活类比**：
```
问："你有多少钱？"
答1："我有0元"        → 这是0，不是NULL
答2："我不知道有多少"  → 这才是NULL
```

### 6.2 为什么不能用=判断NULL


```
数学逻辑：
NULL = NULL   → 结果是NULL（不是true）
NULL <> NULL  → 结果是NULL（不是false）

因为NULL表示"未知"，两个未知值无法比较
```

### 6.3 IS NULL语法


**查询空值**
```java
// 查询没有填写邮箱的用户
String jpql = "SELECT u FROM User u WHERE u.email IS NULL";
```

**查询非空值**
```java
// 查询已填写邮箱的用户
String jpql = "SELECT u FROM User u WHERE u.email IS NOT NULL";
```

### 6.4 实战场景


**场景1：查找待审核的订单（审核时间为空）**
```java
String jpql = "SELECT o FROM Order o " +
              "WHERE o.auditTime IS NULL";
```

**场景2：查找已激活的用户（激活时间不为空）**
```java
String jpql = "SELECT u FROM User u " +
              "WHERE u.activateTime IS NOT NULL";
```

**场景3：组合条件（邮箱或手机至少填一个）**
```java
String jpql = "SELECT u FROM User u " +
              "WHERE u.email IS NOT NULL OR u.phone IS NOT NULL";
```

### 6.5 NULL值的陷阱


```
⚠️ 常见错误：

错误1：用 = NULL
WHERE email = NULL       ❌ 永远查不到数据
WHERE email IS NULL      ✅ 正确写法

错误2：用 <> NULL
WHERE email <> NULL      ❌ 永远查不到数据  
WHERE email IS NOT NULL  ✅ 正确写法

错误3：忽略NULL的影响
WHERE age > 18           ❌ age为NULL的数据不会出现
WHERE age > 18 OR age IS NULL  ✅ 包含NULL的数据
```

---

## 7. 🔗 逻辑运算符组合


### 7.1 三大逻辑运算符


```
AND → 与（必须同时满足）
OR  → 或（满足任一即可）
NOT → 非（取反）
```

**生活类比**：
```
招聘要求：
"本科 AND 3年经验"       → 两个条件都要满足
"Java OR Python"        → 会一种就行
"NOT 应届生"            → 排除应届生
```

### 7.2 AND运算符（交集）


**场景：查询价格在100-500且库存大于0的商品**
```java
String jpql = "SELECT p FROM Product p " +
              "WHERE p.price BETWEEN 100 AND 500 " +
              "AND p.stock > 0";
```

**多条件AND**
```java
// 查询VIP用户，年龄18-60，已实名认证
String jpql = "SELECT u FROM User u " +
              "WHERE u.vipLevel > 0 " +
              "AND u.age BETWEEN 18 AND 60 " +
              "AND u.verified = true";
```

### 7.3 OR运算符（并集）


**场景：查询VIP用户或消费金额超1万的用户**
```java
String jpql = "SELECT u FROM User u " +
              "WHERE u.vipLevel > 0 OR u.totalAmount > 10000";
```

**多条件OR**
```java
// 查询北京、上海、深圳的用户
String jpql = "SELECT u FROM User u " +
              "WHERE u.city = '北京' " +
              "OR u.city = '上海' " +
              "OR u.city = '深圳'";
              
// 等价于IN写法（更简洁）
String jpql = "SELECT u FROM User u " +
              "WHERE u.city IN ('北京', '上海', '深圳')";
```

### 7.4 NOT运算符（取反）


**NOT单独使用**
```java
// 查询非VIP用户
String jpql = "SELECT u FROM User u WHERE NOT u.vipLevel > 0";
// 等价于
String jpql = "SELECT u FROM User u WHERE u.vipLevel = 0";
```

**NOT组合使用**
```java
// 查询不在北京且不是VIP的用户
String jpql = "SELECT u FROM User u " +
              "WHERE NOT (u.city = '北京' OR u.vipLevel > 0)";
```

### 7.5 复杂条件组合


**场景：优惠券发放规则**
```
规则：(VIP用户 OR 消费满1000) AND 最近30天活跃
```

```java
LocalDate thirtyDaysAgo = LocalDate.now().minusDays(30);

String jpql = "SELECT u FROM User u " +
              "WHERE (u.vipLevel > 0 OR u.totalAmount >= 1000) " +
              "AND u.lastLoginTime >= :date";
              
List<User> users = em.createQuery(jpql, User.class)
                     .setParameter("date", thirtyDaysAgo)
                     .getResultList();
```

> **💡 重点**：括号`()`用于明确优先级，先算括号内的条件

### 7.6 条件组合图解


```
AND的真值表：
条件A  条件B  →  结果
TRUE   TRUE   →  TRUE  ✅ 都满足才通过
TRUE   FALSE  →  FALSE
FALSE  TRUE   →  FALSE
FALSE  FALSE  →  FALSE

OR的真值表：
条件A  条件B  →  结果
TRUE   TRUE   →  TRUE  ✅ 有一个满足就通过
TRUE   FALSE  →  TRUE  ✅
FALSE  TRUE   →  TRUE  ✅
FALSE  FALSE  →  FALSE

NOT的真值表：
条件   →  结果
TRUE   →  FALSE  ✅ 取反
FALSE  →  TRUE   ✅
```

---

## 8. 🎯 运算符优先级


### 8.1 优先级顺序（从高到低）


```
优先级排序：
1. 括号 ()                → 最高优先级，先算
2. 比较运算符 =、>、< 等    
3. NOT                    → 逻辑非
4. AND                    → 逻辑与
5. OR                     → 逻辑或（最低）
```

### 8.2 优先级陷阱示例


**陷阱1：AND和OR混用**
```java
// ❌ 错误理解：查询北京的VIP用户或上海的用户
String jpql = "SELECT u FROM User u " +
              "WHERE u.city = '北京' AND u.vipLevel > 0 " +
              "OR u.city = '上海'";

实际执行逻辑：
(u.city = '北京' AND u.vipLevel > 0) OR u.city = '上海'
→ 结果：北京的VIP + 上海的所有用户（包括非VIP）

// ✅ 正确写法：用括号明确意图
String jpql = "SELECT u FROM User u " +
              "WHERE (u.city = '北京' OR u.city = '上海') " +
              "AND u.vipLevel > 0";
```

**陷阱2：NOT的作用范围**
```java
// ❌ 可能误解的写法
String jpql = "SELECT u FROM User u " +
              "WHERE NOT u.city = '北京' AND u.vipLevel > 0";

实际执行：
(NOT u.city = '北京') AND u.vipLevel > 0
→ 结果：非北京的VIP用户

// 如果要表达：不是(北京且VIP)的用户
String jpql = "SELECT u FROM User u " +
              "WHERE NOT (u.city = '北京' AND u.vipLevel > 0)";
```

### 8.3 复杂条件拆解


**原始需求**：
```
查询条件：
• 年龄18-60岁
• 且（北京用户 或 VIP用户）
• 且 不是黑名单用户
```

**分步构建**：
```java
// 步骤1：年龄条件
"u.age BETWEEN 18 AND 60"

// 步骤2：地域或等级条件（加括号）
"(u.city = '北京' OR u.vipLevel > 0)"

// 步骤3：排除条件
"u.blacklist = false"

// 最终组合（用AND连接）
String jpql = "SELECT u FROM User u " +
              "WHERE u.age BETWEEN 18 AND 60 " +
              "AND (u.city = '北京' OR u.vipLevel > 0) " +
              "AND u.blacklist = false";
```

### 8.4 括号使用建议


```
📌 何时必须加括号：
✅ OR 和 AND 混用时
✅ NOT 作用于多个条件时
✅ 复杂业务逻辑时

📌 建议加括号的情况：
✅ 即使不加也对，但加了更清晰
✅ 多人协作的代码
✅ 可能被修改的查询

记住：括号不影响性能，但能避免歧义！
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 比较运算符：=、<>、<、>、<=、>= 
   → 精确匹配和范围比较的基础

🔸 LIKE模糊查询：% 和 _ 通配符
   → 关键词搜索的核心工具

🔸 BETWEEN范围查询：包含边界值
   → 区间筛选的简洁写法

🔸 IN列表查询：判断是否在集合中
   → 多值匹配的高效方式

🔸 IS NULL：判断空值的唯一方式
   → 不能用 = NULL

🔸 逻辑运算符：AND、OR、NOT
   → 组合复杂条件的关键

🔸 运算符优先级：括号 > 比较 > NOT > AND > OR
   → 避免逻辑错误的保障
```

### 9.2 实战应用技巧


**参数化查询防注入**
```java
// ✅ 安全写法
String keyword = userInput;
String jpql = "... WHERE name LIKE :keyword";
query.setParameter("keyword", "%" + keyword + "%");

// ❌ 危险写法（SQL注入风险）
String jpql = "... WHERE name LIKE '%" + userInput + "%'";
```

**性能优化建议**
```
查询优化：
✅ 能用 = 不用 LIKE
✅ 能用 IN 不用多个 OR
✅ LIKE尽量用前缀匹配（'abc%'）
✅ 复杂条件考虑拆分查询
```

**常见错误规避**
```
❌ WHERE price = NULL      → ✅ WHERE price IS NULL
❌ WHERE name LIKE '%'     → ✅ 去掉此条件（匹配所有）
❌ BETWEEN 大值 AND 小值   → ✅ 小值在前，大值在后
❌ 忘记括号导致逻辑错误    → ✅ 复杂条件必加括号
```

### 9.3 学习路径建议


```
学习顺序：
1️⃣ 掌握基本比较运算符（=、>、<）
2️⃣ 理解NULL的特殊性（IS NULL）
3️⃣ 学会LIKE模糊查询
4️⃣ 掌握BETWEEN和IN
5️⃣ 熟练使用AND、OR组合条件
6️⃣ 理解运算符优先级

实战练习：
• 电商商品筛选（价格、分类、关键词）
• 用户管理查询（年龄、地域、等级）
• 订单统计查询（时间段、状态、金额）
```

### 9.4 知识关联图


```
JPQL条件查询体系：
                 WHERE子句
                     |
        ____________|____________
       |            |            |
    比较运算     模糊匹配      范围/列表
    (=、>、<)    (LIKE)      (BETWEEN、IN)
       |            |            |
    精确查询     关键词搜索    区间筛选
       |            |            |
       |___________ | ___________|
                    |
                逻辑组合
              (AND、OR、NOT)
                    |
               复杂业务条件
```

**核心记忆口诀**：
```
比较运算六兄弟，等于不等大小齐
模糊查询LIKE强，百分下划两法宝
范围BETWEEN要记牢，边界值也会包含
列表查询IN最妙，多值匹配一句搞
空值判断IS NULL，等号比较行不通
逻辑组合AND OR NOT，括号明确优先级
```