---
title: 75ã€DTOä¸å®ä½“è¾¹ç•Œ
---
## ğŸ“š ç›®å½•

1. [ä¸ºä»€ä¹ˆéœ€è¦DTO](#1-ä¸ºä»€ä¹ˆéœ€è¦DTO)
2. [å®ä½“ç›´æ¥æš´éœ²çš„é£é™©](#2-å®ä½“ç›´æ¥æš´éœ²çš„é£é™©)
3. [DTOè®¾è®¡åŸåˆ™](#3-DTOè®¾è®¡åŸåˆ™)
4. [æ˜ å°„å·¥å…·é€‰æ‹©](#4-æ˜ å°„å·¥å…·é€‰æ‹©)
5. [åˆ†å±‚æ¶æ„èŒè´£åˆ’åˆ†](#5-åˆ†å±‚æ¶æ„èŒè´£åˆ’åˆ†)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦DTO


### 1.1 ä»€ä¹ˆæ˜¯DTO


**DTOï¼ˆData Transfer Objectï¼‰**ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œä¸“é—¨ç”¨äºåœ¨ä¸åŒå±‚ä¹‹é—´ä¼ é€’æ•°æ®çš„ç®€å•å¯¹è±¡ã€‚

```
ç®€å•ç†è§£ï¼š
å®ä½“(Entity) = æ•°æ®åº“çš„é•œåƒï¼ŒåŒ…å«å®Œæ•´çš„ä¸šåŠ¡æ•°æ®
DTO = ä¸“é—¨ç”¨æ¥ä¼ è¾“çš„"ç®€åŒ–ç‰ˆ"ï¼ŒåªåŒ…å«éœ€è¦çš„å­—æ®µ

å°±åƒå¯„å¿«é€’ï¼š
å®ä½“ = ä½ å®¶é‡Œçš„æ‰€æœ‰ç‰©å“
DTO = æ‰“åŒ…å¥½çš„å¿«é€’ç›’ï¼ˆåªè£…éœ€è¦å¯„çš„ä¸œè¥¿ï¼‰
```

### 1.2 DTOè§£å†³çš„æ ¸å¿ƒé—®é¢˜


**é—®é¢˜åœºæ™¯**ï¼šç”¨æˆ·æŸ¥è¯¢ä¸ªäººä¿¡æ¯

```
âŒ ç›´æ¥è¿”å›å®ä½“çš„é—®é¢˜ï¼š

@GetMapping("/user/{id}")
public User getUser(@PathVariable Long id) {
    return userService.findById(id);
}

è¿”å›æ•°æ®ï¼š
{
  "id": 1,
  "username": "zhangsan",
  "password": "$2a$10$xxx...",        â† å¯†ç æ³„éœ²ï¼
  "email": "zhang@example.com",
  "phone": "13800138000",
  "createTime": "2024-01-01",
  "updateTime": "2024-09-01",
  "deleted": false,                   â† å†…éƒ¨å­—æ®µæ³„éœ²
  "version": 5                        â† æŠ€æœ¯å­—æ®µæ³„éœ²
}
```

```
âœ… ä½¿ç”¨DTOçš„æ­£ç¡®åšæ³•ï¼š

@GetMapping("/user/{id}")
public UserDTO getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    return convertToDTO(user);
}

è¿”å›æ•°æ®ï¼š
{
  "id": 1,
  "username": "zhangsan",
  "email": "zhang@example.com"
}

åªè¿”å›éœ€è¦çš„ä¿¡æ¯ï¼Œå®‰å…¨åˆç®€æ´ï¼
```

**ğŸ”‘ æ ¸å¿ƒä»·å€¼**ï¼š
- **å®‰å…¨æ€§**ï¼šé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼ˆå¯†ç ã€å†…éƒ¨å­—æ®µï¼‰
- **è§£è€¦æ€§**ï¼šæ¥å£ä¸ä¾èµ–æ•°æ®åº“ç»“æ„
- **çµæ´»æ€§**ï¼šä¸åŒåœºæ™¯å¯ä»¥å®šä¹‰ä¸åŒçš„DTO
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“

---

## 2. âš ï¸ å®ä½“ç›´æ¥æš´éœ²çš„é£é™©


### 2.1 å®‰å…¨é£é™©


**é£é™©1ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²**

```java
// ç”¨æˆ·å®ä½“
@Entity
public class User {
    private Long id;
    private String username;
    private String password;          // æ•æ„Ÿå­—æ®µ
    private String email;
    private String idCard;            // èº«ä»½è¯å·
    private BigDecimal balance;       // è´¦æˆ·ä½™é¢
}

// ç›´æ¥è¿”å›å®ä½“ âŒ
@GetMapping("/users")
public List<User> getUsers() {
    return userRepository.findAll();
}
```

**åæœ**ï¼š
- ğŸ”´ å¯†ç å“ˆå¸Œå€¼æš´éœ²ï¼ˆå¯èƒ½è¢«æš´åŠ›ç ´è§£ï¼‰
- ğŸ”´ èº«ä»½è¯å·æ³„éœ²ï¼ˆéšç§é—®é¢˜ï¼‰
- ğŸ”´ è´¦æˆ·ä½™é¢å…¬å¼€ï¼ˆå®‰å…¨éšæ‚£ï¼‰

**é£é™©2ï¼šæŠ€æœ¯ç»†èŠ‚æ³„éœ²**

```
æš´éœ²çš„å†…éƒ¨å­—æ®µï¼š
- deleted: false        â†’ è½¯åˆ é™¤å®ç°ç»†èŠ‚
- version: 5            â†’ ä¹è§‚é”ç‰ˆæœ¬å·
- createBy: "admin"     â†’ å®¡è®¡å­—æ®µ
- tenantId: 100         â†’ å¤šç§Ÿæˆ·æ ‡è¯†

æ”»å‡»è€…å¯èƒ½åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼š
â€¢ åˆ†æç³»ç»Ÿæ¶æ„
â€¢ å‘ç°å®‰å…¨æ¼æ´
â€¢ è¿›è¡Œé’ˆå¯¹æ€§æ”»å‡»
```

### 2.2 è€¦åˆé£é™©


**é—®é¢˜ï¼šæ¥å£ä¸æ•°æ®åº“å¼ºè€¦åˆ**

```
æ•°æ®åº“å­—æ®µæ”¹åçš„è¿é”ååº”ï¼š

ç¬¬1å¤©ï¼šæ•°æ®åº“è®¾è®¡
userè¡¨å­—æ®µï¼šphone_number

ç¬¬10å¤©ï¼šå¼€å‘æ¥å£
è¿”å›ï¼š{"phoneNumber": "138..."}

ç¬¬30å¤©ï¼šéœ€æ±‚å˜æ›´ï¼Œæ”¹ä¸ºmobile
æ•°æ®åº“æ”¹ä¸ºï¼šmobile

ç»“æœï¼š
âŒ æ‰€æœ‰è°ƒç”¨æ–¹ä»£ç éƒ½è¦æ”¹
âŒ å‰ç«¯å­—æ®µåè¦æ”¹
âŒ å¯èƒ½å¯¼è‡´çº¿ä¸Šäº‹æ•…
```

**ä½¿ç”¨DTOçš„å¥½å¤„**ï¼š

```java
// æ•°æ®åº“å­—æ®µå˜åŒ–
@Column(name = "mobile")  // ä»phone_numberæ”¹ä¸ºmobile
private String phoneNumber;

// DTOä¿æŒä¸å˜
public class UserDTO {
    private String phone;  // æ¥å£å­—æ®µåä¸å˜
}

// æ˜ å°„æ—¶é€‚é…
dto.setPhone(entity.getPhoneNumber());
```

> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šDTOåƒæ˜¯ä¸€ä¸ª"ç¿»è¯‘å±‚"ï¼Œè®©æ•°æ®åº“çš„å˜åŒ–ä¸ä¼šç›´æ¥å½±å“åˆ°å¤–éƒ¨æ¥å£

### 2.3 æ€§èƒ½é£é™©


**é—®é¢˜ï¼šå…³è”æ•°æ®çš„çº§è”åŠ è½½**

```
ç›´æ¥è¿”å›å®ä½“çš„è¿é”ååº”ï¼š

ç”¨æˆ·å®ä½“ï¼š
@Entity
public class User {
    @OneToMany
    private List<Order> orders;      // è®¢å•åˆ—è¡¨
    
    @ManyToOne
    private Department department;    // éƒ¨é—¨ä¿¡æ¯
}

è®¢å•å®ä½“ï¼š
@Entity
public class Order {
    @ManyToMany
    private List<Product> products;  // å•†å“åˆ—è¡¨
}

ä¸€æ¬¡æŸ¥è¯¢å¯èƒ½è§¦å‘ï¼š
1. æŸ¥è¯¢ç”¨æˆ·è¡¨
2. æŸ¥è¯¢100æ¡è®¢å•
3. æŸ¥è¯¢500ä¸ªå•†å“
4. æŸ¥è¯¢éƒ¨é—¨ä¿¡æ¯

â†’ N+1æŸ¥è¯¢é—®é¢˜çˆ†å‘ï¼
```

**ä½¿ç”¨DTOæ§åˆ¶æ•°æ®èŒƒå›´**ï¼š

```java
// åªè¿”å›å¿…è¦ä¿¡æ¯
public class UserSimpleDTO {
    private Long id;
    private String username;
    private String departmentName;  // åªè¦éƒ¨é—¨åç§°
    // ä¸åŒ…å«è®¢å•åˆ—è¡¨ï¼
}
```

---

## 3. ğŸ“ DTOè®¾è®¡åŸåˆ™


### 3.1 å•ä¸€èŒè´£åŸåˆ™


**ä¸åŒåœºæ™¯ä½¿ç”¨ä¸åŒçš„DTO**

```
ç”¨æˆ·ç›¸å…³çš„DTOå®¶æ—ï¼š

UserLoginDTO {          â† ç™»å½•æ—¶ä½¿ç”¨
    username
    password
}

UserRegisterDTO {       â† æ³¨å†Œæ—¶ä½¿ç”¨
    username
    password
    email
    phone
}

UserProfileDTO {        â† ä¸ªäººèµ„æ–™å±•ç¤º
    id
    username
    email
    avatar
    createTime
}

UserListDTO {           â† ç”¨æˆ·åˆ—è¡¨å±•ç¤ºï¼ˆæ›´ç²¾ç®€ï¼‰
    id
    username
    status
}
```

**ğŸ¯ è®¾è®¡æ€è·¯**ï¼š
```
é—®è‡ªå·±3ä¸ªé—®é¢˜ï¼š
1. è¿™ä¸ªåœºæ™¯éœ€è¦å“ªäº›å­—æ®µï¼Ÿ
2. å“ªäº›å­—æ®µæ˜¯æ•æ„Ÿçš„ä¸èƒ½è¿”å›ï¼Ÿ
3. æœ‰æ²¡æœ‰éœ€è¦è®¡ç®—æˆ–è½¬æ¢çš„å­—æ®µï¼Ÿ

æ ¹æ®ç­”æ¡ˆåˆ›å»ºä¸“é—¨çš„DTOï¼
```

### 3.2 é˜²æ³„éœ²åŸåˆ™


**å¿…é¡»æ’é™¤çš„å­—æ®µç±»å‹**

```
ğŸ”´ æ°¸è¿œä¸è¦è¿”å›ï¼š
â€¢ å¯†ç å­—æ®µï¼ˆå³ä½¿æ˜¯åŠ å¯†åçš„ï¼‰
â€¢ èº«ä»½è¯å·ã€é“¶è¡Œå¡å·ç­‰æ•æ„Ÿä¿¡æ¯
â€¢ å†…éƒ¨æŠ€æœ¯å­—æ®µï¼ˆdeleted, version, tenantIdï¼‰
â€¢ å®¡è®¡å­—æ®µï¼ˆcreateBy, updateByï¼‰

ğŸŸ¡ è°¨æ…è¿”å›ï¼š
â€¢ æ‰‹æœºå·ï¼ˆè€ƒè™‘è„±æ•ï¼š138****8000ï¼‰
â€¢ é‚®ç®±ï¼ˆè€ƒè™‘è„±æ•ï¼šz***@example.comï¼‰
â€¢ çœŸå®å§“åï¼ˆæŸäº›åœºæ™¯éœ€è¦è„±æ•ï¼‰

ğŸŸ¢ å¯ä»¥è¿”å›ï¼š
â€¢ ä¸šåŠ¡å¿…éœ€çš„å±•ç¤ºå­—æ®µ
â€¢ å…¬å¼€çš„ç”¨æˆ·ä¿¡æ¯
â€¢ å·²è„±æ•çš„æ•æ„Ÿæ•°æ®
```

### 3.3 å­—æ®µå‘½åè§„èŒƒ


**ä¿æŒæ¥å£ç¨³å®šæ€§**

```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šç›´æ¥æ˜ å°„æ•°æ®åº“å­—æ®µ
public class UserDTO {
    private String user_name;      // æ•°æ®åº“é£æ ¼
    private String phone_number;   // ä¸‹åˆ’çº¿å‘½å
}

// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨å‰ç«¯å‹å¥½çš„å‘½å
public class UserDTO {
    private String username;       // é©¼å³°å‘½å
    private String phone;          // ç®€åŒ–å­—æ®µå
    private String avatarUrl;      // è¯­ä¹‰åŒ–å‘½å
}
```

**å­—æ®µè½¬æ¢ç¤ºä¾‹**ï¼š

```
æ•°æ®åº“           â†’    DTO
phone_number     â†’    phone
avatar_url       â†’    avatarUrl
is_active        â†’    active (å»æ‰iså‰ç¼€)
create_time      â†’    createTime
```

---

## 4. ğŸ”§ æ˜ å°„å·¥å…·é€‰æ‹©


### 4.1 æ‰‹åŠ¨æ˜ å°„ vs è‡ªåŠ¨æ˜ å°„


**æ‰‹åŠ¨æ˜ å°„ï¼ˆé€‚åˆç®€å•åœºæ™¯ï¼‰**

```java
// ä¼˜ç‚¹ï¼šå®Œå…¨å¯æ§ï¼Œé€»è¾‘æ¸…æ™°
public UserDTO toDTO(User user) {
    UserDTO dto = new UserDTO();
    dto.setId(user.getId());
    dto.setUsername(user.getUsername());
    dto.setEmail(user.getEmail());
    // æ‰‹åŠ¨æ§åˆ¶æ¯ä¸ªå­—æ®µ
    return dto;
}

// ç¼ºç‚¹ï¼šå­—æ®µå¤šæ—¶ä»£ç å†—é•¿
```

**è‡ªåŠ¨æ˜ å°„ï¼ˆæ¨èMapStructï¼‰**

```java
// ä½¿ç”¨MapStructè‡ªåŠ¨æ˜ å°„
@Mapper(componentModel = "spring")
public interface UserMapper {
    
    // åŸºç¡€æ˜ å°„
    UserDTO toDTO(User user);
    
    // æ‰¹é‡æ˜ å°„
    List<UserDTO> toDTOList(List<User> users);
    
    // è‡ªå®šä¹‰æ˜ å°„è§„åˆ™
    @Mapping(source = "phoneNumber", target = "phone")
    @Mapping(source = "department.name", target = "departmentName")
    UserDetailDTO toDetailDTO(User user);
}
```

### 4.2 MapStructæ ¸å¿ƒç”¨æ³•


**åŸºç¡€é…ç½®**

```xml
<!-- Mavenä¾èµ– -->
<dependency>
    <groupId>org.mapstruct</groupId>
    <artifactId>mapstruct</artifactId>
    <version>1.5.5.Final</version>
</dependency>
```

**å¸¸ç”¨æ˜ å°„åœºæ™¯**

```java
@Mapper(componentModel = "spring")
public interface OrderMapper {
    
    // 1. å­—æ®µåä¸åŒæ—¶çš„æ˜ å°„
    @Mapping(source = "user.username", target = "userName")
    @Mapping(source = "totalAmount", target = "amount")
    OrderDTO toDTO(Order order);
    
    // 2. å¿½ç•¥æŸäº›å­—æ®µ
    @Mapping(target = "password", ignore = true)
    @Mapping(target = "deleted", ignore = true)
    UserDTO toSafeDTO(User user);
    
    // 3. æ—¥æœŸæ ¼å¼è½¬æ¢
    @Mapping(source = "createTime", target = "createTime", 
             dateFormat = "yyyy-MM-dd HH:mm:ss")
    OrderDTO toDTOWithTime(Order order);
    
    // 4. è‡ªå®šä¹‰è½¬æ¢é€»è¾‘
    @Mapping(source = "status", target = "statusText", 
             qualifiedByName = "statusToText")
    OrderDTO toDTOWithStatus(Order order);
    
    @Named("statusToText")
    default String statusToText(Integer status) {
        return status == 1 ? "è¿›è¡Œä¸­" : "å·²å®Œæˆ";
    }
}
```

**æ˜ å°„æµç¨‹å›¾**

```
å®ä½“(Entity)               æ˜ å°„å™¨(Mapper)              DTO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User        â”‚           â”‚              â”‚         â”‚ UserDTO  â”‚
â”‚ - id        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  MapStruct   â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ - id     â”‚
â”‚ - username  â”‚   è‡ªåŠ¨     â”‚  è‡ªåŠ¨ç”Ÿæˆ    â”‚  è¾“å‡º   â”‚ - name   â”‚
â”‚ - password  â”‚   è¯»å–     â”‚  æ˜ å°„ä»£ç     â”‚         â”‚ - email  â”‚
â”‚ - email     â”‚           â”‚              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - phone     â”‚           â”‚  è¿‡æ»¤æ•æ„Ÿå­—æ®µ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å·¥å…·å¯¹æ¯”


| æ˜ å°„æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **æ‰‹åŠ¨æ˜ å°„** | `å®Œå…¨å¯æ§`<br>`é€»è¾‘æ¸…æ™°`<br>`æ— ä¾èµ–` | `ä»£ç å†—é•¿`<br>`å®¹æ˜“å‡ºé”™`<br>`ç»´æŠ¤å›°éš¾` | å­—æ®µå°‘äº5ä¸ªçš„ç®€å•æ˜ å°„ |
| **MapStruct** | `ç¼–è¯‘æ—¶ç”Ÿæˆ`<br>`æ€§èƒ½æœ€ä½³`<br>`ç±»å‹å®‰å…¨` | `éœ€è¦å­¦ä¹ `<br>`ä¾èµ–æ³¨è§£å¤„ç†` | â­ **æ¨èé¦–é€‰** |
| **BeanUtils** | `ä½¿ç”¨ç®€å•`<br>`æ— éœ€é…ç½®` | `åå°„æ€§èƒ½å·®`<br>`ç±»å‹ä¸å®‰å…¨`<br>`æ˜“å‡ºé”™` | âŒ ä¸æ¨è |
| **ModelMapper** | `çµæ´»é…ç½®`<br>`è¿è¡Œæ—¶æ˜ å°„` | `æ€§èƒ½è¾ƒå·®`<br>`é…ç½®å¤æ‚` | å¤æ‚æ˜ å°„è§„åˆ™ |

> ğŸ’¡ **æ¨èç†ç”±**ï¼šMapStructåœ¨ç¼–è¯‘æœŸç”Ÿæˆä»£ç ï¼Œæ€§èƒ½æ¥è¿‘æ‰‹å†™ï¼ŒåŒæ—¶å¤§å¹…å‡å°‘ä»£ç é‡

---

## 5. ğŸ—ï¸ åˆ†å±‚æ¶æ„èŒè´£åˆ’åˆ†


### 5.1 æ ‡å‡†ä¸‰å±‚æ¶æ„


```
å‰ç«¯/å®¢æˆ·ç«¯
     â†• (DTO)
Controllerå±‚ â”€â”€â”€â”€â”€â”€> æ¥æ”¶è¯·æ±‚ï¼Œè¿”å›DTO
     â†• (DTO)
Serviceå±‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€> ä¸šåŠ¡é€»è¾‘ï¼ŒDTOä¸å®ä½“è½¬æ¢
     â†• (Entity)
Repositoryå±‚ â”€â”€â”€â”€â”€â”€> æ•°æ®è®¿é—®ï¼Œæ“ä½œå®ä½“
     â†•
æ•°æ®åº“
```

**å„å±‚èŒè´£**ï¼š

```
ğŸ”¹ Controllerå±‚ï¼ˆæ§åˆ¶å±‚ï¼‰
èŒè´£ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒ
è¾“å…¥ï¼šRequestDTOï¼ˆè¯·æ±‚DTOï¼‰
è¾“å‡ºï¼šResponseDTOï¼ˆå“åº”DTOï¼‰
ç¦æ­¢ï¼šç›´æ¥æ“ä½œå®ä½“ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

ğŸ”¹ Serviceå±‚ï¼ˆä¸šåŠ¡å±‚ï¼‰
èŒè´£ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ŒDTOä¸å®ä½“è½¬æ¢
è¾“å…¥ï¼šDTOæˆ–åŸºæœ¬ç±»å‹
è¾“å‡ºï¼šDTO
æ ¸å¿ƒï¼šåœ¨è¿™é‡Œå®ŒæˆEntity â†” DTOçš„è½¬æ¢

ğŸ”¹ Repositoryå±‚ï¼ˆæŒä¹…å±‚ï¼‰
èŒè´£ï¼šæ•°æ®è®¿é—®
è¾“å…¥ï¼šå®ä½“æˆ–æŸ¥è¯¢æ¡ä»¶
è¾“å‡ºï¼šå®ä½“
ç¦æ­¢ï¼šä¸è¦æš´éœ²å®ä½“ç»™Controller
```

### 5.2 å®æˆ˜ä»£ç ç¤ºä¾‹


**Controllerå±‚ï¼ˆæ¥å£å±‚ï¼‰**

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // åˆ›å»ºç”¨æˆ·
    @PostMapping
    public ResponseDTO<UserDTO> createUser(
            @RequestBody @Valid UserCreateDTO createDTO) {
        
        // åªå¤„ç†HTTPç›¸å…³çš„äº‹æƒ…
        UserDTO userDTO = userService.createUser(createDTO);
        
        return ResponseDTO.success(userDTO);
    }
    
    // æŸ¥è¯¢ç”¨æˆ·
    @GetMapping("/{id}")
    public ResponseDTO<UserDTO> getUser(@PathVariable Long id) {
        UserDTO userDTO = userService.getUserById(id);
        return ResponseDTO.success(userDTO);
    }
}
```

**Serviceå±‚ï¼ˆä¸šåŠ¡å±‚ï¼‰**

```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Autowired
    private UserMapper userMapper;  // MapStructæ˜ å°„å™¨
    
    public UserDTO createUser(UserCreateDTO createDTO) {
        // 1. DTOè½¬å®ä½“
        User user = new User();
        user.setUsername(createDTO.getUsername());
        user.setPassword(passwordEncoder.encode(
            createDTO.getPassword()));  // å¯†ç åŠ å¯†
        user.setEmail(createDTO.getEmail());
        
        // 2. ä¸šåŠ¡é€»è¾‘ï¼ˆæ ¡éªŒã€å¤„ç†ï¼‰
        if (userRepository.existsByUsername(user.getUsername())) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        // 3. ä¿å­˜å®ä½“
        User savedUser = userRepository.save(user);
        
        // 4. å®ä½“è½¬DTOè¿”å›
        return userMapper.toDTO(savedUser);
    }
    
    public UserDTO getUserById(Long id) {
        User user = userRepository.findById(id)
            .orElseThrow(() -> new NotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));
        
        // å®ä½“è½¬DTO
        return userMapper.toDTO(user);
    }
}
```

**Repositoryå±‚ï¼ˆæ•°æ®å±‚ï¼‰**

```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    
    // åªå¤„ç†æ•°æ®è®¿é—®
    boolean existsByUsername(String username);
    
    Optional<User> findByUsername(String username);
    
    // è¿”å›çš„éƒ½æ˜¯å®ä½“ï¼Œä¸è¦è¿”å›DTOï¼
}
```

### 5.3 è½¬æ¢æ—¶æœºçš„é€‰æ‹©


**åŸåˆ™ï¼šå°½æ—©è½¬æ¢ä¸ºDTO**

```
æ­£ç¡®æµç¨‹ï¼š
Repository(Entity) â†’ Service(ç«‹å³è½¬DTO) â†’ Controller(DTO)
                      â†‘
                   è½¬æ¢ç‚¹

é”™è¯¯æµç¨‹ï¼š
Repository(Entity) â†’ Service(Entity) â†’ Controller(è½¬DTO)
                                        â†‘
                                     è½¬æ¢å¤ªæ™š
```

**ä¸ºä»€ä¹ˆè¦åœ¨Serviceå±‚è½¬æ¢ï¼Ÿ**

```
âœ… Serviceå±‚è½¬æ¢çš„å¥½å¤„ï¼š
1. Controllerä¸éœ€è¦çŸ¥é“å®ä½“ç»“æ„
2. ä¸šåŠ¡é€»è¾‘å¤„ç†æ—¶å¯ä»¥ä½¿ç”¨å®ä½“çš„å®Œæ•´åŠŸèƒ½
3. ç»Ÿä¸€çš„è½¬æ¢é€»è¾‘ï¼Œæ–¹ä¾¿ç»´æŠ¤
4. æ–¹ä¾¿åšæ•°æ®è„±æ•å’Œå­—æ®µè¿‡æ»¤

âŒ Controllerå±‚è½¬æ¢çš„é—®é¢˜ï¼š
1. Controllerå±‚è¦ä¾èµ–å®ä½“ç±»
2. å¯èƒ½æš´éœ²å®ä½“ç»†èŠ‚
3. è½¬æ¢é€»è¾‘åˆ†æ•£ï¼Œä¸å¥½ç»´æŠ¤
```

### 5.4 å¤æ‚åœºæ™¯çš„å¤„ç†


**åœºæ™¯1ï¼šå…³è”æ•°æ®çš„å¤„ç†**

```java
// ç”¨æˆ·è¯¦æƒ…ï¼ˆåŒ…å«éƒ¨é—¨ä¿¡æ¯ï¼‰
@Service
public class UserService {
    
    public UserDetailDTO getUserDetail(Long id) {
        // 1. æŸ¥è¯¢ç”¨æˆ·ï¼ˆå¸¦éƒ¨é—¨å…³è”ï¼‰
        User user = userRepository.findById(id)
            .orElseThrow(() -> new NotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));
        
        // 2. è½¬æ¢ä¸ºDTO
        UserDetailDTO dto = new UserDetailDTO();
        dto.setId(user.getId());
        dto.setUsername(user.getUsername());
        
        // 3. å¤„ç†å…³è”æ•°æ®
        if (user.getDepartment() != null) {
            dto.setDepartmentName(user.getDepartment().getName());
        }
        
        return dto;
    }
}
```

**åœºæ™¯2ï¼šæ‰¹é‡æ•°æ®å¤„ç†**

```java
// ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
@Service
public class UserService {
    
    public PageDTO<UserListDTO> getUserList(Pageable pageable) {
        // 1. åˆ†é¡µæŸ¥è¯¢å®ä½“
        Page<User> userPage = userRepository.findAll(pageable);
        
        // 2. æ‰¹é‡è½¬æ¢ä¸ºDTO
        List<UserListDTO> dtoList = userPage.getContent()
            .stream()
            .map(userMapper::toListDTO)
            .collect(Collectors.toList());
        
        // 3. å°è£…åˆ†é¡µç»“æœ
        return new PageDTO<>(
            dtoList,
            userPage.getTotalElements(),
            userPage.getTotalPages()
        );
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ DTOçš„æœ¬è´¨ï¼šä¸“é—¨ç”¨äºæ•°æ®ä¼ è¾“çš„ç®€åŒ–å¯¹è±¡
ğŸ”¸ æ ¸å¿ƒä½œç”¨ï¼šé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œè§£è€¦æ¥å£ä¸æ•°æ®åº“
ğŸ”¸ è®¾è®¡åŸåˆ™ï¼šå•ä¸€èŒè´£ï¼Œä¸åŒåœºæ™¯ç”¨ä¸åŒDTO
ğŸ”¸ æ˜ å°„å·¥å…·ï¼šæ¨èMapStructï¼Œæ€§èƒ½å¥½ç»´æŠ¤æ˜“
ğŸ”¸ è½¬æ¢æ—¶æœºï¼šServiceå±‚è½¬æ¢ï¼Œä¸è¦åœ¨Controller
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨DTO**

```
å®‰å…¨è§’åº¦ï¼š
â€¢ å®ä½“åŒ…å«æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯
â€¢ ç›´æ¥è¿”å›å®ä½“=æŠŠå®¶é‡Œé’¥åŒ™ç»™é™Œç”Ÿäºº
â€¢ DTOåƒæ˜¯"è®¿å®¢è¯"ï¼Œåªç»™å¿…è¦çš„æƒé™

æ¶æ„è§’åº¦ï¼š
â€¢ æ•°æ®åº“æ”¹å˜ä¸å½±å“æ¥å£
â€¢ å‰åç«¯åˆ†ç¦»æ›´å½»åº•
â€¢ ä¾¿äºç‰ˆæœ¬ç®¡ç†å’Œæ¼”è¿›
```

**ğŸ”¹ DTOè®¾è®¡çš„æ ¸å¿ƒæ€è·¯**

```
é—®è‡ªå·±3ä¸ªé—®é¢˜ï¼š
1. è¿™ä¸ªåœºæ™¯éœ€è¦ä»€ä¹ˆæ•°æ®ï¼Ÿ
   â†’ åªåŒ…å«å¿…è¦å­—æ®µ

2. æœ‰ä»€ä¹ˆä¸èƒ½æš´éœ²ï¼Ÿ
   â†’ æ’é™¤æ•æ„Ÿå’ŒæŠ€æœ¯å­—æ®µ

3. éœ€è¦ä»€ä¹ˆæ ¼å¼ï¼Ÿ
   â†’ è®¾è®¡å‰ç«¯å‹å¥½çš„ç»“æ„
```

**ğŸ”¹ æ˜ å°„å·¥å…·çš„é€‰æ‹©æ ‡å‡†**

```
å­—æ®µå°‘ï¼ˆ<5ä¸ªï¼‰ï¼š
â†’ æ‰‹åŠ¨æ˜ å°„ï¼Œä»£ç æ¸…æ™°

å­—æ®µå¤šä¸”è§„åˆ™å¤æ‚ï¼š
â†’ MapStructï¼Œè‡ªåŠ¨ç”Ÿæˆ

éœ€è¦è¿è¡Œæ—¶åŠ¨æ€æ˜ å°„ï¼š
â†’ ModelMapperï¼ˆä¸æ¨èï¼‰
```

### 6.3 å®è·µæ£€æŸ¥æ¸…å•


**âœ… DTOè®¾è®¡æ£€æŸ¥ç‚¹**

- [ ] æ˜¯å¦æ’é™¤äº†æ‰€æœ‰æ•æ„Ÿå­—æ®µï¼ˆpasswordã€idCardç­‰ï¼‰
- [ ] æ˜¯å¦æ’é™¤äº†æŠ€æœ¯å­—æ®µï¼ˆdeletedã€versionç­‰ï¼‰
- [ ] å­—æ®µå‘½åæ˜¯å¦å‰ç«¯å‹å¥½ï¼ˆé©¼å³°å‘½åï¼‰
- [ ] ä¸åŒåœºæ™¯æ˜¯å¦ä½¿ç”¨äº†ä¸åŒçš„DTO
- [ ] æ˜¯å¦æ·»åŠ äº†å¿…è¦çš„å­—æ®µæ ¡éªŒæ³¨è§£

**âœ… åˆ†å±‚æ¶æ„æ£€æŸ¥ç‚¹**

- [ ] Controlleræ˜¯å¦åªå¤„ç†HTTPç›¸å…³é€»è¾‘
- [ ] Serviceæ˜¯å¦å®Œæˆäº†DTOä¸å®ä½“çš„è½¬æ¢
- [ ] Repositoryæ˜¯å¦åªè¿”å›å®ä½“
- [ ] æ˜¯å¦åœ¨Serviceå±‚å°±å®Œæˆäº†æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

**âœ… æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥ç‚¹**

- [ ] æ˜¯å¦é¿å…äº†è¿”å›ä¸å¿…è¦çš„å…³è”æ•°æ®
- [ ] æ‰¹é‡æŸ¥è¯¢æ˜¯å¦ä½¿ç”¨äº†æ‰¹é‡æ˜ å°„
- [ ] æ˜¯å¦ä½¿ç”¨äº†ç¼–è¯‘æœŸæ˜ å°„å·¥å…·ï¼ˆMapStructï¼‰

### 6.4 å¸¸è§é”™è¯¯é˜²èŒƒ


```
âŒ é”™è¯¯1ï¼šç›´æ¥è¿”å›å®ä½“
@GetMapping("/user")
public User getUser() {
    return userRepository.findById(1L).get();
}

âœ… æ­£ç¡®åšæ³•ï¼š
@GetMapping("/user")
public UserDTO getUser() {
    User user = userRepository.findById(1L).get();
    return userMapper.toDTO(user);
}

âŒ é”™è¯¯2ï¼šåœ¨Controllerè½¬æ¢
@GetMapping("/user")
public UserDTO getUser() {
    User user = userService.getUser(1L);  // è¿”å›å®ä½“
    return convertToDTO(user);  // Controllerè½¬æ¢
}

âœ… æ­£ç¡®åšæ³•ï¼š
@GetMapping("/user")
public UserDTO getUser() {
    return userService.getUser(1L);  // Serviceè¿”å›DTO
}

âŒ é”™è¯¯3ï¼šä¸€ä¸ªDTOæ‰“å¤©ä¸‹
public class UserDTO {
    // ç™»å½•ã€æ³¨å†Œã€è¯¦æƒ…ã€åˆ—è¡¨éƒ½ç”¨è¿™ä¸€ä¸ª
}

âœ… æ­£ç¡®åšæ³•ï¼š
UserLoginDTO    // ç™»å½•ä¸“ç”¨
UserRegisterDTO // æ³¨å†Œä¸“ç”¨
UserDetailDTO   // è¯¦æƒ…ä¸“ç”¨
UserListDTO     // åˆ—è¡¨ä¸“ç”¨
```

### 6.5 æ ¸å¿ƒè®°å¿†å£è¯€


```
ğŸ¯ DTOè®¾è®¡ä¸‰ä¸è¦ï¼š
ä¸è¦æš´éœ²æ•æ„Ÿå­—æ®µ
ä¸è¦ä¾èµ–æ•°æ®åº“ç»“æ„
ä¸è¦ä¸€ä¸ªDTOæ‰“å¤©ä¸‹

ğŸ¯ åˆ†å±‚è½¬æ¢ä¸‰åŸåˆ™ï¼š
Repositoryè¿”å›Entity
Serviceè½¬æ¢æˆDTO
Controlleråªç®¡DTO

ğŸ¯ å®‰å…¨é˜²æŠ¤ä¸‰æ­¥èµ°ï¼š
è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
è„±æ•å…³é”®å­—æ®µ
æ ¡éªŒè¾“å…¥æ•°æ®
```

---

**æ ¸å¿ƒç†è§£**ï¼š
- DTOå°±åƒå¿«é€’ç›’ï¼Œåªè£…éœ€è¦å¯„çš„ä¸œè¥¿ï¼Œä¸ä¼šæŠŠå®¶é‡Œæ‰€æœ‰ç‰©å“éƒ½æš´éœ²å‡ºå»
- åœ¨Serviceå±‚è½¬æ¢ï¼Œè®©Controllerä¸éœ€è¦çŸ¥é“æ•°æ®åº“é•¿ä»€ä¹ˆæ ·
- ä¸åŒåœºæ™¯ç”¨ä¸åŒDTOï¼Œå°±åƒä¸åŒåœºåˆç©¿ä¸åŒè¡£æœ
- MapStructæ˜¯æœ€ä½³æ˜ å°„å·¥å…·ï¼Œç¼–è¯‘æœŸç”Ÿæˆä»£ç ï¼Œæ€§èƒ½å¥½ç»´æŠ¤æ˜“