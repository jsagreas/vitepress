---
title: 38ã€Criteriaé«˜çº§æŸ¥è¯¢
---
## ğŸ“š ç›®å½•

1. [Criteria APIæ¦‚è¿°](#1-criteria-apiæ¦‚è¿°)
2. [Joinè¿æ¥æ“ä½œ](#2-joinè¿æ¥æ“ä½œ)
3. [å­æŸ¥è¯¢æ„å»º](#3-å­æŸ¥è¯¢æ„å»º)
4. [èšåˆæŸ¥è¯¢](#4-èšåˆæŸ¥è¯¢)
5. [æ’åºä¸åˆ†ç»„](#5-æ’åºä¸åˆ†ç»„)
6. [æŠ•å½±é€‰æ‹©](#6-æŠ•å½±é€‰æ‹©)
7. [å…ƒæ¨¡å‹MetaModelä½¿ç”¨](#7-å…ƒæ¨¡å‹metamodelä½¿ç”¨)
8. [Specificationæ¨¡å¼](#8-specificationæ¨¡å¼)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Criteria APIæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Criteria API


**é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼š
âŒ æ™®é€šæ–¹å¼ï¼šç›´æ¥è¯´"æˆ‘è¦ç‰›è‚‰é¢"ï¼ˆSQL/JPQLï¼‰
âœ… Criteriaæ–¹å¼ï¼šå‘Šè¯‰æœåŠ¡å‘˜"æˆ‘è¦é¢æ¡"+"åŠ ç‰›è‚‰"+"ä¸è¦é¦™èœ"ï¼ˆç»„è£…æ¡ä»¶ï¼‰

ä¼˜åŠ¿ï¼šå¯ä»¥æ ¹æ®æƒ…å†µçµæ´»ç»„è£…ï¼Œæƒ³åŠ ä»€ä¹ˆåŠ ä»€ä¹ˆ
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æœŸå°±èƒ½å‘ç°é”™è¯¯ï¼Œä¸ç”¨ç­‰åˆ°è¿è¡Œæ—¶
- **åŠ¨æ€æ„å»º**ï¼šå¯ä»¥æ ¹æ®æ¡ä»¶çµæ´»ç»„è£…æŸ¥è¯¢
- **é¢å‘å¯¹è±¡**ï¼šç”¨Javaå¯¹è±¡æ“ä½œï¼Œä¸å†™SQLå­—ç¬¦ä¸²

### 1.2 åŸºæœ¬æŸ¥è¯¢ç»“æ„


```
æŸ¥è¯¢ä¸‰è¦ç´ ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CriteriaBuilder â”‚ â† æŸ¥è¯¢æ„å»ºå™¨ï¼ˆå·¥å…·ç®±ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CriteriaQuery  â”‚ â† æŸ¥è¯¢å¯¹è±¡ï¼ˆæŸ¥è¯¢æ–¹æ¡ˆï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Root<T>        â”‚ â† æŸ¥è¯¢æ ¹ï¼ˆæ•°æ®æºï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å°±åƒåšèœï¼š
- CriteriaBuilder = å¨å…·ï¼ˆåˆ€ã€é”…ã€é“²ï¼‰
- CriteriaQuery = èœè°±ï¼ˆæ€ä¹ˆåšï¼‰
- Root = é£Ÿæï¼ˆåŸæ–™ï¼‰
```

**ç®€å•ç¤ºä¾‹**ï¼š
```java
// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<User> query = cb.createQuery(User.class);
Root<User> root = query.from(User.class);
query.select(root);

List<User> users = em.createQuery(query).getResultList();
```

---

## 2. ğŸ”— Joinè¿æ¥æ“ä½œ


### 2.1 Joinæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—è§£é‡Š**  
> Joinå°±åƒ"å¸¦ä¸Šæœ‹å‹"ï¼šæŸ¥ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œé¡ºä¾¿æŠŠä»–çš„è®¢å•ä¹Ÿå¸¦å‡ºæ¥

**ä¸ºä»€ä¹ˆéœ€è¦Join**ï¼š
```
åœºæ™¯ï¼šæŸ¥è¯¢"ä¹°è¿‡å•†å“çš„ç”¨æˆ·"
- ç”¨æˆ·è¡¨ï¼šå­˜ç”¨æˆ·ä¿¡æ¯
- è®¢å•è¡¨ï¼šå­˜è®¢å•ä¿¡æ¯
- éœ€è¦ä¸¤è¡¨è”åˆæ‰èƒ½æ‰¾åˆ°ç­”æ¡ˆ â† è¿™å°±éœ€è¦Join
```

### 2.2 Inner Joinï¼ˆå†…è¿æ¥ï¼‰


**å«ä¹‰**ï¼šåªè¦**åŒæ–¹éƒ½æœ‰**çš„æ•°æ®

```
ç±»æ¯”ï¼šæ‰¾"æœ‰å¥³æœ‹å‹çš„ç”·ç”Ÿ"
- ç”·ç”Ÿè¡¨ï¼š[å¼ ä¸‰, æå››, ç‹äº”]  
- å¥³å‹è¡¨ï¼š[å¼ ä¸‰çš„å¥³å‹, æå››çš„å¥³å‹]
- Inner Joinç»“æœï¼š[å¼ ä¸‰, æå››] â† ç‹äº”æ²¡å¥³å‹ï¼Œè¢«æ’é™¤
```

**ä»£ç ç¤ºä¾‹**ï¼š
```java
// æŸ¥è¯¢æœ‰è®¢å•çš„ç”¨æˆ·
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<User> query = cb.createQuery(User.class);
Root<User> user = query.from(User.class);

// user.join("orders") è¡¨ç¤º"å¸¦ä¸Šè®¢å•ä¿¡æ¯"
Join<User, Order> orders = user.join("orders");  
query.select(user).distinct(true); // distinctå»é‡

List<User> result = em.createQuery(query).getResultList();
```

### 2.3 Left Joinï¼ˆå·¦è¿æ¥ï¼‰


**å«ä¹‰**ï¼šä»¥**å·¦è¾¹ä¸ºä¸»**ï¼Œå³è¾¹æœ‰å°±å¸¦ä¸Šï¼Œæ²¡æœ‰å°±ç©ºç€

```
ç±»æ¯”ï¼šæŸ¥"æ‰€æœ‰ç”·ç”ŸåŠä»–ä»¬çš„å¥³å‹"
- å·¦è¡¨ï¼ˆç”¨æˆ·ï¼‰ï¼š[å¼ ä¸‰, æå››, ç‹äº”]
- å³è¡¨ï¼ˆè®¢å•ï¼‰ï¼š[å¼ ä¸‰çš„è®¢å•, æå››çš„è®¢å•]  
- Left Joinç»“æœï¼š
  å¼ ä¸‰ â†’ æœ‰è®¢å•
  æå›› â†’ æœ‰è®¢å•
  ç‹äº” â†’ è®¢å•ä¸ºnull â† ç‹äº”ä¹Ÿåœ¨ç»“æœé‡Œ
```

**ä»£ç ç¤ºä¾‹**ï¼š
```java
Root<User> user = query.from(User.class);
Join<User, Order> orders = user.join("orders", JoinType.LEFT);

// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ²¡è®¢å•çš„
query.select(user);
```

### 2.4 Joinçš„æ¡ä»¶ç­›é€‰


**åœºæ™¯**ï¼šåªè¦"é‡‘é¢>100çš„è®¢å•"çš„ç”¨æˆ·

```java
Root<User> user = query.from(User.class);
Join<User, Order> orders = user.join("orders");

// åœ¨Joinä¸Šæ·»åŠ æ¡ä»¶
query.select(user)
     .where(cb.gt(orders.get("amount"), 100));
```

**Joinç±»å‹å¯¹æ¯”è¡¨**ï¼š

| Joinç±»å‹ | è¯´æ˜ | ä½•æ—¶ä½¿ç”¨ | ç»“æœç‰¹ç‚¹ |
|---------|------|---------|---------|
| `INNER` | åŒæ–¹éƒ½æœ‰æ‰å‡ºç° | å¿…é¡»æœ‰å…³è”æ•°æ® | ç»“æœæœ€å°‘ |
| `LEFT` | ä»¥å·¦è¡¨ä¸ºå‡† | å·¦è¾¹æ•°æ®è¦å…¨ä¿ç•™ | å¯èƒ½æœ‰null |
| `RIGHT` | ä»¥å³è¡¨ä¸ºå‡† | å³è¾¹æ•°æ®è¦å…¨ä¿ç•™ | è¾ƒå°‘ä½¿ç”¨ |

---

## 3. ğŸ” å­æŸ¥è¯¢æ„å»º


### 3.1 å­æŸ¥è¯¢æ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—ç†è§£**  
> å­æŸ¥è¯¢å°±åƒ"å…ˆé—®ä¸€ä¸ªé—®é¢˜ï¼Œå†ç”¨ç­”æ¡ˆå»é—®å¦ä¸€ä¸ªé—®é¢˜"

**ç”Ÿæ´»ä¾‹å­**ï¼š
```
é—®é¢˜ï¼š"æ‰¾å‡ºæ¯”å¹³å‡å·¥èµ„é«˜çš„å‘˜å·¥"
æ­¥éª¤ï¼š
1. å…ˆç®—å¹³å‡å·¥èµ„ï¼ˆå­æŸ¥è¯¢ï¼‰â†’ 8000å…ƒ
2. å†æ‰¾å·¥èµ„>8000çš„äººï¼ˆä¸»æŸ¥è¯¢ï¼‰
```

### 3.2 åŸºæœ¬å­æŸ¥è¯¢


**åœºæ™¯**ï¼šæŸ¥è¯¢è®¢å•æ•°é‡ > 3 çš„ç”¨æˆ·

```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<User> query = cb.createQuery(User.class);
Root<User> user = query.from(User.class);

// åˆ›å»ºå­æŸ¥è¯¢ï¼šç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°
Subquery<Long> subquery = query.subquery(Long.class);
Root<Order> orderRoot = subquery.from(Order.class);
subquery.select(cb.count(orderRoot))
        .where(cb.equal(orderRoot.get("user"), user));

// ä¸»æŸ¥è¯¢ï¼šè®¢å•æ•° > 3
query.select(user)
     .where(cb.gt(subquery, 3L));
```

**æµç¨‹å›¾**ï¼š
```
ä¸»æŸ¥è¯¢ï¼šSELECT user FROM User
              â†“
         WHERE (å­æŸ¥è¯¢ç»“æœ > 3)
              â†“
å­æŸ¥è¯¢ï¼šSELECT COUNT(*) FROM Order 
        WHERE order.user = user
```

### 3.3 EXISTSå­æŸ¥è¯¢


**å«ä¹‰**ï¼šæ£€æŸ¥"æ˜¯å¦å­˜åœ¨"

**åœºæ™¯**ï¼šæŸ¥è¯¢"è‡³å°‘æœ‰ä¸€ä¸ªè®¢å•"çš„ç”¨æˆ·

```java
Subquery<Order> subquery = query.subquery(Order.class);
Root<Order> orderRoot = subquery.from(Order.class);
subquery.select(orderRoot)
        .where(cb.equal(orderRoot.get("user"), user));

// EXISTSè¡¨ç¤º"å­˜åœ¨å°±è¿”å›true"
query.select(user)
     .where(cb.exists(subquery));
```

### 3.4 INå­æŸ¥è¯¢


**åœºæ™¯**ï¼šæŸ¥è¯¢"åœ¨æŒ‡å®šåŸå¸‚çš„ç”¨æˆ·çš„è®¢å•"

```java
// å­æŸ¥è¯¢ï¼šè·å–åŒ—äº¬ã€ä¸Šæµ·ç”¨æˆ·çš„IDåˆ—è¡¨
Subquery<Long> userIds = query.subquery(Long.class);
Root<User> userRoot = userIds.from(User.class);
userIds.select(userRoot.get("id"))
       .where(userRoot.get("city").in("åŒ—äº¬", "ä¸Šæµ·"));

// ä¸»æŸ¥è¯¢ï¼šè®¢å•çš„ç”¨æˆ·IDåœ¨å­æŸ¥è¯¢ç»“æœä¸­
Root<Order> order = query.from(Order.class);
query.select(order)
     .where(cb.in(order.get("user").get("id")).value(userIds));
```

---

## 4. ğŸ“Š èšåˆæŸ¥è¯¢


### 4.1 èšåˆå‡½æ•°æ¦‚å¿µ


> ğŸ¯ **æ ¸å¿ƒç†è§£**  
> èšåˆå°±æ˜¯"æŠŠå¤šæ¡æ•°æ®åˆå¹¶è®¡ç®—"ï¼Œå¾—å‡ºä¸€ä¸ªç»“æœ

**å¸¸ç”¨èšåˆå‡½æ•°**ï¼š

| å‡½æ•° | ä½œç”¨ | ç¤ºä¾‹ | ç»“æœ |
|-----|------|------|------|
| `count()` | è®¡æ•° | ç»Ÿè®¡ç”¨æˆ·æ•° | è¿”å›æ•°å­— |
| `sum()` | æ±‚å’Œ | è®¡ç®—æ€»é”€å”®é¢ | è¿”å›æ€»å’Œ |
| `avg()` | å¹³å‡å€¼ | å¹³å‡å¹´é¾„ | è¿”å›å¹³å‡æ•° |
| `max()` | æœ€å¤§å€¼ | æœ€é«˜åˆ† | è¿”å›æœ€å¤§å€¼ |
| `min()` | æœ€å°å€¼ | æœ€ä½ä»· | è¿”å›æœ€å°å€¼ |

### 4.2 ç®€å•èšåˆ


**åœºæ™¯1ï¼šç»Ÿè®¡æ€»æ•°**
```java
CriteriaQuery<Long> query = cb.createQuery(Long.class);
Root<User> user = query.from(User.class);

// COUNT(*)
query.select(cb.count(user));
Long total = em.createQuery(query).getSingleResult();
```

**åœºæ™¯2ï¼šè®¡ç®—æ€»å’Œ**
```java
CriteriaQuery<BigDecimal> query = cb.createQuery(BigDecimal.class);
Root<Order> order = query.from(Order.class);

// SUM(amount)
query.select(cb.sum(order.get("amount")));
BigDecimal totalAmount = em.createQuery(query).getSingleResult();
```

### 4.3 åˆ†ç»„èšåˆ


**åœºæ™¯**ï¼šç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„ç”¨æˆ·æ•°é‡

```java
CriteriaQuery<Object[]> query = cb.createQuery(Object[].class);
Root<User> user = query.from(User.class);

// é€‰æ‹©ï¼šåŸå¸‚ + æ•°é‡
query.multiselect(
    user.get("city"),           // åŸå¸‚
    cb.count(user)              // è¯¥åŸå¸‚çš„ç”¨æˆ·æ•°
)
.groupBy(user.get("city"));     // æŒ‰åŸå¸‚åˆ†ç»„

List<Object[]> results = em.createQuery(query).getResultList();
// ç»“æœï¼š[["åŒ—äº¬", 100], ["ä¸Šæµ·", 150], ...]
```

**ç†è§£åˆ†ç»„**ï¼š
```
åŸå§‹æ•°æ®ï¼š
ç”¨æˆ·1 - åŒ—äº¬
ç”¨æˆ·2 - åŒ—äº¬  
ç”¨æˆ·3 - ä¸Šæµ·
ç”¨æˆ·4 - ä¸Šæµ·
ç”¨æˆ·5 - ä¸Šæµ·

åˆ†ç»„åï¼š
åŒ—äº¬ç»„ï¼š[ç”¨æˆ·1, ç”¨æˆ·2] â†’ COUNT = 2
ä¸Šæµ·ç»„ï¼š[ç”¨æˆ·3, ç”¨æˆ·4, ç”¨æˆ·5] â†’ COUNT = 3
```

### 4.4 Havingæ¡ä»¶


**å«ä¹‰**ï¼šå¯¹**åˆ†ç»„ç»“æœ**è¿›è¡Œè¿‡æ»¤

```java
// æŸ¥è¯¢ï¼šç”¨æˆ·æ•° > 50 çš„åŸå¸‚
query.multiselect(
    user.get("city"),
    cb.count(user)
)
.groupBy(user.get("city"))
.having(cb.gt(cb.count(user), 50L));  // åªè¦æ•°é‡>50çš„åŸå¸‚
```

> âš ï¸ **WHERE vs HAVING**  
> - WHEREï¼šè¿‡æ»¤åŸå§‹æ•°æ®ï¼ˆåˆ†ç»„å‰ï¼‰
> - HAVINGï¼šè¿‡æ»¤åˆ†ç»„ç»“æœï¼ˆåˆ†ç»„åï¼‰

---

## 5. ğŸ“‹ æ’åºä¸åˆ†ç»„


### 5.1 æ’åºOrder


**åŸºæœ¬æ’åº**ï¼š
```java
// æŒ‰å¹´é¾„å‡åº
query.select(user)
     .orderBy(cb.asc(user.get("age")));

// æŒ‰å¹´é¾„é™åº  
query.select(user)
     .orderBy(cb.desc(user.get("age")));
```

**å¤šå­—æ®µæ’åº**ï¼š
```java
// å…ˆæŒ‰åŸå¸‚å‡åºï¼Œå†æŒ‰å¹´é¾„é™åº
query.select(user)
     .orderBy(
         cb.asc(user.get("city")),
         cb.desc(user.get("age"))
     );
```

**æ’åºç¤ºæ„**ï¼š
```
åŸå§‹ï¼š[å¼ ä¸‰-25-åŒ—äº¬, æå››-30-ä¸Šæµ·, ç‹äº”-30-åŒ—äº¬]
      â†“ æŒ‰åŸå¸‚å‡åº
[å¼ ä¸‰-25-åŒ—äº¬, ç‹äº”-30-åŒ—äº¬, æå››-30-ä¸Šæµ·]
      â†“ å†æŒ‰å¹´é¾„é™åºï¼ˆåŒåŸå¸‚å†…ï¼‰
[ç‹äº”-30-åŒ—äº¬, å¼ ä¸‰-25-åŒ—äº¬, æå››-30-ä¸Šæµ·]
```

### 5.2 åˆ†ç»„GroupByè¯¦è§£


**åˆ†ç»„çš„æœ¬è´¨**ï¼š
```
æŠŠæ•°æ®æŒ‰æŸä¸ªå­—æ®µ"å½’ç±»"

ä¾‹ï¼šæŒ‰éƒ¨é—¨åˆ†ç»„
åŸå§‹æ•°æ®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ å§“å â”‚éƒ¨é—¨â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ å¼ ä¸‰ â”‚æŠ€æœ¯â”‚
â”‚ æå›› â”‚æŠ€æœ¯â”‚
â”‚ ç‹äº” â”‚é”€å”®â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

åˆ†ç»„åï¼š
æŠ€æœ¯ç»„ï¼š{å¼ ä¸‰,æå››}
é”€å”®ç»„ï¼š{ç‹äº”}
```

**å¤šå­—æ®µåˆ†ç»„**ï¼š
```java
// æŒ‰åŸå¸‚å’Œå¹´é¾„æ®µåˆ†ç»„
query.multiselect(
    user.get("city"),
    cb.count(user)
)
.groupBy(
    user.get("city"),
    user.get("ageGroup")  // å‡è®¾æœ‰å¹´é¾„æ®µå­—æ®µ
);
```

---

## 6. ğŸ¯ æŠ•å½±é€‰æ‹©


### 6.1 ä»€ä¹ˆæ˜¯æŠ•å½±


> ğŸ’¡ **é€šä¿—ç†è§£**  
> æŠ•å½±å°±æ˜¯"åªè¦æŸäº›åˆ—"ï¼Œä¸è¦å…¨éƒ¨æ•°æ®

**ç±»æ¯”**ï¼š
```
æ•°æ®åº“ï¼šä¸€å¼ è¡¨æœ‰10ä¸ªå­—æ®µ
æŠ•å½±ï¼šæˆ‘åªè¦å…¶ä¸­3ä¸ªå­—æ®µ

å°±åƒæ‹ç…§ï¼š
- å®Œæ•´ç…§ç‰‡ï¼šæ‰€æœ‰äººéƒ½æ‹è¿›å»
- æŠ•å½±ï¼šåªæ‹ä¸»è§’ï¼ŒèƒŒæ™¯è£æ‰
```

### 6.2 å•å­—æ®µæŠ•å½±


```java
// åªæŸ¥è¯¢ç”¨æˆ·å
CriteriaQuery<String> query = cb.createQuery(String.class);
Root<User> user = query.from(User.class);
query.select(user.get("name"));  // åªè¦nameå­—æ®µ

List<String> names = em.createQuery(query).getResultList();
// ç»“æœï¼š["å¼ ä¸‰", "æå››", "ç‹äº”"]
```

### 6.3 å¤šå­—æ®µæŠ•å½±


**æ–¹å¼1ï¼šæ•°ç»„å½¢å¼**
```java
CriteriaQuery<Object[]> query = cb.createQuery(Object[].class);
Root<User> user = query.from(User.class);

query.multiselect(
    user.get("name"),
    user.get("age")
);

List<Object[]> results = em.createQuery(query).getResultList();
// ç»“æœï¼š[["å¼ ä¸‰", 25], ["æå››", 30]]
```

**æ–¹å¼2ï¼šDTOå¯¹è±¡**
```java
// å®šä¹‰DTOç±»
public class UserDTO {
    private String name;
    private Integer age;
    // æ„é€ å™¨ã€getterã€setter
}

// æŸ¥è¯¢
CriteriaQuery<UserDTO> query = cb.createQuery(UserDTO.class);
Root<User> user = query.from(User.class);

query.select(
    cb.construct(UserDTO.class,
        user.get("name"),
        user.get("age")
    )
);

List<UserDTO> dtos = em.createQuery(query).getResultList();
```

### 6.4 è®¡ç®—å­—æ®µæŠ•å½±


**åœºæ™¯**ï¼šæŸ¥è¯¢ç”¨æˆ·åå’Œè®¢å•æ€»é¢

```java
Root<User> user = query.from(User.class);
Join<User, Order> orders = user.join("orders", JoinType.LEFT);

query.multiselect(
    user.get("name"),
    cb.sum(orders.get("amount"))  // è®¡ç®—æ€»é¢
)
.groupBy(user.get("name"));
```

---

## 7. ğŸ”§ å…ƒæ¨¡å‹MetaModelä½¿ç”¨


### 7.1 ä»€ä¹ˆæ˜¯å…ƒæ¨¡å‹


> ğŸ’¡ **é€šä¿—ç†è§£**  
> å…ƒæ¨¡å‹æ˜¯"å­—æ®µçš„Javaç±»"ï¼Œç”¨ç±»æ¥ä»£æ›¿å­—ç¬¦ä¸²

**é—®é¢˜**ï¼šå­—ç¬¦ä¸²å®¹æ˜“å†™é”™
```java
user.get("namee")  // æ‹¼å†™é”™è¯¯ï¼Œç¼–è¯‘ä¸æŠ¥é”™ âŒ
```

**è§£å†³**ï¼šç”¨å…ƒæ¨¡å‹
```java
user.get(User_.name)  // User_æ˜¯ç”Ÿæˆçš„å…ƒæ¨¡å‹ç±» âœ…
```

### 7.2 å…ƒæ¨¡å‹ç”Ÿæˆ


**é…ç½®æ–¹å¼**ï¼ˆMavenï¼‰ï¼š
```xml
<dependency>
    <groupId>org.hibernate</groupId>
    <artifactId>hibernate-jpamodelgen</artifactId>
    <scope>provided</scope>
</dependency>
```

**ç”Ÿæˆçš„å…ƒæ¨¡å‹ç±»**ï¼š
```java
// User.javaï¼ˆå®ä½“ç±»ï¼‰
@Entity
public class User {
    @Id
    private Long id;
    private String name;
    private Integer age;
}

// User_.javaï¼ˆè‡ªåŠ¨ç”Ÿæˆçš„å…ƒæ¨¡å‹ï¼‰
@Generated(...)
@StaticMetamodel(User.class)
public class User_ {
    public static volatile SingularAttribute<User, Long> id;
    public static volatile SingularAttribute<User, String> name;
    public static volatile SingularAttribute<User, Integer> age;
}
```

### 7.3 å…ƒæ¨¡å‹ä½¿ç”¨


**åŸºæœ¬æŸ¥è¯¢**ï¼š
```java
// ä½¿ç”¨å…ƒæ¨¡å‹
Root<User> user = query.from(User.class);
query.select(user)
     .where(cb.equal(user.get(User_.name), "å¼ ä¸‰"));
```

**Joinæ“ä½œ**ï¼š
```java
// æœ‰ä¸€å¯¹å¤šå…³ç³»ï¼šUser.orders
Join<User, Order> orders = user.join(User_.orders);
```

**ä¼˜åŠ¿å¯¹æ¯”**ï¼š

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|-----|------|------|
| **å­—ç¬¦ä¸²** | ç®€å•ç›´æ¥ | æ˜“æ‹¼é”™ï¼ŒIDEä¸æç¤º |
| **å…ƒæ¨¡å‹** | ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ£€æŸ¥ | éœ€è¦ç”Ÿæˆä»£ç  |

---

## 8. âœ¨ Specificationæ¨¡å¼


### 8.1 ä»€ä¹ˆæ˜¯Specification


> ğŸ’¡ **æ ¸å¿ƒç†è§£**  
> Specificationå°±æ˜¯"æŠŠæŸ¥è¯¢æ¡ä»¶å°è£…æˆå¯å¤ç”¨çš„å¯¹è±¡"

**é—®é¢˜åœºæ™¯**ï¼š
```
éœ€æ±‚å˜åŒ–é¢‘ç¹ï¼š
- æœ‰æ—¶æŒ‰åå­—æŸ¥
- æœ‰æ—¶æŒ‰å¹´é¾„æŸ¥  
- æœ‰æ—¶åå­—+å¹´é¾„ä¸€èµ·æŸ¥

ä¼ ç»Ÿæ–¹å¼ï¼šå†™å¾ˆå¤šif-elseæ‹¼SQL âŒ
Specificationï¼šæŠŠæ¡ä»¶ç»„è£…èµ·æ¥ âœ…
```

### 8.2 åŸºæœ¬ä½¿ç”¨


**å®šä¹‰Specification**ï¼š
```java
public class UserSpecs {
    
    // æŒ‰åå­—æŸ¥è¯¢çš„è§„æ ¼
    public static Specification<User> hasName(String name) {
        return (root, query, cb) -> 
            cb.equal(root.get("name"), name);
    }
    
    // æŒ‰å¹´é¾„æŸ¥è¯¢çš„è§„æ ¼
    public static Specification<User> ageGreaterThan(int age) {
        return (root, query, cb) -> 
            cb.gt(root.get("age"), age);
    }
}
```

**ä½¿ç”¨Specification**ï¼š
```java
// Repositoryæ¥å£ç»§æ‰¿JpaSpecificationExecutor
public interface UserRepository extends 
    JpaRepository<User, Long>, 
    JpaSpecificationExecutor<User> {
}

// ä½¿ç”¨
List<User> users = userRepository.findAll(
    UserSpecs.hasName("å¼ ä¸‰")
);
```

### 8.3 ç»„åˆæ¡ä»¶


**ANDç»„åˆ**ï¼š
```java
Specification<User> spec = Specification
    .where(UserSpecs.hasName("å¼ ä¸‰"))
    .and(UserSpecs.ageGreaterThan(20));

List<User> users = userRepository.findAll(spec);
// SQL: WHERE name = 'å¼ ä¸‰' AND age > 20
```

**ORç»„åˆ**ï¼š
```java
Specification<User> spec = Specification
    .where(UserSpecs.hasName("å¼ ä¸‰"))
    .or(UserSpecs.hasName("æå››"));
// SQL: WHERE name = 'å¼ ä¸‰' OR name = 'æå››'
```

### 8.4 åŠ¨æ€æ¡ä»¶ç»„è£…


**åœºæ™¯**ï¼šæ ¹æ®å‰ç«¯ä¼ å‚åŠ¨æ€æ‹¼æ¥

```java
public List<User> search(String name, Integer minAge, String city) {
    Specification<User> spec = Specification.where(null);
    
    // åå­—ä¸ä¸ºç©ºæ‰åŠ æ¡ä»¶
    if (name != null) {
        spec = spec.and(UserSpecs.hasName(name));
    }
    
    // å¹´é¾„ä¸ä¸ºç©ºæ‰åŠ æ¡ä»¶
    if (minAge != null) {
        spec = spec.and(UserSpecs.ageGreaterThan(minAge));
    }
    
    // åŸå¸‚ä¸ä¸ºç©ºæ‰åŠ æ¡ä»¶
    if (city != null) {
        spec = spec.and((root, query, cb) -> 
            cb.equal(root.get("city"), city)
        );
    }
    
    return userRepository.findAll(spec);
}
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
è¾“å…¥ï¼šname="å¼ ä¸‰", minAge=null, city="åŒ—äº¬"
      â†“
ç»„è£…æ¡ä»¶ï¼š
1. åˆå§‹ï¼šSpecification.where(null)
2. åŠ åå­—ï¼šAND name = 'å¼ ä¸‰'
3. è·³è¿‡å¹´é¾„ï¼ˆnullï¼‰
4. åŠ åŸå¸‚ï¼šAND city = 'åŒ—äº¬'
      â†“
æœ€ç»ˆSQLï¼šWHERE name = 'å¼ ä¸‰' AND city = 'åŒ—äº¬'
```

### 8.5 Specificationä¼˜åŠ¿


**å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼**ï¼š

```java
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šéš¾ä»¥ç»´æŠ¤
public List<User> search(String name, Integer age) {
    String sql = "SELECT u FROM User u WHERE 1=1";
    if (name != null) sql += " AND u.name = :name";
    if (age != null) sql += " AND u.age > :age";
    // ...æ‹¼æ¥SQLï¼Œå®¹æ˜“å‡ºé”™
}

// âœ… Specificationæ–¹å¼ï¼šæ¸…æ™°æ˜“ç»´æŠ¤
public List<User> search(String name, Integer age) {
    return userRepository.findAll(
        Specification.where(hasName(name))
                    .and(ageGreaterThan(age))
    );
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Criteria APIï¼šç±»å‹å®‰å…¨çš„åŠ¨æ€æŸ¥è¯¢æ„å»ºæ–¹å¼
ğŸ”¸ Joinæ“ä½œï¼šè¿æ¥å¤šè¡¨æŸ¥è¯¢ï¼Œåˆ†INNER/LEFT/RIGHT
ğŸ”¸ å­æŸ¥è¯¢ï¼šæŸ¥è¯¢ä¸­åµŒå¥—æŸ¥è¯¢ï¼Œå®ç°å¤æ‚é€»è¾‘
ğŸ”¸ èšåˆå‡½æ•°ï¼šCOUNT/SUM/AVG/MAX/MINç»Ÿè®¡è®¡ç®—
ğŸ”¸ æŠ•å½±é€‰æ‹©ï¼šåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼Œæé«˜æ€§èƒ½
ğŸ”¸ å…ƒæ¨¡å‹ï¼šç”¨ç±»ä»£æ›¿å­—ç¬¦ä¸²ï¼Œé¿å…æ‹¼å†™é”™è¯¯
ğŸ”¸ Specificationï¼šå°è£…æŸ¥è¯¢æ¡ä»¶ï¼ŒåŠ¨æ€ç»„è£…
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Criteria vs JPQL**
```
JPQLï¼ˆå­—ç¬¦ä¸²æŸ¥è¯¢ï¼‰ï¼š
- ç®€å•ç›´è§‚
- ä½†æ¡ä»¶åŠ¨æ€å˜åŒ–æ—¶éš¾å¤„ç†

Criteriaï¼ˆå¯¹è±¡æŸ¥è¯¢ï¼‰ï¼š
- ç±»å‹å®‰å…¨
- åŠ¨æ€æ‹¼æ¥æ¡ä»¶å¾ˆæ–¹ä¾¿
```

**ğŸ”¹ Joinçš„é€‰æ‹©**
```
INNER JOINï¼šåªè¦éƒ½æœ‰çš„ â†’ æœ€ä¸¥æ ¼
LEFT JOINï¼šå·¦è¾¹å…¨è¦ â†’ å¸¸ç”¨
RIGHT JOINï¼šå³è¾¹å…¨è¦ â†’ å°‘ç”¨
```

**ğŸ”¹ Specificationçš„ä»·å€¼**
```
åœºæ™¯ï¼šæœç´¢åŠŸèƒ½ï¼Œ10ä¸ªå¯é€‰æ¡ä»¶
ä¼ ç»Ÿï¼šå†™2^10 = 1024ç§ç»„åˆï¼ŸâŒ
Specificationï¼šåŠ¨æ€ç»„è£… âœ…
```

### 9.3 å®é™…åº”ç”¨å»ºè®®


> ğŸ¯ **ä½¿ç”¨åœºæ™¯**  
> - ç®€å•æŸ¥è¯¢ï¼šç”¨JPQLæˆ–æ–¹æ³•å‘½å
> - å¤æ‚æŸ¥è¯¢ï¼šç”¨Criteria
> - åŠ¨æ€æ¡ä»¶ï¼šç”¨Specification

**æ€§èƒ½ä¼˜åŒ–æç¤º**ï¼š
```
1. æŠ•å½±é€‰æ‹©ï¼šåªæŸ¥éœ€è¦çš„å­—æ®µ
2. JOINä¼˜åŒ–ï¼šé¿å…è¿‡å¤šJOINå±‚çº§
3. å­æŸ¥è¯¢ï¼šè€ƒè™‘æ”¹å†™ä¸ºJOIN
4. ç´¢å¼•ï¼šä¸ºå¸¸æŸ¥å­—æ®µå»ºç´¢å¼•
```

**ä»£ç è§„èŒƒ**ï¼š
```java
// âœ… æ¨èï¼šç”¨å…ƒæ¨¡å‹
root.get(User_.name)

// âŒ ä¸æ¨èï¼šç”¨å­—ç¬¦ä¸²
root.get("name")

// âœ… æ¨èï¼šSpecificationå°è£…
UserSpecs.hasName(name)

// âŒ ä¸æ¨èï¼šåˆ°å¤„å†™æŸ¥è¯¢é€»è¾‘
(root, query, cb) -> cb.equal(...)
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- Criteriaå¯¹è±¡æ¥æ„å»ºï¼Œç±»å‹å®‰å…¨ä¸æ€•é”™
- Joinè¿æ¥å¤šè¡¨æŸ¥ï¼Œå­æŸ¥è¯¢åµŒå¥—ç”¨
- èšåˆç»Ÿè®¡æ‰¾è§„å¾‹ï¼ŒæŠ•å½±é€‰æ‹©ææ€§èƒ½
- å…ƒæ¨¡å‹ä»£æ›¿ä¸²ï¼ŒSpecificationç»„æ¡ä»¶