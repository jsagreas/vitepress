---
title: 24ã€æ¯ç±»ä¸€è¡¨TABLE_PER_CLASS
---
## ğŸ“š ç›®å½•

1. [æ¯ç±»ä¸€è¡¨ç­–ç•¥æ˜¯ä»€ä¹ˆ](#1-æ¯ç±»ä¸€è¡¨ç­–ç•¥æ˜¯ä»€ä¹ˆ)
2. [å·¥ä½œåŸç†æ·±åº¦è§£æ](#2-å·¥ä½œåŸç†æ·±åº¦è§£æ)
3. [å®é™…åº”ç”¨åœºæ™¯](#3-å®é™…åº”ç”¨åœºæ™¯)
4. [æ€§èƒ½ç‰¹ç‚¹ä¸æƒè¡¡](#4-æ€§èƒ½ç‰¹ç‚¹ä¸æƒè¡¡)
5. [æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹](#5-æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ¯ç±»ä¸€è¡¨ç­–ç•¥æ˜¯ä»€ä¹ˆ


### 1.1 æ ¸å¿ƒæ¦‚å¿µç†è§£


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ¯ç±»ä¸€è¡¨ç­–ç•¥ï¼Ÿ**

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯**æ¯ä¸ªå…·ä½“ç±»éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å®Œæ•´æ•°æ®è¡¨**ã€‚

```
æƒ³è±¡ä¸€ä¸ªç°å®åœºæ™¯ï¼š
ä½ åœ¨ç®¡ç†ä¸€ä¸ªå›¾ä¹¦é¦†ï¼Œæœ‰ä¸åŒç±»å‹çš„ä¹¦ç±ï¼š

çº¸è´¨ä¹¦ç±»ï¼šéœ€è¦è®°å½•ISBNã€ä¹¦åã€ä½œè€…ã€é¡µæ•°ã€åº“å­˜ä½ç½®
ç”µå­ä¹¦ç±»ï¼šéœ€è¦è®°å½•ISBNã€ä¹¦åã€ä½œè€…ã€æ–‡ä»¶å¤§å°ã€ä¸‹è½½é“¾æ¥

TABLE_PER_CLASSç­–ç•¥å°±åƒï¼š
- ä¸ºçº¸è´¨ä¹¦å•ç‹¬å»ºä¸€ä¸ªå®Œæ•´çš„ä¹¦æ¶ç³»ç»Ÿ
- ä¸ºç”µå­ä¹¦å•ç‹¬å»ºä¸€ä¸ªå®Œæ•´çš„å­˜å‚¨ç³»ç»Ÿ
- æ¯ä¸ªç³»ç»Ÿéƒ½ç‹¬ç«‹å­˜å‚¨å„è‡ªçš„æ‰€æœ‰ä¿¡æ¯
```

**ğŸ“Š é€šä¿—ç†è§£**ï¼š
```
ä¼ ç»Ÿé¢å‘å¯¹è±¡ç»§æ‰¿ï¼š
    Bookï¼ˆæŠ½è±¡çˆ¶ç±»ï¼‰
     â”œâ”€â”€ PaperBookï¼ˆçº¸è´¨ä¹¦ï¼‰
     â””â”€â”€ EBookï¼ˆç”µå­ä¹¦ï¼‰

TABLE_PER_CLASSæ•°æ®åº“æ˜ å°„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PaperBookè¡¨    â”‚     â”‚  EBookè¡¨        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚     â”‚ id              â”‚
â”‚ isbn            â”‚     â”‚ isbn            â”‚
â”‚ title           â”‚     â”‚ title           â”‚
â”‚ author          â”‚     â”‚ author          â”‚
â”‚ pageCount       â”‚     â”‚ fileSize        â”‚
â”‚ location        â”‚     â”‚ downloadUrl     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨æ„ï¼šçˆ¶ç±»Bookçš„å­—æ®µåœ¨æ¯ä¸ªå­ç±»è¡¨ä¸­éƒ½å®Œæ•´é‡å¤å­˜å‚¨
```

### 1.2 ä¸å…¶ä»–ç­–ç•¥çš„åŒºåˆ«


**ğŸ†š ä¸‰ç§ç»§æ‰¿ç­–ç•¥å¯¹æ¯”ç†è§£**ï¼š

| ç­–ç•¥ç±»å‹ | è¡¨ç»“æ„ | ç±»æ¯”è¯´æ˜ |
|---------|--------|----------|
| **SINGLE_TABLE** | `1ä¸ªå…±äº«è¡¨` | æ‰€æœ‰ä¹¦éƒ½æ”¾åœ¨åŒä¸€ä¸ªå¤§ä»“åº“ï¼Œç”¨æ ‡ç­¾åŒºåˆ†ç±»å‹ |
| **JOINED** | `å¤šä¸ªå…³è”è¡¨` | å…¬å…±ä¿¡æ¯æ”¾æ€»åº“ï¼Œç‰¹æ®Šä¿¡æ¯æ”¾å„è‡ªä¸“å±åº“ |
| **TABLE_PER_CLASS** | `å¤šä¸ªç‹¬ç«‹è¡¨` | æ¯ç§ä¹¦éƒ½æœ‰è‡ªå·±å®Œå…¨ç‹¬ç«‹çš„ä»“åº“ç³»ç»Ÿ |

**ğŸ’¡ æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… **å®Œå…¨ç‹¬ç«‹**ï¼šæ¯ä¸ªè¡¨å­˜å‚¨å®Œæ•´çš„æ•°æ®ï¼ŒåŒ…æ‹¬çˆ¶ç±»å­—æ®µ
- âœ… **æ— éœ€å…³è”**ï¼šä¸éœ€è¦JOINæŸ¥è¯¢å•ä¸ªå¯¹è±¡
- âŒ **æ•°æ®é‡å¤**ï¼šçˆ¶ç±»å­—æ®µåœ¨æ¯ä¸ªè¡¨ä¸­é‡å¤å®šä¹‰
- âŒ **æŸ¥è¯¢å¤æ‚**ï¼šæŸ¥è¯¢çˆ¶ç±»éœ€è¦UNIONå¤šä¸ªè¡¨

### 1.3 é…ç½®æ–¹å¼


**ğŸ”§ åŸºç¡€é…ç½®ç¤ºä¾‹**ï¼š

```java
// çˆ¶ç±»ï¼šæŠ½è±¡çš„ä¹¦ç±ç±»
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Book {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    
    private String isbn;      // ISBNå·
    private String title;     // ä¹¦å
    private String author;    // ä½œè€…
    
    // getters and setters...
}

// å­ç±»1ï¼šçº¸è´¨ä¹¦
@Entity
public class PaperBook extends Book {
    private Integer pageCount;    // é¡µæ•°
    private String location;      // åº“å­˜ä½ç½®
    
    // getters and setters...
}

// å­ç±»2ï¼šç”µå­ä¹¦
@Entity
public class EBook extends Book {
    private Long fileSize;        // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    private String downloadUrl;   // ä¸‹è½½é“¾æ¥
    
    // getters and setters...
}
```

**ğŸ—ºï¸ ç”Ÿæˆçš„æ•°æ®åº“ç»“æ„**ï¼š
```
å®é™…ç”Ÿæˆçš„è¡¨ç»“æ„ï¼š

Table: PaperBook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ—å       â”‚ ç±»å‹     â”‚ è¯´æ˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id         â”‚ BIGINT   â”‚ ä¸»é”®        â”‚
â”‚ isbn       â”‚ VARCHAR  â”‚ ISBNï¼ˆç»§æ‰¿ï¼‰â”‚
â”‚ title      â”‚ VARCHAR  â”‚ ä¹¦åï¼ˆç»§æ‰¿ï¼‰â”‚
â”‚ author     â”‚ VARCHAR  â”‚ ä½œè€…ï¼ˆç»§æ‰¿ï¼‰â”‚
â”‚ pageCount  â”‚ INT      â”‚ é¡µæ•°ï¼ˆè‡ªæœ‰ï¼‰â”‚
â”‚ location   â”‚ VARCHAR  â”‚ ä½ç½®ï¼ˆè‡ªæœ‰ï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Table: EBook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ—å        â”‚ ç±»å‹     â”‚ è¯´æ˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id          â”‚ BIGINT   â”‚ ä¸»é”®        â”‚
â”‚ isbn        â”‚ VARCHAR  â”‚ ISBNï¼ˆç»§æ‰¿ï¼‰â”‚
â”‚ title       â”‚ VARCHAR  â”‚ ä¹¦åï¼ˆç»§æ‰¿ï¼‰â”‚
â”‚ author      â”‚ VARCHAR  â”‚ ä½œè€…ï¼ˆç»§æ‰¿ï¼‰â”‚
â”‚ fileSize    â”‚ BIGINT   â”‚ å¤§å°ï¼ˆè‡ªæœ‰ï¼‰â”‚
â”‚ downloadUrl â”‚ VARCHAR  â”‚ é“¾æ¥ï¼ˆè‡ªæœ‰ï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. âš™ï¸ å·¥ä½œåŸç†æ·±åº¦è§£æ


### 2.1 æ•°æ®å­˜å‚¨æœºåˆ¶


**ğŸ“¦ æ•°æ®æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿ**

```
å­˜å‚¨è¿‡ç¨‹è§£æï¼š

1. ä¿å­˜PaperBookå¯¹è±¡æ—¶ï¼š
   PaperBook book = new PaperBook();
   book.setIsbn("978-3-16-148410-0");
   book.setTitle("Javaç¼–ç¨‹æ€æƒ³");
   book.setAuthor("Bruce Eckel");
   book.setPageCount(880);
   book.setLocation("AåŒº-3å±‚-15å·");
   
   â†“ JPAå¤„ç†
   
   INSERT INTO PaperBook VALUES (
       1,                           -- id
       '978-3-16-148410-0',        -- isbnï¼ˆçˆ¶ç±»å­—æ®µï¼‰
       'Javaç¼–ç¨‹æ€æƒ³',              -- titleï¼ˆçˆ¶ç±»å­—æ®µï¼‰
       'Bruce Eckel',              -- authorï¼ˆçˆ¶ç±»å­—æ®µï¼‰
       880,                        -- pageCountï¼ˆå­ç±»å­—æ®µï¼‰
       'AåŒº-3å±‚-15å·'               -- locationï¼ˆå­ç±»å­—æ®µï¼‰
   );

å…³é”®ç†è§£ï¼š
âœ… æ‰€æœ‰æ•°æ®ï¼ˆçˆ¶ç±»+å­ç±»ï¼‰å­˜å‚¨åœ¨ä¸€ä¸ªè¡¨çš„ä¸€è¡Œè®°å½•ä¸­
âœ… ä¸éœ€è¦å…³è”å…¶ä»–è¡¨
âœ… æ•°æ®å®Œæ•´æ€§å¥½ï¼Œä¸€ä¸ªè¡¨åŒ…å«æ‰€æœ‰ä¿¡æ¯
```

**ğŸ”„ å¤šä¸ªå­ç±»å­˜å‚¨å¯¹æ¯”**ï¼š
```
åœºæ™¯ï¼šä¿å­˜ä¸€æœ¬çº¸è´¨ä¹¦å’Œä¸€æœ¬ç”µå­ä¹¦

// çº¸è´¨ä¹¦ä¿å­˜
PaperBook paper = new PaperBook(...);
em.persist(paper);
â†’ INSERT INTO PaperBook VALUES (1, 'ISBN1', 'Book1', 'Author1', 300, 'A-1');

// ç”µå­ä¹¦ä¿å­˜
EBook ebook = new EBook(...);
em.persist(ebook);
â†’ INSERT INTO EBook VALUES (2, 'ISBN2', 'Book2', 'Author2', 5242880, 'http://...');

ç»“æœï¼š
- ä¸¤æ¡è®°å½•å­˜å‚¨åœ¨ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„è¡¨ä¸­
- æ²¡æœ‰ä»»ä½•è¡¨å…³è”å…³ç³»
- æ¯ä¸ªè¡¨éƒ½æ˜¯è‡ªç»™è‡ªè¶³çš„å®Œæ•´æ•°æ®å­˜å‚¨
```

### 2.2 æŸ¥è¯¢æœºåˆ¶è¯¦è§£


**ğŸ” å•ä¸€å­ç±»æŸ¥è¯¢ï¼ˆç®€å•ï¼‰**ï¼š

```java
// åœºæ™¯ï¼šæŸ¥è¯¢æ‰€æœ‰çº¸è´¨ä¹¦
List<PaperBook> paperBooks = em.createQuery(
    "SELECT p FROM PaperBook p", 
    PaperBook.class
).getResultList();
```

**ç”Ÿæˆçš„SQL**ï¼š
```sql
-- éå¸¸ç®€å•ç›´æ¥ï¼ŒåªæŸ¥ä¸€ä¸ªè¡¨
SELECT id, isbn, title, author, pageCount, location 
FROM PaperBook;
```

**ğŸ“Š åˆ†æ**ï¼š
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šå•è¡¨æŸ¥è¯¢ï¼Œæ— JOIN
- âœ… **ç´¢å¼•é«˜æ•ˆ**ï¼šå¯ä»¥å……åˆ†åˆ©ç”¨è¡¨ç´¢å¼•
- âœ… **æŸ¥è¯¢è®¡åˆ’ç®€å•**ï¼šæ•°æ®åº“ä¼˜åŒ–å™¨å®¹æ˜“å¤„ç†

**ğŸ” çˆ¶ç±»æŸ¥è¯¢ï¼ˆå¤æ‚ï¼‰**ï¼š

```java
// åœºæ™¯ï¼šæŸ¥è¯¢æ‰€æœ‰ä¹¦ç±ï¼ˆä¸åŒºåˆ†ç±»å‹ï¼‰
List<Book> allBooks = em.createQuery(
    "SELECT b FROM Book b", 
    Book.class
).getResultList();
```

**ç”Ÿæˆçš„SQLï¼ˆå…³é”®ç†è§£ç‚¹ï¼‰**ï¼š
```sql
-- éœ€è¦UNIONæ‰€æœ‰å­ç±»è¡¨
SELECT id, isbn, title, author, NULL as pageCount, NULL as location,
       NULL as fileSize, NULL as downloadUrl, 'PaperBook' as CLAZZ
FROM PaperBook

UNION ALL

SELECT id, isbn, title, author, NULL as pageCount, NULL as location,
       fileSize, downloadUrl, 'EBook' as CLAZZ
FROM EBook;
```

**ğŸ’¡ UNIONæŸ¥è¯¢è¯¦è§£**ï¼š
```
ä¸ºä»€ä¹ˆéœ€è¦UNIONï¼Ÿ

1. æ•°æ®åˆ†æ•£å­˜å‚¨ï¼š
   PaperBookè¡¨ï¼šå­˜å‚¨çº¸è´¨ä¹¦æ•°æ®
   EBookè¡¨ï¼šå­˜å‚¨ç”µå­ä¹¦æ•°æ®
   
2. æŸ¥è¯¢çˆ¶ç±»æ—¶éœ€è¦åˆå¹¶ï¼š
   BookæŸ¥è¯¢ = PaperBookæ•°æ® âˆª EBookæ•°æ®
   
3. UNIONåšäº†ä»€ä¹ˆï¼š
   - ä»PaperBookè¡¨å–å‡ºæ‰€æœ‰è®°å½•
   - ä»EBookè¡¨å–å‡ºæ‰€æœ‰è®°å½•
   - å°†ä¸¤éƒ¨åˆ†ç»“æœåˆå¹¶æˆä¸€ä¸ªç»“æœé›†
   
4. æ€§èƒ½å½±å“ï¼š
   âŒ éœ€è¦æ‰«æå¤šä¸ªè¡¨
   âŒ éœ€è¦åˆå¹¶ç»“æœé›†
   âŒ å­ç±»è¶Šå¤šï¼ŒUNIONè¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®
```

### 2.3 ä¸»é”®ç”Ÿæˆç­–ç•¥


**ğŸ”‘ ä¸»é”®ç®¡ç†çš„ç‰¹æ®Šæ€§**ï¼š

```
é—®é¢˜åœºæ™¯ï¼š
PaperBookè¡¨ï¼šid = 1, 2, 3...
EBookè¡¨ï¼šid = 1, 2, 3...  â† è¿™æ ·ä¼šå†²çªå—ï¼Ÿ

ç­”æ¡ˆï¼šTABLE_PER_CLASSç­–ç•¥ä¸‹ï¼Œä¸»é”®å¿…é¡»å…¨å±€å”¯ä¸€ï¼
```

**æ¨èé…ç½®**ï¼š
```java
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Book {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)  // è‡ªåŠ¨é€‰æ‹©ç­–ç•¥
    // æˆ–è€…æ˜ç¡®ä½¿ç”¨TABLEç­–ç•¥ï¼š
    // @GeneratedValue(strategy = GenerationType.TABLE)
    private Long id;
}
```

**ğŸ”¢ ä¸»é”®ç”Ÿæˆæµç¨‹**ï¼š
```
JPAä½¿ç”¨ç‹¬ç«‹çš„åºåˆ—è¡¨ç®¡ç†IDï¼š

Table: hibernate_sequences
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sequence_nameâ”‚ next_val    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Book         â”‚ 1           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¿å­˜æµç¨‹ï¼š
1. åˆ›å»ºPaperBook â†’ ä»åºåˆ—è¡¨è·å–ID=1 â†’ PaperBook.id=1
2. åˆ›å»ºEBook â†’ ä»åºåˆ—è¡¨è·å–ID=2 â†’ EBook.id=2
3. åˆ›å»ºPaperBook â†’ ä»åºåˆ—è¡¨è·å–ID=3 â†’ PaperBook.id=3

ç»“æœï¼š
PaperBookè¡¨ï¼šid = 1, 3, 5...
EBookè¡¨ï¼šid = 2, 4, 6...

å…³é”®ï¼šè™½ç„¶åœ¨ä¸åŒè¡¨ä¸­ï¼Œä½†IDæ°¸ä¸é‡å¤
```

---

## 3. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 3.1 é€‚åˆä½¿ç”¨çš„åœºæ™¯


**âœ… åœºæ™¯1ï¼šå­ç±»å·®å¼‚éå¸¸å¤§**

```java
// å‘˜å·¥ç®¡ç†ç³»ç»Ÿç¤ºä¾‹
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Employee {
    @Id
    @GeneratedValue(strategy = GenerationType.TABLE)
    private Long id;
    private String name;
    private String email;
}

// å…¨èŒå‘˜å·¥ï¼šæœ‰å›ºå®šå·¥èµ„ã€ç¤¾ä¿ã€å¹´å‡
@Entity
public class FullTimeEmployee extends Employee {
    private BigDecimal monthlySalary;    // æœˆè–ª
    private String socialSecurityNo;     // ç¤¾ä¿å·
    private Integer annualLeave;         // å¹´å‡å¤©æ•°
    private String department;           // éƒ¨é—¨
}

// å…¼èŒå‘˜å·¥ï¼šæŒ‰å°æ—¶è®¡è´¹ã€æ— ç¤¾ä¿ã€æ— å¹´å‡
@Entity
public class PartTimeEmployee extends Employee {
    private BigDecimal hourlyRate;       // æ—¶è–ª
    private Integer hoursPerWeek;        // æ¯å‘¨å·¥ä½œå°æ—¶
    private LocalDate contractEndDate;   // åˆåŒåˆ°æœŸæ—¥
}

// å®ä¹ ç”Ÿï¼šæœ‰å¯¼å¸ˆã€å­¦æ ¡ä¿¡æ¯
@Entity
public class Intern extends Employee {
    private String university;           // å­¦æ ¡
    private String major;                // ä¸“ä¸š
    private String mentor;               // å¯¼å¸ˆ
    private LocalDate internshipEnd;     // å®ä¹ ç»“æŸæ—¥æœŸ
}
```

**ğŸ’¡ ä¸ºä»€ä¹ˆé€‚åˆï¼Ÿ**
- ä¸‰ç§å‘˜å·¥ç±»å‹å­—æ®µå®Œå…¨ä¸åŒ
- å¾ˆå°‘éœ€è¦ç»Ÿä¸€æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥
- å¤§éƒ¨åˆ†ä¸šåŠ¡éƒ½æ˜¯é’ˆå¯¹å…·ä½“ç±»å‹æ“ä½œ
- æ•°æ®ç‹¬ç«‹æ€§è¦æ±‚é«˜

**âœ… åœºæ™¯2ï¼šæŸ¥è¯¢éƒ½æ˜¯é’ˆå¯¹å…·ä½“å­ç±»**

```java
// ç¤ºä¾‹ï¼šç”µå•†å¹³å°çš„å•†å“åˆ†ç±»
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Product {
    @Id
    @GeneratedValue(strategy = GenerationType.TABLE)
    private Long id;
    private String name;
    private BigDecimal price;
}

// å›¾ä¹¦ç±»å•†å“
@Entity
public class BookProduct extends Product {
    private String isbn;
    private String publisher;
    private Integer pageCount;
}

// ç”µå­äº§å“
@Entity
public class ElectronicsProduct extends Product {
    private String brand;
    private String model;
    private Integer warrantyMonths;
}

// ä¸šåŠ¡æŸ¥è¯¢åœºæ™¯ï¼š
// âœ… æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦ - é¢‘ç¹ï¼Œæ€§èƒ½å¥½
// âœ… æŸ¥è¯¢æ‰€æœ‰ç”µå­äº§å“ - é¢‘ç¹ï¼Œæ€§èƒ½å¥½
// âŒ æŸ¥è¯¢æ‰€æœ‰å•†å“ - å¾ˆå°‘ç”¨åˆ°
```

### 3.2 ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯


**âŒ åœºæ™¯1ï¼šé¢‘ç¹çš„çˆ¶ç±»æŸ¥è¯¢**

```java
// ä¸å¥½çš„ä¾‹å­ï¼šå†…å®¹ç®¡ç†ç³»ç»Ÿ
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Content {
    private Long id;
    private String title;
    private LocalDateTime publishDate;
}

// æ–‡ç« 
@Entity
public class Article extends Content {
    private String body;
}

// è§†é¢‘
@Entity
public class Video extends Content {
    private String videoUrl;
}

// ä¸šåŠ¡éœ€æ±‚ï¼ˆé—®é¢˜æ‰€åœ¨ï¼‰ï¼š
// é¦–é¡µéœ€è¦å±•ç¤ºæ‰€æœ‰å†…å®¹ï¼ˆæ–‡ç« +è§†é¢‘æ··åˆå±•ç¤ºï¼‰
List<Content> allContent = em.createQuery(
    "SELECT c FROM Content c ORDER BY c.publishDate DESC",
    Content.class
).getResultList();

// é—®é¢˜ï¼š
// âŒ æ¯æ¬¡æŸ¥è¯¢éƒ½è¦UNIONä¸¤ä¸ªè¡¨
// âŒ æ’åºéœ€è¦åœ¨UNIONåè¿›è¡Œï¼Œæ— æ³•åˆ©ç”¨ç´¢å¼•
// âŒ åˆ†é¡µæ•ˆç‡ä½ä¸‹
```

**âŒ åœºæ™¯2ï¼šå­ç±»æ•°é‡å¾ˆå¤š**

```
åä¾‹ï¼šæ”¯ä»˜æ–¹å¼ç®¡ç†

Paymentï¼ˆçˆ¶ç±»ï¼‰
 â”œâ”€â”€ CreditCardPayment
 â”œâ”€â”€ DebitCardPayment
 â”œâ”€â”€ PayPalPayment
 â”œâ”€â”€ AlipayPayment
 â”œâ”€â”€ WeChatPayment
 â”œâ”€â”€ BankTransferPayment
 â”œâ”€â”€ CashPayment
 â””â”€â”€ ... ç­‰20ç§æ”¯ä»˜æ–¹å¼

é—®é¢˜ï¼š
æŸ¥è¯¢æ‰€æœ‰æ”¯ä»˜è®°å½•æ—¶ï¼š
SELECT ... FROM CreditCardPayment
UNION ALL
SELECT ... FROM DebitCardPayment  
UNION ALL
... (18ä¸ªUNION)

ç»“æœï¼šæŸ¥è¯¢æ€§èƒ½æå·®ï¼
```

---

## 4. ğŸ“Š æ€§èƒ½ç‰¹ç‚¹ä¸æƒè¡¡


### 4.1 æ€§èƒ½ä¼˜åŠ¿åˆ†æ


**âš¡ ä¼˜åŠ¿1ï¼šå•ç±»æŸ¥è¯¢æ€§èƒ½ä¼˜ç§€**

```
æ€§èƒ½æµ‹è¯•å¯¹æ¯”ï¼ˆ10ä¸‡æ¡è®°å½•ï¼‰ï¼š

åœºæ™¯ï¼šæŸ¥è¯¢æ‰€æœ‰PaperBook

TABLE_PER_CLASSç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT * FROM PaperBook;    â”‚
â”‚ æ‰§è¡Œæ—¶é—´: 45ms              â”‚
â”‚ ç´¢å¼•åˆ©ç”¨: 100%              â”‚
â”‚ ç¼“å­˜å‘½ä¸­: é«˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

JOINEDç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT * FROM Book b               â”‚
â”‚ JOIN PaperBook p ON b.id = p.id    â”‚
â”‚ æ‰§è¡Œæ—¶é—´: 120ms                     â”‚
â”‚ ç´¢å¼•åˆ©ç”¨: éƒ¨åˆ†                      â”‚
â”‚ JOINå¼€é”€: å­˜åœ¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“è®ºï¼šå•ç±»æŸ¥è¯¢å¿« 62.5%
```

**âš¡ ä¼˜åŠ¿2ï¼šæ•°æ®æ’å…¥ç®€å•**

```
æ’å…¥æ€§èƒ½å¯¹æ¯”ï¼š

TABLE_PER_CLASSï¼š
1. ç”ŸæˆIDï¼ˆä¸€æ¬¡æ•°æ®åº“æ“ä½œï¼‰
2. INSERT INTO PaperBook VALUES (...)ï¼ˆä¸€æ¬¡æ•°æ®åº“æ“ä½œï¼‰
æ€»è®¡ï¼š2æ¬¡æ•°æ®åº“äº¤äº’

JOINEDç­–ç•¥ï¼š
1. ç”ŸæˆID
2. INSERT INTO Book VALUES (...)ï¼ˆçˆ¶è¡¨ï¼‰
3. INSERT INTO PaperBook VALUES (...)ï¼ˆå­è¡¨ï¼‰
æ€»è®¡ï¼š3æ¬¡æ•°æ®åº“äº¤äº’ï¼Œä¸”éœ€è¦äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§

æ€§èƒ½æå‡ï¼šçº¦30-40%
```

### 4.2 æ€§èƒ½åŠ£åŠ¿åˆ†æ


**âŒ åŠ£åŠ¿1ï¼šå¤šæ€æŸ¥è¯¢çš„UNIONå¼€é”€**

```
æŸ¥è¯¢æ‰€æœ‰Bookçš„æ€§èƒ½åˆ†æï¼š

æ•°æ®é‡ï¼š
- PaperBookè¡¨ï¼š50,000æ¡è®°å½•
- EBookè¡¨ï¼š30,000æ¡è®°å½•

ç”Ÿæˆçš„SQLï¼š
SELECT ... FROM PaperBook
UNION ALL
SELECT ... FROM EBook

æ‰§è¡Œåˆ†æï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: æ‰«æPaperBookè¡¨           â”‚
â”‚   - å…¨è¡¨æ‰«æ: 50,000è¡Œ           â”‚
â”‚   - è€—æ—¶: 80ms                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ­¥éª¤2: æ‰«æEBookè¡¨               â”‚
â”‚   - å…¨è¡¨æ‰«æ: 30,000è¡Œ           â”‚
â”‚   - è€—æ—¶: 50ms                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ­¥éª¤3: åˆå¹¶ç»“æœé›†                â”‚
â”‚   - UNIONæ“ä½œ: 80,000è¡Œ          â”‚
â”‚   - è€—æ—¶: 40ms                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»è€—æ—¶: 170ms                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŒæ ·çš„SINGLE_TABLEç­–ç•¥ï¼š
SELECT ... FROM Book
- å•è¡¨æ‰«æ: 80,000è¡Œ
- è€—æ—¶: 60ms

æ€§èƒ½å·®è·ï¼šçº¦3å€
```

**âŒ åŠ£åŠ¿2ï¼šå…³è”æŸ¥è¯¢å¤æ‚åº¦**

```java
// åœºæ™¯ï¼šè®¢å•å…³è”ä¹¦ç±
@Entity
public class Order {
    @Id
    private Long id;
    
    @ManyToOne
    private Book book;  // å¤šæ€å…³è”
}

// æŸ¥è¯¢è®¢å•åŠå…¶å…³è”çš„ä¹¦ç±
List<Order> orders = em.createQuery(
    "SELECT o FROM Order o JOIN FETCH o.book",
    Order.class
).getResultList();
```

**ç”Ÿæˆçš„SQLå¤æ‚åº¦**ï¼š
```sql
-- å®é™…ç”Ÿæˆçš„SQLéå¸¸å¤æ‚
SELECT o.*, 
       CASE 
           WHEN pb.id IS NOT NULL THEN pb.*
           WHEN eb.id IS NOT NULL THEN eb.*
       END
FROM Order o
LEFT JOIN PaperBook pb ON o.book_id = pb.id
LEFT JOIN EBook eb ON o.book_id = eb.id;

é—®é¢˜åˆ†æï¼š
âŒ éœ€è¦LEFT JOINæ‰€æœ‰å¯èƒ½çš„å­ç±»è¡¨
âŒ ä½¿ç”¨CASEåˆ¤æ–­å®é™…ç±»å‹
âŒ å­ç±»è¶Šå¤šï¼ŒJOINè¶Šå¤š
âŒ æŸ¥è¯¢è®¡åˆ’å¤æ‚ï¼Œä¼˜åŒ–å™¨éš¾ä»¥ä¼˜åŒ–
```

### 4.3 ç©ºé—´ä½¿ç”¨åˆ†æ


**ğŸ’¾ å­˜å‚¨ç©ºé—´å¯¹æ¯”**ï¼š

```
åœºæ™¯è®¾å®šï¼š
- Bookçˆ¶ç±»ï¼š3ä¸ªå­—æ®µï¼ˆid, isbn, titleï¼‰
- PaperBookå­ç±»ï¼š2ä¸ªå­—æ®µï¼ˆpageCount, locationï¼‰
- EBookå­ç±»ï¼š2ä¸ªå­—æ®µï¼ˆfileSize, downloadUrlï¼‰
- æ•°æ®é‡ï¼šå„50,000æ¡

TABLE_PER_CLASSå­˜å‚¨ï¼š
PaperBookè¡¨ï¼š
  å­—æ®µæ•°ï¼š5ï¼ˆçˆ¶ç±»3 + å­ç±»2ï¼‰
  è®°å½•æ•°ï¼š50,000
  ä¼°ç®—å¤§å°ï¼š50,000 Ã— 200å­—èŠ‚ = 10MB
  
EBookè¡¨ï¼š
  å­—æ®µæ•°ï¼š5ï¼ˆçˆ¶ç±»3 + å­ç±»2ï¼‰
  è®°å½•æ•°ï¼š50,000
  ä¼°ç®—å¤§å°ï¼š50,000 Ã— 200å­—èŠ‚ = 10MB

æ€»è®¡ï¼š20MB

JOINEDç­–ç•¥å­˜å‚¨ï¼š
Bookè¡¨ï¼š3å­—æ®µ Ã— 100,000æ¡ = 12MB
PaperBookè¡¨ï¼š2å­—æ®µ Ã— 50,000æ¡ = 4MB
EBookè¡¨ï¼š2å­—æ®µ Ã— 50,000æ¡ = 4MB
æ€»è®¡ï¼š20MB

ç»“è®ºï¼šå­˜å‚¨ç©ºé—´åŸºæœ¬ç›¸åŒ
```

---

## 5. ğŸ› ï¸ æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹


### 5.1 è®¾è®¡å»ºè®®


**ğŸ“‹ é€‰æ‹©TABLE_PER_CLASSçš„åˆ¤æ–­æ ‡å‡†**ï¼š

```
âœ… ç¬¦åˆä»¥ä¸‹æ¡ä»¶æ—¶æ¨èä½¿ç”¨ï¼š

1. ä¸šåŠ¡ç‰¹å¾æ£€æŸ¥ï¼š
   â–¡ 90%ä»¥ä¸Šçš„æŸ¥è¯¢éƒ½æ˜¯é’ˆå¯¹å…·ä½“å­ç±»
   â–¡ å¾ˆå°‘éœ€è¦æŸ¥è¯¢çˆ¶ç±»è·å–æ‰€æœ‰å­ç±»æ•°æ®
   â–¡ å­ç±»ä¹‹é—´ä¸šåŠ¡é€»è¾‘å·®å¼‚å¤§

2. æ•°æ®ç‰¹å¾æ£€æŸ¥ï¼š
   â–¡ å­ç±»ç‹¬æœ‰å­—æ®µæ•°é‡ > çˆ¶ç±»å…¬å…±å­—æ®µæ•°é‡
   â–¡ å­ç±»æ•°é‡ â‰¤ 5ä¸ªï¼ˆè¶Šå°‘è¶Šå¥½ï¼‰
   â–¡ å„å­ç±»æ•°æ®é‡ç›¸å¯¹ç‹¬ç«‹å’Œå‡è¡¡

3. æ€§èƒ½è¦æ±‚æ£€æŸ¥ï¼š
   â–¡ å¯¹å•ç±»æŸ¥è¯¢æ€§èƒ½è¦æ±‚é«˜
   â–¡ èƒ½æ¥å—å¤šæ€æŸ¥è¯¢æ€§èƒ½è¾ƒä½
   â–¡ æ•°æ®å†™å…¥é¢‘ç¹

ç¤ºä¾‹ï¼š
âœ… å‘˜å·¥ç®¡ç†ï¼ˆå…¨èŒã€å…¼èŒã€å®ä¹ ç”Ÿï¼‰
âœ… æ”¯ä»˜æ–¹å¼ï¼ˆä¿¡ç”¨å¡ã€å€Ÿè®°å¡ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜ï¼‰
âœ… æ–‡æ¡£ç±»å‹ï¼ˆWordã€Excelã€PDFï¼‰
```

**âŒ é¿å…ä½¿ç”¨çš„åœºæ™¯æ ‡å‡†**ï¼š

```
ä»¥ä¸‹æƒ…å†µä¸æ¨èä½¿ç”¨ï¼š

1. æŸ¥è¯¢æ¨¡å¼ï¼š
   âœ— é¢‘ç¹çš„æ··åˆæŸ¥è¯¢ï¼ˆéœ€è¦æ‰€æœ‰å­ç±»æ•°æ®ï¼‰
   âœ— å¤æ‚çš„å…³è”æŸ¥è¯¢ï¼ˆå¤šä¸ªå®ä½“å…³è”ï¼‰
   âœ— éœ€è¦å…¨å±€æ’åºæˆ–åˆ†é¡µ

2. æ•°æ®ç»“æ„ï¼š
   âœ— å­ç±»æ•°é‡ > 10ä¸ª
   âœ— çˆ¶ç±»å­—æ®µ > å­ç±»ç‹¬æœ‰å­—æ®µ
   âœ— å­ç±»ç»å¸¸éœ€è¦æ–°å¢

3. ä¸šåŠ¡éœ€æ±‚ï¼š
   âœ— éœ€è¦äº‹åŠ¡æ€§å¼ºçš„è·¨ç±»å‹æ“ä½œ
   âœ— éœ€è¦å¤æ‚çš„æŠ¥è¡¨å’Œç»Ÿè®¡
   âœ— éœ€è¦é¢‘ç¹çš„æ‰¹é‡æ“ä½œ
```

### 5.2 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸš€ ä¼˜åŒ–1ï¼šç¼“å­˜ç­–ç•¥**

```java
// ä¸ºæ¯ä¸ªå­ç±»å•ç‹¬é…ç½®ç¼“å­˜
@Entity
@Cacheable
@org.hibernate.annotations.Cache(
    usage = CacheConcurrencyStrategy.READ_WRITE
)
public class PaperBook extends Book {
    // ...
}

@Entity  
@Cacheable
@org.hibernate.annotations.Cache(
    usage = CacheConcurrencyStrategy.READ_WRITE
)
public class EBook extends Book {
    // ...
}
```

**ç¼“å­˜æ•ˆæœ**ï¼š
```
åœºæ™¯ï¼šé‡å¤æŸ¥è¯¢PaperBook id=1

ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼š
  â†’ æ•°æ®åº“æŸ¥è¯¢ï¼šSELECT * FROM PaperBook WHERE id=1
  â†’ è€—æ—¶ï¼š15ms
  â†’ åŠ å…¥ç¼“å­˜

ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼š
  â†’ ç›´æ¥ä»ç¼“å­˜è·å–
  â†’ è€—æ—¶ï¼š<1ms
  â†’ æ€§èƒ½æå‡ï¼š15å€

æ³¨æ„ï¼šTABLE_PER_CLASSä¸‹æ¯ä¸ªè¡¨å¯ä»¥ç‹¬ç«‹ç¼“å­˜ï¼Œæ•ˆæœå¥½
```

**ğŸš€ ä¼˜åŒ–2ï¼šç´¢å¼•ä¼˜åŒ–**

```sql
-- ä¸ºæ¯ä¸ªå­ç±»è¡¨åˆ›å»ºåˆé€‚çš„ç´¢å¼•
CREATE INDEX idx_paperbook_isbn ON PaperBook(isbn);
CREATE INDEX idx_paperbook_title ON PaperBook(title);
CREATE INDEX idx_paperbook_location ON PaperBook(location);

CREATE INDEX idx_ebook_isbn ON EBook(isbn);
CREATE INDEX idx_ebook_title ON EBook(title);
CREATE INDEX idx_ebook_url ON EBook(downloadUrl);
```

**ç´¢å¼•ç­–ç•¥è¯´æ˜**ï¼š
```
ä¼˜åŠ¿ï¼š
âœ… æ¯ä¸ªè¡¨å¯ä»¥æ ¹æ®è‡ªå·±çš„æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–ç´¢å¼•
âœ… ä¸å—å…¶ä»–å­ç±»å½±å“
âœ… ç´¢å¼•ç»´æŠ¤ç®€å•

ç¤ºä¾‹ï¼š
PaperBookç»å¸¸æŒ‰locationæŸ¥è¯¢ â†’ åŠ locationç´¢å¼•
EBookå¾ˆå°‘æŒ‰locationæŸ¥è¯¢ â†’ ä¸éœ€è¦è¯¥ç´¢å¼•

è¿™ç§çµæ´»æ€§æ˜¯TABLE_PER_CLASSçš„ä¼˜åŠ¿
```

**ğŸš€ ä¼˜åŒ–3ï¼šé¿å…å¤šæ€æŸ¥è¯¢**

```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨çˆ¶ç±»æŸ¥è¯¢
public List<Book> getAllBooks() {
    return em.createQuery("SELECT b FROM Book b", Book.class)
             .getResultList();
    // ç”Ÿæˆå¤æ‚çš„UNIONæŸ¥è¯¢ï¼Œæ€§èƒ½å·®
}

// âœ… å¥½çš„åšæ³•ï¼šåˆ†åˆ«æŸ¥è¯¢å†åˆå¹¶
public List<Book> getAllBooks() {
    List<Book> result = new ArrayList<>();
    
    // æŸ¥è¯¢çº¸è´¨ä¹¦
    result.addAll(em.createQuery(
        "SELECT p FROM PaperBook p", 
        PaperBook.class
    ).getResultList());
    
    // æŸ¥è¯¢ç”µå­ä¹¦
    result.addAll(em.createQuery(
        "SELECT e FROM EBook e", 
        EBook.class
    ).getResultList());
    
    return result;
}
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
æ•°æ®é‡ï¼šå„1ä¸‡æ¡

çˆ¶ç±»æŸ¥è¯¢æ–¹å¼ï¼š
  SQL: SELECT ... UNION ALL SELECT ...
  æ‰§è¡Œæ—¶é—´: 180ms
  
åˆ†åˆ«æŸ¥è¯¢æ–¹å¼ï¼š
  SQL1: SELECT ... FROM PaperBook (60ms)
  SQL2: SELECT ... FROM EBook (55ms)
  åˆå¹¶: (5ms)
  æ€»æ—¶é—´: 120ms
  
æ€§èƒ½æå‡: 33%
```

### 5.3 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ é—®é¢˜1ï¼šä¸»é”®å†²çª**

```
ç—‡çŠ¶ï¼š
org.hibernate.exception.ConstraintViolationException: 
could not execute statement; SQL [n/a]; 
constraint [PRIMARY KEY]; nested exception is...

åŸå› ï¼šä½¿ç”¨äº†é”™è¯¯çš„ä¸»é”®ç”Ÿæˆç­–ç•¥
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// âŒ é”™è¯¯é…ç½®
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
// IDENTITYç­–ç•¥ä¼šå¯¼è‡´ä¸åŒè¡¨çš„IDå¯èƒ½é‡å¤

// âœ… æ­£ç¡®é…ç½®
@Id
@GeneratedValue(strategy = GenerationType.TABLE)
private Long id;
// TABLEç­–ç•¥ä¿è¯å…¨å±€å”¯ä¸€

// âœ… æˆ–ä½¿ç”¨AUTOè®©JPAè‡ªåŠ¨é€‰æ‹©
@Id
@GeneratedValue(strategy = GenerationType.AUTO)
private Long id;
```

**â“ é—®é¢˜2ï¼šå¤šæ€å…³è”æŸ¥è¯¢æ…¢**

```java
// é—®é¢˜åœºæ™¯
@Entity
public class ShoppingCart {
    @Id
    private Long id;
    
    @ManyToMany
    private List<Book> books;  // å¤šæ€å…³è”
}

// æŸ¥è¯¢è´­ç‰©è½¦æ—¶å…³è”çš„Bookå¾ˆæ…¢
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨å…·ä½“ç±»å‹å…³è”
@Entity
public class ShoppingCart {
    @ManyToMany
    private List<PaperBook> paperBooks;
    
    @ManyToMany
    private List<EBook> eBooks;
    
    // æä¾›ç»Ÿä¸€è·å–æ–¹æ³•
    public List<Book> getAllBooks() {
        List<Book> all = new ArrayList<>();
        all.addAll(paperBooks);
        all.addAll(eBooks);
        return all;
    }
}

// æ–¹æ¡ˆ2ï¼šæ”¹ç”¨SINGLE_TABLEæˆ–JOINEDç­–ç•¥
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
public abstract class Book {
    // è¿™ç§æƒ…å†µä¸‹JOINEDç­–ç•¥æ›´åˆé€‚
}
```

**â“ é—®é¢˜3ï¼šæ‰¹é‡æ“ä½œæ•ˆç‡ä½**

```java
// é—®é¢˜ï¼šæ‰¹é‡æ›´æ–°æ‰€æœ‰ä¹¦çš„ä»·æ ¼
@Transactional
public void updateAllBookPrices(BigDecimal increment) {
    // âŒ ä½¿ç”¨çˆ¶ç±»æ›´æ–°
    em.createQuery("UPDATE Book b SET b.price = b.price + :inc")
      .setParameter("inc", increment)
      .executeUpdate();
    // ä¼šç”Ÿæˆå¤šä¸ªUPDATEè¯­å¥ï¼Œæ•ˆç‡ä½
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// âœ… åˆ†åˆ«æ›´æ–°å„ä¸ªå­ç±»
@Transactional
public void updateAllBookPrices(BigDecimal increment) {
    // æ›´æ–°çº¸è´¨ä¹¦
    em.createQuery("UPDATE PaperBook p SET p.price = p.price + :inc")
      .setParameter("inc", increment)
      .executeUpdate();
    
    // æ›´æ–°ç”µå­ä¹¦
    em.createQuery("UPDATE EBook e SET e.price = e.price + :inc")
      .setParameter("inc", increment)
      .executeUpdate();
}

// ä¼˜åŠ¿ï¼š
// âœ… æ¯ä¸ªUPDATEéƒ½æ˜¯ç®€å•çš„å•è¡¨æ“ä½œ
// âœ… å¯ä»¥åˆ©ç”¨è¡¨ç´¢å¼•
// âœ… å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å…³é”®æ¦‚å¿µå›é¡¾


```
ğŸ¯ TABLE_PER_CLASSæ ¸å¿ƒç‰¹ç‚¹ï¼š

1ï¸âƒ£ è¡¨ç»“æ„ï¼š
   æ¯ä¸ªå…·ä½“ç±» = ä¸€ä¸ªå®Œæ•´çš„ç‹¬ç«‹è¡¨
   åŒ…å«ï¼šçˆ¶ç±»å­—æ®µ + è‡ªå·±çš„å­—æ®µ

2ï¸âƒ£ æ•°æ®å­˜å‚¨ï¼š
   âœ… å®Œå…¨ç‹¬ç«‹ï¼Œæ— å…³è”
   âœ… ä¸€è¡Œè®°å½•åŒ…å«æ‰€æœ‰æ•°æ®
   âŒ çˆ¶ç±»å­—æ®µåœ¨æ¯ä¸ªè¡¨é‡å¤

3ï¸âƒ£ æŸ¥è¯¢ç‰¹ç‚¹ï¼š
   âœ… å•ç±»æŸ¥è¯¢ï¼šç®€å•é«˜æ•ˆï¼Œå•è¡¨æ“ä½œ
   âŒ çˆ¶ç±»æŸ¥è¯¢ï¼šå¤æ‚ä½æ•ˆï¼Œéœ€è¦UNION

4ï¸âƒ£ ä¸»é”®è¦æ±‚ï¼š
   å¿…é¡»å…¨å±€å”¯ä¸€ï¼Œæ¨èä½¿ç”¨TABLEæˆ–AUTOç­–ç•¥
```

### 6.2 ä½¿ç”¨å†³ç­–æ ‘


```
æ˜¯å¦ä½¿ç”¨TABLE_PER_CLASSï¼Ÿ

å¼€å§‹
  â”‚
  â”œâ”€â†’ å­ç±»æ•°é‡ > 10ä¸ªï¼Ÿ
  â”‚   â””â”€â†’ æ˜¯ â†’ âŒ ä¸å»ºè®®ä½¿ç”¨
  â”‚   â””â”€â†’ å¦ â†’ ç»§ç»­
  â”‚
  â”œâ”€â†’ ç»å¸¸æŸ¥è¯¢çˆ¶ç±»è·å–æ‰€æœ‰å­ç±»ï¼Ÿ
  â”‚   â””â”€â†’ æ˜¯ â†’ âŒ ä¸å»ºè®®ä½¿ç”¨
  â”‚   â””â”€â†’ å¦ â†’ ç»§ç»­
  â”‚
  â”œâ”€â†’ å­ç±»å·®å¼‚å¾ˆå¤§ï¼Ÿ
  â”‚   â””â”€â†’ æ˜¯ â†’ ç»§ç»­
  â”‚   â””â”€â†’ å¦ â†’ âš ï¸ è€ƒè™‘å…¶ä»–ç­–ç•¥
  â”‚
  â”œâ”€â†’ å¤§éƒ¨åˆ†æŸ¥è¯¢é’ˆå¯¹å…·ä½“å­ç±»ï¼Ÿ
  â”‚   â””â”€â†’ æ˜¯ â†’ âœ… æ¨èä½¿ç”¨
  â”‚   â””â”€â†’ å¦ â†’ âŒ ä¸å»ºè®®ä½¿ç”¨
```

### 6.3 æ€§èƒ½æƒè¡¡æ€»ç»“


**ğŸ“Š ç»¼åˆæ€§èƒ½å¯¹æ¯”**ï¼š

| æ“ä½œç±»å‹ | TABLE_PER_CLASS | SINGLE_TABLE | JOINED |
|---------|-----------------|--------------|---------|
| **å•ç±»æŸ¥è¯¢** | â­â­â­â­â­ æœ€å¿« | â­â­â­â­ å¿« | â­â­â­ ä¸­ç­‰ |
| **çˆ¶ç±»æŸ¥è¯¢** | â­â­ æ…¢ | â­â­â­â­â­ æœ€å¿« | â­â­â­â­ å¿« |
| **æ•°æ®æ’å…¥** | â­â­â­â­â­ æœ€å¿« | â­â­â­â­ å¿« | â­â­â­ ä¸­ç­‰ |
| **å¤šæ€å…³è”** | â­ å¾ˆæ…¢ | â­â­â­â­â­ æœ€å¿« | â­â­â­â­ å¿« |
| **å­˜å‚¨ç©ºé—´** | â­â­â­ ä¸­ç­‰ | â­â­â­â­ è¾ƒå¥½ | â­â­â­â­â­ æœ€ä¼˜ |

### 6.4 æœ€ä½³å®è·µæ¸…å•


```
âœ… æ¨èåšæ³•ï¼š

â–¡ å­ç±»æ•°é‡æ§åˆ¶åœ¨5ä¸ªä»¥å†…
â–¡ ä½¿ç”¨TABLEæˆ–AUTOä¸»é”®ç”Ÿæˆç­–ç•¥
â–¡ ä¸ºæ¯ä¸ªå­ç±»è¡¨åˆ›å»ºåˆé€‚çš„ç´¢å¼•
â–¡ å¯ç”¨äºŒçº§ç¼“å­˜æå‡æŸ¥è¯¢æ€§èƒ½
â–¡ é¿å…ä½¿ç”¨çˆ¶ç±»è¿›è¡ŒæŸ¥è¯¢
â–¡ å°½é‡ä½¿ç”¨å…·ä½“ç±»å‹å…³è”
â–¡ æ‰¹é‡æ“ä½œæ—¶åˆ†åˆ«å¤„ç†å„å­ç±»

âŒ é¿å…åšæ³•ï¼š

â–¡ é¢‘ç¹çš„çˆ¶ç±»å¤šæ€æŸ¥è¯¢
â–¡ ä½¿ç”¨IDENTITYä¸»é”®ç­–ç•¥
â–¡ åˆ›å»ºå¤§é‡å­ç±»ï¼ˆ>10ä¸ªï¼‰
â–¡ å¤æ‚çš„å¤šæ€å…³è”å…³ç³»
â–¡ å¿½è§†ç´¢å¼•ä¼˜åŒ–
â–¡ åœ¨çˆ¶ç±»ä¸Šæ‰§è¡Œæ‰¹é‡æ›´æ–°
```

### 6.5 è®°å¿†è¦ç‚¹


**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ¯ç±»ä¸€è¡¨æœ€ç‹¬ç«‹ï¼Œ
å®Œæ•´æ•°æ®å„è‡ªå­˜ã€‚
å•æŸ¥é«˜æ•ˆå¤šæŸ¥æ…¢ï¼Œ
å­ç±»ä¸å¤šæ‰é€‚ç”¨ã€‚
ä¸»é”®å…¨å±€é¡»å”¯ä¸€ï¼Œ
ç´¢å¼•ç¼“å­˜åˆ†åˆ«ä¼˜ã€‚
```

**ğŸ”‘ å…³é”®ç†è§£ç‚¹**ï¼š
- **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªè¡¨éƒ½æ˜¯è‡ªç»™è‡ªè¶³çš„å®Œæ•´æ•°æ®å­˜å‚¨
- **é€‚ç”¨æ€§**ï¼šé€‚åˆå­ç±»å·®å¼‚å¤§ã€ç‹¬ç«‹æŸ¥è¯¢ä¸ºä¸»çš„åœºæ™¯
- **æƒè¡¡ç‚¹**ï¼šç”¨å¤šæ€æŸ¥è¯¢æ€§èƒ½æ¢å–å•ç±»æŸ¥è¯¢æ€§èƒ½
- **ä¼˜åŒ–ç‚¹**ï¼šç¼“å­˜ã€ç´¢å¼•ã€é¿å…UNIONæ˜¯å…³é”®

---

**ğŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
1. å…ˆç†è§£ä¸‰ç§ç»§æ‰¿ç­–ç•¥çš„æ ¹æœ¬åŒºåˆ«
2. é€šè¿‡å®é™…é¡¹ç›®åœºæ™¯ç»ƒä¹ ç­–ç•¥é€‰æ‹©
3. å…³æ³¨SQLç”Ÿæˆï¼Œç†è§£æ€§èƒ½å·®å¼‚æ ¹æº
4. æŒæ¡ä¼˜åŒ–æŠ€å·§ï¼Œåœ¨å®è·µä¸­åº”ç”¨