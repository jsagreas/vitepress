---
title: 78ã€å¤§äº‹åŠ¡æ‹†åˆ†ä¸å¹‚ç­‰
---
## ğŸ“š ç›®å½•

1. [å¤§äº‹åŠ¡é—®é¢˜æ¦‚è¿°](#1-å¤§äº‹åŠ¡é—®é¢˜æ¦‚è¿°)
2. [äº‹åŠ¡æ‹†åˆ†ç­–ç•¥](#2-äº‹åŠ¡æ‹†åˆ†ç­–ç•¥)
3. [åˆ†æ®µæäº¤æ¨¡å¼](#3-åˆ†æ®µæäº¤æ¨¡å¼)
4. [å¹‚ç­‰æ€§è®¾è®¡](#4-å¹‚ç­‰æ€§è®¾è®¡)
5. [é‡è¯•å®‰å…¨æœºåˆ¶](#5-é‡è¯•å®‰å…¨æœºåˆ¶)
6. [è¡¥å¿äº‹åŠ¡å¤„ç†](#6-è¡¥å¿äº‹åŠ¡å¤„ç†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” å¤§äº‹åŠ¡é—®é¢˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¤§äº‹åŠ¡


**é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ä½ å»é“¶è¡ŒåŠç†ä¸šåŠ¡ï¼š
å°äº‹åŠ¡ï¼šå•ç¬”è½¬è´¦ï¼Œå‡ ç§’é’Ÿæå®š âœ…
å¤§äº‹åŠ¡ï¼šæ‰¹é‡å¤„ç†1000ç¬”è½¬è´¦ï¼Œå ç”¨çª—å£åŠå°æ—¶ âŒ

é—®é¢˜ï¼š
â€¢ å…¶ä»–äººæ’é˜Ÿç­‰å¾…ï¼ˆèµ„æºè¢«é”å®šï¼‰
â€¢ ä¸­é€”å‡ºé”™å…¨éƒ¨ä½œåºŸï¼ˆå¤±è´¥æˆæœ¬é«˜ï¼‰
â€¢ é“¶è¡Œå‹åŠ›å¤§ï¼ˆæ•°æ®åº“è´Ÿæ‹…é‡ï¼‰
```

**ä¸“ä¸šå®šä¹‰**ï¼š
- **å¤§äº‹åŠ¡**ï¼šæ‰§è¡Œæ—¶é—´é•¿ã€æ“ä½œæ•°æ®é‡å¤§çš„æ•°æ®åº“äº‹åŠ¡
- **æ ¸å¿ƒé—®é¢˜**ï¼šé•¿æ—¶é—´å ç”¨æ•°æ®åº“è¿æ¥å’Œé”èµ„æº

### 1.2 å¤§äº‹åŠ¡çš„å±å®³


**å…¸å‹å±å®³è¡¨ç°**ï¼š

| é—®é¢˜ç±»å‹ | å…·ä½“è¡¨ç° | å½±å“ç¨‹åº¦ |
|---------|---------|---------|
| ğŸ”’ **é”ç«äº‰** | é•¿æ—¶é—´æŒæœ‰è¡Œé”/è¡¨é” | å…¶ä»–äº‹åŠ¡é˜»å¡ç­‰å¾… |
| ğŸ’¾ **å†…å­˜å ç”¨** | å¤§é‡æ•°æ®åœ¨å†…å­˜ä¸­ | å¯èƒ½å¯¼è‡´OOM |
| â±ï¸ **è¶…æ—¶é£é™©** | æ‰§è¡Œæ—¶é—´è¿‡é•¿ | äº‹åŠ¡å›æ»šï¼Œå‰åŠŸå°½å¼ƒ |
| ğŸ“‰ **æ€§èƒ½ä¸‹é™** | æ•°æ®åº“å‹åŠ›å¤§ | æ•´ä½“å“åº”å˜æ…¢ |
| ğŸ”„ **æ¢å¤å›°éš¾** | å¤±è´¥åé‡è¯•ä»£ä»·é«˜ | èµ„æºæµªè´¹ä¸¥é‡ |

**å®é™…æ¡ˆä¾‹**ï¼š
```
âŒ å…¸å‹çš„å¤§äº‹åŠ¡åœºæ™¯ï¼š
- æ‰¹é‡å¯¼å…¥10ä¸‡æ¡ç”¨æˆ·æ•°æ®
- æœˆåº•æ‰¹é‡ç»“ç®—æ‰€æœ‰è®¢å•
- æ•°æ®è¿ç§»/æ¸…ç†æ“ä½œ
- å¤æ‚çš„æŠ¥è¡¨ç»Ÿè®¡è®¡ç®—

ç»“æœï¼š
â†’ æ‰§è¡Œ1å°æ—¶ï¼Œå ç”¨æ•°æ®åº“è¿æ¥
â†’ å…¶ä»–ä¸šåŠ¡å‡ ä¹æ— æ³•ä½¿ç”¨
â†’ å‡ºé”™åå…¨éƒ¨å›æ»šï¼Œé‡æ–°å¼€å§‹
```

### 1.3 åˆ¤æ–­å¤§äº‹åŠ¡çš„æ ‡å‡†


**é‡åŒ–æŒ‡æ ‡**ï¼š

```
âš ï¸ éœ€è¦æ‹†åˆ†çš„ä¿¡å·ï¼š

æ—¶é—´ç»´åº¦ï¼š
â€¢ æ‰§è¡Œæ—¶é—´ > 5ç§’
â€¢ æ¶‰åŠå¤šä¸ªè¿œç¨‹è°ƒç”¨
â€¢ åŒ…å«å¤æ‚è®¡ç®—é€»è¾‘

æ•°æ®ç»´åº¦ï¼š
â€¢ å¤„ç†è®°å½•æ•° > 1000æ¡
â€¢ ä¿®æ”¹çš„æ•°æ®è¡Œ > 500è¡Œ
â€¢ æ¶‰åŠå¤šå¼ å¤§è¡¨å…³è”

èµ„æºç»´åº¦ï¼š
â€¢ é•¿æ—¶é—´æŒæœ‰é”
â€¢ å†…å­˜å ç”¨ > 100MB
â€¢ é˜»å¡å…¶ä»–äº‹åŠ¡
```

---

## 2. âš™ï¸ äº‹åŠ¡æ‹†åˆ†ç­–ç•¥


### 2.1 æ‹†åˆ†çš„æ ¸å¿ƒæ€æƒ³


**è®¾è®¡åŸåˆ™**ï¼š
```
å¤§äº‹åŠ¡æ‹†åˆ†å°±åƒæ¬å®¶ï¼š

âŒ é”™è¯¯åšæ³•ï¼šä¸€æ¬¡æ¬å®Œæ‰€æœ‰ä¸œè¥¿
- ç´¯æ­»äººï¼Œä¸­é€”å‡ºé”™å‰åŠŸå°½å¼ƒ

âœ… æ­£ç¡®åšæ³•ï¼šåˆ†æ‰¹æ¬¡æ¬è¿
- æ¯æ¬¡æ¬ä¸€è½¦ï¼Œç´¯äº†ä¼‘æ¯
- æŸæ‰¹æ¬¡å‡ºé”™åªå½±å“è¯¥æ‰¹æ¬¡
- éšæ—¶å¯ä»¥æš‚åœå’Œæ¢å¤
```

**æ‹†åˆ†æ ¸å¿ƒ**ï¼š
- **ç©ºé—´æ‹†åˆ†**ï¼šæŒ‰æ•°æ®èŒƒå›´åˆ†å‰²ï¼ˆå¦‚æŒ‰IDåŒºé—´ï¼‰
- **æ—¶é—´æ‹†åˆ†**ï¼šæŒ‰æ—¶é—´çª—å£åˆ†æ‰¹ï¼ˆå¦‚æ¯å°æ—¶ä¸€æ‰¹ï¼‰
- **ä¸šåŠ¡æ‹†åˆ†**ï¼šæŒ‰ä¸šåŠ¡é€»è¾‘æ‹†åˆ†ï¼ˆå¦‚æŒ‰è®¢å•çŠ¶æ€ï¼‰

### 2.2 æŒ‰æ•°æ®é‡æ‹†åˆ†


**æ‰¹æ¬¡å¤„ç†æ¨¡å¼**ï¼š

```java
// âŒ å¤§äº‹åŠ¡ï¼šä¸€æ¬¡å¤„ç†æ‰€æœ‰æ•°æ®
@Transactional
public void processAllOrders() {
    List<Order> allOrders = orderRepository.findAll(); // 10ä¸‡æ¡
    for (Order order : allOrders) {
        // å¤æ‚ä¸šåŠ¡é€»è¾‘
        calculateAndUpdate(order);
    }
    // é£é™©ï¼šæ‰§è¡Œæ—¶é—´é•¿ï¼Œå†…å­˜å ç”¨å¤§ï¼Œå¤±è´¥ä»£ä»·é«˜
}

// âœ… å°äº‹åŠ¡ï¼šåˆ†æ‰¹å¤„ç†
public void processOrdersInBatch() {
    int pageSize = 100;  // æ¯æ‰¹100æ¡
    int pageNum = 0;
    
    while (true) {
        // æ¯æ‰¹å¼€å¯ç‹¬ç«‹äº‹åŠ¡
        List<Order> batch = processSingleBatch(pageNum, pageSize);
        if (batch.isEmpty()) {
            break;  // å¤„ç†å®Œæ¯•
        }
        pageNum++;
        
        // å¯é€‰ï¼šæ‰¹æ¬¡é—´ä¼‘æ¯ï¼Œé‡Šæ”¾èµ„æº
        Thread.sleep(100);
    }
}

@Transactional
public List<Order> processSingleBatch(int pageNum, int pageSize) {
    PageRequest page = PageRequest.of(pageNum, pageSize);
    List<Order> orders = orderRepository.findPendingOrders(page);
    
    for (Order order : orders) {
        calculateAndUpdate(order);
    }
    return orders;
}
```

**å…³é”®ç‚¹è¯´æ˜**ï¼š
- æ¯æ‰¹ç‹¬ç«‹äº‹åŠ¡ï¼Œå¤±è´¥åªå½±å“å½“å‰æ‰¹æ¬¡
- å¯ä»¥è®°å½•è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
- æ‰¹æ¬¡é—´å¯ä»¥ä¼‘æ¯ï¼Œé¿å…æŒç»­é«˜è´Ÿè½½

### 2.3 æŒ‰ä¸šåŠ¡é€»è¾‘æ‹†åˆ†


**ç¤ºä¾‹ï¼šè®¢å•å¤„ç†æµç¨‹æ‹†åˆ†**

```
åŸå§‹å¤§äº‹åŠ¡ï¼ˆä¸€ä¸ªæ–¹æ³•å®Œæˆæ‰€æœ‰ï¼‰ï¼š
åˆ›å»ºè®¢å• â†’ æ‰£å‡åº“å­˜ â†’ æ‰£å‡ç§¯åˆ† â†’ å‘é€é€šçŸ¥ â†’ è®°å½•æ—¥å¿—
[------------ ä¸€ä¸ªäº‹åŠ¡ï¼Œå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥ ------------]

æ‹†åˆ†åçš„å¤šä¸ªå°äº‹åŠ¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ äº‹åŠ¡1:   â”‚ â†’ â”‚ äº‹åŠ¡2:   â”‚ â†’ â”‚ äº‹åŠ¡3:   â”‚
â”‚ åˆ›å»ºè®¢å• â”‚   â”‚ æ‰£å‡åº“å­˜ â”‚   â”‚ æ‰£å‡ç§¯åˆ† â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ å¼‚æ­¥å¤„ç†:    â”‚
                              â”‚ å‘é€é€šçŸ¥/æ—¥å¿—â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç å®ç°**ï¼š

```java
// ä¸»æµç¨‹ï¼šç¼–æ’å„ä¸ªå°äº‹åŠ¡
public OrderResult createOrder(OrderRequest request) {
    // ç¬¬1æ­¥ï¼šåˆ›å»ºè®¢å•ï¼ˆæ ¸å¿ƒäº‹åŠ¡ï¼‰
    Order order = orderService.createOrderRecord(request);
    
    try {
        // ç¬¬2æ­¥ï¼šæ‰£å‡åº“å­˜ï¼ˆç‹¬ç«‹äº‹åŠ¡ï¼‰
        inventoryService.decreaseStock(order.getItems());
        
        // ç¬¬3æ­¥ï¼šæ‰£å‡ç§¯åˆ†ï¼ˆç‹¬ç«‹äº‹åŠ¡ï¼‰
        pointService.decreasePoints(order.getUserId(), order.getPoints());
        
        // ç¬¬4æ­¥ï¼šå¼‚æ­¥å‘é€é€šçŸ¥ï¼ˆéäº‹åŠ¡æ€§ï¼‰
        notificationService.sendOrderNotification(order);
        
        return OrderResult.success(order);
        
    } catch (Exception e) {
        // å‘èµ·è¡¥å¿ï¼šå›æ»šå·²å®Œæˆçš„æ­¥éª¤
        compensateOrder(order);
        return OrderResult.failed(e.getMessage());
    }
}

// æ¯ä¸ªæ­¥éª¤æ˜¯ç‹¬ç«‹çš„å°äº‹åŠ¡
@Transactional
public Order createOrderRecord(OrderRequest request) {
    Order order = new Order();
    // è®¾ç½®è®¢å•ä¿¡æ¯
    return orderRepository.save(order);
}

@Transactional
public void decreaseStock(List<OrderItem> items) {
    for (OrderItem item : items) {
        Product product = productRepository.findById(item.getProductId())
            .orElseThrow(() -> new RuntimeException("å•†å“ä¸å­˜åœ¨"));
        
        if (product.getStock() < item.getQuantity()) {
            throw new RuntimeException("åº“å­˜ä¸è¶³");
        }
        product.setStock(product.getStock() - item.getQuantity());
    }
}
```

---

## 3. ğŸ“¦ åˆ†æ®µæäº¤æ¨¡å¼


### 3.1 åˆ†æ®µæäº¤çš„æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼š
```
åˆ†æ®µæäº¤å°±åƒæ‰“æ¸¸æˆçš„å­˜æ¡£ç‚¹ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼šä»å¤´æ‰“åˆ°å°¾ï¼Œæ­»äº†é‡æ–°å¼€å§‹ âŒ
åˆ†æ®µæäº¤ï¼šæ¯å…³å­˜æ¡£ï¼Œæ­»äº†ä»æœ€è¿‘å­˜æ¡£ç»§ç»­ âœ…

å¥½å¤„ï¼š
â€¢ è¿›åº¦å¯ä¿å­˜
â€¢ å¤±è´¥å½±å“å°
â€¢ éšæ—¶å¯æ¢å¤
```

### 3.2 æ¸¸æ ‡åˆ†é¡µå¤„ç†


**é€‚ç”¨åœºæ™¯**ï¼šå¤„ç†å¤§é‡æ•°æ®ï¼Œéœ€è¦é€æ¡æˆ–åˆ†æ‰¹å¤„ç†

```java
@Service
public class DataMigrationService {
    
    @PersistenceContext
    private EntityManager entityManager;
    
    /**
     * ä½¿ç”¨æ¸¸æ ‡åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
     */
    public void migrateDataInChunks() {
        int batchSize = 500;
        int processedCount = 0;
        
        // åˆ›å»ºæŸ¥è¯¢
        String jpql = "SELECT o FROM OldData o WHERE o.migrated = false";
        TypedQuery<OldData> query = entityManager.createQuery(jpql, OldData.class);
        
        // è®¾ç½®æ¯æ‰¹å¤§å°
        query.setMaxResults(batchSize);
        
        while (true) {
            // æ¯æ‰¹åœ¨ç‹¬ç«‹äº‹åŠ¡ä¸­å¤„ç†
            int count = processOneBatch(query, batchSize);
            processedCount += count;
            
            System.out.println("å·²å¤„ç†: " + processedCount + " æ¡");
            
            if (count < batchSize) {
                break;  // å¤„ç†å®Œæ¯•
            }
            
            // æ¸…ç†JPAç¼“å­˜ï¼Œé¿å…å†…å­˜æº¢å‡º
            entityManager.clear();
        }
    }
    
    @Transactional
    public int processOneBatch(TypedQuery<OldData> query, int batchSize) {
        List<OldData> batch = query.getResultList();
        
        for (OldData old : batch) {
            // è½¬æ¢å¹¶ä¿å­˜åˆ°æ–°è¡¨
            NewData newData = convertToNew(old);
            entityManager.persist(newData);
            
            // æ ‡è®°å·²è¿ç§»
            old.setMigrated(true);
        }
        
        return batch.size();
    }
}
```

**å…³é”®æŠ€å·§**ï¼š
- æ¯æ‰¹ç‹¬ç«‹äº‹åŠ¡ï¼Œé¿å…é”ç«äº‰
- ä½¿ç”¨ `entityManager.clear()` æ¸…ç†ç¼“å­˜
- è®°å½•å¤„ç†è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 

### 3.3 è¿›åº¦è¿½è¸ªä¸æ¢å¤


**è¿›åº¦è®°å½•è¡¨è®¾è®¡**ï¼š

```java
@Entity
public class BatchJobProgress {
    @Id
    private String jobId;              // ä»»åŠ¡ID
    private String jobType;            // ä»»åŠ¡ç±»å‹
    private Long lastProcessedId;      // æœ€åå¤„ç†çš„ID
    private Integer processedCount;    // å·²å¤„ç†æ•°é‡
    private String status;             // çŠ¶æ€ï¼šRUNNING/PAUSED/COMPLETED
    private LocalDateTime updateTime;  // æ›´æ–°æ—¶é—´
}

// å¯æ¢å¤çš„æ‰¹å¤„ç†ä»»åŠ¡
@Service
public class ResumableBatchService {
    
    public void processWithProgress(String jobId) {
        // è·å–æˆ–åˆ›å»ºè¿›åº¦è®°å½•
        BatchJobProgress progress = getOrCreateProgress(jobId);
        
        Long startId = progress.getLastProcessedId();
        int batchSize = 100;
        
        while (true) {
            List<Data> batch = fetchNextBatch(startId, batchSize);
            if (batch.isEmpty()) {
                progress.setStatus("COMPLETED");
                break;
            }
            
            // å¤„ç†æ‰¹æ¬¡
            processBatch(batch);
            
            // æ›´æ–°è¿›åº¦
            startId = batch.get(batch.size() - 1).getId();
            progress.setLastProcessedId(startId);
            progress.setProcessedCount(progress.getProcessedCount() + batch.size());
            saveProgress(progress);
        }
    }
    
    @Transactional
    public void processBatch(List<Data> batch) {
        // æ‰¹æ¬¡å¤„ç†é€»è¾‘
        for (Data data : batch) {
            process(data);
        }
    }
}
```

---

## 4. ğŸ”„ å¹‚ç­‰æ€§è®¾è®¡


### 4.1 ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
```
å¹‚ç­‰æ€§å°±åƒç”µæ¢¯æŒ‰é’®ï¼š

âŒ éå¹‚ç­‰ï¼šæŒ‰ä¸€æ¬¡åˆ°1æ¥¼ï¼ŒæŒ‰ä¸¤æ¬¡åˆ°2æ¥¼
âœ… å¹‚ç­‰çš„ï¼šæŒ‰ä¸€æ¬¡åˆ°1æ¥¼ï¼ŒæŒ‰å¤šæ¬¡è¿˜æ˜¯åˆ°1æ¥¼

åœ¨ç¼–ç¨‹ä¸­ï¼š
â€¢ åŒæ ·çš„æ“ä½œï¼Œæ‰§è¡Œ1æ¬¡å’Œ100æ¬¡æ•ˆæœç›¸åŒ
â€¢ ä¸ä¼šå› ä¸ºé‡å¤æ‰§è¡Œäº§ç”Ÿå‰¯ä½œç”¨
```

**ä¸ºä»€ä¹ˆéœ€è¦å¹‚ç­‰**ï¼š
- ç½‘ç»œé‡è¯•å¯èƒ½å¯¼è‡´é‡å¤è¯·æ±‚
- åˆ†å¸ƒå¼ç³»ç»Ÿæ¶ˆæ¯å¯èƒ½é‡å¤æŠ•é€’
- ç”¨æˆ·å¯èƒ½é‡å¤ç‚¹å‡»æäº¤æŒ‰é’®

### 4.2 å¹‚ç­‰è®¾è®¡æ–¹æ¡ˆ


**æ–¹æ¡ˆ1ï¼šå”¯ä¸€æ€§çº¦æŸ**

```java
@Entity
public class PaymentRecord {
    @Id
    private Long id;
    
    @Column(unique = true)
    private String orderId;      // è®¢å•IDï¼ˆä¸šåŠ¡å”¯ä¸€é”®ï¼‰
    
    private BigDecimal amount;
    private String status;
}

@Service
public class PaymentService {
    
    @Transactional
    public void processPayment(String orderId, BigDecimal amount) {
        // å°è¯•æ’å…¥æ”¯ä»˜è®°å½•
        try {
            PaymentRecord record = new PaymentRecord();
            record.setOrderId(orderId);
            record.setAmount(amount);
            record.setStatus("SUCCESS");
            
            paymentRepository.save(record);  // é‡å¤ä¼šæŠ›å¼‚å¸¸
            
        } catch (DataIntegrityViolationException e) {
            // å·²ç»æ”¯ä»˜è¿‡ï¼Œç›´æ¥è¿”å›
            System.out.println("è®¢å•å·²æ”¯ä»˜ï¼Œå¿½ç•¥é‡å¤è¯·æ±‚");
        }
    }
}
```

**æ–¹æ¡ˆ2ï¼šçŠ¶æ€æœºæ§åˆ¶**

```java
@Entity
public class Order {
    @Id
    private Long id;
    
    @Enumerated(EnumType.STRING)
    private OrderStatus status;  // è®¢å•çŠ¶æ€
}

public enum OrderStatus {
    CREATED,      // å·²åˆ›å»º
    PAID,         // å·²æ”¯ä»˜
    DELIVERED,    // å·²å‘è´§
    COMPLETED     // å·²å®Œæˆ
}

@Service
public class OrderService {
    
    @Transactional
    public void payOrder(Long orderId) {
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new RuntimeException("è®¢å•ä¸å­˜åœ¨"));
        
        // çŠ¶æ€æ£€æŸ¥ï¼šåªæœ‰æœªæ”¯ä»˜æ‰èƒ½æ”¯ä»˜
        if (order.getStatus() != OrderStatus.CREATED) {
            System.out.println("è®¢å•çŠ¶æ€ä¸å…è®¸æ”¯ä»˜: " + order.getStatus());
            return;  // å¹‚ç­‰è¿”å›
        }
        
        // æ‰§è¡Œæ”¯ä»˜é€»è¾‘
        doPayment(order);
        
        // æ›´æ–°çŠ¶æ€
        order.setStatus(OrderStatus.PAID);
    }
}
```

**æ–¹æ¡ˆ3ï¼šå¹‚ç­‰ä»¤ç‰Œ**

```java
@Service
public class IdempotentService {
    
    @Autowired
    private RedisTemplate<String, String> redis;
    
    /**
     * åŸºäºTokençš„å¹‚ç­‰æ§åˆ¶
     */
    @Transactional
    public void processWithToken(String token, Runnable action) {
        String key = "idempotent:token:" + token;
        
        // å°è¯•è®¾ç½®tokenï¼ˆä»…å½“ä¸å­˜åœ¨æ—¶æˆåŠŸï¼‰
        Boolean success = redis.opsForValue().setIfAbsent(
            key, "PROCESSING", 10, TimeUnit.MINUTES
        );
        
        if (!success) {
            System.out.println("é‡å¤è¯·æ±‚ï¼Œtokenå·²ä½¿ç”¨: " + token);
            return;  // å¹‚ç­‰è¿”å›
        }
        
        try {
            // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            action.run();
            
            // æ ‡è®°ä¸ºå·²å®Œæˆ
            redis.opsForValue().set(key, "COMPLETED", 1, TimeUnit.HOURS);
            
        } catch (Exception e) {
            // å¤±è´¥æ—¶åˆ é™¤tokenï¼Œå…è®¸é‡è¯•
            redis.delete(key);
            throw e;
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public void createOrder(CreateOrderRequest request) {
    String token = request.getIdempotentToken();  // å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€token
    
    idempotentService.processWithToken(token, () -> {
        // å®é™…çš„è®¢å•åˆ›å»ºé€»è¾‘
        Order order = new Order();
        // ...
        orderRepository.save(order);
    });
}
```

---

## 5. ğŸ” é‡è¯•å®‰å…¨æœºåˆ¶


### 5.1 ä¹è§‚é”é‡è¯•æµç¨‹


**ä¹è§‚é”åŸç†**ï¼š
```
ä¹è§‚é”å°±åƒæŠ¢åº§ä½ï¼š

1. çœ‹åˆ°åº§ä½ç©ºç€ï¼ˆè¯»å–versionï¼‰
2. èµ°è¿‡å»åä¸‹ï¼ˆä¿®æ”¹æ•°æ®ï¼‰
3. åä¸‹æ—¶æ£€æŸ¥ï¼šåˆ«äººæ˜¯å¦å·²ç»åäº†ï¼ˆæ¯”å¯¹versionï¼‰
   - å¦‚æœè¿˜æ˜¯ç©ºçš„ï¼šæˆåŠŸåä¸‹ âœ…
   - å¦‚æœè¢«å äº†ï¼šé‡æ–°æ‰¾ä½ç½® ğŸ”„
```

**ä»£ç å®ç°**ï¼š

```java
@Entity
public class Product {
    @Id
    private Long id;
    
    private String name;
    private Integer stock;      // åº“å­˜
    
    @Version
    private Integer version;    // ä¹è§‚é”ç‰ˆæœ¬å·
}

@Service
public class StockService {
    
    private static final int MAX_RETRY = 3;  // æœ€å¤§é‡è¯•æ¬¡æ•°
    
    /**
     * å¸¦é‡è¯•çš„æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ï¼‰
     */
    public void decreaseStockWithRetry(Long productId, int quantity) {
        int retryCount = 0;
        
        while (retryCount < MAX_RETRY) {
            try {
                // å°è¯•æ‰£å‡åº“å­˜
                decreaseStock(productId, quantity);
                return;  // æˆåŠŸï¼Œé€€å‡º
                
            } catch (OptimisticLockException e) {
                retryCount++;
                System.out.println("ä¹è§‚é”å†²çªï¼Œç¬¬" + retryCount + "æ¬¡é‡è¯•");
                
                if (retryCount >= MAX_RETRY) {
                    throw new RuntimeException("æ‰£å‡åº“å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
                }
                
                // çŸ­æš‚ç­‰å¾…åé‡è¯•
                try {
                    Thread.sleep(50 * retryCount);  // é€’å¢ç­‰å¾…æ—¶é—´
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                }
            }
        }
    }
    
    @Transactional
    public void decreaseStock(Long productId, int quantity) {
        Product product = productRepository.findById(productId)
            .orElseThrow(() -> new RuntimeException("å•†å“ä¸å­˜åœ¨"));
        
        if (product.getStock() < quantity) {
            throw new RuntimeException("åº“å­˜ä¸è¶³");
        }
        
        // æ‰£å‡åº“å­˜ï¼ˆä¼šè‡ªåŠ¨æ£€æŸ¥versionï¼‰
        product.setStock(product.getStock() - quantity);
        // JPAä¼šè‡ªåŠ¨é€’å¢versionï¼Œå¹¶åœ¨æ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·
    }
}
```

**é‡è¯•ç­–ç•¥ä¼˜åŒ–**ï¼š

```java
@Service
public class RetryableService {
    
    /**
     * ä½¿ç”¨Spring Retryçš„é‡è¯•æœºåˆ¶
     */
    @Retryable(
        value = OptimisticLockException.class,   // é‡è¯•çš„å¼‚å¸¸ç±»å‹
        maxAttempts = 3,                          // æœ€å¤§é‡è¯•æ¬¡æ•°
        backoff = @Backoff(                       // é€€é¿ç­–ç•¥
            delay = 100,                          // åˆå§‹å»¶è¿Ÿ100ms
            multiplier = 2,                       // æ¯æ¬¡ç¿»å€
            maxDelay = 1000                       // æœ€å¤§å»¶è¿Ÿ1ç§’
        )
    )
    @Transactional
    public void updateWithRetry(Long id, String newValue) {
        Entity entity = repository.findById(id)
            .orElseThrow(() -> new RuntimeException("æ•°æ®ä¸å­˜åœ¨"));
        
        entity.setValue(newValue);
        // è‡ªåŠ¨å¤„ç†ä¹è§‚é”å†²çªé‡è¯•
    }
    
    @Recover
    public void recover(OptimisticLockException e, Long id, String newValue) {
        // é‡è¯•å…¨éƒ¨å¤±è´¥åçš„é™çº§å¤„ç†
        System.err.println("æ›´æ–°å¤±è´¥ï¼Œå·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°: " + id);
        // å¯ä»¥è®°å½•æ—¥å¿—ã€å‘é€å‘Šè­¦ç­‰
    }
}
```

### 5.2 é‡è¯•å®‰å…¨æ£€æŸ¥


**ç¡®ä¿é‡è¯•å®‰å…¨çš„æ£€æŸ¥æ¸…å•**ï¼š

```
âœ… é‡è¯•å‰çš„æ£€æŸ¥é¡¹ï¼š

1. å¹‚ç­‰æ€§ä¿è¯
   - åŒä¸€æ“ä½œå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒ
   - ä¸ä¼šäº§ç”Ÿé‡å¤æ•°æ®
   
2. çŠ¶æ€æ£€æŸ¥
   - éªŒè¯å½“å‰çŠ¶æ€æ˜¯å¦å…è®¸æ“ä½œ
   - é¿å…çŠ¶æ€ä¸ä¸€è‡´

3. èµ„æºéªŒè¯
   - æ£€æŸ¥èµ„æºæ˜¯å¦å……è¶³ï¼ˆå¦‚åº“å­˜ï¼‰
   - é¿å…è¶…å–ç­‰é—®é¢˜

4. æ—¶æ•ˆæ€§åˆ¤æ–­
   - æ£€æŸ¥æ“ä½œæ˜¯å¦è¿‡æœŸ
   - é¿å…å¤„ç†è¿‡æœŸè¯·æ±‚
```

**ç¤ºä¾‹ä»£ç **ï¼š

```java
@Service
public class SafeRetryService {
    
    @Transactional
    public void processOrderWithSafetyCheck(Long orderId) {
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new RuntimeException("è®¢å•ä¸å­˜åœ¨"));
        
        // âœ… æ£€æŸ¥1ï¼šå¹‚ç­‰æ€§æ£€æŸ¥
        if (order.getStatus() == OrderStatus.COMPLETED) {
            System.out.println("è®¢å•å·²å¤„ç†ï¼Œè·³è¿‡");
            return;
        }
        
        // âœ… æ£€æŸ¥2ï¼šæ—¶æ•ˆæ€§æ£€æŸ¥
        if (order.getCreateTime().plusHours(24).isBefore(LocalDateTime.now())) {
            System.out.println("è®¢å•å·²è¿‡æœŸ");
            return;
        }
        
        // âœ… æ£€æŸ¥3ï¼šèµ„æºéªŒè¯
        for (OrderItem item : order.getItems()) {
            Product product = productRepository.findById(item.getProductId())
                .orElseThrow(() -> new RuntimeException("å•†å“ä¸å­˜åœ¨"));
            
            if (product.getStock() < item.getQuantity()) {
                throw new RuntimeException("åº“å­˜ä¸è¶³ï¼Œæ— æ³•å¤„ç†");
            }
        }
        
        // å®‰å…¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        doProcessOrder(order);
    }
}
```

---

## 6. ğŸ”§ è¡¥å¿äº‹åŠ¡å¤„ç†


### 6.1 è¡¥å¿äº‹åŠ¡çš„æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼š
```
è¡¥å¿äº‹åŠ¡å°±åƒç½‘è´­é€€è´§ï¼š

æ­£å‘æµç¨‹ï¼šä¸‹å• â†’ ä»˜æ¬¾ â†’ å‘è´§ â†’ æ”¶è´§ âœ…
å‡ºé—®é¢˜äº†ï¼šå‘ç°ä¸åˆé€‚ï¼Œæƒ³é€€è´§ âŒ

è¡¥å¿æµç¨‹ï¼šç”³è¯·é€€è´§ â†’ é€€å›å•†å“ â†’ é€€æ¬¾ âœ…
ï¼ˆæ¯ä¸€æ­¥éƒ½æ˜¯ä¹‹å‰æ­¥éª¤çš„"åå‘æ“ä½œ"ï¼‰
```

**æ ¸å¿ƒæ€æƒ³**ï¼š
- æ­£å‘äº‹åŠ¡å¤±è´¥åï¼Œæ‰§è¡Œåå‘æ“ä½œæ¢å¤çŠ¶æ€
- é€‚ç”¨äºæ— æ³•ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯
- æœ€ç»ˆä¸€è‡´æ€§çš„å®ç°æ–¹å¼

### 6.2 è¡¥å¿äº‹åŠ¡è®¾è®¡


**ç¤ºä¾‹ï¼šè®¢å•åˆ›å»ºå¤±è´¥çš„è¡¥å¿**

```java
@Service
public class OrderCompensationService {
    
    /**
     * è®¢å•åˆ›å»ºçš„å®Œæ•´æµç¨‹ï¼ˆå«è¡¥å¿ï¼‰
     */
    public OrderResult createOrderWithCompensation(OrderRequest request) {
        Order order = null;
        boolean stockDecreased = false;
        boolean pointsDecreased = false;
        
        try {
            // ç¬¬1æ­¥ï¼šåˆ›å»ºè®¢å•è®°å½•
            order = orderService.createOrder(request);
            
            // ç¬¬2æ­¥ï¼šæ‰£å‡åº“å­˜
            inventoryService.decreaseStock(order.getItems());
            stockDecreased = true;
            
            // ç¬¬3æ­¥ï¼šæ‰£å‡ç§¯åˆ†
            pointService.decreasePoints(order.getUserId(), order.getPoints());
            pointsDecreased = true;
            
            // ç¬¬4æ­¥ï¼šå‘é€é€šçŸ¥
            notificationService.sendNotification(order);
            
            return OrderResult.success(order);
            
        } catch (Exception e) {
            // å‘ç”Ÿå¼‚å¸¸ï¼Œå¼€å§‹è¡¥å¿
            System.err.println("è®¢å•åˆ›å»ºå¤±è´¥ï¼Œå¼€å§‹è¡¥å¿: " + e.getMessage());
            
            // è¡¥å¿ç¬¬3æ­¥ï¼šæ¢å¤ç§¯åˆ†
            if (pointsDecreased) {
                try {
                    pointService.increasePoints(order.getUserId(), order.getPoints());
                } catch (Exception ce) {
                    System.err.println("ç§¯åˆ†è¡¥å¿å¤±è´¥: " + ce.getMessage());
                }
            }
            
            // è¡¥å¿ç¬¬2æ­¥ï¼šæ¢å¤åº“å­˜
            if (stockDecreased) {
                try {
                    inventoryService.increaseStock(order.getItems());
                } catch (Exception ce) {
                    System.err.println("åº“å­˜è¡¥å¿å¤±è´¥: " + ce.getMessage());
                }
            }
            
            // è¡¥å¿ç¬¬1æ­¥ï¼šæ ‡è®°è®¢å•å¤±è´¥
            if (order != null) {
                try {
                    orderService.markOrderFailed(order.getId());
                } catch (Exception ce) {
                    System.err.println("è®¢å•çŠ¶æ€æ›´æ–°å¤±è´¥: " + ce.getMessage());
                }
            }
            
            return OrderResult.failed(e.getMessage());
        }
    }
}

// è¡¥å¿æ–¹æ³•éƒ½è¦ä¿è¯å¹‚ç­‰æ€§
@Service
public class InventoryService {
    
    @Transactional
    public void increaseStock(List<OrderItem> items) {
        for (OrderItem item : items) {
            Product product = productRepository.findById(item.getProductId())
                .orElseThrow(() -> new RuntimeException("å•†å“ä¸å­˜åœ¨"));
            
            // æ¢å¤åº“å­˜
            product.setStock(product.getStock() + item.getQuantity());
        }
    }
}
```

### 6.3 æœ€ç»ˆä¸€è‡´æ€§è€ƒè™‘


**æœ€ç»ˆä¸€è‡´æ€§ç­–ç•¥**ï¼š

```
ä¼ ç»Ÿå¼ºä¸€è‡´ï¼šæ‰€æœ‰æ­¥éª¤åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
           ä¼˜ç‚¹ï¼šæ•°æ®ç»å¯¹ä¸€è‡´
           ç¼ºç‚¹ï¼šæ€§èƒ½å·®ï¼Œä¸é€‚åˆåˆ†å¸ƒå¼

æœ€ç»ˆä¸€è‡´ï¼šå…è®¸ä¸­é—´çŠ¶æ€çŸ­æš‚ä¸ä¸€è‡´,æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´
         ä¼˜ç‚¹ï¼šæ€§èƒ½å¥½ï¼Œé€‚åˆåˆ†å¸ƒå¼
         ç¼ºç‚¹ï¼šéœ€è¦å¤„ç†ä¸­é—´çŠ¶æ€
```

**æ¶ˆæ¯é©±åŠ¨çš„æœ€ç»ˆä¸€è‡´**ï¼š

```java
@Service
public class EventDrivenOrderService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    /**
     * ä½¿ç”¨äº‹ä»¶é©±åŠ¨å®ç°æœ€ç»ˆä¸€è‡´æ€§
     */
    @Transactional
    public Order createOrder(OrderRequest request) {
        // 1. åˆ›å»ºè®¢å•ï¼ˆç«‹å³ä¸€è‡´ï¼‰
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setStatus(OrderStatus.CREATED);
        orderRepository.save(order);
        
        // 2. å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
        eventPublisher.publishEvent(new OrderCreatedEvent(order));
        
        return order;
    }
}

// äº‹ä»¶ç›‘å¬å™¨ï¼šå¼‚æ­¥å¤„ç†åç»­æ­¥éª¤
@Component
public class OrderEventListener {
    
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void handleOrderCreated(OrderCreatedEvent event) {
        Order order = event.getOrder();
        
        try {
            // å¼‚æ­¥æ‰£å‡åº“å­˜
            inventoryService.decreaseStock(order.getItems());
            
            // å¼‚æ­¥æ‰£å‡ç§¯åˆ†
            pointService.decreasePoints(order.getUserId(), order.getPoints());
            
            // æ›´æ–°è®¢å•çŠ¶æ€
            orderService.updateStatus(order.getId(), OrderStatus.PROCESSING);
            
        } catch (Exception e) {
            // å¤±è´¥æ—¶å‘èµ·è¡¥å¿
            System.err.println("è®¢å•åç»­å¤„ç†å¤±è´¥: " + e.getMessage());
            compensationService.compensateOrder(order.getId());
        }
    }
}
```

**è¡¥å¿æ—¥å¿—è®°å½•**ï¼š

```java
@Entity
public class CompensationLog {
    @Id
    private Long id;
    
    private String businessId;        // ä¸šåŠ¡IDï¼ˆå¦‚è®¢å•IDï¼‰
    private String compensationType;  // è¡¥å¿ç±»å‹
    private String compensationData;  // è¡¥å¿æ•°æ®ï¼ˆJSONï¼‰
    private String status;            // çŠ¶æ€ï¼šPENDING/SUCCESS/FAILED
    private Integer retryCount;       // é‡è¯•æ¬¡æ•°
    private LocalDateTime createTime;
}

@Service
public class CompensationManager {
    
    /**
     * è®°å½•éœ€è¦è¡¥å¿çš„æ“ä½œ
     */
    @Transactional
    public void recordCompensation(String businessId, String type, Object data) {
        CompensationLog log = new CompensationLog();
        log.setBusinessId(businessId);
        log.setCompensationType(type);
        log.setCompensationData(JSON.toJSONString(data));
        log.setStatus("PENDING");
        log.setRetryCount(0);
        compensationLogRepository.save(log);
    }
    
    /**
     * å®šæ—¶ä»»åŠ¡ï¼šå¤„ç†å¾…è¡¥å¿çš„è®°å½•
     */
    @Scheduled(fixedDelay = 60000)  // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void processPendingCompensations() {
        List<CompensationLog> pending = compensationLogRepository
            .findByStatusAndRetryCountLessThan("PENDING", 5);
        
        for (CompensationLog log : pending) {
            try {
                // æ‰§è¡Œè¡¥å¿é€»è¾‘
                executeCompensation(log);
                
                log.setStatus("SUCCESS");
                
            } catch (Exception e) {
                log.setRetryCount(log.getRetryCount() + 1);
                System.err.println("è¡¥å¿å¤±è´¥: " + e.getMessage());
            }
            
            compensationLogRepository.save(log);
        }
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤§äº‹åŠ¡é—®é¢˜ï¼šé•¿æ—¶é—´å ç”¨èµ„æºï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§
ğŸ”¸ æ‹†åˆ†ç­–ç•¥ï¼šæŒ‰æ•°æ®é‡ã€ä¸šåŠ¡é€»è¾‘ã€æ—¶é—´çª—å£åˆç†æ‹†åˆ†
ğŸ”¸ å¹‚ç­‰è®¾è®¡ï¼šåŒä¸€æ“ä½œå¤šæ¬¡æ‰§è¡Œç»“æœç›¸åŒï¼Œé¿å…é‡å¤å‰¯ä½œç”¨
ğŸ”¸ é‡è¯•å®‰å…¨ï¼šä½¿ç”¨ä¹è§‚é”+é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿å¹¶å‘å®‰å…¨
ğŸ”¸ è¡¥å¿äº‹åŠ¡ï¼šæ­£å‘å¤±è´¥åæ‰§è¡Œåå‘æ“ä½œï¼Œå®ç°æœ€ç»ˆä¸€è‡´æ€§
```

### 7.2 å®è·µç»éªŒæ€»ç»“


**ğŸ”¹ ä½•æ—¶éœ€è¦æ‹†åˆ†äº‹åŠ¡**

```
åˆ¤æ–­æ ‡å‡†ï¼š
âœ… æ‰§è¡Œæ—¶é—´ > 5ç§’
âœ… å¤„ç†æ•°æ®é‡ > 1000æ¡
âœ… æ¶‰åŠå¤šä¸ªå¤–éƒ¨è°ƒç”¨
âœ… é•¿æ—¶é—´æŒæœ‰é”èµ„æº
âœ… å†…å­˜å ç”¨è¿‡å¤§
```

**ğŸ”¹ æ‹†åˆ†æ–¹æ¡ˆé€‰æ‹©**

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| æ•°æ®è¿ç§» | åˆ†æ‰¹æ¬¡+è¿›åº¦è®°å½• | å¯æ¢å¤ï¼Œæ”¯æŒå¤§æ•°æ®é‡ |
| æ‰¹é‡å¤„ç† | ç‹¬ç«‹å°äº‹åŠ¡ | å¤±è´¥å½±å“å°ï¼Œæ˜“é‡è¯• |
| å¤æ‚ä¸šåŠ¡ | ä¸šåŠ¡æ­¥éª¤æ‹†åˆ†+è¡¥å¿ | è§£è€¦ï¼Œæé«˜å¯ç»´æŠ¤æ€§ |
| é«˜å¹¶å‘æ›´æ–° | ä¹è§‚é”+é‡è¯• | é¿å…é”ç«äº‰ï¼Œæ€§èƒ½å¥½ |

**ğŸ”¹ å¹‚ç­‰æ€§ä¿éšœæ–¹å¼**

```
1. å”¯ä¸€çº¦æŸï¼šæ•°æ®åº“å±‚é¢é˜²é‡
2. çŠ¶æ€æœºï¼šä¸šåŠ¡å±‚é¢æ§åˆ¶
3. å¹‚ç­‰ä»¤ç‰Œï¼šåˆ†å¸ƒå¼ç¯å¢ƒé¦–é€‰
4. å»é‡è¡¨ï¼šè®°å½•å·²å¤„ç†è¯·æ±‚
```

**ğŸ”¹ è¡¥å¿äº‹åŠ¡è®¾è®¡åŸåˆ™**

```
è®¾è®¡è¦ç‚¹ï¼š
â€¢ æ¯ä¸ªæ“ä½œéƒ½è¦æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œ
â€¢ è¡¥å¿æ“ä½œå¿…é¡»å¹‚ç­‰
â€¢ è®°å½•è¡¥å¿æ—¥å¿—ï¼Œæ”¯æŒäººå·¥ä»‹å…¥
â€¢ è€ƒè™‘è¡¥å¿å¤±è´¥çš„å¤„ç†ç­–ç•¥
```

### 7.3 é¿å…çš„å¸¸è§é”™è¯¯


```
âŒ å¸¸è§è¯¯åŒºï¼š

1. ä¸€åˆ€åˆ‡æ‹†åˆ†
   é”™è¯¯ï¼šæ‰€æœ‰æ“ä½œéƒ½æ‹†æˆç‹¬ç«‹äº‹åŠ¡
   æ­£ç¡®ï¼šæ ¸å¿ƒä¸šåŠ¡ä¿æŒäº‹åŠ¡ï¼Œéæ ¸å¿ƒå¼‚æ­¥å¤„ç†

2. å¿½ç•¥å¹‚ç­‰æ€§
   é”™è¯¯ï¼šé‡è¯•æ—¶äº§ç”Ÿé‡å¤æ•°æ®
   æ­£ç¡®ï¼šè®¾è®¡æ—¶å°±è€ƒè™‘é‡è¯•å®‰å…¨

3. è¡¥å¿ä¸å®Œæ•´
   é”™è¯¯ï¼šåªè¡¥å¿éƒ¨åˆ†æ“ä½œ
   æ­£ç¡®ï¼šæ¯ä¸ªæ“ä½œéƒ½è¦æœ‰é€†å‘è¡¥å¿

4. ç¼ºå°‘ç›‘æ§
   é”™è¯¯ï¼šè¡¥å¿å¤±è´¥åä¸çŸ¥é“
   æ­£ç¡®ï¼šè®°å½•æ—¥å¿—ï¼Œè®¾ç½®å‘Šè­¦

5. è¿‡åº¦æ‹†åˆ†
   é”™è¯¯ï¼šç®€å•æ“ä½œä¹Ÿæ‹†åˆ†
   æ­£ç¡®ï¼šæ ¹æ®å®é™…æƒ…å†µæƒè¡¡
```

### 7.4 æœ€ä½³å®è·µå»ºè®®


```
ğŸ’¡ å®æˆ˜å»ºè®®ï¼š

1. äº‹åŠ¡æ‹†åˆ†
   - ä¼˜å…ˆæŒ‰ä¸šåŠ¡è¾¹ç•Œæ‹†åˆ†
   - æ ¸å¿ƒæµç¨‹ä¿æŒåŸå­æ€§
   - éæ ¸å¿ƒæ­¥éª¤å¼‚æ­¥å¤„ç†

2. å¹‚ç­‰è®¾è®¡
   - ä½¿ç”¨ä¸šåŠ¡å”¯ä¸€é”®
   - ç»“åˆçŠ¶æ€æœºæ§åˆ¶
   - åˆ†å¸ƒå¼åœºæ™¯ç”¨Token

3. é‡è¯•ç­–ç•¥
   - è®¾ç½®åˆç†çš„é‡è¯•æ¬¡æ•°ï¼ˆ3-5æ¬¡ï¼‰
   - ä½¿ç”¨æŒ‡æ•°é€€é¿ç®—æ³•
   - åŒºåˆ†å¯é‡è¯•å’Œä¸å¯é‡è¯•å¼‚å¸¸

4. è¡¥å¿æœºåˆ¶
   - è®°å½•è¯¦ç»†çš„è¡¥å¿æ—¥å¿—
   - è®¾ç½®è¡¥å¿è¶…æ—¶æ—¶é—´
   - æä¾›äººå·¥ä»‹å…¥å…¥å£

5. ç›‘æ§å‘Šè­¦
   - ç›‘æ§å¤§äº‹åŠ¡æ‰§è¡Œæ—¶é—´
   - ç›‘æ§è¡¥å¿ä»»åŠ¡æˆåŠŸç‡
   - è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¤§äº‹åŠ¡è¦æ‹†åˆ†ï¼Œæ‰¹æ¬¡ç‹¬ç«‹æ›´å®‰å…¨
- å¹‚ç­‰è®¾è®¡æ˜¯å…³é”®ï¼Œé‡å¤æ‰§è¡Œä¸å‡ºé”™
- ä¹è§‚é”é…é‡è¯•ï¼Œå¹¶å‘å†²çªå·§åŒ–è§£
- è¡¥å¿äº‹åŠ¡ä¿åº•çº¿ï¼Œæœ€ç»ˆä¸€è‡´æ˜¯ç›®æ ‡