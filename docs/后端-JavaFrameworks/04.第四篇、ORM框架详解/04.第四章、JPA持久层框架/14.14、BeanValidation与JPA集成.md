---
title: 14ã€BeanValidationä¸JPAé›†æˆ
---
## ğŸ“š ç›®å½•

1. [æ•°æ®æ ¡éªŒæ¦‚è¿°](#1-æ•°æ®æ ¡éªŒæ¦‚è¿°)
2. [å¸¸ç”¨æ ¡éªŒæ³¨è§£è¯¦è§£](#2-å¸¸ç”¨æ ¡éªŒæ³¨è§£è¯¦è§£)
3. [æ ¡éªŒæ—¶æœºä¸åŸç†](#3-æ ¡éªŒæ—¶æœºä¸åŸç†)
4. [å®æˆ˜åº”ç”¨åœºæ™¯](#4-å®æˆ˜åº”ç”¨åœºæ™¯)
5. [ç»Ÿä¸€é”™è¯¯å¤„ç†](#5-ç»Ÿä¸€é”™è¯¯å¤„ç†)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ æ•°æ®æ ¡éªŒæ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ ¡éªŒ


**ç°å®åœºæ™¯ç†è§£**ï¼š
```
å°±åƒç½‘è´­å¡«å†™æ”¶è´§åœ°å€ï¼š
âŒ æ‰‹æœºå·åªæœ‰10ä½ â†’ ç³»ç»Ÿæç¤º"æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®"
âŒ å§“åä¸ºç©º â†’ ç³»ç»Ÿæç¤º"è¯·å¡«å†™æ”¶è´§äººå§“å"
âŒ é‚®ç®±æ ¼å¼é”™è¯¯ â†’ ç³»ç»Ÿæç¤º"é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"

è¿™å°±æ˜¯æ•°æ®æ ¡éªŒçš„ä½œç”¨ï¼
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- âœ… **ä¿è¯æ•°æ®è´¨é‡**ï¼šé˜²æ­¢è„æ•°æ®è¿›å…¥æ•°æ®åº“
- âœ… **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šåŠæ—¶åé¦ˆè¾“å…¥é”™è¯¯
- âœ… **å‡å°‘æ•°æ®åº“å‹åŠ›**ï¼šåœ¨åº”ç”¨å±‚æ‹¦æˆªé”™è¯¯æ•°æ®
- âœ… **ç»Ÿä¸€æ ¡éªŒé€»è¾‘**ï¼šé¿å…é‡å¤ç¼–å†™æ ¡éªŒä»£ç 

### 1.2 Bean Validationæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šBean Validationå°±åƒç»™ä½ çš„æ•°æ®è´´ä¸Š"è§„åˆ™æ ‡ç­¾"
> 
> æ¯”å¦‚ç»™Userç±»çš„emailå­—æ®µè´´ä¸ª@Emailæ ‡ç­¾ï¼Œç³»ç»Ÿå°±çŸ¥é“è¿™ä¸ªå­—æ®µå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼

**å®˜æ–¹å®šä¹‰**ï¼š
```
Bean Validationæ˜¯Javaçš„æ•°æ®æ ¡éªŒè§„èŒƒæ ‡å‡†
å°±åƒä¸€å¥—"æ•°æ®æ£€æŸ¥å‘˜"çš„å·¥ä½œå®ˆåˆ™
å‘Šè¯‰ç¨‹åºå¦‚ä½•æ£€æŸ¥æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚
```

**å®ç°æ¡†æ¶**ï¼š
- ğŸ“¦ **Hibernate Validator**ï¼ˆæœ€å¸¸ç”¨ï¼ŒJPAé»˜è®¤é›†æˆï¼‰
- ğŸ“¦ **Apache BVal**
- ğŸ“¦ **Spring Validation**ï¼ˆåŸºäºHibernate Validatorï¼‰

### 1.3 JPAä¸æ ¡éªŒçš„å…³ç³»


**é›†æˆæ¶æ„å›¾**ï¼š
```
ç”¨æˆ·è¾“å…¥æ•°æ®
    â†“
Controllerå±‚æ¥æ”¶
    â†“
ã€ç¬¬ä¸€é“é˜²çº¿ã€‘å…¥å‚æ ¡éªŒ @Valid
    â†“
Serviceä¸šåŠ¡å¤„ç†
    â†“
ã€ç¬¬äºŒé“é˜²çº¿ã€‘JPAæŒä¹…åŒ–å‰æ ¡éªŒ
    â†“
æ•°æ®åº“å­˜å‚¨

ä¸¤é“é˜²çº¿ï¼ŒåŒé‡ä¿éšœï¼
```

---

## 2. ğŸ“ å¸¸ç”¨æ ¡éªŒæ³¨è§£è¯¦è§£


### 2.1 éç©ºæ ¡éªŒæ³¨è§£


#### @NotNull - ä¸èƒ½ä¸ºnull


```java
public class User {
    @NotNull(message = "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º")
    private Long id;
}
```

> ğŸ” **é€šä¿—è§£é‡Š**ï¼šè¿™ä¸ªå­—æ®µå¿…é¡»æœ‰å€¼ï¼Œä¸èƒ½æ˜¯null
> 
> âš ï¸ **æ³¨æ„**ï¼šç©ºå­—ç¬¦ä¸²""æ˜¯å…è®¸çš„ï¼Œåªæ˜¯ä¸èƒ½null

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¿…å¡«çš„IDå­—æ®µ
- âœ… å¿…é¡»ä¼ å…¥çš„å‚æ•°
- âœ… ä¸èƒ½ç¼ºå¤±çš„é…ç½®é¡¹

#### @NotEmpty - ä¸èƒ½ä¸ºç©ºé›†åˆ/å­—ç¬¦ä¸²


```java
public class Article {
    @NotEmpty(message = "æ–‡ç« æ ‡é¢˜ä¸èƒ½ä¸ºç©º")
    private String title;
    
    @NotEmpty(message = "æ ‡ç­¾åˆ—è¡¨ä¸èƒ½ä¸ºç©º")
    private List<String> tags;
}
```

> ğŸ” **é€šä¿—è§£é‡Š**ï¼šæ¯”@NotNullæ›´ä¸¥æ ¼
> - ä¸èƒ½æ˜¯null
> - å­—ç¬¦ä¸²ä¸èƒ½æ˜¯""
> - é›†åˆä¸èƒ½æ˜¯ç©ºé›†åˆ[]

**ä¸@NotNullåŒºåˆ«**ï¼š
| æ³¨è§£ | null | ç©ºå­—ç¬¦ä¸²"" | ç©ºé›†åˆ[] |
|------|------|-----------|---------|
| @NotNull | âŒ | âœ… | âœ… |
| @NotEmpty | âŒ | âŒ | âŒ |
| @NotBlank | âŒ | âŒ | âŒè¿ç©ºæ ¼éƒ½ä¸è¡Œ |

#### @NotBlank - ä¸èƒ½ä¸ºç©ºç™½å­—ç¬¦ä¸²


```java
public class User {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©ºç™½")
    private String username;
}
```

> ğŸ” **é€šä¿—è§£é‡Š**ï¼šæœ€ä¸¥æ ¼çš„éç©ºæ ¡éªŒ
> - ä¸èƒ½æ˜¯null
> - ä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²""
> - ä¸èƒ½æ˜¯çº¯ç©ºæ ¼"   "

**å®é™…åº”ç”¨**ï¼š
```java
// è¿™äº›éƒ½ä¼šæ ¡éªŒå¤±è´¥
username = null;        // âŒ å¤±è´¥
username = "";          // âŒ å¤±è´¥  
username = "   ";       // âŒ å¤±è´¥
username = "å¼ ä¸‰";      // âœ… é€šè¿‡
```

### 2.2 é•¿åº¦ä¸èŒƒå›´æ ¡éªŒ


#### @Size - é•¿åº¦èŒƒå›´æ ¡éªŒ


```java
public class User {
    @Size(min = 2, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨2-20ä¹‹é—´")
    private String username;
    
    @Size(min = 1, max = 5, message = "æœ€å¤šæ·»åŠ 5ä¸ªæ ‡ç­¾")
    private List<String> tags;
}
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼š
> - `min`ï¼šæœ€å°é•¿åº¦/ä¸ªæ•°
> - `max`ï¼šæœ€å¤§é•¿åº¦/ä¸ªæ•°
> - é€‚ç”¨äºï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ã€é›†åˆã€Map

**å¸¸è§ç”¨æ³•**ï¼š
```java
// å¯†ç é•¿åº¦
@Size(min = 6, max = 20, message = "å¯†ç é•¿åº¦6-20ä½")
private String password;

// æ‰‹æœºå·å›ºå®šé•¿åº¦
@Size(min = 11, max = 11, message = "æ‰‹æœºå·å¿…é¡»11ä½")
private String phone;
```

#### @Min / @Max - æ•°å€¼èŒƒå›´


```java
public class Product {
    @Min(value = 0, message = "ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°")
    @Max(value = 999999, message = "ä»·æ ¼ä¸èƒ½è¶…è¿‡999999")
    private BigDecimal price;
    
    @Min(value = 1, message = "åº“å­˜è‡³å°‘ä¸º1")
    private Integer stock;
}
```

> ğŸ” **ä½¿ç”¨åœºæ™¯**ï¼š
> - ä»·æ ¼ã€åº“å­˜ç­‰æ•°å€¼å­—æ®µ
> - å¹´é¾„ã€æ•°é‡ç­‰æœ‰èŒƒå›´é™åˆ¶çš„å­—æ®µ

#### @DecimalMin / @DecimalMax - ç²¾ç¡®æ•°å€¼èŒƒå›´


```java
public class Order {
    @DecimalMin(value = "0.01", message = "è®¢å•é‡‘é¢æœ€ä½0.01å…ƒ")
    @DecimalMax(value = "99999.99", message = "è®¢å•é‡‘é¢æœ€é«˜99999.99å…ƒ")
    private BigDecimal amount;
}
```

### 2.3 æ ¼å¼æ ¡éªŒæ³¨è§£


#### @Email - é‚®ç®±æ ¼å¼æ ¡éªŒ


```java
public class User {
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
}
```

> ğŸ’¡ **è‡ªåŠ¨æ ¡éªŒ**ï¼š
> - âœ… `user@example.com` é€šè¿‡
> - âœ… `test.user@company.cn` é€šè¿‡
> - âŒ `invalid.email` å¤±è´¥
> - âŒ `@example.com` å¤±è´¥

**è¿›é˜¶ç”¨æ³•**ï¼ˆè‡ªå®šä¹‰é‚®ç®±è§„åˆ™ï¼‰ï¼š
```java
@Email(regexp = "^[A-Za-z0-9+_.-]+@company\\.com$", 
       message = "åªå…è®¸å…¬å¸é‚®ç®±")
private String workEmail;
```

#### @Pattern - æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ


```java
public class User {
    // æ‰‹æœºå·æ ¡éªŒ
    @Pattern(regexp = "^1[3-9]\\d{9}$", 
             message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    // èº«ä»½è¯å·æ ¡éªŒ
    @Pattern(regexp = "^[1-9]\\d{5}(18|19|20)\\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])\\d{3}[\\dXx]$",
             message = "èº«ä»½è¯å·æ ¼å¼ä¸æ­£ç¡®")
    private String idCard;
}
```

> ğŸ” **å¸¸ç”¨æ­£åˆ™æ¨¡å¼**ï¼š

| æ ¡éªŒå†…å®¹ | æ­£åˆ™è¡¨è¾¾å¼ | è¯´æ˜ |
|---------|-----------|------|
| æ‰‹æœºå· | `^1[3-9]\d{9}$` | 1å¼€å¤´11ä½æ•°å­— |
| é‚®æ”¿ç¼–ç  | `^\d{6}$` | 6ä½æ•°å­— |
| ç½‘å€ | `^https?://.*` | httpæˆ–httpså¼€å¤´ |
| çº¯æ•°å­— | `^\d+$` | åªåŒ…å«æ•°å­— |
| ä¸­æ–‡å§“å | `^[\u4e00-\u9fa5]{2,20}$` | 2-20ä¸ªæ±‰å­— |

### 2.4 æ—¥æœŸä¸æ—¶é—´æ ¡éªŒ


#### @Past / @Future - æ—¥æœŸèŒƒå›´


```java
public class Employee {
    @Past(message = "å‡ºç”Ÿæ—¥æœŸå¿…é¡»æ˜¯è¿‡å»çš„æ—¶é—´")
    private LocalDate birthday;
    
    @Future(message = "åˆåŒåˆ°æœŸæ—¥æœŸå¿…é¡»æ˜¯æœªæ¥æ—¶é—´")
    private LocalDate contractEndDate;
}
```

> ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼š
> - `@Past`ï¼šå‡ºç”Ÿæ—¥æœŸã€å…¥èŒæ—¥æœŸ
> - `@Future`ï¼šé¢„çº¦æ—¶é—´ã€åˆ°æœŸæ—¥æœŸ
> - `@PastOrPresent`ï¼šåŒ…å«ä»Šå¤©
> - `@FutureOrPresent`ï¼šåŒ…å«ä»Šå¤©

---

## 3. âš™ï¸ æ ¡éªŒæ—¶æœºä¸åŸç†


### 3.1 ä¸¤ç§æ ¡éªŒæ—¶æœºå¯¹æ¯”


**æ ¡éªŒæ—¶æœºæµç¨‹å›¾**ï¼š
```
ã€æ–¹å¼1ï¼šå…¥å‚æ ¡éªŒã€‘
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
Controlleræ¥æ”¶å‚æ•° + @Valid
    â†“
ç«‹å³æ ¡éªŒ â† ç¬¬ä¸€æ—¶é—´æ‹¦æˆªé”™è¯¯
    â†“
æ ¡éªŒå¤±è´¥ â†’ è¿”å›é”™è¯¯ä¿¡æ¯
    â†“
æ ¡éªŒé€šè¿‡ â†’ è¿›å…¥Serviceå±‚


ã€æ–¹å¼2ï¼šæŒä¹…åŒ–æ ¡éªŒã€‘
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
Controlleræ¥æ”¶ï¼ˆä¸æ ¡éªŒï¼‰
    â†“
Serviceä¸šåŠ¡å¤„ç†
    â†“
JPAä¿å­˜å‰è‡ªåŠ¨æ ¡éªŒ â† æ•°æ®åº“å‰æœ€åä¸€é“é˜²çº¿
    â†“
æ ¡éªŒå¤±è´¥ â†’ æŠ›å‡ºå¼‚å¸¸
    â†“
æ ¡éªŒé€šè¿‡ â†’ ä¿å­˜åˆ°æ•°æ®åº“
```

### 3.2 å…¥å‚æ ¡éªŒï¼ˆæ¨èæ–¹å¼ï¼‰


#### åŸºæœ¬ä½¿ç”¨


```java
@RestController
@RequestMapping("/users")
public class UserController {
    
    // @Validè§¦å‘æ ¡éªŒ
    @PostMapping
    public Result createUser(@Valid @RequestBody User user) {
        // å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œè¿™é‡Œçš„ä»£ç ä¸ä¼šæ‰§è¡Œ
        return Result.success(userService.save(user));
    }
}
```

> ğŸ”¥ **æ ¸å¿ƒè¦ç‚¹**ï¼š
> - ä½¿ç”¨`@Valid`æˆ–`@Validated`è§¦å‘æ ¡éªŒ
> - æ ¡éªŒå¤±è´¥è‡ªåŠ¨æŠ›å‡º`MethodArgumentNotValidException`
> - å¯ä»¥åœ¨Controllerå±‚ç¬¬ä¸€æ—¶é—´æ‹¦æˆªé”™è¯¯æ•°æ®

#### åµŒå¥—å¯¹è±¡æ ¡éªŒ


```java
public class Order {
    @NotNull(message = "è®¢å•å·ä¸èƒ½ä¸ºç©º")
    private String orderNo;
    
    @Valid  // â† åµŒå¥—å¯¹è±¡ä¹Ÿéœ€è¦æ ¡éªŒ
    @NotNull(message = "æ”¶è´§åœ°å€ä¸èƒ½ä¸ºç©º")
    private Address address;
}

public class Address {
    @NotBlank(message = "æ”¶è´§äººä¸èƒ½ä¸ºç©º")
    private String receiver;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼é”™è¯¯")
    private String phone;
}
```

> âš ï¸ **æ³¨æ„**ï¼šåµŒå¥—å¯¹è±¡å¿…é¡»åŠ `@Valid`æ‰ä¼šè§¦å‘æ ¡éªŒ

#### åˆ†ç»„æ ¡éªŒ


```java
public class User {
    // åªåœ¨æ–°å¢æ—¶æ ¡éªŒ
    @Null(groups = Create.class, message = "æ–°å¢æ—¶IDå¿…é¡»ä¸ºç©º")
    // åªåœ¨æ›´æ–°æ—¶æ ¡éªŒ
    @NotNull(groups = Update.class, message = "æ›´æ–°æ—¶IDä¸èƒ½ä¸ºç©º")
    private Long id;
    
    @NotBlank(groups = {Create.class, Update.class})
    private String username;
    
    // åˆ†ç»„æ ‡è®°æ¥å£
    public interface Create {}
    public interface Update {}
}

// Controllerä¸­ä½¿ç”¨
@PostMapping
public Result create(@Validated(Create.class) @RequestBody User user) {
    return Result.success(userService.save(user));
}

@PutMapping
public Result update(@Validated(Update.class) @RequestBody User user) {
    return Result.success(userService.update(user));
}
```

> ğŸ’¡ **åˆ†ç»„æ ¡éªŒåº”ç”¨åœºæ™¯**ï¼š
> - æ–°å¢å’Œæ›´æ–°ä½¿ç”¨ä¸åŒæ ¡éªŒè§„åˆ™
> - åŒä¸€ä¸ªå®ä½“åœ¨ä¸åŒä¸šåŠ¡åœºæ™¯çš„æ ¡éªŒå·®å¼‚

### 3.3 æŒä¹…åŒ–æ ¡éªŒï¼ˆJPAè‡ªåŠ¨è§¦å‘ï¼‰


```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Column(length = 50, nullable = false)
    private String username;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    @Column(unique = true)
    private String email;
}

// Serviceä¸­ä¿å­˜
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    public User save(User user) {
        // JPAåœ¨æ‰§è¡Œsaveå‰ä¼šè‡ªåŠ¨è§¦å‘æ ¡éªŒ
        // æ ¡éªŒå¤±è´¥æŠ›å‡ºConstraintViolationException
        return userRepository.save(user);
    }
}
```

> ğŸ” **JPAæ ¡éªŒè§¦å‘æ—¶æœº**ï¼š
> - æ‰§è¡Œ`save()`æ–¹æ³•æ—¶
> - æ‰§è¡Œ`saveAll()`æ–¹æ³•æ—¶
> - äº‹åŠ¡æäº¤å‰ï¼ˆ`@Transactional`ï¼‰

### 3.4 æ ¡éªŒæ—¶æœºé€‰æ‹©å»ºè®®


**å¯¹æ¯”åˆ†æè¡¨**ï¼š

| å¯¹æ¯”ç»´åº¦ | å…¥å‚æ ¡éªŒ(@Valid) | æŒä¹…åŒ–æ ¡éªŒ(JPA) |
|---------|-----------------|----------------|
| **è§¦å‘æ—¶æœº** | Controlleræ¥æ”¶å‚æ•°æ—¶ | ä¿å­˜åˆ°æ•°æ®åº“å‰ |
| **å“åº”é€Ÿåº¦** | âš¡ æœ€å¿«ï¼Œç«‹å³è¿”å› | ç¨æ…¢ï¼Œåœ¨ä¸šåŠ¡å¤„ç†å |
| **é€‚ç”¨åœºæ™¯** | ğŸ”¥ APIæ¥å£ã€è¡¨å•æäº¤ | æ•°æ®å¯¼å…¥ã€æ‰¹é‡æ“ä½œ |
| **å¼‚å¸¸ç±»å‹** | MethodArgumentNotValidException | ConstraintViolationException |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­ |

**æœ€ä½³å®è·µ**ï¼š
```
âœ… æ¨èåšæ³•ï¼šä¸¤è€…ç»“åˆä½¿ç”¨
  - Controllerå±‚ç”¨@Validåšç¬¬ä¸€é“é˜²çº¿
  - Entityä¸Šä¿ç•™æ ¡éªŒæ³¨è§£åšå…œåº•ä¿æŠ¤
  
âŒ ä¸æ¨èï¼šåªä¾èµ–JPAæ ¡éªŒ
  - é”™è¯¯åé¦ˆå¤ªæ™š
  - ç”¨æˆ·ä½“éªŒå·®
```

---

## 4. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 4.1 ç”¨æˆ·æ³¨å†Œåœºæ™¯


**å®Œæ•´å®ä½“ç±»**ï¼š
```java
@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦3-20ä½")
    @Pattern(regexp = "^[a-zA-Z0-9_]+$", message = "ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿")
    @Column(unique = true, nullable = false, length = 20)
    private String username;
    
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, max = 20, message = "å¯†ç é•¿åº¦6-20ä½")
    private String password;
    
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    @Column(unique = true)
    private String email;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    @Min(value = 1, message = "å¹´é¾„å¿…é¡»å¤§äº0")
    @Max(value = 150, message = "å¹´é¾„ä¸èƒ½è¶…è¿‡150")
    private Integer age;
}
```

**Controlleræ¥å£**ï¼š
```java
@RestController
@RequestMapping("/auth")
public class AuthController {
    
    @Autowired
    private UserService userService;
    
    @PostMapping("/register")
    public Result register(@Valid @RequestBody User user, 
                          BindingResult bindingResult) {
        // æ–¹å¼1ï¼šæ‰‹åŠ¨å¤„ç†æ ¡éªŒç»“æœ
        if (bindingResult.hasErrors()) {
            String errorMsg = bindingResult.getAllErrors()
                .stream()
                .map(ObjectError::getDefaultMessage)
                .collect(Collectors.joining(", "));
            return Result.error(errorMsg);
        }
        
        // æ–¹å¼2ï¼šè®©ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨å¤„ç†ï¼ˆæ¨èï¼‰
        return Result.success(userService.register(user));
    }
}
```

### 4.2 è®¢å•æäº¤åœºæ™¯


```java
@Entity
public class Order {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @NotNull(message = "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º")
    private Long userId;
    
    @NotEmpty(message = "è®¢å•å•†å“ä¸èƒ½ä¸ºç©º")
    @Size(min = 1, max = 20, message = "è®¢å•å•†å“æ•°é‡1-20ä¸ª")
    @Valid  // åµŒå¥—æ ¡éªŒ
    private List<OrderItem> items;
    
    @NotNull(message = "è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º")
    @DecimalMin(value = "0.01", message = "è®¢å•é‡‘é¢æœ€ä½0.01å…ƒ")
    private BigDecimal totalAmount;
    
    @Valid
    @NotNull(message = "æ”¶è´§åœ°å€ä¸èƒ½ä¸ºç©º")
    private ShippingAddress address;
}

public class OrderItem {
    @NotNull(message = "å•†å“IDä¸èƒ½ä¸ºç©º")
    private Long productId;
    
    @Min(value = 1, message = "è´­ä¹°æ•°é‡è‡³å°‘ä¸º1")
    private Integer quantity;
    
    @DecimalMin(value = "0.01", message = "å•†å“ä»·æ ¼å¿…é¡»å¤§äº0")
    private BigDecimal price;
}
```

### 4.3 æ•°æ®å¯¼å…¥åœºæ™¯


```java
@Service
public class UserImportService {
    
    @Autowired
    private Validator validator;
    
    public ImportResult importUsers(List<User> users) {
        List<String> errors = new ArrayList<>();
        List<User> validUsers = new ArrayList<>();
        
        for (int i = 0; i < users.size(); i++) {
            User user = users.get(i);
            
            // æ‰‹åŠ¨è§¦å‘æ ¡éªŒ
            Set<ConstraintViolation<User>> violations = 
                validator.validate(user);
            
            if (violations.isEmpty()) {
                validUsers.add(user);
            } else {
                String errorMsg = String.format("ç¬¬%dè¡Œæ•°æ®æ ¡éªŒå¤±è´¥: %s", 
                    i + 1, 
                    violations.stream()
                        .map(ConstraintViolation::getMessage)
                        .collect(Collectors.joining(", "))
                );
                errors.add(errorMsg);
            }
        }
        
        // æ‰¹é‡ä¿å­˜æœ‰æ•ˆæ•°æ®
        if (!validUsers.isEmpty()) {
            userRepository.saveAll(validUsers);
        }
        
        return new ImportResult(validUsers.size(), errors);
    }
}
```

---

## 5. ğŸš¨ ç»Ÿä¸€é”™è¯¯å¤„ç†


### 5.1 å…¨å±€å¼‚å¸¸å¤„ç†å™¨


```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    /**
     * å¤„ç†@Validå‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidationException(
            MethodArgumentNotValidException ex) {
        
        // æ”¶é›†æ‰€æœ‰é”™è¯¯ä¿¡æ¯
        Map<String, String> errors = new HashMap<>();
        ex.getBindingResult().getFieldErrors().forEach(error -> {
            errors.put(error.getField(), error.getDefaultMessage());
        });
        
        return Result.error("å‚æ•°æ ¡éªŒå¤±è´¥", errors);
    }
    
    /**
     * å¤„ç†JPAæŒä¹…åŒ–æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(ConstraintViolationException.class)
    public Result handleConstraintViolation(
            ConstraintViolationException ex) {
        
        List<String> errors = ex.getConstraintViolations()
            .stream()
            .map(violation -> violation.getPropertyPath() + ": " + 
                              violation.getMessage())
            .collect(Collectors.toList());
        
        return Result.error("æ•°æ®æ ¡éªŒå¤±è´¥", errors);
    }
    
    /**
     * å¤„ç†å•ä¸ªå‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(ConstraintViolationException.class)
    public Result handleParamValidation(
            ConstraintViolationException ex) {
        
        String message = ex.getConstraintViolations()
            .stream()
            .map(ConstraintViolation::getMessage)
            .collect(Collectors.joining(", "));
        
        return Result.error(message);
    }
}
```

### 5.2 ç»Ÿä¸€è¿”å›æ ¼å¼


```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Result<T> {
    
    private Integer code;
    private String message;
    private T data;
    
    public static <T> Result<T> success(T data) {
        return new Result<>(200, "æ“ä½œæˆåŠŸ", data);
    }
    
    public static Result error(String message) {
        return new Result<>(400, message, null);
    }
    
    public static Result error(String message, Object errors) {
        return new Result<>(400, message, errors);
    }
}
```

**é”™è¯¯è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "code": 400,
  "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
  "data": {
    "username": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º",
    "email": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®",
    "age": "å¹´é¾„å¿…é¡»å¤§äº0"
  }
}
```

### 5.3 è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯


**å›½é™…åŒ–é…ç½®**ï¼š
```properties
# ValidationMessages.properties
user.username.notblank=ç”¨æˆ·åä¸èƒ½ä¸ºç©º
user.username.size=ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨{min}åˆ°{max}ä¹‹é—´
user.email.format=é‚®ç®±æ ¼å¼ä¸æ­£ç¡®
user.age.range=å¹´é¾„å¿…é¡»åœ¨{min}åˆ°{max}ä¹‹é—´
```

**ä½¿ç”¨å›½é™…åŒ–æ¶ˆæ¯**ï¼š
```java
public class User {
    @NotBlank(message = "{user.username.notblank}")
    @Size(min = 3, max = 20, message = "{user.username.size}")
    private String username;
    
    @Email(message = "{user.email.format}")
    private String email;
    
    @Min(value = 1, message = "{user.age.range}")
    @Max(value = 150, message = "{user.age.range}")
    private Integer age;
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Bean Validationï¼šJavaæ•°æ®æ ¡éªŒè§„èŒƒæ ‡å‡†
ğŸ”¸ å¸¸ç”¨æ³¨è§£ï¼š@NotNullã€@NotBlankã€@Sizeã€@Emailã€@Pattern
ğŸ”¸ æ ¡éªŒæ—¶æœºï¼šå…¥å‚æ ¡éªŒ(æ¨è) vs æŒä¹…åŒ–æ ¡éªŒ(å…œåº•)
ğŸ”¸ è§¦å‘æ–¹å¼ï¼š@Valid/@Validatedè§¦å‘æ ¡éªŒ
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨å¤„ç†æ ¡éªŒå¼‚å¸¸
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸‰ä¸ªéç©ºæ³¨è§£çš„åŒºåˆ«**
```
@NotNull     â†’ åªæ£€æŸ¥null
@NotEmpty    â†’ æ£€æŸ¥nullå’Œç©ºï¼ˆç©ºå­—ç¬¦ä¸²ã€ç©ºé›†åˆï¼‰
@NotBlank    â†’ æ£€æŸ¥nullã€ç©ºå’Œç©ºæ ¼ï¼ˆæœ€ä¸¥æ ¼ï¼‰

è®°å¿†æŠ€å·§ï¼š
NotNull   < NotEmpty < NotBlank
å®½æ¾    â†’    â†’    â†’  ä¸¥æ ¼
```

**ğŸ”¹ ä¸¤ç§æ ¡éªŒæ—¶æœºçš„é€‰æ‹©**
```
å…¥å‚æ ¡éªŒ(@Valid)ï¼š
âœ… å¿«é€Ÿåé¦ˆï¼Œç”¨æˆ·ä½“éªŒå¥½
âœ… ç¬¬ä¸€æ—¶é—´æ‹¦æˆªé”™è¯¯
âœ… é€‚åˆAPIæ¥å£ã€è¡¨å•æäº¤

æŒä¹…åŒ–æ ¡éªŒ(JPA)ï¼š
âœ… å…œåº•ä¿æŠ¤ï¼Œé˜²æ­¢è„æ•°æ®
âœ… é€‚åˆæ‰¹é‡å¯¼å…¥ã€åå°ä»»åŠ¡
âœ… ä¸æ•°æ®åº“çº¦æŸé…åˆä½¿ç”¨

æœ€ä½³å®è·µï¼šä¸¤è€…ç»“åˆï¼ŒåŒé‡ä¿éšœ
```

**ğŸ”¹ åµŒå¥—æ ¡éªŒçš„æ³¨æ„äº‹é¡¹**
```
å…³é”®ç‚¹ï¼šåµŒå¥—å¯¹è±¡å¿…é¡»åŠ @Valid

âŒ é”™è¯¯å†™æ³•ï¼š
@NotNull
private Address address;  // åªæ ¡éªŒaddressä¸ä¸ºnull

âœ… æ­£ç¡®å†™æ³•ï¼š
@Valid
@NotNull
private Address address;  // åŒæ—¶æ ¡éªŒaddresså†…éƒ¨å­—æ®µ
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- ğŸ¯ **ç”¨æˆ·æ³¨å†Œ**ï¼šç”¨æˆ·åã€å¯†ç ã€é‚®ç®±ã€æ‰‹æœºå·æ ¼å¼æ ¡éªŒ
- ğŸ¯ **è®¢å•æäº¤**ï¼šå•†å“æ•°é‡ã€é‡‘é¢èŒƒå›´ã€åœ°å€ä¿¡æ¯æ ¡éªŒ
- ğŸ¯ **æ•°æ®å¯¼å…¥**ï¼šæ‰¹é‡æ•°æ®é€æ¡æ ¡éªŒï¼Œæ”¶é›†é”™è¯¯ä¿¡æ¯
- ğŸ¯ **è¡¨å•æäº¤**ï¼šå¤šå­—æ®µè”åˆæ ¡éªŒï¼Œåˆ†ç»„æ ¡éªŒ

**å¼€å‘å®è·µå»ºè®®**ï¼š
```
âœ… ä¼˜å…ˆä½¿ç”¨å…¥å‚æ ¡éªŒ(@Valid)
âœ… å®ä½“ç±»ä¿ç•™æ ¡éªŒæ³¨è§£ä½œä¸ºå…œåº•
âœ… ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€é”™è¯¯è¿”å›
âœ… è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯æå‡ç”¨æˆ·ä½“éªŒ
âœ… åˆç†ä½¿ç”¨åˆ†ç»„æ ¡éªŒå¤„ç†ä¸åŒä¸šåŠ¡åœºæ™¯
```

### 6.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| æ ¡éªŒä¸ç”Ÿæ•ˆ | å¿˜è®°åŠ `@Valid` | Controllerå‚æ•°åŠ `@Valid` |
| åµŒå¥—å¯¹è±¡æœªæ ¡éªŒ | åµŒå¥—å¯¹è±¡ç¼º`@Valid` | åµŒå¥—å¯¹è±¡å­—æ®µåŠ `@Valid` |
| é”™è¯¯ä¿¡æ¯ä¸å‹å¥½ | ä½¿ç”¨é»˜è®¤æ¶ˆæ¯ | è‡ªå®šä¹‰`message`å±æ€§ |
| æ–°å¢æ›´æ–°è§„åˆ™å†²çª | å…±ç”¨æ ¡éªŒè§„åˆ™ | ä½¿ç”¨åˆ†ç»„æ ¡éªŒ |

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ•°æ®æ ¡éªŒå¾ˆé‡è¦ï¼ŒBean Validationæ¥å¸®å¿™
NotNullæ£€æŸ¥ç©ºå€¼ï¼ŒNotBlankæœ€ä¸¥æ ¼
å…¥å‚æ ¡éªŒç¬¬ä¸€å…³ï¼ŒæŒä¹…åŒ–å‰å†æ£€æŸ¥
Validè§¦å‘åµŒå¥—æ ¡éªŒï¼Œå…¨å±€å¤„ç†ç»Ÿä¸€è¿”å›
```