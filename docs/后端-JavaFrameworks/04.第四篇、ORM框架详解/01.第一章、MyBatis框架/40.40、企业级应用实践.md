---
title: 40ã€ä¼ä¸šçº§åº”ç”¨å®è·µ
---
## ğŸ“š ç›®å½•


1. [ä¼ä¸šçº§åº”ç”¨åœºæ™¯æ¦‚è¿°](#1-ä¼ä¸šçº§åº”ç”¨åœºæ™¯æ¦‚è¿°)
2. [å¾®æœåŠ¡æ¶æ„é›†æˆ](#2-å¾®æœåŠ¡æ¶æ„é›†æˆ)
3. [åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†](#3-åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†)
4. [å¤šæ•°æ®æºç®¡ç†](#4-å¤šæ•°æ®æºç®¡ç†)
5. [è¯»å†™åˆ†ç¦»å®ç°](#5-è¯»å†™åˆ†ç¦»å®ç°)
6. [åˆ†åº“åˆ†è¡¨ç­–ç•¥](#6-åˆ†åº“åˆ†è¡¨ç­–ç•¥)
7. [æ•°æ®å®‰å…¨ä¿æŠ¤](#7-æ•°æ®å®‰å…¨ä¿æŠ¤)
8. [ç›‘æ§ä½“ç³»å»ºè®¾](#8-ç›‘æ§ä½“ç³»å»ºè®¾)
9. [è¿ç»´éƒ¨ç½²ç­–ç•¥](#9-è¿ç»´éƒ¨ç½²ç­–ç•¥)
10. [ç¾å¤‡å®¹é”™æœºåˆ¶](#10-ç¾å¤‡å®¹é”™æœºåˆ¶)
11. [æ‰©å±•æ€§è®¾è®¡](#11-æ‰©å±•æ€§è®¾è®¡)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

# ğŸ¯ **å­¦ä¹ è·¯å¾„å¯¼èˆª**


**å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦æŒæ¡MyBatisåŸºç¡€ã€Springæ¡†æ¶ã€æ•°æ®åº“åŸç† â†’ **å½“å‰å†…å®¹**ï¼šä¼ä¸šçº§åº”ç”¨å®è·µ â†’ **åç»­å­¦ä¹ **ï¼šå»ºè®®å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ã€äº‘åŸç”ŸæŠ€æœ¯

â±ï¸ **é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼šæœ¬ç« é¢„è®¡90åˆ†é’Ÿ | å®è·µç»ƒä¹ 60åˆ†é’Ÿ

---

## 1. ğŸ¢ ä¼ä¸šçº§åº”ç”¨åœºæ™¯æ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯ä¼ä¸šçº§åº”ç”¨



**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
ä¼ä¸šçº§åº”ç”¨ï¼šé¢å‘å¤§è§„æ¨¡ç”¨æˆ·ã€é«˜å¹¶å‘ã€é«˜å¯ç”¨çš„ç”Ÿäº§ç³»ç»Ÿ
ç‰¹ç‚¹ï¼šæ•°æ®é‡å¤§ã€è®¿é—®é‡é«˜ã€å¯é æ€§è¦æ±‚ä¸¥æ ¼
ç›®æ ‡ï¼š7Ã—24å°æ—¶ç¨³å®šè¿è¡Œï¼Œç§’çº§å“åº”ç”¨æˆ·è¯·æ±‚
```

**ğŸ’¡ é€šä¿—ç†è§£**

æƒ³è±¡ä½ å¼€äº†ä¸€å®¶å°é¤é¦†å’Œä¸€å®¶è¿é”é¤å…çš„åŒºåˆ«ï¼š

**å°é¤é¦†ï¼ˆç®€å•åº”ç”¨ï¼‰**ï¼š
- ä¸€ä¸ªå¨å¸ˆã€ä¸€ä¸ªæœåŠ¡å‘˜å°±å¤Ÿäº†
- å®¢äººå°‘ï¼Œæ‰‹å·¥è®°è´¦æœ¬è®°å½•è®¢å•
- å‡ºé—®é¢˜äº†å…³é—¨ä¼‘æ¯ä¸€å¤©ä¿®ç†

**è¿é”é¤å…ï¼ˆä¼ä¸šçº§åº”ç”¨ï¼‰**ï¼š
- å¤šä¸ªå¨å¸ˆåˆ†å·¥åˆä½œï¼Œ24å°æ—¶è¥ä¸š
- æˆåƒä¸Šä¸‡å®¢äººåŒæ—¶ç‚¹é¤ï¼Œå¿…é¡»ç”¨ç”µè„‘ç³»ç»Ÿ
- æŸä¸ªå¨æˆ¿å‡ºé—®é¢˜ï¼Œå…¶ä»–å¨æˆ¿ç»§ç»­å·¥ä½œ

### 1.2 ä¼ä¸šçº§åº”ç”¨é¢ä¸´çš„æŒ‘æˆ˜



**âš ï¸ æ ¸å¿ƒæŒ‘æˆ˜**

| æŒ‘æˆ˜ç»´åº¦ | **é—®é¢˜æè¿°** | **è§£å†³æ€è·¯** |
|---------|------------|------------|
| ğŸ”¥ **é«˜å¹¶å‘** | ä¸‡çº§ç”¨æˆ·åŒæ—¶è®¿é—® | åˆ†å¸ƒå¼éƒ¨ç½²ã€è´Ÿè½½å‡è¡¡ |
| ğŸ’¾ **å¤§æ•°æ®é‡** | æ•°æ®è¾¾åˆ°TBçº§åˆ« | åˆ†åº“åˆ†è¡¨ã€æ•°æ®å½’æ¡£ |
| ğŸ›¡ï¸ **é«˜å¯ç”¨** | ç³»ç»Ÿä¸èƒ½åœæœº | é›†ç¾¤éƒ¨ç½²ã€æ•…éšœè½¬ç§» |
| âš¡ **æ€§èƒ½è¦æ±‚** | æ¯«ç§’çº§å“åº” | ç¼“å­˜ç­–ç•¥ã€è¯»å†™åˆ†ç¦» |
| ğŸ” **å®‰å…¨ä¿éšœ** | æ•°æ®ä¸èƒ½æ³„éœ² | åŠ å¯†å­˜å‚¨ã€æƒé™æ§åˆ¶ |

### 1.3 MyBatisåœ¨ä¼ä¸šåº”ç”¨ä¸­çš„å®šä½



**ğŸ“ æŠ€æœ¯æ ˆä½ç½®**
```
å‰ç«¯å±‚ â†’ æ¥å£å±‚ â†’ ä¸šåŠ¡å±‚ â†’ æŒä¹…å±‚(MyBatis) â†’ æ•°æ®åº“
                              â†‘
                         è¿™é‡Œæ˜¯MyBatis
                         
MyBatisçš„èŒè´£ï¼š
âœ“ æŠŠJavaå¯¹è±¡å’Œæ•°æ®åº“è¡¨è¿›è¡Œæ˜ å°„
âœ“ æ‰§è¡ŒSQLè¯­å¥ï¼Œå¤„ç†ç»“æœé›†
âœ“ ç®¡ç†æ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡
```

---

## 2. ğŸŒ å¾®æœåŠ¡æ¶æ„é›†æˆ



### 2.1 å¾®æœåŠ¡æ¶æ„åŸºæœ¬æ¦‚å¿µ



**ğŸ”¸ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡**

æŠŠä¸€ä¸ªå¤§ç³»ç»Ÿæ‹†åˆ†æˆå¤šä¸ªå°æœåŠ¡ï¼Œå°±åƒæŠŠå¤§å…¬å¸æ‹†æˆå¤šä¸ªå°éƒ¨é—¨ï¼š

```
ä¼ ç»Ÿå•ä½“æ¶æ„ï¼ˆå¤§å…¬å¸ï¼‰ï¼š        å¾®æœåŠ¡æ¶æ„ï¼ˆå°éƒ¨é—¨ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”
â”‚                 â”‚           â”‚ç”¨æˆ·â”‚ â”‚è®¢å•â”‚ â”‚æ”¯ä»˜â”‚
â”‚   ä¸€ä¸ªå¤§åº”ç”¨     â”‚    â†’     â”‚æœåŠ¡â”‚ â”‚æœåŠ¡â”‚ â”‚æœåŠ¡â”‚
â”‚                 â”‚           â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â†“      â†“      â†“
      å•ä¸ªåº“                   ç‹¬ç«‹æ•°æ®åº“ ç‹¬ç«‹æ•°æ®åº“
```

**ä¼˜åŠ¿å¯¹æ¯”**ï¼š
- å•ä½“æ¶æ„ï¼šä¸€ä¸ªåŠŸèƒ½å‡ºé”™ï¼Œæ•´ä¸ªç³»ç»Ÿå´©æºƒ
- å¾®æœåŠ¡ï¼šè®¢å•æœåŠ¡æŒ‚äº†ï¼Œç”¨æˆ·è¿˜èƒ½ç™»å½•

### 2.2 MyBatisä¸Spring Cloudé›†æˆ



**ğŸ”§ é›†æˆé…ç½®ç¤ºä¾‹**

```yaml
# application.yml - æ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹é…ç½®

spring:
  application:
    name: user-service  # æœåŠ¡åç§°
  datasource:
    url: jdbc:mysql://localhost:3306/user_db
    username: root
    password: 123456

mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.example.user.entity
```

**ğŸ’¡ å…³é”®ç†è§£**ï¼š
- æ¯ä¸ªå¾®æœåŠ¡æœ‰è‡ªå·±çš„æ•°æ®åº“
- æ¯ä¸ªæœåŠ¡çš„MyBatisé…ç½®ç‹¬ç«‹
- æœåŠ¡ä¹‹é—´é€šè¿‡APIè°ƒç”¨ï¼Œä¸ç›´æ¥è®¿é—®å¯¹æ–¹æ•°æ®åº“

### 2.3 æœåŠ¡é—´æ•°æ®è®¿é—®ç­–ç•¥



**ğŸ”„ è·¨æœåŠ¡æŸ¥è¯¢æ–¹æ¡ˆ**

å‡è®¾è¦æŸ¥è¯¢"ç”¨æˆ·çš„è®¢å•ä¿¡æ¯"ï¼š

**æ–¹æ¡ˆä¸€ï¼šæ¥å£è°ƒç”¨**ï¼ˆæ¨èï¼‰
```java
// ç”¨æˆ·æœåŠ¡
@Service
public class UserService {
    @Autowired
    private OrderServiceClient orderClient;  // è¿œç¨‹è°ƒç”¨æ¥å£
    
    public UserOrderDTO getUserWithOrders(Long userId) {
        // 1. ä»æœ¬åœ°åº“æŸ¥ç”¨æˆ·
        User user = userMapper.selectById(userId);
        
        // 2. è°ƒç”¨è®¢å•æœåŠ¡è·å–è®¢å•
        List<Order> orders = orderClient.getOrdersByUserId(userId);
        
        // 3. ç»„è£…æ•°æ®è¿”å›
        return new UserOrderDTO(user, orders);
    }
}
```

**æ–¹æ¡ˆäºŒï¼šæ•°æ®å¤åˆ¶**ï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰
- æŠŠå¸¸ç”¨æ•°æ®å¤åˆ¶åˆ°æœ¬æœåŠ¡æ•°æ®åº“
- ä¼˜ç‚¹ï¼šæŸ¥è¯¢å¿«ï¼Œä¸ä¾èµ–å…¶ä»–æœåŠ¡
- ç¼ºç‚¹ï¼šæ•°æ®å¯èƒ½ä¸ä¸€è‡´

---

## 3. ğŸ”„ åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†



### 3.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡



**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**

**å•æœºäº‹åŠ¡**ï¼šåœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
**åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šè·¨å¤šä¸ªæ•°æ®åº“çš„æ“ä½œï¼Œä¹Ÿè¦ä¿è¯ä¸€è‡´æ€§

**ğŸ’¡ ç”Ÿæ´»æ¡ˆä¾‹**ï¼š

ç½‘è´­åœºæ™¯ï¼šä¸‹å•è¦åšä¸‰ä»¶äº‹
```
1. è®¢å•åº“ï¼šåˆ›å»ºè®¢å•è®°å½•
2. åº“å­˜åº“ï¼šå‡å°‘å•†å“åº“å­˜  
3. è´¦æˆ·åº“ï¼šæ‰£å‡ç”¨æˆ·ä½™é¢

é—®é¢˜ï¼šå¦‚æœè®¢å•åˆ›å»ºäº†ï¼Œä½†æ‰£æ¬¾å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
ç­”æ¡ˆï¼šå¿…é¡»å…¨éƒ¨å›æ»šï¼Œä¿è¯æ•°æ®ä¸€è‡´
```

### 3.2 åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ



**æ–¹æ¡ˆå¯¹æ¯”è¡¨**

| æ–¹æ¡ˆ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|---------|------------|
| **2PCä¸¤é˜¶æ®µæäº¤** | åè°ƒè€…ç»Ÿä¸€æ§åˆ¶ | å¼ºä¸€è‡´æ€§ | æ€§èƒ½å·®ï¼Œæœ‰é˜»å¡ | é‡‘èè½¬è´¦ |
| **TCCè¡¥å¿** | Try-Confirm-Cancel | æ€§èƒ½å¥½ | å¼€å‘å¤æ‚ | è®¢å•æ”¯ä»˜ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | å¼‚æ­¥ç¡®ä¿æœ€ç»ˆä¸€è‡´ | è§£è€¦ï¼Œé«˜æ€§èƒ½ | æœ‰å»¶è¿Ÿ | åº“å­˜æ‰£å‡ |
| **Sagaæ¨¡å¼** | ç¼–æ’è¡¥å¿æµç¨‹ | çµæ´» | å®ç°å¤æ‚ | é•¿æµç¨‹ä¸šåŠ¡ |

### 3.3 Seataåˆ†å¸ƒå¼äº‹åŠ¡å®æˆ˜



**ğŸ› ï¸ Seataé›†æˆé…ç½®**

```java
// 1. æ·»åŠ @GlobalTransactionalæ³¨è§£
@Service
public class OrderService {
    
    @GlobalTransactional  // å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡
    public void createOrder(OrderDTO orderDTO) {
        // æœ¬åœ°äº‹åŠ¡ï¼šåˆ›å»ºè®¢å•
        orderMapper.insert(order);
        
        // è¿œç¨‹è°ƒç”¨ï¼šæ‰£å‡åº“å­˜
        storageService.deduct(orderDTO.getProductId(), orderDTO.getCount());
        
        // è¿œç¨‹è°ƒç”¨ï¼šæ‰£å‡ä½™é¢
        accountService.deduct(orderDTO.getUserId(), orderDTO.getMoney());
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»šæ‰€æœ‰æ“ä½œ
    }
}
```

**æ ¸å¿ƒç†è§£**ï¼š
- Seataåƒä¸€ä¸ª"æ€»æŒ‡æŒ¥"
- ç›‘æ§æ‰€æœ‰å‚ä¸äº‹åŠ¡çš„æ•°æ®åº“
- ä¸€æ—¦æœ‰å¤±è´¥ï¼Œé€šçŸ¥å¤§å®¶ä¸€èµ·å›æ»š

---

## 4. ğŸ’¾ å¤šæ•°æ®æºç®¡ç†



### 4.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šæ•°æ®æº



**å¸¸è§åœºæ™¯**ï¼š

**åœºæ™¯ä¸€ï¼šä¸šåŠ¡éš”ç¦»**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ•°æ®åº“ â”‚  â”‚ è®¢å•æ•°æ®åº“ â”‚  â”‚ æ—¥å¿—æ•°æ®åº“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†‘              â†‘              â†‘
    â””â”€â”€â”€â”€â”€â”€â”€â”€ åŒä¸€ä¸ªåº”ç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯äºŒï¼šè¯»å†™åˆ†ç¦»**
```
åº”ç”¨ â”€â”€å†™æ“ä½œâ†’ ä¸»æ•°æ®åº“
    â””â”€è¯»æ“ä½œâ†’ ä»æ•°æ®åº“1ã€ä»æ•°æ®åº“2
```

### 4.2 åŠ¨æ€æ•°æ®æºé…ç½®



**ğŸ”§ é…ç½®å¤šä¸ªæ•°æ®æº**

```java
@Configuration
public class DataSourceConfig {
    
    // ä¸»æ•°æ®æºï¼ˆç”¨æˆ·åº“ï¼‰
    @Bean
    @ConfigurationProperties("spring.datasource.master")
    public DataSource masterDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    // ä»æ•°æ®æºï¼ˆè®¢å•åº“ï¼‰
    @Bean
    @ConfigurationProperties("spring.datasource.slave")
    public DataSource slaveDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    // åŠ¨æ€æ•°æ®æº
    @Bean
    public DataSource dynamicDataSource() {
        Map<Object, Object> dataSourceMap = new HashMap<>();
        dataSourceMap.put("master", masterDataSource());
        dataSourceMap.put("slave", slaveDataSource());
        
        DynamicDataSource dynamicDataSource = new DynamicDataSource();
        dynamicDataSource.setTargetDataSources(dataSourceMap);
        dynamicDataSource.setDefaultTargetDataSource(masterDataSource());
        return dynamicDataSource;
    }
}
```

### 4.3 æ•°æ®æºåˆ‡æ¢ç­–ç•¥



**ğŸ¯ æ³¨è§£æ–¹å¼åˆ‡æ¢**

```java
// è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataSource {
    String value() default "master";
}

// ä½¿ç”¨ç¤ºä¾‹
@Service
public class UserService {
    
    @DataSource("master")  // ä½¿ç”¨ä¸»åº“
    public void createUser(User user) {
        userMapper.insert(user);
    }
    
    @DataSource("slave")  // ä½¿ç”¨ä»åº“
    public User getUser(Long id) {
        return userMapper.selectById(id);
    }
}
```

**å·¥ä½œåŸç†**ï¼š
1. AOPæ‹¦æˆªæ–¹æ³•è°ƒç”¨
2. è¯»å–@DataSourceæ³¨è§£çš„å€¼
3. åˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®æº
4. æ‰§è¡ŒSQLæ“ä½œ

---

## 5. ğŸ“– è¯»å†™åˆ†ç¦»å®ç°



### 5.1 è¯»å†™åˆ†ç¦»åŸºæœ¬åŸç†



**ğŸ”¸ æ ¸å¿ƒæ€æƒ³**

æ•°æ®åº“å°±åƒå›¾ä¹¦é¦†ï¼š
- **ä¸»åº“ï¼ˆå†™ï¼‰**ï¼šåƒå›¾ä¹¦ç®¡ç†å‘˜ï¼Œè´Ÿè´£æ·»åŠ ã€ä¿®æ”¹å›¾ä¹¦
- **ä»åº“ï¼ˆè¯»ï¼‰**ï¼šåƒæŸ¥è¯¢æŸœå°ï¼Œåªè´Ÿè´£æŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯

```
            â”Œâ”€â”€â”€ å†™æ“ä½œ â”€â”€â†’ ä¸»æ•°æ®åº“ï¼ˆMasterï¼‰
åº”ç”¨ç¨‹åº â”€â”€â”¤                    â†“ æ•°æ®åŒæ­¥
            â””â”€â”€â”€ è¯»æ“ä½œ â”€â”€â†’ ä»æ•°æ®åº“ï¼ˆSlaveï¼‰
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**ï¼š
- è¯»æ“ä½œå 80%ï¼Œå†™æ“ä½œå 20%
- æŠŠæŸ¥è¯¢å‹åŠ›åˆ†æ•£åˆ°å¤šä¸ªä»åº“
- ä¸»åº“ä¸“æ³¨å¤„ç†å†™å…¥ï¼Œæ€§èƒ½æ›´å¥½

### 5.2 MyBatisè¯»å†™åˆ†ç¦»é…ç½®



**ğŸ› ï¸ å®ç°æ–¹æ¡ˆ**

```java
// 1. æ•°æ®æºè·¯ç”±å™¨
public class ReadWriteDataSource extends AbstractRoutingDataSource {
    
    @Override
    protected Object determineCurrentLookupKey() {
        // åˆ¤æ–­å½“å‰æ˜¯è¯»è¿˜æ˜¯å†™
        return DataSourceContextHolder.getDataSourceType();
    }
}

// 2. AOPæ‹¦æˆªå™¨
@Aspect
@Component
public class DataSourceAspect {
    
    @Before("@annotation(org.springframework.transaction.annotation.Transactional)")
    public void setWriteDataSource() {
        // æœ‰@Transactionalæ³¨è§£ï¼Œä½¿ç”¨ä¸»åº“
        DataSourceContextHolder.setDataSourceType("master");
    }
    
    @Before("execution(* com.example..*.select*(..))")
    public void setReadDataSource() {
        // selectå¼€å¤´çš„æ–¹æ³•ï¼Œä½¿ç”¨ä»åº“
        DataSourceContextHolder.setDataSourceType("slave");
    }
}
```

### 5.3 ä¸»ä»å»¶è¿Ÿå¤„ç†



**âš ï¸ å¸¸è§é—®é¢˜**

```
æ—¶é—´çº¿ï¼š
1. ç”¨æˆ·åœ¨ä¸»åº“æ’å…¥æ•°æ®  â†’ æˆåŠŸ
2. ç«‹å³æŸ¥è¯¢ï¼ˆèµ°ä»åº“ï¼‰  â†’ æŸ¥ä¸åˆ°ï¼ˆä¸»ä»åŒæ­¥éœ€è¦æ—¶é—´ï¼‰
3. ç”¨æˆ·å›°æƒ‘ï¼šæˆ‘åˆšæ·»åŠ çš„æ•°æ®å‘¢ï¼Ÿ
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆä¸€ï¼šå¼ºåˆ¶èµ°ä¸»åº“**
```java
@Service
public class UserService {
    
    @Transactional
    public void createUser(User user) {
        userMapper.insert(user);
    }
    
    @DataSource("master")  // å¼ºåˆ¶ä»ä¸»åº“è¯»
    public User getJustCreatedUser(Long id) {
        return userMapper.selectById(id);
    }
}
```

**æ–¹æ¡ˆäºŒï¼šç¼“å­˜ç­–ç•¥**
```java
// å†™å…¥æ—¶åŒæ­¥åˆ°ç¼“å­˜
@Transactional
public void createUser(User user) {
    userMapper.insert(user);
    redisTemplate.opsForValue().set("user:" + user.getId(), user, 10, TimeUnit.SECONDS);
}

// å…ˆæŸ¥ç¼“å­˜ï¼Œå†æŸ¥æ•°æ®åº“
public User getUser(Long id) {
    User user = redisTemplate.opsForValue().get("user:" + id);
    if (user == null) {
        user = userMapper.selectById(id);
    }
    return user;
}
```

---

## 6. ğŸ—‚ï¸ åˆ†åº“åˆ†è¡¨ç­–ç•¥



### 6.1 ä¸ºä»€ä¹ˆè¦åˆ†åº“åˆ†è¡¨



**ğŸ”¸ æ•°æ®é‡é—®é¢˜**

```
åœºæ™¯ï¼šç”µå•†è®¢å•è¡¨
- æ¯å¤©100ä¸‡è®¢å•
- ä¸€å¹´3.6äº¿æ¡è®°å½•
- å•è¡¨è¿‡å¤§å¯¼è‡´ï¼š
  âœ— æŸ¥è¯¢å˜æ…¢ï¼ˆç´¢å¼•éƒ½è£…ä¸è¿›å†…å­˜ï¼‰
  âœ— å¤‡ä»½å›°éš¾ï¼ˆå¤‡ä»½è¦å¥½å‡ å°æ—¶ï¼‰
  âœ— ç»´æŠ¤éº»çƒ¦ï¼ˆåŠ ä¸ªå­—æ®µéƒ½è¦é”è¡¨å¾ˆä¹…ï¼‰
```

**è§£å†³æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | **åŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|---------|---------|---------|
| **å‚ç›´åˆ†åº“** | æŒ‰ä¸šåŠ¡æ‹†åˆ† | ç®€å•æ¸…æ™° | å•è¡¨é—®é¢˜ä»å­˜åœ¨ |
| **å‚ç›´åˆ†è¡¨** | å¤§è¡¨æ‹†å°è¡¨ | å‡å°‘IO | éœ€è¦å…³è”æŸ¥è¯¢ |
| **æ°´å¹³åˆ†è¡¨** | æŒ‰è§„åˆ™æ‹†åˆ† | åˆ†æ•£æ•°æ® | å¤æ‚åº¦é«˜ |

### 6.2 åˆ†åº“åˆ†è¡¨è§„åˆ™è®¾è®¡



**ğŸ¯ å¸¸è§åˆ†ç‰‡ç­–ç•¥**

**ç­–ç•¥ä¸€ï¼šæŒ‰ç”¨æˆ·IDå–æ¨¡**
```
è§„åˆ™ï¼šuser_id % 4
ç»“æœï¼š
- user_id=1 â†’ è¡¨0 (1%4=1)
- user_id=5 â†’ è¡¨1 (5%4=1)
- user_id=8 â†’ è¡¨0 (8%4=0)

ä¼˜ç‚¹ï¼šæ•°æ®å‡åŒ€åˆ†å¸ƒ
ç¼ºç‚¹ï¼šè·¨è¡¨æŸ¥è¯¢å›°éš¾
```

**ç­–ç•¥äºŒï¼šæŒ‰æ—¶é—´èŒƒå›´**
```
è§„åˆ™ï¼šæŒ‰æœˆä»½åˆ†è¡¨
ç»“æœï¼š
- 2024å¹´1æœˆè®¢å• â†’ order_202401
- 2024å¹´2æœˆè®¢å• â†’ order_202402

ä¼˜ç‚¹ï¼šæŸ¥è¯¢å†å²æ•°æ®æ–¹ä¾¿
ç¼ºç‚¹ï¼šå½“æœˆè¡¨å‹åŠ›å¤§
```

### 6.3 ShardingSphereå®æˆ˜



**ğŸ› ï¸ ShardingSphereé…ç½®**

```yaml
# sharding-jdbcé…ç½®

spring:
  shardingsphere:
    datasource:
      names: ds0,ds1  # ä¸¤ä¸ªæ•°æ®åº“
      ds0:
        type: com.zaxxer.hikari.HikariDataSource
        url: jdbc:mysql://localhost:3306/order_db0
      ds1:
        type: com.zaxxer.hikari.HikariDataSource
        url: jdbc:mysql://localhost:3306/order_db1
    
    sharding:
      tables:
        t_order:  # è®¢å•è¡¨
          actual-data-nodes: ds${0..1}.t_order_${0..3}  # 2åº“Ã—4è¡¨=8ä¸ªåˆ†è¡¨
          database-strategy:
            inline:
              sharding-column: user_id
              algorithm-expression: ds${user_id % 2}  # æŒ‰ç”¨æˆ·IDåˆ†åº“
          table-strategy:
            inline:
              sharding-column: order_id
              algorithm-expression: t_order_${order_id % 4}  # æŒ‰è®¢å•IDåˆ†è¡¨
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// ä»£ç æ— éœ€æ”¹å˜ï¼Œæ¡†æ¶è‡ªåŠ¨è·¯ç”±
@Service
public class OrderService {
    
    public void createOrder(Order order) {
        // ShardingSphereè‡ªåŠ¨è®¡ç®—ï¼š
        // 1. user_id=100 â†’ ds0åº“ (100%2=0)
        // 2. order_id=12345 â†’ t_order_1è¡¨ (12345%4=1)
        // æœ€ç»ˆæ’å…¥ï¼šds0.t_order_1
        orderMapper.insert(order);
    }
}
```

---

## 7. ğŸ” æ•°æ®å®‰å…¨ä¿æŠ¤



### 7.1 æ•æ„Ÿæ•°æ®åŠ å¯†



**ğŸ”¸ éœ€è¦åŠ å¯†çš„æ•°æ®**

```
é«˜æ•æ„Ÿï¼šå¯†ç ã€æ”¯ä»˜å¯†é’¥ã€èº«ä»½è¯å·
ä¸­æ•æ„Ÿï¼šæ‰‹æœºå·ã€é‚®ç®±ã€æ”¶è´§åœ°å€  
ä½æ•æ„Ÿï¼šç”¨æˆ·åã€è®¢å•é‡‘é¢
```

**ğŸ’¡ åŠ å¯†ç­–ç•¥**

**æ–¹æ¡ˆä¸€ï¼šåº”ç”¨å±‚åŠ å¯†**
```java
@Service
public class UserService {
    
    @Autowired
    private AESEncryptor encryptor;
    
    public void createUser(User user) {
        // æ’å…¥å‰åŠ å¯†
        user.setPhone(encryptor.encrypt(user.getPhone()));
        user.setIdCard(encryptor.encrypt(user.getIdCard()));
        
        userMapper.insert(user);
    }
    
    public User getUser(Long id) {
        User user = userMapper.selectById(id);
        // æŸ¥è¯¢åè§£å¯†
        user.setPhone(encryptor.decrypt(user.getPhone()));
        user.setIdCard(encryptor.decrypt(user.getIdCard()));
        return user;
    }
}
```

**æ–¹æ¡ˆäºŒï¼šæ•°æ®åº“åŠ å¯†**ï¼ˆMySQL 8.0+ï¼‰
```sql
-- åˆ›å»ºè¡¨æ—¶æŒ‡å®šåŠ å¯†
CREATE TABLE user (
    id BIGINT PRIMARY KEY,
    name VARCHAR(50),
    phone VARCHAR(20) ENCRYPTED  -- è‡ªåŠ¨åŠ å¯†
) ENCRYPTION='Y';
```

### 7.2 SQLæ³¨å…¥é˜²æŠ¤



**âš ï¸ å±é™©ç¤ºä¾‹**

```xml
<!-- é”™è¯¯ç¤ºä¾‹ï¼šæ‹¼æ¥SQLï¼Œæœ‰æ³¨å…¥é£é™© -->
<select id="findUser" resultType="User">
    SELECT * FROM user WHERE name = '${name}'
</select>
```

**æ”»å‡»åœºæ™¯**ï¼š
```
æ­£å¸¸è¾“å…¥ï¼šname = "å¼ ä¸‰"
ç”ŸæˆSQLï¼šSELECT * FROM user WHERE name = 'å¼ ä¸‰'

æ¶æ„è¾“å…¥ï¼šname = "' OR '1'='1"  
ç”ŸæˆSQLï¼šSELECT * FROM user WHERE name = '' OR '1'='1'
ç»“æœï¼šæŸ¥å‡ºæ‰€æœ‰ç”¨æˆ·ï¼
```

**âœ… æ­£ç¡®åšæ³•**

```xml
<!-- ä½¿ç”¨#{}å‚æ•°åŒ–æŸ¥è¯¢ -->
<select id="findUser" resultType="User">
    SELECT * FROM user WHERE name = #{name}
</select>
```

MyBatisä¼šè‡ªåŠ¨å¤„ç†ï¼š
```sql
-- è½¬æ¢ä¸ºé¢„ç¼–è¯‘è¯­å¥
SELECT * FROM user WHERE name = ?
-- å‚æ•°å•ç‹¬ç»‘å®šï¼Œæ— æ³•æ³¨å…¥
```

### 7.3 æƒé™æ§åˆ¶



**ğŸ¯ æ•°æ®æƒé™è®¾è®¡**

```java
// åŸºäºæ‹¦æˆªå™¨å®ç°æ•°æ®æƒé™
@Intercepts({
    @Signature(type = Executor.class, method = "query")
})
public class DataPermissionInterceptor implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        // è·å–å½“å‰ç”¨æˆ·
        User currentUser = SecurityContextHolder.getCurrentUser();
        
        // æ™®é€šç”¨æˆ·åªèƒ½æŸ¥è‡ªå·±çš„æ•°æ®
        if (!currentUser.isAdmin()) {
            // åŠ¨æ€æ·»åŠ WHEREæ¡ä»¶
            String originalSql = getOriginalSql(invocation);
            String newSql = originalSql + " AND user_id = " + currentUser.getId();
            setNewSql(invocation, newSql);
        }
        
        return invocation.proceed();
    }
}
```

---

## 8. ğŸ“Š ç›‘æ§ä½“ç³»å»ºè®¾



### 8.1 æ€§èƒ½ç›‘æ§æŒ‡æ ‡



**ğŸ“ˆ æ ¸å¿ƒç›‘æ§é¡¹**

```
ğŸ”¸ æ…¢SQLç›‘æ§
- é˜ˆå€¼ï¼šè¶…è¿‡1ç§’çš„SQL
- å‘Šè­¦ï¼šå®æ—¶æ¨é€åˆ°è¿ç»´ç¾¤
- å¤„ç†ï¼šä¼˜åŒ–ç´¢å¼•æˆ–SQL

ğŸ”¸ è¿æ¥æ± ç›‘æ§  
- æ´»è·ƒè¿æ¥æ•°
- ç­‰å¾…è¿æ¥æ•°
- è¿æ¥è¶…æ—¶æ¬¡æ•°

ğŸ”¸ äº‹åŠ¡ç›‘æ§
- äº‹åŠ¡æ‰§è¡Œæ—¶é•¿
- å›æ»šæ¬¡æ•°
- æ­»é”é¢‘ç‡
```

### 8.2 é›†æˆç›‘æ§å·¥å…·



**ğŸ› ï¸ Druidç›‘æ§é…ç½®**

```yaml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
#      # å¼€å¯ç›‘æ§
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*  # è®¿é—® http://localhost:8080/druid
        login-username: admin
        login-password: admin123
      
#      # æ…¢SQLè®°å½•  
      filter:
        stat:
          enabled: true
          slow-sql-millis: 1000  # è¶…è¿‡1ç§’è®°å½•
          log-slow-sql: true
```

**ç›‘æ§ç•Œé¢å±•ç¤ºå†…å®¹**ï¼š
- SQLæ‰§è¡Œç»Ÿè®¡ï¼ˆæ¬¡æ•°ã€è€—æ—¶ï¼‰
- è¿æ¥æ± çŠ¶æ€ï¼ˆæ´»è·ƒã€ç©ºé—²ï¼‰
- Webåº”ç”¨ç»Ÿè®¡ï¼ˆURLè®¿é—®é‡ï¼‰

### 8.3 å‘Šè­¦æœºåˆ¶



**âš ï¸ å‘Šè­¦è§„åˆ™è®¾è®¡**

```java
@Component
public class DatabaseMonitor {
    
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ£€æŸ¥
    public void checkSlowSql() {
        List<SlowSql> slowSqlList = druidStatService.getSlowSqlList();
        
        if (slowSqlList.size() > 10) {
            // 1åˆ†é’Ÿå†…è¶…è¿‡10æ¡æ…¢SQL
            sendAlert("æ…¢SQLå‘Šè­¦", "æ…¢SQLæ•°é‡: " + slowSqlList.size());
        }
    }
    
    @Scheduled(fixedRate = 30000)  // æ¯30ç§’æ£€æŸ¥
    public void checkConnectionPool() {
        int activeCount = druidDataSource.getActiveCount();
        int maxActive = druidDataSource.getMaxActive();
        
        if (activeCount > maxActive * 0.8) {
            // è¿æ¥æ•°è¶…è¿‡80%
            sendAlert("è¿æ¥æ± å‘Šè­¦", "è¿æ¥æ•°: " + activeCount + "/" + maxActive);
        }
    }
}
```

---

## 9. ğŸš€ è¿ç»´éƒ¨ç½²ç­–ç•¥



### 9.1 ç¯å¢ƒéš”ç¦»



**ğŸ”¸ å¤šç¯å¢ƒé…ç½®**

```
é¡¹ç›®ç»“æ„ï¼š
â”œâ”€â”€ application.yml              # å…¬å…±é…ç½®
â”œâ”€â”€ application-dev.yml          # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ application-test.yml         # æµ‹è¯•ç¯å¢ƒ
â””â”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒ
```

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# application-prod.yml - ç”Ÿäº§ç¯å¢ƒ

spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/mydb
    hikari:
      maximum-pool-size: 50      # ç”Ÿäº§ç¯å¢ƒå¤§è¿æ¥æ± 
      minimum-idle: 10

mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl  # ç”Ÿäº§ç”¨æ—¥å¿—æ¡†æ¶
```

### 9.2 ç°åº¦å‘å¸ƒ



**ğŸ¯ å‘å¸ƒç­–ç•¥**

```
é˜¶æ®µ1ï¼šå‘å¸ƒ10%æµé‡
    â†“ è§‚å¯Ÿ30åˆ†é’Ÿï¼Œæ— å¼‚å¸¸
é˜¶æ®µ2ï¼šå‘å¸ƒ30%æµé‡
    â†“ è§‚å¯Ÿ30åˆ†é’Ÿï¼Œæ— å¼‚å¸¸
é˜¶æ®µ3ï¼šå‘å¸ƒ50%æµé‡
    â†“ è§‚å¯Ÿ30åˆ†é’Ÿï¼Œæ— å¼‚å¸¸  
é˜¶æ®µ4ï¼šå‘å¸ƒ100%æµé‡
```

**Nginxé…ç½®å®ç°**ï¼š
```nginx
upstream backend {
    server 192.168.1.10:8080 weight=9;  # æ—§ç‰ˆæœ¬90%
    server 192.168.1.11:8080 weight=1;  # æ–°ç‰ˆæœ¬10%
}
```

### 9.3 æ•°æ®åº“å˜æ›´ç®¡ç†



**ğŸ”„ Flywayæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†**

```sql
-- V1__init_user_table.sql
CREATE TABLE user (
    id BIGINT PRIMARY KEY,
    name VARCHAR(50)
);

-- V2__add_phone_column.sql  
ALTER TABLE user ADD COLUMN phone VARCHAR(20);
```

**å¥½å¤„**ï¼š
- æ•°æ®åº“å˜æ›´å¯è¿½æº¯
- è‡ªåŠ¨æ‰§è¡Œå‡çº§è„šæœ¬
- å›æ»šæœ‰å†å²è®°å½•

---

## 10. ğŸ›¡ï¸ ç¾å¤‡å®¹é”™æœºåˆ¶



### 10.1 æ•°æ®å¤‡ä»½ç­–ç•¥



**ğŸ“¦ å¤‡ä»½æ–¹æ¡ˆè®¾è®¡**

```
å®Œæ•´å¤‡ä»½ï¼šæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹
å¢é‡å¤‡ä»½ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹
æ—¥å¿—å¤‡ä»½ï¼šå®æ—¶å¤‡ä»½binlog

å¤‡ä»½ä¿ç•™ï¼š
- è¿‘7å¤©ï¼šæ¯æ—¥å¤‡ä»½
- è¿‘1æœˆï¼šæ¯å‘¨å¤‡ä»½
- è¿‘1å¹´ï¼šæ¯æœˆå¤‡ä»½
```

**è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬**ï¼š
```bash
#!/bin/bash

# æ•°æ®åº“å¤‡ä»½è„šæœ¬


DATE=$(date +%Y%m%d)
BACKUP_DIR="/data/backup/$DATE"
DB_NAME="mydb"

# æ‰§è¡Œå¤‡ä»½

mysqldump -u root -p$PASSWORD $DB_NAME > $BACKUP_DIR/${DB_NAME}_${DATE}.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶

gzip $BACKUP_DIR/${DB_NAME}_${DATE}.sql

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨

aws s3 cp $BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz s3://backup-bucket/
```

### 10.2 æ•…éšœåˆ‡æ¢æœºåˆ¶



**ğŸ”„ ä¸»ä»åˆ‡æ¢æµç¨‹**

```
æ­£å¸¸æƒ…å†µï¼š
åº”ç”¨ â†’ ä¸»åº“ï¼ˆè¯»å†™ï¼‰ â†’ åŒæ­¥ â†’ ä»åº“ï¼ˆåªè¯»ï¼‰

ä¸»åº“æ•…éšœï¼š
1. æ£€æµ‹åˆ°ä¸»åº“ä¸å¯ç”¨
2. æå‡ä»åº“ä¸ºæ–°ä¸»åº“
3. åº”ç”¨åˆ‡æ¢åˆ°æ–°ä¸»åº“
4. ä¿®å¤æ—§ä¸»åº“ä½œä¸ºä»åº“
```

**MHAé«˜å¯ç”¨æ–¹æ¡ˆ**ï¼š
- è‡ªåŠ¨æ£€æµ‹ä¸»åº“æ•…éšœï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰
- è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ä»åº“
- è‡ªåŠ¨æå‡ä»åº“ä¸ºä¸»åº“
- é€šçŸ¥åº”ç”¨åˆ‡æ¢è¿æ¥

### 10.3 æ•°æ®æ¢å¤æ¼”ç»ƒ



**ğŸ“ æ¢å¤æ­¥éª¤**

```
åœºæ™¯ï¼šè¯¯åˆ é™¤è®¢å•è¡¨æ•°æ®

æ¢å¤æ­¥éª¤ï¼š
1. åœæ­¢åº”ç”¨å†™å…¥
2. ä»å¤‡ä»½æ¢å¤åˆ°ä¸´æ—¶åº“
3. å¯¼å‡ºéœ€è¦çš„æ•°æ®
4. å¯¼å…¥åˆ°ç”Ÿäº§åº“
5. éªŒè¯æ•°æ®å®Œæ•´æ€§
6. æ¢å¤åº”ç”¨æœåŠ¡
```

**æœ€ä½³å®è·µ**ï¼š
- æ¯å­£åº¦æ¼”ç»ƒä¸€æ¬¡
- è®°å½•æ¢å¤æ—¶é—´ï¼ˆRTOç›®æ ‡ï¼‰
- éªŒè¯æ•°æ®å®Œæ•´æ€§ï¼ˆRPOç›®æ ‡ï¼‰

---

## 11. ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡



### 11.1 æ°´å¹³æ‰©å±•èƒ½åŠ›



**ğŸ”¸ æ‰©å±•æ€§è®¾è®¡åŸåˆ™**

```
æ— çŠ¶æ€è®¾è®¡ï¼š
âœ“ åº”ç”¨æœåŠ¡å™¨ä¸å­˜å‚¨çŠ¶æ€
âœ“ ç”¨æˆ·sessionå­˜Redis
âœ“ å¯éšæ—¶å¢åŠ æœåŠ¡å™¨èŠ‚ç‚¹

æ•°æ®åº“æ‰©å±•ï¼š
âœ“ è¯»å†™åˆ†ç¦»æ”¯æŒæ·»åŠ ä»åº“
âœ“ åˆ†åº“åˆ†è¡¨é¢„ç•™æ‰©å±•ç©ºé—´
âœ“ ä½¿ç”¨ä¸­é—´ä»¶å®ç°é€æ˜æ‰©å±•
```

### 11.2 ç¼“å­˜ç­–ç•¥ä¼˜åŒ–



**ğŸš€ å¤šçº§ç¼“å­˜æ¶æ„**

```
è¯·æ±‚æµç¨‹ï¼š
1. æŸ¥æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰â†’ å‘½ä¸­è¿”å›
2. æŸ¥åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRedisï¼‰â†’ å‘½ä¸­è¿”å›  
3. æŸ¥æ•°æ®åº“ â†’ æ›´æ–°ç¼“å­˜ â†’ è¿”å›

ç¼“å­˜æ—¶é—´è®¾ç½®ï¼š
- çƒ­ç‚¹æ•°æ®ï¼š1å°æ—¶
- æ™®é€šæ•°æ®ï¼š10åˆ†é’Ÿ
- ä½é¢‘æ•°æ®ï¼šä¸ç¼“å­˜
```

**ç¼“å­˜ä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
public class ProductService {
    
    @Cacheable(value = "product", key = "#id", unless = "#result == null")
    public Product getProduct(Long id) {
        // å…ˆæŸ¥ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰æ‰æŸ¥æ•°æ®åº“
        return productMapper.selectById(id);
    }
    
    @CacheEvict(value = "product", key = "#product.id")
    public void updateProduct(Product product) {
        // æ›´æ–°åæ¸…é™¤ç¼“å­˜
        productMapper.updateById(product);
    }
}
```

### 11.3 å¼¹æ€§ä¼¸ç¼©



**âš¡ è‡ªåŠ¨æ‰©ç¼©å®¹**

```
æ‰©å®¹è§¦å‘æ¡ä»¶ï¼š
- CPUä½¿ç”¨ç‡ > 70%
- å†…å­˜ä½¿ç”¨ç‡ > 80%
- è¯·æ±‚å“åº”æ—¶é—´ > 1ç§’

ç¼©å®¹è§¦å‘æ¡ä»¶ï¼š  
- CPUä½¿ç”¨ç‡ < 30% (æŒç»­15åˆ†é’Ÿ)
- å†…å­˜ä½¿ç”¨ç‡ < 40% (æŒç»­15åˆ†é’Ÿ)
```

**K8sè‡ªåŠ¨æ‰©ç¼©å®¹é…ç½®**ï¼š
```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: myapp-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: myapp
  minReplicas: 2    # æœ€å°‘2ä¸ªå®ä¾‹
  maxReplicas: 10   # æœ€å¤š10ä¸ªå®ä¾‹
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70  # CPUè¶…70%æ‰©å®¹
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 12.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ å¾®æœåŠ¡é›†æˆï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“ï¼Œé€šè¿‡APIé€šä¿¡
ğŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡ï¼šä½¿ç”¨Seataç­‰ä¿è¯è·¨åº“æ“ä½œä¸€è‡´æ€§
ğŸ”¸ å¤šæ•°æ®æºï¼šåŠ¨æ€åˆ‡æ¢ä¸åŒæ•°æ®åº“ï¼Œæ”¯æŒè¯»å†™åˆ†ç¦»
ğŸ”¸ è¯»å†™åˆ†ç¦»ï¼šä¸»åº“å†™å…¥ï¼Œä»åº“æŸ¥è¯¢ï¼Œæå‡æ€§èƒ½
ğŸ”¸ åˆ†åº“åˆ†è¡¨ï¼šæ•°æ®é‡å¤§æ—¶æ‹†åˆ†ï¼Œä½¿ç”¨ShardingSphere
ğŸ”¸ æ•°æ®å®‰å…¨ï¼šåŠ å¯†å­˜å‚¨ã€é˜²æ³¨å…¥ã€æƒé™æ§åˆ¶
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§æ…¢SQLã€è¿æ¥æ± ã€äº‹åŠ¡
ğŸ”¸ ç¾å¤‡æ¢å¤ï¼šå®šæœŸå¤‡ä»½ã€ä¸»ä»åˆ‡æ¢ã€æ•…éšœæ¼”ç»ƒ
```

### 12.2 å…³é”®ç†è§£è¦ç‚¹



**ğŸ”¹ ä¼ä¸šåº”ç”¨çš„æœ¬è´¨**
```
æ ¸å¿ƒç›®æ ‡ï¼š
- é«˜æ€§èƒ½ï¼šæ¯«ç§’çº§å“åº”
- é«˜å¯ç”¨ï¼š7Ã—24å°æ—¶ä¸åœæœº
- é«˜å¹¶å‘ï¼šæ”¯æŒä¸‡çº§ç”¨æˆ·
- å¯æ‰©å±•ï¼šä¸šåŠ¡å¢é•¿ç³»ç»Ÿèƒ½è·Ÿä¸Š

å®ç°è·¯å¾„ï¼š
- æ¶æ„ï¼šå¾®æœåŠ¡æ‹†åˆ†ï¼Œåˆ†å¸ƒå¼éƒ¨ç½²
- æ•°æ®ï¼šè¯»å†™åˆ†ç¦»ï¼Œåˆ†åº“åˆ†è¡¨
- ç¼“å­˜ï¼šå¤šçº§ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›
- å®¹é”™ï¼šä¸»ä»åˆ‡æ¢ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»
```

**ğŸ”¹ æŠ€æœ¯é€‰å‹åŸåˆ™**
```
åœºæ™¯é©±åŠ¨ï¼š
- æ•°æ®é‡å°ï¼šå•åº“å•è¡¨è¶³å¤Ÿ
- è¯»å¤šå†™å°‘ï¼šè¯»å†™åˆ†ç¦»
- æ•°æ®é‡å¤§ï¼šåˆ†åº“åˆ†è¡¨
- è·¨åº“äº‹åŠ¡ï¼šåˆ†å¸ƒå¼äº‹åŠ¡

æ€§èƒ½ä¼˜å…ˆï¼š  
- èƒ½ç¼“å­˜å°±ç¼“å­˜
- èƒ½å¼‚æ­¥å°±å¼‚æ­¥
- èƒ½æ‰¹é‡å°±æ‰¹é‡

å¯ç»´æŠ¤æ€§ï¼š
- é…ç½®å¤–éƒ¨åŒ–
- æ—¥å¿—è§„èŒƒåŒ–
- ç›‘æ§è‡ªåŠ¨åŒ–
```

### 12.3 å®é™…åº”ç”¨ä»·å€¼



**ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯**

**ç”µå•†ç³»ç»Ÿ**ï¼š
- è®¢å•åº“åˆ†åº“åˆ†è¡¨ï¼ˆæŒ‰ç”¨æˆ·IDï¼‰
- å•†å“åº“è¯»å†™åˆ†ç¦»ï¼ˆä¸»å†™ä»è¯»ï¼‰
- æ”¯ä»˜ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆSeataï¼‰
- åº“å­˜ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¼‚æ­¥æ‰£å‡ï¼‰

**ç¤¾äº¤å¹³å°**ï¼š
- ç”¨æˆ·åº“åˆ†åº“ï¼ˆæŒ‰åœ°åŒºï¼‰
- åŠ¨æ€åº“åˆ†è¡¨ï¼ˆæŒ‰æ—¶é—´ï¼‰
- å…³ç³»åº“å›¾æ•°æ®åº“ï¼ˆNeo4jï¼‰
- æ¶ˆæ¯åº“æ—¶åºæ•°æ®åº“ï¼ˆInfluxDBï¼‰

### 12.4 å­¦ä¹ æ£€æŸ¥æ¸…å•



**ğŸ“ çŸ¥è¯†æŒæ¡åº¦è‡ªæµ‹**

- [ ] èƒ½é…ç½®å¾®æœåŠ¡ä¸­çš„MyBatis
- [ ] ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡çš„å¿…è¦æ€§
- [ ] ä¼šå®ç°åŠ¨æ€æ•°æ®æºåˆ‡æ¢
- [ ] èƒ½è®¾è®¡è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ
- [ ] äº†è§£åˆ†åº“åˆ†è¡¨è§„åˆ™è®¾è®¡
- [ ] æŒæ¡æ•æ„Ÿæ•°æ®åŠ å¯†æ–¹æ³•
- [ ] ä¼šé…ç½®æ•°æ®åº“ç›‘æ§
- [ ] ç†è§£ç¾å¤‡æ¢å¤æµç¨‹

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å£è¯€**
> å¾®æœåŠ¡ç‹¬ç«‹åº“ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¿ä¸€è‡´
> å¤šæºåŠ¨æ€åˆ‡ï¼Œè¯»å†™è¦åˆ†ç¦»
> æ•°æ®é‡å¤§å°±åˆ†è¡¨ï¼ŒåŠ å¯†é˜²æ³¨å…¥è¦ç‰¢è®°
> ç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œå¤‡ä»½æ¢å¤è¦æ¼”ç»ƒ

**ğŸ’¡ è¿›é˜¶å­¦ä¹ è·¯çº¿**

**ä¸‹ä¸€æ­¥å­¦ä¹ **ï¼š
1. **äº‘åŸç”ŸæŠ€æœ¯**ï¼šK8sã€Dockerã€ServiceMesh
2. **ä¸­é—´ä»¶æ·±å…¥**ï¼šRedisã€RabbitMQã€Kafka
3. **æ¶æ„è®¾è®¡**ï¼šDDDã€CQRSã€äº‹ä»¶æº¯æº
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šJVMè°ƒä¼˜ã€æ•°æ®åº“è°ƒä¼˜

**æ¨èå®è·µ**ï¼š
- æ­å»ºæœ¬åœ°åˆ†å¸ƒå¼ç¯å¢ƒï¼ˆDocker Composeï¼‰
- æ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ï¼ˆJMeterå‹æµ‹ï¼‰
- å®ç°ä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡é¡¹ç›®
- å‚ä¸å¼€æºé¡¹ç›®è´¡çŒ®ä»£ç 