---
title: 19ã€ç±»å‹å¤„ç†ç³»ç»Ÿ
---
## ğŸ“š ç›®å½•

1. [ç±»å‹å¤„ç†ç³»ç»Ÿæ¦‚è¿°](#1-ç±»å‹å¤„ç†ç³»ç»Ÿæ¦‚è¿°)
2. [TypeHandleræ¥å£æ ¸å¿ƒ](#2-TypeHandleræ¥å£æ ¸å¿ƒ)
3. [BaseTypeHandleråŸºç±»è¯¦è§£](#3-BaseTypeHandleråŸºç±»è¯¦è§£)
4. [å†…ç½®ç±»å‹å¤„ç†å™¨å…¨è§ˆ](#4-å†…ç½®ç±»å‹å¤„ç†å™¨å…¨è§ˆ)
5. [è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨å®æˆ˜](#5-è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨å®æˆ˜)
6. [ç‰¹æ®Šç±»å‹å¤„ç†æ–¹æ¡ˆ](#6-ç‰¹æ®Šç±»å‹å¤„ç†æ–¹æ¡ˆ)
7. [ç±»å‹æ³¨å†Œä¸æ˜ å°„æœºåˆ¶](#7-ç±»å‹æ³¨å†Œä¸æ˜ å°„æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç±»å‹å¤„ç†ç³»ç»Ÿæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ç±»å‹å¤„ç†ç³»ç»Ÿ


**é€šä¿—ç†è§£**ï¼šç±»å‹å¤„ç†ç³»ç»Ÿå°±åƒæ˜¯ **"ç¿»è¯‘å®˜"**ï¼Œè´Ÿè´£åœ¨ Java ç±»å‹å’Œæ•°æ®åº“ç±»å‹ä¹‹é—´åšç¿»è¯‘è½¬æ¢ã€‚

```
Java ä¸–ç•Œ                 æ•°æ®åº“ä¸–ç•Œ
String name    â†â†’ ç¿»è¯‘å®˜ â†â†’  VARCHAR name
Integer age    â†â†’ ç¿»è¯‘å®˜ â†â†’  INT age
Date birthday  â†â†’ ç¿»è¯‘å®˜ â†â†’  TIMESTAMP birthday

è¿™ä¸ª"ç¿»è¯‘å®˜"å°±æ˜¯ TypeHandlerï¼ˆç±»å‹å¤„ç†å™¨ï¼‰
```

**ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹å¤„ç†å™¨**ï¼š
- ğŸ”¸ Java å’Œæ•°æ®åº“çš„ç±»å‹ä½“ç³»**ä¸ä¸€æ ·**
- ğŸ”¸ éœ€è¦æœ‰äººè´Ÿè´£**åŒå‘è½¬æ¢**ï¼šå­˜å…¥æ•°æ®åº“ã€ä»æ•°æ®åº“è¯»å–
- ğŸ”¸ ä¿è¯æ•°æ®åœ¨ä¸¤ä¸ªä¸–ç•Œé—´**æ­£ç¡®ä¼ é€’**

### 1.2 ç±»å‹å¤„ç†ç³»ç»Ÿçš„æ ¸å¿ƒèŒè´£


**ä¸¤ä¸ªæ ¸å¿ƒå·¥ä½œ**ï¼š

**ğŸ“¤ å­˜å…¥æ•°æ®åº“ï¼ˆsetParameterï¼‰**
```
Javaå¯¹è±¡çš„å±æ€§å€¼ â†’ è½¬æ¢æˆæ•°æ®åº“è®¤è¯†çš„ç±»å‹ â†’ å­˜å…¥æ•°æ®åº“

ç¤ºä¾‹ï¼š
Java: String "å¼ ä¸‰" â†’ æ•°æ®åº“: VARCHAR 'å¼ ä¸‰'
Java: Integer 25   â†’ æ•°æ®åº“: INT 25
```

**ğŸ“¥ è¯»å–æ•°æ®ï¼ˆgetResultï¼‰**
```
æ•°æ®åº“çš„æ•°æ® â†’ è½¬æ¢æˆJavaç±»å‹ â†’ èµ‹å€¼ç»™Javaå¯¹è±¡

ç¤ºä¾‹ï¼š
æ•°æ®åº“: VARCHAR 'å¼ ä¸‰' â†’ Java: String "å¼ ä¸‰"
æ•°æ®åº“: INT 25         â†’ Java: Integer 25
```

### 1.3 å·¥ä½œåŸç†å›¾è§£


```
æ‰§è¡Œ SQL æ’å…¥æ•°æ®æ—¶ï¼š
Javaå¯¹è±¡
  User {
    name = "å¼ ä¸‰"      â† Java Stringç±»å‹
    age = 25          â† Java Integerç±»å‹
  }
         â†“
    TypeHandlerè½¬æ¢
         â†“
  PreparedStatement
    ps.setString(1, "å¼ ä¸‰")   â† æ•°æ®åº“VARCHARç±»å‹
    ps.setInt(2, 25)          â† æ•°æ®åº“INTç±»å‹
         â†“
      æ•°æ®åº“è¡¨
    name(VARCHAR) | age(INT)
    'å¼ ä¸‰'        |  25


æ‰§è¡Œ SQL æŸ¥è¯¢æ•°æ®æ—¶ï¼š
      æ•°æ®åº“è¡¨
    name(VARCHAR) | age(INT)
    'æå››'        |  30
         â†“
     ResultSet
    rs.getString("name")  â†’ "æå››"
    rs.getInt("age")      â†’ 30
         â†“
    TypeHandlerè½¬æ¢
         â†“
     Javaå¯¹è±¡
  User {
    name = "æå››"         â† è½¬æ¢ä¸ºJava String
    age = 30             â† è½¬æ¢ä¸ºJava Integer
  }
```

---

## 2. ğŸ”§ TypeHandleræ¥å£æ ¸å¿ƒ


### 2.1 TypeHandleræ¥å£å®šä¹‰


**æ¥å£ç»“æ„**ï¼šTypeHandler æ˜¯æ‰€æœ‰ç±»å‹å¤„ç†å™¨å¿…é¡»å®ç°çš„æ ¸å¿ƒæ¥å£

```java
public interface TypeHandler<T> {
    
    // è®¾ç½®å‚æ•°ï¼ˆJava â†’ æ•°æ®åº“ï¼‰
    void setParameter(
        PreparedStatement ps,  // SQLé¢„å¤„ç†å¯¹è±¡
        int i,                 // å‚æ•°ä½ç½®ï¼ˆç¬¬å‡ ä¸ª?ï¼‰
        T parameter,           // Javaå‚æ•°å€¼
        JdbcType jdbcType      // ç›®æ ‡æ•°æ®åº“ç±»å‹
    ) throws SQLException;
    
    // è·å–ç»“æœï¼ˆæ•°æ®åº“ â†’ Javaï¼‰- é€šè¿‡åˆ—å
    T getResult(
        ResultSet rs,          // æŸ¥è¯¢ç»“æœé›†
        String columnName      // åˆ—å
    ) throws SQLException;
    
    // è·å–ç»“æœï¼ˆæ•°æ®åº“ â†’ Javaï¼‰- é€šè¿‡åˆ—ç´¢å¼•
    T getResult(
        ResultSet rs,          // æŸ¥è¯¢ç»“æœé›†
        int columnIndex        // åˆ—ç´¢å¼•ï¼ˆç¬¬å‡ åˆ—ï¼‰
    ) throws SQLException;
    
    // è·å–ç»“æœï¼ˆæ•°æ®åº“ â†’ Javaï¼‰- å­˜å‚¨è¿‡ç¨‹ä¸“ç”¨
    T getResult(
        CallableStatement cs,  // å­˜å‚¨è¿‡ç¨‹è°ƒç”¨
        int columnIndex        // å‚æ•°ä½ç½®
    ) throws SQLException;
}
```

### 2.2 å››ä¸ªæ–¹æ³•çš„ä½œç”¨è¯¦è§£


**setParameter æ–¹æ³•**
- **ä½œç”¨**ï¼šæŠŠ Java å€¼è½¬æ¢åè®¾ç½®åˆ° SQL ä¸­
- **ä½¿ç”¨åœºæ™¯**ï¼šINSERTã€UPDATE è¯­å¥æ‰§è¡Œæ—¶

```
æ‰§è¡Œ SQLï¼šINSERT INTO user (name, age) VALUES (?, ?)

setParameter(ps, 1, "ç‹äº”", JdbcType.VARCHAR)
â†’ ps.setString(1, "ç‹äº”")  // ç¬¬1ä¸ª?è®¾ç½®ä¸º"ç‹äº”"

setParameter(ps, 2, 28, JdbcType.INTEGER)
â†’ ps.setInt(2, 28)  // ç¬¬2ä¸ª?è®¾ç½®ä¸º28
```

**getResult(ResultSet, String) æ–¹æ³•**
- **ä½œç”¨**ï¼šé€šè¿‡åˆ—åä»ç»“æœé›†è·å–å€¼å¹¶è½¬æ¢
- **ä½¿ç”¨åœºæ™¯**ï¼šSELECT æŸ¥è¯¢æ—¶ï¼ŒresultMap æŒ‡å®šäº†åˆ—å

```
æ‰§è¡Œ SQLï¼šSELECT name, age FROM user

getResult(rs, "name")
â†’ rs.getString("name") â†’ è¿”å›Java Stringç±»å‹

getResult(rs, "age")
â†’ rs.getInt("age") â†’ è¿”å›Java Integerç±»å‹
```

**getResult(ResultSet, int) æ–¹æ³•**
- **ä½œç”¨**ï¼šé€šè¿‡åˆ—ç´¢å¼•ä»ç»“æœé›†è·å–å€¼
- **ä½¿ç”¨åœºæ™¯**ï¼šSELECT æŸ¥è¯¢æ—¶ï¼ŒæŒ‰åˆ—é¡ºåºæ˜ å°„

```
æ‰§è¡Œ SQLï¼šSELECT name, age FROM user

getResult(rs, 1)  // ç¬¬1åˆ—
â†’ rs.getString(1) â†’ è¿”å›nameçš„å€¼

getResult(rs, 2)  // ç¬¬2åˆ—
â†’ rs.getInt(2) â†’ è¿”å›ageçš„å€¼
```

### 2.3 æ ¸å¿ƒè®¾è®¡æ€æƒ³


**ğŸ¯ è®¾è®¡åŸåˆ™**ï¼š
- âœ… **å•ä¸€èŒè´£**ï¼šæ¯ä¸ª TypeHandler åªè´Ÿè´£ä¸€ç§ç±»å‹è½¬æ¢
- âœ… **åŒå‘è½¬æ¢**ï¼šæ—¢èƒ½å­˜ä¹Ÿèƒ½å–
- âœ… **çµæ´»å–å€¼**ï¼šæ”¯æŒåˆ—åå’Œç´¢å¼•ä¸¤ç§æ–¹å¼
- âœ… **å­˜å‚¨è¿‡ç¨‹æ”¯æŒ**ï¼šå…¼å®¹å¤æ‚åœºæ™¯

---

## 3. ğŸ“¦ BaseTypeHandleråŸºç±»è¯¦è§£


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦ BaseTypeHandler


**é—®é¢˜**ï¼šç›´æ¥å®ç° TypeHandler æ¥å£æœ‰ä»€ä¹ˆéº»çƒ¦ï¼Ÿ
- âŒ éœ€è¦å®ç° **4 ä¸ªæ–¹æ³•**ï¼Œä»£ç é‡å¤å¤š
- âŒ éœ€è¦è‡ªå·±å¤„ç† **null å€¼**åˆ¤æ–­
- âŒ éœ€è¦è‡ªå·±å¤„ç† **å¼‚å¸¸**æƒ…å†µ

**è§£å†³æ–¹æ¡ˆ**ï¼šBaseTypeHandler æŠ½è±¡ç±»å¸®æˆ‘ä»¬è§£å†³è¿™äº›é—®é¢˜

```
TypeHandler æ¥å£ï¼ˆ4ä¸ªæ–¹æ³•ï¼‰
         â†“
BaseTypeHandler åŸºç±»ï¼ˆæ¨¡æ¿æ¨¡å¼ï¼‰
  - å¤„ç† null å€¼
  - å¤„ç†å¼‚å¸¸
  - ç®€åŒ–ä¸º2ä¸ªæ ¸å¿ƒæ–¹æ³•
         â†“
è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ï¼ˆåªéœ€å…³æ³¨æ ¸å¿ƒé€»è¾‘ï¼‰
```

### 3.2 BaseTypeHandler æºç è§£æ


```java
public abstract class BaseTypeHandler<T> implements TypeHandler<T> {
    
    // 1. setParameter - å·²ç»å¸®ä½ å¤„ç†äº†nullå€¼
    @Override
    public void setParameter(PreparedStatement ps, int i, 
                           T parameter, JdbcType jdbcType) {
        if (parameter == null) {
            // nullå€¼çš„å¤„ç†ï¼šè®¾ç½®ä¸ºæ•°æ®åº“NULL
            ps.setNull(i, jdbcType.TYPE_CODE);
        } else {
            // énullå€¼ï¼šè°ƒç”¨ä½ è‡ªå·±å®ç°çš„æ–¹æ³•
            setNonNullParameter(ps, i, parameter, jdbcType);
        }
    }
    
    // 2. getResult(é€šè¿‡åˆ—å) - å·²ç»å¸®ä½ å¤„ç†äº†nullå€¼
    @Override
    public T getResult(ResultSet rs, String columnName) {
        T result = getNonNullResult(rs, columnName);
        // å¦‚æœæ•°æ®åº“å­—æ®µæ˜¯nullï¼ŒwasNull()è¿”å›true
        return rs.wasNull() ? null : result;
    }
    
    // å…¶ä»–ä¸¤ä¸ªgetResultæ–¹æ³•ç±»ä¼¼...
    
    // ä½ åªéœ€è¦å®ç°è¿™ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼
    public abstract void setNonNullParameter(
        PreparedStatement ps, int i, T parameter, JdbcType jdbcType
    ) throws SQLException;
    
    public abstract T getNonNullResult(
        ResultSet rs, String columnName
    ) throws SQLException;
    
    public abstract T getNonNullResult(
        ResultSet rs, int columnIndex
    ) throws SQLException;
    
    public abstract T getNonNullResult(
        CallableStatement cs, int columnIndex
    ) throws SQLException;
}
```

### 3.3 BaseTypeHandler çš„ä¼˜åŠ¿


| ç›´æ¥å®ç° TypeHandler | ç»§æ‰¿ BaseTypeHandler |
|---------------------|---------------------|
| éœ€è¦å®ç° **4ä¸ªæ–¹æ³•** | åªéœ€å®ç° **2-3ä¸ªæ–¹æ³•** |
| è‡ªå·±å¤„ç† null å€¼ | **è‡ªåŠ¨å¤„ç†** null å€¼ |
| è‡ªå·±å¤„ç†å¼‚å¸¸ | **ç»Ÿä¸€å¼‚å¸¸**å¤„ç† |
| ä»£ç é‡å¤å¤š | **ä»£ç ç®€æ´** |

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
> è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨æ—¶ï¼Œ**ä¼˜å…ˆç»§æ‰¿ BaseTypeHandler**ï¼Œè€Œä¸æ˜¯ç›´æ¥å®ç° TypeHandler æ¥å£

---

## 4. ğŸ—‚ï¸ å†…ç½®ç±»å‹å¤„ç†å™¨å…¨è§ˆ


### 4.1 MyBatis å†…ç½®ç±»å‹å¤„ç†å™¨åˆ†ç±»


MyBatis å·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡äº† **40+ ä¸ª**å¸¸ç”¨çš„ç±»å‹å¤„ç†å™¨ï¼Œè¦†ç›–äº†å¤§éƒ¨åˆ†åœºæ™¯ã€‚

**ğŸ“Š ç±»å‹å¤„ç†å™¨åˆ†ç±»è¡¨**

| ç±»åˆ« | Javaç±»å‹ | JDBCç±»å‹ | TypeHandlerç±» |
|-----|---------|---------|--------------|
| **å­—ç¬¦ä¸²ç±»å‹** | `String` | VARCHAR/CHAR | StringTypeHandler |
| **æ•´æ•°ç±»å‹** | `Integer` | INTEGER | IntegerTypeHandler |
| | `Long` | BIGINT | LongTypeHandler |
| | `Short` | SMALLINT | ShortTypeHandler |
| | `Byte` | TINYINT | ByteTypeHandler |
| **æµ®ç‚¹ç±»å‹** | `Double` | DOUBLE | DoubleTypeHandler |
| | `Float` | FLOAT | FloatTypeHandler |
| | `BigDecimal` | DECIMAL/NUMERIC | BigDecimalTypeHandler |
| **å¸ƒå°”ç±»å‹** | `Boolean` | BOOLEAN/BIT | BooleanTypeHandler |
| **æ—¥æœŸç±»å‹** | `Date` | TIMESTAMP | DateTypeHandler |
| | `java.sql.Date` | DATE | SqlDateTypeHandler |
| | `java.sql.Time` | TIME | SqlTimeTypeHandler |
| | `java.sql.Timestamp` | TIMESTAMP | SqlTimestampTypeHandler |
| **å­—èŠ‚æ•°ç»„** | `byte[]` | BLOB/BINARY | ByteArrayTypeHandler |
| **å¯¹è±¡ç±»å‹** | `Object` | OTHER | ObjectTypeHandler |

### 4.2 å¸¸ç”¨ç±»å‹å¤„ç†å™¨è¯¦è§£


**ğŸ”¤ å­—ç¬¦ä¸²ç±»å‹å¤„ç†å™¨**

```java
// StringTypeHandlerï¼šæœ€å¸¸ç”¨çš„ç±»å‹å¤„ç†å™¨
public class StringTypeHandler extends BaseTypeHandler<String> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    String parameter, JdbcType jdbcType) {
        ps.setString(i, parameter);  // ç›´æ¥è®¾ç½®å­—ç¬¦ä¸²
    }
    
    @Override
    public String getNonNullResult(ResultSet rs, String columnName) {
        return rs.getString(columnName);  // ç›´æ¥è·å–å­—ç¬¦ä¸²
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… ç”¨æˆ·åã€åœ°å€ã€æè¿°ç­‰æ–‡æœ¬å­—æ®µ
- âœ… å¯¹åº”æ•°æ®åº“çš„ VARCHARã€CHAR ç±»å‹

**ğŸ”¢ æ•´æ•°ç±»å‹å¤„ç†å™¨**

```java
// IntegerTypeHandlerï¼šå¤„ç†æ•´æ•°
public class IntegerTypeHandler extends BaseTypeHandler<Integer> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    Integer parameter, JdbcType jdbcType) {
        ps.setInt(i, parameter);  // è®¾ç½®intå€¼
    }
    
    @Override
    public Integer getNonNullResult(ResultSet rs, String columnName) {
        // è·å–intå€¼ï¼Œè‡ªåŠ¨è£…ç®±ä¸ºInteger
        return rs.getInt(columnName);
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… å¹´é¾„ã€æ•°é‡ã€ID ç­‰æ•´æ•°å­—æ®µ
- âœ… å¯¹åº”æ•°æ®åº“çš„ INTã€INTEGER ç±»å‹

### 4.3 ç±»å‹å¤„ç†å™¨è‡ªåŠ¨æ˜ å°„


**MyBatis çš„æ™ºèƒ½ä¹‹å¤„**ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ **ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®š** TypeHandler

```xml
<!-- MyBatisä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„TypeHandler -->
<insert id="insertUser">
    INSERT INTO user (name, age, salary, is_vip)
    VALUES (#{name}, #{age}, #{salary}, #{isVip})
</insert>

è‡ªåŠ¨æ˜ å°„è¿‡ç¨‹ï¼š
name(String)    â†’ è‡ªåŠ¨é€‰æ‹© StringTypeHandler  â†’ VARCHAR
age(Integer)    â†’ è‡ªåŠ¨é€‰æ‹© IntegerTypeHandler â†’ INT
salary(BigDecimal) â†’ è‡ªåŠ¨é€‰æ‹© BigDecimalTypeHandler â†’ DECIMAL
isVip(Boolean)  â†’ è‡ªåŠ¨é€‰æ‹© BooleanTypeHandler â†’ BOOLEAN
```

**è‡ªåŠ¨æ˜ å°„è§„åˆ™**ï¼š
1. æ ¹æ® **Java ç±»å‹**åŒ¹é…å¯¹åº”çš„ TypeHandler
2. æ ¹æ® **JDBC ç±»å‹**è¿›ä¸€æ­¥ç¡®è®¤ï¼ˆå¦‚æœæŒ‡å®šäº† jdbcTypeï¼‰
3. ä» **TypeHandlerRegistry**ï¼ˆç±»å‹å¤„ç†å™¨æ³¨å†Œè¡¨ï¼‰ä¸­æŸ¥æ‰¾

---

## 5. ğŸ› ï¸ è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨å®æˆ˜


### 5.1 ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰


**éœ€è¦è‡ªå®šä¹‰çš„åœºæ™¯**ï¼š
- âŒ å†…ç½® TypeHandler **æ— æ³•æ»¡è¶³**éœ€æ±‚
- âŒ éœ€è¦**ç‰¹æ®Šçš„è½¬æ¢é€»è¾‘**
- âŒ éœ€è¦å¤„ç†**è‡ªå®šä¹‰çš„ Java ç±»å‹**

**å¸¸è§éœ€æ±‚ä¸¾ä¾‹**ï¼š
- ğŸ”¸ æšä¸¾ç±»å‹çš„å­˜å‚¨ï¼ˆå­˜ç¼–ç è€Œä¸æ˜¯åç§°ï¼‰
- ğŸ”¸ JSON å­—ç¬¦ä¸²ä¸å¯¹è±¡çš„è½¬æ¢
- ğŸ”¸ åŠ å¯†å­—æ®µçš„è‡ªåŠ¨åŠ è§£å¯†
- ğŸ”¸ è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼å¤„ç†

### 5.2 è‡ªå®šä¹‰æšä¸¾ç±»å‹å¤„ç†å™¨


**ä¸šåŠ¡åœºæ™¯**ï¼šç”¨æˆ·æ€§åˆ«æšä¸¾ï¼Œæ•°æ®åº“å­˜å‚¨ç¼–ç è€Œä¸æ˜¯åç§°

```java
// 1. å®šä¹‰æšä¸¾ç±»
public enum Gender {
    MALE(1, "ç”·"),
    FEMALE(2, "å¥³"),
    UNKNOWN(0, "æœªçŸ¥");
    
    private final int code;      // æ•°æ®åº“å­˜å‚¨çš„ç¼–ç 
    private final String desc;   // æè¿°ä¿¡æ¯
    
    Gender(int code, String desc) {
        this.code = code;
        this.desc = desc;
    }
    
    // æ ¹æ®ç¼–ç è·å–æšä¸¾
    public static Gender fromCode(int code) {
        for (Gender gender : values()) {
            if (gender.code == code) {
                return gender;
            }
        }
        return UNKNOWN;
    }
    
    public int getCode() { return code; }
    public String getDesc() { return desc; }
}

// 2. è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨
@MappedTypes(Gender.class)  // æŒ‡å®šå¤„ç†çš„Javaç±»å‹
@MappedJdbcTypes(JdbcType.INTEGER)  // æŒ‡å®šå¯¹åº”çš„JDBCç±»å‹
public class GenderTypeHandler extends BaseTypeHandler<Gender> {
    
    // å­˜å…¥æ•°æ®åº“ï¼šGenderæšä¸¾ â†’ intç¼–ç 
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    Gender parameter, JdbcType jdbcType) 
                                    throws SQLException {
        ps.setInt(i, parameter.getCode());  // å­˜å‚¨ç¼–ç å€¼
    }
    
    // ä»æ•°æ®åº“è¯»å–ï¼šintç¼–ç  â†’ Genderæšä¸¾
    @Override
    public Gender getNonNullResult(ResultSet rs, String columnName) 
                                  throws SQLException {
        int code = rs.getInt(columnName);
        return Gender.fromCode(code);  // æ ¹æ®ç¼–ç è½¬æ¢ä¸ºæšä¸¾
    }
    
    @Override
    public Gender getNonNullResult(ResultSet rs, int columnIndex) 
                                  throws SQLException {
        int code = rs.getInt(columnIndex);
        return Gender.fromCode(code);
    }
    
    @Override
    public Gender getNonNullResult(CallableStatement cs, int columnIndex) 
                                  throws SQLException {
        int code = cs.getInt(columnIndex);
        return Gender.fromCode(code);
    }
}
```

**æ³¨è§£è¯´æ˜**ï¼š
- `@MappedTypes`ï¼šå‘Šè¯‰ MyBatis è¿™ä¸ª TypeHandler å¤„ç†ä»€ä¹ˆ **Java ç±»å‹**
- `@MappedJdbcTypes`ï¼šå‘Šè¯‰ MyBatis å¯¹åº”ä»€ä¹ˆ **æ•°æ®åº“ç±»å‹**

**è½¬æ¢æ•ˆæœ**ï¼š
```
Javaä»£ç ä¸­ï¼š
User user = new User();
user.setGender(Gender.MALE);  // ä½¿ç”¨æšä¸¾

æ•°æ®åº“å­˜å‚¨ï¼š
genderå­—æ®µå€¼ = 1  // å­˜å‚¨çš„æ˜¯ç¼–ç 

æŸ¥è¯¢æ—¶è‡ªåŠ¨è½¬æ¢å›æ¥ï¼š
Gender gender = user.getGender();  // å¾—åˆ° Gender.MALE æšä¸¾
```

### 5.3 JSON ç±»å‹å¤„ç†å™¨å®æˆ˜


**ä¸šåŠ¡åœºæ™¯**ï¼šç”¨æˆ·çš„æ‰©å±•ä¿¡æ¯ä»¥ JSON æ ¼å¼å­˜å‚¨åœ¨ä¸€ä¸ªå­—æ®µä¸­

```java
// 1. æ‰©å±•ä¿¡æ¯ç±»
public class UserExtra {
    private String hobby;      // çˆ±å¥½
    private String address;    // åœ°å€
    private Map<String, Object> custom;  // è‡ªå®šä¹‰å­—æ®µ
    
    // getter/setterçœç•¥
}

// 2. JSONç±»å‹å¤„ç†å™¨ï¼ˆä½¿ç”¨Jacksonï¼‰
@MappedTypes(UserExtra.class)
@MappedJdbcTypes(JdbcType.VARCHAR)
public class JsonTypeHandler<T> extends BaseTypeHandler<T> {
    
    private static final ObjectMapper mapper = new ObjectMapper();
    private final Class<T> type;
    
    public JsonTypeHandler(Class<T> type) {
        this.type = type;
    }
    
    // Javaå¯¹è±¡ â†’ JSONå­—ç¬¦ä¸² â†’ å­˜å…¥æ•°æ®åº“
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    T parameter, JdbcType jdbcType) 
                                    throws SQLException {
        try {
            // å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²
            String json = mapper.writeValueAsString(parameter);
            ps.setString(i, json);
        } catch (JsonProcessingException e) {
            throw new SQLException("JSONåºåˆ—åŒ–å¤±è´¥", e);
        }
    }
    
    // JSONå­—ç¬¦ä¸² â†’ Javaå¯¹è±¡
    @Override
    public T getNonNullResult(ResultSet rs, String columnName) 
                             throws SQLException {
        String json = rs.getString(columnName);
        return parseJson(json);
    }
    
    @Override
    public T getNonNullResult(ResultSet rs, int columnIndex) 
                             throws SQLException {
        String json = rs.getString(columnIndex);
        return parseJson(json);
    }
    
    @Override
    public T getNonNullResult(CallableStatement cs, int columnIndex) 
                             throws SQLException {
        String json = cs.getString(columnIndex);
        return parseJson(json);
    }
    
    // JSONå­—ç¬¦ä¸²è§£æä¸ºå¯¹è±¡
    private T parseJson(String json) throws SQLException {
        if (json == null || json.isEmpty()) {
            return null;
        }
        try {
            return mapper.readValue(json, type);
        } catch (IOException e) {
            throw new SQLException("JSONååºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}
```

**ä½¿ç”¨æ•ˆæœ**ï¼š
```java
// Javaå®ä½“ç±»
public class User {
    private Long id;
    private String name;
    private UserExtra extra;  // æ‰©å±•ä¿¡æ¯å¯¹è±¡
}

// ä½¿ç”¨
UserExtra extra = new UserExtra();
extra.setHobby("é˜…è¯»");
extra.setAddress("åŒ—äº¬");

user.setExtra(extra);

// æ•°æ®åº“å­˜å‚¨ï¼ˆextra_infoå­—æ®µï¼‰ï¼š
// {"hobby":"é˜…è¯»","address":"åŒ—äº¬","custom":null}

// æŸ¥è¯¢æ—¶è‡ªåŠ¨è½¬æ¢å›UserExtraå¯¹è±¡
UserExtra extra = user.getExtra();
String hobby = extra.getHobby();  // "é˜…è¯»"
```

### 5.4 æ³¨å†Œè‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨


**æ–¹å¼ä¸€ï¼šå…¨å±€é…ç½®æ–‡ä»¶æ³¨å†Œ**

```xml
<!-- mybatis-config.xml -->
<configuration>
    <typeHandlers>
        <!-- æ³¨å†Œå•ä¸ªç±»å‹å¤„ç†å™¨ -->
        <typeHandler handler="com.example.handler.GenderTypeHandler"/>
        <typeHandler handler="com.example.handler.JsonTypeHandler"/>
        
        <!-- æ‰«æåŒ…ä¸‹æ‰€æœ‰ç±»å‹å¤„ç†å™¨ -->
        <package name="com.example.handler"/>
    </typeHandlers>
</configuration>
```

**æ–¹å¼äºŒï¼šSpring Boot é…ç½®**

```yaml
# application.yml
mybatis:
  type-handlers-package: com.example.handler  # è‡ªåŠ¨æ‰«æ
```

**æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨æŒ‡å®šä½¿ç”¨**

```xml
<!-- åœ¨resultMapä¸­æ˜ç¡®æŒ‡å®š -->
<resultMap id="UserMap" type="User">
    <result property="gender" column="gender" 
            typeHandler="com.example.handler.GenderTypeHandler"/>
    <result property="extra" column="extra_info" 
            typeHandler="com.example.handler.JsonTypeHandler"/>
</resultMap>

<!-- åœ¨SQLå‚æ•°ä¸­æŒ‡å®š -->
<insert id="insertUser">
    INSERT INTO user (gender, extra_info) VALUES (
        #{gender, typeHandler=com.example.handler.GenderTypeHandler},
        #{extra, typeHandler=com.example.handler.JsonTypeHandler}
    )
</insert>
```

---

## 6. ğŸ¨ ç‰¹æ®Šç±»å‹å¤„ç†æ–¹æ¡ˆ


### 6.1 æšä¸¾ç±»å‹çš„ä¸‰ç§å¤„ç†æ–¹å¼


**æ–¹å¼ä¸€ï¼šEnumTypeHandlerï¼ˆé»˜è®¤ï¼‰**
- **ç‰¹ç‚¹**ï¼šå­˜å‚¨æšä¸¾çš„**åç§°**ï¼ˆname()ï¼‰
- **ç¼ºç‚¹**ï¼šæ•°æ®åº“å­˜çš„æ˜¯å­—ç¬¦ä¸²ï¼Œä¸å¤Ÿç®€æ´

```java
public enum Status {
    ACTIVE, INACTIVE, DELETED
}

// æ•°æ®åº“å­˜å‚¨ï¼š"ACTIVE"ã€"INACTIVE"ã€"DELETED"
```

**æ–¹å¼äºŒï¼šEnumOrdinalTypeHandler**
- **ç‰¹ç‚¹**ï¼šå­˜å‚¨æšä¸¾çš„**åºå·**ï¼ˆordinal()ï¼‰
- **ç¼ºç‚¹**ï¼šæšä¸¾é¡ºåºæ”¹å˜ä¼šå¯¼è‡´æ•°æ®é”™ä¹±

```java
// æ•°æ®åº“å­˜å‚¨ï¼š0ï¼ˆACTIVEï¼‰ã€1ï¼ˆINACTIVEï¼‰ã€2ï¼ˆDELETEDï¼‰
// âš ï¸ å¦‚æœåœ¨ACTIVEå‰åŠ æ–°æšä¸¾ï¼Œæ‰€æœ‰æ•°æ®å°±ä¹±äº†ï¼
```

**æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰ TypeHandlerï¼ˆæ¨èï¼‰**
- **ç‰¹ç‚¹**ï¼šå­˜å‚¨**è‡ªå®šä¹‰ç¼–ç **ï¼Œå®‰å…¨å¯é 
- **ä¼˜ç‚¹**ï¼šä¸å—æšä¸¾é¡ºåºå½±å“

```java
// å‰é¢ä»‹ç»çš„ GenderTypeHandler å°±æ˜¯è¿™ç§æ–¹å¼
// æ•°æ®åº“å­˜å‚¨ï¼š1ï¼ˆç”·ï¼‰ã€2ï¼ˆå¥³ï¼‰ã€0ï¼ˆæœªçŸ¥ï¼‰
```

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
> æšä¸¾ç±»å‹å»ºè®®ä½¿ç”¨**è‡ªå®šä¹‰ TypeHandler** + **è‡ªå®šä¹‰ç¼–ç **çš„æ–¹å¼

### 6.2 æ—¥æœŸç±»å‹å¤„ç†è¯¦è§£


**Java 8 ä¹‹å‰çš„æ—¥æœŸç±»å‹**

```java
// java.util.Date - å¸¦æ—¶é—´æˆ³çš„æ—¥æœŸ
Date birthday = new Date();  
// å¯¹åº”æ•°æ®åº“ TIMESTAMP ç±»å‹ï¼Œç²¾ç¡®åˆ°æ¯«ç§’

// java.sql.Date - åªæœ‰æ—¥æœŸ
java.sql.Date sqlDate = new java.sql.Date(System.currentTimeMillis());
// å¯¹åº”æ•°æ®åº“ DATE ç±»å‹ï¼Œåªä¿ç•™å¹´æœˆæ—¥

// java.sql.Time - åªæœ‰æ—¶é—´
java.sql.Time sqlTime = new java.sql.Time(System.currentTimeMillis());
// å¯¹åº”æ•°æ®åº“ TIME ç±»å‹ï¼Œåªä¿ç•™æ—¶åˆ†ç§’

// java.sql.Timestamp - é«˜ç²¾åº¦æ—¶é—´æˆ³
java.sql.Timestamp timestamp = new java.sql.Timestamp(System.currentTimeMillis());
// å¯¹åº”æ•°æ®åº“ TIMESTAMP ç±»å‹
```

**Java 8 æ—¥æœŸç±»å‹ï¼ˆæ¨èï¼‰**

```java
// LocalDate - åªæœ‰æ—¥æœŸ
LocalDate birthday = LocalDate.of(1990, 1, 1);
// å¯¹åº”æ•°æ®åº“ DATE ç±»å‹

// LocalTime - åªæœ‰æ—¶é—´
LocalTime workTime = LocalTime.of(9, 0, 0);
// å¯¹åº”æ•°æ®åº“ TIME ç±»å‹

// LocalDateTime - æ—¥æœŸ+æ—¶é—´
LocalDateTime createTime = LocalDateTime.now();
// å¯¹åº”æ•°æ®åº“ TIMESTAMP ç±»å‹

// Instant - æ—¶é—´æˆ³
Instant instant = Instant.now();
// å¯¹åº”æ•°æ®åº“ TIMESTAMP ç±»å‹
```

**MyBatis 3.4.5+ è‡ªåŠ¨æ”¯æŒ Java 8 æ—¥æœŸ**ï¼š
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ TypeHandler
- âœ… æ¨èä½¿ç”¨ LocalDateã€LocalDateTime

### 6.3 å¤§å¯¹è±¡ç±»å‹å¤„ç†ï¼ˆBLOB/CLOBï¼‰


**BLOBï¼ˆBinary Large Objectï¼‰**ï¼šå­˜å‚¨äºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼Œå¦‚å›¾ç‰‡ã€æ–‡ä»¶

```java
@MappedJdbcTypes(JdbcType.BLOB)
public class BlobTypeHandler extends BaseTypeHandler<byte[]> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    byte[] parameter, JdbcType jdbcType) 
                                    throws SQLException {
        ByteArrayInputStream bis = new ByteArrayInputStream(parameter);
        ps.setBinaryStream(i, bis, parameter.length);
    }
    
    @Override
    public byte[] getNonNullResult(ResultSet rs, String columnName) 
                                  throws SQLException {
        Blob blob = rs.getBlob(columnName);
        if (blob == null) return null;
        
        byte[] returnValue = blob.getBytes(1, (int) blob.length());
        blob.free();  // é‡Šæ”¾èµ„æº
        return returnValue;
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```java
public class Document {
    private Long id;
    private String title;
    private byte[] content;  // æ–‡æ¡£å†…å®¹ï¼ˆPDFã€å›¾ç‰‡ç­‰ï¼‰
}

// MyBatisä¼šè‡ªåŠ¨ä½¿ç”¨BlobTypeHandlerå¤„ç†byte[]ç±»å‹
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
- å¤§æ–‡ä»¶å»ºè®®å­˜å‚¨åˆ°**æ–‡ä»¶æœåŠ¡å™¨**ï¼Œæ•°æ®åº“åªå­˜**æ–‡ä»¶è·¯å¾„**
- BLOB å­—æ®µä¼š**å ç”¨å¤§é‡å†…å­˜**ï¼Œå½±å“æ€§èƒ½
- æŸ¥è¯¢æ—¶æ³¨æ„**æ‡’åŠ è½½**ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ BLOB æ•°æ®

---

## 7. ğŸ”— ç±»å‹æ³¨å†Œä¸æ˜ å°„æœºåˆ¶


### 7.1 TypeHandlerRegistry æ³¨å†Œè¡¨


**TypeHandlerRegistry**ï¼šMyBatis çš„ç±»å‹å¤„ç†å™¨**ç®¡ç†ä¸­å¿ƒ**

```
TypeHandlerRegistryï¼ˆæ³¨å†Œè¡¨ï¼‰
    â”œâ”€â”€ Javaç±»å‹ â†’ TypeHandleræ˜ å°„
    â”œâ”€â”€ JDBCç±»å‹ â†’ TypeHandleræ˜ å°„
    â””â”€â”€ ç»„åˆæ˜ å°„ï¼ˆJavaç±»å‹ + JDBCç±»å‹ï¼‰

å·¥ä½œåŸç†ï¼š
1. å¯åŠ¨æ—¶æ³¨å†Œæ‰€æœ‰TypeHandler
2. ä½¿ç”¨æ—¶æ ¹æ®ç±»å‹æŸ¥æ‰¾å¯¹åº”çš„Handler
3. æ‰¾ä¸åˆ°åˆ™ä½¿ç”¨é»˜è®¤çš„ObjectTypeHandler
```

**æ³¨å†Œè¡¨çš„æ ¸å¿ƒæ–¹æ³•**ï¼š

```java
public class TypeHandlerRegistry {
    
    // å­˜å‚¨æ˜ å°„å…³ç³»çš„Map
    private final Map<JdbcType, TypeHandler<?>> jdbcTypeHandlerMap;
    private final Map<Type, Map<JdbcType, TypeHandler<?>>> typeHandlerMap;
    
    // æ³¨å†ŒTypeHandler
    public void register(Class<?> javaType, JdbcType jdbcType, 
                        TypeHandler<?> handler) {
        // å°†æ˜ å°„å…³ç³»å­˜å…¥Map
    }
    
    // æŸ¥æ‰¾TypeHandler
    public TypeHandler<?> getTypeHandler(Class<?> type, JdbcType jdbcType) {
        // æ ¹æ®Javaç±»å‹å’ŒJDBCç±»å‹æŸ¥æ‰¾
    }
}
```

### 7.2 ç±»å‹æ˜ å°„è§„åˆ™è¯¦è§£


**æ˜ å°„æŸ¥æ‰¾çš„ä¼˜å…ˆçº§é¡ºåº**ï¼š

```
1ï¸âƒ£ ç²¾ç¡®åŒ¹é…ï¼ˆJavaç±»å‹ + JDBCç±»å‹ï¼‰
   ç¤ºä¾‹ï¼šInteger + JdbcType.INTEGER â†’ IntegerTypeHandler
   
2ï¸âƒ£ Javaç±»å‹åŒ¹é…
   ç¤ºä¾‹ï¼šInteger + null â†’ IntegerTypeHandler
   
3ï¸âƒ£ JDBCç±»å‹åŒ¹é…
   ç¤ºä¾‹ï¼šnull + JdbcType.INTEGER â†’ IntegerTypeHandler
   
4ï¸âƒ£ çˆ¶ç±»å‹åŒ¹é…
   ç¤ºä¾‹ï¼šå­ç±»æ‰¾ä¸åˆ°ï¼Œå°è¯•ä½¿ç”¨çˆ¶ç±»çš„TypeHandler
   
5ï¸âƒ£ é»˜è®¤å¤„ç†å™¨
   ç¤ºä¾‹ï¼šéƒ½æ‰¾ä¸åˆ° â†’ ObjectTypeHandler
```

**å®é™…æŸ¥æ‰¾è¿‡ç¨‹ç¤ºä¾‹**ï¼š

```java
// åœºæ™¯ï¼š#{age, jdbcType=INTEGER}ï¼Œageæ˜¯Integerç±»å‹

æŸ¥æ‰¾æ­¥éª¤ï¼š
1. æŸ¥æ‰¾ Integer + INTEGER çš„ç²¾ç¡®æ˜ å°„
   â†’ æ‰¾åˆ° IntegerTypeHandler âœ“

// åœºæ™¯ï¼š#{name}ï¼Œnameæ˜¯Stringç±»å‹ï¼ŒæœªæŒ‡å®šjdbcType

æŸ¥æ‰¾æ­¥éª¤ï¼š
1. æŸ¥æ‰¾ String + null çš„æ˜ å°„
   â†’ æ‰¾åˆ° StringTypeHandler âœ“

// åœºæ™¯ï¼š#{customObj}ï¼ŒcustomObjæ˜¯è‡ªå®šä¹‰å¯¹è±¡ï¼Œæœªæ³¨å†ŒTypeHandler

æŸ¥æ‰¾æ­¥éª¤ï¼š
1. æŸ¥æ‰¾ CustomObj çš„æ˜ å°„ â†’ æœªæ‰¾åˆ°
2. æŸ¥æ‰¾çˆ¶ç±»çš„æ˜ å°„ â†’ æœªæ‰¾åˆ°
3. ä½¿ç”¨é»˜è®¤çš„ ObjectTypeHandler âœ“
```

### 7.3 è‡ªåŠ¨æ³¨å†Œæœºåˆ¶


**ä¸‰ç§è‡ªåŠ¨æ³¨å†Œæ–¹å¼**ï¼š

**æ–¹å¼ä¸€ï¼šæ³¨è§£æ³¨å†Œ**
```java
@MappedTypes(Gender.class)  // è‡ªåŠ¨æ³¨å†Œåˆ° Gender ç±»å‹
@MappedJdbcTypes(JdbcType.INTEGER)
public class GenderTypeHandler extends BaseTypeHandler<Gender> {
    // ...
}
```

**æ–¹å¼äºŒï¼šåŒ…æ‰«ææ³¨å†Œ**
```xml
<typeHandlers>
    <!-- æ‰«æåŒ…ä¸‹æ‰€æœ‰TypeHandlerå¹¶è‡ªåŠ¨æ³¨å†Œ -->
    <package name="com.example.handler"/>
</typeHandlers>
```

**æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨æ³¨å†Œ**
```java
// åœ¨åˆå§‹åŒ–æ—¶æ‰‹åŠ¨æ³¨å†Œ
TypeHandlerRegistry registry = configuration.getTypeHandlerRegistry();
registry.register(Gender.class, JdbcType.INTEGER, new GenderTypeHandler());
```

**æ³¨å†Œæ—¶çš„å¤„ç†é€»è¾‘**ï¼š
```
å‘ç° @MappedTypes å’Œ @MappedJdbcTypes æ³¨è§£
         â†“
æå– Java ç±»å‹å’Œ JDBC ç±»å‹
         â†“
åˆ›å»º TypeHandler å®ä¾‹
         â†“
å­˜å…¥ TypeHandlerRegistry çš„ Map
         â†“
åç»­ä½¿ç”¨æ—¶ç›´æ¥ä» Map æŸ¥æ‰¾
```

### 7.4 ç±»å‹æ˜ å°„é…ç½®æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š

```xml
<!-- 1. ä½¿ç”¨åŒ…æ‰«æï¼Œè‡ªåŠ¨æ³¨å†Œæ‰€æœ‰è‡ªå®šä¹‰TypeHandler -->
<typeHandlers>
    <package name="com.example.typehandler"/>
</typeHandlers>

<!-- 2. åœ¨è‡ªå®šä¹‰TypeHandlerä¸Šä½¿ç”¨æ³¨è§£ -->
@MappedTypes(Gender.class)
@MappedJdbcTypes(JdbcType.INTEGER)
public class GenderTypeHandler extends BaseTypeHandler<Gender> { }

<!-- 3. ç‰¹æ®Šæƒ…å†µæ‰åœ¨SQLä¸­æ‰‹åŠ¨æŒ‡å®š -->
<result property="gender" column="gender" 
        typeHandler="com.example.GenderTypeHandler"/>
```

**âŒ é¿å…çš„åšæ³•**ï¼š

```xml
<!-- âŒ ä¸è¦åœ¨æ¯ä¸ªSQLè¯­å¥ä¸­éƒ½æ‰‹åŠ¨æŒ‡å®šTypeHandler -->
<select id="getUser">
    SELECT 
        id,
        name,
        gender as #{gender, typeHandler=...}  <!-- ç¹çï¼ -->
    FROM user
</select>

<!-- âœ… åº”è¯¥è®©MyBatisè‡ªåŠ¨é€‰æ‹© -->
<select id="getUser" resultType="User">
    SELECT id, name, gender FROM user
</select>
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç±»å‹å¤„ç†ç³»ç»Ÿï¼šJavaç±»å‹å’Œæ•°æ®åº“ç±»å‹ä¹‹é—´çš„"ç¿»è¯‘å®˜"
ğŸ”¸ TypeHandleræ¥å£ï¼šå®šä¹‰äº†4ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œè´Ÿè´£åŒå‘è½¬æ¢
ğŸ”¸ BaseTypeHandlerï¼šç®€åŒ–å¼€å‘ï¼Œè‡ªåŠ¨å¤„ç†nullå€¼å’Œå¼‚å¸¸
ğŸ”¸ å†…ç½®å¤„ç†å™¨ï¼šMyBatisæä¾›40+ä¸ªå¸¸ç”¨ç±»å‹å¤„ç†å™¨
ğŸ”¸ è‡ªå®šä¹‰å¤„ç†å™¨ï¼šå¤„ç†ç‰¹æ®Šç±»å‹ï¼Œç»§æ‰¿BaseTypeHandlerå®ç°
ğŸ”¸ ç±»å‹æ³¨å†Œè¡¨ï¼šTypeHandlerRegistryç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¤„ç†å™¨
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ TypeHandler çš„å·¥ä½œæ—¶æœº**

```
å†™å…¥æ•°æ®ï¼ˆINSERT/UPDATEï¼‰ï¼š
Javaå¯¹è±¡å±æ€§ â†’ TypeHandler.setParameter() â†’ æ•°æ®åº“å­—æ®µ

è¯»å–æ•°æ®ï¼ˆSELECTï¼‰ï¼š
æ•°æ®åº“å­—æ®µ â†’ TypeHandler.getResult() â†’ Javaå¯¹è±¡å±æ€§
```

**ğŸ”¹ BaseTypeHandler çš„è®¾è®¡ç²¾é«“**

```
æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼š
- çˆ¶ç±»ï¼šå¤„ç†nullå€¼ã€å¼‚å¸¸ç­‰é€šç”¨é€»è¾‘
- å­ç±»ï¼šåªå…³æ³¨énullæƒ…å†µçš„æ ¸å¿ƒè½¬æ¢é€»è¾‘

ä¼˜åŠ¿ï¼š
âœ… ä»£ç ç®€æ´ï¼šä»4ä¸ªæ–¹æ³•å‡å°‘åˆ°2-3ä¸ª
âœ… é€»è¾‘ç»Ÿä¸€ï¼šnullå€¼å¤„ç†ç»Ÿä¸€åœ¨çˆ¶ç±»
âœ… æ˜“äºç»´æŠ¤ï¼šæ ¸å¿ƒé€»è¾‘æ¸…æ™°æ˜äº†
```

**ğŸ”¹ ç±»å‹æ˜ å°„çš„æ™ºèƒ½é€‰æ‹©**

```
è‡ªåŠ¨æ˜ å°„æµç¨‹ï¼š
1. MyBatis æ ¹æ® Java ç±»å‹è‡ªåŠ¨é€‰æ‹© TypeHandler
2. å¦‚æœæŒ‡å®šäº† jdbcTypeï¼Œè¿›ä¸€æ­¥ç²¾ç¡®åŒ¹é…
3. æ‰¾ä¸åˆ°åˆ™ä½¿ç”¨çˆ¶ç±»çš„ TypeHandler
4. æœ€åä½¿ç”¨é»˜è®¤çš„ ObjectTypeHandler

å¤§å¤šæ•°æƒ…å†µæ— éœ€æ‰‹åŠ¨æŒ‡å®šï¼
```

### 8.3 å®é™…åº”ç”¨åœºæ™¯æ€»ç»“


**åœºæ™¯ä¸€ï¼šæšä¸¾ç±»å‹å¤„ç†**
- âœ… ä½¿ç”¨è‡ªå®šä¹‰ TypeHandler + ç¼–ç æ–¹å¼
- âŒ é¿å…ä½¿ç”¨ EnumOrdinalTypeHandlerï¼ˆä¸å®‰å…¨ï¼‰

**åœºæ™¯äºŒï¼šJSON å­—æ®µå¤„ç†**
- âœ… è‡ªå®šä¹‰ JsonTypeHandler å®ç°å¯¹è±¡è‡ªåŠ¨åºåˆ—åŒ–
- âœ… é€‚åˆå­˜å‚¨çµæ´»çš„æ‰©å±•ä¿¡æ¯

**åœºæ™¯ä¸‰ï¼šæ—¥æœŸç±»å‹å¤„ç†**
- âœ… ä¼˜å…ˆä½¿ç”¨ Java 8 çš„ LocalDate/LocalDateTime
- âœ… MyBatis 3.4.5+ è‡ªåŠ¨æ”¯æŒï¼Œæ— éœ€é…ç½®

**åœºæ™¯å››ï¼šå¤§å¯¹è±¡å¤„ç†**
- âš ï¸ BLOB/CLOB ç±»å‹è°¨æ…ä½¿ç”¨
- âœ… å¤§æ–‡ä»¶å»ºè®®å­˜å‚¨è·¯å¾„ï¼Œä¸å­˜å‚¨å†…å®¹

### 8.4 å¼€å‘æœ€ä½³å®è·µ


**TypeHandler å¼€å‘è§„èŒƒ**ï¼š

```java
// âœ… æ¨èå†™æ³•
@MappedTypes(Gender.class)  // ä½¿ç”¨æ³¨è§£å£°æ˜ç±»å‹
@MappedJdbcTypes(JdbcType.INTEGER)
public class GenderTypeHandler extends BaseTypeHandler<Gender> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    Gender parameter, JdbcType jdbcType) 
                                    throws SQLException {
        ps.setInt(i, parameter.getCode());
    }
    
    @Override
    public Gender getNonNullResult(ResultSet rs, String columnName) 
                                  throws SQLException {
        return Gender.fromCode(rs.getInt(columnName));
    }
    
    // å…¶ä»–æ–¹æ³•...
}
```

**æ³¨å†Œé…ç½®è§„èŒƒ**ï¼š

```xml
<!-- âœ… æ¨èï¼šåŒ…æ‰«æè‡ªåŠ¨æ³¨å†Œ -->
<typeHandlers>
    <package name="com.example.typehandler"/>
</typeHandlers>

<!-- âŒ ä¸æ¨èï¼šé€ä¸ªæ‰‹åŠ¨æ³¨å†Œï¼ˆå¤ªç¹çï¼‰ -->
<typeHandlers>
    <typeHandler handler="com.example.GenderTypeHandler"/>
    <typeHandler handler="com.example.JsonTypeHandler"/>
    <!-- å¤„ç†å™¨å¤šäº†å¾ˆéº»çƒ¦... -->
</typeHandlers>
```

### 8.5 å¸¸è§é—®é¢˜è§£å†³


**é—®é¢˜1ï¼šTypeHandler ä¸ç”Ÿæ•ˆ**
```
æ£€æŸ¥æ¸…å•ï¼š
âœ… æ˜¯å¦æ­£ç¡®æ³¨å†Œï¼ˆåŒ…æ‰«ææˆ–æ‰‹åŠ¨æ³¨å†Œï¼‰
âœ… @MappedTypes æ³¨è§£çš„ç±»å‹æ˜¯å¦æ­£ç¡®
âœ… æ˜¯å¦ç»§æ‰¿äº† BaseTypeHandler
âœ… æ–¹æ³•å®ç°æ˜¯å¦æ­£ç¡®
```

**é—®é¢˜2ï¼šæšä¸¾ç±»å‹å­˜å‚¨æ··ä¹±**
```
åŸå› ï¼šä½¿ç”¨äº† EnumOrdinalTypeHandler
è§£å†³ï¼šæ”¹ç”¨è‡ªå®šä¹‰ TypeHandler + å›ºå®šç¼–ç 
```

**é—®é¢˜3ï¼šæ—¥æœŸæ ¼å¼ä¸å¯¹**
```
åŸå› ï¼šä½¿ç”¨äº†æ—§çš„ java.util.Date
è§£å†³ï¼šæ”¹ç”¨ Java 8 çš„ LocalDateTime
```

**é—®é¢˜4ï¼šnull å€¼å¤„ç†å¼‚å¸¸**
```
åŸå› ï¼šç›´æ¥å®ç° TypeHandlerï¼Œæœªå¤„ç† null
è§£å†³ï¼šç»§æ‰¿ BaseTypeHandlerï¼Œè‡ªåŠ¨å¤„ç† null
```

### 8.6 å­¦ä¹ è·¯çº¿å»ºè®®


```
ç¬¬1æ­¥ï¼šç†è§£æ¦‚å¿µ
  â””â”€ äº†è§£ TypeHandler çš„ä½œç”¨å’Œå·¥ä½œåŸç†

ç¬¬2æ­¥ï¼šç†Ÿæ‚‰å†…ç½®å¤„ç†å™¨
  â””â”€ æŒæ¡å¸¸ç”¨ç±»å‹çš„è‡ªåŠ¨æ˜ å°„è§„åˆ™

ç¬¬3æ­¥ï¼šå®è·µè‡ªå®šä¹‰å¤„ç†å™¨
  â””â”€ ä»ç®€å•çš„æšä¸¾å¤„ç†å™¨å¼€å§‹
  â””â”€ é€æ­¥å°è¯• JSONã€åŠ å¯†ç­‰å¤æ‚åœºæ™¯

ç¬¬4æ­¥ï¼šæ·±å…¥æºç 
  â””â”€ é˜…è¯» BaseTypeHandler æºç 
  â””â”€ ç†è§£ TypeHandlerRegistry æœºåˆ¶

ç¬¬5æ­¥ï¼šé¡¹ç›®å®æˆ˜
  â””â”€ åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨å’Œä¼˜åŒ–
  â””â”€ æ€»ç»“æœ€ä½³å®è·µ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç±»å‹å¤„ç†åšç¿»è¯‘ï¼ŒJava æ•°æ®åº“æ¥å›è½¬
BaseTypeHandler æ˜¯åŸºç¡€ï¼Œnull å¼‚å¸¸è‡ªåŠ¨ç®¡
å†…ç½®å¤„ç†å››åä¸ªï¼Œå¤§å¤šåœºæ™¯éƒ½å¤Ÿç”¨
æšä¸¾ JSON éœ€å®šåˆ¶ï¼Œæ³¨è§£æ³¨å†Œæœ€æ–¹ä¾¿
æŸ¥æ‰¾è§„åˆ™æœ‰ä¼˜å…ˆï¼Œç²¾ç¡®åŒ¹é…æœ€ä¼˜å…ˆ
```