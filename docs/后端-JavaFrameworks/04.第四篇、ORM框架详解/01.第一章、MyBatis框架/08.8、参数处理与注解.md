---
title: 8ã€å‚æ•°å¤„ç†ä¸æ³¨è§£
---
## ğŸ“š ç›®å½•

1. [å‚æ•°ä¼ é€’æ ¸å¿ƒæ¦‚å¿µ](#1-å‚æ•°ä¼ é€’æ ¸å¿ƒæ¦‚å¿µ)
2. [#{} ä¸ ${} è¯¦è§£](#2--ä¸--è¯¦è§£)
3. [@Paramå‚æ•°ç»‘å®š](#3-paramå‚æ•°ç»‘å®š)
4. [åŸºç¡€å¢åˆ æ”¹æŸ¥æ³¨è§£](#4-åŸºç¡€å¢åˆ æ”¹æŸ¥æ³¨è§£)
5. [ç»“æœæ˜ å°„æ³¨è§£](#5-ç»“æœæ˜ å°„æ³¨è§£)
6. [å…³è”æŸ¥è¯¢æ³¨è§£](#6-å…³è”æŸ¥è¯¢æ³¨è§£)
7. [é…ç½®ä¸æ··ç”¨ç­–ç•¥](#7-é…ç½®ä¸æ··ç”¨ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å‚æ•°ä¼ é€’æ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å‚æ•°å¤„ç†


**é€šä¿—ç†è§£**ï¼šæŠŠJavaæ–¹æ³•çš„å‚æ•°å€¼ï¼Œæ­£ç¡®ä¼ é€’ç»™SQLè¯­å¥

```
ä½ çš„æƒ³æ³•ï¼š          MyBatisçš„å·¥ä½œï¼š           æ•°æ®åº“æ¥æ”¶ï¼š
id = 1001    â†’    å¤„ç†å‚æ•°ï¼Œç”ŸæˆSQL    â†’    WHERE id = 1001
```

**ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°å¤„ç†**ï¼š
- âœ… **é˜²æ­¢SQLæ³¨å…¥**ï¼šä¿æŠ¤æ•°æ®å®‰å…¨
- âœ… **çµæ´»æŸ¥è¯¢**ï¼šæ ¹æ®ä¸åŒæ¡ä»¶æŸ¥è¯¢æ•°æ®
- âœ… **ä»£ç å¤ç”¨**ï¼šä¸€ä¸ªæ–¹æ³•å¤„ç†ä¸åŒå‚æ•°

### 1.2 å‚æ•°ä¼ é€’çš„ä¸‰ç§æ–¹å¼


| æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ç¤ºä¾‹** |
|------|------------|---------|
| ğŸ”¸ **å•ä¸ªå‚æ•°** | åªä¼ ä¸€ä¸ªå€¼ | `getUserById(1001)` |
| ğŸ”¸ **å¤šä¸ªå‚æ•°** | ä¼ å¤šä¸ªå€¼ | `login(username, password)` |
| ğŸ”¸ **å¯¹è±¡å‚æ•°** | ä¼ æ•´ä¸ªå¯¹è±¡ | `addUser(user)` |

---

## 2. ğŸ”‘ #{} ä¸ ${} è¯¦è§£


### 2.1 #{} é¢„ç¼–è¯‘å‚æ•°ï¼ˆæ¨èï¼‰


**æœ¬è´¨**ï¼šä½¿ç”¨PreparedStatementé¢„ç¼–è¯‘ï¼Œå‚æ•°ç”¨å ä½ç¬¦`?`ä»£æ›¿

```java
// Mapperæ¥å£
User getUserById(Integer id);
```

```xml
<!-- XMLä¸­çš„å†™æ³• -->
<select id="getUserById" resultType="User">
    SELECT * FROM user WHERE id = #{id}
</select>
```

**å®é™…æ‰§è¡Œçš„SQL**ï¼š
```sql
-- MyBatiså¤„ç†åï¼š
SELECT * FROM user WHERE id = ?

-- æ•°æ®åº“æœ€ç»ˆæ‰§è¡Œï¼š
SELECT * FROM user WHERE id = 1001
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… **è‡ªåŠ¨åŠ å¼•å·**ï¼šå­—ç¬¦ä¸²å‚æ•°è‡ªåŠ¨åŠ å•å¼•å·
- âœ… **é˜²SQLæ³¨å…¥**ï¼šå‚æ•°è¢«å½“ä½œå€¼å¤„ç†ï¼Œä¸ä¼šå½“ä½œSQLä»£ç 
- âœ… **ç±»å‹è½¬æ¢**ï¼šè‡ªåŠ¨å¤„ç†Javaç±»å‹å’Œæ•°æ®åº“ç±»å‹è½¬æ¢

**å®‰å…¨æ€§ç¤ºä¾‹**ï¼š
```java
// å³ä½¿ä¼ å…¥æ¶æ„å‚æ•°
String name = "admin' OR '1'='1";
getUserByName(name);

// #{} ä¼šå¤„ç†æˆï¼š
WHERE name = 'admin'' OR ''1''=''1''  // æŸ¥è¯¢ä¸åˆ°ï¼Œå®‰å…¨ï¼
```

### 2.2 ${} å­—ç¬¦ä¸²æ›¿æ¢ï¼ˆæ…ç”¨ï¼‰


**æœ¬è´¨**ï¼šç›´æ¥æŠŠå‚æ•°å€¼æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­

```xml
<select id="getUserByColumn" resultType="User">
    SELECT * FROM user ORDER BY ${columnName}
</select>
```

**å®é™…æ‰§è¡Œçš„SQL**ï¼š
```sql
-- å¦‚æœä¼ å…¥ columnName = "create_time"
SELECT * FROM user ORDER BY create_time

-- ç›´æ¥æ‹¼æ¥ï¼Œæ²¡æœ‰å¼•å·ï¼
```

**é€‚ç”¨åœºæ™¯**ï¼ˆä»…è¿™äº›æƒ…å†µæ‰ç”¨ï¼‰ï¼š
- âœ… **åŠ¨æ€è¡¨å**ï¼š`SELECT * FROM ${tableName}`
- âœ… **åŠ¨æ€åˆ—å**ï¼š`ORDER BY ${columnName}`
- âœ… **åŠ¨æ€SQLç‰‡æ®µ**ï¼šåªåœ¨ç¡®ä¿å®‰å…¨çš„æƒ…å†µä¸‹

> âš ï¸ **é‡è¦è­¦å‘Š**ï¼š${} ä¸èƒ½é˜²SQLæ³¨å…¥ï¼Œåªåœ¨ç¡®å®šå‚æ•°å®‰å…¨æ—¶ä½¿ç”¨ï¼

### 2.3 ä¸¤è€…å¯¹æ¯”æ€»ç»“


```
æ ¸å¿ƒåŒºåˆ«è®°å¿†ï¼š
#{} â†’ æŠŠå‚æ•°å½“"å€¼"   â†’ WHERE name = 'å¼ ä¸‰'  âœ… å®‰å…¨
${} â†’ æŠŠå‚æ•°å½“"ä»£ç "  â†’ WHERE name = å¼ ä¸‰   âŒ å±é™©
```

| ç‰¹æ€§ | **#{}** | **${}** |
|------|---------|---------|
| å¤„ç†æ–¹å¼ | `é¢„ç¼–è¯‘ï¼Œç”¨?å ä½` | `ç›´æ¥æ‹¼æ¥å­—ç¬¦ä¸²` |
| SQLæ³¨å…¥ | âœ… é˜²æŠ¤ | âŒ ä¸é˜²æŠ¤ |
| å¼•å·å¤„ç† | âœ… è‡ªåŠ¨åŠ å¼•å· | âŒ ä¸åŠ å¼•å· |
| ä½¿ç”¨å»ºè®® | ğŸŒŸ ä¼˜å…ˆä½¿ç”¨ | âš ï¸ è°¨æ…ä½¿ç”¨ |

---

## 3. ğŸ·ï¸ @Paramå‚æ•°ç»‘å®š


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦@Param


**é—®é¢˜åœºæ™¯**ï¼šå½“æ–¹æ³•æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼ŒMyBatisä¸çŸ¥é“å“ªä¸ªæ˜¯å“ªä¸ª

```java
// âŒ ä¸ä½¿ç”¨@Param - MyBatisä¼šå›°æƒ‘
User login(String username, String password);

// åœ¨XMLä¸­åªèƒ½ç”¨ param1, param2ï¼ˆä¸ç›´è§‚ï¼‰
WHERE username = #{param1} AND password = #{param2}
```

```java
// âœ… ä½¿ç”¨@Param - æ¸…æ¥šæ˜äº†
User login(@Param("username") String username, 
           @Param("password") String password);

// åœ¨XMLä¸­å¯ä»¥ç›´æ¥ç”¨åå­—
WHERE username = #{username} AND password = #{password}
```

### 3.2 @Paramä½¿ç”¨è§„åˆ™


**ä½¿ç”¨æ—¶æœº**ï¼š
- âœ… **2ä¸ªåŠä»¥ä¸Šå‚æ•°**ï¼šå¿…é¡»ç”¨@Param
- âœ… **å‚æ•°åè¦æ¸…æ™°**ï¼šæé«˜ä»£ç å¯è¯»æ€§
- âŒ **å•ä¸ªå‚æ•°**ï¼šä¸éœ€è¦@Paramï¼ˆç›´æ¥ç”¨ä»»æ„åå­—ï¼‰

**å®é™…ç¤ºä¾‹**ï¼š
```java
// åœºæ™¯1ï¼šåˆ†é¡µæŸ¥è¯¢
List<User> getUsers(@Param("offset") int offset, 
                    @Param("limit") int limit);

// åœºæ™¯2ï¼šæ¡ä»¶æŸ¥è¯¢
List<User> searchUsers(@Param("keyword") String keyword,
                       @Param("status") Integer status);

// åœºæ™¯3ï¼šæ‰¹é‡æ“ä½œ
int batchDelete(@Param("ids") List<Integer> ids);
```

**å¯¹åº”çš„XML**ï¼š
```xml
<select id="getUsers" resultType="User">
    SELECT * FROM user 
    LIMIT #{offset}, #{limit}
</select>

<select id="searchUsers" resultType="User">
    SELECT * FROM user 
    WHERE name LIKE CONCAT('%', #{keyword}, '%')
    AND status = #{status}
</select>
```

### 3.3 å‚æ•°æ˜¯å¯¹è±¡æ—¶


```java
// å‚æ•°æ˜¯å¯¹è±¡ï¼Œä¸éœ€è¦@Param
int addUser(User user);

// XMLä¸­ç›´æ¥ç”¨å¯¹è±¡çš„å±æ€§å
<insert id="addUser">
    INSERT INTO user(name, age, email) 
    VALUES(#{name}, #{age}, #{email})
</insert>
```

---

## 4. ğŸ“ åŸºç¡€å¢åˆ æ”¹æŸ¥æ³¨è§£


### 4.1 @Select æŸ¥è¯¢æ³¨è§£


**ä½œç”¨**ï¼šç›´æ¥åœ¨æ¥å£æ–¹æ³•ä¸Šå†™SQLæŸ¥è¯¢è¯­å¥

```java
// åŸºç¡€æŸ¥è¯¢
@Select("SELECT * FROM user WHERE id = #{id}")
User getUserById(Integer id);

// æ¡ä»¶æŸ¥è¯¢
@Select("SELECT * FROM user WHERE name = #{name}")
List<User> getUsersByName(@Param("name") String name);

// æ¨¡ç³ŠæŸ¥è¯¢
@Select("SELECT * FROM user WHERE name LIKE CONCAT('%', #{keyword}, '%')")
List<User> searchUsers(@Param("keyword") String keyword);
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ç®€å•æŸ¥è¯¢è¯­å¥
- âœ… SQLä¸ä¼šé¢‘ç¹ä¿®æ”¹
- âœ… å›¢é˜Ÿæ›´å–œæ¬¢æ³¨è§£é£æ ¼

### 4.2 @Insert æ’å…¥æ³¨è§£


**åŸºç¡€æ’å…¥**ï¼š
```java
@Insert("INSERT INTO user(name, age, email) VALUES(#{name}, #{age}, #{email})")
int addUser(User user);
```

**è·å–è‡ªå¢ä¸»é”®**ï¼š
```java
@Insert("INSERT INTO user(name, age) VALUES(#{name}, #{age})")
@Options(useGeneratedKeys = true, keyProperty = "id")
int addUser(User user);

// ä½¿ç”¨åï¼Œuser.getId() å°±èƒ½è·å–åˆ°æ•°æ®åº“ç”Ÿæˆçš„ID
```

**æ‰¹é‡æ’å…¥**ï¼š
```java
@Insert({
    "<script>",
    "INSERT INTO user(name, age) VALUES",
    "<foreach collection='users' item='user' separator=','>",
    "(#{user.name}, #{user.age})",
    "</foreach>",
    "</script>"
})
int batchInsert(@Param("users") List<User> users);
```

### 4.3 @Update æ›´æ–°æ³¨è§£


```java
// åŸºç¡€æ›´æ–°
@Update("UPDATE user SET name = #{name}, age = #{age} WHERE id = #{id}")
int updateUser(User user);

// åŠ¨æ€æ›´æ–°ï¼ˆé…åˆ<script>ï¼‰
@Update({
    "<script>",
    "UPDATE user",
    "<set>",
    "<if test='name != null'>name = #{name},</if>",
    "<if test='age != null'>age = #{age},</if>",
    "</set>",
    "WHERE id = #{id}",
    "</script>"
})
int updateUserDynamic(User user);
```

### 4.4 @Delete åˆ é™¤æ³¨è§£


```java
// å•ä¸ªåˆ é™¤
@Delete("DELETE FROM user WHERE id = #{id}")
int deleteUser(Integer id);

// æ‰¹é‡åˆ é™¤
@Delete({
    "<script>",
    "DELETE FROM user WHERE id IN",
    "<foreach collection='ids' item='id' open='(' separator=',' close=')'>",
    "#{id}",
    "</foreach>",
    "</script>"
})
int batchDelete(@Param("ids") List<Integer> ids);
```

### 4.5 æ³¨è§£æ–¹å¼å¯¹æ¯”


```
æ³¨è§£ vs XML å¦‚ä½•é€‰æ‹©ï¼š

ç®€å•SQL â†’ ç”¨æ³¨è§£ âœ…
  - ä¸€è¡ŒSQLæå®š
  - ä¸éœ€è¦å¤æ‚é€»è¾‘
  - ç¤ºä¾‹ï¼šæ ¹æ®IDæŸ¥è¯¢

å¤æ‚SQL â†’ ç”¨XML âœ…
  - å¤šè¡¨å…³è”
  - åŠ¨æ€SQLå¤š
  - éœ€è¦ç»“æœæ˜ å°„
  - ç¤ºä¾‹ï¼šå¤æ‚æŠ¥è¡¨æŸ¥è¯¢
```

---

## 5. ğŸ¨ ç»“æœæ˜ å°„æ³¨è§£


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ç»“æœæ˜ å°„


**åœºæ™¯è¯´æ˜**ï¼šæ•°æ®åº“å­—æ®µåå’ŒJavaå±æ€§åä¸ä¸€è‡´

```
æ•°æ®åº“è¡¨ï¼šuser
+-----------+----------+------------+
| user_id   | user_name| create_time|
+-----------+----------+------------+

Javaç±»ï¼šUser
- id         âŒ å’Œ user_id å¯¹ä¸ä¸Š
- name       âŒ å’Œ user_name å¯¹ä¸ä¸Š  
- createTime âŒ å’Œ create_time å¯¹ä¸ä¸Š
```

### 5.2 @Results ç»“æœæ˜ å°„é›†


**åŸºç¡€ç”¨æ³•**ï¼š
```java
@Select("SELECT user_id, user_name, create_time FROM user WHERE user_id = #{id}")
@Results({
    @Result(column = "user_id", property = "id"),
    @Result(column = "user_name", property = "name"),
    @Result(column = "create_time", property = "createTime")
})
User getUserById(Integer id);
```

**å¤ç”¨æ˜ å°„**ï¼š
```java
// å®šä¹‰ä¸€ä¸ªæ˜ å°„é›†ï¼Œç»™å®ƒèµ·ä¸ªåå­—
@Select("SELECT * FROM user WHERE user_id = #{id}")
@Results(id = "userMap", value = {
    @Result(column = "user_id", property = "id", id = true),
    @Result(column = "user_name", property = "name"),
    @Result(column = "create_time", property = "createTime")
})
User getUserById(Integer id);

// å…¶ä»–åœ°æ–¹å¤ç”¨è¿™ä¸ªæ˜ å°„
@Select("SELECT * FROM user")
@ResultMap("userMap")
List<User> getAllUsers();
```

### 5.3 @Result å­—æ®µæ˜ å°„


**å±æ€§è¯´æ˜**ï¼š
```java
@Result(
    column = "user_id",      // æ•°æ®åº“åˆ—å
    property = "id",         // Javaå±æ€§å
    id = true,              // æ˜¯å¦æ˜¯ä¸»é”®ï¼ˆå¯é€‰ï¼‰
    javaType = Integer.class // Javaç±»å‹ï¼ˆä¸€èˆ¬è‡ªåŠ¨è¯†åˆ«ï¼‰
)
```

**å¸¸è§åœºæ™¯**ï¼š
```java
@Results({
    // ä¸»é”®æ˜ å°„
    @Result(column = "id", property = "id", id = true),
    
    // æ™®é€šå­—æ®µæ˜ å°„
    @Result(column = "user_name", property = "name"),
    
    // æ—¥æœŸç±»å‹æ˜ å°„
    @Result(column = "create_time", property = "createTime", 
            javaType = Date.class),
    
    // æšä¸¾ç±»å‹æ˜ å°„
    @Result(column = "status", property = "status", 
            javaType = UserStatus.class)
})
```

---

## 6. ğŸ”— å…³è”æŸ¥è¯¢æ³¨è§£


### 6.1 @One ä¸€å¯¹ä¸€å…³è”


**åœºæ™¯**ï¼šä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªèº«ä»½è¯

```
ç”¨æˆ·è¡¨ user              èº«ä»½è¯è¡¨ id_card
+----+------+           +----+---------+---------+
| id | name |           | id | card_no | user_id |
+----+------+           +----+---------+---------+
| 1  | å¼ ä¸‰  |  â†å…³è”â†’   | 1  | 123456  |    1    |
+----+------+           +----+---------+---------+
```

**Javaå®ä½“**ï¼š
```java
public class User {
    private Integer id;
    private String name;
    private IdCard idCard;  // ä¸€å¯¹ä¸€å…³è”
}

public class IdCard {
    private Integer id;
    private String cardNo;
    private Integer userId;
}
```

**Mapperå®ç°**ï¼š
```java
// å…ˆå®šä¹‰æŸ¥è¯¢èº«ä»½è¯çš„æ–¹æ³•
@Select("SELECT * FROM id_card WHERE user_id = #{userId}")
IdCard getIdCardByUserId(Integer userId);

// æŸ¥è¯¢ç”¨æˆ·æ—¶ï¼Œå…³è”æŸ¥è¯¢èº«ä»½è¯
@Select("SELECT * FROM user WHERE id = #{id}")
@Results({
    @Result(column = "id", property = "id", id = true),
    @Result(column = "name", property = "name"),
    @Result(
        column = "id",              // ç”¨userçš„id
        property = "idCard",        // èµ‹å€¼ç»™idCardå±æ€§
        one = @One(                 // ä¸€å¯¹ä¸€å…³è”
            select = "com.example.mapper.UserMapper.getIdCardByUserId"
        )
    )
})
User getUserWithIdCard(Integer id);
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
ç¬¬1æ­¥ï¼šæŸ¥è¯¢ç”¨æˆ·
SELECT * FROM user WHERE id = 1
â†“ å¾—åˆ° user.id = 1

ç¬¬2æ­¥ï¼šç”¨user.idæŸ¥è¯¢èº«ä»½è¯
SELECT * FROM id_card WHERE user_id = 1
â†“ å¾—åˆ° idCardå¯¹è±¡

ç¬¬3æ­¥ï¼šç»„è£…ç»“æœ
user.idCard = idCardå¯¹è±¡
```

### 6.2 @Many ä¸€å¯¹å¤šå…³è”


**åœºæ™¯**ï¼šä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªè®¢å•

```
ç”¨æˆ·è¡¨ user              è®¢å•è¡¨ orders
+----+------+           +----+--------+---------+
| id | name |           | id | amount | user_id |
+----+------+           +----+--------+---------+
| 1  | å¼ ä¸‰  |  â†å…³è”â†’   | 1  | 100    |    1    |
+----+------+           | 2  | 200    |    1    |
                        +----+--------+---------+
```

**Javaå®ä½“**ï¼š
```java
public class User {
    private Integer id;
    private String name;
    private List<Order> orders;  // ä¸€å¯¹å¤šå…³è”
}

public class Order {
    private Integer id;
    private Double amount;
    private Integer userId;
}
```

**Mapperå®ç°**ï¼š
```java
// å…ˆå®šä¹‰æŸ¥è¯¢è®¢å•çš„æ–¹æ³•
@Select("SELECT * FROM orders WHERE user_id = #{userId}")
List<Order> getOrdersByUserId(Integer userId);

// æŸ¥è¯¢ç”¨æˆ·æ—¶ï¼Œå…³è”æŸ¥è¯¢è®¢å•
@Select("SELECT * FROM user WHERE id = #{id}")
@Results({
    @Result(column = "id", property = "id", id = true),
    @Result(column = "name", property = "name"),
    @Result(
        column = "id",              // ç”¨userçš„id
        property = "orders",        // èµ‹å€¼ç»™orderså±æ€§
        many = @Many(               // ä¸€å¯¹å¤šå…³è”
            select = "com.example.mapper.UserMapper.getOrdersByUserId"
        )
    )
})
User getUserWithOrders(Integer id);
```

### 6.3 å…³è”æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–


> âš ï¸ **N+1é—®é¢˜**ï¼šæŸ¥1ä¸ªç”¨æˆ·ï¼Œè§¦å‘Næ¬¡è®¢å•æŸ¥è¯¢

**é—®é¢˜ç¤ºä¾‹**ï¼š
```java
// æŸ¥è¯¢10ä¸ªç”¨æˆ·
List<User> users = getUsersWithOrders();

// å®é™…æ‰§è¡Œçš„SQLï¼š
SELECT * FROM user                    // 1æ¬¡
SELECT * FROM orders WHERE user_id=1  // ç¬¬1ä¸ªç”¨æˆ·
SELECT * FROM orders WHERE user_id=2  // ç¬¬2ä¸ªç”¨æˆ·
...
SELECT * FROM orders WHERE user_id=10 // ç¬¬10ä¸ªç”¨æˆ·
// æ€»å…±11æ¬¡SQLï¼
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šå¤æ‚å…³è”ç”¨XML + è”è¡¨æŸ¥è¯¢
```xml
<select id="getUsersWithOrders" resultMap="userOrderMap">
    SELECT u.*, o.id as order_id, o.amount
    FROM user u
    LEFT JOIN orders o ON u.id = o.user_id
</select>
<!-- åªéœ€1æ¬¡SQLï¼ -->
```

---

## 7. âš™ï¸ é…ç½®ä¸æ··ç”¨ç­–ç•¥


### 7.1 @Options é…ç½®æ³¨è§£


**å¸¸ç”¨é…ç½®**ï¼š
```java
// é…ç½®1ï¼šè·å–è‡ªå¢ä¸»é”®
@Insert("INSERT INTO user(name) VALUES(#{name})")
@Options(
    useGeneratedKeys = true,  // ä½¿ç”¨æ•°æ®åº“ç”Ÿæˆçš„ä¸»é”®
    keyProperty = "id"        // æŠŠä¸»é”®å€¼èµ‹ç»™idå±æ€§
)
int addUser(User user);

// é…ç½®2ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´
@Select("SELECT * FROM user")
@Options(timeout = 10000)  // 10ç§’è¶…æ—¶
List<User> getAllUsers();

// é…ç½®3ï¼šè®¾ç½®ç¼“å­˜
@Select("SELECT * FROM user WHERE id = #{id}")
@Options(
    useCache = true,          // ä½¿ç”¨äºŒçº§ç¼“å­˜
    flushCache = false        // æŸ¥è¯¢æ—¶ä¸æ¸…ç©ºç¼“å­˜
)
User getUserById(Integer id);
```

### 7.2 æ³¨è§£ä¸XMLæ··ç”¨ç­–ç•¥


**æ ¸å¿ƒåŸåˆ™**ï¼šç®€å•ç”¨æ³¨è§£ï¼Œå¤æ‚ç”¨XML

```
é€‰æ‹©å†³ç­–æ ‘ï¼š

SQLæ˜¯å¦ç®€å•ï¼Ÿ
â”œâ”€ æ˜¯ â†’ å•è¡¨æŸ¥è¯¢ï¼Ÿ
â”‚      â”œâ”€ æ˜¯ â†’ ç”¨æ³¨è§£ âœ…
â”‚      â””â”€ å¦ â†’ çœ‹æƒ…å†µ
â””â”€ å¦ â†’ å¤šè¡¨å…³è”ï¼Ÿ
       â”œâ”€ æ˜¯ â†’ ç”¨XML âœ…
       â””â”€ å¦ â†’ åŠ¨æ€SQLå¤šï¼Ÿ
              â”œâ”€ æ˜¯ â†’ ç”¨XML âœ…
              â””â”€ å¦ â†’ ç”¨æ³¨è§£ âœ…
```

**æ··ç”¨ç¤ºä¾‹**ï¼š
```java
public interface UserMapper {
    // ç®€å•æŸ¥è¯¢ï¼šç”¨æ³¨è§£
    @Select("SELECT * FROM user WHERE id = #{id}")
    User getUserById(Integer id);
    
    // å¤æ‚æŸ¥è¯¢ï¼šç”¨XML
    List<User> complexQuery(@Param("params") Map<String, Object> params);
    
    // ç®€å•æ’å…¥ï¼šç”¨æ³¨è§£
    @Insert("INSERT INTO user(name) VALUES(#{name})")
    @Options(useGeneratedKeys = true, keyProperty = "id")
    int addUser(User user);
    
    // åŠ¨æ€æ›´æ–°ï¼šç”¨XML
    int updateUserDynamic(User user);
}
```

**UserMapper.xml**ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- å¤æ‚æŸ¥è¯¢ -->
    <select id="complexQuery" resultType="User">
        SELECT u.*, d.dept_name
        FROM user u
        LEFT JOIN department d ON u.dept_id = d.id
        <where>
            <if test="params.name != null">
                AND u.name LIKE CONCAT('%', #{params.name}, '%')
            </if>
            <if test="params.deptId != null">
                AND u.dept_id = #{params.deptId}
            </if>
        </where>
    </select>
    
    <!-- åŠ¨æ€æ›´æ–° -->
    <update id="updateUserDynamic">
        UPDATE user
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="age != null">age = #{age},</if>
        </set>
        WHERE id = #{id}
    </update>
    
</mapper>
```

### 7.3 é¡¹ç›®å®æˆ˜å»ºè®®


**æ¨èåšæ³•**ï¼š
```
ç¬¬1æ­¥ï¼šé¡¹ç›®åˆæœŸ
â†’ å…¨ç”¨æ³¨è§£ï¼Œå¿«é€Ÿå¼€å‘

ç¬¬2æ­¥ï¼šé‡åˆ°å¤æ‚SQL
â†’ è¯¥æ–¹æ³•æ”¹ç”¨XML

ç¬¬3æ­¥ï¼šå›¢é˜Ÿè§„èŒƒ
â†’ ç»Ÿä¸€é£æ ¼ï¼Œä¸€ä¸ªé¡¹ç›®æœ€å¥½ä¸€ç§é£æ ¼ä¸ºä¸»
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âœ… åŒä¸€ä¸ªæ–¹æ³•ï¼Œæ³¨è§£å’ŒXMLåªèƒ½é€‰ä¸€ä¸ª
- âœ… XMLä¸­çš„namespaceè¦å’Œæ¥å£å…¨é™å®šåä¸€è‡´
- âœ… æ–¹æ³•åè¦å’ŒXMLä¸­çš„idä¸€è‡´

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å‚æ•°å¤„ç†è®°å¿†è¦ç‚¹


```
#{} å’Œ ${} çš„æœ¬è´¨åŒºåˆ«ï¼š
#{} â†’ å‚æ•°å½“"å€¼"   â†’ å®‰å…¨ï¼Œä¼˜å…ˆç”¨ âœ…
${} â†’ å‚æ•°å½“"ä»£ç "  â†’ å±é™©ï¼Œå°‘ç”¨ âš ï¸

@Param ä½¿ç”¨è§„åˆ™ï¼š
1ä¸ªå‚æ•° â†’ ä¸éœ€è¦
2ä¸ªä»¥ä¸Š â†’ å¿…é¡»ç”¨
å¯¹è±¡å‚æ•° â†’ ä¸éœ€è¦
```

### 8.2 æ³¨è§£ä½¿ç”¨å†³ç­–


| åœºæ™¯ | **é€‰æ‹©** | **åŸå› ** |
|------|---------|---------|
| å•è¡¨CRUD | âœ… æ³¨è§£ | ç®€å•ç›´è§‚ |
| å¤šè¡¨å…³è” | âœ… XML | å¤æ‚åº¦é«˜ |
| åŠ¨æ€SQLå¤š | âœ… XML | çµæ´»æ€§å¼º |
| ç»“æœæ˜ å°„å¤æ‚ | âœ… XML | é…ç½®æ¸…æ™° |

### 8.3 å…³è”æŸ¥è¯¢è¦ç‚¹


```
ä¸€å¯¹ä¸€ @Oneï¼š
ç”¨æˆ· â†’ èº«ä»½è¯ï¼ˆ1ä¸ªç”¨æˆ·1å¼ èº«ä»½è¯ï¼‰

ä¸€å¯¹å¤š @Manyï¼š
ç”¨æˆ· â†’ è®¢å•ï¼ˆ1ä¸ªç”¨æˆ·å¤šä¸ªè®¢å•ï¼‰

æ€§èƒ½ä¼˜åŒ–ï¼š
ç®€å•å…³è” â†’ æ³¨è§£ + åµŒå¥—æŸ¥è¯¢
å¤æ‚å…³è” â†’ XML + è”è¡¨æŸ¥è¯¢
```

### 8.4 å®æˆ˜æŠ€å·§æ€»ç»“


> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šå…ˆå…¨ç”¨æ³¨è§£ç»ƒæ‰‹ï¼Œé‡åˆ°å¤æ‚çš„å†å­¦XML

> âš¡ **æ€§èƒ½å»ºè®®**ï¼šæ³¨æ„N+1é—®é¢˜ï¼Œå¤æ‚æŸ¥è¯¢ä¼˜å…ˆç”¨XMLè”è¡¨

> ğŸ¯ **å›¢é˜Ÿå»ºè®®**ï¼šç»Ÿä¸€é£æ ¼ï¼Œè¦ä¹ˆæ³¨è§£ä¸ºä¸»ï¼Œè¦ä¹ˆXMLä¸ºä¸»

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å‚æ•°å¤„ç†äº•å·ä¼˜ï¼Œæ³¨å…¥é˜²æŠ¤è¦è®°ç‰¢
ç®€å•æ³¨è§£å¤æ‚XMLï¼Œå…³è”æŸ¥è¯¢åˆ†åœºæ™¯
ä¸€å¯¹ä¸€Manyåˆ†æ¸…æ¥šï¼Œæ€§èƒ½ä¼˜åŒ–é¿å…å‘
```