---
title: 39ã€å®‰å…¨é˜²æŠ¤æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [å®‰å…¨é˜²æŠ¤æ¦‚è¿°](#1-å®‰å…¨é˜²æŠ¤æ¦‚è¿°)
2. [SQLæ³¨å…¥é˜²æŠ¤](#2-SQLæ³¨å…¥é˜²æŠ¤)
3. [å‚æ•°æ ¡éªŒä¸æ•°æ®è„±æ•](#3-å‚æ•°æ ¡éªŒä¸æ•°æ®è„±æ•)
4. [æ•°æ®åº“æƒé™ä¸è¿æ¥å®‰å…¨](#4-æ•°æ®åº“æƒé™ä¸è¿æ¥å®‰å…¨)
5. [å®¡è®¡æ—¥å¿—ä¸è®¿é—®æ§åˆ¶](#5-å®¡è®¡æ—¥å¿—ä¸è®¿é—®æ§åˆ¶)
6. [æ•°æ®å¤‡ä»½ä¸å®‰å…¨æ£€æŸ¥](#6-æ•°æ®å¤‡ä»½ä¸å®‰å…¨æ£€æŸ¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å®‰å…¨é˜²æŠ¤


**ç°å®åœºæ™¯ç±»æ¯”**ï¼š
```
å°±åƒä½ å®¶çš„é—¨ï¼š
ğŸ  é˜²ç›—é—¨ = æ•°æ®åº“æƒé™æ§åˆ¶ï¼ˆè°èƒ½è¿›ï¼‰
ğŸ”’ å¯†ç é” = SQLæ³¨å…¥é˜²æŠ¤ï¼ˆæ€ä¹ˆè¿›ï¼‰
ğŸ“¹ ç›‘æ§å™¨ = å®¡è®¡æ—¥å¿—ï¼ˆè®°å½•è°è¿›æ¥è¿‡ï¼‰
ğŸ”‘ å¤‡ç”¨é’¥åŒ™ = æ•°æ®å¤‡ä»½ï¼ˆä¸¢äº†èƒ½æ¢å¤ï¼‰
```

**æ ¸å¿ƒå®‰å…¨å¨èƒ**ï¼š
```
ğŸ”¸ SQLæ³¨å…¥ï¼šæ¶æ„ç”¨æˆ·é€šè¿‡è¾“å…¥æ¡†æ’å…¥SQLä»£ç 
ğŸ”¸ æ•°æ®æ³„éœ²ï¼šæ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€èº«ä»½è¯ï¼‰è¢«çªƒå–
ğŸ”¸ æƒé™æ»¥ç”¨ï¼šæ™®é€šç”¨æˆ·è·å¾—ç®¡ç†å‘˜æƒé™
ğŸ”¸ æ•°æ®ä¸¢å¤±ï¼šè¯¯åˆ é™¤æˆ–ç³»ç»Ÿæ•…éšœå¯¼è‡´æ•°æ®æ¶ˆå¤±
```

> ğŸ’¡ **ä¸€å¥è¯ç†è§£**ï¼šå®‰å…¨é˜²æŠ¤å°±æ˜¯ç»™ä½ çš„æ•°æ®åº“åŠ ä¸Šå¤šé“é˜²çº¿ï¼Œé˜²æ­¢åäººå·ã€æ”¹ã€åˆ æ•°æ®

### 1.2 MyBatiså®‰å…¨é˜²æŠ¤ä½“ç³»


**é˜²æŠ¤å±‚æ¬¡**ï¼š
```
åº”ç”¨å±‚é˜²æŠ¤                MyBatiså±‚é˜²æŠ¤              æ•°æ®åº“å±‚é˜²æŠ¤
     â†“                         â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‚æ•°æ ¡éªŒ    â”‚          â”‚ #{}é¢„ç¼–è¯‘   â”‚          â”‚ ç”¨æˆ·æƒé™    â”‚
â”‚ æ•°æ®è„±æ•    â”‚   â†’      â”‚ SQLé˜²æŠ¤     â”‚   â†’      â”‚ è¿æ¥åŠ å¯†    â”‚
â”‚ è®¿é—®æ§åˆ¶    â”‚          â”‚ æ—¥å¿—å®¡è®¡    â”‚          â”‚ æ•°æ®åŠ å¯†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸš¨ SQLæ³¨å…¥é˜²æŠ¤


### 2.1 ä»€ä¹ˆæ˜¯SQLæ³¨å…¥


**å±é™©ç¤ºä¾‹**ï¼ˆé”™è¯¯åšæ³•ï¼‰ï¼š
```xml
<!-- âŒ å±é™©ï¼šç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥ -->
<select id="findByName" resultType="User">
    SELECT * FROM user WHERE name = '${name}'
</select>
```

**æ”»å‡»åœºæ™¯**ï¼š
```
æ­£å¸¸è¾“å…¥ï¼šå¼ ä¸‰
SQLå˜æˆï¼šSELECT * FROM user WHERE name = 'å¼ ä¸‰'  âœ…

æ¶æ„è¾“å…¥ï¼šå¼ ä¸‰' OR '1'='1
SQLå˜æˆï¼šSELECT * FROM user WHERE name = 'å¼ ä¸‰' OR '1'='1'  âŒ
ç»“æœï¼šè¿”å›æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼
```

> âš ï¸ **ä¸ºä»€ä¹ˆå±é™©**ï¼š`${}`ç›´æ¥æ›¿æ¢å­—ç¬¦ä¸²ï¼Œæ”»å‡»è€…å¯ä»¥é—­åˆå¼•å·æ’å…¥æ¶æ„SQL

### 2.2 æ­£ç¡®çš„é˜²æŠ¤æ–¹æ³•


**ä½¿ç”¨#{}é¢„ç¼–è¯‘**ï¼š
```xml
<!-- âœ… å®‰å…¨ï¼šä½¿ç”¨é¢„ç¼–è¯‘å‚æ•° -->
<select id="findByName" resultType="User">
    SELECT * FROM user WHERE name = #{name}
</select>
```

**å·¥ä½œåŸç†å¯¹æ¯”**ï¼š
```
${name}æ–¹å¼ï¼ˆä¸å®‰å…¨ï¼‰ï¼š
String sql = "SELECT * FROM user WHERE name = '" + name + "'";
â†’ ç›´æ¥æ‹¼æ¥ï¼Œå¯è¢«æ³¨å…¥

#{name}æ–¹å¼ï¼ˆå®‰å…¨ï¼‰ï¼š
String sql = "SELECT * FROM user WHERE name = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, name);  // è‡ªåŠ¨è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
â†’ é¢„ç¼–è¯‘ï¼Œæ— æ³•æ³¨å…¥
```

**ä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨${}**ï¼š
```xml
<!-- è¡¨åã€åˆ—åç­‰æ•°æ®åº“å¯¹è±¡åå¿…é¡»ç”¨${} -->
<select id="queryTable" resultType="map">
    SELECT * FROM ${tableName} ORDER BY ${columnName}
</select>
```

> âš ï¸ **æ³¨æ„**ï¼šä½¿ç”¨`${}`æ—¶å¿…é¡»åœ¨ä»£ç ä¸­ä¸¥æ ¼æ ¡éªŒå‚æ•°ï¼Œåªå…è®¸ç™½åå•å€¼

| åœºæ™¯ | ä½¿ç”¨æ–¹å¼ | å®‰å…¨æ€§ | è¯´æ˜ |
|------|---------|--------|------|
| **WHEREæ¡ä»¶å€¼** | `#{value}` | âœ… å®‰å…¨ | è‡ªåŠ¨é˜²æ³¨å…¥ |
| **åŠ¨æ€è¡¨å** | `${table}` | âš ï¸ éœ€æ ¡éªŒ | å¿…é¡»ç™½åå•éªŒè¯ |
| **åŠ¨æ€åˆ—å** | `${column}` | âš ï¸ éœ€æ ¡éªŒ | å¿…é¡»ç™½åå•éªŒè¯ |
| **ORDER BY** | `${order}` | âš ï¸ éœ€æ ¡éªŒ | åªå…è®¸ASC/DESC |

### 2.3 é˜²æ³¨å…¥æœ€ä½³å®è·µ


**Javaå±‚å‚æ•°æ ¡éªŒ**ï¼š
```java
@Service
public class UserService {
    
    // âœ… ç™½åå•æ ¡éªŒ
    private static final Set<String> ALLOWED_TABLES = 
        Set.of("user", "order", "product");
    
    public List<Map> queryTable(String tableName) {
        // æ ¡éªŒè¡¨åæ˜¯å¦åœ¨ç™½åå•ä¸­
        if (!ALLOWED_TABLES.contains(tableName)) {
            throw new IllegalArgumentException("éæ³•è¡¨å");
        }
        return userMapper.queryTable(tableName);
    }
    
    // âœ… æ­£åˆ™æ ¡éªŒ
    public List<User> search(String keyword) {
        // åªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡
        if (!keyword.matches("^[a-zA-Z0-9\u4e00-\u9fa5]+$")) {
            throw new IllegalArgumentException("éæ³•æœç´¢è¯");
        }
        return userMapper.search(keyword);
    }
}
```

**å®‰å…¨æ£€æŸ¥æ¸…å•**ï¼š
- [x] WHEREæ¡ä»¶å…¨éƒ¨ä½¿ç”¨`#{}`
- [x] `${}`åœºæ™¯åšç™½åå•æ ¡éªŒ
- [x] ç”¨æˆ·è¾“å…¥åšæ­£åˆ™éªŒè¯
- [x] å…³é”®æ“ä½œè®°å½•æ—¥å¿—

---

## 3. ğŸ” å‚æ•°æ ¡éªŒä¸æ•°æ®è„±æ•


### 3.1 å‚æ•°æ ¡éªŒæœºåˆ¶


**ä¸ºä»€ä¹ˆéœ€è¦æ ¡éªŒ**ï¼š
```
ç”¨æˆ·è¾“å…¥ â†’ å‚æ•°æ ¡éªŒ â†’ MyBatiså¤„ç† â†’ æ•°æ®åº“
           â†‘
        ç¬¬ä¸€é“é˜²çº¿
        
ä¸æ ¡éªŒçš„åæœï¼š
â€¢ éæ³•æ•°æ®è¿›å…¥æ•°æ®åº“
â€¢ ä¸šåŠ¡é€»è¾‘é”™è¯¯
â€¢ å®‰å…¨æ¼æ´
```

**ä½¿ç”¨JSR-303æ ¡éªŒ**ï¼š
```java
public class User {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦3-20å­—ç¬¦")
    private String username;
    
    @Email(message = "é‚®ç®±æ ¼å¼é”™è¯¯")
    private String email;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼é”™è¯¯")
    private String phone;
    
    @Min(value = 0, message = "å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
    @Max(value = 150, message = "å¹´é¾„ä¸åˆç†")
    private Integer age;
}
```

**è‡ªå®šä¹‰æ ¡éªŒé€»è¾‘**ï¼š
```java
@Component
public class ParameterValidator {
    
    // æ ¡éªŒIDåˆ—è¡¨
    public void validateIds(List<Long> ids) {
        if (ids == null || ids.isEmpty()) {
            throw new IllegalArgumentException("IDåˆ—è¡¨ä¸èƒ½ä¸ºç©º");
        }
        if (ids.size() > 1000) {
            throw new IllegalArgumentException("ä¸€æ¬¡æœ€å¤šå¤„ç†1000æ¡");
        }
        // æ£€æŸ¥æ˜¯å¦æœ‰éæ³•å€¼
        if (ids.stream().anyMatch(id -> id <= 0)) {
            throw new IllegalArgumentException("IDå¿…é¡»ä¸ºæ­£æ•°");
        }
    }
}
```

### 3.2 æ•æ„Ÿæ•°æ®è„±æ•


**ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•**ï¼š
```
åŸå§‹æ•°æ®ï¼š     å¼ ä¸‰ï¼Œèº«ä»½è¯330521199001011234
è„±æ•åï¼š       å¼ *ï¼Œèº«ä»½è¯330521********1234

ç›®çš„ï¼šåœ¨æ—¥å¿—ã€å±•ç¤ºä¸­éšè—æ•æ„Ÿä¿¡æ¯
```

**ä½¿ç”¨MyBatisæ‹¦æˆªå™¨å®ç°**ï¼š
```java
@Intercepts({
    @Signature(type = ResultSetHandler.class, 
               method = "handleResultSets", 
               args = {Statement.class})
})
public class DataMaskInterceptor implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        List<Object> results = (List<Object>) invocation.proceed();
        
        // éå†ç»“æœé›†è¿›è¡Œè„±æ•
        for (Object obj : results) {
            if (obj instanceof User) {
                User user = (User) obj;
                // æ‰‹æœºå·è„±æ•ï¼š138****5678
                user.setPhone(maskPhone(user.getPhone()));
                // èº«ä»½è¯è„±æ•ï¼š330521********1234
                user.setIdCard(maskIdCard(user.getIdCard()));
            }
        }
        return results;
    }
    
    private String maskPhone(String phone) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
    
    private String maskIdCard(String idCard) {
        if (idCard == null || idCard.length() != 18) {
            return idCard;
        }
        return idCard.substring(0, 6) + "********" + idCard.substring(14);
    }
}
```

**è„±æ•åœºæ™¯**ï¼š
```
ğŸ”¸ æ—¥å¿—è®°å½•ï¼šé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²
ğŸ”¸ å‰ç«¯å±•ç¤ºï¼šç”¨æˆ·åˆ—è¡¨ä¸­çš„æ‰‹æœºå·
ğŸ”¸ æ¥å£è¿”å›ï¼šç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨
ğŸ”¸ æŠ¥è¡¨å¯¼å‡ºï¼šExcelä¸­çš„èº«ä»½è¯å·
```

---

## 4. ğŸ”‘ æ•°æ®åº“æƒé™ä¸è¿æ¥å®‰å…¨


### 4.1 æ•°æ®åº“æƒé™æ§åˆ¶


**æœ€å°æƒé™åŸåˆ™**ï¼š
```sql
-- âŒ é”™è¯¯ï¼šåº”ç”¨ç¨‹åºä½¿ç”¨rootè´¦å·
ç”¨æˆ·ï¼šroot    æƒé™ï¼šALL PRIVILEGES

-- âœ… æ­£ç¡®ï¼šä¸ºåº”ç”¨åˆ›å»ºä¸“ç”¨è´¦å·
-- åˆ›å»ºåªè¯»è´¦å·ï¼ˆæŸ¥è¯¢æœåŠ¡ï¼‰
CREATE USER 'app_reader'@'%' IDENTIFIED BY 'strong_password';
GRANT SELECT ON mydb.* TO 'app_reader'@'%';

-- åˆ›å»ºè¯»å†™è´¦å·ï¼ˆä¸šåŠ¡æœåŠ¡ï¼‰
CREATE USER 'app_writer'@'%' IDENTIFIED BY 'strong_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON mydb.* TO 'app_writer'@'%';

-- ç¦æ­¢DROPã€TRUNCATEç­‰å±é™©æ“ä½œ
```

**æƒé™é…ç½®ç¤ºä¾‹**ï¼š
```
application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
spring:
  datasource:
    url: jdbc:mysql://db-server:3306/mydb
    username: app_writer      # ä½¿ç”¨ä¸“ç”¨è´¦å·
    password: ${DB_PASSWORD}  # å¯†ç å­˜ç¯å¢ƒå˜é‡
```

> ğŸ’¡ **ä¸ºä»€ä¹ˆè¿™æ ·åš**ï¼šå³ä½¿ç¨‹åºè¢«æ”»å‡»ï¼Œé»‘å®¢ä¹Ÿæ— æ³•åˆ é™¤æ•°æ®åº“æˆ–ä¿®æ”¹è¡¨ç»“æ„

### 4.2 è¿æ¥åŠ å¯†é…ç½®


**å¯ç”¨SSLè¿æ¥**ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://db-server:3306/mydb?useSSL=true&requireSSL=true
    # useSSL=trueï¼šå¯ç”¨SSL
    # requireSSL=trueï¼šå¼ºåˆ¶SSLï¼Œä¸åŠ å¯†åˆ™æ‹’ç»è¿æ¥
```

**å·¥ä½œåŸç†**ï¼š
```
åº”ç”¨æœåŠ¡å™¨                                æ•°æ®åº“æœåŠ¡å™¨
     |                                          |
     |--[1]è¯·æ±‚å»ºç«‹åŠ å¯†è¿æ¥------------------>|
     |<--[2]è¿”å›SSLè¯ä¹¦------------------------|
     |--[3]éªŒè¯è¯ä¹¦ï¼Œåå•†åŠ å¯†ç®—æ³•------------->|
     |<--[4]ç¡®è®¤åŠ å¯†å‚æ•°----------------------|
     |                                          |
     |===[åŠ å¯†é€šé“ï¼Œæ•°æ®ä¼ è¾“å®‰å…¨]=============>|
```

**å¯†ç å­˜å‚¨å®‰å…¨**ï¼š
```java
// âŒ é”™è¯¯ï¼šå¯†ç æ˜æ–‡å†™åœ¨é…ç½®æ–‡ä»¶
spring.datasource.password=123456

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
spring.datasource.password=${DB_PASSWORD}

// âœ… æ›´å®‰å…¨ï¼šä½¿ç”¨é…ç½®ä¸­å¿ƒåŠ å¯†å­˜å‚¨
@Value("${spring.datasource.password}")
private String password; // ä»Nacos/Apolloè·å–åŠ å¯†åçš„å¯†ç 
```

---

## 5. ğŸ“Š å®¡è®¡æ—¥å¿—ä¸è®¿é—®æ§åˆ¶


### 5.1 å®¡è®¡æ—¥å¿—è®°å½•


**ä»€ä¹ˆæ˜¯å®¡è®¡æ—¥å¿—**ï¼š
```
è®°å½•è°ã€åœ¨ä»€ä¹ˆæ—¶é—´ã€åšäº†ä»€ä¹ˆæ“ä½œ

ç¤ºä¾‹æ—¥å¿—ï¼š
[2025-09-23 10:30:45] ç”¨æˆ·[admin] IP[192.168.1.100] 
æ‰§è¡ŒSQLï¼šDELETE FROM user WHERE id=123
å½±å“è¡Œæ•°ï¼š1
```

**ä½¿ç”¨MyBatisæ‹¦æˆªå™¨è®°å½•**ï¼š
```java
@Intercepts({
    @Signature(type = Executor.class, method = "update", 
               args = {MappedStatement.class, Object.class})
})
public class AuditLogInterceptor implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        MappedStatement ms = (MappedStatement) invocation.getArgs()[0];
        Object param = invocation.getArgs()[1];
        
        // è®°å½•æ“ä½œå‰ä¿¡æ¯
        String sqlId = ms.getId();
        String sql = getSql(ms, param);
        String user = getCurrentUser();
        String ip = getClientIp();
        
        long startTime = System.currentTimeMillis();
        Object result = invocation.proceed();
        long costTime = System.currentTimeMillis() - startTime;
        
        // è®°å½•å®¡è®¡æ—¥å¿—
        log.info("å®¡è®¡æ—¥å¿— - ç”¨æˆ·:{}, IP:{}, SQL:{}, è€—æ—¶:{}ms", 
                 user, ip, sql, costTime);
        
        return result;
    }
}
```

**å…³é”®æ“ä½œè®°å½•**ï¼š
```
å¿…é¡»è®°å½•çš„æ“ä½œï¼š
âœ… åˆ é™¤æ•°æ®ï¼ˆDELETEï¼‰
âœ… ä¿®æ”¹æ•æ„Ÿå­—æ®µï¼ˆUPDATE user SET passwordï¼‰
âœ… æƒé™å˜æ›´ï¼ˆGRANT/REVOKEï¼‰
âœ… æ‰¹é‡æ“ä½œï¼ˆå½±å“100+æ¡è®°å½•ï¼‰
âœ… ç™»å½•/ç™»å‡ºè¡Œä¸º

æ—¥å¿—åŒ…å«ä¿¡æ¯ï¼š
â€¢ æ“ä½œç”¨æˆ·
â€¢ å®¢æˆ·ç«¯IP
â€¢ æ“ä½œæ—¶é—´
â€¢ SQLè¯­å¥
â€¢ å½±å“è¡Œæ•°
â€¢ æ“ä½œç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
```

### 5.2 è®¿é—®æ§åˆ¶ç­–ç•¥


**åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    // æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
    public User getMyInfo(Long userId) {
        return userMapper.selectById(userId);
    }
    
    // ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
    @RequiresRoles("admin")  // éœ€è¦adminè§’è‰²
    public List<User> getAllUsers() {
        return userMapper.selectAll();
    }
    
    // åˆ é™¤æ“ä½œéœ€è¦ç‰¹æ®Šæƒé™
    @RequiresPermissions("user:delete")
    public void deleteUser(Long userId) {
        // è®°å½•å®¡è®¡æ—¥å¿—
        auditLog.record("åˆ é™¤ç”¨æˆ·", userId);
        userMapper.deleteById(userId);
    }
}
```

**æ•°æ®çº§æƒé™æ§åˆ¶**ï¼š
```xml
<!-- æ™®é€šç”¨æˆ·åªèƒ½æŸ¥è¯¢è‡ªå·±çš„è®¢å• -->
<select id="selectMyOrders" resultType="Order">
    SELECT * FROM t_order 
    WHERE user_id = #{userId}
</select>

<!-- ç®¡ç†å‘˜å¯ä»¥æŸ¥è¯¢æ‰€æœ‰è®¢å• -->
<select id="selectAllOrders" resultType="Order">
    SELECT * FROM t_order
    <if test="role != 'admin'">
        WHERE user_id = #{userId}
    </if>
</select>
```

---

## 6. ğŸ’¾ æ•°æ®å¤‡ä»½ä¸å®‰å…¨æ£€æŸ¥


### 6.1 æ•°æ®å¤‡ä»½æ¢å¤


**ä¸ºä»€ä¹ˆéœ€è¦å¤‡ä»½**ï¼š
```
ç¾éš¾åœºæ™¯ï¼š
ğŸ”¥ ç¨‹åºBUGå¯¼è‡´è¯¯åˆ é™¤
ğŸ”¥ æ•°æ®åº“æœåŠ¡å™¨ç¡¬ç›˜æŸå
ğŸ”¥ é»‘å®¢æ”»å‡»åˆ é™¤æ•°æ®
ğŸ”¥ è‡ªç„¶ç¾å®³ï¼ˆæœºæˆ¿ç€ç«ï¼‰

æœ‰å¤‡ä»½ï¼šæ¢å¤æ•°æ®ï¼ŒæŸå¤±å¯æ§  âœ…
æ— å¤‡ä»½ï¼šæ•°æ®æ°¸ä¹…ä¸¢å¤±  âŒ
```

**å¤‡ä»½ç­–ç•¥**ï¼š
```
ğŸ”¸ å…¨é‡å¤‡ä»½ï¼šæ¯å‘¨ä¸€æ¬¡ï¼Œå¤‡ä»½æ•´ä¸ªæ•°æ®åº“
ğŸ”¸ å¢é‡å¤‡ä»½ï¼šæ¯å¤©ä¸€æ¬¡ï¼Œåªå¤‡ä»½å˜åŒ–çš„æ•°æ®
ğŸ”¸ å®æ—¶å¤‡ä»½ï¼šMySQLä¸»ä»å¤åˆ¶ï¼Œå®æ—¶åŒæ­¥

ç¤ºä¾‹ï¼š
å‘¨æ—¥ â†’ å…¨é‡å¤‡ä»½ï¼ˆ100GBï¼‰
å‘¨ä¸€ â†’ å¢é‡å¤‡ä»½ï¼ˆ+2GBï¼‰
å‘¨äºŒ â†’ å¢é‡å¤‡ä»½ï¼ˆ+3GBï¼‰
...
å‘¨å…­ â†’ å¢é‡å¤‡ä»½ï¼ˆ+2GBï¼‰
å‘¨æ—¥ â†’ å…¨é‡å¤‡ä»½ï¼ˆ120GBï¼‰
```

**å¤‡ä»½å‘½ä»¤ç¤ºä¾‹**ï¼š
```bash
# å…¨é‡å¤‡ä»½
mysqldump -u root -p mydb > backup_20250923.sql

# å¤‡ä»½åˆ°è¿œç¨‹æœåŠ¡å™¨
mysqldump -u root -p mydb | ssh backup-server "cat > /backup/db_20250923.sql"

# æ¢å¤æ•°æ®
mysql -u root -p mydb < backup_20250923.sql
```

**è‡ªåŠ¨å¤‡ä»½é…ç½®**ï¼š
```yaml
# application.yml
backup:
  enabled: true
  schedule: "0 0 2 * * ?"  # æ¯å¤©å‡Œæ™¨2ç‚¹
  retention-days: 30        # ä¿ç•™30å¤©
  remote-server: "backup.company.com"
```

### 6.2 å®‰å…¨é…ç½®æ£€æŸ¥


**é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
```
æ•°æ®åº“é…ç½®ï¼š
â–¡ æ˜¯å¦ä½¿ç”¨å¼ºå¯†ç ï¼ˆâ‰¥12ä½ï¼ŒåŒ…å«å¤§å°å†™+æ•°å­—+ç‰¹æ®Šå­—ç¬¦ï¼‰
â–¡ æ˜¯å¦ç¦ç”¨rootè¿œç¨‹ç™»å½•
â–¡ æ˜¯å¦å¯ç”¨SSLè¿æ¥
â–¡ æ˜¯å¦é™åˆ¶è®¿é—®IPç™½åå•
â–¡ æ˜¯å¦å…³é—­ä¸å¿…è¦çš„ç«¯å£

MyBatisé…ç½®ï¼š
â–¡ æ˜¯å¦æ‰€æœ‰WHEREæ¡ä»¶ä½¿ç”¨#{}
â–¡ ${}æ˜¯å¦éƒ½åšäº†ç™½åå•æ ¡éªŒ
â–¡ æ˜¯å¦é…ç½®å®¡è®¡æ—¥å¿—
â–¡ æ˜¯å¦å¯ç”¨å‚æ•°è„±æ•
â–¡ æ˜¯å¦è®°å½•æ…¢SQLæ—¥å¿—

åº”ç”¨é…ç½®ï¼š
â–¡ å¯†ç æ˜¯å¦å­˜ç¯å¢ƒå˜é‡
â–¡ æ˜¯å¦é…ç½®é˜²ç«å¢™è§„åˆ™
â–¡ æ˜¯å¦å®šæœŸæ›´æ–°æ¡†æ¶ç‰ˆæœ¬
â–¡ æ˜¯å¦å®šæœŸå®‰å…¨æ‰«æ
```

**å®‰å…¨æ‰«æå·¥å…·**ï¼š
```
ğŸ” SQLMapï¼šæ£€æµ‹SQLæ³¨å…¥æ¼æ´
ğŸ” OWASP ZAPï¼šWebåº”ç”¨å®‰å…¨æ‰«æ
ğŸ” SonarQubeï¼šä»£ç è´¨é‡å’Œå®‰å…¨æ£€æŸ¥
ğŸ” Checkmarxï¼šæºä»£ç å®‰å…¨å®¡è®¡
```

### 6.3 æ¼æ´ä¿®å¤ç­–ç•¥


**å‘ç°æ¼æ´åçš„å¤„ç†æµç¨‹**ï¼š
```
æ­¥éª¤1ï¼šç«‹å³è¯„ä¼°å½±å“èŒƒå›´
       â†“
æ­¥éª¤2ï¼šæš‚æ—¶å…³é—­å—å½±å“åŠŸèƒ½
       â†“
æ­¥éª¤3ï¼šä¿®å¤æ¼æ´å¹¶æµ‹è¯•
       â†“
æ­¥éª¤4ï¼šå‘å¸ƒè¡¥ä¸ç‰ˆæœ¬
       â†“
æ­¥éª¤5ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®æ³„éœ²
       â†“
æ­¥éª¤6ï¼šæ›´æ–°å®‰å…¨ç­–ç•¥
```

**å¸¸è§æ¼æ´ä¿®å¤**ï¼š

| æ¼æ´ç±»å‹ | ä¿®å¤æ–¹æ³• | ç´§æ€¥ç¨‹åº¦ |
|---------|---------|---------|
| **SQLæ³¨å…¥** | `${}`æ”¹ä¸º`#{}` | ğŸ”´ æé«˜ |
| **æ•æ„Ÿæ•°æ®æ³„éœ²** | æ·»åŠ è„±æ•é€»è¾‘ | ğŸ”´ æé«˜ |
| **æƒé™ç»•è¿‡** | åŠ å¼ºæƒé™æ ¡éªŒ | ğŸŸ¡ é«˜ |
| **æ—¥å¿—æ•æ„Ÿä¿¡æ¯** | è¿‡æ»¤æ•æ„Ÿå­—æ®µ | ğŸŸ¡ ä¸­ |
| **æ…¢æŸ¥è¯¢** | ä¼˜åŒ–SQLç´¢å¼• | ğŸŸ¢ ä½ |

**ç‰ˆæœ¬æ›´æ–°ç­–ç•¥**ï¼š
```java
// å®šæœŸæ£€æŸ¥MyBatisç‰ˆæœ¬
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.15</version>  <!-- ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆ -->
</dependency>

// è®¢é˜…å®‰å…¨å…¬å‘Š
å…³æ³¨ï¼šhttps://mybatis.org/mybatis-3/zh/security.html
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„å®‰å…¨åŸåˆ™


```
ğŸ”¸ é˜²æ³¨å…¥ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥ç”¨#{}ï¼Œå¿…é¡»ç”¨${}æ—¶åšç™½åå•æ ¡éªŒ
ğŸ”¸ æœ€å°æƒé™ï¼šåº”ç”¨è´¦å·åªç»™å¿…è¦æƒé™ï¼Œä¸ç”¨root
ğŸ”¸ æ•°æ®åŠ å¯†ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•ï¼Œè¿æ¥ä½¿ç”¨SSL
ğŸ”¸ å®¡è®¡æ—¥å¿—ï¼šå…³é”®æ“ä½œå¿…é¡»è®°å½•ï¼Œæ–¹ä¾¿è¿½æº¯
ğŸ”¸ å®šæœŸå¤‡ä»½ï¼šæ¯å¤©å¤‡ä»½ï¼Œå¼‚åœ°å­˜å‚¨ï¼Œå®šæœŸæ¼”ç»ƒæ¢å¤
```

### 7.2 å®‰å…¨å®æ–½æ­¥éª¤


**ç¬¬ä¸€æ­¥ï¼šä»£ç å±‚é˜²æŠ¤**
```
â€¢ ç”¨#{}æ›¿æ¢æ‰€æœ‰${}
â€¢ æ·»åŠ å‚æ•°æ ¡éªŒæ³¨è§£
â€¢ å®ç°æ•°æ®è„±æ•æ‹¦æˆªå™¨
```

**ç¬¬äºŒæ­¥ï¼šæ•°æ®åº“å±‚é˜²æŠ¤**
```
â€¢ åˆ›å»ºåº”ç”¨ä¸“ç”¨è´¦å·
â€¢ é…ç½®SSLè¿æ¥
â€¢ è®¾ç½®IPç™½åå•
```

**ç¬¬ä¸‰æ­¥ï¼šç›‘æ§å’Œå®¡è®¡**
```
â€¢ é…ç½®å®¡è®¡æ—¥å¿—æ‹¦æˆªå™¨
â€¢ è®°å½•æ•æ„Ÿæ“ä½œ
â€¢ å®šæœŸæ£€æŸ¥å¼‚å¸¸è¡Œä¸º
```

**ç¬¬å››æ­¥ï¼šå¤‡ä»½å’Œæ¢å¤**
```
â€¢ è®¾ç½®è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡
â€¢ å¼‚åœ°å­˜å‚¨å¤‡ä»½æ–‡ä»¶
â€¢ å®šæœŸæ¼”ç»ƒæ¢å¤æµç¨‹
```

### 7.3 å®‰å…¨æ£€æŸ¥å£è¯€


> ğŸ”‘ **è®°å¿†å£è¯€**ï¼š
> 
> äº•å·é˜²æ³¨å…¥ï¼Œç¾å…ƒè¦æ ¡éªŒ
> æƒé™ç»™æœ€å°ï¼Œè¿æ¥è¦åŠ å¯†
> æ—¥å¿—è®°æ“ä½œï¼Œå¤‡ä»½ä¸èƒ½å¿˜
> å®šæœŸæŸ¥æ¼æ´ï¼Œæ›´æ–°è¦åŠæ—¶

### 7.4 å®æˆ˜å»ºè®®


**æ–°æ‰‹å¸¸çŠ¯é”™è¯¯**ï¼š
```
âŒ ä¸ºäº†æ–¹ä¾¿ç”¨${}æ‹¼æ¥SQL
âŒ æ‰€æœ‰æœåŠ¡å…±ç”¨ä¸€ä¸ªæ•°æ®åº“è´¦å·
âŒ å¯†ç æ˜æ–‡å†™åœ¨é…ç½®æ–‡ä»¶
âŒ ä»ä¸å¤‡ä»½æ•°æ®
âŒ å‘ç°æ¼æ´æ‹–å»¶ä¸ä¿®å¤
```

**æ­£ç¡®åšæ³•**ï¼š
```
âœ… ä¼˜å…ˆä½¿ç”¨#{}ï¼Œå®åœ¨éœ€è¦${}å°±ä¸¥æ ¼æ ¡éªŒ
âœ… ä¸åŒæœåŠ¡ç”¨ä¸åŒè´¦å·ï¼Œæƒé™éš”ç¦»
âœ… å¯†ç å­˜ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒ
âœ… æ¯å¤©è‡ªåŠ¨å¤‡ä»½åˆ°è¿œç¨‹æœåŠ¡å™¨
âœ… å‘ç°æ¼æ´ç«‹å³è¯„ä¼°ä¿®å¤
```

**å®‰å…¨ç­‰çº§è¯„ä¼°**ï¼š
```
åŸºç¡€çº§ï¼ˆ60åˆ†ï¼‰ï¼š
â€¢ ä½¿ç”¨#{}é˜²SQLæ³¨å…¥
â€¢ é…ç½®ç‹¬ç«‹æ•°æ®åº“è´¦å·
â€¢ å®šæœŸæ‰‹åŠ¨å¤‡ä»½

è¿›é˜¶çº§ï¼ˆ80åˆ†ï¼‰ï¼š
â€¢ æ·»åŠ å‚æ•°æ ¡éªŒå’Œæ•°æ®è„±æ•
â€¢ å¯ç”¨SSLè¿æ¥
â€¢ è®°å½•å®¡è®¡æ—¥å¿—
â€¢ è‡ªåŠ¨åŒ–å¤‡ä»½

ä¸“å®¶çº§ï¼ˆ100åˆ†ï¼‰ï¼š
â€¢ å®Œæ•´çš„æƒé™æ§åˆ¶ä½“ç³»
â€¢ å®æ—¶ç›‘æ§å’Œå‘Šè­¦
â€¢ å¼‚åœ°å®¹ç¾å¤‡ä»½
â€¢ å®šæœŸå®‰å…¨å®¡è®¡
â€¢ æ¼æ´å¿«é€Ÿå“åº”æœºåˆ¶
```

> ğŸ’¡ **æœ€åæé†’**ï¼š
> 
> å®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œè€Œæ˜¯æŒç»­çš„è¿‡ç¨‹ã€‚å®šæœŸæ£€æŸ¥ã€åŠæ—¶æ›´æ–°ã€ä¸æ–­æ”¹è¿›ï¼Œæ‰èƒ½çœŸæ­£ä¿æŠ¤å¥½æ•°æ®å®‰å…¨ï¼