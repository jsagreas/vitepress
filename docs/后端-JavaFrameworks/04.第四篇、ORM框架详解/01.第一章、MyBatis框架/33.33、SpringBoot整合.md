---
title: 33ã€SpringBootæ•´åˆ
---
## ğŸ“š ç›®å½•

1. [SpringBootæ•´åˆMyBatisæ¦‚è¿°](#1-SpringBootæ•´åˆMyBatisæ¦‚è¿°)
2. [å¿«é€Ÿä¸Šæ‰‹æ•´åˆ](#2-å¿«é€Ÿä¸Šæ‰‹æ•´åˆ)
3. [é…ç½®æ–‡ä»¶è¯¦è§£](#3-é…ç½®æ–‡ä»¶è¯¦è§£)
4. [è‡ªåŠ¨é…ç½®åŸç†](#4-è‡ªåŠ¨é…ç½®åŸç†)
5. [å¤šç¯å¢ƒé…ç½®å®æˆ˜](#5-å¤šç¯å¢ƒé…ç½®å®æˆ˜)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ SpringBootæ•´åˆMyBatisæ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆè¦ç”¨SpringBootæ•´åˆMyBatis


**ä¼ ç»ŸSpringæ•´åˆçš„ç—›ç‚¹**ï¼š
```
ä¼ ç»Ÿæ–¹å¼éœ€è¦ï¼š
âŒ æ‰‹åŠ¨é…ç½®SqlSessionFactory
âŒ æ‰‹åŠ¨é…ç½®äº‹åŠ¡ç®¡ç†å™¨
âŒ ç¼–å†™å¤§é‡XMLé…ç½®æ–‡ä»¶
âŒ æ‰‹åŠ¨æ‰«æMapperæ¥å£
âŒ é…ç½®æ•°æ®æºè¿æ¥æ± 

ç»“æœï¼šé…ç½®ç¹çï¼Œå®¹æ˜“å‡ºé”™ï¼Œå­¦ä¹ æˆæœ¬é«˜
```

**SpringBootæ•´åˆçš„ä¼˜åŠ¿**ï¼š
```
SpringBootæ–¹å¼åªéœ€ï¼š
âœ… å¼•å…¥ä¸€ä¸ªstarterä¾èµ–
âœ… å†™å‡ è¡Œé…ç½®å±æ€§
âœ… è‡ªåŠ¨å®Œæˆæ‰€æœ‰åº•å±‚é…ç½®

ç»“æœï¼šå¼€ç®±å³ç”¨ï¼Œé›¶é…ç½®ä¸Šæ‰‹ï¼Œä¸“æ³¨ä¸šåŠ¡å¼€å‘
```

**ç®€å•ç†è§£**ï¼š
> å°±åƒä¹°ç”µè„‘ï¼Œä¼ ç»Ÿæ–¹å¼æ˜¯è‡ªå·±ä¹°é›¶ä»¶ç»„è£…ï¼ˆé…ç½®å¤æ‚ï¼‰ï¼ŒSpringBootæ•´åˆå°±åƒä¹°å“ç‰Œæœºï¼ˆå¼€ç®±å³ç”¨ï¼‰

### 1.2 æ ¸å¿ƒç»„ä»¶ä»‹ç»


**mybatis-spring-boot-starterï¼ˆæ•´åˆå¯åŠ¨å™¨ï¼‰**ï¼š
```
ä½œç”¨ï¼šä¸€ç«™å¼æ•´åˆåŒ…
åŒ…å«å†…å®¹ï¼š
- MyBatisæ ¸å¿ƒåº“
- MyBatis-Springé€‚é…å™¨
- è‡ªåŠ¨é…ç½®ç±»
- é»˜è®¤é…ç½®

ç±»æ¯”ï¼šå°±åƒè£…ä¿®å…¬å¸çš„å…¨åŒ…æœåŠ¡ï¼Œ
     ä¸€ä¸ªåˆåŒæå®šæ‰€æœ‰è£…ä¿®éœ€æ±‚
```

**MybatisAutoConfigurationï¼ˆè‡ªåŠ¨é…ç½®ç±»ï¼‰**ï¼š
```
ä½œç”¨ï¼šSpringBootå¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®MyBatis
åŠŸèƒ½ï¼š
1. è‡ªåŠ¨åˆ›å»ºSqlSessionFactory
2. è‡ªåŠ¨æ‰«æMapperæ¥å£
3. è‡ªåŠ¨é…ç½®äº‹åŠ¡
4. è‡ªåŠ¨åŠ è½½é…ç½®æ–‡ä»¶

ç±»æ¯”ï¼šå°±åƒé…’åº—çš„ç®¡å®¶æœåŠ¡ï¼Œ
     ä½ å…¥ä½åè‡ªåŠ¨å¸®ä½ å‡†å¤‡å¥½ä¸€åˆ‡
```

---

## 2. âš¡ å¿«é€Ÿä¸Šæ‰‹æ•´åˆ


### 2.1 ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–


**Mavené¡¹ç›®é…ç½®**ï¼š
```xml
<!-- SpringBootçˆ¶å·¥ç¨‹ -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.7.0</version>
</parent>

<dependencies>
    <!-- MyBatisæ•´åˆåŒ…ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰ -->
    <dependency>
        <groupId>org.mybatis.spring.boot</groupId>
        <artifactId>mybatis-spring-boot-starter</artifactId>
        <version>2.3.0</version>
    </dependency>
    
    <!-- æ•°æ®åº“é©±åŠ¨ -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <scope>runtime</scope>
    </dependency>
</dependencies>
```

**ç†è§£è¦ç‚¹**ï¼š
- `mybatis-spring-boot-starter`ï¼šè¿™å°±æ˜¯æ•´åˆçš„æ ¸å¿ƒï¼Œä¸€ä¸ªä¾èµ–æå®šæ‰€æœ‰
- `mysql-connector-java`ï¼šæ•°æ®åº“é©±åŠ¨ï¼Œè¿æ¥MySQLå¿…éœ€çš„
- ç‰ˆæœ¬è¯´æ˜ï¼šstarterç‰ˆæœ¬2.3.0å¯¹åº”MyBatis 3.5.xç‰ˆæœ¬

### 2.2 ç¬¬äºŒæ­¥ï¼šç¼–å†™é…ç½®æ–‡ä»¶


**application.ymlæ–¹å¼**ï¼š
```yaml
# æ•°æ®æºé…ç½®ï¼ˆè¿æ¥æ•°æ®åº“çš„ä¿¡æ¯ï¼‰
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mybatis_demo?useUnicode=true&characterEncoding=utf8
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver

# MyBatisé…ç½®
mybatis:
  # mapper.xmlæ–‡ä»¶ä½ç½®
  mapper-locations: classpath:mapper/*.xml
  # å®ä½“ç±»åŒ…è·¯å¾„ï¼ˆå¯ä»¥çœç•¥åŒ…åï¼‰
  type-aliases-package: com.example.entity
  configuration:
    # å¼€å¯é©¼å³°å‘½åè½¬æ¢ï¼ˆuser_name â†’ userNameï¼‰
    map-underscore-to-camel-case: true
    # æ‰“å°SQLæ—¥å¿—
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

**é…ç½®å«ä¹‰è§£é‡Š**ï¼š

| é…ç½®é¡¹ | **ä½œç”¨** | **é€šä¿—ç†è§£** |
|--------|----------|--------------|
| `datasource.url` | `æ•°æ®åº“åœ°å€` | `å‘Šè¯‰ç¨‹åºæ•°æ®åº“åœ¨å“ª` |
| `datasource.username` | `ç™»å½•ç”¨æˆ·å` | `æ•°æ®åº“çš„è´¦å·` |
| `datasource.password` | `ç™»å½•å¯†ç ` | `æ•°æ®åº“çš„å¯†ç ` |
| `mapper-locations` | `SQLæ–‡ä»¶ä½ç½®` | `SQLè¯­å¥å†™åœ¨å“ªä¸ªæ–‡ä»¶` |
| `type-aliases-package` | `å®ä½“ç±»åŒ…å` | `JavaBeanåœ¨å“ªä¸ªåŒ…` |
| `map-underscore-to-camel-case` | `å‘½åè½¬æ¢` | `æ•°æ®åº“user_nameè‡ªåŠ¨è½¬Javaçš„userName` |

### 2.3 ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºMapperæ¥å£


```java
package com.example.mapper;

import com.example.entity.User;
import org.apache.ibatis.annotations.Mapper;
import java.util.List;

// @Mapperæ³¨è§£ï¼šå‘Šè¯‰SpringBootè¿™æ˜¯MyBatisçš„æ¥å£
@Mapper
public interface UserMapper {
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    List<User> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    User findById(Long id);
    
    // æ’å…¥ç”¨æˆ·
    int insert(User user);
}
```

**å…³é”®æ³¨è§£è¯´æ˜**ï¼š
- `@Mapper`ï¼šè¿™ä¸ªæ³¨è§£æ˜¯**å¿…é¡»çš„**ï¼Œå‘Šè¯‰SpringBootè¦ä¸ºè¿™ä¸ªæ¥å£åˆ›å»ºä»£ç†å¯¹è±¡
- ä¸éœ€è¦å†™å®ç°ç±»ï¼ŒMyBatisä¼šè‡ªåŠ¨ç”Ÿæˆ

**å¦ä¸€ç§æ–¹å¼ï¼šå¯åŠ¨ç±»æ‰«æ**
```java
@SpringBootApplication
@MapperScan("com.example.mapper")  // æ‰«ææ•´ä¸ªåŒ…ï¼Œå°±ä¸ç”¨æ¯ä¸ªæ¥å£éƒ½åŠ @Mapper
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### 2.4 ç¬¬å››æ­¥ï¼šä½¿ç”¨Mapper


```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;  // ç›´æ¥æ³¨å…¥ï¼Œå°±èƒ½ç”¨
    
    public List<User> getAllUsers() {
        return userMapper.findAll();
    }
    
    public User getUserById(Long id) {
        return userMapper.findById(id);
    }
}
```

**æ•´åˆå®Œæˆæµç¨‹å›¾**ï¼š
```
å¼€å‘æµç¨‹ï¼š
1. å¼•å…¥starter â†’ 2. å†™é…ç½® â†’ 3. åˆ›å»ºMapperæ¥å£ â†’ 4. æ³¨å…¥ä½¿ç”¨

       [pom.xml]
           â†“
   [application.yml]
           â†“
    [UserMapperæ¥å£]
           â†“
      [Serviceæ³¨å…¥]
           â†“
       [å¼€å§‹ä½¿ç”¨]
```

---

## 3. ğŸ“ é…ç½®æ–‡ä»¶è¯¦è§£


### 3.1 YAMLé…ç½®æ–¹å¼


**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š
```yaml
spring:
  datasource:
    # åŸºç¡€é…ç½®
    url: jdbc:mysql://localhost:3306/mybatis_demo
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    
    # è¿æ¥æ± é…ç½®ï¼ˆHikariCPï¼‰
    hikari:
      maximum-pool-size: 20       # æœ€å¤§è¿æ¥æ•°
      minimum-idle: 5             # æœ€å°ç©ºé—²è¿æ¥
      connection-timeout: 30000   # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

mybatis:
  # Mapperæ–‡ä»¶ä½ç½®
  mapper-locations: classpath:mapper/*.xml
  
  # å®ä½“ç±»åˆ«ååŒ…
  type-aliases-package: com.example.entity
  
  # MyBatisæ ¸å¿ƒé…ç½®
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true           # å¼€å¯äºŒçº§ç¼“å­˜
    lazy-loading-enabled: true    # å¼€å¯å»¶è¿ŸåŠ è½½
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

**é…ç½®åˆ†å±‚ç†è§£**ï¼š
```
é…ç½®å±‚æ¬¡ï¼š
â”œâ”€â”€ springï¼ˆSpringBootåŸºç¡€é…ç½®ï¼‰
â”‚   â””â”€â”€ datasourceï¼ˆæ•°æ®æºé…ç½®ï¼‰
â”‚       â”œâ”€â”€ urlï¼ˆæ•°æ®åº“åœ°å€ï¼‰
â”‚       â”œâ”€â”€ usernameï¼ˆç”¨æˆ·åï¼‰
â”‚       â”œâ”€â”€ passwordï¼ˆå¯†ç ï¼‰
â”‚       â””â”€â”€ hikariï¼ˆè¿æ¥æ± é…ç½®ï¼‰
â”‚
â””â”€â”€ mybatisï¼ˆMyBatisä¸“å±é…ç½®ï¼‰
    â”œâ”€â”€ mapper-locationsï¼ˆSQLæ–‡ä»¶ä½ç½®ï¼‰
    â”œâ”€â”€ type-aliases-packageï¼ˆå®ä½“ç±»åŒ…ï¼‰
    â””â”€â”€ configurationï¼ˆæ ¸å¿ƒé…ç½®ï¼‰
        â”œâ”€â”€ map-underscore-to-camel-caseï¼ˆå‘½åè½¬æ¢ï¼‰
        â”œâ”€â”€ cache-enabledï¼ˆç¼“å­˜å¼€å…³ï¼‰
        â””â”€â”€ log-implï¼ˆæ—¥å¿—å®ç°ï¼‰
```

### 3.2 Propertiesé…ç½®æ–¹å¼


**application.propertiesç¤ºä¾‹**ï¼š
```properties
# æ•°æ®æºé…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/mybatis_demo
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# MyBatisé…ç½®
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.example.entity
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
```

**YAML vs Propertieså¯¹æ¯”**ï¼š

| å¯¹æ¯”é¡¹ | **YAML** | **Properties** |
|--------|----------|----------------|
| **è¯­æ³•** | `å±‚çº§ç¼©è¿›` | `ç‚¹å·åˆ†éš”` |
| **å¯è¯»æ€§** | `æ›´ç›´è§‚æ¸…æ™°` | `é…ç½®å¤šæ—¶è¾ƒä¹±` |
| **å¤æ‚é…ç½®** | `æ”¯æŒåˆ—è¡¨ã€å¯¹è±¡` | `ä¸æ”¯æŒå¤æ‚ç»“æ„` |
| **ä½¿ç”¨å»ºè®®** | `æ¨èä½¿ç”¨` | `ç®€å•é…ç½®å¯ç”¨` |

### 3.3 é…ç½®å±æ€§ç»‘å®šåŸç†


**å±æ€§ç»‘å®šè¿‡ç¨‹**ï¼š
```
é…ç½®æ–‡ä»¶ â†’ SpringBootè¯»å– â†’ è‡ªåŠ¨ç»‘å®šåˆ°é…ç½®ç±»

application.ymlä¸­çš„ï¼š
mybatis.mapper-locations=classpath:mapper/*.xml
    â†“
è‡ªåŠ¨ç»‘å®šåˆ°MybatisPropertiesç±»çš„mapperLocationså±æ€§
    â†“
MybatisAutoConfigurationè¯»å–å¹¶åº”ç”¨é…ç½®
```

**MybatisPropertiesé…ç½®ç±»**ï¼š
```java
@ConfigurationProperties(prefix = "mybatis")
public class MybatisProperties {
    
    // å¯¹åº”é…ç½®ï¼šmybatis.mapper-locations
    private String[] mapperLocations;
    
    // å¯¹åº”é…ç½®ï¼šmybatis.type-aliases-package
    private String typeAliasesPackage;
    
    // å¯¹åº”é…ç½®ï¼šmybatis.configuration.*
    private Configuration configuration;
    
    // getter/setter...
}
```

**ç†è§£è¦ç‚¹**ï¼š
> `@ConfigurationProperties`æ³¨è§£ä¼šè‡ªåŠ¨æŠŠé…ç½®æ–‡ä»¶ä¸­`mybatis.`å¼€å¤´çš„é…ç½®ç»‘å®šåˆ°è¿™ä¸ªç±»çš„å±æ€§ä¸Šï¼Œå°±åƒè‡ªåŠ¨å¡«è¡¨ä¸€æ ·

---

## 4. ğŸ”§ è‡ªåŠ¨é…ç½®åŸç†


### 4.1 MybatisAutoConfigurationæ ¸å¿ƒä½œç”¨


**è‡ªåŠ¨é…ç½®ç±»çš„èŒè´£**ï¼š
```
MybatisAutoConfigurationåšäº†ä»€ä¹ˆï¼š

1. åˆ›å»ºSqlSessionFactoryï¼ˆMyBatisæ ¸å¿ƒå¯¹è±¡ï¼‰
   â””â”€ è¯»å–é…ç½®æ–‡ä»¶
   â””â”€ æ‰«æMapperæ–‡ä»¶
   â””â”€ åˆ›å»ºæ•°æ®æºè¿æ¥

2. åˆ›å»ºSqlSessionTemplateï¼ˆçº¿ç¨‹å®‰å…¨çš„SqlSessionï¼‰
   â””â”€ æä¾›æ•°æ®åº“æ“ä½œèƒ½åŠ›
   â””â”€ ç®¡ç†äº‹åŠ¡

3. æ‰«æMapperæ¥å£
   â””â”€ è‡ªåŠ¨æ³¨å†Œåˆ°Springå®¹å™¨
   â””â”€ åˆ›å»ºä»£ç†å¯¹è±¡

4. é…ç½®äº‹åŠ¡ç®¡ç†å™¨
   â””â”€ æ”¯æŒ@Transactionalæ³¨è§£
   â””â”€ è‡ªåŠ¨å›æ»šå¼‚å¸¸
```

### 4.2 æ¡ä»¶è£…é…æœºåˆ¶


**ä»€ä¹ˆæ˜¯æ¡ä»¶è£…é…**ï¼š
> å°±åƒæ™ºèƒ½å®¶å±…ï¼Œæ»¡è¶³æ¡ä»¶æ‰è‡ªåŠ¨å·¥ä½œã€‚SpringBootæ£€æµ‹åˆ°MyBatisç›¸å…³ç±»å­˜åœ¨ï¼Œæ‰å¯åŠ¨è‡ªåŠ¨é…ç½®

**æ¡ä»¶æ³¨è§£è¯´æ˜**ï¼š
```java
@Configuration
@ConditionalOnClass({SqlSessionFactory.class, SqlSessionFactoryBean.class})
@ConditionalOnSingleCandidate(DataSource.class)
public class MybatisAutoConfiguration {
    // é…ç½®ä»£ç ...
}
```

**æ¡ä»¶æ³¨è§£å«ä¹‰**ï¼š

| æ³¨è§£ | **å«ä¹‰** | **é€šä¿—ç†è§£** |
|------|----------|--------------|
| `@ConditionalOnClass` | `æŒ‡å®šç±»å­˜åœ¨æ—¶ç”Ÿæ•ˆ` | `æ£€æµ‹åˆ°MyBatisçš„jaråŒ…æ‰å¯åŠ¨` |
| `@ConditionalOnSingleCandidate` | `å­˜åœ¨å”¯ä¸€å€™é€‰Beanæ—¶ç”Ÿæ•ˆ` | `æ•°æ®æºé…ç½®å¥½äº†æ‰å¯åŠ¨` |
| `@ConditionalOnMissingBean` | `Beanä¸å­˜åœ¨æ—¶åˆ›å»º` | `ä½ æ²¡é…å°±ç”¨é»˜è®¤çš„` |

**è‡ªåŠ¨é…ç½®æ‰§è¡Œæµç¨‹**ï¼š
```
SpringBootå¯åŠ¨
    â†“
æ£€æµ‹classpathä¸‹æ˜¯å¦æœ‰MyBatisç›¸å…³ç±»
    â†“ï¼ˆå­˜åœ¨ï¼‰
æ£€æµ‹æ˜¯å¦é…ç½®äº†æ•°æ®æº
    â†“ï¼ˆå·²é…ç½®ï¼‰
è¯»å–application.ymlä¸­çš„mybatisé…ç½®
    â†“
åˆ›å»ºSqlSessionFactory
    â†“
æ‰«æMapperæ¥å£
    â†“
æ³¨å†Œåˆ°Springå®¹å™¨
    â†“
å¯ä»¥ä½¿ç”¨@Autowiredæ³¨å…¥Mapper
```

### 4.3 SqlSessionFactoryåˆ›å»ºè¿‡ç¨‹


**æ ¸å¿ƒé…ç½®æ–¹æ³•**ï¼š
```java
@Bean
@ConditionalOnMissingBean
public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {
    SqlSessionFactoryBean factory = new SqlSessionFactoryBean();
    
    // 1. è®¾ç½®æ•°æ®æº
    factory.setDataSource(dataSource);
    
    // 2. è®¾ç½®Mapperæ–‡ä»¶ä½ç½®
    factory.setMapperLocations(this.properties.resolveMapperLocations());
    
    // 3. è®¾ç½®ç±»å‹åˆ«å
    factory.setTypeAliasesPackage(this.properties.getTypeAliasesPackage());
    
    // 4. è®¾ç½®MyBatisé…ç½®
    factory.setConfiguration(this.properties.getConfiguration());
    
    return factory.getObject();
}
```

**ç†è§£è¿‡ç¨‹**ï¼š
```
SqlSessionFactoryçš„åˆ›å»º = 
    æ•°æ®æº + Mapperä½ç½® + å®ä½“ç±»åŒ… + æ ¸å¿ƒé…ç½®

å°±åƒå¼€é¤å…éœ€è¦ï¼š
- æ•°æ®æº = é£Ÿæä¾›åº”å•†
- Mapper = èœè°±
- å®ä½“ç±» = é£Ÿæ
- é…ç½® = çƒ¹é¥ªè§„åˆ™
```

---

## 5. ğŸŒˆ å¤šç¯å¢ƒé…ç½®å®æˆ˜


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šç¯å¢ƒé…ç½®


**å¼€å‘åœºæ™¯**ï¼š
```
å®é™…é¡¹ç›®ä¸­æœ‰å¤šä¸ªç¯å¢ƒï¼š

å¼€å‘ç¯å¢ƒï¼ˆdevï¼‰ï¼š
- å¼€å‘äººå‘˜æœ¬åœ°æ•°æ®åº“
- æ—¥å¿—è¯¦ç»†ï¼Œæ–¹ä¾¿è°ƒè¯•
- æ€§èƒ½è¦æ±‚ä¸é«˜

æµ‹è¯•ç¯å¢ƒï¼ˆtestï¼‰ï¼š
- æµ‹è¯•å›¢é˜Ÿä½¿ç”¨
- æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ
- éœ€è¦ç¨³å®šæ€§

ç”Ÿäº§ç¯å¢ƒï¼ˆprodï¼‰ï¼š
- ç”¨æˆ·çœŸå®ä½¿ç”¨
- é«˜æ€§èƒ½ã€é«˜å®‰å…¨
- æ—¥å¿—ç²¾ç®€
```

### 5.2 é…ç½®æ–‡ä»¶æ‹†åˆ†æ–¹å¼


**æ–‡ä»¶å‘½åè§„åˆ™**ï¼š
```
application.yml          â†’ å…¬å…±é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰
application-dev.yml      â†’ å¼€å‘ç¯å¢ƒé…ç½®
application-test.yml     â†’ æµ‹è¯•ç¯å¢ƒé…ç½®
application-prod.yml     â†’ ç”Ÿäº§ç¯å¢ƒé…ç½®
```

**å…¬å…±é…ç½®ï¼ˆapplication.ymlï¼‰**ï¼š
```yaml
spring:
  profiles:
    active: dev  # æ¿€æ´»å¼€å‘ç¯å¢ƒ

# æ‰€æœ‰ç¯å¢ƒå…±äº«çš„é…ç½®
mybatis:
  type-aliases-package: com.example.entity
  configuration:
    map-underscore-to-camel-case: true
```

**å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆapplication-dev.ymlï¼‰**ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mybatis_dev
    username: root
    password: 123456

mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # æ‰“å°SQL
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆapplication-prod.ymlï¼‰**ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://prod-server:3306/mybatis_prod
    username: prod_user
    password: ${DB_PASSWORD}  # ä»ç¯å¢ƒå˜é‡è¯»å–

mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl  # ç”Ÿäº§æ—¥å¿—
```

**åˆ‡æ¢ç¯å¢ƒçš„æ–¹å¼**ï¼š

**æ–¹å¼1ï¼šé…ç½®æ–‡ä»¶åˆ‡æ¢**
```yaml
spring:
  profiles:
    active: prod  # æ”¹æˆprodå°±ç”¨ç”Ÿäº§ç¯å¢ƒ
```

**æ–¹å¼2ï¼šå¯åŠ¨å‚æ•°åˆ‡æ¢**
```bash
# å‘½ä»¤è¡ŒæŒ‡å®šç¯å¢ƒ
java -jar myapp.jar --spring.profiles.active=prod
```

**æ–¹å¼3ï¼šç¯å¢ƒå˜é‡åˆ‡æ¢**
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar
```

### 5.3 é…ç½®ä¼˜å…ˆçº§ç†è§£


**é…ç½®è¦†ç›–è§„åˆ™**ï¼š
```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. å‘½ä»¤è¡Œå‚æ•°
   java -jar app.jar --mybatis.mapper-locations=xxx
   
2. ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶
   application-prod.yml
   
3. å…¬å…±é…ç½®æ–‡ä»¶
   application.yml
   
4. é»˜è®¤é…ç½®
   MybatisAutoConfigurationä¸­çš„é»˜è®¤å€¼
```

**å®é™…æ¡ˆä¾‹ç†è§£**ï¼š
```
å‡è®¾æœ‰å¦‚ä¸‹é…ç½®ï¼š

application.yml:
  mybatis.mapper-locations: classpath:mapper/*.xml

application-prod.yml:
  mybatis.mapper-locations: classpath:sql/*.xml

å¯åŠ¨æ—¶æŒ‡å®šï¼š
  java -jar app.jar --mybatis.mapper-locations=classpath:xml/*.xml

æœ€ç»ˆä½¿ç”¨ï¼šclasspath:xml/*.xmlï¼ˆå‘½ä»¤è¡Œä¼˜å…ˆçº§æœ€é«˜ï¼‰
```

---

## 6. ğŸ¥ å¥åº·æ£€æŸ¥é…ç½®


### 6.1 ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥


**å¥åº·æ£€æŸ¥çš„ä½œç”¨**ï¼š
> å°±åƒåŒ»é™¢ä½“æ£€ï¼Œå®šæœŸæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

**SpringBoot Actuatorå¥åº·æ£€æŸ¥**ï¼š
```xml
<!-- æ·»åŠ ç›‘æ§ä¾èµ– -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

### 6.2 å¥åº·æ£€æŸ¥é…ç½®


```yaml
management:
  endpoints:
    web:
      exposure:
        include: health  # æš´éœ²å¥åº·æ£€æŸ¥ç«¯ç‚¹
  
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

# è®¿é—®: http://localhost:8080/actuator/health
# è¿”å›ç¤ºä¾‹:
# {
#   "status": "UP",
#   "components": {
#     "db": {
#       "status": "UP",
#       "details": {
#         "database": "MySQL",
#         "validationQuery": "isValid()"
#       }
#     }
#   }
# }
```

**å¥åº·æ£€æŸ¥æµç¨‹**ï¼š
```
ç”¨æˆ·è®¿é—® /actuator/health
    â†“
Actuatoræ£€æŸ¥æ•°æ®æºè¿æ¥
    â†“
æ‰§è¡ŒvalidationQueryéªŒè¯
    â†“
è¿”å›å¥åº·çŠ¶æ€
    â†“
UPï¼ˆæ­£å¸¸ï¼‰æˆ– DOWNï¼ˆå¼‚å¸¸ï¼‰
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 æ•´åˆå…³é”®æ­¥éª¤


```
SpringBootæ•´åˆMyBatisä¸‰æ­¥èµ°ï¼š

ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–
â””â”€ mybatis-spring-boot-starterï¼ˆæ ¸å¿ƒï¼‰
â””â”€ æ•°æ®åº“é©±åŠ¨ï¼ˆmysql-connector-javaï¼‰

ç¬¬äºŒæ­¥ï¼šå†™é…ç½®
â””â”€ æ•°æ®æºé…ç½®ï¼ˆurlã€usernameã€passwordï¼‰
â””â”€ MyBatisé…ç½®ï¼ˆmapperä½ç½®ã€å®ä½“ç±»åŒ…ï¼‰

ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºMapper
â””â”€ æ¥å£åŠ @Mapperæ³¨è§£
â””â”€ æˆ–å¯åŠ¨ç±»ç”¨@MapperScanæ‰«æ
```

### 7.2 é…ç½®æ–‡ä»¶è¦ç‚¹


| é…ç½®é¡¹ | **ä½œç”¨** | **æ˜¯å¦å¿…éœ€** |
|--------|----------|--------------|
| `spring.datasource.*` | `æ•°æ®åº“è¿æ¥ä¿¡æ¯` | `å¿…éœ€` |
| `mybatis.mapper-locations` | `SQLæ–‡ä»¶ä½ç½®` | `å¿…éœ€` |
| `mybatis.type-aliases-package` | `å®ä½“ç±»åŒ…å` | `æ¨è` |
| `mybatis.configuration.*` | `MyBatisæ ¸å¿ƒé…ç½®` | `å¯é€‰` |

### 7.3 è‡ªåŠ¨é…ç½®æ ¸å¿ƒ


**è®°å¿†è¦ç‚¹**ï¼š
- `MybatisAutoConfiguration`ï¼šè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒç±»
- `@ConditionalOnClass`ï¼šæ¡ä»¶è£…é…ï¼Œæ£€æµ‹åˆ°MyBatisæ‰å¯åŠ¨
- `MybatisProperties`ï¼šé…ç½®å±æ€§ç»‘å®šç±»
- `SqlSessionFactory`ï¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

### 7.4 å¤šç¯å¢ƒé…ç½®æŠ€å·§


```
ç¯å¢ƒé…ç½®ä¸‰è¦ç´ ï¼š

1. æ–‡ä»¶å‘½åè§„èŒƒ
   application-{profile}.yml

2. æ¿€æ´»æŒ‡å®šç¯å¢ƒ
   spring.profiles.active=dev

3. é…ç½®ä¼˜å…ˆçº§
   å‘½ä»¤è¡Œ > ç¯å¢ƒé…ç½® > å…¬å…±é…ç½® > é»˜è®¤é…ç½®
```

### 7.5 å¸¸è§é—®é¢˜ä¸è§£å†³


**é—®é¢˜1ï¼šMapperæ³¨å…¥å¤±è´¥**
```
é”™è¯¯ï¼šCould not autowire. No beans of 'UserMapper' type found

è§£å†³ï¼š
âœ… æ£€æŸ¥Mapperæ¥å£æ˜¯å¦åŠ äº†@Mapperæ³¨è§£
âœ… æˆ–æ£€æŸ¥å¯åŠ¨ç±»æ˜¯å¦åŠ äº†@MapperScan
```

**é—®é¢˜2ï¼šæ‰¾ä¸åˆ°Mapper.xmlæ–‡ä»¶**
```
é”™è¯¯ï¼šInvalid bound statement (not found)

è§£å†³ï¼š
âœ… æ£€æŸ¥mapper-locationsé…ç½®è·¯å¾„
âœ… ç¡®è®¤XMLæ–‡ä»¶åœ¨classpathä¸‹
âœ… æ£€æŸ¥namespaceæ˜¯å¦æ­£ç¡®
```

**é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**
```
é”™è¯¯ï¼šCannot load driver class: com.mysql.cj.jdbc.Driver

è§£å†³ï¼š
âœ… ç¡®è®¤æ·»åŠ äº†mysqlé©±åŠ¨ä¾èµ–
âœ… æ£€æŸ¥driver-class-nameé…ç½®
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ•´åˆMyBatisä¸‰ä»¶äº‹ï¼š
å¼•å…¥starteræ·»ä¾èµ–
æ•°æ®é…ç½®å†™æ¸…æ¥š  
Mapperæ³¨è§£åˆ«å¿˜è®°

è‡ªåŠ¨é…ç½®å¾ˆæ™ºèƒ½ï¼š
æ¡ä»¶è£…é…æŒ‰éœ€å¯
å±æ€§ç»‘å®šè‡ªåŠ¨å¡«
SqlSessionå¸®ä½ å»º
```