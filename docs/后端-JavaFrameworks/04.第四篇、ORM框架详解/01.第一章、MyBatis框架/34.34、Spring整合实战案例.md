---
title: 34ã€Springæ•´åˆå®æˆ˜æ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [å®æˆ˜é¡¹ç›®æ¦‚è¿°](#1-å®æˆ˜é¡¹ç›®æ¦‚è¿°)
2. [å®Œæ•´é¡¹ç›®æ­å»º](#2-å®Œæ•´é¡¹ç›®æ­å»º)
3. [CRUDæ“ä½œå®ç°](#3-CRUDæ“ä½œå®ç°)
4. [åˆ†é¡µæŸ¥è¯¢å®ç°](#4-åˆ†é¡µæŸ¥è¯¢å®ç°)
5. [äº‹åŠ¡ç®¡ç†å®è·µ](#5-äº‹åŠ¡ç®¡ç†å®è·µ)
6. [å¼‚å¸¸å¤„ç†æœºåˆ¶](#6-å¼‚å¸¸å¤„ç†æœºåˆ¶)
7. [æµ‹è¯•ç¼–å†™å®è·µ](#7-æµ‹è¯•ç¼–å†™å®è·µ)
8. [æ€§èƒ½è°ƒä¼˜å®è·µ](#8-æ€§èƒ½è°ƒä¼˜å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å®æˆ˜é¡¹ç›®æ¦‚è¿°


### 1.1 é¡¹ç›®èƒŒæ™¯


**æˆ‘ä»¬è¦åšä»€ä¹ˆï¼Ÿ**
æƒ³è±¡ä½ åœ¨å¼€å‘ä¸€ä¸ª**ç®€å•çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ**ï¼Œéœ€è¦å®ç°ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ã€‚è¿™æ˜¯ä¼ä¸šå¼€å‘ä¸­æœ€å¸¸è§çš„åœºæ™¯ï¼Œé€šè¿‡è¿™ä¸ªå®æˆ˜æ¡ˆä¾‹ï¼Œä½ å°†æŒæ¡Springæ•´åˆMyBatisçš„å®Œæ•´æµç¨‹ã€‚

**ä¸ºä»€ä¹ˆé€‰è¿™ä¸ªæ¡ˆä¾‹ï¼Ÿ**
- åœºæ™¯çœŸå®ï¼Œè´´è¿‘å®é™…å·¥ä½œ
- åŒ…å«æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ç‚¹
- å®¹æ˜“ç†è§£ï¼Œé€‚åˆæ–°æ‰‹å…¥é—¨
- å¯ä»¥ç›´æ¥å¥—ç”¨åˆ°å…¶ä»–é¡¹ç›®

### 1.2 æŠ€æœ¯æ¶æ„


**é¡¹ç›®æŠ€æœ¯æ ˆï¼š**
```
å‰ç«¯å±‚ï¼šç®€å•HTML/JSPï¼ˆæœ¬æ¬¡ä¸é‡ç‚¹è®²è§£ï¼‰
       â†“
æ§åˆ¶å±‚ï¼šSpring MVCï¼ˆæ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å“åº”ï¼‰
       â†“
ä¸šåŠ¡å±‚ï¼šSpring Serviceï¼ˆä¸šåŠ¡é€»è¾‘å¤„ç†ï¼‰
       â†“
æŒä¹…å±‚ï¼šMyBatisï¼ˆæ•°æ®åº“æ“ä½œï¼‰
       â†“
æ•°æ®åº“ï¼šMySQLï¼ˆæ•°æ®å­˜å‚¨ï¼‰
```

**å…³é”®ç†è§£ç‚¹ï¼š**
- **Spring MVC**ï¼šè´Ÿè´£æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œå°±åƒé¤å…çš„æœåŠ¡å‘˜
- **Spring Service**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå°±åƒé¤å…çš„å¨å¸ˆ
- **MyBatis**ï¼šæ“ä½œæ•°æ®åº“ï¼Œå°±åƒé¤å…çš„ä»“åº“ç®¡ç†å‘˜

### 1.3 åŠŸèƒ½éœ€æ±‚


| åŠŸèƒ½æ¨¡å— | å…·ä½“åŠŸèƒ½ | æŠ€æœ¯è¦ç‚¹ |
|---------|---------|----------|
| ç”¨æˆ·æŸ¥è¯¢ | æŸ¥è¯¢å•ä¸ªç”¨æˆ·<br>æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·<br>æ¡ä»¶æŸ¥è¯¢ | åŸºç¡€CRUD<br>åŠ¨æ€SQL |
| ç”¨æˆ·æ–°å¢ | æ·»åŠ æ–°ç”¨æˆ· | å‚æ•°ä¼ é€’<br>ä¸»é”®å›å¡« |
| ç”¨æˆ·ä¿®æ”¹ | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | åŠ¨æ€æ›´æ–°<br>ä¹è§‚é” |
| ç”¨æˆ·åˆ é™¤ | åˆ é™¤ç”¨æˆ·<br>æ‰¹é‡åˆ é™¤ | çº§è”åˆ é™¤<br>æ‰¹é‡æ“ä½œ |
| åˆ†é¡µæŸ¥è¯¢ | åˆ†é¡µæ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ | PageHelperæ’ä»¶ |

---

## 2. ğŸ› ï¸ å®Œæ•´é¡¹ç›®æ­å»º


### 2.1 åˆ›å»ºMavené¡¹ç›®


**ç¬¬ä¸€æ­¥ï¼šé¡¹ç›®åŸºæœ¬ä¿¡æ¯**
```xml
<groupId>com.example</groupId>
<artifactId>spring-mybatis-demo</artifactId>
<version>1.0-SNAPSHOT</version>
<packaging>war</packaging>
```

**é€šä¿—ç†è§£ï¼š**
- `groupId`ï¼šå…¬å¸/ç»„ç»‡åï¼Œå°±åƒä½ çš„å§“æ°
- `artifactId`ï¼šé¡¹ç›®åï¼Œå°±åƒä½ çš„åå­—
- `packaging`ï¼šæ‰“åŒ…æ–¹å¼ï¼ŒwaråŒ…å¯ä»¥éƒ¨ç½²åˆ°Tomcat

### 2.2 æ ¸å¿ƒä¾èµ–é…ç½®


**ä¾èµ–æ¸…å•ï¼ˆpom.xmlï¼‰ï¼š**

```xml
<!-- Springæ ¸å¿ƒä¾èµ– -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>5.3.20</version>
</dependency>

<!-- Spring JDBCæ”¯æŒ -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>5.3.20</version>
</dependency>

<!-- MyBatisæ ¸å¿ƒ -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.9</version>
</dependency>

<!-- MyBatis-Springæ•´åˆåŒ… -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
    <version>2.0.7</version>
</dependency>

<!-- æ•°æ®åº“é©±åŠ¨ -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.28</version>
</dependency>

<!-- æ•°æ®æºï¼ˆè¿æ¥æ± ï¼‰ -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.2.8</version>
</dependency>
```

**ä¾èµ–è¯´æ˜ï¼š**
- **spring-context**ï¼šSpringæ ¸å¿ƒå®¹å™¨ï¼Œç®¡ç†Bean
- **spring-jdbc**ï¼šSpringçš„æ•°æ®åº“æ”¯æŒ
- **mybatis**ï¼šMyBatisæ ¸å¿ƒæ¡†æ¶
- **mybatis-spring**ï¼šæ•´åˆSpringå’ŒMyBatisçš„æ¡¥æ¢ï¼ˆå…³é”®ï¼ï¼‰
- **druid**ï¼šé˜¿é‡Œå·´å·´çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ¯”æ™®é€šè¿æ¥æ± æ€§èƒ½æ›´å¥½

### 2.3 Springé…ç½®æ–‡ä»¶


**æ ¸å¿ƒé…ç½®ï¼ˆspring-config.xmlï¼‰ï¼š**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx">
    
    <!-- 1. åŠ è½½æ•°æ®åº“é…ç½® -->
    <context:property-placeholder location="classpath:db.properties"/>
    
    <!-- 2. é…ç½®æ•°æ®æº -->
    <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource">
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
        <!-- è¿æ¥æ± å‚æ•° -->
        <property name="initialSize" value="5"/>
        <property name="maxActive" value="20"/>
    </bean>
    
    <!-- 3. é…ç½®SqlSessionFactoryï¼ˆMyBatisæ ¸å¿ƒï¼‰-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="mapperLocations" value="classpath:mapper/*.xml"/>
        <property name="typeAliasesPackage" value="com.example.entity"/>
    </bean>
    
    <!-- 4. é…ç½®Mapperæ‰«æ -->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.example.mapper"/>
    </bean>
    
    <!-- 5. é…ç½®äº‹åŠ¡ç®¡ç†å™¨ -->
    <bean id="transactionManager" 
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    
    <!-- 6. å¼€å¯æ³¨è§£äº‹åŠ¡ -->
    <tx:annotation-driven transaction-manager="transactionManager"/>
</beans>
```

**é…ç½®è§£æï¼š**

| é…ç½®é¡¹ | ä½œç”¨ | é€šä¿—ç†è§£ |
|-------|------|----------|
| **æ•°æ®æºé…ç½®** | æä¾›æ•°æ®åº“è¿æ¥ | å°±åƒæ°´ç®¡è¿æ¥åˆ°æ°´æº |
| **SqlSessionFactory** | MyBatisæ ¸å¿ƒå·¥å‚ | ç”Ÿäº§æ•°æ®åº“æ“ä½œå¯¹è±¡çš„å·¥å‚ |
| **Mapperæ‰«æ** | è‡ªåŠ¨æ‰«æMapperæ¥å£ | è‡ªåŠ¨æ‰¾åˆ°æ‰€æœ‰æ•°æ®åº“æ“ä½œæ¥å£ |
| **äº‹åŠ¡ç®¡ç†å™¨** | ç®¡ç†æ•°æ®åº“äº‹åŠ¡ | ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„ç®¡å®¶ |

### 2.4 æ•°æ®åº“é…ç½®


**db.propertiesï¼š**
```properties
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/demo?useSSL=false&serverTimezone=UTC
jdbc.username=root
jdbc.password=123456
```

**ä¸ºä»€ä¹ˆè¦å•ç‹¬é…ç½®ï¼Ÿ**
- æ–¹ä¾¿ä¿®æ”¹ï¼šæ”¹æ•°æ®åº“ä¿¡æ¯ä¸ç”¨æ”¹ä»£ç 
- å®‰å…¨æ€§ï¼šå¯†ç ä¸ç›´æ¥å†™åœ¨ä»£ç é‡Œ
- ç¯å¢ƒåˆ‡æ¢ï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå¯ä»¥ç”¨ä¸åŒé…ç½®

### 2.5 ç›®å½•ç»“æ„


```
src/main/java/
  â”œâ”€â”€ com.example.entity/      # å®ä½“ç±»ï¼ˆå¯¹åº”æ•°æ®åº“è¡¨ï¼‰
  â”œâ”€â”€ com.example.mapper/       # Mapperæ¥å£ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰
  â”œâ”€â”€ com.example.service/      # Serviceæ¥å£å’Œå®ç°ï¼ˆä¸šåŠ¡å±‚ï¼‰
  â””â”€â”€ com.example.controller/   # Controllerï¼ˆæ§åˆ¶å±‚ï¼‰

src/main/resources/
  â”œâ”€â”€ mapper/                   # Mapper XMLæ–‡ä»¶
  â”œâ”€â”€ spring-config.xml         # Springé…ç½®æ–‡ä»¶
  â””â”€â”€ db.properties            # æ•°æ®åº“é…ç½®æ–‡ä»¶
```

**ç›®å½•è¯´æ˜ï¼š**
- **entity**ï¼šå­˜æ”¾JavaBeanï¼Œå¯¹åº”æ•°æ®åº“è¡¨
- **mapper**ï¼šæ•°æ®è®¿é—®å±‚ï¼Œå®šä¹‰æ•°æ®åº“æ“ä½œæ–¹æ³•
- **service**ï¼šä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç†ä¸šåŠ¡è§„åˆ™
- **controller**ï¼šæ¥æ”¶è¯·æ±‚ï¼Œè°ƒç”¨service

---

## 3. ğŸ“ CRUDæ“ä½œå®ç°


### 3.1 åˆ›å»ºå®ä½“ç±»


**Userå®ä½“ç±»ï¼š**
```java
public class User {
    private Long id;           // ç”¨æˆ·ID
    private String username;   // ç”¨æˆ·å
    private String password;   // å¯†ç 
    private String email;      // é‚®ç®±
    private Date createTime;   // åˆ›å»ºæ—¶é—´
    
    // getter/setterçœç•¥
}
```

**å¯¹åº”çš„æ•°æ®åº“è¡¨ï¼š**
```sql
CREATE TABLE user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(100) NOT NULL,
    email VARCHAR(100),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 3.2 Mapperæ¥å£å®šä¹‰


**UserMapper.javaï¼š**
```java
public interface UserMapper {
    // æŸ¥è¯¢å•ä¸ªç”¨æˆ·
    User selectById(Long id);
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    List<User> selectAll();
    
    // æ–°å¢ç”¨æˆ·
    int insert(User user);
    
    // æ›´æ–°ç”¨æˆ·
    int update(User user);
    
    // åˆ é™¤ç”¨æˆ·
    int deleteById(Long id);
}
```

**æ¥å£è¯´æ˜ï¼š**
- æ–¹æ³•åè¦è§åçŸ¥æ„
- è¿”å›å€¼ç±»å‹è¦æ˜ç¡®ï¼ˆintè¡¨ç¤ºå½±å“è¡Œæ•°ï¼‰
- å‚æ•°ç±»å‹è¦åŒ¹é…ä¸šåŠ¡éœ€æ±‚

### 3.3 Mapper XMLæ˜ å°„


**UserMapper.xmlæ ¸å¿ƒé…ç½®ï¼š**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- 1. æŸ¥è¯¢å•ä¸ªç”¨æˆ· -->
    <select id="selectById" resultType="User">
        SELECT * FROM user WHERE id = #{id}
    </select>
    
    <!-- 2. æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ· -->
    <select id="selectAll" resultType="User">
        SELECT * FROM user ORDER BY create_time DESC
    </select>
    
    <!-- 3. æ–°å¢ç”¨æˆ·ï¼ˆè‡ªåŠ¨è¿”å›ä¸»é”®ï¼‰-->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user (username, password, email)
        VALUES (#{username}, #{password}, #{email})
    </insert>
    
    <!-- 4. æ›´æ–°ç”¨æˆ· -->
    <update id="update">
        UPDATE user 
        SET username = #{username},
            email = #{email}
        WHERE id = #{id}
    </update>
    
    <!-- 5. åˆ é™¤ç”¨æˆ· -->
    <delete id="deleteById">
        DELETE FROM user WHERE id = #{id}
    </delete>
</mapper>
```

**å…³é”®ç‚¹è¯´æ˜ï¼š**
- `namespace`ï¼šå¿…é¡»å¯¹åº”Mapperæ¥å£çš„å®Œæ•´ç±»å
- `id`ï¼šå¯¹åº”æ¥å£ä¸­çš„æ–¹æ³•å
- `resultType`ï¼šè¿”å›å€¼ç±»å‹ï¼ˆå·²é…ç½®åˆ«åï¼Œæ‰€ä»¥ç›´æ¥å†™Userï¼‰
- `#{id}`ï¼šå‚æ•°å ä½ç¬¦ï¼Œé˜²æ­¢SQLæ³¨å…¥

### 3.4 Serviceå±‚å®ç°


**UserServiceæ¥å£ï¼š**
```java
public interface UserService {
    User getUserById(Long id);
    List<User> getAllUsers();
    void saveUser(User user);
    void updateUser(User user);
    void deleteUser(Long id);
}
```

**UserServiceImplå®ç°ç±»ï¼š**
```java
@Service  // Springè‡ªåŠ¨ç®¡ç†
public class UserServiceImpl implements UserService {
    
    @Autowired  // è‡ªåŠ¨æ³¨å…¥Mapper
    private UserMapper userMapper;
    
    @Override
    public User getUserById(Long id) {
        return userMapper.selectById(id);
    }
    
    @Override
    public List<User> getAllUsers() {
        return userMapper.selectAll();
    }
    
    @Override
    @Transactional  // å¼€å¯äº‹åŠ¡
    public void saveUser(User user) {
        userMapper.insert(user);
    }
    
    @Override
    @Transactional
    public void updateUser(User user) {
        userMapper.update(user);
    }
    
    @Override
    @Transactional
    public void deleteUser(Long id) {
        userMapper.deleteById(id);
    }
}
```

**Serviceå±‚çš„ä½œç”¨ï¼š**
- **ä¸šåŠ¡é€»è¾‘**ï¼šå¤„ç†å¤æ‚çš„ä¸šåŠ¡è§„åˆ™
- **äº‹åŠ¡æ§åˆ¶**ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
- **è°ƒç”¨Mapper**ï¼šå®Œæˆæ•°æ®åº“æ“ä½œ

### 3.5 Controllerå±‚å®ç°


**UserController.javaï¼š**
```java
@RestController
@RequestMapping("/user")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // æŸ¥è¯¢ç”¨æˆ·
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.getUserById(id);
    }
    
    // æ–°å¢ç”¨æˆ·
    @PostMapping
    public String addUser(@RequestBody User user) {
        userService.saveUser(user);
        return "success";
    }
    
    // æ›´æ–°ç”¨æˆ·
    @PutMapping
    public String updateUser(@RequestBody User user) {
        userService.updateUser(user);
        return "success";
    }
    
    // åˆ é™¤ç”¨æˆ·
    @DeleteMapping("/{id}")
    public String deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
        return "success";
    }
}
```

**ControlleråŠŸèƒ½ï¼š**
- æ¥æ”¶HTTPè¯·æ±‚
- è°ƒç”¨Serviceå¤„ç†ä¸šåŠ¡
- è¿”å›JSONå“åº”

---

## 4. ğŸ“„ åˆ†é¡µæŸ¥è¯¢å®ç°


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†é¡µï¼Ÿ


**åœºæ™¯ä¸¾ä¾‹ï¼š**
å‡è®¾ç”¨æˆ·è¡¨æœ‰10ä¸‡æ¡æ•°æ®ï¼Œå¦‚æœä¸€æ¬¡æ€§å…¨éƒ¨æŸ¥è¯¢ï¼š
- å†…å­˜å ç”¨å¤§ï¼ˆå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼‰
- ç½‘ç»œä¼ è¾“æ…¢ï¼ˆæ•°æ®é‡å¤ªå¤§ï¼‰
- é¡µé¢æ¸²æŸ“æ…¢ï¼ˆæµè§ˆå™¨å¡é¡¿ï¼‰

**åˆ†é¡µçš„å¥½å¤„ï¼š**
- æ¯æ¬¡åªæŸ¥è¯¢ä¸€å°éƒ¨åˆ†æ•°æ®ï¼ˆæ¯”å¦‚20æ¡ï¼‰
- æå‡æ€§èƒ½ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒ
- å‡è½»æœåŠ¡å™¨å‹åŠ›

### 4.2 PageHelperæ’ä»¶é›†æˆ


**æ·»åŠ ä¾èµ–ï¼š**
```xml
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper-spring-boot-starter</artifactId>
    <version>1.4.2</version>
</dependency>
```

**Springé…ç½®ä¸­æ·»åŠ ï¼š**
```xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <property name="mapperLocations" value="classpath:mapper/*.xml"/>
    <!-- é…ç½®åˆ†é¡µæ’ä»¶ -->
    <property name="plugins">
        <array>
            <bean class="com.github.pagehelper.PageInterceptor">
                <property name="properties">
                    <value>
                        helperDialect=mysql
                        reasonable=true
                    </value>
                </property>
            </bean>
        </array>
    </property>
</bean>
```

### 4.3 åˆ†é¡µæŸ¥è¯¢å®ç°


**Serviceå±‚ï¼š**
```java
public PageInfo<User> getUsersByPage(int pageNum, int pageSize) {
    // å¼€å¯åˆ†é¡µï¼ˆå¿…é¡»åœ¨æŸ¥è¯¢å‰è°ƒç”¨ï¼‰
    PageHelper.startPage(pageNum, pageSize);
    
    // æ‰§è¡ŒæŸ¥è¯¢
    List<User> users = userMapper.selectAll();
    
    // å°è£…åˆ†é¡µä¿¡æ¯
    return new PageInfo<>(users);
}
```

**å·¥ä½œåŸç†ï¼š**
```
1. PageHelper.startPage(1, 10)  â†’ è®¾ç½®åˆ†é¡µå‚æ•°
                                 ï¼ˆç¬¬1é¡µï¼Œæ¯é¡µ10æ¡ï¼‰
                                 
2. userMapper.selectAll()       â†’ æ‰§è¡ŒæŸ¥è¯¢
                                 ï¼ˆPageHelperè‡ªåŠ¨æ‹¦æˆªï¼Œæ”¹å†™SQLï¼‰
                                 
3. åŸSQL: SELECT * FROM user
   æ”¹å†™å: SELECT * FROM user LIMIT 0, 10
   
4. new PageInfo<>(users)        â†’ å°è£…åˆ†é¡µç»“æœ
                                 ï¼ˆåŒ…å«æ€»æ•°ã€é¡µç ç­‰ä¿¡æ¯ï¼‰
```

**PageInfoåŒ…å«çš„ä¿¡æ¯ï¼š**
| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `pageNum` | å½“å‰é¡µç  | 1 |
| `pageSize` | æ¯é¡µæ¡æ•° | 10 |
| `total` | æ€»è®°å½•æ•° | 100 |
| `pages` | æ€»é¡µæ•° | 10 |
| `list` | å½“å‰é¡µæ•°æ® | [User1, User2...] |

### 4.4 Controlleræ¥å£


```java
@GetMapping("/page")
public PageInfo<User> getUserPage(
    @RequestParam(defaultValue = "1") int pageNum,
    @RequestParam(defaultValue = "10") int pageSize) {
    
    return userService.getUsersByPage(pageNum, pageSize);
}
```

**è°ƒç”¨ç¤ºä¾‹ï¼š**
```
GET /user/page?pageNum=2&pageSize=20
```

**è¿”å›ç»“æœï¼š**
```json
{
  "pageNum": 2,
  "pageSize": 20,
  "total": 100,
  "pages": 5,
  "list": [
    {"id": 21, "username": "user21"...},
    {"id": 22, "username": "user22"...},
    ...
  ]
}
```

---

## 5. ğŸ’¼ äº‹åŠ¡ç®¡ç†å®è·µ


### 5.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ


**ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š**
æƒ³è±¡ä½ åœ¨é“¶è¡Œè½¬è´¦ï¼š
```
æ­¥éª¤1ï¼šä»ä½ çš„è´¦æˆ·æ‰£æ¬¾500å…ƒ
æ­¥éª¤2ï¼šå‘å¯¹æ–¹è´¦æˆ·å­˜å…¥500å…ƒ
```

å¦‚æœæ­¥éª¤1æˆåŠŸï¼Œæ­¥éª¤2å¤±è´¥ä¼šæ€æ ·ï¼Ÿä½ çš„é’±æ‰£äº†ï¼Œä½†å¯¹æ–¹æ²¡æ”¶åˆ°ï¼è¿™å°±æ˜¯äº‹åŠ¡è¦è§£å†³çš„é—®é¢˜ã€‚

**äº‹åŠ¡çš„ç‰¹æ€§ï¼ˆACIDï¼‰ï¼š**
- **åŸå­æ€§ï¼ˆAï¼‰**ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
- **ä¸€è‡´æ€§ï¼ˆCï¼‰**ï¼šæ•°æ®ä¿æŒä¸€è‡´çŠ¶æ€
- **éš”ç¦»æ€§ï¼ˆIï¼‰**ï¼šå¤šä¸ªäº‹åŠ¡äº’ä¸å¹²æ‰°
- **æŒä¹…æ€§ï¼ˆDï¼‰**ï¼šä¸€æ—¦æäº¤ï¼Œæ°¸ä¹…ä¿å­˜

### 5.2 Springå£°æ˜å¼äº‹åŠ¡


**æ–¹å¼ä¸€ï¼šæ³¨è§£æ–¹å¼ï¼ˆæ¨èï¼‰**
```java
@Service
public class UserServiceImpl implements UserService {
    
    @Transactional  // æ–¹æ³•çº§äº‹åŠ¡
    public void transferMoney(Long fromId, Long toId, int amount) {
        // æ‰£æ¬¾
        accountMapper.deduct(fromId, amount);
        
        // æ¨¡æ‹Ÿå¼‚å¸¸
        int result = 1 / 0;  // å¦‚æœè¿™é‡Œå‡ºé”™ï¼Œä¸Šé¢çš„æ‰£æ¬¾ä¼šå›æ»š
        
        // åŠ æ¬¾
        accountMapper.add(toId, amount);
    }
}
```

**@Transactionalå±æ€§é…ç½®ï¼š**
| å±æ€§ | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `propagation` | äº‹åŠ¡ä¼ æ’­è¡Œä¸º | `REQUIRED`ï¼ˆé»˜è®¤ï¼‰ |
| `isolation` | éš”ç¦»çº§åˆ« | `READ_COMMITTED` |
| `timeout` | è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | `30` |
| `readOnly` | åªè¯»äº‹åŠ¡ | `true`/`false` |
| `rollbackFor` | å›æ»šå¼‚å¸¸ | `Exception.class` |

**æ–¹å¼äºŒï¼šç¼–ç¨‹å¼äº‹åŠ¡ï¼ˆçµæ´»ï¼‰**
```java
@Autowired
private TransactionTemplate transactionTemplate;

public void complexOperation() {
    transactionTemplate.execute(status -> {
        try {
            // ä¸šåŠ¡æ“ä½œ
            userMapper.insert(user);
            orderMapper.insert(order);
            return true;
        } catch (Exception e) {
            status.setRollbackOnly();  // æ‰‹åŠ¨å›æ»š
            return false;
        }
    });
}
```

### 5.3 äº‹åŠ¡ä¼ æ’­è¡Œä¸º


**å¸¸è§åœºæ™¯ï¼š**
```java
@Service
public class OrderService {
    
    @Autowired
    private LogService logService;
    
    @Transactional
    public void createOrder(Order order) {
        // ä¿å­˜è®¢å•
        orderMapper.insert(order);
        
        // è®°å½•æ—¥å¿—
        logService.saveLog("åˆ›å»ºè®¢å•");  // æ—¥å¿—æœåŠ¡ä¹Ÿæœ‰äº‹åŠ¡
    }
}

@Service
public class LogService {
    
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void saveLog(String message) {
        logMapper.insert(message);
    }
}
```

**ä¼ æ’­è¡Œä¸ºè¯´æ˜ï¼š**

| ä¼ æ’­è¡Œä¸º | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|---------|------|----------|
| `REQUIRED` | æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º | é»˜è®¤é€‰æ‹© |
| `REQUIRES_NEW` | æ€»æ˜¯æ–°å»ºäº‹åŠ¡ | æ—¥å¿—è®°å½•ï¼ˆç‹¬ç«‹æäº¤ï¼‰ |
| `SUPPORTS` | æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ™®é€šæ‰§è¡Œ | æŸ¥è¯¢æ“ä½œ |
| `NOT_SUPPORTED` | æŒ‚èµ·å½“å‰äº‹åŠ¡ | éäº‹åŠ¡æ“ä½œ |

### 5.4 äº‹åŠ¡å¤±æ•ˆåœºæ™¯


**åœºæ™¯1ï¼šæ–¹æ³•ä¸æ˜¯public**
```java
@Transactional
private void saveUser() {  // âŒ äº‹åŠ¡å¤±æ•ˆï¼
    userMapper.insert(user);
}
```

**åœºæ™¯2ï¼šè‡ªè°ƒç”¨**
```java
@Service
public class UserService {
    
    public void outerMethod() {
        this.innerMethod();  // âŒ äº‹åŠ¡å¤±æ•ˆï¼
    }
    
    @Transactional
    public void innerMethod() {
        userMapper.insert(user);
    }
}
```

**åœºæ™¯3ï¼šå¼‚å¸¸è¢«æ•è·**
```java
@Transactional
public void saveUser() {
    try {
        userMapper.insert(user);
        int result = 1 / 0;
    } catch (Exception e) {
        // âŒ å¼‚å¸¸è¢«æ•è·ï¼Œäº‹åŠ¡ä¸ä¼šå›æ»š
    }
}
```

**æ­£ç¡®åšæ³•ï¼š**
```java
@Transactional
public void saveUser() {
    try {
        userMapper.insert(user);
        int result = 1 / 0;
    } catch (Exception e) {
        throw new RuntimeException(e);  // âœ… é‡æ–°æŠ›å‡ºå¼‚å¸¸
    }
}
```

---

## 6. âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Ÿ


**é—®é¢˜åœºæ™¯ï¼š**
```java
// æ²¡æœ‰ç»Ÿä¸€å¤„ç†ï¼Œä»£ç é‡å¤ä¸”æ··ä¹±
@GetMapping("/{id}")
public User getUser(@PathVariable Long id) {
    try {
        return userService.getUserById(id);
    } catch (Exception e) {
        // æ¯ä¸ªæ–¹æ³•éƒ½è¦å†™å¼‚å¸¸å¤„ç†
        return null;
    }
}
```

**ç»Ÿä¸€å¤„ç†çš„å¥½å¤„ï¼š**
- ä»£ç ç®€æ´ï¼Œä¸ç”¨æ¯ä¸ªæ–¹æ³•éƒ½try-catch
- è¿”å›æ ¼å¼ç»Ÿä¸€ï¼Œå‰ç«¯å¥½å¤„ç†
- æ—¥å¿—è®°å½•é›†ä¸­ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜

### 6.2 è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸


**åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»ï¼š**
```java
public class BusinessException extends RuntimeException {
    private int code;  // é”™è¯¯ç 
    
    public BusinessException(String message) {
        super(message);
        this.code = 500;
    }
    
    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }
    
    public int getCode() {
        return code;
    }
}
```

**åœ¨Serviceä¸­ä½¿ç”¨ï¼š**
```java
public User getUserById(Long id) {
    User user = userMapper.selectById(id);
    if (user == null) {
        throw new BusinessException(404, "ç”¨æˆ·ä¸å­˜åœ¨");
    }
    return user;
}
```

### 6.3 å…¨å±€å¼‚å¸¸å¤„ç†å™¨


**åˆ›å»ºç»Ÿä¸€å“åº”ç±»ï¼š**
```java
public class Result<T> {
    private int code;      // çŠ¶æ€ç 
    private String message; // æç¤ºä¿¡æ¯
    private T data;        // è¿”å›æ•°æ®
    
    // æˆåŠŸå“åº”
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.code = 200;
        result.message = "success";
        result.data = data;
        return result;
    }
    
    // å¤±è´¥å“åº”
    public static <T> Result<T> error(int code, String message) {
        Result<T> result = new Result<>();
        result.code = code;
        result.message = message;
        return result;
    }
}
```

**å…¨å±€å¼‚å¸¸å¤„ç†ï¼š**
```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result<?> handleValidException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult().getFieldError().getDefaultMessage();
        return Result.error(400, message);
    }
    
    // å¤„ç†æ‰€æœ‰å…¶ä»–å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public Result<?> handleException(Exception e) {
        e.printStackTrace();  // æ‰“å°æ—¥å¿—
        return Result.error(500, "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
    }
}
```

### 6.4 å¼‚å¸¸å¤„ç†æµç¨‹


```
ç”¨æˆ·è¯·æ±‚
   â†“
Controlleræ¥æ”¶è¯·æ±‚
   â†“
è°ƒç”¨Serviceå¤„ç†ä¸šåŠ¡
   â†“
ServiceæŠ›å‡ºå¼‚å¸¸ â†---â†’ GlobalExceptionHandleræ•è·
   â†“                          â†“
äº‹åŠ¡å›æ»š                   è¿”å›ç»Ÿä¸€æ ¼å¼çš„é”™è¯¯ä¿¡æ¯
   â†“
å‰ç«¯å±•ç¤ºé”™è¯¯æç¤º
```

**å®é™…æ•ˆæœï¼š**
```json
// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "zhangsan"
  }
}

// å¤±è´¥å“åº”
{
  "code": 404,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "data": null
}
```

---

## 7. ğŸ§ª æµ‹è¯•ç¼–å†™å®è·µ


### 7.1 ä¸ºä»€ä¹ˆè¦å†™æµ‹è¯•ï¼Ÿ


**çœŸå®æ•…äº‹ï¼š**
å¼€å‘äººå‘˜ï¼š"ä»£ç å†™å®Œäº†ï¼Œåº”è¯¥æ²¡é—®é¢˜ã€‚"
ä¸Šçº¿åï¼š"æ€ä¹ˆçªç„¶æŠ¥é”™äº†ï¼Ÿæˆ‘æœ¬åœ°æ˜æ˜æ˜¯å¥½çš„ï¼"

**æµ‹è¯•çš„ä»·å€¼ï¼š**
- æå‰å‘ç°bugï¼Œé¿å…çº¿ä¸Šäº‹æ•…
- ä¿è¯ä»£ç è´¨é‡ï¼Œå¢å¼ºä¿¡å¿ƒ
- æ–¹ä¾¿é‡æ„ï¼Œé˜²æ­¢æ”¹åä»£ç 
- æ–‡æ¡£ä½œç”¨ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨

### 7.2 å•å…ƒæµ‹è¯•ç¼–å†™


**æ·»åŠ æµ‹è¯•ä¾èµ–ï¼š**
```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-test</artifactId>
    <version>5.3.20</version>
    <scope>test</scope>
</dependency>

<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
```

**Mapperå±‚æµ‹è¯•ï¼š**
```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:spring-config.xml")
public class UserMapperTest {
    
    @Autowired
    private UserMapper userMapper;
    
    @Test
    public void testSelectById() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        Long id = 1L;
        
        // æ‰§è¡ŒæŸ¥è¯¢
        User user = userMapper.selectById(id);
        
        // éªŒè¯ç»“æœ
        Assert.assertNotNull("ç”¨æˆ·ä¸åº”ä¸ºç©º", user);
        Assert.assertEquals("ç”¨æˆ·ååº”è¯¥æ˜¯zhangsan", "zhangsan", user.getUsername());
    }
    
    @Test
    public void testInsert() {
        User user = new User();
        user.setUsername("testuser");
        user.setPassword("123456");
        
        int result = userMapper.insert(user);
        
        Assert.assertEquals("æ’å…¥åº”è¯¥æˆåŠŸ", 1, result);
        Assert.assertNotNull("ä¸»é”®åº”è¯¥å›å¡«", user.getId());
    }
}
```

**Serviceå±‚æµ‹è¯•ï¼š**
```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:spring-config.xml")
@Transactional  // æµ‹è¯•å®Œè‡ªåŠ¨å›æ»š
public class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    public void testSaveUser() {
        User user = new User();
        user.setUsername("newuser");
        user.setPassword("123456");
        
        userService.saveUser(user);
        
        User saved = userService.getUserById(user.getId());
        Assert.assertNotNull(saved);
    }
    
    @Test(expected = BusinessException.class)
    public void testGetUserNotFound() {
        // æµ‹è¯•å¼‚å¸¸æƒ…å†µ
        userService.getUserById(9999L);
    }
}
```

### 7.3 é›†æˆæµ‹è¯•ç¼–å†™


**é›†æˆæµ‹è¯•ç‰¹ç‚¹ï¼š**
- æµ‹è¯•å¤šä¸ªæ¨¡å—çš„åä½œ
- ä½¿ç”¨çœŸå®æ•°æ®åº“
- æµ‹è¯•å®Œæ•´çš„ä¸šåŠ¡æµç¨‹

**ç¤ºä¾‹ï¼š**
```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = "classpath:spring-config.xml")
@Transactional
public class UserIntegrationTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    public void testUserCRUD() {
        // 1. åˆ›å»ºç”¨æˆ·
        User user = new User();
        user.setUsername("integration");
        user.setPassword("123456");
        userService.saveUser(user);
        Long userId = user.getId();
        
        // 2. æŸ¥è¯¢ç”¨æˆ·
        User queried = userService.getUserById(userId);
        Assert.assertEquals("integration", queried.getUsername());
        
        // 3. æ›´æ–°ç”¨æˆ·
        queried.setEmail("test@example.com");
        userService.updateUser(queried);
        
        // 4. éªŒè¯æ›´æ–°
        User updated = userService.getUserById(userId);
        Assert.assertEquals("test@example.com", updated.getEmail());
        
        // 5. åˆ é™¤ç”¨æˆ·
        userService.deleteUser(userId);
        
        // 6. éªŒè¯åˆ é™¤ï¼ˆåº”è¯¥æŠ›å¼‚å¸¸ï¼‰
        try {
            userService.getUserById(userId);
            Assert.fail("åº”è¯¥æŠ›å‡ºå¼‚å¸¸");
        } catch (BusinessException e) {
            Assert.assertEquals(404, e.getCode());
        }
    }
}
```

### 7.4 æµ‹è¯•æœ€ä½³å®è·µ


**âœ… å¥½çš„æµ‹è¯•ï¼š**
- æµ‹è¯•åç§°æ¸…æ™°ï¼ˆtestSelectUserByIdï¼‰
- ä¸€ä¸ªæµ‹è¯•åªæµ‹ä¸€ä¸ªåŠŸèƒ½ç‚¹
- åŒ…å«æ–­è¨€éªŒè¯ç»“æœ
- ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•

**âŒ ä¸å¥½çš„æµ‹è¯•ï¼š**
- æµ‹è¯•åç§°æ¨¡ç³Šï¼ˆtest1ã€test2ï¼‰
- ä¸€ä¸ªæµ‹è¯•æµ‹å¤šä¸ªåŠŸèƒ½
- æ²¡æœ‰æ–­è¨€ï¼Œåªæ˜¯æ‰§è¡Œä»£ç 
- æµ‹è¯•ä¹‹é—´ç›¸äº’ä¾èµ–

**æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼š**
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼š90%ä»¥ä¸Š
- å·¥å…·ç±»æ–¹æ³•ï¼š80%ä»¥ä¸Š
- Controllerå±‚ï¼š70%ä»¥ä¸Š

---

## 8. âš¡ æ€§èƒ½è°ƒä¼˜å®è·µ


### 8.1 SQLä¼˜åŒ–


**é—®é¢˜1ï¼šN+1æŸ¥è¯¢é—®é¢˜**
```java
// âŒ ç³Ÿç³•çš„åšæ³•
List<User> users = userMapper.selectAll();
for (User user : users) {
    // æ¯æ¬¡å¾ªç¯éƒ½æŸ¥è¯¢æ•°æ®åº“ï¼
    List<Order> orders = orderMapper.selectByUserId(user.getId());
    user.setOrders(orders);
}
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼šä¸€æ¬¡æ€§å…³è”æŸ¥è¯¢**
```xml
<!-- UserMapper.xml -->
<select id="selectWithOrders" resultMap="userOrderMap">
    SELECT u.*, o.id as order_id, o.order_no, o.amount
    FROM user u
    LEFT JOIN `order` o ON u.id = o.user_id
</select>

<resultMap id="userOrderMap" type="User">
    <id column="id" property="id"/>
    <result column="username" property="username"/>
    <collection property="orders" ofType="Order">
        <id column="order_id" property="id"/>
        <result column="order_no" property="orderNo"/>
        <result column="amount" property="amount"/>
    </collection>
</resultMap>
```

**é—®é¢˜2ï¼šå…¨è¡¨æŸ¥è¯¢**
```sql
-- âŒ ç³Ÿç³•çš„SQL
SELECT * FROM user WHERE username LIKE '%zhang%'

-- âœ… ä¼˜åŒ–åï¼ˆæ·»åŠ ç´¢å¼•ï¼‰
ALTER TABLE user ADD INDEX idx_username(username);
SELECT * FROM user WHERE username LIKE 'zhang%'
```

### 8.2 ç¼“å­˜ä¼˜åŒ–


**ä¸€çº§ç¼“å­˜ï¼ˆSqlSessionçº§åˆ«ï¼‰ï¼š**
```java
// åŒä¸€ä¸ªSqlSessionä¸­ï¼Œç›¸åŒæŸ¥è¯¢åªæ‰§è¡Œä¸€æ¬¡
SqlSession session = sqlSessionFactory.openSession();
UserMapper mapper = session.getMapper(UserMapper.class);

User user1 = mapper.selectById(1L);  // æŸ¥è¯¢æ•°æ®åº“
User user2 = mapper.selectById(1L);  // ä»ç¼“å­˜è·å–
```

**äºŒçº§ç¼“å­˜ï¼ˆMapperçº§åˆ«ï¼‰ï¼š**
```xml
<!-- UserMapper.xml -->
<cache/>  <!-- å¼€å¯äºŒçº§ç¼“å­˜ -->

<select id="selectById" resultType="User" useCache="true">
    SELECT * FROM user WHERE id = #{id}
</select>
```

**Redisç¼“å­˜é›†æˆï¼š**
```java
@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private RedisTemplate<String, User> redisTemplate;
    
    @Autowired
    private UserMapper userMapper;
    
    public User getUserById(Long id) {
        // å…ˆæŸ¥ç¼“å­˜
        String key = "user:" + id;
        User user = redisTemplate.opsForValue().get(key);
        
        if (user == null) {
            // ç¼“å­˜æ²¡æœ‰ï¼ŒæŸ¥æ•°æ®åº“
            user = userMapper.selectById(id);
            if (user != null) {
                // å­˜å…¥ç¼“å­˜ï¼Œè¿‡æœŸæ—¶é—´1å°æ—¶
                redisTemplate.opsForValue().set(key, user, 1, TimeUnit.HOURS);
            }
        }
        
        return user;
    }
}
```

### 8.3 è¿æ¥æ± è°ƒä¼˜


**Druidè¿æ¥æ± é…ç½®ï¼š**
```xml
<bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource">
    <!-- åŸºç¡€é…ç½® -->
    <property name="driverClassName" value="${jdbc.driver}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
    
    <!-- è¿æ¥æ± é…ç½® -->
    <property name="initialSize" value="5"/>        <!-- åˆå§‹è¿æ¥æ•° -->
    <property name="minIdle" value="5"/>            <!-- æœ€å°ç©ºé—²è¿æ¥ -->
    <property name="maxActive" value="20"/>         <!-- æœ€å¤§æ´»è·ƒè¿æ¥ -->
    <property name="maxWait" value="60000"/>        <!-- æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰-->
    
    <!-- æ£€æµ‹é…ç½® -->
    <property name="validationQuery" value="SELECT 1"/>
    <property name="testWhileIdle" value="true"/>   <!-- ç©ºé—²æ—¶æ£€æµ‹ -->
    <property name="testOnBorrow" value="false"/>
    <property name="testOnReturn" value="false"/>
    
    <!-- ç›‘æ§é…ç½® -->
    <property name="filters" value="stat,wall"/>    <!-- ç›‘æ§ç»Ÿè®¡ã€é˜²ç«å¢™ -->
</bean>
```

**å‚æ•°è°ƒä¼˜å»ºè®®ï¼š**
| å‚æ•° | è¯´æ˜ | æ¨èå€¼ |
|-----|------|--------|
| `initialSize` | åˆå§‹è¿æ¥æ•° | 5-10 |
| `maxActive` | æœ€å¤§è¿æ¥æ•° | CPUæ ¸å¿ƒæ•° Ã— 2 + ç£ç›˜æ•° |
| `maxWait` | æœ€å¤§ç­‰å¾…æ—¶é—´ | 3000-10000ms |
| `minIdle` | æœ€å°ç©ºé—²è¿æ¥ | ä¸initialSizeç›¸åŒ |

### 8.4 æ‰¹é‡æ“ä½œä¼˜åŒ–


**é—®é¢˜ï¼šå¾ªç¯æ’å…¥**
```java
// âŒ ç³Ÿç³•çš„åšæ³•
for (User user : users) {
    userMapper.insert(user);  // æ¯æ¬¡éƒ½è®¿é—®æ•°æ®åº“
}
```

**ä¼˜åŒ–ï¼šæ‰¹é‡æ’å…¥**
```xml
<!-- UserMapper.xml -->
<insert id="batchInsert">
    INSERT INTO user (username, password, email)
    VALUES
    <foreach collection="list" item="user" separator=",">
        (#{user.username}, #{user.password}, #{user.email})
    </foreach>
</insert>
```

```java
// Serviceå±‚
public void batchSaveUsers(List<User> users) {
    // åˆ†æ‰¹å¤„ç†ï¼Œæ¯æ‰¹1000æ¡
    int batchSize = 1000;
    for (int i = 0; i < users.size(); i += batchSize) {
        int end = Math.min(i + batchSize, users.size());
        List<User> batch = users.subList(i, end);
        userMapper.batchInsert(batch);
    }
}
```

### 8.5 æ€§èƒ½ç›‘æ§


**Druidç›‘æ§é¡µé¢é…ç½®ï¼š**
```xml
<servlet>
    <servlet-name>DruidStatView</servlet-name>
    <servlet-class>com.alibaba.druid.support.http.StatViewServlet</servlet-class>
</servlet>
<servlet-mapping>
    <servlet-name>DruidStatView</servlet-name>
    <url-pattern>/druid/*</url-pattern>
</servlet-mapping>
```

**è®¿é—®ç›‘æ§é¡µé¢ï¼š**
```
http://localhost:8080/druid
```

**ç›‘æ§æŒ‡æ ‡ï¼š**
- SQLæ‰§è¡Œæ—¶é—´
- æ…¢SQLç»Ÿè®¡
- è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
- äº‹åŠ¡æäº¤å›æ»šæƒ…å†µ

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹


**æ•´åˆé…ç½®ï¼š**
- âœ… ç†è§£Springå’ŒMyBatisçš„æ•´åˆåŸç†
- âœ… æŒæ¡SqlSessionFactoryçš„é…ç½®
- âœ… ç†Ÿæ‚‰Mapperæ‰«ææœºåˆ¶
- âœ… é…ç½®æ•°æ®æºå’Œè¿æ¥æ± 

**CRUDæ“ä½œï¼š**
- âœ… ç¼–å†™Mapperæ¥å£å’ŒXMLæ˜ å°„
- âœ… å®ç°Serviceä¸šåŠ¡å±‚
- âœ… åˆ›å»ºControlleræ¥å£
- âœ… ç†è§£ä¸‰å±‚æ¶æ„çš„èŒè´£

**é«˜çº§ç‰¹æ€§ï¼š**
- âœ… ä½¿ç”¨PageHelperå®ç°åˆ†é¡µ
- âœ… å£°æ˜å¼äº‹åŠ¡ç®¡ç†
- âœ… å…¨å±€å¼‚å¸¸å¤„ç†
- âœ… å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- âœ… SQLä¼˜åŒ–æŠ€å·§
- âœ… ç¼“å­˜ä½¿ç”¨ç­–ç•¥
- âœ… è¿æ¥æ± è°ƒä¼˜
- âœ… æ‰¹é‡æ“ä½œä¼˜åŒ–

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**æ•´åˆçš„æœ¬è´¨ï¼š**
```
Springå®¹å™¨ç®¡ç†MyBatiså¯¹è±¡
   â†“
SqlSessionFactoryç”±Springåˆ›å»º
   â†“
Mapperæ¥å£è‡ªåŠ¨æ³¨å…¥åˆ°Service
   â†“
äº‹åŠ¡ç”±Springç»Ÿä¸€ç®¡ç†
```

**åˆ†å±‚æ¶æ„çš„æ„ä¹‰ï¼š**
- **Controller**ï¼šåªè´Ÿè´£æ¥æ”¶è¯·æ±‚å’Œè¿”å›å“åº”
- **Service**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘å’Œäº‹åŠ¡æ§åˆ¶
- **Mapper**ï¼šä¸“æ³¨æ•°æ®è®¿é—®ï¼Œä¸æ¶‰åŠä¸šåŠ¡

**äº‹åŠ¡ç®¡ç†è¦ç‚¹ï¼š**
- ä½¿ç”¨`@Transactional`å¼€å¯äº‹åŠ¡
- æ³¨æ„äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯
- åˆç†é€‰æ‹©äº‹åŠ¡ä¼ æ’­è¡Œä¸º
- å¼‚å¸¸è¦æ­£ç¡®æŠ›å‡ºæ‰èƒ½å›æ»š

### 9.3 å®æˆ˜ç»éªŒæ€»ç»“


**å¼€å‘æµç¨‹ï¼š**
```
1. è®¾è®¡æ•°æ®åº“è¡¨
2. åˆ›å»ºå®ä½“ç±»
3. ç¼–å†™Mapperæ¥å£å’ŒXML
4. å®ç°Serviceä¸šåŠ¡å±‚
5. åˆ›å»ºControlleræ¥å£
6. ç¼–å†™å•å…ƒæµ‹è¯•
7. è¿›è¡Œé›†æˆæµ‹è¯•
8. æ€§èƒ½è°ƒä¼˜
```

**å¸¸è§é—®é¢˜æ’æŸ¥ï¼š**
| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|------|----------|
| Mapperæ³¨å…¥å¤±è´¥ | æœªé…ç½®æ‰«æ | æ£€æŸ¥MapperScannerConfigurer |
| äº‹åŠ¡ä¸ç”Ÿæ•ˆ | æ–¹æ³•ä¸æ˜¯public | æ”¹ä¸ºpublicæ–¹æ³• |
| SQLæ‰§è¡Œæ…¢ | ç¼ºå°‘ç´¢å¼• | æ·»åŠ åˆé€‚çš„ç´¢å¼• |
| è¿æ¥æ± è€—å°½ | è¿æ¥æœªé‡Šæ”¾ | æ£€æŸ¥æ˜¯å¦æ­£ç¡®å…³é—­ |

**æœ€ä½³å®è·µï¼š**
- ç»Ÿä¸€è¿”å›æ ¼å¼ï¼Œæ–¹ä¾¿å‰ç«¯å¤„ç†
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œé¿å…ä»£ç é‡å¤
- åˆç†ä½¿ç”¨ç¼“å­˜ï¼Œæå‡æ€§èƒ½
- å®Œå–„çš„æµ‹è¯•ï¼Œä¿è¯ä»£ç è´¨é‡
- å…³æ³¨ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

### 9.4 åç»­å­¦ä¹ å»ºè®®


**è¿›é˜¶å†…å®¹ï¼š**
- MyBatis-Plusæ¡†æ¶ï¼ˆç®€åŒ–CRUDï¼‰
- åŠ¨æ€æ•°æ®æºåˆ‡æ¢
- è¯»å†™åˆ†ç¦»é…ç½®
- åˆ†åº“åˆ†è¡¨å®è·µ

**æ‰©å±•æŠ€èƒ½ï¼š**
- Spring Bootå¿«é€Ÿå¼€å‘
- Redisç¼“å­˜æ·±å…¥åº”ç”¨
- å¾®æœåŠ¡æ¶æ„è®¾è®¡
- åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†

---

## ğŸ“ æ ¸å¿ƒè®°å¿†


**æ•´åˆä¸‰æ­¥æ›²ï¼š**
1. é…ç½®æ•°æ®æºï¼ˆè¿æ¥æ•°æ®åº“ï¼‰
2. åˆ›å»ºSqlSessionFactoryï¼ˆMyBatisæ ¸å¿ƒï¼‰
3. æ‰«æMapperæ¥å£ï¼ˆè‡ªåŠ¨æ³¨å…¥ï¼‰

**å¼€å‘äº”æ­¥èµ°ï¼š**
1. å®ä½“ç±»ï¼ˆå¯¹åº”è¡¨ï¼‰
2. Mapperæ¥å£+XMLï¼ˆæ•°æ®è®¿é—®ï¼‰
3. Serviceå±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
4. Controllerå±‚ï¼ˆæ¥å£æš´éœ²ï¼‰
5. æµ‹è¯•éªŒè¯ï¼ˆä¿è¯è´¨é‡ï¼‰

**æ€§èƒ½ä¼˜åŒ–å››æ‹›ï¼š**
1. SQLä¼˜åŒ–ï¼ˆç´¢å¼•ã€é¿å…N+1ï¼‰
2. ç¼“å­˜åº”ç”¨ï¼ˆå‡å°‘æ•°æ®åº“è®¿é—®ï¼‰
3. è¿æ¥æ± è°ƒä¼˜ï¼ˆåˆç†é…ç½®å‚æ•°ï¼‰
4. æ‰¹é‡æ“ä½œï¼ˆå‡å°‘ç½‘ç»œå¼€é”€ï¼‰

---

> **ğŸ’¡ å­¦ä¹ å»ºè®®ï¼š**
> - äº²è‡ªåŠ¨æ‰‹æ­å»ºå®Œæ•´é¡¹ç›®
> - ç†è§£æ¯ä¸ªé…ç½®çš„ä½œç”¨
> - å¤šå†™æµ‹è¯•ï¼Œå…»æˆå¥½ä¹ æƒ¯
> - å…³æ³¨æ€§èƒ½ï¼ŒæŒç»­ä¼˜åŒ–