---
title: 8ã€å­—æ®µå¡«å……ä¸å¿½ç•¥
---
## ğŸ“š ç›®å½•

1. [å­—æ®µè‡ªåŠ¨å¡«å……æ¦‚è¿°](#1-å­—æ®µè‡ªåŠ¨å¡«å……æ¦‚è¿°)
2. [@TableFieldæ³¨è§£è¯¦è§£](#2-TableFieldæ³¨è§£è¯¦è§£)
3. [MetaObjectHandlerå¡«å……å™¨](#3-MetaObjectHandlerå¡«å……å™¨)
4. [å¸¸è§å¡«å……åœºæ™¯å®æˆ˜](#4-å¸¸è§å¡«å……åœºæ™¯å®æˆ˜)
5. [å­—æ®µå¿½ç•¥é…ç½®](#5-å­—æ®µå¿½ç•¥é…ç½®)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å­—æ®µè‡ªåŠ¨å¡«å……æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å­—æ®µè‡ªåŠ¨å¡«å……


**ç”Ÿæ´»åœºæ™¯ç±»æ¯”**ï¼š
```
å°±åƒä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼š
- æŸœå‘˜ä¼šè‡ªåŠ¨è®°å½•ï¼šåŠç†æ—¶é—´ã€æ“ä½œå‘˜å·¥å·
- ä½ åªéœ€è¦å…³å¿ƒï¼šå­˜å¤šå°‘é’±ã€å–å¤šå°‘é’±
- ä¸éœ€è¦æ¯æ¬¡éƒ½æ‰‹åŠ¨å¡«å†™æ—¶é—´å’Œæ“ä½œäºº

æ•°æ®åº“æ“ä½œä¹Ÿä¸€æ ·ï¼š
- åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ â†’ ç³»ç»Ÿè‡ªåŠ¨è®°å½•
- åˆ›å»ºäººã€ä¿®æ”¹äºº â†’ è‡ªåŠ¨è·å–å½“å‰ç”¨æˆ·
- ä½ åªéœ€è¦å…³å¿ƒ â†’ ä¸šåŠ¡æ•°æ®æœ¬èº«
```

**å®é™…å¼€å‘ç—›ç‚¹**ï¼š
```
âŒ ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
user.setCreateTime(new Date());      // æ¯æ¬¡æ–°å¢éƒ½è¦å†™
user.setUpdateTime(new Date());      // æ¯æ¬¡æ›´æ–°éƒ½è¦å†™
user.setCreateBy(getCurrentUser());  // å®¹æ˜“å¿˜è®°
user.setUpdateBy(getCurrentUser());  // ä»£ç é‡å¤

âœ… è‡ªåŠ¨å¡«å……çš„å¥½å¤„ï¼š
- ç»Ÿä¸€ç®¡ç†ï¼šä¸€ä¸ªåœ°æ–¹é…ç½®ï¼Œå…¨å±€ç”Ÿæ•ˆ
- è‡ªåŠ¨æ‰§è¡Œï¼šæ’å…¥/æ›´æ–°æ—¶è‡ªåŠ¨èµ‹å€¼
- é¿å…é—æ¼ï¼šä¸ä¼šå¿˜è®°è®¾ç½®æ—¶é—´å­—æ®µ
- ä»£ç ç®€æ´ï¼šä¸šåŠ¡ä»£ç æ›´æ¸…çˆ½
```

### 1.2 è‡ªåŠ¨å¡«å……çš„å·¥ä½œåŸç†


**æ ¸å¿ƒæµç¨‹å›¾**ï¼š
```
ä¸šåŠ¡ä»£ç                 MyBatis-Plus              æ•°æ®åº“
   |                         |                      |
   |--ä¿å­˜ç”¨æˆ·æ•°æ®----------->|                      |
   |  (åªè®¾ç½®name/age)       |                      |
   |                         |                      |
   |                    [æ‹¦æˆªæ“ä½œ]                  |
   |                         â†“                      |
   |                   æ£€æµ‹@TableField              |
   |                         â†“                      |
   |                   æ‰¾åˆ°å¡«å……ç­–ç•¥                 |
   |                         â†“                      |
   |                   è°ƒç”¨å¡«å……å™¨                   |
   |                         â†“                      |
   |                   è‡ªåŠ¨è®¾ç½®å€¼                   |
   |                   createTime=now               |
   |                   createBy=admin               |
   |                         |                      |
   |                         |--å®Œæ•´SQL------------>|
   |                         |  INSERTåŒ…å«æ‰€æœ‰å­—æ®µ  |
```

**å…³é”®ç†è§£**ï¼š
- ğŸ”¸ **æ‹¦æˆªæ—¶æœº**ï¼šåœ¨æ‰§è¡ŒSQLä¹‹å‰æ‹¦æˆª
- ğŸ”¸ **è‡ªåŠ¨è¯†åˆ«**ï¼šæ ¹æ®æ³¨è§£è¯†åˆ«éœ€è¦å¡«å……çš„å­—æ®µ
- ğŸ”¸ **é€æ˜æ“ä½œ**ï¼šå¯¹ä¸šåŠ¡ä»£ç å®Œå…¨é€æ˜

---

## 2. ğŸ“‹ @TableFieldæ³¨è§£è¯¦è§£


### 2.1 @TableFieldæ ¸å¿ƒå±æ€§


**æ³¨è§£ä½œç”¨**ï¼šå£°æ˜å®ä½“å­—æ®µä¸æ•°æ®åº“å­—æ®µçš„æ˜ å°„å…³ç³»

```java
@TableField(
    value = "create_time",           // æ•°æ®åº“å­—æ®µå
    fill = FieldFill.INSERT,         // å¡«å……ç­–ç•¥
    exist = true,                    // æ˜¯å¦æ˜¯æ•°æ®åº“å­—æ®µ
    select = true                    // æ˜¯å¦æŸ¥è¯¢è¯¥å­—æ®µ
)
private Date createTime;
```

**å±æ€§è¯´æ˜å¯¹ç…§è¡¨**ï¼š

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| **value** | `String` | `""` | æ•°æ®åº“å­—æ®µåï¼ˆå­—æ®µåä¸ä¸€è‡´æ—¶ä½¿ç”¨ï¼‰ |
| **fill** | `FieldFill` | `DEFAULT` | å­—æ®µå¡«å……ç­–ç•¥ â­æ ¸å¿ƒ |
| **exist** | `boolean` | `true` | æ˜¯å¦ä¸ºæ•°æ®åº“å­—æ®µ |
| **select** | `boolean` | `true` | æŸ¥è¯¢æ—¶æ˜¯å¦è¿”å›è¯¥å­—æ®µ |

### 2.2 å¡«å……ç­–ç•¥ç±»å‹è¯¦è§£


**FieldFillæšä¸¾å€¼**ï¼š

```java
public enum FieldFill {
    DEFAULT,        // é»˜è®¤ä¸å¤„ç†
    INSERT,         // æ’å…¥æ—¶å¡«å……
    UPDATE,         // æ›´æ–°æ—¶å¡«å……
    INSERT_UPDATE   // æ’å…¥å’Œæ›´æ–°éƒ½å¡«å……
}
```

**ä½¿ç”¨åœºæ™¯å¯¹ç…§**ï¼š

```
ğŸ“ åˆ›å»ºæ—¶é—´ï¼ˆcreateTimeï¼‰
ç­–ç•¥ï¼šFieldFill.INSERT
åŸå› ï¼šåªåœ¨æ–°å¢æ—¶éœ€è¦ï¼Œæ›´æ–°æ—¶ä¸å˜
ç¤ºä¾‹ï¼šç”¨æˆ·æ³¨å†Œæ—¶é—´ï¼Œè®¢å•åˆ›å»ºæ—¶é—´

ğŸ”„ æ›´æ–°æ—¶é—´ï¼ˆupdateTimeï¼‰
ç­–ç•¥ï¼šFieldFill.INSERT_UPDATE
åŸå› ï¼šæ–°å¢æ—¶è®¾ç½®ï¼Œæ¯æ¬¡æ›´æ–°éƒ½è¦æ”¹
ç¤ºä¾‹ï¼šæœ€åä¿®æ”¹æ—¶é—´ï¼Œæ•°æ®æ›´æ–°æ—¶é—´

ğŸ‘¤ åˆ›å»ºäººï¼ˆcreateByï¼‰
ç­–ç•¥ï¼šFieldFill.INSERT
åŸå› ï¼šè®°å½•æ˜¯è°åˆ›å»ºçš„ï¼Œä¸ä¼šå˜åŒ–
ç¤ºä¾‹ï¼šè®¢å•åˆ›å»ºäººï¼Œæ–‡ç« ä½œè€…

âœï¸ ä¿®æ”¹äººï¼ˆupdateByï¼‰
ç­–ç•¥ï¼šFieldFill.INSERT_UPDATE
åŸå› ï¼šæ–°å¢å’Œä¿®æ”¹éƒ½è¦è®°å½•æ“ä½œäºº
ç¤ºä¾‹ï¼šæœ€åä¿®æ”¹äººï¼Œå®¡æ ¸äºº
```

### 2.3 å®ä½“ç±»é…ç½®ç¤ºä¾‹


**æ ‡å‡†å®ä½“é…ç½®**ï¼š

```java
@Data
@TableName("sys_user")
public class User {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String username;
    private String email;
    
    // âœ… åˆ›å»ºæ—¶é—´ï¼šåªåœ¨æ–°å¢æ—¶è‡ªåŠ¨å¡«å……
    @TableField(fill = FieldFill.INSERT)
    private Date createTime;
    
    // âœ… æ›´æ–°æ—¶é—´ï¼šæ–°å¢å’Œæ›´æ–°éƒ½è‡ªåŠ¨å¡«å……
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private Date updateTime;
    
    // âœ… åˆ›å»ºäººï¼šåªåœ¨æ–°å¢æ—¶å¡«å……
    @TableField(fill = FieldFill.INSERT)
    private String createBy;
    
    // âœ… ä¿®æ”¹äººï¼šæ–°å¢å’Œæ›´æ–°éƒ½å¡«å……
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private String updateBy;
}
```

---

## 3. ğŸ”§ MetaObjectHandlerå¡«å……å™¨


### 3.1 å¡«å……å™¨æ¥å£è¯´æ˜


**MetaObjectHandleræ˜¯ä»€ä¹ˆ**ï¼Ÿ

```
ğŸ“Œ é€šä¿—ç†è§£ï¼š
å°±åƒä¸€ä¸ª"è‡ªåŠ¨å¡«è¡¨æœºå™¨äºº"
- ä½ åœ¨è¡¨å•æŸäº›æ ä½è´´ä¸Š"è‡ªåŠ¨å¡«å……"æ ‡ç­¾
- æœºå™¨äººçœ‹åˆ°æ ‡ç­¾å°±çŸ¥é“è¦å¡«ä»€ä¹ˆå€¼
- ä¸åŒæ“ä½œï¼ˆæ–°å¢/ä¿®æ”¹ï¼‰æœ‰ä¸åŒçš„å¡«æ³•

ğŸ”§ æŠ€æœ¯å®šä¹‰ï¼š
MyBatis-Plusæä¾›çš„å…ƒæ•°æ®å¡«å……æ¥å£
é€šè¿‡å®ç°è¿™ä¸ªæ¥å£ï¼Œå®šä¹‰å­—æ®µçš„å¡«å……é€»è¾‘
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```java
public interface MetaObjectHandler {
    
    // æ’å…¥æ—¶çš„å¡«å……é€»è¾‘
    void insertFill(MetaObject metaObject);
    
    // æ›´æ–°æ—¶çš„å¡«å……é€»è¾‘
    void updateFill(MetaObject metaObject);
}
```

### 3.2 æ ‡å‡†å¡«å……å™¨å®ç°


**å®Œæ•´å®ç°ä»£ç **ï¼š

```java
@Component  // âš ï¸ å¿…é¡»æ³¨å†Œä¸ºSpring Bean
@Slf4j
public class MyMetaObjectHandler implements MetaObjectHandler {
    
    // ğŸ”¹ æ–°å¢æ“ä½œæ—¶è‡ªåŠ¨å¡«å……
    @Override
    public void insertFill(MetaObject metaObject) {
        log.info("å¼€å§‹æ’å…¥å¡«å……...");
        
        // å¡«å……åˆ›å»ºæ—¶é—´
        this.strictInsertFill(metaObject, "createTime", Date.class, new Date());
        
        // å¡«å……æ›´æ–°æ—¶é—´
        this.strictInsertFill(metaObject, "updateTime", Date.class, new Date());
        
        // å¡«å……åˆ›å»ºäººï¼ˆä»ä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·ï¼‰
        String currentUser = getCurrentUser();
        this.strictInsertFill(metaObject, "createBy", String.class, currentUser);
        this.strictInsertFill(metaObject, "updateBy", String.class, currentUser);
    }
    
    // ğŸ”¹ æ›´æ–°æ“ä½œæ—¶è‡ªåŠ¨å¡«å……
    @Override
    public void updateFill(MetaObject metaObject) {
        log.info("å¼€å§‹æ›´æ–°å¡«å……...");
        
        // å¡«å……æ›´æ–°æ—¶é—´
        this.strictUpdateFill(metaObject, "updateTime", Date.class, new Date());
        
        // å¡«å……ä¿®æ”¹äºº
        String currentUser = getCurrentUser();
        this.strictUpdateFill(metaObject, "updateBy", String.class, currentUser);
    }
    
    // ğŸ”¹ è·å–å½“å‰ç”¨æˆ·ï¼ˆå®é™…é¡¹ç›®ä»Security/Sessionè·å–ï¼‰
    private String getCurrentUser() {
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä»è®¤è¯ä¸Šä¸‹æ–‡è·å–
        return "admin";
    }
}
```

### 3.3 å¡«å……æ–¹æ³•å¯¹æ¯”


**ä¸¤ç§å¡«å……æ–¹å¼**ï¼š

```java
// æ–¹å¼1ï¼šä¸¥æ ¼æ¨¡å¼ï¼ˆæ¨èâ­ï¼‰
this.strictInsertFill(metaObject, "createTime", Date.class, new Date());
ç‰¹ç‚¹ï¼š
âœ… åªæœ‰å­—æ®µå­˜åœ¨ä¸”ä¸ºnullæ—¶æ‰å¡«å……
âœ… é¿å…è¦†ç›–å·²æœ‰å€¼
âœ… ç±»å‹å®‰å…¨

// æ–¹å¼2ï¼šå®½æ¾æ¨¡å¼
this.fillStrategy(metaObject, "createTime", new Date());
ç‰¹ç‚¹ï¼š
âš ï¸ æ— è®ºå­—æ®µæ˜¯å¦æœ‰å€¼éƒ½ä¼šå¡«å……
âš ï¸ å¯èƒ½è¦†ç›–ä¸šåŠ¡è®¾ç½®çš„å€¼
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **metaObject** | å…ƒæ•°æ®å¯¹è±¡ | è‡ªåŠ¨ä¼ å…¥ |
| **fieldName** | å­—æ®µåï¼ˆå®ä½“ç±»å±æ€§åï¼‰ | `"createTime"` |
| **fieldType** | å­—æ®µç±»å‹ | `Date.class` |
| **fieldVal** | å¡«å……å€¼ | `new Date()` |

---

## 4. ğŸš€ å¸¸è§å¡«å……åœºæ™¯å®æˆ˜


### 4.1 åœºæ™¯1ï¼šåˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´


**éœ€æ±‚è¯´æ˜**ï¼š
```
ğŸ“Œ ä¸šåŠ¡éœ€æ±‚ï¼š
- æ–°å¢è®°å½•ï¼šè‡ªåŠ¨è®°å½•åˆ›å»ºæ—¶é—´
- ä¿®æ”¹è®°å½•ï¼šè‡ªåŠ¨æ›´æ–°ä¿®æ”¹æ—¶é—´
- åˆ›å»ºæ—¶é—´ä¸å˜ï¼Œæ›´æ–°æ—¶é—´éšæ—¶å˜åŒ–
```

**å®ä½“é…ç½®**ï¼š

```java
@Data
@TableName("tb_article")
public class Article {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String title;
    private String content;
    
    // åˆ›å»ºæ—¶é—´ï¼šåªåœ¨æ’å…¥æ—¶å¡«å……ä¸€æ¬¡
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    // æ›´æ–°æ—¶é—´ï¼šæ’å…¥å’Œæ›´æ–°éƒ½å¡«å……
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updateTime;
}
```

**å¡«å……å™¨é…ç½®**ï¼š

```java
@Component
public class TimeMetaHandler implements MetaObjectHandler {
    
    @Override
    public void insertFill(MetaObject metaObject) {
        LocalDateTime now = LocalDateTime.now();
        
        // æ–°å¢æ—¶ï¼šä¸¤ä¸ªæ—¶é—´éƒ½è®¾ç½®ä¸ºå½“å‰æ—¶é—´
        this.strictInsertFill(metaObject, "createTime", 
            LocalDateTime.class, now);
        this.strictInsertFill(metaObject, "updateTime", 
            LocalDateTime.class, now);
    }
    
    @Override
    public void updateFill(MetaObject metaObject) {
        // æ›´æ–°æ—¶ï¼šåªæ›´æ–°updateTime
        this.strictUpdateFill(metaObject, "updateTime", 
            LocalDateTime.class, LocalDateTime.now());
    }
}
```

**æ‰§è¡Œæ•ˆæœ**ï¼š

```java
// æ–°å¢æ–‡ç« 
Article article = new Article();
article.setTitle("MyBatis-Plusæ•™ç¨‹");
article.setContent("è¯¦ç»†å†…å®¹...");
articleMapper.insert(article);
// âœ… createTime = 2024-01-15 10:30:00
// âœ… updateTime = 2024-01-15 10:30:00

// 3å¤©åä¿®æ”¹æ–‡ç« 
article.setContent("ä¿®æ”¹åçš„å†…å®¹...");
articleMapper.updateById(article);
// âœ… createTime = 2024-01-15 10:30:00 (ä¸å˜)
// âœ… updateTime = 2024-01-18 15:20:00 (æ›´æ–°äº†)
```

### 4.2 åœºæ™¯2ï¼šæ“ä½œäººå‘˜è®°å½•


**éœ€æ±‚è¯´æ˜**ï¼š
```
ğŸ“Œ ä¸šåŠ¡éœ€æ±‚ï¼š
- è®°å½•æ˜¯è°åˆ›å»ºçš„æ•°æ®
- è®°å½•æœ€åæ˜¯è°ä¿®æ”¹çš„
- ä¾¿äºæ•°æ®è¿½æº¯å’Œå®¡è®¡
```

**è·å–å½“å‰ç”¨æˆ·çš„å‡ ç§æ–¹å¼**ï¼š

```java
@Component
public class UserMetaHandler implements MetaObjectHandler {
    
    // æ–¹å¼1ï¼šä»Spring Securityè·å–ï¼ˆæ¨èï¼‰
    private String getCurrentUserFromSecurity() {
        Authentication auth = SecurityContextHolder
            .getContext().getAuthentication();
        if (auth != null) {
            return auth.getName();
        }
        return "system";
    }
    
    // æ–¹å¼2ï¼šä»ThreadLocalè·å–
    private String getCurrentUserFromThreadLocal() {
        return UserContext.getCurrentUsername();
    }
    
    // æ–¹å¼3ï¼šä»RequestContextè·å–
    private String getCurrentUserFromRequest() {
        HttpServletRequest request = 
            ((ServletRequestAttributes) RequestContextHolder
                .getRequestAttributes()).getRequest();
        return (String) request.getSession()
            .getAttribute("username");
    }
    
    @Override
    public void insertFill(MetaObject metaObject) {
        String user = getCurrentUserFromSecurity();
        this.strictInsertFill(metaObject, "createBy", 
            String.class, user);
        this.strictInsertFill(metaObject, "updateBy", 
            String.class, user);
    }
    
    @Override
    public void updateFill(MetaObject metaObject) {
        String user = getCurrentUserFromSecurity();
        this.strictUpdateFill(metaObject, "updateBy", 
            String.class, user);
    }
}
```

### 4.3 åœºæ™¯3ï¼šé€»è¾‘åˆ é™¤æ ‡è®°


**éœ€æ±‚è¯´æ˜**ï¼š
```
ğŸ“Œ ä¸šåŠ¡éœ€æ±‚ï¼š
- æ•°æ®ä¸çœŸæ­£åˆ é™¤ï¼Œåªåšæ ‡è®°
- åˆ é™¤æ—¶è‡ªåŠ¨è®¾ç½®åˆ é™¤æ ‡å¿—
- è®°å½•åˆ é™¤æ—¶é—´å’Œåˆ é™¤äºº
```

**å®ä½“é…ç½®**ï¼š

```java
@Data
@TableName("tb_order")
public class Order {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String orderNo;
    
    // é€»è¾‘åˆ é™¤æ ‡å¿—ï¼ˆMPè‡ªå¸¦ï¼‰
    @TableLogic
    private Integer deleted;
    
    // åˆ é™¤æ—¶é—´ï¼ˆè‡ªå®šä¹‰å¡«å……ï¼‰
    @TableField(fill = FieldFill.UPDATE)
    private LocalDateTime deleteTime;
    
    // åˆ é™¤äººï¼ˆè‡ªå®šä¹‰å¡«å……ï¼‰
    @TableField(fill = FieldFill.UPDATE)
    private String deleteBy;
}
```

**å¡«å……å™¨é…ç½®**ï¼š

```java
@Override
public void updateFill(MetaObject metaObject) {
    // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ é™¤æ“ä½œ
    Object deleted = this.getFieldValByName("deleted", metaObject);
    
    if (deleted != null && (Integer) deleted == 1) {
        // æ˜¯åˆ é™¤æ“ä½œï¼Œå¡«å……åˆ é™¤ä¿¡æ¯
        this.strictUpdateFill(metaObject, "deleteTime", 
            LocalDateTime.class, LocalDateTime.now());
        this.strictUpdateFill(metaObject, "deleteBy", 
            String.class, getCurrentUser());
    } else {
        // æ™®é€šæ›´æ–°æ“ä½œ
        this.strictUpdateFill(metaObject, "updateTime", 
            LocalDateTime.class, LocalDateTime.now());
    }
}
```

### 4.4 åœºæ™¯4ï¼šç‰ˆæœ¬å·ä¹è§‚é”


**éœ€æ±‚è¯´æ˜**ï¼š
```
ğŸ“Œ ä¸šåŠ¡éœ€æ±‚ï¼š
- é˜²æ­¢å¹¶å‘ä¿®æ”¹æ•°æ®
- æ¯æ¬¡æ›´æ–°ç‰ˆæœ¬å·+1
- æ›´æ–°æ—¶æ ¡éªŒç‰ˆæœ¬å·
```

**å®ä½“é…ç½®**ï¼š

```java
@Data
@TableName("tb_product")
public class Product {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String name;
    private Integer stock;
    
    // ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰
    @Version
    @TableField(fill = FieldFill.INSERT)
    private Integer version;
}
```

**å¡«å……å™¨é…ç½®**ï¼š

```java
@Override
public void insertFill(MetaObject metaObject) {
    // æ–°å¢æ—¶ç‰ˆæœ¬å·è®¾ç½®ä¸º1
    this.strictInsertFill(metaObject, "version", 
        Integer.class, 1);
}
// âš ï¸ æ›´æ–°æ—¶ç‰ˆæœ¬å·ç”±@Versionæ³¨è§£è‡ªåŠ¨å¤„ç†ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¡«å……
```

**ä½¿ç”¨æ•ˆæœ**ï¼š

```java
// ç”¨æˆ·AæŸ¥è¯¢å•†å“
Product product = productMapper.selectById(1L);
// version = 1

// ç”¨æˆ·Bä¹ŸæŸ¥è¯¢äº†è¯¥å•†å“
Product product2 = productMapper.selectById(1L);
// version = 1

// ç”¨æˆ·Aå…ˆæ›´æ–°ï¼ˆæˆåŠŸï¼‰
product.setStock(90);
productMapper.updateById(product);
// âœ… UPDATE ... SET stock=90, version=2 WHERE id=1 AND version=1

// ç”¨æˆ·Båæ›´æ–°ï¼ˆå¤±è´¥ï¼‰
product2.setStock(80);
productMapper.updateById(product2);
// âŒ UPDATE ... SET stock=80, version=2 WHERE id=1 AND version=1
// å½±å“è¡Œæ•°ä¸º0ï¼Œæ›´æ–°å¤±è´¥ï¼ˆç‰ˆæœ¬å·å·²ç»æ˜¯2äº†ï¼‰
```

---

## 5. ğŸš« å­—æ®µå¿½ç•¥é…ç½®


### 5.1 ä»€ä¹ˆæ—¶å€™éœ€è¦å¿½ç•¥å­—æ®µ


**å¸¸è§åœºæ™¯**ï¼š

```
ğŸ“Œ åœºæ™¯1ï¼šå®ä½“ç±»è¾…åŠ©å±æ€§
class User {
    private String username;
    
    // âŒ æ•°æ®åº“æ²¡è¿™ä¸ªå­—æ®µï¼Œåªæ˜¯ç”¨æ¥æ¥æ”¶å‰ç«¯å‚æ•°
    private String confirmPassword;  
}

ğŸ“Œ åœºæ™¯2ï¼šè®¡ç®—å±æ€§
class Order {
    private BigDecimal price;
    private Integer quantity;
    
    // âŒ ä¸å­˜åœ¨æ•°æ®åº“ï¼Œæ˜¯è®¡ç®—å‡ºæ¥çš„
    private BigDecimal totalAmount;  
}

ğŸ“Œ åœºæ™¯3ï¼šæ•æ„Ÿå­—æ®µ
class User {
    private String password;
    
    // âœ… æŸ¥è¯¢æ—¶ä¸è¿”å›å¯†ç 
    private String passwordHash;
}
```

### 5.2 å¿½ç•¥å­—æ®µçš„ä¸‰ç§æ–¹å¼


**æ–¹å¼1ï¼šexistå±æ€§ï¼ˆå®Œå…¨å¿½ç•¥ï¼‰**

```java
@Data
@TableName("sys_user")
public class User {
    
    private String username;
    private String password;
    
    // ğŸ”¸ æ ‡è®°ä¸ºéæ•°æ®åº“å­—æ®µ
    @TableField(exist = false)
    private String confirmPassword;  // ç¡®è®¤å¯†ç 
    
    @TableField(exist = false)
    private List<Role> roles;  // ç”¨æˆ·è§’è‰²åˆ—è¡¨
}
```

**æ•ˆæœè¯´æ˜**ï¼š
```
âœ… æ’å…¥æ—¶ï¼šä¸ä¼šåŒ…å«åœ¨INSERTè¯­å¥ä¸­
âœ… æ›´æ–°æ—¶ï¼šä¸ä¼šåŒ…å«åœ¨UPDATEè¯­å¥ä¸­
âœ… æŸ¥è¯¢æ—¶ï¼šä¸ä¼šåŒ…å«åœ¨SELECTå­—æ®µä¸­
```

**æ–¹å¼2ï¼šselectå±æ€§ï¼ˆæŸ¥è¯¢æ—¶å¿½ç•¥ï¼‰**

```java
@Data
@TableName("sys_user")
public class User {
    
    private String username;
    
    // ğŸ”¸ æŸ¥è¯¢æ—¶ä¸è¿”å›è¯¥å­—æ®µ
    @TableField(select = false)
    private String password;
    
    @TableField(select = false)
    private String secretKey;
}
```

**æ•ˆæœè¯´æ˜**ï¼š
```
âœ… æ’å…¥æ—¶ï¼šæ­£å¸¸ä¿å­˜åˆ°æ•°æ®åº“
âœ… æ›´æ–°æ—¶ï¼šå¯ä»¥æ­£å¸¸æ›´æ–°
âŒ æŸ¥è¯¢æ—¶ï¼šSELECTè¯­å¥ä¸­ä¸åŒ…å«è¯¥å­—æ®µ
```

**æ–¹å¼3ï¼š@TableFieldè”åˆä½¿ç”¨**

```java
@Data
public class Article {
    
    private String title;
    
    // åœºæ™¯1ï¼šå­—æ®µåä¸ä¸€è‡´ + æŸ¥è¯¢å¿½ç•¥
    @TableField(value = "article_content", select = false)
    private String content;
    
    // åœºæ™¯2ï¼šéæ•°æ®åº“å­—æ®µ + è‡ªåŠ¨å¡«å……
    @TableField(exist = false, fill = FieldFill.INSERT)
    private String createUserName;  // å‰ç«¯å±•ç¤ºç”¨
}
```

### 5.3 æ•æ„Ÿå­—æ®µå¤„ç†æ–¹æ¡ˆ


**éœ€æ±‚åœºæ™¯**ï¼š
```
ğŸ“Œ å®‰å…¨éœ€æ±‚ï¼š
- å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯
- æŸ¥è¯¢æ—¶ä¸è¿”å›ç»™å‰ç«¯
- æ›´æ–°æ—¶å…è®¸ä¿®æ”¹
- æ’å…¥æ—¶å¯ä»¥ä¿å­˜
```

**å®Œæ•´å®ç°**ï¼š

```java
@Data
@TableName("sys_user")
public class User {
    
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String username;
    private String email;
    
    // ğŸ” å¯†ç å­—æ®µï¼šæŸ¥è¯¢æ—¶ä¸è¿”å›
    @TableField(select = false)
    private String password;
    
    // ğŸ” å®‰å…¨å¯†é’¥ï¼šæŸ¥è¯¢æ—¶ä¸è¿”å›
    @TableField(value = "secret_key", select = false)
    private String secretKey;
    
    // ğŸ“ ç”¨äºæ¥æ”¶å‰ç«¯å¯†ç ï¼Œä¸å­˜æ•°æ®åº“
    @TableField(exist = false)
    private String newPassword;
}
```

**Serviceå±‚å¤„ç†**ï¼š

```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    // æŸ¥è¯¢ç”¨æˆ·ï¼ˆä¸åŒ…å«å¯†ç ï¼‰
    public User getById(Long id) {
        return userMapper.selectById(id);
        // âœ… passwordå­—æ®µä¸ºnullï¼ˆæœªæŸ¥è¯¢ï¼‰
    }
    
    // ä¿®æ”¹å¯†ç 
    public boolean updatePassword(Long id, String newPwd) {
        User user = new User();
        user.setId(id);
        user.setPassword(newPwd);  // å¯ä»¥è®¾ç½®
        return userMapper.updateById(user) > 0;
        // âœ… æ­£å¸¸æ›´æ–°å¯†ç å­—æ®µ
    }
    
    // ç™»å½•éªŒè¯ï¼ˆéœ€è¦å¯†ç ï¼‰
    public User login(String username, String password) {
        // ğŸ”¸ ç›´æ¥æŸ¥è¯¢ä¼šæ²¡æœ‰passwordï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
        LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(User::getUsername, username)
               .select(User.class, info -> true);  // æŸ¥è¯¢æ‰€æœ‰å­—æ®µ
        
        User user = userMapper.selectOne(wrapper);
        // âœ… åŒ…å«passwordå­—æ®µï¼Œå¯ä»¥æ ¡éªŒ
        return user;
    }
}
```

### 5.4 å­—æ®µé…ç½®æ€»ç»“å¯¹ç…§


**é…ç½®å¯¹ç…§è¡¨**ï¼š

| é…ç½®æ–¹å¼ | æ’å…¥ | æ›´æ–° | æŸ¥è¯¢ | ä½¿ç”¨åœºæ™¯ |
|---------|------|------|------|---------|
| `exist=false` | âŒ | âŒ | âŒ | éæ•°æ®åº“å­—æ®µ |
| `select=false` | âœ… | âœ… | âŒ | æ•æ„Ÿä¿¡æ¯å­—æ®µ |
| `fill=INSERT` | âœ…è‡ªåŠ¨ | âšªæ‰‹åŠ¨ | âœ… | åˆ›å»ºæ—¶é—´/äºº |
| `fill=UPDATE` | âšªæ‰‹åŠ¨ | âœ…è‡ªåŠ¨ | âœ… | ä¿®æ”¹æ—¶é—´/äºº |
| `fill=INSERT_UPDATE` | âœ…è‡ªåŠ¨ | âœ…è‡ªåŠ¨ | âœ… | æ›´æ–°æ—¶é—´ |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å­—æ®µå¡«å……ï¼šåœ¨æ’å…¥/æ›´æ–°æ—¶è‡ªåŠ¨ä¸ºå­—æ®µèµ‹å€¼
ğŸ”¸ å¡«å……æ—¶æœºï¼šINSERTï¼ˆæ–°å¢ï¼‰ã€UPDATEï¼ˆæ›´æ–°ï¼‰ã€INSERT_UPDATEï¼ˆéƒ½å¡«å……ï¼‰
ğŸ”¸ MetaObjectHandlerï¼šå¡«å……å™¨æ¥å£ï¼Œå®šä¹‰å¡«å……é€»è¾‘
ğŸ”¸ å­—æ®µå¿½ç•¥ï¼šexist=falseå®Œå…¨å¿½ç•¥ï¼Œselect=falseæŸ¥è¯¢å¿½ç•¥
```

### 6.2 å…³é”®é…ç½®æ­¥éª¤


**ä¸‰æ­¥å®Œæˆè‡ªåŠ¨å¡«å……**ï¼š

```
æ­¥éª¤1ï¼šå®ä½“ç±»æ·»åŠ æ³¨è§£
@TableField(fill = FieldFill.INSERT)
private Date createTime;

æ­¥éª¤2ï¼šåˆ›å»ºå¡«å……å™¨ç±»
@Component
public class MyHandler implements MetaObjectHandler {
    @Override
    public void insertFill(MetaObject meta) {
        this.strictInsertFill(meta, "createTime", 
            Date.class, new Date());
    }
}

æ­¥éª¤3ï¼šSpringè‡ªåŠ¨è£…é…
âœ… @Componentæ³¨è§£è‡ªåŠ¨æ³¨å†Œ
âœ… MyBatis-Plusè‡ªåŠ¨è°ƒç”¨
```

### 6.3 å¸¸è§é—®é¢˜ä¸è§£å†³


**é—®é¢˜1ï¼šå¡«å……ä¸ç”Ÿæ•ˆ**

```java
âŒ é”™è¯¯ç¤ºä¾‹ï¼š
@TableField(fill = FieldFill.INSERT)
private Date createTime;

// ä½†æ˜¯æ‰‹åŠ¨è®¾ç½®äº†å€¼
user.setCreateTime(new Date());  
userMapper.insert(user);
// ç»“æœï¼šä¸ä¼šè‡ªåŠ¨å¡«å……ï¼ˆå·²æœ‰å€¼ï¼‰

âœ… è§£å†³æ–¹æ¡ˆï¼š
// æ–¹å¼1ï¼šä¸è¦æ‰‹åŠ¨è®¾ç½®
user.setUsername("å¼ ä¸‰");
userMapper.insert(user);

// æ–¹å¼2ï¼šä½¿ç”¨å®½æ¾æ¨¡å¼ï¼ˆä¸æ¨èï¼‰
fillStrategy(metaObject, "createTime", new Date());
```

**é—®é¢˜2ï¼šå¡«å……å™¨æœªç”Ÿæ•ˆ**

```java
âŒ å¸¸è§é”™è¯¯ï¼š
public class MyHandler implements MetaObjectHandler {
    // å¿˜è®°æ·»åŠ @Componentæ³¨è§£
}

âœ… æ­£ç¡®é…ç½®ï¼š
@Component  // âš ï¸ å¿…é¡»æ³¨å†Œä¸ºBean
public class MyHandler implements MetaObjectHandler {
    ...
}
```

**é—®é¢˜3ï¼šè·å–ä¸åˆ°å½“å‰ç”¨æˆ·**

```java
âŒ é”™è¯¯ç¤ºä¾‹ï¼š
private String getCurrentUser() {
    // å¼‚æ­¥çº¿ç¨‹ä¸­æ— æ³•è·å–
    return SecurityContextHolder.getContext()
        .getAuthentication().getName();
}

âœ… è§£å†³æ–¹æ¡ˆï¼š
@Component
public class MyHandler implements MetaObjectHandler {
    
    @Override
    public void insertFill(MetaObject meta) {
        try {
            String user = getCurrentUser();
            this.strictInsertFill(meta, "createBy", 
                String.class, user);
        } catch (Exception e) {
            // è·å–å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤å€¼
            this.strictInsertFill(meta, "createBy", 
                String.class, "system");
        }
    }
}
```

### 6.4 æœ€ä½³å®è·µå»ºè®®


**å®è·µå»ºè®®æ¸…å•**ï¼š

```
âœ… æ¨èåšæ³•ï¼š
- ä½¿ç”¨strictInsertFill/strictUpdateFillæ–¹æ³•
- æ—¶é—´å­—æ®µç»Ÿä¸€ä½¿ç”¨LocalDateTime
- åˆ›å»ºå¡«å……å™¨åŸºç±»ï¼Œä¾¿äºå¤ç”¨
- æ•æ„Ÿå­—æ®µä½¿ç”¨select=false
- éæ•°æ®åº“å­—æ®µä½¿ç”¨exist=false

âŒ é¿å…é—®é¢˜ï¼š
- ä¸è¦åœ¨ä¸šåŠ¡ä»£ç æ‰‹åŠ¨è®¾ç½®å¡«å……å­—æ®µ
- å¡«å……å™¨ä¸è¦æœ‰å¤æ‚ä¸šåŠ¡é€»è¾‘
- é¿å…åœ¨å¡«å……å™¨ä¸­æ“ä½œæ•°æ®åº“
- ä¸è¦å¿˜è®°@Componentæ³¨è§£
- å¼‚æ­¥åœºæ™¯æ³¨æ„ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å­—æ®µå¡«å……ä¸‰è¦ç´ ï¼Œæ³¨è§£æ¥å£åŠ æ—¶æœº
INSERTæ–°å¢UPDATEæ”¹ï¼Œéƒ½è¦å¡«å……ä¸¤ä¸ªé€‰
MetaObjectHandlerå®ç°å®ƒï¼ŒComponentåˆ«å¿˜äº†
ä¸¥æ ¼æ¨¡å¼æœ€å®‰å…¨ï¼Œç©ºå€¼æ‰å¡«ä¸è¦†ç›–
æ•æ„Ÿå­—æ®µselectå‡ï¼Œéåº“å­—æ®µexistå‡
```