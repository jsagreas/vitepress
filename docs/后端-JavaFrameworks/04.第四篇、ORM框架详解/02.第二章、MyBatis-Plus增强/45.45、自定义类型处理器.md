---
title: 45ã€è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨
---
## ğŸ“š ç›®å½•

1. [ç±»å‹å¤„ç†å™¨åŸºç¡€æ¦‚å¿µ](#1-ç±»å‹å¤„ç†å™¨åŸºç¡€æ¦‚å¿µ)
2. [TypeHandleræ¥å£è¯¦è§£](#2-TypeHandleræ¥å£è¯¦è§£)
3. [JSONå­—æ®µå¤„ç†å®æˆ˜](#3-JSONå­—æ®µå¤„ç†å®æˆ˜)
4. [å¤æ‚ç±»å‹æ˜ å°„æŠ€å·§](#4-å¤æ‚ç±»å‹æ˜ å°„æŠ€å·§)
5. [æ•°æ®ç±»å‹è½¬æ¢æ–¹æ¡ˆ](#5-æ•°æ®ç±»å‹è½¬æ¢æ–¹æ¡ˆ)
6. [è‡ªå®šä¹‰å¤„ç†é€»è¾‘å¼€å‘](#6-è‡ªå®šä¹‰å¤„ç†é€»è¾‘å¼€å‘)
7. [å¤„ç†å™¨æ³¨å†Œä¸é…ç½®](#7-å¤„ç†å™¨æ³¨å†Œä¸é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç±»å‹å¤„ç†å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç±»å‹å¤„ç†å™¨


**é€šä¿—ç†è§£**ï¼šç±»å‹å¤„ç†å™¨å°±åƒæ˜¯Javaå¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´çš„"ç¿»è¯‘å®˜"

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
ä½ è¦å¯„å¿«é€’ï¼Œä½†å¿«é€’å…¬å¸åªè®¤ç®±å­ï¼Œä¸è®¤ä½ çš„å•†å“
â†’ ä½ éœ€è¦æŠŠå•†å“è£…è¿›ç®±å­ï¼ˆJavaå¯¹è±¡â†’æ•°æ®åº“æ ¼å¼ï¼‰
â†’ æ”¶è´§æ—¶å†ä»ç®±å­å–å‡ºå•†å“ï¼ˆæ•°æ®åº“æ ¼å¼â†’Javaå¯¹è±¡ï¼‰

TypeHandlerå°±æ˜¯è¿™ä¸ª"æ‰“åŒ…/æ‹†åŒ…"çš„å·¥å…·ï¼
```

**æ ¸å¿ƒä½œç”¨**ï¼š
```
Javaåº”ç”¨              TypeHandler              æ•°æ®åº“
   â†“                      â†“                      â†“
Userå¯¹è±¡              è½¬æ¢å¤„ç†                VARCHAR
Listé›†åˆ       â†’      åºåˆ—åŒ–/ååºåˆ—åŒ–    â†’      JSONå­—ç¬¦ä¸²
æšä¸¾ç±»å‹              æ˜ å°„è½¬æ¢                  INT/VARCHAR
å¤æ‚å¯¹è±¡              è‡ªå®šä¹‰é€»è¾‘                TEXT/BLOB
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> TypeHandlerè§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼šJavaçš„ä¸°å¯Œæ•°æ®ç±»å‹ â†” æ•°æ®åº“çš„æœ‰é™æ•°æ®ç±»å‹

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹å¤„ç†å™¨


**å¸¸è§ç—›ç‚¹åœºæ™¯**ï¼š

**åœºæ™¯1ï¼šå­˜å‚¨JSONæ•°æ®**
```java
// ç”¨æˆ·è¡¨éœ€è¦å­˜å‚¨æ‰©å±•ä¿¡æ¯
public class User {
    private Long id;
    private String name;
    private Map<String, Object> extraInfo;  // æ€ä¹ˆå­˜åˆ°æ•°æ®åº“ï¼Ÿ
}

// æ²¡æœ‰TypeHandlerï¼šåªèƒ½æ‰‹åŠ¨è½¬æ¢
String json = JSON.toJSONString(extraInfo);  // å­˜å‚¨å‰
Map map = JSON.parseObject(json, Map.class); // è¯»å–å

// æœ‰TypeHandlerï¼šè‡ªåŠ¨å¤„ç†
// ç›´æ¥ä½¿ç”¨Mapï¼Œæ¡†æ¶è‡ªåŠ¨è½¬æ¢ï¼
```

**åœºæ™¯2ï¼šæšä¸¾ç±»å‹æ˜ å°„**
```java
// è®¢å•çŠ¶æ€æšä¸¾
public enum OrderStatus {
    PENDING(0, "å¾…æ”¯ä»˜"),
    PAID(1, "å·²æ”¯ä»˜"),
    SHIPPED(2, "å·²å‘è´§");
    
    private int code;
    private String desc;
}

// æ•°æ®åº“åªèƒ½å­˜intï¼Œä½†æˆ‘ä»¬æƒ³ç”¨æšä¸¾
// TypeHandlerå¸®æˆ‘ä»¬è‡ªåŠ¨è½¬æ¢
```

**åœºæ™¯3ï¼šåŠ å¯†å­—æ®µå¤„ç†**
```java
// æ•æ„Ÿä¿¡æ¯éœ€è¦åŠ å¯†å­˜å‚¨
public class UserSecret {
    private String phone;     // å­˜å‚¨æ—¶åŠ å¯†
    private String idCard;    // å­˜å‚¨æ—¶åŠ å¯†
}

// TypeHandlerè‡ªåŠ¨åŠ å¯†/è§£å¯†
```

### 1.3 TypeHandlerçš„å·¥ä½œæµç¨‹


```
ã€ä¿å­˜åˆ°æ•°æ®åº“ã€‘
Javaå¯¹è±¡ â†’ setParameter() â†’ ç±»å‹è½¬æ¢ â†’ æ•°æ®åº“å­—æ®µ
  User      TypeHandler      åºåˆ—åŒ–      VARCHAR

ã€ä»æ•°æ®åº“è¯»å–ã€‘  
æ•°æ®åº“å­—æ®µ â†’ getResult() â†’ ç±»å‹è½¬æ¢ â†’ Javaå¯¹è±¡
  VARCHAR     TypeHandler    ååºåˆ—åŒ–     User
```

**æµç¨‹è¯¦è§£**ï¼š
```
1. å†™å…¥æ•°æ®åº“ï¼š
   åº”ç”¨ä»£ç  â†’ MyBatisæ‹¦æˆª â†’ TypeHandler.setParameter()
   â†’ è½¬æ¢æ•°æ®æ ¼å¼ â†’ JDBCå†™å…¥æ•°æ®åº“

2. è¯»å–æ•°æ®åº“ï¼š
   JDBCæŸ¥è¯¢ç»“æœ â†’ MyBatisæ‹¦æˆª â†’ TypeHandler.getResult()
   â†’ è½¬æ¢ä¸ºJavaç±»å‹ â†’ è¿”å›ç»™åº”ç”¨ä»£ç 
```

---

## 2. ğŸ”§ TypeHandleræ¥å£è¯¦è§£


### 2.1 TypeHandleræ ¸å¿ƒæ¥å£


```java
public interface TypeHandler<T> {
    
    // è®¾ç½®å‚æ•°ï¼šJavaå¯¹è±¡ â†’ æ•°æ®åº“
    void setParameter(PreparedStatement ps, int i, T parameter, 
                     JdbcType jdbcType) throws SQLException;
    
    // è·å–ç»“æœï¼šæ•°æ®åº“ â†’ Javaå¯¹è±¡ï¼ˆä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼‰
    T getResult(ResultSet rs, String columnName) throws SQLException;
    T getResult(ResultSet rs, int columnIndex) throws SQLException;
    T getResult(CallableStatement cs, int columnIndex) throws SQLException;
}
```

**æ–¹æ³•è¯´æ˜**ï¼š

| æ–¹æ³• | **ä½œç”¨** | **ä½¿ç”¨åœºæ™¯** |
|------|---------|-------------|
| `setParameter` | è®¾ç½®PreparedStatementå‚æ•° | æ’å…¥/æ›´æ–°æ•°æ®æ—¶è°ƒç”¨ |
| `getResult(String)` | æ ¹æ®åˆ—åè·å–ç»“æœ | æœ€å¸¸ç”¨çš„æŸ¥è¯¢åœºæ™¯ |
| `getResult(int)` | æ ¹æ®åˆ—ç´¢å¼•è·å–ç»“æœ | ä¼˜åŒ–æ€§èƒ½åœºæ™¯ |
| `getResult(CallableStatement)` | å­˜å‚¨è¿‡ç¨‹è¿”å›å€¼å¤„ç† | è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ |

### 2.2 BaseTypeHandleråŸºç¡€ç±»


**æ¨èä½¿ç”¨**ï¼šç»§æ‰¿`BaseTypeHandler`è€Œä¸æ˜¯ç›´æ¥å®ç°æ¥å£

```java
// MyBatisæä¾›çš„æŠ½è±¡åŸºç±»ï¼Œç®€åŒ–å¼€å‘
public abstract class BaseTypeHandler<T> extends TypeReference<T> 
                                         implements TypeHandler<T> {
    
    // åªéœ€å®ç°4ä¸ªæ ¸å¿ƒæ–¹æ³•
    public abstract void setNonNullParameter(PreparedStatement ps, int i, 
                                            T parameter, JdbcType jdbcType);
    
    public abstract T getNullableResult(ResultSet rs, String columnName);
    public abstract T getNullableResult(ResultSet rs, int columnIndex);
    public abstract T getNullableResult(CallableStatement cs, int columnIndex);
}
```

> **ğŸ”§ å®è·µæŠ€å·§**
> BaseTypeHandlerå·²ç»å¤„ç†äº†nullå€¼åˆ¤æ–­ï¼Œæˆ‘ä»¬åªéœ€å…³æ³¨éç©ºæƒ…å†µçš„é€»è¾‘

**ä½¿ç”¨å¯¹æ¯”**ï¼š

```java
// âŒ ç›´æ¥å®ç°TypeHandlerï¼šéœ€è¦å¤„ç†null
public class MyHandler implements TypeHandler<String> {
    public void setParameter(...) {
        if (parameter == null) {
            ps.setNull(i, jdbcType.TYPE_CODE);
        } else {
            // å¤„ç†éç©ºé€»è¾‘
        }
    }
}

// âœ… ç»§æ‰¿BaseTypeHandlerï¼šè‡ªåŠ¨å¤„ç†null
public class MyHandler extends BaseTypeHandler<String> {
    public void setNonNullParameter(...) {
        // ç›´æ¥å†™éç©ºé€»è¾‘ï¼Œnullå·²ç»è‡ªåŠ¨å¤„ç†äº†
    }
}
```

---

## 3. ğŸ“¦ JSONå­—æ®µå¤„ç†å®æˆ˜


### 3.1 JSONç±»å‹å¤„ç†å™¨å®ç°


**ä¸šåŠ¡åœºæ™¯**ï¼šç”¨æˆ·è¡¨å­˜å‚¨æ‰©å±•ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰

```java
/**
 * JSONç±»å‹å¤„ç†å™¨
 * åŠŸèƒ½ï¼šMap/Listç­‰å¤æ‚å¯¹è±¡ â†” JSONå­—ç¬¦ä¸²
 */
@MappedTypes({Map.class, List.class})  // æ”¯æŒçš„Javaç±»å‹
@MappedJdbcTypes(JdbcType.VARCHAR)     // å¯¹åº”çš„æ•°æ®åº“ç±»å‹
public class JsonTypeHandler extends BaseTypeHandler<Object> {
    
    // å­˜å‚¨ï¼šJavaå¯¹è±¡ â†’ JSONå­—ç¬¦ä¸²
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   Object parameter, JdbcType jdbcType) 
                                   throws SQLException {
        ps.setString(i, JSON.toJSONString(parameter));
    }
    
    // è¯»å–ï¼šJSONå­—ç¬¦ä¸² â†’ Javaå¯¹è±¡
    @Override
    public Object getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        String json = rs.getString(columnName);
        return json == null ? null : JSON.parseObject(json);
    }
    
    @Override
    public Object getNullableResult(ResultSet rs, int columnIndex) 
                                   throws SQLException {
        String json = rs.getString(columnIndex);
        return json == null ? null : JSON.parseObject(json);
    }
    
    @Override
    public Object getNullableResult(CallableStatement cs, int columnIndex) 
                                   throws SQLException {
        String json = cs.getString(columnIndex);
        return json == null ? null : JSON.parseObject(json);
    }
}
```

**å·¥ä½œåŸç†å›¾ç¤º**ï¼š
```
ã€å­˜å‚¨æµç¨‹ã€‘
Mapå¯¹è±¡ â†’ JSON.toJSONString() â†’ {"name":"å¼ ä¸‰"} â†’ æ•°æ®åº“VARCHARå­—æ®µ

ã€è¯»å–æµç¨‹ã€‘
æ•°æ®åº“VARCHAR â†’ JSONå­—ç¬¦ä¸² â†’ JSON.parseObject() â†’ Mapå¯¹è±¡
```

### 3.2 æ³›å‹JSONå¤„ç†å™¨


**éœ€æ±‚å‡çº§**ï¼šä¸åŒå­—æ®µéœ€è¦è½¬æ¢æˆä¸åŒçš„Javaç±»å‹

```java
/**
 * æ³›å‹JSONå¤„ç†å™¨
 * æ”¯æŒæŒ‡å®šå…·ä½“ç±»å‹
 */
public class GenericJsonTypeHandler<T> extends BaseTypeHandler<T> {
    
    private Class<T> type;
    
    // æ„é€ å‡½æ•°è·å–æ³›å‹ç±»å‹
    public GenericJsonTypeHandler(Class<T> type) {
        if (type == null) throw new IllegalArgumentException("Typeä¸èƒ½ä¸ºnull");
        this.type = type;
    }
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   T parameter, JdbcType jdbcType) 
                                   throws SQLException {
        ps.setString(i, JSON.toJSONString(parameter));
    }
    
    @Override
    public T getNullableResult(ResultSet rs, String columnName) 
                              throws SQLException {
        String json = rs.getString(columnName);
        return json == null ? null : JSON.parseObject(json, type);
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**å®ä½“ç±»ä½¿ç”¨**ï¼š
```java
public class User {
    private Long id;
    private String name;
    
    // æŒ‡å®šå…·ä½“ç±»å‹çš„JSONå¤„ç†
    @TableField(typeHandler = GenericJsonTypeHandler.class)
    private UserProfile profile;  // è‡ªåŠ¨è½¬æ¢ä¸ºUserProfileå¯¹è±¡
    
    @TableField(typeHandler = GenericJsonTypeHandler.class)
    private List<String> tags;    // è‡ªåŠ¨è½¬æ¢ä¸ºStringåˆ—è¡¨
}
```

### 3.3 JSONæ•°ç»„å¤„ç†å™¨


**åœºæ™¯**ï¼šå­˜å‚¨æ ‡ç­¾åˆ—è¡¨ã€æƒé™æ•°ç»„ç­‰

```java
/**
 * JSONæ•°ç»„å¤„ç†å™¨
 * List<String> â†” JSONæ•°ç»„å­—ç¬¦ä¸²
 */
public class JsonListTypeHandler extends BaseTypeHandler<List<String>> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   List<String> parameter, JdbcType jdbcType) 
                                   throws SQLException {
        ps.setString(i, JSON.toJSONString(parameter));
    }
    
    @Override
    public List<String> getNullableResult(ResultSet rs, String columnName) 
                                         throws SQLException {
        String json = rs.getString(columnName);
        if (json == null) return null;
        return JSON.parseArray(json, String.class);
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class Article {
    private Long id;
    private String title;
    
    // æ ‡ç­¾åˆ—è¡¨è‡ªåŠ¨è½¬æ¢
    @TableField(typeHandler = JsonListTypeHandler.class)
    private List<String> tags;  
    // æ•°æ®åº“å­˜å‚¨ï¼š["Java", "MyBatis", "æ•™ç¨‹"]
}
```

---

## 4. ğŸ”„ å¤æ‚ç±»å‹æ˜ å°„æŠ€å·§


### 4.1 æšä¸¾ç±»å‹å¤„ç†å™¨


**ä¸šåŠ¡åœºæ™¯**ï¼šè®¢å•çŠ¶æ€ã€ç”¨æˆ·ç­‰çº§ç­‰æšä¸¾

```java
// è®¢å•çŠ¶æ€æšä¸¾
public enum OrderStatus implements IEnum<Integer> {
    PENDING(0, "å¾…æ”¯ä»˜"),
    PAID(1, "å·²æ”¯ä»˜"),
    SHIPPED(2, "å·²å‘è´§"),
    COMPLETED(3, "å·²å®Œæˆ");
    
    private final int code;
    private final String desc;
    
    OrderStatus(int code, String desc) {
        this.code = code;
        this.desc = desc;
    }
    
    @Override
    public Integer getValue() {
        return this.code;
    }
    
    // æ ¹æ®codeè·å–æšä¸¾
    public static OrderStatus of(int code) {
        for (OrderStatus status : values()) {
            if (status.code == code) return status;
        }
        throw new IllegalArgumentException("æœªçŸ¥çŠ¶æ€ç : " + code);
    }
}
```

**è‡ªå®šä¹‰æšä¸¾å¤„ç†å™¨**ï¼š
```java
public class OrderStatusTypeHandler extends BaseTypeHandler<OrderStatus> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   OrderStatus parameter, JdbcType jdbcType) 
                                   throws SQLException {
        ps.setInt(i, parameter.getValue());  // å­˜å‚¨codeå€¼
    }
    
    @Override
    public OrderStatus getNullableResult(ResultSet rs, String columnName) 
                                        throws SQLException {
        int code = rs.getInt(columnName);
        return rs.wasNull() ? null : OrderStatus.of(code);
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**ä½¿ç”¨æ•ˆæœ**ï¼š
```java
public class Order {
    private Long id;
    
    @TableField(typeHandler = OrderStatusTypeHandler.class)
    private OrderStatus status;  // è‡ªåŠ¨è½¬æ¢
}

// ä»£ç ä¸­ç›´æ¥ä½¿ç”¨æšä¸¾
order.setStatus(OrderStatus.PAID);  
// æ•°æ®åº“å­˜å‚¨ï¼š1

OrderStatus status = order.getStatus();  
// è‡ªåŠ¨è½¬æ¢ä¸ºæšä¸¾å¯¹è±¡
```

> **â­ é‡ç‚¹æŒæ¡**
> MyBatis-Pluså†…ç½®äº†é€šç”¨æšä¸¾å¤„ç†å™¨ï¼Œå®ç°IEnumæ¥å£å³å¯è‡ªåŠ¨è½¬æ¢

### 4.2 åŠ å¯†å­—æ®µå¤„ç†å™¨


**å®‰å…¨åœºæ™¯**ï¼šæ‰‹æœºå·ã€èº«ä»½è¯ç­‰æ•æ„Ÿä¿¡æ¯

```java
/**
 * AESåŠ å¯†å­—æ®µå¤„ç†å™¨
 */
public class EncryptTypeHandler extends BaseTypeHandler<String> {
    
    private static final String SECRET_KEY = "your-secret-key-16";
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   String parameter, JdbcType jdbcType) 
                                   throws SQLException {
        // åŠ å¯†åå­˜å‚¨
        String encrypted = AESUtil.encrypt(parameter, SECRET_KEY);
        ps.setString(i, encrypted);
    }
    
    @Override
    public String getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        String encrypted = rs.getString(columnName);
        if (encrypted == null) return null;
        // è§£å¯†åè¿”å›
        return AESUtil.decrypt(encrypted, SECRET_KEY);
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**å®ä½“ä½¿ç”¨**ï¼š
```java
public class UserSecret {
    private Long id;
    
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String phone;      // è‡ªåŠ¨åŠ å¯†å­˜å‚¨
    
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String idCard;     // è‡ªåŠ¨åŠ å¯†å­˜å‚¨
}
```

**å­˜å‚¨æ•ˆæœ**ï¼š
```
åº”ç”¨å±‚ä»£ç ï¼šuser.setPhone("13800138000")
æ•°æ®åº“å­˜å‚¨ï¼šXYZ123...åŠ å¯†åçš„å­—ç¬¦ä¸²
æŸ¥è¯¢è¿”å›ï¼šuser.getPhone() â†’ "13800138000"ï¼ˆè‡ªåŠ¨è§£å¯†ï¼‰
```

### 4.3 æ—¥æœŸæ—¶é—´å¤„ç†å™¨


**åœºæ™¯**ï¼šLocalDateTimeä¸æ—¶é—´æˆ³äº’è½¬

```java
/**
 * LocalDateTimeä¸æ—¶é—´æˆ³äº’è½¬å¤„ç†å™¨
 */
public class LocalDateTimeTypeHandler extends BaseTypeHandler<LocalDateTime> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   LocalDateTime parameter, JdbcType jdbcType) 
                                   throws SQLException {
        // LocalDateTime â†’ æ—¶é—´æˆ³
        long timestamp = parameter.atZone(ZoneId.systemDefault())
                                  .toInstant()
                                  .toEpochMilli();
        ps.setLong(i, timestamp);
    }
    
    @Override
    public LocalDateTime getNullableResult(ResultSet rs, String columnName) 
                                          throws SQLException {
        long timestamp = rs.getLong(columnName);
        if (rs.wasNull()) return null;
        
        // æ—¶é—´æˆ³ â†’ LocalDateTime
        return LocalDateTime.ofInstant(
            Instant.ofEpochMilli(timestamp), 
            ZoneId.systemDefault()
        );
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

---

## 5. ğŸ”€ æ•°æ®ç±»å‹è½¬æ¢æ–¹æ¡ˆ


### 5.1 å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢


**åœºæ™¯**ï¼šé€—å·åˆ†éš”çš„å­—ç¬¦ä¸² â†” æ•°ç»„

```java
/**
 * å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢å™¨
 * "tag1,tag2,tag3" â†” String[]
 */
public class StringArrayTypeHandler extends BaseTypeHandler<String[]> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   String[] parameter, JdbcType jdbcType) 
                                   throws SQLException {
        // æ•°ç»„ â†’ é€—å·åˆ†éš”å­—ç¬¦ä¸²
        ps.setString(i, String.join(",", parameter));
    }
    
    @Override
    public String[] getNullableResult(ResultSet rs, String columnName) 
                                     throws SQLException {
        String str = rs.getString(columnName);
        if (str == null || str.isEmpty()) return new String[0];
        
        // é€—å·åˆ†éš”å­—ç¬¦ä¸² â†’ æ•°ç»„
        return str.split(",");
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
public class Product {
    @TableField(typeHandler = StringArrayTypeHandler.class)
    private String[] tags;
}

// ä½¿ç”¨
product.setTags(new String[]{"çƒ­é”€", "æ–°å“", "é™æ—¶"});
// æ•°æ®åº“å­˜å‚¨ï¼š"çƒ­é”€,æ–°å“,é™æ—¶"
```

### 5.2 å¸ƒå°”å€¼è½¬æ¢å™¨


**åœºæ™¯**ï¼šBoolean â†” æ•°å­—/å­—ç¬¦

```java
/**
 * Booleanè½¬æ¢å™¨
 * true/false â†” 1/0
 */
public class BooleanTypeHandler extends BaseTypeHandler<Boolean> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   Boolean parameter, JdbcType jdbcType) 
                                   throws SQLException {
        ps.setInt(i, parameter ? 1 : 0);
    }
    
    @Override
    public Boolean getNullableResult(ResultSet rs, String columnName) 
                                    throws SQLException {
        int value = rs.getInt(columnName);
        return !rs.wasNull() && value == 1;
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

### 5.3 BigDecimalç²¾åº¦å¤„ç†


**åœºæ™¯**ï¼šé‡‘é¢å­—æ®µçš„ç²¾åº¦æ§åˆ¶

```java
/**
 * é‡‘é¢å¤„ç†å™¨ï¼ˆä¿ç•™2ä½å°æ•°ï¼‰
 */
public class MoneyTypeHandler extends BaseTypeHandler<BigDecimal> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   BigDecimal parameter, JdbcType jdbcType) 
                                   throws SQLException {
        // ä¿ç•™2ä½å°æ•°
        BigDecimal value = parameter.setScale(2, RoundingMode.HALF_UP);
        ps.setBigDecimal(i, value);
    }
    
    @Override
    public BigDecimal getNullableResult(ResultSet rs, String columnName) 
                                       throws SQLException {
        BigDecimal value = rs.getBigDecimal(columnName);
        if (value == null) return null;
        // ç¡®ä¿è¿”å›å€¼ä¹Ÿæ˜¯2ä½å°æ•°
        return value.setScale(2, RoundingMode.HALF_UP);
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

---

## 6. ğŸ› ï¸ è‡ªå®šä¹‰å¤„ç†é€»è¾‘å¼€å‘


### 6.1 è‡ªå®šä¹‰å¤„ç†å™¨å¼€å‘æµç¨‹


**å¼€å‘æ­¥éª¤**ï¼š
```
1. ç¡®å®šéœ€æ±‚ â†’ æ˜ç¡®è¦è½¬æ¢çš„ç±»å‹
   â†“
2. ç»§æ‰¿BaseTypeHandler<T> â†’ Tæ˜¯Javaç±»å‹
   â†“
3. å®ç°4ä¸ªæ ¸å¿ƒæ–¹æ³• â†’ setNonNullParameter + 3ä¸ªgetNullableResult
   â†“
4. æ·»åŠ æ³¨è§£ â†’ @MappedTypesã€@MappedJdbcTypesï¼ˆå¯é€‰ï¼‰
   â†“
5. æ³¨å†Œå¤„ç†å™¨ â†’ é…ç½®æˆ–åŒ…æ‰«æ
```

### 6.2 å®Œæ•´ç¤ºä¾‹ï¼šIPåœ°å€å¤„ç†å™¨


**éœ€æ±‚**ï¼šIPåœ°å€æ•°å­— â†” å­—ç¬¦ä¸²

```java
/**
 * IPåœ°å€å¤„ç†å™¨
 * 192.168.1.1 â†” 3232235777ï¼ˆLongç±»å‹ï¼‰
 */
@MappedTypes(String.class)
@MappedJdbcTypes(JdbcType.BIGINT)
public class IpTypeHandler extends BaseTypeHandler<String> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                   String parameter, JdbcType jdbcType) 
                                   throws SQLException {
        // IPå­—ç¬¦ä¸² â†’ æ•°å­—
        long ipNum = ipToLong(parameter);
        ps.setLong(i, ipNum);
    }
    
    @Override
    public String getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        long ipNum = rs.getLong(columnName);
        if (rs.wasNull()) return null;
        // æ•°å­— â†’ IPå­—ç¬¦ä¸²
        return longToIp(ipNum);
    }
    
    @Override
    public String getNullableResult(ResultSet rs, int columnIndex) 
                                   throws SQLException {
        long ipNum = rs.getLong(columnIndex);
        if (rs.wasNull()) return null;
        return longToIp(ipNum);
    }
    
    @Override
    public String getNullableResult(CallableStatement cs, int columnIndex) 
                                   throws SQLException {
        long ipNum = cs.getLong(columnIndex);
        if (cs.wasNull()) return null;
        return longToIp(ipNum);
    }
    
    // IPè½¬æ•°å­—ï¼š192.168.1.1 â†’ 3232235777
    private long ipToLong(String ip) {
        String[] parts = ip.split("\\.");
        long result = 0;
        for (int i = 0; i < 4; i++) {
            result = result * 256 + Integer.parseInt(parts[i]);
        }
        return result;
    }
    
    // æ•°å­—è½¬IPï¼š3232235777 â†’ 192.168.1.1
    private String longToIp(long ipNum) {
        return ((ipNum >> 24) & 0xFF) + "." +
               ((ipNum >> 16) & 0xFF) + "." +
               ((ipNum >> 8) & 0xFF) + "." +
               (ipNum & 0xFF);
    }
}
```

**ä½¿ç”¨æ•ˆæœ**ï¼š
```java
public class LoginLog {
    private Long id;
    
    @TableField(typeHandler = IpTypeHandler.class)
    private String loginIp;  // åº”ç”¨å±‚ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œæ•°æ®åº“å­˜æ•°å­—
}

// ä»£ç ä¸­
log.setLoginIp("192.168.1.1");
// æ•°æ®åº“å­˜å‚¨ï¼š3232235777ï¼ˆèŠ‚çœç©ºé—´ï¼Œæ–¹ä¾¿èŒƒå›´æŸ¥è¯¢ï¼‰
```

> **ğŸ¯ å®è·µåº”ç”¨**
> IPå­˜ä¸ºæ•°å­—çš„å¥½å¤„ï¼šèŠ‚çœç©ºé—´ï¼ˆ4å­—èŠ‚vs15å­—èŠ‚ï¼‰ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢

### 6.3 å¤„ç†å™¨æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
```java
public class GoodTypeHandler extends BaseTypeHandler<MyType> {
    
    // 1. å¼‚å¸¸å¤„ç†å®Œå–„
    @Override
    public void setNonNullParameter(...) throws SQLException {
        try {
            // è½¬æ¢é€»è¾‘
        } catch (Exception e) {
            throw new SQLException("ç±»å‹è½¬æ¢å¤±è´¥: " + e.getMessage(), e);
        }
    }
    
    // 2. nullå€¼å®‰å…¨æ£€æŸ¥
    @Override
    public MyType getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        String value = rs.getString(columnName);
        if (value == null || value.isEmpty()) {
            return null;  // æ˜ç¡®è¿”å›null
        }
        return convert(value);
    }
    
    // 3. å¤ç”¨è½¬æ¢é€»è¾‘
    private MyType convert(String value) {
        // ç»Ÿä¸€çš„è½¬æ¢é€»è¾‘
    }
}
```

**âŒ é¿å…é”™è¯¯**ï¼š
```java
// é”™è¯¯1ï¼šæœªå¤„ç†null
public String getNullableResult(...) {
    return rs.getString(columnName).toUpperCase();  // å¯èƒ½NPE
}

// é”™è¯¯2ï¼šåæ‰å¼‚å¸¸
public void setNonNullParameter(...) {
    try {
        // è½¬æ¢
    } catch (Exception e) {
        // ä»€ä¹ˆéƒ½ä¸åš - é”™è¯¯ï¼
    }
}

// é”™è¯¯3ï¼šé‡å¤ä»£ç 
// ä¸‰ä¸ªgetResultæ–¹æ³•å†™äº†ä¸‰éç›¸åŒé€»è¾‘ - åº”è¯¥æå–å…¬å…±æ–¹æ³•
```

---

## 7. ğŸ”Œ å¤„ç†å™¨æ³¨å†Œä¸é…ç½®


### 7.1 æ³¨è§£æ–¹å¼æ³¨å†Œ


**æ–¹å¼1ï¼šå­—æ®µçº§åˆ«æŒ‡å®š**
```java
public class User {
    private Long id;
    
    // ç›´æ¥åœ¨å­—æ®µä¸ŠæŒ‡å®šTypeHandler
    @TableField(typeHandler = JsonTypeHandler.class)
    private Map<String, Object> extraInfo;
}
```

**æ–¹å¼2ï¼šå…¨å±€ç±»å‹æŒ‡å®š**
```java
// ä½¿ç”¨æ³¨è§£æ ‡è®°
@MappedTypes({Map.class, List.class})       // Javaç±»å‹
@MappedJdbcTypes(JdbcType.VARCHAR)          // JDBCç±»å‹
public class JsonTypeHandler extends BaseTypeHandler<Object> {
    // ...
}
```

### 7.2 é…ç½®æ–‡ä»¶æ³¨å†Œ


**application.ymlé…ç½®**ï¼š
```yaml
mybatis-plus:
  type-handlers-package: com.example.typehandler
  configuration:
    # è‡ªåŠ¨æ˜ å°„æšä¸¾ç±»å‹
    default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler
```

**Springé…ç½®ç±»æ³¨å†Œ**ï¼š
```java
@Configuration
public class MyBatisPlusConfig {
    
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // é…ç½®æ‹¦æˆªå™¨
        return interceptor;
    }
    
    @Bean
    public ConfigurationCustomizer configurationCustomizer() {
        return configuration -> {
            // æ³¨å†ŒTypeHandler
            TypeHandlerRegistry registry = configuration.getTypeHandlerRegistry();
            registry.register(JsonTypeHandler.class);
            registry.register(IpTypeHandler.class);
            // ...
        };
    }
}
```

### 7.3 åŒ…æ‰«æè‡ªåŠ¨æ³¨å†Œ


**æ¨èæ–¹å¼**ï¼š
```yaml
mybatis-plus:
  # æ‰«æåŒ…ä¸‹æ‰€æœ‰TypeHandler
  type-handlers-package: com.example.handler
```

**ç›®å½•ç»“æ„**ï¼š
```
com.example.handler
â”œâ”€â”€ JsonTypeHandler.java
â”œâ”€â”€ EncryptTypeHandler.java
â”œâ”€â”€ IpTypeHandler.class
â””â”€â”€ ... (æ‰€æœ‰TypeHandleréƒ½ä¼šè‡ªåŠ¨æ³¨å†Œ)
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**
> åŒ…æ‰«ææ–¹å¼æœ€çœäº‹ï¼Œé€‚åˆé¡¹ç›®ä¸­æœ‰å¤šä¸ªTypeHandlerçš„æƒ…å†µ

### 7.4 æ³¨å†Œä¼˜å…ˆçº§


**ä¼˜å…ˆçº§ä»é«˜åˆ°ä½**ï¼š
```
1. @TableField(typeHandler = XXX.class)  
   å­—æ®µçº§åˆ«æŒ‡å®šï¼Œä¼˜å…ˆçº§æœ€é«˜

2. @MappedTypes + @MappedJdbcTypes
   ç±»çº§åˆ«æ³¨è§£ï¼Œç²¾ç¡®åŒ¹é…

3. é…ç½®æ–‡ä»¶æ³¨å†Œ
   å…¨å±€é…ç½®ï¼Œå½±å“æ‰€æœ‰ç›¸åŒç±»å‹

4. é»˜è®¤TypeHandler
   MyBatiså†…ç½®å¤„ç†å™¨
```

**ç¤ºä¾‹è¯´æ˜**ï¼š
```java
// åœºæ™¯ï¼šä¸¤ä¸ªå­—æ®µéƒ½æ˜¯Stringç±»å‹ï¼Œä½†å¤„ç†æ–¹å¼ä¸åŒ
public class User {
    private String name;  // æ™®é€šå­—ç¬¦ä¸²ï¼Œç”¨é»˜è®¤å¤„ç†å™¨
    
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String phone;  // åŠ å¯†å­—ç¬¦ä¸²ï¼Œç”¨è‡ªå®šä¹‰å¤„ç†å™¨
}
```

### 7.5 é…ç½®éªŒè¯ä¸è°ƒè¯•


**éªŒè¯å¤„ç†å™¨æ˜¯å¦ç”Ÿæ•ˆ**ï¼š
```java
@SpringBootTest
public class TypeHandlerTest {
    
    @Autowired
    private UserMapper userMapper;
    
    @Test
    public void testTypeHandler() {
        // 1. æ’å…¥æ•°æ®
        User user = new User();
        user.setExtraInfo(Map.of("age", 18, "city", "åŒ—äº¬"));
        userMapper.insert(user);
        
        // 2. æŸ¥è¯¢éªŒè¯
        User result = userMapper.selectById(user.getId());
        
        // 3. æ£€æŸ¥ç±»å‹è½¬æ¢
        assert result.getExtraInfo() instanceof Map;
        assert result.getExtraInfo().get("age").equals(18);
    }
}
```

**å¼€å¯æ—¥å¿—è°ƒè¯•**ï¼š
```yaml
logging:
  level:
    # æŸ¥çœ‹SQLå’Œå‚æ•°ç»‘å®š
    com.example.mapper: debug
    # æŸ¥çœ‹MyBatisè¯¦ç»†æ—¥å¿—
    org.apache.ibatis: debug
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ TypeHandleræœ¬è´¨ï¼šJavaç±»å‹ä¸æ•°æ®åº“ç±»å‹çš„è½¬æ¢æ¡¥æ¢
ğŸ”¸ æ ¸å¿ƒæ¥å£ï¼šBaseTypeHandlerï¼ˆæ¨èï¼‰vs TypeHandler
ğŸ”¸ å››ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š1ä¸ªset + 3ä¸ªget
ğŸ”¸ å¸¸è§åœºæ™¯ï¼šJSONã€æšä¸¾ã€åŠ å¯†ã€æ—¥æœŸè½¬æ¢
ğŸ”¸ æ³¨å†Œæ–¹å¼ï¼šå­—æ®µæ³¨è§£ > ç±»æ³¨è§£ > é…ç½®æ–‡ä»¶
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦TypeHandler**
```
åœºæ™¯åˆ¤æ–­ï¼š
âœ… æ•°æ®åº“ç±»å‹æ— æ³•ç›´æ¥å¯¹åº”Javaç±»å‹
âœ… éœ€è¦åŠ å¯†/è§£å¯†å­˜å‚¨
âœ… JSONæ ¼å¼å­˜å‚¨å¤æ‚å¯¹è±¡
âœ… è‡ªå®šä¹‰æ•°æ®æ ¼å¼è½¬æ¢

ä¸éœ€è¦çš„æƒ…å†µï¼š
âŒ åŸºæœ¬ç±»å‹ï¼ˆStringã€Integerç­‰ï¼‰- MyBatiså·²å¤„ç†
âŒ ç®€å•å®ä½“æ˜ å°„ - è‡ªåŠ¨å¯¹åº”
```

**ğŸ”¹ ç»§æ‰¿BaseTypeHandlerçš„å¥½å¤„**
```
ä¼˜åŠ¿ï¼š
â€¢ è‡ªåŠ¨å¤„ç†nullå€¼ï¼Œå‡å°‘ä»£ç 
â€¢ ç»Ÿä¸€å¼‚å¸¸å¤„ç†
â€¢ ä»£ç æ›´ç®€æ´æ¸…æ™°

å¯¹æ¯”ï¼š
TypeHandlerï¼šéœ€è¦æ‰‹åŠ¨åˆ¤æ–­null
BaseTypeHandlerï¼šä¸“æ³¨ä¸šåŠ¡é€»è¾‘å³å¯
```

**ğŸ”¹ æ³¨å†Œæ–¹å¼é€‰æ‹©ç­–ç•¥**
```
å­—æ®µæ³¨è§£ï¼šå•ä¸ªå­—æ®µç‰¹æ®Šå¤„ç†
@TableField(typeHandler = XXX.class)

ç±»æ³¨è§£ï¼šæŸç§ç±»å‹ç»Ÿä¸€å¤„ç†  
@MappedTypes + @MappedJdbcTypes

åŒ…æ‰«æï¼šå¤šä¸ªå¤„ç†å™¨æ‰¹é‡æ³¨å†Œ
type-handlers-packageé…ç½®
```

### 8.3 å®æˆ˜åº”ç”¨æŒ‡å—


**å¸¸è§åº”ç”¨åœºæ™¯**ï¼š

| åœºæ™¯ | **å¤„ç†å™¨** | **ç”¨é€”** |
|------|-----------|---------|
| ğŸ” **æ•æ„Ÿä¿¡æ¯** | `EncryptTypeHandler` | æ‰‹æœºå·ã€èº«ä»½è¯åŠ å¯† |
| ğŸ“¦ **JSONå­˜å‚¨** | `JsonTypeHandler` | Mapã€Listç­‰å¤æ‚å¯¹è±¡ |
| ğŸ·ï¸ **æšä¸¾æ˜ å°„** | `EnumTypeHandler` | çŠ¶æ€ã€ç­‰çº§ç­‰æšä¸¾ |
| ğŸ“… **æ—¥æœŸå¤„ç†** | `DateTypeHandler` | æ—¶é—´æˆ³ä¸æ—¥æœŸäº’è½¬ |
| ğŸŒ **IPåœ°å€** | `IpTypeHandler` | IPå­—ç¬¦ä¸²ä¸æ•°å­—è½¬æ¢ |

**å¼€å‘æµç¨‹**ï¼š
```
1. åˆ†æéœ€æ±‚ â†’ ç¡®å®šJavaç±»å‹å’Œæ•°æ®åº“ç±»å‹
2. é€‰æ‹©åŸºç±» â†’ é€šå¸¸ç»§æ‰¿BaseTypeHandler
3. å®ç°æ–¹æ³• â†’ 4ä¸ªæ ¸å¿ƒæ–¹æ³•
4. å¼‚å¸¸å¤„ç† â†’ å®Œå–„é”™è¯¯å¤„ç†é€»è¾‘
5. æ³¨å†Œé…ç½® â†’ é€‰æ‹©åˆé€‚çš„æ³¨å†Œæ–¹å¼
6. æµ‹è¯•éªŒè¯ â†’ å•å…ƒæµ‹è¯•ç¡®ä¿æ­£ç¡®æ€§
```

### 8.4 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**ï¼š
- ä¼˜å…ˆä½¿ç”¨BaseTypeHandler
- åšå¥½nullå€¼å¤„ç†
- æå–å…¬å…±è½¬æ¢é€»è¾‘
- å®Œå–„å¼‚å¸¸ä¿¡æ¯
- æ·»åŠ è¯¦ç»†æ³¨é‡Š

**âŒ å¸¸è§é”™è¯¯**ï¼š
- å¿˜è®°å¤„ç†nullå¯¼è‡´NPE
- å¼‚å¸¸å¤„ç†ä¸å½“åæ‰é”™è¯¯
- é‡å¤ä»£ç æœªå¤ç”¨
- è½¬æ¢é€»è¾‘è¿‡äºå¤æ‚

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–**ï¼š
- é¿å…åœ¨TypeHandlerä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- å¤æ‚è½¬æ¢è€ƒè™‘ç¼“å­˜ç»“æœ
- åˆç†é€‰æ‹©æ•°æ®åº“ç±»å‹ï¼ˆå¦‚IPå­˜æ•°å­—ï¼‰

**æ ¸å¿ƒè®°å¿†**ï¼š
> TypeHandler = Javaå¯¹è±¡ â†” æ•°æ®åº“å­—æ®µçš„è‡ªåŠ¨è½¬æ¢å™¨
> 
> å››ä¸ªæ–¹æ³•è®°ä½ï¼š1ä¸ªå­˜ï¼ˆsetï¼‰+ 3ä¸ªå–ï¼ˆgetï¼‰
> 
> å¸¸ç”¨åœºæ™¯ï¼šJSONã€æšä¸¾ã€åŠ å¯†ã€ç‰¹æ®Šæ ¼å¼
> 
> æ³¨å†Œæ–¹å¼ï¼šå­—æ®µ > ç±» > é…ç½®ï¼ŒæŒ‰éœ€é€‰æ‹©