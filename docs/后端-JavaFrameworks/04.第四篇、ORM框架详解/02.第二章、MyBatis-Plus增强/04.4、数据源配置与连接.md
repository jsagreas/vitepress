---
title: 4ã€æ•°æ®æºé…ç½®ä¸è¿æ¥
---
## ğŸ“š ç›®å½•

1. [æ•°æ®æºé…ç½®åŸºç¡€æ¦‚å¿µ](#1-æ•°æ®æºé…ç½®åŸºç¡€æ¦‚å¿µ)
2. [application.ymlæ ¸å¿ƒé…ç½®](#2-applicationymlæ ¸å¿ƒé…ç½®)
3. [æ•°æ®åº“è¿æ¥å‚æ•°è¯¦è§£](#3-æ•°æ®åº“è¿æ¥å‚æ•°è¯¦è§£)
4. [è¿æ¥æ± é…ç½®ä¼˜åŒ–](#4-è¿æ¥æ± é…ç½®ä¼˜åŒ–)
5. [å¤šç¯å¢ƒé…ç½®ç®¡ç†](#5-å¤šç¯å¢ƒé…ç½®ç®¡ç†)
6. [è¿æ¥æµ‹è¯•ä¸éªŒè¯](#6-è¿æ¥æµ‹è¯•ä¸éªŒè¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ æ•°æ®æºé…ç½®åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®æº


**é€šä¿—ç†è§£**ï¼šæ•°æ®æºå°±åƒæ˜¯ä½ çš„åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ä¹‹é—´çš„"æ¡¥æ¢"æˆ–"é€šé“"

```
åº”ç”¨ç¨‹åºæƒ³è¦æ“ä½œæ•°æ®åº“ï¼š

æ²¡æœ‰æ•°æ®æºï¼ˆæ¯æ¬¡éƒ½å»ºç«‹æ–°è¿æ¥ï¼‰ï¼š
åº”ç”¨ --[å»ºç«‹è¿æ¥]--> æ•°æ®åº“
åº”ç”¨ --[ä½¿ç”¨å®Œæ¯•]--> æ–­å¼€è¿æ¥
åº”ç”¨ --[å†æ¬¡éœ€è¦]--> é‡æ–°å»ºç«‹è¿æ¥  âŒ æ•ˆç‡ä½ä¸‹ï¼

ä½¿ç”¨æ•°æ®æºï¼ˆè¿æ¥æ± ç®¡ç†ï¼‰ï¼š
åº”ç”¨ --[è·å–è¿æ¥]--> è¿æ¥æ±  --[å·²æœ‰è¿æ¥]--> æ•°æ®åº“
åº”ç”¨ --[ç”¨å®Œå½’è¿˜]--> è¿æ¥æ± ï¼ˆè¿æ¥ä¿æŒï¼‰
åº”ç”¨ --[å†æ¬¡éœ€è¦]--> è¿æ¥æ±  âœ… é«˜æ•ˆå¤ç”¨ï¼
```

**ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µ**
- **æ•°æ®æºï¼ˆDataSourceï¼‰**ï¼šç®¡ç†æ•°æ®åº“è¿æ¥çš„ç»„ä»¶ï¼Œè´Ÿè´£åˆ›å»ºã€åˆ†é…ã€å›æ”¶æ•°æ®åº“è¿æ¥
- **è¿æ¥æ± ï¼ˆConnection Poolï¼‰**ï¼šé¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼Œæ”¾åœ¨"æ± å­"é‡Œä¾›åº”ç”¨ç¨‹åºä½¿ç”¨
- **é…ç½®æ–‡ä»¶**ï¼šå‘Šè¯‰åº”ç”¨ç¨‹åº"æ•°æ®åº“åœ¨å“ªã€æ€ä¹ˆè¿ã€è¿å¤šå°‘ä¸ª"çš„è¯´æ˜ä¹¦

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®æ•°æ®æº


**ğŸ¯ æ ¸å¿ƒä»·å€¼**

```
é—®é¢˜åœºæ™¯ï¼šå‡è®¾ä½ çš„ç½‘ç«™æœ‰1000ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®

æ–¹æ¡ˆ1ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½æ–°å»ºè¿æ¥
- ç”¨æˆ·AæŸ¥è¯¢ â†’ å»ºç«‹è¿æ¥ â†’ æŸ¥è¯¢ â†’ æ–­å¼€è¿æ¥ï¼ˆè€—æ—¶100msï¼‰
- ç”¨æˆ·BæŸ¥è¯¢ â†’ å»ºç«‹è¿æ¥ â†’ æŸ¥è¯¢ â†’ æ–­å¼€è¿æ¥ï¼ˆè€—æ—¶100msï¼‰
- ...1000æ¬¡é‡å¤æ“ä½œ
ç»“æœï¼šç³»ç»Ÿå“åº”æ…¢ï¼Œæ•°æ®åº“å‹åŠ›å¤§ âŒ

æ–¹æ¡ˆ2ï¼šä½¿ç”¨è¿æ¥æ± 
- é¢„å…ˆåˆ›å»º20ä¸ªè¿æ¥æ”¾åœ¨æ± å­é‡Œ
- ç”¨æˆ·AæŸ¥è¯¢ â†’ ä»æ± ä¸­å–å‡ºè¿æ¥ â†’ æŸ¥è¯¢ â†’ å½’è¿˜è¿æ¥ï¼ˆè€—æ—¶10msï¼‰
- ç”¨æˆ·BæŸ¥è¯¢ â†’ ä»æ± ä¸­å–å‡ºè¿æ¥ â†’ æŸ¥è¯¢ â†’ å½’è¿˜è¿æ¥ï¼ˆè€—æ—¶10msï¼‰
- è¿æ¥å¤ç”¨ï¼Œæ— éœ€é‡å¤å»ºç«‹
ç»“æœï¼šå“åº”å¿«ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ âœ…
```

**ğŸ’¡ é…ç½®æ•°æ®æºçš„å¥½å¤„**
- âš¡ **æ€§èƒ½æå‡**ï¼šå¤ç”¨è¿æ¥ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯
- ğŸ›¡ï¸ **èµ„æºæ§åˆ¶**ï¼šé™åˆ¶è¿æ¥æ•°é‡ï¼Œé˜²æ­¢æ•°æ®åº“è¿‡è½½
- ğŸ”§ **çµæ´»ç®¡ç†**ï¼šç»Ÿä¸€é…ç½®ï¼Œä¾¿äºç»´æŠ¤å’Œè°ƒä¼˜
- ğŸ”„ **è‡ªåŠ¨æ¢å¤**ï¼šè¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨é‡è¿

---

## 2. âš™ï¸ application.ymlæ ¸å¿ƒé…ç½®


### 2.1 é…ç½®æ–‡ä»¶çš„ä½œç”¨


**ğŸ“ ä»€ä¹ˆæ˜¯application.yml**

application.ymlæ˜¯SpringBooté¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œç”¨äººè¯è¯´å°±æ˜¯ï¼š**å‘Šè¯‰ç¨‹åºå„ç§è®¾ç½®çš„"è¯´æ˜ä¹¦"**

```
é…ç½®æ–‡ä»¶ä½ç½®ï¼š
é¡¹ç›®æ ¹ç›®å½•
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ resources
            â””â”€â”€ application.yml  â† å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼
```

### 2.2 åŸºç¡€æ•°æ®æºé…ç½®


**ğŸ”¸ æœ€ç®€å•çš„é…ç½®ç¤ºä¾‹**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: 123456
```

**ğŸ“– é€è¡Œè§£é‡Š**

| é…ç½®é¡¹ | é€šä¿—è§£é‡Š | è¯¦ç»†è¯´æ˜ |
|--------|----------|----------|
| `driver-class-name` | æ•°æ®åº“é©±åŠ¨ç¨‹åº | å‘Šè¯‰Javaç”¨ä»€ä¹ˆ"ç¿»è¯‘å™¨"å’ŒMySQLè¯´è¯ |
| `url` | æ•°æ®åº“åœ°å€ | æ•°æ®åº“åœ¨å“ªå°æœåŠ¡å™¨ã€å“ªä¸ªç«¯å£ã€å“ªä¸ªåº“ |
| `username` | ç”¨æˆ·å | ç™»å½•æ•°æ®åº“çš„è´¦å· |
| `password` | å¯†ç  | ç™»å½•æ•°æ®åº“çš„å¯†ç  |

**ğŸ” URLåœ°å€è¯¦è§£**

```
jdbc:mysql://localhost:3306/mydb?å‚æ•°1=å€¼1&å‚æ•°2=å€¼2
  â†‘      â†‘       â†‘       â†‘    â†‘           â†‘
åè®®   æ•°æ®åº“ç±»å‹  æœåŠ¡å™¨   ç«¯å£  æ•°æ®åº“å   å¯é€‰å‚æ•°

å®é™…æ¡ˆä¾‹ï¼š
jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf8

- localhostï¼šæ•°æ®åº“åœ¨æœ¬æœºï¼ˆä¹Ÿå¯ä»¥å†™127.0.0.1æˆ–æœåŠ¡å™¨IPï¼‰
- 3306ï¼šMySQLé»˜è®¤ç«¯å£ï¼ˆå°±åƒHTTPçš„80ç«¯å£ï¼‰
- mydbï¼šä½ çš„æ•°æ®åº“åç§°
- å‚æ•°ï¼šé¢å¤–çš„è®¾ç½®ï¼ˆç¼–ç ã€æ—¶åŒºç­‰ï¼‰
```

### 2.3 å®Œæ•´çš„æ¨èé…ç½®


```yaml
spring:
  datasource:
    # åŸºç¡€è¿æ¥ä¿¡æ¯
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
    
    # æ•°æ®åº“ç±»å‹ï¼ˆMyBatis-Plusè‡ªåŠ¨è¯†åˆ«æ–¹è¨€ï¼‰
    type: com.zaxxer.hikari.HikariDataSource

# MyBatis-Plusé…ç½®
mybatis-plus:
  # å®ä½“ç±»æ‰€åœ¨åŒ…
  type-aliases-package: com.example.entity
  # XMLæ–‡ä»¶ä½ç½®
  mapper-locations: classpath:mapper/*.xml
  configuration:
    # å¼€å¯é©¼å³°å‘½åè½¬æ¢
    map-underscore-to-camel-case: true
    # æ—¥å¿—è¾“å‡ºï¼ˆå¼€å‘æ—¶å¯ä»¥çœ‹åˆ°SQLï¼‰
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

**ğŸ’¡ é…ç½®è¯´æ˜**

**URLä¸­çš„å¸¸ç”¨å‚æ•°**ï¼š
- `useUnicode=true`ï¼šæ”¯æŒä¸­æ–‡ç­‰Unicodeå­—ç¬¦
- `characterEncoding=utf8`ï¼šæŒ‡å®šå­—ç¬¦ç¼–ç ä¸ºUTF-8
- `useSSL=false`ï¼šå…³é—­SSLï¼ˆæœ¬åœ°å¼€å‘ç”¨ï¼‰
- `serverTimezone=Asia/Shanghai`ï¼šè®¾ç½®æ—¶åŒºä¸ºä¸­å›½

**MyBatis-Plusé…ç½®**ï¼š
- `type-aliases-package`ï¼šå‘Šè¯‰æ¡†æ¶ä½ çš„å®ä½“ç±»åœ¨å“ªä¸ªåŒ…é‡Œ
- `map-underscore-to-camel-case`ï¼šæ•°æ®åº“å­—æ®µ`user_name`è‡ªåŠ¨æ˜ å°„ä¸ºJavaå±æ€§`userName`

---

## 3. ğŸ”— æ•°æ®åº“è¿æ¥å‚æ•°è¯¦è§£


### 3.1 å¿…éœ€çš„æ ¸å¿ƒå‚æ•°


**ğŸ“‹ å››å¤§æ ¸å¿ƒå‚æ•°**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver  # é©±åŠ¨
    url: jdbc:mysql://localhost:3306/mydb        # åœ°å€
    username: root                                # è´¦å·
    password: 123456                              # å¯†ç 
```

**ğŸ”¸ å‚æ•°è¯¦è§£**

**1. driver-class-nameï¼ˆæ•°æ®åº“é©±åŠ¨ï¼‰**

```
ä½œç”¨ï¼šå‘Šè¯‰ç¨‹åºç”¨ä»€ä¹ˆé©±åŠ¨è¿æ¥æ•°æ®åº“
ç±»æ¯”ï¼šä¸åŒå“ç‰Œæ±½è½¦éœ€è¦ä¸åŒçš„é’¥åŒ™

å¸¸è§é©±åŠ¨ï¼š
MySQL 5.x:  com.mysql.jdbc.Driver
MySQL 8.x:  com.mysql.cj.jdbc.Driver  â† æ¨èä½¿ç”¨
Oracle:     oracle.jdbc.OracleDriver
PostgreSQL: org.postgresql.Driver
```

**2. urlï¼ˆæ•°æ®åº“è¿æ¥åœ°å€ï¼‰**

```
å®Œæ•´æ ¼å¼ï¼š
jdbc:mysql://[ä¸»æœº]:[ç«¯å£]/[æ•°æ®åº“å]?[å‚æ•°]

ç¤ºä¾‹è§£æï¼š
jdbc:mysql://192.168.1.100:3306/shop?useSSL=false
          â†‘                â†‘    â†‘         â†‘
      æœåŠ¡å™¨IPåœ°å€        ç«¯å£  åº“å    å¯é€‰å‚æ•°

æœ¬åœ°å¼€å‘å¸¸ç”¨ï¼š
jdbc:mysql://localhost:3306/mydb
jdbc:mysql://127.0.0.1:3306/mydb
```

### 3.2 å¸¸ç”¨çš„URLå‚æ•°


**âš™ï¸ é‡è¦å‚æ•°è¯´æ˜**

| å‚æ•°å | ä½œç”¨ | æ¨èå€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `useUnicode` | æ˜¯å¦ä½¿ç”¨Unicodeç¼–ç  | `true` | æ”¯æŒä¸­æ–‡å¿…å¤‡ |
| `characterEncoding` | å­—ç¬¦ç¼–ç  | `utf8` æˆ– `utf8mb4` | utf8mb4æ”¯æŒemoji |
| `useSSL` | æ˜¯å¦ä½¿ç”¨SSLåŠ å¯† | `false`ï¼ˆå¼€å‘ï¼‰<br>`true`ï¼ˆç”Ÿäº§ï¼‰ | æœ¬åœ°å¼€å‘å¯å…³é—­ |
| `serverTimezone` | æœåŠ¡å™¨æ—¶åŒº | `Asia/Shanghai` | è§£å†³æ—¶åŒºé—®é¢˜ |
| `allowPublicKeyRetrieval` | å…è®¸è·å–å…¬é’¥ | `true` | MySQL 8.0éœ€è¦ |
| `rewriteBatchedStatements` | æ‰¹é‡æ“ä½œä¼˜åŒ– | `true` | æå‡æ‰¹é‡æ’å…¥æ€§èƒ½ |

**ğŸ’¡ å®é™…é…ç½®ç¤ºä¾‹**

```yaml
# å¼€å‘ç¯å¢ƒé…ç½®
url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai

# ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆæ›´å®‰å…¨ï¼‰
url: jdbc:mysql://db.example.com:3306/mydb?useUnicode=true&characterEncoding=utf8mb4&useSSL=true&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
```

### 3.3 è¿æ¥å‚æ•°çš„æ€§èƒ½ä¼˜åŒ–


**ğŸš€ æ€§èƒ½ç›¸å…³å‚æ•°**

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb?
         useUnicode=true&
         characterEncoding=utf8&
         useSSL=false&
         serverTimezone=Asia/Shanghai&
         # ä»¥ä¸‹ä¸ºæ€§èƒ½ä¼˜åŒ–å‚æ•°
         cachePrepStmts=true&              # å¼€å¯é¢„ç¼–è¯‘ç¼“å­˜
         prepStmtCacheSize=250&            # ç¼“å­˜å¤§å°
         prepStmtCacheSqlLimit=2048&       # ç¼“å­˜SQLé•¿åº¦
         useServerPrepStmts=true&          # ä½¿ç”¨æœåŠ¡å™¨ç«¯é¢„ç¼–è¯‘
         rewriteBatchedStatements=true     # æ‰¹é‡æ“ä½œä¼˜åŒ–
```

---

## 4. ğŸŠ è¿æ¥æ± é…ç½®ä¼˜åŒ–


### 4.1 ä»€ä¹ˆæ˜¯è¿æ¥æ± 


**ğŸ”¸ è¿æ¥æ± çš„é€šä¿—ç†è§£**

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š

æ²¡æœ‰è¿æ¥æ± ï¼ˆæ¯æ¬¡å€Ÿè¿˜è‡ªè¡Œè½¦ï¼‰ï¼š
ä½ ï¼šæˆ‘è¦ç”¨è‡ªè¡Œè½¦ â†’ å•†å®¶ï¼šç°åœºç»„è£…ä¸€è¾† â†’ ä½ ï¼šç”¨å®Œ â†’ å•†å®¶ï¼šæ‹†æ‰ âŒ

ä½¿ç”¨è¿æ¥æ± ï¼ˆå…±äº«å•è½¦æ¨¡å¼ï¼‰ï¼š
å•†å®¶ï¼šæå‰å‡†å¤‡10è¾†è‡ªè¡Œè½¦
ä½ ï¼šæ‰«ç å–è½¦ â†’ éª‘è¡Œ â†’ è¿˜è½¦åˆ°æŒ‡å®šä½ç½®
ä¸‹ä¸€ä¸ªäººï¼šç›´æ¥å–è½¦ä½¿ç”¨ âœ…

è¿æ¥æ± å°±æ˜¯æå‰å‡†å¤‡å¥½ä¸€æ‰¹æ•°æ®åº“è¿æ¥ï¼Œéœ€è¦æ—¶å°±å–ï¼Œç”¨å®Œå°±è¿˜
```

**ğŸ“Š è¿æ¥æ± å·¥ä½œæµç¨‹**

```
è¿æ¥æ± ï¼ˆå®¹é‡ï¼šæœ€å°5ä¸ªï¼Œæœ€å¤§20ä¸ªï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¿æ¥1] [è¿æ¥2] [è¿æ¥3] [è¿æ¥4] â”‚  â† ç©ºé—²è¿æ¥ï¼ˆç­‰å¾…ä½¿ç”¨ï¼‰
â”‚ [è¿æ¥5] [è¿æ¥6-ä½¿ç”¨ä¸­] [è¿æ¥7]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘              â†“
      è·å–è¿æ¥        å½’è¿˜è¿æ¥
         â†‘              â†“
    [åº”ç”¨ç¨‹åºçº¿ç¨‹]
```

### 4.2 HikariCPè¿æ¥æ± é…ç½®


**ğŸŒŠ HikariCPç®€ä»‹**

HikariCPæ˜¯ç›®å‰æœ€å¿«çš„Javaè¿æ¥æ± ï¼ŒSpringBooté»˜è®¤ä½¿ç”¨å®ƒã€‚Hikariåœ¨æ—¥è¯­ä¸­æ˜¯"å…‰"çš„æ„æ€ï¼Œå¯“æ„å¿«å¦‚å…‰é€Ÿï¼

**åŸºç¡€é…ç½®**

```yaml
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      # è¿æ¥æ± åç§°
      pool-name: MyHikariCP
      # æœ€å°ç©ºé—²è¿æ¥æ•°
      minimum-idle: 5
      # æœ€å¤§è¿æ¥æ•°
      maximum-pool-size: 20
      # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      connection-timeout: 30000
      # ç©ºé—²è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
      idle-timeout: 600000
      # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆæ¯«ç§’ï¼‰
      max-lifetime: 1800000
```

**ğŸ“– å‚æ•°è¯¦è§£**

| å‚æ•° | é€šä¿—è§£é‡Š | æ¨èå€¼ | è¯¦ç»†è¯´æ˜ |
|------|----------|--------|----------|
| `minimum-idle` | æœ€å°‘ä¿ç•™å‡ ä¸ªç©ºé—²è¿æ¥ | `5-10` | å°±åƒåœè½¦åœºè‡³å°‘ä¿ç•™å‡ ä¸ªç©ºä½ |
| `maximum-pool-size` | è¿æ¥æ± æœ€å¤šæœ‰å‡ ä¸ªè¿æ¥ | `20-50` | æ ¹æ®å¹¶å‘é‡å†³å®šï¼Œä¸æ˜¯è¶Šå¤§è¶Šå¥½ |
| `connection-timeout` | ç­‰å¾…è¿æ¥çš„æœ€é•¿æ—¶é—´ | `30000`ï¼ˆ30ç§’ï¼‰ | è¶…æ—¶å°±æ”¾å¼ƒï¼Œé¿å…æ— é™ç­‰å¾… |
| `idle-timeout` | ç©ºé—²è¿æ¥å¤šä¹…è¢«å›æ”¶ | `600000`ï¼ˆ10åˆ†é’Ÿï¼‰ | é—²ç½®å¤ªä¹…çš„è¿æ¥ä¼šè¢«æ¸…ç† |
| `max-lifetime` | è¿æ¥æœ€é•¿å­˜æ´»æ—¶é—´ | `1800000`ï¼ˆ30åˆ†é’Ÿï¼‰ | å®šæœŸæ›´æ¢è¿æ¥ï¼Œé¿å…é•¿è¿æ¥é—®é¢˜ |

### 4.3 è¿æ¥æ± å‚æ•°è°ƒä¼˜


**ğŸ¯ ä¸åŒåœºæ™¯çš„é…ç½®å»ºè®®**

**åœºæ™¯1ï¼šä¸ªäººå°é¡¹ç›®ï¼ˆè®¿é—®é‡å°ï¼‰**

```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 2          # æœ€å°‘2ä¸ªç©ºé—²è¿æ¥
      maximum-pool-size: 10    # æœ€å¤š10ä¸ªè¿æ¥
      connection-timeout: 20000
```

**åœºæ™¯2ï¼šä¸­å‹ä¼ä¸šåº”ç”¨ï¼ˆæ­£å¸¸è®¿é—®ï¼‰**

```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 10         # ä¿æŒ10ä¸ªç©ºé—²
      maximum-pool-size: 50    # æœ€å¤š50ä¸ªè¿æ¥
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

**åœºæ™¯3ï¼šé«˜å¹¶å‘åº”ç”¨ï¼ˆå¤§æµé‡ï¼‰**

```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 20         # ä¿æŒ20ä¸ªç©ºé—²
      maximum-pool-size: 100   # æœ€å¤š100ä¸ªè¿æ¥
      connection-timeout: 30000
      idle-timeout: 300000     # 5åˆ†é’Ÿå›æ”¶ç©ºé—²
      max-lifetime: 1200000    # 20åˆ†é’Ÿæ›´æ–°è¿æ¥
```

**ğŸ’¡ è°ƒä¼˜å»ºè®®**

```
è¿æ¥æ•°è®¾ç½®åŸåˆ™ï¼š

æœ€å¤§è¿æ¥æ•° = (CPUæ ¸å¿ƒæ•° Ã— 2) + ç£ç›˜æ•°

ä¾‹å¦‚ï¼š
4æ ¸CPU + 1å—ç¡¬ç›˜ â†’ æœ€å¤§è¿æ¥æ•° = 4Ã—2+1 = 9

å®é™…å»ºè®®ï¼š
- æœ€å°ç©ºé—² = æœ€å¤§è¿æ¥æ•° Ã— 20%
- æœ€å¤§è¿æ¥æ•°ä¸è¦è¶…è¿‡æ•°æ®åº“æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°
- MySQLé»˜è®¤æœ€å¤§è¿æ¥æ•°é€šå¸¸æ˜¯151
```

---

## 5. ğŸŒ å¤šç¯å¢ƒé…ç½®ç®¡ç†


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šç¯å¢ƒé…ç½®


**ğŸ”¸ å®é™…å¼€å‘åœºæ™¯**

```
å¼€å‘æµç¨‹ä¸­çš„ä¸åŒç¯å¢ƒï¼š

å¼€å‘ç¯å¢ƒï¼ˆdevï¼‰ï¼šç¨‹åºå‘˜è‡ªå·±ç”µè„‘
- æ•°æ®åº“ï¼šlocalhost:3306
- æ•°æ®ï¼šæµ‹è¯•æ•°æ®ï¼Œå¯ä»¥éšä¾¿æ”¹

æµ‹è¯•ç¯å¢ƒï¼ˆtestï¼‰ï¼šæµ‹è¯•æœåŠ¡å™¨
- æ•°æ®åº“ï¼štest-db.company.com:3306
- æ•°æ®ï¼šæ¨¡æ‹ŸçœŸå®æ•°æ®

ç”Ÿäº§ç¯å¢ƒï¼ˆprodï¼‰ï¼šæ­£å¼æœåŠ¡å™¨
- æ•°æ®åº“ï¼šprod-db.company.com:3306
- æ•°æ®ï¼šçœŸå®ç”¨æˆ·æ•°æ®ï¼Œä¸èƒ½ä¹±åŠ¨ï¼
```

**ğŸ’¡ ä¸åŒç¯å¢ƒçš„å·®å¼‚**

| ç¯å¢ƒ | æ•°æ®åº“åœ°å€ | æ—¥å¿—çº§åˆ« | è¿æ¥æ± å¤§å° | ç¼“å­˜ |
|------|-----------|----------|-----------|------|
| å¼€å‘ï¼ˆdevï¼‰ | localhost | DEBUGï¼ˆè¯¦ç»†ï¼‰ | å°ï¼ˆ5-10ï¼‰ | å…³é—­ |
| æµ‹è¯•ï¼ˆtestï¼‰ | æµ‹è¯•æœåŠ¡å™¨ | INFOï¼ˆä¸€èˆ¬ï¼‰ | ä¸­ï¼ˆ10-20ï¼‰ | å¼€å¯ |
| ç”Ÿäº§ï¼ˆprodï¼‰ | ç”Ÿäº§æœåŠ¡å™¨ | WARNï¼ˆè­¦å‘Šï¼‰ | å¤§ï¼ˆ20-50ï¼‰ | å¼€å¯ |

### 5.2 å¤šç¯å¢ƒé…ç½®å®ç°


**ğŸ“ é…ç½®æ–‡ä»¶ç»“æ„**

```
resources/
â”œâ”€â”€ application.yml              # ä¸»é…ç½®ï¼ˆå…¬å…±é…ç½®ï¼‰
â”œâ”€â”€ application-dev.yml          # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ application-test.yml         # æµ‹è¯•ç¯å¢ƒ
â””â”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒ
```

**ğŸ”¸ ä¸»é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰**

```yaml
spring:
  profiles:
    active: dev  # æ¿€æ´»å“ªä¸ªç¯å¢ƒï¼ˆdev/test/prodï¼‰

# å…¬å…±é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒéƒ½ç”¨ï¼‰
mybatis-plus:
  type-aliases-package: com.example.entity
  mapper-locations: classpath:mapper/*.xml
```

**ğŸ”¸ å¼€å‘ç¯å¢ƒï¼ˆapplication-dev.ymlï¼‰**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydb_dev?useUnicode=true&characterEncoding=utf8&useSSL=false
    username: root
    password: 123456
    hikari:
      minimum-idle: 5
      maximum-pool-size: 10

mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # å¼€å‘æ—¶æ‰“å°SQL
```

**ğŸ”¸ æµ‹è¯•ç¯å¢ƒï¼ˆapplication-test.ymlï¼‰**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://test-db.company.com:3306/mydb_test?useUnicode=true&characterEncoding=utf8
    username: test_user
    password: test_pass
    hikari:
      minimum-idle: 10
      maximum-pool-size: 20
```

**ğŸ”¸ ç”Ÿäº§ç¯å¢ƒï¼ˆapplication-prod.ymlï¼‰**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://prod-db.company.com:3306/mydb_prod?useUnicode=true&characterEncoding=utf8&useSSL=true
    username: ${DB_USERNAME}  # ä»ç¯å¢ƒå˜é‡è¯»å–
    password: ${DB_PASSWORD}
    hikari:
      minimum-idle: 20
      maximum-pool-size: 50
      connection-timeout: 30000

mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl  # ç”Ÿäº§ä¸æ‰“å°SQL
```

### 5.3 ç¯å¢ƒåˆ‡æ¢æ–¹å¼


**ğŸ”§ åˆ‡æ¢æ–¹æ³•**

**æ–¹æ³•1ï¼šä¿®æ”¹application.yml**

```yaml
spring:
  profiles:
    active: prod  # æ”¹æˆprodå°±ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®
```

**æ–¹æ³•2ï¼šå¯åŠ¨æ—¶æŒ‡å®š**

```bash
# æ–¹å¼1ï¼šå‘½ä»¤è¡Œå‚æ•°
java -jar myapp.jar --spring.profiles.active=prod

# æ–¹å¼2ï¼šç¯å¢ƒå˜é‡
export SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar

# æ–¹å¼3ï¼šIDEAè¿è¡Œé…ç½®
åœ¨Run/Debug Configurationsä¸­è®¾ç½®ï¼š
Active profiles: prod
```

**æ–¹æ³•3ï¼šæ‰“åŒ…æ—¶æŒ‡å®šï¼ˆMavenï¼‰**

```xml
<!-- pom.xmlä¸­é…ç½® -->
<profiles>
    <profile>
        <id>dev</id>
        <properties>
            <spring.profiles.active>dev</spring.profiles.active>
        </properties>
    </profile>
    <profile>
        <id>prod</id>
        <properties>
            <spring.profiles.active>prod</spring.profiles.active>
        </properties>
    </profile>
</profiles>

<!-- æ‰“åŒ…å‘½ä»¤ -->
mvn clean package -P prod
```

---

## 6. âœ… è¿æ¥æµ‹è¯•ä¸éªŒè¯


### 6.1 ç¼–å†™æµ‹è¯•ç±»éªŒè¯è¿æ¥


**ğŸ§ª æµ‹è¯•ä»£ç ç¤ºä¾‹**

```java
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import javax.sql.DataSource;
import java.sql.Connection;

@SpringBootTest
public class DataSourceTest {
    
    @Autowired
    private DataSource dataSource;
    
    @Test
    public void testConnection() throws Exception {
        // è·å–è¿æ¥
        Connection connection = dataSource.getConnection();
        
        // è¾“å‡ºè¿æ¥ä¿¡æ¯
        System.out.println("æ•°æ®æºç±»å‹ï¼š" + dataSource.getClass().getName());
        System.out.println("æ•°æ®åº“è¿æ¥ï¼š" + connection);
        System.out.println("è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼š" + !connection.isClosed());
        
        // å…³é—­è¿æ¥
        connection.close();
    }
}
```

**ğŸ“‹ æµ‹è¯•ç»“æœç¤ºä¾‹**

```
æ•°æ®æºç±»å‹ï¼šcom.zaxxer.hikari.HikariDataSource
æ•°æ®åº“è¿æ¥ï¼šHikariProxyConnection@123456789 wrapping com.mysql.cj.jdbc.ConnectionImpl@987654321
è¿æ¥æ˜¯å¦æœ‰æ•ˆï¼štrue

æµ‹è¯•é€šè¿‡ï¼âœ…
```

### 6.2 å¸¸è§è¿æ¥é—®é¢˜æ’æŸ¥


**âŒ é—®é¢˜1ï¼šé©±åŠ¨æ‰¾ä¸åˆ°**

```
é”™è¯¯ä¿¡æ¯ï¼š
java.lang.ClassNotFoundException: com.mysql.cj.jdbc.Driver

è§£å†³æ–¹æ³•ï¼š
1. æ£€æŸ¥pom.xmlæ˜¯å¦æ·»åŠ MySQLä¾èµ–
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>

2. åˆ·æ–°Mavenä¾èµ–
```

**âŒ é—®é¢˜2ï¼šè¿æ¥è¢«æ‹’ç»**

```
é”™è¯¯ä¿¡æ¯ï¼š
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

å¸¸è§åŸå› ï¼š
1. æ•°æ®åº“æœªå¯åŠ¨
2. IPåœ°å€æˆ–ç«¯å£é”™è¯¯
3. é˜²ç«å¢™æ‹¦æˆª

æ’æŸ¥æ­¥éª¤ï¼š
âœ“ æ£€æŸ¥MySQLæ˜¯å¦å¯åŠ¨ï¼šsystemctl status mysql
âœ“ æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ï¼šnetstat -an | grep 3306
âœ“ å°è¯•å‘½ä»¤è¡Œè¿æ¥ï¼šmysql -h localhost -P 3306 -u root -p
```

**âŒ é—®é¢˜3ï¼šè´¦å·å¯†ç é”™è¯¯**

```
é”™è¯¯ä¿¡æ¯ï¼š
java.sql.SQLException: Access denied for user 'root'@'localhost'

è§£å†³æ–¹æ³•ï¼š
1. ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®
2. æ£€æŸ¥ç”¨æˆ·æƒé™
   mysql> SHOW GRANTS FOR 'root'@'localhost';
3. æˆäºˆæƒé™
   mysql> GRANT ALL PRIVILEGES ON mydb.* TO 'root'@'localhost';
   mysql> FLUSH PRIVILEGES;
```

### 6.3 è¿æ¥æ± çŠ¶æ€ç›‘æ§


**ğŸ“Š æŸ¥çœ‹è¿æ¥æ± ä¿¡æ¯**

```java
import com.zaxxer.hikari.HikariDataSource;
import com.zaxxer.hikari.HikariPoolMXBean;

@Autowired
private DataSource dataSource;

@Test
public void testPoolStatus() {
    HikariDataSource hikariDataSource = (HikariDataSource) dataSource;
    HikariPoolMXBean poolMXBean = hikariDataSource.getHikariPoolMXBean();
    
    System.out.println("æ´»è·ƒè¿æ¥æ•°ï¼š" + poolMXBean.getActiveConnections());
    System.out.println("ç©ºé—²è¿æ¥æ•°ï¼š" + poolMXBean.getIdleConnections());
    System.out.println("æ€»è¿æ¥æ•°ï¼š" + poolMXBean.getTotalConnections());
    System.out.println("ç­‰å¾…çº¿ç¨‹æ•°ï¼š" + poolMXBean.getThreadsAwaitingConnection());
}
```

**ğŸ’¡ å¥åº·æ£€æŸ¥SQL**

```yaml
spring:
  datasource:
    hikari:
      connection-test-query: SELECT 1  # æµ‹è¯•è¿æ¥æ˜¯å¦æœ‰æ•ˆ
      validation-timeout: 3000         # éªŒè¯è¶…æ—¶æ—¶é—´
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®æºï¼šåº”ç”¨ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥ç®¡ç†å™¨
ğŸ”¸ è¿æ¥æ± ï¼šé¢„å…ˆåˆ›å»ºå¹¶å¤ç”¨æ•°æ®åº“è¿æ¥çš„"æ± å­"
ğŸ”¸ é…ç½®æ–‡ä»¶ï¼šapplication.ymlæ˜¯é¡¹ç›®çš„é…ç½®"è¯´æ˜ä¹¦"
ğŸ”¸ å¤šç¯å¢ƒï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®
ğŸ”¸ å‚æ•°ä¼˜åŒ–ï¼šæ ¹æ®å®é™…åœºæ™¯è°ƒæ•´è¿æ¥æ± å‚æ•°
```

### 7.2 é…ç½®æ¸…å•é€ŸæŸ¥


**âš¡ æœ€å°é…ç½®ï¼ˆèƒ½ç”¨ï¼‰**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: 123456
```

**âœ¨ æ¨èé…ç½®ï¼ˆå¥½ç”¨ï¼‰**

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mydb?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
    hikari:
      minimum-idle: 10
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

### 7.3 å®é™…åº”ç”¨è¦ç‚¹


**ğŸ¯ å¼€å‘å»ºè®®**

```
æœ¬åœ°å¼€å‘ï¼š
âœ“ ä½¿ç”¨devç¯å¢ƒ
âœ“ å¼€å¯SQLæ—¥å¿—
âœ“ è¿æ¥æ± è®¾ç½®å°ä¸€ç‚¹

æµ‹è¯•éƒ¨ç½²ï¼š
âœ“ ä½¿ç”¨testç¯å¢ƒ
âœ“ é€‚å½“çš„æ—¥å¿—çº§åˆ«
âœ“ è¿æ¥æ± é€‚ä¸­

ç”Ÿäº§ä¸Šçº¿ï¼š
âœ“ ä½¿ç”¨prodç¯å¢ƒ
âœ“ å…³é—­SQLæ—¥å¿—
âœ“ è¿æ¥æ± æ ¹æ®å¹¶å‘è°ƒå¤§
âœ“ æ•°æ®åº“è´¦å·å¯†ç ä»ç¯å¢ƒå˜é‡è¯»å–
```

**ğŸ”§ æ’æŸ¥æŠ€å·§**

```
è¿æ¥å¤±è´¥æ—¶çš„æ£€æŸ¥é¡ºåºï¼š
1ï¸âƒ£ æ•°æ®åº“æ˜¯å¦å¯åŠ¨
2ï¸âƒ£ IPå’Œç«¯å£æ˜¯å¦æ­£ç¡®
3ï¸âƒ£ ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
4ï¸âƒ£ æ•°æ®åº“æ˜¯å¦å­˜åœ¨
5ï¸âƒ£ é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£
6ï¸âƒ£ é©±åŠ¨ç‰ˆæœ¬æ˜¯å¦åŒ¹é…
```

**ğŸ§  è®°å¿†å£è¯€**

```
æ•°æ®æºé…ç½®å››è¦ç´ ï¼š
é©±åŠ¨åœ°å€è´¦å·å¯†ç ç¼ºä¸€ä¸å¯
è¿æ¥æ± æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼š
æå‰å‡†å¤‡å¤ç”¨è¿æ¥æ€§èƒ½é«˜
å¤šç¯å¢ƒé…ç½®è¦åˆ†æ¸…ï¼š
å¼€å‘æµ‹è¯•ç”Ÿäº§å„ä¸ç›¸åŒ
```

**æ ¸å¿ƒç†è§£**ï¼š
- æ•°æ®æºå°±åƒæ˜¯åº”ç”¨å’Œæ•°æ®åº“ä¹‹é—´çš„"æ¡¥æ¢"
- è¿æ¥æ± å°±åƒæ˜¯"å…±äº«å•è½¦"ï¼Œæå‰å‡†å¤‡å¥½ä¾›å¤§å®¶ä½¿ç”¨
- é…ç½®æ–‡ä»¶å°±æ˜¯å‘Šè¯‰ç¨‹åº"æ€ä¹ˆè¿æ¥æ•°æ®åº“"çš„è¯´æ˜ä¹¦
- ä¸åŒç¯å¢ƒç”¨ä¸åŒé…ç½®ï¼Œå°±åƒåœ¨å®¶ç©¿æ‹–é‹ã€ä¸Šç­ç©¿çš®é‹ä¸€æ ·è‡ªç„¶