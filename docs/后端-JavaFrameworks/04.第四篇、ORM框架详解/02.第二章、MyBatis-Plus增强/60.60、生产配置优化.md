---
title: 60ã€ç”Ÿäº§é…ç½®ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [æ•°æ®åº“è¿æ¥æ± é…ç½®ä¼˜åŒ–](#1-æ•°æ®åº“è¿æ¥æ± é…ç½®ä¼˜åŒ–)
2. [æ’ä»¶ç”Ÿäº§ç¯å¢ƒé…ç½®](#2-æ’ä»¶ç”Ÿäº§ç¯å¢ƒé…ç½®)
3. [æ—¥å¿—çº§åˆ«è°ƒæ•´](#3-æ—¥å¿—çº§åˆ«è°ƒæ•´)
4. [ç›‘æ§æŒ‡æ ‡é…ç½®](#4-ç›‘æ§æŒ‡æ ‡é…ç½®)
5. [å®‰å…¨é…ç½®åŠ å›º](#5-å®‰å…¨é…ç½®åŠ å›º)
6. [æ€§èƒ½å‚æ•°è°ƒä¼˜](#6-æ€§èƒ½å‚æ•°è°ƒä¼˜)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”Œ æ•°æ®åº“è¿æ¥æ± é…ç½®ä¼˜åŒ–


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± 


**é€šä¿—ç†è§£**ï¼šå°±åƒé¤å…çš„åº§ä½ä¸€æ ·
```
æ²¡æœ‰è¿æ¥æ± çš„æƒ…å†µï¼š
é¡¾å®¢æ¥äº† â†’ ä¸´æ—¶æ¬æ¡Œæ¤… â†’ åƒé¥­ â†’ æ”¶æ‹¾æ¡Œæ¤…
æ¯æ¬¡éƒ½è¦å‡†å¤‡å’Œæ¸…ç†ï¼Œå¾ˆæµªè´¹æ—¶é—´

æœ‰è¿æ¥æ± çš„æƒ…å†µï¼š
æå‰å‡†å¤‡å¥½10å¼ æ¡Œå­ â†’ é¡¾å®¢æ¥äº†ç›´æ¥å â†’ åƒå®Œç¦»å¼€ â†’ ä¸‹ä¸€ä½ç»§ç»­ç”¨
æ¡Œå­ä¸€ç›´ä¿ç•™ç€ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å‡†å¤‡
```

**æ•°æ®åº“è¿æ¥æ± çš„ä½œç”¨**ï¼š
- æå‰åˆ›å»ºå¥½ä¸€æ‰¹æ•°æ®åº“è¿æ¥
- ç¨‹åºéœ€è¦æ—¶ç›´æ¥æ‹¿æ¥ç”¨
- ç”¨å®Œæ”¾å›æ± å­ï¼Œä¸æ˜¯ç›´æ¥å…³é—­
- é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥çš„å¼€é”€

### 1.2 å¸¸ç”¨è¿æ¥æ± å¯¹æ¯”


| è¿æ¥æ± ç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **æ¨èåº¦** |
|-----------|---------|------------|-----------|
| **HikariCP** | `é€Ÿåº¦æœ€å¿«ï¼Œé»˜è®¤è¿æ¥æ± ` | `é€‚åˆå¤§éƒ¨åˆ†åœºæ™¯` | â­â­â­â­â­ |
| **Druid** | `åŠŸèƒ½å¼ºå¤§ï¼Œç›‘æ§å®Œå–„` | `éœ€è¦è¯¦ç»†ç›‘æ§` | â­â­â­â­ |
| **DBCP** | `è€ç‰Œç¨³å®š` | `ä¼ ç»Ÿé¡¹ç›®` | â­â­â­ |
| **C3P0** | `é…ç½®ç®€å•` | `å°å‹é¡¹ç›®` | â­â­ |

### 1.3 HikariCPç”Ÿäº§ç¯å¢ƒé…ç½®


**é…ç½®è¯´æ˜**ï¼ˆapplication.ymlï¼‰ï¼š

```yaml
spring:
  datasource:
    # æ•°æ®åº“åŸºæœ¬ä¿¡æ¯
    url: jdbc:mysql://localhost:3306/mydb?useSSL=true
    username: ${DB_USER}  # ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œæ›´å®‰å…¨
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    
    # HikariCPè¿æ¥æ± é…ç½®
    hikari:
      # è¿æ¥æ± åç§°ï¼ˆä¾¿äºæ—¥å¿—è¿½è¸ªï¼‰
      pool-name: MyBatisPlusHikariPool
      
      # ğŸ”¸ æœ€å°ç©ºé—²è¿æ¥æ•°ï¼ˆåƒé¤å…æœ€å°‘ä¿ç•™çš„ç©ºæ¡Œæ•°ï¼‰
      minimum-idle: 10
      # å³ä½¿æ²¡äººç”¨ï¼Œä¹Ÿä¿æŒ10ä¸ªè¿æ¥å¾…å‘½
      
      # ğŸ”¸ æœ€å¤§è¿æ¥æ•°ï¼ˆåƒé¤å…æœ€å¤šèƒ½æ‘†çš„æ¡Œå­æ•°ï¼‰
      maximum-pool-size: 50
      # æœ€å¤šåŒæ—¶50ä¸ªè¿æ¥ï¼Œè¶…è¿‡å°±è¦æ’é˜Ÿç­‰
      
      # ğŸ”¸ è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç­‰ä½æ—¶é—´ï¼‰
      connection-timeout: 30000
      # 30ç§’å†…æ‹¿ä¸åˆ°è¿æ¥å°±æŠ¥é”™ï¼ˆæ¯«ç§’ï¼‰
      
      # ğŸ”¸ ç©ºé—²è¿æ¥å­˜æ´»æ—¶é—´ï¼ˆæ¡Œå­å¤šä¹…æ²¡äººç”¨å°±æ”¶èµ·æ¥ï¼‰
      idle-timeout: 600000
      # 10åˆ†é’Ÿæ²¡ç”¨çš„è¿æ¥ä¼šè¢«å›æ”¶ï¼ˆæ¯«ç§’ï¼‰
      
      # ğŸ”¸ è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆæ¡Œå­ç”¨å¤šä¹…è¦æ¢æ–°çš„ï¼‰
      max-lifetime: 1800000
      # 30åˆ†é’Ÿåå¼ºåˆ¶å›æ”¶ï¼Œé˜²æ­¢è¿æ¥è€åŒ–ï¼ˆæ¯«ç§’ï¼‰
      
      # ğŸ”¸ è¿æ¥æµ‹è¯•æŸ¥è¯¢ï¼ˆæ£€æŸ¥è¿æ¥æ˜¯å¦è¿˜æ´»ç€ï¼‰
      connection-test-query: SELECT 1
      # ç”¨è¿æ¥å‰å…ˆæ‰§è¡Œè¿™ä¸ªæŸ¥è¯¢æµ‹è¯•ä¸€ä¸‹
```

**å‚æ•°å«ä¹‰å¯¹ç…§è¡¨**ï¼š

| å‚æ•° | **é€šä¿—è§£é‡Š** | **ç”Ÿäº§ç¯å¢ƒå»ºè®®å€¼** | **è¯´æ˜** |
|-----|------------|------------------|---------|
| `minimum-idle` | æœ€å°‘ä¿ç•™çš„å¾…å‘½è¿æ¥ | `10-20` | å¤ªå°‘å“åº”æ…¢ï¼Œå¤ªå¤šæµªè´¹èµ„æº |
| `maximum-pool-size` | æœ€å¤šèƒ½åŒæ—¶ä½¿ç”¨çš„è¿æ¥ | `50-100` | æ ¹æ®æ•°æ®åº“æ‰¿è½½èƒ½åŠ›è®¾ç½® |
| `connection-timeout` | ç­‰å¾…è¿æ¥çš„æœ€é•¿æ—¶é—´ | `30000ms` | 30ç§’ï¼Œé¿å…ç”¨æˆ·ç­‰å¤ªä¹… |
| `idle-timeout` | ç©ºé—²è¿æ¥å¤šä¹…å›æ”¶ | `600000ms` | 10åˆ†é’Ÿï¼Œä¿æŒè¿æ¥æ–°é²œ |
| `max-lifetime` | è¿æ¥æœ€é•¿ä½¿ç”¨æ—¶é—´ | `1800000ms` | 30åˆ†é’Ÿï¼Œé˜²æ­¢è¿æ¥æ³„æ¼ |

### 1.4 Druidè¿æ¥æ± é…ç½®ï¼ˆå¸¦ç›‘æ§ï¼‰


**Druidçš„ä¼˜åŠ¿**ï¼šè‡ªå¸¦ç›‘æ§é¡µé¢ï¼Œèƒ½çœ‹åˆ°SQLæ‰§è¡Œæƒ…å†µ

```yaml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # åŸºç¡€è¿æ¥æ± é…ç½®
      initial-size: 10        # åˆå§‹è¿æ¥æ•°ï¼ˆç¨‹åºå¯åŠ¨æ—¶å°±åˆ›å»ºï¼‰
      min-idle: 10            # æœ€å°ç©ºé—²è¿æ¥
      max-active: 50          # æœ€å¤§æ´»è·ƒè¿æ¥
      
      # è·å–è¿æ¥ç­‰å¾…è¶…æ—¶æ—¶é—´
      max-wait: 30000         # 30ç§’
      
      # æ£€æµ‹é…ç½®
      test-while-idle: true   # ç©ºé—²æ—¶æ£€æµ‹è¿æ¥æ˜¯å¦æœ‰æ•ˆ
      test-on-borrow: false   # å€Ÿç”¨æ—¶ä¸æ£€æµ‹ï¼ˆå½±å“æ€§èƒ½ï¼‰
      test-on-return: false   # å½’è¿˜æ—¶ä¸æ£€æµ‹
      
      # æ£€æµ‹é—´éš”å’ŒSQL
      time-between-eviction-runs-millis: 60000  # æ¯60ç§’æ£€æµ‹ä¸€æ¬¡
      min-evictable-idle-time-millis: 300000    # è¿æ¥ç©ºé—²5åˆ†é’Ÿå›æ”¶
      validation-query: SELECT 1                 # æ£€æµ‹SQL
      
      # ğŸ”¸ SQLç›‘æ§é…ç½®ï¼ˆé‡ç‚¹ï¼ï¼‰
      filter:
        stat:
          enabled: true              # å¼€å¯SQLç›‘æ§
          log-slow-sql: true         # è®°å½•æ…¢SQL
          slow-sql-millis: 2000      # è¶…è¿‡2ç§’ç®—æ…¢SQL
          merge-sql: true            # åˆå¹¶ç›¸åŒçš„SQLç»Ÿè®¡
      
      # ğŸ”¸ ç›‘æ§é¡µé¢é…ç½®
      stat-view-servlet:
        enabled: true                # å¼€å¯ç›‘æ§é¡µé¢
        url-pattern: /druid/*        # è®¿é—®è·¯å¾„
        reset-enable: false          # ä¸å…è®¸é‡ç½®ç»Ÿè®¡æ•°æ®
        login-username: admin        # ç™»å½•ç”¨æˆ·å
        login-password: ${DRUID_PWD} # ç™»å½•å¯†ç ï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰
      
      # é˜²ç«å¢™é…ç½®
      wall:
        enabled: true                # å¼€å¯SQLé˜²ç«å¢™
        config:
          multi-statement-allow: false  # ä¸å…è®¸å¤šæ¡SQLä¸€èµ·æ‰§è¡Œ
```

**ç›‘æ§é¡µé¢ä½¿ç”¨**ï¼š
```
è®¿é—®åœ°å€ï¼šhttp://localhost:8080/druid/
å¯ä»¥çœ‹åˆ°ï¼š
âœ… SQLæ‰§è¡Œæ¬¡æ•°å’Œè€—æ—¶
âœ… è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
âœ… æ…¢SQLåˆ—è¡¨
âœ… URIç›‘æ§
```

---

## 2. ğŸ”§ æ’ä»¶ç”Ÿäº§ç¯å¢ƒé…ç½®


### 2.1 åˆ†é¡µæ’ä»¶ä¼˜åŒ–é…ç½®


**å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ**ï¼š

```
å¼€å‘ç¯å¢ƒï¼šå¯ä»¥æŸ¥ä»»æ„é¡µæ•°ï¼Œæ–¹ä¾¿æµ‹è¯•
ç”Ÿäº§ç¯å¢ƒï¼šé™åˆ¶æŸ¥è¯¢èŒƒå›´ï¼Œé˜²æ­¢æ€§èƒ½é—®é¢˜
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š

```java
@Configuration
public class MybatisPlusConfig {
    
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        
        // åˆ†é¡µæ’ä»¶é…ç½®
        PaginationInnerInterceptor paginationInterceptor = 
            new PaginationInnerInterceptor(DbType.MYSQL);
        
        // ğŸ”¸ é™åˆ¶å•é¡µæœ€å¤§æŸ¥è¯¢æ•°é‡ï¼ˆé˜²æ­¢ä¸€æ¬¡æŸ¥å¤ªå¤šï¼‰
        paginationInterceptor.setMaxLimit(500L);
        // æœ€å¤šä¸€æ¬¡æŸ¥500æ¡ï¼Œè¶…è¿‡è‡ªåŠ¨æˆªæ–­
        
        // ğŸ”¸ å…³é—­countæŸ¥è¯¢ä¼˜åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ï¼‰
        paginationInterceptor.setOptimizeJoin(false);
        // å¤æ‚SQLçš„countä¼˜åŒ–å¯èƒ½æœ‰é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒå…³é—­æ›´ç¨³å®š
        
        // ğŸ”¸ æº¢å‡ºå¤„ç†ï¼ˆæŸ¥è¯¢é¡µç è¶…å‡ºæ€»é¡µæ•°æ€ä¹ˆåŠï¼‰
        paginationInterceptor.setOverflow(true);
        // trueï¼šè¿”å›ç¬¬ä¸€é¡µï¼Œfalseï¼šç»§ç»­æŸ¥è¯¢ï¼ˆç©ºç»“æœï¼‰
        
        interceptor.addInnerInterceptor(paginationInterceptor);
        return interceptor;
    }
}
```

**å‚æ•°è¯´æ˜**ï¼š

| é…ç½®é¡¹ | **å¼€å‘ç¯å¢ƒ** | **ç”Ÿäº§ç¯å¢ƒ** | **åŸå› ** |
|-------|------------|------------|---------|
| `maxLimit` | ä¸é™åˆ¶ | `500` | é˜²æ­¢ä¸€æ¬¡æŸ¥è¯¢è¿‡å¤šæ•°æ® |
| `optimizeJoin` | `true` | `false` | å¤æ‚SQLä¼˜åŒ–å¯èƒ½ä¸å‡†ç¡® |
| `overflow` | `false` | `true` | è¶…å‡ºé¡µç è¿”å›é¦–é¡µæ›´å‹å¥½ |

### 2.2 SQLæ€§èƒ½åˆ†ææ’ä»¶ï¼ˆä»…å¼€å‘ä½¿ç”¨ï¼‰


**é‡è¦æç¤º**ï¼šâš ï¸ **ç”Ÿäº§ç¯å¢ƒå¿…é¡»å…³é—­æ­¤æ’ä»¶ï¼**

```java
@Configuration
@Profile("dev") // åªåœ¨å¼€å‘ç¯å¢ƒç”Ÿæ•ˆ
public class PerformanceConfig {
    
    @Bean
    public PerformanceInterceptor performanceInterceptor() {
        PerformanceInterceptor interceptor = new PerformanceInterceptor();
        
        // è®¾ç½®SQLæ‰§è¡Œæœ€å¤§æ—¶é•¿ï¼ˆè¶…è¿‡ä¼šæŠ›å¼‚å¸¸ï¼‰
        interceptor.setMaxTime(1000); // 1ç§’
        
        // æ ¼å¼åŒ–SQLè¾“å‡º
        interceptor.setFormat(true);
        
        return interceptor;
    }
}
```

**ä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒè¦å…³é—­**ï¼š
- âŒ ä¼šæ‰“å°æ‰€æœ‰SQLï¼Œæ—¥å¿—é‡å·¨å¤§
- âŒ æ ¼å¼åŒ–SQLæ¶ˆè€—æ€§èƒ½
- âŒ æ£€æŸ¥æ‰§è¡Œæ—¶é—´å¢åŠ å¼€é”€

### 2.3 ä¹è§‚é”æ’ä»¶ç”Ÿäº§é…ç½®


```java
@Bean
public MybatisPlusInterceptor optimisticLockerInterceptor() {
    MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
    
    // ä¹è§‚é”æ’ä»¶ï¼ˆç‰ˆæœ¬å·è‡ªåŠ¨+1ï¼‰
    OptimisticLockerInnerInterceptor optimisticLocker = 
        new OptimisticLockerInnerInterceptor();
    
    interceptor.addInnerInterceptor(optimisticLocker);
    return interceptor;
}
```

**ä¹è§‚é”ä½¿ç”¨åœºæ™¯**ï¼š
```
åœºæ™¯ï¼šç§’æ€å•†å“åº“å­˜æ‰£å‡
æ²¡æœ‰ä¹è§‚é”ï¼šä¸¤ä¸ªäººåŒæ—¶ä¹°ï¼Œå¯èƒ½éƒ½æˆåŠŸï¼ˆè¶…å–ï¼‰
æœ‰ä¹è§‚é”ï¼šåŸºäºç‰ˆæœ¬å·ï¼Œåªæœ‰ä¸€ä¸ªäººæˆåŠŸ
```

---

## 3. ğŸ“ æ—¥å¿—çº§åˆ«è°ƒæ•´


### 3.1 æ—¥å¿—çº§åˆ«è¯´æ˜


**æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜**ï¼š
```
TRACE â†’ DEBUG â†’ INFO â†’ WARN â†’ ERROR â†’ OFF

çº§åˆ«è¶Šé«˜ï¼Œæ‰“å°çš„æ—¥å¿—è¶Šå°‘
```

| çº§åˆ« | **æ‰“å°å†…å®¹** | **ä½¿ç”¨åœºæ™¯** |
|------|------------|------------|
| `TRACE` | æœ€è¯¦ç»†çš„è¿½è¸ªä¿¡æ¯ | æ·±åº¦è°ƒè¯• |
| `DEBUG` | è°ƒè¯•ä¿¡æ¯ï¼ˆåŒ…å«SQLï¼‰ | å¼€å‘ç¯å¢ƒ |
| `INFO` | å…³é”®ä¿¡æ¯æç¤º | ç”Ÿäº§ç¯å¢ƒ |
| `WARN` | è­¦å‘Šä¿¡æ¯ | ç”Ÿäº§ç¯å¢ƒ |
| `ERROR` | é”™è¯¯ä¿¡æ¯ | ä»»ä½•ç¯å¢ƒ |

### 3.2 å¼€å‘ç¯å¢ƒæ—¥å¿—é…ç½®


```yaml
# application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
logging:
  level:
    # æ‰“å°æ‰€æœ‰SQLå’Œå‚æ•°
    com.baomidou.mybatisplus: DEBUG
    # ä½ çš„é¡¹ç›®åŒ…è·¯å¾„
    com.yourcompany.project: DEBUG
    # SQLæ‰§è¡Œæ—¥å¿—
    org.springframework.jdbc: DEBUG
  
  # æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
```

**èƒ½çœ‹åˆ°ä»€ä¹ˆ**ï¼š
```sql
-- å®Œæ•´çš„SQLè¯­å¥
SELECT id, name, age FROM user WHERE id = ?

-- å‚æ•°å€¼
Parameters: 1(Long)

-- æ‰§è¡Œç»“æœ
Total: 1
```

### 3.3 ç”Ÿäº§ç¯å¢ƒæ—¥å¿—é…ç½®


```yaml
# application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
logging:
  level:
    # ğŸ”¸ å…³é”®ï¼šåªè®°å½•WARNä»¥ä¸Šçš„æ—¥å¿—
    root: WARN
    com.baomidou.mybatisplus: WARN
    com.yourcompany.project: INFO
    
  # ğŸ”¸ æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶
  file:
    name: logs/application.log
    max-size: 100MB        # å•ä¸ªæ–‡ä»¶æœ€å¤§100MB
    max-history: 30        # ä¿ç•™30å¤©
    total-size-cap: 10GB   # æ€»æ—¥å¿—æœ€å¤§10GB
  
  # æ—¥å¿—æ ¼å¼ï¼ˆä¾¿äºæ—¥å¿—åˆ†æå·¥å…·è§£æï¼‰
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
```

**ç”Ÿäº§ç¯å¢ƒæ—¥å¿—åŸåˆ™**ï¼š
- âœ… **åªè®°å½•å¿…è¦ä¿¡æ¯**ï¼šé”™è¯¯ã€è­¦å‘Šã€å…³é”®æ“ä½œ
- âœ… **ä¸æ‰“å°SQL**ï¼šé¿å…æ³„éœ²æ•°æ®å’Œå½±å“æ€§èƒ½
- âœ… **å®šæœŸæ¸…ç†**ï¼šé˜²æ­¢ç£ç›˜å æ»¡
- âœ… **å¼‚å¸¸è¦è¯¦ç»†**ï¼šè®°å½•å®Œæ•´å †æ ˆä¿¡æ¯

### 3.4 æ•æ„Ÿä¿¡æ¯è„±æ•


**é—®é¢˜åœºæ™¯**ï¼š
```
æ—¥å¿—ä¸­å¯èƒ½åŒ…å«ï¼š
âŒ ç”¨æˆ·å¯†ç 
âŒ æ‰‹æœºå·
âŒ èº«ä»½è¯å·
âŒ é“¶è¡Œå¡å·
```

**è§£å†³æ–¹æ¡ˆ**ï¼šè‡ªå®šä¹‰æ—¥å¿—è„±æ•

```java
public class SensitiveDataLogger {
    
    /**
     * æ‰‹æœºå·è„±æ•ï¼š138****5678
     */
    public static String maskPhone(String phone) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
    
    /**
     * èº«ä»½è¯è„±æ•ï¼š110101********1234
     */
    public static String maskIdCard(String idCard) {
        if (idCard == null || idCard.length() < 8) {
            return idCard;
        }
        return idCard.substring(0, 6) + "********" + 
               idCard.substring(idCard.length() - 4);
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    log.info("ç”¨æˆ·æ³¨å†Œï¼šæ‰‹æœºå·={}", maskPhone(user.getPhone()));
}
```

---

## 4. ğŸ“Š ç›‘æ§æŒ‡æ ‡é…ç½®


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§


**é€šä¿—ç†è§£**ï¼šå°±åƒç»™æ±½è½¦è£…ä»ªè¡¨ç›˜
```
æ²¡æœ‰ç›‘æ§ï¼šè½¦å¼€ç€å¼€ç€åäº†ï¼Œä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜
æœ‰ç›‘æ§ï¼šèƒ½çœ‹åˆ°æ²¹é‡ã€æ°´æ¸©ã€è½¬é€Ÿï¼Œæå‰é¢„è­¦
```

**æ•°æ®åº“ç›‘æ§èƒ½çœ‹åˆ°**ï¼š
- ğŸ“ˆ SQLæ‰§è¡Œæ¬¡æ•°å’Œè€—æ—¶
- ğŸ“ˆ è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
- ğŸ“ˆ æ…¢SQLåˆ—è¡¨
- ğŸ“ˆ å¼‚å¸¸ç»Ÿè®¡

### 4.2 é›†æˆSpring Boot Actuator


**æ·»åŠ ä¾èµ–**ï¼š

```xml
<!-- Spring Bootç›‘æ§ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>

<!-- å¯é€‰ï¼šPrometheusç›‘æ§ -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

**é…ç½®ç›‘æ§ç«¯ç‚¹**ï¼š

```yaml
management:
  endpoints:
    web:
      exposure:
        # ğŸ”¸ å¼€æ”¾çš„ç›‘æ§ç«¯ç‚¹
        include: health,info,metrics,prometheus
  
  endpoint:
    health:
      # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
      show-details: always
  
  metrics:
    export:
      prometheus:
        enabled: true  # å¯ç”¨Prometheus
```

**è®¿é—®ç›‘æ§ä¿¡æ¯**ï¼š
```
å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8080/actuator/health
æ€§èƒ½æŒ‡æ ‡ï¼šhttp://localhost:8080/actuator/metrics
Prometheusï¼šhttp://localhost:8080/actuator/prometheus
```

### 4.3 è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡


```java
@Component
public class DatabaseMetrics {
    
    private final MeterRegistry registry;
    
    public DatabaseMetrics(MeterRegistry registry) {
        this.registry = registry;
    }
    
    /**
     * è®°å½•æ…¢SQL
     */
    public void recordSlowSql(String sqlId, long duration) {
        registry.counter("database.slow.sql", 
            "sql_id", sqlId,
            "duration", String.valueOf(duration)
        ).increment();
    }
    
    /**
     * è®°å½•æ•°æ®åº“æ“ä½œ
     */
    public void recordDbOperation(String operation, boolean success) {
        registry.counter("database.operation",
            "type", operation,
            "success", String.valueOf(success)
        ).increment();
    }
}
```

### 4.4 ç›‘æ§å‘Šè­¦é…ç½®


**é…ç½®å‘Šè­¦è§„åˆ™**ï¼ˆç¤ºä¾‹ï¼‰ï¼š

```yaml
# å‘Šè­¦è§„åˆ™é…ç½®
alert:
  # æ…¢SQLå‘Šè­¦
  slow-sql:
    threshold: 2000      # è¶…è¿‡2ç§’å‘Šè­¦
    action: send-email   # å‘é€é‚®ä»¶
  
  # è¿æ¥æ± å‘Šè­¦
  connection-pool:
    usage-threshold: 80  # ä½¿ç”¨ç‡è¶…80%å‘Šè­¦
    action: send-sms     # å‘é€çŸ­ä¿¡
  
  # é”™è¯¯ç‡å‘Šè­¦
  error-rate:
    threshold: 5         # æ¯åˆ†é’Ÿé”™è¯¯è¶…5æ¬¡å‘Šè­¦
    window: 1m           # ç»Ÿè®¡çª—å£1åˆ†é’Ÿ
```

---

## 5. ğŸ”’ å®‰å…¨é…ç½®åŠ å›º


### 5.1 æ•°æ®åº“è¿æ¥å®‰å…¨


**âŒ ä¸å®‰å…¨çš„é…ç½®**ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root        # ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶
    password: 123456      # å¯†ç æ˜æ–‡
```

**âœ… å®‰å…¨çš„é…ç½®**ï¼š

```yaml
spring:
  datasource:
    # ğŸ”¸ ä½¿ç”¨ç¯å¢ƒå˜é‡
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME}?useSSL=true&serverTimezone=UTC
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    
    # ğŸ”¸ å¼€å¯SSLè¿æ¥
    hikari:
      connection-properties: useSSL=true;requireSSL=true
```

**ç¯å¢ƒå˜é‡è®¾ç½®**ï¼š
```bash
# Linux/Mac
export DB_USER=myuser
export DB_PASSWORD=mypassword

# Windows
set DB_USER=myuser
set DB_PASSWORD=mypassword
```

### 5.2 SQLæ³¨å…¥é˜²æŠ¤


**MyBatis-Plusé»˜è®¤é˜²SQLæ³¨å…¥**ï¼š
```java
// âœ… å®‰å…¨ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
User user = userMapper.selectById(userId);

// âœ… å®‰å…¨ï¼šä½¿ç”¨Wrapper
QueryWrapper<User> wrapper = new QueryWrapper<>();
wrapper.eq("username", username);

// âŒ å±é™©ï¼šä¸è¦è‡ªå·±æ‹¼æ¥SQL
String sql = "SELECT * FROM user WHERE id = " + userId; // å¯èƒ½è¢«æ³¨å…¥
```

**é¢å¤–é˜²æŠ¤æªæ–½**ï¼š

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public MybatisPlusInterceptor securityInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        
        // ğŸ”¸ æ·»åŠ SQLæ³¨å…¥æ£€æŸ¥ï¼ˆDruid Wall Filterï¼‰
        WallConfig config = new WallConfig();
        config.setMultiStatementAllow(false);  // ä¸å…è®¸å¤šæ¡SQL
        config.setCommentAllow(false);         // ä¸å…è®¸æ³¨é‡Š
        
        return interceptor;
    }
}
```

### 5.3 æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨


**åœºæ™¯**ï¼šç”¨æˆ·å¯†ç ã€èº«ä»½è¯å·ç­‰æ•æ„Ÿå­—æ®µ

```java
@Data
@TableName("user")
public class User {
    
    private Long id;
    
    private String username;
    
    // ğŸ”¸ å¯†ç å­—æ®µåŠ å¯†
    @TableField(typeHandler = PasswordTypeHandler.class)
    private String password;
    
    // ğŸ”¸ èº«ä»½è¯å·åŠ å¯†
    @TableField(typeHandler = SensitiveTypeHandler.class)
    private String idCard;
}
```

**è‡ªå®šä¹‰åŠ å¯†å¤„ç†å™¨**ï¼š

```java
public class PasswordTypeHandler extends BaseTypeHandler<String> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                     String parameter, JdbcType jdbcType) {
        // å­˜å‚¨æ—¶åŠ å¯†
        ps.setString(i, encrypt(parameter));
    }
    
    @Override
    public String getNullableResult(ResultSet rs, String columnName) {
        // æŸ¥è¯¢æ—¶è§£å¯†
        return decrypt(rs.getString(columnName));
    }
    
    private String encrypt(String data) {
        // ä½¿ç”¨BCryptæˆ–AESåŠ å¯†
        return BCrypt.hashpw(data, BCrypt.gensalt());
    }
    
    private String decrypt(String encrypted) {
        // æ ¹æ®åŠ å¯†æ–¹å¼è§£å¯†
        return encrypted; // BCryptæ˜¯å•å‘åŠ å¯†ï¼Œä¸éœ€è¦è§£å¯†
    }
}
```

### 5.4 æƒé™æ§åˆ¶


**æ•°æ®æƒé™é…ç½®**ï¼š

```java
@Component
public class DataPermissionInterceptor implements InnerInterceptor {
    
    @Override
    public void beforeQuery(Executor executor, MappedStatement ms, 
                           Object parameter, RowBounds rowBounds, 
                           ResultHandler resultHandler, BoundSql boundSql) {
        
        // ğŸ”¸ è·å–å½“å‰ç”¨æˆ·
        User currentUser = SecurityUtils.getCurrentUser();
        
        // ğŸ”¸ æ ¹æ®ç”¨æˆ·è§’è‰²æ·»åŠ æ•°æ®è¿‡æ»¤æ¡ä»¶
        if (!currentUser.isAdmin()) {
            // æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®
            String sql = boundSql.getSql();
            sql = sql + " AND user_id = " + currentUser.getId();
            // ä¿®æ”¹SQLï¼ˆç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…éœ€è¦æ›´å¤æ‚å¤„ç†ï¼‰
        }
    }
}
```

---

## 6. âš¡ æ€§èƒ½å‚æ•°è°ƒä¼˜


### 6.1 æ‰¹é‡æ“ä½œä¼˜åŒ–


**é—®é¢˜åœºæ™¯**ï¼šæ’å…¥10000æ¡æ•°æ®
```
âŒ ä½æ•ˆæ–¹å¼ï¼šå¾ªç¯è°ƒç”¨insertï¼Œæ‰§è¡Œ10000æ¬¡SQL
âœ… é«˜æ•ˆæ–¹å¼ï¼šæ‰¹é‡æ’å…¥ï¼Œæ‰§è¡Œ1æ¬¡SQL
```

**æ‰¹é‡æ’å…¥é…ç½®**ï¼š

```yaml
mybatis-plus:
  configuration:
    # ğŸ”¸ å¼€å¯æ‰¹é‡æ‰§è¡Œå™¨
    default-executor-type: BATCH
  
  global-config:
    db-config:
      # ğŸ”¸ æ‰¹é‡æ“ä½œå¤§å°
      batch-size: 1000  # æ¯æ‰¹1000æ¡
```

**ä½¿ç”¨æ‰¹é‡ä¿å­˜**ï¼š

```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    /**
     * æ‰¹é‡æ’å…¥
     */
    public void batchInsert(List<User> users) {
        // è‡ªåŠ¨åˆ†æ‰¹ï¼Œæ¯æ‰¹1000æ¡
        userService.saveBatch(users, 1000);
    }
}
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
æ’å…¥10000æ¡æ•°æ®ï¼š
å¾ªç¯insertï¼šçº¦30ç§’
æ‰¹é‡insertï¼šçº¦2ç§’

æ€§èƒ½æå‡ï¼š15å€ï¼
```

### 6.2 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–


**é…ç½®æŸ¥è¯¢ä¼˜åŒ–å‚æ•°**ï¼š

```yaml
mybatis-plus:
  configuration:
    # ğŸ”¸ æŸ¥è¯¢ç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜ï¼‰
    local-cache-scope: SESSION  # SESSIONï¼šä¼šè¯çº§ï¼ŒSTATEMENTï¼šè¯­å¥çº§
    
    # ğŸ”¸ å»¶è¿ŸåŠ è½½
    lazy-loading-enabled: true
    aggressive-lazy-loading: false
    
    # ğŸ”¸ ç»“æœé›†å¤§å°é™åˆ¶
    default-fetch-size: 100
    default-statement-timeout: 30  # æŸ¥è¯¢è¶…æ—¶30ç§’
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **ä½œç”¨** | **å»ºè®®å€¼** |
|------|---------|-----------|
| `local-cache-scope` | ä¸€çº§ç¼“å­˜èŒƒå›´ | `SESSION` |
| `lazy-loading-enabled` | æ˜¯å¦å»¶è¿ŸåŠ è½½ | `true` |
| `default-fetch-size` | æ¯æ¬¡å–å¤šå°‘æ¡ | `100-500` |
| `default-statement-timeout` | SQLè¶…æ—¶æ—¶é—´ | `30ç§’` |

### 6.3 ç´¢å¼•ä¼˜åŒ–å»ºè®®


**è‡ªåŠ¨åˆ†æç´¢å¼•ä½¿ç”¨**ï¼š

```java
@Aspect
@Component
public class IndexAnalysisAspect {
    
    @Around("execution(* com.yourcompany..mapper.*.*(..))")
    public Object analyzeIndex(ProceedingJoinPoint pjp) throws Throwable {
        long start = System.currentTimeMillis();
        Object result = pjp.proceed();
        long duration = System.currentTimeMillis() - start;
        
        // ğŸ”¸ æ…¢æŸ¥è¯¢è®°å½•ï¼ˆè¶…è¿‡100msï¼‰
        if (duration > 100) {
            log.warn("æ…¢æŸ¥è¯¢ï¼š{}, è€—æ—¶ï¼š{}ms", 
                pjp.getSignature(), duration);
            // å»ºè®®ï¼šæ£€æŸ¥æ˜¯å¦ç¼ºå°‘ç´¢å¼•
        }
        
        return result;
    }
}
```

**ç´¢å¼•ä½¿ç”¨æ£€æŸ¥æ¸…å•**ï¼š

```
âœ… WHEREæ¡ä»¶å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•
âœ… JOINå…³è”å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•  
âœ… ORDER BYå­—æ®µæ˜¯å¦æœ‰ç´¢å¼•
âœ… ç´¢å¼•æ˜¯å¦è¿‡å¤šï¼ˆå½±å“å†™å…¥æ€§èƒ½ï¼‰
âœ… æ˜¯å¦ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•
```

### 6.4 JVMå‚æ•°è°ƒä¼˜


**ç”Ÿäº§ç¯å¢ƒJVMé…ç½®**ï¼š

```bash
# å¯åŠ¨å‚æ•°
java -jar yourapp.jar \
  -Xms2g \                    # åˆå§‹å †å†…å­˜2G
  -Xmx2g \                    # æœ€å¤§å †å†…å­˜2Gï¼ˆä¸åˆå§‹å€¼ç›¸åŒï¼Œé¿å…æ‰©å®¹ï¼‰
  -XX:+UseG1GC \              # ä½¿ç”¨G1åƒåœ¾å›æ”¶å™¨
  -XX:MaxGCPauseMillis=200 \  # GCæœ€å¤§æš‚åœæ—¶é—´200ms
  -XX:+HeapDumpOnOutOfMemoryError \  # OOMæ—¶dumpå †
  -XX:HeapDumpPath=/logs/heapdump.hprof \
  -Xloggc:/logs/gc.log \      # GCæ—¥å¿—
  -XX:+PrintGCDetails         # æ‰“å°GCè¯¦æƒ…
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | **ä½œç”¨** | **å»ºè®®å€¼** |
|------|---------|-----------|
| `-Xms` | åˆå§‹å †å¤§å° | ä¸Xmxç›¸åŒ |
| `-Xmx` | æœ€å¤§å †å¤§å° | ç‰©ç†å†…å­˜çš„50-70% |
| `-XX:+UseG1GC` | G1åƒåœ¾å›æ”¶å™¨ | æ¨èä½¿ç”¨ |
| `-XX:MaxGCPauseMillis` | GCæš‚åœæ—¶é—´ | 200ms |

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„é…ç½®è¦ç‚¹


```
ğŸ”¸ è¿æ¥æ± é…ç½®ï¼šHikariCPä¸ºä¸»ï¼Œåˆç†è®¾ç½®æœ€å°/æœ€å¤§è¿æ¥æ•°
ğŸ”¸ æ—¥å¿—çº§åˆ«ï¼šç”Ÿäº§ç¯å¢ƒWARNçº§åˆ«ï¼Œä¸æ‰“å°SQL
ğŸ”¸ æ’ä»¶é…ç½®ï¼šåˆ†é¡µé™åˆ¶æœ€å¤§æ•°é‡ï¼Œå…³é—­æ€§èƒ½åˆ†ææ’ä»¶
ğŸ”¸ ç›‘æ§é…ç½®ï¼šé›†æˆActuatorï¼Œé…ç½®å‘Šè­¦è§„åˆ™
ğŸ”¸ å®‰å…¨åŠ å›ºï¼šç¯å¢ƒå˜é‡å­˜å¯†ç ï¼Œå¼€å¯SSLï¼Œæ•°æ®åŠ å¯†
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šæ‰¹é‡æ“ä½œã€ç´¢å¼•ä¼˜åŒ–ã€JVMè°ƒä¼˜
```

### 7.2 ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•


**éƒ¨ç½²å‰å¿…æŸ¥**ï¼š

- [ ] âœ… æ•°æ®åº“å¯†ç æ˜¯å¦ä½¿ç”¨ç¯å¢ƒå˜é‡
- [ ] âœ… æ—¥å¿—çº§åˆ«æ˜¯å¦ä¸ºWARNæˆ–INFO
- [ ] âœ… æ€§èƒ½åˆ†ææ’ä»¶æ˜¯å¦å…³é—­
- [ ] âœ… è¿æ¥æ± å‚æ•°æ˜¯å¦åˆç†
- [ ] âœ… ç›‘æ§ç«¯ç‚¹æ˜¯å¦é…ç½®
- [ ] âœ… æ…¢SQLæ˜¯å¦æœ‰å‘Šè­¦
- [ ] âœ… æ‰¹é‡æ“ä½œæ˜¯å¦å¯ç”¨
- [ ] âœ… JVMå‚æ•°æ˜¯å¦ä¼˜åŒ–

### 7.3 é…ç½®å¯¹æ¯”æ€»ç»“


| é…ç½®é¡¹ | **å¼€å‘ç¯å¢ƒ** | **ç”Ÿäº§ç¯å¢ƒ** | **åŸå› ** |
|-------|------------|------------|---------|
| æ—¥å¿—çº§åˆ« | `DEBUG` | `WARN/INFO` | å‡å°‘æ—¥å¿—é‡ |
| SQLæ‰“å° | å¼€å¯ | å…³é—­ | é¿å…æ€§èƒ½æŸè€— |
| æ€§èƒ½åˆ†æ | å¼€å¯ | **å…³é—­** | é¿å…æ€§èƒ½æŸè€— |
| è¿æ¥æ± å¤§å° | å°ï¼ˆ5-10ï¼‰ | å¤§ï¼ˆ50-100ï¼‰ | æ‰¿è½½æ›´å¤šè¯·æ±‚ |
| æ‰¹é‡å¤§å° | 100 | 1000 | æé«˜ååé‡ |
| ç›‘æ§å‘Šè­¦ | å¯é€‰ | **å¿…é¡»** | åŠæ—¶å‘ç°é—®é¢˜ |

### 7.4 æ€§èƒ½ä¼˜åŒ–è®°å¿†å£è¯€


```
è¿æ¥æ± è¦è°ƒå¥½ï¼Œè¿æ¥æ•°é‡ä¸èƒ½å°‘
æ—¥å¿—çº§åˆ«è°ƒé«˜ç‚¹ï¼ŒSQLæ‰“å°è¦å…³æ‰
æ‰¹é‡æ“ä½œæ˜¯ç‹é“ï¼Œç´¢å¼•ä¼˜åŒ–ä¸èƒ½å°‘
ç›‘æ§å‘Šè­¦è¦é…å…¨ï¼Œé—®é¢˜å‘ç°è¦è¶æ—©
å®‰å…¨é…ç½®è¦åŠ å›ºï¼Œå¯†ç ç¯å¢ƒå˜é‡è—
JVMå‚æ•°è°ƒä¸€è°ƒï¼ŒG1å›æ”¶å™¨æœ€å¯é 
```

### 7.5 å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³


**é—®é¢˜1ï¼šè¿æ¥æ± è€—å°½**
```
ç°è±¡ï¼šè·å–è¿æ¥è¶…æ—¶
åŸå› ï¼šæœ€å¤§è¿æ¥æ•°å¤ªå°æˆ–æœ‰è¿æ¥æ³„æ¼
è§£å†³ï¼šå¢å¤§maximum-pool-sizeï¼Œæ£€æŸ¥ä»£ç æ˜¯å¦æ­£ç¡®å…³é—­è¿æ¥
```

**é—®é¢˜2ï¼šæ…¢SQLè¿‡å¤š**
```
ç°è±¡ï¼šè¯·æ±‚å“åº”æ…¢
åŸå› ï¼šç¼ºå°‘ç´¢å¼•æˆ–SQLå†™æ³•ä¸å½“
è§£å†³ï¼šå¼€å¯æ…¢SQLæ—¥å¿—ï¼Œæ·»åŠ ç´¢å¼•ï¼Œä¼˜åŒ–SQL
```

**é—®é¢˜3ï¼šå†…å­˜æº¢å‡º**
```
ç°è±¡ï¼šOOMå¼‚å¸¸
åŸå› ï¼šæŸ¥è¯¢æ•°æ®é‡è¿‡å¤§æˆ–å†…å­˜æ³„æ¼
è§£å†³ï¼šé™åˆ¶æŸ¥è¯¢æ•°é‡ï¼Œå¢å¤§å †å†…å­˜ï¼Œæ£€æŸ¥å†…å­˜æ³„æ¼
```

**æ ¸å¿ƒè®°ä½**ï¼š
- ç”Ÿäº§ç¯å¢ƒé…ç½®è¦ä¿å®ˆç¨³å®šï¼Œä¸è¿½æ±‚æè‡´æ€§èƒ½
- ç›‘æ§å’Œæ—¥å¿—æ˜¯å‘ç°é—®é¢˜çš„çœ¼ç›ï¼Œå¿…é¡»é…ç½®
- å®‰å…¨æ°¸è¿œæ˜¯ç¬¬ä¸€ä½ï¼Œå¯†ç ç¯å¢ƒå˜é‡ï¼Œæ•°æ®è¦åŠ å¯†
- æ€§èƒ½ä¼˜åŒ–è¦æœ‰æ•°æ®æ”¯æ’‘ï¼Œä¸èƒ½æ‹è„‘è¢‹è°ƒå‚æ•°