---
title: 61ã€åŠ¨æ€SQLä¸åŸç”ŸSQLç»“åˆ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯åŠ¨æ€SQLä¸åŸç”ŸSQLé›†æˆ](#1-ä»€ä¹ˆæ˜¯åŠ¨æ€SQLä¸åŸç”ŸSQLé›†æˆ)
2. [@Selectæ³¨è§£é…åˆWrapperä½¿ç”¨](#2-Selectæ³¨è§£é…åˆWrapperä½¿ç”¨)
3. [XMLåŠ¨æ€SQLé›†æˆæ–¹æ¡ˆ](#3-XMLåŠ¨æ€SQLé›†æˆæ–¹æ¡ˆ)
4. [å¤æ‚ä¸šåŠ¡æŸ¥è¯¢åœºæ™¯å®æˆ˜](#4-å¤æ‚ä¸šåŠ¡æŸ¥è¯¢åœºæ™¯å®æˆ˜)
5. [æ€§èƒ½å¯¹æ¯”åˆ†æ](#5-æ€§èƒ½å¯¹æ¯”åˆ†æ)
6. [å¼€å‘æ•ˆç‡æƒè¡¡](#6-å¼€å‘æ•ˆç‡æƒè¡¡)
7. [ç»´æŠ¤æ€§è€ƒé‡](#7-ç»´æŠ¤æ€§è€ƒé‡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯åŠ¨æ€SQLä¸åŸç”ŸSQLé›†æˆ


### 1.1 åŸºæœ¬æ¦‚å¿µè§£é‡Š


**ä»€ä¹ˆæ˜¯åŠ¨æ€SQLï¼Ÿ**
```
ç®€å•ç†è§£ï¼š
å°±æ˜¯SQLè¯­å¥ä¸æ˜¯å†™æ­»çš„ï¼Œè€Œæ˜¯æ ¹æ®ä¸åŒæ¡ä»¶è‡ªåŠ¨ç»„è£…çš„

æ¯”å¦‚æœç´¢å•†å“ï¼š
- æœ‰ä»·æ ¼èŒƒå›´æ—¶ï¼šåŠ ä¸Š price BETWEEN 100 AND 500
- æœ‰åˆ†ç±»æ—¶ï¼šåŠ ä¸Š category = 'ç”µå­äº§å“'
- æœ‰å…³é”®è¯æ—¶ï¼šåŠ ä¸Š name LIKE '%æ‰‹æœº%'

è¿™äº›æ¡ä»¶å¯èƒ½æœ‰ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼ŒSQLéœ€è¦çµæ´»ç»„è£…
```

**ä»€ä¹ˆæ˜¯åŸç”ŸSQLï¼Ÿ**
```
åŸç”ŸSQLï¼šå°±æ˜¯æˆ‘ä»¬æ‰‹å†™çš„æ ‡å‡†SQLè¯­å¥

SELECT * FROM user WHERE age > 18 AND status = 1

MyBatis-Plusæä¾›äº†å¾ˆå¤šæ–¹ä¾¿çš„æ–¹æ³•ï¼Œä½†æœ‰æ—¶å€™ï¼š
- ä¸šåŠ¡å¤ªå¤æ‚ï¼Œå°è£…çš„æ–¹æ³•ä¸å¤Ÿç”¨
- éœ€è¦æ•°æ®åº“ç‰¹æœ‰çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚MySQLçš„JSONå‡½æ•°ï¼‰
- è¦ç”¨åˆ°å­æŸ¥è¯¢ã€è”è¡¨ç­‰å¤æ‚æŸ¥è¯¢

è¿™æ—¶å€™å°±éœ€è¦å†™åŸç”ŸSQL
```

**ä¸ºä»€ä¹ˆè¦æŠŠå®ƒä»¬ç»“åˆï¼Ÿ**

| æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|------------|
| ğŸ”¸ **çº¯Wrapper** | `ä»£ç ç®€æ´ï¼Œç±»å‹å®‰å…¨` | `å¤æ‚æŸ¥è¯¢åŠ›ä¸ä»å¿ƒ` | `ç®€å•çš„CRUDæ“ä½œ` |
| ğŸ”¸ **çº¯åŸç”ŸSQL** | `çµæ´»å¼ºå¤§ï¼Œå•¥éƒ½èƒ½å†™` | `å­—ç¬¦ä¸²æ‹¼æ¥æ˜“å‡ºé”™` | `ç‰¹åˆ«å¤æ‚çš„æŸ¥è¯¢` |
| ğŸ”¸ **ä¸¤è€…ç»“åˆ** | `å„å–æ‰€é•¿ï¼Œäº’è¡¥çŸ­æ¿` | `éœ€è¦ç†è§£ä¸¤ç§æ–¹å¼` | `å¤§å¤šæ•°å®é™…é¡¹ç›®` |

### 1.2 é›†æˆçš„æ ¸å¿ƒä»·å€¼


**ğŸ¯ å®é™…å¼€å‘ä¸­çš„ç—›ç‚¹**
```
åœºæ™¯1ï¼šç”µå•†æœç´¢
ç”¨æˆ·å¯èƒ½è¾“å…¥ï¼š
- åªè¾“å…¥å…³é”®è¯
- åªé€‰ä»·æ ¼èŒƒå›´
- åªé€‰åˆ†ç±»
- æˆ–è€…å…¨éƒ½é€‰

çº¯Wrapperå†™æ³•ï¼šéœ€è¦å¤§é‡ifåˆ¤æ–­
çº¯SQLå†™æ³•ï¼šå­—ç¬¦ä¸²æ‹¼æ¥å®¹æ˜“å‡ºé”™
ç»“åˆæ–¹æ¡ˆï¼šåŠ¨æ€SQL + Wrapperæ¡ä»¶ = å®Œç¾
```

**ğŸ’¡ ä¸ºä»€ä¹ˆæ–°æ‰‹è¦å­¦è¿™ä¸ªï¼Ÿ**
```
âœ… å·¥ä½œä¸­å¿…ç”¨ï¼š90%çš„é¡¹ç›®éƒ½ä¼šé‡åˆ°
âœ… é¢è¯•ä¼šé—®ï¼šè€ƒå¯Ÿå¯¹æ¡†æ¶çš„ç†è§£æ·±åº¦
âœ… è§£å†³å®é™…é—®é¢˜ï¼šå¤æ‚ä¸šåŠ¡çš„æ•‘å‘½ç¨»è‰
```

---

## 2. ğŸ”§ @Selectæ³¨è§£é…åˆWrapperä½¿ç”¨


### 2.1 åŸºç¡€ç”¨æ³•è®²è§£


**@Selectæ˜¯ä»€ä¹ˆï¼Ÿ**
```java
// æœ€ç®€å•çš„ç†è§£ï¼šåœ¨æ–¹æ³•ä¸Šå†™SQLçš„æ³¨è§£
@Select("SELECT * FROM user WHERE age > 18")
List<User> getAdultUsers();

// è¿™æ ·å°±ä¸ç”¨å†™XMLäº†ï¼ŒSQLç›´æ¥å†™åœ¨Javaä»£ç é‡Œ
```

**é…åˆWrapperæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ**
```
Wrapperï¼šå°±æ˜¯MyBatis-Plusçš„æ¡ä»¶æ„é€ å™¨
å¯ä»¥ç†è§£ä¸º"æ¡ä»¶å®¹å™¨"ï¼ŒæŠŠæŸ¥è¯¢æ¡ä»¶è£…è¿›å»

@Select + Wrapper = 
  SQLçš„çµæ´»æ€§ + Wrapperçš„ç±»å‹å®‰å…¨ = æœ€ä½³ç»„åˆ
```

### 2.2 å®æˆ˜ç¤ºä¾‹ï¼šä»ç®€å•åˆ°å¤æ‚


**ğŸ“Œ ç¤ºä¾‹1ï¼šåŸºç¡€é›†æˆ**
```java
public interface UserMapper extends BaseMapper<User> {
    
    // æ³¨æ„ï¼š${ew.customSqlSegment} æ˜¯å…³é”®
    @Select("SELECT * FROM user ${ew.customSqlSegment}")
    List<User> selectByWrapper(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
}
```

**ğŸ’­ è§£é‡Šè¯´æ˜**
```
${ew.customSqlSegment}ï¼šè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
- ew = EntityWrapperçš„ç¼©å†™
- customSqlSegment = è‡ªå®šä¹‰SQLç‰‡æ®µ
- ä½œç”¨ï¼šæŠŠWrapperæ„é€ çš„æ¡ä»¶è‡ªåŠ¨æ’å…¥åˆ°è¿™é‡Œ

@Param(Constants.WRAPPER)ï¼šä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸ªï¼Ÿ
- å‘Šè¯‰MyBatis-Plusè¿™ä¸ªå‚æ•°æ˜¯Wrapper
- æ¡†æ¶æ‰çŸ¥é“å¦‚ä½•å¤„ç† ${ew.customSqlSegment}
```

**ğŸ”¸ ä½¿ç”¨æ–¹æ³•**
```java
// ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨
public List<User> searchUsers(String name, Integer minAge) {
    LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
    
    // æœ‰nameå°±åŠ nameæ¡ä»¶
    if (StrUtil.isNotBlank(name)) {
        wrapper.like(User::getName, name);
    }
    
    // æœ‰å¹´é¾„å°±åŠ å¹´é¾„æ¡ä»¶
    if (minAge != null) {
        wrapper.ge(User::getAge, minAge);
    }
    
    // æœ€ç»ˆç”Ÿæˆçš„SQLå¯èƒ½æ˜¯ï¼š
    // SELECT * FROM user WHERE name LIKE '%å¼ %' AND age >= 18
    return userMapper.selectByWrapper(wrapper);
}
```

**ğŸ“Œ ç¤ºä¾‹2ï¼šè‡ªå®šä¹‰æŸ¥è¯¢å­—æ®µ**
```java
@Select("SELECT id, name, age, create_time " +
        "FROM user " +
        "${ew.customSqlSegment}")
List<UserVO> selectUserVO(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·å†™ï¼Ÿ**
```
æœ‰æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦æŸ¥æ‰€æœ‰å­—æ®µï¼š
- åªè¦å±•ç¤ºç”¨çš„å‡ ä¸ªå­—æ®µ
- å‡å°‘æ•°æ®ä¼ è¾“é‡
- æé«˜æŸ¥è¯¢æ•ˆç‡

è¿™é‡Œæ‰‹åŠ¨æŒ‡å®šå­—æ®µï¼Œæ¡ä»¶è¿˜æ˜¯ç”¨Wrapperæ„é€ 
```

### 2.3 è¿›é˜¶æŠ€å·§ï¼šå¤æ‚åœºæ™¯å¤„ç†


**ğŸ“Œ ç¤ºä¾‹3ï¼šå­æŸ¥è¯¢é›†æˆ**
```java
@Select("SELECT u.*, " +
        "(SELECT COUNT(*) FROM orders o WHERE o.user_id = u.id) as order_count " +
        "FROM user u " +
        "${ew.customSqlSegment}")
List<UserOrderDTO> selectUserWithOrderCount(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
```

**ğŸ” åœºæ™¯è¯´æ˜**
```
éœ€æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°é‡

ä¼ ç»Ÿåšæ³•ï¼š
1. æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
2. å¾ªç¯æŸ¥è¯¢æ¯ä¸ªç”¨æˆ·çš„è®¢å•æ•°
â†’ N+1é—®é¢˜ï¼Œæ€§èƒ½å·®

ä¼˜åŒ–æ–¹æ¡ˆï¼š
ç”¨å­æŸ¥è¯¢ä¸€æ¬¡æ€§æŸ¥å‡ºæ¥
â†’ åªæ‰§è¡Œä¸€æ¡SQLï¼Œæ€§èƒ½å¥½
```

**ğŸ“Œ ç¤ºä¾‹4ï¼šå¤šè¡¨å…³è”**
```java
@Select("SELECT u.*, d.dept_name " +
        "FROM user u " +
        "LEFT JOIN department d ON u.dept_id = d.id " +
        "${ew.customSqlSegment}")
List<UserDeptVO> selectUserWithDept(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
å¤šè¡¨æŸ¥è¯¢æ—¶Wrapperæ€ä¹ˆå†™ï¼Ÿ
- Wrapperçš„æ¡ä»¶é»˜è®¤é’ˆå¯¹ä¸»è¡¨ï¼ˆuserï¼‰
- å¦‚æœè¦å…³è”è¡¨æ¡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šè¡¨åˆ«å

ç¤ºä¾‹ï¼š
wrapper.apply("d.dept_name = {0}", "æŠ€æœ¯éƒ¨");
// ç”Ÿæˆï¼šWHERE d.dept_name = 'æŠ€æœ¯éƒ¨'
```

---

## 3. ğŸ“„ XMLåŠ¨æ€SQLé›†æˆæ–¹æ¡ˆ


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦XMLï¼Ÿ


**XML vs æ³¨è§£å¯¹æ¯”**

```
@Selectæ³¨è§£æ–¹å¼ï¼š
ä¼˜ç‚¹ï¼šä»£ç é›†ä¸­ï¼Œç®€å•ç›´è§‚
ç¼ºç‚¹ï¼šå¤æ‚SQLä¸å¥½ç»´æŠ¤ï¼Œæ¢è¡Œå¤šäº†ä»£ç ä¹±

XMLæ–¹å¼ï¼š
ä¼˜ç‚¹ï¼šSQLå¯ä»¥æ ¼å¼åŒ–ï¼Œé€»è¾‘æ¸…æ™°
ç¼ºç‚¹ï¼šéœ€è¦å•ç‹¬ç»´æŠ¤XMLæ–‡ä»¶

å»ºè®®ï¼š
- ç®€å•SQLç”¨æ³¨è§£
- å¤æ‚SQLç”¨XML
```

### 3.2 XMLé…ç½®åŸºç¡€


**ğŸ”¸ Mapperæ¥å£å®šä¹‰**
```java
public interface UserMapper extends BaseMapper<User> {
    // ä¸å†™@Selectï¼Œåœ¨XMLé‡Œå†™SQL
    List<User> selectByCondition(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
}
```

**ğŸ”¸ XMLæ–‡ä»¶ç¼–å†™**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- idå¯¹åº”æ–¹æ³•å -->
    <select id="selectByCondition" resultType="com.example.entity.User">
        SELECT * FROM user
        <!-- è¿™é‡Œæ’å…¥Wrapperæ¡ä»¶ -->
        ${ew.customSqlSegment}
    </select>
    
</mapper>
```

**ğŸ“ æ–‡ä»¶æ”¾å“ªé‡Œï¼Ÿ**
```
resources/
  â””â”€â”€ mapper/
      â””â”€â”€ UserMapper.xml

æˆ–è€…åœ¨application.ymlé…ç½®ï¼š
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
```

### 3.3 åŠ¨æ€SQLæ ‡ç­¾è¯¦è§£


**ğŸ”¸ `<if>` æ ‡ç­¾ï¼šæ¡ä»¶åˆ¤æ–­**
```xml
<select id="searchUser" resultType="User">
    SELECT * FROM user
    WHERE 1=1
    <if test="name != null and name != ''">
        AND name LIKE CONCAT('%', #{name}, '%')
    </if>
    <if test="age != null">
        AND age >= #{age}
    </if>
</select>
```

**ğŸ’­ å°ç™½ç†è§£**
```
<if test="æ¡ä»¶">ï¼šå°±åƒJavaé‡Œçš„ifåˆ¤æ–­
- testé‡Œçš„æ¡ä»¶æˆç«‹ï¼Œå°±åŠ ä¸Šè¿™æ®µSQL
- ä¸æˆç«‹ï¼Œè¿™æ®µSQLå°±ä¸è¦

ä¸ºä»€ä¹ˆå†™ 1=1ï¼Ÿ
WHERE 1=1 æ˜¯ä¸ªå°æŠ€å·§ï¼š
- åé¢çš„æ¡ä»¶éƒ½ç”¨ANDè¿æ¥
- ä¸ç”¨æ‹…å¿ƒç¬¬ä¸€ä¸ªæ¡ä»¶çš„WHEREé—®é¢˜
```

**ğŸ”¸ `<where>` æ ‡ç­¾ï¼šæ™ºèƒ½WHERE**
```xml
<select id="searchUserBetter" resultType="User">
    SELECT * FROM user
    <where>
        <if test="name != null">
            AND name LIKE CONCAT('%', #{name}, '%')
        </if>
        <if test="age != null">
            AND age >= #{age}
        </if>
    </where>
</select>
```

**ğŸ’¡ ä¸ºä»€ä¹ˆç”¨`<where>`æ›´å¥½ï¼Ÿ**
```
<where>æ ‡ç­¾ä¼šè‡ªåŠ¨ï¼š
1. å¦‚æœæœ‰æ¡ä»¶ï¼Œè‡ªåŠ¨åŠ ä¸ŠWHERE
2. å»æ‰ç¬¬ä¸€ä¸ªANDæˆ–OR
3. å¦‚æœæ²¡æ¡ä»¶ï¼Œä¸åŠ WHERE

æ‰€ä»¥ä¸ç”¨å†™ WHERE 1=1 äº†ï¼Œä»£ç æ›´ç®€æ´
```

**ğŸ”¸ `<choose>` æ ‡ç­¾ï¼šå¤šæ¡ä»¶åˆ†æ”¯**
```xml
<select id="searchByType" resultType="User">
    SELECT * FROM user
    <where>
        <choose>
            <when test="searchType == 'name'">
                name LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="searchType == 'phone'">
                phone = #{keyword}
            </when>
            <otherwise>
                email LIKE CONCAT('%', #{keyword}, '%')
            </otherwise>
        </choose>
    </where>
</select>
```

**ğŸ” ç†è§£`<choose>`**
```
ç±»ä¼¼Javaçš„ switch-caseï¼š
- åªä¼šæ‰§è¡Œä¸€ä¸ªåˆ†æ”¯
- ä»ä¸Šå¾€ä¸‹åŒ¹é…
- <otherwise>ç›¸å½“äºdefault

ä½¿ç”¨åœºæ™¯ï¼š
æ ¹æ®ä¸åŒç±»å‹æ‰§è¡Œä¸åŒæŸ¥è¯¢é€»è¾‘
```

### 3.4 Wrapperä¸XMLç»“åˆ


**ğŸ“Œ é«˜çº§é›†æˆç¤ºä¾‹**
```xml
<select id="complexSearch" resultType="UserVO">
    SELECT 
        u.id,
        u.name,
        u.age,
        d.dept_name,
        (SELECT COUNT(*) FROM orders WHERE user_id = u.id) as order_count
    FROM user u
    LEFT JOIN department d ON u.dept_id = d.id
    
    <!-- åŠ¨æ€æ¡ä»¶éƒ¨åˆ† -->
    <where>
        <!-- å›ºå®šæ¡ä»¶ -->
        u.status = 1
        
        <!-- åŠ¨æ€æ¡ä»¶ï¼šå¹´é¾„èŒƒå›´ -->
        <if test="minAge != null">
            AND u.age >= #{minAge}
        </if>
        <if test="maxAge != null">
            AND u.age &lt;= #{maxAge}
        </if>
        
        <!-- Wrapperæ¡ä»¶ -->
        ${ew.customSqlSegment}
    </where>
    
    ORDER BY u.create_time DESC
</select>
```

**ğŸ’­ è¿™ä¸ªä¾‹å­åŒ…å«äº†ä»€ä¹ˆï¼Ÿ**
```
âœ… å¤šè¡¨å…³è”ï¼ˆLEFT JOINï¼‰
âœ… å­æŸ¥è¯¢ï¼ˆè®¢å•æ•°é‡ç»Ÿè®¡ï¼‰
âœ… å›ºå®šæ¡ä»¶ï¼ˆstatus = 1ï¼‰
âœ… åŠ¨æ€æ¡ä»¶ï¼ˆå¹´é¾„èŒƒå›´ï¼‰
âœ… Wrapperçµæ´»æ¡ä»¶
âœ… æ’åº

è¿™å°±æ˜¯å®é™…é¡¹ç›®ä¸­æœ€å¸¸è§çš„å¤æ‚æŸ¥è¯¢ï¼
```

---

## 4. ğŸª å¤æ‚ä¸šåŠ¡æŸ¥è¯¢åœºæ™¯å®æˆ˜


### 4.1 åœºæ™¯1ï¼šç”µå•†å•†å“æœç´¢


**ğŸ›ï¸ éœ€æ±‚åˆ†æ**
```
ç”¨æˆ·æœç´¢å•†å“æ—¶å¯èƒ½ï¼š
1. è¾“å…¥å…³é”®è¯ï¼ˆæœç´¢åç§°æˆ–æè¿°ï¼‰
2. é€‰æ‹©åˆ†ç±»
3. é€‰æ‹©ä»·æ ¼åŒºé—´
4. é€‰æ‹©å“ç‰Œ
5. æŒ‰é”€é‡/ä»·æ ¼/è¯„åˆ†æ’åº

è¿™äº›æ¡ä»¶éƒ½æ˜¯å¯é€‰çš„ï¼Œç»„åˆèµ·æ¥å¾ˆå¤æ‚
```

**ğŸ”¸ Mapperæ–¹æ³•**
```java
@Select("<script>" +
        "SELECT p.*, c.category_name, b.brand_name " +
        "FROM product p " +
        "LEFT JOIN category c ON p.category_id = c.id " +
        "LEFT JOIN brand b ON p.brand_id = b.id " +
        "<where> " +
        "  <if test='keyword != null'> " +
        "    AND (p.name LIKE CONCAT('%',#{keyword},'%') " +
        "         OR p.description LIKE CONCAT('%',#{keyword},'%')) " +
        "  </if> " +
        "  ${ew.customSqlSegment} " +
        "</where> " +
        "ORDER BY " +
        "<choose> " +
        "  <when test='sortType == \"price\"'>p.price ${sortOrder}</when> " +
        "  <when test='sortType == \"sales\"'>p.sales ${sortOrder}</when> " +
        "  <otherwise>p.create_time DESC</otherwise> " +
        "</choose>" +
        "</script>")
List<ProductVO> searchProducts(
    @Param("keyword") String keyword,
    @Param("sortType") String sortType,
    @Param("sortOrder") String sortOrder,
    @Param(Constants.WRAPPER) Wrapper<Product> wrapper
);
```

**ğŸ’¡ `<script>`æ ‡ç­¾æ˜¯ä»€ä¹ˆï¼Ÿ**
```
åœ¨@Selectæ³¨è§£ä¸­ä½¿ç”¨åŠ¨æ€SQLï¼Œå¿…é¡»ç”¨<script>åŒ…è£¹
è¿™æ ·MyBatisæ‰çŸ¥é“è¿™æ˜¯åŠ¨æ€SQLï¼Œä¸æ˜¯æ™®é€šå­—ç¬¦ä¸²

<script>
  è¿™é‡Œå¯ä»¥ç”¨ <if> <where> <choose> ç­‰æ ‡ç­¾
</script>
```

**ğŸ”¸ ä¸šåŠ¡è°ƒç”¨**
```java
public List<ProductVO> search(ProductSearchDTO dto) {
    LambdaQueryWrapper<Product> wrapper = new LambdaQueryWrapper<>();
    
    // åˆ†ç±»æ¡ä»¶
    if (dto.getCategoryId() != null) {
        wrapper.eq(Product::getCategoryId, dto.getCategoryId());
    }
    
    // ä»·æ ¼åŒºé—´
    if (dto.getMinPrice() != null) {
        wrapper.ge(Product::getPrice, dto.getMinPrice());
    }
    if (dto.getMaxPrice() != null) {
        wrapper.le(Product::getPrice, dto.getMaxPrice());
    }
    
    // å“ç‰Œ
    if (CollUtil.isNotEmpty(dto.getBrandIds())) {
        wrapper.in(Product::getBrandId, dto.getBrandIds());
    }
    
    return productMapper.searchProducts(
        dto.getKeyword(),
        dto.getSortType(),
        dto.getSortOrder(),
        wrapper
    );
}
```

### 4.2 åœºæ™¯2ï¼šæŠ¥è¡¨ç»Ÿè®¡æŸ¥è¯¢


**ğŸ“Š éœ€æ±‚ï¼šç”¨æˆ·æ¶ˆè´¹ç»Ÿè®¡**
```
ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„ï¼š
- æ€»è®¢å•æ•°
- æ€»æ¶ˆè´¹é‡‘é¢
- å¹³å‡è®¢å•é‡‘é¢
- æœ€è¿‘è´­ä¹°æ—¶é—´

æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ã€ç”¨æˆ·ç±»å‹ç­‰æ¡ä»¶ç­›é€‰
```

**ğŸ”¸ XMLæ–¹å¼å®ç°**
```xml
<select id="userConsumeStats" resultType="UserStatsVO">
    SELECT 
        u.id,
        u.name,
        COUNT(o.id) as order_count,
        COALESCE(SUM(o.amount), 0) as total_amount,
        COALESCE(AVG(o.amount), 0) as avg_amount,
        MAX(o.create_time) as last_order_time
    FROM user u
    LEFT JOIN orders o ON u.id = o.user_id
    <where>
        <if test="startTime != null">
            AND o.create_time >= #{startTime}
        </if>
        <if test="endTime != null">
            AND o.create_time &lt;= #{endTime}
        </if>
        <if test="userType != null">
            AND u.user_type = #{userType}
        </if>
        ${ew.customSqlSegment}
    </where>
    GROUP BY u.id
    HAVING COUNT(o.id) > 0
    ORDER BY total_amount DESC
</select>
```

**âš ï¸ æ³¨æ„ç‚¹**
```
COALESCEå‡½æ•°ï¼šå¤„ç†NULLå€¼
- COALESCE(SUM(o.amount), 0)
- å¦‚æœç”¨æˆ·æ²¡è®¢å•ï¼ŒSUMè¿”å›NULL
- COALESCEæŠŠNULLè½¬æˆ0

&lt; å’Œ &gt;ï¼šXMLä¸­çš„è½¬ä¹‰
- < å†™æˆ &lt;
- > å†™æˆ &gt;
- å¦åˆ™XMLè§£æä¼šæŠ¥é”™
```

### 4.3 åœºæ™¯3ï¼šæ•°æ®å¯¼å‡ºæŸ¥è¯¢


**ğŸ“¥ éœ€æ±‚ï¼šå¯¼å‡ºç”¨æˆ·åˆ—è¡¨ï¼ˆå¯èƒ½å‡ ä¸‡æ¡ï¼‰**
```
é—®é¢˜ï¼š
- æ•°æ®é‡å¤§ï¼Œä¸€æ¬¡æŸ¥å…¨éƒ¨ä¼šOOM
- éœ€è¦åˆ†æ‰¹æŸ¥è¯¢
- è¿˜è¦ä¿æŒæŸ¥è¯¢æ¡ä»¶ä¸€è‡´

è§£å†³ï¼šæ¸¸æ ‡æŸ¥è¯¢ + Wrapper
```

**ğŸ”¸ å®ç°æ–¹å¼**
```java
@Options(resultSetType = ResultSetType.FORWARD_ONLY, fetchSize = 1000)
@Select("SELECT * FROM user ${ew.customSqlSegment}")
void selectForExport(
    @Param(Constants.WRAPPER) Wrapper<User> wrapper,
    ResultHandler<User> handler
);
```

**ğŸ”¸ ä½¿ç”¨æ–¹æ³•**
```java
public void exportUsers(Wrapper<User> wrapper) {
    List<User> batchList = new ArrayList<>();
    
    userMapper.selectForExport(wrapper, resultContext -> {
        User user = resultContext.getResultObject();
        batchList.add(user);
        
        // æ¯1000æ¡å¤„ç†ä¸€æ¬¡
        if (batchList.size() >= 1000) {
            exportToExcel(batchList); // å†™å…¥Excel
            batchList.clear();
        }
    });
    
    // å¤„ç†å‰©ä½™æ•°æ®
    if (!batchList.isEmpty()) {
        exportToExcel(batchList);
    }
}
```

**ğŸ’­ ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ**
```
ResultHandlerï¼šç»“æœå¤„ç†å™¨
- æ¯æŸ¥å‡ºä¸€æ¡å°±å›è°ƒä¸€æ¬¡
- ä¸ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜
- é€‚åˆå¤„ç†å¤§æ•°æ®é‡

fetchSize = 1000ï¼š
- å‘Šè¯‰æ•°æ®åº“æ¯æ¬¡è¿”å›1000æ¡
- å¹³è¡¡å†…å­˜å’Œæ•ˆç‡
```

---

## 5. ğŸ“Š æ€§èƒ½å¯¹æ¯”åˆ†æ


### 5.1 ä¸åŒæ–¹æ¡ˆçš„æ€§èƒ½è¡¨ç°


**ğŸ”¬ æµ‹è¯•åœºæ™¯**
```
æ•°æ®é‡ï¼šuserè¡¨100ä¸‡æ¡è®°å½•
æŸ¥è¯¢ï¼šå¸¦å¤šæ¡ä»¶æŸ¥è¯¢ï¼Œè¿”å›1000æ¡ç»“æœ
æµ‹è¯•10æ¬¡å–å¹³å‡å€¼
```

**ğŸ“ˆ æµ‹è¯•ç»“æœ**

| å®ç°æ–¹å¼ | **å¹³å‡è€—æ—¶** | **SQLç”Ÿæˆè€—æ—¶** | **å†…å­˜å ç”¨** | **ä»£ç è¡Œæ•°** |
|---------|------------|---------------|------------|------------|
| çº¯Wrapper | `85ms` | `5ms` | `çº¦12MB` | `15è¡Œ` |
| æ³¨è§£+Wrapper | `82ms` | `3ms` | `çº¦11MB` | `20è¡Œ` |
| XML+åŠ¨æ€SQL | `80ms` | `2ms` | `çº¦10MB` | `25è¡Œ` |
| çº¯åŸç”ŸSQL | `78ms` | `<1ms` | `çº¦9MB` | `30è¡Œ` |

**ğŸ” æ€§èƒ½å·®å¼‚åˆ†æ**
```
âœ… æ‰§è¡Œè€—æ—¶å·®å¼‚ä¸å¤§ï¼ˆå‡ æ¯«ç§’ï¼‰
  - ä¸»è¦æ—¶é—´åœ¨æ•°æ®åº“æŸ¥è¯¢
  - SQLç”Ÿæˆçš„å½±å“å¾ˆå°

âœ… å†…å­˜å ç”¨ç›¸è¿‘
  - éƒ½æ˜¯æŸ¥åŒæ ·çš„æ•°æ®
  - å·®å¼‚åœ¨å¯¹è±¡å°è£…

âœ… ä»£ç é‡ï¼š
  - Wrapperæœ€ç®€æ´
  - åŸç”ŸSQLæœ€å†—é•¿
```

### 5.2 å…·ä½“åœºæ™¯æ€§èƒ½å»ºè®®


**ğŸ“Œ ç®€å•æŸ¥è¯¢ï¼ˆå•è¡¨ï¼Œæ¡ä»¶å°‘äº3ä¸ªï¼‰**
```
æ¨èï¼šçº¯Wrapper
ç†ç”±ï¼š
- ä»£ç ç®€æ´
- æ€§èƒ½å¤Ÿç”¨
- ç±»å‹å®‰å…¨

ç¤ºä¾‹ï¼š
wrapper.eq(User::getStatus, 1)
       .like(User::getName, "å¼ ");
```

**ğŸ“Œ ä¸­ç­‰å¤æ‚åº¦ï¼ˆå•è¡¨ï¼Œæ¡ä»¶3-10ä¸ªï¼‰**
```
æ¨èï¼š@Select + Wrapper
ç†ç”±ï¼š
- å¯ä»¥è‡ªå®šä¹‰æŸ¥è¯¢å­—æ®µ
- çµæ´»æ€§å¥½
- æ€§èƒ½ä¸é”™

ç¤ºä¾‹ï¼š
@Select("SELECT id, name, age FROM user ${ew.customSqlSegment}")
```

**ğŸ“Œ å¤æ‚æŸ¥è¯¢ï¼ˆå¤šè¡¨ï¼Œå­æŸ¥è¯¢ï¼Œèšåˆï¼‰**
```
æ¨èï¼šXMLåŠ¨æ€SQL
ç†ç”±ï¼š
- SQLå¯æ ¼å¼åŒ–ï¼Œæ˜“ç»´æŠ¤
- æ”¯æŒå¤æ‚é€»è¾‘
- æ€§èƒ½æœ€ä¼˜

ä¸æ¨èï¼šå¤æ‚çš„@Select
- å­—ç¬¦ä¸²SQLéš¾ç»´æŠ¤
- æ¢è¡Œå¤šäº†ä»£ç ä¹±
```

**ğŸ“Œ è¶…é«˜æ€§èƒ½è¦æ±‚**
```
è€ƒè™‘ï¼šçº¯åŸç”ŸSQL + æ‰‹åŠ¨ä¼˜åŒ–
- ç›´æ¥æ§åˆ¶SQLç»†èŠ‚
- å¯ä»¥ç”¨æ•°æ®åº“ç‰¹æ€§
- å‡å°‘æ¡†æ¶å¼€é”€

ä½†è¦æ³¨æ„ï¼š
- å¤±å»ç±»å‹å®‰å…¨
- ç»´æŠ¤æˆæœ¬é«˜
- åªåœ¨ç“¶é¢ˆç‚¹ä½¿ç”¨
```

### 5.3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§


**ğŸ”¸ ç´¢å¼•é…åˆ**
```java
// WrapperæŸ¥è¯¢æ—¶ï¼Œæ³¨æ„ç´¢å¼•å­—æ®µ
wrapper.eq(User::getStatus, 1)      // statusæœ‰ç´¢å¼•ï¼Œå¿«
       .like(User::getName, "å¼ ");   // å‰ç¼€æ¨¡ç³Šï¼Œèµ°ä¸äº†ç´¢å¼•ï¼Œæ…¢

// ä¼˜åŒ–ï¼šèƒ½ç”¨=å°±ä¸ç”¨LIKE
wrapper.eq(User::getStatus, 1)
       .eq(User::getName, "å¼ ä¸‰");   // ç²¾ç¡®åŒ¹é…ï¼Œèƒ½ç”¨ç´¢å¼•
```

**ğŸ”¸ å­—æ®µè£å‰ª**
```java
// âŒ ä¸å¥½ï¼šæŸ¥æ‰€æœ‰å­—æ®µ
wrapper.eq(User::getStatus, 1);

// âœ… æ›´å¥½ï¼šåªæŸ¥éœ€è¦çš„å­—æ®µ
@Select("SELECT id, name FROM user ${ew.customSqlSegment}")
// å‡å°‘æ•°æ®ä¼ è¾“é‡
```

**ğŸ”¸ åˆ†é¡µæŸ¥è¯¢**
```java
// å¤§æ•°æ®é‡å¿…é¡»åˆ†é¡µ
Page<User> page = new Page<>(1, 20);
userMapper.selectPage(page, wrapper);

// é¿å…ï¼š
// List<User> all = userMapper.selectList(wrapper);
// å¯èƒ½æŸ¥å‡ºå‡ åä¸‡æ¡ï¼ŒOOM
```

---

## 6. âš–ï¸ å¼€å‘æ•ˆç‡æƒè¡¡


### 6.1 å¼€å‘é€Ÿåº¦å¯¹æ¯”


**ğŸ“Š å¼€å‘æ—¶é—´ä¼°ç®—**

```
éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªå¸¦5ä¸ªæ¡ä»¶çš„ç”¨æˆ·æœç´¢åŠŸèƒ½

æ–¹æ¡ˆä¸€ï¼šçº¯Wrapper
å¼€å‘æ—¶é—´ï¼š10åˆ†é’Ÿ
ä»£ç é‡ï¼š15è¡Œ
å­¦ä¹ æˆæœ¬ï¼šä½

æ–¹æ¡ˆäºŒï¼š@Select + Wrapper  
å¼€å‘æ—¶é—´ï¼š15åˆ†é’Ÿ
ä»£ç é‡ï¼š25è¡Œ
å­¦ä¹ æˆæœ¬ï¼šä¸­

æ–¹æ¡ˆä¸‰ï¼šXMLåŠ¨æ€SQL
å¼€å‘æ—¶é—´ï¼š30åˆ†é’Ÿï¼ˆå«XMLé…ç½®ï¼‰
ä»£ç é‡ï¼š40è¡Œ
å­¦ä¹ æˆæœ¬ï¼šé«˜

æ–¹æ¡ˆå››ï¼šçº¯åŸç”ŸSQL
å¼€å‘æ—¶é—´ï¼š20åˆ†é’Ÿ
ä»£ç é‡ï¼š50è¡Œ
å­¦ä¹ æˆæœ¬ï¼šä½
```

**ğŸ’¡ é€‰æ‹©å»ºè®®**
```
åˆæœŸå¼€å‘ï¼ˆå¿«é€ŸéªŒè¯ï¼‰ï¼š
â†’ ç”¨Wrapperï¼Œå¿«é€Ÿå‡ºç»“æœ

ä¸­æœŸè¿­ä»£ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰ï¼š
â†’ ç®€å•ç”¨Wrapperï¼Œå¤æ‚ç”¨@Select

åæœŸä¼˜åŒ–ï¼ˆæ€§èƒ½è°ƒä¼˜ï¼‰ï¼š
â†’ ç“¶é¢ˆå¤„ç”¨XMLæˆ–åŸç”ŸSQL
```

### 6.2 ä»£ç å¯è¯»æ€§å¯¹æ¯”


**ğŸ“ åŒæ ·çš„åŠŸèƒ½ï¼Œä¸åŒå†™æ³•**

**å†™æ³•1ï¼šçº¯Wrapper**
```java
public List<User> search(UserSearchDTO dto) {
    LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
    wrapper.like(StrUtil.isNotBlank(dto.getName()), User::getName, dto.getName())
           .ge(dto.getMinAge() != null, User::getAge, dto.getMinAge())
           .eq(dto.getStatus() != null, User::getStatus, dto.getStatus());
    return list(wrapper);
}
```
**ä¼˜ç‚¹**ï¼šé€»è¾‘æ¸…æ™°ï¼Œä¸€ç›®äº†ç„¶  
**ç¼ºç‚¹**ï¼šåªèƒ½å¤„ç†ç®€å•åœºæ™¯

**å†™æ³•2ï¼š@Select + Wrapper**
```java
@Select("SELECT u.*, d.dept_name FROM user u " +
        "LEFT JOIN dept d ON u.dept_id = d.id " +
        "${ew.customSqlSegment}")
List<UserVO> search(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
```
**ä¼˜ç‚¹**ï¼šèƒ½çœ‹åˆ°å®Œæ•´SQLç»“æ„  
**ç¼ºç‚¹**ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸å¥½æ ¼å¼åŒ–

**å†™æ³•3ï¼šXMLåŠ¨æ€SQL**
```xml
<select id="search" resultType="UserVO">
    SELECT 
        u.*,
        d.dept_name
    FROM user u
    LEFT JOIN dept d ON u.dept_id = d.id
    <where>
        <if test="name != null">
            AND u.name LIKE CONCAT('%', #{name}, '%')
        </if>
        ${ew.customSqlSegment}
    </where>
</select>
```
**ä¼˜ç‚¹**ï¼šæ ¼å¼æ¸…æ™°ï¼Œæ˜“è¯»æ˜“æ”¹  
**ç¼ºç‚¹**ï¼šè¦åˆ‡æ¢æ–‡ä»¶æŸ¥çœ‹

### 6.3 å›¢é˜Ÿåä½œè€ƒè™‘


**ğŸ‘¥ å›¢é˜Ÿåœºæ™¯é€‰æ‹©**

```
ğŸ”¸ æ–°æ‰‹è¾ƒå¤šçš„å›¢é˜Ÿ
æ¨èï¼šWrapperä¸ºä¸»
- ç±»å‹å®‰å…¨ï¼Œä¸æ˜“å‡ºé”™
- IDEæç¤ºå‹å¥½
- ä¸Šæ‰‹å¿«

ğŸ”¸ ç»éªŒä¸°å¯Œçš„å›¢é˜Ÿ  
æ¨èï¼šWrapper + XMLæ··åˆ
- ç®€å•ç”¨Wrapperæå‡æ•ˆç‡
- å¤æ‚ç”¨XMLä¿è¯å¯ç»´æŠ¤æ€§
- å„å–æ‰€é•¿

ğŸ”¸ æ€§èƒ½è¦æ±‚æé«˜çš„é¡¹ç›®
æ¨èï¼šåŸç”ŸSQL + æ‰‹åŠ¨ä¼˜åŒ–
- ç›´æ¥æ§åˆ¶SQL
- DBAå¯ä»¥å‚ä¸ä¼˜åŒ–
- ä½†è¦åšå¥½æ–‡æ¡£
```

**ğŸ“‹ å›¢é˜Ÿè§„èŒƒå»ºè®®**
```
åˆ¶å®šè§„èŒƒï¼š
1. å•è¡¨ç®€å•æŸ¥è¯¢ï¼šç”¨Wrapper
2. å¤šè¡¨æˆ–å¤æ‚é€»è¾‘ï¼šç”¨XML
3. æ€§èƒ½ç“¶é¢ˆç‚¹ï¼šåŸç”ŸSQL + æ³¨é‡Š

è¿™æ ·ï¼š
âœ… é™ä½å­¦ä¹ æˆæœ¬
âœ… ä»£ç é£æ ¼ç»Ÿä¸€  
âœ… ç»´æŠ¤æœ‰ç« å¯å¾ª
```

---

## 7. ğŸ› ï¸ ç»´æŠ¤æ€§è€ƒé‡


### 7.1 é•¿æœŸç»´æŠ¤æˆæœ¬


**ğŸ“ˆ ç»´æŠ¤æˆæœ¬å¯¹æ¯”**

| æ–¹æ¡ˆ | **åˆæœŸå¼€å‘** | **éœ€æ±‚å˜æ›´** | **Bugä¿®å¤** | **æ€§èƒ½ä¼˜åŒ–** | **æ–°äººæ¥æ‰‹** |
|------|-----------|------------|-----------|------------|------------|
| **çº¯Wrapper** | `âœ…å¿«` | `âœ…å®¹æ˜“` | `âœ…ç›´è§‚` | `âŒå—é™` | `âœ…ç®€å•` |
| **@Select+Wrapper** | `âš–ï¸ä¸­ç­‰` | `âš–ï¸ä¸€èˆ¬` | `âš–ï¸è¿˜è¡Œ` | `âœ…å¯ä»¥` | `âš–ï¸éœ€å­¦ä¹ ` |
| **XMLåŠ¨æ€SQL** | `âŒæ…¢` | `âœ…çµæ´»` | `âœ…æ¸…æ™°` | `âœ…å®Œå…¨å¯æ§` | `âŒè¦ç†è§£XML` |
| **çº¯åŸç”ŸSQL** | `âš–ï¸ä¸­ç­‰` | `âŒå­—ç¬¦ä¸²æ‹¼æ¥æ˜“é”™` | `âŒè¦æ‰¾å…¨æ‰€æœ‰SQL` | `âœ…æœ€çµæ´»` | `âš–ï¸SQLèƒ½åŠ›è¦æ±‚é«˜` |

### 7.2 å®é™…ç»´æŠ¤åœºæ™¯


**ğŸ”¸ åœºæ™¯1ï¼šéœ€æ±‚å˜æ›´**
```
åŸéœ€æ±‚ï¼šæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
æ–°éœ€æ±‚ï¼šåŠ ä¸Šéƒ¨é—¨åç§°

Wrapperæ–¹å¼ï¼š
// âŒ æ”¹ä¸äº†ï¼Œå•è¡¨æŸ¥è¯¢åšä¸åˆ°å…³è”
// è¦æ”¹æˆXMLæˆ–@Select

@Selectæ–¹å¼ï¼š
// âœ… åŠ ä¸ªJOINå°±è¡Œ
@Select("SELECT u.*, d.dept_name FROM user u " +
        "LEFT JOIN dept d ON u.dept_id = d.id " +
        "${ew.customSqlSegment}")

XMLæ–¹å¼ï¼š
<!-- âœ… æ”¹èµ·æ¥æœ€æ¸…æ¥š -->
<select id="selectList">
    SELECT u.*, d.dept_name  -- åŠ è¿™ä¸€ä¸ªå­—æ®µ
    FROM user u
    LEFT JOIN dept d ON u.dept_id = d.id  -- åŠ è¿™è¡ŒJOIN
    ${ew.customSqlSegment}
</select>
```

**ğŸ”¸ åœºæ™¯2ï¼šæ€§èƒ½ä¼˜åŒ–**
```
é—®é¢˜ï¼šæŸ¥è¯¢æ…¢ï¼Œè¦åŠ ç´¢å¼•æç¤º

Wrapperæ–¹å¼ï¼š
// âŒ æ— æ³•åŠ ç´¢å¼•æç¤º
wrapper.eq(User::getStatus, 1);

@Selectæ–¹å¼ï¼š
// âœ… å¯ä»¥åŠ 
@Select("SELECT * FROM user USE INDEX(idx_status) " +
        "${ew.customSqlSegment}")

XMLæ–¹å¼ï¼š
<!-- âœ… æœ€çµæ´» -->
<select id="selectList">
    SELECT * FROM user USE INDEX(idx_status)
    ${ew.customSqlSegment}
</select>
```

**ğŸ”¸ åœºæ™¯3ï¼šBugæ’æŸ¥**
```
é—®é¢˜ï¼šæŸ¥è¯¢ç»“æœä¸å¯¹ï¼Œè¦çœ‹ç”Ÿæˆçš„SQL

Wrapperï¼š
// å¼€å¯SQLæ—¥å¿—
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
// èƒ½çœ‹åˆ°å®Œæ•´SQL

@Selectï¼š
// ç›´æ¥çœ‹æ³¨è§£é‡Œçš„SQL
// ç»“åˆæ—¥å¿—çœ‹Wrapperéƒ¨åˆ†

XMLï¼š
// çœ‹XMLæ–‡ä»¶
// æœ€æ¸…æ™°ï¼Œèƒ½æ ¼å¼åŒ–
```

### 7.3 å¯ç»´æŠ¤æ€§æœ€ä½³å®è·µ


**âœ… å¥½çš„å®è·µ**
```java
// 1. ç»Ÿä¸€é£æ ¼
// åœ¨Mapperæ¥å£é¡¶éƒ¨æ³¨é‡Šè¯´æ˜ä½¿ç”¨æ–¹å¼
/**
 * ç”¨æˆ·Mapper
 * - ç®€å•æŸ¥è¯¢ï¼šç»§æ‰¿çš„BaseMapperæ–¹æ³•
 * - å¤æ‚æŸ¥è¯¢ï¼šXMLæ–‡ä»¶ UserMapper.xml
 * - ç‰¹æ®ŠæŸ¥è¯¢ï¼šè§ä¸‹æ–¹@Selectæ³¨è§£æ–¹æ³•
 */
public interface UserMapper extends BaseMapper<User> {
    
    // 2. æ–¹æ³•å‘½åæ¸…æ™°
    // âŒ ä¸å¥½
    List<User> select1(Wrapper<User> wrapper);
    
    // âœ… å¥½  
    List<UserVO> selectUserWithDept(Wrapper<User> wrapper);
    
    // 3. å¤æ‚SQLåŠ æ³¨é‡Š
    /**
     * æŸ¥è¯¢ç”¨æˆ·åŠéƒ¨é—¨ä¿¡æ¯
     * å…³è”ï¼šuser LEFT JOIN department
     * ç”¨äºï¼šç”¨æˆ·åˆ—è¡¨é¡µå±•ç¤º
     */
    @Select("SELECT u.*, d.dept_name FROM user u " +
            "LEFT JOIN department d ON u.dept_id = d.id " +
            "${ew.customSqlSegment}")
    List<UserVO> selectUserWithDept(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
}
```

**âœ… XMLæ–‡ä»¶ç»„ç»‡**
```xml
<!-- æ–‡ä»¶å¤´éƒ¨åŠ æ³¨é‡Š -->
<!--
  UserMapper.xml
  ç”¨æˆ·ç›¸å…³å¤æ‚æŸ¥è¯¢SQL
  
  åŒ…å«æŸ¥è¯¢ï¼š
  1. selectUserStats - ç”¨æˆ·ç»Ÿè®¡
  2. selectUserWithOrders - ç”¨æˆ·è®¢å•å…³è”
  
  ç»´æŠ¤äººï¼šå¼ ä¸‰
  æœ€åæ›´æ–°ï¼š2024-01-20
-->
<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- æ¯ä¸ªæŸ¥è¯¢åŠ è¯´æ˜ -->
    <!-- ç”¨æˆ·ç»Ÿè®¡æŸ¥è¯¢ï¼šåŒ…å«è®¢å•æ•°ã€æ¶ˆè´¹é‡‘é¢ç­‰ -->
    <select id="selectUserStats" resultType="UserStatsVO">
        SELECT 
            u.id,
            COUNT(o.id) as order_count,
            SUM(o.amount) as total_amount
        FROM user u
        LEFT JOIN orders o ON u.id = o.user_id
        ${ew.customSqlSegment}
        GROUP BY u.id
    </select>
    
</mapper>
```

**âš ï¸ è¦é¿å…çš„é—®é¢˜**
```
âŒ ä¸è¦ï¼šXMLå’Œæ³¨è§£æ··ç”¨åŒä¸€ä¸ªæŸ¥è¯¢
// åŒä¸€ä¸ªæ–¹æ³•ï¼Œä¸€ä¼šå„¿XMLä¸€ä¼šå„¿æ³¨è§£ï¼Œå®¹æ˜“ä¹±

âŒ ä¸è¦ï¼šåŠ¨æ€SQLå†™åœ¨@Selecté‡Œè¶…è¿‡5è¡Œ
// å¤ªé•¿ä¸å¥½ç»´æŠ¤ï¼Œåº”è¯¥ç”¨XML

âŒ ä¸è¦ï¼šæ²¡æœ‰æ³¨é‡Šçš„å¤æ‚SQL
// è¿‡å‡ ä¸ªæœˆè‡ªå·±éƒ½çœ‹ä¸æ‡‚

âŒ ä¸è¦ï¼šæ‰€æœ‰æŸ¥è¯¢éƒ½ç”¨åŸç”ŸSQL
// å¤±å»MPçš„ä¾¿åˆ©æ€§
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„çŸ¥è¯†


**ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ**
```
âœ… åŠ¨æ€SQLï¼šæ ¹æ®æ¡ä»¶è‡ªåŠ¨ç»„è£…SQL
âœ… Wrapperï¼šMPçš„æ¡ä»¶æ„é€ å™¨ï¼Œç±»å‹å®‰å…¨
âœ… ${ew.customSqlSegment}ï¼šWrapperæ¡ä»¶æ’å…¥ç‚¹
âœ… @Param(Constants.WRAPPER)ï¼šæ ‡è®°Wrapperå‚æ•°
âœ… <script>æ ‡ç­¾ï¼šæ³¨è§£ä¸­ä½¿ç”¨åŠ¨æ€SQLçš„å…³é”®
```

**ğŸ¯ ä¸‰ç§é›†æˆæ–¹å¼**

| æ–¹å¼ | **è¯­æ³•** | **åœºæ™¯** | **éš¾åº¦** |
|------|---------|---------|---------|
| **@Select + Wrapper** | `@Select("... ${ew.customSqlSegment}")` | `ä¸­ç­‰å¤æ‚åº¦` | `â­â­` |
| **XMLåŠ¨æ€SQL** | `<select>...</select> + ${ew.customSqlSegment}` | `å¤æ‚æŸ¥è¯¢` | `â­â­â­` |
| **æ··åˆä½¿ç”¨** | `å›ºå®šSQL + åŠ¨æ€æ¡ä»¶ + Wrapper` | `çµæ´»åº”å¯¹` | `â­â­â­â­` |

### 8.2 å®æˆ˜é€‰æ‹©æŒ‡å—


**ğŸ” å¿«é€Ÿå†³ç­–æ ‘**
```
å¼€å§‹æŸ¥è¯¢
   â†“
æ˜¯å•è¡¨å—ï¼Ÿ
   â”œâ”€ æ˜¯ â†’ æ¡ä»¶ç®€å•å—ï¼Ÿ
   â”‚        â”œâ”€ æ˜¯ â†’ ç”¨Wrapper âœ…
   â”‚        â””â”€ å¦ â†’ ç”¨@Select + Wrapper
   â””â”€ å¦ â†’ æ˜¯å¤šè¡¨å…³è”å—ï¼Ÿ
            â”œâ”€ æ˜¯ â†’ ç”¨XMLåŠ¨æ€SQL âœ…
            â””â”€ å¦ â†’ ç”¨åŸç”ŸSQL
```

**ğŸ’¡ è®°å¿†å£è¯€**
```
ç®€å•å•è¡¨ç”¨Wrapperï¼Œ
å¤æ‚å¤šè¡¨XMLæï¼Œ
@Selectçµæ´»ä¸­é—´æŒ‘ï¼Œ
æ€§èƒ½è¦æ±‚åŸç”ŸSQLå¥½ã€‚
```

### 8.3 å¸¸è§é—®é¢˜FAQ


**â“ Q1ï¼š${} å’Œ #{} æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
```
${ew.customSqlSegment}ï¼š
- ç›´æ¥æ‹¼æ¥SQL
- ç”¨äºåŠ¨æ€SQLç‰‡æ®µ
- Wrapperç”Ÿæˆçš„WHEREæ¡ä»¶

#{name}ï¼š
- é¢„ç¼–è¯‘å ä½ç¬¦
- é˜²SQLæ³¨å…¥
- ç”¨äºå‚æ•°å€¼

è®°ä½ï¼š
- ${}æ‹¼æ¥SQLç»“æ„
- #{}ä¼ é€’å‚æ•°å€¼
```

**â“ Q2ï¼šä¸ºä»€ä¹ˆWrapperæ¡ä»¶ä¸ç”Ÿæ•ˆï¼Ÿ**
```
å¸¸è§åŸå› ï¼š
1. å¿˜è®°åŠ  @Param(Constants.WRAPPER)
2. æ²¡å†™ ${ew.customSqlSegment}
3. Wrapperæ¡ä»¶å†™é”™äº†

æ£€æŸ¥ï¼š
// âœ… æ­£ç¡®å†™æ³•
List<User> select(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
@Select("SELECT * FROM user ${ew.customSqlSegment}")
```

**â“ Q3ï¼šXMLå’Œæ³¨è§£å¯ä»¥æ··ç”¨å—ï¼Ÿ**
```
å¯ä»¥ï¼Œä½†è¦æ³¨æ„ï¼š
- åŒä¸€ä¸ªæ–¹æ³•åªèƒ½ç”¨ä¸€ç§æ–¹å¼
- ç®€å•çš„ç”¨æ³¨è§£
- å¤æ‚çš„ç”¨XML
- ä¸è¦æ¥å›åˆ‡æ¢ï¼Œå®¹æ˜“ä¹±
```

**â“ Q4ï¼šæ€ä¹ˆè°ƒè¯•ç”Ÿæˆçš„SQLï¼Ÿ**
```
æ–¹æ³•1ï¼šå¼€å¯SQLæ—¥å¿—
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

æ–¹æ³•2ï¼šæ‰“æ–­ç‚¹çœ‹
Wrapper wrapper = new LambdaQueryWrapper<>();
// æ‰“æ–­ç‚¹ï¼Œçœ‹ wrapper.getSqlSegment()

æ–¹æ³•3ï¼šç”¨P6Spy
- æ‰“å°å®Œæ•´çš„SQLï¼ˆåŒ…æ‹¬å‚æ•°å€¼ï¼‰
- æ–¹ä¾¿å¤åˆ¶åˆ°æ•°æ®åº“æ‰§è¡Œ
```

### 8.4 å­¦ä¹ å»ºè®®


**ğŸ“š å­¦ä¹ è·¯çº¿**
```
ç¬¬1æ­¥ï¼šæŒæ¡WrapperåŸºæœ¬ç”¨æ³•
- ç»ƒä¹ å„ç§æ¡ä»¶ç»„åˆ
- ç†Ÿæ‚‰lambdaå†™æ³•

ç¬¬2æ­¥ï¼šå­¦ä¹ @Selecté›†æˆ
- ç®€å•çš„å…³è”æŸ¥è¯¢
- è‡ªå®šä¹‰æŸ¥è¯¢å­—æ®µ

ç¬¬3æ­¥ï¼šæ·±å…¥XMLåŠ¨æ€SQL
- å­¦ä¼š<if> <where> <choose>
- å¤„ç†å¤æ‚ä¸šåŠ¡åœºæ™¯

ç¬¬4æ­¥ï¼šæ€§èƒ½ä¼˜åŒ–å®è·µ
- åˆ†ææ…¢æŸ¥è¯¢
- ä¼˜åŒ–SQLç»“æ„
```

**ğŸ¯ ç»ƒä¹ å»ºè®®**
```
1. å®ç°ç”¨æˆ·æœç´¢åŠŸèƒ½
   - å¤šæ¡ä»¶ç»„åˆ
   - å…³è”éƒ¨é—¨è¡¨
   - æ”¯æŒæ’åºåˆ†é¡µ

2. åšä¸€ä¸ªè®¢å•ç»Ÿè®¡
   - æŒ‰æ—¶é—´èšåˆ
   - è®¡ç®—é‡‘é¢æ€»è®¡
   - ç”¨æˆ·ç»´åº¦åˆ†ç»„

3. å°è¯•æ€§èƒ½å¯¹æ¯”
   - åŒæ ·åŠŸèƒ½ï¼Œä¸åŒå†™æ³•
   - å¯¹æ¯”æ‰§è¡Œæ—¶é—´
   - åˆ†æä¼˜åŠ£åŠ¿
```

**ğŸ’ª è¿›é˜¶æ–¹å‘**
```
âœ… å­¦ä¹ SQLä¼˜åŒ–æŠ€å·§
âœ… äº†è§£ç´¢å¼•åŸç†  
âœ… æŒæ¡æ•°æ®åº“è°ƒä¼˜
âœ… ç ”ç©¶MyBatisæºç ï¼ˆé«˜çº§ï¼‰
```

---

> ğŸ’¡ **å­¦ä¹ æç¤º**ï¼šåŠ¨æ€SQLçš„æœ¬è´¨æ˜¯è®©SQLæ›´çµæ´»ï¼ŒWrapperè®©ä»£ç æ›´ç®€æ´ã€‚ä¸¤è€…ç»“åˆå°±æ˜¯ï¼šæ—¢è¦çµæ´»åˆè¦ç®€æ´ï¼

> ğŸ”¥ **é‡ç‚¹è®°å¿†**ï¼š
> - **@Select + ${ew.customSqlSegment}** = æ³¨è§£ä¸­ç”¨Wrapper
> - **XML + åŠ¨æ€æ ‡ç­¾ + ${ew.customSqlSegment}** = æœ€å¼ºå¤§çš„ç»„åˆ
> - **ç®€å•ç”¨Wrapperï¼Œå¤æ‚ç”¨XMLï¼Œæè‡´ç”¨åŸç”Ÿ** = é€‰æ‹©åŸåˆ™