---
title: 46ã€ç¼“å­˜ç­–ç•¥åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [ç¼“å­˜åŸºç¡€æ¦‚å¿µ](#1-ç¼“å­˜åŸºç¡€æ¦‚å¿µ)
2. [MyBatisäºŒçº§ç¼“å­˜é…ç½®](#2-MyBatisäºŒçº§ç¼“å­˜é…ç½®)
3. [Redisç¼“å­˜é›†æˆæ–¹æ¡ˆ](#3-Redisç¼“å­˜é›†æˆæ–¹æ¡ˆ)
4. [ç¼“å­˜ç©¿é€é—®é¢˜å¤„ç†](#4-ç¼“å­˜ç©¿é€é—®é¢˜å¤„ç†)
5. [ç¼“å­˜æ›´æ–°ç­–ç•¥](#5-ç¼“å­˜æ›´æ–°ç­–ç•¥)
6. [ç¼“å­˜å¤±æ•ˆæœºåˆ¶](#6-ç¼“å­˜å¤±æ•ˆæœºåˆ¶)
7. [åˆ†å¸ƒå¼ç¼“å­˜å®æˆ˜](#7-åˆ†å¸ƒå¼ç¼“å­˜å®æˆ˜)
8. [æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](#8-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç¼“å­˜åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ï¼Ÿ


**é€šä¿—ç†è§£**ï¼šç¼“å­˜å°±åƒä½ çš„ç¬”è®°æœ¬ï¼ŒæŠŠå¸¸ç”¨çš„ä¿¡æ¯è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡éœ€è¦æ—¶ç›´æ¥çœ‹ç¬”è®°ï¼Œä¸ç”¨å†å»ç¿»åšåšçš„æ•™ç§‘ä¹¦ã€‚

```
æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ è¿”å›ç»“æœ
æ¯æ¬¡éƒ½è¦è®¿é—®æ•°æ®åº“ï¼Œé€Ÿåº¦æ…¢

æœ‰ç¼“å­˜çš„æƒ…å†µï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ å…ˆæŸ¥ç¼“å­˜ â†’ æœ‰æ•°æ®ç›´æ¥è¿”å›
         â†“ æ²¡æœ‰æ•°æ®
      æŸ¥æ•°æ®åº“ â†’ å­˜å…¥ç¼“å­˜ â†’ è¿”å›ç»“æœ
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âš¡ **é€Ÿåº¦å¿«**ï¼šå†…å­˜è¯»å–æ¯”ç£ç›˜å¿«100-1000å€
- ğŸ’° **çœèµ„æº**ï¼šå‡å°‘æ•°æ®åº“å‹åŠ›
- ğŸš€ **é«˜å¹¶å‘**ï¼šæ”¯æŒæ›´å¤šç”¨æˆ·åŒæ—¶è®¿é—®

### 1.2 MyBatisç¼“å­˜ä½“ç³»


MyBatisæä¾›äº†**ä¸¤çº§ç¼“å­˜æœºåˆ¶**ï¼š

```
ç¼“å­˜å±‚æ¬¡ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰     â”‚  èŒƒå›´ï¼šå•ä¸ªSqlSession
â”‚  ç”Ÿå‘½å‘¨æœŸï¼šä¼šè¯æœŸé—´      â”‚  è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€é…ç½®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äºŒçº§ç¼“å­˜ï¼ˆéœ€è¦é…ç½®ï¼‰     â”‚  èŒƒå›´ï¼šMapperçº§åˆ«
â”‚  ç”Ÿå‘½å‘¨æœŸï¼šåº”ç”¨è¿è¡ŒæœŸé—´   â”‚  å¯ä»¥è·¨SqlSessionå…±äº«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸€çº§ç¼“å­˜ vs äºŒçº§ç¼“å­˜**ï¼š

| ç‰¹æ€§ | **ä¸€çº§ç¼“å­˜** | **äºŒçº§ç¼“å­˜** |
|------|------------|------------|
| ğŸ“¦ **ä½œç”¨èŒƒå›´** | `SqlSessionå†…éƒ¨` | `æ•´ä¸ªMapper` |
| â° **ç”Ÿå‘½å‘¨æœŸ** | `ä¼šè¯æœŸé—´` | `åº”ç”¨è¿è¡ŒæœŸé—´` |
| ğŸ”§ **é…ç½®æ–¹å¼** | `é»˜è®¤å¼€å¯ï¼Œæ— éœ€é…ç½®` | `éœ€è¦æ‰‹åŠ¨å¼€å¯` |
| ğŸ”„ **æ•°æ®å…±äº«** | `ä¸èƒ½è·¨ä¼šè¯å…±äº«` | `å¯ä»¥è·¨ä¼šè¯å…±äº«` |
| âš ï¸ **å¤±æ•ˆæ—¶æœº** | `ä¼šè¯å…³é—­ã€æ›´æ–°æ“ä½œ` | `æ›´æ–°æ“ä½œã€ç¼“å­˜æ¸…ç†` |

---

## 2. ğŸ”§ MyBatisäºŒçº§ç¼“å­˜é…ç½®


### 2.1 ä¸ºä»€ä¹ˆéœ€è¦äºŒçº§ç¼“å­˜ï¼Ÿ


**åœºæ™¯ä¸¾ä¾‹**ï¼š

å‡è®¾ä½ çš„ç”µå•†ç³»ç»Ÿï¼Œå•†å“ä¿¡æ¯ä¸ç»å¸¸å˜åŒ–ï¼Œä½†ç”¨æˆ·ç»å¸¸æŸ¥çœ‹ï¼š

```
æ²¡æœ‰äºŒçº§ç¼“å­˜ï¼š
ç”¨æˆ·AæŸ¥å•†å“ â†’ æ•°æ®åº“æŸ¥è¯¢
ç”¨æˆ·BæŸ¥å•†å“ â†’ åˆæŸ¥ä¸€æ¬¡æ•°æ®åº“
ç”¨æˆ·CæŸ¥å•†å“ â†’ å†æŸ¥ä¸€æ¬¡æ•°æ®åº“
æ¯ä¸ªç”¨æˆ·éƒ½è¦æŸ¥æ•°æ®åº“ï¼

æœ‰äºŒçº§ç¼“å­˜ï¼š
ç”¨æˆ·AæŸ¥å•†å“ â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ å­˜å…¥ç¼“å­˜
ç”¨æˆ·BæŸ¥å•†å“ â†’ ç›´æ¥ä»ç¼“å­˜æ‹¿
ç”¨æˆ·CæŸ¥å•†å“ â†’ ç›´æ¥ä»ç¼“å­˜æ‹¿
æ•°æ®åº“åªæŸ¥ä¸€æ¬¡ï¼
```

### 2.2 å¼€å¯äºŒçº§ç¼“å­˜


**æ­¥éª¤1ï¼šå…¨å±€é…ç½®å¼€å¯**

åœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
mybatis-plus:
  configuration:
    # å¼€å¯äºŒçº§ç¼“å­˜
    cache-enabled: true
    # å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³
    lazy-loading-enabled: true
    # æŒ‰éœ€åŠ è½½
    aggressive-lazy-loading: false
```

**æ­¥éª¤2ï¼šå®ä½“ç±»å®ç°åºåˆ—åŒ–**

::: tip ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Ÿ
ç¼“å­˜éœ€è¦æŠŠå¯¹è±¡å­˜å‚¨åˆ°å†…å­˜æˆ–Redisä¸­ï¼Œåºåˆ—åŒ–å°±æ˜¯æŠŠå¯¹è±¡è½¬æ¢æˆå¯å­˜å‚¨çš„æ ¼å¼ã€‚å°±åƒæŠŠæ–‡ä»¶å‹ç¼©æˆZIPä¸€æ ·ã€‚
:::

```java
@Data
@TableName("user")
public class User implements Serializable {
    
    private static final long serialVersionUID = 1L;
    
    private Long id;
    private String name;
    private Integer age;
    private String email;
}
```

**æ­¥éª¤3ï¼šMapperæ¥å£å¯ç”¨ç¼“å­˜**

```java
// æ–¹å¼1ï¼šä½¿ç”¨@CacheNamespaceæ³¨è§£
@CacheNamespace
public interface UserMapper extends BaseMapper<User> {
    // è¿™ä¸ªMapperçš„æ‰€æœ‰æŸ¥è¯¢éƒ½ä¼šè¢«ç¼“å­˜
}

// æ–¹å¼2ï¼šåœ¨XMLä¸­é…ç½®
```

```xml
<!-- UserMapper.xml -->
<mapper namespace="com.example.mapper.UserMapper">
    
    <!-- é…ç½®ç¼“å­˜ -->
    <cache 
        eviction="LRU"           
        flushInterval="60000"    
        size="512"               
        readOnly="false"/>
    
    <!-- æŸ¥è¯¢è¯­å¥ -->
    <select id="selectById" resultType="User">
        SELECT * FROM user WHERE id = #{id}
    </select>
</mapper>
```

**ç¼“å­˜é…ç½®å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | **å«ä¹‰** | **ç¤ºä¾‹å€¼** | **è¯´æ˜** |
|------|---------|-----------|---------|
| `eviction` | æ¸…é™¤ç­–ç•¥ | `LRU` | `LRU=æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ŒFIFO=å…ˆè¿›å…ˆå‡ºï¼ŒSOFT=è½¯å¼•ç”¨ï¼ŒWEAK=å¼±å¼•ç”¨` |
| `flushInterval` | åˆ·æ–°é—´éš” | `60000` | `æ¯«ç§’ï¼Œ60000=1åˆ†é’Ÿè‡ªåŠ¨æ¸…ç©ºç¼“å­˜` |
| `size` | ç¼“å­˜æ•°é‡ | `512` | `æœ€å¤šç¼“å­˜512ä¸ªå¯¹è±¡` |
| `readOnly` | åªè¯»æ¨¡å¼ | `false` | `true=åªè¯»é€Ÿåº¦å¿«ï¼Œfalse=è¯»å†™å®‰å…¨` |

---

## 3. ğŸ’¾ Redisç¼“å­˜é›†æˆæ–¹æ¡ˆ


### 3.1 ä¸ºä»€ä¹ˆè¦ç”¨Redisï¼Ÿ


**MyBatisè‡ªå¸¦ç¼“å­˜çš„å±€é™æ€§**ï¼š

```
é—®é¢˜1ï¼šå†…å­˜é™åˆ¶
MyBatisç¼“å­˜å­˜åœ¨JVMå†…å­˜ä¸­ï¼ŒæœåŠ¡å™¨é‡å¯å°±ä¸¢å¤±äº†

é—®é¢˜2ï¼šåˆ†å¸ƒå¼é—®é¢˜
å¤šå°æœåŠ¡å™¨å„è‡ªç¼“å­˜ï¼Œæ•°æ®ä¸ä¸€è‡´

é—®é¢˜3ï¼šå®¹é‡é™åˆ¶
JVMå†…å­˜æœ‰é™ï¼Œä¸èƒ½å­˜å¤ªå¤šæ•°æ®
```

**Redisçš„ä¼˜åŠ¿**ï¼š

```
âœ… æŒä¹…åŒ–ï¼šæ•°æ®ä¸ä¼šå› é‡å¯ä¸¢å¤±
âœ… åˆ†å¸ƒå¼ï¼šå¤šå°æœåŠ¡å™¨å…±äº«ç¼“å­˜
âœ… å¤§å®¹é‡ï¼šå¯ä»¥å­˜å‚¨æµ·é‡æ•°æ®
âœ… é«˜æ€§èƒ½ï¼šè¯»å†™é€Ÿåº¦æå¿«
```

### 3.2 é›†æˆRedisç¼“å­˜


**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**

```xml
<!-- Redis -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>

<!-- MyBatis-Plus Redisç¼“å­˜é€‚é…å™¨ -->
<dependency>
    <groupId>org.mybatis.caches</groupId>
    <artifactId>mybatis-redis</artifactId>
    <version>1.0.0-beta2</version>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®Redisè¿æ¥**

```yaml
spring:
  redis:
    host: 127.0.0.1
    port: 6379
    password: your_password
    database: 0
    lettuce:
      pool:
        max-active: 8      # æœ€å¤§è¿æ¥æ•°
        max-idle: 8        # æœ€å¤§ç©ºé—²è¿æ¥
        min-idle: 0        # æœ€å°ç©ºé—²è¿æ¥
        max-wait: -1ms     # è¿æ¥ç­‰å¾…æ—¶é—´
```

**æ­¥éª¤3ï¼šè‡ªå®šä¹‰Redisç¼“å­˜å®ç°**

```java
/**
 * è‡ªå®šä¹‰Redisç¼“å­˜
 * æŠŠMyBatisçš„ç¼“å­˜æ•°æ®å­˜åˆ°Redisä¸­
 */
public class MybatisRedisCache implements Cache {
    
    private final String id;
    private RedisTemplate<String, Object> redisTemplate;
    
    public MybatisRedisCache(String id) {
        this.id = id;
        // ä»Springå®¹å™¨è·å–RedisTemplate
        this.redisTemplate = SpringContextHolder.getBean(RedisTemplate.class);
    }
    
    @Override
    public String getId() {
        return this.id;
    }
    
    // å­˜å…¥ç¼“å­˜
    @Override
    public void putObject(Object key, Object value) {
        if (value != null) {
            // å­˜å…¥Redisï¼Œè®¾ç½®1å°æ—¶è¿‡æœŸ
            redisTemplate.opsForValue().set(
                getCacheKey(key), 
                value, 
                1, 
                TimeUnit.HOURS
            );
        }
    }
    
    // è·å–ç¼“å­˜
    @Override
    public Object getObject(Object key) {
        return redisTemplate.opsForValue().get(getCacheKey(key));
    }
    
    // ç§»é™¤ç¼“å­˜
    @Override
    public Object removeObject(Object key) {
        return redisTemplate.delete(getCacheKey(key));
    }
    
    // æ¸…ç©ºç¼“å­˜
    @Override
    public void clear() {
        Set<String> keys = redisTemplate.keys(id + ":*");
        if (keys != null && !keys.isEmpty()) {
            redisTemplate.delete(keys);
        }
    }
    
    // ç”Ÿæˆç¼“å­˜key
    private String getCacheKey(Object key) {
        return id + ":" + key.toString();
    }
}
```

**æ­¥éª¤4ï¼šåœ¨Mapperä¸­ä½¿ç”¨**

```java
// ä½¿ç”¨è‡ªå®šä¹‰Redisç¼“å­˜
@CacheNamespace(implementation = MybatisRedisCache.class)
public interface UserMapper extends BaseMapper<User> {
    
    // æŸ¥è¯¢ä¼šè¢«ç¼“å­˜åˆ°Redis
    User selectById(Long id);
    
    // æ›´æ–°ä¼šæ¸…ç©ºç¼“å­˜
    int updateById(User user);
}
```

---

## 4. ğŸ›¡ï¸ ç¼“å­˜ç©¿é€é—®é¢˜å¤„ç†


### 4.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ


**é€šä¿—è§£é‡Š**ï¼š

æƒ³è±¡ä½ å»å›¾ä¹¦é¦†å€Ÿä¹¦ï¼Œç®¡ç†å‘˜æœ‰ä¸ªå€Ÿé˜…è®°å½•æœ¬ï¼ˆç¼“å­˜ï¼‰ã€‚å¦‚æœä½ è¦å€Ÿçš„ä¹¦åœ¨è®°å½•æœ¬ä¸Šæœ‰ï¼Œç›´æ¥å‘Šè¯‰ä½ åœ¨å“ªï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±è¦å»ä¹¦åº“æ‰¾ï¼ˆæŸ¥æ•°æ®åº“ï¼‰ã€‚

**ç¼“å­˜ç©¿é€** = ä½ æ•…æ„å€Ÿä¸€æœ¬ä¸å­˜åœ¨çš„ä¹¦ï¼Œç®¡ç†å‘˜æ¯æ¬¡éƒ½è¦å»ä¹¦åº“æ‰¾ï¼Œç»“æœæ°¸è¿œæ‰¾ä¸åˆ°ï¼Œæµªè´¹æ—¶é—´ï¼

```
æ­£å¸¸æƒ…å†µï¼š
æŸ¥è¯¢å­˜åœ¨çš„æ•°æ® â†’ ç¼“å­˜æœ‰ â†’ ç›´æ¥è¿”å› âœ“
æŸ¥è¯¢å­˜åœ¨çš„æ•°æ® â†’ ç¼“å­˜æ²¡æœ‰ â†’ æŸ¥æ•°æ®åº“ â†’ å­˜ç¼“å­˜ â†’ è¿”å› âœ“

ç¼“å­˜ç©¿é€ï¼š
æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ® â†’ ç¼“å­˜æ²¡æœ‰ â†’ æŸ¥æ•°æ®åº“ â†’ ä¹Ÿæ²¡æœ‰ â†’ è¿”å›ç©º âœ—
å†æ¬¡æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ® â†’ åˆæŸ¥æ•°æ®åº“ â†’ åˆæ²¡æœ‰ â†’ è¿”å›ç©º âœ—
æ¶æ„æ”»å‡»ï¼šç–¯ç‹‚æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ® â†’ æ•°æ®åº“å‹åŠ›å·¨å¤§ â†’ ç³»ç»Ÿå´©æºƒ ğŸ’¥
```

### 4.2 è§£å†³æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºå€¼


**åŸç†**ï¼šå³ä½¿æ•°æ®ä¸å­˜åœ¨ï¼Œä¹ŸæŠŠ"ç©ºç»“æœ"ç¼“å­˜èµ·æ¥

```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€
     */
    public User getUserById(Long id) {
        String cacheKey = "user:" + id;
        
        // 1. å…ˆæŸ¥ç¼“å­˜
        Object cached = redisTemplate.opsForValue().get(cacheKey);
        
        // 2. ç¼“å­˜å‘½ä¸­
        if (cached != null) {
            // å¦‚æœæ˜¯ç©ºå¯¹è±¡ï¼Œç›´æ¥è¿”å›null
            if (cached instanceof NullValue) {
                return null;
            }
            return (User) cached;
        }
        
        // 3. æŸ¥æ•°æ®åº“
        User user = userMapper.selectById(id);
        
        if (user != null) {
            // å­˜å…¥ç¼“å­˜ï¼Œ1å°æ—¶è¿‡æœŸ
            redisTemplate.opsForValue().set(cacheKey, user, 1, TimeUnit.HOURS);
        } else {
            // å…³é”®ï¼šæŠŠç©ºç»“æœä¹Ÿç¼“å­˜ï¼Œä½†è¿‡æœŸæ—¶é—´çŸ­ä¸€äº›
            redisTemplate.opsForValue().set(
                cacheKey, 
                new NullValue(),  // æ ‡è®°ä¸ºç©ºå€¼
                5,                 // 5åˆ†é’Ÿè¿‡æœŸ
                TimeUnit.MINUTES
            );
        }
        
        return user;
    }
    
    // ç©ºå€¼æ ‡è®°ç±»
    static class NullValue implements Serializable {}
}
```

**ä¼˜ç¼ºç‚¹åˆ†æ**ï¼š

| æ–¹æ¡ˆ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|---------|---------|
| âœ… **ç¼“å­˜ç©ºå€¼** | `å®ç°ç®€å•ï¼Œä¿æŠ¤æ•°æ®åº“` | `å ç”¨ç¼“å­˜ç©ºé—´ï¼Œå¯èƒ½å­˜å‚¨å¤§é‡æ— ç”¨æ•°æ®` |

### 4.3 è§£å†³æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤å™¨


**åŸç†**ï¼šåœ¨ç¼“å­˜å‰åŠ ä¸€å±‚å¿«é€Ÿåˆ¤æ–­ï¼Œä¸å­˜åœ¨çš„æ•°æ®ç›´æ¥æ‹¦æˆª

```
å¸ƒéš†è¿‡æ»¤å™¨å·¥ä½œæµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŸ¥è¯¢è¯·æ±‚  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­  â”‚ â†’ ä¸å­˜åœ¨ â†’ ç›´æ¥è¿”å›null âœ“
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ å¯èƒ½å­˜åœ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢ç¼“å­˜    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŸ¥è¯¢æ•°æ®åº“  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä»£ç **ï¼š

```java
@Configuration
public class BloomFilterConfig {
    
    /**
     * åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨
     * é¢„è®¡100ä¸‡æ¡æ•°æ®ï¼Œè¯¯åˆ¤ç‡0.01%
     */
    @Bean
    public BloomFilter<Long> userIdBloomFilter() {
        return BloomFilter.create(
            Funnels.longFunnel(),
            1000000,  // é¢„æœŸæ•°æ®é‡
            0.0001    // è¯¯åˆ¤ç‡
        );
    }
    
    /**
     * å¯åŠ¨æ—¶åˆå§‹åŒ–ï¼šæŠŠæ‰€æœ‰ç”¨æˆ·IDåŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨
     */
    @PostConstruct
    public void initBloomFilter() {
        BloomFilter<Long> filter = userIdBloomFilter();
        List<User> allUsers = userMapper.selectList(null);
        
        for (User user : allUsers) {
            filter.put(user.getId());
        }
        
        System.out.println("å¸ƒéš†è¿‡æ»¤å™¨åˆå§‹åŒ–å®Œæˆï¼ŒåŠ è½½äº† " + allUsers.size() + " ä¸ªç”¨æˆ·ID");
    }
}

@Service
public class UserService {
    
    @Autowired
    private BloomFilter<Long> userIdBloomFilter;
    
    public User getUserById(Long id) {
        // 1. å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­
        if (!userIdBloomFilter.mightContain(id)) {
            // ä¸€å®šä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            return null;
        }
        
        // 2. å¯èƒ½å­˜åœ¨ï¼Œç»§ç»­æŸ¥ç¼“å­˜å’Œæ•°æ®åº“
        // ... åç»­é€»è¾‘
    }
}
```

::: warning æ³¨æ„äº‹é¡¹
- å¸ƒéš†è¿‡æ»¤å™¨è¯´"ä¸å­˜åœ¨"æ˜¯100%å‡†ç¡®çš„
- å¸ƒéš†è¿‡æ»¤å™¨è¯´"å­˜åœ¨"å¯èƒ½æœ‰è¯¯åˆ¤ï¼ˆæå°æ¦‚ç‡ï¼‰
- æ–°å¢æ•°æ®æ—¶è¦åŒæ­¥æ›´æ–°å¸ƒéš†è¿‡æ»¤å™¨
:::

---

## 5. ğŸ”„ ç¼“å­˜æ›´æ–°ç­–ç•¥


### 5.1 ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜


**é—®é¢˜åœºæ™¯**ï¼š

```
åœºæ™¯ï¼šç”¨æˆ·ä¿®æ”¹äº†ä¸ªäººä¿¡æ¯
æ—¶é—´è½´ï¼š
10:00 - ç”¨æˆ·AæŸ¥è¯¢ä¿¡æ¯ â†’ ç¼“å­˜å­˜å…¥"å¼ ä¸‰ï¼Œ25å²"
10:05 - ç”¨æˆ·ä¿®æ”¹ä¿¡æ¯ â†’ æ•°æ®åº“æ›´æ–°ä¸º"å¼ ä¸‰ï¼Œ26å²"
10:06 - ç”¨æˆ·BæŸ¥è¯¢ä¿¡æ¯ â†’ ç¼“å­˜è¿˜æ˜¯"å¼ ä¸‰ï¼Œ25å²" âŒ
é—®é¢˜ï¼šæ•°æ®åº“å·²æ›´æ–°ï¼Œä½†ç¼“å­˜è¿˜æ˜¯æ—§æ•°æ®ï¼
```

### 5.2 ç­–ç•¥ä¸€ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜


**æ¨èæ–¹æ¡ˆ**ï¼Œæœ€å¸¸ç”¨ï¼

```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     */
    @Transactional
    public void updateUser(User user) {
        // 1. å…ˆæ›´æ–°æ•°æ®åº“
        userMapper.updateById(user);
        
        // 2. å†åˆ é™¤ç¼“å­˜
        String cacheKey = "user:" + user.getId();
        redisTemplate.delete(cacheKey);
        
        // ä¸‹æ¬¡æŸ¥è¯¢æ—¶ä¼šé‡æ–°åŠ è½½æœ€æ–°æ•°æ®åˆ°ç¼“å­˜
    }
}
```

**ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ**

```
æ­£ç¡®æµç¨‹ï¼š
æ­¥éª¤1ï¼šæ›´æ–°æ•°æ®åº“ âœ“
æ­¥éª¤2ï¼šåˆ é™¤ç¼“å­˜ âœ“
æ­¥éª¤3ï¼šä¸‹æ¬¡æŸ¥è¯¢ â†’ ç¼“å­˜æ²¡æœ‰ â†’ æŸ¥æ•°æ®åº“ï¼ˆæœ€æ–°ï¼‰ â†’ å­˜ç¼“å­˜ âœ“

å¦‚æœåè¿‡æ¥ï¼ˆå…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ï¼‰ï¼š
æ­¥éª¤1ï¼šåˆ é™¤ç¼“å­˜
æ­¥éª¤2ï¼šæ­¤æ—¶æœ‰äººæŸ¥è¯¢ â†’ ç¼“å­˜æ²¡æœ‰ â†’ æŸ¥æ•°æ®åº“ï¼ˆæ—§æ•°æ®ï¼‰â†’ å­˜ç¼“å­˜
æ­¥éª¤3ï¼šæ›´æ–°æ•°æ®åº“ 
ç»“æœï¼šç¼“å­˜é‡Œæ˜¯æ—§æ•°æ®ï¼âŒ
```

### 5.3 ç­–ç•¥äºŒï¼šå»¶è¿ŸåŒåˆ 


**é€‚ç”¨åœºæ™¯**ï¼šå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯

```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * å»¶è¿ŸåŒåˆ ç­–ç•¥
     */
    @Transactional
    public void updateUser(User user) {
        String cacheKey = "user:" + user.getId();
        
        // 1. ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜
        redisTemplate.delete(cacheKey);
        
        // 2. æ›´æ–°æ•°æ®åº“
        userMapper.updateById(user);
        
        // 3. å»¶è¿Ÿåå†åˆ é™¤ä¸€æ¬¡ï¼ˆæ¸…ç†å¯èƒ½çš„è„æ•°æ®ï¼‰
        CompletableFuture.runAsync(() -> {
            try {
                Thread.sleep(500);  // å»¶è¿Ÿ500ms
                redisTemplate.delete(cacheKey);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
    }
}
```

**ä¸ºä»€ä¹ˆå»¶è¿Ÿåˆ é™¤ï¼Ÿ**

é˜²æ­¢åœ¨æ›´æ–°æ•°æ®åº“æœŸé—´ï¼Œæœ‰å…¶ä»–è¯·æ±‚æŸ¥è¯¢å¹¶ç¼“å­˜äº†æ—§æ•°æ®ã€‚å»¶è¿Ÿåˆ é™¤å¯ä»¥æ¸…ç†è¿™äº›è„æ•°æ®ã€‚

---

## 6. â° ç¼“å­˜å¤±æ•ˆæœºåˆ¶


### 6.1 ç¼“å­˜å¤±æ•ˆçš„ä¸‰ç§æƒ…å†µ


```
æƒ…å†µ1ï¼šä¸»åŠ¨å¤±æ•ˆ
ä½ æ˜ç¡®åˆ é™¤ç¼“å­˜ â†’ redisTemplate.delete(key)

æƒ…å†µ2ï¼šè¢«åŠ¨å¤±æ•ˆ
è®¾ç½®äº†è¿‡æœŸæ—¶é—´ â†’ æ—¶é—´åˆ°äº†è‡ªåŠ¨åˆ é™¤

æƒ…å†µ3ï¼šå®¹é‡å¤±æ•ˆ
ç¼“å­˜æ»¡äº† â†’ æŒ‰ç­–ç•¥ï¼ˆLRUç­‰ï¼‰åˆ é™¤æ—§æ•°æ®
```

### 6.2 è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´


**ä¸åŒæ•°æ®çš„è¿‡æœŸæ—¶é—´ç­–ç•¥**ï¼š

| æ•°æ®ç±»å‹ | **è¿‡æœŸæ—¶é—´** | **åŸå› ** |
|---------|------------|---------|
| ğŸ“± **ç”¨æˆ·ä¿¡æ¯** | `30åˆ†é’Ÿ - 1å°æ—¶` | `ä¸å¸¸å˜åŒ–ï¼Œä½†è¦åŠæ—¶æ›´æ–°` |
| ğŸ“¦ **å•†å“ä¿¡æ¯** | `1å°æ—¶ - 6å°æ—¶` | `ä»·æ ¼åº“å­˜å¯èƒ½å˜åŒ–` |
| ğŸ“Š **ç»Ÿè®¡æ•°æ®** | `5åˆ†é’Ÿ - 15åˆ†é’Ÿ` | `å®æ—¶æ€§è¦æ±‚é«˜` |
| ğŸ”§ **é…ç½®ä¿¡æ¯** | `1å¤© - 7å¤©` | `å‡ ä¹ä¸å˜åŒ–` |

**ä»£ç ç¤ºä¾‹**ï¼š

```java
@Service
public class CacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * æ ¹æ®æ•°æ®ç±»å‹è®¾ç½®ä¸åŒè¿‡æœŸæ—¶é—´
     */
    public void cacheData(String key, Object value, String dataType) {
        
        Duration expireTime;
        
        switch (dataType) {
            case "USER":
                expireTime = Duration.ofMinutes(30);  // ç”¨æˆ·ä¿¡æ¯30åˆ†é’Ÿ
                break;
            case "PRODUCT":
                expireTime = Duration.ofHours(2);     // å•†å“ä¿¡æ¯2å°æ—¶
                break;
            case "CONFIG":
                expireTime = Duration.ofDays(1);      // é…ç½®ä¿¡æ¯1å¤©
                break;
            default:
                expireTime = Duration.ofHours(1);     // é»˜è®¤1å°æ—¶
        }
        
        redisTemplate.opsForValue().set(key, value, expireTime);
    }
}
```

### 6.3 ç¼“å­˜é›ªå´©é—®é¢˜


**ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ**

```
åœºæ™¯ï¼šåŒ11æœŸé—´ï¼Œå¤§é‡å•†å“ç¼“å­˜åŒæ—¶è¿‡æœŸ
æ—¶é—´è½´ï¼š
00:00 - æ´»åŠ¨å¼€å§‹ï¼Œ1000ä¸‡ä»¶å•†å“ç¼“å­˜ï¼Œéƒ½è®¾ç½®1å°æ—¶è¿‡æœŸ
01:00 - æ‰€æœ‰ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼
01:01 - ç™¾ä¸‡ç”¨æˆ·åŒæ—¶è®¿é—® â†’ å…¨éƒ¨è¯·æ±‚æ‰“åˆ°æ•°æ®åº“
ç»“æœï¼šæ•°æ®åº“ç¬é—´å´©æºƒ ğŸ’¥
```

**è§£å†³æ–¹æ¡ˆï¼šéšæœºè¿‡æœŸæ—¶é—´**

```java
/**
 * è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´ï¼Œé¿å…é›ªå´©
 */
public void cacheWithRandomExpire(String key, Object value) {
    // åŸºç¡€è¿‡æœŸæ—¶é—´ï¼š1å°æ—¶
    long baseExpire = 3600;
    
    // éšæœºå¢åŠ 0-300ç§’ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
    long randomExpire = (long) (Math.random() * 300);
    
    long finalExpire = baseExpire + randomExpire;
    
    redisTemplate.opsForValue().set(
        key, 
        value, 
        finalExpire, 
        TimeUnit.SECONDS
    );
}
```

---

## 7. ğŸŒ åˆ†å¸ƒå¼ç¼“å­˜å®æˆ˜


### 7.1 åˆ†å¸ƒå¼ç¯å¢ƒçš„ç¼“å­˜é—®é¢˜


**å•æœºç¼“å­˜çš„é—®é¢˜**ï¼š

```
åœºæ™¯ï¼š3å°æœåŠ¡å™¨çš„ç”µå•†ç³»ç»Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨1   â”‚  â”‚ æœåŠ¡å™¨2   â”‚  â”‚ æœåŠ¡å™¨3   â”‚
â”‚ æœ¬åœ°ç¼“å­˜  â”‚  â”‚ æœ¬åœ°ç¼“å­˜  â”‚  â”‚ æœ¬åœ°ç¼“å­˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“              â†“              â†“
   å„è‡ªç¼“å­˜       å„è‡ªç¼“å­˜       å„è‡ªç¼“å­˜
   
é—®é¢˜ï¼š
1. æœåŠ¡å™¨1æ›´æ–°äº†å•†å“ä»·æ ¼ï¼Œåˆ é™¤äº†ç¼“å­˜
2. æœåŠ¡å™¨2å’Œ3çš„ç¼“å­˜è¿˜æ˜¯æ—§ä»·æ ¼
3. ç”¨æˆ·è®¿é—®åˆ°ä¸åŒæœåŠ¡å™¨ï¼Œçœ‹åˆ°ä¸åŒä»·æ ¼ï¼
```

**è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨Redisé›†ä¸­å¼ç¼“å­˜**

```
ä½¿ç”¨Redisåï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœåŠ¡å™¨1   â”‚  â”‚ æœåŠ¡å™¨2   â”‚  â”‚ æœåŠ¡å™¨3   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Redisé›†ç¾¤  â”‚ â† æ‰€æœ‰æœåŠ¡å™¨å…±äº«åŒä¸€ä¸ªç¼“å­˜
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          
ä¼˜åŠ¿ï¼š
1. ä»»ä½•æœåŠ¡å™¨æ›´æ–°ï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½çœ‹åˆ°
2. æ•°æ®ä¸€è‡´æ€§æœ‰ä¿éšœ
3. å¯ä»¥æ¨ªå‘æ‰©å±•
```

### 7.2 Redisé›†ç¾¤é…ç½®


**å“¨å…µæ¨¡å¼é…ç½®**ï¼ˆé€‚åˆä¸­å°è§„æ¨¡ï¼‰ï¼š

```yaml
spring:
  redis:
    # å“¨å…µæ¨¡å¼
    sentinel:
      master: mymaster        # ä¸»èŠ‚ç‚¹åç§°
      nodes:                  # å“¨å…µèŠ‚ç‚¹åœ°å€
        - 192.168.1.101:26379
        - 192.168.1.102:26379
        - 192.168.1.103:26379
    password: your_password
    database: 0
```

**é›†ç¾¤æ¨¡å¼é…ç½®**ï¼ˆé€‚åˆå¤§è§„æ¨¡ï¼‰ï¼š

```yaml
spring:
  redis:
    # é›†ç¾¤æ¨¡å¼
    cluster:
      nodes:                  # é›†ç¾¤èŠ‚ç‚¹
        - 192.168.1.101:7001
        - 192.168.1.102:7002
        - 192.168.1.103:7003
        - 192.168.1.104:7004
        - 192.168.1.105:7005
        - 192.168.1.106:7006
      max-redirects: 3        # é‡å®šå‘æ¬¡æ•°
    password: your_password
```

### 7.3 åˆ†å¸ƒå¼é”é˜²æ­¢ç¼“å­˜å‡»ç©¿


**ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿ï¼Ÿ**

```
åœºæ™¯ï¼šçƒ­é—¨å•†å“çš„ç¼“å­˜è¿‡æœŸ
æ—¶é—´è½´ï¼š
10:00 - çˆ†æ¬¾æ‰‹æœºç¼“å­˜è¿‡æœŸ
10:00:01 - 1000ä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾
ç»“æœï¼š1000ä¸ªè¯·æ±‚éƒ½å»æŸ¥æ•°æ®åº“ï¼Œæ•°æ®åº“å‹åŠ›ç¬é—´é£™å‡
```

**è§£å†³æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼é”**

```java
@Service
public class ProductService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private ProductMapper productMapper;
    
    /**
     * ä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢ç¼“å­˜å‡»ç©¿
     */
    public Product getProduct(Long id) {
        String cacheKey = "product:" + id;
        String lockKey = "lock:product:" + id;
        
        // 1. å…ˆæŸ¥ç¼“å­˜
        Product product = (Product) redisTemplate.opsForValue().get(cacheKey);
        if (product != null) {
            return product;
        }
        
        // 2. ç¼“å­˜æ²¡æœ‰ï¼Œå°è¯•è·å–é”
        Boolean lock = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "1", 10, TimeUnit.SECONDS);
        
        try {
            if (Boolean.TRUE.equals(lock)) {
                // è·å–åˆ°é”ï¼ŒæŸ¥è¯¢æ•°æ®åº“
                product = productMapper.selectById(id);
                
                if (product != null) {
                    // å­˜å…¥ç¼“å­˜
                    redisTemplate.opsForValue().set(
                        cacheKey, 
                        product, 
                        1, 
                        TimeUnit.HOURS
                    );
                }
                
                return product;
            } else {
                // æ²¡è·å–åˆ°é”ï¼Œç­‰å¾…100msåé‡è¯•
                Thread.sleep(100);
                return getProduct(id);  // é€’å½’é‡è¯•
            }
        } catch (InterruptedException e) {
            throw new RuntimeException("è·å–å•†å“å¤±è´¥", e);
        } finally {
            // é‡Šæ”¾é”
            redisTemplate.delete(lockKey);
        }
    }
}
```

**åˆ†å¸ƒå¼é”å·¥ä½œæµç¨‹**ï¼š

```
è¯·æ±‚1åˆ°è¾¾ â†’ è·å–é”æˆåŠŸ â†’ æŸ¥æ•°æ®åº“ â†’ å­˜ç¼“å­˜ â†’ é‡Šæ”¾é”
è¯·æ±‚2åˆ°è¾¾ â†’ è·å–é”å¤±è´¥ â†’ ç­‰å¾… â†’ é‡è¯• â†’ ç¼“å­˜å·²æœ‰ â†’ ç›´æ¥è¿”å›
è¯·æ±‚3åˆ°è¾¾ â†’ è·å–é”å¤±è´¥ â†’ ç­‰å¾… â†’ é‡è¯• â†’ ç¼“å­˜å·²æœ‰ â†’ ç›´æ¥è¿”å›
...
è¯·æ±‚1000åˆ°è¾¾ â†’ ç¼“å­˜å·²æœ‰ â†’ ç›´æ¥è¿”å›

ç»“æœï¼šåªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚æŸ¥äº†æ•°æ®åº“ï¼
```

---

## 8. ğŸš€ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ


### 8.1 æ‰¹é‡æ“ä½œä¼˜åŒ–


**é—®é¢˜åœºæ™¯**ï¼š

```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šå¾ªç¯æŸ¥è¯¢
public List<User> getUsersByIds(List<Long> ids) {
    List<User> users = new ArrayList<>();
    for (Long id : ids) {
        User user = userMapper.selectById(id);  // æ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“
        users.add(user);
    }
    return users;
}
// 100ä¸ªIDå°±è¦æŸ¥100æ¬¡æ•°æ®åº“ï¼
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

```java
// âœ… å¥½çš„åšæ³•ï¼šæ‰¹é‡æŸ¥è¯¢
public List<User> getUsersByIds(List<Long> ids) {
    // ä½¿ç”¨MyBatis-Plusçš„æ‰¹é‡æŸ¥è¯¢
    return userMapper.selectBatchIds(ids);  // ä¸€æ¬¡SQLæå®š
}

// âœ… æ›´å¥½çš„åšæ³•ï¼šå¸¦ç¼“å­˜çš„æ‰¹é‡æŸ¥è¯¢
public List<User> getUsersByIdsWithCache(List<Long> ids) {
    List<User> result = new ArrayList<>();
    List<Long> missIds = new ArrayList<>();
    
    // 1. å…ˆä»ç¼“å­˜æ‰¹é‡è·å–
    List<String> cacheKeys = ids.stream()
        .map(id -> "user:" + id)
        .collect(Collectors.toList());
    
    List<Object> cachedUsers = redisTemplate.opsForValue().multiGet(cacheKeys);
    
    // 2. æ‰¾å‡ºç¼“å­˜æœªå‘½ä¸­çš„ID
    for (int i = 0; i < ids.size(); i++) {
        if (cachedUsers.get(i) != null) {
            result.add((User) cachedUsers.get(i));
        } else {
            missIds.add(ids.get(i));
        }
    }
    
    // 3. æ‰¹é‡æŸ¥è¯¢æœªå‘½ä¸­çš„æ•°æ®
    if (!missIds.isEmpty()) {
        List<User> dbUsers = userMapper.selectBatchIds(missIds);
        
        // 4. æ‰¹é‡å†™å…¥ç¼“å­˜
        Map<String, Object> cacheMap = new HashMap<>();
        for (User user : dbUsers) {
            cacheMap.put("user:" + user.getId(), user);
        }
        redisTemplate.opsForValue().multiSet(cacheMap);
        
        result.addAll(dbUsers);
    }
    
    return result;
}
```

### 8.2 ç¼“å­˜é¢„çƒ­


**ä»€ä¹ˆæ˜¯ç¼“å­˜é¢„çƒ­ï¼Ÿ**

ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæå‰æŠŠçƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ï¼Œé¿å…å¯åŠ¨åå¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ã€‚

```java
@Component
public class CacheWarmer {
    
    @Autowired
    private ProductMapper productMapper;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    /**
     * ç³»ç»Ÿå¯åŠ¨æ—¶é¢„çƒ­ç¼“å­˜
     */
    @PostConstruct
    public void warmUpCache() {
        System.out.println("å¼€å§‹ç¼“å­˜é¢„çƒ­...");
        
        // 1. åŠ è½½çƒ­é—¨å•†å“ï¼ˆæ ¹æ®é”€é‡æ’åºï¼‰
        List<Product> hotProducts = productMapper.selectList(
            new LambdaQueryWrapper<Product>()
                .orderByDesc(Product::getSalesCount)
                .last("LIMIT 1000")  // å‰1000ä¸ªçƒ­é—¨å•†å“
        );
        
        // 2. æ‰¹é‡å†™å…¥ç¼“å­˜
        for (Product product : hotProducts) {
            redisTemplate.opsForValue().set(
                "product:" + product.getId(),
                product,
                2,
                TimeUnit.HOURS
            );
        }
        
        System.out.println("ç¼“å­˜é¢„çƒ­å®Œæˆï¼ŒåŠ è½½äº† " + hotProducts.size() + " ä¸ªå•†å“");
    }
}
```

### 8.3 ç¼“å­˜ç›‘æ§


**ç›‘æ§å…³é”®æŒ‡æ ‡**ï¼š

```java
@Component
public class CacheMonitor {
    
    private final AtomicLong hitCount = new AtomicLong(0);    // å‘½ä¸­æ¬¡æ•°
    private final AtomicLong missCount = new AtomicLong(0);   // æœªå‘½ä¸­æ¬¡æ•°
    
    /**
     * è®°å½•ç¼“å­˜å‘½ä¸­
     */
    public void recordHit() {
        hitCount.incrementAndGet();
    }
    
    /**
     * è®°å½•ç¼“å­˜æœªå‘½ä¸­
     */
    public void recordMiss() {
        missCount.incrementAndGet();
    }
    
    /**
     * è·å–ç¼“å­˜å‘½ä¸­ç‡
     */
    public double getHitRate() {
        long total = hitCount.get() + missCount.get();
        if (total == 0) return 0;
        return (double) hitCount.get() / total * 100;
    }
    
    /**
     * å®šæ—¶æ‰“å°ç»Ÿè®¡ä¿¡æ¯
     */
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ‰§è¡Œ
    public void printStats() {
        System.out.println("=== ç¼“å­˜ç»Ÿè®¡ ===");
        System.out.println("å‘½ä¸­æ¬¡æ•°: " + hitCount.get());
        System.out.println("æœªå‘½ä¸­æ¬¡æ•°: " + missCount.get());
        System.out.println("å‘½ä¸­ç‡: " + String.format("%.2f%%", getHitRate()));
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç¼“å­˜æœ¬è´¨ï¼šç”¨å†…å­˜æ¢é€Ÿåº¦ï¼Œç©ºé—´æ¢æ—¶é—´
ğŸ”¸ äºŒçº§ç¼“å­˜ï¼šMapperçº§åˆ«ï¼Œè·¨ä¼šè¯å…±äº«
ğŸ”¸ Redisé›†æˆï¼šåˆ†å¸ƒå¼ç¯å¢ƒçš„æœ€ä½³é€‰æ‹©
ğŸ”¸ ä¸‰å¤§é—®é¢˜ï¼šç©¿é€ã€å‡»ç©¿ã€é›ªå´©
ğŸ”¸ æ›´æ–°ç­–ç•¥ï¼šå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜
ğŸ”¸ åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢å¹¶å‘å¯¼è‡´çš„ç¼“å­˜å‡»ç©¿
```

### 9.2 å…³é”®æŠ€æœ¯å¯¹æ¯”


| é—®é¢˜ç±»å‹ | **ç°è±¡** | **è§£å†³æ–¹æ¡ˆ** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|------------|------------|
| ğŸ¯ **ç¼“å­˜ç©¿é€** | `æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®` | `ç¼“å­˜ç©ºå€¼ / å¸ƒéš†è¿‡æ»¤å™¨` | `é˜²æ¶æ„æ”»å‡»` |
| âš¡ **ç¼“å­˜å‡»ç©¿** | `çƒ­ç‚¹æ•°æ®è¿‡æœŸ` | `åˆ†å¸ƒå¼é” / æ°¸ä¸è¿‡æœŸ` | `çƒ­é—¨å•†å“/æ´»åŠ¨` |
| ğŸ’¥ **ç¼“å­˜é›ªå´©** | `å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ` | `éšæœºè¿‡æœŸæ—¶é—´ / é›†ç¾¤` | `å¤§ä¿ƒæ´»åŠ¨` |

### 9.3 æœ€ä½³å®è·µæ¸…å•


::: tip æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•
âœ… åˆç†è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆä¸åŒæ•°æ®ä¸åŒç­–ç•¥ï¼‰  
âœ… ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œå¼€é”€  
âœ… å®ç°ç¼“å­˜é¢„çƒ­ï¼Œé¿å…å†·å¯åŠ¨å‹åŠ›  
âœ… ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥  
âœ… ä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢å‡»ç©¿  
âœ… å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç©¿é€  
âœ… éšæœºè¿‡æœŸæ—¶é—´é˜²æ­¢é›ªå´©  
âœ… å®šæœŸæ¸…ç†æ— æ•ˆç¼“å­˜
:::

### 9.4 å¸¸è§é”™è¯¯æ€»ç»“


**âŒ é”™è¯¯åšæ³•**ï¼š
```java
// 1. ç¼“å­˜æ—¶é—´è®¾ç½®è¿‡é•¿
redisTemplate.opsForValue().set(key, value, 365, TimeUnit.DAYS);  // 1å¹´ï¼Ÿå¤ªé•¿äº†ï¼

// 2. ä¸å¤„ç†ç¼“å­˜ç©¿é€
if (cache == null) {
    return db.query();  // ç›´æ¥æŸ¥æ•°æ®åº“ï¼Œæ²¡æœ‰é˜²æŠ¤
}

// 3. å¿˜è®°åºåˆ—åŒ–
public class User {  // æ²¡æœ‰implements Serializable
    // ç¼“å­˜ä¼šå¤±è´¥ï¼
}

// 4. æ›´æ–°é¡ºåºé”™è¯¯
cache.delete(key);     // å…ˆåˆ ç¼“å­˜
db.update(data);       // å†æ›´æ–°æ•°æ®åº“ - å®¹æ˜“å‡ºç°è„æ•°æ®
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
```java
// 1. åˆç†çš„è¿‡æœŸæ—¶é—´
redisTemplate.opsForValue().set(key, value, 1, TimeUnit.HOURS);

// 2. ç¼“å­˜ç©ºå€¼é˜²ç©¿é€
if (data == null) {
    redisTemplate.opsForValue().set(key, NULL_VALUE, 5, TimeUnit.MINUTES);
}

// 3. å®ç°åºåˆ—åŒ–
public class User implements Serializable {
    private static final long serialVersionUID = 1L;
    // ...
}

// 4. å…ˆæ›´æ–°ååˆ é™¤
db.update(data);       // å…ˆæ›´æ–°æ•°æ®åº“
cache.delete(key);     // å†åˆ é™¤ç¼“å­˜
```

### 9.5 å­¦ä¹ è·¯çº¿å»ºè®®


```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç†è§£
â”œâ”€â”€ ç†è§£ç¼“å­˜çš„ä½œç”¨å’ŒåŸç†
â”œâ”€â”€ æŒæ¡MyBatisäºŒçº§ç¼“å­˜é…ç½®
â””â”€â”€ äº†è§£ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸ

ç¬¬äºŒé˜¶æ®µï¼šå®æˆ˜åº”ç”¨
â”œâ”€â”€ é›†æˆRedisç¼“å­˜
â”œâ”€â”€ å¤„ç†ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜
â””â”€â”€ å®ç°ç¼“å­˜æ›´æ–°ç­–ç•¥

ç¬¬ä¸‰é˜¶æ®µï¼šé—®é¢˜è§£å†³
â”œâ”€â”€ è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜
â”œâ”€â”€ é˜²æ­¢ç¼“å­˜å‡»ç©¿
â””â”€â”€ é¿å…ç¼“å­˜é›ªå´©

ç¬¬å››é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ æ‰¹é‡æ“ä½œä¼˜åŒ–
â”œâ”€â”€ ç¼“å­˜é¢„çƒ­ç­–ç•¥
â””â”€â”€ ç›‘æ§å’Œè°ƒä¼˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ç¼“å­˜æé€Ÿéœ€è°¨æ…ï¼Œä¸€è‡´æ€§é—®é¢˜è¦é‡è§†  
> ç©¿é€å‡»ç©¿åŠ é›ªå´©ï¼Œä¸‰å¤§é—®é¢˜é¡»é˜²èŒƒ  
> å…ˆæ›´æ•°æ®ååˆ ç¼“ï¼Œåˆ†å¸ƒå¼é”ä¿å®‰å…¨  
> ç›‘æ§é¢„çƒ­å¸¸ä¼˜åŒ–ï¼Œæ€§èƒ½æå‡çœ‹å¾—è§