---
title: 64ã€SQLæ³¨å…¥é˜²æŠ¤æ·±å…¥
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯SQLæ³¨å…¥](#1-ä»€ä¹ˆæ˜¯SQLæ³¨å…¥)
2. [å‚æ•°åŒ–æŸ¥è¯¢åº•å±‚åŸç†](#2-å‚æ•°åŒ–æŸ¥è¯¢åº•å±‚åŸç†)
3. [Wrapperå®‰å…¨ä½¿ç”¨è¾¹ç•Œ](#3-Wrapperå®‰å…¨ä½¿ç”¨è¾¹ç•Œ)
4. [è¾“å…¥å‚æ•°æ ¡éªŒæœºåˆ¶](#4-è¾“å…¥å‚æ•°æ ¡éªŒæœºåˆ¶)
5. [ç™½åå•è¿‡æ»¤ç­–ç•¥](#5-ç™½åå•è¿‡æ»¤ç­–ç•¥)
6. [ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†](#6-ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†)
7. [å®‰å…¨ç¼–ç è§„èŒƒ](#7-å®‰å…¨ç¼–ç è§„èŒƒ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ ä»€ä¹ˆæ˜¯SQLæ³¨å…¥


### 1.1 SQLæ³¨å…¥çš„æœ¬è´¨


**é€šä¿—ç†è§£**ï¼šSQLæ³¨å…¥å°±åƒæ˜¯ä½ è®©åˆ«äººå¸®ä½ å†™ä¿¡ï¼Œç»“æœä»–åœ¨ä¿¡é‡Œå·å·åŠ äº†è‡ªå·±çš„è¯ã€‚

```
æ­£å¸¸æƒ…å†µï¼ˆä½ æƒ³è¦çš„ï¼‰ï¼š
"è¯·å¸®æˆ‘æŸ¥è¯¢ç”¨æˆ·åä¸º'å¼ ä¸‰'çš„ä¿¡æ¯"
â†’ SELECT * FROM user WHERE name = 'å¼ ä¸‰'

è¢«æ³¨å…¥åï¼ˆé»‘å®¢æé¬¼ï¼‰ï¼š
"è¯·å¸®æˆ‘æŸ¥è¯¢ç”¨æˆ·åä¸º'å¼ ä¸‰' OR 1=1 --'çš„ä¿¡æ¯"  
â†’ SELECT * FROM user WHERE name = 'å¼ ä¸‰' OR 1=1 --'
   ï¼ˆè¿™æ ·å°±æŸ¥å‡ºäº†æ‰€æœ‰ç”¨æˆ·ï¼ï¼‰
```

**æ ¸å¿ƒé—®é¢˜**ï¼š
- ğŸš« æŠŠç”¨æˆ·è¾“å…¥çš„å†…å®¹ç›´æ¥æ‹¼æ¥åˆ°SQLè¯­å¥é‡Œ
- ğŸš« é»‘å®¢é€šè¿‡è¾“å…¥ç‰¹æ®Šå­—ç¬¦æ”¹å˜SQLè¯­å¥çš„å«ä¹‰
- ğŸš« å¯¼è‡´æ•°æ®æ³„éœ²ã€è¢«ç¯¡æ”¹ç”šè‡³åˆ é™¤

### 1.2 çœŸå®å±å®³ç¤ºä¾‹


**åœºæ™¯1ï¼šç»•è¿‡ç™»å½•éªŒè¯**
```java
// âŒ å±é™©å†™æ³•ï¼ˆç›´æ¥æ‹¼æ¥ï¼‰
String username = request.getParameter("username"); // è¾“å…¥ï¼šadmin' --
String password = request.getParameter("password"); 
String sql = "SELECT * FROM user WHERE username='" + username + "' AND password='" + password + "'";

// å®é™…æ‰§è¡Œçš„SQLå˜æˆï¼š
// SELECT * FROM user WHERE username='admin' --' AND password='xxx'
// -- åé¢çš„å†…å®¹è¢«æ³¨é‡Šæ‰äº†ï¼Œä¸éœ€è¦å¯†ç å°±èƒ½ç™»å½•ï¼
```

**åœºæ™¯2ï¼šåˆ é™¤æ•´ä¸ªæ•°æ®è¡¨**
```java
// âŒ å±é™©å†™æ³•
String id = request.getParameter("id"); // è¾“å…¥ï¼š1; DROP TABLE user; --
String sql = "DELETE FROM orders WHERE id=" + id;

// å®é™…æ‰§è¡Œï¼š
// DELETE FROM orders WHERE id=1; DROP TABLE user; --
// ä¸ä»…åˆ é™¤è®¢å•ï¼Œè¿˜æŠŠæ•´ä¸ªç”¨æˆ·è¡¨åˆ äº†ï¼
```

> âš ï¸ **é‡è¦æé†’**
> 
> SQLæ³¨å…¥ä¸æ˜¯æŠ€æœ¯æ¼æ´ï¼Œè€Œæ˜¯ä»£ç å†™æ³•é—®é¢˜ï¼åªè¦ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥åˆ°SQLï¼Œå°±æœ‰é£é™©ã€‚

---

## 2. ğŸ›¡ï¸ å‚æ•°åŒ–æŸ¥è¯¢åº•å±‚åŸç†


### 2.1 ä»€ä¹ˆæ˜¯å‚æ•°åŒ–æŸ¥è¯¢


**é€šä¿—ç†è§£**ï¼šæŠŠSQLè¯­å¥å’Œæ•°æ®åˆ†å¼€å¤„ç†ï¼Œå°±åƒå¡«ç©ºé¢˜ã€‚

```
ä¼ ç»Ÿæ‹¼æ¥ï¼ˆå±é™©ï¼‰ï¼š
æŠŠç”¨æˆ·å"å¼ ä¸‰"ç›´æ¥å¡è¿›SQLè¯­å¥
â†’ SELECT * FROM user WHERE name = 'å¼ ä¸‰'

å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå®‰å…¨ï¼‰ï¼š
å…ˆå‡†å¤‡å¥½SQLæ¨¡æ¿ï¼šSELECT * FROM user WHERE name = ?
å†æŠŠ"å¼ ä¸‰"ä½œä¸ºå‚æ•°å¡«è¿›å»ï¼Œæ•°æ®åº“çŸ¥é“è¿™åªæ˜¯æ•°æ®ï¼Œä¸æ˜¯SQLæŒ‡ä»¤
```

### 2.2 MyBatis-Plusä¸­çš„å‚æ•°åŒ–


**è‡ªåŠ¨å‚æ•°åŒ–**ï¼šMyBatis-Plusé»˜è®¤å°±ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
```java
// âœ… å®‰å…¨å†™æ³•ï¼ˆMyBatis-Plusè‡ªåŠ¨å‚æ•°åŒ–ï¼‰
String username = "admin' OR 1=1 --"; // å³ä½¿è¾“å…¥æ¶æ„å­—ç¬¦
User user = userMapper.selectOne(
    new QueryWrapper<User>().eq("username", username)
);

// MyBatis-Plusç”Ÿæˆçš„SQLï¼š
// SELECT * FROM user WHERE username = ?
// å‚æ•°å€¼ï¼šadmin' OR 1=1 --ï¼ˆè¢«å½“ä½œæ™®é€šå­—ç¬¦ä¸²ï¼‰
```

**åº•å±‚å·¥ä½œåŸç†**ï¼š

```
æ­¥éª¤1ï¼šSQLé¢„ç¼–è¯‘
æ•°æ®åº“å…ˆç¼–è¯‘SQLæ¨¡æ¿ï¼šSELECT * FROM user WHERE name = ?
æ­¤æ—¶åªç¡®å®šSQLç»“æ„ï¼Œä¸ç®¡å…·ä½“æ•°æ®

æ­¥éª¤2ï¼šå‚æ•°ç»‘å®š
æŠŠç”¨æˆ·è¾“å…¥"admin' OR 1=1"ç»‘å®šåˆ° ? å ä½ç¬¦
æ•°æ®åº“æŠŠå®ƒå½“ä½œçº¯å­—ç¬¦ä¸²ï¼Œä¸ä¼šè§£æå…¶ä¸­çš„SQLå…³é”®å­—

æ­¥éª¤3ï¼šæ‰§è¡ŒæŸ¥è¯¢
æ•°æ®åº“æ‰§è¡Œæ—¶ï¼ŒæŠŠå‚æ•°å½“ä½œæ•°æ®å€¼ï¼Œä¸å½“ä½œSQLæŒ‡ä»¤
```

### 2.3 #{} vs ${}çš„åŒºåˆ«


| å†™æ³• | **è¯´æ˜** | **å®‰å…¨æ€§** | **é€‚ç”¨åœºæ™¯** |
|------|----------|-----------|-------------|
| `#{}` | `å‚æ•°åŒ–æŸ¥è¯¢ï¼Œè‡ªåŠ¨åŠ å¼•å·` | âœ… **å®‰å…¨** | `æ™®é€šå€¼æŸ¥è¯¢` |
| `${}` | `ç›´æ¥æ‹¼æ¥ï¼Œä¸åŠ å¼•å·` | âŒ **å±é™©** | `åŠ¨æ€è¡¨åã€åˆ—å` |

```java
// âœ… å®‰å…¨ï¼šä½¿ç”¨ #{}
@Select("SELECT * FROM user WHERE name = #{name}")
User findByName(String name);

// âŒ å±é™©ï¼šä½¿ç”¨ ${}
@Select("SELECT * FROM user WHERE name = '${name}'")
User findByNameDanger(String name); // æœ‰SQLæ³¨å…¥é£é™©ï¼
```

> ğŸ’¡ **è®°å¿†å£è¯€**
> 
> - `#{}` = å®‰å…¨çš„å‚æ•°ï¼Œæ•°æ®åº“ä¼šåŠ å¼•å·ä¿æŠ¤
> - `${}` = ç›´æ¥æ›¿æ¢ï¼Œç›¸å½“äºå­—ç¬¦ä¸²æ‹¼æ¥

---

## 3. âš™ï¸ Wrapperå®‰å…¨ä½¿ç”¨è¾¹ç•Œ


### 3.1 Wrapperçš„å®‰å…¨ç‰¹æ€§


**QueryWrapperé»˜è®¤æ˜¯å®‰å…¨çš„**ï¼š
```java
// âœ… è¿™äº›éƒ½æ˜¯å®‰å…¨çš„
QueryWrapper<User> wrapper = new QueryWrapper<>();

wrapper.eq("username", userInput);        // å®‰å…¨ï¼šè‡ªåŠ¨å‚æ•°åŒ–
wrapper.like("nickname", userInput);      // å®‰å…¨ï¼šè‡ªåŠ¨å‚æ•°åŒ–
wrapper.between("age", 18, 30);           // å®‰å…¨ï¼šè‡ªåŠ¨å‚æ•°åŒ–
wrapper.in("status", Arrays.asList(1,2)); // å®‰å…¨ï¼šè‡ªåŠ¨å‚æ•°åŒ–
```

**æ ¸å¿ƒåŸç†**ï¼šWrapperçš„æ¡ä»¶æ–¹æ³•éƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå‚æ•°åŒ–æŸ¥è¯¢

### 3.2 å±é™©çš„ä½¿ç”¨æ–¹å¼


**æƒ…å†µ1ï¼šæ‹¼æ¥SQLç‰‡æ®µ**
```java
// âŒ å±é™©ï¼šç›´æ¥æ‹¼æ¥SQL
String condition = request.getParameter("condition"); // å¯èƒ½æ˜¯æ¶æ„SQL
wrapper.apply(condition); // ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„SQLï¼

// æ­£ç¡®åšæ³•ï¼š
if ("active".equals(status)) {
    wrapper.eq("status", 1);
} else if ("inactive".equals(status)) {
    wrapper.eq("status", 0);
}
```

**æƒ…å†µ2ï¼šåŠ¨æ€æ’åºå­—æ®µ**
```java
// âŒ å±é™©ï¼šç”¨æˆ·æ§åˆ¶æ’åºå­—æ®µ
String orderBy = request.getParameter("orderBy"); // è¾“å…¥ï¼šid; DROP TABLE user; --
wrapper.orderByAsc(orderBy); // å¯èƒ½è¢«æ³¨å…¥ï¼

// âœ… å®‰å…¨ï¼šç™½åå•æ ¡éªŒ
Set<String> allowedFields = new HashSet<>(Arrays.asList("id", "name", "createTime"));
if (allowedFields.contains(orderBy)) {
    wrapper.orderByAsc(orderBy);
}
```

### 3.3 å®‰å…¨è¾¹ç•Œæ€»ç»“


```
å®‰å…¨åŒºåŸŸï¼ˆè‡ªåŠ¨é˜²æŠ¤ï¼‰ï¼š
â”œâ”€ eq(), ne(), gt(), lt()      â†’ æ¯”è¾ƒæ¡ä»¶
â”œâ”€ like(), notLike()            â†’ æ¨¡ç³ŠæŸ¥è¯¢
â”œâ”€ in(), notIn()                â†’ èŒƒå›´æŸ¥è¯¢
â”œâ”€ between()                    â†’ åŒºé—´æŸ¥è¯¢
â””â”€ isNull(), isNotNull()        â†’ ç©ºå€¼åˆ¤æ–­

å±é™©åŒºåŸŸï¼ˆéœ€è¦æ‰‹åŠ¨é˜²æŠ¤ï¼‰ï¼š
â”œâ”€ apply()                      â†’ æ‹¼æ¥ä»»æ„SQL
â”œâ”€ last()                       â†’ æ‹¼æ¥SQLå°¾éƒ¨
â”œâ”€ orderBy() + ç”¨æˆ·è¾“å…¥         â†’ åŠ¨æ€æ’åºå­—æ®µ
â””â”€ åŠ¨æ€è¡¨å/åˆ—å                â†’ éœ€è¦ç™½åå•éªŒè¯
```

---

## 4. ğŸ” è¾“å…¥å‚æ•°æ ¡éªŒæœºåˆ¶


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°æ ¡éªŒ


**é˜²æŠ¤å±‚æ¬¡ç†è§£**ï¼š
```
ç”¨æˆ·è¾“å…¥
   â†“
ç¬¬ä¸€å±‚ï¼šå‚æ•°æ ¼å¼æ ¡éªŒ â† æ‹¦æˆªæ˜æ˜¾çš„æ¶æ„è¾“å…¥
   â†“
ç¬¬äºŒå±‚ï¼šä¸šåŠ¡é€»è¾‘æ ¡éªŒ â† ç¡®ä¿æ•°æ®ç¬¦åˆä¸šåŠ¡è§„åˆ™
   â†“  
ç¬¬ä¸‰å±‚ï¼šSQLå‚æ•°åŒ–   â† æœ€åçš„å®‰å…¨ä¿éšœ
   â†“
æ•°æ®åº“
```

> ğŸ’¡ **æ ¸å¿ƒæ€æƒ³**
> 
> å‚æ•°åŒ–æŸ¥è¯¢æ˜¯æœ€åä¸€é“é˜²çº¿ï¼Œä½†ä¸åº”è¯¥æ˜¯å”¯ä¸€é˜²çº¿ï¼

### 4.2 ä½¿ç”¨JSR303æ ¡éªŒ


**åŸºç¡€æ ¡éªŒæ³¨è§£**ï¼š
```java
public class UserQuery {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^[a-zA-Z0-9_]{3,20}$", message = "ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿")
    private String username;
    
    @Min(value = 1, message = "å¹´é¾„æœ€å°ä¸º1")
    @Max(value = 150, message = "å¹´é¾„æœ€å¤§ä¸º150")
    private Integer age;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
}
```

**åœ¨Controllerä¸­ä½¿ç”¨**ï¼š
```java
@RestController
public class UserController {
    
    @PostMapping("/user/search")
    public Result search(@Valid @RequestBody UserQuery query) {
        // @Valid ä¼šè‡ªåŠ¨æ ¡éªŒï¼Œä¸ç¬¦åˆè§„åˆ™ç›´æ¥è¿”å›é”™è¯¯
        return userService.search(query);
    }
}
```

### 4.3 è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™


**å¤æ‚ä¸šåŠ¡æ ¡éªŒ**ï¼š
```java
public void searchUser(UserQuery query) {
    // æ ¡éªŒæ’åºå­—æ®µ
    validateSortField(query.getSortField());
    
    // æ ¡éªŒæŸ¥è¯¢æ¡ä»¶
    validateSearchCondition(query);
    
    // æ‰§è¡ŒæŸ¥è¯¢
    List<User> users = userMapper.selectList(buildWrapper(query));
}

private void validateSortField(String field) {
    // ç™½åå•æ ¡éªŒ
    Set<String> allowed = new HashSet<>(Arrays.asList("id", "name", "createTime"));
    if (!allowed.contains(field)) {
        throw new IllegalArgumentException("ä¸æ”¯æŒçš„æ’åºå­—æ®µ: " + field);
    }
}
```

---

## 5. ğŸ“ ç™½åå•è¿‡æ»¤ç­–ç•¥


### 5.1 ä»€ä¹ˆæ˜¯ç™½åå•


**é€šä¿—ç†è§£**ï¼šåªå…è®¸é€šè¿‡æ£€æŸ¥çš„"å¥½äºº"è¿›æ¥ï¼Œå…¶ä»–å…¨éƒ¨æ‹’ç»ã€‚

```
é»‘åå•æ€ç»´ï¼ˆä¸æ¨èï¼‰ï¼š
åˆ—å‡ºæ‰€æœ‰åçš„ä¸œè¥¿ï¼Œå…¶ä»–éƒ½å…è®¸
é—®é¢˜ï¼šåä¸œè¥¿å¤ªå¤šï¼Œå¯èƒ½é—æ¼

ç™½åå•æ€ç»´ï¼ˆæ¨èï¼‰ï¼š
åˆ—å‡ºæ‰€æœ‰å…è®¸çš„ä¸œè¥¿ï¼Œå…¶ä»–å…¨éƒ¨æ‹’ç»  
ä¼˜åŠ¿ï¼šé»˜è®¤æ‹’ç»ï¼Œæ›´å®‰å…¨
```

### 5.2 å­—æ®µç™½åå•


**åŠ¨æ€æ’åºå­—æ®µç™½åå•**ï¼š
```java
public class SafeQueryHelper {
    
    // å®šä¹‰å…è®¸æ’åºçš„å­—æ®µç™½åå•
    private static final Set<String> ALLOWED_SORT_FIELDS = new HashSet<>(
        Arrays.asList("id", "username", "createTime", "updateTime", "status")
    );
    
    // å®‰å…¨çš„æ’åºæ–¹æ³•
    public static void safeOrderBy(QueryWrapper<?> wrapper, String field, boolean isAsc) {
        // ç™½åå•æ ¡éªŒ
        if (!ALLOWED_SORT_FIELDS.contains(field)) {
            throw new IllegalArgumentException("ä¸æ”¯æŒçš„æ’åºå­—æ®µ: " + field);
        }
        
        // é€šè¿‡æ ¡éªŒåæ‰æ‰§è¡Œ
        if (isAsc) {
            wrapper.orderByAsc(field);
        } else {
            wrapper.orderByDesc(field);
        }
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// âœ… å®‰å…¨ä½¿ç”¨
String sortField = request.getParameter("sort"); // ç”¨æˆ·è¾“å…¥
QueryWrapper<User> wrapper = new QueryWrapper<>();
SafeQueryHelper.safeOrderBy(wrapper, sortField, true);
```

### 5.3 è¡¨å/åˆ—åç™½åå•


**åŠ¨æ€è¡¨åæ ¡éªŒ**ï¼š
```java
public class TableValidator {
    
    private static final Set<String> ALLOWED_TABLES = new HashSet<>(
        Arrays.asList("user", "order", "product")
    );
    
    public static String validateTableName(String tableName) {
        if (!ALLOWED_TABLES.contains(tableName.toLowerCase())) {
            throw new SecurityException("éæ³•çš„è¡¨å: " + tableName);
        }
        return tableName;
    }
}

// ä½¿ç”¨
String tableName = request.getParameter("table");
tableName = TableValidator.validateTableName(tableName);
// ç¡®ä¿å®‰å…¨åæ‰ä½¿ç”¨
```

---

## 6. ğŸ”¤ ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†


### 6.1 éœ€è¦è½¬ä¹‰çš„ç‰¹æ®Šå­—ç¬¦


**SQLä¸­çš„ç‰¹æ®Šå­—ç¬¦**ï¼š
```
'  å•å¼•å·  â†’ ç”¨äºå­—ç¬¦ä¸²è¾¹ç•Œ
"  åŒå¼•å·  â†’ ç”¨äºæ ‡è¯†ç¬¦
\  åæ–œæ   â†’ è½¬ä¹‰å­—ç¬¦
%  ç™¾åˆ†å·  â†’ LIKEé€šé…ç¬¦ï¼ˆä»»æ„å­—ç¬¦ï¼‰
_  ä¸‹åˆ’çº¿  â†’ LIKEé€šé…ç¬¦ï¼ˆå•ä¸ªå­—ç¬¦ï¼‰
;  åˆ†å·    â†’ SQLè¯­å¥åˆ†éš”ç¬¦
--  è¿å­—ç¬¦  â†’ SQLæ³¨é‡Š
/*  æ³¨é‡Šå¼€å§‹
*/  æ³¨é‡Šç»“æŸ
```

### 6.2 MyBatis-Plusè‡ªåŠ¨å¤„ç†


**å‚æ•°åŒ–æŸ¥è¯¢è‡ªåŠ¨è½¬ä¹‰**ï¼š
```java
// âœ… MyBatis-Plusè‡ªåŠ¨å¤„ç†ç‰¹æ®Šå­—ç¬¦
String keyword = "admin'OR'1'='1"; // åŒ…å«å•å¼•å·çš„æ¶æ„è¾“å…¥
wrapper.like("username", keyword);

// ç”Ÿæˆçš„SQLï¼š
// SELECT * FROM user WHERE username LIKE CONCAT('%', ?, '%')
// å‚æ•°ï¼šadmin'OR'1'='1
// å•å¼•å·è¢«è‡ªåŠ¨è½¬ä¹‰ï¼Œä¸ä¼šç ´åSQLç»“æ„
```

### 6.3 LIKEæŸ¥è¯¢çš„ç‰¹æ®Šå¤„ç†


**é€šé…ç¬¦è½¬ä¹‰**ï¼š
```java
public String escapeLikePattern(String pattern) {
    if (pattern == null) return null;
    
    // è½¬ä¹‰LIKEç‰¹æ®Šå­—ç¬¦
    return pattern
        .replace("\\", "\\\\")  // åæ–œæ è½¬ä¹‰
        .replace("%", "\\%")    // ç™¾åˆ†å·è½¬ä¹‰
        .replace("_", "\\_");   // ä¸‹åˆ’çº¿è½¬ä¹‰
}

// ä½¿ç”¨
String userInput = "test_%";  // ç”¨æˆ·æƒ³æœç´¢åŒ…å«ä¸‹åˆ’çº¿çš„å†…å®¹
String escaped = escapeLikePattern(userInput); // å˜æˆï¼štest\_% 
wrapper.like("name", escaped);
```

**ä¸ºä»€ä¹ˆéœ€è¦è½¬ä¹‰é€šé…ç¬¦**ï¼š
```
ç”¨æˆ·è¾“å…¥ï¼štest_%
ä¸è½¬ä¹‰æŸ¥è¯¢ï¼šWHERE name LIKE '%test_%'  
â†’ åŒ¹é…ï¼štest_a, test_b, testXY (ä¸‹åˆ’çº¿è¢«å½“é€šé…ç¬¦)

è½¬ä¹‰åæŸ¥è¯¢ï¼šWHERE name LIKE '%test\_%'
â†’ åªåŒ¹é…ï¼štest_a, test_b (ä¸‹åˆ’çº¿å½“æ™®é€šå­—ç¬¦)
```

---

## 7. ğŸ“‹ å®‰å…¨ç¼–ç è§„èŒƒ


### 7.1 æ ¸å¿ƒå®‰å…¨åŸåˆ™


**åŸåˆ™1ï¼šæ°¸è¿œä¸ä¿¡ä»»ç”¨æˆ·è¾“å…¥**
```java
// âŒ å±é™©æ€ç»´
String input = request.getParameter("data");
// ç›´æ¥ä½¿ç”¨ï¼Œè®¤ä¸ºç”¨æˆ·æ˜¯å¥½äºº

// âœ… å®‰å…¨æ€ç»´  
String input = request.getParameter("data");
// 1. æ ¡éªŒæ ¼å¼
// 2. æ ¡éªŒé•¿åº¦
// 3. ç™½åå•è¿‡æ»¤
// 4. å†ä½¿ç”¨
```

**åŸåˆ™2ï¼šæœ€å°æƒé™åŸåˆ™**
```java
// æ•°æ®åº“è¿æ¥ä½¿ç”¨ä¸“ç”¨è´¦å·ï¼Œåªç»™å¿…è¦æƒé™
spring:
  datasource:
    username: app_user  # ä¸ç”¨root
    # åªç»™SELECT, INSERT, UPDATEæƒé™
    # ä¸ç»™DROP, CREATEç­‰å±é™©æƒé™
```

**åŸåˆ™3ï¼šåˆ†å±‚é˜²æŠ¤**
```java
// å¤šå±‚é˜²æŠ¤ï¼Œä¸ä¾èµ–å•ä¸€æ‰‹æ®µ
ç”¨æˆ·è¾“å…¥
  â†’ å‰ç«¯æ ¡éªŒï¼ˆæç¤ºç”¨æˆ·ï¼‰
  â†’ Controlleræ ¡éªŒï¼ˆæ‹¦æˆªæ˜æ˜¾é”™è¯¯ï¼‰  
  â†’ Serviceä¸šåŠ¡æ ¡éªŒï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
  â†’ å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆSQLå®‰å…¨ï¼‰
  â†’ æ•°æ®åº“æƒé™æ§åˆ¶ï¼ˆæœ€åé˜²çº¿ï¼‰
```

### 7.2 å®‰å…¨ç¼–ç æ£€æŸ¥æ¸…å•


**ä»£ç å®¡æŸ¥è¦ç‚¹**ï¼š

âœ… **å‚æ•°å¤„ç†**
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½è¿›è¡Œäº†æ ¡éªŒ
- [ ] ä½¿ç”¨äº†å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆ#{}ï¼‰
- [ ] é¿å…äº†ç›´æ¥æ‹¼æ¥ï¼ˆ${}ï¼‰
- [ ] LIKEæŸ¥è¯¢è½¬ä¹‰äº†é€šé…ç¬¦

âœ… **åŠ¨æ€SQL**
- [ ] åŠ¨æ€å­—æ®µä½¿ç”¨äº†ç™½åå•
- [ ] apply()åªç”¨äºå›ºå®šSQLç‰‡æ®µ
- [ ] ä¸ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„SQL

âœ… **æ•°æ®åº“é…ç½®**
- [ ] ä½¿ç”¨æœ€å°æƒé™è´¦å·
- [ ] å…³é—­äº†ä¸å¿…è¦çš„åŠŸèƒ½
- [ ] å®šæœŸæ›´æ–°æ•°æ®åº“ç‰ˆæœ¬

### 7.3 å¸¸è§é”™è¯¯ç¤ºèŒƒä¸ä¿®æ­£


**é”™è¯¯1ï¼šåŠ¨æ€åˆ—åæ‹¼æ¥**
```java
// âŒ é”™è¯¯
String column = request.getParameter("column");
wrapper.apply(column + " = 'value'"); // SQLæ³¨å…¥é£é™©

// âœ… æ­£ç¡®
Map<String, String> columnMap = new HashMap<>();
columnMap.put("name", "username");
columnMap.put("age", "user_age");

String userColumn = request.getParameter("column");
String dbColumn = columnMap.get(userColumn); // æ˜ å°„åˆ°çœŸå®åˆ—å
if (dbColumn != null) {
    wrapper.eq(dbColumn, "value");
}
```

**é”™è¯¯2ï¼šåŠ¨æ€æ’åº**
```java
// âŒ é”™è¯¯
String order = request.getParameter("order");
wrapper.last("ORDER BY " + order); // å±é™©ï¼

// âœ… æ­£ç¡®
Set<String> allowedFields = Set.of("id", "name", "createTime");
if (allowedFields.contains(order)) {
    wrapper.orderByAsc(order);
}
```

**é”™è¯¯3ï¼šæ‰¹é‡æ“ä½œæ‹¼æ¥**
```java
// âŒ é”™è¯¯
List<String> ids = getIdsFromUser();
String idStr = String.join(",", ids);
wrapper.apply("id IN (" + idStr + ")"); // å¦‚æœidsåŒ…å«æ¶æ„å€¼å‘¢ï¼Ÿ

// âœ… æ­£ç¡®
List<Long> ids = getIdsFromUser(); // ç¡®ä¿æ˜¯æ•°å­—ç±»å‹
wrapper.in("id", ids); // ä½¿ç”¨inæ–¹æ³•ï¼Œè‡ªåŠ¨å‚æ•°åŒ–
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SQLæ³¨å…¥æœ¬è´¨ï¼šç”¨æˆ·è¾“å…¥æ”¹å˜äº†SQLè¯­å¥çš„é€»è¾‘ç»“æ„
ğŸ”¸ å‚æ•°åŒ–æŸ¥è¯¢ï¼šæŠŠSQLå’Œæ•°æ®åˆ†å¼€ï¼Œæ•°æ®ä¸ä¼šè¢«å½“ä½œSQLæ‰§è¡Œ
ğŸ”¸ #{}å®‰å…¨ï¼šè‡ªåŠ¨å‚æ•°åŒ–ï¼Œæ¨èä½¿ç”¨
ğŸ”¸ ${}å±é™©ï¼šç›´æ¥æ‹¼æ¥ï¼Œé¿å…ä½¿ç”¨
ğŸ”¸ ç™½åå•ç­–ç•¥ï¼šåªå…è®¸å·²çŸ¥å®‰å…¨çš„è¾“å…¥ï¼Œé»˜è®¤æ‹’ç»å…¶ä»–
ğŸ”¸ å¤šå±‚é˜²æŠ¤ï¼šæ ¡éªŒ + å‚æ•°åŒ– + æƒé™æ§åˆ¶
```

### 8.2 å®‰å…¨ä½¿ç”¨é€ŸæŸ¥è¡¨


| åœºæ™¯ | **å®‰å…¨åšæ³•** | **å±é™©åšæ³•** |
|------|------------|------------|
| æ™®é€šæŸ¥è¯¢ | `wrapper.eq("name", input)` | `"name='" + input + "'"` |
| æ¨¡ç³ŠæŸ¥è¯¢ | `wrapper.like("name", escaped)` | `wrapper.apply("name LIKE '%" + input + "%'")` |
| åŠ¨æ€æ’åº | `ç™½åå•éªŒè¯ + wrapper.orderBy()` | `wrapper.last("ORDER BY " + input)` |
| INæŸ¥è¯¢ | `wrapper.in("id", list)` | `"id IN (" + join(list) + ")"` |
| åŠ¨æ€æ¡ä»¶ | `if/else + wrapperæ–¹æ³•` | `wrapper.apply(userInput)` |

### 8.3 è®°å¿†å£è¯€


```
è¾“å…¥ä¸å¯ä¿¡ï¼Œæ ¡éªŒç¬¬ä¸€å…³
å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå®‰å…¨çš„åº•çº¿  
åŠ¨æ€SQLæ…ç”¨ï¼Œç™½åå•ä¿å¹³å®‰
ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ï¼ŒLIKEè¦å°å¿ƒ
åˆ†å±‚æ¥é˜²æŠ¤ï¼Œä¸€ä¸ªéƒ½ä¸èƒ½å°‘
```

### 8.4 å®æˆ˜å»ºè®®


**æ–°æ‰‹å¸¸çŠ¯é”™è¯¯**ï¼š
1. è®¤ä¸ºMyBatis-Plusè‡ªåŠ¨é˜²æ³¨å…¥ï¼Œå°±ä¸åšä»»ä½•æ ¡éªŒ
2. ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨${}æ‹¼æ¥SQL
3. åŠ¨æ€å­—æ®µç›´æ¥ç”¨ç”¨æˆ·è¾“å…¥
4. å¿½ç•¥LIKEæŸ¥è¯¢çš„é€šé…ç¬¦è½¬ä¹‰

**æ­£ç¡®åšæ³•**ï¼š
1. âœ… è¾“å…¥æ ¡éªŒ + å‚æ•°åŒ–æŸ¥è¯¢åŒä¿é™©
2. âœ… ä¼˜å…ˆä½¿ç”¨#{}ï¼Œé¿å…${}
3. âœ… åŠ¨æ€å­—æ®µå¿…é¡»ç™½åå•éªŒè¯
4. âœ… LIKEæŸ¥è¯¢è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

> ğŸ’¡ **æœ€åæé†’**
> 
> SQLæ³¨å…¥é˜²æŠ¤ä¸æ˜¯ä¸€é¡¹æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§ç¼–ç ä¹ æƒ¯ï¼
> å…»æˆå®‰å…¨ç¼–ç ä¹ æƒ¯ï¼Œæ¯”è®°ä½æ‰€æœ‰è§„åˆ™æ›´é‡è¦ã€‚