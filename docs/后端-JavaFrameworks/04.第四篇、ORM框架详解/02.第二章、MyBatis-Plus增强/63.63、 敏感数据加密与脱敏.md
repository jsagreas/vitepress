---
title: 63ã€ æ•æ„Ÿæ•°æ®åŠ å¯†ä¸è„±æ•
---
## ğŸ“š ç›®å½•

1. [æ•æ„Ÿæ•°æ®å¤„ç†æ¦‚è¿°](#1-æ•æ„Ÿæ•°æ®å¤„ç†æ¦‚è¿°)
2. [å­—æ®µè‡ªåŠ¨åŠ è§£å¯†](#2-å­—æ®µè‡ªåŠ¨åŠ è§£å¯†)
3. [æ•°æ®è„±æ•ç­–ç•¥](#3-æ•°æ®è„±æ•ç­–ç•¥)
4. [TypeHandleråŠ å¯†å®ç°](#4-typehandleråŠ å¯†å®ç°)
5. [æ³¨è§£é©±åŠ¨è„±æ•](#5-æ³¨è§£é©±åŠ¨è„±æ•)
6. [åŠ å¯†å¯†é’¥ç®¡ç†](#6-åŠ å¯†å¯†é’¥ç®¡ç†)
7. [æ€§èƒ½å½±å“è¯„ä¼°](#7-æ€§èƒ½å½±å“è¯„ä¼°)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æ•æ„Ÿæ•°æ®å¤„ç†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿæ•°æ®


**ğŸ”¸ é€šä¿—ç†è§£**
```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
ä½ çš„é“¶è¡Œå¡å¯†ç ã€èº«ä»½è¯å·ã€æ‰‹æœºå·å°±æ˜¯æ•æ„Ÿæ•°æ®
- å­˜å‚¨æ—¶è¦åŠ å¯†ï¼ˆåƒæŠŠé’±æ”¾è¿›ä¿é™©æŸœï¼‰
- å±•ç¤ºæ—¶è¦è„±æ•ï¼ˆåƒ***é®ä½éƒ¨åˆ†ä¿¡æ¯ï¼‰
- ä¼ è¾“æ—¶è¦ä¿æŠ¤ï¼ˆåƒå¯†å°ä¿¡ä»¶ï¼‰

æ•°æ®åº“ä¸­çš„æ•æ„Ÿæ•°æ®ï¼š
ç”¨æˆ·è¡¨ï¼šèº«ä»½è¯å·ã€æ‰‹æœºå·ã€é“¶è¡Œå¡å·
è®¢å•è¡¨ï¼šæ”¶è´§åœ°å€ã€è”ç³»ç”µè¯
å‘˜å·¥è¡¨ï¼šè–ªèµ„ã€ç»©æ•ˆè€ƒæ ¸
```

**ğŸ“‹ æ•æ„Ÿæ•°æ®åˆ†ç±»**

| ç±»å‹ | **å…¸å‹æ•°æ®** | **å¤„ç†æ–¹å¼** | **æ³•å¾‹ä¾æ®** |
|------|-------------|-------------|-------------|
| ğŸ†” **èº«ä»½ä¿¡æ¯** | `èº«ä»½è¯ã€æŠ¤ç…§å·` | `åŠ å¯†å­˜å‚¨ + è„±æ•å±•ç¤º` | `ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•` |
| ğŸ“± **è”ç³»æ–¹å¼** | `æ‰‹æœºå·ã€é‚®ç®±` | `éƒ¨åˆ†è„±æ•` | `ç½‘ç»œå®‰å…¨æ³•` |
| ğŸ’³ **é‡‘èä¿¡æ¯** | `é“¶è¡Œå¡ã€æ”¯ä»˜å¯†ç ` | `å¼ºåŠ å¯† + ä¸¥æ ¼è„±æ•` | `é‡‘èæ•°æ®å®‰å…¨è§„èŒƒ` |
| ğŸ  **åœ°ç†ä½ç½®** | `è¯¦ç»†åœ°å€ã€GPS` | `åŒºåŸŸåŒ–è„±æ•` | `ä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•` |

### 1.2 ä¸ºä»€ä¹ˆè¦åŠ å¯†å’Œè„±æ•


**ğŸ”¸ æ ¸å¿ƒç›®æ ‡**
```
æ•°æ®å®‰å…¨ä¸‰è¦ç´ ï¼š

1. å­˜å‚¨å®‰å…¨ï¼ˆåŠ å¯†ï¼‰
   æ•°æ®åº“è¢«æ‹–åº“ â†’ çœ‹åˆ°çš„æ˜¯å¯†æ–‡
   ä¸¾ä¾‹ï¼šå¯†ç å­˜å‚¨ä¸ºåŠ å¯†åçš„å­—ç¬¦ä¸²

2. å±•ç¤ºå®‰å…¨ï¼ˆè„±æ•ï¼‰
   å®¢æœæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ â†’ åªçœ‹åˆ°éƒ¨åˆ†æ•°æ®
   ä¸¾ä¾‹ï¼šæ‰‹æœºå·æ˜¾ç¤ºä¸º 138****5678

3. ä¼ è¾“å®‰å…¨ï¼ˆåŠ å¯†é€šé“ï¼‰
   ç½‘ç»œä¼ è¾“è¿‡ç¨‹ â†’ ä½¿ç”¨HTTPSç­‰åè®®
```

**âš ï¸ ä¸å¤„ç†çš„é£é™©**
```
çœŸå®æ¡ˆä¾‹åœºæ™¯ï¼š

âŒ æœªåŠ å¯†å­˜å‚¨ï¼š
   - æ•°æ®åº“æ³„éœ² â†’ ç”¨æˆ·ä¿¡æ¯å…¨éƒ¨æš´éœ²
   - å†…éƒ¨äººå‘˜æ»¥ç”¨ â†’ å¯ç›´æ¥æŸ¥çœ‹æ‰€æœ‰æ•æ„Ÿä¿¡æ¯

âŒ æœªè„±æ•å±•ç¤ºï¼š
   - æ—¥å¿—è®°å½• â†’ æ•æ„Ÿä¿¡æ¯è¢«è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶
   - æŠ¥è¡¨å¯¼å‡º â†’ Excelä¸­åŒ…å«å®Œæ•´æ•æ„Ÿæ•°æ®

âŒ æ³•å¾‹è´£ä»»ï¼š
   - è¿åã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹â†’ é«˜é¢ç½šæ¬¾
   - ç”¨æˆ·æŠ•è¯‰ â†’ ä¼ä¸šä¿¡èª‰å—æŸ
```

### 1.3 MyBatis-Plusçš„è§£å†³æ–¹æ¡ˆ


**ğŸ”§ æŠ€æœ¯æ¶æ„**
```
æ•°æ®å¤„ç†æµç¨‹ï¼š

åº”ç”¨å±‚                   MyBatis-Plus              æ•°æ®åº“
  â†“                          â†“                      â†“
æ˜æ–‡æ•°æ®  â†’  [æ‹¦æˆªå™¨/TypeHandler]  â†’  åŠ å¯†åå­˜å‚¨
  â†‘                          â†‘                      â†‘
è„±æ•å±•ç¤º  â†  [è‡ªåŠ¨è§£å¯†å¤„ç†]  â†  è¯»å–å¯†æ–‡æ•°æ®

æ ¸å¿ƒç»„ä»¶ï¼š
âœ… TypeHandlerï¼šæ•°æ®ç±»å‹è½¬æ¢ï¼ˆåŠ è§£å¯†æ ¸å¿ƒï¼‰
âœ… æ‹¦æˆªå™¨ï¼šæ‰¹é‡å¤„ç†ï¼ˆå…¨å±€è„±æ•ï¼‰
âœ… æ³¨è§£ï¼šå£°æ˜å¼é…ç½®ï¼ˆç®€åŒ–å¼€å‘ï¼‰
```

---

## 2. ğŸ”„ å­—æ®µè‡ªåŠ¨åŠ è§£å¯†


### 2.1 åŠ è§£å¯†åŸºæœ¬åŸç†


**ğŸ”¸ å·¥ä½œæœºåˆ¶**
```
æ•°æ®å†™å…¥æµç¨‹ï¼š
æ˜æ–‡å¯†ç  "123456" 
    â†“
[åŠ å¯†ç®—æ³•å¤„ç†]
    â†“
å¯†æ–‡å­˜å‚¨ "e10adc3949ba59abbe56e057f20f883e"

æ•°æ®è¯»å–æµç¨‹ï¼š
å¯†æ–‡ "e10adc3949ba59abbe56e057f20f883e"
    â†“
[è§£å¯†ç®—æ³•å¤„ç†]
    â†“
æ˜æ–‡è¿˜åŸ "123456"

å…³é”®ç‚¹ï¼š
â€¢ å†™å…¥æ—¶è‡ªåŠ¨åŠ å¯†
â€¢ è¯»å–æ—¶è‡ªåŠ¨è§£å¯†
â€¢ å¯¹ä¸šåŠ¡ä»£ç é€æ˜ï¼ˆæ— æ„ŸçŸ¥ï¼‰
```

### 2.2 ä½¿ç”¨TypeHandlerå®ç°


**ğŸ’¡ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåŠ å¯†å·¥å…·ç±»**

```java
/**
 * AESåŠ å¯†å·¥å…·ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰
 * é€šä¿—ç†è§£ï¼šç”¨åŒä¸€æŠŠé’¥åŒ™åŠ å¯†å’Œè§£å¯†
 */
public class AESUtil {
    // å¯†é’¥ï¼ˆå®é™…é¡¹ç›®ä¸­åº”è¯¥æ”¾åœ¨é…ç½®æ–‡ä»¶ï¼‰
    private static final String SECRET_KEY = "MySecret16ByteKey";  // 16å­—èŠ‚å¯†é’¥
    
    /**
     * åŠ å¯†æ–¹æ³•
     * @param plainText æ˜æ–‡ï¼ˆä¾‹å¦‚ï¼šèº«ä»½è¯å·ï¼‰
     * @return å¯†æ–‡ï¼ˆåŠ å¯†åçš„å­—ç¬¦ä¸²ï¼‰
     */
    public static String encrypt(String plainText) {
        try {
            // 1. å‡†å¤‡å¯†é’¥
            SecretKeySpec keySpec = new SecretKeySpec(
                SECRET_KEY.getBytes(), "AES"
            );
            
            // 2. åˆå§‹åŒ–åŠ å¯†å™¨
            Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
            cipher.init(Cipher.ENCRYPT_MODE, keySpec);
            
            // 3. æ‰§è¡ŒåŠ å¯†
            byte[] encrypted = cipher.doFinal(plainText.getBytes());
            
            // 4. è½¬ä¸ºBase64å­—ç¬¦ä¸²ï¼ˆæ–¹ä¾¿å­˜å‚¨ï¼‰
            return Base64.getEncoder().encodeToString(encrypted);
            
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }
    
    /**
     * è§£å¯†æ–¹æ³•
     * @param cipherText å¯†æ–‡
     * @return æ˜æ–‡
     */
    public static String decrypt(String cipherText) {
        try {
            SecretKeySpec keySpec = new SecretKeySpec(
                SECRET_KEY.getBytes(), "AES"
            );
            
            Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
            cipher.init(Cipher.DECRYPT_MODE, keySpec);
            
            byte[] decoded = Base64.getDecoder().decode(cipherText);
            byte[] decrypted = cipher.doFinal(decoded);
            
            return new String(decrypted);
            
        } catch (Exception e) {
            throw new RuntimeException("è§£å¯†å¤±è´¥", e);
        }
    }
}
```

**ğŸ’¡ ç¬¬äºŒæ­¥ï¼šåˆ›å»ºTypeHandler**

```java
/**
 * åŠ å¯†å­—æ®µå¤„ç†å™¨
 * ä½œç”¨ï¼šæ‹¦æˆªæ•°æ®åº“æ“ä½œï¼Œè‡ªåŠ¨åŠ è§£å¯†
 */
@MappedTypes(String.class)  // å¤„ç†Stringç±»å‹å­—æ®µ
public class EncryptTypeHandler extends BaseTypeHandler<String> {
    
    /**
     * è®¾ç½®å‚æ•°æ—¶è°ƒç”¨ï¼ˆINSERT/UPDATEï¼‰
     * é€šä¿—ç†è§£ï¼šå­˜å…¥æ•°æ®åº“å‰ï¼Œå…ˆåŠ å¯†
     */
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    String parameter, JdbcType jdbcType) 
                                    throws SQLException {
        // åŠ å¯†æ˜æ–‡æ•°æ®
        String encrypted = AESUtil.encrypt(parameter);
        ps.setString(i, encrypted);
    }
    
    /**
     * è·å–ç»“æœæ—¶è°ƒç”¨ï¼ˆSELECTï¼‰
     * é€šä¿—ç†è§£ï¼šä»æ•°æ®åº“è¯»å–åï¼Œè‡ªåŠ¨è§£å¯†
     */
    @Override
    public String getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        String encrypted = rs.getString(columnName);
        return encrypted != null ? AESUtil.decrypt(encrypted) : null;
    }
    
    @Override
    public String getNullableResult(ResultSet rs, int columnIndex) 
                                   throws SQLException {
        String encrypted = rs.getString(columnIndex);
        return encrypted != null ? AESUtil.decrypt(encrypted) : null;
    }
    
    @Override
    public String getNullableResult(CallableStatement cs, int columnIndex) 
                                   throws SQLException {
        String encrypted = cs.getString(columnIndex);
        return encrypted != null ? AESUtil.decrypt(encrypted) : null;
    }
}
```

**ğŸ’¡ ç¬¬ä¸‰æ­¥ï¼šå®ä½“ç±»é…ç½®**

```java
@Data
@TableName("user")
public class User {
    @TableId
    private Long id;
    
    private String username;
    
    /**
     * èº«ä»½è¯å·å­—æ®µ - è‡ªåŠ¨åŠ å¯†å­˜å‚¨
     * typeHandleræŒ‡å®šä½¿ç”¨åŠ å¯†å¤„ç†å™¨
     */
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String idCard;
    
    /**
     * æ‰‹æœºå·å­—æ®µ - ä¹Ÿä½¿ç”¨åŠ å¯†
     */
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String phone;
    
    // æ™®é€šå­—æ®µä¸åŠ å¯†
    private Integer age;
}
```

### 2.3 å®é™…ä½¿ç”¨æ•ˆæœ


**ğŸ”§ ä¸šåŠ¡ä»£ç ç¤ºä¾‹**

```java
@Service
public class UserService {
    @Autowired
    private UserMapper userMapper;
    
    /**
     * ä¿å­˜ç”¨æˆ· - è‡ªåŠ¨åŠ å¯†
     */
    public void saveUser() {
        User user = new User();
        user.setUsername("å¼ ä¸‰");
        user.setIdCard("110101199001011234");  // æ˜æ–‡èº«ä»½è¯
        user.setPhone("13812345678");          // æ˜æ–‡æ‰‹æœºå·
        
        // ä¿å­˜æ—¶è‡ªåŠ¨åŠ å¯†
        userMapper.insert(user);
        
        // æ•°æ®åº“å®é™…å­˜å‚¨ï¼š
        // idCard: "Xyz123ABC..."  (åŠ å¯†åçš„å¯†æ–‡)
        // phone:  "Def456GHI..."  (åŠ å¯†åçš„å¯†æ–‡)
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ· - è‡ªåŠ¨è§£å¯†
     */
    public User getUser(Long id) {
        User user = userMapper.selectById(id);
        
        // è‡ªåŠ¨è§£å¯†ï¼Œç›´æ¥å¾—åˆ°æ˜æ–‡
        System.out.println(user.getIdCard());  // è¾“å‡º: 110101199001011234
        System.out.println(user.getPhone());   // è¾“å‡º: 13812345678
        
        return user;
    }
}
```

**ğŸ“Š æ•°æ®åº“å­˜å‚¨å¯¹æ¯”**

```
ä¸ä½¿ç”¨åŠ å¯†ï¼š
+----+----------+---------------------+-------------+
| id | username | id_card             | phone       |
+----+----------+---------------------+-------------+
| 1  | å¼ ä¸‰     | 110101199001011234  | 13812345678 |
+----+----------+---------------------+-------------+
é£é™©ï¼šæ•°æ®åº“æ³„éœ²åï¼Œæ•æ„Ÿä¿¡æ¯å…¨éƒ¨æš´éœ²

ä½¿ç”¨åŠ å¯†åï¼š
+----+----------+------------------------+------------------------+
| id | username | id_card                | phone                  |
+----+----------+------------------------+------------------------+
| 1  | å¼ ä¸‰     | Xyz123ABC...å¯†æ–‡...    | Def456GHI...å¯†æ–‡...    |
+----+----------+------------------------+------------------------+
å®‰å…¨ï¼šå³ä½¿æ•°æ®åº“æ³„éœ²ï¼Œä¹Ÿæ— æ³•ç›´æ¥çœ‹åˆ°æ•æ„Ÿä¿¡æ¯
```

---

## 3. ğŸ­ æ•°æ®è„±æ•ç­–ç•¥


### 3.1 ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•


**ğŸ”¸ é€šä¿—ç†è§£**
```
è„±æ• = éƒ¨åˆ†éšè—æ•æ„Ÿä¿¡æ¯

ç”Ÿæ´»åœºæ™¯ï¼š
âœ… ç”µå•†è®¢å•ï¼š156****8901ï¼ˆéšè—ä¸­é—´4ä½ï¼‰
âœ… èº«ä»½è¯ï¼š   3301**********5678ï¼ˆéšè—ä¸­é—´ï¼‰
âœ… é“¶è¡Œå¡ï¼š   6222 **** **** 1234ï¼ˆåªæ˜¾ç¤ºå‰åï¼‰
âœ… é‚®ç®±ï¼š     zhang***@qq.comï¼ˆéšè—éƒ¨åˆ†è´¦å·ï¼‰

æ ¸å¿ƒæ€æƒ³ï¼š
â€¢ æ—¢èƒ½è¯†åˆ«æ•°æ®å½’å±
â€¢ åˆä¸å®Œå…¨æš´éœ²æ•æ„Ÿä¿¡æ¯
```

### 3.2 å¸¸è§è„±æ•è§„åˆ™


**ğŸ“‹ è„±æ•è§„åˆ™å¯¹ç…§è¡¨**

| æ•°æ®ç±»å‹ | **åŸå§‹æ•°æ®** | **è„±æ•å** | **è„±æ•è§„åˆ™** |
|---------|-------------|-----------|-------------|
| ğŸ“± **æ‰‹æœºå·** | `13812345678` | `138****5678` | `ä¿ç•™å‰3å4ä½` |
| ğŸ†” **èº«ä»½è¯** | `330102199001011234` | `3301**********1234` | `ä¿ç•™å‰4å4ä½` |
| ğŸ’³ **é“¶è¡Œå¡** | `6222021234567890` | `6222 **** **** 7890` | `ä¿ç•™å‰4å4ä½` |
| ğŸ“§ **é‚®ç®±** | `zhangsan@qq.com` | `zha***@qq.com` | `@å‰ä¿ç•™3ä½` |
| ğŸ  **åœ°å€** | `æµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒºXXè·¯XXå·` | `æµ™æ±Ÿçœæ­å·å¸‚****` | `ä¿ç•™åˆ°å¸‚çº§` |
| ğŸ’° **é‡‘é¢** | `123456.78` | `12****78` | `éšè—ä¸­é—´ä½` |

### 3.3 å®ç°è„±æ•å·¥å…·ç±»


**ğŸ’¡ è„±æ•å·¥å…·å®ç°**

```java
/**
 * æ•°æ®è„±æ•å·¥å…·ç±»
 * æä¾›å„ç§å¸¸ç”¨è„±æ•æ–¹æ³•
 */
public class DesensitizeUtil {
    
    /**
     * æ‰‹æœºå·è„±æ•
     * 13812345678 â†’ 138****5678
     */
    public static String phone(String phone) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        return phone.substring(0, 3) + "****" + phone.substring(7);
    }
    
    /**
     * èº«ä»½è¯å·è„±æ•
     * 330102199001011234 â†’ 3301**********1234
     */
    public static String idCard(String idCard) {
        if (idCard == null || idCard.length() < 8) {
            return idCard;
        }
        int length = idCard.length();
        return idCard.substring(0, 4) + 
               "**********" + 
               idCard.substring(length - 4);
    }
    
    /**
     * é“¶è¡Œå¡å·è„±æ•
     * 6222021234567890 â†’ 6222 **** **** 7890
     */
    public static String bankCard(String cardNo) {
        if (cardNo == null || cardNo.length() < 8) {
            return cardNo;
        }
        int length = cardNo.length();
        String front = cardNo.substring(0, 4);
        String back = cardNo.substring(length - 4);
        
        // è®¡ç®—ä¸­é—´éœ€è¦å¤šå°‘ä¸ª*
        int starCount = length - 8;
        String middle = "*".repeat(Math.max(0, starCount));
        
        return front + " " + middle + " " + back;
    }
    
    /**
     * é‚®ç®±è„±æ•
     * zhangsan@qq.com â†’ zha***@qq.com
     */
    public static String email(String email) {
        if (email == null || !email.contains("@")) {
            return email;
        }
        String[] parts = email.split("@");
        String account = parts[0];
        
        if (account.length() <= 3) {
            return account.charAt(0) + "***@" + parts[1];
        }
        return account.substring(0, 3) + "***@" + parts[1];
    }
    
    /**
     * åœ°å€è„±æ•ï¼ˆä¿ç•™çœå¸‚ï¼‰
     * æµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒºXXè·¯XXå· â†’ æµ™æ±Ÿçœæ­å·å¸‚****
     */
    public static String address(String address) {
        if (address == null || address.length() < 6) {
            return address;
        }
        
        // æŸ¥æ‰¾å¸‚çš„ä½ç½®
        int cityIndex = address.indexOf("å¸‚");
        if (cityIndex != -1) {
            return address.substring(0, cityIndex + 1) + "****";
        }
        
        // å¦‚æœæ²¡æœ‰å¸‚ï¼Œä¿ç•™å‰6ä¸ªå­—ç¬¦
        return address.substring(0, 6) + "****";
    }
    
    /**
     * è‡ªå®šä¹‰è„±æ•ï¼ˆä¿ç•™å‰åNä½ï¼‰
     * @param str åŸå§‹å­—ç¬¦ä¸²
     * @param front ä¿ç•™å‰å‡ ä½
     * @param back ä¿ç•™åå‡ ä½
     */
    public static String custom(String str, int front, int back) {
        if (str == null || str.length() <= (front + back)) {
            return str;
        }
        
        String frontStr = str.substring(0, front);
        String backStr = str.substring(str.length() - back);
        int starCount = str.length() - front - back;
        
        return frontStr + "*".repeat(starCount) + backStr;
    }
}
```

### 3.4 ä½¿ç”¨è„±æ•å·¥å…·


**ğŸ”§ åœ¨Serviceå±‚ä½¿ç”¨**

```java
@Service
public class UserService {
    @Autowired
    private UserMapper userMapper;
    
    /**
     * æŸ¥è¯¢ç”¨æˆ· - è¿”å›è„±æ•æ•°æ®
     * åœºæ™¯ï¼šå±•ç¤ºç»™å®¢æœã€ç®¡ç†å‘˜æŸ¥çœ‹
     */
    public UserVO getUserForDisplay(Long id) {
        // 1. æŸ¥è¯¢æ•°æ®åº“ï¼ˆè‡ªåŠ¨è§£å¯†ï¼‰
        User user = userMapper.selectById(id);
        
        // 2. è½¬æ¢ä¸ºVOå¹¶è„±æ•
        UserVO vo = new UserVO();
        vo.setId(user.getId());
        vo.setUsername(user.getUsername());
        
        // 3. è„±æ•å¤„ç†
        vo.setPhone(DesensitizeUtil.phone(user.getPhone()));
        vo.setIdCard(DesensitizeUtil.idCard(user.getIdCard()));
        vo.setEmail(DesensitizeUtil.email(user.getEmail()));
        
        return vo;
    }
}
```

**ğŸ“Š è„±æ•æ•ˆæœå±•ç¤º**

```
åŸå§‹æ•°æ®ï¼ˆæ•°æ®åº“è§£å¯†åï¼‰ï¼š
{
  "id": 1,
  "username": "å¼ ä¸‰",
  "phone": "13812345678",
  "idCard": "330102199001011234",
  "email": "zhangsan@qq.com"
}

è„±æ•åè¿”å›ç»™å‰ç«¯ï¼š
{
  "id": 1,
  "username": "å¼ ä¸‰",
  "phone": "138****5678",
  "idCard": "3301**********1234",
  "email": "zha***@qq.com"
}

é€‚ç”¨åœºæ™¯ï¼š
âœ… å®¢æœæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯
âœ… è®¢å•åˆ—è¡¨å±•ç¤º
âœ… æ•°æ®æŠ¥è¡¨å¯¼å‡º
âœ… æ—¥å¿—è®°å½•
```

---

## 4. ğŸ› ï¸ TypeHandleråŠ å¯†å®ç°


### 4.1 TypeHandlerå·¥ä½œåŸç†


**ğŸ”¸ æ ¸å¿ƒæœºåˆ¶**
```
TypeHandleræ˜¯ä»€ä¹ˆï¼Ÿ
é€šä¿—ç†è§£ï¼šæ•°æ®çš„"ç¿»è¯‘å®˜"
â€¢ æŠŠJavaå¯¹è±¡ç¿»è¯‘æˆæ•°æ®åº“èƒ½å­˜å‚¨çš„æ ¼å¼
â€¢ æŠŠæ•°æ®åº“çš„æ•°æ®ç¿»è¯‘æˆJavaå¯¹è±¡

å·¥ä½œæ—¶æœºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨ç¨‹åº   â”‚ â† Javaå¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ setParameter (å­˜å…¥æ—¶)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TypeHandlerâ”‚ â† åŠ å¯†å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“     â”‚ â† å¯†æ–‡å­˜å‚¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TypeHandlerâ”‚ â† è§£å¯†å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘ getResult (è¯»å–æ—¶)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨ç¨‹åº   â”‚ â† Javaå¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 é«˜çº§åŠ å¯†TypeHandler


**ğŸ’¡ æ”¯æŒå¤šç§åŠ å¯†ç®—æ³•**

```java
/**
 * å¯é…ç½®çš„åŠ å¯†TypeHandler
 * æ”¯æŒAESã€DESç­‰å¤šç§åŠ å¯†æ–¹å¼
 */
public class ConfigurableEncryptHandler extends BaseTypeHandler<String> {
    
    // åŠ å¯†ç®—æ³•æšä¸¾
    public enum Algorithm {
        AES,    // é«˜å¼ºåº¦å¯¹ç§°åŠ å¯†
        DES,    // æ ‡å‡†å¯¹ç§°åŠ å¯†
        SM4     // å›½å¯†ç®—æ³•
    }
    
    private Algorithm algorithm = Algorithm.AES;  // é»˜è®¤AES
    
    /**
     * æ„é€ å‡½æ•°å¯æŒ‡å®šç®—æ³•
     */
    public ConfigurableEncryptHandler(Algorithm algorithm) {
        this.algorithm = algorithm;
    }
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    String parameter, JdbcType jdbcType) 
                                    throws SQLException {
        String encrypted = encrypt(parameter);
        ps.setString(i, encrypted);
    }
    
    @Override
    public String getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        String encrypted = rs.getString(columnName);
        return encrypted != null ? decrypt(encrypted) : null;
    }
    
    // å…¶ä»–æ–¹æ³•çœç•¥...
    
    /**
     * æ ¹æ®ç®—æ³•ç±»å‹åŠ å¯†
     */
    private String encrypt(String plainText) {
        switch (algorithm) {
            case AES:
                return AESUtil.encrypt(plainText);
            case DES:
                return DESUtil.encrypt(plainText);
            case SM4:
                return SM4Util.encrypt(plainText);
            default:
                throw new IllegalArgumentException("ä¸æ”¯æŒçš„åŠ å¯†ç®—æ³•");
        }
    }
    
    /**
     * æ ¹æ®ç®—æ³•ç±»å‹è§£å¯†
     */
    private String decrypt(String cipherText) {
        switch (algorithm) {
            case AES:
                return AESUtil.decrypt(cipherText);
            case DES:
                return DESUtil.decrypt(cipherText);
            case SM4:
                return SM4Util.decrypt(cipherText);
            default:
                throw new IllegalArgumentException("ä¸æ”¯æŒçš„è§£å¯†ç®—æ³•");
        }
    }
}
```

**ğŸ’¡ ä½¿ç”¨ä¸åŒåŠ å¯†ç®—æ³•**

```java
@Data
@TableName("user")
public class User {
    @TableId
    private Long id;
    
    /**
     * èº«ä»½è¯ - ä½¿ç”¨AESåŠ å¯†ï¼ˆé«˜å¼ºåº¦ï¼‰
     */
    @TableField(typeHandler = ConfigurableEncryptHandler.class)
    private String idCard;
    
    /**
     * æ‰‹æœºå· - ä½¿ç”¨SM4å›½å¯†ç®—æ³•
     */
    @TableField(typeHandler = SM4EncryptHandler.class)
    private String phone;
}
```

### 4.3 æ¡ä»¶åŠ å¯†Handler


**ğŸ’¡ æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦åŠ å¯†**

```java
/**
 * æ¡ä»¶åŠ å¯†Handler
 * åœºæ™¯ï¼šæµ‹è¯•ç¯å¢ƒä¸åŠ å¯†ï¼Œç”Ÿäº§ç¯å¢ƒåŠ å¯†
 */
public class ConditionalEncryptHandler extends BaseTypeHandler<String> {
    
    @Value("${encrypt.enabled:true}")  // ä»é…ç½®è¯»å–
    private boolean encryptEnabled;
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                    String parameter, JdbcType jdbcType) 
                                    throws SQLException {
        // æ ¹æ®é…ç½®å†³å®šæ˜¯å¦åŠ å¯†
        String value = encryptEnabled ? 
                      AESUtil.encrypt(parameter) : 
                      parameter;
        ps.setString(i, value);
    }
    
    @Override
    public String getNullableResult(ResultSet rs, String columnName) 
                                   throws SQLException {
        String value = rs.getString(columnName);
        if (value == null) {
            return null;
        }
        
        // æ ¹æ®é…ç½®å†³å®šæ˜¯å¦è§£å¯†
        return encryptEnabled ? 
               AESUtil.decrypt(value) : 
               value;
    }
    
    // å…¶ä»–æ–¹æ³•ç±»ä¼¼...
}
```

**âš™ï¸ é…ç½®æ–‡ä»¶æ§åˆ¶**

```yaml
# application.yml

# å¼€å‘ç¯å¢ƒ - ä¸åŠ å¯†ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
spring:
  profiles: dev
encrypt:
  enabled: false

---
# ç”Ÿäº§ç¯å¢ƒ - å¯ç”¨åŠ å¯†
spring:
  profiles: prod
encrypt:
  enabled: true
```

---

## 5. ğŸ“ æ³¨è§£é©±åŠ¨è„±æ•


### 5.1 è‡ªå®šä¹‰è„±æ•æ³¨è§£


**ğŸ’¡ å®šä¹‰æ³¨è§£**

```java
/**
 * è„±æ•æ³¨è§£
 * ä½¿ç”¨æ–¹å¼ï¼šåœ¨éœ€è¦è„±æ•çš„å­—æ®µä¸Šæ·»åŠ æ­¤æ³¨è§£
 */
@Target(ElementType.FIELD)  // ä½œç”¨äºå­—æ®µ
@Retention(RetentionPolicy.RUNTIME)  // è¿è¡Œæ—¶ç”Ÿæ•ˆ
public @interface Desensitize {
    
    /**
     * è„±æ•ç±»å‹
     */
    DesensitizeType type() default DesensitizeType.CUSTOM;
    
    /**
     * è‡ªå®šä¹‰è„±æ•æ—¶ï¼Œä¿ç•™å‰å‡ ä½
     */
    int front() default 0;
    
    /**
     * è‡ªå®šä¹‰è„±æ•æ—¶ï¼Œä¿ç•™åå‡ ä½
     */
    int back() default 0;
}

/**
 * è„±æ•ç±»å‹æšä¸¾
 */
public enum DesensitizeType {
    PHONE,      // æ‰‹æœºå·
    ID_CARD,    // èº«ä»½è¯
    BANK_CARD,  // é“¶è¡Œå¡
    EMAIL,      // é‚®ç®±
    ADDRESS,    // åœ°å€
    CUSTOM      // è‡ªå®šä¹‰
}
```

**ğŸ’¡ å®ä½“ç±»ä½¿ç”¨æ³¨è§£**

```java
@Data
public class UserVO {
    private Long id;
    private String username;
    
    /**
     * æ‰‹æœºå·è„±æ•
     * è‡ªåŠ¨å¤„ç†ä¸ºï¼š138****5678
     */
    @Desensitize(type = DesensitizeType.PHONE)
    private String phone;
    
    /**
     * èº«ä»½è¯è„±æ•
     * è‡ªåŠ¨å¤„ç†ä¸ºï¼š3301**********1234
     */
    @Desensitize(type = DesensitizeType.ID_CARD)
    private String idCard;
    
    /**
     * è‡ªå®šä¹‰è„±æ•ï¼ˆä¿ç•™å‰3å2ä½ï¼‰
     * zhangsan â†’ zha***an
     */
    @Desensitize(type = DesensitizeType.CUSTOM, front = 3, back = 2)
    private String realName;
}
```

### 5.2 æ³¨è§£å¤„ç†å™¨å®ç°


**ğŸ’¡ ä½¿ç”¨Jacksonåºåˆ—åŒ–æ—¶è„±æ•**

```java
/**
 * Jacksonåºåˆ—åŒ–è„±æ•å¤„ç†å™¨
 * ä½œç”¨ï¼šåœ¨å¯¹è±¡è½¬JSONæ—¶è‡ªåŠ¨è„±æ•
 */
public class DesensitizeSerializer extends JsonSerializer<String> 
                                   implements ContextualSerializer {
    
    private DesensitizeType type;
    private int front;
    private int back;
    
    @Override
    public void serialize(String value, JsonGenerator gen, 
                         SerializerProvider serializers) 
                         throws IOException {
        // æ ¹æ®ç±»å‹è„±æ•
        String desensitized = desensitize(value);
        gen.writeString(desensitized);
    }
    
    /**
     * åˆ›å»ºä¸Šä¸‹æ–‡åºåˆ—åŒ–å™¨
     * è¯»å–æ³¨è§£ä¿¡æ¯
     */
    @Override
    public JsonSerializer<?> createContextual(SerializerProvider prov, 
                                              BeanProperty property) {
        // è·å–å­—æ®µä¸Šçš„æ³¨è§£
        Desensitize annotation = property.getAnnotation(Desensitize.class);
        if (annotation != null) {
            this.type = annotation.type();
            this.front = annotation.front();
            this.back = annotation.back();
        }
        return this;
    }
    
    /**
     * æ‰§è¡Œè„±æ•
     */
    private String desensitize(String value) {
        if (value == null) {
            return null;
        }
        
        switch (type) {
            case PHONE:
                return DesensitizeUtil.phone(value);
            case ID_CARD:
                return DesensitizeUtil.idCard(value);
            case BANK_CARD:
                return DesensitizeUtil.bankCard(value);
            case EMAIL:
                return DesensitizeUtil.email(value);
            case ADDRESS:
                return DesensitizeUtil.address(value);
            case CUSTOM:
                return DesensitizeUtil.custom(value, front, back);
            default:
                return value;
        }
    }
}
```

**ğŸ’¡ æ³¨è§£é…ç½®åºåˆ—åŒ–å™¨**

```java
@Data
public class UserVO {
    private Long id;
    
    /**
     * ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–å™¨
     */
    @Desensitize(type = DesensitizeType.PHONE)
    @JsonSerialize(using = DesensitizeSerializer.class)
    private String phone;
    
    @Desensitize(type = DesensitizeType.ID_CARD)
    @JsonSerialize(using = DesensitizeSerializer.class)
    private String idCard;
}
```

### 5.3 å®é™…ä½¿ç”¨æ•ˆæœ


**ğŸ”§ Controllerè¿”å›æ•°æ®**

```java
@RestController
@RequestMapping("/user")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    /**
     * è·å–ç”¨æˆ·ä¿¡æ¯
     * è¿”å›çš„JSONè‡ªåŠ¨è„±æ•
     */
    @GetMapping("/{id}")
    public Result<UserVO> getUser(@PathVariable Long id) {
        UserVO user = userService.getUserVO(id);
        return Result.success(user);
    }
}
```

**ğŸ“Š è¿”å›ç»“æœç¤ºä¾‹**

```json
// è¯·æ±‚ï¼šGET /user/1

// è‡ªåŠ¨è„±æ•åçš„å“åº”ï¼š
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "å¼ ä¸‰",
    "phone": "138****5678",        // å·²è„±æ•
    "idCard": "3301**********1234", // å·²è„±æ•
    "realName": "å¼ **"              // å·²è„±æ•
  }
}
```

---

## 6. ğŸ”‘ åŠ å¯†å¯†é’¥ç®¡ç†


### 6.1 å¯†é’¥ç®¡ç†çš„é‡è¦æ€§


**âš ï¸ å¸¸è§é”™è¯¯åšæ³•**
```java
// âŒ é”™è¯¯ï¼šå¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
public class AESUtil {
    private static final String KEY = "MySecretKey123456";  // å±é™©ï¼
}

é£é™©ï¼š
â€¢ ä»£ç æ³„éœ² = å¯†é’¥æ³„éœ²
â€¢ å¯†é’¥æ— æ³•æ›´æ¢
â€¢ æ‰€æœ‰ç¯å¢ƒä½¿ç”¨åŒä¸€å¯†é’¥
```

**âœ… æ­£ç¡®çš„å¯†é’¥ç®¡ç†**
```
å¯†é’¥ç®¡ç†åŸåˆ™ï¼š

1. åˆ†ç¦»åŸåˆ™
   å¯†é’¥ä¸ä»£ç åˆ†ç¦»ï¼Œæ”¾åœ¨é…ç½®æ–‡ä»¶æˆ–å¯†é’¥ç®¡ç†ç³»ç»Ÿ

2. ç¯å¢ƒéš”ç¦»
   å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ä½¿ç”¨ä¸åŒå¯†é’¥

3. å®šæœŸè½®æ¢
   å®šæœŸæ›´æ¢å¯†é’¥ï¼Œé™ä½æ³„éœ²é£é™©

4. æƒé™æ§åˆ¶
   åªæœ‰æˆæƒäººå‘˜å¯ä»¥è®¿é—®å¯†é’¥
```

### 6.2 å¯†é’¥é…ç½®æ–¹æ¡ˆ


**ğŸ’¡ æ–¹æ¡ˆä¸€ï¼šé…ç½®æ–‡ä»¶ç®¡ç†**

```yaml
# application.ymlï¼ˆä¸è¦æäº¤åˆ°Gitï¼‰
encrypt:
  # AESå¯†é’¥ï¼ˆ16/24/32å­—èŠ‚ï¼‰
  aes-key: ${ENCRYPT_AES_KEY:MyDefaultKey1234567890123456}
  
  # SM4å¯†é’¥
  sm4-key: ${ENCRYPT_SM4_KEY:SM4Key1234567890}
  
  # å¯†é’¥ç‰ˆæœ¬ï¼ˆç”¨äºå¯†é’¥è½®æ¢ï¼‰
  key-version: v1

# ä»ç¯å¢ƒå˜é‡è¯»å–å¯†é’¥ï¼ˆæ¨èï¼‰
# export ENCRYPT_AES_KEY=ProductionKey123...
```

**ğŸ’¡ æ–¹æ¡ˆäºŒï¼šå¯†é’¥ç®¡ç†æœåŠ¡**

```java
/**
 * å¯†é’¥ç®¡ç†æœåŠ¡
 * ä»ä¸“ä¸šçš„å¯†é’¥ç®¡ç†ç³»ç»Ÿè·å–å¯†é’¥
 */
@Service
public class KeyManagementService {
    
    @Value("${key.management.url}")
    private String keyServerUrl;
    
    /**
     * ä»å¯†é’¥æœåŠ¡å™¨è·å–å¯†é’¥
     */
    public String getEncryptKey(String keyId) {
        // è°ƒç”¨å¯†é’¥ç®¡ç†ç³»ç»ŸAPI
        RestTemplate restTemplate = new RestTemplate();
        String url = keyServerUrl + "/key/" + keyId;
        
        KeyResponse response = restTemplate.getForObject(
            url, KeyResponse.class
        );
        
        return response.getKey();
    }
    
    /**
     * å¯†é’¥ç¼“å­˜ï¼ˆé¿å…é¢‘ç¹è¯·æ±‚ï¼‰
     */
    @Cacheable(value = "encryptKeys", key = "#keyId")
    public String getCachedKey(String keyId) {
        return getEncryptKey(keyId);
    }
}
```

### 6.3 å¯†é’¥è½®æ¢æœºåˆ¶


**ğŸ’¡ æ”¯æŒå¤šç‰ˆæœ¬å¯†é’¥**

```java
/**
 * æ”¯æŒå¯†é’¥ç‰ˆæœ¬çš„åŠ å¯†å·¥å…·
 */
public class VersionedAESUtil {
    
    // å¯†é’¥ç‰ˆæœ¬æ˜ å°„
    private static final Map<String, String> KEY_MAP = new HashMap<>();
    
    static {
        KEY_MAP.put("v1", "OldKey123456789012345678901234");
        KEY_MAP.put("v2", "NewKey123456789012345678901234");
    }
    
    /**
     * åŠ å¯†ï¼ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬å¯†é’¥ï¼‰
     */
    public static String encrypt(String plainText) {
        String latestKey = KEY_MAP.get("v2");  // å½“å‰ç‰ˆæœ¬
        String encrypted = doEncrypt(plainText, latestKey);
        
        // åœ¨å¯†æ–‡å‰æ·»åŠ ç‰ˆæœ¬æ ‡è¯†
        return "v2:" + encrypted;
    }
    
    /**
     * è§£å¯†ï¼ˆæ ¹æ®ç‰ˆæœ¬é€‰æ‹©å¯†é’¥ï¼‰
     */
    public static String decrypt(String cipherText) {
        // è§£æç‰ˆæœ¬å·
        String[] parts = cipherText.split(":", 2);
        String version = parts[0];
        String encrypted = parts[1];
        
        // è·å–å¯¹åº”ç‰ˆæœ¬çš„å¯†é’¥
        String key = KEY_MAP.get(version);
        return doDecrypt(encrypted, key);
    }
    
    private static String doEncrypt(String text, String key) {
        // å®é™…åŠ å¯†é€»è¾‘
        // ...
        return "";
    }
    
    private static String doDecrypt(String text, String key) {
        // å®é™…è§£å¯†é€»è¾‘
        // ...
        return "";
    }
}
```

**ğŸ”„ å¯†é’¥è½®æ¢æµç¨‹**

```
å¯†é’¥è½®æ¢æ­¥éª¤ï¼š

1ï¸âƒ£ å‡†å¤‡é˜¶æ®µ
   â”œâ”€ ç”Ÿæˆæ–°å¯†é’¥ v2
   â”œâ”€ é…ç½®åˆ°ç³»ç»Ÿä¸­
   â””â”€ ä¿ç•™æ—§å¯†é’¥ v1ï¼ˆç”¨äºè§£å¯†æ—§æ•°æ®ï¼‰

2ï¸âƒ£ åˆ‡æ¢é˜¶æ®µ
   â”œâ”€ æ–°æ•°æ®ä½¿ç”¨ v2 åŠ å¯†
   â””â”€ æ—§æ•°æ®ç”¨ v1 è§£å¯†ï¼ˆå…¼å®¹ï¼‰

3ï¸âƒ£ è¿ç§»é˜¶æ®µï¼ˆå¯é€‰ï¼‰
   â”œâ”€ æ‰¹é‡é‡æ–°åŠ å¯†æ—§æ•°æ®
   â””â”€ ä½¿ç”¨ v2 åŠ å¯†æ‰€æœ‰æ•°æ®

4ï¸âƒ£ æ¸…ç†é˜¶æ®µ
   â”œâ”€ ç¡®è®¤æ‰€æœ‰æ•°æ®å·²è¿ç§»
   â””â”€ åˆ é™¤æ—§å¯†é’¥ v1

æ•°æ®åº“ç¤ºä¾‹ï¼š
åŠ å¯†æ—¶é—´      å¯†æ–‡æ ¼å¼
2024-01-01   v1:OldEncryptedData...
2024-06-01   v2:NewEncryptedData...  â† åˆ‡æ¢åä½¿ç”¨æ–°å¯†é’¥
```

---

## 7. âš¡ æ€§èƒ½å½±å“è¯„ä¼°


### 7.1 åŠ å¯†æ€§èƒ½å¼€é”€


**ğŸ“Š æ€§èƒ½æµ‹è¯•æ•°æ®**

| æ“ä½œç±»å‹ | **ä¸åŠ å¯†è€—æ—¶** | **AESåŠ å¯†è€—æ—¶** | **æ€§èƒ½æŸè€—** |
|---------|--------------|----------------|-------------|
| ğŸ”¸ **å•æ¡æ’å…¥** | `5ms` | `8ms` | `+60%` |
| ğŸ”¸ **æ‰¹é‡æ’å…¥(100æ¡)** | `80ms` | `150ms` | `+87.5%` |
| ğŸ”¸ **å•æ¡æŸ¥è¯¢** | `3ms` | `5ms` | `+66.7%` |
| ğŸ”¸ **æ‰¹é‡æŸ¥è¯¢(100æ¡)** | `50ms` | `95ms` | `+90%` |

**ğŸ” æ€§èƒ½åˆ†æ**
```
æ€§èƒ½å½±å“å› ç´ ï¼š

1. åŠ å¯†ç®—æ³•å¤æ‚åº¦
   AES-256 > AES-128 > DES
   å®‰å…¨æ€§è¶Šé«˜ï¼Œæ€§èƒ½æŸè€—è¶Šå¤§

2. æ•°æ®é‡å¤§å°
   åŠ å¯†1000ä¸ªå­—ç¬¦ > åŠ å¯†10ä¸ªå­—ç¬¦
   æ•°æ®è¶Šé•¿ï¼Œè€—æ—¶è¶Šå¤š

3. åŠ å¯†å­—æ®µæ•°é‡
   5ä¸ªåŠ å¯†å­—æ®µ > 1ä¸ªåŠ å¯†å­—æ®µ
   å­—æ®µè¶Šå¤šï¼Œæ€§èƒ½æŸè€—è¶Šå¤§

4. å¹¶å‘é‡
   é«˜å¹¶å‘æ—¶CPUå ç”¨æ˜¾è‘—å¢åŠ 
```

### 7.2 ä¼˜åŒ–ç­–ç•¥


**ğŸ’¡ ç­–ç•¥ä¸€ï¼šé€‰æ‹©æ€§åŠ å¯†**

```java
@Data
@TableName("user")
public class User {
    @TableId
    private Long id;
    
    // âœ… æ•æ„Ÿå­—æ®µæ‰åŠ å¯†
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String idCard;     // èº«ä»½è¯éœ€è¦åŠ å¯†
    
    @TableField(typeHandler = EncryptTypeHandler.class)
    private String bankCard;   // é“¶è¡Œå¡éœ€è¦åŠ å¯†
    
    // âŒ æ™®é€šå­—æ®µä¸åŠ å¯†
    private String username;   // ç”¨æˆ·åæ— éœ€åŠ å¯†
    private String nickname;   // æ˜µç§°æ— éœ€åŠ å¯†
    private Integer age;       // å¹´é¾„æ— éœ€åŠ å¯†
}
```

**ğŸ’¡ ç­–ç•¥äºŒï¼šç¼“å­˜åŠ å¯†ç»“æœ**

```java
/**
 * ç¼“å­˜ä¼˜åŒ–çš„åŠ å¯†å·¥å…·
 */
public class CachedAESUtil {
    
    // åŠ å¯†ç»“æœç¼“å­˜ï¼ˆæ³¨æ„ï¼šä¸è¦ç¼“å­˜å¤ªå¤šï¼‰
    private static final Cache<String, String> ENCRYPT_CACHE = 
        CacheBuilder.newBuilder()
            .maximumSize(1000)      // æœ€å¤šç¼“å­˜1000æ¡
            .expireAfterWrite(10, TimeUnit.MINUTES)  // 10åˆ†é’Ÿè¿‡æœŸ
            .build();
    
    /**
     * å¸¦ç¼“å­˜çš„åŠ å¯†
     * ç›¸åŒæ˜æ–‡ç›´æ¥è¿”å›ç¼“å­˜ç»“æœ
     */
    public static String encrypt(String plainText) {
        try {
            return ENCRYPT_CACHE.get(plainText, () -> {
                // ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡ŒåŠ å¯†
                return doActualEncrypt(plainText);
            });
        } catch (Exception e) {
            throw new RuntimeException("åŠ å¯†å¤±è´¥", e);
        }
    }
    
    private static String doActualEncrypt(String text) {
        // å®é™…åŠ å¯†é€»è¾‘...
        return "";
    }
}
```

**ğŸ’¡ ç­–ç•¥ä¸‰ï¼šå¼‚æ­¥åŠ å¯†**

```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Async  // å¼‚æ­¥å¤„ç†
    public CompletableFuture<Void> saveUserAsync(User user) {
        // åŠ å¯†æ“ä½œåœ¨å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œ
        userMapper.insert(user);
        return CompletableFuture.completedFuture(null);
    }
}
```

### 7.3 æ€§èƒ½ç›‘æ§


**ğŸ’¡ æ€§èƒ½ç›‘æ§å®ç°**

```java
/**
 * åŠ å¯†æ€§èƒ½ç›‘æ§
 */
@Aspect
@Component
public class EncryptPerformanceMonitor {
    
    private static final Logger log = LoggerFactory.getLogger(
        EncryptPerformanceMonitor.class
    );
    
    /**
     * ç›‘æ§åŠ å¯†æ–¹æ³•æ€§èƒ½
     */
    @Around("execution(* com.example.util.AESUtil.encrypt(..))")
    public Object monitorEncrypt(ProceedingJoinPoint pjp) throws Throwable {
        long start = System.currentTimeMillis();
        
        try {
            // æ‰§è¡ŒåŠ å¯†
            Object result = pjp.proceed();
            return result;
        } finally {
            long cost = System.currentTimeMillis() - start;
            
            // è®°å½•æ…¢åŠ å¯†ï¼ˆè¶…è¿‡100msï¼‰
            if (cost > 100) {
                log.warn("åŠ å¯†è€—æ—¶è¿‡é•¿: {}ms", cost);
            }
        }
    }
}
```

**ğŸ“Š æ€§èƒ½æŠ¥è¡¨ç¤ºä¾‹**

```
åŠ å¯†æ€§èƒ½ç»Ÿè®¡ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ“ä½œç±»å‹    â”‚ è°ƒç”¨æ¬¡æ•°  â”‚ å¹³å‡è€—æ—¶  â”‚ æœ€å¤§è€—æ—¶  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŠ å¯†æ“ä½œ     â”‚  12,543  â”‚   3.2ms  â”‚   45ms   â”‚
â”‚ è§£å¯†æ“ä½œ     â”‚  18,921  â”‚   2.8ms  â”‚   38ms   â”‚
â”‚ è„±æ•æ“ä½œ     â”‚  25,634  â”‚   0.5ms  â”‚   5ms    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½å»ºè®®ï¼š
âœ… åŠ å¯†è€—æ—¶åœ¨å¯æ¥å—èŒƒå›´å†…
âš ï¸ ä¸ªåˆ«æ“ä½œè€—æ—¶è¾ƒé•¿ï¼Œå»ºè®®ä¼˜åŒ–
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•æ„Ÿæ•°æ®å¤„ç†ä¸¤å¤§æ‰‹æ®µï¼š
   â€¢ åŠ å¯†å­˜å‚¨ - ä¿æŠ¤æ•°æ®åº“ä¸­çš„æ•°æ®
   â€¢ è„±æ•å±•ç¤º - ä¿æŠ¤å±•ç¤ºå’Œä¼ è¾“ä¸­çš„æ•°æ®

ğŸ”¸ MyBatis-Pluså®ç°æ–¹å¼ï¼š
   â€¢ TypeHandler - è‡ªåŠ¨åŠ è§£å¯†æ ¸å¿ƒç»„ä»¶
   â€¢ æ³¨è§£é©±åŠ¨ - ç®€åŒ–è„±æ•é…ç½®
   â€¢ å·¥å…·ç±» - æä¾›è„±æ•æ–¹æ³•

ğŸ”¸ å¯†é’¥ç®¡ç†åŸåˆ™ï¼š
   â€¢ ä¸ä»£ç åˆ†ç¦»
   â€¢ æ”¯æŒç‰ˆæœ¬è½®æ¢
   â€¢ ç¯å¢ƒéš”ç¦»ä½¿ç”¨
```

### 8.2 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ åŠ å¯†å­—æ®µé€‰æ‹©**
```
âœ… å¿…é¡»åŠ å¯†çš„å­—æ®µï¼š
   â€¢ èº«ä»½è¯å·ã€æŠ¤ç…§å·
   â€¢ é“¶è¡Œå¡å·ã€æ”¯ä»˜å¯†ç 
   â€¢ è¯¦ç»†å®¶åº­ä½å€
   â€¢ åŒ»ç–—å¥åº·ä¿¡æ¯

âŒ æ— éœ€åŠ å¯†çš„å­—æ®µï¼š
   â€¢ ç”¨æˆ·æ˜µç§°ã€å¤´åƒ
   â€¢ å…¬å¼€çš„è”ç³»æ–¹å¼ï¼ˆå®¢æœç”µè¯ï¼‰
   â€¢ éæ•æ„Ÿçš„ä¸šåŠ¡æ•°æ®
```

**ğŸ¯ è„±æ•åœºæ™¯é€‰æ‹©**
```
éœ€è¦è„±æ•çš„åœºæ™¯ï¼š
âœ… å‰ç«¯å±•ç¤ºï¼ˆè®¢å•åˆ—è¡¨ã€ç”¨æˆ·ä¿¡æ¯ï¼‰
âœ… æ—¥å¿—è®°å½•ï¼ˆé¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼‰
âœ… æ•°æ®å¯¼å‡ºï¼ˆExcelã€æŠ¥è¡¨ï¼‰
âœ… å®¢æœæŸ¥è¯¢ï¼ˆä¿æŠ¤ç”¨æˆ·éšç§ï¼‰

ä¸éœ€è¦è„±æ•çš„åœºæ™¯ï¼š
âŒ å†…éƒ¨æ ¸å¿ƒç³»ç»Ÿï¼ˆé£æ§ã€è´¢åŠ¡ï¼‰
âŒ ç”¨æˆ·æœ¬äººæŸ¥çœ‹ï¼ˆä¸ªäººä¸­å¿ƒï¼‰
âŒ åŠ å¯†ä¼ è¾“ï¼ˆå·²æœ‰å…¶ä»–å®‰å…¨æªæ–½ï¼‰
```

### 8.3 æŠ€æœ¯é€‰å‹å»ºè®®


**ğŸ”§ åŠ å¯†ç®—æ³•é€‰æ‹©**

| ç®—æ³• | **å®‰å…¨çº§åˆ«** | **æ€§èƒ½** | **é€‚ç”¨åœºæ™¯** |
|-----|------------|---------|------------|
| **AES-256** | `æé«˜` | `ä¸­` | `é‡‘èã€åŒ»ç–—ç­‰é«˜å®‰å…¨è¦æ±‚` |
| **AES-128** | `é«˜` | `è¾ƒé«˜` | `ä¸€èˆ¬ä¼ä¸šåº”ç”¨` |
| **SM4** | `é«˜` | `ä¸­` | `å›½å¯†è¦æ±‚çš„é¡¹ç›®` |
| **DES** | `ä½` | `é«˜` | `ä¸æ¨èä½¿ç”¨ï¼ˆå·²æ·˜æ±°ï¼‰` |

**ğŸ”§ å®ç°æ–¹æ¡ˆé€‰æ‹©**

```
å°å‹é¡¹ç›®ï¼ˆ<10ä¸‡ç”¨æˆ·ï¼‰ï¼š
âœ… TypeHandler + å·¥å…·ç±»å³å¯
âœ… é…ç½®æ–‡ä»¶ç®¡ç†å¯†é’¥
âœ… æ‰‹åŠ¨è„±æ•å¤„ç†

ä¸­å‹é¡¹ç›®ï¼ˆ10ä¸‡-100ä¸‡ç”¨æˆ·ï¼‰ï¼š
âœ… TypeHandler + æ³¨è§£é©±åŠ¨
âœ… ç‹¬ç«‹å¯†é’¥ç®¡ç†æœåŠ¡
âœ… è‡ªåŠ¨è„±æ• + æ€§èƒ½ç›‘æ§

å¤§å‹é¡¹ç›®ï¼ˆ>100ä¸‡ç”¨æˆ·ï¼‰ï¼š
âœ… ä¸“ä¸šåŠ å¯†ä¸­é—´ä»¶
âœ… ä¼ä¸šçº§å¯†é’¥ç®¡ç†ç³»ç»Ÿ
âœ… åˆ†å¸ƒå¼åŠ å¯†æ–¹æ¡ˆ
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**â“ é—®é¢˜ä¸€ï¼šåŠ å¯†åæ— æ³•æ¨¡ç³ŠæŸ¥è¯¢**
```
é—®é¢˜ï¼š
SELECT * FROM user WHERE phone LIKE '138%'
åŠ å¯†åphoneå­—æ®µæ˜¯å¯†æ–‡ï¼Œæ— æ³•æ¨¡ç³ŠæŸ¥è¯¢

è§£å†³æ–¹æ¡ˆï¼š
1. ä¿ç•™phone_prefixå­—æ®µï¼ˆå­˜å‚¨å‰3ä½æ˜æ–‡ï¼‰
   WHERE phone_prefix = '138'
   
2. ä½¿ç”¨æœç´¢å¼•æ“ï¼ˆElasticsearchï¼‰
   å­˜å‚¨æ˜æ–‡åˆ°ESï¼Œæä¾›æœç´¢åŠŸèƒ½
   
3. ä½¿ç”¨åŒæ€åŠ å¯†ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰
```

**â“ é—®é¢˜äºŒï¼šå†å²æ•°æ®å¦‚ä½•å¤„ç†**
```
åœºæ™¯ï¼šé¡¹ç›®ä¸Šçº¿åæ‰åŠ å¯†ï¼Œå†å²æ•°æ®æ˜¯æ˜æ–‡

è§£å†³æ–¹æ¡ˆï¼š
1. æ•°æ®è¿ç§»è„šæœ¬
   UPDATE user SET phone = AES_ENCRYPT(phone, 'key')
   WHERE encrypted = 0;

2. å…¼å®¹å¤„ç†
   è§£å¯†æ—¶å…ˆåˆ¤æ–­æ˜¯å¦å·²åŠ å¯†
   if (isEncrypted(data)) {
       return decrypt(data);
   }
   return data;
```

**â“ é—®é¢˜ä¸‰ï¼šæ€§èƒ½ä¼˜åŒ–**
```
é—®é¢˜ï¼šåŠ å¯†å¯¼è‡´å“åº”æ…¢

ä¼˜åŒ–æ–¹æ¡ˆï¼š
1. åªåŠ å¯†å¿…è¦å­—æ®µï¼ˆå‡å°‘åŠ å¯†å­—æ®µæ•°é‡ï¼‰
2. ä½¿ç”¨ç¼“å­˜ï¼ˆç›¸åŒæ•°æ®å¤ç”¨ç»“æœï¼‰
3. å¼‚æ­¥å¤„ç†ï¼ˆéå…³é”®è·¯å¾„å¼‚æ­¥åŠ å¯†ï¼‰
4. æ‰¹é‡å¤„ç†ï¼ˆæ‰¹é‡åŠ è§£å¯†æé«˜æ•ˆç‡ï¼‰
```

### 8.5 æ ¸å¿ƒè®°å¿†è¦ç‚¹


**ğŸ¯ ä¸€å¥è¯æ€»ç»“**
```
æ•æ„Ÿæ•°æ®ï¼š
â€¢ å­˜å‚¨è¦åŠ å¯†ï¼ˆä¿æŠ¤æ•°æ®åº“å®‰å…¨ï¼‰
â€¢ å±•ç¤ºè¦è„±æ•ï¼ˆä¿æŠ¤éšç§ä¿¡æ¯ï¼‰
â€¢ å¯†é’¥è¦åˆ†ç¦»ï¼ˆé™ä½æ³„éœ²é£é™©ï¼‰
â€¢ æ€§èƒ½è¦å¹³è¡¡ï¼ˆä¸èƒ½å½±å“ç”¨æˆ·ä½“éªŒï¼‰
```

**ğŸ”‘ å…³é”®çŸ¥è¯†ç‚¹**
```
âœ… TypeHandleræ˜¯åŠ è§£å¯†çš„æ ¸å¿ƒæœºåˆ¶
âœ… è„±æ•æ˜¯å±•ç¤ºå±‚çš„æ•°æ®ä¿æŠ¤æ‰‹æ®µ
âœ… å¯†é’¥ç®¡ç†æ˜¯æ•´ä¸ªæ–¹æ¡ˆçš„å®‰å…¨åŸºç¡€
âœ… æ€§èƒ½ä¼˜åŒ–æ˜¯ç”Ÿäº§ç¯å¢ƒçš„å¿…è¦è€ƒè™‘

è®°ä½ï¼šå®‰å…¨ä¸æ€§èƒ½éœ€è¦å¹³è¡¡ï¼Œæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚æ–¹æ¡ˆï¼
```