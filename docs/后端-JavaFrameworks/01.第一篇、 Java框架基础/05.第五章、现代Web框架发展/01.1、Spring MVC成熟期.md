---
title: 1ã€Spring MVCæˆç†ŸæœŸ
---
## ğŸ“š ç›®å½•

1. [Spring MVCæ ¸å¿ƒæ¦‚å¿µ](#1-Spring-MVCæ ¸å¿ƒæ¦‚å¿µ)
2. [DispatcherServletå‰ç«¯æ§åˆ¶å™¨](#2-DispatcherServletå‰ç«¯æ§åˆ¶å™¨)
3. [HandlerMappingå¤„ç†å™¨æ˜ å°„](#3-HandlerMappingå¤„ç†å™¨æ˜ å°„)
4. [Controlleræ§åˆ¶å™¨è¯¦è§£](#4-Controlleræ§åˆ¶å™¨è¯¦è§£)
5. [ViewResolverè§†å›¾è§£æå™¨](#5-ViewResolverè§†å›¾è§£æå™¨)
6. [æ‹¦æˆªå™¨Interceptoræœºåˆ¶](#6-æ‹¦æˆªå™¨Interceptoræœºåˆ¶)
7. [å¼‚å¸¸å¤„ç†æœºåˆ¶](#7-å¼‚å¸¸å¤„ç†æœºåˆ¶)
8. [æ•°æ®ç»‘å®šä¸éªŒè¯](#8-æ•°æ®ç»‘å®šä¸éªŒè¯)
9. [RESTfulæ”¯æŒ](#9-RESTfulæ”¯æŒ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Spring MVCæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Spring MVC


**ç®€å•ç†è§£**ï¼šSpring MVCå°±åƒä¸€ä¸ª**æ™ºèƒ½çš„ç½‘ç«™ç®¡å®¶**ï¼Œå½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œå®ƒè´Ÿè´£ï¼š
- æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼ˆæ¯”å¦‚ç‚¹å‡»æŒ‰é’®ã€æäº¤è¡¨å•ï¼‰
- æ‰¾åˆ°åˆé€‚çš„"å¤„ç†å‘˜å·¥"æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚
- æŠŠå¤„ç†ç»“æœåŒ…è£…æˆç”¨æˆ·çœ‹å¾—æ‡‚çš„é¡µé¢è¿”å›ç»™ç”¨æˆ·

```
ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼ˆç”Ÿæ´»åŒ–ç†è§£ï¼‰ï¼š
ç”¨æˆ· â†’ å‰å°æ¥å¾…(DispatcherServlet) â†’ æŸ¥æ‰¾è´Ÿè´£äºº(HandlerMapping) 
     â†’ å…·ä½“å¤„ç†(Controller) â†’ åŒ…è£…ç»“æœ(ViewResolver) â†’ è¿”å›ç»™ç”¨æˆ·
```

### 1.2 MVCæ¶æ„æ¨¡å¼è¯¦è§£


**MVCæ˜¯ä»€ä¹ˆ**ï¼šä¸€ç§è®©ç½‘ç«™ä»£ç æ›´æ•´æ´çš„ç»„ç»‡æ–¹å¼

```
ä¼ ç»Ÿæ··ä¹±æ–¹å¼ï¼š
æ‰€æœ‰ä»£ç å †åœ¨ä¸€èµ· â†’ éš¾ç»´æŠ¤ã€æ˜“å‡ºé”™ã€æ”¹ä¸€å¤„å½±å“å…¨å±€

MVCåˆ†å·¥æ–¹å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Model     â”‚    â”‚    View     â”‚    â”‚ Controller  â”‚
â”‚   (æ•°æ®)    â”‚â—„â”€â”€â–ºâ”‚   (é¡µé¢)    â”‚â—„â”€â”€â–ºâ”‚  (æ§åˆ¶å™¨)   â”‚
â”‚   è´Ÿè´£ä¸šåŠ¡   â”‚    â”‚   è´Ÿè´£æ˜¾ç¤º   â”‚    â”‚   è´Ÿè´£åè°ƒ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€šä¿—è§£é‡Š**ï¼š
- **Modelï¼ˆæ¨¡å‹ï¼‰**ï¼šå°±åƒé“¶è¡Œçš„**è´¦æˆ·ç³»ç»Ÿ**ï¼Œè´Ÿè´£ç®¡ç†å’Œå¤„ç†æ•°æ®
- **Viewï¼ˆè§†å›¾ï¼‰**ï¼šå°±åƒé“¶è¡Œçš„**æ˜¾ç¤ºå±**ï¼Œè´Ÿè´£æŠŠä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·çœ‹
- **Controllerï¼ˆæ§åˆ¶å™¨ï¼‰**ï¼šå°±åƒé“¶è¡Œçš„**æŸœå‘˜**ï¼Œæ¥æ”¶ç”¨æˆ·éœ€æ±‚ï¼Œåè°ƒè´¦æˆ·ç³»ç»Ÿå’Œæ˜¾ç¤ºå±

### 1.3 Spring MVCçš„ä¼˜åŠ¿


**ä¸ºä»€ä¹ˆè¦ç”¨Spring MVC**ï¼š

| ä¼ ç»ŸServletå¼€å‘ | Spring MVCå¼€å‘ | **ä¼˜åŠ¿è¯´æ˜** |
|----------------|---------------|-------------|
| æ‰‹å†™URLæ˜ å°„ | `@RequestMapping`è‡ªåŠ¨æ˜ å°„ | **å†™ä»£ç æ›´ç®€å•** |
| æ‰‹åŠ¨è§£æå‚æ•° | è‡ªåŠ¨å‚æ•°ç»‘å®š | **å‡å°‘é‡å¤å·¥ä½œ** |
| æ‰‹åŠ¨å¤„ç†å¼‚å¸¸ | ç»Ÿä¸€å¼‚å¸¸å¤„ç† | **é”™è¯¯å¤„ç†æ›´ä¼˜é›…** |
| ç¡¬ç¼–ç é¡µé¢è·¯å¾„ | è§†å›¾è§£æå™¨ | **é¡µé¢ç®¡ç†æ›´çµæ´»** |

---

## 2. ğŸš¦ DispatcherServletå‰ç«¯æ§åˆ¶å™¨


### 2.1 ä»€ä¹ˆæ˜¯DispatcherServlet


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šDispatcherServletå°±åƒä¸€ä¸ª**æ™ºèƒ½å‰å°**ï¼Œæ‰€æœ‰æ¥è®¿çš„ç”¨æˆ·éƒ½è¦å…ˆé€šè¿‡å®ƒï¼š

```
ç½‘ç«™è®¿é—®æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ DispatcherServlet(å‰å°) â†’ åˆ†å‘ç»™å…·ä½“å¤„ç†å™¨
                    â†“
            "æ‚¨å¥½ï¼Œè¯·é—®éœ€è¦ä»€ä¹ˆæœåŠ¡ï¼Ÿ"
            "å¥½çš„ï¼Œæˆ‘å¸®æ‚¨æ‰¾åˆ°åˆé€‚çš„å¤„ç†äººå‘˜"
```

### 2.2 å‰ç«¯æ§åˆ¶å™¨çš„æ ¸å¿ƒä½œç”¨


**DispatcherServletçš„èŒè´£**ï¼š

ğŸ”¸ **ç»Ÿä¸€æ¥æ”¶**ï¼šæ‰€æœ‰HTTPè¯·æ±‚çš„å”¯ä¸€å…¥å£
ğŸ”¸ **æ™ºèƒ½åˆ†å‘**ï¼šæ ¹æ®URLæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨
ğŸ”¸ **åè°ƒå·¥ä½œ**ï¼šåè°ƒå„ä¸ªç»„ä»¶å®Œæˆè¯·æ±‚å¤„ç†
ğŸ”¸ **ç»Ÿä¸€å“åº”**ï¼šå°†å¤„ç†ç»“æœè¿”å›ç»™ç”¨æˆ·

### 2.3 é…ç½®DispatcherServlet


**XMLé…ç½®æ–¹å¼**ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š
```xml
<!-- web.xmlä¸­é…ç½® -->
<servlet>
    <servlet-name>springmvc</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <init-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:springmvc-config.xml</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>

<servlet-mapping>
    <servlet-name>springmvc</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping>
```

**ç°ä»£Javaé…ç½®æ–¹å¼**ï¼š
```java
@EnableWebMvc
@Configuration
@ComponentScan("com.example.controller")
public class WebConfig implements WebMvcConfigurer {
    // é…ç½®è§†å›¾è§£æå™¨ã€æ‹¦æˆªå™¨ç­‰
}
```

### 2.4 DispatcherServletå·¥ä½œåŸç†


```
è¯¦ç»†å·¥ä½œæµç¨‹ï¼š
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      ç”¨æˆ·       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ 1.å‘é€è¯·æ±‚
                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               DispatcherServlet                             â”‚
    â”‚  2.æ¥æ”¶è¯·æ±‚ â†’ 3.æŸ¥æ‰¾Handler â†’ 4.æ‰§è¡ŒHandler â†’ 5.å¤„ç†è§†å›¾  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ 6.è¿”å›å“åº”
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      ç”¨æˆ·       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ğŸ—ºï¸ HandlerMappingå¤„ç†å™¨æ˜ å°„


### 3.1 HandlerMappingçš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼šHandlerMappingå°±åƒä¸€ä¸ª**æ™ºèƒ½ç”µè¯ç°¿**ï¼Œå½“æœ‰è¯·æ±‚æ¥æ—¶ï¼Œå®ƒè´Ÿè´£ï¼š
- çœ‹çœ‹è¿™ä¸ªè¯·æ±‚è¦è®¿é—®ä»€ä¹ˆåœ°å€ï¼ˆæ¯”å¦‚ `/user/login`ï¼‰
- åœ¨"ç”µè¯ç°¿"é‡ŒæŸ¥æ‰¾å“ªä¸ªControllerè´Ÿè´£å¤„ç†è¿™ä¸ªåœ°å€
- å‘Šè¯‰DispatcherServletåº”è¯¥æ‰¾è°æ¥å¤„ç†

### 3.2 URLæ˜ å°„è§„åˆ™


**@RequestMappingæ³¨è§£è¯¦è§£**ï¼š

```java
@Controller
@RequestMapping("/user")  // ç±»çº§åˆ«ï¼šæ‰€æœ‰æ–¹æ³•éƒ½ä»¥/userå¼€å¤´
public class UserController {
    
    // æœ€ç»ˆURL: /user/login
    @RequestMapping("/login")
    public String login() {
        return "login";
    }
    
    // æŒ‡å®šè¯·æ±‚æ–¹æ³•
    @RequestMapping(value = "/save", method = RequestMethod.POST)
    public String saveUser() {
        return "success";
    }
}
```

**ç°ä»£åŒ–ç®€å†™æ–¹å¼**ï¼š
```java
@RestController
@RequestMapping("/api/user")
public class UserController {
    
    @GetMapping("/list")     // ç­‰ä»·äº @RequestMapping(method = GET)
    public List<User> getUsers() { }
    
    @PostMapping("/create")  // ç­‰ä»·äº @RequestMapping(method = POST) 
    public User createUser() { }
    
    @PutMapping("/{id}")     // è·¯å¾„å‚æ•°
    public User updateUser(@PathVariable Long id) { }
    
    @DeleteMapping("/{id}")
    public void deleteUser(@PathVariable Long id) { }
}
```

### 3.3 è·¯å¾„åŒ¹é…è§„åˆ™


**é€šé…ç¬¦æ”¯æŒ**ï¼š

| é€šé…ç¬¦ | **å«ä¹‰** | **ç¤ºä¾‹** | **åŒ¹é…ç»“æœ** |
|--------|---------|----------|-------------|
| `?` | åŒ¹é…ä¸€ä¸ªå­—ç¬¦ | `/user/?` | `/user/1`, `/user/a` |
| `*` | åŒ¹é…ä»»æ„å­—ç¬¦ | `/user/*` | `/user/abc`, `/user/123` |
| `**` | åŒ¹é…å¤šçº§è·¯å¾„ | `/user/**` | `/user/a/b/c` |

**è·¯å¾„å‚æ•°æå–**ï¼š
```java
// URL: /user/123/orders/456
@GetMapping("/user/{userId}/orders/{orderId}")
public String getOrder(@PathVariable Long userId, 
                      @PathVariable Long orderId) {
    System.out.println("ç”¨æˆ·ID: " + userId);    // è¾“å‡º: 123
    System.out.println("è®¢å•ID: " + orderId);   // è¾“å‡º: 456
    return "order-detail";
}
```

---

## 4. ğŸ›ï¸ Controlleræ§åˆ¶å™¨è¯¦è§£


### 4.1 Controllerçš„æœ¬è´¨


**ç®€å•ç†è§£**ï¼šControllerå°±æ˜¯**å…·ä½“çš„ä¸šåŠ¡å¤„ç†å‘˜å·¥**ï¼Œæ¯ä¸ªControllerè´Ÿè´£å¤„ç†ç‰¹å®šç±»å‹çš„ç”¨æˆ·è¯·æ±‚ã€‚

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
é“¶è¡Œè¥ä¸šå…ï¼š
â”œâ”€â”€ å¼€æˆ·Controller  â†’ å¤„ç†å¼€æˆ·ç›¸å…³è¯·æ±‚
â”œâ”€â”€ è½¬è´¦Controller  â†’ å¤„ç†è½¬è´¦ç›¸å…³è¯·æ±‚  
â”œâ”€â”€ æŸ¥è¯¢Controller  â†’ å¤„ç†ä½™é¢æŸ¥è¯¢è¯·æ±‚
â””â”€â”€ è´·æ¬¾Controller  â†’ å¤„ç†è´·æ¬¾ç”³è¯·è¯·æ±‚
```

### 4.2 ControlleråŸºæœ¬ä½¿ç”¨


**ä¼ ç»ŸControllerï¼ˆå®ç°æ¥å£æ–¹å¼ï¼‰**ï¼š
```java
public class LoginController implements Controller {
    @Override
    public ModelAndView handleRequest(HttpServletRequest request, 
                                    HttpServletResponse response) {
        // å¤„ç†ç™»å½•é€»è¾‘
        ModelAndView mv = new ModelAndView();
        mv.setViewName("login-success");
        mv.addObject("username", "å¼ ä¸‰");
        return mv;
    }
}
```

**ç°ä»£Controllerï¼ˆæ³¨è§£æ–¹å¼ï¼‰**ï¼š
```java
@Controller
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // æ˜¾ç¤ºç™»å½•é¡µé¢
    @GetMapping("/login")
    public String showLogin() {
        return "login";  // è¿”å›login.htmlé¡µé¢
    }
    
    // å¤„ç†ç™»å½•è¯·æ±‚
    @PostMapping("/login")
    public String handleLogin(@RequestParam String username,
                             @RequestParam String password,
                             Model model) {
        
        boolean success = userService.login(username, password);
        
        if (success) {
            model.addAttribute("username", username);
            return "dashboard";  // ç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ°ä»ªè¡¨ç›˜
        } else {
            model.addAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            return "login";      // ç™»å½•å¤±è´¥ï¼Œè¿”å›ç™»å½•é¡µé¢
        }
    }
}
```

### 4.3 å‚æ•°æ¥æ”¶æ–¹å¼


**å„ç§å‚æ•°æ¥æ”¶æ–¹æ³•**ï¼š

```java
@Controller
public class ExampleController {
    
    // 1. æ¥æ”¶è¡¨å•å‚æ•°
    @PostMapping("/user/save")
    public String saveUser(@RequestParam String name,
                          @RequestParam int age,
                          @RequestParam(required = false) String email) {
        // name, age æ˜¯å¿…éœ€çš„ï¼Œemailæ˜¯å¯é€‰çš„
        return "success";
    }
    
    // 2. æ¥æ”¶å¯¹è±¡å‚æ•°ï¼ˆè‡ªåŠ¨ç»‘å®šï¼‰
    @PostMapping("/user/create")
    public String createUser(User user) {
        // Springè‡ªåŠ¨å°†è¡¨å•å‚æ•°ç»‘å®šåˆ°Userå¯¹è±¡
        // å‰ç«¯è¡¨å•å­—æ®µåè¦å’ŒUserå±æ€§åä¸€è‡´
        return "success";
    }
    
    // 3. æ¥æ”¶JSONå‚æ•°
    @PostMapping("/api/user")
    @ResponseBody
    public User createUserApi(@RequestBody User user) {
        // æ¥æ”¶JSONæ ¼å¼çš„è¯·æ±‚ä½“ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºUserå¯¹è±¡
        return userService.save(user);
    }
    
    // 4. æ¥æ”¶è·¯å¾„å‚æ•°
    @GetMapping("/user/{id}")
    public String getUser(@PathVariable Long id, Model model) {
        User user = userService.findById(id);
        model.addAttribute("user", user);
        return "user-detail";
    }
}
```

### 4.4 æ•°æ®ä¼ é€’ç»™å‰ç«¯


**Modelæ•°æ®ä¼ é€’**ï¼š
```java
@Controller
public class DataController {
    
    @GetMapping("/user/profile")
    public String userProfile(Model model) {
        // æ–¹å¼1ï¼šä½¿ç”¨Model
        model.addAttribute("username", "å¼ ä¸‰");
        model.addAttribute("age", 25);
        
        // å‰ç«¯é¡µé¢å¯ä»¥é€šè¿‡ ${username} è·å–
        return "profile";
    }
    
    @GetMapping("/user/info")
    public ModelAndView userInfo() {
        // æ–¹å¼2ï¼šä½¿ç”¨ModelAndView
        ModelAndView mv = new ModelAndView();
        mv.setViewName("user-info");
        mv.addObject("user", new User("æå››", 30));
        return mv;
    }
    
    // RESTful APIè¿”å›JSON
    @GetMapping("/api/user/{id}")
    @ResponseBody
    public User getUserApi(@PathVariable Long id) {
        // ç›´æ¥è¿”å›å¯¹è±¡ï¼ŒSpringè‡ªåŠ¨è½¬æ¢ä¸ºJSON
        return userService.findById(id);
    }
}
```

---

## 5. ğŸ‘€ ViewResolverè§†å›¾è§£æå™¨


### 5.1 ViewResolverçš„ä½œç”¨


**é€šä¿—è§£é‡Š**ï¼šViewResolverå°±åƒä¸€ä¸ª**é¡µé¢ç¿»è¯‘å®˜**ï¼ŒControllerå¤„ç†å®Œä¸šåŠ¡åè¯´"ç»™ç”¨æˆ·æ˜¾ç¤ºsuccessé¡µé¢"ï¼ŒViewResolverè´Ÿè´£ï¼š
- ç†è§£"success"çš„çœŸæ­£å«ä¹‰
- æ‰¾åˆ°å¯¹åº”çš„é¡µé¢æ–‡ä»¶ï¼ˆæ¯”å¦‚success.htmlï¼‰
- æŠŠæ•°æ®å¡«å…¥é¡µé¢æ¨¡æ¿
- ç”Ÿæˆæœ€ç»ˆçš„HTMLè¿”å›ç»™ç”¨æˆ·

### 5.2 è§†å›¾è§£ææµç¨‹


```
è§†å›¾è§£æè¿‡ç¨‹ï¼š
Controllerè¿”å›"user-list" 
        â†“
ViewResolverè§£æ
        â†“
æŸ¥æ‰¾: /WEB-INF/views/user-list.html
        â†“  
å¡«å……æ•°æ®: ${users} â†’ å®é™…ç”¨æˆ·åˆ—è¡¨
        â†“
ç”Ÿæˆæœ€ç»ˆHTMLè¿”å›ç»™æµè§ˆå™¨
```

### 5.3 å¸¸ç”¨ViewResolveré…ç½®


**InternalResourceViewResolverï¼ˆJSPé¡µé¢ï¼‰**ï¼š
```java
@Configuration
public class ViewConfig {
    
    @Bean
    public InternalResourceViewResolver viewResolver() {
        InternalResourceViewResolver resolver = new InternalResourceViewResolver();
        resolver.setPrefix("/WEB-INF/views/");  // é¡µé¢æ–‡ä»¶è·¯å¾„å‰ç¼€
        resolver.setSuffix(".jsp");             // é¡µé¢æ–‡ä»¶æ‰©å±•å
        return resolver;
        // Controllerè¿”å›"login" â†’ å®é™…é¡µé¢: /WEB-INF/views/login.jsp
    }
}
```

**ThymeleafViewResolverï¼ˆç°ä»£æ¨¡æ¿å¼•æ“ï¼‰**ï¼š
```java
@Configuration
public class ThymeleafConfig {
    
    @Bean
    public SpringTemplateEngine templateEngine() {
        SpringTemplateEngine templateEngine = new SpringTemplateEngine();
        templateEngine.setTemplateResolver(templateResolver());
        return templateEngine;
    }
    
    @Bean
    public ITemplateResolver templateResolver() {
        SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver();
        templateResolver.setPrefix("classpath:/templates/");  // æ¨¡æ¿è·¯å¾„
        templateResolver.setSuffix(".html");                  // æ–‡ä»¶æ‰©å±•å
        templateResolver.setTemplateMode(TemplateMode.HTML);
        return templateResolver;
    }
}
```

### 5.4 è§†å›¾ç±»å‹ä¸åº”ç”¨åœºæ™¯


**ä¸åŒè§†å›¾ç±»å‹å¯¹æ¯”**ï¼š

| è§†å›¾ç±»å‹ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **é…ç½®å¤æ‚åº¦** |
|---------|---------|-------------|---------------|
| **JSP** | ä¼ ç»Ÿã€æœåŠ¡å™¨æ¸²æŸ“ | ä¼ ç»ŸWebåº”ç”¨ | ç®€å• |
| **Thymeleaf** | ç°ä»£æ¨¡æ¿å¼•æ“ | Spring Bootåº”ç”¨ | ä¸­ç­‰ |
| **JSONè§†å›¾** | æ•°æ®æ ¼å¼ | RESTful API | ç®€å• |
| **é‡å®šå‘** | é¡µé¢è·³è½¬ | æ“ä½œåè·³è½¬ | ç®€å• |

**å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Controller
public class ViewExampleController {
    
    // è¿”å›JSPé¡µé¢
    @GetMapping("/user/list")
    public String listUsers(Model model) {
        model.addAttribute("users", userService.findAll());
        return "user/list";  // â†’ /WEB-INF/views/user/list.jsp
    }
    
    // é‡å®šå‘
    @PostMapping("/user/save")
    public String saveUser(User user) {
        userService.save(user);
        return "redirect:/user/list";  // ä¿å­˜åé‡å®šå‘åˆ°åˆ—è¡¨é¡µ
    }
    
    // è½¬å‘
    @GetMapping("/user/detail")
    public String userDetail() {
        return "forward:/user/profile";  // è½¬å‘åˆ°å¦ä¸€ä¸ªController
    }
    
    // JSONå“åº”ï¼ˆAJAXè¯·æ±‚ï¼‰
    @PostMapping("/api/user/save")
    @ResponseBody
    public Map<String, Object> saveUserApi(@RequestBody User user) {
        userService.save(user);
        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("message", "ä¿å­˜æˆåŠŸ");
        return result;  // è‡ªåŠ¨è½¬æ¢ä¸ºJSONè¿”å›
    }
}
```

---

## 6. ğŸ›¡ï¸ æ‹¦æˆªå™¨Interceptoræœºåˆ¶


### 6.1 æ‹¦æˆªå™¨çš„æ¦‚å¿µ


**ç”Ÿæ´»åŒ–ç†è§£**ï¼šæ‹¦æˆªå™¨å°±åƒ**æœºåœºå®‰æ£€**ï¼Œåœ¨æ—…å®¢ç™»æœºå‰è¿›è¡Œå„ç§æ£€æŸ¥ï¼š

```
ç”¨æˆ·è¯·æ±‚å¤„ç†æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ æ‹¦æˆªå™¨1(å®‰æ£€) â†’ æ‹¦æˆªå™¨2(èº«ä»½éªŒè¯) â†’ Controller(ç™»æœº) â†’ å¤„ç†å®Œæˆ
              â†“                    â†“                    â†“
           æ£€æŸ¥æƒé™              æ£€æŸ¥ç™»å½•çŠ¶æ€           å®é™…ä¸šåŠ¡å¤„ç†
```

### 6.2 æ‹¦æˆªå™¨vsè¿‡æ»¤å™¨


**Filterï¼ˆè¿‡æ»¤å™¨ï¼‰vs Interceptorï¼ˆæ‹¦æˆªå™¨ï¼‰å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | **Filterè¿‡æ»¤å™¨** | **Interceptoræ‹¦æˆªå™¨** |
|------|-----------------|---------------------|
| **ä½œç”¨èŒƒå›´** | Servletå®¹å™¨çº§åˆ« | Springæ¡†æ¶çº§åˆ« |
| **é…ç½®æ–¹å¼** | web.xmlæˆ–@WebFilter | Springé…ç½® |
| **èƒ½å¦è®¿é—®Springå®¹å™¨** | âŒ ä¸èƒ½ | âœ… å¯ä»¥ |
| **æ‰§è¡Œé¡ºåº** | åœ¨æ‹¦æˆªå™¨ä¹‹å‰ | åœ¨Controllerå‰å |
| **ä½¿ç”¨åœºæ™¯** | ç¼–ç ã€è·¨åŸŸç­‰ | æƒé™ã€æ—¥å¿—ã€äº‹åŠ¡ç­‰ |

### 6.3 è‡ªå®šä¹‰æ‹¦æˆªå™¨


**åˆ›å»ºæ‹¦æˆªå™¨**ï¼š
```java
@Component
public class LoginInterceptor implements HandlerInterceptor {
    
    // åœ¨Controlleræ‰§è¡Œå‰è°ƒç”¨
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        
        String uri = request.getRequestURI();
        
        // ä¸éœ€è¦ç™»å½•çš„é¡µé¢ï¼Œç›´æ¥æ”¾è¡Œ
        if (uri.contains("/login") || uri.contains("/register")) {
            return true;
        }
        
        // æ£€æŸ¥sessionä¸­æ˜¯å¦æœ‰ç”¨æˆ·ä¿¡æ¯
        Object user = request.getSession().getAttribute("user");
        if (user != null) {
            return true;  // å·²ç™»å½•ï¼Œæ”¾è¡Œ
        }
        
        // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
        response.sendRedirect("/login");
        return false;  // æ‹¦æˆªè¯·æ±‚
    }
    
    // åœ¨Controlleræ‰§è¡Œåã€è§†å›¾æ¸²æŸ“å‰è°ƒç”¨
    @Override
    public void postHandle(HttpServletRequest request, 
                          HttpServletResponse response, 
                          Object handler, 
                          ModelAndView modelAndView) throws Exception {
        
        // å¯ä»¥ä¿®æ”¹ModelAndViewï¼Œæ·»åŠ é€šç”¨æ•°æ®
        if (modelAndView != null) {
            modelAndView.addObject("currentTime", new Date());
        }
    }
    
    // åœ¨æ•´ä¸ªè¯·æ±‚å¤„ç†å®Œæˆåè°ƒç”¨
    @Override
    public void afterCompletion(HttpServletRequest request, 
                               HttpServletResponse response, 
                               Object handler, 
                               Exception ex) throws Exception {
        
        // æ¸…ç†èµ„æºã€è®°å½•æ—¥å¿—ç­‰
        System.out.println("è¯·æ±‚å¤„ç†å®Œæˆ: " + request.getRequestURI());
    }
}
```

**æ³¨å†Œæ‹¦æˆªå™¨**ï¼š
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Autowired
    private LoginInterceptor loginInterceptor;
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loginInterceptor)
                .addPathPatterns("/**")           // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
                .excludePathPatterns(             // æ’é™¤è¿™äº›è·¯å¾„
                    "/login", 
                    "/register", 
                    "/css/**", 
                    "/js/**", 
                    "/images/**"
                );
    }
}
```

### 6.4 æ‹¦æˆªå™¨åº”ç”¨åœºæ™¯


**å¸¸ç”¨æ‹¦æˆªå™¨åœºæ™¯**ï¼š

ğŸ”¸ **æƒé™æ§åˆ¶**ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æƒé™
ğŸ”¸ **ç™»å½•éªŒè¯**ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
ğŸ”¸ **æ“ä½œæ—¥å¿—**ï¼šè®°å½•ç”¨æˆ·æ“ä½œè¡Œä¸º
ğŸ”¸ **æ€§èƒ½ç›‘æ§**ï¼šç»Ÿè®¡æ¥å£å“åº”æ—¶é—´
ğŸ”¸ **å‚æ•°æ ¡éªŒ**ï¼šç»Ÿä¸€å‚æ•°æ ¼å¼éªŒè¯

**å®ç”¨ç¤ºä¾‹ - æ“ä½œæ—¥å¿—æ‹¦æˆªå™¨**ï¼š
```java
@Component
public class LogInterceptor implements HandlerInterceptor {
    
    private static final Logger logger = LoggerFactory.getLogger(LogInterceptor.class);
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) {
        
        String ip = getClientIP(request);
        String method = request.getMethod();
        String uri = request.getRequestURI();
        
        logger.info("è¯·æ±‚å¼€å§‹ - IP: {}, Method: {}, URI: {}", ip, method, uri);
        
        // è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´
        request.setAttribute("startTime", System.currentTimeMillis());
        
        return true;
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, 
                               HttpServletResponse response, 
                               Object handler, Exception ex) {
        
        long startTime = (Long) request.getAttribute("startTime");
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        
        logger.info("è¯·æ±‚å®Œæˆ - è€—æ—¶: {}ms, çŠ¶æ€ç : {}", duration, response.getStatus());
    }
    
    private String getClientIP(HttpServletRequest request) {
        // è·å–çœŸå®IPåœ°å€çš„é€»è¾‘
        return request.getRemoteAddr();
    }
}
```

---

## 7. âš ï¸ å¼‚å¸¸å¤„ç†æœºåˆ¶


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†


**ä¼ ç»Ÿå¼‚å¸¸å¤„ç†çš„é—®é¢˜**ï¼š
```
æ¯ä¸ªControlleréƒ½è¦å†™try-catch â†’ ä»£ç é‡å¤ã€ç»´æŠ¤å›°éš¾
å¼‚å¸¸ä¿¡æ¯ä¸ç»Ÿä¸€ â†’ ç”¨æˆ·ä½“éªŒå·®
é”™è¯¯é¡µé¢å„ä¸ç›¸åŒ â†’ ç•Œé¢ä¸ä¸€è‡´
```

**Spring MVCç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„å¥½å¤„**ï¼š
```
é›†ä¸­å¤„ç† â†’ ä»£ç ç®€æ´
ç»Ÿä¸€æ ¼å¼ â†’ ç”¨æˆ·ä½“éªŒå¥½  
æ˜“äºç»´æŠ¤ â†’ æ”¹ä¸€å¤„ï¼Œå…¨å±€ç”Ÿæ•ˆ
```

### 7.2 å¼‚å¸¸å¤„ç†æ–¹å¼


**@ExceptionHandlerï¼ˆæ–¹æ³•çº§åˆ«ï¼‰**ï¼š
```java
@Controller
public class UserController {
    
    @GetMapping("/user/{id}")
    public String getUser(@PathVariable Long id, Model model) {
        User user = userService.findById(id);  // å¯èƒ½æŠ›å‡ºå¼‚å¸¸
        model.addAttribute("user", user);
        return "user-detail";
    }
    
    // å¤„ç†å½“å‰Controllerä¸­çš„å¼‚å¸¸
    @ExceptionHandler(UserNotFoundException.class)
    public String handleUserNotFound(UserNotFoundException ex, Model model) {
        model.addAttribute("error", "ç”¨æˆ·ä¸å­˜åœ¨: " + ex.getMessage());
        return "error/user-not-found";
    }
}
```

**@ControllerAdviceï¼ˆå…¨å±€å¼‚å¸¸å¤„ç†ï¼‰**ï¼š
```java
@ControllerAdvice  // å…¨å±€å¼‚å¸¸å¤„ç†å™¨
public class GlobalExceptionHandler {
    
    private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public String handleBusinessException(BusinessException ex, Model model) {
        logger.warn("ä¸šåŠ¡å¼‚å¸¸: {}", ex.getMessage());
        model.addAttribute("error", ex.getMessage());
        return "error/business-error";  // è·³è½¬åˆ°ä¸šåŠ¡é”™è¯¯é¡µé¢
    }
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public String handleValidationException(MethodArgumentNotValidException ex, Model model) {
        
        // è·å–ç¬¬ä¸€ä¸ªæ ¡éªŒé”™è¯¯ä¿¡æ¯
        String errorMsg = ex.getBindingResult()
                           .getFieldErrors()
                           .get(0)
                           .getDefaultMessage();
        
        model.addAttribute("error", "å‚æ•°é”™è¯¯: " + errorMsg);
        return "error/validation-error";
    }
    
    // å¤„ç†ç³»ç»Ÿå¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public String handleException(Exception ex, Model model) {
        logger.error("ç³»ç»Ÿå¼‚å¸¸", ex);  // è®°å½•å®Œæ•´å¼‚å¸¸ä¿¡æ¯
        model.addAttribute("error", "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
        return "error/system-error";   // è·³è½¬åˆ°ç³»ç»Ÿé”™è¯¯é¡µé¢
    }
}
```

### 7.3 RESTful APIå¼‚å¸¸å¤„ç†


**JSONæ ¼å¼å¼‚å¸¸å“åº”**ï¼š
```java
@RestControllerAdvice  // ä¸“é—¨å¤„ç†@RestControllerçš„å¼‚å¸¸
public class ApiExceptionHandler {
    
    // ç»Ÿä¸€APIå“åº”æ ¼å¼
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse> handleBusinessException(BusinessException ex) {
        
        ApiResponse response = new ApiResponse();
        response.setCode(400);
        response.setMessage(ex.getMessage());
        response.setSuccess(false);
        
        return ResponseEntity.badRequest().body(response);
    }
    
    // å¤„ç†404å¼‚å¸¸
    @ExceptionHandler(NoHandlerFoundException.class)
    public ResponseEntity<ApiResponse> handleNotFound(NoHandlerFoundException ex) {
        
        ApiResponse response = new ApiResponse();
        response.setCode(404);
        response.setMessage("æ¥å£ä¸å­˜åœ¨");
        response.setSuccess(false);
        
        return ResponseEntity.status(404).body(response);
    }
}

// ç»Ÿä¸€å“åº”æ ¼å¼
class ApiResponse {
    private boolean success;
    private int code;
    private String message;
    private Object data;
    
    // getter/setterçœç•¥...
}
```

### 7.4 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


**è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸**ï¼š
```java
// åŸºç¡€å¼‚å¸¸ç±»
public class BaseException extends RuntimeException {
    private int code;
    private String message;
    
    public BaseException(int code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
    
    // getteræ–¹æ³•çœç•¥...
}

// å…·ä½“ä¸šåŠ¡å¼‚å¸¸
public class UserNotFoundException extends BaseException {
    public UserNotFoundException(String username) {
        super(404, "ç”¨æˆ·ä¸å­˜åœ¨: " + username);
    }
}

public class PasswordIncorrectException extends BaseException {
    public PasswordIncorrectException() {
        super(401, "å¯†ç ä¸æ­£ç¡®");
    }
}
```

**å¼‚å¸¸å¤„ç†ç­–ç•¥**ï¼š

| å¼‚å¸¸ç±»å‹ | **å¤„ç†æ–¹å¼** | **ç”¨æˆ·æç¤º** | **æ—¥å¿—çº§åˆ«** |
|---------|-------------|-------------|-------------|
| **ä¸šåŠ¡å¼‚å¸¸** | å‹å¥½æç¤º | å…·ä½“é”™è¯¯ä¿¡æ¯ | WARN |
| **å‚æ•°å¼‚å¸¸** | å‚æ•°æ ¡éªŒæç¤º | "å‚æ•°æ ¼å¼é”™è¯¯" | INFO |
| **æƒé™å¼‚å¸¸** | è·³è½¬ç™»å½•é¡µ | "è¯·å…ˆç™»å½•" | WARN |
| **ç³»ç»Ÿå¼‚å¸¸** | é€šç”¨é”™è¯¯é¡µ | "ç³»ç»Ÿç¹å¿™" | ERROR |

---

## 8. ğŸ“‹ æ•°æ®ç»‘å®šä¸éªŒè¯


### 8.1 æ•°æ®ç»‘å®šæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ•°æ®ç»‘å®š**ï¼šå°±åƒ**æ™ºèƒ½çš„å¿«é€’å‘˜**ï¼Œèƒ½å¤Ÿï¼š
- æ¥æ”¶ç”¨æˆ·æäº¤çš„è¡¨å•æ•°æ®ï¼ˆå„ç§æ ¼å¼ï¼‰
- è‡ªåŠ¨è½¬æ¢æˆJavaå¯¹è±¡çš„å±æ€§
- å¤„ç†ç±»å‹è½¬æ¢ï¼ˆå­—ç¬¦ä¸²â†’æ•°å­—ã€å­—ç¬¦ä¸²â†’æ—¥æœŸç­‰ï¼‰

```
æ•°æ®ç»‘å®šè¿‡ç¨‹ï¼š
å‰ç«¯è¡¨å•: name="å¼ ä¸‰", age="25", birthday="2023-01-01"
           â†“ (Springè‡ªåŠ¨è½¬æ¢)
Javaå¯¹è±¡: User{name="å¼ ä¸‰", age=25, birthday=Dateå¯¹è±¡}
```

### 8.2 åŸºæœ¬æ•°æ®ç»‘å®š


**ç®€å•å‚æ•°ç»‘å®š**ï¼š
```java
@Controller
public class UserController {
    
    // æ¥æ”¶ç®€å•å‚æ•°
    @PostMapping("/user/save")
    public String saveUser(@RequestParam String name,
                          @RequestParam int age,
                          @RequestParam(required = false) String email) {
        
        System.out.println("å§“å: " + name);
        System.out.println("å¹´é¾„: " + age);  // è‡ªåŠ¨è½¬æ¢ä¸ºintç±»å‹
        System.out.println("é‚®ç®±: " + email);
        
        return "success";
    }
    
    // å¯¹è±¡å‚æ•°ç»‘å®šï¼ˆæ¨èæ–¹å¼ï¼‰
    @PostMapping("/user/create")  
    public String createUser(User user) {
        // Springè‡ªåŠ¨å°†è¡¨å•å‚æ•°ç»‘å®šåˆ°Userå¯¹è±¡
        // è¦æ±‚ï¼šè¡¨å•å­—æ®µå = Userå±æ€§å
        System.out.println("ç”¨æˆ·ä¿¡æ¯: " + user);
        return "success";
    }
}

// Userå®ä½“ç±»
public class User {
    private String name;
    private int age;
    private String email;
    private Date birthday;
    
    // getter/setteræ–¹æ³•å¿…é¡»æœ‰ï¼ŒSpringé€šè¿‡åå°„è°ƒç”¨
}
```

**å‰ç«¯è¡¨å•ç¤ºä¾‹**ï¼š
```html
<form action="/user/create" method="post">
    å§“å: <input name="name" type="text" />
    å¹´é¾„: <input name="age" type="number" />
    é‚®ç®±: <input name="email" type="email" />
    ç”Ÿæ—¥: <input name="birthday" type="date" />
    <button type="submit">ä¿å­˜</button>
</form>
```

### 8.3 é«˜çº§æ•°æ®ç»‘å®š


**é›†åˆæ•°æ®ç»‘å®š**ï¼š
```java
// å¤„ç†æ•°ç»„å‚æ•°
@PostMapping("/user/batch-delete")
public String batchDelete(@RequestParam Long[] ids) {
    System.out.println("è¦åˆ é™¤çš„ID: " + Arrays.toString(ids));
    return "success";
}

// å¤„ç†Listé›†åˆ
@PostMapping("/user/batch-save")
public String batchSave(@RequestParam List<String> names) {
    System.out.println("å§“ååˆ—è¡¨: " + names);
    return "success";  
}
```

**åµŒå¥—å¯¹è±¡ç»‘å®š**ï¼š
```java
// å¤æ‚å¯¹è±¡
public class UserForm {
    private String name;
    private Address address;  // åµŒå¥—å¯¹è±¡
    private List<Phone> phones;  // é›†åˆå¯¹è±¡
}

public class Address {
    private String province;
    private String city; 
    private String detail;
}

@PostMapping("/user/register")
public String register(UserForm form) {
    // è‡ªåŠ¨ç»‘å®šåµŒå¥—å¯¹è±¡å’Œé›†åˆ
    return "success";
}
```

**å¯¹åº”å‰ç«¯è¡¨å•**ï¼š
```html
<form action="/user/register" method="post">
    å§“å: <input name="name" />
    
    <!-- åµŒå¥—å¯¹è±¡ï¼šaddress.å±æ€§å -->
    çœä»½: <input name="address.province" />
    åŸå¸‚: <input name="address.city" />
    è¯¦ç»†åœ°å€: <input name="address.detail" />
    
    <!-- é›†åˆå¯¹è±¡ï¼šé›†åˆå[ç´¢å¼•].å±æ€§å -->
    ç”µè¯1: <input name="phones[0].number" />
    ç”µè¯2: <input name="phones[1].number" />
    
    <button type="submit">æ³¨å†Œ</button>
</form>
```

### 8.4 æ•°æ®éªŒè¯è¯¦è§£


**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®éªŒè¯**ï¼š
- **å®‰å…¨æ€§**ï¼šé˜²æ­¢æ¶æ„æ•°æ®æ”»å‡»
- **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿æ•°æ®ç¬¦åˆä¸šåŠ¡è§„åˆ™  
- **ç”¨æˆ·ä½“éªŒ**ï¼šåŠæ—¶æç¤ºè¾“å…¥é”™è¯¯

**JSR-303æ³¨è§£éªŒè¯**ï¼š
```java
import javax.validation.constraints.*;

public class User {
    
    @NotEmpty(message = "å§“åä¸èƒ½ä¸ºç©º")
    @Size(min = 2, max = 10, message = "å§“åé•¿åº¦å¿…é¡»åœ¨2-10ä¸ªå­—ç¬¦ä¹‹é—´")
    private String name;
    
    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    @Min(value = 1, message = "å¹´é¾„ä¸èƒ½å°äº1å²")
    @Max(value = 120, message = "å¹´é¾„ä¸èƒ½å¤§äº120å²")
    private Integer age;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    @Past(message = "å‡ºç”Ÿæ—¥æœŸå¿…é¡»æ˜¯è¿‡å»çš„æ—¥æœŸ")
    private Date birthday;
}
```

**Controllerä¸­å¯ç”¨éªŒè¯**ï¼š
```java
@Controller
public class UserController {
    
    @PostMapping("/user/save")
    public String saveUser(@Valid User user,           // @Validå¼€å¯éªŒè¯
                          BindingResult bindingResult, // éªŒè¯ç»“æœ
                          Model model) {
        
        // æ£€æŸ¥æ˜¯å¦æœ‰éªŒè¯é”™è¯¯
        if (bindingResult.hasErrors()) {
            
            // è·å–æ‰€æœ‰é”™è¯¯ä¿¡æ¯
            List<String> errors = bindingResult.getFieldErrors()
                                              .stream()
                                              .map(error -> error.getDefaultMessage())
                                              .collect(Collectors.toList());
            
            model.addAttribute("errors", errors);
            model.addAttribute("user", user);  // å›æ˜¾ç”¨æˆ·è¾“å…¥
            return "user/form";  // è¿”å›è¡¨å•é¡µé¢æ˜¾ç¤ºé”™è¯¯
        }
        
        // éªŒè¯é€šè¿‡ï¼Œä¿å­˜ç”¨æˆ·
        userService.save(user);
        return "redirect:/user/list";
    }
}
```

### 8.5 è‡ªå®šä¹‰æ•°æ®è½¬æ¢


**æ—¥æœŸæ ¼å¼è½¬æ¢**ï¼š
```java
@Controller  
public class UserController {
    
    // è‡ªå®šä¹‰æ—¥æœŸè½¬æ¢æ ¼å¼
    @InitBinder
    public void initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
    }
    
    @PostMapping("/user/save")
    public String saveUser(User user) {
        // ç°åœ¨å¯ä»¥æ­£ç¡®è½¬æ¢ "2023-01-01" å­—ç¬¦ä¸²ä¸ºDateå¯¹è±¡
        return "success";
    }
}
```

**å…¨å±€æ•°æ®è½¬æ¢é…ç½®**ï¼š
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addFormatters(FormatterRegistry registry) {
        // æ³¨å†Œè‡ªå®šä¹‰è½¬æ¢å™¨
        registry.addFormatter(new DateFormatter("yyyy-MM-dd"));
    }
}
```

---

## 9. ğŸŒ RESTfulæ”¯æŒ


### 9.1 RESTfulæ¦‚å¿µè¯¦è§£


**ä»€ä¹ˆæ˜¯RESTful**ï¼šä¸€ç§**ç½‘å€è®¾è®¡é£æ ¼**ï¼Œè®©URLæ›´åŠ ç›´è§‚å’Œç»Ÿä¸€ï¼š

```
ä¼ ç»Ÿé£æ ¼ï¼ˆä¸å¥½ç†è§£ï¼‰ï¼š
GET  /getUserById?id=1      â†’ è·å–ç”¨æˆ·
POST /saveUser              â†’ ä¿å­˜ç”¨æˆ·  
POST /updateUser            â†’ æ›´æ–°ç”¨æˆ·
POST /deleteUser?id=1       â†’ åˆ é™¤ç”¨æˆ·

RESTfulé£æ ¼ï¼ˆç›´è§‚æ˜“æ‡‚ï¼‰ï¼š
GET    /user/1              â†’ è·å–1å·ç”¨æˆ·
POST   /user                â†’ åˆ›å»ºç”¨æˆ·
PUT    /user/1              â†’ æ›´æ–°1å·ç”¨æˆ·  
DELETE /user/1              â†’ åˆ é™¤1å·ç”¨æˆ·
```

### 9.2 HTTPæ–¹æ³•å«ä¹‰


**RESTfulè®¾è®¡åŸåˆ™**ï¼š

| HTTPæ–¹æ³• | **æ“ä½œç±»å‹** | **å«ä¹‰** | **ç¤ºä¾‹URL** |
|----------|-------------|---------|------------|
| **GET** | æŸ¥è¯¢ | è·å–èµ„æº | `GET /users` è·å–ç”¨æˆ·åˆ—è¡¨ |
| **POST** | åˆ›å»º | åˆ›å»ºæ–°èµ„æº | `POST /users` åˆ›å»ºæ–°ç”¨æˆ· |
| **PUT** | æ›´æ–° | å®Œæ•´æ›´æ–°èµ„æº | `PUT /users/1` æ›´æ–°ç”¨æˆ·1çš„æ‰€æœ‰ä¿¡æ¯ |
| **PATCH** | éƒ¨åˆ†æ›´æ–° | éƒ¨åˆ†æ›´æ–°èµ„æº | `PATCH /users/1` åªæ›´æ–°ç”¨æˆ·1çš„éƒ¨åˆ†ä¿¡æ¯ |
| **DELETE** | åˆ é™¤ | åˆ é™¤èµ„æº | `DELETE /users/1` åˆ é™¤ç”¨æˆ·1 |

### 9.3 RESTful Controllerå®ç°


**ç”¨æˆ·ç®¡ç†RESTful API**ï¼š
```java
@RestController  // ç­‰ä»·äº @Controller + @ResponseBody
@RequestMapping("/api/users")
public class UserRestController {
    
    @Autowired
    private UserService userService;
    
    // è·å–æ‰€æœ‰ç”¨æˆ· GET /api/users
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();
    }
    
    // è·å–å•ä¸ªç”¨æˆ· GET /api/users/1
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user != null) {
            return ResponseEntity.ok(user);         // 200çŠ¶æ€ç  + ç”¨æˆ·æ•°æ®
        } else {
            return ResponseEntity.notFound().build(); // 404çŠ¶æ€ç 
        }
    }
    
    // åˆ›å»ºç”¨æˆ· POST /api/users
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody @Valid User user) {
        User savedUser = userService.save(user);
        return ResponseEntity.status(201).body(savedUser);  // 201çŠ¶æ€ç è¡¨ç¤ºåˆ›å»ºæˆåŠŸ
    }
    
    // æ›´æ–°ç”¨æˆ· PUT /api/users/1
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(@PathVariable Long id, 
                                         @RequestBody @Valid User user) {
        user.setId(id);  // ç¡®ä¿IDæ­£ç¡®
        User updatedUser = userService.update(user);
        return ResponseEntity.ok(updatedUser);
    }
    
    // åˆ é™¤ç”¨æˆ· DELETE /api/users/1
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        boolean deleted = userService.deleteById(id);
        if (deleted) {
            return ResponseEntity.noContent().build();  // 204çŠ¶æ€ç è¡¨ç¤ºåˆ é™¤æˆåŠŸ
        } else {
            return ResponseEntity.notFound().build();   // 404çŠ¶æ€ç è¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨
        }
    }
    
    // æœç´¢ç”¨æˆ· GET /api/users/search?name=å¼ ä¸‰&age=25
    @GetMapping("/search")
    public List<User> searchUsers(@RequestParam(required = false) String name,
                                 @RequestParam(required = false) Integer age) {
        return userService.search(name, age);
    }
}
```

### 9.4 å“åº”çŠ¶æ€ç ä½¿ç”¨


**å¸¸ç”¨HTTPçŠ¶æ€ç å«ä¹‰**ï¼š

| çŠ¶æ€ç  | **å«ä¹‰** | **ä½¿ç”¨åœºæ™¯** |
|--------|---------|-------------|
| **200** | æˆåŠŸ | æŸ¥è¯¢ã€æ›´æ–°æˆåŠŸ |
| **201** | å·²åˆ›å»º | åˆ›å»ºèµ„æºæˆåŠŸ |
| **204** | æ— å†…å®¹ | åˆ é™¤æˆåŠŸï¼ˆæ— è¿”å›æ•°æ®ï¼‰ |
| **400** | è¯·æ±‚é”™è¯¯ | å‚æ•°æ ¼å¼é”™è¯¯ |
| **401** | æœªæˆæƒ | æœªç™»å½• |
| **403** | ç¦æ­¢è®¿é—® | æƒé™ä¸è¶³ |
| **404** | æœªæ‰¾åˆ° | èµ„æºä¸å­˜åœ¨ |
| **500** | æœåŠ¡å™¨é”™è¯¯ | ç³»ç»Ÿå¼‚å¸¸ |

**ResponseEntityä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@RestController
public class ApiController {
    
    // æˆåŠŸå“åº”
    @GetMapping("/success")
    public ResponseEntity<String> success() {
        return ResponseEntity.ok("æ“ä½œæˆåŠŸ");  // 200çŠ¶æ€ç 
    }
    
    // åˆ›å»ºæˆåŠŸå“åº”
    @PostMapping("/create")
    public ResponseEntity<User> create(@RequestBody User user) {
        User saved = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED)  // 201çŠ¶æ€ç 
                           .header("Location", "/api/users/" + saved.getId())
                           .body(saved);
    }
    
    // é”™è¯¯å“åº”
    @GetMapping("/error")
    public ResponseEntity<Map<String, String>> error() {
        Map<String, String> error = new HashMap<>();
        error.put("message", "å‚æ•°é”™è¯¯");
        error.put("code", "INVALID_PARAM");
        return ResponseEntity.badRequest().body(error);  // 400çŠ¶æ€ç 
    }
}
```

### 9.5 å†…å®¹åå•†


**æ”¯æŒå¤šç§å“åº”æ ¼å¼**ï¼š
```java
@RestController
public class ContentController {
    
    // æ ¹æ®è¯·æ±‚å¤´Acceptå†³å®šå“åº”æ ¼å¼
    @GetMapping(value = "/user/{id}", 
                produces = {"application/json", "application/xml"})
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
        // å®¢æˆ·ç«¯è¯·æ±‚å¤´Accept: application/json â†’ è¿”å›JSON
        // å®¢æˆ·ç«¯è¯·æ±‚å¤´Accept: application/xml  â†’ è¿”å›XML
    }
    
    // æ¥æ”¶JSONæˆ–XMLæ ¼å¼æ•°æ®
    @PostMapping(value = "/user", 
                consumes = {"application/json", "application/xml"})
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User saved = userService.save(user);
        return ResponseEntity.status(201).body(saved);
    }
}
```

**CORSè·¨åŸŸæ”¯æŒ**ï¼š
```java
@RestController
@CrossOrigin(origins = "http://localhost:3000")  // å…è®¸å‰ç«¯è·¨åŸŸè®¿é—®
public class ApiController {
    
    @GetMapping("/api/data")
    public List<String> getData() {
        return Arrays.asList("æ•°æ®1", "æ•°æ®2", "æ•°æ®3");
    }
}

// æˆ–è€…å…¨å±€é…ç½®
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("http://localhost:3000")
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowedHeaders("*")
                .allowCredentials(true);
    }
}
```

---

## 10. ğŸ“š æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ DispatcherServletï¼šç»Ÿä¸€è¯·æ±‚å…¥å£ï¼Œåè°ƒå„ç»„ä»¶å·¥ä½œ
ğŸ”¸ HandlerMappingï¼šURLåˆ°Controllerçš„æ˜ å°„å…³ç³»
ğŸ”¸ Controllerï¼šå…·ä½“ä¸šåŠ¡å¤„ç†å™¨ï¼Œæ¥æ”¶è¯·æ±‚å¤„ç†ä¸šåŠ¡
ğŸ”¸ ViewResolverï¼šè§†å›¾è§£æå™¨ï¼Œå°†é€»è¾‘è§†å›¾åè½¬æ¢ä¸ºå®é™…é¡µé¢
ğŸ”¸ Interceptorï¼šæ‹¦æˆªå™¨ï¼Œåœ¨è¯·æ±‚å¤„ç†å‰åè¿›è¡Œé¢å¤–æ“ä½œ
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œæä¾›å‹å¥½é”™è¯¯é¡µé¢
ğŸ”¸ æ•°æ®ç»‘å®šï¼šè‡ªåŠ¨å°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°Javaå¯¹è±¡
ğŸ”¸ æ•°æ®éªŒè¯ï¼šç¡®ä¿æ•°æ®ç¬¦åˆä¸šåŠ¡è§„åˆ™å’Œæ ¼å¼è¦æ±‚
ğŸ”¸ RESTfulï¼šç°ä»£Web APIè®¾è®¡é£æ ¼ï¼ŒURLè¯­ä¹‰åŒ–
```

### 10.2 Spring MVCè¯·æ±‚å¤„ç†æµç¨‹


```
å®Œæ•´è¯·æ±‚å¤„ç†æµç¨‹ï¼š

ç”¨æˆ·å‘èµ·è¯·æ±‚
        â†“
DispatcherServletæ¥æ”¶è¯·æ±‚
        â†“
HandlerMappingæŸ¥æ‰¾å¤„ç†å™¨
        â†“
æ‰§è¡Œæ‹¦æˆªå™¨preHandleæ–¹æ³•
        â†“
Controllerå¤„ç†ä¸šåŠ¡é€»è¾‘
        â†“
æ‰§è¡Œæ‹¦æˆªå™¨postHandleæ–¹æ³•  
        â†“
ViewResolverè§£æè§†å›¾
        â†“
æ¸²æŸ“è§†å›¾å¹¶è¿”å›å“åº”
        â†“
æ‰§è¡Œæ‹¦æˆªå™¨afterCompletionæ–¹æ³•
```

### 10.3 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆSpring MVCå¦‚æ­¤æµè¡Œ**
```
ä¼˜åŠ¿å¯¹æ¯”ï¼š
ä¼ ç»ŸServletå¼€å‘ï¼š
- æ¯ä¸ªåŠŸèƒ½éƒ½è¦å†™Servletç±»
- æ‰‹åŠ¨å¤„ç†è¯·æ±‚å‚æ•°
- æ‰‹åŠ¨è½¬å‘é¡µé¢
- ä»£ç é‡å¤å¤šï¼Œç»´æŠ¤å›°éš¾

Spring MVCå¼€å‘ï¼š
- æ³¨è§£é©±åŠ¨ï¼Œé…ç½®ç®€å•
- è‡ªåŠ¨å‚æ•°ç»‘å®šå’Œç±»å‹è½¬æ¢
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- ä¸°å¯Œçš„åŠŸèƒ½ç»„ä»¶
- ä¸Springæ¡†æ¶æ·±åº¦æ•´åˆ
```

**ğŸ”¹ æ ¸å¿ƒè®¾è®¡æ¨¡å¼**
```
å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼šDispatcherServletç»Ÿä¸€å¤„ç†è¯·æ±‚
MVCæ¨¡å¼ï¼šèŒè´£åˆ†ç¦»ï¼Œä»£ç ç»„ç»‡æ¸…æ™°
æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šHandlerInterceptorå®šä¹‰å¤„ç†æ¨¡æ¿
ç­–ç•¥æ¨¡å¼ï¼šHandlerMappingæ”¯æŒå¤šç§æ˜ å°„ç­–ç•¥
```

### 10.4 å®é™…å¼€å‘æŒ‡å¯¼


**é¡¹ç›®ç»“æ„å»ºè®®**ï¼š
```
src/main/java/
â”œâ”€â”€ controller/          # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ UserController.java
â”‚   â””â”€â”€ ProductController.java
â”œâ”€â”€ service/            # ä¸šåŠ¡æœåŠ¡å±‚  
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ ProductService.java
â”œâ”€â”€ dao/               # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ UserDao.java
â”‚   â””â”€â”€ ProductDao.java
â”œâ”€â”€ entity/            # å®ä½“ç±»
â”‚   â”œâ”€â”€ User.java
â”‚   â””â”€â”€ Product.java
â”œâ”€â”€ config/            # é…ç½®ç±»
â”‚   â”œâ”€â”€ WebConfig.java
â”‚   â””â”€â”€ InterceptorConfig.java
â””â”€â”€ exception/         # å¼‚å¸¸å¤„ç†
    â”œâ”€â”€ GlobalExceptionHandler.java
    â””â”€â”€ BusinessException.java
```

**å¼€å‘æœ€ä½³å®è·µ**ï¼š

ğŸ”¸ **Controllerè®¾è®¡**ï¼šä¿æŒç®€æ´ï¼Œåªè´Ÿè´£è¯·æ±‚å¤„ç†å’Œå“åº”
ğŸ”¸ **å¼‚å¸¸å¤„ç†**ï¼šä½¿ç”¨@ControllerAdviceå…¨å±€å¤„ç†å¼‚å¸¸
ğŸ”¸ **å‚æ•°éªŒè¯**ï¼šä½¿ç”¨@Validæ³¨è§£è¿›è¡Œæ•°æ®æ ¡éªŒ
ğŸ”¸ **RESTfulè®¾è®¡**ï¼šAPIè®¾è®¡éµå¾ªRESTfulè§„èŒƒ
ğŸ”¸ **æ‹¦æˆªå™¨ä½¿ç”¨**ï¼šåˆç†ä½¿ç”¨æ‹¦æˆªå™¨å¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹

### 10.5 å­¦ä¹ è¿›é˜¶è·¯çº¿


**åŸºç¡€æŒæ¡**ï¼š
- âœ… ç†è§£MVCæ¶æ„æ€æƒ³
- âœ… æŒæ¡Spring MVCåŸºæœ¬é…ç½®
- âœ… ç†Ÿæ‚‰Controllerç¼–å†™æ–¹å¼
- âœ… ç†è§£è¯·æ±‚å¤„ç†æµç¨‹

**è¿›é˜¶æå‡**ï¼š
- âœ… æ·±å…¥ç†è§£DispatcherServletåŸç†
- âœ… è‡ªå®šä¹‰HandlerMappingå’ŒViewResolver
- âœ… ç¼–å†™å¤æ‚æ‹¦æˆªå™¨
- âœ… æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜

**å®æˆ˜åº”ç”¨**ï¼š
- âœ… ç»“åˆSpring Bootå¿«é€Ÿå¼€å‘
- âœ… å‰åç«¯åˆ†ç¦»æ¶æ„è®¾è®¡
- âœ… å¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨
- âœ… é«˜å¹¶å‘åœºæ™¯ä¼˜åŒ–

**è®°å¿†è¦ç‚¹**ï¼š
- Spring MVCæ˜¯åŸºäºServletçš„Webæ¡†æ¶
- DispatcherServletæ˜¯æ•´ä¸ªæ¶æ„çš„æ ¸å¿ƒ
- æ³¨è§£é©±åŠ¨è®©å¼€å‘æ›´åŠ ç®€æ´
- ç»„ä»¶åŒ–è®¾è®¡æä¾›äº†æé«˜çš„æ‰©å±•æ€§
- ä¸Springæ¡†æ¶æ— ç¼æ•´åˆæ˜¯æœ€å¤§ä¼˜åŠ¿