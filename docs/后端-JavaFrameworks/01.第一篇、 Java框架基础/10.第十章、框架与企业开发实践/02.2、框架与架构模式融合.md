---
title: 2ã€æ¡†æ¶ä¸æ¶æ„æ¨¡å¼èåˆ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯æ¶æ„æ¨¡å¼](#1-ä»€ä¹ˆæ˜¯æ¶æ„æ¨¡å¼)
2. [ä¸‰å±‚æ¶æ„ï¼šæœ€ç»å…¸çš„åˆ†å±‚æ€æƒ³](#2-ä¸‰å±‚æ¶æ„æœ€ç»å…¸çš„åˆ†å±‚æ€æƒ³)
3. [åˆ†å±‚æ¶æ„ï¼šä¼ä¸šçº§åº”ç”¨çš„åŸºçŸ³](#3-åˆ†å±‚æ¶æ„ä¼ä¸šçº§åº”ç”¨çš„åŸºçŸ³)
4. [å…­è¾¹å½¢æ¶æ„ï¼šä¸šåŠ¡ä¸æŠ€æœ¯çš„å®Œç¾åˆ†ç¦»](#4-å…­è¾¹å½¢æ¶æ„ä¸šåŠ¡ä¸æŠ€æœ¯çš„å®Œç¾åˆ†ç¦»)
5. [å¾®æœåŠ¡æ¶æ„ï¼šç°ä»£åº”ç”¨çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ](#5-å¾®æœåŠ¡æ¶æ„ç°ä»£åº”ç”¨çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ)
6. [äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šè§£è€¦ç³»ç»Ÿçš„åˆ©å™¨](#6-äº‹ä»¶é©±åŠ¨æ¶æ„è§£è€¦ç³»ç»Ÿçš„åˆ©å™¨)
7. [CQRSæ¨¡å¼ï¼šè¯»å†™åˆ†ç¦»çš„é«˜çº§å®è·µ](#7-cqrsæ¨¡å¼è¯»å†™åˆ†ç¦»çš„é«˜çº§å®è·µ)
8. [DDDé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šä¸šåŠ¡å»ºæ¨¡çš„è‰ºæœ¯](#8-dddé¢†åŸŸé©±åŠ¨è®¾è®¡ä¸šåŠ¡å»ºæ¨¡çš„è‰ºæœ¯)
9. [æ¸…æ´æ¶æ„ï¼šä¾èµ–åè½¬çš„ç»ˆæå®è·µ](#9-æ¸…æ´æ¶æ„ä¾èµ–åè½¬çš„ç»ˆæå®è·µ)
10. [æ¶æ„æ¨¡å¼é€‰æ‹©ä¸å®è·µæŒ‡å—](#10-æ¶æ„æ¨¡å¼é€‰æ‹©ä¸å®è·µæŒ‡å—)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ ä»€ä¹ˆæ˜¯æ¶æ„æ¨¡å¼


### 1.1 æ¶æ„æ¨¡å¼çš„æœ¬è´¨


**ç®€å•ç†è§£ï¼šæ¶æ„æ¨¡å¼å°±æ˜¯ç›–æˆ¿å­çš„å›¾çº¸**

å°±åƒç›–æˆ¿å­éœ€è¦å»ºç­‘å›¾çº¸ä¸€æ ·ï¼Œå¼€å‘è½¯ä»¶ä¹Ÿéœ€è¦"å›¾çº¸"æ¥æŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•ç»„ç»‡ä»£ç ã€‚è¿™ä¸ª"å›¾çº¸"å°±æ˜¯æ¶æ„æ¨¡å¼ã€‚

```
ç›–æˆ¿å­çš„è¿‡ç¨‹              å¼€å‘è½¯ä»¶çš„è¿‡ç¨‹
     â†“                       â†“
   è®¾è®¡å›¾çº¸    â†â†’         æ¶æ„æ¨¡å¼
     â†“                       â†“
   åˆ†å±‚å»ºé€     â†â†’         åˆ†å±‚å¼€å‘
     â†“                       â†“
   æˆ¿å±‹ç»“æ„    â†â†’         ç³»ç»Ÿç»“æ„
```

**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> æ¶æ„æ¨¡å¼è§£å†³çš„ä¸æ˜¯"å†™ä»€ä¹ˆä»£ç "ï¼Œè€Œæ˜¯"ä»£ç æ€ä¹ˆç»„ç»‡"çš„é—®é¢˜

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ¶æ„æ¨¡å¼


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å»ºç­‘å›¾çº¸ï¼š
> - å·¥äººä¸çŸ¥é“è¯¥å…ˆå»ºä»€ä¹ˆåå»ºä»€ä¹ˆ
> - ç”µå·¥ä¸çŸ¥é“æ°´ç®¡åœ¨å“ªé‡Œï¼Œå¯èƒ½æ‰“ç©¿æ°´ç®¡
> - è£…ä¿®æ—¶å‘ç°æ‰¿é‡å¢™ä½ç½®ä¸å¯¹
> 
> è½¯ä»¶å¼€å‘ä¹Ÿæ˜¯ä¸€æ ·ï¼š
> - ç¨‹åºå‘˜ä¸çŸ¥é“ä»£ç æ”¾å“ªé‡Œ
> - æ•°æ®åº“æ“ä½œä»£ç åˆ°å¤„éƒ½æ˜¯
> - ä¿®æ”¹ä¸€ä¸ªåŠŸèƒ½å½±å“å…¶ä»–åŠŸèƒ½

**æ¶æ„æ¨¡å¼è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š**

| é—®é¢˜ | ä¼ ç»Ÿå¼€å‘ | ä½¿ç”¨æ¶æ„æ¨¡å¼ |
|------|----------|-------------|
| **ä»£ç æ··ä¹±** | ğŸ”´ ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“ã€ç•Œé¢æ··åœ¨ä¸€èµ· | ğŸŸ¢ å„å¸å…¶èŒï¼Œåˆ†å±‚æ¸…æ™° |
| **éš¾ä»¥ç»´æŠ¤** | ğŸ”´ æ”¹ä¸€ä¸ªåœ°æ–¹å½±å“å¤šä¸ªåŠŸèƒ½ | ğŸŸ¢ ä¿®æ”¹å½±å“èŒƒå›´å¯æ§ |
| **å›¢é˜Ÿåä½œ** | ğŸ”´ å¤šäººåŒæ—¶æ”¹ä¸€ä¸ªæ–‡ä»¶å†²çª | ğŸŸ¢ æŒ‰å±‚åˆ†å·¥ï¼Œå‡å°‘å†²çª |
| **ä»£ç å¤ç”¨** | ğŸ”´ ç›¸ä¼¼åŠŸèƒ½é‡å¤ç¼–å†™ | ğŸŸ¢ é€šç”¨ç»„ä»¶å¯ä»¥å¤ç”¨ |

---

## 2. ğŸ¢ ä¸‰å±‚æ¶æ„ï¼šæœ€ç»å…¸çš„åˆ†å±‚æ€æƒ³


### 2.1 ä¸‰å±‚æ¶æ„æ˜¯ä»€ä¹ˆ


**ç®€å•ç†è§£ï¼šæŠŠè½¯ä»¶åˆ†æˆä¸‰ä¸ª"æ¥¼å±‚"**

å°±åƒåŠå…¬æ¥¼æœ‰ä¸åŒæ¥¼å±‚ä¸€æ ·ï¼Œä¸‰å±‚æ¶æ„æŠŠè½¯ä»¶åˆ†æˆä¸‰ä¸ªå±‚æ¬¡ï¼Œæ¯å±‚åšä¸åŒçš„äº‹æƒ…ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    è¡¨ç°å±‚ (Presentation)  â”‚ â† ç¬¬3å±‚ï¼šç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ä¸šåŠ¡å±‚ (Business)      â”‚ â† ç¬¬2å±‚ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ•°æ®å±‚ (Data)         â”‚ â† ç¬¬1å±‚ï¼šå­˜å‚¨å’Œè·å–æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸‰å±‚æ¶æ„è¯¦ç»†è®²è§£


**ğŸ”¸ æ•°æ®è®¿é—®å±‚ (Data Access Layer - DAL)**

**ä½œç”¨ï¼š** ä¸“é—¨è´Ÿè´£ä¸æ•°æ®åº“"å¯¹è¯"

```java
// æ•°æ®è®¿é—®å±‚ç¤ºä¾‹ - åªç®¡æ•°æ®åº“æ“ä½œ
@Repository
public class UserDao {
    // ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“
    public void saveUser(User user) {
        // SQL: INSERT INTO users...
    }
    
    // ä»æ•°æ®åº“è·å–ç”¨æˆ·
    public User findById(Long id) {
        // SQL: SELECT * FROM users WHERE id = ?
    }
}
```

**ğŸ”¸ ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer - BLL)**

**ä½œç”¨ï¼š** å¤„ç†ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘

```java
// ä¸šåŠ¡é€»è¾‘å±‚ç¤ºä¾‹ - å¤„ç†ä¸šåŠ¡è§„åˆ™
@Service
public class UserService {
    @Autowired
    private UserDao userDao;
    
    // æ³¨å†Œç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘
    public void registerUser(User user) {
        // ä¸šåŠ¡è§„åˆ™1ï¼šæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤
        if (userDao.findByUsername(user.getUsername()) != null) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        // ä¸šåŠ¡è§„åˆ™2ï¼šå¯†ç é•¿åº¦æ£€æŸ¥
        if (user.getPassword().length() < 6) {
            throw new BusinessException("å¯†ç è‡³å°‘6ä½");
        }
        
        // ä¸šåŠ¡è§„åˆ™3ï¼šè®¾ç½®æ³¨å†Œæ—¶é—´
        user.setCreateTime(new Date());
        
        // è°ƒç”¨æ•°æ®å±‚ä¿å­˜
        userDao.saveUser(user);
    }
}
```

**ğŸ”¸ è¡¨ç°å±‚ (Presentation Layer - PL)**

**ä½œç”¨ï¼š** ä¸ç”¨æˆ·äº¤äº’ï¼Œæ˜¾ç¤ºä¿¡æ¯

```java
// è¡¨ç°å±‚ç¤ºä¾‹ - å¤„ç†ç”¨æˆ·è¯·æ±‚
@Controller
public class UserController {
    @Autowired
    private UserService userService;
    
    // å¤„ç†æ³¨å†Œè¯·æ±‚
    @PostMapping("/register")
    public String register(User user) {
        try {
            userService.registerUser(user);
            return "æ³¨å†ŒæˆåŠŸ";
        } catch (BusinessException e) {
            return "æ³¨å†Œå¤±è´¥ï¼š" + e.getMessage();
        }
    }
}
```

### 2.3 ä¸‰å±‚æ¶æ„çš„å·¥ä½œæµç¨‹


**ğŸ“ˆ ç”¨æˆ·æ³¨å†Œæµç¨‹ç¤ºä¾‹**

```
ç”¨æˆ·å¡«å†™æ³¨å†Œè¡¨å• â†’ æäº¤
         â†“
    è¡¨ç°å±‚æ¥æ”¶è¯·æ±‚
         â†“
  è°ƒç”¨ä¸šåŠ¡å±‚å¤„ç†æ³¨å†Œé€»è¾‘
         â†“
    ä¸šåŠ¡å±‚éªŒè¯æ•°æ®
         â†“
   è°ƒç”¨æ•°æ®å±‚ä¿å­˜åˆ°æ•°æ®åº“
         â†“
    è¿”å›å¤„ç†ç»“æœç»™ç”¨æˆ·
```

**ğŸ¯ ä¸€åˆ†é’ŸæŒæ¡**
ä¸‰å±‚æ¶æ„çš„æ ¸å¿ƒæ€æƒ³ï¼š
1. **åˆ†å·¥æ˜ç¡®**ï¼šæ¯å±‚åªåšè‡ªå·±è¯¥åšçš„äº‹
2. **å•å‘ä¾èµ–**ï¼šä¸Šå±‚å¯ä»¥è°ƒç”¨ä¸‹å±‚ï¼Œä¸‹å±‚ä¸èƒ½è°ƒç”¨ä¸Šå±‚
3. **èŒè´£å•ä¸€**ï¼šæ•°æ®å±‚ç®¡æ•°æ®ï¼Œä¸šåŠ¡å±‚ç®¡é€»è¾‘ï¼Œè¡¨ç°å±‚ç®¡äº¤äº’

---

## 3. ğŸ“š åˆ†å±‚æ¶æ„ï¼šä¼ä¸šçº§åº”ç”¨çš„åŸºçŸ³


### 3.1 åˆ†å±‚æ¶æ„ vs ä¸‰å±‚æ¶æ„


**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> ä¸‰å±‚æ¶æ„æ˜¯åˆ†å±‚æ¶æ„çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚åˆ†å±‚æ¶æ„å¯ä»¥æœ‰æ›´å¤šå±‚ï¼Œæ¯”å¦‚4å±‚ã€5å±‚ç”šè‡³æ›´å¤šã€‚

**å…¸å‹çš„ä¼ä¸šçº§åˆ†å±‚æ¶æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç”¨æˆ·ç•Œé¢å±‚ (UI)      â”‚ â† Webé¡µé¢ã€ç§»åŠ¨Appç•Œé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨æœåŠ¡å±‚ (App)      â”‚ â† åè°ƒå„ç§æœåŠ¡ï¼Œå¤„ç†ç”¨æˆ·æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   é¢†åŸŸæœåŠ¡å±‚ (Domain)   â”‚ â† æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€è®¾æ–½å±‚ (Infrastructure) â”‚ â† æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Springæ¡†æ¶ä¸­çš„åˆ†å±‚å®è·µ


**ğŸ”§ Spring Bootä¸­çš„å…¸å‹åˆ†å±‚**

```java
// Controllerå±‚ - å¤„ç†HTTPè¯·æ±‚
@RestController
@RequestMapping("/api/orders")
public class OrderController {
    @Autowired
    private OrderService orderService;
    
    @PostMapping
    public ResponseEntity<Order> createOrder(@RequestBody OrderRequest request) {
        Order order = orderService.createOrder(request);
        return ResponseEntity.ok(order);
    }
}

// Serviceå±‚ - ä¸šåŠ¡é€»è¾‘
@Service
@Transactional
public class OrderService {
    @Autowired
    private OrderRepository orderRepository;
    @Autowired
    private PaymentService paymentService;
    
    public Order createOrder(OrderRequest request) {
        // 1. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setAmount(request.getAmount());
        
        // 2. ä¿å­˜è®¢å•
        order = orderRepository.save(order);
        
        // 3. å¤„ç†æ”¯ä»˜
        paymentService.processPayment(order);
        
        return order;
    }
}

// Repositoryå±‚ - æ•°æ®è®¿é—®
@Repository
public interface OrderRepository extends JpaRepository<Order, Long> {
    List<Order> findByUserId(Long userId);
    
    @Query("SELECT o FROM Order o WHERE o.status = :status")
    List<Order> findByStatus(@Param("status") OrderStatus status);
}
```

### 3.3 åˆ†å±‚æ¶æ„çš„ä¼˜åŠ¿


**ğŸ“Š å¯¹æ¯”åˆ†æ**

| ç‰¹æ€§ | æ²¡æœ‰åˆ†å±‚ | æœ‰åˆ†å±‚æ¶æ„ |
|------|---------|-----------|
| **ä»£ç ç»„ç»‡** | ğŸ”´ æ‰€æœ‰ä»£ç æ··åœ¨ä¸€èµ· | ğŸŸ¢ æŒ‰èŒè´£æ¸…æ™°åˆ†å±‚ |
| **æµ‹è¯•éš¾åº¦** | ğŸ”´ éš¾ä»¥å•ç‹¬æµ‹è¯•æŸä¸ªåŠŸèƒ½ | ğŸŸ¢ å¯ä»¥åˆ†å±‚å•ç‹¬æµ‹è¯• |
| **å›¢é˜Ÿå¼€å‘** | ğŸ”´ å®¹æ˜“äº§ç”Ÿä»£ç å†²çª | ğŸŸ¢ ä¸åŒå±‚å¯ä»¥å¹¶è¡Œå¼€å‘ |
| **ç»´æŠ¤æˆæœ¬** | ğŸ”´ ä¿®æ”¹ä¸€å¤„å½±å“å¤šå¤„ | ğŸŸ¢ å½±å“èŒƒå›´å¯æ§ |
| **æŠ€æœ¯æ›¿æ¢** | ğŸ”´ æ›¿æ¢æ•°æ®åº“éœ€è¦å¤§æ”¹ | ğŸŸ¢ åªéœ€ä¿®æ”¹å¯¹åº”å±‚ |

---

## 4. ğŸ”· å…­è¾¹å½¢æ¶æ„ï¼šä¸šåŠ¡ä¸æŠ€æœ¯çš„å®Œç¾åˆ†ç¦»


### 4.1 ä¸ºä»€ä¹ˆå«"å…­è¾¹å½¢"


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸ªæˆ¿å­ï¼Œæˆ¿å­å†…éƒ¨æ˜¯æ ¸å¿ƒçš„å±…ä½ç©ºé—´ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ï¼Œ
> æˆ¿å­æœ‰å¾ˆå¤šä¸ªé—¨å’Œçª—ï¼ˆç«¯å£ï¼‰ï¼Œå¤–é¢å¯èƒ½è¿æ¥ï¼š
> - å‰é—¨ï¼šå®¢äººè¿›å‡ºï¼ˆç”¨æˆ·ç•Œé¢ï¼‰
> - åé—¨ï¼šå¿«é€’å‘˜é€è´§ï¼ˆå¤–éƒ¨APIï¼‰
> - çª—æˆ·ï¼šè§‚å¯Ÿå¤–é¢ï¼ˆç›‘æ§ç³»ç»Ÿï¼‰
> - åœ°ä¸‹å®¤é—¨ï¼šç»´ä¿®å·¥è¿›å‡ºï¼ˆç®¡ç†å·¥å…·ï¼‰

å…­è¾¹å½¢æ¶æ„ä¸­çš„"å…­è¾¹å½¢"ä»£è¡¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè¾¹ä¸Šçš„"è¾¹"ä»£è¡¨å„ç§å¤–éƒ¨æ¥å£ã€‚

```
        ç”¨æˆ·ç•Œé¢
           â†‘
    æ•°æ®åº“ â† ğŸ”· â†’ å¤–éƒ¨API
           â†“
        ç›‘æ§ç³»ç»Ÿ
```

### 4.2 å…­è¾¹å½¢æ¶æ„çš„æ ¸å¿ƒæ€æƒ³


**ğŸ¯ æ ¸å¿ƒç†å¿µï¼šä¸šåŠ¡é€»è¾‘ç‹¬ç«‹äºå¤–éƒ¨ä¸–ç•Œ**

```java
// ä¼ ç»Ÿåšæ³•ï¼šä¸šåŠ¡é€»è¾‘ç›´æ¥ä¾èµ–æŠ€æœ¯å®ç°
@Service
public class OrderService {
    // âŒ ç›´æ¥ä¾èµ–MySQLæ•°æ®åº“
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    // âŒ ç›´æ¥ä¾èµ–Redisç¼“å­˜
    @Autowired
    private RedisTemplate redisTemplate;
    
    public void createOrder(Order order) {
        // ä¸šåŠ¡é€»è¾‘ä¸æŠ€æœ¯ç»†èŠ‚æ··åˆ
        jdbcTemplate.update("INSERT INTO orders...", order);
        redisTemplate.opsForValue().set("order:" + order.getId(), order);
    }
}

// å…­è¾¹å½¢æ¶æ„åšæ³•ï¼šä¸šåŠ¡é€»è¾‘åªä¾èµ–æ¥å£
@Service
public class OrderService {
    // âœ… åªä¾èµ–æŠ½è±¡æ¥å£
    private final OrderRepository orderRepository;
    private final CacheService cacheService;
    
    public OrderService(OrderRepository orderRepository, CacheService cacheService) {
        this.orderRepository = orderRepository;
        this.cacheService = cacheService;
    }
    
    public void createOrder(Order order) {
        // çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸å…³å¿ƒæŠ€æœ¯å®ç°
        orderRepository.save(order);
        cacheService.put("order:" + order.getId(), order);
    }
}

// æŠ€æœ¯å®ç°åœ¨å¤–å±‚
@Repository
public class MySQLOrderRepository implements OrderRepository {
    // MySQLå…·ä½“å®ç°
}

@Service
public class RedisCacheService implements CacheService {
    // Rediså…·ä½“å®ç°
}
```

### 4.3 å…­è¾¹å½¢æ¶æ„çš„å®è·µ


**ğŸ”§ Spring Bootä¸­çš„å…­è¾¹å½¢æ¶æ„å®ç°**

**1. å®šä¹‰ç«¯å£ï¼ˆæ¥å£ï¼‰**
```java
// åº”ç”¨æœåŠ¡ç«¯å£
public interface OrderApplicationService {
    Order createOrder(CreateOrderCommand command);
    Order findOrder(Long orderId);
}

// æ•°æ®å­˜å‚¨ç«¯å£
public interface OrderRepository {
    Order save(Order order);
    Optional<Order> findById(Long id);
}

// é€šçŸ¥ç«¯å£
public interface NotificationService {
    void sendOrderConfirmation(Order order);
}
```

**2. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå…­è¾¹å½¢å†…éƒ¨ï¼‰**
```java
@Component
public class OrderApplicationServiceImpl implements OrderApplicationService {
    private final OrderRepository orderRepository;
    private final NotificationService notificationService;
    
    // æ„é€ å™¨æ³¨å…¥ï¼Œä¾èµ–æ¥å£è€Œä¸æ˜¯å…·ä½“å®ç°
    public OrderApplicationServiceImpl(OrderRepository orderRepository, 
                                     NotificationService notificationService) {
        this.orderRepository = orderRepository;
        this.notificationService = notificationService;
    }
    
    @Override
    @Transactional
    public Order createOrder(CreateOrderCommand command) {
        // çº¯ä¸šåŠ¡é€»è¾‘
        Order order = Order.builder()
            .userId(command.getUserId())
            .productId(command.getProductId())
            .quantity(command.getQuantity())
            .status(OrderStatus.CREATED)
            .build();
            
        order = orderRepository.save(order);
        notificationService.sendOrderConfirmation(order);
        
        return order;
    }
}
```

**3. å¤–éƒ¨é€‚é…å™¨ï¼ˆå…­è¾¹å½¢è¾¹ç¼˜ï¼‰**
```java
// HTTPé€‚é…å™¨
@RestController
@RequestMapping("/api/orders")
public class OrderRestController {
    private final OrderApplicationService orderService;
    
    @PostMapping
    public ResponseEntity<OrderDTO> createOrder(@RequestBody CreateOrderRequest request) {
        CreateOrderCommand command = CreateOrderCommand.builder()
            .userId(request.getUserId())
            .productId(request.getProductId())
            .quantity(request.getQuantity())
            .build();
            
        Order order = orderService.createOrder(command);
        return ResponseEntity.ok(OrderDTO.from(order));
    }
}

// æ•°æ®åº“é€‚é…å™¨
@Repository
public class JpaOrderRepository implements OrderRepository {
    private final OrderJpaRepository jpaRepository;
    
    @Override
    public Order save(Order order) {
        OrderEntity entity = OrderEntity.from(order);
        entity = jpaRepository.save(entity);
        return entity.toDomain();
    }
}

// é€šçŸ¥é€‚é…å™¨
@Component
public class EmailNotificationService implements NotificationService {
    @Override
    public void sendOrderConfirmation(Order order) {
        // å‘é€é‚®ä»¶é€»è¾‘
        emailService.send(order.getUserEmail(), "è®¢å•ç¡®è®¤", "æ‚¨çš„è®¢å•å·²åˆ›å»º");
    }
}
```

**ğŸ’ª å®è·µæŒ‘æˆ˜**
å°è¯•æ€è€ƒï¼šå¦‚æœè¦æŠŠMySQLæ¢æˆMongoDBï¼Œéœ€è¦æ”¹åŠ¨å“ªäº›ä»£ç ï¼Ÿ
- ä¼ ç»Ÿæ¶æ„ï¼šéœ€è¦ä¿®æ”¹Serviceå±‚çš„SQLè¯­å¥
- å…­è¾¹å½¢æ¶æ„ï¼šåªéœ€è¦æä¾›æ–°çš„MongoDBé€‚é…å™¨å®ç°

---

## 5. â˜ï¸ å¾®æœåŠ¡æ¶æ„ï¼šç°ä»£åº”ç”¨çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ


### 5.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> ä¼ ç»Ÿå•ä½“åº”ç”¨åƒä¸€ä¸ªå¤§å•†åœºï¼š
> - æ‰€æœ‰å•†åº—éƒ½åœ¨ä¸€ä¸ªå»ºç­‘é‡Œ
> - ä¸€å®¶åº—å‡ºé—®é¢˜ï¼Œæ•´ä¸ªå•†åœºå¯èƒ½å—å½±å“
> - è£…ä¿®ä¸€å®¶åº—ï¼Œæ•´ä¸ªå•†åœºéƒ½è¦åœä¸š
> 
> å¾®æœåŠ¡åƒå•†ä¸šè¡—ï¼š
> - æ¯ä¸ªåº—éƒ½æ˜¯ç‹¬ç«‹çš„å»ºç­‘
> - ä¸€å®¶åº—å‡ºé—®é¢˜ä¸å½±å“å…¶ä»–åº—
> - å¯ä»¥å•ç‹¬è£…ä¿®æŸå®¶åº—

### 5.2 å¾®æœåŠ¡æ¶æ„çš„ç‰¹ç‚¹


**ğŸ“Š å•ä½“åº”ç”¨ vs å¾®æœåŠ¡å¯¹æ¯”**

| ç‰¹æ€§ | å•ä½“åº”ç”¨ | å¾®æœåŠ¡ |
|------|---------|--------|
| **éƒ¨ç½²** | ğŸ”´ æ•´ä½“éƒ¨ç½²ï¼Œä¸€ä¸ªwaråŒ… | ğŸŸ¢ ç‹¬ç«‹éƒ¨ç½²ï¼Œå¤šä¸ªæœåŠ¡ |
| **å¼€å‘** | ğŸ”´ æ‰€æœ‰åŠŸèƒ½åœ¨ä¸€ä¸ªé¡¹ç›® | ğŸŸ¢ æŒ‰ä¸šåŠ¡æ‹†åˆ†å¤šä¸ªé¡¹ç›® |
| **æ‰©å±•** | ğŸ”´ æ•´ä½“æ‰©å±•ï¼Œèµ„æºæµªè´¹ | ğŸŸ¢ æŒ‰éœ€æ‰©å±•ç‰¹å®šæœåŠ¡ |
| **å®¹é”™** | ğŸ”´ ä¸€å¤„æ•…éšœå½±å“å…¨å±€ | ğŸŸ¢ æ•…éšœéš”ç¦»ï¼Œä¸äº’ç›¸å½±å“ |
| **æŠ€æœ¯æ ˆ** | ğŸ”´ ç»Ÿä¸€æŠ€æœ¯æ ˆ | ğŸŸ¢ æ¯ä¸ªæœåŠ¡å¯é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯ |

### 5.3 Spring Cloudå¾®æœåŠ¡å®è·µ


**ğŸ”§ è®¢å•ç³»ç»Ÿçš„å¾®æœåŠ¡æ‹†åˆ†**

```
                    APIç½‘å…³ (Spring Cloud Gateway)
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“             â†“             â†“             â†“             â†“
ç”¨æˆ·æœåŠ¡      è®¢å•æœåŠ¡      å•†å“æœåŠ¡      æ”¯ä»˜æœåŠ¡      é€šçŸ¥æœåŠ¡
(User)      (Order)     (Product)   (Payment)  (Notification)
    â†“             â†“             â†“             â†“             â†“
ç”¨æˆ·æ•°æ®åº“    è®¢å•æ•°æ®åº“    å•†å“æ•°æ®åº“    æ”¯ä»˜æ•°æ®åº“    æ¶ˆæ¯é˜Ÿåˆ—
```

**æœåŠ¡æ³¨å†Œä¸å‘ç°**
```java
// ç”¨æˆ·æœåŠ¡ - æœåŠ¡æä¾›è€…
@SpringBootApplication
@EnableEurekaClient
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}

@RestController
@RequestMapping("/users")
public class UserController {
    
    @GetMapping("/{id}")
    public User getUserById(@PathVariable Long id) {
        return userService.findById(id);
    }
}
```

**æœåŠ¡é—´è°ƒç”¨**
```java
// è®¢å•æœåŠ¡ - æœåŠ¡æ¶ˆè´¹è€…
@Service
public class OrderService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    public Order createOrder(CreateOrderRequest request) {
        // è°ƒç”¨ç”¨æˆ·æœåŠ¡éªŒè¯ç”¨æˆ·
        User user = restTemplate.getForObject(
            "http://user-service/users/" + request.getUserId(), 
            User.class
        );
        
        if (user == null) {
            throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        }
        
        // è°ƒç”¨å•†å“æœåŠ¡æ£€æŸ¥åº“å­˜
        Product product = restTemplate.getForObject(
            "http://product-service/products/" + request.getProductId(), 
            Product.class
        );
        
        if (product.getStock() < request.getQuantity()) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        
        return orderRepository.save(order);
    }
}
```

### 5.4 å¾®æœåŠ¡çš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ


**âš ï¸ å¸¸è§è¯¯åŒº**
âŒ **é”™è¯¯ç†è§£**ï¼šå¾®æœåŠ¡å°±æ˜¯æŠŠä»£ç æ‹†æˆå¤šä¸ªé¡¹ç›®  
âœ… **æ­£ç¡®ç†è§£**ï¼šå¾®æœåŠ¡æ˜¯æŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†ï¼Œæ¯ä¸ªæœåŠ¡æœ‰ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨

**ğŸ”§ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | Spring Cloudç»„ä»¶ |
|------|----------|------------------|
| **æœåŠ¡å‘ç°** | æœåŠ¡æ³¨å†Œä¸­å¿ƒ | Eureka, Consul |
| **é…ç½®ç®¡ç†** | ç»Ÿä¸€é…ç½®ä¸­å¿ƒ | Config Server |
| **è´Ÿè½½å‡è¡¡** | å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ | Ribbon, LoadBalancer |
| **å®¹é”™å¤„ç†** | ç†”æ–­å™¨æ¨¡å¼ | Hystrix, Resilience4j |
| **é“¾è·¯è¿½è¸ª** | åˆ†å¸ƒå¼è¿½è¸ª | Sleuth, Zipkin |
| **APIç½‘å…³** | ç»Ÿä¸€å…¥å£ | Gateway, Zuul |

---

## 6. âš¡ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šè§£è€¦ç³»ç»Ÿçš„åˆ©å™¨


### 6.1 ä»€ä¹ˆæ˜¯äº‹ä»¶é©±åŠ¨


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸ªæ™ºèƒ½å®¶å±…ç³»ç»Ÿï¼š
> - æœ‰äººæŒ‰é—¨é“ƒï¼ˆäº‹ä»¶ï¼‰
> - é—¨é“ƒå“äº†ï¼ˆå‘å¸ƒäº‹ä»¶ï¼‰
> - ç›‘æ§æ‘„åƒå¤´è‡ªåŠ¨å½•åƒï¼ˆç›‘å¬è€…1ï¼‰
> - æ‰‹æœºAPPå‘é€é€šçŸ¥ï¼ˆç›‘å¬è€…2ï¼‰
> - ç¯å…‰è‡ªåŠ¨æ‰“å¼€ï¼ˆç›‘å¬è€…3ï¼‰
> 
> æŒ‰é—¨é“ƒçš„äººä¸éœ€è¦çŸ¥é“æœ‰å“ªäº›è®¾å¤‡ä¼šå“åº”ï¼Œæ¯ä¸ªè®¾å¤‡ä¹Ÿç‹¬ç«‹å·¥ä½œ

### 6.2 ä¼ ç»Ÿè°ƒç”¨ vs äº‹ä»¶é©±åŠ¨


**ä¼ ç»ŸåŒæ­¥è°ƒç”¨æ–¹å¼ï¼š**
```java
@Service
public class OrderService {
    @Autowired
    private PaymentService paymentService;
    @Autowired
    private InventoryService inventoryService;
    @Autowired
    private EmailService emailService;
    @Autowired
    private SmsService smsService;
    
    public void createOrder(Order order) {
        // 1. ä¿å­˜è®¢å•
        orderRepository.save(order);
        
        // 2. å¤„ç†æ”¯ä»˜ - å¦‚æœæ”¯ä»˜æœåŠ¡æŒ‚äº†ï¼Œæ•´ä¸ªæµç¨‹å°±æ–­äº†
        paymentService.processPayment(order);
        
        // 3. æ›´æ–°åº“å­˜ - å¦‚æœåº“å­˜æœåŠ¡æ…¢ï¼Œç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿
        inventoryService.decreaseStock(order.getProductId(), order.getQuantity());
        
        // 4. å‘é€é‚®ä»¶ - å¦‚æœé‚®ä»¶æœåŠ¡å‡ºé—®é¢˜ï¼Œè®¢å•åˆ›å»ºå¤±è´¥
        emailService.sendOrderConfirmation(order);
        
        // 5. å‘é€çŸ­ä¿¡ - æ­¥éª¤è¶Šå¤šï¼Œå¤±è´¥æ¦‚ç‡è¶Šå¤§
        smsService.sendOrderNotification(order);
    }
}
```

**é—®é¢˜åˆ†æï¼š**
- ğŸ”´ **å¼ºè€¦åˆ**ï¼šOrderServiceéœ€è¦çŸ¥é“æ‰€æœ‰ç›¸å…³æœåŠ¡
- ğŸ”´ **åŒæ­¥ç­‰å¾…**ï¼šå¿…é¡»ç­‰å¾…æ‰€æœ‰æ­¥éª¤å®Œæˆ
- ğŸ”´ **å•ç‚¹æ•…éšœ**ï¼šä»»ä½•ä¸€ä¸ªæœåŠ¡å‡ºé—®é¢˜ï¼Œæ•´ä¸ªæµç¨‹å¤±è´¥
- ğŸ”´ **æ‰©å±•å›°éš¾**ï¼šæ–°å¢åŠŸèƒ½éœ€è¦ä¿®æ”¹OrderService

**äº‹ä»¶é©±åŠ¨æ–¹å¼ï¼š**
```java
@Service
public class OrderService {
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void createOrder(Order order) {
        // 1. ä¿å­˜è®¢å•
        orderRepository.save(order);
        
        // 2. å‘å¸ƒäº‹ä»¶ï¼Œä¸å…³å¿ƒè°æ¥å¤„ç†
        eventPublisher.publishEvent(new OrderCreatedEvent(order));
    }
}

// äº‹ä»¶å®šä¹‰
public class OrderCreatedEvent {
    private final Order order;
    private final LocalDateTime occurredOn;
    
    public OrderCreatedEvent(Order order) {
        this.order = order;
        this.occurredOn = LocalDateTime.now();
    }
}

// å„ä¸ªæœåŠ¡ç‹¬ç«‹ç›‘å¬äº‹ä»¶
@Component
public class PaymentEventHandler {
    @EventListener
    @Async
    public void handleOrderCreated(OrderCreatedEvent event) {
        paymentService.processPayment(event.getOrder());
    }
}

@Component
public class InventoryEventHandler {
    @EventListener
    @Async
    public void handleOrderCreated(OrderCreatedEvent event) {
        inventoryService.decreaseStock(
            event.getOrder().getProductId(), 
            event.getOrder().getQuantity()
        );
    }
}

@Component
public class NotificationEventHandler {
    @EventListener
    @Async
    public void handleOrderCreated(OrderCreatedEvent event) {
        emailService.sendOrderConfirmation(event.getOrder());
        smsService.sendOrderNotification(event.getOrder());
    }
}
```

### 6.3 äº‹ä»¶é©±åŠ¨çš„ä¼˜åŠ¿


**ğŸ“ˆ æ”¹è¿›æ•ˆæœå¯¹æ¯”**

| ç‰¹æ€§ | ä¼ ç»Ÿè°ƒç”¨ | äº‹ä»¶é©±åŠ¨ |
|------|---------|----------|
| **å“åº”é€Ÿåº¦** | ğŸ”´ ç­‰å¾…æ‰€æœ‰æ“ä½œå®Œæˆ | ğŸŸ¢ è®¢å•åˆ›å»ºåç«‹å³è¿”å› |
| **ç³»ç»Ÿè€¦åˆ** | ğŸ”´ å¼ºè€¦åˆï¼Œäº’ç›¸ä¾èµ– | ğŸŸ¢ æ¾è€¦åˆï¼Œç‹¬ç«‹å¼€å‘ |
| **æ•…éšœå½±å“** | ğŸ”´ ä¸€ä¸ªæœåŠ¡æ•…éšœå½±å“å…¨æµç¨‹ | ğŸŸ¢ æœåŠ¡æ•…éšœä¸å½±å“ä¸»æµç¨‹ |
| **æ‰©å±•æ€§** | ğŸ”´ æ–°å¢åŠŸèƒ½éœ€ä¿®æ”¹ä¸»æœåŠ¡ | ğŸŸ¢ æ–°å¢ç›‘å¬å™¨å³å¯ |

### 6.4 Spring Bootäº‹ä»¶é©±åŠ¨å®è·µ


**ğŸ”§ å®Œæ•´çš„äº‹ä»¶é©±åŠ¨ç¤ºä¾‹**

```java
// 1. å®šä¹‰é¢†åŸŸäº‹ä»¶
@Getter
public class OrderCreatedEvent {
    private final Long orderId;
    private final Long userId;
    private final BigDecimal amount;
    private final LocalDateTime createdAt;
    
    public OrderCreatedEvent(Long orderId, Long userId, BigDecimal amount) {
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
        this.createdAt = LocalDateTime.now();
    }
}

// 2. äº‹ä»¶å‘å¸ƒè€…
@Service
@Transactional
public class OrderService {
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public Order createOrder(CreateOrderRequest request) {
        // åˆ›å»ºå¹¶ä¿å­˜è®¢å•
        Order order = Order.builder()
            .userId(request.getUserId())
            .productId(request.getProductId())
            .quantity(request.getQuantity())
            .amount(calculateAmount(request))
            .status(OrderStatus.CREATED)
            .build();
            
        order = orderRepository.save(order);
        
        // å‘å¸ƒäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent(
            order.getId(), 
            order.getUserId(), 
            order.getAmount()
        );
        eventPublisher.publishEvent(event);
        
        return order;
    }
}

// 3. äº‹ä»¶ç›‘å¬å™¨ - å¤„ç†æ”¯ä»˜
@Component
@Slf4j
public class PaymentEventHandler {
    @Autowired
    private PaymentService paymentService;
    
    @EventListener
    @Async("taskExecutor")
    public void handleOrderCreated(OrderCreatedEvent event) {
        try {
            log.info("å¼€å§‹å¤„ç†è®¢å•æ”¯ä»˜: {}", event.getOrderId());
            paymentService.createPayment(event.getOrderId(), event.getAmount());
            log.info("è®¢å•æ”¯ä»˜å¤„ç†å®Œæˆ: {}", event.getOrderId());
        } catch (Exception e) {
            log.error("è®¢å•æ”¯ä»˜å¤„ç†å¤±è´¥: {}", event.getOrderId(), e);
            // å¯ä»¥å‘å¸ƒæ”¯ä»˜å¤±è´¥äº‹ä»¶
        }
    }
}

// 4. äº‹ä»¶ç›‘å¬å™¨ - å‘é€é€šçŸ¥
@Component
@Slf4j
public class NotificationEventHandler {
    @Autowired
    private NotificationService notificationService;
    
    @EventListener
    @Async("taskExecutor")
    public void handleOrderCreated(OrderCreatedEvent event) {
        try {
            log.info("å‘é€è®¢å•é€šçŸ¥: {}", event.getOrderId());
            notificationService.sendOrderConfirmation(
                event.getUserId(), 
                event.getOrderId()
            );
        } catch (Exception e) {
            log.error("å‘é€è®¢å•é€šçŸ¥å¤±è´¥: {}", event.getOrderId(), e);
        }
    }
}

// 5. å¼‚æ­¥é…ç½®
@Configuration
@EnableAsync
public class AsyncConfig {
    @Bean("taskExecutor")
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("event-handler-");
        executor.initialize();
        return executor;
    }
}
```

---

## 7. ğŸ“– CQRSæ¨¡å¼ï¼šè¯»å†™åˆ†ç¦»çš„é«˜çº§å®è·µ


### 7.1 ä»€ä¹ˆæ˜¯CQRS


**CQRS = Command Query Responsibility Segregationï¼ˆå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼‰**

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†ï¼š
> - **å€Ÿä¹¦ï¼ˆCommandï¼‰**ï¼šéœ€è¦æ£€æŸ¥åº“å­˜ã€æ›´æ–°è®°å½•ã€å¤„ç†é€¾æœŸç­‰å¤æ‚é€»è¾‘
> - **æŸ¥ä¹¦ï¼ˆQueryï¼‰**ï¼šåªéœ€è¦å¿«é€Ÿå‘Šè¯‰ä½ ä¹¦åœ¨å“ªä¸ªä½ç½®
> 
> ä¼ ç»Ÿåšæ³•ï¼šä¸€ä¸ªç®¡ç†å‘˜æ—¢è´Ÿè´£å€Ÿä¹¦åˆè´Ÿè´£æŸ¥ä¹¦
> CQRSåšæ³•ï¼šå€Ÿä¹¦çª—å£ä¸“é—¨å¤„ç†å€Ÿè¿˜ï¼ŒæŸ¥è¯¢çª—å£ä¸“é—¨å¤„ç†æŸ¥è¯¢

### 7.2 ä¼ ç»ŸCRUD vs CQRS


**ä¼ ç»ŸCRUDæ¨¡å¼çš„é—®é¢˜ï¼š**
```java
// ä¼ ç»Ÿæ–¹å¼ï¼šä¸€ä¸ªServiceå¤„ç†æ‰€æœ‰æ“ä½œ
@Service
public class OrderService {
    
    // åˆ›å»ºè®¢å• - å¤æ‚çš„å†™æ“ä½œ
    public Order createOrder(CreateOrderRequest request) {
        // 1. éªŒè¯ç”¨æˆ·
        User user = userRepository.findById(request.getUserId());
        if (user == null) throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        
        // 2. æ£€æŸ¥å•†å“åº“å­˜
        Product product = productRepository.findById(request.getProductId());
        if (product.getStock() < request.getQuantity()) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // 3. è®¡ç®—ä»·æ ¼
        BigDecimal totalPrice = product.getPrice().multiply(
            BigDecimal.valueOf(request.getQuantity())
        );
        
        // 4. åˆ›å»ºè®¢å•
        Order order = Order.builder()
            .userId(request.getUserId())
            .productId(request.getProductId())
            .quantity(request.getQuantity())
            .totalPrice(totalPrice)
            .status(OrderStatus.PENDING)
            .build();
            
        order = orderRepository.save(order);
        
        // 5. æ›´æ–°åº“å­˜
        product.setStock(product.getStock() - request.getQuantity());
        productRepository.save(product);
        
        // 6. å‘é€é€šçŸ¥
        notificationService.sendOrderNotification(order);
        
        return order;
    }
    
    // æŸ¥è¯¢è®¢å• - ç®€å•çš„è¯»æ“ä½œ
    public OrderDetailDTO getOrderDetail(Long orderId) {
        // ä½†æŸ¥è¯¢éœ€è¦çš„æ•°æ®æ ¼å¼å’Œå­˜å‚¨æ ¼å¼ä¸åŒ
        Order order = orderRepository.findById(orderId);
        User user = userRepository.findById(order.getUserId());
        Product product = productRepository.findById(order.getProductId());
        
        // éœ€è¦ç»„è£…æ•°æ®
        return OrderDetailDTO.builder()
            .orderId(order.getId())
            .orderStatus(order.getStatus())
            .userName(user.getName())
            .userPhone(user.getPhone())
            .productName(product.getName())
            .productPrice(product.getPrice())
            .quantity(order.getQuantity())
            .totalPrice(order.getTotalPrice())
            .build();
    }
    
    // æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨
    public List<OrderListDTO> getUserOrders(Long userId) {
        // åˆéœ€è¦ä¸åŒçš„æ•°æ®æ ¼å¼...
    }
}
```

**é—®é¢˜åˆ†æï¼š**
- ğŸ”´ **æ€§èƒ½å†²çª**ï¼šå†™æ“ä½œéœ€è¦äº‹åŠ¡å’Œä¸€è‡´æ€§ï¼Œè¯»æ“ä½œéœ€è¦é€Ÿåº¦
- ğŸ”´ **æ¨¡å‹å†²çª**ï¼šå†™æ“ä½œå…³æ³¨ä¸šåŠ¡è§„åˆ™ï¼Œè¯»æ“ä½œå…³æ³¨å±•ç¤ºæ ¼å¼
- ğŸ”´ **æ‰©å±•å›°éš¾**ï¼šè¯»å†™éœ€æ±‚ä¸åŒï¼Œéš¾ä»¥ç‹¬ç«‹ä¼˜åŒ–

### 7.3 CQRSæ¨¡å¼å®è·µ


**ğŸ”§ CQRSé‡æ„ç¤ºä¾‹**

**1. å‘½ä»¤ç«¯ï¼ˆCommand Sideï¼‰- å¤„ç†å†™æ“ä½œ**
```java
// å‘½ä»¤å®šä¹‰
public class CreateOrderCommand {
    private final Long userId;
    private final Long productId;
    private final Integer quantity;
    // ... å…¶ä»–å­—æ®µå’Œæ„é€ å™¨
}

// å‘½ä»¤å¤„ç†å™¨
@Component
public class CreateOrderCommandHandler {
    @Autowired
    private OrderRepository orderRepository;
    @Autowired
    private ProductRepository productRepository;
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    @Transactional
    public OrderCreatedEvent handle(CreateOrderCommand command) {
        // 1. ä¸šåŠ¡é€»è¾‘éªŒè¯
        Product product = productRepository.findById(command.getProductId())
            .orElseThrow(() -> new BusinessException("å•†å“ä¸å­˜åœ¨"));
            
        if (product.getStock() < command.getQuantity()) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // 2. åˆ›å»ºèšåˆæ ¹
        Order order = Order.builder()
            .userId(command.getUserId())
            .productId(command.getProductId())
            .quantity(command.getQuantity())
            .totalPrice(product.getPrice().multiply(
                BigDecimal.valueOf(command.getQuantity())
            ))
            .status(OrderStatus.PENDING)
            .build();
            
        // 3. ä¿å­˜åˆ°å†™åº“
        order = orderRepository.save(order);
        
        // 4. æ›´æ–°åº“å­˜
        product.decreaseStock(command.getQuantity());
        productRepository.save(product);
        
        // 5. å‘å¸ƒäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent(order);
        eventPublisher.publishEvent(event);
        
        return event;
    }
}

// å‘½ä»¤æœåŠ¡
@Service
public class OrderCommandService {
    @Autowired
    private CreateOrderCommandHandler createOrderCommandHandler;
    
    public Long createOrder(CreateOrderRequest request) {
        CreateOrderCommand command = CreateOrderCommand.builder()
            .userId(request.getUserId())
            .productId(request.getProductId())
            .quantity(request.getQuantity())
            .build();
            
        OrderCreatedEvent event = createOrderCommandHandler.handle(command);
        return event.getOrderId();
    }
}
```

**2. æŸ¥è¯¢ç«¯ï¼ˆQuery Sideï¼‰- å¤„ç†è¯»æ“ä½œ**
```java
// æŸ¥è¯¢æ¨¡å‹ - ä¸“é—¨ä¸ºæ˜¾ç¤ºè®¾è®¡
@Entity
@Table(name = "order_read_model")
public class OrderReadModel {
    private Long orderId;
    private String orderNumber;
    private Long userId;
    private String userName;
    private String userPhone;
    private Long productId;
    private String productName;
    private BigDecimal productPrice;
    private Integer quantity;
    private BigDecimal totalPrice;
    private String status;
    private LocalDateTime createdAt;
    // ... æ‰€æœ‰æŸ¥è¯¢éœ€è¦çš„å­—æ®µéƒ½é¢„å…ˆå‡†å¤‡å¥½
}

// æŸ¥è¯¢æœåŠ¡
@Service
public class OrderQueryService {
    @Autowired
    private OrderReadModelRepository readModelRepository;
    
    // æŸ¥è¯¢è®¢å•è¯¦æƒ… - éå¸¸ç®€å•å¿«é€Ÿ
    public OrderDetailDTO getOrderDetail(Long orderId) {
        OrderReadModel readModel = readModelRepository.findByOrderId(orderId);
        if (readModel == null) {
            throw new BusinessException("è®¢å•ä¸å­˜åœ¨");
        }
        
        // ç›´æ¥è½¬æ¢ï¼Œæ— éœ€å…³è”æŸ¥è¯¢
        return OrderDetailDTO.builder()
            .orderId(readModel.getOrderId())
            .orderNumber(readModel.getOrderNumber())
            .userName(readModel.getUserName())
            .userPhone(readModel.getUserPhone())
            .productName(readModel.getProductName())
            .productPrice(readModel.getProductPrice())
            .quantity(readModel.getQuantity())
            .totalPrice(readModel.getTotalPrice())
            .status(readModel.getStatus())
            .createdAt(readModel.getCreatedAt())
            .build();
    }
    
    // æŸ¥è¯¢ç”¨æˆ·è®¢å•åˆ—è¡¨ - æ”¯æŒå¤æ‚æŸ¥è¯¢
    public Page<OrderListDTO> getUserOrders(Long userId, Pageable pageable) {
        Page<OrderReadModel> readModels = readModelRepository
            .findByUserIdOrderByCreatedAtDesc(userId, pageable);
            
        return readModels.map(readModel -> OrderListDTO.builder()
            .orderId(readModel.getOrderId())
            .orderNumber(readModel.getOrderNumber())
            .productName(readModel.getProductName())
            .totalPrice(readModel.getTotalPrice())
            .status(readModel.getStatus())
            .createdAt(readModel.getCreatedAt())
            .build());
    }
}

// äº‹ä»¶å¤„ç†å™¨ - æ›´æ–°è¯»æ¨¡å‹
@Component
public class OrderReadModelUpdater {
    @Autowired
    private OrderReadModelRepository readModelRepository;
    
    @EventListener
    @Async
    public void handleOrderCreated(OrderCreatedEvent event) {
        // åˆ›å»ºæŸ¥è¯¢æ¨¡å‹
        OrderReadModel readModel = OrderReadModel.builder()
            .orderId(event.getOrderId())
            .orderNumber(event.getOrderNumber())
            .userId(event.getUserId())
            .userName(event.getUserName())
            .userPhone(event.getUserPhone())
            .productId(event.getProductId())
            .productName(event.getProductName())
            .productPrice(event.getProductPrice())
            .quantity(event.getQuantity())
            .totalPrice(event.getTotalPrice())
            .status(event.getStatus().name())
            .createdAt(event.getCreatedAt())
            .build();
            
        readModelRepository.save(readModel);
    }
    
    @EventListener
    @Async
    public void handleOrderStatusChanged(OrderStatusChangedEvent event) {
        // æ›´æ–°è®¢å•çŠ¶æ€
        OrderReadModel readModel = readModelRepository
            .findByOrderId(event.getOrderId());
        if (readModel != null) {
            readModel.setStatus(event.getNewStatus().name());
            readModelRepository.save(readModel);
        }
    }
}
```

### 7.4 CQRSçš„ä¼˜åŠ¿ä¸è€ƒè™‘


**ğŸ“Š CQRSä¼˜åŠ¿**

| æ–¹é¢ | ä¼ ç»ŸCRUD | CQRS |
|------|----------|------|
| **è¯»æ€§èƒ½** | ğŸ”´ éœ€è¦å¤šè¡¨å…³è”æŸ¥è¯¢ | ğŸŸ¢ å•è¡¨æŸ¥è¯¢ï¼Œé¢„å…ˆç»„è£…å¥½æ•°æ® |
| **å†™æ€§èƒ½** | ğŸ”´ è¯»å†™å…±äº«åŒä¸€æ•°æ®æ¨¡å‹ | ğŸŸ¢ å†™æ¨¡å‹ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ |
| **æ‰©å±•æ€§** | ğŸ”´ è¯»å†™éœ€æ±‚å†²çª | ğŸŸ¢ è¯»å†™å¯ä»¥ç‹¬ç«‹æ‰©å±• |
| **ç¼“å­˜** | ğŸ”´ å¤æ‚æŸ¥è¯¢éš¾ä»¥ç¼“å­˜ | ğŸŸ¢ æŸ¥è¯¢æ¨¡å‹å¤©ç„¶é€‚åˆç¼“å­˜ |

**âš ï¸ æ³¨æ„äº‹é¡¹**
- **å¤æ‚æ€§å¢åŠ **ï¼šéœ€è¦ç»´æŠ¤ä¸¤å¥—æ¨¡å‹
- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šè¯»å†™æ¨¡å‹ä¹‹é—´æœ‰å»¶è¿Ÿ
- **é€‚ç”¨åœºæ™¯**ï¼šè¯»å†™å·®å¼‚å·¨å¤§çš„ç³»ç»Ÿæ‰éœ€è¦

---

## 8. ğŸ¯ DDDé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼šä¸šåŠ¡å»ºæ¨¡çš„è‰ºæœ¯


### 8.1 ä»€ä¹ˆæ˜¯DDD


**DDD = Domain-Driven Designï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰**

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä½ è¦ä¸ºä¸€å®¶é¤å…è®¾è®¡ç®¡ç†ç³»ç»Ÿï¼š
> 
> **ä¼ ç»Ÿå¼€å‘æ–¹å¼**ï¼š
> - å…ˆè®¾è®¡æ•°æ®åº“è¡¨ï¼šç”¨æˆ·è¡¨ã€èœå“è¡¨ã€è®¢å•è¡¨...
> - ç„¶åå†™ä»£ç æ“ä½œè¿™äº›è¡¨
> 
> **DDDæ–¹å¼**ï¼š
> - å…ˆç†è§£é¤å…çš„ä¸šåŠ¡ï¼šé¡¾å®¢ç‚¹é¤ã€å¨å¸ˆåšèœã€æœåŠ¡å‘˜æœåŠ¡...
> - ç”¨ä»£ç æ¨¡æ‹Ÿç°å®ä¸–ç•Œçš„ä¸šåŠ¡æµç¨‹
> - æ•°æ®åº“åªæ˜¯å­˜å‚¨ä¸šåŠ¡çš„åœ°æ–¹

**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> DDDçš„æ ¸å¿ƒæ€æƒ³ï¼šè®©ä»£ç ç»“æ„åæ˜ ä¸šåŠ¡ç»“æ„ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ç»“æ„

### 8.2 DDDçš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ ä¸€åˆ†é’ŸæŒæ¡DDDæ ¸å¿ƒæ¦‚å¿µ**

| æ¦‚å¿µ | ç°å®ä¸–ç•Œç±»æ¯” | ä»£ç ä¸­çš„ä½“ç° |
|------|-------------|-------------|
| **é¢†åŸŸ(Domain)** | é¤å…è¡Œä¸š | æ•´ä¸ªé¡¹ç›®çš„ä¸šåŠ¡èŒƒå›´ |
| **å­åŸŸ(Subdomain)** | ç‚¹é¤ã€åˆ¶ä½œã€ç»“è´¦ | ä¸åŒçš„ä¸šåŠ¡æ¨¡å— |
| **å®ä½“(Entity)** | å…·ä½“çš„é¡¾å®¢ã€è®¢å• | æœ‰å”¯ä¸€æ ‡è¯†çš„ä¸šåŠ¡å¯¹è±¡ |
| **å€¼å¯¹è±¡(Value Object)** | åœ°å€ã€ç”µè¯å·ç  | æ²¡æœ‰å”¯ä¸€æ ‡è¯†çš„ä¸šåŠ¡å€¼ |
| **èšåˆ(Aggregate)** | ä¸€ä¸ªå®Œæ•´çš„è®¢å•ï¼ˆåŒ…å«è®¢å•é¡¹ï¼‰ | ä¸šåŠ¡ä¸Šçš„å®Œæ•´å•å…ƒ |
| **ä»“å‚¨(Repository)** | èœè°±å­˜æ”¾çš„åœ°æ–¹ | å­˜å‚¨å’Œè·å–èšåˆçš„åœ°æ–¹ |

### 8.3 DDDå®è·µï¼šè®¢å•ç³»ç»Ÿå»ºæ¨¡


**ä¼ ç»Ÿå¼€å‘æ–¹å¼ï¼š**
```java
// ä¼ ç»Ÿæ–¹å¼ï¼šä»¥æ•°æ®ä¸ºä¸­å¿ƒ
@Entity
public class Order {
    private Long id;
    private Long userId;
    private Long productId;
    private Integer quantity;
    private BigDecimal price;
    private String status;
    private Date createTime;
    // åªæœ‰getter/setterï¼Œæ²¡æœ‰ä¸šåŠ¡é€»è¾‘
}

@Service
public class OrderService {
    public void createOrder(OrderCreateRequest request) {
        // ä¸šåŠ¡é€»è¾‘æ•£è½åœ¨Serviceä¸­
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        order.setPrice(calculatePrice(request));
        order.setStatus("PENDING");
        order.setCreateTime(new Date());
        orderRepository.save(order);
    }
}
```

**DDDæ–¹å¼ï¼š**
```java
// 1. å€¼å¯¹è±¡ - è®¢å•é‡‘é¢
public class Money {
    private final BigDecimal amount;
    private final String currency;
    
    public Money(BigDecimal amount, String currency) {
        if (amount.compareTo(BigDecimal.ZERO) < 0) {
            throw new IllegalArgumentException("é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°");
        }
        this.amount = amount;
        this.currency = currency;
    }
    
    public Money multiply(int quantity) {
        return new Money(amount.multiply(BigDecimal.valueOf(quantity)), currency);
    }
    
    public Money add(Money other) {
        if (!this.currency.equals(other.currency)) {
            throw new IllegalArgumentException("è´§å¸ç±»å‹ä¸åŒ¹é…");
        }
        return new Money(this.amount.add(other.amount), this.currency);
    }
}

// 2. å€¼å¯¹è±¡ - è®¢å•é¡¹
public class OrderItem {
    private final ProductId productId;
    private final String productName;
    private final Money unitPrice;
    private final int quantity;
    
    public OrderItem(ProductId productId, String productName, 
                    Money unitPrice, int quantity) {
        if (quantity <= 0) {
            throw new IllegalArgumentException("è®¢å•æ•°é‡å¿…é¡»å¤§äº0");
        }
        this.productId = productId;
        this.productName = productName;
        this.unitPrice = unitPrice;
        this.quantity = quantity;
    }
    
    public Money getTotalPrice() {
        return unitPrice.multiply(quantity);
    }
}

// 3. å®ä½“ - è®¢å•èšåˆæ ¹
public class Order {
    private OrderId orderId;
    private UserId userId;
    private List<OrderItem> orderItems;
    private OrderStatus status;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
    
    // ç§æœ‰æ„é€ å™¨ï¼Œåªèƒ½é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»º
    private Order(UserId userId, List<OrderItem> orderItems) {
        this.orderId = OrderId.generate();
        this.userId = userId;
        this.orderItems = new ArrayList<>(orderItems);
        this.status = OrderStatus.PENDING;
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }
    
    // å·¥å‚æ–¹æ³• - ä½“ç°ä¸šåŠ¡è§„åˆ™
    public static Order create(UserId userId, List<OrderItem> orderItems) {
        if (orderItems == null || orderItems.isEmpty()) {
            throw new DomainException("è®¢å•å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå•†å“");
        }
        
        Money totalAmount = orderItems.stream()
            .map(OrderItem::getTotalPrice)
            .reduce(Money.ZERO_CNY, Money::add);
            
        if (totalAmount.getAmount().compareTo(new BigDecimal("50000")) > 0) {
            throw new DomainException("å•ç¬”è®¢å•é‡‘é¢ä¸èƒ½è¶…è¿‡50000å…ƒ");
        }
        
        return new Order(userId, orderItems);
    }
    
    // ä¸šåŠ¡æ–¹æ³• - ç¡®è®¤è®¢å•
    public void confirm() {
        if (status != OrderStatus.PENDING) {
            throw new DomainException("åªæœ‰å¾…å¤„ç†çŠ¶æ€çš„è®¢å•æ‰èƒ½ç¡®è®¤");
        }
        this.status = OrderStatus.CONFIRMED;
        this.updatedAt = LocalDateTime.now();
    }
    
    // ä¸šåŠ¡æ–¹æ³• - å–æ¶ˆè®¢å•
    public void cancel(String reason) {
        if (status == OrderStatus.COMPLETED) {
            throw new DomainException("å·²å®Œæˆçš„è®¢å•ä¸èƒ½å–æ¶ˆ");
        }
        this.status = OrderStatus.CANCELLED;
        this.updatedAt = LocalDateTime.now();
        // å¯ä»¥å‘å¸ƒé¢†åŸŸäº‹ä»¶
        DomainEvents.raise(new OrderCancelledEvent(this.orderId, reason));
    }
    
    // è·å–è®¢å•æ€»é‡‘é¢
    public Money getTotalAmount() {
        return orderItems.stream()
            .map(OrderItem::getTotalPrice)
            .reduce(Money.ZERO_CNY, Money::add);
    }
}

// 4. é¢†åŸŸæœåŠ¡ - å¤æ‚ä¸šåŠ¡é€»è¾‘
@Service
public class OrderDomainService {
    
    public boolean canCancelOrder(Order order, User user) {
        // ä¸šåŠ¡è§„åˆ™ï¼šåªæœ‰è®¢å•åˆ›å»ºè€…æˆ–ç®¡ç†å‘˜å¯ä»¥å–æ¶ˆè®¢å•
        if (order.getUserId().equals(user.getId())) {
            return true;
        }
        
        if (user.hasRole(Role.ADMIN)) {
            return true;
        }
        
        return false;
    }
    
    public Money calculateShippingFee(Order order, Address shippingAddress) {
        Money totalAmount = order.getTotalAmount();
        
        // ä¸šåŠ¡è§„åˆ™ï¼šè®¢å•é‡‘é¢è¶…è¿‡100å…ƒå…è¿è´¹
        if (totalAmount.getAmount().compareTo(new BigDecimal("100")) >= 0) {
            return Money.ZERO_CNY;
        }
        
        // æ ¹æ®åœ°å€è®¡ç®—è¿è´¹
        if (shippingAddress.isRemoteArea()) {
            return new Money(new BigDecimal("15"), "CNY");
        } else {
            return new Money(new BigDecimal("8"), "CNY");
        }
    }
}

// 5. ä»“å‚¨æ¥å£ - ä¸å…³å¿ƒå­˜å‚¨ç»†èŠ‚
public interface OrderRepository {
    void save(Order order);
    Optional<Order> findById(OrderId orderId);
    List<Order> findByUserId(UserId userId);
}

// 6. åº”ç”¨æœåŠ¡ - åè°ƒå„ç§èµ„æº
@Service
@Transactional
public class OrderApplicationService {
    @Autowired
    private OrderRepository orderRepository;
    @Autowired
    private ProductRepository productRepository;
    @Autowired
    private OrderDomainService orderDomainService;
    
    public OrderId createOrder(CreateOrderCommand command) {
        // 1. è·å–å•†å“ä¿¡æ¯
        List<OrderItem> orderItems = new ArrayList<>();
        for (CreateOrderCommand.Item item : command.getItems()) {
            Product product = productRepository.findById(item.getProductId())
                .orElseThrow(() -> new BusinessException("å•†å“ä¸å­˜åœ¨"));
                
            OrderItem orderItem = new OrderItem(
                product.getId(),
                product.getName(),
                product.getPrice(),
                item.getQuantity()
            );
            orderItems.add(orderItem);
        }
        
        // 2. åˆ›å»ºè®¢å• - ä½¿ç”¨é¢†åŸŸå¯¹è±¡
        Order order = Order.create(command.getUserId(), orderItems);
        
        // 3. ä¿å­˜è®¢å•
        orderRepository.save(order);
        
        return order.getId();
    }
}
```

### 8.4 DDDçš„ä¼˜åŠ¿


**ğŸ“Š ä¼ ç»Ÿå¼€å‘ vs DDDå¯¹æ¯”**

| ç‰¹æ€§ | ä¼ ç»Ÿå¼€å‘ | DDD |
|------|---------|-----|
| **ä¸šåŠ¡ç†è§£** | ğŸ”´ å¼€å‘è€…ç†è§£æ•°æ®ç»“æ„ | ğŸŸ¢ å¼€å‘è€…ç†è§£ä¸šåŠ¡è§„åˆ™ |
| **ä»£ç ç»„ç»‡** | ğŸ”´ æŒ‰æŠ€æœ¯åˆ†å±‚ç»„ç»‡ | ğŸŸ¢ æŒ‰ä¸šåŠ¡é¢†åŸŸç»„ç»‡ |
| **ä¸šåŠ¡è§„åˆ™** | ğŸ”´ æ•£è½åœ¨å„ä¸ªServiceä¸­ | ğŸŸ¢ å°è£…åœ¨é¢†åŸŸå¯¹è±¡ä¸­ |
| **å˜æ›´å½±å“** | ğŸ”´ ä¸šåŠ¡å˜æ›´å½±å“å¤šä¸ªåœ°æ–¹ | ğŸŸ¢ å˜æ›´é›†ä¸­åœ¨ç›¸å…³é¢†åŸŸ |
| **æµ‹è¯•éš¾åº¦** | ğŸ”´ éœ€è¦å‡†å¤‡æ•°æ®åº“ç¯å¢ƒ | ğŸŸ¢ é¢†åŸŸå¯¹è±¡å¯ä»¥ç‹¬ç«‹æµ‹è¯• |

---

## 9. ğŸ§¹ æ¸…æ´æ¶æ„ï¼šä¾èµ–åè½¬çš„ç»ˆæå®è·µ


### 9.1 ä»€ä¹ˆæ˜¯æ¸…æ´æ¶æ„


**æ¸…æ´æ¶æ„ï¼ˆClean Architectureï¼‰**æ˜¯Uncle Bobæå‡ºçš„ä¸€ç§è½¯ä»¶æ¶æ„æ€æƒ³ï¼Œæ ¸å¿ƒç†å¿µæ˜¯**ä¾èµ–å€’ç½®**ã€‚

**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸ªé«˜çº§é…’åº—çš„è®¾è®¡ï¼š
> - **æ ¸å¿ƒåŒºåŸŸ**ï¼šæ€»ç»Ÿå¥—æˆ¿ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
> - **æœåŠ¡åŒºåŸŸ**ï¼šç®¡å®¶ã€ä¿å®‰ã€æ¸…æ´ï¼ˆåº”ç”¨æœåŠ¡ï¼‰
> - **åŸºç¡€è®¾æ–½**ï¼šç”µæ¢¯ã€ç©ºè°ƒã€ç½‘ç»œï¼ˆæŠ€æœ¯å®ç°ï¼‰
> 
> è®¾è®¡åŸåˆ™ï¼šæ€»ç»Ÿå¥—æˆ¿ä¸ä¾èµ–å…·ä½“çš„æœåŠ¡å‘˜ï¼Œè€Œæ˜¯å®šä¹‰æœåŠ¡æ ‡å‡†ï¼›
> ä»»ä½•æœåŠ¡å‘˜åªè¦ç¬¦åˆæ ‡å‡†éƒ½å¯ä»¥æä¾›æœåŠ¡

### 9.2 æ¸…æ´æ¶æ„çš„å±‚æ¬¡ç»“æ„


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤–éƒ¨æ¥å£              â”‚ â† Webæ§åˆ¶å™¨ã€REST API
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ¥å£é€‚é…å™¨             â”‚ â† æ•°æ®åº“é€‚é…å™¨ã€å¤–éƒ¨æœåŠ¡é€‚é…å™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              åº”ç”¨ä¸šåŠ¡è§„åˆ™            â”‚ â† ç”¨ä¾‹ã€åº”ç”¨æœåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ä¼ä¸šä¸šåŠ¡è§„åˆ™            â”‚ â† å®ä½“ã€é¢†åŸŸæœåŠ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾èµ–æ–¹å‘ï¼šå¤–å±‚ â†’ å†…å±‚ï¼ˆåªèƒ½å‘å†…ä¾èµ–ï¼Œä¸èƒ½å‘å¤–ä¾èµ–ï¼‰
```

### 9.3 æ¸…æ´æ¶æ„å®è·µ


**ğŸ”§ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½çš„æ¸…æ´æ¶æ„å®ç°**

**1. ä¼ä¸šä¸šåŠ¡è§„åˆ™å±‚ï¼ˆæœ€å†…å±‚ï¼‰**
```java
// å®ä½“ - åŒ…å«æœ€æ ¸å¿ƒçš„ä¸šåŠ¡è§„åˆ™
public class User {
    private UserId id;
    private Username username;
    private Email email;
    private Password password;
    private UserStatus status;
    private LocalDateTime createdAt;
    
    // ç§æœ‰æ„é€ å™¨
    private User(Username username, Email email, Password password) {
        this.id = UserId.generate();
        this.username = username;
        this.email = email;
        this.password = password;
        this.status = UserStatus.ACTIVE;
        this.createdAt = LocalDateTime.now();
    }
    
    // å·¥å‚æ–¹æ³• - æ ¸å¿ƒä¸šåŠ¡è§„åˆ™
    public static User create(String username, String email, String password) {
        // ä¸šåŠ¡è§„åˆ™1ï¼šç”¨æˆ·åé•¿åº¦éªŒè¯
        if (username.length() < 3 || username.length() > 20) {
            throw new DomainException("ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´");
        }
        
        // ä¸šåŠ¡è§„åˆ™2ï¼šé‚®ç®±æ ¼å¼éªŒè¯
        if (!email.contains("@")) {
            throw new DomainException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
        }
        
        // ä¸šåŠ¡è§„åˆ™3ï¼šå¯†ç å¼ºåº¦éªŒè¯
        if (password.length() < 6) {
            throw new DomainException("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½");
        }
        
        return new User(
            new Username(username),
            new Email(email),
            new Password(password)
        );
    }
    
    // ä¸šåŠ¡æ–¹æ³•
    public void changePassword(String oldPassword, String newPassword) {
        if (!password.matches(oldPassword)) {
            throw new DomainException("åŸå¯†ç ä¸æ­£ç¡®");
        }
        
        if (newPassword.length() < 6) {
            throw new DomainException("æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½");
        }
        
        this.password = new Password(newPassword);
    }
}
```

**2. åº”ç”¨ä¸šåŠ¡è§„åˆ™å±‚**
```java
// ç”¨ä¾‹æ¥å£ - å®šä¹‰åº”ç”¨èƒ½åšä»€ä¹ˆ
public interface RegisterUserUseCase {
    UserId execute(RegisterUserCommand command);
}

// ç«¯å£æ¥å£ - å®šä¹‰éœ€è¦ä»€ä¹ˆå¤–éƒ¨èƒ½åŠ›
public interface UserRepository {
    void save(User user);
    Optional<User> findByUsername(String username);
    Optional<User> findByEmail(String email);
}

public interface EmailService {
    void sendWelcomeEmail(String email, String username);
}

// ç”¨ä¾‹å®ç° - åè°ƒå„ç§èµ„æºå®Œæˆä¸šåŠ¡ç›®æ ‡
@Component
public class RegisterUserUseCaseImpl implements RegisterUserUseCase {
    private final UserRepository userRepository;
    private final EmailService emailService;
    
    public RegisterUserUseCaseImpl(UserRepository userRepository, 
                                 EmailService emailService) {
        this.userRepository = userRepository;
        this.emailService = emailService;
    }
    
    @Override
    @Transactional
    public UserId execute(RegisterUserCommand command) {
        // 1. æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        if (userRepository.findByUsername(command.getUsername()).isPresent()) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        // 2. æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
        if (userRepository.findByEmail(command.getEmail()).isPresent()) {
            throw new BusinessException("é‚®ç®±å·²è¢«æ³¨å†Œ");
        }
        
        // 3. åˆ›å»ºç”¨æˆ·ï¼ˆè°ƒç”¨é¢†åŸŸå±‚ï¼‰
        User user = User.create(
            command.getUsername(),
            command.getEmail(),
            command.getPassword()
        );
        
        // 4. ä¿å­˜ç”¨æˆ·
        userRepository.save(user);
        
        // 5. å‘é€æ¬¢è¿é‚®ä»¶
        emailService.sendWelcomeEmail(user.getEmail(), user.getUsername());
        
        return user.getId();
    }
}
```

**3. æ¥å£é€‚é…å™¨å±‚**
```java
// æ•°æ®åº“é€‚é…å™¨ - å®ç°UserRepositoryæ¥å£
@Repository
public class JpaUserRepository implements UserRepository {
    @Autowired
    private UserJpaRepository jpaRepository;
    
    @Override
    public void save(User user) {
        UserEntity entity = UserEntity.fromDomain(user);
        jpaRepository.save(entity);
    }
    
    @Override
    public Optional<User> findByUsername(String username) {
        return jpaRepository.findByUsername(username)
            .map(UserEntity::toDomain);
    }
    
    @Override
    public Optional<User> findByEmail(String email) {
        return jpaRepository.findByEmail(email)
            .map(UserEntity::toDomain);
    }
}

// é‚®ä»¶æœåŠ¡é€‚é…å™¨
@Service
public class SmtpEmailService implements EmailService {
    @Autowired
    private JavaMailSender mailSender;
    
    @Override
    public void sendWelcomeEmail(String email, String username) {
        SimpleMailMessage message = new SimpleMailMessage();
        message.setTo(email);
        message.setSubject("æ¬¢è¿æ³¨å†Œ");
        message.setText("æ¬¢è¿ " + username + " æ³¨å†Œæˆ‘ä»¬çš„æœåŠ¡!");
        mailSender.send(message);
    }
}
```

**4. å¤–éƒ¨æ¥å£å±‚**
```java
// RESTæ§åˆ¶å™¨
@RestController
@RequestMapping("/api/users")
public class UserController {
    private final RegisterUserUseCase registerUserUseCase;
    
    public UserController(RegisterUserUseCase registerUserUseCase) {
        this.registerUserUseCase = registerUserUseCase;
    }
    
    @PostMapping("/register")
    public ResponseEntity<RegisterUserResponse> register(
            @RequestBody RegisterUserRequest request) {
        
        try {
            RegisterUserCommand command = RegisterUserCommand.builder()
                .username(request.getUsername())
                .email(request.getEmail())
                .password(request.getPassword())
                .build();
                
            UserId userId = registerUserUseCase.execute(command);
            
            RegisterUserResponse response = RegisterUserResponse.builder()
                .userId(userId.getValue())
                .message("æ³¨å†ŒæˆåŠŸ")
                .build();
                
            return ResponseEntity.ok(response);
        } catch (DomainException | BusinessException e) {
            return ResponseEntity.badRequest()
                .body(RegisterUserResponse.error(e.getMessage()));
        }
    }
}
```

### 9.4 æ¸…æ´æ¶æ„çš„æ ¸å¿ƒä¼˜åŠ¿


**ğŸ“Š ä¾èµ–å…³ç³»å¯¹æ¯”**

```
ä¼ ç»Ÿæ¶æ„ï¼š
Controller â†’ Service â†’ Repository â†’ Database
     â†“         â†“          â†“
   ä¾èµ–å…·ä½“å®ç°ï¼Œéš¾ä»¥æµ‹è¯•å’Œæ›¿æ¢

æ¸…æ´æ¶æ„ï¼š
Controller â†’ UseCase â† Repositoryæ¥å£
              â†“           â†‘
          åªä¾èµ–æ¥å£   å…·ä½“å®ç°åœ¨å¤–å±‚
```

**ğŸ’ª å®è·µæŒ‘æˆ˜**
å°è¯•æ€è€ƒï¼šå¦‚æœè¦æŠŠé‚®ä»¶æœåŠ¡ä»SMTPæ¢æˆçŸ­ä¿¡é€šçŸ¥ï¼Œéœ€è¦æ”¹åŠ¨å“ªäº›ä»£ç ï¼Ÿ
- ä¼ ç»Ÿæ¶æ„ï¼šéœ€è¦ä¿®æ”¹Serviceå±‚çš„é‚®ä»¶å‘é€ä»£ç 
- æ¸…æ´æ¶æ„ï¼šåªéœ€è¦æä¾›æ–°çš„çŸ­ä¿¡æœåŠ¡é€‚é…å™¨

**æ¸…æ´æ¶æ„çš„ä¼˜åŠ¿ï¼š**

| ç‰¹æ€§ | ä¼ ç»Ÿæ¶æ„ | æ¸…æ´æ¶æ„ |
|------|----------|----------|
| **å¯æµ‹è¯•æ€§** | ğŸ”´ éœ€è¦å¯åŠ¨æ•°æ®åº“ã€é‚®ä»¶æœåŠ¡ | ğŸŸ¢ å¯ä»¥ç”¨Mockå¯¹è±¡ç‹¬ç«‹æµ‹è¯• |
| **æŠ€æœ¯æ— å…³æ€§** | ğŸ”´ ä¸šåŠ¡é€»è¾‘ä¾èµ–æŠ€æœ¯ç»†èŠ‚ | ğŸŸ¢ ä¸šåŠ¡é€»è¾‘å®Œå…¨ç‹¬ç«‹ |
| **å¯æ›¿æ¢æ€§** | ğŸ”´ æ›¿æ¢æŠ€æœ¯éœ€è¦å¤§é‡ä¿®æ”¹ | ğŸŸ¢ åªéœ€æ›¿æ¢é€‚é…å™¨å®ç° |
| **ä¸šåŠ¡èšç„¦** | ğŸ”´ æŠ€æœ¯ç»†èŠ‚å¹²æ‰°ä¸šåŠ¡ç†è§£ | ğŸŸ¢ ä¸šåŠ¡é€»è¾‘æ¸…æ™°å¯è§ |

---

## 10. ğŸ® æ¶æ„æ¨¡å¼é€‰æ‹©ä¸å®è·µæŒ‡å—


### 10.1 å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ¶æ„æ¨¡å¼


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> é€‰æ‹©æ¶æ„æ¨¡å¼å°±åƒé€‰æ‹©æˆ¿å±‹ç±»å‹ï¼š
> - **å•é—´å…¬å¯“**ï¼ˆå•ä½“åº”ç”¨ï¼‰ï¼šé€‚åˆå•èº«ï¼Œç®€å•ç›´æ¥
> - **ä¸‰å±…å®¤**ï¼ˆä¸‰å±‚æ¶æ„ï¼‰ï¼šé€‚åˆå°å®¶åº­ï¼ŒåŠŸèƒ½åŒºåˆ†æ˜ç¡®
> - **åˆ«å¢…**ï¼ˆå¾®æœåŠ¡ï¼‰ï¼šé€‚åˆå¤§å®¶åº­ï¼Œç‹¬ç«‹æ€§å¼ºä½†ç»´æŠ¤å¤æ‚
> - **æ™ºèƒ½å®¶å±…**ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰ï¼šå„è®¾å¤‡è‡ªåŠ¨åè°ƒå·¥ä½œ

### 10.2 æ¶æ„æ¨¡å¼é€‰æ‹©å†³ç­–æ ‘


```
é¡¹ç›®è§„æ¨¡å’Œå¤æ‚åº¦è¯„ä¼°
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å°å‹é¡¹ç›® â”‚ â†’ ä¸‰å±‚æ¶æ„ + MVC
    â”‚ å›¢é˜Ÿ<5äºº â”‚   ç®€å•ç›´æ¥ï¼Œå¿«é€Ÿå¼€å‘
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä¸­å‹é¡¹ç›® â”‚ â†’ åˆ†å±‚æ¶æ„ + å…­è¾¹å½¢æ¶æ„
    â”‚ å›¢é˜Ÿ5-15äººâ”‚   ä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å¤§å‹é¡¹ç›® â”‚ â†’ å¾®æœåŠ¡ + DDD + äº‹ä»¶é©±åŠ¨
    â”‚ å›¢é˜Ÿ>15äºº â”‚   å¯ç‹¬ç«‹å¼€å‘ï¼Œé«˜å¯æ‰©å±•æ€§
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 ä¸åŒåœºæ™¯çš„æ¶æ„é€‰æ‹©


**ğŸ“‹ åœºæ™¯å¯¹ç…§è¡¨**

| é¡¹ç›®ç‰¹å¾ | æ¨èæ¶æ„ | ç†ç”± |
|---------|----------|------|
| **åˆåˆ›äº§å“MVP** | ä¸‰å±‚æ¶æ„ | å¿«é€ŸéªŒè¯æƒ³æ³•ï¼Œç®€å•ç›´æ¥ |
| **ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ** | åˆ†å±‚æ¶æ„ + å…­è¾¹å½¢æ¶æ„ | ä¸šåŠ¡ç¨³å®šï¼Œæ³¨é‡å¯ç»´æŠ¤æ€§ |
| **é«˜å¹¶å‘ç”µå•†** | å¾®æœåŠ¡ + CQRS + äº‹ä»¶é©±åŠ¨ | éœ€è¦ç‹¬ç«‹æ‰©å±•ä¸åŒæ¨¡å— |
| **é‡‘èäº¤æ˜“ç³»ç»Ÿ** | DDD + æ¸…æ´æ¶æ„ | ä¸šåŠ¡è§„åˆ™å¤æ‚ï¼Œéœ€è¦é«˜å¯é æ€§ |
| **å†…å®¹ç®¡ç†ç³»ç»Ÿ** | åˆ†å±‚æ¶æ„ + CQRS | è¯»æ“ä½œå¤šï¼Œå†™æ“ä½œå°‘ |

### 10.4 æ¶æ„æ¼”è¿›è·¯å¾„


**ğŸš€ æ¶æ„ä¸æ˜¯ä¸€æˆä¸å˜çš„**

```
é˜¶æ®µ1ï¼šé¡¹ç›®èµ·æ­¥
ä¸‰å±‚æ¶æ„ï¼ˆMVCï¼‰
     â†“
   ä¸šåŠ¡å¢é•¿
     
é˜¶æ®µ2ï¼šä¸šåŠ¡å¤æ‚åŒ–
åˆ†å±‚æ¶æ„ + é¢†åŸŸæ¨¡å‹
     â†“
   ç”¨æˆ·å¢é•¿
     
é˜¶æ®µ3ï¼šæ€§èƒ½å‹åŠ›
å¼•å…¥CQRS + ç¼“å­˜
     â†“
   å›¢é˜Ÿæ‰©å¤§
     
é˜¶æ®µ4ï¼šå¤§è§„æ¨¡ç³»ç»Ÿ
å¾®æœåŠ¡ + äº‹ä»¶é©±åŠ¨ + DDD
```

**ğŸ’¡ å…³é”®æ´å¯Ÿ**
> å¥½çš„æ¶æ„æ˜¯æ¼”è¿›å‡ºæ¥çš„ï¼Œä¸æ˜¯ä¸€å¼€å§‹å°±è®¾è®¡å‡ºæ¥çš„

### 10.5 Spring Bootä¸­çš„æ¶æ„å®è·µç»„åˆ


**ğŸ”§ æ¨èçš„æ¶æ„ç»„åˆæ–¹æ¡ˆ**

**æ–¹æ¡ˆ1ï¼šä¼ ç»Ÿä¼ä¸šçº§åº”ç”¨**
```java
// é¡¹ç›®ç»“æ„
src/
â”œâ”€â”€ main/java/com/example/
â”‚   â”œâ”€â”€ controller/          // è¡¨ç°å±‚
â”‚   â”œâ”€â”€ service/            // ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ repository/         // æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ entity/            // å®ä½“ç±»
â”‚   â””â”€â”€ dto/               // æ•°æ®ä¼ è¾“å¯¹è±¡
```

**æ–¹æ¡ˆ2ï¼šé¢†åŸŸé©±åŠ¨è®¾è®¡**
```java
// é¡¹ç›®ç»“æ„
src/
â”œâ”€â”€ main/java/com/example/
â”‚   â”œâ”€â”€ interfaces/         // ç”¨æˆ·ç•Œé¢å±‚
â”‚   â”‚   â””â”€â”€ rest/          // RESTæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ application/        // åº”ç”¨æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ service/       // åº”ç”¨æœåŠ¡
â”‚   â”‚   â””â”€â”€ dto/           // æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ domain/            // é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ model/         // é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ service/       // é¢†åŸŸæœåŠ¡
â”‚   â”‚   â””â”€â”€ repository/    // ä»“å‚¨æ¥å£
â”‚   â””â”€â”€ infrastructure/     // åŸºç¡€è®¾æ–½å±‚
â”‚       â”œâ”€â”€ repository/    // ä»“å‚¨å®ç°
â”‚       â””â”€â”€ external/      // å¤–éƒ¨æœåŠ¡
```

**æ–¹æ¡ˆ3ï¼šå¾®æœåŠ¡æ¶æ„**
```java
// æ¯ä¸ªæœåŠ¡çš„ç»“æ„
user-service/
â”œâ”€â”€ src/main/java/com/example/user/
â”‚   â”œâ”€â”€ UserServiceApplication.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ repository/
â”‚   â””â”€â”€ event/             // äº‹ä»¶å¤„ç†

order-service/
â”œâ”€â”€ src/main/java/com/example/order/
â”‚   â”œâ”€â”€ OrderServiceApplication.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ repository/
â”‚   â””â”€â”€ event/

common/                     // å…±äº«åº“
â”œâ”€â”€ src/main/java/com/example/common/
â”‚   â”œâ”€â”€ event/             // å…¬å…±äº‹ä»¶å®šä¹‰
â”‚   â”œâ”€â”€ exception/         // å…¬å…±å¼‚å¸¸
â”‚   â””â”€â”€ util/              // å·¥å…·ç±»
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ¯ ä¸€åˆ†é’ŸæŒæ¡æ¶æ„æ¨¡å¼ç²¾é«“**

```
ğŸ”¸ ä¸‰å±‚æ¶æ„ï¼šæŒ‰æŠ€æœ¯èŒè´£åˆ†å±‚ï¼Œæ•°æ®â†’ä¸šåŠ¡â†’è¡¨ç°
ğŸ”¸ åˆ†å±‚æ¶æ„ï¼šæ›´ç»†ç²’åº¦çš„èŒè´£åˆ†ç¦»ï¼Œä¼ä¸šçº§æ ‡å‡†
ğŸ”¸ å…­è¾¹å½¢æ¶æ„ï¼šä¸šåŠ¡é€»è¾‘ç‹¬ç«‹ï¼Œå¤–éƒ¨æŠ€æœ¯å¯æ’æ‹”
ğŸ”¸ å¾®æœåŠ¡æ¶æ„ï¼šæŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†ï¼Œç‹¬ç«‹éƒ¨ç½²æ‰©å±•
ğŸ”¸ äº‹ä»¶é©±åŠ¨ï¼šå¼‚æ­¥è§£è€¦ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼
ğŸ”¸ CQRSï¼šè¯»å†™åˆ†ç¦»ï¼Œä¼˜åŒ–ä¸åŒåœºæ™¯çš„æ€§èƒ½
ğŸ”¸ DDDï¼šä»¥ä¸šåŠ¡ä¸ºä¸­å¿ƒå»ºæ¨¡ï¼Œä»£ç åæ˜ ç°å®
ğŸ”¸ æ¸…æ´æ¶æ„ï¼šä¾èµ–å€’ç½®ï¼Œå†…å±‚ä¸ä¾èµ–å¤–å±‚
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¶æ„æ¨¡å¼çš„æœ¬è´¨**
- **åˆ†ç¦»å…³æ³¨ç‚¹**ï¼šä¸åŒçš„äº‹æƒ…äº¤ç»™ä¸åŒçš„å±‚/ç»„ä»¶å¤„ç†
- **æ§åˆ¶ä¾èµ–**ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—
- **é¢å‘æ¥å£**ï¼šä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°
- **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ï¼Œä½†è¦åšå¥½

**ğŸ”¹ æ²¡æœ‰é“¶å¼¹**
æ¯ç§æ¶æ„æ¨¡å¼éƒ½æœ‰é€‚ç”¨åœºæ™¯ï¼š
- **ç®€å•é—®é¢˜ç”¨ç®€å•æ–¹æ¡ˆ**ï¼šä¸è¦è¿‡åº¦è®¾è®¡
- **å¤æ‚é—®é¢˜ç”¨å¤æ‚æ–¹æ¡ˆ**ï¼šè¯¥å¤æ‚æ—¶ä¸è¦ç®€åŒ–
- **æ¶æ„è¦èƒ½æ¼”è¿›**ï¼šéšç€ä¸šåŠ¡å‘å±•ä¸æ–­è°ƒæ•´

### 11.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š é€‰æ‹©æ¡†æ¶**

| åœºæ™¯ | æ¨èé€‰æ‹© | æ ¸å¿ƒè€ƒè™‘ |
|------|----------|----------|
| **å­¦ä¹ é˜¶æ®µ** | Spring MVC + ä¸‰å±‚æ¶æ„ | æ¦‚å¿µç®€å•ï¼Œå®¹æ˜“ç†è§£ |
| **ä¼ä¸šé¡¹ç›®** | Spring Boot + åˆ†å±‚æ¶æ„ | æˆç†Ÿç¨³å®šï¼Œç”Ÿæ€ä¸°å¯Œ |
| **å¤§å‹ç³»ç»Ÿ** | Spring Cloud + å¾®æœåŠ¡ | å¯ç‹¬ç«‹å¼€å‘éƒ¨ç½² |
| **å¤æ‚ä¸šåŠ¡** | Spring + DDD | ä¸šåŠ¡é€»è¾‘æ¸…æ™° |

**ğŸ”§ å®è·µå»ºè®®**

1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆæŒæ¡ä¸‰å±‚æ¶æ„ï¼Œå†å­¦ä¹ å¤æ‚æ¨¡å¼
2. **ç†è§£åŸç†**ï¼šçŸ¥é“ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Œä¸æ˜¯èƒŒæ¨¡æ¿
3. **ç»“åˆå®é™…**ï¼šæ ¹æ®é¡¹ç›®ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ¶æ„
4. **æŒç»­æ¼”è¿›**ï¼šæ¶æ„ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œè¦èƒ½é€‚åº”å˜åŒ–

### 11.4 å¸¸è§è¯¯åŒºä¸é¿å…æ–¹æ³•


**âš ï¸ å¸¸è§è¯¯åŒº**

| è¯¯åŒº | æ­£ç¡®ç†è§£ |
|------|----------|
| **è¿‡åº¦è®¾è®¡** | å°é¡¹ç›®ç”¨å¤æ‚æ¶æ„æ˜¯æµªè´¹ |
| **æ¨¡å¼æ··ç”¨** | ä¸ç†è§£å°±æ··åˆå¤šç§æ¨¡å¼ |
| **æŠ€æœ¯é©±åŠ¨** | ä¸ºäº†ç”¨æ–°æŠ€æœ¯è€Œç”¨æ–°æŠ€æœ¯ |
| **ä¸€æ­¥åˆ°ä½** | æƒ³ä¸€å¼€å§‹å°±è®¾è®¡å®Œç¾æ¶æ„ |

**âœ… é¿å…æ–¹æ³•**
- **ä¸šåŠ¡ä¼˜å…ˆ**ï¼šå…ˆç†è§£ä¸šåŠ¡éœ€æ±‚ï¼Œå†é€‰æ‹©æŠ€æœ¯æ–¹æ¡ˆ
- **æ¸è¿›å¼æ¼”è¿›**ï¼šä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å¢åŠ å¤æ‚æ€§
- **å›¢é˜Ÿèƒ½åŠ›**ï¼šé€‰æ‹©å›¢é˜Ÿèƒ½å¤Ÿé©¾é©­çš„æŠ€æœ¯æ ˆ
- **æŒç»­å­¦ä¹ **ï¼šæ¶æ„èƒ½åŠ›éœ€è¦åœ¨å®è·µä¸­ä¸æ–­æå‡

### 11.5 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š æ¨èå­¦ä¹ é¡ºåº**

```
ç¬¬1é˜¶æ®µï¼šåŸºç¡€æ¶æ„
â”œâ”€â”€ MVCæ¨¡å¼ç†è§£
â”œâ”€â”€ ä¸‰å±‚æ¶æ„å®è·µ
â””â”€â”€ Spring Bootå…¥é—¨

ç¬¬2é˜¶æ®µï¼šä¼ä¸šçº§æ¶æ„  
â”œâ”€â”€ åˆ†å±‚æ¶æ„è®¾è®¡
â”œâ”€â”€ è®¾è®¡æ¨¡å¼åº”ç”¨
â””â”€â”€ Springå…¨å®¶æ¡¶

ç¬¬3é˜¶æ®µï¼šé«˜çº§æ¶æ„
â”œâ”€â”€ å¾®æœåŠ¡æ¶æ„
â”œâ”€â”€ é¢†åŸŸé©±åŠ¨è®¾è®¡
â””â”€â”€ äº‹ä»¶é©±åŠ¨æ¶æ„

ç¬¬4é˜¶æ®µï¼šæ¶æ„æ€ç»´
â”œâ”€â”€ æ¶æ„å†³ç­–èƒ½åŠ›
â”œâ”€â”€ ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
â””â”€â”€ æŠ€æœ¯é€‰å‹èƒ½åŠ›
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**
> æ¶æ„æ¨¡å¼è§£å†³æ–¹æ¡ˆï¼Œåˆ†å±‚è§£è€¦æ˜¯å…³é”®
> ä¸‰å±‚å…­è¾¹å½¢å¾®æœåŠ¡ï¼Œäº‹ä»¶é¢†åŸŸåŠ æ¸…æ´
> ä¸šåŠ¡é©±åŠ¨æŠ€æœ¯é€‰ï¼Œç®€å•å¼€å§‹æ¸å¤æ‚
> æ²¡æœ‰é“¶å¼¹è¦è®°ç‰¢ï¼Œé€‚åˆåœºæ™¯æœ€é‡è¦

---

**ğŸ’¡ æœ€ç»ˆå»ºè®®**

æ¶æ„æ¨¡å¼ä¸æ˜¯æ•™æ¡ï¼Œè€Œæ˜¯è§£å†³é—®é¢˜çš„å·¥å…·ã€‚åœ¨Javaå¼€å‘ä¸­ï¼š

1. **æ–°æ‰‹é˜¶æ®µ**ï¼šä¸“æ³¨å­¦å¥½Spring MVCå’Œä¸‰å±‚æ¶æ„
2. **æˆé•¿é˜¶æ®µ**ï¼šæ·±å…¥ç†è§£åˆ†å±‚æ¶æ„å’Œè®¾è®¡åŸåˆ™  
3. **é«˜çº§é˜¶æ®µ**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»è¿ç”¨å„ç§æ¨¡å¼
4. **æ¶æ„å¸ˆ**ï¼šèƒ½å¤Ÿæƒè¡¡åˆ©å¼Šï¼Œåšå‡ºæœ€é€‚åˆçš„æ¶æ„å†³ç­–

è®°ä½ï¼š**å¥½çš„æ¶æ„æ˜¯ä¸šåŠ¡æˆåŠŸçš„åŸºç¡€ï¼Œè€Œä¸æ˜¯æŠ€æœ¯ç‚«æŠ€çš„èˆå°**ã€‚