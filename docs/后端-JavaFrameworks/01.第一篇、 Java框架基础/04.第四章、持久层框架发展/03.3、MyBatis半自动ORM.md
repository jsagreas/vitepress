---
title: 3ã€MyBatisåŠè‡ªåŠ¨ORM
---
## ğŸ“š ç›®å½•

1. [MyBatisæ˜¯ä»€ä¹ˆï¼Ÿ](#1-MyBatisæ˜¯ä»€ä¹ˆï¼Ÿ)
2. [ä¸ºä»€ä¹ˆå«"åŠè‡ªåŠ¨"ORMï¼Ÿ](#2-ä¸ºä»€ä¹ˆå«"åŠè‡ªåŠ¨"ORMï¼Ÿ)
3. [SQLæ˜ å°„æ¡†æ¶æ ¸å¿ƒæ¦‚å¿µ](#3-SQLæ˜ å°„æ¡†æ¶æ ¸å¿ƒæ¦‚å¿µ)
4. [XMLé…ç½®æ˜ å°„è¯¦è§£](#4-XMLé…ç½®æ˜ å°„è¯¦è§£)
5. [æ³¨è§£æ˜ å°„æ–¹å¼](#5-æ³¨è§£æ˜ å°„æ–¹å¼)
6. [åŠ¨æ€SQLç¥å™¨](#6-åŠ¨æ€SQLç¥å™¨)
7. [ResultMapç»“æœæ˜ å°„](#7-ResultMapç»“æœæ˜ å°„)
8. [ParameterMapå‚æ•°æ˜ å°„](#8-ParameterMapå‚æ•°æ˜ å°„)
9. [æ’ä»¶æœºåˆ¶æ‰©å±•](#9-æ’ä»¶æœºåˆ¶æ‰©å±•)
10. [æ‰¹é‡æ“ä½œä¼˜åŒ–](#10-æ‰¹é‡æ“ä½œä¼˜åŒ–)
11. [ç¼“å­˜æœºåˆ¶æå‡æ€§èƒ½](#11-ç¼“å­˜æœºåˆ¶æå‡æ€§èƒ½)
12. [åˆ†é¡µæ’ä»¶å®ç”¨å·¥å…·](#12-åˆ†é¡µæ’ä»¶å®ç”¨å·¥å…·)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” MyBatisæ˜¯ä»€ä¹ˆï¼Ÿ


### 1.1 é€šä¿—ç†è§£MyBatis


**æŠŠMyBatisæ¯”ä½œç¿»è¯‘å®˜**ï¼š
- ğŸ—£ï¸ **ä½ è¯´ä¸­æ–‡**ï¼šå†™Javaä»£ç è°ƒç”¨æ–¹æ³•
- ğŸ“ **ç¿»è¯‘å®˜å¸®ä½ ç¿»è¯‘**ï¼šMyBatisæŠŠæ–¹æ³•è°ƒç”¨è½¬æ¢æˆSQLè¯­å¥
- ğŸ¯ **æ•°æ®åº“å¬å¾—æ‡‚**ï¼šæ‰§è¡ŒSQLæ“ä½œæ•°æ®åº“
- ğŸ“„ **ç¿»è¯‘ç»“æœç»™ä½ **ï¼šæŠŠæ•°æ®åº“è¿”å›çš„ç»“æœè½¬æ¢æˆJavaå¯¹è±¡

```
ä½ çš„éœ€æ±‚ï¼šæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
    â†“
MyBatisç¿»è¯‘ï¼šSELECT * FROM users  
    â†“
æ•°æ®åº“æ‰§è¡Œï¼šè¿”å›ç”¨æˆ·æ•°æ®
    â†“
MyBatisåŒ…è£…ï¼šè½¬æ¢æˆUserå¯¹è±¡åˆ—è¡¨
```

### 1.2 MyBatisè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ


**ä¼ ç»ŸJDBCçš„ç—›ç‚¹**ï¼š
```java
// ä¼ ç»ŸJDBCå†™æ³• - ç¹çç—›è‹¦
Connection conn = DriverManager.getConnection(url, user, pwd);
String sql = "SELECT * FROM users WHERE age > ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setInt(1, 18);
ResultSet rs = ps.executeQuery();

List<User> users = new ArrayList<>();
while(rs.next()) {
    User user = new User();
    user.setId(rs.getInt("id"));
    user.setName(rs.getString("name"));
    user.setAge(rs.getInt("age"));
    users.add(user);
}
// è¿˜è¦å…³é—­è¿æ¥...
```

**MyBatisçš„ä¼˜é›…æ–¹å¼**ï¼š
```java
// MyBatiså†™æ³• - ç®€æ´ä¼˜é›…
List<User> users = userMapper.findUsersByAge(18);
```

> ğŸ’¡ **æ ¸å¿ƒä»·å€¼**ï¼šMyBatisè®©ä½ ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸ç”¨å†™é‡å¤çš„æ•°æ®åº“æ“ä½œä»£ç 

---

## 2. âš–ï¸ ä¸ºä»€ä¹ˆå«"åŠè‡ªåŠ¨"ORMï¼Ÿ


### 2.1 ä»€ä¹ˆæ˜¯ORMï¼Ÿ


**ORMå…¨ç§°**ï¼šObject-Relational Mappingï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰

**é€šä¿—è§£é‡Š**ï¼š
```
æ•°æ®åº“è¡¨        â†â†’        Javaå¯¹è±¡
usersè¡¨         â†â†’        Userç±»
  idåˆ—          â†â†’        idå±æ€§  
  nameåˆ—        â†â†’        nameå±æ€§
  ageåˆ—         â†â†’        ageå±æ€§
```

å°±åƒç»™æ•°æ®åº“è¡¨å’ŒJavaå¯¹è±¡å½“"çº¢å¨˜"ï¼Œè®©å®ƒä»¬èƒ½äº’ç›¸ç†è§£å¯¹æ–¹ï¼

### 2.2 å…¨è‡ªåŠ¨vsåŠè‡ªåŠ¨å¯¹æ¯”


| ç‰¹æ€§å¯¹æ¯” | **å…¨è‡ªåŠ¨ORMï¼ˆå¦‚Hibernateï¼‰** | **åŠè‡ªåŠ¨ORMï¼ˆMyBatisï¼‰** |
|---------|---------------------------|------------------------|
| ğŸ¯ **SQLç¼–å†™** | `æ¡†æ¶è‡ªåŠ¨ç”ŸæˆSQL` | `éœ€è¦æ‰‹å†™SQLè¯­å¥` |
| ğŸ”§ **å­¦ä¹ éš¾åº¦** | `æ¦‚å¿µå¤æ‚ï¼Œé»‘ç›’æ“ä½œ` | `ç®€å•ç›´è§‚ï¼Œç™½ç›’æ“ä½œ` |
| âš¡ **æ€§èƒ½ä¼˜åŒ–** | `éš¾ä»¥ç²¾ç¡®ä¼˜åŒ–SQL` | `å¯ä»¥ç²¾ç¡®ä¼˜åŒ–æ¯æ¡SQL` |
| ğŸ¨ **çµæ´»æ€§** | `æ¡†æ¶é™åˆ¶è¾ƒå¤š` | `SQLå®Œå…¨å¯æ§` |
| ğŸ“š **é€‚ç”¨åœºæ™¯** | `ç®€å•CRUDæ“ä½œ` | `å¤æ‚æŸ¥è¯¢å’Œæ€§èƒ½è¦æ±‚é«˜` |

### 2.3 åŠè‡ªåŠ¨çš„ä¼˜åŠ¿


**ä¸ºä»€ä¹ˆé€‰æ‹©åŠè‡ªåŠ¨ï¼Ÿ**
- âœ… **å¯æ§æ€§å¼º**ï¼šæ¯æ¡SQLéƒ½åœ¨ä½ æŒæ§ä¹‹ä¸­
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šå¯ä»¥å†™å‡ºé«˜æ€§èƒ½çš„SQL
- âœ… **å­¦ä¹ ç®€å•**ï¼šä¸éœ€è¦å­¦å¤æ‚çš„ORMè¯­æ³•
- âœ… **è°ƒè¯•æ–¹ä¾¿**ï¼šSQLä¸€ç›®äº†ç„¶ï¼Œå®¹æ˜“æ’æŸ¥é—®é¢˜

> âš ï¸ **æ³¨æ„**ï¼šåŠè‡ªåŠ¨æ„å‘³ç€éœ€è¦å†™æ›´å¤šSQLï¼Œä½†æ¢æ¥çš„æ˜¯å®Œå…¨çš„æ§åˆ¶æƒ

---

## 3. ğŸ“‹ SQLæ˜ å°„æ¡†æ¶æ ¸å¿ƒæ¦‚å¿µ


### 3.1 ä»€ä¹ˆæ˜¯SQLæ˜ å°„ï¼Ÿ


**æ˜ å°„çš„æœ¬è´¨**ï¼šå»ºç«‹Javaæ–¹æ³•å’ŒSQLè¯­å¥ä¹‹é—´çš„å¯¹åº”å…³ç³»

```
Javaæ¥å£æ–¹æ³•                    SQLè¯­å¥
getUserById(int id)     â†â†’     SELECT * FROM users WHERE id = #{id}
insertUser(User user)   â†â†’     INSERT INTO users VALUES(...)
updateUser(User user)   â†â†’     UPDATE users SET... WHERE id = #{id}
```

### 3.2 MyBatisæ¶æ„å›¾è§£


```
åº”ç”¨ç¨‹åº
    â†“
SqlSessionï¼ˆä¼šè¯ï¼‰
    â†“
Executorï¼ˆæ‰§è¡Œå™¨ï¼‰
    â†“  
StatementHandlerï¼ˆè¯­å¥å¤„ç†å™¨ï¼‰
    â†“
JDBC
    â†“
æ•°æ®åº“
```

**å„å±‚ä½œç”¨è¯´æ˜**ï¼š
- ğŸ¯ **SqlSession**ï¼šä½ çš„æ“ä½œå…¥å£ï¼Œå°±åƒé“¶è¡ŒæŸœå°
- âš™ï¸ **Executor**ï¼šçœŸæ­£å¹²æ´»çš„ï¼Œæ‰§è¡ŒSQLçš„å·¥äºº
- ğŸ“ **StatementHandler**ï¼šå¤„ç†SQLè¯­å¥çš„ä¸“å®¶
- ğŸ”— **JDBC**ï¼šå’Œæ•°æ®åº“æ²Ÿé€šçš„æ¡¥æ¢

### 3.3 æ ¸å¿ƒç»„ä»¶å…³ç³»


```
é…ç½®æ–‡ä»¶(mybatis-config.xml)
         â†“
    SqlSessionFactory
         â†“
     SqlSession
         â†“
      Mapperæ¥å£ â†’ SQLæ˜ å°„æ–‡ä»¶
```

**ç†è§£è¦ç‚¹**ï¼š
- ğŸ“ **é…ç½®æ–‡ä»¶**ï¼šå‘Šè¯‰MyBatisæ€ä¹ˆè¿æ¥æ•°æ®åº“
- ğŸ­ **SqlSessionFactory**ï¼šç”Ÿäº§SqlSessionçš„å·¥å‚
- ğŸ’¼ **SqlSession**ï¼šä½ çš„å·¥ä½œä¼šè¯
- ğŸ¯ **Mapperæ¥å£**ï¼šå®šä¹‰ä½ è¦åšä»€ä¹ˆæ“ä½œ

---

## 4. ğŸ“„ XMLé…ç½®æ˜ å°„è¯¦è§£


### 4.1 XMLæ˜ å°„æ–‡ä»¶ç»“æ„


```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">
    <!-- è¿™é‡Œå†™å…·ä½“çš„SQLæ˜ å°„ -->
</mapper>
```

**æ–‡ä»¶ç»“æ„è§£æ**ï¼š
- ğŸ·ï¸ **namespace**ï¼šå‘½åç©ºé—´ï¼Œé€šå¸¸æ˜¯Mapperæ¥å£çš„å…¨ç±»å
- ğŸ“ **DOCTYPE**ï¼šå‘Šè¯‰è§£æå™¨è¿™æ˜¯MyBatisçš„æ˜ å°„æ–‡ä»¶

### 4.2 åŸºæœ¬CRUDæ“ä½œæ˜ å°„


**æŸ¥è¯¢æ“ä½œï¼ˆSELECTï¼‰**ï¼š
```xml
<!-- idå¯¹åº”æ¥å£æ–¹æ³•åï¼ŒresultTypeæ˜¯è¿”å›çš„Javaç±»å‹ -->
<select id="getUserById" resultType="User">
    SELECT id, name, age FROM users WHERE id = #{id}
</select>

<!-- æŸ¥è¯¢å¤šä¸ªç»“æœ -->
<select id="getAllUsers" resultType="User">
    SELECT id, name, age FROM users
</select>
```

**æ’å…¥æ“ä½œï¼ˆINSERTï¼‰**ï¼š
```xml
<insert id="insertUser">
    INSERT INTO users(name, age) 
    VALUES(#{name}, #{age})
</insert>

<!-- æ’å…¥å¹¶è¿”å›ä¸»é”® -->
<insert id="insertUserWithId" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO users(name, age) VALUES(#{name}, #{age})
</insert>
```

**æ›´æ–°æ“ä½œï¼ˆUPDATEï¼‰**ï¼š
```xml
<update id="updateUser">
    UPDATE users SET name = #{name}, age = #{age} 
    WHERE id = #{id}
</update>
```

**åˆ é™¤æ“ä½œï¼ˆDELETEï¼‰**ï¼š
```xml
<delete id="deleteUser">
    DELETE FROM users WHERE id = #{id}
</delete>
```

### 4.3 å‚æ•°ä¼ é€’æ–¹å¼


**å•ä¸ªå‚æ•°**ï¼š
```xml
<select id="getUserById" resultType="User">
    SELECT * FROM users WHERE id = #{id}
</select>
```

**å¤šä¸ªå‚æ•°**ï¼š
```xml
<select id="getUserByNameAndAge" resultType="User">
    SELECT * FROM users 
    WHERE name = #{param1} AND age = #{param2}
</select>
```

**å¯¹è±¡å‚æ•°**ï¼š
```xml
<insert id="insertUser">
    INSERT INTO users(name, age) 
    VALUES(#{name}, #{age})
</insert>
```

> ğŸ’¡ **å‚æ•°å ä½ç¬¦è¯´æ˜**ï¼š
> - `#{param}`ï¼šé¢„ç¼–è¯‘å‚æ•°ï¼Œå®‰å…¨é˜²SQLæ³¨å…¥
> - `${param}`ï¼šç›´æ¥å­—ç¬¦ä¸²æ›¿æ¢ï¼Œæœ‰æ³¨å…¥é£é™©

---

## 5. ğŸ·ï¸ æ³¨è§£æ˜ å°„æ–¹å¼


### 5.1 æ³¨è§£vs XMLå¯¹æ¯”


```
XMLæ–¹å¼ï¼šåœ¨å•ç‹¬æ–‡ä»¶ä¸­å†™SQL
æ³¨è§£æ–¹å¼ï¼šç›´æ¥åœ¨æ¥å£æ–¹æ³•ä¸Šå†™SQL
```

**XMLæ–¹å¼**ï¼š
```java
// æ¥å£
public interface UserMapper {
    User getUserById(int id);
}
```

```xml
<!-- XMLæ–‡ä»¶ -->
<select id="getUserById" resultType="User">
    SELECT * FROM users WHERE id = #{id}
</select>
```

**æ³¨è§£æ–¹å¼**ï¼š
```java
public interface UserMapper {
    @Select("SELECT * FROM users WHERE id = #{id}")
    User getUserById(int id);
}
```

### 5.2 å¸¸ç”¨æ³¨è§£è¯¦è§£


**@Select æŸ¥è¯¢æ³¨è§£**ï¼š
```java
// ç®€å•æŸ¥è¯¢
@Select("SELECT * FROM users WHERE id = #{id}")
User getUserById(int id);

// æŸ¥è¯¢åˆ—è¡¨
@Select("SELECT * FROM users WHERE age > #{age}")
List<User> getUsersByAge(int age);
```

**@Insert æ’å…¥æ³¨è§£**ï¼š
```java
// åŸºæœ¬æ’å…¥
@Insert("INSERT INTO users(name, age) VALUES(#{name}, #{age})")
int insertUser(User user);

// æ’å…¥è¿”å›ä¸»é”®
@Insert("INSERT INTO users(name, age) VALUES(#{name}, #{age})")
@Options(useGeneratedKeys = true, keyProperty = "id")
int insertUserWithId(User user);
```

**@Update æ›´æ–°æ³¨è§£**ï¼š
```java
@Update("UPDATE users SET name=#{name}, age=#{age} WHERE id=#{id}")
int updateUser(User user);
```

**@Delete åˆ é™¤æ³¨è§£**ï¼š
```java
@Delete("DELETE FROM users WHERE id = #{id}")
int deleteUser(int id);
```

### 5.3 æ³¨è§£æ˜ å°„çš„é€‰æ‹©å»ºè®®


| åœºæ™¯ | **æ¨èæ–¹å¼** | **åŸå› ** |
|------|------------|----------|
| ğŸ”¸ **ç®€å•SQL** | `æ³¨è§£æ–¹å¼` | `ä»£ç é›†ä¸­ï¼Œä¸€ç›®äº†ç„¶` |
| ğŸ”¸ **å¤æ‚SQL** | `XMLæ–¹å¼` | `æ ¼å¼æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤` |
| ğŸ”¸ **åŠ¨æ€SQL** | `XMLæ–¹å¼` | `æ³¨è§£éš¾ä»¥å¤„ç†å¤æ‚é€»è¾‘` |
| ğŸ”¸ **å›¢é˜Ÿé¡¹ç›®** | `XMLæ–¹å¼` | `ç»Ÿä¸€é£æ ¼ï¼Œä¾¿äºç®¡ç†` |

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šç®€å•æŸ¥è¯¢ç”¨æ³¨è§£ï¼Œå¤æ‚é€»è¾‘ç”¨XML

---

## 6. ğŸ­ åŠ¨æ€SQLç¥å™¨


### 6.1 ä»€ä¹ˆæ˜¯åŠ¨æ€SQLï¼Ÿ


**ä¼ ç»Ÿç—›ç‚¹**ï¼šæ ¹æ®ä¸åŒæ¡ä»¶æ‹¼æ¥ä¸åŒSQLè¯­å¥
```java
// ç—›è‹¦çš„å­—ç¬¦ä¸²æ‹¼æ¥
String sql = "SELECT * FROM users WHERE 1=1";
if(name != null) {
    sql += " AND name = '" + name + "'";
}
if(age != null) {
    sql += " AND age = " + age;
}
```

**MyBatisåŠ¨æ€SQL**ï¼šæ™ºèƒ½æ ¹æ®æ¡ä»¶ç”ŸæˆSQL
```xml
<select id="findUsers" resultType="User">
    SELECT * FROM users
    <where>
        <if test="name != null">
            AND name = #{name}
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
    </where>
</select>
```

### 6.2 æ ¸å¿ƒåŠ¨æ€æ ‡ç­¾è¯¦è§£


**`<if>` æ¡ä»¶åˆ¤æ–­**ï¼š
```xml
<select id="findUsers" resultType="User">
    SELECT * FROM users WHERE 1=1
    <if test="name != null and name != ''">
        AND name LIKE #{name}
    </if>
    <if test="age != null">
        AND age > #{age}
    </if>
</select>
```

**`<where>` æ™ºèƒ½WHEREå­å¥**ï¼š
```xml
<select id="findUsers" resultType="User">
    SELECT * FROM users
    <where>
        <if test="name != null">AND name = #{name}</if>
        <if test="age != null">AND age = #{age}</if>
    </where>
</select>
```
> âœ… **`<where>`çš„æ™ºèƒ½ä¹‹å¤„**ï¼šè‡ªåŠ¨å»é™¤å¤šä½™çš„AND/ORï¼Œå¤„ç†ç©ºæ¡ä»¶

**`<choose>` å¤šåˆ†æ”¯é€‰æ‹©**ï¼š
```xml
<select id="findUsers" resultType="User">
    SELECT * FROM users WHERE
    <choose>
        <when test="name != null">
            name = #{name}
        </when>
        <when test="email != null">
            email = #{email}
        </when>
        <otherwise>
            status = 'active'
        </otherwise>
    </choose>
</select>
```

**`<foreach>` å¾ªç¯å¤„ç†**ï¼š
```xml
<!-- INæŸ¥è¯¢ -->
<select id="findUsersByIds" resultType="User">
    SELECT * FROM users WHERE id IN
    <foreach collection="ids" item="id" open="(" separator="," close=")">
        #{id}
    </foreach>
</select>

<!-- æ‰¹é‡æ’å…¥ -->
<insert id="batchInsert">
    INSERT INTO users(name, age) VALUES
    <foreach collection="users" item="user" separator=",">
        (#{user.name}, #{user.age})
    </foreach>
</insert>
```

### 6.3 åŠ¨æ€SQLå®æˆ˜æ¡ˆä¾‹


**å¤åˆæŸ¥è¯¢æ¡ä»¶**ï¼š
```xml
<select id="searchUsers" resultType="User">
    SELECT * FROM users
    <where>
        <if test="keyword != null and keyword != ''">
            AND (name LIKE CONCAT('%', #{keyword}, '%') 
                 OR email LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        <if test="minAge != null">AND age >= #{minAge}</if>
        <if test="maxAge != null">AND age <= #{maxAge}</if>
        <if test="status != null">AND status = #{status}</if>
    </where>
    <if test="orderBy != null">
        ORDER BY ${orderBy}
    </if>
</select>
```

**åŠ¨æ€æ›´æ–°**ï¼š
```xml
<update id="updateUserSelective">
    UPDATE users
    <set>
        <if test="name != null">name = #{name},</if>
        <if test="age != null">age = #{age},</if>
        <if test="email != null">email = #{email},</if>
    </set>
    WHERE id = #{id}
</update>
```

> ğŸ¯ **åŠ¨æ€SQLçš„ä»·å€¼**ï¼šä¸€ä¸ªæ–¹æ³•åº”å¯¹å¤šç§æŸ¥è¯¢åœºæ™¯ï¼Œé¿å…å†™Nä¸ªé‡å¤æ–¹æ³•

---

## 7. ğŸ¯ ResultMapç»“æœæ˜ å°„


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ResultMapï¼Ÿ


**åœºæ™¯é—®é¢˜**ï¼šæ•°æ®åº“å­—æ®µåå’ŒJavaå±æ€§åä¸ä¸€è‡´
```
æ•°æ®åº“è¡¨ï¼šusers
- user_id    â†’ Java: userId
- user_name  â†’ Java: userName  
- create_time â†’ Java: createTime
```

**è§£å†³æ–¹æ¡ˆå¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|---------|----------|
| `SQLåˆ«å` | `ç®€å•å¿«é€Ÿ` | `æ¯ä¸ªæŸ¥è¯¢éƒ½è¦å†™åˆ«å` |
| `ResultMap` | `ä¸€æ¬¡é…ç½®ï¼Œåˆ°å¤„ä½¿ç”¨` | `éœ€è¦é¢å¤–é…ç½®` |

### 7.2 åŸºç¡€ResultMapé…ç½®


**ç®€å•æ˜ å°„**ï¼š
```xml
<!-- å®šä¹‰ç»“æœæ˜ å°„ -->
<resultMap id="userResultMap" type="User">
    <id column="user_id" property="userId"/>
    <result column="user_name" property="userName"/>
    <result column="create_time" property="createTime"/>
</resultMap>

<!-- ä½¿ç”¨ç»“æœæ˜ å°„ -->
<select id="getUserById" resultMap="userResultMap">
    SELECT user_id, user_name, create_time 
    FROM users WHERE user_id = #{id}
</select>
```

**æ ‡ç­¾è¯´æ˜**ï¼š
- ğŸ”‘ **`<id>`**ï¼šä¸»é”®æ˜ å°„ï¼Œç”¨äºæ€§èƒ½ä¼˜åŒ–
- ğŸ“ **`<result>`**ï¼šæ™®é€šå­—æ®µæ˜ å°„
- ğŸ·ï¸ **column**ï¼šæ•°æ®åº“åˆ—å
- ğŸ¯ **property**ï¼šJavaå±æ€§å

### 7.3 å¤æ‚ResultMapæ˜ å°„


**ä¸€å¯¹ä¸€å…³è”æ˜ å°„**ï¼š
```xml
<!-- ç”¨æˆ·å’Œç”¨æˆ·è¯¦æƒ…çš„ä¸€å¯¹ä¸€å…³ç³» -->
<resultMap id="userWithDetailMap" type="User">
    <id column="user_id" property="userId"/>
    <result column="user_name" property="userName"/>
    
    <!-- å…³è”å¯¹è±¡æ˜ å°„ -->
    <association property="userDetail" javaType="UserDetail">
        <id column="detail_id" property="id"/>
        <result column="address" property="address"/>
        <result column="phone" property="phone"/>
    </association>
</resultMap>
```

**ä¸€å¯¹å¤šé›†åˆæ˜ å°„**ï¼š
```xml
<!-- ç”¨æˆ·å’Œè®¢å•çš„ä¸€å¯¹å¤šå…³ç³» -->
<resultMap id="userWithOrdersMap" type="User">
    <id column="user_id" property="userId"/>
    <result column="user_name" property="userName"/>
    
    <!-- é›†åˆæ˜ å°„ -->
    <collection property="orders" ofType="Order">
        <id column="order_id" property="orderId"/>
        <result column="order_name" property="orderName"/>
        <result column="amount" property="amount"/>
    </collection>
</resultMap>
```

### 7.4 ResultMapæœ€ä½³å®è·µ


**ç»§æ‰¿å¤ç”¨**ï¼š
```xml
<!-- åŸºç¡€æ˜ å°„ -->
<resultMap id="baseUserMap" type="User">
    <id column="user_id" property="userId"/>
    <result column="user_name" property="userName"/>
</resultMap>

<!-- æ‰©å±•æ˜ å°„ -->
<resultMap id="extendedUserMap" type="User" extends="baseUserMap">
    <result column="email" property="email"/>
    <result column="phone" property="phone"/>
</resultMap>
```

**é‰´åˆ«å™¨æ˜ å°„**ï¼š
```xml
<resultMap id="vehicleMap" type="Vehicle">
    <id column="id" property="id"/>
    <discriminator javaType="string" column="vehicle_type">
        <case value="CAR" resultType="Car"/>
        <case value="TRUCK" resultType="Truck"/>
    </discriminator>
</resultMap>
```

> ğŸ’¡ **ä½¿ç”¨å»ºè®®**ï¼šç®€å•æ˜ å°„ç”¨åˆ«åï¼Œå¤æ‚å…³è”ç”¨ResultMap

---

## 8. ğŸ“¥ ParameterMapå‚æ•°æ˜ å°„


### 8.1 å‚æ•°æ˜ å°„æ¦‚è¿°


**ParameterMapçš„ä½œç”¨**ï¼šå®šä¹‰è¾“å…¥å‚æ•°çš„æ˜ å°„å…³ç³»

> âš ï¸ **é‡è¦è¯´æ˜**ï¼šParameterMapåœ¨MyBatis 3.5.0ä¹‹å**å·²è¢«åºŸå¼ƒ**ï¼Œç°åœ¨ä¸»è¦ç”¨å†…è”å‚æ•°

**ç°ä»£å‚æ•°ä¼ é€’æ–¹å¼**ï¼š
```java
// 1. å•ä¸ªå‚æ•°
User getUserById(int id);

// 2. å¤šä¸ªå‚æ•° - ä½¿ç”¨@Paramæ³¨è§£
List<User> findUsers(@Param("name") String name, @Param("age") Integer age);

// 3. å¯¹è±¡å‚æ•°
int insertUser(User user);

// 4. Mapå‚æ•°
List<User> searchUsers(Map<String, Object> params);
```

### 8.2 å‚æ•°å¤„ç†æ–¹å¼è¯¦è§£


**@Paramæ³¨è§£ä½¿ç”¨**ï¼š
```java
public interface UserMapper {
    // æ˜ç¡®æŒ‡å®šå‚æ•°å
    @Select("SELECT * FROM users WHERE name = #{userName} AND age = #{userAge}")
    List<User> findUsers(@Param("userName") String name, @Param("userAge") Integer age);
}
```

**å¯¹è±¡å‚æ•°çš„å±æ€§è®¿é—®**ï¼š
```xml
<insert id="insertUser">
    INSERT INTO users(name, age, email) 
    VALUES(#{name}, #{age}, #{email})
</insert>
```

**Mapå‚æ•°çš„keyè®¿é—®**ï¼š
```xml
<select id="searchUsers" resultType="User">
    SELECT * FROM users 
    WHERE name LIKE #{keyword} 
    AND age BETWEEN #{minAge} AND #{maxAge}
</select>
```

### 8.3 å‚æ•°å¤„ç†æœ€ä½³å®è·µ


**å‚æ•°æ•°é‡å»ºè®®**ï¼š

| å‚æ•°ä¸ªæ•° | **æ¨èæ–¹å¼** | **ç¤ºä¾‹** |
|---------|------------|----------|
| `1ä¸ª` | `ç›´æ¥ä¼ é€’` | `getUserById(int id)` |
| `2-3ä¸ª` | `@Paramæ³¨è§£` | `@Param("name") String name` |
| `4ä¸ªä»¥ä¸Š` | `å°è£…å¯¹è±¡æˆ–Map` | `searchUsers(UserQuery query)` |

**å‚æ•°å¯¹è±¡å°è£…**ï¼š
```java
// æŸ¥è¯¢æ¡ä»¶å¯¹è±¡
public class UserQuery {
    private String name;
    private Integer minAge;
    private Integer maxAge;
    private String status;
    // getter/setter...
}

// æ¥å£æ–¹æ³•
List<User> searchUsers(UserQuery query);
```

> ğŸ¯ **æ ¸å¿ƒç†å¿µ**ï¼šå‚æ•°å°‘ç”¨æ³¨è§£ï¼Œå‚æ•°å¤šç”¨å¯¹è±¡ï¼Œä¿æŒä»£ç æ¸…æ™°

---

## 9. ğŸ”Œ æ’ä»¶æœºåˆ¶æ‰©å±•


### 9.1 MyBatisæ’ä»¶æœºåˆ¶åŸç†


**æ’ä»¶æœ¬è´¨**ï¼šåœ¨SQLæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‹¦æˆªå™¨

**å¯æ‹¦æˆªçš„æ ¸å¿ƒæ¥å£**ï¼š
```
Executor        â†’ æ‰§è¡ŒSQLçš„æ ¸å¿ƒç»„ä»¶
StatementHandler â†’ å¤„ç†SQLè¯­å¥  
ParameterHandler â†’ å¤„ç†å‚æ•°
ResultSetHandler â†’ å¤„ç†ç»“æœé›†
```

**æ‹¦æˆªç‚¹ç¤ºæ„å›¾**ï¼š
```
SQLæ‰§è¡Œæµç¨‹ï¼š
SqlSession â†’ Executor â†’ StatementHandler â†’ JDBC
    â†‘           â†‘            â†‘
  æ’ä»¶1       æ’ä»¶2        æ’ä»¶3
```

### 9.2 è‡ªå®šä¹‰æ’ä»¶å¼€å‘


**åŸºç¡€æ’ä»¶ç»“æ„**ï¼š
```java
@Intercepts({
    @Signature(
        type = Executor.class,
        method = "update", 
        args = {MappedStatement.class, Object.class}
    )
})
public class MyPlugin implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        // å‰ç½®å¤„ç†
        System.out.println("SQLæ‰§è¡Œå‰çš„å¤„ç†");
        
        // æ‰§è¡ŒåŸæ–¹æ³•
        Object result = invocation.proceed();
        
        // åç½®å¤„ç†
        System.out.println("SQLæ‰§è¡Œåçš„å¤„ç†");
        
        return result;
    }
}
```

**æ³¨å†Œæ’ä»¶**ï¼š
```xml
<configuration>
    <plugins>
        <plugin interceptor="com.example.MyPlugin">
            <property name="param1" value="value1"/>
        </plugin>
    </plugins>
</configuration>
```

### 9.3 å¸¸ç”¨æ’ä»¶åº”ç”¨åœºæ™¯


**æ€§èƒ½ç›‘æ§æ’ä»¶**ï¼š
```java
@Intercepts({@Signature(type = Executor.class, method = "query", args = {MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class})})
public class PerformancePlugin implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        long start = System.currentTimeMillis();
        
        Object result = invocation.proceed();
        
        long cost = System.currentTimeMillis() - start;
        if(cost > 1000) {
            System.out.println("æ…¢æŸ¥è¯¢è­¦å‘Šï¼šè€—æ—¶" + cost + "ms");
        }
        
        return result;
    }
}
```

**SQLæ‰“å°æ’ä»¶**ï¼š
```java
@Intercepts({@Signature(type = StatementHandler.class, method = "prepare", args = {Connection.class, Integer.class})})
public class SQLLogPlugin implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        StatementHandler handler = (StatementHandler) invocation.getTarget();
        BoundSql boundSql = handler.getBoundSql();
        
        System.out.println("æ‰§è¡ŒSQLï¼š" + boundSql.getSql());
        
        return invocation.proceed();
    }
}
```

> ğŸ”§ **æ’ä»¶ä½¿ç”¨å»ºè®®**ï¼šæ’ä»¶å¾ˆå¼ºå¤§ï¼Œä½†ä¼šå½±å“æ€§èƒ½ï¼ŒæŒ‰éœ€ä½¿ç”¨

---

## 10. ğŸ“¦ æ‰¹é‡æ“ä½œä¼˜åŒ–


### 10.1 ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡æ“ä½œï¼Ÿ


**æ€§èƒ½å¯¹æ¯”åˆ†æ**ï¼š
```
å•æ¡æ’å…¥1000æ¡æ•°æ®ï¼š
- ç½‘ç»œå¾€è¿”ï¼š1000æ¬¡
- SQLè§£æï¼š1000æ¬¡  
- æ‰§è¡Œæ—¶é—´ï¼šçº¦10ç§’

æ‰¹é‡æ’å…¥1000æ¡æ•°æ®ï¼š
- ç½‘ç»œå¾€è¿”ï¼š1æ¬¡
- SQLè§£æï¼š1æ¬¡
- æ‰§è¡Œæ—¶é—´ï¼šçº¦0.1ç§’
```

**æ€§èƒ½æå‡**ï¼šæ‰¹é‡æ“ä½œå¯ä»¥æå‡**10-100å€**æ€§èƒ½ï¼

### 10.2 æ‰¹é‡æ’å…¥å®ç°æ–¹å¼


**æ–¹å¼ä¸€ï¼šforeachæ‰¹é‡æ’å…¥**ï¼š
```xml
<insert id="batchInsert">
    INSERT INTO users(name, age, email) VALUES
    <foreach collection="users" item="user" separator=",">
        (#{user.name}, #{user.age}, #{user.email})
    </foreach>
</insert>
```

```java
// ä½¿ç”¨æ–¹å¼
List<User> users = Arrays.asList(
    new User("å¼ ä¸‰", 25, "zhang@qq.com"),
    new User("æå››", 30, "li@qq.com")
);
userMapper.batchInsert(users);
```

**æ–¹å¼äºŒï¼šSqlSessionæ‰¹é‡æ¨¡å¼**ï¼š
```java
public void batchInsertUsers(List<User> users) {
    try (SqlSession session = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
        UserMapper mapper = session.getMapper(UserMapper.class);
        
        for (User user : users) {
            mapper.insertUser(user);
        }
        
        session.commit(); // ç»Ÿä¸€æäº¤
    }
}
```

### 10.3 æ‰¹é‡æ“ä½œæœ€ä½³å®è·µ


**æ‰¹é‡å¤§å°æ§åˆ¶**ï¼š
```java
public void batchProcess(List<User> allUsers) {
    int batchSize = 1000; // æ¯æ‰¹å¤„ç†1000æ¡
    
    for (int i = 0; i < allUsers.size(); i += batchSize) {
        int endIndex = Math.min(i + batchSize, allUsers.size());
        List<User> batch = allUsers.subList(i, endIndex);
        
        userMapper.batchInsert(batch);
    }
}
```

**æ‰¹é‡æ“ä½œæ€§èƒ½å¯¹æ¯”**ï¼š

| æ“ä½œæ–¹å¼ | **1000æ¡æ•°æ®** | **10000æ¡æ•°æ®** | **é€‚ç”¨åœºæ™¯** |
|---------|---------------|----------------|-------------|
| `é€æ¡æ“ä½œ` | `10ç§’` | `100ç§’` | `å°‘é‡æ•°æ®` |
| `foreachæ‰¹é‡` | `0.5ç§’` | `2ç§’` | `ä¸­ç­‰æ•°æ®é‡` |
| `BATCHæ¨¡å¼` | `0.3ç§’` | `1.5ç§’` | `å¤§é‡æ•°æ®` |

> âš¡ **æ€§èƒ½å»ºè®®**ï¼šè¶…è¿‡100æ¡æ•°æ®å°±åº”è¯¥è€ƒè™‘æ‰¹é‡æ“ä½œ

---

## 11. ğŸš€ ç¼“å­˜æœºåˆ¶æå‡æ€§èƒ½


### 11.1 MyBatisç¼“å­˜å±‚æ¬¡


**ç¼“å­˜æ¶æ„å›¾**ï¼š
```
åº”ç”¨ç¨‹åº
    â†“
ä¸€çº§ç¼“å­˜(SqlSessionçº§åˆ«)
    â†“  
äºŒçº§ç¼“å­˜(namespaceçº§åˆ«)
    â†“
æ•°æ®åº“
```

**ç¼“å­˜ç”Ÿæ•ˆæµç¨‹**ï¼š
1. ğŸ” **æŸ¥è¯¢è¯·æ±‚**ï¼šåº”ç”¨å‘èµ·æ•°æ®æŸ¥è¯¢
2. ğŸ“‹ **ä¸€çº§ç¼“å­˜**ï¼šå…ˆæ£€æŸ¥SqlSessionç¼“å­˜
3. ğŸ¢ **äºŒçº§ç¼“å­˜**ï¼šå†æ£€æŸ¥namespaceç¼“å­˜  
4. ğŸ’¾ **æ•°æ®åº“æŸ¥è¯¢**ï¼šç¼“å­˜éƒ½æ²¡æœ‰æ‰æŸ¥æ•°æ®åº“

### 11.2 ä¸€çº§ç¼“å­˜è¯¦è§£


**ä¸€çº§ç¼“å­˜ç‰¹ç‚¹**ï¼š
- ğŸ¯ **ä½œç”¨åŸŸ**ï¼šSqlSessionçº§åˆ«ï¼Œé»˜è®¤å¼€å¯
- â±ï¸ **ç”Ÿå‘½å‘¨æœŸ**ï¼šéšSqlSessionåˆ›å»ºå’Œé”€æ¯
- ğŸ”„ **å¤±æ•ˆæ—¶æœº**ï¼šå¢åˆ æ”¹æ“ä½œæˆ–æ‰‹åŠ¨æ¸…é™¤

**ä¸€çº§ç¼“å­˜ç¤ºä¾‹**ï¼š
```java
SqlSession session = sqlSessionFactory.openSession();
UserMapper mapper = session.getMapper(UserMapper.class);

// ç¬¬ä¸€æ¬¡æŸ¥è¯¢ - æŸ¥è¯¢æ•°æ®åº“
User user1 = mapper.getUserById(1);

// ç¬¬äºŒæ¬¡æŸ¥è¯¢ - å‘½ä¸­ä¸€çº§ç¼“å­˜ï¼Œä¸æŸ¥æ•°æ®åº“ï¼
User user2 = mapper.getUserById(1);

System.out.println(user1 == user2); // trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡
```

**ä¸€çº§ç¼“å­˜æ¸…é™¤**ï¼š
```java
// æ–¹å¼1ï¼šå¢åˆ æ”¹æ“ä½œè‡ªåŠ¨æ¸…é™¤
mapper.updateUser(user);

// æ–¹å¼2ï¼šæ‰‹åŠ¨æ¸…é™¤
session.clearCache();

// æ–¹å¼3ï¼šæäº¤äº‹åŠ¡
session.commit();
```

### 11.3 äºŒçº§ç¼“å­˜é…ç½®


**å¼€å¯äºŒçº§ç¼“å­˜**ï¼š
```xml
<!-- mybatis-config.xml -->
<configuration>
    <settings>
        <setting name="cacheEnabled" value="true"/>
    </settings>
</configuration>
```

**Mapperä¸­å¯ç”¨ç¼“å­˜**ï¼š
```xml
<!-- UserMapper.xml -->
<mapper namespace="com.example.mapper.UserMapper">
    <!-- å¯ç”¨äºŒçº§ç¼“å­˜ -->
    <cache eviction="LRU" flushInterval="300000" size="1024" readOnly="true"/>
    
    <select id="getUserById" resultType="User">
        SELECT * FROM users WHERE id = #{id}
    </select>
</mapper>
```

**ç¼“å­˜é…ç½®å‚æ•°**ï¼š

| å±æ€§ | **è¯´æ˜** | **é»˜è®¤å€¼** | **æ¨èå€¼** |
|------|---------|-----------|-----------|
| `eviction` | `æ·˜æ±°ç­–ç•¥` | `LRU` | `LRU/FIFO` |
| `flushInterval` | `åˆ·æ–°é—´éš”(ms)` | `æ— ` | `300000(5åˆ†é’Ÿ)` |
| `size` | `ç¼“å­˜å¤§å°` | `1024` | `æ ¹æ®å†…å­˜è°ƒæ•´` |
| `readOnly` | `åªè¯»æ¨¡å¼` | `false` | `true(æ€§èƒ½æ›´å¥½)` |

### 11.4 ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ


**ç¼“å­˜é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **æŸ¥è¯¢é¢‘ç¹**ï¼šç»å¸¸è¢«æŸ¥è¯¢çš„æ•°æ®
- âœ… **æ›´æ–°å°‘**ï¼šå¾ˆå°‘å‘ç”Ÿå˜åŒ–çš„æ•°æ®
- âœ… **ä¸€è‡´æ€§è¦æ±‚ä¸é«˜**ï¼šå…è®¸çŸ­æš‚æ•°æ®ä¸ä¸€è‡´

**ç¼“å­˜ä½¿ç”¨æ³¨æ„**ï¼š
```java
// æ³¨æ„ï¼šå®ä½“ç±»éœ€è¦å®ç°Serializableæ¥å£
public class User implements Serializable {
    private Integer id;
    private String name;
    // ...
}
```

**å¤šè¡¨æŸ¥è¯¢ç¼“å­˜é—®é¢˜**ï¼š
```xml
<!-- é—®é¢˜ï¼šå…³è”æŸ¥è¯¢çš„ç¼“å­˜å¤±æ•ˆé—®é¢˜ -->
<select id="getUserWithOrders" resultType="UserVO">
    SELECT u.*, o.order_name 
    FROM users u LEFT JOIN orders o ON u.id = o.user_id
    WHERE u.id = #{id}
</select>
```

> âš ï¸ **ç¼“å­˜é™·é˜±**ï¼šå¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œä»»æ„ä¸€ä¸ªè¡¨çš„æ•°æ®å˜åŒ–éƒ½å¯èƒ½å¯¼è‡´ç¼“å­˜æ•°æ®ä¸å‡†ç¡®

---

## 12. ğŸ“– åˆ†é¡µæ’ä»¶å®ç”¨å·¥å…·


### 12.1 ä¸ºä»€ä¹ˆéœ€è¦åˆ†é¡µæ’ä»¶ï¼Ÿ


**å¤§æ•°æ®é‡æŸ¥è¯¢é—®é¢˜**ï¼š
```sql
-- å±é™©æ“ä½œï¼šä¸€æ¬¡æŸ¥è¯¢100ä¸‡æ¡æ•°æ®
SELECT * FROM users; -- å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼

-- å®‰å…¨æ“ä½œï¼šåˆ†é¡µæŸ¥è¯¢
SELECT * FROM users LIMIT 0, 20; -- åªæŸ¥20æ¡
```

**æ‰‹å†™åˆ†é¡µçš„ç—›ç‚¹**ï¼š
- ğŸ˜° **æ¯ä¸ªæŸ¥è¯¢éƒ½è¦å†™LIMIT**
- ğŸ”¢ **æ€»æ•°æŸ¥è¯¢éœ€è¦å•ç‹¬å†™COUNTè¯­å¥**  
- ğŸ’» **ä¸åŒæ•°æ®åº“åˆ†é¡µè¯­æ³•ä¸åŒ**
- ğŸ› **å®¹æ˜“å‡ºç°è®¡ç®—é”™è¯¯**

### 12.2 PageHelperæ’ä»¶ä½¿ç”¨


**å¼•å…¥ä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper-spring-boot-starter</artifactId>
    <version>1.4.6</version>
</dependency>
```

**åŸºç¡€åˆ†é¡µä½¿ç”¨**ï¼š
```java
// è®¾ç½®åˆ†é¡µå‚æ•°ï¼šç¬¬1é¡µï¼Œæ¯é¡µ10æ¡
PageHelper.startPage(1, 10);

// æ­£å¸¸æŸ¥è¯¢ï¼ˆæ’ä»¶ä¼šè‡ªåŠ¨æ·»åŠ åˆ†é¡µSQLï¼‰
List<User> users = userMapper.getAllUsers();

// è·å–åˆ†é¡µä¿¡æ¯
PageInfo<User> pageInfo = new PageInfo<>(users);

System.out.println("æ€»è®°å½•æ•°ï¼š" + pageInfo.getTotal());
System.out.println("æ€»é¡µæ•°ï¼š" + pageInfo.getPages());
System.out.println("å½“å‰é¡µï¼š" + pageInfo.getPageNum());
```

**åˆ†é¡µä¿¡æ¯è¯¦è§£**ï¼š
```java
PageInfo<User> pageInfo = new PageInfo<>(users);

// åŸºç¡€ä¿¡æ¯
pageInfo.getTotal();        // æ€»è®°å½•æ•°
pageInfo.getPages();        // æ€»é¡µæ•°  
pageInfo.getPageNum();      // å½“å‰é¡µç 
pageInfo.getPageSize();     // æ¯é¡µå¤§å°

// å¯¼èˆªä¿¡æ¯
pageInfo.isFirstPage();     // æ˜¯å¦ç¬¬ä¸€é¡µ
pageInfo.isLastPage();      // æ˜¯å¦æœ€åä¸€é¡µ
pageInfo.hasPreviousPage(); // æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
pageInfo.hasNextPage();     // æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ

// é¡µç æ•°ç»„
pageInfo.getNavigatepageNums(); // [1,2,3,4,5] é¡µç å¯¼èˆª
```

### 12.3 åˆ†é¡µæ’ä»¶é«˜çº§ç”¨æ³•


**åˆ†é¡µå‚æ•°å°è£…**ï¼š
```java
public class PageQuery {
    private Integer pageNum = 1;    // é¡µç ï¼Œé»˜è®¤ç¬¬1é¡µ
    private Integer pageSize = 10;  // æ¯é¡µå¤§å°ï¼Œé»˜è®¤10æ¡
    private String orderBy;         // æ’åºå­—æ®µ
    
    // getter/setter...
}

// ä¸šåŠ¡æ–¹æ³•
public PageInfo<User> getUserPage(PageQuery query) {
    PageHelper.startPage(query.getPageNum(), query.getPageSize());
    
    if (StringUtils.hasText(query.getOrderBy())) {
        PageHelper.orderBy(query.getOrderBy());
    }
    
    List<User> users = userMapper.getAllUsers();
    return new PageInfo<>(users);
}
```

**æ¡ä»¶åˆ†é¡µæŸ¥è¯¢**ï¼š
```java
public PageInfo<User> searchUsers(String keyword, int pageNum, int pageSize) {
    PageHelper.startPage(pageNum, pageSize);
    
    // åŠ¨æ€SQLæŸ¥è¯¢
    List<User> users = userMapper.searchUsers(keyword);
    
    return new PageInfo<>(users);
}
```

### 12.4 åˆ†é¡µå®ç°åŸç†


**SQLæ”¹å†™è¿‡ç¨‹**ï¼š
```java
// åŸå§‹SQL
String originalSql = "SELECT * FROM users WHERE age > 18";

// PageHelperè‡ªåŠ¨æ”¹å†™ä¸º
String countSql = "SELECT COUNT(*) FROM (SELECT * FROM users WHERE age > 18) tmp";
String pageSql = "SELECT * FROM users WHERE age > 18 LIMIT ?, ?";
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
PageHelper.startPage() 
    â†“
è®¾ç½®åˆ†é¡µå‚æ•°åˆ°ThreadLocal
    â†“
æ‰§è¡ŒåŸå§‹æŸ¥è¯¢æ–¹æ³•
    â†“
æ’ä»¶æ‹¦æˆªSQLæ‰§è¡Œ
    â†“
1. æ‰§è¡ŒCOUNTæŸ¥è¯¢è·å–æ€»æ•°
2. æ”¹å†™åŸSQLæ·»åŠ LIMIT
3. æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
    â†“
è¿”å›ç»“æœ + åˆ†é¡µä¿¡æ¯
```

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

| åœºæ™¯ | **ä¼˜åŒ–å»ºè®®** | **è¯´æ˜** |
|------|------------|----------|
| `å¤§è¡¨æŸ¥è¯¢` | `é¿å…æ·±åˆ†é¡µ` | `LIMIT 1000000,10 å¾ˆæ…¢` |
| `COUNTæŸ¥è¯¢æ…¢` | `ä½¿ç”¨åˆç†åˆ†é¡µ` | `è€ƒè™‘æ˜¯å¦çœŸéœ€è¦æ€»æ•°` |
| `é¢‘ç¹åˆ†é¡µ` | `ç¼“å­˜æ€»æ•°` | `æ€»æ•°å˜åŒ–ä¸é¢‘ç¹æ—¶ç¼“å­˜` |

> ğŸ¯ **åˆ†é¡µæœ€ä½³å®è·µ**ï¼šåˆç†è®¾ç½®æ¯é¡µå¤§å°ï¼Œé¿å…æ·±åº¦åˆ†é¡µï¼Œå¿…è¦æ—¶ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µ

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 MyBatisæ ¸å¿ƒæ¦‚å¿µå›é¡¾


```
ğŸ¯ MyBatisæœ¬è´¨ï¼šåŠè‡ªåŠ¨SQLæ˜ å°„æ¡†æ¶
ğŸ”§ æ ¸å¿ƒä»·å€¼ï¼šJavaæ–¹æ³•ä¸SQLè¯­å¥æ™ºèƒ½æ˜ å°„
âš–ï¸ åŠè‡ªåŠ¨ä¼˜åŠ¿ï¼šSQLå¯æ§ï¼Œæ€§èƒ½ä¼˜ç§€ï¼Œå­¦ä¹ ç®€å•
ğŸ“‹ æ˜ å°„æ–¹å¼ï¼šXMLé…ç½®æ˜ å°„ + æ³¨è§£æ˜ å°„
```

### 13.2 å…³é”®çŸ¥è¯†ç‚¹æ€»ç»“


**ğŸ”¸ SQLæ˜ å°„æ¡†æ¶**ï¼š
- å»ºç«‹Javaæ–¹æ³•å’ŒSQLè¯­å¥çš„æ¡¥æ¢
- è§£å†³ä¼ ç»ŸJDBCç¹ççš„é—®é¢˜
- æä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£

**ğŸ”¸ XML vs æ³¨è§£æ˜ å°„**ï¼š
- ç®€å•SQLæ¨èæ³¨è§£ï¼Œå¤æ‚SQLç”¨XML
- XMLé€‚åˆå›¢é˜Ÿé¡¹ç›®ï¼Œæ³¨è§£é€‚åˆä¸ªäººå¼€å‘
- åŠ¨æ€SQLå¿…é¡»ä½¿ç”¨XMLæ–¹å¼

**ğŸ”¸ åŠ¨æ€SQLæ ¸å¿ƒ**ï¼š
- `<if>`ï¼šæ¡ä»¶åˆ¤æ–­
- `<where>`ï¼šæ™ºèƒ½WHEREå­å¥  
- `<foreach>`ï¼šå¾ªç¯å¤„ç†
- `<choose>`ï¼šå¤šåˆ†æ”¯é€‰æ‹©

**ğŸ”¸ ResultMapç»“æœæ˜ å°„**ï¼š
- è§£å†³å­—æ®µåä¸åŒ¹é…é—®é¢˜
- æ”¯æŒå¤æ‚å¯¹è±¡å…³è”æ˜ å°„
- æä¾›ç»§æ‰¿å’Œå¤ç”¨æœºåˆ¶

**ğŸ”¸ æ‰¹é‡æ“ä½œ**ï¼š
- foreachæ–¹å¼ï¼šé€‚åˆä¸­ç­‰æ•°æ®é‡
- BATCHæ¨¡å¼ï¼šé€‚åˆå¤§æ•°æ®é‡
- æ€§èƒ½æå‡10-100å€

**ğŸ”¸ ç¼“å­˜æœºåˆ¶**ï¼š
- ä¸€çº§ç¼“å­˜ï¼šSqlSessionçº§åˆ«ï¼Œé»˜è®¤å¼€å¯
- äºŒçº§ç¼“å­˜ï¼šnamespaceçº§åˆ«ï¼Œéœ€æ‰‹åŠ¨å¼€å¯
- é€‚ç”¨äºæŸ¥è¯¢é¢‘ç¹ã€æ›´æ–°å°‘çš„åœºæ™¯

**ğŸ”¸ åˆ†é¡µæ’ä»¶**ï¼š
- PageHelperè‡ªåŠ¨å¤„ç†åˆ†é¡µé€»è¾‘
- æ”¯æŒå¤šç§æ•°æ®åº“åˆ†é¡µè¯­æ³•
- æä¾›ä¸°å¯Œçš„åˆ†é¡µä¿¡æ¯

### 13.3 æœ€ä½³å®è·µå»ºè®®


**ğŸŒŸ å¼€å‘è§„èŒƒ**ï¼š
- ç»Ÿä¸€ä½¿ç”¨XMLæˆ–æ³¨è§£ï¼Œä¸è¦æ··ç”¨
- å¤æ‚æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘åŠ¨æ€SQL
- åˆç†ä½¿ç”¨ResultMapé¿å…é‡å¤æ˜ å°„

**âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼š
- å¤§æ•°æ®é‡æ“ä½œä½¿ç”¨æ‰¹é‡å¤„ç†
- æŸ¥è¯¢é¢‘ç¹çš„æ•°æ®å¼€å¯äºŒçº§ç¼“å­˜
- é¿å…æ·±åº¦åˆ†é¡µï¼Œåˆç†è®¾ç½®åˆ†é¡µå¤§å°

**ğŸ”’ å®‰å…¨æ³¨æ„**ï¼š
- ä½¿ç”¨`#{}`é˜²æ­¢SQLæ³¨å…¥
- è°¨æ…ä½¿ç”¨`${}`ç›´æ¥æ‹¼æ¥
- è¾“å…¥å‚æ•°åšå¿…è¦çš„æ ¡éªŒ

**ğŸ› ï¸ è°ƒè¯•æŠ€å·§**ï¼š
- å¼€å¯SQLæ—¥å¿—æŸ¥çœ‹æ‰§è¡Œè¯­å¥
- ä½¿ç”¨æ’ä»¶ç›‘æ§SQLæ€§èƒ½
- åˆç†ä½¿ç”¨MyBatisç”Ÿæˆå™¨

### 13.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


```
åŸºç¡€å…¥é—¨ï¼š
SQLæ˜ å°„ â†’ åŠ¨æ€SQL â†’ ResultMap

è¿›é˜¶åº”ç”¨ï¼š  
æ‰¹é‡æ“ä½œ â†’ ç¼“å­˜æœºåˆ¶ â†’ åˆ†é¡µæ’ä»¶

é«˜çº§ç‰¹æ€§ï¼š
æ’ä»¶å¼€å‘ â†’ æºç åˆ†æ â†’ æ€§èƒ½è°ƒä¼˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- MyBatisåŠè‡ªåŠ¨ï¼ŒSQLæ˜ å°„æ˜¯æ¡¥æ¢
- XMLæ³¨è§£ä¸¤æ–¹å¼ï¼ŒåŠ¨æ€SQLæ›´çµæ´»  
- ResultMapè§£æ˜ å°„ï¼Œæ‰¹é‡ç¼“å­˜ææ€§èƒ½
- æ’ä»¶åˆ†é¡µå¾ˆå®ç”¨ï¼Œæœ€ä½³å®è·µä¿å®‰å…¨

> ğŸ“ **å­¦ä¹ å»ºè®®**ï¼šMyBatiså…¥é—¨å®¹æ˜“ç²¾é€šéš¾ï¼Œé‡ç‚¹æŒæ¡åŠ¨æ€SQLå’Œæ€§èƒ½ä¼˜åŒ–ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­å¤šç»ƒä¹ ï¼Œé€æ­¥æå‡SQLç¼–å†™å’Œä¼˜åŒ–èƒ½åŠ›ã€‚