---
title: 3ã€Spring MVCå¼€å‘æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•


1. [ä»£ç è§„èŒƒä¸ç¼–ç æ ‡å‡†](#1-ä»£ç è§„èŒƒä¸ç¼–ç æ ‡å‡†)
2. [åˆ†å±‚æ¶æ„è®¾è®¡](#2-åˆ†å±‚æ¶æ„è®¾è®¡)
3. [å¼‚å¸¸å¤„ç†è§„èŒƒ](#3-å¼‚å¸¸å¤„ç†è§„èŒƒ)
4. [æ—¥å¿—è®°å½•è§„èŒƒ](#4-æ—¥å¿—è®°å½•è§„èŒƒ)
5. [é…ç½®ç®¡ç†](#5-é…ç½®ç®¡ç†)
6. [æ€§èƒ½ä¼˜åŒ–å®è·µ](#6-æ€§èƒ½ä¼˜åŒ–å®è·µ)
7. [å¯ç»´æŠ¤æ€§æå‡](#7-å¯ç»´æŠ¤æ€§æå‡)
8. [å›¢é˜Ÿåä½œè§„èŒƒ](#8-å›¢é˜Ÿåä½œè§„èŒƒ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ ä»£ç è§„èŒƒä¸ç¼–ç æ ‡å‡†



### 1.1 ä»€ä¹ˆæ˜¯ä»£ç è§„èŒƒ



**é€šä¿—ç†è§£**ï¼šå°±åƒå†™å­—è¦å·¥æ•´ã€è¯´è¯è¦æ¸…æ¥šä¸€æ ·ï¼Œå†™ä»£ç ä¹Ÿéœ€è¦æœ‰ä¸€å¥—"è¡Œæ–‡è§„çŸ©"ã€‚ä»£ç è§„èŒƒå°±æ˜¯å›¢é˜Ÿçº¦å®šçš„"ä»£ç ä¹¦å†™æ ¼å¼"ï¼Œè®©å¤§å®¶å†™å‡ºæ¥çš„ä»£ç é£æ ¼ç»Ÿä¸€ï¼Œåˆ«äººèƒ½çœ‹æ‡‚ã€‚

```
ç±»æ¯”ç†è§£ï¼š
ğŸ“ å†™ä½œæ–‡æœ‰æ ¼å¼è¦æ±‚ â†’ èµ·æ‰¿è½¬åˆã€æ®µè½åˆ†æ˜
ğŸ’» å†™ä»£ç ä¹Ÿæœ‰è§„èŒƒè¦æ±‚ â†’ å‘½åæ¸…æ™°ã€ç»“æ„åˆç†
```

**ä¸ºä»€ä¹ˆéœ€è¦ä»£ç è§„èŒƒ**ï¼š
- âœ… **å›¢é˜Ÿåä½œ** - 5ä¸ªäººå†™çš„ä»£ç çœ‹èµ·æ¥åƒ1ä¸ªäººå†™çš„
- âœ… **é™ä½ç»´æŠ¤æˆæœ¬** - åŠå¹´åè‡ªå·±ä¹Ÿèƒ½çœ‹æ‡‚è‡ªå·±å†™çš„ä»£ç 
- âœ… **å‡å°‘Bug** - è§„èŒƒçš„ä»£ç ä¸å®¹æ˜“å‡ºé”™
- âœ… **æé«˜æ•ˆç‡** - ä¸ç”¨çŒœåˆ«äººçš„ä»£ç åœ¨å¹²ä»€ä¹ˆ

### 1.2 Controllerå±‚ç¼–ç è§„èŒƒ



**å‘½åè§„èŒƒ**ï¼š

```java
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šç±»åæ¸…æ™°è¡¨è¾¾èŒè´£
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // âœ… æ–¹æ³•åè§åçŸ¥æ„ï¼ŒåŠ¨è¯å¼€å¤´
    public Result getUserById(Long id) { }
    
    public Result createUser(UserDTO dto) { }
    
    public Result updateUser(Long id, UserDTO dto) { }
    
    public Result deleteUser(Long id) { }
}

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå‘½åæ¨¡ç³Šä¸æ¸…
@RestController
public class UC {  // ä»€ä¹ˆæ„æ€ï¼Ÿçœ‹ä¸æ‡‚
    
    public Result get(Long i) { }  // è·å–ä»€ä¹ˆï¼Ÿ
    
    public Result do1(UserDTO d) { }  // å¹²ä»€ä¹ˆï¼Ÿ
}
```

**èŒè´£å•ä¸€åŸåˆ™**ï¼š

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼šä¸€ä¸ªControlleråªè´Ÿè´£ä¸€ç±»ä¸šåŠ¡ï¼Œå°±åƒä¸€ä¸ªæœåŠ¡çª—å£åªåŠä¸€ç§ä¸šåŠ¡

```
ç±»æ¯”ç†è§£ï¼š
ğŸ¦ é“¶è¡Œçª—å£åˆ†å·¥æ˜ç¡®
   â”œâ”€ å­˜å–æ¬¾çª—å£ â†’ åªå¤„ç†å­˜å–æ¬¾
   â”œâ”€ å¼€æˆ·çª—å£ â†’ åªå¤„ç†å¼€æˆ·
   â””â”€ ç†è´¢çª—å£ â†’ åªå¤„ç†ç†è´¢

ğŸ’» Controlleråˆ†å·¥æ˜ç¡®  
   â”œâ”€ UserController â†’ åªå¤„ç†ç”¨æˆ·ç›¸å…³
   â”œâ”€ OrderController â†’ åªå¤„ç†è®¢å•ç›¸å…³
   â””â”€ ProductController â†’ åªå¤„ç†å•†å“ç›¸å…³
```

**ç²¾ç®€Controllerä»£ç **ï¼š

```java
// âœ… å¥½çš„åšæ³•ï¼šControlleråªè´Ÿè´£æ¥æ”¶è¯·æ±‚å’Œè¿”å›å“åº”
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    public Result getUser(@PathVariable Long id) {
        // Controllerä¸å†™ä¸šåŠ¡é€»è¾‘ï¼Œåªåšå‚æ•°æ¥æ”¶å’Œç»“æœè¿”å›
        User user = userService.getUserById(id);
        return Result.success(user);
    }
}

// âŒ ä¸å¥½çš„åšæ³•ï¼šControlleré‡Œå†™äº†å¤ªå¤šä¸šåŠ¡é€»è¾‘
@GetMapping("/{id}")
public Result getUser(@PathVariable Long id) {
    // éªŒè¯é€»è¾‘
    if (id == null || id <= 0) {
        return Result.fail("IDæ— æ•ˆ");
    }
    
    // æŸ¥è¯¢é€»è¾‘
    User user = userMapper.selectById(id);
    
    // æ•°æ®å¤„ç†é€»è¾‘
    if (user != null) {
        user.setPassword(null);  // éšè—å¯†ç 
    }
    
    // ç¼“å­˜é€»è¾‘
    redisTemplate.set("user:" + id, user);
    
    return Result.success(user);
}
```

### 1.3 Serviceå±‚ç¼–ç è§„èŒƒ



**æ¥å£ä¸å®ç°åˆ†ç¦»**ï¼š

> ğŸ“Œ **è®¾è®¡ç†å¿µ**ï¼šå®šä¹‰åšä»€ä¹ˆï¼ˆæ¥å£ï¼‰å’Œæ€ä¹ˆåšï¼ˆå®ç°ç±»ï¼‰è¦åˆ†å¼€

```
æ¥å£ï¼ˆInterfaceï¼‰ â†’ å®šä¹‰"èƒ½åšä»€ä¹ˆ"
    â†“
å®ç°ç±»ï¼ˆImplï¼‰ â†’ å®šä¹‰"æ€ä¹ˆåš"

å¥½å¤„ï¼š
ğŸ”¸ æ–¹ä¾¿æ›¿æ¢å®ç°æ–¹å¼
ğŸ”¸ æ–¹ä¾¿å•å…ƒæµ‹è¯•ï¼ˆå¯ä»¥mockï¼‰
ğŸ”¸ ä»£ç æ›´æ¸…æ™°æ˜“è¯»
```

```java
// å®šä¹‰æ¥å£ï¼šè§„å®šåšä»€ä¹ˆ
public interface UserService {
    User getUserById(Long id);
    void createUser(UserDTO dto);
    void updateUser(Long id, UserDTO dto);
}

// å®ç°ç±»ï¼šè§„å®šæ€ä¹ˆåš
@Service
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public User getUserById(Long id) {
        // å…·ä½“çš„ä¸šåŠ¡å®ç°
        return userMapper.selectById(id);
    }
}
```

**äº‹åŠ¡ç®¡ç†è§„èŒƒ**ï¼š

```java
// âœ… æ­£ç¡®ä½¿ç”¨äº‹åŠ¡æ³¨è§£
@Service
public class OrderServiceImpl implements OrderService {
    
    // æ¶‰åŠæ•°æ®åº“å†™æ“ä½œï¼ŒåŠ äº‹åŠ¡æ³¨è§£
    @Transactional(rollbackFor = Exception.class)
    public void createOrder(OrderDTO dto) {
        // 1. åˆ›å»ºè®¢å•
        orderMapper.insert(order);
        
        // 2. æ‰£å‡åº“å­˜
        productMapper.decreaseStock(dto.getProductId());
        
        // 3. ç”Ÿæˆæ”¯ä»˜å•
        paymentMapper.insert(payment);
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å‡ºé”™ï¼Œè‡ªåŠ¨å›æ»š
    }
    
    // åªè¯»æ“ä½œï¼Œä½¿ç”¨åªè¯»äº‹åŠ¡æé«˜æ€§èƒ½
    @Transactional(readOnly = true)
    public Order getOrderById(Long id) {
        return orderMapper.selectById(id);
    }
}
```

> âš ï¸ **é‡è¦æç¤º**ï¼š`@Transactional` é»˜è®¤åªå›æ»šè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ï¼Œæ£€æŸ¥å¼‚å¸¸ï¼ˆExceptionï¼‰ä¸ä¼šå›æ»šã€‚æ‰€ä»¥è¦åŠ ä¸Š `rollbackFor = Exception.class`

### 1.4 é€šç”¨ç¼–ç è§„èŒƒ



**å¸¸é‡ç®¡ç†**ï¼š

```java
// âŒ ä¸å¥½ï¼šä»£ç é‡Œåˆ°å¤„æ˜¯"é­”æ³•æ•°å­—"
if (user.getStatus() == 1) {  // 1æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
    // ...
}

if (order.getType() == 2) {  // 2åˆæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
    // ...
}

// âœ… å¥½ï¼šç”¨å¸¸é‡ç±»ç®¡ç†
public class UserConstants {
    public static final Integer STATUS_NORMAL = 1;
    public static final Integer STATUS_DISABLED = 0;
}

public class OrderConstants {
    public static final Integer TYPE_ONLINE = 1;
    public static final Integer TYPE_OFFLINE = 2;
}

// ä½¿ç”¨æ—¶ä¸€ç›®äº†ç„¶
if (user.getStatus().equals(UserConstants.STATUS_NORMAL)) {
    // ...
}
```

**æ³¨é‡Šè§„èŒƒ**ï¼š

```java
/**
 * è·å–ç”¨æˆ·è¯¦æƒ…
 * 
 * @param id ç”¨æˆ·ID
 * @return ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸åŒ…å«å¯†ç ï¼‰
 * @throws UserNotFoundException ç”¨æˆ·ä¸å­˜åœ¨æ—¶æŠ›å‡º
 */
public User getUserById(Long id) {
    // å¤æ‚é€»è¾‘éœ€è¦æ³¨é‡Šè¯´æ˜
    // ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ
    User user = userMapper.selectById(id);
    
    if (user == null) {
        throw new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨: " + id);
    }
    
    // å®‰å…¨å¤„ç†ï¼šéšè—æ•æ„Ÿä¿¡æ¯
    user.setPassword(null);
    
    return user;
}
```

---

## 2. ğŸ—ï¸ åˆ†å±‚æ¶æ„è®¾è®¡



### 2.1 ä»€ä¹ˆæ˜¯åˆ†å±‚æ¶æ„



**é€šä¿—ç†è§£**ï¼šå°±åƒç›–æˆ¿å­è¦åˆ†åœ°åŸºã€ä¸»ä½“ã€è£…ä¿®ä¸€æ ·ï¼Œå†™ä»£ç ä¹Ÿè¦åˆ†å±‚æ¬¡ã€‚æ¯ä¸€å±‚åšè‡ªå·±çš„äº‹ï¼Œäº’ä¸å¹²æ‰°ã€‚

```
ç›–æˆ¿å­çš„å±‚æ¬¡ï¼š                    ä»£ç çš„å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è£…ä¿®å±‚    â”‚ â† ç¾è§‚           â”‚ Controllerå±‚ â”‚ â† æ¥æ”¶è¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸»ä½“å±‚    â”‚ â† æ‰¿é‡           â”‚  Serviceå±‚   â”‚ â† ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åœ°åŸºå±‚    â”‚ â† ç¨³å›º           â”‚   Mapperå±‚   â”‚ â† æ•°æ®è®¿é—®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆè¦åˆ†å±‚**ï¼š
- ğŸ¯ **èŒè´£æ¸…æ™°** - æ¯å±‚åªåšè‡ªå·±çš„äº‹
- ğŸ”§ **æ˜“äºç»´æŠ¤** - ä¿®æ”¹æŸå±‚ä¸å½±å“å…¶ä»–å±‚
- ğŸ§ª **æ–¹ä¾¿æµ‹è¯•** - å¯ä»¥å•ç‹¬æµ‹è¯•æŸä¸€å±‚
- ğŸ‘¥ **å›¢é˜Ÿåä½œ** - ä¸åŒäººè´Ÿè´£ä¸åŒå±‚

### 2.2 æ ‡å‡†ä¸‰å±‚æ¶æ„



**æ¶æ„å›¾è§£**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Controller å±‚                â”‚
â”‚  èŒè´£ï¼šæ¥æ”¶è¯·æ±‚ã€å‚æ•°æ ¡éªŒã€è¿”å›å“åº”    â”‚
â”‚  ä¸åšï¼šä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“æ“ä½œ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Service å±‚                  â”‚
â”‚  èŒè´£ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†ã€äº‹åŠ¡æ§åˆ¶         â”‚
â”‚  ä¸åšï¼šæ¥æ”¶HTTPè¯·æ±‚ã€ç›´æ¥æ“ä½œæ•°æ®åº“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Mapper/DAO å±‚              â”‚
â”‚  èŒè´£ï¼šæ•°æ®åº“æ“ä½œã€SQLæ‰§è¡Œ           â”‚
â”‚  ä¸åšï¼šä¸šåŠ¡é€»è¾‘ã€æ•°æ®æ ¡éªŒ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ•°æ®åº“
```

**å®é™…ä»£ç ç¤ºä¾‹**ï¼š

```java
// Controllerå±‚ï¼šåªè´Ÿè´£æ¥æ”¶å’Œè¿”å›
@RestController
@RequestMapping("/api/orders")
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    @PostMapping
    public Result createOrder(@RequestBody OrderDTO dto) {
        // å‚æ•°æ ¡éªŒ
        if (dto == null || dto.getProductId() == null) {
            return Result.fail("å‚æ•°é”™è¯¯");
        }
        
        // è°ƒç”¨Serviceå¤„ç†ä¸šåŠ¡
        orderService.createOrder(dto);
        
        return Result.success("ä¸‹å•æˆåŠŸ");
    }
}

// Serviceå±‚ï¼šè´Ÿè´£ä¸šåŠ¡é€»è¾‘
@Service
public class OrderServiceImpl implements OrderService {
    
    @Autowired
    private OrderMapper orderMapper;
    
    @Autowired
    private ProductMapper productMapper;
    
    @Transactional
    public void createOrder(OrderDTO dto) {
        // ä¸šåŠ¡é€»è¾‘1ï¼šæ£€æŸ¥åº“å­˜
        Product product = productMapper.selectById(dto.getProductId());
        if (product.getStock() < dto.getQuantity()) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // ä¸šåŠ¡é€»è¾‘2ï¼šåˆ›å»ºè®¢å•
        Order order = new Order();
        order.setProductId(dto.getProductId());
        order.setQuantity(dto.getQuantity());
        orderMapper.insert(order);
        
        // ä¸šåŠ¡é€»è¾‘3ï¼šæ‰£å‡åº“å­˜
        productMapper.decreaseStock(dto.getProductId(), dto.getQuantity());
    }
}

// Mapperå±‚ï¼šè´Ÿè´£æ•°æ®åº“æ“ä½œ
@Mapper
public interface OrderMapper {
    void insert(Order order);
    Order selectById(Long id);
}
```

### 2.3 DTOã€VOã€Entityçš„åŒºåˆ«



> ğŸ“š **æ¦‚å¿µè§£é‡Š**ï¼šè¿™ä¸‰ä¸ªéƒ½æ˜¯æ•°æ®å¯¹è±¡ï¼Œä½†ç”¨é€”ä¸åŒ

```
æ•°æ®æµè½¬è¿‡ç¨‹ï¼š

å®¢æˆ·ç«¯ â†’ DTO â†’ Controller â†’ Service â†’ Entity â†’ Mapper â†’ æ•°æ®åº“
         (ä¼ è¾“)              (ä¸šåŠ¡)    (å­˜å‚¨)

æ•°æ®åº“ â†’ Entity â†’ Service â†’ VO â†’ Controller â†’ å®¢æˆ·ç«¯
         (å­˜å‚¨)    (ä¸šåŠ¡)  (å±•ç¤º)
```

**è¯¦ç»†è¯´æ˜**ï¼š

| ç±»å‹ | **å…¨ç§°** | **ç”¨é€”** | **ä¸¾ä¾‹è¯´æ˜** |
|------|---------|---------|------------|
| **DTO** | `Data Transfer Object` | `å‰ç«¯ä¼ ç»™åç«¯çš„æ•°æ®` | `åˆ›å»ºç”¨æˆ·æ—¶å‰ç«¯ä¼ çš„ç”¨æˆ·åã€å¯†ç ` |
| **Entity** | `å®ä½“ç±»` | `æ•°æ®åº“è¡¨çš„æ˜ å°„` | `å¯¹åº”usersè¡¨çš„Javaå¯¹è±¡` |
| **VO** | `View Object` | `åç«¯è¿”å›ç»™å‰ç«¯çš„æ•°æ®` | `ç”¨æˆ·ä¿¡æ¯ä½†ä¸åŒ…å«å¯†ç ` |

```java
// DTOï¼šæ¥æ”¶å‰ç«¯ä¼ æ¥çš„æ•°æ®
public class UserCreateDTO {
    private String username;
    private String password;
    private String email;
    // å‰ç«¯ä¼ ä»€ä¹ˆå­—æ®µï¼ŒDTOå°±æœ‰ä»€ä¹ˆå­—æ®µ
}

// Entityï¼šå¯¹åº”æ•°æ®åº“è¡¨
@TableName("users")
public class User {
    private Long id;
    private String username;
    private String password;
    private String email;
    private Date createTime;
    private Date updateTime;
    // æ•°æ®åº“è¡¨æœ‰ä»€ä¹ˆå­—æ®µï¼ŒEntityå°±æœ‰ä»€ä¹ˆå­—æ®µ
}

// VOï¼šè¿”å›ç»™å‰ç«¯çš„æ•°æ®
public class UserVO {
    private Long id;
    private String username;
    private String email;
    // æ³¨æ„ï¼šæ²¡æœ‰passwordå­—æ®µï¼ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
}
```

**ä¸ºä»€ä¹ˆè¦åˆ†è¿™ä¹ˆç»†**ï¼š

```
åœºæ™¯ç¤ºä¾‹ï¼šç”¨æˆ·æ³¨å†Œ

1. å‰ç«¯æäº¤æ³¨å†Œè¡¨å• â†’ ç”¨UserCreateDTOæ¥æ”¶
   â”œâ”€ åŒ…å«ï¼šusernameã€passwordã€email
   â””â”€ ä¸åŒ…å«ï¼šidã€createTimeï¼ˆè¿™äº›æ˜¯åç«¯ç”Ÿæˆçš„ï¼‰

2. Serviceå±‚å¤„ç†ä¸šåŠ¡ â†’ è½¬æˆUser(Entity)ä¿å­˜
   â”œâ”€ è®¾ç½®idï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
   â”œâ”€ åŠ å¯†password
   â””â”€ è®¾ç½®createTime

3. è¿”å›ç»™å‰ç«¯ â†’ è½¬æˆUserVOè¿”å›
   â”œâ”€ åŒ…å«ï¼šidã€usernameã€email
   â””â”€ ä¸åŒ…å«ï¼špasswordï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
```

### 2.4 ä¾èµ–æ–¹å‘è§„åˆ™



**æ ¸å¿ƒåŸåˆ™**ï¼šä¾èµ–åªèƒ½å•å‘ï¼Œä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸‹å±‚ä¸ä¾èµ–ä¸Šå±‚

```
ä¾èµ–æ–¹å‘å›¾ï¼š

Controller â”€â”€â”€â†’ Service â”€â”€â”€â†’ Mapper
   â†‘                              
   â””â”€â”€â”€â”€â”€â”€â”€â”€ å•å‘ä¾èµ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Controllerå¯ä»¥è°ƒç”¨Service
âœ… Serviceå¯ä»¥è°ƒç”¨Mapper
âŒ Serviceä¸èƒ½è°ƒç”¨Controller
âŒ Mapperä¸èƒ½è°ƒç”¨Service
```

**ä¸ºä»€ä¹ˆè¦è¿™æ ·**ï¼š

```
æ­£å‘ä¾èµ–ï¼ˆâœ…æ­£ç¡®ï¼‰ï¼š
Controlleréœ€è¦ç”¨æˆ·ä¿¡æ¯ â†’ è°ƒç”¨UserServiceè·å–
UserServiceéœ€è¦æŸ¥è¯¢æ•°æ® â†’ è°ƒç”¨UserMapperæŸ¥è¯¢

åå‘ä¾èµ–ï¼ˆâŒé”™è¯¯ï¼‰ï¼š
UserMapperæƒ³è®°å½•æ—¥å¿— â†’ è°ƒç”¨LogServiceï¼Ÿ
è¿™æ ·ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–ï¼Œä»£ç æ··ä¹±ï¼

æ­£ç¡®åšæ³•ï¼š
UserMapperåªè´Ÿè´£æ•°æ®æ“ä½œ
è®°å½•æ—¥å¿—åº”è¯¥åœ¨Serviceå±‚åš
```

---

## 3. âš ï¸ å¼‚å¸¸å¤„ç†è§„èŒƒ



### 3.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†



**é—®é¢˜åœºæ™¯**ï¼š

```java
// âŒ æ¯ä¸ªæ–¹æ³•éƒ½è‡ªå·±å¤„ç†å¼‚å¸¸ï¼Œä»£ç é‡å¤ä¸”æ··ä¹±
@GetMapping("/{id}")
public Result getUser(@PathVariable Long id) {
    try {
        User user = userService.getUserById(id);
        return Result.success(user);
    } catch (UserNotFoundException e) {
        return Result.fail("ç”¨æˆ·ä¸å­˜åœ¨");
    } catch (Exception e) {
        return Result.fail("ç³»ç»Ÿé”™è¯¯");
    }
}

@PostMapping
public Result createUser(@RequestBody UserDTO dto) {
    try {
        userService.createUser(dto);
        return Result.success("åˆ›å»ºæˆåŠŸ");
    } catch (DuplicateUsernameException e) {
        return Result.fail("ç”¨æˆ·åå·²å­˜åœ¨");
    } catch (Exception e) {
        return Result.fail("ç³»ç»Ÿé”™è¯¯");
    }
}
```

**ç»Ÿä¸€å¤„ç†å**ï¼š

```java
// âœ… Controlleråªç®¡æŠ›å¼‚å¸¸ï¼Œä¸ç”¨ç®¡æ€ä¹ˆå¤„ç†
@GetMapping("/{id}")
public Result getUser(@PathVariable Long id) {
    User user = userService.getUserById(id);
    return Result.success(user);
}

@PostMapping
public Result createUser(@RequestBody UserDTO dto) {
    userService.createUser(dto);
    return Result.success("åˆ›å»ºæˆåŠŸ");
}

// å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€å¤„ç†
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(UserNotFoundException.class)
    public Result handleUserNotFound(UserNotFoundException e) {
        return Result.fail(e.getMessage());
    }
    
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        return Result.fail("ç³»ç»Ÿé”™è¯¯");
    }
}
```

### 3.2 è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸



**è®¾è®¡æ€è·¯**ï¼š

```
å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„ï¼š

Exceptionï¼ˆJavaè‡ªå¸¦ï¼‰
    â†“
BusinessExceptionï¼ˆä¸šåŠ¡å¼‚å¸¸åŸºç±»ï¼‰
    â†“
    â”œâ”€ UserNotFoundExceptionï¼ˆç”¨æˆ·ä¸å­˜åœ¨ï¼‰
    â”œâ”€ DuplicateUsernameExceptionï¼ˆç”¨æˆ·åé‡å¤ï¼‰
    â”œâ”€ InsufficientBalanceExceptionï¼ˆä½™é¢ä¸è¶³ï¼‰
    â””â”€ ProductOutOfStockExceptionï¼ˆå•†å“ç¼ºè´§ï¼‰
```

**ä»£ç å®ç°**ï¼š

```java
// ä¸šåŠ¡å¼‚å¸¸åŸºç±»
public class BusinessException extends RuntimeException {
    private Integer code;
    
    public BusinessException(String message) {
        super(message);
        this.code = 500;
    }
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }
    
    public Integer getCode() {
        return code;
    }
}

// å…·ä½“ä¸šåŠ¡å¼‚å¸¸
public class UserNotFoundException extends BusinessException {
    public UserNotFoundException(String message) {
        super(404, message);
    }
}

public class InsufficientBalanceException extends BusinessException {
    public InsufficientBalanceException() {
        super(400, "ä½™é¢ä¸è¶³");
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@Service
public class UserServiceImpl implements UserService {
    
    public User getUserById(Long id) {
        User user = userMapper.selectById(id);
        
        if (user == null) {
            // ç›´æ¥æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸ï¼Œè®©å…¨å±€å¤„ç†å™¨å¤„ç†
            throw new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨ï¼š" + id);
        }
        
        return user;
    }
    
    public void transfer(Long fromId, Long toId, BigDecimal amount) {
        Account from = accountMapper.selectById(fromId);
        
        if (from.getBalance().compareTo(amount) < 0) {
            // ä½™é¢ä¸è¶³ï¼ŒæŠ›å‡ºå¼‚å¸¸
            throw new InsufficientBalanceException();
        }
        
        // è½¬è´¦é€»è¾‘...
    }
}
```

### 3.3 å…¨å±€å¼‚å¸¸å¤„ç†å™¨



```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    /**
     * å¤„ç†ä¸šåŠ¡å¼‚å¸¸
     */
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());
        return Result.fail(e.getCode(), e.getMessage());
    }
    
    /**
     * å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidException(MethodArgumentNotValidException e) {
        // è·å–ç¬¬ä¸€ä¸ªæ ¡éªŒå¤±è´¥çš„é”™è¯¯ä¿¡æ¯
        String message = e.getBindingResult()
            .getFieldError()
            .getDefaultMessage();
        
        log.warn("å‚æ•°æ ¡éªŒå¤±è´¥ï¼š{}", message);
        return Result.fail(400, message);
    }
    
    /**
     * å¤„ç†ç³»ç»Ÿå¼‚å¸¸
     */
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return Result.fail(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

> ğŸ’¡ **å¤„ç†é¡ºåº**ï¼šSpringä¼šæŒ‰ç…§å¼‚å¸¸çš„å…·ä½“ç¨‹åº¦æ¥åŒ¹é…å¤„ç†å™¨ï¼Œè¶Šå…·ä½“çš„å¼‚å¸¸è¶Šå…ˆåŒ¹é…

---

## 4. ğŸ“ æ—¥å¿—è®°å½•è§„èŒƒ



### 4.1 æ—¥å¿—çº§åˆ«çš„æ­£ç¡®ä½¿ç”¨



**æ—¥å¿—çº§åˆ«è¯´æ˜**ï¼š

| çº§åˆ« | **ä½¿ç”¨åœºæ™¯** | **ä¸¾ä¾‹** |
|------|------------|---------|
| **ERROR** | `ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸` | `æ•°æ®åº“è¿æ¥å¤±è´¥ã€ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨å¼‚å¸¸` |
| **WARN** | `è­¦å‘Šä¿¡æ¯ã€æ½œåœ¨é—®é¢˜` | `åº“å­˜ä¸è¶³ã€ç”¨æˆ·ç™»å½•å¤±è´¥` |
| **INFO** | `å…³é”®ä¸šåŠ¡æµç¨‹` | `ç”¨æˆ·ç™»å½•ã€è®¢å•åˆ›å»ºã€æ”¯ä»˜æˆåŠŸ` |
| **DEBUG** | `è°ƒè¯•ä¿¡æ¯` | `æ–¹æ³•å…¥å‚ã€ä¸­é—´å˜é‡å€¼` |

```java
@Service
public class OrderServiceImpl implements OrderService {
    
    private static final Logger log = LoggerFactory.getLogger(OrderServiceImpl.class);
    
    @Transactional
    public void createOrder(OrderDTO dto) {
        // INFOï¼šè®°å½•å…³é”®ä¸šåŠ¡
        log.info("å¼€å§‹åˆ›å»ºè®¢å•ï¼Œç”¨æˆ·IDï¼š{}ï¼Œå•†å“IDï¼š{}", dto.getUserId(), dto.getProductId());
        
        // DEBUGï¼šè®°å½•è¯¦ç»†ä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒä¸ä¼šæ‰“å°ï¼‰
        log.debug("è®¢å•è¯¦æƒ…ï¼š{}", dto);
        
        try {
            // ä¸šåŠ¡é€»è¾‘
            Product product = productMapper.selectById(dto.getProductId());
            
            if (product.getStock() < dto.getQuantity()) {
                // WARNï¼šè®°å½•è­¦å‘Šä¿¡æ¯
                log.warn("å•†å“åº“å­˜ä¸è¶³ï¼Œå•†å“IDï¼š{}ï¼Œå½“å‰åº“å­˜ï¼š{}ï¼Œéœ€è¦ï¼š{}", 
                    dto.getProductId(), product.getStock(), dto.getQuantity());
                throw new ProductOutOfStockException("å•†å“åº“å­˜ä¸è¶³");
            }
            
            orderMapper.insert(order);
            
            // INFOï¼šè®°å½•æˆåŠŸä¿¡æ¯
            log.info("è®¢å•åˆ›å»ºæˆåŠŸï¼Œè®¢å•IDï¼š{}", order.getId());
            
        } catch (Exception e) {
            // ERRORï¼šè®°å½•é”™è¯¯ä¿¡æ¯
            log.error("åˆ›å»ºè®¢å•å¤±è´¥ï¼Œç”¨æˆ·IDï¼š{}", dto.getUserId(), e);
            throw e;
        }
    }
}
```

### 4.2 æ—¥å¿—å†…å®¹è§„èŒƒ



**åº”è¯¥è®°å½•ä»€ä¹ˆ**ï¼š

```java
// âœ… å¥½çš„æ—¥å¿—ï¼šä¿¡æ¯å®Œæ•´ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
log.info("ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œç”¨æˆ·IDï¼š{}ï¼Œç™»å½•IPï¼š{}ï¼Œç™»å½•æ—¶é—´ï¼š{}", 
    userId, ip, LocalDateTime.now());

log.error("è°ƒç”¨æ”¯ä»˜æ¥å£å¤±è´¥ï¼Œè®¢å•å·ï¼š{}ï¼Œé‡‘é¢ï¼š{}ï¼Œé”™è¯¯ä¿¡æ¯ï¼š{}", 
    orderNo, amount, e.getMessage(), e);

// âŒ ä¸å¥½çš„æ—¥å¿—ï¼šä¿¡æ¯ä¸è¶³ï¼Œéš¾ä»¥æ’æŸ¥
log.info("ç™»å½•æˆåŠŸ");  // è°ç™»å½•çš„ï¼Ÿä»€ä¹ˆæ—¶å€™ï¼Ÿ

log.error("å‡ºé”™äº†");  // ä»€ä¹ˆé”™è¯¯ï¼Ÿåœ¨å“ªå‡ºé”™çš„ï¼Ÿ
```

**æ€§èƒ½è€ƒè™‘**ï¼š

```java
// âŒ æ€§èƒ½å·®ï¼šå­—ç¬¦ä¸²æ‹¼æ¥åœ¨æ—¥å¿—å…³é—­æ—¶ä¹Ÿä¼šæ‰§è¡Œ
log.debug("ç”¨æˆ·ä¿¡æ¯ï¼š" + user.toString());

// âœ… æ€§èƒ½å¥½ï¼šä½¿ç”¨å ä½ç¬¦ï¼Œæ—¥å¿—å…³é—­æ—¶ä¸ä¼šæ‰§è¡Œ
log.debug("ç”¨æˆ·ä¿¡æ¯ï¼š{}", user);

// âœ… æ›´å¥½ï¼šå¤æ‚å¯¹è±¡è½¬JSON
log.debug("ç”¨æˆ·ä¿¡æ¯ï¼š{}", JSON.toJSONString(user));
```

### 4.3 æ•æ„Ÿä¿¡æ¯å¤„ç†



> âš ï¸ **å®‰å…¨æç¤º**ï¼šæ—¥å¿—ä¸­ä¸èƒ½è®°å½•å¯†ç ã€èº«ä»½è¯å·ç­‰æ•æ„Ÿä¿¡æ¯

```java
// âŒ å±é™©ï¼šè®°å½•äº†æ•æ„Ÿä¿¡æ¯
log.info("ç”¨æˆ·æ³¨å†Œï¼š{}", userDTO);  // userDTOé‡Œæœ‰å¯†ç ï¼

// âœ… å®‰å…¨ï¼šè¿‡æ»¤æ•æ„Ÿä¿¡æ¯
UserDTO safeDTO = userDTO.clone();
safeDTO.setPassword("******");
log.info("ç”¨æˆ·æ³¨å†Œï¼š{}", safeDTO);

// âœ… æ›´å¥½ï¼šé‡å†™toStringæ–¹æ³•
public class UserDTO {
    private String username;
    private String password;
    
    @Override
    public String toString() {
        return "UserDTO{username='" + username + "', password='******'}";
    }
}
```

---

## 5. âš™ï¸ é…ç½®ç®¡ç†



### 5.1 é…ç½®æ–‡ä»¶ç»„ç»‡



**å¤šç¯å¢ƒé…ç½®**ï¼š

```
é…ç½®æ–‡ä»¶ç»“æ„ï¼š

src/main/resources/
â”œâ”€â”€ application.yml              # ä¸»é…ç½®ï¼ˆå…¬å…±é…ç½®ï¼‰
â”œâ”€â”€ application-dev.yml          # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ application-test.yml         # æµ‹è¯•ç¯å¢ƒ
â””â”€â”€ application-prod.yml         # ç”Ÿäº§ç¯å¢ƒ
```

**ä¸»é…ç½®æ–‡ä»¶**ï¼š

```yaml
# application.yml

spring:
  profiles:
    active: dev  # æ¿€æ´»å“ªä¸ªç¯å¢ƒ
  
#  # å…¬å…±é…ç½®
  application:
    name: user-service

# å…¬å…±æ•°æ®åº“é…ç½®

mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

**ç¯å¢ƒé…ç½®æ–‡ä»¶**ï¼š

```yaml
# application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰

server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test_db
    username: root
    password: root

logging:
  level:
    com.example: debug  # å¼€å‘ç¯å¢ƒç”¨debugçº§åˆ«

---

# application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

server:
  port: 80

spring:
  datasource:
    url: jdbc:mysql://prod-db-server:3306/prod_db
    username: prod_user
    password: ${DB_PASSWORD}  # ä»ç¯å¢ƒå˜é‡è¯»å–

logging:
  level:
    com.example: info  # ç”Ÿäº§ç¯å¢ƒç”¨infoçº§åˆ«
```

### 5.2 é…ç½®ç±»çš„ä½¿ç”¨



**è‡ªå®šä¹‰é…ç½®å±æ€§**ï¼š

```java
// é…ç½®æ–‡ä»¶
# application.yml

app:
  upload:
    path: /data/upload
    max-size: 10485760  # 10MB
    allowed-types:
      - jpg
      - png
      - pdf

// é…ç½®ç±»
@Component
@ConfigurationProperties(prefix = "app.upload")
public class UploadProperties {
    
    private String path;
    private Long maxSize;
    private List<String> allowedTypes;
    
    // getter/setter
}

// ä½¿ç”¨é…ç½®
@Service
public class FileService {
    
    @Autowired
    private UploadProperties uploadProperties;
    
    public void uploadFile(MultipartFile file) {
        // ä½¿ç”¨é…ç½®
        if (file.getSize() > uploadProperties.getMaxSize()) {
            throw new BusinessException("æ–‡ä»¶å¤ªå¤§");
        }
        
        String savePath = uploadProperties.getPath() + "/" + file.getOriginalFilename();
        // ä¿å­˜æ–‡ä»¶...
    }
}
```

### 5.3 æ•æ„Ÿé…ç½®ä¿æŠ¤



**ä¸è¦æŠŠå¯†ç å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ**ï¼š

```yaml
# âŒ ä¸å®‰å…¨ï¼šå¯†ç æ˜æ–‡

spring:
  datasource:
    password: mypassword123

# âœ… å®‰å…¨ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡

spring:
  datasource:
    password: ${DB_PASSWORD}  # ä»ç³»ç»Ÿç¯å¢ƒå˜é‡è¯»å–
```

**JasyptåŠ å¯†æ–¹æ¡ˆ**ï¼š

```xml
<!-- å¼•å…¥ä¾èµ– -->
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.4</version>
</dependency>
```

```yaml
# é…ç½®åŠ å¯†å¯†é’¥

jasypt:
  encryptor:
    password: my-secret-key

# ä½¿ç”¨åŠ å¯†åçš„å¯†ç 

spring:
  datasource:
    password: ENC(encrypted_password_here)
```

---

## 6. ğŸš€ æ€§èƒ½ä¼˜åŒ–å®è·µ



### 6.1 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–



**é¿å…N+1æŸ¥è¯¢é—®é¢˜**ï¼š

```java
// âŒ æ€§èƒ½å·®ï¼šN+1æŸ¥è¯¢
public List<OrderVO> getOrders() {
    List<Order> orders = orderMapper.selectList(null);
    
    for (Order order : orders) {
        // æ¯ä¸ªè®¢å•éƒ½æŸ¥ä¸€æ¬¡ç”¨æˆ·ï¼Œ100ä¸ªè®¢å•å°±æŸ¥100æ¬¡ï¼
        User user = userMapper.selectById(order.getUserId());
        order.setUser(user);
    }
    
    return orders;
}

// âœ… æ€§èƒ½å¥½ï¼šä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰
public List<OrderVO> getOrders() {
    // 1. æŸ¥è¯¢æ‰€æœ‰è®¢å•
    List<Order> orders = orderMapper.selectList(null);
    
    // 2. æå–æ‰€æœ‰ç”¨æˆ·ID
    Set<Long> userIds = orders.stream()
        .map(Order::getUserId)
        .collect(Collectors.toSet());
    
    // 3. ä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    List<User> users = userMapper.selectBatchIds(userIds);
    Map<Long, User> userMap = users.stream()
        .collect(Collectors.toMap(User::getId, u -> u));
    
    // 4. ç»„è£…æ•°æ®
    for (Order order : orders) {
        order.setUser(userMap.get(order.getUserId()));
    }
    
    return orders;
}
```

**åˆ†é¡µæŸ¥è¯¢è§„èŒƒ**ï¼š

```java
// âœ… ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œä¸è¦ä¸€æ¬¡æŸ¥æ‰€æœ‰æ•°æ®
@GetMapping("/list")
public Result getOrders(@RequestParam(defaultValue = "1") Integer page,
                       @RequestParam(defaultValue = "10") Integer size) {
    
    Page<Order> pageParam = new Page<>(page, size);
    Page<Order> result = orderMapper.selectPage(pageParam, null);
    
    return Result.success(result);
}
```

### 6.2 ç¼“å­˜ä½¿ç”¨è§„èŒƒ



**ç¼“å­˜é€‚ç”¨åœºæ™¯**ï¼š

```
é€‚åˆç¼“å­˜çš„æ•°æ®ï¼š
âœ… è¯»å¤šå†™å°‘çš„æ•°æ®ï¼ˆå•†å“ä¿¡æ¯ã€æ–‡ç« å†…å®¹ï¼‰
âœ… è®¡ç®—å¤æ‚çš„æ•°æ®ï¼ˆç»Ÿè®¡æ•°æ®ã€æ’è¡Œæ¦œï¼‰
âœ… ä¸ç»å¸¸å˜åŒ–çš„æ•°æ®ï¼ˆé…ç½®ä¿¡æ¯ã€å­—å…¸æ•°æ®ï¼‰

ä¸é€‚åˆç¼“å­˜çš„æ•°æ®ï¼š
âŒ å®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ï¼ˆåº“å­˜ã€ä½™é¢ï¼‰
âŒ æ•°æ®é‡ç‰¹åˆ«å¤§çš„æ•°æ®ï¼ˆå®Œæ•´æ—¥å¿—ï¼‰
âŒ é¢‘ç¹å˜åŒ–çš„æ•°æ®ï¼ˆç§’æ€å•†å“ï¼‰
```

**ç¼“å­˜å®ç°**ï¼š

```java
@Service
public class ProductServiceImpl implements ProductService {
    
    @Autowired
    private ProductMapper productMapper;
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    public Product getProductById(Long id) {
        String key = "product:" + id;
        
        // 1. å…ˆæŸ¥ç¼“å­˜
        Product product = (Product) redisTemplate.opsForValue().get(key);
        
        if (product != null) {
            return product;  // ç¼“å­˜å‘½ä¸­
        }
        
        // 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        product = productMapper.selectById(id);
        
        if (product != null) {
            // 3. å†™å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
            redisTemplate.opsForValue().set(key, product, 1, TimeUnit.HOURS);
        }
        
        return product;
    }
    
    public void updateProduct(Product product) {
        // 1. æ›´æ–°æ•°æ®åº“
        productMapper.updateById(product);
        
        // 2. åˆ é™¤ç¼“å­˜ï¼ˆä¸‹æ¬¡æŸ¥è¯¢æ—¶é‡æ–°åŠ è½½ï¼‰
        String key = "product:" + product.getId();
        redisTemplate.delete(key);
    }
}
```

**ç¼“å­˜é›ªå´©é¢„é˜²**ï¼š

```java
// é¿å…ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œè®¾ç½®éšæœºè¿‡æœŸæ—¶é—´
int baseTime = 3600;  // 1å°æ—¶
int randomTime = new Random().nextInt(300);  // 0-5åˆ†é’Ÿéšæœº
redisTemplate.opsForValue().set(key, value, baseTime + randomTime, TimeUnit.SECONDS);
```

### 6.3 å¼‚æ­¥å¤„ç†



**é€‚åˆå¼‚æ­¥çš„åœºæ™¯**ï¼š

```
åŒæ­¥å¤„ç†ï¼ˆç”¨æˆ·è¦ç­‰ç»“æœï¼‰ï¼š
â”œâ”€ æŸ¥è¯¢è®¢å•
â”œâ”€ ç™»å½•éªŒè¯
â””â”€ æ”¯ä»˜ç¡®è®¤

å¼‚æ­¥å¤„ç†ï¼ˆç”¨æˆ·ä¸ç”¨ç­‰ï¼‰ï¼š
â”œâ”€ å‘é€é‚®ä»¶
â”œâ”€ å‘é€çŸ­ä¿¡
â”œâ”€ æ•°æ®ç»Ÿè®¡
â””â”€ æ—¥å¿—è®°å½•
```

**å¼‚æ­¥å®ç°**ï¼š

```java
// å¼€å¯å¼‚æ­¥æ”¯æŒ
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean
    public Executor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("async-");
        executor.initialize();
        return executor;
    }
}

// å¼‚æ­¥æ–¹æ³•
@Service
public class NotificationService {
    
    @Async  // å¼‚æ­¥æ‰§è¡Œ
    public void sendEmail(String to, String content) {
        // å‘é€é‚®ä»¶çš„é€»è¾‘...
        // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹
    }
}

// ä½¿ç”¨å¼‚æ­¥
@Service
public class OrderServiceImpl implements OrderService {
    
    @Autowired
    private NotificationService notificationService;
    
    public void createOrder(OrderDTO dto) {
        // 1. åˆ›å»ºè®¢å•ï¼ˆåŒæ­¥ï¼‰
        orderMapper.insert(order);
        
        // 2. å‘é€é‚®ä»¶ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰
        notificationService.sendEmail(user.getEmail(), "è®¢å•åˆ›å»ºæˆåŠŸ");
        
        // 3. ç«‹å³è¿”å›ï¼Œä¸ç­‰é‚®ä»¶å‘é€å®Œæˆ
    }
}
```

---

## 7. ğŸ”§ å¯ç»´æŠ¤æ€§æå‡



### 7.1 ä»£ç å¯è¯»æ€§



**æ–¹æ³•é•¿åº¦æ§åˆ¶**ï¼š

```java
// âŒ ä¸å¥½ï¼šä¸€ä¸ªæ–¹æ³•100è¡Œï¼Œçœ‹ä¸æ‡‚åœ¨å¹²ä»€ä¹ˆ
public void processOrder(OrderDTO dto) {
    // 100è¡Œä»£ç ...
}

// âœ… å¥½ï¼šæ‹†åˆ†æˆå°æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•åšä¸€ä»¶äº‹
public void processOrder(OrderDTO dto) {
    validateOrder(dto);      // éªŒè¯è®¢å•
    checkStock(dto);         // æ£€æŸ¥åº“å­˜
    createOrder(dto);        // åˆ›å»ºè®¢å•
    sendNotification(dto);   // å‘é€é€šçŸ¥
}

private void validateOrder(OrderDTO dto) {
    // è®¢å•éªŒè¯é€»è¾‘
}

private void checkStock(OrderDTO dto) {
    // åº“å­˜æ£€æŸ¥é€»è¾‘
}
```

**é¿å…è¿‡æ·±çš„åµŒå¥—**ï¼š

```java
// âŒ ä¸å¥½ï¼šåµŒå¥—å¤ªæ·±ï¼Œéš¾ä»¥ç†è§£
public void method(User user) {
    if (user != null) {
        if (user.getStatus() == 1) {
            if (user.getBalance() > 0) {
                if (user.getLevel() > 3) {
                    // ä¸šåŠ¡é€»è¾‘
                }
            }
        }
    }
}

// âœ… å¥½ï¼šæå‰è¿”å›ï¼Œå‡å°‘åµŒå¥—
public void method(User user) {
    if (user == null) {
        return;
    }
    
    if (user.getStatus() != 1) {
        return;
    }
    
    if (user.getBalance() <= 0) {
        return;
    }
    
    if (user.getLevel() <= 3) {
        return;
    }
    
    // ä¸šåŠ¡é€»è¾‘
}
```

### 7.2 å•å…ƒæµ‹è¯•è§„èŒƒ



**æµ‹è¯•è¦†ç›–çš„å±‚æ¬¡**ï¼š

```
æµ‹è¯•é‡‘å­—å¡”ï¼š

         /\        å•å…ƒæµ‹è¯•ï¼ˆå¤šï¼‰
        /  \       â”œâ”€ æµ‹è¯•å•ä¸ªæ–¹æ³•
       /____\      â””â”€ å¿«é€Ÿã€ç¨³å®š
      /      \     
     /________\    é›†æˆæµ‹è¯•ï¼ˆä¸­ï¼‰
    /          \   â”œâ”€ æµ‹è¯•å¤šä¸ªç»„ä»¶åä½œ
   /____________\  â””â”€ æ¶‰åŠæ•°æ®åº“ã€å¤–éƒ¨æœåŠ¡
```

**Serviceå±‚å•å…ƒæµ‹è¯•**ï¼š

```java
@SpringBootTest
public class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @MockBean  // Mockæ‰Mapper
    private UserMapper userMapper;
    
    @Test
    public void testGetUserById() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        User mockUser = new User();
        mockUser.setId(1L);
        mockUser.setUsername("test");
        
        // 2. è®¾ç½®Mockè¡Œä¸º
        when(userMapper.selectById(1L)).thenReturn(mockUser);
        
        // 3. æ‰§è¡Œæµ‹è¯•
        User result = userService.getUserById(1L);
        
        // 4. éªŒè¯ç»“æœ
        assertNotNull(result);
        assertEquals("test", result.getUsername());
    }
    
    @Test
    public void testGetUserById_NotFound() {
        // æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨çš„æƒ…å†µ
        when(userMapper.selectById(999L)).thenReturn(null);
        
        // åº”è¯¥æŠ›å‡ºå¼‚å¸¸
        assertThrows(UserNotFoundException.class, () -> {
            userService.getUserById(999L);
        });
    }
}
```

### 7.3 æ–‡æ¡£è§„èŒƒ



**æ¥å£æ–‡æ¡£**ï¼š

```java
// ä½¿ç”¨Swagger/Knife4jç”Ÿæˆæ¥å£æ–‡æ¡£
@RestController
@RequestMapping("/api/users")
@Api(tags = "ç”¨æˆ·ç®¡ç†")
public class UserController {
    
    @GetMapping("/{id}")
    @ApiOperation("æ ¹æ®IDè·å–ç”¨æˆ·")
    @ApiImplicitParam(name = "id", value = "ç”¨æˆ·ID", required = true)
    public Result<UserVO> getUser(@PathVariable Long id) {
        // ...
    }
    
    @PostMapping
    @ApiOperation("åˆ›å»ºç”¨æˆ·")
    public Result createUser(@RequestBody @Validated UserCreateDTO dto) {
        // ...
    }
}
```

**READMEæ–‡æ¡£**ï¼š

```markdown
# ç”¨æˆ·æœåŠ¡


# é¡¹ç›®ä»‹ç»


ç”¨æˆ·ç®¡ç†å¾®æœåŠ¡ï¼Œæä¾›ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ç­‰åŠŸèƒ½

# æŠ€æœ¯æ ˆ


- Spring Boot 2.7.x
- MyBatis-Plus 3.5.x
- Redis
- MySQL 8.0

# å¿«é€Ÿå¼€å§‹



## 1. ç¯å¢ƒè¦æ±‚


- JDK 1.8+
- Maven 3.6+
- MySQL 8.0+
- Redis 6.0+

## 2. å¯åŠ¨æ­¥éª¤


1. å¯¼å…¥æ•°æ®åº“ï¼šæ‰§è¡Œ `docs/init.sql`
2. ä¿®æ”¹é…ç½®ï¼š`application-dev.yml`
3. å¯åŠ¨é¡¹ç›®ï¼š`mvn spring-boot:run`

## 3. è®¿é—®åœ°å€


- æ¥å£æ–‡æ¡£ï¼šhttp://localhost:8080/doc.html
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8080/actuator/health

# é¡¹ç›®ç»“æ„


```

---

## 8. ğŸ‘¥ å›¢é˜Ÿåä½œè§„èŒƒ



### 8.1 Gitä½¿ç”¨è§„èŒƒ



**åˆ†æ”¯ç®¡ç†**ï¼š

```
åˆ†æ”¯ç»“æ„ï¼š

master/main          ç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼ˆåªèƒ½åˆå¹¶ï¼Œä¸èƒ½ç›´æ¥æäº¤ï¼‰
    â†‘
    â””â”€â”€â”€ release     é¢„å‘å¸ƒåˆ†æ”¯
            â†‘
            â””â”€â”€â”€ develop    å¼€å‘åˆ†æ”¯
                    â†‘
                    â””â”€â”€â”€ feature/xxx   åŠŸèƒ½åˆ†æ”¯
                    â””â”€â”€â”€ bugfix/xxx    ä¿®å¤åˆ†æ”¯
```

**æäº¤ä¿¡æ¯è§„èŒƒ**ï¼š

```bash
# åŠŸèƒ½å¼€å‘

git commit -m "feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"

# Bugä¿®å¤

git commit -m "fix: ä¿®å¤è®¢å•é‡‘é¢è®¡ç®—é”™è¯¯"

# æ–‡æ¡£æ›´æ–°

git commit -m "docs: æ›´æ–°APIæ–‡æ¡£"

# ä»£ç é‡æ„

git commit -m "refactor: é‡æ„ç”¨æˆ·æœåŠ¡ä»£ç "

# æ€§èƒ½ä¼˜åŒ–

git commit -m "perf: ä¼˜åŒ–è®¢å•æŸ¥è¯¢æ€§èƒ½"
```

### 8.2 Code Reviewè§„èŒƒ



**Reviewæ£€æŸ¥ç‚¹**ï¼š

```
âœ… ä»£ç è§„èŒƒ
   â”œâ”€ å‘½åæ˜¯å¦æ¸…æ™°
   â”œâ”€ æ³¨é‡Šæ˜¯å¦å®Œæ•´
   â””â”€ æ ¼å¼æ˜¯å¦ç»Ÿä¸€

âœ… ä¸šåŠ¡é€»è¾‘
   â”œâ”€ æ˜¯å¦æ»¡è¶³éœ€æ±‚
   â”œâ”€ è¾¹ç•Œæƒ…å†µæ˜¯å¦è€ƒè™‘
   â””â”€ å¼‚å¸¸å¤„ç†æ˜¯å¦å®Œå–„

âœ… æ€§èƒ½ä¸å®‰å…¨
   â”œâ”€ æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜
   â”œâ”€ æ˜¯å¦æœ‰å®‰å…¨éšæ‚£
   â””â”€ æ•æ„Ÿä¿¡æ¯æ˜¯å¦ä¿æŠ¤
```

### 8.3 å¼€å‘æµç¨‹è§„èŒƒ



**æ ‡å‡†å¼€å‘æµç¨‹**ï¼š

```
éœ€æ±‚ç¡®è®¤
    â†“
åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼ˆfeature/xxxï¼‰
    â†“
å¼€å‘ + è‡ªæµ‹
    â†“
æäº¤ä»£ç  + å•å…ƒæµ‹è¯•
    â†“
Code Review
    â†“
åˆå¹¶åˆ°developåˆ†æ”¯
    â†“
é›†æˆæµ‹è¯•
    â†“
åˆå¹¶åˆ°releaseåˆ†æ”¯
    â†“
é¢„å‘å¸ƒæµ‹è¯•
    â†“
åˆå¹¶åˆ°masteråˆ†æ”¯
    â†“
å‘å¸ƒä¸Šçº¿
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒåŸåˆ™



```
ğŸ¯ ä»£ç è§„èŒƒ
â”œâ”€ å‘½åæ¸…æ™°ï¼šè§åçŸ¥æ„
â”œâ”€ èŒè´£å•ä¸€ï¼šä¸€ä¸ªç±»åšä¸€ä»¶äº‹
â”œâ”€ æ³¨é‡Šå®Œæ•´ï¼šå¤æ‚é€»è¾‘è¦è¯´æ˜
â””â”€ å¸¸é‡ç®¡ç†ï¼šé¿å…é­”æ³•æ•°å­—

ğŸ—ï¸ åˆ†å±‚æ¶æ„
â”œâ”€ Controllerï¼šæ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å“åº”
â”œâ”€ Serviceï¼šä¸šåŠ¡é€»è¾‘ï¼Œäº‹åŠ¡æ§åˆ¶
â”œâ”€ Mapperï¼šæ•°æ®è®¿é—®ï¼ŒSQLæ‰§è¡Œ
â””â”€ ä¾èµ–æ–¹å‘ï¼šå•å‘ä¾èµ–ï¼Œä¸èƒ½åå‘

âš ï¸ å¼‚å¸¸å¤„ç†
â”œâ”€ ç»Ÿä¸€å¤„ç†ï¼šå…¨å±€å¼‚å¸¸å¤„ç†å™¨
â”œâ”€ è‡ªå®šä¹‰å¼‚å¸¸ï¼šä¸šåŠ¡å¼‚å¸¸ç»§æ‰¿ä½“ç³»
â””â”€ æ—¥å¿—è®°å½•ï¼šè®°å½•å…³é”®ä¿¡æ¯

ğŸ“ æ—¥å¿—è§„èŒƒ
â”œâ”€ çº§åˆ«æ­£ç¡®ï¼šERROR/WARN/INFO/DEBUG
â”œâ”€ ä¿¡æ¯å®Œæ•´ï¼šä¾¿äºé—®é¢˜æ’æŸ¥
â””â”€ ä¿æŠ¤æ•æ„Ÿï¼šä¸è®°å½•å¯†ç ç­‰
```

### 9.2 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹



```
ğŸš€ æ•°æ®åº“ä¼˜åŒ–
â”œâ”€ é¿å…N+1æŸ¥è¯¢
â”œâ”€ ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢
â”œâ”€ å»ºç«‹åˆé€‚ç´¢å¼•
â””â”€ æ‰¹é‡æ“ä½œä»£æ›¿å¾ªç¯

ğŸ’¾ ç¼“å­˜ä½¿ç”¨
â”œâ”€ ç¼“å­˜çƒ­ç‚¹æ•°æ®
â”œâ”€ è®¾ç½®è¿‡æœŸæ—¶é—´
â”œâ”€ åŠæ—¶æ›´æ–°ç¼“å­˜
â””â”€ é¢„é˜²ç¼“å­˜é›ªå´©

âš¡ å¼‚æ­¥å¤„ç†
â”œâ”€ å‘é€é‚®ä»¶å¼‚æ­¥
â”œâ”€ æ•°æ®ç»Ÿè®¡å¼‚æ­¥
â””â”€ æ—¥å¿—è®°å½•å¼‚æ­¥
```

### 9.3 å›¢é˜Ÿåä½œè¦ç‚¹



```
ğŸ‘¥ åä½œè§„èŒƒ
â”œâ”€ Gitåˆ†æ”¯ç®¡ç†
â”œâ”€ æäº¤ä¿¡æ¯è§„èŒƒ
â”œâ”€ Code Review
â””â”€ æ–‡æ¡£å®Œå–„

ğŸ”§ å¯ç»´æŠ¤æ€§
â”œâ”€ æ–¹æ³•é•¿åº¦é€‚ä¸­
â”œâ”€ é¿å…æ·±å±‚åµŒå¥—
â”œâ”€ å•å…ƒæµ‹è¯•è¦†ç›–
â””â”€ æ¥å£æ–‡æ¡£å®Œæ•´
```

### 9.4 å®æˆ˜å»ºè®®



> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼š
> - ä»æ¨¡ä»¿å¼€å§‹ï¼Œçœ‹ä¼˜ç§€é¡¹ç›®çš„ä»£ç æ˜¯æ€ä¹ˆå†™çš„
> - éµå®ˆå›¢é˜Ÿè§„èŒƒï¼Œä¸è¦è‡ªå·±å‘æ˜è§„åˆ™
> - å¤šå†™æ³¨é‡Šï¼ŒåŠå¹´åä½ ä¼šæ„Ÿè°¢ç°åœ¨çš„è‡ªå·±
> - å‹¤åšCode Reviewï¼Œæ—¢å¸®åŠ©åˆ«äººä¹Ÿæå‡è‡ªå·±

> âš ï¸ **å¸¸è§è¯¯åŒº**ï¼š
> - ä¸è¦ä¸ºäº†ç‚«æŠ€å†™å¤æ‚ä»£ç ï¼Œç®€å•æ¸…æ™°æœ€é‡è¦
> - ä¸è¦è¿‡åº¦è®¾è®¡ï¼Œæ ¹æ®å®é™…éœ€æ±‚æ¥
> - ä¸è¦å¿½è§†æ€§èƒ½ï¼Œä½†ä¹Ÿä¸è¦è¿‡æ—©ä¼˜åŒ–
> - ä¸è¦å¿˜è®°æµ‹è¯•ï¼Œä»£ç è´¨é‡å¾ˆé‡è¦

**æ ¸å¿ƒè®°å¿†**ï¼š
```
è§„èŒƒä»£ç æ˜“ç»´æŠ¤ï¼Œåˆ†å±‚æ¸…æ™°èŒè´£æ˜
å¼‚å¸¸ç»Ÿä¸€æ—¥å¿—å…¨ï¼Œæ€§èƒ½ä¼˜åŒ–ç¼“å­˜å…ˆ
å›¢é˜Ÿåä½œæ–‡æ¡£é½ï¼ŒæŒç»­æ”¹è¿›è´¨é‡å‡
```