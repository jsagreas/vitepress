---
title: 2ã€APIè®¾è®¡ä¸å¼€å‘è§„èŒƒ
---
## ğŸ“š ç›®å½•


1. [RESTful APIè®¾è®¡åŸåˆ™](#1-restful-apiè®¾è®¡åŸåˆ™)
2. [APIç‰ˆæœ¬æ§åˆ¶ç­–ç•¥](#2-apiç‰ˆæœ¬æ§åˆ¶ç­–ç•¥)
3. [ç»Ÿä¸€å“åº”æ ¼å¼è®¾è®¡](#3-ç»Ÿä¸€å“åº”æ ¼å¼è®¾è®¡)
4. [é”™è¯¯ç è§„èŒƒä½“ç³»](#4-é”™è¯¯ç è§„èŒƒä½“ç³»)
5. [æ¥å£æ–‡æ¡£ç¼–å†™](#5-æ¥å£æ–‡æ¡£ç¼–å†™)
6. [APIæµ‹è¯•è§„èŒƒ](#6-apiæµ‹è¯•è§„èŒƒ)
7. [APIå®‰å…¨è®¾è®¡](#7-apiå®‰å…¨è®¾è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ RESTful APIè®¾è®¡åŸåˆ™



### 1.1 ä»€ä¹ˆæ˜¯RESTful API



**é€šä¿—ç†è§£**ï¼š
RESTå°±åƒæ˜¯ä¸€å¥—"ç½‘ç»œä¸–ç•Œçš„äº¤æµè§„åˆ™"ã€‚æƒ³è±¡ä½ å»é¤å…ç‚¹é¤ï¼š
- ä½ å‘Šè¯‰æœåŠ¡å‘˜"æˆ‘è¦ä¸€ä»½å®«ä¿é¸¡ä¸"ï¼ˆè¯·æ±‚èµ„æºï¼‰
- æœåŠ¡å‘˜ç»™ä½ ç«¯æ¥èœï¼ˆè¿”å›èµ„æºï¼‰
- æ•´ä¸ªè¿‡ç¨‹éµå¾ªé¤å…çš„æœåŠ¡è§„èŒƒï¼ˆRESTè§„èŒƒï¼‰

**ä¸“ä¸šå®šä¹‰**ï¼š
RESTï¼ˆRepresentational State Transferï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç”¨äºè®¾è®¡ç½‘ç»œåº”ç”¨ç¨‹åºçš„æ¥å£ã€‚å®ƒè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å˜å¾—ç®€å•ã€ç»Ÿä¸€ã€æ˜“äºç†è§£ã€‚

### 1.2 RESTfulæ ¸å¿ƒæ¦‚å¿µ



**ğŸ”¸ èµ„æºï¼ˆResourceï¼‰**
```
èµ„æºå°±æ˜¯ä½ è¦æ“ä½œçš„"ä¸œè¥¿"

ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
- ç”¨æˆ·ä¿¡æ¯ â†’ /users
- è®¢å•æ•°æ® â†’ /orders  
- å•†å“åˆ—è¡¨ â†’ /products

ä¸æ˜¯åŠ¨ä½œï¼Œè€Œæ˜¯åè¯ï¼
âŒ é”™è¯¯ï¼š/getUserã€/createOrder
âœ… æ­£ç¡®ï¼š/usersã€/orders
```

**ğŸ”¸ HTTPæ–¹æ³•ï¼ˆåŠ¨ä½œï¼‰**

| HTTPæ–¹æ³• | ä½œç”¨ | ç”Ÿæ´»ç±»æ¯” | APIç¤ºä¾‹ |
|---------|------|---------|---------|
| `GET` | è·å–èµ„æº | çœ‹èœå• | `GET /users/1` æŸ¥è¯¢ç”¨æˆ· |
| `POST` | åˆ›å»ºèµ„æº | ä¸‹è®¢å• | `POST /users` åˆ›å»ºç”¨æˆ· |
| `PUT` | å®Œæ•´æ›´æ–° | æ¢æ•´é“èœ | `PUT /users/1` å®Œæ•´æ›´æ–°ç”¨æˆ· |
| `PATCH` | éƒ¨åˆ†æ›´æ–° | åŠ ç‚¹é…æ–™ | `PATCH /users/1` æ›´æ–°éƒ¨åˆ†å­—æ®µ |
| `DELETE` | åˆ é™¤èµ„æº | é€€èœ | `DELETE /users/1` åˆ é™¤ç”¨æˆ· |

**ğŸ”¸ çŠ¶æ€ç ï¼ˆç»“æœåé¦ˆï¼‰**

```
å¸¸ç”¨çŠ¶æ€ç ï¼š

2xx æˆåŠŸç±»ï¼š
200 OK           - è¯·æ±‚æˆåŠŸï¼Œè¿™æ˜¯ä½ è¦çš„æ•°æ®
201 Created      - åˆ›å»ºæˆåŠŸï¼Œæ–°èµ„æºå·²ç»ç”Ÿæˆ
204 No Content   - æ“ä½œæˆåŠŸï¼Œä½†æ²¡æœ‰è¿”å›å†…å®¹

4xx å®¢æˆ·ç«¯é”™è¯¯ï¼š
400 Bad Request  - ä½ çš„è¯·æ±‚æœ‰é—®é¢˜ï¼ˆå‚æ•°é”™è¯¯ï¼‰
401 Unauthorized - æ²¡ç™»å½•ï¼Œè¯·å…ˆç™»å½•
403 Forbidden    - ç™»å½•äº†ä½†æ²¡æƒé™
404 Not Found    - æ‰¾ä¸åˆ°è¿™ä¸ªèµ„æº

5xx æœåŠ¡å™¨é”™è¯¯ï¼š
500 Internal Server Error - æœåŠ¡å™¨å‡ºé”™äº†
503 Service Unavailable   - æœåŠ¡æš‚æ—¶ä¸å¯ç”¨
```

### 1.3 URLè®¾è®¡è§„èŒƒ



**âœ… å¥½çš„è®¾è®¡**ï¼š
```
èµ„æºå±‚çº§æ¸…æ™°ï¼š
/users                    # ç”¨æˆ·åˆ—è¡¨
/users/123                # ç‰¹å®šç”¨æˆ·
/users/123/orders         # æŸç”¨æˆ·çš„è®¢å•
/users/123/orders/456     # æŸç”¨æˆ·çš„æŸä¸ªè®¢å•

ä½¿ç”¨å¤æ•°åè¯ï¼š
/products  âœ“              # å•†å“åˆ—è¡¨
/product   âœ—              # ä¸æ¨è

å°å†™å­—æ¯+è¿å­—ç¬¦ï¼š
/order-items  âœ“           # è®¢å•é¡¹
/OrderItems   âœ—           # ä¸æ¨è
/order_items  âœ—           # ä¸æ¨è
```

**âŒ å¸¸è§é”™è¯¯**ï¼š
```
1. URLä¸­åŒ…å«åŠ¨è¯ï¼š
   âœ— /getUser?id=123
   âœ“ GET /users/123

2. URLä¸­åŒ…å«æ–‡ä»¶æ‰©å±•åï¼š
   âœ— /users.json
   âœ“ /users (é€šè¿‡Acceptå¤´æŒ‡å®šæ ¼å¼)

3. ç‰ˆæœ¬å·æ”¾åœ¨URLæœ«å°¾ï¼š
   âœ— /users/v1
   âœ“ /v1/users
```

### 1.4 å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·ç®¡ç†API



```java
@RestController
@RequestMapping("/api/v1/users")
public class UserController {
    
    // è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œç­›é€‰ï¼‰
    @GetMapping
    public ResponseEntity<PageResult<User>> listUsers(
            @RequestParam(defaultValue = "1") int page,
            @RequestParam(defaultValue = "10") int size,
            @RequestParam(required = false) String username) {
        // æŸ¥è¯¢é€»è¾‘...
        return ResponseEntity.ok(result);
    }
    
    // è·å–å•ä¸ªç”¨æˆ·
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            return ResponseEntity.notFound().build();
        }
        return ResponseEntity.ok(user);
    }
    
    // åˆ›å»ºç”¨æˆ·
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody @Valid UserDTO dto) {
        User user = userService.create(dto);
        return ResponseEntity
            .status(HttpStatus.CREATED)
            .body(user);
    }
    
    // æ›´æ–°ç”¨æˆ·ï¼ˆå®Œæ•´æ›´æ–°ï¼‰
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(
            @PathVariable Long id,
            @RequestBody @Valid UserDTO dto) {
        User user = userService.update(id, dto);
        return ResponseEntity.ok(user);
    }
    
    // éƒ¨åˆ†æ›´æ–°
    @PatchMapping("/{id}")
    public ResponseEntity<User> patchUser(
            @PathVariable Long id,
            @RequestBody Map<String, Object> updates) {
        User user = userService.patch(id, updates);
        return ResponseEntity.ok(user);
    }
    
    // åˆ é™¤ç”¨æˆ·
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();
    }
}
```

---

## 2. ğŸ”„ APIç‰ˆæœ¬æ§åˆ¶ç­–ç•¥



### 2.1 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶



**å®é™…åœºæ™¯**ï¼š
æƒ³è±¡ä½ å¼€å‘äº†ä¸€ä¸ªç”¨æˆ·æ³¨å†Œæ¥å£ï¼Œæœ€åˆåªéœ€è¦ç”¨æˆ·åå’Œå¯†ç ã€‚åŠå¹´åï¼Œäº§å“è¦æ±‚å¿…é¡»å¡«å†™æ‰‹æœºå·ã€‚å¦‚æœç›´æ¥ä¿®æ”¹åŸæ¥å£ï¼Œæ—§ç‰ˆæœ¬çš„Appç”¨æˆ·å°±ä¼šå‡ºé”™ï¼

**ç‰ˆæœ¬æ§åˆ¶çš„å¥½å¤„**ï¼š
- âœ… æ–°æ—§ç‰ˆæœ¬å¹¶å­˜ï¼Œä¸å½±å“ç°æœ‰ç”¨æˆ·
- âœ… ç»™å®¢æˆ·ç«¯ç•™å‡ºå‡çº§æ—¶é—´
- âœ… å¯ä»¥é€æ­¥æ·˜æ±°è€ç‰ˆæœ¬

### 2.2 å¸¸è§ç‰ˆæœ¬æ§åˆ¶æ–¹å¼



**æ–¹å¼ä¸€ï¼šURLè·¯å¾„ç‰ˆæœ¬ï¼ˆæœ€å¸¸ç”¨ï¼‰**
```
ä¼˜ç‚¹ï¼šç®€å•ç›´è§‚ï¼Œä¸€çœ¼çœ‹å‡ºç‰ˆæœ¬
ç¼ºç‚¹ï¼šURLä¼šå˜åŒ–

ç¤ºä¾‹ï¼š
/api/v1/users
/api/v2/users
/api/v3/users

å®ç°ï¼š
@RestController
@RequestMapping("/api/v1/users")
public class UserV1Controller { }

@RestController
@RequestMapping("/api/v2/users")
public class UserV2Controller { }
```

**æ–¹å¼äºŒï¼šè¯·æ±‚å¤´ç‰ˆæœ¬**
```
ä¼˜ç‚¹ï¼šURLä¿æŒä¸å˜
ç¼ºç‚¹ï¼šä¸å¤Ÿç›´è§‚ï¼Œæµ‹è¯•ç¨éº»çƒ¦

è¯·æ±‚ç¤ºä¾‹ï¼š
GET /api/users
Accept: application/vnd.myapp.v2+json

å®ç°ï¼š
@GetMapping(headers = "API-Version=1")
public ResponseEntity<UserV1> getUserV1() { }

@GetMapping(headers = "API-Version=2")
public ResponseEntity<UserV2> getUserV2() { }
```

**æ–¹å¼ä¸‰ï¼šè¯·æ±‚å‚æ•°ç‰ˆæœ¬**
```
ä¼˜ç‚¹ï¼šçµæ´»ï¼ŒURLä¸å˜
ç¼ºç‚¹ï¼šå¯èƒ½è¢«ç¼“å­˜å½±å“

ç¤ºä¾‹ï¼š
GET /api/users?version=2

å®ç°ï¼š
@GetMapping(params = "version=1")
public ResponseEntity<UserV1> getUserV1() { }
```

### 2.3 ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ



**ç‰ˆæœ¬å·è§„åˆ™**ï¼š
```
ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·

v1.0.0 â†’ v1.1.0 â†’ v2.0.0

â€¢ ä¸»ç‰ˆæœ¬å·(1â†’2)ï¼šä¸å…¼å®¹çš„APIä¿®æ”¹
â€¢ æ¬¡ç‰ˆæœ¬å·(0â†’1)ï¼šå‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
â€¢ ä¿®è®¢å·(0â†’1)ï¼šå‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤

APIé€šå¸¸åªç”¨ä¸»ç‰ˆæœ¬å·ï¼š
/api/v1/users
/api/v2/users
```

**ç‰ˆæœ¬åˆ‡æ¢æµç¨‹**ï¼š
```
é˜¶æ®µ1ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1 æ¥å£ â”‚ â† ç°æœ‰ç”¨æˆ·ç»§ç»­ä½¿ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v2 æ¥å£ â”‚ â† æ–°åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ2ï¼šæ ‡è®°åºŸå¼ƒï¼ˆ3-6ä¸ªæœˆåï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1 æ¥å£ â”‚ â† æ ‡è®°ä¸ºDeprecatedï¼Œä»å¯ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    è¿”å›è­¦å‘Šä¿¡æ¯
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v2 æ¥å£ â”‚ â† ä¸»æ¨ç‰ˆæœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜¶æ®µ3ï¼šå®Œå…¨ä¸‹çº¿ï¼ˆ6-12ä¸ªæœˆåï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v1 æ¥å£ â”‚ â† è¿”å›410 GoneçŠ¶æ€ç 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ v2 æ¥å£ â”‚ â† å”¯ä¸€å¯ç”¨ç‰ˆæœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åºŸå¼ƒæ¥å£æ ‡è®°**ï¼š
```java
@RestController
@RequestMapping("/api/v1/users")
@Deprecated  // æ ‡è®°ä¸ºåºŸå¼ƒ
public class UserV1Controller {
    
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        
        // åœ¨å“åº”å¤´ä¸­æ·»åŠ åºŸå¼ƒè­¦å‘Š
        HttpHeaders headers = new HttpHeaders();
        headers.add("X-API-Deprecated", "true");
        headers.add("X-API-Deprecation-Info", 
            "æ­¤ç‰ˆæœ¬å°†äº2024-12-31ä¸‹çº¿ï¼Œè¯·å‡çº§åˆ°v2");
        
        return ResponseEntity.ok()
            .headers(headers)
            .body(user);
    }
}
```

---

## 3. ğŸ“¦ ç»Ÿä¸€å“åº”æ ¼å¼è®¾è®¡



### 3.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€æ ¼å¼



**é—®é¢˜åœºæ™¯**ï¼š
```
åç«¯Aè¿™æ ·è¿”å›ï¼š
{ "data": {...}, "msg": "æˆåŠŸ" }

åç«¯Bé‚£æ ·è¿”å›ï¼š
{ "result": {...}, "message": "OK" }

å‰ç«¯å¼€å‘äººå‘˜å´©æºƒäº†ï¼šæ¯ä¸ªæ¥å£éƒ½è¦åˆ¤æ–­ä¸åŒçš„å­—æ®µï¼
```

**ç»Ÿä¸€æ ¼å¼çš„å¥½å¤„**ï¼š
- âœ… å‰ç«¯å¤„ç†é€»è¾‘ç»Ÿä¸€ï¼Œå‡å°‘å‡ºé”™
- âœ… ä»£ç å¯å¤ç”¨ï¼Œæé«˜å¼€å‘æ•ˆç‡
- âœ… æ¥å£é£æ ¼ä¸€è‡´ï¼Œä¸“ä¸šæ€§å¼º

### 3.2 æ ‡å‡†å“åº”æ ¼å¼è®¾è®¡



**åŸºç¡€å“åº”ç»“æ„**ï¼š
```java
/**
 * ç»Ÿä¸€å“åº”åŒ…è£…ç±»
 * @param <T> å®é™…æ•°æ®ç±»å‹
 */
public class ApiResponse<T> {
    
    /** çŠ¶æ€ç ï¼š0-æˆåŠŸï¼Œå…¶ä»–-å¤±è´¥ */
    private int code;
    
    /** å“åº”æ¶ˆæ¯ï¼šç»™ç”¨æˆ·çœ‹çš„æç¤º */
    private String message;
    
    /** å®é™…æ•°æ®ï¼šæˆåŠŸæ—¶çš„ä¸šåŠ¡æ•°æ® */
    private T data;
    
    /** æ—¶é—´æˆ³ï¼šä¾¿äºè¿½è¸ªå’Œè°ƒè¯• */
    private long timestamp;
    
    // æ„é€ æ–¹æ³•å’Œå·¥å…·æ–¹æ³•
    public static <T> ApiResponse<T> success(T data) {
        ApiResponse<T> response = new ApiResponse<>();
        response.setCode(0);
        response.setMessage("æ“ä½œæˆåŠŸ");
        response.setData(data);
        response.setTimestamp(System.currentTimeMillis());
        return response;
    }
    
    public static <T> ApiResponse<T> error(int code, String message) {
        ApiResponse<T> response = new ApiResponse<>();
        response.setCode(code);
        response.setMessage(message);
        response.setTimestamp(System.currentTimeMillis());
        return response;
    }
}
```

**ä¸åŒåœºæ™¯çš„å“åº”ç¤ºä¾‹**ï¼š

```
åœºæ™¯1ï¼šæŸ¥è¯¢æˆåŠŸ
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "å¼ ä¸‰",
    "email": "zhangsan@example.com"
  },
  "timestamp": 1695600000000
}

åœºæ™¯2ï¼šåˆ›å»ºæˆåŠŸ
{
  "code": 0,
  "message": "ç”¨æˆ·åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 100,
    "username": "æ–°ç”¨æˆ·"
  },
  "timestamp": 1695600000000
}

åœºæ™¯3ï¼šåˆ é™¤æˆåŠŸï¼ˆæ— è¿”å›æ•°æ®ï¼‰
{
  "code": 0,
  "message": "åˆ é™¤æˆåŠŸ",
  "data": null,
  "timestamp": 1695600000000
}

åœºæ™¯4ï¼šä¸šåŠ¡å¼‚å¸¸
{
  "code": 1001,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null,
  "timestamp": 1695600000000
}

åœºæ™¯5ï¼šå‚æ•°éªŒè¯å¤±è´¥
{
  "code": 400,
  "message": "å‚æ•°éªŒè¯å¤±è´¥",
  "data": {
    "username": "ç”¨æˆ·åä¸èƒ½ä¸ºç©º",
    "email": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
  },
  "timestamp": 1695600000000
}
```

### 3.3 åˆ†é¡µæ•°æ®å“åº”æ ¼å¼



**åˆ†é¡µå“åº”ç»“æ„**ï¼š
```java
/**
 * åˆ†é¡µå“åº”åŒ…è£…ç±»
 */
public class PageResponse<T> {
    /** å½“å‰é¡µæ•°æ®åˆ—è¡¨ */
    private List<T> list;
    
    /** å½“å‰é¡µç ï¼ˆä»1å¼€å§‹ï¼‰ */
    private int pageNum;
    
    /** æ¯é¡µå¤§å° */
    private int pageSize;
    
    /** æ€»è®°å½•æ•° */
    private long total;
    
    /** æ€»é¡µæ•° */
    private int pages;
    
    /** æ˜¯å¦æœ‰ä¸Šä¸€é¡µ */
    private boolean hasPrevious;
    
    /** æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ */
    private boolean hasNext;
}
```

**åˆ†é¡µå“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {"id": 1, "name": "å•†å“1"},
      {"id": 2, "name": "å•†å“2"}
    ],
    "pageNum": 1,
    "pageSize": 10,
    "total": 95,
    "pages": 10,
    "hasPrevious": false,
    "hasNext": true
  },
  "timestamp": 1695600000000
}
```

### 3.4 å…¨å±€å“åº”åŒ…è£…å®ç°



```java
/**
 * å…¨å±€å“åº”å¤„ç†å™¨
 * è‡ªåŠ¨åŒ…è£…æ‰€æœ‰Controllerè¿”å›å€¼
 */
@RestControllerAdvice
public class GlobalResponseHandler implements ResponseBodyAdvice<Object> {
    
    @Override
    public boolean supports(MethodParameter returnType, 
                          Class<? extends HttpMessageConverter<?>> converterType) {
        // å·²ç»æ˜¯ApiResponseç±»å‹çš„ä¸å†åŒ…è£…
        return !returnType.getParameterType().equals(ApiResponse.class);
    }
    
    @Override
    public Object beforeBodyWrite(Object body, 
                                 MethodParameter returnType,
                                 MediaType selectedContentType,
                                 Class<? extends HttpMessageConverter<?>> selectedConverterType,
                                 ServerHttpRequest request,
                                 ServerHttpResponse response) {
        
        // Stringç±»å‹ç‰¹æ®Šå¤„ç†ï¼ˆé¿å…åºåˆ—åŒ–é—®é¢˜ï¼‰
        if (body instanceof String) {
            return ApiResponse.success(body);
        }
        
        // å…¶ä»–ç±»å‹ç»Ÿä¸€åŒ…è£…
        return ApiResponse.success(body);
    }
}
```

**ä½¿ç”¨æ•ˆæœ**ï¼š
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    // ç›´æ¥è¿”å›Userå¯¹è±¡ï¼Œä¼šè‡ªåŠ¨åŒ…è£…æˆApiResponse
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    // æœ€ç»ˆè¿”å›ç»™å‰ç«¯ï¼š
    // {
    //   "code": 0,
    //   "message": "æ“ä½œæˆåŠŸ",
    //   "data": { "id": 1, "username": "å¼ ä¸‰" },
    //   "timestamp": 1695600000000
    // }
}
```

---

## 4. âš ï¸ é”™è¯¯ç è§„èŒƒä½“ç³»



### 4.1 é”™è¯¯ç è®¾è®¡åŸåˆ™



**ä»€ä¹ˆæ˜¯é”™è¯¯ç **ï¼Ÿ
é”™è¯¯ç å°±åƒæ˜¯"é”™è¯¯çš„èº«ä»½è¯å·"ï¼Œæ¯ä¸€ç§é”™è¯¯éƒ½æœ‰å”¯ä¸€çš„ç¼–å·ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½é—®é¢˜ã€‚

**è®¾è®¡åŸåˆ™**ï¼š
```
1. å”¯ä¸€æ€§ï¼šä¸€ä¸ªé”™è¯¯ç å¯¹åº”ä¸€ç§é”™è¯¯
2. å¯è¯»æ€§ï¼šä»ç¼–å·èƒ½å¤§è‡´åˆ¤æ–­é”™è¯¯ç±»å‹
3. åˆ†ç±»æ€§ï¼šç›¸åŒç±»å‹é”™è¯¯ç¼–å·ç›¸è¿‘
4. å¯æ‰©å±•ï¼šé¢„ç•™è¶³å¤Ÿçš„ç¼–å·ç©ºé—´
```

### 4.2 é”™è¯¯ç åˆ†ç±»ä¸è§„åˆ™



**é”™è¯¯ç ç»“æ„**ï¼š
```
é”™è¯¯ç æ ¼å¼ï¼šABCCC

Aï¼šé”™è¯¯çº§åˆ«ï¼ˆ1ä½ï¼‰
  1 - ç³»ç»Ÿçº§é”™è¯¯
  2 - ä¸šåŠ¡çº§é”™è¯¯
  3 - ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯

Bï¼šæ¨¡å—ä»£ç ï¼ˆ1ä½ï¼‰
  0 - é€šç”¨
  1 - ç”¨æˆ·æ¨¡å—
  2 - è®¢å•æ¨¡å—
  3 - å•†å“æ¨¡å—
  ...

CCCï¼šå…·ä½“é”™è¯¯ï¼ˆ3ä½ï¼‰
  001-999 å…·ä½“é”™è¯¯åœºæ™¯

ç¤ºä¾‹ï¼š
10001 - ç³»ç»Ÿçº§é€šç”¨é”™è¯¯ï¼šå‚æ•°æ ¡éªŒå¤±è´¥
21001 - ä¸šåŠ¡çº§ç”¨æˆ·æ¨¡å—ï¼šç”¨æˆ·åå·²å­˜åœ¨
22001 - ä¸šåŠ¡çº§è®¢å•æ¨¡å—ï¼šè®¢å•ä¸å­˜åœ¨
31001 - ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¨¡å—ï¼šæ”¯ä»˜æ¥å£è¶…æ—¶
```

**é”™è¯¯ç æšä¸¾å®šä¹‰**ï¼š
```java
/**
 * é”™è¯¯ç æšä¸¾
 */
public enum ErrorCode {
    
    // ç³»ç»Ÿçº§é€šç”¨é”™è¯¯ (10xxx)
    SUCCESS(0, "æ“ä½œæˆåŠŸ"),
    PARAM_ERROR(10001, "å‚æ•°æ ¡éªŒå¤±è´¥"),
    SYSTEM_ERROR(10002, "ç³»ç»Ÿå¼‚å¸¸"),
    UNAUTHORIZED(10003, "æœªæˆæƒè®¿é—®"),
    FORBIDDEN(10004, "æ— è®¿é—®æƒé™"),
    NOT_FOUND(10005, "èµ„æºä¸å­˜åœ¨"),
    
    // ç”¨æˆ·æ¨¡å—é”™è¯¯ (21xxx)
    USER_NOT_FOUND(21001, "ç”¨æˆ·ä¸å­˜åœ¨"),
    USERNAME_EXIST(21002, "ç”¨æˆ·åå·²å­˜åœ¨"),
    EMAIL_EXIST(21003, "é‚®ç®±å·²è¢«æ³¨å†Œ"),
    PASSWORD_ERROR(21004, "å¯†ç é”™è¯¯"),
    ACCOUNT_DISABLED(21005, "è´¦å·å·²è¢«ç¦ç”¨"),
    
    // è®¢å•æ¨¡å—é”™è¯¯ (22xxx)
    ORDER_NOT_FOUND(22001, "è®¢å•ä¸å­˜åœ¨"),
    ORDER_EXPIRED(22002, "è®¢å•å·²è¿‡æœŸ"),
    ORDER_PAID(22003, "è®¢å•å·²æ”¯ä»˜"),
    STOCK_INSUFFICIENT(22004, "åº“å­˜ä¸è¶³"),
    
    // ç¬¬ä¸‰æ–¹æœåŠ¡é”™è¯¯ (31xxx)
    PAYMENT_TIMEOUT(31001, "æ”¯ä»˜æ¥å£è¶…æ—¶"),
    SMS_SEND_FAILED(31002, "çŸ­ä¿¡å‘é€å¤±è´¥"),
    ;
    
    private final int code;
    private final String message;
    
    ErrorCode(int code, String message) {
        this.code = code;
        this.message = message;
    }
    
    // getteræ–¹æ³•...
}
```

### 4.3 é”™è¯¯å“åº”å®æˆ˜



**ä¸šåŠ¡å¼‚å¸¸ç±»**ï¼š
```java
/**
 * ä¸šåŠ¡å¼‚å¸¸ç±»
 */
public class BusinessException extends RuntimeException {
    private final ErrorCode errorCode;
    private final String customMessage;
    
    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
        this.customMessage = null;
    }
    
    public BusinessException(ErrorCode errorCode, String customMessage) {
        super(customMessage);
        this.errorCode = errorCode;
        this.customMessage = customMessage;
    }
    
    // getteræ–¹æ³•...
}
```

**å…¨å±€å¼‚å¸¸å¤„ç†å™¨**ï¼š
```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ResponseEntity<ApiResponse<Void>> handleBusinessException(
            BusinessException e) {
        
        String message = e.getCustomMessage() != null 
            ? e.getCustomMessage() 
            : e.getErrorCode().getMessage();
            
        ApiResponse<Void> response = ApiResponse.error(
            e.getErrorCode().getCode(), 
            message
        );
        
        return ResponseEntity.ok(response);
    }
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ApiResponse<Map<String, String>>> handleValidException(
            MethodArgumentNotValidException e) {
        
        Map<String, String> errors = new HashMap<>();
        e.getBindingResult().getFieldErrors().forEach(error -> {
            errors.put(error.getField(), error.getDefaultMessage());
        });
        
        ApiResponse<Map<String, String>> response = new ApiResponse<>();
        response.setCode(ErrorCode.PARAM_ERROR.getCode());
        response.setMessage("å‚æ•°æ ¡éªŒå¤±è´¥");
        response.setData(errors);
        
        return ResponseEntity.badRequest().body(response);
    }
    
    // å¤„ç†ç³»ç»Ÿå¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ApiResponse<Void>> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        
        ApiResponse<Void> response = ApiResponse.error(
            ErrorCode.SYSTEM_ERROR.getCode(),
            "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"
        );
        
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body(response);
    }
}
```

**å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Service
public class UserService {
    
    public User register(UserDTO dto) {
        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
        if (userRepository.existsByUsername(dto.getUsername())) {
            throw new BusinessException(ErrorCode.USERNAME_EXIST);
        }
        
        // æ£€æŸ¥é‚®ç®±æ˜¯å¦å­˜åœ¨
        if (userRepository.existsByEmail(dto.getEmail())) {
            throw new BusinessException(
                ErrorCode.EMAIL_EXIST,
                "é‚®ç®± " + dto.getEmail() + " å·²è¢«æ³¨å†Œ"
            );
        }
        
        // åˆ›å»ºç”¨æˆ·...
        return user;
    }
}
```

**é”™è¯¯å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 21002,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null,
  "timestamp": 1695600000000
}

{
  "code": 10001,
  "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
  "data": {
    "username": "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´",
    "email": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
  },
  "timestamp": 1695600000000
}
```

---

## 5. ğŸ“„ æ¥å£æ–‡æ¡£ç¼–å†™



### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ¥å£æ–‡æ¡£



**æ²¡æœ‰æ–‡æ¡£çš„ç—›è‹¦**ï¼š
```
å‰ç«¯ï¼š"è¿™ä¸ªæ¥å£è¿”å›ä»€ä¹ˆæ•°æ®ï¼Ÿ"
åç«¯ï¼š"ä½ çœ‹ä»£ç å§..."
å‰ç«¯ï¼š"å‚æ•°æ€ä¹ˆä¼ ï¼Ÿ"
åç«¯ï¼š"æˆ‘å¿˜äº†ï¼Œè®©æˆ‘çœ‹çœ‹ä»£ç ..."
å‰ç«¯ï¼š"ğŸ˜¤"
```

**å¥½æ–‡æ¡£çš„ä»·å€¼**ï¼š
- âœ… å‰åç«¯é«˜æ•ˆåä½œï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬
- âœ… æ–°äººå¿«é€Ÿä¸Šæ‰‹ï¼Œä¸ç”¨è¿½ç€è€å‘˜å·¥é—®
- âœ… æ¥å£å˜æ›´æœ‰è¿¹å¯å¾ªï¼Œé¿å…è¸©å‘

### 5.2 Swagger/OpenAPIé›†æˆ



**æ·»åŠ ä¾èµ–**ï¼š
```xml
<!-- Springdoc OpenAPIï¼ˆæ¨èï¼Œæ”¯æŒSpring Boot 3ï¼‰ -->
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
    <version>2.2.0</version>
</dependency>
```

**åŸºç¡€é…ç½®**ï¼š
```java
@Configuration
public class OpenApiConfig {
    
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
            .info(new Info()
                .title("ç”¨æˆ·ç®¡ç†ç³»ç»ŸAPI")
                .version("v1.0")
                .description("æä¾›ç”¨æˆ·ã€è®¢å•ã€å•†å“ç­‰æ¨¡å—çš„RESTful API")
                .contact(new Contact()
                    .name("å¼€å‘å›¢é˜Ÿ")
                    .email("dev@example.com")))
            .externalDocs(new ExternalDocumentation()
                .description("é¡¹ç›®Wiki")
                .url("https://wiki.example.com"));
    }
}
```

### 5.3 æ¥å£æ–‡æ¡£æ³¨è§£ä½¿ç”¨



**Controllerå±‚æ–‡æ¡£**ï¼š
```java
@RestController
@RequestMapping("/api/v1/users")
@Tag(name = "ç”¨æˆ·ç®¡ç†", description = "ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥æ“ä½œ")
public class UserController {
    
    @Operation(
        summary = "æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨",
        description = "æ”¯æŒåˆ†é¡µæŸ¥è¯¢å’ŒæŒ‰ç”¨æˆ·åæ¨¡ç³Šæœç´¢"
    )
    @Parameters({
        @Parameter(name = "page", description = "é¡µç ï¼Œä»1å¼€å§‹", example = "1"),
        @Parameter(name = "size", description = "æ¯é¡µæ•°é‡", example = "10"),
        @Parameter(name = "username", description = "ç”¨æˆ·åï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰", required = false)
    })
    @ApiResponses({
        @ApiResponse(
            responseCode = "200",
            description = "æŸ¥è¯¢æˆåŠŸ",
            content = @Content(schema = @Schema(implementation = PageResponse.class))
        )
    })
    @GetMapping
    public ApiResponse<PageResponse<User>> listUsers(
            @RequestParam(defaultValue = "1") int page,
            @RequestParam(defaultValue = "10") int size,
            @RequestParam(required = false) String username) {
        // å®ç°...
    }
    
    @Operation(summary = "åˆ›å»ºç”¨æˆ·", description = "æ³¨å†Œæ–°ç”¨æˆ·è´¦å·")
    @ApiResponses({
        @ApiResponse(responseCode = "200", description = "åˆ›å»ºæˆåŠŸ"),
        @ApiResponse(responseCode = "400", description = "å‚æ•°æ ¡éªŒå¤±è´¥"),
        @ApiResponse(responseCode = "21002", description = "ç”¨æˆ·åå·²å­˜åœ¨")
    })
    @PostMapping
    public ApiResponse<User> createUser(
            @RequestBody @Valid 
            @io.swagger.v3.oas.annotations.parameters.RequestBody(
                description = "ç”¨æˆ·ä¿¡æ¯",
                required = true
            ) UserDTO dto) {
        // å®ç°...
    }
}
```

**DTOç±»æ–‡æ¡£**ï¼š
```java
@Schema(description = "ç”¨æˆ·åˆ›å»ºè¯·æ±‚")
public class UserDTO {
    
    @Schema(description = "ç”¨æˆ·å", example = "zhangsan", required = true)
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦3-20ä¸ªå­—ç¬¦")
    private String username;
    
    @Schema(description = "å¯†ç ", example = "123456", required = true)
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, max = 20, message = "å¯†ç é•¿åº¦6-20ä¸ªå­—ç¬¦")
    private String password;
    
    @Schema(description = "é‚®ç®±", example = "zhangsan@example.com")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Schema(description = "æ‰‹æœºå·", example = "13800138000")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
}
```

**è®¿é—®æ–‡æ¡£**ï¼š
```
å¯åŠ¨åº”ç”¨åè®¿é—®ï¼š

Swagger UIç•Œé¢ï¼š
http://localhost:8080/swagger-ui.html

OpenAPI JSONï¼š
http://localhost:8080/v3/api-docs
```

### 5.4 æ‰‹å†™æ–‡æ¡£æœ€ä½³å®è·µ



**æ¥å£æ–‡æ¡£æ¨¡æ¿**ï¼š
```markdown
# åˆ›å»ºç”¨æˆ·



## åŸºæœ¬ä¿¡æ¯


- **æ¥å£åœ°å€**ï¼š`POST /api/v1/users`
- **æ¥å£è¯´æ˜**ï¼šæ³¨å†Œæ–°ç”¨æˆ·è´¦å·
- **è®¤è¯æ–¹å¼**ï¼šæ— éœ€è®¤è¯

## è¯·æ±‚å‚æ•°


| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·åï¼Œ3-20å­—ç¬¦ | zhangsan |
| password | string | æ˜¯ | å¯†ç ï¼Œ6-20å­—ç¬¦ | 123456 |
| email | string | å¦ | é‚®ç®±åœ°å€ | zhangsan@example.com |
| phone | string | å¦ | æ‰‹æœºå· | 13800138000 |

## è¯·æ±‚ç¤ºä¾‹


```json
{
  "username": "zhangsan",
  "password": "123456",
  "email": "zhangsan@example.com",
  "phone": "13800138000"
}
```

## å“åº”ç¤ºä¾‹



**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 0,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 100,
    "username": "zhangsan",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "createdAt": "2024-09-24T10:30:00"
  }
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "code": 21002,
  "message": "ç”¨æˆ·åå·²å­˜åœ¨",
  "data": null
}
```

## é”™è¯¯ç è¯´æ˜


| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 10001 | å‚æ•°æ ¡éªŒå¤±è´¥ |
| 21002 | ç”¨æˆ·åå·²å­˜åœ¨ |
| 21003 | é‚®ç®±å·²è¢«æ³¨å†Œ |
```

---

## 6. ğŸ§ª APIæµ‹è¯•è§„èŒƒ



### 6.1 å•å…ƒæµ‹è¯•



**Controllerå±‚æµ‹è¯•**ï¼š
```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    @DisplayName("è·å–ç”¨æˆ· - æˆåŠŸ")
    void testGetUser_Success() throws Exception {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        User user = new User(1L, "zhangsan", "zhangsan@example.com");
        when(userService.findById(1L)).thenReturn(user);
        
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(get("/api/v1/users/1"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(0))
            .andExpect(jsonPath("$.data.id").value(1))
            .andExpect(jsonPath("$.data.username").value("zhangsan"));
    }
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - å‚æ•°æ ¡éªŒå¤±è´¥")
    void testCreateUser_ValidationFailed() throws Exception {
        UserDTO dto = new UserDTO();
        dto.setUsername("ab");  // ç”¨æˆ·åå¤ªçŸ­
        dto.setPassword("123"); // å¯†ç å¤ªçŸ­
        
        mockMvc.perform(post("/api/v1/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(dto)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.code").value(10001));
    }
}
```

### 6.2 é›†æˆæµ‹è¯•



**å®Œæ•´æµç¨‹æµ‹è¯•**ï¼š
```java
@SpringBootTest
@AutoConfigureMockMvc
@Transactional  // æµ‹è¯•åè‡ªåŠ¨å›æ»š
class UserIntegrationTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    @DisplayName("ç”¨æˆ·æ³¨å†Œåˆ°ç™»å½•å®Œæ•´æµç¨‹")
    void testUserRegistrationAndLogin() throws Exception {
        // 1. æ³¨å†Œç”¨æˆ·
        UserDTO registerDto = new UserDTO();
        registerDto.setUsername("testuser");
        registerDto.setPassword("123456");
        
        MvcResult registerResult = mockMvc.perform(
                post("/api/v1/users")
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(objectMapper.writeValueAsString(registerDto)))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(0))
            .andReturn();
        
        // 2. ç™»å½•
        LoginDTO loginDto = new LoginDTO();
        loginDto.setUsername("testuser");
        loginDto.setPassword("123456");
        
        mockMvc.perform(post("/api/v1/auth/login")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(loginDto)))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(0))
            .andExpect(jsonPath("$.data.token").exists());
    }
}
```

### 6.3 æ€§èƒ½æµ‹è¯•



**JMeteræµ‹è¯•è®¡åˆ’ç¤ºä¾‹**ï¼š
```
æµ‹è¯•åœºæ™¯ï¼šç”¨æˆ·æŸ¥è¯¢æ¥å£å‹åŠ›æµ‹è¯•

é…ç½®ï¼š
- çº¿ç¨‹æ•°ï¼š100ï¼ˆæ¨¡æ‹Ÿ100ä¸ªå¹¶å‘ç”¨æˆ·ï¼‰
- å¾ªç¯æ¬¡æ•°ï¼š10ï¼ˆæ¯ä¸ªç”¨æˆ·è¯·æ±‚10æ¬¡ï¼‰
- æ€»è¯·æ±‚æ•°ï¼š1000

HTTPè¯·æ±‚é…ç½®ï¼š
- æ–¹æ³•ï¼šGET
- è·¯å¾„ï¼š/api/v1/users/1
- æœŸæœ›å“åº”æ—¶é—´ï¼š< 200ms
- æˆåŠŸç‡ï¼š> 99%

æ–­è¨€ï¼š
âœ“ å“åº”çŠ¶æ€ç  = 200
âœ“ å“åº”åŒ…å« "code": 0
âœ“ å“åº”æ—¶é—´ < 200ms
```

---

## 7. ğŸ” APIå®‰å…¨è®¾è®¡



### 7.1 è®¤è¯ä¸æˆæƒ



**JWTè®¤è¯æµç¨‹**ï¼š
```
ç™»å½•è®¤è¯æµç¨‹ï¼š

å®¢æˆ·ç«¯                     æœåŠ¡å™¨
   |                         |
   |--[1]å‘é€ç”¨æˆ·åå¯†ç ------>|
   |                         |
   |                    [2]éªŒè¯ç”¨æˆ·ä¿¡æ¯
   |                         |
   |<--[3]è¿”å›JWT Token------|
   |                         |
   
åç»­è¯·æ±‚æµç¨‹ï¼š

å®¢æˆ·ç«¯                     æœåŠ¡å™¨
   |                         |
   |--[1]æºå¸¦Tokenè¯·æ±‚------->|
   |  Header: Authorization   |
   |  Bearer eyJhbGc...       |
   |                    [2]éªŒè¯Token
   |                         |
   |<--[3]è¿”å›ä¸šåŠ¡æ•°æ®--------|
```

**JWTå®ç°ç¤ºä¾‹**ï¼š
```java
@RestController
@RequestMapping("/api/v1/auth")
public class AuthController {
    
    @PostMapping("/login")
    public ApiResponse<LoginVO> login(@RequestBody LoginDTO dto) {
        // 1. éªŒè¯ç”¨æˆ·åå¯†ç 
        User user = authService.authenticate(
            dto.getUsername(), 
            dto.getPassword()
        );
        
        if (user == null) {
            throw new BusinessException(ErrorCode.PASSWORD_ERROR);
        }
        
        // 2. ç”ŸæˆJWT Token
        String token = jwtService.generateToken(user);
        
        // 3. è¿”å›Token
        LoginVO vo = new LoginVO();
        vo.setToken(token);
        vo.setUser(user);
        
        return ApiResponse.success(vo);
    }
}

// JWTè¿‡æ»¤å™¨
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                   HttpServletResponse response,
                                   FilterChain filterChain) {
        // 1. ä»Headerè·å–Token
        String token = request.getHeader("Authorization");
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7);
            
            // 2. éªŒè¯Token
            if (jwtService.validateToken(token)) {
                // 3. è®¾ç½®è®¤è¯ä¿¡æ¯
                Authentication auth = jwtService.getAuthentication(token);
                SecurityContextHolder.getContext()
                    .setAuthentication(auth);
            }
        }
        
        filterChain.doFilter(request, response);
    }
}
```

### 7.2 æ¥å£é™æµ



**ä»¤ç‰Œæ¡¶é™æµ**ï¼š
```java
@RestController
@RequestMapping("/api/v1/users")
public class UserController {
    
    // æ¯ç§’æœ€å¤š10ä¸ªè¯·æ±‚
    private final RateLimiter rateLimiter = RateLimiter.create(10.0);
    
    @GetMapping("/{id}")
    public ApiResponse<User> getUser(@PathVariable Long id) {
        // å°è¯•è·å–ä»¤ç‰Œ
        if (!rateLimiter.tryAcquire()) {
            throw new BusinessException(
                ErrorCode.TOO_MANY_REQUESTS,
                "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•"
            );
        }
        
        User user = userService.findById(id);
        return ApiResponse.success(user);
    }
}
```

**æ³¨è§£å¼é™æµ**ï¼š
```java
// è‡ªå®šä¹‰é™æµæ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RateLimit {
    double value() default 10.0;  // æ¯ç§’è¯·æ±‚æ•°
}

// åˆ‡é¢å®ç°
@Aspect
@Component
public class RateLimitAspect {
    
    private final Map<String, RateLimiter> limiters = new ConcurrentHashMap<>();
    
    @Around("@annotation(rateLimit)")
    public Object around(ProceedingJoinPoint point, RateLimit rateLimit) {
        String key = point.getSignature().toString();
        RateLimiter limiter = limiters.computeIfAbsent(
            key, 
            k -> RateLimiter.create(rateLimit.value())
        );
        
        if (!limiter.tryAcquire()) {
            throw new BusinessException(ErrorCode.TOO_MANY_REQUESTS);
        }
        
        return point.proceed();
    }
}

// ä½¿ç”¨
@RateLimit(5.0)  // æ¯ç§’æœ€å¤š5ä¸ªè¯·æ±‚
@GetMapping("/sensitive-data")
public ApiResponse<Data> getSensitiveData() {
    // ...
}
```

### 7.3 æ•°æ®åŠ å¯†ä¸è„±æ•



**å¯†ç åŠ å¯†**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    public User register(UserDTO dto) {
        User user = new User();
        user.setUsername(dto.getUsername());
        
        // å¯†ç åŠ å¯†å­˜å‚¨
        String encryptedPassword = passwordEncoder.encode(dto.getPassword());
        user.setPassword(encryptedPassword);
        
        return userRepository.save(user);
    }
    
    public boolean authenticate(String username, String password) {
        User user = userRepository.findByUsername(username);
        
        // éªŒè¯å¯†ç 
        return passwordEncoder.matches(password, user.getPassword());
    }
}
```

**æ•æ„Ÿæ•°æ®è„±æ•**ï¼š
```java
// è‡ªå®šä¹‰è„±æ•æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
@JacksonAnnotationsInside
@JsonSerialize(using = SensitiveDataSerializer.class)
public @interface Sensitive {
    SensitiveType type();
}

// è„±æ•ç±»å‹
public enum SensitiveType {
    PHONE,      // æ‰‹æœºå·ï¼š138****8000
    EMAIL,      // é‚®ç®±ï¼šzh***@example.com
    ID_CARD,    // èº«ä»½è¯ï¼š110***********1234
    BANK_CARD   // é“¶è¡Œå¡ï¼š6222****1234
}

// ä½¿ç”¨
public class UserVO {
    private String username;
    
    @Sensitive(type = SensitiveType.PHONE)
    private String phone;
    
    @Sensitive(type = SensitiveType.EMAIL)
    private String email;
}

// è¿”å›æ•°æ®è‡ªåŠ¨è„±æ•ï¼š
// {
//   "username": "zhangsan",
//   "phone": "138****8000",
//   "email": "zh***@example.com"
// }
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 RESTfulè®¾è®¡è¦ç‚¹



> ğŸ’¡ **æ ¸å¿ƒåŸåˆ™**ï¼šé¢å‘èµ„æºã€ç»Ÿä¸€æ¥å£ã€æ— çŠ¶æ€

```
âœ… è®°ä½è¿™äº›ï¼š
â€¢ URLåªåŒ…å«åè¯ï¼ˆèµ„æºï¼‰ï¼Œä¸åŒ…å«åŠ¨è¯
â€¢ ç”¨HTTPæ–¹æ³•è¡¨ç¤ºæ“ä½œï¼šGETæŸ¥ã€POSTå¢ã€PUTæ”¹ã€DELETEåˆ 
â€¢ ä½¿ç”¨åˆé€‚çš„çŠ¶æ€ç ï¼š2xxæˆåŠŸã€4xxå®¢æˆ·ç«¯é”™è¯¯ã€5xxæœåŠ¡å™¨é”™è¯¯
â€¢ ä¿æŒæ— çŠ¶æ€ï¼šæ¯ä¸ªè¯·æ±‚åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯

âŒ é¿å…è¿™äº›ï¼š
â€¢ /getUserã€/createOrder è¿™æ ·çš„åŠ¨è¯URL
â€¢ æ‰€æœ‰æ“ä½œéƒ½ç”¨POSTæ–¹æ³•
â€¢ è¿”å›200ä½†dataé‡Œè¯´å¤±è´¥
â€¢ åœ¨æœåŠ¡å™¨Sessionä¸­ä¿å­˜è¯·æ±‚çŠ¶æ€
```

### 8.2 ç‰ˆæœ¬æ§åˆ¶è¦ç‚¹



> ğŸ”„ **ç‰ˆæœ¬åˆ‡æ¢æœ‰è®¡åˆ’ï¼Œæ–°æ—§å¹¶å­˜ç•™æ—¶é—´**

```
ç‰ˆæœ¬ç®¡ç†ä¸‰æ­¥èµ°ï¼š
1. å‘å¸ƒæ–°ç‰ˆæœ¬ï¼šv2ä¸v1å¹¶å­˜
2. åºŸå¼ƒæ ‡è®°ï¼šv1è¿”å›è­¦å‘Šï¼Œæ¨èå‡çº§
3. å®Œå…¨ä¸‹çº¿ï¼šv1è¿”å›410ï¼Œå¼ºåˆ¶å‡çº§

æ¨èæ–¹æ¡ˆï¼šURLè·¯å¾„ç‰ˆæœ¬ï¼ˆ/api/v1/usersï¼‰
å¤‡é€‰æ–¹æ¡ˆï¼šHeaderç‰ˆæœ¬ï¼ˆAPI-Version: 1ï¼‰
```

### 8.3 å“åº”æ ¼å¼è¦ç‚¹



> ğŸ“¦ **ç»Ÿä¸€æ ¼å¼ï¼Œå‰ç«¯çœå¿ƒ**

```
æ ‡å‡†å“åº”åŒ…å«ï¼š
{
  "code": 0,           // ä¸šåŠ¡çŠ¶æ€ç 
  "message": "æˆåŠŸ",   // æç¤ºä¿¡æ¯
  "data": {},          // å®é™…æ•°æ®
  "timestamp": 123456  // æ—¶é—´æˆ³
}

åˆ†é¡µé¢å¤–åŒ…å«ï¼š
â€¢ totalï¼šæ€»è®°å½•æ•°
â€¢ pagesï¼šæ€»é¡µæ•°
â€¢ hasNextï¼šæ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
```

### 8.4 é”™è¯¯ç è¦ç‚¹



> âš ï¸ **é”™è¯¯ç ä½“ç³»åŒ–ï¼Œå®šä½é—®é¢˜å¿«**

```
é”™è¯¯ç ç»“æ„ï¼šABCCC
â€¢ Aï¼šçº§åˆ«ï¼ˆ1ç³»ç»Ÿ/2ä¸šåŠ¡/3ä¸‰æ–¹ï¼‰
â€¢ Bï¼šæ¨¡å—ï¼ˆ0é€šç”¨/1ç”¨æˆ·/2è®¢å•...ï¼‰
â€¢ CCCï¼šå…·ä½“é”™è¯¯

å¸¸ç”¨é”™è¯¯ç ï¼š
10001 - å‚æ•°é”™è¯¯
21001 - ç”¨æˆ·ä¸å­˜åœ¨
21002 - ç”¨æˆ·åå·²å­˜åœ¨
22001 - è®¢å•ä¸å­˜åœ¨
```

### 8.5 æ–‡æ¡£ç¼–å†™è¦ç‚¹



> ğŸ“„ **æ–‡æ¡£å³æ¥å£ï¼Œæ²Ÿé€šé›¶éšœç¢**

```
å¿…å¤‡å†…å®¹ï¼š
âœ“ æ¥å£åœ°å€å’Œè¯´æ˜
âœ“ è¯·æ±‚å‚æ•°ï¼ˆåç§°ã€ç±»å‹ã€å¿…å¡«ã€ç¤ºä¾‹ï¼‰
âœ“ å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸã€å¤±è´¥ï¼‰
âœ“ é”™è¯¯ç è¯´æ˜

æ¨èå·¥å…·ï¼š
â€¢ Swagger/OpenAPIï¼šè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£
â€¢ Apifoxï¼šAPIå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
â€¢ Postmanï¼šæµ‹è¯•å’Œæ–‡æ¡£ä¸€ä½“åŒ–
```

### 8.6 æµ‹è¯•è§„èŒƒè¦ç‚¹



> ğŸ§ª **æµ‹è¯•å……åˆ†ï¼Œä¸Šçº¿å®‰å¿ƒ**

```
æµ‹è¯•å±‚æ¬¡ï¼š
1. å•å…ƒæµ‹è¯•ï¼šæ¯ä¸ªæ¥å£ç‹¬ç«‹æµ‹è¯•
2. é›†æˆæµ‹è¯•ï¼šå®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
3. æ€§èƒ½æµ‹è¯•ï¼šå‹åŠ›å’Œå¹¶å‘æµ‹è¯•

å…³é”®æŒ‡æ ‡ï¼š
â€¢ åŠŸèƒ½è¦†ç›–ç‡ > 80%
â€¢ å“åº”æ—¶é—´ < 200msï¼ˆæ™®é€šæ¥å£ï¼‰
â€¢ å¹¶å‘æ”¯æŒ > 100 QPS
â€¢ é”™è¯¯ç‡ < 1%
```

### 8.7 å®‰å…¨è®¾è®¡è¦ç‚¹



> ğŸ” **å®‰å…¨ç¬¬ä¸€ï¼Œé˜²æ‚£æœªç„¶**

```
å®‰å…¨æªæ–½ï¼š
âœ“ JWTè®¤è¯ï¼šæ— çŠ¶æ€ã€å¯æ‰©å±•
âœ“ æ¥å£é™æµï¼šé˜²æ­¢æ¶æ„æ”»å‡»
âœ“ æ•°æ®åŠ å¯†ï¼šå¯†ç BCryptã€ä¼ è¾“HTTPS
âœ“ æ•æ„Ÿè„±æ•ï¼šæ‰‹æœºå·ã€é‚®ç®±ã€èº«ä»½è¯

é˜²æŠ¤è¦ç‚¹ï¼š
â€¢ Tokenè¿‡æœŸæ—¶é—´åˆç†ï¼ˆ15-30åˆ†é’Ÿï¼‰
â€¢ é™æµé˜ˆå€¼é€‚ä¸­ï¼ˆ10-100 QPSï¼‰
â€¢ é‡è¦æ“ä½œäºŒæ¬¡éªŒè¯
â€¢ æ—¥å¿—è®°å½•æ•æ„Ÿæ“ä½œ
```

### 8.8 æœ€ä½³å®è·µæ¸…å•



**ğŸ“ å¼€å‘å‰**ï¼š
- [ ] ç¡®å®šæ¥å£URLè§„èŒƒï¼ˆRESTfulï¼‰
- [ ] è®¾è®¡ç»Ÿä¸€å“åº”æ ¼å¼
- [ ] åˆ¶å®šé”™è¯¯ç ä½“ç³»
- [ ] è§„åˆ’ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

**ğŸ’» å¼€å‘ä¸­**ï¼š
- [ ] ç¼–å†™æ¸…æ™°çš„æ¥å£æ–‡æ¡£
- [ ] å‚æ•°æ ¡éªŒè¦å……åˆ†
- [ ] å¼‚å¸¸å¤„ç†è¦ç»Ÿä¸€
- [ ] æ—¥å¿—è®°å½•è¦å®Œæ•´

**ğŸ§ª æµ‹è¯•æ—¶**ï¼š
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ä¸»æµç¨‹
- [ ] é›†æˆæµ‹è¯•éªŒè¯ä¸šåŠ¡
- [ ] æ€§èƒ½æµ‹è¯•å‹åŠ›éªŒè¯
- [ ] å®‰å…¨æµ‹è¯•æ¼æ´æ‰«æ

**ğŸš€ ä¸Šçº¿å**ï¼š
- [ ] ç›‘æ§æ¥å£æ€§èƒ½æŒ‡æ ‡
- [ ] æ”¶é›†é”™è¯¯æ—¥å¿—åˆ†æ
- [ ] åŠæ—¶æ›´æ–°æ¥å£æ–‡æ¡£
- [ ] ç‰ˆæœ¬åºŸå¼ƒæå‰é€šçŸ¥

---

**ğŸ¯ è®°å¿†å£è¯€**ï¼š
```
RESTfulè®¾è®¡è®²è§„èŒƒï¼Œèµ„æºåè¯æ–¹æ³•å…¨
ç‰ˆæœ¬æ§åˆ¶æœ‰ç­–ç•¥ï¼Œæ–°æ—§å¹¶å­˜ç•™æ—¶é—´
å“åº”æ ¼å¼è¦ç»Ÿä¸€ï¼Œå‰ç«¯å¤„ç†æ›´ç®€å•
é”™è¯¯ç è¦ä½“ç³»åŒ–ï¼Œå®šä½é—®é¢˜ä¸å›°éš¾
æ–‡æ¡£è¯¦ç»†æ˜“ç†è§£ï¼Œå›¢é˜Ÿåä½œæ•ˆç‡é«˜
æµ‹è¯•å……åˆ†ä¿è´¨é‡ï¼Œå®‰å…¨æªæ–½è¦åšå¥½
```