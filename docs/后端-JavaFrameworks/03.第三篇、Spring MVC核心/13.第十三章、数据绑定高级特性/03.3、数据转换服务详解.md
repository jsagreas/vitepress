---
title: 3ã€æ•°æ®è½¬æ¢æœåŠ¡è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [æ•°æ®è½¬æ¢æœåŠ¡æ¦‚è¿°](#1-æ•°æ®è½¬æ¢æœåŠ¡æ¦‚è¿°)
2. [ConversionServiceæ ¸å¿ƒæ¥å£](#2-ConversionServiceæ ¸å¿ƒæ¥å£)
3. [Converterè½¬æ¢å™¨è¯¦è§£](#3-Converterè½¬æ¢å™¨è¯¦è§£)
4. [ConverterFactoryå·¥å‚æ¨¡å¼](#4-ConverterFactoryå·¥å‚æ¨¡å¼)
5. [GenericConverteré€šç”¨è½¬æ¢å™¨](#5-GenericConverteré€šç”¨è½¬æ¢å™¨)
6. [è½¬æ¢å™¨æ³¨å†Œä¸é…ç½®](#6-è½¬æ¢å™¨æ³¨å†Œä¸é…ç½®)
7. [è½¬æ¢å™¨é“¾æœºåˆ¶](#7-è½¬æ¢å™¨é“¾æœºåˆ¶)
8. [ç±»å‹åŒ¹é…ä¸å¼‚å¸¸å¤„ç†](#8-ç±»å‹åŒ¹é…ä¸å¼‚å¸¸å¤„ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ•°æ®è½¬æ¢æœåŠ¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®è½¬æ¢æœåŠ¡


**é€šä¿—ç†è§£**ï¼šå°±åƒä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼ŒæŠŠä¸€ç§ç±»å‹çš„æ•°æ®è½¬æ¢æˆå¦ä¸€ç§ç±»å‹

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š

ç”¨æˆ·è¾“å…¥          éœ€è¦çš„ç±»å‹         è½¬æ¢è¿‡ç¨‹
"2024-01-15"  â†’  Dateå¯¹è±¡    â†’   å­—ç¬¦ä¸²è½¬æ—¥æœŸ
"true"        â†’  Boolean     â†’   å­—ç¬¦ä¸²è½¬å¸ƒå°”
"100"         â†’  Integer     â†’   å­—ç¬¦ä¸²è½¬æ•´æ•°
```

**ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è½¬æ¢ï¼Ÿ**

```
Webè¯·æ±‚ä¸­çš„æ•°æ®éƒ½æ˜¯å­—ç¬¦ä¸²ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æäº¤è¡¨å• â”‚ â†’ name=å¼ ä¸‰&age=25&birthday=2000-01-15
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åç«¯éœ€è¦çš„ç±»å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Javaå¯¹è±¡     â”‚ â†’ User { name:String, age:Integer, birthday:Date }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸­é—´éœ€è¦"è½¬æ¢æœåŠ¡"æ¥å®Œæˆç±»å‹è½¬æ¢
```

### 1.2 Springçš„è½¬æ¢ä½“ç³»


**æ ¸å¿ƒç»„ä»¶å…³ç³»å›¾**ï¼š

```
                ConversionService (æ ¸å¿ƒæœåŠ¡æ¥å£)
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                               â†“
   è½¬æ¢å™¨æ³¨å†Œ                        æ‰§è¡Œè½¬æ¢
        â†“                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¬æ¢å™¨ç±»å‹   â”‚              â”‚  è½¬æ¢é€»è¾‘     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Converter    â”‚              â”‚ ç±»å‹åŒ¹é…      â”‚
â”‚ ConverterFactoryâ”‚           â”‚ è½¬æ¢æ‰§è¡Œ      â”‚
â”‚ GenericConverterâ”‚           â”‚ å¼‚å¸¸å¤„ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Springæä¾›çš„ä¸‰ç§è½¬æ¢æ–¹å¼**ï¼š

| è½¬æ¢æ–¹å¼ | ä½¿ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|---------|---------|------|
| **Converter** | `ç®€å•çš„ä¸€å¯¹ä¸€è½¬æ¢` | `æœ€å¸¸ç”¨ï¼Œä»£ç ç®€æ´` |
| **ConverterFactory** | `ä¸€å¯¹å¤šçš„è½¬æ¢ï¼ˆå¦‚Stringè½¬å„ç§æšä¸¾ï¼‰` | `é¿å…é‡å¤ä»£ç ` |
| **GenericConverter** | `å¤æ‚çš„å¤šå¯¹å¤šè½¬æ¢` | `åŠŸèƒ½å¼ºå¤§ï¼Œçµæ´»åº¦é«˜` |

---

## 2. ğŸ”§ ConversionServiceæ ¸å¿ƒæ¥å£


### 2.1 ConversionServiceæ˜¯ä»€ä¹ˆ


> ğŸ’¡ **æ ¸å¿ƒå®šä¹‰**ï¼šConversionServiceæ˜¯Springæ•°æ®è½¬æ¢çš„"æ€»æŒ‡æŒ¥"ï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰è½¬æ¢å™¨å¹¶æ‰§è¡Œè½¬æ¢æ“ä½œ

**æ¥å£ç»“æ„**ï¼š

```java
public interface ConversionService {
    
    // åˆ¤æ–­èƒ½å¦è½¬æ¢
    boolean canConvert(Class<?> sourceType, Class<?> targetType);
    
    // æ‰§è¡Œè½¬æ¢
    <T> T convert(Object source, Class<T> targetType);
}
```

**é€šä¿—ç†è§£**ï¼š

```
ConversionServiceå°±åƒä¸€ä¸ª"è½¬æ¢æœåŠ¡ç«™"ï¼š

ç”¨æˆ·è¯·æ±‚ï¼šæˆ‘è¦æŠŠ"100"è½¬æˆInteger
    â†“
ConversionServiceæ£€æŸ¥ï¼š
    â‘  æœ‰æ²¡æœ‰Stringâ†’Integerçš„è½¬æ¢å™¨ï¼Ÿï¼ˆcanConvertï¼‰
    â‘¡ æœ‰çš„è¯å°±æ‰§è¡Œè½¬æ¢ï¼ˆconvertï¼‰
    â†“
è¿”å›ç»“æœï¼šInteger(100)
```

### 2.2 DefaultConversionServiceå®ç°ç±»


**Springé»˜è®¤æä¾›çš„å®ç°**ï¼š

```java
// Springå·²ç»å†…ç½®äº†å¾ˆå¤šå¸¸ç”¨è½¬æ¢å™¨
ConversionService service = new DefaultConversionService();

// ç›´æ¥ä½¿ç”¨
Integer num = service.convert("100", Integer.class);      // 100
Boolean flag = service.convert("true", Boolean.class);    // true
Date date = service.convert("2024-01-15", Date.class);   // Dateå¯¹è±¡
```

**å†…ç½®çš„å¸¸ç”¨è½¬æ¢å™¨**ï¼š

- âœ… String â†’ åŸºæœ¬ç±»å‹ï¼ˆintã€longã€booleanç­‰ï¼‰
- âœ… String â†’ æ—¥æœŸç±»å‹ï¼ˆDateã€LocalDateç­‰ï¼‰
- âœ… æ•°ç»„ â†’ é›†åˆï¼ˆString[] â†’ List\<String>ï¼‰
- âœ… æšä¸¾ â†’ String
- âœ… Number â†’ Numberï¼ˆInteger â†’ Longï¼‰

---

## 3. âš™ï¸ Converterè½¬æ¢å™¨è¯¦è§£


### 3.1 Converteræ¥å£åŸºç¡€


**æ¥å£å®šä¹‰**ï¼š

```java
public interface Converter<S, T> {
    T convert(S source);  // Sæ˜¯æºç±»å‹ï¼ŒTæ˜¯ç›®æ ‡ç±»å‹
}
```

> ğŸ“ **ç†è§£è¦ç‚¹**ï¼šConverterå°±æ˜¯"ä¸“é—¨è´Ÿè´£æŸä¸€ç§è½¬æ¢"çš„å·¥å…·ç±»

### 3.2 è‡ªå®šä¹‰è½¬æ¢å™¨ç¤ºä¾‹


**åœºæ™¯ï¼šå­—ç¬¦ä¸²è½¬æ—¥æœŸ**

```java
// æŠŠ"2024-01-15"è¿™æ ·çš„å­—ç¬¦ä¸²è½¬æˆDateå¯¹è±¡
public class StringToDateConverter implements Converter<String, Date> {
    
    @Override
    public Date convert(String source) {
        try {
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
            return sdf.parse(source);
        } catch (ParseException e) {
            throw new IllegalArgumentException("æ—¥æœŸæ ¼å¼é”™è¯¯: " + source);
        }
    }
}
```

**ä½¿ç”¨æ­¥éª¤**ï¼š

```
â‘  å®ç°Converteræ¥å£ï¼ŒæŒ‡å®šæ³›å‹ï¼ˆæºç±»å‹ã€ç›®æ ‡ç±»å‹ï¼‰
â‘¡ åœ¨convertæ–¹æ³•ä¸­ç¼–å†™è½¬æ¢é€»è¾‘
â‘¢ æ³¨å†Œåˆ°ConversionServiceä¸­
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```java
// è‡ªå®šä¹‰ï¼šå­—ç¬¦ä¸²è½¬ç”¨æˆ·å¯¹è±¡
public class StringToUserConverter implements Converter<String, User> {
    
    @Override
    public User convert(String source) {
        // sourceæ ¼å¼ï¼šå¼ ä¸‰,25,ç”·
        String[] parts = source.split(",");
        
        User user = new User();
        user.setName(parts[0]);
        user.setAge(Integer.parseInt(parts[1]));
        user.setGender(parts[2]);
        return user;
    }
}

// ä½¿ç”¨
ConversionService service = new DefaultConversionService();
// æ³¨å†Œè‡ªå®šä¹‰è½¬æ¢å™¨ï¼ˆåé¢è¯¦ç»†è®²ï¼‰
User user = service.convert("å¼ ä¸‰,25,ç”·", User.class);
```

### 3.3 å¸¸è§è½¬æ¢åœºæ™¯


**åœºæ™¯1ï¼šå­—ç¬¦ä¸²è½¬æšä¸¾**

```java
public enum UserStatus {
    ACTIVE, INACTIVE, SUSPENDED
}

// è½¬æ¢å™¨
public class StringToStatusConverter implements Converter<String, UserStatus> {
    
    @Override
    public UserStatus convert(String source) {
        return UserStatus.valueOf(source.toUpperCase());
    }
}

// ä½¿ç”¨ï¼šstatus=active â†’ UserStatus.ACTIVE
```

**åœºæ™¯2ï¼šIDå­—ç¬¦ä¸²è½¬å®ä½“å¯¹è±¡**

```java
public class StringToProductConverter implements Converter<String, Product> {
    
    @Autowired
    private ProductService productService;
    
    @Override
    public Product convert(String productId) {
        // æ ¹æ®IDä»æ•°æ®åº“æŸ¥è¯¢å®Œæ•´å¯¹è±¡
        return productService.findById(Long.parseLong(productId));
    }
}

// æ§åˆ¶å™¨ä¸­ç›´æ¥æ¥æ”¶å¯¹è±¡
@GetMapping("/product/{id}")
public String show(@PathVariable Product product) {
    // Springè‡ªåŠ¨æŠŠè·¯å¾„ä¸­çš„IDè½¬æˆProductå¯¹è±¡
    return product.getName();
}
```

---

## 4. ğŸ­ ConverterFactoryå·¥å‚æ¨¡å¼


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ConverterFactory


**é—®é¢˜åœºæ™¯**ï¼š

```
å¦‚æœæœ‰10ä¸ªæšä¸¾ç±»ï¼Œéœ€è¦10ä¸ªè½¬æ¢å™¨ï¼Ÿ

UserStatusã€OrderStatusã€PayStatus...
æ¯ä¸ªéƒ½å†™ä¸€ä¸ªStringToXxxConverterï¼Ÿå¤ªç¹çï¼

è§£å†³æ–¹æ¡ˆï¼šç”¨ConverterFactoryä¸€æ¬¡æ€§è§£å†³
```

**ConverterFactoryæ¥å£**ï¼š

```java
public interface ConverterFactory<S, R> {
    // Sæ˜¯æºç±»å‹ï¼ŒRæ˜¯ç›®æ ‡ç±»å‹çš„çˆ¶ç±»
    <T extends R> Converter<S, T> getConverter(Class<T> targetType);
}
```

### 4.2 å­—ç¬¦ä¸²è½¬æšä¸¾çš„é€šç”¨æ–¹æ¡ˆ


```java
// ä¸€ä¸ªå·¥å‚æå®šæ‰€æœ‰æšä¸¾è½¬æ¢
public class StringToEnumConverterFactory 
        implements ConverterFactory<String, Enum> {
    
    @Override
    public <T extends Enum> Converter<String, T> getConverter(Class<T> targetType) {
        return new StringToEnumConverter(targetType);
    }
    
    // å†…éƒ¨è½¬æ¢å™¨ç±»
    private static class StringToEnumConverter<T extends Enum> 
            implements Converter<String, T> {
        
        private Class<T> enumType;
        
        public StringToEnumConverter(Class<T> enumType) {
            this.enumType = enumType;
        }
        
        @Override
        public T convert(String source) {
            return (T) Enum.valueOf(enumType, source.toUpperCase());
        }
    }
}
```

**å·¥ä½œåŸç†å›¾è§£**ï¼š

```
è¯·æ±‚ï¼šstatus=activeï¼ˆç›®æ ‡ç±»å‹ï¼šUserStatusï¼‰
    â†“
ConverterFactory.getConverter(UserStatus.class)
    â†“
è¿”å›ä¸“é—¨çš„StringToEnumConverter<UserStatus>
    â†“
æ‰§è¡Œè½¬æ¢ï¼šUserStatus.valueOf("ACTIVE")
    â†“
ç»“æœï¼šUserStatus.ACTIVE
```

**ä¼˜åŠ¿å¯¹æ¯”**ï¼š

| æ–¹å¼ | ä»£ç é‡ | ç»´æŠ¤æ€§ |
|-----|-------|--------|
| âŒ **æ¯ä¸ªæšä¸¾å†™ä¸€ä¸ªConverter** | `10ä¸ªæšä¸¾=10ä¸ªç±»` | `æ–°å¢æšä¸¾è¦åŠ ä»£ç ` |
| âœ… **ä½¿ç”¨ConverterFactory** | `1ä¸ªå·¥å‚ç±»æå®š` | `æ–°å¢æšä¸¾æ— éœ€æ”¹ä»£ç ` |

---

## 5. ğŸ”„ GenericConverteré€šç”¨è½¬æ¢å™¨


### 5.1 ä»€ä¹ˆæ—¶å€™ç”¨GenericConverter


> âš ï¸ **ä½¿ç”¨åœºæ™¯**ï¼šå½“Converterå’ŒConverterFactoryéƒ½æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶

**å…¸å‹åœºæ™¯**ï¼š

- âœ… éœ€è¦æ ¹æ®æºå¯¹è±¡çš„å…·ä½“æƒ…å†µé€‰æ‹©è½¬æ¢é€»è¾‘
- âœ… éœ€è¦è®¿é—®å­—æ®µæ³¨è§£ç­‰å…ƒæ•°æ®
- âœ… éœ€è¦å¤„ç†é›†åˆã€æ•°ç»„ç­‰å¤æ‚ç±»å‹

**æ¥å£å®šä¹‰**ï¼š

```java
public interface GenericConverter {
    
    // æ”¯æŒå“ªäº›ç±»å‹è½¬æ¢
    Set<ConvertiblePair> getConvertibleTypes();
    
    // æ‰§è¡Œè½¬æ¢ï¼ˆå¸¦ç±»å‹æè¿°ç¬¦ï¼‰
    Object convert(Object source, 
                   TypeDescriptor sourceType, 
                   TypeDescriptor targetType);
}
```

### 5.2 å®æˆ˜ç¤ºä¾‹ï¼šé›†åˆè½¬æ¢


**åœºæ™¯ï¼šæŠŠé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²è½¬æˆList**

```java
public class StringToListConverter implements GenericConverter {
    
    @Override
    public Set<ConvertiblePair> getConvertibleTypes() {
        return Collections.singleton(
            new ConvertiblePair(String.class, List.class)
        );
    }
    
    @Override
    public Object convert(Object source, 
                         TypeDescriptor sourceType, 
                         TypeDescriptor targetType) {
        
        String str = (String) source;
        // "1,2,3" â†’ ["1", "2", "3"]
        String[] items = str.split(",");
        
        // è·å–Listä¸­å…ƒç´ çš„ç±»å‹
        Class<?> elementType = targetType.getElementTypeDescriptor()
                                         .getType();
        
        List<Object> result = new ArrayList<>();
        for (String item : items) {
            // é€’å½’è½¬æ¢æ¯ä¸ªå…ƒç´ 
            Object element = conversionService.convert(item.trim(), elementType);
            result.add(element);
        }
        
        return result;
    }
}
```

**ä½¿ç”¨æ•ˆæœ**ï¼š

```java
// "1,2,3" â†’ List<Integer>[1, 2, 3]
List<Integer> numbers = service.convert("1,2,3", List.class);

// "å¼ ä¸‰,æå››,ç‹äº”" â†’ List<String>["å¼ ä¸‰", "æå››", "ç‹äº”"]
List<String> names = service.convert("å¼ ä¸‰,æå››,ç‹äº”", List.class);
```

### 5.3 ConditionalGenericConverteræ¡ä»¶è½¬æ¢


**å¸¦æ¡ä»¶åˆ¤æ–­çš„è½¬æ¢å™¨**ï¼š

```java
public class SmartConverter implements ConditionalGenericConverter {
    
    @Override
    public boolean matches(TypeDescriptor sourceType, 
                          TypeDescriptor targetType) {
        // åªæœ‰ç›®æ ‡å­—æ®µå¸¦@DateFormatæ³¨è§£æ‰è½¬æ¢
        return targetType.hasAnnotation(DateFormat.class);
    }
    
    @Override
    public Object convert(Object source, ...) {
        DateFormat annotation = targetType.getAnnotation(DateFormat.class);
        String pattern = annotation.pattern();
        // æ ¹æ®æ³¨è§£ä¸­çš„æ ¼å¼è½¬æ¢
        return new SimpleDateFormat(pattern).parse((String) source);
    }
}
```

---

## 6. ğŸ“ è½¬æ¢å™¨æ³¨å†Œä¸é…ç½®


### 6.1 æ³¨å†Œæ–¹å¼å¯¹æ¯”


**æ–¹å¼ä¸€ï¼šJavaé…ç½®ç±»**

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addFormatters(FormatterRegistry registry) {
        
        // æ³¨å†ŒConverter
        registry.addConverter(new StringToDateConverter());
        
        // æ³¨å†ŒConverterFactory
        registry.addConverterFactory(new StringToEnumConverterFactory());
        
        // æ³¨å†ŒGenericConverter
        registry.addConverter(new StringToListConverter());
    }
}
```

**æ–¹å¼äºŒï¼šXMLé…ç½®**

```xml
<mvc:annotation-driven conversion-service="conversionService"/>

<bean id="conversionService" 
      class="org.springframework.format.support.FormattingConversionServiceFactoryBean">
    <property name="converters">
        <set>
            <bean class="com.example.StringToDateConverter"/>
            <bean class="com.example.StringToUserConverter"/>
        </set>
    </property>
</bean>
```

**æ–¹å¼ä¸‰ï¼šSpring Bootè‡ªåŠ¨é…ç½®**

```java
@Component  // ç›´æ¥ç”¨@Componentæ³¨è§£
public class StringToDateConverter implements Converter<String, Date> {
    @Override
    public Date convert(String source) {
        // è½¬æ¢é€»è¾‘
    }
}

// Spring Bootä¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œ
```

### 6.2 é…ç½®ä¼˜å…ˆçº§


```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

â‘  ç”¨æˆ·è‡ªå®šä¹‰è½¬æ¢å™¨ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    â†“
â‘¡ Springæ³¨å†Œçš„é»˜è®¤è½¬æ¢å™¨
    â†“
â‘¢ ç±»å‹è‡ªåŠ¨è½¬æ¢ï¼ˆå¦‚Integer â†’ Longï¼‰
```

**ç¤ºä¾‹ï¼šè¦†ç›–é»˜è®¤è½¬æ¢å™¨**

```java
// Springé»˜è®¤Stringâ†’Integerä¼šå»æ‰ç©ºæ ¼
// è‡ªå®šä¹‰ï¼šç©ºå­—ç¬¦ä¸²è½¬ä¸ºnull
public class MyStringToIntegerConverter implements Converter<String, Integer> {
    
    @Override
    public Integer convert(String source) {
        if (source.trim().isEmpty()) {
            return null;  // ç©ºå­—ç¬¦ä¸²è¿”å›null
        }
        return Integer.parseInt(source.trim());
    }
}

// æ³¨å†Œåä¼šè¦†ç›–Springé»˜è®¤çš„è½¬æ¢å™¨
```

---

## 7. ğŸ”— è½¬æ¢å™¨é“¾æœºåˆ¶


### 7.1 ä»€ä¹ˆæ˜¯è½¬æ¢å™¨é“¾


**æ¦‚å¿µ**ï¼šå¤šä¸ªè½¬æ¢å™¨åä½œå®Œæˆä¸€æ¬¡è½¬æ¢

```
è½¬æ¢é“¾ç¤ºä¾‹ï¼š

String "100" â†’ Long â†’ BigDecimal
    â†“           â†“         â†“
è½¬æ¢å™¨1     è½¬æ¢å™¨2    è½¬æ¢å™¨3
```

**è‡ªåŠ¨é“¾å¼è°ƒç”¨**ï¼š

```java
// Springä¼šè‡ªåŠ¨ç»„åˆè½¬æ¢å™¨
String str = "100";
BigDecimal result = service.convert(str, BigDecimal.class);

// å†…éƒ¨æ‰§è¡Œè¿‡ç¨‹ï¼š
// â‘  String â†’ Integer ï¼ˆå†…ç½®è½¬æ¢å™¨ï¼‰
// â‘¡ Integer â†’ Long    ï¼ˆå†…ç½®è½¬æ¢å™¨ï¼‰
// â‘¢ Long â†’ BigDecimal ï¼ˆå†…ç½®è½¬æ¢å™¨ï¼‰
```

### 7.2 è½¬æ¢è·¯å¾„é€‰æ‹©


**Springå¦‚ä½•é€‰æ‹©è½¬æ¢è·¯å¾„ï¼Ÿ**

```
ç›®æ ‡ï¼šString â†’ Date

å¯èƒ½çš„è·¯å¾„ï¼š
è·¯å¾„1ï¼šString â†’ Date ï¼ˆç›´æ¥è½¬æ¢ï¼‰â­æœ€ä¼˜
è·¯å¾„2ï¼šString â†’ Long â†’ Date ï¼ˆä¸¤æ­¥è½¬æ¢ï¼‰
è·¯å¾„3ï¼šString â†’ Integer â†’ Long â†’ Date ï¼ˆä¸‰æ­¥è½¬æ¢ï¼‰

é€‰æ‹©åŸåˆ™ï¼š
âœ… ä¼˜å…ˆç›´æ¥è½¬æ¢
âœ… å…¶æ¬¡æœ€çŸ­è·¯å¾„
âœ… æœ€åè€ƒè™‘é€šç”¨è½¬æ¢
```

**è·¯å¾„é€‰æ‹©ç¤ºæ„å›¾**ï¼š

```
          String
         /   |   \
        â†“    â†“    â†“
    Integer Long Date
        \    |    â†‘
         \   |   /
          â†“  â†“  â†“
         BigDecimal

Springä¼šæ‰¾æœ€çŸ­è·¯å¾„å®Œæˆè½¬æ¢
```

### 7.3 è‡ªå®šä¹‰è½¬æ¢é“¾


```java
// åœºæ™¯ï¼šJSONå­—ç¬¦ä¸² â†’ Map â†’ Userå¯¹è±¡

// è½¬æ¢å™¨1ï¼šString â†’ Map
public class JsonToMapConverter implements Converter<String, Map> {
    @Override
    public Map convert(String json) {
        return new ObjectMapper().readValue(json, Map.class);
    }
}

// è½¬æ¢å™¨2ï¼šMap â†’ User
public class MapToUserConverter implements Converter<Map, User> {
    @Override
    public User convert(Map map) {
        User user = new User();
        user.setName((String) map.get("name"));
        user.setAge((Integer) map.get("age"));
        return user;
    }
}

// ä½¿ç”¨æ—¶è‡ªåŠ¨é“¾å¼è°ƒç”¨
String json = "{\"name\":\"å¼ ä¸‰\",\"age\":25}";
User user = service.convert(json, User.class);
// â‘  String â†’ Map ï¼ˆè½¬æ¢å™¨1ï¼‰
// â‘¡ Map â†’ User   ï¼ˆè½¬æ¢å™¨2ï¼‰
```

---

## 8. ğŸ¯ ç±»å‹åŒ¹é…ä¸å¼‚å¸¸å¤„ç†


### 8.1 ç±»å‹åŒ¹é…è§„åˆ™


**ç²¾ç¡®åŒ¹é… vs æ¨¡ç³ŠåŒ¹é…**ï¼š

```java
// ç²¾ç¡®åŒ¹é…ï¼šæºç±»å‹å’Œç›®æ ‡ç±»å‹å®Œå…¨ä¸€è‡´
Converter<String, Integer> exactMatch;

// æ¨¡ç³ŠåŒ¹é…ï¼šæ”¯æŒå­ç±»å‹
Converter<Object, Number> fuzzyMatch;  // Stringä¹Ÿèƒ½åŒ¹é…Object
```

**æ³›å‹æ“¦é™¤é—®é¢˜**ï¼š

```java
// âŒ è¿è¡Œæ—¶æ— æ³•åŒºåˆ†List<String>å’ŒList<Integer>
List<String> list1 = service.convert("a,b,c", List.class);
List<Integer> list2 = service.convert("1,2,3", List.class);

// âœ… ä½¿ç”¨TypeDescriptorè§£å†³
TypeDescriptor targetType = TypeDescriptor.collection(List.class, 
                                          TypeDescriptor.valueOf(Integer.class));
List<Integer> list = service.convert("1,2,3", targetType);
```

### 8.2 è½¬æ¢å¼‚å¸¸å¤„ç†


**å¸¸è§å¼‚å¸¸ç±»å‹**ï¼š

| å¼‚å¸¸ | åŸå›  | å¤„ç†å»ºè®® |
|-----|------|---------|
| `ConversionFailedException` | `è½¬æ¢å¤±è´¥` | `æ•è·å¹¶è¿”å›å‹å¥½é”™è¯¯` |
| `ConverterNotFoundException` | `æ‰¾ä¸åˆ°è½¬æ¢å™¨` | `æ³¨å†Œç›¸åº”è½¬æ¢å™¨` |
| `TypeMismatchException` | `ç±»å‹ä¸åŒ¹é…` | `æ£€æŸ¥å‚æ•°ç±»å‹` |

**å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ**ï¼š

```java
public class SafeStringToIntegerConverter implements Converter<String, Integer> {
    
    @Override
    public Integer convert(String source) {
        try {
            // é˜²å¾¡å¼ç¼–ç¨‹
            if (source == null || source.trim().isEmpty()) {
                return null;
            }
            return Integer.parseInt(source.trim());
            
        } catch (NumberFormatException e) {
            // è®°å½•æ—¥å¿—
            logger.warn("æ— æ³•è½¬æ¢å­—ç¬¦ä¸²ä¸ºæ•´æ•°: {}", source);
            // æŠ›å‡ºæ˜ç¡®çš„å¼‚å¸¸
            throw new ConversionFailedException(
                TypeDescriptor.valueOf(String.class),
                TypeDescriptor.valueOf(Integer.class),
                source,
                e
            );
        }
    }
}
```

**å…¨å±€å¼‚å¸¸å¤„ç†å™¨**ï¼š

```java
@ControllerAdvice
public class ConversionExceptionHandler {
    
    @ExceptionHandler(ConversionFailedException.class)
    public ResponseEntity<String> handleConversionError(ConversionFailedException ex) {
        String message = String.format(
            "æ•°æ®è½¬æ¢å¤±è´¥ï¼šæ— æ³•å°† %s è½¬æ¢ä¸º %s",
            ex.getSourceType().getName(),
            ex.getTargetType().getName()
        );
        return ResponseEntity.badRequest().body(message);
    }
}
```

### 8.3 è½¬æ¢å¤±è´¥çš„é™çº§ç­–ç•¥


```java
public class FallbackConverter implements GenericConverter {
    
    @Override
    public Object convert(Object source, 
                         TypeDescriptor sourceType, 
                         TypeDescriptor targetType) {
        try {
            // å°è¯•ä¸»è¦è½¬æ¢é€»è¾‘
            return primaryConvert(source);
            
        } catch (Exception e) {
            // è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨é™çº§ç­–ç•¥
            logger.warn("è½¬æ¢å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼", e);
            return getDefaultValue(targetType);
        }
    }
    
    private Object getDefaultValue(TypeDescriptor type) {
        if (type.getType() == Integer.class) return 0;
        if (type.getType() == String.class) return "";
        if (type.getType() == Boolean.class) return false;
        return null;
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 è½¬æ¢å™¨é€‰æ‹©æŒ‡å—


```
ä½¿ç”¨å†³ç­–æ ‘ï¼š

éœ€è¦è½¬æ¢æ•°æ®ï¼Ÿ
    â†“
æ˜¯ä¸€å¯¹ä¸€ç®€å•è½¬æ¢ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ç”¨Converterï¼ˆæœ€ç®€å•ï¼‰
    â””â”€ å¦ â†’ ç»§ç»­åˆ¤æ–­
              â†“
        æ˜¯ä¸€å¯¹å¤šè½¬æ¢ï¼ˆå¦‚Stringâ†’å„ç§æšä¸¾ï¼‰ï¼Ÿ
            â”œâ”€ æ˜¯ â†’ ç”¨ConverterFactory
            â””â”€ å¦ â†’ ç”¨GenericConverterï¼ˆæœ€å¼ºå¤§ï¼‰
```

### 9.2 æœ€ä½³å®è·µæ¸…å•


- âœ… **ä¼˜å…ˆä½¿ç”¨Converter**ï¼šç®€å•åœºæ™¯ä¸è¦è¿‡åº¦è®¾è®¡
- âœ… **å·¥å‚æ¨¡å¼å¤ç”¨ä»£ç **ï¼šé¿å…é‡å¤çš„è½¬æ¢å™¨ç±»
- âœ… **å¼‚å¸¸å¤„ç†è¦å®Œå–„**ï¼šæä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- âœ… **æ³¨æ„ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨TypeDescriptorå¤„ç†æ³›å‹
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜è½¬æ¢å™¨å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»º

### 9.3 å¸¸è§é—®é¢˜é€ŸæŸ¥


**Q1ï¼šè½¬æ¢å™¨ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠï¼Ÿ**
```
æ£€æŸ¥æ¸…å•ï¼š
â‘  è½¬æ¢å™¨æ˜¯å¦æ­£ç¡®æ³¨å†Œåˆ°ConversionService
â‘¡ ç±»å‹æ˜¯å¦å®Œå…¨åŒ¹é…ï¼ˆåŒ…æ‹¬æ³›å‹ï¼‰
â‘¢ æ˜¯å¦è¢«å…¶ä»–è½¬æ¢å™¨è¦†ç›–
```

**Q2ï¼šå¦‚ä½•è°ƒè¯•è½¬æ¢è¿‡ç¨‹ï¼Ÿ**
```java
// å¼€å¯DEBUGæ—¥å¿—
logging.level.org.springframework.core.convert=DEBUG

// æ£€æŸ¥å·²æ³¨å†Œçš„è½¬æ¢å™¨
ConversionService service = ...;
System.out.println(service.toString());  // æ‰“å°æ‰€æœ‰è½¬æ¢å™¨
```

**Q3ï¼šæ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Ÿ**
```
â‘  è½¬æ¢å™¨ä¸­é¿å…å¤æ‚è®¡ç®—
â‘¡ ä½¿ç”¨ç¼“å­˜å­˜å‚¨è½¬æ¢ç»“æœ
â‘¢ è€ƒè™‘ä½¿ç”¨å¼‚æ­¥è½¬æ¢ï¼ˆå¤§æ•°æ®é‡ï¼‰
```

### 9.4 çŸ¥è¯†å…³è”å›¾


```
æ•°æ®è½¬æ¢æœåŠ¡ä½“ç³»
    â”œâ”€â”€ æ ¸å¿ƒæ¥å£
    â”‚   â”œâ”€â”€ ConversionServiceï¼ˆæœåŠ¡å…¥å£ï¼‰
    â”‚   â”œâ”€â”€ Converterï¼ˆä¸€å¯¹ä¸€è½¬æ¢ï¼‰
    â”‚   â”œâ”€â”€ ConverterFactoryï¼ˆä¸€å¯¹å¤šè½¬æ¢ï¼‰
    â”‚   â””â”€â”€ GenericConverterï¼ˆé€šç”¨è½¬æ¢ï¼‰
    â”‚
    â”œâ”€â”€ é…ç½®æ–¹å¼
    â”‚   â”œâ”€â”€ Javaé…ç½®ï¼ˆæ¨èï¼‰
    â”‚   â”œâ”€â”€ XMLé…ç½®
    â”‚   â””â”€â”€ è‡ªåŠ¨é…ç½®ï¼ˆSpring Bootï¼‰
    â”‚
    â”œâ”€â”€ é«˜çº§ç‰¹æ€§
    â”‚   â”œâ”€â”€ è½¬æ¢å™¨é“¾
    â”‚   â”œâ”€â”€ ç±»å‹åŒ¹é…
    â”‚   â””â”€â”€ å¼‚å¸¸å¤„ç†
    â”‚
    â””â”€â”€ å®é™…åº”ç”¨
        â”œâ”€â”€ è¡¨å•æ•°æ®ç»‘å®š
        â”œâ”€â”€ è·¯å¾„å˜é‡è½¬æ¢
        â””â”€â”€ è¯·æ±‚å‚æ•°è½¬æ¢
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> è½¬æ¢æœåŠ¡åƒç¿»è¯‘ï¼Œç±»å‹ä¸åŒå®ƒæ¥æ”¹  
> Converterç®€å•ç”¨ï¼ŒFactoryæ‰¹é‡å¸¦  
> GenericåŠŸèƒ½å¼ºï¼Œå¤æ‚åœºæ™¯ä¸æ€•éš¾  
> æ³¨å†Œé…ç½®è¦åšå¥½ï¼Œå¼‚å¸¸å¤„ç†ä¿å®‰å…¨