---
title: 5ã€éƒ¨ç½²ä¸å®¹å™¨åŒ–é…ç½®
---
## ğŸ“š ç›®å½•

1. [éƒ¨ç½²åŸºç¡€æ¦‚å¿µ](#1-éƒ¨ç½²åŸºç¡€æ¦‚å¿µ)
2. [WARåŒ…éƒ¨ç½²é…ç½®](#2-WARåŒ…éƒ¨ç½²é…ç½®)
3. [åµŒå…¥å¼å®¹å™¨é…ç½®](#3-åµŒå…¥å¼å®¹å™¨é…ç½®)
4. [å®¹å™¨å¯åŠ¨ç”Ÿå‘½å‘¨æœŸ](#4-å®¹å™¨å¯åŠ¨ç”Ÿå‘½å‘¨æœŸ)
5. [Dockerå®¹å™¨åŒ–éƒ¨ç½²](#5-Dockerå®¹å™¨åŒ–éƒ¨ç½²)
6. [Kubernetesé›†æˆ](#6-Kubernetesé›†æˆ)
7. [å¥åº·æ£€æŸ¥ä¸ä¼˜é›…åœæœº](#7-å¥åº·æ£€æŸ¥ä¸ä¼˜é›…åœæœº)
8. [æ»šåŠ¨æ›´æ–°ç­–ç•¥](#8-æ»šåŠ¨æ›´æ–°ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ éƒ¨ç½²åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åº”ç”¨éƒ¨ç½²


**ç”Ÿæ´»åŒ–ç†è§£**ï¼š
æƒ³è±¡ä½ å¼€äº†ä¸€å®¶é¤å…ï¼ˆåº”ç”¨ç¨‹åºï¼‰ï¼Œéƒ¨ç½²å°±æ˜¯æŠŠé¤å…ä»"è£…ä¿®é˜¶æ®µ"æ¬åˆ°"æ­£å¼è¥ä¸š"çš„è¿‡ç¨‹ã€‚

```
å¼€å‘ç¯å¢ƒï¼ˆå¨æˆ¿æµ‹è¯•ï¼‰  â†’  æ‰“åŒ…ï¼ˆè£…ç›’å¤–å–ï¼‰  â†’  éƒ¨ç½²ï¼ˆé€åˆ°é¡¾å®¢æ‰‹ä¸­ï¼‰  â†’  è¿è¡Œï¼ˆé¡¾å®¢äº«ç”¨ï¼‰
```

**æŠ€æœ¯å®šä¹‰**ï¼š
éƒ¨ç½²å°±æ˜¯æŠŠå¼€å‘å¥½çš„Spring MVCåº”ç”¨ç¨‹åºï¼Œæ”¾åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œè®©ç”¨æˆ·å¯ä»¥è®¿é—®ã€‚

### 1.2 éƒ¨ç½²æ–¹å¼å¯¹æ¯”


| éƒ¨ç½²æ–¹å¼ | ç®€å•ç†è§£ | é€‚ç”¨åœºæ™¯ | éš¾åº¦ |
|---------|---------|---------|------|
| **ä¼ ç»ŸWARåŒ…** | æŠŠåº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œæ”¾åˆ°Tomcaté‡Œ | ä¼ ç»Ÿä¼ä¸šé¡¹ç›® | ğŸŒŸğŸŒŸ |
| **åµŒå…¥å¼å®¹å™¨** | åº”ç”¨è‡ªå¸¦æœåŠ¡å™¨ï¼Œç›´æ¥è¿è¡Œ | ç°ä»£å¾®æœåŠ¡ | ğŸŒŸ |
| **Dockerå®¹å™¨** | æŠŠåº”ç”¨å’Œç¯å¢ƒä¸€èµ·æ‰“åŒ… | äº‘åŸç”Ÿåº”ç”¨ | ğŸŒŸğŸŒŸğŸŒŸ |
| **Kubernetes** | è‡ªåŠ¨ç®¡ç†å¤šä¸ªå®¹å™¨ | å¤§è§„æ¨¡é›†ç¾¤ | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ |

**ğŸ“ æ–°æ‰‹å»ºè®®**ï¼šå…ˆå­¦ä¼ ç»ŸWARåŒ…ï¼Œå†å­¦åµŒå…¥å¼ï¼Œæœ€åå­¦å®¹å™¨åŒ–

---

## 2. ğŸ“¦ WARåŒ…éƒ¨ç½²é…ç½®


### 2.1 WARåŒ…æ˜¯ä»€ä¹ˆ


**ğŸ”¸ é€šä¿—è§£é‡Š**ï¼š
WARï¼ˆWeb Archiveï¼‰å°±åƒä¸€ä¸ª"å‹ç¼©åŒ…"ï¼ŒæŠŠä½ çš„æ•´ä¸ªç½‘ç«™æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ã€‚

```
ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹              WARåŒ…ï¼ˆæ‰“åŒ…åï¼‰
â”œâ”€â”€ src/                  â†’  myapp.war
â”‚   â”œâ”€â”€ controller/          ï¼ˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ resources/
â””â”€â”€ webapp/
```

**ğŸ”¸ WARåŒ…ç»“æ„**ï¼š

```
myapp.war/
â”œâ”€â”€ WEB-INF/              â† æ ¸å¿ƒé…ç½®ç›®å½•ï¼ˆç”¨æˆ·è®¿é—®ä¸åˆ°ï¼‰
â”‚   â”œâ”€â”€ web.xml          â† Servleté…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ classes/         â† ç¼–è¯‘åçš„.classæ–‡ä»¶
â”‚   â””â”€â”€ lib/             â† ä¾èµ–çš„jaråŒ…
â”œâ”€â”€ META-INF/            â† å…ƒæ•°æ®ä¿¡æ¯
â””â”€â”€ static/              â† é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ç­‰ï¼‰
```

### 2.2 åˆ›å»ºWARåŒ…é…ç½®


**æ­¥éª¤ä¸€ï¼šä¿®æ”¹pom.xmlæ‰“åŒ…æ–¹å¼**

```xml
<project>
    <!-- æŒ‡å®šæ‰“åŒ…ç±»å‹ä¸ºwar -->
    <packaging>war</packaging>
    
    <dependencies>
        <!-- Tomcatç›¸å…³ä¾èµ–è®¾ä¸ºprovidedï¼ˆæœåŠ¡å™¨å·²æä¾›ï¼‰ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
            <scope>provided</scope>
        </dependency>
    </dependencies>
</project>
```

> **ğŸ’¡ ä¸ºä»€ä¹ˆè®¾ç½®providedï¼Ÿ**
> - `provided`è¡¨ç¤º"å·²æä¾›çš„"
> - TomcatæœåŠ¡å™¨è‡ªå·±æœ‰è¿™äº›jaråŒ…
> - æ‰“åŒ…æ—¶ä¸éœ€è¦é‡å¤åŒ…å«ï¼Œå‡å°ä½“ç§¯

**æ­¥éª¤äºŒï¼šä¿®æ”¹å¯åŠ¨ç±»**

```java
@SpringBootApplication
public class MyAppApplication extends SpringBootServletInitializer {
    
    public static void main(String[] args) {
        SpringApplication.run(MyAppApplication.class, args);
    }
    
    // é‡å†™configureæ–¹æ³•ï¼Œæ”¯æŒWARåŒ…éƒ¨ç½²
    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
        return builder.sources(MyAppApplication.class);
    }
}
```

> **ğŸ”¸ SpringBootServletInitializeræ˜¯ä»€ä¹ˆï¼Ÿ**
> - è¿™æ˜¯ä¸€ä¸ª"æ¡¥æ¢"ç±»
> - è®©Spring Bootåº”ç”¨èƒ½åœ¨ä¼ ç»ŸTomcatä¸­è¿è¡Œ
> - å°±åƒç»™ä½ çš„åº”ç”¨è£…äº†ä¸€ä¸ª"ç¿»è¯‘å™¨"

### 2.3 éƒ¨ç½²åˆ°Tomcat


**ğŸ”§ éƒ¨ç½²æµç¨‹å›¾**ï¼š

```
å¼€å‘å®Œæˆ â†’ Mavenæ‰“åŒ… â†’ ç”ŸæˆWARåŒ… â†’ å¤åˆ¶åˆ°Tomcat â†’ å¯åŠ¨Tomcat â†’ è®¿é—®åº”ç”¨
   â†“          â†“            â†“            â†“           â†“          â†“
  ä»£ç       mvn package  myapp.war   webapps/   startup.sh  æµè§ˆå™¨
```

**ğŸ“ å…·ä½“æ­¥éª¤**ï¼š

1. **æ‰“åŒ…å‘½ä»¤**
   ```bash
   mvn clean package
   # åœ¨targetç›®å½•ç”Ÿæˆ myapp.war
   ```

2. **éƒ¨ç½²æ­¥éª¤**
   ```bash
   # å¤åˆ¶åˆ°Tomcatçš„webappsç›®å½•
   cp target/myapp.war /tomcat/webapps/
   
   # å¯åŠ¨Tomcat
   /tomcat/bin/startup.sh
   ```

3. **è®¿é—®åº”ç”¨**
   ```
   http://localhost:8080/myapp
                          â†‘
                    WARåŒ…åç§°ï¼ˆå»æ‰.warï¼‰
   ```

**âš ï¸ å¸¸è§é—®é¢˜**ï¼š

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ³• |
|-----|------|---------|
| 404æ‰¾ä¸åˆ°é¡µé¢ | è·¯å¾„ä¸å¯¹ | æ£€æŸ¥è®¿é—®è·¯å¾„æ˜¯å¦åŒ…å«åº”ç”¨å |
| 500æœåŠ¡å™¨é”™è¯¯ | ä¾èµ–å†²çª | æ£€æŸ¥providedä¾èµ–é…ç½® |
| å¯åŠ¨å¤±è´¥ | ç«¯å£å ç”¨ | ä¿®æ”¹Tomcatç«¯å£é…ç½® |

---

## 3. ğŸ”Œ åµŒå…¥å¼å®¹å™¨é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯åµŒå…¥å¼å®¹å™¨


**ğŸ”¸ ä¼ ç»Ÿæ–¹å¼ vs åµŒå…¥å¼**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆå¤–ç½®å®¹å™¨ï¼‰:
å…ˆå®‰è£…Tomcat â†’ å†æŠŠåº”ç”¨æ”¾è¿›å» â†’ å¯åŠ¨Tomcat
   (æˆ¿ä¸œ)         (ç§Ÿå®¢)         (å¼€é—¨è¥ä¸š)

åµŒå…¥å¼å®¹å™¨:
åº”ç”¨è‡ªå¸¦Tomcat â†’ ç›´æ¥è¿è¡Œåº”ç”¨
   (è‡ªå·±çš„æˆ¿å­)     (ç›´æ¥ä½)
```

**ğŸ’¡ ä¼˜åŠ¿å¯¹æ¯”**ï¼š

âœ… **åµŒå…¥å¼å®¹å™¨çš„å¥½å¤„**ï¼š
- ä¸éœ€è¦å•ç‹¬å®‰è£…Tomcat
- ä¸€ä¸ªå‘½ä»¤å°±èƒ½å¯åŠ¨ï¼š`java -jar app.jar`
- é…ç½®ç®€å•ï¼Œé€‚åˆå¾®æœåŠ¡

âŒ **ä¼ ç»ŸWARåŒ…çš„é™åˆ¶**ï¼š
- éœ€è¦å…ˆå®‰è£…é…ç½®Tomcat
- éƒ¨ç½²æ­¥éª¤ç¹ç
- é€‚åˆä¼ ç»Ÿä¼ä¸šé¡¹ç›®

### 3.2 é…ç½®åµŒå…¥å¼Tomcat


**application.ymlé…ç½®ç¤ºä¾‹**ï¼š

```yaml
server:
  port: 8080                    # ç«¯å£å·
  
  tomcat:
    threads:
      max: 200                  # æœ€å¤§çº¿ç¨‹æ•°ï¼ˆèƒ½åŒæ—¶å¤„ç†å¤šå°‘è¯·æ±‚ï¼‰
      min-spare: 10             # æœ€å°ç©ºé—²çº¿ç¨‹
    
    max-connections: 8192       # æœ€å¤§è¿æ¥æ•°
    accept-count: 100           # ç­‰å¾…é˜Ÿåˆ—é•¿åº¦
    
    connection-timeout: 20000   # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    
    basedir: /tmp/tomcat       # ä¸´æ—¶æ–‡ä»¶ç›®å½•
    
    accesslog:
      enabled: true             # å¼€å¯è®¿é—®æ—¥å¿—
      directory: logs           # æ—¥å¿—ç›®å½•
      pattern: combined         # æ—¥å¿—æ ¼å¼
```

**ğŸ”¸ å‚æ•°é€šä¿—è§£é‡Š**ï¼š

- **max-threadsï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰**ï¼š
  - å°±åƒé¤å…çš„æœåŠ¡å‘˜æ•°é‡
  - 200ä¸ªçº¿ç¨‹ = èƒ½åŒæ—¶æœåŠ¡200ä¸ªé¡¾å®¢
  - å¤ªå°‘ä¼šæ’é˜Ÿï¼Œå¤ªå¤šæµªè´¹èµ„æº

- **max-connectionsï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰**ï¼š
  - é¤å…çš„åº§ä½æ•°
  - 8192ä¸ªè¿æ¥ = é¤å…æœ‰8192ä¸ªåº§ä½

- **accept-countï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰**ï¼š
  - é¤å…é—¨å£çš„ç­‰å€™åŒº
  - åº§ä½æ»¡äº†ï¼Œ100ä¸ªäººå¯ä»¥åœ¨å¤–é¢ç­‰

### 3.3 åˆ‡æ¢åµŒå…¥å¼å®¹å™¨


**ä»Tomcatåˆ‡æ¢åˆ°Undertow**ï¼š

```xml
<dependencies>
    <!-- æ’é™¤é»˜è®¤çš„Tomcat -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <exclusions>
            <exclusion>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-tomcat</artifactId>
            </exclusion>
        </exclusions>
    </dependency>
    
    <!-- æ·»åŠ Undertow -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-undertow</artifactId>
    </dependency>
</dependencies>
```

**ğŸ”¸ å®¹å™¨å¯¹æ¯”**ï¼š

| å®¹å™¨ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|---------|
| **Tomcat** | æˆç†Ÿç¨³å®šï¼Œæ–‡æ¡£ä¸°å¯Œ | å¤§éƒ¨åˆ†åœºæ™¯ |
| **Undertow** | æ€§èƒ½æ›´å¥½ï¼Œå†…å­˜å ç”¨å°‘ | é«˜å¹¶å‘åœºæ™¯ |
| **Jetty** | è½»é‡çº§ï¼Œå¯åŠ¨å¿« | å¼€å‘æµ‹è¯• |

---

## 4. ğŸ”„ å®¹å™¨å¯åŠ¨ç”Ÿå‘½å‘¨æœŸ


### 4.1 å¯åŠ¨æµç¨‹å…¨æ™¯


**ğŸ”¸ ç”Ÿå‘½å‘¨æœŸé˜¶æ®µå›¾**ï¼š

```
åº”ç”¨å¯åŠ¨
   â†“
1. åŠ è½½é…ç½®æ–‡ä»¶
   â”œâ”€â”€ application.yml
   â”œâ”€â”€ ç¯å¢ƒå˜é‡
   â””â”€â”€ å‘½ä»¤è¡Œå‚æ•°
   â†“
2. åˆå§‹åŒ–Springå®¹å™¨
   â”œâ”€â”€ æ‰«æç»„ä»¶
   â”œâ”€â”€ åˆ›å»ºBean
   â””â”€â”€ ä¾èµ–æ³¨å…¥
   â†“
3. å¯åŠ¨åµŒå…¥å¼æœåŠ¡å™¨
   â”œâ”€â”€ åˆ›å»ºConnectorï¼ˆè¿æ¥å™¨ï¼‰
   â”œâ”€â”€ é…ç½®çº¿ç¨‹æ± 
   â””â”€â”€ ç»‘å®šç«¯å£
   â†“
4. éƒ¨ç½²Webåº”ç”¨
   â”œâ”€â”€ åŠ è½½Servlet
   â”œâ”€â”€ åˆå§‹åŒ–è¿‡æ»¤å™¨
   â””â”€â”€ æ˜ å°„URL
   â†“
5. å°±ç»ªçŠ¶æ€
   â””â”€â”€ å¼€å§‹æ¥æ”¶è¯·æ±‚
```

### 4.2 ç›‘å¬å¯åŠ¨äº‹ä»¶


**è‡ªå®šä¹‰å¯åŠ¨ç›‘å¬å™¨**ï¼š

```java
@Component
public class AppStartupListener implements ApplicationListener<ApplicationReadyEvent> {
    
    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        // åº”ç”¨å¯åŠ¨å®Œæˆåæ‰§è¡Œ
        System.out.println("ğŸš€ åº”ç”¨å¯åŠ¨å®Œæˆï¼Œå¯ä»¥å¼€å§‹æ¥æ”¶è¯·æ±‚äº†ï¼");
        
        // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›åˆå§‹åŒ–å·¥ä½œ
        initializeCache();
        warmUpConnections();
    }
    
    private void initializeCache() {
        // é¢„çƒ­ç¼“å­˜
    }
    
    private void warmUpConnections() {
        // å»ºç«‹æ•°æ®åº“è¿æ¥æ± 
    }
}
```

**ğŸ”¸ å¸¸ç”¨å¯åŠ¨äº‹ä»¶**ï¼š

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç”¨é€” |
|-----|---------|------|
| `ApplicationStartingEvent` | åº”ç”¨åˆšå¼€å§‹å¯åŠ¨ | æœ€æ—©æœŸåˆå§‹åŒ– |
| `ApplicationEnvironmentPreparedEvent` | ç¯å¢ƒå‡†å¤‡å¥½ | è¯»å–é…ç½® |
| `ApplicationPreparedEvent` | ä¸Šä¸‹æ–‡å‡†å¤‡å¥½ | æ³¨å†ŒBean |
| `ApplicationReadyEvent` | åº”ç”¨å®Œå…¨å¯åŠ¨ | é¢„çƒ­ã€æ£€æŸ¥ |

### 4.3 å¯åŠ¨å¤±è´¥å¤„ç†


**æ·»åŠ å¤±è´¥å¤„ç†å™¨**ï¼š

```java
@Configuration
public class StartupConfig {
    
    @Bean
    public ApplicationRunner checkStartup() {
        return args -> {
            // æ£€æŸ¥å¿…è¦çš„æœåŠ¡
            if (!checkDatabase()) {
                throw new RuntimeException("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼");
            }
            
            if (!checkRedis()) {
                throw new RuntimeException("Redisè¿æ¥å¤±è´¥ï¼");
            }
            
            System.out.println("âœ… æ‰€æœ‰æœåŠ¡æ£€æŸ¥é€šè¿‡");
        };
    }
}
```

---

## 5. ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²


### 5.1 DockeråŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Dockerï¼Ÿ**

ç”Ÿæ´»åŒ–ç±»æ¯”ï¼š
- **è™šæ‹Ÿæœº**ï¼šæ•´æ ‹åˆ«å¢…ï¼ˆåŒ…å«å®Œæ•´æ“ä½œç³»ç»Ÿï¼‰
- **Dockerå®¹å™¨**ï¼šå¿«æ·é…’åº—æˆ¿é—´ï¼ˆå…±äº«åŸºç¡€è®¾æ–½ï¼Œå¯åŠ¨å¿«ï¼‰

```
ä¼ ç»Ÿéƒ¨ç½²:
â”œâ”€â”€ æ“ä½œç³»ç»Ÿï¼ˆWindows/Linuxï¼‰
â”œâ”€â”€ JDKç¯å¢ƒ
â”œâ”€â”€ åº”ç”¨ç¨‹åº
â””â”€â”€ é…ç½®æ–‡ä»¶

Dockeréƒ¨ç½²:
å®¹å™¨é•œåƒï¼ˆæ‰“åŒ…å¥½çš„ä¸€åˆ‡ï¼‰
â”œâ”€â”€ ç²¾ç®€ç‰ˆLinux
â”œâ”€â”€ JDK
â”œâ”€â”€ åº”ç”¨
â””â”€â”€ é…ç½®
```

### 5.2 åˆ›å»ºDockerfile


**ğŸ“ Dockerfileç¤ºä¾‹**ï¼š

```dockerfile
# 1. ä½¿ç”¨å®˜æ–¹Javaé•œåƒä½œä¸ºåŸºç¡€
FROM openjdk:17-slim

# 2. è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# 3. å¤åˆ¶jaråŒ…åˆ°å®¹å™¨
COPY target/myapp.jar app.jar

# 4. æš´éœ²ç«¯å£
EXPOSE 8080

# 5. è®¾ç½®æ—¶åŒºï¼ˆè§£å†³æ—¶é—´é—®é¢˜ï¼‰
ENV TZ=Asia/Shanghai

# 6. å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-jar", "app.jar"]
```

**ğŸ”¸ å‘½ä»¤è§£é‡Š**ï¼š

- **FROM openjdk:17-slim**
  - å°±åƒé€‰æ‹©"æˆ¿é—´ç±»å‹"
  - slimç‰ˆæœ¬æ›´å°ï¼Œå¯åŠ¨æ›´å¿«

- **WORKDIR /app**
  - è®¾ç½®"å®¶ç›®å½•"
  - åç»­æ“ä½œéƒ½åœ¨è¿™ä¸ªç›®å½•

- **COPY**
  - æŠŠæ–‡ä»¶"æ¬è¿›"å®¹å™¨
  - å°±åƒæ¬å®¶å…·è¿›æˆ¿é—´

- **EXPOSE 8080**
  - å‘Šè¯‰Docker"å¼€8080è¿™ä¸ªé—¨"
  - è®©å¤–ç•Œèƒ½è®¿é—®

- **ENTRYPOINT**
  - å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤
  - å°±åƒ"å¼€æœºè‡ªå¯åŠ¨"

### 5.3 æ„å»ºå’Œè¿è¡Œ


**ğŸ”§ æ“ä½œæ­¥éª¤**ï¼š

```bash
# 1. æ„å»ºDockeré•œåƒ
docker build -t myapp:1.0 .
#        â†‘       â†‘      â†‘   â†‘
#      å‘½ä»¤    é•œåƒå  ç‰ˆæœ¬  å½“å‰ç›®å½•

# 2. æŸ¥çœ‹é•œåƒ
docker images
# ä¼šçœ‹åˆ°ï¼šmyapp  1.0  xxx  500MB

# 3. è¿è¡Œå®¹å™¨
docker run -d \
  --name myapp-container \    # å®¹å™¨åç§°
  -p 8080:8080 \              # ç«¯å£æ˜ å°„ï¼ˆä¸»æœº:å®¹å™¨ï¼‰
  -v /logs:/app/logs \        # æŒ‚è½½æ—¥å¿—ç›®å½•
  myapp:1.0

# 4. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker ps
```

**ğŸ”¸ ç«¯å£æ˜ å°„è§£é‡Š**ï¼š

```
ä½ çš„ç”µè„‘ï¼ˆä¸»æœºï¼‰         Dockerå®¹å™¨
    â†“                      â†“
   8080  â†â†’ æ˜ å°„ â†â†’      8080
    â†‘                      â†‘
  å¤–éƒ¨è®¿é—®              åº”ç”¨ç›‘å¬
```

è®¿é—® `http://localhost:8080` â†’ å®é™…è®¿é—®å®¹å™¨å†…çš„8080ç«¯å£

### 5.4 Docker Composeç¼–æ’


**ğŸ“‹ docker-compose.ymlç¤ºä¾‹**ï¼š

```yaml
version: '3.8'

services:
  # åº”ç”¨æœåŠ¡
  app:
    build: .                          # ä½¿ç”¨å½“å‰ç›®å½•çš„Dockerfile
    ports:
      - "8080:8080"                   # ç«¯å£æ˜ å°„
    environment:
      - SPRING_PROFILES_ACTIVE=prod   # ç¯å¢ƒå˜é‡
      - DB_HOST=mysql                 # æ•°æ®åº“åœ°å€
    depends_on:
      - mysql                         # ä¾èµ–MySQLå…ˆå¯åŠ¨
    volumes:
      - ./logs:/app/logs              # æ—¥å¿—æŒä¹…åŒ–
  
  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=123456
      - MYSQL_DATABASE=mydb
    volumes:
      - mysql-data:/var/lib/mysql     # æ•°æ®æŒä¹…åŒ–

volumes:
  mysql-data:                         # å®šä¹‰æ•°æ®å·
```

**ğŸš€ ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡**ï¼š

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f app

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down
```

---

## 6. â˜¸ï¸ Kubernetesé›†æˆ


### 6.1 KubernetesåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯Kubernetesï¼ˆK8sï¼‰ï¼Ÿ**

ç”Ÿæ´»åŒ–ç±»æ¯”ï¼š
- **Docker**ï¼šå•ä¸ªæˆ¿é—´ï¼ˆå®¹å™¨ï¼‰
- **Kubernetes**ï¼šæ™ºèƒ½é…’åº—ç®¡ç†ç³»ç»Ÿ

```
Kubernetesçš„å·¥ä½œï¼š
â”œâ”€â”€ è‡ªåŠ¨åˆ†é…æˆ¿é—´ï¼ˆè°ƒåº¦å®¹å™¨ï¼‰
â”œâ”€â”€ æˆ¿é—´åäº†æ¢æ–°çš„ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
â”œâ”€â”€ å®¢äººå¤šäº†åŠ æˆ¿é—´ï¼ˆè‡ªåŠ¨æ‰©å®¹ï¼‰
â””â”€â”€ ç»Ÿä¸€ç®¡ç†é’¥åŒ™ï¼ˆé…ç½®ç®¡ç†ï¼‰
```

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**ï¼š

| æ¦‚å¿µ | é€šä¿—è§£é‡Š | ä½œç”¨ |
|-----|---------|------|
| **Pod** | æœ€å°çš„æˆ¿é—´å•å…ƒ | è¿è¡Œ1ä¸ªæˆ–å¤šä¸ªå®¹å™¨ |
| **Deployment** | æˆ¿é—´ç®¡ç†æ–¹æ¡ˆ | ç®¡ç†Podçš„åˆ›å»ºå’Œæ›´æ–° |
| **Service** | å‰å°æ¥å¾… | ç»Ÿä¸€è®¿é—®å…¥å£ |
| **ConfigMap** | é…ç½®æ¸…å• | å­˜å‚¨é…ç½®ä¿¡æ¯ |

### 6.2 åˆ›å»ºéƒ¨ç½²é…ç½®


**ğŸ“ deployment.yamlç¤ºä¾‹**ï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-deployment
  labels:
    app: myapp
spec:
  replicas: 3                    # è¿è¡Œ3ä¸ªå‰¯æœ¬ï¼ˆ3ä¸ªæˆ¿é—´ï¼‰
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
      - name: myapp
        image: myapp:1.0         # ä½¿ç”¨çš„é•œåƒ
        ports:
        - containerPort: 8080    # å®¹å™¨ç«¯å£
        
        # èµ„æºé™åˆ¶
        resources:
          limits:
            cpu: "1"             # æœ€å¤šç”¨1ä¸ªCPUæ ¸å¿ƒ
            memory: "512Mi"      # æœ€å¤šç”¨512MBå†…å­˜
          requests:
            cpu: "0.5"           # è‡³å°‘éœ€è¦0.5ä¸ªCPU
            memory: "256Mi"      # è‡³å°‘éœ€è¦256MBå†…å­˜
        
        # ç¯å¢ƒå˜é‡
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        
        # å¥åº·æ£€æŸ¥
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
```

**ğŸ”¸ é…ç½®è§£é‡Š**ï¼š

- **replicas: 3**
  - åŒæ—¶è¿è¡Œ3ä¸ªåº”ç”¨å®ä¾‹
  - å°±åƒå¼€3ä¸ªæ”¶é“¶å°ï¼Œåˆ†æµé¡¾å®¢

- **resources**
  - é™åˆ¶æ¯ä¸ªå®ä¾‹çš„èµ„æºä½¿ç”¨
  - é˜²æ­¢æŸä¸ªå®ä¾‹å ç”¨å¤ªå¤šèµ„æº

- **livenessProbeï¼ˆå­˜æ´»æ¢é’ˆï¼‰**
  - å®šæœŸæ£€æŸ¥åº”ç”¨æ˜¯å¦å¥åº·
  - ä¸å¥åº·å°±é‡å¯ï¼ˆå°±åƒæ¢åçš„ç¯æ³¡ï¼‰

### 6.3 åˆ›å»ºæœåŠ¡é…ç½®


**ğŸ“ service.yamlç¤ºä¾‹**ï¼š

```yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  type: LoadBalancer         # è´Ÿè½½å‡è¡¡ç±»å‹
  selector:
    app: myapp              # é€‰æ‹©è¦ä»£ç†çš„Pod
  ports:
  - protocol: TCP
    port: 80                # æœåŠ¡ç«¯å£ï¼ˆå¤–éƒ¨è®¿é—®ï¼‰
    targetPort: 8080        # ç›®æ ‡ç«¯å£ï¼ˆPodå†…éƒ¨ï¼‰
```

**ğŸ”¸ æœåŠ¡ç±»å‹å¯¹æ¯”**ï¼š

```
ClusterIPï¼ˆé›†ç¾¤å†…éƒ¨ï¼‰:
åªèƒ½åœ¨Kubernetesé›†ç¾¤å†…è®¿é—®
é€‚åˆï¼šåå°æœåŠ¡ã€æ•°æ®åº“

NodePortï¼ˆèŠ‚ç‚¹ç«¯å£ï¼‰:
é€šè¿‡èŠ‚ç‚¹IP+ç«¯å£è®¿é—®
é€‚åˆï¼šå¼€å‘æµ‹è¯•

LoadBalancerï¼ˆè´Ÿè½½å‡è¡¡ï¼‰:
è‡ªåŠ¨åˆ†é…å¤–éƒ¨IP
é€‚åˆï¼šç”Ÿäº§ç¯å¢ƒ
```

### 6.4 éƒ¨ç½²å’Œç®¡ç†


**ğŸ”§ å¸¸ç”¨å‘½ä»¤**ï¼š

```bash
# 1. åº”ç”¨é…ç½®ï¼ˆéƒ¨ç½²ï¼‰
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml

# 2. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get deployments
kubectl get pods
kubectl get services

# 3. æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name>

# 4. æŸ¥çœ‹æ—¥å¿—
kubectl logs <pod-name>
kubectl logs -f <pod-name>  # å®æ—¶æŸ¥çœ‹

# 5. æ‰©å®¹/ç¼©å®¹
kubectl scale deployment myapp-deployment --replicas=5

# 6. æ›´æ–°é•œåƒ
kubectl set image deployment/myapp-deployment myapp=myapp:2.0

# 7. åˆ é™¤èµ„æº
kubectl delete deployment myapp-deployment
```

---

## 7. ğŸ’Š å¥åº·æ£€æŸ¥ä¸ä¼˜é›…åœæœº


### 7.1 å¥åº·æ£€æŸ¥é…ç½®


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥ï¼Ÿ**

ç”Ÿæ´»åŒ–ç±»æ¯”ï¼š
- å°±åƒåŒ»é™¢çš„ä½“æ£€
- å®šæœŸæ£€æŸ¥åº”ç”¨æ˜¯å¦"å¥åº·"
- å‘ç°é—®é¢˜åŠæ—¶"æ²»ç–—"ï¼ˆé‡å¯ï¼‰

**ğŸ“‹ Spring Boot Actuatoré…ç½®**ï¼š

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics   # æš´éœ²çš„ç«¯ç‚¹
  
  endpoint:
    health:
      show-details: always             # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯
      probes:
        enabled: true                  # å¯ç”¨æ¢é’ˆ
  
  health:
    livenessState:
      enabled: true                    # å­˜æ´»æ¢é’ˆ
    readinessState:
      enabled: true                    # å°±ç»ªæ¢é’ˆ
```

**ğŸ”¸ ä¸¤ç§æ¢é’ˆçš„åŒºåˆ«**ï¼š

```
å­˜æ´»æ¢é’ˆï¼ˆLiveness Probeï¼‰- "è¿˜æ´»ç€å—ï¼Ÿ"
â”œâ”€â”€ æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­»é”ã€å´©æºƒ
â”œâ”€â”€ å¤±è´¥â†’é‡å¯å®¹å™¨
â””â”€â”€ è®¿é—®ï¼š/actuator/health/liveness

å°±ç»ªæ¢é’ˆï¼ˆReadiness Probeï¼‰- "å‡†å¤‡å¥½äº†å—ï¼Ÿ"
â”œâ”€â”€ æ£€æŸ¥åº”ç”¨æ˜¯å¦èƒ½å¤„ç†è¯·æ±‚
â”œâ”€â”€ å¤±è´¥â†’æš‚åœæµé‡
â””â”€â”€ è®¿é—®ï¼š/actuator/health/readiness
```

**è‡ªå®šä¹‰å¥åº·æŒ‡æ ‡**ï¼š

```java
@Component
public class CustomHealthIndicator implements HealthIndicator {
    
    @Override
    public Health health() {
        // æ£€æŸ¥æ•°æ®åº“è¿æ¥
        boolean dbOk = checkDatabase();
        
        // æ£€æŸ¥Redisè¿æ¥
        boolean redisOk = checkRedis();
        
        if (dbOk && redisOk) {
            return Health.up()
                .withDetail("database", "æ­£å¸¸")
                .withDetail("redis", "æ­£å¸¸")
                .build();
        } else {
            return Health.down()
                .withDetail("database", dbOk ? "æ­£å¸¸" : "å¼‚å¸¸")
                .withDetail("redis", redisOk ? "æ­£å¸¸" : "å¼‚å¸¸")
                .build();
        }
    }
}
```

### 7.2 ä¼˜é›…åœæœºé…ç½®


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¼˜é›…åœæœºï¼Ÿ**

å¯¹æ¯”ä¸¤ç§åœæœºæ–¹å¼ï¼š

```
æš´åŠ›åœæœºï¼ˆä¸ä¼˜é›…ï¼‰:
æ”¶åˆ°åœæœºä¿¡å· â†’ ç«‹å³å…³é—­ â†’ æ­£åœ¨å¤„ç†çš„è¯·æ±‚è¢«ä¸­æ–­
   â†“              â†“              â†“
 ç”¨æˆ·ç‚¹å‡»      ç›´æ¥æ–­ç”µ       ç”¨æˆ·çœ‹åˆ°é”™è¯¯

ä¼˜é›…åœæœºï¼ˆGraceful Shutdownï¼‰:
æ”¶åˆ°åœæœºä¿¡å· â†’ æ‹’ç»æ–°è¯·æ±‚ â†’ ç­‰å¾…å¤„ç†å®Œ â†’ å…³é—­
   â†“              â†“           â†“          â†“
 ç®¡ç†å‘˜æ“ä½œ    ä¸å†æ¥å®¢    å¤„ç†å®Œè®¢å•   å¹³ç¨³ä¸‹ç­
```

**ğŸ“‹ é…ç½®ä¼˜é›…åœæœº**ï¼š

```yaml
server:
  shutdown: graceful                # å¼€å¯ä¼˜é›…åœæœº

spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s # æœ€å¤šç­‰å¾…30ç§’
```

**ğŸ”¸ å·¥ä½œæµç¨‹**ï¼š

```
1. æ”¶åˆ°åœæœºä¿¡å·ï¼ˆSIGTERMï¼‰
   â†“
2. åœæ­¢æ¥æ”¶æ–°è¯·æ±‚
   â”œâ”€â”€ å¥åº·æ£€æŸ¥è¿”å›DOWN
   â””â”€â”€ è´Ÿè½½å‡è¡¡å™¨ç§»é™¤è¯¥å®ä¾‹
   â†“
3. ç­‰å¾…ç°æœ‰è¯·æ±‚å¤„ç†å®Œ
   â”œâ”€â”€ æœ€å¤šç­‰å¾…30ç§’
   â””â”€â”€ è¶…æ—¶åˆ™å¼ºåˆ¶å…³é—­
   â†“
4. å…³é—­åº”ç”¨
   â”œâ”€â”€ å…³é—­æ•°æ®åº“è¿æ¥
   â”œâ”€â”€ é‡Šæ”¾èµ„æº
   â””â”€â”€ å®Œå…¨é€€å‡º
```

**ç›‘å¬åœæœºäº‹ä»¶**ï¼š

```java
@Component
public class ShutdownListener implements ApplicationListener<ContextClosedEvent> {
    
    @Override
    public void onApplicationEvent(ContextClosedEvent event) {
        System.out.println("ğŸ›‘ åº”ç”¨å³å°†å…³é—­ï¼Œæ­£åœ¨å¤„ç†æ”¶å°¾å·¥ä½œ...");
        
        // ä¿å­˜æœªå®Œæˆçš„ä»»åŠ¡
        saveUnfinishedTasks();
        
        // å…³é—­å¤–éƒ¨è¿æ¥
        closeExternalConnections();
        
        System.out.println("âœ… æ”¶å°¾å·¥ä½œå®Œæˆï¼Œå¯ä»¥å®‰å…¨å…³é—­äº†");
    }
}
```

---

## 8. ğŸ”„ æ»šåŠ¨æ›´æ–°ç­–ç•¥


### 8.1 ä»€ä¹ˆæ˜¯æ»šåŠ¨æ›´æ–°


**ğŸ”¸ æ›´æ–°æ–¹å¼å¯¹æ¯”**ï¼š

```
åœæœºæ›´æ–°ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰:
åœæ­¢æ—§ç‰ˆæœ¬ â†’ éƒ¨ç½²æ–°ç‰ˆæœ¬ â†’ å¯åŠ¨æ–°ç‰ˆæœ¬
    â†“            â†“            â†“
  æœåŠ¡ä¸­æ–­      æ›´æ–°æ–‡ä»¶      æ¢å¤æœåŠ¡
  [ç”¨æˆ·æ— æ³•è®¿é—®æœŸé—´]

æ»šåŠ¨æ›´æ–°ï¼ˆé›¶åœæœºï¼‰:
é€ä¸ªæ›¿æ¢å®ä¾‹ â†’ æ–°æ—§ç‰ˆæœ¬å…±å­˜ â†’ å…¨éƒ¨æ›´æ–°å®Œæˆ
    â†“              â†“              â†“
  æ— éœ€åœæœº      å¹³æ»‘è¿‡æ¸¡        å‡çº§å®Œæˆ
  [ç”¨æˆ·å§‹ç»ˆå¯è®¿é—®]
```

**ğŸ“Š æ»šåŠ¨æ›´æ–°æµç¨‹å›¾**ï¼š

```
åˆå§‹çŠ¶æ€: 3ä¸ªæ—§ç‰ˆæœ¬å®ä¾‹
[V1] [V1] [V1]  â† å…¨éƒ¨è¿è¡Œä¸­

æ­¥éª¤1: å¯åŠ¨1ä¸ªæ–°ç‰ˆæœ¬
[V1] [V1] [V1] [V2]  â† V2å¯åŠ¨å¹¶é€šè¿‡å¥åº·æ£€æŸ¥

æ­¥éª¤2: åœæ­¢1ä¸ªæ—§ç‰ˆæœ¬
[V1] [V1] [V2]  â† V1-1ä¸‹çº¿

æ­¥éª¤3: å¯åŠ¨ç¬¬2ä¸ªæ–°ç‰ˆæœ¬
[V1] [V1] [V2] [V2]

æ­¥éª¤4: ç»§ç»­æ›¿æ¢...
[V1] [V2] [V2]

æ­¥éª¤5: æœ€ç»ˆçŠ¶æ€
[V2] [V2] [V2]  â† å…¨éƒ¨æ›´æ–°å®Œæˆ
```

### 8.2 Kubernetesæ»šåŠ¨æ›´æ–°é…ç½®


**ğŸ“ æ›´æ–°ç­–ç•¥é…ç½®**ï¼š

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  
  strategy:
    type: RollingUpdate           # æ»šåŠ¨æ›´æ–°ç­–ç•¥
    rollingUpdate:
      maxSurge: 1                 # æœ€å¤šå¤šè¿è¡Œ1ä¸ªå®ä¾‹
      maxUnavailable: 0           # æœ€å¤š0ä¸ªå®ä¾‹ä¸å¯ç”¨
  
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:2.0          # æ–°ç‰ˆæœ¬é•œåƒ
        
        # å°±ç»ªæ¢é’ˆï¼ˆç¡®ä¿æ–°ç‰ˆæœ¬å¥åº·æ‰ç»§ç»­ï¼‰
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 20
          periodSeconds: 5
```

**ğŸ”¸ å‚æ•°è¯¦è§£**ï¼š

- **maxSurge: 1**
  - æ›´æ–°æ—¶æœ€å¤šé¢å¤–å¢åŠ 1ä¸ªå®ä¾‹
  - 3ä¸ªå®ä¾‹ â†’ æ›´æ–°æ—¶æœ€å¤š4ä¸ªï¼ˆ3æ—§+1æ–°ï¼‰
  - ä¿è¯æœ‰è¶³å¤Ÿå®¹é‡å¤„ç†è¯·æ±‚

- **maxUnavailable: 0**
  - æ›´æ–°æ—¶0ä¸ªå®ä¾‹ä¸å¯ç”¨
  - ç¡®ä¿å§‹ç»ˆæœ‰å®ä¾‹åœ¨è¿è¡Œ
  - å®ç°é›¶åœæœºæ›´æ–°

### 8.3 æ›´æ–°æ“ä½œå’Œå›æ»š


**ğŸ”§ æ‰§è¡Œæ›´æ–°**ï¼š

```bash
# 1. æ›´æ–°é•œåƒç‰ˆæœ¬
kubectl set image deployment/myapp myapp=myapp:2.0

# 2. æŸ¥çœ‹æ›´æ–°è¿›åº¦
kubectl rollout status deployment/myapp
# è¾“å‡ºï¼šWaiting for deployment "myapp" rollout to finish: 1 out of 3 new replicas...

# 3. æŸ¥çœ‹æ›´æ–°å†å²
kubectl rollout history deployment/myapp
```

**âš ï¸ å‘ç°é—®é¢˜ï¼Œç«‹å³å›æ»š**ï¼š

```bash
# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/myapp

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/myapp --to-revision=2

# æš‚åœæ›´æ–°ï¼ˆå‘ç°é—®é¢˜æ—¶ï¼‰
kubectl rollout pause deployment/myapp

# æ¢å¤æ›´æ–°
kubectl rollout resume deployment/myapp
```

### 8.4 è“ç»¿éƒ¨ç½²ç­–ç•¥


**ğŸ”¸ ä»€ä¹ˆæ˜¯è“ç»¿éƒ¨ç½²ï¼Ÿ**

```
è“ç»¿éƒ¨ç½²åŸç†:

è“è‰²ç¯å¢ƒï¼ˆæ—§ç‰ˆæœ¬ï¼‰        ç»¿è‰²ç¯å¢ƒï¼ˆæ–°ç‰ˆæœ¬ï¼‰
    [V1]                    [V2]
    [V1]                    [V2]
    [V1]                    [V2]
     â†‘                       â†‘
  æµé‡100% â”€â”€â”€â”€åˆ‡æ¢â”€â”€â”€â†’   æµé‡100%
  
æ­¥éª¤ï¼š
1. éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼ˆç»¿ï¼‰åˆ°ç‹¬ç«‹ç¯å¢ƒ
2. æµ‹è¯•éªŒè¯ç»¿è‰²ç¯å¢ƒ
3. ä¸€æ¬¡æ€§åˆ‡æ¢æ‰€æœ‰æµé‡åˆ°ç»¿è‰²
4. å¦‚æœ‰é—®é¢˜ï¼Œç«‹å³åˆ‡å›è“è‰²
```

**ğŸ“‹ ç®€åŒ–é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# è“è‰²æœåŠ¡ï¼ˆV1ï¼‰
apiVersion: v1
kind: Service
metadata:
  name: myapp
spec:
  selector:
    app: myapp
    version: v1      # æŒ‡å‘è“è‰²ç‰ˆæœ¬

---
# ç»¿è‰²éƒ¨ç½²ï¼ˆV2ï¼‰
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-green
spec:
  replicas: 3
  template:
    metadata:
      labels:
        app: myapp
        version: v2  # ç»¿è‰²æ ‡ç­¾
```

**åˆ‡æ¢æµé‡ï¼ˆä¿®æ”¹Serviceï¼‰**ï¼š

```bash
# åˆ‡æ¢åˆ°ç»¿è‰²ç‰ˆæœ¬
kubectl patch service myapp -p '{"spec":{"selector":{"version":"v2"}}}'

# å‡ºé—®é¢˜ç«‹å³åˆ‡å›è“è‰²
kubectl patch service myapp -p '{"spec":{"selector":{"version":"v1"}}}'
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 éƒ¨ç½²æ–¹å¼é€‰æ‹©æŒ‡å—


| åœºæ™¯ | æ¨èæ–¹å¼ | åŸå›  |
|-----|---------|------|
| ğŸ¢ ä¼ ç»Ÿä¼ä¸šé¡¹ç›® | WARåŒ…éƒ¨ç½² | å·²æœ‰Tomcatç¯å¢ƒï¼Œç¨³å®šå¯é  |
| ğŸš€ å¾®æœåŠ¡æ¶æ„ | åµŒå…¥å¼å®¹å™¨ | ç‹¬ç«‹éƒ¨ç½²ï¼Œé…ç½®ç®€å• |
| â˜ï¸ äº‘åŸç”Ÿåº”ç”¨ | Dockerå®¹å™¨ | ç¯å¢ƒä¸€è‡´ï¼Œæ˜“äºè¿ç§» |
| ğŸ“ˆ å¤§è§„æ¨¡é›†ç¾¤ | Kubernetes | è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œå¼¹æ€§ä¼¸ç¼© |

### 9.2 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†


**ğŸ”¸ WARåŒ…éƒ¨ç½²**ï¼š
- ä¿®æ”¹pom.xmlæ‰“åŒ…ç±»å‹ä¸º`war`
- ç»§æ‰¿`SpringBootServletInitializer`
- Tomcatä¾èµ–è®¾ä¸º`provided`

**ğŸ”¸ åµŒå…¥å¼å®¹å™¨**ï¼š
- ç›´æ¥`java -jar`è¿è¡Œ
- é€šè¿‡application.ymlé…ç½®Tomcatå‚æ•°
- å¯åˆ‡æ¢Undertow/Jettyå®¹å™¨

**ğŸ”¸ Dockeréƒ¨ç½²**ï¼š
- ç¼–å†™Dockerfileæ‰“åŒ…åº”ç”¨
- ä½¿ç”¨docker-composeç¼–æ’å¤šæœåŠ¡
- æŒæ¡ç«¯å£æ˜ å°„å’Œæ•°æ®å·æŒ‚è½½

**ğŸ”¸ Kuberneteséƒ¨ç½²**ï¼š
- ç†è§£Podã€Deploymentã€Serviceæ¦‚å¿µ
- é…ç½®å¥åº·æ£€æŸ¥å’Œèµ„æºé™åˆ¶
- æŒæ¡æ»šåŠ¨æ›´æ–°å’Œå›æ»šæ“ä½œ

### 9.3 ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ


**âœ… å¥åº·æ£€æŸ¥å¿…å¤‡**ï¼š
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  health:
    livenessState.enabled: true
    readinessState.enabled: true
```

**âœ… ä¼˜é›…åœæœºå¿…é¡»é…ç½®**ï¼š
```yaml
server:
  shutdown: graceful
spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s
```

**âœ… èµ„æºé™åˆ¶é˜²æ­¢OOM**ï¼š
```yaml
resources:
  limits:
    memory: "512Mi"
    cpu: "1"
  requests:
    memory: "256Mi"
    cpu: "0.5"
```

**âœ… æ—¥å¿—æŒä¹…åŒ–**ï¼š
```yaml
# DockeræŒ‚è½½æ—¥å¿—ç›®å½•
volumes:
  - ./logs:/app/logs
```

### 9.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|---------|---------|
| ç«¯å£è¢«å ç”¨ | 8080ç«¯å£å·²ä½¿ç”¨ | ä¿®æ”¹server.porté…ç½® |
| å®¹å™¨å¯åŠ¨å¤±è´¥ | å¥åº·æ£€æŸ¥è¶…æ—¶ | å¢åŠ initialDelaySeconds |
| æ›´æ–°åæœåŠ¡å¼‚å¸¸ | æ–°ç‰ˆæœ¬æœ‰bug | ç«‹å³æ‰§è¡Œrollout undoå›æ»š |
| å†…å­˜æº¢å‡º | èµ„æºé™åˆ¶å¤ªå° | è°ƒæ•´memory limits |
| æ—¥å¿—ä¸¢å¤± | æœªæŒ‚è½½æ•°æ®å· | é…ç½®volumesæŒä¹…åŒ– |

### 9.5 å­¦ä¹ è·¯çº¿å»ºè®®


**ğŸ¯ æ–°æ‰‹å­¦ä¹ é¡ºåº**ï¼š

```
ç¬¬1æ­¥: WARåŒ…éƒ¨ç½²ï¼ˆ1-2å¤©ï¼‰
â”œâ”€â”€ ç†è§£ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼
â”œâ”€â”€ ç»ƒä¹ æ‰“åŒ…å’Œéƒ¨ç½²åˆ°Tomcat
â””â”€â”€ æŒæ¡åŸºæœ¬é…ç½®

ç¬¬2æ­¥: åµŒå…¥å¼å®¹å™¨ï¼ˆ1å¤©ï¼‰
â”œâ”€â”€ å­¦ä¹ Spring Bootå†…åµŒTomcat
â”œâ”€â”€ ç†Ÿæ‚‰application.ymlé…ç½®
â””â”€â”€ äº†è§£ä¸åŒå®¹å™¨çš„ç‰¹ç‚¹

ç¬¬3æ­¥: DockeråŸºç¡€ï¼ˆ2-3å¤©ï¼‰
â”œâ”€â”€ ç†è§£é•œåƒå’Œå®¹å™¨æ¦‚å¿µ
â”œâ”€â”€ ç¼–å†™Dockerfile
â”œâ”€â”€ æŒæ¡docker-compose
â””â”€â”€ ç»ƒä¹ æœ¬åœ°å®¹å™¨åŒ–éƒ¨ç½²

ç¬¬4æ­¥: Kuberneteså…¥é—¨ï¼ˆ1å‘¨ï¼‰
â”œâ”€â”€ ç†è§£æ ¸å¿ƒæ¦‚å¿µ
â”œâ”€â”€ å­¦ä¹ YAMLé…ç½®
â”œâ”€â”€ æŒæ¡kubectlå‘½ä»¤
â””â”€â”€ ç»ƒä¹ éƒ¨ç½²å’Œæ›´æ–°

ç¬¬5æ­¥: ç”Ÿäº§å®è·µï¼ˆæŒç»­å­¦ä¹ ï¼‰
â”œâ”€â”€ å¥åº·æ£€æŸ¥é…ç½®
â”œâ”€â”€ ä¼˜é›…åœæœºå¤„ç†
â”œâ”€â”€ æ»šåŠ¨æ›´æ–°ç­–ç•¥
â””â”€â”€ ç›‘æ§å’Œæ—¥å¿—
```

**ğŸ“š æ¨èå­¦ä¹ èµ„æº**ï¼š
- Spring Bootå®˜æ–¹æ–‡æ¡£
- Dockerå®˜æ–¹æ•™ç¨‹
- Kubernetesä¸­æ–‡ç¤¾åŒº
- å®é™…é¡¹ç›®ç»ƒä¹ 

---

**ğŸ’¡ æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
éƒ¨ç½²æ–¹å¼é€‰å¯¹è·¯ï¼Œä¼ ç»Ÿæ–°å¼å„æœ‰æ•°
WARåŒ…Tomcatè€æ–¹å¼ï¼ŒåµŒå…¥å®¹å™¨å¾®æœåŠ¡
Dockeræ‰“åŒ…ç¯å¢ƒç¨³ï¼ŒK8sç®¡ç†è§„æ¨¡å¤§
å¥åº·æ£€æŸ¥è¦é…å¥½ï¼Œä¼˜é›…åœæœºä¸èƒ½å°‘
æ»šåŠ¨æ›´æ–°é›¶åœæœºï¼Œå‡ºé—®é¢˜äº†å¿«å›æ»š
```

**ğŸ¯ å®è·µå»ºè®®**ï¼š
1. å…ˆåœ¨æœ¬åœ°æ­å»ºå®Œæ•´ç¯å¢ƒç»ƒä¹ 
2. æ¯ç§éƒ¨ç½²æ–¹å¼éƒ½äº²è‡ªåŠ¨æ‰‹å®è·µ
3. ç†è§£åŸç†æ¯”è®°ä½å‘½ä»¤æ›´é‡è¦
4. ç”Ÿäº§ç¯å¢ƒä¸€å®šè¦åšå¥½ç›‘æ§å’Œå¤‡ä»½