---
title: 3ã€Servletå®¹å™¨é›†æˆé…ç½®
---
## ğŸ“š ç›®å½•

1. [Servletå®¹å™¨åŸºç¡€æ¦‚å¿µ](#1-Servletå®¹å™¨åŸºç¡€æ¦‚å¿µ)
2. [ä¼ ç»Ÿweb.xmlé…ç½®æ–¹å¼](#2-ä¼ ç»Ÿwebxmlé…ç½®æ–¹å¼)
3. [ç°ä»£Javaé…ç½®æ–¹å¼](#3-ç°ä»£Javaé…ç½®æ–¹å¼)
4. [DispatcherServletæ ¸å¿ƒé…ç½®](#4-DispatcherServletæ ¸å¿ƒé…ç½®)
5. [Filterè¿‡æ»¤å™¨é…ç½®](#5-Filterè¿‡æ»¤å™¨é…ç½®)
6. [Listenerç›‘å¬å™¨é…ç½®](#6-Listenerç›‘å¬å™¨é…ç½®)
7. [å¯åŠ¨å‚æ•°ä¸ä¼˜åŒ–é…ç½®](#7-å¯åŠ¨å‚æ•°ä¸ä¼˜åŒ–é…ç½®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ  Servletå®¹å™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Servletå®¹å™¨ï¼Ÿ


> ğŸ’¡ **é€šä¿—ç†è§£**
> 
> æŠŠServletå®¹å™¨æƒ³è±¡æˆä¸€ä¸ª**é…’åº—ç®¡ç†ç³»ç»Ÿ**ï¼š
> - é…’åº—å¤§æ¥¼ = **Servletå®¹å™¨**ï¼ˆå¦‚Tomcatï¼‰
> - æˆ¿é—´ = **Servlet**ï¼ˆå¤„ç†å…·ä½“è¯·æ±‚çš„ç¨‹åºï¼‰
> - å‰å°ç™»è®°ç³»ç»Ÿ = **web.xmlé…ç½®æ–‡ä»¶**
> - é…’åº—ç»ç† = **DispatcherServlet**ï¼ˆSpring MVCçš„æ ¸å¿ƒè°ƒåº¦å™¨ï¼‰

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Servletå®¹å™¨ï¼Ÿ


**ğŸ¯ æ ¸å¿ƒä½œç”¨å¯¹æ¯”è¡¨**

| å¦‚æœæ²¡æœ‰Servletå®¹å™¨ | æœ‰äº†Servletå®¹å™¨ä¹‹å |
|-------------------|-------------------|
| ğŸ˜° éœ€è¦è‡ªå·±å¤„ç†HTTPåè®® | âœ… å®¹å™¨è‡ªåŠ¨è§£æHTTPè¯·æ±‚ |
| ğŸ˜° éœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ | âœ… å®¹å™¨æä¾›çº¿ç¨‹æ± ç®¡ç† |
| ğŸ˜° éœ€è¦è‡ªå·±å†™Socketé€šä¿¡ | âœ… å®¹å™¨å¤„ç†ç½‘ç»œé€šä¿¡ |
| ğŸ˜° ç”Ÿå‘½å‘¨æœŸéœ€è¦è‡ªå·±æ§åˆ¶ | âœ… å®¹å™¨ç®¡ç†Servletç”Ÿå‘½å‘¨æœŸ |

### 1.3 å¸¸è§çš„Servletå®¹å™¨


```
å®¹å™¨å®¶æ—æ ‘ï¼š
â”œâ”€â”€ ğŸ”¸ Tomcatï¼ˆæœ€å¸¸ç”¨ï¼Œè½»é‡çº§ï¼‰
â”œâ”€â”€ ğŸ”¸ Jettyï¼ˆåµŒå…¥å¼å‹å¥½ï¼‰
â”œâ”€â”€ ğŸ”¸ Undertowï¼ˆé«˜æ€§èƒ½ï¼‰
â””â”€â”€ ğŸ”¸ WebLogic/WebSphereï¼ˆä¼ä¸šçº§ï¼‰
```

**é€‰æ‹©å»ºè®®ï¼š**
- ğŸ“ **å­¦ä¹ é˜¶æ®µ**ï¼šTomcatï¼ˆæ–‡æ¡£ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒï¼‰
- ğŸš€ **å¾®æœåŠ¡åœºæ™¯**ï¼šå†…åµŒTomcat/Jettyï¼ˆSpring Booté»˜è®¤ï¼‰
- ğŸ¢ **ä¼ä¸šåº”ç”¨**ï¼šæ ¹æ®å…¬å¸è§„èŒƒé€‰æ‹©

---

## 2. ğŸ“‹ ä¼ ç»Ÿweb.xmlé…ç½®æ–¹å¼


### 2.1 web.xmlæ˜¯ä»€ä¹ˆï¼Ÿ


> ğŸ·ï¸ **ç±»æ¯”è¯´æ˜**
> 
> `web.xml` å°±åƒé…’åº—çš„**è¿è¥æ‰‹å†Œ**ï¼Œå‘Šè¯‰å®¹å™¨ï¼š
> - å“ªäº›æˆ¿é—´ï¼ˆServletï¼‰å¯ä»¥ä½¿ç”¨
> - å®¢äººï¼ˆè¯·æ±‚ï¼‰æ¥äº†è¯¥å»å“ªä¸ªæˆ¿é—´
> - éœ€è¦å“ªäº›å®‰ä¿æªæ–½ï¼ˆFilterï¼‰
> - éœ€è¦ç›‘æ§å“ªäº›äº‹ä»¶ï¼ˆListenerï¼‰

### 2.2 web.xmlçš„åŸºæœ¬ç»“æ„


**ğŸ“Š é…ç½®å±‚æ¬¡å›¾**

```
web.xml
â”œâ”€â”€ <context-param>     â† å…¨å±€å‚æ•°ï¼ˆæ•´ä¸ªé…’åº—çš„è§„åˆ™ï¼‰
â”œâ”€â”€ <listener>          â† ç›‘å¬å™¨ï¼ˆç›‘æ§ç³»ç»Ÿï¼‰
â”œâ”€â”€ <filter>            â† è¿‡æ»¤å™¨ï¼ˆå®‰æ£€é—¨ï¼‰
â”‚   â””â”€â”€ <filter-mapping> â† è¿‡æ»¤è§„åˆ™
â”œâ”€â”€ <servlet>           â† Servletå®šä¹‰ï¼ˆæˆ¿é—´ç™»è®°ï¼‰
â”‚   â””â”€â”€ <servlet-mapping> â† URLæ˜ å°„ï¼ˆæˆ¿é—´å·ç ï¼‰
â””â”€â”€ <welcome-file-list>  â† é»˜è®¤é¦–é¡µ
```

### 2.3 å…¸å‹çš„web.xmlé…ç½®ç¤ºä¾‹


```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         version="4.0">
    
    <!-- â‘  å…¨å±€å‚æ•°ï¼šæ•´ä¸ªåº”ç”¨çš„é…ç½® -->
    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>/WEB-INF/spring/root-context.xml</param-value>
    </context-param>
    
    <!-- â‘¡ ç›‘å¬å™¨ï¼šåº”ç”¨å¯åŠ¨æ—¶åŠ è½½Springå®¹å™¨ -->
    <listener>
        <listener-class>
            org.springframework.web.context.ContextLoaderListener
        </listener-class>
    </listener>
    
    <!-- â‘¢ æ ¸å¿ƒServletï¼šDispatcherServlet -->
    <servlet>
        <servlet-name>dispatcher</servlet-name>
        <servlet-class>
            org.springframework.web.servlet.DispatcherServlet
        </servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>/WEB-INF/spring/dispatcher-servlet.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    
    <!-- â‘£ URLæ˜ å°„ï¼šå“ªäº›è¯·æ±‚äº¤ç»™DispatcherServlet -->
    <servlet-mapping>
        <servlet-name>dispatcher</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
</web-app>
```

**ğŸ” é…ç½®è¯¦è§£ï¼š**

| é…ç½®é¡¹ | ä½œç”¨è¯´æ˜ | ç”Ÿæ´»ç±»æ¯” |
|-------|---------|---------|
| **context-param** | `å…¨å±€é…ç½®å‚æ•°` | é…’åº—çš„æ€»è§„ç« åˆ¶åº¦ |
| **listener** | `ç›‘å¬å™¨é…ç½®` | é…’åº—çš„ç›‘æ§æ‘„åƒå¤´ |
| **servlet** | `Servletå®šä¹‰` | é…’åº—çš„æœåŠ¡å° |
| **servlet-mapping** | `URLè·¯å¾„æ˜ å°„` | å®¢äººæ‰¾æœåŠ¡å°çš„è·¯çº¿å›¾ |
| **load-on-startup** | `å¯åŠ¨é¡ºåºï¼ˆæ•°å­—è¶Šå°è¶Šå…ˆå¯åŠ¨ï¼‰` | VIPä¼˜å…ˆåŠç†ç™»è®° |

### 2.4 web.xmlçš„ä¼˜ç¼ºç‚¹


**ä¼˜åŠ¿ ğŸ‘**
- âœ… é…ç½®é›†ä¸­ï¼Œä¸€ç›®äº†ç„¶
- âœ… ä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç 
- âœ… é€‚åˆä¼ ç»Ÿä¼ä¸šé¡¹ç›®

**åŠ£åŠ¿ ğŸ‘**
- âŒ XMLæ ¼å¼ç¹çï¼Œæ˜“å‡ºé”™
- âŒ ä¿®æ”¹éœ€è¦é‡å¯åº”ç”¨
- âŒ ä¸å¤Ÿçµæ´»ï¼Œéš¾ä»¥åŠ¨æ€è°ƒæ•´

---

## 3. ğŸš€ ç°ä»£Javaé…ç½®æ–¹å¼


### 3.1 ä¸ºä»€ä¹ˆè¦ç”¨Javaé…ç½®ï¼Ÿ


> ğŸ’¡ **æ€ç»´è½¬å˜**
> 
> **ä¼ ç»Ÿæ–¹å¼**ï¼šå†™ä¸€æœ¬åšåšçš„è§„ç« æ‰‹å†Œï¼ˆweb.xmlï¼‰
> 
> **ç°ä»£æ–¹å¼**ï¼šåŸ¹è®­ä¸€ä¸ªæ™ºèƒ½ç®¡å®¶ï¼ˆJavaé…ç½®ç±»ï¼‰ï¼Œè®©å®ƒæŒ‰è§„åˆ™è‡ªåŠ¨å¤„ç†

### 3.2 Servlet 3.0+çš„é©å‘½æ€§å˜åŒ–


**ğŸ¯ æ ¸å¿ƒæœºåˆ¶ï¼šServletContainerInitializer**

```
åº”ç”¨å¯åŠ¨æµç¨‹ï¼š
1. Tomcatå¯åŠ¨
2. è‡ªåŠ¨æ‰«æMETA-INF/servicesç›®å½•
3. å‘ç°ServletContainerInitializerå®ç°ç±»
4. è°ƒç”¨onStartup()æ–¹æ³•
5. å®ŒæˆåŠ¨æ€é…ç½®
```

**ä¸‰å¤§é…ç½®æ¥å£å¯¹æ¯”ï¼š**

| æ¥å£åç§° | ä½œç”¨ | ç±»æ¯” |
|---------|------|------|
| **ServletContainerInitializer** | `å®¹å™¨å¯åŠ¨æ¥å£` | é…’åº—å¼€ä¸šæ€»æŒ‡æŒ¥ |
| **WebApplicationInitializer** | `Springçš„Webåº”ç”¨åˆå§‹åŒ–` | é…’åº—ç»ç†ä¸Šå²—åŸ¹è®­ |
| **AbstractAnnotationConfigDispatcherServletInitializer** | `æ³¨è§£é…ç½®çš„å¿«æ·æ–¹å¼` | æ™ºèƒ½ç®¡å®¶ç³»ç»Ÿ |

### 3.3 WebApplicationInitializeræ–¹å¼


**ğŸ”§ å®ç°æ­¥éª¤**

```java
public class MyWebAppInitializer implements WebApplicationInitializer {
    
    @Override
    public void onStartup(ServletContext servletContext) {
        // â‘  åˆ›å»ºSpringæ ¹å®¹å™¨
        AnnotationConfigWebApplicationContext rootContext = 
            new AnnotationConfigWebApplicationContext();
        rootContext.register(RootConfig.class);
        
        // â‘¡ æ³¨å†ŒContextLoaderListener
        servletContext.addListener(new ContextLoaderListener(rootContext));
        
        // â‘¢ åˆ›å»ºDispatcherServletçš„å®¹å™¨
        AnnotationConfigWebApplicationContext dispatcherContext = 
            new AnnotationConfigWebApplicationContext();
        dispatcherContext.register(WebConfig.class);
        
        // â‘£ æ³¨å†Œå¹¶é…ç½®DispatcherServlet
        ServletRegistration.Dynamic dispatcher = 
            servletContext.addServlet("dispatcher", 
                new DispatcherServlet(dispatcherContext));
        dispatcher.setLoadOnStartup(1);
        dispatcher.addMapping("/");
    }
}
```

**ğŸ“ æµç¨‹å›¾ç¤ºï¼š**

```
å¯åŠ¨æ—¶åºï¼š
Tomcatå®¹å™¨å¯åŠ¨
    â†“
æ£€æµ‹åˆ°WebApplicationInitializerå®ç°ç±»
    â†“
è°ƒç”¨onStartup(ServletContext)
    â†“
â‘  åˆ›å»ºæ ¹å®¹å™¨ (RootContext)
    â†“
â‘¡ æ³¨å†Œç›‘å¬å™¨ (ContextLoaderListener)
    â†“
â‘¢ åˆ›å»ºWebå®¹å™¨ (DispatcherContext)
    â†“
â‘£ æ³¨å†ŒDispatcherServlet
    â†“
â‘¤ è®¾ç½®URLæ˜ å°„
    â†“
åº”ç”¨å¯åŠ¨å®Œæˆ âœ…
```

### 3.4 AbstractAnnotationConfigDispatcherServletInitializerå¿«æ·æ–¹å¼


> â­ **æ¨èæ–¹å¼** - Springæä¾›çš„ä¾¿æ·æŠ½è±¡ç±»

```java
public class WebAppInitializer 
    extends AbstractAnnotationConfigDispatcherServletInitializer {
    
    // æ ¹å®¹å™¨é…ç½®ç±»
    @Override
    protected Class<?>[] getRootConfigClasses() {
        return new Class<?>[] { RootConfig.class };
    }
    
    // Webå®¹å™¨é…ç½®ç±»
    @Override
    protected Class<?>[] getServletConfigClasses() {
        return new Class<?>[] { WebConfig.class };
    }
    
    // DispatcherServletæ˜ å°„è·¯å¾„
    @Override
    protected String[] getServletMappings() {
        return new String[] { "/" };
    }
}
```

**ğŸ¯ ä¸¤ç§é…ç½®ç±»çš„åˆ†å·¥ï¼š**

| é…ç½®ç±» | è´Ÿè´£å†…å®¹ | åŒ…å«çš„Bean |
|-------|---------|-----------|
| **RootConfig** | `ä¸šåŠ¡é€»è¾‘å±‚é…ç½®` | Serviceã€Repositoryã€æ•°æ®æº |
| **WebConfig** | `Webå±‚é…ç½®` | Controllerã€è§†å›¾è§£æå™¨ã€æ‹¦æˆªå™¨ |

**å®¹å™¨å±‚æ¬¡å…³ç³»ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RootApplicationContext    â”‚  â† çˆ¶å®¹å™¨ï¼ˆä¸šåŠ¡Beanï¼‰
â”‚  (RootConfigé…ç½®)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ çˆ¶å­å…³ç³»
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DispatcherServlet Context  â”‚  â† å­å®¹å™¨ï¼ˆWeb Beanï¼‰
â”‚  (WebConfigé…ç½®)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **é‡è¦è§„åˆ™**
> 
> - å­å®¹å™¨å¯ä»¥è®¿é—®çˆ¶å®¹å™¨çš„Bean
> - çˆ¶å®¹å™¨**ä¸èƒ½**è®¿é—®å­å®¹å™¨çš„Bean
> - Controlleråº”è¯¥åœ¨å­å®¹å™¨ï¼ŒServiceåº”è¯¥åœ¨çˆ¶å®¹å™¨

---

## 4. ğŸ›ï¸ DispatcherServletæ ¸å¿ƒé…ç½®


### 4.1 DispatcherServletæ˜¯ä»€ä¹ˆï¼Ÿ


> ğŸ¯ **æ ¸å¿ƒå®šä½**
> 
> DispatcherServletæ˜¯Spring MVCçš„**å‰ç«¯æ§åˆ¶å™¨**ï¼Œå°±åƒï¼š
> - ğŸ¨ é…’åº—çš„**æ€»å°ç»ç†** - æ‰€æœ‰å®¢äººéƒ½å…ˆæ‰¾ä»–
> - ğŸš¦ äº¤é€š**æ€»æŒ‡æŒ¥** - æ‰€æœ‰è½¦è¾†å¬ä»–è°ƒåº¦
> - ğŸ“ å…¬å¸**æ€»æœº** - æ‰€æœ‰ç”µè¯å…ˆè½¬åˆ°è¿™é‡Œ

### 4.2 DispatcherServletçš„å·¥ä½œæµç¨‹


```
è¯·æ±‚å¤„ç†æµç¨‹ï¼š
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
DispatcherServletæ¥æ”¶
    â†“
HandlerMappingæŸ¥æ‰¾å¤„ç†å™¨
    â†“
è°ƒç”¨Controlleræ–¹æ³•
    â†“
ModelAndViewè¿”å›
    â†“
ViewResolverè§£æè§†å›¾
    â†“
æ¸²æŸ“å“åº”
    â†“
è¿”å›ç»™å®¢æˆ·ç«¯
```

### 4.3 DispatcherServletåˆå§‹åŒ–å‚æ•°


**âš™ï¸ å¸¸ç”¨é…ç½®å‚æ•°è¡¨**

| å‚æ•°å | ä½œç”¨è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹å€¼ |
|-------|---------|-------|-------|
| **contextConfigLocation** | `é…ç½®æ–‡ä»¶ä½ç½®` | `/WEB-INF/[servlet-name]-servlet.xml` | `/WEB-INF/spring-mvc.xml` |
| **namespace** | `é…ç½®æ–‡ä»¶å‘½åç©ºé—´` | `[servlet-name]-servlet` | `dispatcher-servlet` |
| **throwExceptionIfNoHandlerFound** | `æ‰¾ä¸åˆ°å¤„ç†å™¨æ—¶æŠ›å¼‚å¸¸` | `false` | `true` |
| **detectAllHandlerMappings** | `æ£€æµ‹æ‰€æœ‰HandlerMapping` | `true` | `false` |

**Javaé…ç½®æ–¹å¼ï¼š**

```java
@Override
protected void customizeRegistration(ServletRegistration.Dynamic registration) {
    // è®¾ç½®åˆå§‹åŒ–å‚æ•°
    registration.setInitParameter(
        "throwExceptionIfNoHandlerFound", "true");
    
    // è®¾ç½®å¼‚æ­¥æ”¯æŒ
    registration.setAsyncSupported(true);
    
    // è®¾ç½®åŠ è½½ä¼˜å…ˆçº§
    registration.setLoadOnStartup(1);
    
    // æ·»åŠ URLæ˜ å°„
    registration.addMapping("/api/*");
}
```

### 4.4 å¤šä¸ªDispatcherServleté…ç½®


**ğŸ“Œ åº”ç”¨åœºæ™¯ï¼šå‰åç«¯åˆ†ç¦»ã€å¤šæ¨¡å—ç³»ç»Ÿ**

```
URLåˆ†é…ç­–ç•¥ï¼š
â”œâ”€â”€ /api/*     â†’ APIä¸“ç”¨DispatcherServlet
â”‚   â””â”€â”€ å¤„ç†RESTfulæ¥å£
â”œâ”€â”€ /admin/*   â†’ ç®¡ç†åå°DispatcherServlet  
â”‚   â””â”€â”€ å¤„ç†ç®¡ç†é¡µé¢
â””â”€â”€ /*         â†’ é»˜è®¤DispatcherServlet
    â””â”€â”€ å¤„ç†å‰å°é¡µé¢
```

**é…ç½®ç¤ºä¾‹ï¼š**

```java
public class MultiDispatcherInitializer 
    extends AbstractAnnotationConfigDispatcherServletInitializer {
    
    @Override
    public void onStartup(ServletContext servletContext) {
        super.onStartup(servletContext);
        
        // æ³¨å†ŒAPIä¸“ç”¨DispatcherServlet
        registerApiDispatcher(servletContext);
    }
    
    private void registerApiDispatcher(ServletContext servletContext) {
        AnnotationConfigWebApplicationContext apiContext = 
            new AnnotationConfigWebApplicationContext();
        apiContext.register(ApiConfig.class);
        
        DispatcherServlet apiServlet = new DispatcherServlet(apiContext);
        ServletRegistration.Dynamic api = 
            servletContext.addServlet("api", apiServlet);
        api.setLoadOnStartup(2);
        api.addMapping("/api/*");
    }
}
```

---

## 5. ğŸ”’ Filterè¿‡æ»¤å™¨é…ç½®


### 5.1 Filteræ˜¯ä»€ä¹ˆï¼Ÿ


> ğŸ›¡ï¸ **å®‰å…¨ç±»æ¯”**
> 
> Filterå°±åƒæœºåœºçš„**å®‰æ£€é€šé“**ï¼š
> - æ‰€æœ‰ä¹˜å®¢ï¼ˆè¯·æ±‚ï¼‰éƒ½è¦è¿‡å®‰æ£€
> - å¯ä»¥æœ‰å¤šé“å®‰æ£€ï¼ˆå¤šä¸ªFilterï¼‰
> - æŒ‰é¡ºåºæ£€æŸ¥ï¼ˆFilteré“¾ï¼‰
> - ä¸åˆæ ¼å°±æ‹¦æˆªï¼ˆæ‹¦æˆªè¯·æ±‚ï¼‰

### 5.2 Filterçš„å·¥ä½œåŸç†


**ğŸ”„ Filteré“¾æ‰§è¡Œæµç¨‹**

```
è¯·æ±‚ â†’ Filter1 â†’ Filter2 â†’ Filter3 â†’ Servlet
        â†“         â†“         â†“         â†“
        å‰ç½®      å‰ç½®      å‰ç½®     å¤„ç†
        â†“         â†“         â†“         â†“
å“åº” â† Filter1 â† Filter2 â† Filter3 â† Servlet
        åç½®      åç½®      åç½®
```

### 5.3 å¸¸ç”¨Filteré…ç½®


**ğŸ“‹ Spring MVCå¸¸ç”¨è¿‡æ»¤å™¨**

| Filteråç§° | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|-----------|------|---------|
| **CharacterEncodingFilter** | `å­—ç¬¦ç¼–ç è¿‡æ»¤` | è§£å†³ä¸­æ–‡ä¹±ç  |
| **HiddenHttpMethodFilter** | `æ”¯æŒPUT/DELETE` | RESTfulæ¥å£ |
| **CorsFilter** | `è·¨åŸŸè¯·æ±‚å¤„ç†` | å‰åç«¯åˆ†ç¦» |
| **DelegatingFilterProxy** | `å§”æ‰˜ç»™Spring Bean` | æ•´åˆSpring Security |

### 5.4 web.xmlé…ç½®Filter


```xml
<!-- å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ -->
<filter>
    <filter-name>encodingFilter</filter-name>
    <filter-class>
        org.springframework.web.filter.CharacterEncodingFilter
    </filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>forceEncoding</param-name>
        <param-value>true</param-value>
    </init-param>
</filter>

<filter-mapping>
    <filter-name>encodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

### 5.5 Javaé…ç½®Filter


```java
@Override
protected Filter[] getServletFilters() {
    // å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨
    CharacterEncodingFilter encodingFilter = 
        new CharacterEncodingFilter();
    encodingFilter.setEncoding("UTF-8");
    encodingFilter.setForceEncoding(true);
    
    // RESTfulæ–¹æ³•è¿‡æ»¤å™¨
    HiddenHttpMethodFilter methodFilter = 
        new HiddenHttpMethodFilter();
    
    // è¿”å›Filteræ•°ç»„ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰
    return new Filter[] { encodingFilter, methodFilter };
}
```

**âš™ï¸ Filteræ‰§è¡Œé¡ºåºè§„åˆ™ï¼š**
- æ•°ç»„ä¸­çš„é¡ºåº = æ‰§è¡Œé¡ºåº
- å…ˆé…ç½®çš„å…ˆæ‰§è¡Œï¼ˆå‰ç½®å¤„ç†ï¼‰
- åé…ç½®çš„åæ‰§è¡Œï¼ˆåç½®å¤„ç†ï¼‰

### 5.6 è‡ªå®šä¹‰Filter


```java
public class LoggingFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest request, 
                         ServletResponse response, 
                         FilterChain chain) throws IOException, ServletException {
        // å‰ç½®å¤„ç†
        System.out.println("è¯·æ±‚å¼€å§‹ï¼š" + request.getParameter("name"));
        
        // æ”¾è¡Œè¯·æ±‚
        chain.doFilter(request, response);
        
        // åç½®å¤„ç†
        System.out.println("è¯·æ±‚ç»“æŸ");
    }
}
```

**æ³¨å†Œè‡ªå®šä¹‰Filterï¼š**

```java
@Override
public void onStartup(ServletContext servletContext) {
    super.onStartup(servletContext);
    
    // æ³¨å†Œè‡ªå®šä¹‰Filter
    FilterRegistration.Dynamic loggingFilter = 
        servletContext.addFilter("loggingFilter", new LoggingFilter());
    loggingFilter.addMappingForUrlPatterns(
        EnumSet.of(DispatcherType.REQUEST), false, "/*");
}
```

---

## 6. ğŸ‘‚ Listenerç›‘å¬å™¨é…ç½®


### 6.1 Listeneræ˜¯ä»€ä¹ˆï¼Ÿ


> ğŸ“¡ **ç›‘æ§ç±»æ¯”**
> 
> Listenerå°±åƒå¤§æ¥¼çš„**æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ**ï¼š
> - æœ‰äººè¿›å…¥ â†’ ServletRequestListenerï¼ˆè¯·æ±‚ç›‘å¬ï¼‰
> - æ¥¼å±‚å˜åŒ– â†’ HttpSessionListenerï¼ˆä¼šè¯ç›‘å¬ï¼‰
> - æ¸©åº¦å˜åŒ– â†’ ServletContextListenerï¼ˆä¸Šä¸‹æ–‡ç›‘å¬ï¼‰

### 6.2 Listenerçš„åˆ†ç±»


**ğŸ“Š ä¸‰å¤§ç›‘å¬å™¨å®¶æ—**

```
Listenerå®¶æ—æ ‘ï¼š
â”œâ”€â”€ ServletContextç›‘å¬å™¨
â”‚   â”œâ”€â”€ ServletContextListenerï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰
â”‚   â””â”€â”€ ServletContextAttributeListenerï¼ˆå±æ€§å˜åŒ–ï¼‰
â”‚
â”œâ”€â”€ HttpSessionç›‘å¬å™¨  
â”‚   â”œâ”€â”€ HttpSessionListenerï¼ˆä¼šè¯ç”Ÿå‘½å‘¨æœŸï¼‰
â”‚   â””â”€â”€ HttpSessionAttributeListenerï¼ˆä¼šè¯å±æ€§å˜åŒ–ï¼‰
â”‚
â””â”€â”€ ServletRequestç›‘å¬å™¨
    â”œâ”€â”€ ServletRequestListenerï¼ˆè¯·æ±‚ç”Ÿå‘½å‘¨æœŸï¼‰
    â””â”€â”€ ServletRequestAttributeListenerï¼ˆè¯·æ±‚å±æ€§å˜åŒ–ï¼‰
```

### 6.3 Springçš„æ ¸å¿ƒListener


**ğŸ”‘ ContextLoaderListener - åº”ç”¨å¯åŠ¨çš„å…³é”®**

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **å¯åŠ¨æ—¶** | `åŠ è½½Springæ ¹å®¹å™¨` |
| **å…³é—­æ—¶** | `é”€æ¯Springæ ¹å®¹å™¨` |
| **èŒè´£** | `ç®¡ç†ä¸šåŠ¡Beançš„ç”Ÿå‘½å‘¨æœŸ` |

**web.xmlé…ç½®ï¼š**

```xml
<listener>
    <listener-class>
        org.springframework.web.context.ContextLoaderListener
    </listener-class>
</listener>

<context-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>classpath:applicationContext.xml</param-value>
</context-param>
```

**Javaé…ç½®ï¼š**

```java
@Override
public void onStartup(ServletContext servletContext) {
    // åˆ›å»ºæ ¹å®¹å™¨
    AnnotationConfigWebApplicationContext rootContext = 
        new AnnotationConfigWebApplicationContext();
    rootContext.register(RootConfig.class);
    
    // æ³¨å†ŒContextLoaderListener
    servletContext.addListener(new ContextLoaderListener(rootContext));
}
```

### 6.4 è‡ªå®šä¹‰Listenerç¤ºä¾‹


```java
@WebListener
public class AppStartupListener implements ServletContextListener {
    
    @Override
    public void contextInitialized(ServletContextEvent sce) {
        System.out.println("ğŸš€ åº”ç”¨å¯åŠ¨å®Œæˆï¼");
        // åˆå§‹åŒ–å…¨å±€èµ„æº
        ServletContext context = sce.getServletContext();
        context.setAttribute("startTime", System.currentTimeMillis());
    }
    
    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        System.out.println("ğŸ‘‹ åº”ç”¨å…³é—­ï¼");
        // æ¸…ç†èµ„æº
    }
}
```

**Javaé…ç½®æ³¨å†Œï¼š**

```java
servletContext.addListener(new AppStartupListener());
```

---

## 7. âš™ï¸ å¯åŠ¨å‚æ•°ä¸ä¼˜åŒ–é…ç½®


### 7.1 å…³é”®å¯åŠ¨å‚æ•°


**ğŸ”§ æ€§èƒ½ä¼˜åŒ–å‚æ•°è¡¨**

| å‚æ•°å | ä½œç”¨ | æ¨èå€¼ | å½±å“ |
|-------|------|-------|------|
| **load-on-startup** | `å¯åŠ¨é¡ºåº` | `1` | æ•°å­—è¶Šå°è¶Šå…ˆå¯åŠ¨ |
| **async-supported** | `å¼‚æ­¥æ”¯æŒ` | `true` | æå‡é«˜å¹¶å‘æ€§èƒ½ |
| **multipart-config** | `æ–‡ä»¶ä¸Šä¼ é…ç½®` | `æŒ‰éœ€` | æ§åˆ¶ä¸Šä¼ å¤§å° |

### 7.2 å¼‚æ­¥å¤„ç†é…ç½®


**âš¡ ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥ï¼Ÿ**

```
åŒæ­¥å¤„ç†ï¼š
è¯·æ±‚ â†’ Servletçº¿ç¨‹å ç”¨ â†’ ä¸šåŠ¡å¤„ç†(5s) â†’ å“åº”
       â””â”€ çº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼Œæµªè´¹èµ„æº â”€â”˜

å¼‚æ­¥å¤„ç†ï¼š
è¯·æ±‚ â†’ Servletçº¿ç¨‹ â†’ æäº¤å¼‚æ­¥ä»»åŠ¡ â†’ ç«‹å³é‡Šæ”¾çº¿ç¨‹
              â†“
         å¼‚æ­¥çº¿ç¨‹å¤„ç†(5s)
              â†“
         å®Œæˆåå“åº”
```

**Javaé…ç½®ï¼š**

```java
@Override
protected void customizeRegistration(ServletRegistration.Dynamic registration) {
    // å¯ç”¨å¼‚æ­¥æ”¯æŒ
    registration.setAsyncSupported(true);
}

// Controllerä¸­ä½¿ç”¨
@GetMapping("/async")
public Callable<String> asyncMethod() {
    return () -> {
        Thread.sleep(5000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        return "å¼‚æ­¥å¤„ç†å®Œæˆ";
    };
}
```

### 7.3 æ–‡ä»¶ä¸Šä¼ é…ç½®


```java
@Override
protected void customizeRegistration(ServletRegistration.Dynamic registration) {
    // æ–‡ä»¶ä¸Šä¼ é…ç½®
    MultipartConfigElement multipartConfig = 
        new MultipartConfigElement(
            "/tmp",           // ä¸´æ—¶æ–‡ä»¶è·¯å¾„
            5242880,          // æœ€å¤§æ–‡ä»¶å¤§å° 5MB
            10485760,         // æœ€å¤§è¯·æ±‚å¤§å° 10MB
            0                 // æ–‡ä»¶å¤§å°é˜ˆå€¼
        );
    registration.setMultipartConfig(multipartConfig);
}
```

**ğŸ“Š æ–‡ä»¶ä¸Šä¼ å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | å«ä¹‰ | å»ºè®®å€¼ |
|------|------|-------|
| **location** | `ä¸´æ—¶æ–‡ä»¶å­˜æ”¾è·¯å¾„` | `/tmp`æˆ–ä¸“ç”¨ç›®å½• |
| **maxFileSize** | `å•ä¸ªæ–‡ä»¶æœ€å¤§å€¼` | `5-10MB`ï¼ˆæ ¹æ®éœ€æ±‚ï¼‰ |
| **maxRequestSize** | `æ•´ä¸ªè¯·æ±‚æœ€å¤§å€¼` | `maxFileSizeçš„2å€` |
| **fileSizeThreshold** | `å†…å­˜ç¼“å­˜é˜ˆå€¼` | `0`ï¼ˆå…¨éƒ¨å†™ç£ç›˜ï¼‰ |

### 7.4 å®Œæ•´çš„ä¼˜åŒ–é…ç½®ç¤ºä¾‹


```java
public class OptimizedWebAppInitializer 
    extends AbstractAnnotationConfigDispatcherServletInitializer {
    
    @Override
    protected Class<?>[] getRootConfigClasses() {
        return new Class<?>[] { RootConfig.class };
    }
    
    @Override
    protected Class<?>[] getServletConfigClasses() {
        return new Class<?>[] { WebConfig.class };
    }
    
    @Override
    protected String[] getServletMappings() {
        return new String[] { "/" };
    }
    
    @Override
    protected Filter[] getServletFilters() {
        CharacterEncodingFilter encodingFilter = 
            new CharacterEncodingFilter("UTF-8", true);
        return new Filter[] { encodingFilter };
    }
    
    @Override
    protected void customizeRegistration(
        ServletRegistration.Dynamic registration) {
        
        // â‘  å¼‚æ­¥æ”¯æŒ
        registration.setAsyncSupported(true);
        
        // â‘¡ å¯åŠ¨ä¼˜å…ˆçº§
        registration.setLoadOnStartup(1);
        
        // â‘¢ æ–‡ä»¶ä¸Šä¼ é…ç½®
        registration.setMultipartConfig(
            new MultipartConfigElement("/tmp", 5242880, 10485760, 0));
        
        // â‘£ æ‰¾ä¸åˆ°å¤„ç†å™¨æŠ›å¼‚å¸¸
        registration.setInitParameter(
            "throwExceptionIfNoHandlerFound", "true");
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


> ğŸ¯ **çŸ¥è¯†åœ°å›¾**

```
Servletå®¹å™¨é›†æˆ
â”œâ”€â”€ é…ç½®æ–¹å¼
â”‚   â”œâ”€â”€ web.xmlï¼ˆä¼ ç»ŸXMLé…ç½®ï¼‰
â”‚   â””â”€â”€ Javaé…ç½®ï¼ˆç°ä»£æ¨èï¼‰
â”‚
â”œâ”€â”€ æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰
â”‚   â”œâ”€â”€ Filterï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰
â”‚   â””â”€â”€ Listenerï¼ˆäº‹ä»¶ç›‘å¬ï¼‰
â”‚
â””â”€â”€ ä¼˜åŒ–é…ç½®
    â”œâ”€â”€ å¼‚æ­¥å¤„ç†
    â”œâ”€â”€ æ–‡ä»¶ä¸Šä¼ 
    â””â”€â”€ å¯åŠ¨å‚æ•°
```

### 8.2 ä¸¤ç§é…ç½®æ–¹å¼å¯¹æ¯”


| å¯¹æ¯”é¡¹ | web.xml | Javaé…ç½® |
|-------|---------|---------|
| **é…ç½®æ ¼å¼** | `XMLæ–‡ä»¶` | `Javaç±»` |
| **çµæ´»æ€§** | â­â­ | â­â­â­â­â­ |
| **ç±»å‹å®‰å…¨** | âŒ | âœ… |
| **IDEæ”¯æŒ** | ä¸€èˆ¬ | ä¼˜ç§€ |
| **å­¦ä¹ æ›²çº¿** | å¹³ç¼“ | ç¨é™¡ |
| **é€‚ç”¨åœºæ™¯** | ä¼ ç»Ÿé¡¹ç›® | ç°ä»£é¡¹ç›® |

### 8.3 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸¤ä¸ªå®¹å™¨çš„å…³ç³»**

```
çˆ¶å­å®¹å™¨å…³ç³»ï¼š
Rootå®¹å™¨ï¼ˆçˆ¶ï¼‰
â”œâ”€â”€ Service
â”œâ”€â”€ Repository
â””â”€â”€ DataSource

DispatcherServletå®¹å™¨ï¼ˆå­ï¼‰
â”œâ”€â”€ Controller
â”œâ”€â”€ ViewResolver
â””â”€â”€ HandlerMapping

è§„åˆ™ï¼šå­å¯è®¿é—®çˆ¶ï¼Œçˆ¶ä¸èƒ½è®¿é—®å­
```

**ğŸ”¹ Filteræ‰§è¡Œé¡ºåº**
- é…ç½®é¡ºåº = æ‰§è¡Œé¡ºåº
- å‰ç½®ï¼š1â†’2â†’3
- åç½®ï¼š3â†’2â†’1ï¼ˆé€†åºï¼‰

**ğŸ”¹ Listenerçš„è§¦å‘æ—¶æœº**
- `ServletContextListener` â†’ åº”ç”¨å¯åŠ¨/å…³é—­
- `HttpSessionListener` â†’ ä¼šè¯åˆ›å»º/é”€æ¯
- `ServletRequestListener` â†’ è¯·æ±‚åˆ°è¾¾/å®Œæˆ

### 8.4 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•ï¼š**

1. **ä¼˜å…ˆä½¿ç”¨Javaé…ç½®** - ç±»å‹å®‰å…¨ï¼ŒIDEæ”¯æŒå¥½
2. **åˆç†åˆ’åˆ†ä¸¤ä¸ªå®¹å™¨** - ä¸šåŠ¡Beanåœ¨Rootï¼ŒWeb Beanåœ¨Dispatcher
3. **FilteræŒ‰éœ€æ·»åŠ ** - ä¸è¦æ·»åŠ ä¸å¿…è¦çš„Filter
4. **å¯ç”¨å¼‚æ­¥æ”¯æŒ** - æå‡é«˜å¹¶å‘æ€§èƒ½
5. **é…ç½®æ–‡ä»¶ä¸Šä¼ é™åˆ¶** - é˜²æ­¢æ¶æ„ä¸Šä¼ 

**âŒ é¿å…çš„é”™è¯¯ï¼š**

1. âŒ åœ¨çˆ¶å®¹å™¨ä¸­æ‰«æControllerï¼ˆå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼‰
2. âŒ Filteré¡ºåºé”™ä¹±ï¼ˆå¦‚ç¼–ç Filteræ”¾åœ¨æœ€åï¼‰
3. âŒ å¿˜è®°è®¾ç½®å­—ç¬¦ç¼–ç ï¼ˆä¸­æ–‡ä¹±ç ï¼‰
4. âŒ æ–‡ä»¶ä¸Šä¼ æ²¡æœ‰å¤§å°é™åˆ¶ï¼ˆå®‰å…¨éšæ‚£ï¼‰

### 8.5 å­¦ä¹ è·¯çº¿å›¾


```
å­¦ä¹ æ­¥éª¤ï¼š
1ï¸âƒ£ ç†è§£Servletå®¹å™¨çš„ä½œç”¨
    â†“
2ï¸âƒ£ æŒæ¡web.xmlåŸºæœ¬é…ç½®
    â†“
3ï¸âƒ£ å­¦ä¹ Javaé…ç½®æ–¹å¼
    â†“
4ï¸âƒ£ ç†è§£DispatcherServletå·¥ä½œåŸç†
    â†“
5ï¸âƒ£ æŒæ¡Filterå’ŒListenerçš„ä½¿ç”¨
    â†“
6ï¸âƒ£ å­¦ä¹ æ€§èƒ½ä¼˜åŒ–é…ç½®
    â†“
7ï¸âƒ£ å®è·µé¡¹ç›®é›†æˆ
```

**ğŸ¯ æ£€æŸ¥æ¸…å•ï¼š**

- [ ] èƒ½è¯´å‡ºServletå®¹å™¨çš„ä½œç”¨
- [ ] ä¼šé…ç½®DispatcherServlet
- [ ] ç†è§£çˆ¶å­å®¹å™¨çš„å…³ç³»
- [ ] èƒ½æ­£ç¡®é…ç½®Filteré¡ºåº
- [ ] æŒæ¡å¼‚æ­¥å¤„ç†çš„ä½¿ç”¨
- [ ] èƒ½è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
- [ ] ä¼šé…ç½®æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½

---

**ğŸ§  è®°å¿†å£è¯€ï¼š**

> *å®¹å™¨ç®¡ç†ä¸‰è¦ç´ ï¼ŒServletè¿‡æ»¤ç›‘å¬å™¨*
> 
> *é…ç½®ä¸¤ç§ä»»ä½ é€‰ï¼ŒXMLä¼ ç»ŸJavaæ–°*
> 
> *çˆ¶å­å®¹å™¨è¦åˆ†æ¸…ï¼Œä¸šåŠ¡Webä¸æ··æ·†*
> 
> *Filteré¡ºåºå¾ˆå…³é”®ï¼Œç¼–ç ä¼˜å…ˆåˆ«å¿˜è®°*

**æ ¸å¿ƒè¦ç‚¹ï¼š**
- Servletå®¹å™¨æ˜¯Webåº”ç”¨çš„è¿è¡Œç¯å¢ƒ
- DispatcherServletæ˜¯Spring MVCçš„å‰ç«¯æ§åˆ¶å™¨
- Javaé…ç½®æ¯”web.xmlæ›´çµæ´»å¼ºå¤§
- çˆ¶å­å®¹å™¨å„å¸å…¶èŒï¼Œä¸è¦æ··æ·†
- Filterã€ListeneræŒ‰éœ€é…ç½®ï¼Œæ³¨æ„é¡ºåº