---
title: 2ã€Webç›¸å…³æ ¸å¿ƒé…ç½®
---
## ğŸ“š ç›®å½•

1. [WebMvcConfigureræ ¸å¿ƒæ¥å£](#1-WebMvcConfigureræ ¸å¿ƒæ¥å£)
2. [é»˜è®¤Servletå¤„ç†](#2-é»˜è®¤Servletå¤„ç†)
3. [è§†å›¾æ§åˆ¶å™¨é…ç½®](#3-è§†å›¾æ§åˆ¶å™¨é…ç½®)
4. [è·¯å¾„åŒ¹é…é…ç½®](#4-è·¯å¾„åŒ¹é…é…ç½®)
5. [æ¶ˆæ¯è½¬æ¢å™¨é…ç½®](#5-æ¶ˆæ¯è½¬æ¢å™¨é…ç½®)
6. [æ ¼å¼åŒ–å™¨æ³¨å†Œ](#6-æ ¼å¼åŒ–å™¨æ³¨å†Œ)
7. [éªŒè¯å™¨é…ç½®](#7-éªŒè¯å™¨é…ç½®)
8. [CORSå…¨å±€é…ç½®](#8-CORSå…¨å±€é…ç½®)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ WebMvcConfigureræ ¸å¿ƒæ¥å£


### 1.1 ä»€ä¹ˆæ˜¯WebMvcConfigurer


**é€šä¿—ç†è§£**ï¼šWebMvcConfigurerå°±åƒæ˜¯Spring MVCçš„"é…ç½®ç®¡å®¶"ï¼Œå®ƒå…è®¸ä½ è‡ªå®šä¹‰å’Œè°ƒæ•´Spring MVCçš„å„ç§è¡Œä¸ºï¼Œè€Œä¸éœ€è¦å®Œå…¨é‡å†™æ¡†æ¶çš„é…ç½®ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
è£…ä¿®æˆ¿å­æ—¶ï¼Œä½ ä¸éœ€è¦æ¨å€’é‡å»ºï¼Œåªéœ€è¦å‘Šè¯‰è£…ä¿®å¸ˆå‚…ï¼š
"æˆ‘è¦æ”¹è¿™ä¸ªå¢™çš„é¢œè‰²" â†’ é…ç½®æ‹¦æˆªå™¨
"æˆ‘è¦åŠ ä¸ªä¹¦æ¶" â†’ é…ç½®é™æ€èµ„æº
"æˆ‘è¦è°ƒæ•´é—¨çš„ä½ç½®" â†’ é…ç½®è·¯å¾„åŒ¹é…

WebMvcConfigurerå°±æ˜¯è¿™ä¸ª"è£…ä¿®éœ€æ±‚æ¸…å•"ï¼
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ¯ **å®šåˆ¶åŒ–é…ç½®** - æŒ‰éœ€è°ƒæ•´Spring MVCè¡Œä¸º
- ğŸ¯ **éä¾µå…¥å¼** - ä¸ç ´ååŸæœ‰é…ç½®ï¼Œåªåšå¢å¼º
- ğŸ¯ **æ¨¡å—åŒ–ç®¡ç†** - æ¯ä¸ªé…ç½®é¡¹ç‹¬ç«‹æ¸…æ™°

### 1.2 å¦‚ä½•ä½¿ç”¨WebMvcConfigurer


**ä¸¤ç§ä½¿ç”¨æ–¹å¼**ï¼š

**æ–¹å¼ä¸€ï¼šå®ç°æ¥å£**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    // åªéœ€è¦é‡å†™ä½ éœ€è¦é…ç½®çš„æ–¹æ³•
    // ä¸éœ€è¦çš„æ–¹æ³•å¯ä»¥ä¸å†™ï¼ˆæ¥å£æä¾›äº†é»˜è®¤å®ç°ï¼‰
}
```

**æ–¹å¼äºŒï¼šç»§æ‰¿é€‚é…å™¨ï¼ˆå·²è¿‡æ—¶ï¼‰**
```java
// Spring 5.0ä¹‹å‰ä½¿ç”¨ï¼Œç°åœ¨ä¸æ¨è
@Configuration
public class WebConfig extends WebMvcConfigurerAdapter {
    // ...
}
```

**ğŸ’¡ æ¨èæ–¹å¼**ï¼šç›´æ¥å®ç°`WebMvcConfigurer`æ¥å£ï¼Œä½¿ç”¨Java 8çš„é»˜è®¤æ–¹æ³•ç‰¹æ€§

### 1.3 WebMvcConfigureræä¾›çš„é…ç½®èƒ½åŠ›


| é…ç½®æ–¹æ³• | ä½œç”¨è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|---------|---------|---------|
| `configureDefaultServletHandling` | é…ç½®é»˜è®¤Servletå¤„ç† | å¤„ç†é™æ€èµ„æºè®¿é—® |
| `addViewControllers` | æ·»åŠ è§†å›¾æ§åˆ¶å™¨ | ç®€å•çš„é¡µé¢è·³è½¬ |
| `configurePathMatch` | é…ç½®è·¯å¾„åŒ¹é…è§„åˆ™ | URLè·¯å¾„åŒ¹é…ç­–ç•¥ |
| `configureContentNegotiation` | é…ç½®å†…å®¹åå•† | å“åº”æ ¼å¼é€‰æ‹© |
| `addResourceHandlers` | æ·»åŠ èµ„æºå¤„ç†å™¨ | é™æ€èµ„æºæ˜ å°„ |
| `addCorsMappings` | æ·»åŠ CORSæ˜ å°„ | è·¨åŸŸè¯·æ±‚é…ç½® |
| `addInterceptors` | æ·»åŠ æ‹¦æˆªå™¨ | è¯·æ±‚æ‹¦æˆªå¤„ç† |
| `configureMessageConverters` | é…ç½®æ¶ˆæ¯è½¬æ¢å™¨ | æ•°æ®æ ¼å¼è½¬æ¢ |
| `addFormatters` | æ·»åŠ æ ¼å¼åŒ–å™¨ | æ•°æ®ç±»å‹æ ¼å¼åŒ– |
| `getValidator` | è·å–éªŒè¯å™¨ | æ•°æ®æ ¡éªŒé…ç½® |

---

## 2. ğŸ“ é»˜è®¤Servletå¤„ç†


### 2.1 ä»€ä¹ˆæ˜¯é»˜è®¤Servlet


**é—®é¢˜èƒŒæ™¯**ï¼š
å½“ä½ åœ¨Spring MVCä¸­é…ç½®äº†`DispatcherServlet`æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼ˆ`/`ï¼‰æ—¶ï¼Œä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š

```
æµè§ˆå™¨è¯·æ±‚æµç¨‹ï¼š
ç”¨æˆ·è®¿é—® /images/logo.png
       â†“
DispatcherServletæ‹¦æˆªåˆ°è¯·æ±‚
       â†“
æ‰¾ä¸åˆ°å¯¹åº”çš„Controllerå¤„ç†
       â†“
è¿”å›404é”™è¯¯ âŒ

æœŸæœ›çš„æµç¨‹ï¼š
ç”¨æˆ·è®¿é—® /images/logo.png
       â†“
DispatcherServletå‘ç°æ˜¯é™æ€èµ„æº
       â†“
äº¤ç»™Tomcatçš„é»˜è®¤Servletå¤„ç†
       â†“
æˆåŠŸè¿”å›å›¾ç‰‡ âœ…
```

**é»˜è®¤Servletæ˜¯ä»€ä¹ˆ**ï¼š
- Tomcatã€Jettyç­‰æœåŠ¡å™¨éƒ½æœ‰ä¸€ä¸ªå†…ç½®çš„"é»˜è®¤Servlet"
- å®ƒä¸“é—¨è´Ÿè´£å¤„ç†é™æ€èµ„æºï¼ˆHTMLã€CSSã€JSã€å›¾ç‰‡ç­‰ï¼‰
- åå­—é€šå¸¸å«åš`default`

### 2.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®


**æ ¸å¿ƒåŸç†**ï¼š
```
ä¸é…ç½®çš„æƒ…å†µï¼š
DispatcherServletï¼šæˆ‘æ‹¦æˆªæ‰€æœ‰ / å¼€å¤´çš„è¯·æ±‚
é™æ€èµ„æºè¯·æ±‚ï¼š/css/style.css
DispatcherServletï¼šè¿™ä¸ªæˆ‘å¤„ç†ä¸äº†ï¼ŒæŠ¥404ï¼

é…ç½®åçš„æƒ…å†µï¼š
DispatcherServletï¼šæˆ‘å¤„ç†ä¸äº†çš„è¯·æ±‚
             â†“
è½¬äº¤ç»™é»˜è®¤Servletå¤„ç†
             â†“
é»˜è®¤Servletï¼šè¿™æ˜¯é™æ€èµ„æºï¼Œæˆ‘æ¥è¿”å›æ–‡ä»¶å†…å®¹
```

### 2.3 å¦‚ä½•é…ç½®é»˜è®¤Servletå¤„ç†


```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void configureDefaultServletHandling(
            DefaultServletHandlerConfigurer configurer) {
        // å¯ç”¨é»˜è®¤Servletå¤„ç†
        configurer.enable();
    }
}
```

**é…ç½®è¯´æ˜**ï¼š
- `configurer.enable()` - å¯ç”¨é»˜è®¤Servletå¤„ç†
- Springä¼šè‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨ç±»å‹ï¼ˆTomcatã€Jettyç­‰ï¼‰
- è‡ªåŠ¨å°†å¤„ç†ä¸äº†çš„è¯·æ±‚è½¬å‘ç»™é»˜è®¤Servlet

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
ä¼˜å…ˆçº§é—®é¢˜ï¼š
1. å…ˆæ‰¾Controllerå¤„ç†
2. æ‰¾ä¸åˆ°å†äº¤ç»™é»˜è®¤Servlet
3. é»˜è®¤Servletä¹Ÿæ‰¾ä¸åˆ°æ‰è¿”å›404

æ¨èåšæ³•ï¼š
é™æ€èµ„æºæ”¾åœ¨ä¸“é—¨çš„ç›®å½•ï¼ˆå¦‚/staticã€/publicï¼‰
ä½¿ç”¨addResourceHandlersé…ç½®æ›´çµæ´»
```

---

## 3. ğŸ¯ è§†å›¾æ§åˆ¶å™¨é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯è§†å›¾æ§åˆ¶å™¨


**é€šä¿—ç†è§£**ï¼šæœ‰äº›é¡µé¢è·³è½¬éå¸¸ç®€å•ï¼Œä¸éœ€è¦å†™Controllerå¤„ç†ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œåªæ˜¯"è®¿é—®Aè·¯å¾„ï¼Œå°±è·³è½¬åˆ°Bé¡µé¢"ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆç¹çï¼‰ï¼š
@Controller
public class HomeController {
    @GetMapping("/")
    public String home() {
        return "index";  // å°±è¿™ä¸€å¥è¯ï¼Œå´è¦å†™æ•´ä¸ªController
    }
    
    @GetMapping("/about")
    public String about() {
        return "about";  // åˆæ˜¯ä¸€å¥è¯
    }
}

ä½¿ç”¨è§†å›¾æ§åˆ¶å™¨ï¼ˆç®€æ´ï¼‰ï¼š
é…ç½®æ–‡ä»¶ä¸­å‡ è¡Œæå®šï¼Œä¸éœ€è¦å†™Controllerï¼
```

### 3.2 è§†å›¾æ§åˆ¶å™¨çš„ä½œç”¨


**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… **ç®€åŒ–é…ç½®** - æ— éœ€ç¼–å†™Controllerç±»
- âœ… **ç›´æ¥æ˜ å°„** - URLç›´æ¥æ˜ å°„åˆ°è§†å›¾åç§°
- âœ… **ä»£ç æ•´æ´** - å‡å°‘æ— ç”¨çš„Controllerä»£ç 

**é€‚ç”¨åœºæ™¯**ï¼š
```
ğŸ¯ é€‚åˆä½¿ç”¨è§†å›¾æ§åˆ¶å™¨ï¼š
- é¦–é¡µè·³è½¬ï¼š/ â†’ index.html
- å…³äºé¡µé¢ï¼š/about â†’ about.html  
- å¸®åŠ©æ–‡æ¡£ï¼š/help â†’ help.html
- 404é¡µé¢ï¼š/404 â†’ error404.html

âŒ ä¸é€‚åˆä½¿ç”¨ï¼š
- éœ€è¦æŸ¥è¯¢æ•°æ®åº“
- éœ€è¦å¤„ç†è¡¨å•æäº¤
- éœ€è¦å¤æ‚ä¸šåŠ¡é€»è¾‘
```

### 3.3 å¦‚ä½•é…ç½®è§†å›¾æ§åˆ¶å™¨


```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        // é…ç½®é¦–é¡µ
        registry.addViewController("/").setViewName("index");
        
        // é…ç½®å…³äºé¡µé¢
        registry.addViewController("/about").setViewName("about");
        
        // é…ç½®ç™»å½•é¡µé¢ï¼ˆå¸¦çŠ¶æ€ç ï¼‰
        registry.addViewController("/login")
                .setViewName("login")
                .setStatusCode(HttpStatus.OK);
        
        // é‡å®šå‘é…ç½®
        registry.addRedirectViewController("/home", "/");
    }
}
```

**é…ç½®æ–¹æ³•è¯¦è§£**ï¼š

| æ–¹æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `addViewController(path)` | æ·»åŠ URLè·¯å¾„ | `"/about"` |
| `setViewName(name)` | è®¾ç½®è§†å›¾åç§° | `"about"` â†’ about.html |
| `setStatusCode(code)` | è®¾ç½®HTTPçŠ¶æ€ç  | `HttpStatus.OK` |
| `addRedirectViewController` | æ·»åŠ é‡å®šå‘ | ä»`/home`é‡å®šå‘åˆ°`/` |

**å®é™…è®¿é—®æ•ˆæœ**ï¼š
```
ç”¨æˆ·è®¿é—®ï¼šhttp://localhost:8080/about
         â†“
Spring MVCåŒ¹é…åˆ°è§†å›¾æ§åˆ¶å™¨é…ç½®
         â†“
è¿”å›è§†å›¾ï¼šabout.html
         â†“
æµè§ˆå™¨æ˜¾ç¤ºå…³äºé¡µé¢
```

---

## 4. ğŸ”€ è·¯å¾„åŒ¹é…é…ç½®


### 4.1 ä»€ä¹ˆæ˜¯è·¯å¾„åŒ¹é…


**é€šä¿—ç†è§£**ï¼šå½“ç”¨æˆ·è®¿é—®ä¸€ä¸ªURLæ—¶ï¼ŒSpring MVCéœ€è¦æ‰¾åˆ°å¯¹åº”çš„Controlleræ–¹æ³•æ¥å¤„ç†ã€‚è·¯å¾„åŒ¹é…å°±æ˜¯"æ€ä¹ˆæ‰¾"çš„è§„åˆ™ã€‚

```
URLåŒ¹é…è¿‡ç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ï¼š/api/user/123
         â†“
SpringæŒ‰è§„åˆ™åŒ¹é…ï¼š
- /api/user/{id}  â† åŒ¹é…æˆåŠŸï¼
- /api/users/{id} â† ä¸åŒ¹é…
         â†“
è°ƒç”¨å¯¹åº”çš„Controlleræ–¹æ³•
```

### 4.2 è·¯å¾„åŒ¹é…çš„æ ¸å¿ƒæ¦‚å¿µ


**å…³é”®é…ç½®é¡¹**ï¼š

**1. åç¼€åŒ¹é…æ¨¡å¼**
```
ä¼ ç»Ÿåç¼€åŒ¹é…ï¼ˆå·²åºŸå¼ƒï¼‰ï¼š
/user/list.html
/user/list.json
/user/list.xml
è¿™äº›éƒ½åŒ¹é…åˆ°åŒä¸€ä¸ª @GetMapping("/user/list")

ç°ä»£åšæ³•ï¼š
é€šè¿‡è¯·æ±‚å¤´çš„Acceptå­—æ®µåŒºåˆ†æ ¼å¼
ä¸å†ä½¿ç”¨åç¼€åŒ¹é…
```

**2. å°¾éƒ¨æ–œæ åŒ¹é…**
```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·è®¿é—®ï¼š/api/user
é…ç½®è·¯å¾„ï¼š/api/user/

è¿™ä¸¤ä¸ªåº”è¯¥ç®—åŒä¸€ä¸ªè·¯å¾„å—ï¼Ÿ
```

**3. å¤§å°å†™æ•æ„Ÿ**
```
/api/User å’Œ /api/user
è¿™ä¸¤ä¸ªæ˜¯åŒä¸€ä¸ªè·¯å¾„å—ï¼Ÿ
```

### 4.3 å¦‚ä½•é…ç½®è·¯å¾„åŒ¹é…


```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void configurePathMatch(PathMatchConfigurer configurer) {
        // 1. ç¦ç”¨åç¼€æ¨¡å¼åŒ¹é…ï¼ˆæ¨èï¼‰
        configurer.setUseSuffixPatternMatch(false);
        
        // 2. ç¦ç”¨å°¾éƒ¨æ–œæ åŒ¹é…
        configurer.setUseTrailingSlashMatch(false);
        
        // 3. è®¾ç½®URLè·¯å¾„åŠ©æ‰‹
        UrlPathHelper pathHelper = new UrlPathHelper();
        pathHelper.setRemoveSemicolonContent(false); // ä¿ç•™åˆ†å·å†…å®¹
        configurer.setUrlPathHelper(pathHelper);
        
        // 4. è®¾ç½®è·¯å¾„åŒ¹é…å™¨
        PathMatcher pathMatcher = new AntPathMatcher();
        configurer.setPathMatcher(pathMatcher);
    }
}
```

**é…ç½®è¯´æ˜è¯¦è§£**ï¼š

| é…ç½®é¡¹ | ä½œç”¨ | æ¨èå€¼ | è¯´æ˜ |
|-------|------|-------|------|
| `setUseSuffixPatternMatch` | æ˜¯å¦å¯ç”¨åç¼€åŒ¹é… | `false` | ç°ä»£åº”ç”¨ä¸æ¨èä½¿ç”¨ |
| `setUseTrailingSlashMatch` | æ˜¯å¦åŒ¹é…å°¾éƒ¨æ–œæ  | `false` | `/user`å’Œ`/user/`ä¸¥æ ¼åŒºåˆ† |
| `setUrlPathHelper` | URLè·¯å¾„åŠ©æ‰‹ | è‡ªå®šä¹‰ | å¤„ç†URLçš„ç‰¹æ®Šæƒ…å†µ |
| `setPathMatcher` | è·¯å¾„åŒ¹é…å™¨ | `AntPathMatcher` | ä½¿ç”¨Anté£æ ¼è·¯å¾„åŒ¹é… |

**â­ æœ€ä½³å®è·µ**ï¼š
```java
// æ¨èçš„æ ‡å‡†é…ç½®
@Override
public void configurePathMatch(PathMatchConfigurer configurer) {
    // å…³é—­åç¼€åŒ¹é…ï¼ˆå·²è¿‡æ—¶ï¼‰
    configurer.setUseSuffixPatternMatch(false);
    
    // å…³é—­å°¾éƒ¨æ–œæ åŒ¹é…ï¼ˆè·¯å¾„è¦ç²¾ç¡®ï¼‰
    configurer.setUseTrailingSlashMatch(false);
}
```

---

## 5. ğŸ”„ æ¶ˆæ¯è½¬æ¢å™¨é…ç½®


### 5.1 ä»€ä¹ˆæ˜¯æ¶ˆæ¯è½¬æ¢å™¨


**é€šä¿—ç†è§£**ï¼šæ¶ˆæ¯è½¬æ¢å™¨å°±åƒ"ç¿»è¯‘å®˜"ï¼Œè´Ÿè´£åœ¨Javaå¯¹è±¡å’ŒHTTPè¯·æ±‚/å“åº”ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚

```
è¯·æ±‚è¿‡ç¨‹ï¼ˆJSON â†’ Javaå¯¹è±¡ï¼‰ï¼š
å®¢æˆ·ç«¯å‘é€JSONï¼š{"name":"å¼ ä¸‰","age":20}
              â†“
æ¶ˆæ¯è½¬æ¢å™¨è§£æ
              â†“
è½¬æ¢æˆJavaå¯¹è±¡ï¼šUserå¯¹è±¡

å“åº”è¿‡ç¨‹ï¼ˆJavaå¯¹è±¡ â†’ JSONï¼‰ï¼š
Controllerè¿”å›ï¼šUserå¯¹è±¡
              â†“
æ¶ˆæ¯è½¬æ¢å™¨è½¬æ¢
              â†“
è¿”å›ç»™å®¢æˆ·ç«¯ï¼š{"name":"å¼ ä¸‰","age":20}
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ“¥ **è¯·æ±‚è½¬æ¢** - å°†è¯·æ±‚ä½“è½¬æ¢ä¸ºJavaå¯¹è±¡
- ğŸ“¤ **å“åº”è½¬æ¢** - å°†Javaå¯¹è±¡è½¬æ¢ä¸ºå“åº”ä½“
- ğŸ”€ **æ ¼å¼æ”¯æŒ** - æ”¯æŒJSONã€XMLã€è¡¨å•ç­‰å¤šç§æ ¼å¼

### 5.2 å¸¸è§çš„æ¶ˆæ¯è½¬æ¢å™¨


| è½¬æ¢å™¨ç±»å‹ | å¤„ç†æ ¼å¼ | ä½¿ç”¨åœºæ™¯ |
|-----------|---------|---------|
| `MappingJackson2HttpMessageConverter` | JSON | æœ€å¸¸ç”¨ï¼Œå¤„ç†JSONæ•°æ® |
| `MappingJackson2XmlHttpMessageConverter` | XML | å¤„ç†XMLæ ¼å¼ |
| `StringHttpMessageConverter` | æ–‡æœ¬ | å¤„ç†çº¯æ–‡æœ¬ |
| `FormHttpMessageConverter` | è¡¨å• | å¤„ç†è¡¨å•æäº¤ |
| `ByteArrayHttpMessageConverter` | å­—èŠ‚æ•°ç»„ | å¤„ç†æ–‡ä»¶ä¸‹è½½ |

### 5.3 å¦‚ä½•é…ç½®æ¶ˆæ¯è½¬æ¢å™¨


**æ–¹å¼ä¸€ï¼šæ‰©å±•ç°æœ‰è½¬æ¢å™¨**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void extendMessageConverters(
            List<HttpMessageConverter<?>> converters) {
        // æŸ¥æ‰¾JSONè½¬æ¢å™¨å¹¶é…ç½®
        for (HttpMessageConverter<?> converter : converters) {
            if (converter instanceof MappingJackson2HttpMessageConverter) {
                MappingJackson2HttpMessageConverter jsonConverter = 
                    (MappingJackson2HttpMessageConverter) converter;
                
                // é…ç½®ObjectMapper
                ObjectMapper mapper = jsonConverter.getObjectMapper();
                // è®¾ç½®æ—¥æœŸæ ¼å¼
                mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
                // å¿½ç•¥nullå€¼
                mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
            }
        }
    }
}
```

**æ–¹å¼äºŒï¼šé…ç½®æ–°çš„è½¬æ¢å™¨**
```java
@Override
public void configureMessageConverters(
        List<HttpMessageConverter<?>> converters) {
    // åˆ›å»ºè‡ªå®šä¹‰JSONè½¬æ¢å™¨
    MappingJackson2HttpMessageConverter jsonConverter = 
        new MappingJackson2HttpMessageConverter();
    
    ObjectMapper mapper = new ObjectMapper();
    // é…ç½®æ—¶é—´æ ¼å¼
    mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd"));
    // é…ç½®å­—æ®µå‘½åç­–ç•¥ï¼ˆé©¼å³°è½¬ä¸‹åˆ’çº¿ï¼‰
    mapper.setPropertyNamingStrategy(
        PropertyNamingStrategy.SNAKE_CASE);
    
    jsonConverter.setObjectMapper(mapper);
    converters.add(jsonConverter);
}
```

**âš ï¸ ä¸¤ç§æ–¹å¼çš„åŒºåˆ«**ï¼š
```
extendMessageConvertersï¼š
âœ… ä¿ç•™Springé»˜è®¤çš„è½¬æ¢å™¨
âœ… åªæ˜¯ä¿®æ”¹é…ç½®
âœ… æ¨èä½¿ç”¨

configureMessageConvertersï¼š
âš ï¸ ä¼šè¦†ç›–Springé»˜è®¤é…ç½®
âš ï¸ éœ€è¦æ‰‹åŠ¨æ·»åŠ æ‰€æœ‰éœ€è¦çš„è½¬æ¢å™¨
âš ï¸ è°¨æ…ä½¿ç”¨
```

### 5.4 å®é™…åº”ç”¨ç¤ºä¾‹


```java
// å®Œæ•´çš„æ¶ˆæ¯è½¬æ¢å™¨é…ç½®
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void extendMessageConverters(
            List<HttpMessageConverter<?>> converters) {
        
        // é…ç½®JSONè½¬æ¢å™¨
        MappingJackson2HttpMessageConverter jsonConverter = 
            new MappingJackson2HttpMessageConverter();
        
        ObjectMapper mapper = new ObjectMapper();
        
        // 1. æ—¥æœŸæ ¼å¼åŒ–
        mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
        
        // 2. å¿½ç•¥nullå­—æ®µ
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        
        // 3. å¿½ç•¥æœªçŸ¥å±æ€§
        mapper.configure(
            DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        
        // 4. æ•°å­—è½¬å­—ç¬¦ä¸²æ—¶ä¿ç•™å¼•å·
        mapper.configure(
            JsonGenerator.Feature.WRITE_NUMBERS_AS_STRINGS, false);
        
        jsonConverter.setObjectMapper(mapper);
        
        // å°†é…ç½®å¥½çš„è½¬æ¢å™¨æ·»åŠ åˆ°æœ€å‰é¢ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰
        converters.add(0, jsonConverter);
    }
}
```

---

## 6. ğŸ¨ æ ¼å¼åŒ–å™¨æ³¨å†Œ


### 6.1 ä»€ä¹ˆæ˜¯æ ¼å¼åŒ–å™¨


**é€šä¿—ç†è§£**ï¼šæ ¼å¼åŒ–å™¨è´Ÿè´£åœ¨"å­—ç¬¦ä¸²"å’Œ"ç‰¹å®šJavaç±»å‹"ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ç”¨æˆ·è¾“å…¥ï¼š"2024-01-20"ï¼ˆå­—ç¬¦ä¸²ï¼‰
        â†“
æ ¼å¼åŒ–å™¨è§£æ
        â†“
è½¬æ¢æˆï¼šDateå¯¹è±¡

Controllerè¿”å›ï¼šDateå¯¹è±¡
        â†“  
æ ¼å¼åŒ–å™¨æ ¼å¼åŒ–
        â†“
æ˜¾ç¤ºç»™ç”¨æˆ·ï¼š"2024å¹´01æœˆ20æ—¥"ï¼ˆå­—ç¬¦ä¸²ï¼‰
```

**æ ¼å¼åŒ–å™¨ vs è½¬æ¢å™¨**ï¼š
```
æ ¼å¼åŒ–å™¨ï¼ˆFormatterï¼‰ï¼š
- ä¸“æ³¨äºå­—ç¬¦ä¸² â†” å¯¹è±¡
- ç”¨äºå‰ç«¯å±•ç¤ºå’Œè¾“å…¥
- ä¾‹ï¼šæ—¥æœŸæ ¼å¼åŒ–ã€é‡‘é¢æ ¼å¼åŒ–

è½¬æ¢å™¨ï¼ˆConverterï¼‰ï¼š
- ä»»æ„ç±»å‹ â†” ä»»æ„ç±»å‹
- ç”¨äºå†…éƒ¨æ•°æ®è½¬æ¢
- ä¾‹ï¼šString â†’ Integer
```

### 6.2 å¸¸è§çš„æ ¼å¼åŒ–åœºæ™¯


| åœºæ™¯ | è¾“å…¥ç¤ºä¾‹ | è¾“å‡ºç¤ºä¾‹ | è¯´æ˜ |
|------|---------|---------|------|
| æ—¥æœŸæ ¼å¼åŒ– | `2024-01-20` | `2024å¹´1æœˆ20æ—¥` | æ—¥æœŸæ˜¾ç¤ºæ ¼å¼ |
| é‡‘é¢æ ¼å¼åŒ– | `1234.56` | `Â¥1,234.56` | è´§å¸ç¬¦å·å’Œåƒåˆ†ä½ |
| ç™¾åˆ†æ¯”æ ¼å¼åŒ– | `0.85` | `85%` | ç™¾åˆ†æ¯”æ˜¾ç¤º |
| ç”µè¯å·ç  | `13812345678` | `138-1234-5678` | å·ç åˆ†æ®µæ˜¾ç¤º |

### 6.3 å¦‚ä½•é…ç½®æ ¼å¼åŒ–å™¨


**æ–¹å¼ä¸€ï¼šä½¿ç”¨æ³¨è§£ï¼ˆæ¨èï¼‰**
```java
public class User {
    // æ—¥æœŸæ ¼å¼åŒ–
    @DateTimeFormat(pattern = "yyyy-MM-dd")
    private Date birthday;
    
    // é‡‘é¢æ ¼å¼åŒ–
    @NumberFormat(pattern = "#,###.00")
    private BigDecimal salary;
}
```

**æ–¹å¼äºŒï¼šæ³¨å†Œè‡ªå®šä¹‰æ ¼å¼åŒ–å™¨**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addFormatters(FormatterRegistry registry) {
        // 1. æ·»åŠ æ—¥æœŸæ ¼å¼åŒ–å™¨
        registry.addFormatter(new DateFormatter("yyyy-MM-dd"));
        
        // 2. æ·»åŠ è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨
        registry.addFormatter(new Formatter<LocalDate>() {
            @Override
            public LocalDate parse(String text, Locale locale) {
                return LocalDate.parse(text, 
                    DateTimeFormatter.ofPattern("yyyy-MM-dd"));
            }
            
            @Override
            public String print(LocalDate object, Locale locale) {
                return object.format(
                    DateTimeFormatter.ofPattern("yyyyå¹´MMæœˆddæ—¥"));
            }
        });
        
        // 3. æ·»åŠ è½¬æ¢å™¨
        registry.addConverter(new Converter<String, User>() {
            @Override
            public User convert(String source) {
                // è‡ªå®šä¹‰è½¬æ¢é€»è¾‘
                String[] parts = source.split(",");
                User user = new User();
                user.setName(parts[0]);
                user.setAge(Integer.parseInt(parts[1]));
                return user;
            }
        });
    }
}
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```java
// Controllerä¸­ä½¿ç”¨
@RestController
public class UserController {
    
    @PostMapping("/user")
    public User createUser(
            @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd") 
            Date birthday,
            @RequestParam @NumberFormat(pattern = "#,###.00") 
            BigDecimal salary) {
        User user = new User();
        user.setBirthday(birthday);
        user.setSalary(salary);
        return user;
    }
}
```

---

## 7. âœ… éªŒè¯å™¨é…ç½®


### 7.1 ä»€ä¹ˆæ˜¯éªŒè¯å™¨


**é€šä¿—ç†è§£**ï¼šéªŒè¯å™¨å°±åƒ"è´¨æ£€å‘˜"ï¼Œè´Ÿè´£æ£€æŸ¥ç”¨æˆ·æäº¤çš„æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚

```
æ•°æ®æµè½¬è¿‡ç¨‹ï¼š
ç”¨æˆ·æäº¤è¡¨å•ï¼š{"name":"", "age":-1}
        â†“
éªŒè¯å™¨æ£€æŸ¥
        â†“
å‘ç°é—®é¢˜ï¼š
- nameä¸èƒ½ä¸ºç©º
- ageä¸èƒ½ä¸ºè´Ÿæ•°
        â†“
è¿”å›é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·
```

### 7.2 Springçš„éªŒè¯æœºåˆ¶


**æ ¸å¿ƒç»„ä»¶**ï¼š
- **JSR-303/JSR-380** - JavaéªŒè¯è§„èŒƒ
- **Hibernate Validator** - æœ€å¸¸ç”¨çš„å®ç°
- **@Valid/@Validated** - è§¦å‘éªŒè¯çš„æ³¨è§£

**å¸¸ç”¨éªŒè¯æ³¨è§£**ï¼š

| æ³¨è§£ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| `@NotNull` | ä¸èƒ½ä¸ºnull | `@NotNull String name` |
| `@NotEmpty` | ä¸èƒ½ä¸ºç©ºï¼ˆé›†åˆï¼‰ | `@NotEmpty List<String> items` |
| `@NotBlank` | ä¸èƒ½ä¸ºç©ºç™½å­—ç¬¦ä¸² | `@NotBlank String username` |
| `@Size` | é•¿åº¦é™åˆ¶ | `@Size(min=6, max=20) String password` |
| `@Min/@Max` | æ•°å€¼èŒƒå›´ | `@Min(18) Integer age` |
| `@Email` | é‚®ç®±æ ¼å¼ | `@Email String email` |
| `@Pattern` | æ­£åˆ™åŒ¹é… | `@Pattern(regexp="^1[3-9]\\d{9}$")` |

### 7.3 å¦‚ä½•é…ç½®éªŒè¯å™¨


**æ–¹å¼ä¸€ï¼šä½¿ç”¨é»˜è®¤éªŒè¯å™¨**
```java
// å®ä½“ç±»
public class User {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦3-20")
    private String username;
    
    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18å²")
    private Integer age;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
}

// Controllerä½¿ç”¨
@PostMapping("/user")
public ResponseEntity createUser(@Valid @RequestBody User user, 
                                  BindingResult result) {
    if (result.hasErrors()) {
        // è·å–é”™è¯¯ä¿¡æ¯
        List<String> errors = result.getAllErrors()
            .stream()
            .map(ObjectError::getDefaultMessage)
            .collect(Collectors.toList());
        return ResponseEntity.badRequest().body(errors);
    }
    return ResponseEntity.ok(user);
}
```

**æ–¹å¼äºŒï¼šé…ç½®è‡ªå®šä¹‰éªŒè¯å™¨**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public Validator getValidator() {
        // ä½¿ç”¨LocalValidatorFactoryBean
        LocalValidatorFactoryBean validator = 
            new LocalValidatorFactoryBean();
        
        // å¯ä»¥é…ç½®éªŒè¯å™¨çš„æä¾›è€…
        validator.setProviderClass(HibernateValidator.class);
        
        // é…ç½®æ¶ˆæ¯æ’å€¼å™¨ï¼ˆå›½é™…åŒ–ï¼‰
        validator.setMessageInterpolator(
            new ResourceBundleMessageInterpolator(
                new PlatformResourceBundleLocator("ValidationMessages")
            )
        );
        
        return validator;
    }
}
```

**æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰éªŒè¯æ³¨è§£**
```java
// 1. å®šä¹‰æ³¨è§£
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PhoneValidator.class)
public @interface Phone {
    String message() default "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

// 2. å®ç°éªŒè¯å™¨
public class PhoneValidator 
        implements ConstraintValidator<Phone, String> {
    
    @Override
    public boolean isValid(String value, 
                          ConstraintValidatorContext context) {
        if (value == null) return true;
        return value.matches("^1[3-9]\\d{9}$");
    }
}

// 3. ä½¿ç”¨
public class User {
    @Phone(message = "æ‰‹æœºå·æ ¼å¼é”™è¯¯")
    private String phone;
}
```

### 7.4 éªŒè¯åˆ†ç»„


**ä½¿ç”¨åœºæ™¯**ï¼šåŒä¸€ä¸ªå®ä½“ï¼Œåœ¨ä¸åŒæ“ä½œæ—¶éªŒè¯è§„åˆ™ä¸åŒ

```java
// å®šä¹‰åˆ†ç»„æ¥å£
public interface Create {}
public interface Update {}

// å®ä½“ç±»ä½¿ç”¨åˆ†ç»„
public class User {
    @NotNull(groups = Update.class)  // æ›´æ–°æ—¶IDå¿…å¡«
    private Long id;
    
    @NotBlank(groups = {Create.class, Update.class})  // åˆ›å»ºå’Œæ›´æ–°éƒ½å¿…å¡«
    private String username;
    
    @NotBlank(groups = Create.class)  // åªåœ¨åˆ›å»ºæ—¶å¿…å¡«
    private String password;
}

// Controllerä¸­ä½¿ç”¨
@PostMapping("/user")
public ResponseEntity create(
        @Validated(Create.class) @RequestBody User user) {
    // åˆ›å»ºé€»è¾‘
}

@PutMapping("/user/{id}")
public ResponseEntity update(
        @Validated(Update.class) @RequestBody User user) {
    // æ›´æ–°é€»è¾‘
}
```

---

## 8. ğŸŒ CORSå…¨å±€é…ç½®


### 8.1 ä»€ä¹ˆæ˜¯CORS


**é€šä¿—ç†è§£**ï¼šCORSï¼ˆCross-Origin Resource Sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰è§£å†³çš„æ˜¯æµè§ˆå™¨çš„"åŒæºç­–ç•¥"é™åˆ¶é—®é¢˜ã€‚

```
è·¨åŸŸé—®é¢˜åœºæ™¯ï¼š
å‰ç«¯é¡µé¢ï¼šhttp://localhost:3000
åç«¯æ¥å£ï¼šhttp://localhost:8080/api/user

æµè§ˆå™¨ï¼šä½ ä»¬ä¸æ˜¯åŒä¸€ä¸ªåŸŸï¼Œç¦æ­¢è®¿é—®ï¼âŒ

CORSé…ç½®åï¼š
æµè§ˆå™¨ï¼šåç«¯å…è®¸è·¨åŸŸï¼Œå¯ä»¥è®¿é—®ï¼âœ…
```

**åŒæºç­–ç•¥**ï¼š
```
åŒæºçš„åˆ¤æ–­æ ‡å‡†ï¼š
åè®® + åŸŸå + ç«¯å£ å®Œå…¨ç›¸åŒ

ä¸åŒæºçš„ä¾‹å­ï¼š
http://localhost:3000  â†’  http://localhost:8080  âŒ ç«¯å£ä¸åŒ
http://localhost:8080  â†’  https://localhost:8080 âŒ åè®®ä¸åŒ
http://www.a.com       â†’  http://www.b.com       âŒ åŸŸåä¸åŒ
```

### 8.2 CORSçš„å·¥ä½œåŸç†


**ç®€å•è¯·æ±‚æµç¨‹**ï¼š
```
æµè§ˆå™¨å‘é€è¯·æ±‚ï¼š
GET /api/user
Origin: http://localhost:3000

æœåŠ¡å™¨å“åº”ï¼š
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Credentials: true

æµè§ˆå™¨ï¼šå…è®¸è®¿é—® âœ…
```

**é¢„æ£€è¯·æ±‚æµç¨‹**ï¼š
```
å¤æ‚è¯·æ±‚ï¼ˆPOSTã€PUTã€è‡ªå®šä¹‰å¤´ï¼‰å…ˆå‘é€é¢„æ£€ï¼š

1. æµè§ˆå™¨å‘é€OPTIONSè¯·æ±‚ï¼š
OPTIONS /api/user
Origin: http://localhost:3000
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type

2. æœåŠ¡å™¨å“åº”ï¼š
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT
Access-Control-Allow-Headers: Content-Type
Access-Control-Max-Age: 3600

3. æµè§ˆå™¨ï¼šé¢„æ£€é€šè¿‡ï¼Œå‘é€çœŸå®è¯·æ±‚
```

### 8.3 å¦‚ä½•é…ç½®CORS


**æ–¹å¼ä¸€ï¼šå…¨å±€é…ç½®ï¼ˆæ¨èï¼‰**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")  // å¯¹å“ªäº›è·¯å¾„ç”Ÿæ•ˆ
                .allowedOrigins("http://localhost:3000")  // å…è®¸çš„æº
                .allowedMethods("GET", "POST", "PUT", "DELETE")  // å…è®¸çš„æ–¹æ³•
                .allowedHeaders("*")  // å…è®¸çš„è¯·æ±‚å¤´
                .allowCredentials(true)  // å…è®¸æºå¸¦Cookie
                .maxAge(3600);  // é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
    }
}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨@CrossOriginæ³¨è§£**
```java
@RestController
@CrossOrigin(origins = "http://localhost:3000")  // ç±»çº§åˆ«
public class UserController {
    
    @CrossOrigin(origins = "*")  // æ–¹æ³•çº§åˆ«ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
    @GetMapping("/api/user")
    public List<User> getUsers() {
        return userService.findAll();
    }
}
```

**é…ç½®å‚æ•°è¯¦è§£**ï¼š

| é…ç½®é¡¹ | è¯´æ˜ | å¸¸ç”¨å€¼ | å®‰å…¨å»ºè®® |
|-------|------|-------|---------|
| `allowedOrigins` | å…è®¸çš„æº | `http://localhost:3000` | ğŸ”’ æŒ‡å®šå…·ä½“åŸŸå |
| `allowedOriginPatterns` | å…è®¸çš„æºï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰ | `http://*.example.com` | ğŸ”’ è°¨æ…ä½¿ç”¨é€šé…ç¬¦ |
| `allowedMethods` | å…è®¸çš„HTTPæ–¹æ³• | `GET, POST, PUT, DELETE` | ğŸ”’ åªå¼€æ”¾éœ€è¦çš„æ–¹æ³• |
| `allowedHeaders` | å…è®¸çš„è¯·æ±‚å¤´ | `*` æˆ–å…·ä½“å¤´ | ğŸ”’ æŒ‡å®šå…·ä½“çš„å¤´ |
| `exposedHeaders` | æš´éœ²çš„å“åº”å¤´ | `Authorization` | å‰ç«¯å¯è®¿é—®çš„è‡ªå®šä¹‰å¤´ |
| `allowCredentials` | å…è®¸æºå¸¦å‡­è¯ | `true/false` | ğŸ”’ è°¨æ…å¼€å¯ |
| `maxAge` | é¢„æ£€ç¼“å­˜æ—¶é—´ | `3600`ï¼ˆç§’ï¼‰ | å‡å°‘é¢„æ£€è¯·æ±‚æ¬¡æ•° |

### 8.4 å®é™…åº”ç”¨é…ç½®


**å¼€å‘ç¯å¢ƒé…ç½®**ï¼š
```java
@Configuration
@Profile("dev")  // åªåœ¨å¼€å‘ç¯å¢ƒç”Ÿæ•ˆ
public class DevCorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")  // å¼€å‘ç¯å¢ƒå…è®¸æ‰€æœ‰æº
                .allowedMethods("*")
                .allowedHeaders("*")
                .allowCredentials(true)
                .maxAge(3600);
    }
}
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
```java
@Configuration
@Profile("prod")  // ç”Ÿäº§ç¯å¢ƒ
public class ProdCorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                // åªå…è®¸ç‰¹å®šçš„å‰ç«¯åŸŸå
                .allowedOrigins(
                    "https://www.example.com",
                    "https://m.example.com"
                )
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowedHeaders("Content-Type", "Authorization")
                .exposedHeaders("Authorization")
                .allowCredentials(true)
                .maxAge(7200);
    }
}
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š
```
âŒ å±é™©é…ç½®ï¼š
.allowedOrigins("*")  // å…è®¸æ‰€æœ‰æº
.allowCredentials(true)  // åŒæ—¶å…è®¸æºå¸¦Cookie
è¿™ä¸¤ä¸ªä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼ä¼šå¯¼è‡´å®‰å…¨é£é™©

âœ… å®‰å…¨é…ç½®ï¼š
æ–¹æ¡ˆ1ï¼šæŒ‡å®šå…·ä½“åŸŸå + å…è®¸Cookie
.allowedOrigins("https://www.example.com")
.allowCredentials(true)

æ–¹æ¡ˆ2ï¼šå…è®¸æ‰€æœ‰åŸŸå + ä¸å…è®¸Cookie
.allowedOrigins("*")
.allowCredentials(false)
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 WebMvcConfigureré…ç½®å…¨æ™¯å›¾


```
WebMvcConfigurer
    â”œâ”€â”€ é™æ€èµ„æºå¤„ç†
    â”‚   â”œâ”€â”€ configureDefaultServletHandling()  â†’ é»˜è®¤Servletå¤„ç†
    â”‚   â””â”€â”€ addResourceHandlers()              â†’ é™æ€èµ„æºæ˜ å°„
    â”‚
    â”œâ”€â”€ è¯·æ±‚æ˜ å°„é…ç½®
    â”‚   â”œâ”€â”€ addViewControllers()               â†’ è§†å›¾æ§åˆ¶å™¨
    â”‚   â””â”€â”€ configurePathMatch()               â†’ è·¯å¾„åŒ¹é…è§„åˆ™
    â”‚
    â”œâ”€â”€ æ•°æ®è½¬æ¢é…ç½®
    â”‚   â”œâ”€â”€ configureMessageConverters()       â†’ æ¶ˆæ¯è½¬æ¢å™¨
    â”‚   â”œâ”€â”€ extendMessageConverters()          â†’ æ‰©å±•è½¬æ¢å™¨
    â”‚   â””â”€â”€ addFormatters()                    â†’ æ ¼å¼åŒ–å™¨
    â”‚
    â”œâ”€â”€ éªŒè¯é…ç½®
    â”‚   â””â”€â”€ getValidator()                     â†’ éªŒè¯å™¨
    â”‚
    â””â”€â”€ è·¨åŸŸé…ç½®
        â””â”€â”€ addCorsMappings()                  â†’ CORSé…ç½®
```

### 9.2 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


| é…ç½®é¡¹ | æ ¸å¿ƒä½œç”¨ | è®°å¿†è¦ç‚¹ |
|-------|---------|---------|
| **WebMvcConfigurer** | Spring MVCé…ç½®æ ¸å¿ƒæ¥å£ | å®šåˆ¶åŒ–é…ç½®çš„å…¥å£ |
| **é»˜è®¤Servletå¤„ç†** | å¤„ç†é™æ€èµ„æºè¯·æ±‚ | DispatcherServletå¤„ç†ä¸äº†å°±äº¤ç»™å®ƒ |
| **è§†å›¾æ§åˆ¶å™¨** | ç®€åŒ–é¡µé¢è·³è½¬é…ç½® | æ— ä¸šåŠ¡é€»è¾‘çš„URLç›´æ¥æ˜ å°„è§†å›¾ |
| **è·¯å¾„åŒ¹é…** | æ§åˆ¶URLåŒ¹é…è§„åˆ™ | å…³é—­åç¼€åŒ¹é…å’Œå°¾éƒ¨æ–œæ  |
| **æ¶ˆæ¯è½¬æ¢å™¨** | å¯¹è±¡ä¸HTTPæ¶ˆæ¯äº’è½¬ | JSONã€XMLç­‰æ ¼å¼çš„è½¬æ¢ |
| **æ ¼å¼åŒ–å™¨** | å­—ç¬¦ä¸²ä¸å¯¹è±¡äº’è½¬ | æ—¥æœŸã€é‡‘é¢ç­‰æ ¼å¼åŒ–æ˜¾ç¤º |
| **éªŒè¯å™¨** | æ•°æ®åˆæ³•æ€§æ ¡éªŒ | @Validè§¦å‘ï¼ŒJSR-303è§„èŒƒ |
| **CORSé…ç½®** | è§£å†³è·¨åŸŸè®¿é—®é—®é¢˜ | ç”Ÿäº§ç¯å¢ƒè¦æŒ‡å®šå…·ä½“åŸŸå |

### 9.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ é…ç½®ä¼˜å…ˆçº§**ï¼š
```
1. å®‰å…¨æ€§ä¼˜å…ˆ
   - CORSé…ç½®è¦ä¸¥æ ¼
   - éªŒè¯å™¨å¿…é¡»é…ç½®
   - è·¯å¾„åŒ¹é…è¦ç²¾ç¡®

2. æ€§èƒ½ä¼˜åŒ–
   - é™æ€èµ„æºä½¿ç”¨CDN
   - æ¶ˆæ¯è½¬æ¢å™¨åˆç†é…ç½®
   - é¢„æ£€è¯·æ±‚è®¾ç½®ç¼“å­˜

3. ä»£ç ç®€æ´
   - ç®€å•è·³è½¬ç”¨è§†å›¾æ§åˆ¶å™¨
   - æ ¼å¼åŒ–ç”¨æ³¨è§£
   - éªŒè¯ç”¨æ ‡å‡†æ³¨è§£
```

**â­ æ¨èçš„é…ç½®æ¨¡æ¿**ï¼š
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    // 1. é™æ€èµ„æºï¼ˆå¦‚æœéœ€è¦ï¼‰
    @Override
    public void configureDefaultServletHandling(
            DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }
    
    // 2. è§†å›¾æ§åˆ¶å™¨ï¼ˆç®€åŒ–é…ç½®ï¼‰
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
    }
    
    // 3. è·¯å¾„åŒ¹é…ï¼ˆæ¨èé…ç½®ï¼‰
    @Override
    public void configurePathMatch(PathMatchConfigurer configurer) {
        configurer.setUseSuffixPatternMatch(false);
        configurer.setUseTrailingSlashMatch(false);
    }
    
    // 4. æ¶ˆæ¯è½¬æ¢å™¨ï¼ˆæŒ‰éœ€é…ç½®ï¼‰
    @Override
    public void extendMessageConverters(
            List<HttpMessageConverter<?>> converters) {
        // é…ç½®JSONè½¬æ¢å™¨
    }
    
    // 5. CORSé…ç½®ï¼ˆå¿…é¡»ï¼‰
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("å…·ä½“åŸŸå")
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowCredentials(true);
    }
}
```

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**â“ é—®é¢˜1ï¼šé™æ€èµ„æº404**
```
åŸå› ï¼šDispatcherServletæ‹¦æˆªäº†é™æ€èµ„æº
è§£å†³ï¼šé…ç½®é»˜è®¤Servletå¤„ç†æˆ–èµ„æºå¤„ç†å™¨
```

**â“ é—®é¢˜2ï¼šè·¨åŸŸè¯·æ±‚å¤±è´¥**
```
åŸå› ï¼šæœªé…ç½®CORSæˆ–é…ç½®ä¸æ­£ç¡®
è§£å†³ï¼šaddCorsMappings()é…ç½®å…è®¸çš„æº
```

**â“ é—®é¢˜3ï¼šæ—¥æœŸæ ¼å¼è½¬æ¢å¤±è´¥**
```
åŸå› ï¼šæœªé…ç½®æ—¥æœŸæ ¼å¼åŒ–å™¨
è§£å†³ï¼šä½¿ç”¨@DateTimeFormatæˆ–é…ç½®å…¨å±€æ ¼å¼åŒ–å™¨
```

**â“ é—®é¢˜4ï¼šéªŒè¯ä¸ç”Ÿæ•ˆ**
```
åŸå› ï¼šå¿˜è®°@Validæ³¨è§£æˆ–æœªæ·»åŠ éªŒè¯ä¾èµ–
è§£å†³ï¼šControllerå‚æ•°åŠ @Validï¼Œå¼•å…¥validationä¾èµ–
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
é…ç½®ä¸­å¿ƒWebMvcConfigurerï¼Œ
å…«å¤§åŠŸèƒ½è¦è®°ç‰¢ï¼š
é™æ€èµ„æºæ‰¾Servletï¼Œ
è§†å›¾æ§åˆ¶æœ€ç®€å•ã€‚
è·¯å¾„åŒ¹é…è¦ç²¾ç¡®ï¼Œ
æ¶ˆæ¯è½¬æ¢JSONå¼ºã€‚
æ ¼å¼éªŒè¯ä¿å®‰å…¨ï¼Œ
CORSé…ç½®é˜²è·¨åŸŸã€‚
```