---
title: 2、多语言切换实现
---
## 📚 目录

1. [多语言切换基础概念](#1-多语言切换基础概念)
2. [LocaleChangeInterceptor拦截器](#2-LocaleChangeInterceptor拦截器)
3. [参数切换语言方式](#3-参数切换语言方式)
4. [请求头切换语言](#4-请求头切换语言)
5. [Session存储方案](#5-Session存储方案)
6. [Cookie存储方案](#6-Cookie存储方案)
7. [用户偏好设置](#7-用户偏好设置)
8. [默认语言配置](#8-默认语言配置)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🌍 多语言切换基础概念


### 1.1 什么是多语言切换


**通俗理解**：就像你手机可以切换中文、英文界面一样，网站也需要根据用户选择显示不同语言。

```
用户访问网站的过程：
用户浏览器 → 选择语言（中文/English） → 网站显示对应语言内容

比如：
- 点击"中文" → 看到"欢迎"
- 点击"English" → 看到"Welcome"
```

**核心机制**：
- **Locale（地区信息）**：告诉系统用户要用什么语言，比如 `zh_CN`（中文）、`en_US`（英文）
- **切换方式**：用户通过某种操作改变当前语言
- **存储位置**：系统需要记住用户的语言选择

### 1.2 为什么需要切换功能


> **💡 实际场景**
> 
> 想象你做了一个电商网站：
> - 中国用户希望看中文
> - 美国用户希望看英文
> - 有些用户在国外，但想看中文界面
> 
> 所以必须提供切换功能，让用户自己选择！

**业务价值**：
- ✅ **用户体验**：让全球用户都能看懂网站
- ✅ **业务拓展**：支持多国市场
- ✅ **灵活性**：用户可以随时切换语言

---

## 2. 🔧 LocaleChangeInterceptor拦截器


### 2.1 核心概念理解


**什么是拦截器**：就像商场的安检门，每个请求进来都要经过它检查。

```
用户请求流程：
浏览器发请求 → 拦截器检查（有没有切换语言？） → 处理器执行 → 返回页面
              ↑
              检查URL参数、请求头等
```

**LocaleChangeInterceptor** 就是专门负责检测"用户想切换语言"的拦截器。

### 2.2 工作原理


> **🔍 运行机制**
> 
> 1. 用户访问：`/home?lang=en`
> 2. 拦截器发现参数 `lang=en`
> 3. 拦截器把语言设置为英文
> 4. 后续页面显示英文内容

**配置示例**：

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
        // 指定参数名为"lang"，这个名字可以自定义
        interceptor.setParamName("lang");
        registry.addInterceptor(interceptor);
    }
}
```

**参数说明**：
- `setParamName("lang")`：告诉拦截器，当看到 `?lang=xxx` 这样的参数时，就知道用户要切换语言
- 参数名可以改成 `language`、`locale` 等任何你喜欢的名字

### 2.3 实际应用场景


| 🎯 场景 | **URL示例** | **效果** |
|---------|------------|----------|
| 切换中文 | `/home?lang=zh_CN` | 页面显示中文 |
| 切换英文 | `/product?lang=en_US` | 页面显示英文 |
| 切换日文 | `/about?lang=ja_JP` | 页面显示日文 |

---

## 3. 📝 参数切换语言方式


### 3.1 URL参数切换（最常用）


**原理**：在网址后面加参数，告诉服务器要用什么语言。

```html
<!-- 页面上的语言切换按钮 -->
<a href="?lang=zh_CN">中文</a> | 
<a href="?lang=en_US">English</a>
```

**优点**：
- ✅ **简单直观**：看URL就知道当前语言
- ✅ **易于分享**：把链接发给别人，对方也能看到相同语言
- ✅ **SEO友好**：搜索引擎能识别不同语言版本

**缺点**：
- ⚠️ 每次点击链接都要带上 `?lang=xxx`
- ⚠️ URL会变长，不够美观

### 3.2 配置方法


```java
@Bean
public LocaleChangeInterceptor localeChangeInterceptor() {
    LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
    
    // 方式1：使用GET参数
    interceptor.setParamName("lang");
    
    // 方式2：支持多种参数名（高级用法）
    // 比如 ?lang=zh 或 ?locale=zh 都能识别
    
    return interceptor;
}
```

### 3.3 实战技巧


> **🔧 开发建议**
> 
> **保持参数的方法**：使用Thymeleaf模板时
> 
> ```html
> <!-- 保留其他参数，只改变lang -->
> <a th:href="@{''(lang='zh_CN')}">中文</a>
> <a th:href="@{''(lang='en_US')}">English</a>
> ```
> 
> 这样即使当前URL是 `/search?keyword=手机`，切换语言后变成 `/search?keyword=手机&lang=zh_CN`，搜索关键词不会丢失。

---

## 4. 🌐 请求头切换语言


### 4.1 请求头是什么


**通俗解释**：就像寄快递时的包裹信息单，浏览器每次请求都会带上一些"说明书"，告诉服务器自己的情况。

```
浏览器发送的请求头：
GET /home HTTP/1.1
Host: www.example.com
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8  ← 这行就是语言信息
```

**含义解读**：
- `zh-CN`：首选简体中文
- `q=0.9`：如果没有中文，次选其他中文（权重0.9）
- `en;q=0.8`：最后考虑英文（权重0.8）

### 4.2 如何使用请求头


**配置方式**：

```java
@Bean
public LocaleResolver localeResolver() {
    // 使用AcceptHeaderLocaleResolver，它会读取请求头
    AcceptHeaderLocaleResolver resolver = new AcceptHeaderLocaleResolver();
    
    // 设置默认语言（如果请求头没有语言信息）
    resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
    
    return resolver;
}
```

**特点对比**：

| 对比项 | **请求头方式** | **URL参数方式** |
|--------|---------------|----------------|
| 📌 用户操作 | `浏览器自动发送` | `用户点击切换` |
| 📌 灵活性 | `跟随浏览器设置` | `完全自定义` |
| 📌 适用场景 | `首次访问自动判断` | `用户主动切换` |

### 4.3 实际应用建议


> **💡 最佳实践**
> 
> **组合使用策略**：
> 1. **首次访问**：读取请求头，自动显示用户浏览器的语言
> 2. **主动切换**：用户点击语言按钮后，用参数覆盖请求头
> 3. **记住选择**：把用户选择存到Session或Cookie

这样既智能又灵活！

---

## 5. 💾 Session存储方案


### 5.1 Session是什么


**生活化理解**：就像你去医院看病，第一次给你一个病历本，以后每次来都带着这个本子，医生一看就知道你的历史记录。

```
Session工作流程：
第一次访问 → 服务器创建Session（病历本） → 返回SessionID（病历号）
            ↓
以后每次访问都带着SessionID，服务器就能找到对应的Session数据
```

**Session存储语言**：用户选择中文后，把"中文"这个选择记在Session里，下次访问自动用中文。

### 5.2 配置Session存储


```java
@Bean
public LocaleResolver localeResolver() {
    // SessionLocaleResolver：把语言信息存在Session中
    SessionLocaleResolver resolver = new SessionLocaleResolver();
    
    // 默认语言
    resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
    
    return resolver;
}
```

**搭配拦截器使用**：

```java
@Bean
public LocaleChangeInterceptor localeChangeInterceptor() {
    LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
    interceptor.setParamName("lang");
    return interceptor;
}
```

### 5.3 工作过程详解


**完整流程示意**：

```
用户操作                    系统处理
  |                          |
点击"English" 
(/home?lang=en)
  |                          |
  |                    拦截器捕获参数
  |                          |
  |                    存入Session
  |                    {locale: en_US}
  |                          |
继续浏览其他页面
(/product)                   |
  |                    从Session读取
  |                    显示英文页面
  |                          |
关闭浏览器                   Session销毁
下次访问                     重新开始
```

### 5.4 优缺点分析


| 特性 | **说明** |
|------|----------|
| ✅ **优点** | `不需要每个URL带参数，切换一次全站生效` |
| ✅ **优点** | `同一个会话中语言保持不变` |
| ❌ **缺点** | `关闭浏览器后丢失（除非配置Session持久化）` |
| ❌ **缺点** | `无法通过URL分享特定语言版本` |

---

## 6. 🍪 Cookie存储方案


### 6.1 Cookie基本概念


**形象比喻**：Cookie就像你去咖啡店办的会员卡，店员在卡上记录你喜欢的口味，下次你来直接按你的偏好做。

```
Cookie特点：
- 存在用户浏览器里（会员卡在你手里）
- 长期有效（可以设置有效期）
- 每次请求自动带上（每次进店出示卡片）
```

### 6.2 Cookie存储配置


```java
@Bean
public LocaleResolver localeResolver() {
    // CookieLocaleResolver：把语言存在Cookie中
    CookieLocaleResolver resolver = new CookieLocaleResolver();
    
    // Cookie名称
    resolver.setCookieName("userLanguage");
    
    // Cookie有效期：7天（单位：秒）
    resolver.setCookieMaxAge(7 * 24 * 60 * 60);
    
    // Cookie路径：整个网站都有效
    resolver.setCookiePath("/");
    
    // 默认语言
    resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
    
    return resolver;
}
```

**参数详解**：
- `cookieName`：Cookie的名字（自定义）
- `cookieMaxAge`：有效期，单位秒（-1表示关闭浏览器就失效，0表示立即删除）
- `cookiePath`：Cookie在哪些路径下有效（`/` 表示整个网站）

### 6.3 Cookie vs Session对比


| 对比维度 | **Cookie方式** | **Session方式** |
|----------|---------------|----------------|
| 📍 存储位置 | `用户浏览器` | `服务器内存` |
| ⏰ 有效期 | `可长期保存（如7天、30天）` | `会话期间（关闭浏览器失效）` |
| 🔄 再次访问 | `自动恢复语言设置` | `需要重新选择` |
| 💻 服务器压力 | `无压力（存在客户端）` | `占用服务器内存` |
| 🔒 安全性 | `用户可修改Cookie` | `服务器控制，更安全` |

### 6.4 实际应用场景


> **🎯 选择建议**
> 
> **适合Cookie的场景**：
> - 个人网站、博客（希望用户下次访问记住语言）
> - 电商网站（提升用户体验）
> - 不涉及敏感信息的语言设置
> 
> **适合Session的场景**：
> - 企业内部系统（每次登录重新选择）
> - 对安全性要求高的系统
> - 不希望用户修改语言设置的场景

---

## 7. 👤 用户偏好设置


### 7.1 什么是用户偏好


**概念说明**：如果网站有用户登录功能，可以把语言选择存到用户账户信息里，无论在哪台电脑登录都能看到自己选的语言。

```
用户偏好存储位置：
用户表(User)
├── id: 1001
├── username: "张三"
├── email: "zhangsan@example.com"
└── preferredLocale: "zh_CN"  ← 存在数据库
```

### 7.2 实现步骤


**🔸 第一步：数据库设计**

```sql
-- 用户表添加语言字段
ALTER TABLE user ADD COLUMN preferred_locale VARCHAR(10) DEFAULT 'zh_CN';
```

**🔸 第二步：自定义LocaleResolver**

```java
public class UserLocaleResolver implements LocaleResolver {
    
    @Override
    public Locale resolveLocale(HttpServletRequest request) {
        // 1. 获取当前登录用户
        User user = getCurrentUser(request);
        
        if (user != null && user.getPreferredLocale() != null) {
            // 2. 有登录且设置了语言偏好，使用用户偏好
            return new Locale(user.getPreferredLocale());
        }
        
        // 3. 未登录或未设置，使用浏览器语言
        return request.getLocale();
    }
    
    @Override
    public void setLocale(HttpServletRequest request, 
                         HttpServletResponse response, 
                         Locale locale) {
        // 4. 用户切换语言时，更新数据库
        User user = getCurrentUser(request);
        if (user != null) {
            user.setPreferredLocale(locale.toString());
            userService.updateUser(user);
        }
    }
}
```

**🔸 第三步：注册到Spring**

```java
@Bean
public LocaleResolver localeResolver() {
    return new UserLocaleResolver();
}
```

### 7.3 完整业务流程


```
【新用户首次访问】
登录前 → 使用浏览器语言
        ↓
     登录账户
        ↓
   读取用户偏好
        ↓
 没有设置？使用默认中文
 已设置？使用保存的语言

【老用户切换语言】
点击"English"
        ↓
   系统检测到切换
        ↓
  更新数据库：preferred_locale='en_US'
        ↓
   全站立即生效
        ↓
下次任何设备登录都是English
```

### 7.4 优势与注意事项


**✨ 核心优势**：
- 🌟 **跨设备同步**：手机、电脑登录都是统一语言
- 🌟 **永久保存**：不怕清除Cookie或Session过期
- 🌟 **个性化体验**：每个用户有自己的语言偏好

> **⚠️ 注意事项**
> 
> 1. **性能考虑**：每次请求都查数据库会影响性能
>    - **解决**：用Redis缓存用户偏好
> 
> 2. **未登录用户**：如何处理？
>    - **方案**：结合Cookie，登录前用Cookie，登录后同步到数据库

---

## 8. ⚙️ 默认语言配置


### 8.1 为什么需要默认语言


**实际情况**：
- 用户首次访问，还没选择语言
- 浏览器请求头没有语言信息
- Session和Cookie都是空的

这时候系统怎么办？**就需要一个默认语言**！

### 8.2 配置默认语言


**方式一：全局默认（推荐）**

```java
@Bean
public LocaleResolver localeResolver() {
    SessionLocaleResolver resolver = new SessionLocaleResolver();
    
    // 设置默认为简体中文
    resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
    
    // 或者用语言代码
    // resolver.setDefaultLocale(new Locale("zh", "CN"));
    
    return resolver;
}
```

**方式二：配置文件设置**

```yaml
# application.yml
spring:
  web:
    locale: zh_CN  # 默认语言
    locale-resolver: accept_header  # 解析方式
```

### 8.3 常用语言代码


| 语言 | **代码** | **说明** |
|------|---------|----------|
| 🇨🇳 简体中文 | `zh_CN` | `Locale.SIMPLIFIED_CHINESE` |
| 🇭🇰 繁体中文 | `zh_TW` | `Locale.TRADITIONAL_CHINESE` |
| 🇺🇸 英语 | `en_US` | `Locale.US` |
| 🇬🇧 英语(英国) | `en_GB` | `Locale.UK` |
| 🇯🇵 日语 | `ja_JP` | `Locale.JAPAN` |
| 🇰🇷 韩语 | `ko_KR` | `Locale.KOREA` |

### 8.4 多语言优先级策略


**最佳实践流程**：

```
系统获取语言的顺序（从高到低）：

1️⃣ 用户主动选择（参数或点击按钮）
   ↓ 没有？往下找
   
2️⃣ 用户偏好设置（数据库存储）
   ↓ 没有？往下找
   
3️⃣ Session中的语言
   ↓ 没有？往下找
   
4️⃣ Cookie中的语言
   ↓ 没有？往下找
   
5️⃣ 浏览器请求头语言
   ↓ 没有？最后
   
6️⃣ 系统默认语言（兜底方案）
```

> **💡 实现建议**
> 
> ```java
> public Locale determineLocale(HttpServletRequest request) {
>     // 1. 检查URL参数
>     String langParam = request.getParameter("lang");
>     if (langParam != null) {
>         return new Locale(langParam);
>     }
>     
>     // 2. 检查用户偏好（需登录）
>     User user = getCurrentUser();
>     if (user != null && user.getPreferredLocale() != null) {
>         return new Locale(user.getPreferredLocale());
>     }
>     
>     // 3. 检查Session
>     Locale sessionLocale = (Locale) request.getSession()
>                                            .getAttribute("locale");
>     if (sessionLocale != null) {
>         return sessionLocale;
>     }
>     
>     // 4. 检查Cookie
>     Cookie[] cookies = request.getCookies();
>     if (cookies != null) {
>         for (Cookie cookie : cookies) {
>             if ("userLanguage".equals(cookie.getName())) {
>                 return new Locale(cookie.getValue());
>             }
>         }
>     }
>     
>     // 5. 检查请求头
>     Locale headerLocale = request.getLocale();
>     if (headerLocale != null) {
>         return headerLocale;
>     }
>     
>     // 6. 返回默认语言
>     return Locale.SIMPLIFIED_CHINESE;
> }
> ```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


**🔸 六种切换方式对比**

| 方式 | **存储位置** | **有效期** | **适用场景** |
|------|------------|----------|------------|
| `URL参数` | `每次请求带参数` | `即时生效` | `临时切换、分享链接` |
| `请求头` | `浏览器自动发送` | `跟随浏览器` | `首次访问自动判断` |
| `Session` | `服务器内存` | `会话期间` | `会话内保持一致` |
| `Cookie` | `用户浏览器` | `可长期(如7天)` | `记住用户选择` |
| `用户偏好` | `数据库` | `永久` | `跨设备同步` |
| `默认配置` | `系统配置` | `永久` | `兜底方案` |

### 9.2 关键理解要点


**🔹 切换方式的选择逻辑**

```
问自己三个问题：

❓ 用户登录了吗？
   ✅ 是 → 用户偏好存数据库（最优）
   ❌ 否 → 继续判断
   
❓ 需要长期记住吗？
   ✅ 是 → 用Cookie（有效期7-30天）
   ❌ 否 → 继续判断
   
❓ 只在本次访问有效？
   ✅ 是 → 用Session（关闭浏览器失效）
   ❌ 否 → 用URL参数（即时切换）
```

**🔹 拦截器的核心作用**

> **记住一句话**：
> LocaleChangeInterceptor 就是个"语言切换的检测器"，它会检查每个请求：
> - 有 `?lang=xxx` 参数吗？
> - 有请求头语言信息吗？
> - 发现切换信号，立即执行切换！

### 9.3 实际开发建议


**📌 推荐组合方案**

**方案一：中小型网站**
```
Cookie + 参数切换 + 默认配置

优点：简单实用，用户体验好
实现：
1. 默认用中文
2. 用户点击切换，存Cookie（7天）
3. 7天内再访问自动用上次选择
```

**方案二：有登录系统**
```
用户偏好 + Cookie + Session + 默认配置

优点：完美体验，跨设备同步
实现：
1. 未登录用Cookie临时存储
2. 登录后同步到数据库
3. Session缓存减少数据库查询
4. 默认中文兜底
```

**方案三：国际化电商**
```
请求头自动识别 + 用户偏好 + 默认配置

优点：智能判断，减少用户操作
实现：
1. 首次访问读请求头（浏览器语言）
2. 用户手动切换后存偏好
3. 下次访问优先用偏好设置
```

### 9.4 常见问题解答


**❓ Q1：切换语言后，页面显示还是旧语言？**

**A：** 检查两个地方：
1. 拦截器有没有注册：`registry.addInterceptor(localeChangeInterceptor())`
2. LocaleResolver有没有配置：`@Bean public LocaleResolver localeResolver()`

**❓ Q2：Cookie设置了，但刷新还是默认语言？**

**A：** 检查：
- Cookie路径设置：`setCookiePath("/")`
- 浏览器有没有禁用Cookie
- Cookie名称和读取时是否一致

**❓ Q3：用户偏好存数据库，性能会不会差？**

**A：** 三个优化方案：
1. **Redis缓存**：登录时加载到Redis，请求时读缓存
2. **Session中转**：第一次查数据库，之后存Session
3. **批量加载**：登录时一次性加载用户所有偏好设置

### 9.5 核心记忆口诀


```
🎯 语言切换记心间，六种方式要记全

📝 参数切换最简单，URL后面加个问号完
🌐 请求头语言浏览器判，首次访问自动选
💾 Session会话期间存，关了浏览器就忘完
🍪 Cookie能存很久远，七天三十随你选
👤 用户偏好数据库存，跨设备登录都能见
⚙️ 默认语言兜底保险，啥都没有它来管

🔧 拦截器是检测员，发现切换就执行完
📊 实际选择看场景，组合使用效果赞
```

---

**🎓 学习建议**：
1. **先理解概念**：每种方式的原理和适用场景
2. **动手实践**：从最简单的参数切换开始
3. **逐步进阶**：加入Cookie、Session，最后做用户偏好
4. **实际项目**：根据业务需求选择合适方案

**下一步学习**：掌握了切换机制后，学习如何组织多语言资源文件（messages.properties）和在页面中使用国际化标签。