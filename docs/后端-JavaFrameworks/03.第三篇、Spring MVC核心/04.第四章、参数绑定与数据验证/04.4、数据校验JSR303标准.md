---
title: 4ã€æ•°æ®æ ¡éªŒJSR303æ ‡å‡†
---
## ğŸ“š ç›®å½•

1. [ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ ¡éªŒ](#1-ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ ¡éªŒ)
2. [JSR-303è§„èŒƒæ˜¯ä»€ä¹ˆ](#2-JSR-303è§„èŒƒæ˜¯ä»€ä¹ˆ)
3. [å¸¸ç”¨æ ¡éªŒæ³¨è§£è¯¦è§£](#3-å¸¸ç”¨æ ¡éªŒæ³¨è§£è¯¦è§£)
4. [@Validä¸@Validatedçš„åŒºåˆ«](#4-Validä¸Validatedçš„åŒºåˆ«)
5. [æ ¡éªŒé”™è¯¯å¤„ç†](#5-æ ¡éªŒé”™è¯¯å¤„ç†)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ ¡éªŒ


### 1.1 çœŸå®åœºæ™¯ç†è§£


æƒ³è±¡ä½ å¼€äº†ä¸€å®¶ç½‘åº—ï¼Œç”¨æˆ·è¦å¡«å†™æ³¨å†Œä¿¡æ¯ï¼š

```
ç”¨æˆ·å¯èƒ½è¿™æ ·ä¹±å¡«ï¼š
å§“åï¼š123456ï¼ˆå…¨æ˜¯æ•°å­—ï¼Ÿï¼‰
æ‰‹æœºï¼šabcdefgï¼ˆè¿™ä¹Ÿèƒ½æ˜¯æ‰‹æœºå·ï¼Ÿï¼‰
å¹´é¾„ï¼š-5å²ï¼ˆè¿˜æ²¡å‡ºç”Ÿï¼Ÿï¼‰
é‚®ç®±ï¼šéšä¾¿å†™@ä¹±æ¥.comï¼ˆæ ¼å¼ä¸å¯¹ï¼‰
```

**é—®é¢˜æ¥äº†**ï¼šå¦‚æœä¸æ ¡éªŒï¼Œè¿™äº›åƒåœ¾æ•°æ®ç›´æ¥å­˜è¿›æ•°æ®åº“ï¼Œç³»ç»Ÿå°±ä¹±å¥—äº†ï¼

### 1.2 ä¼ ç»Ÿåšæ³•çš„ç—›ç‚¹


**âŒ ä»¥å‰æˆ‘ä»¬è¿™æ ·å†™ä»£ç **ï¼š

```java
@PostMapping("/register")
public String register(User user) {
    // åˆ°å¤„éƒ½æ˜¯ifåˆ¤æ–­ï¼Œä»£ç åˆè‡­åˆé•¿
    if (user.getName() == null || user.getName().isEmpty()) {
        return "å§“åä¸èƒ½ä¸ºç©º";
    }
    if (user.getAge() < 0 || user.getAge() > 150) {
        return "å¹´é¾„ä¸åˆç†";
    }
    if (user.getPhone() == null || !user.getPhone().matches("1[3-9]\\d{9}")) {
        return "æ‰‹æœºå·æ ¼å¼é”™è¯¯";
    }
    // è¿˜æœ‰ä¸€å †åˆ¤æ–­...
}
```

**ç—›ç‚¹æ€»ç»“**ï¼š
- ğŸ”¸ ä»£ç é‡å¤ï¼šæ¯ä¸ªæ¥å£éƒ½è¦å†™ä¸€éæ ¡éªŒé€»è¾‘
- ğŸ”¸ å¯è¯»æ€§å·®ï¼šä¸šåŠ¡ä»£ç è¢«æ ¡éªŒä»£ç æ·¹æ²¡
- ğŸ”¸ ç»´æŠ¤å›°éš¾ï¼šæ”¹ä¸€ä¸ªè§„åˆ™è¦åˆ°å¤„æ‰¾ä»£ç æ”¹
- ğŸ”¸ å®¹æ˜“é—æ¼ï¼šå¿˜è®°æ ¡éªŒæŸä¸ªå­—æ®µå°±å‡ºbug

### 1.3 æ•°æ®æ ¡éªŒçš„æ ¸å¿ƒä½œç”¨


```
ç”¨æˆ·è¾“å…¥ â†’ æ•°æ®æ ¡éªŒ â†’ ä¸šåŠ¡å¤„ç† â†’ æ•°æ®åº“
           â†‘
        è¿™é‡Œæ˜¯ç¬¬ä¸€é“é˜²çº¿ï¼
        æ‹¦æˆªè„æ•°æ®ï¼Œä¿æŠ¤ç³»ç»Ÿå®‰å…¨
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- âœ… **ä¿è¯æ•°æ®è´¨é‡**ï¼šåƒåœ¾æ•°æ®è¿›ä¸æ¥
- âœ… **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šåŠæ—¶åé¦ˆé”™è¯¯ä¿¡æ¯
- âœ… **å‡å°‘bugé£é™©**ï¼šé¿å…å¼‚å¸¸æ•°æ®å¯¼è‡´ç³»ç»Ÿå´©æºƒ
- âœ… **ç®€åŒ–ä»£ç é€»è¾‘**ï¼šç”¨æ³¨è§£ä»£æ›¿ifåˆ¤æ–­

---

## 2. ğŸ“– JSR-303è§„èŒƒæ˜¯ä»€ä¹ˆ


### 2.1 é€šä¿—ç†è§£JSR-303


**JSR-303** = Java Specification Request 303ï¼ˆJavaè§„èŒƒææ¡ˆ303å·ï¼‰

> ğŸ’¡ **ç™½è¯è§£é‡Š**ï¼šè¿™å°±æ˜¯Javaå®˜æ–¹å®šçš„ä¸€å¥—"æ•°æ®æ ¡éªŒæ ‡å‡†è§„åˆ™"ï¼Œå°±åƒç›–æˆ¿å­æœ‰å»ºç­‘è§„èŒƒä¸€æ ·ï¼Œåšæ•°æ®æ ¡éªŒä¹Ÿæœ‰å®˜æ–¹æ ‡å‡†ã€‚

```
ç±»æ¯”ç†è§£ï¼š
JSR-303è§„èŒƒ = äº¤é€šè§„åˆ™ï¼ˆå›½å®¶åˆ¶å®šçš„æ ‡å‡†ï¼‰
Hibernate Validator = å…·ä½“å®æ–½è€…ï¼ˆéµå®ˆè§„åˆ™çš„å®ç°ï¼‰
Spring Validation = é›†æˆå·¥å…·ï¼ˆè®©è§„åˆ™åœ¨Springä¸­å¥½ç”¨ï¼‰
```

### 2.2 æ ¸å¿ƒæ¦‚å¿µå…³ç³»å›¾


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         JSR-303 Bean Validation     â”‚  â† å®˜æ–¹è§„èŒƒï¼ˆå®šæ ‡å‡†ï¼‰
â”‚         (åªæ˜¯å®šä¹‰äº†æ ‡å‡†æ¥å£)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ å®ç°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Hibernate Validator            â”‚  â† æœ€æµè¡Œçš„å®ç°ï¼ˆå†™ä»£ç ï¼‰
â”‚      (çœŸæ­£å¹²æ´»çš„å®ç°æ¡†æ¶)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ é›†æˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Spring Validation              â”‚  â† Springçš„æ•´åˆï¼ˆæ›´å¥½ç”¨ï¼‰
â”‚      (è®©æ ¡éªŒåœ¨Springä¸­æ— ç¼ä½¿ç”¨)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Bean Validationæ˜¯ä»€ä¹ˆ


**Bean Validation** = å¯¹JavaBeanå¯¹è±¡çš„å±æ€§è¿›è¡Œæ ¡éªŒ

```java
// JavaBeanç¤ºä¾‹
public class User {
    private String name;    // â† è¿™äº›å±æ€§éœ€è¦æ ¡éªŒ
    private Integer age;    // â† ç¡®ä¿æ•°æ®åˆæ³•
    private String email;   // â† æ ¼å¼è¦æ­£ç¡®
}
```

> ğŸ”‘ **è®°ä½**ï¼šBeanå°±æ˜¯æˆ‘ä»¬çš„å®ä½“ç±»å¯¹è±¡ï¼ŒValidationå°±æ˜¯ç»™å¯¹è±¡çš„å±æ€§åŠ ä¸Šæ ¡éªŒè§„åˆ™ã€‚

### 2.4 å¿«é€Ÿä¸Šæ‰‹é…ç½®


**ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–**

```xml
<!-- Spring Booté¡¹ç›®è‡ªåŠ¨åŒ…å«ï¼Œæ— éœ€å•ç‹¬å¼•å…¥ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šå¦‚æœä½ ç”¨Spring Bootï¼Œè¿™ä¸ªä¾èµ–å·²ç»é»˜è®¤åŒ…å«äº†ï¼Œä¸ç”¨è‡ªå·±åŠ ï¼

---

## 3. ğŸ·ï¸ å¸¸ç”¨æ ¡éªŒæ³¨è§£è¯¦è§£


### 3.1 ç©ºå€¼æ ¡éªŒæ³¨è§£


#### @NotNull - ä¸èƒ½ä¸ºç©ºï¼ˆä½†èƒ½ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰


```java
public class User {
    @NotNull(message = "å§“åä¸èƒ½ä¸ºnull")
    private String name;
}
```

**ç†è§£è¦ç‚¹**ï¼š
- âœ… å…è®¸ï¼š`""` ç©ºå­—ç¬¦ä¸²
- âœ… å…è®¸ï¼š`"  "` ç©ºæ ¼
- âŒ ä¸å…è®¸ï¼š`null`

> ğŸ¤” **å®¹æ˜“æ··æ·†**ï¼š`@NotNull` åªç®¡æ˜¯ä¸æ˜¯nullï¼Œä¸ç®¡å†…å®¹æ˜¯ä¸æ˜¯ç©ºçš„ï¼

#### @NotEmpty - ä¸èƒ½ä¸ºç©ºä¸”é•¿åº¦å¤§äº0


```java
@NotEmpty(message = "å§“åä¸èƒ½ä¸ºç©º")
private String name;
```

**ç†è§£è¦ç‚¹**ï¼š
- âœ… å…è®¸ï¼š`"å¼ ä¸‰"` æœ‰å†…å®¹
- âœ… å…è®¸ï¼š`"  "` ç©ºæ ¼ï¼ˆå› ä¸ºé•¿åº¦>0ï¼‰
- âŒ ä¸å…è®¸ï¼š`null`
- âŒ ä¸å…è®¸ï¼š`""` ç©ºå­—ç¬¦ä¸²

#### @NotBlank - ä¸èƒ½ä¸ºç©ºä¸”å»æ‰ç©ºæ ¼åé•¿åº¦å¤§äº0ï¼ˆæœ€ä¸¥æ ¼ï¼‰


```java
@NotBlank(message = "å§“åä¸èƒ½ä¸ºç©ºç™½")
private String name;
```

**ç†è§£è¦ç‚¹**ï¼š
- âœ… å…è®¸ï¼š`"å¼ ä¸‰"` æœ‰å†…å®¹
- âŒ ä¸å…è®¸ï¼š`null`
- âŒ ä¸å…è®¸ï¼š`""` ç©ºå­—ç¬¦ä¸²
- âŒ ä¸å…è®¸ï¼š`"  "` çº¯ç©ºæ ¼

#### ä¸‰è€…å¯¹æ¯”è®°å¿†è¡¨


| æ³¨è§£ | **null** | **ç©ºå­—ç¬¦ä¸²""** | **çº¯ç©ºæ ¼"  "** | **æ­£å¸¸å†…å®¹** | **æ¨èåœºæ™¯** |
|------|---------|---------------|--------------|-------------|-------------|
| `@NotNull` | âŒ | âœ… | âœ… | âœ… | `å¯¹è±¡ã€æ•°å­—ç­‰éå­—ç¬¦ä¸²` |
| `@NotEmpty` | âŒ | âŒ | âœ… | âœ… | `é›†åˆã€æ•°ç»„` |
| `@NotBlank` | âŒ | âŒ | âŒ | âœ… | `å­—ç¬¦ä¸²ï¼ˆæœ€å¸¸ç”¨ï¼‰` |

> ğŸ’¡ **è®°å¿†å£è¯€**ï¼šNotNullæœ€æ¾ï¼ŒNotBlankæœ€ä¸¥ï¼ŒNotEmptyå±…ä¸­é—´

### 3.2 é•¿åº¦ä¸èŒƒå›´æ ¡éªŒ


#### @Size - é•¿åº¦é™åˆ¶


```java
public class User {
    @Size(min = 2, max = 10, message = "å§“åé•¿åº¦å¿…é¡»åœ¨2-10ä¸ªå­—ç¬¦ä¹‹é—´")
    private String name;
    
    @Size(min = 1, message = "è‡³å°‘é€‰æ‹©ä¸€ä¸ªå…´è¶£çˆ±å¥½")
    private List<String> hobbies;
}
```

**é€‚ç”¨ç±»å‹**ï¼š
- å­—ç¬¦ä¸²ï¼šé™åˆ¶å­—ç¬¦ä¸ªæ•°
- é›†åˆï¼šé™åˆ¶å…ƒç´ ä¸ªæ•°
- æ•°ç»„ï¼šé™åˆ¶æ•°ç»„é•¿åº¦

#### æ•°å€¼èŒƒå›´æ³¨è§£å¯¹æ¯”


```java
public class Product {
    // æ–¹å¼1ï¼š@Min + @Max
    @Min(value = 0, message = "ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°")
    @Max(value = 999999, message = "ä»·æ ¼ä¸èƒ½è¶…è¿‡999999")
    private BigDecimal price;
    
    // æ–¹å¼2ï¼š@Rangeï¼ˆéœ€è¦Hibernate Validatorï¼‰
    @Range(min = 0, max = 999999, message = "ä»·æ ¼å¿…é¡»åœ¨0-999999ä¹‹é—´")
    private BigDecimal price2;
}
```

| æ³¨è§£ | **ä½œç”¨å¯¹è±¡** | **è¯´æ˜** |
|------|------------|---------|
| `@Min` | `æ•°å€¼ç±»å‹` | `æœ€å°å€¼é™åˆ¶` |
| `@Max` | `æ•°å€¼ç±»å‹` | `æœ€å¤§å€¼é™åˆ¶` |
| `@Range` | `æ•°å€¼ç±»å‹` | `èŒƒå›´é™åˆ¶ï¼ˆHibernateæ‰©å±•ï¼‰` |
| `@Size` | `å­—ç¬¦ä¸²ã€é›†åˆã€æ•°ç»„` | `é•¿åº¦/å¤§å°é™åˆ¶` |

### 3.3 æ ¼å¼æ ¡éªŒæ³¨è§£


#### @Pattern - æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ


```java
public class User {
    // æ‰‹æœºå·æ ¡éªŒ
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    // èº«ä»½è¯æ ¡éªŒ
    @Pattern(regexp = "^\\d{17}[0-9Xx]$", message = "èº«ä»½è¯æ ¼å¼ä¸æ­£ç¡®")
    private String idCard;
}
```

**å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼é€ŸæŸ¥**ï¼š

```
æ‰‹æœºå·ï¼š^1[3-9]\d{9}$
é‚®ç®±ï¼š^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+$
èº«ä»½è¯ï¼š^\d{17}[0-9Xx]$
ä¸­æ–‡å§“åï¼š^[\u4e00-\u9fa5]{2,10}$
```

> âš ï¸ **æ³¨æ„**ï¼šæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ `\` åœ¨Javaå­—ç¬¦ä¸²ä¸­è¦å†™æˆ `\\`

#### @Email - é‚®ç®±æ ¼å¼æ ¡éªŒ


```java
@Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
private String email;
```

> ğŸ’¡ **æç¤º**ï¼š`@Email` å†…éƒ¨ä¹Ÿæ˜¯ç”¨æ­£åˆ™å®ç°çš„ï¼Œä½†Springå¸®ä½ å†™å¥½äº†ï¼Œç›´æ¥ç”¨å°±è¡Œï¼

### 3.4 å…¶ä»–å¸¸ç”¨æ³¨è§£é€Ÿè§ˆ


| æ³¨è§£ | **ä½œç”¨** | **ç¤ºä¾‹** |
|------|---------|---------|
| `@Positive` | `å¿…é¡»æ˜¯æ­£æ•°` | `@Positive Integer age` |
| `@PositiveOrZero` | `æ­£æ•°æˆ–é›¶` | `@PositiveOrZero Integer score` |
| `@Negative` | `å¿…é¡»æ˜¯è´Ÿæ•°` | `@Negative Integer debt` |
| `@Future` | `å¿…é¡»æ˜¯æœªæ¥æ—¥æœŸ` | `@Future Date appointmentDate` |
| `@Past` | `å¿…é¡»æ˜¯è¿‡å»æ—¥æœŸ` | `@Past Date birthday` |
| `@AssertTrue` | `å¿…é¡»ä¸ºtrue` | `@AssertTrue Boolean agreed` |

---

## 4. ğŸ”€ @Validä¸@Validatedçš„åŒºåˆ«


### 4.1 ä¸¤è€…çš„åŸºæœ¬å®šä¹‰


```
@Valid       â†’ JSR-303æ ‡å‡†æ³¨è§£ï¼ˆJavaå®˜æ–¹å®šä¹‰ï¼‰
@Validated   â†’ Springæ¡†æ¶æ‰©å±•æ³¨è§£ï¼ˆSpringè‡ªå·±åŠ çš„åŠŸèƒ½ï¼‰
```

**åŒ…è·¯å¾„å¯¹æ¯”**ï¼š

```java
import javax.validation.Valid;              // JSR-303æ ‡å‡†
import org.springframework.validation.annotation.Validated;  // Springæ‰©å±•
```

### 4.2 æ ¸å¿ƒåŒºåˆ«å¯¹ç…§è¡¨


| å¯¹æ¯”é¡¹ | **@Valid** | **@Validated** |
|-------|-----------|---------------|
| **æ¥æº** | `JSR-303æ ‡å‡†` | `Springæ¡†æ¶æ‰©å±•` |
| **ä½¿ç”¨ä½ç½®** | `æ–¹æ³•å‚æ•°ã€å­—æ®µã€æ„é€ å™¨` | `ç±»ã€æ–¹æ³•å‚æ•°` |
| **åµŒå¥—æ ¡éªŒ** | `âœ… æ”¯æŒï¼ˆé…åˆä½¿ç”¨ï¼‰` | `âŒ ä¸æ”¯æŒåµŒå¥—` |
| **åˆ†ç»„æ ¡éªŒ** | `âŒ ä¸æ”¯æŒ` | `âœ… æ”¯æŒåˆ†ç»„æ ¡éªŒ` |
| **æ¨èåœºæ™¯** | `ç®€å•æ ¡éªŒã€åµŒå¥—å¯¹è±¡` | `åˆ†ç»„æ ¡éªŒã€ç±»çº§åˆ«æ ¡éªŒ` |

### 4.3 @Valid å…¸å‹ç”¨æ³•


```java
@RestController
public class UserController {
    
    // ç”¨æ³•1ï¼šæ ¡éªŒè¯·æ±‚ä½“
    @PostMapping("/user")
    public String addUser(@Valid @RequestBody User user, 
                          BindingResult result) {
        if (result.hasErrors()) {
            return "æ ¡éªŒå¤±è´¥";
        }
        return "æ·»åŠ æˆåŠŸ";
    }
    
    // ç”¨æ³•2ï¼šåµŒå¥—å¯¹è±¡æ ¡éªŒ
    public class Order {
        @Valid  // â† è¿™é‡ŒåŠ @Validï¼Œè¡¨ç¤ºè¦æ ¡éªŒuserå¯¹è±¡å†…éƒ¨çš„å­—æ®µ
        private User user;
        
        @NotNull
        private BigDecimal amount;
    }
}
```

> ğŸ’¡ **åµŒå¥—æ ¡éªŒå…³é”®**ï¼šçˆ¶å¯¹è±¡çš„å­—æ®µä¸ŠåŠ  `@Valid`ï¼Œå­å¯¹è±¡çš„å±æ€§ä¸ŠåŠ å…·ä½“æ ¡éªŒæ³¨è§£

### 4.4 @Validated å…¸å‹ç”¨æ³•


#### åœºæ™¯ï¼šåˆ†ç»„æ ¡éªŒ


```java
// å®šä¹‰åˆ†ç»„æ¥å£
public interface AddGroup {}
public interface UpdateGroup {}

// å®ä½“ç±»ä½¿ç”¨åˆ†ç»„
public class User {
    @NotNull(groups = UpdateGroup.class)  // åªåœ¨æ›´æ–°æ—¶æ ¡éªŒID
    private Long id;
    
    @NotBlank(groups = {AddGroup.class, UpdateGroup.class})  // æ–°å¢å’Œæ›´æ–°éƒ½æ ¡éªŒ
    private String name;
}

// Controllerä½¿ç”¨åˆ†ç»„
@RestController
public class UserController {
    
    @PostMapping("/user")
    public String add(@Validated(AddGroup.class) @RequestBody User user) {
        // åªæ ¡éªŒAddGroupåˆ†ç»„çš„è§„åˆ™
        return "æ·»åŠ æˆåŠŸ";
    }
    
    @PutMapping("/user")
    public String update(@Validated(UpdateGroup.class) @RequestBody User user) {
        // åªæ ¡éªŒUpdateGroupåˆ†ç»„çš„è§„åˆ™
        return "æ›´æ–°æˆåŠŸ";
    }
}
```

**åˆ†ç»„æ ¡éªŒåœºæ™¯å›¾**ï¼š

```
åŒä¸€ä¸ªUserå¯¹è±¡ï¼š

æ–°å¢æ—¶ï¼š
  éœ€è¦æ ¡éªŒ â†’ nameï¼ˆå¿…å¡«ï¼‰
  ä¸æ ¡éªŒ   â†’ idï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

æ›´æ–°æ—¶ï¼š
  éœ€è¦æ ¡éªŒ â†’ idï¼ˆå¿…å¡«ï¼‰ã€nameï¼ˆå¿…å¡«ï¼‰

é€šè¿‡åˆ†ç»„ï¼Œä¸€ä¸ªå®ä½“ç±»é€‚é…å¤šç§åœºæ™¯ï¼
```

### 4.5 é€‰æ‹©å»ºè®®


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨ @Valid**ï¼š
- ç®€å•çš„å•å±‚æ ¡éªŒ
- éœ€è¦åµŒå¥—å¯¹è±¡æ ¡éªŒ
- éµå¾ªJSR-303æ ‡å‡†

**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨ @Validated**ï¼š
- éœ€è¦åˆ†ç»„æ ¡éªŒï¼ˆåŒä¸€å­—æ®µä¸åŒåœºæ™¯è§„åˆ™ä¸åŒï¼‰
- ç±»çº§åˆ«çš„æ–¹æ³•å‚æ•°æ ¡éªŒ
- Springç¯å¢ƒä¸‹çš„é«˜çº§ç‰¹æ€§

> ğŸ’¡ **æ–°æ‰‹å»ºè®®**ï¼šåˆšå¼€å§‹ç”¨ `@Valid` å°±å¤Ÿäº†ï¼Œç­‰é‡åˆ°åˆ†ç»„åœºæ™¯å†ç”¨ `@Validated`

---

## 5. ğŸ› ï¸ æ ¡éªŒé”™è¯¯å¤„ç†


### 5.1 BindingResult æ¥æ”¶é”™è¯¯


**åŸºæœ¬ç”¨æ³•**ï¼š

```java
@PostMapping("/user")
public String addUser(@Valid @RequestBody User user, 
                      BindingResult result) {  // â† ç´§è·Ÿåœ¨@Validå‚æ•°åé¢
    
    if (result.hasErrors()) {
        // è·å–ç¬¬ä¸€ä¸ªé”™è¯¯ä¿¡æ¯
        String errorMsg = result.getFieldError().getDefaultMessage();
        return "æ ¡éªŒå¤±è´¥ï¼š" + errorMsg;
    }
    
    return "æ·»åŠ æˆåŠŸ";
}
```

> âš ï¸ **é‡è¦è§„åˆ™**ï¼š`BindingResult` å¿…é¡»ç´§è·Ÿåœ¨ `@Valid` å‚æ•°åé¢ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼

### 5.2 è·å–æ‰€æœ‰é”™è¯¯ä¿¡æ¯


```java
@PostMapping("/user")
public Map<String, String> addUser(@Valid @RequestBody User user, 
                                   BindingResult result) {
    Map<String, String> errors = new HashMap<>();
    
    if (result.hasErrors()) {
        // éå†æ‰€æœ‰é”™è¯¯
        result.getFieldErrors().forEach(error -> {
            String field = error.getField();        // å­—æ®µå
            String message = error.getDefaultMessage();  // é”™è¯¯ä¿¡æ¯
            errors.put(field, message);
        });
    }
    
    return errors;
}
```

**è¿”å›ç»“æœç¤ºä¾‹**ï¼š

```json
{
    "name": "å§“åä¸èƒ½ä¸ºç©º",
    "age": "å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´",
    "email": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
}
```

### 5.3 å…¨å±€å¼‚å¸¸å¤„ç†ï¼ˆæ¨èæ–¹å¼ï¼‰


**ä¸ºä»€ä¹ˆéœ€è¦å…¨å±€å¤„ç†**ï¼š
- æ¯ä¸ªæ¥å£éƒ½å†™ `BindingResult` å¤ªéº»çƒ¦
- ä»£ç é‡å¤ï¼Œä¸ä¼˜é›…
- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼æ›´ä¸“ä¸š

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    // å¤„ç†@Validæ ¡éªŒå¤±è´¥çš„å¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Map<String, Object> handleValidException(MethodArgumentNotValidException e) {
        Map<String, Object> result = new HashMap<>();
        Map<String, String> errors = new HashMap<>();
        
        // è·å–æ‰€æœ‰æ ¡éªŒé”™è¯¯
        e.getBindingResult().getFieldErrors().forEach(error -> {
            errors.put(error.getField(), error.getDefaultMessage());
        });
        
        result.put("code", 400);
        result.put("message", "å‚æ•°æ ¡éªŒå¤±è´¥");
        result.put("errors", errors);
        
        return result;
    }
    
    // å¤„ç†@Validatedæ ¡éªŒå¤±è´¥çš„å¼‚å¸¸ï¼ˆåˆ†ç»„æ ¡éªŒï¼‰
    @ExceptionHandler(BindException.class)
    public Map<String, Object> handleBindException(BindException e) {
        // å¤„ç†é€»è¾‘åŒä¸Š
        // ...
    }
}
```

**å…¨å±€å¤„ç†æµç¨‹å›¾**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
Controller (@Validæ ¡éªŒ)
    â†“
æ ¡éªŒå¤±è´¥æŠ›å‡ºå¼‚å¸¸
    â†“
å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·
    â†“
ç»Ÿä¸€è¿”å›é”™è¯¯ä¿¡æ¯
    â†“
å®¢æˆ·ç«¯æ”¶åˆ°å“åº”
```

### 5.4 è‡ªå®šä¹‰é”™è¯¯å“åº”æ ¼å¼


```java
// ç»Ÿä¸€å“åº”å¯¹è±¡
public class Result<T> {
    private Integer code;
    private String message;
    private T data;
    
    public static <T> Result<T> success(T data) {
        return new Result<>(200, "æˆåŠŸ", data);
    }
    
    public static <T> Result<T> error(String message) {
        return new Result<>(400, message, null);
    }
}

// å…¨å±€å¼‚å¸¸å¤„ç†
@ExceptionHandler(MethodArgumentNotValidException.class)
public Result<Map<String, String>> handleValidException(MethodArgumentNotValidException e) {
    Map<String, String> errors = new HashMap<>();
    e.getBindingResult().getFieldErrors().forEach(error -> {
        errors.put(error.getField(), error.getDefaultMessage());
    });
    
    return Result.error("å‚æ•°æ ¡éªŒå¤±è´¥").setData(errors);
}
```

---

## 6. ğŸ¯ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 ç”¨æˆ·æ³¨å†Œåœºæ™¯


```java
// ç”¨æˆ·æ³¨å†ŒDTO
public class UserRegisterDTO {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´")
    private String username;
    
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, max = 20, message = "å¯†ç é•¿åº¦å¿…é¡»åœ¨6-20ä¹‹é—´")
    private String password;
    
    @NotBlank(message = "æ‰‹æœºå·ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @NotNull(message = "å¿…é¡»åŒæ„ç”¨æˆ·åè®®")
    @AssertTrue(message = "å¿…é¡»åŒæ„ç”¨æˆ·åè®®")
    private Boolean agreed;
}

// Controller
@PostMapping("/register")
public Result<?> register(@Valid @RequestBody UserRegisterDTO dto) {
    // æ ¡éªŒé€šè¿‡ï¼Œæ‰§è¡Œæ³¨å†Œé€»è¾‘
    userService.register(dto);
    return Result.success("æ³¨å†ŒæˆåŠŸ");
}
```

### 6.2 è®¢å•æäº¤åœºæ™¯ï¼ˆåµŒå¥—æ ¡éªŒï¼‰


```java
// è®¢å•ä¸»è¡¨
public class OrderDTO {
    
    @Valid  // â† åµŒå¥—æ ¡éªŒï¼šæ ¡éªŒæ”¶è´§åœ°å€å¯¹è±¡
    @NotNull(message = "æ”¶è´§åœ°å€ä¸èƒ½ä¸ºç©º")
    private AddressDTO address;
    
    @Valid  // â† åµŒå¥—æ ¡éªŒï¼šæ ¡éªŒå•†å“åˆ—è¡¨
    @NotEmpty(message = "è®¢å•å•†å“ä¸èƒ½ä¸ºç©º")
    private List<OrderItemDTO> items;
    
    @NotBlank(message = "æ”¯ä»˜æ–¹å¼ä¸èƒ½ä¸ºç©º")
    private String payType;
}

// æ”¶è´§åœ°å€
public class AddressDTO {
    @NotBlank(message = "æ”¶è´§äººä¸èƒ½ä¸ºç©º")
    private String receiver;
    
    @NotBlank(message = "æ”¶è´§ç”µè¯ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "ç”µè¯æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
    
    @NotBlank(message = "è¯¦ç»†åœ°å€ä¸èƒ½ä¸ºç©º")
    private String detail;
}

// è®¢å•å•†å“é¡¹
public class OrderItemDTO {
    @NotNull(message = "å•†å“IDä¸èƒ½ä¸ºç©º")
    private Long productId;
    
    @NotNull(message = "è´­ä¹°æ•°é‡ä¸èƒ½ä¸ºç©º")
    @Min(value = 1, message = "è´­ä¹°æ•°é‡è‡³å°‘ä¸º1")
    private Integer quantity;
}
```

**åµŒå¥—æ ¡éªŒç†è§£å›¾**ï¼š

```
OrderDTO (è®¢å•)
    â”œâ”€ @Valid AddressDTO (æ”¶è´§åœ°å€)
    â”‚      â”œâ”€ @NotBlank receiver
    â”‚      â”œâ”€ @Pattern phone
    â”‚      â””â”€ @NotBlank detail
    â”‚
    â””â”€ @Valid List<OrderItemDTO> (å•†å“åˆ—è¡¨)
           â”œâ”€ OrderItemDTO[0]
           â”‚      â”œâ”€ @NotNull productId
           â”‚      â””â”€ @Min quantity
           â””â”€ OrderItemDTO[1]
                  â””â”€ ...

æ ¡éªŒä¼šé€’å½’æ£€æŸ¥æ‰€æœ‰å±‚çº§ï¼
```

### 6.3 åˆ†ç»„æ ¡éªŒå®æˆ˜æ¡ˆä¾‹


```java
// å•†å“ç®¡ç†åœºæ™¯
public class ProductDTO {
    
    @NotNull(groups = UpdateGroup.class, message = "æ›´æ–°æ—¶å•†å“IDä¸èƒ½ä¸ºç©º")
    private Long id;
    
    @NotBlank(groups = {AddGroup.class, UpdateGroup.class}, 
              message = "å•†å“åç§°ä¸èƒ½ä¸ºç©º")
    private String name;
    
    @NotNull(groups = AddGroup.class, message = "æ–°å¢æ—¶å¿…é¡»æŒ‡å®šåˆ†ç±»")
    private Long categoryId;
    
    @Min(value = 0, groups = {AddGroup.class, UpdateGroup.class}, 
         message = "ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°")
    private BigDecimal price;
}

// Controller
@PostMapping("/product")
public Result<?> add(@Validated(AddGroup.class) @RequestBody ProductDTO dto) {
    // åªæ ¡éªŒAddGroupè§„åˆ™ï¼šnameã€categoryIdã€price
    return Result.success("æ·»åŠ æˆåŠŸ");
}

@PutMapping("/product")
public Result<?> update(@Validated(UpdateGroup.class) @RequestBody ProductDTO dto) {
    // åªæ ¡éªŒUpdateGroupè§„åˆ™ï¼šidã€nameã€price
    return Result.success("æ›´æ–°æˆåŠŸ");
}
```

### 6.4 è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£ï¼ˆé«˜çº§ï¼‰


```java
// è‡ªå®šä¹‰æ‰‹æœºå·æ ¡éªŒæ³¨è§£
@Target({ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = PhoneValidator.class)
public @interface Phone {
    String message() default "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®";
    Class<?>[] groups() default {};
    Class<? extends Payload>[] payload() default {};
}

// æ ¡éªŒå™¨å®ç°
public class PhoneValidator implements ConstraintValidator<Phone, String> {
    
    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {
        if (value == null || value.isEmpty()) {
            return true;  // ç©ºå€¼ç”±@NotBlankå¤„ç†
        }
        return value.matches("^1[3-9]\\d{9}$");
    }
}

// ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
public class UserDTO {
    @NotBlank(message = "æ‰‹æœºå·ä¸èƒ½ä¸ºç©º")
    @Phone  // â† ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
    private String phone;
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®æ ¡éªŒä½œç”¨ï¼šæ‹¦æˆªè„æ•°æ®ï¼Œä¿è¯æ•°æ®è´¨é‡
ğŸ”¸ JSR-303è§„èŒƒï¼šJavaå®˜æ–¹çš„æ•°æ®æ ¡éªŒæ ‡å‡†
ğŸ”¸ Bean Validationï¼šå¯¹JavaBeanå¯¹è±¡å±æ€§çš„æ ¡éªŒ
ğŸ”¸ @Valid vs @Validatedï¼šæ ‡å‡†æ³¨è§£ vs Springæ‰©å±•
ğŸ”¸ BindingResultï¼šæ¥æ”¶æ ¡éªŒé”™è¯¯ä¿¡æ¯
ğŸ”¸ å…¨å±€å¼‚å¸¸å¤„ç†ï¼šç»Ÿä¸€å¤„ç†æ ¡éªŒå¤±è´¥
```

### 7.2 å¸¸ç”¨æ³¨è§£è®°å¿†å¡ç‰‡


| åˆ†ç±» | **æ³¨è§£** | **è®°å¿†å£è¯€** |
|------|---------|-------------|
| **ç©ºå€¼** | `@NotNull` | `ä¸ä¸ºnullï¼Œç©ºä¸²å¯ä»¥` |
| **ç©ºå€¼** | `@NotEmpty` | `ä¸ä¸ºç©ºï¼Œç©ºä¸²ä¸è¡Œ` |
| **ç©ºå€¼** | `@NotBlank` | `æœ€ä¸¥æ ¼ï¼Œç©ºæ ¼éƒ½ä¸è¡Œ` |
| **é•¿åº¦** | `@Size` | `é™é•¿åº¦ï¼Œå­—ç¬¦ä¸²å’Œé›†åˆ` |
| **æ•°å€¼** | `@Min/@Max` | `é™èŒƒå›´ï¼Œæ•°å€¼ç±»å‹` |
| **æ ¼å¼** | `@Pattern` | `æ­£åˆ™åŒ¹é…ï¼Œæ ¼å¼æ ¡éªŒ` |
| **æ ¼å¼** | `@Email` | `é‚®ç®±ä¸“ç”¨ï¼Œå¼€ç®±å³ç”¨` |

### 7.3 å®æˆ˜å¼€å‘å»ºè®®


**âœ… æœ€ä½³å®è·µ**ï¼š
1. **ä¼˜å…ˆç”¨å…¨å±€å¼‚å¸¸å¤„ç†**ï¼Œä¸è¦æ¯ä¸ªæ¥å£å†™ `BindingResult`
2. **messageä¿¡æ¯è¦å‹å¥½**ï¼Œè®©ç”¨æˆ·çœ‹å¾—æ‡‚é”™è¯¯
3. **åµŒå¥—å¯¹è±¡è®°å¾—åŠ  @Valid**ï¼Œå¦åˆ™ä¸ä¼šé€’å½’æ ¡éªŒ
4. **åˆ†ç»„æ ¡éªŒè¦è°¨æ…**ï¼Œåœºæ™¯ç®€å•æ—¶ä¸ç”¨è¿‡åº¦è®¾è®¡

**âŒ å¸¸è§è¯¯åŒº**ï¼š
1. ä»¥ä¸º `@NotNull` èƒ½æ ¡éªŒç©ºå­—ç¬¦ä¸²ï¼ˆä¸èƒ½ï¼ï¼‰
2. åµŒå¥—å¯¹è±¡å¿˜è®°åŠ  `@Valid`ï¼ˆå­å¯¹è±¡ä¸ä¼šæ ¡éªŒï¼ï¼‰
3. `BindingResult` ä½ç½®å†™é”™ï¼ˆå¿…é¡»ç´§è·Ÿ@Validå‚æ•°ï¼ï¼‰
4. æ ¡éªŒæ³¨è§£åŠ åœ¨æ–¹æ³•ä¸Šï¼ˆåº”è¯¥åŠ åœ¨å­—æ®µä¸Šï¼ï¼‰

### 7.4 ä»æ–°æ‰‹åˆ°ç†Ÿç»ƒçš„å­¦ä¹ è·¯å¾„


```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åº”ç”¨
  â†“
æŒæ¡å¸¸ç”¨æ³¨è§£ï¼š@NotBlankã€@Sizeã€@Pattern
æŒæ¡åŸºæœ¬ç”¨æ³•ï¼š@Valid + BindingResult

ç¬¬äºŒé˜¶æ®µï¼šè¿›é˜¶æŠ€å·§
  â†“
ç†è§£@Valid vs @ValidatedåŒºåˆ«
æŒæ¡åµŒå¥—æ ¡éªŒå’Œåˆ†ç»„æ ¡éªŒ
ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åº”ç”¨
  â†“
è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£
å¤æ‚ä¸šåŠ¡åœºæ™¯æ ¡éªŒ
æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ
```

### 7.5 ä¸€å¥è¯æ€»ç»“


> ğŸ’¡ **æ ¸å¿ƒè®°å¿†**ï¼šæ•°æ®æ ¡éªŒå°±æ˜¯ç»™JavaBeançš„å±æ€§åŠ ä¸Š"è§„åˆ™æ³¨è§£"ï¼Œç”¨ `@Valid` è§¦å‘æ ¡éªŒï¼Œç”¨ `BindingResult` æˆ–å…¨å±€å¼‚å¸¸å¤„ç†é”™è¯¯ï¼Œä¿è¯è„æ•°æ®è¿›ä¸æ¥ï¼

**å­¦ä¹ å»ºè®®**ï¼š
- å…ˆæŠŠå¸¸ç”¨æ³¨è§£ç»ƒç†Ÿï¼ˆ80%çš„åœºæ™¯å¤Ÿç”¨ï¼‰
- é‡åˆ°å¤æ‚åœºæ™¯å†å­¦åˆ†ç»„æ ¡éªŒ
- å¤šå†™å¤šç»ƒï¼Œè®°ä½å„ä¸ªæ³¨è§£çš„åŒºåˆ«
- çœ‹å®˜æ–¹æ–‡æ¡£å’Œæºç ï¼Œç†è§£åŸç†æ›´é‡è¦