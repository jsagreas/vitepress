---
title: 6ã€è‡ªå®šä¹‰å‚æ•°è§£æå™¨å¼€å‘
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å‚æ•°è§£æå™¨](#1-ä»€ä¹ˆæ˜¯å‚æ•°è§£æå™¨)
2. [ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å‚æ•°è§£æ](#2-ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å‚æ•°è§£æ)
3. [HandlerMethodArgumentResolveræ ¸å¿ƒæ¥å£](#3-HandlerMethodArgumentResolveræ ¸å¿ƒæ¥å£)
4. [å®æˆ˜ï¼šå¼€å‘è‡ªå®šä¹‰å‚æ•°è§£æå™¨](#4-å®æˆ˜å¼€å‘è‡ªå®šä¹‰å‚æ•°è§£æå™¨)
5. [å‚æ•°è§£æå™¨çš„æ³¨å†Œä¸é…ç½®](#5-å‚æ•°è§£æå™¨çš„æ³¨å†Œä¸é…ç½®)
6. [è§£æå™¨ä¼˜å…ˆçº§ä¸æ‰§è¡Œé¡ºåº](#6-è§£æå™¨ä¼˜å…ˆçº§ä¸æ‰§è¡Œé¡ºåº)
7. [é«˜çº§åº”ç”¨åœºæ™¯](#7-é«˜çº§åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯å‚æ•°è§£æå™¨


### 1.1 å‚æ•°è§£æå™¨çš„æœ¬è´¨


**é€šä¿—ç†è§£**ï¼šå‚æ•°è§£æå™¨å°±åƒæ˜¯ä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼Œå®ƒè´Ÿè´£æŠŠHTTPè¯·æ±‚ä¸­çš„å„ç§æ•°æ®ï¼ˆè¯·æ±‚å‚æ•°ã€è¯·æ±‚å¤´ã€Cookieç­‰ï¼‰è½¬æ¢æˆControlleræ–¹æ³•éœ€è¦çš„å‚æ•°ç±»å‹ã€‚

```
HTTPè¯·æ±‚                å‚æ•°è§£æå™¨               Controlleræ–¹æ³•
    â†“                      â†“                        â†“
è¯·æ±‚æ•°æ®        â†’    æ•°æ®æå–å’Œè½¬æ¢    â†’    Javaæ–¹æ³•å‚æ•°
(å­—ç¬¦ä¸²å½¢å¼)          (ç¿»è¯‘è¿‡ç¨‹)           (å…·ä½“çš„Javaå¯¹è±¡)
```

**ä¸¾ä¸ªç”Ÿæ´»ä¾‹å­**ï¼š
```
å°±åƒä½ å»å›½å¤–é¤å…ç‚¹é¤ï¼š
- ä½ è¯´çš„æ˜¯ä¸­æ–‡ â†’ HTTPè¯·æ±‚
- æœåŠ¡å‘˜ç¿»è¯‘æˆè‹±æ–‡ â†’ å‚æ•°è§£æå™¨
- å¨å¸ˆç†è§£å¹¶åšèœ â†’ Controllerå¤„ç†
```

### 1.2 Spring MVCè‡ªå¸¦çš„å‚æ•°è§£æå™¨


**Spring MVCå†…ç½®äº†å¾ˆå¤šè§£æå™¨**ï¼Œå¤„ç†å¸¸è§çš„å‚æ•°ç±»å‹ï¼š

| è§£æå™¨ç±»å‹ | å¤„ç†çš„å‚æ•° | ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ |
|-----------|-----------|-------------|
| **RequestParamMethodArgumentResolver** | `@RequestParam` æ³¨è§£çš„å‚æ•° | `?name=å¼ ä¸‰` â†’ String name |
| **PathVariableMethodArgumentResolver** | `@PathVariable` æ³¨è§£çš„å‚æ•° | `/user/{id}` â†’ Long id |
| **RequestHeaderMethodArgumentResolver** | `@RequestHeader` æ³¨è§£çš„å‚æ•° | è·å–è¯·æ±‚å¤´ä¿¡æ¯ |
| **RequestBodyArgumentResolver** | `@RequestBody` æ³¨è§£çš„å‚æ•° | JSONæ•°æ® â†’ Javaå¯¹è±¡ |
| **SessionAttributeMethodArgumentResolver** | `@SessionAttribute` æ³¨è§£çš„å‚æ•° | è·å–Sessionä¸­çš„æ•°æ® |

**å·¥ä½œæµç¨‹ç¤ºæ„**ï¼š
```
                Spring MVC è¯·æ±‚å¤„ç†æµç¨‹
                         
ç”¨æˆ·è¯·æ±‚ â†’ DispatcherServlet â†’ æ‰¾åˆ°å¯¹åº”çš„Controlleræ–¹æ³•
                                        â†“
                              æŸ¥æ‰¾åˆé€‚çš„å‚æ•°è§£æå™¨
                                        â†“
                              [å†…ç½®è§£æå™¨1] èƒ½å¤„ç†å—ï¼Ÿä¸è¡Œ
                              [å†…ç½®è§£æå™¨2] èƒ½å¤„ç†å—ï¼Ÿä¸è¡Œ
                              [å†…ç½®è§£æå™¨3] èƒ½å¤„ç†å—ï¼Ÿå¯ä»¥ï¼
                                        â†“
                              è§£æå‚æ•° â†’ è°ƒç”¨Controlleræ–¹æ³•
```

### 1.3 å‚æ•°è§£æçš„å®Œæ•´è¿‡ç¨‹


**æ­¥éª¤æ‹†è§£**ï¼ˆä»¥è·å–ç”¨æˆ·åä¸ºä¾‹ï¼‰ï¼š

```java
// 1. Controlleræ–¹æ³•å®šä¹‰
@GetMapping("/user")
public String getUser(@RequestParam String name) {
    return "Hello " + name;
}

// 2. ç”¨æˆ·è®¿é—®ï¼šhttp://localhost:8080/user?name=å¼ ä¸‰

// 3. Spring MVC å†…éƒ¨å¤„ç†è¿‡ç¨‹ï¼š
//    â‘  DispatcherServletæ¥æ”¶è¯·æ±‚
//    â‘¡ æ‰¾åˆ°getUseræ–¹æ³•
//    â‘¢ å‘ç°éœ€è¦ä¸€ä¸ªStringç±»å‹çš„nameå‚æ•°
//    â‘£ éå†æ‰€æœ‰å‚æ•°è§£æå™¨
//    â‘¤ RequestParamMethodArgumentResolverè¯´ï¼šæˆ‘èƒ½å¤„ç†ï¼
//    â‘¥ ä»è¯·æ±‚å‚æ•°ä¸­å–å‡º"å¼ ä¸‰"
//    â‘¦ æŠŠ"å¼ ä¸‰"ä¼ ç»™getUseræ–¹æ³•
//    â‘§ æ–¹æ³•æ‰§è¡Œï¼Œè¿”å›"Hello å¼ ä¸‰"
```

---

## 2. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å‚æ•°è§£æ


### 2.1 å†…ç½®è§£æå™¨çš„å±€é™æ€§


**åœºæ™¯1ï¼šä¸šåŠ¡å‚æ•°å°è£…**
```java
// âŒ å†…ç½®è§£æå™¨åªèƒ½è¿™æ ·å†™ï¼ˆå‚æ•°å¾ˆå¤šæ—¶å¾ˆéº»çƒ¦ï¼‰
@GetMapping("/search")
public List<User> search(
    @RequestParam String keyword,
    @RequestParam Integer pageNum,
    @RequestParam Integer pageSize,
    @RequestParam(required = false) String sortField,
    @RequestParam(required = false) String sortOrder
) {
    // æ–¹æ³•å‚æ•°å¤ªå¤šï¼Œä¸ä¼˜é›…
}

// âœ… ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°è§£æå™¨å
@GetMapping("/search")
public List<User> search(@SearchParam SearchCondition condition) {
    // å‚æ•°å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œç®€æ´æ¸…æ™°
}
```

**åœºæ™¯2ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·**
```java
// âŒ æ¯ä¸ªæ–¹æ³•éƒ½è¦è¿™æ ·å†™ï¼ˆé‡å¤ä»£ç ï¼‰
@GetMapping("/profile")
public User getProfile(HttpSession session) {
    User user = (User) session.getAttribute("user");
    if (user == null) {
        throw new RuntimeException("æœªç™»å½•");
    }
    return user;
}

// âœ… ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°è§£æå™¨å
@GetMapping("/profile")
public User getProfile(@CurrentUser User user) {
    // ç›´æ¥æ‹¿åˆ°å½“å‰ç™»å½•ç”¨æˆ·ï¼Œä¸ç”¨å†™é‡å¤ä»£ç 
    return user;
}
```

### 2.2 è‡ªå®šä¹‰è§£æå™¨çš„ä¼˜åŠ¿


**æ ¸å¿ƒå¥½å¤„**ï¼š

ğŸ”¸ **å‡å°‘é‡å¤ä»£ç **
- æŠŠå…¬å…±çš„å‚æ•°è·å–é€»è¾‘å°è£…èµ·æ¥
- ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„ä½¿ç”¨

ğŸ”¸ **æé«˜ä»£ç å¯è¯»æ€§**
- Controlleræ–¹æ³•æ›´ç®€æ´
- ä¸šåŠ¡é€»è¾‘æ›´æ¸…æ™°

ğŸ”¸ **ç»Ÿä¸€å‚æ•°å¤„ç†**
- ç»Ÿä¸€çš„éªŒè¯é€»è¾‘
- ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†

ğŸ”¸ **æ”¯æŒå¤æ‚ä¸šåŠ¡åœºæ™¯**
- å†…ç½®è§£æå™¨æ— æ³•æ»¡è¶³çš„éœ€æ±‚
- è‡ªå®šä¹‰ä¸šåŠ¡è§„åˆ™

---

## 3. ğŸ”‘ HandlerMethodArgumentResolveræ ¸å¿ƒæ¥å£


### 3.1 æ¥å£å®šä¹‰ä¸æ–¹æ³•è¯´æ˜


**æ¥å£å…¨è²Œ**ï¼š
```java
public interface HandlerMethodArgumentResolver {
    
    /**
     * åˆ¤æ–­å½“å‰è§£æå™¨æ˜¯å¦æ”¯æŒè§£æè¿™ä¸ªå‚æ•°
     * @param parameter æ–¹æ³•å‚æ•°ä¿¡æ¯
     * @return trueè¡¨ç¤ºæ”¯æŒï¼Œfalseè¡¨ç¤ºä¸æ”¯æŒ
     */
    boolean supportsParameter(MethodParameter parameter);
    
    /**
     * çœŸæ­£æ‰§è¡Œå‚æ•°è§£æçš„æ–¹æ³•
     * @param parameter æ–¹æ³•å‚æ•°ä¿¡æ¯
     * @param mavContainer Modelå’ŒViewå®¹å™¨
     * @param webRequest å½“å‰è¯·æ±‚å¯¹è±¡
     * @param binderFactory æ•°æ®ç»‘å®šå·¥å‚
     * @return è§£æåçš„å‚æ•°å€¼
     */
    Object resolveArgument(
        MethodParameter parameter,
        ModelAndViewContainer mavContainer,
        NativeWebRequest webRequest,
        WebDataBinderFactory binderFactory
    ) throws Exception;
}
```

### 3.2 ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨


**supportsParameter æ–¹æ³•**ï¼š
```
ä½œç”¨ï¼šå‘Šè¯‰Spring MVC"æˆ‘èƒ½ä¸èƒ½å¤„ç†è¿™ä¸ªå‚æ•°"

å°±åƒå¿«é€’åˆ†æ‹£ï¼š
- é¡ºä¸°å¿«é€’å‘˜ï¼šè¿™æ˜¯é¡ºä¸°çš„åŒ…è£¹å—ï¼Ÿæ˜¯çš„è¯æˆ‘æ¥é€
- äº¬ä¸œå¿«é€’å‘˜ï¼šè¿™æ˜¯äº¬ä¸œçš„åŒ…è£¹å—ï¼Ÿæ˜¯çš„è¯æˆ‘æ¥é€
- å‚æ•°è§£æå™¨ï¼šè¿™ä¸ªå‚æ•°æˆ‘èƒ½å¤„ç†å—ï¼Ÿèƒ½çš„è¯æˆ‘æ¥è§£æ
```

**resolveArgument æ–¹æ³•**ï¼š
```
ä½œç”¨ï¼šçœŸæ­£å¹²æ´»ï¼ŒæŠŠè¯·æ±‚æ•°æ®è½¬æ¢æˆå‚æ•°å€¼

å°±åƒå¿«é€’å‘˜é€è´§ï¼š
- æ‰¾åˆ°æ”¶è´§åœ°å€
- æ‰¾åˆ°æ”¶è´§äºº
- æŠŠåŒ…è£¹äº¤ç»™æ”¶è´§äºº
- å‚æ•°è§£æå™¨ä¹Ÿæ˜¯ï¼šæ‰¾åˆ°æ•°æ®ï¼Œè½¬æ¢ç±»å‹ï¼Œè¿”å›ç»™æ–¹æ³•
```

### 3.3 å‚æ•°å¯¹è±¡è¯¦è§£


**MethodParameterï¼ˆæ–¹æ³•å‚æ•°ä¿¡æ¯ï¼‰**ï¼š
```java
// åŒ…å«äº†å‚æ•°çš„æ‰€æœ‰ä¿¡æ¯
MethodParameter parameter = ...;

parameter.getParameterType();     // å‚æ•°ç±»å‹ï¼Œå¦‚ï¼šString.class
parameter.hasParameterAnnotation(æ³¨è§£.class);  // æ˜¯å¦æœ‰æŸä¸ªæ³¨è§£
parameter.getParameterAnnotation(æ³¨è§£.class);  // è·å–æ³¨è§£å¯¹è±¡
parameter.getParameterName();     // å‚æ•°åç§°
```

**NativeWebRequestï¼ˆè¯·æ±‚å¯¹è±¡ï¼‰**ï¼š
```java
// åŒ…è£…äº†HttpServletRequestå’ŒHttpServletResponse
NativeWebRequest webRequest = ...;

// è·å–åŸç”ŸRequest
HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);

// è·å–è¯·æ±‚å‚æ•°
String param = webRequest.getParameter("name");

// è·å–è¯·æ±‚å¤´
String header = webRequest.getHeader("Authorization");

// è·å–Session
HttpSession session = request.getSession();
```

---

## 4. ğŸ’» å®æˆ˜ï¼šå¼€å‘è‡ªå®šä¹‰å‚æ•°è§£æå™¨


### 4.1 åœºæ™¯ä¸€ï¼šå½“å‰ç™»å½•ç”¨æˆ·æ³¨å…¥


**ä¸šåŠ¡éœ€æ±‚**ï¼šå¾ˆå¤šæ¥å£éœ€è¦è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œé¿å…æ¯æ¬¡éƒ½ä»Sessionè·å–ã€‚

**æ­¥éª¤1ï¼šå®šä¹‰è‡ªå®šä¹‰æ³¨è§£**
```java
/**
 * æ ‡è®°éœ€è¦æ³¨å…¥å½“å‰ç™»å½•ç”¨æˆ·çš„å‚æ•°
 */
@Target(ElementType.PARAMETER)  // åªèƒ½ç”¨åœ¨æ–¹æ³•å‚æ•°ä¸Š
@Retention(RetentionPolicy.RUNTIME)  // è¿è¡Œæ—¶æœ‰æ•ˆ
public @interface CurrentUser {
    /**
     * æ˜¯å¦å¿…é¡»ç™»å½•ï¼Œé»˜è®¤true
     * å¦‚æœä¸ºtrueä¸”æœªç™»å½•ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸
     */
    boolean required() default true;
}
```

**æ­¥éª¤2ï¼šå®ç°å‚æ•°è§£æå™¨**
```java
@Component  // æ³¨å†Œä¸ºSpringç»„ä»¶
public class CurrentUserArgumentResolver implements HandlerMethodArgumentResolver {
    
    /**
     * åˆ¤æ–­æ˜¯å¦æ”¯æŒè§£æè¿™ä¸ªå‚æ•°
     * æ¡ä»¶ï¼šå‚æ•°ä¸Šæœ‰@CurrentUseræ³¨è§£ï¼Œä¸”å‚æ•°ç±»å‹æ˜¯User
     */
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        // æ£€æŸ¥æ˜¯å¦æœ‰@CurrentUseræ³¨è§£
        boolean hasAnnotation = parameter.hasParameterAnnotation(CurrentUser.class);
        // æ£€æŸ¥å‚æ•°ç±»å‹æ˜¯å¦æ˜¯User
        boolean isUserType = User.class.isAssignableFrom(parameter.getParameterType());
        
        // ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³æ‰æ”¯æŒ
        return hasAnnotation && isUserType;
    }
    
    /**
     * è§£æå‚æ•°ï¼Œä»Sessionè·å–ç”¨æˆ·ä¿¡æ¯
     */
    @Override
    public Object resolveArgument(
            MethodParameter parameter,
            ModelAndViewContainer mavContainer,
            NativeWebRequest webRequest,
            WebDataBinderFactory binderFactory) throws Exception {
        
        // 1. è·å–åŸç”ŸHttpServletRequest
        HttpServletRequest request = webRequest.getNativeRequest(HttpServletRequest.class);
        
        // 2. ä»Sessionè·å–ç”¨æˆ·ä¿¡æ¯
        HttpSession session = request.getSession(false);
        User user = null;
        if (session != null) {
            user = (User) session.getAttribute("currentUser");
        }
        
        // 3. è·å–æ³¨è§£ï¼Œåˆ¤æ–­æ˜¯å¦å¿…é¡»ç™»å½•
        CurrentUser annotation = parameter.getParameterAnnotation(CurrentUser.class);
        if (annotation.required() && user == null) {
            throw new RuntimeException("ç”¨æˆ·æœªç™»å½•");
        }
        
        // 4. è¿”å›ç”¨æˆ·å¯¹è±¡
        return user;
    }
}
```

**æ­¥éª¤3ï¼šControllerä¸­ä½¿ç”¨**
```java
@RestController
@RequestMapping("/api")
public class UserController {
    
    /**
     * è·å–ä¸ªäººä¿¡æ¯ - å¿…é¡»ç™»å½•
     */
    @GetMapping("/profile")
    public User getProfile(@CurrentUser User user) {
        // ç›´æ¥ä½¿ç”¨userå¯¹è±¡ï¼Œä¸ç”¨å…³å¿ƒæ€ä¹ˆè·å–çš„
        return user;
    }
    
    /**
     * è·å–æ¨èå†…å®¹ - å¯ä»¥ä¸ç™»å½•
     */
    @GetMapping("/recommend")
    public List<Article> getRecommend(
            @CurrentUser(required = false) User user) {
        
        if (user != null) {
            // å·²ç™»å½•ç”¨æˆ·ï¼Œè¿”å›ä¸ªæ€§åŒ–æ¨è
            return getPersonalizedRecommend(user);
        } else {
            // æœªç™»å½•ç”¨æˆ·ï¼Œè¿”å›é»˜è®¤æ¨è
            return getDefaultRecommend();
        }
    }
}
```

### 4.2 åœºæ™¯äºŒï¼šåˆ†é¡µæŸ¥è¯¢å‚æ•°å°è£…


**ä¸šåŠ¡éœ€æ±‚**ï¼šç»Ÿä¸€å¤„ç†åˆ†é¡µã€æ’åºç­‰æŸ¥è¯¢æ¡ä»¶ã€‚

**æ­¥éª¤1ï¼šå®šä¹‰æŸ¥è¯¢æ¡ä»¶å¯¹è±¡**
```java
/**
 * é€šç”¨æŸ¥è¯¢æ¡ä»¶å°è£…
 */
public class QueryCondition {
    private Integer pageNum = 1;      // é¡µç ï¼Œé»˜è®¤ç¬¬1é¡µ
    private Integer pageSize = 10;     // æ¯é¡µå¤§å°ï¼Œé»˜è®¤10æ¡
    private String sortField;          // æ’åºå­—æ®µ
    private String sortOrder = "asc";  // æ’åºæ–¹å¼ï¼Œé»˜è®¤å‡åº
    
    // getterå’Œsetterçœç•¥...
}
```

**æ­¥éª¤2ï¼šå®šä¹‰æ³¨è§£**
```java
@Target(ElementType.PARAMETER)
@Retention(RetentionPolicy.RUNTIME)
public @interface QueryParam {
    // å¯ä»¥å®šä¹‰ä¸€äº›é…ç½®é¡¹
}
```

**æ­¥éª¤3ï¼šå®ç°è§£æå™¨**
```java
@Component
public class QueryConditionArgumentResolver implements HandlerMethodArgumentResolver {
    
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        return parameter.hasParameterAnnotation(QueryParam.class) &&
               QueryCondition.class.isAssignableFrom(parameter.getParameterType());
    }
    
    @Override
    public Object resolveArgument(
            MethodParameter parameter,
            ModelAndViewContainer mavContainer,
            NativeWebRequest webRequest,
            WebDataBinderFactory binderFactory) throws Exception {
        
        QueryCondition condition = new QueryCondition();
        
        // ä»è¯·æ±‚å‚æ•°ä¸­è·å–åˆ†é¡µä¿¡æ¯
        String pageNum = webRequest.getParameter("pageNum");
        String pageSize = webRequest.getParameter("pageSize");
        String sortField = webRequest.getParameter("sortField");
        String sortOrder = webRequest.getParameter("sortOrder");
        
        // è®¾ç½®å€¼ï¼Œå¦‚æœå‚æ•°ä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼
        if (pageNum != null) {
            condition.setPageNum(Integer.parseInt(pageNum));
        }
        if (pageSize != null) {
            condition.setPageSize(Integer.parseInt(pageSize));
        }
        if (sortField != null) {
            condition.setSortField(sortField);
        }
        if (sortOrder != null) {
            condition.setSortOrder(sortOrder);
        }
        
        return condition;
    }
}
```

**æ­¥éª¤4ï¼šControllerä¸­ä½¿ç”¨**
```java
@GetMapping("/users")
public PageResult<User> listUsers(@QueryParam QueryCondition condition) {
    // ç›´æ¥ä½¿ç”¨å°è£…å¥½çš„æŸ¥è¯¢æ¡ä»¶
    // ä¸ç”¨ä¸€ä¸ªä¸ªæ¥æ”¶pageNumã€pageSizeç­‰å‚æ•°
    return userService.listUsers(condition);
}

// è¯·æ±‚ç¤ºä¾‹ï¼š
// GET /users?pageNum=2&pageSize=20&sortField=createTime&sortOrder=desc
```

### 4.3 åœºæ™¯ä¸‰ï¼šè¯·æ±‚å¤´Tokenè§£æ


**ä¸šåŠ¡éœ€æ±‚**ï¼šä»è¯·æ±‚å¤´è·å–å¹¶è§£æJWT Tokenã€‚

**å®Œæ•´å®ç°**ï¼š
```java
// 1. å®šä¹‰æ³¨è§£
@Target(ElementType.PARAMETER)
@Retention(RetentionPolicy.RUNTIME)
public @interface Token {
}

// 2. å®ç°è§£æå™¨
@Component
public class TokenArgumentResolver implements HandlerMethodArgumentResolver {
    
    @Autowired
    private JwtTokenUtil jwtTokenUtil;  // JWTå·¥å…·ç±»
    
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        return parameter.hasParameterAnnotation(Token.class) &&
               String.class.isAssignableFrom(parameter.getParameterType());
    }
    
    @Override
    public Object resolveArgument(
            MethodParameter parameter,
            ModelAndViewContainer mavContainer,
            NativeWebRequest webRequest,
            WebDataBinderFactory binderFactory) throws Exception {
        
        // ä»è¯·æ±‚å¤´è·å–Token
        String authHeader = webRequest.getHeader("Authorization");
        
        if (authHeader == null || !authHeader.startsWith("Bearer ")) {
            throw new RuntimeException("Tokenä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯");
        }
        
        // æå–Tokenï¼ˆå»æ‰"Bearer "å‰ç¼€ï¼‰
        String token = authHeader.substring(7);
        
        // éªŒè¯Tokenæœ‰æ•ˆæ€§
        if (!jwtTokenUtil.validateToken(token)) {
            throw new RuntimeException("Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ");
        }
        
        return token;
    }
}

// 3. Controllerä½¿ç”¨
@GetMapping("/secure")
public String secureApi(@Token String token) {
    // ç›´æ¥æ‹¿åˆ°éªŒè¯è¿‡çš„token
    String userId = jwtTokenUtil.getUserIdFromToken(token);
    return "User ID: " + userId;
}
```

---

## 5. âš™ï¸ å‚æ•°è§£æå™¨çš„æ³¨å†Œä¸é…ç½®


### 5.1 æ³¨å†Œæ–¹å¼


**æ–¹å¼ä¸€ï¼šå®ç°WebMvcConfigureræ¥å£**ï¼ˆæ¨èï¼‰
```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    
    @Autowired
    private CurrentUserArgumentResolver currentUserResolver;
    
    @Autowired
    private QueryConditionArgumentResolver queryConditionResolver;
    
    /**
     * æ·»åŠ è‡ªå®šä¹‰å‚æ•°è§£æå™¨
     */
    @Override
    public void addArgumentResolvers(
            List<HandlerMethodArgumentResolver> resolvers) {
        
        // æ·»åŠ è‡ªå®šä¹‰è§£æå™¨
        resolvers.add(currentUserResolver);
        resolvers.add(queryConditionResolver);
        
        // å¯ä»¥æ·»åŠ å¤šä¸ªè§£æå™¨
    }
}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨@Beanæ³¨è§£**
```java
@Configuration
public class ResolverConfig {
    
    @Bean
    public WebMvcConfigurer webMvcConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addArgumentResolvers(
                    List<HandlerMethodArgumentResolver> resolvers) {
                resolvers.add(new CurrentUserArgumentResolver());
                resolvers.add(new QueryConditionArgumentResolver());
            }
        };
    }
}
```

### 5.2 é…ç½®è¯´æ˜


**é‡è¦æ³¨æ„äº‹é¡¹**ï¼š

âš ï¸ **è§£æå™¨çš„æ·»åŠ é¡ºåºå¾ˆé‡è¦**
```java
@Override
public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
    // ä¼˜å…ˆçº§é«˜çš„æ”¾å‰é¢
    resolvers.add(new HighPriorityResolver());    // å…ˆæ£€æŸ¥
    resolvers.add(new MediumPriorityResolver());  // å†æ£€æŸ¥
    resolvers.add(new LowPriorityResolver());     // æœ€åæ£€æŸ¥
}
```

âœ… **ç¡®ä¿è§£æå™¨æ³¨å†Œä¸ºSpringç»„ä»¶**
```java
// æ–¹å¼1ï¼šä½¿ç”¨@Componentæ³¨è§£
@Component
public class MyResolver implements HandlerMethodArgumentResolver {
    // ...
}

// æ–¹å¼2ï¼šåœ¨é…ç½®ç±»ä¸­@Beanæ³¨å†Œ
@Configuration
public class Config {
    @Bean
    public MyResolver myResolver() {
        return new MyResolver();
    }
}
```

---

## 6. ğŸ”¢ è§£æå™¨ä¼˜å…ˆçº§ä¸æ‰§è¡Œé¡ºåº


### 6.1 æ‰§è¡Œæµç¨‹


**Spring MVCçš„è§£æå™¨æŸ¥æ‰¾æœºåˆ¶**ï¼š
```
ç”¨æˆ·è¯·æ±‚åˆ°è¾¾
    â†“
Spring MVCå‘ç°Controlleræ–¹æ³•éœ€è¦å‚æ•°
    â†“
ä»è§£æå™¨åˆ—è¡¨ã€æŒ‰é¡ºåºã€‘é€ä¸ªè¯¢é—®ï¼š
    â†“
è§£æå™¨1ï¼šæˆ‘èƒ½å¤„ç†å—ï¼Ÿ â†’ supportsParameter()
    â†“ 
    è¿”å›falseï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
    â†“
è§£æå™¨2ï¼šæˆ‘èƒ½å¤„ç†å—ï¼Ÿ â†’ supportsParameter()
    â†“
    è¿”å›trueï¼Œå°±æ˜¯ä½ äº†ï¼
    â†“
è§£æå™¨2ï¼šå¼€å§‹è§£æ â†’ resolveArgument()
    â†“
è¿”å›è§£æç»“æœç»™Controlleræ–¹æ³•
```

### 6.2 ä¼˜å…ˆçº§è§„åˆ™


**åŸåˆ™**ï¼š
- âœ… **è‡ªå®šä¹‰è§£æå™¨**é€šå¸¸æ”¾åœ¨å‰é¢
- âœ… **ç‰¹æ®Šè§£æå™¨**ä¼˜å…ˆäºé€šç”¨è§£æå™¨
- âœ… **ä¸šåŠ¡è§£æå™¨**ä¼˜å…ˆäºæ¡†æ¶é»˜è®¤è§£æå™¨

**ç¤ºä¾‹**ï¼š
```java
@Override
public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
    // 1. æœ€ä¼˜å…ˆï¼šç‰¹å®šä¸šåŠ¡çš„è§£æå™¨
    resolvers.add(new CurrentUserArgumentResolver());
    
    // 2. å…¶æ¬¡ï¼šé€šç”¨ä¸šåŠ¡è§£æå™¨
    resolvers.add(new QueryConditionArgumentResolver());
    
    // 3. æœ€åï¼šæ¡†æ¶é»˜è®¤è§£æå™¨ä¼šè‡ªåŠ¨æ·»åŠ 
    // ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ 
}
```

### 6.3 å†²çªå¤„ç†


**å¦‚æœä¸¤ä¸ªè§£æå™¨éƒ½è¿”å›trueæ€ä¹ˆåŠï¼Ÿ**

```java
// è§£æå™¨A
@Override
public boolean supportsParameter(MethodParameter parameter) {
    return parameter.hasParameterAnnotation(MyAnnotation.class);
}

// è§£æå™¨Bï¼ˆä¹Ÿè¿”å›trueï¼‰
@Override
public boolean supportsParameter(MethodParameter parameter) {
    return parameter.hasParameterAnnotation(MyAnnotation.class);
}

// è§£å†³åŠæ³•ï¼šæ›´ç²¾ç¡®çš„åˆ¤æ–­æ¡ä»¶
@Override
public boolean supportsParameter(MethodParameter parameter) {
    // ä¸ä»…è¦æœ‰æ³¨è§£ï¼Œè¿˜è¦æ£€æŸ¥å‚æ•°ç±»å‹
    return parameter.hasParameterAnnotation(MyAnnotation.class) &&
           User.class.isAssignableFrom(parameter.getParameterType());
}
```

---

## 7. ğŸš€ é«˜çº§åº”ç”¨åœºæ™¯


### 7.1 ç»„åˆä½¿ç”¨å¤šä¸ªæ³¨è§£


**éœ€æ±‚**ï¼šåŒæ—¶éœ€è¦å½“å‰ç”¨æˆ·å’ŒæŸ¥è¯¢æ¡ä»¶

```java
@GetMapping("/my-orders")
public PageResult<Order> getMyOrders(
        @CurrentUser User user,              // è‡ªåŠ¨æ³¨å…¥å½“å‰ç”¨æˆ·
        @QueryParam QueryCondition condition // è‡ªåŠ¨å°è£…æŸ¥è¯¢æ¡ä»¶
) {
    // æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•ï¼Œæ”¯æŒåˆ†é¡µ
    return orderService.listUserOrders(user.getId(), condition);
}
```

### 7.2 å‚æ•°éªŒè¯å¢å¼º


**åœ¨è§£æå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘**ï¼š

```java
@Override
public Object resolveArgument(...) {
    QueryCondition condition = new QueryCondition();
    
    // è·å–å‚æ•°
    String pageNum = webRequest.getParameter("pageNum");
    String pageSize = webRequest.getParameter("pageSize");
    
    // éªŒè¯å‚æ•°åˆæ³•æ€§
    if (pageNum != null) {
        int num = Integer.parseInt(pageNum);
        if (num < 1) {
            throw new IllegalArgumentException("é¡µç å¿…é¡»å¤§äº0");
        }
        condition.setPageNum(num);
    }
    
    if (pageSize != null) {
        int size = Integer.parseInt(pageSize);
        if (size < 1 || size > 100) {
            throw new IllegalArgumentException("æ¯é¡µæ•°é‡å¿…é¡»åœ¨1-100ä¹‹é—´");
        }
        condition.setPageSize(size);
    }
    
    return condition;
}
```

### 7.3 å¤æ‚å¯¹è±¡æ„å»º


**éœ€æ±‚**ï¼šä»å¤šä¸ªæ¥æºç»„è£…å‚æ•°å¯¹è±¡

```java
public class ComplexParam {
    private User currentUser;      // æ¥è‡ªSession
    private String token;          // æ¥è‡ªHeader
    private QueryCondition query;  // æ¥è‡ªè¯·æ±‚å‚æ•°
}

// è§£æå™¨å®ç°
@Override
public Object resolveArgument(...) {
    ComplexParam param = new ComplexParam();
    
    // ä»Sessionè·å–ç”¨æˆ·
    HttpSession session = request.getSession();
    param.setCurrentUser((User) session.getAttribute("user"));
    
    // ä»Headerè·å–Token
    String token = webRequest.getHeader("Authorization");
    param.setToken(token);
    
    // è§£ææŸ¥è¯¢æ¡ä»¶
    QueryCondition query = parseQueryCondition(webRequest);
    param.setQuery(query);
    
    return param;
}
```

### 7.4 ä¸Spring Securityé›†æˆ


**ä»Securityä¸Šä¸‹æ–‡è·å–ç”¨æˆ·**ï¼š

```java
@Component
public class SecurityUserArgumentResolver implements HandlerMethodArgumentResolver {
    
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        return parameter.hasParameterAnnotation(CurrentUser.class);
    }
    
    @Override
    public Object resolveArgument(...) {
        // ä»Spring Securityä¸Šä¸‹æ–‡è·å–è®¤è¯ä¿¡æ¯
        Authentication authentication = 
            SecurityContextHolder.getContext().getAuthentication();
        
        if (authentication == null || !authentication.isAuthenticated()) {
            throw new RuntimeException("ç”¨æˆ·æœªç™»å½•");
        }
        
        // è¿”å›ç”¨æˆ·ä¿¡æ¯
        return (User) authentication.getPrincipal();
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ¦‚å¿µ


```
ğŸ”¸ å‚æ•°è§£æå™¨æœ¬è´¨ï¼šHTTPè¯·æ±‚æ•°æ®åˆ°Javaæ–¹æ³•å‚æ•°çš„"ç¿»è¯‘å®˜"
ğŸ”¸ æ ¸å¿ƒæ¥å£ï¼šHandlerMethodArgumentResolver
ğŸ”¸ ä¸¤ä¸ªå…³é”®æ–¹æ³•ï¼š
   - supportsParameterï¼šåˆ¤æ–­èƒ½å¦å¤„ç†
   - resolveArgumentï¼šçœŸæ­£æ‰§è¡Œè§£æ
ğŸ”¸ æ³¨å†Œæ–¹å¼ï¼šå®ç°WebMvcConfigurerçš„addArgumentResolversæ–¹æ³•
```

### 8.2 å¼€å‘æ­¥éª¤å›é¡¾


**å®Œæ•´å¼€å‘æµç¨‹**ï¼š

- [x] **ç¬¬ä¸€æ­¥**ï¼šå®šä¹‰è‡ªå®šä¹‰æ³¨è§£ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
- [x] **ç¬¬äºŒæ­¥**ï¼šå®ç°HandlerMethodArgumentResolveræ¥å£
- [x] **ç¬¬ä¸‰æ­¥**ï¼šç¼–å†™supportsParameteråˆ¤æ–­é€»è¾‘
- [x] **ç¬¬å››æ­¥**ï¼šç¼–å†™resolveArgumentè§£æé€»è¾‘
- [x] **ç¬¬äº”æ­¥**ï¼šåœ¨WebMvcConfigurerä¸­æ³¨å†Œè§£æå™¨
- [x] **ç¬¬å…­æ­¥**ï¼šåœ¨Controllerä¸­ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

ğŸ’¡ **å‡å°‘é‡å¤ä»£ç **
```java
// ä¹‹å‰ï¼šæ¯ä¸ªæ–¹æ³•éƒ½è¦å†™
User user = (User) session.getAttribute("user");

// ä¹‹åï¼šç›´æ¥ä½¿ç”¨
public String method(@CurrentUser User user)
```

ğŸ’¡ **ç»Ÿä¸€å‚æ•°å¤„ç†**
```java
// ä¹‹å‰ï¼šåˆ†æ•£åœ¨å„ä¸ªController
int pageNum = request.getParameter("pageNum");
int pageSize = request.getParameter("pageSize");

// ä¹‹åï¼šç»Ÿä¸€å°è£…
public List<Data> list(@QueryParam QueryCondition condition)
```

ğŸ’¡ **æå‡ä»£ç è´¨é‡**
- å‚æ•°è·å–é€»è¾‘é›†ä¸­ç®¡ç†
- Controlleræ–¹æ³•æ›´ç®€æ´æ¸…æ™°
- ä¸šåŠ¡ä»£ç ä¸æ¡†æ¶ä»£ç åˆ†ç¦»

### 8.4 æ³¨æ„äº‹é¡¹


âš ï¸ **å¸¸è§é”™è¯¯**ï¼š
```java
// âŒ é”™è¯¯1ï¼šå¿˜è®°æ³¨å†Œè§£æå™¨
// è§£æå™¨å†™å¥½äº†ä½†æ²¡æœ‰åœ¨WebMvcConfigurerä¸­æ³¨å†Œ

// âŒ é”™è¯¯2ï¼šsupportsParameteråˆ¤æ–­ä¸ä¸¥æ ¼
// å¯èƒ½å¯¼è‡´è§£æå™¨å†²çªæˆ–è§£æé”™è¯¯

// âŒ é”™è¯¯3ï¼šå¼‚å¸¸å¤„ç†ä¸å®Œå–„
// è§£æå¤±è´¥æ—¶åº”è¯¥æŠ›å‡ºæ˜ç¡®çš„å¼‚å¸¸ä¿¡æ¯
```

âœ… **æœ€ä½³å®è·µ**ï¼š
```java
// âœ… 1. è§£æå™¨åŠ ä¸Š@Componentæ³¨è§£ï¼Œæ–¹ä¾¿ä¾èµ–æ³¨å…¥
@Component
public class MyResolver implements HandlerMethodArgumentResolver {
    @Autowired
    private SomeService service;  // å¯ä»¥æ³¨å…¥å…¶ä»–æœåŠ¡
}

// âœ… 2. ç²¾ç¡®çš„åˆ¤æ–­æ¡ä»¶
public boolean supportsParameter(MethodParameter parameter) {
    return parameter.hasParameterAnnotation(MyAnnotation.class) &&
           MyType.class.isAssignableFrom(parameter.getParameterType());
}

// âœ… 3. å®Œå–„çš„å¼‚å¸¸å¤„ç†
public Object resolveArgument(...) {
    try {
        // è§£æé€»è¾‘
    } catch (Exception e) {
        throw new RuntimeException("å‚æ•°è§£æå¤±è´¥: " + e.getMessage(), e);
    }
}
```

### 8.5 å­¦ä¹ å»ºè®®


**ä»ç®€å•åˆ°å¤æ‚**ï¼š

1ï¸âƒ£ **å…¥é—¨é˜¶æ®µ**ï¼šå®ç°ç®€å•çš„å‚æ•°æ³¨å…¥ï¼ˆå¦‚@CurrentUserï¼‰

2ï¸âƒ£ **è¿›é˜¶é˜¶æ®µ**ï¼šå¤„ç†å¤æ‚å‚æ•°å°è£…ï¼ˆå¦‚QueryConditionï¼‰

3ï¸âƒ£ **é«˜çº§é˜¶æ®µ**ï¼šç»„åˆå¤šç§è§£æå™¨ï¼Œä¸å…¶ä»–æ¡†æ¶é›†æˆ

**è®°å¿†å£è¯€**ï¼š
```
å‚æ•°è§£æä¸¤æ­¥èµ°ï¼Œ
åˆ¤æ–­æ”¯æŒå…ˆå¼€å¤´ï¼Œ
çœŸæ­£è§£æåæ‰§è¡Œï¼Œ
æ³¨å†Œé…ç½®åˆ«å¿˜è®°ã€‚
```

---

**ğŸ¯ å®æˆ˜ç»ƒä¹ å»ºè®®**ï¼š

1. å®ç°ä¸€ä¸ª`@ClientIP`æ³¨è§£ï¼Œè‡ªåŠ¨æ³¨å…¥å®¢æˆ·ç«¯çœŸå®IPåœ°å€
2. å®ç°ä¸€ä¸ª`@RequestTime`æ³¨è§£ï¼Œè‡ªåŠ¨æ³¨å…¥è¯·æ±‚æ—¶é—´
3. ç»“åˆRediså®ç°ä¸€ä¸ª`@RateLimitUser`æ³¨è§£ï¼Œè‡ªåŠ¨åšé™æµæ£€æŸ¥

é€šè¿‡è¿™äº›ç»ƒä¹ ï¼Œä½ ä¼šå¯¹è‡ªå®šä¹‰å‚æ•°è§£æå™¨æœ‰æ›´æ·±åˆ»çš„ç†è§£ï¼