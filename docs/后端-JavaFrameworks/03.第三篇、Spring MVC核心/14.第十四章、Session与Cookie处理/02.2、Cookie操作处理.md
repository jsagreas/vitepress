---
title: 2ã€Cookieæ“ä½œå¤„ç†
---
## ğŸ“š ç›®å½•

1. [CookieåŸºç¡€æ¦‚å¿µ](#1-CookieåŸºç¡€æ¦‚å¿µ)
2. [è¯»å–Cookie - @CookieValueæ³¨è§£](#2-è¯»å–Cookie-CookieValueæ³¨è§£)
3. [è®¾ç½®Cookie - HttpServletResponse](#3-è®¾ç½®Cookie-HttpServletResponse)
4. [Cookieå±æ€§é…ç½®è¯¦è§£](#4-Cookieå±æ€§é…ç½®è¯¦è§£)
5. [Cookieå®‰å…¨æ€§è€ƒè™‘](#5-Cookieå®‰å…¨æ€§è€ƒè™‘)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸª CookieåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Cookieï¼Ÿ


**é€šä¿—ç†è§£**ï¼šCookieå°±åƒä½ å»å•†åº—è´­ç‰©æ—¶åº—å‘˜ç»™ä½ çš„ä¸€å¼ "ä¼šå‘˜å¡"ï¼Œä¸‹æ¬¡ä½ å†æ¥æ—¶ï¼Œåº—å‘˜é€šè¿‡è¿™å¼ å¡å°±èƒ½è®¤å‡ºä½ ï¼ŒçŸ¥é“ä½ çš„è´­ä¹°è®°å½•å’Œåå¥½ã€‚

**ä¸“ä¸šå®šä¹‰**ï¼šCookieæ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œæµè§ˆå™¨ä¼šåœ¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶æºå¸¦è¿™äº›æ•°æ®ã€‚

```
å·¥ä½œæµç¨‹ç¤ºæ„ï¼š

ç¬¬ä¸€æ¬¡è®¿é—®ï¼š
å®¢æˆ·ç«¯(æµè§ˆå™¨)  â”€â”€è¯·æ±‚â”€â”€>  æœåŠ¡å™¨
                         æœåŠ¡å™¨ï¼šåˆ›å»ºCookie
å®¢æˆ·ç«¯(æµè§ˆå™¨)  <â”€â”€å“åº”(æºå¸¦Cookie)â”€â”€ æœåŠ¡å™¨
                æµè§ˆå™¨ä¿å­˜Cookie

å†æ¬¡è®¿é—®ï¼š
å®¢æˆ·ç«¯(æµè§ˆå™¨)  â”€â”€è¯·æ±‚(æºå¸¦Cookie)â”€â”€> æœåŠ¡å™¨
                                   æœåŠ¡å™¨ï¼šè¯»å–Cookieè¯†åˆ«ç”¨æˆ·
å®¢æˆ·ç«¯(æµè§ˆå™¨)  <â”€â”€å“åº”â”€â”€  æœåŠ¡å™¨
```

### 1.2 Cookieçš„ç‰¹ç‚¹


| ç‰¹ç‚¹ | è¯´æ˜ | å®é™…ä¾‹å­ |
|------|------|----------|
| ğŸ”¸ **è‡ªåŠ¨æºå¸¦** | æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚æ—¶å‘é€Cookie | å°±åƒä¼šå‘˜å¡ä¼šè‡ªåŠ¨è¢«è¯†åˆ« |
| ğŸ”¸ **å¤§å°é™åˆ¶** | å•ä¸ªCookieä¸€èˆ¬ä¸è¶…è¿‡4KB | åªèƒ½å­˜ç®€å•ä¿¡æ¯ï¼Œä¸èƒ½å­˜å¤§æ–‡ä»¶ |
| ğŸ”¸ **æ•°é‡é™åˆ¶** | æ¯ä¸ªåŸŸåæœ€å¤šçº¦50ä¸ªCookie | ä¸èƒ½æ— é™åˆ¶åˆ›å»ºCookie |
| ğŸ”¸ **æœ‰æ•ˆæœŸ** | å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ | ä¼šå‘˜å¡å¯èƒ½æœ‰ä½¿ç”¨æœŸé™ |
| ğŸ”¸ **åŸŸåç»‘å®š** | Cookieåªèƒ½å‘é€ç»™åˆ›å»ºå®ƒçš„åŸŸå | Aå•†åº—çš„ä¼šå‘˜å¡ä¸èƒ½åœ¨Bå•†åº—ç”¨ |

### 1.3 Cookieçš„ä½œç”¨


**å¸¸è§ç”¨é€”**ï¼š
- âœ… **è®°ä½ç™»å½•çŠ¶æ€** - ä¸ç”¨æ¯æ¬¡éƒ½è¾“å…¥è´¦å·å¯†ç 
- âœ… **è´­ç‰©è½¦ä¿¡æ¯** - è®°å½•ä½ é€‰è´­çš„å•†å“
- âœ… **ç”¨æˆ·åå¥½** - è®°ä½è¯­è¨€ã€ä¸»é¢˜ç­‰è®¾ç½®
- âœ… **ç»Ÿè®¡åˆ†æ** - è®°å½•è®¿é—®æ¬¡æ•°ã€è¡Œä¸ºè½¨è¿¹

---

## 2. ğŸ“– è¯»å–Cookie - @CookieValueæ³¨è§£


### 2.1 åŸºæœ¬ç”¨æ³•


**@CookieValueæ³¨è§£æ˜¯ä»€ä¹ˆï¼Ÿ**
è¿™æ˜¯Spring MVCæä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œä¸“é—¨ç”¨æ¥è·å–Cookieçš„å€¼ï¼Œå°±åƒ"è¯»å¡å™¨"ä¸€æ ·ï¼Œèƒ½ä»æµè§ˆå™¨å‘æ¥çš„Cookieä¸­æå–ä½ éœ€è¦çš„ä¿¡æ¯ã€‚

**åŸºç¡€ç¤ºä¾‹**ï¼š

```java
@Controller
public class UserController {
    
    // è¯»å–åä¸º "username" çš„Cookie
    @GetMapping("/welcome")
    public String welcome(@CookieValue("username") String username, Model model) {
        model.addAttribute("name", username);
        return "welcome";  // è¿”å›æ¬¢è¿é¡µé¢
    }
}
```

**ğŸ’¡ è¿™æ®µä»£ç åšäº†ä»€ä¹ˆï¼Ÿ**
1. å½“ç”¨æˆ·è®¿é—® `/welcome` é¡µé¢æ—¶
2. Spring MVCè‡ªåŠ¨ä»è¯·æ±‚çš„Cookieä¸­æŸ¥æ‰¾åä¸º "username" çš„Cookie
3. æŠŠè¿™ä¸ªCookieçš„å€¼èµ‹ç»™ `username` å‚æ•°
4. æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç”¨æˆ·åäº†

### 2.2 å¤„ç†Cookieä¸å­˜åœ¨çš„æƒ…å†µ


**é—®é¢˜**ï¼šå¦‚æœç”¨æˆ·æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œæ ¹æœ¬æ²¡æœ‰Cookieæ€ä¹ˆåŠï¼Ÿ

**æ–¹æ¡ˆ1ï¼šè®¾ç½®é»˜è®¤å€¼**

```java
@GetMapping("/getUserInfo")
public String getUserInfo(
    @CookieValue(value = "username", defaultValue = "æ¸¸å®¢") String username,
    Model model
) {
    // å¦‚æœæ²¡æœ‰usernameè¿™ä¸ªCookieï¼Œå°±ä½¿ç”¨"æ¸¸å®¢"ä½œä¸ºé»˜è®¤å€¼
    model.addAttribute("currentUser", username);
    return "userInfo";
}
```

**æ–¹æ¡ˆ2ï¼šè®¾ç½®ä¸ºéå¿…éœ€**

```java
@GetMapping("/checkUser")
public String checkUser(
    @CookieValue(value = "username", required = false) String username,
    Model model
) {
    if (username == null) {
        // Cookieä¸å­˜åœ¨çš„å¤„ç†é€»è¾‘
        model.addAttribute("message", "æ‚¨è¿˜æœªç™»å½•");
        return "login";
    }
    
    model.addAttribute("message", "æ¬¢è¿å›æ¥ï¼Œ" + username);
    return "home";
}
```

### 2.3 è·å–Cookieå¯¹è±¡


**æœ‰æ—¶å€™æˆ‘ä»¬ä¸åªéœ€è¦Cookieçš„å€¼ï¼Œè¿˜éœ€è¦å…¶ä»–ä¿¡æ¯ï¼ˆæ¯”å¦‚è¿‡æœŸæ—¶é—´ã€è·¯å¾„ç­‰ï¼‰**

```java
@GetMapping("/cookieDetails")
public String getCookieDetails(
    @CookieValue("userId") Cookie userIdCookie,
    Model model
) {
    // è·å–Cookieçš„å„ç§ä¿¡æ¯
    String value = userIdCookie.getValue();      // Cookieçš„å€¼
    String name = userIdCookie.getName();        // Cookieçš„åç§°
    int maxAge = userIdCookie.getMaxAge();       // æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
    String path = userIdCookie.getPath();        // Cookieçš„è·¯å¾„
    
    model.addAttribute("cookieInfo", 
        String.format("åç§°:%s, å€¼:%s, æœ‰æ•ˆæœŸ:%dç§’", name, value, maxAge));
    
    return "cookieInfo";
}
```

### 2.4 @CookieValueæ³¨è§£å‚æ•°è¯¦è§£


| å‚æ•° | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| **value** | String | Cookieçš„åç§° | `@CookieValue("token")` |
| **required** | boolean | æ˜¯å¦å¿…éœ€ï¼Œé»˜è®¤true | `required = false` |
| **defaultValue** | String | é»˜è®¤å€¼ | `defaultValue = "guest"` |

---

## 3. âœï¸ è®¾ç½®Cookie - HttpServletResponse


### 3.1 ä¸ºä»€ä¹ˆéœ€è¦HttpServletResponseï¼Ÿ


**é€šä¿—ç†è§£**ï¼šå¦‚æœè¯´ `@CookieValue` æ˜¯"è¯»å¡å™¨"ï¼Œé‚£ `HttpServletResponse` å°±æ˜¯"åˆ¶å¡æœº"ï¼Œç”¨æ¥åˆ›å»ºå’Œå‘é€Cookieç»™æµè§ˆå™¨ã€‚

### 3.2 åŸºæœ¬è®¾ç½®Cookie


```java
@Controller
public class LoginController {
    
    @PostMapping("/login")
    public String login(
        @RequestParam String username,
        @RequestParam String password,
        HttpServletResponse response  // æ³¨å…¥å“åº”å¯¹è±¡
    ) {
        // 1. éªŒè¯ç”¨æˆ·åå¯†ç ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        if ("admin".equals(username) && "123456".equals(password)) {
            
            // 2. åˆ›å»ºCookie
            Cookie userCookie = new Cookie("username", username);
            
            // 3. é€šè¿‡å“åº”å¯¹è±¡å‘é€Cookieç»™æµè§ˆå™¨
            response.addCookie(userCookie);
            
            return "redirect:/home";  // ç™»å½•æˆåŠŸè·³è½¬é¦–é¡µ
        }
        
        return "login";  // ç™»å½•å¤±è´¥è¿”å›ç™»å½•é¡µ
    }
}
```

**ğŸ“ æ­¥éª¤è§£æ**ï¼š
1. **åˆ›å»ºCookieå¯¹è±¡** - `new Cookie(åç§°, å€¼)`
2. **æ·»åŠ åˆ°å“åº”ä¸­** - `response.addCookie(cookie)`
3. æµè§ˆå™¨æ”¶åˆ°å“åº”åä¼šè‡ªåŠ¨ä¿å­˜è¿™ä¸ªCookie

### 3.3 è®¾ç½®å¤šä¸ªCookie


```java
@PostMapping("/saveUserPreference")
public String savePreference(
    @RequestParam String theme,
    @RequestParam String language,
    HttpServletResponse response
) {
    // ä¿å­˜ä¸»é¢˜åå¥½
    Cookie themeCookie = new Cookie("theme", theme);
    response.addCookie(themeCookie);
    
    // ä¿å­˜è¯­è¨€åå¥½
    Cookie langCookie = new Cookie("language", language);
    response.addCookie(langCookie);
    
    return "redirect:/settings";
}
```

### 3.4 åˆ é™¤Cookieçš„æŠ€å·§


**é‡ç‚¹**ï¼šCookieæ²¡æœ‰ç›´æ¥çš„"åˆ é™¤"æ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º0æ¥å®ç°åˆ é™¤æ•ˆæœã€‚

```java
@GetMapping("/logout")
public String logout(HttpServletResponse response) {
    
    // åˆ›å»ºåŒåCookie
    Cookie userCookie = new Cookie("username", null);
    
    // è®¾ç½®ç«‹å³è¿‡æœŸï¼ˆç­‰åŒäºåˆ é™¤ï¼‰
    userCookie.setMaxAge(0);
    
    // è®¾ç½®è·¯å¾„ï¼ˆå¿…é¡»ä¸åŸCookieè·¯å¾„ä¸€è‡´ï¼‰
    userCookie.setPath("/");
    
    // å‘é€ç»™æµè§ˆå™¨
    response.addCookie(userCookie);
    
    return "redirect:/login";
}
```

**âš ï¸ åˆ é™¤Cookieæ³¨æ„äº‹é¡¹**ï¼š
- Cookieçš„ **åç§°ã€è·¯å¾„ã€åŸŸå** å¿…é¡»ä¸è¦åˆ é™¤çš„Cookieå®Œå…¨ä¸€è‡´
- åªæœ‰è¿™æ ·æµè§ˆå™¨æ‰èƒ½æ­£ç¡®è¯†åˆ«å¹¶åˆ é™¤

---

## 4. âš™ï¸ Cookieå±æ€§é…ç½®è¯¦è§£


### 4.1 MaxAge - æœ‰æ•ˆæœŸè®¾ç½®


**MaxAgeæ˜¯ä»€ä¹ˆï¼Ÿ**
å°±æ˜¯Cookieçš„"ä¿è´¨æœŸ"ï¼Œå†³å®šCookieèƒ½ä¿å­˜å¤šé•¿æ—¶é—´ã€‚

```java
@PostMapping("/rememberMe")
public String rememberMe(
    @RequestParam String username,
    @RequestParam boolean remember,  // æ˜¯å¦è®°ä½æˆ‘
    HttpServletResponse response
) {
    Cookie userCookie = new Cookie("username", username);
    
    if (remember) {
        // è®°ä½30å¤©ï¼ˆ30å¤© Ã— 24å°æ—¶ Ã— 60åˆ†é’Ÿ Ã— 60ç§’ï¼‰
        userCookie.setMaxAge(30 * 24 * 60 * 60);
    } else {
        // ä»…åœ¨æµè§ˆå™¨ä¼šè¯æœŸé—´æœ‰æ•ˆï¼ˆå…³é—­æµè§ˆå™¨å°±åˆ é™¤ï¼‰
        userCookie.setMaxAge(-1);
    }
    
    response.addCookie(userCookie);
    return "redirect:/home";
}
```

**MaxAgeå–å€¼è¯´æ˜**ï¼š

| å€¼ | å«ä¹‰ | å®é™…æ•ˆæœ |
|------|------|----------|
| **æ­£æ•°** | å­˜æ´»ç§’æ•° | Cookieä¼šä¿å­˜æŒ‡å®šæ—¶é—´åè¿‡æœŸ |
| **0** | ç«‹å³åˆ é™¤ | ç›¸å½“äºåˆ é™¤Cookie |
| **-1** | ä¼šè¯Cookie | æµè§ˆå™¨å…³é—­æ—¶åˆ é™¤ï¼ˆé»˜è®¤å€¼ï¼‰ |

**ğŸ’¡ ç”Ÿæ´»ä¾‹å­**ï¼š
- `MaxAge = 86400` â†’ åƒ24å°æ—¶å†…æœ‰æ•ˆçš„åœè½¦ç¥¨
- `MaxAge = -1` â†’ åƒä¸´æ—¶é€šè¡Œè¯ï¼Œå‡ºé—¨å°±ä½œåºŸ
- `MaxAge = 0` â†’ åƒä¸»åŠ¨ä¸Šäº¤è¯ä»¶

### 4.2 Path - è·¯å¾„ä½œç”¨åŸŸ


**Pathæ˜¯ä»€ä¹ˆï¼Ÿ**
å†³å®šCookieåœ¨å“ªäº›URLè·¯å¾„ä¸‹æœ‰æ•ˆï¼Œå°±åƒ"é€šè¡Œè¯çš„ä½¿ç”¨èŒƒå›´"ã€‚

```java
@GetMapping("/admin/setting")
public String adminSetting(HttpServletResponse response) {
    
    Cookie adminCookie = new Cookie("adminToken", "abc123");
    
    // åªåœ¨ /admin åŠå…¶å­è·¯å¾„ä¸‹æœ‰æ•ˆ
    adminCookie.setPath("/admin");
    
    response.addCookie(adminCookie);
    return "adminSetting";
}
```

**è·¯å¾„åŒ¹é…è§„åˆ™**ï¼š

```
è®¾ç½® Path = "/admin"

âœ… æœ‰æ•ˆçš„URLï¼š
   /admin
   /admin/users
   /admin/setting/profile

âŒ æ— æ•ˆçš„URLï¼š
   /
   /user
   /public
```

**å¸¸è§Pathè®¾ç½®**ï¼š

| Pathå€¼ | ä½œç”¨èŒƒå›´ | ä½¿ç”¨åœºæ™¯ |
|--------|----------|----------|
| **/** | æ•´ä¸ªç½‘ç«™ | å…¨å±€ç”¨æˆ·ä¿¡æ¯ã€è¯­è¨€è®¾ç½® |
| **/user** | /userè·¯å¾„åŠå­è·¯å¾„ | ç”¨æˆ·ç›¸å…³åŠŸèƒ½ |
| **/admin** | /adminè·¯å¾„åŠå­è·¯å¾„ | ç®¡ç†å‘˜åŠŸèƒ½åŒº |

### 4.3 Domain - åŸŸåä½œç”¨åŸŸ


**Domainæ˜¯ä»€ä¹ˆï¼Ÿ**
å†³å®šCookieå¯ä»¥å‘é€ç»™å“ªäº›åŸŸåï¼Œå°±åƒ"è·¨åº—é€šç”¨çš„ä¼šå‘˜å¡"ã€‚

```java
@PostMapping("/setGlobalCookie")
public String setGlobalCookie(HttpServletResponse response) {
    
    Cookie cookie = new Cookie("userLevel", "VIP");
    
    // è®¾ç½®ä¸ºé¡¶çº§åŸŸåï¼Œæ‰€æœ‰å­åŸŸåéƒ½å¯ä»¥è®¿é—®
    cookie.setDomain(".example.com");
    
    cookie.setPath("/");
    response.addCookie(cookie);
    
    return "success";
}
```

**åŸŸåå…±äº«ç¤ºä¾‹**ï¼š

```
è®¾ç½® Domain = ".example.com"

âœ… å¯ä»¥è®¿é—®çš„åŸŸåï¼š
   www.example.com
   api.example.com
   admin.example.com
   example.com

âŒ ä¸èƒ½è®¿é—®ï¼š
   www.other.com
   example.net
```

**âš ï¸ Domainè®¾ç½®æ³¨æ„**ï¼š
- ä¸èƒ½è®¾ç½®ä¸ºå…¶ä»–å…¬å¸çš„åŸŸåï¼ˆæµè§ˆå™¨ä¼šæ‹’ç»ï¼‰
- è®¾ç½®ä¸º `.example.com` å¯ä»¥åœ¨å­åŸŸåé—´å…±äº«
- é»˜è®¤åªèƒ½åœ¨å½“å‰åŸŸåä½¿ç”¨

---

## 5. ğŸ” Cookieå®‰å…¨æ€§è€ƒè™‘


### 5.1 HttpOnly - é˜²æ­¢JavaScriptè¯»å–


**HttpOnlyæ˜¯ä»€ä¹ˆï¼Ÿ**
è®¾ç½®åï¼ŒJavaScriptæ— æ³•è¯»å–è¿™ä¸ªCookieï¼Œåªæœ‰æœåŠ¡å™¨èƒ½è®¿é—®ï¼Œå°±åƒ"é˜²ç›—é”"ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦HttpOnlyï¼Ÿ**
é˜²æ­¢XSSæ”»å‡»ï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰çªƒå–Cookieã€‚

```java
@PostMapping("/secureLogin")
public String secureLogin(
    @RequestParam String username,
    HttpServletResponse response
) {
    // åˆ›å»ºæ•æ„Ÿçš„è®¤è¯Cookie
    Cookie authCookie = new Cookie("authToken", "secure-token-123");
    
    // ğŸ”’ è®¾ç½®HttpOnlyï¼ŒJavaScriptæ— æ³•è®¿é—®
    authCookie.setHttpOnly(true);
    
    // è®¾ç½®7å¤©æœ‰æ•ˆæœŸ
    authCookie.setMaxAge(7 * 24 * 60 * 60);
    
    response.addCookie(authCookie);
    return "redirect:/dashboard";
}
```

**å¯¹æ¯”æ•ˆæœ**ï¼š

| è®¾ç½® | JavaScriptèƒ½å¦è¯»å– | å®‰å…¨æ€§ |
|------|-------------------|--------|
| `setHttpOnly(false)` | âœ… èƒ½è¯»å– | âš ï¸ ä½ - å®¹æ˜“è¢«XSSæ”»å‡» |
| `setHttpOnly(true)` | âŒ ä¸èƒ½è¯»å– | âœ… é«˜ - é˜²æ­¢XSSçªƒå– |

**ğŸ’¡ ä»€ä¹ˆæ—¶å€™ç”¨HttpOnlyï¼Ÿ**
- âœ… **ç™»å½•å‡­è¯ã€è®¤è¯Token** - å¿…é¡»è®¾ç½®
- âœ… **ç”¨æˆ·æ•æ„Ÿä¿¡æ¯** - å»ºè®®è®¾ç½®
- âŒ **å‰ç«¯éœ€è¦è¯»å–çš„æ•°æ®** - ä¸è¦è®¾ç½®ï¼ˆå¦‚è¯­è¨€åå¥½ï¼‰

### 5.2 Secure - HTTPSä¼ è¾“ä¿æŠ¤


**Secureæ˜¯ä»€ä¹ˆï¼Ÿ**
è®¾ç½®åï¼ŒCookieåªèƒ½é€šè¿‡HTTPSåŠ å¯†è¿æ¥ä¼ è¾“ï¼Œå°±åƒ"è´µé‡ç‰©å“è¦ä¸“è½¦è¿è¾“"ã€‚

```java
@PostMapping("/httpsLogin")
public String httpsLogin(
    @RequestParam String username,
    HttpServletResponse response
) {
    Cookie secureCookie = new Cookie("sessionId", "session-xyz-789");
    
    // ğŸ”’ åªåœ¨HTTPSè¿æ¥ä¸­ä¼ è¾“
    secureCookie.setSecure(true);
    
    // é…åˆHttpOnlyä½¿ç”¨
    secureCookie.setHttpOnly(true);
    
    secureCookie.setMaxAge(1800);  // 30åˆ†é’Ÿ
    
    response.addCookie(secureCookie);
    return "redirect:/secure-area";
}
```

**ä¼ è¾“å¯¹æ¯”**ï¼š

```
Secure = falseï¼ˆé»˜è®¤ï¼‰:
HTTP  âœ… å¯ä»¥ä¼ è¾“
HTTPS âœ… å¯ä»¥ä¼ è¾“
é£é™©ï¼šHTTPæ˜æ–‡ä¼ è¾“ï¼Œå¯èƒ½è¢«çªƒå¬

Secure = true:
HTTP  âŒ ä¸ä¼ è¾“Cookie
HTTPS âœ… åŠ å¯†ä¼ è¾“
å®‰å…¨ï¼šåªåœ¨åŠ å¯†è¿æ¥ä¸­ä½¿ç”¨
```

**âš ï¸ Secureä½¿ç”¨æ³¨æ„**ï¼š
- å¼€å‘ç¯å¢ƒç”¨HTTPæµ‹è¯•æ—¶ï¼ŒSecureçš„Cookieä¸ä¼šå‘é€
- ç”Ÿäº§ç¯å¢ƒå»ºè®®æ‰€æœ‰æ•æ„ŸCookieéƒ½è®¾ç½®Secure
- å¿…é¡»é…åˆHTTPSè¯ä¹¦ä½¿ç”¨

### 5.3 SameSite - è·¨ç«™è¯·æ±‚ä¿æŠ¤


**SameSiteæ˜¯ä»€ä¹ˆï¼Ÿ**
æ§åˆ¶Cookieåœ¨è·¨ç«™è¯·æ±‚æ—¶æ˜¯å¦å‘é€ï¼Œé˜²æ­¢CSRFæ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€‚

**ä¸‰ç§æ¨¡å¼å¯¹æ¯”**ï¼š

| æ¨¡å¼ | è·¨ç«™è¯·æ±‚æ˜¯å¦å‘é€Cookie | ä½¿ç”¨åœºæ™¯ |
|------|----------------------|----------|
| **Strict** | âŒ å®Œå…¨ä¸å‘é€ | æœ€ä¸¥æ ¼ï¼Œå¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒ |
| **Lax** | âš ï¸ éƒ¨åˆ†å‘é€ï¼ˆé¡¶çº§å¯¼èˆªï¼‰ | æ¨èï¼Œå¹³è¡¡å®‰å…¨å’Œä½“éªŒ |
| **None** | âœ… æ€»æ˜¯å‘é€ | éœ€è¦è·¨ç«™å…±äº«ï¼Œå¿…é¡»é…åˆSecure |

**åœ¨Spring Bootä¸­é…ç½®SameSite**ï¼š

```java
@Configuration
public class CookieConfig {
    
    @Bean
    public WebServerFactoryCustomizer<TomcatServletWebServerFactory> cookieCustomizer() {
        return factory -> factory.addContextCustomizers(context -> {
            // å…¨å±€è®¾ç½®Cookieçš„SameSiteå±æ€§
            Rfc6265CookieProcessor processor = new Rfc6265CookieProcessor();
            processor.setSameSiteCookies("Lax");  // è®¾ç½®ä¸ºLaxæ¨¡å¼
            context.setCookieProcessor(processor);
        });
    }
}
```

### 5.4 å®‰å…¨æœ€ä½³å®è·µ


**å®Œæ•´çš„å®‰å…¨Cookieè®¾ç½®ç¤ºä¾‹**ï¼š

```java
@PostMapping("/createSecureCookie")
public String createSecureCookie(
    @RequestParam String userId,
    HttpServletResponse response
) {
    // åˆ›å»ºCookie
    Cookie cookie = new Cookie("user_session", userId);
    
    // âœ… è®¾ç½®æœ‰æ•ˆæœŸï¼ˆ30åˆ†é’Ÿï¼‰
    cookie.setMaxAge(30 * 60);
    
    // âœ… è®¾ç½®è·¯å¾„
    cookie.setPath("/");
    
    // âœ… é˜²æ­¢JavaScriptè®¿é—®
    cookie.setHttpOnly(true);
    
    // âœ… åªåœ¨HTTPSä¼ è¾“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
    cookie.setSecure(true);
    
    // å‘é€Cookie
    response.addCookie(cookie);
    
    return "success";
}
```

**ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•**ï¼š

- [ ] æ•æ„ŸCookieè®¾ç½®äº† `HttpOnly`
- [ ] ç”Ÿäº§ç¯å¢ƒè®¾ç½®äº† `Secure`
- [ ] è®¾ç½®äº†åˆç†çš„ `MaxAge`
- [ ] ä¸åœ¨Cookieä¸­å­˜å‚¨æ•æ„Ÿæ˜æ–‡ä¿¡æ¯
- [ ] ä½¿ç”¨äº†HTTPSåè®®
- [ ] è€ƒè™‘äº†SameSiteè®¾ç½®

---

## 6. ğŸ’¼ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 å®ç°"è®°ä½æˆ‘"åŠŸèƒ½


```java
@Controller
public class RememberMeController {
    
    @PostMapping("/login")
    public String login(
        @RequestParam String username,
        @RequestParam String password,
        @RequestParam(required = false) boolean rememberMe,
        HttpServletResponse response
    ) {
        // éªŒè¯ç”¨æˆ·ï¼ˆå®é™…åº”æŸ¥è¯¢æ•°æ®åº“ï¼‰
        if (validateUser(username, password)) {
            
            Cookie userCookie = new Cookie("rememberedUser", username);
            
            if (rememberMe) {
                // è®°ä½30å¤©
                userCookie.setMaxAge(30 * 24 * 60 * 60);
            } else {
                // ä»…ä¼šè¯æœŸé—´
                userCookie.setMaxAge(-1);
            }
            
            userCookie.setPath("/");
            userCookie.setHttpOnly(true);
            response.addCookie(userCookie);
            
            return "redirect:/home";
        }
        
        return "login";
    }
    
    @GetMapping("/login")
    public String showLogin(
        @CookieValue(value = "rememberedUser", required = false) String username,
        Model model
    ) {
        // è‡ªåŠ¨å¡«å……ç”¨æˆ·å
        if (username != null) {
            model.addAttribute("username", username);
        }
        return "login";
    }
}
```

### 6.2 å®ç°è´­ç‰©è½¦


```java
@Controller
public class ShoppingCartController {
    
    @PostMapping("/addToCart")
    @ResponseBody
    public String addToCart(
        @RequestParam String productId,
        @CookieValue(value = "cartItems", defaultValue = "") String cartItems,
        HttpServletResponse response
    ) {
        // æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
        String updatedCart = cartItems.isEmpty() 
            ? productId 
            : cartItems + "," + productId;
        
        Cookie cartCookie = new Cookie("cartItems", updatedCart);
        cartCookie.setMaxAge(7 * 24 * 60 * 60);  // 7å¤©
        cartCookie.setPath("/");
        
        response.addCookie(cartCookie);
        
        return "æ·»åŠ æˆåŠŸ";
    }
    
    @GetMapping("/cart")
    public String viewCart(
        @CookieValue(value = "cartItems", defaultValue = "") String cartItems,
        Model model
    ) {
        // è§£æè´­ç‰©è½¦å•†å“
        String[] products = cartItems.isEmpty() 
            ? new String[0] 
            : cartItems.split(",");
        
        model.addAttribute("products", products);
        return "cart";
    }
}
```

### 6.3 å®ç°è®¿é—®è®¡æ•°


```java
@Controller
public class VisitCounterController {
    
    @GetMapping("/page")
    public String trackVisit(
        @CookieValue(value = "visitCount", defaultValue = "0") String count,
        HttpServletResponse response,
        Model model
    ) {
        // å¢åŠ è®¿é—®æ¬¡æ•°
        int visitCount = Integer.parseInt(count) + 1;
        
        Cookie counterCookie = new Cookie("visitCount", String.valueOf(visitCount));
        counterCookie.setMaxAge(365 * 24 * 60 * 60);  // 1å¹´
        counterCookie.setPath("/");
        
        response.addCookie(counterCookie);
        
        model.addAttribute("visits", visitCount);
        return "page";
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ Cookieæœ¬è´¨**
- æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„å°å¡ç‰‡
- è‡ªåŠ¨æºå¸¦ã€æœ‰å¤§å°é™åˆ¶ã€æœ‰æœ‰æ•ˆæœŸ

**ğŸ”¸ è¯»å–Cookie**
- ä½¿ç”¨ `@CookieValue` æ³¨è§£è·å–Cookieå€¼
- å¯ä»¥è®¾ç½®é»˜è®¤å€¼å’Œæ˜¯å¦å¿…éœ€
- å¯ä»¥è·å–å®Œæ•´Cookieå¯¹è±¡

**ğŸ”¸ è®¾ç½®Cookie**
- é€šè¿‡ `HttpServletResponse` çš„ `addCookie()` æ–¹æ³•
- åˆ›å»ºCookieå¯¹è±¡ï¼š`new Cookie(åç§°, å€¼)`
- åˆ é™¤Cookieï¼šè®¾ç½®MaxAgeä¸º0

### 7.2 å…³é”®å±æ€§é…ç½®


| å±æ€§ | ä½œç”¨ | é‡è¦æç¤º |
|------|------|----------|
| **MaxAge** | æœ‰æ•ˆæœŸ | `-1`ä¼šè¯æœŸï¼Œ`0`åˆ é™¤ï¼Œæ­£æ•°ä¸ºç§’æ•° |
| **Path** | ä½œç”¨è·¯å¾„ | é»˜è®¤å½“å‰è·¯å¾„ï¼Œ`/`ä¸ºå…¨ç«™ |
| **Domain** | ä½œç”¨åŸŸå | å¯å®ç°å­åŸŸåå…±äº« |
| **HttpOnly** | é˜²JSè¯»å– | æ•æ„Ÿä¿¡æ¯å¿…é¡»è®¾ç½® |
| **Secure** | HTTPSä¼ è¾“ | ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½® |

### 7.3 å®‰å…¨è¦ç‚¹


**ğŸ”’ å®‰å…¨ä¸‰åŸåˆ™**ï¼š
1. **æ•æ„ŸCookieå¿…é¡»HttpOnly** - é˜²æ­¢XSSæ”»å‡»
2. **ç”Ÿäº§ç¯å¢ƒå¿…é¡»Secure** - é˜²æ­¢ä¸­é—´äººæ”»å‡»
3. **ä¸å­˜å‚¨æ˜æ–‡æ•æ„Ÿä¿¡æ¯** - å³ä½¿Cookieè¢«çªƒå–ä¹Ÿè¦æœ€å°åŒ–æŸå¤±

**âš ï¸ å¸¸è§é”™è¯¯**ï¼š
- âŒ åœ¨Cookieä¸­å­˜å‚¨å¯†ç 
- âŒ å­˜å‚¨æœªåŠ å¯†çš„ç”¨æˆ·éšç§
- âŒ å¿˜è®°è®¾ç½®HttpOnlyå’ŒSecure
- âŒ åˆ é™¤Cookieæ—¶è·¯å¾„ä¸åŒ¹é…

### 7.4 å®ç”¨æŠ€å·§


**ğŸ’¡ å¼€å‘å»ºè®®**ï¼š
- ç”¨Cookieå­˜å‚¨å°‘é‡ã€éæ•æ„Ÿçš„æ•°æ®
- å¤§é‡æ•°æ®ç”¨Sessionï¼ŒCookieå­˜Session ID
- è®°ä½Cookieæœ‰å¤§å°é™åˆ¶ï¼ˆçº¦4KBï¼‰
- æµ‹è¯•æ—¶æ³¨æ„æµè§ˆå™¨çš„CookieæŸ¥çœ‹å·¥å…·

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Cookieæœ¬æ˜¯å°å¡ç‰‡ï¼Œæµè§ˆæœåŠ¡æ¥ä¼ é€’
è¯»å–æ³¨è§£CookieValueï¼Œè®¾ç½®å“åº”addCookie
å®‰å…¨å±æ€§è¦ç‰¢è®°ï¼ŒHttpOnlyåŠ Secure
è·¯å¾„åŸŸåè®¾æ­£ç¡®ï¼Œè¿‡æœŸæ—¶é—´è¦åˆç†
```