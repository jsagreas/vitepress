---
title: 1ã€Sessionç®¡ç†æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [Sessionç®¡ç†åŸºç¡€](#1-Sessionç®¡ç†åŸºç¡€)
2. [Cookieæ“ä½œè¯¦è§£](#2-Cookieæ“ä½œè¯¦è§£)
3. [Sessionä¸Cookieçš„å…³ç³»](#3-Sessionä¸Cookieçš„å…³ç³»)
4. [åˆ†å¸ƒå¼Sessionè§£å†³æ–¹æ¡ˆ](#4-åˆ†å¸ƒå¼Sessionè§£å†³æ–¹æ¡ˆ)
5. [Sessionå®‰å…¨ä¸æœ€ä½³å®è·µ](#5-Sessionå®‰å…¨ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Sessionç®¡ç†åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Session


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šSessionå°±åƒä½ å»å•†åœºçš„"ä¸´æ—¶å‚¨ç‰©æŸœ"ï¼Œæ¯ä¸ªé¡¾å®¢ï¼ˆç”¨æˆ·ï¼‰éƒ½æœ‰è‡ªå·±ä¸“å±çš„æŸœå­ç¼–å·ï¼Œå¯ä»¥åœ¨é€›è¡—æœŸé—´æš‚å­˜ç‰©å“ï¼Œç¦»å¼€å•†åœºåæŸœå­å°±ä¼šè¢«æ¸…ç©ºã€‚

**ğŸ“– ä¸“ä¸šå®šä¹‰**
```
Sessionï¼ˆä¼šè¯ï¼‰ï¼šæœåŠ¡å™¨ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºçš„ç‹¬ç«‹å­˜å‚¨ç©ºé—´
ä½œç”¨ï¼šåœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯
ç‰¹ç‚¹ï¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œç›¸å¯¹å®‰å…¨
ç”Ÿå‘½å‘¨æœŸï¼šä»ç”¨æˆ·é¦–æ¬¡è®¿é—®åˆ°ä¼šè¯è¶…æ—¶æˆ–ä¸»åŠ¨å¤±æ•ˆ
```

**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦Sessionï¼Ÿ**

HTTPåè®®æœ¬èº«æ˜¯"æ— çŠ¶æ€"çš„ï¼Œå°±åƒé‡‘é±¼åªæœ‰7ç§’è®°å¿†ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯å…¨æ–°çš„ï¼ŒæœåŠ¡å™¨è®°ä¸ä½ä½ æ˜¯è°ã€‚

```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·ç™»å½• â†’ è®¿é—®ä¸ªäººä¸­å¿ƒ â†’ æœåŠ¡å™¨ï¼šä½ æ˜¯è°ï¼ŸğŸ¤”
ç”¨æˆ·æ·»åŠ è´­ç‰©è½¦ â†’ å»ç»“ç®— â†’ æœåŠ¡å™¨ï¼šè´­ç‰©è½¦åœ¨å“ªï¼ŸğŸ¤·

è§£å†³æ–¹æ¡ˆï¼š
é€šè¿‡Sessionè®°ä½ç”¨æˆ·èº«ä»½å’ŒçŠ¶æ€ä¿¡æ¯ï¼
```

### 1.2 è·å–HttpSessionå¯¹è±¡


**ğŸ¯ æ–¹å¼ä¸€ï¼šé€šè¿‡HttpServletRequestè·å–**

```java
@Controller
public class UserController {
    
    @RequestMapping("/login")
    public String login(HttpServletRequest request) {
        // è·å–Sessionå¯¹è±¡ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
        HttpSession session = request.getSession();
        
        // è·å–Sessionå¯¹è±¡ï¼ˆå¦‚æœä¸å­˜åœ¨è¿”å›nullï¼Œä¸åˆ›å»ºï¼‰
        HttpSession session2 = request.getSession(false);
        
        return "success";
    }
}
```

**ğŸ”¸ ä¸¤ç§æ–¹å¼çš„åŒºåˆ«**
- `getSession()` - æ²¡æœ‰Sessionå°±åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œæ°¸è¿œä¸è¿”å›null
- `getSession(false)` - æ²¡æœ‰Sessionå°±è¿”å›nullï¼Œä¸ä¼šåˆ›å»º

> âš ï¸ **ä½¿ç”¨å»ºè®®**ï¼šç™»å½•æ—¶ç”¨ `getSession()`ï¼ŒéªŒè¯ç™»å½•çŠ¶æ€æ—¶ç”¨ `getSession(false)`

**ğŸ¯ æ–¹å¼äºŒï¼šç›´æ¥åœ¨æ–¹æ³•å‚æ•°ä¸­å£°æ˜**

```java
@Controller
public class UserController {
    
    // Spring MVCä¼šè‡ªåŠ¨æ³¨å…¥HttpSessionå¯¹è±¡
    @RequestMapping("/userInfo")
    public String userInfo(HttpSession session) {
        // ç›´æ¥ä½¿ç”¨session
        String username = (String) session.getAttribute("username");
        return "userInfo";
    }
}
```

> ğŸ’¡ **æ¨èç”¨æ³•**ï¼šæ–¹å¼äºŒæ›´ç®€æ´ï¼ŒSpring MVCè‡ªåŠ¨å¸®ä½ å¤„ç†ï¼Œä»£ç æ›´æ¸…çˆ½

### 1.3 Sessionå±æ€§æ“ä½œ


**ğŸ“ å¸¸ç”¨æ“ä½œæ–¹æ³•**

| æ–¹æ³• | ä½œç”¨ | è¿”å›å€¼ |
|------|------|--------|
| `setAttribute(key, value)` | å­˜å‚¨æ•°æ®åˆ°Session | void |
| `getAttribute(key)` | ä»Sessionè·å–æ•°æ® | Object |
| `removeAttribute(key)` | åˆ é™¤Sessionä¸­çš„æ•°æ® | void |
| `invalidate()` | é”€æ¯æ•´ä¸ªSession | void |
| `getId()` | è·å–SessionID | String |

**ğŸ’» å®æˆ˜ç¤ºä¾‹ï¼šç”¨æˆ·ç™»å½•**

```java
@Controller
public class LoginController {
    
    @Autowired
    private UserService userService;
    
    // ç”¨æˆ·ç™»å½•
    @PostMapping("/login")
    public String login(String username, String password, 
                       HttpSession session, Model model) {
        
        // éªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.login(username, password);
        
        if (user != null) {
            // ç™»å½•æˆåŠŸï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Session
            session.setAttribute("currentUser", user);
            session.setAttribute("username", username);
            session.setAttribute("loginTime", new Date());
            
            return "redirect:/home";
        } else {
            model.addAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            return "login";
        }
    }
    
    // è·å–å½“å‰ç™»å½•ç”¨æˆ·
    @GetMapping("/profile")
    public String profile(HttpSession session, Model model) {
        User user = (User) session.getAttribute("currentUser");
        
        if (user == null) {
            return "redirect:/login";  // æœªç™»å½•ï¼Œè·³è½¬ç™»å½•é¡µ
        }
        
        model.addAttribute("user", user);
        return "profile";
    }
    
    // ç”¨æˆ·ç™»å‡º
    @GetMapping("/logout")
    public String logout(HttpSession session) {
        // æ–¹å¼1ï¼šåªåˆ é™¤ç‰¹å®šå±æ€§
        session.removeAttribute("currentUser");
        session.removeAttribute("username");
        
        // æ–¹å¼2ï¼šé”€æ¯æ•´ä¸ªSessionï¼ˆæ¨èï¼‰
        session.invalidate();
        
        return "redirect:/login";
    }
}
```

> ğŸ”§ **å®è·µå»ºè®®**ï¼š
> - ç™»å½•æˆåŠŸåå­˜å‚¨å¿…è¦çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆIDã€ç”¨æˆ·åã€è§’è‰²ç­‰ï¼‰
> - ä¸è¦å­˜å‚¨è¿‡å¤§çš„å¯¹è±¡ï¼Œä¼šå ç”¨æœåŠ¡å™¨å†…å­˜
> - ç™»å‡ºæ—¶ä½¿ç”¨ `invalidate()` å½»åº•æ¸…ç†

### 1.4 Sessionç”Ÿå‘½å‘¨æœŸ


**â° Sessionçš„ä¸€ç”Ÿ**

```
åˆ›å»ºæ—¶æœºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·é¦–æ¬¡è®¿é—®è°ƒç”¨getSession() â”‚
â”‚ 2. Spring MVCè‡ªåŠ¨åˆ›å»ºSession    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        ã€Sessionæ´»è·ƒæœŸã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ·æ–°æ´»è·ƒæ—¶é—´  â”‚
â”‚ â€¢ Sessionæ•°æ®å¯ä»¥è¯»å†™           â”‚
â”‚ â€¢ æœåŠ¡å™¨ç»´æŠ¤SessionçŠ¶æ€         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         é”€æ¯æ—¶æœºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¶…æ—¶æœªæ´»åŠ¨ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰     â”‚
â”‚ 2. ä¸»åŠ¨è°ƒç”¨invalidate()         â”‚
â”‚ 3. æœåŠ¡å™¨é‡å¯ï¼ˆéæŒä¹…åŒ–Sessionï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ é‡è¦å±æ€§**

```java
// è·å–Sessionåˆ›å»ºæ—¶é—´
long createTime = session.getCreationTime();

// è·å–æœ€åè®¿é—®æ—¶é—´
long lastAccessTime = session.getLastAccessedTime();

// è·å–æœ€å¤§éæ´»åŠ¨æ—¶é—´ï¼ˆç§’ï¼‰
int timeout = session.getMaxInactiveInterval();

// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º1å°æ—¶
session.setMaxInactiveInterval(3600);
```

### 1.5 Sessionè¶…æ—¶é…ç½®


**âš™ï¸ å…¨å±€é…ç½®æ–¹å¼**

**æ–¹å¼ä¸€ï¼šweb.xmlé…ç½®**
```xml
<session-config>
    <!-- è®¾ç½®Sessionè¶…æ—¶æ—¶é—´ä¸º30åˆ†é’Ÿ -->
    <session-timeout>30</session-timeout>
</session-config>
```

**æ–¹å¼äºŒï¼šapplication.propertiesé…ç½®**
```properties
# Sessionè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
server.servlet.session.timeout=1800

# æˆ–è€…ä½¿ç”¨æ—¶é—´å•ä½
server.servlet.session.timeout=30m
```

**æ–¹å¼ä¸‰ï¼šä»£ç åŠ¨æ€è®¾ç½®**
```java
// ä¸ºå½“å‰Sessionè®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
session.setMaxInactiveInterval(1800);  // 30åˆ†é’Ÿ

// è®¾ç½®æ°¸ä¸è¶…æ—¶ï¼ˆä¸æ¨èï¼‰
session.setMaxInactiveInterval(-1);
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - é…ç½®æ–‡ä»¶ä¸­å•ä½æ˜¯**åˆ†é’Ÿ**
> - ä»£ç ä¸­å•ä½æ˜¯**ç§’**
> - è¶…æ—¶æ—¶é—´ä¸æ˜¯ç»å¯¹çš„ï¼ŒæœåŠ¡å™¨ä¼šå®šæœŸæ£€æŸ¥

---

## 2. ğŸª Cookieæ“ä½œè¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯Cookie


> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šCookieå°±åƒè¶…å¸‚çš„"ä¼šå‘˜å¡"ï¼Œç¬¬ä¸€æ¬¡æ¶ˆè´¹æ—¶ç»™ä½ å‘ä¸€å¼ å¡ï¼Œä»¥åæ¯æ¬¡æ¥éƒ½å¸¦ç€è¿™å¼ å¡ï¼Œè¶…å¸‚å°±èƒ½è®¤å‡ºä½ æ˜¯è°ï¼Œç»™ä½ ä¼šå‘˜ä¼˜æƒ ã€‚

**ğŸ“– ä¸“ä¸šå®šä¹‰**
```
Cookieï¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨çš„å°æ–‡æœ¬æ–‡ä»¶
ä½œç”¨ï¼šåœ¨å®¢æˆ·ç«¯ä¿å­˜å°‘é‡æ•°æ®ï¼Œå®ç°çŠ¶æ€è·Ÿè¸ª
ç‰¹ç‚¹ï¼šå­˜å‚¨åœ¨æµè§ˆå™¨ç«¯ï¼Œå¤§å°æœ‰é™åˆ¶ï¼ˆ4KBï¼‰
å®‰å…¨æ€§ï¼šç›¸å¯¹ä¸å®‰å…¨ï¼Œå¯è¢«ç”¨æˆ·æŸ¥çœ‹å’Œä¿®æ”¹
```

**ğŸ” Cookieçš„å·¥ä½œæµç¨‹**

```
é¦–æ¬¡è®¿é—®ï¼š
æµè§ˆå™¨ â”€â”€â”€â”€â”€è¯·æ±‚â”€â”€â”€â”€â†’ æœåŠ¡å™¨
        â†â”€å“åº”+Cookieâ”€ (Set-Cookie: sessionId=abc123)
        
å†æ¬¡è®¿é—®ï¼š
æµè§ˆå™¨ â”€â”€è¯·æ±‚+Cookieâ†’ æœåŠ¡å™¨
   (Cookie: sessionId=abc123)
        â†â”€â”€â”€â”€å“åº”â”€â”€â”€â”€â”€ (æœåŠ¡å™¨è¯†åˆ«ç”¨æˆ·)
```

### 2.2 Cookieçš„åˆ›å»ºå’Œå‘é€


**ğŸ’» åŸºæœ¬æ“ä½œç¤ºä¾‹**

```java
@Controller
public class CookieController {
    
    // åˆ›å»ºå¹¶å‘é€Cookie
    @GetMapping("/setCookie")
    public String setCookie(HttpServletResponse response) {
        
        // åˆ›å»ºCookieå¯¹è±¡
        Cookie usernameCookie = new Cookie("username", "å¼ ä¸‰");
        Cookie themeCookie = new Cookie("theme", "dark");
        
        // è®¾ç½®Cookieå±æ€§
        usernameCookie.setMaxAge(7 * 24 * 60 * 60);  // 7å¤©
        usernameCookie.setPath("/");  // æ•´ä¸ªç½‘ç«™éƒ½å¯è®¿é—®
        
        themeCookie.setMaxAge(30 * 24 * 60 * 60);  // 30å¤©
        themeCookie.setPath("/");
        
        // å‘é€Cookieåˆ°å®¢æˆ·ç«¯
        response.addCookie(usernameCookie);
        response.addCookie(themeCookie);
        
        return "cookieSet";
    }
}
```

**ğŸ”¸ Cookieå±æ€§è¯¦è§£**

| å±æ€§ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `name` | Cookieåç§° | `username` |
| `value` | Cookieå€¼ | `å¼ ä¸‰` |
| `maxAge` | æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰| `7*24*60*60`ï¼ˆ7å¤©ï¼‰|
| `path` | è®¿é—®è·¯å¾„ | `/`ï¼ˆæ•´ç«™ï¼‰ã€`/user`ï¼ˆç‰¹å®šè·¯å¾„ï¼‰|
| `domain` | è®¿é—®åŸŸå | `.example.com` |
| `httpOnly` | ç¦æ­¢JSè®¿é—® | `true`ï¼ˆå®‰å…¨ï¼‰|
| `secure` | ä»…HTTPSä¼ è¾“ | `true`ï¼ˆåŠ å¯†ä¼ è¾“ï¼‰|

**ğŸ”¸ maxAgeå–å€¼è¯´æ˜**
```
æ­£æ•°ï¼šCookieåœ¨æŒ‡å®šç§’æ•°åå¤±æ•ˆ
  cookie.setMaxAge(3600);  // 1å°æ—¶åå¤±æ•ˆ

0ï¼šç«‹å³åˆ é™¤Cookie
  cookie.setMaxAge(0);     // åˆ é™¤Cookie

è´Ÿæ•°ï¼šæµè§ˆå™¨å…³é—­æ—¶å¤±æ•ˆï¼ˆä¼šè¯Cookieï¼‰
  cookie.setMaxAge(-1);    // é»˜è®¤å€¼ï¼Œå…³é—­æµè§ˆå™¨å°±æ²¡äº†
```

### 2.3 Cookieçš„è¯»å–


**ğŸ¯ æ–¹å¼ä¸€ï¼šé€šè¿‡HttpServletRequestè·å–**

```java
@GetMapping("/getCookie")
public String getCookie(HttpServletRequest request) {
    
    // è·å–æ‰€æœ‰Cookie
    Cookie[] cookies = request.getCookies();
    
    if (cookies != null) {
        for (Cookie cookie : cookies) {
            String name = cookie.getName();
            String value = cookie.getValue();
            System.out.println(name + " = " + value);
        }
    }
    
    return "cookieInfo";
}
```

**ğŸ¯ æ–¹å¼äºŒï¼šä½¿ç”¨@CookieValueæ³¨è§£ï¼ˆæ¨èï¼‰**

```java
@GetMapping("/welcome")
public String welcome(
    @CookieValue(value = "username", required = false) String username,
    @CookieValue(value = "theme", defaultValue = "light") String theme,
    Model model) {
    
    if (username != null) {
        model.addAttribute("message", "æ¬¢è¿å›æ¥ï¼Œ" + username);
    } else {
        model.addAttribute("message", "æ¬¢è¿ï¼Œè®¿å®¢");
    }
    
    model.addAttribute("theme", theme);
    return "welcome";
}
```

> ğŸ’¡ **@CookieValueæ³¨è§£å‚æ•°**ï¼š
> - `value` - Cookieåç§°
> - `required` - æ˜¯å¦å¿…é¡»ï¼Œé»˜è®¤true
> - `defaultValue` - é»˜è®¤å€¼

### 2.4 Cookieçš„åˆ é™¤


```java
@GetMapping("/deleteCookie")
public String deleteCookie(HttpServletResponse response) {
    
    // åˆ›å»ºåŒåCookie
    Cookie cookie = new Cookie("username", null);
    
    // è®¾ç½®è·¯å¾„ï¼ˆå¿…é¡»ä¸åˆ›å»ºæ—¶ä¸€è‡´ï¼‰
    cookie.setPath("/");
    
    // è®¾ç½®ç«‹å³å¤±æ•ˆ
    cookie.setMaxAge(0);
    
    // å‘é€åˆ°å®¢æˆ·ç«¯
    response.addCookie(cookie);
    
    return "cookieDeleted";
}
```

> âš ï¸ **åˆ é™¤Cookieæ³¨æ„äº‹é¡¹**ï¼š
> - Cookieçš„nameå’Œpathå¿…é¡»ä¸åˆ›å»ºæ—¶å®Œå…¨ä¸€è‡´
> - åªèƒ½åˆ é™¤è‡ªå·±åŸŸåä¸‹çš„Cookie
> - æ— æ³•åˆ é™¤HttpOnlyçš„Cookie

### 2.5 Cookieå®æˆ˜æ¡ˆä¾‹


**ğŸ“ æ¡ˆä¾‹ï¼šè®°ä½ç”¨æˆ·ååŠŸèƒ½**

```java
@Controller
public class LoginController {
    
    // ç™»å½•é¡µé¢
    @GetMapping("/login")
    public String loginPage(
        @CookieValue(value = "savedUsername", required = false) String username,
        Model model) {
        
        // å›æ˜¾ä¸Šæ¬¡ä¿å­˜çš„ç”¨æˆ·å
        if (username != null) {
            model.addAttribute("username", username);
        }
        return "login";
    }
    
    // å¤„ç†ç™»å½•
    @PostMapping("/login")
    public String login(
        String username, 
        String password,
        @RequestParam(value = "remember", required = false) String remember,
        HttpServletResponse response,
        HttpSession session) {
        
        // éªŒè¯ç™»å½•ï¼ˆçœç•¥ï¼‰
        boolean loginSuccess = true;
        
        if (loginSuccess) {
            // ä¿å­˜åˆ°Session
            session.setAttribute("currentUser", username);
            
            // å¦‚æœå‹¾é€‰"è®°ä½ç”¨æˆ·å"
            if ("on".equals(remember)) {
                Cookie cookie = new Cookie("savedUsername", username);
                cookie.setMaxAge(7 * 24 * 60 * 60);  // ä¿å­˜7å¤©
                cookie.setPath("/");
                response.addCookie(cookie);
            } else {
                // åˆ é™¤ä¹‹å‰ä¿å­˜çš„ç”¨æˆ·å
                Cookie cookie = new Cookie("savedUsername", null);
                cookie.setMaxAge(0);
                cookie.setPath("/");
                response.addCookie(cookie);
            }
            
            return "redirect:/home";
        }
        
        return "login";
    }
}
```

---

## 3. ğŸ”— Sessionä¸Cookieçš„å…³ç³»


### 3.1 å®ƒä»¬æ˜¯å¦‚ä½•é…åˆå·¥ä½œçš„


> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šCookieæ˜¯"é’¥åŒ™"ï¼ŒSessionæ˜¯"ä¿é™©æŸœ"

```
å·¥ä½œæµç¨‹è¯¦è§£ï¼š

æ­¥éª¤1ï¼šç”¨æˆ·é¦–æ¬¡è®¿é—®
æµè§ˆå™¨ â”€â”€â”€â”€â”€â”€è¯·æ±‚â”€â”€â”€â”€â”€â†’ æœåŠ¡å™¨
                        â”‚
                        â”œâ”€ åˆ›å»ºSessionå¯¹è±¡
                        â”œâ”€ ç”ŸæˆSessionID
                        â””â”€ åˆ›å»ºCookieå­˜å‚¨SessionID
       â†â”€â”€å“åº”+Cookieâ”€â”€ 
       (Set-Cookie: JSESSIONID=ABC123)

æ­¥éª¤2ï¼šç”¨æˆ·å†æ¬¡è®¿é—®
æµè§ˆå™¨ â”€â”€è¯·æ±‚+Cookieâ†’ æœåŠ¡å™¨
  (Cookie: JSESSIONID=ABC123)
                        â”‚
                        â”œâ”€ è¯»å–Cookieä¸­çš„SessionID
                        â”œâ”€ æŸ¥æ‰¾å¯¹åº”çš„Session
                        â””â”€ è·å–Sessionä¸­çš„æ•°æ®
       â†â”€â”€â”€â”€â”€å“åº”â”€â”€â”€â”€â”€
```

**ğŸ”¸ å…³ç³»æ€»ç»“**

| ç»´åº¦ | Cookie | Session |
|------|--------|---------|
| **å­˜å‚¨ä½ç½®** | å®¢æˆ·ç«¯æµè§ˆå™¨ | æœåŠ¡å™¨å†…å­˜ |
| **å­˜å‚¨å†…å®¹** | SessionIDï¼ˆé’¥åŒ™ï¼‰ | ç”¨æˆ·æ•°æ®ï¼ˆä¿é™©æŸœï¼‰|
| **å®‰å…¨æ€§** | è¾ƒä½ï¼Œå¯è¢«æŸ¥çœ‹ | è¾ƒé«˜ï¼ŒæœåŠ¡å™¨æ§åˆ¶ |
| **å¤§å°é™åˆ¶** | 4KB | æ— æ˜ç¡®é™åˆ¶ |
| **ç”Ÿå‘½å‘¨æœŸ** | å¯æŒä¹…åŒ– | ä¼šè¯çº§åˆ« |

### 3.2 SessionIDçš„ä¼ é€’æ–¹å¼


**ğŸ“Œ æ–¹å¼ä¸€ï¼šé€šè¿‡Cookieä¼ é€’ï¼ˆé»˜è®¤æ–¹å¼ï¼‰**

```
ä¼˜ç‚¹ï¼šè‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†
ç¼ºç‚¹ï¼šå¦‚æœCookieè¢«ç¦ç”¨ï¼ŒSessionå°†å¤±æ•ˆ

HTTPå“åº”å¤´ï¼š
Set-Cookie: JSESSIONID=A1B2C3D4E5F6; Path=/; HttpOnly
```

**ğŸ“Œ æ–¹å¼äºŒï¼šURLé‡å†™ï¼ˆCookieç¦ç”¨æ—¶ï¼‰**

```java
// Spring MVCä¼šè‡ªåŠ¨å¤„ç†URLé‡å†™
@GetMapping("/user/profile")
public String profile() {
    return "profile";
}

// ç”Ÿæˆçš„URLï¼ˆå¦‚æœCookieè¢«ç¦ç”¨ï¼‰ï¼š
// http://localhost:8080/user/profile;jsessionid=A1B2C3D4E5F6
```

**ğŸ“Œ æ–¹å¼ä¸‰ï¼šéšè—è¡¨å•å­—æ®µ**

```html
<!-- åœ¨è¡¨å•ä¸­æ‰‹åŠ¨ä¼ é€’SessionID -->
<form action="/submit" method="post">
    <input type="hidden" name="jsessionid" value="${sessionId}">
    <input type="text" name="username">
    <button type="submit">æäº¤</button>
</form>
```

> ğŸ’¡ **å®é™…å¼€å‘å»ºè®®**ï¼šä½¿ç”¨é»˜è®¤çš„Cookieæ–¹å¼å³å¯ï¼Œç°ä»£æµè§ˆå™¨å¾ˆå°‘å®Œå…¨ç¦ç”¨Cookie

---

## 4. ğŸŒ åˆ†å¸ƒå¼Sessionè§£å†³æ–¹æ¡ˆ


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦Sessionå…±äº«


**ğŸ¤” å•æœåŠ¡å™¨åœºæ™¯ï¼ˆæ— é—®é¢˜ï¼‰**

```
ç”¨æˆ·è¯·æ±‚ â†’ æœåŠ¡å™¨A â†’ Sessionå­˜å‚¨åœ¨Açš„å†…å­˜
         ï¼ˆæ‰€æœ‰è¯·æ±‚éƒ½åˆ°Aï¼ŒSessionæ­£å¸¸ä½¿ç”¨ï¼‰
```

**âŒ å¤šæœåŠ¡å™¨åœºæ™¯ï¼ˆå‡ºç°é—®é¢˜ï¼‰**

```
         â”Œâ†’ æœåŠ¡å™¨A (Session1)
ç”¨æˆ·è¯·æ±‚ â†’ è´Ÿè½½å‡è¡¡
         â””â†’ æœåŠ¡å™¨B (Session2)
         
é—®é¢˜ï¼šç”¨æˆ·åœ¨Aç™»å½•ï¼Œè¯·æ±‚è¢«åˆ†é…åˆ°Bï¼ŒBæ²¡æœ‰ç™»å½•ä¿¡æ¯ï¼
```

> âš ï¸ **é—®é¢˜è¡¨ç°**ï¼š
> - ç”¨æˆ·ç™»å½•åè®¿é—®å…¶ä»–é¡µé¢æ˜¾ç¤ºæœªç™»å½•
> - è´­ç‰©è½¦å•†å“æ—¶æœ‰æ—¶æ— 
> - ç”¨æˆ·ä¿¡æ¯ä¸¢å¤±

### 4.2 è§£å†³æ–¹æ¡ˆä¸€ï¼šSessionç²˜æ€§


**ğŸ”¸ åŸç†**ï¼šè´Ÿè½½å‡è¡¡å™¨ä¿è¯åŒä¸€ç”¨æˆ·çš„è¯·æ±‚å§‹ç»ˆåˆ†é…åˆ°åŒä¸€å°æœåŠ¡å™¨

```
         â”Œâ†’ æœåŠ¡å™¨A â† ç”¨æˆ·1çš„æ‰€æœ‰è¯·æ±‚
è´Ÿè½½å‡è¡¡ â”œâ†’ æœåŠ¡å™¨B â† ç”¨æˆ·2çš„æ‰€æœ‰è¯·æ±‚
         â””â†’ æœåŠ¡å™¨C â† ç”¨æˆ·3çš„æ‰€æœ‰è¯·æ±‚

é…ç½®ç¤ºä¾‹ï¼ˆNginxï¼‰ï¼š
upstream backend {
    ip_hash;  # æ ¹æ®IPå“ˆå¸Œåˆ†é…
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
}
```

**âœ… ä¼˜ç‚¹**ï¼šå®ç°ç®€å•ï¼Œæ— éœ€æ”¹ä»£ç   
**âŒ ç¼ºç‚¹**ï¼šæœåŠ¡å™¨å®•æœºä¼šä¸¢å¤±Sessionï¼Œè´Ÿè½½ä¸å‡è¡¡

### 4.3 è§£å†³æ–¹æ¡ˆäºŒï¼šSessionå¤åˆ¶


**ğŸ”¸ åŸç†**ï¼šæ‰€æœ‰æœåŠ¡å™¨ä¹‹é—´åŒæ­¥Sessionæ•°æ®

```
æœåŠ¡å™¨A â†â†’ æœåŠ¡å™¨B â†â†’ æœåŠ¡å™¨C
(SessionåŒæ­¥)

ä¼˜ç‚¹ï¼šé«˜å¯ç”¨ï¼Œä»»ä¸€æœåŠ¡å™¨å®•æœºä¸å½±å“
ç¼ºç‚¹ï¼šç½‘ç»œå¼€é”€å¤§ï¼ŒæœåŠ¡å™¨å¤šæ—¶æ€§èƒ½å·®
```

### 4.4 è§£å†³æ–¹æ¡ˆä¸‰ï¼šé›†ä¸­å¼Sessionå­˜å‚¨ï¼ˆæ¨èï¼‰


**ğŸ”¸ åŸç†**ï¼šå°†Sessionç»Ÿä¸€å­˜å‚¨åˆ°ç¬¬ä¸‰æ–¹å­˜å‚¨ï¼ˆRedisã€æ•°æ®åº“ï¼‰

```
         â”Œâ†’ æœåŠ¡å™¨A â”€â”
ç”¨æˆ·è¯·æ±‚ â”œâ†’ æœåŠ¡å™¨B â”€â”¤
         â””â†’ æœåŠ¡å™¨C â”€â”˜
                     â†“
              ã€Redisé›†ç¾¤ã€‘
           (ç»Ÿä¸€çš„Sessionå­˜å‚¨)
```

**ğŸ’» Spring Session + Rediså®ç°**

**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.session</groupId>
    <artifactId>spring-session-data-redis</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®Redis**
```properties
# Redisé…ç½®
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=

# Sessionå­˜å‚¨æ–¹å¼
spring.session.store-type=redis

# Sessionè¶…æ—¶æ—¶é—´
server.servlet.session.timeout=30m
```

**æ­¥éª¤3ï¼šå¯ç”¨Spring Session**
```java
@Configuration
@EnableRedisHttpSession(maxInactiveIntervalInSeconds = 1800)
public class SessionConfig {
    // è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€é¢å¤–ä»£ç 
}
```

**æ­¥éª¤4ï¼šä½¿ç”¨æ–¹å¼å®Œå…¨ä¸å˜**
```java
@Controller
public class UserController {
    
    @PostMapping("/login")
    public String login(HttpSession session, String username) {
        // Sessionè‡ªåŠ¨å­˜å‚¨åˆ°Redisï¼Œä»£ç æ— éœ€æ”¹åŠ¨
        session.setAttribute("currentUser", username);
        return "success";
    }
    
    @GetMapping("/userInfo")
    public String userInfo(HttpSession session, Model model) {
        // è‡ªåŠ¨ä»Redisè¯»å–Session
        String username = (String) session.getAttribute("currentUser");
        model.addAttribute("username", username);
        return "userInfo";
    }
}
```

> âœ… **ä¼˜ç‚¹**ï¼š
> - é«˜å¯ç”¨ï¼ŒæœåŠ¡å™¨å®•æœºä¸å½±å“Session
> - è´Ÿè½½å‡è¡¡å‹å¥½
> - å¯æ‰©å±•ï¼Œæ”¯æŒå¤§é‡æœåŠ¡å™¨
> - Redisæ€§èƒ½é«˜ï¼Œæ”¯æŒæŒä¹…åŒ–

---

## 5. ğŸ”’ Sessionå®‰å…¨ä¸æœ€ä½³å®è·µ


### 5.1 Sessionå®‰å…¨é—®é¢˜


**ğŸš¨ å¸¸è§å®‰å…¨å¨èƒ**

**å¨èƒ1ï¼šSessionåŠ«æŒ**
```
æ”»å‡»åŸç†ï¼š
1. æ”»å‡»è€…è·å–ç”¨æˆ·çš„SessionIDï¼ˆé€šè¿‡XSSã€ç½‘ç»œå—…æ¢ç­‰ï¼‰
2. æ”»å‡»è€…ä½¿ç”¨è¯¥SessionIDå†’å……ç”¨æˆ·è®¿é—®

é˜²æŠ¤æªæ–½ï¼š
âœ… ä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“
âœ… è®¾ç½®Cookieä¸ºHttpOnly
âœ… å®šæœŸæ›´æ¢SessionID
```

**å¨èƒ2ï¼šSessionå›ºå®šæ”»å‡»**
```
æ”»å‡»æµç¨‹ï¼š
1. æ”»å‡»è€…è·å¾—ä¸€ä¸ªåˆæ³•çš„SessionID
2. è¯±å¯¼ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªSessionIDç™»å½•
3. ç”¨æˆ·ç™»å½•åï¼Œæ”»å‡»è€…ç”¨åŒä¸€SessionIDè®¿é—®

é˜²æŠ¤æªæ–½ï¼š
âœ… ç™»å½•æˆåŠŸåé‡æ–°ç”ŸæˆSessionID
```

**å¨èƒ3ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰**
```
é˜²æŠ¤ï¼šä½¿ç”¨CSRF Token
```

### 5.2 Sessionå®‰å…¨é…ç½®


**ğŸ” å®‰å…¨é…ç½®ç¤ºä¾‹**

```java
@Configuration
public class SecurityConfig {
    
    @Bean
    public CookieSerializer cookieSerializer() {
        DefaultCookieSerializer serializer = new DefaultCookieSerializer();
        
        // Cookieåç§°
        serializer.setCookieName("SESSIONID");
        
        // è®¾ç½®HttpOnlyï¼ˆé˜²æ­¢XSSæ”»å‡»ï¼‰
        serializer.setUseHttpOnlyCookie(true);
        
        // è®¾ç½®Secureï¼ˆä»…HTTPSä¼ è¾“ï¼‰
        serializer.setUseSecureCookie(true);
        
        // è®¾ç½®SameSiteï¼ˆé˜²CSRFï¼‰
        serializer.setSameSite("Lax");
        
        // Cookieè·¯å¾„
        serializer.setCookiePath("/");
        
        return serializer;
    }
}
```

**ç™»å½•åé‡æ–°ç”ŸæˆSessionID**
```java
@PostMapping("/login")
public String login(String username, String password, 
                   HttpServletRequest request) {
    
    if (validateUser(username, password)) {
        // è·å–æ—§Sessionæ•°æ®
        HttpSession oldSession = request.getSession(false);
        Map<String, Object> attributes = new HashMap<>();
        
        if (oldSession != null) {
            // ä¿å­˜éœ€è¦çš„æ•°æ®
            Enumeration<String> names = oldSession.getAttributeNames();
            while (names.hasMoreElements()) {
                String name = names.nextElement();
                attributes.put(name, oldSession.getAttribute(name));
            }
            // é”€æ¯æ—§Session
            oldSession.invalidate();
        }
        
        // åˆ›å»ºæ–°Sessionï¼ˆæ–°çš„SessionIDï¼‰
        HttpSession newSession = request.getSession(true);
        
        // æ¢å¤æ•°æ®
        attributes.forEach(newSession::setAttribute);
        
        // è®¾ç½®ç”¨æˆ·ç™»å½•ä¿¡æ¯
        newSession.setAttribute("currentUser", username);
        
        return "success";
    }
    
    return "login";
}
```

### 5.3 Sessionç›‘å¬å™¨


**ğŸ“¡ ç›‘å¬Sessionç”Ÿå‘½å‘¨æœŸ**

```java
@Component
public class SessionListener implements HttpSessionListener {
    
    private static final Logger log = LoggerFactory.getLogger(SessionListener.class);
    
    // Sessionåˆ›å»ºæ—¶
    @Override
    public void sessionCreated(HttpSessionEvent event) {
        HttpSession session = event.getSession();
        log.info("Sessionåˆ›å»º: {}", session.getId());
        
        // è®¾ç½®Sessionè¶…æ—¶æ—¶é—´
        session.setMaxInactiveInterval(1800);
        
        // å¯ä»¥åšä¸€äº›åˆå§‹åŒ–æ“ä½œ
        session.setAttribute("createTime", new Date());
    }
    
    // Sessioné”€æ¯æ—¶
    @Override
    public void sessionDestroyed(HttpSessionEvent event) {
        HttpSession session = event.getSession();
        log.info("Sessioné”€æ¯: {}", session.getId());
        
        // æ¸…ç†èµ„æº
        String username = (String) session.getAttribute("username");
        if (username != null) {
            log.info("ç”¨æˆ· {} çš„Sessionå·²é”€æ¯", username);
            // å¯ä»¥è®°å½•ç”¨æˆ·ç¦»çº¿æ—¥å¿—ç­‰
        }
    }
}
```

**ğŸ“Š ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°**

```java
@Component
public class OnlineUserListener implements HttpSessionListener {
    
    private static final AtomicInteger onlineCount = new AtomicInteger(0);
    
    @Override
    public void sessionCreated(HttpSessionEvent event) {
        int count = onlineCount.incrementAndGet();
        System.out.println("æ–°ç”¨æˆ·ä¸Šçº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + count);
    }
    
    @Override
    public void sessionDestroyed(HttpSessionEvent event) {
        int count = onlineCount.decrementAndGet();
        System.out.println("ç”¨æˆ·ä¸‹çº¿ï¼Œå½“å‰åœ¨çº¿äººæ•°ï¼š" + count);
    }
    
    public static int getOnlineCount() {
        return onlineCount.get();
    }
}
```

### 5.4 æœ€ä½³å®è·µæ€»ç»“


**âœ… DOï¼ˆåº”è¯¥åšçš„ï¼‰**

```
1. Sessionå®‰å…¨
   âœ“ ä½¿ç”¨HTTPSä¼ è¾“
   âœ“ è®¾ç½®HttpOnlyå’ŒSecure
   âœ“ ç™»å½•åé‡æ–°ç”ŸæˆSessionID
   âœ“ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

2. æ•°æ®å­˜å‚¨
   âœ“ åªå­˜å‚¨å¿…è¦çš„ä¿¡æ¯
   âœ“ æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
   âœ“ å®šæœŸæ¸…ç†è¿‡æœŸSession

3. åˆ†å¸ƒå¼ç¯å¢ƒ
   âœ“ ä½¿ç”¨Redisç­‰é›†ä¸­å­˜å‚¨
   âœ“ é…ç½®SessionæŒä¹…åŒ–
   âœ“ ç›‘æ§Sessionä½¿ç”¨æƒ…å†µ

4. æ€§èƒ½ä¼˜åŒ–
   âœ“ æ§åˆ¶Sessionå¤§å°
   âœ“ ä½¿ç”¨ç¼“å­˜å‡å°‘è®¿é—®
   âœ“ åŠæ—¶é”€æ¯æ— ç”¨Session
```

**âŒ DON'Tï¼ˆä¸åº”è¯¥åšçš„ï¼‰**

```
1. å®‰å…¨é—®é¢˜
   âœ— åœ¨URLä¸­æš´éœ²SessionID
   âœ— å­˜å‚¨æ˜æ–‡å¯†ç 
   âœ— æ°¸ä¹…Sessionï¼ˆmaxAge=-1ï¼‰
   âœ— ç¦ç”¨HttpOnly

2. æ€§èƒ½é—®é¢˜
   âœ— å­˜å‚¨å¤§å¯¹è±¡åˆ°Session
   âœ— è¿‡åº¦ä½¿ç”¨Session
   âœ— ä¸è®¾ç½®è¶…æ—¶æ—¶é—´

3. è®¾è®¡é—®é¢˜
   âœ— Sessionå­˜å‚¨ä¸šåŠ¡é€»è¾‘
   âœ— Sessionä½œä¸ºç¼“å­˜ä½¿ç”¨
   âœ— è·¨åŸŸå…±äº«SessionæœªåŠ å¯†
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 Sessionæ ¸å¿ƒçŸ¥è¯†


```
ğŸ”¸ Sessionæœ¬è´¨ï¼šæœåŠ¡å™¨ç«¯çš„ç”¨æˆ·çŠ¶æ€å­˜å‚¨
ğŸ”¸ è·å–æ–¹å¼ï¼šrequest.getSession() æˆ– æ–¹æ³•å‚æ•°æ³¨å…¥
ğŸ”¸ ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»º â†’ æ´»è·ƒ â†’ è¶…æ—¶/é”€æ¯
ğŸ”¸ å­˜å‚¨æ“ä½œï¼šsetAttributeã€getAttributeã€removeAttribute
ğŸ”¸ è¶…æ—¶é…ç½®ï¼šweb.xmlã€propertiesã€ä»£ç è®¾ç½®
```

### 6.2 Cookieæ ¸å¿ƒçŸ¥è¯†


```
ğŸ”¸ Cookieæœ¬è´¨ï¼šå®¢æˆ·ç«¯çš„å°å‹æ•°æ®å­˜å‚¨
ğŸ”¸ åˆ›å»ºæ–¹å¼ï¼šnew Cookie(name, value)
ğŸ”¸ å‘é€æ–¹å¼ï¼šresponse.addCookie(cookie)
ğŸ”¸ è¯»å–æ–¹å¼ï¼šrequest.getCookies() æˆ– @CookieValue
ğŸ”¸ å…³é”®å±æ€§ï¼šmaxAgeã€pathã€domainã€httpOnlyã€secure
```

### 6.3 Sessionä¸Cookieå…³ç³»


```
åä½œæœºåˆ¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cookie â”‚  å­˜å‚¨    â”‚ Session â”‚
â”‚(é’¥åŒ™ä¸²) â”‚ ------â†’ â”‚(ä¿é™©æŸœ)  â”‚
â”‚JSESSIONIDâ”‚         â”‚ç”¨æˆ·æ•°æ®  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   å®¢æˆ·ç«¯               æœåŠ¡å™¨ç«¯

æ ¸å¿ƒæµç¨‹ï¼š
1. æœåŠ¡å™¨åˆ›å»ºSessionï¼Œç”ŸæˆSessionID
2. SessionIDé€šè¿‡Cookieå‘é€åˆ°å®¢æˆ·ç«¯
3. å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚æºå¸¦Cookie
4. æœåŠ¡å™¨æ ¹æ®SessionIDæ‰¾åˆ°å¯¹åº”Session
```

### 6.4 åˆ†å¸ƒå¼Sessionæ–¹æ¡ˆ


```
æ–¹æ¡ˆå¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–¹æ¡ˆ   â”‚ å®ç° â”‚ å¯ç”¨ â”‚ æ¨èåº¦ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Sessionç²˜æ€§â”‚ ç®€å• â”‚  ä½  â”‚   â­   â”‚
â”‚Sessionå¤åˆ¶â”‚ ä¸­ç­‰ â”‚  é«˜  â”‚  â­â­  â”‚
â”‚é›†ä¸­å¼å­˜å‚¨ â”‚ ä¸­ç­‰ â”‚  é«˜  â”‚ â­â­â­ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¨èæ–¹æ¡ˆï¼šSpring Session + Redis
â€¢ é«˜å¯ç”¨ã€æ˜“æ‰©å±•
â€¢ æ€§èƒ½å¥½ã€æ”¯æŒæŒä¹…åŒ–
â€¢ ä»£ç æ— ä¾µå…¥
```

### 6.5 å®‰å…¨è¦ç‚¹


```
å¿…é¡»åšçš„å®‰å…¨æªæ–½ï¼š
âœ… HTTPSä¼ è¾“ï¼ˆé˜²çªƒå¬ï¼‰
âœ… HttpOnlyè®¾ç½®ï¼ˆé˜²XSSï¼‰
âœ… å®šæœŸæ›´æ¢SessionIDï¼ˆé˜²åŠ«æŒï¼‰
âœ… åˆç†è®¾ç½®è¶…æ—¶ï¼ˆé˜²æ»¥ç”¨ï¼‰
âœ… æ•æ„Ÿæ•°æ®åŠ å¯†ï¼ˆé˜²æ³„éœ²ï¼‰

å¸¸è§å®‰å…¨é—®é¢˜ï¼š
ğŸš¨ SessionåŠ«æŒ â†’ HTTPS + HttpOnly
ğŸš¨ Sessionå›ºå®š â†’ ç™»å½•åé‡æ–°ç”ŸæˆID
ğŸš¨ CSRFæ”»å‡» â†’ TokenéªŒè¯
ğŸš¨ XSSæ”»å‡» â†’ è¾“å…¥è¿‡æ»¤ + HttpOnly
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- SessionæœåŠ¡ç«¯å­˜ï¼ŒCookieå®¢æˆ·ç«¯ä¼ 
- SessionIDæ˜¯é’¥åŒ™ï¼ŒSessionæ˜¯ä¿é™©æŸœ
- åˆ†å¸ƒå¼ç”¨Redisï¼Œå®‰å…¨é HTTPS
- ç™»å½•é‡ç”Ÿæˆï¼Œè¶…æ—¶è¦è®¾ç½®