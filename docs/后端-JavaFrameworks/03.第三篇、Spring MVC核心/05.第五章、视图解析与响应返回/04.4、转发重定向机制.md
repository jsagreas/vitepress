---
title: 4ã€è½¬å‘é‡å®šå‘æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [è½¬å‘ä¸é‡å®šå‘åŸºç¡€æ¦‚å¿µ](#1-è½¬å‘ä¸é‡å®šå‘åŸºç¡€æ¦‚å¿µ)
2. [Forwardè½¬å‘æœºåˆ¶è¯¦è§£](#2-forwardè½¬å‘æœºåˆ¶è¯¦è§£)
3. [Redirecté‡å®šå‘æœºåˆ¶è¯¦è§£](#3-redirecté‡å®šå‘æœºåˆ¶è¯¦è§£)
4. [RedirectAttributesæ•°æ®ä¼ é€’](#4-redirectattributesæ•°æ®ä¼ é€’)
5. [Flashå±æ€§æœºåˆ¶](#5-flashå±æ€§æœºåˆ¶)
6. [URLé‡å†™ä¸å‚æ•°ä¼ é€’](#6-urlé‡å†™ä¸å‚æ•°ä¼ é€’)
7. [çŠ¶æ€ä¿æŒç­–ç•¥](#7-çŠ¶æ€ä¿æŒç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ è½¬å‘ä¸é‡å®šå‘åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è½¬å‘å’Œé‡å®šå‘


**ğŸ’¡ ç”Ÿæ´»ä¸­çš„ç±»æ¯”**ï¼š
```
è½¬å‘(Forward)åƒä»€ä¹ˆï¼Ÿ
â†’ å°±åƒä½ å»æ”¿åºœåŠäº‹å¤§å…ï¼Œå·¥ä½œäººå‘˜ç›´æ¥å¸¦ä½ å»å¦ä¸€ä¸ªçª—å£åŠç†
â†’ ä½ åªéœ€è¦æ¥ä¸€æ¬¡ï¼Œå†…éƒ¨è‡ªå·±å¸®ä½ åŠå¥½
â†’ åœ°å€æ è¿˜æ˜¯æ˜¾ç¤ºåŸæ¥çš„åœ°å€

é‡å®šå‘(Redirect)åƒä»€ä¹ˆï¼Ÿ
â†’ å°±åƒå·¥ä½œäººå‘˜å‘Šè¯‰ä½ ï¼š"è¿™ä¸ªä¸šåŠ¡è¦å»2å·æ¥¼åŠç†"
â†’ ä½ éœ€è¦è‡ªå·±å†èµ°ä¸€æ¬¡ï¼Œé‡æ–°å»2å·æ¥¼
â†’ åœ°å€æ ä¼šå˜æˆæ–°çš„åœ°å€
```

**ğŸ¯ æ ¸å¿ƒå®šä¹‰**ï¼š
- **è½¬å‘(Forward)**ï¼šæœåŠ¡å™¨å†…éƒ¨çš„è·³è½¬ï¼Œæµè§ˆå™¨åªå‘é€ä¸€æ¬¡è¯·æ±‚
- **é‡å®šå‘(Redirect)**ï¼šæœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨é‡æ–°å‘èµ·æ–°è¯·æ±‚

### 1.2 ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«


**ğŸ“Š å¯¹æ¯”ç†è§£**ï¼š

| ğŸ†š **å¯¹æ¯”ç»´åº¦** | **Forwardè½¬å‘** | **Redirecté‡å®šå‘** |
|----------------|-----------------|-------------------|
| ğŸŒ **è¯·æ±‚æ¬¡æ•°** | 1æ¬¡ï¼ˆå†…éƒ¨è·³è½¬ï¼‰ | 2æ¬¡ï¼ˆé‡æ–°è¯·æ±‚ï¼‰ |
| ğŸ“ **åœ°å€æ å˜åŒ–** | ä¸å˜ï¼ˆç”¨æˆ·çœ‹ä¸åˆ°ï¼‰ | æ”¹å˜ï¼ˆæ˜¾ç¤ºæ–°åœ°å€ï¼‰ |
| ğŸ“¦ **æ•°æ®å…±äº«** | å¯ä»¥å…±äº«requestæ•°æ® | ä¸èƒ½å…±äº«requestæ•°æ® |
| ğŸ”— **è·³è½¬èŒƒå›´** | åªèƒ½æœ¬åº”ç”¨å†…éƒ¨ | å¯ä»¥è·³è½¬åˆ°å¤–éƒ¨ç½‘ç«™ |
| ğŸƒ **æ‰§è¡Œé€Ÿåº¦** | å¿«ï¼ˆæœåŠ¡å™¨å†…éƒ¨ï¼‰ | æ…¢ï¼ˆéœ€è¦ç½‘ç»œå¾€è¿”ï¼‰ |

**ğŸ” è¯·æ±‚æµç¨‹å¯¹æ¯”**ï¼š
```
Forwardè½¬å‘æµç¨‹ï¼š
æµè§ˆå™¨ â†’ [è¯·æ±‚A] â†’ æœåŠ¡å™¨ â†’ å†…éƒ¨è½¬å‘åˆ°B â†’ å“åº” â†’ æµè§ˆå™¨
         åªæœ‰ä¸€æ¬¡è¯·æ±‚ï¼

Redirecté‡å®šå‘æµç¨‹ï¼š
æµè§ˆå™¨ â†’ [è¯·æ±‚A] â†’ æœåŠ¡å™¨ â†’ è¿”å›302+æ–°åœ°å€
         â†“
æµè§ˆå™¨ â†’ [è¯·æ±‚B] â†’ æœåŠ¡å™¨ â†’ å“åº” â†’ æµè§ˆå™¨
         ä¸¤æ¬¡ç‹¬ç«‹è¯·æ±‚ï¼
```

### 1.3 ä½¿ç”¨åœºæ™¯é€‰æ‹©


**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨è½¬å‘ï¼Ÿ**
```
âœ… éœ€è¦å…±äº«è¯·æ±‚æ•°æ®æ—¶
âœ… å†…éƒ¨é€»è¾‘å¤„ç†è·³è½¬
âœ… ä¸å¸Œæœ›ç”¨æˆ·çœ‹åˆ°å†…éƒ¨è·¯å¾„
âœ… æå‡æ€§èƒ½ï¼ˆå‡å°‘è¯·æ±‚ï¼‰

å®é™…åœºæ™¯ï¼š
- è¡¨å•æäº¤åå±•ç¤ºç»“æœé¡µé¢
- æƒé™éªŒè¯åè·³è½¬åˆ°ä¸šåŠ¡å¤„ç†
- MVCå†…éƒ¨è§†å›¾è·³è½¬
```

**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨é‡å®šå‘ï¼Ÿ**
```
âœ… é˜²æ­¢è¡¨å•é‡å¤æäº¤ï¼ˆé‡è¦ï¼ï¼‰
âœ… è·³è½¬åˆ°å¤–éƒ¨ç½‘ç«™
âœ… éœ€è¦åˆ·æ–°é¡µé¢æ•°æ®
âœ… å¸Œæœ›ç”¨æˆ·çœ‹åˆ°æ–°çš„URL

å®é™…åœºæ™¯ï¼š
- ç”¨æˆ·ç™»å½•æˆåŠŸåè·³è½¬é¦–é¡µ
- è®¢å•æäº¤æˆåŠŸåè·³è½¬è®¢å•åˆ—è¡¨
- æ”¯ä»˜å®Œæˆåè·³è½¬æ”¯ä»˜ç»“æœé¡µ
```

**ğŸ§  è®°å¿†å£è¯€**ï¼š
> "å†…éƒ¨å¤„ç†ç”¨è½¬å‘ï¼Œåˆ·æ–°æäº¤ç”¨é‡å®šå‘"

---

## 2. â¡ï¸ Forwardè½¬å‘æœºåˆ¶è¯¦è§£


### 2.1 è½¬å‘çš„åŸºæœ¬ä½¿ç”¨


**ğŸ“ è¯­æ³•æ ¼å¼**ï¼š
```java
// æ–¹å¼1ï¼šè¿”å›å­—ç¬¦ä¸²ï¼ŒåŠ forward:å‰ç¼€
@RequestMapping("/orderSubmit")
public String submitOrder() {
    // ä¸šåŠ¡å¤„ç†...
    return "forward:/orderSuccess";  // è½¬å‘åˆ°å¦ä¸€ä¸ªè¯·æ±‚
}

// æ–¹å¼2ï¼šè½¬å‘åˆ°è§†å›¾é¡µé¢ï¼ˆä¸åŠ å‰ç¼€ï¼‰
@RequestMapping("/orderSuccess") 
public String orderSuccess() {
    return "order/success";  // è½¬å‘åˆ°views/order/success.jsp
}
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
- `forward:`æ˜¯ä¸€ä¸ªç‰¹æ®Šæ ‡è®°ï¼Œå‘Šè¯‰Spring"è¿™æ˜¯è¦è½¬å‘çš„"
- å°±åƒä½ åœ¨å¯¼èˆªè½¯ä»¶é‡Œè®¾ç½®"é€”ç»ç‚¹"ï¼Œåˆ°äº†è¿™é‡Œå†å»ä¸‹ä¸€ä¸ªåœ°æ–¹
- æ•´ä¸ªè¿‡ç¨‹ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œåœ°å€æ ä¸å˜

### 2.2 è½¬å‘æ—¶çš„æ•°æ®ä¼ é€’


**ğŸ”¸ æ–¹å¼1ï¼šä½¿ç”¨Modelä¼ é€’æ•°æ®**
```java
@RequestMapping("/search")
public String search(String keyword, Model model) {
    // 1. å¤„ç†ä¸šåŠ¡é€»è¾‘
    List<Product> products = productService.search(keyword);
    
    // 2. æ•°æ®æ”¾å…¥Modelï¼ˆä¼šè‡ªåŠ¨æ”¾åˆ°requeståŸŸï¼‰
    model.addAttribute("products", products);
    model.addAttribute("keyword", keyword);
    
    // 3. è½¬å‘åˆ°ç»“æœé¡µé¢ï¼ˆæ•°æ®ä¼šä¸€èµ·å¸¦è¿‡å»ï¼‰
    return "forward:/searchResult";
}

@RequestMapping("/searchResult")
public String searchResult() {
    // è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸Šé¢ä¼ è¿‡æ¥çš„productså’Œkeyword
    // å®ƒä»¬è¿˜åœ¨requeståŸŸä¸­
    return "search/result";  // æ¸²æŸ“JSPæ—¶èƒ½å–åˆ°æ•°æ®
}
```

**ğŸ”¸ æ–¹å¼2ï¼šä½¿ç”¨HttpServletRequestä¼ é€’**
```java
@RequestMapping("/login")
public String login(String username, HttpServletRequest request) {
    User user = userService.login(username);
    
    // ç›´æ¥è®¾ç½®åˆ°requeståŸŸ
    request.setAttribute("user", user);
    request.setAttribute("loginTime", new Date());
    
    return "forward:/welcome";
}
```

**ğŸ¯ æ ¸å¿ƒç†è§£**ï¼š
```
è½¬å‘å°±åƒåœ¨åŒä¸€ä¸ªæˆ¿é—´é‡Œä¼ é€’ä¸œè¥¿ï¼š
- ä½ åœ¨Açª—å£æŠŠèµ„æ–™æ”¾åœ¨æ¡Œå­ä¸Š
- è½¬å‘åˆ°Bçª—å£æ—¶ï¼Œèµ„æ–™è¿˜åœ¨é‚£å¼ æ¡Œå­ä¸Š
- Bçª—å£å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨

è¿™ä¸ª"æ¡Œå­"å°±æ˜¯requestå¯¹è±¡ï¼
```

### 2.3 è½¬å‘çš„ç‰¹æ®Šåº”ç”¨åœºæ™¯


**ğŸ”¹ åœºæ™¯1ï¼šæƒé™éªŒè¯åè½¬å‘**
```java
@RequestMapping("/admin/dashboard")
public String adminDashboard(HttpSession session) {
    // æ£€æŸ¥æ˜¯å¦ç™»å½•
    User user = (User) session.getAttribute("user");
    
    if (user == null) {
        // æœªç™»å½•ï¼Œè½¬å‘åˆ°ç™»å½•é¡µ
        return "forward:/login";
    }
    
    if (!"ADMIN".equals(user.getRole())) {
        // ä¸æ˜¯ç®¡ç†å‘˜ï¼Œè½¬å‘åˆ°æ— æƒé™é¡µé¢
        return "forward:/forbidden";
    }
    
    // æœ‰æƒé™ï¼Œç»§ç»­å¤„ç†
    return "admin/dashboard";
}
```

**ğŸ”¹ åœºæ™¯2ï¼šè¡¨å•æ ¡éªŒå¤±è´¥è½¬å‘**
```java
@RequestMapping("/register")
public String register(User user, Model model) {
    // æ ¡éªŒç”¨æˆ·è¾“å…¥
    if (user.getUsername() == null || user.getUsername().isEmpty()) {
        model.addAttribute("error", "ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        return "forward:/registerPage";  // è½¬å‘å›æ³¨å†Œé¡µé¢
    }
    
    // æ ¡éªŒé€šè¿‡ï¼Œä¿å­˜ç”¨æˆ·
    userService.save(user);
    return "redirect:/login";  // æ³¨å†ŒæˆåŠŸï¼Œé‡å®šå‘åˆ°ç™»å½•
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
è½¬å‘çš„é™åˆ¶ï¼š
âŒ ä¸èƒ½è½¬å‘åˆ°å¤–éƒ¨URLï¼ˆå¦‚ï¼šforward:https://www.baidu.comï¼‰
âŒ æµè§ˆå™¨åˆ·æ–°ä¼šé‡å¤æ‰§è¡Œè½¬å‘å‰çš„è¯·æ±‚
âœ… åªèƒ½åœ¨åŒä¸€ä¸ªåº”ç”¨å†…éƒ¨è·³è½¬
âœ… é€‚åˆå†…éƒ¨é€»è¾‘å¤„ç†æµç¨‹
```

---

## 3. ğŸ”€ Redirecté‡å®šå‘æœºåˆ¶è¯¦è§£


### 3.1 é‡å®šå‘çš„åŸºæœ¬ä½¿ç”¨


**ğŸ“ è¯­æ³•æ ¼å¼**ï¼š
```java
// æ–¹å¼1ï¼šé‡å®šå‘åˆ°åŒåº”ç”¨çš„å…¶ä»–è¯·æ±‚
@RequestMapping("/orderPay")
public String payOrder(Long orderId) {
    // å¤„ç†æ”¯ä»˜é€»è¾‘
    payService.pay(orderId);
    
    // é‡å®šå‘åˆ°è®¢å•è¯¦æƒ…ï¼ˆé¿å…åˆ·æ–°é‡å¤æ”¯ä»˜ï¼‰
    return "redirect:/order/detail?id=" + orderId;
}

// æ–¹å¼2ï¼šé‡å®šå‘åˆ°å¤–éƒ¨URL
@RequestMapping("/toExternal")
public String toExternal() {
    return "redirect:https://www.example.com";
}

// æ–¹å¼3ï¼šé‡å®šå‘åˆ°åº”ç”¨æ ¹è·¯å¾„
@RequestMapping("/logout")
public String logout(HttpSession session) {
    session.invalidate();  // æ¸…é™¤session
    return "redirect:/";   // é‡å®šå‘åˆ°é¦–é¡µ
}
```

**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
```
é‡å®šå‘å°±åƒï¼š
- ä½ å»AæŸœå°åŠäº‹ï¼Œå·¥ä½œäººå‘˜è¯´"å»BæŸœå°åŠ"
- ä½ éœ€è¦è‡ªå·±èµ°åˆ°BæŸœå°ï¼Œé‡æ–°æ’é˜Ÿ
- BæŸœå°ä¸çŸ¥é“ä½ åœ¨AæŸœå°åšäº†ä»€ä¹ˆï¼ˆrequestæ•°æ®ä¸¢å¤±ï¼‰
- ä½†ä½ çš„ä¼šå‘˜å¡ï¼ˆsessionï¼‰è¿˜æ˜¯å¯ä»¥ç”¨çš„
```

### 3.2 é‡å®šå‘çš„HTTPåŸç†


**ğŸ” åº•å±‚æœºåˆ¶è§£æ**ï¼š
```
HTTPé‡å®šå‘è¿‡ç¨‹ï¼š

ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š
æµè§ˆå™¨ â†’ GET /orderPay â†’ æœåŠ¡å™¨

æœåŠ¡å™¨å“åº”ï¼š
HTTP/1.1 302 Found                    â† çŠ¶æ€ç 302è¡¨ç¤ºé‡å®šå‘
Location: /order/detail?id=123        â† å‘Šè¯‰æµè§ˆå™¨æ–°åœ°å€

ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆæµè§ˆå™¨è‡ªåŠ¨å‘èµ·ï¼‰ï¼š
æµè§ˆå™¨ â†’ GET /order/detail?id=123 â†’ æœåŠ¡å™¨
```

**ğŸ“Š HTTPçŠ¶æ€ç è¯´æ˜**ï¼š

| çŠ¶æ€ç  | å«ä¹‰ | Springé»˜è®¤ä½¿ç”¨ |
|--------|------|---------------|
| **302** | ä¸´æ—¶é‡å®šå‘ | âœ… æ˜¯ |
| **301** | æ°¸ä¹…é‡å®šå‘ | âŒ å¦ |
| **303** | See Other | âŒ å¦ |
| **307** | ä¸´æ—¶é‡å®šå‘ï¼ˆä¿æŒè¯·æ±‚æ–¹æ³•ï¼‰ | âŒ å¦ |

**ğŸ’¡ ä¸ºä»€ä¹ˆé»˜è®¤ç”¨302ï¼Ÿ**
```
302ä¸´æ—¶é‡å®šå‘çš„å¥½å¤„ï¼š
âœ… æµè§ˆå™¨ä¸ä¼šç¼“å­˜é‡å®šå‘è§„åˆ™
âœ… ä¸‹æ¬¡è®¿é—®è¿˜æ˜¯å…ˆåˆ°åŸåœ°å€
âœ… çµæ´»ï¼Œå¯ä»¥éšæ—¶æ”¹å˜é‡å®šå‘ç›®æ ‡

301æ°¸ä¹…é‡å®šå‘çš„é—®é¢˜ï¼š
âŒ æµè§ˆå™¨ä¼šç¼“å­˜ï¼Œç›´æ¥è®¿é—®æ–°åœ°å€
âŒ åŸåœ°å€è¢«"åºŸå¼ƒ"äº†
âŒ ä¸»è¦ç”¨äºç½‘ç«™è¿ç§»
```

### 3.3 é˜²æ­¢è¡¨å•é‡å¤æäº¤ï¼ˆé‡è¦åº”ç”¨ï¼‰


**ğŸ¯ ç»å…¸PRGæ¨¡å¼ï¼ˆPost-Redirect-Getï¼‰**

**âŒ ä¸ä½¿ç”¨é‡å®šå‘çš„é—®é¢˜**ï¼š
```java
// é”™è¯¯ç¤ºèŒƒï¼
@PostMapping("/createOrder")
public String createOrder(Order order, Model model) {
    orderService.save(order);  // ä¿å­˜è®¢å•
    model.addAttribute("order", order);
    return "order/success";    // ç›´æ¥è½¬å‘åˆ°æˆåŠŸé¡µé¢
}

é—®é¢˜ï¼š
1. ç”¨æˆ·åˆ·æ–°é¡µé¢ â†’ è¡¨å•é‡æ–°æäº¤ â†’ è®¢å•é‡å¤åˆ›å»ºï¼
2. æµè§ˆå™¨ä¼šæç¤º"ç¡®è®¤é‡æ–°æäº¤è¡¨å•"
3. åœ°å€æ è¿˜æ˜¯POSTè¯·æ±‚çš„åœ°å€
```

**âœ… æ­£ç¡®ä½¿ç”¨é‡å®šå‘**ï¼š
```java
@PostMapping("/createOrder")
public String createOrder(Order order, RedirectAttributes attr) {
    // 1. ä¿å­˜è®¢å•
    Order savedOrder = orderService.save(order);
    
    // 2. æ•°æ®ä¼ é€’ç»™é‡å®šå‘ç›®æ ‡ï¼ˆåé¢ä¼šè¯¦ç»†è®²ï¼‰
    attr.addFlashAttribute("message", "è®¢å•åˆ›å»ºæˆåŠŸ");
    attr.addAttribute("orderId", savedOrder.getId());
    
    // 3. é‡å®šå‘åˆ°è®¢å•è¯¦æƒ…ï¼ˆGETè¯·æ±‚ï¼‰
    return "redirect:/order/detail";
}

@GetMapping("/order/detail")
public String orderDetail(Long orderId, Model model) {
    Order order = orderService.findById(orderId);
    model.addAttribute("order", order);
    return "order/detail";  // æ¸²æŸ“è¯¦æƒ…é¡µé¢
}

å¥½å¤„ï¼š
âœ… åˆ·æ–°é¡µé¢åªæ˜¯é‡æ–°æŸ¥è¯¢è®¢å•ï¼Œä¸ä¼šé‡å¤åˆ›å»º
âœ… åœ°å€æ å˜æˆGETè¯·æ±‚ï¼Œç”¨æˆ·ä½“éªŒå¥½
âœ… é¿å…äº†é‡å¤æäº¤çš„é£é™©
```

**ğŸ§  PRGæ¨¡å¼æµç¨‹å›¾**ï¼š
```
ç”¨æˆ·æäº¤è¡¨å•
     â†“
POST /createOrderï¼ˆå¤„ç†è¡¨å•ï¼Œä¿å­˜æ•°æ®ï¼‰
     â†“
302é‡å®šå‘åˆ° /order/detail?orderId=123
     â†“
GET /order/detailï¼ˆæŸ¥è¯¢æ•°æ®å¹¶å±•ç¤ºï¼‰
     â†“
ç”¨æˆ·çœ‹åˆ°ç»“æœé¡µé¢ï¼ˆåˆ·æ–°é¡µé¢åªä¼šé‡æ–°æŸ¥è¯¢ï¼Œä¸ä¼šé‡å¤æäº¤ï¼‰
```

---

## 4. ğŸ“¦ RedirectAttributesæ•°æ®ä¼ é€’


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦RedirectAttributes


**ğŸ¤” é‡å®šå‘çš„æ•°æ®ä¼ é€’éš¾é¢˜**ï¼š
```java
// é—®é¢˜åœºæ™¯
@PostMapping("/login")
public String login(String username, String password, Model model) {
    if (!userService.validate(username, password)) {
        // æƒ³ä¼ é€’é”™è¯¯ä¿¡æ¯åˆ°ç™»å½•é¡µ
        model.addAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");  
        return "redirect:/loginPage";  // âŒ modelçš„æ•°æ®ä¼šä¸¢å¤±ï¼
    }
    return "redirect:/home";
}

ä¸ºä»€ä¹ˆä¸¢å¤±ï¼Ÿ
- é‡å®šå‘æ˜¯ä¸¤æ¬¡è¯·æ±‚
- Modelçš„æ•°æ®åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚çš„requestä¸­
- ç¬¬äºŒæ¬¡è¯·æ±‚æ˜¯å…¨æ–°çš„requestï¼Œæ‹¿ä¸åˆ°æ•°æ®
```

**ğŸ’¡ RedirectAttributesçš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
RedirectAttributeså°±åƒä¸€ä¸ª"ä¸­è½¬ç«™"ï¼š
- ç¬¬ä¸€æ¬¡è¯·æ±‚ç»“æŸæ—¶ï¼ŒæŠŠæ•°æ®å¯„å­˜åœ¨è¿™é‡Œ
- é‡å®šå‘å‘ç”Ÿæ—¶ï¼Œæ•°æ®ä¼šè¢«"è½¬ç§»"åˆ°æ–°è¯·æ±‚
- æ–°è¯·æ±‚èƒ½å¤Ÿå–åˆ°è¿™äº›æ•°æ®

ä¸¤ç§è½¬ç§»æ–¹å¼ï¼š
1. addFlashAttribute â†’ æ•°æ®æ”¾åœ¨sessionï¼Œç”¨å®Œå°±åˆ ï¼ˆFlashå±æ€§ï¼‰
2. addAttribute â†’ æ•°æ®æ‹¼æ¥åˆ°URLå‚æ•°
```

### 4.2 RedirectAttributesçš„ä¸¤ç§ç”¨æ³•


**ğŸ”¸ æ–¹å¼1ï¼šaddFlashAttributeï¼ˆæ¨èç”¨äºå¯¹è±¡æ•°æ®ï¼‰**

```java
@PostMapping("/submitForm")
public String submitForm(User user, RedirectAttributes redirectAttr) {
    // 1. ä¸šåŠ¡å¤„ç†
    if (user.getAge() < 18) {
        // 2. å¤æ‚å¯¹è±¡æ•°æ®ç”¨Flashå±æ€§ä¼ é€’
        redirectAttr.addFlashAttribute("error", "å¹´é¾„å¿…é¡»å¤§äº18å²");
        redirectAttr.addFlashAttribute("user", user);  // å¯ä»¥ä¼ å¯¹è±¡
        return "redirect:/formPage";
    }
    
    userService.save(user);
    redirectAttr.addFlashAttribute("message", "æ³¨å†ŒæˆåŠŸ");
    return "redirect:/success";
}

@GetMapping("/success")
public String success(Model model) {
    // 3. Flashå±æ€§ä¼šè‡ªåŠ¨æ”¾å…¥Model
    // JSPä¸­å¯ä»¥ç›´æ¥ç”¨ ${message}
    return "success";
}
```

**ç‰¹ç‚¹**ï¼š
```
âœ… å¯ä»¥ä¼ é€’ä»»æ„å¯¹è±¡ï¼ˆä¼šåºåˆ—åŒ–åˆ°sessionï¼‰
âœ… åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ˆå–å‡ºåè‡ªåŠ¨åˆ é™¤ï¼‰
âœ… ä¸ä¼šæš´éœ²åœ¨URLä¸­ï¼ˆå®‰å…¨ï¼‰
âœ… é€‚åˆä¼ é€’é”™è¯¯ä¿¡æ¯ã€æç¤ºæ¶ˆæ¯ã€å¤æ‚å¯¹è±¡
```

**ğŸ”¸ æ–¹å¼2ï¼šaddAttributeï¼ˆç”¨äºç®€å•å‚æ•°ï¼‰**

```java
@PostMapping("/search")
public String search(String keyword, RedirectAttributes redirectAttr) {
    // ç®€å•å‚æ•°ç”¨addAttributeï¼ˆä¼šæ‹¼æ¥åˆ°URLï¼‰
    redirectAttr.addAttribute("keyword", keyword);
    redirectAttr.addAttribute("page", 1);
    
    return "redirect:/searchResult";
    // å®é™…é‡å®šå‘åˆ°ï¼š/searchResult?keyword=xxx&page=1
}

@GetMapping("/searchResult")
public String searchResult(String keyword, int page, Model model) {
    // å‚æ•°ä»URLä¸­è·å–
    List<Product> products = productService.search(keyword, page);
    model.addAttribute("products", products);
    return "search/result";
}
```

**ç‰¹ç‚¹**ï¼š
```
âœ… æ•°æ®æ˜¾ç¤ºåœ¨URLä¸­ï¼ˆç”¨æˆ·å¯è§ï¼‰
âœ… å¯ä»¥è¢«æ”¶è—ã€åˆ†äº«é“¾æ¥
âœ… é€‚åˆåˆ†é¡µã€æœç´¢å…³é”®è¯ç­‰å‚æ•°
âŒ ä¸èƒ½ä¼ é€’å¤æ‚å¯¹è±¡ï¼ˆåªèƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼‰
âŒ æ•°æ®æš´éœ²åœ¨URLï¼ˆä¸é€‚åˆæ•æ„Ÿä¿¡æ¯ï¼‰
```

### 4.3 ç»¼åˆåº”ç”¨å®ä¾‹


**ğŸ¯ å®æˆ˜åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œæµç¨‹**

```java
@Controller
@RequestMapping("/user")
public class UserController {
    
    // æ˜¾ç¤ºæ³¨å†Œé¡µé¢
    @GetMapping("/register")
    public String registerPage() {
        return "user/register";
    }
    
    // å¤„ç†æ³¨å†Œæäº¤
    @PostMapping("/register")
    public String register(User user, RedirectAttributes redirectAttr) {
        
        // 1. æ ¡éªŒç”¨æˆ·åæ˜¯å¦å­˜åœ¨
        if (userService.exists(user.getUsername())) {
            // Flashå±æ€§ä¼ é€’é”™è¯¯ä¿¡æ¯å’Œç”¨æˆ·è¾“å…¥çš„æ•°æ®
            redirectAttr.addFlashAttribute("error", "ç”¨æˆ·åå·²å­˜åœ¨");
            redirectAttr.addFlashAttribute("user", user);  // å›æ˜¾è¡¨å•
            return "redirect:/user/register";  // é‡å®šå‘å›æ³¨å†Œé¡µ
        }
        
        // 2. ä¿å­˜ç”¨æˆ·
        userService.save(user);
        
        // 3. æˆåŠŸä¿¡æ¯ç”¨Flashå±æ€§
        redirectAttr.addFlashAttribute("message", "æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•");
        
        // 4. ç”¨æˆ·åç”¨URLå‚æ•°ï¼ˆå¯ä»¥é¢„å¡«åˆ°ç™»å½•æ¡†ï¼‰
        redirectAttr.addAttribute("username", user.getUsername());
        
        return "redirect:/user/login";
        // å®é™…ï¼š/user/login?username=xxx
    }
    
    // ç™»å½•é¡µé¢
    @GetMapping("/login")
    public String loginPage(@RequestParam(required = false) String username, 
                           Model model) {
        // usernameä»URLå‚æ•°è·å–
        model.addAttribute("username", username);
        // messageä»Flashå±æ€§è·å–ï¼ˆè‡ªåŠ¨æ”¾å…¥modelï¼‰
        return "user/login";
    }
}
```

**ğŸ“‹ æ•°æ®æµè½¬è¿‡ç¨‹**ï¼š
```
æ³¨å†Œå¤±è´¥åœºæ™¯ï¼š
POST /user/register â†’ æ ¡éªŒå¤±è´¥ 
  â†’ addFlashAttribute("error", "xxx")  // å­˜å…¥session
  â†’ addFlashAttribute("user", userObj)  // å­˜å…¥session
  â†’ redirect:/user/register
  â†’ GET /user/register
  â†’ errorå’Œuserä»sessionå–å‡ºæ”¾å…¥model  // è‡ªåŠ¨å®Œæˆ
  â†’ æ¸²æŸ“é¡µé¢å¯ä»¥ç”¨${error}å’Œ${user}
  â†’ sessionä¸­çš„æ•°æ®è¢«åˆ é™¤  // ç”¨å®Œå³åˆ 

æ³¨å†ŒæˆåŠŸåœºæ™¯ï¼š
POST /user/register â†’ ä¿å­˜æˆåŠŸ
  â†’ addFlashAttribute("message", "xxx")  // session
  â†’ addAttribute("username", "xxx")      // URLå‚æ•°
  â†’ redirect:/user/login?username=xxx
  â†’ GET /user/login?username=xxx
  â†’ messageä»sessionå–å‡ºï¼Œusernameä»URLå–å‡º
  â†’ æ¸²æŸ“ç™»å½•é¡µ
```

---

## 5. âš¡ Flashå±æ€§æœºåˆ¶


### 5.1 Flashå±æ€§çš„æœ¬è´¨


**ğŸ’¡ ä»€ä¹ˆæ˜¯Flashå±æ€§ï¼Ÿ**
```
Flashå±æ€§å°±åƒ"é—ªå…‰ç¯"ï¼š
- é—ªä¸€ä¸‹å°±æ²¡äº†ï¼Œåªç”¨ä¸€æ¬¡
- å­˜åœ¨sessionä¸­ï¼Œä½†æ¯”sessionçŸ­å‘½
- ä¸“é—¨ç”¨äºé‡å®šå‘æ—¶ä¼ é€’æ•°æ®

ç”Ÿå‘½å‘¨æœŸï¼š
1. é‡å®šå‘å‰ï¼šæ•°æ®å­˜å…¥sessionï¼ˆä¸´æ—¶ä¿å­˜ï¼‰
2. é‡å®šå‘åï¼šç¬¬ä¸€æ¬¡è®¿é—®æ—¶å–å‡ºæ•°æ®ï¼ˆæ”¾å…¥requestï¼‰
3. ä½¿ç”¨å®Œæ¯•ï¼šç«‹å³ä»sessionä¸­åˆ é™¤ï¼ˆé—ªç°åæ¶ˆå¤±ï¼‰
```

**ğŸ” Flashå±æ€§çš„å­˜å‚¨æœºåˆ¶**ï¼š
```
åº•å±‚å®ç°åŸç†ï¼š

é‡å®šå‘å‰ï¼š
FlashMap flashMap = new FlashMap();
flashMap.put("message", "æ“ä½œæˆåŠŸ");
session.setAttribute("flashMap", flashMap);  // ä¸´æ—¶å­˜session

é‡å®šå‘åï¼ˆç¬¬ä¸€æ¬¡è¯·æ±‚ï¼‰ï¼š
FlashMap flashMap = session.getAttribute("flashMap");
request.setAttribute("message", flashMap.get("message"));
session.removeAttribute("flashMap");  // ç«‹å³åˆ é™¤ï¼

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå«"Flash"ï¼ˆé—ªç°ï¼‰ï¼
```

### 5.2 Flashå±æ€§çš„åº”ç”¨åœºæ™¯


**ğŸ¯ åœºæ™¯1ï¼šæ“ä½œç»“æœæç¤º**
```java
@PostMapping("/product/delete")
public String deleteProduct(Long id, RedirectAttributes redirectAttr) {
    try {
        productService.delete(id);
        // æˆåŠŸæç¤º
        redirectAttr.addFlashAttribute("message", "åˆ é™¤æˆåŠŸ");
        redirectAttr.addFlashAttribute("type", "success");
    } catch (Exception e) {
        // å¤±è´¥æç¤º
        redirectAttr.addFlashAttribute("message", "åˆ é™¤å¤±è´¥ï¼š" + e.getMessage());
        redirectAttr.addFlashAttribute("type", "error");
    }
    return "redirect:/product/list";
}
```

**å¯¹åº”JSPé¡µé¢**ï¼š
```jsp
<!-- æç¤ºæ¶ˆæ¯ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œåˆ·æ–°åä¸å†æ˜¾ç¤º -->
<c:if test="${not empty message}">
    <div class="alert alert-${type}">
        ${message}
    </div>
</c:if>
```

**ğŸ¯ åœºæ™¯2ï¼šè¡¨å•éªŒè¯é”™è¯¯å›æ˜¾**
```java
@PostMapping("/article/publish")
public String publish(Article article, RedirectAttributes redirectAttr) {
    
    // éªŒè¯æ ‡é¢˜
    if (article.getTitle() == null || article.getTitle().isEmpty()) {
        redirectAttr.addFlashAttribute("error", "æ ‡é¢˜ä¸èƒ½ä¸ºç©º");
        redirectAttr.addFlashAttribute("article", article);  // å›æ˜¾ç”¨æˆ·è¾“å…¥
        return "redirect:/article/edit";
    }
    
    // éªŒè¯å†…å®¹é•¿åº¦
    if (article.getContent().length() < 10) {
        redirectAttr.addFlashAttribute("error", "å†…å®¹è‡³å°‘10ä¸ªå­—");
        redirectAttr.addFlashAttribute("article", article);
        return "redirect:/article/edit";
    }
    
    articleService.save(article);
    return "redirect:/article/list";
}
```

### 5.3 Flashå±æ€§çš„æ³¨æ„äº‹é¡¹


**âš ï¸ ä½¿ç”¨é™åˆ¶**ï¼š
```java
// âŒ é”™è¯¯ç”¨æ³•1ï¼šä¸åœ¨é‡å®šå‘æ—¶ä½¿ç”¨
@GetMapping("/test")
public String test(Model model) {
    model.addFlashAttribute("msg", "xxx");  // âŒ ä¸ä¼šç”Ÿæ•ˆï¼
    return "test";  // ä¸æ˜¯redirectï¼ŒFlashå±æ€§æ— æ•ˆ
}

// âŒ é”™è¯¯ç”¨æ³•2ï¼šæœŸæœ›æ•°æ®ä¿ç•™å¤šæ¬¡
@GetMapping("/page1")
public String page1(RedirectAttributes redirectAttr) {
    redirectAttr.addFlashAttribute("data", "xxx");
    return "redirect:/page2";
}

@GetMapping("/page2")
public String page2() {
    // ç¬¬ä¸€æ¬¡è®¿é—®ï¼šèƒ½æ‹¿åˆ°data
    return "redirect:/page3";
}

@GetMapping("/page3")
public String page3() {
    // ç¬¬äºŒæ¬¡é‡å®šå‘ï¼šdataå·²ç»è¢«åˆ é™¤äº†ï¼âŒ
    return "page3";
}

// âœ… æ­£ç¡®ç”¨æ³•ï¼šåªåœ¨ç´§æ¥ç€çš„ä¸€æ¬¡é‡å®šå‘ä¸­ä½¿ç”¨
@PostMapping("/submit")
public String submit(RedirectAttributes redirectAttr) {
    redirectAttr.addFlashAttribute("result", "æˆåŠŸ");
    return "redirect:/result";  // åªç”¨ä¸€æ¬¡
}
```

**ğŸ”‘ æ ¸å¿ƒè¦ç‚¹**ï¼š
```
Flashå±æ€§ä¸‰å¤§ç‰¹å¾ï¼š
1ï¸âƒ£ åªèƒ½é…åˆredirectä½¿ç”¨
2ï¸âƒ£ åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ˆé˜…åå³ç„šï¼‰
3ï¸âƒ£ æ•°æ®å­˜åœ¨sessionä½†ä¸æ˜¯sessionå±æ€§ï¼ˆä¸´æ—¶å€Ÿç”¨ï¼‰

é€‚åˆçš„æ•°æ®ç±»å‹ï¼š
âœ… æ“ä½œç»“æœæç¤ºä¿¡æ¯
âœ… è¡¨å•éªŒè¯é”™è¯¯ä¿¡æ¯  
âœ… éœ€è¦å›æ˜¾çš„è¡¨å•å¯¹è±¡
âœ… ä¸´æ—¶é€šçŸ¥æ¶ˆæ¯

ä¸é€‚åˆçš„æ•°æ®ï¼š
âŒ éœ€è¦å¤šæ¬¡ä½¿ç”¨çš„æ•°æ®ï¼ˆç”¨sessionï¼‰
âŒ éœ€è¦é•¿æœŸä¿å­˜çš„æ•°æ®ï¼ˆç”¨æ•°æ®åº“ï¼‰
âŒ å¤§é‡æ•°æ®ï¼ˆä¼šå ç”¨sessionç©ºé—´ï¼‰
```

---

## 6. ğŸ”— URLé‡å†™ä¸å‚æ•°ä¼ é€’


### 6.1 ä»€ä¹ˆæ˜¯URLé‡å†™


**ğŸ’¡ é€šä¿—ç†è§£**ï¼š
```
URLé‡å†™å°±æ˜¯"åŠ¨æ€æ‹¼æ¥URLå‚æ•°"ï¼š
- é‡å®šå‘æ—¶éœ€è¦æŠŠæ•°æ®å¸¦è¿‡å»
- æ•°æ®ä¼šå˜æˆURLçš„ä¸€éƒ¨åˆ†
- æµè§ˆå™¨åœ°å€æ èƒ½çœ‹åˆ°è¿™äº›å‚æ•°

ä¾‹å¦‚ï¼š
redirect:/search
  â†’ é‡å†™åå˜æˆ â†’  
/search?keyword=æ‰‹æœº&page=1&size=10
```

**ğŸ” URLé‡å†™çš„æ—¶æœº**ï¼š
```
ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘URLé‡å†™ï¼Ÿ

1. ä½¿ç”¨redirectAttributes.addAttribute()
2. ä½¿ç”¨@RequestParamå¹¶ä¸”redirectæ—¶
3. æ‰‹åŠ¨æ‹¼æ¥å‚æ•°åˆ°redirectè·¯å¾„

ç›®çš„ï¼š
è®©é‡å®šå‘çš„ç›®æ ‡æ–¹æ³•èƒ½å¤Ÿæ¥æ”¶å‚æ•°
```

### 6.2 å‚æ•°ä¼ é€’çš„å¤šç§æ–¹å¼


**ğŸ”¸ æ–¹å¼1ï¼šæ‰‹åŠ¨æ‹¼æ¥URLå‚æ•°**
```java
@GetMapping("/redirect1")
public String redirect1(String name, int age) {
    // æ‰‹åŠ¨æ‹¼æ¥å‚æ•°ï¼ˆä¸æ¨èï¼Œç¹çä¸”æ˜“é”™ï¼‰
    return "redirect:/target?name=" + name + "&age=" + age;
}
```

**ğŸ”¸ æ–¹å¼2ï¼šä½¿ç”¨RedirectAttributesï¼ˆæ¨èï¼‰**
```java
@GetMapping("/redirect2") 
public String redirect2(String name, int age, RedirectAttributes redirectAttr) {
    // è‡ªåŠ¨æ‹¼æ¥ï¼Œä¸ç”¨å…³å¿ƒURLç¼–ç é—®é¢˜
    redirectAttr.addAttribute("name", name);
    redirectAttr.addAttribute("age", age);
    return "redirect:/target";
    // è‡ªåŠ¨å˜æˆï¼š/target?name=xxx&age=xxx
}
```

**ğŸ”¸ æ–¹å¼3ï¼šè·¯å¾„å˜é‡æ–¹å¼**
```java
@GetMapping("/redirect3")
public String redirect3(Long userId, RedirectAttributes redirectAttr) {
    // å‚æ•°ä½œä¸ºè·¯å¾„ä¸€éƒ¨åˆ†ï¼ˆRESTfulé£æ ¼ï¼‰
    redirectAttr.addAttribute("userId", userId);
    return "redirect:/user/{userId}/profile";
    // è‡ªåŠ¨å˜æˆï¼š/user/123/profile
}

@GetMapping("/user/{userId}/profile")
public String profile(@PathVariable Long userId) {
    // ä»è·¯å¾„ä¸­è·å–å‚æ•°
    return "user/profile";
}
```

### 6.3 URLç¼–ç é—®é¢˜å¤„ç†


**ğŸ”§ ä¸­æ–‡å‚æ•°çš„ç¼–ç **ï¼š
```java
@GetMapping("/search")
public String search(String keyword, RedirectAttributes redirectAttr) {
    
    // âŒ æ‰‹åŠ¨æ‹¼æ¥ï¼šä¸­æ–‡ä¼šä¹±ç 
    // return "redirect:/result?keyword=" + keyword;
    
    // âœ… ç”¨RedirectAttributesï¼šè‡ªåŠ¨å¤„ç†ç¼–ç 
    redirectAttr.addAttribute("keyword", keyword);
    return "redirect:/result";
    // keyword=æ‰‹æœº â†’ è‡ªåŠ¨ç¼–ç ä¸º â†’ keyword=%E6%89%8B%E6%9C%BA
}

@GetMapping("/result")
public String result(@RequestParam String keyword) {
    // Springè‡ªåŠ¨è§£ç ï¼Œç›´æ¥å¾—åˆ°"æ‰‹æœº"
    System.out.println(keyword);  // è¾“å‡ºï¼šæ‰‹æœº
    return "search/result";
}
```

**ğŸ’¡ ç¼–ç åŸç†**ï¼š
```
URLç¼–ç è¿‡ç¨‹ï¼š
ç”¨æˆ·è¾“å…¥ï¼šæ‰‹æœº
  â†“
UTF-8ç¼–ç ï¼šE6 89 8B E6 9C BA
  â†“  
URLç¼–ç ï¼š%E6%89%8B%E6%9C%BA
  â†“
æ”¾å…¥URLï¼š/result?keyword=%E6%89%8B%E6%9C%BA
  â†“
æœåŠ¡å™¨è§£ç ï¼šæ‰‹æœº

RedirectAttributesè‡ªåŠ¨å®Œæˆç¼–ç /è§£ç ï¼
```

### 6.4 å‚æ•°ä¼ é€’çš„æœ€ä½³å®è·µ


**ğŸ¯ é€‰æ‹©åˆé€‚çš„ä¼ é€’æ–¹å¼**ï¼š

```java
@Controller
public class OrderController {
    
    // åœºæ™¯1ï¼šä¼ é€’IDç­‰ç®€å•å‚æ•° â†’ URLå‚æ•°
    @PostMapping("/order/create")
    public String create(Order order, RedirectAttributes redirectAttr) {
        Order saved = orderService.save(order);
        redirectAttr.addAttribute("orderId", saved.getId());  // ç®€å•å‚æ•°
        return "redirect:/order/detail";
    }
    
    // åœºæ™¯2ï¼šä¼ é€’æç¤ºæ¶ˆæ¯ â†’ Flashå±æ€§
    @PostMapping("/order/cancel")  
    public String cancel(Long orderId, RedirectAttributes redirectAttr) {
        orderService.cancel(orderId);
        redirectAttr.addFlashAttribute("message", "è®¢å•å·²å–æ¶ˆ");  // æç¤ºæ¶ˆæ¯
        redirectAttr.addAttribute("orderId", orderId);  // IDå‚æ•°
        return "redirect:/order/detail";
    }
    
    // åœºæ™¯3ï¼šä¼ é€’å¤æ‚å¯¹è±¡ â†’ Flashå±æ€§
    @PostMapping("/order/modify")
    public String modify(Order order, RedirectAttributes redirectAttr) {
        if (!orderService.validate(order)) {
            redirectAttr.addFlashAttribute("error", "è®¢å•ä¿¡æ¯æœ‰è¯¯");
            redirectAttr.addFlashAttribute("order", order);  // å¤æ‚å¯¹è±¡
            return "redirect:/order/edit";
        }
        orderService.update(order);
        return "redirect:/order/list";
    }
}
```

**ğŸ“Š å‚æ•°ä¼ é€’æ–¹å¼å¯¹æ¯”**ï¼š

| ä¼ é€’æ–¹å¼ | é€‚ç”¨åœºæ™¯ | æ•°æ®å¯è§æ€§ | æ•°æ®ç±»å‹ |
|---------|---------|-----------|---------|
| **URLå‚æ•°** | IDã€é¡µç ã€å…³é”®è¯ | å¯è§ï¼ˆå¯æ”¶è—ï¼‰ | åŸºæœ¬ç±»å‹ |
| **Flashå±æ€§** | æç¤ºæ¶ˆæ¯ã€å¤æ‚å¯¹è±¡ | ä¸å¯è§ï¼ˆå®‰å…¨ï¼‰ | ä»»æ„å¯¹è±¡ |
| **Session** | ç™»å½•ç”¨æˆ·ã€è´­ç‰©è½¦ | ä¸å¯è§ | ä»»æ„å¯¹è±¡ |

**ğŸ§  è®°å¿†æŠ€å·§**ï¼š
```
å‚æ•°é€‰æ‹©å£è¯€ï¼š
- ç®€å•å‚æ•°èµ°URLï¼Œç”¨æˆ·å¯è§æ–¹ä¾¿è—
- æç¤ºæ¶ˆæ¯ç”¨Flashï¼Œé˜…åå³ç„šä¸ç•™ç—•
- ç”¨æˆ·çŠ¶æ€å­˜Sessionï¼Œé•¿æœŸä¿æŒä¸ä¼šä¸¢
```

---

## 7. ğŸ” çŠ¶æ€ä¿æŒç­–ç•¥


### 7.1 ä»€ä¹ˆæ˜¯çŠ¶æ€ä¿æŒ


**ğŸ’¡ ç”Ÿæ´»ä¸­çš„ç±»æ¯”**ï¼š
```
çŠ¶æ€ä¿æŒå°±åƒ"ä¼šå‘˜å¡"ï¼š
- ä½ å»å•†åœºè´­ç‰©ï¼Œæ‹¿ç€ä¼šå‘˜å¡
- åœ¨AæŸœå°ä¹°ä¸œè¥¿ï¼Œè®°å½•åœ¨å¡ä¸Š
- å»BæŸœå°ï¼Œæ‰«å¡èƒ½çœ‹åˆ°ä½ çš„è´­ä¹°è®°å½•
- è¿™å°±æ˜¯"çŠ¶æ€ä¿æŒ"

åœ¨Webä¸­ï¼š
- HTTPæœ¬èº«æ˜¯"æ— çŠ¶æ€"çš„ï¼ˆæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼‰
- ä½†æˆ‘ä»¬éœ€è¦"è®°ä½ç”¨æˆ·"ï¼ˆç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ç­‰ï¼‰
- å°±éœ€è¦ç”¨æŠ€æœ¯æ‰‹æ®µ"ä¿æŒçŠ¶æ€"
```

**ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
HTTPæ— çŠ¶æ€çš„é—®é¢˜ï¼š
âŒ ç”¨æˆ·ç™»å½•åï¼Œä¸‹æ¬¡è¯·æ±‚ä¸çŸ¥é“æ˜¯è°
âŒ æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼Œåˆ·æ–°åå°±æ²¡äº†
âŒ å¡«å†™è¡¨å•åˆ°ä¸€åŠï¼Œé¡µé¢è·³è½¬å°±ä¸¢äº†

è§£å†³æ–¹æ¡ˆï¼š
âœ… Cookieï¼šæµè§ˆå™¨ç«¯ä¿å­˜
âœ… Sessionï¼šæœåŠ¡å™¨ç«¯ä¿å­˜
âœ… Tokenï¼šæ— çŠ¶æ€è®¤è¯
```

### 7.2 SessionçŠ¶æ€ä¿æŒï¼ˆæœ€å¸¸ç”¨ï¼‰


**ğŸ”¸ Sessionçš„å·¥ä½œåŸç†**ï¼š
```
Sessionå·¥ä½œæµç¨‹ï¼š

1. ç”¨æˆ·ç™»å½•æˆåŠŸ
   â†“
2. æœåŠ¡å™¨åˆ›å»ºsessionå¯¹è±¡ï¼ˆå­˜åœ¨æœåŠ¡å™¨å†…å­˜ï¼‰
   session.setAttribute("user", userObj)
   â†“
3. æœåŠ¡å™¨ç»™æµè§ˆå™¨å‘é€ä¸€ä¸ªcookieï¼ˆJSESSIONIDï¼‰
   Set-Cookie: JSESSIONID=ABC123
   â†“
4. æµè§ˆå™¨ä¿å­˜è¿™ä¸ªcookie
   â†“
5. ä»¥åæ¯æ¬¡è¯·æ±‚éƒ½å¸¦ä¸Šè¿™ä¸ªcookie
   Cookie: JSESSIONID=ABC123
   â†“
6. æœåŠ¡å™¨æ ¹æ®JSESSIONIDæ‰¾åˆ°å¯¹åº”çš„session
   User user = session.getAttribute("user")
```

**ğŸ“ Sessionä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Controller
public class LoginController {
    
    // ç™»å½•å¤„ç†
    @PostMapping("/login")
    public String login(String username, String password, 
                       HttpSession session, 
                       RedirectAttributes redirectAttr) {
        
        User user = userService.validate(username, password);
        
        if (user == null) {
            redirectAttr.addFlashAttribute("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
            return "redirect:/loginPage";
        }
        
        // ç™»å½•æˆåŠŸï¼Œä¿å­˜åˆ°sessionï¼ˆé•¿æœŸä¿æŒï¼‰
        session.setAttribute("user", user);
        session.setAttribute("loginTime", new Date());
        
        return "redirect:/home";
    }
    
    // é¦–é¡µï¼ˆéœ€è¦ç™»å½•ï¼‰
    @GetMapping("/home")
    public String home(HttpSession session, Model model) {
        User user = (User) session.getAttribute("user");
        
        if (user == null) {
            return "redirect:/loginPage";  // æœªç™»å½•ï¼Œå»ç™»å½•
        }
        
        model.addAttribute("user", user);
        return "home";
    }
    
    // é€€å‡ºç™»å½•
    @GetMapping("/logout")
    public String logout(HttpSession session) {
        session.invalidate();  // é”€æ¯session
        return "redirect:/loginPage";
    }
}
```

**âš™ï¸ Sessioné…ç½®**ï¼š
```java
// application.properties
server.servlet.session.timeout=30m  // sessionè¶…æ—¶æ—¶é—´30åˆ†é’Ÿ

// æˆ–application.yml
server:
  servlet:
    session:
      timeout: 30m
      cookie:
        name: JSESSIONID      # cookieåç§°
        http-only: true       # é˜²æ­¢JSè®¿é—®ï¼ˆå®‰å…¨ï¼‰
        secure: true          # ä»…HTTPSä¼ è¾“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```

### 7.3 CookieçŠ¶æ€ä¿æŒ


**ğŸ”¸ Cookieçš„åŸºæœ¬ä½¿ç”¨**ï¼š
```java
@Controller
public class CookieController {
    
    // è®¾ç½®Cookie
    @GetMapping("/setCookie")
    public String setCookie(HttpServletResponse response) {
        // åˆ›å»ºCookie
        Cookie cookie = new Cookie("username", "zhangsan");
        cookie.setMaxAge(7 * 24 * 60 * 60);  // 7å¤©æœ‰æ•ˆæœŸ
        cookie.setPath("/");  // æ•´ä¸ªåº”ç”¨éƒ½å¯è®¿é—®
        
        // æ·»åŠ åˆ°å“åº”
        response.addCookie(cookie);
        
        return "redirect:/home";
    }
    
    // è¯»å–Cookie
    @GetMapping("/getCookie")
    public String getCookie(@CookieValue(value = "username", required = false) 
                           String username, Model model) {
        
        if (username != null) {
            model.addAttribute("welcomeMsg", "æ¬¢è¿å›æ¥ï¼Œ" + username);
        }
        
        return "home";
    }
    
    // åˆ é™¤Cookie
    @GetMapping("/deleteCookie")
    public String deleteCookie(HttpServletResponse response) {
        Cookie cookie = new Cookie("username", null);
        cookie.setMaxAge(0);  // ç«‹å³è¿‡æœŸ
        cookie.setPath("/");
        response.addCookie(cookie);
        
        return "redirect:/home";
    }
}
```

**ğŸ“Š Cookie vs Sessionå¯¹æ¯”**ï¼š

| ç‰¹æ€§ | Cookie | Session |
|------|--------|---------|
| **å­˜å‚¨ä½ç½®** | æµè§ˆå™¨ç«¯ | æœåŠ¡å™¨ç«¯ |
| **å­˜å‚¨å®¹é‡** | 4KBå·¦å³ | æ— é™åˆ¶ï¼ˆå—æœåŠ¡å™¨å†…å­˜é™åˆ¶ï¼‰ |
| **å®‰å…¨æ€§** | ä½ï¼ˆå¯è¢«ç¯¡æ”¹ï¼‰ | é«˜ï¼ˆæœåŠ¡å™¨æ§åˆ¶ï¼‰ |
| **ç”Ÿå‘½å‘¨æœŸ** | å¯ä»¥æ°¸ä¹… | é»˜è®¤æµè§ˆå™¨å…³é—­é”€æ¯ |
| **é€‚ç”¨æ•°æ®** | ç”¨æˆ·åå¥½ã€ä¸´æ—¶æ ‡è¯† | ç™»å½•ä¿¡æ¯ã€è´­ç‰©è½¦ |

### 7.4 é‡å®šå‘æ—¶çš„çŠ¶æ€ä¿æŒç­–ç•¥


**ğŸ¯ åœºæ™¯åˆ†æ**ï¼š
```java
@Controller  
public class ShoppingController {
    
    // æ·»åŠ è´­ç‰©è½¦
    @PostMapping("/cart/add")
    public String addCart(Long productId, int quantity, 
                         HttpSession session,
                         RedirectAttributes redirectAttr) {
        
        // ä»sessionè·å–è´­ç‰©è½¦ï¼ˆçŠ¶æ€ä¿æŒï¼‰
        Cart cart = (Cart) session.getAttribute("cart");
        if (cart == null) {
            cart = new Cart();
            session.setAttribute("cart", cart);  // ç¬¬ä¸€æ¬¡åˆ›å»º
        }
        
        // æ·»åŠ å•†å“
        cart.addItem(productId, quantity);
        
        // æç¤ºæ¶ˆæ¯ï¼ˆFlashå±æ€§ï¼Œç”¨ä¸€æ¬¡ï¼‰
        redirectAttr.addFlashAttribute("message", "å·²æ·»åŠ åˆ°è´­ç‰©è½¦");
        
        // é‡å®šå‘åˆ°å•†å“è¯¦æƒ…ï¼ˆURLå‚æ•°ï¼Œå¯è§ï¼‰
        redirectAttr.addAttribute("productId", productId);
        
        return "redirect:/product/detail";
        // è´­ç‰©è½¦åœ¨sessionä¸­ï¼Œé‡å®šå‘åä¾ç„¶å­˜åœ¨ï¼
    }
    
    // æŸ¥çœ‹è´­ç‰©è½¦
    @GetMapping("/cart")
    public String viewCart(HttpSession session, Model model) {
        Cart cart = (Cart) session.getAttribute("cart");
        model.addAttribute("cart", cart);
        return "cart/list";
    }
}
```

**ğŸ”‘ çŠ¶æ€ä¿æŒçš„é€‰æ‹©åŸåˆ™**ï¼š

```
æ•°æ®åˆ†ç±»ä¸é€‰æ‹©ï¼š

1ï¸âƒ£ ä¸€æ¬¡æ€§æ•°æ®ï¼š
   - æ“ä½œæç¤ºã€é”™è¯¯ä¿¡æ¯
   - ç”¨Flashå±æ€§
   - ä¾‹ï¼šredirectAttr.addFlashAttribute("msg", "xxx")

2ï¸âƒ£ è¯·æ±‚çº§æ•°æ®ï¼š
   - æœç´¢å…³é”®è¯ã€é¡µç 
   - ç”¨URLå‚æ•°
   - ä¾‹ï¼šredirectAttr.addAttribute("page", 1)

3ï¸âƒ£ ä¼šè¯çº§æ•°æ®ï¼š
   - ç™»å½•ç”¨æˆ·ã€è´­ç‰©è½¦
   - ç”¨Session
   - ä¾‹ï¼šsession.setAttribute("user", user)

4ï¸âƒ£ è·¨ä¼šè¯æ•°æ®ï¼š
   - ç”¨æˆ·åå¥½ã€è®°ä½æˆ‘
   - ç”¨Cookieï¼ˆé•¿æœŸï¼‰
   - ä¾‹ï¼šcookie.setMaxAge(7 * 24 * 3600)
```

**ğŸ’¡ ç»¼åˆå®æˆ˜ç¤ºä¾‹**ï¼š
```java
@PostMapping("/checkout")
public String checkout(HttpSession session, 
                      HttpServletResponse response,
                      RedirectAttributes redirectAttr) {
    
    // 1. ä»sessionè·å–ç”¨æˆ·å’Œè´­ç‰©è½¦ï¼ˆä¼šè¯æ•°æ®ï¼‰
    User user = (User) session.getAttribute("user");
    Cart cart = (Cart) session.getAttribute("cart");
    
    if (user == null) {
        redirectAttr.addFlashAttribute("error", "è¯·å…ˆç™»å½•");  // ä¸€æ¬¡æ€§æç¤º
        return "redirect:/login";
    }
    
    if (cart == null || cart.isEmpty()) {
        redirectAttr.addFlashAttribute("error", "è´­ç‰©è½¦ä¸ºç©º");
        return "redirect:/cart";
    }
    
    // 2. åˆ›å»ºè®¢å•
    Order order = orderService.create(user, cart);
    
    // 3. æ¸…ç©ºè´­ç‰©è½¦ï¼ˆä¼šè¯æ•°æ®æ›´æ–°ï¼‰
    session.removeAttribute("cart");
    
    // 4. ä¿å­˜æœ€è¿‘è®¢å•IDåˆ°Cookieï¼ˆè·¨ä¼šè¯ï¼‰
    Cookie lastOrder = new Cookie("lastOrderId", order.getId().toString());
    lastOrder.setMaxAge(24 * 60 * 60);  // 1å¤©
    response.addCookie(lastOrder);
    
    // 5. æˆåŠŸæ¶ˆæ¯ï¼ˆFlashå±æ€§ï¼‰
    redirectAttr.addFlashAttribute("message", "è®¢å•æäº¤æˆåŠŸ");
    
    // 6. è®¢å•IDï¼ˆURLå‚æ•°ï¼‰
    redirectAttr.addAttribute("orderId", order.getId());
    
    return "redirect:/order/detail";
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 è½¬å‘ä¸é‡å®šå‘çš„æ ¸å¿ƒåŒºåˆ«


```
ğŸ”¸ è¯·æ±‚æ¬¡æ•°ï¼š
   Forwardï¼š1æ¬¡ï¼ˆæœåŠ¡å™¨å†…éƒ¨è·³è½¬ï¼‰
   Redirectï¼š2æ¬¡ï¼ˆæµè§ˆå™¨é‡æ–°è¯·æ±‚ï¼‰

ğŸ”¸ åœ°å€æ å˜åŒ–ï¼š
   Forwardï¼šä¸å˜ï¼ˆç”¨æˆ·çœ‹ä¸åˆ°ï¼‰
   Redirectï¼šæ”¹å˜ï¼ˆæ˜¾ç¤ºæ–°åœ°å€ï¼‰

ğŸ”¸ æ•°æ®å…±äº«ï¼š
   Forwardï¼šrequestæ•°æ®å¯å…±äº«
   Redirectï¼šrequestæ•°æ®ä¸¢å¤±

ğŸ”¸ è·³è½¬èŒƒå›´ï¼š
   Forwardï¼šåº”ç”¨å†…éƒ¨
   Redirectï¼šå¯è·³å¤–éƒ¨

ğŸ”¸ æ€§èƒ½ï¼š
   Forwardï¼šå¿«ï¼ˆæ— ç½‘ç»œå¼€é”€ï¼‰
   Redirectï¼šæ…¢ï¼ˆå¤šä¸€æ¬¡å¾€è¿”ï¼‰
```

### 8.2 ä½¿ç”¨åœºæ™¯è®°å¿†å£è¯€


```
ğŸ§  è½¬å‘é‡å®šå‘é€‰æ‹©å£è¯€ï¼š

"å†…éƒ¨å¤„ç†ç”¨è½¬å‘ï¼Œè¡¨å•æäº¤é˜²é‡æ”¾"
â†’ å†…éƒ¨é€»è¾‘è·³è½¬ç”¨forward
â†’ è¡¨å•æäº¤åç”¨redirecté˜²æ­¢é‡å¤æäº¤

"æ•°æ®å…±äº«æ‰¾è½¬å‘ï¼Œåœ°å€æ”¹å˜é é‡å®šå‘"  
â†’ éœ€è¦å…±äº«requestæ•°æ®ç”¨forward
â†’ éœ€è¦æ”¹å˜æµè§ˆå™¨åœ°å€ç”¨redirect

"ä¸€æ¬¡å®Œæˆç”¨è½¬å‘ï¼Œä¸¤æ­¥æµç¨‹ç”¨é‡å®šå‘"
â†’ ä¸€ä¸ªæµç¨‹å†…çš„è·³è½¬ç”¨forward
â†’ PRGæ¨¡å¼ï¼ˆPost-Redirect-Getï¼‰ç”¨redirect
```

### 8.3 æ•°æ®ä¼ é€’æ–¹å¼æ€»ç»“


**ğŸ“Š å››ç§æ•°æ®ä¼ é€’å¯¹æ¯”**ï¼š

| ä¼ é€’æ–¹å¼ | è¯­æ³• | ç”Ÿå‘½å‘¨æœŸ | å¯è§æ€§ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|--------|---------|
| **Flashå±æ€§** | `addFlashAttribute()` | ä¸€æ¬¡é‡å®šå‘ | ä¸å¯è§ | æç¤ºæ¶ˆæ¯ã€è¡¨å•å›æ˜¾ |
| **URLå‚æ•°** | `addAttribute()` | ä¸€æ¬¡è¯·æ±‚ | å¯è§ | åˆ†é¡µã€æœç´¢ã€ID |
| **Session** | `session.setAttribute()` | æ•´ä¸ªä¼šè¯ | ä¸å¯è§ | ç™»å½•ç”¨æˆ·ã€è´­ç‰©è½¦ |
| **Cookie** | `response.addCookie()` | å¯è·¨ä¼šè¯ | å¯è§ | è®°ä½æˆ‘ã€åå¥½è®¾ç½® |

### 8.4 å®é™…å¼€å‘æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
```java
// 1. è¡¨å•æäº¤ä½¿ç”¨PRGæ¨¡å¼
@PostMapping("/submit")
public String submit(Form form, RedirectAttributes attr) {
    service.save(form);
    attr.addFlashAttribute("message", "æäº¤æˆåŠŸ");  // æç¤º
    attr.addAttribute("id", form.getId());  // IDå‚æ•°
    return "redirect:/result";  // é‡å®šå‘
}

// 2. é”™è¯¯å¤„ç†è¿”å›åŸé¡µé¢
@PostMapping("/update")
public String update(Data data, RedirectAttributes attr) {
    if (!validate(data)) {
        attr.addFlashAttribute("error", "æ•°æ®æœ‰è¯¯");  // é”™è¯¯ä¿¡æ¯
        attr.addFlashAttribute("data", data);  // å›æ˜¾æ•°æ®
        return "redirect:/editPage";  // é‡å®šå‘å›ç¼–è¾‘é¡µ
    }
    service.update(data);
    return "redirect:/list";
}

// 3. ç™»å½•çŠ¶æ€ç”¨Session
@PostMapping("/login")
public String login(String username, String password, HttpSession session) {
    User user = userService.login(username, password);
    session.setAttribute("user", user);  // é•¿æœŸä¿æŒ
    return "redirect:/home";
}
```

**âŒ é¿å…çš„é”™è¯¯**ï¼š
```java
// é”™è¯¯1ï¼šé‡å®šå‘æ—¶ç”¨Modelä¼ æ•°æ®
@PostMapping("/error1")
public String error1(Model model) {
    model.addAttribute("data", "xxx");  // âŒ æ•°æ®ä¼šä¸¢å¤±
    return "redirect:/target";
}

// é”™è¯¯2ï¼šç›´æ¥è½¬å‘è¡¨å•æäº¤ç»“æœ
@PostMapping("/error2")
public String error2(Form form, Model model) {
    service.save(form);
    model.addAttribute("result", "æˆåŠŸ");
    return "result";  // âŒ åˆ·æ–°ä¼šé‡å¤æäº¤
}

// é”™è¯¯3ï¼šFlashå±æ€§ç”¨äºé•¿æœŸæ•°æ®
@GetMapping("/error3")
public String error3(RedirectAttributes attr) {
    attr.addFlashAttribute("user", userObj);  // âŒ åªèƒ½ç”¨ä¸€æ¬¡
    return "redirect:/page1";
}
```

### 8.5 è°ƒè¯•æŠ€å·§


**ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š
```
é—®é¢˜1ï¼šé‡å®šå‘åæ•°æ®ä¸¢å¤±
â†’ æ£€æŸ¥ï¼šæ˜¯å¦ç”¨äº†Modelè€Œä¸æ˜¯RedirectAttributes
â†’ è§£å†³ï¼šæ”¹ç”¨redirectAttributes.addFlashAttribute()

é—®é¢˜2ï¼šFlashå±æ€§å–ä¸åˆ°
â†’ æ£€æŸ¥ï¼šæ˜¯å¦æ˜¯é‡å®šå‘ï¼ˆå¿…é¡»æ˜¯redirect:ï¼‰
â†’ æ£€æŸ¥ï¼šæ˜¯å¦è®¿é—®äº†å¤šæ¬¡ï¼ˆFlashå±æ€§åªèƒ½ç”¨ä¸€æ¬¡ï¼‰

é—®é¢˜3ï¼šSessionæ•°æ®ä¸¢å¤±
â†’ æ£€æŸ¥ï¼šsession.invalidate()æ˜¯å¦è¢«è°ƒç”¨
â†’ æ£€æŸ¥ï¼šsessionè¶…æ—¶æ—¶é—´é…ç½®
â†’ æ£€æŸ¥ï¼šæ˜¯å¦è·¨åŸŸï¼ˆcookieä¼ ä¸è¿‡å»ï¼‰

é—®é¢˜4ï¼šURLå‚æ•°ä¹±ç 
â†’ ä½¿ç”¨RedirectAttributesè‡ªåŠ¨ç¼–ç 
â†’ æ£€æŸ¥Tomcatçš„URIEncodingé…ç½®
```

**ğŸ¯ å­¦ä¹ æ£€æŸ¥æ¸…å•**ï¼š
```
âœ… èƒ½è¯´å‡ºè½¬å‘å’Œé‡å®šå‘çš„5ä¸ªæ ¸å¿ƒåŒºåˆ«
âœ… èƒ½è§£é‡Šä¸ºä»€ä¹ˆè¡¨å•æäº¤è¦ç”¨é‡å®šå‘
âœ… èƒ½æ­£ç¡®ä½¿ç”¨RedirectAttributesçš„ä¸¤ä¸ªæ–¹æ³•
âœ… èƒ½è¯´å‡ºFlashå±æ€§çš„å·¥ä½œåŸç†å’Œç”Ÿå‘½å‘¨æœŸ
âœ… èƒ½åœ¨å®é™…é¡¹ç›®ä¸­é€‰æ‹©åˆé€‚çš„æ•°æ®ä¼ é€’æ–¹å¼
âœ… èƒ½ç†è§£Sessionåœ¨é‡å®šå‘ä¸­çš„ä½œç”¨
âœ… èƒ½é¿å…å¸¸è§çš„è½¬å‘é‡å®šå‘é”™è¯¯
```

**ğŸ”‘ æ ¸å¿ƒè®°å¿†å¡ç‰‡**ï¼š
```
è½¬å‘(Forward)ï¼š
- å…³é”®å­—ï¼šforward:
- ç‰¹ç‚¹ï¼šä¸€æ¬¡è¯·æ±‚ï¼Œå†…éƒ¨è·³è½¬ï¼Œæ•°æ®å…±äº«
- åœºæ™¯ï¼šå†…éƒ¨é€»è¾‘å¤„ç†

é‡å®šå‘(Redirect)ï¼š
- å…³é”®å­—ï¼šredirect:
- ç‰¹ç‚¹ï¼šä¸¤æ¬¡è¯·æ±‚ï¼Œåœ°å€æ”¹å˜ï¼Œé˜²é‡å¤æäº¤
- åœºæ™¯ï¼šè¡¨å•æäº¤åã€ç™»å½•åè·³è½¬

RedirectAttributesï¼š
- addFlashAttributeï¼šå¤æ‚å¯¹è±¡ã€æç¤ºæ¶ˆæ¯ï¼ˆsessionä¸´æ—¶å­˜å‚¨ï¼‰
- addAttributeï¼šç®€å•å‚æ•°ã€URLå¯è§ï¼ˆæ‹¼æ¥åˆ°URLï¼‰

çŠ¶æ€ä¿æŒï¼š
- Flashï¼šä¸€æ¬¡æ€§æ•°æ®
- URLï¼šå¯è§å‚æ•°
- Sessionï¼šä¼šè¯æ•°æ®
- Cookieï¼šé•¿æœŸæ•°æ®
```