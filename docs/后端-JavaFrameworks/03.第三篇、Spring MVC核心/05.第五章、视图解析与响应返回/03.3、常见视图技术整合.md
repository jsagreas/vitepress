---
title: 3ã€å¸¸è§è§†å›¾æŠ€æœ¯æ•´åˆ
---
## ğŸ“š ç›®å½•


1. [è§†å›¾æŠ€æœ¯æ¦‚è¿°](#1-è§†å›¾æŠ€æœ¯æ¦‚è¿°)
2. [JSPé›†æˆ](#2-JSPé›†æˆ)
3. [Thymeleafé›†æˆ](#3-Thymeleafé›†æˆ)
4. [FreeMarkeré›†æˆ](#4-FreeMarkeré›†æˆ)
5. [Velocityæ”¯æŒ](#5-Velocityæ”¯æŒ)
6. [é™æ€èµ„æºå¤„ç†](#6-é™æ€èµ„æºå¤„ç†)
7. [è§†å›¾ç¼“å­˜ç­–ç•¥](#7-è§†å›¾ç¼“å­˜ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¨ è§†å›¾æŠ€æœ¯æ¦‚è¿°



### 1.1 ä»€ä¹ˆæ˜¯è§†å›¾æŠ€æœ¯



**é€šä¿—ç†è§£**ï¼šè§†å›¾æŠ€æœ¯å°±åƒç½‘é¡µçš„"æ¨¡æ¿å·¥å‚"

æƒ³è±¡ä½ å¼€äº†ä¸€å®¶å®šåˆ¶è´ºå¡åº—ï¼Œå®¢æˆ·æä¾›ä¿¡æ¯ï¼ˆæ•°æ®ï¼‰ï¼Œä½ ç”¨æ¨¡æ¿ï¼ˆè§†å›¾ï¼‰åˆ¶ä½œå‡ºç²¾ç¾è´ºå¡ï¼ˆç½‘é¡µï¼‰ã€‚ä¸åŒçš„æ¨¡æ¿å·¥å…·å°±æ˜¯ä¸åŒçš„è§†å›¾æŠ€æœ¯ã€‚

```
æ•°æ®æµè½¬è¿‡ç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ Controllerå¤„ç† â†’ å‡†å¤‡æ•°æ® â†’ é€‰æ‹©æ¨¡æ¿ â†’ æ¸²æŸ“é¡µé¢ â†’ è¿”å›ç»™ç”¨æˆ·

ä¸¾ä¸ªä¾‹å­ï¼š
ç”¨æˆ·è®¿é—®å•†å“è¯¦æƒ…é¡µ
  â†“
ControlleræŸ¥è¯¢å•†å“ä¿¡æ¯ï¼ˆåç§°ã€ä»·æ ¼ã€å›¾ç‰‡ç­‰ï¼‰
  â†“
é€‰æ‹©å•†å“è¯¦æƒ…æ¨¡æ¿
  â†“
æŠŠæ•°æ®å¡«å……åˆ°æ¨¡æ¿ä¸­
  â†“
ç”Ÿæˆå®Œæ•´çš„HTMLé¡µé¢è¿”å›
```

### 1.2 å¸¸è§è§†å›¾æŠ€æœ¯å¯¹æ¯”



**ğŸ” ä¸»æµè§†å›¾æŠ€æœ¯ç‰¹ç‚¹**ï¼š

| æŠ€æœ¯ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ éš¾åº¦** | **ç°çŠ¶** |
|------|---------|------------|------------|---------|
| **JSP** | `Javaå†…åµŒHTML` | `ä¼ ç»Ÿé¡¹ç›®ã€è€ç³»ç»Ÿç»´æŠ¤` | `â­â­â˜†â˜†â˜†` | `é€æ¸æ·˜æ±°` |
| **Thymeleaf** | `è‡ªç„¶æ¨¡æ¿ã€Springå®˜æ–¹æ¨è` | `ç°ä»£Webé¡¹ç›®ã€å‰åç«¯ä¸åˆ†ç¦»` | `â­â­â­â˜†â˜†` | `ä¸»æµæ¨è` |
| **FreeMarker** | `çº¯æ¨¡æ¿ã€åŠŸèƒ½å¼ºå¤§` | `é‚®ä»¶æ¨¡æ¿ã€æ–‡æ¡£ç”Ÿæˆ` | `â­â­â­â˜†â˜†` | `ç¨³å®šä½¿ç”¨` |
| **Velocity** | `ç®€å•è½»é‡` | `è€é¡¹ç›®ç»´æŠ¤` | `â­â­â˜†â˜†â˜†` | `åŸºæœ¬æ·˜æ±°` |

**ğŸ’¡ é€‰æ‹©å»ºè®®**ï¼š

```
æ–°é¡¹ç›®å¼€å‘ï¼š
âœ… é¦–é€‰ Thymeleafï¼ˆSpringå®˜æ–¹æ¨èï¼Œç”Ÿæ€å®Œå–„ï¼‰
âœ… å¤‡é€‰ FreeMarkerï¼ˆçº¯æ¨¡æ¿éœ€æ±‚ï¼Œå¦‚é‚®ä»¶ï¼‰

è€é¡¹ç›®ç»´æŠ¤ï¼š
ğŸ”§ JSPï¼šåªç»´æŠ¤ä¸æ–°å¢
ğŸ”§ Velocityï¼šè€ƒè™‘è¿ç§»åˆ°å…¶ä»–æŠ€æœ¯

å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼š
âŒ ä¸éœ€è¦æœåŠ¡ç«¯æ¨¡æ¿å¼•æ“
âœ… åç«¯åªè¿”å›JSONï¼Œå‰ç«¯ç”¨Vue/Reactæ¸²æŸ“
```

---

## 2. ğŸ“„ JSPé›†æˆ



### 2.1 JSPåŸºæœ¬æ¦‚å¿µ



**JSPæ˜¯ä»€ä¹ˆï¼Ÿ**
JSPï¼ˆJavaServer Pagesï¼‰å°±åƒåœ¨HTMLé‡Œå†™Javaä»£ç ï¼ŒæœåŠ¡å™¨æŠŠå®ƒè½¬æˆæ™®é€šç½‘é¡µã€‚

æƒ³è±¡ä¸€ä¸‹ï¼šä½ å†™ä¿¡æ—¶ï¼Œåœ¨å›ºå®šæ ¼å¼çš„ä¿¡çº¸ä¸Šå¡«å†™ä¸åŒçš„å†…å®¹ã€‚JSPå°±æ˜¯è¿™ä¸ª"å¯ä»¥å†™ä»£ç çš„ä¿¡çº¸"ã€‚

**ğŸ¯ JSPçš„å·¥ä½œåŸç†**ï¼š
```
JSPæ‰§è¡Œæµç¨‹ï¼š
1. é¦–æ¬¡è®¿é—®JSPæ–‡ä»¶
   â†“
2. æœåŠ¡å™¨æŠŠJSPè½¬æˆJava Servletç±»
   â†“
3. ç¼–è¯‘æˆå­—èŠ‚ç 
   â†“
4. æ‰§è¡Œå¹¶ç”ŸæˆHTML
   â†“
5. è¿”å›ç»™æµè§ˆå™¨

å†æ¬¡è®¿é—®ï¼š
ç›´æ¥ç”¨å·²ç¼–è¯‘çš„å­—èŠ‚ç ï¼Œé€Ÿåº¦æ›´å¿«ï¼
```

### 2.2 Spring MVCä¸­é…ç½®JSP



**ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**

Mavené…ç½®æ–‡ä»¶pom.xmlä¸­æ·»åŠ ï¼š

```xml
<!-- JSPå’ŒJSTLæ”¯æŒ -->
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>4.0.1</version>
    <scope>provided</scope>
</dependency>

<dependency>
    <groupId>javax.servlet.jsp</groupId>
    <artifactId>javax.servlet.jsp-api</artifactId>
    <version>2.3.3</version>
    <scope>provided</scope>
</dependency>

<!-- JSTLæ ‡ç­¾åº“ï¼ˆç®€åŒ–JSPå¼€å‘ï¼‰ -->
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>jstl</artifactId>
    <version>1.2</version>
</dependency>
```

**ç¬¬äºŒæ­¥ï¼šé…ç½®è§†å›¾è§£æå™¨**

å‘Šè¯‰Springå»å“ªæ‰¾JSPæ–‡ä»¶ï¼š

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    
    // é…ç½®JSPè§†å›¾è§£æå™¨
    @Bean
    public ViewResolver viewResolver() {
        InternalResourceViewResolver resolver = new InternalResourceViewResolver();
        
        // è®¾ç½®å‰ç¼€ï¼šJSPæ–‡ä»¶æ‰€åœ¨ç›®å½•
        resolver.setPrefix("/WEB-INF/views/");
        
        // è®¾ç½®åç¼€ï¼šæ–‡ä»¶æ‰©å±•å
        resolver.setSuffix(".jsp");
        
        // è®¾ç½®è§†å›¾ç±»å‹
        resolver.setViewClass(JstlView.class);
        
        return resolver;
    }
}
```

**ç†è§£é…ç½®çš„å«ä¹‰**ï¼š
```
å¦‚æœControllerè¿”å›è§†å›¾å "home"
é‚£ä¹ˆå®é™…è®¿é—®çš„æ–‡ä»¶æ˜¯ï¼š
/WEB-INF/views/ + home + .jsp
= /WEB-INF/views/home.jsp

ä¸ºä»€ä¹ˆæ”¾åœ¨WEB-INFä¸‹ï¼Ÿ
å› ä¸ºè¿™ä¸ªç›®å½•å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®ï¼Œæ›´å®‰å…¨ï¼
åªèƒ½é€šè¿‡Controllerè®¿é—®ã€‚
```

### 2.3 JSPå®é™…ä½¿ç”¨ç¤ºä¾‹



**Controllerä»£ç **ï¼š
```java
@Controller
public class ProductController {
    
    @GetMapping("/product/{id}")
    public String showProduct(@PathVariable Long id, Model model) {
        // 1. æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼ˆå‡è®¾ä»æ•°æ®åº“æŸ¥è¯¢ï¼‰
        Product product = productService.findById(id);
        
        // 2. æŠŠæ•°æ®æ”¾åˆ°Modelä¸­
        model.addAttribute("product", product);
        model.addAttribute("title", "å•†å“è¯¦æƒ…");
        
        // 3. è¿”å›è§†å›¾åç§°
        return "product/detail";  // å¯¹åº” /WEB-INF/views/product/detail.jsp
    }
}
```

**JSPé¡µé¢**ï¼ˆdetail.jspï¼‰ï¼š
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
    <title>${title}</title>
</head>
<body>
    <h1>${product.name}</h1>
    <div>
        <p>ä»·æ ¼ï¼šÂ¥${product.price}</p>
        <p>æè¿°ï¼š${product.description}</p>
        
        <!-- ä½¿ç”¨JSTLæ ‡ç­¾åˆ¤æ–­åº“å­˜ -->
        <c:if test="${product.stock > 0}">
            <button>ç«‹å³è´­ä¹°</button>
        </c:if>
        <c:if test="${product.stock <= 0}">
            <span style="color:red">æš‚æ—¶ç¼ºè´§</span>
        </c:if>
    </div>
</body>
</html>
```

**âš ï¸ JSPçš„é—®é¢˜ä¸é™åˆ¶**ï¼š
```
ä¸ºä»€ä¹ˆç°åœ¨å¾ˆå°‘ç”¨JSPï¼Ÿ

é—®é¢˜1ï¼šæ€§èƒ½å¼€é”€
â€¢ é¦–æ¬¡è®¿é—®éœ€è¦ç¼–è¯‘ï¼Œè¾ƒæ…¢
â€¢ å†…å­˜å ç”¨ç›¸å¯¹è¾ƒé«˜

é—®é¢˜2ï¼šéš¾ä»¥æµ‹è¯•
â€¢ éœ€è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨æ‰èƒ½æµ‹è¯•
â€¢ ä¸èƒ½è„±ç¦»å®¹å™¨è¿è¡Œ

é—®é¢˜3ï¼šå‰åç«¯è€¦åˆ
â€¢ HTMLå’ŒJavaä»£ç æ··åœ¨ä¸€èµ·
â€¢ ä¸åˆ©äºå›¢é˜Ÿåä½œï¼ˆå‰ç«¯ã€åç«¯ï¼‰

é—®é¢˜4ï¼šè¯­æ³•å¤æ‚
â€¢ JSPè¡¨è¾¾å¼ã€è„šæœ¬ç‰‡æ®µå®¹æ˜“æ··æ·†
â€¢ ä»£ç å¯è¯»æ€§å·®

æ›¿ä»£æ–¹æ¡ˆï¼š
ç°ä»£é¡¹ç›®æ¨èç”¨Thymeleafæˆ–å‰åç«¯åˆ†ç¦»
```

---

## 3. ğŸƒ Thymeleafé›†æˆ



### 3.1 Thymeleafæ ¸å¿ƒç†å¿µ



**ä»€ä¹ˆæ˜¯Thymeleafï¼Ÿ**
Thymeleafæ˜¯ä¸€ä¸ª"è‡ªç„¶æ¨¡æ¿"å¼•æ“ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯ä½ çš„HTMLæ–‡ä»¶ä¸éœ€è¦ç»è¿‡æœåŠ¡å™¨å¤„ç†ï¼Œä¹Ÿèƒ½ç›´æ¥åœ¨æµè§ˆå™¨æ‰“å¼€çœ‹æ•ˆæœï¼

**ğŸŒŸ è‡ªç„¶æ¨¡æ¿çš„å¥½å¤„**ï¼š
```
ä¼ ç»ŸJSPï¼š
<p>ç”¨æˆ·åï¼š<%= user.getName() %></p>
â€¢ æµè§ˆå™¨ç›´æ¥æ‰“å¼€ï¼šçœ‹åˆ°ä¸€å †ä¹±ç 
â€¢ å¿…é¡»é€šè¿‡æœåŠ¡å™¨æ‰èƒ½é¢„è§ˆ

Thymeleafï¼š
<p>ç”¨æˆ·åï¼š<span th:text="${user.name}">å¼ ä¸‰</span></p>
â€¢ æµè§ˆå™¨ç›´æ¥æ‰“å¼€ï¼šæ˜¾ç¤º"å¼ ä¸‰"ï¼ˆå ä½ç¬¦ï¼‰
â€¢ é€šè¿‡æœåŠ¡å™¨ï¼šæ˜¾ç¤ºçœŸå®æ•°æ®

å‰ç«¯å¼€å‘çš„ç¦éŸ³ï¼
å¯ä»¥å…ˆåšé™æ€é¡µé¢ï¼Œå†åŠ åŠ¨æ€æ•°æ®
```

### 3.2 Spring Bootä¸­é›†æˆThymeleaf



**ç¬¬ä¸€æ­¥ï¼šæ·»åŠ ä¾èµ–**

Spring Booté¡¹ç›®è¶…çº§ç®€å•ï¼š

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>
```

> åªéœ€è¦ä¸€ä¸ªä¾èµ–ï¼Spring Bootä¼šè‡ªåŠ¨é…ç½®å¥½ä¸€åˆ‡ã€‚

**ç¬¬äºŒæ­¥ï¼šé…ç½®å‚æ•°ï¼ˆå¯é€‰ï¼‰**

application.ymlé…ç½®æ–‡ä»¶ï¼š

```yaml
spring:
  thymeleaf:
#    # æ¨¡æ¿æ–‡ä»¶ä½ç½®ï¼ˆé»˜è®¤å°±æ˜¯è¿™ä¸ªï¼Œå¯ä¸é…ï¼‰
    prefix: classpath:/templates/
    suffix: .html
    
#    # æ¨¡æ¿ç¼–ç 
    encoding: UTF-8
    
#    # æ¨¡æ¿æ¨¡å¼
    mode: HTML
    
#    # å¼€å‘æ—¶å…³é—­ç¼“å­˜ï¼Œä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
    cache: false
    
#    # ç”Ÿäº§ç¯å¢ƒå¼€å¯ç¼“å­˜ï¼Œæå‡æ€§èƒ½
#    # cache: true
```

**ç¬¬ä¸‰æ­¥ï¼šç›®å½•ç»“æ„**

```
src/main/resources/
â”œâ”€â”€ templates/          # Thymeleafæ¨¡æ¿æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ list.html
â”‚   â”‚   â””â”€â”€ detail.html
â”‚   â””â”€â”€ error/
â”‚       â””â”€â”€ 404.html
â””â”€â”€ static/            # é™æ€èµ„æºæ–‡ä»¶å¤¹
    â”œâ”€â”€ css/
    â”œâ”€â”€ js/
    â””â”€â”€ images/
```

### 3.3 Thymeleafå¸¸ç”¨è¯­æ³•



**ğŸ“Œ å˜é‡è¡¨è¾¾å¼**ï¼š

```html
<!-- 1. åŸºæœ¬æ–‡æœ¬æ›¿æ¢ -->
<p th:text="${message}">è¿™æ˜¯é»˜è®¤æ–‡æœ¬</p>

<!-- 2. å±æ€§æ›¿æ¢ -->
<img th:src="${user.avatar}" src="default.jpg" alt="å¤´åƒ">
<a th:href="@{/user/{id}(id=${user.id})}">æŸ¥çœ‹è¯¦æƒ…</a>

<!-- 3. æ¡ä»¶åˆ¤æ–­ -->
<div th:if="${user.age >= 18}">
    <p>æ¬¢è¿æˆå¹´ç”¨æˆ·</p>
</div>
<div th:unless="${user.age >= 18}">
    <p>æœªæˆå¹´ç”¨æˆ·</p>
</div>

<!-- 4. å¾ªç¯éå† -->
<ul>
    <li th:each="product : ${products}" 
        th:text="${product.name}">å•†å“åç§°</li>
</ul>

<!-- 5. æ¡ä»¶é€‰æ‹©ï¼ˆç±»ä¼¼switchï¼‰ -->
<div th:switch="${user.role}">
    <p th:case="'admin'">ç®¡ç†å‘˜</p>
    <p th:case="'user'">æ™®é€šç”¨æˆ·</p>
    <p th:case="*">è®¿å®¢</p>
</div>
```

**ğŸ”— URLå¤„ç†**ï¼š

```html
<!-- ç®€å•é“¾æ¥ -->
<a th:href="@{/products}">å•†å“åˆ—è¡¨</a>

<!-- å¸¦å‚æ•°çš„é“¾æ¥ -->
<a th:href="@{/product(id=${product.id})}">å•†å“è¯¦æƒ…</a>
<!-- ç”Ÿæˆï¼š/product?id=123 -->

<!-- RESTfulé£æ ¼é“¾æ¥ -->
<a th:href="@{/product/{id}(id=${product.id})}">å•†å“è¯¦æƒ…</a>
<!-- ç”Ÿæˆï¼š/product/123 -->

<!-- å¤šä¸ªå‚æ•° -->
<a th:href="@{/search(keyword=${keyword},page=${page})}">æœç´¢</a>
<!-- ç”Ÿæˆï¼š/search?keyword=æ‰‹æœº&page=1 -->
```

### 3.4 å®æˆ˜æ¡ˆä¾‹ï¼šå•†å“åˆ—è¡¨é¡µé¢



**Controllerå±‚**ï¼š
```java
@Controller
public class ProductController {
    
    @Autowired
    private ProductService productService;
    
    @GetMapping("/products")
    public String listProducts(Model model) {
        // æŸ¥è¯¢å•†å“åˆ—è¡¨
        List<Product> products = productService.findAll();
        
        // ä¼ é€’æ•°æ®åˆ°è§†å›¾
        model.addAttribute("products", products);
        model.addAttribute("title", "å•†å“åˆ—è¡¨");
        
        return "product/list";  // è¿”å› templates/product/list.html
    }
}
```

**æ¨¡æ¿é¡µé¢**ï¼ˆlist.htmlï¼‰ï¼š
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">å•†å“åˆ—è¡¨</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <h1 th:text="${title}">å•†å“åˆ—è¡¨</h1>
    
    <!-- å•†å“åˆ—è¡¨ -->
    <div class="product-list">
        <!-- å¾ªç¯æ˜¾ç¤ºå•†å“ -->
        <div th:each="product, stat : ${products}" class="product-item">
            <!-- stat.count æ˜¯å¾ªç¯è®¡æ•°ï¼Œä»1å¼€å§‹ -->
            <span th:text="${stat.count}">1</span>
            
            <!-- å•†å“å›¾ç‰‡ -->
            <img th:src="${product.image}" 
                 th:alt="${product.name}"
                 src="default.jpg" alt="å•†å“å›¾ç‰‡">
            
            <!-- å•†å“åç§° -->
            <h3 th:text="${product.name}">å•†å“åç§°</h3>
            
            <!-- ä»·æ ¼æ˜¾ç¤ºï¼ˆä¿ç•™2ä½å°æ•°ï¼‰ -->
            <p class="price">
                Â¥<span th:text="${#numbers.formatDecimal(product.price, 1, 2)}">99.00</span>
            </p>
            
            <!-- åº“å­˜çŠ¶æ€ -->
            <p th:if="${product.stock > 0}" class="in-stock">
                åº“å­˜ï¼š<span th:text="${product.stock}">10</span>
            </p>
            <p th:if="${product.stock <= 0}" class="out-stock">
                æš‚æ—¶ç¼ºè´§
            </p>
            
            <!-- è¯¦æƒ…é“¾æ¥ -->
            <a th:href="@{/product/{id}(id=${product.id})}" class="btn">
                æŸ¥çœ‹è¯¦æƒ…
            </a>
        </div>
    </div>
    
    <!-- ç©ºåˆ—è¡¨æç¤º -->
    <div th:if="${#lists.isEmpty(products)}" class="empty">
        <p>æš‚æ— å•†å“</p>
    </div>
</body>
</html>
```

**ğŸ’¡ Thymeleafå®ç”¨æŠ€å·§**ï¼š

```
æŠ€å·§1ï¼šå†…è”è¡¨è¾¾å¼
<p>æ€»ä»·ï¼š[[${product.price * product.quantity}]]å…ƒ</p>
ç­‰åŒäºï¼š<p>æ€»ä»·ï¼š<span th:text="${product.price * product.quantity}"></span>å…ƒ</p>

æŠ€å·§2ï¼šç‰‡æ®µå¤ç”¨ï¼ˆç±»ä¼¼includeï¼‰
<!-- å®šä¹‰ç‰‡æ®µ -->
<div th:fragment="header">
    <nav>å¯¼èˆªæ </nav>
</div>

<!-- å¼•ç”¨ç‰‡æ®µ -->
<div th:replace="~{fragments/header :: header}"></div>

æŠ€å·§3ï¼šå·¥å…·ç±»ä½¿ç”¨
â€¢ #datesï¼šæ—¥æœŸæ ¼å¼åŒ–
  <p th:text="${#dates.format(date, 'yyyy-MM-dd')}"></p>

â€¢ #stringsï¼šå­—ç¬¦ä¸²å¤„ç†
  <p th:text="${#strings.toUpperCase(name)}"></p>

â€¢ #numbersï¼šæ•°å­—æ ¼å¼åŒ–
  <p th:text="${#numbers.formatDecimal(price, 1, 2)}"></p>
```

---

## 4. ğŸ­ FreeMarkeré›†æˆ



### 4.1 FreeMarkerç‰¹ç‚¹



**FreeMarkeræ˜¯ä»€ä¹ˆï¼Ÿ**
FreeMarkeræ˜¯ä¸€ä¸ªçº¯æ¨¡æ¿å¼•æ“ï¼Œä¸“æ³¨äºæ¨¡æ¿å’Œæ•°æ®çš„åˆ†ç¦»ã€‚å°±åƒä¸€ä¸ª"å¡«ç©ºé¢˜"ï¼Œä½ å®šä¹‰å¥½ç©ºæ ¼ï¼ˆæ¨¡æ¿ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨å¡«å…¥ç­”æ¡ˆï¼ˆæ•°æ®ï¼‰ã€‚

**ğŸ¯ FreeMarkerçš„ä¼˜åŠ¿**ï¼š
```
ä¸Thymeleafå¯¹æ¯”ï¼š

FreeMarkerç‰¹ç‚¹ï¼š
âœ… çº¯æ¨¡æ¿è¯­è¨€ï¼Œè¯­æ³•ç®€æ´
âœ… åŠŸèƒ½å¼ºå¤§ï¼Œå†…ç½®å‡½æ•°ä¸°å¯Œ
âœ… æ€§èƒ½è¾ƒå¥½ï¼Œæ¸²æŸ“é€Ÿåº¦å¿«
âœ… ä¸ä»…èƒ½ç”ŸæˆHTMLï¼Œè¿˜èƒ½ç”Ÿæˆé‚®ä»¶ã€æ–‡æ¡£ç­‰

é€‚ç”¨åœºæ™¯ï¼š
â€¢ é‚®ä»¶æ¨¡æ¿
â€¢ PDFæ–‡æ¡£ç”Ÿæˆ
â€¢ ExcelæŠ¥è¡¨ç”Ÿæˆ
â€¢ ä»£ç ç”Ÿæˆå™¨

ä¸å¤ªé€‚åˆï¼š
â€¢ éœ€è¦åœ¨æµè§ˆå™¨ç›´æ¥é¢„è§ˆçš„HTMLé¡µé¢
â€¢ å‰åç«¯åä½œå¼€å‘çš„é¡¹ç›®
```

### 4.2 Spring Booté›†æˆé…ç½®



**æ·»åŠ ä¾èµ–**ï¼š

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-freemarker</artifactId>
</dependency>
```

**é…ç½®æ–‡ä»¶**ï¼ˆapplication.ymlï¼‰ï¼š

```yaml
spring:
  freemarker:
#    # æ¨¡æ¿æ–‡ä»¶ä½ç½®
    template-loader-path: classpath:/templates/
    
#    # æ–‡ä»¶åç¼€
    suffix: .ftl
    
#    # ç¼–ç 
    charset: UTF-8
    
#    # å†…å®¹ç±»å‹
    content-type: text/html
    
#    # å¼€å‘ç¯å¢ƒå…³é—­ç¼“å­˜
    cache: false
    
#    # æ¨¡æ¿é…ç½®
    settings:
      number_format: 0.##       # æ•°å­—æ ¼å¼
      datetime_format: yyyy-MM-dd HH:mm:ss
      date_format: yyyy-MM-dd
```

### 4.3 FreeMarkeråŸºæœ¬è¯­æ³•



**ğŸ“ å¸¸ç”¨è¯­æ³•å¯¹ç…§**ï¼š

```ftl
<!-- 1. å˜é‡è¾“å‡º -->
${userName}
${product.name}

<!-- 2. é»˜è®¤å€¼ï¼ˆå˜é‡ä¸å­˜åœ¨æ—¶ä½¿ç”¨ï¼‰ -->
${userName!'æ¸¸å®¢'}
${user.email!'æœªå¡«å†™'}

<!-- 3. æ¡ä»¶åˆ¤æ–­ -->
<#if user.age >= 18>
    æˆå¹´ç”¨æˆ·
<#else>
    æœªæˆå¹´ç”¨æˆ·
</#if>

<!-- 4. åˆ—è¡¨éå† -->
<#list products as product>
    <p>${product_index + 1}. ${product.name}</p>
</#list>

<!-- 5. ç©ºå€¼åˆ¤æ–­ -->
<#if products??>
    <#list products as product>
        ${product.name}
    </#list>
<#else>
    æš‚æ— å•†å“
</#if>

<!-- 6. æ•°å­—æ ¼å¼åŒ– -->
ä»·æ ¼ï¼š${product.price?string('0.00')}å…ƒ

<!-- 7. æ—¥æœŸæ ¼å¼åŒ– -->
${createTime?string('yyyy-MM-dd HH:mm')}

<!-- 8. å­—ç¬¦ä¸²æ“ä½œ -->
${userName?upper_case}      <!-- è½¬å¤§å†™ -->
${description?substring(0, 50)}  <!-- æˆªå–å­—ç¬¦ä¸² -->
```

### 4.4 å®æˆ˜æ¡ˆä¾‹ï¼šé‚®ä»¶æ¨¡æ¿



è¿™æ˜¯FreeMarkerçš„ç»å…¸ä½¿ç”¨åœºæ™¯ï¼

**æ¨¡æ¿æ–‡ä»¶**ï¼ˆorder-confirm.ftlï¼‰ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è®¢å•ç¡®è®¤</title>
</head>
<body>
    <div style="font-family: Arial; max-width: 600px; margin: 0 auto;">
        <h2>è®¢å•ç¡®è®¤é€šçŸ¥</h2>
        
        <p>å°Šæ•¬çš„ ${userName}ï¼Œæ‚¨å¥½ï¼</p>
        
        <p>æ‚¨çš„è®¢å•å·²ç¡®è®¤ï¼Œè®¢å•è¯¦æƒ…å¦‚ä¸‹ï¼š</p>
        
        <table border="1" cellpadding="10" style="width:100%; border-collapse: collapse;">
            <tr style="background-color: #f0f0f0;">
                <th>å•†å“åç§°</th>
                <th>å•ä»·</th>
                <th>æ•°é‡</th>
                <th>å°è®¡</th>
            </tr>
            
            <!-- å¾ªç¯è®¢å•é¡¹ -->
            <#list orderItems as item>
            <tr>
                <td>${item.productName}</td>
                <td>Â¥${item.price?string('0.00')}</td>
                <td>${item.quantity}</td>
                <td>Â¥${(item.price * item.quantity)?string('0.00')}</td>
            </tr>
            </#list>
            
            <tr>
                <td colspan="3" style="text-align: right;"><strong>æ€»è®¡ï¼š</strong></td>
                <td><strong>Â¥${totalAmount?string('0.00')}</strong></td>
            </tr>
        </table>
        
        <div style="margin-top: 20px;">
            <p><strong>æ”¶è´§ä¿¡æ¯ï¼š</strong></p>
            <p>æ”¶è´§äººï¼š${shippingAddress.receiver}</p>
            <p>è”ç³»ç”µè¯ï¼š${shippingAddress.phone}</p>
            <p>æ”¶è´§åœ°å€ï¼š${shippingAddress.fullAddress}</p>
        </div>
        
        <p style="color: #666; margin-top: 30px;">
            è®¢å•å·ï¼š${orderNo}<br>
            ä¸‹å•æ—¶é—´ï¼š${orderTime?string('yyyy-MM-dd HH:mm:ss')}
        </p>
        
        <p style="color: #999; font-size: 12px; margin-top: 50px;">
            æ­¤é‚®ä»¶ä¸ºç³»ç»Ÿè‡ªåŠ¨å‘é€ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚
        </p>
    </div>
</body>
</html>
```

**Javaä»£ç å‘é€é‚®ä»¶**ï¼š

```java
@Service
public class EmailService {
    
    @Autowired
    private FreeMarkerConfigurer freeMarkerConfigurer;
    
    @Autowired
    private JavaMailSender mailSender;
    
    public void sendOrderConfirmEmail(Order order) throws Exception {
        // 1. å‡†å¤‡æ¨¡æ¿æ•°æ®
        Map<String, Object> model = new HashMap<>();
        model.put("userName", order.getUserName());
        model.put("orderNo", order.getOrderNo());
        model.put("orderItems", order.getItems());
        model.put("totalAmount", order.getTotalAmount());
        model.put("shippingAddress", order.getShippingAddress());
        model.put("orderTime", order.getCreateTime());
        
        // 2. æ¸²æŸ“æ¨¡æ¿
        Configuration cfg = freeMarkerConfigurer.getConfiguration();
        Template template = cfg.getTemplate("order-confirm.ftl");
        String htmlContent = FreeMarkerTemplateUtils.processTemplateIntoString(template, model);
        
        // 3. å‘é€é‚®ä»¶
        MimeMessage message = mailSender.createMimeMessage();
        MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");
        
        helper.setTo(order.getUserEmail());
        helper.setSubject("è®¢å•ç¡®è®¤ - " + order.getOrderNo());
        helper.setText(htmlContent, true);  // trueè¡¨ç¤ºHTMLå†…å®¹
        
        mailSender.send(message);
    }
}
```

**ğŸ¯ FreeMarkerä½¿ç”¨åœºæ™¯æ€»ç»“**ï¼š

```
âœ… æœ€é€‚åˆçš„åœºæ™¯ï¼š
â€¢ é‚®ä»¶æ¨¡æ¿ï¼ˆè®¢å•ç¡®è®¤ã€è´¦å·æ¿€æ´»ã€å¯†ç é‡ç½®ï¼‰
â€¢ æ–‡æ¡£ç”Ÿæˆï¼ˆåˆåŒã€æŠ¥è¡¨ã€å‘ç¥¨ï¼‰
â€¢ å¯¼å‡ºåŠŸèƒ½ï¼ˆHTMLè½¬PDFã€Excelç­‰ï¼‰
â€¢ ä»£ç ç”Ÿæˆå™¨ï¼ˆæ ¹æ®æ¨¡æ¿ç”Ÿæˆä»£ç æ–‡ä»¶ï¼‰

âŒ ä¸å¤ªé€‚åˆçš„åœºæ™¯ï¼š
â€¢ éœ€è¦å‰ç«¯å®æ—¶é¢„è§ˆçš„é¡µé¢
â€¢ éœ€è¦å¤æ‚å‰ç«¯äº¤äº’çš„åº”ç”¨
â€¢ å‰åç«¯åˆ†ç¦»é¡¹ç›®
```

---

## 5. âš¡ Velocityæ”¯æŒ



### 5.1 Velocityç°çŠ¶è¯´æ˜



**Velocityæ˜¯ä»€ä¹ˆï¼Ÿ**
Velocityæ˜¯Apacheçš„è€ç‰Œæ¨¡æ¿å¼•æ“ï¼Œè¯­æ³•ç®€å•è½»é‡ã€‚ä½†ç°åœ¨å·²ç»åŸºæœ¬"é€€ä¼‘"äº†ã€‚

```
âš ï¸ é‡è¦æç¤ºï¼š
Spring 4.3+ å·²ç»ä¸å†æ¨èä½¿ç”¨Velocity
Spring 5.0+ å®Œå…¨ç§»é™¤äº†Velocityæ”¯æŒ

ä¸ºä»€ä¹ˆè¢«æ·˜æ±°ï¼Ÿ
1. é•¿æœŸæœªæ›´æ–°ï¼ˆæœ€åç‰ˆæœ¬2010å¹´ï¼‰
2. ä¸æ”¯æŒç°ä»£Javaç‰¹æ€§
3. æ€§èƒ½ä¸å¦‚æ–°æ¡†æ¶
4. ç¤¾åŒºä¸æ´»è·ƒ

å¦‚æœé‡åˆ°Velocityé¡¹ç›®ï¼š
å»ºè®®ï¼šè¿ç§»åˆ°Thymeleafæˆ–FreeMarker
ç°å®ï¼šè€é¡¹ç›®ç»´æŠ¤ä¹Ÿè¦é€æ­¥æ›¿æ¢
```

### 5.2 åŸºæœ¬è¯­æ³•äº†è§£ï¼ˆä»…ä¾›ç»´æŠ¤å‚è€ƒï¼‰



å¦‚æœä½ éœ€è¦ç»´æŠ¤è€é¡¹ç›®ï¼Œè¿™äº›è¯­æ³•è¦è®¤è¯†ï¼š

```velocity
# å•è¡Œæ³¨é‡Š



#* 

   å¤šè¡Œæ³¨é‡Š
*#

# å˜é‡è¾“å‡º


$userName
$!userName  ## æ„Ÿå¹å·è¡¨ç¤ºå˜é‡ä¸å­˜åœ¨æ—¶ä¸æŠ¥é”™

# æ¡ä»¶åˆ¤æ–­


#if($user.age >= 18)

    æˆå¹´ç”¨æˆ·
#else

    æœªæˆå¹´ç”¨æˆ·
#end


# å¾ªç¯


#foreach($product in $products)

    <p>$velocityCount. $product.name</p>  ## $velocityCountæ˜¯å¾ªç¯è®¡æ•°å™¨
#end


# å¼•å…¥å…¶ä»–æ¨¡æ¿


#include("header.vm")

#parse("footer.vm")  ## parseä¼šè§£æå˜é‡ï¼Œincludeä¸ä¼š

```

**ğŸ”„ è¿ç§»å»ºè®®**ï¼š

å¦‚æœä½ æ¥æ‰‹äº†Velocityé¡¹ç›®ï¼Œå»ºè®®è¿™æ ·è¿ç§»ï¼š

```
è¿ç§»æ­¥éª¤ï¼š
1. è¯„ä¼°é¡¹ç›®è§„æ¨¡å’Œæ¨¡æ¿æ•°é‡
2. é€‰æ‹©ç›®æ ‡æ¡†æ¶ï¼ˆæ¨èThymeleafï¼‰
3. é€ä¸ªæ¨¡æ¿è½¬æ¢ï¼ˆå¯ä»¥ç”¨å·¥å…·è¾…åŠ©ï¼‰
4. å……åˆ†æµ‹è¯•
5. ç°åº¦å‘å¸ƒ

è¯­æ³•å¯¹ç…§è½¬æ¢ï¼š
Velocity          â†’  Thymeleaf
$userName        â†’  ${userName}
#if()...#end     â†’  th:if="${...}"

#foreach         â†’  th:each

#include         â†’  th:replace

```

---

## 6. ğŸ“ é™æ€èµ„æºå¤„ç†



### 6.1 é™æ€èµ„æºçš„æ¦‚å¿µ



**ä»€ä¹ˆæ˜¯é™æ€èµ„æºï¼Ÿ**
å°±æ˜¯é‚£äº›ä¸éœ€è¦æœåŠ¡å™¨å¤„ç†ï¼Œç›´æ¥å‘ç»™æµè§ˆå™¨çš„æ–‡ä»¶ï¼šCSSæ ·å¼ã€JavaScriptè„šæœ¬ã€å›¾ç‰‡ã€å­—ä½“ç­‰ã€‚

```
åŠ¨æ€èµ„æº vs é™æ€èµ„æºï¼š

åŠ¨æ€èµ„æºï¼ˆéœ€è¦æœåŠ¡å™¨å¤„ç†ï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ Controller â†’ æŸ¥æ•°æ®åº“ â†’ æ¸²æŸ“æ¨¡æ¿ â†’ è¿”å›HTML
ä¾‹å­ï¼šå•†å“è¯¦æƒ…é¡µã€ç”¨æˆ·ä¿¡æ¯é¡µ

é™æ€èµ„æºï¼ˆç›´æ¥è¿”å›ï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ æœåŠ¡å™¨ç›´æ¥è¿”å›æ–‡ä»¶
ä¾‹å­ï¼šlogo.pngã€style.cssã€jquery.js
```

### 6.2 Spring Booté»˜è®¤é…ç½®



Spring Bootå¼€ç®±å³ç”¨çš„é™æ€èµ„æºé…ç½®ï¼š

**ğŸ“‚ é»˜è®¤é™æ€èµ„æºç›®å½•**ï¼š

```
src/main/resources/
â”œâ”€â”€ static/          # ç¬¬ä¸€ä¼˜å…ˆçº§
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ public/          # ç¬¬äºŒä¼˜å…ˆçº§
â”œâ”€â”€ resources/       # ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼ˆä¸æ¨èç”¨ï¼‰
â””â”€â”€ META-INF/resources/  # ç¬¬å››ä¼˜å…ˆçº§ï¼ˆjaråŒ…å†…èµ„æºï¼‰
```

**è®¿é—®æ–¹å¼**ï¼š

```
æ–‡ä»¶ä½ç½®ï¼šsrc/main/resources/static/css/style.css
è®¿é—®URLï¼šhttp://localhost:8080/css/style.css

æ–‡ä»¶ä½ç½®ï¼šsrc/main/resources/static/images/logo.png  
è®¿é—®URLï¼šhttp://localhost:8080/images/logo.png

æ³¨æ„ï¼š
è®¿é—®è·¯å¾„è‡ªåŠ¨å»æ‰ /static/ å‰ç¼€ï¼
æµè§ˆå™¨çœ‹åˆ°çš„URLæ›´ç®€æ´
```

### 6.3 è‡ªå®šä¹‰é™æ€èµ„æºé…ç½®



**é…ç½®æ–‡ä»¶æ–¹å¼**ï¼ˆapplication.ymlï¼‰ï¼š

```yaml
spring:
  web:
    resources:
#      # é™æ€èµ„æºè®¿é—®è·¯å¾„ï¼ˆURLå‰ç¼€ï¼‰
      static-locations: 
        - classpath:/static/
        - classpath:/public/
        - file:/data/uploads/    # å¤–éƒ¨æ–‡ä»¶ç³»ç»Ÿ
      
#      # ç¼“å­˜é…ç½®
      cache:
        period: 3600           # ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
        cachecontrol:
          max-age: 3600        # æµè§ˆå™¨ç¼“å­˜æ—¶é—´
          must-revalidate: true
```

**Javaé…ç½®æ–¹å¼**ï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // è‡ªå®šä¹‰é™æ€èµ„æºæ˜ å°„
        registry.addResourceHandler("/assets/**")
                .addResourceLocations("classpath:/static/assets/")
                .setCachePeriod(3600);  // ç¼“å­˜1å°æ—¶
        
        // æ–‡ä»¶ä¸Šä¼ ç›®å½•æ˜ å°„
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:/data/uploads/")
                .setCachePeriod(0);  // ä¸ç¼“å­˜ï¼Œå®æ—¶æ˜¾ç¤º
        
        // CDNèµ„æºæ˜ å°„
        registry.addResourceHandler("/cdn/**")
                .addResourceLocations("https://cdn.example.com/");
    }
}
```

**ğŸ” è·¯å¾„æ˜ å°„ç†è§£**ï¼š

```
é…ç½®è§£æï¼š
registry.addResourceHandler("/assets/**")
        .addResourceLocations("classpath:/static/assets/")

å«ä¹‰ï¼š
â€¢ /assets/**ï¼šURLè®¿é—®è·¯å¾„
  è®¿é—® http://localhost:8080/assets/css/style.css

â€¢ classpath:/static/assets/ï¼šå®é™…æ–‡ä»¶ä½ç½®
  å¯¹åº” src/main/resources/static/assets/css/style.css

** è¡¨ç¤ºåŒ¹é…ä»»æ„å±‚çº§çš„è·¯å¾„
```

### 6.4 é™æ€èµ„æºç‰ˆæœ¬ç®¡ç†



**ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†ï¼Ÿ**

```
é—®é¢˜åœºæ™¯ï¼š
1. ä½ æ›´æ–°äº† style.css
2. ç”¨æˆ·æµè§ˆå™¨è¿˜ç¼“å­˜ç€æ—§ç‰ˆæœ¬
3. ç”¨æˆ·çœ‹åˆ°çš„é¡µé¢æ ·å¼é”™ä¹±

è§£å†³æ–¹æ¡ˆï¼š
ç»™èµ„æºæ–‡ä»¶åŠ ç‰ˆæœ¬å·ï¼Œå¼ºåˆ¶æµè§ˆå™¨æ›´æ–°
```

**æ–¹æ¡ˆä¸€ï¼šæ–‡ä»¶åç‰ˆæœ¬å·**

```yaml
spring:
  web:
    resources:
      chain:
        strategy:
          content:
            enabled: true    # å¯ç”¨å†…å®¹ç‰ˆæœ¬ç­–ç•¥
            paths: /**       # å¯¹æ‰€æœ‰èµ„æºç”Ÿæ•ˆ
```

æ•ˆæœï¼š
```html
<!-- åŸå§‹å¼•ç”¨ -->
<link rel="stylesheet" href="/css/style.css">

<!-- è‡ªåŠ¨æ·»åŠ MD5å“ˆå¸Œ -->
<link rel="stylesheet" href="/css/style-a3f5b8c9.css">

æ–‡ä»¶å†…å®¹å˜åŒ– â†’ å“ˆå¸Œå€¼å˜åŒ– â†’ æµè§ˆå™¨é‡æ–°ä¸‹è½½
```

**æ–¹æ¡ˆäºŒï¼šæŸ¥è¯¢å‚æ•°ç‰ˆæœ¬å·**

```yaml
spring:
  web:
    resources:
      chain:
        strategy:
          fixed:
            enabled: true
            version: v1.0.0
            paths: /**
```

æ•ˆæœï¼š
```html
<link rel="stylesheet" href="/css/style.css?v=1.0.0">
<!-- æ¯æ¬¡å‘ç‰ˆæ›´æ–°ç‰ˆæœ¬å·å³å¯ -->
```

---

## 7. ğŸ’¾ è§†å›¾ç¼“å­˜ç­–ç•¥



### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜



**é€šä¿—ç†è§£**ï¼š
æ¨¡æ¿æ¸²æŸ“å°±åƒ"åšèœ"ï¼Œæ¯æ¬¡éƒ½ä»å¤´åšå¤ªæ…¢ï¼ŒæŠŠå¸¸ç”¨çš„èœï¼ˆæ¸²æŸ“ç»“æœï¼‰ä¿æ¸©èµ·æ¥ï¼Œä¸‹æ¬¡ç›´æ¥æ‹¿ï¼Œé€Ÿåº¦å¿«å¤šäº†ï¼

```
æ²¡æœ‰ç¼“å­˜çš„è¿‡ç¨‹ï¼š
è¯·æ±‚ â†’ è¯»æ¨¡æ¿æ–‡ä»¶ â†’ è§£ææ¨¡æ¿ â†’ å¡«å……æ•°æ® â†’ ç”ŸæˆHTML â†’ è¿”å›
æ¯æ¬¡éƒ½è¦é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæ…¢ï¼

æœ‰ç¼“å­˜çš„è¿‡ç¨‹ï¼š
é¦–æ¬¡ï¼šè¯»æ¨¡æ¿ â†’ è§£æ â†’ ç¼“å­˜æ¨¡æ¿å¯¹è±¡
ä»¥åï¼šç›´æ¥ç”¨ç¼“å­˜çš„æ¨¡æ¿å¯¹è±¡ â†’ å¡«å……æ•°æ® â†’ è¿”å›
å¿«å¾ˆå¤šï¼
```

### 7.2 Thymeleafç¼“å­˜é…ç½®



**å¼€å‘ç¯å¢ƒé…ç½®**ï¼ˆå…³é—­ç¼“å­˜ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼‰ï¼š

```yaml
spring:
  thymeleaf:
    cache: false    # å…³é—­ç¼“å­˜
    
# ä¼˜ç‚¹ï¼šä¿®æ”¹æ¨¡æ¿ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯

# ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒä½ï¼Œæ¯æ¬¡éƒ½é‡æ–°è§£æ

```

**ç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼ˆå¼€å¯ç¼“å­˜ï¼Œæå‡æ€§èƒ½ï¼‰ï¼š

```yaml
spring:
  thymeleaf:
    cache: true     # å¼€å¯ç¼“å­˜
    
#    # é«˜çº§é…ç½®
    cache-size: 100              # ç¼“å­˜æ¨¡æ¿æ•°é‡
    check-template-location: true # æ£€æŸ¥æ¨¡æ¿æ˜¯å¦å­˜åœ¨
```

**âš™ï¸ ç¼“å­˜ç®¡ç†ä»£ç **ï¼š

```java
@Configuration
public class ThymeleafConfig {
    
    @Bean
    public SpringTemplateEngine templateEngine(ITemplateResolver templateResolver) {
        SpringTemplateEngine engine = new SpringTemplateEngine();
        engine.setTemplateResolver(templateResolver);
        
        // é…ç½®ç¼“å­˜ç®¡ç†å™¨
        CacheManager cacheManager = CacheManager.create();
        engine.setCacheManager(cacheManager);
        
        return engine;
    }
    
    // æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜çš„æ–¹æ³•
    @Autowired
    private SpringTemplateEngine templateEngine;
    
    public void clearCache() {
        // æ¸…é™¤æ‰€æœ‰æ¨¡æ¿ç¼“å­˜
        templateEngine.clearTemplateCache();
    }
    
    public void clearCache(String templateName) {
        // æ¸…é™¤æŒ‡å®šæ¨¡æ¿ç¼“å­˜
        templateEngine.clearTemplateCacheFor(templateName);
    }
}
```

### 7.3 FreeMarkerç¼“å­˜é…ç½®



```yaml
spring:
  freemarker:
    cache: false    # å¼€å‘ç¯å¢ƒå…³é—­
    
    settings:
#      # æ¨¡æ¿æ›´æ–°æ£€æŸ¥å»¶è¿Ÿï¼ˆç§’ï¼‰
      template_update_delay: 0        # å¼€å‘ç¯å¢ƒï¼šç«‹å³æ£€æŸ¥
#      # template_update_delay: 3600   # ç”Ÿäº§ç¯å¢ƒï¼š1å°æ—¶æ£€æŸ¥ä¸€æ¬¡
```

**Javaé…ç½®æ–¹å¼**ï¼š

```java
@Configuration
public class FreeMarkerConfig {
    
    @Bean
    public FreeMarkerConfigurer freeMarkerConfigurer() {
        FreeMarkerConfigurer configurer = new FreeMarkerConfigurer();
        configurer.setTemplateLoaderPath("classpath:/templates/");
        
        Properties settings = new Properties();
        // å¼€å‘ç¯å¢ƒï¼šç«‹å³æ£€æµ‹æ¨¡æ¿å˜åŒ–
        settings.setProperty("template_update_delay", "0");
        
        // ç”Ÿäº§ç¯å¢ƒï¼š1å°æ—¶æ£€æµ‹ä¸€æ¬¡
        // settings.setProperty("template_update_delay", "3600");
        
        configurer.setFreemarkerSettings(settings);
        return configurer;
    }
}
```

### 7.4 ç¼“å­˜ç­–ç•¥æœ€ä½³å®è·µ



**ğŸ“Š ä¸åŒç¯å¢ƒçš„ç¼“å­˜ç­–ç•¥**ï¼š

```
å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°å¼€å‘ï¼‰ï¼š
âœ… å…³é—­æ‰€æœ‰ç¼“å­˜
âœ… æ¨¡æ¿ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
âœ… æ–¹ä¾¿è°ƒè¯•å’Œæµ‹è¯•
é…ç½®ï¼šcache: false

æµ‹è¯•ç¯å¢ƒï¼ˆåŠŸèƒ½æµ‹è¯•ï¼‰ï¼š
âš¡ çŸ­ç¼“å­˜æ—¶é—´ï¼ˆå¦‚5åˆ†é’Ÿï¼‰
âš¡ å¹³è¡¡æ€§èƒ½å’Œçµæ´»æ€§
é…ç½®ï¼štemplate_update_delay: 300

ç”Ÿäº§ç¯å¢ƒï¼ˆçº¿ä¸ŠæœåŠ¡ï¼‰ï¼š
ğŸš€ å®Œå…¨å¼€å¯ç¼“å­˜
ğŸš€ é•¿ç¼“å­˜æ—¶é—´æˆ–ä¸æ£€æŸ¥
ğŸš€ è¿½æ±‚æœ€ä½³æ€§èƒ½
é…ç½®ï¼šcache: true, template_update_delay: 3600
```

**ğŸ”„ ç¼“å­˜æ›´æ–°ç­–ç•¥**ï¼š

```java
@Service
public class TemplateService {
    
    @Autowired
    private SpringTemplateEngine templateEngine;
    
    // ç­–ç•¥1ï¼šå®šæ—¶æ¸…ç†ç¼“å­˜
    @Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©å‡Œæ™¨2ç‚¹
    public void scheduledCacheClear() {
        templateEngine.clearTemplateCache();
        log.info("æ¨¡æ¿ç¼“å­˜å·²æ¸…ç†");
    }
    
    // ç­–ç•¥2ï¼šå‘å¸ƒåæ¸…ç†ç¼“å­˜
    @EventListener(ApplicationReadyEvent.class)
    public void onApplicationReady() {
        templateEngine.clearTemplateCache();
        log.info("åº”ç”¨å¯åŠ¨ï¼Œæ¨¡æ¿ç¼“å­˜å·²æ¸…ç†");
    }
    
    // ç­–ç•¥3ï¼šæ‰‹åŠ¨æ¸…ç†æ¥å£ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
    @GetMapping("/admin/clearCache")
    @PreAuthorize("hasRole('ADMIN')")
    public String clearTemplateCache() {
        templateEngine.clearTemplateCache();
        return "ç¼“å­˜å·²æ¸…ç†";
    }
}
```

**ğŸ’¡ ç¼“å­˜ä½¿ç”¨å»ºè®®**ï¼š

```
ä»€ä¹ˆæ—¶å€™æ¸…ç†ç¼“å­˜ï¼Ÿ

å¿…é¡»æ¸…ç†ï¼š
âœ… åº”ç”¨é‡æ–°éƒ¨ç½²å
âœ… æ¨¡æ¿æ–‡ä»¶æ›´æ–°å
âœ… å‘ç°æ˜¾ç¤ºå¼‚å¸¸æ—¶

å®šæœŸæ¸…ç†ï¼š
â° æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹å®šæ—¶æ¸…ç†ï¼ˆå¦‚æ¯å¤©å‡Œæ™¨ï¼‰
â° ä¸å½±å“ç”¨æˆ·ä½¿ç”¨çš„æ—¶é—´æ®µ

ä¸è¦æ¸…ç†ï¼š
âŒ é«˜å¹¶å‘æ—¶æ®µ
âŒ ç¼“å­˜åˆšå»ºç«‹ä¸ä¹…
âŒ æ¨¡æ¿æ²¡æœ‰å˜åŒ–æ—¶
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 æŠ€æœ¯é€‰å‹å†³ç­–



**ğŸ¯ å¿«é€Ÿé€‰æ‹©æŒ‡å—**ï¼š

```
æ–°é¡¹ç›®æ¨èï¼š
1. Thymeleafï¼ˆé¦–é€‰ï¼‰
   âœ… Springå®˜æ–¹æ¨è
   âœ… è‡ªç„¶æ¨¡æ¿ï¼Œå‰ç«¯å‹å¥½
   âœ… åŠŸèƒ½å®Œå–„ï¼Œç”Ÿæ€å¥½

2. FreeMarkerï¼ˆç‰¹æ®Šåœºæ™¯ï¼‰
   âœ… é‚®ä»¶æ¨¡æ¿
   âœ… æ–‡æ¡£ç”Ÿæˆ
   âœ… ä»£ç ç”Ÿæˆ

è€é¡¹ç›®ç»´æŠ¤ï¼š
â€¢ JSPï¼šåªç»´æŠ¤ï¼Œä¸æ‰©å±•
â€¢ Velocityï¼šè®¡åˆ’è¿ç§»

å‰åç«¯åˆ†ç¦»ï¼š
â€¢ ä¸éœ€è¦æœåŠ¡ç«¯æ¨¡æ¿å¼•æ“
â€¢ åç«¯åªæä¾›API
```

### 8.2 é…ç½®è¦ç‚¹è®°å¿†



**ğŸ”‘ å…³é”®é…ç½®å¯¹æ¯”**ï¼š

| é…ç½®é¡¹ | **Thymeleaf** | **FreeMarker** | **JSP** |
|--------|--------------|----------------|---------|
| **ä¾èµ–** | `spring-boot-starter-thymeleaf` | `spring-boot-starter-freemarker` | `jstl + servlet-api` |
| **æ¨¡æ¿ä½ç½®** | `classpath:/templates/` | `classpath:/templates/` | `/WEB-INF/views/` |
| **æ–‡ä»¶åç¼€** | `.html` | `.ftl` | `.jsp` |
| **ç¼“å­˜é…ç½®** | `spring.thymeleaf.cache` | `spring.freemarker.cache` | `æ— éœ€é…ç½®` |

### 8.3 å®ç”¨æŠ€å·§æ€»ç»“



**ğŸ’¡ å¼€å‘æ•ˆç‡æå‡æŠ€å·§**ï¼š

```
1. æ¨¡æ¿ç‰‡æ®µå¤ç”¨
Thymeleafï¼š
<div th:fragment="header">å…¬å…±å¤´éƒ¨</div>
<div th:replace="~{fragments :: header}"></div>

FreeMarkerï¼š
<#include "header.ftl">

2. æ¡ä»¶æ¸²æŸ“ä¼˜åŒ–
é¿å…ï¼š
<#if user??>
    <#if user.name??>
        ${user.name}
    </#if>
</#if>

æ¨èï¼š
${user.name!'æœªç™»å½•'}

3. å¾ªç¯æ€§èƒ½ä¼˜åŒ–
â€¢ é¿å…åœ¨å¾ªç¯ä¸­æŸ¥è¯¢æ•°æ®åº“
â€¢ æå‰å¤„ç†å¥½æ•°æ®å†ä¼ ç»™æ¨¡æ¿
â€¢ ä½¿ç”¨åˆ†é¡µå‡å°‘æ•°æ®é‡
```

**ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

```
æ¨¡æ¿å±‚ä¼˜åŒ–ï¼š
1. ç”Ÿäº§ç¯å¢ƒå¼€å¯ç¼“å­˜
2. å‡å°‘æ¨¡æ¿ä¸­çš„å¤æ‚é€»è¾‘
3. é™æ€èµ„æºä½¿ç”¨CDN
4. åˆç†ä½¿ç”¨ç‰‡æ®µç¼“å­˜

æ•°æ®å±‚ä¼˜åŒ–ï¼š
1. Controllerå¤„ç†å¥½æ•°æ®å†ä¼ é€’
2. é¿å…åœ¨æ¨¡æ¿ä¸­åšå¤æ‚è®¡ç®—
3. ä½¿ç”¨DTOä¼ è¾“å¯¹è±¡
4. æ•°æ®é‡å¤§æ—¶è€ƒè™‘åˆ†é¡µ
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³



**â“ é—®é¢˜1ï¼šæ¨¡æ¿ä¿®æ”¹ä¸ç”Ÿæ•ˆ**
```
åŸå› ï¼šç¼“å­˜æœªæ¸…ç†
è§£å†³ï¼š
â€¢ å¼€å‘ç¯å¢ƒï¼šå…³é—­ç¼“å­˜ cache: false
â€¢ ç”Ÿäº§ç¯å¢ƒï¼šé‡å¯åº”ç”¨æˆ–æ‰‹åŠ¨æ¸…ç†ç¼“å­˜
```

**â“ é—®é¢˜2ï¼šä¸­æ–‡ä¹±ç **
```
æ£€æŸ¥ç‚¹ï¼š
1. æ¨¡æ¿æ–‡ä»¶ç¼–ç ï¼ˆUTF-8ï¼‰
2. é…ç½®æ–‡ä»¶ç¼–ç è®¾ç½®
3. HTMLé¡µé¢metaæ ‡ç­¾

spring:
  thymeleaf:
    encoding: UTF-8
    
<meta charset="UTF-8">
```

**â“ é—®é¢˜3ï¼šé™æ€èµ„æº404**
```
æ’æŸ¥æ­¥éª¤ï¼š
1. ç¡®è®¤æ–‡ä»¶ä½ç½®ï¼ˆstaticç›®å½•ä¸‹ï¼‰
2. æ£€æŸ¥è®¿é—®è·¯å¾„ï¼ˆå»æ‰staticå‰ç¼€ï¼‰
3. æŸ¥çœ‹é…ç½®æ˜¯å¦æ­£ç¡®
4. æ¸…ç†æµè§ˆå™¨ç¼“å­˜
```

**â“ é—®é¢˜4ï¼šæ¨¡æ¿è¯­æ³•æŠ¥é”™**
```
Thymeleafä¸¥æ ¼æ¨¡å¼ï¼š
â€¢ HTMLæ ‡ç­¾å¿…é¡»é—­åˆ
â€¢ å±æ€§å€¼å¿…é¡»åŠ å¼•å·
â€¢ ä¸èƒ½æœ‰æœªå®šä¹‰çš„å˜é‡ï¼ˆç”¨?åˆ¤æ–­ï¼‰

å»ºè®®ï¼šä½¿ç”¨IDEæ’ä»¶æ£€æŸ¥è¯­æ³•
```

### 8.5 å­¦ä¹ è·¯çº¿å»ºè®®



**ğŸ“š å¾ªåºæ¸è¿›çš„å­¦ä¹ æ­¥éª¤**ï¼š

```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æŒæ¡ï¼ˆ1-2å‘¨ï¼‰
âœ… ç†è§£MVCä¸­è§†å›¾çš„ä½œç”¨
âœ… å­¦ä¼šé…ç½®Thymeleaf
âœ… æŒæ¡åŸºæœ¬è¯­æ³•ï¼ˆå˜é‡ã€å¾ªç¯ã€æ¡ä»¶ï¼‰
âœ… å®Œæˆç®€å•é¡µé¢å±•ç¤º

ç¬¬äºŒé˜¶æ®µï¼šæ·±å…¥åº”ç”¨ï¼ˆ2-3å‘¨ï¼‰
âœ… å­¦ä¹ ç‰‡æ®µå¤ç”¨
âœ… æŒæ¡URLå¤„ç†
âœ… ç†è§£é™æ€èµ„æºç®¡ç†
âœ… å®ç°å®Œæ•´çš„CRUDé¡µé¢

ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§ï¼ˆ1-2å‘¨ï¼‰
âœ… å­¦ä¹ FreeMarkerï¼ˆé‚®ä»¶æ¨¡æ¿ï¼‰
âœ… æŒæ¡ç¼“å­˜ç­–ç•¥
âœ… æ€§èƒ½ä¼˜åŒ–æŠ€å·§
âœ… é›†æˆå‰ç«¯æ¡†æ¶

å®æˆ˜é¡¹ç›®ï¼š
åšä¸€ä¸ªå®Œæ•´çš„åšå®¢ç³»ç»Ÿæˆ–å•†åŸç³»ç»Ÿ
ç»¼åˆè¿ç”¨æ‰€å­¦çŸ¥è¯†
```

**ğŸ§  è®°å¿†å£è¯€**ï¼š
```
è§†å›¾æŠ€æœ¯é€‰Thymeleafï¼Œè‡ªç„¶æ¨¡æ¿æœ€å‹å¥½
æ¨¡æ¿æ–‡ä»¶æ”¾templatesï¼Œåç¼€htmlä¸ä¼šé”™
å¼€å‘å…³é—­cacheé…ç½®ï¼Œä¿®æ”¹ç«‹å³èƒ½ç”Ÿæ•ˆ
é™æ€èµ„æºæ”¾staticä¸‹ï¼Œè®¿é—®è·¯å¾„å»å‰ç¼€
é‚®ä»¶æ¨¡æ¿ç”¨FreeMarkerï¼ŒåŠŸèƒ½å¼ºå¤§æ˜“é›†æˆ
JSPå¤è‘£è¦æ·˜æ±°ï¼Œæ–°é¡¹ç›®åƒä¸‡åˆ«å†ç”¨
```

**æ ¸å¿ƒç†å¿µ**ï¼š
- è§†å›¾æŠ€æœ¯æ˜¯å±•ç¤ºå±‚çš„åŸºç¡€ï¼Œé€‰å¯¹æŠ€æœ¯å¾ˆé‡è¦
- Thymeleafæ˜¯ç°ä»£Springé¡¹ç›®çš„é¦–é€‰
- å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®è¦åŒºåˆ†
- æ€§èƒ½ä¼˜åŒ–ä»ç¼“å­˜å¼€å§‹
- æ¨¡æ¿åªè´Ÿè´£å±•ç¤ºï¼Œå¤æ‚é€»è¾‘æ”¾Controller