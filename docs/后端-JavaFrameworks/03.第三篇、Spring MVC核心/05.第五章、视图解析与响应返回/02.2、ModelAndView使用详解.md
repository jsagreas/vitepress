---
title: 2ã€ModelAndViewä½¿ç”¨è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [ModelAndViewæ ¸å¿ƒæ¦‚å¿µ](#1-modelandviewæ ¸å¿ƒæ¦‚å¿µ)
2. [Modelæ¥å£è¯¦è§£](#2-modelæ¥å£è¯¦è§£)
3. [ModelMapæ·±å…¥ç†è§£](#3-modelmapæ·±å…¥ç†è§£)
4. [ModelAndViewå®æˆ˜åº”ç”¨](#4-modelandviewå®æˆ˜åº”ç”¨)
5. [@ModelAttributeæ³¨è§£](#5-modelattributeæ³¨è§£)
6. [æ•°æ®ä¼ é€’æœ€ä½³å®è·µ](#6-æ•°æ®ä¼ é€’æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ModelAndViewæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ModelAndView


**ç®€å•ç†è§£**ï¼šModelAndView å°±åƒä¸€ä¸ª"å¿«é€’åŒ…è£¹"ï¼Œé‡Œé¢æ—¢è£…ç€**æ•°æ®ï¼ˆModelï¼‰**ï¼Œåˆå†™ç€**æ”¶è´§åœ°å€ï¼ˆViewï¼‰**ã€‚

```
çœŸå®åœºæ™¯ç±»æ¯”ï¼š
ç½‘ä¸Šè´­ç‰© = Spring MVCå¤„ç†è¯·æ±‚
â”œâ”€ å•†å“ï¼ˆæ•°æ®ï¼‰ = Modelï¼ˆæ¨¡å‹æ•°æ®ï¼‰
â”œâ”€ æ”¶è´§åœ°å€ = Viewï¼ˆè§†å›¾åç§°ï¼‰
â””â”€ å¿«é€’åŒ…è£¹ = ModelAndViewï¼ˆæ‰“åŒ…åœ¨ä¸€èµ·ï¼‰
```

**ä¸“ä¸šå®šä¹‰**ï¼š
> ModelAndView æ˜¯ Spring MVC ä¸­ç”¨äº**åŒæ—¶æºå¸¦æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯**çš„å®¹å™¨ç±»ï¼Œå®ƒå°†Controllerå¤„ç†çš„ç»“æœæ•°æ®å’Œè¦æ¸²æŸ“çš„è§†å›¾åç§°å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **æ•°æ®ä¼ é€’**ï¼šæŠŠåç«¯å¤„ç†çš„æ•°æ®ä¼ ç»™å‰ç«¯é¡µé¢
- ğŸ”¸ **è§†å›¾æŒ‡å®š**ï¼šå‘Šè¯‰æ¡†æ¶è¦è·³è½¬åˆ°å“ªä¸ªé¡µé¢
- ğŸ”¸ **è§£è€¦è®¾è®¡**ï¼šè®©æ•°æ®å’Œè§†å›¾åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ModelAndView


**é—®é¢˜åœºæ™¯**ï¼š
```
ç”¨æˆ·è®¿é—®å•†å“è¯¦æƒ…é¡µï¼š
1. ControlleræŸ¥è¯¢å•†å“ä¿¡æ¯ï¼ˆæ•°æ®å¤„ç†ï¼‰
2. æŠŠå•†å“æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼ˆè§†å›¾å±•ç¤ºï¼‰

ä¼ ç»Ÿåšæ³•ï¼š
response.getWriter().write("<html>å•†å“åï¼šæ‰‹æœº</html>")
âŒ é—®é¢˜ï¼šæ•°æ®å’ŒHTMLæ··åœ¨ä¸€èµ·ï¼Œéš¾ä»¥ç»´æŠ¤

Spring MVCæ–¹å¼ï¼š
æŠŠæ•°æ®è£…è¿›ModelAndViewï¼ŒæŒ‡å®šè·³è½¬åˆ°å•†å“è¯¦æƒ…é¡µ
âœ… ä¼˜åŠ¿ï¼šæ•°æ®å’Œé¡µé¢åˆ†ç¦»ï¼Œå„å¸å…¶èŒ
```

### 1.3 ModelAndViewçš„åŸºæœ¬ç»“æ„


**å†…éƒ¨ç»„æˆ**ï¼š
```
ModelAndView
â”œâ”€ Modeléƒ¨åˆ†ï¼ˆæ¨¡å‹æ•°æ®ï¼‰
â”‚  â””â”€ Map<String, Object> å­˜å‚¨é”®å€¼å¯¹æ•°æ®
â”‚
â””â”€ Viewéƒ¨åˆ†ï¼ˆè§†å›¾ä¿¡æ¯ï¼‰
   â””â”€ String viewName æˆ– Viewå¯¹è±¡
```

**å·¥ä½œæµç¨‹å›¾ç¤º**ï¼š
```
Controllerå¤„ç†è¯·æ±‚
      â†“
åˆ›å»ºModelAndViewå¯¹è±¡
      â†“
æ·»åŠ æ•°æ®åˆ°Model: addObject("key", value)
      â†“
è®¾ç½®è§†å›¾åç§°: setViewName("productDetail")
      â†“
è¿”å›ç»™DispatcherServlet
      â†“
ViewResolverè§£æè§†å›¾
      â†“
æ¸²æŸ“é¡µé¢å¹¶æ˜¾ç¤ºæ•°æ®
```

---

## 2. ğŸ“¦ Modelæ¥å£è¯¦è§£


### 2.1 Modelæ¥å£æ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šModel å°±åƒä¸€ä¸ª**é€æ˜çš„æ•°æ®è¢‹**ï¼Œä½ å¾€é‡Œé¢æ”¾ä»€ä¹ˆæ•°æ®ï¼Œå‰ç«¯é¡µé¢å°±èƒ½çœ‹åˆ°ä»€ä¹ˆã€‚

**æ¥å£å®šä¹‰**ï¼š
```java
public interface Model {
    // æ·»åŠ å•ä¸ªå±æ€§
    Model addAttribute(String name, Object value);
    
    // æ·»åŠ å¤šä¸ªå±æ€§
    Model addAllAttributes(Map<String, ?> attributes);
    
    // å…¶ä»–æ–¹æ³•...
}
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šModelæ˜¯ä¸€ä¸ªæ¥å£ï¼ˆè§„èŒƒï¼‰ï¼ŒModelMapã€ModelAndViewéƒ½å®ç°äº†è¿™ä¸ªè§„èŒƒ

### 2.2 Modelçš„ä¸‰ç§ä½¿ç”¨æ–¹å¼


**æ–¹å¼ä¸€ï¼šç›´æ¥æ³¨å…¥Modelå‚æ•°**
```java
@GetMapping("/user/info")
public String getUserInfo(Model model) {
    // Springè‡ªåŠ¨åˆ›å»ºModelå¯¹è±¡å¹¶æ³¨å…¥
    model.addAttribute("username", "å¼ ä¸‰");
    model.addAttribute("age", 25);
    
    return "userInfo"; // åªè¿”å›è§†å›¾å
}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨Mapä½œä¸ºModel**
```java
@GetMapping("/product/list")
public String getProducts(Map<String, Object> model) {
    // Mapæœ¬è´¨ä¸Šä¹Ÿæ˜¯Modelçš„ä¸€ç§è¡¨ç°
    model.put("products", productList);
    model.put("total", 100);
    
    return "productList";
}
```

**æ–¹å¼ä¸‰ï¼šè¿”å›ModelAndView**
```java
@GetMapping("/order/detail")
public ModelAndView getOrderDetail() {
    ModelAndView mav = new ModelAndView();
    mav.addObject("orderId", "202401001");
    mav.addObject("status", "å·²å‘è´§");
    mav.setViewName("orderDetail");
    
    return mav; // åŒæ—¶è¿”å›æ•°æ®å’Œè§†å›¾
}
```

### 2.3 Model vs Map vs ModelMap


| å¯¹æ¯”é¡¹ | **Modelæ¥å£** | **Mapæ¥å£** | **ModelMapç±»** |
|--------|--------------|-------------|----------------|
| **æœ¬è´¨** | `æ¥å£è§„èŒƒ` | `JDKåŸç”Ÿé›†åˆ` | `Modelçš„å®ç°ç±»` |
| **ä½¿ç”¨åœºæ™¯** | `Springæ¨èæ–¹å¼` | `é€šç”¨æ•°æ®å­˜å‚¨` | `åŠŸèƒ½æ›´ä¸°å¯Œçš„Model` |
| **æ•°æ®ç±»å‹** | `é”®å€¼å¯¹` | `é”®å€¼å¯¹` | `é”®å€¼å¯¹ + é“¾å¼è°ƒç”¨` |
| **æ¨èåº¦** | `â­â­â­â­â­` | `â­â­â­` | `â­â­â­â­` |

**é€‰æ‹©å»ºè®®**ï¼š
- ğŸ”¸ **æ–°æ‰‹é¦–é€‰**ï¼šä½¿ç”¨ `Model` æ¥å£ï¼ŒSpringå®˜æ–¹æ¨è
- ğŸ”¸ **çµæ´»åœºæ™¯**ï¼šä½¿ç”¨ `Map`ï¼Œå…¼å®¹æ€§å¥½
- ğŸ”¸ **é«˜çº§åŠŸèƒ½**ï¼šä½¿ç”¨ `ModelMap`ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨

---

## 3. ğŸ—‚ï¸ ModelMapæ·±å…¥ç†è§£


### 3.1 ModelMapæ˜¯ä»€ä¹ˆ


**ç»§æ‰¿å…³ç³»**ï¼š
```
LinkedHashMap (JDK)
       â†‘
   ModelMap (Spring)
       â†‘
ExtendedModelMap (Springå†…éƒ¨ä½¿ç”¨)
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… ç»§æ‰¿è‡ªLinkedHashMapï¼Œä¿è¯**æ’å…¥é¡ºåº**
- âœ… å®ç°äº†Modelæ¥å£ï¼Œç¬¦åˆSpringè§„èŒƒ
- âœ… æ”¯æŒ**é“¾å¼è°ƒç”¨**ï¼Œä»£ç æ›´ä¼˜é›…

### 3.2 ModelMapçš„ç‹¬ç‰¹ä¼˜åŠ¿


**ä¼˜åŠ¿1ï¼šé“¾å¼è°ƒç”¨**
```java
@GetMapping("/dashboard")
public String dashboard(ModelMap modelMap) {
    // ä¼ ç»Ÿå†™æ³•
    modelMap.addAttribute("user", user);
    modelMap.addAttribute("notifications", notifyList);
    modelMap.addAttribute("messages", msgList);
    
    // é“¾å¼å†™æ³•ï¼ˆæ›´ä¼˜é›…ï¼‰
    modelMap.addAttribute("user", user)
             .addAttribute("notifications", notifyList)
             .addAttribute("messages", msgList);
    
    return "dashboard";
}
```

**ä¼˜åŠ¿2ï¼šæœ‰åºæ€§ä¿è¯**
```java
// LinkedHashMapç‰¹æ€§ï¼šæŒ‰æ·»åŠ é¡ºåºå­˜å‚¨
modelMap.addAttribute("first", "ç¬¬ä¸€ä¸ª");
modelMap.addAttribute("second", "ç¬¬äºŒä¸ª");
modelMap.addAttribute("third", "ç¬¬ä¸‰ä¸ª");

// å‰ç«¯éå†æ—¶é¡ºåºå›ºå®šï¼šfirst â†’ second â†’ third
```

**ä¼˜åŠ¿3ï¼šç±»å‹å®‰å…¨**
```java
// ç›´æ¥ä½¿ç”¨Map
Map<String, Object> map = new HashMap<>();
map.put("age", "25"); // å¯èƒ½è¯¯å­˜å­—ç¬¦ä¸²

// ä½¿ç”¨ModelMap
ModelMap modelMap = new ModelMap();
modelMap.addAttribute("age", 25); // æ˜ç¡®çš„ç±»å‹
```

### 3.3 å®é™…åº”ç”¨ç¤ºä¾‹


**åœºæ™¯ï¼šç”¨æˆ·ä¸ªäººä¸­å¿ƒé¡µé¢**
```java
@Controller
@RequestMapping("/user")
public class UserController {
    
    @GetMapping("/center")
    public String userCenter(ModelMap modelMap, HttpSession session) {
        // 1. è·å–å½“å‰ç”¨æˆ·
        User currentUser = (User) session.getAttribute("user");
        
        // 2. å‡†å¤‡å±•ç¤ºæ•°æ®ï¼ˆé“¾å¼è°ƒç”¨ï¼‰
        modelMap.addAttribute("user", currentUser)
                .addAttribute("orderCount", orderService.countByUser(currentUser.getId()))
                .addAttribute("couponCount", couponService.countByUser(currentUser.getId()))
                .addAttribute("recentOrders", orderService.getRecent(currentUser.getId(), 5));
        
        // 3. è¿”å›è§†å›¾
        return "user/center";
    }
}
```

---

## 4. ğŸš€ ModelAndViewå®æˆ˜åº”ç”¨


### 4.1 ModelAndViewçš„ä¸‰ç§åˆ›å»ºæ–¹å¼


**æ–¹å¼1ï¼šæ— å‚æ„é€ å™¨ï¼ˆæœ€å¸¸ç”¨ï¼‰**
```java
@GetMapping("/product/{id}")
public ModelAndView getProduct(@PathVariable Long id) {
    ModelAndView mav = new ModelAndView();
    
    // å…ˆæŸ¥è¯¢æ•°æ®
    Product product = productService.findById(id);
    
    // æ·»åŠ æ•°æ®
    mav.addObject("product", product);
    mav.addObject("reviews", reviewService.findByProduct(id));
    
    // è®¾ç½®è§†å›¾
    mav.setViewName("product/detail");
    
    return mav;
}
```

**æ–¹å¼2ï¼šæŒ‡å®šè§†å›¾åæ„é€ **
```java
@GetMapping("/cart")
public ModelAndView showCart(HttpSession session) {
    // åˆ›å»ºæ—¶ç›´æ¥æŒ‡å®šè§†å›¾å
    ModelAndView mav = new ModelAndView("cart/show");
    
    // åªéœ€æ·»åŠ æ•°æ®
    List<CartItem> items = (List<CartItem>) session.getAttribute("cart");
    mav.addObject("items", items);
    mav.addObject("total", calculateTotal(items));
    
    return mav;
}
```

**æ–¹å¼3ï¼šåŒæ—¶æŒ‡å®šè§†å›¾å’Œæ•°æ®**
```java
@GetMapping("/search")
public ModelAndView search(@RequestParam String keyword) {
    List<Product> results = productService.search(keyword);
    
    // ä¸€æ­¥åˆ°ä½
    return new ModelAndView("search/result", "products", results);
    // å‚æ•°è¯´æ˜ï¼šè§†å›¾å, æ•°æ®key, æ•°æ®value
}
```

### 4.2 æ•°æ®ä¼ é€’çš„å¤šç§æ–¹å¼


**ä¼ é€’å•ä¸ªå¯¹è±¡**ï¼š
```java
@GetMapping("/article/{id}")
public ModelAndView getArticle(@PathVariable Long id) {
    ModelAndView mav = new ModelAndView("article/view");
    
    Article article = articleService.findById(id);
    mav.addObject("article", article);
    
    return mav;
}
```

**ä¼ é€’å¤šä¸ªå¯¹è±¡**ï¼š
```java
@GetMapping("/order/{orderId}")
public ModelAndView orderDetail(@PathVariable String orderId) {
    ModelAndView mav = new ModelAndView("order/detail");
    
    // æ–¹å¼1ï¼šé€ä¸ªæ·»åŠ 
    mav.addObject("order", orderService.findById(orderId));
    mav.addObject("items", orderItemService.findByOrder(orderId));
    mav.addObject("logistics", logisticsService.findByOrder(orderId));
    
    // æ–¹å¼2ï¼šæ‰¹é‡æ·»åŠ ï¼ˆä½¿ç”¨Mapï¼‰
    Map<String, Object> data = new HashMap<>();
    data.put("order", order);
    data.put("items", items);
    data.put("logistics", logistics);
    mav.addAllObjects(data);
    
    return mav;
}
```

**ä¼ é€’é›†åˆæ•°æ®**ï¼š
```java
@GetMapping("/category/{id}/products")
public ModelAndView categoryProducts(@PathVariable Long id) {
    ModelAndView mav = new ModelAndView("category/products");
    
    // ä¼ é€’Listé›†åˆ
    List<Product> products = productService.findByCategory(id);
    mav.addObject("products", products);
    
    // ä¼ é€’åˆ†é¡µä¿¡æ¯
    mav.addObject("pageNum", 1);
    mav.addObject("pageSize", 20);
    mav.addObject("total", products.size());
    
    return mav;
}
```

### 4.3 è§†å›¾åç§°æŒ‡å®šè¯¦è§£


**ç›¸å¯¹è·¯å¾„æŒ‡å®š**ï¼š
```java
// è§†å›¾è§£æå™¨é…ç½®ï¼šprefix=/WEB-INF/views/, suffix=.jsp

// 1. è¿”å› "user/list" â†’ è§£æä¸º /WEB-INF/views/user/list.jsp
mav.setViewName("user/list");

// 2. è¿”å› "product/detail" â†’ è§£æä¸º /WEB-INF/views/product/detail.jsp
mav.setViewName("product/detail");

// 3. è¿”å› "index" â†’ è§£æä¸º /WEB-INF/views/index.jsp
mav.setViewName("index");
```

**é‡å®šå‘å’Œè½¬å‘**ï¼š
```java
@PostMapping("/login")
public ModelAndView login(String username, String password) {
    ModelAndView mav = new ModelAndView();
    
    if (userService.validate(username, password)) {
        // ç™»å½•æˆåŠŸï¼šé‡å®šå‘åˆ°é¦–é¡µï¼ˆåœ°å€æ å˜åŒ–ï¼‰
        mav.setViewName("redirect:/index");
    } else {
        // ç™»å½•å¤±è´¥ï¼šè½¬å‘åˆ°ç™»å½•é¡µï¼ˆåœ°å€æ ä¸å˜ï¼‰
        mav.setViewName("forward:/login");
        mav.addObject("error", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }
    
    return mav;
}
```

**åŒºåˆ«å¯¹æ¯”**ï¼š

| æ–¹å¼ | **å…³é”®å­—** | **åœ°å€æ ** | **æ•°æ®ä¿ç•™** | **ä½¿ç”¨åœºæ™¯** |
|------|-----------|-----------|-------------|-------------|
| **æ™®é€šè·³è½¬** | `æ— ` | `ä¸å˜` | `ä¿ç•™` | `å±•ç¤ºé¡µé¢` |
| **é‡å®šå‘** | `redirect:` | `æ”¹å˜` | `ä¸ä¿ç•™` | `æ“ä½œæˆåŠŸåè·³è½¬` |
| **è½¬å‘** | `forward:` | `ä¸å˜` | `ä¿ç•™` | `å†…éƒ¨è·³è½¬ï¼Œæ•°æ®ä¼ é€’` |

---

## 5. ğŸ·ï¸ @ModelAttributeæ³¨è§£


### 5.1 @ModelAttributeæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼š`@ModelAttribute` å°±åƒä¸€ä¸ª**æå‰å‡†å¤‡çš„æœåŠ¡å‘˜**ï¼Œåœ¨Controlleræ–¹æ³•æ‰§è¡Œå‰ï¼Œå…ˆæŠŠéœ€è¦çš„æ•°æ®å‡†å¤‡å¥½ã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **é¢„å¤„ç†æ•°æ®**ï¼šåœ¨è¯·æ±‚å¤„ç†å‰è‡ªåŠ¨æ‰§è¡Œ
- ğŸ”¸ **æ•°æ®ç»‘å®š**ï¼šè‡ªåŠ¨ç»‘å®šè¡¨å•æ•°æ®åˆ°å¯¹è±¡
- ğŸ”¸ **å…¨å±€æ•°æ®**ï¼šä¸ºå¤šä¸ªæ–¹æ³•æä¾›å…¬å…±æ•°æ®

### 5.2 @ModelAttributeçš„ä¸‰ç§ç”¨æ³•


**ç”¨æ³•1ï¼šåœ¨æ–¹æ³•ä¸Šï¼ˆæ•°æ®é¢„å¤„ç†ï¼‰**
```java
@Controller
@RequestMapping("/blog")
public class BlogController {
    
    // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ‰€æœ‰è¯·æ±‚å¤„ç†æ–¹æ³•ä¹‹å‰æ‰§è¡Œ
    @ModelAttribute("categories")
    public List<Category> loadCategories() {
        // æ¯æ¬¡è¯·æ±‚éƒ½è‡ªåŠ¨åŠ è½½åˆ†ç±»åˆ—è¡¨
        return categoryService.findAll();
    }
    
    @GetMapping("/new")
    public String newBlog(Model model) {
        // categorieså·²ç»è‡ªåŠ¨æ·»åŠ åˆ°modelä¸­
        // å‰ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨ ${categories}
        return "blog/new";
    }
    
    @GetMapping("/edit/{id}")
    public String editBlog(@PathVariable Long id, Model model) {
        model.addAttribute("blog", blogService.findById(id));
        // categoriesä¹Ÿå·²ç»è‡ªåŠ¨æ·»åŠ 
        return "blog/edit";
    }
}
```

**ç”¨æ³•2ï¼šåœ¨å‚æ•°ä¸Šï¼ˆè¡¨å•ç»‘å®šï¼‰**
```java
@Controller
@RequestMapping("/user")
public class UserController {
    
    @PostMapping("/register")
    public String register(@ModelAttribute("user") User user, Model model) {
        // Springè‡ªåŠ¨å°†è¡¨å•æ•°æ®ç»‘å®šåˆ°Userå¯¹è±¡
        // å‰ç«¯è¡¨å•ï¼š<input name="username" /> â†’ user.username
        //         <input name="email" /> â†’ user.email
        
        userService.save(user);
        model.addAttribute("message", "æ³¨å†ŒæˆåŠŸ");
        
        return "register/success";
    }
}
```

**å‰ç«¯è¡¨å•ç¤ºä¾‹**ï¼š
```html
<form action="/user/register" method="post">
    <input type="text" name="username" placeholder="ç”¨æˆ·å" />
    <input type="email" name="email" placeholder="é‚®ç®±" />
    <input type="password" name="password" placeholder="å¯†ç " />
    <button type="submit">æ³¨å†Œ</button>
</form>

<!-- Springä¼šè‡ªåŠ¨åˆ›å»ºUserå¯¹è±¡ï¼š
     user.setUsername(è¡¨å•çš„usernameå€¼);
     user.setEmail(è¡¨å•çš„emailå€¼);
     user.setPassword(è¡¨å•çš„passwordå€¼);
-->
```

**ç”¨æ³•3ï¼šç»“åˆå¤šä¸ªæ³¨è§£ï¼ˆé«˜çº§ç”¨æ³•ï¼‰**
```java
@Controller
@RequestMapping("/product")
public class ProductController {
    
    // å…¨å±€æ•°æ®ï¼šæ‰€æœ‰æ–¹æ³•éƒ½èƒ½ç”¨
    @ModelAttribute("brands")
    public List<Brand> loadBrands() {
        return brandService.findAll();
    }
    
    @PostMapping("/save")
    public String saveProduct(
        @ModelAttribute("product") Product product,  // è¡¨å•ç»‘å®š
        @RequestParam("categoryId") Long categoryId, // é¢å¤–å‚æ•°
        RedirectAttributes redirectAttributes         // é‡å®šå‘ä¼ å€¼
    ) {
        product.setCategoryId(categoryId);
        productService.save(product);
        
        redirectAttributes.addFlashAttribute("message", "ä¿å­˜æˆåŠŸ");
        return "redirect:/product/list";
    }
}
```

### 5.3 @ModelAttributeæ‰§è¡Œæ—¶æœº


**æ‰§è¡Œæµç¨‹**ï¼š
```
ç”¨æˆ·è¯·æ±‚åˆ°è¾¾
      â†“
DispatcherServletæ¥æ”¶
      â†“
æ‰¾åˆ°å¯¹åº”çš„Controller
      â†“
â‘  å…ˆæ‰§è¡Œ@ModelAttributeæ–¹æ³•ï¼ˆé¢„å¤„ç†ï¼‰
      â†“
â‘¡ å†æ‰§è¡Œ@RequestMappingæ–¹æ³•ï¼ˆå¤„ç†è¯·æ±‚ï¼‰
      â†“
è¿”å›ModelAndView
      â†“
æ¸²æŸ“è§†å›¾
```

**å®é™…ç¤ºä¾‹**ï¼š
```java
@Controller
@RequestMapping("/order")
public class OrderController {
    
    // â‘  æœ€å…ˆæ‰§è¡Œï¼šå‡†å¤‡å…¨å±€æ•°æ®
    @ModelAttribute
    public void prepareCommonData(Model model, HttpSession session) {
        User currentUser = (User) session.getAttribute("user");
        model.addAttribute("currentUser", currentUser);
        model.addAttribute("cartCount", cartService.count(currentUser.getId()));
    }
    
    // â‘¡ éšåæ‰§è¡Œï¼šå¤„ç†å…·ä½“è¯·æ±‚
    @GetMapping("/create")
    public String createOrder(Model model) {
        // currentUser å’Œ cartCount å·²ç»åœ¨ model ä¸­äº†
        model.addAttribute("addresses", addressService.findByUser());
        return "order/create";
    }
    
    @GetMapping("/history")
    public String orderHistory(Model model) {
        // currentUser å’Œ cartCount åœ¨è¿™é‡Œä¹Ÿèƒ½ç”¨
        model.addAttribute("orders", orderService.findByUser());
        return "order/history";
    }
}
```

---

## 6. ğŸ’¡ æ•°æ®ä¼ é€’æœ€ä½³å®è·µ


### 6.1 é€‰æ‹©åˆé€‚çš„è¿”å›æ–¹å¼


**åœºæ™¯1ï¼šåªè¿”å›è§†å›¾å**
```java
// âœ… é€‚ç”¨ï¼šç®€å•é¡µé¢è·³è½¬ï¼Œæ•°æ®å°‘
@GetMapping("/about")
public String about(Model model) {
    model.addAttribute("title", "å…³äºæˆ‘ä»¬");
    return "about";
}
```

**åœºæ™¯2ï¼šè¿”å›ModelAndView**
```java
// âœ… é€‚ç”¨ï¼šæ•°æ®å’Œè§†å›¾éœ€è¦ç»Ÿä¸€ç®¡ç†
@GetMapping("/report/{id}")
public ModelAndView report(@PathVariable Long id) {
    ModelAndView mav = new ModelAndView("report/view");
    mav.addObject("data", reportService.generate(id));
    mav.addObject("charts", chartService.generate(id));
    return mav;
}
```

**åœºæ™¯3ï¼šè¿”å›JSONæ•°æ®**
```java
// âœ… é€‚ç”¨ï¼šå‰åç«¯åˆ†ç¦»ï¼ŒAJAXè¯·æ±‚
@GetMapping("/api/products")
@ResponseBody
public List<Product> getProducts() {
    return productService.findAll();
    // Springè‡ªåŠ¨è½¬ä¸ºJSONè¿”å›
}
```

### 6.2 æ•°æ®å‘½åè§„èŒƒ


**è§„èŒƒå»ºè®®**ï¼š
```java
// âŒ ä¸å¥½çš„å‘½å
mav.addObject("data", product);        // å¤ªæ³›
mav.addObject("x", userList);          // æ— æ„ä¹‰
mav.addObject("ProductList", list);    // å¤§å†™å¼€å¤´

// âœ… å¥½çš„å‘½å
mav.addObject("product", product);           // æ¸…æ™°
mav.addObject("userList", userList);         // è§åçŸ¥ä¹‰
mav.addObject("recommendProducts", list);    // æè¿°å‡†ç¡®
```

**å‰ç«¯ä½¿ç”¨å¯¹ç…§**ï¼š
```html
<!-- åç«¯ï¼šmav.addObject("product", product); -->
<h1>${product.name}</h1>
<p>ä»·æ ¼ï¼š${product.price}</p>

<!-- åç«¯ï¼šmav.addObject("userList", users); -->
<c:forEach items="${userList}" var="user">
    <div>${user.name}</div>
</c:forEach>
```

### 6.3 é¿å…å¸¸è§é”™è¯¯


**é”™è¯¯1ï¼šé‡å¤æ·»åŠ æ•°æ®**
```java
// âŒ é”™è¯¯ç¤ºä¾‹
@GetMapping("/home")
public ModelAndView home(Model model) {
    ModelAndView mav = new ModelAndView("home");
    
    // Model å’Œ ModelAndView éƒ½æ·»åŠ äº†ï¼Œé‡å¤äº†ï¼
    model.addAttribute("user", user);
    mav.addObject("user", user);
    
    return mav;
}

// âœ… æ­£ç¡®åšæ³•ï¼šäºŒé€‰ä¸€
// æ–¹å¼1ï¼šåªç”¨Model
@GetMapping("/home")
public String home(Model model) {
    model.addAttribute("user", user);
    return "home";
}

// æ–¹å¼2ï¼šåªç”¨ModelAndView
@GetMapping("/home")
public ModelAndView home() {
    ModelAndView mav = new ModelAndView("home");
    mav.addObject("user", user);
    return mav;
}
```

**é”™è¯¯2ï¼šè§†å›¾åæ‹¼å†™é”™è¯¯**
```java
// âŒ å¸¸è§é”™è¯¯
mav.setViewName("prodcut/detail");  // prodcutæ‹¼å†™é”™è¯¯
mav.setViewName("/product/detail"); // å¤šäº†å‰å¯¼æ–œæ 
mav.setViewName("product\\detail"); // ç”¨äº†åæ–œæ 

// âœ… æ­£ç¡®å†™æ³•
mav.setViewName("product/detail");  // ç”¨æ­£æ–œæ ï¼Œæ— å‰å¯¼æ–œæ 
```

**é”™è¯¯3ï¼šæ•°æ®ç±»å‹ä¸åŒ¹é…**
```java
// âŒ é”™è¯¯ï¼šå‰ç«¯éœ€è¦æ•°å­—ï¼Œä¼ äº†å­—ç¬¦ä¸²
mav.addObject("age", "25");  // å­—ç¬¦ä¸²
// å‰ç«¯ï¼š<c:if test="${age > 18}"> å¯èƒ½å‡ºé”™

// âœ… æ­£ç¡®ï¼šä¼ å¯¹åº”ç±»å‹
mav.addObject("age", 25);    // æ•´æ•°
```

### 6.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**ä¼˜åŒ–1ï¼šé¿å…æŸ¥è¯¢å†—ä½™**
```java
// âŒ ä¸å¥½ï¼šé‡å¤æŸ¥è¯¢
@GetMapping("/order/detail/{id}")
public ModelAndView orderDetail(@PathVariable Long id) {
    ModelAndView mav = new ModelAndView("order/detail");
    
    Order order = orderService.findById(id);
    mav.addObject("order", order);
    
    // åˆæŸ¥äº†ä¸€æ¬¡è®¢å•ï¼
    List<OrderItem> items = orderItemService.findByOrder(id);
    mav.addObject("items", items);
    
    return mav;
}

// âœ… ä¼˜åŒ–ï¼šä¸€æ¬¡æŸ¥è¯¢è·å–å…³è”æ•°æ®
@GetMapping("/order/detail/{id}")
public ModelAndView orderDetail(@PathVariable Long id) {
    ModelAndView mav = new ModelAndView("order/detail");
    
    // ä¸€æ¬¡æ€§è·å–è®¢å•å’Œè®¢å•é¡¹
    OrderDetailVO orderDetail = orderService.findDetailById(id);
    mav.addObject("orderDetail", orderDetail);
    
    return mav;
}
```

**ä¼˜åŒ–2ï¼šåˆç†ä½¿ç”¨@ModelAttribute**
```java
// âœ… å¥½çš„å®è·µï¼šå…¨å±€æ•°æ®ç”¨@ModelAttribute
@Controller
public class BaseController {
    
    @ModelAttribute
    public void addCommonData(Model model) {
        // æ‰€æœ‰é¡µé¢éƒ½éœ€è¦çš„æ•°æ®ï¼Œç»Ÿä¸€å‡†å¤‡
        model.addAttribute("siteName", "æˆ‘çš„å•†åŸ");
        model.addAttribute("year", LocalDate.now().getYear());
    }
}

// å­Controllerç»§æ‰¿ï¼Œè‡ªåŠ¨è·å¾—è¿™äº›æ•°æ®
@Controller
@RequestMapping("/product")
public class ProductController extends BaseController {
    
    @GetMapping("/list")
    public String list() {
        // siteName å’Œ year å·²ç»è‡ªåŠ¨æ·»åŠ åˆ°model
        return "product/list";
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ModelAndViewä¸‰è¦ç´ **ï¼š
```
ğŸ”¸ Modelï¼ˆæ•°æ®ï¼‰ï¼šè¦ä¼ é€’ç»™å‰ç«¯çš„ä¿¡æ¯
ğŸ”¸ Viewï¼ˆè§†å›¾ï¼‰ï¼šè¦è·³è½¬çš„é¡µé¢åç§°
ğŸ”¸ æ•°æ®ç»‘å®šï¼šè‡ªåŠ¨å°†æ•°æ®æ³¨å…¥åˆ°é¡µé¢
```

**å…³é”®æ¥å£å’Œç±»**ï¼š
- **Modelæ¥å£**ï¼šSpringæ¨èçš„æ•°æ®ä¼ é€’è§„èŒƒ
- **ModelMapç±»**ï¼šModelçš„å®ç°ç±»ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
- **ModelAndViewç±»**ï¼šæ•°æ®å’Œè§†å›¾çš„ç»Ÿä¸€å®¹å™¨

### 7.2 å®é™…åº”ç”¨åœºæ™¯æ€»ç»“


| åœºæ™¯ | **æ¨èæ–¹å¼** | **ç¤ºä¾‹ä»£ç ** |
|------|-------------|-------------|
| **ç®€å•å±•ç¤º** | `Model + String` | `model.addAttribute("data", obj); return "view";` |
| **å¤æ‚æ•°æ®** | `ModelAndView` | `mav.addObject("data", obj); mav.setViewName("view");` |
| **è¡¨å•ç»‘å®š** | `@ModelAttribute` | `public String save(@ModelAttribute User user)` |
| **å…¨å±€æ•°æ®** | `@ModelAttributeæ–¹æ³•` | `@ModelAttribute public void init(Model m)` |
| **å‰åç«¯åˆ†ç¦»** | `@ResponseBody` | `@ResponseBody return data;` |

### 7.3 å­¦ä¹ æ£€æŸ¥æ¸…å•


**åŸºç¡€éƒ¨åˆ†**ï¼š
- [ ] ç†è§£ModelAndViewçš„ä½œç”¨å’Œç»„æˆ
- [ ] æŒæ¡Modelæ¥å£çš„ä½¿ç”¨æ–¹æ³•
- [ ] äº†è§£ModelMapçš„ç‰¹ç‚¹å’Œä¼˜åŠ¿
- [ ] èƒ½å¤Ÿæ­£ç¡®è®¾ç½®è§†å›¾åç§°

**è¿›é˜¶éƒ¨åˆ†**ï¼š
- [ ] ç†Ÿç»ƒä½¿ç”¨@ModelAttributeè¿›è¡Œæ•°æ®é¢„å¤„ç†
- [ ] ç†è§£é‡å®šå‘å’Œè½¬å‘çš„åŒºåˆ«
- [ ] æŒæ¡è¡¨å•æ•°æ®è‡ªåŠ¨ç»‘å®šæœºåˆ¶
- [ ] èƒ½å¤Ÿé€‰æ‹©åˆé€‚çš„æ•°æ®ä¼ é€’æ–¹å¼

**å®æˆ˜éƒ¨åˆ†**ï¼š
- [ ] èƒ½ç‹¬ç«‹å®Œæˆå¢åˆ æ”¹æŸ¥çš„æ•°æ®ä¼ é€’
- [ ] ä¼šå¤„ç†å¤æ‚å¯¹è±¡å’Œé›†åˆæ•°æ®
- [ ] äº†è§£å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ³•
- [ ] æŒæ¡æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 7.4 è®°å¿†è¦ç‚¹


**æ ¸å¿ƒå£è¯€**ï¼š
> ğŸ“ **ModelAndViewæ•°æ®è§†å›¾åŒ…ï¼ŒModelæ¥å£æ•°æ®ä¼ ï¼Œ**
> **ModelMapé“¾å¼æ›´çµæ´»ï¼Œ@ModelAttributeé¢„å¤„ç†ï¼Œ**
> **è§†å›¾åç§°è¦è§„èŒƒï¼Œé‡å®šå‘è½¬å‘è¦åˆ†æ¸…ã€‚**

**å…³é”®ç†è§£**ï¼š
- ModelAndView = Modelï¼ˆæ•°æ®ï¼‰ + Viewï¼ˆè§†å›¾ï¼‰
- Model æ˜¯æ¥å£ï¼ŒModelMap æ˜¯å®ç°ç±»
- @ModelAttribute å…ˆæ‰§è¡Œï¼Œä¸ºæ–¹æ³•å‡†å¤‡æ•°æ®
- å‰ç«¯é€šè¿‡ `${key}` è·å–åç«¯ä¼ é€’çš„æ•°æ®

**å®æˆ˜å¿ƒå¾—**ï¼š
- âœ… ç®€å•åœºæ™¯ç”¨ Modelï¼Œå¤æ‚åœºæ™¯ç”¨ ModelAndView
- âœ… è¡¨å•æäº¤ä¼˜å…ˆè€ƒè™‘ @ModelAttribute è‡ªåŠ¨ç»‘å®š
- âœ… å…¨å±€æ•°æ®ç»Ÿä¸€ç”¨ @ModelAttribute æ–¹æ³•å‡†å¤‡
- âœ… è§†å›¾åè§„èŒƒï¼š`æ¨¡å—å/é¡µé¢å`ï¼Œå¦‚ `user/list`

---

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼šæ•°æ®ä¼ é€’æ˜¯Spring MVCçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå»ºè®®å¤šåŠ¨æ‰‹å®è·µï¼Œä»ç®€å•çš„æ•°æ®ä¼ é€’å¼€å§‹ï¼Œé€æ­¥æŒæ¡å¤æ‚åœºæ™¯çš„å¤„ç†ã€‚è®°ä½ï¼šæ•°æ®å’Œè§†å›¾åˆ†ç¦»æ˜¯å…³é”®æ€æƒ³ï¼