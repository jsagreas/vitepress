---
title: 2ã€ExceptionHandleræ³¨è§£ä½¿ç”¨
---
## ğŸ“š ç›®å½•

1. [å¼‚å¸¸å¤„ç†åŸºç¡€æ¦‚å¿µ](#1-å¼‚å¸¸å¤„ç†åŸºç¡€æ¦‚å¿µ)
2. [@ExceptionHandleræ³¨è§£è¯¦è§£](#2-exceptionhandleræ³¨è§£è¯¦è§£)
3. [@ControllerAdviceå…¨å±€å¤„ç†](#3-controlleradviceå…¨å±€å¤„ç†)
4. [@RestControllerAdviceä½¿ç”¨](#4-restcontrolleradviceä½¿ç”¨)
5. [æ–¹æ³•çº§å¼‚å¸¸å¤„ç†](#5-æ–¹æ³•çº§å¼‚å¸¸å¤„ç†)
6. [å¼‚å¸¸ç±»å‹åŒ¹é…æœºåˆ¶](#6-å¼‚å¸¸ç±»å‹åŒ¹é…æœºåˆ¶)
7. [è¿”å›å€¼ç±»å‹å¤„ç†](#7-è¿”å›å€¼ç±»å‹å¤„ç†)
8. [å¼‚å¸¸ä¿¡æ¯è·å–æŠ€å·§](#8-å¼‚å¸¸ä¿¡æ¯è·å–æŠ€å·§)
9. [å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º](#9-å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¼‚å¸¸å¤„ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†


**ğŸ”¸ ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**
```
æ²¡æœ‰å¼‚å¸¸å¤„ç†æ—¶çš„æƒ…å†µï¼š

ç”¨æˆ·åœºæ™¯ï¼š
ç”¨æˆ·è®¿é—®ç½‘ç«™ â†’ åå°å‡ºé”™ â†’ æµè§ˆå™¨æ˜¾ç¤ºä¸€å †ä¹±ç é”™è¯¯ä¿¡æ¯
â€¢ ç”¨æˆ·çœ‹ä¸æ‡‚æŠ€æœ¯é”™è¯¯ä¿¡æ¯
â€¢ æš´éœ²äº†ç³»ç»Ÿå†…éƒ¨å®ç°ç»†èŠ‚
â€¢ ç”¨æˆ·ä½“éªŒå¾ˆå·®

å¼€å‘å›°æ‰°ï¼š
â€¢ æ¯ä¸ªControlleréƒ½è¦å†™try-catch
â€¢ ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾
â€¢ é”™è¯¯ä¿¡æ¯æ ¼å¼ä¸ç»Ÿä¸€
```

**ğŸ’¡ ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„å¥½å¤„**
```
æœ‰äº†ç»Ÿä¸€å¼‚å¸¸å¤„ç†åï¼š

ç”¨æˆ·è§†è§’ï¼š
ç”¨æˆ·è®¿é—® â†’ å‡ºé”™ â†’ çœ‹åˆ°å‹å¥½çš„é”™è¯¯æç¤º
"æŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„å•†å“ä¸å­˜åœ¨"ï¼ˆè€Œä¸æ˜¯ä¸€å †æŠ€æœ¯é”™è¯¯ï¼‰

å¼€å‘è§†è§’ï¼š
â€¢ åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†æ‰€æœ‰å¼‚å¸¸
â€¢ ä»£ç ç®€æ´ï¼Œä¸ç”¨åˆ°å¤„å†™try-catch
â€¢ é”™è¯¯ä¿¡æ¯æ ¼å¼ç»Ÿä¸€
â€¢ æ–¹ä¾¿æ—¥å¿—è®°å½•å’Œç›‘æ§
```

### 1.2 Spring MVCå¼‚å¸¸å¤„ç†æµç¨‹


**ğŸ”„ å¼‚å¸¸å¤„ç†è¿‡ç¨‹ç¤ºæ„**
```
è¯·æ±‚å¤„ç†æµç¨‹ï¼š

ç”¨æˆ·è¯·æ±‚ â†’ Controller â†’ Service â†’ å‘ç”Ÿå¼‚å¸¸
                                      â†“
                              å¼‚å¸¸å‘ä¸ŠæŠ›å‡º
                                      â†“
                          Spring MVCæ‹¦æˆªå¼‚å¸¸
                                      â†“
                      åŒ¹é…@ExceptionHandleræ–¹æ³•
                                      â†“
                         æ‰§è¡Œå¼‚å¸¸å¤„ç†é€»è¾‘
                                      â†“
                        è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯

å…³é”®ç‚¹ï¼š
â€¢ å¼‚å¸¸ä¼šè‡ªåŠ¨å‘ä¸Šä¼ é€’
â€¢ Springä¼šæ‰¾åˆ°åˆé€‚çš„å¤„ç†å™¨
â€¢ æœ€ç»ˆè¿”å›ç»Ÿä¸€æ ¼å¼çš„å“åº”
```

---

## 2. ğŸ“ @ExceptionHandleræ³¨è§£è¯¦è§£


### 2.1 åŸºæœ¬æ¦‚å¿µç†è§£


**ğŸ”¸ @ExceptionHandleræ˜¯ä»€ä¹ˆ**
```
ç®€å•ç†è§£ï¼š
å°±æ˜¯ä¸€ä¸ª"å¼‚å¸¸æ•æ‰‹"æ³¨è§£ï¼Œå‘Šè¯‰Springï¼š
"å½“é‡åˆ°æŸç§å¼‚å¸¸æ—¶ï¼Œè¯·è°ƒç”¨æˆ‘æ ‡æ³¨çš„è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†"

ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š
å°±åƒåŒ»é™¢çš„åˆ†è¯Šå°ï¼Œæ ¹æ®ç—…æƒ…ï¼ˆå¼‚å¸¸ç±»å‹ï¼‰
æŠŠç—…äººï¼ˆå¼‚å¸¸ï¼‰åˆ†é…åˆ°å¯¹åº”çš„ç§‘å®¤ï¼ˆå¤„ç†æ–¹æ³•ï¼‰

ä½œç”¨ä½ç½®ï¼š
â€¢ æ ‡æ³¨åœ¨æ–¹æ³•ä¸Š
â€¢ å¯ä»¥åœ¨Controllerå†…éƒ¨ä½¿ç”¨
â€¢ ä¹Ÿå¯ä»¥åœ¨å…¨å±€å¼‚å¸¸å¤„ç†ç±»ä¸­ä½¿ç”¨
```

### 2.2 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


**ğŸ’» æœ€ç®€å•çš„ç”¨æ³•**
```java
@RestController
public class UserController {
    
    // æ­£å¸¸çš„ä¸šåŠ¡æ–¹æ³•
    @GetMapping("/user/{id}")
    public User getUser(@PathVariable Long id) {
        // å‡è®¾è¿™é‡Œå¯èƒ½æŠ›å‡ºå¼‚å¸¸
        if (id <= 0) {
            throw new IllegalArgumentException("ç”¨æˆ·IDå¿…é¡»å¤§äº0");
        }
        return userService.findById(id);
    }
    
    // å¼‚å¸¸å¤„ç†æ–¹æ³• - å¤„ç†IllegalArgumentException
    @ExceptionHandler(IllegalArgumentException.class)
    public Map<String, Object> handleIllegalArgument(IllegalArgumentException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("code", 400);
        result.put("message", e.getMessage()); // "ç”¨æˆ·IDå¿…é¡»å¤§äº0"
        return result;
    }
}
```

**ğŸ“– ä»£ç è¯´æ˜**
- `@ExceptionHandler(IllegalArgumentException.class)` è¡¨ç¤ºï¼šå½“é‡åˆ°å‚æ•°ä¸åˆæ³•å¼‚å¸¸æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•
- æ–¹æ³•å‚æ•° `IllegalArgumentException e`ï¼šå°±æ˜¯è¢«æ•è·çš„å¼‚å¸¸å¯¹è±¡
- è¿”å›å€¼ï¼šè¿”å›ç»™å‰ç«¯çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªMap

### 2.3 å¤„ç†å¤šç§å¼‚å¸¸ç±»å‹


**ğŸ”§ ä¸€ä¸ªæ–¹æ³•å¤„ç†å¤šç§å¼‚å¸¸**
```java
@RestController
public class ProductController {
    
    @GetMapping("/product/{id}")
    public Product getProduct(@PathVariable Long id) {
        return productService.findById(id);
    }
    
    // ä¸€ä¸ªæ–¹æ³•åŒæ—¶å¤„ç†ä¸¤ç§å¼‚å¸¸
    @ExceptionHandler({
        IllegalArgumentException.class,
        NumberFormatException.class
    })
    public ResponseEntity<String> handleBadRequest(Exception e) {
        // ç”¨ResponseEntityå¯ä»¥è‡ªå®šä¹‰HTTPçŠ¶æ€ç 
        return ResponseEntity
            .status(HttpStatus.BAD_REQUEST)  // 400é”™è¯¯
            .body("å‚æ•°é”™è¯¯ï¼š" + e.getMessage());
    }
}
```

**ğŸ’¡ å·¥ä½œåŸç†**
```
å½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼š
1. å¦‚æœæŠ›å‡ºIllegalArgumentException â†’ è¿›å…¥handleBadRequestæ–¹æ³•
2. å¦‚æœæŠ›å‡ºNumberFormatException â†’ ä¹Ÿè¿›å…¥handleBadRequestæ–¹æ³•
3. æ–¹æ³•å‚æ•°ç”¨Exceptionæ¥æ”¶ï¼ˆä¸¤ç§å¼‚å¸¸çš„çˆ¶ç±»ï¼‰
4. è¿”å›ç»Ÿä¸€çš„é”™è¯¯å“åº”
```

---

## 3. ğŸŒ @ControllerAdviceå…¨å±€å¤„ç†


### 3.1 ä»€ä¹ˆæ˜¯å…¨å±€å¼‚å¸¸å¤„ç†


**ğŸ”¸ å±€éƒ¨vså…¨å±€å¯¹æ¯”**
```
å±€éƒ¨å¼‚å¸¸å¤„ç†ï¼ˆControllerå†…éƒ¨ï¼‰ï¼š
UserController
â”œâ”€â”€ getUserById()
â””â”€â”€ handleException()  â† åªèƒ½å¤„ç†æœ¬Controllerçš„å¼‚å¸¸

å…¨å±€å¼‚å¸¸å¤„ç†ï¼ˆ@ControllerAdviceï¼‰ï¼š
GlobalExceptionHandler
â””â”€â”€ handleException()  â† å¤„ç†æ‰€æœ‰Controllerçš„å¼‚å¸¸

å¥½å¤„ï¼š
â€¢ ä¸€å¤„ç¼–å†™ï¼Œåˆ°å¤„ç”Ÿæ•ˆ
â€¢ æ‰€æœ‰Controlleréƒ½ä¸ç”¨å†™å¼‚å¸¸å¤„ç†ä»£ç 
â€¢ ä¾¿äºç»´æŠ¤å’Œä¿®æ”¹
```

### 3.2 åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†ç±»


**ğŸ“¦ å…¨å±€å¤„ç†å™¨çš„ç»“æ„**
```java
// æ ‡æ³¨è¿™æ˜¯ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†ç±»
@ControllerAdvice
public class GlobalExceptionHandler {
    
    // å¤„ç†è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    @ResponseBody  // å› ä¸ºç”¨çš„@ControllerAdviceï¼Œéœ€è¦åŠ è¿™ä¸ªè¿”å›JSON
    public Map<String, Object> handleBusinessException(BusinessException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("code", e.getCode());
        result.put("message", e.getMessage());
        result.put("timestamp", System.currentTimeMillis());
        return result;
    }
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseBody
    public Map<String, Object> handleValidationException(
        MethodArgumentNotValidException e) {
        
        Map<String, Object> result = new HashMap<>();
        result.put("code", 400);
        
        // è·å–ç¬¬ä¸€ä¸ªæ ¡éªŒå¤±è´¥çš„é”™è¯¯ä¿¡æ¯
        String message = e.getBindingResult()
            .getFieldError()
            .getDefaultMessage();
        result.put("message", message);
        
        return result;
    }
}
```

### 3.3 æŒ‡å®šå¤„ç†èŒƒå›´


**ğŸ¯ æ§åˆ¶å“ªäº›Controllerç”Ÿæ•ˆ**
```java
// åªå¤„ç†com.example.controlleråŒ…ä¸‹çš„Controller
@ControllerAdvice(basePackages = "com.example.controller")
public class WebExceptionHandler {
    // ...
}

// åªå¤„ç†æ ‡æ³¨äº†@RestControllerçš„ç±»
@ControllerAdvice(annotations = RestController.class)
public class RestExceptionHandler {
    // ...
}

// åªå¤„ç†æŒ‡å®šçš„å‡ ä¸ªController
@ControllerAdvice(assignableTypes = {
    UserController.class,
    ProductController.class
})
public class SpecificExceptionHandler {
    // ...
}
```

---

## 4. ğŸš€ @RestControllerAdviceä½¿ç”¨


### 4.1 ä¸@ControllerAdviceçš„åŒºåˆ«


**ğŸ”¸ ä¸¤è€…å¯¹æ¯”**
```
@ControllerAdviceï¼š
â€¢ éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•ä¸ŠåŠ @ResponseBody
â€¢ é€‚åˆè¿”å›è§†å›¾çš„åœºæ™¯
â€¢ æ¯”è¾ƒä¼ ç»Ÿçš„ç”¨æ³•

@RestControllerAdviceï¼š
â€¢ è‡ªåŠ¨ç»™æ‰€æœ‰æ–¹æ³•åŠ @ResponseBody
â€¢ ç›´æ¥è¿”å›JSONæ•°æ®
â€¢ RESTful APIé¦–é€‰
â€¢ ç›¸å½“äº @ControllerAdvice + @ResponseBody
```

### 4.2 å®é™…åº”ç”¨ç¤ºä¾‹


**ğŸ’» RESTful APIçš„å¼‚å¸¸å¤„ç†**
```java
@RestControllerAdvice  // ç›´æ¥è¿”å›JSONï¼Œä¸éœ€è¦@ResponseBody
public class RestExceptionHandler {
    
    // å¤„ç†èµ„æºä¸å­˜åœ¨
    @ExceptionHandler(ResourceNotFoundException.class)
    public Result handleResourceNotFound(ResourceNotFoundException e) {
        return Result.error(404, e.getMessage());
    }
    
    // å¤„ç†æƒé™ä¸è¶³
    @ExceptionHandler(AccessDeniedException.class)
    public Result handleAccessDenied(AccessDeniedException e) {
        return Result.error(403, "æ‚¨æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº");
    }
    
    // å¤„ç†æ‰€æœ‰æœªæ•è·çš„å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public Result handleUnknownException(Exception e) {
        // è®°å½•è¯¦ç»†æ—¥å¿—
        log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š", e);
        // ç»™ç”¨æˆ·è¿”å›å‹å¥½æç¤º
        return Result.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

**ğŸ“Š ç»Ÿä¸€è¿”å›æ ¼å¼å®šä¹‰**
```java
// ç»Ÿä¸€è¿”å›ç»“æœç±»
public class Result {
    private Integer code;
    private String message;
    private Object data;
    
    public static Result success(Object data) {
        Result result = new Result();
        result.code = 200;
        result.message = "æˆåŠŸ";
        result.data = data;
        return result;
    }
    
    public static Result error(Integer code, String message) {
        Result result = new Result();
        result.code = code;
        result.message = message;
        return result;
    }
}
```

---

## 5. ğŸ”§ æ–¹æ³•çº§å¼‚å¸¸å¤„ç†


### 5.1 å¤„ç†å™¨æ–¹æ³•çš„è§„åˆ™


**ğŸ“ æ–¹æ³•å®šä¹‰è¦æ±‚**
```
å¼‚å¸¸å¤„ç†æ–¹æ³•å¯ä»¥æœ‰è¿™äº›å‚æ•°ï¼š

âœ… å…è®¸çš„å‚æ•°ç±»å‹ï¼š
â€¢ Exceptionå¯¹è±¡ï¼šè¦å¤„ç†çš„å¼‚å¸¸
â€¢ HttpServletRequestï¼šè¯·æ±‚å¯¹è±¡
â€¢ HttpServletResponseï¼šå“åº”å¯¹è±¡  
â€¢ WebRequestï¼šSpringå°è£…çš„è¯·æ±‚
â€¢ HttpSessionï¼šä¼šè¯å¯¹è±¡
â€¢ Principalï¼šå½“å‰ç”¨æˆ·ä¿¡æ¯

âŒ é™åˆ¶ï¼š
â€¢ å‚æ•°é¡ºåºéšæ„
â€¢ ä½†å¿…é¡»åŒ…å«è¦å¤„ç†çš„å¼‚å¸¸ç±»å‹
```

### 5.2 çµæ´»çš„å‚æ•°ç»„åˆ


**ğŸ’¡ è·å–æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯**
```java
@RestControllerAdvice
public class DetailedExceptionHandler {
    
    // æœ€ç®€å•ï¼šåªè¦å¼‚å¸¸å¯¹è±¡
    @ExceptionHandler(BusinessException.class)
    public Result handleSimple(BusinessException e) {
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // è·å–è¯·æ±‚ä¿¡æ¯
    @ExceptionHandler(IllegalArgumentException.class)
    public Result handleWithRequest(
        IllegalArgumentException e,
        HttpServletRequest request) {
        
        String requestUrl = request.getRequestURL().toString();
        log.error("è¯·æ±‚URL: {} å‘ç”Ÿå‚æ•°é”™è¯¯", requestUrl);
        
        return Result.error(400, e.getMessage());
    }
    
    // è·å–ç”¨æˆ·ä¿¡æ¯
    @ExceptionHandler(AccessDeniedException.class)
    public Result handleWithUser(
        AccessDeniedException e,
        Principal principal) {
        
        String username = principal.getName();
        log.warn("ç”¨æˆ· {} å°è¯•è®¿é—®æ— æƒé™èµ„æº", username);
        
        return Result.error(403, "æƒé™ä¸è¶³");
    }
}
```

### 5.3 è¿”å›å€¼çš„å¤šæ ·æ€§


**ğŸ¨ æ”¯æŒå¤šç§è¿”å›ç±»å‹**
```java
@RestControllerAdvice
public class FlexibleReturnHandler {
    
    // è¿”å›Map
    @ExceptionHandler(NotFoundException.class)
    public Map<String, Object> returnMap(NotFoundException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("found", false);
        result.put("message", e.getMessage());
        return result;
    }
    
    // è¿”å›ResponseEntityï¼ˆå¯æ§åˆ¶çŠ¶æ€ç å’Œå“åº”å¤´ï¼‰
    @ExceptionHandler(ValidationException.class)
    public ResponseEntity<Result> returnEntity(ValidationException e) {
        Result result = Result.error(400, e.getMessage());
        return ResponseEntity
            .status(HttpStatus.BAD_REQUEST)
            .header("X-Error-Type", "VALIDATION")
            .body(result);
    }
    
    // è¿”å›Stringï¼ˆç›´æ¥è¿”å›æ–‡æœ¬ï¼‰
    @ExceptionHandler(RateLimitException.class)
    public String returnString(RateLimitException e) {
        return "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•";
    }
    
    // è¿”å›è‡ªå®šä¹‰å¯¹è±¡ï¼ˆè‡ªåŠ¨è½¬JSONï¼‰
    @ExceptionHandler(BusinessException.class)
    public ErrorResponse returnCustom(BusinessException e) {
        return new ErrorResponse(e.getCode(), e.getMessage());
    }
}
```

---

## 6. ğŸ¯ å¼‚å¸¸ç±»å‹åŒ¹é…æœºåˆ¶


### 6.1 åŒ¹é…ä¼˜å…ˆçº§è§„åˆ™


**ğŸ”¸ ç²¾ç¡®åŒ¹é…ä¼˜å…ˆ**
```
å¼‚å¸¸å¤„ç†åŒ¹é…é¡ºåºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. ç²¾ç¡®åŒ¹é…ï¼š
   å¼‚å¸¸ç±»å‹å®Œå…¨ç›¸åŒ
   
2. å­ç±»åŒ¹é…ï¼š
   å¤„ç†å™¨å£°æ˜çš„æ˜¯çˆ¶ç±»ï¼Œå®é™…å¼‚å¸¸æ˜¯å­ç±»
   
3. æ¥å£åŒ¹é…ï¼š
   å¼‚å¸¸å®ç°äº†å¤„ç†å™¨å£°æ˜çš„æ¥å£
   
4. æœ€ç»ˆå…œåº•ï¼š
   Exception.class å¤„ç†æ‰€æœ‰æœªåŒ¹é…çš„å¼‚å¸¸

ç¤ºä¾‹ï¼š
NullPointerException å‘ç”Ÿæ—¶
â†’ å…ˆæ‰¾ @ExceptionHandler(NullPointerException.class)
â†’ æ‰¾ä¸åˆ°ï¼Œæ‰¾ @ExceptionHandler(RuntimeException.class)
â†’ è¿˜æ‰¾ä¸åˆ°ï¼Œæ‰¾ @ExceptionHandler(Exception.class)
```

### 6.2 ç»§æ‰¿å…³ç³»ç¤ºä¾‹


**ğŸ“Š å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„**
```
                    Exception
                        â†“
              RuntimeException
                        â†“
          IllegalArgumentException
         /                        \
NumberFormatException     IllegalStateException


å¤„ç†å™¨é…ç½®ï¼š
```
```java
@RestControllerAdvice
public class HierarchyExceptionHandler {
    
    // æœ€å…·ä½“çš„å¤„ç†
    @ExceptionHandler(NumberFormatException.class)
    public Result handleNumberFormat(NumberFormatException e) {
        return Result.error(400, "æ•°å­—æ ¼å¼é”™è¯¯ï¼š" + e.getMessage());
    }
    
    // ä¸­ç­‰èŒƒå›´çš„å¤„ç†
    @ExceptionHandler(IllegalArgumentException.class)
    public Result handleIllegalArgument(IllegalArgumentException e) {
        return Result.error(400, "å‚æ•°é”™è¯¯ï¼š" + e.getMessage());
    }
    
    // æœ€å¹¿æ³›çš„å¤„ç†ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public Result handleAll(Exception e) {
        log.error("æœªé¢„æœŸçš„å¼‚å¸¸", e);
        return Result.error(500, "ç³»ç»Ÿé”™è¯¯");
    }
}
```

**ğŸ’¡ åŒ¹é…è¿‡ç¨‹æ¼”ç¤º**
```
åœºæ™¯1ï¼šæŠ›å‡º NumberFormatException
â†’ ç²¾ç¡®åŒ¹é… handleNumberFormat
â†’ è¿”å› "æ•°å­—æ ¼å¼é”™è¯¯"

åœºæ™¯2ï¼šæŠ›å‡º IllegalStateException
â†’ æ‰¾ä¸åˆ°ç²¾ç¡®åŒ¹é…
â†’ å‘ä¸Šæ‰¾åˆ°çˆ¶ç±» IllegalArgumentException
â†’ ä½¿ç”¨ handleIllegalArgument
â†’ è¿”å› "å‚æ•°é”™è¯¯"

åœºæ™¯3ï¼šæŠ›å‡º IOException
â†’ æ‰¾ä¸åˆ°ç²¾ç¡®åŒ¹é…
â†’ å‘ä¸Šæ‰¾åˆ° Exception
â†’ ä½¿ç”¨ handleAllï¼ˆå…œåº•ï¼‰
â†’ è¿”å› "ç³»ç»Ÿé”™è¯¯"
```

---

## 7. ğŸ“¤ è¿”å›å€¼ç±»å‹å¤„ç†


### 7.1 è¿”å›JSONå¯¹è±¡


**ğŸ”¸ å¸¸ç”¨çš„è¿”å›æ–¹å¼**
```java
@RestControllerAdvice
public class JsonReturnHandler {
    
    // æ–¹å¼1ï¼šè¿”å›Mapï¼ˆç®€å•ç›´æ¥ï¼‰
    @ExceptionHandler(ValidationException.class)
    public Map<String, Object> returnMap(ValidationException e) {
        Map<String, Object> result = new HashMap<>();
        result.put("success", false);
        result.put("code", 400);
        result.put("message", e.getMessage());
        result.put("timestamp", LocalDateTime.now());
        return result;
    }
    
    // æ–¹å¼2ï¼šè¿”å›è‡ªå®šä¹‰ç±»ï¼ˆæ¨èï¼‰
    @ExceptionHandler(BusinessException.class)
    public ErrorResponse returnObject(BusinessException e) {
        return new ErrorResponse(
            e.getCode(),
            e.getMessage(),
            LocalDateTime.now()
        );
    }
    
    // æ–¹å¼3ï¼šè¿”å›ç»Ÿä¸€Resultç±»ï¼ˆæœ€å¸¸ç”¨ï¼‰
    @ExceptionHandler(Exception.class)
    public Result returnResult(Exception e) {
        return Result.error(500, e.getMessage());
    }
}
```

### 7.2 ä½¿ç”¨ResponseEntity


**âš™ï¸ å®Œå…¨æ§åˆ¶HTTPå“åº”**
```java
@RestControllerAdvice
public class ResponseEntityHandler {
    
    @ExceptionHandler(NotFoundException.class)
    public ResponseEntity<Result> handleNotFound(NotFoundException e) {
        Result result = Result.error(404, e.getMessage());
        
        return ResponseEntity
            .status(HttpStatus.NOT_FOUND)      // è®¾ç½®404çŠ¶æ€ç 
            .header("X-Error-Code", "NOT_FOUND")  // è‡ªå®šä¹‰å“åº”å¤´
            .body(result);                     // è®¾ç½®å“åº”ä½“
    }
    
    @ExceptionHandler(UnauthorizedException.class)
    public ResponseEntity<String> handleUnauth(UnauthorizedException e) {
        return ResponseEntity
            .status(HttpStatus.UNAUTHORIZED)   // 401çŠ¶æ€ç 
            .header("WWW-Authenticate", "Bearer")
            .body("è¯·å…ˆç™»å½•");
    }
}
```

**ğŸ“Š HTTPçŠ¶æ€ç å¯¹ç…§è¡¨**

| å¼‚å¸¸ç±»å‹ | çŠ¶æ€ç  | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|---------|--------|------|---------|
| **å‚æ•°å¼‚å¸¸** | `400` | Bad Request | å‚æ•°æ ¡éªŒå¤±è´¥ã€æ ¼å¼é”™è¯¯ |
| **è®¤è¯å¤±è´¥** | `401` | Unauthorized | æœªç™»å½•ã€tokenå¤±æ•ˆ |
| **æƒé™ä¸è¶³** | `403` | Forbidden | å·²ç™»å½•ä½†æ— æƒé™ |
| **èµ„æºä¸å­˜åœ¨** | `404` | Not Found | æŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ |
| **ä¸šåŠ¡å¼‚å¸¸** | `400/422` | Business Error | ä¸šåŠ¡è§„åˆ™ä¸æ»¡è¶³ |
| **ç³»ç»Ÿå¼‚å¸¸** | `500` | Server Error | æœªé¢„æœŸçš„ç³»ç»Ÿé”™è¯¯ |

---

## 8. ğŸ” å¼‚å¸¸ä¿¡æ¯è·å–æŠ€å·§


### 8.1 è·å–è¯¦ç»†å¼‚å¸¸ä¿¡æ¯


**ğŸ“ å¸¸ç”¨çš„ä¿¡æ¯æå–æ–¹æ³•**
```java
@RestControllerAdvice
public class ExceptionInfoHandler {
    
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        
        // 1. è·å–å¼‚å¸¸æ¶ˆæ¯
        String message = e.getMessage();
        
        // 2. è·å–å¼‚å¸¸ç±»å
        String className = e.getClass().getSimpleName();
        
        // 3. è·å–å †æ ˆä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
        String stackTrace = Arrays.stream(e.getStackTrace())
            .limit(5)  // åªå–å‰5å±‚
            .map(StackTraceElement::toString)
            .collect(Collectors.joining("\n"));
        
        // 4. è·å–æ ¹æœ¬åŸå› ï¼ˆæœ€åº•å±‚çš„å¼‚å¸¸ï¼‰
        Throwable rootCause = getRootCause(e);
        
        return Result.error(500, 
            "å¼‚å¸¸ç±»å‹ï¼š" + className + 
            "ï¼ŒåŸå› ï¼š" + message);
    }
    
    // é€’å½’è·å–æ ¹æœ¬åŸå› 
    private Throwable getRootCause(Throwable e) {
        Throwable cause = e.getCause();
        if (cause == null) {
            return e;
        }
        return getRootCause(cause);
    }
}
```

### 8.2 å‚æ•°æ ¡éªŒå¼‚å¸¸ä¿¡æ¯æå–


**ğŸ”§ å¤„ç†@Validæ ¡éªŒå¤±è´¥**
```java
@RestControllerAdvice
public class ValidationExceptionHandler {
    
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidation(MethodArgumentNotValidException e) {
        
        // è·å–æ‰€æœ‰æ ¡éªŒé”™è¯¯
        List<String> errors = e.getBindingResult()
            .getFieldErrors()
            .stream()
            .map(error -> {
                String field = error.getField();  // å­—æ®µå
                String msg = error.getDefaultMessage();  // é”™è¯¯ä¿¡æ¯
                return field + ": " + msg;
            })
            .collect(Collectors.toList());
        
        return Result.error(400, "å‚æ•°æ ¡éªŒå¤±è´¥", errors);
    }
    
    // å¤„ç†å•ä¸ªå‚æ•°æ ¡éªŒï¼ˆ@RequestParam @PathVariableï¼‰
    @ExceptionHandler(ConstraintViolationException.class)
    public Result handleConstraintViolation(ConstraintViolationException e) {
        
        String message = e.getConstraintViolations()
            .stream()
            .map(violation -> {
                String path = violation.getPropertyPath().toString();
                String msg = violation.getMessage();
                return path + ": " + msg;
            })
            .collect(Collectors.joining(", "));
        
        return Result.error(400, message);
    }
}
```

### 8.3 è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯


**ğŸ’¡ ä¸šåŠ¡å¼‚å¸¸çš„æœ€ä½³å®è·µ**
```java
// è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»
public class BusinessException extends RuntimeException {
    private Integer code;
    private String message;
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
    
    // ä¾¿æ·çš„é™æ€å·¥å‚æ–¹æ³•
    public static BusinessException of(String message) {
        return new BusinessException(400, message);
    }
    
    public static BusinessException notFound(String resource) {
        return new BusinessException(404, resource + "ä¸å­˜åœ¨");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@Service
public class UserService {
    
    public User getById(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            // ç›´æ¥æŠ›å‡ºï¼Œå…¨å±€å¤„ç†å™¨ä¼šæ•è·
            throw BusinessException.notFound("ç”¨æˆ·");
        }
        return user;
    }
}
```

---

## 9. ğŸ’¼ å®æˆ˜æ¡ˆä¾‹æ¼”ç¤º


### 9.1 å®Œæ•´çš„å¼‚å¸¸å¤„ç†ä½“ç³»


**ğŸ—ï¸ ä¼ä¸šçº§å¼‚å¸¸å¤„ç†æ¶æ„**
```java
// 1. è‡ªå®šä¹‰å¼‚å¸¸æšä¸¾
public enum ErrorCode {
    SUCCESS(200, "æˆåŠŸ"),
    PARAM_ERROR(400, "å‚æ•°é”™è¯¯"),
    UNAUTHORIZED(401, "æœªè®¤è¯"),
    FORBIDDEN(403, "æ— æƒé™"),
    NOT_FOUND(404, "èµ„æºä¸å­˜åœ¨"),
    BUSINESS_ERROR(400, "ä¸šåŠ¡å¼‚å¸¸"),
    SYSTEM_ERROR(500, "ç³»ç»Ÿé”™è¯¯");
    
    private Integer code;
    private String message;
    
    ErrorCode(Integer code, String message) {
        this.code = code;
        this.message = message;
    }
}

// 2. ç»Ÿä¸€è¿”å›ç±»
@Data
public class ApiResult<T> {
    private Integer code;
    private String message;
    private T data;
    private Long timestamp;
    
    public static <T> ApiResult<T> success(T data) {
        ApiResult<T> result = new ApiResult<>();
        result.code = 200;
        result.message = "æˆåŠŸ";
        result.data = data;
        result.timestamp = System.currentTimeMillis();
        return result;
    }
    
    public static <T> ApiResult<T> error(ErrorCode errorCode) {
        ApiResult<T> result = new ApiResult<>();
        result.code = errorCode.getCode();
        result.message = errorCode.getMessage();
        result.timestamp = System.currentTimeMillis();
        return result;
    }
}

// 3. å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    // ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ApiResult<?> handleBusiness(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());
        return ApiResult.error(ErrorCode.BUSINESS_ERROR)
            .setMessage(e.getMessage());
    }
    
    // å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ApiResult<?> handleValidation(MethodArgumentNotValidException e) {
        String message = e.getBindingResult()
            .getFieldError()
            .getDefaultMessage();
        return ApiResult.error(ErrorCode.PARAM_ERROR)
            .setMessage(message);
    }
    
    // è®¤è¯å¼‚å¸¸
    @ExceptionHandler(UnauthorizedException.class)
    public ApiResult<?> handleUnauth(UnauthorizedException e) {
        return ApiResult.error(ErrorCode.UNAUTHORIZED);
    }
    
    // æƒé™å¼‚å¸¸
    @ExceptionHandler(ForbiddenException.class)
    public ApiResult<?> handleForbidden(ForbiddenException e) {
        return ApiResult.error(ErrorCode.FORBIDDEN);
    }
    
    // èµ„æºä¸å­˜åœ¨
    @ExceptionHandler(NotFoundException.class)
    public ApiResult<?> handleNotFound(NotFoundException e) {
        return ApiResult.error(ErrorCode.NOT_FOUND)
            .setMessage(e.getMessage());
    }
    
    // ç³»ç»Ÿå¼‚å¸¸ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public ApiResult<?> handleSystem(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š", e);
        return ApiResult.error(ErrorCode.SYSTEM_ERROR);
    }
}
```

### 9.2 ä¸šåŠ¡ä»£ç ä½¿ç”¨ç¤ºä¾‹


**ğŸ“¦ Controllerå±‚ä½¿ç”¨**
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // ä¸éœ€è¦try-catchï¼Œå¼‚å¸¸ä¼šè¢«å…¨å±€å¤„ç†å™¨æ•è·
    @GetMapping("/{id}")
    public ApiResult<User> getUser(@PathVariable Long id) {
        User user = userService.getById(id);
        return ApiResult.success(user);
    }
    
    @PostMapping
    public ApiResult<User> createUser(@Valid @RequestBody UserDTO dto) {
        // æ ¡éªŒå¤±è´¥ä¼šè‡ªåŠ¨æŠ›å‡ºMethodArgumentNotValidException
        // è¢«å…¨å±€å¤„ç†å™¨çš„handleValidationæ–¹æ³•æ•è·
        User user = userService.create(dto);
        return ApiResult.success(user);
    }
}

// Serviceå±‚
@Service
public class UserService {
    
    public User getById(Long id) {
        User user = userMapper.selectById(id);
        if (user == null) {
            // ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè®©å…¨å±€å¤„ç†å™¨å¤„ç†
            throw new NotFoundException("ç”¨æˆ·ID " + id + " ä¸å­˜åœ¨");
        }
        return user;
    }
    
    public User create(UserDTO dto) {
        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        if (userMapper.existsByUsername(dto.getUsername())) {
            throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
        }
        
        User user = new User();
        BeanUtils.copyProperties(dto, user);
        userMapper.insert(user);
        return user;
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ @ExceptionHandlerï¼šæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼ŒæŒ‡å®šå¤„ç†å“ªç§å¼‚å¸¸
ğŸ”¸ @ControllerAdviceï¼šå…¨å±€å¼‚å¸¸å¤„ç†ç±»ï¼Œéœ€é…åˆ@ResponseBody
ğŸ”¸ @RestControllerAdviceï¼šè‡ªåŠ¨è¿”å›JSONçš„å…¨å±€å¤„ç†å™¨
ğŸ”¸ å¼‚å¸¸åŒ¹é…ï¼šç²¾ç¡®åŒ¹é… > çˆ¶ç±»åŒ¹é… > Exceptionå…œåº•
ğŸ”¸ è¿”å›å€¼ï¼šæ”¯æŒMapã€è‡ªå®šä¹‰å¯¹è±¡ã€ResponseEntityç­‰
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¼‚å¸¸å¤„ç†çš„ä¸‰ä¸ªå±‚æ¬¡**
```
Controllerå†…éƒ¨å¤„ç†ï¼š
â€¢ ä½¿ç”¨åœºæ™¯ï¼šç‰¹å®šControllerçš„ç‰¹æ®Šå¼‚å¸¸
â€¢ ä¼˜å…ˆçº§ï¼šæœ€é«˜ï¼ˆå±€éƒ¨ä¼˜äºå…¨å±€ï¼‰
â€¢ èŒƒå›´ï¼šåªå¯¹å½“å‰Controlleræœ‰æ•ˆ

å…¨å±€ç»Ÿä¸€å¤„ç†ï¼š
â€¢ ä½¿ç”¨åœºæ™¯ï¼šé€šç”¨çš„å¼‚å¸¸å¤„ç†é€»è¾‘
â€¢ ä¼˜å…ˆçº§ï¼šæ¬¡äºå±€éƒ¨å¤„ç†
â€¢ èŒƒå›´ï¼šæ‰€æœ‰ï¼ˆæˆ–æŒ‡å®šï¼‰Controller

å…œåº•å¤„ç†ï¼š
â€¢ ä½¿ç”¨åœºæ™¯ï¼šå¤„ç†æ‰€æœ‰æœªåŒ¹é…çš„å¼‚å¸¸
â€¢ å…³é”®ï¼š@ExceptionHandler(Exception.class)
â€¢ ä½œç”¨ï¼šé˜²æ­¢500é”™è¯¯æš´éœ²ç»™ç”¨æˆ·
```

**ğŸ”¹ è¿”å›å€¼è®¾è®¡åŸåˆ™**
```
ç»Ÿä¸€æ ¼å¼ï¼š
{
  "code": çŠ¶æ€ç ,
  "message": "é”™è¯¯ä¿¡æ¯",
  "data": æ•°æ®ï¼ˆå¯é€‰ï¼‰,
  "timestamp": æ—¶é—´æˆ³
}

çŠ¶æ€ç è§„èŒƒï¼š
â€¢ 2xxï¼šæˆåŠŸ
â€¢ 4xxï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼ˆå‚æ•°ã€æƒé™ç­‰ï¼‰
â€¢ 5xxï¼šæœåŠ¡ç«¯é”™è¯¯ï¼ˆç³»ç»Ÿå¼‚å¸¸ï¼‰
```

### 10.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ’¡ å¼€å‘å»ºè®®**
```
å¼‚å¸¸è®¾è®¡ï¼š
âœ… è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»ï¼Œæºå¸¦é”™è¯¯ç 
âœ… ä½¿ç”¨æšä¸¾ç®¡ç†æ‰€æœ‰é”™è¯¯ç 
âœ… å¼‚å¸¸ä¿¡æ¯è¦å¯¹ç”¨æˆ·å‹å¥½
âŒ ä¸è¦åœ¨å¼‚å¸¸ä¿¡æ¯ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯

ä»£ç ç»„ç»‡ï¼š
âœ… ä¸€ä¸ªé¡¹ç›®åªéœ€ä¸€ä¸ªå…¨å±€å¤„ç†å™¨
âœ… æŒ‰å¼‚å¸¸ç±»å‹åˆ†ç±»å¤„ç†
âœ… Exception.class ä½œä¸ºå…œåº•
âŒ ä¸è¦å®šä¹‰å¤šä¸ªé‡å¤çš„å¤„ç†å™¨

æ—¥å¿—è®°å½•ï¼š
âœ… ä¸šåŠ¡å¼‚å¸¸è®°å½•warnçº§åˆ«
âœ… ç³»ç»Ÿå¼‚å¸¸è®°å½•errorçº§åˆ«
âœ… è®°å½•è¯·æ±‚ä¿¡æ¯ä¾¿äºæ’æŸ¥
âŒ ä¸è¦åœ¨å¼‚å¸¸å¤„ç†å™¨ä¸­å†æŠ›å¼‚å¸¸
```

### 10.4 å¿«é€Ÿæ’æŸ¥æ¸…å•


```
å¼‚å¸¸æœªè¢«æ•è·æ—¶æ£€æŸ¥ï¼š

1. å¤„ç†å™¨é…ç½®ï¼š
   â–¡ @RestControllerAdviceæ³¨è§£æ˜¯å¦å­˜åœ¨
   â–¡ æ˜¯å¦åœ¨Springå®¹å™¨ä¸­ï¼ˆè¢«æ‰«æåˆ°ï¼‰
   â–¡ basePackagesèŒƒå›´æ˜¯å¦åŒ…å«Controller

2. æ–¹æ³•å®šä¹‰ï¼š
   â–¡ @ExceptionHandleræ³¨è§£æ˜¯å¦æ­£ç¡®
   â–¡ å¼‚å¸¸ç±»å‹æ˜¯å¦åŒ¹é…
   â–¡ æ–¹æ³•å‚æ•°æ˜¯å¦æ­£ç¡®

3. è¿”å›å€¼ï¼š
   â–¡ æ˜¯å¦éœ€è¦@ResponseBody
   â–¡ è¿”å›ç±»å‹æ˜¯å¦æ­£ç¡®
   â–¡ æ˜¯å¦èƒ½æ­£ç¡®åºåˆ—åŒ–ä¸ºJSON
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å¼‚å¸¸å¤„ç†ç”¨æ³¨è§£ï¼Œå…¨å±€ç»Ÿä¸€æœ€é«˜æ•ˆ
- ç±»å‹åŒ¹é…æœ‰ä¼˜å…ˆï¼Œç²¾ç¡®çˆ¶ç±»åŠ å…œåº•
- è¿”å›æ ¼å¼è¦ç»Ÿä¸€ï¼ŒçŠ¶æ€ä¿¡æ¯éƒ½é½å…¨
- ä¸šåŠ¡å¼‚å¸¸è¦å‹å¥½ï¼Œç³»ç»Ÿé”™è¯¯è®°æ—¥å¿—