---
title: 3ã€å¸¸è§å¼‚å¸¸ç±»å‹ä¸å¤„ç†
---
## ğŸ“š ç›®å½•

1. [å¼‚å¸¸å¤„ç†åŸºç¡€æ¦‚å¿µ](#1-å¼‚å¸¸å¤„ç†åŸºç¡€æ¦‚å¿µ)
2. [æ•°æ®ç»‘å®šå¼‚å¸¸](#2-æ•°æ®ç»‘å®šå¼‚å¸¸)
3. [è¯·æ±‚å‚æ•°å¼‚å¸¸](#3-è¯·æ±‚å‚æ•°å¼‚å¸¸)
4. [ä¸šåŠ¡é€»è¾‘å¼‚å¸¸](#4-ä¸šåŠ¡é€»è¾‘å¼‚å¸¸)
5. [ç³»ç»Ÿå¼‚å¸¸ä¸ç½‘ç»œå¼‚å¸¸](#5-ç³»ç»Ÿå¼‚å¸¸ä¸ç½‘ç»œå¼‚å¸¸)
6. [æ•°æ®åº“å¼‚å¸¸](#6-æ•°æ®åº“å¼‚å¸¸)
7. [æ–‡ä»¶å¤„ç†å¼‚å¸¸](#7-æ–‡ä»¶å¤„ç†å¼‚å¸¸)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¼‚å¸¸å¤„ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†


> ğŸ’¡ **é€šä¿—ç†è§£**  
> æƒ³è±¡ä½ åœ¨é¤å…ç‚¹é¤ï¼Œå¯èƒ½é‡åˆ°ï¼šèœå“å”®ç½„ï¼ˆä¸šåŠ¡å¼‚å¸¸ï¼‰ã€æœåŠ¡å‘˜è®°é”™å•ï¼ˆæ•°æ®å¼‚å¸¸ï¼‰ã€åå¨åœç”µï¼ˆç³»ç»Ÿå¼‚å¸¸ï¼‰ã€‚é¤å…éœ€è¦æœ‰åº”å¯¹æ–¹æ¡ˆï¼Œç¨‹åºä¹Ÿä¸€æ ·éœ€è¦å¤„ç†å„ç§"æ„å¤–æƒ…å†µ"ã€‚

**å¼‚å¸¸å¤„ç†çš„ä½œç”¨**ï¼š
```
ç”¨æˆ·è§’åº¦ï¼š
âŒ æ²¡æœ‰å¼‚å¸¸å¤„ç†ï¼šçœ‹åˆ°ä¸€å †æŠ¥é”™ä»£ç ï¼Œä¸çŸ¥æ‰€æª
âœ… æœ‰å¼‚å¸¸å¤„ç†ï¼šçœ‹åˆ°å‹å¥½æç¤º"å•†å“åº“å­˜ä¸è¶³"

å¼€å‘è§’åº¦ï¼š
âŒ æ²¡æœ‰å¼‚å¸¸å¤„ç†ï¼šé—®é¢˜éš¾ä»¥å®šä½ï¼Œæ—¥å¿—æ··ä¹±
âœ… æœ‰å¼‚å¸¸å¤„ç†ï¼šå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä¾¿äºè°ƒè¯•ä¿®å¤
```

### 1.2 Spring MVC å¼‚å¸¸å¤„ç†å±‚æ¬¡


```
å¼‚å¸¸å¤„ç†çš„ä¸‰ä¸ªå±‚æ¬¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Controller å±‚å¤„ç†                â”‚  â† å±€éƒ¨å¼‚å¸¸å¤„ç†
â”‚    (@ExceptionHandler)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    å…¨å±€å¼‚å¸¸å¤„ç†å™¨                    â”‚  â† å…¨å±€å¼‚å¸¸å¤„ç†
â”‚    (@ControllerAdvice)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Spring é»˜è®¤å¼‚å¸¸å¤„ç†               â”‚  â† å…œåº•å¤„ç†
â”‚    (BasicErrorController)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å°±åƒï¼š
ä¸ªäºº â†’ éƒ¨é—¨ â†’ å…¬å¸ çš„é—®é¢˜ä¸ŠæŠ¥æœºåˆ¶
```

### 1.3 å¼‚å¸¸å¤„ç†æµç¨‹å›¾


```
ç”¨æˆ·è¯·æ±‚
    â†“
Controller æ¥æ”¶
    â†“
[æ˜¯å¦å‘ç”Ÿå¼‚å¸¸?]
    â†“ æ˜¯
[Controller å†…æœ‰ @ExceptionHandler?]
    â†“ å¦
[å…¨å±€å¼‚å¸¸å¤„ç†å™¨èƒ½å¤„ç†?]
    â†“ å¦
[Spring é»˜è®¤å¼‚å¸¸å¤„ç†]
    â†“
è¿”å›é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·
```

---

## 2. ğŸ“ æ•°æ®ç»‘å®šå¼‚å¸¸


### 2.1 ä»€ä¹ˆæ˜¯æ•°æ®ç»‘å®šå¼‚å¸¸


> ğŸ“– **æ¦‚å¿µè§£é‡Š**  
> æ•°æ®ç»‘å®šå¼‚å¸¸å°±æ˜¯ï¼šå‰ç«¯ä¼ æ¥çš„æ•°æ® **"è£…ä¸è¿›"** åç«¯å®šä¹‰çš„å¯¹è±¡ã€‚å°±åƒä¹°é‹ï¼Œå°ºç ä¸å¯¹ç©¿ä¸è¿›å»ã€‚

**å¸¸è§åœºæ™¯**ï¼š
- å‰ç«¯ä¼ å­—ç¬¦ä¸² `"abc"`ï¼Œåç«¯è¦ `Integer` ç±»å‹
- å‰ç«¯ä¼ æ—¥æœŸæ ¼å¼ `"2024/01/01"`ï¼Œåç«¯è¦ `"2024-01-01"`
- å‰ç«¯ä¼ ç©ºå€¼ `null`ï¼Œåç«¯æ˜¯åŸºæœ¬ç±»å‹ `int`

### 2.2 ç±»å‹è½¬æ¢å¼‚å¸¸å¤„ç†


**å…¸å‹å¼‚å¸¸**ï¼š`MethodArgumentTypeMismatchException`

```java
// åœºæ™¯ç¤ºä¾‹ï¼šæ¥æ”¶ç”¨æˆ·ID
@GetMapping("/user/{id}")
public User getUser(@PathVariable Integer id) {
    return userService.getById(id);
}

// é”™è¯¯è¯·æ±‚ï¼š/user/abc  â† "abc" ä¸èƒ½è½¬æˆ Integer
```

**ç»Ÿä¸€å¤„ç†æ–¹æ¡ˆ**ï¼š

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    /**
     * å¤„ç†ç±»å‹è½¬æ¢å¼‚å¸¸
     * é€šä¿—è¯´æ˜ï¼šå½“å‰ç«¯ä¼ æ¥çš„æ•°æ®ç±»å‹å’Œåç«¯è¦æ±‚çš„ä¸åŒ¹é…æ—¶è§¦å‘
     */
    @ExceptionHandler(MethodArgumentTypeMismatchException.class)
    public Result handleTypeMismatch(MethodArgumentTypeMismatchException e) {
        String fieldName = e.getName();  // å“ªä¸ªå‚æ•°å‡ºé”™
        String errorValue = String.valueOf(e.getValue());  // é”™è¯¯çš„å€¼
        String requiredType = e.getRequiredType().getSimpleName();  // éœ€è¦çš„ç±»å‹
        
        String message = String.format(
            "å‚æ•° '%s' çš„å€¼ '%s' æ— æ³•è½¬æ¢ä¸º %s ç±»å‹",
            fieldName, errorValue, requiredType
        );
        
        return Result.error(message);
    }
}
```

> âš ï¸ **æ–°æ‰‹æç¤º**  
> `@RestControllerAdvice` = `@ControllerAdvice` + `@ResponseBody`ï¼Œä½œç”¨æ˜¯å…¨å±€å¤„ç†å¼‚å¸¸å¹¶è‡ªåŠ¨è½¬JSONè¿”å›

### 2.3 æ•°æ®éªŒè¯å¼‚å¸¸å¤„ç†


**å…¸å‹å¼‚å¸¸**ï¼š`MethodArgumentNotValidException`

```java
// ç”¨æˆ·æ³¨å†Œå®ä½“ç±»
public class UserRegisterDTO {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦3-20ä¸ªå­—ç¬¦")
    private String username;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Min(value = 18, message = "å¹´é¾„å¿…é¡»å¤§äº18å²")
    private Integer age;
}

// Controller æ¥æ”¶
@PostMapping("/register")
public Result register(@Valid @RequestBody UserRegisterDTO dto) {
    // @Valid æ³¨è§£ä¼šè‡ªåŠ¨è§¦å‘æ ¡éªŒ
    return Result.success("æ³¨å†ŒæˆåŠŸ");
}
```

**å¼‚å¸¸å¤„ç†**ï¼š

```java
@ExceptionHandler(MethodArgumentNotValidException.class)
public Result handleValidationException(MethodArgumentNotValidException e) {
    
    // æ”¶é›†æ‰€æœ‰æ ¡éªŒå¤±è´¥çš„ä¿¡æ¯
    List<String> errors = e.getBindingResult()
        .getFieldErrors()
        .stream()
        .map(error -> error.getField() + ": " + error.getDefaultMessage())
        .collect(Collectors.toList());
    
    return Result.error("æ•°æ®æ ¡éªŒå¤±è´¥", errors);
}
```

**è¿”å›æ ¼å¼ç¤ºä¾‹**ï¼š
```json
{
  "code": 400,
  "message": "æ•°æ®æ ¡éªŒå¤±è´¥",
  "data": [
    "username: ç”¨æˆ·åä¸èƒ½ä¸ºç©º",
    "email: é‚®ç®±æ ¼å¼ä¸æ­£ç¡®",
    "age: å¹´é¾„å¿…é¡»å¤§äº18å²"
  ]
}
```

### 2.4 æ•°æ®ç»‘å®šå¸¸è§é—®é¢˜å¯¹ç…§è¡¨


| å¼‚å¸¸ç±»å‹ | **è§¦å‘åŸå› ** | **ç¤ºä¾‹** | **è§£å†³æ–¹æ¡ˆ** |
|---------|------------|---------|------------|
| `TypeMismatchException` | `ç±»å‹ä¸åŒ¹é…` | `ä¼ "abc"ç»™Integerå‚æ•°` | `å‰ç«¯æ ¡éªŒ + åç«¯è½¬æ¢å¤„ç†` |
| `MethodArgumentNotValidException` | `@Validæ ¡éªŒå¤±è´¥` | `ç”¨æˆ·åä¸ºç©º` | `ç»Ÿä¸€è¿”å›æ ¡éªŒé”™è¯¯ä¿¡æ¯` |
| `BindException` | `è¡¨å•ç»‘å®šå¤±è´¥` | `æ—¥æœŸæ ¼å¼é”™è¯¯` | `è‡ªå®šä¹‰æ—¥æœŸæ ¼å¼è½¬æ¢å™¨` |
| `HttpMessageNotReadableException` | `JSONè§£æå¤±è´¥` | `JSONæ ¼å¼é”™è¯¯` | `æç¤ºJSONæ ¼å¼è¦æ±‚` |

---

## 3. ğŸ” è¯·æ±‚å‚æ•°å¼‚å¸¸


### 3.1 ç¼ºå°‘å¿…éœ€å‚æ•°


**å…¸å‹å¼‚å¸¸**ï¼š`MissingServletRequestParameterException`

> ğŸ¯ **åœºæ™¯è¯´æ˜**  
> å°±åƒå¡«è¡¨æ ¼ï¼Œæœ‰äº›æ ä½æ˜¯å¿…å¡«é¡¹ï¼Œç”¨æˆ·æ²¡å¡«å°±æäº¤äº†

```java
// å®šä¹‰å¿…éœ€å‚æ•°
@GetMapping("/search")
public Result search(@RequestParam String keyword,  // å¿…å¡«
                     @RequestParam(required = false) Integer page) {  // å¯é€‰
    return Result.success(productService.search(keyword, page));
}

// é”™è¯¯è¯·æ±‚ï¼š/search?page=1  â† ç¼ºå°‘ keyword å‚æ•°
```

**å¤„ç†æ–¹å¼**ï¼š

```java
@ExceptionHandler(MissingServletRequestParameterException.class)
public Result handleMissingParam(MissingServletRequestParameterException e) {
    String paramName = e.getParameterName();
    String paramType = e.getParameterType();
    
    return Result.error(
        String.format("ç¼ºå°‘å¿…éœ€å‚æ•°: %s (ç±»å‹: %s)", paramName, paramType)
    );
}
```

### 3.2 è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ


**å…¸å‹å¼‚å¸¸**ï¼š`HttpRequestMethodNotSupportedException`

```java
// Controller å®šä¹‰
@PostMapping("/login")  // åªæ”¯æŒ POST
public Result login(@RequestBody LoginDTO dto) {
    return Result.success("ç™»å½•æˆåŠŸ");
}

// é”™è¯¯è¯·æ±‚ï¼šGET /login  â† ç”¨äº† GET æ–¹æ³•
```

**å¼‚å¸¸å¤„ç†**ï¼š

```java
@ExceptionHandler(HttpRequestMethodNotSupportedException.class)
public Result handleMethodNotSupported(HttpRequestMethodNotSupportedException e) {
    String method = e.getMethod();  // ç”¨æˆ·ä½¿ç”¨çš„æ–¹æ³•
    String[] supportedMethods = e.getSupportedMethods();  // æ”¯æŒçš„æ–¹æ³•
    
    return Result.error(
        String.format("ä¸æ”¯æŒ %s è¯·æ±‚ï¼Œè¯·ä½¿ç”¨: %s", 
                     method, String.join(", ", supportedMethods))
    );
}
```

### 3.3 è¯·æ±‚å¤´å¼‚å¸¸


**å…¸å‹å¼‚å¸¸**ï¼š`MissingRequestHeaderException`

```java
// éœ€è¦ Token éªŒè¯
@GetMapping("/user/info")
public Result getUserInfo(@RequestHeader("Authorization") String token) {
    return Result.success(userService.getInfoByToken(token));
}

// é”™è¯¯æƒ…å†µï¼šè¯·æ±‚æ—¶æ²¡å¸¦ Authorization è¯·æ±‚å¤´
```

**å¤„ç†æ–¹æ¡ˆ**ï¼š

```java
@ExceptionHandler(MissingRequestHeaderException.class)
public Result handleMissingHeader(MissingRequestHeaderException e) {
    return Result.error("ç¼ºå°‘è¯·æ±‚å¤´: " + e.getHeaderName(), 401);
}
```

### 3.4 è¯·æ±‚å‚æ•°å¼‚å¸¸æ±‡æ€»


```
å‚æ•°å¼‚å¸¸å¤„ç†å†³ç­–æ ‘ï¼š

è¯·æ±‚è¿›å…¥
    â†“
[å‚æ•°æ˜¯å¦ç¼ºå¤±?] â†’ æ˜¯ â†’ MissingServletRequestParameterException
    â†“ å¦
[è¯·æ±‚æ–¹æ³•æ˜¯å¦æ”¯æŒ?] â†’ å¦ â†’ HttpRequestMethodNotSupportedException
    â†“ æ˜¯
[è¯·æ±‚å¤´æ˜¯å¦å®Œæ•´?] â†’ å¦ â†’ MissingRequestHeaderException
    â†“ æ˜¯
[å‚æ•°ç±»å‹æ˜¯å¦åŒ¹é…?] â†’ å¦ â†’ TypeMismatchException
    â†“ æ˜¯
æ­£å¸¸å¤„ç†
```

---

## 4. ğŸ’¼ ä¸šåŠ¡é€»è¾‘å¼‚å¸¸


### 4.1 ä¸šåŠ¡å¼‚å¸¸çš„ç‰¹æ®Šæ€§


> ğŸ’¡ **æ ¸å¿ƒç†è§£**  
> ä¸šåŠ¡å¼‚å¸¸æ˜¯"é¢„æœŸå†…çš„é”™è¯¯"ï¼Œæ¯”å¦‚ï¼šåº“å­˜ä¸è¶³ã€ä½™é¢ä¸å¤Ÿã€æƒé™ä¸è¶³ã€‚è¿™äº›ä¸æ˜¯ç¨‹åºbugï¼Œè€Œæ˜¯ä¸šåŠ¡è§„åˆ™ã€‚

**ä¸šåŠ¡å¼‚å¸¸ vs ç³»ç»Ÿå¼‚å¸¸**ï¼š

```
ä¸šåŠ¡å¼‚å¸¸ï¼š
- å¯é¢„è§ï¼šæå‰çŸ¥é“å¯èƒ½å‘ç”Ÿ
- å¯æ§åˆ¶ï¼šé€šè¿‡ä¸šåŠ¡é€»è¾‘åˆ¤æ–­
- éœ€æç¤ºï¼šè¦å‘Šè¯‰ç”¨æˆ·å…·ä½“åŸå› 
ç¤ºä¾‹ï¼šå•†å“å·²ä¸‹æ¶ã€è®¢å•å·²å–æ¶ˆ

ç³»ç»Ÿå¼‚å¸¸ï¼š
- ä¸å¯é¢„è§ï¼šæ„æ–™ä¹‹å¤–çš„é”™è¯¯
- ä¸å¯æ§ï¼šç¨‹åºbugã€ç¯å¢ƒé—®é¢˜
- éœ€ä¿®å¤ï¼šå¼€å‘äººå‘˜è¦è§£å†³
ç¤ºä¾‹ï¼šç©ºæŒ‡é’ˆã€æ•°ç»„è¶Šç•Œ
```

### 4.2 è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸


**å®šä¹‰å¼‚å¸¸ç±»**ï¼š

```java
/**
 * ä¸šåŠ¡å¼‚å¸¸åŸºç±»
 * ç”¨äºï¼šæ‰€æœ‰å¯é¢„æœŸçš„ä¸šåŠ¡é”™è¯¯
 */
public class BusinessException extends RuntimeException {
    
    private Integer code;  // é”™è¯¯ç 
    private String message;  // é”™è¯¯ä¿¡æ¯
    
    public BusinessException(String message) {
        super(message);
        this.code = 400;
        this.message = message;
    }
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
    
    // getter/setter...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@Service
public class OrderService {
    
    public void createOrder(Long productId, Integer quantity) {
        // 1. æŸ¥è¯¢å•†å“
        Product product = productMapper.selectById(productId);
        if (product == null) {
            throw new BusinessException("å•†å“ä¸å­˜åœ¨");
        }
        
        // 2. æ£€æŸ¥åº“å­˜
        if (product.getStock() < quantity) {
            throw new BusinessException(
                String.format("åº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜: %d", product.getStock())
            );
        }
        
        // 3. æ£€æŸ¥å•†å“çŠ¶æ€
        if (!product.isOnSale()) {
            throw new BusinessException("å•†å“å·²ä¸‹æ¶");
        }
        
        // 4. åˆ›å»ºè®¢å•...
    }
}
```

### 4.3 ä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†


```java
@ExceptionHandler(BusinessException.class)
public Result handleBusinessException(BusinessException e) {
    // è®°å½•ä¸šåŠ¡å¼‚å¸¸æ—¥å¿—ï¼ˆä¸€èˆ¬æ˜¯ warn çº§åˆ«ï¼Œä¸æ˜¯ errorï¼‰
    log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
    
    return Result.error(e.getCode(), e.getMessage());
}
```

### 4.4 å¸¸è§ä¸šåŠ¡å¼‚å¸¸åœºæ™¯


| ä¸šåŠ¡åœºæ™¯ | **å¼‚å¸¸æ—¶æœº** | **é”™è¯¯ç ** | **æç¤ºä¿¡æ¯ç¤ºä¾‹** |
|---------|------------|----------|----------------|
| **å•†å“ä¸‹å•** | `åº“å­˜ä¸è¶³` | `4001` | `"å•†å“åº“å­˜ä¸è¶³ï¼Œå‰©ä½™Xä»¶"` |
| **ç”¨æˆ·ç™»å½•** | `å¯†ç é”™è¯¯` | `4002` | `"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"` |
| **è®¢å•æ”¯ä»˜** | `ä½™é¢ä¸è¶³` | `4003` | `"è´¦æˆ·ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼"` |
| **æƒé™æ“ä½œ** | `æ— æƒé™` | `4004` | `"æ‚¨æ²¡æœ‰è¯¥æ“ä½œæƒé™"` |
| **æ•°æ®ä¿®æ”¹** | `æ•°æ®ä¸å­˜åœ¨` | `4005` | `"è¦ä¿®æ”¹çš„æ•°æ®ä¸å­˜åœ¨"` |

> ğŸ“Œ **è®¾è®¡åŸåˆ™**  
> é”™è¯¯ç å»ºè®®åˆ†æ®µï¼š4001-4099ä¸šåŠ¡å¼‚å¸¸ã€5001-5099ç³»ç»Ÿå¼‚å¸¸ï¼Œä¾¿äºåŒºåˆ†å’Œç®¡ç†

---

## 5. âš™ï¸ ç³»ç»Ÿå¼‚å¸¸ä¸ç½‘ç»œå¼‚å¸¸


### 5.1 ç©ºæŒ‡é’ˆå¼‚å¸¸


**å…¸å‹å¼‚å¸¸**ï¼š`NullPointerException`

> âš ï¸ **æ–°æ‰‹å¸¸è§é”™è¯¯**  
> ç©ºæŒ‡é’ˆæ˜¯æœ€å¸¸è§çš„å¼‚å¸¸ï¼Œé€šå¸¸æ˜¯å› ä¸ºï¼šå¯¹è±¡æ²¡åˆå§‹åŒ–ã€æ•°æ®åº“æŸ¥è¯¢ä¸ºç©ºã€å¤–éƒ¨æ¥å£è¿”å›null

```java
// å±é™©ä»£ç ç¤ºä¾‹
@GetMapping("/user/{id}")
public Result getUser(@PathVariable Long id) {
    User user = userService.getById(id);
    // å¦‚æœ user ä¸º nullï¼Œä¸‹é¢ä¼šæŠ¥ç©ºæŒ‡é’ˆ
    return Result.success(user.getName());
}

// å®‰å…¨å†™æ³•
@GetMapping("/user/{id}")
public Result getUser(@PathVariable Long id) {
    User user = userService.getById(id);
    if (user == null) {
        throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
    }
    return Result.success(user.getName());
}
```

**ç»Ÿä¸€å¤„ç†**ï¼š

```java
@ExceptionHandler(NullPointerException.class)
public Result handleNullPointer(NullPointerException e) {
    log.error("ç©ºæŒ‡é’ˆå¼‚å¸¸", e);
    return Result.error("ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•");
}
```

### 5.2 ç½‘ç»œè¶…æ—¶å¼‚å¸¸


**å…¸å‹åœºæ™¯**ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ã€å¾®æœåŠ¡é€šä¿¡

```java
// è°ƒç”¨å¤–éƒ¨APIç¤ºä¾‹
public String callExternalApi(String url) {
    RestTemplate restTemplate = new RestTemplate();
    try {
        return restTemplate.getForObject(url, String.class);
    } catch (ResourceAccessException e) {
        // ç½‘ç»œè¶…æ—¶ã€è¿æ¥å¤±è´¥ç­‰
        throw new BusinessException("å¤–éƒ¨æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
    }
}
```

**è¶…æ—¶å¼‚å¸¸å¤„ç†**ï¼š

```java
@ExceptionHandler(ResourceAccessException.class)
public Result handleNetworkTimeout(ResourceAccessException e) {
    log.error("ç½‘ç»œè¯·æ±‚è¶…æ—¶: {}", e.getMessage());
    return Result.error("ç½‘ç»œè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•");
}
```

### 5.3 ç³»ç»Ÿå¼‚å¸¸å¤„ç†æµç¨‹


```
å¼‚å¸¸å‘ç”Ÿ
    â†“
[æ˜¯å¦ä¸šåŠ¡å¼‚å¸¸?]
    â†“ æ˜¯
è¿”å›ä¸šåŠ¡é”™è¯¯ä¿¡æ¯ï¼ˆwarnæ—¥å¿—ï¼‰
    â†“ å¦
[æ˜¯å¦å¯æ¢å¤?]
    â†“ æ˜¯
é‡è¯•æœºåˆ¶
    â†“ å¦
è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼ˆerroræ—¥å¿—ï¼‰
    â†“
è¿”å›é€šç”¨é”™è¯¯æç¤º
    â†“
å‘é€å‘Šè­¦é€šçŸ¥å¼€å‘äººå‘˜
```

### 5.4 é€šç”¨ç³»ç»Ÿå¼‚å¸¸å¤„ç†


```java
/**
 * å…œåº•å¼‚å¸¸å¤„ç†å™¨
 * æ•è·æ‰€æœ‰æœªè¢«ç‰¹å®šå¤„ç†å™¨å¤„ç†çš„å¼‚å¸¸
 */
@ExceptionHandler(Exception.class)
public Result handleException(Exception e) {
    log.error("ç³»ç»Ÿå¼‚å¸¸", e);
    
    // ç”Ÿäº§ç¯å¢ƒï¼šè¿”å›é€šç”¨æç¤º
    if (isProdEnvironment()) {
        return Result.error("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
    
    // å¼€å‘ç¯å¢ƒï¼šè¿”å›è¯¦ç»†é”™è¯¯
    return Result.error("ç³»ç»Ÿé”™è¯¯: " + e.getMessage());
}
```

---

## 6. ğŸ—„ï¸ æ•°æ®åº“å¼‚å¸¸


### 6.1 æ•°æ®åº“è¿æ¥å¼‚å¸¸


> ğŸ“– **é€šä¿—è§£é‡Š**  
> æ•°æ®åº“è¿æ¥å¼‚å¸¸å°±åƒï¼šæ‰“ç”µè¯æ‰“ä¸é€šï¼Œå¯èƒ½æ˜¯å¯¹æ–¹å…³æœºã€ä¿¡å·å·®ã€å·ç é”™è¯¯ç­‰

**å…¸å‹åœºæ™¯**ï¼š
- æ•°æ®åº“æœåŠ¡æœªå¯åŠ¨
- è¿æ¥æ± è€—å°½
- ç½‘ç»œä¸é€š
- è´¦å·å¯†ç é”™è¯¯

```java
@ExceptionHandler(DataAccessException.class)
public Result handleDataAccessException(DataAccessException e) {
    log.error("æ•°æ®åº“è®¿é—®å¼‚å¸¸", e);
    
    // æ ¹æ®å…·ä½“å¼‚å¸¸ç±»å‹è¿”å›ä¸åŒæç¤º
    if (e instanceof CannotGetJdbcConnectionException) {
        return Result.error("æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
    }
    
    return Result.error("æ•°æ®æ“ä½œå¤±è´¥");
}
```

### 6.2 SQLè¯­æ³•é”™è¯¯


**å…¸å‹å¼‚å¸¸**ï¼š`BadSqlGrammarException`

```java
// é”™è¯¯SQLç¤ºä¾‹ï¼ˆæ‹¼å†™é”™è¯¯ï¼‰
@Select("SELEC * FROM user WHERE id = #{id}")  // SELEC æ‹¼å†™é”™è¯¯
User getById(Long id);
```

**å¤„ç†æ–¹å¼**ï¼š

```java
@ExceptionHandler(BadSqlGrammarException.class)
public Result handleBadSql(BadSqlGrammarException e) {
    log.error("SQLè¯­æ³•é”™è¯¯: {}", e.getSql());
    return Result.error("æ•°æ®æŸ¥è¯¢å¤±è´¥");
}
```

### 6.3 å”¯ä¸€çº¦æŸå†²çª


**å…¸å‹å¼‚å¸¸**ï¼š`DuplicateKeyException`

> ğŸ’¡ **å®é™…åœºæ™¯**  
> æ¯”å¦‚ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç”¨æˆ·åå·²å­˜åœ¨ï¼›æ·»åŠ å•†å“æ—¶ï¼Œå•†å“ç¼–ç é‡å¤

```java
@Service
public class UserService {
    
    public void register(UserRegisterDTO dto) {
        try {
            userMapper.insert(dto);
        } catch (DuplicateKeyException e) {
            // åˆ¤æ–­æ˜¯å“ªä¸ªå­—æ®µé‡å¤
            if (e.getMessage().contains("username")) {
                throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
            } else if (e.getMessage().contains("email")) {
                throw new BusinessException("é‚®ç®±å·²è¢«æ³¨å†Œ");
            }
            throw new BusinessException("æ•°æ®é‡å¤");
        }
    }
}
```

**å…¨å±€å¤„ç†**ï¼š

```java
@ExceptionHandler(DuplicateKeyException.class)
public Result handleDuplicateKey(DuplicateKeyException e) {
    log.warn("å”¯ä¸€çº¦æŸå†²çª: {}", e.getMessage());
    
    // æå–å…·ä½“å­—æ®µåï¼ˆç®€åŒ–ç‰ˆï¼‰
    String message = "æ•°æ®é‡å¤ï¼Œè¯·æ£€æŸ¥è¾“å…¥";
    if (e.getMessage().contains("username")) {
        message = "ç”¨æˆ·åå·²å­˜åœ¨";
    }
    
    return Result.error(message);
}
```

### 6.4 æ•°æ®åº“å¼‚å¸¸å¯¹ç…§è¡¨


| å¼‚å¸¸ç±»å‹ | **åŸå› ** | **å¸¸è§åœºæ™¯** | **å¤„ç†å»ºè®®** |
|---------|---------|------------|-------------|
| `CannotGetJdbcConnectionException` | `æ— æ³•è·å–è¿æ¥` | `æ•°æ®åº“å®•æœºã€è¿æ¥æ± æ»¡` | `æ£€æŸ¥æ•°æ®åº“çŠ¶æ€å’Œè¿æ¥é…ç½®` |
| `BadSqlGrammarException` | `SQLè¯­æ³•é”™è¯¯` | `æ‹¼å†™é”™è¯¯ã€è¡¨ä¸å­˜åœ¨` | `æ£€æŸ¥SQLè¯­å¥` |
| `DuplicateKeyException` | `å”¯ä¸€çº¦æŸå†²çª` | `ä¸»é”®/å”¯ä¸€ç´¢å¼•é‡å¤` | `æç¤ºç”¨æˆ·é‡å¤å­—æ®µ` |
| `DataIntegrityViolationException` | `æ•°æ®å®Œæ•´æ€§çº¦æŸ` | `å¤–é”®çº¦æŸã€éç©ºçº¦æŸ` | `æ£€æŸ¥æ•°æ®åˆæ³•æ€§` |

---

## 7. ğŸ“ æ–‡ä»¶å¤„ç†å¼‚å¸¸


### 7.1 æ–‡ä»¶ä¸Šä¼ å¼‚å¸¸


**å…¸å‹å¼‚å¸¸**ï¼š`MaxUploadSizeExceededException`

> ğŸ¯ **åœºæ™¯è¯´æ˜**  
> ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¶…è¿‡äº†ç³»ç»Ÿé™åˆ¶çš„å¤§å°

**é…ç½®æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š
```yaml
# application.yml
spring:
  servlet:
    multipart:
      max-file-size: 10MB      # å•ä¸ªæ–‡ä»¶æœ€å¤§10MB
      max-request-size: 50MB   # æ•´ä¸ªè¯·æ±‚æœ€å¤§50MB
```

**å¼‚å¸¸å¤„ç†**ï¼š

```java
@ExceptionHandler(MaxUploadSizeExceededException.class)
public Result handleMaxUploadSize(MaxUploadSizeExceededException e) {
    long maxSize = e.getMaxUploadSize();
    String sizeStr = (maxSize / 1024 / 1024) + "MB";
    
    return Result.error(
        String.format("æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼Œæœ€å¤§å…è®¸: %s", sizeStr)
    );
}
```

### 7.2 æ–‡ä»¶ç±»å‹æ ¡éªŒ


```java
@PostMapping("/upload")
public Result uploadFile(@RequestParam("file") MultipartFile file) {
    
    // 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
    if (file.isEmpty()) {
        throw new BusinessException("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶");
    }
    
    // 2. æ£€æŸ¥æ–‡ä»¶ç±»å‹
    String filename = file.getOriginalFilename();
    String suffix = filename.substring(filename.lastIndexOf("."));
    List<String> allowTypes = Arrays.asList(".jpg", ".png", ".pdf");
    
    if (!allowTypes.contains(suffix.toLowerCase())) {
        throw new BusinessException(
            "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒ: " + String.join(", ", allowTypes)
        );
    }
    
    // 3. ä¿å­˜æ–‡ä»¶...
    return Result.success("ä¸Šä¼ æˆåŠŸ");
}
```

### 7.3 æ–‡ä»¶è¯»å†™å¼‚å¸¸


**å…¸å‹å¼‚å¸¸**ï¼š`IOException`

```java
@GetMapping("/download/{fileId}")
public void downloadFile(@PathVariable String fileId, 
                         HttpServletResponse response) {
    try {
        File file = fileService.getFile(fileId);
        
        // è®¾ç½®å“åº”å¤´
        response.setContentType("application/octet-stream");
        response.setHeader("Content-Disposition", 
                          "attachment; filename=" + file.getName());
        
        // è¾“å‡ºæ–‡ä»¶æµ
        Files.copy(file.toPath(), response.getOutputStream());
        
    } catch (IOException e) {
        log.error("æ–‡ä»¶ä¸‹è½½å¤±è´¥", e);
        throw new BusinessException("æ–‡ä»¶ä¸‹è½½å¤±è´¥");
    }
}
```

**ç»Ÿä¸€IOå¼‚å¸¸å¤„ç†**ï¼š

```java
@ExceptionHandler(IOException.class)
public Result handleIOException(IOException e) {
    log.error("IOæ“ä½œå¼‚å¸¸", e);
    return Result.error("æ–‡ä»¶æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•");
}
```

### 7.4 æ–‡ä»¶å¼‚å¸¸å¤„ç†è¦ç‚¹


```
æ–‡ä»¶ä¸Šä¼ å¤„ç†æµç¨‹ï¼š

æ¥æ”¶æ–‡ä»¶
    â†“
[æ–‡ä»¶æ˜¯å¦ä¸ºç©º?] â†’ æ˜¯ â†’ æç¤º"è¯·é€‰æ‹©æ–‡ä»¶"
    â†“ å¦
[æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™?] â†’ æ˜¯ â†’ æç¤º"æ–‡ä»¶è¿‡å¤§"
    â†“ å¦
[æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸?] â†’ å¦ â†’ æç¤º"æ ¼å¼ä¸æ”¯æŒ"
    â†“ æ˜¯
[å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³?] â†’ å¦ â†’ æç¤º"ç©ºé—´ä¸è¶³"
    â†“ æ˜¯
ä¿å­˜æ–‡ä»¶æˆåŠŸ
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¼‚å¸¸åˆ†ç±»è®°å¿†


```
æŒ‰æ¥æºåˆ†ç±»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¢æˆ·ç«¯å¼‚å¸¸ (4xx)                     â”‚
â”‚ - å‚æ•°é”™è¯¯ã€æ•°æ®æ ¡éªŒå¤±è´¥             â”‚
â”‚ - è¯·æ±‚æ–¹æ³•é”™è¯¯ã€ç¼ºå°‘å¿…éœ€å‚æ•°          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡ç«¯å¼‚å¸¸ (5xx)                     â”‚
â”‚ - ç©ºæŒ‡é’ˆã€æ•°æ®åº“é”™è¯¯                 â”‚
â”‚ - ç³»ç»Ÿå¼‚å¸¸ã€ç½‘ç»œè¶…æ—¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


> ğŸ¯ **æ ¸å¿ƒåŸåˆ™**

**1. åˆ†å±‚å¤„ç†**
```
ä¸šåŠ¡å±‚ï¼šthrow BusinessExceptionï¼ˆé¢„æœŸé”™è¯¯ï¼‰
æ§åˆ¶å±‚ï¼š@ExceptionHandler æ•è·
å…¨å±€å±‚ï¼š@ControllerAdvice ç»Ÿä¸€å¤„ç†
```

**2. æ—¥å¿—è®°å½•**
```
ä¸šåŠ¡å¼‚å¸¸ï¼šwarn çº§åˆ«ï¼ˆæ­£å¸¸ä¸šåŠ¡æµç¨‹ï¼‰
ç³»ç»Ÿå¼‚å¸¸ï¼šerror çº§åˆ«ï¼ˆéœ€è¦ä¿®å¤çš„bugï¼‰
æ•æ„Ÿä¿¡æ¯ï¼šè„±æ•å¤„ç†åè®°å½•
```

**3. ç”¨æˆ·å‹å¥½**
```
ç”Ÿäº§ç¯å¢ƒï¼šè¿”å›é€šç”¨æç¤º
å¼€å‘ç¯å¢ƒï¼šè¿”å›è¯¦ç»†é”™è¯¯
æ°¸è¿œä¸è¦ï¼šæš´éœ²æŠ€æœ¯ç»†èŠ‚ç»™ç”¨æˆ·
```

### 8.3 å¸¸è§å¼‚å¸¸é€ŸæŸ¥è¡¨


| å¼‚å¸¸åç§° | **è§¦å‘åœºæ™¯** | **é”™è¯¯ç ** | **å¤„ç†æ–¹å¼** |
|---------|------------|----------|-------------|
| `MethodArgumentTypeMismatchException` | `å‚æ•°ç±»å‹ä¸åŒ¹é…` | `400` | `æç¤ºæ­£ç¡®çš„å‚æ•°æ ¼å¼` |
| `MethodArgumentNotValidException` | `æ•°æ®æ ¡éªŒå¤±è´¥` | `400` | `è¿”å›æ‰€æœ‰æ ¡éªŒé”™è¯¯` |
| `MissingServletRequestParameterException` | `ç¼ºå°‘å¿…éœ€å‚æ•°` | `400` | `æç¤ºç¼ºå°‘çš„å‚æ•°å` |
| `BusinessException` | `ä¸šåŠ¡è§„åˆ™é™åˆ¶` | `400` | `è¿”å›å…·ä½“ä¸šåŠ¡æç¤º` |
| `NullPointerException` | `å¯¹è±¡æœªåˆå§‹åŒ–` | `500` | `è®°å½•æ—¥å¿—+é€šç”¨æç¤º` |
| `DuplicateKeyException` | `å”¯ä¸€çº¦æŸå†²çª` | `400` | `æç¤ºé‡å¤çš„å­—æ®µ` |
| `IOException` | `æ–‡ä»¶è¯»å†™å¤±è´¥` | `500` | `æç¤ºæ“ä½œå¤±è´¥` |

### 8.4 ç»Ÿä¸€è¿”å›ç»“æ„


```java
/**
 * ç»Ÿä¸€è¿”å›å¯¹è±¡
 */
public class Result<T> {
    private Integer code;      // çŠ¶æ€ç 
    private String message;    // æç¤ºä¿¡æ¯
    private T data;           // è¿”å›æ•°æ®
    private Long timestamp;   // æ—¶é—´æˆ³
    
    // æˆåŠŸå“åº”
    public static <T> Result<T> success(T data) {
        return new Result<>(200, "success", data);
    }
    
    // å¤±è´¥å“åº”
    public static Result error(String message) {
        return new Result<>(400, message, null);
    }
    
    public static Result error(Integer code, String message) {
        return new Result<>(code, message, null);
    }
}
```

### 8.5 å®Œæ•´å¼‚å¸¸å¤„ç†å™¨ç¤ºä¾‹


```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    // 1. ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public Result handleBusiness(BusinessException e) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // 2. æ•°æ®æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidation(MethodArgumentNotValidException e) {
        String errors = e.getBindingResult().getFieldErrors()
            .stream()
            .map(err -> err.getField() + ": " + err.getDefaultMessage())
            .collect(Collectors.joining(", "));
        return Result.error(errors);
    }
    
    // 3. æ•°æ®åº“å¼‚å¸¸
    @ExceptionHandler(DataAccessException.class)
    public Result handleDataAccess(DataAccessException e) {
        log.error("æ•°æ®åº“å¼‚å¸¸", e);
        if (e instanceof DuplicateKeyException) {
            return Result.error("æ•°æ®å·²å­˜åœ¨");
        }
        return Result.error("æ•°æ®æ“ä½œå¤±è´¥");
    }
    
    // 4. ç³»ç»Ÿå¼‚å¸¸ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return Result.error("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**  
> 1. ä»å¸¸è§å¼‚å¸¸å…¥æ‰‹ï¼Œé€æ­¥æŒæ¡å„ç±»å¼‚å¸¸çš„å¤„ç†æ–¹å¼
> 2. è‡ªå·±åŠ¨æ‰‹å†™ä»£ç è§¦å‘å¼‚å¸¸ï¼Œè§‚å¯Ÿå¼‚å¸¸ä¿¡æ¯
> 3. æ—¥å¿—æ˜¯æ’æŸ¥é—®é¢˜çš„å…³é”®ï¼Œå…»æˆæŸ¥çœ‹æ—¥å¿—çš„ä¹ æƒ¯
> 4. ç”Ÿäº§ç¯å¢ƒè¦ä¿æŠ¤ç³»ç»Ÿä¿¡æ¯ï¼Œä¸è¦æš´éœ²æŠ€æœ¯ç»†èŠ‚

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å¼‚å¸¸å¤„ç†åˆ†ä¸‰å±‚ï¼Œä¸šåŠ¡ç³»ç»Ÿè¦åŒºåˆ†
- å®¢æˆ·ç«¯é”™è¯¯4å¼€å¤´ï¼ŒæœåŠ¡ç«¯é—®é¢˜5ç›¸è¿
- æ—¥å¿—è®°å½•è¦å®Œæ•´ï¼Œç”¨æˆ·æç¤ºè¦å‹å¥½
- é¢„æœŸé”™è¯¯æŠ›ä¸šåŠ¡ï¼Œæ„å¤–é”™è¯¯è®°ç³»ç»Ÿ