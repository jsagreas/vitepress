---
title: 1ã€å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [å¼‚å¸¸å¤„ç†æœºåˆ¶æ¦‚è¿°](#1-å¼‚å¸¸å¤„ç†æœºåˆ¶æ¦‚è¿°)
2. [HandlerExceptionResolverè§£æå™¨](#2-HandlerExceptionResolverè§£æå™¨)
3. [å…¨å±€å¼‚å¸¸å¤„ç†å®æˆ˜](#3-å…¨å±€å¼‚å¸¸å¤„ç†å®æˆ˜)
4. [ç»Ÿä¸€è¿”å›ç»“æœå°è£…](#4-ç»Ÿä¸€è¿”å›ç»“æœå°è£…)
5. [å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ](#5-å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¼‚å¸¸å¤„ç†æœºåˆ¶æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†


**ç°å®é—®é¢˜**ï¼š
æƒ³è±¡ä½ å¼€å‘äº†ä¸€ä¸ªå•†åŸç½‘ç«™ï¼Œç”¨æˆ·åœ¨è´­ä¹°å•†å“æ—¶å¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼š
- å•†å“åº“å­˜ä¸è¶³
- æ”¯ä»˜å¤±è´¥
- ç½‘ç»œè¶…æ—¶
- æ•°æ®æ ¼å¼é”™è¯¯

å¦‚æœä¸å¤„ç†è¿™äº›å¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šç›´æ¥å´©æºƒï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯ä¸€å †çœ‹ä¸æ‡‚çš„é”™è¯¯ä¿¡æ¯ï¼Œä½“éªŒæå·®ï¼

```
âŒ æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„æƒ…å†µï¼š
ç”¨æˆ·ç‚¹å‡»"è´­ä¹°" 
    â†“
åº“å­˜ä¸è¶³ï¼Œç¨‹åºå´©æºƒ
    â†“
ç”¨æˆ·çœ‹åˆ°ï¼š500 Internal Server Error
    â†“
ä¸€è„¸æ‡µé€¼ï¼Œä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ

âœ… æœ‰å¼‚å¸¸å¤„ç†çš„æƒ…å†µï¼š
ç”¨æˆ·ç‚¹å‡»"è´­ä¹°"
    â†“
åº“å­˜ä¸è¶³ï¼Œæ•è·å¼‚å¸¸
    â†“
è¿”å›å‹å¥½æç¤ºï¼š"æŠ±æ­‰ï¼Œå•†å“åº“å­˜ä¸è¶³"
    â†“
ç”¨æˆ·æ˜ç™½äº†ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–å•†å“
```

### 1.2 Spring MVCå¼‚å¸¸å¤„ç†çš„ä¸‰ç§ç­–ç•¥


Spring MVCæä¾›äº†ä¸‰ç§å¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼Œå°±åƒä¸‰é“é˜²çº¿ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–ç•¥1: @ExceptionHandler           â”‚
â”‚  (å±€éƒ¨å¼‚å¸¸å¤„ç† - åªç®¡è‡ªå·±æ§åˆ¶å™¨)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­–ç•¥2: @ControllerAdvice            â”‚
â”‚  (å…¨å±€å¼‚å¸¸å¤„ç† - ç®¡æ‰€æœ‰æ§åˆ¶å™¨)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­–ç•¥3: SimpleMappingExceptionResolverâ”‚
â”‚  (é…ç½®å¼å¤„ç† - ç®€å•ç²—æš´)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ ç­–ç•¥å¯¹æ¯”**

| ç­–ç•¥ç±»å‹ | **ä½œç”¨èŒƒå›´** | **çµæ´»æ€§** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|----------|------------|
| `@ExceptionHandler` | å•ä¸ªController | â­â­ | ç‰¹æ®Šä¸šåŠ¡å¼‚å¸¸ |
| `@ControllerAdvice` | å…¨å±€æ‰€æœ‰Controller | â­â­â­ | **æ¨èä½¿ç”¨** |
| `SimpleMappingExceptionResolver` | å…¨å±€ | â­ | ç®€å•é¡¹ç›® |

### 1.3 å¼‚å¸¸å¤„ç†çš„æ‰§è¡Œæµç¨‹


è®©æˆ‘ä»¬çœ‹çœ‹å½“ç¨‹åºå‡ºé”™æ—¶ï¼ŒSpring MVCæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š

```
ç”¨æˆ·è¯·æ±‚
   â†“
Controllerå¤„ç†ä¸šåŠ¡
   â†“
[å‡ºç°å¼‚å¸¸ï¼]
   â†“
â”Œâ”€â†’ å…ˆæ‰¾æœ¬Controllerçš„@ExceptionHandler
â”‚       â†“ (æ²¡æ‰¾åˆ°)
â”œâ”€â†’ å†æ‰¾å…¨å±€@ControllerAdvice
â”‚       â†“ (æ²¡æ‰¾åˆ°)  
â””â”€â†’ æœ€åæ‰¾é»˜è®¤å¼‚å¸¸å¤„ç†å™¨
       â†“
   è¿”å›å¼‚å¸¸ä¿¡æ¯ç»™ç”¨æˆ·
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šå¼‚å¸¸å¤„ç†æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œå°±åƒæ‰¾äººå¸®å¿™ä¸€æ ·ï¼Œå…ˆæ‰¾èº«è¾¹çš„äººï¼ˆå±€éƒ¨ï¼‰ï¼Œå†æ‰¾ä¸“ä¸šçš„äººï¼ˆå…¨å±€ï¼‰ï¼Œå®åœ¨ä¸è¡Œæ‰¾é»˜è®¤çš„æ•‘æ€¥æ–¹æ¡ˆã€‚

---

## 2. ğŸ”§ HandlerExceptionResolverè§£æå™¨


### 2.1 ä»€ä¹ˆæ˜¯HandlerExceptionResolver


**é€šä¿—è§£é‡Š**ï¼š
`HandlerExceptionResolver`å°±åƒä¸€ä¸ª"å¼‚å¸¸ç¿»è¯‘å®˜"ï¼Œå®ƒçš„å·¥ä½œæ˜¯ï¼š
- **ç›‘å¬**ï¼šæ—¶åˆ»ç›‘å¬ç¨‹åºæœ‰æ²¡æœ‰å‡ºé”™
- **ç¿»è¯‘**ï¼šæŠŠç¨‹åºå‘˜æ‰æ‡‚çš„é”™è¯¯ä¿¡æ¯ï¼Œç¿»è¯‘æˆç”¨æˆ·èƒ½çœ‹æ‡‚çš„è¯
- **è¿”å›**ï¼šæŠŠç¿»è¯‘åçš„ä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·

```java
// è¿™æ˜¯Spring MVCæä¾›çš„å¼‚å¸¸å¤„ç†å™¨æ¥å£
public interface HandlerExceptionResolver {
    // å½“å‡ºç°å¼‚å¸¸æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨
    ModelAndView resolveException(
        HttpServletRequest request,      // è¯·æ±‚ä¿¡æ¯
        HttpServletResponse response,    // å“åº”ä¿¡æ¯
        Object handler,                  // å‡ºé”™çš„å¤„ç†å™¨
        Exception ex                     // å…·ä½“çš„å¼‚å¸¸
    );
}
```

### 2.2 Spring MVCå†…ç½®çš„å¼‚å¸¸å¤„ç†å™¨


Spring MVCé»˜è®¤æä¾›äº†ä¸‰ä¸ª"ç¿»è¯‘å®˜"ï¼ŒæŒ‰é¡ºåºå·¥ä½œï¼š

```
å¼‚å¸¸å‘ç”Ÿ
   â†“
â‘  ExceptionHandlerExceptionResolver
   (å¤„ç†@ExceptionHandleræ³¨è§£çš„æ–¹æ³•)
   â†“ å¤„ç†ä¸äº†
â‘¡ ResponseStatusExceptionResolver  
   (å¤„ç†@ResponseStatusæ³¨è§£çš„å¼‚å¸¸)
   â†“ å¤„ç†ä¸äº†
â‘¢ DefaultHandlerExceptionResolver
   (å¤„ç†Spring MVCæ ‡å‡†å¼‚å¸¸)
   â†“ éƒ½å¤„ç†ä¸äº†
   æŠ›ç»™Servletå®¹å™¨å¤„ç†
```

**ğŸ”¸ å„ä¸ªå¤„ç†å™¨çš„èŒè´£**

â‘  **ExceptionHandlerExceptionResolver** - æœ€å¸¸ç”¨
- è´Ÿè´£å¤„ç†`@ExceptionHandler`æ ‡æ³¨çš„æ–¹æ³•
- æ”¯æŒçµæ´»çš„å‚æ•°å’Œè¿”å›å€¼
- **æ¨èä½¿ç”¨è¿™ä¸ªï¼**

â‘¡ **ResponseStatusExceptionResolver** - å¤„ç†çŠ¶æ€ç 
- å¤„ç†å¸¦`@ResponseStatus`æ³¨è§£çš„å¼‚å¸¸ç±»
- è‡ªåŠ¨è®¾ç½®HTTPçŠ¶æ€ç 

â‘¢ **DefaultHandlerExceptionResolver** - å…œåº•å¤„ç†
- å¤„ç†Spring MVCè‡ªå·±çš„æ ‡å‡†å¼‚å¸¸
- æ¯”å¦‚ï¼š404ã€405ã€400ç­‰

### 2.3 å¼‚å¸¸å¤„ç†ä¼˜å…ˆçº§æœºåˆ¶


**ç†è§£ä¼˜å…ˆçº§**ï¼šå°±åƒåŒ»é™¢çœ‹ç—…çš„æµç¨‹

```
ç—…äºº(å¼‚å¸¸)æ¥äº†
   â†“
â‘  å…ˆçœ‹é—¨è¯ŠåŒ»ç”Ÿ(@ExceptionHandler - å±€éƒ¨)
   â†“ çœ‹ä¸äº†
â‘¡ è½¬åˆ°ä¸“å®¶é—¨è¯Š(@ControllerAdvice - å…¨å±€)
   â†“ è¿˜çœ‹ä¸äº†  
â‘¢ è½¬åˆ°æ€¥è¯Šå®¤(DefaultHandlerExceptionResolver)
   â†“ å®åœ¨ä¸è¡Œ
â‘£ è½¬é™¢(Servletå®¹å™¨å¤„ç†)
```

**ä¼˜å…ˆçº§è§„åˆ™**ï¼š
1. å±€éƒ¨ > å…¨å±€
2. ç²¾ç¡®åŒ¹é… > æ¨¡ç³ŠåŒ¹é…
3. å­ç±»å¼‚å¸¸ > çˆ¶ç±»å¼‚å¸¸

```java
// ä¸¾ä¸ªä¾‹å­ï¼š
@ExceptionHandler(NullPointerException.class)  // ä¼˜å…ˆçº§é«˜ï¼ˆç²¾ç¡®ï¼‰
public String handleNPE() { ... }

@ExceptionHandler(RuntimeException.class)      // ä¼˜å…ˆçº§ä½ï¼ˆæ¨¡ç³Šï¼‰
public String handleRuntime() { ... }

// å¦‚æœå‘ç”ŸNullPointerExceptionï¼Œä¼šèµ°ç¬¬ä¸€ä¸ªæ–¹æ³•
```

---

## 3. ğŸŒ å…¨å±€å¼‚å¸¸å¤„ç†å®æˆ˜


### 3.1 ä½¿ç”¨@ControllerAdviceå®ç°å…¨å±€å¤„ç†


**ä»€ä¹ˆæ˜¯@ControllerAdviceï¼Ÿ**
- `@ControllerAdvice`ï¼šæŠŠå®ƒç†è§£ä¸º"å…¨å±€æ§åˆ¶å™¨é¡¾é—®"
- å®ƒå¯ä»¥ç›‘æ§æ‰€æœ‰Controllerçš„å¼‚å¸¸
- ä¸€ä¸ªåœ°æ–¹å¤„ç†ï¼Œå…¨å±€ç”Ÿæ•ˆ

**åŸºç¡€ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@ControllerAdvice  // å£°æ˜è¿™æ˜¯ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†ç±»
public class GlobalExceptionHandler {
    
    // å¤„ç†ç©ºæŒ‡é’ˆå¼‚å¸¸
    @ExceptionHandler(NullPointerException.class)
    public String handleNullPointer(Exception e) {
        System.out.println("æ•è·åˆ°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š" + e.getMessage());
        return "error/null-pointer";  // è·³è½¬åˆ°é”™è¯¯é¡µé¢
    }
    
    // å¤„ç†æ‰€æœ‰å…¶ä»–å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public String handleException(Exception e) {
        System.out.println("æ•è·åˆ°æœªçŸ¥å¼‚å¸¸ï¼š" + e.getMessage());
        return "error/500";
    }
}
```

### 3.2 è¿”å›JSONæ ¼å¼çš„å¼‚å¸¸ä¿¡æ¯


**å®é™…é¡¹ç›®ä¸­æ›´å¸¸ç”¨çš„æ–¹å¼**ï¼šè¿”å›JSONè€Œä¸æ˜¯è·³è½¬é¡µé¢

```java
@RestControllerAdvice  // = @ControllerAdvice + @ResponseBody
public class GlobalExceptionHandler {
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidException(MethodArgumentNotValidException e) {
        // è·å–ç¬¬ä¸€ä¸ªæ ¡éªŒå¤±è´¥çš„ä¿¡æ¯
        String message = e.getBindingResult()
                          .getFieldError()
                          .getDefaultMessage();
        return Result.error(400, message);
    }
    
    // å…œåº•ï¼šå¤„ç†æ‰€æœ‰æœªçŸ¥å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        e.printStackTrace();  // å¼€å‘ç¯å¢ƒæ‰“å°è¯¦ç»†ä¿¡æ¯
        return Result.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

**ğŸ’¡ å·¥ä½œæµç¨‹å›¾**ï¼š

```
ç”¨æˆ·è¯·æ±‚ â†’ Controller â†’ ä¸šåŠ¡é€»è¾‘
                           â†“
                      [æŠ›å‡ºå¼‚å¸¸]
                           â†“
              GlobalExceptionHandleræ‹¦æˆª
                           â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 1. è®°å½•æ—¥å¿—          â”‚
              â”‚ 2. åˆ¤æ–­å¼‚å¸¸ç±»å‹      â”‚
              â”‚ 3. è¿”å›å‹å¥½æç¤º      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    è¿”å›JSONç»™å‰ç«¯
```

### 3.3 è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»


**ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰å¼‚å¸¸ï¼Ÿ**
- åŒºåˆ†ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯
- æºå¸¦é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯
- æ–¹ä¾¿ç»Ÿä¸€å¤„ç†

```java
// è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸åŸºç±»
public class BusinessException extends RuntimeException {
    
    private Integer code;    // é”™è¯¯ç 
    private String message;  // é”™è¯¯ä¿¡æ¯
    
    public BusinessException(Integer code, String message) {
        super(message);  // è°ƒç”¨çˆ¶ç±»æ„é€ 
        this.code = code;
        this.message = message;
    }
    
    // å¿«æ·æ„é€ æ–¹æ³•
    public BusinessException(ErrorCode errorCode) {
        this(errorCode.getCode(), errorCode.getMessage());
    }
    
    // getteræ–¹æ³•
    public Integer getCode() { return code; }
    public String getMessage() { return message; }
}

// é”™è¯¯ç æšä¸¾
public enum ErrorCode {
    USER_NOT_FOUND(1001, "ç”¨æˆ·ä¸å­˜åœ¨"),
    PASSWORD_ERROR(1002, "å¯†ç é”™è¯¯"),
    STOCK_NOT_ENOUGH(2001, "åº“å­˜ä¸è¶³"),
    ORDER_NOT_FOUND(2002, "è®¢å•ä¸å­˜åœ¨");
    
    private Integer code;
    private String message;
    
    ErrorCode(Integer code, String message) {
        this.code = code;
        this.message = message;
    }
    
    // getteræ–¹æ³•...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@Service
public class UserService {
    
    public User login(String username, String password) {
        User user = userDao.findByUsername(username);
        
        // ç”¨æˆ·ä¸å­˜åœ¨ï¼ŒæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
        if (user == null) {
            throw new BusinessException(ErrorCode.USER_NOT_FOUND);
        }
        
        // å¯†ç é”™è¯¯ï¼ŒæŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
        if (!user.getPassword().equals(password)) {
            throw new BusinessException(ErrorCode.PASSWORD_ERROR);
        }
        
        return user;
    }
}
```

---

## 4. ğŸ“¦ ç»Ÿä¸€è¿”å›ç»“æœå°è£…


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€è¿”å›æ ¼å¼


**é—®é¢˜åœºæ™¯**ï¼š
ä¸åŒçš„æ¥å£è¿”å›æ ¼å¼ä¸ä¸€æ ·ï¼Œå‰ç«¯å¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ï¼š

```java
âŒ æ··ä¹±çš„è¿”å›æ ¼å¼ï¼š

// æ¥å£1è¿”å›è¿™æ ·ï¼š
{ "data": {...} }

// æ¥å£2è¿”å›è¿™æ ·ï¼š
{ "success": true, "result": {...} }

// æ¥å£3è¿”å›è¿™æ ·ï¼š
{ "code": 200, "message": "æˆåŠŸ", "data": {...} }

// å‰ç«¯ï¼šæˆ‘å¤ªéš¾äº†ï¼Œæ¯ä¸ªæ¥å£éƒ½è¦å•ç‹¬å¤„ç† ğŸ˜­
```

**ç»Ÿä¸€å**ï¼š

```java
âœ… ç»Ÿä¸€çš„è¿”å›æ ¼å¼ï¼š

æ‰€æœ‰æ¥å£éƒ½è¿”å›è¿™æ ·ï¼š
{
    "code": 200,           // çŠ¶æ€ç 
    "message": "æ“ä½œæˆåŠŸ",  // æç¤ºä¿¡æ¯
    "data": {...}          // ä¸šåŠ¡æ•°æ®
}

// å‰ç«¯ï¼šå¤ªçˆ½äº†ï¼Œç»Ÿä¸€å¤„ç†ï¼ğŸ˜Š
```

### 4.2 é€šç”¨è¿”å›ç»“æœç±»è®¾è®¡


```java
public class Result<T> {
    
    private Integer code;     // çŠ¶æ€ç ï¼š200æˆåŠŸï¼Œå…¶ä»–å¤±è´¥
    private String message;   // æç¤ºä¿¡æ¯
    private T data;          // ä¸šåŠ¡æ•°æ®ï¼ˆæ³›å‹ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰
    
    // ç§æœ‰æ„é€ æ–¹æ³•ï¼Œä¸è®©å¤–éƒ¨ç›´æ¥new
    private Result() {}
    
    // ====== æˆåŠŸçš„æƒ…å†µ ======
    
    // æˆåŠŸï¼Œæœ‰æ•°æ®
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.code = 200;
        result.message = "æ“ä½œæˆåŠŸ";
        result.data = data;
        return result;
    }
    
    // æˆåŠŸï¼Œæ— æ•°æ®
    public static <T> Result<T> success() {
        return success(null);
    }
    
    // ====== å¤±è´¥çš„æƒ…å†µ ======
    
    // å¤±è´¥ï¼Œè‡ªå®šä¹‰é”™è¯¯ç å’Œä¿¡æ¯
    public static <T> Result<T> error(Integer code, String message) {
        Result<T> result = new Result<>();
        result.code = code;
        result.message = message;
        result.data = null;
        return result;
    }
    
    // å¤±è´¥ï¼Œä½¿ç”¨é”™è¯¯ç æšä¸¾
    public static <T> Result<T> error(ErrorCode errorCode) {
        return error(errorCode.getCode(), errorCode.getMessage());
    }
    
    // getterå’Œsetteræ–¹æ³•...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```java
@RestController
@RequestMapping("/user")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // æŸ¥è¯¢ç”¨æˆ· - è¿”å›æ•°æ®
    @GetMapping("/{id}")
    public Result<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return Result.success(user);  // æˆåŠŸè¿”å›
    }
    
    // åˆ é™¤ç”¨æˆ· - æ— è¿”å›æ•°æ®
    @DeleteMapping("/{id}")
    public Result deleteUser(@PathVariable Long id) {
        userService.deleteById(id);
        return Result.success();  // æˆåŠŸï¼Œæ— æ•°æ®
    }
    
    // ç™»å½• - å¯èƒ½å¤±è´¥
    @PostMapping("/login")
    public Result<String> login(String username, String password) {
        try {
            String token = userService.login(username, password);
            return Result.success(token);
        } catch (BusinessException e) {
            return Result.error(e.getCode(), e.getMessage());
        }
    }
}
```

### 4.3 é…åˆå…¨å±€å¼‚å¸¸å¤„ç†


**å®Œæ•´çš„å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ**ï¼š

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    // ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        // ç›´æ¥è¿”å›å¼‚å¸¸ä¸­çš„é”™è¯¯ç å’Œä¿¡æ¯
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult()
                          .getFieldError()
                          .getDefaultMessage();
        return Result.error(400, message);
    }
    
    // ç³»ç»Ÿå¼‚å¸¸ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        // è®°å½•æ—¥å¿—
        log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š", e);
        // è¿”å›é€šç”¨é”™è¯¯ä¿¡æ¯
        return Result.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
}
```

**å·¥ä½œæµç¨‹ç¤ºæ„**ï¼š

```
Controlleræ–¹æ³•
     â†“
 æ­£å¸¸æ‰§è¡Œ
     â†“
è¿”å› Result.success(data)
     â†“
å‰ç«¯æ”¶åˆ°ï¼š
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {...}
}

Controlleræ–¹æ³•
     â†“
 [æŠ›å‡ºå¼‚å¸¸]
     â†“
GlobalExceptionHandleræ‹¦æˆª
     â†“
è¿”å› Result.error(code, msg)
     â†“
å‰ç«¯æ”¶åˆ°ï¼š
{
  "code": 1001,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "data": null
}
```

---

## 5. ğŸ’¡ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ


### 5.1 å¼‚å¸¸åˆ†ç±»ä¸å¤„ç†ç­–ç•¥


**æŠŠå¼‚å¸¸åˆ†æˆä¸‰ç±»å¤„ç†**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä¸šåŠ¡å¼‚å¸¸ (å¯é¢„çŸ¥çš„)               â”‚
â”‚    - ç”¨æˆ·ä¸å­˜åœ¨ã€åº“å­˜ä¸è¶³...         â”‚
â”‚    â†’ è¿”å›å‹å¥½æç¤ºç»™ç”¨æˆ·              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. ç³»ç»Ÿå¼‚å¸¸ (ä¸å¯é¢„çŸ¥çš„)             â”‚
â”‚    - æ•°æ®åº“è¿æ¥å¤±è´¥ã€ç½‘ç»œè¶…æ—¶...     â”‚
â”‚    â†’ è®°å½•æ—¥å¿—ï¼Œè¿”å›é€šç”¨æç¤º          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. ç¬¬ä¸‰æ–¹å¼‚å¸¸ (å¤–éƒ¨æœåŠ¡çš„)           â”‚
â”‚    - æ”¯ä»˜æ¥å£å¤±è´¥ã€çŸ­ä¿¡å‘é€å¤±è´¥...   â”‚
â”‚    â†’ é‡è¯•æœºåˆ¶ + é™çº§æ–¹æ¡ˆ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ å¤„ç†å»ºè®®**

| å¼‚å¸¸ç±»å‹ | **å¤„ç†æ–¹å¼** | **è¿”å›ç»™ç”¨æˆ·** | **æ˜¯å¦è®°å½•æ—¥å¿—** |
|---------|------------|--------------|----------------|
| ä¸šåŠ¡å¼‚å¸¸ | ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ | âœ… å…·ä½“åŸå›  | å¦ï¼ˆå¤ªå¤šäº†ï¼‰ |
| ç³»ç»Ÿå¼‚å¸¸ | è¿”å›é€šç”¨æç¤º | âš ï¸ "ç³»ç»Ÿç¹å¿™" | **æ˜¯ï¼é‡è¦ï¼** |
| ç¬¬ä¸‰æ–¹å¼‚å¸¸ | é™çº§æˆ–é‡è¯• | æ ¹æ®æƒ…å†µ | æ˜¯ |

### 5.2 é”™è¯¯ç è®¾è®¡è§„èŒƒ


**æ¨èçš„é”™è¯¯ç è®¾è®¡**ï¼š

```
é”™è¯¯ç æ ¼å¼ï¼šABCCC
  â”‚â”‚â”‚â”‚â”‚
  â”‚â”‚â”‚â””â””â†’ å…·ä½“é”™è¯¯åºå· (001-999)
  â”‚â”‚â””â”€â†’ æ¨¡å—ç¼–ç  (1-9)
  â”‚â””â”€â”€â†’ é”™è¯¯ç±»å‹ (1:ä¸šåŠ¡ 2:ç³»ç»Ÿ 3:ç¬¬ä¸‰æ–¹)
  â””â”€â”€â”€â†’ æœåŠ¡ç¼–ç  (1-9)

ç¤ºä¾‹ï¼š
11001 = æœåŠ¡1 + ä¸šåŠ¡é”™è¯¯ + ç”¨æˆ·æ¨¡å— + åºå·001
      = "ç”¨æˆ·ä¸å­˜åœ¨"
      
21005 = æœåŠ¡2 + ä¸šåŠ¡é”™è¯¯ + è®¢å•æ¨¡å— + åºå·005
      = "è®¢å•å·²å…³é—­"
```

**ä»£ç ç¤ºä¾‹**ï¼š

```java
public enum ErrorCode {
    // ç”¨æˆ·ç›¸å…³ (11xxx)
    USER_NOT_FOUND(11001, "ç”¨æˆ·ä¸å­˜åœ¨"),
    PASSWORD_ERROR(11002, "å¯†ç é”™è¯¯"),
    USER_DISABLED(11003, "ç”¨æˆ·å·²ç¦ç”¨"),
    
    // è®¢å•ç›¸å…³ (12xxx)
    ORDER_NOT_FOUND(12001, "è®¢å•ä¸å­˜åœ¨"),
    ORDER_CLOSED(12002, "è®¢å•å·²å…³é—­"),
    STOCK_NOT_ENOUGH(12003, "åº“å­˜ä¸è¶³"),
    
    // ç³»ç»Ÿç›¸å…³ (2xxxx)
    SYSTEM_ERROR(20000, "ç³»ç»Ÿç¹å¿™"),
    DATABASE_ERROR(20001, "æ•°æ®åº“å¼‚å¸¸"),
    NETWORK_ERROR(20002, "ç½‘ç»œå¼‚å¸¸");
    
    // ... æšä¸¾å®šä¹‰
}
```

### 5.3 æ—¥å¿—è®°å½•è§„èŒƒ


**ä»€ä¹ˆæ—¶å€™è®°å½•æ—¥å¿—ï¼Ÿ**

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        // âŒ ä¸šåŠ¡å¼‚å¸¸ä¸è®°å½•ï¼ˆå¤ªå¤šäº†ï¼Œæ²¡æ„ä¹‰ï¼‰
        return Result.error(e.getCode(), e.getMessage());
    }
    
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        // âœ… ç³»ç»Ÿå¼‚å¸¸å¿…é¡»è®°å½•ï¼
        log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š{}", e.getMessage(), e);
        
        // è®°å½•å…³é”®ä¿¡æ¯
        log.error("å¼‚å¸¸ç±»å‹ï¼š{}", e.getClass().getName());
        log.error("å¼‚å¸¸å †æ ˆï¼š", e);
        
        return Result.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•");
    }
    
    @ExceptionHandler(ThirdPartyException.class)
    public Result handleThirdPartyException(ThirdPartyException e) {
        // âœ… ç¬¬ä¸‰æ–¹å¼‚å¸¸è®°å½•è­¦å‘Šçº§åˆ«
        log.warn("ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸ï¼š{} - {}", e.getServiceName(), e.getMessage());
        
        // è¿”å›é™çº§æ–¹æ¡ˆ
        return Result.error(e.getCode(), "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
    }
}
```

### 5.4 å®Œæ•´çš„å¼‚å¸¸å¤„ç†æ–¹æ¡ˆç¤ºä¾‹


**é¡¹ç›®ç»“æ„**ï¼š

```
ğŸ“ com.example.exception
  â”œâ”€ ğŸ“„ BusinessException.java        (ä¸šåŠ¡å¼‚å¸¸åŸºç±»)
  â”œâ”€ ğŸ“„ SystemException.java          (ç³»ç»Ÿå¼‚å¸¸)
  â”œâ”€ ğŸ“„ ThirdPartyException.java      (ç¬¬ä¸‰æ–¹å¼‚å¸¸)
  â”œâ”€ ğŸ“„ ErrorCode.java                (é”™è¯¯ç æšä¸¾)
  â”œâ”€ ğŸ“„ Result.java                   (ç»Ÿä¸€è¿”å›ç±»)
  â””â”€ ğŸ“„ GlobalExceptionHandler.java   (å…¨å±€å¼‚å¸¸å¤„ç†å™¨)
```

**GlobalExceptionHandlerå®Œæ•´ç‰ˆ**ï¼š

```java
@Slf4j  // Lombokçš„æ—¥å¿—æ³¨è§£
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    // 1. ä¸šåŠ¡å¼‚å¸¸ - ç›´æ¥è¿”å›
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // 2. å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValidException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult()
                          .getFieldError()
                          .getDefaultMessage();
        return Result.error(400, message);
    }
    
    // 3. æ•°æ®åº“å¼‚å¸¸
    @ExceptionHandler(DataAccessException.class)
    public Result handleDataAccessException(DataAccessException e) {
        log.error("æ•°æ®åº“å¼‚å¸¸ï¼š", e);
        return Result.error(ErrorCode.DATABASE_ERROR);
    }
    
    // 4. ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸
    @ExceptionHandler(ThirdPartyException.class)
    public Result handleThirdPartyException(ThirdPartyException e) {
        log.warn("ç¬¬ä¸‰æ–¹æœåŠ¡[{}]å¼‚å¸¸ï¼š{}", e.getServiceName(), e.getMessage());
        // å¯ä»¥åœ¨è¿™é‡Œå®ç°é™çº§é€»è¾‘
        return Result.error(e.getCode(), "æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•");
    }
    
    // 5. å…œåº•ï¼šæ‰€æœ‰æœªçŸ¥å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š", e);
        return Result.error(ErrorCode.SYSTEM_ERROR);
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å¼‚å¸¸å¤„ç†ä¸‰å‰‘å®¢**ï¼š
```
@ExceptionHandler    â†’ å®šä¹‰å¼‚å¸¸å¤„ç†æ–¹æ³•
@ControllerAdvice    â†’ å®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†ç±»
@RestControllerAdvice â†’ @ControllerAdvice + @ResponseBody
```

**ğŸ”¸ å¤„ç†ä¼˜å…ˆçº§**ï¼š
```
å±€éƒ¨ > å…¨å±€ > é»˜è®¤
ç²¾ç¡® > æ¨¡ç³Š
å­ç±» > çˆ¶ç±»
```

**ğŸ”¸ ç»Ÿä¸€è¿”å›æ ¼å¼**ï¼š
```json
{
    "code": 200,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {...}
}
```

### 6.2 å®æˆ˜å¼€å‘å»ºè®®


**â‘  å¼‚å¸¸åˆ†å±‚å¤„ç†**
```
Controllerå±‚  â†’ æ•è·å‚æ•°æ ¡éªŒå¼‚å¸¸
Serviceå±‚     â†’ æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
Daoå±‚        â†’ å¤„ç†æ•°æ®åº“å¼‚å¸¸
å…¨å±€å¤„ç†å™¨    â†’ å…œåº•æ‰€æœ‰å¼‚å¸¸
```

**â‘¡ é”™è¯¯ç è®¾è®¡åŸåˆ™**
- æœ‰è§„å¾‹ï¼šä¾¿äºå®šä½é—®é¢˜
- æœ‰æ„ä¹‰ï¼šè§ç çŸ¥æ„
- å¥½æ‰©å±•ï¼šé¢„ç•™ç¼–å·ç©ºé—´

**â‘¢ æ—¥å¿—è®°å½•è¦ç‚¹**
- ä¸šåŠ¡å¼‚å¸¸ï¼šä¸è®°å½•ï¼ˆå¤ªå¤šï¼‰
- ç³»ç»Ÿå¼‚å¸¸ï¼šå¿…é¡»è®°å½•
- æ•æ„Ÿä¿¡æ¯ï¼šè„±æ•å¤„ç†

### 6.3 å¸¸è§é—®é¢˜ä¸è§£å†³


**Q1ï¼šå¼‚å¸¸å¤„ç†æ–¹æ³•æ²¡ç”Ÿæ•ˆï¼Ÿ**
```java
// æ£€æŸ¥æ¸…å•ï¼š
âœ… ç±»ä¸Šæœ‰@ControllerAdviceæ³¨è§£å—ï¼Ÿ
âœ… æ–¹æ³•ä¸Šæœ‰@ExceptionHandleræ³¨è§£å—ï¼Ÿ
âœ… å¼‚å¸¸ç±»å‹åŒ¹é…å—ï¼Ÿ
âœ… åŒ…æ‰«æé…ç½®æ­£ç¡®å—ï¼Ÿ
```

**Q2ï¼šæƒ³è¿”å›ä¸åŒæ ¼å¼æ€ä¹ˆåŠï¼Ÿ**
```java
// å¯ä»¥æ ¹æ®è¯·æ±‚ç±»å‹åˆ¤æ–­
@ExceptionHandler(BusinessException.class)
public Object handleException(HttpServletRequest request, BusinessException e) {
    
    // AJAXè¯·æ±‚è¿”å›JSON
    if (isAjaxRequest(request)) {
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // æ™®é€šè¯·æ±‚è·³è½¬é”™è¯¯é¡µ
    ModelAndView mv = new ModelAndView("error");
    mv.addObject("message", e.getMessage());
    return mv;
}
```

**Q3ï¼šå¦‚ä½•å¤„ç†å¼‚æ­¥è¯·æ±‚çš„å¼‚å¸¸ï¼Ÿ**
```java
@RestControllerAdvice
public class AsyncExceptionHandler implements AsyncUncaughtExceptionHandler {
    
    @Override
    public void handleUncaughtException(Throwable ex, Method method, Object... params) {
        log.error("å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸ - æ–¹æ³•ï¼š{}, å‚æ•°ï¼š{}", method.getName(), params, ex);
        // å¼‚æ­¥ä»»åŠ¡çš„å¼‚å¸¸å¤„ç†é€»è¾‘
    }
}
```

### 6.4 æ ¸å¿ƒè®°å¿†è¦ç‚¹


**å£è¯€è®°å¿†**ï¼š
```
å¼‚å¸¸å¤„ç†ä¸‰æ­¥èµ°ï¼š
1. åˆ†ç±»å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸
2. å…¨å±€æ•è·ç»Ÿä¸€å¤„ç†  
3. è¿”å›æ ¼å¼ä¿æŒä¸€è‡´

å¤„ç†åŸåˆ™è®°å¿ƒé—´ï¼š
ä¸šåŠ¡å¼‚å¸¸å‹å¥½æç¤º
ç³»ç»Ÿå¼‚å¸¸è®°å½•æ—¥å¿—
å…œåº•å¤„ç†ä¸èƒ½å¿˜
```

**æœ€ä½³å®è·µæ¸…å•**ï¼š
- âœ… ä½¿ç”¨`@RestControllerAdvice`å®ç°å…¨å±€å¤„ç†
- âœ… è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»ï¼Œæºå¸¦é”™è¯¯ç 
- âœ… ç»Ÿä¸€è¿”å›Resultæ ¼å¼
- âœ… ç³»ç»Ÿå¼‚å¸¸å¿…é¡»è®°å½•æ—¥å¿—
- âœ… é”™è¯¯ç è®¾è®¡è¦æœ‰è§„èŒƒ
- âœ… ç»™ç”¨æˆ·çš„æç¤ºè¦å‹å¥½
- âœ… æ•æ„Ÿä¿¡æ¯ä¸è¦æš´éœ²

---

## ğŸ’­ å­¦ä¹ å»ºè®®


**æ–°æ‰‹ç»ƒä¹ æ­¥éª¤**ï¼š

â‘  **ç¬¬ä¸€æ­¥**ï¼šåˆ›å»ºç»Ÿä¸€è¿”å›ç±»Result
â‘¡ **ç¬¬äºŒæ­¥**ï¼šå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»å’Œé”™è¯¯ç 
â‘¢**ç¬¬ä¸‰æ­¥**ï¼šç¼–å†™å…¨å±€å¼‚å¸¸å¤„ç†å™¨
â‘£ **ç¬¬å››æ­¥**ï¼šåœ¨Serviceä¸­æŠ›å‡ºå¼‚å¸¸
â‘¤ **ç¬¬äº”æ­¥**ï¼šæµ‹è¯•å„ç§å¼‚å¸¸åœºæ™¯

**è¿›é˜¶å­¦ä¹ **ï¼š
- ç ”ç©¶Spring Bootçš„å¼‚å¸¸å¤„ç†è‡ªåŠ¨é…ç½®
- å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼‚å¸¸ä¼ æ’­
- äº†è§£å¼‚å¸¸ç›‘æ§å’ŒæŠ¥è­¦æœºåˆ¶

> ğŸ’¡ **æ¸©é¦¨æç¤º**ï¼šå¼‚å¸¸å¤„ç†æ˜¯ä¿è¯ç³»ç»Ÿå¥å£®æ€§çš„å…³é”®ï¼Œä¸€å®šè¦é‡è§†ï¼å…ˆæŠŠåŸºç¡€çš„å…¨å±€å¼‚å¸¸å¤„ç†åšå¥½ï¼Œå†æ…¢æ…¢ä¼˜åŒ–ç»†èŠ‚ã€‚