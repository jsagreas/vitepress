---
title: 3ã€å“åº”å¼ç¼–ç¨‹WebFluxå¯¹æ¯”
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹](#1-ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹)
2. [ServletæŠ€æœ¯æ ˆä¸ReactiveæŠ€æœ¯æ ˆ](#2-ServletæŠ€æœ¯æ ˆä¸ReactiveæŠ€æœ¯æ ˆ)
3. [WebMVC vs WebFluxæ ¸å¿ƒå¯¹æ¯”](#3-WebMVC-vs-WebFluxæ ¸å¿ƒå¯¹æ¯”)
4. [é˜»å¡ä¸éé˜»å¡çš„æœ¬è´¨åŒºåˆ«](#4-é˜»å¡ä¸éé˜»å¡çš„æœ¬è´¨åŒºåˆ«)
5. [ç¼–ç¨‹æ¨¡å‹çš„å·®å¼‚](#5-ç¼–ç¨‹æ¨¡å‹çš„å·®å¼‚)
6. [æ€§èƒ½ç‰¹ç‚¹æ·±å…¥å¯¹æ¯”](#6-æ€§èƒ½ç‰¹ç‚¹æ·±å…¥å¯¹æ¯”)
7. [å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ](#7-å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ)
8. [ä»WebMVCè¿ç§»åˆ°WebFlux](#8-ä»WebMVCè¿ç§»åˆ°WebFlux)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŠ ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹


### 1.1 å“åº”å¼ç¼–ç¨‹çš„é€šä¿—ç†è§£


**ç”Ÿæ´»ä¸­çš„ç±»æ¯”**ï¼š
```
ä¼ ç»Ÿç¼–ç¨‹ï¼ˆé˜»å¡å¼ï¼‰å°±åƒæ’é˜Ÿæ‰“é¥­ï¼š
ğŸ‘¨ ä½  â†’ ğŸš æ‰“é¥­çª—å£ â†’ â° ç­‰å¾… â†’ ğŸ± æ‹¿åˆ°é¥­ â†’ ğŸš¶ ç¦»å¼€
é—®é¢˜ï¼šä½ å¿…é¡»ç«™åœ¨é‚£é‡Œç­‰ï¼Œä»€ä¹ˆéƒ½ä¸èƒ½å¹²

å“åº”å¼ç¼–ç¨‹ï¼ˆéé˜»å¡å¼ï¼‰å°±åƒç‚¹å¤–å–ï¼š
ğŸ‘¨ ä½  â†’ ğŸ“± ä¸‹å• â†’ ğŸ’¼ ç»§ç»­å·¥ä½œ â†’ ğŸ”” é€šçŸ¥åˆ°äº† â†’ ğŸ± å–é¤
ä¼˜åŠ¿ï¼šä¸‹å•åå¯ä»¥åšå…¶ä»–äº‹ï¼Œä¸ç”¨å‚»ç­‰
```

**æ ¸å¿ƒç†å¿µ**ï¼š
- **æ•°æ®æµåŠ¨è§‚å¿µ**ï¼šæŠŠæ•°æ®çœ‹æˆä¸€æ¡æµåŠ¨çš„æ²³æµ
- **äº‹ä»¶é©±åŠ¨**ï¼šæœ‰äº‹ä»¶å‘ç”Ÿæ—¶æ‰å¤„ç†ï¼Œæ²¡äº‹ä»¶å°±å¹²åˆ«çš„
- **å¼‚æ­¥éé˜»å¡**ï¼šä¸ç­‰å¾…ç»“æœï¼Œç»“æœå¥½äº†ä¼šä¸»åŠ¨é€šçŸ¥ä½ 

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å“åº”å¼ç¼–ç¨‹


**ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**ï¼š
```
åœºæ™¯ï¼š100ä¸ªç”¨æˆ·åŒæ—¶è®¿é—®ä½ çš„ç½‘ç«™

ä¼ ç»ŸServletæ–¹å¼ï¼š
ç”¨æˆ·1 â†’ [çº¿ç¨‹1ç­‰å¾…æ•°æ®åº“]  â°ç­‰å¾…ä¸­...
ç”¨æˆ·2 â†’ [çº¿ç¨‹2ç­‰å¾…æ•°æ®åº“]  â°ç­‰å¾…ä¸­...
ç”¨æˆ·3 â†’ [çº¿ç¨‹3ç­‰å¾…æ•°æ®åº“]  â°ç­‰å¾…ä¸­...
...
ç”¨æˆ·100 â†’ [çº¿ç¨‹100ç­‰å¾…]    â°ç­‰å¾…ä¸­...

ğŸ’¥ é—®é¢˜ï¼š100ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…ï¼ŒCPUå¾ˆé—²ä½†å†…å­˜åƒç´§ï¼
```

**å“åº”å¼çš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
å“åº”å¼WebFluxæ–¹å¼ï¼š
ç”¨æˆ·1-100 â†’ [å°‘é‡çº¿ç¨‹] â†’ å‘èµ·è¯·æ±‚ â†’ ç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚
                         â†“
                      æ•°æ®åº“å“åº”
                         â†“
                      é€šçŸ¥å¯¹åº”ç”¨æˆ·

âœ¨ ä¼˜åŠ¿ï¼šå°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¯·æ±‚ï¼Œèµ„æºåˆ©ç”¨ç‡é«˜ï¼
```

### 1.3 å“åº”å¼ç¼–ç¨‹çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µ


**Publisherï¼ˆå‘å¸ƒè€…ï¼‰**ï¼š
```
å°±åƒæ°´é¾™å¤´ï¼š
ğŸš° å‘å¸ƒè€… â†’ ğŸ’§ğŸ’§ğŸ’§ æ•°æ®æµ

ä½œç”¨ï¼šäº§ç”Ÿæ•°æ®çš„æºå¤´
ä¾‹å­ï¼šæ•°æ®åº“æŸ¥è¯¢ç»“æœã€APIå“åº”ã€æ–‡ä»¶è¯»å–
```

**Subscriberï¼ˆè®¢é˜…è€…ï¼‰**ï¼š
```
å°±åƒæ°´æ¡¶ï¼š
ğŸ’§ğŸ’§ğŸ’§ æ•°æ®æµ â†’ ğŸª£ è®¢é˜…è€…

ä½œç”¨ï¼šæ¥æ”¶å’Œå¤„ç†æ•°æ®
ä¾‹å­ï¼šå‰ç«¯é¡µé¢ã€æ—¥å¿—ç³»ç»Ÿã€æ•°æ®å¤„ç†å™¨
```

**Backpressureï¼ˆèƒŒå‹ï¼‰**ï¼š
```
å°±åƒæµé‡æ§åˆ¶ï¼š
ğŸš°ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ â†’ ğŸª£ æ»¡äº†ï¼åœä¸€ä¸‹ï¼

ä½œç”¨ï¼šè®¢é˜…è€…å‘Šè¯‰å‘å¸ƒè€…"æ…¢ç‚¹ï¼Œæˆ‘å¤„ç†ä¸è¿‡æ¥äº†"
é˜²æ­¢ï¼šå†…å­˜æº¢å‡ºã€ç³»ç»Ÿå´©æºƒ
```

---

## 2. ğŸ”„ ServletæŠ€æœ¯æ ˆä¸ReactiveæŠ€æœ¯æ ˆ


### 2.1 ServletæŠ€æœ¯æ ˆï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰


**æ ¸å¿ƒç»„ä»¶æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Spring Web MVC              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Servlet Container           â”‚
â”‚      (Tomcat/Jetty/Undertow)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Thread Pool çº¿ç¨‹æ±            â”‚
â”‚    [çº¿ç¨‹1][çº¿ç¨‹2][çº¿ç¨‹3]...[çº¿ç¨‹N]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼šä¸€ä¸ªè¯·æ±‚ = ä¸€ä¸ªçº¿ç¨‹
```

**å·¥ä½œåŸç†**ï¼š
```java
// Servletçš„å¤„ç†æ–¹å¼ï¼ˆä¼ªä»£ç ç¤ºæ„ï¼‰
public void handleRequest(HttpServletRequest req) {
    // æ­¥éª¤1ï¼šä»çº¿ç¨‹æ± å–ä¸€ä¸ªçº¿ç¨‹
    Thread thread = threadPool.getThread();
    
    // æ­¥éª¤2ï¼šè¿™ä¸ªçº¿ç¨‹ä¸€ç›´å¤„ç†è¿™ä¸ªè¯·æ±‚
    String data = database.query(); // â° çº¿ç¨‹åœ¨è¿™é‡Œç­‰å¾…
    
    // æ­¥éª¤3ï¼šç­‰æ•°æ®å›æ¥åç»§ç»­å¤„ç†
    processData(data);
    
    // æ­¥éª¤4ï¼šè¿”å›å“åº”ï¼Œé‡Šæ”¾çº¿ç¨‹
    return response;
}
```

> ğŸ’¡ **æ ¸å¿ƒç‰¹ç‚¹**ï¼šåŒæ­¥é˜»å¡æ¨¡å‹ï¼Œçº¿ç¨‹ä¼šç­‰å¾…IOæ“ä½œå®Œæˆ

**æŠ€æœ¯æ ˆç»„æˆ**ï¼š
- **Webæ¡†æ¶**ï¼šSpring MVC
- **æœåŠ¡å™¨**ï¼šTomcatã€Jettyã€Undertow
- **çº¿ç¨‹æ¨¡å‹**ï¼šæ¯è¯·æ±‚ä¸€çº¿ç¨‹ï¼ˆThread-per-requestï¼‰
- **ç¼–ç¨‹æ–¹å¼**ï¼šåŒæ­¥é˜»å¡å¼

### 2.2 ReactiveæŠ€æœ¯æ ˆï¼ˆå“åº”å¼æ–¹å¼ï¼‰


**æ ¸å¿ƒç»„ä»¶æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Spring WebFlux              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Reactive Runtime              â”‚
â”‚     (Netty/Undertow/Reactor)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Event Loop äº‹ä»¶å¾ªç¯          â”‚
â”‚    å°‘é‡çº¿ç¨‹ + äº‹ä»¶é˜Ÿåˆ— + å›è°ƒæœºåˆ¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼šå°‘é‡çº¿ç¨‹ + äº‹ä»¶é©±åŠ¨
```

**å·¥ä½œåŸç†**ï¼š
```java
// WebFluxçš„å¤„ç†æ–¹å¼ï¼ˆä¼ªä»£ç ç¤ºæ„ï¼‰
public Mono<Response> handleRequest(ServerRequest req) {
    // æ­¥éª¤1ï¼šå‘èµ·å¼‚æ­¥æŸ¥è¯¢ï¼Œç«‹å³è¿”å›
    return database.queryAsync()  // ğŸš€ ä¸ç­‰å¾…ï¼Œç›´æ¥è¿”å›
        // æ­¥éª¤2ï¼šå®šä¹‰æ•°æ®å›æ¥åçš„å¤„ç†é€»è¾‘
        .map(data -> processData(data))
        // æ­¥éª¤3ï¼šè½¬æ¢æˆå“åº”
        .map(result -> createResponse(result));
    
    // æ³¨æ„ï¼šæ•´ä¸ªè¿‡ç¨‹çº¿ç¨‹ä¸ä¼šç­‰å¾…ï¼
}
```

> âš¡ **æ ¸å¿ƒç‰¹ç‚¹**ï¼šå¼‚æ­¥éé˜»å¡æ¨¡å‹ï¼Œçº¿ç¨‹ä¸ç­‰å¾…ç«‹å³å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚

**æŠ€æœ¯æ ˆç»„æˆ**ï¼š
- **Webæ¡†æ¶**ï¼šSpring WebFlux
- **æœåŠ¡å™¨**ï¼šNettyï¼ˆé»˜è®¤ï¼‰ã€Undertow
- **çº¿ç¨‹æ¨¡å‹**ï¼šäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰
- **ç¼–ç¨‹æ–¹å¼**ï¼šå¼‚æ­¥éé˜»å¡å¼

### 2.3 ä¸¤ç§æŠ€æœ¯æ ˆå¯¹æ¯”


| ç»´åº¦ | **ServletæŠ€æœ¯æ ˆ** | **ReactiveæŠ€æœ¯æ ˆ** |
|------|------------------|-------------------|
| **æ ¸å¿ƒç†å¿µ** | åŒæ­¥é˜»å¡ï¼Œé¡ºåºæ‰§è¡Œ | å¼‚æ­¥éé˜»å¡ï¼Œäº‹ä»¶é©±åŠ¨ |
| **çº¿ç¨‹ä½¿ç”¨** | ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªçº¿ç¨‹ | å°‘é‡çº¿ç¨‹å¤„ç†æ‰€æœ‰è¯·æ±‚ |
| **é€‚ç”¨åœºæ™¯** | ä¼ ç»ŸWebåº”ç”¨ï¼ŒIOä¸é¢‘ç¹ | é«˜å¹¶å‘ï¼ŒIOå¯†é›†å‹ |
| **å­¦ä¹ æ›²çº¿** | ğŸ“ˆ ç®€å•æ˜“æ‡‚ | ğŸ“ˆğŸ“ˆğŸ“ˆ éœ€è¦è½¬å˜æ€ç»´ |
| **ç”Ÿæ€æˆç†Ÿåº¦** | â­â­â­â­â­ éå¸¸æˆç†Ÿ | â­â­â­ å¿«é€Ÿå‘å±•ä¸­ |

---

## 3. âš”ï¸ WebMVC vs WebFluxæ ¸å¿ƒå¯¹æ¯”


### 3.1 æ¡†æ¶å®šä½å·®å¼‚


**Spring WebMVC**ï¼š
```
å®šä½ï¼šä¼ ç»Ÿçš„åŒæ­¥Webæ¡†æ¶
åŸºç¡€ï¼šServlet API
å†å²ï¼š2004å¹´å‘å¸ƒï¼Œä¹…ç»è€ƒéªŒ
é€‚åˆï¼šç»å¤§å¤šæ•°å¸¸è§„Webåº”ç”¨

å°±åƒï¼šæ™®é€šæ±½è½¦ ğŸš—
ç‰¹ç‚¹ï¼šç¨³å®šå¯é ï¼Œå®¹æ˜“é©¾é©¶ï¼Œç»´ä¿®æ–¹ä¾¿
```

**Spring WebFlux**ï¼š
```
å®šä½ï¼šç°ä»£å“åº”å¼Webæ¡†æ¶
åŸºç¡€ï¼šReactive Streamsè§„èŒƒ
å†å²ï¼š2017å¹´å‘å¸ƒï¼Œç›¸å¯¹è¾ƒæ–°
é€‚åˆï¼šé«˜å¹¶å‘ã€æµå¼æ•°æ®å¤„ç†

å°±åƒï¼šç”µåŠ¨æ±½è½¦ ğŸš—âš¡
ç‰¹ç‚¹ï¼šæ€§èƒ½å¼ºåŠ²ï¼Œä½†éœ€è¦æ–°çš„é©¾é©¶ä¹ æƒ¯
```

### 3.2 Controllerå†™æ³•å¯¹æ¯”


**WebMVCçš„Controller**ï¼š
```java
@RestController
@RequestMapping("/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // åŒæ­¥æ–¹å¼ï¼šæ–¹æ³•è¿”å›å…·ä½“å¯¹è±¡
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        // 1. è°ƒç”¨serviceï¼Œçº¿ç¨‹ç­‰å¾…ç»“æœ
        User user = userService.findById(id);  // â° ç­‰å¾…
        
        // 2. è¿”å›ç»“æœ
        return user;
    }
    
    // è¿”å›åˆ—è¡¨ä¹Ÿæ˜¯åŒæ­¥çš„
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();  // â° ç­‰å¾…
    }
}
```

> ğŸ’¡ **ç‰¹ç‚¹**ï¼šä»£ç ç®€å•ç›´æ¥ï¼Œç¬¦åˆä¼ ç»Ÿç¼–ç¨‹ä¹ æƒ¯ï¼Œè¿”å›çš„æ˜¯å®é™…å¯¹è±¡

**WebFluxçš„Controller**ï¼š
```java
@RestController
@RequestMapping("/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // å“åº”å¼æ–¹å¼ï¼šè¿”å›Monoï¼ˆå•ä¸ªå¯¹è±¡çš„æµï¼‰
    @GetMapping("/{id}")
    public Mono<User> getUser(@PathVariable Long id) {
        // 1. è¿”å›ä¸€ä¸ª"æœªæ¥ä¼šæœ‰çš„å¯¹è±¡"
        return userService.findById(id);  // ğŸš€ ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…
        
        // çº¿ç¨‹ç«‹å³é‡Šæ”¾ï¼Œå»å¤„ç†å…¶ä»–è¯·æ±‚ï¼
    }
    
    // è¿”å›Fluxï¼ˆå¤šä¸ªå¯¹è±¡çš„æµï¼‰
    @GetMapping
    public Flux<User> getAllUsers() {
        return userService.findAll();  // ğŸš€ ç«‹å³è¿”å›æµ
    }
}
```

> âš¡ **ç‰¹ç‚¹**ï¼šè¿”å›çš„æ˜¯"æœªæ¥çš„æ•°æ®æµ"ï¼Œéœ€è¦ç†è§£Monoå’ŒFluxçš„æ¦‚å¿µ

### 3.3 æ ¸å¿ƒAPIå¯¹æ¯”


**Monoå’ŒFluxçš„ç†è§£**ï¼š
```
Mono<T>ï¼š
å°±åƒä¸€ä¸ªåŒ…è£¹å¿«é€’ ğŸ“¦
é‡Œé¢æœ‰0ä¸ªæˆ–1ä¸ªç‰©å“
ä¾‹å­ï¼šMono<User> è¡¨ç¤ºå°†æ¥ä¼šæœ‰ä¸€ä¸ªUserå¯¹è±¡

Flux<T>ï¼š  
å°±åƒä¸€æ¡ä¼ é€å¸¦ ğŸ“¦ğŸ“¦ğŸ“¦
ä¸Šé¢æœ‰0ä¸ªã€1ä¸ªæˆ–å¤šä¸ªç‰©å“
ä¾‹å­ï¼šFlux<User> è¡¨ç¤ºå°†æ¥ä¼šæœ‰å¤šä¸ªUserå¯¹è±¡æµè¿‡æ¥
```

**APIä½¿ç”¨å¯¹æ¯”**ï¼š

| åœºæ™¯ | **WebMVCå†™æ³•** | **WebFluxå†™æ³•** |
|------|---------------|----------------|
| è¿”å›å•ä¸ªå¯¹è±¡ | `User` | `Mono<User>` |
| è¿”å›åˆ—è¡¨ | `List<User>` | `Flux<User>` |
| è¿”å›ç©º | `null` | `Mono.empty()` |
| å¼‚æ­¥å¤„ç† | éœ€è¦æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹ | å¤©ç„¶æ”¯æŒå¼‚æ­¥ |

### 3.4 æ•°æ®åº“è®¿é—®å¯¹æ¯”


**WebMVC + JPAï¼ˆé˜»å¡å¼ï¼‰**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    private UserRepository repository;
    
    // é˜»å¡å¼æŸ¥è¯¢
    public User findById(Long id) {
        // çº¿ç¨‹åœ¨è¿™é‡Œç­‰å¾…æ•°æ®åº“å“åº” â°
        return repository.findById(id)
            .orElseThrow(() -> new NotFoundException());
    }
    
    public List<User> findAll() {
        // çº¿ç¨‹ç­‰å¾…æŸ¥è¯¢æ‰€æœ‰æ•°æ® â°
        return repository.findAll();
    }
}
```

**WebFlux + R2DBCï¼ˆéé˜»å¡å¼ï¼‰**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    private R2dbcUserRepository repository;
    
    // éé˜»å¡å¼æŸ¥è¯¢
    public Mono<User> findById(Long id) {
        // ç«‹å³è¿”å›Monoï¼Œçº¿ç¨‹ä¸ç­‰å¾… ğŸš€
        return repository.findById(id)
            .switchIfEmpty(Mono.error(new NotFoundException()));
    }
    
    public Flux<User> findAll() {
        // ç«‹å³è¿”å›Fluxï¼Œæ•°æ®ä¼šå¼‚æ­¥æµå¼è¿”å› ğŸš€
        return repository.findAll();
    }
}
```

> âš ï¸ **é‡è¦æç¤º**ï¼šWebFluxå¿…é¡»é…åˆå“åº”å¼æ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚R2DBCï¼‰ï¼Œä¸èƒ½ç”¨JPAï¼

---

## 4. ğŸ”“ é˜»å¡ä¸éé˜»å¡çš„æœ¬è´¨åŒºåˆ«


### 4.1 é˜»å¡å¼å¤„ç†ï¼ˆBlockingï¼‰


**é€šä¿—ç†è§£**ï¼š
```
å°±åƒæ‰“ç”µè¯å’¨è¯¢é—®é¢˜ï¼š
ä½ ï¼šå–‚ï¼Œæˆ‘æƒ³é—®ä¸ªé—®é¢˜
å®¢æœï¼šè¯·ç¨ç­‰ï¼Œæˆ‘æŸ¥ä¸€ä¸‹... â°
ä½ ï¼š[å‚»å‚»ç­‰ç€ï¼Œä»€ä¹ˆéƒ½ä¸èƒ½å¹²]
å®¢æœï¼šæŸ¥åˆ°äº†ï¼Œç­”æ¡ˆæ˜¯XXX
ä½ ï¼šå¥½çš„ï¼Œè°¢è°¢ [æŒ‚æ–­]

é—®é¢˜ï¼šç­‰å¾…æœŸé—´ä½ è¢«"é˜»å¡"äº†ï¼Œæµªè´¹æ—¶é—´
```

**ä»£ç è¡¨ç°**ï¼š
```java
// é˜»å¡å¼IOæ“ä½œ
public String getDataBlocking() {
    // ç¬¬1æ­¥ï¼šå‘èµ·ç½‘ç»œè¯·æ±‚
    String result = httpClient.get("http://api.example.com");
    
    // â° çº¿ç¨‹åœ¨è¿™é‡Œç­‰å¾…ï¼Œç›´åˆ°æ•°æ®è¿”å›
    // è¿™æœŸé—´çº¿ç¨‹ä¸èƒ½åšä»»ä½•å…¶ä»–äº‹
    
    // ç¬¬2æ­¥ï¼šæ•°æ®è¿”å›åç»§ç»­
    return "å¤„ç†åçš„æ•°æ®: " + result;
}
```

**èµ„æºå ç”¨ç¤ºæ„**ï¼š
```
è¯·æ±‚1 â†’ çº¿ç¨‹1 â†’ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆç­‰å¾…â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] â†’ å“åº”
è¯·æ±‚2 â†’ çº¿ç¨‹2 â†’ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆç­‰å¾…â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] â†’ å“åº”  
è¯·æ±‚3 â†’ çº¿ç¨‹3 â†’ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆç­‰å¾…â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] â†’ å“åº”

ğŸ’° æˆæœ¬ï¼š3ä¸ªè¯·æ±‚ = 3ä¸ªçº¿ç¨‹ = å¤§é‡å†…å­˜
```

### 4.2 éé˜»å¡å¼å¤„ç†ï¼ˆNon-Blockingï¼‰


**é€šä¿—ç†è§£**ï¼š
```
å°±åƒå‘å¾®ä¿¡å’¨è¯¢é—®é¢˜ï¼š
ä½ ï¼š[å‘æ¶ˆæ¯]æˆ‘æƒ³é—®ä¸ªé—®é¢˜
ä½ ï¼š[ç»§ç»­å¹²å…¶ä»–äº‹æƒ…]ğŸ’¼ å·¥ä½œã€ğŸ“º å¨±ä¹
å®¢æœï¼š[å›æ¶ˆæ¯]ç­”æ¡ˆæ˜¯XXX
ä½ ï¼š[çœ‹åˆ°æ¶ˆæ¯]å¥½çš„ï¼Œè°¢è°¢

ä¼˜åŠ¿ï¼šå‘å®Œæ¶ˆæ¯å°±å»å¹²åˆ«çš„ï¼Œç­‰å›å¤æ—¶æ‰å¤„ç†
```

**ä»£ç è¡¨ç°**ï¼š
```java
// éé˜»å¡å¼IOæ“ä½œ
public Mono<String> getDataNonBlocking() {
    // ç¬¬1æ­¥ï¼šå‘èµ·è¯·æ±‚ï¼Œç«‹å³è¿”å›Mono
    return webClient.get()
        .uri("http://api.example.com")
        .retrieve()
        .bodyToMono(String.class)
        // ç¬¬2æ­¥ï¼šå®šä¹‰æ•°æ®è¿”å›åçš„å¤„ç†
        .map(result -> "å¤„ç†åçš„æ•°æ®: " + result);
    
    // ğŸš€ æ–¹æ³•ç«‹å³è¿”å›ï¼Œçº¿ç¨‹ä¸ç­‰å¾…ï¼
}
```

**èµ„æºå ç”¨ç¤ºæ„**ï¼š
```
è¯·æ±‚1 â†’ å‘èµ· â†’ çº¿ç¨‹é‡Šæ”¾ â†’ [ç­‰å¾…å“åº”] â†’ å›è°ƒå¤„ç†
è¯·æ±‚2 â†’ å‘èµ· â†’ çº¿ç¨‹é‡Šæ”¾ â†’ [ç­‰å¾…å“åº”] â†’ å›è°ƒå¤„ç†
è¯·æ±‚3 â†’ å‘èµ· â†’ çº¿ç¨‹é‡Šæ”¾ â†’ [ç­‰å¾…å“åº”] â†’ å›è°ƒå¤„ç†

ğŸ’° æˆæœ¬ï¼š3ä¸ªè¯·æ±‚ â‰ˆ 1ä¸ªçº¿ç¨‹ï¼ˆå¤ç”¨ï¼‰= èŠ‚çœå†…å­˜
```

### 4.3 é˜»å¡ä¸éé˜»å¡çš„çœŸå®å¯¹æ¯”


**åœºæ™¯ï¼šæŸ¥è¯¢ç”¨æˆ·å¹¶è°ƒç”¨å¤–éƒ¨API**

**é˜»å¡æ–¹å¼**ï¼š
```java
@GetMapping("/user/{id}/detail")
public UserDetail getUserDetail(@PathVariable Long id) {
    // æ­¥éª¤1ï¼šæŸ¥æ•°æ®åº“ï¼ˆé˜»å¡ç­‰å¾… 200msï¼‰â°
    User user = userRepository.findById(id).get();
    
    // æ­¥éª¤2ï¼šè°ƒç”¨å¤–éƒ¨APIï¼ˆé˜»å¡ç­‰å¾… 500msï¼‰â°  
    String extraInfo = restTemplate.getForObject(
        "http://api.example.com/info/" + id, 
        String.class
    );
    
    // æ­¥éª¤3ï¼šç»„è£…è¿”å›
    return new UserDetail(user, extraInfo);
    
    // æ€»è€—æ—¶ï¼š200ms + 500ms = 700ms
    // çº¿ç¨‹çŠ¶æ€ï¼šä¸€ç›´å ç”¨700ms
}
```

**éé˜»å¡æ–¹å¼**ï¼š
```java
@GetMapping("/user/{id}/detail")
public Mono<UserDetail> getUserDetail(@PathVariable Long id) {
    // æ­¥éª¤1ï¼šå¼‚æ­¥æŸ¥æ•°æ®åº“ï¼ˆç«‹å³è¿”å›ï¼‰ğŸš€
    Mono<User> userMono = userRepository.findById(id);
    
    // æ­¥éª¤2ï¼šå¼‚æ­¥è°ƒç”¨APIï¼ˆç«‹å³è¿”å›ï¼‰ğŸš€
    Mono<String> infoMono = webClient.get()
        .uri("http://api.example.com/info/" + id)
        .retrieve()
        .bodyToMono(String.class);
    
    // æ­¥éª¤3ï¼šä¸¤ä¸ªç»“æœéƒ½å›æ¥åç»„è£…
    return Mono.zip(userMono, infoMono)
        .map(tuple -> new UserDetail(tuple.getT1(), tuple.getT2()));
    
    // æ€»è€—æ—¶ï¼šmax(200ms, 500ms) = 500msï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
    // çº¿ç¨‹çŠ¶æ€ï¼šå‘èµ·è¯·æ±‚åç«‹å³é‡Šæ”¾ï¼Œä¸å ç”¨ç­‰å¾…æ—¶é—´
}
```

> âš¡ **æ€§èƒ½å¯¹æ¯”**ï¼šéé˜»å¡æ–¹å¼ä¸ä»…èŠ‚çœçº¿ç¨‹ï¼Œè¿˜èƒ½å¹¶è¡Œæ‰§è¡Œæå‡å“åº”é€Ÿåº¦ï¼

---

## 5. ğŸ¨ ç¼–ç¨‹æ¨¡å‹çš„å·®å¼‚


### 5.1 å‘½ä»¤å¼ç¼–ç¨‹ vs å£°æ˜å¼ç¼–ç¨‹


**å‘½ä»¤å¼ç¼–ç¨‹ï¼ˆWebMVCï¼‰**ï¼š
```java
// å‘Šè¯‰è®¡ç®—æœº"æ€ä¹ˆåš"
@GetMapping("/users/active")
public List<User> getActiveUsers() {
    // ç¬¬1æ­¥ï¼šè·å–æ‰€æœ‰ç”¨æˆ·
    List<User> allUsers = userRepository.findAll();
    
    // ç¬¬2æ­¥ï¼šåˆ›å»ºç»“æœåˆ—è¡¨
    List<User> activeUsers = new ArrayList<>();
    
    // ç¬¬3æ­¥ï¼šéå†ç­›é€‰
    for (User user : allUsers) {
        if (user.isActive()) {
            activeUsers.add(user);
        }
    }
    
    // ç¬¬4æ­¥ï¼šè¿”å›ç»“æœ
    return activeUsers;
}
```

> ğŸ’¡ **ç‰¹ç‚¹**ï¼šä¸€æ­¥ä¸€æ­¥å‘Šè¯‰è®¡ç®—æœºæ€ä¹ˆåšï¼Œé€»è¾‘æ¸…æ™°æ˜“æ‡‚

**å£°æ˜å¼ç¼–ç¨‹ï¼ˆWebFluxï¼‰**ï¼š
```java
// å‘Šè¯‰è®¡ç®—æœº"è¦ä»€ä¹ˆ"
@GetMapping("/users/active")
public Flux<User> getActiveUsers() {
    // å£°æ˜æ•°æ®å¤„ç†æµç¨‹ï¼Œè€Œä¸æ˜¯å…·ä½“æ­¥éª¤
    return userRepository.findAll()      // è·å–æ‰€æœ‰ç”¨æˆ·æµ
        .filter(User::isActive);         // è¿‡æ»¤å‡ºæ´»è·ƒç”¨æˆ·
        
    // æ¡†æ¶è‡ªåŠ¨å¤„ç†æ‰§è¡Œç»†èŠ‚
}
```

> âš¡ **ç‰¹ç‚¹**ï¼šæè¿°æƒ³è¦çš„ç»“æœï¼Œæ¡†æ¶å¤„ç†æ‰§è¡Œç»†èŠ‚ï¼Œä»£ç ç®€æ´

### 5.2 å“åº”å¼æ“ä½œç¬¦è¯¦è§£


**å¸¸ç”¨æ“ä½œç¬¦å¯¹æ¯”**ï¼š

| æ“ä½œç¬¦ | **ä½œç”¨** | **ç±»æ¯”ç†è§£** | **ç¤ºä¾‹** |
|--------|---------|------------|---------|
| `map` | è½¬æ¢æ¯ä¸ªå…ƒç´  | ğŸ“¦â†’ğŸ æ¢åŒ…è£… | æŠŠUserè½¬æˆUserDTO |
| `filter` | ç­›é€‰å…ƒç´  | ğŸ” è¿‡æ»¤å™¨ | åªä¿ç•™æ´»è·ƒç”¨æˆ· |
| `flatMap` | è½¬æ¢å¹¶å±•å¹³ | ğŸ“¦â†’ğŸ“¦ğŸ“¦ğŸ“¦ æ‹†åŒ…è£¹ | ä¸€ä¸ªè®¢å•å˜å¤šä¸ªå•†å“ |
| `zip` | åˆå¹¶å¤šä¸ªæµ | ğŸ§µğŸ§µâ†’ğŸ§¶ ç¼–ç»‡ | åˆå¹¶ç”¨æˆ·å’Œè®¢å•ä¿¡æ¯ |
| `switchIfEmpty` | ç©ºå€¼æ›¿æ¢ | ğŸ“­â†’ğŸ“¬ ç©ºäº†å°±æ¢ | æŸ¥ä¸åˆ°å°±è¿”å›é»˜è®¤å€¼ |

**å®æˆ˜ç¤ºä¾‹**ï¼š
```java
// éœ€æ±‚ï¼šè·å–ç”¨æˆ·çš„è®¢å•è¯¦æƒ…
@GetMapping("/users/{id}/orders")
public Flux<OrderDetail> getUserOrders(@PathVariable Long id) {
    
    return userRepository.findById(id)          // Mono<User>
        .flatMapMany(user ->                    // è½¬æˆFlux<Order>
            orderRepository.findByUserId(user.getId())
        )
        .flatMap(order ->                       // æ¯ä¸ªè®¢å•è½¬æˆè®¢å•è¯¦æƒ…
            productRepository.findById(order.getProductId())
                .map(product -> new OrderDetail(order, product))
        )
        .filter(detail -> detail.getAmount() > 0)  // è¿‡æ»¤é‡‘é¢ä¸º0çš„
        .switchIfEmpty(Flux.error(              // æ²¡æœ‰è®¢å•å°±æŠ¥é”™
            new NotFoundException("No orders found")
        ));
}
```

### 5.3 é”™è¯¯å¤„ç†æ¨¡å¼


**WebMVCçš„é”™è¯¯å¤„ç†**ï¼š
```java
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) {
    try {
        // å°è¯•æŸ¥è¯¢
        User user = userRepository.findById(id).get();
        
        // è°ƒç”¨å¤–éƒ¨æœåŠ¡
        enrichUserData(user);
        
        return user;
    } catch (NoSuchElementException e) {
        throw new NotFoundException("User not found");
    } catch (Exception e) {
        throw new ServiceException("Service error", e);
    }
}
```

> ğŸ’¡ **ç‰¹ç‚¹**ï¼šä½¿ç”¨try-catchå¤„ç†å¼‚å¸¸ï¼Œç®€å•ç›´æ¥

**WebFluxçš„é”™è¯¯å¤„ç†**ï¼š
```java
@GetMapping("/users/{id}")
public Mono<User> getUser(@PathVariable Long id) {
    
    return userRepository.findById(id)
        // æŸ¥ä¸åˆ°å°±æŠ›å¼‚å¸¸
        .switchIfEmpty(Mono.error(
            new NotFoundException("User not found")
        ))
        // è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼ˆè¿”å›Monoï¼‰
        .flatMap(user -> enrichUserDataAsync(user))
        // å¤„ç†ä»»ä½•é”™è¯¯
        .onErrorMap(e -> 
            new ServiceException("Service error", e)
        )
        // å‘ç”Ÿé”™è¯¯æ—¶è¿”å›é»˜è®¤å€¼
        .onErrorReturn(new User());  // å¯é€‰
}
```

> âš¡ **ç‰¹ç‚¹**ï¼šä½¿ç”¨å“åº”å¼æ“ä½œç¬¦å¤„ç†é”™è¯¯ï¼Œä»£ç æ›´æµç•…ä½†éœ€è¦é€‚åº”

### 5.4 èƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶


**ä»€ä¹ˆæ˜¯èƒŒå‹**ï¼š
```
åœºæ™¯ï¼šæ•°æ®åº“æ¯ç§’äº§ç”Ÿ1000æ¡æ•°æ®ï¼Œä½†æ¶ˆè´¹è€…æ¯ç§’åªèƒ½å¤„ç†100æ¡

æ²¡æœ‰èƒŒå‹ï¼š
æ•°æ®åº“ ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ğŸ’§ â†’ ğŸ˜µ æ¶ˆè´¹è€…ï¼ˆå¤„ç†ä¸è¿‡æ¥ï¼Œå†…å­˜çˆ†äº†ï¼‰

æœ‰èƒŒå‹ï¼š
æ•°æ®åº“ ğŸ’§ğŸ’§ â†’ ğŸ˜Š æ¶ˆè´¹è€…ï¼šæˆ‘åªèƒ½å¤„ç†100æ¡
æ•°æ®åº“ï¼šå¥½çš„ï¼Œæˆ‘æ…¢ç‚¹å‘

âœ¨ ç»“æœï¼šæ¶ˆè´¹è€…ä¸ä¼šè¢«æ·¹æ²¡ï¼Œç³»ç»Ÿç¨³å®šè¿è¡Œ
```

**ä»£ç å®ç°**ï¼š
```java
// ç”Ÿäº§è€…ï¼ˆæ•°æ®åº“ï¼‰
Flux<User> users = userRepository.findAll()
    .limitRate(100);  // é™åˆ¶æ¯æ¬¡è¯·æ±‚100æ¡
    
// æ¶ˆè´¹è€…å¤„ç†
users.subscribe(
    user -> processUser(user),        // å¤„ç†æ¯ä¸ªç”¨æˆ·
    error -> handleError(error),      // å¤„ç†é”™è¯¯
    () -> System.out.println("å®Œæˆ"),  // å®Œæˆå›è°ƒ
    subscription -> 
        subscription.request(100)     // å‘Šè¯‰ç”Ÿäº§è€…ï¼šæˆ‘è¦100ä¸ª
);
```

> ğŸ“Š **å…³é”®ç‚¹**ï¼šæ¶ˆè´¹è€…å¯ä»¥æ§åˆ¶æ•°æ®æµé€Ÿï¼Œé˜²æ­¢è¿‡è½½

---

## 6. ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹æ·±å…¥å¯¹æ¯”


### 6.1 å¹¶å‘èƒ½åŠ›å¯¹æ¯”


**WebMVCçš„å¹¶å‘ç“¶é¢ˆ**ï¼š
```
é…ç½®ï¼š
- Tomcatçº¿ç¨‹æ± ï¼š200ä¸ªçº¿ç¨‹
- æ¯ä¸ªçº¿ç¨‹å ç”¨å†…å­˜ï¼š1MB

åœºæ™¯ï¼š1000ä¸ªå¹¶å‘è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯·æ±‚1-200  â†’ [200ä¸ªçº¿ç¨‹å¤„ç†]    â”‚  âœ… æ­£å¸¸
â”‚  è¯·æ±‚201-1000 â†’ [ç­‰å¾…é˜Ÿåˆ—]       â”‚  â° ç­‰å¾…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¥ é—®é¢˜ï¼š
- è¶…è¿‡200ä¸ªè¯·æ±‚å°±è¦æ’é˜Ÿ
- æ¯ä¸ªçº¿ç¨‹1MBï¼Œ200çº¿ç¨‹ = 200MBå†…å­˜
- çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§
```

**WebFluxçš„å¹¶å‘ä¼˜åŠ¿**ï¼š
```
é…ç½®ï¼š
- Event Loopçº¿ç¨‹ï¼š4ä¸ªï¼ˆé€šå¸¸æ˜¯CPUæ ¸å¿ƒæ•°ï¼‰
- æ¯ä¸ªçº¿ç¨‹å ç”¨å†…å­˜ï¼šå¾ˆå°‘

åœºæ™¯ï¼š1000ä¸ªå¹¶å‘è¯·æ±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯·æ±‚1-1000 â†’ [4ä¸ªçº¿ç¨‹å¤„ç†]      â”‚  âœ… å…¨éƒ¨æ¥å—
â”‚  é€šè¿‡äº‹ä»¶é©±åŠ¨ï¼Œå¼‚æ­¥å¤„ç†          â”‚  ğŸš€ ä¸é˜»å¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ¨ ä¼˜åŠ¿ï¼š
- å°‘é‡çº¿ç¨‹å¤„ç†æµ·é‡è¯·æ±‚
- å†…å­˜å ç”¨æä½
- æ— çº¿ç¨‹åˆ‡æ¢å¼€é”€
```

### 6.2 å“åº”æ—¶é—´å¯¹æ¯”


**å®æµ‹æ•°æ®å¯¹æ¯”**ï¼š

| åœºæ™¯ | **WebMVC** | **WebFlux** | **æå‡** |
|------|-----------|------------|---------|
| 100å¹¶å‘ç”¨æˆ· | 50ms | 45ms | 10% |
| 1000å¹¶å‘ç”¨æˆ· | 200ms | 80ms | 60% |
| 5000å¹¶å‘ç”¨æˆ· | è¶…æ—¶ | 150ms | ç¨³å®šè¿è¡Œ |
| 10000å¹¶å‘ç”¨æˆ· | å´©æºƒ | 200ms | å¯æ­£å¸¸å¤„ç† |

> âš¡ **ç»“è®º**ï¼šå¹¶å‘è¶Šé«˜ï¼ŒWebFluxä¼˜åŠ¿è¶Šæ˜æ˜¾ï¼

**æ€§èƒ½æ›²çº¿å›¾**ï¼š
```
å“åº”æ—¶é—´(ms)
   â”‚
500â”‚                    â•± WebMVC(è¶…æ—¶)
   â”‚                  â•±
400â”‚                â•±
   â”‚              â•±
300â”‚            â•±
   â”‚          â•±
200â”‚        â•±                 
   â”‚      â•±         â•±â”€â”€â”€â”€â”€â”€â”€ WebFlux(å¹³ç¨³)
100â”‚    â•±     â•±â”€â”€â”€â”€â”€â”€
   â”‚  â•±â”€â”€â”€â”€â”€â”€â”€
  0â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¹¶å‘æ•°
    0   1K   5K   10K  20K  50K
```

### 6.3 èµ„æºåˆ©ç”¨ç‡å¯¹æ¯”


**CPUåˆ©ç”¨ç‡**ï¼š
```
WebMVCï¼š
CPUï¼š[â–ˆâ–ˆâ–ˆâ–ˆ    ] 40% (å¤§é‡æ—¶é—´åœ¨ç­‰å¾…IO)
åŸå› ï¼šçº¿ç¨‹é˜»å¡æ—¶CPUç©ºé—²

WebFluxï¼š
CPUï¼š[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] 80% (æŒç»­å¤„ç†è¯·æ±‚)
åŸå› ï¼šçº¿ç¨‹ä¸é˜»å¡ï¼Œä¸€ç›´åœ¨å·¥ä½œ
```

**å†…å­˜ä½¿ç”¨**ï¼š
```
åœºæ™¯ï¼šå¤„ç†10000ä¸ªå¹¶å‘è¯·æ±‚

WebMVCå†…å­˜å ç”¨ï¼š
çº¿ç¨‹æ ˆï¼š200çº¿ç¨‹ Ã— 1MB = 200MB
è¿æ¥ç¼“å†²ï¼š10000ä¸ª Ã— 8KB = 80MB
æ€»è®¡ï¼šçº¦280MB

WebFluxå†…å­˜å ç”¨ï¼š
çº¿ç¨‹æ ˆï¼š4çº¿ç¨‹ Ã— 1MB = 4MB  
è¿æ¥ç¼“å†²ï¼š10000ä¸ª Ã— 8KB = 80MB
æ€»è®¡ï¼šçº¦84MB

ğŸ’° èŠ‚çœï¼š70%å†…å­˜ï¼
```

### 6.4 ååé‡å¯¹æ¯”


**å‹æµ‹ç»“æœå¯¹æ¯”**ï¼š
```
æµ‹è¯•ç¯å¢ƒï¼š4æ ¸CPUï¼Œ8GBå†…å­˜

WebMVCï¼š
- å³°å€¼QPSï¼š5000 req/s
- å¹³å‡å“åº”ï¼š100ms
- èµ„æºç“¶é¢ˆï¼šçº¿ç¨‹æ•°

WebFluxï¼š
- å³°å€¼QPSï¼š20000 req/s
- å¹³å‡å“åº”ï¼š50ms  
- èµ„æºç“¶é¢ˆï¼šç½‘ç»œå¸¦å®½

ğŸš€ æå‡ï¼š4å€ååé‡ï¼
```

---

## 7. ğŸ¯ å¦‚ä½•é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ


### 7.1 é€‰æ‹©WebMVCçš„åœºæ™¯


**æ¨èä½¿ç”¨WebMVC**ï¼š
```
âœ… ä¼ ç»ŸCRUDåº”ç”¨
   - ä¼ä¸šç®¡ç†ç³»ç»Ÿ
   - ç”µå•†åå°
   - å†…å®¹ç®¡ç†ç³»ç»Ÿ

âœ… å›¢é˜ŸæŠ€æœ¯æ ˆæˆç†Ÿ
   - å·²æœ‰å¤§é‡WebMVCé¡¹ç›®
   - å›¢é˜Ÿç†Ÿæ‚‰åŒæ­¥ç¼–ç¨‹
   - ç»´æŠ¤æˆæœ¬ä½

âœ… ä¾èµ–é˜»å¡å¼åº“
   - ä½¿ç”¨JPA/Hibernate
   - ä½¿ç”¨ä¼ ç»ŸJDBC
   - ä¾èµ–åŒæ­¥ç¬¬ä¸‰æ–¹åº“

âœ… ä¸šåŠ¡é€»è¾‘å¤æ‚
   - éœ€è¦å¤§é‡äº‹åŠ¡å¤„ç†
   - å¤æ‚çš„ä¸šåŠ¡æµç¨‹
   - éœ€è¦è°ƒè¯•æ’æŸ¥é—®é¢˜
```

> ğŸ’¡ **å»ºè®®**ï¼šå¯¹äº90%çš„å¸¸è§„Webåº”ç”¨ï¼ŒWebMVCå®Œå…¨å¤Ÿç”¨ï¼

### 7.2 é€‰æ‹©WebFluxçš„åœºæ™¯


**æ¨èä½¿ç”¨WebFlux**ï¼š
```
âœ… é«˜å¹¶å‘åœºæ™¯
   - å®æ—¶é€šè®¯ç³»ç»Ÿ
   - æ¶ˆæ¯æ¨é€æœåŠ¡
   - åœ¨çº¿æ¸¸æˆæœåŠ¡å™¨

âœ… æµå¼æ•°æ®å¤„ç†
   - å®æ—¶æ•°æ®åˆ†æ
   - æ—¥å¿—æ”¶é›†ç³»ç»Ÿ
   - è§†é¢‘ç›´æ’­å¹³å°

âœ… å¾®æœåŠ¡ç½‘å…³
   - API Gateway
   - æœåŠ¡ä»£ç†
   - æµé‡è½¬å‘

âœ… IOå¯†é›†å‹åº”ç”¨
   - å¤§é‡å¤–éƒ¨APIè°ƒç”¨
   - æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
   - æ•°æ®åº“æŸ¥è¯¢å¯†é›†
```

> âš¡ **å»ºè®®**ï¼šæ˜ç¡®æœ‰æ€§èƒ½ç“¶é¢ˆæ—¶æ‰è€ƒè™‘WebFluxï¼

### 7.3 æŠ€æœ¯é€‰å‹å†³ç­–æ ‘


```
å¼€å§‹é€‰å‹
   â”‚
   â”œâ”€ æ˜¯å¦éœ€è¦è¶…é«˜å¹¶å‘(>10000)ï¼Ÿ
   â”‚  â”œâ”€ æ˜¯ â†’ è€ƒè™‘WebFlux
   â”‚  â””â”€ å¦ â†“
   â”‚
   â”œâ”€ æ˜¯å¦æœ‰æµå¼æ•°æ®å¤„ç†éœ€æ±‚ï¼Ÿ
   â”‚  â”œâ”€ æ˜¯ â†’ è€ƒè™‘WebFlux
   â”‚  â””â”€ å¦ â†“
   â”‚
   â”œâ”€ å›¢é˜Ÿæ˜¯å¦ç†Ÿæ‚‰å“åº”å¼ç¼–ç¨‹ï¼Ÿ
   â”‚  â”œâ”€ å¦ â†’ é€‰æ‹©WebMVC âœ…
   â”‚  â””â”€ æ˜¯ â†“
   â”‚
   â”œâ”€ æ˜¯å¦æœ‰é˜»å¡å¼ä¾èµ–ï¼Ÿ
   â”‚  â”œâ”€ æ˜¯ â†’ é€‰æ‹©WebMVC âœ…
   â”‚  â””â”€ å¦ â†“
   â”‚
   â””â”€ æ€§èƒ½è¦æ±‚æ˜¯å¦æè‡´ï¼Ÿ
      â”œâ”€ æ˜¯ â†’ é€‰æ‹©WebFlux âš¡
      â””â”€ å¦ â†’ é€‰æ‹©WebMVC âœ…
```

### 7.4 æ··åˆä½¿ç”¨æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šåˆ†å±‚æ¶æ„**
```
å‰ç«¯æœåŠ¡(WebFlux) â†’ é«˜å¹¶å‘å…¥å£
         â†“
æ ¸å¿ƒæœåŠ¡(WebMVC) â†’ ä¸šåŠ¡å¤„ç†
         â†“
æ•°æ®æœåŠ¡(WebMVC) â†’ æ•°æ®è®¿é—®

âœ¨ ä¼˜åŠ¿ï¼šå„å¸å…¶èŒï¼Œå‘æŒ¥å„è‡ªä¼˜åŠ¿
```

**æ–¹æ¡ˆäºŒï¼šæ¸è¿›å¼è¿ç§»**
```
ç¬¬1é˜¶æ®µï¼šæ–°æ¨¡å—ç”¨WebFlux
ç¬¬2é˜¶æ®µï¼šæ€§èƒ½ç“¶é¢ˆæ¨¡å—æ”¹é€ 
ç¬¬3é˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—é€æ­¥è¿ç§»
ç¬¬4é˜¶æ®µï¼šé—ç•™ç³»ç»Ÿä¿æŒWebMVC

âœ¨ ä¼˜åŠ¿ï¼šé£é™©å¯æ§ï¼Œé€æ­¥è¿‡æ¸¡
```

---

## 8. ğŸ”„ ä»WebMVCè¿ç§»åˆ°WebFlux


### 8.1 è¿ç§»å‰çš„å‡†å¤‡


**è¯„ä¼°æ¸…å•**ï¼š
```
â–¡ ä¸šåŠ¡è¯„ä¼°
  - æ˜¯å¦çœŸçš„éœ€è¦è¿ç§»ï¼Ÿ
  - é¢„æœŸæ”¶ç›Šæ˜¯ä»€ä¹ˆï¼Ÿ
  - é£é™©æœ‰å¤šå¤§ï¼Ÿ

â–¡ æŠ€æœ¯è¯„ä¼°  
  - ä¾èµ–çš„åº“æ˜¯å¦æ”¯æŒå“åº”å¼ï¼Ÿ
  - æ•°æ®åº“èƒ½å¦æ¢æˆR2DBCï¼Ÿ
  - å›¢é˜Ÿå­¦ä¹ æˆæœ¬å¤šå¤§ï¼Ÿ

â–¡ èµ„æºè¯„ä¼°
  - æœ‰å¤šå°‘æ—¶é—´ï¼Ÿ
  - æœ‰å¤šå°‘äººåŠ›ï¼Ÿ
  - æµ‹è¯•èµ„æºæ˜¯å¦å……è¶³ï¼Ÿ
```

> âš ï¸ **è­¦å‘Š**ï¼šä¸è¦ä¸ºäº†å“åº”å¼è€Œå“åº”å¼ï¼Œç¡®ä¿çœŸçš„æœ‰å¿…è¦ï¼

### 8.2 ä¾èµ–åº“æ›¿æ¢


**æ ¸å¿ƒä¾èµ–å¯¹ç…§è¡¨**ï¼š

| WebMVCç»„ä»¶ | **WebFluxæ›¿ä»£å“** | **æ³¨æ„äº‹é¡¹** |
|-----------|-----------------|-------------|
| Spring Web | Spring WebFlux | æ›´æ¢starterä¾èµ– |
| Tomcat | Netty(é»˜è®¤) | è‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€é…ç½® |
| JPA/Hibernate | R2DBC | **å®Œå…¨ä¸åŒçš„API** |
| RestTemplate | WebClient | å“åº”å¼HTTPå®¢æˆ·ç«¯ |
| @Async | Reactor | ç”¨Mono/Fluxæ›¿ä»£ |
| Spring Security | Reactive Security | é…ç½®æ–¹å¼ä¸åŒ |

**ä¾èµ–æ›´æ–°ç¤ºä¾‹**ï¼š
```xml
<!-- ç§»é™¤WebMVCä¾èµ– -->
<!-- 
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
-->

<!-- æ·»åŠ WebFluxä¾èµ– -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>

<!-- ç§»é™¤JPA -->
<!--
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
-->

<!-- æ·»åŠ R2DBC -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-r2dbc</artifactId>
</dependency>
```

### 8.3 ä»£ç æ”¹é€ æ­¥éª¤


**æ­¥éª¤1ï¼šæ”¹é€ Controller**
```java
// æ”¹é€ å‰ï¼ˆWebMVCï¼‰
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) {
    return userService.findById(id);
}

// æ”¹é€ åï¼ˆWebFluxï¼‰
@GetMapping("/users/{id}")
public Mono<User> getUser(@PathVariable Long id) {
    return userService.findById(id);
}
```

**æ­¥éª¤2ï¼šæ”¹é€ Serviceå±‚**
```java
// æ”¹é€ å‰ï¼ˆWebMVCï¼‰
@Service
public class UserService {
    public User findById(Long id) {
        return userRepository.findById(id).orElseThrow();
    }
}

// æ”¹é€ åï¼ˆWebFluxï¼‰
@Service
public class UserService {
    public Mono<User> findById(Long id) {
        return userRepository.findById(id)
            .switchIfEmpty(Mono.error(new NotFoundException()));
    }
}
```

**æ­¥éª¤3ï¼šæ”¹é€ Repository**
```java
// æ”¹é€ å‰ï¼ˆJPAï¼‰
public interface UserRepository extends JpaRepository<User, Long> {
    List<User> findByName(String name);
}

// æ”¹é€ åï¼ˆR2DBCï¼‰
public interface UserRepository extends R2dbcRepository<User, Long> {
    Flux<User> findByName(String name);
}
```

### 8.4 å¸¸è§è¿ç§»é™·é˜±


**é™·é˜±1ï¼šé˜»å¡å¼è°ƒç”¨**
```java
// âŒ é”™è¯¯ï¼šåœ¨å“åº”å¼ä»£ç ä¸­ä½¿ç”¨é˜»å¡è°ƒç”¨
public Mono<User> getUser(Long id) {
    return Mono.fromCallable(() -> {
        // è¿™æ˜¯é˜»å¡è°ƒç”¨ï¼Œä¼šæµªè´¹çº¿ç¨‹ï¼
        return jdbcTemplate.queryForObject(
            "SELECT * FROM users WHERE id = ?",
            User.class, 
            id
        );
    });
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å“åº”å¼é©±åŠ¨
public Mono<User> getUser(Long id) {
    return databaseClient
        .sql("SELECT * FROM users WHERE id = :id")
        .bind("id", id)
        .fetch()
        .one()
        .map(row -> mapToUser(row));
}
```

**é™·é˜±2ï¼šè¿‡åº¦ä½¿ç”¨block()**
```java
// âŒ é”™è¯¯ï¼šåˆ°å¤„ä½¿ç”¨block()
public User getUser(Long id) {
    // block()ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¤±å»å“åº”å¼çš„æ„ä¹‰ï¼
    return userRepository.findById(id).block();
}

// âœ… æ­£ç¡®ï¼šä¿æŒå“åº”å¼é“¾è·¯
public Mono<User> getUser(Long id) {
    return userRepository.findById(id);
}
```

**é™·é˜±3ï¼šä¸å¤„ç†èƒŒå‹**
```java
// âŒ å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º
public Flux<User> getAllUsers() {
    return userRepository.findAll();  // ç™¾ä¸‡æ•°æ®ä¸€æ¬¡æ€§åŠ è½½
}

// âœ… æ­£ç¡®ï¼šé™åˆ¶æµé€Ÿ
public Flux<User> getAllUsers() {
    return userRepository.findAll()
        .limitRate(100);  // æ¯æ¬¡æœ€å¤š100æ¡
}
```

### 8.5 è¿ç§»å»ºè®®


**æ¸è¿›å¼è¿ç§»è·¯çº¿**ï¼š
```
é˜¶æ®µ1ï¼šæ–°åŠŸèƒ½ä½¿ç”¨WebFlux
â”œâ”€ æ–°çš„APIæ¥å£
â”œâ”€ æ–°çš„å¾®æœåŠ¡
â””â”€ ç‹¬ç«‹çš„æ¨¡å—

é˜¶æ®µ2ï¼šæ”¹é€ æ€§èƒ½ç“¶é¢ˆ
â”œâ”€ é«˜å¹¶å‘æ¥å£
â”œâ”€ IOå¯†é›†å‹æ“ä½œ
â””â”€ å¤–éƒ¨è°ƒç”¨å¯†é›†çš„æœåŠ¡

é˜¶æ®µ3ï¼šæ ¸å¿ƒä¸šåŠ¡è¿ç§»
â”œâ”€ ç”¨æˆ·æœåŠ¡
â”œâ”€ è®¢å•æœåŠ¡
â””â”€ æ”¯ä»˜æœåŠ¡

é˜¶æ®µ4ï¼šé—ç•™ç³»ç»Ÿ
â”œâ”€ ç¨³å®šè¿è¡Œçš„è€ç³»ç»Ÿ
â”œâ”€ ä¸éœ€è¦é«˜æ€§èƒ½çš„æ¨¡å—
â””â”€ å¯ä»¥ä¿æŒWebMVC
```

> ğŸ’¡ **é»„é‡‘æ³•åˆ™**ï¼šä¸è¦ä¸€æ¬¡æ€§å…¨éƒ¨è¿ç§»ï¼Œåˆ†æ‰¹æ¬¡ã€æœ‰è®¡åˆ’åœ°è¿›è¡Œï¼

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å…³é”®æ¦‚å¿µå›é¡¾


```
ğŸŒŠ å“åº”å¼ç¼–ç¨‹
â”œâ”€ æ ¸å¿ƒæ€æƒ³ï¼šæ•°æ®æµ + äº‹ä»¶é©±åŠ¨ + å¼‚æ­¥éé˜»å¡
â”œâ”€ ä¸‰è¦ç´ ï¼šPublisherã€Subscriberã€Backpressure
â””â”€ ä»·å€¼ï¼šå°‘é‡çº¿ç¨‹å¤„ç†æµ·é‡å¹¶å‘

ğŸ”„ æŠ€æœ¯æ ˆå¯¹æ¯”
â”œâ”€ Servletæ ˆï¼šåŒæ­¥é˜»å¡ï¼Œä¸€è¯·æ±‚ä¸€çº¿ç¨‹
â”œâ”€ Reactiveæ ˆï¼šå¼‚æ­¥éé˜»å¡ï¼Œäº‹ä»¶é©±åŠ¨
â””â”€ é€‰æ‹©ä¾æ®ï¼šçœ‹å…·ä½“ä¸šåŠ¡åœºæ™¯

âš”ï¸ WebMVC vs WebFlux
â”œâ”€ APIå·®å¼‚ï¼šå¯¹è±¡ vs Mono/Flux
â”œâ”€ ç¼–ç¨‹æ¨¡å¼ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼
â””â”€ æ€§èƒ½ç‰¹ç‚¹ï¼šç¨³å®šå¤Ÿç”¨ vs æè‡´æ€§èƒ½
```

### 9.2 æŠ€æœ¯é€‰å‹å»ºè®®


**é€‰æ‹©WebMVCçš„ç†ç”±**ï¼š
- âœ… å¸¸è§„Webåº”ç”¨ï¼ˆ90%åœºæ™¯ï¼‰
- âœ… å›¢é˜Ÿç†Ÿæ‚‰åŒæ­¥ç¼–ç¨‹
- âœ… ä¾èµ–JPAç­‰é˜»å¡å¼åº“
- âœ… ä¸šåŠ¡é€»è¾‘å¤æ‚éœ€è¦è°ƒè¯•

**é€‰æ‹©WebFluxçš„ç†ç”±**ï¼š
- âš¡ è¶…é«˜å¹¶å‘éœ€æ±‚ï¼ˆ>10000ï¼‰
- âš¡ æµå¼æ•°æ®å¤„ç†
- âš¡ IOå¯†é›†å‹åº”ç”¨
- âš¡ å¾®æœåŠ¡ç½‘å…³åœºæ™¯

> ğŸ¯ **æ ¸å¿ƒåŸåˆ™**ï¼šWebMVCèƒ½æ»¡è¶³éœ€æ±‚å°±ç”¨WebMVCï¼ŒçœŸæœ‰æ€§èƒ½ç“¶é¢ˆæ‰è€ƒè™‘WebFlux

### 9.3 å­¦ä¹ è·¯çº¿å»ºè®®


**å…¥é—¨è·¯çº¿**ï¼š
```
ç¬¬1æ­¥ï¼šæŒæ¡å“åº”å¼åŸºç¡€æ¦‚å¿µ
â”œâ”€ ç†è§£é˜»å¡ä¸éé˜»å¡
â”œâ”€ ç†è§£Monoå’ŒFlux
â””â”€ ç†è§£èƒŒå‹æœºåˆ¶

ç¬¬2æ­¥ï¼šå­¦ä¹ åŸºç¡€æ“ä½œç¬¦
â”œâ”€ mapã€filterã€flatMap
â”œâ”€ zipã€mergeã€concat
â””â”€ é”™è¯¯å¤„ç†æ“ä½œç¬¦

ç¬¬3æ­¥ï¼šå®è·µå°é¡¹ç›®
â”œâ”€ ç®€å•çš„CRUD API
â”œâ”€ é›†æˆR2DBCæ•°æ®åº“
â””â”€ è°ƒç”¨å¤–éƒ¨WebClient

ç¬¬4æ­¥ï¼šæ·±å…¥é«˜çº§ç‰¹æ€§
â”œâ”€ è‡ªå®šä¹‰æ“ä½œç¬¦
â”œâ”€ æ€§èƒ½è°ƒä¼˜
â””â”€ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ
```

### 9.4 è®°å¿†è¦ç‚¹


**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å“åº”å¼ç¼–ç¨‹ä¸‰è¦ç´ ï¼š
  å‘å¸ƒè®¢é˜…èƒŒå‹è¿
  
é˜»å¡éé˜»å¡åŒºåˆ«ï¼š
  ç­‰å¾…æµªè´¹å¯¹å¿«é€Ÿ
  
æŠ€æœ¯é€‰å‹çœ‹ä¸‰ç‚¹ï¼š
  å¹¶å‘æµå¼å›¢é˜Ÿç†Ÿ
  
è¿ç§»æ”¹é€ å››æ­¥èµ°ï¼š
  è¯„ä¼°æ”¹é€ æµ‹è¯•ä¸Š
```

**å…³é”®å¯¹æ¯”è¡¨**ï¼š

| ç»´åº¦ | **WebMVC** | **WebFlux** |
|------|-----------|------------|
| **å­¦ä¹ æ›²çº¿** | â­â­ ç®€å• | â­â­â­â­ é™¡å³­ |
| **å¹¶å‘èƒ½åŠ›** | â­â­â­ ä¸€èˆ¬ | â­â­â­â­â­ æå¼º |
| **èµ„æºå ç”¨** | â­â­ è¾ƒé«˜ | â­â­â­â­â­ æä½ |
| **ç”Ÿæ€æˆç†Ÿåº¦** | â­â­â­â­â­ å®Œå–„ | â­â­â­ å‘å±•ä¸­ |
| **è°ƒè¯•éš¾åº¦** | â­â­ ç®€å• | â­â­â­â­ å›°éš¾ |
| **é€‚ç”¨èŒƒå›´** | â­â­â­â­â­ å¹¿æ³› | â­â­â­ ç‰¹å®šåœºæ™¯ |

---

> ğŸ’¡ **æœ€åçš„å»ºè®®**ï¼š
> - å“åº”å¼ç¼–ç¨‹ä¸æ˜¯é“¶å¼¹ï¼Œä¸è¦ç›²ç›®è¿½æ±‚
> - WebMVCä¾ç„¶æ˜¯ä¸»æµé€‰æ‹©ï¼Œç¨³å®šå¯é 
> - çœŸæœ‰æ€§èƒ½ç“¶é¢ˆæ—¶ï¼ŒWebFluxæ‰æ˜¯æ­£ç¡®é€‰æ‹©
> - å­¦ä¹ å“åº”å¼ç¼–ç¨‹ï¼Œæ‰“å¼€æ–°çš„æŠ€æœ¯è§†é‡