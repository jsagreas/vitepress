---
title: 2ã€å¾®æœåŠ¡æ¶æ„é€‚é…
---
## ğŸ“š ç›®å½•

1. [å¾®æœåŠ¡æ¶æ„æ¦‚è¿°](#1-å¾®æœåŠ¡æ¶æ„æ¦‚è¿°)
2. [æœåŠ¡æ‹†åˆ†ç­–ç•¥](#2-æœåŠ¡æ‹†åˆ†ç­–ç•¥)
3. [æœåŠ¡é—´é€šä¿¡](#3-æœåŠ¡é—´é€šä¿¡)
4. [é…ç½®ä¸­å¿ƒé›†æˆ](#4-é…ç½®ä¸­å¿ƒé›†æˆ)
5. [æœåŠ¡æ³¨å†Œä¸å‘ç°](#5-æœåŠ¡æ³¨å†Œä¸å‘ç°)
6. [ç†”æ–­é™çº§æœºåˆ¶](#6-ç†”æ–­é™çº§æœºåˆ¶)
7. [åˆ†å¸ƒå¼è¿½è¸ª](#7-åˆ†å¸ƒå¼è¿½è¸ª)
8. [APIç½‘å…³é›†æˆ](#8-APIç½‘å…³é›†æˆ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„


> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**
> 
> ä¼ ç»Ÿå•ä½“åº”ç”¨å°±åƒä¸€ä¸ªå¤§å•†åœºï¼Œæ‰€æœ‰å•†å“éƒ½åœ¨ä¸€æ ‹æ¥¼é‡Œï¼Œä¸€ä¸ªéƒ¨åˆ†å‡ºé—®é¢˜æ•´ä¸ªå•†åœºéƒ½å—å½±å“ã€‚å¾®æœåŠ¡å°±åƒå•†ä¸šè¡—ï¼Œæ¯ä¸ªåº—é“ºç‹¬ç«‹ç»è¥ï¼ŒæŸå®¶åº—å…³é—¨ä¸å½±å“å…¶ä»–åº—ç»§ç»­è¥ä¸šã€‚

**æ ¸å¿ƒç†å¿µ**ï¼š
- **ç‹¬ç«‹éƒ¨ç½²**ï¼šæ¯ä¸ªæœåŠ¡å¯ä»¥å•ç‹¬ä¸Šçº¿ï¼Œä¸å½±å“å…¶ä»–æœåŠ¡
- **èŒè´£å•ä¸€**ï¼šä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹ï¼Œåšå¥½ä¸€ä»¶äº‹
- **æŠ€æœ¯å¤šæ ·**ï¼šä¸åŒæœåŠ¡å¯ä»¥ç”¨ä¸åŒæŠ€æœ¯æ ˆ
- **å›¢é˜Ÿè‡ªæ²»**ï¼šæ¯ä¸ªå›¢é˜Ÿè´Ÿè´£è‡ªå·±çš„æœåŠ¡

### 1.2 å•ä½“åº”ç”¨ vs å¾®æœåŠ¡æ¶æ„


```
å•ä½“åº”ç”¨æ¶æ„ï¼š                å¾®æœåŠ¡æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚          â”‚ç”¨æˆ·æœåŠ¡â”‚ â”‚è®¢å•æœåŠ¡â”‚
â”‚   æ•´ä¸ªåº”ç”¨      â”‚   VS     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (ä¸€ä¸ªwaråŒ…)    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚          â”‚å•†å“æœåŠ¡â”‚ â”‚æ”¯ä»˜æœåŠ¡â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¯¹æ¯”åˆ†æ**ï¼š

| ç‰¹æ€§ | **å•ä½“åº”ç”¨** | **å¾®æœåŠ¡æ¶æ„** |
|-----|------------|--------------|
| **éƒ¨ç½²** | `æ•´ä½“éƒ¨ç½²ï¼Œæ”¹ä¸€å¤„å…¨éƒ¨é‡å¯` | `ç‹¬ç«‹éƒ¨ç½²ï¼Œäº’ä¸å½±å“` |
| **æ‰©å±•** | `åªèƒ½æ•´ä½“æ‰©å±•` | `æŒ‰éœ€æ‰©å±•å•ä¸ªæœåŠ¡` |
| **æŠ€æœ¯** | `æŠ€æœ¯æ ˆç»Ÿä¸€` | `æŠ€æœ¯æ ˆçµæ´»é€‰æ‹©` |
| **æ•…éšœå½±å“** | `ä¸€å¤„å´©æºƒå…¨éƒ¨ç˜«ç—ª` | `å•ä¸ªæœåŠ¡æ•…éšœéš”ç¦»` |
| **å¼€å‘å¤æ‚åº¦** | `ç®€å•ç›´æ¥` | `éœ€è¦è€ƒè™‘åˆ†å¸ƒå¼é—®é¢˜` |

ğŸ”´ **å¿…é¡»æŒæ¡**ï¼šå¾®æœåŠ¡ä¸æ˜¯é“¶å¼¹ï¼Œå°é¡¹ç›®ç”¨å•ä½“åº”ç”¨åè€Œæ›´ç®€å•é«˜æ•ˆ

---

## 2. ğŸ”ª æœåŠ¡æ‹†åˆ†ç­–ç•¥


### 2.1 æ‹†åˆ†åŸåˆ™


**æ ¸å¿ƒæ€æƒ³**ï¼šæŒ‰ç…§ä¸šåŠ¡èƒ½åŠ›å’Œè¾¹ç•Œæ¥æ‹†åˆ†ï¼Œä¸æ˜¯éšä¾¿æ‹†

```
âŒ é”™è¯¯æ‹†åˆ†ï¼šæŒ‰æŠ€æœ¯å±‚æ¬¡æ‹†åˆ†
   ç”¨æˆ·ControlleræœåŠ¡ + ç”¨æˆ·ServiceæœåŠ¡ + ç”¨æˆ·DAOæœåŠ¡
   
âœ… æ­£ç¡®æ‹†åˆ†ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†
   ç”¨æˆ·æœåŠ¡(å®Œæ•´ä¸šåŠ¡) + è®¢å•æœåŠ¡(å®Œæ•´ä¸šåŠ¡) + å•†å“æœåŠ¡(å®Œæ•´ä¸šåŠ¡)
```

**æ‹†åˆ†å››åŸåˆ™**ï¼š

ğŸ”¸ **å•ä¸€èŒè´£åŸåˆ™**
- ä¸€ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
- ä¾‹ï¼šç”¨æˆ·æœåŠ¡åªç®¡ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†

ğŸ”¸ **é«˜å†…èšä½è€¦åˆ**
- ç›¸å…³åŠŸèƒ½æ”¾åœ¨ä¸€èµ·ï¼Œä¸ç›¸å…³çš„åˆ†å¼€
- ä¾‹ï¼šè®¢å•åˆ›å»ºã€è®¢å•æŸ¥è¯¢ã€è®¢å•å–æ¶ˆæ”¾åœ¨è®¢å•æœåŠ¡

ğŸ”¸ **ä¸šåŠ¡ç‹¬ç«‹æ€§**
- æœåŠ¡èƒ½ç‹¬ç«‹å®Œæˆä¸šåŠ¡é—­ç¯
- ä¾‹ï¼šæ”¯ä»˜æœåŠ¡èƒ½ç‹¬ç«‹å¤„ç†æ”¯ä»˜æµç¨‹

ğŸ”¸ **æ•°æ®ç‹¬ç«‹æ€§**
- æ¯ä¸ªæœåŠ¡æœ‰è‡ªå·±çš„æ•°æ®åº“
- ä¸èƒ½ç›´æ¥è®¿é—®å…¶ä»–æœåŠ¡çš„æ•°æ®åº“

### 2.2 å®æˆ˜æ‹†åˆ†æ¡ˆä¾‹


**ç”µå•†ç³»ç»Ÿæ‹†åˆ†ç¤ºä¾‹**ï¼š

```
åŸå•ä½“åº”ç”¨ â†’ æ‹†åˆ†åçš„å¾®æœåŠ¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚        â”‚ç”¨æˆ·æœåŠ¡  â”‚ â† æ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯
â”‚                     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   ç”µå•†å•ä½“åº”ç”¨      â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚   â†’    â”‚å•†å“æœåŠ¡  â”‚ â† å•†å“ç®¡ç†ã€åº“å­˜ç®¡ç†
â”‚                     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                     â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚        â”‚è®¢å•æœåŠ¡  â”‚ â† ä¸‹å•ã€è®¢å•æŸ¥è¯¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚æ”¯ä»˜æœåŠ¡  â”‚ â† æ”¯ä»˜ã€é€€æ¬¾
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‹†åˆ†æ­¥éª¤**ï¼š

**ç¬¬ä¸€æ­¥ï¼šè¯†åˆ«ä¸šåŠ¡è¾¹ç•Œ**
```
1. ç”¨æˆ·ç›¸å…³ï¼šæ³¨å†Œã€ç™»å½•ã€ä¸ªäººä¿¡æ¯ â†’ ç”¨æˆ·æœåŠ¡
2. å•†å“ç›¸å…³ï¼šå•†å“ç®¡ç†ã€åº“å­˜ â†’ å•†å“æœåŠ¡  
3. è®¢å•ç›¸å…³ï¼šä¸‹å•ã€æŸ¥è¯¢ã€å–æ¶ˆ â†’ è®¢å•æœåŠ¡
4. æ”¯ä»˜ç›¸å…³ï¼šæ”¯ä»˜ã€é€€æ¬¾ â†’ æ”¯ä»˜æœåŠ¡
```

**ç¬¬äºŒæ­¥ï¼šå®šä¹‰æœåŠ¡æ¥å£**
```java
// ç”¨æˆ·æœåŠ¡å¯¹å¤–æä¾›çš„æ¥å£
public interface UserService {
    UserDTO getUserById(Long userId);
    boolean validateUser(String username, String password);
}

// è®¢å•æœåŠ¡å¯¹å¤–æä¾›çš„æ¥å£
public interface OrderService {
    OrderDTO createOrder(OrderRequest request);
    OrderDTO getOrderById(Long orderId);
}
```

**ç¬¬ä¸‰æ­¥ï¼šå¤„ç†æ•°æ®ä¾èµ–**
- æ¯ä¸ªæœåŠ¡ç‹¬ç«‹çš„æ•°æ®åº“
- é€šè¿‡æ¥å£è°ƒç”¨è·å–å…¶ä»–æœåŠ¡æ•°æ®
- å¿…è¦æ—¶ä½¿ç”¨æ•°æ®å†—ä½™

> âš ï¸ **æ˜“é”™é‡ç‚¹**
> 
> å¾ˆå¤šäººæ‹†åˆ†æ—¶è¿½æ±‚"å®Œå…¨è§£è€¦"ï¼Œå¯¼è‡´ä¸€ä¸ªç®€å•æ“ä½œè¦è°ƒç”¨åå‡ ä¸ªæœåŠ¡ã€‚
> **æ­£ç¡®åšæ³•**ï¼šé€‚åº¦å†—ä½™æ•°æ®ï¼Œå‡å°‘æœåŠ¡é—´è°ƒç”¨ï¼Œæ€§èƒ½ä¼˜å…ˆäº"çº¯ç²¹æ€§"

---

## 3. ğŸ”— æœåŠ¡é—´é€šä¿¡


### 3.1 é€šä¿¡æ–¹å¼é€‰æ‹©


**ä¸»æµé€šä¿¡æ–¹å¼**ï¼š

```
åŒæ­¥é€šä¿¡ï¼š                å¼‚æ­¥é€šä¿¡ï¼š
å®¢æˆ·ç«¯ â†’ æœåŠ¡A           å®¢æˆ·ç«¯ â†’ æ¶ˆæ¯é˜Ÿåˆ—
         â†“                        â†“
       ç­‰å¾…å“åº”                  æœåŠ¡Aè®¢é˜…
         â†“                        â†“
      è¿”å›ç»“æœ                 å¼‚æ­¥å¤„ç†
```

**é€šä¿¡æ–¹å¼å¯¹æ¯”**ï¼š

| é€šä¿¡æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|---------|---------|
| **REST** | `æŸ¥è¯¢ç±»æ“ä½œ` | `ç®€å•æ˜“æ‡‚ï¼Œå¹¿æ³›æ”¯æŒ` | `æ€§èƒ½ä¸€èˆ¬` |
| **Feign** | `æœåŠ¡é—´è°ƒç”¨` | `å£°æ˜å¼è°ƒç”¨ï¼Œç±»ä¼¼æœ¬åœ°æ–¹æ³•` | `ä¾èµ–Spring Cloud` |
| **æ¶ˆæ¯é˜Ÿåˆ—** | `å¼‚æ­¥å¤„ç†ï¼Œå‰Šå³°å¡«è°·` | `è§£è€¦ï¼Œé«˜å¯ç”¨` | `å¤æ‚åº¦é«˜ï¼Œæ•°æ®ä¸€è‡´æ€§éš¾ä¿è¯` |

### 3.2 Feignå£°æ˜å¼è°ƒç”¨


**ä»€ä¹ˆæ˜¯Feign**ï¼šæŠŠHTTPè°ƒç”¨ä¼ªè£…æˆæœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼Œå†™èµ·æ¥åƒè°ƒæœ¬åœ°æ¥å£

**åŸºæœ¬ä½¿ç”¨**ï¼š

```java
// 1. å¼•å…¥ä¾èµ–ï¼ˆpom.xmlï¼‰
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>

// 2. å¯ç”¨Feign
@SpringBootApplication
@EnableFeignClients
public class OrderApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderApplication.class, args);
    }
}

// 3. å®šä¹‰Feignæ¥å£ï¼ˆè®¢å•æœåŠ¡è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼‰
@FeignClient(name = "user-service")  // user-serviceæ˜¯æœåŠ¡å
public interface UserClient {
    
    @GetMapping("/users/{id}")
    UserDTO getUserById(@PathVariable("id") Long id);
}

// 4. åœ¨Controllerä¸­ä½¿ç”¨
@RestController
public class OrderController {
    
    @Autowired
    private UserClient userClient;
    
    @PostMapping("/orders")
    public OrderDTO createOrder(@RequestBody OrderRequest request) {
        // åƒè°ƒæœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡
        UserDTO user = userClient.getUserById(request.getUserId());
        
        if (user == null) {
            throw new RuntimeException("ç”¨æˆ·ä¸å­˜åœ¨");
        }
        
        // åˆ›å»ºè®¢å•é€»è¾‘...
        return new OrderDTO();
    }
}
```

**è°ƒç”¨æµç¨‹å›¾**ï¼š

```
è®¢å•æœåŠ¡                         ç”¨æˆ·æœåŠ¡
   â†“
è°ƒç”¨userClient.getUserById(1)
   â†“
Feignç”ŸæˆHTTPè¯·æ±‚
   â†“                         
GET /users/1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  UserController
                               â†“
                           æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
                               â†“
   â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  è¿”å›JSONæ•°æ®
   â†“
Feignè‡ªåŠ¨è½¬æ¢ä¸ºUserDTOå¯¹è±¡
   â†“
ä¸šåŠ¡é€»è¾‘ç»§ç»­å¤„ç†
```

### 3.3 è¶…æ—¶ä¸é‡è¯•é…ç½®


**ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶æ§åˆ¶**ï¼šé˜²æ­¢æŸä¸ªæœåŠ¡å“åº”æ…¢æ‹–å®æ•´ä¸ªç³»ç»Ÿ

```yaml
# application.yml
feign:
  client:
    config:
      default:  # å…¨å±€é…ç½®
        connectTimeout: 5000  # è¿æ¥è¶…æ—¶5ç§’
        readTimeout: 10000    # è¯»å–è¶…æ—¶10ç§’
      user-service:  # é’ˆå¯¹ç‰¹å®šæœåŠ¡é…ç½®
        connectTimeout: 3000
        readTimeout: 5000
```

**é‡è¯•ç­–ç•¥**ï¼š

```java
@Configuration
public class FeignConfig {
    
    @Bean
    public Retryer feignRetryer() {
        // åˆå§‹é—´éš”100msï¼Œæœ€å¤§é—´éš”1sï¼Œæœ€å¤šé‡è¯•3æ¬¡
        return new Retryer.Default(100, 1000, 3);
    }
}
```

ğŸŸ¡ **å»ºè®®äº†è§£**ï¼šé‡è¯•è¦è°¨æ…ï¼Œåƒæ”¯ä»˜ã€ä¸‹å•è¿™ç§æ“ä½œä¸èƒ½é‡è¯•ï¼Œä¼šå¯¼è‡´é‡å¤æ”¯ä»˜/ä¸‹å•

---

## 4. âš™ï¸ é…ç½®ä¸­å¿ƒé›†æˆ


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ä¸­å¿ƒ


**ä¼ ç»Ÿé…ç½®çš„ç—›ç‚¹**ï¼š

```
é—®é¢˜1ï¼šé…ç½®åˆ†æ•£
æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„application.yml
ä¿®æ”¹æ•°æ®åº“åœ°å€è¦æ”¹Nä¸ªæ–‡ä»¶

é—®é¢˜2ï¼šæ— æ³•åŠ¨æ€æ›´æ–°
æ”¹ä¸ªé…ç½®è¦é‡å¯æœåŠ¡
ä¸šåŠ¡é«˜å³°æœŸä¸æ•¢é‡å¯

é—®é¢˜3ï¼šç¯å¢ƒç®¡ç†æ··ä¹±
å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®æ··åœ¨ä¸€èµ·
å®¹æ˜“æ”¹é”™ç¯å¢ƒ
```

**é…ç½®ä¸­å¿ƒçš„ä½œç”¨**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é…ç½®ä¸­å¿ƒ      â”‚ â† ç»Ÿä¸€å­˜å‚¨æ‰€æœ‰é…ç½®
â”‚  (Nacos/Apollo) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“          â†“         â†“         â†“
ç”¨æˆ·æœåŠ¡   è®¢å•æœåŠ¡   å•†å“æœåŠ¡   æ”¯ä»˜æœåŠ¡
    â†“          â†“         â†“         â†“
 è‡ªåŠ¨æ‹‰å–   è‡ªåŠ¨æ‹‰å–   è‡ªåŠ¨æ‹‰å–   è‡ªåŠ¨æ‹‰å–
```

### 4.2 Nacosé…ç½®ä¸­å¿ƒå®æˆ˜


**ç¬¬ä¸€æ­¥ï¼šæ­å»ºNacos**

```bash
# ä¸‹è½½Nacosï¼ˆå®˜ç½‘ä¸‹è½½ï¼‰
wget https://github.com/alibaba/nacos/releases/download/2.2.0/nacos-server-2.2.0.zip

# è§£å‹å¹¶å¯åŠ¨ï¼ˆå•æœºæ¨¡å¼ï¼‰
unzip nacos-server-2.2.0.zip
cd nacos/bin
./startup.sh -m standalone

# è®¿é—®æ§åˆ¶å°ï¼šhttp://localhost:8848/nacos
# é»˜è®¤è´¦å·å¯†ç ï¼šnacos/nacos
```

**ç¬¬äºŒæ­¥ï¼šæœåŠ¡æ¥å…¥Nacos**

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
</dependency>
```

```yaml
# bootstrap.ymlï¼ˆä¼˜å…ˆçº§é«˜äºapplication.ymlï¼‰
spring:
  application:
    name: order-service  # æœåŠ¡å
  cloud:
    nacos:
      config:
        server-addr: localhost:8848  # Nacosåœ°å€
        file-extension: yaml  # é…ç½®æ–‡ä»¶æ ¼å¼
        namespace: dev  # å‘½åç©ºé—´ï¼ˆåŒºåˆ†ç¯å¢ƒï¼‰
```

**ç¬¬ä¸‰æ­¥ï¼šåœ¨Nacosä¸­åˆ›å»ºé…ç½®**

```
è¿›å…¥Nacosæ§åˆ¶å°ï¼š
1. ç‚¹å‡»"é…ç½®ç®¡ç†" â†’ "é…ç½®åˆ—è¡¨"
2. ç‚¹å‡»"+"åˆ›å»ºé…ç½®
   - Data ID: order-service.yaml
   - Group: DEFAULT_GROUP
   - é…ç½®æ ¼å¼: YAML
   - é…ç½®å†…å®¹:
     server:
       port: 8081
     spring:
       datasource:
         url: jdbc:mysql://localhost:3306/order_db
         username: root
         password: 123456
```

**ç¬¬å››æ­¥ï¼šåŠ¨æ€åˆ·æ–°é…ç½®**

```java
@RestController
@RefreshScope  // å…³é”®æ³¨è§£ï¼šæ”¯æŒé…ç½®åŠ¨æ€åˆ·æ–°
public class ConfigController {
    
    @Value("${business.discount.rate:0.9}")  // é»˜è®¤å€¼0.9
    private double discountRate;
    
    @GetMapping("/config/discount")
    public double getDiscountRate() {
        return discountRate;  // é…ç½®æ›´æ–°åè‡ªåŠ¨ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
    }
}
```

**é…ç½®æ›´æ–°æµç¨‹**ï¼š

```
1. åœ¨Nacosæ§åˆ¶å°ä¿®æ”¹é…ç½®
   â†“
2. Nacosæ¨é€é…ç½®å˜æ›´é€šçŸ¥
   â†“
3. æœåŠ¡æ”¶åˆ°é€šçŸ¥ï¼Œæ‹‰å–æœ€æ–°é…ç½®
   â†“
4. @RefreshScopeæ ‡æ³¨çš„Beané‡æ–°åˆ›å»º
   â†“
5. æ–°é…ç½®ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€é‡å¯ï¼‰
```

### 4.3 é…ç½®æœ€ä½³å®è·µ


**é…ç½®åˆ†ç±»ç®¡ç†**ï¼š

```
å…¬å…±é…ç½®ï¼š
- datasource-common.yaml  â† æ•°æ®åº“è¿æ¥æ± é…ç½®
- redis-common.yaml       â† Redisé€šç”¨é…ç½®

æœåŠ¡é…ç½®ï¼š
- order-service-dev.yaml   â† è®¢å•æœåŠ¡å¼€å‘ç¯å¢ƒ
- order-service-prod.yaml  â† è®¢å•æœåŠ¡ç”Ÿäº§ç¯å¢ƒ
```

**æ•æ„Ÿä¿¡æ¯åŠ å¯†**ï¼š

```yaml
# Nacosæ”¯æŒé…ç½®åŠ å¯†
spring:
  datasource:
    password: ENC(åŠ å¯†åçš„å¯†ç )  # ä½¿ç”¨JasyptåŠ å¯†
```

---

## 5. ğŸ” æœåŠ¡æ³¨å†Œä¸å‘ç°


### 5.1 æœåŠ¡æ³¨å†Œå‘ç°åŸç†


**æ ¸å¿ƒé—®é¢˜**ï¼šæœåŠ¡Aæ€ä¹ˆçŸ¥é“æœåŠ¡Båœ¨å“ªé‡Œï¼Ÿ

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆç¡¬ç¼–ç IPï¼‰ï¼š
è®¢å•æœåŠ¡ â†’ http://192.168.1.100:8080/users/{id}
         â†‘ å†™æ­»çš„IPï¼ŒæœåŠ¡å™¨æ¢äº†å°±ä¸è¡Œäº†

æœåŠ¡å‘ç°æ–¹å¼ï¼š
è®¢å•æœåŠ¡ â†’ æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢"user-service"åœ¨å“ª
         â†“
       è·å¾—å¯ç”¨å®ä¾‹åˆ—è¡¨
         â†“
       è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ª
         â†“
       å‘èµ·è°ƒç”¨
```

**æ³¨å†Œå‘ç°æµç¨‹å›¾**ï¼š

```
æœåŠ¡å¯åŠ¨                         æ³¨å†Œä¸­å¿ƒ(Nacos)
   â†“
1. user-serviceå¯åŠ¨
   â†“
2. æ³¨å†Œè‡ªå·±çš„ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è®°å½•ï¼šuser-service
   (IPã€ç«¯å£ã€å¥åº·çŠ¶æ€)            - 192.168.1.10:8080 å¥åº·
                                   - 192.168.1.11:8080 å¥åº·
                                   
è®¢å•æœåŠ¡è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼š
   â†“
3. æŸ¥è¯¢user-service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¿”å›å®ä¾‹åˆ—è¡¨
   â†“                              [192.168.1.10:8080,
4. è·å¾—å®ä¾‹åˆ—è¡¨                    192.168.1.11:8080]
   â†“
5. è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ª
   â†“
6. å‘èµ·HTTPè°ƒç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ 192.168.1.10:8080
```

### 5.2 NacosæœåŠ¡æ³¨å†Œ


**é›†æˆæ­¥éª¤**ï¼š

```xml
<!-- 1. æ·»åŠ ä¾èµ– -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

```yaml
# 2. é…ç½®æ³¨å†Œä¸­å¿ƒ
spring:
  application:
    name: order-service  # æœåŠ¡åï¼ˆé‡è¦ï¼ï¼‰
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848  # Nacosåœ°å€
        namespace: dev  # å‘½åç©ºé—´
        group: DEFAULT_GROUP  # åˆ†ç»„
```

```java
// 3. å¯ç”¨æœåŠ¡å‘ç°
@SpringBootApplication
@EnableDiscoveryClient  // å…³é”®æ³¨è§£
public class OrderApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderApplication.class, args);
    }
}
```

**å¯åŠ¨åæŸ¥çœ‹**ï¼š
- æ‰“å¼€Nacosæ§åˆ¶å° â†’ æœåŠ¡ç®¡ç† â†’ æœåŠ¡åˆ—è¡¨
- å¯ä»¥çœ‹åˆ°order-serviceå·²æ³¨å†Œï¼Œæ˜¾ç¤ºå®ä¾‹æ•°ã€å¥åº·çŠ¶æ€

### 5.3 è´Ÿè½½å‡è¡¡è°ƒç”¨


**Ribbonè´Ÿè½½å‡è¡¡**ï¼š

```java
@Configuration
public class LoadBalancerConfig {
    
    // Ribbonä¼šè‡ªåŠ¨æ‹¦æˆªFeignè¯·æ±‚ï¼Œå®ç°è´Ÿè½½å‡è¡¡
    @Bean
    @LoadBalanced  // å…³é”®æ³¨è§£ï¼šå¯ç”¨è´Ÿè½½å‡è¡¡
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

// ä½¿ç”¨RestTemplateè°ƒç”¨ï¼ˆä¸æ¨èï¼ŒFeignæ›´å¥½ï¼‰
@RestController
public class OrderController {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @GetMapping("/order/user/{id}")
    public UserDTO getUser(@PathVariable Long id) {
        // user-serviceæ˜¯æœåŠ¡åï¼ŒRibbonä¼šè§£æä¸ºå®é™…IP
        String url = "http://user-service/users/" + id;
        return restTemplate.getForObject(url, UserDTO.class);
    }
}
```

**è´Ÿè½½å‡è¡¡ç­–ç•¥**ï¼š

| ç­–ç•¥ | **è¯´æ˜** | **é€‚ç”¨åœºæ™¯** |
|-----|---------|------------|
| **è½®è¯¢** | `ä¾æ¬¡è°ƒç”¨æ¯ä¸ªå®ä¾‹` | `é»˜è®¤ç­–ç•¥ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯` |
| **éšæœº** | `éšæœºé€‰æ‹©å®ä¾‹` | `ç®€å•åœºæ™¯` |
| **æœ€å°‘å¹¶å‘** | `é€‰æ‹©å¹¶å‘é‡æœ€å°çš„å®ä¾‹` | `å“åº”æ—¶é—´å·®å¼‚å¤§çš„åœºæ™¯` |
| **åŠ æƒå“åº”æ—¶é—´** | `å“åº”å¿«çš„å®ä¾‹è·å¾—æ›´å¤šè¯·æ±‚` | `æ€§èƒ½å·®å¼‚æ˜æ˜¾çš„åœºæ™¯` |

```yaml
# é…ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥
user-service:  # æœåŠ¡å
  ribbon:
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule  # éšæœºç­–ç•¥
```

---

## 6. ğŸ›¡ï¸ ç†”æ–­é™çº§æœºåˆ¶


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç†”æ–­é™çº§


**é›ªå´©æ•ˆåº”**ï¼šä¸€ä¸ªæœåŠ¡æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒ

```
æ­£å¸¸æƒ…å†µï¼š
ç”¨æˆ· â†’ è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡ â†’ è¿”å›ç»“æœ
                  â†“ (1ç§’)
                å“åº”å¿«
                
å•†å“æœåŠ¡æ•…éšœï¼š
ç”¨æˆ· â†’ è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡(æŒ‚äº†)
         â†“          â†“ (30ç§’è¶…æ—¶)
       ç­‰å¾…...    ç­‰å¾…...
         â†“          â†“
      çº¿ç¨‹è€—å°½   æ‹–å®è®¢å•æœåŠ¡
         â†“
      ç³»ç»Ÿå´©æºƒ
```

**ç†”æ–­å™¨å·¥ä½œåŸç†**ï¼ˆå°±åƒå®¶é‡Œçš„ä¿é™©ä¸ï¼‰ï¼š

```
æ­£å¸¸çŠ¶æ€(å…³é—­)              æ•…éšœçŠ¶æ€(æ‰“å¼€)
   â†“                          â†“
è°ƒç”¨å•†å“æœåŠ¡ â”€â”€âœ“â”€â”€â”€â”€â†’  ç›´æ¥è¿”å›é™çº§ç»“æœ
   â†“                    (ä¸è°ƒç”¨å•†å“æœåŠ¡)
è¿”å›æ­£å¸¸ç»“æœ                  â†“
                       ä¸€æ®µæ—¶é—´åå°è¯•æ¢å¤
```

### 6.2 Sentinelç†”æ–­é™çº§


**ä»€ä¹ˆæ˜¯Sentinel**ï¼šé˜¿é‡Œå¼€æºçš„æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ç»„ä»¶

**é›†æˆæ­¥éª¤**ï¼š

```xml
<!-- 1. æ·»åŠ ä¾èµ– -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
</dependency>
```

```yaml
# 2. é…ç½®Sentinel
spring:
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8080  # Sentinelæ§åˆ¶å°åœ°å€
        port: 8719  # ä¸æ§åˆ¶å°é€šä¿¡çš„ç«¯å£
```

```java
// 3. ä½¿ç”¨@SentinelResourceæ³¨è§£
@Service
public class ProductService {
    
    @SentinelResource(
        value = "getProduct",  // èµ„æºå
        fallback = "getProductFallback",  // é™çº§æ–¹æ³•
        blockHandler = "getProductBlockHandler"  // é™æµæ–¹æ³•
    )
    public ProductDTO getProduct(Long id) {
        // è°ƒç”¨è¿œç¨‹å•†å“æœåŠ¡
        return productClient.getProductById(id);
    }
    
    // é™çº§æ–¹æ³•ï¼šæœåŠ¡å‡ºé”™æ—¶è°ƒç”¨
    public ProductDTO getProductFallback(Long id, Throwable e) {
        ProductDTO fallback = new ProductDTO();
        fallback.setId(id);
        fallback.setName("å•†å“æœåŠ¡æš‚æ—¶ä¸å¯ç”¨");
        fallback.setPrice(0.0);
        return fallback;
    }
    
    // é™æµæ–¹æ³•ï¼šè§¦å‘é™æµè§„åˆ™æ—¶è°ƒç”¨
    public ProductDTO getProductBlockHandler(Long id, BlockException e) {
        ProductDTO blocked = new ProductDTO();
        blocked.setId(id);
        blocked.setName("è®¿é—®å¤ªé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
        return blocked;
    }
}
```

### 6.3 ç†”æ–­è§„åˆ™é…ç½®


**åœ¨Sentinelæ§åˆ¶å°é…ç½®è§„åˆ™**ï¼š

```
1. è®¿é—® http://localhost:8080
2. æ‰¾åˆ°å¯¹åº”æœåŠ¡
3. é…ç½®ç†”æ–­è§„åˆ™ï¼š
   - èµ„æºåï¼šgetProduct
   - ç†”æ–­ç­–ç•¥ï¼šæ…¢è°ƒç”¨æ¯”ä¾‹
   - æœ€å¤§RTï¼š1000msï¼ˆè¶…è¿‡1ç§’ç®—æ…¢è°ƒç”¨ï¼‰
   - æ¯”ä¾‹é˜ˆå€¼ï¼š50%ï¼ˆæ…¢è°ƒç”¨è¶…è¿‡50%è§¦å‘ç†”æ–­ï¼‰
   - ç†”æ–­æ—¶é•¿ï¼š10ç§’ï¼ˆç†”æ–­å10ç§’æ¢å¤ï¼‰
   - æœ€å°è¯·æ±‚æ•°ï¼š5ï¼ˆè‡³å°‘5ä¸ªè¯·æ±‚æ‰ç»Ÿè®¡ï¼‰
```

**ç†”æ–­çŠ¶æ€æœº**ï¼š

```
     å…³é—­çŠ¶æ€
        â†“
    æ­£å¸¸è°ƒç”¨
        â†“
  é”™è¯¯ç‡è¶…è¿‡é˜ˆå€¼
        â†“
     æ‰“å¼€çŠ¶æ€ â”€â”€â”€â”€â”€â†’ ç›´æ¥é™çº§ï¼Œä¸è°ƒç”¨
        â†“              (ç†”æ–­æ—¶é•¿)
  æ—¶é—´çª—å£åˆ°æœŸ           â†“
        â†“              â†“
    åŠå¼€çŠ¶æ€ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   å°è¯•è°ƒç”¨
    â†™     â†˜
 æˆåŠŸ       å¤±è´¥
   â†“         â†“
å…³é—­çŠ¶æ€   æ‰“å¼€çŠ¶æ€
```

**å®æˆ˜æ•ˆæœ**ï¼š

```
æœªå¼€å¯ç†”æ–­ï¼š
å•†å“æœåŠ¡æŒ‚äº† â†’ è®¢å•æœåŠ¡æ¯æ¬¡è°ƒç”¨ç­‰30ç§’ â†’ ç³»ç»Ÿå´©æºƒ

å¼€å¯ç†”æ–­åï¼š
å•†å“æœåŠ¡æŒ‚äº† â†’ è§¦å‘ç†”æ–­ â†’ ç›´æ¥è¿”å›é™çº§æ•°æ® â†’ ç³»ç»Ÿæ­£å¸¸
                         (å•†å“åç§°æ˜¾ç¤º"æš‚ä¸å¯ç”¨")
```

> âš ï¸ **æ˜“é”™é‡ç‚¹**
> 
> é™çº§ä¸æ˜¯è®©åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨ï¼Œè€Œæ˜¯æä¾›"æœ‰æŸæœåŠ¡"ã€‚
> æ¯”å¦‚å•†å“è¯¦æƒ…é¡µï¼Œä¸»è¦ä¿¡æ¯è¿˜æ˜¯è¦å±•ç¤ºçš„ï¼Œåªæ˜¯è¯„è®ºã€æ¨èç­‰æ¬¡è¦åŠŸèƒ½å¯ä»¥é™çº§æ‰ã€‚

---

## 7. ğŸ”¬ åˆ†å¸ƒå¼è¿½è¸ª


### 7.1 åˆ†å¸ƒå¼è¿½è¸ªçš„å¿…è¦æ€§


**é—®é¢˜åœºæ™¯**ï¼šç”¨æˆ·åé¦ˆä¸‹å•å¾ˆæ…¢ï¼Œåˆ°åº•å“ªä¸ªæœåŠ¡æ…¢ï¼Ÿ

```
ç”¨æˆ·ä¸‹å•è¯·æ±‚é“¾è·¯ï¼š
ç”¨æˆ· â†’ è®¢å•æœåŠ¡ â†’ ç”¨æˆ·æœåŠ¡(æŸ¥ç”¨æˆ·)
             â†“
            å•†å“æœåŠ¡(æŸ¥åº“å­˜)
             â†“
            æ”¯ä»˜æœåŠ¡(æ‰£æ¬¾)
             â†“
          è¿”å›ç»“æœ(æ€»å…±3ç§’)

é—®é¢˜ï¼šå“ªä¸ªæœåŠ¡è€—æ—¶æœ€é•¿ï¼Ÿ
```

**é“¾è·¯è¿½è¸ªè§£å†³æ–¹æ¡ˆ**ï¼š

```
è¯·æ±‚æµè½¬ï¼š                      è¿½è¸ªæ•°æ®ï¼š
è®¢å•æœåŠ¡(500ms)               TraceId: abc123
   â†“                          SpanId: span-1 (500ms)
ç”¨æˆ·æœåŠ¡(200ms)                  â†“
   â†“                          SpanId: span-2 (200ms)  
å•†å“æœåŠ¡(1800ms) â† æ…¢ï¼           â†“
   â†“                          SpanId: span-3 (1800ms) â† æ‰¾åˆ°æ…¢çš„åŸå› 
æ”¯ä»˜æœåŠ¡(500ms)                  â†“
                              SpanId: span-4 (500ms)
```

### 7.2 SkyWalkingé“¾è·¯è¿½è¸ª


**ä»€ä¹ˆæ˜¯SkyWalking**ï¼šå›½äº§å¼€æºçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œæ— ä¾µå…¥æ¥å…¥

**æ¶æ„å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¢å•æœåŠ¡ â”‚  â”‚å•†å“æœåŠ¡ â”‚  â”‚æ”¯ä»˜æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ (è‡ªåŠ¨ä¸ŠæŠ¥è¿½è¸ªæ•°æ®)
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ SkyWalking   â”‚
        â”‚   OAPæœåŠ¡    â”‚ â† æ•°æ®æ”¶é›†åˆ†æ
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ SkyWalking   â”‚
        â”‚   UIæ§åˆ¶å°   â”‚ â† å¯è§†åŒ–å±•ç¤º
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¿«é€Ÿæ¥å…¥**ï¼ˆæ— éœ€æ”¹ä»£ç ï¼ï¼‰ï¼š

```bash
# 1. ä¸‹è½½SkyWalking Agent
wget https://archive.apache.org/dist/skywalking/java-agent/8.15.0/apache-skywalking-java-agent-8.15.0.tgz

# 2. è§£å‹
tar -zxvf apache-skywalking-java-agent-8.15.0.tgz

# 3. å¯åŠ¨åº”ç”¨æ—¶æ·»åŠ JVMå‚æ•°
java -javaagent:/path/to/skywalking-agent.jar \
     -Dskywalking.agent.service_name=order-service \
     -Dskywalking.collector.backend_service=127.0.0.1:11800 \
     -jar order-service.jar
```

**æŸ¥çœ‹è¿½è¸ªæ•°æ®**ï¼š

```
è®¿é—®SkyWalking UIï¼šhttp://localhost:8080
1. æ‹“æ‰‘å›¾ï¼šæŸ¥çœ‹æœåŠ¡è°ƒç”¨å…³ç³»
2. è¿½è¸ªï¼šæŸ¥çœ‹å…·ä½“è¯·æ±‚é“¾è·¯
3. æ€§èƒ½åˆ†æï¼šæ‰¾å‡ºæ…¢çš„æœåŠ¡å’ŒSQL
```

**è¿½è¸ªä¿¡æ¯ç¤ºä¾‹**ï¼š

```
TraceId: 1a2b3c4d5e6f7g8h
è¯·æ±‚è·¯å¾„: POST /orders
æ€»è€—æ—¶: 3000ms

è°ƒç”¨é“¾è·¯:
â”œâ”€ order-service (500ms)
â”‚  â””â”€ user-service::getUser (200ms)
â”‚     â””â”€ MySQLæŸ¥è¯¢ (150ms)
â”‚  
â”œâ”€ product-service::checkStock (1800ms)  â† æ…¢ï¼
â”‚  â””â”€ MySQLæŸ¥è¯¢ (1700ms)  â† æ…¢SQL
â”‚
â””â”€ payment-service::pay (500ms)
   â””â”€ RedisæŸ¥è¯¢ (50ms)
```

### 7.3 æ€§èƒ½ä¼˜åŒ–å®æˆ˜


**æ ¹æ®è¿½è¸ªæ•°æ®ä¼˜åŒ–**ï¼š

**é—®é¢˜1ï¼šå‘ç°å•†å“æœåŠ¡MySQLæŸ¥è¯¢æ…¢**
```sql
-- ä¼˜åŒ–å‰ï¼šå…¨è¡¨æ‰«æ
SELECT * FROM product WHERE name LIKE '%æ‰‹æœº%';

-- ä¼˜åŒ–åï¼šæ·»åŠ ç´¢å¼•
CREATE INDEX idx_name ON product(name);
SELECT * FROM product WHERE name LIKE 'æ‰‹æœº%';  -- å‰ç¼€åŒ¹é…
```

**é—®é¢˜2ï¼šå‘ç°å¤§é‡é‡å¤æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯**
```java
// ä¼˜åŒ–å‰ï¼šæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“
UserDTO user = userClient.getUser(userId);

// ä¼˜åŒ–åï¼šæ·»åŠ æœ¬åœ°ç¼“å­˜
@Cacheable(value = "users", key = "#userId")
public UserDTO getUser(Long userId) {
    return userClient.getUser(userId);
}
```

---

## 8. ğŸšª APIç½‘å…³é›†æˆ


### 8.1 ä»€ä¹ˆæ˜¯APIç½‘å…³


**ç”Ÿæ´»ç±»æ¯”**ï¼šAPIç½‘å…³å°±åƒé…’åº—å‰å°ï¼Œæ‰€æœ‰å®¢äººéƒ½è¦å…ˆåˆ°å‰å°ç™»è®°ï¼Œå‰å°å†åˆ†é…æˆ¿é—´

```
æ²¡æœ‰ç½‘å…³ï¼š                    æœ‰ç½‘å…³ï¼š
å®¢æˆ·ç«¯                        å®¢æˆ·ç«¯
 â”œâ†’ è®¢å•æœåŠ¡                      â†“
 â”œâ†’ ç”¨æˆ·æœåŠ¡                  APIç½‘å…³(ç»Ÿä¸€å…¥å£)
 â”œâ†’ å•†å“æœåŠ¡                   â”œâ†’ è®¢å•æœåŠ¡
 â””â†’ æ”¯ä»˜æœåŠ¡                   â”œâ†’ ç”¨æˆ·æœåŠ¡
                              â”œâ†’ å•†å“æœåŠ¡
é—®é¢˜ï¼š                         â””â†’ æ”¯ä»˜æœåŠ¡
- å®¢æˆ·ç«¯è¦çŸ¥é“Nä¸ªæœåŠ¡åœ°å€      
- è·¨åŸŸã€é‰´æƒè¦åœ¨æ¯ä¸ªæœåŠ¡åš      ä¼˜åŠ¿ï¼š
- æ¥å£ç‰ˆæœ¬ç®¡ç†æ··ä¹±              - ç»Ÿä¸€å…¥å£
                              - ç»Ÿä¸€é‰´æƒ
                              - ç»Ÿä¸€é™æµ
```

**ç½‘å…³æ ¸å¿ƒåŠŸèƒ½**ï¼š

ğŸ”¸ **è·¯ç”±è½¬å‘**ï¼šæ ¹æ®è¯·æ±‚è·¯å¾„è½¬å‘åˆ°å¯¹åº”æœåŠ¡
ğŸ”¸ **ç»Ÿä¸€é‰´æƒ**ï¼šåœ¨ç½‘å…³å±‚éªŒè¯tokenï¼ŒæœåŠ¡å±‚ä¸ç”¨ç®¡
ğŸ”¸ **é™æµç†”æ–­**ï¼šä¿æŠ¤åç«¯æœåŠ¡
ğŸ”¸ **æ—¥å¿—ç›‘æ§**ï¼šç»Ÿä¸€è®°å½•è¯·æ±‚æ—¥å¿—
ğŸ”¸ **åè®®è½¬æ¢**ï¼šHTTPè½¬gRPCç­‰

### 8.2 Spring Cloud Gatewayå®æˆ˜


**Gatewayå·¥ä½œåŸç†**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚
   â†“
1. åŒ¹é…è·¯ç”±è§„åˆ™
   â†“
2. æ‰§è¡Œè¿‡æ»¤å™¨é“¾(é‰´æƒã€é™æµç­‰)
   â†“
3. è½¬å‘åˆ°ç›®æ ‡æœåŠ¡
   â†“
4. è¿”å›å“åº”
```

**å¿«é€Ÿæ­å»º**ï¼š

```xml
<!-- 1. åˆ›å»ºGatewayé¡¹ç›®ï¼Œæ·»åŠ ä¾èµ– -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-gateway</artifactId>
</dependency>
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

```yaml
# 2. é…ç½®è·¯ç”±è§„åˆ™
spring:
  cloud:
    gateway:
      routes:
        # è®¢å•æœåŠ¡è·¯ç”±
        - id: order-route
          uri: lb://order-service  # lbè¡¨ç¤ºè´Ÿè½½å‡è¡¡ï¼Œä»Nacosè·å–å®ä¾‹
          predicates:
            - Path=/api/orders/**  # åŒ¹é…è§„åˆ™
          filters:
            - StripPrefix=1  # å»æ‰/apiå‰ç¼€
        
        # ç”¨æˆ·æœåŠ¡è·¯ç”±  
        - id: user-route
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - StripPrefix=1
            
        # å•†å“æœåŠ¡è·¯ç”±
        - id: product-route
          uri: lb://product-service
          predicates:
            - Path=/api/products/**
          filters:
            - StripPrefix=1
```

**è·¯ç”±è½¬å‘ç¤ºä¾‹**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚ï¼šGET http://gateway:9999/api/orders/123

Gatewayå¤„ç†æµç¨‹ï¼š
1. åŒ¹é…åˆ° order-route è§„åˆ™
   â†“
2. StripPrefix=1 å»æ‰ /api
   â†“
3. ä»Nacosè·å– order-service å®ä¾‹åˆ—è¡¨
   â†“
4. è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ªå®ä¾‹ï¼š192.168.1.10:8081
   â†“
5. è½¬å‘è¯·æ±‚ï¼šGET http://192.168.1.10:8081/orders/123
   â†“
6. è¿”å›å“åº”ç»™å®¢æˆ·ç«¯
```

### 8.3 ç»Ÿä¸€é‰´æƒè¿‡æ»¤å™¨


**è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨**ï¼š

```java
@Component
public class AuthFilter implements GlobalFilter, Ordered {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // 1. è·å–è¯·æ±‚è·¯å¾„
        String path = exchange.getRequest().getURI().getPath();
        
        // 2. ç™½åå•è·¯å¾„ç›´æ¥æ”¾è¡Œ
        if (path.contains("/login") || path.contains("/register")) {
            return chain.filter(exchange);
        }
        
        // 3. è·å–token
        String token = exchange.getRequest().getHeaders().getFirst("Authorization");
        
        // 4. éªŒè¯token
        if (token == null || !validateToken(token)) {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
        
        // 5. tokenæœ‰æ•ˆï¼Œç»§ç»­æ‰§è¡Œ
        return chain.filter(exchange);
    }
    
    private boolean validateToken(String token) {
        // éªŒè¯tokené€»è¾‘ï¼ˆè°ƒç”¨ç”¨æˆ·æœåŠ¡æˆ–Redisï¼‰
        return true;
    }
    
    @Override
    public int getOrder() {
        return -100;  // ä¼˜å…ˆçº§ï¼Œè¶Šå°è¶Šå…ˆæ‰§è¡Œ
    }
}
```

**è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº**ï¼š

```
è¯·æ±‚è¿›å…¥
   â†“
AuthFilter (order=-100) â† å…ˆæ‰§è¡Œé‰´æƒ
   â†“
RateLimitFilter (order=0) â† å†æ‰§è¡Œé™æµ
   â†“
LogFilter (order=100) â† æœ€åè®°å½•æ—¥å¿—
   â†“
è½¬å‘åˆ°ç›®æ ‡æœåŠ¡
```

### 8.4 Gatewayé™æµé…ç½®


**åŸºäºRedisçš„ä»¤ç‰Œæ¡¶é™æµ**ï¼š

```xml
<!-- æ·»åŠ é™æµä¾èµ– -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis-reactive</artifactId>
</dependency>
```

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: order-route
          uri: lb://order-service
          predicates:
            - Path=/api/orders/**
          filters:
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10  # æ¯ç§’è¡¥å……10ä¸ªä»¤ç‰Œ
                redis-rate-limiter.burstCapacity: 20  # æ¡¶å®¹é‡20ä¸ªä»¤ç‰Œ
                key-resolver: "#{@ipKeyResolver}"     # æŒ‰IPé™æµ
```

```java
// IPé™æµç­–ç•¥
@Bean
public KeyResolver ipKeyResolver() {
    return exchange -> {
        String ip = exchange.getRequest().getRemoteAddress()
                           .getAddress().getHostAddress();
        return Mono.just(ip);
    };
}
```

**é™æµæ•ˆæœ**ï¼š

```
æŸIP 1ç§’å†…å‘é€30ä¸ªè¯·æ±‚ï¼š
- å‰20ä¸ªè¯·æ±‚ï¼šæ­£å¸¸å¤„ç†ï¼ˆæ¶ˆè€—20ä¸ªä»¤ç‰Œï¼‰
- å10ä¸ªè¯·æ±‚ï¼šè¿”å›429 Too Many Requests

1ç§’åä»¤ç‰Œæ¡¶è¡¥å……10ä¸ªï¼š
- å¯ä»¥ç»§ç»­å¤„ç†10ä¸ªè¯·æ±‚
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”´ æœåŠ¡æ‹†åˆ†ï¼šæŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†ï¼Œä¸æ˜¯æŒ‰æŠ€æœ¯å±‚æ¬¡
ğŸ”´ æœåŠ¡é€šä¿¡ï¼šFeignå£°æ˜å¼è°ƒç”¨ï¼Œåƒæœ¬åœ°æ–¹æ³•ä¸€æ ·
ğŸ”´ é…ç½®ä¸­å¿ƒï¼šNacosç»Ÿä¸€ç®¡ç†é…ç½®ï¼Œæ”¯æŒåŠ¨æ€åˆ·æ–°
ğŸ”´ æœåŠ¡å‘ç°ï¼šé€šè¿‡æœåŠ¡åè°ƒç”¨ï¼Œä¸ç”¨å…³å¿ƒIPåœ°å€
ğŸ”´ ç†”æ–­é™çº§ï¼šSentinelä¿æŠ¤ç³»ç»Ÿï¼Œé˜²æ­¢é›ªå´©
ğŸ”´ é“¾è·¯è¿½è¸ªï¼šSkyWalkingå®šä½æ€§èƒ½ç“¶é¢ˆ
ğŸ”´ APIç½‘å…³ï¼šç»Ÿä¸€å…¥å£ï¼Œç»Ÿä¸€é‰´æƒé™æµ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¾®æœåŠ¡ä¸æ˜¯é“¶å¼¹**
- å°é¡¹ç›®ç”¨å•ä½“åº”ç”¨æ›´ç®€å•
- å¾®æœåŠ¡å¢åŠ äº†è¿ç»´å¤æ‚åº¦
- å›¢é˜Ÿè§„æ¨¡å°ä¸é€‚åˆå¾®æœåŠ¡

**ğŸ”¹ æœåŠ¡æ‹†åˆ†åŸåˆ™**
- é«˜å†…èšï¼šç›¸å…³åŠŸèƒ½æ”¾ä¸€èµ·
- ä½è€¦åˆï¼šæœåŠ¡é—´ä¾èµ–å°‘
- ç‹¬ç«‹éƒ¨ç½²ï¼šä¸å½±å“å…¶ä»–æœåŠ¡

**ğŸ”¹ åˆ†å¸ƒå¼ä¸€å®šè¦è€ƒè™‘çš„é—®é¢˜**
- æœåŠ¡è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿâ†’ ç†”æ–­é™çº§
- é…ç½®æ€ä¹ˆç»Ÿä¸€ç®¡ç†ï¼Ÿâ†’ é…ç½®ä¸­å¿ƒ
- æ€ä¹ˆçŸ¥é“æœåŠ¡åœ¨å“ªï¼Ÿâ†’ æœåŠ¡æ³¨å†Œå‘ç°
- è¯·æ±‚æ…¢æ€ä¹ˆæ’æŸ¥ï¼Ÿâ†’ é“¾è·¯è¿½è¸ª

### 9.3 å®æˆ˜åº”ç”¨æŒ‡å¯¼


**âœ… å¾®æœåŠ¡è½åœ°æ­¥éª¤**ï¼š

```
ç¬¬1æ­¥ï¼šæœåŠ¡æ‹†åˆ†
â”œâ”€ è¯†åˆ«ä¸šåŠ¡è¾¹ç•Œ
â”œâ”€ å®šä¹‰æœåŠ¡æ¥å£
â””â”€ ç‹¬ç«‹æ•°æ®åº“

ç¬¬2æ­¥ï¼šåŸºç¡€è®¾æ–½
â”œâ”€ æ­å»ºNacosï¼ˆæ³¨å†Œä¸­å¿ƒ+é…ç½®ä¸­å¿ƒï¼‰
â”œâ”€ æ­å»ºSkyWalkingï¼ˆé“¾è·¯è¿½è¸ªï¼‰
â””â”€ æ­å»ºSentinelæ§åˆ¶å°ï¼ˆæµé‡æ§åˆ¶ï¼‰

ç¬¬3æ­¥ï¼šæœåŠ¡æ”¹é€ 
â”œâ”€ æ¥å…¥NacosæœåŠ¡å‘ç°
â”œâ”€ ä½¿ç”¨Feignè°ƒç”¨
â”œâ”€ é…ç½®ç†”æ–­é™çº§
â””â”€ æ¥å…¥é“¾è·¯è¿½è¸ª

ç¬¬4æ­¥ï¼šç½‘å…³éƒ¨ç½²
â”œâ”€ æ­å»ºGateway
â”œâ”€ é…ç½®è·¯ç”±è§„åˆ™
â”œâ”€ å®ç°ç»Ÿä¸€é‰´æƒ
â””â”€ é…ç½®é™æµè§„åˆ™
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³**ï¼š

**é—®é¢˜1ï¼šæœåŠ¡è°ƒç”¨è¶…æ—¶**
```
æ’æŸ¥æ­¥éª¤ï¼š
1. çœ‹SkyWalkingé“¾è·¯è¿½è¸ªï¼Œæ‰¾åˆ°æ…¢çš„æœåŠ¡
2. æ£€æŸ¥æ˜¯å¦æ˜¯æ…¢SQL â†’ ä¼˜åŒ–SQL
3. æ£€æŸ¥æ˜¯å¦ç½‘ç»œé—®é¢˜ â†’ æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
4. è°ƒæ•´Feignè¶…æ—¶æ—¶é—´
```

**é—®é¢˜2ï¼šæœåŠ¡é›ªå´©**
```
è§£å†³æ–¹æ¡ˆï¼š
1. é…ç½®Sentinelç†”æ–­è§„åˆ™
2. è®¾ç½®åˆç†çš„é™çº§é€»è¾‘
3. é‡è¦æ¥å£è®¾ç½®é™æµ
4. éæ ¸å¿ƒåŠŸèƒ½åŠæ—¶é™çº§
```

**é—®é¢˜3ï¼šé…ç½®ç®¡ç†æ··ä¹±**
```
æœ€ä½³å®è·µï¼š
1. æŒ‰ç¯å¢ƒåˆ†å‘½åç©ºé—´ï¼ˆdevã€testã€prodï¼‰
2. å…¬å…±é…ç½®æŠ½å–åˆ°commoné…ç½®
3. æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
4. é…ç½®å˜æ›´è¦èµ°å®¡æ‰¹æµç¨‹
```

**ğŸ¯ ä¸€å¥è¯ç²¾å**ï¼š
å¾®æœåŠ¡å°±æ˜¯æŠŠä¸€ä¸ªå¤§ç³»ç»Ÿæ‹†æˆå¤šä¸ªå°ç³»ç»Ÿï¼Œæ¯ä¸ªå°ç³»ç»Ÿç‹¬ç«‹éƒ¨ç½²ã€ç‹¬ç«‹è¿è¡Œï¼Œé€šè¿‡ç½‘å…³ç»Ÿä¸€å¯¹å¤–ï¼Œé€šè¿‡æ³¨å†Œä¸­å¿ƒäº’ç›¸å‘ç°ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†ï¼Œå‡ºäº†é—®é¢˜æœ‰ç†”æ–­ä¿æŠ¤ï¼Œæ€§èƒ½é—®é¢˜æœ‰é“¾è·¯è¿½è¸ªã€‚

**ğŸ“Š å­¦ä¹ æ£€æŸ¥æ¸…å•**ï¼š

- [ ] èƒ½è¯´å‡ºå¾®æœåŠ¡å’Œå•ä½“åº”ç”¨çš„åŒºåˆ«
- [ ] èƒ½æŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†æœåŠ¡
- [ ] ä¼šç”¨Feignå®ç°æœåŠ¡è°ƒç”¨
- [ ] ä¼šé…ç½®Nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ
- [ ] ä¼šç”¨Sentinelå®ç°ç†”æ–­é™çº§
- [ ] ä¼šç”¨SkyWalkingæ’æŸ¥æ€§èƒ½é—®é¢˜
- [ ] ä¼šæ­å»ºGatewayå®ç°ç»Ÿä¸€ç½‘å…³

**ğŸ”— ç›¸å…³çŸ¥è¯†**ï¼š
- æ·±å…¥å­¦ä¹ ï¼š[Spring Cloud Alibabaå®˜æ–¹æ–‡æ¡£](https://spring-cloud-alibaba-group.github.io/github-pages/hoxton/zh-cn/index.html)
- å®æˆ˜é¡¹ç›®ï¼šæ­å»ºä¸€ä¸ªç”µå•†å¾®æœåŠ¡ç³»ç»Ÿ
- æ‹“å±•é˜…è¯»ï¼šã€Šæ·±å…¥ç†è§£Spring Cloudä¸å¾®æœåŠ¡æ„å»ºã€‹