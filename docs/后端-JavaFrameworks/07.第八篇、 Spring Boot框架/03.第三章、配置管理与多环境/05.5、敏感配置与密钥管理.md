---
title: 5ã€æ•æ„Ÿé…ç½®ä¸å¯†é’¥ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [æ•æ„Ÿé…ç½®åŸºæœ¬æ¦‚å¿µ](#1-æ•æ„Ÿé…ç½®åŸºæœ¬æ¦‚å¿µ)
2. [ç¯å¢ƒå˜é‡æ³¨å…¥æ–¹å¼](#2-ç¯å¢ƒå˜é‡æ³¨å…¥æ–¹å¼)
3. [K8s Secreté›†æˆ](#3-K8s-Secreté›†æˆ)
4. [é…ç½®æ–‡ä»¶è„±æ•æŠ€æœ¯](#4-é…ç½®æ–‡ä»¶è„±æ•æŠ€æœ¯)
5. [å¯†é’¥è½®æ¢æœºåˆ¶](#5-å¯†é’¥è½®æ¢æœºåˆ¶)
6. [æœ€å°å¯è§æ€§åŸåˆ™](#6-æœ€å°å¯è§æ€§åŸåˆ™)
7. [å®¡è®¡æ—¥å¿—è®°å½•](#7-å®¡è®¡æ—¥å¿—è®°å½•)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”’ æ•æ„Ÿé…ç½®åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿé…ç½®


**é€šä¿—ç†è§£ï¼š** æ•æ„Ÿé…ç½®å°±åƒä½ çš„é“¶è¡Œå¡å¯†ç ã€èº«ä»½è¯å·ç è¿™äº›é‡è¦ä¿¡æ¯ï¼Œåœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­ä¹Ÿæœ‰å¾ˆå¤šç±»ä¼¼çš„"ç§˜å¯†"éœ€è¦ä¿æŠ¤ã€‚

```
ç”Ÿæ´»ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼š
ğŸ¦ é“¶è¡Œå¡å¯†ç 
ğŸ”‘ å®¶é—¨é’¥åŒ™  
ğŸ“± æ‰‹æœºè§£é”ç 

å¾®æœåŠ¡ä¸­çš„æ•æ„Ÿé…ç½®ï¼š
ğŸ” æ•°æ®åº“è¿æ¥å¯†ç 
ğŸ—ï¸ APIè°ƒç”¨å¯†é’¥
ğŸ« JWTç­¾åå¯†é’¥
```

### 1.2 æ•æ„Ÿé…ç½®çš„ç‰¹ç‚¹


**ğŸ”¸ æ ¸å¿ƒç‰¹å¾ï¼š**
- **ä¿å¯†æ€§**ï¼šä¸èƒ½æ˜æ–‡å­˜å‚¨æˆ–ä¼ è¾“
- **å®Œæ•´æ€§**ï¼šä¸èƒ½è¢«ç¯¡æ”¹
- **å¯ç”¨æ€§**ï¼šéœ€è¦æ—¶èƒ½æ­£ç¡®è·å–
- **å¯è¿½æº¯æ€§**ï¼šè°ä»€ä¹ˆæ—¶å€™ç”¨äº†è¦æœ‰è®°å½•

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç‰¹æ®Šç®¡ç†ï¼Ÿ**

```
æ™®é€šé…ç½® vs æ•æ„Ÿé…ç½®ï¼š

æ™®é€šé…ç½®ï¼ˆæœåŠ¡ç«¯å£ï¼‰ï¼š
âœ… å¯ä»¥æ˜æ–‡å†™åœ¨ä»£ç é‡Œ
âœ… å¯ä»¥æäº¤åˆ°Git
âœ… å¯ä»¥éšæ„æŸ¥çœ‹

æ•æ„Ÿé…ç½®ï¼ˆæ•°æ®åº“å¯†ç ï¼‰ï¼š
âŒ ç»å¯¹ä¸èƒ½æ˜æ–‡å­˜å‚¨
âŒ ä¸èƒ½æäº¤åˆ°ä»£ç ä»“åº“  
âŒ åªæœ‰æˆæƒäººå‘˜æ‰èƒ½æŸ¥çœ‹
```

### 1.3 å¸¸è§æ•æ„Ÿé…ç½®ç±»å‹


| é…ç½®ç±»å‹ | **å…·ä½“ç¤ºä¾‹** | **é£é™©ç­‰çº§** | **å¸¸è§ç”¨é€”** |
|---------|------------|-------------|-------------|
| ğŸ” **æ•°æ®åº“è¿æ¥** | `MySQLå¯†ç ã€Rediså¯†ç ` | `ğŸ”´ é«˜` | `è¿æ¥æ•°æ®å­˜å‚¨` |
| ğŸ—ï¸ **APIå¯†é’¥** | `æ”¯ä»˜å®SecretKeyã€å¾®ä¿¡AppSecret` | `ğŸ”´ é«˜` | `ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨` |
| ğŸ« **ç­¾åå¯†é’¥** | `JWTç§é’¥ã€æ•°å­—è¯ä¹¦` | `ğŸ”´ é«˜` | `èº«ä»½éªŒè¯å’Œç­¾å` |
| ğŸŒ **æœåŠ¡å‘ç°** | `Nacoså¯†ç ã€Consul Token` | `ğŸŸ¡ ä¸­` | `æ³¨å†Œä¸­å¿ƒè®¿é—®` |
| ğŸ“§ **é€šçŸ¥æœåŠ¡** | `é‚®ç®±å¯†ç ã€çŸ­ä¿¡å¯†é’¥` | `ğŸŸ¡ ä¸­` | `æ¶ˆæ¯æ¨é€æœåŠ¡` |

---

## 2. ğŸŒ¿ ç¯å¢ƒå˜é‡æ³¨å…¥æ–¹å¼


### 2.1 ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡æ³¨å…¥


**é€šä¿—è§£é‡Šï¼š** ç¯å¢ƒå˜é‡å°±åƒç»™æ¯å°ç”µè„‘è´´çš„"ä¾¿ç­¾çº¸"ï¼Œä¸Šé¢å†™ç€é‡è¦ä¿¡æ¯ã€‚ç¨‹åºè¿è¡Œæ—¶å¯ä»¥è¯»å–è¿™äº›ä¾¿ç­¾ä¸Šçš„å†…å®¹ï¼Œè€Œä¸éœ€è¦æŠŠç§˜å¯†ç›´æ¥å†™åœ¨ä»£ç é‡Œã€‚

```
ç°å®ç±»æ¯”ï¼š
ä»£ç  = èœè°±ï¼ˆå…¬å¼€çš„ï¼‰
ç¯å¢ƒå˜é‡ = è°ƒæ–™ç›’ï¼ˆç§äººçš„ï¼‰

åšèœæ—¶ï¼š
1. èœè°±å‘Šè¯‰ä½ æ”¾ä»€ä¹ˆè°ƒæ–™
2. ä½†å…·ä½“çš„è°ƒæ–™ä»ä½ è‡ªå·±çš„è°ƒæ–™ç›’é‡Œå–
3. æ¯ä¸ªäººçš„è°ƒæ–™ç›’å†…å®¹å¯èƒ½ä¸åŒ
```

### 2.2 Spring Bootä¸­çš„ç¯å¢ƒå˜é‡ä½¿ç”¨


**ğŸ”§ åŸºæœ¬é…ç½®æ–¹å¼ï¼š**

```properties
# application.yml - åªå†™å ä½ç¬¦ï¼Œä¸å†™çœŸå®å€¼
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/${DB_NAME:myapp}
    username: ${DB_USER:root}
    password: ${DB_PASSWORD}  # å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡æä¾›
    
  redis:
    host: ${REDIS_HOST:localhost}
    password: ${REDIS_PASSWORD}
```

**ğŸ’¡ é…ç½®è¯´æ˜ï¼š**
- `${DB_PASSWORD}`ï¼šå¿…é¡»ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œæ²¡æœ‰é»˜è®¤å€¼
- `${DB_NAME:myapp}`ï¼šä¼˜å…ˆè¯»ç¯å¢ƒå˜é‡ï¼Œæ²¡æœ‰åˆ™ç”¨é»˜è®¤å€¼`myapp`
- å†’å·åé¢æ˜¯é»˜è®¤å€¼ï¼Œé€‚åˆéæ•æ„Ÿé…ç½®

### 2.3 ç¯å¢ƒå˜é‡è®¾ç½®æ–¹æ³•


**ğŸ§ Linux/Mac ç³»ç»Ÿï¼š**

```bash
# æ–¹å¼1ï¼šä¸´æ—¶è®¾ç½®ï¼ˆé‡å¯å¤±æ•ˆï¼‰
export DB_PASSWORD="your_secret_password"
export REDIS_PASSWORD="redis_secret"

# æ–¹å¼2ï¼šå¯åŠ¨æ—¶è®¾ç½®
DB_PASSWORD="secret123" java -jar myapp.jar

# æ–¹å¼3ï¼šå†™å…¥å¯åŠ¨è„šæœ¬
#!/bin/bash
export DB_PASSWORD="your_secret"
export REDIS_PASSWORD="redis_secret"
java -jar myapp.jar
```

**ğŸªŸ Windows ç³»ç»Ÿï¼š**

```cmd
# ä¸´æ—¶è®¾ç½®
set DB_PASSWORD=your_secret_password
set REDIS_PASSWORD=redis_secret
java -jar myapp.jar

# æˆ–è€…ä¸€è¡Œè®¾ç½®
set DB_PASSWORD=secret123 && java -jar myapp.jar
```

### 2.4 Dockerå®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡


**ğŸ³ Dockerè¿è¡Œæ—¶æ³¨å…¥ï¼š**

```bash
# å‘½ä»¤è¡Œç›´æ¥ä¼ å…¥
docker run -e DB_PASSWORD="secret123" \
           -e REDIS_PASSWORD="redis_secret" \
           myapp:latest

# ä½¿ç”¨ç¯å¢ƒæ–‡ä»¶
echo "DB_PASSWORD=secret123" > .env
echo "REDIS_PASSWORD=redis_secret" >> .env
docker run --env-file .env myapp:latest
```

**ğŸ“‹ Docker Compose é…ç½®ï¼š**

```yaml
version: '3.8'
services:
  myapp:
    image: myapp:latest
    environment:
      - DB_PASSWORD=${DB_PASSWORD}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    # æˆ–è€…ä½¿ç”¨ç¯å¢ƒæ–‡ä»¶
    env_file:
      - .env
```

---

## 3. â˜¸ï¸ K8s Secreté›†æˆ


### 3.1 ä»€ä¹ˆæ˜¯K8s Secret


**é€šä¿—ç†è§£ï¼š** K8s Secretå°±åƒé“¶è¡Œçš„ä¿é™©ç®±ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨é‡è¦çš„ç§˜å¯†ä¿¡æ¯ã€‚å®ƒæ¯”æ™®é€šçš„ConfigMapæ›´å®‰å…¨ï¼Œæœ‰åŠ å¯†ä¿æŠ¤ã€‚

```
ConfigMap vs Secretï¼š

ConfigMapï¼ˆæ™®é€šé…ç½®ï¼‰:
ğŸ“„ å­˜å‚¨æ™®é€šé…ç½®ä¿¡æ¯
ğŸ‘€ ä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹
ğŸ’¾ æ˜æ–‡å­˜å‚¨

Secretï¼ˆæ•æ„Ÿé…ç½®ï¼‰ï¼š
ğŸ” å­˜å‚¨æ•æ„Ÿä¿¡æ¯
ğŸ”’ éœ€è¦æƒé™æ‰èƒ½æŸ¥çœ‹  
ğŸ›¡ï¸ Base64ç¼–ç å­˜å‚¨
```

### 3.2 åˆ›å»ºSecretçš„å‡ ç§æ–¹å¼


**ğŸ”§ æ–¹å¼1ï¼šå‘½ä»¤è¡Œåˆ›å»º**

```bash
# åˆ›å»ºé€šç”¨Secret
kubectl create secret generic myapp-secret \
  --from-literal=db-password="secret123" \
  --from-literal=redis-password="redis_secret"

# ä»æ–‡ä»¶åˆ›å»º
echo -n "secret123" > db-password.txt
kubectl create secret generic myapp-secret \
  --from-file=db-password=db-password.txt
```

**ğŸ“ æ–¹å¼2ï¼šYAMLæ–‡ä»¶åˆ›å»º**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: myapp-secret
  namespace: default
type: Opaque
data:
  # æ³¨æ„ï¼šè¿™é‡Œçš„å€¼å¿…é¡»æ˜¯base64ç¼–ç åçš„
  db-password: c2VjcmV0MTIz        # secret123çš„base64ç¼–ç 
  redis-password: cmVkaXNfc2VjcmV0  # redis_secretçš„base64ç¼–ç 
```

**ğŸ’¡ Base64ç¼–ç è½¬æ¢ï¼š**

```bash
# ç¼–ç 
echo -n "secret123" | base64
# è¾“å‡ºï¼šc2VjcmV0MTIz

# è§£ç 
echo "c2VjcmV0MTIz" | base64 -d
# è¾“å‡ºï¼šsecret123
```

### 3.3 åœ¨Podä¸­ä½¿ç”¨Secret


**ğŸ”¸ æ–¹å¼1ï¼šä½œä¸ºç¯å¢ƒå˜é‡**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:latest
        env:
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: myapp-secret
              key: db-password
        - name: REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: myapp-secret
              key: redis-password
```

**ğŸ”¸ æ–¹å¼2ï¼šæŒ‚è½½ä¸ºæ–‡ä»¶**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:latest
        volumeMounts:
        - name: secret-volume
          mountPath: /etc/secrets
          readOnly: true
      volumes:
      - name: secret-volume
        secret:
          secretName: myapp-secret
```

æŒ‚è½½ååœ¨å®¹å™¨å†…ï¼š
```bash
/etc/secrets/
â”œâ”€â”€ db-password      # æ–‡ä»¶å†…å®¹ï¼šsecret123
â””â”€â”€ redis-password   # æ–‡ä»¶å†…å®¹ï¼šredis_secret
```

---

## 4. ğŸ­ é…ç½®æ–‡ä»¶è„±æ•æŠ€æœ¯


### 4.1 ä»€ä¹ˆæ˜¯é…ç½®æ–‡ä»¶è„±æ•


**é€šä¿—ç†è§£ï¼š** è„±æ•å°±åƒç»™æ•æ„Ÿä¿¡æ¯æ‰“é©¬èµ›å…‹ï¼Œè®©ä¸åº”è¯¥çœ‹åˆ°çš„äººçœ‹ä¸åˆ°çœŸå®å†…å®¹ï¼Œä½†ç³»ç»Ÿè¿è¡Œæ—¶åˆèƒ½æ­£ç¡®ä½¿ç”¨ã€‚

```
è„±æ•å‰åå¯¹æ¯”ï¼š

è„±æ•å‰ï¼ˆå±é™©ï¼‰ï¼š
datasource.password=MySecret123!

è„±æ•åï¼ˆå®‰å…¨ï¼‰ï¼š
datasource.password=${DB_PASSWORD}
# æˆ–
datasource.password=ENC(encrypted_content)
```

### 4.2 å ä½ç¬¦æ›¿æ¢æ–¹å¼


**ğŸ”§ åŸºæœ¬å ä½ç¬¦æ¨¡å¼ï¼š**

```properties
# application-template.propertiesï¼ˆæ¨¡æ¿æ–‡ä»¶ï¼‰
spring.datasource.url=jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}

spring.redis.host=${REDIS_HOST}
spring.redis.port=${REDIS_PORT}
spring.redis.password=${REDIS_PASSWORD}

# JWTé…ç½®
app.jwt.secret=${JWT_SECRET}
app.jwt.expiration=${JWT_EXPIRATION:3600}
```

**ğŸ’¡ éƒ¨ç½²æ—¶åŠ¨æ€æ›¿æ¢ï¼š**

```bash
#!/bin/bash
# éƒ¨ç½²è„šæœ¬ç¤ºä¾‹
envsubst < application-template.properties > application.properties

# æˆ–ä½¿ç”¨sedå‘½ä»¤æ›¿æ¢
sed -e "s/\${DB_PASSWORD}/$DB_PASSWORD/g" \
    -e "s/\${REDIS_PASSWORD}/$REDIS_PASSWORD/g" \
    application-template.properties > application.properties
```

### 4.3 åŠ å¯†é…ç½®æ–¹å¼


**ğŸ” ä½¿ç”¨JasyptåŠ å¯†æ•æ„Ÿé…ç½®ï¼š**

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.4</version>
</dependency>
```

**ğŸ”§ é…ç½®æ–‡ä»¶è®¾ç½®ï¼š**

```properties
# application.properties
# åŠ å¯†åçš„é…ç½®
spring.datasource.password=ENC(VTHHqJz7X6s+58vljd6XPQ==)
spring.redis.password=ENC(K2PjM8fX9YbH3nJ6dSsVrA==)

# åŠ å¯†å¯†é’¥ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡æä¾›ï¼‰
jasypt.encryptor.password=${JASYPT_PASSWORD}
```

**ğŸ”‘ ç”ŸæˆåŠ å¯†å†…å®¹ï¼š**

```java
@Test
public void generateEncryptedPassword() {
    StandardPBEStringEncryptor encryptor = new StandardPBEStringEncryptor();
    encryptor.setPassword("my_master_password"); // ä¸»å¯†é’¥
    
    String encrypted = encryptor.encrypt("actual_db_password");
    System.out.println("Encrypted: " + encrypted);
}
```

---

## 5. ğŸ”„ å¯†é’¥è½®æ¢æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯å¯†é’¥è½®æ¢


**é€šä¿—ç†è§£ï¼š** å¯†é’¥è½®æ¢å°±åƒå®šæœŸæ¢é—¨é”ï¼Œå³ä½¿æœ‰äººå·äº†æ—§é’¥åŒ™ï¼Œä¹Ÿæ‰“ä¸å¼€æ–°æ¢çš„é”ã€‚è¿™æ ·å¯ä»¥é™ä½é•¿æœŸä½¿ç”¨åŒä¸€å¯†é’¥çš„é£é™©ã€‚

```
è½®æ¢ç­–ç•¥ç±»æ¯”ï¼š

é“¶è¡Œå¡å¯†ç ï¼š
ğŸ—“ï¸ æ¯3ä¸ªæœˆæ›´æ¢ä¸€æ¬¡
ğŸ”„ æ—§å¯†ç ç«‹å³å¤±æ•ˆ
ğŸ†• æ–°å¯†ç ç«‹å³ç”Ÿæ•ˆ

ç³»ç»Ÿå¯†é’¥è½®æ¢ï¼š
ğŸ“… å®šæœŸæ›´æ¢ï¼ˆå¦‚æ¯æœˆä¸€æ¬¡ï¼‰
â° æ–°æ—§å¯†é’¥å¹¶å­˜ä¸€æ®µæ—¶é—´
ğŸ”„ é€æ­¥åˆ‡æ¢åˆ°æ–°å¯†é’¥
```

### 5.2 è½®æ¢ç­–ç•¥è®¾è®¡


**ğŸ¯ è½®æ¢å‘¨æœŸè§„åˆ’ï¼š**

| å¯†é’¥ç±»å‹ | **è½®æ¢é¢‘ç‡** | **é£é™©ç­‰çº§** | **è½®æ¢æ–¹å¼** |
|---------|------------|-------------|-------------|
| ğŸ” **æ•°æ®åº“å¯†ç ** | `æ¯å­£åº¦` | `ğŸ”´ é«˜` | `è“ç»¿éƒ¨ç½²` |
| ğŸ—ï¸ **JWTç­¾åå¯†é’¥** | `æ¯æœˆ` | `ğŸ”´ é«˜` | `å¤šå¯†é’¥å¹¶å­˜` |
| ğŸ« **APIå¯†é’¥** | `æ¯å‘¨` | `ğŸŸ¡ ä¸­` | `æ¸è¿›å¼åˆ‡æ¢` |
| ğŸ“§ **é€šçŸ¥æœåŠ¡å¯†é’¥** | `æ¯æœˆ` | `ğŸŸ¡ ä¸­` | `å³æ—¶åˆ‡æ¢` |

**ğŸ”„ è½®æ¢æµç¨‹è®¾è®¡ï¼š**

```
å¯†é’¥è½®æ¢å®Œæ•´æµç¨‹ï¼š

Phase 1: å‡†å¤‡é˜¶æ®µ
â”œâ”€â”€ ç”Ÿæˆæ–°å¯†é’¥
â”œâ”€â”€ éªŒè¯æ–°å¯†é’¥æœ‰æ•ˆæ€§
â””â”€â”€ åœ¨å¯†é’¥ç®¡ç†ç³»ç»Ÿä¸­å‡†å¤‡

Phase 2: éƒ¨ç½²é˜¶æ®µ  
â”œâ”€â”€ æ–°å¯†é’¥æ¨é€åˆ°å„ç¯å¢ƒ
â”œâ”€â”€ åº”ç”¨é‡å¯æˆ–çƒ­æ›´æ–°
â””â”€â”€ éªŒè¯æ–°å¯†é’¥å·¥ä½œæ­£å¸¸

Phase 3: æ¸…ç†é˜¶æ®µ
â”œâ”€â”€ è§‚å¯ŸæœŸï¼ˆæ–°æ—§å¹¶å­˜ï¼‰
â”œâ”€â”€ åœç”¨æ—§å¯†é’¥
â””â”€â”€ ä»ç³»ç»Ÿä¸­ç§»é™¤æ—§å¯†é’¥
```

### 5.3 è‡ªåŠ¨åŒ–è½®æ¢å®ç°


**ğŸ¤– åŸºäºCronçš„è‡ªåŠ¨è½®æ¢ï¼š**

```bash
#!/bin/bash
# rotate-secrets.sh - å¯†é’¥è½®æ¢è„šæœ¬

# 1. ç”Ÿæˆæ–°å¯†é’¥
NEW_DB_PASSWORD=$(openssl rand -base64 32)
NEW_JWT_SECRET=$(openssl rand -hex 64)

# 2. æ›´æ–°K8s Secret
kubectl patch secret myapp-secret -p="{\"data\":{\"db-password\":\"$(echo -n $NEW_DB_PASSWORD | base64)\"}}"

# 3. è§¦å‘åº”ç”¨é‡å¯
kubectl rollout restart deployment/myapp

# 4. è®°å½•è½®æ¢æ—¥å¿—
echo "$(date): Rotated secrets for myapp" >> /var/log/secret-rotation.log
```

**ğŸ“… è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š**

```bash
# crontab -e
# æ¯æœˆ1å·å‡Œæ™¨2ç‚¹æ‰§è¡Œå¯†é’¥è½®æ¢
0 2 1 * * /scripts/rotate-secrets.sh
```

---

## 6. ğŸ‘ï¸ æœ€å°å¯è§æ€§åŸåˆ™


### 6.1 ä»€ä¹ˆæ˜¯æœ€å°å¯è§æ€§åŸåˆ™


**é€šä¿—ç†è§£ï¼š** æœ€å°å¯è§æ€§å°±åƒ"çŸ¥å¯†è€…å°‘"çš„åŸåˆ™ï¼Œåªæœ‰çœŸæ­£éœ€è¦çŸ¥é“ç§˜å¯†çš„äººæ‰èƒ½çœ‹åˆ°ï¼Œå…¶ä»–äººéƒ½çœ‹ä¸åˆ°ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š

å®¶åº­ä¿é™©ç®±å¯†ç ï¼š
ğŸ‘¨ çˆ¸çˆ¸çŸ¥é“ï¼ˆéœ€è¦å­˜å–é‡è¦æ–‡ä»¶ï¼‰
ğŸ‘© å¦ˆå¦ˆçŸ¥é“ï¼ˆéœ€è¦å­˜å–é‡è¦æ–‡ä»¶ï¼‰  
ğŸ‘¶ å°å­©ä¸çŸ¥é“ï¼ˆä¸éœ€è¦æ¥è§¦ï¼‰
ğŸ  ä¿å§†ä¸çŸ¥é“ï¼ˆä¸éœ€è¦æ¥è§¦ï¼‰

ç³»ç»Ÿæ•æ„Ÿé…ç½®ï¼š
ğŸ‘¨â€ğŸ’» è¿ç»´äººå‘˜ï¼ˆéœ€è¦éƒ¨ç½²é…ç½®ï¼‰
ğŸ”§ ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆéœ€è¦æ•…éšœæ’æŸ¥ï¼‰
ğŸ‘¨â€ğŸ’¼ æ™®é€šå¼€å‘äººå‘˜ï¼ˆä¸éœ€è¦çŸ¥é“ç”Ÿäº§ç¯å¢ƒå¯†é’¥ï¼‰
ğŸ“Š ä¸šåŠ¡äººå‘˜ï¼ˆä¸éœ€è¦æ¥è§¦æŠ€æœ¯é…ç½®ï¼‰
```

### 6.2 æƒé™åˆ†å±‚ç®¡ç†


**ğŸ—ï¸ æƒé™å±‚çº§è®¾è®¡ï¼š**

```
æƒé™é‡‘å­—å¡”ç»“æ„ï¼š

Level 1: è¶…çº§ç®¡ç†å‘˜
â”œâ”€â”€ å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒçš„æ‰€æœ‰å¯†é’¥
â”œâ”€â”€ å¯ä»¥è½®æ¢å¯†é’¥
â””â”€â”€ äººæ•°ï¼š1-2äºº

Level 2: ç¯å¢ƒç®¡ç†å‘˜  
â”œâ”€â”€ åªèƒ½æŸ¥çœ‹æŒ‡å®šç¯å¢ƒçš„å¯†é’¥
â”œâ”€â”€ å¯ä»¥æ›´æ–°æŒ‡å®šç¯å¢ƒé…ç½®
â””â”€â”€ äººæ•°ï¼šæ¯ç¯å¢ƒ2-3äºº

Level 3: åº”ç”¨å¼€å‘è€…
â”œâ”€â”€ åªèƒ½æŸ¥çœ‹å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ ä¸èƒ½æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒå¯†é’¥
â””â”€â”€ äººæ•°ï¼šå¼€å‘å›¢é˜Ÿå…¨ä½“

Level 4: æ™®é€šç”¨æˆ·
â”œâ”€â”€ åªèƒ½ä½¿ç”¨åº”ç”¨åŠŸèƒ½
â”œâ”€â”€ å®Œå…¨ä¸æ¥è§¦é…ç½®
â””â”€â”€ äººæ•°ï¼šä¸šåŠ¡ç”¨æˆ·
```

### 6.3 æŠ€æœ¯å®ç°æ–¹å¼


**ğŸ” åŸºäºRBACçš„æƒé™æ§åˆ¶ï¼š**

```yaml
# K8s RBAC é…ç½®ç¤ºä¾‹
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: secret-reader
  namespace: production
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames: ["myapp-secret"]
  verbs: ["get", "list"]

---
apiVersion: rbac.authorization.k8s.io/v1  
kind: RoleBinding
metadata:
  name: secret-reader-binding
  namespace: production
subjects:
- kind: User
  name: ops-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: secret-reader
  apiGroup: rbac.authorization.k8s.io
```

**ğŸ­ é…ç½®é®ç½©æ˜¾ç¤ºï¼š**

```java
@RestController
public class ConfigController {
    
    @Value("${spring.datasource.password}")
    private String dbPassword;
    
    @GetMapping("/config")
    public Map<String, Object> getConfig() {
        Map<String, Object> config = new HashMap<>();
        
        // æ•æ„Ÿä¿¡æ¯é®ç½©æ˜¾ç¤º
        config.put("dbPassword", maskSensitive(dbPassword));
        return config;
    }
    
    private String maskSensitive(String value) {
        if (value == null || value.length() <= 4) {
            return "****";
        }
        // åªæ˜¾ç¤ºå‰2ä½å’Œå2ä½
        return value.substring(0, 2) + "****" + 
               value.substring(value.length() - 2);
    }
}
```

---

## 7. ğŸ“‹ å®¡è®¡æ—¥å¿—è®°å½•


### 7.1 ä»€ä¹ˆæ˜¯å®¡è®¡æ—¥å¿—


**é€šä¿—ç†è§£ï¼š** å®¡è®¡æ—¥å¿—å°±åƒé“¶è¡Œçš„ç›‘æ§å½•åƒï¼Œè®°å½•è°ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆæ“ä½œï¼Œå‡ºé—®é¢˜æ—¶å¯ä»¥æŸ¥çœ‹"ç›‘æ§å½•åƒ"æ‰¾åˆ°åŸå› ã€‚

```
é“¶è¡Œå®‰å…¨ç±»æ¯”ï¼š

é“¶è¡Œç›‘æ§ç³»ç»Ÿï¼š
ğŸ“¹ è°è¿›äº†é‡‘åº“ï¼ˆç”¨æˆ·èº«ä»½ï¼‰
â° ä»€ä¹ˆæ—¶å€™è¿›çš„ï¼ˆæ“ä½œæ—¶é—´ï¼‰
ğŸ”‘ ç”¨äº†å“ªæŠŠé’¥åŒ™ï¼ˆè®¿é—®çš„èµ„æºï¼‰
ğŸ“¦ åŠ¨äº†å“ªä¸ªä¿é™©ç®±ï¼ˆå…·ä½“æ“ä½œï¼‰

ç³»ç»Ÿå®¡è®¡æ—¥å¿—ï¼š
ğŸ‘¤ å“ªä¸ªç”¨æˆ·ï¼ˆç”¨æˆ·IDï¼‰
â° ä»€ä¹ˆæ—¶é—´ï¼ˆæ—¶é—´æˆ³ï¼‰  
ğŸ” è®¿é—®äº†å“ªä¸ªå¯†é’¥ï¼ˆèµ„æºåç§°ï¼‰
ğŸ”„ æ‰§è¡Œäº†ä»€ä¹ˆæ“ä½œï¼ˆè¯»å–/æ›´æ–°/åˆ é™¤ï¼‰
```

### 7.2 å®¡è®¡äº‹ä»¶åˆ†ç±»


**ğŸ“Š éœ€è¦è®°å½•çš„äº‹ä»¶ç±»å‹ï¼š**

| äº‹ä»¶ç±»å‹ | **è®°å½•å†…å®¹** | **é‡è¦ç¨‹åº¦** | **ä¿ç•™æ—¶é—´** |
|---------|------------|-------------|-------------|
| ğŸ” **å¯†é’¥è®¿é—®** | `ç”¨æˆ·IDã€æ—¶é—´ã€å¯†é’¥å` | `ğŸ”´ é«˜` | `1å¹´` |
| âœï¸ **é…ç½®å˜æ›´** | `å˜æ›´å‰åå€¼ã€æ“ä½œäºº` | `ğŸ”´ é«˜` | `1å¹´` |
| ğŸ”„ **å¯†é’¥è½®æ¢** | `è½®æ¢æ—¶é—´ã€æ–°æ—§å¯†é’¥ID` | `ğŸŸ¡ ä¸­` | `6ä¸ªæœˆ` |
| âŒ **è®¿é—®å¤±è´¥** | `å¤±è´¥åŸå› ã€ç”¨æˆ·IP` | `ğŸŸ¡ ä¸­` | `3ä¸ªæœˆ` |
| ğŸ‘€ **é…ç½®æŸ¥çœ‹** | `æŸ¥çœ‹çš„é…ç½®é¡¹ã€ç”¨æˆ·` | `ğŸŸ¢ ä½` | `1ä¸ªæœˆ` |

### 7.3 å®¡è®¡æ—¥å¿—å®ç°


**ğŸ“ Spring Boot å®¡è®¡é…ç½®ï¼š**

```java
@Component
@Slf4j
public class ConfigAuditLogger {
    
    @EventListener
    public void handleConfigAccess(ConfigAccessEvent event) {
        AuditLog auditLog = AuditLog.builder()
            .userId(event.getUserId())
            .action("CONFIG_ACCESS")
            .resource(event.getConfigName())
            .timestamp(LocalDateTime.now())
            .ip(event.getClientIp())
            .success(event.isSuccess())
            .build();
            
        log.info("AUDIT: {}", auditLog.toJson());
        
        // å¯ä»¥å‘é€åˆ°ä¸“é—¨çš„å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
        auditLogService.save(auditLog);
    }
}
```

**ğŸ”§ K8så®¡è®¡ç­–ç•¥é…ç½®ï¼š**

```yaml
# audit-policy.yaml
apiVersion: audit.k8s.io/v1
kind: Policy
rules:
- level: Metadata
  resources:
  - group: ""
    resources: ["secrets"]
  namespaces: ["production", "staging"]
  
- level: Request  
  resources:
  - group: ""
    resources: ["secrets"]
  verbs: ["create", "update", "patch", "delete"]
```

**ğŸ“Š å®¡è®¡æ—¥å¿—åˆ†æç¤ºä¾‹ï¼š**

```bash
# æŸ¥çœ‹æœ€è¿‘24å°æ—¶çš„å¯†é’¥è®¿é—®è®°å½•
kubectl logs audit-webhook | grep "secrets" | \
  jq 'select(.timestamp > "'$(date -d '24 hours ago' -Iseconds)'")' | \
  jq '{user: .user.username, verb: .verb, resource: .objectRef.name}'

# ç»Ÿè®¡å„ç”¨æˆ·çš„è®¿é—®é¢‘æ¬¡
kubectl logs audit-webhook | grep "secrets" | \
  jq -r '.user.username' | sort | uniq -c | sort -nr
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•æ„Ÿé…ç½®ï¼šæ•°æ®åº“å¯†ç ã€APIå¯†é’¥ç­‰éœ€è¦ä¿æŠ¤çš„é…ç½®ä¿¡æ¯
ğŸ”¸ ç¯å¢ƒå˜é‡æ³¨å…¥ï¼šé€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡ä¼ é€’æ•æ„Ÿä¿¡æ¯ï¼Œé¿å…ç¡¬ç¼–ç 
ğŸ”¸ K8s Secretï¼šKubernetesä¸“é—¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯çš„èµ„æºå¯¹è±¡
ğŸ”¸ é…ç½®è„±æ•ï¼šå°†æ•æ„Ÿä¿¡æ¯ä»é…ç½®æ–‡ä»¶ä¸­ç§»é™¤æˆ–åŠ å¯†å­˜å‚¨
ğŸ”¸ å¯†é’¥è½®æ¢ï¼šå®šæœŸæ›´æ¢å¯†é’¥ä»¥é™ä½å®‰å…¨é£é™©
ğŸ”¸ æœ€å°å¯è§æ€§ï¼šåªç»™çœŸæ­£éœ€è¦çš„äººå¼€æ”¾è®¿é—®æƒé™
ğŸ”¸ å®¡è®¡æ—¥å¿—ï¼šè®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œä»¥ä¾¿äº‹åè¿½æº¯
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦æ•æ„Ÿé…ç½®ç®¡ç†**
```
å®‰å…¨é£é™©ï¼š
- æ˜æ–‡å­˜å‚¨å®¹æ˜“æ³„éœ²
- ä»£ç ä»“åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯ä¼šè¢«æ‰€æœ‰å¼€å‘è€…çœ‹åˆ°
- æ—¥å¿—æ–‡ä»¶å¯èƒ½æ„å¤–è®°å½•æ•æ„Ÿä¿¡æ¯
- é…ç½®æ–‡ä»¶æƒé™æ§åˆ¶ä¸å½“

è§£å†³æ–¹æ¡ˆï¼š
- ç¯å¢ƒå˜é‡æ³¨å…¥å®ç°é…ç½®ä¸ä»£ç åˆ†ç¦»
- åŠ å¯†å­˜å‚¨ä¿æŠ¤é™æ€æ•°æ®å®‰å…¨
- æƒé™æ§åˆ¶é™åˆ¶è®¿é—®èŒƒå›´  
- å®¡è®¡æ—¥å¿—å®ç°æ“ä½œè¿½è¸ª
```

**ğŸ”¹ ç¯å¢ƒå˜é‡ vs é…ç½®æ–‡ä»¶çš„é€‰æ‹©**
```
ä½¿ç”¨ç¯å¢ƒå˜é‡çš„åœºæ™¯ï¼š
âœ… æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€å¯†é’¥ï¼‰
âœ… ç¯å¢ƒç›¸å…³é…ç½®ï¼ˆæ•°æ®åº“åœ°å€ï¼‰
âœ… è¿è¡Œæ—¶åŠ¨æ€é…ç½®

ä½¿ç”¨é…ç½®æ–‡ä»¶çš„åœºæ™¯ï¼š
âœ… ä¸šåŠ¡é€»è¾‘é…ç½®
âœ… å¤æ‚çš„åµŒå¥—é…ç½®
âœ… å¼€å‘æ—¶éœ€è¦é¢‘ç¹ä¿®æ”¹çš„é…ç½®
```

**ğŸ”¹ K8s Secretçš„ä¼˜åŠ¿**
```
ç›¸æ¯”ç¯å¢ƒå˜é‡çš„ä¼˜åŠ¿ï¼š
- é›†ä¸­ç®¡ç†ï¼šæ‰€æœ‰å¯†é’¥ç»Ÿä¸€å­˜å‚¨
- æƒé™æ§åˆ¶ï¼šåŸºäºRBACç²¾ç¡®æ§åˆ¶è®¿é—®
- ç‰ˆæœ¬ç®¡ç†ï¼šæ”¯æŒå¯†é’¥çš„ç‰ˆæœ¬ç®¡ç†å’Œå›æ»š
- è‡ªåŠ¨æ›´æ–°ï¼šæ”¯æŒçƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯Pod

ç›¸æ¯”é…ç½®æ–‡ä»¶çš„ä¼˜åŠ¿ï¼š
- å®‰å…¨æ€§ï¼šBase64ç¼–ç å­˜å‚¨ï¼Œæ”¯æŒåŠ å¯†
- åŠ¨æ€æ€§ï¼šå¯ä»¥åŠ¨æ€æŒ‚è½½å’Œæ›´æ–°
- æ ‡å‡†åŒ–ï¼šK8såŸç”Ÿæ”¯æŒï¼Œç”Ÿæ€å®Œå–„
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¼ä¸šçº§åº”ç”¨åœºæ™¯**
- **é‡‘èç³»ç»Ÿ**ï¼šä¸¥æ ¼çš„å¯†é’¥ç®¡ç†å’Œå®¡è®¡è¦æ±‚
- **ç”µå•†å¹³å°**ï¼šç¬¬ä¸‰æ–¹æ”¯ä»˜å¯†é’¥çš„å®‰å…¨ç®¡ç†  
- **SaaSæœåŠ¡**ï¼šå¤šç§Ÿæˆ·ç¯å¢ƒçš„é…ç½®éš”ç¦»
- **ç‰©è”ç½‘å¹³å°**ï¼šè®¾å¤‡è®¤è¯å¯†é’¥çš„æ‰¹é‡ç®¡ç†

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šé…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œæ”¯æŒCI/CD
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šåŒä¸€å¥—ä»£ç é€‚é…å¤šç¯å¢ƒ
- **å®‰å…¨åˆè§„**ï¼šæ»¡è¶³å®‰å…¨å®¡è®¡å’Œåˆè§„è¦æ±‚
- **æ•…éšœæ’æŸ¥**ï¼šé€šè¿‡å®¡è®¡æ—¥å¿—å¿«é€Ÿå®šä½é—®é¢˜

**ğŸ’¡ å¼€å‘æ•ˆç‡æå‡**
- **æœ¬åœ°å¼€å‘**ï¼šä½¿ç”¨æ¨¡æ‹Ÿé…ç½®ï¼Œä¸éœ€è¦çœŸå®å¯†é’¥
- **æµ‹è¯•ç¯å¢ƒ**ï¼šç‹¬ç«‹çš„æµ‹è¯•é…ç½®ï¼Œä¸å½±å“ç”Ÿäº§
- **å›¢é˜Ÿåä½œ**ï¼šæ•æ„Ÿä¿¡æ¯ä¸è¿›ä»£ç åº“ï¼Œé¿å…æ³„éœ²é£é™©

### 8.4 æœ€ä½³å®è·µå»ºè®®


```
é…ç½®ç®¡ç†æœ€ä½³å®è·µï¼š

ğŸ”¸ åˆ†å±‚ç®¡ç†ï¼š
- å…¬å…±é…ç½®ä½¿ç”¨ConfigMap
- æ•æ„Ÿé…ç½®ä½¿ç”¨Secret  
- ç¯å¢ƒç‰¹æœ‰é…ç½®é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥

ğŸ”¸ æƒé™æ§åˆ¶ï¼š
- ç”Ÿäº§ç¯å¢ƒå¯†é’¥åªæœ‰è¿ç»´äººå‘˜å¯è§
- å¼€å‘äººå‘˜åªèƒ½è®¿é—®å¼€å‘ç¯å¢ƒé…ç½®
- ä½¿ç”¨ä¸åŒçš„Service Accountéš”ç¦»æƒé™

ğŸ”¸ å®‰å…¨ç­–ç•¥ï¼š
- å®šæœŸè½®æ¢å¯†é’¥ï¼ˆå»ºè®®æ¯æœˆä¸€æ¬¡ï¼‰
- ä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆå™¨ç”Ÿæˆå¯†é’¥
- å¯ç”¨å®¡è®¡æ—¥å¿—è®°å½•æ‰€æœ‰æ“ä½œ

ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼š
- ç›‘æ§å¼‚å¸¸çš„é…ç½®è®¿é—®è¡Œä¸º
- å¯†é’¥å³å°†è¿‡æœŸæ—¶æå‰å‘Šè­¦
- é…ç½®å˜æ›´ååŠæ—¶é€šçŸ¥ç›¸å…³äººå‘˜
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ•æ„Ÿé…ç½®ä¸ç¡¬ç¼–ï¼Œç¯å¢ƒå˜é‡æ¥ä¼ é€’
- SecretåŠ å¯†åˆå®‰å…¨ï¼Œæƒé™æ§åˆ¶å¾ˆå…³é”®
- å®šæœŸè½®æ¢é™é£é™©ï¼Œå®¡è®¡æ—¥å¿—è¦è®°å…¨
- æœ€å°å¯è§ä¿å®‰å…¨ï¼Œåˆ†å±‚ç®¡ç†æ˜¯å…³é”®