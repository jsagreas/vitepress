---
title: 2ã€Healthæ£€æŸ¥ä¸è‡ªå®šä¹‰æŒ‡ç¤ºå™¨
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Healthæ£€æŸ¥](#1-ä»€ä¹ˆæ˜¯Healthæ£€æŸ¥)
2. [HealthIndicatorå¥åº·æŒ‡ç¤ºå™¨è¯¦è§£](#2-HealthIndicatorå¥åº·æŒ‡ç¤ºå™¨è¯¦è§£)
3. [å†…ç½®å¥åº·æ£€æŸ¥ç»„ä»¶](#3-å†…ç½®å¥åº·æ£€æŸ¥ç»„ä»¶)
4. [è‡ªå®šä¹‰å¥åº·æŒ‡ç¤ºå™¨](#4-è‡ªå®šä¹‰å¥åº·æŒ‡ç¤ºå™¨)
5. [å¥åº·çŠ¶æ€èšåˆä¸åˆ†ç»„](#5-å¥åº·çŠ¶æ€èšåˆä¸åˆ†ç»„)
6. [StatusçŠ¶æ€è¯¦è§£](#6-StatusçŠ¶æ€è¯¦è§£)
7. [å®é™…åº”ç”¨æœ€ä½³å®è·µ](#7-å®é™…åº”ç”¨æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ©º ä»€ä¹ˆæ˜¯Healthæ£€æŸ¥


### 1.1 æ¦‚å¿µç†è§£


**Healthæ£€æŸ¥æ˜¯ä»€ä¹ˆï¼Ÿ**
Healthæ£€æŸ¥å°±åƒæ˜¯ç»™ä½ çš„åº”ç”¨åš**ä½“æ£€**ã€‚æƒ³è±¡ä¸€ä¸‹ä½ å»åŒ»é™¢ä½“æ£€ï¼ŒåŒ»ç”Ÿä¼šæ£€æŸ¥ä½ çš„å¿ƒè„ã€è¡€å‹ã€è‚åŠŸèƒ½ç­‰å„ä¸ªæ–¹é¢ï¼Œæœ€åç»™å‡ºä¸€ä¸ªæ•´ä½“å¥åº·è¯„ä¼°ã€‚

Spring Bootçš„Healthæ£€æŸ¥ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼š
- æ£€æŸ¥æ•°æ®åº“èƒ½ä¸èƒ½æ­£å¸¸è¿æ¥ï¼ˆå°±åƒæ£€æŸ¥å¿ƒè„ï¼‰
- æ£€æŸ¥Redisç¼“å­˜æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼ˆå°±åƒæ£€æŸ¥è¡€æ¶²å¾ªç¯ï¼‰
- æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦ç•…é€šï¼ˆå°±åƒæ£€æŸ¥ç¥ç»ç³»ç»Ÿï¼‰
- æœ€åç»¼åˆæ‰€æœ‰æ£€æŸ¥ç»“æœï¼Œå‘Šè¯‰ä½ æ•´ä¸ªåº”ç”¨æ˜¯å¦å¥åº·

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Healthæ£€æŸ¥


```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
åº”ç”¨å¯åŠ¨äº† â‰  åº”ç”¨å¥åº·
- åº”ç”¨è¿›ç¨‹å­˜åœ¨ï¼Œä½†æ•°æ®åº“è¿ä¸ä¸Š
- æœåŠ¡è¿è¡Œä¸­ï¼Œä½†RedisæŒ‚äº†
- æ¥å£èƒ½è®¿é—®ï¼Œä½†æ¶ˆæ¯é˜Ÿåˆ—å¼‚å¸¸

Healthæ£€æŸ¥çš„ä»·å€¼ï¼š
âœ… å¿«é€Ÿå‘ç°é—®é¢˜ï¼šåœ¨ç”¨æˆ·å‘ç°ä¹‹å‰å°±çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜äº†
âœ… è‡ªåŠ¨åŒ–è¿ç»´ï¼šé…åˆç›‘æ§ç³»ç»Ÿï¼Œå®ç°æ•…éšœè‡ªæ„ˆ
âœ… è´Ÿè½½å‡è¡¡ï¼šä¸å¥åº·çš„å®ä¾‹è‡ªåŠ¨ä»è´Ÿè½½ä¸­ç§»é™¤
âœ… è¿ç»´å†³ç­–ï¼šä¸ºæ‰©å®¹ã€é‡å¯æä¾›æ•°æ®æ”¯æ’‘
```

### 1.3 Healthæ£€æŸ¥çš„å·¥ä½œæœºåˆ¶


```
Healthæ£€æŸ¥æµç¨‹ï¼š

ç”¨æˆ·/ç›‘æ§ç³»ç»Ÿ â†’ /actuator/health â†’ Spring Boot
                                        â”‚
                                        â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Healthæ£€æŸ¥å¼•æ“  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                   â–¼                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ•°æ®åº“æ£€æŸ¥     â”‚  â”‚ Redisæ£€æŸ¥     â”‚  â”‚ è‡ªå®šä¹‰æ£€æŸ¥     â”‚
            â”‚ UP/DOWN       â”‚  â”‚ UP/DOWN       â”‚  â”‚ UP/DOWN       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                   â”‚                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   èšåˆç»“æœ      â”‚
                              â”‚ UP/DOWN/UNKNOWN â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ HealthIndicatorå¥åº·æŒ‡ç¤ºå™¨è¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯HealthIndicator


**é€šä¿—ç†è§£**ï¼š
HealthIndicatorå°±åƒæ˜¯åŒ»é™¢é‡Œçš„**å„ç§æ£€æŸ¥è®¾å¤‡**ï¼š
- å¿ƒç”µå›¾æœºä¸“é—¨æ£€æŸ¥å¿ƒè„ â†’ DataSourceHealthIndicatorä¸“é—¨æ£€æŸ¥æ•°æ®åº“
- è¡€å‹è®¡ä¸“é—¨æµ‹è¡€å‹ â†’ RedisHealthIndicatorä¸“é—¨æ£€æŸ¥Redis
- Xå…‰æœºä¸“é—¨æ‹è‚ºéƒ¨ â†’ ä½ çš„è‡ªå®šä¹‰Indicatorä¸“é—¨æ£€æŸ¥ä½ å…³å¿ƒçš„ç»„ä»¶

### 2.2 HealthIndicatoræ¥å£è¯¦è§£


**æ ¸å¿ƒæ¥å£å®šä¹‰**ï¼š
```java
public interface HealthIndicator {
    Health health();
}
```

**è¿™ä¸ªæ¥å£å¾ˆç®€å•ï¼Œä½†å«ä¹‰å¾ˆé‡è¦**ï¼š
- `health()`æ–¹æ³•ï¼šè¿”å›å½“å‰ç»„ä»¶çš„å¥åº·çŠ¶å†µ
- `Health`å¯¹è±¡ï¼šåŒ…å«çŠ¶æ€ï¼ˆUP/DOWNï¼‰å’Œè¯¦ç»†ä¿¡æ¯

### 2.3 Healthå¯¹è±¡è¯¦è§£


Healthå¯¹è±¡å°±åƒæ˜¯**ä½“æ£€æŠ¥å‘Šå•**ï¼ŒåŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š

**çŠ¶æ€éƒ¨åˆ†**ï¼š
- `UP`ï¼šç»„ä»¶æ­£å¸¸ï¼Œå°±åƒä½“æ£€æŒ‡æ ‡æ­£å¸¸
- `DOWN`ï¼šç»„ä»¶å¼‚å¸¸ï¼Œå°±åƒæŸé¡¹æŒ‡æ ‡è¶…æ ‡
- `UNKNOWN`ï¼šæ— æ³•åˆ¤æ–­ï¼Œå°±åƒæŸé¡¹æ£€æŸ¥åšä¸äº†

**è¯¦ç»†ä¿¡æ¯éƒ¨åˆ†**ï¼š
- å…·ä½“çš„æ£€æŸ¥æ•°æ®
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
- é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

```java
// å…¸å‹çš„Healthå¯¹è±¡å†…å®¹
{
  "status": "UP",
  "details": {
    "database": "MySQL",
    "validationQuery": "isValid()",
    "result": 1
  }
}
```

---

## 3. ğŸ—ï¸ å†…ç½®å¥åº·æ£€æŸ¥ç»„ä»¶


Spring Bootå°±åƒæ˜¯é…å¤‡äº†**å…¨å¥—ä½“æ£€è®¾å¤‡**çš„åŒ»é™¢ï¼Œè‡ªå¸¦äº†å¾ˆå¤šå¸¸ç”¨çš„å¥åº·æ£€æŸ¥ï¼š

### 3.1 æ•°æ®åº“è¿æ¥å¥åº·æ£€æŸ¥


**DataSourceHealthIndicator** - æ•°æ®åº“"å¿ƒç”µå›¾"

> ğŸ’¡ **ä½œç”¨**ï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œå°±åƒæ£€æŸ¥åº”ç”¨çš„"å¿ƒè„"æ˜¯å¦è·³åŠ¨

**å·¥ä½œåŸç†**ï¼š
```
æ£€æŸ¥è¿‡ç¨‹ï¼š
1. è·å–æ•°æ®åº“è¿æ¥
2. æ‰§è¡ŒéªŒè¯æŸ¥è¯¢ï¼ˆé€šå¸¸æ˜¯SELECT 1ï¼‰
3. æ ¹æ®æŸ¥è¯¢ç»“æœåˆ¤æ–­å¥åº·çŠ¶æ€

å¥åº·æ ‡å‡†ï¼š
âœ… èƒ½æ­£å¸¸è·å–è¿æ¥ + æŸ¥è¯¢æˆåŠŸ = UP
âŒ è¿æ¥å¤±è´¥ æˆ– æŸ¥è¯¢è¶…æ—¶ = DOWN
```

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
# application.yml
management:
  health:
    db:
      enabled: true  # å¯ç”¨æ•°æ®åº“å¥åº·æ£€æŸ¥ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
```

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "MySQL",
        "validationQuery": "isValid()"
      }
    }
  }
}
```

### 3.2 Redisè¿æ¥å¥åº·æ£€æŸ¥


**RedisHealthIndicator** - Redis"è¡€æ¶²æ£€æŸ¥"

> ğŸ’¡ **ä½œç”¨**ï¼šæ£€æŸ¥Redisç¼“å­˜æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œå°±åƒæ£€æŸ¥åº”ç”¨çš„"è¡€æ¶²å¾ªç¯"

**å·¥ä½œåŸç†**ï¼š
```
æ£€æŸ¥æµç¨‹ï¼š
1. å°è¯•è¿æ¥RedisæœåŠ¡å™¨
2. æ‰§è¡ŒPINGå‘½ä»¤
3. æ£€æŸ¥å“åº”æ˜¯å¦ä¸ºPONG

åˆ¤æ–­æ ‡å‡†ï¼š
âœ… PING â†’ PONG = UP
âŒ è¿æ¥å¤±è´¥ æˆ– å“åº”å¼‚å¸¸ = DOWN
```

**é…ç½®å’Œä½¿ç”¨**ï¼š
```yaml
# å¯ç”¨Rediså¥åº·æ£€æŸ¥
management:
  health:
    redis:
      enabled: true

# Redisè¿æ¥é…ç½®
spring:
  redis:
    host: localhost
    port: 6379
    timeout: 2000ms  # è¶…æ—¶è®¾ç½®å½±å“å¥åº·æ£€æŸ¥
```

### 3.3 æ¶ˆæ¯é˜Ÿåˆ—å¥åº·æ£€æŸ¥


**RabbitHealthIndicator** - æ¶ˆæ¯é˜Ÿåˆ—"ç¥ç»æ£€æŸ¥"

> ğŸ’¡ **ä½œç”¨**ï¼šæ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¦æ­£å¸¸ï¼Œå°±åƒæ£€æŸ¥åº”ç”¨çš„"ç¥ç»ç³»ç»Ÿ"

**å·¥ä½œæ–¹å¼**ï¼š
```
æ£€æŸ¥å†…å®¹ï¼š
- RabbitMQè¿æ¥çŠ¶æ€
- ç®¡ç†ç«¯å£å¯è¾¾æ€§
- é˜Ÿåˆ—å’Œäº¤æ¢å™¨çŠ¶æ€

å¥åº·åˆ¤æ–­ï¼š
âœ… è¿æ¥æ­£å¸¸ + ç®¡ç†æ¥å£å“åº” = UP
âŒ è¿æ¥æ–­å¼€ æˆ– æœåŠ¡å¼‚å¸¸ = DOWN
```

### 3.4 å…¶ä»–å†…ç½®æ£€æŸ¥å™¨


| æ£€æŸ¥å™¨ç±»å‹ | **æ£€æŸ¥å¯¹è±¡** | **å°±åƒæ£€æŸ¥** | **åˆ¤æ–­æ ‡å‡†** |
|-----------|-------------|-------------|-------------|
| **DiskSpaceHealthIndicator** | `ç£ç›˜ç©ºé—´` | `å­˜å‚¨ç©ºé—´` | `å¯ç”¨ç©ºé—´ > é˜ˆå€¼` |
| **MailHealthIndicator** | `é‚®ä»¶æœåŠ¡` | `é€šè®¯èƒ½åŠ›` | `SMTPè¿æ¥æ­£å¸¸` |
| **ElasticsearchHealthIndicator** | `ESæœç´¢` | `æ£€ç´¢åŠŸèƒ½` | `é›†ç¾¤çŠ¶æ€GREEN` |
| **MongoHealthIndicator** | `MongoDB` | `æ–‡æ¡£å­˜å‚¨` | `è¿æ¥ + pingæˆåŠŸ` |

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰å¥åº·æŒ‡ç¤ºå™¨


æœ‰æ—¶å€™å†…ç½®çš„æ£€æŸ¥å™¨ä¸å¤Ÿç”¨ï¼Œå°±åƒæœ‰äº›ä¸“ç§‘æ£€æŸ¥éœ€è¦ç‰¹æ®Šè®¾å¤‡ã€‚è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦**è‡ªå®šä¹‰å¥åº·æŒ‡ç¤ºå™¨**ã€‚

### 4.1 è‡ªå®šä¹‰æŒ‡ç¤ºå™¨åŸºç¡€å®ç°


**åœºæ™¯ä¸¾ä¾‹**ï¼šå‡è®¾ä½ çš„åº”ç”¨ä¾èµ–ä¸€ä¸ªç¬¬ä¸‰æ–¹APIæœåŠ¡ï¼Œä½ æƒ³æ£€æŸ¥è¿™ä¸ªAPIæ˜¯å¦æ­£å¸¸ã€‚

```java
import org.springframework.boot.actuate.health.Health;
import org.springframework.boot.actuate.health.HealthIndicator;
import org.springframework.stereotype.Component;
import org.springframework.web.client.RestTemplate;

@Component("externalApi")  // ç»„ä»¶åç§°ï¼Œä¼šåœ¨healthç«¯ç‚¹ä¸­æ˜¾ç¤º
public class ExternalApiHealthIndicator implements HealthIndicator {
    
    private final RestTemplate restTemplate;
    private final String apiUrl = "https://api.example.com/status";
    
    public ExternalApiHealthIndicator(RestTemplate restTemplate) {
        this.restTemplate = restTemplate;
    }
    
    @Override
    public Health health() {
        try {
            // å°è¯•è°ƒç”¨ç¬¬ä¸‰æ–¹API
            String response = restTemplate.getForObject(apiUrl, String.class);
            
            if ("OK".equals(response)) {
                // APIæ­£å¸¸ï¼Œè¿”å›UPçŠ¶æ€
                return Health.up()
                    .withDetail("api", "External API")
                    .withDetail("status", "Available")
                    .withDetail("response", response)
                    .build();
            } else {
                // APIå“åº”å¼‚å¸¸
                return Health.down()
                    .withDetail("api", "External API")
                    .withDetail("status", "Unexpected response")
                    .withDetail("response", response)
                    .build();
            }
        } catch (Exception e) {
            // è°ƒç”¨å¤±è´¥
            return Health.down()
                .withDetail("api", "External API")
                .withDetail("status", "Connection failed")
                .withDetail("error", e.getMessage())
                .build();
        }
    }
}
```

**ä»£ç è§£è¯»**ï¼š
1. **å®ç°æ¥å£**ï¼šç»§æ‰¿`HealthIndicator`æ¥å£
2. **@Componentæ³¨è§£**ï¼šè®©Springç®¡ç†è¿™ä¸ªç»„ä»¶
3. **health()æ–¹æ³•**ï¼šæ ¸å¿ƒæ£€æŸ¥é€»è¾‘
4. **Health.up()/Health.down()**ï¼šæ„å»ºå¥åº·çŠ¶æ€
5. **withDetail()**ï¼šæ·»åŠ è¯¦ç»†ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•

### 4.2 æ‰¹é‡æ£€æŸ¥çš„è‡ªå®šä¹‰æŒ‡ç¤ºå™¨


**åœºæ™¯**ï¼šæ£€æŸ¥å¤šä¸ªå¾®æœåŠ¡æ˜¯å¦éƒ½æ­£å¸¸

```java
@Component("microservices")
public class MicroservicesHealthIndicator implements HealthIndicator {
    
    private final List<String> serviceUrls = Arrays.asList(
        "http://user-service/actuator/health",
        "http://order-service/actuator/health",
        "http://payment-service/actuator/health"
    );
    
    @Override
    public Health health() {
        Health.Builder builder = Health.up();
        int downCount = 0;
        
        for (String serviceUrl : serviceUrls) {
            try {
                // æ£€æŸ¥æ¯ä¸ªæœåŠ¡
                ResponseEntity<Map> response = restTemplate.getForEntity(
                    serviceUrl, Map.class);
                
                String serviceName = extractServiceName(serviceUrl);
                String status = (String) response.getBody().get("status");
                
                builder.withDetail(serviceName, status);
                
                if (!"UP".equals(status)) {
                    downCount++;
                }
            } catch (Exception e) {
                String serviceName = extractServiceName(serviceUrl);
                builder.withDetail(serviceName, "DOWN - " + e.getMessage());
                downCount++;
            }
        }
        
        // å¦‚æœæœ‰ä»»ä½•æœåŠ¡DOWNï¼Œæ•´ä½“çŠ¶æ€ä¸ºDOWN
        if (downCount > 0) {
            builder.down();
        }
        
        return builder
            .withDetail("total", serviceUrls.size())
            .withDetail("down", downCount)
            .build();
    }
}
```

### 4.3 åŸºäºReactiveHealthIndicatorçš„å¼‚æ­¥æ£€æŸ¥


å¯¹äºéœ€è¦å¼‚æ­¥æ£€æŸ¥çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç½‘ç»œè°ƒç”¨ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ååº”å¼æŒ‡ç¤ºå™¨ï¼š

```java
@Component("asyncExternal")
public class AsyncExternalHealthIndicator implements ReactiveHealthIndicator {
    
    private final WebClient webClient;
    
    @Override
    public Mono<Health> health() {
        return webClient.get()
            .uri("https://api.example.com/status")
            .retrieve()
            .bodyToMono(String.class)
            .map(response -> Health.up()
                .withDetail("status", response)
                .build())
            .onErrorReturn(Health.down()
                .withDetail("error", "Service unavailable")
                .build())
            .timeout(Duration.ofSeconds(5));  // 5ç§’è¶…æ—¶
    }
}
```

---

## 5. ğŸ”— å¥åº·çŠ¶æ€èšåˆä¸åˆ†ç»„


### 5.1 ä»€ä¹ˆæ˜¯çŠ¶æ€èšåˆ


**èšåˆå°±åƒæ˜¯ç»¼åˆä½“æ£€æŠ¥å‘Š**ï¼š
- ä½ åšäº†10é¡¹æ£€æŸ¥ï¼Œæ¯é¡¹éƒ½æœ‰ç»“æœ
- åŒ»ç”Ÿéœ€è¦ç»™å‡ºä¸€ä¸ª**æ•´ä½“è¯„ä¼°**ï¼šå¥åº·/äºšå¥åº·/ä¸å¥åº·
- Spring Bootä¹Ÿéœ€è¦æŠŠæ‰€æœ‰ç»„ä»¶çš„å¥åº·çŠ¶æ€**ç»¼åˆèµ·æ¥**

### 5.2 é»˜è®¤èšåˆè§„åˆ™


Spring Bootçš„é»˜è®¤èšåˆé€»è¾‘å¾ˆç®€å•ï¼š

```
èšåˆè§„åˆ™ï¼ˆä»ä¸¥åŸåˆ™ï¼‰ï¼š
æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯UP â†’ æ•´ä½“UP
ä»»ä½•ä¸€ä¸ªç»„ä»¶DOWN â†’ æ•´ä½“DOWN
æœ‰UNKNOWNç»„ä»¶ â†’ æ•´ä½“UNKNOWN

å®é™…ç¤ºä¾‹ï¼š
æ•°æ®åº“ï¼šUP + Redisï¼šUP + è‡ªå®šä¹‰ï¼šUP = æ•´ä½“ï¼šUP
æ•°æ®åº“ï¼šUP + Redisï¼šDOWN + è‡ªå®šä¹‰ï¼šUP = æ•´ä½“ï¼šDOWN
```

### 5.3 å¥åº·æ£€æŸ¥åˆ†ç»„


**ä»€ä¹ˆæ˜¯åˆ†ç»„ï¼Ÿ**
å°±åƒä½“æ£€å¯ä»¥åˆ†ä¸º**åŸºç¡€ä½“æ£€**å’Œ**ä¸“é¡¹ä½“æ£€**ï¼š
- åŸºç¡€åˆ†ç»„ï¼šæ•°æ®åº“ã€Redisç­‰æ ¸å¿ƒç»„ä»¶
- ä¸šåŠ¡åˆ†ç»„ï¼šç¬¬ä¸‰æ–¹APIã€å¾®æœåŠ¡ä¾èµ–
- ç›‘æ§åˆ†ç»„ï¼šä¸“é—¨ç»™ç›‘æ§ç³»ç»Ÿçœ‹çš„æŒ‡æ ‡

**é…ç½®åˆ†ç»„ç¤ºä¾‹**ï¼š
```yaml
management:
  endpoint:
    health:
      group:
        # åŸºç¡€å¥åº·åˆ†ç»„ï¼ˆç»™è´Ÿè½½å‡è¡¡å™¨ç”¨ï¼‰
        basic:
          include: db,redis
          show-details: never
        # è¯¦ç»†å¥åº·åˆ†ç»„ï¼ˆç»™è¿ç»´äººå‘˜ç”¨ï¼‰  
        detailed:
          include: "*"
          show-details: always
        # ä¸šåŠ¡å¥åº·åˆ†ç»„
        business:
          include: externalApi,microservices
          show-details: when-authorized
```

**è®¿é—®ä¸åŒåˆ†ç»„**ï¼š
```bash
# è®¿é—®åŸºç¡€åˆ†ç»„
curl http://localhost:8080/actuator/health/basic

# è®¿é—®è¯¦ç»†åˆ†ç»„  
curl http://localhost:8080/actuator/health/detailed

# è®¿é—®ä¸šåŠ¡åˆ†ç»„
curl http://localhost:8080/actuator/health/business
```

**åˆ†ç»„çš„å®é™…åº”ç”¨**ï¼š

```
è´Ÿè½½å‡è¡¡å™¨é…ç½®ï¼š
- åªå…³å¿ƒåŸºç¡€ç»„ä»¶ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ï¼‰
- ç¬¬ä¸‰æ–¹APIå¼‚å¸¸ä¸å½±å“æµé‡åˆ†å‘
- é…ç½®ï¼š/actuator/health/basic

è¿ç»´ç›‘æ§é…ç½®ï¼š
- éœ€è¦çœ‹åˆ°æ‰€æœ‰è¯¦ç»†ä¿¡æ¯
- åŒ…å«é”™è¯¯å †æ ˆå’Œè°ƒè¯•ä¿¡æ¯  
- é…ç½®ï¼š/actuator/health/detailed

ä¸šåŠ¡ç›‘æ§é…ç½®ï¼š
- ä¸“æ³¨ä¸šåŠ¡ç›¸å…³çš„ä¾èµ–æ£€æŸ¥
- ç”¨äºä¸šåŠ¡å‘Šè­¦å’Œå†³ç­–
- é…ç½®ï¼š/actuator/health/business
```

---

## 6. ğŸ“Š StatusçŠ¶æ€è¯¦è§£


### 6.1 å†…ç½®çŠ¶æ€ç±»å‹


Spring Bootæä¾›äº†å››ç§æ ‡å‡†çš„å¥åº·çŠ¶æ€ï¼š

| çŠ¶æ€ | **å«ä¹‰** | **HTTPçŠ¶æ€ç ** | **ç±»æ¯”** |
|------|---------|---------------|----------|
| **UP** | `ä¸€åˆ‡æ­£å¸¸` | `200 OK` | `ä½“æ£€æŒ‡æ ‡å…¨éƒ¨æ­£å¸¸` |
| **DOWN** | `æœ‰é—®é¢˜éœ€è¦å¤„ç†` | `503 Service Unavailable` | `å‘ç°ç–¾ç—…éœ€è¦æ²»ç–—` |
| **OUT_OF_SERVICE** | `æš‚åœæœåŠ¡` | `503 Service Unavailable` | `æš‚æ—¶åœè¯Šç»´æŠ¤` |
| **UNKNOWN** | `æ— æ³•ç¡®å®šçŠ¶æ€` | `200 OK` | `æ£€æŸ¥ç»“æœä¸æ˜ç¡®` |

### 6.2 çŠ¶æ€çš„ä¼˜å…ˆçº§å’Œæ’åº


å½“æœ‰å¤šä¸ªç»„ä»¶æ—¶ï¼ŒæŒ‰ç…§ä¸¥é‡ç¨‹åº¦æ’åºï¼š

```
çŠ¶æ€ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. DOWNï¼ˆæœ€ä¸¥é‡ï¼‰
2. OUT_OF_SERVICE  
3. UNKNOWN
4. UPï¼ˆæœ€å¥½ï¼‰

èšåˆç¤ºä¾‹ï¼š
ç»„ä»¶A: UP + ç»„ä»¶B: UNKNOWN = ç»“æœ: UNKNOWN
ç»„ä»¶A: UP + ç»„ä»¶B: DOWN = ç»“æœ: DOWN
ç»„ä»¶A: DOWN + ç»„ä»¶B: OUT_OF_SERVICE = ç»“æœ: DOWN
```

### 6.3 è‡ªå®šä¹‰çŠ¶æ€


ä½ å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦å®šä¹‰è‡ªå·±çš„çŠ¶æ€ï¼š

```java
public class CustomHealthIndicator implements HealthIndicator {
    
    // å®šä¹‰è‡ªå®šä¹‰çŠ¶æ€
    private static final Status DEGRADED = new Status("DEGRADED", "Service is degraded");
    
    @Override
    public Health health() {
        // å‡è®¾æ£€æŸ¥æŸä¸ªä¸šåŠ¡æŒ‡æ ‡
        double performanceScore = checkPerformance();
        
        if (performanceScore > 0.9) {
            return Health.up()
                .withDetail("performance", performanceScore)
                .build();
        } else if (performanceScore > 0.5) {
            // ä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€
            return Health.status(DEGRADED)
                .withDetail("performance", performanceScore)
                .withDetail("message", "Performance degraded but still functional")
                .build();
        } else {
            return Health.down()
                .withDetail("performance", performanceScore)
                .build();
        }
    }
}
```

### 6.4 çŠ¶æ€æ˜ å°„é…ç½®


å¯ä»¥è‡ªå®šä¹‰çŠ¶æ€åˆ°HTTPçŠ¶æ€ç çš„æ˜ å°„ï¼š

```yaml
management:
  endpoint:
    health:
      status:
        # è‡ªå®šä¹‰çŠ¶æ€ç æ˜ å°„
        http-mapping:
          DEGRADED: 200  # é™çº§çŠ¶æ€è¿”å›200è€Œä¸æ˜¯503
          DOWN: 503
          OUT_OF_SERVICE: 503
        # çŠ¶æ€æ’åºï¼ˆå½±å“èšåˆç»“æœï¼‰
        order: DOWN,OUT_OF_SERVICE,DEGRADED,UNKNOWN,UP
```

---

## 7. ğŸš€ å®é™…åº”ç”¨æœ€ä½³å®è·µ


### 7.1 åœ¨å¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨


**åœºæ™¯è®¾è®¡**ï¼š
```
å¾®æœåŠ¡å¥åº·æ£€æŸ¥æ¶æ„ï¼š

                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   API Gateway   â”‚
                  â”‚  å¥åº·æ£€æŸ¥è·¯ç”±    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç”¨æˆ·æœåŠ¡     â”‚ â”‚ è®¢å•æœåŠ¡     â”‚ â”‚ æ”¯ä»˜æœåŠ¡     â”‚  
    â”‚ /health     â”‚ â”‚ /health     â”‚ â”‚ /health     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸ªæœåŠ¡æ£€æŸ¥ï¼š
âœ“ è‡ªèº«æ•°æ®åº“è¿æ¥
âœ“ ä¾èµ–çš„ä¸­é—´ä»¶ï¼ˆRedisã€MQï¼‰
âœ“ å…³é”®çš„å¤–éƒ¨æœåŠ¡
```

**å®æ–½ç­–ç•¥**ï¼š

> ğŸ”§ **å®è·µå»ºè®®**ï¼š
> - **åˆ†å±‚æ£€æŸ¥**ï¼šåŸºç¡€è®¾æ–½ â†’ ä¸­é—´ä»¶ â†’ ä¸šåŠ¡ä¾èµ–
> - **åˆ†ç»„æš´éœ²**ï¼šä¸åŒçš„æ¶ˆè´¹è€…çœ‹ä¸åŒçš„å¥åº·ä¿¡æ¯
> - **è¶…æ—¶æ§åˆ¶**ï¼šå¥åº·æ£€æŸ¥ä¸èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡
> - **ç¼“å­˜ç»“æœ**ï¼šé¿å…é¢‘ç¹æ£€æŸ¥å½±å“æ€§èƒ½

### 7.2 ä¸Kubernetesé›†æˆ


**åœ¨K8sä¸­çš„åº”ç”¨åœºæ™¯**ï¼š
```yaml
# Kuberneteséƒ¨ç½²æ–‡ä»¶ç¤ºä¾‹
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: my-app
        image: my-app:latest
        # å­˜æ´»æ¢é’ˆï¼šç”¨äºé‡å¯Pod
        livenessProbe:
          httpGet:
            path: /actuator/health/liveness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        # å°±ç»ªæ¢é’ˆï¼šç”¨äºæµé‡åˆ†å‘
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness  
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```

**å¯¹åº”çš„Spring Booté…ç½®**ï¼š
```yaml
management:
  endpoint:
    health:
      group:
        liveness:
          include: livenessstate
        readiness:
          include: readinessstate,db,redis
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
```

### 7.3 ç›‘æ§å‘Šè­¦é›†æˆ


**ç›‘æ§ç³»ç»Ÿé›†æˆç¤ºä¾‹**ï¼š

```
å‘Šè­¦ç­–ç•¥è®¾è®¡ï¼š

ä¸¥é‡å‘Šè­¦ï¼ˆç«‹å³å¤„ç†ï¼‰ï¼š
- æ•°æ®åº“DOWN â†’ 5åˆ†é’Ÿå†…å¿…é¡»å“åº”
- æ ¸å¿ƒæœåŠ¡DOWN â†’ ç«‹å³ç”µè¯é€šçŸ¥

ä¸€èˆ¬å‘Šè­¦ï¼ˆå…³æ³¨å¤„ç†ï¼‰ï¼š
- ç¬¬ä¸‰æ–¹APIå¼‚å¸¸ â†’ é‚®ä»¶é€šçŸ¥
- æ€§èƒ½é™çº§ â†’ å·¥ä½œæ—¶é—´å¤„ç†

ä¿¡æ¯é€šçŸ¥ï¼ˆè®°å½•è·Ÿè¸ªï¼‰ï¼š
- å¥åº·æ£€æŸ¥é¢‘ç¹å¤±è´¥ â†’ è®°å½•æ—¥å¿—
- ä¾èµ–æœåŠ¡ä¸ç¨³å®š â†’ ç»Ÿè®¡åˆ†æ
```

### 7.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**é¿å…æ€§èƒ½é—®é¢˜**ï¼š

> âš ï¸ **æ³¨æ„äº‹é¡¹**ï¼š
> - **è¶…æ—¶è®¾ç½®**ï¼šå¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´è¦åˆç†ï¼Œä¸èƒ½å¤ªé•¿
> - **æ£€æŸ¥é¢‘ç‡**ï¼šä¸è¦æ£€æŸ¥å¾—å¤ªé¢‘ç¹ï¼Œä¼šå½±å“æ€§èƒ½  
> - **å¼‚æ­¥æ£€æŸ¥**ï¼šå¯¹äºè€—æ—¶çš„æ£€æŸ¥ï¼Œä½¿ç”¨å¼‚æ­¥æ–¹å¼
> - **ç»“æœç¼“å­˜**ï¼šå¯ä»¥ç¼“å­˜æ£€æŸ¥ç»“æœï¼Œé¿å…é‡å¤æ£€æŸ¥

```yaml
# æ€§èƒ½ä¼˜åŒ–é…ç½®ç¤ºä¾‹
management:
  health:
    # ç¼“å­˜å¥åº·æ£€æŸ¥ç»“æœ
    status:
      time-to-live: 10s  # ç¼“å­˜10ç§’
    # æ•°æ®åº“æ£€æŸ¥ä¼˜åŒ–
    db:
      enabled: true
      timeout: 2s  # 2ç§’è¶…æ—¶
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Healthæ£€æŸ¥æœ¬è´¨ï¼šç»™åº”ç”¨åš"ä½“æ£€"ï¼Œæ£€æŸ¥å„ä¸ªç»„ä»¶æ˜¯å¦æ­£å¸¸
ğŸ”¸ HealthIndicatorï¼šä¸“é—¨çš„"æ£€æŸ¥è®¾å¤‡"ï¼Œæ¯ä¸ªè´Ÿè´£æ£€æŸ¥ä¸€ä¸ªç»„ä»¶  
ğŸ”¸ çŠ¶æ€èšåˆï¼šæŠŠæ‰€æœ‰æ£€æŸ¥ç»“æœç»¼åˆæˆæ•´ä½“å¥åº·è¯„ä¼°
ğŸ”¸ åˆ†ç»„ç®¡ç†ï¼šä¸åŒåœºæ™¯éœ€è¦ä¸åŒçº§åˆ«çš„å¥åº·ä¿¡æ¯
ğŸ”¸ è‡ªå®šä¹‰æ‰©å±•ï¼šå¯ä»¥ä¸ºç‰¹æ®Šéœ€æ±‚åˆ›å»ºä¸“é—¨çš„æ£€æŸ¥å™¨
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰HealthIndicator**
```
å†…ç½®æ£€æŸ¥å™¨ä¸å¤Ÿç”¨çš„åœºæ™¯ï¼š
âœ“ ä¾èµ–ç¬¬ä¸‰æ–¹APIæœåŠ¡
âœ“ éœ€è¦æ£€æŸ¥ä¸šåŠ¡é€»è¾‘çŠ¶æ€  
âœ“ è‡ªç ”çš„ä¸­é—´ä»¶ç»„ä»¶
âœ“ ç‰¹æ®Šçš„æ€§èƒ½æŒ‡æ ‡

åˆ¤æ–­åŸåˆ™ï¼š
å¦‚æœè¿™ä¸ªç»„ä»¶å¼‚å¸¸ä¼šå½±å“ç”¨æˆ·ä½¿ç”¨ï¼Œå°±åº”è¯¥åŠ å…¥å¥åº·æ£€æŸ¥
```

**ğŸ”¹ å¥åº·æ£€æŸ¥çš„åˆ†ç»„ç­–ç•¥**
```
åŸºç¡€åˆ†ç»„ï¼š
- ç”¨é€”ï¼šè´Ÿè½½å‡è¡¡å™¨ã€å®¹å™¨ç¼–æ’
- åŒ…å«ï¼šæ•°æ®åº“ã€ç¼“å­˜ç­‰æ ¸å¿ƒä¾èµ–
- ç‰¹ç‚¹ï¼šæ£€æŸ¥å¿«é€Ÿã€ç»“æœæ˜ç¡®

ä¸šåŠ¡åˆ†ç»„ï¼š  
- ç”¨é€”ï¼šä¸šåŠ¡ç›‘æ§ã€å‘Šè­¦å†³ç­–
- åŒ…å«ï¼šå¤–éƒ¨APIã€å¾®æœåŠ¡ä¾èµ–
- ç‰¹ç‚¹ï¼šåæ˜ ä¸šåŠ¡å¥åº·åº¦

è¯¦ç»†åˆ†ç»„ï¼š
- ç”¨é€”ï¼šé—®é¢˜æ’æŸ¥ã€è¿ç»´è°ƒè¯•  
- åŒ…å«ï¼šæ‰€æœ‰ç»„ä»¶çš„è¯¦ç»†ä¿¡æ¯
- ç‰¹ç‚¹ï¼šä¿¡æ¯å…¨é¢ã€ä¾¿äºå®šä½é—®é¢˜
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒä»·å€¼**
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šé…åˆK8så®ç°æ•…éšœè‡ªæ„ˆ
- **è´Ÿè½½å‡è¡¡**ï¼šä¸å¥åº·å®ä¾‹è‡ªåŠ¨æ‘˜é™¤æµé‡
- **ç›‘æ§å‘Šè­¦**ï¼šæå‰å‘ç°å’Œé¢„é˜²æ•…éšœ
- **é—®é¢˜å®šä½**ï¼šå¿«é€Ÿè¯†åˆ«æ•…éšœæ ¹å› 

**ğŸ”§ å¼€å‘é˜¶æ®µä»·å€¼**  
- **æœ¬åœ°è°ƒè¯•**ï¼šå¿«é€Ÿæ£€æŸ¥ä¾èµ–æœåŠ¡çŠ¶æ€
- **é›†æˆæµ‹è¯•**ï¼šéªŒè¯å„ä¸ªç»„ä»¶è¿æ¥æ­£å¸¸
- **éƒ¨ç½²éªŒè¯**ï¼šç¡®è®¤æ–°ç‰ˆæœ¬éƒ¨ç½²æˆåŠŸ

### 8.4 æœ€ä½³å®è·µå»ºè®®


```
è®¾è®¡åŸåˆ™ï¼š
ğŸ”¸ å¿«é€Ÿå“åº”ï¼šå¥åº·æ£€æŸ¥è¦è¶³å¤Ÿå¿«ï¼Œä¸èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡
ğŸ”¸ å‡†ç¡®åˆ¤æ–­ï¼šæ£€æŸ¥é€»è¾‘è¦å‡†ç¡®ï¼Œé¿å…è¯¯æŠ¥å’Œæ¼æŠ¥
ğŸ”¸ åˆ†å±‚è®¾è®¡ï¼šåŸºç¡€è®¾æ–½ã€ä¸­é—´ä»¶ã€ä¸šåŠ¡ä¾èµ–åˆ†å¼€æ£€æŸ¥
ğŸ”¸ é€‚åº¦æ£€æŸ¥ï¼šä¸è¦æ£€æŸ¥è¿‡å¤šç»†èŠ‚ï¼Œé‡ç‚¹å…³æ³¨å…³é”®ä¾èµ–

å®æ–½å»ºè®®ï¼š
ğŸ”¸ ä»ç®€å•å¼€å§‹ï¼šå…ˆç”¨å†…ç½®æ£€æŸ¥å™¨ï¼Œå†é€æ­¥åŠ è‡ªå®šä¹‰
ğŸ”¸ åˆ†ç»„æš´éœ²ï¼šä¸åŒçš„æ¶ˆè´¹è€…æä¾›ä¸åŒçš„å¥åº·ä¿¡æ¯
ğŸ”¸ è¶…æ—¶æ§åˆ¶ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
ğŸ”¸ ç»“æœç¼“å­˜ï¼šå¯¹äºè€—æ—¶æ£€æŸ¥ï¼Œè€ƒè™‘ç¼“å­˜ç»“æœ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Healthæ£€æŸ¥æ˜¯åº”ç”¨çš„"ä½“æ£€ç³»ç»Ÿ"
- HealthIndicatoræ˜¯å„ç§"æ£€æŸ¥è®¾å¤‡"  
- çŠ¶æ€èšåˆéµå¾ª"ä»ä¸¥åŸåˆ™"
- åˆ†ç»„ç®¡ç†æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
- è‡ªå®šä¹‰æ‰©å±•è§£å†³ç‰¹æ®Šæ£€æŸ¥éœ€æ±‚