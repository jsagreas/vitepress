---
title: 8ã€è‡ªå®šä¹‰Metricsä¸ä¸šåŠ¡ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [Metricsç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-Metricsç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [è‡ªå®šä¹‰Metricsæ ¸å¿ƒç»„ä»¶](#2-è‡ªå®šä¹‰Metricsæ ¸å¿ƒç»„ä»¶)
3. [ä¸šåŠ¡æŒ‡æ ‡åŸ‹ç‚¹ç­–ç•¥](#3-ä¸šåŠ¡æŒ‡æ ‡åŸ‹ç‚¹ç­–ç•¥)
4. [Metricsæ ‡ç­¾è®¾è®¡ä¸èšåˆ](#4-Metricsæ ‡ç­¾è®¾è®¡ä¸èšåˆ)
5. [ä¸šåŠ¡å¤§ç›˜æ„å»º](#5-ä¸šåŠ¡å¤§ç›˜æ„å»º)
6. [å¼‚å¸¸æŒ‡æ ‡ç›‘æ§](#6-å¼‚å¸¸æŒ‡æ ‡ç›‘æ§)
7. [æœ€ä½³å®è·µæ€»ç»“](#7-æœ€ä½³å®è·µæ€»ç»“)

---

## 1. ğŸ“Š Metricsç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Metricsç›‘æ§


**ç®€å•ç†è§£**ï¼šMetricså°±åƒæ˜¯ç»™ä½ çš„åº”ç”¨è£…ä¸Š"ä»ªè¡¨ç›˜"ï¼Œå®æ—¶æ˜¾ç¤ºå„ç§è¿è¡Œæ•°æ®ã€‚

```
å°±åƒå¼€è½¦æ—¶çš„ä»ªè¡¨ç›˜ï¼š
ğŸš— é€Ÿåº¦è¡¨ â†’ åº”ç”¨çš„QPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰
â›½ æ²¹é‡è¡¨ â†’ å†…å­˜ä½¿ç”¨ç‡
ğŸŒ¡ï¸ æ°´æ¸©è¡¨ â†’ CPUä½¿ç”¨ç‡
âš ï¸ æ•…éšœç¯ â†’ é”™è¯¯ç‡å‘Šè­¦
```

**æ ¸å¿ƒä»·å€¼**ï¼š
- **å®æ—¶ç›‘æ§**ï¼šéšæ—¶çŸ¥é“ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- **é—®é¢˜é¢„è­¦**ï¼šåœ¨æ•…éšœå‘ç”Ÿå‰å°±å‘ç°å¼‚å¸¸
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ‰¾åˆ°ç³»ç»Ÿç“¶é¢ˆåœ¨å“ªé‡Œ
- **ä¸šåŠ¡æ´å¯Ÿ**ï¼šäº†è§£ç”¨æˆ·è¡Œä¸ºå’Œä¸šåŠ¡è¶‹åŠ¿

### 1.2 Spring Bootä¸­çš„ç›‘æ§ä½“ç³»


```
Spring Bootç›‘æ§æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    åº”ç”¨ä»£ç       â”‚â”€â”€â”€â”€â”‚   Micrometer     â”‚â”€â”€â”€â”€â”‚   ç›‘æ§ç³»ç»Ÿ       â”‚
â”‚                â”‚    â”‚   (æŒ‡æ ‡æ”¶é›†)      â”‚    â”‚  (Prometheus)   â”‚
â”‚  @Timed         â”‚    â”‚                 â”‚    â”‚                â”‚
â”‚  Counter.inc()  â”‚    â”‚   ç»Ÿä¸€APIæ¥å£    â”‚    â”‚   Grafana      â”‚
â”‚  Gauge.set()    â”‚    â”‚                 â”‚    â”‚   (å›¾è¡¨å±•ç¤º)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€šä¿—è§£é‡Š**ï¼š
- **åº”ç”¨ä»£ç **ï¼šä½ å†™çš„ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨å…³é”®åœ°æ–¹åŸ‹ç‚¹
- **Micrometer**ï¼šSpring Bootå†…ç½®çš„æŒ‡æ ‡æ”¶é›†å·¥å…·
- **ç›‘æ§ç³»ç»Ÿ**ï¼šæŠŠæ•°æ®å­˜å‚¨èµ·æ¥å¹¶ç”»æˆå›¾è¡¨

---

## 2. âš™ï¸ è‡ªå®šä¹‰Metricsæ ¸å¿ƒç»„ä»¶


### 2.1 Counterè®¡æ•°å™¨ - åªå¢ä¸å‡çš„æŒ‡æ ‡


**æ¦‚å¿µç†è§£**ï¼šCounterå°±åƒè®¡æ­¥å™¨ï¼Œåªèƒ½å¾€ä¸ŠåŠ ï¼Œä¸èƒ½å‡å°‘ã€‚

**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
ğŸ“ˆ ç”¨æˆ·è®¿é—®æ¬¡æ•°
ğŸ“ˆ è®¢å•åˆ›å»ºæ•°é‡  
ğŸ“ˆ æ¥å£è°ƒç”¨æ¬¡æ•°
ğŸ“ˆ é”™è¯¯å‘ç”Ÿæ¬¡æ•°
```

**ä»£ç å®ç°**ï¼š

```java
@RestController
public class OrderController {
    
    private final Counter orderCounter;
    private final Counter errorCounter;
    
    public OrderController(MeterRegistry meterRegistry) {
        // åˆ›å»ºè®¢å•è®¡æ•°å™¨
        this.orderCounter = Counter.builder("orders.created")
                .description("è®¢å•åˆ›å»ºæ€»æ•°")
                .tag("service", "order")
                .register(meterRegistry);
                
        // åˆ›å»ºé”™è¯¯è®¡æ•°å™¨        
        this.errorCounter = Counter.builder("orders.errors")
                .description("è®¢å•å¤„ç†é”™è¯¯æ•°")
                .tag("service", "order")
                .register(meterRegistry);
    }
    
    @PostMapping("/orders")
    public ResponseEntity<?> createOrder(@RequestBody OrderRequest request) {
        try {
            // ä¸šåŠ¡é€»è¾‘
            Order order = orderService.createOrder(request);
            
            // ğŸ”¥ å…³é”®ï¼šæˆåŠŸåè®¡æ•°å™¨+1
            orderCounter.increment();
            
            return ResponseEntity.ok(order);
        } catch (Exception e) {
            // ğŸ”¥ å…³é”®ï¼šå¤±è´¥æ—¶é”™è¯¯è®¡æ•°å™¨+1
            errorCounter.increment();
            throw e;
        }
    }
}
```

**ğŸ¯ æ ¸å¿ƒç†è§£**ï¼š
- `increment()`ï¼šè®¡æ•°å™¨+1ï¼Œæœ€å¸¸ç”¨
- `increment(3)`ï¼šè®¡æ•°å™¨+3ï¼Œæ‰¹é‡æ“ä½œæ—¶ä½¿ç”¨
- **åªå¢ä¸å‡**ï¼šCounteré‡å¯åä¼šå½’é›¶ï¼Œä½†è¿è¡ŒæœŸé—´åªèƒ½å¢åŠ 

### 2.2 Gaugeä»ªè¡¨ç›˜ - å®æ—¶æ³¢åŠ¨çš„æŒ‡æ ‡


**æ¦‚å¿µç†è§£**ï¼šGaugeåƒæ¸©åº¦è®¡ï¼Œæ•°å€¼å¯ä»¥ä¸Šå‡ä¹Ÿå¯ä»¥ä¸‹é™ã€‚

**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
ğŸ“Š å½“å‰åœ¨çº¿ç”¨æˆ·æ•°
ğŸ“Š é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†çš„ä»»åŠ¡æ•°
ğŸ“Š ç¼“å­˜å‘½ä¸­ç‡
ğŸ“Š å†…å­˜ä½¿ç”¨é‡
```

**ä»£ç å®ç°**ï¼š

```java
@Service
public class UserService {
    
    private final AtomicInteger onlineUsers = new AtomicInteger(0);
    private final Gauge onlineUsersGauge;
    
    public UserService(MeterRegistry meterRegistry) {
        // åˆ›å»ºåœ¨çº¿ç”¨æˆ·æ•°ä»ªè¡¨ç›˜
        this.onlineUsersGauge = Gauge.builder("users.online")
                .description("å½“å‰åœ¨çº¿ç”¨æˆ·æ•°")
                .tag("type", "realtime")
                .register(meterRegistry, onlineUsers, AtomicInteger::get);
    }
    
    public void userLogin(String userId) {
        // ç”¨æˆ·ç™»å½•ï¼Œåœ¨çº¿ç”¨æˆ·æ•°+1
        onlineUsers.incrementAndGet();
        
        // ğŸ”¥ Gaugeä¼šè‡ªåŠ¨è¯»å–onlineUsersçš„å€¼ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°
    }
    
    public void userLogout(String userId) {
        // ç”¨æˆ·é€€å‡ºï¼Œåœ¨çº¿ç”¨æˆ·æ•°-1
        onlineUsers.decrementAndGet();
    }
}
```

**é«˜çº§ç”¨æ³• - åŠ¨æ€è®¡ç®—**ï¼š

```java
@Component
public class CacheMetrics {
    
    @Autowired
    private CacheManager cacheManager;
    
    @PostConstruct
    public void initMetrics() {
        // ğŸ¯ åŠ¨æ€è®¡ç®—ç¼“å­˜å‘½ä¸­ç‡
        Gauge.builder("cache.hit.ratio")
                .description("ç¼“å­˜å‘½ä¸­ç‡")
                .tag("cache", "user")
                .register(meterRegistry, this, CacheMetrics::calculateHitRatio);
    }
    
    private double calculateHitRatio(CacheMetrics self) {
        Cache cache = cacheManager.getCache("user");
        if (cache instanceof CaffeineCacheManager.CaffeineCache) {
            com.github.benmanes.caffeine.cache.Cache<Object, Object> nativeCache = 
                ((CaffeineCacheManager.CaffeineCache) cache).getNativeCache();
                
            CacheStats stats = nativeCache.stats();
            return stats.hitRate(); // è¿”å›0.0-1.0ä¹‹é—´çš„å‘½ä¸­ç‡
        }
        return 0.0;
    }
}
```

### 2.3 Timerè®¡æ—¶å™¨ - æµ‹é‡è€—æ—¶å’Œé¢‘ç‡


**æ¦‚å¿µç†è§£**ï¼šTimeræ—¢æ˜¯ç§’è¡¨åˆæ˜¯è®¡æ•°å™¨ï¼Œèƒ½åŒæ—¶æµ‹é‡"å¤šä¹…"å’Œ"å¤šå°‘æ¬¡"ã€‚

**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
â±ï¸ æ¥å£å“åº”æ—¶é—´
â±ï¸ æ•°æ®åº“æŸ¥è¯¢è€—æ—¶
â±ï¸ å¤–éƒ¨APIè°ƒç”¨æ—¶é•¿
â±ï¸ ä¸šåŠ¡å¤„ç†æ—¶é—´
```

**ç®€å•ç”¨æ³•**ï¼š

```java
@Service
public class PaymentService {
    
    private final Timer paymentTimer;
    
    public PaymentService(MeterRegistry meterRegistry) {
        this.paymentTimer = Timer.builder("payment.process.time")
                .description("æ”¯ä»˜å¤„ç†æ—¶é—´")
                .tag("service", "payment")
                .register(meterRegistry);
    }
    
    public PaymentResult processPayment(PaymentRequest request) {
        // ğŸ”¥ æ–¹å¼1ï¼šä½¿ç”¨Timer.Sampleæ‰‹åŠ¨è®¡æ—¶
        Timer.Sample sample = Timer.start();
        
        try {
            // æ”¯ä»˜å¤„ç†é€»è¾‘
            PaymentResult result = doPayment(request);
            return result;
        } finally {
            // ç»“æŸè®¡æ—¶å¹¶è®°å½•
            sample.stop(paymentTimer);
        }
    }
    
    // ğŸ”¥ æ–¹å¼2ï¼šä½¿ç”¨æ³¨è§£è‡ªåŠ¨è®¡æ—¶
    @Timed(value = "payment.validation.time", description = "æ”¯ä»˜éªŒè¯æ—¶é—´")
    public boolean validatePayment(PaymentRequest request) {
        // éªŒè¯é€»è¾‘
        return true;
    }
}
```

**é«˜çº§ç”¨æ³• - è‡ªå®šä¹‰æ—¶é—´åˆ†å¸ƒ**ï¼š

```java
@Configuration
public class MetricsConfig {
    
    @Bean
    public TimerCustomizer timerCustomizer() {
        return Timer.builder()
                .minimumExpectedValue(Duration.ofMillis(1))      // æœ€å°æœŸæœ›å€¼1ms
                .maximumExpectedValue(Duration.ofSeconds(10))    // æœ€å¤§æœŸæœ›å€¼10s
                .distributionStatisticExpiry(Duration.ofMinutes(2))  // ç»Ÿè®¡è¿‡æœŸæ—¶é—´
                .distributionStatisticBufferLength(100);         // ç»Ÿè®¡ç¼“å†²åŒºå¤§å°
    }
}
```

---

## 3. ğŸ¯ ä¸šåŠ¡æŒ‡æ ‡åŸ‹ç‚¹ç­–ç•¥


### 3.1 å…³é”®ä¸šåŠ¡èŠ‚ç‚¹è¯†åˆ«


**ä»€ä¹ˆåœ°æ–¹éœ€è¦åŸ‹ç‚¹**ï¼š

```
ç”¨æˆ·è¡Œä¸ºé“¾è·¯ï¼š
æ³¨å†Œ â†’ ç™»å½• â†’ æµè§ˆå•†å“ â†’ åŠ è´­ç‰©è½¦ â†’ ä¸‹å• â†’ æ”¯ä»˜ â†’ è¯„ä»·

åŸ‹ç‚¹ä½ç½®ï¼š
ğŸ”¸ æ³¨å†Œè½¬åŒ–ç‡ï¼šè®¿é—®æ³¨å†Œé¡µ vs å®Œæˆæ³¨å†Œ
ğŸ”¸ ç™»å½•æˆåŠŸç‡ï¼šå°è¯•ç™»å½• vs ç™»å½•æˆåŠŸ  
ğŸ”¸ è´­ä¹°è½¬åŒ–ï¼šæµè§ˆå•†å“ vs ä¸‹å•æ”¯ä»˜
ğŸ”¸ æ”¯ä»˜æˆåŠŸç‡ï¼šå‘èµ·æ”¯ä»˜ vs æ”¯ä»˜å®Œæˆ
```

**æ ¸å¿ƒåŸåˆ™**ï¼š
- **ä¸šåŠ¡ä»·å€¼ä¼˜å…ˆ**ï¼šå…ˆåŸ‹å¯¹ä¸šåŠ¡æœ€é‡è¦çš„æŒ‡æ ‡
- **ç”¨æˆ·ä½“éªŒå…³æ³¨**ï¼šé‡ç‚¹ç›‘æ§å½±å“ç”¨æˆ·ä½“éªŒçš„ç¯èŠ‚
- **å¼‚å¸¸æƒ…å†µè¦†ç›–**ï¼šé”™è¯¯ã€è¶…æ—¶ã€å¤±è´¥éƒ½è¦æœ‰æŒ‡æ ‡

### 3.2 åŸ‹ç‚¹ç­–ç•¥è®¾è®¡


**åˆ†å±‚åŸ‹ç‚¹æ¶æ„**ï¼š

```
ä¸šåŠ¡åŸ‹ç‚¹åˆ†å±‚ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸šåŠ¡ç»“æœå±‚         â”‚  â† è®¢å•é‡‘é¢ã€ç”¨æˆ·å¢é•¿ã€è½¬åŒ–ç‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸šåŠ¡è¿‡ç¨‹å±‚         â”‚  â† æ¥å£è°ƒç”¨ã€åŠŸèƒ½ä½¿ç”¨ã€æ“ä½œæµç¨‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   æŠ€æœ¯æœåŠ¡å±‚         â”‚  â† å“åº”æ—¶é—´ã€æˆåŠŸç‡ã€é”™è¯¯ç‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åŸºç¡€èµ„æºå±‚         â”‚  â† CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ç¤ºä¾‹**ï¼š

```java
@Component
public class BusinessMetrics {
    
    private final MeterRegistry meterRegistry;
    
    // ä¸šåŠ¡ç»“æœå±‚æŒ‡æ ‡
    private final Counter orderAmountCounter;
    private final Counter newUserCounter;
    
    // ä¸šåŠ¡è¿‡ç¨‹å±‚æŒ‡æ ‡  
    private final Counter cartAddCounter;
    private final Timer checkoutTimer;
    
    public BusinessMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        
        // åˆå§‹åŒ–å„å±‚æŒ‡æ ‡
        this.orderAmountCounter = Counter.builder("business.order.amount")
                .description("è®¢å•æ€»é‡‘é¢")
                .baseUnit("yuan")
                .register(meterRegistry);
                
        this.newUserCounter = Counter.builder("business.user.new")
                .description("æ–°ç”¨æˆ·æ³¨å†Œæ•°")
                .register(meterRegistry);
    }
    
    // ğŸ”¥ ä¸šåŠ¡åŸ‹ç‚¹æ–¹æ³•
    public void recordOrderSuccess(BigDecimal amount, String channel) {
        orderAmountCounter.increment(amount.doubleValue());
        
        // å¸¦æ ‡ç­¾çš„ç»†åˆ†ç»Ÿè®¡
        Counter.builder("business.order.count")
                .tag("channel", channel)      // æ¸ é“æ ‡ç­¾
                .tag("result", "success")     // ç»“æœæ ‡ç­¾
                .register(meterRegistry)
                .increment();
    }
    
    public void recordUserRegistration(String source) {
        newUserCounter.increment();
        
        // æŒ‰æ¥æºç»Ÿè®¡
        Counter.builder("business.user.registration")
                .tag("source", source)        // æ¥æºï¼šapp/web/wechat
                .register(meterRegistry)
                .increment();
    }
}
```

### 3.3 åŸ‹ç‚¹æœ€ä½³å®è·µ


**ğŸ¯ åŸ‹ç‚¹è§„èŒƒ**ï¼š

| å±‚çº§ | æŒ‡æ ‡ç±»å‹ | å‘½åè§„èŒƒ | ç¤ºä¾‹ |
|------|---------|---------|------|
| **ä¸šåŠ¡ç»“æœ** | Counter/Gauge | `business.{domain}.{metric}` | `business.order.amount` |
| **ä¸šåŠ¡è¿‡ç¨‹** | Counter/Timer | `process.{action}.{metric}` | `process.checkout.time` |
| **æŠ€æœ¯æœåŠ¡** | Timer/Counter | `service.{name}.{metric}` | `service.payment.response_time` |
| **åŸºç¡€èµ„æº** | Gauge | `system.{resource}.{metric}` | `system.memory.usage` |

**ä»£ç å®ç°**ï¼š

```java
@Aspect
@Component
public class BusinessMetricsAspect {
    
    private final MeterRegistry meterRegistry;
    
    // ğŸ”¥ AOPè‡ªåŠ¨åŸ‹ç‚¹ - æ¨èæ–¹å¼
    @Around("@annotation(businessMetric)")
    public Object recordBusinessMetric(ProceedingJoinPoint joinPoint, BusinessMetric businessMetric) throws Throwable {
        
        Timer.Sample sample = Timer.start(meterRegistry);
        String metricName = businessMetric.value();
        String[] tags = businessMetric.tags();
        
        try {
            Object result = joinPoint.proceed();
            
            // æˆåŠŸåŸ‹ç‚¹
            sample.stop(Timer.builder(metricName + ".time")
                    .tag("result", "success")
                    .tags(tags)
                    .register(meterRegistry));
                    
            Counter.builder(metricName + ".count")
                    .tag("result", "success") 
                    .tags(tags)
                    .register(meterRegistry)
                    .increment();
                    
            return result;
            
        } catch (Exception e) {
            // å¤±è´¥åŸ‹ç‚¹
            sample.stop(Timer.builder(metricName + ".time")
                    .tag("result", "error")
                    .tag("error.type", e.getClass().getSimpleName())
                    .tags(tags)
                    .register(meterRegistry));
                    
            throw e;
        }
    }
}

// ä½¿ç”¨æ³¨è§£
@BusinessMetric(value = "business.order.create", tags = {"channel", "mobile"})
public Order createOrder(OrderRequest request) {
    // ä¸šåŠ¡é€»è¾‘
    return orderService.create(request);
}
```

---

## 4. ğŸ·ï¸ Metricsæ ‡ç­¾è®¾è®¡ä¸èšåˆ


### 4.1 æ ‡ç­¾è®¾è®¡åŸåˆ™


**ä»€ä¹ˆæ˜¯æ ‡ç­¾(Tags)**ï¼š
æ ‡ç­¾å°±åƒç»™æŒ‡æ ‡è´´ä¸Š"åˆ†ç±»æ ‡ç­¾"ï¼Œè®©ä½ èƒ½æŒ‰ä¸åŒç»´åº¦æŸ¥çœ‹æ•°æ®ã€‚

```
ä¸¾ä¾‹è¯´æ˜ï¼š
æŒ‡æ ‡åç§°ï¼šhttp_requests_total (HTTPè¯·æ±‚æ€»æ•°)

ä¸åŒæ ‡ç­¾ç»„åˆï¼š
http_requests_total{method="GET", status="200", endpoint="/api/users"}    = 1500
http_requests_total{method="POST", status="200", endpoint="/api/orders"}  = 800
http_requests_total{method="GET", status="500", endpoint="/api/users"}    = 50

è¿™æ ·å°±èƒ½æŒ‰æ–¹æ³•ã€çŠ¶æ€ç ã€æ¥å£åˆ†åˆ«ç»Ÿè®¡
```

**ğŸ¯ æ ‡ç­¾è®¾è®¡åŸåˆ™**ï¼š

```
âœ… æ¨èçš„æ ‡ç­¾è®¾è®¡ï¼š
- ç»´åº¦æ¸…æ™°ï¼šmethod, status, endpoint
- å€¼åŸŸæœ‰é™ï¼šstatusåªæœ‰å‡ ç§çŠ¶æ€ç 
- ä¸šåŠ¡æ„ä¹‰ï¼šèƒ½å¸®åŠ©å®šä½é—®é¢˜å’Œåˆ†æ

âŒ é¿å…çš„æ ‡ç­¾è®¾è®¡ï¼š  
- é«˜åŸºæ•°ï¼šuser_id (ç”¨æˆ·IDä¼šæœ‰ç™¾ä¸‡ä¸ªå€¼)
- æ— æ„ä¹‰ï¼štimestamp (æ—¶é—´æˆ³æ¯æ¬¡éƒ½ä¸åŒ)
- è¿‡äºç»†åŒ–ï¼šrequest_body_hash (è¯·æ±‚ä½“å“ˆå¸Œå€¼)
```

### 4.2 æ ‡ç­¾å®æˆ˜åº”ç”¨


**ç”µå•†ä¸šåŠ¡æ ‡ç­¾è®¾è®¡**ï¼š

```java
@Service
public class ECommerceMetrics {
    
    private final MeterRegistry meterRegistry;
    
    public void recordProductView(String productId, String category, String channel, String userType) {
        Counter.builder("product.view.count")
                .description("å•†å“æµè§ˆæ¬¡æ•°")
                // ğŸ”¥ åˆç†çš„æ ‡ç­¾è®¾è®¡
                .tag("category", category)        // å•†å“ç±»åˆ«ï¼šelectronics, clothing, books
                .tag("channel", channel)          // æ¸ é“ï¼šmobile, web, app  
                .tag("user_type", userType)       // ç”¨æˆ·ç±»å‹ï¼šnew, old, vip
                // âŒ ä¸è¦ç”¨productIdåšæ ‡ç­¾ï¼Œå› ä¸ºå•†å“IDå¤ªå¤š
                .register(meterRegistry)
                .increment();
    }
    
    public void recordOrderPayment(BigDecimal amount, String payMethod, String orderStatus) {
        // è®°å½•æ”¯ä»˜é‡‘é¢
        Counter.builder("payment.amount.total")
                .tag("method", payMethod)         // æ”¯ä»˜æ–¹å¼ï¼šalipay, wechat, card
                .tag("status", orderStatus)       // çŠ¶æ€ï¼šsuccess, failed, pending
                .baseUnit("yuan")
                .register(meterRegistry)
                .increment(amount.doubleValue());
                
        // è®°å½•æ”¯ä»˜æ¬¡æ•°        
        Counter.builder("payment.count")
                .tag("method", payMethod)
                .tag("status", orderStatus)
                .register(meterRegistry)
                .increment();
    }
}
```

### 4.3 æŒ‡æ ‡èšåˆä¸è®¡ç®—


**èšåˆæŸ¥è¯¢ç¤ºä¾‹**ï¼š

```
PrometheusæŸ¥è¯¢è¯­è¨€(PromQL)ç¤ºä¾‹ï¼š

# ğŸ”¥ æŒ‰æ”¯ä»˜æ–¹å¼ç»Ÿè®¡æˆåŠŸç‡
sum(payment_count{status="success"}) by (method) 
/ 
sum(payment_count) by (method) * 100

# ğŸ”¥ è®¡ç®—å„æ¸ é“çš„è½¬åŒ–ç‡  
sum(product_purchase_count) by (channel)
/
sum(product_view_count) by (channel) * 100

# ğŸ”¥ è®¡ç®—æ¥å£å¹³å‡å“åº”æ—¶é—´
sum(http_request_duration_seconds_sum) 
/ 
sum(http_request_duration_seconds_count)
```

**Spring Bootä¸­çš„èšåˆè®¡ç®—**ï¼š

```java
@Component
public class MetricsAggregator {
    
    private final MeterRegistry meterRegistry;
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡
    public void calculateBusinessMetrics() {
        
        // ğŸ”¥ è®¡ç®—å„æ¸ é“è½¬åŒ–ç‡
        Arrays.asList("mobile", "web", "app").forEach(channel -> {
            
            // è·å–æµè§ˆæ•°
            Counter viewCounter = meterRegistry.find("product.view.count")
                    .tag("channel", channel)
                    .counter();
                    
            // è·å–è´­ä¹°æ•°        
            Counter purchaseCounter = meterRegistry.find("product.purchase.count")
                    .tag("channel", channel)
                    .counter();
                    
            if (viewCounter != null && purchaseCounter != null) {
                double conversionRate = purchaseCounter.count() / viewCounter.count() * 100;
                
                // è®°å½•è½¬åŒ–ç‡æŒ‡æ ‡
                Gauge.builder("business.conversion.rate")
                        .tag("channel", channel)
                        .register(meterRegistry, this, x -> conversionRate);
            }
        });
    }
}
```

---

## 5. ğŸ“ˆ ä¸šåŠ¡å¤§ç›˜æ„å»º


### 5.1 å¤§ç›˜è®¾è®¡æ€è·¯


**ä¸šåŠ¡å¤§ç›˜å°±åƒé©¾é©¶èˆ±ä»ªè¡¨æ¿**ï¼Œè®©ä½ ä¸€çœ¼çœ‹æ¸…ä¸šåŠ¡è¿è¡ŒçŠ¶æ€ã€‚

```
ç”µå•†ä¸šåŠ¡å¤§ç›˜å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®æ—¶æ¦‚è§ˆ       â”‚    ç”¨æˆ·æŒ‡æ ‡      â”‚    è®¢å•æŒ‡æ ‡      â”‚
â”‚                â”‚                â”‚                â”‚  
â”‚ â€¢ åœ¨çº¿ç”¨æˆ·æ•°     â”‚ â€¢ æ–°æ³¨å†Œç”¨æˆ·     â”‚ â€¢ è®¢å•åˆ›å»ºæ•°     â”‚
â”‚ â€¢ å½“å‰QPS       â”‚ â€¢ æ´»è·ƒç”¨æˆ·æ•°     â”‚ â€¢ è®¢å•é‡‘é¢       â”‚
â”‚ â€¢ ç³»ç»Ÿå¥åº·åº¦     â”‚ â€¢ ç”¨æˆ·ç•™å­˜ç‡     â”‚ â€¢ æ”¯ä»˜æˆåŠŸç‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æŠ€æœ¯æŒ‡æ ‡       â”‚    å‘Šè­¦é¢æ¿      â”‚    è¶‹åŠ¿åˆ†æ      â”‚
â”‚                â”‚                â”‚                â”‚
â”‚ â€¢ æ¥å£å“åº”æ—¶é—´   â”‚ â€¢ æ´»è·ƒå‘Šè­¦       â”‚ â€¢ 7å¤©è®¢å•è¶‹åŠ¿    â”‚
â”‚ â€¢ é”™è¯¯ç‡        â”‚ â€¢ ç³»ç»Ÿå¼‚å¸¸       â”‚ â€¢ ç”¨æˆ·å¢é•¿è¶‹åŠ¿   â”‚  
â”‚ â€¢ èµ„æºä½¿ç”¨ç‡     â”‚ â€¢ ä¸šåŠ¡å¼‚å¸¸       â”‚ â€¢ æ”¶å…¥è¶‹åŠ¿       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒæŒ‡æ ‡å®šä¹‰


**ğŸ¯ ä¸šåŠ¡æ ¸å¿ƒæŒ‡æ ‡**ï¼š

```java
@Component
public class BusinessDashboardMetrics {
    
    // ğŸ“Š å®æ—¶æ¦‚è§ˆæŒ‡æ ‡
    @Bean
    public Gauge onlineUsersGauge(MeterRegistry registry) {
        return Gauge.builder("dashboard.users.online")
                .description("å½“å‰åœ¨çº¿ç”¨æˆ·æ•°")
                .register(registry, userService, UserService::getOnlineUserCount);
    }
    
    @Bean  
    public Gauge currentQpsGauge(MeterRegistry registry) {
        return Gauge.builder("dashboard.qps.current")
                .description("å½“å‰QPS")
                .register(registry, this, this::calculateCurrentQps);
    }
    
    // ğŸ“ˆ ä¸šåŠ¡è½¬åŒ–æ¼æ–—
    private final Counter[] funnelCounters;
    
    @PostConstruct
    public void initFunnelMetrics() {
        String[] funnelSteps = {"visit", "register", "browse", "cart", "order", "payment"};
        
        for (String step : funnelSteps) {
            Counter.builder("funnel." + step)
                    .description("è½¬åŒ–æ¼æ–—-" + step)
                    .register(meterRegistry);
        }
    }
    
    // ğŸ”¥ è®°å½•è½¬åŒ–æ¼æ–—å„æ­¥éª¤
    public void recordFunnelStep(String step, String channel) {
        Counter.builder("funnel." + step)
                .tag("channel", channel)
                .register(meterRegistry)
                .increment();
    }
}
```

### 5.3 å®æ—¶å¤§ç›˜å®ç°


**WebSocketå®æ—¶æ¨é€æŒ‡æ ‡**ï¼š

```java
@RestController
public class DashboardController {
    
    private final SimpMessagingTemplate messagingTemplate;
    private final MeterRegistry meterRegistry;
    
    @Scheduled(fixedRate = 5000) // æ¯5ç§’æ¨é€ä¸€æ¬¡
    public void pushDashboardMetrics() {
        
        DashboardData dashboard = DashboardData.builder()
                .timestamp(Instant.now())
                .onlineUsers(getMetricValue("dashboard.users.online"))
                .currentQps(getMetricValue("dashboard.qps.current"))
                .orderCount(getMetricValue("business.order.count"))
                .orderAmount(getMetricValue("business.order.amount"))
                .errorRate(calculateErrorRate())
                .build();
                
        // ğŸ”¥ æ¨é€åˆ°å‰ç«¯
        messagingTemplate.convertAndSend("/topic/dashboard", dashboard);
    }
    
    private double getMetricValue(String metricName) {
        Gauge gauge = meterRegistry.find(metricName).gauge();
        return gauge != null ? gauge.value() : 0.0;
    }
    
    private double calculateErrorRate() {
        Counter totalCounter = meterRegistry.find("http.requests").counter();
        Counter errorCounter = meterRegistry.find("http.requests")
                .tag("status", "5xx").counter();
                
        if (totalCounter != null && errorCounter != null && totalCounter.count() > 0) {
            return errorCounter.count() / totalCounter.count() * 100;
        }
        return 0.0;
    }
}
```

---

## 6. âš ï¸ å¼‚å¸¸æŒ‡æ ‡ç›‘æ§


### 6.1 å¼‚å¸¸ç›‘æ§ç­–ç•¥


**å¼‚å¸¸ç›‘æ§å°±åƒå¥åº·ä½“æ£€**ï¼Œè¦èƒ½åŠæ—¶å‘ç°"èº«ä½“"çš„å„ç§é—®é¢˜ã€‚

**ğŸ”¥ æ ¸å¿ƒå¼‚å¸¸æŒ‡æ ‡**ï¼š

```
ç³»ç»Ÿå¼‚å¸¸ï¼š
â€¢ æ¥å£å“åº”æ—¶é—´çªç„¶å˜æ…¢
â€¢ é”™è¯¯ç‡çªç„¶å‡é«˜  
â€¢ å†…å­˜ä½¿ç”¨ç‡å¼‚å¸¸
â€¢ æ•°æ®åº“è¿æ¥æ± è€—å°½

ä¸šåŠ¡å¼‚å¸¸ï¼š
â€¢ è®¢å•è½¬åŒ–ç‡ä¸‹é™
â€¢ æ”¯ä»˜æˆåŠŸç‡é™ä½
â€¢ ç”¨æˆ·æ´»è·ƒåº¦å¼‚å¸¸
â€¢ å…³é”®ä¸šåŠ¡æµç¨‹ä¸­æ–­
```

### 6.2 å¼‚å¸¸æ£€æµ‹å®ç°


**åŸºäºé˜ˆå€¼çš„å¼‚å¸¸æ£€æµ‹**ï¼š

```java
@Component
public class AnomalyDetector {
    
    private final MeterRegistry meterRegistry;
    private final AlertService alertService;
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æµ‹ä¸€æ¬¡
    public void detectAnomalies() {
        
        // ğŸ”¥ æ£€æµ‹é”™è¯¯ç‡å¼‚å¸¸
        checkErrorRateAnomaly();
        
        // ğŸ”¥ æ£€æµ‹å“åº”æ—¶é—´å¼‚å¸¸  
        checkResponseTimeAnomaly();
        
        // ğŸ”¥ æ£€æµ‹ä¸šåŠ¡æŒ‡æ ‡å¼‚å¸¸
        checkBusinessMetricAnomaly();
    }
    
    private void checkErrorRateAnomaly() {
        double errorRate = calculateErrorRate();
        
        if (errorRate > 5.0) { // é”™è¯¯ç‡è¶…è¿‡5%
            AlertInfo alert = AlertInfo.builder()
                    .level(errorRate > 10 ? "CRITICAL" : "WARNING")
                    .title("æ¥å£é”™è¯¯ç‡å¼‚å¸¸")
                    .message("å½“å‰é”™è¯¯ç‡: " + String.format("%.2f%%", errorRate))
                    .timestamp(Instant.now())
                    .build();
                    
            alertService.sendAlert(alert);
            
            // è®°å½•å¼‚å¸¸äº‹ä»¶
            Counter.builder("anomaly.error_rate.triggered")
                    .tag("level", alert.getLevel())
                    .register(meterRegistry)
                    .increment();
        }
    }
    
    private void checkResponseTimeAnomaly() {
        Timer responseTimer = meterRegistry.find("http.server.requests").timer();
        
        if (responseTimer != null) {
            double avgResponseTime = responseTimer.mean(TimeUnit.MILLISECONDS);
            
            if (avgResponseTime > 1000) { // å¹³å‡å“åº”æ—¶é—´è¶…è¿‡1ç§’
                AlertInfo alert = AlertInfo.builder()
                        .level("WARNING")
                        .title("æ¥å£å“åº”æ—¶é—´å¼‚å¸¸")
                        .message("å¹³å‡å“åº”æ—¶é—´: " + String.format("%.0fms", avgResponseTime))
                        .build();
                        
                alertService.sendAlert(alert);
            }
        }
    }
}
```

### 6.3 è‡ªé€‚åº”é˜ˆå€¼ç›‘æ§


**åŸºäºå†å²æ•°æ®çš„åŠ¨æ€é˜ˆå€¼**ï¼š

```java
@Service
public class AdaptiveThresholdMonitor {
    
    // ğŸ”¥ æ»‘åŠ¨çª—å£è®°å½•å†å²æ•°æ®
    private final Map<String, CircularFifoQueue<Double>> historicalData = new ConcurrentHashMap<>();
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿè®°å½•ä¸€æ¬¡
    public void recordHistoricalData() {
        // è®°å½•å½“å‰æŒ‡æ ‡å€¼
        double currentQps = getCurrentQps();
        double currentErrorRate = getCurrentErrorRate();
        double currentResponseTime = getCurrentResponseTime();
        
        // ä¿å­˜åˆ°æ»‘åŠ¨çª—å£ï¼ˆä¿ç•™æœ€è¿‘100ä¸ªæ•°æ®ç‚¹ï¼‰
        addToHistory("qps", currentQps);
        addToHistory("error_rate", currentErrorRate);
        addToHistory("response_time", currentResponseTime);
    }
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡
    public void detectAnomaliesWithAdaptiveThreshold() {
        
        // ğŸ”¥ åŸºäºå†å²æ•°æ®è®¡ç®—åŠ¨æ€é˜ˆå€¼
        double qpsThreshold = calculateDynamicThreshold("qps", 2.0); // 2å€æ ‡å‡†å·®
        double currentQps = getCurrentQps();
        
        if (Math.abs(currentQps - getHistoryAverage("qps")) > qpsThreshold) {
            // QPSå¼‚å¸¸
            alertService.sendAlert("QPSå¼‚å¸¸æ³¢åŠ¨", 
                    "å½“å‰QPS: " + currentQps + ", é¢„æœŸèŒƒå›´: " + qpsThreshold);
        }
    }
    
    private double calculateDynamicThreshold(String metric, double sigma) {
        Queue<Double> history = historicalData.get(metric);
        if (history == null || history.size() < 10) {
            return Double.MAX_VALUE; // æ•°æ®ä¸è¶³ï¼Œä¸è§¦å‘å‘Šè­¦
        }
        
        // è®¡ç®—æ ‡å‡†å·®
        double mean = history.stream().mapToDouble(Double::doubleValue).average().orElse(0);
        double variance = history.stream()
                .mapToDouble(value -> Math.pow(value - mean, 2))
                .average().orElse(0);
        
        return sigma * Math.sqrt(variance);
    }
}
```

---

## 7. ğŸ“‹ æœ€ä½³å®è·µæ€»ç»“


### 7.1 æŒ‡æ ‡è®¾è®¡æœ€ä½³å®è·µ


**ğŸ¯ DO's - æ¨èåšæ³•**ï¼š

```
âœ… æŒ‡æ ‡å‘½åè¦æ¸…æ™°
æ¨èï¼šuser.login.success.count
é¿å…ï¼šmetric1, data, info

âœ… åˆç†ä½¿ç”¨æ ‡ç­¾
æ¨èï¼šhttp.requests{method="POST", status="200"}  
é¿å…ï¼šhttp.requests{user_id="12345", request_id="abc"}

âœ… é€‰æ‹©åˆé€‚çš„æŒ‡æ ‡ç±»å‹
â€¢ ç´¯è®¡æ•°æ®ç”¨Counterï¼šè®¢å•æ€»æ•°ã€é”™è¯¯æ€»æ•°
â€¢ æ³¢åŠ¨æ•°æ®ç”¨Gaugeï¼šåœ¨çº¿ç”¨æˆ·ã€é˜Ÿåˆ—é•¿åº¦  
â€¢ æ—¶é•¿æ•°æ®ç”¨Timerï¼šæ¥å£å“åº”æ—¶é—´ã€å¤„ç†æ—¶é•¿

âœ… è®¾ç½®åˆç†çš„é‡‡é›†é¢‘ç‡
â€¢ é«˜é¢‘æŒ‡æ ‡ï¼šæ¯ç§’é‡‡é›†ï¼ˆQPSã€é”™è¯¯ç‡ï¼‰
â€¢ ä¸­é¢‘æŒ‡æ ‡ï¼šæ¯åˆ†é’Ÿé‡‡é›†ï¼ˆä¸šåŠ¡æŒ‡æ ‡ï¼‰
â€¢ ä½é¢‘æŒ‡æ ‡ï¼šæ¯å°æ—¶é‡‡é›†ï¼ˆç»Ÿè®¡æŠ¥è¡¨ï¼‰
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**é¿å…é«˜åŸºæ•°é—®é¢˜**ï¼š

```java
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šç”¨æˆ·IDåšæ ‡ç­¾ä¼šäº§ç”Ÿç™¾ä¸‡çº§åˆ«çš„æ—¶é—´åºåˆ—
Counter.builder("user.action")
        .tag("user_id", userId)     // é«˜åŸºæ•°æ ‡ç­¾
        .tag("action_id", actionId) // é«˜åŸºæ•°æ ‡ç­¾
        .register(registry)
        .increment();

// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨ä½åŸºæ•°çš„åˆ†ç±»æ ‡ç­¾
Counter.builder("user.action") 
        .tag("user_type", "vip")    // ä½åŸºæ•°ï¼švip, normal, new
        .tag("action_type", "view") // ä½åŸºæ•°ï¼šview, click, share
        .register(registry)
        .increment();
```

**æŒ‡æ ‡èšåˆä¼˜åŒ–**ï¼š

```java
@Configuration
public class MetricsOptimizationConfig {
    
    // ğŸ”¥ é…ç½®æŒ‡æ ‡è¿‡æœŸæ—¶é—´ï¼Œé¿å…å†…å­˜æ³„æ¼
    @Bean
    public MeterRegistryCustomizer<PrometheusMeterRegistry> configurePrometheusRegistry() {
        return registry -> {
            registry.config()
                    .meterFilter(MeterFilter.maximumAllowableMetrics(10000))  // é™åˆ¶æŒ‡æ ‡æ•°é‡
                    .meterFilter(MeterFilter.denyNameStartsWith("jvm.gc.concurrent")) // è¿‡æ»¤ä¸éœ€è¦çš„æŒ‡æ ‡
                    .commonTags("application", "my-service", "version", "1.0.0");     // å…¬å…±æ ‡ç­¾
        };
    }
    
    // ğŸ”¥ é…ç½®ç›´æ–¹å›¾åˆ†ä½æ•°
    @Bean
    public TimerCustomizer timerCustomizer() {
        return Timer.builder()
                .publishPercentiles(0.5, 0.9, 0.95, 0.99)           // å‘å¸ƒåˆ†ä½æ•°  
                .publishPercentileHistogram(false)                   // ä¸å‘å¸ƒç›´æ–¹å›¾
                .distributionStatisticExpiry(Duration.ofMinutes(5))  // ç»Ÿè®¡è¿‡æœŸæ—¶é—´
                .minimumExpectedValue(Duration.ofMillis(1))          // æœ€å°æœŸæœ›å€¼
                .maximumExpectedValue(Duration.ofSeconds(30));       // æœ€å¤§æœŸæœ›å€¼
    }
}
```

### 7.3 ç›‘æ§è¿ç»´å»ºè®®


**ğŸ”¥ æ ¸å¿ƒè¦ç‚¹**ï¼š

| ç›‘æ§å±‚é¢ | **å…³é”®æŒ‡æ ‡** | **å‘Šè­¦é˜ˆå€¼** | **å¤„ç†ç­–ç•¥** |
|---------|------------|-------------|-------------|
| **ç³»ç»Ÿå¥åº·** | `é”™è¯¯ç‡ã€å“åº”æ—¶é—´ã€èµ„æºä½¿ç”¨` | `é”™è¯¯ç‡>5%ã€å“åº”æ—¶é—´>2s` | `ç«‹å³æ’æŸ¥ï¼Œå¿…è¦æ—¶é™æµ` |
| **ä¸šåŠ¡æ ¸å¿ƒ** | `è®¢å•é‡ã€æ”¯ä»˜æˆåŠŸç‡ã€è½¬åŒ–ç‡` | `åŒæ¯”ä¸‹é™>20%` | `ä¸šåŠ¡å›¢é˜Ÿä»‹å…¥åˆ†æ` | 
| **ç”¨æˆ·ä½“éªŒ** | `é¡µé¢åŠ è½½æ—¶é—´ã€æ¥å£å¯ç”¨æ€§` | `åŠ è½½æ—¶é—´>3sã€å¯ç”¨æ€§<99%` | `ä¼˜åŒ–æ€§èƒ½ï¼Œæ‰©å®¹æœåŠ¡` |

**ç›‘æ§å‘Šè­¦åˆ†çº§**ï¼š

```java
public enum AlertLevel {
    INFO("ä¿¡æ¯", "è“è‰²", "ç¾¤æ¶ˆæ¯é€šçŸ¥"),
    WARNING("è­¦å‘Š", "é»„è‰²", "é‚®ä»¶+ç¾¤æ¶ˆæ¯"),  
    CRITICAL("ä¸¥é‡", "çº¢è‰²", "ç”µè¯+é‚®ä»¶+ç¾¤æ¶ˆæ¯");
    
    private final String name;
    private final String color; 
    private final String notifyMethod;
}

@Service
public class AlertService {
    
    public void sendAlert(String metric, double value, AlertLevel level) {
        AlertMessage alert = AlertMessage.builder()
                .title("[" + level.getName() + "] " + metric + "å¼‚å¸¸")
                .content("å½“å‰å€¼: " + value)
                .level(level)
                .timestamp(Instant.now())
                .build();
                
        switch (level) {
            case CRITICAL:
                // ä¸¥é‡å‘Šè­¦ï¼šç”µè¯é€šçŸ¥
                phoneNotificationService.call(alert);
            case WARNING:  
                // è­¦å‘Šï¼šé‚®ä»¶é€šçŸ¥
                emailService.sendAlert(alert);
            case INFO:
            default:
                // ä¿¡æ¯ï¼šç¾¤æ¶ˆæ¯
                slackService.sendMessage(alert);
        }
    }
}
```

### 7.4 æ€»ç»“è¦ç‚¹


**ğŸ¯ å…³é”®è®°å¿†ç‚¹**ï¼š

```
ğŸ“Š æŒ‡æ ‡ç±»å‹é€‰æ‹©ï¼š
â€¢ Counterï¼šåªå¢ä¸å‡çš„ç´¯è®¡å€¼ï¼ˆè®¢å•æ•°ã€è®¿é—®æ•°ï¼‰
â€¢ Gaugeï¼šå®æ—¶æ³¢åŠ¨çš„ç¬æ—¶å€¼ï¼ˆåœ¨çº¿äººæ•°ã€é˜Ÿåˆ—é•¿åº¦ï¼‰  
â€¢ Timerï¼šæ—¶é—´å’Œé¢‘ç‡å¹¶é‡ï¼ˆå“åº”æ—¶é—´ã€è°ƒç”¨æ¬¡æ•°ï¼‰

ğŸ·ï¸ æ ‡ç­¾è®¾è®¡åŸåˆ™ï¼š
â€¢ ä½åŸºæ•°ï¼šæ ‡ç­¾å€¼çš„ç§ç±»è¦å°‘ï¼ˆ<100ç§ï¼‰
â€¢ æœ‰æ„ä¹‰ï¼šæ ‡ç­¾è¦å¯¹ä¸šåŠ¡åˆ†ææœ‰å¸®åŠ©
â€¢ å±‚æ¬¡åŒ–ï¼šæŒ‰é‡è¦æ€§è®¾è®¡æ ‡ç­¾å±‚æ¬¡

âš ï¸ å¼‚å¸¸ç›‘æ§ç­–ç•¥ï¼š
â€¢ é˜ˆå€¼ç›‘æ§ï¼šå›ºå®šé˜ˆå€¼ï¼Œé€‚åˆå·²çŸ¥æŒ‡æ ‡
â€¢ è¶‹åŠ¿ç›‘æ§ï¼šåŸºäºå†å²æ•°æ®ï¼Œé€‚åˆæ³¢åŠ¨æŒ‡æ ‡  
â€¢ ä¸šåŠ¡ç›‘æ§ï¼šç»“åˆä¸šåŠ¡é€»è¾‘çš„ç»¼åˆåˆ¤æ–­

ğŸ¯ æœ€ä½³å®è·µï¼š
â€¢ å…ˆè®¾è®¡æ ¸å¿ƒæŒ‡æ ‡ï¼Œå†é€æ­¥å®Œå–„
â€¢ é‡è§†ä¸šåŠ¡æŒ‡æ ‡ï¼Œä¸åªçœ‹æŠ€æœ¯æŒ‡æ ‡
â€¢ å‘Šè­¦è¦åˆ†çº§ï¼Œé¿å…å‘Šè­¦ç–²åŠ³
â€¢ å®šæœŸå›é¡¾å’Œä¼˜åŒ–ç›‘æ§ç­–ç•¥
```