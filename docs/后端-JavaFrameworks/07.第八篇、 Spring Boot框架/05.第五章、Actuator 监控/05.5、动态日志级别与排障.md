---
title: 5ã€åŠ¨æ€æ—¥å¿—çº§åˆ«ä¸æ’éšœ
---
## ğŸ“š ç›®å½•

1. [Actuatorç›‘æ§æ¦‚è¿°](#1-actuatorç›‘æ§æ¦‚è¿°)
2. [loggersç«¯ç‚¹è¯¦è§£](#2-loggersç«¯ç‚¹è¯¦è§£)
3. [åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«](#3-åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«)
4. [ç”Ÿäº§ç¯å¢ƒæ’éšœæŠ€å·§](#4-ç”Ÿäº§ç¯å¢ƒæ’éšœæŠ€å·§)
5. [æ—¥å¿—çº§åˆ«ç®¡ç†ç­–ç•¥](#5-æ—¥å¿—çº§åˆ«ç®¡ç†ç­–ç•¥)
6. [æ“ä½œå®¡è®¡ä¸å®‰å…¨](#6-æ“ä½œå®¡è®¡ä¸å®‰å…¨)
7. [æ—¥å¿—èšåˆåˆ†æ](#7-æ—¥å¿—èšåˆåˆ†æ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Actuatorç›‘æ§æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Spring Boot Actuator


**ç®€å•ç†è§£**ï¼šActuatorå°±åƒæ˜¯ç»™ä½ çš„Spring Bootåº”ç”¨è£…äº†ä¸€ä¸ª"ä½“æ£€ä»ª"ï¼Œå¯ä»¥éšæ—¶æŸ¥çœ‹åº”ç”¨çš„å¥åº·çŠ¶å†µã€‚

```
æ¯”å¦‚åŒ»ç”Ÿçœ‹ç—…ï¼š
ğŸ‘©â€âš•ï¸ åŒ»ç”Ÿéœ€è¦ï¼šæµ‹ä½“æ¸©ã€é‡è¡€å‹ã€æŸ¥å¿ƒç‡
ğŸ”§ Actuatoræä¾›ï¼šæŸ¥å†…å­˜ã€çœ‹æ—¥å¿—ã€æµ‹æ€§èƒ½

éƒ½æ˜¯ä¸ºäº†äº†è§£"èº«ä½“çŠ¶å†µ"ï¼
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **å¥åº·æ£€æŸ¥** - åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
- **æ€§èƒ½ç›‘æ§** - CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ
- **é…ç½®æŸ¥çœ‹** - å½“å‰ç”Ÿæ•ˆçš„é…ç½®ä¿¡æ¯
- **æ—¥å¿—ç®¡ç†** - åŠ¨æ€è°ƒæ•´æ—¥å¿—è¾“å‡ºçº§åˆ«

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§


**ç”Ÿäº§ç¯å¢ƒçš„ç°å®é—®é¢˜**ï¼š
```
æƒ…å†µ1ï¼šç”¨æˆ·åé¦ˆç³»ç»Ÿæ…¢äº† ğŸŒ
â””â”€â”€ éœ€è¦æŸ¥çœ‹ï¼šå†…å­˜æ˜¯å¦ä¸å¤Ÿï¼Ÿæ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Ÿ

æƒ…å†µ2ï¼šæŸä¸ªåŠŸèƒ½çªç„¶ä¸å·¥ä½œäº† âŒ
â””â”€â”€ éœ€è¦æŸ¥çœ‹ï¼šæ—¥å¿—é‡Œæœ‰ä»€ä¹ˆé”™è¯¯ä¿¡æ¯ï¼Ÿ

æƒ…å†µ3ï¼šç³»ç»Ÿèµ„æºä½¿ç”¨å¼‚å¸¸ ğŸ“Š
â””â”€â”€ éœ€è¦æŸ¥çœ‹ï¼šå“ªä¸ªæ¨¡å—å ç”¨èµ„æºæœ€å¤šï¼Ÿ
```

**ç›‘æ§çš„ä»·å€¼**ï¼š
- **é¢„é˜²é—®é¢˜** - æå‰å‘ç°æ½œåœ¨é£é™©
- **å¿«é€Ÿå®šä½** - é—®é¢˜å‘ç”Ÿæ—¶è¿…é€Ÿæ‰¾åˆ°åŸå› 
- **æ€§èƒ½ä¼˜åŒ–** - åŸºäºæ•°æ®è¿›è¡Œç³»ç»Ÿè°ƒä¼˜

---

## 2. ğŸ“ loggersç«¯ç‚¹è¯¦è§£


### 2.1 loggersç«¯ç‚¹æ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šloggersç«¯ç‚¹å°±åƒæ˜¯åº”ç”¨çš„"æ—¥å¿—æ§åˆ¶å°"ï¼Œå¯ä»¥æŸ¥çœ‹å’Œè°ƒæ•´å„ä¸ªæ¨¡å—çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ã€‚

```
æ—¥å¿—çº§åˆ«å°±åƒéŸ³é‡è°ƒèŠ‚ï¼š
ğŸ”‡ OFF    = é™éŸ³ï¼ˆä¸è¾“å‡ºä»»ä½•æ—¥å¿—ï¼‰
ğŸ”ˆ ERROR  = åªè¾“å‡ºé”™è¯¯ä¿¡æ¯
ğŸ”‰ WARN   = è¾“å‡ºè­¦å‘Šå’Œé”™è¯¯
ğŸ”Š INFO   = è¾“å‡ºä¸€èˆ¬ä¿¡æ¯ã€è­¦å‘Šã€é”™è¯¯
ğŸ“¢ DEBUG  = è¾“å‡ºè°ƒè¯•ä¿¡æ¯å’Œä»¥ä¸Šæ‰€æœ‰
ğŸ“£ TRACE  = è¾“å‡ºæœ€è¯¦ç»†çš„è·Ÿè¸ªä¿¡æ¯
```

### 2.2 å¯ç”¨loggersç«¯ç‚¹


**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®æš´éœ²ç«¯ç‚¹**
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: loggers  # æš´éœ²loggersç«¯ç‚¹
  endpoint:
    loggers:
      enabled: true      # å¯ç”¨loggersç«¯ç‚¹
```

### 2.3 è®¿é—®loggersç«¯ç‚¹


**æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—é…ç½®**ï¼š
```
GET http://localhost:8080/actuator/loggers
```

**è¿”å›ç»“æœç¤ºä¾‹**ï¼š
```json
{
  "levels": ["OFF", "FATAL", "ERROR", "WARN", "INFO", "DEBUG", "TRACE"],
  "loggers": {
    "ROOT": {
      "configuredLevel": "INFO",
      "effectiveLevel": "INFO"
    },
    "com.example.service": {
      "configuredLevel": null,
      "effectiveLevel": "INFO"
    },
    "org.springframework": {
      "configuredLevel": "WARN",
      "effectiveLevel": "WARN"
    }
  }
}
```

**å­—æ®µå«ä¹‰**ï¼š
- **configuredLevel** - æ˜ç¡®é…ç½®çš„æ—¥å¿—çº§åˆ«
- **effectiveLevel** - å®é™…ç”Ÿæ•ˆçš„æ—¥å¿—çº§åˆ«
- **null** - è¡¨ç¤ºç»§æ‰¿çˆ¶çº§åˆ«é…ç½®

---

## 3. âš¡ åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«


### 3.1 ä¸ºä»€ä¹ˆè¦åŠ¨æ€è°ƒæ•´


**ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜**ï¼š
```
é—®é¢˜åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒå‡ºç°bugï¼Œéœ€è¦æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

ä¼ ç»Ÿåšæ³•ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶ ğŸ“
2. é‡å¯åº”ç”¨ ğŸ”„
3. ç”¨æˆ·æœåŠ¡ä¸­æ–­ âŒ
4. é‡æ–°éƒ¨ç½² ğŸš€

ç»“æœï¼šç”¨æˆ·ä½“éªŒå·®ï¼Œæ’æŸ¥å‘¨æœŸé•¿
```

**åŠ¨æ€è°ƒæ•´çš„å¥½å¤„**ï¼š
```
ç°ä»£åšæ³•ï¼š
1. é€šè¿‡APIè°ƒæ•´æ—¥å¿—çº§åˆ« ğŸ“¡
2. ç«‹å³ç”Ÿæ•ˆ âš¡
3. æ— éœ€é‡å¯ âœ…
4. é—®é¢˜è§£å†³åç«‹å³è°ƒå› ğŸ”„

ç»“æœï¼šé›¶åœæœºæ’éšœï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
```

### 3.2 åŠ¨æ€è°ƒæ•´å®æˆ˜æ“ä½œ


**æŸ¥çœ‹ç‰¹å®šåŒ…çš„æ—¥å¿—çº§åˆ«**ï¼š
```bash
curl http://localhost:8080/actuator/loggers/com.example.service
```

**è°ƒæ•´æ—¥å¿—çº§åˆ«ä¸ºDEBUG**ï¼š
```bash
curl -X POST \
  http://localhost:8080/actuator/loggers/com.example.service \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"DEBUG"}'
```

**é‡ç½®æ—¥å¿—çº§åˆ«ï¼ˆæ¢å¤é»˜è®¤ï¼‰**ï¼š
```bash
curl -X POST \
  http://localhost:8080/actuator/loggers/com.example.service \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":null}'
```

### 3.3 Javaä»£ç æ–¹å¼è°ƒæ•´


```java
@RestController
@RequestMapping("/admin/logs")
public class LoggerController {
    
    @Autowired
    private LoggingSystem loggingSystem;
    
    // åŠ¨æ€è®¾ç½®æ—¥å¿—çº§åˆ«
    @PostMapping("/level/{loggerName}/{level}")
    public String setLogLevel(
            @PathVariable String loggerName,
            @PathVariable String level) {
        
        // å°†ç‚¹å·æ›¿æ¢ä¸ºå®é™…çš„åŒ…è·¯å¾„
        String actualLoggerName = loggerName.replace("-", ".");
        
        try {
            LogLevel logLevel = LogLevel.valueOf(level.toUpperCase());
            loggingSystem.setLogLevel(actualLoggerName, logLevel);
            return "æ—¥å¿—çº§åˆ«å·²è®¾ç½®ï¼š" + actualLoggerName + " -> " + level;
        } catch (Exception e) {
            return "è®¾ç½®å¤±è´¥ï¼š" + e.getMessage();
        }
    }
    
    // è·å–å½“å‰æ—¥å¿—çº§åˆ«
    @GetMapping("/level/{loggerName}")
    public String getLogLevel(@PathVariable String loggerName) {
        String actualLoggerName = loggerName.replace("-", ".");
        LogLevel level = loggingSystem.getLoggerConfiguration(actualLoggerName)
                .getEffectiveLevel();
        return actualLoggerName + " å½“å‰çº§åˆ«ï¼š" + level;
    }
}
```

---

## 4. ğŸ› ï¸ ç”Ÿäº§ç¯å¢ƒæ’éšœæŠ€å·§


### 4.1 æ’éšœæ€è·¯å’Œç­–ç•¥


**æ’éšœé‡‘å­—å¡”**ï¼š
```
    ğŸ” ç²¾ç¡®å®šä½
   ï¼            ï¼¼
  ğŸ“Š æ•°æ®æ”¶é›†      ğŸ¯ é—®é¢˜é‡ç°
 ï¼                          ï¼¼
ğŸš¨ é—®é¢˜å‘ç° â†â†’ ğŸ“ æ—¥å¿—åˆ†æ â†â†’ âš¡ å¿«é€Ÿæ¢å¤
```

### 4.2 å¸¸è§æ’éšœåœºæ™¯


**åœºæ™¯1ï¼šæ¥å£å“åº”æ…¢**
```yaml
# æ’éšœæ­¥éª¤ï¼š
1. è°ƒæ•´ç›¸å…³æœåŠ¡æ—¥å¿—çº§åˆ«åˆ°DEBUG
2. è§‚å¯ŸSQLæ‰§è¡Œæ—¶é—´å’Œæ•°æ®åº“è¿æ¥
3. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
4. åˆ†æä¸šåŠ¡é€»è¾‘æ‰§è¡Œè·¯å¾„
```

**å®é™…æ“ä½œ**ï¼š
```bash
# 1. å¼€å¯æ•°æ®åº“ç›¸å…³DEBUGæ—¥å¿—
curl -X POST http://localhost:8080/actuator/loggers/org.hibernate.SQL \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"DEBUG"}'

# 2. å¼€å¯è‡ªå·±ä¸šåŠ¡åŒ…çš„DEBUGæ—¥å¿—
curl -X POST http://localhost:8080/actuator/loggers/com.example.service \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"DEBUG"}'

# 3. é‡ç°é—®é¢˜ï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡º

# 4. é—®é¢˜è§£å†³åï¼Œæ¢å¤æ—¥å¿—çº§åˆ«
curl -X POST http://localhost:8080/actuator/loggers/org.hibernate.SQL \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"WARN"}'
```

**åœºæ™¯2ï¼šå¼‚å¸¸é”™è¯¯æ’æŸ¥**
```yaml
# æ’éšœç­–ç•¥ï¼š
1. å…ˆæŸ¥çœ‹ERRORçº§åˆ«æ—¥å¿—ï¼Œäº†è§£å¼‚å¸¸å †æ ˆ
2. å¦‚æœä¿¡æ¯ä¸å¤Ÿï¼Œä¸´æ—¶å¼€å¯DEBUG
3. å…³æ³¨å¼‚å¸¸å‘ç”Ÿçš„æ—¶é—´ç‚¹å’Œé¢‘ç‡
4. æ£€æŸ¥ç›¸å…³ç»„ä»¶çš„å¥åº·çŠ¶æ€
```

### 4.3 æ’éšœæœ€ä½³å®è·µ


**ğŸ“‹ æ’éšœæ£€æŸ¥æ¸…å•**ï¼š

| æ£€æŸ¥é¡¹ç›® | æ“ä½œæ–¹æ³• | é¢„æœŸç»“æœ |
|---------|---------|---------|
| **åº”ç”¨å¥åº·çŠ¶æ€** | `GET /actuator/health` | UPçŠ¶æ€ |
| **ç³»ç»Ÿèµ„æºä½¿ç”¨** | `GET /actuator/metrics` | å†…å­˜ã€CPUæ­£å¸¸ |
| **æ•°æ®åº“è¿æ¥** | æŸ¥çœ‹è¿æ¥æ± æ—¥å¿— | è¿æ¥æ•°æ­£å¸¸ |
| **å¤–éƒ¨ä¾èµ–** | æ£€æŸ¥ç¬¬ä¸‰æ–¹æœåŠ¡ | å“åº”æ­£å¸¸ |
| **ä¸šåŠ¡æ—¥å¿—** | è°ƒæ•´ç›¸å…³åŒ…æ—¥å¿—çº§åˆ« | æ— ERRORæ—¥å¿— |

**âš¡ å¿«é€Ÿæ’éšœå‘½ä»¤é›†åˆ**ï¼š
```bash
#!/bin/bash
# å¿«é€Ÿæ’éšœè„šæœ¬

APP_HOST="localhost:8080"

echo "=== æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€ ==="
curl -s ${APP_HOST}/actuator/health | jq .

echo "=== å¼€å¯æ ¸å¿ƒä¸šåŠ¡DEBUGæ—¥å¿— ==="
curl -s -X POST ${APP_HOST}/actuator/loggers/com.example \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"DEBUG"}'

echo "=== å¼€å¯æ•°æ®åº“SQLæ—¥å¿— ==="
curl -s -X POST ${APP_HOST}/actuator/loggers/org.springframework.jdbc \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"DEBUG"}'

echo "æ’éšœç¯å¢ƒå·²å°±ç»ªï¼Œè¯·é‡ç°é—®é¢˜..."
```

---

## 5. ğŸ”„ æ—¥å¿—çº§åˆ«ç®¡ç†ç­–ç•¥


### 5.1 æ—¥å¿—çº§åˆ«å›é€€ç­–ç•¥


**ä»€ä¹ˆæ˜¯å›é€€ç­–ç•¥**ï¼š
> ç®€å•è¯´å°±æ˜¯"ç”¨å®Œå°±æ¢å¤"ï¼Œé¿å…DEBUGæ—¥å¿—ä¸€ç›´å¼€ç€å½±å“æ€§èƒ½ã€‚

**è‡ªåŠ¨å›é€€æœºåˆ¶**ï¼š
```java
@Component
public class LogLevelManager {
    
    private final LoggingSystem loggingSystem;
    private final ScheduledExecutorService scheduler;
    private final Map<String, LogLevel> originalLevels;
    
    public LogLevelManager(LoggingSystem loggingSystem) {
        this.loggingSystem = loggingSystem;
        this.scheduler = Executors.newSingleThreadScheduledExecutor();
        this.originalLevels = new ConcurrentHashMap<>();
    }
    
    /**
     * ä¸´æ—¶è®¾ç½®æ—¥å¿—çº§åˆ«ï¼ŒæŒ‡å®šæ—¶é—´åè‡ªåŠ¨å›é€€
     */
    public void setTemporaryLogLevel(String loggerName, 
                                   LogLevel newLevel, 
                                   Duration duration) {
        
        // è®°å½•åŸå§‹çº§åˆ«
        LoggerConfiguration config = loggingSystem.getLoggerConfiguration(loggerName);
        LogLevel originalLevel = config != null ? config.getConfiguredLevel() : LogLevel.INFO;
        originalLevels.put(loggerName, originalLevel);
        
        // è®¾ç½®æ–°çº§åˆ«
        loggingSystem.setLogLevel(loggerName, newLevel);
        
        // å®šæ—¶å›é€€
        scheduler.schedule(() -> {
            LogLevel rollbackLevel = originalLevels.remove(loggerName);
            if (rollbackLevel != null) {
                loggingSystem.setLogLevel(loggerName, rollbackLevel);
                log.info("æ—¥å¿—çº§åˆ«å·²è‡ªåŠ¨å›é€€ï¼š{} -> {}", loggerName, rollbackLevel);
            }
        }, duration.toSeconds(), TimeUnit.SECONDS);
        
        log.info("ä¸´æ—¶è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š{} -> {}ï¼Œ{}ç§’åè‡ªåŠ¨å›é€€", 
                loggerName, newLevel, duration.toSeconds());
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@RestController
public class TroubleshootController {
    
    @Autowired
    private LogLevelManager logLevelManager;
    
    @PostMapping("/troubleshoot/{packageName}")
    public String startTroubleshooting(@PathVariable String packageName) {
        
        // å¼€å¯DEBUGæ—¥å¿—5åˆ†é’Ÿï¼Œç„¶åè‡ªåŠ¨å›é€€
        logLevelManager.setTemporaryLogLevel(
            packageName, 
            LogLevel.DEBUG, 
            Duration.ofMinutes(5)
        );
        
        return "æ’éšœæ¨¡å¼å·²å¼€å¯ï¼Œ5åˆ†é’Ÿåè‡ªåŠ¨æ¢å¤";
    }
}
```

### 5.2 åˆ†ç¯å¢ƒæ—¥å¿—ç­–ç•¥


**ç¯å¢ƒé…ç½®ç­–ç•¥**ï¼š
```yaml
# application-dev.yml (å¼€å‘ç¯å¢ƒ)
logging:
  level:
    root: INFO
    com.example: DEBUG    # å¼€å‘ç¯å¢ƒå¯ä»¥è¯¦ç»†ä¸€ç‚¹
    org.springframework: INFO

# application-prod.yml (ç”Ÿäº§ç¯å¢ƒ)
logging:
  level:
    root: WARN
    com.example: INFO     # ç”Ÿäº§ç¯å¢ƒä¿å®ˆä¸€ç‚¹
    org.springframework: WARN
    org.hibernate.SQL: WARN  # ç”Ÿäº§ç¯å¢ƒä¸è¾“å‡ºSQL
```

**åŠ¨æ€ç­–ç•¥è¡¨**ï¼š

| ç¯å¢ƒç±»å‹ | ROOTçº§åˆ« | ä¸šåŠ¡åŒ…çº§åˆ« | æ¡†æ¶çº§åˆ« | è¯´æ˜ |
|---------|---------|-----------|---------|------|
| **å¼€å‘** | INFO | DEBUG | INFO | ä¾¿äºå¼€å‘è°ƒè¯• |
| **æµ‹è¯•** | INFO | INFO | WARN | å…³æ³¨ä¸šåŠ¡é€»è¾‘ |
| **é¢„å‘** | WARN | INFO | WARN | æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ |
| **ç”Ÿäº§** | ERROR | WARN | ERROR | åªå…³æ³¨é—®é¢˜ |

---

## 6. ğŸ” æ“ä½œå®¡è®¡ä¸å®‰å…¨


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦æ“ä½œå®¡è®¡


**å®‰å…¨é£é™©åœºæ™¯**ï¼š
```
é£é™©1ï¼šç”Ÿäº§ç¯å¢ƒæ—¥å¿—çº§åˆ«è¢«æ¶æ„è°ƒæ•´ ğŸš¨
â””â”€â”€ åæœï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²ã€æ€§èƒ½å½±å“

é£é™©2ï¼šå…³é”®æ’éšœæ“ä½œæ²¡æœ‰è®°å½• ğŸ“
â””â”€â”€ åæœï¼šæ— æ³•è¿½æº¯é—®é¢˜æ ¹å› 

é£é™©3ï¼šå¤šäººåŒæ—¶è°ƒæ•´æ—¥å¿—é…ç½® ğŸ”„
â””â”€â”€ åæœï¼šé…ç½®å†²çªã€æ’éšœå›°éš¾
```

### 6.2 æ“ä½œç•™ç—•å®ç°


**å®¡è®¡æ—¥å¿—è®°å½•**ï¼š
```java
@Component
@Slf4j
public class LoggerAuditManager {
    
    private final LoggingSystem loggingSystem;
    
    public void setLogLevelWithAudit(String loggerName, 
                                   LogLevel newLevel, 
                                   String operator, 
                                   String reason) {
        
        // è·å–å˜æ›´å‰çŠ¶æ€
        LoggerConfiguration beforeConfig = loggingSystem.getLoggerConfiguration(loggerName);
        LogLevel beforeLevel = beforeConfig != null ? beforeConfig.getConfiguredLevel() : null;
        
        try {
            // æ‰§è¡Œå˜æ›´
            loggingSystem.setLogLevel(loggerName, newLevel);
            
            // è®°å½•å®¡è®¡æ—¥å¿—
            log.info("ğŸ“ æ—¥å¿—çº§åˆ«å˜æ›´æˆåŠŸ - Logger: {}, å˜æ›´å‰: {}, å˜æ›´å: {}, æ“ä½œäºº: {}, åŸå› : {}, æ—¶é—´: {}", 
                    loggerName, beforeLevel, newLevel, operator, reason, LocalDateTime.now());
            
            // å¯é€‰ï¼šå‘é€åˆ°å®¡è®¡ç³»ç»Ÿ
            sendToAuditSystem(loggerName, beforeLevel, newLevel, operator, reason);
            
        } catch (Exception e) {
            log.error("âŒ æ—¥å¿—çº§åˆ«å˜æ›´å¤±è´¥ - Logger: {}, ç›®æ ‡çº§åˆ«: {}, æ“ä½œäºº: {}, é”™è¯¯: {}", 
                    loggerName, newLevel, operator, e.getMessage());
            throw e;
        }
    }
    
    private void sendToAuditSystem(String loggerName, LogLevel before, 
                                 LogLevel after, String operator, String reason) {
        // å‘é€åˆ°å®¡è®¡ç³»ç»Ÿçš„é€»è¾‘
        // å¯ä»¥æ˜¯æ•°æ®åº“è®°å½•ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æˆ–è€…ç¬¬ä¸‰æ–¹å®¡è®¡å¹³å°
    }
}
```

### 6.3 å®‰å…¨è®¿é—®æ§åˆ¶


**åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶**ï¼š
```java
@RestController
@RequestMapping("/admin/logging")
@PreAuthorize("hasRole('ADMIN')")  // åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®
public class SecureLoggerController {
    
    @PostMapping("/level")
    @PreAuthorize("hasAuthority('LOGGING_MANAGE')")  // éœ€è¦ç‰¹å®šæƒé™
    public ResponseEntity<String> setLogLevel(
            @RequestBody LogLevelRequest request,
            Authentication auth) {
        
        String operator = auth.getName();
        
        // å‚æ•°éªŒè¯
        if (!isValidLoggerName(request.getLoggerName())) {
            return ResponseEntity.badRequest().body("æ— æ•ˆçš„Loggeråç§°");
        }
        
        // è®°å½•æ“ä½œå¹¶æ‰§è¡Œ
        auditManager.setLogLevelWithAudit(
            request.getLoggerName(),
            LogLevel.valueOf(request.getLevel()),
            operator,
            request.getReason()
        );
        
        return ResponseEntity.ok("æ—¥å¿—çº§åˆ«è®¾ç½®æˆåŠŸ");
    }
    
    private boolean isValidLoggerName(String loggerName) {
        // éªŒè¯Loggeråç§°çš„åˆæ³•æ€§
        return loggerName != null 
            && loggerName.matches("^[a-zA-Z0-9._-]+$")
            && !loggerName.contains("..");  // é˜²æ­¢è·¯å¾„éå†
    }
}

@Data
class LogLevelRequest {
    private String loggerName;
    private String level;
    private String reason;  // å˜æ›´åŸå› 
}
```

---

## 7. ğŸ“Š æ—¥å¿—èšåˆåˆ†æ


### 7.1 ä»€ä¹ˆæ˜¯æ—¥å¿—èšåˆ


**ç®€å•ç†è§£**ï¼š
> å°±åƒæŠŠåˆ†æ•£åœ¨å„ä¸ªåœ°æ–¹çš„æ‹¼å›¾ç¢ç‰‡æ”¶é›†èµ·æ¥ï¼Œæ‹¼æˆå®Œæ•´çš„å›¾ç”»ï¼Œå¸®åŠ©æˆ‘ä»¬çœ‹æ¸…å…¨è²Œã€‚

```
åˆ†å¸ƒå¼ç³»ç»Ÿçš„æŒ‘æˆ˜ï¼š
æœåŠ¡Aï¼šè®¢å•æœåŠ¡ ğŸ“¦  â†’  æ—¥å¿—æ–‡ä»¶A
æœåŠ¡Bï¼šæ”¯ä»˜æœåŠ¡ ğŸ’°  â†’  æ—¥å¿—æ–‡ä»¶B  
æœåŠ¡Cï¼šåº“å­˜æœåŠ¡ ğŸ“Š  â†’  æ—¥å¿—æ–‡ä»¶C

é—®é¢˜ï¼šä¸€ä¸ªç”¨æˆ·è¯·æ±‚å¯èƒ½è·¨è¶Šå¤šä¸ªæœåŠ¡ï¼Œæ€ä¹ˆä¸²è”åˆ†æï¼Ÿ
è§£å†³ï¼šæ—¥å¿—èšåˆ + é“¾è·¯è¿½è¸ª
```

### 7.2 ELKæŠ€æœ¯æ ˆé›†æˆ


**æ¶æ„å›¾ç¤º**ï¼š
```
Spring Bootåº”ç”¨
       â†“ (logback-logstash-encoder)
   Logstash (æ—¥å¿—æ”¶é›†)
       â†“ (è§£æã€è¿‡æ»¤ã€è½¬æ¢)
 Elasticsearch (å­˜å‚¨ã€ç´¢å¼•)
       â†“ (æŸ¥è¯¢ã€èšåˆ)
    Kibana (å¯è§†åŒ–åˆ†æ)
```

**é›†æˆé…ç½®**ï¼š
```xml
<!-- pom.xml -->
<dependency>
    <groupId>net.logstash.logback</groupId>
    <artifactId>logstash-logback-encoder</artifactId>
    <version>7.3</version>
</dependency>
```

```xml
<!-- logback-spring.xml -->
<configuration>
    <!-- æ§åˆ¶å°è¾“å‡º -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <version/>
                <logLevel/>
                <message/>
                <mdc/>
                <loggerName/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>
    
    <!-- Logstashè¾“å‡º -->
    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <destination>logstash-server:5000</destination>
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <version/>
                <logLevel/>
                <message/>
                <mdc/>
                <loggerName/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>
    
    <root level="INFO">
        <appender-ref ref="STDOUT"/>
        <appender-ref ref="LOGSTASH"/>
    </root>
</configuration>
```

### 7.3 é“¾è·¯è¿½è¸ªé›†æˆ


**Spring Cloud Sleuthé…ç½®**ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-sleuth</artifactId>
</dependency>
```

```java
@RestController
public class OrderController {
    
    private static final Logger log = LoggerFactory.getLogger(OrderController.class);
    
    @PostMapping("/order")
    public ResponseEntity<String> createOrder(@RequestBody OrderRequest request) {
        
        // Sleuthè‡ªåŠ¨æ³¨å…¥TraceIdå’ŒSpanId
        log.info("å¼€å§‹å¤„ç†è®¢å•åˆ›å»ºè¯·æ±‚ï¼š{}", request.getOrderId());
        
        try {
            // ä¸šåŠ¡å¤„ç†
            orderService.createOrder(request);
            log.info("è®¢å•åˆ›å»ºæˆåŠŸï¼š{}", request.getOrderId());
            
            return ResponseEntity.ok("è®¢å•åˆ›å»ºæˆåŠŸ");
            
        } catch (Exception e) {
            log.error("è®¢å•åˆ›å»ºå¤±è´¥ï¼š{}", request.getOrderId(), e);
            return ResponseEntity.status(500).body("è®¢å•åˆ›å»ºå¤±è´¥");
        }
    }
}
```

**é“¾è·¯æ—¥å¿—ç¤ºä¾‹**ï¼š
```json
{
  "@timestamp": "2024-03-15T10:30:00.000Z",
  "level": "INFO",
  "message": "å¼€å§‹å¤„ç†è®¢å•åˆ›å»ºè¯·æ±‚ï¼šORDER-12345",
  "logger_name": "com.example.OrderController",
  "traceId": "abc123def456",
  "spanId": "789xyz012",
  "service": "order-service",
  "thread_name": "http-nio-8080-exec-1"
}
```

### 7.4 æ—¥å¿—åˆ†æå®æˆ˜


**å¸¸ç”¨åˆ†æç»´åº¦**ï¼š

| åˆ†æç»´åº¦ | KibanaæŸ¥è¯¢ç¤ºä¾‹ | ä¸šåŠ¡ä»·å€¼ |
|---------|--------------|---------|
| **é”™è¯¯ç‡åˆ†æ** | `level:ERROR` | å‘ç°ç³»ç»Ÿå¼‚å¸¸è¶‹åŠ¿ |
| **å“åº”æ—¶é—´** | `message:"æ‰§è¡Œè€—æ—¶"` | æ€§èƒ½ç“¶é¢ˆå®šä½ |
| **ç”¨æˆ·è¡Œä¸º** | `userId:12345` | ç”¨æˆ·æ“ä½œè½¨è¿¹ |
| **æ¥å£è°ƒç”¨é‡** | `logger_name:"*Controller"` | æµé‡åˆ†æ |
| **é“¾è·¯è¿½è¸ª** | `traceId:"abc123"` | è·¨æœåŠ¡é—®é¢˜æ’æŸ¥ |

**å‘Šè­¦è§„åˆ™é…ç½®**ï¼š
```yaml
# ElastAlerté…ç½®ç¤ºä¾‹
rules:
  - name: "é«˜é”™è¯¯ç‡å‘Šè­¦"
    type: frequency
    index: logstash-*
    num_events: 10
    timeframe:
      minutes: 5
    filter:
      - term:
          level: "ERROR"
    alert:
      - "email"
    email:
      - "ops-team@example.com"
    alert_text: |
      åœ¨è¿‡å»5åˆ†é’Ÿå†…æ£€æµ‹åˆ°{0}ä¸ªERRORçº§åˆ«æ—¥å¿—
      è¯·åŠæ—¶æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Actuatorç›‘æ§ï¼šSpring Bootåº”ç”¨çš„"ä½“æ£€å·¥å…·"
ğŸ”¸ loggersç«¯ç‚¹ï¼šåŠ¨æ€æŸ¥çœ‹å’Œè°ƒæ•´æ—¥å¿—çº§åˆ«çš„æ¥å£
ğŸ”¸ æ—¥å¿—çº§åˆ«ï¼šOFF < ERROR < WARN < INFO < DEBUG < TRACE
ğŸ”¸ åŠ¨æ€è°ƒæ•´ï¼šæ— éœ€é‡å¯åº”ç”¨å³å¯æ”¹å˜æ—¥å¿—è¾“å‡ºè¯¦ç»†ç¨‹åº¦
ğŸ”¸ æ“ä½œå®¡è®¡ï¼šè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™å› ä¸ºä»€ä¹ˆåŸå› ä¿®æ”¹äº†é…ç½®
ğŸ”¸ æ—¥å¿—èšåˆï¼šæŠŠåˆ†æ•£çš„æ—¥å¿—ç»Ÿä¸€æ”¶é›†åˆ†æ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆè¦åŠ¨æ€è°ƒæ•´æ—¥å¿—çº§åˆ«**
```
ç”Ÿäº§ç¯å¢ƒç‰¹ç‚¹ï¼š
- ä¸èƒ½éšä¾¿é‡å¯ âŒ
- éœ€è¦å¿«é€Ÿæ’éšœ âš¡
- ç”¨æˆ·ä½“éªŒä¼˜å…ˆ ğŸ‘¥

ä¼ ç»Ÿæ–¹å¼é—®é¢˜ï¼š
- ä¿®æ”¹é…ç½®éœ€è¦é‡å¯
- æ’éšœå‘¨æœŸé•¿
- å½±å“ç”¨æˆ·ä½¿ç”¨

åŠ¨æ€è°ƒæ•´ä¼˜åŠ¿ï¼š
- é›¶åœæœºæ’éšœ âœ…
- å³æ—¶ç”Ÿæ•ˆ âš¡
- ç”¨æˆ·æ— æ„ŸçŸ¥ ğŸ˜Š
```

**ğŸ”¹ æ—¥å¿—çº§åˆ«çš„åˆç†ä½¿ç”¨**
```
ç”Ÿäº§ç¯å¢ƒæ¨èï¼š
- å¹³æ—¶ï¼šWARNæˆ–INFOçº§åˆ«
- æ’éšœæ—¶ï¼šä¸´æ—¶è°ƒåˆ°DEBUG
- æ’éšœåï¼šç«‹å³è°ƒå›åŸçº§åˆ«

ä¸ºä»€ä¹ˆè¦åŠæ—¶è°ƒå›ï¼š
- DEBUGæ—¥å¿—é‡å¤§ï¼Œå½±å“æ€§èƒ½
- å¯èƒ½æš´éœ²æ•æ„Ÿä¿¡æ¯
- å¢åŠ å­˜å‚¨æˆæœ¬
```

**ğŸ”¹ å®‰å…¨æ€§è€ƒè™‘**
```
é£é™©ç‚¹ï¼š
- æ¶æ„è°ƒæ•´æ—¥å¿—çº§åˆ«
- æ•æ„Ÿä¿¡æ¯æ³„éœ²
- æ€§èƒ½å½±å“

é˜²æŠ¤æªæ–½ï¼š
- è®¿é—®æƒé™æ§åˆ¶
- æ“ä½œå®¡è®¡è®°å½•
- è‡ªåŠ¨å›é€€æœºåˆ¶
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š æ’éšœæµç¨‹å›¾**ï¼š
```
é—®é¢˜æŠ¥å‘Š
    â†“
åº”ç”¨å¥åº·æ£€æŸ¥ (/actuator/health)
    â†“
è°ƒæ•´ç›¸å…³åŒ…æ—¥å¿—çº§åˆ« (DEBUG)
    â†“
é‡ç°é—®é¢˜ï¼Œè§‚å¯Ÿæ—¥å¿—
    â†“
åˆ†æå®šä½æ ¹å› 
    â†“
è§£å†³é—®é¢˜
    â†“
æ¢å¤æ—¥å¿—çº§åˆ« (INFO/WARN)
    â†“
è®°å½•æ€»ç»“
```

**âš¡ å¿«é€Ÿæ“ä½œæŒ‡å—**ï¼š

```bash
# 1. æ£€æŸ¥å½“å‰æ—¥å¿—é…ç½®
curl http://localhost:8080/actuator/loggers/com.example

# 2. å¼€å¯DEBUGæ¨¡å¼æ’éšœ
curl -X POST http://localhost:8080/actuator/loggers/com.example \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"DEBUG"}'

# 3. æ’éšœå®Œæˆåæ¢å¤
curl -X POST http://localhost:8080/actuator/loggers/com.example \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"INFO"}'
```

### 8.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å»ºè®®**ï¼š

| åœºæ™¯ | æ¨èåšæ³• | æ³¨æ„äº‹é¡¹ |
|------|---------|---------|
| **æ—¥å¸¸è¿è¡Œ** | INFOçº§åˆ«ä¸ºä¸» | å…³æ³¨ä¸šåŠ¡å¼‚å¸¸ |
| **æ€§èƒ½æ’æŸ¥** | ä¸´æ—¶å¼€DEBUG | 5-10åˆ†é’Ÿå†…æ¢å¤ |
| **å¼‚å¸¸è°ƒè¯•** | å…ˆæŸ¥ERRORï¼Œå†å¼€DEBUG | é¿å…æ—¥å¿—çˆ†ç‚¸ |
| **ç¬¬ä¸‰æ–¹ç»„ä»¶** | WARNçº§åˆ« | å‡å°‘å¹²æ‰°ä¿¡æ¯ |

**ğŸ” å®‰å…¨é…ç½®è¦ç‚¹**ï¼š
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®è®¿é—®è®¤è¯
- æ‰€æœ‰æ—¥å¿—çº§åˆ«å˜æ›´éƒ½è¦è®°å½•å®¡è®¡
- è®¾ç½®è‡ªåŠ¨å›é€€æœºåˆ¶é˜²æ­¢é—å¿˜
- å®šæœŸæ£€æŸ¥æ—¥å¿—é…ç½®çš„åˆç†æ€§

**æ ¸å¿ƒè®°å¿†**ï¼š
- **Actuatoræ˜¯ä½“æ£€å·¥å…·**ï¼Œloggersæ˜¯æ—¥å¿—æ§åˆ¶å°
- **åŠ¨æ€è°ƒæ•´é›¶åœæœº**ï¼Œæ’éšœå®Œæˆè®°å¾—è°ƒå›
- **å®‰å…¨å®¡è®¡è¦åšå¥½**ï¼Œæ“ä½œç•™ç—•å¯è¿½æº¯
- **æ—¥å¿—èšåˆçœ‹å…¨å±€**ï¼ŒELKæŠ€æœ¯æ ˆæ˜¯åˆ©å™¨