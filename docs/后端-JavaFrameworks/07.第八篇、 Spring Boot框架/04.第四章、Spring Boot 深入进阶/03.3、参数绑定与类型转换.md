---
title: 3ã€å‚æ•°ç»‘å®šä¸ç±»å‹è½¬æ¢
---
## ğŸ“š ç›®å½•

1. [å‚æ•°ç»‘å®šåŸºç¡€æ¦‚å¿µ](#1-å‚æ•°ç»‘å®šåŸºç¡€æ¦‚å¿µ)
2. [ConversionServiceè½¬æ¢æœåŠ¡](#2-ConversionServiceè½¬æ¢æœåŠ¡)
3. [æ•°æ®ç»‘å®šè¯¦è§£](#3-æ•°æ®ç»‘å®šè¯¦è§£)
4. [æ ¡éªŒåˆ†ç»„ç­–ç•¥](#4-æ ¡éªŒåˆ†ç»„ç­–ç•¥)
5. [è‡ªå®šä¹‰è½¬æ¢å™¨](#5-è‡ªå®šä¹‰è½¬æ¢å™¨)
6. [æ ¼å¼åŒ–å™¨é…ç½®](#6-æ ¼å¼åŒ–å™¨é…ç½®)
7. [ç»‘å®šå¼‚å¸¸å¤„ç†](#7-ç»‘å®šå¼‚å¸¸å¤„ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å‚æ•°ç»‘å®šåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å‚æ•°ç»‘å®š


**ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°ç»‘å®šï¼Ÿ**

æƒ³è±¡ä½ åœ¨ç½‘ä¸Šä¹°ä¸œè¥¿ï¼Œå¡«å†™è®¢å•è¡¨å•ï¼š
- å•†å“æ•°é‡ï¼šè¾“å…¥"5"
- ä»·æ ¼ï¼šè¾“å…¥"99.99"
- ç”Ÿæ—¥ï¼šè¾“å…¥"1990-05-15"

æµè§ˆå™¨ä¼ ç»™åç«¯çš„éƒ½æ˜¯**æ–‡æœ¬å­—ç¬¦ä¸²**ï¼Œä½†Javaç¨‹åºéœ€è¦çš„æ˜¯**å…·ä½“ç±»å‹**çš„æ•°æ®ã€‚

```
ç”¨æˆ·è¾“å…¥(éƒ½æ˜¯å­—ç¬¦ä¸²)          Javaç¨‹åºéœ€è¦çš„ç±»å‹
"5"                    â†’    Integer ç±»å‹çš„ 5
"99.99"               â†’    BigDecimal ç±»å‹çš„ 99.99
"1990-05-15"          â†’    LocalDate ç±»å‹çš„æ—¥æœŸå¯¹è±¡
```

**ğŸ’¡ å‚æ•°ç»‘å®šçš„æœ¬è´¨**ï¼šå°±æ˜¯æŠŠ**å­—ç¬¦ä¸²**è½¬æ¢æˆ**Javaå¯¹è±¡**çš„è¿‡ç¨‹ã€‚

### 1.2 Spring Bootä¸­çš„å‚æ•°ç»‘å®šæµç¨‹


```
HTTPè¯·æ±‚å‚æ•°æµè½¬è¿‡ç¨‹ï¼š

æµè§ˆå™¨/å®¢æˆ·ç«¯
    â†“ (å‘é€å­—ç¬¦ä¸²å‚æ•°)
Spring MVCæ¥æ”¶
    â†“ (è¯†åˆ«éœ€è¦è½¬æ¢)
ConversionService
    â†“ (æ‰§è¡Œç±»å‹è½¬æ¢)
Java Controlleræ–¹æ³•
    â†“ (æ¥æ”¶æ­£ç¡®ç±»å‹çš„å‚æ•°)
ä¸šåŠ¡é€»è¾‘å¤„ç†
```

**ğŸ“‹ å¸¸è§çš„ç»‘å®šåœºæ™¯**ï¼š

| æ•°æ®æ¥æº | ç¤ºä¾‹ | è½¬æ¢ç›®æ ‡ |
|---------|------|---------|
| **URLè·¯å¾„** | `/user/123` | `@PathVariable Long id` |
| **æŸ¥è¯¢å‚æ•°** | `?age=25&active=true` | `Integer age, Boolean active` |
| **è¡¨å•æ•°æ®** | `name=å¼ ä¸‰&email=test@qq.com` | `Userå¯¹è±¡` |
| **JSONæ•°æ®** | `{"id": 1, "name": "äº§å“"}` | `Productå¯¹è±¡` |

---

## 2. âš™ï¸ ConversionServiceè½¬æ¢æœåŠ¡


### 2.1 ConversionServiceæ˜¯ä»€ä¹ˆ


**ğŸ·ï¸ ä¸“ä¸šæœ¯è¯­**ï¼š`ConversionService` = Springçš„**ç±»å‹è½¬æ¢ä¸­å¿ƒ**

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼š
å°±åƒç¿»è¯‘å®˜ä¸€æ ·ï¼Œä¸“é—¨è´Ÿè´£æŠŠä¸€ç§"è¯­è¨€"(ç±»å‹)ç¿»è¯‘æˆå¦ä¸€ç§"è¯­è¨€"ã€‚

```java
// ç®€å•ç†è§£ConversionServiceçš„ä½œç”¨
ConversionServiceè½¬æ¢å™¨ = Springçš„ç¿»è¯‘å®˜;

è½¬æ¢å™¨.è½¬æ¢("123", Integer.class);     // "123" â†’ 123
è½¬æ¢å™¨.è½¬æ¢("true", Boolean.class);    // "true" â†’ true
è½¬æ¢å™¨.è½¬æ¢("1990-05-15", LocalDate.class); // "1990-05-15" â†’ æ—¥æœŸå¯¹è±¡
```

### 2.2 å†…ç½®çš„è½¬æ¢å™¨


**âœ… Spring Bootè‡ªå¸¦çš„è½¬æ¢èƒ½åŠ›**ï¼š

```java
@RestController
public class DemoController {
    
    // âœ… è¿™äº›è½¬æ¢éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€é¢å¤–é…ç½®
    @GetMapping("/demo")
    public String demo(
        @RequestParam Integer age,        // "25" â†’ 25
        @RequestParam Boolean active,     // "true" â†’ true  
        @RequestParam Double price,       // "99.99" â†’ 99.99
        @RequestParam LocalDate birthday  // "1990-05-15" â†’ LocalDateå¯¹è±¡
    ) {
        return "è½¬æ¢æˆåŠŸï¼";
    }
}
```

**ğŸ“Š å¸¸ç”¨å†…ç½®è½¬æ¢å™¨åˆ—è¡¨**ï¼š

| æºç±»å‹ | ç›®æ ‡ç±»å‹ | ç¤ºä¾‹è½¬æ¢ |
|-------|---------|----------|
| `String` | `Integer/Long` | "123" â†’ 123 |
| `String` | `Boolean` | "true"/"false" â†’ true/false |
| `String` | `Double/Float` | "3.14" â†’ 3.14 |
| `String` | `LocalDate` | "2023-05-15" â†’ æ—¥æœŸå¯¹è±¡ |
| `String` | `Enum` | "ACTIVE" â†’ Status.ACTIVE |

### 2.3 è‡ªå®šä¹‰ConversionServiceé…ç½®


**ğŸ› ï¸ ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰ï¼Ÿ**

å½“é»˜è®¤è½¬æ¢å™¨ä¸å¤Ÿç”¨æ—¶ï¼Œæ¯”å¦‚ï¼š
- ç‰¹æ®Šçš„æ—¥æœŸæ ¼å¼ï¼š"15/05/1990"
- è‡ªå®šä¹‰çš„ä¸šåŠ¡å¯¹è±¡
- å¤æ‚çš„å­—ç¬¦ä¸²è§£æ

```java
@Configuration
public class ConversionConfig {
    
    @Bean
    @Primary  // è®¾ä¸ºä¸»è¦çš„è½¬æ¢æœåŠ¡
    public ConversionService conversionService() {
        DefaultConversionService service = new DefaultConversionService();
        
        // æ·»åŠ è‡ªå®šä¹‰è½¬æ¢å™¨
        service.addConverter(new StringToUserConverter());
        
        return service;
    }
}

// è‡ªå®šä¹‰è½¬æ¢å™¨ç¤ºä¾‹
@Component
public class StringToUserConverter implements Converter<String, User> {
    
    @Override
    public User convert(String source) {
        // "å¼ ä¸‰,25" â†’ Userå¯¹è±¡
        String[] parts = source.split(",");
        User user = new User();
        user.setName(parts[0]);
        user.setAge(Integer.parseInt(parts[1]));
        return user;
    }
}
```

---

## 3. ğŸ”§ æ•°æ®ç»‘å®šè¯¦è§£


### 3.1 @InitBinderæ•°æ®ç»‘å®š


**ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦@InitBinderï¼Ÿ**

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹ç»‘å®šè¿‡ç¨‹è¿›è¡Œ**ç²¾ç»†æ§åˆ¶**ï¼Œæ¯”å¦‚ï¼š
- è®¾ç½®æ—¥æœŸæ ¼å¼
- æŒ‡å®šæ•°å­—ç²¾åº¦
- è‡ªå®šä¹‰éªŒè¯è§„åˆ™

**ğŸ’¡ @InitBinderçš„ä½œç”¨**ï¼šåœ¨å‚æ•°ç»‘å®š**ä¹‹å‰**è¿›è¡Œé¢„å¤„ç†è®¾ç½®ã€‚

```java
@RestController
public class UserController {
    
    // ğŸ¯ å…³é”®æ–¹æ³•ï¼šåœ¨ç»‘å®šå‰è¿›è¡Œé…ç½®
    @InitBinder
    public void initBinder(WebDataBinder binder) {
        
        // 1. æ—¥æœŸæ ¼å¼è®¾ç½®
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
        
        // 2. å­—ç¬¦ä¸²å»ç©ºæ ¼å¤„ç†
        binder.registerCustomEditor(String.class, new StringTrimmerEditor(true));
        
        // 3. è®¾ç½®å…è®¸ç»‘å®šçš„å­—æ®µï¼ˆå®‰å…¨è€ƒè™‘ï¼‰
        binder.setAllowedFields("name", "age", "email"); // åªå…è®¸è¿™äº›å­—æ®µç»‘å®š
        
        // 4. è®¾ç½®ä¸å…è®¸ç»‘å®šçš„å­—æ®µ
        binder.setDisallowedFields("id", "password"); // ç¦æ­¢ç»‘å®šè¿™äº›æ•æ„Ÿå­—æ®µ
    }
    
    @PostMapping("/user")
    public String createUser(@ModelAttribute User user) {
        // è¿™é‡Œæ¥æ”¶åˆ°çš„userå¯¹è±¡å·²ç»æŒ‰ç…§ä¸Šé¢çš„è§„åˆ™å¤„ç†è¿‡äº†
        return "ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼š" + user.toString();
    }
}
```

**ğŸ“‹ InitBinderå¸¸ç”¨é…ç½®**ï¼š

| é…ç½®é¡¹ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|-------|------|----------|
| `registerCustomEditor` | æ³¨å†Œè‡ªå®šä¹‰ç¼–è¾‘å™¨ | ç‰¹æ®Šæ ¼å¼è½¬æ¢ |
| `setAllowedFields` | ç™½åå•å­—æ®µ | å®‰å…¨é˜²æŠ¤ |
| `setDisallowedFields` | é»‘åå•å­—æ®µ | æ•æ„Ÿæ•°æ®ä¿æŠ¤ |
| `setRequiredFields` | å¿…å¡«å­—æ®µ | æ•°æ®å®Œæ•´æ€§ |

### 3.2 å…¨å±€æ•°æ®ç»‘å®šé…ç½®


```java
// å…¨å±€é…ç½®ï¼šå¯¹æ‰€æœ‰Controllerç”Ÿæ•ˆ
@ControllerAdvice
public class GlobalBindingConfig {
    
    @InitBinder
    public void globalInitBinder(WebDataBinder binder) {
        // å…¨å±€æ—¥æœŸæ ¼å¼
        binder.registerCustomEditor(LocalDate.class, 
            new PropertyEditorSupport() {
                @Override
                public void setAsText(String text) {
                    setValue(LocalDate.parse(text, DateTimeFormatter.ofPattern("yyyy/MM/dd")));
                }
            });
    }
}
```

---

## 4. âœ… æ ¡éªŒåˆ†ç»„ç­–ç•¥


### 4.1 ä»€ä¹ˆæ˜¯æ ¡éªŒåˆ†ç»„


**ğŸŒ° ç”Ÿæ´»åœºæ™¯**ï¼š
ç”¨æˆ·æ³¨å†Œå’Œç”¨æˆ·æ›´æ–°ï¼Œå¯¹åŒä¸€ä¸ªUserå¯¹è±¡æœ‰ä¸åŒçš„æ ¡éªŒè¦æ±‚ï¼š

```
ç”¨æˆ·æ³¨å†Œæ—¶ï¼š
- ç”¨æˆ·åï¼šå¿…å¡«ï¼Œé•¿åº¦3-20
- å¯†ç ï¼šå¿…å¡«ï¼Œé•¿åº¦6-20
- é‚®ç®±ï¼šå¿…å¡«ï¼Œæ ¼å¼æ­£ç¡®
- IDï¼šä¸éœ€è¦ï¼ˆç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼‰

ç”¨æˆ·æ›´æ–°æ—¶ï¼š
- ç”¨æˆ·åï¼šå¯é€‰ï¼Œé•¿åº¦3-20  
- å¯†ç ï¼šå¯é€‰ï¼Œé•¿åº¦6-20
- é‚®ç®±ï¼šå¯é€‰ï¼Œæ ¼å¼æ­£ç¡®
- IDï¼šå¿…å¡«ï¼ˆæŒ‡å®šè¦æ›´æ–°å“ªä¸ªç”¨æˆ·ï¼‰
```

**ğŸ’¡ åˆ†ç»„æ ¡éªŒçš„ä½œç”¨**ï¼šæ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œåº”ç”¨ä¸åŒçš„æ ¡éªŒè§„åˆ™ã€‚

### 4.2 å®šä¹‰æ ¡éªŒåˆ†ç»„


```java
// 1. å…ˆå®šä¹‰åˆ†ç»„æ¥å£
public interface ValidationGroups {
    interface Create {}  // åˆ›å»ºåˆ†ç»„
    interface Update {}  // æ›´æ–°åˆ†ç»„  
}

// 2. åœ¨å®ä½“ç±»ä¸­ä½¿ç”¨åˆ†ç»„
public class User {
    
    @NotNull(groups = Update.class, message = "æ›´æ–°æ—¶IDä¸èƒ½ä¸ºç©º")
    private Long id;
    
    @NotBlank(groups = {Create.class, Update.class}, message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Size(min = 3, max = 20, groups = {Create.class, Update.class})
    private String username;
    
    @NotBlank(groups = Create.class, message = "æ³¨å†Œæ—¶å¯†ç ä¸èƒ½ä¸ºç©º") 
    @Size(min = 6, max = 20, groups = {Create.class, Update.class})
    private String password;
    
    @Email(groups = {Create.class, Update.class})
    private String email;
    
    // getter/setterçœç•¥...
}
```

### 4.3 åœ¨Controllerä¸­åº”ç”¨åˆ†ç»„


```java
@RestController
public class UserController {
    
    // ç”¨æˆ·æ³¨å†Œï¼šåº”ç”¨Createåˆ†ç»„çš„æ ¡éªŒè§„åˆ™
    @PostMapping("/register")
    public ResponseEntity<?> register(@Validated(Create.class) @RequestBody User user) {
        // è¿™é‡Œä¼šæ ¡éªŒï¼šusername(å¿…å¡«), password(å¿…å¡«), emailæ ¼å¼
        // ä¸ä¼šæ ¡éªŒï¼šid(å› ä¸ºidåªåœ¨Updateåˆ†ç»„ä¸­è¦æ±‚éç©º)
        return ResponseEntity.ok("æ³¨å†ŒæˆåŠŸ");
    }
    
    // ç”¨æˆ·æ›´æ–°ï¼šåº”ç”¨Updateåˆ†ç»„çš„æ ¡éªŒè§„åˆ™  
    @PutMapping("/user")
    public ResponseEntity<?> updateUser(@Validated(Update.class) @RequestBody User user) {
        // è¿™é‡Œä¼šæ ¡éªŒï¼šid(å¿…å¡«), username/password/emailçš„æ ¼å¼è§„åˆ™
        // ä½†username/passwordå¯ä»¥ä¸ºç©º(åªåœ¨Createåˆ†ç»„ä¸­è¦æ±‚å¿…å¡«)
        return ResponseEntity.ok("æ›´æ–°æˆåŠŸ");
    }
}
```

**ğŸ¯ æ ¡éªŒåˆ†ç»„çš„æ ¸å¿ƒé€»è¾‘**ï¼š

```
æœªæ ‡æ³¨åˆ†ç»„çš„æ ¡éªŒæ³¨è§£ â†’ é»˜è®¤åˆ†ç»„(Default.class)
æ ‡æ³¨äº†åˆ†ç»„çš„æ ¡éªŒæ³¨è§£ â†’ åªåœ¨æŒ‡å®šåˆ†ç»„ä¸­ç”Ÿæ•ˆ

@Validated(Create.class) â†’ åªæ ¡éªŒgroups = Create.classçš„æ³¨è§£
@Validated(Update.class) â†’ åªæ ¡éªŒgroups = Update.classçš„æ³¨è§£
@Validated â†’ åªæ ¡éªŒé»˜è®¤åˆ†ç»„çš„æ³¨è§£
```

---

## 5. ğŸ”„ è‡ªå®šä¹‰è½¬æ¢å™¨


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰è½¬æ¢å™¨


**âŒ å†…ç½®è½¬æ¢å™¨å¤„ç†ä¸äº†çš„æƒ…å†µ**ï¼š

```java
// åœºæ™¯1ï¼šç‰¹æ®Šå­—ç¬¦ä¸²æ ¼å¼
String coordinate = "120.5,30.2";  // ç»çº¬åº¦å­—ç¬¦ä¸²
// éœ€è¦è½¬æ¢ä¸ºè‡ªå®šä¹‰çš„åæ ‡å¯¹è±¡

// åœºæ™¯2ï¼šå¤æ‚ä¸šåŠ¡å¯¹è±¡
String userInfo = "å¼ ä¸‰|25|engineer|åŒ—äº¬";  // å¤åˆä¿¡æ¯
// éœ€è¦è§£æä¸ºUserå¯¹è±¡

// åœºæ™¯3ï¼šæšä¸¾çš„ä¸­æ–‡è½¬æ¢  
String status = "å·²æ¿€æ´»";  // ä¸­æ–‡çŠ¶æ€
// éœ€è¦è½¬æ¢ä¸º UserStatus.ACTIVE æšä¸¾
```

### 5.2 å®ç°Converteræ¥å£


**ğŸ› ï¸ åˆ›å»ºè‡ªå®šä¹‰è½¬æ¢å™¨**ï¼š

```java
// ç¤ºä¾‹1ï¼šå­—ç¬¦ä¸²è½¬åæ ‡å¯¹è±¡
@Component
public class StringToCoordinateConverter implements Converter<String, Coordinate> {
    
    @Override
    public Coordinate convert(String source) {
        if (source == null || source.trim().isEmpty()) {
            return null;
        }
        
        try {
            // "120.5,30.2" â†’ Coordinateå¯¹è±¡
            String[] parts = source.split(",");
            double longitude = Double.parseDouble(parts[0]);
            double latitude = Double.parseDouble(parts[1]);
            
            return new Coordinate(longitude, latitude);
        } catch (Exception e) {
            throw new IllegalArgumentException("åæ ‡æ ¼å¼é”™è¯¯ï¼Œæ­£ç¡®æ ¼å¼ï¼šç»åº¦,çº¬åº¦");
        }
    }
}

// ç¤ºä¾‹2ï¼šå­—ç¬¦ä¸²è½¬ç”¨æˆ·çŠ¶æ€æšä¸¾
@Component  
public class StringToUserStatusConverter implements Converter<String, UserStatus> {
    
    @Override
    public UserStatus convert(String source) {
        if (source == null) return null;
        
        // æ”¯æŒä¸­æ–‡è½¬æ¢
        switch (source) {
            case "æ¿€æ´»": case "å·²æ¿€æ´»": return UserStatus.ACTIVE;
            case "ç¦ç”¨": case "å·²ç¦ç”¨": return UserStatus.INACTIVE; 
            case "å¾…å®¡æ ¸": return UserStatus.PENDING;
            default: 
                // å°è¯•è‹±æ–‡åç§°
                try {
                    return UserStatus.valueOf(source.toUpperCase());
                } catch (IllegalArgumentException e) {
                    throw new IllegalArgumentException("ä¸æ”¯æŒçš„ç”¨æˆ·çŠ¶æ€ï¼š" + source);
                }
        }
    }
}
```

### 5.3 æ³¨å†Œè½¬æ¢å™¨


```java
@Configuration
public class ConverterConfig implements WebMvcConfigurer {
    
    @Autowired
    private StringToCoordinateConverter coordinateConverter;
    
    @Autowired  
    private StringToUserStatusConverter statusConverter;
    
    @Override
    public void addFormatters(FormatterRegistry registry) {
        // æ³¨å†Œè‡ªå®šä¹‰è½¬æ¢å™¨
        registry.addConverter(coordinateConverter);
        registry.addConverter(statusConverter);
    }
}
```

### 5.4 ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨


```java
@RestController
public class LocationController {
    
    // ç°åœ¨å¯ä»¥ç›´æ¥æ¥æ”¶Coordinateå¯¹è±¡äº†
    @GetMapping("/location")
    public String getLocationInfo(
        @RequestParam Coordinate position,    // "120.5,30.2" è‡ªåŠ¨è½¬æ¢ä¸ºCoordinateå¯¹è±¡
        @RequestParam UserStatus status       // "æ¿€æ´»" è‡ªåŠ¨è½¬æ¢ä¸ºUserStatus.ACTIVE
    ) {
        return String.format("ä½ç½®ï¼š%sï¼ŒçŠ¶æ€ï¼š%s", position, status);
    }
}

// è¯·æ±‚ç¤ºä¾‹ï¼š
// GET /location?position=120.5,30.2&status=æ¿€æ´»
// å‚æ•°ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¯¹åº”çš„Javaå¯¹è±¡
```

---

## 6. ğŸ“… æ ¼å¼åŒ–å™¨é…ç½®


### 6.1 æ ¼å¼åŒ–å™¨ vs è½¬æ¢å™¨


**ğŸ” ä¸¤è€…çš„åŒºåˆ«**ï¼š

```
è½¬æ¢å™¨(Converter)ï¼š
- åŠŸèƒ½ï¼šç±»å‹A â†’ ç±»å‹B çš„è½¬æ¢
- ä½¿ç”¨åœºæ™¯ï¼šString â†’ Integer, String â†’ è‡ªå®šä¹‰å¯¹è±¡
- ç‰¹ç‚¹ï¼šé€šç”¨è½¬æ¢ï¼Œä¸æ¶‰åŠæ ¼å¼

æ ¼å¼åŒ–å™¨(Formatter)ï¼š  
- åŠŸèƒ½ï¼šString âŸ· å¯¹è±¡ çš„åŒå‘æ ¼å¼åŒ–
- ä½¿ç”¨åœºæ™¯ï¼šæ—¥æœŸæ ¼å¼åŒ–ã€æ•°å­—æ ¼å¼åŒ–ã€è´§å¸æ ¼å¼åŒ–
- ç‰¹ç‚¹ï¼šä¸“æ³¨äºæ ¼å¼åŒ–æ˜¾ç¤ºå’Œè§£æ
```

**ğŸŒ° å®é™…å¯¹æ¯”**ï¼š

| åœºæ™¯ | è½¬æ¢å™¨ | æ ¼å¼åŒ–å™¨ |
|------|-------|----------|
| å­—ç¬¦ä¸²è½¬æ•°å­— | `"123" â†’ 123` | `"1,234.56" âŸ· 1234.56` |
| å­—ç¬¦ä¸²è½¬æ—¥æœŸ | `"2023-05-15" â†’ Date` | `"2023å¹´5æœˆ15æ—¥" âŸ· Date` |
| æ˜¾ç¤ºæ ¼å¼ | ä¸å…³å¿ƒæ˜¾ç¤ºæ ¼å¼ | ä¸“é—¨å¤„ç†æ˜¾ç¤ºæ ¼å¼ |

### 6.2 å†…ç½®æ ¼å¼åŒ–å™¨


```java
@RestController
public class FormatController {
    
    @GetMapping("/format-demo")
    public String formatDemo(
        // æ—¥æœŸæ ¼å¼åŒ–ï¼šæ”¯æŒå¤šç§æ ¼å¼
        @RequestParam @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate date1,
        @RequestParam @DateTimeFormat(pattern = "yyyy/MM/dd HH:mm:ss") LocalDateTime date2,
        
        // æ•°å­—æ ¼å¼åŒ–
        @RequestParam @NumberFormat(pattern = "#,###.##") BigDecimal amount
    ) {
        return String.format("æ—¥æœŸ1ï¼š%sï¼Œæ—¥æœŸ2ï¼š%sï¼Œé‡‘é¢ï¼š%s", date1, date2, amount);
    }
}

// è¯·æ±‚ç¤ºä¾‹ï¼š
// GET /format-demo?date1=2023-05-15&date2=2023/05/15 14:30:00&amount=1,234.56
```

**ğŸ“‹ å¸¸ç”¨æ ¼å¼åŒ–æ³¨è§£**ï¼š

| æ³¨è§£ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `@DateTimeFormat` | æ—¥æœŸæ—¶é—´æ ¼å¼ | `pattern = "yyyy-MM-dd"` |
| `@NumberFormat` | æ•°å­—æ ¼å¼ | `pattern = "#,###.##"` |
| `@JsonFormat` | JSONåºåˆ—åŒ–æ ¼å¼ | `pattern = "yyyy-MM-dd HH:mm:ss"` |

### 6.3 è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨


```java
// è‡ªå®šä¹‰æ‰‹æœºå·æ ¼å¼åŒ–å™¨
public class PhoneNumberFormatter implements Formatter<String> {
    
    @Override
    public String parse(String text, Locale locale) throws ParseException {
        if (text == null || text.trim().isEmpty()) {
            return null;
        }
        
        // è§£æï¼šç§»é™¤æ‰€æœ‰éæ•°å­—å­—ç¬¦
        String phone = text.replaceAll("[^0-9]", "");
        
        // éªŒè¯æ‰‹æœºå·æ ¼å¼
        if (!phone.matches("^1[3-9]\\d{9}$")) {
            throw new ParseException("æ‰‹æœºå·æ ¼å¼é”™è¯¯", 0);
        }
        
        return phone;
    }
    
    @Override
    public String print(String phone, Locale locale) {
        if (phone == null || phone.length() != 11) {
            return phone;
        }
        
        // æ ¼å¼åŒ–æ˜¾ç¤ºï¼š138-1234-5678
        return String.format("%s-%s-%s", 
                phone.substring(0, 3),
                phone.substring(3, 7), 
                phone.substring(7));
    }
}

// æ³¨å†Œæ ¼å¼åŒ–å™¨
@Configuration
public class FormatterConfig implements WebMvcConfigurer {
    
    @Override
    public void addFormatters(FormatterRegistry registry) {
        registry.addFormatter(new PhoneNumberFormatter());
    }
}
```

---

## 7. âš ï¸ ç»‘å®šå¼‚å¸¸å¤„ç†


### 7.1 å¸¸è§çš„ç»‘å®šå¼‚å¸¸


**ğŸš¨ å‚æ•°ç»‘å®šè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜**ï¼š

```
ç”¨æˆ·è¾“å…¥ â†’ Springå¤„ç† â†’ å¯èƒ½çš„å¼‚å¸¸

"abc" â†’ Integer     MethodArgumentTypeMismatchException (ç±»å‹ä¸åŒ¹é…)
"2023-13-45" â†’ Date ConversionFailedException (æ—¥æœŸæ ¼å¼é”™è¯¯) 
ç¼ºå°‘å¿…å¡«å‚æ•°           MissingServletRequestParameterException
JSONæ ¼å¼é”™è¯¯          HttpMessageNotReadableException
æ ¡éªŒå¤±è´¥              MethodArgumentNotValidException
```

### 7.2 å¼‚å¸¸å¤„ç†ç­–ç•¥


```java
@ControllerAdvice
public class BindingExceptionHandler {
    
    // 1. å¤„ç†ç±»å‹è½¬æ¢å¼‚å¸¸
    @ExceptionHandler(MethodArgumentTypeMismatchException.class)
    public ResponseEntity<ErrorResponse> handleTypeMismatch(MethodArgumentTypeMismatchException ex) {
        String message = String.format(
            "å‚æ•° '%s' çš„å€¼ '%s' ä¸èƒ½è½¬æ¢ä¸º %s ç±»å‹", 
            ex.getName(), 
            ex.getValue(),
            ex.getRequiredType().getSimpleName()
        );
        
        return ResponseEntity.badRequest()
            .body(new ErrorResponse("PARAM_TYPE_ERROR", message));
    }
    
    // 2. å¤„ç†ç¼ºå°‘å‚æ•°å¼‚å¸¸  
    @ExceptionHandler(MissingServletRequestParameterException.class)
    public ResponseEntity<ErrorResponse> handleMissingParam(MissingServletRequestParameterException ex) {
        String message = String.format("ç¼ºå°‘å¿…éœ€çš„å‚æ•°ï¼š%s", ex.getParameterName());
        
        return ResponseEntity.badRequest()
            .body(new ErrorResponse("MISSING_PARAM", message));
    }
    
    // 3. å¤„ç†æ ¡éªŒå¤±è´¥å¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class) 
    public ResponseEntity<ErrorResponse> handleValidationError(MethodArgumentNotValidException ex) {
        List<String> errors = ex.getBindingResult()
            .getFieldErrors()
            .stream()
            .map(error -> error.getField() + ": " + error.getDefaultMessage())
            .collect(Collectors.toList());
            
        return ResponseEntity.badRequest()
            .body(new ErrorResponse("VALIDATION_ERROR", "æ ¡éªŒå¤±è´¥", errors));
    }
    
    // 4. å¤„ç†JSONè§£æå¼‚å¸¸
    @ExceptionHandler(HttpMessageNotReadableException.class)
    public ResponseEntity<ErrorResponse> handleJsonParseError(HttpMessageNotReadableException ex) {
        String message = "è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼";
        
        return ResponseEntity.badRequest()
            .body(new ErrorResponse("JSON_PARSE_ERROR", message));
    }
}

// ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
public class ErrorResponse {
    private String code;
    private String message;  
    private List<String> details;
    
    // æ„é€ æ–¹æ³•å’Œgetter/setterçœç•¥...
}
```

### 7.3 å‹å¥½çš„é”™è¯¯æç¤º


```java
@Component
public class UserFriendlyErrorMessages {
    
    private static final Map<String, String> TYPE_ERROR_MESSAGES = Map.of(
        "Integer", "è¯·è¾“å…¥æ•´æ•°",
        "Long", "è¯·è¾“å…¥æ•°å­—", 
        "Double", "è¯·è¾“å…¥å°æ•°",
        "Boolean", "è¯·è¾“å…¥trueæˆ–false",
        "LocalDate", "è¯·è¾“å…¥æ—¥æœŸï¼Œæ ¼å¼ï¼šyyyy-MM-dd",
        "LocalDateTime", "è¯·è¾“å…¥æ—¥æœŸæ—¶é—´ï¼Œæ ¼å¼ï¼šyyyy-MM-dd HH:mm:ss"
    );
    
    public String getTypeErrorMessage(String typeName, String paramName, Object value) {
        String typeHint = TYPE_ERROR_MESSAGES.getOrDefault(typeName, "è¯·æ£€æŸ¥å‚æ•°æ ¼å¼");
        return String.format("å‚æ•° '%s' çš„å€¼ '%s' æ ¼å¼é”™è¯¯ï¼Œ%s", paramName, value, typeHint);
    }
}
```

**ğŸ’¡ å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ**ï¼š

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **ç”¨æˆ·å‹å¥½** | é”™è¯¯ä¿¡æ¯è¦è®©ç”¨æˆ·èƒ½ç†è§£ | "è¯·è¾“å…¥æ­£ç¡®çš„æ—¥æœŸæ ¼å¼" vs "DateTimeParseException" |
| **ä¿¡æ¯å®Œæ•´** | å‘Šè¯‰ç”¨æˆ·å“ªé‡Œé”™äº†ã€åº”è¯¥æ€ä¹ˆæ”¹ | "å‚æ•°ageæ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æ•´æ•°" |
| **åˆ†ç±»å¤„ç†** | ä¸åŒç±»å‹çš„å¼‚å¸¸åˆ†åˆ«å¤„ç† | ç±»å‹é”™è¯¯ã€ç¼ºå°‘å‚æ•°ã€æ ¼å¼é”™è¯¯ç­‰ |
| **æ—¥å¿—è®°å½•** | è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯ä¾›å¼€å‘è€…è°ƒè¯• | è®°å½•å®Œæ•´å¼‚å¸¸å †æ ˆ |

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ å‚æ•°ç»‘å®šï¼šHTTPå­—ç¬¦ä¸²å‚æ•° â†’ Javaå¯¹è±¡ çš„è½¬æ¢è¿‡ç¨‹
ğŸ”„ ConversionServiceï¼šSpringçš„ç±»å‹è½¬æ¢ä¸­å¿ƒï¼Œè´Ÿè´£å„ç§ç±»å‹è½¬æ¢
ğŸ”§ @InitBinderï¼šç»‘å®šå‰çš„é¢„å¤„ç†é…ç½®ï¼Œå¯ä»¥è‡ªå®šä¹‰ç»‘å®šè§„åˆ™  
âœ… æ ¡éªŒåˆ†ç»„ï¼šæ ¹æ®ä¸åŒåœºæ™¯åº”ç”¨ä¸åŒçš„æ ¡éªŒè§„åˆ™
ğŸ“ è‡ªå®šä¹‰è½¬æ¢å™¨ï¼šå¤„ç†ç‰¹æ®Šçš„ç±»å‹è½¬æ¢éœ€æ±‚
ğŸ“… æ ¼å¼åŒ–å™¨ï¼šä¸“é—¨å¤„ç†å­—ç¬¦ä¸²ä¸å¯¹è±¡é—´çš„æ ¼å¼åŒ–è½¬æ¢
âš ï¸ å¼‚å¸¸å¤„ç†ï¼šä¼˜é›…å¤„ç†ç»‘å®šè¿‡ç¨‹ä¸­çš„å„ç§å¼‚å¸¸
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦å‚æ•°ç»‘å®š**
```
Webè¯·æ±‚ â†’ éƒ½æ˜¯å­—ç¬¦ä¸²
Javaç¨‹åº â†’ éœ€è¦å¼ºç±»å‹å¯¹è±¡  
å‚æ•°ç»‘å®š â†’ æ­å»ºä¸¤è€…ä¹‹é—´çš„æ¡¥æ¢
```

**ğŸ”¹ è½¬æ¢å™¨ vs æ ¼å¼åŒ–å™¨**
```
è½¬æ¢å™¨ï¼šä¸“æ³¨ç±»å‹è½¬æ¢ï¼ŒString â†’ Object
æ ¼å¼åŒ–å™¨ï¼šä¸“æ³¨æ ¼å¼åŒ–ï¼ŒString âŸ· Object + æ˜¾ç¤ºæ ¼å¼
é€‰æ‹©ï¼šç®€å•è½¬æ¢ç”¨è½¬æ¢å™¨ï¼Œæ¶‰åŠæ ¼å¼ç”¨æ ¼å¼åŒ–å™¨
```

**ğŸ”¹ æ ¡éªŒåˆ†ç»„çš„ä»·å€¼**
```
åŒä¸€ä¸ªå®ä½“ç±» â†’ ä¸åŒåœºæ™¯ä¸åŒæ ¡éªŒè§„åˆ™
åˆ†ç»„æ ¡éªŒ â†’ ä¸€å¥—ä»£ç é€‚åº”å¤šç§ä¸šåŠ¡åœºæ™¯  
æé«˜ä»£ç å¤ç”¨æ€§å’Œç»´æŠ¤æ€§
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ› ï¸ ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰è½¬æ¢å™¨**ï¼š
- âœ… ç‰¹æ®Šå­—ç¬¦ä¸²æ ¼å¼ï¼š"120.5,30.2" â†’ åæ ‡å¯¹è±¡
- âœ… æšä¸¾çš„ä¸­æ–‡æ˜ å°„ï¼š"å·²æ¿€æ´»" â†’ Status.ACTIVE  
- âœ… å¤æ‚ä¸šåŠ¡å¯¹è±¡è§£æï¼š"å¼ ä¸‰|25|å·¥ç¨‹å¸ˆ" â†’ Userå¯¹è±¡
- âŒ ç®€å•ç±»å‹è½¬æ¢ï¼šç”¨å†…ç½®è½¬æ¢å™¨å°±å¤Ÿäº†

**âš ï¸ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| æ—¥æœŸæ ¼å¼è½¬æ¢å¤±è´¥ | æ ¼å¼ä¸åŒ¹é… | ä½¿ç”¨`@DateTimeFormat`æŒ‡å®šæ ¼å¼ |
| è‡ªå®šä¹‰å¯¹è±¡ç»‘å®šå¤±è´¥ | ç¼ºå°‘è½¬æ¢å™¨ | å®ç°è‡ªå®šä¹‰`Converter` |
| æ ¡éªŒè§„åˆ™å†²çª | ä¸åŒåœºæ™¯éœ€æ±‚ä¸åŒ | ä½¿ç”¨æ ¡éªŒåˆ†ç»„ |
| å¼‚å¸¸ä¿¡æ¯ä¸å‹å¥½ | ç¼ºå°‘å¼‚å¸¸å¤„ç† | ä½¿ç”¨`@ControllerAdvice`å¤„ç† |

**ğŸ¯ æœ€ä½³å®è·µå»ºè®®**ï¼š

```
1. ä¼˜å…ˆä½¿ç”¨å†…ç½®è½¬æ¢å™¨å’Œæ ¼å¼åŒ–å™¨
2. è‡ªå®šä¹‰è½¬æ¢å™¨è¦å¤„ç†å¼‚å¸¸æƒ…å†µ  
3. ä½¿ç”¨æ ¡éªŒåˆ†ç»„æé«˜ä»£ç å¤ç”¨æ€§
4. æä¾›å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ¯
5. æ•æ„Ÿå­—æ®µä½¿ç”¨@InitBinderä¿æŠ¤
```

### 8.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å­¦ä¹ é¡ºåº**ï¼š
1. **æŒæ¡åŸºç¡€**ï¼šç†è§£å‚æ•°ç»‘å®šçš„åŸºæœ¬æ¦‚å¿µå’Œæµç¨‹
2. **ç†Ÿç»ƒå†…ç½®åŠŸèƒ½**ï¼šæŒæ¡å¸¸ç”¨çš„è½¬æ¢å™¨å’Œæ ¼å¼åŒ–å™¨
3. **å­¦ä¼šè‡ªå®šä¹‰**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚åˆ›å»ºè‡ªå®šä¹‰è½¬æ¢å™¨  
4. **å®è·µæ ¡éªŒåˆ†ç»„**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨åˆ†ç»„æ ¡éªŒ
5. **å®Œå–„å¼‚å¸¸å¤„ç†**ï¼šæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

**ğŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
- å¤šåŠ¨æ‰‹å®è·µï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦å†™ä»£ç éªŒè¯
- å…³æ³¨å¼‚å¸¸æƒ…å†µçš„å¤„ç†ï¼Œè®©ç¨‹åºæ›´å¥å£®
- ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯ï¼Œç†è§£æŠ€æœ¯çš„åº”ç”¨ä»·å€¼
- æ³¨æ„ç”¨æˆ·ä½“éªŒï¼Œæä¾›å‹å¥½çš„é”™è¯¯æç¤º

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å­—ç¬¦ä¸²è½¬å¯¹è±¡ï¼Œç»‘å®šæ˜¯å…³é”®
è½¬æ¢å™¨æ ¼å¼åŒ–ï¼Œå„æœ‰å„ç”¨é€”  
åˆ†ç»„æ ¡éªŒå·§ï¼Œä¸€ç å¤šåœºæ™¯
å¼‚å¸¸è¦å¤„ç†ï¼Œç”¨æˆ·ä½“éªŒä½³
```