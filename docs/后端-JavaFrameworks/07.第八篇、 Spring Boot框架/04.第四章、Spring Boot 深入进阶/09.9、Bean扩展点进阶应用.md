---
title: 9ã€Beanæ‰©å±•ç‚¹è¿›é˜¶åº”ç”¨
---
## ğŸ“š ç›®å½•

1. [Beanæ‰©å±•ç‚¹æ¦‚è¿°](#1-Beanæ‰©å±•ç‚¹æ¦‚è¿°)
2. [BeanFactoryPostProcessorå·¥å‚åå¤„ç†](#2-BeanFactoryPostProcessorå·¥å‚åå¤„ç†)
3. [BeanPostProcessorå®ä¾‹åå¤„ç†](#3-BeanPostProcessorå®ä¾‹åå¤„ç†)
4. [SmartLifecycleç”Ÿå‘½å‘¨æœŸç®¡ç†](#4-SmartLifecycleç”Ÿå‘½å‘¨æœŸç®¡ç†)
5. [InitializingBeanåˆå§‹åŒ–å›è°ƒ](#5-InitializingBeanåˆå§‹åŒ–å›è°ƒ)
6. [DisposableBeané”€æ¯å›è°ƒ](#6-DisposableBeané”€æ¯å›è°ƒ)
7. [æ‰©å±•ç‚¹æ‰§è¡Œé¡ºåº](#7-æ‰©å±•ç‚¹æ‰§è¡Œé¡ºåº)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Beanæ‰©å±•ç‚¹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Beanæ‰©å±•ç‚¹


**ç®€å•ç†è§£**ï¼šBeanæ‰©å±•ç‚¹å°±åƒç»™Springå®¹å™¨å®‰è£…çš„"æ’ä»¶"ï¼Œè®©ä½ èƒ½åœ¨Beanåˆ›å»ºçš„ä¸åŒé˜¶æ®µæ’å…¥è‡ªå·±çš„é€»è¾‘ã€‚

```
æƒ³è±¡ä¸€ä¸‹å·¥å‚ç”Ÿäº§æµæ°´çº¿ï¼š
åŸææ–™ â†’ åŠ å·¥ â†’ è´¨æ£€ â†’ åŒ…è£… â†’ å‡ºå‚

Beanåˆ›å»ºä¹Ÿæ˜¯è¿™æ ·çš„æµæ°´çº¿ï¼š
é…ç½® â†’ åˆ›å»ºå·¥å‚ â†’ åˆ›å»ºå®ä¾‹ â†’ åˆå§‹åŒ– â†’ ä½¿ç”¨ â†’ é”€æ¯
  â†“       â†“         â†“        â†“      â†“      â†“
æ‰©å±•ç‚¹1  æ‰©å±•ç‚¹2   æ‰©å±•ç‚¹3   æ‰©å±•ç‚¹4  ä½¿ç”¨  æ‰©å±•ç‚¹5
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ‰©å±•ç‚¹


**å®é™…åœºæ™¯ä¸¾ä¾‹**ï¼š
- ğŸ“ **ä¿®æ”¹é…ç½®**ï¼šåœ¨Beanåˆ›å»ºå‰åŠ¨æ€ä¿®æ”¹é…ç½®ä¿¡æ¯
- ğŸ” **ç»Ÿä¸€å¤„ç†**ï¼šç»™æ‰€æœ‰Beanæ·»åŠ æ—¥å¿—ã€ç›‘æ§ã€ç¼“å­˜ç­‰åŠŸèƒ½
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šåœ¨Beanåˆå§‹åŒ–æ—¶é¢„çƒ­ç¼“å­˜ã€å»ºç«‹è¿æ¥
- ğŸ”§ **è‡ªå®šä¹‰é€»è¾‘**ï¼šåœ¨Beanç”Ÿå‘½å‘¨æœŸçš„å…³é”®èŠ‚ç‚¹æ‰§è¡Œç‰¹å®šæ“ä½œ

### 1.3 æ‰©å±•ç‚¹åˆ†ç±»


â”Œâ”€ Beanæ‰©å±•ç‚¹å®¶æ— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚ ğŸ­ **å·¥å‚çº§åˆ«**ï¼šBeanFactoryPostProcessor â”‚
â”‚ ğŸ“¦ **å®ä¾‹çº§åˆ«**ï¼šBeanPostProcessor        â”‚
â”‚ ğŸ”„ **ç”Ÿå‘½å‘¨æœŸ**ï¼šSmartLifecycle           â”‚
â”‚ ğŸš€ **åˆå§‹åŒ–**ï¼šInitializingBean          â”‚
â”‚ ğŸ’€ **é”€æ¯**ï¼šDisposableBean              â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## 2. ğŸ­ BeanFactoryPostProcessorå·¥å‚åå¤„ç†


### 2.1 åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šBeanFactoryPostProcessorå°±åƒå·¥å‚çš„"æ€»ç›‘"ï¼Œåœ¨æ‰€æœ‰Beanè¿˜æ²¡å¼€å§‹ç”Ÿäº§ä¹‹å‰ï¼Œå¯ä»¥æ£€æŸ¥å¹¶ä¿®æ”¹ç”Ÿäº§è®¡åˆ’ã€‚

**å·¥ä½œæ—¶æœº**ï¼š
```
å®¹å™¨å¯åŠ¨ â†’ è¯»å–é…ç½® â†’ ã€BeanFactoryPostProcessoræ‰§è¡Œã€‘ â†’ å¼€å§‹åˆ›å»ºBean
```

### 2.2 å…¸å‹åº”ç”¨åœºæ™¯


**ğŸ”§ é…ç½®å±æ€§æ›¿æ¢**ï¼š
- åŠ¨æ€æ›¿æ¢é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦
- æ ¹æ®ç¯å¢ƒä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯
- åŠ å¯†æ•æ„Ÿé…ç½®ä¿¡æ¯

**ğŸ“ Beanå®šä¹‰ä¿®æ”¹**ï¼š
- åŠ¨æ€ä¿®æ”¹Beançš„ä½œç”¨åŸŸ
- æ·»åŠ é¢å¤–çš„å±æ€§è®¾ç½®
- ä¿®æ”¹Beançš„ç±»å‹

### 2.3 å®é™…ä»£ç ç¤ºä¾‹


```java
@Component
public class CustomBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
        System.out.println("ğŸ­ å·¥å‚åå¤„ç†å™¨æ‰§è¡Œï¼šä¿®æ”¹Beanå®šä¹‰");
        
        // è·å–æ‰€æœ‰Beanå®šä¹‰çš„åç§°
        String[] beanNames = beanFactory.getBeanDefinitionNames();
        
        for (String beanName : beanNames) {
            BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanName);
            
            // ç¤ºä¾‹ï¼šç»™æ‰€æœ‰Serviceç±»æ·»åŠ å•ä¾‹ä½œç”¨åŸŸ
            if (beanName.endsWith("Service")) {
                beanDefinition.setScope("singleton");
                System.out.println("âœ… è®¾ç½® " + beanName + " ä¸ºå•ä¾‹æ¨¡å¼");
            }
        }
    }
}
```

**ğŸ¯ å…³é”®ç†è§£**ï¼š
- è¿™ä¸ªå¤„ç†å™¨åœ¨**æ‰€æœ‰Beanåˆ›å»ºä¹‹å‰**æ‰§è¡Œ
- å¯ä»¥è®¿é—®å’Œä¿®æ”¹**Beançš„é…ç½®ä¿¡æ¯**
- ä¸€æ—¦æ‰§è¡Œå®Œæ¯•ï¼Œå°±å¼€å§‹æŒ‰ç…§ä¿®æ”¹åçš„é…ç½®åˆ›å»ºBean

### 2.4 æ‰§è¡Œé¡ºåºæ§åˆ¶


```java
@Component
@Order(1)  // æ•°å­—è¶Šå°ï¼Œæ‰§è¡Œè¶Šæ—©
public class HighPriorityBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    // ä¼˜å…ˆæ‰§è¡Œçš„é€»è¾‘
}

@Component
@Order(2)
public class LowPriorityBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    // åæ‰§è¡Œçš„é€»è¾‘
}
```

---

## 3. ğŸ“¦ BeanPostProcessorå®ä¾‹åå¤„ç†


### 3.1 åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šBeanPostProcessoråƒæµæ°´çº¿ä¸Šçš„"è´¨æ£€å‘˜"ï¼Œæ¯ä¸ªBeanå®ä¾‹åˆ›å»ºæ—¶éƒ½ä¼šç»è¿‡å®ƒçš„æ£€æŸ¥å’Œå¤„ç†ã€‚

**å·¥ä½œæ—¶æœº**ï¼š
```
åˆ›å»ºBeanå®ä¾‹ â†’ ã€å‰ç½®å¤„ç†ã€‘ â†’ åˆå§‹åŒ–æ–¹æ³• â†’ ã€åç½®å¤„ç†ã€‘ â†’ å®Œæˆåˆ›å»º
```

### 3.2 ä¸¤ä¸ªå…³é”®æ–¹æ³•


**ğŸ” å‰ç½®å¤„ç†**ï¼šåœ¨Beanåˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ
**âœ… åç½®å¤„ç†**ï¼šåœ¨Beanåˆå§‹åŒ–ä¹‹åæ‰§è¡Œ

### 3.3 å®é™…ä»£ç ç¤ºä¾‹


```java
@Component
public class LoggingBeanPostProcessor implements BeanPostProcessor {
    
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) {
        if (beanName.endsWith("Service")) {
            System.out.println("ğŸ” å‰ç½®å¤„ç†ï¼š" + beanName + " å³å°†åˆå§‹åŒ–");
            
            // å¯ä»¥è¿”å›åŸå¯¹è±¡æˆ–åŒ…è£…å¯¹è±¡
            return bean;
        }
        return bean;
    }
    
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) {
        if (beanName.endsWith("Service")) {
            System.out.println("âœ… åç½®å¤„ç†ï¼š" + beanName + " åˆå§‹åŒ–å®Œæˆ");
            
            // ç¤ºä¾‹ï¼šåˆ›å»ºä»£ç†å¯¹è±¡æ·»åŠ æ—¥å¿—åŠŸèƒ½
            return createLoggingProxy(bean, beanName);
        }
        return bean;
    }
    
    private Object createLoggingProxy(Object target, String beanName) {
        // ç®€åŒ–çš„ä»£ç†åˆ›å»ºé€»è¾‘
        return Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy, method, args) -> {
                System.out.println("ğŸ“ è°ƒç”¨æ–¹æ³•ï¼š" + method.getName());
                Object result = method.invoke(target, args);
                System.out.println("âœ… æ–¹æ³•æ‰§è¡Œå®Œæˆ");
                return result;
            }
        );
    }
}
```

### 3.4 å¸¸è§åº”ç”¨åœºæ™¯


**ğŸ”§ AOPä»£ç†åˆ›å»º**ï¼š
- Springçš„@Transactionalæ³¨è§£å°±æ˜¯é€šè¿‡BeanPostProcessorå®ç°çš„
- åˆ›å»ºä»£ç†å¯¹è±¡æ·»åŠ æ¨ªåˆ‡å…³æ³¨ç‚¹

**ğŸ“ å±æ€§æ³¨å…¥å¢å¼º**ï¼š
- è‡ªå®šä¹‰æ³¨è§£å¤„ç†
- é…ç½®éªŒè¯
- ä¾èµ–æ³¨å…¥æ‰©å±•

---

## 4. ğŸ”„ SmartLifecycleç”Ÿå‘½å‘¨æœŸç®¡ç†


### 4.1 åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šSmartLifecycleå°±åƒç»™Beané…å¤‡äº†"å¼€å…³"ï¼Œè®©ä½ èƒ½æ§åˆ¶Beanä»€ä¹ˆæ—¶å€™å¯åŠ¨ã€ä»€ä¹ˆæ—¶å€™åœæ­¢ã€‚

**å…¸å‹åœºæ™¯**ï¼š
- ğŸŒ **ç½‘ç»œæœåŠ¡**ï¼šHTTPæœåŠ¡å™¨çš„å¯åŠ¨å’Œåœæ­¢
- ğŸ“¡ **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šæ¶ˆè´¹è€…çš„å¼€å¯å’Œå…³é—­
- â° **å®šæ—¶ä»»åŠ¡**ï¼šè°ƒåº¦å™¨çš„å¯åŠ¨å’Œåœæ­¢

### 4.2 å…³é”®æ–¹æ³•è¯´æ˜


```java
public interface SmartLifecycle extends Lifecycle, Phased {
    void start();        // å¯åŠ¨é€»è¾‘
    void stop();         // åœæ­¢é€»è¾‘
    boolean isRunning(); // è¿è¡ŒçŠ¶æ€æ£€æŸ¥
    int getPhase();      // æ‰§è¡Œé˜¶æ®µï¼ˆæ•°å­—è¶Šå°è¶Šæ—©æ‰§è¡Œï¼‰
    boolean isAutoStartup(); // æ˜¯å¦è‡ªåŠ¨å¯åŠ¨
}
```

### 4.3 å®é™…ä»£ç ç¤ºä¾‹


```java
@Component
public class MessageConsumerLifecycle implements SmartLifecycle {
    
    private boolean running = false;
    private ExecutorService executor;
    
    @Override
    public void start() {
        if (!running) {
            System.out.println("ğŸš€ å¯åŠ¨æ¶ˆæ¯æ¶ˆè´¹è€…");
            executor = Executors.newFixedThreadPool(2);
            
            // å¯åŠ¨æ¶ˆæ¯å¤„ç†çº¿ç¨‹
            executor.submit(() -> {
                while (running) {
                    // æ¨¡æ‹Ÿæ¶ˆæ¯å¤„ç†
                    System.out.println("ğŸ“¨ å¤„ç†æ¶ˆæ¯ä¸­...");
                    try {
                        Thread.sleep(2000);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt();
                        break;
                    }
                }
            });
            
            running = true;
            System.out.println("âœ… æ¶ˆæ¯æ¶ˆè´¹è€…å¯åŠ¨å®Œæˆ");
        }
    }
    
    @Override
    public void stop() {
        if (running) {
            System.out.println("â¹ï¸ åœæ­¢æ¶ˆæ¯æ¶ˆè´¹è€…");
            running = false;
            
            if (executor != null) {
                executor.shutdown();
                try {
                    if (!executor.awaitTermination(5, TimeUnit.SECONDS)) {
                        executor.shutdownNow();
                    }
                } catch (InterruptedException e) {
                    executor.shutdownNow();
                }
            }
            
            System.out.println("âœ… æ¶ˆæ¯æ¶ˆè´¹è€…å·²åœæ­¢");
        }
    }
    
    @Override
    public boolean isRunning() {
        return running;
    }
    
    @Override
    public int getPhase() {
        return 1000; // æ‰§è¡Œé˜¶æ®µï¼Œæ•°å­—è¶Šå¤§è¶Šæ™šæ‰§è¡Œ
    }
    
    @Override
    public boolean isAutoStartup() {
        return true; // å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨
    }
}
```

### 4.4 æ‰§è¡Œé˜¶æ®µè¯´æ˜


```
å®¹å™¨å¯åŠ¨é¡ºåºï¼ˆæŒ‰getPhase()å€¼ä»å°åˆ°å¤§ï¼‰ï¼š
Phase -100: åŸºç¡€æœåŠ¡å¯åŠ¨
Phase 0:    é»˜è®¤ç»„ä»¶å¯åŠ¨  
Phase 100:  ä¸šåŠ¡æœåŠ¡å¯åŠ¨
Phase 1000: æ¶ˆæ¯é˜Ÿåˆ—ç­‰å¯åŠ¨

å®¹å™¨åœæ­¢é¡ºåºï¼ˆç›¸åï¼‰ï¼š
Phase 1000: æ¶ˆæ¯é˜Ÿåˆ—ç­‰å…ˆåœæ­¢
Phase 100:  ä¸šåŠ¡æœåŠ¡åœæ­¢
Phase 0:    é»˜è®¤ç»„ä»¶åœæ­¢
Phase -100: åŸºç¡€æœåŠ¡æœ€ååœæ­¢
```

---

## 5. ğŸš€ InitializingBeanåˆå§‹åŒ–å›è°ƒ


### 5.1 åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šInitializingBeanå°±åƒç»™Beané…å¤‡äº†"å¼€æœºè‡ªæ£€"åŠŸèƒ½ï¼Œåœ¨Beanæ‰€æœ‰å±æ€§è®¾ç½®å®Œæ¯•åï¼Œè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ã€‚

**æ‰§è¡Œæ—¶æœº**ï¼š
```
åˆ›å»ºBeanå®ä¾‹ â†’ è®¾ç½®å±æ€§ â†’ ã€afterPropertiesSet()æ‰§è¡Œã€‘ â†’ Beanå¯ç”¨
```

### 5.2 ä½¿ç”¨åœºæ™¯


**ğŸ’¡ å¸¸è§ç”¨é€”**ï¼š
- ğŸ”— **å»ºç«‹è¿æ¥**ï¼šæ•°æ®åº“è¿æ¥æ± åˆå§‹åŒ–
- ğŸ“ **ç¼“å­˜é¢„çƒ­**ï¼šåŠ è½½å¸¸ç”¨æ•°æ®åˆ°å†…å­˜
- âœ… **é…ç½®éªŒè¯**ï¼šæ£€æŸ¥å¿…è¦é…ç½®æ˜¯å¦é½å…¨
- ğŸ—ï¸ **èµ„æºå‡†å¤‡**ï¼šåˆ›å»ºå¿…è¦çš„å·¥ä½œç›®å½•ã€æ–‡ä»¶ç­‰

### 5.3 å®é™…ä»£ç ç¤ºä¾‹


```java
@Component
public class CacheService implements InitializingBean {
    
    @Value("${cache.size:1000}")
    private int cacheSize;
    
    @Value("${cache.expireTime:3600}")
    private int expireTime;
    
    private Map<String, Object> cache;
    
    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("ğŸš€ CacheService å¼€å§‹åˆå§‹åŒ–...");
        
        // 1. éªŒè¯é…ç½®
        if (cacheSize <= 0) {
            throw new IllegalArgumentException("ç¼“å­˜å¤§å°å¿…é¡»å¤§äº0");
        }
        
        if (expireTime <= 0) {
            throw new IllegalArgumentException("è¿‡æœŸæ—¶é—´å¿…é¡»å¤§äº0");
        }
        
        // 2. åˆå§‹åŒ–ç¼“å­˜
        cache = new ConcurrentHashMap<>(cacheSize);
        
        // 3. é¢„çƒ­ç¼“å­˜ï¼ˆåŠ è½½å¸¸ç”¨æ•°æ®ï¼‰
        preloadCache();
        
        System.out.println("âœ… CacheService åˆå§‹åŒ–å®Œæˆï¼Œç¼“å­˜å¤§å°: " + cacheSize);
    }
    
    private void preloadCache() {
        // æ¨¡æ‹ŸåŠ è½½å¸¸ç”¨æ•°æ®
        cache.put("user:default", "é»˜è®¤ç”¨æˆ·ä¿¡æ¯");
        cache.put("config:system", "ç³»ç»Ÿé…ç½®ä¿¡æ¯");
        System.out.println("ğŸ“ ç¼“å­˜é¢„çƒ­å®Œæˆï¼Œå·²åŠ è½½ " + cache.size() + " ä¸ªæ¡ç›®");
    }
    
    public void put(String key, Object value) {
        cache.put(key, value);
    }
    
    public Object get(String key) {
        return cache.get(key);
    }
}
```

### 5.4 ä¸@PostConstructçš„å¯¹æ¯”


| ç‰¹æ€§ | **InitializingBean** | **@PostConstruct** |
|------|---------------------|-------------------|
| ğŸ”§ **å®ç°æ–¹å¼** | `å®ç°æ¥å£` | `æ³¨è§£æ ‡è®°` |
| âš¡ **æ‰§è¡Œé¡ºåº** | `è¾ƒæ™šæ‰§è¡Œ` | `è¾ƒæ—©æ‰§è¡Œ` |
| ğŸ¯ **é€‚ç”¨åœºæ™¯** | `Springç‰¹å®šé€»è¾‘` | `é€šç”¨åˆå§‹åŒ–é€»è¾‘` |
| ğŸ“š **ä»£ç è€¦åˆ** | `ä¸Springè€¦åˆ` | `æ ‡å‡†Javaæ³¨è§£` |

```java
@Component
public class ServiceExample implements InitializingBean {
    
    @PostConstruct
    public void postConstruct() {
        System.out.println("1ï¸âƒ£ @PostConstruct æ‰§è¡Œ");
    }
    
    @Override
    public void afterPropertiesSet() {
        System.out.println("2ï¸âƒ£ afterPropertiesSet æ‰§è¡Œ");
    }
}
```

---

## 6. ğŸ’€ DisposableBeané”€æ¯å›è°ƒ


### 6.1 åŸºæœ¬æ¦‚å¿µ


**é€šä¿—è§£é‡Š**ï¼šDisposableBeanå°±åƒç»™Beané…å¤‡äº†"å…³æœºæ¸…ç†"åŠŸèƒ½ï¼Œåœ¨Beanè¢«é”€æ¯å‰è‡ªåŠ¨æ‰§è¡Œæ¸…ç†é€»è¾‘ã€‚

**æ‰§è¡Œæ—¶æœº**ï¼š
```
å®¹å™¨å…³é—­ â†’ ã€destroy()æ‰§è¡Œã€‘ â†’ Beanè¢«é”€æ¯ â†’ é‡Šæ”¾å†…å­˜
```

### 6.2 ä½¿ç”¨åœºæ™¯


**ğŸ’¡ å¸¸è§ç”¨é€”**ï¼š
- ğŸ”Œ **å…³é—­è¿æ¥**ï¼šæ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰
- ğŸ’¾ **ä¿å­˜æ•°æ®**ï¼šå°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–
- ğŸ§¹ **æ¸…ç†èµ„æº**ï¼šé‡Šæ”¾æ–‡ä»¶å¥æŸ„ã€çº¿ç¨‹æ± ç­‰
- ğŸ“Š **ç»Ÿè®¡ä¸ŠæŠ¥**ï¼šå‘é€ä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯

### 6.3 å®é™…ä»£ç ç¤ºä¾‹


```java
@Component
public class FileProcessorService implements DisposableBean {
    
    private ExecutorService threadPool;
    private List<String> pendingFiles;
    private FileWriter logWriter;
    
    public FileProcessorService() throws IOException {
        this.threadPool = Executors.newFixedThreadPool(5);
        this.pendingFiles = new ArrayList<>();
        this.logWriter = new FileWriter("process.log", true);
        
        System.out.println("ğŸ“ FileProcessorService åˆ›å»ºå®Œæˆ");
    }
    
    @Override
    public void destroy() throws Exception {
        System.out.println("ğŸ§¹ FileProcessorService å¼€å§‹æ¸…ç†èµ„æº...");
        
        // 1. å¤„ç†æœªå®Œæˆçš„æ–‡ä»¶
        if (!pendingFiles.isEmpty()) {
            System.out.println("ğŸ“ å¤„ç†å‰©ä½™ " + pendingFiles.size() + " ä¸ªæ–‡ä»¶");
            for (String file : pendingFiles) {
                processFile(file);
            }
        }
        
        // 2. å…³é—­çº¿ç¨‹æ± 
        if (threadPool != null && !threadPool.isShutdown()) {
            System.out.println("â¹ï¸ å…³é—­çº¿ç¨‹æ± ...");
            threadPool.shutdown();
            
            try {
                if (!threadPool.awaitTermination(10, TimeUnit.SECONDS)) {
                    System.out.println("âš ï¸ çº¿ç¨‹æ± æœªèƒ½åŠæ—¶å…³é—­ï¼Œå¼ºåˆ¶å…³é—­");
                    threadPool.shutdownNow();
                }
            } catch (InterruptedException e) {
                threadPool.shutdownNow();
            }
        }
        
        // 3. å…³é—­æ–‡ä»¶å†™å…¥
        if (logWriter != null) {
            logWriter.write("åº”ç”¨å…³é—­æ—¶é—´: " + new Date() + "\n");
            logWriter.close();
            System.out.println("ğŸ“ æ—¥å¿—æ–‡ä»¶å·²å…³é—­");
        }
        
        System.out.println("âœ… FileProcessorService èµ„æºæ¸…ç†å®Œæˆ");
    }
    
    public void addFile(String fileName) {
        pendingFiles.add(fileName);
        System.out.println("â• æ·»åŠ å¾…å¤„ç†æ–‡ä»¶: " + fileName);
    }
    
    private void processFile(String fileName) {
        // æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†
        System.out.println("âš™ï¸ å¤„ç†æ–‡ä»¶: " + fileName);
        try {
            logWriter.write("å¤„ç†æ–‡ä»¶: " + fileName + " æ—¶é—´: " + new Date() + "\n");
            logWriter.flush();
        } catch (IOException e) {
            System.err.println("å†™å…¥æ—¥å¿—å¤±è´¥: " + e.getMessage());
        }
    }
}
```

### 6.4 ä¸@PreDestroyçš„å¯¹æ¯”


| ç‰¹æ€§ | **DisposableBean** | **@PreDestroy** |
|------|-------------------|-----------------|
| ğŸ”§ **å®ç°æ–¹å¼** | `å®ç°æ¥å£` | `æ³¨è§£æ ‡è®°` |
| âš¡ **æ‰§è¡Œé¡ºåº** | `è¾ƒæ™šæ‰§è¡Œ` | `è¾ƒæ—©æ‰§è¡Œ` |
| ğŸ¯ **é€‚ç”¨åœºæ™¯** | `Springç‰¹å®šæ¸…ç†` | `é€šç”¨æ¸…ç†é€»è¾‘` |
| ğŸ“š **ä»£ç è€¦åˆ** | `ä¸Springè€¦åˆ` | `æ ‡å‡†Javaæ³¨è§£` |

---

## 7. â±ï¸ æ‰©å±•ç‚¹æ‰§è¡Œé¡ºåº


### 7.1 å®Œæ•´æ‰§è¡Œæ—¶åº


```
å®¹å™¨å¯åŠ¨é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯»å–é…ç½®ä¿¡æ¯                             â”‚
â”‚ 2. BeanFactoryPostProcessor æ‰§è¡Œ ğŸ­        â”‚
â”‚ 3. å¼€å§‹åˆ›å»ºBeanå®ä¾‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Beanåˆ›å»ºé˜¶æ®µï¼ˆæ¯ä¸ªBeanéƒ½ä¼šç»å†ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å®ä¾‹åŒ–Beanå¯¹è±¡                           â”‚
â”‚ 2. è®¾ç½®å±æ€§å€¼                               â”‚
â”‚ 3. BeanPostProcessor.postProcessBefore... ğŸ“¦â”‚
â”‚ 4. @PostConstruct æ–¹æ³•æ‰§è¡Œ                  â”‚
â”‚ 5. InitializingBean.afterPropertiesSet ğŸš€  â”‚
â”‚ 6. BeanPostProcessor.postProcessAfter... ğŸ“¦ â”‚
â”‚ 7. SmartLifecycle.start() ğŸ”„               â”‚
â”‚ 8. Beanå¯ä»¥ä½¿ç”¨                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®¹å™¨å…³é—­é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SmartLifecycle.stop() ğŸ”„                â”‚
â”‚ 2. @PreDestroy æ–¹æ³•æ‰§è¡Œ                     â”‚
â”‚ 3. DisposableBean.destroy() ğŸ’€             â”‚
â”‚ 4. Beanè¢«é”€æ¯                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å®é™…æµ‹è¯•ç¤ºä¾‹


```java
@Component
public class LifecycleTestBean implements 
    BeanPostProcessor, InitializingBean, DisposableBean, SmartLifecycle {
    
    private boolean running = false;
    
    // BeanPostProcessoræ–¹æ³•
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) {
        if (bean instanceof LifecycleTestBean) {
            System.out.println("3ï¸âƒ£ BeanPostProcessorå‰ç½®å¤„ç†");
        }
        return bean;
    }
    
    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) {
        if (bean instanceof LifecycleTestBean) {
            System.out.println("6ï¸âƒ£ BeanPostProcessoråç½®å¤„ç†");
        }
        return bean;
    }
    
    // åˆå§‹åŒ–æ–¹æ³•
    @PostConstruct
    public void postConstruct() {
        System.out.println("4ï¸âƒ£ @PostConstructæ‰§è¡Œ");
    }
    
    @Override
    public void afterPropertiesSet() {
        System.out.println("5ï¸âƒ£ InitializingBean.afterPropertiesSetæ‰§è¡Œ");
    }
    
    // Lifecycleæ–¹æ³•
    @Override
    public void start() {
        System.out.println("7ï¸âƒ£ SmartLifecycle.startæ‰§è¡Œ");
        running = true;
    }
    
    @Override
    public void stop() {
        System.out.println("8ï¸âƒ£ SmartLifecycle.stopæ‰§è¡Œ");
        running = false;
    }
    
    @Override
    public boolean isRunning() {
        return running;
    }
    
    // é”€æ¯æ–¹æ³•
    @PreDestroy
    public void preDestroy() {
        System.out.println("9ï¸âƒ£ @PreDestroyæ‰§è¡Œ");
    }
    
    @Override
    public void destroy() {
        System.out.println("ğŸ”Ÿ DisposableBean.destroyæ‰§è¡Œ");
    }
    
    // æ„é€ æ–¹æ³•
    public LifecycleTestBean() {
        System.out.println("1ï¸âƒ£ Beanæ„é€ æ–¹æ³•æ‰§è¡Œ");
    }
    
    // å±æ€§è®¾ç½®ï¼ˆæ¨¡æ‹Ÿï¼‰
    @Value("${test.value:é»˜è®¤å€¼}")
    public void setTestValue(String value) {
        System.out.println("2ï¸âƒ£ å±æ€§è®¾ç½®ï¼š" + value);
    }
}
```

### 7.3 è¾“å‡ºç»“æœ


```
åº”ç”¨å¯åŠ¨æ—¶ï¼š
1ï¸âƒ£ Beanæ„é€ æ–¹æ³•æ‰§è¡Œ
2ï¸âƒ£ å±æ€§è®¾ç½®ï¼šé»˜è®¤å€¼
3ï¸âƒ£ BeanPostProcessorå‰ç½®å¤„ç†
4ï¸âƒ£ @PostConstructæ‰§è¡Œ
5ï¸âƒ£ InitializingBean.afterPropertiesSetæ‰§è¡Œ
6ï¸âƒ£ BeanPostProcessoråç½®å¤„ç†
7ï¸âƒ£ SmartLifecycle.startæ‰§è¡Œ

åº”ç”¨å…³é—­æ—¶ï¼š
8ï¸âƒ£ SmartLifecycle.stopæ‰§è¡Œ
9ï¸âƒ£ @PreDestroyæ‰§è¡Œ
ğŸ”Ÿ DisposableBean.destroyæ‰§è¡Œ
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ BeanFactoryPostProcessorï¼šå·¥å‚çº§æ‰©å±•ï¼Œä¿®æ”¹Beanå®šä¹‰
ğŸ”¸ BeanPostProcessorï¼šå®ä¾‹çº§æ‰©å±•ï¼Œå¤„ç†Beanå®ä¾‹
ğŸ”¸ SmartLifecycleï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ§åˆ¶å¯åœ
ğŸ”¸ InitializingBeanï¼šåˆå§‹åŒ–å›è°ƒï¼ŒBeanå‡†å¤‡å®Œæ¯•åæ‰§è¡Œ
ğŸ”¸ DisposableBeanï¼šé”€æ¯å›è°ƒï¼ŒBeané”€æ¯å‰æ‰§è¡Œ
ğŸ”¸ æ‰§è¡Œé¡ºåºï¼šä¸¥æ ¼æŒ‰ç…§Springå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ‰©å±•ç‚¹çš„é€‰æ‹©åŸåˆ™**
```
éœ€è¦ä¿®æ”¹Beané…ç½® â†’ BeanFactoryPostProcessor
éœ€è¦å¤„ç†Beanå®ä¾‹ â†’ BeanPostProcessor  
éœ€è¦æ§åˆ¶å¯åœæ—¶æœº â†’ SmartLifecycle
éœ€è¦åˆå§‹åŒ–é€»è¾‘ â†’ InitializingBean æˆ– @PostConstruct
éœ€è¦æ¸…ç†èµ„æº â†’ DisposableBean æˆ– @PreDestroy
```

**ğŸ”¹ æ‰§è¡Œæ—¶æœºçš„é‡è¦æ€§**
```
å·¥å‚åå¤„ç†å™¨ï¼šæœ€æ—©æ‰§è¡Œï¼Œå¯ä»¥ä¿®æ”¹Beanå®šä¹‰
å®ä¾‹åå¤„ç†å™¨ï¼šæ¯ä¸ªBeanéƒ½ä¼šç»è¿‡ï¼Œé€‚åˆç»Ÿä¸€å¤„ç†
ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šæ§åˆ¶ç»„ä»¶çš„å¯åŠ¨é¡ºåº
åˆå§‹åŒ–å›è°ƒï¼šBeanå‡†å¤‡å°±ç»ªï¼Œå¯ä»¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘
é”€æ¯å›è°ƒï¼šåº”ç”¨å…³é—­å‰ï¼Œæ¸…ç†èµ„æºé¿å…æ³„éœ²
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ æœ€ä½³å®è·µ**
- **åˆç†é€‰æ‹©**ï¼šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ‰©å±•ç‚¹
- **å¼‚å¸¸å¤„ç†**ï¼šæ‰©å±•ç‚¹ä¸­è¦åšå¥½å¼‚å¸¸å¤„ç†ï¼Œé¿å…å½±å“å®¹å™¨å¯åŠ¨
- **æ€§èƒ½è€ƒè™‘**ï¼šBeanPostProcessorä¼šå¤„ç†æ¯ä¸ªBeanï¼Œæ³¨æ„æ€§èƒ½å½±å“
- **èµ„æºç®¡ç†**ï¼šDisposableBeanä¸­åŠ¡å¿…é‡Šæ”¾èµ„æºï¼Œé¿å…å†…å­˜æ³„éœ²

**ğŸš€ è¿›é˜¶æŠ€å·§**
- ä½¿ç”¨@Orderæ§åˆ¶æ‰©å±•ç‚¹æ‰§è¡Œé¡ºåº
- ç»“åˆæ¡ä»¶æ³¨è§£å®ç°çµæ´»çš„æ‰©å±•ç‚¹å¯ç”¨
- é€šè¿‡BeanPostProcessorå®ç°è‡ªå®šä¹‰AOPåŠŸèƒ½
- åˆ©ç”¨SmartLifecycleå®ç°ä¼˜é›…çš„æœåŠ¡å¯åœ

**æ ¸å¿ƒè®°å¿†**ï¼š
- Beanæ‰©å±•ç‚¹è®©ä½ èƒ½åœ¨Springå®¹å™¨çš„å…³é”®èŠ‚ç‚¹æ’å…¥è‡ªå®šä¹‰é€»è¾‘
- æ¯ä¸ªæ‰©å±•ç‚¹éƒ½æœ‰ç‰¹å®šçš„èŒè´£å’Œæ‰§è¡Œæ—¶æœº
- ç†è§£æ‰§è¡Œé¡ºåºå¯¹äºè°ƒè¯•å’Œæ’é”™éå¸¸é‡è¦
- åˆç†ä½¿ç”¨æ‰©å±•ç‚¹å¯ä»¥å¤§å¤§æå‡åº”ç”¨çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§