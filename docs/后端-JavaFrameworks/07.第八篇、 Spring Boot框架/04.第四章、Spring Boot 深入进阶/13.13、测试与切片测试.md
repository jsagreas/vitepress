---
title: 13ã€æµ‹è¯•ä¸åˆ‡ç‰‡æµ‹è¯•
---
## ğŸ“š ç›®å½•

1. [æµ‹è¯•åŸºç¡€æ¦‚å¿µ](#1-æµ‹è¯•åŸºç¡€æ¦‚å¿µ)
2. [Spring Bootå®Œæ•´æµ‹è¯•](#2-Spring-Bootå®Œæ•´æµ‹è¯•)
3. [åˆ‡ç‰‡æµ‹è¯•è¯¦è§£](#3-åˆ‡ç‰‡æµ‹è¯•è¯¦è§£)
4. [é›†æˆæµ‹è¯•å®æˆ˜](#4-é›†æˆæµ‹è¯•å®æˆ˜)
5. [æ¨¡æ‹Ÿæµ‹è¯•æŠ€å·§](#5-æ¨¡æ‹Ÿæµ‹è¯•æŠ€å·§)
6. [æµ‹è¯•é…ç½®ç®¡ç†](#6-æµ‹è¯•é…ç½®ç®¡ç†)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æµ‹è¯•åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è½¯ä»¶æµ‹è¯•


**ğŸ” æµ‹è¯•çš„æœ¬è´¨ç†è§£**

æƒ³è±¡ä¸€ä¸‹ä½ ä¹°äº†ä¸€å°æ–°æ‰‹æœºï¼Œåœ¨æ­£å¼ä½¿ç”¨å‰ï¼Œä½ ä¼šåšä»€ä¹ˆï¼Ÿæ£€æŸ¥å±å¹•æ˜¯å¦æ­£å¸¸ã€æµ‹è¯•æ‘„åƒå¤´ã€è¯•è¯•å„ç§åŠŸèƒ½æŒ‰é”®...è¿™å°±æ˜¯æµ‹è¯•çš„æ€ç»´ï¼

> **è½¯ä»¶æµ‹è¯•**ï¼šå°±åƒç»™ä½ çš„ä»£ç åš"ä½“æ£€"ï¼Œç¡®ä¿å®ƒèƒ½æŒ‰ç…§é¢„æœŸå·¥ä½œï¼Œå‘ç°æ½œåœ¨é—®é¢˜å¹¶ä¿®å¤ã€‚

```
ç°å®ç”Ÿæ´»ä¸­çš„æµ‹è¯•æ€ç»´ï¼š
ä¹°è½¦ â†’ è¯•é©¾æ£€æŸ¥å„é¡¹åŠŸèƒ½
åšèœ â†’ å°å‘³é“è°ƒæ•´è°ƒæ–™  
ç›–æˆ¿ â†’ æ£€æŸ¥ç»“æ„å®‰å…¨æ€§
å†™ä»£ç  â†’ æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸
```

### 1.2 Spring Bootæµ‹è¯•çš„ä»·å€¼


**ğŸ’¡ ä¸ºä»€ä¹ˆè¦åšæµ‹è¯•ï¼Ÿ**

| **ä¸æµ‹è¯•çš„é£é™©** | **æµ‹è¯•çš„å¥½å¤„** |
|-----------------|---------------|
| ğŸš« ä¸Šçº¿åæ‰å‘ç°bug | âœ… æå‰å‘ç°é—®é¢˜ |
| ğŸš« ä¿®å¤æˆæœ¬é«˜æ˜‚ | âœ… é™ä½ç»´æŠ¤æˆæœ¬ |
| ğŸš« ç”¨æˆ·ä½“éªŒå·® | âœ… ä¿è¯ä»£ç è´¨é‡ |
| ğŸš« å›¢é˜Ÿåä½œå›°éš¾ | âœ… å¢å¼ºå¼€å‘ä¿¡å¿ƒ |

**ğŸ—ï¸ Spring Bootæµ‹è¯•å±‚æ¬¡**

```
æµ‹è¯•é‡‘å­—å¡”ï¼ˆä»ä¸‹åˆ°ä¸Šï¼‰:

        /\
       /  \
      /E2E \     â† ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå°‘é‡ï¼‰
     /æµ‹è¯•  \
    /________\
   /          \
  / é›†æˆæµ‹è¯•   \   â† æ¥å£æµ‹è¯•ï¼ˆé€‚é‡ï¼‰
 /______________\
/                \
/    å•å…ƒæµ‹è¯•     \  â† ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼ˆå¤§é‡ï¼‰
/__________________\
```

### 1.3 Spring Bootæµ‹è¯•æ³¨è§£å®¶æ—


**ğŸ·ï¸ æµ‹è¯•æ³¨è§£åˆ†ç±»ç†è§£**

æŠŠSpring Bootçš„æµ‹è¯•æ³¨è§£æƒ³è±¡æˆä¸åŒçš„"ä½“æ£€å¥—é¤"ï¼š

```
æµ‹è¯•æ³¨è§£åˆ†ç±»å›¾:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Spring Boot æµ‹è¯•æ³¨è§£                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å®Œæ•´æµ‹è¯•       â”‚   åˆ‡ç‰‡æµ‹è¯•       â”‚     å·¥å…·æµ‹è¯•        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ @SpringBootTest â”‚â€¢ @WebMvcTest    â”‚â€¢ @MockBean          â”‚
â”‚  (å…¨èº«ä½“æ£€)      â”‚  (æ£€æŸ¥ç½‘ç»œå±‚)    â”‚  (æ¨¡æ‹Ÿç»„ä»¶)         â”‚
â”‚                 â”‚â€¢ @DataJpaTest   â”‚â€¢ @TestConfiguration â”‚
â”‚                 â”‚  (æ£€æŸ¥æ•°æ®å±‚)    â”‚  (æµ‹è¯•é…ç½®)         â”‚
â”‚                 â”‚â€¢ @JsonTest      â”‚â€¢ @DirtiesContext    â”‚
â”‚                 â”‚  (æ£€æŸ¥JSON)     â”‚  (æ¸…ç†ç¯å¢ƒ)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸš€ Spring Bootå®Œæ•´æµ‹è¯•


### 2.1 @SpringBootTestè¯¦è§£


**ğŸª ä»€ä¹ˆæ˜¯@SpringBootTestï¼Ÿ**

`@SpringBootTest`å°±åƒç»™ä½ çš„æ•´ä¸ªSpring Bootåº”ç”¨åš"å…¨èº«ä½“æ£€"ï¼Œå®ƒä¼šå¯åŠ¨å®Œæ•´çš„åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå°±åƒçœŸå®è¿è¡Œåº”ç”¨ä¸€æ ·ã€‚

> **å½¢è±¡æ¯”å–»**ï¼šå¦‚æœæŠŠåº”ç”¨æ¯”ä½œä¸€è¾†æ±½è½¦ï¼Œ@SpringBootTestå°±æ˜¯æŠŠæ•´è¾†è½¦å¼€åˆ°è·¯ä¸Šè·‘ä¸€åœˆï¼Œæµ‹è¯•æ‰€æœ‰éƒ¨ä»¶ååŒå·¥ä½œçš„æ•ˆæœã€‚

**ğŸ”§ åŸºç¡€ä½¿ç”¨æ–¹å¼**

```java
@SpringBootTest
class UserServiceTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    void shouldCreateUser() {
        // è¿™é‡Œå°±åƒåœ¨çœŸå®ç¯å¢ƒä¸­æµ‹è¯•
        User user = userService.createUser("å¼ ä¸‰", "zhang@test.com");
        
        assertThat(user.getName()).isEqualTo("å¼ ä¸‰");
        assertThat(user.getEmail()).isEqualTo("zhang@test.com");
    }
}
```

### 2.2 æµ‹è¯•å¯åŠ¨æ¨¡å¼è¯¦è§£


**ğŸ­ ä¸‰ç§å¯åŠ¨æ¨¡å¼å¯¹æ¯”**

Spring Bootæä¾›äº†ä¸‰ç§æµ‹è¯•"å¼ºåº¦"ï¼Œå°±åƒä½“æ£€æœ‰åŸºç¡€ç‰ˆã€æ ‡å‡†ç‰ˆã€è±ªåç‰ˆï¼š

| **å¯åŠ¨æ¨¡å¼** | **è¯´æ˜** | **ä»€ä¹ˆæ—¶å€™ç”¨** | **å¯åŠ¨é€Ÿåº¦** |
|-------------|---------|---------------|-------------|
| `MOCK` | æ¨¡æ‹ŸWebç¯å¢ƒ | æµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦çœŸå®HTTP | âš¡ æœ€å¿« |
| `RANDOM_PORT` | éšæœºç«¯å£å¯åŠ¨ | éœ€è¦çœŸå®HTTPè°ƒç”¨ | ğŸŒ è¾ƒæ…¢ |
| `DEFINED_PORT` | å›ºå®šç«¯å£å¯åŠ¨ | éœ€è¦å›ºå®šç«¯å£æµ‹è¯• | ğŸŒ æœ€æ…¢ |

```java
// æ¨¡æ‹Ÿæ¨¡å¼ - æœ€è½»é‡
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)
class MockWebTest {
    // ä¸å¯åŠ¨çœŸå®æœåŠ¡å™¨ï¼Œé€Ÿåº¦å¿«
}

// éšæœºç«¯å£ - çœŸå®HTTPç¯å¢ƒ  
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class IntegrationTest {
    
    @LocalServerPort
    private int port; // è·å–éšæœºåˆ†é…çš„ç«¯å£å·
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Test
    void shouldGetUser() {
        String url = "http://localhost:" + port + "/users/1";
        User user = restTemplate.getForObject(url, User.class);
        assertThat(user).isNotNull();
    }
}
```

### 2.3 å®Œæ•´æµ‹è¯•å®æˆ˜æ¡ˆä¾‹


**ğŸ“ ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæµ‹è¯•**

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…å«åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ç”¨æˆ·ï¼š

```java
@SpringBootTest
@TestPropertySource(properties = {
    "spring.datasource.url=jdbc:h2:mem:testdb",
    "spring.jpa.hibernate.ddl-auto=create-drop"
})
class UserManagementIntegrationTest {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @DisplayName("ç”¨æˆ·å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµ‹è¯•")
    void userLifecycleTest() {
        // 1. åˆ›å»ºç”¨æˆ·
        User newUser = userService.createUser("æå››", "lisi@test.com");
        assertThat(newUser.getId()).isNotNull();
        
        // 2. æŸ¥è¯¢ç”¨æˆ·
        User foundUser = userService.findById(newUser.getId());
        assertThat(foundUser.getName()).isEqualTo("æå››");
        
        // 3. æ›´æ–°ç”¨æˆ·
        foundUser.setName("æå››æ”¹å");
        User updatedUser = userService.updateUser(foundUser);
        assertThat(updatedUser.getName()).isEqualTo("æå››æ”¹å");
        
        // 4. åˆ é™¤ç”¨æˆ·
        userService.deleteUser(updatedUser.getId());
        assertThat(userRepository.findById(updatedUser.getId()))
            .isEmpty();
    }
}
```

---

## 3. âœ‚ï¸ åˆ‡ç‰‡æµ‹è¯•è¯¦è§£


### 3.1 åˆ‡ç‰‡æµ‹è¯•çš„æ€ç»´


**ğŸ• ä»€ä¹ˆæ˜¯åˆ‡ç‰‡æµ‹è¯•ï¼Ÿ**

æƒ³è±¡ä½ è¦æ£€æŸ¥ä¸€ä¸ªæŠ«è¨çš„è´¨é‡ï¼Œä½ ä¸éœ€è¦æŠŠæ•´ä¸ªæŠ«è¨éƒ½åƒæ‰ï¼Œåªéœ€è¦åˆ‡ä¸€å°ç‰‡å°å°å°±çŸ¥é“å¥½åã€‚åˆ‡ç‰‡æµ‹è¯•å°±æ˜¯è¿™ä¸ªé“ç†ï¼

> **åˆ‡ç‰‡æµ‹è¯•**ï¼šåªåŠ è½½åº”ç”¨çš„ç‰¹å®š"åˆ‡ç‰‡"æ¥æµ‹è¯•ï¼Œæ¯”å¦‚åªæµ‹è¯•Webå±‚ã€åªæµ‹è¯•æ•°æ®å±‚ï¼Œé€Ÿåº¦å¿«ã€èŒƒå›´ç²¾ç¡®ã€‚

```
åº”ç”¨åˆ†å±‚åˆ‡ç‰‡ç¤ºæ„:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å®Œæ•´åº”ç”¨                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â† @SpringBootTest (æµ‹è¯•å…¨éƒ¨)
â”‚  â”‚         Webå±‚                   â”‚    â”‚ â† @WebMvcTest (åªæµ‹è¿™å±‚)
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚       Serviceå±‚                 â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  
â”‚  â”‚        Dataå±‚                   â”‚    â”‚ â† @DataJpaTest (åªæµ‹è¿™å±‚)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 @WebMvcTest - Webå±‚æµ‹è¯•


**ğŸŒ ä¸“é—¨æµ‹è¯•Controllerå±‚**

`@WebMvcTest`å°±åƒä¸“é—¨æ£€æŸ¥æ±½è½¦çš„"æ–¹å‘ç›˜å’Œä»ªè¡¨ç›˜"ï¼Œåªå…³æ³¨Webå±‚çš„åŠŸèƒ½ã€‚

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- æµ‹è¯•Controllerçš„è¯·æ±‚å¤„ç†
- éªŒè¯URLè·¯ç”±æ˜¯å¦æ­£ç¡®  
- æ£€æŸ¥è¯·æ±‚å‚æ•°ç»‘å®š
- æµ‹è¯•è¿”å›æ•°æ®æ ¼å¼

```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean  // æ¨¡æ‹ŸServiceå±‚ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒå®ƒçš„å…·ä½“å®ç°
    private UserService userService;
    
    @Test
    @DisplayName("è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£æµ‹è¯•")
    void shouldReturnUserInfo() throws Exception {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        User mockUser = new User(1L, "ç‹äº”", "wangwu@test.com");
        when(userService.findById(1L)).thenReturn(mockUser);
        
        // æ‰§è¡ŒHTTPè¯·æ±‚æµ‹è¯•
        mockMvc.perform(get("/users/1"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.name").value("ç‹äº”"))
            .andExpect(jsonPath("$.email").value("wangwu@test.com"));
    }
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ·æ¥å£æµ‹è¯•")
    void shouldCreateUser() throws Exception {
        User newUser = new User(null, "èµµå…­", "zhaoliu@test.com");
        User savedUser = new User(2L, "èµµå…­", "zhaoliu@test.com");
        
        when(userService.createUser(any(), any())).thenReturn(savedUser);
        
        mockMvc.perform(post("/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"name\":\"èµµå…­\",\"email\":\"zhaoliu@test.com\"}"))
            .andExpect(status().isCreated())
            .andExpect(jsonPath("$.id").value(2))
            .andExpect(jsonPath("$.name").value("èµµå…­"));
    }
}
```

### 3.3 @DataJpaTest - æ•°æ®å±‚æµ‹è¯•


**ğŸ’¾ ä¸“é—¨æµ‹è¯•æ•°æ®åº“æ“ä½œ**

`@DataJpaTest`å°±åƒä¸“é—¨æ£€æŸ¥æ±½è½¦çš„"å‘åŠ¨æœº"ï¼Œåªå…³æ³¨æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- æµ‹è¯•Repositoryæ¥å£
- éªŒè¯SQLæŸ¥è¯¢é€»è¾‘
- æµ‹è¯•æ•°æ®å…³ç³»æ˜ å°„
- æ£€æŸ¥æ•°æ®éªŒè¯è§„åˆ™

```java
@DataJpaTest
class UserRepositoryTest {
    
    @Autowired
    private TestEntityManager entityManager;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @DisplayName("æ ¹æ®é‚®ç®±æŸ¥æ‰¾ç”¨æˆ·æµ‹è¯•")
    void shouldFindUserByEmail() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        User user = new User("æµ‹è¯•ç”¨æˆ·", "test@example.com");
        entityManager.persistAndFlush(user);
        
        // æ‰§è¡ŒæŸ¥è¯¢æµ‹è¯•
        Optional<User> found = userRepository.findByEmail("test@example.com");
        
        assertThat(found).isPresent();
        assertThat(found.get().getName()).isEqualTo("æµ‹è¯•ç”¨æˆ·");
    }
    
    @Test
    @DisplayName("ç”¨æˆ·åæ¨¡ç³ŠæŸ¥è¯¢æµ‹è¯•")
    void shouldFindUsersByNameContaining() {
        // å‡†å¤‡å¤šä¸ªç”¨æˆ·æ•°æ®
        entityManager.persist(new User("å¼ å°æ˜", "zhang@test.com"));
        entityManager.persist(new User("æå°çº¢", "li@test.com"));
        entityManager.persist(new User("ç‹å°åˆš", "wang@test.com"));
        entityManager.flush();
        
        // æµ‹è¯•æ¨¡ç³ŠæŸ¥è¯¢
        List<User> users = userRepository.findByNameContaining("å°");
        
        assertThat(users).hasSize(3);
        assertThat(users).extracting(User::getName)
            .contains("å¼ å°æ˜", "æå°çº¢", "ç‹å°åˆš");
    }
}
```

### 3.4 @JsonTest - JSONå¤„ç†æµ‹è¯•


**ğŸ“„ ä¸“é—¨æµ‹è¯•JSONåºåˆ—åŒ–**

`@JsonTest`å°±åƒæ£€æŸ¥æ±½è½¦çš„"ä¿¡æ¯æ˜¾ç¤ºå±"ï¼Œç¡®ä¿æ•°æ®èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œä¼ è¾“ã€‚

```java
@JsonTest
class UserJsonTest {
    
    @Autowired
    private JacksonTester<User> json;
    
    @Test
    @DisplayName("ç”¨æˆ·å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONæµ‹è¯•")
    void shouldSerializeUser() throws Exception {
        User user = new User(1L, "JSONæµ‹è¯•ç”¨æˆ·", "json@test.com");
        
        JsonContent<User> result = json.write(user);
        
        assertThat(result).hasJsonPathStringValue("$.name");
        assertThat(result).extractingJsonPathStringValue("$.name")
            .isEqualTo("JSONæµ‹è¯•ç”¨æˆ·");
        assertThat(result).hasJsonPathStringValue("$.email");
    }
    
    @Test
    @DisplayName("JSONååºåˆ—åŒ–ä¸ºç”¨æˆ·å¯¹è±¡æµ‹è¯•")
    void shouldDeserializeUser() throws Exception {
        String jsonString = """
            {
                "id": 1,
                "name": "ååºåˆ—åŒ–ç”¨æˆ·", 
                "email": "deserialize@test.com"
            }
            """;
        
        ObjectContent<User> result = json.parse(jsonString);
        
        assertThat(result).usingRecursiveComparison()
            .isEqualTo(new User(1L, "ååºåˆ—åŒ–ç”¨æˆ·", "deserialize@test.com"));
    }
}
```

---

## 4. ğŸ”„ é›†æˆæµ‹è¯•å®æˆ˜


### 4.1 TestRestTemplateè¯¦è§£


**ğŸš€ ä»€ä¹ˆæ˜¯TestRestTemplateï¼Ÿ**

æŠŠ`TestRestTemplate`æƒ³è±¡æˆä½ çš„"æµ‹è¯•åŠ©æ‰‹"ï¼Œå®ƒå¸®ä½ å‘é€å„ç§HTTPè¯·æ±‚ï¼Œå°±åƒç”¨æµè§ˆå™¨æˆ–Postmanæµ‹è¯•æ¥å£ä¸€æ ·ã€‚

> **æ ¸å¿ƒä½œç”¨**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­æ¨¡æ‹ŸçœŸå®çš„HTTPå®¢æˆ·ç«¯è¡Œä¸ºï¼Œæµ‹è¯•å®Œæ•´çš„è¯·æ±‚-å“åº”æµç¨‹ã€‚

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class UserApiIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @LocalServerPort
    private int port;
    
    private String baseUrl() {
        return "http://localhost:" + port;
    }
    
    @Test
    @DisplayName("ç”¨æˆ·CRUDå®Œæ•´æµç¨‹æµ‹è¯•")
    void userCrudIntegrationTest() {
        // 1. åˆ›å»ºç”¨æˆ·
        User newUser = new User("é›†æˆæµ‹è¯•ç”¨æˆ·", "integration@test.com");
        ResponseEntity<User> createResponse = restTemplate.postForEntity(
            baseUrl() + "/users", newUser, User.class);
        
        assertThat(createResponse.getStatusCode()).isEqualTo(HttpStatus.CREATED);
        User createdUser = createResponse.getBody();
        assertThat(createdUser.getId()).isNotNull();
        
        // 2. æŸ¥è¯¢ç”¨æˆ·
        ResponseEntity<User> getResponse = restTemplate.getForEntity(
            baseUrl() + "/users/" + createdUser.getId(), User.class);
        
        assertThat(getResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(getResponse.getBody().getName()).isEqualTo("é›†æˆæµ‹è¯•ç”¨æˆ·");
        
        // 3. æ›´æ–°ç”¨æˆ·
        createdUser.setName("æ›´æ–°åçš„ç”¨æˆ·å");
        restTemplate.put(baseUrl() + "/users/" + createdUser.getId(), createdUser);
        
        // 4. éªŒè¯æ›´æ–°
        User updatedUser = restTemplate.getForObject(
            baseUrl() + "/users/" + createdUser.getId(), User.class);
        assertThat(updatedUser.getName()).isEqualTo("æ›´æ–°åçš„ç”¨æˆ·å");
    }
}
```

### 4.2 å¤æ‚åœºæ™¯é›†æˆæµ‹è¯•


**ğŸ“Š æµ‹è¯•ç”¨æˆ·ç»Ÿè®¡åŠŸèƒ½**

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@TestMethodOrder(OrderAnnotation.class)
class UserStatisticsIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @LocalServerPort  
    private int port;
    
    @Test
    @Order(1)
    @DisplayName("æ‰¹é‡åˆ›å»ºç”¨æˆ·æµ‹è¯•")
    void shouldCreateMultipleUsers() {
        List<String> userNames = Arrays.asList("ç”¨æˆ·1", "ç”¨æˆ·2", "ç”¨æˆ·3");
        
        for (String name : userNames) {
            User user = new User(name, name.toLowerCase() + "@test.com");
            ResponseEntity<User> response = restTemplate.postForEntity(
                "http://localhost:" + port + "/users", user, User.class);
            assertThat(response.getStatusCode()).isEqualTo(HttpStatus.CREATED);
        }
    }
    
    @Test
    @Order(2)
    @DisplayName("ç”¨æˆ·ç»Ÿè®¡æŸ¥è¯¢æµ‹è¯•")
    void shouldGetUserStatistics() {
        ResponseEntity<UserStatistics> response = restTemplate.getForEntity(
            "http://localhost:" + port + "/users/statistics", UserStatistics.class);
        
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        UserStatistics stats = response.getBody();
        assertThat(stats.getTotalUsers()).isGreaterThanOrEqualTo(3);
    }
}
```

---

## 5. ğŸ­ æ¨¡æ‹Ÿæµ‹è¯•æŠ€å·§


### 5.1 MockMvcæ·±å…¥ä½¿ç”¨


**ğŸª MockMvcçš„å¼ºå¤§åŠŸèƒ½**

`MockMvc`å°±åƒä¸€ä¸ª"è™šæ‹Ÿæµè§ˆå™¨"ï¼Œèƒ½æ¨¡æ‹Ÿå„ç§å¤æ‚çš„HTTPè¯·æ±‚åœºæ™¯ã€‚

**ğŸ› ï¸ é«˜çº§æµ‹è¯•æŠ€å·§**

```java
@WebMvcTest(UserController.class)
class AdvancedMockMvcTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    @DisplayName("å¤æ‚æŸ¥è¯¢å‚æ•°æµ‹è¯•")
    void shouldHandleComplexQueryParams() throws Exception {
        List<User> mockUsers = Arrays.asList(
            new User("å¼ ä¸‰", "zhang@test.com"),
            new User("æå››", "li@test.com")
        );
        when(userService.searchUsers(any(), any(), any())).thenReturn(mockUsers);
        
        mockMvc.perform(get("/users/search")
                .param("name", "å¼ ")
                .param("email", "@test.com")
                .param("page", "0")
                .param("size", "10")
                .header("Authorization", "Bearer test-token"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$", hasSize(2)))
            .andExpected(header().string("Content-Type", 
                containsString("application/json")));
    }
    
    @Test
    @DisplayName("æ–‡ä»¶ä¸Šä¼ æµ‹è¯•")
    void shouldHandleFileUpload() throws Exception {
        MockMultipartFile file = new MockMultipartFile(
            "avatar", "test.jpg", "image/jpeg", "test image content".getBytes());
        
        when(userService.updateAvatar(eq(1L), any())).thenReturn("upload-success");
        
        mockMvc.perform(multipart("/users/1/avatar")
                .file(file))
            .andExpect(status().isOk())
            .andExpected(content().string("upload-success"));
    }
}
```

### 5.2 @MockBean vs @Mock å¯¹æ¯”


**ğŸ¤” ä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ**

| **æ³¨è§£** | **ä½¿ç”¨åœºæ™¯** | **å·¥ä½œåŸç†** | **ç¤ºä¾‹** |
|---------|-------------|-------------|---------|
| `@MockBean` | Springæµ‹è¯•ç¯å¢ƒä¸­ | æ›¿æ¢Springå®¹å™¨ä¸­çš„Bean | Webå±‚æµ‹è¯•mock Service |
| `@Mock` | çº¯å•å…ƒæµ‹è¯• | Mockitoç›´æ¥åˆ›å»ºmockå¯¹è±¡ | Serviceå±‚æµ‹è¯•mock Repository |

```java
// @MockBean ç¤ºä¾‹ - åœ¨Springç¯å¢ƒä¸­ä½¿ç”¨
@WebMvcTest(UserController.class)
class SpringMockTest {
    
    @MockBean  // Springä¼šç”¨è¿™ä¸ªmockæ›¿æ¢å®¹å™¨ä¸­çš„çœŸå®Bean
    private UserService userService;
    
    @Test
    void testWithSpringContext() {
        // Springä¼šè‡ªåŠ¨æ³¨å…¥mockå¯¹è±¡åˆ°Controllerä¸­
    }
}

// @Mock ç¤ºä¾‹ - çº¯å•å…ƒæµ‹è¯•
@ExtendWith(MockitoExtension.class)
class PureUnitTest {
    
    @Mock  // çº¯Mockito mockï¼Œä¸æ¶‰åŠSpring
    private UserRepository userRepository;
    
    @InjectMocks  // å°†mockæ³¨å…¥åˆ°è¢«æµ‹è¯•å¯¹è±¡ä¸­
    private UserService userService;
    
    @Test
    void testBusinessLogicOnly() {
        // åªæµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ¶‰åŠSpringå®¹å™¨
    }
}
```

---

## 6. âš™ï¸ æµ‹è¯•é…ç½®ç®¡ç†


### 6.1 æµ‹è¯•é…ç½®éš”ç¦»


**ğŸ  ä¸ºä»€ä¹ˆéœ€è¦æµ‹è¯•é…ç½®ï¼Ÿ**

æƒ³è±¡ä½ åœ¨å®¶é‡Œï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰å’Œå®éªŒå®¤ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰åšåŒä¸€ä¸ªå®éªŒï¼Œéœ€è¦çš„è®¾å¤‡å’Œç¯å¢ƒæ˜¯ä¸ä¸€æ ·çš„ã€‚æµ‹è¯•é…ç½®å°±æ˜¯ä¸ºäº†åˆ›é€ ä¸€ä¸ª"å¹²å‡€çš„å®éªŒå®¤ç¯å¢ƒ"ã€‚

**ğŸ“ é…ç½®æ–‡ä»¶ç»„ç»‡**

```
æµ‹è¯•é…ç½®æ–‡ä»¶ç»“æ„:

src/
â”œâ”€â”€ main/
â”‚   â””â”€â”€ resources/
â”‚       â””â”€â”€ application.yml          â† ç”Ÿäº§é…ç½®
â””â”€â”€ test/
    â””â”€â”€ resources/
        â”œâ”€â”€ application-test.yml     â† æµ‹è¯•é€šç”¨é…ç½®
        â”œâ”€â”€ application-h2.yml      â† å†…å­˜æ•°æ®åº“é…ç½®
        â””â”€â”€ test-data.sql           â† æµ‹è¯•æ•°æ®è„šæœ¬
```

**âš¡ æµ‹è¯•ä¸“ç”¨é…ç½®ç¤ºä¾‹**

```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
  
# ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½
management:
  endpoints:
    enabled-by-default: false

# æµ‹è¯•ä¸“ç”¨çš„ä¸šåŠ¡é…ç½®
app:
  test-mode: true
  email-enabled: false
  cache-enabled: false
```

### 6.2 ä½¿ç”¨@TestConfiguration


**ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•é…ç½®**

`@TestConfiguration`å°±åƒç»™æµ‹è¯•ç¯å¢ƒ"é‡èº«å®šåˆ¶"ç‰¹æ®Šé…ç½®ã€‚

```java
@TestConfiguration
public class TestConfig {
    
    @Bean
    @Primary  // ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªBeanæ›¿æ¢ç”Ÿäº§ç¯å¢ƒçš„Bean
    public EmailService mockEmailService() {
        return Mockito.mock(EmailService.class);
    }
    
    @Bean
    public TestDataInitializer testDataInitializer() {
        return new TestDataInitializer();
    }
}

// åœ¨æµ‹è¯•ä¸­ä½¿ç”¨
@SpringBootTest
@Import(TestConfig.class)  // å¯¼å…¥æµ‹è¯•é…ç½®
class ServiceWithCustomConfigTest {
    
    @Autowired
    private UserService userService;
    
    @Autowired  
    private EmailService emailService; // è¿™é‡Œæ³¨å…¥çš„æ˜¯mockå¯¹è±¡
    
    @Test
    void shouldNotSendRealEmail() {
        userService.registerUser("test@example.com", "password");
        
        // éªŒè¯æ²¡æœ‰å‘é€çœŸå®é‚®ä»¶ï¼Œåªæ˜¯è°ƒç”¨äº†mock
        verify(emailService, times(1)).sendWelcomeEmail(any());
    }
}
```

### 6.3 æ•°æ®åº“æµ‹è¯•æœ€ä½³å®è·µ


**ğŸ’¾ æµ‹è¯•æ•°æ®ç®¡ç†ç­–ç•¥**

```java
@SpringBootTest
@Transactional  // æ¯ä¸ªæµ‹è¯•æ–¹æ³•ç»“æŸåè‡ªåŠ¨å›æ»š
@TestPropertySource(properties = {
    "spring.jpa.hibernate.ddl-auto=create-drop",
    "spring.datasource.url=jdbc:h2:mem:testdb"
})
class DatabaseTestExample {
    
    @Autowired
    private UserRepository userRepository;
    
    @BeforeEach
    void setUp() {
        // æ¯ä¸ªæµ‹è¯•å‰å‡†å¤‡å¹²å‡€çš„æ•°æ®
        userRepository.deleteAll();
        
        // æ’å…¥æµ‹è¯•æ‰€éœ€çš„åŸºç¡€æ•°æ®
        User adminUser = new User("ç®¡ç†å‘˜", "admin@test.com");
        adminUser.setRole("ADMIN");
        userRepository.save(adminUser);
    }
    
    @Test
    @Sql("/test-data/users.sql")  // ä»SQLæ–‡ä»¶åŠ è½½æµ‹è¯•æ•°æ®
    void shouldFindUsersByRole() {
        List<User> admins = userRepository.findByRole("ADMIN");
        assertThat(admins).isNotEmpty();
    }
    
    @Test
    @DirtiesContext  // è¿™ä¸ªæµ‹è¯•ä¼š"å¼„è„"Springä¸Šä¸‹æ–‡ï¼Œæµ‹è¯•åé‡æ–°åŠ è½½
    void shouldHandleLargeDataSet() {
        // æµ‹è¯•å¤§é‡æ•°æ®çš„æƒ…å†µ
        for (int i = 0; i < 1000; i++) {
            userRepository.save(new User("ç”¨æˆ·" + i, "user" + i + "@test.com"));
        }
        
        long count = userRepository.count();
        assertThat(count).isGreaterThan(999);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æµ‹è¯•åˆ†å±‚ï¼šå•å…ƒæµ‹è¯• > é›†æˆæµ‹è¯• > ç«¯åˆ°ç«¯æµ‹è¯•
ğŸ”¸ å®Œæ•´æµ‹è¯•ï¼š@SpringBootTest å¯åŠ¨å®Œæ•´åº”ç”¨ä¸Šä¸‹æ–‡
ğŸ”¸ åˆ‡ç‰‡æµ‹è¯•ï¼š@WebMvcTestã€@DataJpaTest æµ‹è¯•ç‰¹å®šå±‚
ğŸ”¸ æ¨¡æ‹Ÿå¯¹è±¡ï¼š@MockBean åœ¨Springç¯å¢ƒä¸­æ¨¡æ‹Ÿä¾èµ–
ğŸ”¸ é…ç½®éš”ç¦»ï¼šæµ‹è¯•ä¸“ç”¨é…ç½®ï¼Œä¸å½±å“ç”Ÿäº§ç¯å¢ƒ
ğŸ”¸ æ•°æ®ç®¡ç†ï¼š@Transactional ç¡®ä¿æµ‹è¯•æ•°æ®éš”ç¦»
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é€‰æ‹©åˆé€‚çš„æµ‹è¯•ç­–ç•¥**
```
å¿«é€Ÿåé¦ˆï¼šä¼˜å…ˆä½¿ç”¨åˆ‡ç‰‡æµ‹è¯•ï¼ˆ@WebMvcTestã€@DataJpaTestï¼‰
å®Œæ•´éªŒè¯ï¼šä½¿ç”¨é›†æˆæµ‹è¯•ï¼ˆ@SpringBootTestï¼‰
å¤æ‚åœºæ™¯ï¼šç»“åˆTestRestTemplateå’ŒMockMvc
```

**ğŸ”¹ æµ‹è¯•é…ç½®çš„é‡è¦æ€§**
```
éš”ç¦»æ€§ï¼šæµ‹è¯•ä¸èƒ½ç›¸äº’å½±å“ï¼Œä¸èƒ½å½±å“ç”Ÿäº§æ•°æ®
å¯é‡å¤æ€§ï¼šåŒä¸€ä¸ªæµ‹è¯•å¤šæ¬¡è¿è¡Œç»“æœåº”è¯¥ä¸€è‡´
ç‹¬ç«‹æ€§ï¼šæµ‹è¯•åº”è¯¥èƒ½åœ¨ä»»ä½•ç¯å¢ƒä¸­ç‹¬ç«‹è¿è¡Œ
```

**ğŸ”¹ Mock vs çœŸå®ä¾èµ–çš„é€‰æ‹©**
```
ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼šä½¿ç”¨Mockï¼Œèšç„¦æ ¸å¿ƒé€»è¾‘
é›†æˆæµ‹è¯•ï¼šä½¿ç”¨çœŸå®ä¾èµ–ï¼ŒéªŒè¯ç»„ä»¶åä½œ
å¤–éƒ¨ç³»ç»Ÿï¼šä¼˜å…ˆä½¿ç”¨Mockï¼Œé¿å…æµ‹è¯•ä¸ç¨³å®š
```

### 7.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ’¼ ä¼ä¸šå¼€å‘å®è·µ**
- **æŒç»­é›†æˆ**ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•ä¿è¯ä»£ç è´¨é‡
- **é‡æ„ä¿¡å¿ƒ**ï¼šå®Œå–„çš„æµ‹è¯•è®©é‡æ„æ›´å®‰å…¨
- **æ–‡æ¡£ä»·å€¼**ï¼šæµ‹è¯•ä»£ç å°±æ˜¯æœ€å¥½çš„ä½¿ç”¨æ–‡æ¡£
- **å›¢é˜Ÿåä½œ**ï¼šæµ‹è¯•è§„èŒƒç»Ÿä¸€å›¢é˜Ÿå¼€å‘æ ‡å‡†

**ğŸ¯ æµ‹è¯•é‡‘å­—å¡”å®è·µ**
```
70%å•å…ƒæµ‹è¯•ï¼šå¿«é€ŸéªŒè¯ä¸šåŠ¡é€»è¾‘
20%é›†æˆæµ‹è¯•ï¼šéªŒè¯ç»„ä»¶åä½œ
10%ç«¯åˆ°ç«¯æµ‹è¯•ï¼šéªŒè¯å®Œæ•´æµç¨‹
```

**ğŸ”§ å¸¸è§æµ‹è¯•åœºæ™¯**
- **Controlleræµ‹è¯•**ï¼šä½¿ç”¨@WebMvcTest + MockMvc
- **Repositoryæµ‹è¯•**ï¼šä½¿ç”¨@DataJpaTest + TestEntityManager  
- **Serviceæµ‹è¯•**ï¼šä½¿ç”¨@SpringBootTestæˆ–çº¯å•å…ƒæµ‹è¯•
- **é…ç½®æµ‹è¯•**ï¼šä½¿ç”¨@TestPropertySourceéªŒè¯é…ç½®é€»è¾‘

### 7.4 æœ€ä½³å®è·µå»ºè®®


**âœ… æ¨èåšæ³•**
```
æµ‹è¯•å‘½åæ¸…æ™°ï¼šshould + é¢„æœŸè¡Œä¸º
æ•°æ®å‡†å¤‡ç®€æ´ï¼šåªå‡†å¤‡æµ‹è¯•ç›¸å…³çš„æœ€å°‘æ•°æ®
æ–­è¨€æ˜ç¡®ï¼šä¸€ä¸ªæµ‹è¯•é‡ç‚¹éªŒè¯ä¸€ä¸ªè¡Œä¸º
é…ç½®éš”ç¦»ï¼šæµ‹è¯•é…ç½®ä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨åˆ†ç¦»
```

**âš ï¸ é¿å…çš„é™·é˜·**
```
è¿‡åº¦ä½¿ç”¨@SpringBootTestï¼šä¼šæ‹–æ…¢æµ‹è¯•é€Ÿåº¦
å¿½ç•¥æµ‹è¯•æ•°æ®æ¸…ç†ï¼šå¯¼è‡´æµ‹è¯•é—´ç›¸äº’å½±å“
Mockè¿‡åº¦ï¼šå¤±å»é›†æˆæµ‹è¯•çš„ä»·å€¼
æµ‹è¯•ä»£ç é‡å¤ï¼šç¼ºä¹æµ‹è¯•å·¥å…·ç±»å’ŒåŸºç±»
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æµ‹è¯•åˆ†å±‚é‡‘å­—å¡”ï¼Œå•å…ƒé›†æˆç«¯åˆ°ç«¯
åˆ‡ç‰‡æµ‹è¯•é€Ÿåº¦å¿«ï¼Œå®Œæ•´æµ‹è¯•éªŒè¯å…¨
Mockå¯¹è±¡æ›¿ä¾èµ–ï¼Œé…ç½®éš”ç¦»ç¯å¢ƒç‹¬
æ•°æ®æ¸…ç†äº‹åŠ¡ç®¡ï¼Œè´¨é‡ä¿è¯å¼€å‘é¡º
```