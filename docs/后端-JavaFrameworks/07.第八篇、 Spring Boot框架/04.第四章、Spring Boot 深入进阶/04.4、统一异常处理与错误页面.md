---
title: 4ã€ç»Ÿä¸€å¼‚å¸¸å¤„ç†ä¸é”™è¯¯é¡µé¢
---
## ğŸ“š ç›®å½•

1. [å¼‚å¸¸å¤„ç†çš„é‡è¦æ€§](#1-å¼‚å¸¸å¤„ç†çš„é‡è¦æ€§)
2. [å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶](#2-å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶)
3. [å¼‚å¸¸æ˜ å°„ä¸å¤„ç†](#3-å¼‚å¸¸æ˜ å°„ä¸å¤„ç†)
4. [é”™è¯¯æ§åˆ¶å™¨è¯¦è§£](#4-é”™è¯¯æ§åˆ¶å™¨è¯¦è§£)
5. [è‡ªå®šä¹‰é”™è¯¯é¡µé¢](#5-è‡ªå®šä¹‰é”™è¯¯é¡µé¢)
6. [å¼‚å¸¸ä¿¡æ¯è„±æ•](#6-å¼‚å¸¸ä¿¡æ¯è„±æ•)
7. [é”™è¯¯ç è§„èŒƒè®¾è®¡](#7-é”™è¯¯ç è§„èŒƒè®¾è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ å¼‚å¸¸å¤„ç†çš„é‡è¦æ€§


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†


æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å¼€äº†ä¸€å®¶é¤å…ï¼Œå¦‚æœæ¯ä¸ªæœåŠ¡å‘˜é‡åˆ°é—®é¢˜éƒ½æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œæœ‰çš„ç›´æ¥å‘Šè¯‰å®¢äºº"å¨æˆ¿å‡ºé”™äº†"ï¼Œæœ‰çš„è¯´"ç³»ç»Ÿæ•…éšœ"ï¼Œæœ‰çš„ä»€ä¹ˆéƒ½ä¸è¯´å°±èµ°äº†ï¼Œè¿™æ ·å®¢äººä¼šå¾ˆå›°æƒ‘ã€‚

**ç»Ÿä¸€å¼‚å¸¸å¤„ç†å°±åƒåˆ¶å®šé¤å…çš„æ ‡å‡†æœåŠ¡æµç¨‹**ï¼š

```
æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ç³»ç»Ÿï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ç¨‹åºå‡ºé”™ â†’ 500é”™è¯¯é¡µé¢ â†’ ç”¨æˆ·æ‡µäº† ğŸ˜µ

æœ‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„ç³»ç»Ÿï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ç¨‹åºå‡ºé”™ â†’ å‹å¥½é”™è¯¯æç¤º â†’ ç”¨æˆ·ç†è§£ ğŸ˜Š
```

### 1.2 å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒç›®æ ‡


ğŸ¯ **ä¸»è¦ç›®æ ‡ï¼š**
- **ç”¨æˆ·ä½“éªŒ**ï¼šç»™ç”¨æˆ·çœ‹å¾—æ‡‚çš„é”™è¯¯ä¿¡æ¯
- **ç³»ç»Ÿç¨³å®š**ï¼šç¨‹åºå‡ºé”™ä¸ä¼šå´©æºƒ
- **å¼€å‘æ•ˆç‡**ï¼šç»Ÿä¸€å¤„ç†ï¼Œä¸ç”¨æ¯ä¸ªåœ°æ–¹éƒ½å†™
- **é—®é¢˜å®šä½**ï¼šè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥

**ç”Ÿæ´»ç±»æ¯”ï¼š**
```
å°±åƒåŒ»ç”Ÿçœ‹ç—…ï¼š
- ç—…äººæè¿°ç—‡çŠ¶ï¼ˆç”¨æˆ·é‡åˆ°çš„é—®é¢˜ï¼‰
- åŒ»ç”Ÿè¯Šæ–­ç—…å› ï¼ˆç³»ç»Ÿè¯†åˆ«å¼‚å¸¸ç±»å‹ï¼‰
- ç»™å‡ºæ²»ç–—æ–¹æ¡ˆï¼ˆè¿”å›åˆé€‚çš„é”™è¯¯ä¿¡æ¯ï¼‰
- è®°å½•ç—…å†ï¼ˆè®°å½•å¼‚å¸¸æ—¥å¿—ï¼‰
```

---

## 2. ğŸ› ï¸ å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶


### 2.1 @ControllerAdvice æ ¸å¿ƒæ¦‚å¿µ


**@ControllerAdvice** å°±åƒæ˜¯ä¸€ä¸ª"å…¨èƒ½ç®¡å®¶"ï¼Œä¸“é—¨è´Ÿè´£å¤„ç†æ•´ä¸ªåº”ç”¨ä¸­çš„å¼‚å¸¸ã€‚

**é€šä¿—ç†è§£ï¼š**
```
æƒ³è±¡ä¸€ä¸ªå¤§å•†åœºï¼š
- æ¯ä¸ªå•†é“ºéƒ½å¯èƒ½é‡åˆ°é—®é¢˜ï¼ˆå„ä¸ªControllerå¯èƒ½æŠ›å¼‚å¸¸ï¼‰
- å•†åœºæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å®¢æœä¸­å¿ƒï¼ˆ@ControllerAdviceï¼‰
- ä¸ç®¡å“ªä¸ªå•†é“ºå‡ºé—®é¢˜ï¼Œå®¢æœä¸­å¿ƒéƒ½èƒ½å¤„ç†
- ç»™å®¢æˆ·ç»Ÿä¸€çš„ã€ä¸“ä¸šçš„å›å¤
```

### 2.2 åŸºç¡€å¼‚å¸¸å¤„ç†å™¨


```java
@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    @ResponseBody
    public Result handleValidationException(MethodArgumentNotValidException ex) {
        log.error("å‚æ•°æ ¡éªŒå¤±è´¥", ex);
        
        // è·å–ç¬¬ä¸€ä¸ªé”™è¯¯ä¿¡æ¯
        String errorMessage = ex.getBindingResult()
            .getFieldErrors()
            .get(0)
            .getDefaultMessage();
            
        return Result.error("å‚æ•°é”™è¯¯ï¼š" + errorMessage);
    }
    
    // å¤„ç†è¿è¡Œæ—¶å¼‚å¸¸
    @ExceptionHandler(RuntimeException.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ResponseBody
    public Result handleRuntimeException(RuntimeException ex) {
        log.error("ç³»ç»Ÿè¿è¡Œå¼‚å¸¸", ex);
        return Result.error("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

**ä»£ç è§£é‡Šï¼š**
- `@ControllerAdvice`ï¼šå‘Šè¯‰Springè¿™æ˜¯å…¨å±€å¼‚å¸¸å¤„ç†å™¨
- `@ExceptionHandler`ï¼šæŒ‡å®šè¦å¤„ç†å“ªç§ç±»å‹çš„å¼‚å¸¸
- `@ResponseStatus`ï¼šè®¾ç½®è¿”å›çš„HTTPçŠ¶æ€ç 
- `@ResponseBody`ï¼šè¿”å›JSONæ ¼å¼æ•°æ®

### 2.3 å¼‚å¸¸å¤„ç†å™¨çš„å·¥ä½œåŸç†


```
å¼‚å¸¸å¤„ç†æµç¨‹å›¾ï¼š
å®¢æˆ·ç«¯å‘è¯·æ±‚ â†’ Controllerå¤„ç† â†’ ä¸šåŠ¡é€»è¾‘æŠ›å¼‚å¸¸
                    â†“
å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ¥æ”¶ â† Springå®¹å™¨æ•è·å¼‚å¸¸
                    â†“
åŒ¹é…å¼‚å¸¸ç±»å‹ â†’ æ‰§è¡Œå¯¹åº”å¤„ç†æ–¹æ³• â†’ è¿”å›å‹å¥½é”™è¯¯ä¿¡æ¯
```

---

## 3. ğŸ¯ å¼‚å¸¸æ˜ å°„ä¸å¤„ç†


### 3.1 @ExceptionHandler è¯¦è§£


**@ExceptionHandler** å°±åƒä¸åŒç§‘å®¤çš„åŒ»ç”Ÿï¼Œæ¯ä¸ªåŒ»ç”Ÿä¸“é—¨æ²»ç–—ç‰¹å®šçš„ç–¾ç—…ã€‚

**å¸¸è§å¼‚å¸¸ç±»å‹å¤„ç†ï¼š**

| å¼‚å¸¸ç±»å‹ | **è¯´æ˜** | **å¤„ç†æ–¹å¼** | **ç”¨æˆ·çœ‹åˆ°çš„ä¿¡æ¯** |
|---------|----------|------------|------------------|
| `å‚æ•°æ ¡éªŒå¼‚å¸¸` | ç”¨æˆ·è¾“å…¥ä¸åˆæ³• | æå–å…·ä½“å­—æ®µé”™è¯¯ | "ç”¨æˆ·åä¸èƒ½ä¸ºç©º" |
| `æ•°æ®ä¸å­˜åœ¨å¼‚å¸¸` | æŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ | è¿”å›404çŠ¶æ€ | "è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨" |
| `æƒé™ä¸è¶³å¼‚å¸¸` | æ²¡æœ‰æ“ä½œæƒé™ | è¿”å›403çŠ¶æ€ | "æƒé™ä¸è¶³" |
| `ç³»ç»Ÿå¼‚å¸¸` | ä»£ç bugæˆ–ç³»ç»Ÿé—®é¢˜ | è®°å½•æ—¥å¿—ï¼Œéšè—ç»†èŠ‚ | "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•" |

### 3.2 å®ç”¨å¼‚å¸¸å¤„ç†ç¤ºä¾‹


```java
@ControllerAdvice
@Slf4j
public class GlobalExceptionHandler {
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    @ResponseBody
    public Result handleBusinessException(BusinessException ex) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", ex.getMessage());
        return Result.error(ex.getCode(), ex.getMessage());
    }
    
    // å¤„ç†æ•°æ®åº“å¼‚å¸¸
    @ExceptionHandler(DataAccessException.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ResponseBody
    public Result handleDatabaseException(DataAccessException ex) {
        log.error("æ•°æ®åº“æ“ä½œå¼‚å¸¸", ex);
        return Result.error("æ•°æ®æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
    }
    
    // å¤„ç†è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ
    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    @ResponseStatus(HttpStatus.METHOD_NOT_ALLOWED)
    @ResponseBody
    public Result handleMethodNotSupported(HttpRequestMethodNotSupportedException ex) {
        log.warn("è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒï¼š{}", ex.getMethod());
        return Result.error("è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ");
    }
}
```

### 3.3 è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸


**ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰å¼‚å¸¸ï¼Ÿ**
å°±åƒåŒ»é™¢æœ‰ä¸åŒç§‘å®¤ä¸€æ ·ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¹Ÿéœ€è¦åŒºåˆ†ä¸åŒç±»å‹çš„é—®é¢˜ã€‚

```java
// ä¸šåŠ¡å¼‚å¸¸åŸºç±»
public class BusinessException extends RuntimeException {
    private String code;
    private String message;
    
    public BusinessException(String code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
    
    // å¿«é€Ÿåˆ›å»ºå¸¸è§å¼‚å¸¸çš„é™æ€æ–¹æ³•
    public static BusinessException userNotFound() {
        return new BusinessException("USER_NOT_FOUND", "ç”¨æˆ·ä¸å­˜åœ¨");
    }
    
    public static BusinessException invalidPassword() {
        return new BusinessException("INVALID_PASSWORD", "å¯†ç é”™è¯¯");
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```java
@Service
public class UserService {
    
    public User login(String username, String password) {
        User user = userDao.findByUsername(username);
        if (user == null) {
            throw BusinessException.userNotFound();  // æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
        }
        
        if (!user.getPassword().equals(password)) {
            throw BusinessException.invalidPassword();
        }
        
        return user;
    }
}
```

---

## 4. ğŸ›ï¸ é”™è¯¯æ§åˆ¶å™¨è¯¦è§£


### 4.1 ErrorController æ¦‚å¿µ


**ErrorController** å°±åƒæ˜¯ç³»ç»Ÿçš„"æœ€åä¸€é“é˜²çº¿"ï¼Œå½“æ‰€æœ‰å…¶ä»–å¤„ç†éƒ½å¤±è´¥æ—¶ï¼Œå®ƒæ¥å…œåº•ã€‚

**ç”Ÿæ´»ç±»æ¯”ï¼š**
```
å°±åƒå•†åœºçš„æ€»å®¢æœï¼š
- å„ä¸ªåº—é“ºçš„é—®é¢˜å…ˆç”±åº—é“ºå®¢æœå¤„ç†ï¼ˆ@ControllerAdviceï¼‰
- å¦‚æœåº—é“ºå®¢æœè§£å†³ä¸äº†ï¼Œæ‰¾æ€»å®¢æœï¼ˆErrorControllerï¼‰
- æ€»å®¢æœç»™å®¢æˆ·ä¸€ä¸ªæœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆ
```

### 4.2 è‡ªå®šä¹‰é”™è¯¯æ§åˆ¶å™¨


```java
@Controller
public class CustomErrorController implements ErrorController {
    
    private static final String ERROR_PATH = "/error";
    
    @RequestMapping(value = ERROR_PATH)
    public String handleError(HttpServletRequest request, Model model) {
        // è·å–é”™è¯¯çŠ¶æ€ç 
        Integer statusCode = (Integer) request.getAttribute(RequestDispatcher.ERROR_STATUS_CODE);
        String errorMessage = "ç³»ç»Ÿå‡ºç°äº†ä¸€äº›é—®é¢˜";
        
        if (statusCode != null) {
            switch (statusCode) {
                case 404:
                    errorMessage = "é¡µé¢ä¸å­˜åœ¨";
                    break;
                case 403:
                    errorMessage = "è®¿é—®è¢«æ‹’ç»";
                    break;
                case 500:
                    errorMessage = "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯";
                    break;
                default:
                    errorMessage = "å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯";
            }
        }
        
        model.addAttribute("statusCode", statusCode);
        model.addAttribute("errorMessage", errorMessage);
        
        return "error";  // è¿”å›é”™è¯¯é¡µé¢
    }
    
    @Override
    public String getErrorPath() {
        return ERROR_PATH;
    }
}
```

### 4.3 JSONä¸é¡µé¢åŒé‡æ”¯æŒ


ç°ä»£Webåº”ç”¨é€šå¸¸éœ€è¦åŒæ—¶æ”¯æŒç½‘é¡µå’ŒAPIï¼Œé”™è¯¯å¤„ç†ä¹Ÿè¦åŒºåˆ«å¯¹å¾…ï¼š

```java
@Controller
public class CustomErrorController implements ErrorController {
    
    @RequestMapping(value = "/error", produces = MediaType.TEXT_HTML_VALUE)
    public String handleHtmlError(HttpServletRequest request, Model model) {
        // å¤„ç†ç½‘é¡µè¯·æ±‚çš„é”™è¯¯
        return "error";
    }
    
    @RequestMapping(value = "/error", produces = MediaType.APPLICATION_JSON_VALUE)
    @ResponseBody
    public Result handleJsonError(HttpServletRequest request) {
        // å¤„ç†APIè¯·æ±‚çš„é”™è¯¯
        Integer statusCode = (Integer) request.getAttribute(RequestDispatcher.ERROR_STATUS_CODE);
        return Result.error("è¯·æ±‚å¤„ç†å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š" + statusCode);
    }
}
```

---

## 5. ğŸ¨ è‡ªå®šä¹‰é”™è¯¯é¡µé¢


### 5.1 é”™è¯¯é¡µé¢è®¾è®¡åŸåˆ™


**å¥½çš„é”™è¯¯é¡µé¢å°±åƒå¥½çš„è·¯æ ‡**ï¼Œè¦å‘Šè¯‰ç”¨æˆ·ä¸‰ä»¶äº‹ï¼š
1. **å‘ç”Ÿäº†ä»€ä¹ˆ**ï¼ˆå‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼‰
2. **ä¸ºä»€ä¹ˆå‘ç”Ÿ**ï¼ˆå¯èƒ½çš„åŸå› ï¼‰
3. **æ€ä¹ˆè§£å†³**ï¼ˆç”¨æˆ·å¯ä»¥åšä»€ä¹ˆï¼‰

### 5.2 é”™è¯¯é¡µé¢æ¨¡æ¿


**ç›®å½•ç»“æ„ï¼š**
```
src/main/resources/templates/
â”œâ”€â”€ error/
â”‚   â”œâ”€â”€ 4xx.html    # 4xxé”™è¯¯é€šç”¨é¡µé¢
â”‚   â”œâ”€â”€ 404.html    # 404ä¸“ç”¨é¡µé¢
â”‚   â”œâ”€â”€ 5xx.html    # 5xxé”™è¯¯é€šç”¨é¡µé¢
â”‚   â””â”€â”€ error.html  # é»˜è®¤é”™è¯¯é¡µé¢
```

**404é”™è¯¯é¡µé¢ç¤ºä¾‹ï¼š**
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é¡µé¢ä¸å­˜åœ¨</title>
    <style>
        .error-container {
            text-align: center;
            padding: 50px;
        }
        .error-code {
            font-size: 72px;
            color: #ff6b6b;
            margin-bottom: 20px;
        }
        .error-message {
            font-size: 24px;
            margin-bottom: 30px;
        }
        .back-button {
            background-color: #4ecdc4;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="error-code">404</div>
        <div class="error-message">æŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨</div>
        <div>
            <p>å¯èƒ½çš„åŸå› ï¼š</p>
            <ul style="text-align: left; display: inline-block;">
                <li>ç½‘å€è¾“å…¥é”™è¯¯</li>
                <li>é¡µé¢å·²è¢«åˆ é™¤æˆ–ç§»åŠ¨</li>
                <li>é“¾æ¥å·²è¿‡æœŸ</li>
            </ul>
        </div>
        <a href="/" class="back-button">è¿”å›é¦–é¡µ</a>
    </div>
</body>
</html>
```

### 5.3 åŠ¨æ€é”™è¯¯é¡µé¢


```java
@Controller
public class ErrorPageController {
    
    @RequestMapping("/error")
    public String error(HttpServletRequest request, Model model) {
        Integer statusCode = (Integer) request.getAttribute(RequestDispatcher.ERROR_STATUS_CODE);
        String errorMessage = getErrorMessage(statusCode);
        List<String> suggestions = getSuggestions(statusCode);
        
        model.addAttribute("statusCode", statusCode);
        model.addAttribute("errorMessage", errorMessage);
        model.addAttribute("suggestions", suggestions);
        model.addAttribute("timestamp", new Date());
        
        return "error/error";
    }
    
    private String getErrorMessage(Integer statusCode) {
        if (statusCode == null) return "æœªçŸ¥é”™è¯¯";
        
        switch (statusCode) {
            case 403: return "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®è¯¥èµ„æº";
            case 404: return "è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨";
            case 500: return "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯";
            default: return "ç³»ç»Ÿå‘ç”Ÿé”™è¯¯";
        }
    }
    
    private List<String> getSuggestions(Integer statusCode) {
        // æ ¹æ®é”™è¯¯ç è¿”å›ä¸åŒçš„å»ºè®®
        List<String> suggestions = new ArrayList<>();
        
        if (statusCode != null && statusCode == 404) {
            suggestions.add("æ£€æŸ¥ç½‘å€æ˜¯å¦è¾“å…¥æ­£ç¡®");
            suggestions.add("å°è¯•ä»é¦–é¡µé‡æ–°å¯¼èˆª");
            suggestions.add("è”ç³»ç®¡ç†å‘˜ç¡®è®¤é¡µé¢çŠ¶æ€");
        }
        
        return suggestions;
    }
}
```

---

## 6. ğŸ”’ å¼‚å¸¸ä¿¡æ¯è„±æ•


### 6.1 ä¸ºä»€ä¹ˆè¦è„±æ•


**ä¿¡æ¯è„±æ•å°±åƒåŒ»ç”Ÿè·Ÿæ‚£è€…è¯´è¯**ï¼š
- âŒ ä¸ä¼šè¯´ï¼š"ä½ çš„å¿ƒè„ä¸»åŠ¨è„‰ç“£ç‹­çª„ï¼Œå·¦å¿ƒå®¤å°„è¡€åˆ†æ•°é™ä½"
- âœ… ä¼šè¯´ï¼š"ä½ çš„å¿ƒè„æœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥"

**å®‰å…¨è€ƒè™‘ï¼š**
```
æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©ï¼š
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- æœåŠ¡å™¨è·¯å¾„ä¿¡æ¯  
- ç”¨æˆ·éšç§æ•°æ®
- ç³»ç»Ÿå†…éƒ¨é€»è¾‘
```

### 6.2 è„±æ•ç­–ç•¥å®ç°


```java
@Component
@Slf4j
public class ErrorMessageSanitizer {
    
    // ç”Ÿäº§ç¯å¢ƒæ•æ„Ÿä¿¡æ¯å…³é”®è¯
    private static final List<String> SENSITIVE_KEYWORDS = Arrays.asList(
        "password", "token", "secret", "key", 
        "jdbc:", "localhost", "127.0.0.1", 
        "root", "admin", "database"
    );
    
    public String sanitize(String originalMessage) {
        if (originalMessage == null) {
            return "ç³»ç»Ÿé”™è¯¯";
        }
        
        String sanitized = originalMessage.toLowerCase();
        
        // æ£€æŸ¥æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯
        for (String keyword : SENSITIVE_KEYWORDS) {
            if (sanitized.contains(keyword)) {
                log.warn("æ£€æµ‹åˆ°æ•æ„Ÿä¿¡æ¯ï¼Œå·²è„±æ•å¤„ç†");
                return "ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜";
            }
        }
        
        // ç§»é™¤å †æ ˆè·Ÿè¸ªä¿¡æ¯
        if (originalMessage.contains("at ")) {
            return extractBusinessMessage(originalMessage);
        }
        
        return originalMessage;
    }
    
    private String extractBusinessMessage(String message) {
        // æå–ä¸šåŠ¡ç›¸å…³çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿‡æ»¤æŠ€æœ¯ç»†èŠ‚
        String[] lines = message.split("\n");
        for (String line : lines) {
            if (!line.trim().startsWith("at ") && 
                !line.trim().startsWith("Caused by")) {
                return line.trim();
            }
        }
        return "å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯";
    }
}
```

### 6.3 ç¯å¢ƒåŒºåˆ†å¤„ç†


```java
@ControllerAdvice
@Slf4j
public class EnvironmentAwareExceptionHandler {
    
    @Value("${spring.profiles.active:dev}")
    private String activeProfile;
    
    @Autowired
    private ErrorMessageSanitizer sanitizer;
    
    @ExceptionHandler(Exception.class)
    @ResponseBody
    public Result handleGenericException(Exception ex) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", ex);
        
        String message;
        if ("prod".equals(activeProfile)) {
            // ç”Ÿäº§ç¯å¢ƒï¼šè„±æ•å¤„ç†
            message = sanitizer.sanitize(ex.getMessage());
        } else {
            // å¼€å‘/æµ‹è¯•ç¯å¢ƒï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            message = ex.getMessage();
        }
        
        return Result.error(message);
    }
}
```

**ç¯å¢ƒå¯¹æ¯”ï¼š**

| ç¯å¢ƒ | **é”™è¯¯ä¿¡æ¯è¯¦ç»†ç¨‹åº¦** | **ç¤ºä¾‹** |
|-----|-------------------|---------|
| ğŸŸ¢ **å¼€å‘ç¯å¢ƒ** | å®Œæ•´è¯¦ç»†ä¿¡æ¯ | `"Connection refused: localhost:3306/userdb"` |
| ğŸŸ¡ **æµ‹è¯•ç¯å¢ƒ** | é€‚åº¦è¯¦ç»†ä¿¡æ¯ | `"æ•°æ®åº“è¿æ¥å¤±è´¥"` |
| ğŸ”´ **ç”Ÿäº§ç¯å¢ƒ** | é«˜åº¦è„±æ•ä¿¡æ¯ | `"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"` |

---

## 7. ğŸ“‹ é”™è¯¯ç è§„èŒƒè®¾è®¡


### 7.1 é”™è¯¯ç è®¾è®¡åŸåˆ™


**å¥½çš„é”™è¯¯ç å°±åƒé‚®æ”¿ç¼–ç **ï¼Œè¦å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š
- **å”¯ä¸€æ€§**ï¼šæ¯ç§é”™è¯¯æœ‰å”¯ä¸€ç¼–ç 
- **åˆ†å±‚æ€§**ï¼šæŒ‰æ¨¡å—/ä¸šåŠ¡åˆ†ç±»
- **å¯è¯»æ€§**ï¼šç¼–ç æœ‰ä¸€å®šå«ä¹‰
- **æ‰©å±•æ€§**ï¼šä¾¿äºåç»­æ·»åŠ æ–°é”™è¯¯

### 7.2 é”™è¯¯ç ç»“æ„è®¾è®¡


```
é”™è¯¯ç ç»“æ„ï¼šABCDEF
â”œâ”€â”€ ABï¼šä¸šåŠ¡æ¨¡å—
â”œâ”€â”€ CDï¼šé”™è¯¯åˆ†ç±»  
â””â”€â”€ EFï¼šå…·ä½“é”™è¯¯

ç¤ºä¾‹ï¼š
USER01: ç”¨æˆ·æ¨¡å—-å‚æ•°é”™è¯¯-ç”¨æˆ·åä¸ºç©º
USER02: ç”¨æˆ·æ¨¡å—-å‚æ•°é”™è¯¯-å¯†ç æ ¼å¼é”™è¯¯
USER10: ç”¨æˆ·æ¨¡å—-ä¸šåŠ¡é”™è¯¯-ç”¨æˆ·ä¸å­˜åœ¨
USER11: ç”¨æˆ·æ¨¡å—-ä¸šåŠ¡é”™è¯¯-ç”¨æˆ·å·²å­˜åœ¨

ORDER01: è®¢å•æ¨¡å—-å‚æ•°é”™è¯¯-è®¢å•å·ä¸ºç©º
ORDER10: è®¢å•æ¨¡å—-ä¸šåŠ¡é”™è¯¯-è®¢å•ä¸å­˜åœ¨
```

### 7.3 é”™è¯¯ç æšä¸¾å®ç°


```java
public enum ErrorCode {
    
    // ç³»ç»Ÿçº§é”™è¯¯ (SYS)
    SUCCESS("000000", "æ“ä½œæˆåŠŸ"),
    SYSTEM_ERROR("SYS001", "ç³»ç»Ÿå†…éƒ¨é”™è¯¯"),
    PARAM_ERROR("SYS002", "å‚æ•°é”™è¯¯"),
    
    // ç”¨æˆ·æ¨¡å—é”™è¯¯ (USER)
    USER_NOT_FOUND("USER001", "ç”¨æˆ·ä¸å­˜åœ¨"),
    USER_ALREADY_EXISTS("USER002", "ç”¨æˆ·å·²å­˜åœ¨"),
    INVALID_PASSWORD("USER003", "å¯†ç é”™è¯¯"),
    USER_DISABLED("USER004", "ç”¨æˆ·å·²è¢«ç¦ç”¨"),
    
    // è®¢å•æ¨¡å—é”™è¯¯ (ORDER)
    ORDER_NOT_FOUND("ORDER001", "è®¢å•ä¸å­˜åœ¨"),
    ORDER_STATUS_ERROR("ORDER002", "è®¢å•çŠ¶æ€é”™è¯¯"),
    INSUFFICIENT_STOCK("ORDER003", "åº“å­˜ä¸è¶³");
    
    private final String code;
    private final String message;
    
    ErrorCode(String code, String message) {
        this.code = code;
        this.message = message;
    }
    
    // getteræ–¹æ³•...
}
```

### 7.4 ç»Ÿä¸€è¿”å›ç»“æœ


```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Result<T> {
    private String code;
    private String message;
    private T data;
    private Long timestamp;
    
    public static <T> Result<T> success(T data) {
        return new Result<>(ErrorCode.SUCCESS.getCode(), 
                           ErrorCode.SUCCESS.getMessage(), 
                           data, System.currentTimeMillis());
    }
    
    public static <T> Result<T> error(ErrorCode errorCode) {
        return new Result<>(errorCode.getCode(), 
                           errorCode.getMessage(), 
                           null, System.currentTimeMillis());
    }
    
    public static <T> Result<T> error(String code, String message) {
        return new Result<>(code, message, null, System.currentTimeMillis());
    }
}
```

### 7.5 é”™è¯¯ç ç®¡ç†æœ€ä½³å®è·µ


**ğŸ“Š é”™è¯¯ç ç»Ÿè®¡è¡¨ï¼š**

| æ¨¡å— | **æˆåŠŸç ** | **å‚æ•°é”™è¯¯** | **ä¸šåŠ¡é”™è¯¯** | **ç³»ç»Ÿé”™è¯¯** |
|------|-----------|-------------|-------------|-------------|
| `ç”¨æˆ·æ¨¡å—` | 000000 | USER001-099 | USER100-199 | USER900-999 |
| `è®¢å•æ¨¡å—` | 000000 | ORDER001-099 | ORDER100-199 | ORDER900-999 |
| `æ”¯ä»˜æ¨¡å—` | 000000 | PAY001-099 | PAY100-199 | PAY900-999 |

**ğŸ”§ é”™è¯¯ç ä½¿ç”¨ç¤ºä¾‹ï¼š**
```java
@RestController
public class UserController {
    
    @PostMapping("/login")
    public Result<User> login(@RequestBody LoginDto loginDto) {
        try {
            User user = userService.login(loginDto.getUsername(), loginDto.getPassword());
            return Result.success(user);
        } catch (BusinessException e) {
            return Result.error(e.getCode(), e.getMessage());
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


ğŸ”¥ **æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼š**
- **@ControllerAdvice**ï¼šå…¨å±€å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒæ³¨è§£
- **@ExceptionHandler**ï¼šæŒ‡å®šå¤„ç†ç‰¹å®šç±»å‹å¼‚å¸¸
- **ErrorController**ï¼šç³»ç»Ÿçº§åˆ«çš„æœ€åå…œåº•å¤„ç†
- **å¼‚å¸¸è„±æ•**ï¼šä¿æŠ¤ç³»ç»Ÿå®‰å…¨çš„é‡è¦æ‰‹æ®µ
- **é”™è¯¯ç è§„èŒƒ**ï¼šå›¢é˜Ÿåä½œçš„ç»Ÿä¸€æ ‡å‡†

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¼‚å¸¸å¤„ç†çš„å±‚æ¬¡ç»“æ„**
```
ä¸šåŠ¡å¼‚å¸¸ â†’ @ExceptionHandler â†’ è¿”å›ä¸šåŠ¡é”™è¯¯ä¿¡æ¯
ç³»ç»Ÿå¼‚å¸¸ â†’ @ExceptionHandler â†’ è®°å½•æ—¥å¿— + è¿”å›é€šç”¨é”™è¯¯
æœªæ•è·å¼‚å¸¸ â†’ ErrorController â†’ æœ€åå…œåº•å¤„ç†
```

**ğŸ”¹ ç”¨æˆ·ä½“éªŒä¼˜å…ˆåŸåˆ™**
```
å¼€å‘è€…çœ‹åˆ°çš„ï¼šNullPointerException at line 42...
ç”¨æˆ·çœ‹åˆ°çš„ï¼šç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•

å¼€å‘è€…éœ€è¦çš„ï¼šå®Œæ•´å †æ ˆä¿¡æ¯
ç”¨æˆ·éœ€è¦çš„ï¼šæ€ä¹ˆè§£å†³é—®é¢˜
```

**ğŸ”¹ å®‰å…¨ä¸å¯ç”¨æ€§å¹³è¡¡**
```
å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•
æµ‹è¯•ç¯å¢ƒï¼šé€‚åº¦ä¿¡æ¯ï¼Œæ¥è¿‘ç”Ÿäº§
ç”Ÿäº§ç¯å¢ƒï¼šé«˜åº¦è„±æ•ï¼Œä¿æŠ¤ç³»ç»Ÿå®‰å…¨
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


ğŸ“ˆ **ä¸šåŠ¡ä»·å€¼ï¼š**
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šå‹å¥½çš„é”™è¯¯æç¤º
- **ä¿éšœç³»ç»Ÿå®‰å…¨**ï¼šæ•æ„Ÿä¿¡æ¯ä¸æ³„éœ²
- **æé«˜å¼€å‘æ•ˆç‡**ï¼šç»Ÿä¸€å¤„ç†ï¼Œå‡å°‘é‡å¤ä»£ç 
- **ä¾¿äºé—®é¢˜å®šä½**ï¼šè§„èŒƒçš„é”™è¯¯ç å’Œæ—¥å¿—

ğŸ’¡ **è®°å¿†æŠ€å·§ï¼š**
```
å¼‚å¸¸å¤„ç†ä¸‰åŸåˆ™ï¼š
1. ç”¨æˆ·å‹å¥½ - é”™è¯¯ä¿¡æ¯è¦äººèƒ½çœ‹æ‡‚
2. ç³»ç»Ÿå®‰å…¨ - æ•æ„Ÿä¿¡æ¯ä¸èƒ½éœ²
3. å¼€å‘ä¾¿åˆ© - ç»Ÿä¸€å¤„ç†æ•ˆç‡é«˜
```

### 8.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ | **ç°è±¡** | **è§£å†³æ–¹æ¡ˆ** |
|------|---------|-------------|
| å¼‚å¸¸ä¿¡æ¯æš´éœ²æ•æ„Ÿä¿¡æ¯ | æ˜¾ç¤ºæ•°æ®åº“è¿æ¥ä¸² | ä½¿ç”¨è„±æ•å¤„ç† |
| ä¸åŒå¼‚å¸¸è¿”å›æ ¼å¼ä¸ä¸€è‡´ | JSONæ ¼å¼æ··ä¹± | ç»Ÿä¸€Resultå°è£… |
| é”™è¯¯é¡µé¢æ ·å¼ç®€é™‹ | ç”¨æˆ·ä½“éªŒå·® | è‡ªå®šä¹‰é”™è¯¯é¡µé¢æ¨¡æ¿ |
| å¼‚å¸¸å¤„ç†é€»è¾‘é‡å¤ | ä»£ç å†—ä½™ | å…¨å±€å¼‚å¸¸å¤„ç†å™¨ |

**ğŸ”‘ æ ¸å¿ƒè®°å¿†ï¼š**
- å¼‚å¸¸å¤„ç†æ˜¯ç³»ç»Ÿçš„"å®¢æœä¸­å¿ƒ"
- @ControllerAdviceæ˜¯"å…¨èƒ½ç®¡å®¶" 
- ErrorControlleræ˜¯"æœ€åé˜²çº¿"
- è„±æ•å¤„ç†æ˜¯"å®‰å…¨ä¿éšœ"
- é”™è¯¯ç æ˜¯"æ²Ÿé€šè¯­è¨€"

> ğŸ’¡ **å­¦ä¹ å»ºè®®ï¼š**  
> ä»ä¸€ä¸ªç®€å•çš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¼€å§‹ï¼Œé€æ­¥æ·»åŠ ä¸åŒç±»å‹å¼‚å¸¸çš„å¤„ç†ï¼Œæœ€åå®Œå–„é”™è¯¯é¡µé¢å’Œè„±æ•æœºåˆ¶ã€‚è®°ä½ï¼šå¥½çš„å¼‚å¸¸å¤„ç†ä¸ä»…è¦æŠ€æœ¯å®ç°åˆ°ä½ï¼Œæ›´è¦ç«™åœ¨ç”¨æˆ·è§’åº¦è€ƒè™‘é—®é¢˜ã€‚