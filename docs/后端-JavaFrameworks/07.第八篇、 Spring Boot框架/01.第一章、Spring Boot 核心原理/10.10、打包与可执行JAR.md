---
title: 10ã€æ‰“åŒ…ä¸å¯æ‰§è¡ŒJAR
---
## ğŸ“š ç›®å½•

1. [Spring Boot æ‰“åŒ…åŸºç¡€æ¦‚å¿µ](#1-spring-boot-æ‰“åŒ…åŸºç¡€æ¦‚å¿µ)
2. [spring-boot-maven-pluginæ’ä»¶è¯¦è§£](#2-spring-boot-maven-pluginæ’ä»¶è¯¦è§£)
3. [å¯æ‰§è¡ŒJARçš„å†…éƒ¨ç»“æ„](#3-å¯æ‰§è¡Œjarçš„å†…éƒ¨ç»“æ„)
4. [Fat Jar vs Thin Jarå¯¹æ¯”](#4-fat-jar-vs-thin-jarå¯¹æ¯”)
5. [ç±»åŠ è½½å™¨é‡å®šä½æœºåˆ¶](#5-ç±»åŠ è½½å™¨é‡å®šä½æœºåˆ¶)
6. [Layered Jaråˆ†å±‚æ„å»º](#6-layered-jaråˆ†å±‚æ„å»º)
7. [å¯åŠ¨è„šæœ¬ç”Ÿæˆ](#7-å¯åŠ¨è„šæœ¬ç”Ÿæˆ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Spring Boot æ‰“åŒ…åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¯æ‰§è¡ŒJARï¼Ÿ


**é€šä¿—ç†è§£**ï¼šå°±åƒæŠŠæ•´ä¸ªæˆ¿å­æ‰“åŒ…æˆä¸€ä¸ªè¡Œæç®±ï¼Œé‡Œé¢åŒ…å«äº†æ‰€æœ‰å®¶å…·å’Œç”Ÿæ´»ç”¨å“

```
ä¼ ç»ŸJavaåº”ç”¨éƒ¨ç½²ï¼š
ğŸ“¦ åº”ç”¨JAR + ğŸ“š ä¾èµ–åº“ä»¬ + âš™ï¸ é…ç½®æ–‡ä»¶ + ğŸ”§ å¯åŠ¨è„šæœ¬
éœ€è¦åˆ†åˆ«ç®¡ç†ï¼Œå®¹æ˜“ä¸¢å¤±

Spring Bootå¯æ‰§è¡ŒJARï¼š
ğŸ ä¸€ä¸ªæ–‡ä»¶åŒ…å«æ‰€æœ‰ = ğŸ“¦+ğŸ“š+âš™ï¸+ğŸ”§
åŒå‡»å°±èƒ½è¿è¡Œï¼Œéƒ¨ç½²è¶…ç®€å•ï¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¯æ‰§è¡ŒJARï¼Ÿ


**è§£å†³çš„é—®é¢˜**ï¼š
- **ğŸ“¦ éƒ¨ç½²å¤æ‚**ï¼šä¼ ç»Ÿæ–¹å¼éœ€è¦å®‰è£…Tomcatã€é…ç½®ç¯å¢ƒ
- **ğŸ”§ ä¾èµ–åœ°ç‹±**ï¼šjaråŒ…ç‰ˆæœ¬å†²çªï¼Œç¼ºå¤±ä¾èµ–
- **âš™ï¸ ç¯å¢ƒå·®å¼‚**ï¼šå¼€å‘ç¯å¢ƒèƒ½è·‘ï¼Œç”Ÿäº§ç¯å¢ƒå‡ºé”™
- **ğŸš€ å¯åŠ¨ç¹ç**ï¼šéœ€è¦å¤æ‚çš„å¯åŠ¨å‘½ä»¤å’Œè„šæœ¬

**Spring Bootçš„è§£å†³æ–¹æ¡ˆ**ï¼š
- **ğŸ è‡ªåŒ…å«**ï¼šæ‰€æœ‰ä¾èµ–éƒ½æ‰“åŒ…åœ¨ä¸€èµ·
- **ğŸ”¥ å†…åµŒæœåŠ¡å™¨**ï¼šä¸éœ€è¦å¤–éƒ¨Tomcat
- **âš¡ ä¸€é”®å¯åŠ¨**ï¼š`java -jar app.jar`å³å¯è¿è¡Œ
- **ğŸ›¡ï¸ ç¯å¢ƒä¸€è‡´**ï¼šå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå®Œå…¨ç›¸åŒ

### 1.3 å¯æ‰§è¡ŒJARçš„ç¥å¥‡ä¹‹å¤„


```
æ™®é€šJARåŒ…è¿è¡Œï¼š
java -cp app.jar:lib1.jar:lib2.jar:... com.example.MainClass
ğŸ˜« éœ€è¦æŒ‡å®šæ‰€æœ‰ä¾èµ–å’Œä¸»ç±»

Spring Bootå¯æ‰§è¡ŒJARï¼š  
java -jar app.jar
ğŸ˜Š ä¸€æ¡å‘½ä»¤æå®šä¸€åˆ‡ï¼
```

---

## 2. ğŸ”§ spring-boot-maven-pluginæ’ä»¶è¯¦è§£


### 2.1 æ’ä»¶çš„ä½œç”¨å’Œé‡è¦æ€§


**æ’ä»¶ä½œç”¨**ï¼šæŠŠæ™®é€šçš„Mavené¡¹ç›®å˜æˆSpring Bootå¯æ‰§è¡Œåº”ç”¨

```xml
<!-- æ²¡æœ‰è¿™ä¸ªæ’ä»¶ -->
mvn package
â†’ ç”Ÿæˆæ™®é€šJARï¼šapp-1.0.jar (åªæœ‰ä½ å†™çš„ä»£ç ï¼Œ10KB)
â†’ æ— æ³•ç›´æ¥è¿è¡Œï¼Œç¼ºå°‘ä¾èµ–

<!-- æœ‰äº†è¿™ä¸ªæ’ä»¶ -->
mvn package  
â†’ ç”Ÿæˆå¯æ‰§è¡ŒJARï¼šapp-1.0.jar (åŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œ50MB)
â†’ å¯ä»¥ç›´æ¥è¿è¡Œï¼šjava -jar app-1.0.jar
```

### 2.2 æ’ä»¶é…ç½®è¯¦è§£


**ğŸ”¸ åŸºç¡€é…ç½®**
```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <version>2.7.0</version>
    <executions>
        <execution>
            <goals>
                <goal>repackage</goal>  <!-- ğŸ”‘ æ ¸å¿ƒç›®æ ‡ï¼šé‡æ–°æ‰“åŒ… -->
            </goals>
        </execution>
    </executions>
</plugin>
```

**ğŸ’¡ repackageç›®æ ‡è§£é‡Š**ï¼š
- **åŸå§‹jar**ï¼š`app-1.0.jar` (åªæœ‰ä½ çš„ä»£ç )
- **repackageå**ï¼š`app-1.0.jar` (å¯æ‰§è¡Œ) + `app-1.0.jar.original` (åŸå§‹)

**ğŸ”¸ é«˜çº§é…ç½®é€‰é¡¹**

```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <!-- ğŸ¯ æŒ‡å®šä¸»ç±» -->
        <mainClass>com.example.Application</mainClass>
        
        <!-- ğŸ“ è‡ªå®šä¹‰æœ€ç»ˆæ–‡ä»¶å -->
        <finalName>my-awesome-app</finalName>
        
        <!-- ğŸš€ æ·»åŠ JVMå¯åŠ¨å‚æ•° -->
        <jvmArguments>-Xmx512m -Dspring.profiles.active=prod</jvmArguments>
        
        <!-- âš¡ æ’é™¤ä¸éœ€è¦çš„ä¾èµ– -->
        <excludes>
            <exclude>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-devtools</artifactId>
            </exclude>
        </excludes>
        
        <!-- ğŸ”§ å¯ç”¨åˆ†å±‚æ„å»º(Dockerä¼˜åŒ–) -->
        <layers>
            <enabled>true</enabled>
        </layers>
    </configuration>
</plugin>
```

### 2.3 å¸¸ç”¨Mavenå‘½ä»¤


| å‘½ä»¤ | **ä½œç”¨** | **ç”Ÿæˆç»“æœ** |
|------|---------|-------------|
| `mvn clean package` | **æ‰“åŒ…åº”ç”¨** | `ç”Ÿæˆå¯æ‰§è¡ŒJARæ–‡ä»¶` |
| `mvn spring-boot:run` | **å¼€å‘ç¯å¢ƒè¿è¡Œ** | `ç›´æ¥å¯åŠ¨åº”ç”¨ï¼Œæ— éœ€æ‰“åŒ…` |
| `mvn spring-boot:build-image` | **æ„å»ºDockeré•œåƒ** | `ç”ŸæˆOCIæ ‡å‡†é•œåƒ` |

**ğŸ’¡ å¼€å‘å°è´´å£«**ï¼š
- **å¼€å‘é˜¶æ®µ**ï¼šä½¿ç”¨`mvn spring-boot:run`ï¼Œçƒ­é‡è½½æ›´å¿«
- **æµ‹è¯•é˜¶æ®µ**ï¼šä½¿ç”¨`mvn package`ç„¶å`java -jar`æµ‹è¯•
- **ç”Ÿäº§éƒ¨ç½²**ï¼šä½¿ç”¨`mvn clean package -Dmaven.test.skip=true`

---

## 3. ğŸ“¦ å¯æ‰§è¡ŒJARçš„å†…éƒ¨ç»“æ„


### 3.1 JARåŒ…å†…éƒ¨ç›®å½•ç»“æ„


**ğŸ” è§£å‹å¯æ‰§è¡ŒJARåçš„ç›®å½•ç»“æ„**ï¼š

```
my-app.jar/
â”œâ”€â”€ BOOT-INF/                    ğŸ¯ Spring Bootä¸“ç”¨ç›®å½•
â”‚   â”œâ”€â”€ classes/                 ğŸ“ ä½ çš„åº”ç”¨ä»£ç 
â”‚   â”‚   â”œâ”€â”€ com/example/         
â”‚   â”‚   â”œâ”€â”€ application.yml      âš™ï¸ é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ static/              ğŸŒ é™æ€èµ„æº
â”‚   â””â”€â”€ lib/                     ğŸ“š æ‰€æœ‰ä¾èµ–JARåŒ…
â”‚       â”œâ”€â”€ spring-boot-2.7.0.jar
â”‚       â”œâ”€â”€ spring-core-5.3.jar
â”‚       â””â”€â”€ jackson-core-2.13.jar
â”œâ”€â”€ META-INF/                    ğŸ“‹ å…ƒä¿¡æ¯ç›®å½•
â”‚   â”œâ”€â”€ MANIFEST.MF              ğŸ—’ï¸ JARæ¸…å•æ–‡ä»¶(æœ€é‡è¦!)
â”‚   â””â”€â”€ maven/                   ğŸ“Š Mavenä¿¡æ¯
â””â”€â”€ org/                         ğŸš€ Spring Bootå¯åŠ¨å™¨
    â””â”€â”€ springframework/
        â””â”€â”€ boot/
            â””â”€â”€ loader/          âš¡ è‡ªå®šä¹‰ç±»åŠ è½½å™¨
```

### 3.2 MANIFEST.MFæ–‡ä»¶è§£æ


**ğŸ—’ï¸ MANIFEST.MFæ˜¯æ•´ä¸ªå¯æ‰§è¡ŒJARçš„"å¤§è„‘"**ï¼š

```
Manifest-Version: 1.0
Main-Class: org.springframework.boot.loader.JarLauncher     ğŸš€ çœŸæ­£çš„å¯åŠ¨ç±»
Start-Class: com.example.MyApplication                     ğŸ¯ ä½ çš„ä¸»ç±»
Spring-Boot-Version: 2.7.0                                ğŸ“– ç‰ˆæœ¬ä¿¡æ¯
Spring-Boot-Classes: BOOT-INF/classes/                    ğŸ“ åº”ç”¨ä»£ç ä½ç½®
Spring-Boot-Lib: BOOT-INF/lib/                           ğŸ“š ä¾èµ–åº“ä½ç½®
Created-By: Maven Integration for Eclipse                  ğŸ”§ æ„å»ºå·¥å…·
```

**ğŸ”‘ å…³é”®ç†è§£**ï¼š
- **Main-Class**ï¼šJVMå¯åŠ¨æ—¶æ‰§è¡Œçš„ç±»ï¼ˆSpring Bootçš„å¯åŠ¨å™¨ï¼‰
- **Start-Class**ï¼šä½ å†™çš„ä¸»ç±»ï¼ˆ@SpringBootApplicationæ ‡æ³¨çš„ç±»ï¼‰
- **Spring Bootå¯åŠ¨æµç¨‹**ï¼šJVM â†’ JarLauncher â†’ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ â†’ ä½ çš„ä¸»ç±»

### 3.3 å¯åŠ¨æµç¨‹è¯¦è§£


```
ç”¨æˆ·æ‰§è¡Œï¼šjava -jar my-app.jar

JVMå¯åŠ¨æµç¨‹ï¼š
1ï¸âƒ£ JVMè¯»å–MANIFEST.MFæ‰¾åˆ°Main-Class
2ï¸âƒ£ åˆ›å»ºJarLauncherå®ä¾‹
3ï¸âƒ£ JarLauncheråˆ›å»ºä¸“ç”¨ç±»åŠ è½½å™¨
4ï¸âƒ£ ç±»åŠ è½½å™¨åŠ è½½BOOT-INF/classeså’ŒBOOT-INF/libä¸‹çš„æ‰€æœ‰ç±»
5ï¸âƒ£ æ‰¾åˆ°Start-ClassæŒ‡å®šçš„ä½ çš„ä¸»ç±»
6ï¸âƒ£ è°ƒç”¨ä½ ä¸»ç±»çš„mainæ–¹æ³•
7ï¸âƒ£ Spring Bootåº”ç”¨å¯åŠ¨å®Œæˆï¼
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
- **ğŸ¯ è§£å†³åµŒå¥—JARé—®é¢˜**ï¼šJVMé»˜è®¤æ— æ³•ä»JARå†…çš„JARåŠ è½½ç±»
- **ğŸ”§ è‡ªå®šä¹‰ç±»åŠ è½½**ï¼šSpring Bootæä¾›ä¸“é—¨çš„ç±»åŠ è½½å™¨å¤„ç†è¿™ä¸ªé—®é¢˜
- **ğŸ“¦ ä¿æŒç®€æ´**ï¼šç”¨æˆ·åªéœ€è¦ä¸€ä¸ªJARæ–‡ä»¶ï¼Œå†…éƒ¨ç»“æ„è‡ªåŠ¨å¤„ç†

---

## 4. âš–ï¸ Fat Jar vs Thin Jarå¯¹æ¯”


### 4.1 æ¦‚å¿µè§£é‡Š


**ğŸ” Fat Jar (èƒ–JARåŒ…)**ï¼š
```
ç‰¹ç‚¹ï¼šåŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œä¸€ä¸ªæ–‡ä»¶æå®šä¸€åˆ‡
å¤§å°ï¼šé€šå¸¸50-200MB
éƒ¨ç½²ï¼šåªéœ€è¦ä¸€ä¸ªæ–‡ä»¶
å¯åŠ¨ï¼šjava -jar app.jar

å°±åƒä¸€ä¸ªï¼šğŸ ç¤¼å“å¥—è£… (ä»€ä¹ˆéƒ½æœ‰ï¼Œæ‹¿èµ·å°±èµ°)
```

**ğŸ¥— Thin Jar (ç˜¦JARåŒ…)**ï¼š
```
ç‰¹ç‚¹ï¼šåªåŒ…å«åº”ç”¨ä»£ç ï¼Œä¾èµ–å•ç‹¬ç®¡ç†
å¤§å°ï¼šé€šå¸¸å‡ MBåˆ°å‡ åMB  
éƒ¨ç½²ï¼šéœ€è¦åº”ç”¨JAR + ä¾èµ–ç›®å½•
å¯åŠ¨ï¼šjava -cp app.jar:lib/* com.example.App

å°±åƒä¸€ä¸ªï¼šğŸ”§ å·¥å…·ç®± (å·¥å…·åˆ†å¼€æ”¾ï¼Œéœ€è¦ç»„è£…)
```

### 4.2 è¯¦ç»†å¯¹æ¯”åˆ†æ


| ç‰¹æ€§ | **Fat Jar** | **Thin Jar** | **æœ€ä½³åœºæ™¯** |
|------|------------|--------------|-------------|
| **æ–‡ä»¶å¤§å°** | `ğŸ”´ å¤§ (50-200MB)` | `ğŸŸ¢ å° (5-50MB)` | `å¸¦å®½æ•æ„Ÿç”¨Thin` |
| **éƒ¨ç½²å¤æ‚åº¦** | `ğŸŸ¢ ç®€å• (ä¸€ä¸ªæ–‡ä»¶)` | `ğŸ”´ å¤æ‚ (å¤šä¸ªæ–‡ä»¶)` | `è¿ç»´ç®€å•ç”¨Fat` |
| **å¯åŠ¨é€Ÿåº¦** | `ğŸŸ¡ ä¸­ç­‰` | `ğŸŸ¢ å¿« (ä¾èµ–é¢„åŠ è½½)` | `é¢‘ç¹é‡å¯ç”¨Thin` |
| **ä¾èµ–ç®¡ç†** | `ğŸŸ¢ è‡ªåŠ¨åŒ…å«` | `ğŸ”´ éœ€è¦æ‰‹å·¥ç®¡ç†` | `ä¾èµ–å¤æ‚ç”¨Fat` |
| **ç‰ˆæœ¬å‡çº§** | `ğŸ”´ å…¨é‡æ›¿æ¢` | `ğŸŸ¢ å¢é‡æ›´æ–°` | `é¢‘ç¹æ›´æ–°ç”¨Thin` |
| **Dockerä¼˜åŒ–** | `ğŸ”´ æ¯æ¬¡é‡æ–°ä¸‹è½½` | `ğŸŸ¢ å±‚ç¼“å­˜ä¼˜åŒ–` | `å®¹å™¨åŒ–ç”¨Thin` |

### 4.3 å¦‚ä½•ç”ŸæˆThin Jar


**ğŸ”¸ Mavené…ç½®ç”ŸæˆThin Jar**ï¼š
```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <!-- ğŸ”¥ å…³é”®é…ç½®ï¼šç”ŸæˆThin Jar -->
        <layout>ZIP</layout>
        <includes>
            <include>
                <groupId>nothing</groupId>
                <artifactId>nothing</artifactId>
            </include>
        </includes>
    </configuration>
</plugin>

<!-- æˆ–è€…ä½¿ç”¨thin-launcheræ’ä»¶ -->
<plugin>
    <groupId>org.springframework.boot.experimental</groupId>
    <artifactId>spring-boot-thin-maven-plugin</artifactId>
</plugin>
```

**ğŸš€ Thin Jarè¿è¡Œæ–¹å¼**ï¼š
```bash
# 1. é¦–æ¬¡è¿è¡Œï¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–åˆ°~/.m2/repository/
java -Dthin.root=. -jar my-app.jar

# 2. æŒ‡å®šä¾èµ–ç›®å½•
java -Dthin.root=/path/to/deps -jar my-app.jar

# 3. é¢„å…ˆå‡†å¤‡ä¾èµ–
java -Dthin.dryrun=true -jar my-app.jar  # åªä¸‹è½½ä¾èµ–ä¸å¯åŠ¨
java -jar my-app.jar  # æ­£å¸¸å¯åŠ¨
```

### 4.4 é€‰æ‹©å»ºè®®


**ğŸ¯ Fat Jaré€‚åˆåœºæ™¯**ï¼š
- âœ… **ç®€å•éƒ¨ç½²**ï¼šè¿ç»´å›¢é˜Ÿç»éªŒæœ‰é™
- âœ… **ä¸€æ¬¡æ€§éƒ¨ç½²**ï¼šä¸éœ€è¦é¢‘ç¹æ›´æ–°
- âœ… **å°è§„æ¨¡åº”ç”¨**ï¼šä¾èµ–ä¸å¤ªå¤šï¼ŒåŒ…å¤§å°å¯æ¥å—
- âœ… **å¼€å‘æµ‹è¯•**ï¼šå¿«é€ŸéªŒè¯åŠŸèƒ½

**ğŸ¯ Thin Jaré€‚åˆåœºæ™¯**ï¼š
- âœ… **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDockeré•œåƒåˆ†å±‚ä¼˜åŒ–
- âœ… **é¢‘ç¹æ›´æ–°**ï¼šåº”ç”¨ä»£ç ç»å¸¸å˜åŒ–
- âœ… **å¤§å‹é¡¹ç›®**ï¼šä¾èµ–åº“å¾ˆå¤šï¼ŒåŒ…å¤ªå¤§
- âœ… **å¾®æœåŠ¡æ¶æ„**ï¼šå¤šä¸ªæœåŠ¡å…±äº«ä¾èµ–

---

## 5. ğŸ”„ ç±»åŠ è½½å™¨é‡å®šä½æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨é‡å®šä½ï¼Ÿ


**é—®é¢˜èƒŒæ™¯**ï¼šJVMé»˜è®¤æ— æ³•ä»åµŒå¥—JARä¸­åŠ è½½ç±»

```
ä¼ ç»ŸJARåŠ è½½ï¼š
app.jar
â”œâ”€â”€ com/example/App.class     âœ… å¯ä»¥åŠ è½½
â””â”€â”€ lib/
    â””â”€â”€ spring.jar            âŒ æ— æ³•åŠ è½½åµŒå¥—JARä¸­çš„ç±»
        â””â”€â”€ org/springframework/...
```

**Spring Bootè§£å†³æ–¹æ¡ˆ**ï¼šè‡ªå®šä¹‰ç±»åŠ è½½å™¨

```
Spring Bootå¯æ‰§è¡ŒJARï¼š
my-app.jar
â”œâ”€â”€ org/springframework/boot/loader/   ğŸš€ è‡ªå®šä¹‰ç±»åŠ è½½å™¨
â”‚   â”œâ”€â”€ JarLauncher.class             ğŸ”§ JARå¯åŠ¨å™¨  
â”‚   â”œâ”€â”€ LaunchedURLClassLoader.class  ğŸ“š ä¸“ç”¨ç±»åŠ è½½å™¨
â”‚   â””â”€â”€ JarFile.class                 ğŸ“ åµŒå¥—JARå¤„ç†å™¨
â””â”€â”€ BOOT-INF/
    â”œâ”€â”€ classes/                       âœ… åº”ç”¨ç±»
    â””â”€â”€ lib/                          âœ… ä¾èµ–JAR(é€šè¿‡è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½)
```

### 5.2 ç±»åŠ è½½æµç¨‹è¯¦è§£


**ğŸ”„ å®Œæ•´ç±»åŠ è½½æµç¨‹**ï¼š

```
å¯åŠ¨è¿‡ç¨‹ï¼šjava -jar my-app.jar

ç¬¬1æ­¥ï¼šç³»ç»Ÿç±»åŠ è½½å™¨å¯åŠ¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç³»ç»Ÿç±»åŠ è½½å™¨                 â”‚
â”‚ åŠ è½½ï¼šJarLauncher.class      â”‚ 
â”‚ ä½ç½®ï¼šjaråŒ…æ ¹ç›®å½•            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
ç¬¬2æ­¥ï¼šåˆ›å»ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LaunchedURLClassLoader       â”‚
â”‚ æ‰«æï¼šBOOT-INF/classes       â”‚
â”‚ æ‰«æï¼šBOOT-INF/lib/*.jar     â”‚
â”‚ å»ºç«‹ï¼šç±»è·¯å¾„æ˜ å°„è¡¨           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
ç¬¬3æ­¥ï¼šè®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Thread.setContextClassLoader â”‚
â”‚ æ›¿æ¢ï¼šé»˜è®¤ç±»åŠ è½½å™¨           â”‚
â”‚ ä½¿ç”¨ï¼šè‡ªå®šä¹‰ç±»åŠ è½½å™¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
ç¬¬4æ­¥ï¼šå¯åŠ¨åº”ç”¨ä¸»ç±»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åå°„è°ƒç”¨ï¼šYourApp.main()     â”‚
â”‚ ç±»åŠ è½½ï¼šç”±è‡ªå®šä¹‰åŠ è½½å™¨å¤„ç†    â”‚
â”‚ è¿è¡Œæ—¶ï¼šæ‰€æœ‰ç±»éƒ½èƒ½æ­£ç¡®åŠ è½½    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 å…³é”®æŠ€æœ¯å®ç°


**ğŸ”§ æ ¸å¿ƒæŠ€æœ¯ç‚¹**ï¼š

| æŠ€æœ¯ç»„ä»¶ | **ä½œç”¨** | **è§£å†³é—®é¢˜** |
|---------|---------|-------------|
| **JarFile** | `å¤„ç†åµŒå¥—JARè¯»å–` | `JVMæ— æ³•ç›´æ¥è¯»å–JARå†…çš„JAR` |
| **URLåè®®æ‰©å±•** | `jar:file:/app.jar!/BOOT-INF/lib/spring.jar!/` | `å®šä½åµŒå¥—JARä¸­çš„èµ„æº` |
| **LaunchedURLClassLoader** | `è‡ªå®šä¹‰ç±»åŠ è½½é€»è¾‘` | `æŒ‰Spring Bootè§„åˆ™åŠ è½½ç±»` |
| **ArchiveæŠ½è±¡** | `ç»Ÿä¸€å¤„ç†JARå’Œç›®å½•` | `å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç»Ÿä¸€` |

**ğŸ’¡ é‡å®šä½çš„å«ä¹‰**ï¼š
- **ç‰©ç†ä½ç½®**ï¼šç±»æ–‡ä»¶åœ¨`BOOT-INF/classes`å’Œ`BOOT-INF/lib/*.jar`ä¸­  
- **é€»è¾‘ä½ç½®**ï¼šç±»åŠ è½½å™¨è®©JVMä»¥ä¸ºç±»åœ¨ä¼ ç»Ÿçš„classpathä¸­
- **é€æ˜å¤„ç†**ï¼šåº”ç”¨ä»£ç æ— æ„ŸçŸ¥ï¼Œæ­£å¸¸ä½¿ç”¨å„ç§æ¡†æ¶å’Œåº“

### 5.4 æ€§èƒ½ä¼˜åŒ–æœºåˆ¶


**âš¡ åŠ è½½ä¼˜åŒ–ç­–ç•¥**ï¼š

```
1ï¸âƒ£ æ‡’åŠ è½½æœºåˆ¶
â”œâ”€â”€ å¯åŠ¨æ—¶ï¼šåªåŠ è½½å¿…éœ€çš„æ ¸å¿ƒç±»
â”œâ”€â”€ è¿è¡Œæ—¶ï¼šæŒ‰éœ€åŠ è½½å…¶ä»–ç±»  
â””â”€â”€ ä¼˜åŠ¿ï¼šå¯åŠ¨é€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜å ç”¨æ›´ä½

2ï¸âƒ£ ç¼“å­˜æœºåˆ¶  
â”œâ”€â”€ ç±»ç¼“å­˜ï¼šå·²åŠ è½½çš„ç±»ä¸é‡å¤åŠ è½½
â”œâ”€â”€ èµ„æºç¼“å­˜ï¼šé…ç½®æ–‡ä»¶ç­‰èµ„æºç¼“å­˜
â””â”€â”€ ä¼˜åŠ¿ï¼šè¿è¡Œæ—¶æ€§èƒ½æ›´å¥½

3ï¸âƒ£ å¹¶è¡ŒåŠ è½½
â”œâ”€â”€ å¤šçº¿ç¨‹ï¼šåŒæ—¶åŠ è½½ä¸åŒJARä¸­çš„ç±»
â”œâ”€â”€ æ— é”è®¾è®¡ï¼šå‡å°‘åŠ è½½æ—¶çš„ç«äº‰
â””â”€â”€ ä¼˜åŠ¿ï¼šå¤šæ ¸CPUåˆ©ç”¨ç‡æ›´é«˜
```

---

## 6. ğŸ—ï¸ Layered Jaråˆ†å±‚æ„å»º


### 6.1 ä»€ä¹ˆæ˜¯åˆ†å±‚JARï¼Ÿ


**ä¼ ç»Ÿé—®é¢˜**ï¼šDockeré•œåƒæ¯æ¬¡éƒ½è¦é‡æ–°ä¸‹è½½æ•´ä¸ªJAR

```
ä¼ ç»ŸFat Jaråœ¨Dockerä¸­ï¼š
COPY my-app.jar /app/          # 50MBæ–‡ä»¶
RUN java -jar /app/my-app.jar  

æ¯æ¬¡ä»£ç æ”¹åŠ¨ï¼š
- é‡æ–°æ„å»ºæ•´ä¸ª50MBçš„JAR  âŒ
- Dockeræ— æ³•ç¼“å­˜ä»»ä½•å±‚    âŒ  
- æ¯æ¬¡éƒ½è¦é‡æ–°ä¸‹è½½50MB   âŒ
```

**åˆ†å±‚JARè§£å†³æ–¹æ¡ˆ**ï¼šæŠŠJARæŒ‰å˜åŒ–é¢‘ç‡åˆ†å±‚

```
åˆ†å±‚JARç»“æ„ï¼š
my-app.jar
â”œâ”€â”€ dependencies/              ğŸ—ï¸ ç¬¬ä¸‰æ–¹ä¾èµ– (å¾ˆå°‘å˜åŒ–)
â”œâ”€â”€ spring-boot-loader/        ğŸš€ Bootå¯åŠ¨å™¨ (å‡ ä¹ä¸å˜) 
â”œâ”€â”€ snapshot-dependencies/     ğŸ“¦ å¿«ç…§ä¾èµ– (å¶å°”å˜åŒ–)
â”œâ”€â”€ application/               ğŸ’» åº”ç”¨ä»£ç  (ç»å¸¸å˜åŒ–)
â””â”€â”€ layered.idx               ğŸ“‹ åˆ†å±‚ç´¢å¼•æ–‡ä»¶
```

### 6.2 å¯ç”¨åˆ†å±‚æ„å»º


**ğŸ”§ Mavené…ç½®**ï¼š
```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <layers>
            <enabled>true</enabled>  ğŸ”¥ å¯ç”¨åˆ†å±‚
            <configuration>layers.xml</configuration>  ğŸ“ è‡ªå®šä¹‰åˆ†å±‚é…ç½®
        </layers>
    </configuration>
</plugin>
```

**ğŸ“ è‡ªå®šä¹‰åˆ†å±‚é…ç½® (layers.xml)**ï¼š
```xml
<layers xmlns="http://www.springframework.org/schema/boot/layers"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="...">
    
    <application>
        <into layer="spring-boot-loader">
            <include>org/springframework/boot/loader/**</include>
        </into>
        <into layer="application" />  <!-- é»˜è®¤å±‚ï¼Œåº”ç”¨ä»£ç  -->
    </application>
    
    <dependencies>
        <into layer="dependencies">
            <includeModuleDependencies />  <!-- ç¬¬ä¸‰æ–¹ä¾èµ– -->
        </into>
        <into layer="snapshot-dependencies">
            <include>*:*:*SNAPSHOT</include>  <!-- å¿«ç…§ä¾èµ– -->
        </into>
    </dependencies>
</layers>
```

### 6.3 Dockerä¼˜åŒ–å®æˆ˜


**ğŸ³ Dockerfileä¼˜åŒ–å‰åå¯¹æ¯”**ï¼š

**âŒ ä¼ ç»Ÿåšæ³•**ï¼š
```dockerfile
FROM openjdk:11-jre-slim
COPY my-app.jar /app.jar      # æ¯æ¬¡éƒ½é‡æ–°å¤åˆ¶50MB
ENTRYPOINT ["java", "-jar", "/app.jar"]

# æ¯æ¬¡æ„å»ºéƒ½éœ€è¦é‡æ–°ä¸‹è½½æ•´ä¸ªJAR
```

**âœ… åˆ†å±‚ä¼˜åŒ–åšæ³•**ï¼š
```dockerfile
FROM openjdk:11-jre-slim as builder
WORKDIR /application
COPY my-app.jar application.jar
RUN java -Djarmode=layertools -jar application.jar extract

FROM openjdk:11-jre-slim
WORKDIR /application

# ğŸ“¦ æŒ‰ç…§å˜åŒ–é¢‘ç‡ä»ä½åˆ°é«˜å¤åˆ¶å±‚
COPY --from=builder application/dependencies/ ./      # å¾ˆå°‘å˜åŒ–ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜
COPY --from=builder application/spring-boot-loader/ ./  # å‡ ä¹ä¸å˜
COPY --from=builder application/snapshot-dependencies/ ./  # å¶å°”å˜åŒ–
COPY --from=builder application/application/ ./         # ç»å¸¸å˜åŒ–ï¼Œæ”¾æœ€å

ENTRYPOINT ["java", "org.springframework.boot.loader.JarLauncher"]
```

### 6.4 åˆ†å±‚æ•ˆæœåˆ†æ


**ğŸ“Š æ„å»ºæ•ˆç‡å¯¹æ¯”**ï¼š

| åœºæ™¯ | **ä¼ ç»ŸJAR** | **åˆ†å±‚JAR** | **æå‡æ•ˆæœ** |
|------|------------|------------|-------------|
| **é¦–æ¬¡æ„å»º** | `ä¸‹è½½50MB` | `ä¸‹è½½50MB` | `æ— å·®å¼‚` |
| **ä»£ç ä¿®æ”¹** | `é‡æ–°ä¸‹è½½50MB` | `åªä¸‹è½½5MBåº”ç”¨å±‚` | `ğŸš€ 90%æå‡` |
| **ä¾èµ–å‡çº§** | `é‡æ–°ä¸‹è½½50MB` | `ä¸‹è½½20MBä¾èµ–å±‚` | `ğŸš€ 60%æå‡` |
| **Spring Bootå‡çº§** | `é‡æ–°ä¸‹è½½50MB` | `ä¸‹è½½2MBå¯åŠ¨å™¨å±‚` | `ğŸš€ 96%æå‡` |

**ğŸ’° å®é™…æ”¶ç›Š**ï¼š
- **ğŸ• æ„å»ºæ—¶é—´**ï¼šä»5åˆ†é’Ÿé™åˆ°30ç§’
- **ğŸ’¾ å¸¦å®½èŠ‚çœ**ï¼šèŠ‚çœ80-90%çš„ç½‘ç»œä¼ è¾“
- **ğŸ”„ éƒ¨ç½²é¢‘ç‡**ï¼šæ”¯æŒæ›´é¢‘ç¹çš„å‘å¸ƒ
- **âš¡ å¼€å‘æ•ˆç‡**ï¼šå¼€å‘-æµ‹è¯•-éƒ¨ç½²å¾ªç¯æ›´å¿«

### 6.5 åˆ†å±‚å·¥å…·å‘½ä»¤


**ğŸ› ï¸ layertoolså‘½ä»¤**ï¼š
```bash
# ğŸ“‹ æŸ¥çœ‹JARåˆ†å±‚ä¿¡æ¯
java -Djarmode=layertools -jar my-app.jar list
è¾“å‡ºï¼š
dependencies
spring-boot-loader  
snapshot-dependencies
application

# ğŸ“¦ æå–åˆ†å±‚åˆ°ç›®å½•
java -Djarmode=layertools -jar my-app.jar extract

# ğŸ” æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶å±äºå“ªä¸€å±‚
java -Djarmode=layertools -jar my-app.jar list --verbose
```

**ğŸ’¡ å¼€å‘è°ƒè¯•æŠ€å·§**ï¼š
```bash
# éªŒè¯åˆ†å±‚æ•ˆæœ
docker build -t my-app:layered .
docker history my-app:layered --no-trunc

# æŸ¥çœ‹æ¯å±‚å¤§å°å’Œç¼“å­˜å‘½ä¸­æƒ…å†µ  
docker system df -v
```

---

## 7. ğŸš€ å¯åŠ¨è„šæœ¬ç”Ÿæˆ


### 7.1 ä»€ä¹ˆæ˜¯å¯åŠ¨è„šæœ¬ï¼Ÿ


**é—®é¢˜åœºæ™¯**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ›´çµæ´»çš„å¯åŠ¨æ–¹å¼

```
åŸºæœ¬å¯åŠ¨ï¼šjava -jar app.jar                    âœ… ç®€å•ï¼Œä½†åŠŸèƒ½æœ‰é™
è„šæœ¬å¯åŠ¨ï¼š./app.jar start|stop|restart|status  ğŸš€ åŠŸèƒ½å¼ºå¤§ï¼Œåƒç³»ç»ŸæœåŠ¡
```

**å¯åŠ¨è„šæœ¬çš„ä»·å€¼**ï¼š
- **ğŸ”„ æœåŠ¡ç®¡ç†**ï¼šstartã€stopã€restartã€statusæ“ä½œ
- **ğŸ“Š è¿›ç¨‹ç›‘æ§**ï¼šPIDæ–‡ä»¶ç®¡ç†ï¼Œè¿›ç¨‹çŠ¶æ€æ£€æŸ¥
- **ğŸ›¡ï¸ ä¼˜é›…å…³é—­**ï¼šæ­£ç¡®å¤„ç†SIGTERMä¿¡å·
- **ğŸ“ æ—¥å¿—ç®¡ç†**ï¼šæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶
- **âš™ï¸ é…ç½®çµæ´»**ï¼šç¯å¢ƒå˜é‡ã€JVMå‚æ•°è®¾ç½®

### 7.2 å¯ç”¨å¯åŠ¨è„šæœ¬ç”Ÿæˆ


**ğŸ”§ Mavenæ’ä»¶é…ç½®**ï¼š
```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <!-- ğŸš€ å¯ç”¨å¯æ‰§è¡Œè„šæœ¬ -->
        <executable>true</executable>
        
        <!-- ğŸ“ åµŒå…¥å¯åŠ¨ä¿¡æ¯ -->
        <embeddedLaunchScript>src/main/scripts/launch.script</embeddedLaunchScript>
        
        <!-- âš™ï¸ è„šæœ¬å±æ€§é…ç½® -->
        <embeddedLaunchScriptProperties>
            <mode>service</mode>                    <!-- è¿è¡Œæ¨¡å¼ -->
            <initInfoProvides>my-app</initInfoProvides>    <!-- æœåŠ¡åç§° -->
            <initInfoShortDescription>My Application</initInfoShortDescription>
            <initInfoDescription>Spring Boot application for awesome features</initInfoDescription>
        </embeddedLaunchScriptProperties>
    </configuration>
</plugin>
```

**ğŸ¯ ç”Ÿæˆçš„JARç‰¹ç‚¹**ï¼š
- **æ–‡ä»¶æƒé™**ï¼šè‡ªåŠ¨è®¾ç½®ä¸ºå¯æ‰§è¡Œ (chmod +x)
- **Shellè„šæœ¬å¤´**ï¼šJARæ–‡ä»¶å‰é¢æ·»åŠ shellè„šæœ¬
- **åŒé‡èº«ä»½**ï¼šæ—¢æ˜¯shellè„šæœ¬ï¼Œåˆæ˜¯JARæ–‡ä»¶

### 7.3 å¯åŠ¨è„šæœ¬åŠŸèƒ½è¯¦è§£


**ğŸ“‹ æ”¯æŒçš„æ“ä½œå‘½ä»¤**ï¼š

| å‘½ä»¤ | **åŠŸèƒ½** | **è¯´æ˜** |
|------|---------|---------|
| `./app.jar start` | **å¯åŠ¨æœåŠ¡** | `åå°è¿è¡Œï¼Œç”ŸæˆPIDæ–‡ä»¶` |
| `./app.jar stop` | **åœæ­¢æœåŠ¡** | `ä¼˜é›…å…³é—­ï¼Œæ¸…ç†PIDæ–‡ä»¶` |
| `./app.jar restart` | **é‡å¯æœåŠ¡** | `stop + startçš„ç»„åˆ` |
| `./app.jar status` | **æŸ¥çœ‹çŠ¶æ€** | `æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€å’ŒPID` |
| `./app.jar run` | **å‰å°è¿è¡Œ** | `ç›´æ¥å¯åŠ¨ï¼Œä¸åå°åŒ–` |
| `./app.jar force-stop` | **å¼ºåˆ¶åœæ­¢** | `å‘é€SIGKILLä¿¡å·` |
| `./app.jar force-reload` | **å¼ºåˆ¶é‡å¯** | `force-stop + start` |

**ğŸ› ï¸ å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# ğŸ“¦ éƒ¨ç½²åº”ç”¨
scp my-app.jar server:/opt/myapp/
ssh server "chmod +x /opt/myapp/my-app.jar"

# ğŸš€ å¯åŠ¨æœåŠ¡  
./my-app.jar start
Starting my-app: [  OK  ]

# ğŸ“Š æ£€æŸ¥çŠ¶æ€
./my-app.jar status  
my-app is running with pid 12345

# ğŸ”„ é‡å¯æœåŠ¡
./my-app.jar restart
Stopping my-app: [  OK  ]
Starting my-app: [  OK  ]

# ğŸ›‘ åœæ­¢æœåŠ¡
./my-app.jar stop
Stopping my-app: [  OK  ]
```

### 7.4 é«˜çº§é…ç½®é€‰é¡¹


**âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®**ï¼š
```bash
# åœ¨JARåŒç›®å½•åˆ›å»º my-app.conf é…ç½®æ–‡ä»¶
export JAVA_OPTS="-Xmx1024m -Xms512m"              # JVMå‚æ•°
export SPRING_PROFILES_ACTIVE="prod"                # Springé…ç½®æ–‡ä»¶
export SERVER_PORT="8080"                          # åº”ç”¨ç«¯å£  
export LOG_FOLDER="/var/log/myapp"                  # æ—¥å¿—ç›®å½•
export PID_FOLDER="/var/run/myapp"                  # PIDæ–‡ä»¶ç›®å½•
export RUN_ARGS="--spring.config.location=file:./config/"  # å¯åŠ¨å‚æ•°
```

**ğŸ“ è‡ªå®šä¹‰å¯åŠ¨è„šæœ¬æ¨¡æ¿**ï¼š
```bash
# src/main/scripts/launch.script
#!/bin/bash
# ğŸ”§ è‡ªå®šä¹‰çš„å¯åŠ¨è„šæœ¬æ¨¡æ¿
# å¯ä»¥æ·»åŠ è‡ªå·±çš„é€»è¾‘ï¼Œå¦‚ï¼š
# - ç¯å¢ƒæ£€æŸ¥
# - é…ç½®æ–‡ä»¶éªŒè¯  
# - å¥åº·æ£€æŸ¥
# - ç›‘æ§é›†æˆ

# æ£€æŸ¥Javaç¯å¢ƒ
if [ -z "$JAVA_HOME" ]; then
    echo "âŒ JAVA_HOME not set"  
    exit 1
fi

# æ£€æŸ¥é…ç½®æ–‡ä»¶
if [ ! -f "./application.yml" ]; then
    echo "âš ï¸  Warning: application.yml not found"
fi

# è®¾ç½®é»˜è®¤JVMå‚æ•°
export JAVA_OPTS="$JAVA_OPTS -Djava.security.egd=file:/dev/./urandom"

# åœ¨è¿™é‡Œæ·»åŠ åŸå§‹çš„Spring Bootå¯åŠ¨è„šæœ¬å†…å®¹
# {{script}}  # Spring Bootä¼šæ›¿æ¢è¿™ä¸ªå ä½ç¬¦
```

### 7.5 ç³»ç»ŸæœåŠ¡é›†æˆ


**ğŸ”§ systemdæœåŠ¡é…ç½®**ï¼š
```ini
# /etc/systemd/system/my-app.service
[Unit]
Description=My Spring Boot Application
After=network.target

[Service]
Type=forking
User=myapp
ExecStart=/opt/myapp/my-app.jar start
ExecStop=/opt/myapp/my-app.jar stop  
ExecReload=/opt/myapp/my-app.jar restart
PIDFile=/var/run/myapp/my-app.pid
SuccessExitStatus=143

[Install]  
WantedBy=multi-user.target
```

**ğŸš€ ç³»ç»ŸæœåŠ¡ç®¡ç†**ï¼š
```bash
# å¯ç”¨æœåŠ¡
sudo systemctl enable my-app
sudo systemctl start my-app

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status my-app
sudo journalctl -u my-app -f  # æŸ¥çœ‹æ—¥å¿—

# é‡å¯æœåŠ¡
sudo systemctl restart my-app
```

**ğŸ’¡ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**ï¼š
- **ğŸ‘¤ ä¸“ç”¨ç”¨æˆ·**ï¼šåˆ›å»ºä¸“é—¨çš„åº”ç”¨ç”¨æˆ·è¿è¡ŒæœåŠ¡
- **ğŸ“ ç›®å½•è§„åˆ’**ï¼šåº”ç”¨æ–‡ä»¶ã€é…ç½®ã€æ—¥å¿—ã€PIDåˆ†ç¦»
- **ğŸ”’ æƒé™æ§åˆ¶**ï¼šæœ€å°æƒé™åŸåˆ™
- **ğŸ“Š ç›‘æ§é›†æˆ**ï¼šé…åˆç›‘æ§ç³»ç»Ÿä½¿ç”¨
- **ğŸ”„ è‡ªåŠ¨é‡å¯**ï¼šé…ç½®æœåŠ¡å¼‚å¸¸æ—¶è‡ªåŠ¨é‡å¯

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¯æ‰§è¡ŒJARï¼šSpring Bootçš„æ ¸å¿ƒç‰¹æ€§ï¼Œä¸€ä¸ªæ–‡ä»¶åŒ…å«ä¸€åˆ‡
ğŸ”¸ Mavenæ’ä»¶ï¼šspring-boot-maven-pluginæ˜¯å…³é”®ï¼Œrepackageç›®æ ‡å®ç°æ‰“åŒ…  
ğŸ”¸ JARç»“æ„ï¼šBOOT-INFç›®å½•å­˜æ”¾åº”ç”¨ä»£ç å’Œä¾èµ–ï¼ŒMETA-INF/MANIFEST.MFå®šä¹‰å¯åŠ¨ä¿¡æ¯
ğŸ”¸ ç±»åŠ è½½å™¨ï¼šè‡ªå®šä¹‰LaunchedURLClassLoaderè§£å†³åµŒå¥—JARåŠ è½½é—®é¢˜
ğŸ”¸ åˆ†å±‚æ„å»ºï¼šæŒ‰å˜åŒ–é¢‘ç‡åˆ†å±‚ï¼Œä¼˜åŒ–Dockeræ„å»ºæ•ˆç‡
ğŸ”¸ å¯åŠ¨è„šæœ¬ï¼šç”Ÿæˆå¯æ‰§è¡Œè„šæœ¬ï¼Œæ”¯æŒæœåŠ¡åŒ–ç®¡ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Fat Jar vs Thin Jaré€‰æ‹©ç­–ç•¥**
```
Fat Jaré€‚åˆï¼š
â€¢ ç®€å•éƒ¨ç½²åœºæ™¯ï¼Œè¿ç»´ç»éªŒæœ‰é™
â€¢ ä¸€æ¬¡æ€§éƒ¨ç½²ï¼Œä¸é¢‘ç¹æ›´æ–°  
â€¢ å°è§„æ¨¡åº”ç”¨ï¼Œä¾èµ–ä¸å¤š

Thin Jaré€‚åˆï¼š
â€¢ å®¹å™¨åŒ–éƒ¨ç½²ï¼Œéœ€è¦Dockerå±‚ä¼˜åŒ–
â€¢ é¢‘ç¹æ›´æ–°ï¼Œåº”ç”¨ä»£ç å˜åŒ–å¿«
â€¢ å¤§å‹é¡¹ç›®ï¼Œä¾èµ–åº“å¾ˆå¤š
```

**ğŸ”¹ åˆ†å±‚æ„å»ºçš„æ ¸å¿ƒä»·å€¼**
```
é—®é¢˜ï¼šä¼ ç»ŸJARåœ¨Dockerä¸­æ— æ³•åˆ©ç”¨å±‚ç¼“å­˜
è§£å†³ï¼šæŒ‰å˜åŒ–é¢‘ç‡åˆ†å±‚ï¼Œä¾èµ–å±‚ç¼“å­˜å‘½ä¸­ç‡é«˜
æ•ˆæœï¼šæ„å»ºé€Ÿåº¦æå‡90%ï¼Œç½‘ç»œä¼ è¾“èŠ‚çœ80%
```

**ğŸ”¹ å¯åŠ¨è„šæœ¬çš„å®ç”¨ä»·å€¼**
```
å¼€å‘é˜¶æ®µï¼šjava -jar app.jar (ç®€å•ç›´æ¥)
ç”Ÿäº§ç¯å¢ƒï¼š./app.jar start|stop|restart (æœåŠ¡åŒ–ç®¡ç†)
ç³»ç»Ÿé›†æˆï¼šsystemdæœåŠ¡ï¼Œå¼€æœºè‡ªå¯ï¼Œç›‘æ§å‘Šè­¦
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¼€å‘ç¯å¢ƒæ¨èé…ç½®**ï¼š
```xml
<!-- å¼€å‘é˜¶æ®µï¼šå¿«é€Ÿå¯åŠ¨ï¼Œçƒ­é‡è½½ -->
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <excludes>
            <exclude>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-devtools</artifactId>
            </exclude>
        </excludes>
    </configuration>
</plugin>

# ä½¿ç”¨ï¼šmvn spring-boot:run
```

**ğŸ¯ ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®**ï¼š
```xml
<!-- ç”Ÿäº§éƒ¨ç½²ï¼šåˆ†å±‚æ„å»ºï¼Œå¯åŠ¨è„šæœ¬ -->
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <executable>true</executable>  <!-- å¯åŠ¨è„šæœ¬ -->
        <layers>
            <enabled>true</enabled>     <!-- åˆ†å±‚æ„å»º -->
        </layers>
        <excludes>
            <exclude>
                <groupId>org.springframework.boot</groupId>  
                <artifactId>spring-boot-devtools</artifactId>
            </exclude>
        </excludes>
    </configuration>  
</plugin>

# ä½¿ç”¨ï¼šmvn clean package -Dmaven.test.skip=true
```

**ğŸ¯ å®¹å™¨åŒ–æ¨èé…ç½®**ï¼š
```dockerfile  
# åˆ©ç”¨åˆ†å±‚æ„å»ºä¼˜åŒ–Dockeré•œåƒ
FROM openjdk:11-jre-slim as builder
WORKDIR /application
COPY target/my-app.jar application.jar
RUN java -Djarmode=layertools -jar application.jar extract

FROM openjdk:11-jre-slim  
WORKDIR /application
COPY --from=builder application/dependencies/ ./
COPY --from=builder application/spring-boot-loader/ ./
COPY --from=builder application/snapshot-dependencies/ ./  
COPY --from=builder application/application/ ./
ENTRYPOINT ["java", "org.springframework.boot.loader.JarLauncher"]
```

### 8.4 å¸¸è§é—®é¢˜è§£å†³


**â“ å¯åŠ¨æ—¶æ‰¾ä¸åˆ°ä¸»ç±»**
```
åŸå› ï¼šMANIFEST.MFä¸­Start-Classé…ç½®é”™è¯¯
è§£å†³ï¼šæ£€æŸ¥@SpringBootApplicationæ³¨è§£çš„ç±»è·¯å¾„
éªŒè¯ï¼šjar tf my-app.jar | grep MANIFEST
```

**â“ ä¾èµ–å†²çªæˆ–ClassNotFoundException**  
```
åŸå› ï¼šFat Jarä¸­ä¾èµ–ç‰ˆæœ¬å†²çª
è§£å†³ï¼šä½¿ç”¨mvn dependency:treeæ£€æŸ¥ä¾èµ–æ ‘
æ’é™¤ï¼šåœ¨pom.xmlä¸­ä½¿ç”¨<exclusions>æ’é™¤å†²çªä¾èµ–
```

**â“ Dockeræ„å»ºé€Ÿåº¦æ…¢**
```
åŸå› ï¼šæ²¡æœ‰å¯ç”¨åˆ†å±‚æ„å»º
è§£å†³ï¼šå¯ç”¨layersé…ç½®ï¼Œä½¿ç”¨åˆ†å±‚Dockerfile
éªŒè¯ï¼šdocker historyæŸ¥çœ‹å±‚ç¼“å­˜å‘½ä¸­æƒ…å†µ
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Spring Bootå¯æ‰§è¡ŒJAR = **ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä¸€åˆ‡ï¼ŒåŒå‡»è¿è¡Œ**
- Fat Jaré€‚åˆ**ç®€å•éƒ¨ç½²**ï¼ŒThin Jaré€‚åˆ**å®¹å™¨åŒ–å’Œé¢‘ç¹æ›´æ–°**  
- åˆ†å±‚æ„å»ºæŒ‰**å˜åŒ–é¢‘ç‡åˆ†å±‚**ï¼Œå¤§å¹…ä¼˜åŒ–Dockeræ„å»ºæ•ˆç‡
- å¯åŠ¨è„šæœ¬è®©JARå˜æˆ**ç³»ç»ŸæœåŠ¡**ï¼Œæ”¯æŒstart/stop/restartæ“ä½œ
- ç”Ÿäº§ç¯å¢ƒå»ºè®®åŒæ—¶å¯ç”¨**åˆ†å±‚æ„å»º**å’Œ**å¯åŠ¨è„šæœ¬**åŠŸèƒ½