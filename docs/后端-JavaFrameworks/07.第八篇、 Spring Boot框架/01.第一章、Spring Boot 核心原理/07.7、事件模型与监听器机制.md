---
title: 7ã€äº‹ä»¶æ¨¡å‹ä¸ç›‘å¬å™¨æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [Spring Bootäº‹ä»¶æ¨¡å‹æ¦‚è¿°](#1-spring-bootäº‹ä»¶æ¨¡å‹æ¦‚è¿°)
2. [ApplicationEventäº‹ä»¶ä½“ç³»](#2-applicationeventäº‹ä»¶ä½“ç³»)
3. [ApplicationListenerç›‘å¬å™¨](#3-applicationlistenerç›‘å¬å™¨)
4. [SpringApplicationRunListenerå¯åŠ¨ç›‘å¬](#4-springapplicationrunlistenerå¯åŠ¨ç›‘å¬)
5. [ç”Ÿå‘½å‘¨æœŸå…³é”®äº‹ä»¶](#5-ç”Ÿå‘½å‘¨æœŸå…³é”®äº‹ä»¶)
6. [è‡ªå®šä¹‰äº‹ä»¶å‘å¸ƒä¸å¤„ç†](#6-è‡ªå®šä¹‰äº‹ä»¶å‘å¸ƒä¸å¤„ç†)
7. [äº‹ä»¶ä¼ æ’­æœºåˆ¶](#7-äº‹ä»¶ä¼ æ’­æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Spring Bootäº‹ä»¶æ¨¡å‹æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯äº‹ä»¶æ¨¡å‹


**é€šä¿—ç†è§£**ï¼šå°±åƒç°å®ç”Ÿæ´»ä¸­çš„"é€šçŸ¥ç³»ç»Ÿ"

```
ç°å®åœºæ™¯ï¼š
è€å¸ˆä¸Šè¯¾æ—¶è¯´ï¼š"ä¸‹è¯¾äº†ï¼"
å­¦ç”Ÿä»¬å¬åˆ°åï¼š
- æœ‰çš„æ”¶æ‹¾ä¹¦åŒ…
- æœ‰çš„å»å•æ‰€  
- æœ‰çš„å»é£Ÿå ‚

Spring Bootäº‹ä»¶æœºåˆ¶ï¼š
åº”ç”¨å¯åŠ¨æ—¶å‘å¸ƒï¼š"å¯åŠ¨å®Œæˆäº‹ä»¶ï¼"
å„ä¸ªç»„ä»¶å¬åˆ°åï¼š
- æ•°æ®åº“ç»„ä»¶ï¼šåˆå§‹åŒ–è¿æ¥æ± 
- ç¼“å­˜ç»„ä»¶ï¼šé¢„çƒ­æ•°æ®
- ç›‘æ§ç»„ä»¶ï¼šå¼€å§‹æ”¶é›†æŒ‡æ ‡
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **äº‹ä»¶ï¼ˆEventï¼‰**ï¼šå‘ç”Ÿçš„äº‹æƒ…ï¼Œæ¯”å¦‚"åº”ç”¨å¯åŠ¨å®Œæˆ"
- **å‘å¸ƒè€…ï¼ˆPublisherï¼‰**ï¼šå‘å¸ƒäº‹ä»¶çš„äººï¼Œæ¯”å¦‚Spring Bootæ¡†æ¶
- **ç›‘å¬è€…ï¼ˆListenerï¼‰**ï¼šç›‘å¬äº‹ä»¶çš„äººï¼Œæ¯”å¦‚ä½ å†™çš„ä¸šåŠ¡ä»£ç 
- **äº‹ä»¶æ€»çº¿**ï¼šè´Ÿè´£æŠŠäº‹ä»¶ä¼ é€’ç»™æ‰€æœ‰ç›‘å¬è€…

### 1.2 ä¸ºä»€ä¹ˆè¦ç”¨äº‹ä»¶æ¨¡å‹


**è§£å†³ä»€ä¹ˆé—®é¢˜**ï¼š

```
æ²¡æœ‰äº‹ä»¶æ¨¡å‹æ—¶ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç›´æ¥è°ƒç”¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯åŠ¨é€»è¾‘   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  åˆå§‹åŒ–A    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚           â”‚  åˆå§‹åŒ–B    â”‚
                        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  åˆå§‹åŒ–C    â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼šå¯åŠ¨é€»è¾‘å’Œå„ä¸ªç»„ä»¶è€¦åˆä¸¥é‡ï¼Œéš¾ä»¥æ‰©å±•

æœ‰äº†äº‹ä»¶æ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å‘å¸ƒäº‹ä»¶    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯åŠ¨é€»è¾‘   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  äº‹ä»¶æ€»çº¿   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚            â”‚            â”‚
                        â–¼            â–¼            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   ç›‘å¬å™¨A   â”‚ â”‚   ç›‘å¬å™¨B   â”‚ â”‚   ç›‘å¬å™¨C   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¥½å¤„ï¼šè§£è€¦ï¼Œå¯ä»¥éšæ—¶æ·»åŠ æ–°çš„ç›‘å¬å™¨ï¼Œä¸å½±å“åŸæœ‰é€»è¾‘
```

### 1.3 Spring Bootä¸­çš„åº”ç”¨åœºæ™¯


**å…¸å‹ä½¿ç”¨åœºæ™¯**ï¼š
- ğŸš€ **åº”ç”¨å¯åŠ¨**ï¼šå¯åŠ¨å®Œæˆååˆå§‹åŒ–ç¼“å­˜ã€é¢„çƒ­æ•°æ®
- ğŸ“Š **ç›‘æ§ç»Ÿè®¡**ï¼šè®°å½•åº”ç”¨å¯åŠ¨æ—¶é—´ã€ç›‘å¬å…³é”®äº‹ä»¶
- ğŸ”„ **ä¸šåŠ¡è§£è€¦**ï¼šè®¢å•åˆ›å»ºåå‘é€çŸ­ä¿¡ã€æ›´æ–°åº“å­˜
- ğŸ› ï¸ **ç³»ç»Ÿé›†æˆ**ï¼šåº”ç”¨å°±ç»ªåæ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒ

---

## 2. ğŸ“‹ ApplicationEventäº‹ä»¶ä½“ç³»


### 2.1 äº‹ä»¶ç»§æ‰¿ä½“ç³»


**äº‹ä»¶ç±»çš„å®¶æ—å…³ç³»**ï¼š

```
                    ApplicationEvent (çˆ·çˆ·)
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
SpringApplicationEvent ApplicationContextEvent  è‡ªå®šä¹‰äº‹ä»¶
    (Spring Bootäº‹ä»¶)      (Springæ¡†æ¶äº‹ä»¶)    (ä½ å†™çš„äº‹ä»¶)
        â”‚                 â”‚
        â”‚                 â””â”€ ContextRefreshedEvent
        â”‚                    ContextClosedEvent
        â”‚
        â”œâ”€ ApplicationStartingEvent
        â”œâ”€ ApplicationStartedEvent  
        â””â”€ ApplicationReadyEvent
```

### 2.2 ApplicationEventåŸºç¡€ç±»


**ä»€ä¹ˆæ˜¯ApplicationEvent**ï¼š
æ‰€æœ‰äº‹ä»¶çš„"è€ç¥–å®—"ï¼Œå°±åƒæ‰€æœ‰äººéƒ½è¦æœ‰ä¸ªå§“æ°ä¸€æ ·ï¼Œæ‰€æœ‰äº‹ä»¶éƒ½è¦ç»§æ‰¿å®ƒã€‚

```java
// Springæä¾›çš„åŸºç¡€äº‹ä»¶ç±»
public abstract class ApplicationEvent extends EventObject {
    private final long timestamp;  // äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´æˆ³
    
    public ApplicationEvent(Object source) {
        super(source);  // sourceå°±æ˜¯"è°å‘å¸ƒäº†è¿™ä¸ªäº‹ä»¶"
        this.timestamp = System.currentTimeMillis();
    }
}
```

**å…³é”®å­—æ®µç†è§£**ï¼š
- **source**ï¼šäº‹ä»¶çš„å‘å¸ƒè€…ï¼Œæ¯”å¦‚SpringApplicationå¯¹è±¡
- **timestamp**ï¼šäº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œç”¨äºè°ƒè¯•å’Œç»Ÿè®¡

### 2.3 Spring Bootå†…ç½®äº‹ä»¶ç±»å‹


| äº‹ä»¶ç±»å‹ | **å‘ç”Ÿæ—¶æœº** | **ç”¨é€”** |
|---------|------------|---------|
| ğŸ **ApplicationStartingEvent** | `åº”ç”¨åˆšå¼€å§‹å¯åŠ¨` | `æœ€æ—©çš„å¯åŠ¨äº‹ä»¶ï¼Œæ­¤æ—¶Springå®¹å™¨è¿˜æ²¡åˆ›å»º` |
| ğŸŒ± **ApplicationEnvironmentPreparedEvent** | `ç¯å¢ƒå‡†å¤‡å®Œæˆ` | `é…ç½®æ–‡ä»¶å·²åŠ è½½ï¼Œå¯ä»¥è·å–é…ç½®ä¿¡æ¯` |
| ğŸ—ï¸ **ApplicationContextInitializedEvent** | `å®¹å™¨åˆå§‹åŒ–å®Œæˆ` | `Springå®¹å™¨åˆ›å»ºå®Œæˆï¼Œä½†Beanè¿˜æ²¡åŠ è½½` |
| ğŸ“¦ **ApplicationPreparedEvent** | `å®¹å™¨å‡†å¤‡å°±ç»ª` | `Beanå®šä¹‰å·²åŠ è½½ï¼Œä½†è¿˜æ²¡å®ä¾‹åŒ–` |
| âœ… **ApplicationStartedEvent** | `åº”ç”¨å¯åŠ¨å®Œæˆ` | `æ‰€æœ‰Beanå·²åˆ›å»ºï¼Œä½†CommandLineRunnerè¿˜æ²¡æ‰§è¡Œ` |
| ğŸ¯ **ApplicationReadyEvent** | `åº”ç”¨å®Œå…¨å°±ç»ª` | `ä¸€åˆ‡å‡†å¤‡å®Œæ¯•ï¼Œå¯ä»¥æ¥æ”¶è¯·æ±‚äº†` |
| âŒ **ApplicationFailedEvent** | `åº”ç”¨å¯åŠ¨å¤±è´¥` | `å¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸` |

### 2.4 è‡ªå®šä¹‰äº‹ä»¶ç±»


**åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶**ï¼š

```java
// ç”¨æˆ·æ³¨å†Œäº‹ä»¶
public class UserRegisteredEvent extends ApplicationEvent {
    private final String username;
    private final String email;
    
    public UserRegisteredEvent(Object source, String username, String email) {
        super(source);  // è°ƒç”¨çˆ¶ç±»æ„é€ å™¨
        this.username = username;
        this.email = email;
    }
    
    // getteræ–¹æ³•
    public String getUsername() { return username; }
    public String getEmail() { return email; }
}
```

**ä¸ºä»€ä¹ˆè¦ç»§æ‰¿ApplicationEvent**ï¼š
- Springçš„äº‹ä»¶å‘å¸ƒæœºåˆ¶åªè®¤è¯†ApplicationEventçš„å­ç±»
- è‡ªåŠ¨è·å¾—æ—¶é—´æˆ³ã€äº‹ä»¶æºç­‰åŸºç¡€åŠŸèƒ½
- éµå¾ªSpringçš„è®¾è®¡è§„èŒƒ

---

## 3. ğŸ‘‚ ApplicationListenerç›‘å¬å™¨


### 3.1 ä»€ä¹ˆæ˜¯ç›‘å¬å™¨


**é€šä¿—ç†è§£**ï¼šç›‘å¬å™¨å°±åƒæ˜¯"å®ˆåœ¨ç”µè¯æ—è¾¹ç­‰æ¶ˆæ¯çš„äºº"

```
ç”Ÿæ´»åœºæ™¯ï¼š
ä½ åœ¨ç­‰å¿«é€’ï¼Œå¿«é€’å‘˜åˆ°äº†ä¼šæ‰“ç”µè¯é€šçŸ¥ä½ 
ä½ çš„ç”µè¯å°±æ˜¯"ç›‘å¬å™¨"ï¼Œå¿«é€’åˆ°è¾¾å°±æ˜¯"äº‹ä»¶"

Spring Bootä¸­ï¼š
åº”ç”¨å¯åŠ¨å®Œæˆæ˜¯"äº‹ä»¶"ï¼Œä½ çš„åˆå§‹åŒ–ä»£ç æ˜¯"ç›‘å¬å™¨"
å½“åº”ç”¨å¯åŠ¨å®Œæˆæ—¶ï¼ŒSpringä¼šè‡ªåŠ¨è°ƒç”¨ä½ çš„åˆå§‹åŒ–ä»£ç 
```

### 3.2 å®ç°ApplicationListeneræ¥å£


**åŸºç¡€ç›‘å¬å™¨å®ç°**ï¼š

```java
@Component  // æ³¨å†Œä¸ºSpring Bean
public class AppStartupListener implements ApplicationListener<ApplicationReadyEvent> {
    
    private static final Logger logger = LoggerFactory.getLogger(AppStartupListener.class);
    
    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        logger.info("åº”ç”¨å¯åŠ¨å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ä¸šåŠ¡æ•°æ®...");
        
        // åœ¨è¿™é‡Œå†™ä½ çš„åˆå§‹åŒ–é€»è¾‘
        initializeCache();
        preloadData();
        
        logger.info("ä¸šåŠ¡æ•°æ®åˆå§‹åŒ–å®Œæˆï¼");
    }
    
    private void initializeCache() {
        // åˆå§‹åŒ–ç¼“å­˜çš„é€»è¾‘
        System.out.println("ç¼“å­˜ç³»ç»Ÿå·²å¯åŠ¨");
    }
    
    private void preloadData() {
        // é¢„åŠ è½½æ•°æ®çš„é€»è¾‘  
        System.out.println("æ•°æ®é¢„åŠ è½½å®Œæˆ");
    }
}
```

**å…³é”®ç‚¹ç†è§£**ï¼š
- **æ³›å‹`<ApplicationReadyEvent>`**ï¼šæŒ‡å®šç›‘å¬å“ªç§äº‹ä»¶ï¼Œå°±åƒè°ƒé¢‘æ”¶éŸ³æœºè°ƒåˆ°ç‰¹å®šé¢‘é“
- **@Component**ï¼šå‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªBeanï¼ŒSpringä¼šè‡ªåŠ¨ç®¡ç†å®ƒ
- **onApplicationEventæ–¹æ³•**ï¼šäº‹ä»¶å‘ç”Ÿæ—¶Springä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•

### 3.3 ä½¿ç”¨@EventListeneræ³¨è§£ï¼ˆæ¨èï¼‰


**æ›´ç®€æ´çš„å†™æ³•**ï¼š

```java
@Component
public class BusinessEventListener {
    
    private static final Logger logger = LoggerFactory.getLogger(BusinessEventListener.class);
    
    @EventListener  // ç›´æ¥åœ¨æ–¹æ³•ä¸ŠåŠ æ³¨è§£
    public void handleApplicationReady(ApplicationReadyEvent event) {
        logger.info("åº”ç”¨å°±ç»ªï¼Œå¯åŠ¨åå°ä»»åŠ¡...");
        startBackgroundTasks();
    }
    
    @EventListener
    public void handleApplicationStarted(ApplicationStartedEvent event) {
        logger.info("åº”ç”¨å·²å¯åŠ¨ï¼Œè¿›è¡Œå¥åº·æ£€æŸ¥...");
        performHealthCheck();
    }
    
    // å¯ä»¥ç›‘å¬å¤šä¸ªäº‹ä»¶
    @EventListener({ApplicationStartedEvent.class, ApplicationReadyEvent.class})
    public void handleMultipleEvents(ApplicationEvent event) {
        logger.info("æ”¶åˆ°äº‹ä»¶ï¼š{}", event.getClass().getSimpleName());
    }
    
    private void startBackgroundTasks() {
        System.out.println("åå°ä»»åŠ¡å·²å¯åŠ¨");
    }
    
    private void performHealthCheck() {
        System.out.println("å¥åº·æ£€æŸ¥å®Œæˆ");
    }
}
```

**@EventListenerçš„ä¼˜åŠ¿**ï¼š
- âœ… **ä»£ç æ›´ç®€æ´**ï¼šä¸éœ€è¦å®ç°æ¥å£
- âœ… **æ–¹æ³•åè‡ªå®šä¹‰**ï¼šä¸å¿…å«onApplicationEvent
- âœ… **ä¸€ä¸ªç±»ç›‘å¬å¤šç§äº‹ä»¶**ï¼šæ¯ä¸ªæ–¹æ³•ç›‘å¬ä¸åŒäº‹ä»¶
- âœ… **æ”¯æŒæ¡ä»¶ç›‘å¬**ï¼šå¯ä»¥æ·»åŠ æ¡ä»¶åˆ¤æ–­

### 3.4 å¼‚æ­¥äº‹ä»¶ç›‘å¬


**ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥**ï¼š
æœ‰äº›åˆå§‹åŒ–ä»»åŠ¡å¾ˆè€—æ—¶ï¼Œä¸åº”è¯¥é˜»å¡åº”ç”¨å¯åŠ¨

```java
@Component
public class AsyncEventListener {
    
    @EventListener
    @Async  // å¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
    public void handleApplicationReadyAsync(ApplicationReadyEvent event) {
        try {
            // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            Thread.sleep(5000);
            System.out.println("è€—æ—¶çš„åˆå§‹åŒ–ä»»åŠ¡å®Œæˆ");
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}

// éœ€è¦é…ç½®å¼‚æ­¥æ”¯æŒ
@Configuration
@EnableAsync  // å¯ç”¨å¼‚æ­¥æ”¯æŒ
public class AsyncConfig {
    
    @Bean
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(2);
        executor.setMaxPoolSize(4);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("async-event-");
        executor.initialize();
        return executor;
    }
}
```

---

## 4. ğŸš€ SpringApplicationRunListenerå¯åŠ¨ç›‘å¬


### 4.1 ä»€ä¹ˆæ˜¯SpringApplicationRunListener


**ä¸æ™®é€šç›‘å¬å™¨çš„åŒºåˆ«**ï¼š

```
æ™®é€šApplicationListenerï¼š
- ç›‘å¬å…·ä½“çš„äº‹ä»¶ç±»å‹
- åœ¨Springå®¹å™¨åˆ›å»ºåæ‰èƒ½å·¥ä½œ
- é€‚åˆä¸šåŠ¡é€»è¾‘å¤„ç†

SpringApplicationRunListenerï¼š
- ç›‘å¬æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹çš„å„ä¸ªé˜¶æ®µ
- åœ¨Springå®¹å™¨åˆ›å»ºä¹‹å‰å°±å¼€å§‹å·¥ä½œ
- é€‚åˆæ¡†æ¶çº§åˆ«çš„æ‰©å±•
```

**å¯åŠ¨è¿‡ç¨‹å…¨æ™¯**ï¼š

```
Spring Bootå¯åŠ¨æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å¯åŠ¨      â”‚ â† SpringApplicationRunListener.starting()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¯å¢ƒå‡†å¤‡      â”‚ â† SpringApplicationRunListener.environmentPrepared()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¹å™¨åˆ›å»º      â”‚ â† SpringApplicationRunListener.contextPrepared()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BeanåŠ è½½      â”‚ â† SpringApplicationRunListener.contextLoaded()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¯åŠ¨å®Œæˆ      â”‚ â† SpringApplicationRunListener.started()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¿è¡Œå°±ç»ª      â”‚ â† SpringApplicationRunListener.running()
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è‡ªå®šä¹‰å¯åŠ¨ç›‘å¬å™¨


**å®ç°SpringApplicationRunListener**ï¼š

```java
public class CustomSpringApplicationRunListener implements SpringApplicationRunListener {
    
    private final SpringApplication application;
    private final String[] args;
    private final Logger logger = LoggerFactory.getLogger(CustomSpringApplicationRunListener.class);
    
    // æ„é€ å™¨å¿…é¡»æœ‰è¿™ä¸¤ä¸ªå‚æ•°
    public CustomSpringApplicationRunListener(SpringApplication application, String[] args) {
        this.application = application;
        this.args = args;
    }
    
    @Override
    public void starting(ConfigurableBootstrapContext bootstrapContext) {
        logger.info("åº”ç”¨å¼€å§‹å¯åŠ¨...");
        // å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›é¢„å¤„ç†å·¥ä½œ
    }
    
    @Override
    public void environmentPrepared(ConfigurableBootstrapContext bootstrapContext, 
                                  ConfigurableEnvironment environment) {
        logger.info("ç¯å¢ƒå‡†å¤‡å®Œæˆï¼Œé…ç½®ä¿¡æ¯å·²åŠ è½½");
        // å¯ä»¥åœ¨è¿™é‡Œè¯»å–é…ç½®ï¼Œåšç¯å¢ƒç›¸å…³çš„åˆå§‹åŒ–
    }
    
    @Override
    public void contextPrepared(ConfigurableApplicationContext context) {
        logger.info("Springå®¹å™¨å·²åˆ›å»º");
        // å®¹å™¨åˆ›å»ºå®Œæˆï¼Œä½†Beanè¿˜æ²¡åŠ è½½
    }
    
    @Override
    public void contextLoaded(ConfigurableApplicationContext context) {
        logger.info("Beanå®šä¹‰å·²åŠ è½½åˆ°å®¹å™¨ä¸­");
        // Beanå®šä¹‰å·²åŠ è½½ï¼Œä½†è¿˜æ²¡å®ä¾‹åŒ–
    }
    
    @Override
    public void started(ConfigurableApplicationContext context, Duration timeTaken) {
        logger.info("åº”ç”¨å¯åŠ¨å®Œæˆï¼Œè€—æ—¶ï¼š{} æ¯«ç§’", timeTaken.toMillis());
        // åº”ç”¨å·²å¯åŠ¨ï¼Œå¯ä»¥å¤„ç†è¯·æ±‚
    }
    
    @Override
    public void running(ConfigurableApplicationContext context) {
        logger.info("åº”ç”¨è¿è¡Œå°±ç»ªï¼Œæ‰€æœ‰ç»„ä»¶éƒ½å·²åˆå§‹åŒ–å®Œæˆ");
        // ä¸€åˆ‡å°±ç»ªï¼Œåº”ç”¨æ­£å¸¸è¿è¡Œä¸­
    }
    
    @Override
    public void failed(ConfigurableApplicationContext context, Throwable exception) {
        logger.error("åº”ç”¨å¯åŠ¨å¤±è´¥", exception);
        // å¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸
    }
}
```

### 4.3 æ³¨å†Œè‡ªå®šä¹‰å¯åŠ¨ç›‘å¬å™¨


**é€šè¿‡spring.factoriesæ³¨å†Œ**ï¼š

åœ¨`src/main/resources/META-INF/spring.factories`æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```properties
# è‡ªå®šä¹‰å¯åŠ¨ç›‘å¬å™¨
org.springframework.boot.SpringApplicationRunListener=\
com.example.listener.CustomSpringApplicationRunListener
```

**é€šè¿‡ä»£ç æ³¨å†Œ**ï¼š

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(Application.class);
        
        // æ·»åŠ å¯åŠ¨ç›‘å¬å™¨
        app.addListeners(new ApplicationListener<ApplicationReadyEvent>() {
            @Override
            public void onApplicationEvent(ApplicationReadyEvent event) {
                System.out.println("åº”ç”¨å·²å°±ç»ªï¼");
            }
        });
        
        app.run(args);
    }
}
```

---

## 5. â° ç”Ÿå‘½å‘¨æœŸå…³é”®äº‹ä»¶


### 5.1 å¯åŠ¨é˜¶æ®µäº‹ä»¶è¯¦è§£


**ApplicationStartingEvent - å¯åŠ¨å¼€å§‹**ï¼š

```java
@Component
public class StartingEventListener {
    
    @EventListener
    public void handleStarting(ApplicationStartingEvent event) {
        // æ­¤æ—¶Springå®¹å™¨è¿˜æ²¡åˆ›å»ºï¼Œä¸èƒ½æ³¨å…¥å…¶ä»–Bean
        System.out.println("åº”ç”¨å¼€å§‹å¯åŠ¨ï¼Œæ—¶é—´ï¼š" + new Date());
        
        // å¯ä»¥åšçš„äº‹ï¼š
        // - è®¾ç½®ç³»ç»Ÿå±æ€§
        // - åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ  
        // - å±•ç¤ºå¯åŠ¨æ¨ªå¹…
        
        System.setProperty("app.start.time", String.valueOf(System.currentTimeMillis()));
    }
}
```

**ApplicationEnvironmentPreparedEvent - ç¯å¢ƒå‡†å¤‡å®Œæˆ**ï¼š

```java
@Component  
public class EnvironmentPreparedListener {
    
    @EventListener
    public void handleEnvironmentPrepared(ApplicationEnvironmentPreparedEvent event) {
        ConfigurableEnvironment environment = event.getEnvironment();
        
        // æ­¤æ—¶å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶
        String appName = environment.getProperty("spring.application.name");
        String profiles = String.join(",", environment.getActiveProfiles());
        
        System.out.println("åº”ç”¨åç§°ï¼š" + appName);
        System.out.println("æ¿€æ´»ç¯å¢ƒï¼š" + profiles);
        
        // å¯ä»¥åšçš„äº‹ï¼š
        // - åŠ¨æ€æ·»åŠ é…ç½®æº
        // - éªŒè¯å¿…éœ€çš„é…ç½®é¡¹
        // - æ ¹æ®ç¯å¢ƒåšä¸åŒçš„åˆå§‹åŒ–
    }
}
```

### 5.2 è¿è¡Œé˜¶æ®µäº‹ä»¶è¯¦è§£


**ApplicationStartedEvent - å¯åŠ¨å®Œæˆ**ï¼š

```java
@Component
public class StartedEventListener {
    
    @Autowired
    private DataSource dataSource;  // æ­¤æ—¶å¯ä»¥æ³¨å…¥Beanäº†
    
    @EventListener
    public void handleStarted(ApplicationStartedEvent event) {
        System.out.println("åº”ç”¨å¯åŠ¨å®Œæˆï¼Œä½†CommandLineRunnerè¿˜æ²¡æ‰§è¡Œ");
        
        // å¯ä»¥åšçš„äº‹ï¼š
        // - æ£€æŸ¥æ•°æ®åº“è¿æ¥
        // - åˆå§‹åŒ–ç¼“å­˜
        // - å¯åŠ¨å®šæ—¶ä»»åŠ¡
        
        try {
            Connection connection = dataSource.getConnection();
            System.out.println("æ•°æ®åº“è¿æ¥æ­£å¸¸");
            connection.close();
        } catch (Exception e) {
            System.err.println("æ•°æ®åº“è¿æ¥å¼‚å¸¸ï¼š" + e.getMessage());
        }
    }
}
```

**ApplicationReadyEvent - å®Œå…¨å°±ç»ª**ï¼š

```java
@Component
public class ReadyEventListener {
    
    @EventListener
    public void handleReady(ApplicationReadyEvent event) {
        System.out.println("åº”ç”¨å®Œå…¨å°±ç»ªï¼Œå¯ä»¥æ¥æ”¶å¤–éƒ¨è¯·æ±‚äº†");
        
        // å¯ä»¥åšçš„äº‹ï¼š
        // - é¢„çƒ­ä¸šåŠ¡æ•°æ®
        // - æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒ
        // - å‘é€åº”ç”¨å¯åŠ¨é€šçŸ¥
        // - å¼€å§‹ç›‘æ§å’Œå¥åº·æ£€æŸ¥
        
        preloadBusinessData();
        registerToServiceRegistry();
    }
    
    private void preloadBusinessData() {
        System.out.println("é¢„åŠ è½½ä¸šåŠ¡æ•°æ®...");
    }
    
    private void registerToServiceRegistry() {
        System.out.println("æ³¨å†Œåˆ°æœåŠ¡ä¸­å¿ƒ...");
    }
}
```

### 5.3 å¼‚å¸¸é˜¶æ®µäº‹ä»¶


**ApplicationFailedEvent - å¯åŠ¨å¤±è´¥**ï¼š

```java
@Component
public class FailedEventListener {
    
    @EventListener
    public void handleFailed(ApplicationFailedEvent event) {
        Throwable exception = event.getException();
        
        System.err.println("åº”ç”¨å¯åŠ¨å¤±è´¥ï¼š" + exception.getMessage());
        
        // å¯ä»¥åšçš„äº‹ï¼š
        // - è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—
        // - å‘é€å‘Šè­¦é€šçŸ¥
        // - æ¸…ç†å·²åˆ†é…çš„èµ„æº
        // - ç”Ÿæˆé”™è¯¯æŠ¥å‘Š
        
        logDetailedError(exception);
        sendAlertNotification(exception);
    }
    
    private void logDetailedError(Throwable exception) {
        // è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯
        System.err.println("è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š");
        exception.printStackTrace();
    }
    
    private void sendAlertNotification(Throwable exception) {
        // å‘é€å‘Šè­¦ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ç­‰ï¼‰
        System.out.println("å·²å‘é€å¯åŠ¨å¤±è´¥å‘Šè­¦");
    }
}
```

### 5.4 äº‹ä»¶æ‰§è¡Œé¡ºåº


**å®Œæ•´çš„äº‹ä»¶æ—¶é—´çº¿**ï¼š

```
åº”ç”¨å¯åŠ¨æ—¶é—´çº¿ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ ApplicationStartingEvent
   â”œâ”€ æœ€æ—©è§¦å‘ï¼ŒSpringå®¹å™¨è¿˜æ²¡åˆ›å»º
   â”œâ”€ è®¾ç½®ç³»ç»Ÿå±æ€§ã€åˆå§‹åŒ–æ—¥å¿—
   â””â”€ æ— æ³•æ³¨å…¥å…¶ä»–Bean

ğŸŒ± ApplicationEnvironmentPreparedEvent  
   â”œâ”€ é…ç½®æ–‡ä»¶å·²åŠ è½½ï¼Œç¯å¢ƒå˜é‡å¯ç”¨
   â”œâ”€ å¯ä»¥è¯»å–application.properties
   â””â”€ è¿˜ä¸èƒ½æ³¨å…¥Bean

ğŸ—ï¸ ApplicationContextInitializedEvent
   â”œâ”€ Springå®¹å™¨å·²åˆ›å»º
   â”œâ”€ ä½†Beanå®šä¹‰è¿˜æ²¡åŠ è½½
   â””â”€ ä»ç„¶ä¸èƒ½æ³¨å…¥Bean

ğŸ“¦ ApplicationPreparedEvent
   â”œâ”€ Beanå®šä¹‰å·²åŠ è½½åˆ°å®¹å™¨
   â”œâ”€ ä½†Beanå®ä¾‹è¿˜æ²¡åˆ›å»º
   â””â”€ ä¾ç„¶ä¸èƒ½æ³¨å…¥Bean

âœ… ApplicationStartedEvent
   â”œâ”€ æ‰€æœ‰Beanå·²åˆ›å»ºå®Œæˆ
   â”œâ”€ å¯ä»¥æ­£å¸¸æ³¨å…¥å’Œä½¿ç”¨Bean
   â””â”€ CommandLineRunnerè¿˜æ²¡æ‰§è¡Œ

ğŸ¯ ApplicationReadyEvent
   â”œâ”€ ä¸€åˆ‡å‡†å¤‡å°±ç»ª
   â”œâ”€ CommandLineRunnerå·²æ‰§è¡Œå®Œ
   â””â”€ åº”ç”¨å¯ä»¥æ¥æ”¶å¤–éƒ¨è¯·æ±‚

âŒ ApplicationFailedEventï¼ˆå¼‚å¸¸æƒ…å†µï¼‰
   â””â”€ å¯åŠ¨è¿‡ç¨‹ä¸­ä»»ä½•ç¯èŠ‚å‡ºé”™éƒ½ä¼šè§¦å‘
```

---

## 6. ğŸ¨ è‡ªå®šä¹‰äº‹ä»¶å‘å¸ƒä¸å¤„ç†


### 6.1 åˆ›å»ºä¸šåŠ¡äº‹ä»¶


**ç”¨æˆ·æ³¨å†Œåœºæ™¯ç¤ºä¾‹**ï¼š

```java
// ç”¨æˆ·æ³¨å†Œäº‹ä»¶
public class UserRegisteredEvent extends ApplicationEvent {
    private final Long userId;
    private final String username;
    private final String email;
    private final LocalDateTime registerTime;
    
    public UserRegisteredEvent(Object source, Long userId, String username, String email) {
        super(source);
        this.userId = userId;
        this.username = username;
        this.email = email;
        this.registerTime = LocalDateTime.now();
    }
    
    // getteræ–¹æ³•
    public Long getUserId() { return userId; }
    public String getUsername() { return username; }
    public String getEmail() { return email; }
    public LocalDateTime getRegisterTime() { return registerTime; }
    
    @Override
    public String toString() {
        return String.format("UserRegisteredEvent{userId=%d, username='%s', email='%s', time=%s}", 
                userId, username, email, registerTime);
    }
}
```

### 6.2 å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶


**åœ¨ä¸šåŠ¡ä»£ç ä¸­å‘å¸ƒäº‹ä»¶**ï¼š

```java
@Service
public class UserService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;  // Springæä¾›çš„äº‹ä»¶å‘å¸ƒå™¨
    
    public void registerUser(String username, String email) {
        // 1. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
        Long userId = saveUserToDatabase(username, email);
        System.out.println("ç”¨æˆ·ä¿å­˜å®Œæˆï¼Œç”¨æˆ·IDï¼š" + userId);
        
        // 2. å‘å¸ƒäº‹ä»¶
        UserRegisteredEvent event = new UserRegisteredEvent(this, userId, username, email);
        eventPublisher.publishEvent(event);
        System.out.println("ç”¨æˆ·æ³¨å†Œäº‹ä»¶å·²å‘å¸ƒ");
        
        // ä¸šåŠ¡æ–¹æ³•åˆ°æ­¤ç»“æŸï¼Œå…·ä½“çš„åç»­å¤„ç†ç”±äº‹ä»¶ç›‘å¬å™¨å®Œæˆ
    }
    
    private Long saveUserToDatabase(String username, String email) {
        // æ¨¡æ‹Ÿä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“
        Long userId = System.currentTimeMillis();  // ç®€å•çš„IDç”Ÿæˆ
        System.out.println("ç”¨æˆ·ä¿¡æ¯å·²ä¿å­˜ï¼š" + username + " (" + email + ")");
        return userId;
    }
}
```

### 6.3 å¤„ç†è‡ªå®šä¹‰äº‹ä»¶


**å¤šä¸ªç›‘å¬å™¨å¤„ç†åŒä¸€äº‹ä»¶**ï¼š

```java
// é‚®ä»¶æœåŠ¡ç›‘å¬å™¨
@Component
public class EmailNotificationListener {
    
    @EventListener
    @Order(1)  // æ‰§è¡Œé¡ºåºï¼Œæ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œ
    public void handleUserRegistered(UserRegisteredEvent event) {
        System.out.println("ğŸ“§ å‘é€æ¬¢è¿é‚®ä»¶ç»™ï¼š" + event.getEmail());
        
        // æ¨¡æ‹Ÿå‘é€é‚®ä»¶
        try {
            Thread.sleep(100);  // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            System.out.println("âœ… æ¬¢è¿é‚®ä»¶å‘é€æˆåŠŸ");
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}

// ç§¯åˆ†æœåŠ¡ç›‘å¬å™¨
@Component  
public class PointsServiceListener {
    
    @EventListener
    @Order(2)
    public void handleUserRegistered(UserRegisteredEvent event) {
        System.out.println("ğŸ ä¸ºæ–°ç”¨æˆ·åˆ†é…æ³¨å†Œç§¯åˆ†ï¼š" + event.getUsername());
        
        // æ¨¡æ‹Ÿç§¯åˆ†å¤„ç†
        int points = 100;  // æ–°ç”¨æˆ·æ³¨å†Œé€100ç§¯åˆ†
        System.out.println("âœ… ç§¯åˆ†åˆ†é…å®Œæˆï¼Œè·å¾— " + points + " ç§¯åˆ†");
    }
}

// ç»Ÿè®¡æœåŠ¡ç›‘å¬å™¨
@Component
public class StatisticsListener {
    
    @EventListener
    @Order(3)
    @Async  // å¼‚æ­¥å¤„ç†ï¼Œä¸å½±å“ä¸»æµç¨‹
    public void handleUserRegistered(UserRegisteredEvent event) {
        System.out.println("ğŸ“Š æ›´æ–°ç”¨æˆ·æ³¨å†Œç»Ÿè®¡æ•°æ®");
        
        // æ¨¡æ‹Ÿç»Ÿè®¡å¤„ç†
        try {
            Thread.sleep(200);  // æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œ
            System.out.println("âœ… ç»Ÿè®¡æ•°æ®æ›´æ–°å®Œæˆ");
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
```

### 6.4 æ¡ä»¶äº‹ä»¶ç›‘å¬


**åªåœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¤„ç†äº‹ä»¶**ï¼š

```java
@Component
public class ConditionalEventListener {
    
    // åªæœ‰VIPç”¨æˆ·æ³¨å†Œæ‰å‘é€çŸ­ä¿¡
    @EventListener(condition = "#event.username.startsWith('VIP_')")
    public void handleVipUserRegistered(UserRegisteredEvent event) {
        System.out.println("ğŸ“± å‘VIPç”¨æˆ·å‘é€çŸ­ä¿¡ï¼š" + event.getUsername());
        sendSms(event.getUsername(), event.getEmail());
    }
    
    // åªæœ‰é‚®ç®±æ˜¯gmailçš„ç”¨æˆ·æ‰æ¨é€åˆ°ç‰¹æ®Šæ¸ é“
    @EventListener(condition = "#event.email.contains('gmail')")
    public void handleGmailUserRegistered(UserRegisteredEvent event) {
        System.out.println("ğŸš€ Gmailç”¨æˆ·æ¨é€åˆ°ç‰¹æ®Šè¥é”€æ¸ é“");
        pushToMarketingChannel(event);
    }
    
    private void sendSms(String username, String email) {
        System.out.println("âœ… VIPçŸ­ä¿¡å‘é€å®Œæˆ");
    }
    
    private void pushToMarketingChannel(UserRegisteredEvent event) {
        System.out.println("âœ… ç‰¹æ®Šæ¸ é“æ¨é€å®Œæˆ");
    }
}
```

### 6.5 å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹


**æ§åˆ¶å™¨ä¸­è§¦å‘äº‹ä»¶**ï¼š

```java
@RestController
@RequestMapping("/api/user")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @PostMapping("/register")
    public String registerUser(@RequestParam String username, @RequestParam String email) {
        try {
            userService.registerUser(username, email);
            return "ç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼åç»­å¤„ç†æ­£åœ¨è¿›è¡Œä¸­...";
        } catch (Exception e) {
            return "ç”¨æˆ·æ³¨å†Œå¤±è´¥ï¼š" + e.getMessage();
        }
    }
}
```

**æµ‹è¯•å®Œæ•´æµç¨‹**ï¼š

```java
@SpringBootTest
public class EventTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    public void testUserRegistration() {
        // æ³¨å†Œæ™®é€šç”¨æˆ·
        userService.registerUser("å¼ ä¸‰", "zhangsan@example.com");
        
        // æ³¨å†ŒVIPç”¨æˆ·
        userService.registerUser("VIP_æå››", "lisi@gmail.com");
        
        // ç­‰å¾…å¼‚æ­¥å¤„ç†å®Œæˆ
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
```

---

## 7. ğŸŒŠ äº‹ä»¶ä¼ æ’­æœºåˆ¶


### 7.1 äº‹ä»¶ä¼ æ’­æµç¨‹


**Springäº‹ä»¶ä¼ æ’­çš„å®Œæ•´è¿‡ç¨‹**ï¼š

```
äº‹ä»¶å‘å¸ƒæµç¨‹ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ä¸šåŠ¡ä»£ç å‘å¸ƒäº‹ä»¶
   eventPublisher.publishEvent(event)
            â”‚
            â–¼
2. Springäº‹ä»¶å‘å¸ƒå™¨æ¥æ”¶
   ApplicationEventPublisher
            â”‚
            â–¼  
3. ä¼ é€’ç»™äº‹ä»¶å¤šæ’­å™¨
   ApplicationEventMulticaster
            â”‚
            â–¼
4. æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„ç›‘å¬å™¨
   æ‰¾åˆ°æ‰€æœ‰èƒ½å¤„ç†è¯¥äº‹ä»¶ç±»å‹çš„ç›‘å¬å™¨
            â”‚
            â–¼
5. æŒ‰é¡ºåºè°ƒç”¨ç›‘å¬å™¨
   åŒæ­¥è°ƒç”¨ï¼šé€ä¸ªæ‰§è¡Œ
   å¼‚æ­¥è°ƒç”¨ï¼šå¹¶å‘æ‰§è¡Œ
            â”‚
            â–¼
6. å¤„ç†å®Œæˆ
   æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œæ¯•
```

### 7.2 åŒæ­¥vså¼‚æ­¥ä¼ æ’­


**åŒæ­¥äº‹ä»¶ä¼ æ’­ï¼ˆé»˜è®¤ï¼‰**ï¼š

```java
@Component
public class SyncEventExample {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void publishSyncEvent() {
        System.out.println("ğŸ“¤ å¼€å§‹å‘å¸ƒäº‹ä»¶ï¼š" + Thread.currentThread().getName());
        
        UserRegisteredEvent event = new UserRegisteredEvent(this, 1L, "åŒæ­¥ç”¨æˆ·", "sync@example.com");
        eventPublisher.publishEvent(event);  // è¿™é‡Œä¼šç­‰å¾…æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œ
        
        System.out.println("ğŸ“¥ äº‹ä»¶å‘å¸ƒå®Œæˆï¼š" + Thread.currentThread().getName());
    }
    
    @EventListener
    public void handleSync1(UserRegisteredEvent event) {
        System.out.println("ğŸ”„ ç›‘å¬å™¨1æ‰§è¡Œä¸­ï¼š" + Thread.currentThread().getName());
        sleep(1000);  // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
        System.out.println("âœ… ç›‘å¬å™¨1å®Œæˆ");
    }
    
    @EventListener  
    public void handleSync2(UserRegisteredEvent event) {
        System.out.println("ğŸ”„ ç›‘å¬å™¨2æ‰§è¡Œä¸­ï¼š" + Thread.currentThread().getName());
        sleep(500);
        System.out.println("âœ… ç›‘å¬å™¨2å®Œæˆ");
    }
    
    private void sleep(long millis) {
        try { Thread.sleep(millis); } catch (InterruptedException e) {}
    }
}

/*
è¾“å‡ºç»“æœï¼š
ğŸ“¤ å¼€å§‹å‘å¸ƒäº‹ä»¶ï¼šmain
ğŸ”„ ç›‘å¬å™¨1æ‰§è¡Œä¸­ï¼šmain
âœ… ç›‘å¬å™¨1å®Œæˆ
ğŸ”„ ç›‘å¬å™¨2æ‰§è¡Œä¸­ï¼šmain  
âœ… ç›‘å¬å™¨2å®Œæˆ
ğŸ“¥ äº‹ä»¶å‘å¸ƒå®Œæˆï¼šmain

æ€»è€—æ—¶ï¼šçº¦1.5ç§’ï¼ˆ1000ms + 500msï¼‰
*/
```

**å¼‚æ­¥äº‹ä»¶ä¼ æ’­**ï¼š

```java
@Component
public class AsyncEventExample {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void publishAsyncEvent() {
        System.out.println("ğŸ“¤ å¼€å§‹å‘å¸ƒå¼‚æ­¥äº‹ä»¶ï¼š" + Thread.currentThread().getName());
        
        UserRegisteredEvent event = new UserRegisteredEvent(this, 2L, "å¼‚æ­¥ç”¨æˆ·", "async@example.com");
        eventPublisher.publishEvent(event);  // ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…ç›‘å¬å™¨
        
        System.out.println("ğŸ“¥ å¼‚æ­¥äº‹ä»¶å‘å¸ƒå®Œæˆï¼š" + Thread.currentThread().getName());
    }
    
    @EventListener
    @Async  // å¼‚æ­¥æ‰§è¡Œ
    public void handleAsync1(UserRegisteredEvent event) {
        System.out.println("ğŸš€ å¼‚æ­¥ç›‘å¬å™¨1æ‰§è¡Œï¼š" + Thread.currentThread().getName());
        sleep(1000);
        System.out.println("âœ… å¼‚æ­¥ç›‘å¬å™¨1å®Œæˆ");
    }
    
    @EventListener
    @Async  // å¼‚æ­¥æ‰§è¡Œ
    public void handleAsync2(UserRegisteredEvent event) {
        System.out.println("ğŸš€ å¼‚æ­¥ç›‘å¬å™¨2æ‰§è¡Œï¼š" + Thread.currentThread().getName());
        sleep(500);
        System.out.println("âœ… å¼‚æ­¥ç›‘å¬å™¨2å®Œæˆ");
    }
}

/*
è¾“å‡ºç»“æœï¼š
ğŸ“¤ å¼€å§‹å‘å¸ƒå¼‚æ­¥äº‹ä»¶ï¼šmain
ğŸ“¥ å¼‚æ­¥äº‹ä»¶å‘å¸ƒå®Œæˆï¼šmain
ğŸš€ å¼‚æ­¥ç›‘å¬å™¨1æ‰§è¡Œï¼šasync-event-1
ğŸš€ å¼‚æ­¥ç›‘å¬å™¨2æ‰§è¡Œï¼šasync-event-2
âœ… å¼‚æ­¥ç›‘å¬å™¨2å®Œæˆ
âœ… å¼‚æ­¥ç›‘å¬å™¨1å®Œæˆ

æ€»è€—æ—¶ï¼šå‡ ä¹ä¸º0ï¼ˆä¸»çº¿ç¨‹ç«‹å³è¿”å›ï¼‰
ç›‘å¬å™¨åœ¨åå°çº¿ç¨‹å¹¶å‘æ‰§è¡Œ
*/
```

### 7.3 äº‹ä»¶ä¼ æ’­çš„ç‰¹æ€§


**äº‹ä»¶ä¼ æ’­çš„é‡è¦ç‰¹æ€§**ï¼š

```java
@Component
public class EventPropagationDemo {
    
    // ç‰¹æ€§1ï¼šçˆ¶å­äº‹ä»¶ç±»å‹åŒ¹é…
    @EventListener
    public void handleApplicationEvent(ApplicationEvent event) {
        // å¯ä»¥ç›‘å¬æ‰€æœ‰ApplicationEventçš„å­ç±»
        System.out.println("æ”¶åˆ°ä»»æ„ç±»å‹äº‹ä»¶ï¼š" + event.getClass().getSimpleName());
    }
    
    @EventListener  
    public void handleSpecificEvent(UserRegisteredEvent event) {
        // åªç›‘å¬UserRegisteredEventç±»å‹
        System.out.println("æ”¶åˆ°ç”¨æˆ·æ³¨å†Œäº‹ä»¶ï¼š" + event.getUsername());
    }
    
    // ç‰¹æ€§2ï¼šç›‘å¬å™¨å¼‚å¸¸ä¸å½±å“å…¶ä»–ç›‘å¬å™¨
    @EventListener
    @Order(1)
    public void faultyListener(UserRegisteredEvent event) {
        System.out.println("æœ‰é—®é¢˜çš„ç›‘å¬å™¨å¼€å§‹æ‰§è¡Œ");
        throw new RuntimeException("ç›‘å¬å™¨æ‰§è¡Œå‡ºé”™ï¼");
    }
    
    @EventListener
    @Order(2)  
    public void normalListener(UserRegisteredEvent event) {
        System.out.println("æ­£å¸¸ç›‘å¬å™¨æ‰§è¡Œï¼šå³ä½¿å‰é¢çš„ç›‘å¬å™¨å‡ºé”™ï¼Œæˆ‘ä¾ç„¶ä¼šæ‰§è¡Œ");
    }
    
    // ç‰¹æ€§3ï¼šå¯ä»¥åœ¨ç›‘å¬å™¨ä¸­å‘å¸ƒæ–°äº‹ä»¶
    @EventListener
    public void publishNewEvent(UserRegisteredEvent event) {
        System.out.println("åœ¨ç›‘å¬å™¨ä¸­å‘å¸ƒæ–°äº‹ä»¶");
        
        // å¯ä»¥å‘å¸ƒå…¶ä»–äº‹ä»¶ï¼Œå½¢æˆäº‹ä»¶é“¾
        WelcomeEmailEvent welcomeEvent = new WelcomeEmailEvent(this, event.getEmail());
        eventPublisher.publishEvent(welcomeEvent);
    }
}
```

### 7.4 è‡ªå®šä¹‰äº‹ä»¶å¤šæ’­å™¨


**é«˜çº§ç”¨æ³•ï¼šè‡ªå®šä¹‰äº‹ä»¶ä¼ æ’­è¡Œä¸º**ï¼š

```java
@Configuration
public class EventConfig {
    
    // è‡ªå®šä¹‰äº‹ä»¶å¤šæ’­å™¨
    @Bean
    public ApplicationEventMulticaster applicationEventMulticaster() {
        SimpleApplicationEventMulticaster multicaster = new SimpleApplicationEventMulticaster();
        
        // è®¾ç½®å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå™¨
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("event-");
        executor.initialize();
        
        multicaster.setTaskExecutor(executor);  // è®¾ç½®å¼‚æ­¥æ‰§è¡Œå™¨
        
        // è®¾ç½®é”™è¯¯å¤„ç†å™¨
        multicaster.setErrorHandler(throwable -> {
            System.err.println("äº‹ä»¶å¤„ç†å‡ºé”™ï¼š" + throwable.getMessage());
            // å¯ä»¥è®°å½•æ—¥å¿—ã€å‘é€å‘Šè­¦ç­‰
        });
        
        return multicaster;
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹ä»¶æ¨¡å‹ï¼šå‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼ï¼Œå®ç°ç»„ä»¶é—´è§£è€¦
ğŸ”¸ ApplicationEventï¼šæ‰€æœ‰äº‹ä»¶çš„åŸºç¡€ç±»ï¼Œæä¾›äº‹ä»¶æºå’Œæ—¶é—´æˆ³
ğŸ”¸ ApplicationListenerï¼šäº‹ä»¶ç›‘å¬å™¨æ¥å£ï¼Œå¤„ç†ç‰¹å®šç±»å‹çš„äº‹ä»¶
ğŸ”¸ @EventListenerï¼šæ³¨è§£æ–¹å¼ç›‘å¬äº‹ä»¶ï¼Œæ›´çµæ´»ç®€æ´
ğŸ”¸ ApplicationEventPublisherï¼šäº‹ä»¶å‘å¸ƒå™¨ï¼Œç”¨äºå‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶
ğŸ”¸ SpringApplicationRunListenerï¼šå¯åŠ¨é˜¶æ®µç›‘å¬å™¨ï¼Œç›‘å¬æ•´ä¸ªå¯åŠ¨æµç¨‹
ğŸ”¸ äº‹ä»¶ä¼ æ’­ï¼šåŒæ­¥/å¼‚æ­¥æ‰§è¡Œï¼Œæ”¯æŒæ¡ä»¶ç›‘å¬å’Œå¼‚å¸¸å¤„ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ äº‹ä»¶æ¨¡å‹çš„æœ¬è´¨ä»·å€¼**
```
è§£è€¦ä½œç”¨ï¼š
- ä¸šåŠ¡é€»è¾‘ä¸åç»­å¤„ç†åˆ†ç¦»
- å‘å¸ƒè€…ä¸éœ€è¦çŸ¥é“æœ‰å“ªäº›ç›‘å¬è€…
- å¯ä»¥éšæ—¶æ·»åŠ æ–°çš„å¤„ç†é€»è¾‘è€Œä¸ä¿®æ”¹åŸæœ‰ä»£ç 

æ‰©å±•æ€§ï¼š
- ä¸€ä¸ªäº‹ä»¶å¯ä»¥æœ‰å¤šä¸ªç›‘å¬å™¨
- ç›‘å¬å™¨å¯ä»¥æœ‰æ‰§è¡Œé¡ºåº
- æ”¯æŒæ¡ä»¶ç›‘å¬å’Œå¼‚æ­¥å¤„ç†
```

**ğŸ”¹ åŒæ­¥vså¼‚æ­¥çš„é€‰æ‹©åŸåˆ™**
```
ä½¿ç”¨åŒæ­¥äº‹ä»¶ï¼š
- éœ€è¦ç¡®ä¿å¤„ç†å®Œæˆåå†ç»§ç»­
- å¤„ç†é€»è¾‘ç®€å•å¿«é€Ÿ
- éœ€è¦åœ¨äº‹åŠ¡ä¸­å¤„ç†

ä½¿ç”¨å¼‚æ­¥äº‹ä»¶ï¼š
- å¤„ç†è€—æ—¶è¾ƒé•¿ï¼ˆå‘é‚®ä»¶ã€è°ƒç”¨å¤–éƒ¨APIï¼‰
- ä¸å½±å“ä¸»æµç¨‹æ€§èƒ½
- å…è®¸æœ€ç»ˆä¸€è‡´æ€§
```

**ğŸ”¹ Spring Bootå¯åŠ¨äº‹ä»¶çš„å®é™…ä»·å€¼**
```
åº”ç”¨çº§åˆ«ç›‘æ§ï¼š
- è®°å½•å¯åŠ¨æ—¶é—´å’Œå¯åŠ¨çŠ¶æ€
- è¿›è¡Œå¥åº·æ£€æŸ¥å’Œé¢„çƒ­
- æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒ

ä¸šåŠ¡åˆå§‹åŒ–ï¼š
- ç¼“å­˜é¢„çƒ­
- æ•°æ®é¢„åŠ è½½
- åå°ä»»åŠ¡å¯åŠ¨
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¸¸è§ä¸šåŠ¡åœºæ™¯åº”ç”¨**ï¼š
- **ç”¨æˆ·æ³¨å†Œ**ï¼šå‘é‚®ä»¶ã€é€ç§¯åˆ†ã€æ›´æ–°ç»Ÿè®¡
- **è®¢å•åˆ›å»º**ï¼šåº“å­˜æ‰£å‡ã€å‘é€é€šçŸ¥ã€ç”Ÿæˆç‰©æµå•
- **æ”¯ä»˜æˆåŠŸ**ï¼šè®¢å•çŠ¶æ€æ›´æ–°ã€å‘ç¥¨ç”Ÿæˆã€ä¼šå‘˜å‡çº§
- **ç³»ç»Ÿç›‘æ§**ï¼šæ€§èƒ½æŒ‡æ ‡æ”¶é›†ã€å¼‚å¸¸å‘Šè­¦ã€æ—¥å¿—è®°å½•

**ğŸ”§ æœ€ä½³å®è·µ**ï¼š
```
äº‹ä»¶è®¾è®¡åŸåˆ™ï¼š
- äº‹ä»¶åç§°è¦æœ‰æ„ä¹‰ï¼Œä½“ç°ä¸šåŠ¡å«ä¹‰
- åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œé¿å…ç›‘å¬å™¨å†æ¬¡æŸ¥è¯¢
- ä¿æŒäº‹ä»¶çš„ä¸å¯å˜æ€§

ç›‘å¬å™¨è®¾è®¡ï¼š
- æ¯ä¸ªç›‘å¬å™¨èŒè´£å•ä¸€
- å¼‚å¸¸å¤„ç†è¦å®Œå–„
- é¿å…åœ¨ç›‘å¬å™¨ä¸­æ‰§è¡Œå¤æ‚ä¸šåŠ¡é€»è¾‘
- åˆç†ä½¿ç”¨å¼‚æ­¥å¤„ç†
```

**ğŸš¨ å¸¸è§é™·é˜±**ï¼š
```
é¿å…äº‹ä»¶å¾ªç¯ï¼š
- Aäº‹ä»¶ç›‘å¬å™¨å‘å¸ƒBäº‹ä»¶
- Bäº‹ä»¶ç›‘å¬å™¨å‘å¸ƒAäº‹ä»¶
- é€ æˆæ— é™å¾ªç¯

äº‹åŠ¡é—®é¢˜ï¼š
- å¼‚æ­¥ç›‘å¬å™¨ä¸åœ¨åŸäº‹åŠ¡ä¸­
- éœ€è¦è€ƒè™‘äº‹åŠ¡å›æ»šå¯¹äº‹ä»¶çš„å½±å“

æ€§èƒ½è€ƒè™‘ï¼š
- è¿‡å¤šçš„åŒæ­¥ç›‘å¬å™¨å½±å“æ€§èƒ½
- åˆç†è®¾ç½®å¼‚æ­¥çº¿ç¨‹æ± å¤§å°
```

### 8.4 è¿›é˜¶å­¦ä¹ å»ºè®®


```
æ·±å…¥ç†è§£ï¼š
- Springäº‹ä»¶æœºåˆ¶çš„æºç å®ç°
- ApplicationContextçš„äº‹ä»¶å‘å¸ƒæœºåˆ¶
- è‡ªå®šä¹‰äº‹ä»¶å¤šæ’­å™¨çš„å®ç°

æ‰©å±•åº”ç”¨ï¼š
- ä¸æ¶ˆæ¯é˜Ÿåˆ—ç»“åˆä½¿ç”¨
- åˆ†å¸ƒå¼äº‹ä»¶å¤„ç†
- äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰æ¨¡å¼
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Spring Bootäº‹ä»¶æœºåˆ¶æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°ï¼Œå®ç°ç»„ä»¶è§£è€¦
- å¯åŠ¨äº‹ä»¶å¸®åŠ©æˆ‘ä»¬åœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µæ‰§è¡Œç‰¹å®šé€»è¾‘  
- è‡ªå®šä¹‰äº‹ä»¶è®©ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§
- åŒæ­¥äº‹ä»¶ä¿è¯å¤„ç†é¡ºåºï¼Œå¼‚æ­¥äº‹ä»¶æé«˜ç³»ç»Ÿæ€§èƒ½