---
title: 9ã€ç»„ä»¶æ‰«æä¸è£…é…è¾¹ç•Œ
---
## ğŸ“š ç›®å½•

1. [ç»„ä»¶æ‰«æåŸºç¡€æ¦‚å¿µ](#1-ç»„ä»¶æ‰«æåŸºç¡€æ¦‚å¿µ)
2. [@ComponentScanæ‰«æè·¯å¾„è¯¦è§£](#2-ComponentScanæ‰«æè·¯å¾„è¯¦è§£)
3. [åŒ…æ‰«æè¾¹ç•Œæ§åˆ¶](#3-åŒ…æ‰«æè¾¹ç•Œæ§åˆ¶)
4. [å¾ªç¯ä¾èµ–æ£€æµ‹ä¸è§£å†³](#4-å¾ªç¯ä¾èµ–æ£€æµ‹ä¸è§£å†³)
5. [æ‡’åŠ è½½@Lazyæœºåˆ¶](#5-æ‡’åŠ è½½Lazyæœºåˆ¶)
6. [æ¡ä»¶è£…é…è¾¹ç•Œ](#6-æ¡ä»¶è£…é…è¾¹ç•Œ)
7. [ç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆç­–ç•¥](#7-ç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç»„ä»¶æ‰«æåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç»„ä»¶æ‰«æ


**ç®€å•ç†è§£**ï¼šç»„ä»¶æ‰«æå°±åƒæ˜¯Spring Bootåœ¨ä½ çš„é¡¹ç›®é‡Œ"æ‰¾æœ‹å‹"çš„è¿‡ç¨‹ã€‚

```
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
ä½ å¼€äº†ä¸€å®¶å…¬å¸ï¼Œéœ€è¦æ‹›è˜å‘˜å·¥
- ä½ ä¼šåˆ°å„ä¸ªåœ°æ–¹å»æ‰¾åˆé€‚çš„äººæ‰
- æ‰¾åˆ°åï¼Œç»™ä»–ä»¬å®‰æ’åˆé€‚çš„å²—ä½
- è®©ä»–ä»¬äº’ç›¸é…åˆå·¥ä½œ

Spring Bootçš„ç»„ä»¶æ‰«æå°±æ˜¯è¿™æ ·ï¼š
- æ‰«æï¼šåœ¨æŒ‡å®šçš„åŒ…é‡Œå¯»æ‰¾å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„ç±»
- è£…é…ï¼šå°†è¿™äº›ç±»å®ä¾‹åŒ–å¹¶ç®¡ç†èµ·æ¥
- æ³¨å…¥ï¼šè®©è¿™äº›ç»„ä»¶èƒ½å¤Ÿäº’ç›¸é…åˆå·¥ä½œ
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **è‡ªåŠ¨å‘ç°**ï¼šè‡ªåŠ¨æ‰¾åˆ°é¡¹ç›®ä¸­çš„ç»„ä»¶ç±»
- ğŸ”¸ **è‡ªåŠ¨è£…é…**ï¼šè‡ªåŠ¨åˆ›å»ºè¿™äº›ç»„ä»¶çš„å®ä¾‹
- ğŸ”¸ **ä¾èµ–æ³¨å…¥**ï¼šè‡ªåŠ¨å¤„ç†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»

### 1.2 ç»„ä»¶æ‰«æçš„å·¥ä½œåŸç†


```
é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š
com.example.myapp
â”œâ”€â”€ MyApplication.java          â† å¯åŠ¨ç±»
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ UserController.java    â† @Controller
â”œâ”€â”€ service/
â”‚   â””â”€â”€ UserService.java       â† @Service  
â””â”€â”€ repository/
    â””â”€â”€ UserRepository.java    â† @Repository

æ‰«æè¿‡ç¨‹ï¼š
1. Spring Bootå¯åŠ¨æ—¶ï¼Œä»å¯åŠ¨ç±»å¼€å§‹
2. æ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…
3. æ‰¾åˆ°æ‰€æœ‰å¸¦@Componentã€@Serviceã€@Controllerç­‰æ³¨è§£çš„ç±»
4. åˆ›å»ºè¿™äº›ç±»çš„å®ä¾‹ï¼Œæ”¾å…¥Springå®¹å™¨ä¸­ç®¡ç†
```

**æ‰«ææ—¶æœº**ï¼š
- **å¯åŠ¨æ—¶æ‰«æ**ï¼šåº”ç”¨å¯åŠ¨æ—¶è¿›è¡Œä¸€æ¬¡æ€§æ‰«æ
- **æŒ‰éœ€æ‰«æ**ï¼šæ ¹æ®é…ç½®å†³å®šæ‰«æå“ªäº›åŒ…
- **é€’å½’æ‰«æ**ï¼šä¼šæ‰«ææŒ‡å®šåŒ…çš„æ‰€æœ‰å­åŒ…

---

## 2. ğŸ“ @ComponentScanæ‰«æè·¯å¾„è¯¦è§£


### 2.1 é»˜è®¤æ‰«æè§„åˆ™


**Spring Bootçš„æ™ºèƒ½é»˜è®¤**ï¼š
```java
@SpringBootApplication  // è¿™ä¸ªæ³¨è§£åŒ…å«äº†@ComponentScan
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}
```

**é»˜è®¤æ‰«æèŒƒå›´**ï¼š
```
å¦‚æœMyApplicationåœ¨ com.example.myapp åŒ…ä¸‹ï¼š
âœ… ä¼šæ‰«æï¼šcom.example.myapp.*  (å½“å‰åŒ…åŠæ‰€æœ‰å­åŒ…)
âŒ ä¸ä¼šæ‰«æï¼šcom.example.other.* (å¹³çº§æˆ–ä¸Šçº§åŒ…)

æ‰«æç»“æœç¤ºä¾‹ï¼š
com.example.myapp          â† æ‰«æ âœ…
â”œâ”€â”€ controller/            â† æ‰«æ âœ… 
â”œâ”€â”€ service/              â† æ‰«æ âœ…
â””â”€â”€ config/               â† æ‰«æ âœ…
com.example.other         â† ä¸æ‰«æ âŒ
```

### 2.2 è‡ªå®šä¹‰æ‰«æè·¯å¾„


**æŒ‡å®šç‰¹å®šåŒ…**ï¼š
```java
@SpringBootApplication
@ComponentScan(basePackages = {"com.example.web", "com.example.service"})
public class MyApplication {
    // ç°åœ¨åªä¼šæ‰«æè¿™ä¸¤ä¸ªæŒ‡å®šçš„åŒ…
}
```

**ä½¿ç”¨ç±»ä½œä¸ºåŸºå‡†**ï¼š
```java
@ComponentScan(basePackageClasses = {UserController.class, OrderService.class})
public class MyApplication {
    // ä¼šæ‰«æUserControllerå’ŒOrderServiceæ‰€åœ¨çš„åŒ…
}
```

**æ’é™¤ç‰¹å®šç»„ä»¶**ï¼š
```java
@ComponentScan(
    basePackages = "com.example",
    excludeFilters = @ComponentScan.Filter(
        type = FilterType.ASSIGNABLE_TYPE, 
        classes = {TestComponent.class}
    )
)
public class MyApplication {
    // æ‰«æcom.exampleåŒ…ï¼Œä½†æ’é™¤TestComponentç±»
}
```

### 2.3 æ‰«æè·¯å¾„é…ç½®å¯¹æ¯”


| é…ç½®æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|-------------|----------|----------|
| **é»˜è®¤æ‰«æ** | `å°å‹é¡¹ç›®ï¼Œæ ‡å‡†ç»“æ„` | `é›¶é…ç½®ï¼Œç®€å•æ˜“ç”¨` | `æ‰«æèŒƒå›´å›ºå®š` |
| **æŒ‡å®šåŒ…å** | `å¤šæ¨¡å—é¡¹ç›®` | `ç²¾ç¡®æ§åˆ¶æ‰«æèŒƒå›´` | `ç¡¬ç¼–ç ï¼Œä¸å¤Ÿçµæ´»` |
| **æŒ‡å®šç±»** | `æ¨¡å—åŒ–è®¾è®¡` | `ç±»å‹å®‰å…¨ï¼Œé‡æ„å‹å¥½` | `éœ€è¦é¢å¤–çš„æ ‡è®°ç±»` |
| **æ’é™¤è¿‡æ»¤** | `æµ‹è¯•ç¯å¢ƒåˆ†ç¦»` | `çµæ´»æ’é™¤ä¸éœ€è¦çš„ç»„ä»¶` | `é…ç½®å¤æ‚` |

---

## 3. ğŸ¯ åŒ…æ‰«æè¾¹ç•Œæ§åˆ¶


### 3.1 ä»€ä¹ˆæ˜¯æ‰«æè¾¹ç•Œ


**æ‰«æè¾¹ç•Œ**å°±åƒæ˜¯ç»™Spring Bootç”»äº†ä¸€ä¸ª"æ´»åŠ¨èŒƒå›´"ï¼Œå‘Šè¯‰å®ƒåœ¨å“ªé‡Œå¯ä»¥æ‰¾ç»„ä»¶ï¼Œå“ªé‡Œä¸èƒ½æ‰¾ã€‚

```
æ²¡æœ‰è¾¹ç•Œæ§åˆ¶çš„é—®é¢˜ï¼š
é¡¹ç›®ç»“æ„ï¼š
com.company.project
â”œâ”€â”€ main/                â† ä¸»ä¸šåŠ¡ä»£ç 
â”œâ”€â”€ test/               â† æµ‹è¯•ä»£ç   
â”œâ”€â”€ demo/               â† æ¼”ç¤ºä»£ç 
â””â”€â”€ legacy/             â† é—ç•™ä»£ç 

å¦‚æœä¸æ§åˆ¶è¾¹ç•Œï¼š
- æµ‹è¯•ä»£ç å¯èƒ½è¢«åŠ è½½åˆ°ç”Ÿäº§ç¯å¢ƒ
- æ¼”ç¤ºä»£ç å¯èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡
- é—ç•™ä»£ç å¯èƒ½äº§ç”Ÿå†²çª
```

### 3.2 è¾¹ç•Œæ§åˆ¶ç­–ç•¥


**åŸºäºåŒ…ç»“æ„çš„è¾¹ç•Œ**ï¼š
```java
// æ¨èçš„é¡¹ç›®ç»“æ„
com.example.myapp
â”œâ”€â”€ core/              â† æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ repository/
â”œâ”€â”€ web/               â† Webå±‚
â”‚   â””â”€â”€ controller/
â”œâ”€â”€ config/            â† é…ç½®ç±»
â””â”€â”€ external/          â† å¤–éƒ¨é›†æˆ

// å¯¹åº”çš„æ‰«æé…ç½®
@ComponentScan(basePackages = {
    "com.example.myapp.core",
    "com.example.myapp.web", 
    "com.example.myapp.config"
})
// æ³¨æ„ï¼šæ²¡æœ‰åŒ…å«externalåŒ…ï¼Œå®ç°äº†è¾¹ç•Œæ§åˆ¶
```

**ä½¿ç”¨Profileè¿›è¡Œç¯å¢ƒè¾¹ç•Œ**ï¼š
```java
@Component
@Profile("!test")  // éæµ‹è¯•ç¯å¢ƒæ‰åŠ è½½
public class ProductionService {
    // ç”Ÿäº§ç¯å¢ƒä¸“ç”¨çš„æœåŠ¡
}

@Component  
@Profile("test")   // ä»…æµ‹è¯•ç¯å¢ƒåŠ è½½
public class MockService {
    // æµ‹è¯•ç¯å¢ƒçš„æ¨¡æ‹ŸæœåŠ¡
}
```

### 3.3 è¾¹ç•Œæ§åˆ¶æœ€ä½³å®è·µ


**æ¸…æ™°çš„åŒ…ç»“æ„è®¾è®¡**ï¼š
```
æ¨èç»“æ„ï¼š
com.example.myapp
â”œâ”€â”€ api/           â† APIæ¥å£å®šä¹‰
â”œâ”€â”€ business/      â† ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ data/          â† æ•°æ®è®¿é—®å±‚  
â”œâ”€â”€ infrastructure/ â† åŸºç¡€è®¾æ–½å±‚
â””â”€â”€ Application.java

æ‰«æé…ç½®ï¼š
@ComponentScan(basePackages = {
    "com.example.myapp.api",
    "com.example.myapp.business", 
    "com.example.myapp.data"
})
// infrastructureå±‚åŒ…å«é…ç½®ç±»ï¼Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†
```

**é¿å…å¸¸è§è¾¹ç•Œé—®é¢˜**ï¼š
```java
// âŒ é”™è¯¯åšæ³•ï¼šæ‰«æè¿‡äºå®½æ³›
@ComponentScan("com.example")  // å¯èƒ½æ‰«æåˆ°ä¸ç›¸å…³çš„åŒ…

// âŒ é”™è¯¯åšæ³•ï¼šå¯åŠ¨ç±»ä½ç½®ä¸å½“  
// å¦‚æœæŠŠå¯åŠ¨ç±»æ”¾åœ¨æ ¹åŒ…ï¼Œä¼šæ‰«ææ•´ä¸ªé¡¹ç›®

// âœ… æ­£ç¡®åšæ³•ï¼šç²¾ç¡®æ§åˆ¶è¾¹ç•Œ
@ComponentScan(basePackages = {
    "com.example.myapp.core",
    "com.example.myapp.web"
})
```

---

## 4. ğŸ”„ å¾ªç¯ä¾èµ–æ£€æµ‹ä¸è§£å†³


### 4.1 ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–


**å¾ªç¯ä¾èµ–**å°±åƒæ˜¯ä¸¤ä¸ªäººäº’ç›¸ä¾èµ–å¯¹æ–¹ï¼Œç»“æœè°ä¹Ÿæ²¡æ³•å…ˆå¼€å§‹å·¥ä½œã€‚

```
ç°å®ç”Ÿæ´»ä¸­çš„å¾ªç¯ä¾èµ–ï¼š
A: "æˆ‘éœ€è¦Bå…ˆå®Œæˆå·¥ä½œï¼Œæˆ‘æ‰èƒ½å¼€å§‹"
B: "æˆ‘éœ€è¦Aå…ˆå®Œæˆå·¥ä½œï¼Œæˆ‘æ‰èƒ½å¼€å§‹"  
ç»“æœï¼šä¸¤ä¸ªäººéƒ½ç­‰ç€å¯¹æ–¹ï¼Œè°ä¹Ÿå¹²ä¸äº†æ´»

ä»£ç ä¸­çš„å¾ªç¯ä¾èµ–ï¼š
class ServiceA {
    @Autowired
    private ServiceB serviceB;  // Aéœ€è¦B
}

class ServiceB {
    @Autowired  
    private ServiceA serviceA;  // Béœ€è¦A
}
ç»“æœï¼šSpringæ— æ³•å†³å®šå…ˆåˆ›å»ºè°
```

### 4.2 å¾ªç¯ä¾èµ–çš„ç±»å‹


**æ„é€ å™¨å¾ªç¯ä¾èµ–**ï¼ˆæ— æ³•è§£å†³ï¼‰ï¼š
```java
// âŒ è¿™ç§æƒ…å†µSpringæ— æ³•å¤„ç†
@Service
public class OrderService {
    private final UserService userService;
    
    public OrderService(UserService userService) {  // æ„é€ å™¨æ³¨å…¥
        this.userService = userService;
    }
}

@Service
public class UserService {
    private final OrderService orderService;
    
    public UserService(OrderService orderService) {  // æ„é€ å™¨æ³¨å…¥
        this.orderService = orderService;
    }
}
```

**å­—æ®µå¾ªç¯ä¾èµ–**ï¼ˆå¯ä»¥è§£å†³ï¼‰ï¼š
```java
// âœ… è¿™ç§æƒ…å†µSpringå¯ä»¥å¤„ç†
@Service
public class OrderService {
    @Autowired
    private UserService userService;  // å­—æ®µæ³¨å…¥
}

@Service  
public class UserService {
    @Autowired
    private OrderService orderService;  // å­—æ®µæ³¨å…¥
}
```

### 4.3 å¾ªç¯ä¾èµ–è§£å†³æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨@Lazyå»¶è¿ŸåŠ è½½**ï¼š
```java
@Service
public class OrderService {
    private final UserService userService;
    
    public OrderService(@Lazy UserService userService) {
        this.userService = userService;
    }
}

@Service
public class UserService {  
    private final OrderService orderService;
    
    public UserService(OrderService orderService) {
        this.orderService = orderService;
    }
}
```

**æ–¹æ¡ˆäºŒï¼šé‡æ„è®¾è®¡ï¼Œæ¶ˆé™¤å¾ªç¯ä¾èµ–**ï¼š
```java
// é‡æ„å‰ï¼šOrderServiceå’ŒUserServiceäº’ç›¸ä¾èµ–
// é‡æ„åï¼šæå–å…¬å…±æœåŠ¡

@Service
public class CommonService {
    // å…¬å…±çš„ä¸šåŠ¡é€»è¾‘
    public void doCommonWork() {
        // å…¬å…±å¤„ç†é€»è¾‘
    }
}

@Service
public class OrderService {
    @Autowired
    private CommonService commonService;  // ä¸å†ä¾èµ–UserService
}

@Service
public class UserService {
    @Autowired  
    private CommonService commonService;  // ä¸å†ä¾èµ–OrderService
}
```

### 4.4 å¾ªç¯ä¾èµ–æ£€æµ‹é…ç½®


**å¯ç”¨å¾ªç¯ä¾èµ–æ£€æµ‹**ï¼š
```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(Application.class);
        // ç¦ç”¨å¾ªç¯ä¾èµ–ï¼Œå¯åŠ¨æ—¶ä¼šæŠ¥é”™æé†’
        app.setAllowCircularReferences(false);
        app.run(args);
    }
}
```

---

## 5. ğŸ˜´ æ‡’åŠ è½½@Lazyæœºåˆ¶


### 5.1 æ‡’åŠ è½½çš„æ¦‚å¿µ


**æ‡’åŠ è½½**å°±åƒæ˜¯"ç”¨æ—¶å†ä¹°"çš„è´­ç‰©ç­–ç•¥ï¼Œä¸éœ€è¦çš„æ—¶å€™å°±ä¸åˆ›å»ºå¯¹è±¡ã€‚

```
æ­£å¸¸åŠ è½½ vs æ‡’åŠ è½½ï¼š

æ­£å¸¸åŠ è½½ï¼ˆé¥¿æ±‰å¼ï¼‰ï¼š
åº”ç”¨å¯åŠ¨ â†’ ç«‹å³åˆ›å»ºæ‰€æœ‰Bean â†’ å ç”¨å†…å­˜å¤šï¼Œå¯åŠ¨æ…¢

æ‡’åŠ è½½ï¼ˆæ‡’æ±‰å¼ï¼‰ï¼š  
åº”ç”¨å¯åŠ¨ â†’ åªåˆ›å»ºå¿…éœ€çš„Bean â†’ ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»º
```

**æ‡’åŠ è½½çš„å¥½å¤„**ï¼š
- ğŸ”¸ **å¯åŠ¨æ›´å¿«**ï¼šå‡å°‘å¯åŠ¨æ—¶éœ€è¦åˆ›å»ºçš„å¯¹è±¡
- ğŸ”¸ **å†…å­˜èŠ‚çœ**ï¼šä¸ç”¨çš„å¯¹è±¡ä¸å ç”¨å†…å­˜
- ğŸ”¸ **é¿å…å¾ªç¯ä¾èµ–**ï¼šå»¶è¿Ÿåˆ›å»ºå¯ä»¥æ‰“ç ´å¾ªç¯ä¾èµ–

### 5.2 @Lazyä½¿ç”¨æ–¹å¼


**åœ¨ç±»ä¸Šä½¿ç”¨@Lazy**ï¼š
```java
@Service
@Lazy  // æ•´ä¸ªæœåŠ¡æ‡’åŠ è½½
public class HeavyService {
    public HeavyService() {
        System.out.println("HeavyServiceåˆ›å»ºäº†ï¼Œè¿™æ˜¯ä¸ªè€—æ—¶æ“ä½œ");
        // æ¨¡æ‹Ÿå¤æ‚çš„åˆå§‹åŒ–è¿‡ç¨‹
    }
    
    public void doWork() {
        System.out.println("å¼€å§‹å·¥ä½œ");
    }
}
```

**åœ¨æ³¨å…¥ç‚¹ä½¿ç”¨@Lazy**ï¼š
```java
@Controller
public class UserController {
    
    @Autowired
    @Lazy  // åªæœ‰è¿™ä¸ªæ³¨å…¥ç‚¹æ‡’åŠ è½½
    private HeavyService heavyService;
    
    @GetMapping("/user")
    public String getUser() {
        // ç¬¬ä¸€æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼ŒheavyServiceæ‰ä¼šè¢«åˆ›å»º
        heavyService.doWork();
        return "user";
    }
}
```

**å…¨å±€æ‡’åŠ è½½é…ç½®**ï¼š
```java
@SpringBootApplication
public class Application {
    @Bean
    @Lazy(false)  // æ˜ç¡®æŒ‡å®šä¸æ‡’åŠ è½½
    public static LazyInitializationBeanFactoryPostProcessor lazyInitializationBeanFactoryPostProcessor() {
        return new LazyInitializationBeanFactoryPostProcessor();
    }
}
```

### 5.3 æ‡’åŠ è½½ä½¿ç”¨åœºæ™¯


**é€‚åˆæ‡’åŠ è½½çš„åœºæ™¯**ï¼š
```java
// åœºæ™¯1ï¼šé‡é‡çº§ç»„ä»¶
@Service
@Lazy
public class DatabaseMigrationService {
    // æ•°æ®åº“è¿ç§»æœåŠ¡ï¼Œåªåœ¨éœ€è¦æ—¶ä½¿ç”¨
}

// åœºæ™¯2ï¼šæ¡ä»¶æ€§ä½¿ç”¨çš„ç»„ä»¶  
@Service
@Lazy
public class EmailService {
    // é‚®ä»¶æœåŠ¡ï¼Œä¸æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦
}

// åœºæ™¯3ï¼šæ‰“ç ´å¾ªç¯ä¾èµ–
@Service  
public class OrderService {
    @Autowired
    @Lazy  // é€šè¿‡æ‡’åŠ è½½é¿å…å¾ªç¯ä¾èµ–
    private UserService userService;
}
```

**ä¸é€‚åˆæ‡’åŠ è½½çš„åœºæ™¯**ï¼š
- **å¯åŠ¨æ—¶å¿…éœ€çš„ç»„ä»¶**ï¼šå¦‚å®‰å…¨é…ç½®ã€æ•°æ®æºé…ç½®
- **é¢‘ç¹ä½¿ç”¨çš„ç»„ä»¶**ï¼šæ‡’åŠ è½½åè€Œä¼šå½±å“æ€§èƒ½  
- **éœ€è¦é¢„çƒ­çš„ç»„ä»¶**ï¼šå¦‚ç¼“å­˜æœåŠ¡

---

## 6. ğŸ›ï¸ æ¡ä»¶è£…é…è¾¹ç•Œ


### 6.1 ä»€ä¹ˆæ˜¯æ¡ä»¶è£…é…


**æ¡ä»¶è£…é…**å°±åƒæ˜¯"æŒ‰éœ€é…èœ"ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶æä¾›ä¸åŒçš„æœåŠ¡ã€‚

```
é¤å…çš„ä¾‹å­ï¼š
- å¦‚æœå®¢äººæ˜¯ç´ é£Ÿä¸»ä¹‰è€… â†’ æä¾›ç´ é£Ÿèœå•
- å¦‚æœå®¢äººæœ‰è¿‡æ• â†’ æä¾›ç‰¹æ®Šèœå•  
- å¦‚æœæ˜¯VIPå®¢æˆ· â†’ æä¾›é«˜ç«¯èœå•

Spring Bootçš„æ¡ä»¶è£…é…ï¼š
- å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ â†’ åŠ è½½è°ƒè¯•ç»„ä»¶
- å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒ â†’ åŠ è½½ç›‘æ§ç»„ä»¶
- å¦‚æœæœ‰Redis â†’ ä½¿ç”¨Redisç¼“å­˜ï¼Œå¦åˆ™ä½¿ç”¨å†…å­˜ç¼“å­˜
```

### 6.2 å¸¸ç”¨æ¡ä»¶æ³¨è§£


**åŸºäºé…ç½®å±æ€§çš„æ¡ä»¶**ï¼š
```java
@Service
@ConditionalOnProperty(name = "app.email.enabled", havingValue = "true")
public class EmailService {
    // åªæœ‰å½“é…ç½®æ–‡ä»¶ä¸­app.email.enabled=trueæ—¶æ‰ä¼šåˆ›å»º
}

// application.yml
app:
  email:
    enabled: true  # è®¾ç½®ä¸ºtrueæ—¶EmailServiceæ‰ä¼šè¢«åˆ›å»º
```

**åŸºäºç±»è·¯å¾„çš„æ¡ä»¶**ï¼š
```java
@Configuration
@ConditionalOnClass(RedisTemplate.class)  // ç±»è·¯å¾„ä¸­æœ‰RedisTemplateæ—¶
public class RedisConfig {
    
    @Bean
    public RedisTemplate<String, Object> redisTemplate() {
        // Redisç›¸å…³é…ç½®
        return new RedisTemplate<>();
    }
}
```

**åŸºäºBeanå­˜åœ¨æ€§çš„æ¡ä»¶**ï¼š
```java
@Service
@ConditionalOnMissingBean(CacheService.class)  // æ²¡æœ‰CacheServiceæ—¶æ‰åˆ›å»º
public class DefaultCacheService implements CacheService {
    // é»˜è®¤çš„ç¼“å­˜å®ç°
}

@Service  
@ConditionalOnBean(RedisTemplate.class)  // æœ‰RedisTemplateæ—¶æ‰åˆ›å»º
public class RedisCacheService implements CacheService {
    // Redisç¼“å­˜å®ç°
}
```

### 6.3 ç¯å¢ƒå’ŒProfileæ¡ä»¶


**åŸºäºProfileçš„æ¡ä»¶è£…é…**ï¼š
```java
@Configuration
@Profile("development")  // å¼€å‘ç¯å¢ƒ
public class DevConfig {
    
    @Bean
    public DataSource dataSource() {
        // å¼€å‘ç¯å¢ƒçš„æ•°æ®æºï¼ˆå¦‚H2å†…å­˜æ•°æ®åº“ï¼‰
        return new EmbeddedDatabaseBuilder().build();
    }
}

@Configuration
@Profile("production")  // ç”Ÿäº§ç¯å¢ƒ  
public class ProdConfig {
    
    @Bean
    public DataSource dataSource() {
        // ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æºï¼ˆå¦‚MySQLï¼‰
        return DataSourceBuilder.create().build();
    }
}
```

**è‡ªå®šä¹‰æ¡ä»¶è£…é…**ï¼š
```java
// è‡ªå®šä¹‰æ¡ä»¶ç±»
public class WindowsCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        return System.getProperty("os.name").toLowerCase().contains("windows");
    }
}

@Service
@Conditional(WindowsCondition.class)  // åªåœ¨Windowsç³»ç»Ÿä¸‹åŠ è½½
public class WindowsSpecificService {
    // Windowsç‰¹æœ‰çš„æœåŠ¡
}
```

### 6.4 æ¡ä»¶è£…é…æœ€ä½³å®è·µ


**åˆç†çš„æ¡ä»¶è¾¹ç•Œè®¾è®¡**ï¼š
```java
// âœ… æ¨èï¼šæ¸…æ™°çš„æ¡ä»¶å±‚æ¬¡
@Configuration
public class CacheConfiguration {
    
    @Bean
    @ConditionalOnProperty(name = "app.cache.type", havingValue = "redis")
    @ConditionalOnClass(RedisTemplate.class)
    public CacheService redisCacheService() {
        return new RedisCacheService();
    }
    
    @Bean
    @ConditionalOnProperty(name = "app.cache.type", havingValue = "memory", matchIfMissing = true)
    public CacheService memoryCacheService() {
        return new MemoryCacheService();
    }
}
```

---

## 7. ğŸ”Œ ç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆç­–ç•¥


### 7.1 ç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆæŒ‘æˆ˜


**é›†æˆç¬¬ä¸‰æ–¹ç»„ä»¶çš„å¸¸è§é—®é¢˜**ï¼š
```
é—®é¢˜1ï¼šåŒ…è·¯å¾„ä¸åœ¨æ‰«æèŒƒå›´å†…
- Spring Booté»˜è®¤åªæ‰«æå¯åŠ¨ç±»æ‰€åœ¨åŒ…
- ç¬¬ä¸‰æ–¹jaråŒ…çš„ç»„ä»¶ä¸ä¼šè¢«è‡ªåŠ¨å‘ç°

é—®é¢˜2ï¼šé…ç½®ä¸å…¼å®¹
- ç¬¬ä¸‰æ–¹ç»„ä»¶å¯èƒ½æœ‰è‡ªå·±çš„é…ç½®è¦æ±‚
- å¯èƒ½ä¸ç°æœ‰é…ç½®å†²çª

é—®é¢˜3ï¼šä¾èµ–ç‰ˆæœ¬å†²çª
- ä¸åŒç»„ä»¶å¯èƒ½ä¾èµ–åŒä¸€ä¸ªåº“çš„ä¸åŒç‰ˆæœ¬
```

### 7.2 ç¬¬ä¸‰æ–¹ç»„ä»¶æ‰«ææ–¹å¼


**æ–¹å¼ä¸€ï¼šæ‰©å±•æ‰«æè·¯å¾„**ï¼š
```java
@SpringBootApplication  
@ComponentScan(basePackages = {
    "com.example.myapp",     // è‡ªå·±çš„åŒ…
    "com.thirdparty.library" // ç¬¬ä¸‰æ–¹ç»„ä»¶åŒ…
})
public class Application {
}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨@Importå¯¼å…¥**ï¼š
```java
@SpringBootApplication
@Import({
    ThirdPartyConfig.class,      // å¯¼å…¥ç¬¬ä¸‰æ–¹é…ç½®ç±»
    AnotherThirdPartyService.class // å¯¼å…¥ç¬¬ä¸‰æ–¹æœåŠ¡ç±»
})
public class Application {
}
```

**æ–¹å¼ä¸‰ï¼šå¯ç”¨è‡ªåŠ¨é…ç½®**ï¼š
```java
// ç¬¬ä¸‰æ–¹åº“é€šå¸¸ä¼šæä¾›è‡ªåŠ¨é…ç½®ç±»
@SpringBootApplication
@EnableThirdPartyLibrary  // ç¬¬ä¸‰æ–¹æä¾›çš„å¯ç”¨æ³¨è§£
public class Application {
}
```

### 7.3 ç¬¬ä¸‰æ–¹ç»„ä»¶é…ç½®ç®¡ç†


**ç»Ÿä¸€é…ç½®ç®¡ç†**ï¼š
```java
@ConfigurationProperties(prefix = "third-party.service")
@Component
public class ThirdPartyProperties {
    private String apiKey;
    private String baseUrl;
    private int timeout = 30;
    
    // getterå’Œsetteræ–¹æ³•
}

// application.ymlä¸­çš„é…ç½®
third-party:
  service:
    api-key: your-api-key
    base-url: https://api.example.com
    timeout: 60
```

**æ¡ä»¶åŒ–é›†æˆ**ï¼š
```java
@Configuration
@ConditionalOnClass(ThirdPartyLibrary.class)  // åªæœ‰å½“ç±»å­˜åœ¨æ—¶æ‰é…ç½®
@EnableConfigurationProperties(ThirdPartyProperties.class)
public class ThirdPartyAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean  // å…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¦†ç›–
    public ThirdPartyService thirdPartyService(ThirdPartyProperties properties) {
        return new ThirdPartyService(properties.getApiKey(), properties.getBaseUrl());
    }
}
```

### 7.4 ç¬¬ä¸‰æ–¹ç»„ä»¶é›†æˆç¤ºä¾‹


**é›†æˆRedisç¤ºä¾‹**ï¼š
```java
@Configuration
@ConditionalOnClass(RedisTemplate.class)
@EnableConfigurationProperties(RedisProperties.class)
public class RedisIntegrationConfig {
    
    @Bean
    public LettuceConnectionFactory redisConnectionFactory(RedisProperties properties) {
        return new LettuceConnectionFactory(
            new RedisStandaloneConfiguration(properties.getHost(), properties.getPort())
        );
    }
    
    @Bean  
    public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {
        RedisTemplate<String, Object> template = new RedisTemplate<>();
        template.setConnectionFactory(connectionFactory);
        // å…¶ä»–é…ç½®...
        return template;
    }
}
```

**é›†æˆæ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹**ï¼š
```java
@Configuration
@ConditionalOnProperty(name = "app.mq.enabled", havingValue = "true")
public class MessageQueueConfig {
    
    @Bean
    @ConditionalOnMissingBean
    public MessageProducer messageProducer() {
        return new DefaultMessageProducer();
    }
    
    @Bean
    @ConditionalOnBean(MessageProducer.class)
    public MessageConsumer messageConsumer(MessageProducer producer) {
        return new DefaultMessageConsumer(producer);
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç»„ä»¶æ‰«æï¼šSpring Bootè‡ªåŠ¨å¯»æ‰¾å’Œè£…é…ç»„ä»¶çš„æœºåˆ¶
ğŸ”¸ æ‰«æè¾¹ç•Œï¼šæ§åˆ¶Spring Bootåœ¨å“ªé‡Œå¯»æ‰¾ç»„ä»¶ï¼Œé¿å…ä¸å¿…è¦çš„æ‰«æ
ğŸ”¸ å¾ªç¯ä¾èµ–ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªç»„ä»¶äº’ç›¸ä¾èµ–ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
ğŸ”¸ æ‡’åŠ è½½ï¼šéœ€è¦æ—¶æ‰åˆ›å»ºå¯¹è±¡ï¼Œæé«˜å¯åŠ¨é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨æ•ˆç‡
ğŸ”¸ æ¡ä»¶è£…é…ï¼šæ ¹æ®ä¸åŒæ¡ä»¶åˆ›å»ºä¸åŒçš„ç»„ä»¶
ğŸ”¸ ç¬¬ä¸‰æ–¹é›†æˆï¼šå°†å¤–éƒ¨ç»„ä»¶çº³å…¥Spring Bootç®¡ç†çš„ç­–ç•¥
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ‰«æè¾¹ç•Œçš„é‡è¦æ€§**
```
åˆç†çš„è¾¹ç•Œæ§åˆ¶ï¼š
âœ… æé«˜å¯åŠ¨é€Ÿåº¦ï¼šåªæ‰«æéœ€è¦çš„åŒ…
âœ… é¿å…å†²çªï¼šé˜²æ­¢æµ‹è¯•ä»£ç è¢«ç”Ÿäº§ç¯å¢ƒåŠ è½½
âœ… æ¸…æ™°ç»“æ„ï¼šè®©é¡¹ç›®ç»“æ„æ›´åŠ æ¸…æ™°

è¾¹ç•Œæ§åˆ¶ç­–ç•¥ï¼š
- åŸºäºåŒ…ç»“æ„çš„ç‰©ç†è¾¹ç•Œ
- åŸºäºProfileçš„ç¯å¢ƒè¾¹ç•Œ  
- åŸºäºæ¡ä»¶æ³¨è§£çš„é€»è¾‘è¾¹ç•Œ
```

**ğŸ”¹ å¾ªç¯ä¾èµ–çš„å¤„ç†æ€è·¯**
```
è¯†åˆ«å¾ªç¯ä¾èµ–ï¼š
- å¯åŠ¨æŠ¥é”™ï¼šBeanCurrentlyInCreationException
- è®¾è®¡é—®é¢˜ï¼šä¸¤ä¸ªç»„ä»¶äº’ç›¸éœ€è¦å¯¹æ–¹

è§£å†³ç­–ç•¥ä¼˜å…ˆçº§ï¼š
1. é‡æ„è®¾è®¡ï¼ˆæœ€ä½³ï¼‰ï¼šæ¶ˆé™¤ä¸åˆç†çš„ç›¸äº’ä¾èµ–
2. ä½¿ç”¨@Lazyï¼ˆæ¬¡é€‰ï¼‰ï¼šå»¶è¿ŸåŠ è½½æ‰“ç ´å¾ªç¯
3. æ”¹å˜æ³¨å…¥æ–¹å¼ï¼ˆæœ€åï¼‰ï¼šä»æ„é€ å™¨æ³¨å…¥æ”¹ä¸ºå­—æ®µæ³¨å…¥
```

**ğŸ”¹ æ‡’åŠ è½½çš„ä½¿ç”¨æ—¶æœº**
```
é€‚åˆæ‡’åŠ è½½ï¼š
- é‡é‡çº§ç»„ä»¶ï¼šæ•°æ®åº“è¿ç§»ã€æ–‡ä»¶å¤„ç†ç­‰
- å¯é€‰ç»„ä»¶ï¼šé‚®ä»¶æœåŠ¡ã€çŸ­ä¿¡æœåŠ¡ç­‰
- è§£å†³å¾ªç¯ä¾èµ–ï¼šä½œä¸ºä¸´æ—¶è§£å†³æ–¹æ¡ˆ

ä¸é€‚åˆæ‡’åŠ è½½ï¼š
- æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶ï¼šç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ç­‰
- å¯åŠ¨å¿…éœ€ç»„ä»¶ï¼šå®‰å…¨é…ç½®ã€æ•°æ®æºç­‰
- é¢‘ç¹ä½¿ç”¨ç»„ä»¶ï¼šç¼“å­˜æœåŠ¡ã€å·¥å…·ç±»ç­‰
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é¡¹ç›®ç»“æ„æ¨è**ï¼š
```
src/main/java/com/example/myapp/
â”œâ”€â”€ Application.java           â† å¯åŠ¨ç±»
â”œâ”€â”€ config/                   â† é…ç½®ç±»
â”‚   â”œâ”€â”€ DatabaseConfig.java
â”‚   â””â”€â”€ SecurityConfig.java
â”œâ”€â”€ controller/               â† æ§åˆ¶å™¨å±‚
â”œâ”€â”€ service/                  â† ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ repository/              â† æ•°æ®è®¿é—®å±‚
â””â”€â”€ external/                â† ç¬¬ä¸‰æ–¹é›†æˆ
    â”œâ”€â”€ redis/
    â””â”€â”€ mq/
```

**å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ**ï¼š

| é—®é¢˜ | **ç°è±¡** | **è§£å†³æ–¹æ¡ˆ** |
|------|----------|-------------|
| **ç»„ä»¶æœªè¢«æ‰«æåˆ°** | `NoSuchBeanDefinitionException` | `æ£€æŸ¥åŒ…è·¯å¾„ï¼Œæ‰©å±•@ComponentScanèŒƒå›´` |
| **å¾ªç¯ä¾èµ–** | `BeanCurrentlyInCreationException` | `ä½¿ç”¨@Lazyæˆ–é‡æ„è®¾è®¡` |
| **å¯åŠ¨æ…¢** | `åº”ç”¨å¯åŠ¨æ—¶é—´è¿‡é•¿` | `åˆç†ä½¿ç”¨@Lazyæ‡’åŠ è½½` |
| **é…ç½®å†²çª** | `Beané‡å¤å®šä¹‰å¼‚å¸¸` | `ä½¿ç”¨@ConditionalOnMissingBean` |
| **ç¯å¢ƒé—®é¢˜** | `ç”Ÿäº§ç¯å¢ƒåŠ è½½æµ‹è¯•ç»„ä»¶` | `ä½¿ç”¨@Profileè¿›è¡Œç¯å¢ƒéš”ç¦»` |

**æœ€ä½³å®è·µæ€»ç»“**ï¼š
- **æ¸…æ™°çš„åŒ…ç»“æ„**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç 
- **åˆç†çš„æ‰«æè¾¹ç•Œ**ï¼šåªæ‰«æå¿…è¦çš„åŒ…  
- **æ¡ä»¶è£…é…**ï¼šæ ¹æ®ç¯å¢ƒå’Œé…ç½®çµæ´»è£…é…ç»„ä»¶
- **æ‡’åŠ è½½ç­–ç•¥**ï¼šå¹³è¡¡å¯åŠ¨é€Ÿåº¦å’Œè¿è¡Œæ€§èƒ½
- **ç¬¬ä¸‰æ–¹é›†æˆ**ï¼šç»Ÿä¸€ç®¡ç†å¤–éƒ¨ç»„ä»¶é…ç½®

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç»„ä»¶æ‰«ææ˜¯Spring Bootçš„æ ¸å¿ƒæœºåˆ¶ï¼Œè´Ÿè´£è‡ªåŠ¨è£…é…
- åˆç†æ§åˆ¶æ‰«æè¾¹ç•Œå¯ä»¥æé«˜æ€§èƒ½å’Œé¿å…å†²çª
- å¾ªç¯ä¾èµ–é€šå¸¸æ˜¯è®¾è®¡é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘é‡æ„
- æ‡’åŠ è½½æ˜¯ä¼˜åŒ–å¯åŠ¨æ€§èƒ½çš„æœ‰æ•ˆæ‰‹æ®µ
- æ¡ä»¶è£…é…è®©åº”ç”¨èƒ½å¤Ÿé€‚åº”ä¸åŒçš„è¿è¡Œç¯å¢ƒ