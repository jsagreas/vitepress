---
title: 3ã€ResourceLoaderåŠ è½½å™¨
---
## ğŸ“š ç›®å½•

1. [ResourceLoaderæ˜¯ä»€ä¹ˆ](#1-resourceloaderæ˜¯ä»€ä¹ˆ)
2. [ResourceLoaderæ¥å£æ ¸å¿ƒæ–¹æ³•](#2-resourceloaderæ¥å£æ ¸å¿ƒæ–¹æ³•)
3. [è·¯å¾„è§£æè§„åˆ™è¯¦è§£](#3-è·¯å¾„è§£æè§„åˆ™è¯¦è§£)
4. [åè®®æ”¯æŒä¸ä½¿ç”¨](#4-åè®®æ”¯æŒä¸ä½¿ç”¨)
5. [é»˜è®¤åŠ è½½å™¨æœºåˆ¶](#5-é»˜è®¤åŠ è½½å™¨æœºåˆ¶)
6. [åŠ è½½ç­–ç•¥ä¸å®ç°](#6-åŠ è½½ç­–ç•¥ä¸å®ç°)
7. [ç¼“å­˜æœºåˆ¶ä¼˜åŒ–](#7-ç¼“å­˜æœºåˆ¶ä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ResourceLoaderæ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£ResourceLoader


**æ—¥å¸¸ç±»æ¯”**ï¼š
```
å°±åƒä½ çš„å¤–å–APPï¼š
- ä½ è¾“å…¥åœ°å€ï¼ˆèµ„æºè·¯å¾„ï¼‰
- APPå¸®ä½ æ‰¾åˆ°å•†å®¶ï¼ˆå®šä½èµ„æºï¼‰
- ç»™ä½ é€è´§ä¸Šé—¨ï¼ˆåŠ è½½èµ„æºï¼‰

ResourceLoaderå°±æ˜¯Springçš„"èµ„æºå¿«é€’å‘˜"
è´Ÿè´£æ ¹æ®åœ°å€æ‰¾åˆ°å¹¶é€æ¥ä½ éœ€è¦çš„èµ„æº
```

**æ ¸å¿ƒå®šä¹‰**ï¼š
> ResourceLoaderï¼ˆèµ„æºåŠ è½½å™¨ï¼‰æ˜¯Springæ¡†æ¶ä¸­**ç»Ÿä¸€ç®¡ç†èµ„æºåŠ è½½çš„æ ¸å¿ƒæ¥å£**ï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®ä¸åŒçš„è·¯å¾„è§„åˆ™ï¼Œä»ä¸åŒä½ç½®ï¼ˆç±»è·¯å¾„ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç­‰ï¼‰åŠ è½½å„ç§èµ„æºã€‚

**ä¸ºä»€ä¹ˆéœ€è¦ResourceLoaderï¼Ÿ**
```
ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜ï¼š
File file = new File("config.xml");              // åªèƒ½åŠ è½½æ–‡ä»¶ç³»ç»Ÿ
InputStream is = Class.getResourceAsStream(...); // åªèƒ½åŠ è½½classpath
URL url = new URL("http://...");                 // åªèƒ½åŠ è½½ç½‘ç»œ

ResourceLoaderçš„ä¼˜åŠ¿ï¼š
Resource res = loader.getResource("classpath:config.xml");  // ç»Ÿä¸€API
Resource res = loader.getResource("file:/data/config.xml"); // åŒæ ·çš„æ–¹å¼
Resource res = loader.getResource("http://...");            // ä¸€ä¸ªæ¥å£æå®š
```

### 1.2 ResourceLoaderåœ¨Springä¸­çš„ä½œç”¨


**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ”¹ **ç»Ÿä¸€èµ„æºè®¿é—®**ï¼šä¸€å¥—APIè®¿é—®æ‰€æœ‰ç±»å‹èµ„æº
- ğŸ”¹ **è·¯å¾„è‡ªåŠ¨è§£æ**ï¼šæ™ºèƒ½è¯†åˆ«ä¸åŒè·¯å¾„å‰ç¼€
- ğŸ”¹ **ç®€åŒ–å¼€å‘**ï¼šä¸ç”¨å…³å¿ƒèµ„æºåœ¨å“ªï¼Œæ€ä¹ˆè¯»
- ğŸ”¹ **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰åè®®å’ŒåŠ è½½ç­–ç•¥

**åº”ç”¨åœºæ™¯ä¸¾ä¾‹**ï¼š
```
é…ç½®æ–‡ä»¶åŠ è½½ï¼š
application.properties   â† classpathèµ„æº
database.yml            â† æ–‡ä»¶ç³»ç»Ÿèµ„æº  
remote-config.json      â† ç½‘ç»œèµ„æº

é™æ€èµ„æºè®¿é—®ï¼š
images/logo.png         â† Webèµ„æº
templates/email.html    â† æ¨¡æ¿èµ„æº

åŠ¨æ€èµ„æºè·å–ï¼š
user-uploads/avatar.jpg â† ç”¨æˆ·ä¸Šä¼ 
temp/export.xlsx        â† ä¸´æ—¶æ–‡ä»¶
```

---

## 2. ğŸ” ResourceLoaderæ¥å£æ ¸å¿ƒæ–¹æ³•


### 2.1 æ¥å£å®šä¹‰è§£æ


**ResourceLoaderæ¥å£ç»“æ„**ï¼š
```java
public interface ResourceLoader {
    
    // æ ¸å¿ƒæ–¹æ³•ï¼šæ ¹æ®è·¯å¾„è·å–èµ„æº
    Resource getResource(String location);
    
    // è·å–ç±»åŠ è½½å™¨ï¼ˆç”¨äºclasspathèµ„æºï¼‰
    ClassLoader getClassLoader();
    
    // classpathå‰ç¼€å¸¸é‡
    String CLASSPATH_URL_PREFIX = "classpath:";
}
```

**getResourceæ–¹æ³•è¯¦è§£**ï¼š
```
ä½œç”¨ï¼šè¿™æ˜¯æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œæ ¹æ®è·¯å¾„å­—ç¬¦ä¸²è·å–Resourceå¯¹è±¡

å‚æ•°locationçš„å«ä¹‰ï¼š
- locationå°±æ˜¯èµ„æºçš„"åœ°å€"
- å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„
- å¯ä»¥å¸¦åè®®å‰ç¼€ï¼ˆclasspath:ã€file:ç­‰ï¼‰

è¿”å›å€¼Resourceï¼š
- æ˜¯å¯¹èµ„æºçš„æŠ½è±¡å°è£…
- å¯ä»¥æ˜¯æ–‡ä»¶ã€URLã€å­—èŠ‚æ•°ç»„ç­‰
- æä¾›ç»Ÿä¸€çš„è¯»å–API
```

### 2.2 ä½¿ç”¨ç¤ºä¾‹å¯¹æ¯”


**ä¼ ç»Ÿæ–¹å¼ vs ResourceLoaderæ–¹å¼**ï¼š

```java
// âŒ ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦åˆ¤æ–­èµ„æºç±»å‹
public InputStream loadResource(String path) {
    if (path.startsWith("http")) {
        // ç½‘ç»œèµ„æº
        return new URL(path).openStream();
    } else if (path.startsWith("/")) {
        // æ–‡ä»¶ç³»ç»Ÿ
        return new FileInputStream(path);
    } else {
        // classpath
        return getClass().getResourceAsStream(path);
    }
}

// âœ… ResourceLoaderæ–¹å¼ï¼šç»Ÿä¸€å¤„ç†
@Autowired
private ResourceLoader resourceLoader;

public InputStream loadResource(String path) {
    Resource resource = resourceLoader.getResource(path);
    return resource.getInputStream();
}
```

**å…³é”®ä¼˜åŠ¿å¯¹æ¯”**ï¼š

| å¯¹æ¯”ç»´åº¦ | **ä¼ ç»Ÿæ–¹å¼** | **ResourceLoaderæ–¹å¼** |
|---------|------------|---------------------|
| ä»£ç å¤æ‚åº¦ | `éœ€è¦if-elseåˆ¤æ–­èµ„æºç±»å‹` | `ä¸€è¡Œä»£ç æå®š` |
| æ‰©å±•æ€§ | `æ–°å¢èµ„æºç±»å‹è¦æ”¹ä»£ç ` | `è‡ªåŠ¨æ”¯æŒï¼Œæ— éœ€ä¿®æ”¹` |
| å¯ç»´æŠ¤æ€§ | `åˆ†æ•£åœ¨å„å¤„ï¼Œéš¾ç»´æŠ¤` | `ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“ç»´æŠ¤` |
| å¼‚å¸¸å¤„ç† | `å„ç§å¼‚å¸¸è¦åˆ†åˆ«å¤„ç†` | `ç»Ÿä¸€çš„å¼‚å¸¸ä½“ç³»` |

---

## 3. ğŸ“‹ è·¯å¾„è§£æè§„åˆ™è¯¦è§£


### 3.1 è·¯å¾„ç±»å‹åˆ†ç±»


**Springæ”¯æŒçš„è·¯å¾„æ ¼å¼**ï¼š

```
1. å¸¦åè®®å‰ç¼€çš„è·¯å¾„ï¼š
   classpath:config/app.properties     â† classpathèµ„æº
   file:/etc/config/app.properties     â† æ–‡ä»¶ç³»ç»Ÿèµ„æº
   http://example.com/config.json      â† ç½‘ç»œèµ„æº
   
2. ä¸å¸¦å‰ç¼€çš„è·¯å¾„ï¼š
   config/app.properties               â† ç›¸å¯¹è·¯å¾„
   /etc/config/app.properties          â† ç»å¯¹è·¯å¾„
   
3. é€šé…ç¬¦è·¯å¾„ï¼š
   classpath*:config/*.xml             â† åŒ¹é…å¤šä¸ªèµ„æº
   file:/data/**/*.json                â† é€’å½’åŒ¹é…
```

### 3.2 è·¯å¾„è§£ææµç¨‹


**è§£ææ­¥éª¤å›¾ç¤º**ï¼š
```
è¾“å…¥è·¯å¾„: "classpath:config/app.properties"
    â†“
ã€æ­¥éª¤1ã€‘æ£€æµ‹åè®®å‰ç¼€
    â†“
å‘ç°"classpath:"å‰ç¼€
    â†“
ã€æ­¥éª¤2ã€‘é€‰æ‹©å¯¹åº”åŠ è½½å™¨
    â†“
ä½¿ç”¨ClassPathResourceåŠ è½½å™¨
    â†“
ã€æ­¥éª¤3ã€‘è§£æå®é™…è·¯å¾„
    â†“
å»æ‰å‰ç¼€ï¼Œå¾—åˆ°"config/app.properties"
    â†“
ã€æ­¥éª¤4ã€‘å®šä½èµ„æº
    â†“
åœ¨classpathä¸­æŸ¥æ‰¾è¯¥æ–‡ä»¶
    â†“
ã€æ­¥éª¤5ã€‘è¿”å›Resourceå¯¹è±¡
```

### 3.3 ä¸åŒå‰ç¼€çš„å¤„ç†è§„åˆ™


**classpath: å‰ç¼€**ï¼š
```java
// ç¤ºä¾‹ï¼šåŠ è½½classpathä¸‹çš„èµ„æº
Resource res = loader.getResource("classpath:application.yml");

å¤„ç†è§„åˆ™ï¼š
âœ“ åªä»å½“å‰åº”ç”¨çš„classpathåŠ è½½
âœ“ æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„èµ„æºå°±è¿”å›
âœ“ é€šå¸¸åŠ è½½src/main/resourcesä¸‹çš„æ–‡ä»¶

å®é™…è·¯å¾„ç¤ºä¾‹ï¼š
é¡¹ç›®ç»“æ„ï¼š
  src/main/resources/
    â””â”€â”€ application.yml    â† ä¼šè¢«æ‰¾åˆ°
  target/classes/
    â””â”€â”€ application.yml    â† ç¼–è¯‘åçš„ä½ç½®
```

**file: å‰ç¼€**ï¼š
```java
// ç¤ºä¾‹ï¼šåŠ è½½æ–‡ä»¶ç³»ç»Ÿèµ„æº
Resource res = loader.getResource("file:/etc/app/config.json");

å¤„ç†è§„åˆ™ï¼š
âœ“ ä»æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»ŸåŠ è½½
âœ“ æ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„
âœ“ Windowså’ŒLinuxè·¯å¾„éƒ½æ”¯æŒ

è·¯å¾„ç¤ºä¾‹ï¼š
Windows: file:C:/Users/data/config.xml
Linux:   file:/home/user/data/config.xml
ç›¸å¯¹:    file:../config/config.xml
```

**http/https: å‰ç¼€**ï¼š
```java
// ç¤ºä¾‹ï¼šåŠ è½½ç½‘ç»œèµ„æº
Resource res = loader.getResource("http://config.example.com/app.json");

å¤„ç†è§„åˆ™ï¼š
âœ“ é€šè¿‡HTTPåè®®è·å–è¿œç¨‹èµ„æº
âœ“ æ”¯æŒåŸºæœ¬è®¤è¯
âœ“ è‡ªåŠ¨å¤„ç†é‡å®šå‘

åº”ç”¨åœºæ™¯ï¼š
- è¿œç¨‹é…ç½®ä¸­å¿ƒ
- äº‘å­˜å‚¨èµ„æº
- ç¬¬ä¸‰æ–¹APIæ•°æ®
```

### 3.4 æ— å‰ç¼€è·¯å¾„çš„é»˜è®¤è§„åˆ™


**é»˜è®¤åŠ è½½ç­–ç•¥**ï¼š
```java
// æ²¡æœ‰å‰ç¼€æ—¶ï¼Œå¦‚ä½•åˆ¤æ–­ï¼Ÿ
Resource res = loader.getResource("config/app.properties");

åˆ¤æ–­é€»è¾‘ï¼š
1. æ£€æŸ¥ApplicationContextç±»å‹
   - Webç¯å¢ƒ â†’ ä½œä¸ºServletContextç›¸å¯¹è·¯å¾„
   - éWebç¯å¢ƒ â†’ ä½œä¸ºClassPathç›¸å¯¹è·¯å¾„

2. æ£€æŸ¥è·¯å¾„ç‰¹å¾
   - ä»¥"/"å¼€å¤´ â†’ å¯èƒ½æ˜¯ç»å¯¹è·¯å¾„
   - ä¸ä»¥"/"å¼€å¤´ â†’ ç›¸å¯¹äºå½“å‰ä¸Šä¸‹æ–‡

ç¤ºä¾‹å¯¹æ¯”ï¼š
@Configuration
public class Config {
    @Autowired
    private ResourceLoader loader;
    
    public void loadResource() {
        // Webç¯å¢ƒä¸‹
        Resource r1 = loader.getResource("images/logo.png");
        // â†’ ç›¸å¯¹äºwebappæ ¹ç›®å½•
        
        // æ™®é€šSpringåº”ç”¨
        Resource r2 = loader.getResource("config.xml");
        // â†’ ç›¸å¯¹äºclasspathæ ¹ç›®å½•
    }
}
```

---

## 4. ğŸŒ åè®®æ”¯æŒä¸ä½¿ç”¨


### 4.1 å†…ç½®åè®®è¯¦è§£


**åè®®æ”¯æŒåˆ—è¡¨**ï¼š

| åè®®å‰ç¼€ | **èµ„æºç±»å‹** | **ä½¿ç”¨åœºæ™¯** | **ç¤ºä¾‹è·¯å¾„** |
|---------|-----------|-----------|------------|
| `classpath:` | `ç±»è·¯å¾„èµ„æº` | `é…ç½®æ–‡ä»¶ã€é™æ€èµ„æº` | `classpath:config/app.yml` |
| `classpath*:` | `å¤šä¸ªç±»è·¯å¾„èµ„æº` | `åŠ è½½æ‰€æœ‰åŒ¹é…çš„é…ç½®` | `classpath*:META-INF/*.xml` |
| `file:` | `æ–‡ä»¶ç³»ç»Ÿèµ„æº` | `æœ¬åœ°æ–‡ä»¶ã€å…±äº«ç›®å½•` | `file:/data/upload/file.txt` |
| `http:` | `HTTPèµ„æº` | `è¿œç¨‹é…ç½®ã€API` | `http://api.com/config.json` |
| `https:` | `HTTPSèµ„æº` | `å®‰å…¨çš„è¿œç¨‹èµ„æº` | `https://secure.com/data.xml` |
| `ftp:` | `FTPèµ„æº` | `æ–‡ä»¶ä¼ è¾“` | `ftp://server/files/data.zip` |

### 4.2 classpath vs classpath* çš„åŒºåˆ«


**å…³é”®å·®å¼‚å¯¹æ¯”**ï¼š

```java
// classpath: å•ä¸ªèµ„æº
Resource single = loader.getResource("classpath:config.xml");
// è¡Œä¸ºï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å°±åœæ­¢

// classpath*: å¤šä¸ªèµ„æº  
Resource[] multiple = resolver.getResources("classpath*:config.xml");
// è¡Œä¸ºï¼šæ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„èµ„æº

å®é™…åœºæ™¯ä¸¾ä¾‹ï¼š
é¡¹ç›®ç»“æ„ï¼š
  my-app.jar
    â””â”€â”€ config.xml         â† èµ„æº1
  lib/
    â””â”€â”€ dependency.jar
        â””â”€â”€ config.xml     â† èµ„æº2

ä½¿ç”¨classpath:
åªä¼šåŠ è½½my-app.jarä¸­çš„config.xml

ä½¿ç”¨classpath*:
ä¼šåŠ è½½ä¸¤ä¸ªjarä¸­çš„æ‰€æœ‰config.xml
```

**ä½¿ç”¨å»ºè®®**ï¼š
```
âœ“ ç”¨classpath:çš„åœºæ™¯ï¼š
  - æ˜ç¡®çŸ¥é“èµ„æºåªæœ‰ä¸€ä¸ª
  - åªéœ€è¦åº”ç”¨è‡ªå·±çš„é…ç½®
  - æ€§èƒ½è¦æ±‚é«˜ï¼ˆæ›´å¿«ï¼‰

âœ“ ç”¨classpath*:çš„åœºæ™¯ï¼š
  - éœ€è¦æ”¶é›†å¤šä¸ªjarä¸­çš„èµ„æº
  - åŠ è½½æ‰€æœ‰æ¨¡å—çš„é…ç½®
  - æ’ä»¶åŒ–åº”ç”¨
```

### 4.3 åè®®ä½¿ç”¨ç¤ºä¾‹


**å®æˆ˜ä»£ç ç¤ºä¾‹**ï¼š

```java
@Service
public class ResourceService {
    
    @Autowired
    private ResourceLoader resourceLoader;
    
    // 1. åŠ è½½classpathèµ„æº
    public Properties loadClasspathConfig() throws IOException {
        Resource resource = resourceLoader.getResource(
            "classpath:application.properties"
        );
        
        Properties props = new Properties();
        props.load(resource.getInputStream());
        return props;
    }
    
    // 2. åŠ è½½æ–‡ä»¶ç³»ç»Ÿèµ„æº
    public String loadFileContent() throws IOException {
        Resource resource = resourceLoader.getResource(
            "file:/etc/app/message.txt"
        );
        
        return new String(
            resource.getInputStream().readAllBytes(),
            StandardCharsets.UTF_8
        );
    }
    
    // 3. åŠ è½½ç½‘ç»œèµ„æº
    public JsonNode loadRemoteConfig() throws IOException {
        Resource resource = resourceLoader.getResource(
            "http://config.example.com/app-config.json"
        );
        
        ObjectMapper mapper = new ObjectMapper();
        return mapper.readTree(resource.getInputStream());
    }
    
    // 4. æ‰¹é‡åŠ è½½å¤šä¸ªèµ„æº
    public List<Resource> loadAllConfigs() throws IOException {
        ResourcePatternResolver resolver = 
            (ResourcePatternResolver) resourceLoader;
            
        Resource[] resources = resolver.getResources(
            "classpath*:config/**/*.xml"
        );
        
        return Arrays.asList(resources);
    }
}
```

---

## 5. ğŸ”§ é»˜è®¤åŠ è½½å™¨æœºåˆ¶


### 5.1 ApplicationContextä½œä¸ºResourceLoader


**æ ¸å¿ƒæœºåˆ¶**ï¼š
> Springçš„`ApplicationContext`æœ¬èº«å°±å®ç°äº†`ResourceLoader`æ¥å£ï¼Œæ‰€ä»¥æ¯ä¸ªSpringåº”ç”¨éƒ½è‡ªå¸¦èµ„æºåŠ è½½èƒ½åŠ›ã€‚

```
ç»§æ‰¿å…³ç³»å›¾ç¤ºï¼š
ApplicationContext
       â†“ (ç»§æ‰¿)
ResourceLoader
       â†“ (å®ç°)
å…·ä½“åŠ è½½é€»è¾‘
```

**å®é™…ä½¿ç”¨**ï¼š
```java
// æ–¹å¼1: ç›´æ¥ä½¿ç”¨ApplicationContext
@Autowired
private ApplicationContext context;

public void loadResource() {
    Resource res = context.getResource("classpath:config.xml");
}

// æ–¹å¼2: æ³¨å…¥ResourceLoaderï¼ˆæ¨èï¼‰
@Autowired
private ResourceLoader resourceLoader;

public void loadResource() {
    Resource res = resourceLoader.getResource("classpath:config.xml");
}

ä¸ºä»€ä¹ˆæ¨èæ–¹å¼2ï¼Ÿ
- æ›´åŠ ä¸“æ³¨ï¼ˆåªå…³æ³¨èµ„æºåŠ è½½ï¼‰
- ä¾èµ–æ›´è½»ï¼ˆä¸ä¾èµ–å®Œæ•´çš„ApplicationContextï¼‰
- æ›´æ˜“æµ‹è¯•ï¼ˆå¯ä»¥mock ResourceLoaderï¼‰
```

### 5.2 ä¸åŒç¯å¢ƒçš„é»˜è®¤åŠ è½½å™¨


**ç¯å¢ƒç±»å‹å¯¹åº”çš„åŠ è½½å™¨**ï¼š

```
Webç¯å¢ƒï¼ˆSpring MVC/Boot Webï¼‰ï¼š
ApplicationContextç±»å‹: WebApplicationContext
é»˜è®¤ResourceLoader: ServletContextResourceLoader
ç‰¹ç‚¹ï¼š
  - æ”¯æŒServletContextèµ„æº
  - è·¯å¾„ç›¸å¯¹äºWebåº”ç”¨æ ¹ç›®å½•
  
ç¤ºä¾‹ï¼š
@Controller
public class FileController {
    @Autowired
    private ResourceLoader loader;
    
    public void load() {
        // Webç¯å¢ƒä¸‹ï¼Œç›¸å¯¹äºwebappç›®å½•
        Resource res = loader.getResource("WEB-INF/views/home.jsp");
    }
}

éWebç¯å¢ƒï¼ˆæ™®é€šåº”ç”¨ï¼‰ï¼š
ApplicationContextç±»å‹: ClassPathXmlApplicationContext
é»˜è®¤ResourceLoader: DefaultResourceLoader
ç‰¹ç‚¹ï¼š
  - æ”¯æŒClassPathèµ„æº
  - æ”¯æŒæ–‡ä»¶ç³»ç»Ÿèµ„æº
  - è·¯å¾„ç›¸å¯¹äºclasspath

ç¤ºä¾‹ï¼š
public static void main(String[] args) {
    ApplicationContext ctx = new ClassPathXmlApplicationContext();
    Resource res = ctx.getResource("config/app.properties");
}
```

### 5.3 é»˜è®¤åŠ è½½å™¨çš„é€‰æ‹©é€»è¾‘


**è‡ªåŠ¨é€‰æ‹©æµç¨‹**ï¼š
```
å¯åŠ¨Springåº”ç”¨
    â†“
æ£€æµ‹è¿è¡Œç¯å¢ƒ
    â†“
    â”œâ”€â†’ æ£€æµ‹åˆ°Servletå®¹å™¨
    â”‚     â†“
    â”‚   åˆ›å»ºWebApplicationContext
    â”‚     â†“
    â”‚   ä½¿ç”¨ServletContextResourceLoader
    â”‚
    â””â”€â†’ æ²¡æœ‰Servletå®¹å™¨
          â†“
        åˆ›å»ºæ™®é€šApplicationContext
          â†“
        ä½¿ç”¨DefaultResourceLoader
```

**é…ç½®è‡ªå®šä¹‰åŠ è½½å™¨**ï¼š
```java
// å¦‚æœé»˜è®¤åŠ è½½å™¨ä¸æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰
@Configuration
public class ResourceConfig {
    
    @Bean
    public ResourceLoader customResourceLoader() {
        return new DefaultResourceLoader() {
            @Override
            protected Resource getResourceByPath(String path) {
                // è‡ªå®šä¹‰è·¯å¾„è§£æé€»è¾‘
                if (path.startsWith("custom:")) {
                    return new CustomResource(path);
                }
                return super.getResourceByPath(path);
            }
        };
    }
}
```

---

## 6. ğŸ¯ åŠ è½½ç­–ç•¥ä¸å®ç°


### 6.1 Resourceæ¥å£ä¸å®ç°ç±»


**Resourceå®ç°ç±»ä½“ç³»**ï¼š
```
Resource (æ¥å£)
    â†“
    â”œâ”€ ClassPathResource        â† ç±»è·¯å¾„èµ„æº
    â”œâ”€ FileSystemResource       â† æ–‡ä»¶ç³»ç»Ÿèµ„æº
    â”œâ”€ UrlResource              â† URLèµ„æº
    â”œâ”€ ServletContextResource   â† Webåº”ç”¨èµ„æº
    â”œâ”€ ByteArrayResource        â† å­—èŠ‚æ•°ç»„èµ„æº
    â””â”€ InputStreamResource      â† è¾“å…¥æµèµ„æº
```

**å„å®ç°ç±»çš„ç‰¹ç‚¹**ï¼š

| å®ç°ç±» | **é€‚ç”¨åœºæ™¯** | **åˆ›å»ºæ–¹å¼** | **ç‰¹ç‚¹** |
|-------|-----------|-----------|---------|
| `ClassPathResource` | `classpathèµ„æº` | `new ClassPathResource("config.xml")` | `è‡ªåŠ¨ä»classpathæŸ¥æ‰¾` |
| `FileSystemResource` | `æœ¬åœ°æ–‡ä»¶` | `new FileSystemResource("/data/file.txt")` | `æ”¯æŒç»å¯¹å’Œç›¸å¯¹è·¯å¾„` |
| `UrlResource` | `ç½‘ç»œèµ„æº` | `new UrlResource("http://example.com")` | `æ”¯æŒHTTPã€FTPç­‰åè®®` |
| `ByteArrayResource` | `å†…å­˜æ•°æ®` | `new ByteArrayResource(bytes)` | `é€‚åˆä¸´æ—¶æ•°æ®` |

### 6.2 åŠ è½½ç­–ç•¥é€‰æ‹©


**ç­–ç•¥æ¨¡å¼çš„åº”ç”¨**ï¼š
```
ç”¨æˆ·è¯·æ±‚: getResource("classpath:config.xml")
    â†“
ResourceLoaderåˆ†æè·¯å¾„
    â†“
    â”œâ”€â†’ å‘ç°"classpath:"å‰ç¼€
    â”‚     â†“
    â”‚   é€‰æ‹©ClassPathResourceç­–ç•¥
    â”‚     â†“
    â”‚   ä»classpathåŠ è½½
    â”‚
    â”œâ”€â†’ å‘ç°"file:"å‰ç¼€
    â”‚     â†“
    â”‚   é€‰æ‹©FileSystemResourceç­–ç•¥
    â”‚     â†“
    â”‚   ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½
    â”‚
    â””â”€â†’ å‘ç°"http:"å‰ç¼€
          â†“
        é€‰æ‹©UrlResourceç­–ç•¥
          â†“
        ä»ç½‘ç»œåŠ è½½
```

**å®ç°åŸç†ç¤ºä¾‹**ï¼š
```java
// DefaultResourceLoaderçš„æ ¸å¿ƒé€»è¾‘
public class DefaultResourceLoader implements ResourceLoader {
    
    @Override
    public Resource getResource(String location) {
        // ç­–ç•¥1: å¤„ç†classpathå‰ç¼€
        if (location.startsWith(CLASSPATH_URL_PREFIX)) {
            String path = location.substring(CLASSPATH_URL_PREFIX.length());
            return new ClassPathResource(path, getClassLoader());
        }
        
        // ç­–ç•¥2: å¤„ç†URLæ ¼å¼
        try {
            URL url = new URL(location);
            return new UrlResource(url);
        } catch (MalformedURLException ex) {
            // ä¸æ˜¯URLæ ¼å¼ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªç­–ç•¥
        }
        
        // ç­–ç•¥3: å¤„ç†æ™®é€šè·¯å¾„
        return getResourceByPath(location);
    }
    
    // å­ç±»å¯ä»¥é‡å†™æ­¤æ–¹æ³•ï¼Œæä¾›è‡ªå®šä¹‰ç­–ç•¥
    protected Resource getResourceByPath(String path) {
        return new ClassPathContextResource(path, getClassLoader());
    }
}
```

### 6.3 é€šé…ç¬¦åŠ è½½ç­–ç•¥


**PathMatchingResourcePatternResolver**ï¼š
```java
// æ”¯æŒé€šé…ç¬¦çš„é«˜çº§åŠ è½½å™¨
@Service
public class ConfigLoader {
    
    @Autowired
    private ResourceLoader resourceLoader;
    
    public void loadAllXmlConfigs() throws IOException {
        // å°†ResourceLoaderè½¬æ¢ä¸ºæ”¯æŒé€šé…ç¬¦çš„ç‰ˆæœ¬
        ResourcePatternResolver resolver = 
            ResourcePatternResolver.fromResourceLoader(resourceLoader);
        
        // ä½¿ç”¨é€šé…ç¬¦åŠ è½½å¤šä¸ªèµ„æº
        Resource[] resources = resolver.getResources(
            "classpath*:config/**/*.xml"
        );
        
        for (Resource resource : resources) {
            System.out.println("æ‰¾åˆ°é…ç½®: " + resource.getFilename());
        }
    }
}

é€šé…ç¬¦è§„åˆ™è¯´æ˜ï¼š
*   â†’ åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆä¸è·¨ç›®å½•ï¼‰
**  â†’ åŒ¹é…ä»»æ„ç›®å½•å±‚çº§
?   â†’ åŒ¹é…å•ä¸ªå­—ç¬¦

ç¤ºä¾‹ï¼š
classpath*:config/*.xml        â†’ configç›®å½•ä¸‹æ‰€æœ‰xml
classpath*:config/**/*.xml     â†’ configåŠå­ç›®å½•ä¸‹æ‰€æœ‰xml
classpath:data/file?.txt       â†’ file1.txt, file2.txtç­‰
```

---

## 7. ğŸ’¾ ç¼“å­˜æœºåˆ¶ä¼˜åŒ–


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜


**æ€§èƒ½é—®é¢˜åœºæ™¯**ï¼š
```
é—®é¢˜ï¼šæ¯æ¬¡è°ƒç”¨getResource()éƒ½é‡æ–°åŠ è½½
åœºæ™¯1: é…ç½®æ–‡ä»¶è¢«é¢‘ç¹è¯»å–
  for (int i = 0; i < 1000; i++) {
      Resource r = loader.getResource("classpath:config.xml");
      r.getInputStream(); // æ¯æ¬¡éƒ½é‡æ–°æ‰“å¼€æ–‡ä»¶
  }
  
åœºæ™¯2: ç½‘ç»œèµ„æºåå¤è·å–
  Resource remote = loader.getResource("http://api.com/data.json");
  // æ¯æ¬¡éƒ½å‘é€HTTPè¯·æ±‚ï¼Œæµªè´¹å¸¦å®½

è§£å†³æ–¹æ¡ˆï¼šå¼•å…¥ç¼“å­˜æœºåˆ¶
```

### 7.2 Springçš„ç¼“å­˜ç­–ç•¥


**Resourceç¼“å­˜æœºåˆ¶**ï¼š
```java
// Springå†…éƒ¨çš„ç¼“å­˜å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
public class CachingResourceLoader implements ResourceLoader {
    
    // ç¼“å­˜å·²åŠ è½½çš„èµ„æº
    private final Map<String, Resource> resourceCache = 
        new ConcurrentHashMap<>();
    
    private final ResourceLoader delegate;
    
    @Override
    public Resource getResource(String location) {
        // å…ˆæŸ¥ç¼“å­˜
        Resource cached = resourceCache.get(location);
        if (cached != null && cached.exists()) {
            return cached;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œå®é™…åŠ è½½
        Resource resource = delegate.getResource(location);
        
        // æ”¾å…¥ç¼“å­˜ï¼ˆåªç¼“å­˜å­˜åœ¨çš„èµ„æºï¼‰
        if (resource.exists()) {
            resourceCache.put(location, resource);
        }
        
        return resource;
    }
}
```

**ç¼“å­˜çš„åº”ç”¨åœºæ™¯**ï¼š
```
âœ“ é€‚åˆç¼“å­˜çš„èµ„æºï¼š
  - é…ç½®æ–‡ä»¶ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰
  - é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€CSSã€JSï¼‰
  - æ¨¡æ¿æ–‡ä»¶

âœ— ä¸é€‚åˆç¼“å­˜çš„èµ„æºï¼š
  - ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼ˆé¢‘ç¹å˜åŒ–ï¼‰
  - å®æ—¶æ•°æ®ï¼ˆéœ€è¦æœ€æ–°å†…å®¹ï¼‰
  - ä¸´æ—¶æ–‡ä»¶
```

### 7.3 è‡ªå®šä¹‰ç¼“å­˜å®ç°


**å®æˆ˜ç¤ºä¾‹**ï¼š
```java
@Component
public class SmartResourceLoader {
    
    @Autowired
    private ResourceLoader resourceLoader;
    
    // ä½¿ç”¨Guavaç¼“å­˜ï¼Œå¸¦è¿‡æœŸæ—¶é—´
    private final LoadingCache<String, Resource> cache = 
        CacheBuilder.newBuilder()
            .maximumSize(1000)              // æœ€å¤šç¼“å­˜1000ä¸ª
            .expireAfterWrite(10, TimeUnit.MINUTES)  // 10åˆ†é’Ÿè¿‡æœŸ
            .build(new CacheLoader<String, Resource>() {
                @Override
                public Resource load(String location) {
                    return resourceLoader.getResource(location);
                }
            });
    
    // å¸¦ç¼“å­˜çš„èµ„æºè·å–
    public Resource getResourceCached(String location) {
        try {
            return cache.get(location);
        } catch (ExecutionException e) {
            throw new RuntimeException("åŠ è½½èµ„æºå¤±è´¥: " + location, e);
        }
    }
    
    // æ¸…é™¤æŒ‡å®šèµ„æºçš„ç¼“å­˜
    public void invalidate(String location) {
        cache.invalidate(location);
    }
    
    // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
    public void clearCache() {
        cache.invalidateAll();
    }
}

ä½¿ç”¨ç¤ºä¾‹ï¼š
@Service
public class ConfigService {
    
    @Autowired
    private SmartResourceLoader loader;
    
    public void processConfig() {
        // é¦–æ¬¡åŠ è½½ï¼šä»å®é™…ä½ç½®è¯»å–
        Resource config = loader.getResourceCached("classpath:app.yml");
        
        // åç»­åŠ è½½ï¼šä»ç¼“å­˜è¯»å–ï¼ˆ10åˆ†é’Ÿå†…ï¼‰
        Resource configAgain = loader.getResourceCached("classpath:app.yml");
        
        // é…ç½®æ›´æ–°åï¼Œæ‰‹åŠ¨åˆ·æ–°ç¼“å­˜
        loader.invalidate("classpath:app.yml");
    }
}
```

### 7.4 ç¼“å­˜çš„æ³¨æ„äº‹é¡¹


**æœ€ä½³å®è·µ**ï¼š
```
1. ç¼“å­˜ç²’åº¦æ§åˆ¶
   âœ“ åªç¼“å­˜ä¸å˜æˆ–å°‘å˜çš„èµ„æº
   âœ— é¿å…ç¼“å­˜åŠ¨æ€å†…å®¹
   
2. ç¼“å­˜å¤±æ•ˆç­–ç•¥
   - è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
   - æä¾›æ‰‹åŠ¨åˆ·æ–°æœºåˆ¶
   - ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
   
3. å†…å­˜ç®¡ç†
   - é™åˆ¶ç¼“å­˜å¤§å°ï¼ˆé˜²æ­¢OOMï¼‰
   - ä½¿ç”¨å¼±å¼•ç”¨ç¼“å­˜ï¼ˆå…è®¸GCå›æ”¶ï¼‰
   - å®šæœŸæ¸…ç†æ— æ•ˆç¼“å­˜
   
4. å¹¶å‘æ§åˆ¶
   - ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜å®ç°
   - é¿å…ç¼“å­˜é›ªå´©ï¼ˆåŒæ—¶å¤±æ•ˆï¼‰
   - è€ƒè™‘ç¼“å­˜é¢„çƒ­
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ResourceLoaderæœ¬è´¨ï¼šSpringçš„ç»Ÿä¸€èµ„æºåŠ è½½æ¥å£
ğŸ”¸ æ ¸å¿ƒæ–¹æ³•ï¼šgetResource(String location)
ğŸ”¸ è·¯å¾„è§„åˆ™ï¼šåè®®å‰ç¼€ + å®é™…è·¯å¾„
ğŸ”¸ åè®®æ”¯æŒï¼šclasspathã€fileã€httpç­‰
ğŸ”¸ é»˜è®¤åŠ è½½å™¨ï¼šApplicationContextè‡ªå¸¦
ğŸ”¸ åŠ è½½ç­–ç•¥ï¼šæ ¹æ®è·¯å¾„å‰ç¼€é€‰æ‹©ä¸åŒResourceå®ç°
ğŸ”¸ ç¼“å­˜æœºåˆ¶ï¼šæå‡æ€§èƒ½ï¼Œå‡å°‘é‡å¤åŠ è½½
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ResourceLoaderçš„è®¾è®¡æ€æƒ³**
```
ç»Ÿä¸€æŠ½è±¡ï¼š
- ä¸€ä¸ªæ¥å£è§£å†³æ‰€æœ‰èµ„æºåŠ è½½
- å±è”½ä¸åŒèµ„æºçš„å·®å¼‚
- ç®€åŒ–å¼€å‘è€…ä½¿ç”¨

ç­–ç•¥æ¨¡å¼ï¼š
- æ ¹æ®è·¯å¾„å‰ç¼€é€‰æ‹©åŠ è½½ç­–ç•¥
- æ”¯æŒæ‰©å±•è‡ªå®šä¹‰åè®®
- çµæ´»åº”å¯¹ä¸åŒåœºæ™¯
```

**ğŸ”¹ è·¯å¾„è§£æçš„å…³é”®ç‚¹**
```
è®°å¿†æŠ€å·§ï¼š
- classpath: â†’ ä»é¡¹ç›®èµ„æºç›®å½•æ‰¾
- file: â†’ ä»æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿæ‰¾
- http: â†’ ä»ç½‘ç»œåœ°å€æ‰¾
- æ— å‰ç¼€ â†’ çœ‹ç¯å¢ƒï¼ˆWebæˆ–æ™®é€šåº”ç”¨ï¼‰
```

**ğŸ”¹ å®é™…åº”ç”¨å»ºè®®**
```
å¼€å‘è§„èŒƒï¼š
âœ“ é…ç½®æ–‡ä»¶ç”¨classpath:å‰ç¼€
âœ“ æœ¬åœ°æ–‡ä»¶ç”¨file:å‰ç¼€
âœ“ è¿œç¨‹èµ„æºç”¨å®Œæ•´URL
âœ“ æ‰¹é‡åŠ è½½ç”¨classpath*:é€šé…ç¬¦

æ€§èƒ½ä¼˜åŒ–ï¼š
âœ“ ç¼“å­˜ä¸å˜çš„èµ„æº
âœ“ å»¶è¿ŸåŠ è½½å¤§æ–‡ä»¶
âœ“ ä½¿ç”¨é€šé…ç¬¦æ‰¹é‡åŠ è½½
âœ“ ç›‘æ§èµ„æºåŠ è½½è€—æ—¶
```

### 8.3 å®æˆ˜ç»éªŒæ€»ç»“


**å¸¸è§é—®é¢˜ä¸è§£å†³**ï¼š
```
é—®é¢˜1ï¼šæ‰¾ä¸åˆ°classpathèµ„æº
åŸå› ï¼šè·¯å¾„å†™é”™æˆ–æ–‡ä»¶ä¸åœ¨resourcesç›®å½•
è§£å†³ï¼šæ£€æŸ¥è·¯å¾„ï¼Œç¡®ä¿æ–‡ä»¶åœ¨src/main/resourcesä¸‹

é—®é¢˜2ï¼šåŠ è½½æ–‡ä»¶ç³»ç»Ÿèµ„æºå¤±è´¥
åŸå› ï¼šæƒé™ä¸è¶³æˆ–è·¯å¾„ä¸å­˜åœ¨
è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„

é—®é¢˜3ï¼šç½‘ç»œèµ„æºåŠ è½½æ…¢
åŸå› ï¼šç½‘ç»œå»¶è¿Ÿï¼Œæ²¡æœ‰ç¼“å­˜
è§£å†³ï¼šå¯ç”¨ç¼“å­˜ï¼Œè€ƒè™‘æœ¬åœ°å¤‡ä»½

é—®é¢˜4ï¼šå¤šä¸ªåŒåèµ„æºå†²çª
åŸå› ï¼šä¸åŒjaråŒ…å«åŒåæ–‡ä»¶
è§£å†³ï¼šä½¿ç”¨classpath*:åŠ è½½æ‰€æœ‰ï¼Œæˆ–è°ƒæ•´åŠ è½½é¡ºåº
```

**æœ€ä½³å®è·µæ¸…å•**ï¼š
- âœ… å§‹ç»ˆä½¿ç”¨ResourceLoaderæ¥å£ï¼Œä¸ç›´æ¥ç”¨Fileæˆ–URL
- âœ… é…ç½®æ–‡ä»¶é›†ä¸­æ”¾åœ¨resourcesç›®å½•ï¼Œä½¿ç”¨classpath:
- âœ… ä¸ºèµ„æºåŠ è½½æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œä¼˜é›…é™çº§
- âœ… å¯¹é¢‘ç¹è®¿é—®çš„èµ„æºå¯ç”¨ç¼“å­˜
- âœ… ä½¿ç”¨@Valueæˆ–@ConfigurationPropertiesæ³¨å…¥èµ„æºè·¯å¾„
- âœ… åœ¨å•å…ƒæµ‹è¯•ä¸­mock ResourceLoaderï¼Œä¾¿äºæµ‹è¯•

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ResourceLoaderèµ„æºåŠ è½½å™¨ï¼Œ
ç»Ÿä¸€æ¥å£æœ€çœåŠ›ï¼Œ
classpathç±»è·¯å¾„æ‰¾æ–‡ä»¶ï¼Œ
fileæœ¬åœ°httpè¿œç¨‹å–ï¼Œ
è·¯å¾„å‰ç¼€å®šç­–ç•¥ï¼Œ
ç¼“å­˜ä¼˜åŒ–ææ€§èƒ½ã€‚
```