---
title: 9ã€Environmentç¯å¢ƒæŠ½è±¡
---
## ğŸ“š ç›®å½•

1. [Environmentæ˜¯ä»€ä¹ˆ](#1-Environmentæ˜¯ä»€ä¹ˆ)
2. [Profileç¯å¢ƒé…ç½®](#2-Profileç¯å¢ƒé…ç½®)
3. [PropertySourceå±æ€§æº](#3-PropertySourceå±æ€§æº)
4. [é…ç½®ä¼˜å…ˆçº§æœºåˆ¶](#4-é…ç½®ä¼˜å…ˆçº§æœºåˆ¶)
5. [ç¯å¢ƒæ¿€æ´»ç­–ç•¥](#5-ç¯å¢ƒæ¿€æ´»ç­–ç•¥)
6. [å±æ€§è§£æå®æˆ˜](#6-å±æ€§è§£æå®æˆ˜)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ Environmentæ˜¯ä»€ä¹ˆ


### 1.1 æ ¸å¿ƒæ¦‚å¿µç†è§£


**Environmentæ¥å£æ˜¯ä»€ä¹ˆï¼Ÿ**

ç®€å•æ¥è¯´ï¼ŒEnvironmentå°±æ˜¯Springä¸ºä½ å‡†å¤‡çš„ä¸€ä¸ª**"ç¯å¢ƒç®¡å®¶"**ï¼Œå®ƒè´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„å„ç§é…ç½®ä¿¡æ¯ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
å°±åƒä½ çš„æ‰‹æœºæœ‰"è®¾ç½®"åŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹å„ç§é…ç½®ï¼š
- æŸ¥çœ‹å½“å‰ç½‘ç»œç¯å¢ƒï¼ˆWiFi/4Gï¼‰
- è¯»å–ç³»ç»Ÿå±æ€§ï¼ˆç”µé‡ã€å­˜å‚¨ï¼‰
- ç®¡ç†åº”ç”¨é…ç½®ï¼ˆä¸»é¢˜ã€è¯­è¨€ï¼‰

Environmentåšçš„å°±æ˜¯è¿™ä»¶äº‹ï¼Œåªä¸è¿‡æ˜¯åœ¨Springåº”ç”¨ä¸­ï¼
```

**Environmentçš„ä¸¤å¤§æ ¸å¿ƒèŒè´£**ï¼š

ğŸ”¸ **ç®¡ç†Profileï¼ˆç¯å¢ƒé…ç½®ï¼‰**
- å‘Šè¯‰Springç°åœ¨æ˜¯å¼€å‘ç¯å¢ƒè¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒ
- æ ¹æ®ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒé…ç½®
- å°±åƒä½ çš„APPåœ¨WiFiå’Œæµé‡ä¸‹æœ‰ä¸åŒè¡Œä¸º

ğŸ”¸ **ç®¡ç†Propertiesï¼ˆå±æ€§é…ç½®ï¼‰**
- è¯»å–å„ç§é…ç½®æ–‡ä»¶çš„å±æ€§
- æä¾›ç»Ÿä¸€çš„é…ç½®è®¿é—®æ¥å£
- å°±åƒä¸€ä¸ªé…ç½®ä¿¡æ¯çš„"ç™¾åº¦æœç´¢"

### 1.2 Environmentæ¥å£ç»“æ„


**æ ¸å¿ƒæ–¹æ³•ä¸€è§ˆ**ï¼š

```java
public interface Environment {
    
    // ===== Profileç›¸å…³æ–¹æ³• =====
    
    // è·å–å½“å‰æ¿€æ´»çš„ç¯å¢ƒï¼ˆå¦‚ï¼šdev, test, prodï¼‰
    String[] getActiveProfiles();
    
    // è·å–é»˜è®¤ç¯å¢ƒï¼ˆæ²¡æ¿€æ´»ä»»ä½•ç¯å¢ƒæ—¶ç”¨è¿™ä¸ªï¼‰
    String[] getDefaultProfiles();
    
    // åˆ¤æ–­æŸä¸ªç¯å¢ƒæ˜¯å¦è¢«æ¿€æ´»
    boolean acceptsProfiles(String... profiles);
    
    
    // ===== Propertiesç›¸å…³æ–¹æ³• =====
    
    // è·å–å±æ€§å€¼ï¼ˆæœ€å¸¸ç”¨ï¼ï¼‰
    String getProperty(String key);
    
    // è·å–å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°è¿”å›é»˜è®¤å€¼
    String getProperty(String key, String defaultValue);
    
    // è·å–å±æ€§å€¼å¹¶è½¬æ¢ç±»å‹
    <T> T getProperty(String key, Class<T> type);
    
    // åˆ¤æ–­å±æ€§æ˜¯å¦å­˜åœ¨
    boolean containsProperty(String key);
}
```

> ğŸ’¡ **æ–°æ‰‹æç¤º**ï¼š
> ä¸ç”¨è®°ä½æ‰€æœ‰æ–¹æ³•ï¼Œå®é™…å¼€å‘ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯ `getProperty()` è¯»å–é…ç½®å’Œ `getActiveProfiles()` æŸ¥çœ‹ç¯å¢ƒ

### 1.3 å®é™…ä½¿ç”¨åœºæ™¯


**åœºæ™¯1ï¼šè·å–Environmentå¯¹è±¡**

Springæä¾›äº†å¤šç§æ–¹å¼è·å–Environmentï¼š

```java
// æ–¹å¼1ï¼šé€šè¿‡@Autowiredæ³¨å…¥ï¼ˆæ¨èï¼‰
@Component
public class MyService {
    
    @Autowired
    private Environment env;
    
    public void doSomething() {
        // è¯»å–é…ç½®
        String dbUrl = env.getProperty("database.url");
        // æ£€æŸ¥ç¯å¢ƒ
        boolean isProd = env.acceptsProfiles("prod");
    }
}

// æ–¹å¼2ï¼šå®ç°EnvironmentAwareæ¥å£
@Component
public class MyConfig implements EnvironmentAware {
    
    private Environment env;
    
    @Override
    public void setEnvironment(Environment environment) {
        this.env = environment;
    }
}
```

**åœºæ™¯2ï¼šè¯»å–é…ç½®æ–‡ä»¶**

```java
@Service
public class DatabaseService {
    
    @Autowired
    private Environment env;
    
    public void connect() {
        // ä»application.propertiesè¯»å–æ•°æ®åº“é…ç½®
        String url = env.getProperty("spring.datasource.url");
        String username = env.getProperty("spring.datasource.username");
        String password = env.getProperty("spring.datasource.password");
        
        // è¿æ¥æ•°æ®åº“...
    }
}
```

---

## 2. ğŸ¯ Profileç¯å¢ƒé…ç½®


### 2.1 ä»€ä¹ˆæ˜¯Profile


**Profileçš„æœ¬è´¨**ï¼šç»™ä½ çš„é…ç½®"è´´æ ‡ç­¾"ï¼Œä¸åŒç¯å¢ƒç”¨ä¸åŒé…ç½®ã€‚

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
å…¬å¸å¼€å‘ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼š

å¼€å‘ç¯å¢ƒ(dev)ï¼š
â”œâ”€â”€ æ•°æ®åº“ï¼šæœ¬åœ°MySQL
â”œâ”€â”€ æ”¯ä»˜ï¼šæµ‹è¯•è´¦å·
â””â”€â”€ æ—¥å¿—ï¼šè¯¦ç»†DEBUGçº§åˆ«

æµ‹è¯•ç¯å¢ƒ(test)ï¼š
â”œâ”€â”€ æ•°æ®åº“ï¼šæµ‹è¯•æœåŠ¡å™¨
â”œâ”€â”€ æ”¯ä»˜ï¼šæ²™ç®±ç¯å¢ƒ
â””â”€â”€ æ—¥å¿—ï¼šINFOçº§åˆ«

ç”Ÿäº§ç¯å¢ƒ(prod)ï¼š
â”œâ”€â”€ æ•°æ®åº“ï¼šæ­£å¼æœåŠ¡å™¨é›†ç¾¤
â”œâ”€â”€ æ”¯ä»˜ï¼šçœŸå®æ”¯ä»˜æ¥å£
â””â”€â”€ æ—¥å¿—ï¼šWARNçº§åˆ«

Profileå°±æ˜¯å‘Šè¯‰Springï¼š"ç°åœ¨ç”¨å“ªå¥—é…ç½®ï¼"
```

### 2.2 Profileçš„å®šä¹‰æ–¹å¼


**æ–¹å¼1ï¼šä½¿ç”¨@Profileæ³¨è§£**

```java
// å¼€å‘ç¯å¢ƒçš„æ•°æ®æºé…ç½®
@Configuration
@Profile("dev")
public class DevDataSourceConfig {
    
    @Bean
    public DataSource dataSource() {
        // æœ¬åœ°æ•°æ®åº“é…ç½®
        return DataSourceBuilder.create()
            .url("jdbc:mysql://localhost:3306/dev_db")
            .username("root")
            .password("123456")
            .build();
    }
}

// ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æºé…ç½®
@Configuration
@Profile("prod")
public class ProdDataSourceConfig {
    
    @Bean
    public DataSource dataSource() {
        // ç”Ÿäº§æ•°æ®åº“é…ç½®
        return DataSourceBuilder.create()
            .url("jdbc:mysql://prod-server:3306/prod_db")
            .username("admin")
            .password("complex_password")
            .build();
    }
}
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼š
> - `@Profile("dev")` è¡¨ç¤ºè¿™ä¸ªé…ç½®ç±»åªåœ¨devç¯å¢ƒç”Ÿæ•ˆ
> - Springä¼šæ ¹æ®æ¿€æ´»çš„Profileå†³å®šåŠ è½½å“ªä¸ªé…ç½®
> - åŒä¸€ä¸ªBeanï¼Œä¸åŒç¯å¢ƒæœ‰ä¸åŒå®ç°

**æ–¹å¼2ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰**

```yaml
# application.yml
spring:
  profiles:
    active: dev  # æ¿€æ´»devç¯å¢ƒ

---
# devç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: dev
  datasource:
    url: jdbc:mysql://localhost:3306/dev_db
    username: root

---
# prodç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    url: jdbc:mysql://prod-server:3306/prod_db
    username: admin
```

### 2.3 Profileçš„ç»„åˆä½¿ç”¨


**å¤æ‚åœºæ™¯ï¼šå¤šProfileç»„åˆ**

```java
// åŒæ—¶æ”¯æŒå¤šä¸ªç¯å¢ƒ
@Profile({"dev", "test"})  // devæˆ–testç¯å¢ƒéƒ½ç”Ÿæ•ˆ
public class NonProdConfig { }

// æ’é™¤æŸä¸ªç¯å¢ƒ
@Profile("!prod")  // é™¤äº†prodï¼Œå…¶ä»–ç¯å¢ƒéƒ½ç”Ÿæ•ˆ
public class DebugConfig { }

// å¤æ‚ç»„åˆ
@Profile({"dev & debug"})  // devç¯å¢ƒä¸”debugæ¨¡å¼
public class DevDebugConfig { }
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```java
@Configuration
public class LogConfig {
    
    // å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†æ—¥å¿—
    @Bean
    @Profile("dev")
    public Logger devLogger() {
        Logger logger = LoggerFactory.getLogger("dev");
        logger.setLevel(Level.DEBUG);
        return logger;
    }
    
    // ç”Ÿäº§ç¯å¢ƒï¼šç®€æ´æ—¥å¿—
    @Bean
    @Profile("prod")
    public Logger prodLogger() {
        Logger logger = LoggerFactory.getLogger("prod");
        logger.setLevel(Level.WARN);
        return logger;
    }
}
```

### 2.4 Profileæ¿€æ´»æ–¹å¼


| æ¿€æ´»æ–¹å¼ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|---------|---------|------|
| **é…ç½®æ–‡ä»¶** | æœ€å¸¸ç”¨ï¼Œé¡¹ç›®é…ç½® | `spring.profiles.active=dev` |
| **å¯åŠ¨å‚æ•°** | éƒ¨ç½²æ—¶æŒ‡å®šç¯å¢ƒ | `java -jar app.jar --spring.profiles.active=prod` |
| **ç¯å¢ƒå˜é‡** | Docker/K8séƒ¨ç½² | `export SPRING_PROFILES_ACTIVE=test` |
| **ä»£ç æ¿€æ´»** | ç‰¹æ®Šåœºæ™¯ | `environment.setActiveProfiles("dev")` |

---

## 3. ğŸ“¦ PropertySourceå±æ€§æº


### 3.1 ä»€ä¹ˆæ˜¯PropertySource


**PropertySourceæœ¬è´¨**ï¼šä¸€ä¸ª**é…ç½®æ¥æº**ï¼Œå‘Šè¯‰Springä»å“ªé‡Œè¯»é…ç½®ã€‚

```
ç±»æ¯”ç†è§£ï¼š
ä½ è¦æŸ¥æ‰¾ä¸€ä¸ªäººçš„ä¿¡æ¯ï¼Œå¯ä»¥ä»å¤šä¸ªæ¸ é“ï¼š
ğŸ“± æ‰‹æœºé€šè®¯å½•
ğŸ’» å…¬å¸é‚®ç®±
ğŸ“‹ èŠ±åå†Œ
ğŸ—‚ï¸ æ¡£æ¡ˆå®¤

PropertySourceå°±æ˜¯è¿™äº›"ä¿¡æ¯æ¸ é“"ï¼ŒSpringä»è¿™äº›åœ°æ–¹è¯»å–é…ç½®ï¼š
ğŸ“„ application.properties
ğŸ“„ application.yml
ğŸŒ ç³»ç»Ÿç¯å¢ƒå˜é‡
âš™ï¸ JVMç³»ç»Ÿå±æ€§
â˜ï¸ é…ç½®ä¸­å¿ƒï¼ˆNacosã€Apolloç­‰ï¼‰
```

### 3.2 Springé»˜è®¤çš„PropertySource


**Spring Bootè‡ªåŠ¨åŠ è½½çš„å±æ€§æºï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰**ï¼š

```
ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š
    â†“
1. å‘½ä»¤è¡Œå‚æ•°
   java -jar app.jar --server.port=8081
    â†“
2. ç³»ç»Ÿç¯å¢ƒå˜é‡
   export SERVER_PORT=8082
    â†“
3. application-{profile}.properties
   application-prod.properties
    â†“
4. application.properties
   é»˜è®¤é…ç½®æ–‡ä»¶
    â†“
5. @PropertySourceæŒ‡å®šçš„æ–‡ä»¶
   è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
```

> âš ï¸ **é‡è¦è§„åˆ™**ï¼š
> ä¼˜å…ˆçº§é«˜çš„é…ç½®ä¼š**è¦†ç›–**ä¼˜å…ˆçº§ä½çš„é…ç½®

### 3.3 è‡ªå®šä¹‰PropertySource


**ä½¿ç”¨@PropertySourceåŠ è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶**ï¼š

```java
// è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼šcustom.properties
// database.url=jdbc:mysql://custom-db:3306/mydb
// database.timeout=30

@Configuration
@PropertySource("classpath:custom.properties")  // åŠ è½½è‡ªå®šä¹‰é…ç½®
public class CustomConfig {
    
    @Autowired
    private Environment env;
    
    @Bean
    public DataSource customDataSource() {
        String url = env.getProperty("database.url");
        Integer timeout = env.getProperty("database.timeout", Integer.class);
        
        // ä½¿ç”¨è‡ªå®šä¹‰é…ç½®åˆ›å»ºæ•°æ®æº...
        return createDataSource(url, timeout);
    }
}
```

**åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶**ï¼š

```java
@Configuration
@PropertySource({
    "classpath:db.properties",      // æ•°æ®åº“é…ç½®
    "classpath:redis.properties",   // Redisé…ç½®
    "classpath:mq.properties"       // æ¶ˆæ¯é˜Ÿåˆ—é…ç½®
})
public class MultipleSourceConfig { }
```

### 3.4 ç¼–ç¨‹æ–¹å¼æ·»åŠ PropertySource


**åŠ¨æ€æ·»åŠ é…ç½®æºï¼ˆé«˜çº§ç”¨æ³•ï¼‰**ï¼š

```java
@Component
public class DynamicPropertyLoader implements ApplicationContextAware {
    
    @Override
    public void setApplicationContext(ApplicationContext ctx) {
        ConfigurableEnvironment env = (ConfigurableEnvironment) ctx.getEnvironment();
        
        // åˆ›å»ºè‡ªå®šä¹‰å±æ€§æº
        Map<String, Object> props = new HashMap<>();
        props.put("custom.key", "custom.value");
        
        PropertySource<?> customSource = new MapPropertySource("customSource", props);
        
        // æ·»åŠ åˆ°Environmentï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
        env.getPropertySources().addFirst(customSource);
    }
}
```

---

## 4. ğŸ† é…ç½®ä¼˜å…ˆçº§æœºåˆ¶


### 4.1 ä¼˜å…ˆçº§è§„åˆ™è¯¦è§£


**Springé…ç½®ä¼˜å…ˆçº§å®Œæ•´åˆ—è¡¨ï¼ˆç”±é«˜åˆ°ä½ï¼‰**ï¼š

```
ã€é«˜ä¼˜å…ˆçº§ã€‘
    â†“
1ï¸âƒ£ å‘½ä»¤è¡Œå‚æ•°
   --server.port=8080
   
2ï¸âƒ£ SPRING_APPLICATION_JSONç¯å¢ƒå˜é‡
   {"server.port":8080}
   
3ï¸âƒ£ ServletConfigåˆå§‹åŒ–å‚æ•°
   Webåº”ç”¨çš„é…ç½®
   
4ï¸âƒ£ ServletContextåˆå§‹åŒ–å‚æ•°
   Webå®¹å™¨é…ç½®
   
5ï¸âƒ£ JNDIå±æ€§
   java:comp/env
   
6ï¸âƒ£ ç³»ç»Ÿå±æ€§
   System.getProperties()
   
7ï¸âƒ£ æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡
   export SERVER_PORT=8080
   
8ï¸âƒ£ application-{profile}.properties
   ç‰¹å®šç¯å¢ƒé…ç½®æ–‡ä»¶
   
9ï¸âƒ£ application.properties
   é»˜è®¤é…ç½®æ–‡ä»¶
   
ğŸ”Ÿ @PropertySourceæ³¨è§£
   è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
    â†“
ã€ä½ä¼˜å…ˆçº§ã€‘
```

### 4.2 ä¼˜å…ˆçº§å®æˆ˜ç¤ºä¾‹


**åœºæ™¯ï¼šå¤šå¤„å®šä¹‰åŒä¸€ä¸ªé…ç½®**

```properties
# 1. application.propertiesï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰
server.port=8080

# 2. application-dev.propertiesï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
server.port=8081

# 3. å‘½ä»¤è¡Œå‚æ•°ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
java -jar app.jar --server.port=8082
```

**æœ€ç»ˆç»“æœ**ï¼šåº”ç”¨å¯åŠ¨åœ¨ `8082` ç«¯å£ï¼ˆå‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§æœ€é«˜ï¼‰

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼š
> - **è¶Šå…·ä½“çš„é…ç½®ï¼Œä¼˜å…ˆçº§è¶Šé«˜**
> - å‘½ä»¤è¡Œ > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶
> - ç‰¹å®šç¯å¢ƒ > é€šç”¨é…ç½®

### 4.3 é…ç½®è¦†ç›–ç­–ç•¥


**ç†è§£é…ç½®è¦†ç›–**ï¼š

```java
@Configuration
public class PortConfig {
    
    @Autowired
    private Environment env;
    
    public void checkPort() {
        // Springä¼šæŒ‰ä¼˜å…ˆçº§æŸ¥æ‰¾ï¼Œæ‰¾åˆ°å°±è¿”å›
        String port = env.getProperty("server.port");
        
        /*
         * æŸ¥æ‰¾é¡ºåºï¼š
         * 1. å…ˆæŸ¥å‘½ä»¤è¡Œå‚æ•° --server.port
         * 2. å†æŸ¥ç¯å¢ƒå˜é‡ SERVER_PORT
         * 3. ç„¶åæŸ¥ application-{profile}.properties
         * 4. æœ€åæŸ¥ application.properties
         * 
         * æ‰¾åˆ°ä»»ä½•ä¸€ä¸ªå°±åœæ­¢ï¼Œä¸å†å¾€ä¸‹æ‰¾ï¼
         */
    }
}
```

**éƒ¨åˆ†è¦†ç›–ç¤ºä¾‹**ï¼š

```yaml
# application.ymlï¼ˆåŸºç¡€é…ç½®ï¼‰
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/db
    username: root
    password: 123456
    
# application-prod.ymlï¼ˆåªè¦†ç›–éƒ¨åˆ†é…ç½®ï¼‰
spring:
  datasource:
    url: jdbc:mysql://prod-server:3306/db  # åªæ”¹URL
    # usernameå’Œpasswordç»§ç»­ç”¨åŸºç¡€é…ç½®çš„å€¼
```

---

## 5. ğŸš€ ç¯å¢ƒæ¿€æ´»ç­–ç•¥


### 5.1 Profileæ¿€æ´»çš„4ç§æ–¹å¼


**æ–¹å¼å¯¹æ¯”è¡¨**ï¼š

| æ¿€æ´»æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜å…ˆçº§ | çµæ´»æ€§ |
|---------|---------|-------|-------|
| **é…ç½®æ–‡ä»¶** | é¡¹ç›®é»˜è®¤ç¯å¢ƒ | â˜…â˜…â˜†â˜†â˜† | â˜…â˜…â˜†â˜†â˜† |
| **å¯åŠ¨å‚æ•°** | éƒ¨ç½²æ—¶åˆ‡æ¢ | â˜…â˜…â˜…â˜…â˜† | â˜…â˜…â˜…â˜…â˜† |
| **ç¯å¢ƒå˜é‡** | å®¹å™¨åŒ–éƒ¨ç½² | â˜…â˜…â˜…â˜…â˜… | â˜…â˜…â˜…â˜…â˜… |
| **ä»£ç æ¿€æ´»** | æµ‹è¯•/ç‰¹æ®Šåœºæ™¯ | â˜…â˜…â˜…â˜†â˜† | â˜…â˜…â˜†â˜†â˜† |

### 5.2 é…ç½®æ–‡ä»¶æ¿€æ´»


```yaml
# application.yml
spring:
  profiles:
    active: dev  # æ¿€æ´»devç¯å¢ƒ
```

```properties
# application.properties
spring.profiles.active=dev
```

> ğŸ“Œ **ä½¿ç”¨å»ºè®®**ï¼š
> å¼€å‘é˜¶æ®µåœ¨é…ç½®æ–‡ä»¶å†™æ­»devï¼Œéƒ¨ç½²æ—¶ç”¨å¯åŠ¨å‚æ•°è¦†ç›–

### 5.3 å¯åŠ¨å‚æ•°æ¿€æ´»


```bash
# æ–¹å¼1ï¼šjaråŒ…å¯åŠ¨
java -jar myapp.jar --spring.profiles.active=prod

# æ–¹å¼2ï¼šSpring Boot Mavenæ’ä»¶
mvn spring-boot:run -Dspring-boot.run.profiles=test

# æ–¹å¼3ï¼šIDEAå¯åŠ¨é…ç½®
VM options: -Dspring.profiles.active=dev
```

### 5.4 ç¯å¢ƒå˜é‡æ¿€æ´»


```bash
# Linux/Mac
export SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar

# Windows
set SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar

# Dockerå®¹å™¨
docker run -e SPRING_PROFILES_ACTIVE=prod myapp:latest

# Kubernetes
env:
  - name: SPRING_PROFILES_ACTIVE
    value: "prod"
```

### 5.5 ä»£ç æ¿€æ´»Profile


```java
// æµ‹è¯•åœºæ™¯ï¼šæŒ‡å®šæµ‹è¯•ç¯å¢ƒ
@SpringBootTest
@ActiveProfiles("test")  // æ¿€æ´»testç¯å¢ƒ
public class MyServiceTest {
    // æµ‹è¯•ä»£ç ...
}

// å¯åŠ¨ç±»æ‰‹åŠ¨æ¿€æ´»
public class Application {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(Application.class);
        app.setAdditionalProfiles("dev");  // é¢å¤–æ¿€æ´»dev
        app.run(args);
    }
}
```

### 5.6 å¤šç¯å¢ƒæ¿€æ´»


**åŒæ—¶æ¿€æ´»å¤šä¸ªProfile**ï¼š

```yaml
spring:
  profiles:
    active: dev, debug, local  # æ¿€æ´»å¤šä¸ªç¯å¢ƒ
```

```bash
# å¯åŠ¨å‚æ•°æ¿€æ´»å¤šä¸ª
java -jar app.jar --spring.profiles.active=dev,debug
```

**åº”ç”¨åœºæ™¯**ï¼š

```java
@Configuration
@Profile("dev")  // devç¯å¢ƒç”Ÿæ•ˆ
public class DevConfig { }

@Configuration
@Profile("debug")  // debugæ¨¡å¼ç”Ÿæ•ˆ
public class DebugConfig { }

// å¯åŠ¨æ—¶åŒæ—¶æ¿€æ´»devå’Œdebug
// ä¸¤ä¸ªé…ç½®ç±»éƒ½ä¼šç”Ÿæ•ˆï¼
```

---

## 6. ğŸ” å±æ€§è§£æå®æˆ˜


### 6.1 åŸºæœ¬å±æ€§è¯»å–


```java
@Component
public class ConfigReader {
    
    @Autowired
    private Environment env;
    
    public void readProperties() {
        // è¯»å–å­—ç¬¦ä¸²å±æ€§
        String appName = env.getProperty("spring.application.name");
        
        // è¯»å–æ•°å­—å±æ€§ï¼ˆè‡ªåŠ¨è½¬æ¢ç±»å‹ï¼‰
        Integer port = env.getProperty("server.port", Integer.class);
        
        // æä¾›é»˜è®¤å€¼
        String timeout = env.getProperty("app.timeout", "30");
        
        // è¯»å–å¸ƒå°”å€¼
        Boolean debugMode = env.getProperty("app.debug", Boolean.class);
    }
}
```

### 6.2 ç±»å‹å®‰å…¨çš„å±æ€§è¯»å–


```java
@Component
public class TypeSafeConfig {
    
    @Autowired
    private Environment env;
    
    public void readTypedProperties() {
        // Stringç±»å‹
        String name = env.getProperty("app.name", String.class);
        
        // Integerç±»å‹
        Integer maxSize = env.getProperty("app.max-size", Integer.class, 100);
        
        // Longç±»å‹
        Long timeout = env.getProperty("app.timeout", Long.class);
        
        // Booleanç±»å‹
        Boolean enabled = env.getProperty("app.enabled", Boolean.class, false);
        
        // Doubleç±»å‹
        Double rate = env.getProperty("app.rate", Double.class);
    }
}
```

### 6.3 å±æ€§å ä½ç¬¦è§£æ


**ä½¿ç”¨${}å¼•ç”¨å…¶ä»–å±æ€§**ï¼š

```properties
# application.properties
app.name=MyApp
app.version=1.0.0

# ä½¿ç”¨å ä½ç¬¦ç»„åˆ
app.display=${app.name} v${app.version}
# ç»“æœï¼šMyApp v1.0.0

# åµŒå¥—å ä½ç¬¦
server.url=http://${server.host}:${server.port}
server.host=localhost
server.port=8080
# ç»“æœï¼šhttp://localhost:8080
```

**ä»£ç ä¸­è§£æå ä½ç¬¦**ï¼š

```java
@Component
public class PlaceholderResolver {
    
    @Autowired
    private Environment env;
    
    public void resolvePlaceholder() {
        // ç›´æ¥è¯»å–åŒ…å«å ä½ç¬¦çš„å€¼
        String display = env.getProperty("app.display");
        // è‡ªåŠ¨è§£æä¸ºï¼šMyApp v1.0.0
        
        String url = env.getProperty("server.url");
        // è‡ªåŠ¨è§£æä¸ºï¼šhttp://localhost:8080
    }
}
```

### 6.4 è·å–æ‰€æœ‰å±æ€§


```java
@Component
public class AllPropertiesReader {
    
    @Autowired
    private Environment env;
    
    public void printAllProperties() {
        // è½¬æ¢ä¸ºConfigurableEnvironment
        if (env instanceof ConfigurableEnvironment) {
            ConfigurableEnvironment cenv = (ConfigurableEnvironment) env;
            
            // éå†æ‰€æœ‰PropertySource
            for (PropertySource<?> ps : cenv.getPropertySources()) {
                System.out.println("PropertySource: " + ps.getName());
                
                if (ps instanceof EnumerablePropertySource) {
                    EnumerablePropertySource eps = (EnumerablePropertySource) ps;
                    
                    // æ‰“å°æ‰€æœ‰å±æ€§å
                    for (String name : eps.getPropertyNames()) {
                        System.out.println(name + " = " + env.getProperty(name));
                    }
                }
            }
        }
    }
}
```

### 6.5 å±æ€§éªŒè¯


**æ£€æŸ¥å¿…éœ€å±æ€§**ï¼š

```java
@Component
public class RequiredPropertiesChecker implements InitializingBean {
    
    @Autowired
    private Environment env;
    
    @Override
    public void afterPropertiesSet() {
        // æ£€æŸ¥å¿…éœ€å±æ€§æ˜¯å¦å­˜åœ¨
        requireProperty("spring.datasource.url");
        requireProperty("spring.datasource.username");
    }
    
    private void requireProperty(String key) {
        if (!env.containsProperty(key)) {
            throw new IllegalStateException("å¿…éœ€å±æ€§ç¼ºå¤±: " + key);
        }
    }
}
```

### 6.6 å®æˆ˜æ¡ˆä¾‹ï¼šå¤šæ•°æ®æºé…ç½®


```java
@Configuration
public class MultiDataSourceConfig {
    
    @Autowired
    private Environment env;
    
    // ä¸»æ•°æ®æº
    @Bean
    @Primary
    public DataSource primaryDataSource() {
        return DataSourceBuilder.create()
            .url(env.getProperty("spring.datasource.primary.url"))
            .username(env.getProperty("spring.datasource.primary.username"))
            .password(env.getProperty("spring.datasource.primary.password"))
            .build();
    }
    
    // ä»æ•°æ®æº
    @Bean
    public DataSource secondaryDataSource() {
        return DataSourceBuilder.create()
            .url(env.getProperty("spring.datasource.secondary.url"))
            .username(env.getProperty("spring.datasource.secondary.username"))
            .password(env.getProperty("spring.datasource.secondary.password"))
            .build();
    }
}
```

```yaml
# application.yml
spring:
  datasource:
    primary:
      url: jdbc:mysql://localhost:3306/primary_db
      username: root
      password: 123456
    secondary:
      url: jdbc:mysql://localhost:3306/secondary_db
      username: root
      password: 123456
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Environmentæ¥å£ï¼šSpringçš„ç¯å¢ƒç®¡å®¶ï¼Œç®¡ç†Profileå’ŒProperties
ğŸ”¸ Profileæœºåˆ¶ï¼šç»™é…ç½®è´´æ ‡ç­¾ï¼Œä¸åŒç¯å¢ƒç”¨ä¸åŒé…ç½®
ğŸ”¸ PropertySourceï¼šé…ç½®æ¥æºï¼Œå‘Šè¯‰Springä»å“ªè¯»é…ç½®
ğŸ”¸ é…ç½®ä¼˜å…ˆçº§ï¼šè¶Šå…·ä½“çš„é…ç½®ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆå‘½ä»¤è¡Œ > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ï¼‰
ğŸ”¸ ç¯å¢ƒæ¿€æ´»ï¼š4ç§æ–¹å¼æ¿€æ´»Profileï¼ˆé…ç½®æ–‡ä»¶ã€å¯åŠ¨å‚æ•°ã€ç¯å¢ƒå˜é‡ã€ä»£ç ï¼‰
ğŸ”¸ å±æ€§è§£æï¼šç±»å‹å®‰å…¨è¯»å–ã€å ä½ç¬¦è§£æã€å±æ€§éªŒè¯
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


> ğŸ’¡ **Environmentæœ¬è´¨ç†è§£**
> 
> Environmentå°±åƒä¸€ä¸ª"é…ç½®è¶…å¸‚"ï¼š
> - Profileæ˜¯ä¸åŒçš„"è´§æ¶åŒºåŸŸ"ï¼ˆç”Ÿé²œåŒºã€é›¶é£ŸåŒºï¼‰
> - PropertySourceæ˜¯ä¸åŒçš„"ä¾›è´§æ¸ é“"ï¼ˆæœ¬åœ°ä»“åº“ã€äº‘ä»“åº“ï¼‰
> - ä¼˜å…ˆçº§æ˜¯"è´­ä¹°é¡ºåº"ï¼ˆå…ˆçœ‹ä¿ƒé”€å“ï¼Œå†çœ‹æ­£ä»·å•†å“ï¼‰
> - å±æ€§è§£ææ˜¯"æ‰«ç å–è´§"ï¼ˆæ ¹æ®å•†å“ç¼–ç å–å‡ºå•†å“ï¼‰

> âš ï¸ **é…ç½®ä¼˜å…ˆçº§é™·é˜±**
> 
> æ–°æ‰‹å¸¸è§é”™è¯¯ï¼š
> âŒ é…ç½®æ–‡ä»¶æ”¹äº†ï¼Œä½†å¯åŠ¨å‚æ•°è¦†ç›–äº†ï¼Œé…ç½®ä¸ç”Ÿæ•ˆ
> âŒ å¿˜è®°æ¿€æ´»Profileï¼Œå¯¼è‡´é…ç½®ç±»ä¸åŠ è½½
> âŒ å¤šä¸ªPropertySourceéƒ½æœ‰åŒåå±æ€§ï¼Œä¸çŸ¥é“ç”¨å“ªä¸ª
> 
> è§£å†³æ–¹æ¡ˆï¼š
> âœ… ç†è§£ä¼˜å…ˆçº§è§„åˆ™ï¼šå‘½ä»¤è¡Œ > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶
> âœ… å¯åŠ¨æ—¶æ£€æŸ¥æ¿€æ´»çš„Profileï¼š`env.getActiveProfiles()`
> âœ… ä½¿ç”¨`@ConditionalOnProperty`æ˜ç¡®é…ç½®ä¾èµ–

### 7.3 æœ€ä½³å®è·µå»ºè®®


**å¼€å‘é˜¶æ®µ**ï¼š
- âœ… æœ¬åœ°ç”¨`application-dev.yml`é…ç½®
- âœ… æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ï¼‰ä¸å†™åœ¨é…ç½®æ–‡ä»¶ï¼Œç”¨ç¯å¢ƒå˜é‡
- âœ… ä½¿ç”¨`@Profile`éš”ç¦»ä¸åŒç¯å¢ƒçš„Bean

**éƒ¨ç½²é˜¶æ®µ**ï¼š
- âœ… ç”¨å¯åŠ¨å‚æ•°æ¿€æ´»ç¯å¢ƒï¼š`--spring.profiles.active=prod`
- âœ… ç”¨ç¯å¢ƒå˜é‡ä¼ é€’æ•æ„Ÿé…ç½®
- âœ… åšå¥½é…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬ç®¡ç†

**ä»£ç è§„èŒƒ**ï¼š
- âœ… ç»Ÿä¸€ä½¿ç”¨Environmentè¯»å–é…ç½®
- âœ… é…ç½®é¡¹è¦æœ‰é»˜è®¤å€¼
- âœ… å¯åŠ¨æ—¶éªŒè¯å¿…éœ€é…ç½®

### 7.4 å®é™…åº”ç”¨åœºæ™¯æ€»ç»“


| åœºæ™¯ | ä½¿ç”¨çš„æŠ€æœ¯ | ç¤ºä¾‹ |
|-----|----------|------|
| **å¤šç¯å¢ƒéƒ¨ç½²** | Profile | dev/test/prodç¯å¢ƒé…ç½® |
| **è¯»å–é…ç½®** | Environment.getProperty() | è¯»å–æ•°æ®åº“è¿æ¥ä¿¡æ¯ |
| **è‡ªå®šä¹‰é…ç½®** | @PropertySource | åŠ è½½custom.properties |
| **ä¼˜å…ˆçº§è¦†ç›–** | å¯åŠ¨å‚æ•° | ç”Ÿäº§ç¯å¢ƒè¦†ç›–ç«¯å£å· |
| **åŠ¨æ€é…ç½®** | ConfigurableEnvironment | è¿è¡Œæ—¶æ·»åŠ PropertySource |
| **é…ç½®éªŒè¯** | InitializingBean | å¯åŠ¨æ—¶æ£€æŸ¥å¿…éœ€é…ç½® |

### 7.5 è¿›é˜¶å­¦ä¹ æ–¹å‘


```
ğŸ“š åç»­æ·±å…¥ä¸»é¢˜ï¼š

1. é…ç½®ä¸­å¿ƒé›†æˆ
   â†’ Nacosã€Apolloé…ç½®ä¸­å¿ƒ
   â†’ åŠ¨æ€åˆ·æ–°é…ç½®
   
2. é…ç½®åŠ å¯†
   â†’ JasyptåŠ å¯†æ•æ„Ÿé…ç½®
   â†’ Spring Cloud ConfigåŠ å¯†ä¼ è¾“

3. é…ç½®ç›‘æ§
   â†’ Actuatoræš´éœ²é…ç½®ä¿¡æ¯
   â†’ é…ç½®å˜æ›´å®¡è®¡
   
4. é«˜çº§ç‰¹æ€§
   â†’ æ¡ä»¶åŒ–é…ç½®ï¼š@ConditionalOnProperty
   â†’ é…ç½®ç»‘å®šï¼š@ConfigurationProperties
   â†’ å¤–éƒ¨åŒ–é…ç½®ï¼šSpring Cloud Config
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Environmentç¯å¢ƒç®¡ï¼ŒProfileåˆ†ç¯å¢ƒï¼›
PropertySourceé…ç½®æºï¼Œä¼˜å…ˆçº§è¦åˆ†æ¸…ï¼›
å‘½ä»¤è¡Œæœ€ä¼˜å…ˆï¼Œé…ç½®æ–‡ä»¶å«åº•å±‚ï¼›
æ¿€æ´»æœ‰å››æ³•ï¼Œè¯»å–ç±»å‹æ˜ï¼›
å®æˆ˜å¤šç»ƒä¹ ï¼ŒåŸç†è®°å¿ƒä¸­ï¼
```

---

## ğŸ“– å­¦ä¹ æ£€æŸ¥æ¸…å•


**åŸºç¡€çŸ¥è¯†ï¼ˆå¿…é¡»æŒæ¡ï¼‰**ï¼š
- [ ] ç†è§£Environmentæ¥å£çš„ä¸¤å¤§èŒè´£
- [ ] æŒæ¡Profileçš„å®šä¹‰å’Œæ¿€æ´»
- [ ] äº†è§£PropertySourceçš„ä½œç”¨
- [ ] è®°ä½é…ç½®ä¼˜å…ˆçº§è§„åˆ™

**å®è·µæŠ€èƒ½ï¼ˆé‡ç‚¹ç»ƒä¹ ï¼‰**ï¼š
- [ ] èƒ½ç”¨Environmentè¯»å–å„ç§ç±»å‹é…ç½®
- [ ] ä¼šå®šä¹‰ä¸åŒç¯å¢ƒçš„Profileé…ç½®ç±»
- [ ] èƒ½ç”¨4ç§æ–¹å¼æ¿€æ´»Profile
- [ ] ä¼šè‡ªå®šä¹‰PropertySourceåŠ è½½é…ç½®

**è¿›é˜¶èƒ½åŠ›ï¼ˆåŠ åˆ†é¡¹ï¼‰**ï¼š
- [ ] ç†è§£é…ç½®è¦†ç›–çš„åº•å±‚åŸç†
- [ ] èƒ½ç¼–ç¨‹å¼æ“ä½œEnvironment
- [ ] æŒæ¡å¤šæ•°æ®æºç­‰å¤æ‚é…ç½®åœºæ™¯

---

> ğŸ¯ **å­¦ä¹ å»ºè®®**
> 
> 1. **å…ˆç†è§£æ¦‚å¿µ**ï¼šEnvironmentã€Profileã€PropertySourceæ˜¯ä»€ä¹ˆ
> 2. **å†çœ‹ä»£ç ç¤ºä¾‹**ï¼šå¯¹ç…§ç€å†™ä¸€é
> 3. **æœ€åå®æˆ˜ç»ƒä¹ **ï¼šæ­ä¸ªå¤šç¯å¢ƒé¡¹ç›®è¯•è¯•
> 4. **é‡åˆ°é—®é¢˜å°±Debug**ï¼šçœ‹çœ‹ä¼˜å…ˆçº§ã€çœ‹çœ‹æ¿€æ´»çš„Profile
> 
> è®°ä½ï¼š**å®è·µå‡ºçœŸçŸ¥ï¼Œå¤šå†™å¤šè¯•å°±æ‡‚äº†ï¼**