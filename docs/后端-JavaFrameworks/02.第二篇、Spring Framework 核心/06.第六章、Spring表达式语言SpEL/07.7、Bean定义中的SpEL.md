---
title: 7ã€Beanå®šä¹‰ä¸­çš„SpEL
---
## ğŸ“š ç›®å½•

1. [SpELåœ¨Beanå®šä¹‰ä¸­çš„ä½œç”¨](#1-spelåœ¨beanå®šä¹‰ä¸­çš„ä½œç”¨)
2. [@Valueæ³¨è§£ä½¿ç”¨SpEL](#2-valueæ³¨è§£ä½¿ç”¨spel)
3. [XMLé…ç½®ä¸­çš„SpEL](#3-xmlé…ç½®ä¸­çš„spel)
4. [å±æ€§æ³¨å…¥ä¸è¡¨è¾¾å¼](#4-å±æ€§æ³¨å…¥ä¸è¡¨è¾¾å¼)
5. [é»˜è®¤å€¼è®¾ç½®æŠ€å·§](#5-é»˜è®¤å€¼è®¾ç½®æŠ€å·§)
6. [Beanå¼•ç”¨è¡¨è¾¾å¼](#6-beanå¼•ç”¨è¡¨è¾¾å¼)
7. [æ¡ä»¶æ³¨å…¥ç­–ç•¥](#7-æ¡ä»¶æ³¨å…¥ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ SpELåœ¨Beanå®šä¹‰ä¸­çš„ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯Beanå®šä¹‰ä¸­çš„SpEL


**é€šä¿—ç†è§£**ï¼šå°±åƒç»™Springå®¹å™¨é‡Œçš„å¯¹è±¡"è¯´è¯"ä¸€æ ·ï¼Œå‘Šè¯‰å®ƒè¯¥ç”¨ä»€ä¹ˆå€¼

```
ä¼ ç»Ÿæ–¹å¼ï¼šå†™æ­»çš„å€¼
public class User {
    private String name = "å¼ ä¸‰";  // å›ºå®šå€¼ï¼Œä¸çµæ´»
}

SpELæ–¹å¼ï¼šåŠ¨æ€å–å€¼
@Value("#{systemProperties['user.name']}")  // ä»ç³»ç»Ÿå±æ€§å–å€¼
private String name;
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **åŠ¨æ€å–å€¼**ï¼šä¸å†™æ­»å€¼ï¼Œè¿è¡Œæ—¶æ‰å†³å®šç”¨ä»€ä¹ˆ
- ğŸ”¸ **çµæ´»é…ç½®**ï¼šä»é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ç­‰å¤šå¤„å–å€¼
- ğŸ”¸ **è¡¨è¾¾å¼è®¡ç®—**ï¼šå¯ä»¥åšè¿ç®—ã€é€»è¾‘åˆ¤æ–­
- ğŸ”¸ **Beanäº’ç›¸å¼•ç”¨**ï¼šè®©Beanä¹‹é—´èƒ½è®¿é—®å½¼æ­¤çš„å±æ€§

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦SpEL


**å®é™…åœºæ™¯ç†è§£**ï¼š

```
åœºæ™¯1ï¼šå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒç”¨ä¸åŒçš„æ•°æ®åº“
@Value("#{environment['db.url']}")  // è‡ªåŠ¨æ ¹æ®ç¯å¢ƒåˆ‡æ¢
private String dbUrl;

åœºæ™¯2ï¼šæ ¹æ®é…ç½®æ–‡ä»¶åŠ¨æ€è®¾ç½®è¶…æ—¶æ—¶é—´
@Value("#{configBean.timeout * 1000}")  // é…ç½®æ˜¯ç§’ï¼Œè½¬æˆæ¯«ç§’
private int timeout;

åœºæ™¯3ï¼šæœ‰é»˜è®¤å€¼çš„é…ç½®
@Value("#{config.maxSize ?: 100}")  // å¦‚æœæ²¡é…ç½®å°±ç”¨100
private int maxSize;
```

### 1.3 SpELçš„ä½¿ç”¨ä½ç½®


**Beanå®šä¹‰çš„ä¸‰ä¸ªåœ°æ–¹**ï¼š

```
ä½ç½®ç¤ºæ„ï¼š

1. æ³¨è§£æ–¹å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰
   @Component
   public class UserService {
       @Value("#{...}")  â† è¿™é‡Œç”¨SpEL
       private String value;
   }

2. XMLé…ç½®æ–¹å¼
   <bean id="user" class="User">
       <property name="name" value="#{...}"/>  â† è¿™é‡Œç”¨SpEL
   </bean>

3. Javaé…ç½®æ–¹å¼
   @Configuration
   public class Config {
       @Bean
       public User user(@Value("#{...}") String name) {  â† è¿™é‡Œç”¨SpEL
           return new User(name);
       }
   }
```

---

## 2. ğŸ’‰ @Valueæ³¨è§£ä½¿ç”¨SpEL


### 2.1 @Valueæ³¨è§£åŸºç¡€


**æ³¨è§£ä½œç”¨**ï¼šåœ¨Beançš„å±æ€§ã€æ„é€ å‡½æ•°ã€æ–¹æ³•å‚æ•°ä¸Šæ³¨å…¥å€¼

```java
@Component
public class AppConfig {
    
    // ğŸ”¸ å±æ€§æ³¨å…¥ï¼ˆæœ€å¸¸è§ï¼‰
    @Value("#{systemProperties['java.home']}")
    private String javaHome;
    
    // ğŸ”¸ æ„é€ å‡½æ•°æ³¨å…¥
    public AppConfig(@Value("#{config.appName}") String appName) {
        this.appName = appName;
    }
    
    // ğŸ”¸ Setteræ–¹æ³•æ³¨å…¥
    @Value("#{config.version}")
    public void setVersion(String version) {
        this.version = version;
    }
}
```

### 2.2 @Valueçš„è¡¨è¾¾å¼ç±»å‹


**ä¸‰ç§å–å€¼æ–¹å¼å¯¹æ¯”**ï¼š

| æ–¹å¼ | è¯­æ³•ç¤ºä¾‹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|---------|------|---------|
| **å­—é¢é‡** | `@Value("å¼ ä¸‰")` | ç›´æ¥å†™å›ºå®šå€¼ | ğŸŸ¢ æµ‹è¯•ã€æ¼”ç¤º |
| **å±æ€§å ä½ç¬¦** | `@Value("${app.name}")` | ä»é…ç½®æ–‡ä»¶å–å€¼ | ğŸŸ¡ é…ç½®é¡¹ |
| **SpELè¡¨è¾¾å¼** | `@Value("#{config.name}")` | åŠ¨æ€è®¡ç®—æˆ–å¼•ç”¨Bean | ğŸ”´ å¤æ‚é€»è¾‘ |

**è¯¦ç»†ç¤ºä¾‹**ï¼š

```java
@Component
public class DemoBean {
    
    // â‘  å­—é¢é‡ï¼šç›´æ¥å†™å€¼
    @Value("Hello World")
    private String message;
    
    // â‘¡ å±æ€§å ä½ç¬¦ï¼šä»application.propertiesè¯»å–
    @Value("${server.port}")
    private int port;
    
    // â‘¢ SpELè¡¨è¾¾å¼ï¼šå¼•ç”¨å…¶ä»–Bean
    @Value("#{userService.currentUser.name}")
    private String userName;
    
    // â‘£ æ··åˆä½¿ç”¨ï¼šSpEL + å±æ€§å ä½ç¬¦
    @Value("#{'${app.name}'.toUpperCase()}")
    private String appName;  // æŠŠé…ç½®å€¼è½¬å¤§å†™
}
```

### 2.3 å¸¸ç”¨SpELè¡¨è¾¾å¼å†™æ³•


**å®ç”¨è¡¨è¾¾å¼ç¤ºä¾‹**ï¼š

```java
@Component
public class SpELDemo {
    
    // ğŸ”¸ è®¿é—®ç³»ç»Ÿå±æ€§
    @Value("#{systemProperties['user.home']}")
    private String userHome;  // è·å–ç”¨æˆ·ä¸»ç›®å½•
    
    // ğŸ”¸ è®¿é—®ç¯å¢ƒå˜é‡
    @Value("#{systemEnvironment['PATH']}")
    private String envPath;
    
    // ğŸ”¸ è°ƒç”¨é™æ€æ–¹æ³•
    @Value("#{T(java.lang.Math).random()}")
    private double randomValue;  // ç”Ÿæˆéšæœºæ•°
    
    // ğŸ”¸ å­—ç¬¦ä¸²æ“ä½œ
    @Value("#{'hello'.concat(' world').toUpperCase()}")
    private String greeting;  // ç»“æœï¼šHELLO WORLD
    
    // ğŸ”¸ æ•°å­¦è¿ç®—
    @Value("#{config.timeout * 1000}")
    private long timeoutMs;  // ç§’è½¬æ¯«ç§’
    
    // ğŸ”¸ é€»è¾‘åˆ¤æ–­
    @Value("#{config.enabled ? 'ON' : 'OFF'}")
    private String status;  // ä¸‰å…ƒè¿ç®—ç¬¦
}
```

---

## 3. ğŸ“„ XMLé…ç½®ä¸­çš„SpEL


### 3.1 XMLä¸­ä½¿ç”¨SpELçš„è¯­æ³•


**åŸºæœ¬æ ¼å¼**ï¼šåœ¨XMLé…ç½®ä¸­ç”¨ `#{}` åŒ…è£¹è¡¨è¾¾å¼

```xml
<!-- Spring XMLé…ç½®æ–‡ä»¶ -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="...">
    
    <!-- â‘  ç®€å•å±æ€§æ³¨å…¥ -->
    <bean id="user" class="com.example.User">
        <property name="age" value="#{25}"/>
        <property name="name" value="#{'å¼ ä¸‰'}"/>
    </bean>
    
    <!-- â‘¡ å¼•ç”¨å…¶ä»–Beançš„å±æ€§ -->
    <bean id="order" class="com.example.Order">
        <property name="userName" value="#{user.name}"/>
        <property name="userAge" value="#{user.age}"/>
    </bean>
    
    <!-- â‘¢ è¡¨è¾¾å¼è®¡ç®— -->
    <bean id="config" class="com.example.Config">
        <property name="timeout" value="#{config.baseTimeout * 2}"/>
        <property name="maxSize" value="#{T(java.lang.Math).max(100, config.size)}"/>
    </bean>
</beans>
```

### 3.2 XMLä¸æ³¨è§£æ–¹å¼å¯¹æ¯”


**åŒæ ·çš„åŠŸèƒ½ï¼Œä¸¤ç§å†™æ³•å¯¹æ¯”**ï¼š

```
åœºæ™¯ï¼šç»™Userå¯¹è±¡æ³¨å…¥é…ç½®çš„nameå€¼

æ–¹å¼1ï¼šXMLé…ç½®
<bean id="user" class="User">
    <property name="name" value="#{config.userName}"/>
</bean>

æ–¹å¼2ï¼šæ³¨è§£é…ç½®
@Component
public class User {
    @Value("#{config.userName}")
    private String name;
}

é€‰æ‹©å»ºè®®ï¼š
âœ… æ–°é¡¹ç›®ï¼šä¼˜å…ˆç”¨æ³¨è§£æ–¹å¼ï¼ˆç®€æ´ç›´è§‚ï¼‰
âœ… è€é¡¹ç›®ï¼šå¯èƒ½éœ€è¦ç»´æŠ¤XMLé…ç½®
âœ… å¤æ‚é…ç½®ï¼šæœ‰æ—¶XMLæ›´æ¸…æ™°
```

### 3.3 XMLä¸­çš„å¤æ‚è¡¨è¾¾å¼


```xml
<!-- å®é™…åº”ç”¨ç¤ºä¾‹ -->
<beans>
    <!-- åŸºç¡€é…ç½®Bean -->
    <bean id="appConfig" class="com.example.AppConfig">
        <property name="baseUrl" value="http://localhost:8080"/>
        <property name="timeout" value="30"/>
        <property name="enabled" value="true"/>
    </bean>
    
    <!-- ä½¿ç”¨SpELå¤„ç†é…ç½® -->
    <bean id="apiClient" class="com.example.ApiClient">
        <!-- å­—ç¬¦ä¸²æ‹¼æ¥ -->
        <property name="apiUrl" 
                  value="#{appConfig.baseUrl + '/api/v1'}"/>
        
        <!-- æ•°å€¼è®¡ç®— -->
        <property name="timeoutMs" 
                  value="#{appConfig.timeout * 1000}"/>
        
        <!-- æ¡ä»¶åˆ¤æ–­ -->
        <property name="retryCount" 
                  value="#{appConfig.enabled ? 3 : 0}"/>
        
        <!-- é›†åˆæ“ä½œ -->
        <property name="allowedPorts" 
                  value="#{T(java.util.Arrays).asList(8080, 8081, 8082)}"/>
    </bean>
</beans>
```

---

## 4. ğŸ”„ å±æ€§æ³¨å…¥ä¸è¡¨è¾¾å¼


### 4.1 å±æ€§æ³¨å…¥çš„æœ¬è´¨


**é€šä¿—è§£é‡Š**ï¼šå°±æ˜¯ç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼ï¼ŒSpELè®©è¿™ä¸ªèµ‹å€¼è¿‡ç¨‹æ›´çµæ´»

```
ä¼ ç»Ÿèµ‹å€¼ï¼š
User user = new User();
user.setName("å¼ ä¸‰");        // å†™æ­»çš„å€¼

SpELèµ‹å€¼ï¼š
@Value("#{config.defaultName}")
private String name;          // ä»é…ç½®å¯¹è±¡åŠ¨æ€è·å–
```

### 4.2 ä¸åŒç±»å‹å±æ€§çš„æ³¨å…¥


```java
@Component
public class PropertyDemo {
    
    // ğŸ”¸ åŸºæœ¬ç±»å‹
    @Value("#{100}")
    private int count;
    
    @Value("#{true}")
    private boolean enabled;
    
    @Value("#{3.14}")
    private double pi;
    
    // ğŸ”¸ å­—ç¬¦ä¸²ç±»å‹
    @Value("#{'Hello Spring'}")
    private String message;
    
    // ğŸ”¸ æ—¥æœŸç±»å‹ï¼ˆéœ€è¦è½¬æ¢ï¼‰
    @Value("#{T(java.time.LocalDate).parse('2024-01-20')}")
    private LocalDate date;
    
    // ğŸ”¸ é›†åˆç±»å‹
    @Value("#{T(java.util.Arrays).asList('å¼ ä¸‰', 'æå››', 'ç‹äº”')}")
    private List<String> names;
    
    @Value("#{ {key1:'value1', key2:'value2'} }")
    private Map<String, String> configMap;
    
    // ğŸ”¸ è‡ªå®šä¹‰å¯¹è±¡ï¼ˆå¼•ç”¨å…¶ä»–Beanï¼‰
    @Value("#{userService}")
    private UserService userService;
}
```

### 4.3 å±æ€§æ³¨å…¥çš„æœ€ä½³å®è·µ


**å®ç”¨æŠ€å·§**ï¼š

```java
@Component
public class BestPractice {
    
    // âœ… æ¨èï¼šé…ç½®æ–‡ä»¶ + SpELç»„åˆ
    @Value("#{T(Integer).parseInt('${app.max.users}')}")
    private int maxUsers;
    
    // âœ… æ¨èï¼šå¸¦é»˜è®¤å€¼çš„æ³¨å…¥
    @Value("#{config.timeout ?: 30}")
    private int timeout;
    
    // âš ï¸ æ³¨æ„ï¼šå¤æ‚é€»è¾‘å»ºè®®ç”¨æ–¹æ³•
    @Value("#{userService.isAdmin(userId) ? 'ADMIN' : 'USER'}")
    private String role;  // å¤ªå¤æ‚ï¼Œå¯è¯»æ€§å·®
    
    // âœ… æ›´å¥½ï¼šæŠŠé€»è¾‘å°è£…åˆ°æ–¹æ³•
    @Value("#{userService.getUserRole(userId)}")
    private String role;  // æ¸…æ™°æ˜äº†
}
```

**å¸¸è§é”™è¯¯ç¤ºä¾‹**ï¼š

```java
// âŒ é”™è¯¯1ï¼šè¡¨è¾¾å¼è¯­æ³•é”™è¯¯
@Value("#{config.name")  // ç¼ºå°‘å³æ‹¬å·
private String name;

// âŒ é”™è¯¯2ï¼šå±æ€§ä¸å­˜åœ¨
@Value("#{config.notExist}")  // configæ²¡æœ‰notExistå±æ€§
private String value;

// âŒ é”™è¯¯3ï¼šç±»å‹ä¸åŒ¹é…
@Value("#{config.name}")  // config.nameæ˜¯String
private int value;  // æ— æ³•è½¬æˆint

// âœ… æ­£ç¡®ï¼šç±»å‹è½¬æ¢
@Value("#{T(Integer).parseInt(config.name)}")
private int value;
```

---

## 5. ğŸ›¡ï¸ é»˜è®¤å€¼è®¾ç½®æŠ€å·§


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦é»˜è®¤å€¼


**å®é™…é—®é¢˜**ï¼šé…ç½®é¡¹å¯èƒ½ä¸å­˜åœ¨ï¼Œä¼šå¯¼è‡´ç¨‹åºæŠ¥é”™

```
é—®é¢˜åœºæ™¯ï¼š
@Value("#{config.timeout}")
private int timeout;

å¦‚æœconfigå¯¹è±¡æ²¡æœ‰timeoutå±æ€§ â†’ å¯åŠ¨æŠ¥é”™ï¼

è§£å†³æ–¹æ¡ˆï¼š
@Value("#{config.timeout ?: 30}")  // æ²¡æœ‰å°±ç”¨30
private int timeout;
```

### 5.2 ä¸‰ç§é»˜è®¤å€¼è®¾ç½®æ–¹å¼


```java
@Component
public class DefaultValueDemo {
    
    // æ–¹å¼1ï¼šä½¿ç”¨ Elvisè¿ç®—ç¬¦ ?:ï¼ˆæ¨èï¼‰
    @Value("#{config.timeout ?: 30}")
    private int timeout;  // config.timeoutä¸å­˜åœ¨æˆ–ä¸ºnullæ—¶ç”¨30
    
    // æ–¹å¼2ï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦
    @Value("#{config.timeout != null ? config.timeout : 30}")
    private int timeout2;  // æ›´æ˜ç¡®ä½†å•°å—¦
    
    // æ–¹å¼3ï¼šå±æ€§å ä½ç¬¦çš„é»˜è®¤å€¼
    @Value("${app.timeout:30}")  // æ³¨æ„è¿™æ˜¯ ${} ä¸æ˜¯ #{}
    private int timeout3;  // é…ç½®æ–‡ä»¶æ²¡æœ‰app.timeoutæ—¶ç”¨30
}
```

### 5.3 é»˜è®¤å€¼çš„å®ç”¨åœºæ™¯


**åœºæ™¯å¯¹ç…§è¡¨**ï¼š

| åœºæ™¯ | è¡¨è¾¾å¼å†™æ³• | è¯´æ˜ |
|------|-----------|------|
| **é…ç½®ç¼ºå¤±** | `#{config.size ?: 100}` | é…ç½®å¯¹è±¡æ²¡è¿™ä¸ªå±æ€§æ—¶ç”¨é»˜è®¤å€¼ |
| **å€¼ä¸ºnull** | `#{user.name ?: 'åŒ¿å'}` | å±æ€§å­˜åœ¨ä½†æ˜¯nullæ—¶ç”¨é»˜è®¤å€¼ |
| **ç©ºå­—ç¬¦ä¸²** | `#{str.isEmpty() ? 'é»˜è®¤' : str}` | å­—ç¬¦ä¸²ä¸ºç©ºæ—¶ç”¨é»˜è®¤å€¼ |
| **æ•°å€¼èŒƒå›´** | `#{val > 100 ? 100 : val}` | é™åˆ¶æœ€å¤§å€¼ |
| **é›†åˆä¸ºç©º** | `#{list.?[age > 18] ?: defaultList}` | è¿‡æ»¤åä¸ºç©ºç”¨é»˜è®¤é›†åˆ |

**ç»¼åˆç¤ºä¾‹**ï¼š

```java
@Component
public class SafeConfig {
    
    // ğŸ”¸ å­—ç¬¦ä¸²é»˜è®¤å€¼
    @Value("#{config.appName ?: 'MyApp'}")
    private String appName;
    
    // ğŸ”¸ æ•°å€¼é»˜è®¤å€¼
    @Value("#{config.maxConnections ?: 50}")
    private int maxConnections;
    
    // ğŸ”¸ å¸ƒå°”é»˜è®¤å€¼
    @Value("#{config.enabled ?: true}")
    private boolean enabled;
    
    // ğŸ”¸ å¯¹è±¡é»˜è®¤å€¼ï¼ˆå¼•ç”¨å¦ä¸€ä¸ªBeanï¼‰
    @Value("#{primaryDb ?: backupDb}")
    private DataSource dataSource;
    
    // ğŸ”¸ å¤æ‚é»˜è®¤å€¼ï¼ˆå¸¦è®¡ç®—ï¼‰
    @Value("#{config.timeout ?: systemProperties['default.timeout'] ?: 30}")
    private int timeout;  // å¤šå±‚é»˜è®¤å€¼
    
    // ğŸ”¸ é›†åˆé»˜è®¤å€¼
    @Value("#{config.allowedIps ?: {'127.0.0.1', 'localhost'}}")
    private Set<String> allowedIps;
}
```

---

## 6. ğŸ”— Beanå¼•ç”¨è¡¨è¾¾å¼


### 6.1 Beanå¼•ç”¨çš„åŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šè®©ä¸€ä¸ªBeanèƒ½è®¿é—®å¦ä¸€ä¸ªBeançš„å±æ€§æˆ–æ–¹æ³•

```
åœºæ™¯ç†è§£ï¼š
UserServiceéœ€è¦ç”¨åˆ°ConfigServiceçš„é…ç½®

ä¼ ç»Ÿæ–¹å¼ï¼š
@Autowired
private ConfigService configService;
int timeout = configService.getTimeout();

SpELæ–¹å¼ï¼š
@Value("#{configService.timeout}")
private int timeout;  // ç›´æ¥å–å€¼ï¼Œæ›´ç®€æ´
```

### 6.2 Beanå¼•ç”¨çš„è¯­æ³•æ ¼å¼


```java
@Component
public class BeanRefDemo {
    
    // æ ¼å¼1ï¼šå¼•ç”¨æ•´ä¸ªBean
    @Value("#{userService}")
    private UserService userService;
    
    // æ ¼å¼2ï¼šå¼•ç”¨Beançš„å±æ€§
    @Value("#{userService.currentUser}")
    private User currentUser;
    
    // æ ¼å¼3ï¼šå¼•ç”¨Beançš„æ–¹æ³•
    @Value("#{userService.getUserCount()}")
    private int userCount;
    
    // æ ¼å¼4ï¼šå¼•ç”¨Beanå±æ€§çš„å±æ€§ï¼ˆé“¾å¼è°ƒç”¨ï¼‰
    @Value("#{userService.currentUser.name}")
    private String userName;
    
    // æ ¼å¼5ï¼šå¼•ç”¨Beanæ–¹æ³•å¹¶ä¼ å‚
    @Value("#{userService.getUserById(1001)}")
    private User user;
}
```

### 6.3 Beanå¼•ç”¨çš„å®é™…åº”ç”¨


**åœºæ™¯1ï¼šé…ç½®ä¸­å¿ƒåŒ–ç®¡ç†**

```java
// é…ç½®Bean
@Component("appConfig")
public class AppConfig {
    private String apiUrl = "http://api.example.com";
    private int timeout = 30;
    private boolean debug = false;
    
    public String getApiUrl() { return apiUrl; }
    public int getTimeout() { return timeout; }
    public boolean isDebug() { return debug; }
}

// ä½¿ç”¨é…ç½®çš„Bean
@Component
public class ApiClient {
    
    @Value("#{appConfig.apiUrl}")
    private String apiUrl;  // ä»é…ç½®Beanè·å–
    
    @Value("#{appConfig.timeout * 1000}")
    private int timeoutMs;  // å–å€¼åè®¡ç®—
    
    @Value("#{appConfig.debug ? 'DEBUG' : 'INFO'}")
    private String logLevel;  // æ ¹æ®é…ç½®å†³å®šæ—¥å¿—çº§åˆ«
}
```

**åœºæ™¯2ï¼šBeanä¹‹é—´çš„æ•°æ®å…±äº«**

```java
// ç”¨æˆ·æœåŠ¡
@Service
public class UserService {
    private User currentUser;
    
    public User getCurrentUser() { 
        return currentUser; 
    }
    
    public boolean isAdmin(Long userId) {
        // åˆ¤æ–­é€»è¾‘
        return true;
    }
}

// è®¢å•æœåŠ¡ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯
@Service
public class OrderService {
    
    // è·å–å½“å‰ç”¨æˆ·å
    @Value("#{userService.currentUser.name}")
    private String currentUserName;
    
    // åˆ¤æ–­å½“å‰ç”¨æˆ·æƒé™
    @Value("#{userService.isAdmin(userId)}")
    private boolean isAdmin;
    
    // æ ¹æ®ç”¨æˆ·ç­‰çº§è®¾ç½®æŠ˜æ‰£
    @Value("#{userService.currentUser.level == 'VIP' ? 0.8 : 1.0}")
    private double discount;
}
```

### 6.4 Beanå¼•ç”¨çš„æ³¨æ„äº‹é¡¹


**âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³**ï¼š

```java
// âŒ é—®é¢˜1ï¼šå¾ªç¯å¼•ç”¨
@Component
public class BeanA {
    @Value("#{beanB.value}")  // Aå¼•ç”¨B
    private String value;
}

@Component
public class BeanB {
    @Value("#{beanA.value}")  // Bå¼•ç”¨A â†’ å¾ªç¯ä¾èµ–ï¼
    private String value;
}

// âœ… è§£å†³ï¼šé¿å…å¾ªç¯ï¼Œæˆ–ç”¨@Lazyå»¶è¿ŸåŠ è½½
@Component
public class BeanA {
    @Lazy
    @Value("#{beanB.value}")
    private String value;
}

// âŒ é—®é¢˜2ï¼šBeanä¸å­˜åœ¨
@Value("#{notExistBean.value}")  // å¯åŠ¨æŠ¥é”™
private String value;

// âœ… è§£å†³ï¼šä½¿ç”¨é»˜è®¤å€¼
@Value("#{notExistBean?.value ?: 'é»˜è®¤å€¼'}")  // ?. å®‰å…¨å¯¼èˆª
private String value;

// âŒ é—®é¢˜3ï¼šå±æ€§è®¿é—®æƒé™
@Component
public class ConfigBean {
    private String secret = "password";  // privateæ— getter
}

@Value("#{configBean.secret}")  // æŠ¥é”™ï¼šæ— æ³•è®¿é—®
private String value;

// âœ… è§£å†³ï¼šæä¾›getteræ–¹æ³•
public String getSecret() { return secret; }
```

---

## 7. âš™ï¸ æ¡ä»¶æ³¨å…¥ç­–ç•¥


### 7.1 ä»€ä¹ˆæ˜¯æ¡ä»¶æ³¨å…¥


**é€šä¿—è§£é‡Š**ï¼šæ ¹æ®æ¡ä»¶å†³å®šæ³¨å…¥ä»€ä¹ˆå€¼ï¼Œå°±åƒ"å¦‚æœ...é‚£ä¹ˆ...å¦åˆ™..."

```
å®é™…åœºæ™¯ï¼š
å¼€å‘ç¯å¢ƒç”¨æµ‹è¯•æ•°æ®åº“
ç”Ÿäº§ç¯å¢ƒç”¨æ­£å¼æ•°æ®åº“

SpELå®ç°ï¼š
@Value("#{environment == 'prod' ? prodDbUrl : testDbUrl}")
private String dbUrl;
```

### 7.2 æ¡ä»¶æ³¨å…¥çš„åŸºæœ¬è¯­æ³•


```java
@Component
public class ConditionalDemo {
    
    // â‘  ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆæœ€å¸¸ç”¨ï¼‰
    @Value("#{config.enabled ? 'ON' : 'OFF'}")
    private String status;
    
    // â‘¡ åŸºäºæ•°å€¼æ¡ä»¶
    @Value("#{config.userCount > 1000 ? 'high' : 'low'}")
    private String loadLevel;
    
    // â‘¢ åŸºäºå­—ç¬¦ä¸²æ¡ä»¶
    @Value("#{config.env == 'prod' ? prodConfig : devConfig}")
    private Config activeConfig;
    
    // â‘£ åŸºäºnullæ£€æŸ¥
    @Value("#{user != null ? user.name : 'è®¿å®¢'}")
    private String userName;
    
    // â‘¤ å¤æ‚æ¡ä»¶ç»„åˆ
    @Value("#{config.enabled and config.level > 5 ? 'A' : 'B'}")
    private String grade;
}
```

### 7.3 å®é™…åº”ç”¨åœºæ™¯


**åœºæ™¯1ï¼šç¯å¢ƒåˆ‡æ¢é…ç½®**

```java
@Component
public class EnvConfig {
    
    // æ ¹æ®è¿è¡Œç¯å¢ƒé€‰æ‹©ä¸åŒæ•°æ®åº“
    @Value("#{systemProperties['spring.profiles.active'] == 'prod' ? 
            'jdbc:mysql://prod-server:3306/db' : 
            'jdbc:mysql://localhost:3306/test_db'}")
    private String dbUrl;
    
    // æ ¹æ®ç¯å¢ƒå†³å®šæ—¥å¿—çº§åˆ«
    @Value("#{environment.isDev() ? 'DEBUG' : 'INFO'}")
    private String logLevel;
    
    // ç”Ÿäº§ç¯å¢ƒå¯ç”¨ç¼“å­˜ï¼Œå¼€å‘ç¯å¢ƒç¦ç”¨
    @Value("#{environment.isProd()}")
    private boolean cacheEnabled;
}
```

**åœºæ™¯2ï¼šåŠŸèƒ½å¼€å…³æ§åˆ¶**

```java
@Component
public class FeatureToggle {
    
    // æ ¹æ®ç”¨æˆ·ç­‰çº§å†³å®šåŠŸèƒ½å¯ç”¨æ€§
    @Value("#{user.level >= 3 ? true : false}")
    private boolean advancedFeatureEnabled;
    
    // æ ¹æ®é…ç½®å†³å®šä½¿ç”¨å“ªä¸ªå®ç°
    @Value("#{config.useNewAlgorithm ? newService : oldService}")
    private DataService dataService;
    
    // æ ¹æ®æ—¶é—´å†³å®šæ´»åŠ¨çŠ¶æ€
    @Value("#{T(java.time.LocalDate).now().isAfter(
            T(java.time.LocalDate).parse('2024-12-31')) ? 
            'å·²ç»“æŸ' : 'è¿›è¡Œä¸­'}")
    private String activityStatus;
}
```

**åœºæ™¯3ï¼šæ€§èƒ½ä¼˜åŒ–é…ç½®**

```java
@Component
public class PerformanceConfig {
    
    // æ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å¤§å°
    @Value("#{systemMonitor.cpuUsage > 0.8 ? 
            systemMonitor.coreCount * 2 : 
            systemMonitor.coreCount * 4}")
    private int threadPoolSize;
    
    // æ ¹æ®å†…å­˜ä½¿ç”¨ç‡å†³å®šç¼“å­˜å¤§å°
    @Value("#{systemMonitor.memoryUsage > 0.7 ? 
            100 : 500}")
    private int cacheSize;
    
    // æ ¹æ®ç½‘ç»œçŠ¶å†µå†³å®šè¶…æ—¶æ—¶é—´
    @Value("#{networkMonitor.isSlowNetwork() ? 60 : 30}")
    private int requestTimeout;
}
```

### 7.4 é«˜çº§æ¡ä»¶è¡¨è¾¾å¼


```java
@Component
public class AdvancedCondition {
    
    // ğŸ”¸ å¤šæ¡ä»¶ä¸è¿ç®—
    @Value("#{user.isVip() and user.score > 100 ? 'platinum' : 'normal'}")
    private String memberLevel;
    
    // ğŸ”¸ å¤šæ¡ä»¶æˆ–è¿ç®—
    @Value("#{config.forceEnable or user.hasPermission('admin') ? 
            fullService : limitedService}")
    private Service activeService;
    
    // ğŸ”¸ åµŒå¥—ä¸‰å…ƒè¿ç®—ç¬¦
    @Value("#{score >= 90 ? 'A' : 
            (score >= 80 ? 'B' : 
            (score >= 60 ? 'C' : 'D'))}")
    private String grade;
    
    // ğŸ”¸ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
    @Value("#{email matches '^[A-Za-z0-9+_.-]+@(.+)$' ? 
            email : 'invalid@example.com'}")
    private String validEmail;
    
    // ğŸ”¸ é›†åˆæ¡ä»¶åˆ¤æ–­
    @Value("#{allowedRoles.contains(user.role) ? 
            'granted' : 'denied'}")
    private String accessStatus;
}
```

### 7.5 æ¡ä»¶æ³¨å…¥æœ€ä½³å®è·µ


**å®ç”¨å»ºè®®**ï¼š

```java
@Component
public class BestPracticeCondition {
    
    // âœ… æ¨èï¼šç®€å•æ¡ä»¶ç›´æ¥å†™
    @Value("#{enabled ? 100 : 50}")
    private int value;
    
    // âš ï¸ ä¸æ¨èï¼šå¤ªå¤æ‚çš„æ¡ä»¶
    @Value("#{(a > 10 and b < 20) or (c == 30 and d != 40) ? x : y}")
    private String complex;  // å¯è¯»æ€§å·®
    
    // âœ… æ›´å¥½ï¼šå¤æ‚é€»è¾‘å°è£…åˆ°æ–¹æ³•
    @Value("#{configService.calculateValue()}")
    private String better;
    
    // âœ… æ¨èï¼šä½¿ç”¨å®‰å…¨å¯¼èˆªé¿å…ç©ºæŒ‡é’ˆ
    @Value("#{user?.profile?.avatar ?: 'default.png'}")
    private String avatar;  // ?. é˜²æ­¢nullå¼‚å¸¸
    
    // âœ… æ¨èï¼šæ¡ä»¶ + é»˜è®¤å€¼ç»„åˆ
    @Value("#{config.timeout > 0 ? config.timeout : 30}")
    private int timeout;
}
```

**é”™è¯¯å¤„ç†ç¤ºä¾‹**ï¼š

```java
// âŒ å±é™©ï¼šå¯èƒ½æŠ›å‡ºå¼‚å¸¸
@Value("#{100 / config.divisor}")  // divisor=0æ—¶æŠ¥é”™
private int result;

// âœ… å®‰å…¨ï¼šåŠ å…¥ä¿æŠ¤
@Value("#{config.divisor != 0 ? (100 / config.divisor) : 0}")
private int safeResult;

// âŒ å±é™©ï¼šå¯èƒ½nullå¼‚å¸¸
@Value("#{user.address.city}")  // addresså¯èƒ½ä¸ºnull
private String city;

// âœ… å®‰å…¨ï¼šä½¿ç”¨å®‰å…¨å¯¼èˆª
@Value("#{user?.address?.city ?: 'æœªçŸ¥'}")
private String safeCity;
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SpELåœ¨Beanå®šä¹‰ä¸­çš„ä½œç”¨ï¼šåŠ¨æ€å–å€¼ã€çµæ´»é…ç½®ã€è¡¨è¾¾å¼è®¡ç®—
ğŸ”¸ @Valueæ³¨è§£ï¼šæœ€å¸¸ç”¨çš„SpELåº”ç”¨æ–¹å¼ï¼Œæ”¯æŒå±æ€§/æ„é€ å™¨/æ–¹æ³•æ³¨å…¥
ğŸ”¸ è¡¨è¾¾å¼ç±»å‹ï¼šå­—é¢é‡ã€å±æ€§å ä½ç¬¦${}ã€SpELè¡¨è¾¾å¼#{}
ğŸ”¸ é»˜è®¤å€¼è®¾ç½®ï¼šä½¿ç”¨ ?: Elvisè¿ç®—ç¬¦æä¾›å®‰å…¨çš„é»˜è®¤å€¼
ğŸ”¸ Beanå¼•ç”¨ï¼šé€šè¿‡Beanåç§°è®¿é—®å…¶ä»–Beançš„å±æ€§å’Œæ–¹æ³•
ğŸ”¸ æ¡ä»¶æ³¨å…¥ï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦å®ç°æ¡ä»¶åˆ¤æ–­å’ŒåŠ¨æ€é€‰æ‹©
```

### 8.2 å…³é”®è¯­æ³•é€ŸæŸ¥


| åŠŸèƒ½ | è¯­æ³•æ ¼å¼ | ç¤ºä¾‹ |
|------|---------|------|
| **åŸºæœ¬æ³¨å…¥** | `@Value("#{è¡¨è¾¾å¼}")` | `@Value("#{config.name}")` |
| **é»˜è®¤å€¼** | `#{å€¼ ?: é»˜è®¤å€¼}` | `#{timeout ?: 30}` |
| **Beanå¼•ç”¨** | `#{beanåç§°.å±æ€§}` | `#{userService.name}` |
| **æ–¹æ³•è°ƒç”¨** | `#{bean.æ–¹æ³•()}` | `#{service.getValue()}` |
| **æ¡ä»¶åˆ¤æ–­** | `#{æ¡ä»¶ ? å€¼1 : å€¼2}` | `#{enabled ? 'ON' : 'OFF'}` |
| **å®‰å…¨å¯¼èˆª** | `#{å¯¹è±¡?.å±æ€§}` | `#{user?.name}` |
| **å±æ€§å ä½ç¬¦** | `${é…ç½®key:é»˜è®¤å€¼}` | `${app.name:MyApp}` |

### 8.3 å®é™…åº”ç”¨åœºæ™¯æ€»ç»“


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **é…ç½®å€¼æ³¨å…¥**ï¼šä»é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡è·å–é…ç½®
- âœ… **Beané—´é€šä¿¡**ï¼šè®¿é—®å…¶ä»–Beançš„å±æ€§å’Œæ–¹æ³•
- âœ… **åŠ¨æ€è®¡ç®—**ï¼šè¿è¡Œæ—¶è®¡ç®—å€¼ï¼ˆå¦‚å•ä½è½¬æ¢ã€æ ¼å¼åŒ–ï¼‰
- âœ… **æ¡ä»¶é…ç½®**ï¼šæ ¹æ®ç¯å¢ƒæˆ–æ¡ä»¶é€‰æ‹©ä¸åŒé…ç½®
- âœ… **é»˜è®¤å€¼å¤„ç†**ï¼šä¸ºå¯èƒ½ç¼ºå¤±çš„é…ç½®æä¾›å®‰å…¨çš„é»˜è®¤å€¼

**ä¸é€‚ç”¨åœºæ™¯**ï¼š
- âŒ **å¤æ‚ä¸šåŠ¡é€»è¾‘**ï¼šåº”è¯¥å°è£…åˆ°Serviceæ–¹æ³•ä¸­
- âŒ **é¢‘ç¹å˜åŒ–çš„å€¼**ï¼šSpELåœ¨Beanåˆ›å»ºæ—¶è®¡ç®—ä¸€æ¬¡
- âŒ **éœ€è¦äº‹åŠ¡çš„æ“ä½œ**ï¼šSpELä¸æ”¯æŒäº‹åŠ¡ç®¡ç†

### 8.4 å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ


```
é”™è¯¯1ï¼šè¡¨è¾¾å¼è¯­æ³•é”™è¯¯
âŒ @Value("#{config.name")  
âœ… @Value("#{config.name}")

é”™è¯¯2ï¼šBeanæˆ–å±æ€§ä¸å­˜åœ¨
âŒ @Value("#{notExist.value}")
âœ… @Value("#{bean?.value ?: 'é»˜è®¤'}")

é”™è¯¯3ï¼šç±»å‹ä¸åŒ¹é…
âŒ @Value("#{stringValue}")  private int num;
âœ… @Value("#{T(Integer).parseInt(stringValue)}")

é”™è¯¯4ï¼šå¾ªç¯ä¾èµ–
âŒ BeanAå¼•ç”¨BeanBï¼ŒBeanBåˆå¼•ç”¨BeanA
âœ… ä½¿ç”¨@Lazyæˆ–é‡æ„ä»£ç é¿å…å¾ªç¯

é”™è¯¯5ï¼šç©ºæŒ‡é’ˆå¼‚å¸¸
âŒ @Value("#{user.address.city}")
âœ… @Value("#{user?.address?.city ?: 'æœªçŸ¥'}")
```

### 8.5 å­¦ä¹ å»ºè®®


**è®°å¿†æŠ€å·§**ï¼š
```
ğŸ’¡ SpELå°±åƒ"Springçš„è®¡ç®—å™¨"
   - #{} æ˜¯è®¡ç®—ç¬¦å·
   - é‡Œé¢å¯ä»¥å†™è¡¨è¾¾å¼ã€è°ƒæ–¹æ³•ã€å¼•ç”¨Bean
   - ?: æ˜¯"å¦‚æœæ²¡æœ‰å°±ç”¨è¿™ä¸ª"
   - ?. æ˜¯"å¦‚æœä¸æ˜¯nullæ‰è®¿é—®"
```

**å®è·µæ­¥éª¤**ï¼š
1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆç”¨å­—é¢é‡å’Œå±æ€§å ä½ç¬¦
2. **Beanå¼•ç”¨ç»ƒä¹ **ï¼šç»ƒä¹ è®¿é—®å…¶ä»–Beançš„å±æ€§
3. **åŠ å…¥é»˜è®¤å€¼**ï¼šä½¿ç”¨ ?: æä¾›å®‰å…¨ä¿éšœ
4. **å°è¯•æ¡ä»¶**ï¼šç”¨ä¸‰å…ƒè¿ç®—ç¬¦åšç®€å•åˆ¤æ–­
5. **ç»¼åˆåº”ç”¨**ï¼šç»„åˆå¤šä¸ªæŠ€å·§è§£å†³å®é™…é—®é¢˜

**æ ¸å¿ƒåŸåˆ™**ï¼š
- ğŸ¯ **ç®€æ´ä¼˜å…ˆ**ï¼šèƒ½ç”¨ç®€å•æ–¹å¼å°±ä¸ç”¨å¤æ‚è¡¨è¾¾å¼
- ğŸ›¡ï¸ **å®‰å…¨ç¬¬ä¸€**ï¼šå§‹ç»ˆè€ƒè™‘nullå’Œå¼‚å¸¸æƒ…å†µ
- ğŸ“– **å¯è¯»æ€§**ï¼šå¤æ‚é€»è¾‘å°è£…æˆæ–¹æ³•ï¼Œä¸è¦å†™åœ¨è¡¨è¾¾å¼é‡Œ
- âš¡ **æ€§èƒ½æ„è¯†**ï¼šSpELåœ¨Beanåˆ›å»ºæ—¶è®¡ç®—ï¼Œä¸é€‚åˆé¢‘ç¹å˜åŒ–çš„å€¼