---
title: 2ã€SpELè§£æå™¨
---
## ğŸ“š ç›®å½•

1. [SpELè§£æå™¨åŸºç¡€æ¦‚å¿µ](#1-SpELè§£æå™¨åŸºç¡€æ¦‚å¿µ)
2. [ExpressionParserè§£æå™¨è¯¦è§£](#2-ExpressionParserè§£æå™¨è¯¦è§£)
3. [EvaluationContextä¸Šä¸‹æ–‡æœºåˆ¶](#3-EvaluationContextä¸Šä¸‹æ–‡æœºåˆ¶)
4. [StandardEvaluationContextæ·±å…¥ç†è§£](#4-StandardEvaluationContextæ·±å…¥ç†è§£)
5. [è¡¨è¾¾å¼ç¼“å­˜æœºåˆ¶](#5-è¡¨è¾¾å¼ç¼“å­˜æœºåˆ¶)
6. [è§£ææ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#6-è§£ææ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
7. [SpELå®‰å…¨æœºåˆ¶](#7-SpELå®‰å…¨æœºåˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ SpELè§£æå™¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯SpELè§£æå™¨


**é€šä¿—ç†è§£**ï¼šSpELè§£æå™¨å°±åƒä¸€ä¸ª"ç¿»è¯‘å®˜"ï¼Œå®ƒèƒ½æŠŠæˆ‘ä»¬å†™çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚ `"user.name"`ï¼‰ç¿»è¯‘æˆJavaèƒ½æ‰§è¡Œçš„æ“ä½œã€‚

```
æ—¥å¸¸ç±»æ¯”ï¼š
ä½ è¯´ä¸­æ–‡ï¼š"å¸®æˆ‘ç®—ä¸€ä¸‹ 2+3"
ç¿»è¯‘å®˜å¬æ‡‚å â†’ æ‰§è¡Œè®¡ç®— â†’ è¿”å›ç»“æœ5

SpELè§£æå™¨ï¼š
ä½ å†™è¡¨è¾¾å¼ï¼š"#user.age + 10"  
è§£æå™¨ç†è§£å â†’ æ‰§è¡Œè¿ç®— â†’ è¿”å›ç»“æœ
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **è¯»æ‡‚è¡¨è¾¾å¼**ï¼šæŠŠå­—ç¬¦ä¸²å½¢å¼çš„è¡¨è¾¾å¼è½¬æ¢æˆå¯æ‰§è¡Œçš„å¯¹è±¡
- ğŸ”¸ **æ‰§è¡Œè®¡ç®—**ï¼šæ ¹æ®ä¸Šä¸‹æ–‡ç¯å¢ƒè®¡ç®—å‡ºç»“æœ
- ğŸ”¸ **ç±»å‹è½¬æ¢**ï¼šè‡ªåŠ¨å¤„ç†ç»“æœç±»å‹è½¬æ¢

### 1.2 è§£æå™¨çš„å·¥ä½œæµç¨‹


```
å®Œæ•´å·¥ä½œæµç¨‹ï¼š

1ï¸âƒ£ è¾“å…¥è¡¨è¾¾å¼å­—ç¬¦ä¸²
    â†“
2ï¸âƒ£ ExpressionParserè§£æ
    â†“  
3ï¸âƒ£ ç”ŸæˆExpressionå¯¹è±¡
    â†“
4ï¸âƒ£ å‡†å¤‡EvaluationContextä¸Šä¸‹æ–‡
    â†“
5ï¸âƒ£ Expression.getValue()æ‰§è¡Œ
    â†“
6ï¸âƒ£ è¿”å›è®¡ç®—ç»“æœ
```

**å®é™…ä¾‹å­**ï¼š
```java
// åˆ›å»ºè§£æå™¨
ExpressionParser parser = new SpelExpressionParser();

// è§£æè¡¨è¾¾å¼ - è¿™ä¸€æ­¥åªæ˜¯"è¯»æ‡‚"ï¼Œè¿˜æ²¡æ‰§è¡Œ
Expression exp = parser.parseExpression("'Hello ' + 'World'");

// æ‰§è¡Œå¹¶è·å–ç»“æœ
String result = exp.getValue(String.class);  // "Hello World"
```

> ğŸ’¡ **ç†è§£è¦ç‚¹**ï¼šè§£æå’Œæ‰§è¡Œæ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼å…ˆè§£ææˆExpressionå¯¹è±¡ï¼Œå†è°ƒç”¨getValue()æ‰§è¡Œ

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦è§£æå™¨


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

| åœºæ™¯ | ä¼ ç»Ÿæ–¹å¼ | ä½¿ç”¨SpELè§£æå™¨ |
|------|---------|---------------|
| **åŠ¨æ€è®¡ç®—** | å†™å¤§é‡if-elseé€»è¾‘ | `"#price * 0.8"` ä¸€è¡Œæå®š |
| **é…ç½®çµæ´»æ€§** | ç¡¬ç¼–ç åœ¨ä»£ç é‡Œ | é…ç½®æ–‡ä»¶ä¸­å†™è¡¨è¾¾å¼ |
| **è§„åˆ™å¼•æ“** | å¤æ‚çš„è§„åˆ™ç±» | è¡¨è¾¾å¼å­—ç¬¦ä¸²å³å¯ |
| **æ•°æ®ç»‘å®š** | æ‰‹åŠ¨get/set | `"user.address.city"` è‡ªåŠ¨è·å– |

**å®é™…ä»·å€¼**ï¼š
- âœ… ä¸ç”¨ä¿®æ”¹ä»£ç å°±èƒ½æ”¹å˜ä¸šåŠ¡é€»è¾‘
- âœ… é…ç½®æ–‡ä»¶ä¸­ç›´æ¥å†™è®¡ç®—è§„åˆ™
- âœ… å‡å°‘ç¡¬ç¼–ç ï¼Œæé«˜ç³»ç»Ÿçµæ´»æ€§

---

## 2. ğŸ”§ ExpressionParserè§£æå™¨è¯¦è§£


### 2.1 ExpressionParseræ ¸å¿ƒæ¥å£


**æ¥å£å®šä¹‰ç†è§£**ï¼š
```java
public interface ExpressionParser {
    // è§£æè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œè¿”å›Expressionå¯¹è±¡
    Expression parseExpression(String expressionString);
    
    // å¸¦è§£æé…ç½®çš„æ–¹å¼
    Expression parseExpression(String expressionString, 
                              ParserContext parserContext);
}
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šExpressionParseræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†"å¦‚ä½•æŠŠå­—ç¬¦ä¸²å˜æˆå¯æ‰§è¡Œè¡¨è¾¾å¼"çš„è§„èŒƒ

### 2.2 SpelExpressionParserå®ç°ç±»


**ä»€ä¹ˆæ˜¯SpelExpressionParser**ï¼š
- Springæä¾›çš„**æ ‡å‡†è§£æå™¨å®ç°**
- æ”¯æŒå®Œæ•´çš„SpELè¯­æ³•
- 99%çš„åœºæ™¯éƒ½ç”¨å®ƒ

**åŸºç¡€ä½¿ç”¨**ï¼š
```java
// 1. åˆ›å»ºè§£æå™¨ï¼ˆé€šå¸¸åˆ›å»ºä¸€æ¬¡ï¼Œé‡å¤ä½¿ç”¨ï¼‰
ExpressionParser parser = new SpelExpressionParser();

// 2. è§£æç®€å•è¡¨è¾¾å¼
Expression exp1 = parser.parseExpression("100 + 200");
Integer result1 = exp1.getValue(Integer.class);  // 300

// 3. è§£æå­—ç¬¦ä¸²æ‹¼æ¥
Expression exp2 = parser.parseExpression("'Hello' + ' ' + 'SpEL'");
String result2 = exp2.getValue(String.class);  // "Hello SpEL"

// 4. è§£æå¯¹è±¡å±æ€§è®¿é—®
Expression exp3 = parser.parseExpression("'Hello'.length()");
Integer length = exp3.getValue(Integer.class);  // 5
```

### 2.3 æ¨¡æ¿è¡¨è¾¾å¼è§£æ


**ä»€ä¹ˆæ˜¯æ¨¡æ¿è¡¨è¾¾å¼**ï¼šåœ¨æ™®é€šæ–‡æœ¬ä¸­åµŒå…¥SpELè¡¨è¾¾å¼

```java
// åˆ›å»ºæ¨¡æ¿è§£æä¸Šä¸‹æ–‡
ParserContext context = new TemplateParserContext();

// æ¨¡æ¿ä¸­ä½¿ç”¨ #{} åŒ…è£¹è¡¨è¾¾å¼
Expression exp = parser.parseExpression(
    "ä»Šå¤©æ˜¯ #{T(java.time.LocalDate).now()}ï¼Œæ¬¢è¿ #{#username}ï¼",
    context
);

// å‡†å¤‡ä¸Šä¸‹æ–‡æ•°æ®
EvaluationContext evalContext = new StandardEvaluationContext();
evalContext.setVariable("username", "å¼ ä¸‰");

// æ‰§è¡Œ
String message = exp.getValue(evalContext, String.class);
// ç»“æœï¼š"ä»Šå¤©æ˜¯ 2025-01-20ï¼Œæ¬¢è¿ å¼ ä¸‰ï¼"
```

> ğŸ’¡ **åº”ç”¨åœºæ™¯**ï¼šé…ç½®æ–‡ä»¶ã€é‚®ä»¶æ¨¡æ¿ã€åŠ¨æ€æ¶ˆæ¯ç”Ÿæˆç­‰

### 2.4 è‡ªå®šä¹‰è§£æé…ç½®


**SpelParserConfigurationé…ç½®é¡¹**ï¼š

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | ä½¿ç”¨åœºæ™¯ |
|--------|------|--------|----------|
| `autoGrowNullReferences` | è‡ªåŠ¨åˆ›å»ºnullå¯¹è±¡ | `false` | é“¾å¼è°ƒç”¨æ—¶è‡ªåŠ¨åˆ›å»ºä¸­é—´å¯¹è±¡ |
| `autoGrowCollections` | è‡ªåŠ¨æ‰©å±•é›†åˆ | `false` | è®¿é—®ä¸å­˜åœ¨çš„ç´¢å¼•æ—¶è‡ªåŠ¨æ‰©å±• |
| `maximumAutoGrowSize` | è‡ªåŠ¨æ‰©å±•æœ€å¤§é•¿åº¦ | `Integer.MAX_VALUE` | é˜²æ­¢æ— é™æ‰©å±• |

**å®é™…åº”ç”¨**ï¼š
```java
// åˆ›å»ºè‡ªå®šä¹‰é…ç½®
SpelParserConfiguration config = new SpelParserConfiguration(
    true,   // è‡ªåŠ¨åˆ›å»ºnullå¯¹è±¡
    true    // è‡ªåŠ¨æ‰©å±•é›†åˆ
);

// ä½¿ç”¨é…ç½®åˆ›å»ºè§£æå™¨
ExpressionParser parser = new SpelExpressionParser(config);

// æµ‹è¯•è‡ªåŠ¨åˆ›å»ºå¯¹è±¡
class User {
    Address address;  // åˆå§‹ä¸ºnull
}

User user = new User();
Expression exp = parser.parseExpression("address.city");

// ä¸ä¼šç©ºæŒ‡é’ˆï¼ä¼šè‡ªåŠ¨åˆ›å»ºAddresså¯¹è±¡
exp.setValue(new StandardEvaluationContext(user), "åŒ—äº¬");
```

---

## 3. ğŸŒ EvaluationContextä¸Šä¸‹æ–‡æœºåˆ¶


### 3.1 ä»€ä¹ˆæ˜¯EvaluationContext


**é€šä¿—ç†è§£**ï¼šEvaluationContextå°±æ˜¯è¡¨è¾¾å¼æ‰§è¡Œæ—¶çš„"è¿è¡Œç¯å¢ƒ"ï¼Œæä¾›äº†æ‰§è¡Œè¡¨è¾¾å¼æ‰€éœ€çš„æ‰€æœ‰æ•°æ®å’Œè®¾ç½®ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ä½ åœ¨åšé¥­ï¼ˆæ‰§è¡Œè¡¨è¾¾å¼ï¼‰
å¨æˆ¿ç¯å¢ƒï¼ˆEvaluationContextï¼‰æä¾›ï¼š
  - é£Ÿæï¼ˆå˜é‡ï¼‰
  - è°ƒæ–™ï¼ˆå‡½æ•°ï¼‰  
  - å¨å…·ï¼ˆç±»å‹è½¬æ¢å™¨ï¼‰
  - èœè°±ï¼ˆå±æ€§è®¿é—®å™¨ï¼‰
```

**æ ¸å¿ƒèŒè´£**ï¼š

ğŸ”¹ **æä¾›å˜é‡**ï¼šå­˜å‚¨è¡¨è¾¾å¼ä¸­è¦ç”¨çš„å˜é‡
```java
context.setVariable("username", "å¼ ä¸‰");
// è¡¨è¾¾å¼ä¸­å¯ä»¥ç”¨ #username
```

ğŸ”¹ **æä¾›æ ¹å¯¹è±¡**ï¼šè¡¨è¾¾å¼é»˜è®¤æ“ä½œçš„å¯¹è±¡
```java
User user = new User("æå››");
EvaluationContext context = new StandardEvaluationContext(user);
// è¡¨è¾¾å¼ "name" ç›´æ¥è®¿é—®user.name
```

ğŸ”¹ **æä¾›å‡½æ•°**ï¼šæ³¨å†Œè‡ªå®šä¹‰å‡½æ•°
```java
context.registerFunction("reverse", 
    StringUtils.class.getDeclaredMethod("reverse", String.class));
// è¡¨è¾¾å¼ä¸­å¯ä»¥ç”¨ #reverse('hello')
```

ğŸ”¹ **æä¾›ç±»å‹è½¬æ¢**ï¼šè‡ªåŠ¨è½¬æ¢ç±»å‹

### 3.2 EvaluationContextæ¥å£ç»“æ„


**æ ¸å¿ƒæ–¹æ³•è¯´æ˜**ï¼š

```java
public interface EvaluationContext {
    
    // è·å–æ ¹å¯¹è±¡ï¼ˆè¡¨è¾¾å¼çš„é»˜è®¤æ“ä½œå¯¹è±¡ï¼‰
    TypedValue getRootObject();
    
    // å˜é‡ç®¡ç†
    void setVariable(String name, Object value);
    Object lookupVariable(String name);
    
    // ç±»å‹è½¬æ¢
    TypeConverter getTypeConverter();
    
    // å±æ€§è®¿é—®å™¨ï¼ˆå¦‚ä½•è¯»å†™å¯¹è±¡å±æ€§ï¼‰
    List<PropertyAccessor> getPropertyAccessors();
    
    // æ–¹æ³•è§£æå™¨ï¼ˆå¦‚ä½•æ‰¾åˆ°è¦è°ƒç”¨çš„æ–¹æ³•ï¼‰
    List<MethodResolver> getMethodResolvers();
    
    // å…¶ä»–é…ç½®...
}
```

### 3.3 ä¸Šä¸‹æ–‡çš„ä¸¤ç§å®ç°


**SimpleEvaluationContext - ç®€åŒ–ç‰ˆ**ï¼š

âœ… **ç‰¹ç‚¹**ï¼š
- åŠŸèƒ½å—é™ï¼Œæ›´å®‰å…¨
- ä¸æ”¯æŒè°ƒç”¨Javaç±»å‹ï¼ˆ`T()`è¯­æ³•ï¼‰
- ä¸æ”¯æŒæ„é€ å‡½æ•°è°ƒç”¨
- ä¸æ”¯æŒbeanå¼•ç”¨

âœ… **é€‚ç”¨åœºæ™¯**ï¼š
- ä¸å¯ä¿¡çš„ç”¨æˆ·è¾“å…¥
- åªéœ€è¦ç®€å•çš„å±æ€§è®¿é—®å’Œè®¡ç®—
- å¯¹å®‰å…¨æ€§è¦æ±‚é«˜çš„åœºæ™¯

```java
// åˆ›å»ºç®€åŒ–ä¸Šä¸‹æ–‡
EvaluationContext context = SimpleEvaluationContext
    .forReadOnlyDataBinding()  // åªè¯»æ•°æ®ç»‘å®š
    .build();

User user = new User("ç‹äº”", 25);
Expression exp = parser.parseExpression("name + 'ä»Šå¹´' + age + 'å²'");
String result = exp.getValue(context, user, String.class);
// "ç‹äº”ä»Šå¹´25å²"
```

**StandardEvaluationContext - æ ‡å‡†ç‰ˆ**ï¼š

âœ… **ç‰¹ç‚¹**ï¼š
- åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æŒæ‰€æœ‰SpELç‰¹æ€§
- å¯ä»¥è°ƒç”¨ä»»æ„Javaç±»å’Œæ–¹æ³•
- æ”¯æŒå¤æ‚çš„å¯¹è±¡æ“ä½œ

âœ… **é€‚ç”¨åœºæ™¯**ï¼š
- å†…éƒ¨ç³»ç»Ÿï¼Œå—ä¿¡ä»»çš„è¡¨è¾¾å¼
- éœ€è¦å®Œæ•´SpELåŠŸèƒ½
- é…ç½®æ–‡ä»¶ä¸­çš„è¡¨è¾¾å¼

---

## 4. ğŸ¨ StandardEvaluationContextæ·±å…¥ç†è§£


### 4.1 StandardEvaluationContextæ ¸å¿ƒåŠŸèƒ½


**å®Œæ•´åŠŸèƒ½æ¸…å•**ï¼š

| åŠŸèƒ½ç±»åˆ« | å…·ä½“èƒ½åŠ› | ä»£ç ç¤ºä¾‹ |
|---------|---------|----------|
| ğŸ”¸ **æ ¹å¯¹è±¡è®¾ç½®** | è®¾ç½®è¡¨è¾¾å¼é»˜è®¤æ“ä½œçš„å¯¹è±¡ | `new StandardEvaluationContext(user)` |
| ğŸ”¸ **å˜é‡ç®¡ç†** | å­˜å‚¨å’Œè¯»å–å˜é‡ | `setVariable("tax", 0.08)` |
| ğŸ”¸ **å‡½æ•°æ³¨å†Œ** | æ³¨å†Œè‡ªå®šä¹‰å‡½æ•° | `registerFunction("upper", method)` |
| ğŸ”¸ **ç±»å‹è½¬æ¢** | è‡ªå®šä¹‰ç±»å‹è½¬æ¢è§„åˆ™ | `setTypeConverter(converter)` |
| ğŸ”¸ **å±æ€§è®¿é—®** | è‡ªå®šä¹‰å±æ€§è¯»å†™æ–¹å¼ | `addPropertyAccessor(accessor)` |
| ğŸ”¸ **æ–¹æ³•è§£æ** | è‡ªå®šä¹‰æ–¹æ³•æŸ¥æ‰¾è§„åˆ™ | `addMethodResolver(resolver)` |

### 4.2 æ ¹å¯¹è±¡ï¼ˆRoot Objectï¼‰ä½¿ç”¨


**ä»€ä¹ˆæ˜¯æ ¹å¯¹è±¡**ï¼šè¡¨è¾¾å¼ä¸­ç›´æ¥è®¿é—®çš„é»˜è®¤å¯¹è±¡

```java
// åœºæ™¯ï¼šç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢
class User {
    private String name;
    private int age;
    private Address address;
    
    // æ„é€ å™¨ã€getterã€setter...
}

class Address {
    private String city;
    private String street;
}

// åˆ›å»ºç”¨æˆ·å¯¹è±¡ä½œä¸ºæ ¹å¯¹è±¡
User user = new User("èµµå…­", 30);
user.setAddress(new Address("ä¸Šæµ·", "å—äº¬è·¯"));

// æ ¹å¯¹è±¡è®¾ç½®
StandardEvaluationContext context = new StandardEvaluationContext(user);

// ç›´æ¥è®¿é—®æ ¹å¯¹è±¡çš„å±æ€§ï¼ˆä¸éœ€è¦å‰ç¼€ï¼‰
Expression exp1 = parser.parseExpression("name");
String name = exp1.getValue(context, String.class);  // "èµµå…­"

// é“¾å¼è®¿é—®
Expression exp2 = parser.parseExpression("address.city");
String city = exp2.getValue(context, String.class);  // "ä¸Šæµ·"

// è°ƒç”¨æ–¹æ³•
Expression exp3 = parser.parseExpression("name.length()");
Integer length = exp3.getValue(context, Integer.class);  // 2
```

> ğŸ’¡ **æ³¨æ„**ï¼šè®¾ç½®æ ¹å¯¹è±¡åï¼Œè¡¨è¾¾å¼ä¸­çš„å±æ€§åç›´æ¥å¯¹åº”æ ¹å¯¹è±¡çš„å±æ€§ï¼Œæ— éœ€ä»»ä½•å‰ç¼€

### 4.3 å˜é‡ï¼ˆVariablesï¼‰ç®¡ç†


**å˜é‡çš„ä½œç”¨**ï¼šåœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ `#å˜é‡å` è®¿é—®

```java
StandardEvaluationContext context = new StandardEvaluationContext();

// 1. è®¾ç½®ç®€å•å˜é‡
context.setVariable("discount", 0.8);
context.setVariable("username", "å¼ ä¸‰");

// ä½¿ç”¨å˜é‡
Expression exp1 = parser.parseExpression("100 * #discount");
Double price = exp1.getValue(context, Double.class);  // 80.0

// 2. è®¾ç½®å¯¹è±¡å˜é‡
Product product = new Product("æ‰‹æœº", 3999);
context.setVariable("product", product);

// è®¿é—®å¯¹è±¡å˜é‡çš„å±æ€§
Expression exp2 = parser.parseExpression("#product.name + 'ä»·æ ¼:' + #product.price");
String info = exp2.getValue(context, String.class);  // "æ‰‹æœºä»·æ ¼:3999"

// 3. ç‰¹æ®Šå˜é‡ #this å’Œ #root
context.setRootObject(new User("æå››"));
Expression exp3 = parser.parseExpression("#root.name");  // è®¿é—®æ ¹å¯¹è±¡
Expression exp4 = parser.parseExpression("#this.name");  // å½“å‰å¯¹è±¡
```

**å˜é‡å‘½åè§„èŒƒ**ï¼š
- âœ… å¿…é¡»ä»¥ `#` å¼€å¤´ä½¿ç”¨
- âœ… å˜é‡åå»ºè®®ç”¨å°å†™å­—æ¯å¼€å¤´
- âœ… å¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- âŒ ä¸èƒ½ä½¿ç”¨SpELå…³é”®å­—

### 4.4 è‡ªå®šä¹‰å‡½æ•°æ³¨å†Œ


**å‡½æ•°æ³¨å†Œæ­¥éª¤**ï¼š

```java
// 1. å‡†å¤‡å·¥å…·ç±»å’Œæ–¹æ³•
public class StringUtil {
    // å¿…é¡»æ˜¯staticæ–¹æ³•
    public static String reverse(String str) {
        return new StringBuilder(str).reverse().toString();
    }
    
    public static String abbreviate(String str, int maxLength) {
        if (str.length() <= maxLength) return str;
        return str.substring(0, maxLength) + "...";
    }
}

// 2. æ³¨å†Œå‡½æ•°
StandardEvaluationContext context = new StandardEvaluationContext();

Method reverseMethod = StringUtil.class
    .getDeclaredMethod("reverse", String.class);
context.registerFunction("reverse", reverseMethod);

Method abbreviateMethod = StringUtil.class
    .getDeclaredMethod("abbreviate", String.class, int.class);
context.registerFunction("abbr", abbreviateMethod);

// 3. åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨
Expression exp1 = parser.parseExpression("#reverse('Hello')");
String reversed = exp1.getValue(context, String.class);  // "olleH"

Expression exp2 = parser.parseExpression("#abbr('è¿™æ˜¯ä¸€æ®µå¾ˆé•¿çš„æ–‡å­—', 5)");
String abbr = exp2.getValue(context, String.class);  // "è¿™æ˜¯ä¸€æ®µå¾ˆ..."
```

> âš ï¸ **é‡è¦é™åˆ¶**ï¼šæ³¨å†Œçš„å‡½æ•°**å¿…é¡»æ˜¯é™æ€æ–¹æ³•**ï¼ˆstatic methodï¼‰

### 4.5 è‡ªå®šä¹‰å±æ€§è®¿é—®å™¨


**ä»€ä¹ˆæ—¶å€™éœ€è¦**ï¼šå½“ä½ çš„ç±»ä¸æ˜¯æ ‡å‡†JavaBeanï¼Œæˆ–éœ€è¦ç‰¹æ®Šçš„å±æ€§è®¿é—®é€»è¾‘

```java
// åœºæ™¯ï¼šMapä½œä¸ºåŠ¨æ€å±æ€§å®¹å™¨
class DynamicObject {
    private Map<String, Object> properties = new HashMap<>();
    
    public Object getProperty(String name) {
        return properties.get(name);
    }
    
    public void setProperty(String name, Object value) {
        properties.put(name, value);
    }
}

// è‡ªå®šä¹‰å±æ€§è®¿é—®å™¨
public class DynamicPropertyAccessor implements PropertyAccessor {
    
    @Override
    public boolean canRead(EvaluationContext context, Object target, String name) {
        return target instanceof DynamicObject;
    }
    
    @Override
    public TypedValue read(EvaluationContext context, Object target, String name) {
        DynamicObject obj = (DynamicObject) target;
        return new TypedValue(obj.getProperty(name));
    }
    
    @Override
    public boolean canWrite(EvaluationContext context, Object target, String name) {
        return target instanceof DynamicObject;
    }
    
    @Override
    public void write(EvaluationContext context, Object target, String name, Object newValue) {
        DynamicObject obj = (DynamicObject) target;
        obj.setProperty(name, newValue);
    }
    
    @Override
    public Class<?>[] getSpecificTargetClasses() {
        return new Class<?>[] { DynamicObject.class };
    }
}

// ä½¿ç”¨
StandardEvaluationContext context = new StandardEvaluationContext();
context.addPropertyAccessor(new DynamicPropertyAccessor());

DynamicObject obj = new DynamicObject();
Expression exp = parser.parseExpression("customField");
exp.setValue(context, obj, "åŠ¨æ€å€¼");

Object value = exp.getValue(context, obj);  // "åŠ¨æ€å€¼"
```

---

## 5. ğŸ’¾ è¡¨è¾¾å¼ç¼“å­˜æœºåˆ¶


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜


**æ€§èƒ½å¯¹æ¯”**ï¼š

```
åœºæ™¯ï¼šæ‰§è¡Œ10000æ¬¡ç›¸åŒè¡¨è¾¾å¼ "user.name + ' is ' + user.age + ' years old'"

ä¸ä½¿ç”¨ç¼“å­˜ï¼š
- æ¯æ¬¡éƒ½è¦è§£æè¡¨è¾¾å¼
- è€—æ—¶ï¼šçº¦ 500ms

ä½¿ç”¨ç¼“å­˜ï¼š
- åªè§£æä¸€æ¬¡ï¼Œåç»­ç›´æ¥ç”¨
- è€—æ—¶ï¼šçº¦ 50ms
- æ€§èƒ½æå‡ï¼š10å€+
```

**ç¼“å­˜çš„ä»·å€¼**ï¼š
- âœ… é¿å…é‡å¤è§£æåŒä¸€ä¸ªè¡¨è¾¾å¼å­—ç¬¦ä¸²
- âœ… è¡¨è¾¾å¼è§£ææ˜¯CPUå¯†é›†å‹æ“ä½œ
- âœ… åœ¨å¾ªç¯æˆ–é«˜é¢‘è°ƒç”¨ä¸­æ•ˆæœæ˜¾è‘—

### 5.2 æ‰‹åŠ¨ç¼“å­˜å®ç°


**ç®€å•ç¼“å­˜æ–¹æ¡ˆ**ï¼š

```java
public class SpELCache {
    // ä½¿ç”¨ConcurrentHashMapå­˜å‚¨å·²è§£æçš„è¡¨è¾¾å¼
    private static final Map<String, Expression> CACHE = new ConcurrentHashMap<>();
    private static final ExpressionParser PARSER = new SpelExpressionParser();
    
    // è·å–è¡¨è¾¾å¼ï¼ˆå¸¦ç¼“å­˜ï¼‰
    public static Expression getExpression(String expressionString) {
        return CACHE.computeIfAbsent(expressionString, 
            key -> PARSER.parseExpression(key)
        );
    }
    
    // æ¸…ç©ºç¼“å­˜
    public static void clearCache() {
        CACHE.clear();
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class UserService {
    
    public String formatUserInfo(User user) {
        // ç¬¬ä¸€æ¬¡ï¼šè§£æå¹¶ç¼“å­˜
        // åç»­ï¼šç›´æ¥ä»ç¼“å­˜è·å–
        Expression exp = SpELCache.getExpression(
            "name + ' is ' + age + ' years old'"
        );
        
        StandardEvaluationContext context = new StandardEvaluationContext(user);
        return exp.getValue(context, String.class);
    }
}
```

### 5.3 Springå†…ç½®ç¼“å­˜æœºåˆ¶


**SpelExpressionParserçš„å†…ç½®ç¼“å­˜**ï¼š

```java
// SpelExpressionParseré»˜è®¤æœ‰ç¼“å­˜æœºåˆ¶
SpelExpressionParser parser = new SpelExpressionParser();

// å†…éƒ¨è‡ªåŠ¨ç¼“å­˜ï¼ˆå®¹é‡256ï¼‰
Expression exp1 = parser.parseExpression("1 + 1");
Expression exp2 = parser.parseExpression("1 + 1");  // ä»ç¼“å­˜è·å–

System.out.println(exp1 == exp2);  // trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡
```

**é…ç½®ç¼“å­˜å¤§å°**ï¼š
```java
// åˆ›å»ºè‡ªå®šä¹‰é…ç½®
SpelParserConfiguration config = new SpelParserConfiguration(
    SpelCompilerMode.IMMEDIATE,  // ç¼–è¯‘æ¨¡å¼
    null,                        // ç±»åŠ è½½å™¨
    true,                        // è‡ªåŠ¨åˆ›å»ºnullå¯¹è±¡
    true,                        // è‡ªåŠ¨æ‰©å±•é›†åˆ
    Integer.MAX_VALUE,           // æœ€å¤§æ‰©å±•å¤§å°
    512                          // ç¼“å­˜å¤§å°ï¼ˆé»˜è®¤256ï¼‰
);

ExpressionParser parser = new SpelExpressionParser(config);
```

### 5.4 ç¼“å­˜æœ€ä½³å®è·µ


**å®è·µå»ºè®®**ï¼š

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|---------|------|
| **å›ºå®šè¡¨è¾¾å¼** | ç±»æˆå‘˜å˜é‡å­˜å‚¨ | æœ€ç®€å•é«˜æ•ˆ |
| **åŠ¨æ€è¡¨è¾¾å¼** | è‡ªå®šä¹‰ç¼“å­˜Map | çµæ´»å¯æ§ |
| **é«˜é¢‘è°ƒç”¨** | é¢„ç¼–è¯‘+ç¼“å­˜ | æ€§èƒ½æœ€ä¼˜ |
| **å†…å­˜å—é™** | é™åˆ¶ç¼“å­˜å¤§å° | é˜²æ­¢å†…å­˜æº¢å‡º |

**æ¨èæ¨¡å¼**ï¼š
```java
@Service
public class OrderService {
    
    // 1. è§£æå™¨å•ä¾‹
    private static final ExpressionParser PARSER = new SpelExpressionParser();
    
    // 2. å›ºå®šè¡¨è¾¾å¼é¢„è§£æ
    private static final Expression DISCOUNT_EXP = 
        PARSER.parseExpression("totalPrice * (1 - #discountRate)");
    
    // 3. åŠ¨æ€è¡¨è¾¾å¼ç¼“å­˜
    private final Map<String, Expression> expressionCache = new ConcurrentHashMap<>();
    
    public double calculateDiscount(Order order, double discountRate) {
        StandardEvaluationContext context = new StandardEvaluationContext(order);
        context.setVariable("discountRate", discountRate);
        return DISCOUNT_EXP.getValue(context, Double.class);
    }
    
    public Object evaluateDynamic(String exprString, Object rootObject) {
        Expression exp = expressionCache.computeIfAbsent(
            exprString, PARSER::parseExpression
        );
        return exp.getValue(new StandardEvaluationContext(rootObject));
    }
}
```

---

## 6. âš¡ è§£ææ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 6.1 ç¼–è¯‘æ¨¡å¼æå‡æ€§èƒ½


**SpELçš„ä¸‰ç§ç¼–è¯‘æ¨¡å¼**ï¼š

| æ¨¡å¼ | è¯´æ˜ | æ€§èƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|------|----------|
| `OFF` | ä¸ç¼–è¯‘ï¼ˆé»˜è®¤ï¼‰ | åŸºå‡† | å¼€å‘è°ƒè¯• |
| `IMMEDIATE` | ç«‹å³ç¼–è¯‘ | å¿«10-100å€ | ç”Ÿäº§ç¯å¢ƒ |
| `MIXED` | æ··åˆæ¨¡å¼ | æ ¹æ®æƒ…å†µç¼–è¯‘ | å¤æ‚åœºæ™¯ |

**ä»€ä¹ˆæ˜¯ç¼–è¯‘**ï¼šæŠŠè¡¨è¾¾å¼è½¬æ¢æˆJavaå­—èŠ‚ç ï¼Œç›´æ¥æ‰§è¡Œï¼ˆç±»ä¼¼JITç¼–è¯‘ï¼‰

```java
// å¼€å¯ç«‹å³ç¼–è¯‘æ¨¡å¼
SpelParserConfiguration config = new SpelParserConfiguration(
    SpelCompilerMode.IMMEDIATE,  // ç«‹å³ç¼–è¯‘
    null                         // ä½¿ç”¨é»˜è®¤ç±»åŠ è½½å™¨
);

ExpressionParser parser = new SpelExpressionParser(config);

// è¿™ä¸ªè¡¨è¾¾å¼ä¼šè¢«ç¼–è¯‘æˆå­—èŠ‚ç 
Expression exp = parser.parseExpression("Math.sqrt(#value * #value + #other * #other)");

// æ‰§è¡Œæ—¶ç›´æ¥è¿è¡Œå­—èŠ‚ç ï¼Œé€Ÿåº¦å¿«
StandardEvaluationContext context = new StandardEvaluationContext();
context.setVariable("value", 3.0);
context.setVariable("other", 4.0);
Double result = exp.getValue(context, Double.class);  // 5.0
```

**æ€§èƒ½å¯¹æ¯”æµ‹è¯•**ï¼š
```java
public class PerformanceTest {
    
    public static void main(String[] args) {
        // æµ‹è¯•æ•°æ®
        int iterations = 100000;
        
        // 1. ä¸ç¼–è¯‘
        long time1 = testWithoutCompile(iterations);
        
        // 2. ç«‹å³ç¼–è¯‘
        long time2 = testWithCompile(iterations);
        
        System.out.println("ä¸ç¼–è¯‘è€—æ—¶: " + time1 + "ms");
        System.out.println("ç¼–è¯‘è€—æ—¶: " + time2 + "ms");
        System.out.println("æ€§èƒ½æå‡: " + (time1 / time2) + "å€");
    }
    
    static long testWithoutCompile(int iterations) {
        ExpressionParser parser = new SpelExpressionParser();
        Expression exp = parser.parseExpression("#value * 2 + 10");
        StandardEvaluationContext context = new StandardEvaluationContext();
        
        long start = System.currentTimeMillis();
        for (int i = 0; i < iterations; i++) {
            context.setVariable("value", i);
            exp.getValue(context, Integer.class);
        }
        return System.currentTimeMillis() - start;
    }
    
    static long testWithCompile(int iterations) {
        SpelParserConfiguration config = new SpelParserConfiguration(
            SpelCompilerMode.IMMEDIATE, null
        );
        ExpressionParser parser = new SpelExpressionParser(config);
        Expression exp = parser.parseExpression("#value * 2 + 10");
        StandardEvaluationContext context = new StandardEvaluationContext();
        
        long start = System.currentTimeMillis();
        for (int i = 0; i < iterations; i++) {
            context.setVariable("value", i);
            exp.getValue(context, Integer.class);
        }
        return System.currentTimeMillis() - start;
    }
}
```

### 6.2 ä¸Šä¸‹æ–‡å¯¹è±¡å¤ç”¨


**é¿å…é‡å¤åˆ›å»ºContext**ï¼š

âŒ **ä½æ•ˆå†™æ³•**ï¼š
```java
public String processUsers(List<User> users) {
    Expression exp = parser.parseExpression("name + ':' + age");
    StringBuilder result = new StringBuilder();
    
    for (User user : users) {
        // æ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºæ–°context - æµªè´¹èµ„æºï¼
        StandardEvaluationContext context = new StandardEvaluationContext(user);
        result.append(exp.getValue(context, String.class)).append("\n");
    }
    return result.toString();
}
```

âœ… **é«˜æ•ˆå†™æ³•**ï¼š
```java
public String processUsers(List<User> users) {
    Expression exp = parser.parseExpression("name + ':' + age");
    StandardEvaluationContext context = new StandardEvaluationContext();
    StringBuilder result = new StringBuilder();
    
    for (User user : users) {
        // å¤ç”¨contextï¼Œåªä¿®æ”¹æ ¹å¯¹è±¡
        context.setRootObject(user);
        result.append(exp.getValue(context, String.class)).append("\n");
    }
    return result.toString();
}
```

### 6.3 è¡¨è¾¾å¼æ‹†åˆ†ä¼˜åŒ–


**å¤æ‚è¡¨è¾¾å¼æ‹†åˆ†**ï¼š

```java
// åŸå§‹å¤æ‚è¡¨è¾¾å¼
String complexExpr = "(price * quantity * (1 - discount)) * (1 + taxRate) + shippingFee";

// é—®é¢˜ï¼šæ¯æ¬¡æ‰§è¡Œéƒ½è¦è®¡ç®—æ•´ä¸ªè¡¨è¾¾å¼

// ä¼˜åŒ–ï¼šæ‹†åˆ†æˆå¤šä¸ªå°è¡¨è¾¾å¼
Expression subtotalExp = parser.parseExpression("price * quantity * (1 - discount)");
Expression taxExp = parser.parseExpression("#subtotal * (1 + taxRate)");
Expression totalExp = parser.parseExpression("#withTax + shippingFee");

// æ‰§è¡Œæ—¶å¯ä»¥ç¼“å­˜ä¸­é—´ç»“æœ
StandardEvaluationContext context = new StandardEvaluationContext(order);
Double subtotal = subtotalExp.getValue(context, Double.class);
context.setVariable("subtotal", subtotal);

Double withTax = taxExp.getValue(context, Double.class);
context.setVariable("withTax", withTax);

Double total = totalExp.getValue(context, Double.class);
```

### 6.4 æ€§èƒ½ç›‘æ§


**ç›‘æ§è¡¨è¾¾å¼æ‰§è¡Œæ—¶é—´**ï¼š

```java
public class SpELMonitor {
    
    public static <T> T executeWithMonitor(Expression exp, 
                                           EvaluationContext context, 
                                           Class<T> resultType) {
        long start = System.nanoTime();
        try {
            T result = exp.getValue(context, resultType);
            long duration = System.nanoTime() - start;
            
            if (duration > 1_000_000) {  // è¶…è¿‡1msè­¦å‘Š
                System.out.println("âš ï¸ è¡¨è¾¾å¼æ‰§è¡Œè¾ƒæ…¢: " + exp.getExpressionString() 
                                 + " è€—æ—¶: " + (duration / 1_000_000.0) + "ms");
            }
            return result;
        } catch (Exception e) {
            long duration = System.nanoTime() - start;
            System.err.println("âŒ è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥: " + exp.getExpressionString() 
                             + " è€—æ—¶: " + (duration / 1_000_000.0) + "ms");
            throw e;
        }
    }
}
```

---

## 7. ğŸ”’ SpELå®‰å…¨æœºåˆ¶


### 7.1 å®‰å…¨é£é™©è®¤è¯†


**SpELçš„å®‰å…¨éšæ‚£**ï¼š

âš ï¸ **å±é™©ç¤ºä¾‹**ï¼ˆæ°¸è¿œä¸è¦è¿™æ ·åšï¼‰ï¼š
```java
// ç”¨æˆ·è¾“å…¥çš„è¡¨è¾¾å¼
String userInput = "T(java.lang.Runtime).getRuntime().exec('rm -rf /')";

// ç›´æ¥æ‰§è¡Œ - æåº¦å±é™©ï¼
ExpressionParser parser = new SpelExpressionParser();
Expression exp = parser.parseExpression(userInput);
exp.getValue(new StandardEvaluationContext());  // å¯èƒ½åˆ é™¤æ•´ä¸ªç³»ç»Ÿï¼
```

**å¸¸è§æ”»å‡»æ–¹å¼**ï¼š
- ğŸ”¸ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
- ğŸ”¸ è¯»å–æ•æ„Ÿæ–‡ä»¶
- ğŸ”¸ è°ƒç”¨å±é™©çš„Javaæ–¹æ³•
- ğŸ”¸ åå°„è°ƒç”¨ç§æœ‰API

### 7.2 ä½¿ç”¨SimpleEvaluationContext


**å®‰å…¨ä¸Šä¸‹æ–‡**ï¼š

```java
// SimpleEvaluationContexté™åˆ¶äº†åŠŸèƒ½
EvaluationContext safeContext = SimpleEvaluationContext
    .forReadOnlyDataBinding()  // åªè¯»æ•°æ®ç»‘å®š
    .build();

User user = new User("æµ‹è¯•ç”¨æˆ·", 25);

// âœ… å…è®¸ï¼šç®€å•å±æ€§è®¿é—®
Expression exp1 = parser.parseExpression("name");
String name = exp1.getValue(safeContext, user, String.class);  // OK

// âŒ ç¦æ­¢ï¼šè°ƒç”¨Javaç±»
Expression exp2 = parser.parseExpression("T(java.lang.System).exit(0)");
// æŠ›å‡ºå¼‚å¸¸ï¼šSpelEvaluationException: Type references are not supported
```

**SimpleEvaluationContexté…ç½®é€‰é¡¹**ï¼š

```java
// 1. åªè¯»æ•°æ®ç»‘å®šï¼ˆæœ€å®‰å…¨ï¼‰
SimpleEvaluationContext.forReadOnlyDataBinding().build();

// 2. è¯»å†™æ•°æ®ç»‘å®š
SimpleEvaluationContext.forReadWriteDataBinding().build();

// 3. è‡ªå®šä¹‰é…ç½®
SimpleEvaluationContext.forReadOnlyDataBinding()
    .withRootObject(user)                    // è®¾ç½®æ ¹å¯¹è±¡
    .withInstanceMethods()                   // å…è®¸å®ä¾‹æ–¹æ³•
    .withConversionService(conversionService) // è‡ªå®šä¹‰ç±»å‹è½¬æ¢
    .build();
```

### 7.3 è¡¨è¾¾å¼ç™½åå•éªŒè¯


**è¾“å…¥éªŒè¯ç­–ç•¥**ï¼š

```java
public class SpELValidator {
    
    // å…è®¸çš„è¡¨è¾¾å¼æ¨¡å¼
    private static final Set<String> ALLOWED_PATTERNS = Set.of(
        "^[a-zA-Z][a-zA-Z0-9]*$",              // ç®€å•å±æ€§å
        "^[a-zA-Z][a-zA-Z0-9]*\\.[a-zA-Z]+$",  // é“¾å¼å±æ€§
        "^#[a-zA-Z][a-zA-Z0-9]*$"              // å˜é‡å¼•ç”¨
    );
    
    // å±é™©å…³é”®å­—é»‘åå•
    private static final Set<String> DANGEROUS_KEYWORDS = Set.of(
        "T(", "Runtime", "exec", "ProcessBuilder",
        "Class", "forName", "getClass", "newInstance"
    );
    
    public static boolean isSafe(String expression) {
        // 1. æ£€æŸ¥é»‘åå•
        for (String keyword : DANGEROUS_KEYWORDS) {
            if (expression.contains(keyword)) {
                return false;
            }
        }
        
        // 2. æ£€æŸ¥ç™½åå•æ¨¡å¼
        for (String pattern : ALLOWED_PATTERNS) {
            if (expression.matches(pattern)) {
                return true;
            }
        }
        
        return false;
    }
    
    public static Expression parseSafely(ExpressionParser parser, String expression) {
        if (!isSafe(expression)) {
            throw new SecurityException("ä¸å®‰å…¨çš„SpELè¡¨è¾¾å¼: " + expression);
        }
        return parser.parseExpression(expression);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public void handleUserInput(String userExpression) {
    try {
        Expression exp = SpELValidator.parseSafely(parser, userExpression);
        EvaluationContext context = SimpleEvaluationContext
            .forReadOnlyDataBinding().build();
        Object result = exp.getValue(context);
        System.out.println("æ‰§è¡Œç»“æœ: " + result);
    } catch (SecurityException e) {
        System.err.println("å®‰å…¨æ£€æŸ¥å¤±è´¥: " + e.getMessage());
    }
}
```

### 7.4 å®‰å…¨æœ€ä½³å®è·µ


**æ ¸å¿ƒåŸåˆ™**ï¼š

| åŸåˆ™ | è¯´æ˜ | å®ç°æ–¹å¼ |
|------|------|----------|
| ğŸ”¸ **æœ€å°æƒé™** | åªç»™å¿…éœ€çš„æƒé™ | ä½¿ç”¨SimpleEvaluationContext |
| ğŸ”¸ **è¾“å…¥éªŒè¯** | ä¸¥æ ¼éªŒè¯ç”¨æˆ·è¾“å…¥ | ç™½åå•+é»‘åå• |
| ğŸ”¸ **ç¦ç”¨å±é™©åŠŸèƒ½** | ç¦æ­¢ç±»å‹å¼•ç”¨ã€æ„é€ å™¨ | é…ç½®ParserContext |
| ğŸ”¸ **é™åˆ¶æ‰§è¡ŒèŒƒå›´** | åªå…è®¸è®¿é—®ç‰¹å®šå¯¹è±¡ | ç²¾ç¡®æ§åˆ¶æ ¹å¯¹è±¡å’Œå˜é‡ |
| ğŸ”¸ **å®¡è®¡æ—¥å¿—** | è®°å½•è¡¨è¾¾å¼æ‰§è¡Œ | æ·»åŠ æ—¥å¿—ç›‘æ§ |

**å®‰å…¨é…ç½®æ¨¡æ¿**ï¼š
```java
public class SafeSpELService {
    
    private final ExpressionParser parser = new SpelExpressionParser();
    
    public Object evaluateSafely(String expression, Object rootObject) {
        // 1. è¾“å…¥éªŒè¯
        if (!SpELValidator.isSafe(expression)) {
            throw new SecurityException("è¡¨è¾¾å¼ä¸å®‰å…¨");
        }
        
        // 2. ä½¿ç”¨å®‰å…¨ä¸Šä¸‹æ–‡
        EvaluationContext context = SimpleEvaluationContext
            .forReadOnlyDataBinding()
            .withRootObject(rootObject)
            .build();
        
        // 3. è§£æå¹¶æ‰§è¡Œ
        Expression exp = parser.parseExpression(expression);
        
        // 4. æ·»åŠ æ—¥å¿—
        System.out.println("æ‰§è¡Œè¡¨è¾¾å¼: " + expression);
        
        return exp.getValue(context);
    }
}
```

> ğŸ”¥ **å®‰å…¨é“å¾‹**ï¼šæ°¸è¿œä¸è¦ç›´æ¥æ‰§è¡Œæ¥è‡ªç”¨æˆ·çš„SpELè¡¨è¾¾å¼ï¼

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


ğŸ¯ **ExpressionParserè§£æå™¨**
- SpelExpressionParseræ˜¯æ ‡å‡†å®ç°
- è´Ÿè´£æŠŠå­—ç¬¦ä¸²è§£ææˆExpressionå¯¹è±¡
- æ”¯æŒé…ç½®ç¼–è¯‘æ¨¡å¼ã€ç¼“å­˜å¤§å°ç­‰

ğŸ¯ **EvaluationContextä¸Šä¸‹æ–‡**
- æä¾›è¡¨è¾¾å¼æ‰§è¡Œæ‰€éœ€çš„ç¯å¢ƒ
- StandardEvaluationContextåŠŸèƒ½å®Œæ•´
- SimpleEvaluationContextæ›´å®‰å…¨

ğŸ¯ **è¡¨è¾¾å¼ç¼“å­˜**
- é¿å…é‡å¤è§£æç›¸åŒè¡¨è¾¾å¼
- ä½¿ç”¨Mapæˆ–å†…ç½®ç¼“å­˜æœºåˆ¶
- åœ¨é«˜é¢‘åœºæ™¯æ€§èƒ½æå‡10å€ä»¥ä¸Š

ğŸ¯ **æ€§èƒ½ä¼˜åŒ–**
- å¼€å¯ç¼–è¯‘æ¨¡å¼IMMEDIATE
- å¤ç”¨Contextå¯¹è±¡
- é¢„è§£æå›ºå®šè¡¨è¾¾å¼

ğŸ¯ **å®‰å…¨æœºåˆ¶**
- ä½¿ç”¨SimpleEvaluationContextå¤„ç†ç”¨æˆ·è¾“å…¥
- å®æ–½ç™½åå•+é»‘åå•éªŒè¯
- æ°¸è¿œä¸ç›´æ¥æ‰§è¡Œä¸å¯ä¿¡çš„è¡¨è¾¾å¼

### 8.2 å®é™…åº”ç”¨å»ºè®®


**é€‰æ‹©åˆé€‚çš„ä¸Šä¸‹æ–‡**ï¼š
```
å†…éƒ¨ç³»ç»Ÿã€é…ç½®æ–‡ä»¶ â†’ StandardEvaluationContext
ç”¨æˆ·è¾“å…¥ã€ç¬¬ä¸‰æ–¹æ•°æ® â†’ SimpleEvaluationContext
```

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**ï¼š
```
å›ºå®šè¡¨è¾¾å¼ â†’ ç±»æˆå‘˜å˜é‡é¢„è§£æ
åŠ¨æ€è¡¨è¾¾å¼ â†’ Mapç¼“å­˜
é«˜é¢‘è°ƒç”¨ â†’ å¼€å¯ç¼–è¯‘æ¨¡å¼
```

**å®‰å…¨é˜²æŠ¤è¦ç‚¹**ï¼š
```
âœ… ä½¿ç”¨SimpleEvaluationContext
âœ… è¡¨è¾¾å¼ç™½åå•éªŒè¯
âœ… ç¦ç”¨å±é™©åŠŸèƒ½ï¼ˆT()ã€æ„é€ å™¨ï¼‰
âœ… é™åˆ¶å¯è®¿é—®çš„å¯¹è±¡èŒƒå›´
âœ… è®°å½•æ‰§è¡Œæ—¥å¿—
```

### 8.3 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| æ€§èƒ½æ…¢ | é‡å¤è§£æè¡¨è¾¾å¼ | ä½¿ç”¨ç¼“å­˜ |
| å†…å­˜å ç”¨é«˜ | ç¼“å­˜è¿‡å¤§ | é™åˆ¶ç¼“å­˜å¤§å° |
| ç©ºæŒ‡é’ˆå¼‚å¸¸ | é“¾å¼è°ƒç”¨ä¸­é—´null | å¼€å¯autoGrowNullReferences |
| å®‰å…¨æ¼æ´ | ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥ | SimpleEvaluationContext+éªŒè¯ |
| ç±»å‹è½¬æ¢å¤±è´¥ | ç¼ºå°‘åˆé€‚çš„è½¬æ¢å™¨ | æ³¨å†Œè‡ªå®šä¹‰TypeConverter |

### 8.4 æ ¸å¿ƒè®°å¿†å£è¯€


```
ğŸ“ SpELè§£æä¸‰æ­¥èµ°ï¼š
   è§£æå™¨è¯»æ‡‚è¡¨è¾¾å¼
   ä¸Šä¸‹æ–‡æä¾›ç¯å¢ƒ
   getValueæ‰§è¡Œè·å–

âš¡ æ€§èƒ½ä¼˜åŒ–ä¸‰è¦ç´ ï¼š
   ç¼“å­˜é¿å…é‡å¤è§£æ
   ç¼–è¯‘æå‡æ‰§è¡Œé€Ÿåº¦
   å¤ç”¨å‡å°‘å¯¹è±¡åˆ›å»º

ğŸ”’ å®‰å…¨é˜²æŠ¤ä¸‰åŸåˆ™ï¼š
   Simpleä¸Šä¸‹æ–‡æœ€å®‰å…¨
   è¾“å…¥éªŒè¯ä¸å¯å°‘
   ç”¨æˆ·è¡¨è¾¾æ°¸ä¸ä¿¡
```

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šSpELè§£æå™¨æ˜¯SpELçš„æ ¸å¿ƒå¼•æ“ï¼Œç†è§£è§£æå™¨å’Œä¸Šä¸‹æ–‡çš„å·¥ä½œæœºåˆ¶ï¼Œèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨SpELï¼ŒåŒæ—¶ä¹Ÿè¦æ—¶åˆ»æ³¨æ„å®‰å…¨é—®é¢˜ï¼