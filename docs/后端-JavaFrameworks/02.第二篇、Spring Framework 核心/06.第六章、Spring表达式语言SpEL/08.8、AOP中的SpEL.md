---
title: 8ã€AOPä¸­çš„SpEL
---
## ğŸ“š ç›®å½•

1. [SpELåœ¨AOPä¸­çš„ä½œç”¨](#1-SpELåœ¨AOPä¸­çš„ä½œç”¨)
2. [åˆ‡å…¥ç‚¹è¡¨è¾¾å¼åŸºç¡€](#2-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼åŸºç¡€)
3. [å‚æ•°ç»‘å®šä¸è·å–](#3-å‚æ•°ç»‘å®šä¸è·å–)
4. [æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼](#4-æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼)
5. [åŠ¨æ€åˆ‡å…¥ç‚¹é…ç½®](#5-åŠ¨æ€åˆ‡å…¥ç‚¹é…ç½®)
6. [æ–¹æ³•åŒ¹é…æŠ€å·§](#6-æ–¹æ³•åŒ¹é…æŠ€å·§)
7. [è¿è¡Œæ—¶è®¡ç®—åº”ç”¨](#7-è¿è¡Œæ—¶è®¡ç®—åº”ç”¨)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ SpELåœ¨AOPä¸­çš„ä½œç”¨


### 1.1 ä»€ä¹ˆæ˜¯AOPä¸­çš„SpEL


**é€šä¿—ç†è§£**ï¼šSpELï¼ˆSpring Expression Languageï¼‰åœ¨AOPä¸­å°±åƒæ˜¯ä¸€ä¸ª"æ™ºèƒ½è¿‡æ»¤å™¨"å’Œ"æ•°æ®æå–å™¨"ã€‚

```
ç±»æ¯”ç†è§£ï¼š
å°±åƒä½ åœ¨å›¾ä¹¦é¦†æ‰¾ä¹¦ï¼š
âŒ ä¼ ç»Ÿæ–¹å¼ï¼šåªèƒ½æŒ‰ä¹¦æ¶å·æ‰¾ï¼ˆå›ºå®šè§„åˆ™ï¼‰
âœ… SpELæ–¹å¼ï¼šå¯ä»¥æŒ‰"ä½œè€…æ˜¯è°"ã€"ä»·æ ¼å¤šå°‘"ã€"æ˜¯å¦ç•…é”€"ç­‰çµæ´»æ¡ä»¶æ‰¾

AOPä¸­çš„SpELè®©ä½ å¯ä»¥ï¼š
â€¢ çµæ´»å†³å®šåœ¨å“ªäº›æ–¹æ³•ä¸Šåº”ç”¨å¢å¼º
â€¢ åŠ¨æ€è·å–æ–¹æ³•çš„å‚æ•°å€¼
â€¢ æ ¹æ®è¿è¡Œæ—¶æ¡ä»¶åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ
â€¢ æå–å’Œä½¿ç”¨æ–¹æ³•æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦SpEL


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

| åœºæ™¯ | ä¼ ç»Ÿæ–¹å¼çš„å±€é™ | SpELçš„è§£å†³æ–¹æ¡ˆ |
|------|--------------|---------------|
| **æ–¹æ³•åŒ¹é…** | åªèƒ½æŒ‰æ–¹æ³•ååŒ¹é… | å¯ä»¥æŒ‰å‚æ•°å€¼ã€è¿”å›å€¼ã€æ³¨è§£å±æ€§åŒ¹é… |
| **å‚æ•°è·å–** | æ‰‹åŠ¨ç¼–å†™ä»£ç è·å– | è¡¨è¾¾å¼ç›´æ¥å¼•ç”¨ `#å‚æ•°å` |
| **æ¡ä»¶åˆ¤æ–­** | éœ€è¦åœ¨ä»£ç ä¸­åˆ¤æ–­ | è¡¨è¾¾å¼ä¸­ç›´æ¥å†™æ¡ä»¶ `#age > 18` |
| **åŠ¨æ€é…ç½®** | å†™æ­»åœ¨ä»£ç ä¸­ | å¯ä»¥ä»é…ç½®æ–‡ä»¶è¯»å– |

### 1.3 SpELåœ¨AOPä¸­çš„åº”ç”¨åœºæ™¯


```
å®é™…åº”ç”¨ç¤ºæ„ï¼š

åœºæ™¯1ï¼šæƒé™æ§åˆ¶
@PreAuthorize("hasRole('ADMIN') and #user.age >= 18")
              â†‘ SpELè¡¨è¾¾å¼åˆ¤æ–­ï¼šå¿…é¡»æ˜¯ç®¡ç†å‘˜ä¸”å¹´é¾„â‰¥18

åœºæ™¯2ï¼šæ—¥å¿—è®°å½•
@AfterReturning(value="...", returning="result")
public void log(Object result) {
    // ä½¿ç”¨SpELè·å–è¿”å›å€¼
}

åœºæ™¯3ï¼šç¼“å­˜ç®¡ç†
@Cacheable(key="#user.id + '-' + #type")
                â†‘ SpELåŠ¨æ€ç”Ÿæˆç¼“å­˜key

åœºæ™¯4ï¼šå‚æ•°éªŒè¯
åªå¯¹price > 100çš„å•†å“æ‰§è¡Œå®¡æ ¸é€»è¾‘
```

---

## 2. ğŸ” åˆ‡å…¥ç‚¹è¡¨è¾¾å¼åŸºç¡€


### 2.1 åŸºæœ¬åˆ‡å…¥ç‚¹è¯­æ³•


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼å‘Šè¯‰Spring"åœ¨å“ªäº›æ–¹æ³•ä¸Šåº”ç”¨å¢å¼ºé€»è¾‘"ã€‚

```java
// åŸºç¡€è¯­æ³•ç»“æ„
@Pointcut("execution(è¿”å›å€¼ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°))")

// å®é™…ç¤ºä¾‹
@Pointcut("execution(* com.example.service.*.*(..))")
//           â†‘      â†‘        â†‘          â†‘   â†‘  â†‘
//         è¿”å›å€¼  åŒ…å    ç±»åé€šé…ç¬¦  æ–¹æ³•  å‚æ•°
```

**é€šé…ç¬¦è¯´æ˜**ï¼š

| ç¬¦å· | å«ä¹‰ | ç¤ºä¾‹ |
|-----|------|-----|
| `*` | åŒ¹é…ä»»æ„å­—ç¬¦ | `*Service` åŒ¹é…æ‰€æœ‰Serviceç»“å°¾çš„ç±» |
| `..` | åŒ¹é…ä»»æ„å±‚çº§ | `com.example..` åŒ¹é…exampleä¸‹æ‰€æœ‰å­åŒ… |
| `+` | åŒ¹é…å­ç±» | `BaseService+` åŒ¹é…BaseServiceçš„æ‰€æœ‰å­ç±» |

### 2.2 ç»“åˆSpELçš„åˆ‡å…¥ç‚¹


**SpELå¢å¼ºçš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼**ï¼š

```java
// ä¼ ç»Ÿæ–¹å¼ï¼šåªèƒ½åŒ¹é…æ–¹æ³•ç­¾å
@Pointcut("execution(* com.example.service.UserService.update*(..))")

// SpELæ–¹å¼ï¼šå¯ä»¥ç»“åˆæ³¨è§£å±æ€§åŒ¹é…
@Pointcut("@annotation(logAnnotation) && " +
          "@annotation(org.springframework.web.bind.annotation.RequestMapping)")
```

**å®æˆ˜ç¤ºä¾‹**ï¼š

```java
// å®šä¹‰åˆ‡å…¥ç‚¹ï¼šåŒ¹é…å¸¦æœ‰ç‰¹å®šæ³¨è§£çš„æ–¹æ³•
@Pointcut("@annotation(com.example.annotation.DataLog)")
public void dataLogPointcut() {}

// è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataLog {
    String value() default "";  // æ—¥å¿—æè¿°
    String type() default "INFO"; // æ—¥å¿—ç±»å‹
}

// ä½¿ç”¨æ³¨è§£
@DataLog(value = "æ›´æ–°ç”¨æˆ·ä¿¡æ¯", type = "WARN")
public void updateUser(User user) {
    // ä¸šåŠ¡é€»è¾‘
}
```

### 2.3 SpELè¡¨è¾¾å¼çš„åˆ‡å…¥ç‚¹åŒ¹é…


**æ ¹æ®æ³¨è§£å±æ€§åŒ¹é…**ï¼š

```java
// åœºæ™¯ï¼šåªå¯¹æ ‡è®°ä¸º"é‡è¦æ“ä½œ"çš„æ–¹æ³•åº”ç”¨å®¡è®¡
@Around("@annotation(operation) && args(param)")
public Object auditImportant(ProceedingJoinPoint pjp, 
                             Operation operation, 
                             Object param) throws Throwable {
    
    // ä½¿ç”¨SpELåˆ¤æ–­æ³¨è§£å±æ€§
    if ("IMPORTANT".equals(operation.level())) {
        System.out.println("è®°å½•é‡è¦æ“ä½œå®¡è®¡");
    }
    
    return pjp.proceed();
}

// æ³¨è§£å®šä¹‰
@interface Operation {
    String level() default "NORMAL";
}
```

**æµç¨‹å›¾ç¤º**ï¼š

```
æ–¹æ³•è°ƒç”¨
   â†“
æ£€æŸ¥æ˜¯å¦æœ‰@Operationæ³¨è§£
   â†“
æœ‰ â†’ æå–levelå±æ€§å€¼
   â†“
level == "IMPORTANT" ?
   â†“                â†“
  æ˜¯               å¦
   â†“                â†“
è®°å½•å®¡è®¡          è·³è¿‡
   â†“                â†“
æ‰§è¡ŒåŸæ–¹æ³•    æ‰§è¡ŒåŸæ–¹æ³•
```

---

## 3. ğŸ“¦ å‚æ•°ç»‘å®šä¸è·å–


### 3.1 å‚æ•°ç»‘å®šçš„åŸºæœ¬æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šå‚æ•°ç»‘å®šå°±æ˜¯"æŠŠæ–¹æ³•çš„å‚æ•°å€¼æ‹¿å‡ºæ¥ç”¨"ã€‚

```
ç±»æ¯”è¯´æ˜ï¼š

åŸå§‹æ–¹æ³•ï¼šsaveUser(User user, String source)
         
ä¼ ç»Ÿè·å–å‚æ•°ï¼š
éœ€è¦å†™ä¸€å †ä»£ç ä»JoinPointä¸­æå–

SpELè·å–å‚æ•°ï¼š
ç›´æ¥ç”¨ #user å’Œ #source å¼•ç”¨ï¼Œç®€å•æ˜äº†ï¼
```

### 3.2 ä½¿ç”¨argsç»‘å®šå‚æ•°


**åŸºç¡€è¯­æ³•**ï¼š

```java
// æ–¹å¼1ï¼šåœ¨åˆ‡å…¥ç‚¹ä¸­ç»‘å®š
@Before("execution(* save*(..)) && args(entity)")
public void beforeSave(Object entity) {
    System.out.println("ä¿å­˜çš„å®ä½“ï¼š" + entity);
}

// æ–¹å¼2ï¼šä½¿ç”¨SpELè¡¨è¾¾å¼å¼•ç”¨
@Before("execution(* updateUser(..)) && args(user, source)")
public void logUpdate(User user, String source) {
    System.out.println("ç”¨æˆ·ï¼š" + user.getName());
    System.out.println("æ¥æºï¼š" + source);
}
```

**å®æˆ˜æ¡ˆä¾‹ï¼šå‚æ•°æ ¡éªŒ**

```java
// ä¸šåŠ¡æ–¹æ³•
public void transfer(Account from, Account to, BigDecimal amount) {
    // è½¬è´¦é€»è¾‘
}

// AOPå¢å¼ºï¼šè‡ªåŠ¨æ ¡éªŒå‚æ•°
@Before("execution(* transfer(..)) && args(from, to, amount)")
public void validateTransfer(Account from, Account to, BigDecimal amount) {
    // ä½¿ç”¨ç»‘å®šçš„å‚æ•°è¿›è¡Œæ ¡éªŒ
    if (amount.compareTo(BigDecimal.ZERO) <= 0) {
        throw new IllegalArgumentException("è½¬è´¦é‡‘é¢å¿…é¡»å¤§äº0");
    }
    if (from.getBalance().compareTo(amount) < 0) {
        throw new IllegalArgumentException("ä½™é¢ä¸è¶³");
    }
    System.out.println("æ ¡éªŒé€šè¿‡ï¼šä»è´¦æˆ·" + from.getId() + "è½¬å‡º" + amount);
}
```

### 3.3 SpELè¡¨è¾¾å¼è·å–å‚æ•°å±æ€§


**æ·±åº¦è·å–å‚æ•°çš„å±æ€§**ï¼š

```java
// æ³¨è§£ä¸­ä½¿ç”¨SpELè·å–å‚æ•°çš„å±æ€§
@Cacheable(key = "#user.id")  // è·å–userå¯¹è±¡çš„idå±æ€§
public User getUserInfo(User user) {
    return userService.query(user.getId());
}

// å¤æ‚SpELè¡¨è¾¾å¼
@Cacheable(key = "#user.department.id + '-' + #user.role")
//                â†‘ è·å–userçš„departmentå¯¹è±¡çš„id
//                                           â†‘ æ‹¼æ¥userçš„role
public List<Permission> getPermissions(User user) {
    return permissionService.query(user);
}
```

**SpELå‚æ•°è¡¨è¾¾å¼é€ŸæŸ¥**ï¼š

| è¡¨è¾¾å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `#å‚æ•°å` | ç›´æ¥å¼•ç”¨å‚æ•° | `#user` |
| `#å‚æ•°å.å±æ€§` | è·å–å‚æ•°çš„å±æ€§ | `#user.name` |
| `#å‚æ•°å.æ–¹æ³•()` | è°ƒç”¨å‚æ•°çš„æ–¹æ³• | `#user.getAge()` |
| `#å‚æ•°å[ç´¢å¼•]` | è·å–æ•°ç»„/åˆ—è¡¨å…ƒç´  | `#users[0]` |
| `#å‚æ•°å['key']` | è·å–Mapçš„å€¼ | `#params['id']` |

### 3.4 è·å–æ–¹æ³•è¿”å›å€¼


**ä½¿ç”¨returningç»‘å®šè¿”å›å€¼**ï¼š

```java
// æ–¹æ³•å®šä¹‰
public User register(String username, String password) {
    User user = new User(username, password);
    // æ³¨å†Œé€»è¾‘
    return user;
}

// AOPè·å–è¿”å›å€¼
@AfterReturning(
    pointcut = "execution(* register(..))",
    returning = "result"  // ç»‘å®šè¿”å›å€¼åˆ°resultå˜é‡
)
public void afterRegister(Object result) {
    User user = (User) result;
    System.out.println("æ³¨å†ŒæˆåŠŸï¼Œç”¨æˆ·IDï¼š" + user.getId());
    // å¯ä»¥å‘é€æ¬¢è¿é‚®ä»¶ç­‰åç»­æ“ä½œ
}
```

**ç»“åˆSpELä½¿ç”¨è¿”å›å€¼**ï¼š

```java
// åœ¨æ³¨è§£ä¸­ä½¿ç”¨SpELå¼•ç”¨è¿”å›å€¼
@CachePut(key = "#result.id")  // ç”¨è¿”å›çš„ç”¨æˆ·IDä½œä¸ºç¼“å­˜key
@AfterReturning(pointcut = "execution(* save*(..))", 
                returning = "result")
public void cacheResult(Object result) {
    // è‡ªåŠ¨ç¼“å­˜è¿”å›ç»“æœ
}
```

---

## 4. âš–ï¸ æ¡ä»¶åˆ¤æ–­è¡¨è¾¾å¼


### 4.1 æ¡ä»¶åˆ¤æ–­çš„åŸºæœ¬ç”¨æ³•


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ¡ä»¶åˆ¤æ–­è®©AOP"æœ‰é€‰æ‹©åœ°"æ‰§è¡Œå¢å¼ºé€»è¾‘ã€‚

```
é€»è¾‘æµç¨‹ï¼š

æ–¹æ³•è°ƒç”¨ â†’ æ£€æŸ¥æ¡ä»¶ â†’ æ¡ä»¶æˆç«‹ï¼Ÿ
                        â†“        â†“
                       æ˜¯       å¦
                        â†“        â†“
                   æ‰§è¡Œå¢å¼º    è·³è¿‡å¢å¼º
                        â†“        â†“
                   æ‰§è¡ŒåŸæ–¹æ³•  æ‰§è¡ŒåŸæ–¹æ³•
```

### 4.2 ä½¿ç”¨@PreAuthorizeæ¡ä»¶åˆ¤æ–­


**æƒé™æ§åˆ¶åœºæ™¯**ï¼š

```java
// åªæœ‰ç®¡ç†å‘˜å¯ä»¥åˆ é™¤ç”¨æˆ·
@PreAuthorize("hasRole('ADMIN')")
public void deleteUser(Long userId) {
    userRepository.deleteById(userId);
}

// å¤æ‚æ¡ä»¶ï¼šç®¡ç†å‘˜æˆ–è€…æ˜¯ç”¨æˆ·æœ¬äºº
@PreAuthorize("hasRole('ADMIN') or #userId == authentication.principal.id")
//              â†‘ æ˜¯ç®¡ç†å‘˜        æˆ–    â†‘ æ˜¯ç”¨æˆ·æœ¬äºº
public void updateUser(Long userId, User user) {
    // æ›´æ–°é€»è¾‘
}
```

**SpELæ¡ä»¶è¡¨è¾¾å¼é€ŸæŸ¥**ï¼š

| è¡¨è¾¾å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `==` / `!=` | ç­‰äº/ä¸ç­‰äº | `#age == 18` |
| `>` / `<` / `>=` / `<=` | æ¯”è¾ƒè¿ç®— | `#price >= 100` |
| `and` / `or` / `not` | é€»è¾‘è¿ç®— | `#isVip and #level > 5` |
| `? :` | ä¸‰å…ƒè¿ç®—ç¬¦ | `#age >= 18 ? 'adult' : 'child'` |

### 4.3 è‡ªå®šä¹‰æ¡ä»¶åˆ¤æ–­


**å®æˆ˜æ¡ˆä¾‹ï¼šæ ¹æ®å‚æ•°å€¼å†³å®šæ˜¯å¦æ‰§è¡Œ**

```java
// è‡ªå®šä¹‰åˆ‡é¢
@Aspect
@Component
public class ConditionalAspect {
    
    // åªå¯¹é‡‘é¢å¤§äº1000çš„è®¢å•è®°å½•æ—¥å¿—
    @Around("execution(* createOrder(..)) && args(order)")
    public Object logLargeOrder(ProceedingJoinPoint pjp, Order order) 
            throws Throwable {
        
        // æ¡ä»¶åˆ¤æ–­
        if (order.getAmount().compareTo(new BigDecimal("1000")) > 0) {
            System.out.println("åˆ›å»ºå¤§é¢è®¢å•ï¼š" + order.getAmount());
        }
        
        return pjp.proceed();
    }
}
```

### 4.4 ç»“åˆSpELçš„æ¡ä»¶åˆ‡å…¥ç‚¹


**ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼è¿‡æ»¤æ–¹æ³•**ï¼š

```java
// å®šä¹‰æ¡ä»¶åˆ‡å…¥ç‚¹
@Pointcut("execution(* com.example.service.*.*(..)) && " +
          "@annotation(cacheable)")
public void cacheableMethod(Cacheable cacheable) {}

// åº”ç”¨å¢å¼ºï¼šæ ¹æ®æ³¨è§£æ¡ä»¶å†³å®šæ˜¯å¦ç¼“å­˜
@Around("cacheableMethod(cacheable)")
public Object cacheIfNeeded(ProceedingJoinPoint pjp, 
                            Cacheable cacheable) throws Throwable {
    
    // SpELæ¡ä»¶åˆ¤æ–­æ³¨è§£çš„conditionå±æ€§
    if (evaluateCondition(cacheable.condition())) {
        // ä»ç¼“å­˜è·å–
        Object cached = getFromCache(pjp);
        if (cached != null) {
            return cached;
        }
    }
    
    Object result = pjp.proceed();
    // å­˜å…¥ç¼“å­˜
    return result;
}

// ä½¿ç”¨ç¤ºä¾‹
@Cacheable(condition = "#user.level > 5")  // åªç¼“å­˜é«˜ç­‰çº§ç”¨æˆ·
public User getUserDetail(User user) {
    return userService.getDetail(user.getId());
}
```

**æ¡ä»¶åˆ¤æ–­å†³ç­–æ ‘**ï¼š

```
æ¥æ”¶åˆ°æ–¹æ³•è°ƒç”¨
       â†“
   æœ‰æ¡ä»¶æ³¨è§£ï¼Ÿ
     â†™    â†˜
   æœ‰       æ— 
    â†“        â†“
è§£æSpEL  ç›´æ¥æ‰§è¡Œ
è¡¨è¾¾å¼      å¢å¼º
    â†“        â†“
 æ¡ä»¶=true?  
  â†™    â†˜
æ˜¯      å¦
 â†“       â†“
æ‰§è¡Œ    è·³è¿‡
å¢å¼º    å¢å¼º
```

---

## 5. ğŸ”„ åŠ¨æ€åˆ‡å…¥ç‚¹é…ç½®


### 5.1 ä»€ä¹ˆæ˜¯åŠ¨æ€åˆ‡å…¥ç‚¹


**é€šä¿—è§£é‡Š**ï¼šåŠ¨æ€åˆ‡å…¥ç‚¹å°±æ˜¯"è¿è¡Œæ—¶æ‰å†³å®šè¦ä¸è¦æ‹¦æˆªè¿™ä¸ªæ–¹æ³•"ã€‚

```
é™æ€åˆ‡å…¥ç‚¹ vs åŠ¨æ€åˆ‡å…¥ç‚¹ï¼š

é™æ€åˆ‡å…¥ç‚¹ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰ï¼š
@Pointcut("execution(* com.example.service.*.*(..))")
         â†‘ å†™æ­»çš„åŒ…åå’Œç±»åï¼Œä¸ä¼šå˜

åŠ¨æ€åˆ‡å…¥ç‚¹ï¼ˆè¿è¡Œæ—¶ç¡®å®šï¼‰ï¼š
æ ¹æ®æ–¹æ³•å‚æ•°å€¼ã€è¿”å›å€¼ã€ç³»ç»ŸçŠ¶æ€ç­‰è¿è¡Œæ—¶ä¿¡æ¯å†³å®š
```

### 5.2 å®ç°åŠ¨æ€åˆ‡å…¥ç‚¹


**æ–¹å¼1ï¼šåŸºäºå‚æ•°å€¼çš„åŠ¨æ€åˆ¤æ–­**

```java
@Aspect
@Component
public class DynamicPointcutAspect {
    
    // åŒ¹é…æ‰€æœ‰æ–¹æ³•ï¼Œä½†è¿è¡Œæ—¶åŠ¨æ€åˆ¤æ–­
    @Around("execution(* com.example.service.*.*(..))")
    public Object dynamicIntercept(ProceedingJoinPoint pjp) throws Throwable {
        
        // è·å–æ–¹æ³•å‚æ•°
        Object[] args = pjp.getArgs();
        
        // åŠ¨æ€æ¡ä»¶ï¼šå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯VIPç”¨æˆ·ï¼Œæ‰æ‰§è¡Œå¢å¼º
        if (args.length > 0 && args[0] instanceof User) {
            User user = (User) args[0];
            if ("VIP".equals(user.getLevel())) {
                System.out.println("VIPç”¨æˆ·æ“ä½œï¼Œè®°å½•æ—¥å¿—");
            }
        }
        
        return pjp.proceed();
    }
}
```

**æ–¹å¼2ï¼šåŸºäºé…ç½®çš„åŠ¨æ€åˆ‡å…¥ç‚¹**

```java
@Aspect
@Component
public class ConfigurableAspect {
    
    @Value("${aop.intercept.enabled:false}")  // ä»é…ç½®æ–‡ä»¶è¯»å–
    private boolean interceptEnabled;
    
    @Value("${aop.intercept.packages}")  // åŠ¨æ€é…ç½®è¦æ‹¦æˆªçš„åŒ…
    private String[] packages;
    
    @Around("execution(* *(..))")
    public Object configBasedIntercept(ProceedingJoinPoint pjp) 
            throws Throwable {
        
        // æ ¹æ®é…ç½®å†³å®šæ˜¯å¦æ‹¦æˆª
        if (!interceptEnabled) {
            return pjp.proceed();
        }
        
        String className = pjp.getTarget().getClass().getName();
        boolean shouldIntercept = Arrays.stream(packages)
            .anyMatch(pkg -> className.startsWith(pkg));
        
        if (shouldIntercept) {
            System.out.println("æ‹¦æˆªæ–¹æ³•ï¼š" + pjp.getSignature());
        }
        
        return pjp.proceed();
    }
}
```

**é…ç½®æ–‡ä»¶**ï¼ˆapplication.ymlï¼‰ï¼š

```yaml
aop:
  intercept:
    enabled: true
    packages:
      - com.example.service
      - com.example.controller
```

### 5.3 SpELåŠ¨æ€è¡¨è¾¾å¼


**ä½¿ç”¨SpELå®ç°çµæ´»çš„åŠ¨æ€åˆ‡å…¥ç‚¹**ï¼š

```java
// è‡ªå®šä¹‰æ³¨è§£ï¼Œæ”¯æŒSpELè¡¨è¾¾å¼
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface ConditionalLog {
    String condition() default "true";  // SpELæ¡ä»¶è¡¨è¾¾å¼
}

// åˆ‡é¢å®ç°
@Aspect
@Component
public class ConditionalLogAspect {
    
    @Autowired
    private SpelExpressionParser parser = new SpelExpressionParser();
    
    @Around("@annotation(conditionalLog)")
    public Object conditionalLogging(ProceedingJoinPoint pjp, 
                                    ConditionalLog conditionalLog) 
            throws Throwable {
        
        // åˆ›å»ºSpELä¸Šä¸‹æ–‡
        StandardEvaluationContext context = new StandardEvaluationContext();
        
        // ç»‘å®šæ–¹æ³•å‚æ•°åˆ°SpELä¸Šä¸‹æ–‡
        MethodSignature signature = (MethodSignature) pjp.getSignature();
        String[] paramNames = signature.getParameterNames();
        Object[] args = pjp.getArgs();
        
        for (int i = 0; i < paramNames.length; i++) {
            context.setVariable(paramNames[i], args[i]);
        }
        
        // è§£æå¹¶æ‰§è¡ŒSpELæ¡ä»¶è¡¨è¾¾å¼
        Expression exp = parser.parseExpression(conditionalLog.condition());
        Boolean result = exp.getValue(context, Boolean.class);
        
        // æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦è®°å½•æ—¥å¿—
        if (Boolean.TRUE.equals(result)) {
            System.out.println("æ¡ä»¶æ»¡è¶³ï¼Œè®°å½•æ—¥å¿—");
        }
        
        return pjp.proceed();
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@ConditionalLog(condition = "#amount > 1000 and #user.level == 'VIP'")
public void processPayment(User user, BigDecimal amount) {
    // æ”¯ä»˜é€»è¾‘
}
```

### 5.4 åŠ¨æ€åˆ‡å…¥ç‚¹çš„åº”ç”¨åœºæ™¯


**åœºæ™¯å¯¹æ¯”è¡¨**ï¼š

| åº”ç”¨åœºæ™¯ | é™æ€åˆ‡å…¥ç‚¹ | åŠ¨æ€åˆ‡å…¥ç‚¹ |
|---------|-----------|-----------|
| **åŒ…åå›ºå®šçš„æ—¥å¿—** | âœ… é€‚ç”¨ | âŒ è¿‡åº¦è®¾è®¡ |
| **æ ¹æ®ç”¨æˆ·ç­‰çº§çš„æƒé™æ§åˆ¶** | âŒ æ— æ³•å®ç° | âœ… å¿…é¡»ä½¿ç”¨ |
| **å¼€å…³æ§åˆ¶çš„åŠŸèƒ½** | âŒ éœ€è¦é‡å¯ | âœ… åŠ¨æ€é…ç½® |
| **ABæµ‹è¯•** | âŒ æ— æ³•çµæ´»åˆ‡æ¢ | âœ… è¿è¡Œæ—¶åˆ¤æ–­ |

---

## 6. ğŸ¯ æ–¹æ³•åŒ¹é…æŠ€å·§


### 6.1 ç²¾ç¡®åŒ¹é…æ–¹æ³•


**åŸºæœ¬åŒ¹é…è§„åˆ™**ï¼š

```java
// 1. ç²¾ç¡®åŒ¹é…ï¼šå®Œæ•´çš„æ–¹æ³•ç­¾å
@Pointcut("execution(public User com.example.service.UserService.getById(Long))")
//                    â†‘      â†‘           â†‘              â†‘        â†‘      â†‘
//                  ä¿®é¥°ç¬¦  è¿”å›å€¼        åŒ…å          ç±»å    æ–¹æ³•å  å‚æ•°ç±»å‹

// 2. é€šé…ç¬¦åŒ¹é…
@Pointcut("execution(* com.example.service.*.*(..))")
//                    â†‘         â†‘           â†‘  â†‘  â†‘
//                 ä»»æ„è¿”å›å€¼   åŒ…å     æ‰€æœ‰ç±» æ‰€æœ‰æ–¹æ³• ä»»æ„å‚æ•°
```

### 6.2 æŒ‰æ–¹æ³•ç‰¹å¾åŒ¹é…


**åŒ¹é…æ–¹æ³•åæ¨¡å¼**ï¼š

```java
// åŒ¹é…æ‰€æœ‰getå¼€å¤´çš„æ–¹æ³•
@Pointcut("execution(* get*(..))")

// åŒ¹é…æ‰€æœ‰ä»¥Serviceç»“å°¾çš„ç±»çš„æ–¹æ³•
@Pointcut("execution(* *..*Service.*(..))")

// åŒ¹é…ç‰¹å®šè¿”å›å€¼ç±»å‹
@Pointcut("execution(com.example.dto.UserDTO *(..))")
```

**æŒ‰æ³¨è§£åŒ¹é…**ï¼š

```java
// åŒ¹é…æ ‡æ³¨äº†@Transactionalçš„æ–¹æ³•
@Pointcut("@annotation(org.springframework.transaction.annotation.Transactional)")

// åŒ¹é…ç±»ä¸Šæœ‰@Serviceæ³¨è§£çš„æ‰€æœ‰æ–¹æ³•
@Pointcut("@within(org.springframework.stereotype.Service)")

// åŒ¹é…ç‰¹å®šæ³¨è§£çš„ç±»çš„ç‰¹å®šæ–¹æ³•
@Pointcut("@within(org.springframework.stereotype.Service) && execution(* save*(..))")
```

### 6.3 å¤åˆåŒ¹é…æ¡ä»¶


**ç»„åˆå¤šä¸ªæ¡ä»¶**ï¼š

```java
// ä½¿ç”¨ && (ä¸)ã€|| (æˆ–)ã€! (é) ç»„åˆæ¡ä»¶
@Pointcut("execution(* com.example.service.*.*(..)) && " +
          "@annotation(org.springframework.web.bind.annotation.PostMapping)")
//         â†‘ serviceåŒ…çš„æ‰€æœ‰æ–¹æ³•           å¹¶ä¸”       â†‘ æœ‰@PostMappingæ³¨è§£

// æ’é™¤ç‰¹å®šæ–¹æ³•
@Pointcut("execution(* com.example.service.*.*(..)) && " +
          "!execution(* com.example.service.*.get*(..))")
//         â†‘ serviceåŒ…çš„æ–¹æ³•               ä½†ä¸åŒ…æ‹¬    â†‘ getå¼€å¤´çš„æ–¹æ³•
```

**å®æˆ˜æ¡ˆä¾‹ï¼šåˆ†å±‚åŒ¹é…**

```java
@Aspect
@Component
public class LayeredMatchingAspect {
    
    // Controllerå±‚çš„åŒ¹é…
    @Pointcut("@within(org.springframework.web.bind.annotation.RestController)")
    public void controllerLayer() {}
    
    // Serviceå±‚çš„åŒ¹é…
    @Pointcut("@within(org.springframework.stereotype.Service)")
    public void serviceLayer() {}
    
    // DAOå±‚çš„åŒ¹é…
    @Pointcut("@within(org.springframework.stereotype.Repository)")
    public void daoLayer() {}
    
    // ç»„åˆä½¿ç”¨ï¼šè®°å½•Serviceå’ŒControllerçš„æ–¹æ³•è°ƒç”¨
    @Before("controllerLayer() || serviceLayer()")
    public void logApiCall(JoinPoint jp) {
        System.out.println("APIè°ƒç”¨ï¼š" + jp.getSignature());
    }
    
    // åªè®°å½•DAOå±‚çš„å†™æ“ä½œ
    @Before("daoLayer() && (execution(* save*(..)) || execution(* update*(..)) || execution(* delete*(..)))")
    public void logDaoWrite(JoinPoint jp) {
        System.out.println("æ•°æ®å†™å…¥ï¼š" + jp.getSignature());
    }
}
```

### 6.4 å‚æ•°ç±»å‹åŒ¹é…


**æŒ‰å‚æ•°ç±»å‹è¿‡æ»¤æ–¹æ³•**ï¼š

```java
// åŒ¹é…ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Userç±»å‹çš„æ–¹æ³•
@Pointcut("execution(* *(com.example.entity.User, ..))")
//                       â†‘      â†‘                  â†‘
//                    ä»»æ„æ–¹æ³•  ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯User  åé¢å¯ä»¥æœ‰å…¶ä»–å‚æ•°

// åŒ¹é…åªæœ‰ä¸€ä¸ªStringå‚æ•°çš„æ–¹æ³•
@Pointcut("execution(* *(String))")

// åŒ¹é…æ— å‚æ–¹æ³•
@Pointcut("execution(* *())")
```

**æ–¹æ³•åŒ¹é…å†³ç­–æµç¨‹**ï¼š

```
å¾…åŒ¹é…æ–¹æ³•
    â†“
æ£€æŸ¥è¿”å›å€¼ç±»å‹
    â†“ åŒ¹é…
æ£€æŸ¥åŒ…åå’Œç±»å
    â†“ åŒ¹é…
æ£€æŸ¥æ–¹æ³•åæ¨¡å¼
    â†“ åŒ¹é…
æ£€æŸ¥å‚æ•°ç±»å‹
    â†“ åŒ¹é…
æ£€æŸ¥æ³¨è§£ä¿¡æ¯
    â†“ åŒ¹é…
    â†“
âœ… åº”ç”¨AOPå¢å¼º
```

---

## 7. â±ï¸ è¿è¡Œæ—¶è®¡ç®—åº”ç”¨


### 7.1 è¿è¡Œæ—¶è®¡ç®—çš„æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šè¿è¡Œæ—¶è®¡ç®—å°±æ˜¯"åœ¨æ–¹æ³•æ‰§è¡Œæ—¶åŠ¨æ€ç®—å‡ºä¸€ä¸ªå€¼"ã€‚

```
ç¼–è¯‘æ—¶ vs è¿è¡Œæ—¶ï¼š

ç¼–è¯‘æ—¶ï¼ˆå†™æ­»çš„ï¼‰ï¼š
@Cacheable(key = "user-123")  
          â†‘ å›ºå®šçš„ç¼“å­˜key

è¿è¡Œæ—¶ï¼ˆåŠ¨æ€è®¡ç®—ï¼‰ï¼š
@Cacheable(key = "#user.id + '-' + #user.department")
          â†‘ æ ¹æ®å®é™…å‚æ•°åŠ¨æ€ç”Ÿæˆkey
```

### 7.2 SpELè¿è¡Œæ—¶è¡¨è¾¾å¼


**åŸºæœ¬è¿ç®—ç¬¦**ï¼š

| è¿ç®—ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `+` | åŠ æ³•/å­—ç¬¦ä¸²æ‹¼æ¥ | `#a + #b` æˆ– `'user-' + #id` |
| `-` `*` `/` `%` | ç®—æœ¯è¿ç®— | `#price * 0.8` |
| `==` `!=` `>` `<` | æ¯”è¾ƒè¿ç®— | `#age >= 18` |
| `and` `or` `not` | é€»è¾‘è¿ç®— | `#isVip and #level > 5` |
| `?:` | ä¸‰å…ƒè¿ç®— | `#age >= 18 ? 'adult' : 'child'` |

### 7.3 åŠ¨æ€ç”Ÿæˆç¼“å­˜Key


**å®æˆ˜æ¡ˆä¾‹**ï¼š

```java
// ç®€å•æ‹¼æ¥
@Cacheable(key = "'user-' + #userId")
public User getUserById(Long userId) {
    return userRepository.findById(userId);
}

// å¤šå‚æ•°ç»„åˆ
@Cacheable(key = "#user.id + '-' + #type + '-' + #date.toString()")
public Report generateReport(User user, String type, LocalDate date) {
    return reportService.generate(user, type, date);
}

// å¤æ‚è¡¨è¾¾å¼
@Cacheable(key = "#user.department.id + ':' + " +
                 "(#includeHistory ? 'full' : 'basic')")
public UserProfile getProfile(User user, boolean includeHistory) {
    return profileService.query(user, includeHistory);
}
```

### 7.4 æ¡ä»¶ç¼“å­˜


**æ ¹æ®è¿è¡Œæ—¶æ¡ä»¶å†³å®šæ˜¯å¦ç¼“å­˜**ï¼š

```java
// åªç¼“å­˜VIPç”¨æˆ·çš„æŸ¥è¯¢
@Cacheable(
    key = "#user.id",
    condition = "#user.level == 'VIP'"  // è¿è¡Œæ—¶åˆ¤æ–­æ¡ä»¶
)
public List<Order> getUserOrders(User user) {
    return orderRepository.findByUserId(user.getId());
}

// æ’é™¤æŸäº›ç»“æœä¸ç¼“å­˜
@Cacheable(
    key = "#productId",
    unless = "#result == null || #result.price <= 0"  // ç»“æœä¸ºç©ºæˆ–ä»·æ ¼<=0ä¸ç¼“å­˜
)
public Product getProduct(Long productId) {
    return productRepository.findById(productId);
}
```

**condition vs unless å¯¹æ¯”**ï¼š

```
æ—¶åºå¯¹æ¯”ï¼š

æ–¹æ³•æ‰§è¡Œå‰              æ–¹æ³•æ‰§è¡Œ             æ–¹æ³•æ‰§è¡Œå
    â†“                     â†“                    â†“
conditionåˆ¤æ–­          æ‰§è¡Œä¸šåŠ¡é€»è¾‘          unlessåˆ¤æ–­
    â†“                     â†“                    â†“
trueæ‰æŸ¥ç¼“å­˜          è¿”å›ç»“æœ             falseæ‰ç¼“å­˜ç»“æœ
```

### 7.5 åŠ¨æ€å®¡è®¡æ—¥å¿—


**å®æˆ˜ï¼šæ ¹æ®æ“ä½œç±»å‹è®°å½•ä¸åŒè¯¦ç»†åº¦çš„æ—¥å¿—**

```java
@Aspect
@Component
public class AuditAspect {
    
    @Around("@annotation(audit)")
    public Object auditLog(ProceedingJoinPoint pjp, Audit audit) 
            throws Throwable {
        
        // åˆ›å»ºSpELè§£æå™¨
        ExpressionParser parser = new SpelExpressionParser();
        StandardEvaluationContext context = new StandardEvaluationContext();
        
        // ç»‘å®šæ–¹æ³•å‚æ•°
        MethodSignature signature = (MethodSignature) pjp.getSignature();
        String[] paramNames = signature.getParameterNames();
        Object[] args = pjp.getArgs();
        
        for (int i = 0; i < paramNames.length; i++) {
            context.setVariable(paramNames[i], args[i]);
        }
        
        // åŠ¨æ€è®¡ç®—æ—¥å¿—æ¶ˆæ¯
        String message = parser.parseExpression(audit.message())
                              .getValue(context, String.class);
        
        System.out.println("å®¡è®¡æ—¥å¿—ï¼š" + message);
        
        Object result = pjp.proceed();
        
        // è¿è¡Œæ—¶è®¡ç®—æ—¥å¿—çº§åˆ«
        String level = parser.parseExpression(audit.level())
                            .getValue(context, String.class);
        
        return result;
    }
}

// è‡ªå®šä¹‰å®¡è®¡æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Audit {
    String message() default "";  // SpELè¡¨è¾¾å¼
    String level() default "'INFO'";  // SpELè¡¨è¾¾å¼
}

// ä½¿ç”¨ç¤ºä¾‹
@Audit(
    message = "'ç”¨æˆ·' + #user.name + 'ä¿®æ”¹äº†è®¢å•' + #orderId",
    level = "#amount > 10000 ? 'WARN' : 'INFO'"
)
public void updateOrder(User user, Long orderId, BigDecimal amount) {
    // æ›´æ–°è®¢å•é€»è¾‘
}
```

### 7.6 SpELè¿è¡Œæ—¶å‡½æ•°


**å†…ç½®å‡½æ•°å’Œæ–¹æ³•è°ƒç”¨**ï¼š

```java
// å­—ç¬¦ä¸²æ“ä½œ
@Cacheable(key = "#username.toUpperCase()")  // è½¬å¤§å†™
public User findByUsername(String username) {
    return userRepository.findByUsername(username);
}

// é›†åˆæ“ä½œ
@PreAuthorize("#permissions.contains('EDIT')")  // æ£€æŸ¥é›†åˆåŒ…å«
public void editDocument(List<String> permissions) {
    // ç¼–è¾‘é€»è¾‘
}

// æ­£åˆ™åŒ¹é…
@Cacheable(
    condition = "#email.matches('^[A-Za-z0-9+_.-]+@(.+)$')"  // é‚®ç®±æ ¼å¼æ ¡éªŒ
)
public User findByEmail(String email) {
    return userRepository.findByEmail(email);
}

// ä¸‰å…ƒè¿ç®—
@Cacheable(key = "#userId + ':' + (#includeDeleted ? 'all' : 'active')")
public List<Task> getUserTasks(Long userId, boolean includeDeleted) {
    return taskRepository.findByUser(userId, includeDeleted);
}
```

**è¿è¡Œæ—¶è®¡ç®—æµç¨‹å›¾**ï¼š

```
æ–¹æ³•è°ƒç”¨
    â†“
æå–å‚æ•°å€¼
    â†“
æ„å»ºSpELä¸Šä¸‹æ–‡
    â†“
è§£æSpELè¡¨è¾¾å¼
    â†“
æ‰§è¡Œè¿ç®—/å‡½æ•°
    â†“
å¾—åˆ°è®¡ç®—ç»“æœ
    â†“
ç”¨äºç¼“å­˜key/æ¡ä»¶åˆ¤æ–­/æ—¥å¿—ç­‰
    â†“
ç»§ç»­æ‰§è¡Œæ–¹æ³•
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ SpELåœ¨AOPä¸­çš„ä½œç”¨ï¼šçµæ´»çš„æ–¹æ³•åŒ¹é…å’Œå‚æ•°å¤„ç†
ğŸ”¸ åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šå®šä¹‰åœ¨å“ªäº›æ–¹æ³•ä¸Šåº”ç”¨å¢å¼º
ğŸ”¸ å‚æ•°ç»‘å®šï¼šä½¿ç”¨argså’Œ#å‚æ•°åè·å–æ–¹æ³•å‚æ•°
ğŸ”¸ æ¡ä»¶åˆ¤æ–­ï¼šæ ¹æ®è¿è¡Œæ—¶æ¡ä»¶å†³å®šæ˜¯å¦æ‰§è¡Œå¢å¼º
ğŸ”¸ åŠ¨æ€åˆ‡å…¥ç‚¹ï¼šè¿è¡Œæ—¶å†³å®šæ˜¯å¦æ‹¦æˆªæ–¹æ³•
ğŸ”¸ æ–¹æ³•åŒ¹é…ï¼šå¤šç§æ–¹å¼ç²¾ç¡®åŒ¹é…ç›®æ ‡æ–¹æ³•
ğŸ”¸ è¿è¡Œæ—¶è®¡ç®—ï¼šåŠ¨æ€ç”Ÿæˆkeyã€æ¶ˆæ¯ç­‰å€¼
```

### 8.2 SpELè¡¨è¾¾å¼é€ŸæŸ¥è¡¨


**å¸¸ç”¨è¯­æ³•**ï¼š

| ç”¨é€” | è¯­æ³• | ç¤ºä¾‹ |
|-----|------|-----|
| **å¼•ç”¨å‚æ•°** | `#å‚æ•°å` | `#user` |
| **è·å–å±æ€§** | `#å¯¹è±¡.å±æ€§` | `#user.name` |
| **è°ƒç”¨æ–¹æ³•** | `#å¯¹è±¡.æ–¹æ³•()` | `#user.getAge()` |
| **å­—ç¬¦ä¸²æ‹¼æ¥** | `+` | `'user-' + #id` |
| **æ¡ä»¶åˆ¤æ–­** | `æ¡ä»¶ ? å€¼1 : å€¼2` | `#age >= 18 ? 'adult' : 'child'` |
| **é€»è¾‘è¿ç®—** | `and` `or` `not` | `#isVip and #level > 5` |
| **é›†åˆæ“ä½œ** | `.contains()` `.size()` | `#list.contains('admin')` |

### 8.3 å®é™…åº”ç”¨æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š

```java
// 1. æ¸…æ™°çš„è¡¨è¾¾å¼ï¼Œæ˜“äºç†è§£
@Cacheable(key = "#user.id + '-' + #type")  âœ…

// 2. åˆç†ä½¿ç”¨æ¡ä»¶åˆ¤æ–­
@Cacheable(condition = "#user.level == 'VIP'")  âœ…

// 3. å‚æ•°ç»‘å®šç®€åŒ–ä»£ç 
@Before("execution(* save*(..)) && args(entity)")  âœ…
```

**âŒ é¿å…çš„åšæ³•**ï¼š

```java
// 1. è¿‡äºå¤æ‚çš„SpELè¡¨è¾¾å¼
@Cacheable(key = "#user.dept.parent.id + '-' + (#includeHistory ? 'full' : (#isVip ? 'vip' : 'basic'))")  âŒ
// å»ºè®®ï¼šæ‹†åˆ†é€»è¾‘ï¼Œåœ¨æ–¹æ³•ä¸­è®¡ç®—

// 2. æ€§èƒ½æ•æ„Ÿçš„è¿ç®—
@Cacheable(condition = "#list.stream().filter(x -> x.price > 100).count() > 10")  âŒ
// å»ºè®®ï¼šæå‰è®¡ç®—å¥½ï¼Œç”¨ç®€å•åˆ¤æ–­

// 3. è¿‡åº¦ä¾èµ–åå°„
@Before("execution(* *(..)) && @annotation(log)")  âŒ (åŒ¹é…æ‰€æœ‰æ–¹æ³•)
// å»ºè®®ï¼šç²¾ç¡®åŒ¹é…ç‰¹å®šåŒ…æˆ–ç±»
```

### 8.4 è®°å¿†è¦ç‚¹


**SpELåœ¨AOPä¸­çš„4å¤§æ ¸å¿ƒåº”ç”¨**ï¼š

```
1ï¸âƒ£ å‚æ•°è·å–
   #å‚æ•°å â†’ ç›´æ¥å¼•ç”¨æ–¹æ³•å‚æ•°

2ï¸âƒ£ æ¡ä»¶æ§åˆ¶
   condition/unless â†’ å†³å®šæ˜¯å¦æ‰§è¡Œå¢å¼º

3ï¸âƒ£ åŠ¨æ€è®¡ç®—
   è¿è¡Œæ—¶è¡¨è¾¾å¼ â†’ ç”Ÿæˆkeyã€æ¶ˆæ¯ç­‰

4ï¸âƒ£ æ–¹æ³•åŒ¹é…
   åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ â†’ ç²¾ç¡®åŒ¹é…ç›®æ ‡æ–¹æ³•
```

**å…³é”®è®°å¿†å£è¯€**ï¼š

```
SpELè¡¨è¾¾å¼AOPç”¨ï¼Œ
äº•å·å‚æ•°è½»æ¾å¼•ã€‚
æ¡ä»¶åˆ¤æ–­çœŸæˆ–å‡ï¼Œ
åŠ¨æ€è®¡ç®—å€¼è‡ªç”Ÿã€‚
åˆ‡å…¥ç‚¹ä¸Šé…è¡¨è¾¾ï¼Œ
è¿è¡Œæ—¶åˆ»æ‰å†³å®šã€‚
```

### 8.5 å­¦ä¹ å»ºè®®


**å¾ªåºæ¸è¿›çš„å­¦ä¹ è·¯å¾„**ï¼š

```
ç¬¬1æ­¥ï¼šæŒæ¡åŸºç¡€è¯­æ³•
     â†“
å­¦ä¼š #å‚æ•°å å¼•ç”¨å‚æ•°

ç¬¬2æ­¥ï¼šç†è§£æ¡ä»¶åˆ¤æ–­
     â†“
ä½¿ç”¨ condition æ§åˆ¶æ‰§è¡Œ

ç¬¬3æ­¥ï¼šå®è·µåŠ¨æ€è®¡ç®—
     â†“
åŠ¨æ€ç”Ÿæˆç¼“å­˜keyã€æ—¥å¿—æ¶ˆæ¯

ç¬¬4æ­¥ï¼šæ·±å…¥åˆ‡å…¥ç‚¹åŒ¹é…
     â†“
ç»„åˆå¤šç§åŒ¹é…æ¡ä»¶

ç¬¬5æ­¥ï¼šç»¼åˆåº”ç”¨
     â†“
å®æˆ˜é¡¹ç›®ä¸­çµæ´»è¿ç”¨
```

**æ ¸å¿ƒç†è§£**ï¼š
- SpELä¸æ˜¯ä¸ºäº†ç‚«æŠ€ï¼Œè€Œæ˜¯ä¸ºäº†è®©AOPæ›´çµæ´»
- ç®€å•åœºæ™¯ç”¨ç®€å•è¡¨è¾¾å¼ï¼Œå¤æ‚é€»è¾‘å»ºè®®åœ¨æ–¹æ³•ä¸­å¤„ç†
- è¿è¡Œæ—¶è®¡ç®—æœ‰æ€§èƒ½å¼€é”€ï¼Œè¦æƒè¡¡ä½¿ç”¨
- æ¡ä»¶åˆ¤æ–­è®©AOP"æœ‰é€‰æ‹©åœ°"å·¥ä½œï¼Œæé«˜æ•ˆç‡