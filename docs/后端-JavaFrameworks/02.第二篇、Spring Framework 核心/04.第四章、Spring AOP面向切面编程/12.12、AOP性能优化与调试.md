---
title: 12ã€AOPæ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•
---
## ğŸ“š ç›®å½•

1. [AOPæ€§èƒ½åŸºç¡€è®¤çŸ¥](#1-AOPæ€§èƒ½åŸºç¡€è®¤çŸ¥)
2. [åˆ‡ç‚¹åŒ¹é…ä¼˜åŒ–](#2-åˆ‡ç‚¹åŒ¹é…ä¼˜åŒ–)
3. [é€šçŸ¥æ‰§è¡Œå¼€é”€ä¼˜åŒ–](#3-é€šçŸ¥æ‰§è¡Œå¼€é”€ä¼˜åŒ–)
4. [ä»£ç†åˆ›å»ºæˆæœ¬ä¼˜åŒ–](#4-ä»£ç†åˆ›å»ºæˆæœ¬ä¼˜åŒ–)
5. [AOPè°ƒè¯•æŠ€å·§](#5-AOPè°ƒè¯•æŠ€å·§)
6. [å¸¸è§é—®é¢˜æ’é”™æ¸…å•](#6-å¸¸è§é—®é¢˜æ’é”™æ¸…å•)
7. [æ€§èƒ½ç›‘æ§æŒ‡æ ‡](#7-æ€§èƒ½ç›‘æ§æŒ‡æ ‡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ AOPæ€§èƒ½åŸºç¡€è®¤çŸ¥


### 1.1 AOPä¸ºä»€ä¹ˆä¼šå½±å“æ€§èƒ½


**é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼š

æ²¡æœ‰AOPï¼š
ä½  â†’ ç›´æ¥æ‰¾æŸœå‘˜åŠç† â†’ å®Œæˆ
ï¼ˆæœ€å¿«æœ€ç›´æ¥ï¼‰

æœ‰äº†AOPï¼š
ä½  â†’ å…ˆå–å·ï¼ˆåˆ‡ç‚¹åŒ¹é…ï¼‰
   â†’ ä¿å®‰æ£€æŸ¥ï¼ˆå‰ç½®é€šçŸ¥ï¼‰
   â†’ æ‰¾æŸœå‘˜åŠç†ï¼ˆç›®æ ‡æ–¹æ³•ï¼‰
   â†’ å¡«å†™è¯„ä»·è¡¨ï¼ˆåç½®é€šçŸ¥ï¼‰
   â†’ å®Œæˆ

å¤šäº†å‡ ä¸ªæ­¥éª¤ï¼Œè‡ªç„¶å°±æ…¢äº†ä¸€ç‚¹
```

### 1.2 æ€§èƒ½å¼€é”€çš„ä¸‰å¤§æ¥æº


**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
â”Œâ”€ AOPæ€§èƒ½å¼€é”€æ¥æº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â”‚
â”‚  1ï¸âƒ£ åˆ‡ç‚¹åŒ¹é…              â”‚
â”‚  â”œâ”€ å¯åŠ¨æ—¶æ‰«æç±»          â”‚
â”‚  â”œâ”€ åˆ¤æ–­æ˜¯å¦ç¬¦åˆåˆ‡ç‚¹      â”‚
â”‚  â””â”€ å†³å®šæ˜¯å¦åˆ›å»ºä»£ç†      â”‚
â”‚                            â”‚
â”‚  2ï¸âƒ£ ä»£ç†å¯¹è±¡åˆ›å»º          â”‚
â”‚  â”œâ”€ JDKåŠ¨æ€ä»£ç†           â”‚
â”‚  â”œâ”€ CGLIBå­—èŠ‚ç ä»£ç†       â”‚
â”‚  â””â”€ é¢å¤–å†…å­˜å ç”¨          â”‚
â”‚                            â”‚
â”‚  3ï¸âƒ£ é€šçŸ¥æ–¹æ³•æ‰§è¡Œ          â”‚
â”‚  â”œâ”€ åå°„è°ƒç”¨å¼€é”€          â”‚
â”‚  â”œâ”€ å‚æ•°å¤„ç†              â”‚
â”‚  â””â”€ æ‹¦æˆªé“¾æ‰§è¡Œ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ€§èƒ½å½±å“ç¨‹åº¦**ï¼š
```
å¯åŠ¨æ—¶ï¼š  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% - åˆ‡ç‚¹åŒ¹é…å’Œä»£ç†åˆ›å»º
è¿è¡Œæ—¶ï¼š  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 40% - é€šçŸ¥æ–¹æ³•æ‰§è¡Œ

å½±å“å› ç´ ï¼š
âœ“ åˆ‡ç‚¹è¡¨è¾¾å¼å¤æ‚åº¦ï¼šè¶Šå¤æ‚è¶Šæ…¢
âœ“ è¢«ä»£ç†Beanæ•°é‡ï¼šè¶Šå¤šå¯åŠ¨è¶Šæ…¢
âœ“ é€šçŸ¥æ–¹æ³•å¤æ‚åº¦ï¼šè¶Šå¤æ‚æ‰§è¡Œè¶Šæ…¢
```

### 1.3 æ€§èƒ½ä¼˜åŒ–çš„åŸºæœ¬åŸåˆ™


**ä¼˜åŒ–æ€è·¯**ï¼š
```
ğŸ¯ ä¼˜åŒ–ç›®æ ‡ä¼˜å…ˆçº§

1. å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
   â”œâ”€ ç²¾ç®€åˆ‡ç‚¹è¡¨è¾¾å¼
   â”œâ”€ å‡å°‘æ‰«æèŒƒå›´
   â””â”€ æŒ‰éœ€åˆ›å»ºä»£ç†

2. è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
   â”œâ”€ é€šçŸ¥æ–¹æ³•è½»é‡åŒ–
   â”œâ”€ é¿å…é‡å¤è®¡ç®—
   â””â”€ ä½¿ç”¨ç¼“å­˜

3. å†…å­˜å ç”¨ä¼˜åŒ–ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
   â”œâ”€ å…±äº«ä»£ç†å¯¹è±¡
   â””â”€ åŠæ—¶é‡Šæ”¾èµ„æº
```

---

## 2. ğŸ” åˆ‡ç‚¹åŒ¹é…ä¼˜åŒ–


### 2.1 åˆ‡ç‚¹è¡¨è¾¾å¼ä¼˜åŒ–åŸåˆ™


**ä»€ä¹ˆæ˜¯åˆ‡ç‚¹åŒ¹é…**ï¼š
```
ç®€å•ç†è§£ï¼š
åˆ‡ç‚¹è¡¨è¾¾å¼å°±åƒä¸€ä¸ª"ç­›å­"ï¼ŒSpringå¯åŠ¨æ—¶è¦æŠŠæ‰€æœ‰Beanè¿‡ä¸€éï¼Œ
çœ‹å“ªäº›Beanç¬¦åˆæ¡ä»¶éœ€è¦è¢«ä»£ç†

è¡¨è¾¾å¼è¶Šå¤æ‚ = ç­›å­å­”è¶Šå° = ç­›é€‰è¶Šæ…¢
```

**ä¼˜åŒ–åŸåˆ™**ï¼š
```
â”Œâ”€ åˆ‡ç‚¹è¡¨è¾¾å¼ä¼˜åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚
â”‚ âŒ æ…¢ï¼šå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼       â”‚
â”‚    execution(* com..*.*(..)) â”‚
â”‚                              â”‚
â”‚ âœ… å¿«ï¼šæ˜ç¡®çš„åŒ…è·¯å¾„           â”‚
â”‚    execution(* com.app.service.*.*(..)) â”‚
â”‚                              â”‚
â”‚ âŒ æ…¢ï¼šå¤šä¸ªæ¡ä»¶ç»„åˆ           â”‚
â”‚    (execution(...) || execution(...)) && !execution(...) â”‚
â”‚                              â”‚
â”‚ âœ… å¿«ï¼šå•ä¸€æ˜ç¡®æ¡ä»¶           â”‚
â”‚    @annotation(Log)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åˆ‡ç‚¹è¡¨è¾¾å¼æ€§èƒ½å¯¹æ¯”


**æ€§èƒ½ä»å¿«åˆ°æ…¢æ’åº**ï¼š
```
1. æ³¨è§£æ–¹å¼ï¼ˆæœ€å¿«ï¼‰â­â­â­â­â­
   @annotation(com.app.Log)
   â†’ ç›´æ¥æ‰«ææ³¨è§£ï¼Œéå¸¸å¿«

2. æ˜ç¡®åŒ…è·¯å¾„ â­â­â­â­
   execution(* com.app.service.UserService.*(..))
   â†’ æ˜ç¡®ç±»åï¼Œæ‰«æèŒƒå›´å°

3. åŒ…è·¯å¾„é€šé… â­â­â­
   execution(* com.app.service.*.*(..))
   â†’ ä¸€å±‚é€šé…ï¼Œè¿˜ç®—å¿«

4. å¤šå±‚é€šé… â­â­
   execution(* com.app..*.*(..))
   â†’ é€’å½’æ‰«æå­åŒ…ï¼Œè¾ƒæ…¢

5. å…¨å±€é€šé… â­
   execution(* *.*.*(..))
   â†’ æ‰«ææ‰€æœ‰åŒ…ï¼Œæœ€æ…¢
```

**å®é™…æ¡ˆä¾‹å¯¹æ¯”**ï¼š
```java
// âŒ æ€§èƒ½å·®ï¼šå…¨å±€æ‰«æ
@Pointcut("execution(* com..*.*(..))")
// å¯åŠ¨æ—¶é—´ï¼šå¯èƒ½å¢åŠ  2-5ç§’
// åŒ¹é…æ¬¡æ•°ï¼šå¯èƒ½æ£€æŸ¥ 10000+ ä¸ªæ–¹æ³•

// âœ… æ€§èƒ½å¥½ï¼šç²¾ç¡®å®šä½
@Pointcut("@annotation(com.app.annotation.Log)")
// å¯åŠ¨æ—¶é—´ï¼šå‡ ä¹æ— å½±å“
// åŒ¹é…æ¬¡æ•°ï¼šåªæ£€æŸ¥æœ‰æ³¨è§£çš„æ–¹æ³•ï¼ˆå¯èƒ½åªæœ‰å‡ åä¸ªï¼‰
```

### 2.3 åˆ‡ç‚¹ä¼˜åŒ–æœ€ä½³å®è·µ


**å®æˆ˜æŠ€å·§**ï¼š
```java
// æŠ€å·§1ï¼šä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ï¼ˆæ¨èï¼‰
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface PerformanceLog {}

@Pointcut("@annotation(PerformanceLog)")
// ä¼˜ç‚¹ï¼šç²¾ç¡®ã€å¿«é€Ÿã€å¯è¯»æ€§å¥½

// æŠ€å·§2ï¼šæ˜ç¡®åŒ…è·¯å¾„
@Pointcut("execution(* com.app.service..*.*(..))")
// åªæ‰«æserviceåŒ…ï¼Œä¸æ‰«æå…¶ä»–åŒ…

// æŠ€å·§3ï¼šç»„åˆä½¿ç”¨
@Pointcut("within(com.app.service..*) && @annotation(Log)")
// å…ˆé™å®šèŒƒå›´ï¼Œå†åŒ¹é…æ³¨è§£
```

**ä¼˜åŒ–æ•ˆæœå¯¹æ¯”**ï¼š
| ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ€§èƒ½æå‡ |
|--------|--------|----------|
| `execution(* com..*.*(..))` | `@annotation(Log)` | å¯åŠ¨å¿« **3-5å€** |
| åŒ¹é…10000+æ–¹æ³• | åŒ¹é…50ä¸ªæ–¹æ³• | æ£€æŸ¥å‡å°‘ **99%** |
| å¯åŠ¨è€—æ—¶5ç§’ | å¯åŠ¨è€—æ—¶1ç§’ | æ—¶é—´èŠ‚çœ **80%** |

---

## 3. âš¡ é€šçŸ¥æ‰§è¡Œå¼€é”€ä¼˜åŒ–


### 3.1 é€šçŸ¥æ–¹æ³•æ€§èƒ½åˆ†æ


**é€šçŸ¥æ‰§è¡Œæµç¨‹**ï¼š
```
ç›®æ ‡æ–¹æ³•è°ƒç”¨æµç¨‹ï¼š
                    
å®¢æˆ·ç«¯è°ƒç”¨          ä»£ç†å¯¹è±¡          ç›®æ ‡å¯¹è±¡
    |                  |                 |
    |--è°ƒç”¨æ–¹æ³•-------->|                 |
    |                  |--å‰ç½®é€šçŸ¥------->| (é¢å¤–å¼€é”€)
    |                  |                 |
    |                  |--ç›®æ ‡æ–¹æ³•------->| (ä¸»è¦ä¸šåŠ¡)
    |                  |                 |
    |                  |--åç½®é€šçŸ¥------->| (é¢å¤–å¼€é”€)
    |                  |                 |
    |<-----è¿”å›ç»“æœ-----|<----------------|
```

**å¼€é”€æ¥æº**ï¼š
```
ğŸ”¸ åå°„è°ƒç”¨å¼€é”€
   â”œâ”€ Method.invoke() æ¯”ç›´æ¥è°ƒç”¨æ…¢ 10-100å€
   â”œâ”€ å‚æ•°è£…ç®±æ‹†ç®±
   â””â”€ å¼‚å¸¸å¤„ç†

ğŸ”¸ æ‹¦æˆªé“¾æ‰§è¡Œå¼€é”€
   â”œâ”€ å¤šä¸ªé€šçŸ¥ä¾æ¬¡æ‰§è¡Œ
   â”œâ”€ åˆ‡ç‚¹å†æ¬¡åŒ¹é…ï¼ˆæŸäº›æƒ…å†µï¼‰
   â””â”€ ä¸Šä¸‹æ–‡åˆ‡æ¢

ğŸ”¸ é€šçŸ¥æ–¹æ³•æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘
   â”œâ”€ æ—¥å¿—è®°å½•
   â”œâ”€ æƒé™æ£€æŸ¥
   â””â”€ äº‹åŠ¡ç®¡ç†
```

### 3.2 é€šçŸ¥æ–¹æ³•ä¼˜åŒ–æŠ€å·§


**ä¼˜åŒ–åŸåˆ™**ï¼š
```
â”Œâ”€ é€šçŸ¥æ–¹æ³•ä¼˜åŒ–åŸåˆ™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â”‚
â”‚ 1. ä¿æŒè½»é‡                â”‚
â”‚    âœ“ é¿å…å¤æ‚è®¡ç®—          â”‚
â”‚    âœ“ é¿å…IOæ“ä½œ            â”‚
â”‚    âœ“ é¿å…ç½‘ç»œè¯·æ±‚          â”‚
â”‚                            â”‚
â”‚ 2. å¼‚æ­¥å¤„ç†                â”‚
â”‚    âœ“ æ—¥å¿—å¼‚æ­¥å†™å…¥          â”‚
â”‚    âœ“ æ¶ˆæ¯å¼‚æ­¥å‘é€          â”‚
â”‚    âœ“ ç»Ÿè®¡å¼‚æ­¥è®¡ç®—          â”‚
â”‚                            â”‚
â”‚ 3. ä½¿ç”¨ç¼“å­˜                â”‚
â”‚    âœ“ ç¼“å­˜æƒé™ä¿¡æ¯          â”‚
â”‚    âœ“ ç¼“å­˜é…ç½®æ•°æ®          â”‚
â”‚    âœ“ ç¼“å­˜è®¡ç®—ç»“æœ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®æˆ˜ç¤ºä¾‹**ï¼š
```java
// âŒ æ€§èƒ½å·®ï¼šåŒæ­¥è®°å½•æ—¥å¿—
@Around("logPointcut()")
public Object log(ProceedingJoinPoint pjp) throws Throwable {
    String methodName = pjp.getSignature().getName();
    
    // åŒæ­¥å†™æ—¥å¿—ï¼Œä¼šé˜»å¡ä¸šåŠ¡
    logger.info("å¼€å§‹æ‰§è¡Œ: {}", methodName);
    Object result = pjp.proceed();
    logger.info("æ‰§è¡Œå®Œæˆ: {}", methodName);
    
    return result;
}

// âœ… æ€§èƒ½å¥½ï¼šå¼‚æ­¥è®°å½•æ—¥å¿—
@Around("logPointcut()")
public Object log(ProceedingJoinPoint pjp) throws Throwable {
    long start = System.currentTimeMillis();
    String methodName = pjp.getSignature().getName();
    
    Object result = pjp.proceed();
    
    // å¼‚æ­¥è®°å½•æ—¥å¿—ï¼Œä¸é˜»å¡ä¸šåŠ¡
    long cost = System.currentTimeMillis() - start;
    asyncLogService.log(methodName, cost);
    
    return result;
}
```

### 3.3 é€‰æ‹©åˆé€‚çš„é€šçŸ¥ç±»å‹


**é€šçŸ¥ç±»å‹æ€§èƒ½å¯¹æ¯”**ï¼š
```
æ€§èƒ½ä»å¿«åˆ°æ…¢ï¼š

1. @Beforeï¼ˆå‰ç½®é€šçŸ¥ï¼‰â­â­â­â­â­
   â””â”€ æœ€ç®€å•ï¼Œåªåœ¨æ–¹æ³•å‰æ‰§è¡Œ

2. @AfterReturningï¼ˆè¿”å›é€šçŸ¥ï¼‰â­â­â­â­
   â””â”€ æ–¹æ³•æˆåŠŸåæ‰§è¡Œï¼Œç¨æœ‰å¼€é”€

3. @Afterï¼ˆåç½®é€šçŸ¥ï¼‰â­â­â­â­
   â””â”€ æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œ

4. @Aroundï¼ˆç¯ç»•é€šçŸ¥ï¼‰â­â­â­
   â””â”€ æœ€çµæ´»ä½†å¼€é”€æœ€å¤§ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨proceed()

5. @AfterThrowingï¼ˆå¼‚å¸¸é€šçŸ¥ï¼‰â­â­â­â­
   â””â”€ åªåœ¨å¼‚å¸¸æ—¶æ‰§è¡Œï¼Œæ­£å¸¸æƒ…å†µæ— å¼€é”€
```

**é€‰æ‹©å»ºè®®**ï¼š
```java
// åœºæ™¯1ï¼šåªéœ€è¦è®°å½•å¼€å§‹æ—¶é—´ â†’ ç”¨@Before
@Before("pointcut()")
public void before() {
    System.out.println("æ–¹æ³•å¼€å§‹");
}

// åœºæ™¯2ï¼šéœ€è¦è·å–è¿”å›å€¼ â†’ ç”¨@AfterReturning
@AfterReturning(pointcut = "pointcut()", returning = "result")
public void afterReturn(Object result) {
    System.out.println("è¿”å›å€¼ï¼š" + result);
}

// åœºæ™¯3ï¼šéœ€è¦ä¿®æ”¹è¿”å›å€¼æˆ–è®°å½•è€—æ—¶ â†’ æ‰ç”¨@Around
@Around("pointcut()")
public Object around(ProceedingJoinPoint pjp) throws Throwable {
    long start = System.currentTimeMillis();
    Object result = pjp.proceed();
    System.out.println("è€—æ—¶ï¼š" + (System.currentTimeMillis() - start));
    return result;
}
```

**æ€§èƒ½æå‡æ•°æ®**ï¼š
| é€šçŸ¥ç±»å‹ | å¹³å‡å¼€é”€ | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|
| @Before | **0.01ms** | ç®€å•å‰ç½®æ“ä½œ |
| @AfterReturning | **0.02ms** | å¤„ç†è¿”å›å€¼ |
| @Around | **0.05ms** | éœ€è¦æ§åˆ¶æ‰§è¡Œæµç¨‹ |

---

## 4. ğŸ—ï¸ ä»£ç†åˆ›å»ºæˆæœ¬ä¼˜åŒ–


### 4.1 ä»£ç†åˆ›å»ºæœºåˆ¶ç†è§£


**ä»€ä¹ˆæ˜¯ä»£ç†åˆ›å»º**ï¼š
```
é€šä¿—ç†è§£ï¼š
ä»£ç†å°±åƒç»™åŸæ¥çš„å¯¹è±¡"å¥—äº†ä¸€å±‚å£³"

åŸå§‹Beanï¼š    UserService (ç›´æ¥è°ƒç”¨)
ä»£ç†Beanï¼š    UserServiceProxy (å…ˆæ‰§è¡Œé€šçŸ¥ï¼Œå†è°ƒç”¨UserService)

åˆ›å»ºä»£ç†çš„æˆæœ¬ï¼š
âœ“ JDKåŠ¨æ€ä»£ç†ï¼šåå°„ç”Ÿæˆæ¥å£å®ç°ç±»
âœ“ CGLIBä»£ç†ï¼šå­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆå­ç±»
âœ“ éƒ½éœ€è¦é¢å¤–çš„å†…å­˜å’ŒCPUæ—¶é—´
```

**ä»£ç†ç±»å‹å¯¹æ¯”**ï¼š
```
JDKåŠ¨æ€ä»£ç†                     CGLIBä»£ç†
     â†“                              â†“
å¿…é¡»æœ‰æ¥å£                      ä¸éœ€è¦æ¥å£
é€Ÿåº¦å¿«                          é€Ÿåº¦ç¨æ…¢
å†…å­˜å ç”¨å°‘                      å†…å­˜å ç”¨å¤š
     â†“                              â†“
é€‚åˆï¼šæ ‡å‡†Serviceå±‚            é€‚åˆï¼šæ²¡æœ‰æ¥å£çš„ç±»
```

### 4.2 ä»£ç†åˆ›å»ºä¼˜åŒ–ç­–ç•¥


**ä¼˜åŒ–ç­–ç•¥1ï¼šæŒ‰éœ€åˆ›å»ºä»£ç†**
```java
// âŒ ä¸å¥½ï¼šæ‰€æœ‰Beanéƒ½æ‰«æ
@EnableAspectJAutoProxy  // é»˜è®¤æ‰«ææ‰€æœ‰Bean

// âœ… æ¨èï¼šåªä»£ç†éœ€è¦çš„Bean
@Configuration
public class AopConfig {
    
    // æ–¹æ³•1ï¼šä½¿ç”¨@Lazyå»¶è¿Ÿåˆ›å»º
    @Lazy
    @Bean
    public UserService userService() {
        return new UserService();
    }
    
    // æ–¹æ³•2ï¼šä½¿ç”¨æ¡ä»¶æ³¨è§£
    @ConditionalOnProperty(name = "aop.enabled", havingValue = "true")
    @Bean
    public MyAspect myAspect() {
        return new MyAspect();
    }
}
```

**ä¼˜åŒ–ç­–ç•¥2ï¼šé€‰æ‹©åˆé€‚çš„ä»£ç†æ–¹å¼**
```java
// é…ç½®ä»£ç†ç­–ç•¥
@EnableAspectJAutoProxy(
    proxyTargetClass = false  // false=ä¼˜å…ˆJDKåŠ¨æ€ä»£ç†ï¼Œtrue=å¼ºåˆ¶CGLIB
)

// æ€§èƒ½å¯¹æ¯”ï¼š
// JDKåŠ¨æ€ä»£ç†ï¼šåˆ›å»ºå¿«ï¼Œè¿è¡Œå¿«ï¼Œä½†å¿…é¡»æœ‰æ¥å£
// CGLIBä»£ç†ï¼šåˆ›å»ºæ…¢ï¼Œè¿è¡Œç¨æ…¢ï¼Œä½†ä¸éœ€è¦æ¥å£

// å»ºè®®ï¼š
// 1. Serviceå±‚æœ‰æ¥å£ â†’ ç”¨JDKåŠ¨æ€ä»£ç†
// 2. æ²¡æœ‰æ¥å£çš„ç±» â†’ æ‰ç”¨CGLIB
```

### 4.3 ä»£ç†æ•°é‡ä¼˜åŒ–


**å‡å°‘ä»£ç†Beanæ•°é‡**ï¼š
```java
// âŒ ä¸å¥½ï¼šæ¯ä¸ªServiceéƒ½åˆ›å»ºä»£ç†
@Service
public class UserService {
    public void query() {} // è¢«ä»£ç†
    public void save() {}  // è¢«ä»£ç†
    public void delete() {} // è¢«ä»£ç†
}

// âœ… æ¨èï¼šåªä»£ç†æ ¸å¿ƒæ–¹æ³•
@Service
public class UserService {
    
    @PerformanceLog  // åªæœ‰è¿™ä¸ªæ–¹æ³•è¢«ä»£ç†
    public void criticalMethod() {
        // æ ¸å¿ƒä¸šåŠ¡
    }
    
    public void normalMethod() {
        // æ™®é€šæ–¹æ³•ï¼Œä¸éœ€è¦ä»£ç†
    }
}
```

**å¯åŠ¨æ—¶é—´å¯¹æ¯”**ï¼š
```
åœºæ™¯ï¼š100ä¸ªServiceï¼Œæ¯ä¸ª10ä¸ªæ–¹æ³•

å…¨éƒ¨ä»£ç†ï¼š
â”œâ”€ åˆ›å»º100ä¸ªä»£ç†å¯¹è±¡
â”œâ”€ å¯åŠ¨æ—¶é—´ï¼šçº¦ 3ç§’
â””â”€ å†…å­˜å ç”¨ï¼šçº¦ 50MB

æŒ‰éœ€ä»£ç†ï¼š
â”œâ”€ åˆ›å»º20ä¸ªä»£ç†å¯¹è±¡ï¼ˆåªä»£ç†æ ¸å¿ƒæ–¹æ³•ï¼‰
â”œâ”€ å¯åŠ¨æ—¶é—´ï¼šçº¦ 0.6ç§’ ï¼ˆå¿«5å€ï¼‰
â””â”€ å†…å­˜å ç”¨ï¼šçº¦ 10MB ï¼ˆçœ40MBï¼‰
```

---

## 5. ğŸ”§ AOPè°ƒè¯•æŠ€å·§


### 5.1 å¦‚ä½•æŸ¥çœ‹ä»£ç†æ˜¯å¦ç”Ÿæ•ˆ


**è°ƒè¯•æ–¹æ³•1ï¼šæ‰“å°Beanç±»å‹**
```java
@Service
public class UserService {
    
    @Autowired
    private ApplicationContext context;
    
    public void checkProxy() {
        Object bean = context.getBean("userService");
        
        // æŸ¥çœ‹Beançš„çœŸå®ç±»å‹
        System.out.println("Beanç±»å‹: " + bean.getClass().getName());
        
        // åˆ¤æ–­æ˜¯å¦è¢«ä»£ç†
        if (AopUtils.isAopProxy(bean)) {
            System.out.println("âœ… å·²è¢«AOPä»£ç†");
            
            if (AopUtils.isJdkDynamicProxy(bean)) {
                System.out.println("ä»£ç†æ–¹å¼: JDKåŠ¨æ€ä»£ç†");
            } else if (AopUtils.isCglibProxy(bean)) {
                System.out.println("ä»£ç†æ–¹å¼: CGLIBä»£ç†");
            }
        } else {
            System.out.println("âŒ æœªè¢«ä»£ç†");
        }
    }
}
```

**è°ƒè¯•æ–¹æ³•2ï¼šå¼€å¯AOPæ—¥å¿—**
```yaml
# application.yml
logging:
  level:
    org.springframework.aop: DEBUG  # æŸ¥çœ‹AOPåˆ›å»ºè¿‡ç¨‹
    org.springframework.beans: DEBUG  # æŸ¥çœ‹Beanåˆ›å»ºè¿‡ç¨‹
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
DEBUG o.s.aop.framework.autoproxy - Creating implicit proxy for bean 'userService'
DEBUG o.s.aop.framework.CglibAopProxy - Creating CGLIB proxy for class UserService
DEBUG o.s.aop.interceptor - Invoking advice method: logAspect.before()
```

### 5.2 è°ƒè¯•åˆ‡ç‚¹åŒ¹é…é—®é¢˜


**å¸¸è§é—®é¢˜ï¼šåˆ‡ç‚¹ä¸ç”Ÿæ•ˆ**
```
é—®é¢˜æ’æŸ¥æ­¥éª¤ï¼š

1ï¸âƒ£ æ£€æŸ¥åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•
   execution(* com.app.service.*.*(..))
   â†‘        â†‘ â†‘               â†‘  â†‘
   ä¿®é¥°ç¬¦   è¿”å›å€¼ åŒ…è·¯å¾„      æ–¹æ³• å‚æ•°

2ï¸âƒ£ æ£€æŸ¥åŒ…è·¯å¾„æ˜¯å¦æ­£ç¡®
   ç¡®ä¿åŒ…åæ‹¼å†™æ­£ç¡®ï¼Œæ³¨æ„å¤§å°å†™

3ï¸âƒ£ æ£€æŸ¥æ–¹æ³•ä¿®é¥°ç¬¦
   privateæ–¹æ³•ä¸ä¼šè¢«ä»£ç†ï¼ˆCGLIBé™¤å¤–ï¼‰

4ï¸âƒ£ æ£€æŸ¥æ˜¯å¦è‡ªè°ƒç”¨
   this.method() ä¸ä¼šè§¦å‘AOP
   éœ€è¦ç”¨æ³¨å…¥çš„Beanè°ƒç”¨
```

**è°ƒè¯•å·¥å…·ä»£ç **ï¼š
```java
@Aspect
@Component
public class PointcutDebugger {
    
    // ç”¨äºæµ‹è¯•åˆ‡ç‚¹è¡¨è¾¾å¼
    @Pointcut("execution(* com.app.service.*.*(..))")
    public void testPointcut() {}
    
    @Before("testPointcut()")
    public void debugBefore(JoinPoint jp) {
        // æ‰“å°åŒ¹é…åˆ°çš„æ–¹æ³•ä¿¡æ¯
        System.out.println("âœ… åˆ‡ç‚¹åŒ¹é…æˆåŠŸ");
        System.out.println("æ–¹æ³•: " + jp.getSignature().getName());
        System.out.println("ç±»å: " + jp.getTarget().getClass().getName());
        System.out.println("å‚æ•°: " + Arrays.toString(jp.getArgs()));
    }
}
```

### 5.3 è§£å†³è‡ªè°ƒç”¨é—®é¢˜


**ä»€ä¹ˆæ˜¯è‡ªè°ƒç”¨é—®é¢˜**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
@Service
public class UserService {
    
    @Log  // è¿™ä¸ªAOPä¸ä¼šç”Ÿæ•ˆ
    public void method1() {
        System.out.println("æ–¹æ³•1");
    }
    
    public void method2() {
        this.method1();  // âŒ è‡ªè°ƒç”¨ï¼ŒAOPå¤±æ•ˆ
    }
}

åŸå› ï¼š
this.method1() â†’ ç›´æ¥è°ƒç”¨åŸå§‹å¯¹è±¡
æ²¡æœ‰ç»è¿‡ä»£ç†å¯¹è±¡ â†’ AOPé€šçŸ¥ä¸æ‰§è¡Œ
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```java
// æ–¹æ¡ˆ1ï¼šæ³¨å…¥è‡ªå·±ï¼ˆæ¨èï¼‰
@Service
public class UserService {
    
    @Autowired
    private UserService self;  // æ³¨å…¥çš„æ˜¯ä»£ç†å¯¹è±¡
    
    public void method2() {
        self.method1();  // âœ… é€šè¿‡ä»£ç†è°ƒç”¨ï¼ŒAOPç”Ÿæ•ˆ
    }
}

// æ–¹æ¡ˆ2ï¼šä½¿ç”¨AopContext
@Service
public class UserService {
    
    public void method2() {
        UserService proxy = (UserService) AopContext.currentProxy();
        proxy.method1();  // âœ… AOPç”Ÿæ•ˆ
    }
}
// éœ€è¦å¼€å¯æš´éœ²ä»£ç†ï¼š@EnableAspectJAutoProxy(exposeProxy = true)
```

---

## 6. ğŸ“‹ å¸¸è§é—®é¢˜æ’é”™æ¸…å•


### 6.1 AOPä¸ç”Ÿæ•ˆé—®é¢˜


**é—®é¢˜æ£€æŸ¥æ¸…å•**ï¼š
```
â–¡ 1. æ£€æŸ¥@EnableAspectJAutoProxyæ˜¯å¦æ·»åŠ 
     â””â”€ åœ¨é…ç½®ç±»ä¸Šå¿…é¡»æœ‰è¿™ä¸ªæ³¨è§£

â–¡ 2. æ£€æŸ¥åˆ‡é¢ç±»æ˜¯å¦åŠ @Aspectå’Œ@Component
     â””â”€ ä¸¤ä¸ªæ³¨è§£éƒ½è¦åŠ 

â–¡ 3. æ£€æŸ¥åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•
     â””â”€ ä½¿ç”¨IDEçš„åˆ‡ç‚¹è¡¨è¾¾å¼éªŒè¯å·¥å…·

â–¡ 4. æ£€æŸ¥æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦
     â””â”€ JDKä»£ç†ä¸æ”¯æŒprivateæ–¹æ³•

â–¡ 5. æ£€æŸ¥æ˜¯å¦æ˜¯è‡ªè°ƒç”¨
     â””â”€ ä½¿ç”¨æ³¨å…¥çš„Beanè°ƒç”¨æ–¹æ³•

â–¡ 6. æ£€æŸ¥Springç‰ˆæœ¬å…¼å®¹æ€§
     â””â”€ æŸäº›AOPç‰¹æ€§éœ€è¦ç‰¹å®šç‰ˆæœ¬
```

### 6.2 æ€§èƒ½é—®é¢˜æ’æŸ¥


**æ€§èƒ½é—®é¢˜æ£€æŸ¥æ¸…å•**ï¼š
```
â–¡ 1. å¯åŠ¨æ…¢
     â”œâ”€ æ£€æŸ¥åˆ‡ç‚¹è¡¨è¾¾å¼æ˜¯å¦å¤ªå®½æ³›
     â”œâ”€ æ£€æŸ¥æ˜¯å¦æ‰«æäº†ä¸å¿…è¦çš„åŒ…
     â””â”€ è€ƒè™‘ä½¿ç”¨æ³¨è§£æ–¹å¼ä»£æ›¿execution

â–¡ 2. è¿è¡Œæ…¢
     â”œâ”€ æ£€æŸ¥é€šçŸ¥æ–¹æ³•æ˜¯å¦æœ‰IOæ“ä½œ
     â”œâ”€ æ£€æŸ¥æ˜¯å¦æœ‰åŒæ­¥æ—¥å¿—è®°å½•
     â””â”€ è€ƒè™‘ä½¿ç”¨å¼‚æ­¥å¤„ç†

â–¡ 3. å†…å­˜å ç”¨é«˜
     â”œâ”€ æ£€æŸ¥ä»£ç†Beanæ•°é‡
     â”œâ”€ æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–
     â””â”€ è€ƒè™‘å‡å°‘ä¸å¿…è¦çš„ä»£ç†
```

### 6.3 å¸¸è§å¼‚å¸¸å¤„ç†


**å¼‚å¸¸ç±»å‹åŠè§£å†³æ–¹æ¡ˆ**ï¼š

| å¼‚å¸¸ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **IllegalArgumentException** | åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•é”™è¯¯ | æ£€æŸ¥è¡¨è¾¾å¼è¯­æ³•ï¼Œä½¿ç”¨å·¥å…·éªŒè¯ |
| **ClassCastException** | ä»£ç†ç±»å‹è½¬æ¢é”™è¯¯ | æ£€æŸ¥æ¥å£å®šä¹‰ï¼Œä½¿ç”¨æ­£ç¡®çš„ä»£ç†æ–¹å¼ |
| **UnsupportedOperationException** | ä¸æ”¯æŒçš„æ“ä½œ | æ£€æŸ¥Springç‰ˆæœ¬ï¼Œå‡çº§åˆ°æ”¯æŒçš„ç‰ˆæœ¬ |
| **CircularDependencyException** | å¾ªç¯ä¾èµ– | ä½¿ç”¨@Lazyæˆ–é‡æ„ä»£ç é¿å…å¾ªç¯ |

**å¼‚å¸¸è°ƒè¯•ç¤ºä¾‹**ï¼š
```java
// å¼‚å¸¸ï¼šåˆ‡ç‚¹è¡¨è¾¾å¼é”™è¯¯
@Pointcut("execution(* com.app.service.*.*()")  // ç¼ºå°‘æœ€åçš„ .
// è§£å†³ï¼šè¡¥å…¨è¯­æ³•
@Pointcut("execution(* com.app.service.*.*(..))")

// å¼‚å¸¸ï¼šä»£ç†ç±»å‹è½¬æ¢
UserServiceImpl impl = (UserServiceImpl) context.getBean("userService");
// âŒ å¦‚æœæ˜¯JDKä»£ç†ï¼Œä¼šæŠ›ClassCastException
// è§£å†³ï¼šè½¬æ¢ä¸ºæ¥å£ç±»å‹
UserService service = (UserService) context.getBean("userService");
```

---

## 7. ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡


### 7.1 å…³é”®ç›‘æ§æŒ‡æ ‡


**éœ€è¦ç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡**ï¼š
```
â”Œâ”€ AOPæ€§èƒ½ç›‘æ§æŒ‡æ ‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚
â”‚ ğŸ¯ å¯åŠ¨é˜¶æ®µ                  â”‚
â”‚ â”œâ”€ ä»£ç†åˆ›å»ºæ—¶é—´              â”‚
â”‚ â”œâ”€ åˆ‡ç‚¹åŒ¹é…æ—¶é—´              â”‚
â”‚ â””â”€ ä»£ç†Beanæ•°é‡              â”‚
â”‚                              â”‚
â”‚ âš¡ è¿è¡Œé˜¶æ®µ                  â”‚
â”‚ â”œâ”€ é€šçŸ¥æ‰§è¡Œè€—æ—¶              â”‚
â”‚ â”œâ”€ æ–¹æ³•è°ƒç”¨æ¬¡æ•°              â”‚
â”‚ â””â”€ å¹³å‡å“åº”æ—¶é—´              â”‚
â”‚                              â”‚
â”‚ ğŸ’¾ èµ„æºå ç”¨                  â”‚
â”‚ â”œâ”€ ä»£ç†å¯¹è±¡å†…å­˜å ç”¨          â”‚
â”‚ â”œâ”€ çº¿ç¨‹æ± ä½¿ç”¨æƒ…å†µ            â”‚
â”‚ â””â”€ GCé¢‘ç‡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç›‘æ§å®ç°æ–¹æ¡ˆ


**æ–¹æ¡ˆ1ï¼šä½¿ç”¨Micrometerç›‘æ§**
```java
@Aspect
@Component
public class PerformanceMonitorAspect {
    
    @Autowired
    private MeterRegistry registry;
    
    @Around("@annotation(perfMonitor)")
    public Object monitor(ProceedingJoinPoint pjp, PerfMonitor perfMonitor) throws Throwable {
        String methodName = pjp.getSignature().getName();
        
        // è®°å½•æ‰§è¡Œæ—¶é—´
        Timer.Sample sample = Timer.start(registry);
        
        try {
            Object result = pjp.proceed();
            
            // è®°å½•æˆåŠŸæ¬¡æ•°
            registry.counter("method.success", "method", methodName).increment();
            
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥æ¬¡æ•°
            registry.counter("method.error", "method", methodName).increment();
            throw e;
            
        } finally {
            // è®°å½•æ‰§è¡Œæ—¶é—´
            sample.stop(registry.timer("method.duration", "method", methodName));
        }
    }
}
```

**æ–¹æ¡ˆ2ï¼šè‡ªå®šä¹‰æ€§èƒ½ç»Ÿè®¡**
```java
@Component
public class AopMetrics {
    
    private final Map<String, AtomicLong> executionCount = new ConcurrentHashMap<>();
    private final Map<String, AtomicLong> totalTime = new ConcurrentHashMap<>();
    
    public void record(String method, long duration) {
        executionCount.computeIfAbsent(method, k -> new AtomicLong()).incrementAndGet();
        totalTime.computeIfAbsent(method, k -> new AtomicLong()).addAndGet(duration);
    }
    
    public void printReport() {
        System.out.println("\n=== AOPæ€§èƒ½æŠ¥å‘Š ===");
        executionCount.forEach((method, count) -> {
            long total = totalTime.get(method).get();
            long avg = total / count.get();
            System.out.printf("æ–¹æ³•: %s, è°ƒç”¨æ¬¡æ•°: %d, å¹³å‡è€—æ—¶: %dms%n", 
                             method, count.get(), avg);
        });
    }
}
```

### 7.3 æ€§èƒ½åŸºå‡†å‚è€ƒ


**æ­£å¸¸æ€§èƒ½åŸºå‡†**ï¼š
```
å¯åŠ¨é˜¶æ®µæ€§èƒ½åŸºå‡†ï¼š
â”œâ”€ ä»£ç†åˆ›å»ºï¼š< 10ms/ä¸ª
â”œâ”€ åˆ‡ç‚¹åŒ¹é…ï¼š< 1ms/ä¸ª
â””â”€ æ€»å¯åŠ¨æ—¶é—´å¢åŠ ï¼š< 10%

è¿è¡Œé˜¶æ®µæ€§èƒ½åŸºå‡†ï¼š
â”œâ”€ é€šçŸ¥æ‰§è¡Œå¼€é”€ï¼š< 1ms
â”œâ”€ æ–¹æ³•è°ƒç”¨å¼€é”€ï¼š< 0.1ms
â””â”€ æ€»å“åº”æ—¶é—´å¢åŠ ï¼š< 5%

å†…å­˜å ç”¨åŸºå‡†ï¼š
â”œâ”€ ä»£ç†å¯¹è±¡é¢å¤–å ç”¨ï¼š< 1KB/ä¸ª
â”œâ”€ æ€»å†…å­˜å¢åŠ ï¼š< 20%
â””â”€ GCé¢‘ç‡å¢åŠ ï¼š< 10%
```

**æ€§èƒ½å‘Šè­¦é˜ˆå€¼**ï¼š
```yaml
# ç›‘æ§å‘Šè­¦é…ç½®
aop:
  performance:
    # ä»£ç†åˆ›å»ºè¶…è¿‡50mså‘Šè­¦
    proxy-creation-threshold: 50
    
    # é€šçŸ¥æ‰§è¡Œè¶…è¿‡10mså‘Šè­¦
    advice-execution-threshold: 10
    
    # ä»£ç†Beanæ•°é‡è¶…è¿‡1000å‘Šè­¦
    proxy-bean-count-threshold: 1000
```

---

## 8. ğŸ“ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„ä¼˜åŒ–è¦ç‚¹


```
ğŸ¯ åˆ‡ç‚¹åŒ¹é…ä¼˜åŒ–
â”œâ”€ ä¼˜å…ˆä½¿ç”¨æ³¨è§£æ–¹å¼
â”œâ”€ æ˜ç¡®åŒ…è·¯å¾„ï¼Œé¿å…å…¨å±€æ‰«æ
â””â”€ ç®€åŒ–è¡¨è¾¾å¼ï¼Œå‡å°‘æ­£åˆ™åŒ¹é…

âš¡ é€šçŸ¥æ‰§è¡Œä¼˜åŒ–
â”œâ”€ ä¿æŒé€šçŸ¥æ–¹æ³•è½»é‡
â”œâ”€ å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
â””â”€ é€‰æ‹©åˆé€‚çš„é€šçŸ¥ç±»å‹

ğŸ—ï¸ ä»£ç†åˆ›å»ºä¼˜åŒ–
â”œâ”€ æŒ‰éœ€åˆ›å»ºä»£ç†
â”œâ”€ ä¼˜å…ˆä½¿ç”¨JDKåŠ¨æ€ä»£ç†
â””â”€ å‡å°‘ä¸å¿…è¦çš„ä»£ç†Bean

ğŸ”§ è°ƒè¯•æŠ€å·§
â”œâ”€ å¼€å¯AOPæ—¥å¿—æ’æŸ¥é—®é¢˜
â”œâ”€ ä½¿ç”¨å·¥å…·æ£€æŸ¥ä»£ç†çŠ¶æ€
â””â”€ è§£å†³è‡ªè°ƒç”¨é—®é¢˜

ğŸ“Š æ€§èƒ½ç›‘æ§
â”œâ”€ ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
â”œâ”€ è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
â””â”€ å®šæœŸåˆ†ææ€§èƒ½æŠ¥å‘Š
```

### 8.2 æ€§èƒ½ä¼˜åŒ–å†³ç­–æ ‘


```
é‡åˆ°AOPæ€§èƒ½é—®é¢˜æ—¶ï¼š

å¯åŠ¨æ…¢ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ£€æŸ¥åˆ‡ç‚¹è¡¨è¾¾å¼
â”‚      â””â”€ æ”¹ç”¨æ³¨è§£æ–¹å¼æˆ–æ˜ç¡®åŒ…è·¯å¾„
â”‚
â””â”€ å¦ â†’ æ£€æŸ¥è¿è¡Œæ—¶æ€§èƒ½

è¿è¡Œæ…¢ï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ£€æŸ¥é€šçŸ¥æ–¹æ³•
â”‚      â””â”€ å¼‚æ­¥å¤„ç†æˆ–ç®€åŒ–é€»è¾‘
â”‚
â””â”€ å¦ â†’ æ£€æŸ¥å†…å­˜å ç”¨

å†…å­˜é«˜ï¼Ÿ
â””â”€ å‡å°‘ä»£ç†Beanæ•°é‡
   â””â”€ æŒ‰éœ€åˆ›å»ºæˆ–åˆå¹¶åˆ‡é¢
```

### 8.3 æœ€ä½³å®è·µé€ŸæŸ¥


| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | æ€§èƒ½æå‡ |
|------|----------|----------|
| **æ—¥å¿—è®°å½•** | å¼‚æ­¥æ—¥å¿— + æ³¨è§£åˆ‡ç‚¹ | å“åº”æ—¶é—´é™ä½ **80%** |
| **æƒé™æ ¡éªŒ** | ç¼“å­˜æƒé™ + å‰ç½®é€šçŸ¥ | CPUå ç”¨å‡å°‘ **60%** |
| **æ€§èƒ½ç›‘æ§** | Micrometer + ç¯ç»•é€šçŸ¥ | å¼€é”€æ§åˆ¶åœ¨ **5%ä»¥å†…** |
| **äº‹åŠ¡ç®¡ç†** | Springå£°æ˜å¼äº‹åŠ¡ | æ— éœ€é¢å¤–ä¼˜åŒ– |

### 8.4 å­¦ä¹ æ£€æŸ¥æ¸…å•


**æŒæ¡ç¨‹åº¦è‡ªæµ‹**ï¼š
```
â–¡ ç†è§£AOPæ€§èƒ½å¼€é”€çš„ä¸‰å¤§æ¥æº
â–¡ èƒ½å¤Ÿå†™å‡ºé«˜æ€§èƒ½çš„åˆ‡ç‚¹è¡¨è¾¾å¼
â–¡ ä¼šé€‰æ‹©åˆé€‚çš„é€šçŸ¥ç±»å‹
â–¡ èƒ½å¤Ÿæ’æŸ¥AOPä¸ç”Ÿæ•ˆé—®é¢˜
â–¡ ä¼šè§£å†³è‡ªè°ƒç”¨é—®é¢˜
â–¡ èƒ½å¤Ÿå®ç°æ€§èƒ½ç›‘æ§
â–¡ äº†è§£å¸¸è§æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
```

**å®æˆ˜ç»ƒä¹ å»ºè®®**ï¼š
```
1. å¯¹æ¯”ä¸åŒåˆ‡ç‚¹è¡¨è¾¾å¼çš„æ€§èƒ½å·®å¼‚
2. å®ç°ä¸€ä¸ªå¼‚æ­¥æ—¥å¿—åˆ‡é¢
3. ç›‘æ§AOPçš„å¯åŠ¨å’Œè¿è¡Œæ€§èƒ½
4. æ’æŸ¥å¹¶è§£å†³ä¸€ä¸ªAOPé—®é¢˜
```

---

## ğŸ“ å­¦ä¹ å°è´´å£«


**è®°å¿†å£è¯€**ï¼š
```
åˆ‡ç‚¹ç²¾å‡†å¯åŠ¨å¿«ï¼Œé€šçŸ¥è½»é‡æ‰§è¡Œå¿«
ä»£ç†æŒ‰éœ€å†…å­˜çœï¼Œç›‘æ§åˆ°ä½é—®é¢˜å°‘
```

**å¸¸è§è¯¯åŒº**ï¼š
```
âŒ è¯¯åŒº1ï¼šæ‰€æœ‰æ–¹æ³•éƒ½ç”¨AOP
   âœ… æ­£è§£ï¼šåªå¯¹æ ¸å¿ƒæ–¹æ³•ä½¿ç”¨AOP

âŒ è¯¯åŒº2ï¼šé€šçŸ¥æ–¹æ³•ä¸­åšå¤æ‚ä¸šåŠ¡
   âœ… æ­£è§£ï¼šé€šçŸ¥æ–¹æ³•ä¿æŒç®€å•ï¼Œå¤æ‚é€»è¾‘å¼‚æ­¥å¤„ç†

âŒ è¯¯åŒº3ï¼šå¿½ç•¥æ€§èƒ½ç›‘æ§
   âœ… æ­£è§£ï¼šå®šæœŸç›‘æ§AOPæ€§èƒ½æŒ‡æ ‡
```

**è¿›é˜¶å­¦ä¹ æ–¹å‘**ï¼š
```
ğŸ”¸ æ·±å…¥ç†è§£Springä»£ç†æœºåˆ¶
ğŸ”¸ å­¦ä¹ AspectJç¼–è¯‘æ—¶å¢å¼º
ğŸ”¸ ç ”ç©¶AOPåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨
ğŸ”¸ æ¢ç´¢AOPä¸å…¶ä»–æ¡†æ¶çš„é›†æˆ
```