---
title: 10ã€AOPå¼•ä»‹ä¸æ··å…¥
---
## ğŸ“š ç›®å½•

1. [å¼•ä»‹(Introduction)æ˜¯ä»€ä¹ˆ](#1-å¼•ä»‹introductionæ˜¯ä»€ä¹ˆ)
2. [å¼•ä»‹çš„æ ¸å¿ƒä½œç”¨](#2-å¼•ä»‹çš„æ ¸å¿ƒä½œç”¨)
3. [DeclareParentsè¯¦è§£](#3-declareparentsè¯¦è§£)
4. [å¼•ä»‹çš„å®ç°æ–¹å¼](#4-å¼•ä»‹çš„å®ç°æ–¹å¼)
5. [å¼•ä»‹vsæ™®é€šAOPå¯¹æ¯”](#5-å¼•ä»‹vsæ™®é€šaopå¯¹æ¯”)
6. [å®æˆ˜åº”ç”¨åœºæ™¯](#6-å®æˆ˜åº”ç”¨åœºæ™¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¼•ä»‹(Introduction)æ˜¯ä»€ä¹ˆ


### 1.1 ç™½è¯è§£é‡Š


**ç”¨ç”Ÿæ´»ä¾‹å­ç†è§£ï¼š**
```
æƒ³è±¡ä½ æœ‰ä¸€ä¸ªæ™®é€šæ‰‹æœºï¼š
- åŸæœ¬åªèƒ½æ‰“ç”µè¯ã€å‘çŸ­ä¿¡
- ç°åœ¨æƒ³è®©å®ƒèƒ½æ‹ç…§ã€å¬éŸ³ä¹

ä¼ ç»Ÿåšæ³•ï¼šä¹°ä¸ªæ–°æ‰‹æœºï¼ˆé‡æ–°åˆ›å»ºå¯¹è±¡ï¼‰
å¼•ä»‹åšæ³•ï¼šç»™æ‰‹æœºè£…ä¸ªå¤–å£³é…ä»¶ï¼ˆåŠ¨æ€æ·»åŠ åŠŸèƒ½ï¼‰
```

**ä¸“ä¸šå®šä¹‰ï¼š**
> å¼•ä»‹(Introduction)æ˜¯AOPçš„ä¸€ç§ç‰¹æ®Šé€šçŸ¥ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸ä¿®æ”¹åŸæœ‰ç±»ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºè¿™ä¸ªç±»åŠ¨æ€æ·»åŠ æ–°çš„æ¥å£å®ç°å’Œæ–¹æ³•ã€‚

### 1.2 å¼•ä»‹è§£å†³çš„é—®é¢˜


**ğŸ”¸ é—®é¢˜åœºæ™¯ï¼š**
```
å·²æœ‰çš„ç”¨æˆ·ç±»ï¼š
class User {
    private String name;
    private String email;
    // åªæœ‰åŸºç¡€å±æ€§å’Œæ–¹æ³•
}

æ–°éœ€æ±‚ï¼šæ‰€æœ‰ç”¨æˆ·éœ€è¦å…·å¤‡"å¯å®¡è®¡"åŠŸèƒ½
- è®°å½•åˆ›å»ºæ—¶é—´
- è®°å½•ä¿®æ”¹æ—¶é—´  
- è®°å½•æ“ä½œäºº

ä¼ ç»Ÿå›°å¢ƒï¼š
âŒ ä¿®æ”¹Userç±» â†’ è¿åå¼€é—­åŸåˆ™
âŒ ç»§æ‰¿Userç±» â†’ ç±»çˆ†ç‚¸ï¼Œéš¾ç»´æŠ¤
âŒ åŒ…è£…æ¨¡å¼ â†’ ä»£ç å†—ä½™

âœ… å¼•ä»‹æ–¹æ¡ˆï¼š
åŠ¨æ€è®©Userå®ç°Auditableæ¥å£ï¼Œæ— éœ€æ”¹åŠ¨åŸç±»ï¼
```

### 1.3 å¼•ä»‹çš„æœ¬è´¨


**æ ¸å¿ƒç†è§£ï¼š**
```
æ™®é€šAOPï¼š
- åœ¨æ–¹æ³•æ‰§è¡Œå‰ååŠ ä»£ç ï¼ˆæ¨ªåˆ‡ï¼‰
- ä¸æ”¹å˜ç±»çš„ç»“æ„

å¼•ä»‹ï¼š
- è®©ç±»å®ç°æ–°æ¥å£ï¼ˆçºµå‘æ‰©å±•ï¼‰
- æ”¹å˜äº†ç±»çš„èƒ½åŠ›èŒƒå›´
- ä½†ä¸ä¿®æ”¹åŸå§‹ä»£ç 

å½¢è±¡æ¯”å–»ï¼š
æ™®é€šAOP = åœ¨æˆ¿å­å¤–é¢åŠ ä¸ªé™¢å­ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰
å¼•ä»‹ = ç»™æˆ¿å­åŠ ä¸ªæ–°æˆ¿é—´ï¼ˆç»“æ„æ‰©å±•ï¼‰
```

---

## 2. âš¡ å¼•ä»‹çš„æ ¸å¿ƒä½œç”¨


### 2.1 åŠ¨æ€æ¥å£å®ç°


**ğŸ”¸ å·¥ä½œåŸç†ï¼š**
```
åŸå§‹çŠ¶æ€ï¼š
Userå¯¹è±¡ â†’ åªå®ç°äº†Serializableæ¥å£

å¼•ä»‹åï¼š
Userå¯¹è±¡ â†’ å®ç°äº†Serializable + Auditableæ¥å£
         â†’ å¯ä»¥è½¬å‹ä¸ºAuditableä½¿ç”¨

é‡ç‚¹ï¼š
â€¢ User.javaæºç æ²¡æœ‰ä»»ä½•æ”¹åŠ¨
â€¢ è¿è¡Œæ—¶åŠ¨æ€è·å¾—äº†æ–°èƒ½åŠ›
â€¢ å¤–éƒ¨å¯ä»¥æŠŠUserå½“ä½œAuditableä½¿ç”¨
```

**ğŸ“ æ¦‚å¿µè¯´æ˜ï¼š**

| æœ¯è¯­ | **å«ä¹‰** | **ä½œç”¨** |
|------|---------|---------|
| **å¼•ä»‹(Introduction)** | `ä¸ºç±»æ·»åŠ æ–°æ¥å£çš„AOPæŠ€æœ¯` | `è¿è¡Œæ—¶æ‰©å±•ç±»åŠŸèƒ½` |
| **æ··å…¥(Mixin)** | `æŠŠå¤šä¸ªæ¥å£çš„åŠŸèƒ½æ··åˆåˆ°ä¸€ä¸ªç±»` | `å®ç°å¤šé‡èƒ½åŠ›ç»„åˆ` |
| **ç›®æ ‡æ¥å£** | `è¦åŠ¨æ€æ·»åŠ çš„æ–°æ¥å£` | `å®šä¹‰æ–°å¢çš„åŠŸèƒ½` |
| **é»˜è®¤å®ç°** | `æ–°æ¥å£çš„å…·ä½“å®ç°ç±»` | `æä¾›å®é™…åŠŸèƒ½ä»£ç ` |

### 2.2 åŠŸèƒ½å¢å¼ºè·¯å¾„


**â­ å¼•ä»‹çš„ä¸‰ç§å¢å¼ºï¼š**

**1. æ¥å£æ··å…¥ï¼ˆæœ€å¸¸ç”¨ï¼‰**
```
è®©å·²æœ‰ç±»å®ç°æ–°æ¥å£

ç¤ºä¾‹ï¼š
Userç±» + Auditableæ¥å£ = å…·å¤‡å®¡è®¡èƒ½åŠ›çš„User
Productç±» + Cacheableæ¥å£ = å…·å¤‡ç¼“å­˜èƒ½åŠ›çš„Product
```

**2. è¡Œä¸ºæ‰©å±•**
```
ä¸ºç±»æ·»åŠ å…¨æ–°çš„æ–¹æ³•

ç¤ºä¾‹ï¼š
åŸæœ¬ï¼šuser.getName(), user.getEmail()
æ‰©å±•åï¼šuser.getCreatedTime(), user.getLastModified()
```

**3. çŠ¶æ€ç®¡ç†**
```
ä¸ºå¯¹è±¡å¼•å…¥æ–°çš„çŠ¶æ€å±æ€§

ç¤ºä¾‹ï¼š
åŸæœ¬Useråªæœ‰nameã€email
å¼•ä»‹åï¼šUseræ‹¥æœ‰createdAtã€modifiedAtç­‰å®¡è®¡å­—æ®µ
```

---

## 3. ğŸ“‹ DeclareParentsè¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯DeclareParents


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µï¼š**
> `@DeclareParents`æ˜¯Spring AOPä¸­å®ç°å¼•ä»‹çš„æ ¸å¿ƒæ³¨è§£ï¼Œå®ƒçš„ä½œç”¨æ˜¯"å£°æ˜çˆ¶æ¥å£"ï¼Œè®©ç›®æ ‡ç±»åœ¨è¿è¡Œæ—¶è·å¾—æ–°çš„æ¥å£èƒ½åŠ›ã€‚

**ç™½è¯ç†è§£ï¼š**
```
DeclareParents = "å®£å¸ƒè®¤çˆ¹"

åŸæœ¬ï¼š
Useræ˜¯ä¸ªå­¤å„¿ï¼Œæ²¡æœ‰å®ç°ä»»ä½•ä¸šåŠ¡æ¥å£

ä½¿ç”¨@DeclareParentsåï¼š
Userè®¤äº†Auditableå½“çˆ¹ï¼ˆå®ç°äº†è¿™ä¸ªæ¥å£ï¼‰
ç°åœ¨Userå¯ä»¥ä½¿ç”¨Auditableçš„æ‰€æœ‰æ–¹æ³•äº†
```

### 3.2 DeclareParentsæ³¨è§£è¯¦è§£


**ğŸ“Š æ³¨è§£ç»“æ„ï¼š**
```java
@DeclareParents(
    value = "com.example.service.*+",  // è¦å¢å¼ºçš„ç›®æ ‡ç±»
    defaultImpl = AuditableImpl.class  // æ–°æ¥å£çš„é»˜è®¤å®ç°
)
public static Auditable auditable;     // è¦å¼•å…¥çš„æ¥å£
```

**ğŸ”§ å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | **ä½œç”¨** | **ç¤ºä¾‹** | **æ³¨æ„äº‹é¡¹** |
|------|---------|---------|-------------|
| `value` | `æŒ‡å®šè¦å¢å¼ºçš„ç›®æ ‡ç±»` | `"com.example..*"` | `æ”¯æŒAspectJè¡¨è¾¾å¼` |
| `defaultImpl` | `æ–°æ¥å£çš„å®ç°ç±»` | `AuditableImpl.class` | `å¿…é¡»æœ‰æ— å‚æ„é€ ` |
| `æ¥å£å­—æ®µ` | `å£°æ˜è¦å¼•å…¥çš„æ¥å£ç±»å‹` | `Auditable` | `å¿…é¡»æ˜¯public static` |

**âš ï¸ æ³¨æ„äº‹é¡¹ï¼š**
> **é‡ç‚¹ç†è§£ï¼š**
> - `value`ï¼šå‘Šè¯‰Spring"è°éœ€è¦è¿™ä¸ªèƒ½åŠ›"
> - `defaultImpl`ï¼šå‘Šè¯‰Spring"è¿™ä¸ªèƒ½åŠ›æ€ä¹ˆå®ç°"
> - `æ¥å£å­—æ®µ`ï¼šå‘Šè¯‰Spring"è¦åŠ ä»€ä¹ˆèƒ½åŠ›"

### 3.3 å®Œæ•´å®ç°æ­¥éª¤


**ğŸ“‹ å®ç°æµç¨‹ï¼š**

**æ­¥éª¤1ï¼šå®šä¹‰è¦å¼•å…¥çš„æ¥å£**
```java
// å®¡è®¡æ¥å£
public interface Auditable {
    void setCreatedTime(Date time);
    Date getCreatedTime();
    void setModifiedTime(Date time);
    Date getModifiedTime();
}
```

**æ­¥éª¤2ï¼šæä¾›æ¥å£çš„é»˜è®¤å®ç°**
```java
public class AuditableImpl implements Auditable {
    private Date createdTime;
    private Date modifiedTime;
    
    @Override
    public void setCreatedTime(Date time) {
        this.createdTime = time;
    }
    
    @Override
    public Date getCreatedTime() {
        return this.createdTime;
    }
    
    // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

**æ­¥éª¤3ï¼šåˆ›å»ºå¼•ä»‹åˆ‡é¢**
```java
@Aspect
@Component
public class AuditableIntroduction {
    
    // ä¸ºserviceåŒ…ä¸‹æ‰€æœ‰ç±»å¼•å…¥Auditableæ¥å£
    @DeclareParents(
        value = "com.example.service.*+",
        defaultImpl = AuditableImpl.class
    )
    public static Auditable auditable;
    
    // åœ¨å¯¹è±¡åˆ›å»ºæ—¶è®¾ç½®åˆ›å»ºæ—¶é—´
    @Before("execution(* com.example.service.*.*(..)) && this(auditable)")
    public void setCreatedTime(Auditable auditable) {
        if (auditable.getCreatedTime() == null) {
            auditable.setCreatedTime(new Date());
        }
    }
}
```

**æ­¥éª¤4ï¼šä½¿ç”¨å¼•ä»‹åçš„å¯¹è±¡**
```java
@Service
public class UserService {
    public void createUser(String name) {
        // ä¸šåŠ¡é€»è¾‘
        System.out.println("åˆ›å»ºç”¨æˆ·: " + name);
    }
}

// æµ‹è¯•ä»£ç 
public class Test {
    public static void main(String[] args) {
        UserService userService = context.getBean(UserService.class);
        
        // ç°åœ¨å¯ä»¥è½¬å‹ä¸ºAuditableä½¿ç”¨
        Auditable auditable = (Auditable) userService;
        
        System.out.println("åˆ›å»ºæ—¶é—´: " + auditable.getCreatedTime());
    }
}
```

---

## 4. ğŸ”§ å¼•ä»‹çš„å®ç°æ–¹å¼


### 4.1 åŸºäºæ³¨è§£çš„å¼•ä»‹ï¼ˆæ¨èï¼‰


**âœ… ä¼˜ç‚¹ï¼š**
- é…ç½®ç®€å•ï¼Œä»£ç æ¸…æ™°
- ç±»å‹å®‰å…¨ï¼ŒIDEå‹å¥½
- æ˜“äºç»´æŠ¤å’Œç†è§£

**ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼š**
```java
// 1. å®šä¹‰ç¼“å­˜æ¥å£
public interface Cacheable {
    void cache(Object key, Object value);
    Object get(Object key);
    void clear();
}

// 2. å®ç°ç¼“å­˜é€»è¾‘
public class CacheableImpl implements Cacheable {
    private Map<Object, Object> cache = new HashMap<>();
    
    @Override
    public void cache(Object key, Object value) {
        cache.put(key, value);
    }
    
    @Override
    public Object get(Object key) {
        return cache.get(key);
    }
    
    @Override
    public void clear() {
        cache.clear();
    }
}

// 3. åˆ›å»ºå¼•ä»‹åˆ‡é¢
@Aspect
@Component
public class CacheableIntroduction {
    
    @DeclareParents(
        value = "com.example.repository.*",
        defaultImpl = CacheableImpl.class
    )
    public static Cacheable cacheable;
}
```

### 4.2 åŸºäºXMLçš„å¼•ä»‹


**ğŸ“„ é…ç½®æ–¹å¼ï¼š**
```xml
<aop:config>
    <aop:aspect ref="auditableIntroduction">
        <!-- å¼•ä»‹é…ç½® -->
        <aop:declare-parents
            types-matching="com.example.service.*"
            implement-interface="com.example.Auditable"
            default-impl="com.example.AuditableImpl"/>
    </aop:aspect>
</aop:config>
```

**ğŸ”¸ å¯¹æ¯”è¯´æ˜ï¼š**

| æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|---------|---------|-------------|
| **æ³¨è§£æ–¹å¼** | `ç®€æ´ã€ç›´è§‚ã€ç±»å‹å®‰å…¨` | `éœ€è¦Java5+` | `æ–°é¡¹ç›®é¦–é€‰` |
| **XMLæ–¹å¼** | `é›†ä¸­ç®¡ç†ã€æ— ä¾µå…¥` | `é…ç½®å†—é•¿` | `è€é¡¹ç›®ç»´æŠ¤` |

---

## 5. âš–ï¸ å¼•ä»‹vsæ™®é€šAOPå¯¹æ¯”


### 5.1 æœ¬è´¨åŒºåˆ«


**ğŸ”¸ æ ¸å¿ƒå·®å¼‚ï¼š**

```
æ™®é€šAOPï¼ˆæ–¹æ³•æ‹¦æˆªï¼‰ï¼š
Userå¯¹è±¡
  â”œâ”€â”€ getName() â† å‰é¢åŠ æ—¥å¿—
  â”œâ”€â”€ setName() â† åé¢åŠ éªŒè¯
  â””â”€â”€ save()    â† å‘¨å›´åŠ äº‹åŠ¡

å¼•ä»‹AOPï¼ˆæ¥å£å¢å¼ºï¼‰ï¼š
Userå¯¹è±¡
  â”œâ”€â”€ åŸæœ‰æ–¹æ³•
  â””â”€â”€ æ–°å¢Auditableæ¥å£
        â”œâ”€â”€ getCreatedTime()
        â””â”€â”€ getModifiedTime()
```

**ğŸ“Š è¯¦ç»†å¯¹æ¯”ï¼š**

| å¯¹æ¯”ç»´åº¦ | **æ™®é€šAOP** | **å¼•ä»‹** |
|---------|-----------|---------|
| **ä½œç”¨å¯¹è±¡** | `æ–¹æ³•` | `ç±»/æ¥å£` |
| **å¢å¼ºæ–¹å¼** | `æ–¹æ³•å‰åæ’å…¥ä»£ç ` | `åŠ¨æ€å®ç°æ–°æ¥å£` |
| **æ”¹å˜å†…å®¹** | `æ–¹æ³•è¡Œä¸º` | `ç±»çš„èƒ½åŠ›` |
| **ä½¿ç”¨åœºæ™¯** | `æ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨` | `åŠŸèƒ½æ··å…¥ã€èƒ½åŠ›æ‰©å±•` |
| **é€šçŸ¥ç±»å‹** | `@Beforeã€@Afterç­‰` | `@DeclareParents` |

### 5.2 ä½¿ç”¨é€‰æ‹©æŒ‡å—


**â“ ä½•æ—¶ä½¿ç”¨å¼•ä»‹ï¼š**

```
âœ… é€‚åˆå¼•ä»‹çš„åœºæ™¯ï¼š
â€¢ éœ€è¦ä¸ºä¸€æ‰¹ç±»æ·»åŠ ç»Ÿä¸€çš„æ–°èƒ½åŠ›
â€¢ ä¸æƒ³ä¿®æ”¹åŸæœ‰ç±»çš„ä»£ç 
â€¢ éœ€è¦åŠ¨æ€ç»„åˆå¤šä¸ªåŠŸèƒ½
â€¢ å®ç°æ¨ªè·¨å¤šä¸ªç±»çš„åŠŸèƒ½æ··å…¥

âŒ ä¸é€‚åˆå¼•ä»‹çš„åœºæ™¯ï¼š
â€¢ åªæ˜¯ç®€å•çš„æ–¹æ³•å¢å¼ºï¼ˆç”¨æ™®é€šAOPï¼‰
â€¢ éœ€è¦ä¿®æ”¹åŸæœ‰æ–¹æ³•çš„è¿”å›å€¼
â€¢ æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
```

**ğŸ¯ é€‰æ‹©å†³ç­–æ ‘ï¼š**
```
éœ€è¦å¢å¼ºåŠŸèƒ½ï¼Ÿ
  â”œâ”€ åªæ˜¯æ–¹æ³•å‰ååŠ ä»£ç ï¼Ÿ â†’ æ™®é€šAOP
  â””â”€ è¦ç»™ç±»åŠ æ–°èƒ½åŠ›ï¼Ÿ
       â”œâ”€ æ–°èƒ½åŠ›æ˜¯ç‹¬ç«‹æ¥å£ï¼Ÿ â†’ å¼•ä»‹
       â””â”€ åªæ˜¯ä¿®æ”¹ç°æœ‰æ–¹æ³•ï¼Ÿ â†’ æ™®é€šAOP
```

---

## 6. ğŸš€ å®æˆ˜åº”ç”¨åœºæ™¯


### 6.1 å®¡è®¡åŠŸèƒ½æ··å…¥


**åœºæ™¯æè¿°ï¼š**
> æ‰€æœ‰å®ä½“ç±»éœ€è¦è®°å½•åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æ“ä½œäººç­‰å®¡è®¡ä¿¡æ¯ï¼Œä½†ä¸æƒ³æ±¡æŸ“ä¸šåŠ¡ä»£ç ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// å®¡è®¡æ¥å£
public interface Auditable {
    LocalDateTime getCreatedAt();
    void setCreatedAt(LocalDateTime time);
    String getCreatedBy();
    void setCreatedBy(String user);
}

// å¼•ä»‹åˆ‡é¢
@Aspect
@Component
public class AuditIntroduction {
    
    @DeclareParents(
        value = "com.example.entity.*",
        defaultImpl = AuditableImpl.class
    )
    public static Auditable auditable;
    
    // ä¿å­˜å‰è‡ªåŠ¨è®¾ç½®å®¡è®¡ä¿¡æ¯
    @Before("execution(* com.example.repository.*.save(..)) && args(entity)")
    public void beforeSave(Object entity) {
        if (entity instanceof Auditable) {
            Auditable audit = (Auditable) entity;
            if (audit.getCreatedAt() == null) {
                audit.setCreatedAt(LocalDateTime.now());
                audit.setCreatedBy(getCurrentUser());
            }
        }
    }
}
```

**ğŸ’¡ å®æˆ˜æ•ˆæœï¼š**
- æ‰€æœ‰å®ä½“è‡ªåŠ¨å…·å¤‡å®¡è®¡èƒ½åŠ›
- ä¸šåŠ¡ä»£ç ä¿æŒçº¯å‡€
- å®¡è®¡é€»è¾‘é›†ä¸­ç®¡ç†

### 6.2 ç¼“å­˜èƒ½åŠ›æ··å…¥


**åœºæ™¯æè¿°ï¼š**
> ä¸ºRepositoryå±‚æ·»åŠ ç¼“å­˜åŠŸèƒ½ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// ç¼“å­˜æ¥å£
public interface Cacheable {
    boolean isCached(String key);
    Object getFromCache(String key);
    void putToCache(String key, Object value);
}

// å¼•ä»‹åˆ‡é¢
@Aspect
@Component
public class CacheIntroduction {
    
    @DeclareParents(
        value = "com.example.repository.*",
        defaultImpl = SimpleCacheImpl.class
    )
    public static Cacheable cacheable;
    
    @Around("execution(* com.example.repository.*.findById(..)) && target(repository)")
    public Object cacheQuery(ProceedingJoinPoint pjp, Object repository) throws Throwable {
        Cacheable cache = (Cacheable) repository;
        String key = "findById:" + pjp.getArgs()[0];
        
        // æ£€æŸ¥ç¼“å­˜
        if (cache.isCached(key)) {
            return cache.getFromCache(key);
        }
        
        // æ‰§è¡ŒæŸ¥è¯¢
        Object result = pjp.proceed();
        
        // æ”¾å…¥ç¼“å­˜
        cache.putToCache(key, result);
        return result;
    }
}
```

### 6.3 å¤šåŠŸèƒ½ç»„åˆæ··å…¥


**åœºæ™¯æè¿°ï¼š**
> ä¸€ä¸ªServiceéœ€è¦åŒæ—¶å…·å¤‡å®¡è®¡ã€ç¼“å­˜ã€ç›‘æ§ç­‰å¤šç§èƒ½åŠ›ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
```java
@Aspect
@Component
public class MultiFeatureIntroduction {
    
    // æ··å…¥å®¡è®¡èƒ½åŠ›
    @DeclareParents(
        value = "com.example.service.*",
        defaultImpl = AuditableImpl.class
    )
    public static Auditable auditable;
    
    // æ··å…¥ç¼“å­˜èƒ½åŠ›
    @DeclareParents(
        value = "com.example.service.*",
        defaultImpl = CacheableImpl.class
    )
    public static Cacheable cacheable;
    
    // æ··å…¥ç›‘æ§èƒ½åŠ›
    @DeclareParents(
        value = "com.example.service.*",
        defaultImpl = MonitorableImpl.class
    )
    public static Monitorable monitorable;
}
```

**ğŸ¯ æ•ˆæœå±•ç¤ºï¼š**
```java
// Serviceç±»æ— éœ€ä¿®æ”¹
@Service
public class OrderService {
    public Order createOrder(Long userId, Long productId) {
        // çº¯ä¸šåŠ¡é€»è¾‘
        return new Order(userId, productId);
    }
}

// ä½¿ç”¨æ—¶æ‹¥æœ‰å¤šç§èƒ½åŠ›
OrderService service = context.getBean(OrderService.class);

// ä½œä¸ºAuditableä½¿ç”¨
((Auditable) service).setCreatedBy("admin");

// ä½œä¸ºCacheableä½¿ç”¨
((Cacheable) service).putToCache("key", "value");

// ä½œä¸ºMonitorableä½¿ç”¨
((Monitorable) service).startMonitoring();
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å¼•ä»‹çš„æœ¬è´¨ï¼š**
```
å¼•ä»‹ = åŠ¨æ€æ¥å£å®ç°æŠ€æœ¯
â€¢ è¿è¡Œæ—¶ä¸ºç±»æ·»åŠ æ–°æ¥å£
â€¢ ä¸ä¿®æ”¹åŸå§‹ç±»ä»£ç 
â€¢ å®ç°åŠŸèƒ½çš„éä¾µå…¥å¼æ‰©å±•
```

**ğŸ”¸ DeclareParentsçš„ä½œç”¨ï¼š**
```
@DeclareParentsæ³¨è§£ï¼š
â€¢ value â†’ é€‰æ‹©ç›®æ ‡ç±»
â€¢ defaultImpl â†’ æä¾›å®ç°
â€¢ æ¥å£å­—æ®µ â†’ å£°æ˜èƒ½åŠ›
```

**ğŸ”¸ å¼•ä»‹vsæ™®é€šAOPï¼š**
```
æ™®é€šAOPï¼šæ–¹æ³•çº§å¢å¼ºï¼ˆæ¨ªåˆ‡ï¼‰
å¼•ä»‹ï¼šç±»çº§å¢å¼ºï¼ˆçºµå‘ï¼‰

é€‰æ‹©åŸåˆ™ï¼š
â€¢ æ–¹æ³•å¢å¼º â†’ æ™®é€šAOP
â€¢ èƒ½åŠ›æ‰©å±• â†’ å¼•ä»‹
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ’¡ æ ¸å¿ƒè®°å¿†ï¼š**

| æ¦‚å¿µ | **æ ¸å¿ƒè¦ç‚¹** | **åº”ç”¨åœºæ™¯** |
|------|------------|-------------|
| **å¼•ä»‹** | `è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ æ¥å£` | `åŠŸèƒ½æ··å…¥ã€èƒ½åŠ›æ‰©å±•` |
| **DeclareParents** | `å£°æ˜è¦å®ç°çš„çˆ¶æ¥å£` | `å¼•ä»‹çš„å…·ä½“å®ç°æ–¹å¼` |
| **æ¥å£æ··å…¥** | `ä¸€ä¸ªç±»å®ç°å¤šä¸ªæ¥å£` | `å¤šåŠŸèƒ½ç»„åˆ` |
| **é»˜è®¤å®ç°** | `æ–°æ¥å£çš„å…·ä½“å®ç°ç±»` | `æä¾›å®é™…åŠŸèƒ½ä»£ç ` |

**ğŸ§  è®°å¿†å£è¯€ï¼š**
```
å¼•ä»‹æŠ€æœ¯çœŸç¥å¥‡ï¼ŒåŠ¨æ€æ¥å£ä¸è´¹åŠ›
DeclareParentsæ¥å£°æ˜ï¼Œç›®æ ‡å®ç°è¦é…å…¨
æ··å…¥åŠŸèƒ½ç»„åˆå¥½ï¼Œä»£ç å¹²å‡€åˆä¼˜é›…
```

### 7.3 å®æˆ˜åº”ç”¨å»ºè®®


**âœ… æœ€ä½³å®è·µï¼š**

**1. æ¥å£è®¾è®¡åŸåˆ™**
```
â€¢ æ¥å£è¦èŒè´£å•ä¸€
â€¢ æ–¹æ³•è¦è¯­ä¹‰æ¸…æ™°
â€¢ é¿å…è¿‡åº¦è®¾è®¡
```

**2. å®ç°ç±»æ³¨æ„äº‹é¡¹**
```
â€¢ å¿…é¡»æœ‰æ— å‚æ„é€ å‡½æ•°
â€¢ çº¿ç¨‹å®‰å…¨è€ƒè™‘
â€¢ çŠ¶æ€ç®¡ç†è¦è°¨æ…
```

**3. ä½¿ç”¨åœºæ™¯é€‰æ‹©**
```
é€‚åˆï¼šå®¡è®¡ã€ç¼“å­˜ã€ç›‘æ§ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹
ä¸é€‚åˆï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
```

**âš ï¸ å¸¸è§é™·é˜±ï¼š**

> **é—®é¢˜1ï¼šClassCastException**
> - åŸå› ï¼šç›®æ ‡ç±»æœªè¢«ä»£ç†
> - è§£å†³ï¼šæ£€æŸ¥åˆ‡ç‚¹è¡¨è¾¾å¼

> **é—®é¢˜2ï¼šæ–¹æ³•è°ƒç”¨å¤±è´¥**
> - åŸå› ï¼šå®ç°ç±»ç¼ºå°‘æ— å‚æ„é€ 
> - è§£å†³ï¼šæ·»åŠ é»˜è®¤æ„é€ å‡½æ•°

> **é—®é¢˜3ï¼šçŠ¶æ€ä¸ä¸€è‡´**
> - åŸå› ï¼šå¤šä¸ªå¼•ä»‹å…±äº«çŠ¶æ€
> - è§£å†³ï¼šéš”ç¦»å„å¼•ä»‹çš„çŠ¶æ€

**ğŸ¯ å­¦ä¹ å»ºè®®ï¼š**
- å…ˆç†è§£æ™®é€šAOPï¼Œå†å­¦ä¹ å¼•ä»‹
- ä»ç®€å•çš„å•æ¥å£å¼•ä»‹å¼€å§‹
- é€æ­¥å°è¯•å¤šåŠŸèƒ½æ··å…¥
- æ³¨æ„æ€§èƒ½å’Œå†…å­˜å¼€é”€

---

**ğŸ”‘ æ ¸å¿ƒè®°å¿†ï¼š**
- å¼•ä»‹æ˜¯AOPçš„é«˜çº§ç‰¹æ€§ï¼Œå®ç°åŠ¨æ€æ¥å£æ··å…¥
- ä½¿ç”¨@DeclareParentsæ³¨è§£å£°æ˜è¦å¼•å…¥çš„æ¥å£
- ä¸ä¿®æ”¹åŸç±»ä»£ç ï¼Œå°±èƒ½æ‰©å±•æ–°èƒ½åŠ›
- é€‚åˆå®¡è®¡ã€ç¼“å­˜ç­‰æ¨ªåˆ‡åŠŸèƒ½çš„ç»Ÿä¸€å®ç°