---
title: 7ã€æ³¨è§£æ–¹å¼AOP
---
## ğŸ“š ç›®å½•

1. [AOPæ³¨è§£é…ç½®æ¦‚è¿°](#1-AOPæ³¨è§£é…ç½®æ¦‚è¿°)
2. [å¯ç”¨AOPæ³¨è§£æ”¯æŒ](#2-å¯ç”¨AOPæ³¨è§£æ”¯æŒ)
3. [åˆ‡é¢ç±»å®šä¹‰](#3-åˆ‡é¢ç±»å®šä¹‰)
4. [åˆ‡å…¥ç‚¹è¡¨è¾¾å¼](#4-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼)
5. [é€šçŸ¥ç±»å‹è¯¦è§£](#5-é€šçŸ¥ç±»å‹è¯¦è§£)
6. [å®Œæ•´å®æˆ˜æ¡ˆä¾‹](#6-å®Œæ•´å®æˆ˜æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ AOPæ³¨è§£é…ç½®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ³¨è§£æ–¹å¼AOP


**é€šä¿—ç†è§£**ï¼š
æƒ³è±¡ä½ åœ¨é¤å…åƒé¥­ï¼ŒæœåŠ¡å‘˜ä¼šåœ¨ä½ ç‚¹é¤å‰é—®"éœ€è¦ä»€ä¹ˆé¥®æ–™"ï¼ˆå‰ç½®ï¼‰ï¼Œé¤åé—®"æ˜¯å¦éœ€è¦å‘ç¥¨"ï¼ˆåç½®ï¼‰ã€‚è¿™äº›é¢å¤–æœåŠ¡å°±åƒAOPï¼Œè€Œ**æ³¨è§£æ–¹å¼å°±æ˜¯ç”¨æ ‡ç­¾å‘Šè¯‰Springåœ¨å“ªé‡Œæä¾›è¿™äº›æœåŠ¡**ã€‚

**æ ¸å¿ƒå®šä¹‰**ï¼š
```
æ³¨è§£æ–¹å¼AOP = ç”¨Javaæ³¨è§£æ ‡è®° + Springè‡ªåŠ¨è¯†åˆ«
â€¢ ä¸éœ€è¦XMLé…ç½®æ–‡ä»¶
â€¢ ä»£ç æ›´ç®€æ´ç›´è§‚
â€¢ ç»´æŠ¤æ›´æ–¹ä¾¿
```

### 1.2 æ³¨è§£vs XMLé…ç½®


| å¯¹æ¯”é¡¹ | æ³¨è§£æ–¹å¼ | XMLæ–¹å¼ |
|--------|---------|---------|
| **é…ç½®ä½ç½®** | Javaç±»ä¸­ç”¨`@`æ ‡è®° | applicationContext.xmlæ–‡ä»¶ |
| **å­¦ä¹ éš¾åº¦** | â­â­ å®¹æ˜“ç†è§£ | â­â­â­ éœ€è¦å­¦XMLè¯­æ³• |
| **å¼€å‘æ•ˆç‡** | âœ… å¿«é€Ÿå¼€å‘ | âŒ é…ç½®ç¹ç |
| **ç»´æŠ¤æ€§** | âœ… ä»£ç é›†ä¸­ | âŒ åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ |
| **æ¨èç¨‹åº¦** | ğŸ”¥ ç°ä»£å¼€å‘é¦–é€‰ | ğŸ’¡ è€é¡¹ç›®å¯èƒ½ç”¨åˆ° |

---

## 2. ğŸ”§ å¯ç”¨AOPæ³¨è§£æ”¯æŒ


### 2.1 æ ¸å¿ƒæ³¨è§£ï¼š@EnableAspectJAutoProxy


**ä½œç”¨è§£é‡Š**ï¼š
è¿™ä¸ªæ³¨è§£å°±åƒæ‰“å¼€ä¸€ä¸ª"è‡ªåŠ¨è¯†åˆ«AOP"çš„å¼€å…³ï¼Œå‘Šè¯‰Springï¼š"å˜¿ï¼Œæˆ‘è¦ç”¨æ³¨è§£æ–¹å¼å†™AOPï¼Œä½ å¸®æˆ‘è‡ªåŠ¨å¤„ç†å§ï¼"

**é…ç½®æ–¹å¼**ï¼š

```java
@Configuration
@EnableAspectJAutoProxy  // ğŸ‘ˆ å¼€å¯AOPæ³¨è§£æ”¯æŒ
public class AppConfig {
    // å…¶ä»–é…ç½®...
}
```

### 2.2 é…ç½®é€‰é¡¹è¯´æ˜


**åŸºç¡€é…ç½®**ï¼š
```java
@EnableAspectJAutoProxy(
    proxyTargetClass = false,  // é»˜è®¤ï¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†
    exposeProxy = false        // é»˜è®¤ï¼šä¸æš´éœ²ä»£ç†å¯¹è±¡
)
```

**å‚æ•°å«ä¹‰**ï¼š

ğŸ”¸ **proxyTargetClass**
```
falseï¼ˆé»˜è®¤ï¼‰ï¼šä¼˜å…ˆä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼ˆéœ€è¦æ¥å£ï¼‰
trueï¼šå¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†ï¼ˆå¯ä»¥ä»£ç†ç±»ï¼‰

é€šä¿—ç†è§£ï¼š
â€¢ JDKä»£ç† = éœ€è¦"å‰§æœ¬"ï¼ˆæ¥å£ï¼‰æ‰èƒ½è¡¨æ¼”
â€¢ CGLIBä»£ç† = ä¸éœ€è¦å‰§æœ¬ï¼Œç›´æ¥æ¨¡ä»¿æ¼”å‘˜ï¼ˆç±»ï¼‰
```

ğŸ”¸ **exposeProxy**
```
falseï¼ˆé»˜è®¤ï¼‰ï¼šä»£ç†å¯¹è±¡ä¸æš´éœ²
trueï¼šå¯ä»¥é€šè¿‡AopContextè·å–å½“å‰ä»£ç†

ä»€ä¹ˆæ—¶å€™éœ€è¦ï¼Ÿ
å½“ä¸€ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œä¸”éœ€è¦AOPç”Ÿæ•ˆæ—¶
```

---

## 3. ğŸ“¦ åˆ‡é¢ç±»å®šä¹‰


### 3.1 @Aspectæ³¨è§£


**æ ¸å¿ƒå®šä¹‰**ï¼š
`@Aspect`å°±æ˜¯å‘Šè¯‰Springï¼š"è¿™ä¸ªç±»æ˜¯åˆ‡é¢ç±»ï¼Œé‡Œé¢æœ‰è¦ç»‡å…¥çš„é¢å¤–åŠŸèƒ½ï¼"

**åŸºæœ¬å†™æ³•**ï¼š

```java
@Aspect           // ğŸ‘ˆ æ ‡è®°ä¸ºåˆ‡é¢ç±»
@Component        // ğŸ‘ˆ äº¤ç»™Springç®¡ç†ï¼ˆé‡è¦ï¼ï¼‰
public class LogAspect {
    // åˆ‡é¢é€»è¾‘...
}
```

> âš ï¸ **æ–°æ‰‹æ˜“é”™ç‚¹**ï¼š
> 
> `@Aspect`åªæ˜¯æ ‡è®°ï¼Œè¿˜éœ€è¦`@Component`è®©Springç®¡ç†è¿™ä¸ªç±»ï¼
> 
> å°±åƒä½ æœ‰ä¸ª"å¨å¸ˆè¯"ï¼ˆ@Aspectï¼‰ï¼Œä½†è¿˜å¾—"å…¥èŒ"ï¼ˆ@Componentï¼‰é¤å…æ‰èƒ½å·¥ä½œ

### 3.2 åˆ‡é¢ç±»çš„ç»„æˆç»“æ„


**å®Œæ•´ç»“æ„ç¤ºæ„**ï¼š
```
@Aspectåˆ‡é¢ç±»
    |
    |-- @Pointcut åˆ‡å…¥ç‚¹ï¼ˆå®šä¹‰åœ¨å“ªé‡Œåˆ‡ï¼‰
    |
    |-- @Before å‰ç½®é€šçŸ¥ï¼ˆåˆ‡å…¥å‰åšä»€ä¹ˆï¼‰
    |
    |-- @After åç½®é€šçŸ¥ï¼ˆåˆ‡å…¥ååšä»€ä¹ˆï¼‰
    |
    |-- @Around ç¯ç»•é€šçŸ¥ï¼ˆå®Œå…¨æ§åˆ¶ï¼‰
```

---

## 4. ğŸ¯ åˆ‡å…¥ç‚¹è¡¨è¾¾å¼


### 4.1 @Pointcutæ³¨è§£


**ä½œç”¨è¯´æ˜**ï¼š
å®šä¹‰"åœ¨å“ªäº›æ–¹æ³•ä¸Š"åº”ç”¨AOPï¼Œå°±åƒç”»ä¸€ä¸ªåœˆï¼š"è¿™ä¸ªåœˆå†…çš„æ–¹æ³•éƒ½è¦è¢«å¢å¼ºï¼"

**åŸºç¡€è¯­æ³•**ï¼š

```java
@Pointcut("execution(* com.example.service.*.*(..))")
public void serviceLayer() {}  // æ–¹æ³•ä½“ä¸ºç©ºï¼Œåªæ˜¯ä¸ªæ ‡è®°
```

### 4.2 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯¦è§£


**executionè¡¨è¾¾å¼ç»“æ„**ï¼š
```
execution(ä¿®é¥°ç¬¦? è¿”å›ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°) å¼‚å¸¸?)

ç¬¦å·å«ä¹‰ï¼š
* ï¼šé€šé…ç¬¦ï¼ŒåŒ¹é…ä»»æ„
.. ï¼šå¤šå±‚åŒ…æˆ–å¤šä¸ªå‚æ•°
? ï¼šå¯é€‰éƒ¨åˆ†
```

**å¸¸ç”¨è¡¨è¾¾å¼ç¤ºä¾‹**ï¼š

ğŸ”¹ **åŒ¹é…æ‰€æœ‰publicæ–¹æ³•**
```java
@Pointcut("execution(public * *(..))")
```

ğŸ”¹ **åŒ¹é…serviceåŒ…ä¸‹æ‰€æœ‰æ–¹æ³•**
```java
@Pointcut("execution(* com.example.service.*.*(..))")
//                     â†‘        â†‘           â†‘  â†‘  â†‘
//                   è¿”å›ç±»å‹   åŒ…å        ç±» æ–¹æ³• å‚æ•°
```

ğŸ”¹ **åŒ¹é…ä»¥saveå¼€å¤´çš„æ–¹æ³•**
```java
@Pointcut("execution(* save*(..))")
```

ğŸ”¹ **ç»„åˆå¤šä¸ªåˆ‡å…¥ç‚¹**
```java
@Pointcut("execution(* com.example.service.*.*(..))")
private void serviceMethods() {}

@Pointcut("execution(* com.example.dao.*.*(..))")
private void daoMethods() {}

// ç»„åˆï¼šserviceæˆ–daoå±‚
@Pointcut("serviceMethods() || daoMethods()")
private void allDataMethods() {}
```

### 4.3 å…¶ä»–åˆ‡å…¥ç‚¹ç±»å‹


| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `@annotation` | åŒ¹é…å¸¦ç‰¹å®šæ³¨è§£çš„æ–¹æ³• | `@Pointcut("@annotation(Log)")` |
| `within` | åŒ¹é…ç‰¹å®šç±»å‹å†…çš„æ–¹æ³• | `@Pointcut("within(com.example..*)")` |
| `args` | åŒ¹é…å‚æ•°ç±»å‹ | `@Pointcut("args(String,..)")` |
| `bean` | åŒ¹é…ç‰¹å®šBeançš„æ–¹æ³• | `@Pointcut("bean(userService)")` |

---

## 5. ğŸ“¢ é€šçŸ¥ç±»å‹è¯¦è§£


### 5.1 @Before å‰ç½®é€šçŸ¥


**é€šä¿—ç†è§£**ï¼šåœ¨æ–¹æ³•æ‰§è¡Œ**ä¹‹å‰**åšç‚¹äº‹æƒ…ï¼Œå°±åƒè¿›é—¨å‰è¦å…ˆæ•²é—¨ã€‚

**åŸºæœ¬ç”¨æ³•**ï¼š

```java
@Before("execution(* com.example.service.*.*(..))")
public void beforeAdvice(JoinPoint joinPoint) {
    String methodName = joinPoint.getSignature().getName();
    System.out.println("æ–¹æ³•æ‰§è¡Œå‰ï¼š" + methodName);
}
```

**å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
```
âœ… å‚æ•°æ ¡éªŒ
âœ… æƒé™æ£€æŸ¥
âœ… è®°å½•å¼€å§‹æ—¥å¿—
âœ… å¼€å¯äº‹åŠ¡
```

### 5.2 @After åç½®é€šçŸ¥


**é€šä¿—ç†è§£**ï¼šæ–¹æ³•æ‰§è¡Œ**ä¹‹å**åšç‚¹äº‹æƒ…ï¼Œæ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œã€‚

**åŸºæœ¬ç”¨æ³•**ï¼š

```java
@After("execution(* com.example.service.*.*(..))")
public void afterAdvice() {
    System.out.println("æ–¹æ³•æ‰§è¡Œåï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰");
}
```

**åº”ç”¨åœºæ™¯**ï¼š
```
âœ… èµ„æºæ¸…ç†
âœ… é‡Šæ”¾é”
âœ… è®°å½•ç»“æŸæ—¥å¿—
```

### 5.3 @AfterReturning è¿”å›åé€šçŸ¥


**é€šä¿—ç†è§£**ï¼šæ–¹æ³•**æˆåŠŸæ‰§è¡Œå¹¶è¿”å›**ååšçš„äº‹æƒ…ï¼Œå¯ä»¥æ‹¿åˆ°è¿”å›å€¼ã€‚

**è·å–è¿”å›å€¼**ï¼š

```java
@AfterReturning(
    pointcut = "execution(* com.example.service.*.*(..))",
    returning = "result"  // ğŸ‘ˆ ç»‘å®šè¿”å›å€¼
)
public void afterReturning(JoinPoint joinPoint, Object result) {
    System.out.println("æ–¹æ³•è¿”å›å€¼ï¼š" + result);
}
```

**åº”ç”¨åœºæ™¯**ï¼š
```
âœ… ç»“æœç¼“å­˜
âœ… è¿”å›å€¼åŠ å·¥
âœ… æˆåŠŸæ—¥å¿—è®°å½•
```

### 5.4 @AfterThrowing å¼‚å¸¸é€šçŸ¥


**é€šä¿—ç†è§£**ï¼šæ–¹æ³•**æŠ›å‡ºå¼‚å¸¸**æ—¶æ‰§è¡Œï¼Œå¯ä»¥æ•è·å¼‚å¸¸ä¿¡æ¯ã€‚

**æ•è·å¼‚å¸¸**ï¼š

```java
@AfterThrowing(
    pointcut = "execution(* com.example.service.*.*(..))",
    throwing = "ex"  // ğŸ‘ˆ ç»‘å®šå¼‚å¸¸
)
public void afterThrowing(JoinPoint joinPoint, Exception ex) {
    System.out.println("æ–¹æ³•å¼‚å¸¸ï¼š" + ex.getMessage());
}
```

**åº”ç”¨åœºæ™¯**ï¼š
```
âœ… å¼‚å¸¸æ—¥å¿—è®°å½•
âœ… å¼‚å¸¸é‚®ä»¶é€šçŸ¥
âœ… å¼‚å¸¸è½¬æ¢
```

### 5.5 @Around ç¯ç»•é€šçŸ¥


**é€šä¿—ç†è§£**ï¼š**å®Œå…¨æ§åˆ¶**æ–¹æ³•æ‰§è¡Œï¼Œå¯ä»¥å†³å®šæ˜¯å¦æ‰§è¡Œã€ä¿®æ”¹å‚æ•°ã€ä¿®æ”¹è¿”å›å€¼ã€‚

ğŸ”¥ **é‡è¦ç¨‹åº¦**ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼ˆæœ€å¼ºå¤§ã€æœ€çµæ´»ï¼‰

**åŸºæœ¬ç”¨æ³•**ï¼š

```java
@Around("execution(* com.example.service.*.*(..))")
public Object aroundAdvice(ProceedingJoinPoint pjp) throws Throwable {
    // å‰ç½®é€»è¾‘
    System.out.println("ç¯ç»•å‰");
    
    // æ‰§è¡Œç›®æ ‡æ–¹æ³•
    Object result = pjp.proceed();
    
    // åç½®é€»è¾‘
    System.out.println("ç¯ç»•å");
    
    return result;  // è¿”å›ç»“æœ
}
```

**æ‰§è¡Œæµç¨‹å›¾ç¤º**ï¼š
```
ç¯ç»•é€šçŸ¥æµç¨‹ï¼š
   |
   |-- 1.å‰ç½®é€»è¾‘
   |
   |-- 2.pjp.proceed() æ‰§è¡Œç›®æ ‡æ–¹æ³•
   |        |
   |        |-- ç›®æ ‡æ–¹æ³•æ‰§è¡Œ
   |        |
   |   <----| è¿”å›ç»“æœ
   |
   |-- 3.åç½®é€»è¾‘
   |
   |-- 4.è¿”å›æœ€ç»ˆç»“æœ
```

**é«˜çº§ç”¨æ³•ç¤ºä¾‹**ï¼š

```java
@Around("execution(* com.example.service.*.*(..))")
public Object performanceMonitor(ProceedingJoinPoint pjp) throws Throwable {
    // è®°å½•å¼€å§‹æ—¶é—´
    long start = System.currentTimeMillis();
    
    Object result = null;
    try {
        // æ‰§è¡Œç›®æ ‡æ–¹æ³•
        result = pjp.proceed();
    } catch (Exception e) {
        // å¼‚å¸¸å¤„ç†
        System.out.println("æ–¹æ³•æ‰§è¡Œå¼‚å¸¸ï¼š" + e.getMessage());
        throw e;
    } finally {
        // è®¡ç®—è€—æ—¶
        long end = System.currentTimeMillis();
        System.out.println("æ–¹æ³•è€—æ—¶ï¼š" + (end - start) + "ms");
    }
    
    return result;
}
```

### 5.6 é€šçŸ¥æ‰§è¡Œé¡ºåº


**æ­£å¸¸æ‰§è¡Œé¡ºåº**ï¼š
```
@Aroundç¯ç»•å‰
    â†“
@Beforeå‰ç½®
    â†“
ç›®æ ‡æ–¹æ³•æ‰§è¡Œ
    â†“
@AfterReturningè¿”å›å
    â†“
@Afteråç½®
    â†“
@Aroundç¯ç»•å
```

**å¼‚å¸¸æ‰§è¡Œé¡ºåº**ï¼š
```
@Aroundç¯ç»•å‰
    â†“
@Beforeå‰ç½®
    â†“
ç›®æ ‡æ–¹æ³•æ‰§è¡Œï¼ˆå¼‚å¸¸ï¼‰
    â†“
@AfterThrowingå¼‚å¸¸
    â†“
@Afteråç½®
    â†“
@Aroundç¯ç»•å¼‚å¸¸å¤„ç†
```

---

## 6. ğŸ’¼ å®Œæ•´å®æˆ˜æ¡ˆä¾‹


### 6.1 éœ€æ±‚åœºæ™¯


å‡è®¾æˆ‘ä»¬è¦å®ç°ï¼š
- âœ… è®°å½•æ‰€æœ‰serviceæ–¹æ³•çš„æ‰§è¡Œæ—¥å¿—
- âœ… ç»Ÿè®¡æ–¹æ³•æ‰§è¡Œæ—¶é—´
- âœ… å¼‚å¸¸æ—¶å‘é€é€šçŸ¥

### 6.2 ç¬¬ä¸€æ­¥ï¼šå¼€å¯AOPæ”¯æŒ


```java
@Configuration
@ComponentScan("com.example")
@EnableAspectJAutoProxy  // å¼€å¯AOP
public class AppConfig {
}
```

### 6.3 ç¬¬äºŒæ­¥ï¼šåˆ›å»ºåˆ‡é¢ç±»


```java
@Aspect
@Component
public class LogAspect {
    
    // å®šä¹‰åˆ‡å…¥ç‚¹ï¼šæ‰€æœ‰serviceå±‚æ–¹æ³•
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void serviceLayer() {}
    
    // å‰ç½®ï¼šè®°å½•æ–¹æ³•è°ƒç”¨ä¿¡æ¯
    @Before("serviceLayer()")
    public void logBefore(JoinPoint joinPoint) {
        String className = joinPoint.getTarget().getClass().getName();
        String methodName = joinPoint.getSignature().getName();
        Object[] args = joinPoint.getArgs();
        
        System.out.println("ã€è°ƒç”¨ã€‘" + className + "." + methodName);
        System.out.println("ã€å‚æ•°ã€‘" + Arrays.toString(args));
    }
    
    // è¿”å›åï¼šè®°å½•è¿”å›å€¼
    @AfterReturning(pointcut = "serviceLayer()", returning = "result")
    public void logReturn(JoinPoint joinPoint, Object result) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("ã€è¿”å›ã€‘" + methodName + " -> " + result);
    }
    
    // å¼‚å¸¸ï¼šè®°å½•å¼‚å¸¸ä¿¡æ¯
    @AfterThrowing(pointcut = "serviceLayer()", throwing = "ex")
    public void logException(JoinPoint joinPoint, Exception ex) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("ã€å¼‚å¸¸ã€‘" + methodName + " å¼‚å¸¸ï¼š" + ex.getMessage());
        // å‘é€å¼‚å¸¸é€šçŸ¥...
    }
    
    // ç¯ç»•ï¼šç»Ÿè®¡æ‰§è¡Œæ—¶é—´
    @Around("serviceLayer()")
    public Object monitorPerformance(ProceedingJoinPoint pjp) throws Throwable {
        long start = System.currentTimeMillis();
        
        Object result = pjp.proceed();
        
        long time = System.currentTimeMillis() - start;
        System.out.println("ã€è€—æ—¶ã€‘" + pjp.getSignature().getName() + 
                          " è€—æ—¶ï¼š" + time + "ms");
        
        return result;
    }
}
```

### 6.4 ç¬¬ä¸‰æ­¥ï¼šä¸šåŠ¡ç±»


```java
@Service
public class UserService {
    
    public User findUserById(Long id) {
        // æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘
        System.out.println("æ‰§è¡ŒæŸ¥è¯¢ç”¨æˆ·é€»è¾‘...");
        return new User(id, "å¼ ä¸‰");
    }
    
    public void deleteUser(Long id) {
        if (id < 0) {
            throw new IllegalArgumentException("IDä¸èƒ½ä¸ºè´Ÿæ•°");
        }
        System.out.println("åˆ é™¤ç”¨æˆ·ï¼š" + id);
    }
}
```

### 6.5 æ‰§è¡Œæ•ˆæœ


**æ­£å¸¸è°ƒç”¨**ï¼š
```
ã€è°ƒç”¨ã€‘com.example.service.UserService.findUserById
ã€å‚æ•°ã€‘[1]
æ‰§è¡ŒæŸ¥è¯¢ç”¨æˆ·é€»è¾‘...
ã€è¿”å›ã€‘findUserById -> User(id=1, name=å¼ ä¸‰)
ã€è€—æ—¶ã€‘findUserById è€—æ—¶ï¼š15ms
```

**å¼‚å¸¸è°ƒç”¨**ï¼š
```
ã€è°ƒç”¨ã€‘com.example.service.UserService.deleteUser
ã€å‚æ•°ã€‘[-1]
ã€å¼‚å¸¸ã€‘deleteUser å¼‚å¸¸ï¼šIDä¸èƒ½ä¸ºè´Ÿæ•°
ã€è€—æ—¶ã€‘deleteUser è€—æ—¶ï¼š3ms
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å…­å¤§æ ¸å¿ƒæ³¨è§£


| æ³¨è§£ | ä½œç”¨ | ä½¿ç”¨ä½ç½® | é‡è¦ç¨‹åº¦ |
|------|------|----------|---------|
| `@EnableAspectJAutoProxy` | å¼€å¯AOPæ”¯æŒ | é…ç½®ç±» | ğŸ”¥ğŸ”¥ğŸ”¥ |
| `@Aspect` | æ ‡è®°åˆ‡é¢ç±» | ç±» | ğŸ”¥ğŸ”¥ğŸ”¥ |
| `@Pointcut` | å®šä¹‰åˆ‡å…¥ç‚¹ | æ–¹æ³• | ğŸ”¥ğŸ”¥ğŸ”¥ |
| `@Before` | å‰ç½®é€šçŸ¥ | æ–¹æ³• | ğŸ”¥ğŸ”¥ |
| `@After` | åç½®é€šçŸ¥ | æ–¹æ³• | ğŸ”¥ğŸ”¥ |
| `@Around` | ç¯ç»•é€šçŸ¥ | æ–¹æ³• | ğŸ”¥ğŸ”¥ğŸ”¥ |

### 7.2 é…ç½®ä¸‰æ­¥æ›²


```
æ­¥éª¤1ï¼š@EnableAspectJAutoProxy å¼€å¯AOP
       â†“
æ­¥éª¤2ï¼š@Aspect + @Component åˆ›å»ºåˆ‡é¢ç±»
       â†“
æ­¥éª¤3ï¼š@Pointcut + @Before/@Around å®šä¹‰é€»è¾‘
```

### 7.3 æ–°æ‰‹æ˜“é”™ç‚¹


> â— **æ˜“é”™1**ï¼šåªå†™`@Aspect`å¿˜è®°`@Component`
> 
> è§£å†³ï¼šåˆ‡é¢ç±»å¿…é¡»è¢«Springç®¡ç†æ‰ç”Ÿæ•ˆ

> â— **æ˜“é”™2**ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼å†™é”™
> 
> è§£å†³ï¼šå…ˆä»ç®€å•çš„`*.*(..))`å¼€å§‹ï¼Œé€æ­¥ç»†åŒ–

> â— **æ˜“é”™3**ï¼šç¯ç»•é€šçŸ¥å¿˜è®°`return result`
> 
> è§£å†³ï¼šå¿…é¡»è¿”å›`pjp.proceed()`çš„ç»“æœ

> â— **æ˜“é”™4**ï¼šå¤šä¸ªåˆ‡é¢æ‰§è¡Œé¡ºåºæ··ä¹±
> 
> è§£å†³ï¼šä½¿ç”¨`@Order(n)`æ§åˆ¶é¡ºåºï¼Œæ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œ

### 7.4 æœ€ä½³å®è·µå»ºè®®


ğŸ¯ **æ¨èåšæ³•**ï¼š
- âœ… åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å•ç‹¬å®šä¹‰ï¼ˆä¾¿äºå¤ç”¨ï¼‰
- âœ… ä½¿ç”¨`@Around`å¤„ç†å¤æ‚é€»è¾‘
- âœ… é€šçŸ¥æ–¹æ³•å‘½åè¦æ¸…æ™°ï¼ˆå¦‚`logBefore`ã€`checkPermission`ï¼‰
- âœ… å¼‚å¸¸è¦åœ¨ç¯ç»•é€šçŸ¥ä¸­å¦¥å–„å¤„ç†

ğŸš« **é¿å…åšæ³•**ï¼š
- âŒ åœ¨ä¸€ä¸ªåˆ‡é¢ç±»ä¸­å†™å¤ªå¤šæ— å…³é€»è¾‘
- âŒ åˆ‡å…¥ç‚¹èŒƒå›´è¿‡å¤§ï¼ˆå½±å“æ€§èƒ½ï¼‰
- âŒ è¿‡åº¦ä½¿ç”¨AOPï¼ˆç®€å•åŠŸèƒ½ç›´æ¥å†™ï¼‰

### 7.5 å­¦ä¹ æ£€æŸ¥æ¸…å•


- [ ] ç†è§£AOPæ³¨è§£å’ŒXMLçš„åŒºåˆ«
- [ ] èƒ½å†™å‡º`@EnableAspectJAutoProxy`é…ç½®
- [ ] æŒæ¡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„åŸºæœ¬è¯­æ³•
- [ ] ç†è§£äº”ç§é€šçŸ¥çš„æ‰§è¡Œæ—¶æœº
- [ ] èƒ½ç‹¬ç«‹å®Œæˆä¸€ä¸ªæ—¥å¿—åˆ‡é¢
- [ ] äº†è§£é€šçŸ¥çš„æ‰§è¡Œé¡ºåº

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¼€å¯ä»£ç†Enableï¼Œåˆ‡é¢AspectåŠ Component
åˆ‡å…¥ç‚¹Pointcutç”»åœˆåœˆï¼Œé€šçŸ¥ç±»å‹è®°äº”ç§
Beforeæå‰åšå‡†å¤‡ï¼ŒAroundç¯ç»•æœ€å…¨èƒ½
è¿”å›å¼‚å¸¸å„å¸èŒï¼Œåç½®Afteræ”¶å°¾å·¥
```