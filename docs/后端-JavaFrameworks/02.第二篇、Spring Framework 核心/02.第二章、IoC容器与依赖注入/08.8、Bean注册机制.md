---
title: 8ã€Beanæ³¨å†Œæœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [Beanæ³¨å†Œæœºåˆ¶æ¦‚è¿°](#1-Beanæ³¨å†Œæœºåˆ¶æ¦‚è¿°)
2. [XMLé…ç½®æ³¨å†Œ](#2-XMLé…ç½®æ³¨å†Œ)
3. [æ³¨è§£æ‰«ææ³¨å†Œ](#3-æ³¨è§£æ‰«ææ³¨å†Œ)
4. [JavaConfigæ³¨å†Œ](#4-JavaConfigæ³¨å†Œ)
5. [ç¼–ç¨‹å¼æ³¨å†Œ](#5-ç¼–ç¨‹å¼æ³¨å†Œ)
6. [æ³¨å†Œé¡ºåºä¸è¦†ç›–ç­–ç•¥](#6-æ³¨å†Œé¡ºåºä¸è¦†ç›–ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Beanæ³¨å†Œæœºåˆ¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Beanæ³¨å†Œ


**é€šä¿—ç†è§£**ï¼š
- æƒ³è±¡Springå®¹å™¨æ˜¯ä¸€ä¸ª**ä»“åº“ç®¡ç†ç³»ç»Ÿ**
- Beanå°±æ˜¯**è´§ç‰©**ï¼Œæ³¨å†Œå°±æ˜¯æŠŠè´§ç‰©**ç™»è®°å…¥åº“**çš„è¿‡ç¨‹
- æ³¨å†Œæ—¶è¦å‘Šè¯‰ä»“åº“ï¼šè¿™æ˜¯ä»€ä¹ˆè´§ç‰©ã€æ€ä¹ˆç”Ÿäº§ã€æ”¾åœ¨å“ªä¸ªä½ç½®

**ä¸“ä¸šå®šä¹‰**ï¼š
```
Beanæ³¨å†Œ = æŠŠå¯¹è±¡çš„åˆ›å»ºä¿¡æ¯å‘Šè¯‰Springå®¹å™¨çš„è¿‡ç¨‹
ç›®çš„ï¼šè®©SpringçŸ¥é“éœ€è¦ç®¡ç†å“ªäº›å¯¹è±¡ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºå®ƒä»¬
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æ³¨å†ŒBean


**å®é™…åœºæ™¯å¯¹æ¯”**ï¼š

ä¼ ç»Ÿæ–¹å¼ï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼‰ï¼š
```
ä½ éœ€è¦ä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡
â†’ è‡ªå·±newä¸€ä¸ª
â†’ éœ€è¦é…ç½®å‚æ•°
â†’ ç”¨å®Œè¦è‡ªå·±å…³é—­
â†’ æ¯æ¬¡éƒ½é‡å¤è¿™ä¸ªè¿‡ç¨‹
```

Springæ–¹å¼ï¼ˆæ³¨å†ŒBeanï¼‰ï¼š
```
æŠŠæ•°æ®åº“è¿æ¥æ³¨å†Œåˆ°Spring
â†’ Springå¸®ä½ åˆ›å»º
â†’ Springå¸®ä½ ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
â†’ éœ€è¦æ—¶ç›´æ¥ç”¨ï¼Œä¸ç”¨è‡ªå·±ç®¡ç†
```

**æ ¸å¿ƒå¥½å¤„**ï¼š
- âœ… **è§£è€¦**ï¼šå¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»
- âœ… **å¤ç”¨**ï¼šåŒä¸€ä¸ªBeanå¯ä»¥è¢«å¤šå¤„ä½¿ç”¨
- âœ… **ç®¡ç†**ï¼šSpringç»Ÿä¸€ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
- âœ… **é…ç½®**ï¼šé›†ä¸­é…ç½®ï¼Œä¾¿äºç»´æŠ¤

### 1.3 æ³¨å†Œæ–¹å¼å…¨æ™¯å›¾


```
Beanæ³¨å†Œçš„4ç§ä¸»æµæ–¹å¼ï¼š

ğŸ”¹ XMLé…ç½®æ³¨å†Œ
   â””â”€ ä¼ ç»Ÿæ–¹å¼ï¼Œé…ç½®æ–‡ä»¶ä¸­å£°æ˜
   â””â”€ é€‚åˆï¼šè€é¡¹ç›®ã€é…ç½®é›†ä¸­ç®¡ç†

ğŸ”¹ æ³¨è§£æ‰«ææ³¨å†Œ  
   â””â”€ åœ¨ç±»ä¸ŠåŠ æ³¨è§£è‡ªåŠ¨æ³¨å†Œ
   â””â”€ é€‚åˆï¼šå¿«é€Ÿå¼€å‘ã€SpringBooté¡¹ç›®

ğŸ”¹ JavaConfigæ³¨å†Œ
   â””â”€ ç”¨Javaä»£ç é…ç½®Bean
   â””â”€ é€‚åˆï¼šå¤æ‚Beanã€ç±»å‹å®‰å…¨è¦æ±‚é«˜

ğŸ”¹ ç¼–ç¨‹å¼æ³¨å†Œ
   â””â”€ è¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œ
   â””â”€ é€‚åˆï¼šæ¡ä»¶æ³¨å†Œã€åŠ¨æ€æ‰©å±•
```

---

## 2. ğŸ“ XMLé…ç½®æ³¨å†Œ


### 2.1 åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯XMLé…ç½®æ³¨å†Œ**ï¼š
åœ¨XMLæ–‡ä»¶ä¸­ç”¨`<bean>`æ ‡ç­¾å£°æ˜å¯¹è±¡ï¼ŒSpringå¯åŠ¨æ—¶è¯»å–é…ç½®æ–‡ä»¶å¹¶æ³¨å†ŒBean

**å°±åƒ**ï¼šåœ¨ä¸€ä¸ªèœå•ä¸Šå†™æ˜"é±¼é¦™è‚‰ä¸æ€ä¹ˆåš"ï¼Œå¨å¸ˆï¼ˆSpringï¼‰ç…§ç€èœå•æ¥åšèœ

### 2.2 åŸºç¡€æ³¨å†Œæ–¹å¼


**æœ€ç®€å•çš„æ³¨å†Œ**ï¼š

```xml
<!-- applicationContext.xml -->
<beans>
    <!-- æ³¨å†Œä¸€ä¸ªç”¨æˆ·æœåŠ¡Bean -->
    <bean id="userService" class="com.example.service.UserService"/>
    
    <!-- æ³¨å†Œä¸€ä¸ªæ•°æ®æºBean -->
    <bean id="dataSource" class="com.example.db.DataSource"/>
</beans>
```

**å…³é”®è¦ç´ è¯´æ˜**ï¼š
- `id`ï¼šBeançš„åå­—ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
- `class`ï¼šBeançš„å®Œæ•´ç±»åï¼ˆå‘Šè¯‰Springæ˜¯ä»€ä¹ˆç±»å‹ï¼‰

### 2.3 å¸¦å‚æ•°çš„æ³¨å†Œ


**æ„é€ å™¨æ³¨å…¥**ï¼ˆåˆ›å»ºæ—¶ä¼ å‚ï¼‰ï¼š

```xml
<!-- ç”¨æˆ·æœåŠ¡ä¾èµ–æ•°æ®åº“è¿æ¥ -->
<bean id="userService" class="com.example.service.UserService">
    <!-- æ„é€ å™¨å‚æ•°ï¼šä¼ å…¥æ•°æ®åº“è¿æ¥ -->
    <constructor-arg ref="dataSource"/>
</bean>

<bean id="dataSource" class="com.example.db.DataSource">
    <!-- æ„é€ å™¨å‚æ•°ï¼šä¼ å…¥å­—ç¬¦ä¸² -->
    <constructor-arg value="jdbc:mysql://localhost:3306/db"/>
</bean>
```

**å¯¹åº”çš„Javaç±»**ï¼š
```java
public class UserService {
    private DataSource dataSource;
    
    // æ„é€ å™¨æ³¨å…¥
    public UserService(DataSource dataSource) {
        this.dataSource = dataSource;
    }
}
```

**å±æ€§æ³¨å…¥**ï¼ˆé€šè¿‡setteræ–¹æ³•ï¼‰ï¼š

```xml
<bean id="userService" class="com.example.service.UserService">
    <!-- é€šè¿‡setDataSourceæ–¹æ³•æ³¨å…¥ -->
    <property name="dataSource" ref="dataSource"/>
    <!-- æ³¨å…¥åŸºæœ¬ç±»å‹ -->
    <property name="timeout" value="3000"/>
</bean>
```

### 2.4 å®ç”¨é…ç½®æŠ€å·§


| é…ç½®é¡¹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| **scope** | Beançš„ä½œç”¨åŸŸ | `scope="singleton"` å•ä¾‹<br>`scope="prototype"` å¤šä¾‹ |
| **lazy-init** | å»¶è¿Ÿåˆå§‹åŒ– | `lazy-init="true"` ç”¨æ—¶æ‰åˆ›å»º |
| **init-method** | åˆå§‹åŒ–æ–¹æ³• | `init-method="init"` åˆ›å»ºåè°ƒç”¨ |
| **destroy-method** | é”€æ¯æ–¹æ³• | `destroy-method="close"` é”€æ¯å‰è°ƒç”¨ |

**ç»¼åˆç¤ºä¾‹**ï¼š

```xml
<bean id="userService" 
      class="com.example.service.UserService"
      scope="singleton"
      lazy-init="false"
      init-method="init"
      destroy-method="close">
    <property name="dataSource" ref="dataSource"/>
</bean>
```

### 2.5 ä¼˜ç¼ºç‚¹åˆ†æ


**âœ… ä¼˜ç‚¹**ï¼š
- é…ç½®é›†ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†
- ä¸ç”¨ä¿®æ”¹Javaä»£ç 
- é€‚åˆå¤§å‹é¡¹ç›®çš„é…ç½®ç®¡ç†

**âŒ ç¼ºç‚¹**ï¼š
- é…ç½®ç¹çï¼Œå†™XMLéº»çƒ¦
- æ²¡æœ‰ç±»å‹æ£€æŸ¥ï¼Œå®¹æ˜“å‡ºé”™
- ä¿®æ”¹é…ç½®éœ€è¦é‡å¯åº”ç”¨

---

## 3. ğŸ·ï¸ æ³¨è§£æ‰«ææ³¨å†Œ


### 3.1 åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ³¨è§£æ‰«ææ³¨å†Œ**ï¼š
åœ¨ç±»ä¸ŠåŠ ç‰¹å®šæ³¨è§£ï¼ˆå¦‚`@Component`ï¼‰ï¼ŒSpringè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œä¸ºBean

**å°±åƒ**ï¼šç»™å•†å“è´´ä¸Šæ¡å½¢ç ï¼Œæ‰«ææªï¼ˆSpringï¼‰æ‰«åˆ°å°±è‡ªåŠ¨å½•å…¥ç³»ç»Ÿ

### 3.2 æ ¸å¿ƒæ³¨è§£è¯´æ˜


**å››å¤§æ ¸å¿ƒæ³¨è§£**ï¼š

```java
// @Component - é€šç”¨ç»„ä»¶æ³¨è§£
@Component
public class UserCache {
    // è¿™ä¸ªç±»ä¼šè¢«è‡ªåŠ¨æ³¨å†Œä¸ºBean
}

// @Service - ä¸šåŠ¡å±‚æ³¨è§£ï¼ˆæœ¬è´¨å’Œ@Componentä¸€æ ·ï¼‰
@Service
public class UserService {
    // è¯­ä¹‰åŒ–ï¼šè¡¨æ˜è¿™æ˜¯ä¸šåŠ¡æœåŠ¡ç±»
}

// @Repository - æ•°æ®å±‚æ³¨è§£
@Repository
public class UserDao {
    // è¯­ä¹‰åŒ–ï¼šè¡¨æ˜è¿™æ˜¯æ•°æ®è®¿é—®ç±»
}

// @Controller - æ§åˆ¶å±‚æ³¨è§£
@Controller
public class UserController {
    // è¯­ä¹‰åŒ–ï¼šè¡¨æ˜è¿™æ˜¯æ§åˆ¶å™¨ç±»
}
```

> ğŸ’¡ **ä¸ºä»€ä¹ˆæœ‰4ä¸ªæ³¨è§£ï¼Ÿ**
> 
> å…¶å®åŠŸèƒ½éƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯æ³¨å†ŒBeanã€‚åŒºåˆ†å®ƒä»¬æ˜¯ä¸ºäº†**è¯­ä¹‰æ¸…æ™°**ï¼š
> - `@Service` ä¸€çœ‹å°±çŸ¥é“æ˜¯ä¸šåŠ¡ç±»
> - `@Repository` ä¸€çœ‹å°±çŸ¥é“æ˜¯æ•°æ®åº“æ“ä½œç±»
> - `@Controller` ä¸€çœ‹å°±çŸ¥é“æ˜¯è¯·æ±‚å¤„ç†ç±»

### 3.3 å¯ç”¨æ‰«æé…ç½®


**æ–¹å¼1ï¼šXMLé…ç½®æ‰«æ**

```xml
<!-- applicationContext.xml -->
<beans>
    <!-- æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰å¸¦æ³¨è§£çš„ç±» -->
    <context:component-scan base-package="com.example"/>
</beans>
```

**æ–¹å¼2ï¼šJavaConfigé…ç½®æ‰«æ**

```java
@Configuration
@ComponentScan("com.example")  // æ‰«æcom.exampleåŒ…
public class AppConfig {
    // é…ç½®ç±»
}
```

**æ‰«æè¿‡ç¨‹å¯è§†åŒ–**ï¼š

```
é¡¹ç›®ç»“æ„ï¼š
com.example
  â”œâ”€â”€ service
  â”‚   â”œâ”€â”€ UserService.java (@Service)
  â”‚   â””â”€â”€ OrderService.java (@Service)
  â”œâ”€â”€ dao  
  â”‚   â””â”€â”€ UserDao.java (@Repository)
  â””â”€â”€ controller
      â””â”€â”€ UserController.java (@Controller)

Springæ‰«æè¿‡ç¨‹ï¼š
1. æ‰«æcom.exampleåŒ…åŠå­åŒ…
2. æ‰¾åˆ°4ä¸ªå¸¦æ³¨è§£çš„ç±»
3. è‡ªåŠ¨æ³¨å†Œä¸ºBeanï¼šuserService, orderService, userDao, userController
```

### 3.4 ä¾èµ–æ³¨å…¥


**@Autowired - è‡ªåŠ¨è£…é…**ï¼š

```java
@Service
public class UserService {
    
    // æ–¹å¼1ï¼šå­—æ®µæ³¨å…¥ï¼ˆæœ€ç®€å•ï¼‰
    @Autowired
    private UserDao userDao;
    
    // æ–¹å¼2ï¼šæ„é€ å™¨æ³¨å…¥ï¼ˆæ¨èï¼‰
    private final UserDao userDao;
    
    @Autowired
    public UserService(UserDao userDao) {
        this.userDao = userDao;
    }
    
    // æ–¹å¼3ï¼šsetteræ³¨å…¥
    private UserDao userDao;
    
    @Autowired
    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }
}
```

> âš¡ **æœ€ä½³å®è·µ**ï¼šæ¨èä½¿ç”¨**æ„é€ å™¨æ³¨å…¥**
> - ä¾èµ–æ˜ç¡®ï¼Œä¸å¯å˜
> - ä¾¿äºæµ‹è¯•
> - é¿å…å¾ªç¯ä¾èµ–

### 3.5 è‡ªå®šä¹‰Beanåç§°


```java
// é»˜è®¤Beanåç§°ï¼šuserServiceï¼ˆé¦–å­—æ¯å°å†™ï¼‰
@Service
public class UserService { }

// è‡ªå®šä¹‰Beanåç§°ï¼šmyUserService
@Service("myUserService")
public class UserService { }

// å¤šä¸ªåç§°ï¼ˆåˆ«åï¼‰
@Service
@Qualifier("primaryUserService")
public class UserService { }
```

### 3.6 ä¼˜ç¼ºç‚¹åˆ†æ


**âœ… ä¼˜ç‚¹**ï¼š
- å¼€å‘å¿«é€Ÿï¼ŒåŠ æ³¨è§£å³å¯
- ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æœŸæ£€æŸ¥
- ä»£ç æ¸…æ™°ï¼Œé…ç½®å’Œä»£ç åœ¨ä¸€èµ·

**âŒ ç¼ºç‚¹**ï¼š
- éœ€è¦ä¿®æ”¹æºä»£ç 
- ç¬¬ä¸‰æ–¹ç±»æ— æ³•åŠ æ³¨è§£
- åŒ…æ‰«æå½±å“å¯åŠ¨é€Ÿåº¦

---

## 4. â˜• JavaConfigæ³¨å†Œ


### 4.1 åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯JavaConfig**ï¼š
ç”¨çº¯Javaä»£ç é…ç½®Beanï¼Œä¸ç”¨XMLä¹Ÿä¸ç”¨æ³¨è§£æ‰«æï¼Œé€šè¿‡`@Bean`æ–¹æ³•æ‰‹åŠ¨æ³¨å†Œ

**å°±åƒ**ï¼šä¸ç”¨èœå•ï¼ˆXMLï¼‰ä¹Ÿä¸ç”¨è´´æ ‡ç­¾ï¼ˆæ³¨è§£ï¼‰ï¼Œè€Œæ˜¯å¨å¸ˆé•¿ï¼ˆä½ ï¼‰ç›´æ¥å‘Šè¯‰å¨å¸ˆæ€ä¹ˆåšèœ

### 4.2 åŸºç¡€ç”¨æ³•


**é…ç½®ç±»ç¤ºä¾‹**ï¼š

```java
@Configuration  // å£°æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»
public class AppConfig {
    
    // @Beanæ–¹æ³•ï¼Œè¿”å›å€¼ä¼šè¢«æ³¨å†Œä¸ºBean
    @Bean
    public UserService userService() {
        return new UserService();
    }
    
    // Beanåç§°é»˜è®¤æ˜¯æ–¹æ³•åï¼šuserDao
    @Bean
    public UserDao userDao() {
        return new UserDao();
    }
    
    // è‡ªå®šä¹‰Beanåç§°
    @Bean("myDataSource")
    public DataSource dataSource() {
        return new DataSource("jdbc:mysql://localhost:3306/db");
    }
}
```

**ç†è§£å…³é”®ç‚¹**ï¼š
- `@Configuration`ï¼šå‘Šè¯‰Springè¿™æ˜¯é…ç½®ç±»
- `@Bean`ï¼šå‘Šè¯‰SpringæŠŠæ–¹æ³•è¿”å›å€¼æ³¨å†Œä¸ºBean
- æ–¹æ³•å = Beanåç§°ï¼ˆé»˜è®¤ï¼‰

### 4.3 ä¾èµ–æ³¨å…¥æ–¹å¼


**æ–¹å¼1ï¼šæ–¹æ³•å‚æ•°æ³¨å…¥**ï¼ˆæ¨èï¼‰

```java
@Configuration
public class AppConfig {
    
    @Bean
    public UserDao userDao() {
        return new UserDao();
    }
    
    @Bean
    public UserService userService(UserDao userDao) {
        // Springè‡ªåŠ¨ä»å®¹å™¨ä¸­æ‰¾åˆ°userDaoå¹¶ä¼ å…¥
        return new UserService(userDao);
    }
}
```

**æ–¹å¼2ï¼šæ–¹æ³•è°ƒç”¨æ³¨å…¥**

```java
@Configuration
public class AppConfig {
    
    @Bean
    public UserDao userDao() {
        return new UserDao();
    }
    
    @Bean
    public UserService userService() {
        // ç›´æ¥è°ƒç”¨userDao()æ–¹æ³•
        return new UserService(userDao());
    }
}
```

> ğŸ’¡ **Springçš„æ™ºèƒ½å¤„ç†**ï¼š
> 
> å¤šæ¬¡è°ƒç”¨`userDao()`ä¸ä¼šåˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼
> Springä¼šæ‹¦æˆªè°ƒç”¨ï¼Œè¿”å›å®¹å™¨ä¸­çš„å•ä¾‹Bean

### 4.4 é«˜çº§é…ç½®


**æ¡ä»¶æ³¨å†Œ**ï¼š

```java
@Configuration
public class AppConfig {
    
    // åªåœ¨Windowsç³»ç»Ÿä¸‹æ³¨å†Œ
    @Bean
    @Conditional(WindowsCondition.class)
    public FileService windowsFileService() {
        return new WindowsFileService();
    }
    
    // åªåœ¨Linuxç³»ç»Ÿä¸‹æ³¨å†Œ
    @Bean
    @Conditional(LinuxCondition.class)
    public FileService linuxFileService() {
        return new LinuxFileService();
    }
}
```

**ä½œç”¨åŸŸé…ç½®**ï¼š

```java
@Configuration
public class AppConfig {
    
    // å•ä¾‹Beanï¼ˆé»˜è®¤ï¼‰
    @Bean
    @Scope("singleton")
    public UserService userService() {
        return new UserService();
    }
    
    // å¤šä¾‹Beanï¼ˆæ¯æ¬¡è·å–éƒ½åˆ›å»ºæ–°å¯¹è±¡ï¼‰
    @Bean
    @Scope("prototype")
    public UserCache userCache() {
        return new UserCache();
    }
}
```

**ç”Ÿå‘½å‘¨æœŸæ–¹æ³•**ï¼š

```java
@Configuration
public class AppConfig {
    
    @Bean(initMethod = "init", destroyMethod = "close")
    public DataSource dataSource() {
        return new DataSource();
    }
}

// DataSourceç±»
public class DataSource {
    public void init() {
        System.out.println("æ•°æ®æºåˆå§‹åŒ–");
    }
    
    public void close() {
        System.out.println("æ•°æ®æºå…³é—­");
    }
}
```

### 4.5 å¯¼å…¥å…¶ä»–é…ç½®


**ç»„åˆå¤šä¸ªé…ç½®ç±»**ï¼š

```java
@Configuration
@Import({DatabaseConfig.class, CacheConfig.class})
public class AppConfig {
    // ä¸»é…ç½®
}

@Configuration
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        return new DataSource();
    }
}

@Configuration
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        return new CacheManager();
    }
}
```

### 4.6 ä¼˜ç¼ºç‚¹åˆ†æ


**âœ… ä¼˜ç‚¹**ï¼š
- ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æœŸæ£€æŸ¥
- çµæ´»æ€§é«˜ï¼Œå¯ä»¥å†™å¤æ‚é€»è¾‘
- é€‚åˆé…ç½®ç¬¬ä¸‰æ–¹ç±»
- ä¾¿äºé‡æ„å’ŒIDEæ”¯æŒ

**âŒ ç¼ºç‚¹**ï¼š
- ä»£ç é‡æ¯”æ³¨è§£å¤š
- é…ç½®åˆ†æ•£åœ¨ä»£ç ä¸­
- éœ€è¦æ‰‹åŠ¨ç®¡ç†ä¾èµ–å…³ç³»

---

## 5. ğŸ”§ ç¼–ç¨‹å¼æ³¨å†Œ


### 5.1 åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç¼–ç¨‹å¼æ³¨å†Œ**ï¼š
åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ä»£ç åŠ¨æ€å‘Springå®¹å™¨æ³¨å†ŒBean

**å°±åƒ**ï¼šé¤å…è¥ä¸šä¸­ï¼Œä¸´æ—¶å¢åŠ æ–°èœå“åˆ°èœå•ä¸Š

**åº”ç”¨åœºæ™¯**ï¼š
- ğŸ¯ åŠ¨æ€æ’ä»¶ç³»ç»Ÿ
- ğŸ¯ æ ¹æ®é…ç½®æ–‡ä»¶åŠ¨æ€æ³¨å†Œ
- ğŸ¯ æ¡ä»¶æ€§æ³¨å†Œï¼ˆå¤æ‚æ¡ä»¶ï¼‰
- ğŸ¯ è¿è¡Œæ—¶æ‰©å±•

### 5.2 ä½¿ç”¨BeanDefinitionRegistry


**åŸºæœ¬ç¤ºä¾‹**ï¼š

```java
@Configuration
public class DynamicBeanConfig implements ImportBeanDefinitionRegistrar {
    
    @Override
    public void registerBeanDefinitions(
            AnnotationMetadata metadata, 
            BeanDefinitionRegistry registry) {
        
        // åˆ›å»ºBeanå®šä¹‰
        BeanDefinition definition = BeanDefinitionBuilder
            .genericBeanDefinition(UserService.class)
            .getBeanDefinition();
        
        // æ³¨å†ŒBean
        registry.registerBeanDefinition("userService", definition);
    }
}
```

**ç†è§£è¿‡ç¨‹**ï¼š

```
æ­¥éª¤1ï¼šåˆ›å»ºBeanå®šä¹‰ï¼ˆå‘Šè¯‰Springè¿™æ˜¯ä»€ä¹ˆBeanï¼‰
  â””â”€ BeanDefinition = Beançš„"èº«ä»½è¯"
  
æ­¥éª¤2ï¼šè®¾ç½®Beanå±æ€§
  â””â”€ ç±»å‹ã€ä½œç”¨åŸŸã€ä¾èµ–ç­‰
  
æ­¥éª¤3ï¼šæ³¨å†Œåˆ°å®¹å™¨
  â””â”€ registry.registerBeanDefinition()
```

### 5.3 ä½¿ç”¨ApplicationContext


**è·å–å®¹å™¨å¹¶æ³¨å†Œ**ï¼š

```java
@Component
public class BeanRegistrar implements ApplicationContextAware {
    
    private ApplicationContext applicationContext;
    
    @Override
    public void setApplicationContext(ApplicationContext ctx) {
        this.applicationContext = ctx;
    }
    
    public void registerBean() {
        // è·å–BeanFactory
        DefaultListableBeanFactory beanFactory = 
            (DefaultListableBeanFactory) applicationContext
                .getAutowireCapableBeanFactory();
        
        // åˆ›å»ºBeanå®šä¹‰
        BeanDefinition definition = new RootBeanDefinition(UserService.class);
        
        // æ³¨å†ŒBean
        beanFactory.registerBeanDefinition("dynamicUserService", definition);
    }
}
```

### 5.4 å¸¦ä¾èµ–çš„åŠ¨æ€æ³¨å†Œ


**ç¤ºä¾‹ï¼šæ³¨å†Œæ—¶è®¾ç½®ä¾èµ–**

```java
public void registerServiceWithDao() {
    DefaultListableBeanFactory beanFactory = getBeanFactory();
    
    // åˆ›å»ºBeanå®šä¹‰
    GenericBeanDefinition definition = new GenericBeanDefinition();
    definition.setBeanClass(UserService.class);
    
    // è®¾ç½®æ„é€ å™¨å‚æ•°ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
    ConstructorArgumentValues args = new ConstructorArgumentValues();
    args.addGenericArgumentValue(new RuntimeBeanReference("userDao"));
    definition.setConstructorArgumentValues(args);
    
    // æ³¨å†Œ
    beanFactory.registerBeanDefinition("userService", definition);
}
```

### 5.5 å®é™…åº”ç”¨åœºæ™¯


**åœºæ™¯1ï¼šæ’ä»¶ç³»ç»Ÿ**

```java
public class PluginLoader {
    
    public void loadPlugin(String pluginClassName) {
        // åŠ¨æ€åŠ è½½ç±»
        Class<?> pluginClass = Class.forName(pluginClassName);
        
        // åˆ›å»ºBeanå®šä¹‰
        BeanDefinition definition = BeanDefinitionBuilder
            .genericBeanDefinition(pluginClass)
            .setScope("singleton")
            .getBeanDefinition();
        
        // æ³¨å†Œåˆ°Springå®¹å™¨
        registry.registerBeanDefinition(
            pluginClass.getSimpleName(), 
            definition
        );
    }
}
```

**åœºæ™¯2ï¼šå¤šæ•°æ®æºåŠ¨æ€æ³¨å†Œ**

```java
public void registerDataSources(List<DataSourceConfig> configs) {
    for (DataSourceConfig config : configs) {
        // åˆ›å»ºæ•°æ®æºBeanå®šä¹‰
        BeanDefinition definition = BeanDefinitionBuilder
            .genericBeanDefinition(DataSource.class)
            .addPropertyValue("url", config.getUrl())
            .addPropertyValue("username", config.getUsername())
            .addPropertyValue("password", config.getPassword())
            .getBeanDefinition();
        
        // åŠ¨æ€æ³¨å†Œ
        registry.registerBeanDefinition(config.getName(), definition);
    }
}
```

### 5.6 ä¼˜ç¼ºç‚¹åˆ†æ


**âœ… ä¼˜ç‚¹**ï¼š
- æœ€çµæ´»ï¼Œè¿è¡Œæ—¶åŠ¨æ€å†³å®š
- é€‚åˆæ’ä»¶åŒ–æ¶æ„
- å¯ä»¥æ ¹æ®å¤æ‚æ¡ä»¶æ³¨å†Œ

**âŒ ç¼ºç‚¹**ï¼š
- ä»£ç å¤æ‚ï¼Œä¸æ˜“ç»´æŠ¤
- è°ƒè¯•å›°éš¾
- å®¹æ˜“å‡ºé”™

> âš ï¸ **ä½¿ç”¨å»ºè®®**ï¼š
> - ä¼˜å…ˆä½¿ç”¨JavaConfigæˆ–æ³¨è§£
> - åªåœ¨å¿…è¦æ—¶æ‰ç”¨ç¼–ç¨‹å¼æ³¨å†Œ
> - å……åˆ†æµ‹è¯•åŠ¨æ€æ³¨å†Œé€»è¾‘

---

## 6. ğŸ“Š æ³¨å†Œé¡ºåºä¸è¦†ç›–ç­–ç•¥


### 6.1 æ³¨å†Œé¡ºåºè§„åˆ™


**SpringåŠ è½½Beançš„é¡ºåº**ï¼š

```
å¯åŠ¨æµç¨‹ï¼š
1ï¸âƒ£ XMLé…ç½®æ–‡ä»¶
   â””â”€ æœ€å…ˆåŠ è½½ï¼Œä¼˜å…ˆçº§æœ€ä½
   
2ï¸âƒ£ JavaConfigé…ç½®ç±»
   â””â”€ @Configurationç±»
   â””â”€ æŒ‰@Orderæ³¨è§£æ’åº
   
3ï¸âƒ£ æ³¨è§£æ‰«æ
   â””â”€ @ComponentScanæ‰«æçš„ç±»
   â””â”€ æŒ‰åŒ…è·¯å¾„å­—æ¯é¡ºåº
   
4ï¸âƒ£ ç¼–ç¨‹å¼æ³¨å†Œ
   â””â”€ è¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œ
   â””â”€ æœ€åæ‰§è¡Œ
```

**é¡ºåºç¤ºä¾‹**ï¼š

```java
// 1. XMLé…ç½®ï¼ˆæœ€å…ˆï¼‰
<bean id="userService" class="com.example.XmlUserService"/>

// 2. JavaConfigï¼ˆæ¬¡ä¹‹ï¼‰
@Configuration
public class AppConfig {
    @Bean
    public UserService userService() {
        return new ConfigUserService();
    }
}

// 3. æ³¨è§£æ‰«æï¼ˆå†æ¬¡ï¼‰
@Service("userService")
public class AnnotationUserService implements UserService { }

// 4. ç¼–ç¨‹å¼æ³¨å†Œï¼ˆæœ€åï¼‰
registry.registerBeanDefinition("userService", definition);
```

### 6.2 Beanè¦†ç›–ç­–ç•¥


**é»˜è®¤è¡Œä¸º**ï¼ˆSpring 5.xä¹‹å‰ï¼‰ï¼š
```
å…è®¸è¦†ç›– = true
â†’ åæ³¨å†Œçš„Beanä¼šè¦†ç›–å…ˆæ³¨å†Œçš„
â†’ æœ€ç»ˆç”Ÿæ•ˆï¼šç¼–ç¨‹å¼æ³¨å†Œçš„Bean
```

**æ–°ç‰ˆæœ¬è¡Œä¸º**ï¼ˆSpring 5.1+ï¼‰ï¼š
```
å…è®¸è¦†ç›– = falseï¼ˆé»˜è®¤ï¼‰
â†’ ç›¸åŒåç§°çš„Beanä¼šæŠ›å‡ºå¼‚å¸¸
â†’ é¿å…æ„å¤–è¦†ç›–å¯¼è‡´çš„Bug
```

**é…ç½®è¦†ç›–ç­–ç•¥**ï¼š

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(Application.class);
        
        // å…è®¸Beanè¦†ç›–
        app.setAllowBeanDefinitionOverriding(true);
        
        app.run(args);
    }
}
```

æˆ–åœ¨é…ç½®æ–‡ä»¶ï¼š
```properties
# application.properties
spring.main.allow-bean-definition-overriding=true
```

### 6.3 è¦†ç›–åœºæ™¯åˆ†æ


**åœºæ™¯1ï¼šæµ‹è¯•ç¯å¢ƒè¦†ç›–**

```java
// ç”Ÿäº§ç¯å¢ƒé…ç½®
@Configuration
@Profile("prod")
public class ProdConfig {
    @Bean
    public UserService userService() {
        return new ProdUserService();
    }
}

// æµ‹è¯•ç¯å¢ƒé…ç½®ï¼ˆè¦†ç›–ï¼‰
@Configuration
@Profile("test")
public class TestConfig {
    @Bean
    public UserService userService() {
        return new MockUserService(); // æµ‹è¯•ç”¨Mockå¯¹è±¡
    }
}
```

**åœºæ™¯2ï¼šå¤šé…ç½®æ–‡ä»¶ä¼˜å…ˆçº§**

```
é…ç½®ä¼˜å…ˆçº§ï¼š
application.propertiesï¼ˆä½ï¼‰
  â†“
application-dev.propertiesï¼ˆä¸­ï¼‰
  â†“  
å‘½ä»¤è¡Œå‚æ•°ï¼ˆé«˜ï¼‰

ååŠ è½½çš„ä¼šè¦†ç›–å…ˆåŠ è½½çš„åŒåé…ç½®
```

### 6.4 é¿å…è¦†ç›–çš„æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š

1. **ä½¿ç”¨ä¸åŒçš„Beanåç§°**
```java
@Service("userServiceV1")
public class UserServiceV1 { }

@Service("userServiceV2")
public class UserServiceV2 { }
```

2. **ä½¿ç”¨@PrimaryæŒ‡å®šä¼˜å…ˆBean**
```java
@Service
@Primary  // å½“æœ‰å¤šä¸ªåŒç±»å‹Beanæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨è¿™ä¸ª
public class PrimaryUserService implements UserService { }

@Service
public class SecondaryUserService implements UserService { }
```

3. **ä½¿ç”¨@Qualifieræ˜ç¡®æŒ‡å®š**
```java
@Service
public class OrderService {
    @Autowired
    @Qualifier("primaryUserService")  // æ˜ç¡®æŒ‡å®šè¦æ³¨å…¥å“ªä¸ªBean
    private UserService userService;
}
```

### 6.5 è¦†ç›–é—®é¢˜è¯Šæ–­


**æ£€æŸ¥Beanæ³¨å†Œæƒ…å†µ**ï¼š

```java
@Component
public class BeanChecker implements ApplicationContextAware {
    
    @Override
    public void setApplicationContext(ApplicationContext ctx) {
        // è·å–æ‰€æœ‰Beanåç§°
        String[] beanNames = ctx.getBeanDefinitionNames();
        
        // æ£€æŸ¥é‡å¤Bean
        for (String name : beanNames) {
            Object bean = ctx.getBean(name);
            System.out.println(name + " -> " + bean.getClass().getName());
        }
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å››ç§æ³¨å†Œæ–¹å¼å¯¹æ¯”


| æ³¨å†Œæ–¹å¼ | ä½¿ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ | æ¨èæŒ‡æ•° |
|---------|---------|------|------|---------|
| **XMLé…ç½®** | è€é¡¹ç›®ã€é›†ä¸­é…ç½® | é…ç½®é›†ä¸­ | ç¹çã€æ— ç±»å‹æ£€æŸ¥ | â­â­ |
| **æ³¨è§£æ‰«æ** | å¿«é€Ÿå¼€å‘ã€SpringBoot | ç®€å•å¿«é€Ÿ | åŒ…æ‰«ææ…¢ã€éœ€æºç  | â­â­â­â­â­ |
| **JavaConfig** | ç¬¬ä¸‰æ–¹åº“ã€å¤æ‚é…ç½® | ç±»å‹å®‰å…¨ã€çµæ´» | ä»£ç é‡å¤š | â­â­â­â­ |
| **ç¼–ç¨‹å¼æ³¨å†Œ** | åŠ¨æ€æ‰©å±•ã€æ’ä»¶ç³»ç»Ÿ | æœ€çµæ´» | å¤æ‚ã€éš¾ç»´æŠ¤ | â­â­ |

### 7.2 é€‰æ‹©å»ºè®®æµç¨‹


```
é€‰æ‹©Beanæ³¨å†Œæ–¹å¼ï¼š

æ˜¯è‡ªå·±å†™çš„ç±»ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ ç”¨@Componentæ³¨è§£ âœ…
  â””â”€ å¦ â†’ æ˜¯ç¬¬ä¸‰æ–¹ç±»ï¼Ÿ
          â”œâ”€ æ˜¯ â†’ ç”¨@Beané…ç½® âœ…
          â””â”€ å¦ â†’ éœ€è¦åŠ¨æ€æ³¨å†Œï¼Ÿ
                  â”œâ”€ æ˜¯ â†’ ç¼–ç¨‹å¼æ³¨å†Œ âœ…
                  â””â”€ å¦ â†’ è€é¡¹ç›®ç”¨XML âœ…
```

### 7.3 æ ¸å¿ƒè®°å¿†è¦ç‚¹


**ğŸ”¸ æ³¨å†Œæœ¬è´¨**ï¼š
- Beanæ³¨å†Œ = å‘Šè¯‰Spring"æœ‰å“ªäº›å¯¹è±¡éœ€è¦ç®¡ç†"
- æ³¨å†Œä¿¡æ¯ = ç±»å‹ + åç§° + ä¾èµ– + ä½œç”¨åŸŸ

**ğŸ”¸ æ³¨å†Œæ—¶æœº**ï¼š
- XML/JavaConfig/æ³¨è§£ â†’ å®¹å™¨å¯åŠ¨æ—¶
- ç¼–ç¨‹å¼ â†’ è¿è¡Œæ—¶åŠ¨æ€

**ğŸ”¸ æ³¨å†Œé¡ºåº**ï¼š
- XML â†’ JavaConfig â†’ æ³¨è§£æ‰«æ â†’ ç¼–ç¨‹å¼
- åæ³¨å†Œå¯èƒ½è¦†ç›–å…ˆæ³¨å†Œï¼ˆçœ‹é…ç½®ï¼‰

**ğŸ”¸ æœ€ä½³å®è·µ**ï¼š
- âœ… ä¼˜å…ˆä½¿ç”¨æ³¨è§£ï¼ˆ`@Component`ã€`@Service`ç­‰ï¼‰
- âœ… ç¬¬ä¸‰æ–¹ç±»ç”¨`@Bean`é…ç½®
- âœ… å¤æ‚æ¡ä»¶ç”¨JavaConfig
- âœ… é¿å…Beanåç§°å†²çª
- âœ… ä½¿ç”¨`@Primary`å’Œ`@Qualifier`è§£å†³å¤šBeané—®é¢˜

### 7.4 å®æˆ˜å»ºè®®


**æ–°é¡¹ç›®å¼€å‘**ï¼š
```java
// ä¸»è¦ç”¨æ³¨è§£
@Service
public class UserService { }

// ç¬¬ä¸‰æ–¹åº“ç”¨JavaConfig
@Configuration
public class ThirdPartyConfig {
    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}
```

**è€é¡¹ç›®ç»´æŠ¤**ï¼š
```
ä¿æŒXMLé…ç½®ä¸å˜
æ–°åŠŸèƒ½ç”¨æ³¨è§£æˆ–JavaConfig
é€æ­¥è¿ç§»åˆ°ç°ä»£æ–¹å¼
```

**å¤æ‚åœºæ™¯**ï¼š
```
å¤šç¯å¢ƒ â†’ @Profile
æ¡ä»¶æ³¨å†Œ â†’ @Conditional
åŠ¨æ€æ‰©å±• â†’ ç¼–ç¨‹å¼æ³¨å†Œ
```

> ğŸ’¡ **æ ¸å¿ƒç†å¿µ**ï¼š
> - ç®€å•åœºæ™¯ç”¨ç®€å•æ–¹å¼ï¼ˆæ³¨è§£ï¼‰
> - å¤æ‚åœºæ™¯ç”¨çµæ´»æ–¹å¼ï¼ˆJavaConfig/ç¼–ç¨‹å¼ï¼‰
> - ä¿æŒä»£ç æ¸…æ™°ï¼Œé¿å…è¿‡åº¦è®¾è®¡