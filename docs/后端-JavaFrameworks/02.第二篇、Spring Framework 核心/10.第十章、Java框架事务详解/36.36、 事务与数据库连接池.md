---
title: 36ã€ äº‹åŠ¡ä¸æ•°æ®åº“è¿æ¥æ± 
---
## ğŸ“š ç›®å½•

1. [è¿æ¥æ± åŸºç¡€æ¦‚å¿µ](#1-è¿æ¥æ± åŸºç¡€æ¦‚å¿µ)
2. [è¿æ¥æ± çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶](#2-è¿æ¥æ± çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶)
3. [ä¸»æµè¿æ¥æ± é…ç½®è¯¦è§£](#3-ä¸»æµè¿æ¥æ± é…ç½®è¯¦è§£)
4. [è¿æ¥æ³„éœ²é—®é¢˜è¯Šæ–­ä¸è§£å†³](#4-è¿æ¥æ³„éœ²é—®é¢˜è¯Šæ–­ä¸è§£å†³)
5. [è¿æ¥æ± ç›‘æ§ä¸è°ƒä¼˜](#5-è¿æ¥æ± ç›‘æ§ä¸è°ƒä¼˜)
6. [å®æˆ˜åœºæ™¯ä¸æœ€ä½³å®è·µ](#6-å®æˆ˜åœºæ™¯ä¸æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¿æ¥æ± åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± 


**é€šä¿—ç†è§£**ï¼šæ•°æ®åº“è¿æ¥æ± å°±åƒæ˜¯ä¸€ä¸ª"è¿æ¥ä»“åº“"

```
æ²¡æœ‰è¿æ¥æ± çš„æƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åˆ›å»ºæ•°æ®åº“è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å…³é—­è¿æ¥
æ¯æ¬¡éƒ½è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œå°±åƒæ¯æ¬¡æ‰“ç”µè¯éƒ½è¦é‡æ–°æ‹‰ç½‘çº¿

æœ‰è¿æ¥æ± çš„æƒ…å†µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ä»æ± ä¸­å€Ÿè¿æ¥ â†’ æ‰§è¡ŒSQL â†’ è¿˜å›æ± ä¸­
è¿æ¥å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå°±åƒå…±äº«å•è½¦ï¼Œç”¨å®Œè¿˜å›å»ç»™åˆ«äººç”¨
```

**ğŸ’¡ æ ¸å¿ƒä»·å€¼**
- **æå‡æ€§èƒ½**ï¼šé¿å…é¢‘ç¹åˆ›å»º/é”€æ¯è¿æ¥çš„å¼€é”€
- **èµ„æºæ§åˆ¶**ï¼šé™åˆ¶æ•°æ®åº“è¿æ¥æ•°ï¼Œé˜²æ­¢èµ„æºè€—å°½
- **è¿æ¥å¤ç”¨**ï¼šä¸€ä¸ªè¿æ¥å¯ä»¥è¢«å¤šä¸ªè¯·æ±‚ä½¿ç”¨

### 1.2 è¿æ¥æ± çš„å·¥ä½œåŸç†


```
è¿æ¥æ± ç”Ÿå‘½å‘¨æœŸï¼š

åˆå§‹åŒ–é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºNä¸ªè¿æ¥  â”‚ â† æ ¹æ®initialSizeé…ç½®
â”‚  æ”¾å…¥è¿æ¥æ±    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½¿ç”¨é˜¶æ®µï¼š
è¯·æ±‚åˆ°æ¥ â†’ ä»æ± ä¸­è·å–è¿æ¥ â†’ æ‰§è¡Œäº‹åŠ¡ â†’ å½’è¿˜è¿æ¥
    â†“           â†“               â†“          â†“
  ç©ºé—²æ±      ä½¿ç”¨ä¸­æ±           æäº¤/å›æ»š    ç©ºé—²æ± 

é”€æ¯é˜¶æ®µï¼š
åº”ç”¨å…³é—­ â†’ å…³é—­æ‰€æœ‰è¿æ¥ â†’ é‡Šæ”¾èµ„æº
```

**å…³é”®æ¦‚å¿µè§£é‡Š**ï¼š
- **åˆå§‹è¿æ¥æ•°(initialSize)**ï¼šåº”ç”¨å¯åŠ¨æ—¶åˆ›å»ºå¤šå°‘ä¸ªè¿æ¥
- **æœ€å°ç©ºé—²è¿æ¥(minIdle)**ï¼šæ± ä¸­è‡³å°‘ä¿æŒå¤šå°‘ä¸ªç©ºé—²è¿æ¥
- **æœ€å¤§è¿æ¥æ•°(maxActive)**ï¼šæ± ä¸­æœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ªè¿æ¥

---

## 2. ğŸ”„ è¿æ¥æ± çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶


### 2.1 è¿æ¥æ± ä¸äº‹åŠ¡çš„å…³ç³»


**æ ¸å¿ƒç†è§£**ï¼šä¸€ä¸ªäº‹åŠ¡å¿…é¡»åœ¨åŒä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸Šæ‰§è¡Œ

```
æ­£ç¡®çš„äº‹åŠ¡æµç¨‹ï¼š
å¼€å¯äº‹åŠ¡ â†’ [å€Ÿä¸€ä¸ªè¿æ¥] â†’ æ‰§è¡ŒSQL1 â†’ æ‰§è¡ŒSQL2 â†’ æäº¤ â†’ [è¿˜è¿æ¥]
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åŒä¸€ä¸ªè¿æ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é”™è¯¯çš„æƒ…å†µï¼š
å¼€å¯äº‹åŠ¡ â†’ [å€Ÿè¿æ¥A] â†’ æ‰§è¡ŒSQL1 â†’ [è¿˜è¿æ¥A]
                    â†’ [å€Ÿè¿æ¥B] â†’ æ‰§è¡ŒSQL2 â†’ [è¿˜è¿æ¥B]
âŒ SQL1å’ŒSQL2åœ¨ä¸åŒè¿æ¥ï¼Œä¸åœ¨åŒä¸€äº‹åŠ¡ï¼
```

**Springå¦‚ä½•ä¿è¯äº‹åŠ¡è¿æ¥ä¸€è‡´æ€§**ï¼š

â‘  **å¼€å¯äº‹åŠ¡æ—¶**ï¼š
```
@Transactionalæ–¹æ³•å¼€å§‹
    â†“
ä»è¿æ¥æ± è·å–ä¸€ä¸ªè¿æ¥
    â†“
æŠŠè¿æ¥ç»‘å®šåˆ°å½“å‰çº¿ç¨‹(ThreadLocal)
    â†“
è®¾ç½®autoCommit=false
```

â‘¡ **æ‰§è¡ŒSQLæ—¶**ï¼š
```
æ‰§è¡ŒMapperæ–¹æ³•
    â†“
ä»å½“å‰çº¿ç¨‹è·å–ç»‘å®šçš„è¿æ¥ï¼ˆåŒä¸€ä¸ªè¿æ¥ï¼ï¼‰
    â†“
ä½¿ç”¨è¿™ä¸ªè¿æ¥æ‰§è¡ŒSQL
```

â‘¢ **æäº¤äº‹åŠ¡æ—¶**ï¼š
```
æ–¹æ³•æ­£å¸¸ç»“æŸ
    â†“
è°ƒç”¨connection.commit()
    â†“
è§£é™¤çº¿ç¨‹ç»‘å®š
    â†“
æŠŠè¿æ¥è¿˜å›è¿æ¥æ± 
```

### 2.2 è¿æ¥è·å–ä¸é‡Šæ”¾çš„æ—¶æœº


**ğŸ”¸ é‡è¦åŸåˆ™**ï¼šè¿æ¥è·å–è¦æ™šï¼Œé‡Šæ”¾è¦æ—©

| æ—¶æœº | **æ“ä½œ** | **è¯´æ˜** |
|------|---------|---------|
| **è·å–è¿æ¥** | `ç¬¬ä¸€æ¬¡æ‰§è¡ŒSQLæ—¶` | `å»¶è¿Ÿè·å–ï¼Œé¿å…å ç”¨` |
| **æŒæœ‰è¿æ¥** | `æ•´ä¸ªäº‹åŠ¡æœŸé—´` | `ä¿è¯äº‹åŠ¡å®Œæ•´æ€§` |
| **é‡Šæ”¾è¿æ¥** | `äº‹åŠ¡æäº¤/å›æ»šå` | `ç«‹å³å½’è¿˜ç»™è¿æ¥æ± ` |

**é”™è¯¯ç¤ºèŒƒ**ï¼š
```java
// âŒ é”™è¯¯ï¼šäº‹åŠ¡æ–¹æ³•ä¸­é•¿æ—¶é—´æŒæœ‰è¿æ¥
@Transactional
public void processOrder(Order order) {
    // è¿™é‡Œä¼šè·å–è¿æ¥
    orderMapper.insert(order);
    
    // å‘é€é‚®ä»¶ï¼Œè€—æ—¶10ç§’
    emailService.sendEmail(); // è¿æ¥è¢«ç™½ç™½å ç”¨10ç§’ï¼
    
    // æ›´æ–°çŠ¶æ€
    orderMapper.updateStatus(order.getId());
} // è¿™é‡Œæ‰é‡Šæ”¾è¿æ¥
```

**æ­£ç¡®åšæ³•**ï¼š
```java
// âœ… æ­£ç¡®ï¼šç¼©å°äº‹åŠ¡èŒƒå›´
public void processOrder(Order order) {
    // å…ˆæ‰§è¡Œäº‹åŠ¡æ“ä½œ
    executeInTransaction(() -> {
        orderMapper.insert(order);
        orderMapper.updateStatus(order.getId());
    }); // äº‹åŠ¡ç»“æŸï¼Œè¿æ¥ç«‹å³å½’è¿˜
    
    // éäº‹åŠ¡æ“ä½œå•ç‹¬æ‰§è¡Œ
    emailService.sendEmail(); // ä¸å ç”¨æ•°æ®åº“è¿æ¥
}
```

---

## 3. âš™ï¸ ä¸»æµè¿æ¥æ± é…ç½®è¯¦è§£


### 3.1 HikariCPé…ç½®ï¼ˆSpring Booté»˜è®¤ï¼‰


**ä¸ºä»€ä¹ˆé€‰HikariCP**ï¼š
- æ€§èƒ½æœ€ä¼˜ï¼šæ¯”å…¶ä»–è¿æ¥æ± å¿«30%ä»¥ä¸Š
- ç¨³å®šå¯é ï¼šä»£ç ç²¾ç®€ï¼ŒBugå°‘
- Spring Bootå®˜æ–¹é»˜è®¤é€‰æ‹©

**æ ¸å¿ƒé…ç½®å‚æ•°**ï¼š

```yaml
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      # è¿æ¥æ•°é…ç½®
      minimum-idle: 10              # æœ€å°ç©ºé—²è¿æ¥æ•°
      maximum-pool-size: 20         # æœ€å¤§è¿æ¥æ•°
      
      # è¶…æ—¶é…ç½®
      connection-timeout: 30000     # è·å–è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)
      idle-timeout: 600000          # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´(10åˆ†é’Ÿ)
      max-lifetime: 1800000         # è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´(30åˆ†é’Ÿ)
      
      # è¿æ¥æµ‹è¯•
      connection-test-query: SELECT 1
      
      # äº‹åŠ¡ç›¸å…³
      auto-commit: true             # æ³¨æ„ï¼šSpringä¼šè‡ªåŠ¨ç®¡ç†
```

**ğŸ“Š å‚æ•°å«ä¹‰è¯¦è§£**ï¼š

**minimum-idleï¼ˆæœ€å°ç©ºé—²æ•°ï¼‰**ï¼š
```
å«ä¹‰ï¼šæ± ä¸­è‡³å°‘ä¿æŒå¤šå°‘ä¸ªç©ºé—²è¿æ¥

å»ºè®®å€¼ï¼š
- å°é¡¹ç›®ï¼š5-10
- ä¸­å‹é¡¹ç›®ï¼š10-20
- å¤§å‹é¡¹ç›®ï¼š20-50

åŸç†ï¼š
è¿æ¥æ•° < minimum-idle â†’ è‡ªåŠ¨åˆ›å»ºæ–°è¿æ¥
è¿æ¥æ•° > minimum-idle â†’ ç©ºé—²è¶…æ—¶åå›æ”¶
```

**maximum-pool-sizeï¼ˆæœ€å¤§è¿æ¥æ•°ï¼‰**ï¼š
```
å«ä¹‰ï¼šæ± ä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªè¿æ¥

è®¡ç®—å…¬å¼ï¼š
æœ€å¤§è¿æ¥æ•° = (æ ¸å¿ƒæ•° Ã— 2) + ç£ç›˜æ•°

ç¤ºä¾‹ï¼š
4æ ¸CPU + 1å—ç¡¬ç›˜ â†’ æœ€å¤§è¿æ¥æ•° = 4Ã—2+1 = 9

å¸¸è§é…ç½®ï¼š
- å¼€å‘ç¯å¢ƒï¼š10-20
- æµ‹è¯•ç¯å¢ƒï¼š20-50  
- ç”Ÿäº§ç¯å¢ƒï¼š50-200ï¼ˆæ ¹æ®å®é™…å‹æµ‹ï¼‰
```

**connection-timeoutï¼ˆè·å–è¿æ¥è¶…æ—¶ï¼‰**ï¼š
```
å«ä¹‰ï¼šç­‰å¾…è¿æ¥çš„æœ€é•¿æ—¶é—´

åœºæ™¯ï¼š
è¿æ¥æ± å·²æ»¡ â†’ æ–°è¯·æ±‚ç­‰å¾… â†’ è¶…æ—¶æŠ›å¼‚å¸¸

å»ºè®®å€¼ï¼š30ç§’ï¼ˆ30000msï¼‰

âš ï¸ å¦‚æœé¢‘ç¹è¶…æ—¶ï¼Œè¯´æ˜ï¼š
1. æœ€å¤§è¿æ¥æ•°é…ç½®å¤ªå°
2. SQLæ‰§è¡Œå¤ªæ…¢ï¼Œè¿æ¥è¢«å ç”¨
3. æœ‰è¿æ¥æ³„éœ²
```

### 3.2 Druidé…ç½®ï¼ˆé˜¿é‡Œå·´å·´ï¼‰


**Druidçš„ä¼˜åŠ¿**ï¼š
- åŠŸèƒ½ä¸°å¯Œï¼šå†…ç½®ç›‘æ§ã€SQLé˜²ç«å¢™
- ä¸­æ–‡å‹å¥½ï¼šæ–‡æ¡£å®Œå–„ï¼Œé€‚åˆå›½å†…ä½¿ç”¨
- ç›‘æ§å¼ºå¤§ï¼šWebç•Œé¢å®æ—¶ç›‘æ§

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # åŸºç¡€è¿æ¥é…ç½®
      initial-size: 10
      min-idle: 10
      max-active: 100
      
      # è·å–è¿æ¥ç­‰å¾…è¶…æ—¶
      max-wait: 60000
      
      # è¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      
      # æ£€æµ‹é—´éš”æ—¶é—´
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      
      # ç›‘æ§ç»Ÿè®¡é…ç½®
      filters: stat,wall,slf4j
      
      # ç›‘æ§é¡µé¢é…ç½®
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username: admin
        login-password: admin
```

**ğŸ” Druidç‰¹è‰²åŠŸèƒ½**ï¼š

â‘  **SQLç›‘æ§**ï¼š
```
è®¿é—®ï¼šhttp://localhost:8080/druid
å¯ä»¥çœ‹åˆ°ï¼š
- æ¯ä¸ªSQLçš„æ‰§è¡Œæ¬¡æ•°
- å¹³å‡æ‰§è¡Œæ—¶é—´
- æœ€æ…¢çš„SQL
- é”™è¯¯ç»Ÿè®¡
```

â‘¡ **SQLé˜²ç«å¢™**ï¼š
```yaml
druid:
  filters: wall  # å¼€å¯é˜²ç«å¢™
  wall:
    config:
      delete-allow: false        # ç¦æ­¢åˆ é™¤æ“ä½œ
      drop-table-allow: false    # ç¦æ­¢åˆ è¡¨
```

### 3.3 è¿æ¥æ•°é…ç½®å®æˆ˜å»ºè®®


**ğŸ¯ é…ç½®åŸåˆ™**ï¼š

```
â‘  åˆå§‹è¿æ¥æ•°(initialSize)ï¼š
   - ä½œç”¨ï¼šåº”ç”¨å¯åŠ¨æ—¶å°±å‡†å¤‡å¥½çš„è¿æ¥
   - å»ºè®®ï¼šè®¾ç½®ä¸ºminIdleçš„å€¼
   - ç¤ºä¾‹ï¼šå¦‚æœminIdle=10ï¼Œåˆ™initialSize=10

â‘¡ æœ€å°ç©ºé—²æ•°(minIdle)ï¼š
   - ä½œç”¨ï¼šä¿è¯éšæ—¶æœ‰è¿æ¥å¯ç”¨
   - å»ºè®®ï¼šæ ¹æ®å¹¶å‘é‡è®¾ç½®
   - è®¡ç®—ï¼šé¢„æœŸå¹¶å‘æ•° Ã— 0.5

â‘¢ æœ€å¤§è¿æ¥æ•°(maxActive)ï¼š
   - ä½œç”¨ï¼šé˜²æ­¢æ— é™åˆ¶åˆ›å»ºè¿æ¥
   - å»ºè®®ï¼šæ ¹æ®æ•°æ®åº“æ‰¿å—èƒ½åŠ›
   - æ³¨æ„ï¼šMySQLé»˜è®¤æœ€å¤§è¿æ¥æ•°151

â‘£ è¶…æ—¶æ—¶é—´(maxWait)ï¼š
   - ä½œç”¨ï¼šé¿å…æ— é™æœŸç­‰å¾…
   - å»ºè®®ï¼š30-60ç§’
   - åŸåˆ™ï¼šå®å¯å¿«é€Ÿå¤±è´¥ï¼Œä¹Ÿä¸é•¿æ—¶é—´é˜»å¡
```

**åœºæ™¯åŒ–é…ç½®**ï¼š

| åœºæ™¯ | **initialSize** | **minIdle** | **maxActive** | **è¯´æ˜** |
|------|----------------|-------------|---------------|----------|
| **å¼€å‘ç¯å¢ƒ** | `5` | `5` | `10` | `èµ„æºæœ‰é™ï¼Œå¤Ÿç”¨å³å¯` |
| **å°å‹é¡¹ç›®** | `10` | `10` | `20` | `æ—¥æ´»1ä¸‡ä»¥å†…` |
| **ä¸­å‹é¡¹ç›®** | `20` | `20` | `50` | `æ—¥æ´»10ä¸‡å·¦å³` |
| **å¤§å‹é¡¹ç›®** | `50` | `50` | `200` | `éœ€è¦å‹æµ‹ç¡®å®š` |

---

## 4. ğŸ” è¿æ¥æ³„éœ²é—®é¢˜è¯Šæ–­ä¸è§£å†³


### 4.1 ä»€ä¹ˆæ˜¯è¿æ¥æ³„éœ²


**é€šä¿—è§£é‡Š**ï¼šè¿æ¥å€Ÿå‡ºå»äº†ï¼Œä½†æ²¡è¿˜å›æ¥

```
æ­£å¸¸æƒ…å†µï¼š
å€Ÿè¿æ¥ â†’ ä½¿ç”¨ â†’ å½’è¿˜ â†’ ä¸‹æ¬¡ç»§ç»­å€Ÿ
  ğŸŠ      ğŸŠ     ğŸŠ      âœ…

è¿æ¥æ³„éœ²ï¼š
å€Ÿè¿æ¥ â†’ ä½¿ç”¨ â†’ å¿˜è®°å½’è¿˜ â†’ è¿æ¥æ°¸è¿œä¸¢å¤±
  ğŸŠ      ğŸŠ      âŒ      ğŸ’€
```

**å…¸å‹ç—‡çŠ¶**ï¼š
- åº”ç”¨åˆšå¯åŠ¨æ­£å¸¸ï¼Œè¿è¡Œä¸€æ®µæ—¶é—´åæ— æ³•è·å–è¿æ¥
- æ—¥å¿—å‡ºç°ï¼š`Timeout: Pool empty. Unable to fetch a connection`
- æ•°æ®åº“è¿æ¥æ•°æŒç»­å¢é•¿ä¸ä¸‹é™

### 4.2 å¸¸è§æ³„éœ²åœºæ™¯


**åœºæ™¯1ï¼šæ‰‹åŠ¨ç®¡ç†è¿æ¥æœªå…³é—­**

```java
// âŒ é”™è¯¯ç¤ºä¾‹
public List<User> getUsers() {
    Connection conn = dataSource.getConnection();
    PreparedStatement ps = conn.prepareStatement("SELECT * FROM user");
    ResultSet rs = ps.executeQuery();
    
    List<User> users = new ArrayList<>();
    while (rs.next()) {
        users.add(mapUser(rs));
    }
    
    return users; // å¿˜è®°å…³é—­è¿æ¥ï¼
}
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
```java
public List<User> getUsers() {
    try (Connection conn = dataSource.getConnection();
         PreparedStatement ps = conn.prepareStatement("SELECT * FROM user");
         ResultSet rs = ps.executeQuery()) {
        
        List<User> users = new ArrayList<>();
        while (rs.next()) {
            users.add(mapUser(rs));
        }
        return users;
        
    } // try-with-resourcesè‡ªåŠ¨å…³é—­
}
```

**åœºæ™¯2ï¼šäº‹åŠ¡æœªæäº¤ä¹Ÿæœªå›æ»š**

```java
// âŒ é”™è¯¯ç¤ºä¾‹
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void updateUser(User user) {
    userMapper.update(user);
    
    if (user.getAge() < 0) {
        throw new RuntimeException("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°");
        // æŠ›å¼‚å¸¸äº†ï¼Œä½†å› ä¸ºæ˜¯æ£€æŸ¥å¼‚å¸¸ï¼Œäº‹åŠ¡ä¸ä¼šå›æ»š
        // è¿æ¥ä¸€ç›´æŒæœ‰ï¼Œç­‰å¾…æäº¤æˆ–å›æ»š
    }
}
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
```java
@Transactional(rollbackFor = Exception.class) // æ˜ç¡®å›æ»šè§„åˆ™
public void updateUser(User user) {
    userMapper.update(user);
    
    if (user.getAge() < 0) {
        throw new RuntimeException("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°");
        // è¿è¡Œæ—¶å¼‚å¸¸ï¼Œäº‹åŠ¡è‡ªåŠ¨å›æ»šï¼Œè¿æ¥å½’è¿˜
    }
}
```

### 4.3 è¯Šæ–­è¿æ¥æ³„éœ²çš„æ–¹æ³•


**æ–¹æ³•1ï¼šå¼€å¯è¿æ¥æ³„éœ²æ£€æµ‹**

```yaml
# HikariCPé…ç½®
spring:
  datasource:
    hikari:
      leak-detection-threshold: 60000  # 60ç§’æœªå½’è¿˜è§†ä¸ºæ³„éœ²
```

**æ•ˆæœ**ï¼š
```
æ—¥å¿—è¾“å‡ºï¼š
[WARN] Connection leak detection triggered for connection, 
stack trace follows:
  at com.example.UserService.getUsers(UserService.java:25)
  at com.example.UserController.list(UserController.java:18)
  
ğŸ” ç›´æ¥å®šä½åˆ°æ³„éœ²ä»£ç ä½ç½®ï¼
```

**æ–¹æ³•2ï¼šDruidç›‘æ§é¢æ¿**

```
è®¿é—®ï¼šhttp://localhost:8080/druid/datasource.html

æŸ¥çœ‹æŒ‡æ ‡ï¼š
- ActiveCountï¼šæ­£åœ¨ä½¿ç”¨çš„è¿æ¥æ•°
  â†’ å¦‚æœæŒç»­å¢é•¿ä¸ä¸‹é™ = æ³„éœ²
  
- PoolingCountï¼šç©ºé—²è¿æ¥æ•°
  â†’ å¦‚æœæŒç»­ä¸º0 = è¿æ¥è¢«å æ»¡
  
- WaitThreadCountï¼šç­‰å¾…è¿æ¥çš„çº¿ç¨‹æ•°
  â†’ å¦‚æœå¤§äº0 = è¿æ¥ä¸å¤Ÿç”¨
```

**æ–¹æ³•3ï¼šæ•°æ®åº“ç«¯æ£€æŸ¥**

```sql
-- MySQLæŸ¥çœ‹å½“å‰è¿æ¥æ•°
SHOW PROCESSLIST;

-- æŸ¥çœ‹è¿æ¥æ¥æº
SELECT * FROM information_schema.PROCESSLIST
WHERE USER = 'your_app_user'
AND TIME > 300; -- è¶…è¿‡5åˆ†é’Ÿçš„è¿æ¥

-- ç»Ÿè®¡æ¯ä¸ªIPçš„è¿æ¥æ•°
SELECT HOST, COUNT(*) as conn_count
FROM information_schema.PROCESSLIST
GROUP BY HOST
ORDER BY conn_count DESC;
```

### 4.4 è§£å†³è¿æ¥æ³„éœ²çš„å®æˆ˜æ–¹æ¡ˆ


**â‘  ä½¿ç”¨Springçš„äº‹åŠ¡ç®¡ç†ï¼ˆæ¨èï¼‰**ï¼š
```java
// âœ… è®©Springç®¡ç†ï¼Œä¸ç”¨æ‹…å¿ƒæ³„éœ²
@Transactional
public void businessMethod() {
    // Springè‡ªåŠ¨ç®¡ç†è¿æ¥çš„è·å–å’Œå½’è¿˜
    userMapper.insert(user);
    orderMapper.insert(order);
} // æ–¹æ³•ç»“æŸï¼Œè¿æ¥è‡ªåŠ¨å½’è¿˜
```

**â‘¡ é…ç½®è¿æ¥è‡ªåŠ¨å›æ”¶**ï¼š
```yaml
spring:
  datasource:
    hikari:
      # ç©ºé—²è¿æ¥10åˆ†é’Ÿåå›æ”¶
      idle-timeout: 600000
      
      # è¿æ¥æœ€å¤šå­˜æ´»30åˆ†é’Ÿï¼ˆé˜²æ­¢é•¿æ—¶é—´å ç”¨ï¼‰
      max-lifetime: 1800000
      
      # å¯ç”¨è¿æ¥æ³„æ¼æ£€æµ‹
      leak-detection-threshold: 60000
```

**â‘¢ è®¾ç½®äº‹åŠ¡è¶…æ—¶**ï¼š
```java
// äº‹åŠ¡è¶…è¿‡30ç§’è‡ªåŠ¨å›æ»š
@Transactional(timeout = 30)
public void longRunningTask() {
    // å¦‚æœæ‰§è¡Œè¶…è¿‡30ç§’ï¼Œè‡ªåŠ¨å›æ»š
    // è¿æ¥ä¼šè¢«å½’è¿˜
}
```

---

## 5. ğŸ“Š è¿æ¥æ± ç›‘æ§ä¸è°ƒä¼˜


### 5.1 å…³é”®ç›‘æ§æŒ‡æ ‡


**ğŸ”¸ æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜**ï¼š

```
â‘  ActiveCountï¼ˆæ´»è·ƒè¿æ¥æ•°ï¼‰
   å«ä¹‰ï¼šæ­£åœ¨è¢«ä½¿ç”¨çš„è¿æ¥æ•°
   æ­£å¸¸å€¼ï¼š< maxActiveçš„80%
   å‘Šè­¦ï¼šæŒç»­æ¥è¿‘maxActive
   
â‘¡ IdleCountï¼ˆç©ºé—²è¿æ¥æ•°ï¼‰  
   å«ä¹‰ï¼šæ± ä¸­ç©ºé—²çš„è¿æ¥æ•°
   æ­£å¸¸å€¼ï¼š> minIdle
   å‘Šè­¦ï¼šé•¿æœŸä¸º0
   
â‘¢ WaitCountï¼ˆç­‰å¾…çº¿ç¨‹æ•°ï¼‰
   å«ä¹‰ï¼šç­‰å¾…è·å–è¿æ¥çš„çº¿ç¨‹æ•°
   æ­£å¸¸å€¼ï¼š0
   å‘Šè­¦ï¼š> 0ï¼ˆè¯´æ˜è¿æ¥ä¸å¤Ÿï¼‰
   
â‘£ ConnectionTimeï¼ˆè·å–è¿æ¥è€—æ—¶ï¼‰
   å«ä¹‰ï¼šè·å–ä¸€ä¸ªè¿æ¥çš„å¹³å‡æ—¶é—´
   æ­£å¸¸å€¼ï¼š< 10ms
   å‘Šè­¦ï¼š> 100ms
```

**ç›‘æ§é…ç½®ç¤ºä¾‹**ï¼š

```java
@Component
public class PoolMonitor {
    
    @Autowired
    private DataSource dataSource;
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿç›‘æ§ä¸€æ¬¡
    public void monitorPool() {
        if (dataSource instanceof HikariDataSource) {
            HikariDataSource hikari = (HikariDataSource) dataSource;
            HikariPoolMXBean pool = hikari.getHikariPoolMXBean();
            
            int active = pool.getActiveConnections();
            int idle = pool.getIdleConnections();
            int total = pool.getTotalConnections();
            int waiting = pool.getThreadsAwaitingConnection();
            
            log.info("è¿æ¥æ± çŠ¶æ€ - æ´»è·ƒ:{}, ç©ºé—²:{}, æ€»æ•°:{}, ç­‰å¾…:{}", 
                     active, idle, total, waiting);
            
            // å‘Šè­¦åˆ¤æ–­
            if (waiting > 0) {
                log.warn("âš ï¸ æœ‰{}ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…è¿æ¥ï¼Œè¯·æ£€æŸ¥é…ç½®ï¼", waiting);
            }
            
            if (active > total * 0.8) {
                log.warn("âš ï¸ æ´»è·ƒè¿æ¥æ•°è¿‡é«˜({}/{})", active, total);
            }
        }
    }
}
```

### 5.2 æ€§èƒ½è°ƒä¼˜å®æˆ˜


**åœºæ™¯1ï¼šé¢‘ç¹è·å–è¿æ¥è¶…æ—¶**

```
ç—‡çŠ¶ï¼š
- æ—¥å¿—å¤§é‡å‡ºç°ï¼šConnection is not available
- ç”¨æˆ·è¯·æ±‚å“åº”æ…¢

è¯Šæ–­æ­¥éª¤ï¼š
â‘  æŸ¥çœ‹æ´»è·ƒè¿æ¥æ•°
   â†’ å¦‚æœæ¥è¿‘maxActive = è¿æ¥æ•°ä¸å¤Ÿ

â‘¡ æŸ¥çœ‹SQLæ‰§è¡Œæ—¶é—´  
   â†’ å¦‚æœæœ‰æ…¢SQL = ä¼˜åŒ–SQL

â‘¢ æŸ¥çœ‹äº‹åŠ¡æŒæœ‰æ—¶é—´
   â†’ å¦‚æœäº‹åŠ¡èŒƒå›´å¤ªå¤§ = ç¼©å°äº‹åŠ¡

è§£å†³æ–¹æ¡ˆï¼š
â–¶ å¢åŠ maxActiveé…ç½®
â–¶ ä¼˜åŒ–æ…¢SQL
â–¶ ç¼©å°äº‹åŠ¡èŒƒå›´
```

**åœºæ™¯2ï¼šè¿æ¥åˆ›å»ºé”€æ¯é¢‘ç¹**

```
ç—‡çŠ¶ï¼š
- ç›‘æ§æ˜¾ç¤ºè¿æ¥æ•°é¢‘ç¹æ³¢åŠ¨
- æ•°æ®åº“æœ‰å¤§é‡TIME_WAITè¿æ¥

åŸå› åˆ†æï¼š
minIdleè®¾ç½®å¤ªå° â†’ ç©ºé—²è¿æ¥ä¸å¤Ÿ â†’ é¢‘ç¹åˆ›å»ºæ–°è¿æ¥

è§£å†³æ–¹æ¡ˆï¼š
# å¢åŠ æœ€å°ç©ºé—²è¿æ¥æ•°
spring:
  datasource:
    hikari:
      minimum-idle: 20  # ä»10è°ƒæ•´åˆ°20
      max-lifetime: 1800000  # å»¶é•¿è¿æ¥å­˜æ´»æ—¶é—´
```

**åœºæ™¯3ï¼šæ•°æ®åº“è¿æ¥æ•°å‘Šè­¦**

```
ç—‡çŠ¶ï¼š
- æ•°æ®åº“æŠ¥é”™ï¼šToo many connections
- åº”ç”¨æ—¥å¿—ï¼šCannot create PoolableConnectionFactory

é—®é¢˜å®šä½ï¼š
â‘  æŸ¥çœ‹åº”ç”¨å®ä¾‹æ•°
   ä¾‹ï¼š5ä¸ªå®ä¾‹ï¼Œæ¯ä¸ªmaxActive=100
   æ€»è¿æ¥æ•° = 5 Ã— 100 = 500

â‘¡ æŸ¥çœ‹æ•°æ®åº“æœ€å¤§è¿æ¥æ•°
   SHOW VARIABLES LIKE 'max_connections'; 
   â†’ å‡è®¾åªæœ‰151

å†²çªï¼šåº”ç”¨éœ€è¦500ï¼Œæ•°æ®åº“åªæ”¯æŒ151

è§£å†³æ–¹æ¡ˆï¼š
æ–¹æ¡ˆAï¼šå¢åŠ æ•°æ®åº“è¿æ¥æ•°
  SET GLOBAL max_connections = 1000;

æ–¹æ¡ˆBï¼šå‡å°‘åº”ç”¨è¿æ¥æ•°
  spring:
    datasource:
      hikari:
        maximum-pool-size: 30  # ä»100é™åˆ°30
        # 5ä¸ªå®ä¾‹ Ã— 30 = 150ï¼Œä¸è¶…è¿‡æ•°æ®åº“é™åˆ¶
```

### 5.3 è¿æ¥æ± å¥åº·æ£€æŸ¥


**é…ç½®è¿æ¥æµ‹è¯•**ï¼š

```yaml
spring:
  datasource:
    hikari:
      # è¿æ¥æµ‹è¯•SQL
      connection-test-query: SELECT 1
      
      # è¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹ï¼ˆæ¨èé…ç½®ï¼‰
      connection-timeout: 30000        # 30ç§’è¶…æ—¶
      validation-timeout: 5000         # éªŒè¯è¶…æ—¶5ç§’
      
      # å¥åº·æ£€æŸ¥
      health-check-registry: healthCheckRegistry
```

**è‡ªå®šä¹‰å¥åº·æ£€æŸ¥**ï¼š

```java
@Component
public class DataSourceHealthIndicator implements HealthIndicator {
    
    @Autowired
    private DataSource dataSource;
    
    @Override
    public Health health() {
        try (Connection conn = dataSource.getConnection()) {
            
            // æµ‹è¯•è¿æ¥æœ‰æ•ˆæ€§
            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery("SELECT 1");
            
            if (rs.next() && rs.getInt(1) == 1) {
                return Health.up()
                    .withDetail("database", "MySQL")
                    .withDetail("status", "å¯ç”¨")
                    .build();
            }
            
        } catch (Exception e) {
            return Health.down()
                .withDetail("error", e.getMessage())
                .build();
        }
        
        return Health.down().build();
    }
}
```

---

## 6. ğŸ¯ å®æˆ˜åœºæ™¯ä¸æœ€ä½³å®è·µ


### 6.1 åœºæ™¯1ï¼šé«˜å¹¶å‘ç§’æ€ç³»ç»Ÿ


**éœ€æ±‚**ï¼š
- ç¬æ—¶å¹¶å‘ï¼š10000+ QPS
- å“åº”æ—¶é—´ï¼š< 100ms
- æ•°æ®ä¸€è‡´æ€§ï¼šå¼ºä¸€è‡´

**è¿æ¥æ± é…ç½®**ï¼š

```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 50              # é¢„ç•™è¶³å¤Ÿç©ºé—²è¿æ¥
      maximum-pool-size: 200        # æ”¯æŒé«˜å¹¶å‘
      connection-timeout: 3000      # å¿«é€Ÿå¤±è´¥ï¼Œ3ç§’è¶…æ—¶
      
      # æ€§èƒ½ä¼˜åŒ–
      auto-commit: false            # å…³é—­è‡ªåŠ¨æäº¤
      connection-init-sql: SET NAMES utf8mb4  # åˆå§‹åŒ–SQL
```

**ä»£ç ä¼˜åŒ–**ï¼š

```java
@Service
public class SeckillService {
    
    // âœ… ä½¿ç”¨ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œç²¾ç¡®æ§åˆ¶èŒƒå›´
    @Autowired
    private TransactionTemplate transactionTemplate;
    
    public boolean seckill(Long productId, Long userId) {
        
        // éäº‹åŠ¡æ“ä½œï¼šæ£€æŸ¥åº“å­˜ï¼ˆè¯»å–ç¼“å­˜ï¼‰
        if (!checkStock(productId)) {
            return false;
        }
        
        // äº‹åŠ¡æ“ä½œï¼šæ‰£å‡åº“å­˜ + åˆ›å»ºè®¢å•
        return transactionTemplate.execute(status -> {
            try {
                // æ‚²è§‚é”æ‰£å‡åº“å­˜
                int rows = productMapper.decreaseStock(productId);
                if (rows == 0) {
                    throw new RuntimeException("åº“å­˜ä¸è¶³");
                }
                
                // åˆ›å»ºè®¢å•
                orderMapper.createOrder(productId, userId);
                return true;
                
            } catch (Exception e) {
                status.setRollbackOnly();
                return false;
            }
        }); // äº‹åŠ¡ç»“æŸï¼Œè¿æ¥ç«‹å³å½’è¿˜
        
        // éäº‹åŠ¡æ“ä½œï¼šå‘é€MQæ¶ˆæ¯
    }
}
```

**ä¼˜åŒ–è¦ç‚¹**ï¼š
- âœ… äº‹åŠ¡èŒƒå›´æœ€å°åŒ–ï¼ˆåªåŒ…å«æ•°æ®åº“æ“ä½œï¼‰
- âœ… ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®
- âœ… è¿æ¥å¿«é€Ÿè·å–ã€å¿«é€Ÿå½’è¿˜

### 6.2 åœºæ™¯2ï¼šæ‰¹é‡æ•°æ®å¯¼å…¥


**éœ€æ±‚**ï¼š
- å¯¼å…¥10ä¸‡æ¡æ•°æ®
- ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§
- é¿å…è¿æ¥é•¿æ—¶é—´å ç”¨

**âŒ é”™è¯¯åšæ³•**ï¼š

```java
@Transactional
public void importData(List<User> users) {
    // ä¸€ä¸ªäº‹åŠ¡å¤„ç†10ä¸‡æ¡æ•°æ®
    for (User user : users) {
        userMapper.insert(user);
    }
    // è¿æ¥è¢«å ç”¨æ•°åˆ†é’Ÿï¼
}
```

**âœ… æ­£ç¡®åšæ³•**ï¼š

```java
public void importData(List<User> users) {
    int batchSize = 1000; // æ¯æ‰¹1000æ¡
    
    // åˆ†æ‰¹å¤„ç†
    for (int i = 0; i < users.size(); i += batchSize) {
        
        List<User> batch = users.subList(
            i, 
            Math.min(i + batchSize, users.size())
        );
        
        // æ¯æ‰¹ç‹¬ç«‹äº‹åŠ¡
        transactionTemplate.execute(status -> {
            userMapper.batchInsert(batch); // æ‰¹é‡æ’å…¥
            return null;
        }); // äº‹åŠ¡ç»“æŸï¼Œè¿æ¥å½’è¿˜
        
        // é‡Šæ”¾CPUï¼Œé¿å…é˜»å¡
        Thread.sleep(10);
    }
}
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- å•æ¬¡äº‹åŠ¡æ—¶é—´ï¼šä»æ•°åˆ†é’Ÿé™åˆ°æ•°ç§’
- è¿æ¥å ç”¨ï¼šä»é•¿æ—¶é—´ç‹¬å åˆ°åˆ†æ‰¹å¤ç”¨
- ç³»ç»Ÿå½±å“ï¼šå…¶ä»–è¯·æ±‚ä¸å—é˜»å¡

### 6.3 åœºæ™¯3ï¼šå¾®æœåŠ¡æ¶æ„


**åœºæ™¯**ï¼š5ä¸ªå¾®æœåŠ¡å…±äº«ä¸€ä¸ªæ•°æ®åº“

```
æœåŠ¡Aï¼šç”¨æˆ·æœåŠ¡ï¼ˆmaxActive=30ï¼‰
æœåŠ¡Bï¼šè®¢å•æœåŠ¡ï¼ˆmaxActive=50ï¼‰
æœåŠ¡Cï¼šå•†å“æœåŠ¡ï¼ˆmaxActive=20ï¼‰
æœåŠ¡Dï¼šæ”¯ä»˜æœåŠ¡ï¼ˆmaxActive=30ï¼‰
æœåŠ¡Eï¼šç‰©æµæœåŠ¡ï¼ˆmaxActive=20ï¼‰

æ€»è®¡ï¼š30+50+20+30+20 = 150ä¸ªè¿æ¥
```

**æ•°æ®åº“é…ç½®**ï¼š

```sql
-- MySQLé…ç½®
SET GLOBAL max_connections = 200;  -- ç•™50%ä½™é‡

-- æŸ¥çœ‹å½“å‰è¿æ¥
SHOW PROCESSLIST;
```

**è¿æ¥æ± é…ç½®åŸåˆ™**ï¼š

```yaml
# æ ¸å¿ƒæœåŠ¡ï¼ˆè®¢å•ã€æ”¯ä»˜ï¼‰
spring:
  datasource:
    hikari:
      maximum-pool-size: 50

# è¾…åŠ©æœåŠ¡ï¼ˆç‰©æµã€é€šçŸ¥ï¼‰  
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
```

**ğŸ¯ é…ç½®ç­–ç•¥**ï¼š
- æ ¹æ®æœåŠ¡é‡è¦æ€§åˆ†é…è¿æ¥æ•°
- æ ¸å¿ƒæœåŠ¡å¤šåˆ†é…ï¼Œè¾…åŠ©æœåŠ¡å°‘åˆ†é…
- æ€»å’Œä¸è¶…è¿‡æ•°æ®åº“æœ€å¤§è¿æ¥æ•°çš„70%

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¿æ¥æ± æœ¬è´¨ï¼šå¤ç”¨æ•°æ®åº“è¿æ¥ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯
ğŸ”¸ äº‹åŠ¡ä¸è¿æ¥ï¼šä¸€ä¸ªäº‹åŠ¡ç»‘å®šä¸€ä¸ªè¿æ¥ï¼Œé€šè¿‡ThreadLocalä¿è¯
ğŸ”¸ è¿æ¥æ³„éœ²ï¼šè¿æ¥å€Ÿå‡ºæœªå½’è¿˜ï¼Œå¯¼è‡´è¿æ¥æ± è€—å°½
ğŸ”¸ é…ç½®åŸåˆ™ï¼šæ ¹æ®å¹¶å‘é‡ã€æ•°æ®åº“èƒ½åŠ›åˆç†é…ç½®è¿æ¥æ•°
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šå…³æ³¨æ´»è·ƒè¿æ¥ã€ç­‰å¾…çº¿ç¨‹ã€è¶…æ—¶å¼‚å¸¸
```

### 7.2 å…³é”®é…ç½®å‚æ•°é€ŸæŸ¥


| å‚æ•° | **HikariCP** | **Druid** | **å»ºè®®å€¼** | **è¯´æ˜** |
|------|-------------|-----------|-----------|----------|
| **åˆå§‹è¿æ¥æ•°** | `â€”` | `initialSize` | `10` | `å¯åŠ¨æ—¶åˆ›å»ºçš„è¿æ¥æ•°` |
| **æœ€å°ç©ºé—²** | `minimum-idle` | `minIdle` | `10-50` | `ä¿æŒçš„æœ€å°‘ç©ºé—²è¿æ¥` |
| **æœ€å¤§è¿æ¥** | `maximum-pool-size` | `maxActive` | `50-200` | `æ± ä¸­æœ€å¤šçš„è¿æ¥æ•°` |
| **è·å–è¶…æ—¶** | `connection-timeout` | `maxWait` | `30000ms` | `ç­‰å¾…è¿æ¥çš„è¶…æ—¶æ—¶é—´` |
| **ç©ºé—²è¶…æ—¶** | `idle-timeout` | `minEvictableIdleTimeMillis` | `600000ms` | `ç©ºé—²è¿æ¥å›æ”¶æ—¶é—´` |
| **æœ€å¤§å­˜æ´»** | `max-lifetime` | `â€”` | `1800000ms` | `è¿æ¥æœ€é•¿å­˜æ´»æ—¶é—´` |

### 7.3 å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨


| é—®é¢˜ | **ç°è±¡** | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|---------|---------|-------------|
| **è·å–è¿æ¥è¶…æ—¶** | `Connection timeout` | `è¿æ¥æ•°ä¸å¤Ÿ` | `å¢åŠ maxActive` |
| **è¿æ¥æ³„éœ²** | `è¿æ¥æ•°æŒç»­å¢é•¿` | `æœªå½’è¿˜è¿æ¥` | `æ£€æŸ¥äº‹åŠ¡é…ç½®ï¼Œå¼€å¯æ³„éœ²æ£€æµ‹` |
| **é¢‘ç¹åˆ›å»ºè¿æ¥** | `æ€§èƒ½ä¸‹é™` | `minIdleå¤ªå°` | `å¢åŠ minimum-idle` |
| **æ•°æ®åº“è¿æ¥æ»¡** | `Too many connections` | `åº”ç”¨è¿æ¥æ•°>æ•°æ®åº“é™åˆ¶` | `å‡å°‘maxActiveæˆ–å¢åŠ æ•°æ®åº“è¿æ¥æ•°` |
| **é•¿äº‹åŠ¡é˜»å¡** | `å…¶ä»–è¯·æ±‚è¶…æ—¶` | `äº‹åŠ¡èŒƒå›´å¤ªå¤§` | `ç¼©å°äº‹åŠ¡èŒƒå›´ï¼Œåˆ†æ‰¹å¤„ç†` |

### 7.4 æœ€ä½³å®è·µæ¸…å•


**âœ… é…ç½®å±‚é¢**ï¼š
- [ ] æ ¹æ®å¹¶å‘å‹æµ‹ç¡®å®šè¿æ¥æ•°
- [ ] é…ç½®è¿æ¥æ³„éœ²æ£€æµ‹ï¼ˆ60ç§’ï¼‰
- [ ] è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆ30-60ç§’ï¼‰
- [ ] å¼€å¯è¿æ¥æœ‰æ•ˆæ€§æ£€æµ‹
- [ ] é…ç½®ç›‘æ§å’Œå‘Šè­¦

**âœ… ä»£ç å±‚é¢**ï¼š
- [ ] ä¼˜å…ˆä½¿ç”¨Springäº‹åŠ¡ç®¡ç†
- [ ] ç¼©å°äº‹åŠ¡èŒƒå›´ï¼ˆåªåŒ…å«æ•°æ®åº“æ“ä½œï¼‰
- [ ] é¿å…åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
- [ ] æ‰¹é‡æ“ä½œä½¿ç”¨åˆ†æ‰¹å¤„ç†
- [ ] æ˜ç¡®é…ç½®äº‹åŠ¡å›æ»šè§„åˆ™

**âœ… è¿ç»´å±‚é¢**ï¼š
- [ ] å®šæœŸæ£€æŸ¥è¿æ¥æ± ç›‘æ§æŒ‡æ ‡
- [ ] å…³æ³¨æ•°æ®åº“è¿æ¥æ•°è¶‹åŠ¿
- [ ] æ…¢SQLä¼˜åŒ–å’Œç´¢å¼•ä¼˜åŒ–
- [ ] å‹æµ‹éªŒè¯è¿æ¥æ± é…ç½®
- [ ] å»ºç«‹è¿æ¥æ± å¼‚å¸¸å‘Šè­¦

### 7.5 æ ¸å¿ƒè®°å¿†å£è¯€


```
è¿æ¥æ± ç®¡ç†äº‹åŠ¡è¿ï¼Œä¸€äº‹ä¸€è¿çº¿ç¨‹ç»‘
è·å–è¦æ™šé‡Šæ”¾æ—©ï¼Œé•¿äº‹åŠ¡ä¸­æœ€å¿Œè®³
é…ç½®å‚æ•°çœ‹å¹¶å‘ï¼Œç›‘æ§å‘Šè­¦ä¸èƒ½å°‘
æ³„éœ²æ£€æµ‹è¦å¼€å¯ï¼Œè¶…æ—¶è®¾ç½®ä¿ç¨³å®š
HikariCPæ€§èƒ½ä¼˜ï¼ŒDruidç›‘æ§åŠŸèƒ½å…¨
```

---

**ğŸ”— ç›¸å…³ä¸»é¢˜**ï¼š
- äº‹åŠ¡ä¼ æ’­æœºåˆ¶ â†’ ç†è§£è¿æ¥å¦‚ä½•åœ¨æ–¹æ³•é—´ä¼ é€’
- æ•°æ®åº“é”æœºåˆ¶ â†’ ç†è§£è¿æ¥æŒæœ‰æ—¶çš„é”å½±å“
- åˆ†å¸ƒå¼äº‹åŠ¡ â†’ å¤šæ•°æ®æºçš„è¿æ¥æ± ç®¡ç†