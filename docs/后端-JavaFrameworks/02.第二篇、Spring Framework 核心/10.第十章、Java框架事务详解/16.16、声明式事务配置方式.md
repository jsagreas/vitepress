---
title: 16ã€å£°æ˜å¼äº‹åŠ¡é…ç½®æ–¹å¼
---
## ğŸ“š ç›®å½•

1. [é…ç½®æ–¹å¼æ¦‚è¿°](#1-é…ç½®æ–¹å¼æ¦‚è¿°)
2. [æ³¨è§£é…ç½®æ–¹å¼](#2-æ³¨è§£é…ç½®æ–¹å¼)
3. [XMLé…ç½®æ–¹å¼](#3-XMLé…ç½®æ–¹å¼)
4. [JavaConfigé…ç½®æ–¹å¼](#4-JavaConfigé…ç½®æ–¹å¼)
5. [åˆ‡ç‚¹è¡¨è¾¾å¼è¯¦è§£](#5-åˆ‡ç‚¹è¡¨è¾¾å¼è¯¦è§£)
6. [ä¸‰ç§æ–¹å¼å¯¹æ¯”](#6-ä¸‰ç§æ–¹å¼å¯¹æ¯”)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®æ–¹å¼æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å£°æ˜å¼äº‹åŠ¡é…ç½®


**é€šä¿—ç†è§£**ï¼šå°±æ˜¯å‘Šè¯‰Spring"å“ªäº›æ–¹æ³•éœ€è¦äº‹åŠ¡ç®¡ç†ï¼Œæ€ä¹ˆç®¡ç†"çš„è¿‡ç¨‹

```
æƒ³è±¡ä½ æ˜¯é¤å…è€æ¿ï¼š
- ç¼–ç¨‹å¼äº‹åŠ¡ï¼šæ¯ä¸ªæœåŠ¡å‘˜è‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™å¼€å§‹è®°è´¦ã€ç»“è´¦
- å£°æ˜å¼äº‹åŠ¡ï¼šä½ åˆ¶å®šç»Ÿä¸€è§„åˆ™"æ‰€æœ‰æ”¶é“¶æ“ä½œéƒ½è¦å¼€å‘ç¥¨"

å£°æ˜å¼äº‹åŠ¡é…ç½® = åˆ¶å®šè¿™äº›è§„åˆ™çš„æ–¹å¼
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **å£°æ˜ï¼ˆDeclareï¼‰**ï¼šç”¨é…ç½®æ–‡ä»¶æˆ–æ³¨è§£"å£°æ˜"è§„åˆ™ï¼Œä¸ç”¨å†™äº‹åŠ¡ä»£ç 
- **é…ç½®ï¼ˆConfigï¼‰**ï¼šè®¾ç½®äº‹åŠ¡çš„è¡Œä¸ºæ–¹å¼ï¼ˆä¼ æ’­ã€éš”ç¦»çº§åˆ«ç­‰ï¼‰
- **è‡ªåŠ¨åº”ç”¨**ï¼šSpringæ ¹æ®é…ç½®è‡ªåŠ¨ç»™æ–¹æ³•åŠ ä¸Šäº‹åŠ¡ç®¡ç†

### 1.2 ä¸‰ç§ä¸»æµé…ç½®æ–¹å¼


| é…ç½®æ–¹å¼ | éš¾åº¦ç­‰çº§ | é€‚ç”¨åœºæ™¯ | æµè¡Œç¨‹åº¦ |
|---------|---------|---------|---------|
| **ğŸŸ¢ æ³¨è§£é…ç½®** | `ç®€å•` | ç°ä»£Springé¡¹ç›® | â­â­â­â­â­ |
| **ğŸŸ¡ XMLé…ç½®** | `ä¸­ç­‰` | è€é¡¹ç›®ç»´æŠ¤ | â­â­â­ |
| **ğŸŸ¡ JavaConfigé…ç½®** | `ä¸­ç­‰` | çº¯Javaé…ç½®é¡¹ç›® | â­â­â­â­ |

**å‘å±•å†ç¨‹**ï¼š
```
Springæ—©æœŸï¼ˆ2004-2010ï¼‰          Springä¸­æœŸï¼ˆ2010-2016ï¼‰        Springç°ä»£ï¼ˆ2016è‡³ä»Šï¼‰
      â†“                              â†“                            â†“
  XMLé…ç½®ä¸ºä¸»                    XML + æ³¨è§£æ··ç”¨                 æ³¨è§£ + JavaConfigä¸ºä¸»
   ç¹çä½†å¼ºå¤§                      é€æ¸ç®€åŒ–                       ç®€æ´é«˜æ•ˆ
```

---

## 2. ğŸ“ æ³¨è§£é…ç½®æ–¹å¼


### 2.1 æ ¸å¿ƒæ³¨è§£ @Transactional


**ä»€ä¹ˆæ˜¯ @Transactional**ï¼š
- ä¸€ä¸ª"æ ‡è®°"æ³¨è§£ï¼Œå‘Šè¯‰Springè¿™ä¸ªæ–¹æ³•éœ€è¦äº‹åŠ¡
- å¯ä»¥åŠ åœ¨ç±»ä¸Šï¼ˆæ‰€æœ‰æ–¹æ³•éƒ½æœ‰äº‹åŠ¡ï¼‰æˆ–æ–¹æ³•ä¸Šï¼ˆæŒ‡å®šæ–¹æ³•æœ‰äº‹åŠ¡ï¼‰

**åŸºç¡€ä½¿ç”¨**ï¼š

```java
@Service
public class UserService {
    
    @Autowired
    private UserDao userDao;
    
    // âœ… åœ¨æ–¹æ³•ä¸Šæ·»åŠ  @Transactional
    @Transactional
    public void transferMoney(Long fromId, Long toId, BigDecimal amount) {
        // æ‰£æ¬¾
        userDao.deduct(fromId, amount);
        // åŠ æ¬¾
        userDao.add(toId, amount);
        // è¿™ä¸¤æ­¥è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼ˆäº‹åŠ¡ä¿è¯ï¼‰
    }
}
```

### 2.2 æ³¨è§£å‚æ•°è¯¦è§£


**ğŸ”¸ ä¼ æ’­è¡Œä¸ºï¼ˆpropagationï¼‰**

```java
// ä¾‹å­ï¼šè®¢å•æœåŠ¡è°ƒç”¨åº“å­˜æœåŠ¡
@Service
public class OrderService {
    
    @Autowired
    private StockService stockService;
    
    @Transactional(propagation = Propagation.REQUIRED)
    public void createOrder(Order order) {
        // åˆ›å»ºè®¢å•
        orderDao.insert(order);
        
        // è°ƒç”¨åº“å­˜æœåŠ¡ï¼ˆåŠ å…¥å½“å‰äº‹åŠ¡ï¼‰
        stockService.reduceStock(order.getProductId());
    }
}
```

**å¸¸ç”¨ä¼ æ’­è¡Œä¸º**ï¼š

| ä¼ æ’­è¡Œä¸º | è¯´æ˜ | é€šä¿—ç†è§£ |
|---------|------|---------|
| `REQUIRED` | æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æ–°å»º | ğŸš— é¡ºé£è½¦æ¨¡å¼ï¼šæœ‰è½¦å°±ä¸Šï¼Œæ²¡è½¦è‡ªå·±å¼€ |
| `REQUIRES_NEW` | æ€»æ˜¯æ–°å»ºäº‹åŠ¡ | ğŸš• æ‰“è½¦æ¨¡å¼ï¼šæ°¸è¿œç‹¬ç«‹ä¸€è¾†è½¦ |
| `SUPPORTS` | æœ‰äº‹åŠ¡å°±ç”¨ï¼Œæ²¡æœ‰å°±ç®—äº† | ğŸš¶ éšæ„æ¨¡å¼ï¼šæœ‰è½¦åè½¦ï¼Œæ²¡è½¦èµ°è·¯ |

**ğŸ”¸ éš”ç¦»çº§åˆ«ï¼ˆisolationï¼‰**

```java
@Transactional(isolation = Isolation.READ_COMMITTED)
public User getUserById(Long id) {
    return userDao.findById(id);
    // READ_COMMITTEDï¼šåªèƒ½è¯»åˆ°å·²æäº¤çš„æ•°æ®
}
```

**ğŸ”¸ è¶…æ—¶è®¾ç½®ï¼ˆtimeoutï¼‰**

```java
@Transactional(timeout = 30) // 30ç§’è¶…æ—¶
public void batchProcess() {
    // å¦‚æœ30ç§’å†…æ²¡å®Œæˆï¼Œè‡ªåŠ¨å›æ»š
}
```

**ğŸ”¸ åªè¯»ä¼˜åŒ–ï¼ˆreadOnlyï¼‰**

```java
@Transactional(readOnly = true) // åªæŸ¥è¯¢ï¼Œä¸ä¿®æ”¹
public List<User> listUsers() {
    return userDao.findAll();
    // Springå¯ä»¥åšä¼˜åŒ–ï¼Œæå‡æ€§èƒ½
}
```

### 2.3 å¼€å¯æ³¨è§£äº‹åŠ¡


**ğŸ”§ éœ€è¦åœ¨é…ç½®ç±»ä¸Šæ·»åŠ  @EnableTransactionManagement**

```java
@Configuration
@EnableTransactionManagement // â­ å¼€å¯äº‹åŠ¡æ³¨è§£æ”¯æŒ
public class AppConfig {
    
    @Bean
    public DataSource dataSource() {
        // é…ç½®æ•°æ®æº
    }
    
    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());
    }
}
```

**å®Œæ•´æµç¨‹å›¾ç¤º**ï¼š

```
å¼€å¯äº‹åŠ¡æ³¨è§£çš„æ­¥éª¤ï¼š

1ï¸âƒ£ é…ç½®æ•°æ®æºï¼ˆDataSourceï¼‰
          â†“
2ï¸âƒ£ é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransactionManagerï¼‰
          â†“
3ï¸âƒ£ æ·»åŠ  @EnableTransactionManagement
          â†“
4ï¸âƒ£ åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ @Transactional
          â†“
5ï¸âƒ£ Springè‡ªåŠ¨ä»£ç†ï¼Œäº‹åŠ¡ç”Ÿæ•ˆ âœ…
```

---

## 3. ğŸ“„ XMLé…ç½®æ–¹å¼


### 3.1 tx:advice äº‹åŠ¡é€šçŸ¥


**ä»€ä¹ˆæ˜¯äº‹åŠ¡é€šçŸ¥**ï¼š
- **é€šçŸ¥ï¼ˆAdviceï¼‰**ï¼šAOPæœ¯è¯­ï¼Œè¡¨ç¤º"è¦åšçš„äº‹æƒ…"
- **äº‹åŠ¡é€šçŸ¥**ï¼šå°±æ˜¯"ç»™æ–¹æ³•åŠ äº‹åŠ¡"è¿™ä¸ªæ“ä½œ
- **tx:advice**ï¼šåœ¨XMLä¸­å®šä¹‰äº‹åŠ¡è§„åˆ™çš„æ ‡ç­¾

**åŸºç¡€é…ç½®**ï¼š

```xml
<!-- 1ï¸âƒ£ é…ç½®äº‹åŠ¡ç®¡ç†å™¨ -->
<bean id="transactionManager" 
      class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <property name="dataSource" ref="dataSource"/>
</bean>

<!-- 2ï¸âƒ£ é…ç½®äº‹åŠ¡é€šçŸ¥ï¼ˆå®šä¹‰äº‹åŠ¡è§„åˆ™ï¼‰ -->
<tx:advice id="txAdvice" transaction-manager="transactionManager">
    <tx:attributes>
        <!-- transferå¼€å¤´çš„æ–¹æ³•ï¼šéœ€è¦äº‹åŠ¡ï¼Œè¯»å†™æ“ä½œ -->
        <tx:method name="transfer*" propagation="REQUIRED"/>
        
        <!-- findå¼€å¤´çš„æ–¹æ³•ï¼šåªè¯»äº‹åŠ¡ -->
        <tx:method name="find*" read-only="true"/>
        
        <!-- getå¼€å¤´çš„æ–¹æ³•ï¼šåªè¯»äº‹åŠ¡ -->
        <tx:method name="get*" read-only="true"/>
        
        <!-- å…¶ä»–æ–¹æ³•ï¼šéœ€è¦äº‹åŠ¡ -->
        <tx:method name="*" propagation="REQUIRED"/>
    </tx:attributes>
</tx:advice>
```

**é€šä¿—è§£é‡Š**ï¼š
```
tx:advice å°±åƒä¸€ä»½"äº‹åŠ¡æ“ä½œæ‰‹å†Œ"

æ‰‹å†Œå†…å®¹ï¼š
- transferå¼€å¤´çš„æ–¹æ³• â†’ å¼€å¯å®Œæ•´äº‹åŠ¡
- findå¼€å¤´çš„æ–¹æ³• â†’ åªè¯»æ¨¡å¼ï¼ˆæŸ¥è¯¢ä¼˜åŒ–ï¼‰
- getå¼€å¤´çš„æ–¹æ³• â†’ åªè¯»æ¨¡å¼
- å…¶ä»–æ–¹æ³• â†’ é»˜è®¤éœ€è¦äº‹åŠ¡
```

### 3.2 aop:advisor åˆ‡é¢é…ç½®


**ä»€ä¹ˆæ˜¯åˆ‡é¢é…ç½®**ï¼š
- **åˆ‡é¢ï¼ˆAspectï¼‰**ï¼šæŠŠ"äº‹åŠ¡é€šçŸ¥"åº”ç”¨åˆ°"å“ªäº›æ–¹æ³•"ä¸Š
- **aop:advisor**ï¼šè¿æ¥"äº‹åŠ¡é€šçŸ¥"å’Œ"åˆ‡ç‚¹è¡¨è¾¾å¼"

```xml
<!-- 3ï¸âƒ£ é…ç½®åˆ‡é¢ï¼šæŠŠäº‹åŠ¡é€šçŸ¥åº”ç”¨åˆ°å…·ä½“æ–¹æ³•ä¸Š -->
<aop:config>
    <!-- pointcutï¼šåˆ‡ç‚¹ï¼Œè¡¨ç¤º"å“ªäº›æ–¹æ³•" -->
    <!-- advice-refï¼šå¼•ç”¨äº‹åŠ¡é€šçŸ¥ -->
    <aop:advisor advice-ref="txAdvice" 
                 pointcut="execution(* com.example.service.*.*(..))"/>
</aop:config>
```

**å·¥ä½œæµç¨‹å›¾ç¤º**ï¼š

```
XMLäº‹åŠ¡é…ç½®å·¥ä½œæµç¨‹ï¼š

TransactionManager         tx:advice              aop:advisor
    (äº‹åŠ¡ç®¡ç†å™¨)    â†’    (å®šä¹‰äº‹åŠ¡è§„åˆ™)    â†’    (åº”ç”¨åˆ°æ–¹æ³•)
         â†“                    â†“                      â†“
   è°æ¥ç®¡ç†äº‹åŠ¡ï¼Ÿ          æ€ä¹ˆç®¡ç†äº‹åŠ¡ï¼Ÿ          ç®¡ç†å“ªäº›æ–¹æ³•ï¼Ÿ
```

### 3.3 å®Œæ•´XMLé…ç½®ç¤ºä¾‹


```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:aop="http://www.springframework.org/schema/aop">

    <!-- æ•°æ®æº -->
    <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">
        <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
        <property name="jdbcUrl" value="jdbc:mysql://localhost:3306/test"/>
    </bean>

    <!-- äº‹åŠ¡ç®¡ç†å™¨ -->
    <bean id="transactionManager" 
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <!-- äº‹åŠ¡é€šçŸ¥ -->
    <tx:advice id="txAdvice" transaction-manager="transactionManager">
        <tx:attributes>
            <tx:method name="transfer*" propagation="REQUIRED" isolation="DEFAULT"/>
            <tx:method name="save*" propagation="REQUIRED"/>
            <tx:method name="update*" propagation="REQUIRED"/>
            <tx:method name="delete*" propagation="REQUIRED"/>
            <tx:method name="find*" read-only="true"/>
            <tx:method name="get*" read-only="true"/>
        </tx:attributes>
    </tx:advice>

    <!-- AOPé…ç½® -->
    <aop:config>
        <aop:advisor advice-ref="txAdvice"
                     pointcut="execution(* com.example.service.*.*(..))"/>
    </aop:config>

</beans>
```

---

## 4. â˜• JavaConfigé…ç½®æ–¹å¼


### 4.1 ä»€ä¹ˆæ˜¯JavaConfig


**é€šä¿—ç†è§£**ï¼šç”¨çº¯Javaä»£ç ä»£æ›¿XMLé…ç½®

```
XMLé…ç½®æ–¹å¼ï¼š             JavaConfigæ–¹å¼ï¼š
ç”¨<bean>æ ‡ç­¾    â†’        ç”¨@Beanæ³¨è§£
å†™åœ¨.xmlæ–‡ä»¶    â†’        å†™åœ¨.javaæ–‡ä»¶
éœ€è¦å­¦XMLè¯­æ³•   â†’        åªéœ€è¦Javaè¯­æ³•
```

### 4.2 åŸºç¡€JavaConfigé…ç½®


```java
@Configuration // å£°æ˜è¿™æ˜¯é…ç½®ç±»
@EnableTransactionManagement // å¼€å¯äº‹åŠ¡æ”¯æŒ
public class TransactionConfig {
    
    // 1ï¸âƒ£ é…ç½®æ•°æ®æº
    @Bean
    public DataSource dataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setDriverClassName("com.mysql.jdbc.Driver");
        dataSource.setJdbcUrl("jdbc:mysql://localhost:3306/test");
        dataSource.setUsername("root");
        dataSource.setPassword("123456");
        return dataSource;
    }
    
    // 2ï¸âƒ£ é…ç½®äº‹åŠ¡ç®¡ç†å™¨
    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());
    }
}
```

### 4.3 ç¼–ç¨‹å¼AOPé…ç½®ï¼ˆé«˜çº§ï¼‰


**å½“éœ€è¦æ›´ç»†ç²’åº¦æ§åˆ¶æ—¶**ï¼š

```java
@Configuration
@EnableTransactionManagement
public class TransactionConfig {
    
    @Bean
    public DataSource dataSource() {
        // ... æ•°æ®æºé…ç½®
    }
    
    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());
    }
    
    // è‡ªå®šä¹‰äº‹åŠ¡æ‹¦æˆªå™¨
    @Bean
    public TransactionInterceptor transactionInterceptor() {
        // å®šä¹‰äº‹åŠ¡å±æ€§
        NameMatchTransactionAttributeSource source = 
            new NameMatchTransactionAttributeSource();
        
        // transferå¼€å¤´æ–¹æ³•çš„äº‹åŠ¡å±æ€§
        RuleBasedTransactionAttribute transferAttr = 
            new RuleBasedTransactionAttribute();
        transferAttr.setPropagationBehavior(
            TransactionDefinition.PROPAGATION_REQUIRED);
        source.addTransactionalMethod("transfer*", transferAttr);
        
        // findå¼€å¤´æ–¹æ³•çš„äº‹åŠ¡å±æ€§
        RuleBasedTransactionAttribute findAttr = 
            new RuleBasedTransactionAttribute();
        findAttr.setReadOnly(true);
        source.addTransactionalMethod("find*", findAttr);
        
        return new TransactionInterceptor(transactionManager(), source);
    }
    
    // AOPé…ç½®
    @Bean
    public Advisor transactionAdvisor() {
        AspectJExpressionPointcut pointcut = 
            new AspectJExpressionPointcut();
        pointcut.setExpression("execution(* com.example.service.*.*(..))");
        
        return new DefaultPointcutAdvisor(pointcut, transactionInterceptor());
    }
}
```

---

## 5. ğŸ¯ åˆ‡ç‚¹è¡¨è¾¾å¼è¯¦è§£


### 5.1 ä»€ä¹ˆæ˜¯åˆ‡ç‚¹è¡¨è¾¾å¼


**é€šä¿—ç†è§£**ï¼šå‘Šè¯‰Spring"äº‹åŠ¡è¦åŠ åœ¨å“ªäº›æ–¹æ³•ä¸Š"çš„è§„åˆ™

```
æƒ³è±¡ä½ æ˜¯ç‰©ä¸šç®¡ç†ï¼š
- "æ‰€æœ‰ä½æˆ·éƒ½è¦äº¤ç‰©ä¸šè´¹" â†’ è¿™æ˜¯ä¸€æ¡è§„åˆ™
- åˆ‡ç‚¹è¡¨è¾¾å¼å°±æ˜¯å®šä¹‰"æ‰€æœ‰ä½æˆ·"çš„èŒƒå›´

execution(* com.example.service.*.*(..))
    â†‘
  è¿™å°±æ˜¯åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºserviceåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•
```

### 5.2 è¡¨è¾¾å¼è¯­æ³•ç»“æ„


```
execution(ä¿®é¥°ç¬¦? è¿”å›ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°) å¼‚å¸¸?)

å®Œæ•´æ ¼å¼ï¼š
execution(public String com.example.service.UserService.getUser(Long))

é€šé…ç¬¦ï¼š
* : åŒ¹é…ä»»æ„å­—ç¬¦
.. : åŒ¹é…ä»»æ„å‚æ•°æˆ–ä»»æ„å±‚çº§åŒ…
```

### 5.3 å¸¸ç”¨è¡¨è¾¾å¼ç¤ºä¾‹


**ğŸ”¸ ç²¾ç¡®åŒ¹é…**

```java
// åªåŒ¹é… UserService çš„ transferMoney æ–¹æ³•
execution(* com.example.service.UserService.transferMoney(..))

                è¿”å›ç±»å‹ä»»æ„  â†‘        ç±»å        â†‘  æ–¹æ³•å    â†‘ å‚æ•°ä»»æ„
```

**ğŸ”¸ åŒ…çº§åˆ«åŒ¹é…**

```java
// serviceåŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•
execution(* com.example.service.*.*(..))

// serviceåŒ…åŠå­åŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•
execution(* com.example.service..*.*(..))
              åŒ…å      â†‘      ç±»å  æ–¹æ³•
                       ..è¡¨ç¤ºåŒ…æ‹¬å­åŒ…
```

**ğŸ”¸ æ–¹æ³•ååŒ¹é…**

```java
// æ‰€æœ‰saveå¼€å¤´çš„æ–¹æ³•
execution(* com.example.service.*.*save*(..))

// æ‰€æœ‰getå¼€å¤´çš„æ–¹æ³•
execution(* com.example.service.*.*get*(..))

// æ‰€æœ‰transferå¼€å¤´çš„æ–¹æ³•
execution(* com.example.service.*.*transfer*(..))
```

**ğŸ”¸ å‚æ•°åŒ¹é…**

```java
// æ— å‚æ–¹æ³•
execution(* com.example.service.*.*()")

// ä¸€ä¸ªLongç±»å‹å‚æ•°çš„æ–¹æ³•
execution(* com.example.service.*.*(Long))

// ä»»æ„å‚æ•°çš„æ–¹æ³•
execution(* com.example.service.*.*(..))
```

### 5.4 è¡¨è¾¾å¼ç»„åˆ


```java
// âœ… ä½¿ç”¨ && ç»„åˆæ¡ä»¶
execution(* com.example.service.*.*(..)) && !execution(* com.example.service.*.get*(..))
    â†‘ serviceåŒ…æ‰€æœ‰æ–¹æ³•                      â†‘ æ’é™¤getå¼€å¤´çš„æ–¹æ³•

// âœ… ä½¿ç”¨ || ç»„åˆæ¡ä»¶
execution(* com.example.service.*.save*(..)) || execution(* com.example.service.*.update*(..))
    â†‘ saveå¼€å¤´çš„æ–¹æ³•                            â†‘ updateå¼€å¤´çš„æ–¹æ³•
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```xml
<aop:config>
    <!-- åªç»™å†™æ“ä½œåŠ äº‹åŠ¡ -->
    <aop:advisor advice-ref="txAdvice"
                 pointcut="execution(* com.example.service.*.save*(..)) ||
                           execution(* com.example.service.*.update*(..)) ||
                           execution(* com.example.service.*.delete*(..))"/>
</aop:config>
```

---

## 6. âš–ï¸ ä¸‰ç§æ–¹å¼å¯¹æ¯”


### 6.1 é…ç½®å¤æ‚åº¦å¯¹æ¯”


| é…ç½®æ–¹å¼ | é…ç½®å¤æ‚åº¦ | å­¦ä¹ æˆæœ¬ | çµæ´»æ€§ |
|---------|-----------|---------|--------|
| **æ³¨è§£é…ç½®** | â­ æœ€ç®€å• | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ç­‰ |
| **XMLé…ç½®** | â­â­â­ å¤æ‚ | ğŸ”´ é«˜ | ğŸŸ¢ çµæ´» |
| **JavaConfig** | â­â­ ä¸­ç­‰ | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ çµæ´» |

### 6.2 ä½¿ç”¨åœºæ™¯å¯¹æ¯”


```
ğŸ“Œ æ³¨è§£é…ç½® - æ¨èä½¿ç”¨
é€‚åˆï¼š
âœ… æ–°é¡¹ç›®å¼€å‘
âœ… å•ä¸ªæ–¹æ³•éœ€è¦ç‰¹æ®Šäº‹åŠ¡é…ç½®
âœ… å¿«é€Ÿå¼€å‘ï¼Œé…ç½®ç®€å•

ç¤ºä¾‹ï¼š
@Transactional
public void transferMoney() { }

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Œ XMLé…ç½® - è€é¡¹ç›®ç»´æŠ¤
é€‚åˆï¼š
âœ… è€é¡¹ç›®ç»´æŠ¤
âœ… ç»Ÿä¸€ç®¡ç†å¤§é‡æ–¹æ³•çš„äº‹åŠ¡
âœ… ä¸æƒ³ä¿®æ”¹Javaä»£ç 

ç¤ºä¾‹ï¼š
<tx:advice>
    <tx:method name="transfer*"/>
</tx:advice>

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Œ JavaConfig - çº¯Javaé…ç½®
é€‚åˆï¼š
âœ… ä¸ä½¿ç”¨XMLçš„é¡¹ç›®
âœ… éœ€è¦ç¼–ç¨‹å¼é…ç½®äº‹åŠ¡
âœ… Spring Booté¡¹ç›®

ç¤ºä¾‹ï¼š
@Bean
public TransactionInterceptor interceptor() { }
```

### 6.3 ä¼˜ç¼ºç‚¹æ€»ç»“


**ğŸŸ¢ æ³¨è§£é…ç½®**

```
ä¼˜ç‚¹ï¼š
âœ… ç®€å•ç›´è§‚ï¼Œé…ç½®å’Œä»£ç åœ¨ä¸€èµ·
âœ… å­¦ä¹ æˆæœ¬ä½ï¼Œæ–°æ‰‹å‹å¥½
âœ… Spring Booté»˜è®¤æ–¹å¼

ç¼ºç‚¹ï¼š
âŒ åˆ†æ•£åœ¨å„ä¸ªç±»ä¸­ï¼Œä¸ä¾¿ç»Ÿä¸€ç®¡ç†
âŒ ä¿®æ”¹é…ç½®éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç 
```

**ğŸŸ¡ XMLé…ç½®**

```
ä¼˜ç‚¹ï¼š
âœ… é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»Ÿä¸€é…ç½®
âœ… ä¿®æ”¹æ— éœ€é‡æ–°ç¼–è¯‘
âœ… å¯ä»¥ç”¨é€šé…ç¬¦æ‰¹é‡é…ç½®

ç¼ºç‚¹ï¼š
âŒ é…ç½®ç¹çï¼ŒXMLè¯­æ³•å¤æ‚
âŒ å’Œä»£ç åˆ†ç¦»ï¼Œç»´æŠ¤å›°éš¾
âŒ Springæ–°ç‰ˆæœ¬ä¸æ¨è
```

**ğŸŸ¡ JavaConfigé…ç½®**

```
ä¼˜ç‚¹ï¼š
âœ… çº¯Javaè¯­æ³•ï¼Œç±»å‹å®‰å…¨
âœ… å¯ä»¥ç¼–ç¨‹æ§åˆ¶é…ç½®é€»è¾‘
âœ… æ˜“äºæµ‹è¯•å’Œé‡æ„

ç¼ºç‚¹ï¼š
âŒ ä»£ç é‡æ¯”æ³¨è§£å¤š
âŒ éœ€è¦ç†è§£AOPæ¦‚å¿µ
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ å£°æ˜å¼äº‹åŠ¡é…ç½®ï¼šå‘Šè¯‰Springå“ªäº›æ–¹æ³•éœ€è¦äº‹åŠ¡ï¼Œæ€ä¹ˆç®¡ç†
ğŸ”¸ @Transactionalï¼šæœ€å¸¸ç”¨çš„äº‹åŠ¡æ³¨è§£ï¼ŒåŠ åœ¨æ–¹æ³•æˆ–ç±»ä¸Š
ğŸ”¸ tx:adviceï¼šXMLæ–¹å¼å®šä¹‰äº‹åŠ¡è§„åˆ™
ğŸ”¸ aop:advisorï¼šXMLæ–¹å¼åº”ç”¨äº‹åŠ¡åˆ°æ–¹æ³•
ğŸ”¸ åˆ‡ç‚¹è¡¨è¾¾å¼ï¼šå®šä¹‰äº‹åŠ¡ä½œç”¨çš„æ–¹æ³•èŒƒå›´
```

### 7.2 ä¸‰ç§é…ç½®æ–¹å¼é€Ÿè®°


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æ³¨è§£é…ç½®ï¼ˆæ¨èæ–°é¡¹ç›®ï¼‰           â”‚
â”‚  @Transactional + @EnableTransactionMgmt â”‚
â”‚         ç®€å• | å¿«é€Ÿ | ç°ä»£åŒ–              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           XMLé…ç½®ï¼ˆè€é¡¹ç›®ç»´æŠ¤ï¼‰           â”‚
â”‚     tx:advice + aop:advisor             â”‚
â”‚         é›†ä¸­ | çµæ´» | ä¼ ç»Ÿæ–¹å¼            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        JavaConfigï¼ˆçº¯Javaé…ç½®ï¼‰          â”‚
â”‚  @Bean + TransactionInterceptor         â”‚
â”‚      ç±»å‹å®‰å…¨ | ç¼–ç¨‹æ§åˆ¶ | ç°ä»£åŒ–          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 åˆ‡ç‚¹è¡¨è¾¾å¼å¿«é€Ÿå‚è€ƒ


| è¡¨è¾¾å¼ | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|--------|------|---------|
| `execution(* com.example.service.*.*(..))` | serviceåŒ…æ‰€æœ‰æ–¹æ³• | å…¨å±€äº‹åŠ¡ |
| `execution(* *..*Service.*(..))` | æ‰€æœ‰Serviceç±»æ–¹æ³• | æŒ‰å‘½åè§„èŒƒ |
| `execution(* *..save*(..))` | æ‰€æœ‰saveå¼€å¤´æ–¹æ³• | å†™æ“ä½œäº‹åŠ¡ |
| `execution(* *..get*(..))` | æ‰€æœ‰getå¼€å¤´æ–¹æ³• | åªè¯»äº‹åŠ¡ |

### 7.4 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ æ–°é¡¹ç›®æ¨èé…ç½®**

```java
// 1ï¸âƒ£ é…ç½®ç±»å¼€å¯äº‹åŠ¡
@Configuration
@EnableTransactionManagement
public class AppConfig {
    @Bean
    public PlatformTransactionManager txManager() {
        return new DataSourceTransactionManager(dataSource());
    }
}

// 2ï¸âƒ£ Serviceå±‚ä½¿ç”¨æ³¨è§£
@Service
public class UserService {
    
    @Transactional(rollbackFor = Exception.class)
    public void transfer(Long from, Long to, BigDecimal amount) {
        // ä¸šåŠ¡é€»è¾‘
    }
    
    @Transactional(readOnly = true)
    public User getUser(Long id) {
        return userDao.findById(id);
    }
}
```

**âš ï¸ å¸¸è§é…ç½®è¯¯åŒº**

```
âŒ é”™è¯¯1ï¼šå¿˜è®°å¼€å¯äº‹åŠ¡æ”¯æŒ
è§£å†³ï¼šæ·»åŠ  @EnableTransactionManagement

âŒ é”™è¯¯2ï¼šå†…éƒ¨æ–¹æ³•è°ƒç”¨äº‹åŠ¡ä¸ç”Ÿæ•ˆ
åŸå› ï¼šSpring AOPæ˜¯ä»£ç†æ¨¡å¼ï¼Œå†…éƒ¨è°ƒç”¨ä¸èµ°ä»£ç†
è§£å†³ï¼šé€šè¿‡æ³¨å…¥è‡ªå·±æˆ–ä½¿ç”¨ç¼–ç¨‹å¼äº‹åŠ¡

âŒ é”™è¯¯3ï¼šå¼‚å¸¸è¢«æ•è·å¯¼è‡´ä¸å›æ»š
è§£å†³ï¼šé…ç½® rollbackFor = Exception.class

âŒ é”™è¯¯4ï¼šåˆ‡ç‚¹è¡¨è¾¾å¼å†™é”™
è§£å†³ï¼šä½¿ç”¨IDEçš„è¡¨è¾¾å¼éªŒè¯å·¥å…·
```

### 7.5 å­¦ä¹ è·¯å¾„å»ºè®®


```
ç¬¬1æ­¥ï¼šæŒæ¡æ³¨è§£é…ç½®
      â”œâ”€ @TransactionalåŸºç¡€ç”¨æ³•
      â”œâ”€ ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«
      â””â”€ @EnableTransactionManagement

ç¬¬2æ­¥ï¼šç†è§£XMLé…ç½®ï¼ˆé€‰å­¦ï¼‰
      â”œâ”€ tx:adviceäº‹åŠ¡é€šçŸ¥
      â”œâ”€ aop:advisoråˆ‡é¢é…ç½®
      â””â”€ åˆ‡ç‚¹è¡¨è¾¾å¼è¯­æ³•

ç¬¬3æ­¥ï¼šäº†è§£JavaConfigï¼ˆè¿›é˜¶ï¼‰
      â”œâ”€ ç¼–ç¨‹å¼é…ç½®
      â””â”€ è‡ªå®šä¹‰æ‹¦æˆªå™¨

å®æˆ˜ç»ƒä¹ ï¼š
âœ… ç”¨æ³¨è§£å®ç°è½¬è´¦åŠŸèƒ½
âœ… ç”¨XMLç»Ÿä¸€é…ç½®Serviceå±‚äº‹åŠ¡
âœ… ç†è§£ä¸‰ç§æ–¹å¼çš„é€‚ç”¨åœºæ™¯
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ³¨è§£é…ç½®æœ€ç®€å•ï¼ŒåŠ ä¸ª`@Transactional`å°±è¡Œ
- XMLé…ç½®å¾ˆçµæ´»ï¼Œ`tx:advice`å®šè§„åˆ™ï¼Œ`aop:advisor`æ¥åº”ç”¨
- JavaConfigçº¯ä»£ç ï¼Œç±»å‹å®‰å…¨æ˜“æµ‹è¯•
- åˆ‡ç‚¹è¡¨è¾¾å¼å®šèŒƒå›´ï¼Œ`execution`æ˜¯å…³é”®