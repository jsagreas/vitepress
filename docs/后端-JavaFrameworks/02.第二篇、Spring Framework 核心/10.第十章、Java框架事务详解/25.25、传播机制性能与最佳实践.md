---
title: 25ã€ä¼ æ’­æœºåˆ¶æ€§èƒ½ä¸æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [ä¼ æ’­æœºåˆ¶çš„æ€§èƒ½å½±å“](#1-ä¼ æ’­æœºåˆ¶çš„æ€§èƒ½å½±å“)
2. [å„ä¼ æ’­è¡Œä¸ºæ€§èƒ½å¯¹æ¯”](#2-å„ä¼ æ’­è¡Œä¸ºæ€§èƒ½å¯¹æ¯”)
3. [äº‹åŠ¡è¾¹ç•Œè®¾è®¡åŸåˆ™](#3-äº‹åŠ¡è¾¹ç•Œè®¾è®¡åŸåˆ™)
4. [å¸¸è§æ€§èƒ½é™·é˜±ä¸è§£å†³](#4-å¸¸è§æ€§èƒ½é™·é˜±ä¸è§£å†³)
5. [æœ€ä½³å®è·µæŒ‡å—](#5-æœ€ä½³å®è·µæŒ‡å—)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä¼ æ’­æœºåˆ¶çš„æ€§èƒ½å½±å“


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡å¼€é”€


**ç®€å•ç†è§£**ï¼šäº‹åŠ¡å°±åƒç»™æ•°æ®åº“æ“ä½œåŠ ä¸Š"ä¿æŠ¤ç½©"ï¼Œè™½ç„¶å®‰å…¨ä½†ä¼šæ¶ˆè€—èµ„æºã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
æ— äº‹åŠ¡ â†’ ç›´æ¥ä¹°ä¸œè¥¿ä»˜é’±èµ°äººï¼ˆå¿«ï¼‰
æœ‰äº‹åŠ¡ â†’ ä¹°ä¸œè¥¿å‰å…ˆé¢„å®šã€ç¡®è®¤ã€ä»˜æ¬¾ã€å¼€ç¥¨ã€è®°è´¦ï¼ˆæ…¢ä½†å®‰å…¨ï¼‰
```

**ğŸ”¸ ä¸»è¦æ€§èƒ½å¼€é”€æ¥æº**

| å¼€é”€ç±»å‹ | å…·ä½“è¡¨ç° | å½±å“ç¨‹åº¦ |
|---------|---------|---------|
| **æ•°æ®åº“è¿æ¥** | å»ºç«‹å’Œç»´æŠ¤è¿æ¥ | â­â­â­â­â­ å¾ˆé«˜ |
| **é”èµ„æº** | è¡Œé”ã€è¡¨é”å ç”¨ | â­â­â­â­â˜† è¾ƒé«˜ |
| **æ—¥å¿—å†™å…¥** | undo/redoæ—¥å¿— | â­â­â­â˜†â˜† ä¸­ç­‰ |
| **å†…å­˜ä½¿ç”¨** | ç¼“å­˜å›æ»šæ®µ | â­â­â˜†â˜†â˜† è¾ƒä½ |

### 1.2 ä¼ æ’­è¡Œä¸ºå¦‚ä½•å½±å“æ€§èƒ½


**æ ¸å¿ƒåŸç†**ï¼šä¸åŒä¼ æ’­è¡Œä¸ºåˆ›å»ºäº‹åŠ¡çš„æ–¹å¼ä¸åŒï¼Œå¼€é”€è‡ªç„¶ä¸åŒã€‚

```
æ€§èƒ½å½±å“é“¾è·¯ï¼š
ä¼ æ’­è¡Œä¸º â†’ äº‹åŠ¡åˆ›å»ºæ•°é‡ â†’ æ•°æ®åº“è¿æ¥æ•° â†’ é”ç«äº‰ â†’ æ•´ä½“æ€§èƒ½
```

**ğŸ”¹ ä¸‰ç§å…¸å‹åœºæ™¯å¯¹æ¯”**

**åœºæ™¯1ï¼šä½¿ç”¨REQUIREDï¼ˆé»˜è®¤ï¼‰**
```
å¤–å±‚æ–¹æ³•A â†’ åˆ›å»ºäº‹åŠ¡1
  â†“
å†…å±‚æ–¹æ³•B â†’ åŠ å…¥äº‹åŠ¡1ï¼ˆå…±ç”¨ï¼‰
  â†“
å†…å±‚æ–¹æ³•C â†’ åŠ å…¥äº‹åŠ¡1ï¼ˆå…±ç”¨ï¼‰

æ€»äº‹åŠ¡æ•°ï¼š1ä¸ª
æ€§èƒ½ï¼šâ­â­â­â­â­ æœ€ä¼˜
```

**åœºæ™¯2ï¼šä½¿ç”¨REQUIRES_NEW**
```
å¤–å±‚æ–¹æ³•A â†’ åˆ›å»ºäº‹åŠ¡1
  â†“
å†…å±‚æ–¹æ³•B â†’ æš‚åœäº‹åŠ¡1ï¼Œåˆ›å»ºäº‹åŠ¡2
  â†“
å†…å±‚æ–¹æ³•C â†’ æš‚åœäº‹åŠ¡1ï¼Œåˆ›å»ºäº‹åŠ¡3

æ€»äº‹åŠ¡æ•°ï¼š3ä¸ª
æ€§èƒ½ï¼šâ­â­â­â˜†â˜† ä¸€èˆ¬ï¼ˆäº‹åŠ¡åˆ‡æ¢å¼€é”€å¤§ï¼‰
```

**åœºæ™¯3ï¼šè¿‡åº¦åµŒå¥—**
```
æ–¹æ³•1 â†’ äº‹åŠ¡1
  æ–¹æ³•2 â†’ äº‹åŠ¡2
    æ–¹æ³•3 â†’ äº‹åŠ¡3
      æ–¹æ³•4 â†’ äº‹åŠ¡4
        æ–¹æ³•5 â†’ äº‹åŠ¡5

æ€»äº‹åŠ¡æ•°ï¼š5ä¸ªåµŒå¥—
æ€§èƒ½ï¼šâ­â˜†â˜†â˜†â˜† å¾ˆå·®ï¼ˆæ­»é”é£é™©é«˜ï¼‰
```

---

## 2. âš–ï¸ å„ä¼ æ’­è¡Œä¸ºæ€§èƒ½å¯¹æ¯”


### 2.1 æ€§èƒ½æ’è¡Œæ¦œ


**ğŸ† ä»å¿«åˆ°æ…¢æ’åº**

```
æ€§èƒ½æ’åï¼ˆç›¸åŒåœºæ™¯ä¸‹ï¼‰ï¼š

ğŸ¥‡ ç¬¬1åï¼šREQUIREDï¼ˆé»˜è®¤ï¼‰
   - å¤ç”¨ç°æœ‰äº‹åŠ¡ï¼Œæ— é¢å¤–å¼€é”€
   - é€‚ç”¨ï¼š90%çš„ä¸šåŠ¡åœºæ™¯

ğŸ¥ˆ ç¬¬2åï¼šSUPPORTS
   - æ— äº‹åŠ¡æ—¶ä¸åˆ›å»ºï¼Œå¼€é”€ä¸º0
   - é€‚ç”¨ï¼šæŸ¥è¯¢æ“ä½œ

ğŸ¥‰ ç¬¬3åï¼šMANDATORY
   - å¼ºåˆ¶å¿…é¡»æœ‰äº‹åŠ¡ï¼Œæ— åˆ›å»ºå¼€é”€
   - é€‚ç”¨ï¼šå†…éƒ¨æ–¹æ³•è°ƒç”¨

ğŸ“Š ç¬¬4åï¼šNOT_SUPPORTED
   - æš‚åœäº‹åŠ¡ï¼Œæ¢å¤æœ‰å¼€é”€
   - é€‚ç”¨ï¼šè€—æ—¶æŸ¥è¯¢

âš ï¸ ç¬¬5åï¼šREQUIRES_NEW
   - åˆ›å»ºæ–°äº‹åŠ¡ï¼Œå¼€é”€æœ€å¤§
   - é€‚ç”¨ï¼šæ—¥å¿—è®°å½•

ğŸš« ç¬¬6åï¼šNESTEDï¼ˆMySQLä¸æ”¯æŒï¼‰
   - åµŒå¥—äº‹åŠ¡ï¼Œå®ç°å¤æ‚
```

### 2.2 è¯¦ç»†æ€§èƒ½åˆ†æ


**ğŸ”¸ REQUIREDæ€§èƒ½ç‰¹ç‚¹**

```
ä¼˜åŠ¿ï¼š
âœ… äº‹åŠ¡å¤ç”¨ï¼Œä¸åˆ›å»ºæ–°è¿æ¥
âœ… å‡å°‘æ•°æ®åº“äº¤äº’æ¬¡æ•°
âœ… é”æŒæœ‰æ—¶é—´æœ€çŸ­

åŠ£åŠ¿ï¼š
âŒ ä¸€ä¸ªæ–¹æ³•å¤±è´¥å…¨éƒ¨å›æ»š
âŒ äº‹åŠ¡è¾¹ç•Œå¯èƒ½è¿‡å¤§

å®æµ‹æ•°æ®ï¼ˆ100ä¸‡æ¬¡è°ƒç”¨ï¼‰ï¼š
å¹³å‡è€—æ—¶ï¼š5ms
æ•°æ®åº“è¿æ¥æ•°ï¼šå›ºå®š1ä¸ª
```

**ğŸ”¸ REQUIRES_NEWæ€§èƒ½ç‰¹ç‚¹**

```
ä¼˜åŠ¿ï¼š
âœ… äº‹åŠ¡ç‹¬ç«‹ï¼Œäº’ä¸å½±å“
âœ… å¯ä»¥å•ç‹¬æäº¤

åŠ£åŠ¿ï¼š
âŒ æ¯æ¬¡åˆ›å»ºæ–°äº‹åŠ¡
âŒ äº‹åŠ¡æŒ‚èµ·/æ¢å¤å¼€é”€å¤§
âŒ å¯èƒ½äº§ç”Ÿæ­»é”

å®æµ‹æ•°æ®ï¼ˆ100ä¸‡æ¬¡è°ƒç”¨ï¼‰ï¼š
å¹³å‡è€—æ—¶ï¼š45msï¼ˆæ˜¯REQUIREDçš„9å€ï¼ï¼‰
æ•°æ®åº“è¿æ¥æ•°ï¼šå¯èƒ½åˆ°è¾¾è¿æ¥æ± ä¸Šé™
```

> âš ï¸ **æ€§èƒ½è­¦å‘Š**
> 
> REQUIRES_NEWåœ¨å¾ªç¯ä¸­ä½¿ç”¨æ—¶ï¼Œæ€§èƒ½ä¸‹é™å°¤å…¶æ˜æ˜¾ï¼
> å»ºè®®ï¼šæ‰¹é‡æ“ä½œæ—¶æ”¹ç”¨æ‰¹å¤„ç†API

### 2.3 æ€§èƒ½æµ‹è¯•å¯¹æ¯”


**çœŸå®åœºæ™¯æµ‹è¯•**ï¼šä¿å­˜è®¢å•+æ›´æ–°åº“å­˜

```java
// åœºæ™¯1ï¼šä½¿ç”¨REQUIREDï¼ˆæ¨èï¼‰
@Transactional  // å¤–å±‚
public void createOrder() {
    saveOrder();        // åŠ å…¥å¤–å±‚äº‹åŠ¡
    updateInventory();  // åŠ å…¥å¤–å±‚äº‹åŠ¡
}
// æ€§èƒ½ï¼š100ä¸ªè®¢å•/ç§’

// åœºæ™¯2ï¼šä½¿ç”¨REQUIRES_NEWï¼ˆä¸æ¨èï¼‰
@Transactional
public void createOrder() {
    saveOrder();                              // å¤–å±‚äº‹åŠ¡
    updateInventoryWithNew();  // æ–°äº‹åŠ¡ï¼ˆå¼€é”€å¤§ï¼‰
}

@Transactional(propagation = REQUIRES_NEW)
public void updateInventoryWithNew() {
    // æ¯æ¬¡éƒ½åˆ›å»ºæ–°äº‹åŠ¡
}
// æ€§èƒ½ï¼šä»…30ä¸ªè®¢å•/ç§’ï¼ˆæ€§èƒ½ä¸‹é™70%ï¼ï¼‰
```

---

## 3. ğŸ—ï¸ äº‹åŠ¡è¾¹ç•Œè®¾è®¡åŸåˆ™


### 3.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡è¾¹ç•Œ


**é€šä¿—è§£é‡Š**ï¼šäº‹åŠ¡è¾¹ç•Œå°±æ˜¯äº‹åŠ¡çš„"å¼€å§‹"å’Œ"ç»“æŸ"ä½ç½®ã€‚

```
ç±»æ¯”ç†è§£ï¼š
äº‹åŠ¡è¾¹ç•Œ = ä¸€æ¬¡å®Œæ•´çš„è´­ç‰©æµç¨‹

å¼€å§‹è¾¹ç•Œï¼šè¿›å…¥å•†åœº
  â”œâ”€ é€‰å•†å“
  â”œâ”€ ä»˜æ¬¾
  â””â”€ æ‹¿å‘ç¥¨
ç»“æŸè¾¹ç•Œï¼šèµ°å‡ºå•†åœº

åŸåˆ™ï¼šè¾¹ç•Œå†…çš„äº‹å¿…é¡»ä¸€èµ·æˆåŠŸæˆ–ä¸€èµ·å¤±è´¥
```

### 3.2 äº”å¤§è®¾è®¡åŸåˆ™


**ğŸ”¹ åŸåˆ™1ï¼šäº‹åŠ¡è¾¹ç•Œå°½å¯èƒ½å°**

```
âŒ é”™è¯¯ç¤ºä¾‹ï¼šäº‹åŠ¡åŒ…å«å¤ªå¤šæ“ä½œ
@Transactional
public void processOrder() {
    // 1. æŸ¥è¯¢å•†å“ï¼ˆè€—æ—¶ï¼‰
    // 2. è®¡ç®—ä¼˜æƒ ï¼ˆè€—æ—¶ï¼‰
    // 3. è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜ï¼ˆè¶…è€—æ—¶ï¼ï¼‰
    // 4. å‘é€é€šçŸ¥é‚®ä»¶ï¼ˆè¶…è€—æ—¶ï¼ï¼‰
    // 5. æ›´æ–°è®¢å•çŠ¶æ€
}
// é—®é¢˜ï¼šé”æŒæœ‰æ—¶é—´å¤ªé•¿ï¼Œå¹¶å‘å·®

âœ… æ­£ç¡®ç¤ºä¾‹ï¼šåªåŒ…å«å¿…è¦æ“ä½œ
@Transactional
public void processOrder() {
    // ä»…åŒ…å«æ•°æ®åº“å†™æ“ä½œ
    createOrder();
    updateInventory();
}
// ä¼˜ç‚¹ï¼šäº‹åŠ¡æ—¶é—´çŸ­ï¼Œæ€§èƒ½å¥½
```

**è®°å¿†å£è¯€**ï¼š
> äº‹åŠ¡èŒƒå›´è¦ç²¾å‡†ï¼ŒåªåŒ…æ ¸å¿ƒæ•°æ®å˜
> æŸ¥è¯¢è®¡ç®—æ”¾å¤–é¢ï¼Œç¼©çŸ­é”çš„å ç”¨æ—¶é—´

**ğŸ”¹ åŸåˆ™2ï¼šé¿å…äº‹åŠ¡ä¸­çš„è¿œç¨‹è°ƒç”¨**

```
å¸¸è§é”™è¯¯åœºæ™¯ï¼š

@Transactional
public void placeOrder() {
    saveOrder();                    // æ•°æ®åº“æ“ä½œï¼ˆå¿«ï¼‰
    paymentService.pay();           // è¿œç¨‹æ”¯ä»˜ï¼ˆæ…¢ï¼Œ3-5ç§’ï¼‰
    notificationService.sendSMS();  // å‘çŸ­ä¿¡ï¼ˆæ…¢ï¼Œ1-2ç§’ï¼‰
    updateOrderStatus();            // æ•°æ®åº“æ“ä½œï¼ˆå¿«ï¼‰
}

é—®é¢˜åˆ†æï¼š
1. äº‹åŠ¡æŒç»­5-7ç§’ï¼ˆå¤ªé•¿ï¼ï¼‰
2. æ•°æ®åº“è¿æ¥è¢«é•¿æ—¶é—´å ç”¨
3. å¦‚æœæ”¯ä»˜å¤±è´¥ï¼Œæ•´ä¸ªè®¢å•å›æ»š
4. å¹¶å‘èƒ½åŠ›æå·®
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š

```
æ–¹æ¡ˆä¸€ï¼šäº‹åŠ¡åå¼‚æ­¥å¤„ç†
@Transactional
public void placeOrder() {
    saveOrder();         // ä»…åœ¨äº‹åŠ¡ä¸­ä¿å­˜
    updateInventory();
}

// äº‹åŠ¡æäº¤åå¼‚æ­¥è°ƒç”¨
public void afterTransaction() {
    asyncExecutor.execute(() -> {
        paymentService.pay();
        notificationService.sendSMS();
    });
}

æ–¹æ¡ˆäºŒï¼šæ¶ˆæ¯é˜Ÿåˆ—è§£è€¦
@Transactional
public void placeOrder() {
    saveOrder();
    messageQueue.send("ORDER_CREATED");  // å‘æ¶ˆæ¯
}
// å…¶ä»–ç³»ç»Ÿç›‘å¬æ¶ˆæ¯åå¤„ç†æ”¯ä»˜å’Œé€šçŸ¥
```

**ğŸ”¹ åŸåˆ™3ï¼šè¯»å†™åˆ†ç¦»äº‹åŠ¡**

```
æ··åˆåœºæ™¯ï¼ˆä¸æ¨èï¼‰ï¼š
@Transactional  // æŸ¥è¯¢ä¸éœ€è¦äº‹åŠ¡ï¼
public List<Order> getOrders() {
    return orderMapper.selectAll();  // æµªè´¹äº‹åŠ¡èµ„æº
}

ä¼˜åŒ–æ–¹æ¡ˆï¼š
// æŸ¥è¯¢æ–¹æ³•ï¼šä¸åŠ äº‹åŠ¡
public List<Order> getOrders() {
    return orderMapper.selectAll();
}

// å†™æ“ä½œï¼šåŠ äº‹åŠ¡
@Transactional
public void updateOrder(Order order) {
    orderMapper.update(order);
}
```

**ğŸ”¹ åŸåˆ™4ï¼šåˆç†è®¾ç½®è¶…æ—¶æ—¶é—´**

```java
// é»˜è®¤è¶…æ—¶ï¼ˆä¸æ¨èï¼‰
@Transactional  // æ— è¶…æ—¶é™åˆ¶ï¼Œå¯èƒ½æ— é™ç­‰å¾…
public void riskyOperation() {
    // å¦‚æœè¿™é‡Œå¡ä½ï¼Œäº‹åŠ¡ä¼šä¸€ç›´å ç”¨èµ„æº
}

// è®¾ç½®åˆç†è¶…æ—¶ï¼ˆæ¨èï¼‰
@Transactional(timeout = 5)  // 5ç§’è¶…æ—¶
public void safeOperation() {
    // è¶…è¿‡5ç§’è‡ªåŠ¨å›æ»šï¼Œé‡Šæ”¾èµ„æº
}
```

**è¶…æ—¶æ—¶é—´è®¾ç½®å»ºè®®**ï¼š

| æ“ä½œç±»å‹ | å»ºè®®è¶…æ—¶ | è¯´æ˜ |
|---------|---------|------|
| ç®€å•æŸ¥è¯¢ | ä¸éœ€è¦äº‹åŠ¡ | ç›´æ¥æŸ¥è¯¢å³å¯ |
| å•è¡¨å†™å…¥ | 3-5ç§’ | é€šå¸¸æ¯«ç§’çº§å®Œæˆ |
| å¤šè¡¨å…³è”å†™ | 5-10ç§’ | è€ƒè™‘é”ç­‰å¾…æ—¶é—´ |
| æ‰¹é‡æ“ä½œ | 30-60ç§’ | è§†æ•°æ®é‡è€Œå®š |

**ğŸ”¹ åŸåˆ™5ï¼šé¿å…è¿‡åº¦åµŒå¥—**

```
âŒ å±é™©çš„åµŒå¥—ï¼ˆå®¹æ˜“æ­»é”ï¼‰
@Transactional
public void outerMethod() {
    updateA();           // é”å®šAè¡¨
    innerMethod();       // è°ƒç”¨å†…å±‚
}

@Transactional(propagation = REQUIRES_NEW)
public void innerMethod() {
    updateB();           // é”å®šBè¡¨
    updateA();           // åˆè¦é”Aè¡¨ â†’ æ­»é”ï¼
}

âœ… æ‰å¹³åŒ–è®¾è®¡ï¼ˆå®‰å…¨ï¼‰
@Transactional
public void processInOneTransaction() {
    updateA();
    updateB();
    // åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆ
}
```

### 3.3 äº‹åŠ¡è¾¹ç•Œè®¾è®¡æ£€æŸ¥æ¸…å•


**ğŸ“‹ è®¾è®¡è‡ªæ£€è¡¨**

```
è®¾è®¡æ–°äº‹åŠ¡æ–¹æ³•æ—¶ï¼Œé—®è‡ªå·±ï¼š

â–¡ äº‹åŠ¡ä¸­æ˜¯å¦åªåŒ…å«å¿…è¦çš„å†™æ“ä½œï¼Ÿ
â–¡ æ˜¯å¦æœ‰è€—æ—¶çš„è¿œç¨‹è°ƒç”¨ï¼Ÿï¼ˆåº”ç§»å‡ºï¼‰
â–¡ æ˜¯å¦æœ‰å¤§é‡æŸ¥è¯¢æ“ä½œï¼Ÿï¼ˆåº”æå‰ï¼‰
â–¡ æ˜¯å¦è®¾ç½®äº†åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Ÿ
â–¡ äº‹åŠ¡åµŒå¥—å±‚çº§æ˜¯å¦â‰¤2å±‚ï¼Ÿ
â–¡ æ˜¯å¦ä¼šäº§ç”Ÿå¾ªç¯ä¾èµ–æˆ–æ­»é”ï¼Ÿ

å¦‚æœæœ‰âŒï¼Œéœ€è¦é‡æ–°è®¾è®¡ï¼
```

---

## 4. âš ï¸ å¸¸è§æ€§èƒ½é™·é˜±ä¸è§£å†³


### 4.1 é™·é˜±1ï¼šå¾ªç¯ä¸­åˆ›å»ºäº‹åŠ¡


**é—®é¢˜ä»£ç **ï¼š

```java
// âŒ æåº¦å±é™©çš„å†™æ³•
for (Order order : orders) {
    saveOrderWithTransaction(order);  // æ¯æ¬¡å¾ªç¯åˆ›å»ºæ–°äº‹åŠ¡
}

@Transactional(propagation = REQUIRES_NEW)
public void saveOrderWithTransaction(Order order) {
    orderMapper.insert(order);
}

// é—®é¢˜ï¼š1000ä¸ªè®¢å• = 1000ä¸ªäº‹åŠ¡ = æ€§èƒ½ç¾éš¾
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
```
æµ‹è¯•åœºæ™¯ï¼šä¿å­˜1000ä¸ªè®¢å•
é”™è¯¯æ–¹å¼ï¼š45ç§’ï¼ˆæ¯ä¸ªè®¢å•45ms Ã— 1000ï¼‰
æ­£ç¡®æ–¹å¼ï¼š0.5ç§’ï¼ˆæ‰¹é‡å¤„ç†ï¼‰
æ€§èƒ½å·®è·ï¼š90å€ï¼
```

**âœ… è§£å†³æ–¹æ¡ˆ**

```java
// æ–¹æ¡ˆ1ï¼šæ‰¹é‡å¤„ç†ï¼ˆæ¨èï¼‰
@Transactional
public void saveOrders(List<Order> orders) {
    orderMapper.batchInsert(orders);  // ä¸€æ¬¡äº‹åŠ¡å®Œæˆ
}

// æ–¹æ¡ˆ2ï¼šåˆ†æ‰¹å¤„ç†ï¼ˆå¤§æ•°æ®é‡ï¼‰
@Transactional
public void saveOrdersInBatch(List<Order> orders) {
    int batchSize = 100;
    for (int i = 0; i < orders.size(); i += batchSize) {
        List<Order> batch = orders.subList(i, 
            Math.min(i + batchSize, orders.size()));
        orderMapper.batchInsert(batch);
    }
}
```

### 4.2 é™·é˜±2ï¼šå¤§äº‹åŠ¡é—®é¢˜


**è¯†åˆ«å¤§äº‹åŠ¡**ï¼š
```
åˆ¤æ–­æ ‡å‡†ï¼š
â±ï¸ æ‰§è¡Œæ—¶é—´ > 5ç§’
ğŸ“¦ æ“ä½œæ•°æ®é‡ > 10000æ¡
ğŸ”’ é”æŒæœ‰æ—¶é—´ > 3ç§’
ğŸ’¾ å ç”¨å†…å­˜ > 100MB

ä»»æ„ä¸€æ¡æ»¡è¶³ â†’ å¤§äº‹åŠ¡ï¼
```

**å…¸å‹å¤§äº‹åŠ¡åœºæ™¯**ï¼š

```java
// âŒ å¤§äº‹åŠ¡ç¤ºä¾‹
@Transactional
public void monthlyReport() {
    // 1. æŸ¥è¯¢30å¤©æ•°æ®ï¼ˆ100ä¸‡æ¡ï¼‰
    List<Order> orders = queryMonthOrders();
    
    // 2. å¤æ‚è®¡ç®—ï¼ˆè€—æ—¶ï¼‰
    Report report = calculate(orders);
    
    // 3. æ‰¹é‡æ›´æ–°çŠ¶æ€
    batchUpdateStatus(orders);
    
    // 4. æ’å…¥æ±‡æ€»æ•°æ®
    insertSummary(report);
}
// é—®é¢˜ï¼šæ•´ä¸ªè¿‡ç¨‹10ç§’+ï¼Œé”å®šå¤§é‡èµ„æº
```

**æ‹†åˆ†ç­–ç•¥**ï¼š

```java
// âœ… æ–¹æ¡ˆ1ï¼šè¯»å†™åˆ†ç¦»
public void monthlyReport() {
    // 1. æ— äº‹åŠ¡æŸ¥è¯¢ï¼ˆå¿«ï¼‰
    List<Order> orders = queryMonthOrders();
    
    // 2. æ— äº‹åŠ¡è®¡ç®—ï¼ˆå¿«ï¼‰
    Report report = calculate(orders);
    
    // 3. ä»…å†™æ“ä½œåŠ äº‹åŠ¡
    saveReportWithTransaction(report);
}

@Transactional(timeout = 10)
public void saveReportWithTransaction(Report report) {
    batchUpdateStatus(report.getOrders());
    insertSummary(report);
}

// âœ… æ–¹æ¡ˆ2ï¼šåˆ†é¡µå¤„ç†
public void monthlyReport() {
    int pageSize = 1000;
    int page = 0;
    
    while (true) {
        // æ¯æ¬¡å¤„ç†1000æ¡
        List<Order> batch = queryByPage(page++, pageSize);
        if (batch.isEmpty()) break;
        
        processOneBatch(batch);  // å°äº‹åŠ¡
    }
}

@Transactional
public void processOneBatch(List<Order> batch) {
    // äº‹åŠ¡èŒƒå›´å°ï¼Œé£é™©ä½
}
```

### 4.3 é™·é˜±3ï¼šäº‹åŠ¡ä¼ æ’­é…ç½®é”™è¯¯


**é”™è¯¯åœºæ™¯1ï¼šå†…éƒ¨è°ƒç”¨å¤±æ•ˆ**

```java
// âŒ äº‹åŠ¡ä¸ç”Ÿæ•ˆï¼ˆåŒç±»è°ƒç”¨ï¼‰
@Service
public class OrderService {
    
    public void createOrder() {
        saveOrder();  // ç›´æ¥è°ƒç”¨ï¼Œäº‹åŠ¡ä¸ç”Ÿæ•ˆï¼
    }
    
    @Transactional
    public void saveOrder() {
        orderMapper.insert(order);
    }
}
```

**åŸå› åˆ†æ**ï¼š
```
Springäº‹åŠ¡åŸºäºä»£ç†ï¼ˆAOPï¼‰å®ç°

æ­£å¸¸è°ƒç”¨é“¾è·¯ï¼š
Controller â†’ ä»£ç†å¯¹è±¡ â†’ çœŸå®å¯¹è±¡ï¼ˆæœ‰äº‹åŠ¡ï¼‰

åŒç±»è°ƒç”¨é“¾è·¯ï¼š
çœŸå®å¯¹è±¡ â†’ çœŸå®å¯¹è±¡ï¼ˆæ— ä»£ç†ï¼Œæ— äº‹åŠ¡ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```java
// æ–¹æ¡ˆ1ï¼šæ³¨å…¥è‡ªèº«ä»£ç†
@Service
public class OrderService {
    
    @Autowired
    private OrderService self;  // æ³¨å…¥ä»£ç†å¯¹è±¡
    
    public void createOrder() {
        self.saveOrder();  // é€šè¿‡ä»£ç†è°ƒç”¨ï¼Œäº‹åŠ¡ç”Ÿæ•ˆ
    }
    
    @Transactional
    public void saveOrder() {
        orderMapper.insert(order);
    }
}

// æ–¹æ¡ˆ2ï¼šæ‹†åˆ†åˆ°ä¸åŒService
@Service
public class OrderFacade {
    @Autowired
    private OrderService orderService;
    
    public void createOrder() {
        orderService.saveOrder();  // è·¨ç±»è°ƒç”¨ï¼Œäº‹åŠ¡ç”Ÿæ•ˆ
    }
}

@Service
public class OrderService {
    @Transactional
    public void saveOrder() {
        orderMapper.insert(order);
    }
}
```

### 4.4 é™·é˜±4ï¼šå¼‚å¸¸å¤„ç†ä¸å½“


**é—®é¢˜ä»£ç **ï¼š

```java
// âŒ å¼‚å¸¸è¢«åæ‰ï¼Œäº‹åŠ¡ä¸å›æ»š
@Transactional
public void riskyOperation() {
    try {
        orderMapper.insert(order);
        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ
        thirdPartyService.call();
    } catch (Exception e) {
        log.error("Error", e);  // åªè®°å½•ï¼Œä¸æŠ›å‡º
        // äº‹åŠ¡ä¸ä¼šå›æ»šï¼
    }
}
```

**âœ… æ­£ç¡®å¤„ç†**ï¼š

```java
// æ–¹æ¡ˆ1ï¼šé‡æ–°æŠ›å‡ºå¼‚å¸¸
@Transactional
public void correctOperation() {
    try {
        orderMapper.insert(order);
        thirdPartyService.call();
    } catch (Exception e) {
        log.error("Error", e);
        throw new RuntimeException("æ“ä½œå¤±è´¥", e);  // è§¦å‘å›æ»š
    }
}

// æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨è®¾ç½®å›æ»š
@Transactional
public void manualRollback() {
    try {
        orderMapper.insert(order);
        thirdPartyService.call();
    } catch (Exception e) {
        log.error("Error", e);
        TransactionAspectSupport.currentTransactionStatus()
            .setRollbackOnly();  // æ‰‹åŠ¨æ ‡è®°å›æ»š
        return;
    }
}

// æ–¹æ¡ˆ3ï¼šæŒ‡å®šå›æ»šå¼‚å¸¸
@Transactional(rollbackFor = Exception.class)  // æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»š
public void specificRollback() {
    // ä¸éœ€è¦æ‰‹åŠ¨å¤„ç†
}
```

---

## 5. ğŸ¯ æœ€ä½³å®è·µæŒ‡å—


### 5.1 æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒç­–ç•¥


**ğŸ“Š ä¼˜åŒ–ä¼˜å…ˆçº§**

```
ä¼˜å…ˆçº§æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

ğŸ”´ P0çº§ï¼šé¿å…å¤§äº‹åŠ¡ï¼ˆæ€§èƒ½æå‡50-90%ï¼‰
  â†’ æ‹†åˆ†äº‹åŠ¡è¾¹ç•Œ
  â†’ è¯»å†™åˆ†ç¦»

ğŸŸ  P1çº§ï¼šå‡å°‘äº‹åŠ¡åˆ›å»ºï¼ˆæ€§èƒ½æå‡30-50%ï¼‰
  â†’ å¤ç”¨REQUIRED
  â†’ é¿å…REQUIRES_NEWå¾ªç¯

ğŸŸ¡ P2çº§ï¼šä¼˜åŒ–é”ç­–ç•¥ï¼ˆæ€§èƒ½æå‡20-30%ï¼‰
  â†’ ç¼©çŸ­é”æŒæœ‰æ—¶é—´
  â†’ é™ä½é”ç²’åº¦

ğŸŸ¢ P3çº§ï¼šå…¶ä»–ä¼˜åŒ–ï¼ˆæ€§èƒ½æå‡10-20%ï¼‰
  â†’ è®¾ç½®åˆç†è¶…æ—¶
  â†’ ä½¿ç”¨æ‰¹å¤„ç†
```

### 5.2 ä¼ æ’­è¡Œä¸ºé€‰æ‹©æŒ‡å—


**ğŸ”¸ å†³ç­–æ ‘**

```
å¼€å§‹
  |
  â”œâ”€ éœ€è¦ç‹¬ç«‹æäº¤ï¼Ÿ
  |   â”œâ”€ æ˜¯ â†’ REQUIRES_NEWï¼ˆæ—¥å¿—è®°å½•ï¼‰
  |   â””â”€ å¦ â†“
  |
  â”œâ”€ å¿…é¡»åœ¨äº‹åŠ¡ä¸­ï¼Ÿ
  |   â”œâ”€ æ˜¯ â†’ MANDATORYï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰
  |   â””â”€ å¦ â†“
  |
  â”œâ”€ å½“å‰æœ‰äº‹åŠ¡ï¼Ÿ
  |   â”œâ”€ åŠ å…¥ â†’ REQUIREDï¼ˆé»˜è®¤ï¼Œ90%åœºæ™¯ï¼‰
  |   â””â”€ ä¸åŠ å…¥ â†“
  |
  â””â”€ æŸ¥è¯¢æ“ä½œï¼Ÿ
      â”œâ”€ æ˜¯ â†’ SUPPORTSï¼ˆå¯æœ‰å¯æ— ï¼‰
      â””â”€ å¦ â†’ NOT_SUPPORTEDï¼ˆæ’é™¤äº‹åŠ¡å¹²æ‰°ï¼‰
```

**åº”ç”¨åœºæ™¯é€ŸæŸ¥è¡¨**

| åœºæ™¯ | æ¨èä¼ æ’­è¡Œä¸º | åŸå›  |
|------|------------|------|
| æ™®é€šä¸šåŠ¡æ–¹æ³• | **REQUIRED** | å¤ç”¨äº‹åŠ¡ï¼Œæ€§èƒ½æœ€å¥½ |
| è®°å½•æ“ä½œæ—¥å¿— | **REQUIRES_NEW** | å³ä½¿ä¸šåŠ¡å¤±è´¥ä¹Ÿè¦è®°å½• |
| æŸ¥è¯¢æ–¹æ³• | **ä¸åŠ äº‹åŠ¡** æˆ– **SUPPORTS** | æŸ¥è¯¢ä¸éœ€è¦äº‹åŠ¡å¼€é”€ |
| å†…éƒ¨è¾…åŠ©æ–¹æ³• | **MANDATORY** | å¼ºåˆ¶åœ¨è°ƒç”¨è€…äº‹åŠ¡ä¸­ |
| è°ƒç”¨å¤–éƒ¨æœåŠ¡ | **NOT_SUPPORTED** | å¤–éƒ¨è°ƒç”¨è€—æ—¶ï¼Œæš‚åœäº‹åŠ¡ |

### 5.3 ä»£ç è§„èŒƒå»ºè®®


**ğŸ”¹ è§„èŒƒ1ï¼šäº‹åŠ¡æ–¹æ³•å‘½å**

```java
// âœ… æ¨èï¼šæ¸…æ™°è¡¨æ˜äº‹åŠ¡è¯­ä¹‰
@Transactional
public void saveOrderWithInventoryUpdate() {
    // åå­—è¯´æ˜äº†åšä»€ä¹ˆ
}

@Transactional
public void createOrderTransaction() {
    // æ˜ç¡®æ ‡è¯†è¿™æ˜¯äº‹åŠ¡æ–¹æ³•
}

// âŒ ä¸æ¨èï¼šæ¨¡ç³Šä¸æ¸…
@Transactional
public void process() {  // ä»€ä¹ˆprocessï¼Ÿ
    // ...
}
```

**ğŸ”¹ è§„èŒƒ2ï¼šäº‹åŠ¡æ³¨è§£ä½ç½®**

```java
// âœ… æ¨èï¼špublicæ–¹æ³•ä¸Š
@Service
public class OrderService {
    
    @Transactional  // âœ… Springä»£ç†publicæ–¹æ³•
    public void createOrder() {
    }
    
    // âŒ ä¸æ¨èï¼šç§æœ‰æ–¹æ³•
    @Transactional  // âŒ ä»£ç†ä¸ä¼šç”Ÿæ•ˆ
    private void saveOrder() {
    }
}

// âœ… æ¨èï¼šå®ç°ç±»ä¸Š
@Service
@Transactional  // æ‰€æœ‰æ–¹æ³•ç»§æ‰¿äº‹åŠ¡é…ç½®
public class OrderServiceImpl implements OrderService {
}
```

**ğŸ”¹ è§„èŒƒ3ï¼šåªè¯»äº‹åŠ¡ä¼˜åŒ–**

```java
// æŸ¥è¯¢æ–¹æ³•ä¼˜åŒ–
@Transactional(readOnly = true)  // ä¼˜åŒ–æ€§èƒ½
public Order getOrder(Long id) {
    return orderMapper.selectById(id);
}

// å¥½å¤„ï¼š
// 1. æ•°æ®åº“ä¼˜åŒ–ï¼šä¸éœ€è¦ç”Ÿæˆundoæ—¥å¿—
// 2. æ¡†æ¶ä¼˜åŒ–ï¼šæŸäº›ORMä¼šåšåªè¯»ä¼˜åŒ–
// 3. è¯­ä¹‰æ¸…æ™°ï¼šæ˜ç¡®è¡¨ç¤ºè¿™æ˜¯æŸ¥è¯¢æ–¹æ³•
```

### 5.4 ç›‘æ§ä¸è°ƒä¼˜


**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**

```
æ€§èƒ½æŒ‡æ ‡ï¼š
ğŸ“Š äº‹åŠ¡æ‰§è¡Œæ—¶é—´ï¼šåº”è¯¥ < 3ç§’
ğŸ“Š äº‹åŠ¡ç­‰å¾…æ—¶é—´ï¼šåº”è¯¥ < 1ç§’
ğŸ“Š æ­»é”æ¬¡æ•°ï¼šåº”è¯¥ = 0
ğŸ“Š å›æ»šç‡ï¼šåº”è¯¥ < 5%

èµ„æºæŒ‡æ ‡ï¼š
ğŸ’¾ æ•°æ®åº“è¿æ¥æ•°ï¼šåº”è¯¥ < è¿æ¥æ± 80%
ğŸ’¾ é”ç­‰å¾…çº¿ç¨‹æ•°ï¼šåº”è¯¥ < 10
ğŸ’¾ å†…å­˜ä½¿ç”¨ï¼šåº”è¯¥ < å †å†…å­˜50%
```

**ç›‘æ§ä»£ç ç¤ºä¾‹**ï¼š

```java
@Aspect
@Component
public class TransactionMonitor {
    
    @Around("@annotation(transactional)")
    public Object monitor(ProceedingJoinPoint pjp, 
                         Transactional transactional) {
        long start = System.currentTimeMillis();
        
        try {
            Object result = pjp.proceed();
            long cost = System.currentTimeMillis() - start;
            
            // æ…¢äº‹åŠ¡å‘Šè­¦
            if (cost > 3000) {
                log.warn("æ…¢äº‹åŠ¡: {} è€—æ—¶: {}ms", 
                    pjp.getSignature(), cost);
            }
            
            return result;
        } catch (Throwable e) {
            log.error("äº‹åŠ¡å¼‚å¸¸", e);
            throw new RuntimeException(e);
        }
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»è®°ä½çš„å…³é”®ç‚¹


```
ğŸ”¸ æ€§èƒ½æ ¸å¿ƒï¼šäº‹åŠ¡è¶Šå°è¶Šå¥½ï¼Œèƒ½ä¸ç”¨å°±ä¸ç”¨
ğŸ”¸ ä¼ æ’­é»˜è®¤ï¼šREQUIREDè¶³å¤Ÿ90%åœºæ™¯ä½¿ç”¨
ğŸ”¸ è¾¹ç•ŒåŸåˆ™ï¼šåªåŒ…å«æ•°æ®åº“å†™æ“ä½œï¼Œå…¶ä»–æ“ä½œç§»å‡º
ğŸ”¸ åµŒå¥—é™åˆ¶ï¼šäº‹åŠ¡å±‚çº§ä¸è¶…è¿‡2å±‚
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šå¿…é¡»è®©å¼‚å¸¸æŠ›å‡ºæ‰èƒ½å›æ»š
```

### 6.2 æ€§èƒ½ä¼˜åŒ–è¦è¯€


**è®°å¿†å£è¯€**ï¼š
> äº‹åŠ¡èŒƒå›´è¦æœ€å°ï¼Œè¿œç¨‹è°ƒç”¨è¦ç§»é™¤
> å¾ªç¯åˆ›å»ºæ˜¯å¤§å¿Œï¼Œæ‰¹é‡å¤„ç†æ•ˆç‡é«˜
> è¯»å†™åˆ†ç¦»é™å¼€é”€ï¼Œè¶…æ—¶è®¾ç½®ä¸èƒ½å°‘

### 6.3 å¿«é€Ÿæ£€æŸ¥æ¸…å•


**âœ… è®¾è®¡äº‹åŠ¡æ–¹æ³•æ—¶è‡ªæŸ¥**

```
â–¡ äº‹åŠ¡ä¸­æ²¡æœ‰è¿œç¨‹è°ƒç”¨
â–¡ äº‹åŠ¡ä¸­æ²¡æœ‰è€—æ—¶æŸ¥è¯¢
â–¡ æ²¡æœ‰åœ¨å¾ªç¯ä¸­åˆ›å»ºäº‹åŠ¡
â–¡ äº‹åŠ¡æ–¹æ³•æ˜¯publicçš„
â–¡ å¼‚å¸¸ä¼šæ­£ç¡®æŠ›å‡º
â–¡ è®¾ç½®äº†åˆç†çš„è¶…æ—¶æ—¶é—´
â–¡ ä½¿ç”¨äº†æ‰¹å¤„ç†è€Œéé€æ¡å¤„ç†

å…¨éƒ¨æ‰“å‹¾ â†’ è®¾è®¡åˆæ ¼ï¼
```

### 6.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| æ€§èƒ½çªç„¶å˜å·® | å¤§äº‹åŠ¡ | æ‹†åˆ†äº‹åŠ¡è¾¹ç•Œ |
| é¢‘ç¹æ­»é” | åµŒå¥—äº‹åŠ¡ | æ‰å¹³åŒ–è®¾è®¡ |
| è¿æ¥æ± è€—å°½ | REQUIRES_NEWæ»¥ç”¨ | æ”¹ç”¨REQUIRED |
| äº‹åŠ¡ä¸ç”Ÿæ•ˆ | åŒç±»è°ƒç”¨ | æ³¨å…¥è‡ªèº«æˆ–æ‹†åˆ†Service |
| å¼‚å¸¸ä¸å›æ»š | catchåå¼‚å¸¸ | é‡æ–°æŠ›å‡ºæˆ–æ‰‹åŠ¨æ ‡è®° |

---

**ğŸ¯ å­¦ä¹ å»ºè®®**

1. **ç†è§£åŸç†**ï¼šçŸ¥é“ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡
2. **åŠ¨æ‰‹å®è·µ**ï¼šå†™ä»£ç éªŒè¯æ€§èƒ½å·®å¼‚
3. **ç›‘æ§è°ƒä¼˜**ï¼šå…³æ³¨ç”Ÿäº§ç¯å¢ƒæŒ‡æ ‡
4. **æŒç»­æ”¹è¿›**ï¼šæ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–

**æ ¸å¿ƒæ€æƒ³**ï¼š
> äº‹åŠ¡æ˜¯ä¿éšœæ•°æ®ä¸€è‡´æ€§çš„å·¥å…·ï¼Œä½†ä¸æ˜¯ä¸‡èƒ½çš„
> åœ¨ä¿è¯æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œè¿½æ±‚æœ€ä¼˜æ€§èƒ½
> ç®€å•ã€æ¸…æ™°çš„è®¾è®¡å¾€å¾€å°±æ˜¯æœ€å¥½çš„è®¾è®¡