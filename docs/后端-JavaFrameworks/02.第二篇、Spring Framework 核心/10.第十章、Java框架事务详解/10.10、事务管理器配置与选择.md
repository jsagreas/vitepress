---
title: 10ã€äº‹åŠ¡ç®¡ç†å™¨é…ç½®ä¸é€‰æ‹©
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨](#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨)
2. [äº‹åŠ¡ç®¡ç†å™¨Beané…ç½®](#2-äº‹åŠ¡ç®¡ç†å™¨Beané…ç½®)
3. [å¼€å¯äº‹åŠ¡ç®¡ç†åŠŸèƒ½](#3-å¼€å¯äº‹åŠ¡ç®¡ç†åŠŸèƒ½)
4. [æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨](#4-æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨)
5. [å¤šäº‹åŠ¡ç®¡ç†å™¨é…ç½®](#5-å¤šäº‹åŠ¡ç®¡ç†å™¨é…ç½®)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨


### 1.1 äº‹åŠ¡ç®¡ç†å™¨çš„æœ¬è´¨


**é€šä¿—ç†è§£**ï¼šäº‹åŠ¡ç®¡ç†å™¨å°±åƒä¸€ä¸ª**äº¤æ˜“ç®¡å®¶**

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
é“¶è¡Œè½¬è´¦æ—¶çš„"æŸœå‘˜"è§’è‰²
â”œâ”€â”€ å¼€å§‹åŠç†ï¼šå¼€å¯è½¬è´¦æµç¨‹
â”œâ”€â”€ æ‰§è¡Œæ“ä½œï¼šæ‰£æ¬¾ã€å­˜æ¬¾
â”œâ”€â”€ ç¡®è®¤å®Œæˆï¼šæäº¤äº‹åŠ¡
â””â”€â”€ å‡ºé”™å›æ»šï¼šæ’¤é”€æ“ä½œ

Springäº‹åŠ¡ç®¡ç†å™¨ï¼š
ç¨‹åºæ‰§è¡Œæ•°æ®åº“æ“ä½œæ—¶çš„"åè°ƒè€…"
â”œâ”€â”€ å¼€å¯äº‹åŠ¡ï¼šbegin transaction
â”œâ”€â”€ æ‰§è¡ŒSQLï¼šinsert/update/delete
â”œâ”€â”€ æˆåŠŸæäº¤ï¼šcommit
â””â”€â”€ å¤±è´¥å›æ»šï¼šrollback
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ”¸ **æ§åˆ¶äº‹åŠ¡è¾¹ç•Œ**ï¼šå†³å®šä»€ä¹ˆæ—¶å€™å¼€å¯ã€æäº¤ã€å›æ»šäº‹åŠ¡
- ğŸ”¸ **ç®¡ç†æ•°æ®åº“è¿æ¥**ï¼šè·å–è¿æ¥ã€é‡Šæ”¾è¿æ¥
- ğŸ”¸ **åè°ƒå¤šä¸ªæ“ä½œ**ï¼šç¡®ä¿ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡ç®¡ç†å™¨


**é—®é¢˜åœºæ™¯**ï¼šè½¬è´¦ä¸šåŠ¡

```java
// âŒ æ²¡æœ‰äº‹åŠ¡ç®¡ç†å™¨çš„é—®é¢˜ä»£ç 
public void transfer(String from, String to, int money) {
    // æ‰£æ¬¾æˆåŠŸ
    accountDao.deduct(from, money);
    
    // è¿™é‡Œçªç„¶å‡ºé”™äº†ï¼ç¨‹åºå´©æºƒ
    int result = 10 / 0;  // é™¤é›¶å¼‚å¸¸
    
    // åŠ æ¬¾æ²¡æ‰§è¡Œ
    accountDao.add(to, money);
}

é—®é¢˜ï¼šé’±æ‰£äº†ï¼Œä½†æ²¡åŠ ä¸Šå»ï¼Œé’±ä¸¢äº†ï¼
```

**äº‹åŠ¡ç®¡ç†å™¨çš„è§£å†³æ–¹æ¡ˆ**ï¼š

```
æœ‰äº†äº‹åŠ¡ç®¡ç†å™¨ï¼š

1. å¼€å§‹è½¬è´¦ â†’ å¼€å¯äº‹åŠ¡
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ begin transactionâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
2. æ‰§è¡Œæ‰£æ¬¾ â†’ è®°å½•æ“ä½œ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ‰£æ¬¾ -100å…ƒ     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
3. ç¨‹åºå‡ºé”™ â†’ è‡ªåŠ¨å›æ»š
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ rollback        â”‚
   â”‚ æ’¤é”€æ‰£æ¬¾æ“ä½œ    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœï¼šé’±æ²¡ä¸¢ï¼Œæ•°æ®ä¸€è‡´ï¼
```

---

## 2. ğŸ”§ äº‹åŠ¡ç®¡ç†å™¨Beané…ç½®


### 2.1 é…ç½®çš„æ ¸å¿ƒæ€è·¯


**é…ç½®ä¸‰æ­¥éª¤**ï¼š
1. **é…ç½®æ•°æ®æº**ï¼šå‘Šè¯‰Springæ•°æ®åº“åœ¨å“ªé‡Œ
2. **é…ç½®äº‹åŠ¡ç®¡ç†å™¨**ï¼šå‘Šè¯‰Springç”¨è°æ¥ç®¡ç†äº‹åŠ¡
3. **å¼€å¯äº‹åŠ¡åŠŸèƒ½**ï¼šå‘Šè¯‰Springå¯ç”¨äº‹åŠ¡ç®¡ç†

```
é…ç½®å…³ç³»å›¾ï¼š

æ•°æ®æº(DataSource)
    â†“ æä¾›è¿æ¥
äº‹åŠ¡ç®¡ç†å™¨(TransactionManager)
    â†“ ç®¡ç†äº‹åŠ¡
ä¸šåŠ¡æ–¹æ³•(@Transactional)
    â†“ æ‰§è¡Œæ“ä½œ
æ•°æ®åº“æ“ä½œç”Ÿæ•ˆ
```

### 2.2 æ•°æ®æºé…ç½®ï¼ˆç¬¬ä¸€æ­¥ï¼‰


**æ•°æ®æºçš„ä½œç”¨**ï¼šå°±åƒæ˜¯**æ•°æ®åº“çš„é—¨å¡**ï¼Œæœ‰äº†å®ƒæ‰èƒ½è¿›å…¥æ•°æ®åº“

```java
@Configuration
public class DataSourceConfig {
    
    /**
     * é…ç½®æ•°æ®æº
     * ä½œç”¨ï¼šå‘Šè¯‰ç¨‹åºæ•°æ®åº“çš„åœ°å€ã€è´¦å·ã€å¯†ç 
     */
    @Bean
    public DataSource dataSource() {
        // åˆ›å»ºä¸€ä¸ªè¿æ¥æ± æ•°æ®æº
        DruidDataSource dataSource = new DruidDataSource();
        
        // æ•°æ®åº“åœ°å€ï¼ˆå°±åƒå®¶åº­ä½å€ï¼‰
        dataSource.setUrl("jdbc:mysql://localhost:3306/mydb");
        
        // æ•°æ®åº“è´¦å·ï¼ˆå°±åƒç”¨æˆ·åï¼‰
        dataSource.setUsername("root");
        
        // æ•°æ®åº“å¯†ç ï¼ˆå°±åƒå¯†ç ï¼‰
        dataSource.setPassword("123456");
        
        // æ•°æ®åº“é©±åŠ¨ï¼ˆå°±åƒé’¥åŒ™ç±»å‹ï¼‰
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        
        return dataSource;
    }
}
```

**é…ç½®æ–‡ä»¶æ–¹å¼**ï¼ˆæ›´å¸¸ç”¨ï¼‰ï¼š

```properties
# application.properties

# æ•°æ®åº“è¿æ¥ä¿¡æ¯
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# è¿æ¥æ± é…ç½®ï¼ˆå¯é€‰ï¼‰
spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
```

### 2.3 äº‹åŠ¡ç®¡ç†å™¨é…ç½®ï¼ˆç¬¬äºŒæ­¥ï¼‰


**æ ¸å¿ƒé…ç½®**ï¼šåˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨Bean

```java
@Configuration
public class TransactionConfig {
    
    /**
     * é…ç½®äº‹åŠ¡ç®¡ç†å™¨
     * å‚æ•°ï¼šéœ€è¦ä¸€ä¸ªæ•°æ®æºï¼ˆSpringä¼šè‡ªåŠ¨æ³¨å…¥ï¼‰
     */
    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        // åˆ›å»ºæ•°æ®æºäº‹åŠ¡ç®¡ç†å™¨
        DataSourceTransactionManager manager = new DataSourceTransactionManager();
        
        // è®¾ç½®æ•°æ®æºï¼ˆå‘Šè¯‰ç®¡ç†å™¨ç”¨å“ªä¸ªæ•°æ®åº“ï¼‰
        manager.setDataSource(dataSource);
        
        return manager;
        // å°±è¿™ä¹ˆç®€å•ï¼äº‹åŠ¡ç®¡ç†å™¨é…ç½®å®Œæˆ
    }
}
```

**å…³é”®ç†è§£**ï¼š
- `DataSource`ï¼šå°±åƒä¸€ä¸ªæ°´æ± ï¼Œæä¾›æ•°æ®åº“è¿æ¥
- `TransactionManager`ï¼šå°±åƒä¸€ä¸ªæ°´é¾™å¤´å¼€å…³ï¼Œæ§åˆ¶äº‹åŠ¡çš„å¼€å…³

### 2.4 å¸¸è§äº‹åŠ¡ç®¡ç†å™¨ç±»å‹


| äº‹åŠ¡ç®¡ç†å™¨ç±»å‹ | **ä½¿ç”¨åœºæ™¯** | **è¯´æ˜** |
|--------------|------------|---------|
| **DataSourceTransactionManager** | `JDBC / MyBatis` | æœ€å¸¸ç”¨ï¼Œé€‚åˆå•æ•°æ®æº |
| **JpaTransactionManager** | `JPA / Hibernate` | é€‚åˆJPAè§„èŒƒçš„æ¡†æ¶ |
| **HibernateTransactionManager** | `Hibernate` | Hibernateä¸“ç”¨ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ |
| **JtaTransactionManager** | `åˆ†å¸ƒå¼äº‹åŠ¡` | è·¨å¤šä¸ªæ•°æ®æºçš„äº‹åŠ¡ |

**é€‰æ‹©å»ºè®®**ï¼š
- ç”¨MyBatis â†’ é€‰ `DataSourceTransactionManager`
- ç”¨JPA â†’ é€‰ `JpaTransactionManager`  
- å¤šæ•°æ®æº â†’ é€‰ `JtaTransactionManager`

---

## 3. ğŸš€ å¼€å¯äº‹åŠ¡ç®¡ç†åŠŸèƒ½


### 3.1 ä½¿ç”¨@EnableTransactionManagement


**æ ¸å¿ƒæ³¨è§£**ï¼šåœ¨é…ç½®ç±»ä¸ŠåŠ  `@EnableTransactionManagement`

```java
@Configuration
@EnableTransactionManagement  // ğŸ‘ˆ å¼€å¯äº‹åŠ¡ç®¡ç†åŠŸèƒ½
public class AppConfig {
    
    @Bean
    public DataSource dataSource() {
        // æ•°æ®æºé…ç½®...
    }
    
    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        // äº‹åŠ¡ç®¡ç†å™¨é…ç½®...
    }
}
```

**ä½œç”¨è§£é‡Š**ï¼š

```
æ²¡æœ‰@EnableTransactionManagementï¼š
@Transactionalæ³¨è§£ â†’ ä¸ç”Ÿæ•ˆ â†’ æ²¡æœ‰äº‹åŠ¡

æœ‰@EnableTransactionManagementï¼š
@Transactionalæ³¨è§£ â†’ ç”Ÿæ•ˆ â†’ æœ‰äº‹åŠ¡æ§åˆ¶
```

**é€šä¿—ç†è§£**ï¼š
- `@EnableTransactionManagement` å°±åƒæ˜¯**æ€»å¼€å…³**
- ä¸æ‰“å¼€è¿™ä¸ªå¼€å…³ï¼Œäº‹åŠ¡åŠŸèƒ½å°±æ˜¯æ‘†è®¾
- æ‰“å¼€å¼€å…³åï¼Œ`@Transactional` æ‰çœŸæ­£èµ·ä½œç”¨

### 3.2 SpringBootçš„è‡ªåŠ¨é…ç½®


**å¥½æ¶ˆæ¯**ï¼šSpringBootå·²ç»è‡ªåŠ¨å¼€å¯äº†ï¼

```java
// SpringBooté¡¹ç›®ä¸­ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼
// åªéœ€è¦é…ç½®æ•°æ®æºï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šè‡ªåŠ¨åˆ›å»º

// application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=123456

// è¿™æ ·å°±å¤Ÿäº†ï¼SpringBootè‡ªåŠ¨å®Œæˆï¼š
// âœ… è‡ªåŠ¨åˆ›å»ºDataSource
// âœ… è‡ªåŠ¨åˆ›å»ºTransactionManager  
// âœ… è‡ªåŠ¨å¼€å¯@EnableTransactionManagement
```

**å¯¹æ¯”è¯´æ˜**ï¼š

```
ä¼ ç»ŸSpringé¡¹ç›®ï¼š
â‘ é…ç½®æ•°æ®æº â†’ â‘¡é…ç½®äº‹åŠ¡ç®¡ç†å™¨ â†’ â‘¢æ·»åŠ @EnableTransactionManagement
éœ€è¦æ‰‹åŠ¨å®Œæˆ3æ­¥

SpringBooté¡¹ç›®ï¼š
â‘ é…ç½®æ•°æ®æº
åªéœ€è¦1æ­¥ï¼Œå…¶ä»–è‡ªåŠ¨å®Œæˆï¼
```

---

## 4. ğŸ¯ æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨


### 4.1 é»˜è®¤äº‹åŠ¡ç®¡ç†å™¨


**è§„åˆ™**ï¼šSpringä¼šè‡ªåŠ¨å¯»æ‰¾åä¸º `transactionManager` çš„Bean

```java
@Configuration
public class TxConfig {
    
    // âœ… é»˜è®¤æ–¹å¼ï¼šBeanåç§°ä¸ºtransactionManager
    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}

// ä½¿ç”¨æ—¶ä¸éœ€è¦æŒ‡å®š
@Service
public class UserService {
    
    @Transactional  // è‡ªåŠ¨ä½¿ç”¨åä¸ºtransactionManagerçš„Bean
    public void createUser() {
        // ...
    }
}
```

### 4.2 ä½¿ç”¨transaction-managerå±æ€§


**åœºæ™¯**ï¼šå½“Beanåç§°ä¸æ˜¯é»˜è®¤çš„ `transactionManager` æ—¶

```java
@Configuration
public class TxConfig {
    
    // Beanåç§°æ”¹æˆäº†myTxManager
    @Bean
    public PlatformTransactionManager myTxManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}

// ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®š
@Service
public class UserService {
    
    @Transactional(transactionManager = "myTxManager")  // ğŸ‘ˆ æŒ‡å®šBeanåç§°
    public void createUser() {
        // ...
    }
}
```

**ç†è§£è¦ç‚¹**ï¼š
- `transactionManager` å±æ€§ï¼šå‘Šè¯‰Springç”¨å“ªä¸ªäº‹åŠ¡ç®¡ç†å™¨
- å€¼å°±æ˜¯**Beançš„åç§°**ï¼ˆæ–¹æ³•åï¼‰
- ä¸æŒ‡å®šæ—¶ï¼Œé»˜è®¤æ‰¾åä¸º `transactionManager` çš„Bean

### 4.3 å…¨å±€æŒ‡å®šæ–¹å¼


**æ–¹å¼1**ï¼šåœ¨ `@EnableTransactionManagement` ä¸­æŒ‡å®š

```java
@Configuration
@EnableTransactionManagement  
@Transactional(transactionManager = "myTxManager")  // å…¨å±€æŒ‡å®š
public class AppConfig {
    // ...
}
```

**æ–¹å¼2**ï¼šé…ç½®æ–‡ä»¶æŒ‡å®šï¼ˆSpringBootï¼‰

```properties
# application.properties
spring.transaction.default-timeout=30
spring.transaction.rollback-on-commit-failure=true
```

---

## 5. ğŸ”€ å¤šäº‹åŠ¡ç®¡ç†å™¨é…ç½®


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šä¸ªäº‹åŠ¡ç®¡ç†å™¨


**å®é™…åœºæ™¯**ï¼šä¸€ä¸ªç³»ç»Ÿè¿æ¥å¤šä¸ªæ•°æ®åº“

```
ç”µå•†ç³»ç»Ÿæ¶æ„ï¼š
â”œâ”€â”€ è®¢å•æ•°æ®åº“ï¼ˆMySQLï¼‰
â”‚   â””â”€â”€ è®¢å•è¡¨ã€è®¢å•æ˜ç»†è¡¨
â”œâ”€â”€ å•†å“æ•°æ®åº“ï¼ˆMySQLï¼‰  
â”‚   â””â”€â”€ å•†å“è¡¨ã€åº“å­˜è¡¨
â””â”€â”€ æ—¥å¿—æ•°æ®åº“ï¼ˆMongoDBï¼‰
    â””â”€â”€ æ“ä½œæ—¥å¿—

éœ€è¦3ä¸ªäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ç®¡ç†ï¼
```

### 5.2 å¤šäº‹åŠ¡ç®¡ç†å™¨é…ç½®ç¤ºä¾‹


**é…ç½®ä»£ç **ï¼š

```java
@Configuration
@EnableTransactionManagement
public class MultiDataSourceConfig {
    
    // ========== è®¢å•æ•°æ®åº“é…ç½® ==========
    @Bean
    @Primary  // ğŸ‘ˆ è®¾ä¸ºä¸»æ•°æ®æº
    public DataSource orderDataSource() {
        DruidDataSource ds = new DruidDataSource();
        ds.setUrl("jdbc:mysql://localhost:3306/order_db");
        ds.setUsername("root");
        ds.setPassword("123456");
        return ds;
    }
    
    @Bean
    @Primary  // ğŸ‘ˆ è®¾ä¸ºä¸»äº‹åŠ¡ç®¡ç†å™¨
    public PlatformTransactionManager orderTxManager(
            @Qualifier("orderDataSource") DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
    
    // ========== å•†å“æ•°æ®åº“é…ç½® ==========
    @Bean
    public DataSource productDataSource() {
        DruidDataSource ds = new DruidDataSource();
        ds.setUrl("jdbc:mysql://localhost:3306/product_db");
        ds.setUsername("root");
        ds.setPassword("123456");
        return ds;
    }
    
    @Bean
    public PlatformTransactionManager productTxManager(
            @Qualifier("productDataSource") DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}
```

**å…³é”®æ³¨è§£è¯´æ˜**ï¼š
- `@Primary`ï¼šæ ‡è®°**é»˜è®¤**ä½¿ç”¨çš„Beanï¼ˆå½“æœ‰å¤šä¸ªåŒç±»å‹Beanæ—¶ï¼‰
- `@Qualifier`ï¼š**æŒ‡å®š**ä½¿ç”¨å“ªä¸ªBeanï¼ˆæŒ‰åç§°æ³¨å…¥ï¼‰

### 5.3 ä½¿ç”¨ä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨


```java
@Service
public class OrderService {
    
    // ä½¿ç”¨è®¢å•æ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆé»˜è®¤ï¼‰
    @Transactional  
    public void createOrder() {
        // æ“ä½œorder_dbæ•°æ®åº“
    }
    
    // ä½¿ç”¨å•†å“æ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆæŒ‡å®šï¼‰
    @Transactional(transactionManager = "productTxManager")
    public void updateStock() {
        // æ“ä½œproduct_dbæ•°æ®åº“
    }
}
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š

```
å®¢æˆ·ç«¯è°ƒç”¨createOrder()
    â†“
orderTxManagerå¼€å¯äº‹åŠ¡ï¼ˆé»˜è®¤ï¼‰
    â†“
æ‰§è¡Œè®¢å•æ•°æ®åº“æ“ä½œ
    â†“
æˆåŠŸ â†’ orderTxManageræäº¤
å¤±è´¥ â†’ orderTxManagerå›æ»š

å®¢æˆ·ç«¯è°ƒç”¨updateStock()
    â†“
productTxManagerå¼€å¯äº‹åŠ¡ï¼ˆæŒ‡å®šï¼‰
    â†“
æ‰§è¡Œå•†å“æ•°æ®åº“æ“ä½œ
    â†“
æˆåŠŸ â†’ productTxManageræäº¤
å¤±è´¥ â†’ productTxManagerå›æ»š
```

### 5.4 å¤šäº‹åŠ¡ç®¡ç†å™¨æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š

```java
// 1. è®¾ç½®é»˜è®¤äº‹åŠ¡ç®¡ç†å™¨ï¼ˆæœ€å¸¸ç”¨çš„ï¼‰
@Bean
@Primary
public PlatformTransactionManager mainTxManager(DataSource dataSource) {
    return new DataSourceTransactionManager(dataSource);
}

// 2. å…¶ä»–äº‹åŠ¡ç®¡ç†å™¨æ˜ç¡®å‘½å
@Bean
public PlatformTransactionManager logTxManager(
        @Qualifier("logDataSource") DataSource dataSource) {
    return new DataSourceTransactionManager(dataSource);
}

// 3. ä½¿ç”¨æ—¶æ¸…æ™°æŒ‡å®š
@Transactional  // é»˜è®¤ç”¨mainTxManager
public void normalOperation() { }

@Transactional(transactionManager = "logTxManager")  // æ˜ç¡®æŒ‡å®š
public void logOperation() { }
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š

| æ³¨æ„ç‚¹ | **è¯´æ˜** | **åæœ** |
|--------|---------|---------|
| **å¿…é¡»æŒ‡å®šåç§°** | å¤šä¸ªåŒç±»å‹Beanæ—¶å¿…é¡»æ˜ç¡® | å¦åˆ™å¯åŠ¨æŠ¥é”™ |
| **@Primaryä½œç”¨** | æ ‡è®°é»˜è®¤Bean | é¿å…æ­§ä¹‰ |
| **è·¨åº“äº‹åŠ¡** | ä¸åŒæ•°æ®åº“çš„æ“ä½œ | éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ |

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 é…ç½®æ ¸å¿ƒæµç¨‹


```
ç¬¬ä¸€æ­¥ï¼šé…ç½®æ•°æ®æº
    â†“
ç¬¬äºŒæ­¥ï¼šé…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼ˆä¾èµ–æ•°æ®æºï¼‰
    â†“
ç¬¬ä¸‰æ­¥ï¼šå¼€å¯äº‹åŠ¡ç®¡ç†ï¼ˆ@EnableTransactionManagementï¼‰
    â†“
ç¬¬å››æ­¥ï¼šä½¿ç”¨äº‹åŠ¡æ³¨è§£ï¼ˆ@Transactionalï¼‰
```

### 6.2 å…³é”®é…ç½®è¦ç´ 


**ğŸ”¸ æ•°æ®æºé…ç½®**
```
ä½œç”¨ï¼šæä¾›æ•°æ®åº“è¿æ¥
å¿…éœ€ï¼šurlã€usernameã€passwordã€driver
```

**ğŸ”¸ äº‹åŠ¡ç®¡ç†å™¨é…ç½®**
```
ç±»å‹ï¼šDataSourceTransactionManagerï¼ˆæœ€å¸¸ç”¨ï¼‰
ä¾èµ–ï¼šéœ€è¦DataSource
åç§°ï¼šé»˜è®¤transactionManager
```

**ğŸ”¸ å¼€å¯äº‹åŠ¡ç®¡ç†**
```
ä¼ ç»ŸSpringï¼š@EnableTransactionManagement
SpringBootï¼šè‡ªåŠ¨å¼€å¯ï¼ˆæ— éœ€é…ç½®ï¼‰
```

**ğŸ”¸ æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨**
```
é»˜è®¤ï¼šBeanåä¸ºtransactionManagerè‡ªåŠ¨ä½¿ç”¨
æŒ‡å®šï¼š@Transactional(transactionManager = "åç§°")
å¤šä¸ªï¼šç”¨@Primaryæ ‡è®°é»˜è®¤ï¼Œå…¶ä»–æ˜ç¡®æŒ‡å®š
```

### 6.3 å®é™…å¼€å‘å»ºè®®


**âœ… å•æ•°æ®æºé¡¹ç›®**ï¼ˆæœ€ç®€å•ï¼‰ï¼š
```java
// SpringBooté¡¹ç›®åªéœ€é…ç½®æ•°æ®æº
spring.datasource.url=...
spring.datasource.username=...
spring.datasource.password=...

// å…¶ä»–å…¨è‡ªåŠ¨ï¼
```

**âœ… å¤šæ•°æ®æºé¡¹ç›®**ï¼ˆéœ€è¦æ‰‹åŠ¨é…ç½®ï¼‰ï¼š
```java
// 1. é…ç½®å¤šä¸ªæ•°æ®æº
@Bean DataSource ds1() { }
@Bean DataSource ds2() { }

// 2. é…ç½®å¤šä¸ªäº‹åŠ¡ç®¡ç†å™¨
@Bean @Primary TransactionManager tm1() { }
@Bean TransactionManager tm2() { }

// 3. ä½¿ç”¨æ—¶æŒ‡å®š
@Transactional(transactionManager = "tm2")
```

### 6.4 å¸¸è§é—®é¢˜é€ŸæŸ¥


| é—®é¢˜ | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|---------|------------|
| äº‹åŠ¡ä¸ç”Ÿæ•ˆ | æœªå¼€å¯äº‹åŠ¡ç®¡ç† | æ·»åŠ @EnableTransactionManagement |
| æ‰¾ä¸åˆ°äº‹åŠ¡ç®¡ç†å™¨ | Beanåç§°ä¸å¯¹ | æŒ‡å®štransactionManagerå±æ€§ |
| å¤šæ•°æ®æºæŠ¥é”™ | æ²¡æœ‰é»˜è®¤Bean | æ·»åŠ @Primaryæ³¨è§£ |
| è·¨åº“äº‹åŠ¡å¤±è´¥ | å•åº“äº‹åŠ¡ç®¡ç†å™¨ | ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ |

**æ ¸å¿ƒè®°å¿†**ï¼š
- äº‹åŠ¡ç®¡ç†å™¨ = æ•°æ®æºçš„äº‹åŠ¡æ§åˆ¶å¼€å…³
- é…ç½®é¡ºåºï¼šæ•°æ®æº â†’ äº‹åŠ¡ç®¡ç†å™¨ â†’ å¼€å¯åŠŸèƒ½ â†’ ä½¿ç”¨æ³¨è§£
- é»˜è®¤æ‰¾transactionManagerï¼Œå¤šä¸ªç”¨@Primary + æ˜ç¡®æŒ‡å®š
- SpringBootè‡ªåŠ¨é…ç½®ï¼Œä¼ ç»ŸSpringæ‰‹åŠ¨é…ç½®