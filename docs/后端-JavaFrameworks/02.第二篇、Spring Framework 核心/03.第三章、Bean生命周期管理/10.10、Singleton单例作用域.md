---
title: 10ã€Singletonå•ä¾‹ä½œç”¨åŸŸ
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Beanä½œç”¨åŸŸ](#1-ä»€ä¹ˆæ˜¯beanä½œç”¨åŸŸ)
2. [Singletonå•ä¾‹ä½œç”¨åŸŸè¯¦è§£](#2-singletonå•ä¾‹ä½œç”¨åŸŸè¯¦è§£)
3. [Singletonçš„å·¥ä½œæœºåˆ¶](#3-singletonçš„å·¥ä½œæœºåˆ¶)
4. [çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#4-çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
5. [æ€§èƒ½ä¼˜åŠ¿ä¸æœ€ä½³å®è·µ](#5-æ€§èƒ½ä¼˜åŠ¿ä¸æœ€ä½³å®è·µ)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯Beanä½œç”¨åŸŸ


### 1.1 ä½œç”¨åŸŸçš„åŸºæœ¬æ¦‚å¿µ


**ä½œç”¨åŸŸï¼ˆScopeï¼‰**ï¼šç®€å•è¯´å°±æ˜¯**Beanå¯¹è±¡çš„ç”Ÿå­˜èŒƒå›´å’Œåˆ›å»ºè§„åˆ™**ã€‚

> ğŸ’­ **ç”Ÿæ´»ç±»æ¯”**
> 
> æƒ³è±¡ä½ åœ¨å…¬å¸é‡Œï¼š
> - **å•ä¾‹æ¨¡å¼**ï¼šæ•´ä¸ªå…¬å¸åªæœ‰ä¸€å°æ‰“å°æœºï¼Œæ‰€æœ‰äººå…±ç”¨
> - **åŸå‹æ¨¡å¼**ï¼šæ¯ä¸ªå‘˜å·¥éƒ½æœ‰è‡ªå·±çš„ç¬”è®°æœ¬ï¼Œå„ç”¨å„çš„
> 
> ä½œç”¨åŸŸå°±æ˜¯å†³å®š"è¿™ä¸ªä¸œè¥¿æ˜¯å¤§å®¶å…±ç”¨ä¸€ä¸ªï¼Œè¿˜æ˜¯æ¯äººä¸€ä¸ª"

**ä¸ºä»€ä¹ˆéœ€è¦ä½œç”¨åŸŸï¼Ÿ**
- æ§åˆ¶å¯¹è±¡åˆ›å»ºçš„æ•°é‡
- ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
- ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯éœ€æ±‚

### 1.2 Springæ”¯æŒçš„ä½œç”¨åŸŸç±»å‹


| ä½œç”¨åŸŸ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|--------|------|---------|
| **singleton** | å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ˆé»˜è®¤ï¼‰ | æ— çŠ¶æ€çš„æœåŠ¡ç±» |
| **prototype** | æ¯æ¬¡è·å–åˆ›å»ºæ–°å®ä¾‹ | æœ‰çŠ¶æ€çš„å¯¹è±¡ |
| **request** | æ¯ä¸ªHTTPè¯·æ±‚ä¸€ä¸ªå®ä¾‹ | Webåº”ç”¨ |
| **session** | æ¯ä¸ªHTTPä¼šè¯ä¸€ä¸ªå®ä¾‹ | ç”¨æˆ·ä¼šè¯æ•°æ® |
| **application** | æ•´ä¸ªWebåº”ç”¨ä¸€ä¸ªå®ä¾‹ | å…¨å±€é…ç½® |

> ğŸ“Œ **é‡ç‚¹æé†’**
> 
> åœ¨Springä¸­ï¼Œ**singletonæ˜¯é»˜è®¤ä½œç”¨åŸŸ**ï¼Œå¦‚æœä¸ç‰¹åˆ«æŒ‡å®šï¼Œæ‰€æœ‰Beanéƒ½æ˜¯å•ä¾‹çš„ã€‚

---

## 2. ğŸ† Singletonå•ä¾‹ä½œç”¨åŸŸè¯¦è§£


### 2.1 Singletonçš„æ ¸å¿ƒå®šä¹‰


**Singletonå•ä¾‹**ï¼šåœ¨æ•´ä¸ªSpringå®¹å™¨ä¸­ï¼Œä¸€ä¸ªBeanå®šä¹‰åªä¼šåˆ›å»º**ä¸€ä¸ªå¯¹è±¡å®ä¾‹**ï¼Œæ‰€æœ‰å¯¹è¿™ä¸ªBeançš„è¯·æ±‚éƒ½è¿”å›åŒä¸€ä¸ªå¯¹è±¡ã€‚

```
Springå®¹å™¨å¯åŠ¨
     â†“
åˆ›å»ºUserServiceå®ä¾‹ï¼ˆåªåˆ›å»ºä¸€æ¬¡ï¼‰
     â†“
å­˜å‚¨åœ¨å®¹å™¨çš„å•ä¾‹ç¼“å­˜ä¸­
     â†“
æ‰€æœ‰æ³¨å…¥ç‚¹éƒ½ä½¿ç”¨è¿™ä¸ªå®ä¾‹

UserController â†’ ä½¿ç”¨åŒä¸€ä¸ªUserServiceå®ä¾‹
OrderController â†’ ä½¿ç”¨åŒä¸€ä¸ªUserServiceå®ä¾‹  
PaymentService â†’ ä½¿ç”¨åŒä¸€ä¸ªUserServiceå®ä¾‹
```

**å…³é”®ç†è§£ï¼š**
- **å®¹å™¨çº§åˆ«å•ä¾‹**ï¼šä¸æ˜¯JVMçº§åˆ«ï¼Œæ˜¯Springå®¹å™¨çº§åˆ«
- **æ‡’åŠ è½½å¯é€‰**ï¼šå¯ä»¥é…ç½®ä¸ºå®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œæˆ–é¦–æ¬¡ä½¿ç”¨æ—¶åˆ›å»º
- **çº¿ç¨‹å…±äº«**ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡

### 2.2 å¦‚ä½•é…ç½®Singletonä½œç”¨åŸŸ


**æ–¹å¼1ï¼šé»˜è®¤å°±æ˜¯å•ä¾‹ï¼ˆä¸éœ€è¦é…ç½®ï¼‰**
```java
@Component
public class UserService {
    // é»˜è®¤å°±æ˜¯singletonä½œç”¨åŸŸ
}
```

**æ–¹å¼2ï¼šæ˜¾å¼å£°æ˜**
```java
@Component
@Scope("singleton")  // æ˜ç¡®æŒ‡å®š
public class UserService {
    // ...
}
```

**æ–¹å¼3ï¼šä½¿ç”¨å¸¸é‡**
```java
@Component
@Scope(ConfigurableBeanFactory.SCOPE_SINGLETON)
public class UserService {
    // æ¨èä½¿ç”¨å¸¸é‡ï¼Œé¿å…å­—ç¬¦ä¸²æ‹¼å†™é”™è¯¯
}
```

**æ–¹å¼4ï¼šXMLé…ç½®ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰**
```xml
<bean id="userService" 
      class="com.example.UserService" 
      scope="singleton"/>
```

### 2.3 Singleton vs æ™®é€šå•ä¾‹æ¨¡å¼


```
ç»å…¸å•ä¾‹æ¨¡å¼ï¼ˆJavaï¼‰          Spring Singleton
        â†“                           â†“
privateæ„é€ å‡½æ•°               publicæ„é€ å‡½æ•°
static getInstance()         å®¹å™¨ç®¡ç†å®ä¾‹
åŒé‡æ£€æŸ¥é”å®š                   æ— éœ€æ‰‹åŠ¨åŠ é”
JVMçº§åˆ«å”¯ä¸€                   å®¹å™¨çº§åˆ«å”¯ä¸€
æ‰‹åŠ¨æ§åˆ¶åˆ›å»º                   æ¡†æ¶è‡ªåŠ¨ç®¡ç†
```

**æ ¸å¿ƒåŒºåˆ«ï¼š**

| å¯¹æ¯”é¡¹ | ç»å…¸å•ä¾‹æ¨¡å¼ | Spring Singleton |
|--------|-------------|------------------|
| **å®ç°éš¾åº¦** | éœ€è¦æ‰‹å†™å•ä¾‹ä»£ç  | åŠ ä¸ªæ³¨è§£å³å¯ |
| **ä½œç”¨èŒƒå›´** | æ•´ä¸ªJVM | Springå®¹å™¨å†… |
| **çº¿ç¨‹å®‰å…¨** | éœ€è¦è‡ªå·±ä¿è¯ | å®¹å™¨ä¿è¯åˆ›å»ºå®‰å…¨ |
| **çµæ´»æ€§** | ä»£ç å†™æ­» | é…ç½®å¯åˆ‡æ¢ |

> ğŸ’¡ **å…³é”®ç†è§£**
> 
> Springçš„å•ä¾‹ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„å•ä¾‹æ¨¡å¼ï¼Œè€Œæ˜¯**å®¹å™¨ç®¡ç†çš„å•å®ä¾‹å¯¹è±¡**ã€‚
> ä¸€ä¸ªåº”ç”¨å¯ä»¥æœ‰å¤šä¸ªSpringå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨é‡Œçš„å•ä¾‹Beanæ˜¯ç‹¬ç«‹çš„ã€‚

---

## 3. âš™ï¸ Singletonçš„å·¥ä½œæœºåˆ¶


### 3.1 Beançš„åˆ›å»ºæ—¶æœº


**æƒ…å†µ1ï¼šç«‹å³åˆ›å»ºï¼ˆEager Initializationï¼‰**
```java
@Component
public class UserService {
    public UserService() {
        System.out.println("UserServiceè¢«åˆ›å»ºäº†");
    }
}

// å®¹å™¨å¯åŠ¨æ—¶å°±ä¼šè¾“å‡ºï¼šUserServiceè¢«åˆ›å»ºäº†
```

**æƒ…å†µ2ï¼šå»¶è¿Ÿåˆ›å»ºï¼ˆLazy Initializationï¼‰**
```java
@Component
@Lazy  // æ ‡è®°ä¸ºæ‡’åŠ è½½
public class ReportService {
    public ReportService() {
        System.out.println("ReportServiceè¢«åˆ›å»ºäº†");
    }
}

// å®¹å™¨å¯åŠ¨æ—¶ä¸åˆ›å»ºï¼Œé¦–æ¬¡ä½¿ç”¨æ—¶æ‰è¾“å‡ºï¼šReportServiceè¢«åˆ›å»ºäº†
```

**åˆ›å»ºæ—¶æœºå¯¹æ¯”ï¼š**

```
ç«‹å³åˆ›å»ºï¼ˆé»˜è®¤ï¼‰ï¼š
å®¹å™¨å¯åŠ¨ â”€â”€â†’ åˆ›å»ºBean â”€â”€â†’ å­˜å…¥ç¼“å­˜ â”€â”€â†’ ç­‰å¾…ä½¿ç”¨
ä¼˜ç‚¹ï¼šå¯åŠ¨æ—¶å‘ç°é—®é¢˜    ç¼ºç‚¹ï¼šå¯åŠ¨æ…¢

å»¶è¿Ÿåˆ›å»ºï¼ˆ@Lazyï¼‰ï¼š
å®¹å™¨å¯åŠ¨ â”€â”€â†’ è·³è¿‡åˆ›å»º â”€â”€â†’ é¦–æ¬¡ä½¿ç”¨ â”€â”€â†’ åˆ›å»ºBean
ä¼˜ç‚¹ï¼šå¯åŠ¨å¿«            ç¼ºç‚¹ï¼šè¿è¡Œæ—¶æ‰å‘ç°é—®é¢˜
```

### 3.2 å•ä¾‹ç¼“å­˜æ± æœºåˆ¶


Springå®¹å™¨å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª**å•ä¾‹ç¼“å­˜æ± **ï¼ˆSingletonObjects Mapï¼‰ï¼Œç”¨æ¥å­˜å‚¨æ‰€æœ‰å•ä¾‹Beanã€‚

```
å•ä¾‹ç¼“å­˜æ± ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Map<String, Object>            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  "userService"    â†’ UserServiceå®ä¾‹    â”‚
â”‚  "orderService"   â†’ OrderServiceå®ä¾‹   â”‚
â”‚  "productService" â†’ ProductServiceå®ä¾‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è·å–Beançš„æµç¨‹ï¼š
1. æ£€æŸ¥ç¼“å­˜æ± æœ‰æ²¡æœ‰
2. æœ‰ â†’ ç›´æ¥è¿”å›
3. æ²¡æœ‰ â†’ åˆ›å»º â†’ æ”¾å…¥ç¼“å­˜ â†’ è¿”å›
```

**ç®€åŒ–çš„å†…éƒ¨å®ç°é€»è¾‘ï¼š**
```java
public class SingletonBeanRegistry {
    // å•ä¾‹ç¼“å­˜æ± 
    private Map<String, Object> singletonObjects = new ConcurrentHashMap<>();
    
    public Object getSingleton(String beanName) {
        // å…ˆä»ç¼“å­˜è·å–
        Object bean = singletonObjects.get(beanName);
        
        if (bean == null) {
            // ç¼“å­˜æ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„
            bean = createBean(beanName);
            // æ”¾å…¥ç¼“å­˜
            singletonObjects.put(beanName, bean);
        }
        
        return bean;
    }
}
```

---

## 4. ğŸ”’ çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


### 4.1 ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜


**æ ¸å¿ƒåŸåˆ™ï¼šå•ä¾‹Beanæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¦‚æœæœ‰å¯å˜çš„æˆå‘˜å˜é‡å°±ä¸å®‰å…¨äº†ã€‚**

> ğŸ’­ **ç”Ÿæ´»ç±»æ¯”**
> 
> å…¬å¸çš„æ‰“å°æœºï¼ˆå•ä¾‹ï¼‰æœ¬èº«æ²¡é—®é¢˜ï¼Œä½†å¦‚æœï¼š
> - æ‰“å°æœºæœ‰ä¸ª"å½“å‰æ‰“å°ä»»åŠ¡"çš„æ˜¾ç¤ºå±ï¼ˆæˆå‘˜å˜é‡ï¼‰
> - å¤šäººåŒæ—¶ä½¿ç”¨æ—¶ï¼Œæ˜¾ç¤ºå°±ä¼šä¹±
> 
> è¿™å°±æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼

**ä¸å®‰å…¨çš„ä¾‹å­ï¼š**
```java
@Component
public class UserService {
    // âŒ å±é™©ï¼šå¯å˜çš„æˆå‘˜å˜é‡
    private int count = 0;
    
    public void processUser() {
        count++;  // å¤šçº¿ç¨‹è®¿é—®ä¼šå‡ºé—®é¢˜
        System.out.println("å¤„ç†æ¬¡æ•°ï¼š" + count);
    }
}
```

**é—®é¢˜æ¼”ç¤ºï¼š**
```
çº¿ç¨‹Aè°ƒç”¨processUser()ï¼šcount++ (count=1)
çº¿ç¨‹Bè°ƒç”¨processUser()ï¼šcount++ (count=2)
çº¿ç¨‹Aè¯»å–countï¼šè¾“å‡º1 âŒ åº”è¯¥æ˜¯1
çº¿ç¨‹Bè¯»å–countï¼šè¾“å‡º2 âœ“
```

### 4.2 å¦‚ä½•åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜


ğŸ“‹ **æ£€æŸ¥æ¸…å•ï¼š**
- [ ] Beanä¸­æœ‰æ²¡æœ‰å¯å˜çš„æˆå‘˜å˜é‡ï¼ˆéfinalï¼‰
- [ ] è¿™äº›æˆå‘˜å˜é‡ä¼šä¸ä¼šè¢«å¤šä¸ªæ–¹æ³•ä¿®æ”¹
- [ ] æ–¹æ³•ä¼šä¸ä¼šè¢«å¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨
- [ ] æœ‰æ²¡æœ‰ä½¿ç”¨åŒæ­¥æœºåˆ¶ä¿æŠ¤

**å®‰å…¨çš„Beanç‰¹å¾ï¼š**
```java
@Component
public class SafeUserService {
    // âœ… å®‰å…¨ï¼šfinalä¿®é¥°çš„ä¾èµ–æ³¨å…¥
    private final UserRepository userRepository;
    
    // âœ… å®‰å…¨ï¼šä¸å¯å˜é…ç½®
    private final String appName = "MyApp";
    
    public SafeUserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    public User findUser(Long id) {
        // âœ… å®‰å…¨ï¼šå±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹
        User user = userRepository.findById(id);
        return user;
    }
}
```

### 4.3 è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹æ¡ˆ


**æ–¹æ¡ˆ1ï¼šæ— çŠ¶æ€è®¾è®¡ï¼ˆæœ€æ¨èï¼‰**
```java
@Component
public class UserService {
    // åªæ³¨å…¥ä¾èµ–ï¼Œä¸ä¿å­˜å¯å˜çŠ¶æ€
    private final UserRepository userRepository;
    
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
    
    // ä½¿ç”¨å‚æ•°ä¼ é€’æ•°æ®ï¼Œä¸ç”¨æˆå‘˜å˜é‡
    public User createUser(String name, int age) {
        User user = new User(name, age);
        return userRepository.save(user);
    }
}
```

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨ThreadLocalï¼ˆçº¿ç¨‹éš”ç¦»ï¼‰**
```java
@Component
public class RequestContextService {
    // æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å‰¯æœ¬
    private ThreadLocal<String> requestId = new ThreadLocal<>();
    
    public void setRequestId(String id) {
        requestId.set(id);
    }
    
    public String getRequestId() {
        return requestId.get();
    }
    
    public void clear() {
        requestId.remove();  // è®°å¾—æ¸…ç†
    }
}
```

**æ–¹æ¡ˆ3ï¼šåŠ é”ä¿æŠ¤ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰**
```java
@Component
public class CounterService {
    private int count = 0;
    
    // åŒæ­¥æ–¹æ³•
    public synchronized void increment() {
        count++;
    }
    
    // åŒæ­¥å—
    public void add(int value) {
        synchronized(this) {
            count += value;
        }
    }
}
```

**æ–¹æ¡ˆ4ï¼šæ”¹ç”¨Prototypeä½œç”¨åŸŸ**
```java
@Component
@Scope("prototype")  // æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹
public class TaskHandler {
    private int taskCount;  // ç°åœ¨å®‰å…¨äº†
    
    public void handle() {
        taskCount++;
    }
}
```

**æ–¹æ¡ˆå¯¹æ¯”ï¼š**

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **æ— çŠ¶æ€è®¾è®¡** | æ€§èƒ½æœ€å¥½ï¼Œæœ€å®‰å…¨ | éœ€è¦é‡æ–°è®¾è®¡ | ç»å¤§å¤šæ•°åœºæ™¯ |
| **ThreadLocal** | çº¿ç¨‹éš”ç¦»ï¼Œç®€å• | å†…å­˜æ³„æ¼é£é™© | è¯·æ±‚ä¸Šä¸‹æ–‡ |
| **åŠ é”** | å®ç°ç®€å• | æ€§èƒ½å·®ï¼Œå¯èƒ½æ­»é” | è®¡æ•°å™¨ç­‰ |
| **Prototype** | å¤©ç„¶çº¿ç¨‹å®‰å…¨ | å†…å­˜å¼€é”€å¤§ | æœ‰çŠ¶æ€ä»»åŠ¡ |

> âš ï¸ **é‡è¦æé†’**
> 
> åœ¨Springå¼€å‘ä¸­ï¼Œ**ä¼˜å…ˆä½¿ç”¨æ— çŠ¶æ€è®¾è®¡**ï¼Œè¿™æ˜¯æœ€ä½³å®è·µï¼
> å¦‚æœä¸€å®šè¦æœ‰çŠ¶æ€ï¼Œè€ƒè™‘ThreadLocalæˆ–æ”¹æˆPrototypeä½œç”¨åŸŸã€‚

---

## 5. ğŸš€ æ€§èƒ½ä¼˜åŠ¿ä¸æœ€ä½³å®è·µ


### 5.1 Singletonçš„æ€§èƒ½ä¼˜åŠ¿


**ä¼˜åŠ¿1ï¼šèŠ‚çœå†…å­˜**
```
Singletonæ¨¡å¼ï¼š
ApplicationContextå¯åŠ¨
    â†“
åˆ›å»º1ä¸ªUserServiceå®ä¾‹ (å‡è®¾å ç”¨1MBå†…å­˜)
    â†“
100ä¸ªControllerå…±ç”¨è¿™1ä¸ªå®ä¾‹
æ€»å†…å­˜ï¼š1MB

å¦‚æœæ˜¯Prototypeï¼š
æ¯ä¸ªControlleråˆ›å»ºä¸€ä¸ªå®ä¾‹
100ä¸ªå®ä¾‹ Ã— 1MB = 100MBå†…å­˜
```

**ä¼˜åŠ¿2ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºå¼€é”€**
```
å¯¹è±¡åˆ›å»ºæˆæœ¬ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ†é…å†…å­˜          â”‚ 
â”‚ 2. è°ƒç”¨æ„é€ å‡½æ•°      â”‚
â”‚ 3. ä¾èµ–æ³¨å…¥          â”‚
â”‚ 4. åˆå§‹åŒ–å›è°ƒ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Singletonï¼šåªæ‰§è¡Œä¸€æ¬¡
Prototypeï¼šæ¯æ¬¡ä½¿ç”¨éƒ½æ‰§è¡Œ
```

**ä¼˜åŠ¿3ï¼šä¾èµ–æ³¨å…¥æ•ˆç‡é«˜**
```
Singletonä¾èµ–æ³¨å…¥ï¼š
å®¹å™¨å¯åŠ¨ â†’ åˆ›å»ºBean â†’ æ³¨å…¥ä¾èµ– â†’ å®Œæˆ
          â†“
    æ‰€æœ‰ä½¿ç”¨è€…å…±äº«

Prototypeä¾èµ–æ³¨å…¥ï¼š
æ¯æ¬¡è¯·æ±‚ â†’ åˆ›å»ºBean â†’ æ³¨å…¥ä¾èµ– â†’ ä½¿ç”¨ â†’ é”€æ¯
          â†“
       é‡å¤æ‰§è¡Œ
```

### 5.2 ä½•æ—¶ä½¿ç”¨Singleton


âœ… **é€‚åˆä½¿ç”¨Singletonçš„åœºæ™¯ï¼š**

**1. æ— çŠ¶æ€çš„Serviceå±‚**
```java
@Service  // é»˜è®¤singleton
public class OrderService {
    // åªæœ‰ä¸šåŠ¡é€»è¾‘ï¼Œæ²¡æœ‰å®ä¾‹å˜é‡ä¿å­˜çŠ¶æ€
    public Order createOrder(Long userId) {
        // å¤„ç†é€»è¾‘
    }
}
```

**2. DAO/Repositoryå±‚**
```java
@Repository
public class UserRepository {
    // åªè´Ÿè´£æ•°æ®è®¿é—®ï¼Œä¸ä¿å­˜çŠ¶æ€
}
```

**3. å·¥å…·ç±»Bean**
```java
@Component
public class DateUtil {
    public String format(Date date) {
        // çº¯å·¥å…·æ–¹æ³•
    }
}
```

**4. é…ç½®ç±»**
```java
@Configuration
public class AppConfig {
    // é…ç½®ä¿¡æ¯ï¼Œä¸éœ€è¦æ¯æ¬¡åˆ›å»º
}
```

### 5.3 æœ€ä½³å®è·µå»ºè®®


**å®è·µ1ï¼šä¼˜å…ˆè®¾è®¡æ— çŠ¶æ€Bean**
```java
// âœ… å¥½çš„è®¾è®¡
@Service
public class UserService {
    private final UserRepository repository;  // finalä¿®é¥°
    
    public User getUser(Long id) {
        return repository.findById(id);  // å‚æ•°ä¼ é€’
    }
}

// âŒ ä¸å¥½çš„è®¾è®¡
@Service
public class UserService {
    private User currentUser;  // å¯å˜çŠ¶æ€
    
    public void setCurrentUser(User user) {
        this.currentUser = user;
    }
}
```

**å®è·µ2ï¼šåˆç†ä½¿ç”¨@Lazyå»¶è¿ŸåŠ è½½**
```java
// å¯åŠ¨æ—¶ä¸éœ€è¦çš„Beanï¼Œæ ‡è®°ä¸ºæ‡’åŠ è½½
@Component
@Lazy
public class ReportGenerator {
    // æŠ¥è¡¨ç”Ÿæˆå™¨ï¼Œä¸æ˜¯æ¯æ¬¡éƒ½ç”¨
}
```

**å®è·µ3ï¼šæ…ç”¨å¾ªç¯ä¾èµ–**
```java
// âŒ é¿å…è¿™æ ·çš„å¾ªç¯ä¾èµ–
@Component
public class ServiceA {
    @Autowired
    private ServiceB serviceB;
}

@Component
public class ServiceB {
    @Autowired
    private ServiceA serviceA;
}

// è§£å†³æ–¹æ¡ˆï¼šé‡æ–°è®¾è®¡ç±»ç»“æ„ï¼Œæˆ–ä½¿ç”¨@Lazyæ‰“ç ´å¾ªç¯
```

**å®è·µ4ï¼šç›‘æ§å•ä¾‹Beançš„ç”Ÿå‘½å‘¨æœŸ**
```java
@Component
public class MonitorService implements InitializingBean, DisposableBean {
    
    @Override
    public void afterPropertiesSet() {
        System.out.println("Beanåˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void destroy() {
        System.out.println("Beanå³å°†é”€æ¯");
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Singletonå®šä¹‰ï¼šå®¹å™¨ä¸­åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œæ‰€æœ‰è¯·æ±‚å…±ç”¨
ğŸ”¸ é»˜è®¤ä½œç”¨åŸŸï¼šSpringä¸­ä¸æŒ‡å®šä½œç”¨åŸŸæ—¶ï¼Œé»˜è®¤å°±æ˜¯Singleton
ğŸ”¸ å®¹å™¨çº§åˆ«ï¼šä¸æ˜¯JVMçº§åˆ«çš„å•ä¾‹ï¼Œæ˜¯Springå®¹å™¨çº§åˆ«
ğŸ”¸ çº¿ç¨‹å®‰å…¨ï¼šå•ä¾‹Beanå¦‚æœæœ‰å¯å˜æˆå‘˜å˜é‡ï¼Œä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜
ğŸ”¸ æ€§èƒ½ä¼˜åŠ¿ï¼šèŠ‚çœå†…å­˜ã€å‡å°‘åˆ›å»ºå¼€é”€ã€æé«˜æ•ˆç‡
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Singletonä¸ç­‰äºçº¿ç¨‹å®‰å…¨**
```
å•ä¾‹ä¿è¯ï¼šåªæœ‰ä¸€ä¸ªå®ä¾‹
çº¿ç¨‹å®‰å…¨ï¼šå¤šçº¿ç¨‹è®¿é—®æ•°æ®ä¸å‡ºé”™

å®ƒä»¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µï¼
å•ä¾‹Beanéœ€è¦é€šè¿‡æ— çŠ¶æ€è®¾è®¡æ¥ä¿è¯çº¿ç¨‹å®‰å…¨
```

**ğŸ”¹ ä½•æ—¶é€‰æ‹©Singleton vs Prototype**
```
é€‰æ‹©Singletonï¼š
- Serviceã€Repositoryã€Controllerå±‚
- å·¥å…·ç±»ã€é…ç½®ç±»
- æ— çŠ¶æ€çš„Bean

é€‰æ‹©Prototypeï¼š
- æœ‰çŠ¶æ€çš„å¯¹è±¡
- éœ€è¦éš”ç¦»çš„ä»»åŠ¡å¤„ç†å™¨
- æ¯æ¬¡ä½¿ç”¨éœ€è¦å…¨æ–°å®ä¾‹çš„åœºæ™¯
```

**ğŸ”¹ æœ€ä½³å®è·µæ ¸å¿ƒ**
```
1. ä¼˜å…ˆè®¾è®¡æ— çŠ¶æ€Beanï¼ˆæœ€é‡è¦ï¼‰
2. ä¾èµ–æ³¨å…¥ä½¿ç”¨finalä¿®é¥°
3. é¿å…å¯å˜çš„æˆå‘˜å˜é‡
4. å¿…è¦æ—¶ä½¿ç”¨ThreadLocalæˆ–æ”¹Prototype
5. åˆç†ä½¿ç”¨@Lazyå»¶è¿ŸåŠ è½½
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


ğŸ“Š **å…¸å‹åº”ç”¨åœºæ™¯ï¼š**

**Webåº”ç”¨å¼€å‘ï¼š**
- Controllerï¼šå¤„ç†HTTPè¯·æ±‚ â†’ Singleton
- Serviceï¼šä¸šåŠ¡é€»è¾‘å¤„ç† â†’ Singleton
- Repositoryï¼šæ•°æ®è®¿é—® â†’ Singleton

**å¾®æœåŠ¡å¼€å‘ï¼š**
- é…ç½®ç®¡ç†ï¼šå…¨å±€é…ç½®Bean â†’ Singleton
- ç¼“å­˜æœåŠ¡ï¼šç¼“å­˜ç®¡ç†å™¨ â†’ Singleton
- å·¥å…·æœåŠ¡ï¼šæ—¥æœŸã€åŠ å¯†ç­‰ â†’ Singleton

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- å‡å°‘80%ä»¥ä¸Šçš„å¯¹è±¡åˆ›å»ºå¼€é”€
- é™ä½å†…å­˜å ç”¨
- æå‡ä¾èµ–æ³¨å…¥æ•ˆç‡

ğŸ¯ **å­¦ä¹ æ£€æŸ¥æ¸…å•ï¼š**
- [ ] ç†è§£Singletonæ˜¯Springçš„é»˜è®¤ä½œç”¨åŸŸ
- [ ] æŒæ¡å¦‚ä½•é…ç½®å’Œä½¿ç”¨Singleton
- [ ] çŸ¥é“Singletonçš„çº¿ç¨‹å®‰å…¨é—®é¢˜
- [ ] ä¼šä½¿ç”¨æ— çŠ¶æ€è®¾è®¡é¿å…å¹¶å‘é—®é¢˜
- [ ] äº†è§£ä½•æ—¶é€‰æ‹©Singleton vs Prototype

**æ ¸å¿ƒè®°å¿†å£è¯€ï¼š**
```
ğŸµ å•ä¾‹é»˜è®¤å®¹å™¨é€ ï¼Œä¸€ä¸ªå®ä¾‹å¤§å®¶ç”¨
   æ— çŠ¶æ€è®¾è®¡æœ€å®‰å…¨ï¼Œæœ‰çŠ¶æ€æ”¹ç”¨åŸå‹æ¨¡å¼
   æ€§èƒ½ä¼˜åŠ¿å¾ˆæ˜æ˜¾ï¼Œåˆç†ä½¿ç”¨æ˜¯å…³é”®
```