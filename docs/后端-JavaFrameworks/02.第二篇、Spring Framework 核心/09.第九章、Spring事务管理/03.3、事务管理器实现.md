---
title: 3ã€äº‹åŠ¡ç®¡ç†å™¨å®ç°
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨](#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨)
2. [DataSourceTransactionManagerè¯¦è§£](#2-DataSourceTransactionManagerè¯¦è§£)
3. [JtaTransactionManagerè¯¦è§£](#3-JtaTransactionManagerè¯¦è§£)
4. [HibernateTransactionManagerè¯¦è§£](#4-HibernateTransactionManagerè¯¦è§£)
5. [å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡ç®¡ç†å™¨](#5-å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡ç®¡ç†å™¨)
6. [é…ç½®æ–¹å¼è¯¦è§£](#6-é…ç½®æ–¹å¼è¯¦è§£)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯äº‹åŠ¡ç®¡ç†å™¨


### 1.1 äº‹åŠ¡ç®¡ç†å™¨çš„æœ¬è´¨


**ç®€å•ç†è§£**ï¼šäº‹åŠ¡ç®¡ç†å™¨å°±åƒé“¶è¡Œçš„**è½¬è´¦å¤„ç†å‘˜**ï¼Œè´Ÿè´£ç¡®ä¿è½¬è´¦æ“ä½œè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥ã€‚

```
ç°å®åœºæ™¯ç±»æ¯”ï¼š
é“¶è¡Œè½¬è´¦ï¼šå°æ˜å‘å°çº¢è½¬è´¦1000å…ƒ
1. ä»å°æ˜è´¦æˆ·æ‰£é™¤1000å…ƒ âœ“
2. å‘å°çº¢è´¦æˆ·å¢åŠ 1000å…ƒ âœ“
ç»“æœï¼šè½¬è´¦æˆåŠŸ

å¦‚æœç¬¬2æ­¥å¤±è´¥äº†ï¼š
1. ä»å°æ˜è´¦æˆ·æ‰£é™¤1000å…ƒ âœ“
2. å‘å°çº¢è´¦æˆ·å¢åŠ 1000å…ƒ âœ— (ç³»ç»Ÿæ•…éšœ)
äº‹åŠ¡ç®¡ç†å™¨çš„ä½œç”¨ï¼šæ’¤é”€ç¬¬1æ­¥ï¼Œæ¢å¤å°æ˜çš„1000å…ƒ
```

### 1.2 Springä¸­çš„äº‹åŠ¡ç®¡ç†å™¨æ¶æ„


```
Springäº‹åŠ¡ç®¡ç†ä½“ç³»ï¼š
                PlatformTransactionManager (æ¥å£)
                         |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        |                |                |
DataSourceTransaction  JtaTransaction  HibernateTransaction
     Manager             Manager          Manager
        |                |                |
   æ“ä½œJDBCæ•°æ®åº“      æ“ä½œåˆ†å¸ƒå¼äº‹åŠ¡      æ“ä½œHibernate
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **PlatformTransactionManager**ï¼šSpringäº‹åŠ¡ç®¡ç†çš„**æ€»æ¥å£**
- **ä¸åŒå®ç°ç±»**ï¼šé’ˆå¯¹ä¸åŒçš„**æ•°æ®è®¿é—®æŠ€æœ¯**æä¾›äº‹åŠ¡ç®¡ç†
- **ç»Ÿä¸€API**ï¼šæ— è®ºåº•å±‚ç”¨ä»€ä¹ˆæŠ€æœ¯ï¼Œä½¿ç”¨æ–¹å¼éƒ½ä¸€æ ·

---

## 2. ğŸ’¾ DataSourceTransactionManagerè¯¦è§£


### 2.1 ä»€ä¹ˆæ˜¯DataSourceTransactionManager


**é€šä¿—è§£é‡Š**ï¼šè¿™æ˜¯ä¸“é—¨ç®¡ç†**å•ä¸ªæ•°æ®åº“è¿æ¥**äº‹åŠ¡çš„ç®¡ç†å™¨ï¼Œå°±åƒä¸“é—¨è´Ÿè´£ä¸€ä¸ªé“¶è¡Œç½‘ç‚¹ä¸šåŠ¡çš„ç»ç†ã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- ä½¿ç”¨**JDBC**ç›´æ¥æ“ä½œæ•°æ®åº“
- ä½¿ç”¨**MyBatis**æ¡†æ¶
- ä½¿ç”¨**JdbcTemplate**
- **å•æ•°æ®æº**åº”ç”¨

### 2.2 å·¥ä½œåŸç†å›¾è§£


```
DataSourceTransactionManagerå·¥ä½œæµç¨‹ï¼š
     
åº”ç”¨ä»£ç                 DataSource              æ•°æ®åº“
   |                      |                     |
   |--[1]å¼€å§‹äº‹åŠ¡--------->|                     |
   |                      |--[2]è·å–è¿æ¥------->|
   |                      |<-[3]è¿”å›è¿æ¥--------|
   |--[4]æ‰§è¡ŒSQL--------->|--[5]å‘é€SQL-------->|
   |<--[6]è¿”å›ç»“æœ--------|<--[7]è¿”å›ç»“æœ-------|
   |--[8]æäº¤/å›æ»š------->|--[9]æäº¤/å›æ»š------>|
   |                      |--[10]å…³é—­è¿æ¥------>|
```

### 2.3 é…ç½®ç¤ºä¾‹


**åŸºç¡€é…ç½®**ï¼š
```xml
<!-- æ•°æ®æºé…ç½® -->
<bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">
    <property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/>
    <property name="jdbcUrl" value="jdbc:mysql://localhost:3306/mydb"/>
    <property name="username" value="root"/>
    <property name="password" value="password"/>
</bean>

<!-- äº‹åŠ¡ç®¡ç†å™¨é…ç½® -->
<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <property name="dataSource" ref="dataSource"/>
</bean>
```

**Javaé…ç½®æ–¹å¼**ï¼š
```java
@Configuration
@EnableTransactionManagement
public class TransactionConfig {
    
    @Bean
    public DataSource dataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
        dataSource.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        dataSource.setUsername("root");
        dataSource.setPassword("password");
        return dataSource;
    }
    
    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());
    }
}
```

### 2.4 ä½¿ç”¨åœºæ™¯å’Œç‰¹ç‚¹


| **ç‰¹ç‚¹** | **è¯´æ˜** | **ä¸¾ä¾‹** |
|---------|----------|---------|
| ğŸ¯ **ç®€å•æ˜“ç”¨** | é…ç½®ç®€å•ï¼Œæ€§èƒ½å¥½ | å°å‹Webåº”ç”¨ï¼Œå•åº“æ“ä½œ |
| ğŸ’ª **æ€§èƒ½ä¼˜å¼‚** | ç›´æ¥æ“ä½œJDBCè¿æ¥ | é«˜å¹¶å‘æŸ¥è¯¢ï¼Œæ‰¹é‡å¤„ç† |
| âš¡ **å“åº”å¿«é€Ÿ** | æ²¡æœ‰é¢å¤–åè°ƒå¼€é”€ | å®æ—¶äº¤æ˜“ç³»ç»Ÿ |
| âš ï¸ **å•æ•°æ®æºé™åˆ¶** | åªèƒ½ç®¡ç†ä¸€ä¸ªæ•°æ®åº“ | ä¸é€‚åˆå¤šåº“åˆ†å¸ƒå¼åœºæ™¯ |

**å®é™…ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Service
@Transactional  // ä½¿ç”¨DataSourceTransactionManager
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œ
    public void transferMoney(Long fromUserId, Long toUserId, BigDecimal amount) {
        // 1. æ‰£å‡è½¬å‡ºç”¨æˆ·ä½™é¢
        userMapper.decreaseBalance(fromUserId, amount);
        
        // 2. å¢åŠ è½¬å…¥ç”¨æˆ·ä½™é¢
        userMapper.increaseBalance(toUserId, amount);
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œæ•´ä¸ªæ“ä½œä¼šå›æ»š
    }
}
```

---

## 3. ğŸŒ JtaTransactionManagerè¯¦è§£


### 3.1 ä»€ä¹ˆæ˜¯JtaTransactionManager


**é€šä¿—è§£é‡Š**ï¼šJTAå°±åƒ**è·¨é“¶è¡Œè½¬è´¦çš„åè°ƒå‘˜**ï¼Œå¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªé“¶è¡Œï¼ˆæ•°æ®åº“ï¼‰çš„è½¬è´¦æ“ä½œã€‚

**JTAå…¨ç§°**ï¼šJava Transaction APIï¼ˆJavaäº‹åŠ¡æ¥å£ï¼‰

**æ ¸å¿ƒä½œç”¨**ï¼šç®¡ç†**åˆ†å¸ƒå¼äº‹åŠ¡**ï¼Œå³æ¶‰åŠå¤šä¸ªæ•°æ®æºçš„äº‹åŠ¡æ“ä½œã€‚

### 3.2 åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯å›¾è§£


```
ä¼ ç»Ÿå•æ•°æ®åº“äº‹åŠ¡ï¼š
   åº”ç”¨ â†’ [äº‹åŠ¡] â†’ æ•°æ®åº“A
   
åˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯ï¼š
           JTAäº‹åŠ¡ç®¡ç†å™¨
                |
   åº”ç”¨ â†’ [åˆ†å¸ƒå¼äº‹åŠ¡] â†’ æ•°æ®åº“A
                |      â†’ æ•°æ®åº“B  
                |      â†’ æ¶ˆæ¯é˜Ÿåˆ—
                |      â†’ å…¶ä»–èµ„æº
```

**å®é™…ä¸šåŠ¡åœºæ™¯**ï¼š
```
ç”µå•†ä¸‹å•åœºæ™¯ï¼š
1. è®¢å•æ•°æ®åº“ï¼šåˆ›å»ºè®¢å•è®°å½•
2. åº“å­˜æ•°æ®åº“ï¼šæ‰£å‡å•†å“åº“å­˜  
3. ç”¨æˆ·æ•°æ®åº“ï¼šæ‰£å‡ç”¨æˆ·ç§¯åˆ†
4. æ¶ˆæ¯é˜Ÿåˆ—ï¼šå‘é€è®¢å•é€šçŸ¥

è¦æ±‚ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
```

### 3.3 JTAäº‹åŠ¡çš„ä¸¤é˜¶æ®µæäº¤


**ä¸¤é˜¶æ®µæäº¤åè®®**ï¼š
```
é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼ˆPrepare Phaseï¼‰
äº‹åŠ¡åè°ƒå™¨          æ•°æ®åº“A          æ•°æ®åº“B
    |                 |               |
    |--[1]å‡†å¤‡æäº¤---->|               |
    |<--[2]å‡†å¤‡å°±ç»ª----|               |
    |                 |               |
    |--[3]å‡†å¤‡æäº¤------------------->|
    |<--[4]å‡†å¤‡å°±ç»ª-------------------|

é˜¶æ®µäºŒï¼šæäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰  
    |--[5]æ­£å¼æäº¤---->|               |
    |<--[6]æäº¤å®Œæˆ----|               |
    |                 |               |
    |--[7]æ­£å¼æäº¤------------------->|
    |<--[8]æäº¤å®Œæˆ-------------------|
```

### 3.4 é…ç½®ç¤ºä¾‹


**åŸºç¡€é…ç½®**ï¼š
```xml
<!-- JTAäº‹åŠ¡ç®¡ç†å™¨ -->
<bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager">
    <property name="userTransactionName" value="java:comp/UserTransaction"/>
</bean>

<!-- å¤šä¸ªæ•°æ®æºé…ç½® -->
<bean id="dataSource1" class="com.atomikos.jdbc.AtomikosDataSourceBean">
    <property name="uniqueResourceName" value="dataSource1"/>
    <property name="xaDataSourceClassName" value="com.mysql.cj.jdbc.MysqlXADataSource"/>
    <!-- å…¶ä»–é…ç½®... -->
</bean>

<bean id="dataSource2" class="com.atomikos.jdbc.AtomikosDataSourceBean">
    <property name="uniqueResourceName" value="dataSource2"/>
    <property name="xaDataSourceClassName" value="com.mysql.cj.jdbc.MysqlXADataSource"/>
    <!-- å…¶ä»–é…ç½®... -->
</bean>
```

### 3.5 é€‚ç”¨åœºæ™¯åˆ†æ


| **ä½¿ç”¨åœºæ™¯** | **è¯´æ˜** | **å…¸å‹åº”ç”¨** |
|-------------|----------|-------------|
| ğŸ¢ **å¾®æœåŠ¡æ¶æ„** | è·¨æœåŠ¡æ•°æ®ä¸€è‡´æ€§ | è®¢å•+åº“å­˜+æ”¯ä»˜ |
| ğŸ’³ **é‡‘èç³»ç»Ÿ** | èµ„é‡‘è½¬è´¦çš„å¼ºä¸€è‡´æ€§ | é“¶è¡Œè½¬è´¦ï¼Œæ¸…ç®—ç³»ç»Ÿ |
| ğŸ“¦ **ç”µå•†å¹³å°** | ä¸‹å•æ¶‰åŠå¤šä¸ªç³»ç»Ÿ | è®¢å•+åº“å­˜+ç‰©æµ+ç§¯åˆ† |
| âš ï¸ **é«˜å¯é ç³»ç»Ÿ** | æ•°æ®ç»å¯¹ä¸èƒ½ä¸¢å¤± | æ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿ |

**æ€§èƒ½è€ƒè™‘**ï¼š
> âš ï¸ **æ³¨æ„**ï¼šJTAäº‹åŠ¡æ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œå› ä¸ºéœ€è¦åè°ƒå¤šä¸ªèµ„æºï¼Œå“åº”æ—¶é—´é€šå¸¸æ˜¯å•æ•°æ®æºäº‹åŠ¡çš„2-3å€ã€‚

---

## 4. ğŸ—„ï¸ HibernateTransactionManagerè¯¦è§£


### 4.1 ä»€ä¹ˆæ˜¯HibernateTransactionManager


**é€šä¿—è§£é‡Š**ï¼šè¿™æ˜¯ä¸“é—¨ä¸º**Hibernate ORMæ¡†æ¶**è®¾è®¡çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œå°±åƒä¸“é—¨ä¸ºHibernateè¿™ä¸ª"ç¿»è¯‘å‘˜"é…å¤‡çš„åŠ©æ‰‹ã€‚

**Hibernateç®€ä»‹**ï¼š
- **ORMæ¡†æ¶**ï¼šObject-Relational Mappingï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰
- **ä½œç”¨**ï¼šæŠŠJavaå¯¹è±¡è‡ªåŠ¨è½¬æ¢æˆæ•°æ®åº“è¡¨è®°å½•
- **ä¼˜åŠ¿**ï¼šå¼€å‘è€…ä¸ç”¨å†™SQLï¼Œç›´æ¥æ“ä½œJavaå¯¹è±¡

### 4.2 Hibernateäº‹åŠ¡ç®¡ç†ç‰¹ç‚¹


```
ä¼ ç»ŸJDBCæ“ä½œï¼š
å¼€å‘è€… â†’ å†™SQL â†’ JDBC â†’ æ•°æ®åº“

Hibernateæ“ä½œï¼š
å¼€å‘è€… â†’ æ“ä½œå¯¹è±¡ â†’ Hibernate â†’ è‡ªåŠ¨ç”ŸæˆSQL â†’ æ•°æ®åº“
                     â†‘
            HibernateTransactionManager
            (ç®¡ç†Hibernateçš„äº‹åŠ¡)
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- ğŸ”„ **Sessionç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†Hibernate Sessionçš„ç”Ÿå‘½å‘¨æœŸ
- ğŸ“¦ **å¯¹è±¡ç¼“å­˜**ï¼šåˆç†å¤„ç†Hibernateçš„ä¸€çº§ã€äºŒçº§ç¼“å­˜
- ğŸ”— **å»¶è¿ŸåŠ è½½**ï¼šæ­£ç¡®å¤„ç†æ‡’åŠ è½½çš„äº‹åŠ¡è¾¹ç•Œ
- ğŸ¯ **å¼‚å¸¸è½¬æ¢**ï¼šæŠŠHibernateå¼‚å¸¸è½¬æ¢ä¸ºSpringå¼‚å¸¸

### 4.3 é…ç½®ç¤ºä¾‹


**å®Œæ•´é…ç½®**ï¼š
```xml
<!-- SessionFactoryé…ç½® -->
<bean id="sessionFactory" class="org.springframework.orm.hibernate5.LocalSessionFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <property name="packagesToScan" value="com.example.model"/>
    <property name="hibernateProperties">
        <props>
            <prop key="hibernate.dialect">org.hibernate.dialect.MySQL8Dialect</prop>
            <prop key="hibernate.show_sql">true</prop>
            <prop key="hibernate.hbm2ddl.auto">update</prop>
        </props>
    </property>
</bean>

<!-- Hibernateäº‹åŠ¡ç®¡ç†å™¨ -->
<bean id="transactionManager" class="org.springframework.orm.hibernate5.HibernateTransactionManager">
    <property name="sessionFactory" ref="sessionFactory"/>
</bean>
```

**Javaé…ç½®æ–¹å¼**ï¼š
```java
@Configuration
@EnableTransactionManagement
public class HibernateConfig {
    
    @Bean
    public LocalSessionFactoryBean sessionFactory() {
        LocalSessionFactoryBean sessionFactory = new LocalSessionFactoryBean();
        sessionFactory.setDataSource(dataSource());
        sessionFactory.setPackagesToScan("com.example.model");
        
        Properties props = new Properties();
        props.put("hibernate.dialect", "org.hibernate.dialect.MySQL8Dialect");
        props.put("hibernate.show_sql", "true");
        sessionFactory.setHibernateProperties(props);
        
        return sessionFactory;
    }
    
    @Bean
    public PlatformTransactionManager transactionManager() {
        HibernateTransactionManager txManager = new HibernateTransactionManager();
        txManager.setSessionFactory(sessionFactory().getObject());
        return txManager;
    }
}
```

### 4.4 ä½¿ç”¨ç¤ºä¾‹


**å®ä½“ç±»å®šä¹‰**ï¼š
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String username;
    private BigDecimal balance;
    
    // getters and setters...
}
```

**Serviceä½¿ç”¨**ï¼š
```java
@Service
@Transactional  // ä½¿ç”¨HibernateTransactionManager
public class UserService {
    
    @Autowired
    private SessionFactory sessionFactory;
    
    public void updateUser(User user) {
        Session session = sessionFactory.getCurrentSession();
        session.update(user);  // Hibernateè‡ªåŠ¨ç”ŸæˆUPDATE SQL
    }
    
    // åˆ©ç”¨Hibernateçš„å¯¹è±¡æŸ¥è¯¢
    public List<User> findActiveUsers() {
        Session session = sessionFactory.getCurrentSession();
        Query<User> query = session.createQuery(
            "FROM User WHERE status = :status", User.class);
        query.setParameter("status", "ACTIVE");
        return query.getResultList();
    }
}
```

---

## 5. ğŸ¯ å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº‹åŠ¡ç®¡ç†å™¨


### 5.1 é€‰æ‹©å†³ç­–æ ‘


```
é€‰æ‹©äº‹åŠ¡ç®¡ç†å™¨å†³ç­–æµç¨‹ï¼š

ä½ çš„åº”ç”¨æ˜¯ä»€ä¹ˆæ¶æ„ï¼Ÿ
         |
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    |         |
å•æ•°æ®æº    å¤šæ•°æ®æº/åˆ†å¸ƒå¼
    |         |
    |    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    |    |          |
    |  å¾®æœåŠ¡æ¶æ„   ä¼ ç»Ÿæ¶æ„
    |    |          |
    |    JTA        JTA
    |
ä½ ç”¨ä»€ä¹ˆæ•°æ®è®¿é—®æŠ€æœ¯ï¼Ÿ
    |
â”Œâ”€â”€â”€â”¼â”€â”€â”€â”€â”
|   |    |
JDBC MyBatis Hibernate/JPA
|   |    |
DataSource DataSource Hibernate
Transaction Transaction Transaction
Manager   Manager   Manager
```

### 5.2 è¯¦ç»†é€‰æ‹©æŒ‡å—


| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **ç†ç”±** | **æ€§èƒ½** |
|---------|-------------|----------|---------|
| ğŸ”° **åˆå­¦è€…é¡¹ç›®** | DataSourceTransactionManager | ç®€å•æ˜“æ‡‚ï¼Œé…ç½®å®¹æ˜“ | â­â­â­â­â­ |
| ğŸš€ **å•ä½“åº”ç”¨+MyBatis** | DataSourceTransactionManager | æ€§èƒ½æœ€ä½³ï¼Œæ»¡è¶³éœ€æ±‚ | â­â­â­â­â­ |
| ğŸ“š **å•ä½“åº”ç”¨+Hibernate** | HibernateTransactionManager | å®Œç¾æ”¯æŒHibernateç‰¹æ€§ | â­â­â­â­ |
| ğŸ¢ **ä¼ä¸šçº§å¤šæ•°æ®æº** | JtaTransactionManager | å”¯ä¸€èƒ½å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ | â­â­â­ |
| â˜ï¸ **å¾®æœåŠ¡æ¶æ„** | DataSource + åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ | ç°ä»£åŒ–åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆ | â­â­â­â­ |

### 5.3 å¸¸è§é€‰æ‹©è¯¯åŒº


> âŒ **è¯¯åŒº1**ï¼šè®¤ä¸ºJTAæ€»æ˜¯æœ€å¥½çš„é€‰æ‹©
> 
> **çœŸç›¸**ï¼šJTAæ€§èƒ½å¼€é”€å¤§ï¼Œåªæœ‰çœŸæ­£éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡æ—¶æ‰ä½¿ç”¨

> âŒ **è¯¯åŒº2**ï¼šHibernateé¡¹ç›®å¿…é¡»ç”¨HibernateTransactionManager
> 
> **çœŸç›¸**ï¼šå¦‚æœä¸ç”¨Hibernateç‰¹æœ‰åŠŸèƒ½ï¼ŒDataSourceTransactionManagerä¹Ÿå¯ä»¥

> âŒ **è¯¯åŒº3**ï¼šä¸€ä¸ªé¡¹ç›®åªèƒ½ç”¨ä¸€ç§äº‹åŠ¡ç®¡ç†å™¨
> 
> **çœŸç›¸**ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„äº‹åŠ¡ç®¡ç†å™¨

---

## 6. âš™ï¸ é…ç½®æ–¹å¼è¯¦è§£


### 6.1 XMLé…ç½®æ–¹å¼


**å®Œæ•´XMLé…ç½®æ¨¡æ¿**ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:aop="http://www.springframework.org/schema/aop">

    <!-- æ•°æ®æºé…ç½® -->
    <bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="jdbcUrl" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
    </bean>
    
    <!-- äº‹åŠ¡ç®¡ç†å™¨é…ç½® -->
    <bean id="transactionManager" 
          class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>
    
    <!-- å¼€å¯äº‹åŠ¡æ³¨è§£æ”¯æŒ -->
    <tx:annotation-driven transaction-manager="transactionManager"/>
    
</beans>
```

### 6.2 Javaé…ç½®æ–¹å¼


**æ¨èçš„Javaé…ç½®**ï¼š
```java
@Configuration
@EnableTransactionManagement  // å¼€å¯äº‹åŠ¡ç®¡ç†
@ComponentScan("com.example")  // æ‰«æç»„ä»¶
public class AppConfig {
    
    // æ•°æ®æºé…ç½®
    @Bean
    public DataSource dataSource() {
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        ds.setUsername("root");
        ds.setPassword("password");
        ds.setMaximumPoolSize(20);  // è¿æ¥æ± å¤§å°
        return ds;
    }
    
    // äº‹åŠ¡ç®¡ç†å™¨é…ç½®
    @Bean
    public PlatformTransactionManager transactionManager() {
        DataSourceTransactionManager manager = 
            new DataSourceTransactionManager();
        manager.setDataSource(dataSource());
        return manager;
    }
}
```

### 6.3 Spring Bootè‡ªåŠ¨é…ç½®


**Spring Bootçš„ä¾¿åˆ©æ€§**ï¼š
```java
// Spring Bootåªéœ€è¦è¿™äº›é…ç½®
@SpringBootApplication
@EnableTransactionManagement  // å¯é€‰ï¼Œé»˜è®¤å·²å¼€å¯
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

**application.ymlé…ç½®**ï¼š
```yaml
# Spring Bootä¼šè‡ªåŠ¨åˆ›å»ºDataSourceå’ŒTransactionManager
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
```

> ğŸ’¡ **Spring Booté­”æ³•**ï¼šSpring Bootä¼šè‡ªåŠ¨æ£€æµ‹classpathä¸­çš„æ•°æ®åº“é©±åŠ¨å’ŒORMæ¡†æ¶ï¼Œç„¶åè‡ªåŠ¨é…ç½®ç›¸åº”çš„äº‹åŠ¡ç®¡ç†å™¨ã€‚

### 6.4 å¤šäº‹åŠ¡ç®¡ç†å™¨é…ç½®


**åœºæ™¯**ï¼šä¸€ä¸ªåº”ç”¨éœ€è¦æ“ä½œå¤šä¸ªä¸åŒç±»å‹çš„æ•°æ®æº
```java
@Configuration
@EnableTransactionManagement
public class MultiTransactionConfig {
    
    // ä¸»æ•°æ®æºçš„äº‹åŠ¡ç®¡ç†å™¨
    @Bean
    @Primary
    public PlatformTransactionManager primaryTransactionManager() {
        return new DataSourceTransactionManager(primaryDataSource());
    }
    
    // Hibernateçš„äº‹åŠ¡ç®¡ç†å™¨
    @Bean
    public PlatformTransactionManager hibernateTransactionManager() {
        return new HibernateTransactionManager(sessionFactory());
    }
}
```

**ä½¿ç”¨æ—¶æŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨**ï¼š
```java
@Service
public class UserService {
    
    @Transactional("primaryTransactionManager")
    public void updateUserWithJdbc(User user) {
        // ä½¿ç”¨JDBCæ“ä½œ
    }
    
    @Transactional("hibernateTransactionManager")  
    public void updateUserWithHibernate(User user) {
        // ä½¿ç”¨Hibernateæ“ä½œ
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 ä¸‰å¤§äº‹åŠ¡ç®¡ç†å™¨å¯¹æ¯”è¡¨


| **äº‹åŠ¡ç®¡ç†å™¨** | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½** | **å¤æ‚åº¦** | **åŠŸèƒ½ç‰¹ç‚¹** |
|--------------|-------------|---------|-----------|-------------|
| ğŸ”§ **DataSourceTransactionManager** | JDBC/MyBatiså•åº“ | â­â­â­â­â­ | â­ | ç®€å•é«˜æ•ˆï¼Œæ–°æ‰‹é¦–é€‰ |
| ğŸŒ **JtaTransactionManager** | åˆ†å¸ƒå¼å¤šæ•°æ®æº | â­â­ | â­â­â­â­â­ | åŠŸèƒ½å¼ºå¤§ï¼Œé…ç½®å¤æ‚ |
| ğŸ—„ï¸ **HibernateTransactionManager** | Hibernate/JPA | â­â­â­â­ | â­â­â­ | ORMä¸“ç”¨ï¼Œç‰¹æ€§ä¸°å¯Œ |

### 7.2 é€‰æ‹©å»ºè®®æ€»ç»“


```
æ–°æ‰‹å­¦ä¹ å»ºè®®ï¼š
1. ğŸ¯ ä»DataSourceTransactionManagerå¼€å§‹å­¦ä¹ 
2. ğŸ“š ç†è§£å•æ•°æ®æºäº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µ  
3. ğŸ”§ æŒæ¡@Transactionalæ³¨è§£çš„ä½¿ç”¨
4. ğŸ“ˆ æœ‰éœ€è¦æ—¶å†å­¦ä¹ å…¶ä»–äº‹åŠ¡ç®¡ç†å™¨

é¡¹ç›®é€‰æ‹©å»ºè®®ï¼š
âœ… 90%çš„é¡¹ç›®ç”¨DataSourceTransactionManagerå°±å¤Ÿäº†
âœ… ç¡®å®éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡æ—¶æ‰è€ƒè™‘JTA
âœ… å¤§é‡ä½¿ç”¨Hibernateç‰¹æ€§æ—¶é€‰æ‹©HibernateTransactionManager
âœ… Spring Booté¡¹ç›®è®©æ¡†æ¶è‡ªåŠ¨é€‰æ‹©ï¼Œå‡å°‘é…ç½®
```

### 7.3 å…³é”®æ¦‚å¿µè®°å¿†


**äº‹åŠ¡ç®¡ç†å™¨æœ¬è´¨**ï¼š
- ğŸ¯ **ç›®çš„**ï¼šç¡®ä¿æ•°æ®æ“ä½œçš„ACIDç‰¹æ€§
- ğŸ”§ **ä½œç”¨**ï¼šåè°ƒåº•å±‚èµ„æºçš„äº‹åŠ¡è¡Œä¸º  
- ğŸ—ï¸ **æ¶æ„**ï¼šSpringæä¾›ç»Ÿä¸€æ¥å£ï¼Œä¸åŒå®ç°å¯¹æ¥ä¸åŒæŠ€æœ¯
- âš¡ **ä½¿ç”¨**ï¼šé€šè¿‡@Transactionalæ³¨è§£å£°æ˜å¼ä½¿ç”¨

**é€‰æ‹©æ ¸å¿ƒåŸåˆ™**ï¼š
- ğŸ“ **å¤Ÿç”¨å°±å¥½**ï¼šä¸è¦è¿‡åº¦è®¾è®¡ï¼Œæ»¡è¶³éœ€æ±‚å³å¯
- ğŸš€ **æ€§èƒ½ä¼˜å…ˆ**ï¼šåœ¨æ»¡è¶³åŠŸèƒ½çš„å‰æä¸‹é€‰æ‹©æ€§èƒ½æœ€å¥½çš„
- ğŸ”§ **ç»´æŠ¤ç®€å•**ï¼šé…ç½®è¶Šç®€å•ï¼ŒåæœŸç»´æŠ¤è¶Šå®¹æ˜“
- ğŸ“ˆ **æ‰©å±•è€ƒè™‘**ï¼šä¸ºæœªæ¥å¯èƒ½çš„éœ€æ±‚å˜åŒ–ç•™æœ‰ä½™åœ°

> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šSpringçš„äº‹åŠ¡ç®¡ç†å™¨å°±æ˜¯ä¸ºäº†è®©å¼€å‘è€…èƒ½ç”¨ç»Ÿä¸€çš„æ–¹å¼ï¼ˆ@Transactionalï¼‰æ¥ç®¡ç†ä¸åŒæŠ€æœ¯æ ˆçš„äº‹åŠ¡ï¼Œè€Œä¸ç”¨å…³å¿ƒåº•å±‚çš„å¤æ‚å®ç°ç»†èŠ‚ã€‚é€‰æ‹©åˆé€‚çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œèƒ½è®©ä½ çš„åº”ç”¨æ—¢ç®€å•åˆé«˜æ•ˆï¼