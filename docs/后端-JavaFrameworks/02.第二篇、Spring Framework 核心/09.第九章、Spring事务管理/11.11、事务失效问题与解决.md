---
title: 11ã€äº‹åŠ¡å¤±æ•ˆé—®é¢˜ä¸è§£å†³
---
## ğŸ“š ç›®å½•

1. [äº‹åŠ¡å¤±æ•ˆé—®é¢˜æ¦‚è¿°](#1-äº‹åŠ¡å¤±æ•ˆé—®é¢˜æ¦‚è¿°)
2. [è‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆ](#2-è‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆ)
3. [épublicæ–¹æ³•çš„äº‹åŠ¡é—®é¢˜](#3-épublicæ–¹æ³•çš„äº‹åŠ¡é—®é¢˜)
4. [finalæ–¹æ³•é™åˆ¶é—®é¢˜](#4-finalæ–¹æ³•é™åˆ¶é—®é¢˜)
5. [Springä»£ç†æœºåˆ¶è§£æ](#5-Springä»£ç†æœºåˆ¶è§£æ)
6. [å®ç”¨è§£å†³æ–¹æ¡ˆå¤§å…¨](#6-å®ç”¨è§£å†³æ–¹æ¡ˆå¤§å…¨)
7. [äº‹åŠ¡å¤±æ•ˆæ’é”™æŠ€å·§](#7-äº‹åŠ¡å¤±æ•ˆæ’é”™æŠ€å·§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” äº‹åŠ¡å¤±æ•ˆé—®é¢˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡å¤±æ•ˆ


**äº‹åŠ¡å¤±æ•ˆ**å°±åƒä½ ä»¥ä¸ºé—¨é”äº†ï¼Œä½†å…¶å®é—¨æ ¹æœ¬æ²¡é”ä¸Šä¸€æ ·ã€‚ä½ ä»¥ä¸ºæ•°æ®åº“æ“ä½œè¢«äº‹åŠ¡ä¿æŠ¤ç€ï¼Œå‡ºé”™ä¼šå›æ»šï¼Œä½†å®é™…ä¸ŠSpringæ ¹æœ¬æ²¡ç»™ä½ å¼€å¯äº‹åŠ¡ã€‚

**äº‹åŠ¡å¤±æ•ˆçš„è¡¨ç°**ï¼š
```
æœŸæœ›ï¼šå‡ºç°å¼‚å¸¸æ—¶æ•°æ®ä¼šå›æ»š
ç°å®ï¼šå¼‚å¸¸å‘ç”Ÿäº†ï¼Œä½†æ•°æ®è¿˜æ˜¯ä¿å­˜åˆ°æ•°æ®åº“äº†
ç»“æœï¼šæ•°æ®ä¸ä¸€è‡´ï¼Œç³»ç»Ÿå‡ºbug
```

### 1.2 ä¸ºä»€ä¹ˆä¼šå¤±æ•ˆ


Springçš„äº‹åŠ¡æ˜¯é€šè¿‡**ä»£ç†**æ¥å®ç°çš„ï¼Œå°±åƒæ‰¾ä»£ç†äººå¸®ä½ åŠäº‹ï¼š

```
æ­£å¸¸æƒ…å†µï¼šä½  â†’ ä»£ç†äºº â†’ é“¶è¡ŒåŠäº‹ï¼ˆä»£ç†äººä¼šå¤„ç†äº‹åŠ¡ï¼‰
å¤±æ•ˆæƒ…å†µï¼šä½  â†’ ç›´æ¥å»é“¶è¡Œï¼ˆç»•è¿‡äº†ä»£ç†äººï¼Œæ²¡æœ‰äº‹åŠ¡å¤„ç†ï¼‰
```

**å¸¸è§å¤±æ•ˆåœºæ™¯**ï¼š
- ğŸ”¸ **è‡ªè°ƒç”¨**ï¼šæ–¹æ³•å†…éƒ¨è°ƒç”¨è‡ªå·±çš„å…¶ä»–æ–¹æ³•
- ğŸ”¸ **æƒé™é—®é¢˜**ï¼šæ–¹æ³•ä¸æ˜¯publicçš„
- ğŸ”¸ **finalé™åˆ¶**ï¼šæ–¹æ³•è¢«finalä¿®é¥°æ— æ³•ä»£ç†
- ğŸ”¸ **å¼‚å¸¸å¤„ç†**ï¼šå¼‚å¸¸è¢«æ•è·æ²¡æœ‰æŠ›å‡º

### 1.3 äº‹åŠ¡å¤±æ•ˆçš„å½±å“


```
æ•°æ®å±‚é¢ï¼š
â€¢ æ•°æ®ä¸ä¸€è‡´
â€¢ è„æ•°æ®äº§ç”Ÿ
â€¢ ä¸šåŠ¡é€»è¾‘é”™è¯¯

ç³»ç»Ÿå±‚é¢ï¼š
â€¢ éš¾ä»¥æ’æŸ¥çš„bug
â€¢ ç”Ÿäº§ç¯å¢ƒæ•°æ®é—®é¢˜
â€¢ ç”¨æˆ·ä½“éªŒä¸‹é™
```

---

## 2. ğŸ”„ è‡ªè°ƒç”¨å¯¼è‡´äº‹åŠ¡å¤±æ•ˆ


### 2.1 ä»€ä¹ˆæ˜¯è‡ªè°ƒç”¨é—®é¢˜


**è‡ªè°ƒç”¨**å°±æ˜¯åœ¨åŒä¸€ä¸ªç±»é‡Œï¼Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒSpringçš„äº‹åŠ¡ä»£ç†ä¼šå¤±æ•ˆã€‚

### 2.2 è‡ªè°ƒç”¨å¤±æ•ˆåŸç†


Springäº‹åŠ¡çš„å·¥ä½œåŸç†ï¼š

```
å¤–éƒ¨è°ƒç”¨æµç¨‹ï¼š
å¤–éƒ¨ç±» â†’ Springä»£ç†å¯¹è±¡ â†’ ç›®æ ‡æ–¹æ³•
       â†‘
    åœ¨è¿™é‡Œæ·»åŠ äº‹åŠ¡å¤„ç†

è‡ªè°ƒç”¨æµç¨‹ï¼š  
æ–¹æ³•A â†’ ç›´æ¥è°ƒç”¨æ–¹æ³•Bï¼ˆç»•è¿‡äº†ä»£ç†ï¼‰
     â†‘
   æ²¡æœ‰äº‹åŠ¡å¤„ç†
```

### 2.3 å¤±æ•ˆæ¡ˆä¾‹æ¼”ç¤º


**âŒ é”™è¯¯çš„å†™æ³•**ï¼š
```java
@Service
public class UserService {
    
    @Transactional
    public void updateUser(User user) {
        // ä¸€äº›æ“ä½œ
        this.updateUserStatus(user.getId()); // è‡ªè°ƒç”¨ï¼
    }
    
    @Transactional  // è¿™ä¸ªæ³¨è§£ä¸ä¼šç”Ÿæ•ˆï¼
    public void updateUserStatus(Long userId) {
        // æ›´æ–°ç”¨æˆ·çŠ¶æ€
        userMapper.updateStatus(userId, "ACTIVE");
    }
}
```

**é—®é¢˜åˆ†æ**ï¼š
- `updateUser`æ–¹æ³•æœ‰äº‹åŠ¡ä¿æŠ¤
- ä½†å†…éƒ¨è°ƒç”¨`updateUserStatus`æ—¶ï¼Œç”¨çš„æ˜¯`this.updateUserStatus()`
- `this`æŒ‡å‘çš„æ˜¯åŸå§‹å¯¹è±¡ï¼Œä¸æ˜¯Springä»£ç†å¯¹è±¡
- æ‰€ä»¥`updateUserStatus`çš„`@Transactional`æ³¨è§£å¤±æ•ˆäº†

### 2.4 è‡ªè°ƒç”¨é—®é¢˜çš„å®é™…åœºæ™¯


**å¸¸è§çš„è‡ªè°ƒç”¨åœºæ™¯**ï¼š
```java
// åœºæ™¯1ï¼šæ‰¹é‡å¤„ç†ä¸­çš„å•ä¸ªå¤„ç†
@Transactional
public void batchProcess(List<Data> dataList) {
    for (Data data : dataList) {
        this.processOne(data); // è‡ªè°ƒç”¨
    }
}

// åœºæ™¯2ï¼šä¸»æµç¨‹è°ƒç”¨å­æµç¨‹  
@Transactional
public void mainProcess(Order order) {
    // ä¸»è¦å¤„ç†é€»è¾‘
    this.updateInventory(order); // è‡ªè°ƒç”¨
    this.sendNotification(order); // è‡ªè°ƒç”¨
}

// åœºæ™¯3ï¼šæ¡ä»¶æ€§è°ƒç”¨
@Transactional  
public void conditionalProcess(User user) {
    if (user.isVip()) {
        this.processVip(user); // è‡ªè°ƒç”¨
    } else {
        this.processNormal(user); // è‡ªè°ƒç”¨
    }
}
```

---

## 3. ğŸ”’ épublicæ–¹æ³•çš„äº‹åŠ¡é—®é¢˜


### 3.1 ä¸ºä»€ä¹ˆépublicæ–¹æ³•äº‹åŠ¡å¤±æ•ˆ


Springä½¿ç”¨**åŠ¨æ€ä»£ç†**æ¥å®ç°äº‹åŠ¡ï¼Œè€ŒåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†**publicæ–¹æ³•**ã€‚

**ç®€å•ç†è§£**ï¼š
```
ä»£ç†å°±åƒç§˜ä¹¦ï¼Œåªèƒ½å¤„ç†å¯¹å¤–å…¬å¼€çš„ä¸šåŠ¡
private/protectedæ–¹æ³•å°±åƒå†…éƒ¨æµç¨‹ï¼Œç§˜ä¹¦ç®¡ä¸äº†
```

### 3.2 æƒé™ä¿®é¥°ç¬¦ä¸äº‹åŠ¡


| ä¿®é¥°ç¬¦ | äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆ | åŸå› è¯´æ˜ |
|--------|-------------|----------|
| `public` | âœ… **ç”Ÿæ•ˆ** | å¯ä»¥è¢«ä»£ç† |
| `protected` | âŒ **ä¸ç”Ÿæ•ˆ** | ä»£ç†æ— æ³•è¦†ç›– |
| `private` | âŒ **ä¸ç”Ÿæ•ˆ** | ä»£ç†æ— æ³•è®¿é—® |
| `package-private` | âŒ **ä¸ç”Ÿæ•ˆ** | ä»£ç†é™åˆ¶ |

### 3.3 é”™è¯¯æ¡ˆä¾‹


**âŒ é”™è¯¯çš„å†™æ³•**ï¼š
```java
@Service  
public class OrderService {
    
    // privateæ–¹æ³•çš„äº‹åŠ¡æ³¨è§£æ— æ•ˆ
    @Transactional
    private void processOrder(Order order) {
        // å¤„ç†è®¢å•é€»è¾‘
        orderMapper.insert(order);
    }
    
    // protectedæ–¹æ³•çš„äº‹åŠ¡æ³¨è§£ä¹Ÿæ— æ•ˆ
    @Transactional
    protected void updateOrderStatus(Long orderId) {
        orderMapper.updateStatus(orderId);
    }
    
    // åªæœ‰è¿™ä¸ªæ–¹æ³•çš„äº‹åŠ¡æ‰ä¼šç”Ÿæ•ˆ
    @Transactional
    public void createOrder(Order order) {
        processOrder(order); // è°ƒç”¨privateæ–¹æ³•
    }
}
```

### 3.4 ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡


Springè¿™æ ·è®¾è®¡çš„åŸå› ï¼š

```
è®¾è®¡ç†å¿µï¼š
â€¢ äº‹åŠ¡æ˜¯ä¸šåŠ¡è¾¹ç•Œï¼Œåº”è¯¥å¯¹å¤–æš´éœ²
â€¢ privateæ–¹æ³•æ˜¯å†…éƒ¨å®ç°ç»†èŠ‚
â€¢ äº‹åŠ¡çš„é¢—ç²’åº¦åº”è¯¥åœ¨serviceå±‚çš„publicæ–¹æ³•ä¸Š
â€¢ é¿å…è¿‡åº¦ç»†åŒ–çš„äº‹åŠ¡æ§åˆ¶
```

---

## 4. ğŸš« finalæ–¹æ³•é™åˆ¶é—®é¢˜


### 4.1 finalæ–¹æ³•ä¸ºä»€ä¹ˆæ— æ³•äº‹åŠ¡


**finalæ–¹æ³•**å°±åƒå†™åœ¨çŸ³å¤´ä¸Šçš„å­—ï¼Œæ— æ³•ä¿®æ”¹ã€‚Springä»£ç†éœ€è¦**é‡å†™æ–¹æ³•**æ¥æ·»åŠ äº‹åŠ¡é€»è¾‘ï¼Œä½†finalæ–¹æ³•ä¸å…è®¸è¢«é‡å†™ã€‚

### 4.2 finalé™åˆ¶çš„æŠ€æœ¯åŸç†


```
Springä»£ç†çš„å·¥ä½œæ–¹å¼ï¼š
1. åˆ›å»ºç›®æ ‡ç±»çš„å­ç±»ï¼ˆCGLibä»£ç†ï¼‰
2. é‡å†™ç›®æ ‡æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å‰åæ·»åŠ äº‹åŠ¡é€»è¾‘
3. è°ƒç”¨æ—¶æ‰§è¡Œé‡å†™åçš„æ–¹æ³•

finalæ–¹æ³•çš„é—®é¢˜ï¼š
â€¢ finalæ–¹æ³•ä¸èƒ½è¢«é‡å†™
â€¢ ä»£ç†æ— æ³•æ·»åŠ äº‹åŠ¡é€»è¾‘
â€¢ äº‹åŠ¡æ³¨è§£å¤±æ•ˆ
```

### 4.3 finalç›¸å…³çš„å¤±æ•ˆæƒ…å†µ


**âŒ å„ç§finalå¯¼è‡´çš„é—®é¢˜**ï¼š
```java
@Service
public class ProductService {
    
    // finalæ–¹æ³• - äº‹åŠ¡å¤±æ•ˆ
    @Transactional
    public final void updateProduct(Product product) {
        productMapper.update(product);
    }
    
    // finalç±»ä¹Ÿä¼šæœ‰é—®é¢˜
}

// finalç±» - æ•´ä¸ªç±»éƒ½æ— æ³•è¢«ä»£ç†
@Service  
public final class CategoryService {
    
    @Transactional  // æ‰€æœ‰äº‹åŠ¡éƒ½ä¼šå¤±æ•ˆ
    public void updateCategory(Category category) {
        categoryMapper.update(category);
    }
}
```

### 4.4 finalçš„ä½¿ç”¨å»ºè®®


```
åœ¨Springé¡¹ç›®ä¸­ï¼š
âœ… å¯ä»¥ç”¨finalï¼šå¸¸é‡ã€å·¥å…·æ–¹æ³•ã€ä¸éœ€è¦äº‹åŠ¡çš„æ–¹æ³•
âŒ é¿å…ç”¨finalï¼šéœ€è¦äº‹åŠ¡çš„ä¸šåŠ¡æ–¹æ³•ã€Serviceç±»

æœ€ä½³å®è·µï¼š
â€¢ Serviceå±‚çš„ç±»å’Œäº‹åŠ¡æ–¹æ³•éƒ½ä¸è¦ç”¨final
â€¢ å¦‚æœå¿…é¡»ç”¨finalï¼Œè€ƒè™‘é‡æ–°è®¾è®¡æ–¹æ³•ç»“æ„
â€¢ å°†finalæ–¹æ³•ä½œä¸ºå·¥å…·æ–¹æ³•ï¼Œäº‹åŠ¡æ§åˆ¶æ”¾åœ¨è°ƒç”¨æ–¹
```

---

## 5. âš™ï¸ Springä»£ç†æœºåˆ¶è§£æ


### 5.1 Springä»£ç†çš„ä¸¤ç§æ–¹å¼


Springæä¾›ä¸¤ç§ä»£ç†æ–¹å¼æ¥å®ç°äº‹åŠ¡ï¼š

```
JDKåŠ¨æ€ä»£ç†ï¼š
é€‚ç”¨åœºæ™¯ï¼šç›®æ ‡ç±»å®ç°äº†æ¥å£
å·¥ä½œåŸç†ï¼šåŸºäºæ¥å£åˆ›å»ºä»£ç†å¯¹è±¡
é™åˆ¶ï¼šåªèƒ½ä»£ç†æ¥å£ä¸­çš„æ–¹æ³•

CGLibä»£ç†ï¼š
é€‚ç”¨åœºæ™¯ï¼šç›®æ ‡ç±»æ²¡æœ‰æ¥å£
å·¥ä½œåŸç†ï¼šåŸºäºç»§æ‰¿åˆ›å»ºä»£ç†å­ç±»
é™åˆ¶ï¼šä¸èƒ½ä»£ç†finalç±»å’Œfinalæ–¹æ³•
```

### 5.2 ä»£ç†å·¥ä½œæµç¨‹å›¾è§£


```
è°ƒç”¨æµç¨‹ç¤ºæ„ï¼š

å¤–éƒ¨è°ƒç”¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Springä»£ç†    â”‚ â† åœ¨è¿™é‡Œå¤„ç†äº‹åŠ¡
â”‚  (Proxy Object) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›®æ ‡å¯¹è±¡      â”‚ â† çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘
â”‚ (Target Object) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ä»£ç†å¤±æ•ˆçš„æ ¹æœ¬åŸå› 


**ä»£ç†å¤±æ•ˆçš„æ ¸å¿ƒé—®é¢˜**ï¼š

```
Springå®¹å™¨ä¸­æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼š
1. åŸå§‹å¯¹è±¡ï¼ˆTarget Objectï¼‰
2. ä»£ç†å¯¹è±¡ï¼ˆProxy Objectï¼‰

æ­£ç¡®è°ƒç”¨ï¼šå¤–éƒ¨ â†’ ä»£ç†å¯¹è±¡ â†’ åŸå§‹å¯¹è±¡ âœ…
é”™è¯¯è°ƒç”¨ï¼šå¤–éƒ¨ â†’ åŸå§‹å¯¹è±¡ âŒ
è‡ªè°ƒç”¨ï¼š  åŸå§‹å¯¹è±¡å†…éƒ¨è°ƒç”¨ â†’ åŸå§‹å¯¹è±¡ âŒ
```

### 5.4 å¦‚ä½•éªŒè¯ä»£ç†æ˜¯å¦ç”Ÿæ•ˆ


**æ£€æŸ¥ä»£ç†çš„ç®€å•æ–¹æ³•**ï¼š
```java
@Service
public class TestService {
    
    public void checkProxy() {
        System.out.println("å½“å‰å¯¹è±¡ç±»å‹: " + this.getClass().getName());
        // å¦‚æœæ˜¯ä»£ç†å¯¹è±¡ï¼Œä¼šæ˜¾ç¤ºç±»ä¼¼ï¼š
        // com.example.TestService$$EnhancerBySpringCGLIB$$12345
    }
    
    @Transactional
    public void transactionMethod() {
        checkProxy(); // æŸ¥çœ‹è¾“å‡ºåˆ¤æ–­æ˜¯å¦è¢«ä»£ç†
    }
}
```

---

## 6. ğŸ’¡ å®ç”¨è§£å†³æ–¹æ¡ˆå¤§å…¨


### 6.1 è§£å†³è‡ªè°ƒç”¨é—®é¢˜


**æ–¹æ¡ˆ1ï¼šæ³¨å…¥è‡ªå·±ï¼ˆæœ€å¸¸ç”¨ï¼‰**

```java
@Service
public class UserService {
    
    // æ³¨å…¥è‡ªå·±ï¼Œè·å–ä»£ç†å¯¹è±¡
    @Autowired
    private UserService self;
    
    @Transactional
    public void updateUser(User user) {
        // ä½¿ç”¨selfè°ƒç”¨ï¼Œä¼šèµ°ä»£ç†
        self.updateUserStatus(user.getId());
    }
    
    @Transactional
    public void updateUserStatus(Long userId) {
        userMapper.updateStatus(userId, "ACTIVE");
    }
}
```

**æ–¹æ¡ˆ2ï¼šä»Springä¸Šä¸‹æ–‡è·å–ä»£ç†å¯¹è±¡**

```java
@Service
public class OrderService implements ApplicationContextAware {
    
    private ApplicationContext applicationContext;
    
    @Transactional
    public void processOrder(Order order) {
        // ä»Springå®¹å™¨è·å–ä»£ç†å¯¹è±¡
        OrderService proxy = applicationContext.getBean(OrderService.class);
        proxy.updateOrderStatus(order.getId());
    }
    
    @Transactional
    public void updateOrderStatus(Long orderId) {
        orderMapper.updateStatus(orderId);
    }
    
    @Override
    public void setApplicationContext(ApplicationContext applicationContext) {
        this.applicationContext = applicationContext;
    }
}
```

**æ–¹æ¡ˆ3ï¼šä½¿ç”¨AopContextï¼ˆéœ€è¦é…ç½®ï¼‰**

```java
// é¦–å…ˆéœ€è¦åœ¨é…ç½®ä¸­å¯ç”¨
@EnableTransactionManagement(exposeProxy = true)
@Configuration
public class TransactionConfig {
}

@Service
public class ProductService {
    
    @Transactional
    public void updateProduct(Product product) {
        // è·å–å½“å‰ä»£ç†å¯¹è±¡
        ProductService proxy = (ProductService) AopContext.currentProxy();
        proxy.updateProductDetails(product);
    }
    
    @Transactional
    public void updateProductDetails(Product product) {
        productMapper.updateDetails(product);
    }
}
```

### 6.2 è§£å†³æƒé™é—®é¢˜


**âœ… æ­£ç¡®çš„åšæ³•**ï¼š
```java
@Service
public class UserService {
    
    // publicæ–¹æ³•ï¼Œäº‹åŠ¡ç”Ÿæ•ˆ
    @Transactional
    public void updateUser(User user) {
        processUserData(user);
        userMapper.update(user);
    }
    
    // privateæ–¹æ³•ä¸åŠ äº‹åŠ¡æ³¨è§£ï¼Œç”±è°ƒç”¨æ–¹æ§åˆ¶äº‹åŠ¡
    private void processUserData(User user) {
        // æ•°æ®å¤„ç†é€»è¾‘
        user.setUpdateTime(new Date());
    }
}
```

### 6.3 è§£å†³finalé™åˆ¶


**æ–¹æ¡ˆ1ï¼šå»æ‰finalä¿®é¥°ç¬¦**
```java
// âŒ é”™è¯¯
@Transactional
public final void updateData() { }

// âœ… æ­£ç¡®  
@Transactional
public void updateData() { }
```

**æ–¹æ¡ˆ2ï¼šé‡æ–°è®¾è®¡æ–¹æ³•ç»“æ„**
```java
@Service
public class DataService {
    
    // finalæ–¹æ³•ä½œä¸ºå·¥å…·æ–¹æ³•
    public final void validateData(Data data) {
        // éªŒè¯é€»è¾‘
    }
    
    // äº‹åŠ¡æ–¹æ³•è°ƒç”¨å·¥å…·æ–¹æ³•
    @Transactional  
    public void saveData(Data data) {
        validateData(data);  // è°ƒç”¨finalæ–¹æ³•
        dataMapper.insert(data);
    }
}
```

### 6.4 ç»¼åˆè§£å†³æ–¹æ¡ˆæ¨¡æ¿


**æ¨èçš„Serviceå±‚è®¾è®¡æ¨¡å¼**ï¼š

```java
@Service
public class BusinessService {
    
    @Autowired
    private BusinessService self;  // è‡ªæ³¨å…¥è§£å†³è‡ªè°ƒç”¨
    
    // ä¸»è¦ä¸šåŠ¡æ–¹æ³• - public + äº‹åŠ¡
    @Transactional
    public void mainBusiness(BusinessData data) {
        validateData(data);  // privateå·¥å…·æ–¹æ³•
        
        // éœ€è¦ç‹¬ç«‹äº‹åŠ¡çš„æ“ä½œé€šè¿‡selfè°ƒç”¨
        self.subBusiness1(data);
        self.subBusiness2(data);
    }
    
    // å­ä¸šåŠ¡æ–¹æ³• - public + äº‹åŠ¡
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void subBusiness1(BusinessData data) {
        // ç‹¬ç«‹äº‹åŠ¡çš„æ“ä½œ
    }
    
    @Transactional
    public void subBusiness2(BusinessData data) {
        // å¦ä¸€ä¸ªæ“ä½œ
    }
    
    // å·¥å…·æ–¹æ³• - private + æ— äº‹åŠ¡æ³¨è§£
    private void validateData(BusinessData data) {
        // éªŒè¯é€»è¾‘ï¼Œä¸éœ€è¦ç‹¬ç«‹äº‹åŠ¡
    }
}
```

---

## 7. ğŸ”§ äº‹åŠ¡å¤±æ•ˆæ’é”™æŠ€å·§


### 7.1 å¿«é€Ÿè¯Šæ–­æ£€æŸ¥æ¸…å•


**âš¡ äº‹åŠ¡å¤±æ•ˆè‡ªæ£€è¡¨**ï¼š

```
â–¡ æ–¹æ³•æ˜¯å¦ä¸ºpublicï¼Ÿ
â–¡ æ–¹æ³•æ˜¯å¦æœ‰finalä¿®é¥°ï¼Ÿ
â–¡ ç±»æ˜¯å¦æœ‰finalä¿®é¥°ï¼Ÿ
â–¡ æ˜¯å¦å­˜åœ¨è‡ªè°ƒç”¨ï¼Ÿ
â–¡ å¼‚å¸¸æ˜¯å¦è¢«æ­£ç¡®æŠ›å‡ºï¼Ÿ
â–¡ æ•°æ®åº“æ˜¯å¦æ”¯æŒäº‹åŠ¡ï¼Ÿ
â–¡ Springäº‹åŠ¡ç®¡ç†å™¨é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
```

### 7.2 è°ƒè¯•éªŒè¯æ–¹æ³•


**æ–¹æ³•1ï¼šæ·»åŠ æ—¥å¿—éªŒè¯**
```java
@Service
public class DebugService {
    
    @Transactional
    public void testTransaction() {
        System.out.println("=== äº‹åŠ¡æ–¹æ³•å¼€å§‹ ===");
        System.out.println("å½“å‰å¯¹è±¡: " + this.getClass().getName());
        
        // æ•…æ„æŠ›å‡ºå¼‚å¸¸æµ‹è¯•å›æ»š
        throw new RuntimeException("æµ‹è¯•äº‹åŠ¡å›æ»š");
    }
}
```

**æ–¹æ³•2ï¼šä½¿ç”¨Spring Boot Actuator**
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: beans,transactions
```

**æ–¹æ³•3ï¼šå¯ç”¨äº‹åŠ¡æ—¥å¿—**
```yaml
# application.yml
logging:
  level:
    org.springframework.transaction: DEBUG
    org.springframework.orm.jpa: DEBUG
```

### 7.3 å¸¸è§é”™è¯¯ä¿¡æ¯è§£è¯»


**é”™è¯¯ä¿¡æ¯ä¸è§£å†³æ–¹æ¡ˆ**ï¼š

```
é”™è¯¯1: "Transaction rolled back because it has been marked as rollback-only"
åŸå› : å†…éƒ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè¢«æ•è·ï¼Œä½†äº‹åŠ¡å·²è¢«æ ‡è®°ä¸ºå›æ»š
è§£å†³: æ£€æŸ¥å¼‚å¸¸å¤„ç†é€»è¾‘

é”™è¯¯2: "No qualifying bean of type found"  
åŸå› : è‡ªæ³¨å…¥æ—¶Springæ‰¾ä¸åˆ°bean
è§£å†³: æ£€æŸ¥@Serviceæ³¨è§£å’ŒåŒ…æ‰«æé…ç½®

é”™è¯¯3: "Cannot find current proxy"
åŸå› : AopContext.currentProxy()è°ƒç”¨æ—¶æ²¡æœ‰ä»£ç†
è§£å†³: æ·»åŠ @EnableTransactionManagement(exposeProxy = true)
```

### 7.4 æ€§èƒ½ç›‘æ§ä¸åˆ†æ


**äº‹åŠ¡æ€§èƒ½ç›‘æ§è¦ç‚¹**ï¼š

```
å…³æ³¨æŒ‡æ ‡ï¼š
â€¢ äº‹åŠ¡æ‰§è¡Œæ—¶é—´
â€¢ äº‹åŠ¡å›æ»šé¢‘ç‡  
â€¢ æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
â€¢ é”ç­‰å¾…æ—¶é—´

ç›‘æ§å·¥å…·ï¼š
â€¢ Spring Boot Actuator
â€¢ Micrometer
â€¢ æ•°æ®åº“ç›‘æ§å·¥å…·
â€¢ APMå·¥å…·ï¼ˆå¦‚Skywalkingï¼‰
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡å¤±æ•ˆæœ¬è´¨ï¼šSpringä»£ç†æœºåˆ¶è¢«ç»•è¿‡
ğŸ”¸ è‡ªè°ƒç”¨é—®é¢˜ï¼šthisè°ƒç”¨ä¸ä¼šèµ°ä»£ç†å¯¹è±¡
ğŸ”¸ æƒé™é™åˆ¶ï¼šåªæœ‰publicæ–¹æ³•æ‰èƒ½è¢«ä»£ç†
ğŸ”¸ finalé™åˆ¶ï¼šfinalæ–¹æ³•å’Œç±»æ— æ³•è¢«ä»£ç†é‡å†™
ğŸ”¸ è§£å†³æ ¸å¿ƒï¼šè®©è°ƒç”¨èµ°Springä»£ç†å¯¹è±¡
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä»£ç†æœºåˆ¶çš„æœ¬è´¨**
```
ç†è§£è¦ç‚¹ï¼š
- Springå®¹å™¨ä¸­å­˜åœ¨ä¸¤ä¸ªå¯¹è±¡ï¼šåŸå§‹å¯¹è±¡å’Œä»£ç†å¯¹è±¡
- äº‹åŠ¡é€»è¾‘åœ¨ä»£ç†å¯¹è±¡ä¸­ï¼Œä¸åœ¨åŸå§‹å¯¹è±¡ä¸­
- åªæœ‰é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ï¼Œäº‹åŠ¡æ‰ä¼šç”Ÿæ•ˆ
```

**ğŸ”¹ å¤±æ•ˆåœºæ™¯çš„å…±åŒç‰¹ç‚¹**
```
å…±åŒç‚¹ï¼š
- éƒ½æ˜¯ç»•è¿‡äº†Springä»£ç†æœºåˆ¶
- éƒ½æ˜¯ç›´æ¥è°ƒç”¨äº†åŸå§‹å¯¹è±¡çš„æ–¹æ³•
- Springæ— æ³•åœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡é€»è¾‘
```

### 8.3 å®é™…å¼€å‘æŒ‡å¯¼åŸåˆ™


**âœ… æ¨èåšæ³•**ï¼š
- Serviceæ–¹æ³•ç”¨publicä¿®é¥°
- é¿å…åœ¨ç±»å’Œäº‹åŠ¡æ–¹æ³•ä¸Šä½¿ç”¨final
- éœ€è¦å†…éƒ¨è°ƒç”¨æ—¶ä½¿ç”¨è‡ªæ³¨å…¥æ–¹å¼
- å°†å·¥å…·æ–¹æ³•è®¾è®¡ä¸ºprivateï¼ˆä¸éœ€è¦äº‹åŠ¡ï¼‰
- äº‹åŠ¡è¾¹ç•Œåº”è¯¥æ¸…æ™°ï¼Œåœ¨Serviceå±‚æ§åˆ¶

**âŒ é¿å…åšæ³•**ï¼š
- ä¸è¦åœ¨åŒä¸€ä¸ªç±»ä¸­ç›´æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³•
- ä¸è¦åœ¨private/protectedæ–¹æ³•ä¸ŠåŠ @Transactional
- ä¸è¦æ»¥ç”¨finalä¿®é¥°ç¬¦
- ä¸è¦æ•è·å¼‚å¸¸è€Œä¸é‡æ–°æŠ›å‡º

### 8.4 è®°å¿†å£è¯€


```
äº‹åŠ¡å¤±æ•ˆè«æ…Œå¼ ï¼Œä»£ç†æœºåˆ¶æ˜¯å…³é”®
è‡ªè°ƒç”¨æ—¶ç”¨selfæ³¨å…¥ï¼Œpublicæ–¹æ³•æ‰æœ‰æ•ˆ
finalä¿®é¥°è¦é¿å…ï¼Œå¼‚å¸¸æŠ›å‡ºä¸èƒ½å¿˜
ç†è§£åŸç†è§£å†³æ–¹æ¡ˆå¤šï¼ŒSpringäº‹åŠ¡ä¸å†éš¾
```

### 8.5 å®é™…åº”ç”¨ä»·å€¼


- **é—®é¢˜é¢„é˜²**ï¼šåœ¨å¼€å‘é˜¶æ®µé¿å…äº‹åŠ¡å¤±æ•ˆé—®é¢˜
- **å¿«é€Ÿæ’é”™**ï¼šèƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œè§£å†³äº‹åŠ¡é—®é¢˜
- **ä»£ç è´¨é‡**ï¼šå†™å‡ºæ›´å¯é çš„äº‹åŠ¡ä»£ç 
- **å›¢é˜Ÿåä½œ**ï¼šå¸®åŠ©å›¢é˜Ÿæˆå‘˜ç†è§£Springäº‹åŠ¡æœºåˆ¶
- **ç”Ÿäº§ç¨³å®š**ï¼šå‡å°‘ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜

**æ ¸å¿ƒè®°å¿†**ï¼š
- Springäº‹åŠ¡é ä»£ç†ï¼Œç»•è¿‡ä»£ç†å°±å¤±æ•ˆ
- è‡ªè°ƒç”¨æ˜¯æœ€å¸¸è§é—®é¢˜ï¼Œè‡ªæ³¨å…¥æ˜¯æœ€å¸¸ç”¨è§£å†³æ–¹æ¡ˆ
- publicæ–¹æ³•é…äº‹åŠ¡æ³¨è§£ï¼Œprivateæ–¹æ³•åšå·¥å…·ç”¨
- ç†è§£åŸç†æ¯”è®°ä½æ–¹æ¡ˆæ›´é‡è¦