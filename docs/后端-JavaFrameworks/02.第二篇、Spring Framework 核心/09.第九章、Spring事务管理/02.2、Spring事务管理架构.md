---
title: 2ã€Springäº‹åŠ¡ç®¡ç†æ¶æ„
---
## ğŸ“š ç›®å½•

1. [äº‹åŠ¡åŸºç¡€ç†è®º](#1-äº‹åŠ¡åŸºç¡€ç†è®º)
2. [Springäº‹åŠ¡ç®¡ç†æ¶æ„](#2-Springäº‹åŠ¡ç®¡ç†æ¶æ„)
3. [æ ¸å¿ƒç»„ä»¶è¯¦è§£](#3-æ ¸å¿ƒç»„ä»¶è¯¦è§£)
4. [äº‹åŠ¡ç®¡ç†å™¨å®ç°](#4-äº‹åŠ¡ç®¡ç†å™¨å®ç°)
5. [äº‹åŠ¡é…ç½®ä¸ä½¿ç”¨](#5-äº‹åŠ¡é…ç½®ä¸ä½¿ç”¨)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’° äº‹åŠ¡åŸºç¡€ç†è®º


### 1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡


**ğŸ”¸ é€šä¿—ç†è§£**
æƒ³è±¡ä¸€ä¸‹é“¶è¡Œè½¬è´¦çš„åœºæ™¯ï¼šä½ è¦ä»Aè´¦æˆ·è½¬100å…ƒåˆ°Bè´¦æˆ·ã€‚è¿™ä¸ªæ“ä½œåŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š
1. ä»Aè´¦æˆ·æ‰£é™¤100å…ƒ
2. å‘Bè´¦æˆ·å¢åŠ 100å…ƒ

è¿™ä¸¤ä¸ªæ“ä½œ**å¿…é¡»åŒæ—¶æˆåŠŸ**ï¼Œæˆ–è€…**åŒæ—¶å¤±è´¥**ã€‚ä¸èƒ½å‡ºç°Aè´¦æˆ·æ‰£äº†é’±ï¼Œä½†Bè´¦æˆ·æ²¡æ”¶åˆ°é’±çš„æƒ…å†µã€‚

**ğŸ”¸ ä¸“ä¸šå®šä¹‰**
äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯æ•°æ®åº“æ“ä½œçš„**é€»è¾‘å·¥ä½œå•å…ƒ**ï¼Œå®ƒå°†å¤šä¸ªæ•°æ®åº“æ“ä½œç»„åˆæˆä¸€ä¸ª**ä¸å¯åˆ†å‰²çš„æ•´ä½“**ã€‚

> ğŸ’¡ **ç®€å•ç†è§£**  
> äº‹åŠ¡å°±åƒä¸€ä¸ª"**è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš**"çš„æ‰¿è¯ºã€‚æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸæ‰ç®—æˆåŠŸï¼Œä»»ä½•ä¸€ä¸ªå¤±è´¥å°±å…¨éƒ¨æ’¤é”€ã€‚

### 1.2 äº‹åŠ¡çš„ACIDç‰¹æ€§


**ğŸ”¸ åŸå­æ€§ï¼ˆAtomicityï¼‰**
```
é“¶è¡Œè½¬è´¦ä¾‹å­ï¼š
âœ… æ­£ç¡®æƒ…å†µï¼šAè´¦æˆ·-100ï¼ŒBè´¦æˆ·+100 ï¼ˆä¸¤ä¸ªæ“ä½œéƒ½æˆåŠŸï¼‰
âŒ é”™è¯¯æƒ…å†µï¼šAè´¦æˆ·-100ï¼ŒBè´¦æˆ·+0   ï¼ˆç¬¬äºŒä¸ªæ“ä½œå¤±è´¥ï¼Œç¬¬ä¸€ä¸ªæ“ä½œè¦æ’¤é”€ï¼‰

åŸå­æ€§ä¿è¯ï¼šè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ
```

**ğŸ”¸ ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰**
```
æ•°æ®åº“çŠ¶æ€å˜åŒ–ï¼š
æ“ä½œå‰ï¼šAè´¦æˆ·1000å…ƒï¼ŒBè´¦æˆ·500å…ƒï¼Œæ€»å’Œ1500å…ƒ
æ“ä½œåï¼šAè´¦æˆ·900å…ƒï¼ŒBè´¦æˆ·600å…ƒï¼Œæ€»å’Œ1500å…ƒ

ä¸€è‡´æ€§ä¿è¯ï¼šæ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€
```

**ğŸ”¸ éš”ç¦»æ€§ï¼ˆIsolationï¼‰**
```
å¤šç”¨æˆ·åŒæ—¶æ“ä½œï¼š
ç”¨æˆ·ç”²ï¼šAå‘Bè½¬è´¦100å…ƒ
ç”¨æˆ·ä¹™ï¼šCå‘Aè½¬è´¦50å…ƒ

éš”ç¦»æ€§ä¿è¯ï¼šä¸¤ä¸ªäº‹åŠ¡äº’ä¸å¹²æ‰°ï¼Œå°±åƒåªæœ‰è‡ªå·±åœ¨ä½¿ç”¨æ•°æ®åº“
```

**ğŸ”¸ æŒä¹…æ€§ï¼ˆDurabilityï¼‰**
```
äº‹åŠ¡æäº¤åï¼š
å³ä½¿ç³»ç»Ÿå´©æºƒã€æ–­ç”µç­‰æ„å¤–æƒ…å†µå‘ç”Ÿ
å·²æäº¤çš„æ•°æ®å˜æ›´ä¸ä¼šä¸¢å¤±

æŒä¹…æ€§ä¿è¯ï¼šæäº¤çš„ä¿®æ”¹æ°¸ä¹…ä¿å­˜
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡ç®¡ç†


**ğŸ”¸ ç°å®é—®é¢˜**
```
ç”µå•†ä¸‹å•åœºæ™¯ï¼š
1. æ‰£å‡å•†å“åº“å­˜   â† å¦‚æœè¿™é‡ŒæˆåŠŸäº†
2. åˆ›å»ºè®¢å•è®°å½•   â† ä½†è¿™é‡Œå¤±è´¥äº†
3. æ‰£é™¤ç”¨æˆ·ä½™é¢   â† è¿™é‡Œå°±ä¸åº”è¯¥æ‰§è¡Œ

æ²¡æœ‰äº‹åŠ¡ç®¡ç†ï¼šå¯èƒ½å‡ºç°åº“å­˜æ‰£äº†ï¼Œä½†è®¢å•æ²¡åˆ›å»ºï¼Œç”¨æˆ·é’±æ²¡æ‰£çš„æ··ä¹±çŠ¶æ€
```

**ğŸ”¸ è§£å†³æ–¹æ¡ˆ**
äº‹åŠ¡ç®¡ç†ç¡®ä¿**ä¸šåŠ¡æ“ä½œçš„å®Œæ•´æ€§**ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚

| æ²¡æœ‰äº‹åŠ¡ç®¡ç† | **å¯èƒ½çš„é—®é¢˜** | æœ‰äº‹åŠ¡ç®¡ç† | **è§£å†³æ–¹æ¡ˆ** |
|------------|--------------|-----------|-------------|
| ğŸ”´ **éƒ¨åˆ†æˆåŠŸ** | `æ•°æ®ä¸ä¸€è‡´` | ğŸŸ¢ **å…¨éƒ¨æˆåŠŸæˆ–å¤±è´¥** | `ä¿è¯æ•°æ®ä¸€è‡´æ€§` |
| ğŸ”´ **å¹¶å‘å†²çª** | `æ•°æ®è¢«è¦†ç›–` | ğŸŸ¢ **éš”ç¦»å¹¶å‘æ“ä½œ** | `é¿å…æ•°æ®å†²çª` |
| ğŸ”´ **ç³»ç»Ÿå´©æºƒ** | `æ•°æ®ä¸¢å¤±` | ğŸŸ¢ **è‡ªåŠ¨æ¢å¤æœºåˆ¶** | `ä¿è¯æ•°æ®æŒä¹…æ€§` |

---

## 2. ğŸ—ï¸ Springäº‹åŠ¡ç®¡ç†æ¶æ„


### 2.1 Springäº‹åŠ¡ç®¡ç†çš„ä¼˜åŠ¿


**ğŸ”¸ ä¼ ç»Ÿçš„äº‹åŠ¡å¤„ç†é—®é¢˜**
```java
// ä¼ ç»ŸJDBCäº‹åŠ¡å¤„ç† - ä»£ç å¾ˆç¹ç
Connection conn = null;
try {
    conn = dataSource.getConnection();
    conn.setAutoCommit(false);  // å¼€å§‹äº‹åŠ¡
    
    // æ‰§è¡Œä¸šåŠ¡æ“ä½œ
    // ... å¾ˆå¤šæ•°æ®åº“æ“ä½œä»£ç 
    
    conn.commit();  // æäº¤äº‹åŠ¡
} catch (Exception e) {
    conn.rollback();  // å›æ»šäº‹åŠ¡
} finally {
    conn.close();  // å…³é—­è¿æ¥
}
```

**ğŸ”¸ Springäº‹åŠ¡ç®¡ç†çš„æ”¹è¿›**
```java
// Springå£°æ˜å¼äº‹åŠ¡ - ç®€æ´æ˜äº†
@Transactional
public void transfer(String fromAccount, String toAccount, double amount) {
    // åªéœ€è¦ä¸“æ³¨ä¸šåŠ¡é€»è¾‘
    accountDao.debit(fromAccount, amount);
    accountDao.credit(toAccount, amount);
}
// Springè‡ªåŠ¨å¤„ç†äº‹åŠ¡çš„å¼€å¯ã€æäº¤ã€å›æ»š
```

> ğŸ’¡ **æ ¸å¿ƒä¼˜åŠ¿**  
> SpringæŠŠ**å¤æ‚çš„äº‹åŠ¡ç®¡ç†ä»£ç **éšè—èµ·æ¥ï¼Œè®©ç¨‹åºå‘˜**åªå…³æ³¨ä¸šåŠ¡é€»è¾‘**ï¼Œå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚

### 2.2 Springäº‹åŠ¡ç®¡ç†æ¶æ„å›¾


```
                    Springäº‹åŠ¡ç®¡ç†æ¶æ„
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            åº”ç”¨å±‚ (ä½ çš„ä¸šåŠ¡ä»£ç )            â”‚
        â”‚        @Transactional æ³¨è§£                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Spring AOP äº‹åŠ¡æ‹¦æˆªå™¨            â”‚
        â”‚       (TransactionInterceptor)         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    PlatformTransactionManager          â”‚
        â”‚         (äº‹åŠ¡ç®¡ç†å™¨æ¥å£)                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              å…·ä½“å®ç°                   â”‚
        â”‚  DataSourceTransactionManager          â”‚
        â”‚  JpaTransactionManager                 â”‚
        â”‚  HibernateTransactionManager           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            åº•å±‚æ•°æ®æº                   â”‚
        â”‚     MySQL/PostgreSQL/Oracleç­‰          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 äº‹åŠ¡ç®¡ç†çš„ä¸¤ç§æ–¹å¼


**ğŸ”¸ ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†**
```java
// æ‰‹åŠ¨ç¼–å†™äº‹åŠ¡æ§åˆ¶ä»£ç 
@Autowired
private PlatformTransactionManager txManager;

public void businessMethod() {
    TransactionStatus status = txManager.getTransaction(new DefaultTransactionDefinition());
    try {
        // ä¸šåŠ¡æ“ä½œ
        doBusinessLogic();
        txManager.commit(status);
    } catch (Exception e) {
        txManager.rollback(status);
        throw e;
    }
}
```

**ğŸ”¸ å£°æ˜å¼äº‹åŠ¡ç®¡ç†**
```java
// ä½¿ç”¨æ³¨è§£å£°æ˜ï¼ŒSpringè‡ªåŠ¨å¤„ç†
@Transactional
public void businessMethod() {
    // åªéœ€è¦å†™ä¸šåŠ¡é€»è¾‘ï¼ŒSpringè‡ªåŠ¨ç®¡ç†äº‹åŠ¡
    doBusinessLogic();
}
```

> ğŸš€ **æ¨èæ–¹å¼**  
> **å£°æ˜å¼äº‹åŠ¡**æ˜¯ä¸»æµé€‰æ‹©ï¼Œå› ä¸ºä»£ç æ›´ç®€æ´ï¼Œç»´æŠ¤æ›´å®¹æ˜“ï¼Œä¸šåŠ¡é€»è¾‘ä¸äº‹åŠ¡ç®¡ç†åˆ†ç¦»ã€‚

---

## 3. âš™ï¸ æ ¸å¿ƒç»„ä»¶è¯¦è§£


### 3.1 PlatformTransactionManagerï¼ˆäº‹åŠ¡ç®¡ç†å™¨æ¥å£ï¼‰


**ğŸ”¸ ä½œç”¨è¯´æ˜**
`PlatformTransactionManager`æ˜¯Springäº‹åŠ¡ç®¡ç†çš„**æ ¸å¿ƒæ¥å£**ï¼Œå°±åƒä¸€ä¸ª**æ€»æŒ‡æŒ¥**ï¼Œè´Ÿè´£ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„äº‹åŠ¡æ“ä½œã€‚

**ğŸ”¸ æ¥å£å®šä¹‰**
```java
public interface PlatformTransactionManager {
    // å¼€å§‹äº‹åŠ¡ï¼ˆè·å–äº‹åŠ¡ï¼‰
    TransactionStatus getTransaction(TransactionDefinition definition);
    
    // æäº¤äº‹åŠ¡
    void commit(TransactionStatus status);
    
    // å›æ»šäº‹åŠ¡
    void rollback(TransactionStatus status);
}
```

**ğŸ”¸ é€šä¿—ç†è§£**
æŠŠäº‹åŠ¡ç®¡ç†å™¨æƒ³è±¡æˆé“¶è¡Œçš„**æŸœå°ç®¡ç†å‘˜**ï¼š
- `getTransaction()` - å¼€å§‹åŠç†ä¸šåŠ¡ï¼Œç»™ä½ ä¸€ä¸ªå·ç ç‰Œ
- `commit()` - ä¸šåŠ¡åŠç†æˆåŠŸï¼Œç›–ç« ç¡®è®¤
- `rollback()` - ä¸šåŠ¡åŠç†å¤±è´¥ï¼Œæ’¤é”€æ‰€æœ‰æ“ä½œ

### 3.2 TransactionDefinitionï¼ˆäº‹åŠ¡å®šä¹‰ï¼‰


**ğŸ”¸ ä½œç”¨è¯´æ˜**
`TransactionDefinition`å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡çš„**å…·ä½“è§„åˆ™**ï¼Œå‘Šè¯‰Springè¿™ä¸ªäº‹åŠ¡åº”è¯¥æ€ä¹ˆæ‰§è¡Œã€‚

**ğŸ”¸ æ ¸å¿ƒå±æ€§**

| å±æ€§ | **è¯´æ˜** | **é€šä¿—ç†è§£** | **å¸¸ç”¨å€¼** |
|------|---------|-------------|-----------|
| **ä¼ æ’­è¡Œä¸º** | `äº‹åŠ¡å¦‚ä½•ä¼ æ’­` | `å¤šä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶çš„è§„åˆ™` | `REQUIRED, REQUIRES_NEW` |
| **éš”ç¦»çº§åˆ«** | `äº‹åŠ¡é—´çš„éš”ç¦»ç¨‹åº¦` | `å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œæ—¶äº’ç›¸å½±å“çš„ç¨‹åº¦` | `READ_COMMITTED` |
| **è¶…æ—¶æ—¶é—´** | `äº‹åŠ¡æœ€é•¿æ‰§è¡Œæ—¶é—´` | `è¶…è¿‡è¿™ä¸ªæ—¶é—´å°±è‡ªåŠ¨å›æ»š` | `30ç§’, 60ç§’` |
| **åªè¯»æ ‡å¿—** | `æ˜¯å¦åªè¯»äº‹åŠ¡` | `åªæŸ¥è¯¢ä¸ä¿®æ”¹çš„äº‹åŠ¡` | `true, false` |

**ğŸ”¸ ä¼ æ’­è¡Œä¸ºè¯¦è§£**
```java
// REQUIREDï¼šå¦‚æœæœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±åˆ›å»ºæ–°çš„ï¼ˆæœ€å¸¸ç”¨ï¼‰
@Transactional(propagation = Propagation.REQUIRED)
public void methodA() {
    methodB();  // methodBä¼šåŠ å…¥methodAçš„äº‹åŠ¡
}

// REQUIRES_NEWï¼šæ€»æ˜¯åˆ›å»ºæ–°äº‹åŠ¡ï¼ˆç‹¬ç«‹æ‰§è¡Œï¼‰
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void methodB() {
    // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ç‹¬ç«‹çš„äº‹åŠ¡ä¸­æ‰§è¡Œ
}
```

> ğŸ’¡ **ç”Ÿæ´»ç±»æ¯”**  
> **REQUIRED**åƒæ‹¼è½¦ï¼šæœ‰è½¦å°±ä¸Šè½¦ï¼Œæ²¡è½¦å°±å«æ–°è½¦  
> **REQUIRES_NEW**åƒæ‰“è½¦ï¼šä¸ç®¡æœ‰æ²¡æœ‰è½¦ï¼Œéƒ½è¦å«æ–°è½¦

### 3.3 TransactionStatusï¼ˆäº‹åŠ¡çŠ¶æ€ï¼‰


**ğŸ”¸ ä½œç”¨è¯´æ˜**
`TransactionStatus`è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡çš„**å½“å‰çŠ¶æ€**ï¼Œè®°å½•äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§ä¿¡æ¯ã€‚

**ğŸ”¸ æ ¸å¿ƒæ–¹æ³•**
```java
public interface TransactionStatus {
    boolean isNewTransaction();     // æ˜¯å¦æ˜¯æ–°äº‹åŠ¡
    boolean hasSavepoint();        // æ˜¯å¦æœ‰ä¿å­˜ç‚¹
    void setRollbackOnly();        // æ ‡è®°ä¸ºåªèƒ½å›æ»š
    boolean isRollbackOnly();      // æ˜¯å¦åªèƒ½å›æ»š
    boolean isCompleted();         // äº‹åŠ¡æ˜¯å¦å·²å®Œæˆ
}
```

**ğŸ”¸ çŠ¶æ€å˜åŒ–æµç¨‹**
```
äº‹åŠ¡å¼€å§‹ â†’ æ‰§è¡Œä¸­ â†’ å‡†å¤‡æäº¤ â†’ å·²æäº¤
    â†“        â†“        â†“        â†“
  NEW    ACTIVE   PREPARING  COMMITTED
    â†“        â†“        â†“
  å¼‚å¸¸    å¼‚å¸¸      å¼‚å¸¸
    â†“        â†“        â†“
 ROLLBACK  ROLLBACK  ROLLBACK
```

---

## 4. ğŸ”§ äº‹åŠ¡ç®¡ç†å™¨å®ç°


### 4.1 DataSourceTransactionManager


**ğŸ”¸ é€‚ç”¨åœºæ™¯**
å½“ä½ ä½¿ç”¨**JDBC**æˆ–**MyBatis**è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ä½¿ç”¨ã€‚

**ğŸ”¸ é…ç½®ç¤ºä¾‹**
```java
@Configuration
@EnableTransactionManagement
public class TransactionConfig {
    
    @Bean
    public DataSourceTransactionManager transactionManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}
```

**ğŸ”¸ å·¥ä½œåŸç†**
```
åº”ç”¨è°ƒç”¨ä¸šåŠ¡æ–¹æ³•
       â†“
Spring AOPæ‹¦æˆª
       â†“
DataSourceTransactionManagerè·å–æ•°æ®åº“è¿æ¥
       â†“
è®¾ç½® connection.setAutoCommit(false)
       â†“
æ‰§è¡Œä¸šåŠ¡æ–¹æ³•
       â†“
æˆåŠŸï¼šconnection.commit() / å¤±è´¥ï¼šconnection.rollback()
```

### 4.2 JpaTransactionManager


**ğŸ”¸ é€‚ç”¨åœºæ™¯**
å½“ä½ ä½¿ç”¨**JPA**ï¼ˆå¦‚Hibernateï¼‰è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ä½¿ç”¨ã€‚

**ğŸ”¸ é…ç½®ç¤ºä¾‹**
```java
@Configuration
@EnableTransactionManagement
@EnableJpaRepositories
public class JpaTransactionConfig {
    
    @Bean
    public JpaTransactionManager transactionManager(EntityManagerFactory emf) {
        return new JpaTransactionManager(emf);
    }
}
```

### 4.3 äº‹åŠ¡ç®¡ç†å™¨é€‰æ‹©æŒ‡å—


| æŠ€æœ¯æ ˆ | **æ¨èç®¡ç†å™¨** | **è¯´æ˜** |
|-------|---------------|----------|
| **JDBC + MyBatis** | `DataSourceTransactionManager` | `ç›´æ¥ç®¡ç†æ•°æ®åº“è¿æ¥` |
| **JPA + Hibernate** | `JpaTransactionManager` | `ç®¡ç†EntityManager` |
| **å¤šæ•°æ®æº** | `ChainedTransactionManager` | `åè°ƒå¤šä¸ªäº‹åŠ¡ç®¡ç†å™¨` |

---

## 5. ğŸ“ äº‹åŠ¡é…ç½®ä¸ä½¿ç”¨


### 5.1 åŸºæœ¬é…ç½®


**ğŸ”¸ å¯ç”¨äº‹åŠ¡ç®¡ç†**
```java
@Configuration
@EnableTransactionManagement  // å¯ç”¨äº‹åŠ¡ç®¡ç†
public class AppConfig {
    
    @Bean
    public DataSourceTransactionManager transactionManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}
```

### 5.2 å£°æ˜å¼äº‹åŠ¡ä½¿ç”¨


**ğŸ”¸ åŸºæœ¬ç”¨æ³•**
```java
@Service
public class AccountService {
    
    @Transactional  // è¿™ä¸ªæ–¹æ³•ä¼šåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œ
    public void transfer(Long fromId, Long toId, BigDecimal amount) {
        // æ‰£å‡è½¬å‡ºè´¦æˆ·ä½™é¢
        accountDao.updateBalance(fromId, amount.negate());
        
        // å¢åŠ è½¬å…¥è´¦æˆ·ä½™é¢
        accountDao.updateBalance(toId, amount);
        
        // å¦‚æœä»»ä½•ä¸€æ­¥å‡ºé”™ï¼Œæ•´ä¸ªæ“ä½œä¼šè‡ªåŠ¨å›æ»š
    }
}
```

**ğŸ”¸ è¯¦ç»†é…ç½®**
```java
@Transactional(
    propagation = Propagation.REQUIRED,    // ä¼ æ’­è¡Œä¸º
    isolation = Isolation.READ_COMMITTED,  // éš”ç¦»çº§åˆ«  
    timeout = 30,                          // è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    readOnly = false,                      // æ˜¯å¦åªè¯»
    rollbackFor = Exception.class          // å“ªäº›å¼‚å¸¸ä¼šå›æ»š
)
public void complexBusinessMethod() {
    // å¤æ‚ä¸šåŠ¡é€»è¾‘
}
```

### 5.3 å¸¸è§ä½¿ç”¨æ¨¡å¼


**ğŸ”¸ æœåŠ¡å±‚äº‹åŠ¡**
```java
@Service
@Transactional  // æ•´ä¸ªç±»çš„æ‰€æœ‰publicæ–¹æ³•éƒ½æœ‰äº‹åŠ¡
public class OrderService {
    
    public void createOrder(Order order) {
        // ä¿å­˜è®¢å•
        orderDao.save(order);
        
        // æ‰£å‡åº“å­˜
        productService.decreaseStock(order.getProductId(), order.getQuantity());
        
        // å‘é€é€šçŸ¥
        notificationService.sendOrderNotification(order);
    }
}
```

**ğŸ”¸ åªè¯»äº‹åŠ¡ä¼˜åŒ–**
```java
@Service
public class QueryService {
    
    @Transactional(readOnly = true)  // åªè¯»äº‹åŠ¡ï¼Œæé«˜æ€§èƒ½
    public List<Product> findProducts(String category) {
        return productDao.findByCategory(category);
    }
}
```

### 5.4 äº‹åŠ¡å›æ»šè§„åˆ™


**ğŸ”¸ é»˜è®¤å›æ»šè§„åˆ™**
```java
@Transactional
public void defaultRollback() {
    // RuntimeExceptionå’ŒErrorä¼šè‡ªåŠ¨å›æ»š
    throw new RuntimeException("è¿™ä¼šå¯¼è‡´å›æ»š");
    
    // æ£€æŸ¥å¼‚å¸¸ä¸ä¼šè‡ªåŠ¨å›æ»š
    // throw new Exception("è¿™ä¸ä¼šå›æ»š");
}
```

**ğŸ”¸ è‡ªå®šä¹‰å›æ»šè§„åˆ™**
```java
@Transactional(rollbackFor = {Exception.class, CustomException.class})
public void customRollback() throws Exception {
    // ç°åœ¨æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šå¯¼è‡´å›æ»š
    throw new Exception("è¿™ä¹Ÿä¼šå›æ»šäº†");
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡å®šä¹‰ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§çš„é€»è¾‘å·¥ä½œå•å…ƒ
ğŸ”¸ ACIDç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§
ğŸ”¸ ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼šPlatformTransactionManagerã€TransactionDefinitionã€TransactionStatus
ğŸ”¸ ä¸¤ç§ç®¡ç†æ–¹å¼ï¼šç¼–ç¨‹å¼ï¼ˆæ‰‹åŠ¨æ§åˆ¶ï¼‰ã€å£°æ˜å¼ï¼ˆæ³¨è§£æ§åˆ¶ï¼‰
ğŸ”¸ å¸¸ç”¨äº‹åŠ¡ç®¡ç†å™¨ï¼šDataSourceTransactionManagerã€JpaTransactionManager
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Springäº‹åŠ¡ç®¡ç†çš„æœ¬è´¨**
```
Springå¹¶ä¸èƒ½åˆ›é€ äº‹åŠ¡ï¼Œäº‹åŠ¡æ˜¯æ•°æ®åº“çš„åŠŸèƒ½
Springçš„ä½œç”¨æ˜¯ç®€åŒ–äº‹åŠ¡çš„ä½¿ç”¨ï¼Œæä¾›ç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹
è®©å¼€å‘è€…ç”¨ç®€å•çš„æ³¨è§£å°±èƒ½ä½¿ç”¨å¤æ‚çš„äº‹åŠ¡åŠŸèƒ½
```

**ğŸ”¹ å£°æ˜å¼äº‹åŠ¡çš„å·¥ä½œåŸç†**
```
@Transactionalæ³¨è§£ â†’ Spring AOPä»£ç† â†’ äº‹åŠ¡æ‹¦æˆªå™¨ â†’ äº‹åŠ¡ç®¡ç†å™¨ â†’ æ•°æ®åº“äº‹åŠ¡
æ ¸å¿ƒæ€æƒ³ï¼šç”¨AOPåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ äº‹åŠ¡æ§åˆ¶ä»£ç 
```

**ğŸ”¹ äº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„å®é™…æ„ä¹‰**
```
è§£å†³çš„é—®é¢˜ï¼šä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•æ—¶çš„å¤„ç†æ–¹å¼
REQUIREDï¼šä¸šåŠ¡å…³è”ç´§å¯†ï¼Œè¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­
REQUIRES_NEWï¼šä¸šåŠ¡ç›¸å¯¹ç‹¬ç«‹ï¼Œéœ€è¦å•ç‹¬çš„äº‹åŠ¡æ§åˆ¶
```

### 6.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å¼€å‘æ•ˆç‡æå‡**
- **ç®€åŒ–ä»£ç **ï¼šæ— éœ€æ‰‹å†™äº‹åŠ¡æ§åˆ¶ä»£ç 
- **é™ä½é”™è¯¯**ï¼šé¿å…å¿˜è®°commit/rollback
- **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰äº‹åŠ¡éƒ½é€šè¿‡Springç®¡ç†

**ğŸ¯ ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ**
- **æ•°æ®ä¸€è‡´æ€§**ï¼šä¿è¯ä¸šåŠ¡æ•°æ®çš„å®Œæ•´æ€§
- **å¼‚å¸¸å¤„ç†**ï¼šè‡ªåŠ¨å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ
- **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†æ•°æ®åº“è¿æ¥ç­‰èµ„æº

**ğŸ¯ ç»´æŠ¤ä¾¿åˆ©æ€§**
- **é…ç½®çµæ´»**ï¼šå¯ä»¥è½»æ¾è°ƒæ•´äº‹åŠ¡å‚æ•°
- **ç›‘æ§æ–¹ä¾¿**ï¼šå¯ä»¥ç»Ÿä¸€ç›‘æ§äº‹åŠ¡æ‰§è¡Œæƒ…å†µ
- **è°ƒè¯•ç®€å•**ï¼šé—®é¢˜å®šä½æ›´åŠ å®¹æ˜“

### 6.4 å­¦ä¹ å»ºè®®


**ğŸš€ å­¦ä¹ è·¯å¾„**
```
ç†è§£äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ â†’ æŒæ¡Springäº‹åŠ¡æ¶æ„ â†’ å­¦ä¼šåŸºæœ¬é…ç½®ä½¿ç”¨ â†’ æ·±å…¥ä¼ æ’­è¡Œä¸ºå’Œéš”ç¦»çº§åˆ«
```

**ğŸ’ª å®è·µå»ºè®®**
- å…ˆä»ç®€å•çš„`@Transactional`å¼€å§‹ä½¿ç”¨
- åœ¨å®é™…é¡¹ç›®ä¸­ä½“ä¼šäº‹åŠ¡çš„ä½œç”¨
- é€æ­¥å­¦ä¹ é«˜çº§ç‰¹æ€§å’Œä¼˜åŒ–æŠ€å·§
- å¤šåšå¼‚å¸¸æƒ…å†µçš„æµ‹è¯•ï¼Œç†è§£å›æ»šæœºåˆ¶

**ğŸ§  è®°å¿†å£è¯€**
```
Springäº‹åŠ¡ä¸‰å¤§å®ï¼šç®¡ç†å™¨ã€å®šä¹‰ã€çŠ¶æ€å°‘ä¸äº†
å£°æ˜å¼äº‹åŠ¡æœ€å¸¸ç”¨ï¼Œä¸€ä¸ªæ³¨è§£è§£çƒ¦æ¼
ACIDç‰¹æ€§è¦è®°ç‰¢ï¼Œæ•°æ®ä¸€è‡´æœ€é‡è¦
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Springäº‹åŠ¡ç®¡ç†æ˜¯å¯¹æ•°æ®åº“äº‹åŠ¡çš„**å°è£…å’Œç®€åŒ–**
- **@Transactional**æ³¨è§£æ˜¯æœ€å¸¸ç”¨çš„äº‹åŠ¡æ§åˆ¶æ–¹å¼
- äº‹åŠ¡ç®¡ç†çš„ç›®æ ‡æ˜¯ä¿è¯**æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§**
- é€‰æ‹©åˆé€‚çš„äº‹åŠ¡ç®¡ç†å™¨å’Œä¼ æ’­è¡Œä¸ºå¾ˆé‡è¦