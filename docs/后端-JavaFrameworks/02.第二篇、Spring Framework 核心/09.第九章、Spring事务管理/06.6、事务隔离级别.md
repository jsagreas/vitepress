---
title: 6ã€äº‹åŠ¡éš”ç¦»çº§åˆ«
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«](#1-ä»€ä¹ˆæ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«)
2. [æ•°æ®åº“å¹¶å‘é—®é¢˜](#2-æ•°æ®åº“å¹¶å‘é—®é¢˜)
3. [Springæ”¯æŒçš„éš”ç¦»çº§åˆ«](#3-Springæ”¯æŒçš„éš”ç¦»çº§åˆ«)
4. [éš”ç¦»çº§åˆ«è¯¦ç»†è§£æ](#4-éš”ç¦»çº§åˆ«è¯¦ç»†è§£æ)
5. [éš”ç¦»çº§åˆ«çš„é€‰æ‹©ç­–ç•¥](#5-éš”ç¦»çº§åˆ«çš„é€‰æ‹©ç­–ç•¥)
6. [å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’¡ ä»€ä¹ˆæ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«


### 1.1 éš”ç¦»çº§åˆ«çš„åŸºæœ¬æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸ªé“¶è¡Œï¼Œå¤šä¸ªäººåŒæ—¶åœ¨ä¸åŒçª—å£åŠç†ä¸šåŠ¡ã€‚å¦‚æœä¸åŠ æ§åˆ¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ··ä¹±ï¼š
- å¼ ä¸‰æ­£åœ¨è½¬è´¦ï¼Œæå››åŒæ—¶æŸ¥è¯¢ä½™é¢ï¼Œçœ‹åˆ°äº†è½¬è´¦ä¸€åŠçš„çŠ¶æ€
- ç‹äº”çš„å­˜æ¬¾æ“ä½œè¢«å…¶ä»–äººçš„æ“ä½œå¹²æ‰°ï¼Œå¯¼è‡´æ•°æ®é”™ä¹±

**äº‹åŠ¡éš”ç¦»çº§åˆ«**å°±æ˜¯æ•°æ®åº“ä¸ºäº†è§£å†³è¿™äº›å¹¶å‘é—®é¢˜è€Œåˆ¶å®šçš„**"è§„åˆ™"**ï¼š
- ğŸ¯ **æ ¸å¿ƒä½œç”¨**ï¼šæ§åˆ¶å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œæ—¶ï¼Œå®ƒä»¬ä¹‹é—´çš„**ç›¸äº’å½±å“ç¨‹åº¦**
- ğŸ”’ **æœ¬è´¨**ï¼šåœ¨**æ•°æ®ä¸€è‡´æ€§**å’Œ**ç³»ç»Ÿæ€§èƒ½**ä¹‹é—´æ‰¾å¹³è¡¡
- âš–ï¸ **æƒè¡¡**ï¼šéš”ç¦»çº§åˆ«è¶Šé«˜è¶Šå®‰å…¨ï¼Œä½†æ€§èƒ½è¶Šä½

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦éš”ç¦»çº§åˆ«


**ç°å®åœºæ™¯ç±»æ¯”**ï¼š
```
å›¾ä¹¦é¦†å€Ÿä¹¦ç³»ç»Ÿï¼š
æƒ…å†µ1ï¼šå®Œå…¨ä¸éš”ç¦»
- å°æ˜æ­£åœ¨å€Ÿã€ŠJavaç¼–ç¨‹ã€‹ï¼Œç³»ç»Ÿæ˜¾ç¤º"å¯å€Ÿ"
- åŒæ—¶å°çº¢ä¹Ÿåœ¨å€Ÿè¿™æœ¬ä¹¦ï¼Œä¹Ÿæ˜¾ç¤º"å¯å€Ÿ"
- ç»“æœï¼šä¸€æœ¬ä¹¦è¢«"å€Ÿç»™"äº†ä¸¤ä¸ªäººï¼

æƒ…å†µ2ï¼šå®Œå…¨éš”ç¦»
- å°æ˜å¼€å§‹å€Ÿä¹¦æ—¶ï¼Œæ•´ä¸ªå›¾ä¹¦é¦†ç³»ç»Ÿé”å®š
- å…¶ä»–äººéƒ½è¦ç­‰å°æ˜å€Ÿå®Œæ‰èƒ½æ“ä½œ
- ç»“æœï¼šå®‰å…¨ä½†æ•ˆç‡æä½

æƒ…å†µ3ï¼šåˆç†éš”ç¦»
- é’ˆå¯¹åŒä¸€æœ¬ä¹¦çš„æ“ä½œéœ€è¦ç­‰å¾…
- ä¸åŒä¹¦ç±çš„æ“ä½œå¯ä»¥å¹¶è¡Œè¿›è¡Œ
- ç»“æœï¼šæ—¢ä¿è¯å®‰å…¨åˆå…¼é¡¾æ•ˆç‡
```

### 1.3 éš”ç¦»çº§åˆ«ä¸æ€§èƒ½çš„å…³ç³»


```
éš”ç¦»ç¨‹åº¦ä¸æ€§èƒ½å¯¹æ¯”ï¼š

éš”ç¦»çº§åˆ«    å®‰å…¨æ€§    å¹¶å‘æ€§èƒ½    é€‚ç”¨åœºæ™¯
   â†‘         â†‘         â†“        å…³é”®æ•°æ®
SERIALIZABLE æœ€é«˜      æœ€ä½      é‡‘èç³»ç»Ÿ
REPEATABLE   é«˜        ä½        æŠ¥è¡¨ç³»ç»Ÿ  
READ_COMM.   ä¸­        ä¸­        ä¸€èˆ¬åº”ç”¨
READ_UNCO.   ä½        é«˜        æ—¥å¿—ç³»ç»Ÿ
   â†“         â†“         â†‘        å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜
```

---

## 2. âš ï¸ æ•°æ®åº“å¹¶å‘é—®é¢˜


### 2.1 ä¸‰å¤§ç»å…¸å¹¶å‘é—®é¢˜


åœ¨è®²éš”ç¦»çº§åˆ«ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£æ²¡æœ‰éš”ç¦»ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼š

#### ğŸ”¸ è„è¯»ï¼ˆDirty Readï¼‰


**é€šä¿—è§£é‡Š**ï¼šè¯»åˆ°äº†åˆ«äººè¿˜æ²¡æœ‰ç¡®è®¤æäº¤çš„æ•°æ®

**ç”Ÿæ´»åœºæ™¯**ï¼š
```
é“¶è¡Œè½¬è´¦åœºæ™¯ï¼š
æ—¶é—´çº¿    äº‹åŠ¡Aï¼ˆå¼ ä¸‰è½¬è´¦ï¼‰        äº‹åŠ¡Bï¼ˆæå››æŸ¥è¯¢ï¼‰
T1       å¼€å§‹è½¬è´¦ 1000å…ƒ
T2       è´¦æˆ·ä½™é¢æ”¹ä¸º 2000      
T3                              æŸ¥è¯¢ä½™é¢ = 2000 âŒè„è¯»
T4       è½¬è´¦å¤±è´¥ï¼Œå›æ»š
T5       è´¦æˆ·ä½™é¢æ¢å¤ä¸º 3000    
T6                              å®é™…ä½™é¢æ˜¯ 3000ï¼Œä¹‹å‰è¯»åˆ°çš„2000æ˜¯é”™çš„ï¼
```

**é—®é¢˜**ï¼šæå››çœ‹åˆ°çš„ 2000 ä½™é¢æ˜¯**å‡çš„**ï¼Œå› ä¸ºå¼ ä¸‰çš„è½¬è´¦æœ€ç»ˆå¤±è´¥äº†

#### ğŸ”¸ ä¸å¯é‡å¤è¯»ï¼ˆNon-Repeatable Readï¼‰


**é€šä¿—è§£é‡Š**ï¼šåŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå‰åä¸¤æ¬¡è¯»å–åŒä¸€æ•°æ®å¾—åˆ°ä¸åŒç»“æœ

**ç”Ÿæ´»åœºæ™¯**ï¼š
```
å•†å“ä»·æ ¼æŸ¥è¯¢ï¼š
æ—¶é—´çº¿    äº‹åŠ¡Aï¼ˆå°æ˜è´­ç‰©ï¼‰        äº‹åŠ¡Bï¼ˆå•†å®¶è°ƒä»·ï¼‰
T1       æŸ¥è¯¢å•†å“ä»·æ ¼ = 100
T2                              ä¿®æ”¹ä»·æ ¼ä¸º 120
T3                              æäº¤ä¿®æ”¹
T4       å†æ¬¡æŸ¥è¯¢ä»·æ ¼ = 120     âŒä¸å¯é‡å¤è¯»
T5       æŒ‰120ç»“è´¦ï¼Œæ¯”é¢„æœŸå¤šèŠ±20
```

**é—®é¢˜**ï¼šå°æ˜åœ¨åŒä¸€æ¬¡è´­ç‰©è¿‡ç¨‹ä¸­ï¼Œä¸¤æ¬¡çœ‹åˆ°çš„ä»·æ ¼ä¸ä¸€æ ·

#### ğŸ”¸ å¹»è¯»ï¼ˆPhantom Readï¼‰


**é€šä¿—è§£é‡Š**ï¼šåŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå‰åä¸¤æ¬¡æŸ¥è¯¢å¾—åˆ°ä¸åŒæ•°é‡çš„è®°å½•

**ç”Ÿæ´»åœºæ™¯**ï¼š
```
åº“å­˜ç›˜ç‚¹ï¼š
æ—¶é—´çº¿    äº‹åŠ¡Aï¼ˆä»“ç®¡ç›˜ç‚¹ï¼‰        äº‹åŠ¡Bï¼ˆæ–°å¢å•†å“ï¼‰
T1       æŸ¥è¯¢å•†å“æ€»æ•° = 100
T2       å¼€å§‹é€ä¸€ç›˜ç‚¹...
T3                              æ–°å¢ 5ä¸ªå•†å“
T4                              æäº¤æ–°å¢
T5       å†æ¬¡æŸ¥è¯¢æ€»æ•° = 105     âŒå¹»è¯»
T6       ç›˜ç‚¹ç»“æœå¯¹ä¸ä¸Šè´¦
```

**é—®é¢˜**ï¼šä»“ç®¡åœ¨ç›˜ç‚¹è¿‡ç¨‹ä¸­ï¼Œå•†å“æ€»æ•°"å‡­ç©º"å¢åŠ äº†

### 2.2 é—®é¢˜å¯¹æ¯”æ€»ç»“


| é—®é¢˜ç±»å‹ | **ç®€å•æè¿°** | **æ ¸å¿ƒç‰¹å¾** | **å½±å“** |
|---------|-------------|-------------|---------|
| ğŸ”¸ **è„è¯»** | `è¯»åˆ°æœªæäº¤çš„æ•°æ®` | `æ•°æ®å¯èƒ½æ˜¯å‡çš„` | `å†³ç­–åŸºäºé”™è¯¯ä¿¡æ¯` |
| ğŸ”¸ **ä¸å¯é‡å¤è¯»** | `åŒä¸€æ•°æ®å‰åä¸ä¸€è‡´` | `å•æ¡è®°å½•è¢«ä¿®æ”¹` | `ä¸šåŠ¡é€»è¾‘æ··ä¹±` |
| ğŸ”¸ **å¹»è¯»** | `è®°å½•æ•°é‡å‰åä¸ä¸€è‡´` | `è®°å½•æ€»æ•°å‘ç”Ÿå˜åŒ–` | `ç»Ÿè®¡ç»“æœé”™è¯¯` |

---

## 3. ğŸ¯ Springæ”¯æŒçš„éš”ç¦»çº§åˆ«


### 3.1 Springäº‹åŠ¡éš”ç¦»çº§åˆ«æšä¸¾


Springé€šè¿‡ `@Transactional` æ³¨è§£çš„ `isolation` å‚æ•°æ¥è®¾ç½®éš”ç¦»çº§åˆ«ï¼š

```java
// åŸºæœ¬è¯­æ³•
@Transactional(isolation = Isolation.READ_COMMITTED)
public void businessMethod() {
    // ä¸šåŠ¡é€»è¾‘
}
```

### 3.2 äº”ç§éš”ç¦»çº§åˆ«æ¦‚è§ˆ


```
Springäº‹åŠ¡éš”ç¦»çº§åˆ«å±‚æ¬¡ç»“æ„ï¼š

DEFAULT (é»˜è®¤)
   â†“ ä½¿ç”¨æ•°æ®åº“é»˜è®¤çº§åˆ«
   
READ_UNCOMMITTED (è¯»æœªæäº¤)
   â†“ å…è®¸æ‰€æœ‰å¹¶å‘é—®é¢˜
   
READ_COMMITTED (è¯»å·²æäº¤)  
   â†“ è§£å†³è„è¯»é—®é¢˜
   
REPEATABLE_READ (å¯é‡å¤è¯»)
   â†“ è§£å†³è„è¯» + ä¸å¯é‡å¤è¯»
   
SERIALIZABLE (ä¸²è¡ŒåŒ–)
   â†“ è§£å†³æ‰€æœ‰å¹¶å‘é—®é¢˜
```

### 3.3 éš”ç¦»çº§åˆ«è§£å†³é—®é¢˜å¯¹ç…§è¡¨


| éš”ç¦»çº§åˆ« | **è„è¯»** | **ä¸å¯é‡å¤è¯»** | **å¹»è¯»** | **æ€§èƒ½** |
|---------|---------|--------------|---------|---------|
| `READ_UNCOMMITTED` | âŒ | âŒ | âŒ | ğŸš€ğŸš€ğŸš€ğŸš€ |
| `READ_COMMITTED` | âœ… | âŒ | âŒ | ğŸš€ğŸš€ğŸš€ |
| `REPEATABLE_READ` | âœ… | âœ… | âŒ | ğŸš€ğŸš€ |
| `SERIALIZABLE` | âœ… | âœ… | âœ… | ğŸš€ |

> **è®°å¿†æŠ€å·§**ï¼šçº§åˆ«è¶Šé«˜ï¼Œè§£å†³çš„é—®é¢˜è¶Šå¤šï¼Œä½†æ€§èƒ½è¶Šå·®

---

## 4. ğŸ“– éš”ç¦»çº§åˆ«è¯¦ç»†è§£æ


### 4.1 DEFAULTï¼ˆé»˜è®¤çº§åˆ«ï¼‰


**å«ä¹‰**ï¼šä½¿ç”¨æ•°æ®åº“è‡ªå·±çš„é»˜è®¤éš”ç¦»çº§åˆ«

**å¸¸è§æ•°æ®åº“é»˜è®¤çº§åˆ«**ï¼š
- **MySQL**ï¼š`REPEATABLE_READ`
- **PostgreSQL**ï¼š`READ_COMMITTED`  
- **Oracle**ï¼š`READ_COMMITTED`
- **SQL Server**ï¼š`READ_COMMITTED`

```java
// ä½¿ç”¨é»˜è®¤çº§åˆ«ï¼ˆæ¨èï¼‰
@Transactional(isolation = Isolation.DEFAULT)
public void transferMoney(String from, String to, BigDecimal amount) {
    // è½¬è´¦é€»è¾‘
}

// æˆ–è€…ç›´æ¥çœç•¥ï¼ˆæ•ˆæœç›¸åŒï¼‰
@Transactional
public void transferMoney(String from, String to, BigDecimal amount) {
    // è½¬è´¦é€»è¾‘
}
```

**ğŸ¯ ä»€ä¹ˆæ—¶å€™ç”¨**ï¼š
- âœ… **90%çš„æƒ…å†µ**éƒ½ç”¨è¿™ä¸ªå°±å¤Ÿäº†
- âœ… è®©æ•°æ®åº“è‡ªå·±å†³å®šæœ€é€‚åˆçš„éš”ç¦»çº§åˆ«
- âœ… é¿å…è¿‡åº¦è®¾è®¡

### 4.2 READ_UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰


**å«ä¹‰**ï¼šèƒ½è¯»åˆ°å…¶ä»–äº‹åŠ¡è¿˜æ²¡æäº¤çš„æ•°æ®

**ç‰¹ç‚¹**ï¼š
- ğŸš€ **æ€§èƒ½æœ€é«˜**ï¼šå‡ ä¹æ²¡æœ‰é”æœºåˆ¶
- âš ï¸ **æœ€ä¸å®‰å…¨**ï¼šå¯èƒ½è¯»åˆ°é”™è¯¯æ•°æ®
- ğŸ“Š **è„è¯»é—®é¢˜**ï¼šè¯»åˆ°å¯èƒ½å›æ»šçš„æ•°æ®

**å®é™…åœºæ™¯æ¼”ç¤º**ï¼š
```
ç”µå•†ç³»ç»Ÿ - å•†å“åº“å­˜æ›´æ–°ï¼š

äº‹åŠ¡Aï¼šå‡å°‘åº“å­˜          äº‹åŠ¡Bï¼šæŸ¥è¯¢åº“å­˜
T1  åº“å­˜ 100 â†’ 95      
T2                      è¯»å–åº“å­˜ = 95 (è„è¯»!)
T3  æ“ä½œå¤±è´¥ï¼Œå›æ»š
T4  åº“å­˜æ¢å¤ä¸º 100     
T5                      å®é™…åº“å­˜æ˜¯100ï¼Œä¹‹å‰è¯»åˆ°95æ˜¯é”™çš„

ç»“æœï¼šå¯èƒ½å¯¼è‡´è¶…å–æˆ–å°‘å–
```

```java
@Transactional(isolation = Isolation.READ_UNCOMMITTED)
public void logAnalysis() {
    // ä»…ç”¨äºå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯
    // æ¯”å¦‚ï¼šæ—¥å¿—åˆ†æã€æ•°æ®ç»Ÿè®¡ç­‰
}
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- âœ… æ—¥å¿—åˆ†æç³»ç»Ÿ
- âœ… æ•°æ®æŠ¥è¡¨ï¼ˆå…è®¸å°è¯¯å·®ï¼‰
- âœ… ç¼“å­˜æ•°æ®æ›´æ–°
- âŒ ç»å¯¹ä¸èƒ½ç”¨äºé‡‘èã€è®¢å•ç­‰æ ¸å¿ƒä¸šåŠ¡

### 4.3 READ_COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰


**å«ä¹‰**ï¼šåªèƒ½è¯»åˆ°å·²ç»æäº¤çš„æ•°æ®

**ç‰¹ç‚¹**ï¼š
- âœ… **è§£å†³è„è¯»**ï¼šä¸ä¼šè¯»åˆ°é”™è¯¯æ•°æ®
- âš ï¸ **ä¸å¯é‡å¤è¯»**ï¼šåŒä¸€äº‹åŠ¡ä¸­æ•°æ®å¯èƒ½å˜åŒ–
- ğŸ¢ **ä¼ä¸šä¸»æµé€‰æ‹©**ï¼šOracleã€PostgreSQLé»˜è®¤çº§åˆ«

**å®é™…åœºæ™¯æ¼”ç¤º**ï¼š
```
ç”¨æˆ·ä¿¡æ¯æ›´æ–°ï¼š

äº‹åŠ¡Aï¼šä¿®æ”¹ç”¨æˆ·ç§¯åˆ†      äº‹åŠ¡Bï¼šæŸ¥è¯¢ç”¨æˆ·ç§¯åˆ†
T1  ç§¯åˆ† 1000 â†’ 1200   
T2                      è¯»å–ç§¯åˆ† = 1000 (å·²æäº¤æ•°æ®)
T3  æäº¤ä¿®æ”¹           
T4                      è¯»å–ç§¯åˆ† = 1200 (ä¸å¯é‡å¤è¯»)

ç»“æœï¼šå‰åä¸¤æ¬¡è¯»åˆ°ä¸åŒå€¼ï¼Œä½†éƒ½æ˜¯æ­£ç¡®çš„
```

```java
@Transactional(isolation = Isolation.READ_COMMITTED)
public void processOrder() {
    // é€‚ç”¨äºå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯
    Order order = orderService.getOrder(orderId);
    // ... ä¸šåŠ¡å¤„ç†
    // å¦‚æœå…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†è®¢å•ï¼Œè¿™é‡Œé‡æ–°æŸ¥è¯¢ä¼šçœ‹åˆ°æœ€æ–°æ•°æ®
}
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **ä¸€èˆ¬webåº”ç”¨**çš„é¦–é€‰
- âœ… æ•°æ®æ›´æ–°é¢‘ç¹çš„ç³»ç»Ÿ
- âœ… å¯¹å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯

### 4.4 REPEATABLE_READï¼ˆå¯é‡å¤è¯»ï¼‰


**å«ä¹‰**ï¼šåŒä¸€äº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ç»“æœç›¸åŒ

**ç‰¹ç‚¹**ï¼š
- âœ… **è§£å†³è„è¯» + ä¸å¯é‡å¤è¯»**
- âš ï¸ **å¯èƒ½æœ‰å¹»è¯»**ï¼šè®°å½•æ•°é‡å¯èƒ½å˜åŒ–
- ğŸ”’ **MySQLé»˜è®¤çº§åˆ«**ï¼šInnoDBé€šè¿‡MVCCæœºåˆ¶å®ç°

**å®é™…åœºæ™¯æ¼”ç¤º**ï¼š
```
è®¢å•ç»Ÿè®¡æŠ¥è¡¨ï¼š

äº‹åŠ¡Aï¼šç”Ÿæˆæœˆåº¦æŠ¥è¡¨      äº‹åŠ¡Bï¼šæ–°å¢è®¢å•
T1  æŸ¥è¯¢è®¢å•æ€»é‡‘é¢ = 10000
T2  æŸ¥è¯¢è®¢å•æ•°é‡ = 100    
T3                        æ–°å¢è®¢å• 500å…ƒ
T4  å†æŸ¥æ€»é‡‘é¢ = 10000    (å¯é‡å¤è¯»ï¼Œä¿æŒä¸€è‡´)
T5  å†æŸ¥æ•°é‡ = 100        (å¯é‡å¤è¯»ï¼Œä¿æŒä¸€è‡´)  
T6                        æäº¤æ–°å¢
T7  äº‹åŠ¡Aç»“æŸ

ç»“æœï¼šæŠ¥è¡¨æ•°æ®å‰åä¸€è‡´ï¼Œä½†å¯èƒ½ä¸æ˜¯æœ€æ–°çš„
```

```java
@Transactional(isolation = Isolation.REPEATABLE_READ)
public MonthlyReport generateReport(String month) {
    // ç”ŸæˆæŠ¥è¡¨è¿‡ç¨‹ä¸­ï¼Œè¯»åˆ°çš„æ•°æ®ä¿æŒä¸€è‡´
    BigDecimal totalAmount = orderService.getTotalAmount(month);
    int orderCount = orderService.getOrderCount(month);
    
    // ä¸­é—´å³ä½¿æœ‰å…¶ä»–äº‹åŠ¡ä¿®æ”¹æ•°æ®ï¼Œè¿™é‡Œé‡æ–°æŸ¥è¯¢ç»“æœä¹Ÿç›¸åŒ
    BigDecimal totalAmountAgain = orderService.getTotalAmount(month);
    // totalAmount == totalAmountAgain (ä¿è¯ä¸€è‡´)
    
    return new MonthlyReport(totalAmount, orderCount);
}
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **æ•°æ®æŠ¥è¡¨ç”Ÿæˆ**
- âœ… å¤æ‚è®¡ç®—è¿‡ç¨‹
- âœ… éœ€è¦æ•°æ®ä¸€è‡´æ€§çš„ç»Ÿè®¡åˆ†æ

### 4.5 SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰


**å«ä¹‰**ï¼šäº‹åŠ¡å®Œå…¨éš”ç¦»ï¼Œå°±åƒä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œ

**ç‰¹ç‚¹**ï¼š
- âœ… **è§£å†³æ‰€æœ‰å¹¶å‘é—®é¢˜**ï¼šæœ€å®‰å…¨
- ğŸŒ **æ€§èƒ½æœ€å·®**ï¼šåŸºæœ¬ä¸Šæ˜¯å•çº¿ç¨‹æ‰§è¡Œ
- ğŸ”’ **å®ç°æ–¹å¼**ï¼šé€šè¿‡é”æœºåˆ¶å¼ºåˆ¶ä¸²è¡Œ

**å®é™…åœºæ™¯æ¼”ç¤º**ï¼š
```
é“¶è¡Œè½¬è´¦ç³»ç»Ÿï¼š

äº‹åŠ¡Aï¼šè½¬è´¦æ“ä½œ          äº‹åŠ¡Bï¼šæŸ¥è¯¢ä½™é¢
T1  å¼€å§‹è½¬è´¦            
T2                      ç­‰å¾…äº‹åŠ¡Aç»“æŸ...
T3  æ‰£æ¬¾ + åŠ æ¬¾         
T4  æäº¤                
T5                      ç°åœ¨å¯ä»¥æŸ¥è¯¢äº†
T6                      æŸ¥è¯¢åˆ°å‡†ç¡®ä½™é¢

ç»“æœï¼šç»å¯¹å‡†ç¡®ï¼Œä½†ç­‰å¾…æ—¶é—´é•¿
```

```java
@Transactional(isolation = Isolation.SERIALIZABLE)
public void criticalFinancialOperation(String accountId, BigDecimal amount) {
    // å…³é”®é‡‘èæ“ä½œï¼Œç»å¯¹ä¸å…è®¸å¹¶å‘é—®é¢˜
    Account account = accountService.getAccount(accountId);
    
    if (account.getBalance().compareTo(amount) >= 0) {
        account.setBalance(account.getBalance().subtract(amount));
        accountService.updateAccount(account);
        // å…¶ä»–ç›¸å…³æ“ä½œ...
    }
    
    // æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å…¶ä»–äº‹åŠ¡èƒ½åŒæ—¶æ“ä½œç›¸å…³æ•°æ®
}
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **é‡‘èäº¤æ˜“ç³»ç»Ÿ**
- âœ… å…³é”®ä¸šåŠ¡æ“ä½œ
- âœ… æ•°æ®ç»å¯¹ä¸èƒ½å‡ºé”™çš„åœºæ™¯
- âŒ é«˜å¹¶å‘ç³»ç»Ÿæ…ç”¨

---

## 5. ğŸ¯ éš”ç¦»çº§åˆ«çš„é€‰æ‹©ç­–ç•¥


### 5.1 é€‰æ‹©å†³ç­–æ ‘


```
é€‰æ‹©éš”ç¦»çº§åˆ«çš„æ€è€ƒæµç¨‹ï¼š

å¼€å§‹
  â†“
æ˜¯å¦å…è®¸è„è¯»ï¼Ÿ
  â†“ æ˜¯                    â†“ å¦
READ_UNCOMMITTED          æ˜¯å¦å…è®¸ä¸å¯é‡å¤è¯»ï¼Ÿ
  â†“                         â†“ æ˜¯              â†“ å¦  
æ—¥å¿—ã€ç»Ÿè®¡ç±»åœºæ™¯          READ_COMMITTED      æ˜¯å¦å…è®¸å¹»è¯»ï¼Ÿ
                          â†“                    â†“ æ˜¯         â†“ å¦
                        ä¸€èˆ¬ä¸šåŠ¡åœºæ™¯        REPEATABLE_READ  SERIALIZABLE
                                            â†“                â†“
                                          æŠ¥è¡¨ã€åˆ†æ        é‡‘èã€å…³é”®ä¸šåŠ¡
```

### 5.2 ä¸åŒä¸šåŠ¡åœºæ™¯çš„å»ºè®®


#### ğŸ¢ ç”µå•†ç³»ç»Ÿ


```java
// å•†å“æµè§ˆ - å…è®¸çœ‹åˆ°æœ€æ–°ä¿¡æ¯
@Transactional(isolation = Isolation.READ_COMMITTED)
public Product getProduct(Long productId) {
    return productRepository.findById(productId);
}

// è®¢å•å¤„ç† - éœ€è¦æ•°æ®ä¸€è‡´æ€§
@Transactional(isolation = Isolation.REPEATABLE_READ)
public void processOrder(OrderRequest request) {
    // ç¡®ä¿å¤„ç†è¿‡ç¨‹ä¸­ä»·æ ¼ã€åº“å­˜ç­‰æ•°æ®ä¸å˜
}

// æ”¯ä»˜å¤„ç† - ç»å¯¹ä¸èƒ½å‡ºé”™
@Transactional(isolation = Isolation.SERIALIZABLE)
public PaymentResult processPayment(PaymentRequest request) {
    // æ”¯ä»˜é‡‘é¢è®¡ç®—å¿…é¡»ç²¾ç¡®
}
```

#### ğŸ“Š æ•°æ®åˆ†æç³»ç»Ÿ


```java
// å®æ—¶ç›‘æ§ - æ€§èƒ½ä¼˜å…ˆ
@Transactional(isolation = Isolation.READ_UNCOMMITTED)
public Dashboard getRealTimeDashboard() {
    // å…è®¸å°è¯¯å·®ï¼Œä½†è¦å¿«é€Ÿå“åº”
}

// æ—¥æŠ¥ç”Ÿæˆ - ä¸€è‡´æ€§ä¼˜å…ˆ
@Transactional(isolation = Isolation.REPEATABLE_READ)
public DailyReport generateDailyReport(LocalDate date) {
    // æŠ¥è¡¨æ•°æ®å¿…é¡»å‰åä¸€è‡´
}
```

### 5.3 é€‰æ‹©åŸåˆ™


| è€ƒè™‘å› ç´  | **é€‰æ‹©å»ºè®®** |
|---------|-------------|
| ğŸ¯ **ä¸€èˆ¬æƒ…å†µ** | `ä½¿ç”¨ DEFAULTï¼Œè®©æ•°æ®åº“å†³å®š` |
| ğŸš€ **æ€§èƒ½ä¼˜å…ˆ** | `READ_COMMITTED æˆ–æ›´ä½` |
| ğŸ”’ **ä¸€è‡´æ€§ä¼˜å…ˆ** | `REPEATABLE_READ æˆ–æ›´é«˜` |
| ğŸ’° **é‡‘èä¸šåŠ¡** | `SERIALIZABLE` |
| ğŸ“ˆ **å®æ—¶æ•°æ®** | `READ_COMMITTED` |
| ğŸ“Š **æŠ¥è¡¨ç»Ÿè®¡** | `REPEATABLE_READ` |

**ğŸ¯ æ–°æ‰‹å»ºè®®**ï¼š
- 90% çš„æƒ…å†µä½¿ç”¨ `DEFAULT` å°±å¤Ÿäº†
- æœ‰ç‰¹æ®Šéœ€æ±‚æ—¶å†è€ƒè™‘è°ƒæ•´
- ä¸è¦ä¸€å¼€å§‹å°±è¿‡åº¦ä¼˜åŒ–

---

## 6. ğŸ’¼ å®é™…åº”ç”¨æ¡ˆä¾‹


### 6.1 ç”µå•†è®¢å•ç³»ç»Ÿå®Œæ•´ç¤ºä¾‹


```java
@Service
public class OrderService {
    
    // æŸ¥çœ‹è®¢å•åˆ—è¡¨ - å…è®¸çœ‹åˆ°æœ€æ–°çŠ¶æ€
    @Transactional(isolation = Isolation.READ_COMMITTED)
    public List<Order> getUserOrders(Long userId) {
        return orderRepository.findByUserId(userId);
    }
    
    // åˆ›å»ºè®¢å• - éœ€è¦ç¡®ä¿å•†å“ä¿¡æ¯ä¸€è‡´
    @Transactional(isolation = Isolation.REPEATABLE_READ)
    public Order createOrder(OrderCreateRequest request) {
        // æŸ¥è¯¢å•†å“ä¿¡æ¯
        Product product = productService.getProduct(request.getProductId());
        
        // æ£€æŸ¥åº“å­˜ï¼ˆç¡®ä¿æ•´ä¸ªè¿‡ç¨‹ä¸­åº“å­˜æ•°æ®ä¸å˜ï¼‰
        if (product.getStock() < request.getQuantity()) {
            throw new InsufficientStockException();
        }
        
        // è®¡ç®—ä»·æ ¼ï¼ˆç¡®ä¿ä»·æ ¼åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¸å˜ï¼‰
        BigDecimal totalPrice = product.getPrice().multiply(
            new BigDecimal(request.getQuantity())
        );
        
        // åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(request.getUserId());
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        order.setTotalPrice(totalPrice);
        
        return orderRepository.save(order);
    }
    
    // æ”¯ä»˜è®¢å• - ç»å¯¹ä¸èƒ½å‡ºé”™
    @Transactional(isolation = Isolation.SERIALIZABLE)
    public PaymentResult payOrder(Long orderId, PaymentInfo paymentInfo) {
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new OrderNotFoundException());
            
        if (order.getStatus() != OrderStatus.PENDING) {
            throw new InvalidOrderStatusException();
        }
        
        // è°ƒç”¨æ”¯ä»˜æ¥å£
        PaymentResult result = paymentService.processPayment(paymentInfo);
        
        if (result.isSuccess()) {
            order.setStatus(OrderStatus.PAID);
            orderRepository.save(order);
            
            // å‡åº“å­˜
            productService.decreaseStock(order.getProductId(), order.getQuantity());
        }
        
        return result;
    }
}
```

### 6.2 é“¶è¡Œè½¬è´¦ç³»ç»Ÿç¤ºä¾‹


```java
@Service
public class BankService {
    
    // æŸ¥è¯¢ä½™é¢ - æŸ¥çœ‹å·²æäº¤çš„æœ€æ–°ä½™é¢
    @Transactional(isolation = Isolation.READ_COMMITTED, readOnly = true)
    public BigDecimal getBalance(String accountNumber) {
        Account account = accountRepository.findByAccountNumber(accountNumber);
        return account != null ? account.getBalance() : BigDecimal.ZERO;
    }
    
    // è½¬è´¦æ“ä½œ - ç»å¯¹ä¸èƒ½å‡ºç°å¹¶å‘é—®é¢˜
    @Transactional(isolation = Isolation.SERIALIZABLE)
    public TransferResult transfer(String fromAccount, String toAccount, 
                                 BigDecimal amount) {
        // æŸ¥è¯¢è½¬å‡ºè´¦æˆ·
        Account from = accountRepository.findByAccountNumber(fromAccount);
        if (from == null) {
            return TransferResult.fail("è½¬å‡ºè´¦æˆ·ä¸å­˜åœ¨");
        }
        
        // æŸ¥è¯¢è½¬å…¥è´¦æˆ·  
        Account to = accountRepository.findByAccountNumber(toAccount);
        if (to == null) {
            return TransferResult.fail("è½¬å…¥è´¦æˆ·ä¸å­˜åœ¨");
        }
        
        // æ£€æŸ¥ä½™é¢
        if (from.getBalance().compareTo(amount) < 0) {
            return TransferResult.fail("ä½™é¢ä¸è¶³");
        }
        
        // æ‰§è¡Œè½¬è´¦
        from.setBalance(from.getBalance().subtract(amount));
        to.setBalance(to.getBalance().add(amount));
        
        accountRepository.save(from);
        accountRepository.save(to);
        
        // è®°å½•è½¬è´¦æµæ°´
        TransferRecord record = new TransferRecord();
        record.setFromAccount(fromAccount);
        record.setToAccount(toAccount);
        record.setAmount(amount);
        record.setTransferTime(LocalDateTime.now());
        transferRecordRepository.save(record);
        
        return TransferResult.success("è½¬è´¦æˆåŠŸ");
    }
}
```

### 6.3 æ•°æ®æŠ¥è¡¨ç³»ç»Ÿç¤ºä¾‹


```java
@Service
public class ReportService {
    
    // ç”Ÿæˆæœˆåº¦é”€å”®æŠ¥è¡¨ - ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
    @Transactional(isolation = Isolation.REPEATABLE_READ, readOnly = true)
    public MonthlySalesReport generateMonthlySalesReport(String month) {
        // ç¬¬ä¸€æ¬¡æŸ¥è¯¢é”€å”®æ€»é¢
        BigDecimal totalSales = orderRepository.getTotalSalesByMonth(month);
        
        // æŸ¥è¯¢è®¢å•æ•°é‡
        Long orderCount = orderRepository.getOrderCountByMonth(month);
        
        // æŸ¥è¯¢å¹³å‡å®¢å•ä»·ï¼ˆåŸºäºå‰é¢æŸ¥è¯¢çš„æ•°æ®è®¡ç®—ï¼‰
        BigDecimal avgOrderValue = totalSales.divide(new BigDecimal(orderCount), 
                                                   2, RoundingMode.HALF_UP);
        
        // å†æ¬¡æŸ¥è¯¢é”€å”®æ€»é¢ï¼ˆåº”è¯¥å’Œç¬¬ä¸€æ¬¡ç›¸åŒï¼‰
        BigDecimal totalSalesVerify = orderRepository.getTotalSalesByMonth(month);
        
        // åœ¨REPEATABLE_READçº§åˆ«ä¸‹ï¼Œä¸¤æ¬¡æŸ¥è¯¢ç»“æœå¿…é¡»ç›¸åŒ
        assert totalSales.equals(totalSalesVerify) : "æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥";
        
        // æ„å»ºæŠ¥è¡¨
        MonthlySalesReport report = new MonthlySalesReport();
        report.setMonth(month);
        report.setTotalSales(totalSales);
        report.setOrderCount(orderCount);
        report.setAvgOrderValue(avgOrderValue);
        report.setGenerateTime(LocalDateTime.now());
        
        return report;
    }
    
    // å®æ—¶æ•°æ®ç›‘æ§ - æ€§èƒ½ä¼˜å…ˆï¼Œå…è®¸å°è¯¯å·®
    @Transactional(isolation = Isolation.READ_UNCOMMITTED, readOnly = true)
    public RealTimeMetrics getRealTimeMetrics() {
        // å¿«é€Ÿè·å–å®æ—¶æŒ‡æ ‡ï¼Œå…è®¸è¯»å–æœªæäº¤æ•°æ®
        RealTimeMetrics metrics = new RealTimeMetrics();
        metrics.setCurrentOnlineUsers(userService.getOnlineUserCount());
        metrics.setTodayOrders(orderRepository.getTodayOrderCount());
        metrics.setTodaySales(orderRepository.getTodaySales());
        
        return metrics;
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šæ§åˆ¶å¹¶å‘äº‹åŠ¡é—´ç›¸äº’å½±å“çš„ç¨‹åº¦
ğŸ”¸ ä¸‰å¤§å¹¶å‘é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»
ğŸ”¸ äº”ç§éš”ç¦»çº§åˆ«ï¼šDEFAULTã€READ_UNCOMMITTEDã€READ_COMMITTEDã€
                REPEATABLE_READã€SERIALIZABLE
ğŸ”¸ æƒè¡¡åŸåˆ™ï¼šéš”ç¦»çº§åˆ«è¶Šé«˜è¶Šå®‰å…¨ï¼Œä½†æ€§èƒ½è¶Šä½
ğŸ”¸ é€‰æ‹©ç­–ç•¥ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ éš”ç¦»çº§åˆ«ä¸æ˜¯è¶Šé«˜è¶Šå¥½**
```
å¸¸è§è¯¯åŒºï¼š
âŒ ä¸ºäº†å®‰å…¨ï¼Œç»Ÿä¸€ä½¿ç”¨SERIALIZABLE
âœ… æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚é€‰æ‹©

æ­£ç¡®ç†è§£ï¼š
- ä¸€èˆ¬ä¸šåŠ¡ï¼šREAD_COMMITTEDè¶³å¤Ÿ
- æŠ¥è¡¨ç»Ÿè®¡ï¼šREPEATABLE_READåˆé€‚  
- é‡‘èäº¤æ˜“ï¼šSERIALIZABLEå¿…è¦
- æ—¥å¿—åˆ†æï¼šREAD_UNCOMMITTEDå¯æ¥å—
```

**ğŸ”¹ DEFAULTæ˜¯æœ€å¥½çš„é€‰æ‹©**
```
ä¸ºä»€ä¹ˆæ¨èDEFAULTï¼š
âœ… æ•°æ®åº“å‚å•†å·²ç»è¿‡å……åˆ†æµ‹è¯•
âœ… é’ˆå¯¹è‡ªèº«ç‰¹ç‚¹åšäº†ä¼˜åŒ–
âœ… é¿å…å¼€å‘è€…è¿‡åº¦è®¾è®¡
âœ… 90%çš„åœºæ™¯éƒ½èƒ½æ»¡è¶³éœ€æ±‚
```

**ğŸ”¹ ç†è§£ä¸šåŠ¡åœºæ™¯æ¯”è®°ä½ç†è®ºæ›´é‡è¦**
```
å®è·µå»ºè®®ï¼š
- å…ˆç†è§£ä¸šåŠ¡å¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚
- å†é€‰æ‹©å¯¹åº”çš„éš”ç¦»çº§åˆ«
- é€šè¿‡æµ‹è¯•éªŒè¯é€‰æ‹©æ˜¯å¦åˆé€‚
- å‡ºç°é—®é¢˜å†è€ƒè™‘è°ƒæ•´
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æ–°æ‰‹ä½¿ç”¨å»ºè®®**
- ğŸ“– **å­¦ä¹ é˜¶æ®µ**ï¼šç†è§£æ¯ç§çº§åˆ«è§£å†³çš„é—®é¢˜
- ğŸ”§ **å®è·µé˜¶æ®µ**ï¼š90%åœºæ™¯ä½¿ç”¨DEFAULTå³å¯
- ğŸš€ **ä¼˜åŒ–é˜¶æ®µ**ï¼šæ ¹æ®å…·ä½“é—®é¢˜è°ƒæ•´çº§åˆ«
- ğŸ’ª **é«˜çº§é˜¶æ®µ**ï¼šç»“åˆæ•°æ®åº“ç‰¹æ€§æ·±åº¦ä¼˜åŒ–

**ğŸ”§ é…ç½®ä½¿ç”¨æŠ€å·§**
```java
// æ–¹æ³•çº§åˆ«é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
@Transactional(isolation = Isolation.READ_COMMITTED)
public void methodLevel() { }

// ç±»çº§åˆ«é…ç½®ï¼ˆä½œä¸ºé»˜è®¤å€¼ï¼‰
@Transactional(isolation = Isolation.REPEATABLE_READ)
@Service
public class ServiceClass { }

// å…¨å±€é…ç½®ï¼ˆapplication.propertiesï¼‰
spring.jpa.properties.hibernate.connection.isolation=2
```

**âš ï¸ å¸¸è§é—®é¢˜é¿å…**
- âŒ ä¸è¦ä¸ºäº†"å®‰å…¨"ç›²ç›®ä½¿ç”¨é«˜éš”ç¦»çº§åˆ«
- âŒ ä¸è¦å¿½è§†æ•°æ®åº“æœ¬èº«çš„é»˜è®¤è®¾ç½®
- âŒ ä¸è¦åœ¨é«˜å¹¶å‘åœºæ™¯éšæ„ä½¿ç”¨SERIALIZABLE
- âœ… è¦æ ¹æ®å®é™…æµ‹è¯•ç»“æœé€‰æ‹©åˆé€‚çº§åˆ«

### 7.4 æ‰©å±•å­¦ä¹ æ–¹å‘


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**
- äº†è§£ä¸åŒæ•°æ®åº“çš„éš”ç¦»çº§åˆ«å®ç°æœºåˆ¶
- å­¦ä¹ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰åŸç†
- æŒæ¡æ•°æ®åº“é”æœºåˆ¶
- å®è·µé«˜å¹¶å‘åœºæ™¯ä¸‹çš„äº‹åŠ¡è°ƒä¼˜

**ğŸ” ç›¸å…³çŸ¥è¯†ç‚¹**
- Springäº‹åŠ¡ä¼ æ’­è¡Œä¸º
- æ•°æ®åº“è¿æ¥æ± é…ç½®
- åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
- æ•°æ®åº“æ€§èƒ½ç›‘æ§

**æ ¸å¿ƒè®°å¿†**ï¼š
- éš”ç¦»çº§åˆ«æ˜¯æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½çš„å¹³è¡¡
- DEFAULTæ˜¯æœ€ä½³çš„èµ·ç‚¹é€‰æ‹©
- ç†è§£ä¸šåŠ¡åœºæ™¯æ¯”èƒŒè¯µç†è®ºæ›´é‡è¦
- é€šè¿‡å®é™…æµ‹è¯•éªŒè¯é€‰æ‹©çš„æ­£ç¡®æ€§