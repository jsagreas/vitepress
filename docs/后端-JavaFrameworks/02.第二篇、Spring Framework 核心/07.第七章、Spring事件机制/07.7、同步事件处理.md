---
title: 7ã€åŒæ­¥äº‹ä»¶å¤„ç†
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯åŒæ­¥äº‹ä»¶å¤„ç†](#1-ä»€ä¹ˆæ˜¯åŒæ­¥äº‹ä»¶å¤„ç†)
2. [åŒæ­¥äº‹ä»¶çš„å·¥ä½œåŸç†](#2-åŒæ­¥äº‹ä»¶çš„å·¥ä½œåŸç†)
3. [é¡ºåºæ‰§è¡Œç‰¹æ€§](#3-é¡ºåºæ‰§è¡Œç‰¹æ€§)
4. [é˜»å¡å¤„ç†æœºåˆ¶](#4-é˜»å¡å¤„ç†æœºåˆ¶)
5. [å¼‚å¸¸ä¼ æ’­è§„åˆ™](#5-å¼‚å¸¸ä¼ æ’­è§„åˆ™)
6. [äº‹åŠ¡ä¸€è‡´æ€§ä¿éšœ](#6-äº‹åŠ¡ä¸€è‡´æ€§ä¿éšœ)
7. [æ€§èƒ½å½±å“åˆ†æ](#7-æ€§èƒ½å½±å“åˆ†æ)
8. [é”™è¯¯æ¢å¤ç­–ç•¥](#8-é”™è¯¯æ¢å¤ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯åŒæ­¥äº‹ä»¶å¤„ç†


### 1.1 é€šä¿—ç†è§£åŒæ­¥äº‹ä»¶


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
```
æƒ³è±¡ä½ åœ¨é“¶è¡ŒåŠä¸šåŠ¡ï¼š
1. ä½ å¡«å†™å­˜æ¬¾å•ï¼ˆå‘å¸ƒäº‹ä»¶ï¼‰
2. æŸœå‘˜æ¥æ”¶å•æ®ï¼ˆç›‘å¬äº‹ä»¶ï¼‰
3. æŸœå‘˜å¤„ç†å­˜æ¬¾ï¼ˆå¤„ç†äº‹ä»¶ï¼‰
4. å¤„ç†å®Œæ‰èƒ½åŠä¸‹ä¸€ä¸ªä¸šåŠ¡ï¼ˆåŒæ­¥é˜»å¡ï¼‰

è¿™å°±æ˜¯"åŒæ­¥"çš„æœ¬è´¨ï¼šä¸€ä»¶äº‹åšå®Œæ‰èƒ½åšä¸‹ä¸€ä»¶
```

### 1.2 Springä¸­çš„åŒæ­¥äº‹ä»¶


**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
åŒæ­¥äº‹ä»¶å¤„ç†ï¼ˆSynchronous Event Handlingï¼‰ï¼š
- äº‹ä»¶å‘å¸ƒè€…å‘å¸ƒäº‹ä»¶åï¼Œä¼šç­‰å¾…æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œæ¯•
- ç›‘å¬å™¨æŒ‰é¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œ
- å‰ä¸€ä¸ªç›‘å¬å™¨æ‰§è¡Œå®Œï¼Œä¸‹ä¸€ä¸ªæ‰èƒ½å¼€å§‹
- æ•´ä¸ªè¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œå‘å¸ƒè€…éœ€è¦ç­‰å¾…
```

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šåŒæ­¥äº‹ä»¶å°±åƒæ’é˜Ÿä¹°ç¥¨ï¼Œå‰é¢çš„äººä¸ä¹°å®Œï¼Œåé¢çš„äººå°±å¾—ç­‰ç€

### 1.3 ä¸å¼‚æ­¥äº‹ä»¶çš„åŒºåˆ«


```
åŒæ­¥äº‹ä»¶å¤„ç†æµç¨‹ï¼š
å‘å¸ƒè€… â”€â”€[å‘å¸ƒäº‹ä»¶]â”€â”€> ç›‘å¬å™¨1 â”€â”€> ç›‘å¬å™¨2 â”€â”€> ç›‘å¬å™¨3 â”€â”€> å‘å¸ƒè€…ç»§ç»­
  â¸ï¸ ç­‰å¾…                â¸ï¸ ç­‰å¾…      â¸ï¸ ç­‰å¾…      âœ… å®Œæˆ

å¼‚æ­¥äº‹ä»¶å¤„ç†æµç¨‹ï¼š
å‘å¸ƒè€… â”€â”€[å‘å¸ƒäº‹ä»¶]â”€â”€> äº¤ç»™çº¿ç¨‹æ±  â”€â”€> ç›‘å¬å™¨ä»¬å¹¶è¡Œæ‰§è¡Œ
  âœ… ç«‹å³ç»§ç»­                          ï¼ˆå‘å¸ƒè€…ä¸ç­‰å¾…ï¼‰
```

**å¯¹æ¯”è¡¨æ ¼**ï¼š

| ç‰¹æ€§ | **åŒæ­¥äº‹ä»¶** | **å¼‚æ­¥äº‹ä»¶** |
|------|------------|------------|
| **æ‰§è¡Œæ–¹å¼** | `é¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªæ¥ä¸€ä¸ª` | `å¹¶è¡Œæ‰§è¡Œï¼Œäº’ä¸å½±å“` |
| **æ˜¯å¦é˜»å¡** | `é˜»å¡å‘å¸ƒè€…ï¼Œéœ€è¦ç­‰å¾…` | `ä¸é˜»å¡ï¼Œç«‹å³è¿”å›` |
| **å¼‚å¸¸å¤„ç†** | `å¼‚å¸¸ä¼šä¼ æ’­åˆ°å‘å¸ƒè€…` | `å¼‚å¸¸åœ¨ç›‘å¬å™¨å†…éƒ¨å¤„ç†` |
| **äº‹åŠ¡æ”¯æŒ** | `å¯ä»¥å…±äº«äº‹åŠ¡ä¸Šä¸‹æ–‡` | `ç‹¬ç«‹äº‹åŠ¡ï¼Œä¸å…±äº«` |
| **æ€§èƒ½å½±å“** | `å¯èƒ½å½±å“ä¸»æµç¨‹é€Ÿåº¦` | `ä¸å½±å“ä¸»æµç¨‹æ€§èƒ½` |

---

## 2. ğŸ”„ åŒæ­¥äº‹ä»¶çš„å·¥ä½œåŸç†


### 2.1 åŸºæœ¬å·¥ä½œæµç¨‹


**å®Œæ•´æµç¨‹å›¾ç¤º**ï¼š
```
ç”¨æˆ·è¯·æ±‚
   |
   v
ä¸šåŠ¡æ–¹æ³•å¼€å§‹
   |
   v
æ‰§è¡Œä¸šåŠ¡é€»è¾‘
   |
   v
å‘å¸ƒäº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   |                  |
   â¸ï¸ æš‚åœç­‰å¾…         v
   |              ç›‘å¬å™¨Aå¼€å§‹
   |                  |
   |                  v
   |              ç›‘å¬å™¨Aæ‰§è¡Œ
   |                  |
   |                  v
   |              ç›‘å¬å™¨Aç»“æŸ
   |                  |
   |                  v
   |              ç›‘å¬å™¨Bå¼€å§‹
   |                  |
   |                  v
   |              ç›‘å¬å™¨Bæ‰§è¡Œ
   |                  |
   |                  v
   |              ç›‘å¬å™¨Bç»“æŸ
   |                  |
   â¸ï¸ ç­‰å¾…ç»“æŸ <â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   |
   v
ç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘
   |
   v
è¿”å›å“åº”
```

### 2.2 ä»£ç ç¤ºä¾‹ï¼šåŸºæœ¬ä½¿ç”¨


**æ­¥éª¤1ï¼šå®šä¹‰äº‹ä»¶ç±»**
```java
// è‡ªå®šä¹‰äº‹ä»¶ï¼šç”¨æˆ·æ³¨å†Œäº‹ä»¶
public class UserRegisterEvent extends ApplicationEvent {
    private String username;
    private String email;
    
    public UserRegisterEvent(Object source, String username, String email) {
        super(source);
        this.username = username;
        this.email = email;
    }
    
    // getters
}
```

**æ­¥éª¤2ï¼šå‘å¸ƒäº‹ä»¶**
```java
@Service
public class UserService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void registerUser(String username, String email) {
        // 1. æ‰§è¡Œæ³¨å†Œé€»è¾‘
        System.out.println("å¼€å§‹æ³¨å†Œç”¨æˆ·ï¼š" + username);
        
        // 2. å‘å¸ƒäº‹ä»¶ï¼ˆåŒæ­¥ï¼Œä¼šç­‰å¾…æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œï¼‰
        UserRegisterEvent event = new UserRegisterEvent(this, username, email);
        eventPublisher.publishEvent(event);
        
        // 3. æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œåæ‰ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
        System.out.println("ç”¨æˆ·æ³¨å†Œå®Œæˆ");
    }
}
```

**æ­¥éª¤3ï¼šç›‘å¬äº‹ä»¶**
```java
@Component
public class EmailListener {
    
    // é»˜è®¤å°±æ˜¯åŒæ­¥ç›‘å¬å™¨
    @EventListener
    public void sendEmail(UserRegisterEvent event) {
        System.out.println("  ç›‘å¬å™¨1ï¼šå‘é€æ¬¢è¿é‚®ä»¶ç»™ " + event.getUsername());
        // æ¨¡æ‹Ÿé‚®ä»¶å‘é€è€—æ—¶
        Thread.sleep(1000);
    }
}

@Component
public class LogListener {
    
    @EventListener
    public void recordLog(UserRegisterEvent event) {
        System.out.println("  ç›‘å¬å™¨2ï¼šè®°å½•æ³¨å†Œæ—¥å¿— " + event.getUsername());
        Thread.sleep(500);
    }
}
```

**æ‰§è¡Œæ•ˆæœ**ï¼š
```
å¼€å§‹æ³¨å†Œç”¨æˆ·ï¼šå¼ ä¸‰
  ç›‘å¬å™¨1ï¼šå‘é€æ¬¢è¿é‚®ä»¶ç»™ å¼ ä¸‰  ï¼ˆè€—æ—¶1ç§’ï¼‰
  ç›‘å¬å™¨2ï¼šè®°å½•æ³¨å†Œæ—¥å¿— å¼ ä¸‰    ï¼ˆè€—æ—¶0.5ç§’ï¼‰
ç”¨æˆ·æ³¨å†Œå®Œæˆ                    ï¼ˆæ€»å…±ç­‰å¾…1.5ç§’åæ‰è¾“å‡ºï¼‰
```

---

## 3. ğŸ“ é¡ºåºæ‰§è¡Œç‰¹æ€§


### 3.1 ç›‘å¬å™¨æ‰§è¡Œé¡ºåº


**é»˜è®¤æ‰§è¡Œé¡ºåº**ï¼š
```
Springä¸­å¤šä¸ªç›‘å¬å™¨çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„
å¯ä»¥ä½¿ç”¨ @Order æ³¨è§£æ¥æŒ‡å®šé¡ºåº
æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜
```

**ç¤ºä¾‹ä»£ç **ï¼š
```java
@Component
public class OrderedListeners {
    
    // ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œ
    @Order(1)
    @EventListener
    public void firstListener(UserRegisterEvent event) {
        System.out.println("ç¬¬1ä¸ªæ‰§è¡Œï¼šåˆå§‹åŒ–ç”¨æˆ·é…ç½®");
    }
    
    // ç¬¬äºŒä¸ªæ‰§è¡Œ
    @Order(2)
    @EventListener
    public void secondListener(UserRegisterEvent event) {
        System.out.println("ç¬¬2ä¸ªæ‰§è¡Œï¼šå‘é€æ¬¢è¿æ¶ˆæ¯");
    }
    
    // ä¼˜å…ˆçº§æœ€ä½ï¼Œæœ€åæ‰§è¡Œ
    @Order(10)
    @EventListener
    public void lastListener(UserRegisterEvent event) {
        System.out.println("ç¬¬3ä¸ªæ‰§è¡Œï¼šç»Ÿè®¡åˆ†æ");
    }
}
```

**æ‰§è¡Œç»“æœ**ï¼š
```
ç¬¬1ä¸ªæ‰§è¡Œï¼šåˆå§‹åŒ–ç”¨æˆ·é…ç½®
ç¬¬2ä¸ªæ‰§è¡Œï¼šå‘é€æ¬¢è¿æ¶ˆæ¯
ç¬¬3ä¸ªæ‰§è¡Œï¼šç»Ÿè®¡åˆ†æ
```

> âš ï¸ **æ³¨æ„**ï¼šå¦‚æœä¸æŒ‡å®š@Orderï¼Œæ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ï¼Œä¸åŒç‰ˆæœ¬Springå¯èƒ½ä¸ä¸€æ ·

### 3.2 é¡ºåºæ‰§è¡Œçš„ä¼˜åŠ¿


**ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹**ï¼š
```
ç”¨æˆ·ä¸‹å•æµç¨‹éœ€è¦ä¸¥æ ¼é¡ºåºï¼š

æ­¥éª¤1ï¸âƒ£ æ‰£å‡åº“å­˜     ï¼ˆå¿…é¡»å…ˆæ‰§è¡Œï¼‰
    â†“
æ­¥éª¤2ï¸âƒ£ ç”Ÿæˆè®¢å•     ï¼ˆåº“å­˜æ‰£å‡æˆåŠŸåï¼‰
    â†“
æ­¥éª¤3ï¸âƒ£ å‘é€é€šçŸ¥     ï¼ˆè®¢å•ç”Ÿæˆåï¼‰
    â†“
æ­¥éª¤4ï¸âƒ£ ç§¯åˆ†å¥–åŠ±     ï¼ˆæœ€åæ‰§è¡Œï¼‰

å¦‚æœä¸æŒ‰é¡ºåºï¼Œå¯èƒ½å‡ºç°ï¼š
âŒ åº“å­˜æ²¡æ‰£å°±ç”Ÿæˆè®¢å•
âŒ è®¢å•æ²¡ç”Ÿæˆå°±å‘é€šçŸ¥
```

**ä»£ç å®ç°**ï¼š
```java
@Component
public class OrderEventListener {
    
    @Order(1)
    @EventListener
    public void reduceStock(OrderCreateEvent event) {
        System.out.println("æ­¥éª¤1ï¼šæ‰£å‡å•†å“åº“å­˜");
        // åº“å­˜æ‰£å‡é€»è¾‘
    }
    
    @Order(2)
    @EventListener
    public void createOrder(OrderCreateEvent event) {
        System.out.println("æ­¥éª¤2ï¼šç”Ÿæˆè®¢å•è®°å½•");
        // è®¢å•ç”Ÿæˆé€»è¾‘
    }
    
    @Order(3)
    @EventListener
    public void sendNotification(OrderCreateEvent event) {
        System.out.println("æ­¥éª¤3ï¼šå‘é€è®¢å•é€šçŸ¥");
        // é€šçŸ¥å‘é€é€»è¾‘
    }
}
```

---

## 4. â¸ï¸ é˜»å¡å¤„ç†æœºåˆ¶


### 4.1 ä»€ä¹ˆæ˜¯é˜»å¡å¤„ç†


**é€šä¿—è§£é‡Š**ï¼š
```
é˜»å¡å°±åƒæ‰“ç”µè¯ï¼š
- ä½ æ‰“ç»™å®¢æœï¼ˆå‘å¸ƒäº‹ä»¶ï¼‰
- å®¢æœæ¥å¬å¹¶å¤„ç†ï¼ˆç›‘å¬å™¨æ‰§è¡Œï¼‰
- ä½ å¿…é¡»ç­‰å®¢æœè¯´å®Œï¼ˆé˜»å¡ç­‰å¾…ï¼‰
- å®¢æœæŒ‚æ–­åä½ æ‰èƒ½ç»§ç»­ï¼ˆé˜»å¡è§£é™¤ï¼‰

åŒæ­¥äº‹ä»¶å°±æ˜¯è¿™æ ·ï¼šå‘å¸ƒè€…å¿…é¡»ç­‰æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œ
```

### 4.2 é˜»å¡çš„å½±å“èŒƒå›´


**ä¸»çº¿ç¨‹é˜»å¡ç¤ºä¾‹**ï¼š
```java
@RestController
public class UserController {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    @PostMapping("/register")
    public String register(String username) {
        long startTime = System.currentTimeMillis();
        
        // å‘å¸ƒäº‹ä»¶ï¼ˆä¼šé˜»å¡ï¼‰
        eventPublisher.publishEvent(new UserRegisterEvent(this, username));
        
        long endTime = System.currentTimeMillis();
        
        return "æ³¨å†ŒæˆåŠŸï¼Œè€—æ—¶ï¼š" + (endTime - startTime) + "ms";
    }
}

@Component
class SlowListener {
    @EventListener
    public void handleEvent(UserRegisterEvent event) {
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼šå‘é€é‚®ä»¶éœ€è¦2ç§’
        Thread.sleep(2000);
    }
}
```

**æ‰§è¡Œç»“æœ**ï¼š
```
ç”¨æˆ·è¯·æ±‚ â†’ ç­‰å¾…2ç§’ â†’ è¿”å›"æ³¨å†ŒæˆåŠŸï¼Œè€—æ—¶ï¼š2000ms"

å½±å“ï¼š
âŒ ç”¨æˆ·ä½“éªŒå·®ï¼šæ³¨å†Œéœ€è¦ç­‰2ç§’æ‰æœ‰å“åº”
âŒ ç³»ç»Ÿååé‡ä½ï¼šä¸€ä¸ªè¯·æ±‚å ç”¨2ç§’
âŒ å¯èƒ½è¶…æ—¶ï¼šå¦‚æœç›‘å¬å™¨è€—æ—¶å¤ªé•¿
```

### 4.3 é˜»å¡å¤„ç†çš„åº”ç”¨åœºæ™¯


**é€‚åˆåŒæ­¥é˜»å¡çš„åœºæ™¯**ï¼š
```
âœ… å¿…é¡»ç«‹å³çŸ¥é“ç»“æœçš„æ“ä½œ
   ç¤ºä¾‹ï¼šæ”¯ä»˜æˆåŠŸåç«‹å³è¿”å›æ”¯ä»˜ç»“æœ

âœ… ä¾èµ–æ‰§è¡Œé¡ºåºçš„æ“ä½œ
   ç¤ºä¾‹ï¼šå…ˆæ‰£åº“å­˜å†åˆ›å»ºè®¢å•

âœ… éœ€è¦äº‹åŠ¡ä¸€è‡´æ€§çš„æ“ä½œ
   ç¤ºä¾‹ï¼šè®¢å•å’Œåº“å­˜å¿…é¡»åŒæ—¶æˆåŠŸæˆ–å¤±è´¥
```

**ä»£ç ç¤ºä¾‹ï¼šæ”¯ä»˜ç»“æœæ ¡éªŒ**
```java
@Service
public class PaymentService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    @Transactional
    public PaymentResult processPayment(Order order) {
        // 1. æ‰§è¡Œæ”¯ä»˜
        boolean paySuccess = doPayment(order);
        
        // 2. å‘å¸ƒæ”¯ä»˜äº‹ä»¶ï¼ˆåŒæ­¥ï¼Œå¿…é¡»ç­‰å¾…æ‰€æœ‰éªŒè¯å®Œæˆï¼‰
        PaymentEvent event = new PaymentEvent(this, order, paySuccess);
        eventPublisher.publishEvent(event);
        
        // 3. åªæœ‰æ‰€æœ‰ç›‘å¬å™¨éƒ½éªŒè¯é€šè¿‡ï¼Œæ‰è¿”å›æˆåŠŸ
        return new PaymentResult(paySuccess);
    }
}

@Component
class PaymentValidator {
    
    @EventListener
    public void validatePayment(PaymentEvent event) {
        // éªŒè¯æ”¯ä»˜é‡‘é¢
        if (event.getOrder().getAmount() <= 0) {
            throw new IllegalArgumentException("æ”¯ä»˜é‡‘é¢å¿…é¡»å¤§äº0");
        }
    }
    
    @EventListener
    public void checkInventory(PaymentEvent event) {
        // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
        if (!hasEnoughStock(event.getOrder())) {
            throw new IllegalStateException("åº“å­˜ä¸è¶³");
        }
    }
}
```

---

## 5. ğŸ’¥ å¼‚å¸¸ä¼ æ’­è§„åˆ™


### 5.1 å¼‚å¸¸ä¼ æ’­æœºåˆ¶


**æ ¸å¿ƒè§„åˆ™**ï¼š
```
åŒæ­¥äº‹ä»¶ä¸­ï¼Œç›‘å¬å™¨æŠ›å‡ºçš„å¼‚å¸¸ä¼šä¼ æ’­åˆ°äº‹ä»¶å‘å¸ƒè€…

ä¼ æ’­è·¯å¾„ï¼š
ç›‘å¬å™¨æŠ›å¼‚å¸¸ â†’ Springäº‹ä»¶æœºåˆ¶ â†’ å‘å¸ƒäº‹ä»¶çš„æ–¹æ³• â†’ è°ƒç”¨è€…
```

**æµç¨‹å›¾ç¤º**ï¼š
```
Controller.register()
    |
    v
Service.publishEvent() â”€â”€â”€â”€â”€> Listener.handle()
    |                              |
    |                              v
    |                         æŠ›å‡ºå¼‚å¸¸
    |                              |
    |  <â”€â”€â”€â”€â”€â”€å¼‚å¸¸ä¼ æ’­å›æ¥â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    v
æ•è·å¼‚å¸¸/äº‹åŠ¡å›æ»š
```

### 5.2 å¼‚å¸¸ä¼ æ’­ç¤ºä¾‹


**ä»£ç ç¤ºä¾‹**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void registerUser(String username, String email) {
        try {
            System.out.println("å¼€å§‹æ³¨å†Œç”¨æˆ·");
            
            // å‘å¸ƒäº‹ä»¶
            eventPublisher.publishEvent(
                new UserRegisterEvent(this, username, email)
            );
            
            System.out.println("æ³¨å†ŒæˆåŠŸ");
            
        } catch (Exception e) {
            // ç›‘å¬å™¨çš„å¼‚å¸¸ä¼šä¼ æ’­åˆ°è¿™é‡Œ
            System.out.println("æ³¨å†Œå¤±è´¥ï¼š" + e.getMessage());
        }
    }
}

@Component
class ValidationListener {
    
    @EventListener
    public void validateEmail(UserRegisterEvent event) {
        // é‚®ç®±æ ¼å¼éªŒè¯
        if (!event.getEmail().contains("@")) {
            throw new IllegalArgumentException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
        }
    }
}
```

**æ‰§è¡Œç»“æœ**ï¼š
```
è¾“å…¥ï¼šregisterUser("å¼ ä¸‰", "zhangsan")  â† é‚®ç®±æ ¼å¼é”™è¯¯

è¾“å‡ºï¼š
å¼€å§‹æ³¨å†Œç”¨æˆ·
æ³¨å†Œå¤±è´¥ï¼šé‚®ç®±æ ¼å¼ä¸æ­£ç¡®  â† å¼‚å¸¸è¢«æ•è·
```

### 5.3 å¼‚å¸¸å¤„ç†ç­–ç•¥


**ç­–ç•¥ä¸€ï¼šåœ¨å‘å¸ƒè€…å¤„ç»Ÿä¸€å¤„ç†**
```java
@Service
public class OrderService {
    
    @Transactional
    public void createOrder(Order order) {
        try {
            // ä¿å­˜è®¢å•
            orderRepository.save(order);
            
            // å‘å¸ƒäº‹ä»¶
            eventPublisher.publishEvent(new OrderCreateEvent(this, order));
            
        } catch (Exception e) {
            // ç»Ÿä¸€å¼‚å¸¸å¤„ç†
            log.error("è®¢å•åˆ›å»ºå¤±è´¥", e);
            throw new BusinessException("è®¢å•åˆ›å»ºå¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```

**ç­–ç•¥äºŒï¼šåœ¨ç›‘å¬å™¨å†…éƒ¨å¤„ç†**
```java
@Component
class RobustListener {
    
    @EventListener
    public void handleEvent(OrderCreateEvent event) {
        try {
            // ä¸šåŠ¡é€»è¾‘
            sendNotification(event.getOrder());
        } catch (Exception e) {
            // ä¸å‘å¤–æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å½±å“å…¶ä»–ç›‘å¬å™¨
            log.error("é€šçŸ¥å‘é€å¤±è´¥", e);
        }
    }
}
```

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼šå¦‚æœç›‘å¬å™¨çš„å¤±è´¥ä¸åº”è¯¥å½±å“ä¸»æµç¨‹ï¼Œå°±åœ¨ç›‘å¬å™¨å†…éƒ¨æ•è·å¼‚å¸¸

### 5.4 å¤šç›‘å¬å™¨å¼‚å¸¸åœºæ™¯


**é—®é¢˜åœºæ™¯**ï¼š
```
æœ‰3ä¸ªç›‘å¬å™¨ï¼šAã€Bã€C
å¦‚æœBæŠ›å‡ºå¼‚å¸¸ä¼šæ€æ ·ï¼Ÿ

æ‰§è¡Œæµç¨‹ï¼š
Aæ‰§è¡ŒæˆåŠŸ â†’ Bæ‰§è¡Œå¤±è´¥ï¼ˆæŠ›å¼‚å¸¸ï¼‰â†’ Cä¸ä¼šæ‰§è¡Œ â†’ å¼‚å¸¸ä¼ æ’­
```

**ä»£ç æ¼”ç¤º**ï¼š
```java
@Component
class MultiListenerExample {
    
    @Order(1)
    @EventListener
    public void listenerA(UserRegisterEvent event) {
        System.out.println("ç›‘å¬å™¨Aï¼šæ‰§è¡ŒæˆåŠŸ");
    }
    
    @Order(2)
    @EventListener
    public void listenerB(UserRegisterEvent event) {
        System.out.println("ç›‘å¬å™¨Bï¼šå¼€å§‹æ‰§è¡Œ");
        throw new RuntimeException("ç›‘å¬å™¨Bæ‰§è¡Œå¤±è´¥");
    }
    
    @Order(3)
    @EventListener
    public void listenerC(UserRegisterEvent event) {
        System.out.println("ç›‘å¬å™¨Cï¼šè¿™é‡Œä¸ä¼šæ‰§è¡Œ");
    }
}
```

**æ‰§è¡Œç»“æœ**ï¼š
```
ç›‘å¬å™¨Aï¼šæ‰§è¡ŒæˆåŠŸ
ç›‘å¬å™¨Bï¼šå¼€å§‹æ‰§è¡Œ
å¼‚å¸¸ï¼šç›‘å¬å™¨Bæ‰§è¡Œå¤±è´¥

æ³¨æ„ï¼šç›‘å¬å™¨Cæ°¸è¿œä¸ä¼šæ‰§è¡Œï¼
```

---

## 6. ğŸ”— äº‹åŠ¡ä¸€è‡´æ€§ä¿éšœ


### 6.1 äº‹åŠ¡ä¼ æ’­ç‰¹æ€§


**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
åŒæ­¥äº‹ä»¶ç›‘å¬å™¨ä¼šåŠ å…¥å‘å¸ƒè€…çš„äº‹åŠ¡ä¸­
è¿™æ„å‘³ç€ï¼š
âœ… ç›‘å¬å™¨å’Œå‘å¸ƒè€…åœ¨åŒä¸€ä¸ªäº‹åŠ¡
âœ… ä»»ä½•ä¸€æ–¹å¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»š
âœ… ä¿è¯æ•°æ®ä¸€è‡´æ€§
```

**äº‹åŠ¡ä¼ æ’­å›¾ç¤º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      @Transactional         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   å‘å¸ƒè€…æ–¹æ³•         â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚  ä¿å­˜æ•°æ®    â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚  å‘å¸ƒäº‹ä»¶    â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚        â†“            â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚  ç›‘å¬å™¨A     â”‚â”€â”€â”€â”â”‚   â”‚ â† åŒä¸€ä¸ªäº‹åŠ¡
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚   â”‚
â”‚   â”‚  â”‚  ç›‘å¬å™¨B     â”‚â”€â”€â”€â”˜â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â”‚  ä»»ä½•åœ°æ–¹å‡ºé”™éƒ½ä¼šå›æ»šæ•´ä¸ªäº‹åŠ¡  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 äº‹åŠ¡ä¸€è‡´æ€§ç¤ºä¾‹


**åœºæ™¯ï¼šè®¢å•åˆ›å»ºä¸åº“å­˜æ‰£å‡**
```java
@Service
public class OrderService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Transactional  // å¼€å¯äº‹åŠ¡
    public void createOrder(Order order) {
        // 1. ä¿å­˜è®¢å•
        orderRepository.save(order);
        System.out.println("è®¢å•å·²ä¿å­˜");
        
        // 2. å‘å¸ƒäº‹ä»¶ï¼ˆç›‘å¬å™¨ä¼šåŠ å…¥å½“å‰äº‹åŠ¡ï¼‰
        eventPublisher.publishEvent(new OrderCreateEvent(this, order));
        
        System.out.println("è®¢å•åˆ›å»ºå®Œæˆ");
    }
}

@Component
class InventoryListener {
    
    @Autowired
    private InventoryService inventoryService;
    
    @EventListener
    @Transactional(propagation = Propagation.REQUIRED)
    public void reduceInventory(OrderCreateEvent event) {
        // æ‰£å‡åº“å­˜
        inventoryService.reduce(event.getOrder().getProductId());
        System.out.println("åº“å­˜å·²æ‰£å‡");
        
        // å¦‚æœåº“å­˜ä¸è¶³ï¼ŒæŠ›å‡ºå¼‚å¸¸
        if (inventoryService.getStock() < 0) {
            throw new IllegalStateException("åº“å­˜ä¸è¶³");
        }
    }
}
```

**æ‰§è¡Œæƒ…å†µåˆ†æ**ï¼š

**æƒ…å†µ1ï¼šæ­£å¸¸æ‰§è¡Œ**
```
è®¢å•å·²ä¿å­˜       â† äº‹åŠ¡ä¸­
åº“å­˜å·²æ‰£å‡       â† åŒä¸€äº‹åŠ¡ä¸­
è®¢å•åˆ›å»ºå®Œæˆ     â† äº‹åŠ¡æäº¤

ç»“æœï¼šâœ… è®¢å•å’Œåº“å­˜éƒ½æˆåŠŸæ›´æ–°
```

**æƒ…å†µ2ï¼šåº“å­˜ä¸è¶³**
```
è®¢å•å·²ä¿å­˜       â† äº‹åŠ¡ä¸­
åº“å­˜å·²æ‰£å‡       â† åŒä¸€äº‹åŠ¡ä¸­
å¼‚å¸¸ï¼šåº“å­˜ä¸è¶³   â† äº‹åŠ¡å›æ»š

ç»“æœï¼šâŒ è®¢å•ä¿å­˜è¢«å›æ»šï¼Œæ•°æ®åº“ä¸­æ²¡æœ‰è¿™ä¸ªè®¢å•
```

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šç›‘å¬å™¨çš„å¤±è´¥ä¼šå¯¼è‡´å‘å¸ƒè€…çš„æ“ä½œä¹Ÿå›æ»šï¼Œä¿è¯äº†æ•°æ®ä¸€è‡´æ€§

### 6.3 äº‹åŠ¡ä¼ æ’­é…ç½®


**ä¸åŒä¼ æ’­çº§åˆ«çš„å½±å“**ï¼š

```java
// 1. REQUIREDï¼ˆé»˜è®¤ï¼‰ï¼šåŠ å…¥å½“å‰äº‹åŠ¡
@EventListener
@Transactional(propagation = Propagation.REQUIRED)
public void listener1(Event event) {
    // ä¸å‘å¸ƒè€…åœ¨åŒä¸€äº‹åŠ¡ï¼Œå¤±è´¥ä¼šä¸€èµ·å›æ»š
}

// 2. REQUIRES_NEWï¼šåˆ›å»ºæ–°äº‹åŠ¡
@EventListener
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void listener2(Event event) {
    // ç‹¬ç«‹äº‹åŠ¡ï¼Œå¤±è´¥ä¸å½±å“å‘å¸ƒè€…
    // ä½†æ˜¯æ˜¯åŒæ­¥æ‰§è¡Œï¼Œä»ç„¶ä¼šé˜»å¡
}

// 3. NOT_SUPPORTEDï¼šä¸æ”¯æŒäº‹åŠ¡
@EventListener
@Transactional(propagation = Propagation.NOT_SUPPORTED)
public void listener3(Event event) {
    // æš‚åœå½“å‰äº‹åŠ¡ï¼Œä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ
}
```

**å¯¹æ¯”è¡¨æ ¼**ï¼š

| ä¼ æ’­çº§åˆ« | **æ˜¯å¦åŒä¸€äº‹åŠ¡** | **ç›‘å¬å™¨å¤±è´¥å½±å“** | **é€‚ç”¨åœºæ™¯** |
|---------|-----------------|-------------------|-------------|
| `REQUIRED` | `æ˜¯` | `å‘å¸ƒè€…ä¹Ÿå›æ»š` | `éœ€è¦å¼ºä¸€è‡´æ€§çš„æ“ä½œ` |
| `REQUIRES_NEW` | `å¦ï¼Œæ–°äº‹åŠ¡` | `å‘å¸ƒè€…ä¸å›æ»š` | `ç‹¬ç«‹çš„æ—¥å¿—è®°å½•` |
| `NOT_SUPPORTED` | `å¦ï¼Œæ— äº‹åŠ¡` | `å‘å¸ƒè€…ä¸å›æ»š` | `æŸ¥è¯¢ç»Ÿè®¡æ“ä½œ` |

---

## 7. âš¡ æ€§èƒ½å½±å“åˆ†æ


### 7.1 æ€§èƒ½ç“¶é¢ˆåˆ†æ


**æ€§èƒ½æŸè€—æ¥æº**ï¼š
```
1ï¸âƒ£ é˜»å¡ç­‰å¾…æ—¶é—´
   - ç›‘å¬å™¨æ‰§è¡Œæ—¶ï¼Œå‘å¸ƒè€…å¿…é¡»ç­‰å¾…
   - ç›‘å¬å™¨è¶Šå¤šï¼Œç­‰å¾…æ—¶é—´è¶Šé•¿

2ï¸âƒ£ ä¸²è¡Œæ‰§è¡Œå¼€é”€
   - ç›‘å¬å™¨æŒ‰é¡ºåºæ‰§è¡Œ
   - ä¸èƒ½å¹¶è¡Œåˆ©ç”¨å¤šæ ¸CPU

3ï¸âƒ£ äº‹åŠ¡å¼€é”€
   - æ‰€æœ‰æ“ä½œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­
   - äº‹åŠ¡æ—¶é—´è¶Šé•¿ï¼Œé”ç­‰å¾…è¶Šå¤š
```

**æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹**ï¼š
```
åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œéœ€è¦æ‰§è¡Œ3ä¸ªæ“ä½œ

åŒæ­¥æ–¹å¼ï¼š
æ³¨å†Œï¼ˆ50msï¼‰â†’ å‘é‚®ä»¶ï¼ˆ1000msï¼‰â†’ è®°æ—¥å¿—ï¼ˆ200msï¼‰â†’ ç»Ÿè®¡ï¼ˆ100msï¼‰
æ€»è€—æ—¶ = 1350ms

å¼‚æ­¥æ–¹å¼ï¼š
æ³¨å†Œï¼ˆ50msï¼‰â†’ å‘å¸ƒäº‹ä»¶ â†’ ç«‹å³è¿”å›
            â””â†’ å¼‚æ­¥æ‰§è¡Œï¼šå‘é‚®ä»¶ã€æ—¥å¿—ã€ç»Ÿè®¡ï¼ˆå¹¶è¡Œï¼‰
æ€»è€—æ—¶ = 50msï¼ˆç”¨æˆ·æ„ŸçŸ¥ï¼‰
```

### 7.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**ç­–ç•¥ä¸€ï¼šåŒºåˆ†æ ¸å¿ƒå’Œéæ ¸å¿ƒæ“ä½œ**
```java
@Service
public class OrderService {
    
    @Transactional
    public void createOrder(Order order) {
        // æ ¸å¿ƒæ“ä½œï¼šåŒæ­¥æ‰§è¡Œ
        orderRepository.save(order);
        
        // æ ¸å¿ƒäº‹ä»¶ï¼šåŒæ­¥å¤„ç†ï¼ˆåº“å­˜æ‰£å‡ï¼‰
        eventPublisher.publishEvent(new CoreOrderEvent(order));
        
        // éæ ¸å¿ƒäº‹ä»¶ï¼šå¼‚æ­¥å¤„ç†ï¼ˆå‘é€é€šçŸ¥ï¼‰
        eventPublisher.publishEvent(new NotificationEvent(order));
    }
}

@Component
class CoreEventListener {
    @EventListener  // åŒæ­¥
    public void handleCore(CoreOrderEvent event) {
        inventoryService.reduce(event.getOrder());
    }
}

@Component
class AsyncEventListener {
    @EventListener
    @Async  // å¼‚æ­¥
    public void handleAsync(NotificationEvent event) {
        notificationService.send(event.getOrder());
    }
}
```

**ç­–ç•¥äºŒï¼šå‡å°‘ç›‘å¬å™¨è€—æ—¶**
```java
@Component
class OptimizedListener {
    
    @EventListener
    public void handleEvent(OrderCreateEvent event) {
        // âŒ é¿å…ï¼šè€—æ—¶æ“ä½œ
        // Thread.sleep(2000);
        // sendEmailDirectly(event);
        
        // âœ… æ¨èï¼šå¿«é€Ÿå¤„ç†ï¼Œè€—æ—¶æ“ä½œå¼‚æ­¥
        CompletableFuture.runAsync(() -> {
            sendEmailDirectly(event);
        });
        
        // æˆ–è€…æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—
        messageQueue.send(event);
    }
}
```

**ç­–ç•¥ä¸‰ï¼šæ‰¹é‡å¤„ç†**
```java
@Component
class BatchListener {
    
    private List<Event> eventBuffer = new ArrayList<>();
    
    @EventListener
    public void collectEvent(UserRegisterEvent event) {
        // æ”¶é›†äº‹ä»¶ï¼Œè¾¾åˆ°é˜ˆå€¼åæ‰¹é‡å¤„ç†
        eventBuffer.add(event);
        
        if (eventBuffer.size() >= 100) {
            batchProcess(eventBuffer);
            eventBuffer.clear();
        }
    }
}
```

### 7.3 æ€§èƒ½ç›‘æ§æŒ‡æ ‡


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ“Š äº‹ä»¶å¤„ç†è€—æ—¶
   - å•ä¸ªç›‘å¬å™¨æ‰§è¡Œæ—¶é—´
   - æ•´ä½“äº‹ä»¶å¤„ç†æ—¶é—´
   - 95/99åˆ†ä½è€—æ—¶

ğŸ“Š é˜»å¡æ—¶é•¿ç»Ÿè®¡
   - å‘å¸ƒè€…ç­‰å¾…æ—¶é—´
   - äº‹åŠ¡æŒæœ‰æ—¶é—´

ğŸ“Š å¤±è´¥ç‡
   - ç›‘å¬å™¨æ‰§è¡Œå¤±è´¥æ¬¡æ•°
   - å¼‚å¸¸ç±»å‹åˆ†å¸ƒ
```

**ç›‘æ§ä»£ç ç¤ºä¾‹**ï¼š
```java
@Component
@Aspect
public class EventPerformanceMonitor {
    
    @Around("@annotation(org.springframework.context.event.EventListener)")
    public Object monitorEvent(ProceedingJoinPoint joinPoint) throws Throwable {
        long startTime = System.currentTimeMillis();
        String listenerName = joinPoint.getSignature().getName();
        
        try {
            Object result = joinPoint.proceed();
            long duration = System.currentTimeMillis() - startTime;
            
            log.info("ç›‘å¬å™¨ {} æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶ï¼š{}ms", listenerName, duration);
            
            // è€—æ—¶è¶…è¿‡1ç§’å‘Šè­¦
            if (duration > 1000) {
                log.warn("ç›‘å¬å™¨ {} æ‰§è¡Œç¼“æ…¢ï¼š{}ms", listenerName, duration);
            }
            
            return result;
            
        } catch (Exception e) {
            log.error("ç›‘å¬å™¨ {} æ‰§è¡Œå¤±è´¥", listenerName, e);
            throw e;
        }
    }
}
```

---

## 8. ğŸ”§ é”™è¯¯æ¢å¤ç­–ç•¥


### 8.1 å¸¸è§é”™è¯¯åœºæ™¯


**é”™è¯¯åœºæ™¯åˆ†ç±»**ï¼š
```
1ï¸âƒ£ ä¸šåŠ¡å¼‚å¸¸
   ç¤ºä¾‹ï¼šåº“å­˜ä¸è¶³ã€ä½™é¢ä¸å¤Ÿ
   å¤„ç†ï¼šä¸šåŠ¡å›æ»šï¼Œè¿”å›é”™è¯¯æç¤º

2ï¸âƒ£ ç³»ç»Ÿå¼‚å¸¸
   ç¤ºä¾‹ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ã€ç½‘ç»œè¶…æ—¶
   å¤„ç†ï¼šé‡è¯•æˆ–é™çº§

3ï¸âƒ£ æ•°æ®å¼‚å¸¸
   ç¤ºä¾‹ï¼šç©ºæŒ‡é’ˆã€æ•°æ®æ ¼å¼é”™è¯¯
   å¤„ç†ï¼šæ•°æ®æ ¡éªŒï¼Œå¼‚å¸¸æ•è·
```

### 8.2 é‡è¯•æœºåˆ¶


**Spring Retryé›†æˆ**ï¼š
```java
@Component
class RetryableListener {
    
    @EventListener
    @Retryable(
        value = {SQLException.class, TimeoutException.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 1000)
    )
    public void handleWithRetry(OrderCreateEvent event) {
        // å¯èƒ½å¤±è´¥çš„æ“ä½œ
        externalService.call(event.getOrder());
    }
    
    @Recover
    public void recover(Exception e, OrderCreateEvent event) {
        // é‡è¯•3æ¬¡åä»å¤±è´¥ï¼Œæ‰§è¡Œæ¢å¤é€»è¾‘
        log.error("äº‹ä»¶å¤„ç†æœ€ç»ˆå¤±è´¥", e);
        alertService.sendAlert("è®¢å•å¤„ç†å¤±è´¥ï¼š" + event.getOrder().getId());
    }
}
```

**æ‰‹åŠ¨é‡è¯•å®ç°**ï¼š
```java
@Component
class ManualRetryListener {
    
    @EventListener
    public void handleWithManualRetry(OrderCreateEvent event) {
        int maxRetries = 3;
        int attempt = 0;
        
        while (attempt < maxRetries) {
            try {
                // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                processOrder(event.getOrder());
                return; // æˆåŠŸåˆ™è¿”å›
                
            } catch (Exception e) {
                attempt++;
                log.warn("é‡è¯• {}/{}: {}", attempt, maxRetries, e.getMessage());
                
                if (attempt >= maxRetries) {
                    // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°
                    log.error("å¤„ç†å¤±è´¥ï¼Œå·²é‡è¯•" + maxRetries + "æ¬¡", e);
                    throw e;
                }
                
                // ç­‰å¾…åé‡è¯•
                Thread.sleep(1000 * attempt);
            }
        }
    }
}
```

### 8.3 é™çº§ç­–ç•¥


**é™çº§å¤„ç†ç¤ºä¾‹**ï¼š
```java
@Component
class DegradableListener {
    
    @Autowired
    private PrimaryService primaryService;
    
    @Autowired
    private BackupService backupService;
    
    @EventListener
    public void handleWithDegradation(OrderCreateEvent event) {
        try {
            // å°è¯•ä¸»è¦æœåŠ¡
            primaryService.process(event.getOrder());
            
        } catch (Exception e) {
            log.warn("ä¸»æœåŠ¡å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æœåŠ¡", e);
            
            try {
                // é™çº§åˆ°å¤‡ç”¨æœåŠ¡
                backupService.process(event.getOrder());
                
            } catch (Exception ex) {
                log.error("å¤‡ç”¨æœåŠ¡ä¹Ÿå¤±è´¥", ex);
                // æœ€ç»ˆé™çº§ï¼šä»…è®°å½•å¤±è´¥
                saveFailedEvent(event);
            }
        }
    }
    
    private void saveFailedEvent(OrderCreateEvent event) {
        // ä¿å­˜å¤±è´¥äº‹ä»¶ï¼Œåç»­äººå·¥å¤„ç†
        FailedEvent failedEvent = new FailedEvent(event);
        failedEventRepository.save(failedEvent);
    }
}
```

### 8.4 è¡¥å¿æœºåˆ¶


**è¡¥å¿äº‹åŠ¡ç¤ºä¾‹**ï¼š
```java
@Service
public class CompensationService {
    
    @Transactional
    public void createOrderWithCompensation(Order order) {
        try {
            // 1. ä¿å­˜è®¢å•
            orderRepository.save(order);
            
            // 2. å‘å¸ƒäº‹ä»¶
            eventPublisher.publishEvent(new OrderCreateEvent(this, order));
            
        } catch (Exception e) {
            // 3. å‘ç”Ÿå¼‚å¸¸ï¼Œæ‰§è¡Œè¡¥å¿
            log.error("è®¢å•åˆ›å»ºå¤±è´¥ï¼Œæ‰§è¡Œè¡¥å¿", e);
            compensate(order);
            throw e;
        }
    }
    
    private void compensate(Order order) {
        // è¡¥å¿é€»è¾‘
        if (order.getId() != null) {
            // å¦‚æœè®¢å•å·²ä¿å­˜ï¼Œåˆ é™¤è®¢å•
            orderRepository.deleteById(order.getId());
        }
        
        // å‘å¸ƒè¡¥å¿äº‹ä»¶
        eventPublisher.publishEvent(new OrderCompensationEvent(this, order));
    }
}

@Component
class CompensationListener {
    
    @EventListener
    public void handleCompensation(OrderCompensationEvent event) {
        // æ‰§è¡Œè¡¥å¿æ“ä½œ
        // ä¾‹å¦‚ï¼šæ¢å¤åº“å­˜ã€é€€è¿˜ä¼˜æƒ åˆ¸ç­‰
        inventoryService.restore(event.getOrder().getProductId());
    }
}
```

### 8.5 é”™è¯¯æ¢å¤æœ€ä½³å®è·µ


**å®è·µæ€»ç»“**ï¼š

> ğŸ“Œ **é”™è¯¯å¤„ç†åŸåˆ™**
> 1. **å¿«é€Ÿå¤±è´¥**ï¼šå‘ç°é—®é¢˜ç«‹å³æŠ›å¼‚å¸¸ï¼Œä¸è¦éšè—
> 2. **æ˜ç¡®è´£ä»»**ï¼šåŒºåˆ†ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯
> 3. **åŠæ—¶å‘Šè­¦**ï¼šå…³é”®é”™è¯¯è¦å‘é€å‘Šè­¦é€šçŸ¥
> 4. **å¯è¿½æº¯æ€§**ï¼šè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥

**å®Œæ•´é”™è¯¯å¤„ç†ç¤ºä¾‹**ï¼š
```java
@Component
class RobustEventListener {
    
    @EventListener
    public void robustHandle(OrderCreateEvent event) {
        String orderId = event.getOrder().getId();
        
        try {
            // 1. å‰ç½®æ ¡éªŒ
            validateEvent(event);
            
            // 2. æ‰§è¡Œä¸šåŠ¡
            processOrder(event.getOrder());
            
            // 3. è®°å½•æˆåŠŸæ—¥å¿—
            log.info("è®¢å•å¤„ç†æˆåŠŸï¼š{}", orderId);
            
        } catch (BusinessException e) {
            // ä¸šåŠ¡å¼‚å¸¸ï¼šä¸é‡è¯•ï¼Œè®°å½•å¹¶è¿”å›
            log.warn("ä¸šåŠ¡å¼‚å¸¸ï¼š{} - {}", orderId, e.getMessage());
            throw e;
            
        } catch (SystemException e) {
            // ç³»ç»Ÿå¼‚å¸¸ï¼šå¯é‡è¯•
            log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š{}", orderId, e);
            retryWithBackoff(event);
            
        } catch (Exception e) {
            // æœªçŸ¥å¼‚å¸¸ï¼šå‘Šè­¦
            log.error("æœªçŸ¥å¼‚å¸¸ï¼š{}", orderId, e);
            alertService.sendCriticalAlert("è®¢å•å¤„ç†å¼‚å¸¸", e);
            throw e;
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åŒæ­¥äº‹ä»¶æœ¬è´¨ï¼šå‘å¸ƒè€…ç­‰å¾…æ‰€æœ‰ç›‘å¬å™¨æ‰§è¡Œå®Œæ¯•
ğŸ”¸ é¡ºåºæ‰§è¡Œï¼šç›‘å¬å™¨æŒ‰@Orderé¡ºåºä¾æ¬¡æ‰§è¡Œ
ğŸ”¸ é˜»å¡ç‰¹æ€§ï¼šä¸»çº¿ç¨‹è¢«é˜»å¡ï¼Œå½±å“å“åº”æ—¶é—´
ğŸ”¸ å¼‚å¸¸ä¼ æ’­ï¼šç›‘å¬å™¨å¼‚å¸¸ä¼šä¼ æ’­åˆ°å‘å¸ƒè€…
ğŸ”¸ äº‹åŠ¡å…±äº«ï¼šç›‘å¬å™¨åŠ å…¥å‘å¸ƒè€…çš„äº‹åŠ¡
ğŸ”¸ æ€§èƒ½æƒè¡¡ï¼šå¯é æ€§é«˜ä½†æ€§èƒ½å¼€é”€å¤§
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä½•æ—¶ä½¿ç”¨åŒæ­¥äº‹ä»¶**
```
âœ… é€‚ç”¨åœºæ™¯ï¼š
- å¿…é¡»ç«‹å³çŸ¥é“å¤„ç†ç»“æœ
- éœ€è¦ä¸¥æ ¼çš„æ‰§è¡Œé¡ºåº
- è¦æ±‚å¼ºäº‹åŠ¡ä¸€è‡´æ€§
- ç›‘å¬å™¨æ‰§è¡Œæ—¶é—´çŸ­

âŒ ä¸é€‚ç”¨åœºæ™¯ï¼š
- ç›‘å¬å™¨è€—æ—¶å¾ˆé•¿ï¼ˆ>1ç§’ï¼‰
- ä¸éœ€è¦ç«‹å³è¿”å›ç»“æœ
- å¯ä»¥å®¹å¿æœ€ç»ˆä¸€è‡´æ€§
- éœ€è¦é«˜å¹¶å‘å¤„ç†
```

**ğŸ”¹ äº‹åŠ¡ä¸€è‡´æ€§ç†è§£**
```
åŒæ­¥äº‹ä»¶çš„äº‹åŠ¡ç‰¹æ€§ï¼š
å‘å¸ƒè€…å¼€å¯äº‹åŠ¡ â†’ ç›‘å¬å™¨åŠ å…¥äº‹åŠ¡ â†’ ä¸€èµ·æäº¤æˆ–å›æ»š

å¥½å¤„ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
ä»£ä»·ï¼šäº‹åŠ¡æ—¶é—´é•¿ï¼Œå¯èƒ½é€ æˆé”ç­‰å¾…
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–æ€è·¯**
```
1. å‡å°‘ç›‘å¬å™¨æ•°é‡
2. ç¼©çŸ­ç›‘å¬å™¨æ‰§è¡Œæ—¶é—´
3. éæ ¸å¿ƒæ“ä½œæ”¹ä¸ºå¼‚æ­¥
4. ä½¿ç”¨æ‰¹é‡å¤„ç†
5. ç›‘æ§å’Œå‘Šè­¦
```

### 9.3 å®æˆ˜åº”ç”¨æŒ‡å¯¼


**åœºæ™¯ä¸€ï¼šè®¢å•åˆ›å»º**
```java
// æ ¸å¿ƒæ“ä½œç”¨åŒæ­¥ä¿è¯ä¸€è‡´æ€§
@Transactional
public void createOrder(Order order) {
    orderRepository.save(order);
    
    // åŒæ­¥ï¼šåº“å­˜æ‰£å‡ï¼ˆå¿…é¡»æˆåŠŸï¼‰
    eventPublisher.publishEvent(new InventoryEvent(order));
    
    // å¼‚æ­¥ï¼šå‘é€é€šçŸ¥ï¼ˆä¸å½±å“è®¢å•ï¼‰
    asyncEventPublisher.publishEvent(new NotificationEvent(order));
}
```

**åœºæ™¯äºŒï¼šæ”¯ä»˜å¤„ç†**
```java
// åŒæ­¥éªŒè¯ï¼Œä¿è¯æ”¯ä»˜å®‰å…¨
@Transactional
public PaymentResult pay(PaymentRequest request) {
    // åŒæ­¥äº‹ä»¶ï¼šé£æ§æ£€æŸ¥ã€ä½™é¢éªŒè¯
    eventPublisher.publishEvent(new PaymentValidationEvent(request));
    
    // æ‰§è¡Œæ”¯ä»˜
    return processPayment(request);
}
```

**åœºæ™¯ä¸‰ï¼šæ•°æ®å¯¼å…¥**
```java
// å¤§æ‰¹é‡æ“ä½œåˆ†æ‰¹å¤„ç†
public void importData(List<Data> dataList) {
    // åˆ†æ‰¹å¤„ç†ï¼Œæ¯æ‰¹100æ¡
    Lists.partition(dataList, 100).forEach(batch -> {
        eventPublisher.publishEvent(new BatchImportEvent(batch));
    });
}
```

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


| é—®é¢˜ | **åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|------|---------|-------------|
| **å“åº”æ…¢** | `ç›‘å¬å™¨è€—æ—¶é•¿` | `æ”¹ç”¨å¼‚æ­¥äº‹ä»¶æˆ–ä¼˜åŒ–ç›‘å¬å™¨` |
| **äº‹åŠ¡å›æ»š** | `ç›‘å¬å™¨æŠ›å¼‚å¸¸` | `åœ¨ç›‘å¬å™¨å†…éƒ¨æ•è·å¼‚å¸¸` |
| **æ‰§è¡Œé¡ºåºé”™è¯¯** | `æœªæŒ‡å®š@Order` | `ä½¿ç”¨@Orderæ˜ç¡®é¡ºåº` |
| **æ•°æ®ä¸ä¸€è‡´** | `äº‹åŠ¡é…ç½®é”™è¯¯` | `æ£€æŸ¥äº‹åŠ¡ä¼ æ’­çº§åˆ«` |
| **æ­»é”** | `äº‹åŠ¡æ—¶é—´è¿‡é•¿` | `ç¼©çŸ­äº‹åŠ¡èŒƒå›´æˆ–æ”¹å¼‚æ­¥` |

### 9.5 æœ€ä½³å®è·µæ¸…å•


**âœ… å¼€å‘è§„èŒƒ**
```
â–¡ ç›‘å¬å™¨æ‰§è¡Œæ—¶é—´æ§åˆ¶åœ¨100msä»¥å†…
â–¡ æ˜ç¡®æŒ‡å®šç›‘å¬å™¨æ‰§è¡Œé¡ºåº
â–¡ åˆç†é…ç½®äº‹åŠ¡ä¼ æ’­çº§åˆ«
â–¡ ç›‘å¬å™¨è¦æœ‰å¼‚å¸¸å¤„ç†
â–¡ æ·»åŠ æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—
â–¡ å…³é”®æ“ä½œè¦æœ‰é™çº§æ–¹æ¡ˆ
```

**ğŸ”§ é…ç½®å»ºè®®**
```java
// application.yml
spring:
  task:
    execution:
      pool:
        core-size: 8
        max-size: 20
        queue-capacity: 100
  
  # äº‹ä»¶å‘å¸ƒå¤±è´¥åçš„é‡è¯•æ¬¡æ•°
  event:
    retry:
      max-attempts: 3
      backoff: 1000
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åŒæ­¥äº‹ä»¶ç­‰å¾…æ…¢ï¼Œæ ¸å¿ƒä¸šåŠ¡æ‰ä½¿ç”¨
- å¼‚å¸¸ä¼ æ’­è¦å°å¿ƒï¼Œç›‘å¬å™¨å†…è¦å…œåº•
- äº‹åŠ¡ä¸€è‡´æ˜¯ä¼˜åŠ¿ï¼Œæ€§èƒ½å¼€é”€è¦æƒè¡¡
- ç›‘æ§å‘Šè­¦ä¸èƒ½å°‘ï¼Œé™çº§è¡¥å¿è¦å‡†å¤‡