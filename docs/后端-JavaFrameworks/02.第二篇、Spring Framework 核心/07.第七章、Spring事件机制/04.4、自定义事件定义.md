---
title: 4ã€è‡ªå®šä¹‰äº‹ä»¶å®šä¹‰
---
## ğŸ“š ç›®å½•

1. [è‡ªå®šä¹‰äº‹ä»¶åŸºç¡€æ¦‚å¿µ](#1-è‡ªå®šä¹‰äº‹ä»¶åŸºç¡€æ¦‚å¿µ)
2. [ç»§æ‰¿ApplicationEvent](#2-ç»§æ‰¿ApplicationEvent)
3. [äº‹ä»¶æ•°æ®å°è£…](#3-äº‹ä»¶æ•°æ®å°è£…)
4. [äº‹ä»¶ç±»å‹æ ‡è¯†](#4-äº‹ä»¶ç±»å‹æ ‡è¯†)
5. [äº‹ä»¶å…ƒæ•°æ®è®¾è®¡](#5-äº‹ä»¶å…ƒæ•°æ®è®¾è®¡)
6. [åºåˆ—åŒ–æ”¯æŒ](#6-åºåˆ—åŒ–æ”¯æŒ)
7. [äº‹ä»¶ç‰ˆæœ¬æ§åˆ¶](#7-äº‹ä»¶ç‰ˆæœ¬æ§åˆ¶)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è‡ªå®šä¹‰äº‹ä»¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Springäº‹ä»¶æœºåˆ¶


**é€šä¿—ç†è§£**ï¼šæƒ³è±¡ä¸€ä¸ªç­çº§ç¾¤èŠï¼Œè€å¸ˆå‘å¸ƒé€šçŸ¥ï¼ˆå‘å¸ƒäº‹ä»¶ï¼‰ï¼Œæ‰€æœ‰åŒå­¦éƒ½èƒ½æ”¶åˆ°ï¼ˆç›‘å¬äº‹ä»¶ï¼‰ï¼Œéœ€è¦å›åº”çš„åŒå­¦å°±å›å¤ï¼ˆå¤„ç†äº‹ä»¶ï¼‰ã€‚Springäº‹ä»¶æœºåˆ¶å°±æ˜¯è¿™æ ·ä¸€ä¸ª"æ¶ˆæ¯å¹¿æ’­ç³»ç»Ÿ"ã€‚

```
ğŸ­ äº‹ä»¶æœºåˆ¶çš„è§’è‰²ï¼š

å‘å¸ƒè€…ï¼ˆPublisherï¼‰         äº‹ä»¶ï¼ˆEventï¼‰           ç›‘å¬è€…ï¼ˆListenerï¼‰
    è€å¸ˆ         â”€â”€â”€â”€â”€â”€â”€â”€>    é€šçŸ¥æ¶ˆæ¯    â”€â”€â”€â”€â”€â”€â”€â”€>    å­¦ç”Ÿä»¬
    å•†å“æœåŠ¡     â”€â”€â”€â”€â”€â”€â”€â”€>    ä¸‹å•äº‹ä»¶    â”€â”€â”€â”€â”€â”€â”€â”€>    åº“å­˜æœåŠ¡ã€ç‰©æµæœåŠ¡
    ç”¨æˆ·æ¨¡å—     â”€â”€â”€â”€â”€â”€â”€â”€>    æ³¨å†Œäº‹ä»¶    â”€â”€â”€â”€â”€â”€â”€â”€>    é‚®ä»¶æœåŠ¡ã€ç§¯åˆ†æœåŠ¡
```

**ğŸ”‘ æ ¸å¿ƒä¼˜åŠ¿**ï¼š
```
è§£è€¦åˆï¼š
â€¢ å‘å¸ƒè€…ä¸éœ€è¦çŸ¥é“æœ‰è°åœ¨ç›‘å¬
â€¢ ç›‘å¬è€…å¯ä»¥éšæ—¶å¢åŠ æˆ–å‡å°‘
â€¢ å„æ¨¡å—ç‹¬ç«‹å¼€å‘å’Œç»´æŠ¤

å¼‚æ­¥å¤„ç†ï¼š
â€¢ ä¸»æµç¨‹ä¸è¢«é˜»å¡
â€¢ æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦
â€¢ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

æ‰©å±•æ€§ï¼š
â€¢ æ–°å¢åŠŸèƒ½åªéœ€æ·»åŠ ç›‘å¬å™¨
â€¢ ä¸ä¿®æ”¹åŸæœ‰ä»£ç 
â€¢ ç¬¦åˆå¼€é—­åŸåˆ™
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰äº‹ä»¶


**å®é™…åœºæ™¯å¯¹æ¯”**ï¼š

```
âŒ æ²¡æœ‰äº‹ä»¶æœºåˆ¶çš„ä»£ç ï¼š
ç”¨æˆ·æ³¨å†Œ() {
    ä¿å­˜ç”¨æˆ·ä¿¡æ¯();
    å‘é€æ¬¢è¿é‚®ä»¶();        // ç´§è€¦åˆ
    èµ é€æ–°äººç§¯åˆ†();        // ç´§è€¦åˆ
    åŒæ­¥åˆ°CRMç³»ç»Ÿ();       // ç´§è€¦åˆ
    æ¨é€åˆ°å¤§æ•°æ®å¹³å°();     // ç´§è€¦åˆ
    // æ¯æ¬¡æ–°å¢åŠŸèƒ½éƒ½è¦æ”¹è¿™é‡Œ...
}

âœ… ä½¿ç”¨äº‹ä»¶æœºåˆ¶çš„ä»£ç ï¼š
ç”¨æˆ·æ³¨å†Œ() {
    ä¿å­˜ç”¨æˆ·ä¿¡æ¯();
    å‘å¸ƒç”¨æˆ·æ³¨å†Œäº‹ä»¶();    // è§£è€¦
    // å…¶ä»–åŠŸèƒ½é€šè¿‡ç›‘å¬å™¨è‡ªåŠ¨æ‰§è¡Œ
}

ç›‘å¬å™¨ä»¬è‡ªåŠ¨å·¥ä½œï¼š
- é‚®ä»¶ç›‘å¬å™¨ï¼šæ”¶åˆ°äº‹ä»¶ â†’ å‘é€æ¬¢è¿é‚®ä»¶
- ç§¯åˆ†ç›‘å¬å™¨ï¼šæ”¶åˆ°äº‹ä»¶ â†’ èµ é€æ–°äººç§¯åˆ†  
- CRMç›‘å¬å™¨ï¼šæ”¶åˆ°äº‹ä»¶ â†’ åŒæ­¥åˆ°CRM
- å¤§æ•°æ®ç›‘å¬å™¨ï¼šæ”¶åˆ°äº‹ä»¶ â†’ æ¨é€æ•°æ®
```

**ğŸ’¡ è‡ªå®šä¹‰äº‹ä»¶çš„ä»·å€¼**ï¼š
```
ä¸šåŠ¡è¡¨è¾¾ï¼š
â€¢ ä½¿ç”¨ä¸šåŠ¡æœ¯è¯­å®šä¹‰äº‹ä»¶
â€¢ ä»£ç æ›´æ˜“è¯»æ˜“ç»´æŠ¤
â€¢ å›¢é˜Ÿæ²Ÿé€šæ›´æ¸…æ™°

æ•°æ®ä¼ é€’ï¼š
â€¢ å°è£…ä¸šåŠ¡ç›¸å…³æ•°æ®
â€¢ åªä¼ é€’å¿…è¦ä¿¡æ¯
â€¢ ä¿æŠ¤æ•æ„Ÿæ•°æ®

ç±»å‹å®‰å…¨ï¼š
â€¢ ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥
â€¢ é¿å…è¿è¡Œæ—¶é”™è¯¯
â€¢ IDEæ™ºèƒ½æç¤º
```

---

## 2. ğŸ“ ç»§æ‰¿ApplicationEvent


### 2.1 ApplicationEventåŸºç¡€


**ApplicationEventæ˜¯ä»€ä¹ˆï¼Ÿ**
å®ƒå°±åƒæ˜¯Springäº‹ä»¶ç³»ç»Ÿçš„"é€šç”¨ä¿¡å°"ï¼Œä½ è¦å‘é€çš„å…·ä½“æ¶ˆæ¯ï¼ˆè‡ªå®šä¹‰äº‹ä»¶ï¼‰éƒ½è¦è£…åœ¨è¿™ä¸ªä¿¡å°é‡Œæ‰èƒ½è¢«Springè¯†åˆ«å’Œä¼ é€’ã€‚

```java
// Springæä¾›çš„äº‹ä»¶åŸºç±»ï¼ˆç®€åŒ–ç‰ˆç†è§£ï¼‰
public abstract class ApplicationEvent extends EventObject {
    private final long timestamp;  // äº‹ä»¶å‘ç”Ÿæ—¶é—´æˆ³
    
    public ApplicationEvent(Object source) {
        super(source);
        this.timestamp = System.currentTimeMillis();
    }
}
```

**ğŸ” å…³é”®æ¦‚å¿µè§£æ**ï¼š
```
sourceï¼ˆäº‹ä»¶æºï¼‰ï¼š
â€¢ ä»£è¡¨"è°å‘å¸ƒäº†è¿™ä¸ªäº‹ä»¶"
â€¢ é€šå¸¸æ˜¯å‘å¸ƒäº‹ä»¶çš„Beanå¯¹è±¡
â€¢ å¯ä»¥ç†è§£ä¸º"å‘ä»¶äºº"

timestampï¼ˆæ—¶é—´æˆ³ï¼‰ï¼š
â€¢ äº‹ä»¶å‘ç”Ÿçš„æ—¶åˆ»
â€¢ è‡ªåŠ¨è®°å½•ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
â€¢ å¯ç”¨äºäº‹ä»¶æ’åºã€å®¡è®¡ç­‰
```

### 2.2 åˆ›å»ºæœ€ç®€å•çš„è‡ªå®šä¹‰äº‹ä»¶


**ğŸ“¦ åŸºç¡€äº‹ä»¶å®šä¹‰**ï¼š

```java
/**
 * ç”¨æˆ·æ³¨å†Œäº‹ä»¶ - æœ€ç®€å•çš„å½¢å¼
 * å½“æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸæ—¶è§¦å‘
 */
public class UserRegisteredEvent extends ApplicationEvent {
    
    // æ„é€ å™¨ï¼šå¿…é¡»è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ä¼ å…¥äº‹ä»¶æº
    public UserRegisteredEvent(Object source) {
        super(source);
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void register(User user) {
        // 1. ä¿å­˜ç”¨æˆ·
        saveUser(user);
        
        // 2. å‘å¸ƒäº‹ä»¶ï¼ˆthisä½œä¸ºäº‹ä»¶æºï¼‰
        eventPublisher.publishEvent(new UserRegisteredEvent(this));
    }
}
```

### 2.3 å¸¦ä¸šåŠ¡æ•°æ®çš„äº‹ä»¶


**ğŸ’¼ å®é™…ä¸šåŠ¡ä¸­çš„äº‹ä»¶**ï¼š

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨äº‹ä»¶ä¸­æºå¸¦ä¸šåŠ¡æ•°æ®ï¼š

```java
/**
 * ç”¨æˆ·æ³¨å†Œäº‹ä»¶ - æºå¸¦ç”¨æˆ·ä¿¡æ¯
 */
public class UserRegisteredEvent extends ApplicationEvent {
    
    private final User user;  // ä¸šåŠ¡æ•°æ®ï¼šæ³¨å†Œçš„ç”¨æˆ·ä¿¡æ¯
    
    public UserRegisteredEvent(Object source, User user) {
        super(source);
        this.user = user;
    }
    
    // æä¾›getteræ–¹æ³•ä¾›ç›‘å¬å™¨è·å–æ•°æ®
    public User getUser() {
        return user;
    }
}
```

**ç›‘å¬å™¨å¦‚ä½•ä½¿ç”¨**ï¼š
```java
@Component
public class WelcomeEmailListener {
    
    @EventListener
    public void handleUserRegistered(UserRegisteredEvent event) {
        // ä»äº‹ä»¶ä¸­è·å–ç”¨æˆ·ä¿¡æ¯
        User user = event.getUser();
        
        // å‘é€æ¬¢è¿é‚®ä»¶
        sendWelcomeEmail(user.getEmail(), user.getName());
    }
}
```

---

## 3. ğŸ“Š äº‹ä»¶æ•°æ®å°è£…


### 3.1 æ•°æ®å°è£…åŸåˆ™


**å°è£…ä»€ä¹ˆæ•°æ®ï¼Ÿå°è£…å¤šå°‘æ•°æ®ï¼Ÿ**

```
ğŸ¯ æ•°æ®å°è£…ç­–ç•¥ï¼š

æœ€å°åŒ–åŸåˆ™ï¼š
â€¢ åªæ”¾ç›‘å¬å™¨çœŸæ­£éœ€è¦çš„æ•°æ®
â€¢ é¿å…ä¼ é€’æ•´ä¸ªå¯¹è±¡ï¼ˆå¦‚æœåªéœ€è¦IDï¼‰
â€¢ å‡å°‘æ•°æ®åºåˆ—åŒ–å¼€é”€

æ¸…æ™°æ€§åŸåˆ™ï¼š
â€¢ å­—æ®µå‘½åè¦è§åçŸ¥æ„
â€¢ å¤æ‚æ•°æ®è¦é€‚å½“æ‹†åˆ†
â€¢ ä½¿ç”¨ä¸šåŠ¡æœ¯è¯­è€ŒéæŠ€æœ¯æœ¯è¯­

å®‰å…¨æ€§åŸåˆ™ï¼š
â€¢ ä¸ä¼ é€’æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€tokenï¼‰
â€¢ å¿…è¦æ—¶è„±æ•å¤„ç†
â€¢ ä½¿ç”¨ä¸å¯å˜å¯¹è±¡
```

### 3.2 å®ç”¨çš„æ•°æ®å°è£…æ–¹å¼


**ğŸ’¡ æ–¹å¼ä¸€ï¼šç›´æ¥å°è£…ä¸šåŠ¡å¯¹è±¡**ï¼š
```java
/**
 * è®¢å•åˆ›å»ºäº‹ä»¶ - å°è£…è®¢å•å¯¹è±¡
 * é€‚ç”¨åœºæ™¯ï¼šç›‘å¬å™¨éœ€è¦å®Œæ•´çš„è®¢å•ä¿¡æ¯
 */
public class OrderCreatedEvent extends ApplicationEvent {
    
    private final Order order;
    
    public OrderCreatedEvent(Object source, Order order) {
        super(source);
        this.order = order;
    }
    
    public Order getOrder() {
        return order;
    }
}
```

**ğŸ’¡ æ–¹å¼äºŒï¼šåªå°è£…å…³é”®æ•°æ®**ï¼š
```java
/**
 * è®¢å•æ”¯ä»˜äº‹ä»¶ - åªå°è£…å¿…è¦ä¿¡æ¯
 * é€‚ç”¨åœºæ™¯ï¼šç›‘å¬å™¨åªéœ€è¦çŸ¥é“"è°æ”¯ä»˜äº†å¤šå°‘é’±"
 */
public class OrderPaidEvent extends ApplicationEvent {
    
    private final Long orderId;     // è®¢å•ID
    private final Long userId;      // ç”¨æˆ·ID
    private final BigDecimal amount; // æ”¯ä»˜é‡‘é¢
    
    public OrderPaidEvent(Object source, Long orderId, 
                         Long userId, BigDecimal amount) {
        super(source);
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
    }
    
    // getteræ–¹æ³•...
}
```

**ğŸ’¡ æ–¹å¼ä¸‰ï¼šä½¿ç”¨Builderæ¨¡å¼**ï¼š
```java
/**
 * å•†å“ä¸Šæ¶äº‹ä»¶ - ä½¿ç”¨Builderæ¨¡å¼
 * é€‚ç”¨åœºæ™¯ï¼šäº‹ä»¶æ•°æ®å­—æ®µè¾ƒå¤šï¼Œéœ€è¦çµæ´»æ„å»º
 */
public class ProductListedEvent extends ApplicationEvent {
    
    private final Long productId;
    private final String productName;
    private final BigDecimal price;
    private final Integer stock;
    private final String category;
    
    // ç§æœ‰æ„é€ å™¨
    private ProductListedEvent(Builder builder) {
        super(builder.source);
        this.productId = builder.productId;
        this.productName = builder.productName;
        this.price = builder.price;
        this.stock = builder.stock;
        this.category = builder.category;
    }
    
    // Builderé™æ€å†…éƒ¨ç±»
    public static class Builder {
        private final Object source;      // å¿…å¡«
        private final Long productId;     // å¿…å¡«
        private String productName;       // å¯é€‰
        private BigDecimal price;         // å¯é€‰
        private Integer stock;            // å¯é€‰
        private String category;          // å¯é€‰
        
        public Builder(Object source, Long productId) {
            this.source = source;
            this.productId = productId;
        }
        
        public Builder productName(String name) {
            this.productName = name;
            return this;
        }
        
        public Builder price(BigDecimal price) {
            this.price = price;
            return this;
        }
        
        // å…¶ä»–setter...
        
        public ProductListedEvent build() {
            return new ProductListedEvent(this);
        }
    }
    
    // getteræ–¹æ³•...
}

// ä½¿ç”¨ç¤ºä¾‹
ProductListedEvent event = new ProductListedEvent.Builder(this, 100L)
    .productName("iPhone 15")
    .price(new BigDecimal("5999"))
    .stock(100)
    .category("ç”µå­äº§å“")
    .build();
```

### 3.3 ä¸å¯å˜äº‹ä»¶è®¾è®¡


**ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸å¯å˜äº‹ä»¶ï¼Ÿ**

```
ğŸ”’ ä¸å¯å˜çš„å¥½å¤„ï¼š

çº¿ç¨‹å®‰å…¨ï¼š
â€¢ äº‹ä»¶å¯èƒ½è¢«å¤šä¸ªç›‘å¬å™¨å¹¶å‘è®¿é—®
â€¢ ä¸å¯å˜å¯¹è±¡å¤©ç„¶çº¿ç¨‹å®‰å…¨
â€¢ é¿å…æ•°æ®ç«äº‰é—®é¢˜

é˜²æ­¢ç¯¡æ”¹ï¼š
â€¢ ç›‘å¬å™¨ä¸èƒ½ä¿®æ”¹äº‹ä»¶æ•°æ®
â€¢ ä¿è¯æ‰€æœ‰ç›‘å¬å™¨çœ‹åˆ°çš„æ•°æ®ä¸€è‡´
â€¢ ä¾¿äºé—®é¢˜è¿½è¸ª

ç®€åŒ–è®¾è®¡ï¼š
â€¢ ä¸éœ€è¦è€ƒè™‘é˜²å¾¡æ€§æ‹·è´
â€¢ ä»£ç æ›´ç®€æ´æ¸…æ™°
â€¢ é™ä½å‡ºé”™æ¦‚ç‡
```

**å®ç°ä¸å¯å˜äº‹ä»¶**ï¼š
```java
/**
 * ä¸å¯å˜äº‹ä»¶è®¾è®¡ç¤ºä¾‹
 */
public class UserRegisteredEvent extends ApplicationEvent {
    
    // æ‰€æœ‰å­—æ®µéƒ½æ˜¯finalçš„
    private final Long userId;
    private final String username;
    private final String email;
    private final LocalDateTime registerTime;
    
    public UserRegisteredEvent(Object source, Long userId, 
                               String username, String email) {
        super(source);
        this.userId = userId;
        this.username = username;
        this.email = email;
        this.registerTime = LocalDateTime.now();
    }
    
    // åªæä¾›getterï¼Œæ²¡æœ‰setter
    public Long getUserId() { return userId; }
    public String getUsername() { return username; }
    public String getEmail() { return email; }
    public LocalDateTime getRegisterTime() { return registerTime; }
    
    // å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œè¿”å›æ–°å¯¹è±¡
    public UserRegisteredEvent withEmail(String newEmail) {
        return new UserRegisteredEvent(
            getSource(), userId, username, newEmail
        );
    }
}
```

---

## 4. ğŸ·ï¸ äº‹ä»¶ç±»å‹æ ‡è¯†


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦äº‹ä»¶ç±»å‹


**åœºæ™¯ç†è§£**ï¼š
æƒ³è±¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œè®¢å•çŠ¶æ€å˜åŒ–æœ‰å¾ˆå¤šç§ï¼šåˆ›å»ºã€æ”¯ä»˜ã€å‘è´§ã€å®Œæˆã€å–æ¶ˆ...å¦‚æœæ¯ç§çŠ¶æ€éƒ½å®šä¹‰ä¸€ä¸ªäº‹ä»¶ç±»ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„äº‹ä»¶ç±»ã€‚è¿™æ—¶å€™ä½¿ç”¨äº‹ä»¶ç±»å‹æ ‡è¯†å°±å¾ˆæœ‰ç”¨ã€‚

```
ğŸ“¦ ä¸¤ç§è®¾è®¡æ–¹å¼å¯¹æ¯”ï¼š

æ–¹å¼1ï¼šæ¯ä¸ªçŠ¶æ€ä¸€ä¸ªäº‹ä»¶ç±»
OrderCreatedEvent
OrderPaidEvent
OrderShippedEvent
OrderCompletedEvent
OrderCancelledEvent
// è®¢å•çŠ¶æ€è¶Šå¤šï¼Œäº‹ä»¶ç±»è¶Šå¤š...

æ–¹å¼2ï¼šä¸€ä¸ªäº‹ä»¶ç±» + ç±»å‹æ ‡è¯†
OrderStatusChangedEvent {
    eventType: CREATED / PAID / SHIPPED / COMPLETED / CANCELLED
}
```

### 4.2 ä½¿ç”¨æšä¸¾å®šä¹‰äº‹ä»¶ç±»å‹


**ğŸ’¡ æ¨èæ–¹å¼ï¼šæšä¸¾ç±»å‹**ï¼š

```java
/**
 * è®¢å•äº‹ä»¶ç±»å‹æšä¸¾
 */
public enum OrderEventType {
    CREATED("è®¢å•åˆ›å»º"),
    PAID("è®¢å•æ”¯ä»˜"),
    SHIPPED("è®¢å•å‘è´§"),
    COMPLETED("è®¢å•å®Œæˆ"),
    CANCELLED("è®¢å•å–æ¶ˆ"),
    REFUNDED("è®¢å•é€€æ¬¾");
    
    private final String description;
    
    OrderEventType(String description) {
        this.description = description;
    }
    
    public String getDescription() {
        return description;
    }
}

/**
 * è®¢å•çŠ¶æ€å˜æ›´äº‹ä»¶
 */
public class OrderStatusChangedEvent extends ApplicationEvent {
    
    private final Long orderId;
    private final OrderEventType eventType;  // äº‹ä»¶ç±»å‹
    private final String previousStatus;     // ä¹‹å‰çš„çŠ¶æ€
    private final String currentStatus;      // å½“å‰çŠ¶æ€
    
    public OrderStatusChangedEvent(Object source, Long orderId,
                                   OrderEventType eventType,
                                   String previousStatus,
                                   String currentStatus) {
        super(source);
        this.orderId = orderId;
        this.eventType = eventType;
        this.previousStatus = previousStatus;
        this.currentStatus = currentStatus;
    }
    
    // getteræ–¹æ³•...
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// å‘å¸ƒäº‹ä»¶æ—¶æŒ‡å®šç±»å‹
eventPublisher.publishEvent(
    new OrderStatusChangedEvent(
        this,
        orderId,
        OrderEventType.PAID,  // æ˜ç¡®çš„ç±»å‹æ ‡è¯†
        "CREATED",
        "PAID"
    )
);

// ç›‘å¬å™¨å¯ä»¥æ ¹æ®ç±»å‹å¤„ç†
@EventListener
public void handleOrderStatusChanged(OrderStatusChangedEvent event) {
    switch (event.getEventType()) {
        case PAID:
            // å¤„ç†æ”¯ä»˜æˆåŠŸé€»è¾‘
            notifyWarehouse(event.getOrderId());
            break;
        case SHIPPED:
            // å¤„ç†å‘è´§é€»è¾‘
            notifyUser(event.getOrderId());
            break;
        // å…¶ä»–ç±»å‹...
    }
}
```

### 4.3 äº‹ä»¶ç±»å‹çš„æœ€ä½³å®è·µ


**ğŸ¯ è®¾è®¡å»ºè®®**ï¼š

```
ä½•æ—¶ä½¿ç”¨äº‹ä»¶ç±»å‹æ ‡è¯†ï¼š
âœ… å¤šä¸ªç›¸ä¼¼äº‹ä»¶å…±äº«ç›¸åŒçš„æ•°æ®ç»“æ„
âœ… äº‹ä»¶ä¹‹é—´æœ‰æ˜ç¡®çš„åˆ†ç±»å…³ç³»
âœ… éœ€è¦åœ¨ä¸€ä¸ªç›‘å¬å™¨ä¸­ç»Ÿä¸€å¤„ç†å¤šç§äº‹ä»¶

ä½•æ—¶ä½¿ç”¨ç‹¬ç«‹äº‹ä»¶ç±»ï¼š
âœ… äº‹ä»¶æ•°æ®ç»“æ„å·®å¼‚å¾ˆå¤§
âœ… ä¸åŒäº‹ä»¶çš„å¤„ç†é€»è¾‘å®Œå…¨ä¸åŒ
âœ… éœ€è¦ç±»å‹å®‰å…¨çš„ç¼–è¯‘æ£€æŸ¥

æ··åˆä½¿ç”¨ç­–ç•¥ï¼š
â€¢ é¡¶å±‚ç”¨ç‹¬ç«‹äº‹ä»¶ç±»ï¼ˆå¦‚OrderEventã€UserEventï¼‰
â€¢ å†…éƒ¨ç”¨ç±»å‹æ ‡è¯†ç»†åˆ†ï¼ˆå¦‚è®¢å•çŠ¶æ€ç±»å‹ï¼‰
â€¢ æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦çµæ´»è°ƒæ•´
```

**å®é™…æ¡ˆä¾‹**ï¼š
```java
/**
 * ç”¨æˆ·äº‹ä»¶åŸºç±»
 */
public abstract class UserEvent extends ApplicationEvent {
    protected final Long userId;
    
    public UserEvent(Object source, Long userId) {
        super(source);
        this.userId = userId;
    }
    
    public Long getUserId() { return userId; }
}

/**
 * ç”¨æˆ·æ“ä½œäº‹ä»¶ï¼ˆä½¿ç”¨ç±»å‹æ ‡è¯†ï¼‰
 */
public class UserActionEvent extends UserEvent {
    
    public enum ActionType {
        LOGIN,    // ç™»å½•
        LOGOUT,   // ç™»å‡º
        PROFILE_UPDATE,  // æ›´æ–°èµ„æ–™
        PASSWORD_CHANGE  // ä¿®æ”¹å¯†ç 
    }
    
    private final ActionType actionType;
    private final Map<String, Object> actionData;
    
    public UserActionEvent(Object source, Long userId, 
                          ActionType actionType,
                          Map<String, Object> actionData) {
        super(source, userId);
        this.actionType = actionType;
        this.actionData = actionData;
    }
    
    // getteræ–¹æ³•...
}

/**
 * ç”¨æˆ·æ³¨å†Œäº‹ä»¶ï¼ˆç‹¬ç«‹äº‹ä»¶ç±»ï¼‰
 * å› ä¸ºæ³¨å†Œæ•°æ®ç»“æ„ç‰¹æ®Šï¼Œå•ç‹¬å®šä¹‰
 */
public class UserRegisteredEvent extends UserEvent {
    private final String username;
    private final String email;
    private final String registerSource;
    
    // æ„é€ å™¨å’Œgetter...
}
```

---

## 5. ğŸ“‹ äº‹ä»¶å…ƒæ•°æ®è®¾è®¡


### 5.1 ä»€ä¹ˆæ˜¯äº‹ä»¶å…ƒæ•°æ®


**å…ƒæ•°æ®å°±æ˜¯"æ•°æ®çš„æ•°æ®"**ï¼š
å°±åƒä¸€å°å¿«é€’ï¼Œé™¤äº†åŒ…è£¹æœ¬èº«ï¼ˆä¸šåŠ¡æ•°æ®ï¼‰ï¼Œè¿˜æœ‰å¿«é€’å•å·ã€å‘ä»¶æ—¶é—´ã€å‘ä»¶åœ°å€ç­‰ä¿¡æ¯ï¼ˆå…ƒæ•°æ®ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°è¿½è¸ªå’Œç®¡ç†äº‹ä»¶ã€‚

```
ğŸ“¨ äº‹ä»¶å®Œæ•´ç»“æ„ï¼š

ä¸šåŠ¡æ•°æ®ï¼ˆPayloadï¼‰ï¼š
â€¢ è®¢å•ID
â€¢ ç”¨æˆ·ID
â€¢ æ”¯ä»˜é‡‘é¢
â””â”€> è¿™æ˜¯äº‹ä»¶çš„"ä¸»è¦å†…å®¹"

å…ƒæ•°æ®ï¼ˆMetadataï¼‰ï¼š
â€¢ äº‹ä»¶IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
â€¢ äº‹ä»¶æ—¶é—´
â€¢ äº‹ä»¶æ¥æº
â€¢ äº‹ä»¶ç‰ˆæœ¬
â€¢ è¿½è¸ªID
â€¢ ç¯å¢ƒä¿¡æ¯
â””â”€> è¿™æ˜¯äº‹ä»¶çš„"è¾…åŠ©ä¿¡æ¯"
```

### 5.2 å¸¸ç”¨å…ƒæ•°æ®å­—æ®µ


**ğŸ”– æ ¸å¿ƒå…ƒæ•°æ®å­—æ®µ**ï¼š

```java
/**
 * å¸¦å®Œæ•´å…ƒæ•°æ®çš„äº‹ä»¶åŸºç±»
 */
public abstract class BaseEvent extends ApplicationEvent {
    
    // äº‹ä»¶å”¯ä¸€æ ‡è¯†
    private final String eventId;
    
    // äº‹ä»¶å‘ç”Ÿæ—¶é—´ï¼ˆæ›´ç²¾ç¡®çš„æ—¶é—´ï¼‰
    private final LocalDateTime occurredAt;
    
    // äº‹ä»¶ç‰ˆæœ¬ï¼ˆç”¨äºäº‹ä»¶æ¼”è¿›ï¼‰
    private final String eventVersion;
    
    // è¿½è¸ªIDï¼ˆç”¨äºåˆ†å¸ƒå¼è¿½è¸ªï¼‰
    private final String traceId;
    
    // ç§Ÿæˆ·IDï¼ˆå¤šç§Ÿæˆ·ç³»ç»Ÿï¼‰
    private final String tenantId;
    
    // ç¯å¢ƒæ ‡è¯†ï¼ˆdev/test/prodï¼‰
    private final String environment;
    
    protected BaseEvent(Object source) {
        super(source);
        this.eventId = UUID.randomUUID().toString();
        this.occurredAt = LocalDateTime.now();
        this.eventVersion = "1.0";
        this.traceId = MDC.get("traceId");  // ä»æ—¥å¿—ä¸Šä¸‹æ–‡è·å–
        this.tenantId = TenantContext.getCurrentTenantId();
        this.environment = System.getProperty("spring.profiles.active");
    }
    
    // getteræ–¹æ³•...
}
```

**ä½¿ç”¨å…ƒæ•°æ®çš„å¥½å¤„**ï¼š
```
ğŸ” é—®é¢˜æ’æŸ¥ï¼š
â€¢ é€šè¿‡eventIdç²¾ç¡®å®šä½æŸä¸ªäº‹ä»¶
â€¢ é€šè¿‡traceIdè¿½è¸ªå®Œæ•´è°ƒç”¨é“¾è·¯
â€¢ é€šè¿‡occurredAtåˆ†æäº‹ä»¶æ—¶åº

ğŸ“Š æ•°æ®åˆ†æï¼š
â€¢ ç»Ÿè®¡ä¸åŒç¯å¢ƒçš„äº‹ä»¶åˆ†å¸ƒ
â€¢ åˆ†æå¤šç§Ÿæˆ·çš„ä½¿ç”¨æƒ…å†µ
â€¢ å®¡è®¡äº‹ä»¶å¤„ç†æµç¨‹

ğŸ”„ ç‰ˆæœ¬ç®¡ç†ï¼š
â€¢ è¯†åˆ«ä¸åŒç‰ˆæœ¬çš„äº‹ä»¶æ ¼å¼
â€¢ æ”¯æŒå¹³æ»‘å‡çº§
â€¢ å…¼å®¹æ—§ç‰ˆæœ¬ç›‘å¬å™¨
```

### 5.3 å®ç”¨çš„å…ƒæ•°æ®è®¾è®¡


**ğŸ’¼ å®é™…ä¸šåŠ¡ä¸­çš„å…ƒæ•°æ®**ï¼š

```java
/**
 * è®¢å•äº‹ä»¶ - å®Œæ•´å…ƒæ•°æ®ç‰ˆæœ¬
 */
public class OrderCreatedEvent extends BaseEvent {
    
    // === ä¸šåŠ¡æ•°æ® ===
    private final Long orderId;
    private final Long userId;
    private final BigDecimal amount;
    
    // === ä¸šåŠ¡å…ƒæ•°æ® ===
    private final String orderSource;      // è®¢å•æ¥æºï¼ˆAPP/WEB/å°ç¨‹åºï¼‰
    private final String userIp;          // ç”¨æˆ·IP
    private final String userAgent;       // ç”¨æˆ·è®¾å¤‡ä¿¡æ¯
    
    // === å¤„ç†å…ƒæ•°æ® ===
    private final Boolean needsNotification;  // æ˜¯å¦éœ€è¦é€šçŸ¥
    private final Integer retryCount;         // é‡è¯•æ¬¡æ•°
    private final String correlationId;       // å…³è”IDï¼ˆä¸šåŠ¡æµæ°´å·ï¼‰
    
    public OrderCreatedEvent(Object source, 
                            Long orderId,
                            Long userId,
                            BigDecimal amount) {
        super(source);
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
        
        // è‡ªåŠ¨è·å–å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯
        this.orderSource = RequestContext.getSource();
        this.userIp = RequestContext.getClientIp();
        this.userAgent = RequestContext.getUserAgent();
        this.needsNotification = true;
        this.retryCount = 0;
        this.correlationId = generateCorrelationId();
    }
    
    // æ”¯æŒé‡è¯•çš„æ„é€ å™¨
    private OrderCreatedEvent(OrderCreatedEvent original, int retryCount) {
        super(original.getSource());
        // å¤åˆ¶ä¸šåŠ¡æ•°æ®
        this.orderId = original.orderId;
        this.userId = original.userId;
        this.amount = original.amount;
        this.orderSource = original.orderSource;
        this.userIp = original.userIp;
        this.userAgent = original.userAgent;
        this.needsNotification = original.needsNotification;
        // æ›´æ–°é‡è¯•æ¬¡æ•°
        this.retryCount = retryCount;
        this.correlationId = original.correlationId;
    }
    
    // åˆ›å»ºé‡è¯•äº‹ä»¶
    public OrderCreatedEvent retry() {
        return new OrderCreatedEvent(this, this.retryCount + 1);
    }
    
    // getteræ–¹æ³•...
}
```

---

## 6. ğŸ’¾ åºåˆ—åŒ–æ”¯æŒ


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–


**åºåˆ—åŒ–åœºæ™¯**ï¼š

```
ğŸŒ éœ€è¦åºåˆ—åŒ–çš„åœºæ™¯ï¼š

åˆ†å¸ƒå¼äº‹ä»¶ä¼ é€’ï¼š
åº”ç”¨A â†’ MQ â†’ åº”ç”¨B
      åºåˆ—åŒ–   ååºåˆ—åŒ–

äº‹ä»¶æŒä¹…åŒ–ï¼š
äº‹ä»¶ â†’ æ•°æ®åº“ â†’ æŸ¥è¯¢äº‹ä»¶
    åºåˆ—åŒ–    ååºåˆ—åŒ–

äº‹ä»¶ç¼“å­˜ï¼š
äº‹ä»¶ â†’ Redis â†’ è¯»å–äº‹ä»¶
    åºåˆ—åŒ–   ååºåˆ—åŒ–

è·¨è¯­è¨€é€šä¿¡ï¼š
Javaåº”ç”¨ â†’ JSON â†’ Pythonåº”ç”¨
        åºåˆ—åŒ–     ååºåˆ—åŒ–
```

### 6.2 JavaåŸç”Ÿåºåˆ—åŒ–


**ğŸ“¦ å®ç°Serializableæ¥å£**ï¼š

```java
/**
 * æ”¯æŒJavaåºåˆ—åŒ–çš„äº‹ä»¶
 */
public class OrderCreatedEvent extends ApplicationEvent 
                               implements Serializable {
    
    // åºåˆ—åŒ–ç‰ˆæœ¬å·ï¼ˆé‡è¦ï¼ï¼‰
    private static final long serialVersionUID = 1L;
    
    private final Long orderId;
    private final Long userId;
    private final BigDecimal amount;
    
    public OrderCreatedEvent(Object source, Long orderId, 
                            Long userId, BigDecimal amount) {
        super(source);
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
    }
    
    // getteræ–¹æ³•...
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**ï¼š
```
serialVersionUIDçš„ä½œç”¨ï¼š
â€¢ æ ‡è¯†ç±»çš„ç‰ˆæœ¬
â€¢ ååºåˆ—åŒ–æ—¶éªŒè¯ç‰ˆæœ¬æ˜¯å¦åŒ¹é…
â€¢ å»ºè®®æ˜¾å¼å£°æ˜ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤å€¼

åºåˆ—åŒ–å…¼å®¹æ€§ï¼š
â€¢ æ·»åŠ æ–°å­—æ®µï¼šå…¼å®¹ï¼ˆæ—§ç‰ˆæœ¬å¿½ç•¥æ–°å­—æ®µï¼‰
â€¢ åˆ é™¤å­—æ®µï¼šå¯èƒ½ä¸å…¼å®¹
â€¢ ä¿®æ”¹å­—æ®µç±»å‹ï¼šä¸å…¼å®¹
â€¢ ä¿®æ”¹serialVersionUIDï¼šå¼ºåˆ¶ä¸å…¼å®¹
```

### 6.3 JSONåºåˆ—åŒ–ï¼ˆæ¨èï¼‰


**ğŸ¯ ä½¿ç”¨Jacksonè¿›è¡ŒJSONåºåˆ—åŒ–**ï¼š

```java
/**
 * æ”¯æŒJSONåºåˆ—åŒ–çš„äº‹ä»¶
 * ä½¿ç”¨Jacksonæ³¨è§£ä¼˜åŒ–åºåˆ—åŒ–
 */
public class OrderCreatedEvent extends ApplicationEvent {
    
    private final Long orderId;
    private final Long userId;
    private final BigDecimal amount;
    
    // å¿½ç•¥åºåˆ—åŒ–ï¼ˆsourceé€šå¸¸æ˜¯Spring Beanï¼Œä¸éœ€è¦åºåˆ—åŒ–ï¼‰
    @JsonIgnore
    private final Object eventSource;
    
    // æ„é€ å™¨ - ç”¨äºååºåˆ—åŒ–
    @JsonCreator
    public OrderCreatedEvent(
            @JsonProperty("orderId") Long orderId,
            @JsonProperty("userId") Long userId,
            @JsonProperty("amount") BigDecimal amount) {
        super(new Object());  // sourceä½¿ç”¨å ä½å¯¹è±¡
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
        this.eventSource = null;
    }
    
    // æ—¶é—´æ ¼å¼åŒ–
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    public LocalDateTime getOccurredAt() {
        return LocalDateTime.ofInstant(
            Instant.ofEpochMilli(getTimestamp()),
            ZoneId.systemDefault()
        );
    }
    
    // getteræ–¹æ³•...
}

// ä½¿ç”¨ç¤ºä¾‹
ObjectMapper mapper = new ObjectMapper();

// åºåˆ—åŒ–
String json = mapper.writeValueAsString(event);

// ååºåˆ—åŒ–
OrderCreatedEvent event = mapper.readValue(json, OrderCreatedEvent.class);
```

### 6.4 åºåˆ—åŒ–æœ€ä½³å®è·µ


**ğŸ¨ è®¾è®¡å»ºè®®**ï¼š

```
âœ… æ¨èåšæ³•ï¼š

ä½¿ç”¨JSONæ ¼å¼ï¼š
â€¢ äººç±»å¯è¯»
â€¢ è·¨è¯­è¨€æ”¯æŒ
â€¢ è°ƒè¯•æ–¹ä¾¿
â€¢ ç‰ˆæœ¬å…¼å®¹æ€§å¥½

å­—æ®µè®¾è®¡ï¼š
â€¢ ä½¿ç”¨åŒ…è£…ç±»å‹ï¼ˆIntegerè€Œéintï¼‰
â€¢ é¿å…å¤æ‚å¯¹è±¡åµŒå¥—
â€¢ æä¾›é»˜è®¤å€¼
â€¢ ä½¿ç”¨ä¸å¯å˜å¯¹è±¡

ç‰ˆæœ¬ç®¡ç†ï¼š
â€¢ æ·»åŠ versionå­—æ®µ
â€¢ ä½¿ç”¨@JsonIgnoreProperties(ignoreUnknown = true)
â€¢ å‘åå…¼å®¹æ–°å¢å­—æ®µ
â€¢ æ…é‡åˆ é™¤æˆ–ä¿®æ”¹å­—æ®µ
```

**å®ç”¨å·¥å…·ç±»**ï¼š
```java
/**
 * äº‹ä»¶åºåˆ—åŒ–å·¥å…·ç±»
 */
public class EventSerializer {
    
    private static final ObjectMapper MAPPER = new ObjectMapper()
        .registerModule(new JavaTimeModule())  // æ”¯æŒJava 8æ—¶é—´ç±»å‹
        .configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false)
        .setSerializationInclusion(JsonInclude.Include.NON_NULL);
    
    // åºåˆ—åŒ–ä¸ºJSON
    public static String toJson(ApplicationEvent event) {
        try {
            return MAPPER.writeValueAsString(event);
        } catch (Exception e) {
            throw new EventSerializationException("åºåˆ—åŒ–å¤±è´¥", e);
        }
    }
    
    // ä»JSONååºåˆ—åŒ–
    public static <T extends ApplicationEvent> T fromJson(
            String json, Class<T> eventType) {
        try {
            return MAPPER.readValue(json, eventType);
        } catch (Exception e) {
            throw new EventSerializationException("ååºåˆ—åŒ–å¤±è´¥", e);
        }
    }
    
    // åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼ˆç”¨äºMQä¼ è¾“ï¼‰
    public static byte[] toBytes(ApplicationEvent event) {
        try {
            return MAPPER.writeValueAsBytes(event);
        } catch (Exception e) {
            throw new EventSerializationException("åºåˆ—åŒ–å¤±è´¥", e);
        }
    }
}
```

---

## 7. ğŸ”„ äº‹ä»¶ç‰ˆæœ¬æ§åˆ¶


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬æ§åˆ¶


**ç‰ˆæœ¬æ¼”è¿›åœºæ™¯**ï¼š

```
ğŸ“… äº‹ä»¶æ¼”è¿›æ—¶é—´çº¿ï¼š

v1.0 (åˆå§‹ç‰ˆæœ¬)
OrderCreatedEvent {
    orderId: Long
    userId: Long
}

v2.0 (æ–°å¢å­—æ®µ)
OrderCreatedEvent {
    orderId: Long
    userId: Long
    amount: BigDecimal    â† æ–°å¢
}

v3.0 (å­—æ®µæ”¹å)
OrderCreatedEvent {
    orderId: Long
    customerId: Long      â† æ”¹åï¼ˆåŸuserIdï¼‰
    amount: BigDecimal
    items: List<Item>     â† æ–°å¢
}
```

**ğŸ”§ ç‰ˆæœ¬æ§åˆ¶è§£å†³çš„é—®é¢˜**ï¼š
```
å…¼å®¹æ€§é—®é¢˜ï¼š
â€¢ æ—§ç‰ˆæœ¬ç›‘å¬å™¨èƒ½å¦å¤„ç†æ–°ç‰ˆæœ¬äº‹ä»¶ï¼Ÿ
â€¢ æ–°ç‰ˆæœ¬ç›‘å¬å™¨èƒ½å¦å¤„ç†æ—§ç‰ˆæœ¬äº‹ä»¶ï¼Ÿ
â€¢ å¦‚ä½•å¹³æ»‘å‡çº§ï¼Ÿ

è¯†åˆ«é—®é¢˜ï¼š
â€¢ å¦‚ä½•çŸ¥é“äº‹ä»¶æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Ÿ
â€¢ å¦‚ä½•æ ¹æ®ç‰ˆæœ¬åšä¸åŒå¤„ç†ï¼Ÿ
â€¢ å¦‚ä½•è®°å½•å’Œè¿½è¸ªç‰ˆæœ¬å˜åŒ–ï¼Ÿ
```

### 7.2 ç‰ˆæœ¬æ ‡è¯†ç­–ç•¥


**ğŸ’¡ ç­–ç•¥ä¸€ï¼šç‰ˆæœ¬å·å­—æ®µ**ï¼š

```java
/**
 * å¸¦ç‰ˆæœ¬å·çš„äº‹ä»¶
 */
public class OrderCreatedEvent extends ApplicationEvent {
    
    // äº‹ä»¶æ ¼å¼ç‰ˆæœ¬
    private final String eventVersion;
    
    private final Long orderId;
    private final Long userId;
    private final BigDecimal amount;
    
    public OrderCreatedEvent(Object source, Long orderId,
                            Long userId, BigDecimal amount) {
        super(source);
        this.eventVersion = "2.0";  // å½“å‰ç‰ˆæœ¬
        this.orderId = orderId;
        this.userId = userId;
        this.amount = amount;
    }
    
    public String getEventVersion() {
        return eventVersion;
    }
}

// ç›‘å¬å™¨æ ¹æ®ç‰ˆæœ¬å¤„ç†
@EventListener
public void handleOrderCreated(OrderCreatedEvent event) {
    String version = event.getEventVersion();
    
    if ("1.0".equals(version)) {
        // å¤„ç†v1.0æ ¼å¼
        handleV1(event);
    } else if ("2.0".equals(version)) {
        // å¤„ç†v2.0æ ¼å¼
        handleV2(event);
    }
}
```

**ğŸ’¡ ç­–ç•¥äºŒï¼šç‰ˆæœ¬ç±»ç»§æ‰¿**ï¼š

```java
/**
 * v1.0ç‰ˆæœ¬äº‹ä»¶
 */
public class OrderCreatedEventV1 extends ApplicationEvent {
    private final Long orderId;
    private final Long userId;
    
    // æ„é€ å™¨å’Œgetter...
}

/**
 * v2.0ç‰ˆæœ¬äº‹ä»¶ï¼ˆå‘åå…¼å®¹ï¼‰
 */
public class OrderCreatedEventV2 extends OrderCreatedEventV1 {
    private final BigDecimal amount;
    
    public OrderCreatedEventV2(Object source, Long orderId,
                              Long userId, BigDecimal amount) {
        super(source, orderId, userId);
        this.amount = amount;
    }
    
    public BigDecimal getAmount() {
        return amount;
    }
}

// ç›‘å¬å™¨å¯ä»¥é€‰æ‹©å¤„ç†ç‰¹å®šç‰ˆæœ¬
@EventListener
public void handleV2(OrderCreatedEventV2 event) {
    // åªå¤„ç†v2.0ç‰ˆæœ¬
}

@EventListener  
public void handleAnyVersion(OrderCreatedEventV1 event) {
    // å¤„ç†v1.0å’Œv2.0ï¼ˆv2.0ä¹Ÿæ˜¯v1.0çš„å­ç±»ï¼‰
}
```

### 7.3 ç‰ˆæœ¬å…¼å®¹æ€§å¤„ç†


**ğŸ”€ å‘åå…¼å®¹ç¤ºä¾‹**ï¼š

```java
/**
 * æ”¯æŒå¤šç‰ˆæœ¬çš„äº‹ä»¶è½¬æ¢å™¨
 */
public class OrderEventConverter {
    
    // v1è½¬v2ï¼ˆè¡¥å……é»˜è®¤å€¼ï¼‰
    public OrderCreatedEventV2 convertV1ToV2(OrderCreatedEventV1 v1) {
        return new OrderCreatedEventV2(
            v1.getSource(),
            v1.getOrderId(),
            v1.getUserId(),
            BigDecimal.ZERO  // v1æ²¡æœ‰é‡‘é¢ï¼Œä½¿ç”¨é»˜è®¤å€¼
        );
    }
    
    // v2è½¬v1ï¼ˆä¸¢å¼ƒé¢å¤–å­—æ®µï¼‰
    public OrderCreatedEventV1 convertV2ToV1(OrderCreatedEventV2 v2) {
        return new OrderCreatedEventV1(
            v2.getSource(),
            v2.getOrderId(),
            v2.getUserId()
            // amountå­—æ®µè¢«ä¸¢å¼ƒ
        );
    }
}

/**
 * æ”¯æŒå¤šç‰ˆæœ¬çš„ç›‘å¬å™¨
 */
@Component
public class OrderEventListener {
    
    @Autowired
    private OrderEventConverter converter;
    
    // ç»Ÿä¸€å¤„ç†å¤šç‰ˆæœ¬äº‹ä»¶
    @EventListener
    public void handleOrderCreated(OrderCreatedEventV1 event) {
        OrderCreatedEventV2 v2Event;
        
        if (event instanceof OrderCreatedEventV2) {
            v2Event = (OrderCreatedEventV2) event;
        } else {
            // v1è½¬æ¢ä¸ºv2
            v2Event = converter.convertV1ToV2(event);
        }
        
        // ç»Ÿä¸€ä½¿ç”¨v2æ ¼å¼å¤„ç†
        processOrder(v2Event);
    }
}
```

### 7.4 ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ


**ğŸ“‹ å®ç”¨å»ºè®®**ï¼š

```
ğŸ¯ ç‰ˆæœ¬æ¼”è¿›åŸåˆ™ï¼š

åªå¢ä¸å‡ï¼š
â€¢ æ–°å¢å­—æ®µè€Œéåˆ é™¤
â€¢ ä½¿ç”¨@JsonIgnoreæ ‡è®°åºŸå¼ƒå­—æ®µ
â€¢ ä¿æŒå‘åå…¼å®¹

è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼š
â€¢ ä¸»ç‰ˆæœ¬å·ï¼šä¸å…¼å®¹çš„é‡å¤§å˜æ›´
â€¢ æ¬¡ç‰ˆæœ¬å·ï¼šå‘åå…¼å®¹çš„æ–°åŠŸèƒ½  
â€¢ ä¿®è®¢å·ï¼šå‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤
ç¤ºä¾‹ï¼šv2.1.3

æ–‡æ¡£åŒ–ï¼š
â€¢ è®°å½•æ¯ä¸ªç‰ˆæœ¬çš„å˜æ›´å†…å®¹
â€¢ è¯´æ˜å…¼å®¹æ€§å½±å“
â€¢ æä¾›å‡çº§æŒ‡å—

æ¸è¿›å¼å‡çº§ï¼š
â€¢ åŒæ—¶æ”¯æŒæ–°æ—§ç‰ˆæœ¬
â€¢ é€æ­¥è¿ç§»ç›‘å¬å™¨
â€¢ æœ€ååºŸå¼ƒæ—§ç‰ˆæœ¬
```

**ç‰ˆæœ¬ç®¡ç†å·¥å…·ç±»**ï¼š
```java
/**
 * äº‹ä»¶ç‰ˆæœ¬ç®¡ç†å™¨
 */
@Component
public class EventVersionManager {
    
    private static final Map<String, String> VERSION_MAP = Map.of(
        "OrderCreatedEvent", "2.0",
        "UserRegisteredEvent", "1.5",
        "PaymentProcessedEvent", "3.0"
    );
    
    // è·å–äº‹ä»¶å½“å‰ç‰ˆæœ¬
    public String getCurrentVersion(Class<?> eventClass) {
        return VERSION_MAP.getOrDefault(
            eventClass.getSimpleName(), 
            "1.0"
        );
    }
    
    // æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
    public boolean isCompatible(String eventVersion, String listenerVersion) {
        // ä¸»ç‰ˆæœ¬å·ç›¸åŒå³å…¼å®¹
        return eventVersion.split("\\.")[0]
               .equals(listenerVersion.split("\\.")[0]);
    }
    
    // è®°å½•ç‰ˆæœ¬å˜æ›´
    @EventListener
    public void logVersionChange(ApplicationEvent event) {
        if (event instanceof VersionedEvent) {
            VersionedEvent versionedEvent = (VersionedEvent) event;
            log.info("äº‹ä»¶ç‰ˆæœ¬: {} - {}", 
                event.getClass().getSimpleName(),
                versionedEvent.getEventVersion());
        }
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ äº‹ä»¶æœºåˆ¶æœ¬è´¨ï¼šè§£è€¦ç³»ç»Ÿæ¨¡å—ï¼Œå®ç°æ¶ˆæ¯é©±åŠ¨æ¶æ„
ğŸ”¸ ApplicationEventï¼šSpringäº‹ä»¶çš„åŸºç¡€ç±»ï¼Œæ‰€æœ‰è‡ªå®šä¹‰äº‹ä»¶å¿…é¡»ç»§æ‰¿
ğŸ”¸ æ•°æ®å°è£…ï¼šåªä¼ é€’å¿…è¦çš„ä¸šåŠ¡æ•°æ®ï¼Œéµå¾ªæœ€å°åŒ–åŸåˆ™
ğŸ”¸ äº‹ä»¶ç±»å‹ï¼šä½¿ç”¨æšä¸¾æ ‡è¯†äº‹ä»¶ç±»å‹ï¼Œç»Ÿä¸€ç®¡ç†ç›¸ä¼¼äº‹ä»¶
ğŸ”¸ å…ƒæ•°æ®è®¾è®¡ï¼šæ·»åŠ è¿½è¸ªã€å®¡è®¡ã€ç‰ˆæœ¬ç­‰è¾…åŠ©ä¿¡æ¯
ğŸ”¸ åºåˆ—åŒ–æ”¯æŒï¼šJSONåºåˆ—åŒ–æ˜¯é¦–é€‰ï¼Œä¾¿äºè·¨è¯­è¨€å’Œè°ƒè¯•
ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶ï¼šæ”¯æŒäº‹ä»¶æ¼”è¿›ï¼Œä¿æŒå‘åå…¼å®¹æ€§
```

### 8.2 å…³é”®è®¾è®¡åŸåˆ™


**ğŸ”¹ äº‹ä»¶è®¾è®¡çš„é»„é‡‘æ³•åˆ™**ï¼š
```
å•ä¸€èŒè´£ï¼š
â€¢ ä¸€ä¸ªäº‹ä»¶åªè¡¨è¾¾ä¸€ä¸ªä¸šåŠ¡å«ä¹‰
â€¢ ä¸è¦åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­æ··åˆå¤šä¸ªä¸šåŠ¡é€»è¾‘
â€¢ ä¿æŒäº‹ä»¶çš„çº¯ç²¹æ€§

æœ€å°åŒ–åŸåˆ™ï¼š
â€¢ åªåŒ…å«ç›‘å¬å™¨çœŸæ­£éœ€è¦çš„æ•°æ®
â€¢ é¿å…ä¼ é€’æ•´ä¸ªä¸šåŠ¡å¯¹è±¡
â€¢ å‡å°‘åºåˆ—åŒ–å’Œä¼ è¾“å¼€é”€

ä¸å¯å˜æ€§ï¼š
â€¢ äº‹ä»¶å¯¹è±¡ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹
â€¢ ä½¿ç”¨finalå­—æ®µ
â€¢ åªæä¾›getteræ²¡æœ‰setter

æ¸…æ™°å‘½åï¼š
â€¢ ä½¿ç”¨ä¸šåŠ¡æœ¯è¯­è€ŒéæŠ€æœ¯æœ¯è¯­
â€¢ è§åçŸ¥æ„ï¼Œå¦‚UserRegisteredEvent
â€¢ ç»Ÿä¸€å‘½åè§„èŒƒï¼Œå¦‚xxxEventåç¼€
```

**ğŸ”¹ ä½•æ—¶ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶**ï¼š
```
âœ… é€‚åˆä½¿ç”¨äº‹ä»¶çš„åœºæ™¯ï¼š
â€¢ ä¸€ä¸ªåŠ¨ä½œè§¦å‘å¤šä¸ªåç»­æ“ä½œ
â€¢ æ¨¡å—é—´éœ€è¦è§£è€¦
â€¢ éœ€è¦å¼‚æ­¥å¤„ç†
â€¢ éœ€è¦å®¡è®¡å’Œè¿½è¸ª
â€¢ ç³»ç»Ÿéœ€è¦æ‰©å±•æ€§

âŒ ä¸é€‚åˆä½¿ç”¨äº‹ä»¶çš„åœºæ™¯ï¼š
â€¢ åŒæ­¥æµç¨‹ä¸”é¡ºåºä¸¥æ ¼
â€¢ æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
â€¢ ç®€å•çš„æ–¹æ³•è°ƒç”¨
â€¢ éœ€è¦äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ å®æˆ˜ç»éªŒæ€»ç»“**ï¼š

```
ğŸ“Š äº‹ä»¶å‘½åè§„èŒƒï¼š
åŠ¨ä½œ + å¯¹è±¡ + Event
â€¢ UserRegisteredEventï¼ˆç”¨æˆ·æ³¨å†Œäº‹ä»¶ï¼‰
â€¢ OrderCreatedEventï¼ˆè®¢å•åˆ›å»ºäº‹ä»¶ï¼‰
â€¢ PaymentSucceededEventï¼ˆæ”¯ä»˜æˆåŠŸäº‹ä»¶ï¼‰

ğŸ—ï¸ äº‹ä»¶å±‚æ¬¡è®¾è®¡ï¼š
åŸºç¡€äº‹ä»¶ç±»
â”œâ”€â”€ é¢†åŸŸäº‹ä»¶ç±»ï¼ˆå¦‚OrderEventï¼‰
â”‚   â”œâ”€â”€ OrderCreatedEvent
â”‚   â”œâ”€â”€ OrderPaidEvent
â”‚   â””â”€â”€ OrderShippedEvent
â””â”€â”€ ç³»ç»Ÿäº‹ä»¶ç±»ï¼ˆå¦‚SystemEventï¼‰
    â”œâ”€â”€ ApplicationStartedEvent
    â””â”€â”€ CacheRefreshedEvent

ğŸ“ åŒ…ç»“æ„ç»„ç»‡ï¼š
com.example
â”œâ”€â”€ event                    # äº‹ä»¶åŒ…
â”‚   â”œâ”€â”€ base                # åŸºç¡€äº‹ä»¶
â”‚   â”‚   â””â”€â”€ BaseEvent.java
â”‚   â”œâ”€â”€ user                # ç”¨æˆ·ç›¸å…³äº‹ä»¶
â”‚   â”‚   â”œâ”€â”€ UserRegisteredEvent.java
â”‚   â”‚   â””â”€â”€ UserLoginEvent.java
â”‚   â””â”€â”€ order               # è®¢å•ç›¸å…³äº‹ä»¶
â”‚       â”œâ”€â”€ OrderCreatedEvent.java
â”‚       â””â”€â”€ OrderPaidEvent.java
â””â”€â”€ listener                # ç›‘å¬å™¨åŒ…
```

**ğŸ› ï¸ å¼€å‘æ£€æŸ¥æ¸…å•**ï¼š
```
äº‹ä»¶å®šä¹‰æ£€æŸ¥ï¼š
â–¡ ç»§æ‰¿ApplicationEvent
â–¡ å­—æ®µä½¿ç”¨finalä¿®é¥°
â–¡ æä¾›å¿…è¦çš„æ„é€ å™¨
â–¡ æ·»åŠ ç‰ˆæœ¬å·å­—æ®µ
â–¡ æ”¯æŒåºåˆ—åŒ–ï¼ˆJSONï¼‰
â–¡ æ·»åŠ JavaDocæ³¨é‡Š
â–¡ æ˜ç¡®äº‹ä»¶çš„è§¦å‘æ—¶æœº

å…ƒæ•°æ®æ£€æŸ¥ï¼š
â–¡ äº‹ä»¶IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
â–¡ äº‹ä»¶æ—¶é—´æˆ³
â–¡ äº‹ä»¶ç‰ˆæœ¬å·
â–¡ è¿½è¸ªIDï¼ˆå¯é€‰ï¼‰
â–¡ ä¸šåŠ¡å…³è”ID

å…¼å®¹æ€§æ£€æŸ¥ï¼š
â–¡ æ–°å¢å­—æ®µæœ‰é»˜è®¤å€¼
â–¡ ä¸åˆ é™¤ç°æœ‰å­—æ®µ
â–¡ ä¸ä¿®æ”¹å­—æ®µç±»å‹
â–¡ ç‰ˆæœ¬å·æ­£ç¡®é€’å¢
```

### 8.4 è¿›é˜¶å­¦ä¹ æ–¹å‘


**ğŸš€ æ·±å…¥å­¦ä¹ è·¯å¾„**ï¼š
```
åŸºç¡€é˜¶æ®µï¼ˆå½“å‰ï¼‰ï¼š
âœ“ è‡ªå®šä¹‰äº‹ä»¶å®šä¹‰
âœ“ æ•°æ®å°è£…å’Œåºåˆ—åŒ–
âœ“ ç‰ˆæœ¬æ§åˆ¶åŸºç¡€

è¿›é˜¶é˜¶æ®µï¼š
â€¢ äº‹ä»¶ç›‘å¬å™¨å¼€å‘
â€¢ å¼‚æ­¥äº‹ä»¶å¤„ç†
â€¢ äº‹ä»¶ä¼ æ’­æœºåˆ¶
â€¢ äº‹ä»¶é¡ºåºæ§åˆ¶

é«˜çº§é˜¶æ®µï¼š
â€¢ åˆ†å¸ƒå¼äº‹ä»¶æ€»çº¿
â€¢ äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰
â€¢ CQRSæ¶æ„æ¨¡å¼
â€¢ äº‹ä»¶é©±åŠ¨å¾®æœåŠ¡
```

**ğŸ“š æ¨èå®è·µ**ï¼š
```
1. ä»ç®€å•äº‹ä»¶å¼€å§‹ï¼š
   â€¢ å®šä¹‰ç”¨æˆ·æ³¨å†Œäº‹ä»¶
   â€¢ å®ç°é‚®ä»¶é€šçŸ¥ç›‘å¬å™¨
   â€¢ è§‚å¯Ÿäº‹ä»¶æµè½¬è¿‡ç¨‹

2. é€æ­¥å¢åŠ å¤æ‚åº¦ï¼š
   â€¢ æ·»åŠ äº‹ä»¶å…ƒæ•°æ®
   â€¢ å®ç°å¤šç‰ˆæœ¬å…¼å®¹
   â€¢ é›†æˆæ¶ˆæ¯é˜Ÿåˆ—

3. å‚è€ƒå¼€æºé¡¹ç›®ï¼š
   â€¢ Spring Cloud Stream
   â€¢ Apache Kafka
   â€¢ Axon Framework
```

**ğŸ§  è®°å¿†è¦ç‚¹**ï¼š
- è‡ªå®šä¹‰äº‹ä»¶æ˜¯Springäº‹ä»¶æœºåˆ¶çš„åŸºç¡€ï¼Œç»§æ‰¿ApplicationEventæ˜¯ç¬¬ä¸€æ­¥
- æ•°æ®å°è£…è¦æœ€å°åŒ–ï¼Œä¸å¯å˜è®¾è®¡ä¿è¯çº¿ç¨‹å®‰å…¨
- äº‹ä»¶ç±»å‹æ ‡è¯†å¸®åŠ©ç»Ÿä¸€ç®¡ç†ç›¸ä¼¼äº‹ä»¶
- å…ƒæ•°æ®å¢å¼ºäº‹ä»¶çš„å¯è¿½è¸ªæ€§å’Œå¯ç»´æŠ¤æ€§  
- JSONåºåˆ—åŒ–æ˜¯é¦–é€‰ï¼Œä¾¿äºè°ƒè¯•å’Œè·¨è¯­è¨€é€šä¿¡
- ç‰ˆæœ¬æ§åˆ¶ä¿è¯äº‹ä»¶æ¼”è¿›çš„å…¼å®¹æ€§

**æ ¸å¿ƒç†å¿µ**ï¼šå¥½çš„äº‹ä»¶è®¾è®¡æ˜¯è§£è€¦ç³»ç»Ÿã€æå‡å¯ç»´æŠ¤æ€§çš„å…³é”®ã€‚ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥å®Œå–„ï¼Œåœ¨å®è·µä¸­ç†è§£äº‹ä»¶é©±åŠ¨æ¶æ„çš„ä»·å€¼ï¼