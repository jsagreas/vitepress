---
title: 8ã€ç»„ä»¶æ‰«æé…ç½®
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯ç»„ä»¶æ‰«æ](#1-ä»€ä¹ˆæ˜¯ç»„ä»¶æ‰«æ)
2. [åŒ…æ‰«æè·¯å¾„é…ç½®](#2-åŒ…æ‰«æè·¯å¾„é…ç½®)
3. [è¿‡æ»¤å™¨æœºåˆ¶è¯¦è§£](#3-è¿‡æ»¤å™¨æœºåˆ¶è¯¦è§£)
4. [è‡ªå®šä¹‰è¿‡æ»¤å™¨](#4-è‡ªå®šä¹‰è¿‡æ»¤å™¨)
5. [å…ƒæ³¨è§£ä¸å¤åˆæ³¨è§£](#5-å…ƒæ³¨è§£ä¸å¤åˆæ³¨è§£)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä»€ä¹ˆæ˜¯ç»„ä»¶æ‰«æ


### 1.1 é€šä¿—ç†è§£ç»„ä»¶æ‰«æ


**ğŸ¯ ç”Ÿæ´»ç±»æ¯”**ï¼šæƒ³è±¡Springæ˜¯ä¸€ä¸ªå…¬å¸çš„HRï¼Œç»„ä»¶æ‰«æå°±åƒHRåœ¨å…¬å¸å„ä¸ªéƒ¨é—¨æ‰¾å‘˜å·¥å»ºæ¡£æ¡ˆã€‚

```
å…¬å¸ç»“æ„                        Springé¡¹ç›®ç»“æ„
â”œâ”€â”€ æŠ€æœ¯éƒ¨/                     â”œâ”€â”€ com.example.service/
â”‚   â”œâ”€â”€ å¼ ä¸‰(ç¨‹åºå‘˜)            â”‚   â”œâ”€â”€ UserService(@Service)
â”‚   â””â”€â”€ æå››(æµ‹è¯•)              â”‚   â””â”€â”€ OrderService(@Service)
â”œâ”€â”€ è´¢åŠ¡éƒ¨/                     â”œâ”€â”€ com.example.controller/
â”‚   â””â”€â”€ ç‹äº”(ä¼šè®¡)              â”‚   â””â”€â”€ UserController(@Controller)
â””â”€â”€ äººäº‹éƒ¨/                     â””â”€â”€ com.example.dao/
    â””â”€â”€ èµµå…­(HR)                    â””â”€â”€ UserDao(@Repository)

HRçš„å·¥ä½œï¼šæ‰«ææ‰€æœ‰éƒ¨é—¨ï¼Œæ‰¾åˆ°éœ€è¦ç®¡ç†çš„å‘˜å·¥
Springçš„å·¥ä½œï¼šæ‰«ææŒ‡å®šåŒ…ï¼Œæ‰¾åˆ°éœ€è¦ç®¡ç†çš„ç»„ä»¶
```

### 1.2 æ ¸å¿ƒæ¦‚å¿µè§£é‡Š


**ç»„ä»¶ï¼ˆComponentï¼‰**ï¼šå°±æ˜¯Springè¦ç®¡ç†çš„å¯¹è±¡ï¼ˆBeanï¼‰
- `@Component`ï¼šé€šç”¨ç»„ä»¶æ ‡è®°
- `@Service`ï¼šä¸šåŠ¡é€»è¾‘å±‚ç»„ä»¶
- `@Controller`ï¼šæ§åˆ¶å±‚ç»„ä»¶
- `@Repository`ï¼šæ•°æ®è®¿é—®å±‚ç»„ä»¶

**æ‰«æï¼ˆScanï¼‰**ï¼šSpringè‡ªåŠ¨å»æŒ‡å®šçš„åŒ…é‡Œæ‰¾å¸¦æ³¨è§£çš„ç±»
- ä¸ç”¨æ‰‹åŠ¨æ³¨å†Œæ¯ä¸ªBean
- è‡ªåŠ¨å‘ç°å¹¶åˆ›å»ºå¯¹è±¡
- è®©é…ç½®å˜å¾—ç®€å•

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦ç»„ä»¶æ‰«æ


**âŒ æ²¡æœ‰ç»„ä»¶æ‰«æï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰**ï¼š
```xml
<!-- æ¯ä¸ªBeanéƒ½è¦æ‰‹åŠ¨é…ç½®ï¼Œå¤ªéº»çƒ¦äº†ï¼ -->
<bean id="userService" class="com.example.service.UserService"/>
<bean id="orderService" class="com.example.service.OrderService"/>
<bean id="userController" class="com.example.controller.UserController"/>
<!-- 100ä¸ªç±»å°±è¦å†™100ä¸ªbeanæ ‡ç­¾... -->
```

**âœ… æœ‰äº†ç»„ä»¶æ‰«æ**ï¼š
```java
// åªéœ€è¦ä¸€è¡Œé…ç½®
@ComponentScan("com.example")

// ç±»ä¸ŠåŠ ä¸ªæ³¨è§£å°±è¡Œ
@Service
public class UserService {
    // Springè‡ªåŠ¨å‘ç°å¹¶ç®¡ç†
}
```

**ğŸ¯ å¥½å¤„ä¸€ç›®äº†ç„¶**ï¼š
- å‡å°‘é…ç½®ä»£ç é‡ï¼ˆ100ä¸ªç±»åªéœ€1è¡Œé…ç½®ï¼‰
- è‡ªåŠ¨å‘ç°æ–°å¢çš„ç»„ä»¶
- ä»£ç æ›´ç®€æ´æ˜“ç»´æŠ¤

---

## 2. ğŸ“‚ åŒ…æ‰«æè·¯å¾„é…ç½®


### 2.1 åŸºç¡€æ‰«æé…ç½®


**ğŸ”¸ å•ä¸ªåŒ…æ‰«æ**
```java
// æ–¹å¼1ï¼šæ³¨è§£é…ç½®ï¼ˆæ¨èï¼‰
@Configuration
@ComponentScan("com.example.service")
public class AppConfig {
    // æ‰«æcom.example.serviceåŒ…ä¸‹æ‰€æœ‰ç»„ä»¶
}
```

```xml
<!-- æ–¹å¼2ï¼šXMLé…ç½® -->
<context:component-scan base-package="com.example.service"/>
```

**ğŸ’¡ æ‰«æè§„åˆ™**ï¼š
- æ‰«ææŒ‡å®šåŒ…åŠå…¶**æ‰€æœ‰å­åŒ…**
- ä¾‹å¦‚ï¼š`com.example.service`ä¼šæ‰«æ
  - `com.example.service.UserService`
  - `com.example.service.impl.UserServiceImpl`
  - `com.example.service.sub.OrderService`

### 2.2 å¤šåŒ…æ‰«æé…ç½®


**åœºæ™¯**ï¼šé¡¹ç›®ç»“æ„å¤æ‚ï¼Œç»„ä»¶åˆ†æ•£åœ¨ä¸åŒåŒ…ä¸­

```
é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š
com.example
â”œâ”€â”€ service/        (ä¸šåŠ¡å±‚)
â”œâ”€â”€ controller/     (æ§åˆ¶å±‚)  
â”œâ”€â”€ dao/           (æ•°æ®å±‚)
â””â”€â”€ util/          (å·¥å…·ç±»ï¼Œä¸éœ€è¦æ‰«æ)
```

**ğŸ”¸ æ–¹å¼1ï¼šæ•°ç»„å½¢å¼ï¼ˆæ¨èï¼‰**
```java
@ComponentScan(basePackages = {
    "com.example.service",
    "com.example.controller",
    "com.example.dao"
})
```

**ğŸ”¸ æ–¹å¼2ï¼šé€—å·åˆ†éš”**
```java
@ComponentScan("com.example.service,com.example.controller,com.example.dao")
```

**ğŸ”¸ æ–¹å¼3ï¼šçˆ¶åŒ…æ‰«æï¼ˆç®€å•ä½†ä¸å¤Ÿç²¾ç¡®ï¼‰**
```java
// æ‰«æcom.exampleä¸‹æ‰€æœ‰å­åŒ…ï¼ˆåŒ…æ‹¬ä¸éœ€è¦çš„utilï¼‰
@ComponentScan("com.example")
```

### 2.3 ç±»å‹å®‰å…¨çš„åŒ…æ‰«æ


**é—®é¢˜**ï¼šå­—ç¬¦ä¸²é…ç½®å®¹æ˜“å†™é”™ï¼Œé‡æ„æ—¶ä¸æ˜“ç»´æŠ¤

**è§£å†³**ï¼šä½¿ç”¨ç±»æ¥æŒ‡å®šåŒ…è·¯å¾„

```java
// å®šä¹‰åŒ…æ ‡è®°ç±»
package com.example.service;
public interface ServicePackage {}

package com.example.controller;
public interface ControllerPackage {}

// é…ç½®æ‰«æ
@ComponentScan(basePackageClasses = {
    ServicePackage.class,    // æ‰«æserviceåŒ…
    ControllerPackage.class  // æ‰«æcontrolleråŒ…
})
```

**ğŸ¯ ä¼˜åŠ¿**ï¼š
- IDEé‡æ„æ—¶è‡ªåŠ¨æ›´æ–°
- ç¼–è¯‘æœŸæ£€æŸ¥ï¼Œé¿å…æ‹¼å†™é”™è¯¯
- æ›´åŠ ç±»å‹å®‰å…¨

### 2.4 æ‰«æè·¯å¾„é€‰æ‹©ç­–ç•¥


| æ‰«ææ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---------|---------|------|------|
| **çˆ¶åŒ…æ‰«æ** | å°å‹é¡¹ç›® | é…ç½®ç®€å• | å¯èƒ½æ‰«æå¤šä½™ç±» |
| **å¤šåŒ…æ‰«æ** | ä¸­å¤§å‹é¡¹ç›® | ç²¾ç¡®æ§åˆ¶ | é…ç½®ç¨å¤æ‚ |
| **ç±»å‹æ‰«æ** | ä¼ä¸šçº§é¡¹ç›® | é‡æ„å®‰å…¨ | éœ€é¢å¤–å®šä¹‰æ ‡è®°ç±» |

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼š
```java
// æ¨èï¼šç»“åˆç±»å‹å®‰å…¨ + å¤šåŒ…æ‰«æ
@ComponentScan(
    basePackageClasses = {
        ServicePackage.class,
        ControllerPackage.class
    },
    // ä¹Ÿå¯ä»¥æ··åˆä½¿ç”¨
    basePackages = "com.example.external"
)
```

---

## 3. ğŸ¯ è¿‡æ»¤å™¨æœºåˆ¶è¯¦è§£


### 3.1 è¿‡æ»¤å™¨çš„ä½œç”¨


**ç±»æ¯”ç†è§£**ï¼šè¿‡æ»¤å™¨å°±åƒé—¨å«ï¼Œå†³å®šè°èƒ½è¿›ã€è°ä¸èƒ½è¿›

```
åŒ…æ‰«æè¿‡ç¨‹ï¼š
          æ‰«æåŒ…
             â†“
    [æ‰¾åˆ°æ‰€æœ‰ç±»]
             â†“
      åº”ç”¨è¿‡æ»¤è§„åˆ™
       â†™          â†˜
 Includeè¿‡æ»¤å™¨    Excludeè¿‡æ»¤å™¨
 ï¼ˆåŒ…å«è§„åˆ™ï¼‰     ï¼ˆæ’é™¤è§„åˆ™ï¼‰
       â†“              â†“
    å…è®¸è¿›å…¥        æ‹’ç»è¿›å…¥
             â†“
        æœ€ç»ˆBeané›†åˆ
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **Includeè¿‡æ»¤å™¨**ï¼šé¢å¤–åŒ…å«æŸäº›ç±»ï¼ˆé»˜è®¤ä¸æ‰«æçš„ä¹Ÿè¦æ‰«æï¼‰
- **Excludeè¿‡æ»¤å™¨**ï¼šæ’é™¤æŸäº›ç±»ï¼ˆé»˜è®¤è¦æ‰«æçš„ä¹Ÿä¸æ‰«æï¼‰
- **ä¼˜å…ˆçº§**ï¼šExclude > Includeï¼ˆæ’é™¤ä¼˜å…ˆäºåŒ…å«ï¼‰

### 3.2 Includeè¿‡æ»¤å™¨ï¼ˆåŒ…å«è§„åˆ™ï¼‰


**ğŸ”¸ åœºæ™¯1ï¼šåŒ…å«ç‰¹å®šæ³¨è§£çš„ç±»**
```java
@ComponentScan(
    basePackages = "com.example",
    // ä½¿ç”¨é»˜è®¤è¿‡æ»¤è§„åˆ™
    useDefaultFilters = false,  // å…³é—­é»˜è®¤è§„åˆ™
    includeFilters = @ComponentScan.Filter(
        type = FilterType.ANNOTATION,
        classes = MyCustomAnnotation.class  // åªåŒ…å«è¿™ä¸ªæ³¨è§£çš„ç±»
    )
)
```

**è§£é‡Š**ï¼š
- `useDefaultFilters = false`ï¼šé»˜è®¤Springä¼šæ‰«æ@Componentç­‰æ³¨è§£ï¼Œè¿™é‡Œå…³é—­
- åªæœ‰å¸¦`@MyCustomAnnotation`çš„ç±»æ‰ä¼šè¢«æ³¨å†Œ

**ğŸ”¸ åœºæ™¯2ï¼šåŒ…å«ç‰¹å®šç±»å‹çš„ç±»**
```java
@ComponentScan(
    basePackages = "com.example",
    includeFilters = @ComponentScan.Filter(
        type = FilterType.ASSIGNABLE_TYPE,
        classes = BaseService.class  // åŒ…å«BaseServiceåŠå…¶å­ç±»
    )
)
```

**å®é™…ä¾‹å­**ï¼š
```java
// BaseServiceæ¥å£
public interface BaseService {}

// è¿™äº›ç±»ä¼šè¢«æ‰«æåˆ°
@Service
public class UserService implements BaseService {}

@Service  
public class OrderService implements BaseService {}

// è¿™ä¸ªç±»ä¸ä¼šè¢«æ‰«æï¼ˆæ²¡å®ç°BaseServiceï¼‰
@Service
public class LogService {}
```

### 3.3 Excludeè¿‡æ»¤å™¨ï¼ˆæ’é™¤è§„åˆ™ï¼‰


**ğŸ”¸ åœºæ™¯1ï¼šæ’é™¤æµ‹è¯•ç±»**
```java
@ComponentScan(
    basePackages = "com.example",
    excludeFilters = @ComponentScan.Filter(
        type = FilterType.REGEX,
        pattern = ".*Test"  // æ’é™¤æ‰€æœ‰ä»¥Testç»“å°¾çš„ç±»
    )
)
```

**ğŸ”¸ åœºæ™¯2ï¼šæ’é™¤ç‰¹å®šæ³¨è§£**
```java
@ComponentScan(
    basePackages = "com.example",
    excludeFilters = @ComponentScan.Filter(
        type = FilterType.ANNOTATION,
        classes = {Deprecated.class, Internal.class}
    )
)
```

**å®é™…æ•ˆæœ**ï¼š
```java
@Service
@Deprecated  // è¿™ä¸ªç±»ä¼šè¢«æ’é™¤
public class OldUserService {}

@Service  // è¿™ä¸ªæ­£å¸¸æ‰«æ
public class NewUserService {}
```

### 3.4 è¿‡æ»¤å™¨ç±»å‹è¯¦è§£


**ğŸ“‹ FilterTypeæšä¸¾å€¼**

| ç±»å‹ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|------|---------|------|
| **ANNOTATION** | æŒ‰æ³¨è§£è¿‡æ»¤ | æœ€å¸¸ç”¨ï¼ŒæŒ‰æ³¨è§£ç­›é€‰ | `@Service`ã€`@MyAnnotation` |
| **ASSIGNABLE_TYPE** | æŒ‰ç±»å‹è¿‡æ»¤ | ç­›é€‰ç‰¹å®šç±»åŠå­ç±» | `BaseService.class` |
| **REGEX** | æ­£åˆ™è¡¨è¾¾å¼ | æŒ‰ç±»åæ¨¡å¼ç­›é€‰ | `.*Service$` |
| **ASPECTJ** | AspectJè¡¨è¾¾å¼ | å¤æ‚åŒ¹é…è§„åˆ™ | `com.example..*Service+` |
| **CUSTOM** | è‡ªå®šä¹‰è¿‡æ»¤å™¨ | å¤æ‚ä¸šåŠ¡é€»è¾‘ | è§åç»­ç« èŠ‚ |

### 3.5 ç»„åˆè¿‡æ»¤å™¨


**å¤šä¸ªè¿‡æ»¤å™¨åŒæ—¶ä½¿ç”¨**ï¼š
```java
@ComponentScan(
    basePackages = "com.example",
    includeFilters = {
        @ComponentScan.Filter(
            type = FilterType.ANNOTATION,
            classes = MyService.class
        ),
        @ComponentScan.Filter(
            type = FilterType.REGEX,
            pattern = ".*Important.*"
        )
    },
    excludeFilters = {
        @ComponentScan.Filter(
            type = FilterType.ANNOTATION,
            classes = Deprecated.class
        )
    }
)
```

**æ‰§è¡Œé€»è¾‘**ï¼š
```
1. æ‰«æcom.exampleåŒ…ä¸‹æ‰€æœ‰ç±»
2. åº”ç”¨Includeè§„åˆ™ï¼š
   - åŒ…å«@MyServiceæ³¨è§£çš„ç±»
   - åŒ…å«ç±»åä¸­å¸¦"Important"çš„ç±»
3. åº”ç”¨Excludeè§„åˆ™ï¼š
   - æ’é™¤@Deprecatedæ³¨è§£çš„ç±»ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
4. æœ€ç»ˆç»“æœ = (é»˜è®¤æ‰«æ + Include) - Exclude
```

---

## 4. ğŸ› ï¸ è‡ªå®šä¹‰è¿‡æ»¤å™¨


### 4.1 ä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤å™¨


**å†…ç½®è¿‡æ»¤å™¨ä¸å¤Ÿç”¨çš„åœºæ™¯**ï¼š
- æ ¹æ®ç±»åå‰ç¼€/åç¼€è¿‡æ»¤ï¼ˆæ¯”æ­£åˆ™æ›´çµæ´»ï¼‰
- æ ¹æ®ç±»çš„å±æ€§ï¼ˆä¿®é¥°ç¬¦ã€çˆ¶ç±»ã€æ¥å£ï¼‰è¿‡æ»¤
- æ ¹æ®é…ç½®æ–‡ä»¶åŠ¨æ€å†³å®šæ˜¯å¦æ‰«æ
- å¤æ‚çš„ä¸šåŠ¡é€»è¾‘åˆ¤æ–­

### 4.2 è‡ªå®šä¹‰è¿‡æ»¤å™¨å®ç°


**æ­¥éª¤1ï¼šå®ç°TypeFilteræ¥å£**
```java
public class MyCustomFilter implements TypeFilter {
    
    @Override
    public boolean match(
        MetadataReader metadataReader,  // ç±»çš„å…ƒæ•°æ®è¯»å–å™¨
        MetadataReaderFactory readerFactory  // å·¥å‚ç±»
    ) throws IOException {
        
        // è·å–ç±»çš„å…ƒæ•°æ®ä¿¡æ¯
        ClassMetadata classMetadata = metadataReader.getClassMetadata();
        
        // è·å–ç±»å
        String className = classMetadata.getClassName();
        
        // è‡ªå®šä¹‰è¿‡æ»¤é€»è¾‘
        // ä¾‹ï¼šåªæ‰«æç±»ååŒ…å«"Important"çš„ç±»
        return className.contains("Important");
    }
}
```

**æ­¥éª¤2ï¼šä½¿ç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨**
```java
@ComponentScan(
    basePackages = "com.example",
    includeFilters = @ComponentScan.Filter(
        type = FilterType.CUSTOM,
        classes = MyCustomFilter.class
    )
)
```

### 4.3 MetadataReaderè¯¦è§£


**MetadataReaderèƒ½è·å–ä»€ä¹ˆä¿¡æ¯ï¼Ÿ**

```java
public boolean match(MetadataReader reader, ...) {
    
    // 1. ç±»çš„åŸºæœ¬ä¿¡æ¯
    ClassMetadata classMetadata = reader.getClassMetadata();
    String className = classMetadata.getClassName();  // å®Œæ•´ç±»å
    String simpleName = classMetadata.getClassName()
                         .substring(className.lastIndexOf('.') + 1);  // ç®€å•ç±»å
    
    // 2. ç±»çš„æ³¨è§£ä¿¡æ¯
    AnnotationMetadata annoMetadata = reader.getAnnotationMetadata();
    Set<String> annotations = annoMetadata.getAnnotationTypes();  // æ‰€æœ‰æ³¨è§£
    boolean hasService = annoMetadata.hasAnnotation("org.springframework.stereotype.Service");
    
    // 3. åˆ¤æ–­ç±»çš„ç‰¹æ€§
    boolean isInterface = classMetadata.isInterface();
    boolean isAbstract = classMetadata.isAbstract();
    boolean isFinal = classMetadata.isFinal();
    
    return /* ä½ çš„é€»è¾‘ */;
}
```

### 4.4 å®ç”¨è¿‡æ»¤å™¨ç¤ºä¾‹


**ç¤ºä¾‹1ï¼šåªæ‰«æå…¬å…±ç±»**
```java
public class PublicClassFilter implements TypeFilter {
    
    @Override
    public boolean match(MetadataReader reader, ...) {
        ClassMetadata metadata = reader.getClassMetadata();
        
        // æ’é™¤æ¥å£å’ŒæŠ½è±¡ç±»
        if (metadata.isInterface() || metadata.isAbstract()) {
            return false;
        }
        
        // åªè¦å…·ä½“çš„ç±»
        return true;
    }
}
```

**ç¤ºä¾‹2ï¼šæŒ‰åŒ…åæ·±åº¦è¿‡æ»¤**
```java
public class PackageDepthFilter implements TypeFilter {
    
    private int maxDepth = 3;  // æœ€å¤š3å±‚åŒ…
    
    @Override
    public boolean match(MetadataReader reader, ...) {
        String className = reader.getClassMetadata().getClassName();
        
        // è®¡ç®—åŒ…çš„å±‚çº§
        int depth = className.split("\\.").length;
        
        return depth <= maxDepth;
    }
}
```

**ç¤ºä¾‹3ï¼šåŠ¨æ€é…ç½®è¿‡æ»¤**
```java
public class ConfigurableFilter implements TypeFilter {
    
    @Value("${scan.include.pattern}")
    private String includePattern;  // ä»é…ç½®æ–‡ä»¶è¯»å–
    
    @Override
    public boolean match(MetadataReader reader, ...) {
        String className = reader.getClassMetadata().getClassName();
        return className.matches(includePattern);
    }
}
```

### 4.5 è¿‡æ»¤å™¨æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
```java
// 1. è¿‡æ»¤é€»è¾‘æ¸…æ™°
public class ClearLogicFilter implements TypeFilter {
    
    @Override
    public boolean match(MetadataReader reader, ...) {
        String className = reader.getClassMetadata().getClassName();
        
        // é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
        boolean isService = className.endsWith("Service");
        boolean notTest = !className.contains("Test");
        
        return isService && notTest;
    }
}

// 2. æ”¯æŒé…ç½®åŒ–
public class ConfigurableFilter implements TypeFilter {
    
    private final String pattern;
    
    public ConfigurableFilter(String pattern) {
        this.pattern = pattern;
    }
    
    // å¯ä»¥åœ¨ä½¿ç”¨æ—¶ä¼ å…¥ä¸åŒå‚æ•°
}
```

**âŒ é¿å…çš„åšæ³•**ï¼š
```java
// ä¸è¦å†™è¿‡äºå¤æ‚çš„é€»è¾‘
public boolean match(MetadataReader reader, ...) {
    // 100è¡Œå¤æ‚åˆ¤æ–­...
    // éš¾ä»¥ç»´æŠ¤å’Œç†è§£
}

// ä¸è¦åœ¨è¿‡æ»¤å™¨ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
public boolean match(MetadataReader reader, ...) {
    // âŒ æ•°æ®åº“æŸ¥è¯¢
    // âŒ ç½‘ç»œè¯·æ±‚
    // âŒ æ–‡ä»¶IO
}
```

---

## 5. ğŸ·ï¸ å…ƒæ³¨è§£ä¸å¤åˆæ³¨è§£


### 5.1 å…ƒæ³¨è§£åŸºç¡€æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å…ƒæ³¨è§£ï¼Ÿ**

é€šä¿—è®²ï¼š**æ³¨è§£çš„æ³¨è§£**ï¼Œç”¨æ¥å®šä¹‰å…¶ä»–æ³¨è§£çš„æ³¨è§£

```
ç±»æ¯”ç†è§£ï¼š
äº§å“ â† äº§å“è¯´æ˜ä¹¦ â† è¯´æ˜ä¹¦ç¼–å†™è§„èŒƒ
ç±»   â†   æ³¨è§£      â†    å…ƒæ³¨è§£

å…ƒæ³¨è§£å®šä¹‰äº†æ³¨è§£çš„è¡Œä¸ºè§„åˆ™
```

**Springçš„æ ¸å¿ƒå…ƒæ³¨è§£**ï¼š

| å…ƒæ³¨è§£ | ä½œç”¨ | ç¤ºä¾‹ |
|--------|------|------|
| `@Target` | æ³¨è§£èƒ½ç”¨åœ¨å“ªé‡Œ | ç±»ã€æ–¹æ³•ã€å­—æ®µ |
| `@Retention` | æ³¨è§£ä¿ç•™åˆ°ä»€ä¹ˆæ—¶å€™ | æºç ã€ç¼–è¯‘ã€è¿è¡Œæ—¶ |
| `@Documented` | æ˜¯å¦åœ¨JavaDocä¸­æ˜¾ç¤º | æ–‡æ¡£ç”Ÿæˆ |
| `@Inherited` | å­ç±»æ˜¯å¦ç»§æ‰¿è¯¥æ³¨è§£ | ç»§æ‰¿ä¼ é€’ |

### 5.2 Springç»„ä»¶æ³¨è§£çš„å…ƒæ³¨è§£ç»“æ„


**@Serviceæ³¨è§£çš„å†…éƒ¨ç»“æ„**ï¼š
```java
@Target(ElementType.TYPE)           // åªèƒ½ç”¨åœ¨ç±»ä¸Š
@Retention(RetentionPolicy.RUNTIME) // è¿è¡Œæ—¶ä¿ç•™
@Documented                         // ç”Ÿæˆæ–‡æ¡£
@Component  // â­æ ¸å¿ƒï¼š@Serviceæœ¬è´¨æ˜¯@Component
public @interface Service {
    String value() default "";
}
```

**ç†è§£é‡ç‚¹**ï¼š
- `@Service`ä¸Šæ ‡æ³¨äº†`@Component`
- Springæ‰«ææ—¶ä¼šè¯†åˆ«`@Component`åŠå…¶æ´¾ç”Ÿæ³¨è§£
- æ‰€ä»¥`@Service`ã€`@Controller`ã€`@Repository`éƒ½èƒ½è¢«æ‰«æåˆ°

**å±‚çº§å…³ç³»å›¾**ï¼š
```
         @Component (æ ¹æ³¨è§£)
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“         â†“         â†“
@Service  @Controller  @Repository
    â†“
@MyService (è‡ªå®šä¹‰æ³¨è§£)
```

### 5.3 å¤åˆæ³¨è§£è¯¦è§£


**ä»€ä¹ˆæ˜¯å¤åˆæ³¨è§£ï¼Ÿ**

æŠŠå¤šä¸ªæ³¨è§£çš„åŠŸèƒ½ç»„åˆåˆ°ä¸€ä¸ªæ³¨è§£ä¸­ï¼Œç®€åŒ–é…ç½®

**ğŸ”¸ åœºæ™¯ï¼šRESTæ§åˆ¶å™¨çš„é‡å¤é…ç½®**
```java
// ä¼ ç»Ÿå†™æ³•ï¼šæ¯ä¸ªæ§åˆ¶å™¨éƒ½è¦å†™3ä¸ªæ³¨è§£
@Controller
@ResponseBody
@RequestMapping("/api")
public class UserController {}

@Controller
@ResponseBody  
@RequestMapping("/api")
public class OrderController {}
```

**ğŸ”¸ ä½¿ç”¨å¤åˆæ³¨è§£ç®€åŒ–**
```java
// 1. å®šä¹‰å¤åˆæ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Controller      // åŒ…å«Controller
@ResponseBody    // åŒ…å«ResponseBody
@RequestMapping("/api")  // åŒ…å«å…¬å…±è·¯å¾„
public @interface RestApiController {
    String value() default "";  // å¯ä»¥ä¼ å‚æ•°
}

// 2. ä½¿ç”¨å¤åˆæ³¨è§£ï¼ˆç®€æ´å¤šäº†ï¼ï¼‰
@RestApiController
public class UserController {}

@RestApiController
public class OrderController {}
```

### 5.4 è‡ªå®šä¹‰ç»„ä»¶æ³¨è§£


**å®æˆ˜åœºæ™¯ï¼šæ ‡è®°ä¸šåŠ¡Service**

```java
// 1. å®šä¹‰è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Service  // â­ç»§æ‰¿@Serviceçš„åŠŸèƒ½
@Transactional  // â­è‡ªåŠ¨æ·»åŠ äº‹åŠ¡
public @interface BusinessService {
    
    String value() default "";  // Beanåç§°
    
    String module() default "";  // æ‰€å±æ¨¡å—
}

// 2. ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£
@BusinessService(module = "ç”¨æˆ·ç®¡ç†")
public class UserService {
    // è‡ªåŠ¨å˜æˆSpring Bean
    // è‡ªåŠ¨æ·»åŠ äº‹åŠ¡ç®¡ç†
}
```

### 5.5 å…ƒæ³¨è§£æ”¯æŒçš„æ‰«æé…ç½®


**Springå¦‚ä½•è¯†åˆ«å¤åˆæ³¨è§£ï¼Ÿ**

```java
@ComponentScan(
    basePackages = "com.example",
    includeFilters = @ComponentScan.Filter(
        type = FilterType.ANNOTATION,
        classes = BusinessService.class  // ä¼šæ‰«æå¸¦@BusinessServiceçš„ç±»
    )
)
```

**åŸç†è§£æ**ï¼š
```
æ‰«æè¿‡ç¨‹ï¼š
1. Springæ‰¾åˆ°UserServiceç±»
2. æ£€æŸ¥ç±»ä¸Šçš„æ³¨è§£ï¼š@BusinessService
3. æ£€æŸ¥@BusinessServiceä¸Šçš„å…ƒæ³¨è§£ï¼šå‘ç°@Service
4. @Serviceä¸Šæœ‰@Component
5. ç¡®è®¤è¿™æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œçº³å…¥å®¹å™¨ç®¡ç†

å…ƒæ³¨è§£æ”¯æŒ = Springä¼šé€’å½’æ£€æŸ¥æ³¨è§£çš„æ³¨è§£
```

### 5.6 å¤åˆæ³¨è§£çš„å®ç”¨æ¨¡å¼


**æ¨¡å¼1ï¼šåˆ†å±‚æ³¨è§£**
```java
// æ•°æ®è®¿é—®å±‚
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Repository
@Transactional(readOnly = true)  // åªè¯»äº‹åŠ¡
public @interface DataAccess {
    String value() default "";
}

// ä¸šåŠ¡é€»è¾‘å±‚
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Service
@Transactional  // è¯»å†™äº‹åŠ¡
public @interface BusinessLogic {
    String value() default "";
}
```

**æ¨¡å¼2ï¼šåŠŸèƒ½ç»„åˆæ³¨è§£**
```java
// å®šæ—¶ä»»åŠ¡Service
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Service
@EnableScheduling  // å¯ç”¨å®šæ—¶ä»»åŠ¡
public @interface ScheduledService {
    String value() default "";
}

// ä½¿ç”¨
@ScheduledService
public class DataSyncService {
    
    @Scheduled(cron = "0 0 2 * * ?")
    public void syncData() {
        // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    }
}
```

**æ¨¡å¼3ï¼šå¸¦å‚æ•°çš„å¤åˆæ³¨è§£**
```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Service
public @interface CachedService {
    
    String value() default "";
    
    // ç¼“å­˜é…ç½®
    String cacheName() default "";
    int expireMinutes() default 30;
}

// ä½¿ç”¨
@CachedService(
    cacheName = "userCache",
    expireMinutes = 60
)
public class UserService {}
```

### 5.7 å…ƒæ³¨è§£æœ€ä½³å®è·µ


**âœ… æ¨èåšæ³•**ï¼š
```java
// 1. æ¸…æ™°çš„å‘½å
@BusinessService  // âœ… ä¸€çœ‹å°±çŸ¥é“æ˜¯ä¸šåŠ¡å±‚
@DataRepository   // âœ… ä¸€çœ‹å°±çŸ¥é“æ˜¯æ•°æ®å±‚

// 2. åˆç†çš„ç»§æ‰¿å±‚æ¬¡ï¼ˆä¸è¶…è¿‡3å±‚ï¼‰
@Component
  â””â”€â”€ @Service
        â””â”€â”€ @BusinessService  // âœ… æœ€å¤š3å±‚

// 3. æä¾›æ–‡æ¡£è¯´æ˜
/**
 * ä¸šåŠ¡æœåŠ¡å±‚æ³¨è§£
 * è‡ªåŠ¨æ·»åŠ äº‹åŠ¡ç®¡ç†å’Œæ—¥å¿—è®°å½•
 */
@BusinessService
```

**âŒ é¿å…çš„åšæ³•**ï¼š
```java
// 1. è¿‡æ·±çš„ç»§æ‰¿
@Component
  â””â”€â”€ @Service
        â””â”€â”€ @BusinessService
              â””â”€â”€ @UserBusinessService
                    â””â”€â”€ @VipUserBusinessService  // âŒ å¤ªæ·±äº†

// 2. å¾ªç¯ä¾èµ–
@Aæ³¨è§£ä¸Šæ ‡æ³¨@B
@Bæ³¨è§£ä¸Šæ ‡æ³¨@A  // âŒ å¾ªç¯äº†

// 3. åŠŸèƒ½å †ç Œ
@Service
@Transactional
@Async
@Scheduled
@Cacheable
// âŒ ä¸€ä¸ªæ³¨è§£ä¸è¦åŒ…å«å¤ªå¤šåŠŸèƒ½
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 ç»„ä»¶æ‰«ææ ¸å¿ƒçŸ¥è¯†


```
ğŸ”¸ ç»„ä»¶æ‰«ææœ¬è´¨ï¼šè‡ªåŠ¨å‘ç°å¹¶æ³¨å†ŒSpring Bean
ğŸ”¸ åŒ…æ‰«æè·¯å¾„ï¼šå¯å•ä¸ªã€å¤šä¸ªã€ç±»å‹å®‰å…¨é…ç½®
ğŸ”¸ è¿‡æ»¤å™¨æœºåˆ¶ï¼šIncludeåŒ…å«ã€Excludeæ’é™¤
ğŸ”¸ è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼šå®ç°TypeFilteræ¥å£
ğŸ”¸ å…ƒæ³¨è§£ï¼šæ³¨è§£çš„æ³¨è§£ï¼Œå®šä¹‰æ³¨è§£è¡Œä¸º
ğŸ”¸ å¤åˆæ³¨è§£ï¼šç»„åˆå¤šä¸ªæ³¨è§£çš„åŠŸèƒ½
```

### 6.2 é…ç½®é€‰æ‹©æŒ‡å—


| åœºæ™¯ | æ¨èé…ç½® | ç†ç”± |
|------|---------|------|
| å°å‹é¡¹ç›® | å•ä¸ªçˆ¶åŒ…æ‰«æ | ç®€å•ç›´æ¥ |
| ä¸­å‹é¡¹ç›® | å¤šåŒ…æ‰«æ | ç²¾ç¡®æ§åˆ¶ |
| å¤§å‹é¡¹ç›® | ç±»å‹å®‰å…¨æ‰«æ | é‡æ„å‹å¥½ |
| ç‰¹æ®Šéœ€æ±‚ | è‡ªå®šä¹‰è¿‡æ»¤å™¨ | çµæ´»å®šåˆ¶ |

### 6.3 å®ç”¨æŠ€å·§æ€»ç»“


**ğŸ’¡ æŠ€å·§1ï¼šæ’é™¤æµ‹è¯•ç±»**
```java
@ComponentScan(
    basePackages = "com.example",
    excludeFilters = @ComponentScan.Filter(
        type = FilterType.REGEX,
        pattern = ".*Test"
    )
)
```

**ğŸ’¡ æŠ€å·§2ï¼šåªæ‰«æç‰¹å®šå±‚çº§**
```java
@ComponentScan(
    basePackages = "com.example",
    includeFilters = @ComponentScan.Filter(
        type = FilterType.ASSIGNABLE_TYPE,
        classes = {
            BaseService.class,
            BaseController.class
        }
    )
)
```

**ğŸ’¡ æŠ€å·§3ï¼šè‡ªå®šä¹‰ä¸šåŠ¡æ³¨è§£**
```java
@Service
@Transactional
public @interface MyBusinessService {
    // ä¸€ä¸ªæ³¨è§£æå®šService + äº‹åŠ¡
}
```

### 6.4 å¸¸è§é—®é¢˜FAQ


**Q1ï¼šä¸ºä»€ä¹ˆé…ç½®äº†æ‰«æä½†Beanæ²¡æ³¨å†Œï¼Ÿ**
- æ£€æŸ¥åŒ…è·¯å¾„æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ç±»ä¸Šæ˜¯å¦æœ‰ç»„ä»¶æ³¨è§£
- æ£€æŸ¥æ˜¯å¦è¢«Excludeè¿‡æ»¤å™¨æ’é™¤

**Q2ï¼šIncludeå’ŒExcludeåŒæ—¶é…ç½®æ€ä¹ˆåŠï¼Ÿ**
- Excludeä¼˜å…ˆçº§æ›´é«˜
- å³ä½¿IncludeåŒ…å«ï¼ŒExcludeæ’é™¤çš„ä¹Ÿä¸ä¼šæ³¨å†Œ

**Q3ï¼šè‡ªå®šä¹‰æ³¨è§£å¿…é¡»ç»§æ‰¿@Componentå—ï¼Ÿ**
- æ˜¯çš„ï¼Œç›´æ¥æˆ–é—´æ¥ç»§æ‰¿@Component
- æˆ–è€…é€šè¿‡è¿‡æ»¤å™¨æ˜¾å¼åŒ…å«

### 6.5 å­¦ä¹ æ£€æŸ¥æ¸…å•


- â˜‘ ç†è§£ç»„ä»¶æ‰«æçš„ä½œç”¨å’ŒåŸç†
- â˜‘ æŒæ¡åŒ…æ‰«æè·¯å¾„çš„ä¸‰ç§é…ç½®æ–¹å¼
- â˜‘ ä¼šä½¿ç”¨Includeå’ŒExcludeè¿‡æ»¤å™¨
- â˜‘ èƒ½å®ç°è‡ªå®šä¹‰TypeFilter
- â˜‘ ç†è§£å…ƒæ³¨è§£å’Œå¤åˆæ³¨è§£çš„æ¦‚å¿µ
- â˜‘ èƒ½å®šä¹‰è‡ªå·±çš„ä¸šåŠ¡æ³¨è§£

**ğŸ¯ æ ¸å¿ƒç†è§£**ï¼š
- ç»„ä»¶æ‰«ææ˜¯Springè‡ªåŠ¨åŒ–é…ç½®çš„åŸºç¡€
- è¿‡æ»¤å™¨æä¾›ç²¾ç¡®çš„æ‰«ææ§åˆ¶
- å¤åˆæ³¨è§£ç®€åŒ–é‡å¤é…ç½®
- åˆç†ä½¿ç”¨æ³¨è§£è®©ä»£ç æ›´ç®€æ´ä¼˜é›…