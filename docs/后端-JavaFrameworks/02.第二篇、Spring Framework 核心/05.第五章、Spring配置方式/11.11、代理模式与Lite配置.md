---
title: 11ã€ä»£ç†æ¨¡å¼ä¸Liteé…ç½®
---
## ğŸ“š ç›®å½•

1. [é…ç½®ç±»çš„ä¸¤ç§æ¨¡å¼](#1-é…ç½®ç±»çš„ä¸¤ç§æ¨¡å¼)
2. [proxyBeanMethodsè¯¦è§£](#2-proxybeanmethodsè¯¦è§£)
3. [Fullé…ç½®ç±»æ·±å…¥ç†è§£](#3-fullé…ç½®ç±»æ·±å…¥ç†è§£)
4. [Liteé…ç½®ç±»æ·±å…¥ç†è§£](#4-liteé…ç½®ç±»æ·±å…¥ç†è§£)
5. [Beanæ–¹æ³•è°ƒç”¨è¯­ä¹‰](#5-beanæ–¹æ³•è°ƒç”¨è¯­ä¹‰)
6. [å®ä¾‹å•ä¾‹ä¿è¯æœºåˆ¶](#6-å®ä¾‹å•ä¾‹ä¿è¯æœºåˆ¶)
7. [æ€§èƒ½æƒè¡¡ä¸é€‰æ‹©å»ºè®®](#7-æ€§èƒ½æƒè¡¡ä¸é€‰æ‹©å»ºè®®)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ç±»çš„ä¸¤ç§æ¨¡å¼


### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ç±»æ¨¡å¼


åœ¨Springä¸­ï¼Œç”¨`@Configuration`æ³¨è§£çš„ç±»å¯ä»¥æœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼Œå°±åƒæ±½è½¦æœ‰æ‰‹åŠ¨æŒ¡å’Œè‡ªåŠ¨æŒ¡ä¸€æ ·ï¼š

```
é…ç½®ç±»çš„ä¸¤ç§æ¨¡å¼ï¼š

Fullæ¨¡å¼ï¼ˆå…¨åŠŸèƒ½æ¨¡å¼ï¼‰          Liteæ¨¡å¼ï¼ˆè½»é‡æ¨¡å¼ï¼‰
      |                              |
   æœ‰ä»£ç†å¢å¼º                      æ— ä»£ç†å¢å¼º
      |                              |
   ä¿è¯å•ä¾‹                        ä¸ä¿è¯å•ä¾‹
      |                              |
   å¯åŠ¨ç¨æ…¢                        å¯åŠ¨æ›´å¿«
```

**é€šä¿—ç†è§£**ï¼š
- **Fullæ¨¡å¼**ï¼šSpringä¼š"ç›‘æ§"ä½ çš„é…ç½®ç±»ï¼Œç¡®ä¿Beanä¹‹é—´è°ƒç”¨æ—¶å§‹ç»ˆæ˜¯åŒä¸€ä¸ªå®ä¾‹
- **Liteæ¨¡å¼**ï¼šSpringä¸ç›‘æ§ï¼Œæ¯æ¬¡è°ƒç”¨Beanæ–¹æ³•éƒ½ä¼šåˆ›å»ºæ–°å¯¹è±¡

### 1.2 ä¸¤ç§æ¨¡å¼çš„æœ¬è´¨åŒºåˆ«


```
æ—¥å¸¸ç”Ÿæ´»ç±»æ¯”ï¼š

Fullæ¨¡å¼å°±åƒï¼š
ä½ æ‰“ç”µè¯è®¢å¤–å–ï¼Œé¤å…è®°ä½äº†ä½ çš„åœ°å€
ä¸‹æ¬¡å†ç‚¹åŒä¸€å®¶ï¼Œç›´æ¥é…é€ï¼Œä¸ç”¨é‡å¤è¯´åœ°å€
â†’ Springè®°ä½äº†Beanï¼Œç›´æ¥è¿”å›å·²æœ‰çš„

Liteæ¨¡å¼å°±åƒï¼š
æ¯æ¬¡ç‚¹å¤–å–éƒ½é‡æ–°ä¸‹å•ï¼Œé‡æ–°å¡«åœ°å€
æ¯æ¬¡éƒ½æ˜¯æ–°çš„è®¢å•æµç¨‹
â†’ æ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°åˆ›å»ºBean
```

---

## 2. ğŸ”§ proxyBeanMethodsè¯¦è§£


### 2.1 proxyBeanMethodsæ˜¯ä»€ä¹ˆ


`proxyBeanMethods`æ˜¯`@Configuration`æ³¨è§£çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æ§åˆ¶é…ç½®ç±»ä½¿ç”¨å“ªç§æ¨¡å¼ã€‚

```java
// Fullæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
@Configuration(proxyBeanMethods = true)  // å¼€å¯ä»£ç†
public class FullConfig {
    // ...
}

// Liteæ¨¡å¼
@Configuration(proxyBeanMethods = false) // å…³é—­ä»£ç†
public class LiteConfig {
    // ...
}
```

**å‚æ•°å«ä¹‰**ï¼š
- `true`ï¼šå¼€å¯ä»£ç†ï¼Œä½¿ç”¨Fullæ¨¡å¼ï¼ˆé»˜è®¤å€¼ï¼‰
- `false`ï¼šå…³é—­ä»£ç†ï¼Œä½¿ç”¨Liteæ¨¡å¼

### 2.2 proxyBeanMethodsçš„ä½œç”¨åŸç†


```
proxyBeanMethods = true æ—¶ï¼š

ä½ çš„é…ç½®ç±»                Springå¤„ç†å
    â†“                        â†“
@Configuration          ç”Ÿæˆä»£ç†ç±»
class MyConfig          class MyConfig$$Proxy
    â†“                        â†“
@Beanæ–¹æ³•               @Beanæ–¹æ³•è¢«æ‹¦æˆª
    â†“                        â†“
ç›´æ¥è°ƒç”¨                 å…ˆæ£€æŸ¥å®¹å™¨æœ‰æ²¡æœ‰
                         â†“         â†“
                      æœ‰ï¼šè¿”å›    æ²¡æœ‰ï¼šåˆ›å»º
```

**å…³é”®ç†è§£**ï¼š
- âœ… `true`æ—¶ï¼šSpringä¼šåˆ›å»ºé…ç½®ç±»çš„ä»£ç†å¯¹è±¡
- âœ… `false`æ—¶ï¼šSpringä½¿ç”¨åŸå§‹çš„é…ç½®ç±»ï¼Œä¸åˆ›å»ºä»£ç†

### 2.3 å®é™…ä»£ç å¯¹æ¯”


```java
// ç¤ºä¾‹é…ç½®ç±»
@Configuration(proxyBeanMethods = true)  // å…ˆç”¨Fullæ¨¡å¼
public class DatabaseConfig {
    
    @Bean
    public DataSource dataSource() {
        System.out.println("åˆ›å»ºDataSource");
        return new HikariDataSource();
    }
    
    @Bean
    public UserDao userDao() {
        // è°ƒç”¨dataSource()æ–¹æ³•
        return new UserDao(dataSource());
    }
}
```

**è¿è¡Œç»“æœå¯¹æ¯”**ï¼š

| æ¨¡å¼ | proxyBeanMethods | è¾“å‡ºç»“æœ | è¯´æ˜ |
|------|-----------------|---------|------|
| Full | `true` | åªæ‰“å°1æ¬¡"åˆ›å»ºDataSource" | Springæ‹¦æˆªäº†è°ƒç”¨ï¼Œè¿”å›å·²æœ‰Bean |
| Lite | `false` | æ‰“å°2æ¬¡"åˆ›å»ºDataSource" | æ¯æ¬¡è°ƒç”¨éƒ½çœŸæ­£æ‰§è¡Œæ–¹æ³• |

---

## 3. ğŸ—ï¸ Fullé…ç½®ç±»æ·±å…¥ç†è§£


### 3.1 Fullæ¨¡å¼çš„å·¥ä½œæœºåˆ¶


Fullæ¨¡å¼ä¸‹ï¼ŒSpringä¼šå¯¹é…ç½®ç±»åš"å¢å¼ºå¤„ç†"ï¼š

```
åŸå§‹é…ç½®ç±»                      Fullæ¨¡å¼å¤„ç†å
   â†“                               â†“
MyConfig                     MyConfig$$EnhancerBySpringCGLIB
   â†“                               â†“
æ™®é€šJavaå¯¹è±¡                    CGLIBä»£ç†å¯¹è±¡
   â†“                               â†“
@Beanæ–¹æ³•                       æ‹¦æˆª@Beanæ–¹æ³•è°ƒç”¨
```

**ä»£ç†æ‹¦æˆªé€»è¾‘**ï¼š
```
å½“ä½ è°ƒç”¨é…ç½®ç±»ä¸­çš„@Beanæ–¹æ³•ï¼š

ç¬¬1æ­¥ï¼šæ‹¦æˆªå™¨æ•è·æ–¹æ³•è°ƒç”¨
   â†“
ç¬¬2æ­¥ï¼šæ£€æŸ¥Springå®¹å™¨ä¸­æ˜¯å¦å·²æœ‰è¯¥Bean
   â†“              â†“
 å·²å­˜åœ¨        ä¸å­˜åœ¨
   â†“              â†“
è¿”å›å·²æœ‰Bean   æ‰§è¡Œæ–¹æ³•åˆ›å»ºBean
```

### 3.2 Fullæ¨¡å¼çš„ç‰¹ç‚¹


**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… **å•ä¾‹ä¿è¯**ï¼šåŒä¸€ä¸ªBeanåœ¨å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹
- âœ… **ä¾èµ–æ³¨å…¥**ï¼šBeanä¹‹é—´çš„å¼•ç”¨å…³ç³»æ­£ç¡®
- âš ï¸ **å¯åŠ¨è¾ƒæ…¢**ï¼šéœ€è¦åˆ›å»ºä»£ç†ç±»ï¼Œå¢åŠ å¯åŠ¨æ—¶é—´

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```java
@Configuration(proxyBeanMethods = true)
public class ServiceConfig {
    
    @Bean
    public UserService userService() {
        return new UserService(userRepository());
    }
    
    @Bean
    public OrderService orderService() {
        // userRepository()ä¼šè¿”å›åŒä¸€ä¸ªå®ä¾‹
        return new OrderService(userRepository());
    }
    
    @Bean
    public UserRepository userRepository() {
        return new UserRepository();
    }
}
```

**è¿è¡Œæ•ˆæœ**ï¼š
```
UserServiceå’ŒOrderServiceå…±äº«åŒä¸€ä¸ªUserRepositoryå®ä¾‹
UserRepositoryåªä¼šè¢«åˆ›å»º1æ¬¡
```

### 3.3 Fullæ¨¡å¼çš„ä»£ç†å®ç°


Springä½¿ç”¨**CGLIB**æŠ€æœ¯åˆ›å»ºä»£ç†ï¼š

```
CGLIBä»£ç†åŸç†ï¼š

åŸå§‹ç±» UserConfig
    â†“
CGLIBç”Ÿæˆå­ç±» UserConfig$$EnhancerBySpringCGLIB$$12345
    â†“
é‡å†™@Beanæ–¹æ³•
    â†“
æ·»åŠ æ‹¦æˆªé€»è¾‘ï¼šå…ˆæŸ¥å®¹å™¨ â†’ æœ‰å°±è¿”å› â†’ æ²¡æœ‰å°±åˆ›å»º
```

---

## 4. âš¡ Liteé…ç½®ç±»æ·±å…¥ç†è§£


### 4.1 Liteæ¨¡å¼çš„å·¥ä½œæœºåˆ¶


Liteæ¨¡å¼ä¸‹ï¼Œé…ç½®ç±»å°±æ˜¯æ™®é€šçš„Javaç±»ï¼š

```
Liteæ¨¡å¼å¤„ç†æµç¨‹ï¼š

@Configuration(proxyBeanMethods = false)
    â†“
ä¸åˆ›å»ºä»£ç†ç±»
    â†“
ä½¿ç”¨åŸå§‹é…ç½®ç±»
    â†“
@Beanæ–¹æ³•å°±æ˜¯æ™®é€šJavaæ–¹æ³•
    â†“
æ¯æ¬¡è°ƒç”¨éƒ½æ‰§è¡Œæ–¹æ³•ä½“
```

### 4.2 Liteæ¨¡å¼çš„ç‰¹ç‚¹


**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… **å¯åŠ¨å¿«é€Ÿ**ï¼šæ— éœ€åˆ›å»ºä»£ç†ï¼Œå¯åŠ¨æ—¶é—´çŸ­
- âœ… **æ€§èƒ½æ›´å¥½**ï¼šæ–¹æ³•è°ƒç”¨æ— æ‹¦æˆªå¼€é”€
- âš ï¸ **æ— å•ä¾‹ä¿è¯**ï¼šæ–¹æ³•é—´è°ƒç”¨ä¼šåˆ›å»ºæ–°å®ä¾‹

**ä»£ç ç¤ºä¾‹**ï¼š
```java
@Configuration(proxyBeanMethods = false)
public class LiteConfig {
    
    @Bean
    public ServiceA serviceA() {
        return new ServiceA();
    }
    
    @Bean
    public ServiceB serviceB() {
        // æ³¨æ„ï¼šè¿™é‡Œä¼šåˆ›å»ºæ–°çš„ServiceAå®ä¾‹ï¼
        return new ServiceB(serviceA());
    }
}
```

**è¿è¡Œç»“æœ**ï¼š
```
å®¹å™¨ä¸­çš„ServiceA Beanï¼šå®ä¾‹1
ServiceBä¸­çš„ServiceAï¼š  å®ä¾‹2ï¼ˆæ–°åˆ›å»ºçš„ï¼‰
â†’ è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼
```

### 4.3 Liteæ¨¡å¼çš„é€‚ç”¨åœºæ™¯


**é€‚åˆä½¿ç”¨Liteæ¨¡å¼çš„æƒ…å†µ**ï¼š

| åœºæ™¯ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| ğŸ”¸ **ç®€å•é…ç½®** | Beanä¹‹é—´æ— ä¾èµ–å…³ç³» | ç‹¬ç«‹çš„å·¥å…·ç±»Bean |
| ğŸ”¸ **æ€§èƒ½æ•æ„Ÿ** | éœ€è¦å¿«é€Ÿå¯åŠ¨ | å¾®æœåŠ¡ã€äº‘åŸç”Ÿåº”ç”¨ |
| ğŸ”¸ **å¤–éƒ¨ä¾èµ–** | Beané€šè¿‡å‚æ•°æ³¨å…¥ | ä½¿ç”¨æ–¹æ³•å‚æ•°æ¥æ”¶ä¾èµ– |

**æ­£ç¡®ä½¿ç”¨Liteæ¨¡å¼**ï¼š
```java
@Configuration(proxyBeanMethods = false)
public class CorrectLiteConfig {
    
    @Bean
    public ServiceA serviceA() {
        return new ServiceA();
    }
    
    @Bean
    // âœ… é€šè¿‡å‚æ•°æ³¨å…¥ï¼Œè€Œä¸æ˜¯æ–¹æ³•è°ƒç”¨
    public ServiceB serviceB(ServiceA serviceA) {
        return new ServiceB(serviceA);
    }
}
```

---

## 5. ğŸ”„ Beanæ–¹æ³•è°ƒç”¨è¯­ä¹‰


### 5.1 ä»€ä¹ˆæ˜¯è°ƒç”¨è¯­ä¹‰


è°ƒç”¨è¯­ä¹‰æŒ‡çš„æ˜¯ï¼š**å½“ä½ åœ¨é…ç½®ç±»ä¸­è°ƒç”¨ä¸€ä¸ª@Beanæ–¹æ³•æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆ**ã€‚

```
è°ƒç”¨è¯­ä¹‰å¯¹æ¯”ï¼š

Fullæ¨¡å¼ï¼š
myConfig.beanA()
    â†“
Springæ‹¦æˆª
    â†“
è¿”å›å®¹å™¨ä¸­çš„Bean

Liteæ¨¡å¼ï¼š
myConfig.beanA()
    â†“
ç›´æ¥æ‰§è¡Œæ–¹æ³•
    â†“
åˆ›å»ºæ–°å¯¹è±¡
```

### 5.2 Fullæ¨¡å¼çš„è°ƒç”¨è¯­ä¹‰


**è¡Œä¸ºç‰¹ç‚¹**ï¼š
```java
@Configuration(proxyBeanMethods = true)
public class FullModeDemo {
    
    @Bean
    public BeanA beanA() {
        return new BeanA();
    }
    
    @Bean
    public BeanB beanB() {
        BeanA a1 = beanA();  // ç¬¬1æ¬¡è°ƒç”¨
        BeanA a2 = beanA();  // ç¬¬2æ¬¡è°ƒç”¨
        
        System.out.println(a1 == a2);  // è¾“å‡ºï¼štrue
        return new BeanB();
    }
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ª@Beanæ–¹æ³•ï¼Œè¿”å›åŒä¸€ä¸ªå¯¹è±¡
- âœ… ç›¸å½“äºä»Springå®¹å™¨è·å–Bean
- âœ… ç¬¦åˆå•ä¾‹æ¨¡å¼çš„è¯­ä¹‰

### 5.3 Liteæ¨¡å¼çš„è°ƒç”¨è¯­ä¹‰


**è¡Œä¸ºç‰¹ç‚¹**ï¼š
```java
@Configuration(proxyBeanMethods = false)
public class LiteModeDemo {
    
    @Bean
    public BeanA beanA() {
        return new BeanA();
    }
    
    @Bean
    public BeanB beanB() {
        BeanA a1 = beanA();  // ç¬¬1æ¬¡è°ƒç”¨
        BeanA a2 = beanA();  // ç¬¬2æ¬¡è°ƒç”¨
        
        System.out.println(a1 == a2);  // è¾“å‡ºï¼šfalse
        return new BeanB();
    }
}
```

**å…³é”®ç‚¹**ï¼š
- âš ï¸ æ¯æ¬¡è°ƒç”¨@Beanæ–¹æ³•éƒ½åˆ›å»ºæ–°å¯¹è±¡
- âš ï¸ ä¸ä»Springå®¹å™¨è·å–
- âš ï¸ ç›¸å½“äºæ™®é€šJavaæ–¹æ³•è°ƒç”¨

### 5.4 è°ƒç”¨è¯­ä¹‰çš„å®é™…å½±å“


**é”™è¯¯ç¤ºä¾‹**ï¼ˆLiteæ¨¡å¼ä¸‹çš„å¸¸è§é”™è¯¯ï¼‰ï¼š
```java
@Configuration(proxyBeanMethods = false)
public class WrongUsage {
    
    @Bean
    public UserRepository repository() {
        return new UserRepository();
    }
    
    @Bean
    public UserService userService() {
        // âŒ é”™è¯¯ï¼šåˆ›å»ºäº†æ–°çš„repositoryï¼Œä¸æ˜¯å®¹å™¨ä¸­çš„
        return new UserService(repository());
    }
    
    @Bean
    public OrderService orderService() {
        // âŒ é”™è¯¯ï¼šåˆåˆ›å»ºäº†æ–°çš„repository
        return new OrderService(repository());
    }
}
```

**æ­£ç¡®ç¤ºä¾‹**ï¼ˆLiteæ¨¡å¼æ­£ç¡®ç”¨æ³•ï¼‰ï¼š
```java
@Configuration(proxyBeanMethods = false)
public class CorrectUsage {
    
    @Bean
    public UserRepository repository() {
        return new UserRepository();
    }
    
    @Bean
    // âœ… æ­£ç¡®ï¼šé€šè¿‡å‚æ•°æ³¨å…¥å®¹å™¨ä¸­çš„Bean
    public UserService userService(UserRepository repository) {
        return new UserService(repository);
    }
    
    @Bean
    // âœ… æ­£ç¡®ï¼šé€šè¿‡å‚æ•°æ³¨å…¥å®¹å™¨ä¸­çš„Bean
    public OrderService orderService(UserRepository repository) {
        return new OrderService(repository);
    }
}
```

---

## 6. ğŸ”’ å®ä¾‹å•ä¾‹ä¿è¯æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯å•ä¾‹ä¿è¯


å•ä¾‹ä¿è¯æŒ‡ï¼š**ç¡®ä¿ä¸€ä¸ªBeanåœ¨æ•´ä¸ªSpringå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹**ã€‚

```
å•ä¾‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼š

å®¹å™¨å¯åŠ¨
   â†“
åˆ›å»ºBeanå®ä¾‹ï¼ˆåªåˆ›å»º1æ¬¡ï¼‰
   â†“
å­˜å…¥å®¹å™¨ï¼ˆå•ä¾‹æ± ï¼‰
   â†“
åç»­ä½¿ç”¨ï¼ˆç›´æ¥ä»æ± ä¸­è·å–ï¼‰
   â†“
å®¹å™¨å…³é—­ï¼ˆé”€æ¯å®ä¾‹ï¼‰
```

### 6.2 Fullæ¨¡å¼çš„å•ä¾‹ä¿è¯


**ä¿è¯æœºåˆ¶**ï¼š
```
Fullæ¨¡å¼ä¿è¯å•ä¾‹çš„åŸç†ï¼š

é…ç½®ç±»è¢«ä»£ç†
   â†“
@Beanæ–¹æ³•è°ƒç”¨è¢«æ‹¦æˆª
   â†“
æ‹¦æˆªå™¨æ£€æŸ¥å•ä¾‹æ± 
   â†“              â†“
å·²å­˜åœ¨          ä¸å­˜åœ¨
   â†“              â†“
è¿”å›å·²æœ‰      åˆ›å»ºå¹¶ç¼“å­˜
```

**ä»£ç éªŒè¯**ï¼š
```java
@Configuration(proxyBeanMethods = true)
public class SingletonDemo {
    
    @Bean
    public DataSource dataSource() {
        System.out.println("åˆ›å»ºDataSource");
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl("jdbc:mysql://localhost:3306/test");
        return ds;
    }
    
    @Bean
    public JdbcTemplate jdbcTemplate() {
        // è°ƒç”¨dataSource()
        return new JdbcTemplate(dataSource());
    }
    
    @Bean
    public TransactionManager transactionManager() {
        // å†æ¬¡è°ƒç”¨dataSource()
        return new DataSourceTransactionManager(dataSource());
    }
}
```

**è¿è¡Œç»“æœ**ï¼š
```
æ§åˆ¶å°è¾“å‡ºï¼š
åˆ›å»ºDataSource  ï¼ˆåªè¾“å‡º1æ¬¡ï¼‰

éªŒè¯å•ä¾‹ï¼š
JdbcTemplateä¸­çš„DataSource == TransactionManagerä¸­çš„DataSource
â†’ trueï¼ˆæ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼‰
```

### 6.3 Liteæ¨¡å¼æ— å•ä¾‹ä¿è¯


**Liteæ¨¡å¼ä¸‹çš„æƒ…å†µ**ï¼š
```java
@Configuration(proxyBeanMethods = false)
public class NoSingletonDemo {
    
    @Bean
    public DataSource dataSource() {
        System.out.println("åˆ›å»ºDataSource");
        return new HikariDataSource();
    }
    
    @Bean
    public JdbcTemplate jdbcTemplate() {
        return new JdbcTemplate(dataSource());  // åˆ›å»ºæ–°å®ä¾‹
    }
    
    @Bean
    public TransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());  // åˆåˆ›å»ºæ–°å®ä¾‹
    }
}
```

**è¿è¡Œç»“æœ**ï¼š
```
æ§åˆ¶å°è¾“å‡ºï¼š
åˆ›å»ºDataSource  ï¼ˆè¾“å‡º3æ¬¡ï¼ï¼‰

éªŒè¯å•ä¾‹ï¼š
JdbcTemplateä¸­çš„DataSource == TransactionManagerä¸­çš„DataSource
â†’ falseï¼ˆæ˜¯ä¸åŒå®ä¾‹ï¼‰

å®¹å™¨ä¸­çš„DataSourceï¼š   å®ä¾‹1
JdbcTemplateä¸­çš„ï¼š      å®ä¾‹2
TransactionManagerä¸­çš„ï¼šå®ä¾‹3
```

### 6.4 å•ä¾‹ä¿è¯çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦å•ä¾‹**ï¼š

| åŸå›  | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| ğŸ”¸ **èµ„æºèŠ‚çº¦** | é¿å…é‡å¤åˆ›å»ºå¯¹è±¡ | æ•°æ®åº“è¿æ¥æ± åªéœ€ä¸€ä¸ª |
| ğŸ”¸ **çŠ¶æ€ä¸€è‡´** | å…±äº«åŒä¸€ä¸ªå¯¹è±¡çŠ¶æ€ | é…ç½®å¯¹è±¡çŠ¶æ€åŒæ­¥ |
| ğŸ”¸ **ä¾èµ–æ­£ç¡®** | Beanä¹‹é—´å¼•ç”¨åŒä¸€å®ä¾‹ | Serviceå¼•ç”¨åŒä¸€ä¸ªDAO |

**ç ´åå•ä¾‹çš„åæœ**ï¼š
```
å¤šä¸ªDataSourceå®ä¾‹ï¼š
   â†“
å¤šä¸ªæ•°æ®åº“è¿æ¥æ± 
   â†“
èµ„æºæµªè´¹ + è¿æ¥æ•°è¶…é™
   â†“
åº”ç”¨æ€§èƒ½ä¸‹é™ç”šè‡³å´©æºƒ
```

---

## 7. âš–ï¸ æ€§èƒ½æƒè¡¡ä¸é€‰æ‹©å»ºè®®


### 7.1 æ€§èƒ½å¯¹æ¯”åˆ†æ


**å¯åŠ¨æ€§èƒ½å¯¹æ¯”**ï¼š

```
å¯åŠ¨æ—¶é—´å¯¹æ¯”ï¼ˆ100ä¸ª@Beanï¼‰ï¼š

Fullæ¨¡å¼ï¼š
åˆ›å»ºä»£ç†ç±»ï¼š+50ms
å¢å¼ºå¤„ç†ï¼š  +30ms
æ€»è€—æ—¶ï¼š    åŸºå‡† + 80ms

Liteæ¨¡å¼ï¼š
æ— ä»£ç†å¼€é”€ï¼š 0ms
æ€»è€—æ—¶ï¼š    åŸºå‡†
```

**è¿è¡Œæ€§èƒ½å¯¹æ¯”**ï¼š

| ç»´åº¦ | Fullæ¨¡å¼ | Liteæ¨¡å¼ |
|------|---------|---------|
| æ–¹æ³•è°ƒç”¨ | æœ‰æ‹¦æˆªå¼€é”€ | æ— æ‹¦æˆªå¼€é”€ |
| å†…å­˜å ç”¨ | ä»£ç†ç±»å ç”¨é¢å¤–å†…å­˜ | æ— é¢å¤–å†…å­˜ |
| Beanè·å– | ä»ç¼“å­˜è·å–ï¼ˆå¿«ï¼‰ | é‡æ–°åˆ›å»ºï¼ˆæ…¢ï¼‰ |

### 7.2 é€‰æ‹©å»ºè®®


**ä½¿ç”¨Fullæ¨¡å¼çš„åœºæ™¯**ï¼š

âœ… **Beanä¹‹é—´æœ‰ä¾èµ–å…³ç³»**
```java
@Configuration(proxyBeanMethods = true)
public class ServiceConfig {
    @Bean
    public UserDao userDao() { /*...*/ }
    
    @Bean
    public UserService userService() {
        // éœ€è¦ç¡®ä¿userDao()è¿”å›åŒä¸€ä¸ªå®ä¾‹
        return new UserService(userDao());
    }
}
```

âœ… **éœ€è¦ä¸¥æ ¼çš„å•ä¾‹ä¿è¯**
```java
// æ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜ç®¡ç†å™¨ç­‰
@Configuration(proxyBeanMethods = true)
public class InfraConfig {
    @Bean
    public DataSource dataSource() { /*...*/ }
    
    @Bean
    public CacheManager cacheManager() { /*...*/ }
}
```

**ä½¿ç”¨Liteæ¨¡å¼çš„åœºæ™¯**ï¼š

âœ… **æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨**
```java
// å¾®æœåŠ¡ã€äº‘åŸç”Ÿåº”ç”¨ï¼Œè¿½æ±‚å¿«é€Ÿå¯åŠ¨
@Configuration(proxyBeanMethods = false)
public class FastStartupConfig {
    // Beanä¹‹é—´æ— ä¾èµ–ï¼Œé€šè¿‡å‚æ•°æ³¨å…¥
}
```

âœ… **ç®€å•å·¥å…·ç±»é…ç½®**
```java
@Configuration(proxyBeanMethods = false)
public class UtilConfig {
    @Bean
    public ObjectMapper objectMapper() {
        return new ObjectMapper();
    }
    
    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}
```

âœ… **ä½¿ç”¨å‚æ•°æ³¨å…¥çš„é…ç½®**
```java
@Configuration(proxyBeanMethods = false)
public class ModernConfig {
    @Bean
    public ServiceA serviceA() { /*...*/ }
    
    @Bean
    // é€šè¿‡å‚æ•°æ³¨å…¥ï¼Œä¸éœ€è¦ä»£ç†
    public ServiceB serviceB(ServiceA serviceA) {
        return new ServiceB(serviceA);
    }
}
```

### 7.3 æœ€ä½³å®è·µ


**æ¨èåšæ³•**ï¼š

â‘  **ä¼˜å…ˆä½¿ç”¨Liteæ¨¡å¼ + å‚æ•°æ³¨å…¥**
```java
@Configuration(proxyBeanMethods = false)  // é»˜è®¤é€‰Lite
public class RecommendedConfig {
    
    @Bean
    public BeanA beanA() {
        return new BeanA();
    }
    
    @Bean
    public BeanB beanB(BeanA beanA) {  // å‚æ•°æ³¨å…¥
        return new BeanB(beanA);
    }
}
```

â‘¡ **å¿…è¦æ—¶ä½¿ç”¨Fullæ¨¡å¼**
```java
@Configuration(proxyBeanMethods = true)  // æ˜ç¡®éœ€è¦ä»£ç†
public class LegacyConfig {
    
    @Bean
    public OldBean oldBean() {
        return new OldBean();
    }
    
    @Bean
    public AnotherBean anotherBean() {
        // æ—§ä»£ç ï¼Œä¾èµ–æ–¹æ³•è°ƒç”¨
        return new AnotherBean(oldBean());
    }
}
```

â‘¢ **æ··åˆä½¿ç”¨**
```java
// åŸºç¡€è®¾æ–½é…ç½®ç”¨Full
@Configuration(proxyBeanMethods = true)
public class InfraConfig {
    @Bean
    public DataSource dataSource() { /*...*/ }
}

// ä¸šåŠ¡é…ç½®ç”¨Lite
@Configuration(proxyBeanMethods = false)
@Import(InfraConfig.class)
public class BusinessConfig {
    @Bean
    public UserService userService(DataSource ds) { /*...*/ }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ¦‚å¿µ


```
ğŸ”¸ proxyBeanMethodsï¼šæ§åˆ¶é…ç½®ç±»æ˜¯å¦ä½¿ç”¨ä»£ç†
   â€¢ trueï¼šFullæ¨¡å¼ï¼Œåˆ›å»ºä»£ç†ï¼Œä¿è¯å•ä¾‹
   â€¢ falseï¼šLiteæ¨¡å¼ï¼Œæ— ä»£ç†ï¼Œæ€§èƒ½æ›´å¥½

ğŸ”¸ Fullé…ç½®ç±»ï¼š
   â€¢ Springåˆ›å»ºCGLIBä»£ç†
   â€¢ @Beanæ–¹æ³•è°ƒç”¨è¢«æ‹¦æˆª
   â€¢ ä¿è¯è¿”å›åŒä¸€ä¸ªBeanå®ä¾‹

ğŸ”¸ Liteé…ç½®ç±»ï¼š
   â€¢ ä½¿ç”¨åŸå§‹é…ç½®ç±»
   â€¢ @Beanæ–¹æ³•å°±æ˜¯æ™®é€šæ–¹æ³•
   â€¢ æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°å¯¹è±¡

ğŸ”¸ è°ƒç”¨è¯­ä¹‰ï¼š
   â€¢ Fullæ¨¡å¼ï¼šæ–¹æ³•è°ƒç”¨ = ä»å®¹å™¨è·å–Bean
   â€¢ Liteæ¨¡å¼ï¼šæ–¹æ³•è°ƒç”¨ = æ‰§è¡Œæ–¹æ³•ä½“åˆ›å»ºæ–°å¯¹è±¡
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**Full vs Lite å¿«é€Ÿè®°å¿†**ï¼š

```
Fullæ¨¡å¼ï¼š
âœ… æœ‰ä»£ç† â†’ æ…¢ä¸€ç‚¹ â†’ ä¿è¯å•ä¾‹ â†’ æ–¹æ³•è°ƒç”¨å®‰å…¨
é€‚åˆï¼šBeanä¹‹é—´æœ‰ä¾èµ–çš„é…ç½®

Liteæ¨¡å¼ï¼š
âœ… æ— ä»£ç† â†’ å¿«ä¸€ç‚¹ â†’ ä¸ä¿è¯å•ä¾‹ â†’ ç”¨å‚æ•°æ³¨å…¥
é€‚åˆï¼šBeanç‹¬ç«‹æˆ–æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯
```

**é€‰æ‹©å†³ç­–æ ‘**ï¼š
```
éœ€è¦Beanä¹‹é—´æ–¹æ³•è°ƒç”¨ï¼Ÿ
   â†“           â†“
  æ˜¯          å¦
   â†“           â†“
Fullæ¨¡å¼    Liteæ¨¡å¼
   â†“           â†“
ä»£ç†ä¿è¯    å‚æ•°æ³¨å…¥
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**æ–°é¡¹ç›®æ¨è**ï¼š
```java
// é»˜è®¤ä½¿ç”¨Liteæ¨¡å¼ + å‚æ•°æ³¨å…¥
@Configuration(proxyBeanMethods = false)
public class AppConfig {
    
    @Bean
    public ServiceA serviceA() {
        return new ServiceA();
    }
    
    @Bean
    public ServiceB serviceB(ServiceA serviceA) {
        return new ServiceB(serviceA);
    }
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ Liteæ¨¡å¼ä¸‹ç¦æ­¢Beanæ–¹æ³•äº’ç›¸è°ƒç”¨
- âš ï¸ Fullæ¨¡å¼å¯åŠ¨æ…¢ï¼Œä½†ä¿è¯å•ä¾‹æ­£ç¡®
- âš ï¸ æ··ç”¨æ—¶è¦æ˜ç¡®å„é…ç½®ç±»çš„èŒè´£

**è®°å¿†å£è¯€**ï¼š
```
ä»£ç†æ¨¡å¼åˆ†ä¸¤ç§ï¼ŒFullå’ŒLiteè¦åˆ†æ¸…
Fullæœ‰ä»£ç†ä¿å•ä¾‹ï¼ŒLiteæ— ä»£ç†æ›´è½»ç›ˆ
æ–¹æ³•è°ƒç”¨çœ‹è¯­ä¹‰ï¼ŒFullæ‹¦æˆªLiteç›´è¡Œ
é€‰æ‹©æ¨¡å¼çœ‹åœºæ™¯ï¼Œæ€§èƒ½ä¾èµ–éœ€æƒè¡¡
```