---
title: 9ã€æ•°æ®æºé…ç½®ä¸æ•´åˆ
---
## ğŸ“š ç›®å½•

1. [æ•°æ®æºæ ¸å¿ƒæ¦‚å¿µ](#1-æ•°æ®æºæ ¸å¿ƒæ¦‚å¿µ)
2. [DataSourceæ•°æ®æºæ¥å£](#2-DataSourceæ•°æ®æºæ¥å£)
3. [JdbcTemplateæ¨¡æ¿ç±»](#3-JdbcTemplateæ¨¡æ¿ç±»)
4. [ä¸»æµè¿æ¥æ± é…ç½®](#4-ä¸»æµè¿æ¥æ± é…ç½®)
5. [è¿æ¥æ± å‚æ•°è°ƒä¼˜](#5-è¿æ¥æ± å‚æ•°è°ƒä¼˜)
6. [é«˜çº§é…ç½®æ–¹æ¡ˆ](#6-é«˜çº§é…ç½®æ–¹æ¡ˆ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ’§ æ•°æ®æºæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®æº


**é€šä¿—ç†è§£**ï¼šæ•°æ®æºå°±åƒæ˜¯"æ°´é¾™å¤´"ï¼Œåº”ç”¨ç¨‹åºéœ€è¦ä»æ•°æ®åº“"å–æ°´"æ—¶ï¼Œä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°æŒ–äº•æ¥ç®¡é“ï¼Œè€Œæ˜¯ç›´æ¥æ‹§å¼€"æ°´é¾™å¤´"å°±èƒ½ç”¨ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆæ¯æ¬¡éƒ½è¦å»ºç«‹è¿æ¥ï¼‰ï¼š
åº”ç”¨ç¨‹åº --[åˆ›å»ºè¿æ¥]--> æ•°æ®åº“
åº”ç”¨ç¨‹åº --[å…³é—­è¿æ¥]--> æ•°æ®åº“
åº”ç”¨ç¨‹åº --[å†æ¬¡åˆ›å»º]--> æ•°æ®åº“  âŒ æ•ˆç‡ä½ã€èµ„æºæµªè´¹

æ•°æ®æºæ–¹å¼ï¼ˆè¿æ¥æ± å¤ç”¨ï¼‰ï¼š
åº”ç”¨ç¨‹åº --[å€Ÿç”¨è¿æ¥]--> è¿æ¥æ±  --[å¤ç”¨è¿æ¥]--> æ•°æ®åº“
åº”ç”¨ç¨‹åº --[å½’è¿˜è¿æ¥]--> è¿æ¥æ± 
åº”ç”¨ç¨‹åº --[å†æ¬¡å€Ÿç”¨]--> è¿æ¥æ±   âœ… é«˜æ•ˆã€èŠ‚çœèµ„æº
```

### 1.2 æ•°æ®æºè§£å†³çš„æ ¸å¿ƒé—®é¢˜


**ğŸ”¸ é—®é¢˜1ï¼šé¢‘ç¹åˆ›å»ºè¿æ¥å¤ªæ…¢**
- å»ºç«‹æ•°æ®åº“è¿æ¥éœ€è¦ï¼šéªŒè¯èº«ä»½ã€åˆ†é…èµ„æºã€å»ºç«‹é€šé“
- æ¯æ¬¡æ“ä½œéƒ½é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±åƒæ¯æ¬¡å–æ°´éƒ½è¦é‡æ–°è£…æ°´ç®¡

**ğŸ”¸ é—®é¢˜2ï¼šè¿æ¥æ•°é‡éš¾ä»¥æ§åˆ¶**
- å¹¶å‘ç”¨æˆ·å¤šæ—¶ï¼Œå¯èƒ½åˆ›å»ºæˆç™¾ä¸Šåƒä¸ªè¿æ¥
- æ•°æ®åº“æ‰¿å—ä¸äº†ï¼Œå°±åƒæ°´å‚ä¾›æ°´èƒ½åŠ›æœ‰é™

**ğŸ”¸ è§£å†³æ–¹æ¡ˆï¼šè¿æ¥æ± æœºåˆ¶**
```
è¿æ¥æ± å·¥ä½œåŸç†ï¼š

åˆå§‹åŒ–é˜¶æ®µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å¯åŠ¨      â”‚
â”‚       â†“         â”‚
â”‚  åˆ›å»º10ä¸ªè¿æ¥   â”‚ â† åˆå§‹è¿æ¥æ•°
â”‚       â†“         â”‚
â”‚   æ”¾å…¥è¿æ¥æ±     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿è¡Œé˜¶æ®µï¼š
ç”¨æˆ·è¯·æ±‚ â†’ ä»æ± ä¸­å€Ÿè¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å½’è¿˜è¿æ¥åˆ°æ± 
                â†“
           è¿æ¥è¢«å¤ç”¨
```

---

## 2. ğŸ”Œ DataSourceæ•°æ®æºæ¥å£


### 2.1 DataSourceæ¥å£çš„æœ¬è´¨


> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼šDataSourceæ˜¯Javaè§„èŒƒå®šä¹‰çš„ç»Ÿä¸€"å–æ°´æ¥å£"ï¼Œä¸ç®¡æ˜¯å“ªä¸ªå‚å®¶çš„"æ°´é¾™å¤´"ï¼ˆè¿æ¥æ± ï¼‰ï¼Œç”¨æ³•éƒ½ä¸€æ ·ã€‚

**æ¥å£å®šä¹‰**ï¼š
```java
package javax.sql;

public interface DataSource {
    // æ ¸å¿ƒæ–¹æ³•ï¼šè·å–æ•°æ®åº“è¿æ¥
    Connection getConnection() throws SQLException;
    
    // å¸¦ç”¨æˆ·åå¯†ç çš„é‡è½½æ–¹æ³•
    Connection getConnection(String username, String password) 
        throws SQLException;
}
```

### 2.2 ä¸ºä»€ä¹ˆè¦ç”¨DataSource


| å¯¹æ¯”ç»´åº¦ | **ä¼ ç»ŸDriverManager** | **DataSourceæ¥å£** |
|---------|---------------------|-------------------|
| è·å–æ–¹å¼ | `DriverManager.getConnection(url, user, pwd)` | `dataSource.getConnection()` |
| è¿æ¥å¤ç”¨ | âŒ æ¯æ¬¡åˆ›å»ºæ–°è¿æ¥ | âœ… ä»æ± ä¸­è·å–å¤ç”¨ |
| æ€§èƒ½è¡¨ç° | æ…¢ï¼ˆæ¯æ¬¡éƒ½å»ºç«‹TCPè¿æ¥ï¼‰ | å¿«ï¼ˆè¿æ¥å·²å»ºç«‹å¥½ï¼‰ |
| èµ„æºæ§åˆ¶ | éš¾ä»¥æ§åˆ¶è¿æ¥æ•°é‡ | å¯é…ç½®æœ€å¤§è¿æ¥æ•° |
| é…ç½®æ–¹å¼ | ä»£ç ç¡¬ç¼–ç  | é…ç½®æ–‡ä»¶ç®¡ç† |

### 2.3 Springä¸­é…ç½®DataSource


**é…ç½®ç¤ºä¾‹ï¼ˆXMLæ–¹å¼ï¼‰**ï¼š
```xml
<!-- æœ€ç®€å•çš„æ•°æ®æºé…ç½® -->
<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.cj.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://localhost:3306/mydb"/>
    <property name="username" value="root"/>
    <property name="password" value="123456"/>
</bean>
```

**é…ç½®ç¤ºä¾‹ï¼ˆJavaé…ç½®æ–¹å¼ï¼‰**ï¼š
```java
@Configuration
public class DataSourceConfig {
    
    @Bean
    public DataSource dataSource() {
        DriverManagerDataSource ds = new DriverManagerDataSource();
        ds.setDriverClassName("com.mysql.cj.jdbc.Driver");
        ds.setUrl("jdbc:mysql://localhost:3306/mydb");
        ds.setUsername("root");
        ds.setPassword("123456");
        return ds;
    }
}
```

---

## 3. ğŸ› ï¸ JdbcTemplateæ¨¡æ¿ç±»


### 3.1 JdbcTemplateæ˜¯ä»€ä¹ˆ


> ğŸ“– **ç®€å•ç†è§£**ï¼šJdbcTemplateæ˜¯Springæä¾›çš„"æ•°æ®åº“æ“ä½œåŠ©æ‰‹"ï¼Œå¸®ä½ ç®€åŒ–åŸå§‹JDBCçš„ç¹çä»£ç ã€‚

**ä¼ ç»ŸJDBCçš„ç—›è‹¦**ï¼š
```java
// ä¼ ç»ŸJDBCä»£ç ï¼ˆå¤ªç¹çï¼ï¼‰
Connection conn = null;
PreparedStatement ps = null;
ResultSet rs = null;
try {
    conn = dataSource.getConnection();        // 1. è·å–è¿æ¥
    ps = conn.prepareStatement("SELECT * ..."); // 2. åˆ›å»ºè¯­å¥
    rs = ps.executeQuery();                   // 3. æ‰§è¡ŒæŸ¥è¯¢
    while(rs.next()) {                        // 4. å¤„ç†ç»“æœ
        // ...
    }
} catch(SQLException e) {
    // å¼‚å¸¸å¤„ç†
} finally {
    // 5. å…³é—­èµ„æºï¼ˆå®¹æ˜“é—æ¼ï¼ï¼‰
    if(rs != null) rs.close();
    if(ps != null) ps.close();
    if(conn != null) conn.close();
}
```

**ä½¿ç”¨JdbcTemplateå**ï¼š
```java
// ç®€æ´ä¼˜é›…ï¼
List<User> users = jdbcTemplate.query(
    "SELECT * FROM user",
    new BeanPropertyRowMapper<>(User.class)
);
```

### 3.2 JdbcTemplateæ ¸å¿ƒåŠŸèƒ½


**ğŸ”¸ åŠŸèƒ½æ¸…å•**ï¼š

| åŠŸèƒ½åˆ†ç±» | æ–¹æ³•ç¤ºä¾‹ | ç”¨é€”è¯´æ˜ |
|---------|---------|---------|
| **æŸ¥è¯¢æ“ä½œ** | `query()` | æŸ¥è¯¢å¤šæ¡è®°å½• |
| | `queryForObject()` | æŸ¥è¯¢å•ä¸ªå¯¹è±¡ |
| | `queryForList()` | æŸ¥è¯¢è¿”å›List |
| | `queryForMap()` | æŸ¥è¯¢è¿”å›Map |
| **æ›´æ–°æ“ä½œ** | `update()` | å¢åˆ æ”¹æ“ä½œ |
| | `batchUpdate()` | æ‰¹é‡æ›´æ–° |
| **æ‰§è¡Œæ“ä½œ** | `execute()` | æ‰§è¡ŒDDLè¯­å¥ |
| **è°ƒç”¨å­˜å‚¨è¿‡ç¨‹** | `call()` | è°ƒç”¨æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹ |

### 3.3 JdbcTemplateå®æˆ˜ç¤ºä¾‹


**é…ç½®JdbcTemplate**ï¼š
```java
@Configuration
public class JdbcConfig {
    
    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@Repository
public class UserDao {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    public List<User> findAll() {
        String sql = "SELECT * FROM user";
        return jdbcTemplate.query(sql, 
            new BeanPropertyRowMapper<>(User.class));
    }
    
    // æ ¹æ®IDæŸ¥è¯¢
    public User findById(Long id) {
        String sql = "SELECT * FROM user WHERE id = ?";
        return jdbcTemplate.queryForObject(sql, 
            new BeanPropertyRowMapper<>(User.class), id);
    }
    
    // æ·»åŠ ç”¨æˆ·
    public int save(User user) {
        String sql = "INSERT INTO user(name, age) VALUES(?, ?)";
        return jdbcTemplate.update(sql, user.getName(), user.getAge());
    }
    
    // ç»Ÿè®¡æ•°é‡
    public int count() {
        String sql = "SELECT COUNT(*) FROM user";
        return jdbcTemplate.queryForObject(sql, Integer.class);
    }
}
```

---

## 4. ğŸŠ ä¸»æµè¿æ¥æ± é…ç½®


### 4.1 è¿æ¥æ± é€‰å‹å¯¹æ¯”


**âš–ï¸ æ€§èƒ½ä¸ç‰¹ç‚¹å¯¹æ¯”**ï¼š

| è¿æ¥æ±  | æ€§èƒ½ | åŠŸèƒ½ | æ¨èåœºæ™¯ | æµè¡Œåº¦ |
|-------|------|------|---------|--------|
| **C3P0** | â­â­â­ | â­â­â­â­ | è€é¡¹ç›®ç»´æŠ¤ | ğŸ”¥ğŸ”¥ |
| **Druid** | â­â­â­â­ | â­â­â­â­â­ | éœ€è¦ç›‘æ§çš„é¡¹ç›® | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |
| **HikariCP** | â­â­â­â­â­ | â­â­â­ | è¿½æ±‚æè‡´æ€§èƒ½ | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ |

```
æ€§èƒ½æµ‹è¯•å¯¹æ¯”ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š
HikariCP:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (æœ€å¿«)
Druid:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
C3P0:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```

### 4.2 C3P0è¿æ¥æ± é…ç½®


> ğŸ“Œ **C3P0ç‰¹ç‚¹**ï¼šè€ç‰Œè¿æ¥æ± ï¼ŒåŠŸèƒ½å®Œå–„ï¼Œé…ç½®ç®€å•ï¼Œä½†æ€§èƒ½ä¸€èˆ¬ã€‚

**Mavenä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.mchange</groupId>
    <artifactId>c3p0</artifactId>
    <version>0.9.5.5</version>
</dependency>
```

**Springé…ç½®**ï¼š
```xml
<bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
    <property name="jdbcUrl" value="jdbc:mysql://localhost:3306/mydb"/>
    <property name="user" value="root"/>
    <property name="password" value="123456"/>
    
    <!-- è¿æ¥æ± æ ¸å¿ƒå‚æ•° -->
    <property name="initialPoolSize" value="5"/>     <!-- åˆå§‹è¿æ¥æ•° -->
    <property name="minPoolSize" value="5"/>         <!-- æœ€å°è¿æ¥æ•° -->
    <property name="maxPoolSize" value="20"/>        <!-- æœ€å¤§è¿æ¥æ•° -->
    
    <!-- è¿æ¥ç®¡ç†å‚æ•° -->
    <property name="maxIdleTime" value="1800"/>      <!-- æœ€å¤§ç©ºé—²æ—¶é—´(ç§’) -->
    <property name="acquireIncrement" value="3"/>    <!-- è¿æ¥ç”¨å®Œæ—¶å¢åŠ æ•°é‡ -->
</bean>
```

### 4.3 Druidè¿æ¥æ± é…ç½®


> ğŸ”¥ **Druidç‰¹ç‚¹**ï¼šé˜¿é‡Œå¼€æºï¼Œæ€§èƒ½ä¼˜ç§€ï¼Œå†…ç½®ç›‘æ§ï¼ŒSQLé˜²ç«å¢™åŠŸèƒ½å¼ºå¤§ã€‚

**Mavenä¾èµ–**ï¼š
```xml
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid-spring-boot-starter</artifactId>
    <version>1.2.16</version>
</dependency>
```

**application.ymlé…ç½®**ï¼š
```yaml
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    druid:
      # åŸºæœ¬é…ç½®
      url: jdbc:mysql://localhost:3306/mydb?useSSL=false
      username: root
      password: 123456
      driver-class-name: com.mysql.cj.jdbc.Driver
      
      # è¿æ¥æ± é…ç½®
      initial-size: 5          # åˆå§‹åŒ–è¿æ¥æ•°
      min-idle: 5              # æœ€å°ç©ºé—²è¿æ¥
      max-active: 20           # æœ€å¤§æ´»è·ƒè¿æ¥
      max-wait: 60000          # è·å–è¿æ¥è¶…æ—¶æ—¶é—´(æ¯«ç§’)
      
      # ç›‘æ§é…ç½®
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*  # è®¿é—®è·¯å¾„: http://localhost:8080/druid
        login-username: admin
        login-password: admin
      
      # è¿‡æ»¤å™¨é…ç½®
      filter:
        stat:
          enabled: true
          log-slow-sql: true   # è®°å½•æ…¢SQL
          slow-sql-millis: 1000 # æ…¢SQLé˜ˆå€¼(æ¯«ç§’)
```

**ç›‘æ§é¢æ¿åŠŸèƒ½**ï¼š
```
Druidç›‘æ§é¢æ¿åŒ…å«ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š æ•°æ®æºç›‘æ§      â”‚ â† è¿æ¥æ± çŠ¶æ€
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ SQLç›‘æ§         â”‚ â† SQLæ‰§è¡Œç»Ÿè®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ Webåº”ç”¨ç›‘æ§     â”‚ â† URIè®¿é—®ç»Ÿè®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” SQLé˜²ç«å¢™       â”‚ â† é˜²SQLæ³¨å…¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 HikariCPè¿æ¥æ± é…ç½®


> âš¡ **HikariCPç‰¹ç‚¹**ï¼šå·ç§°"å…‰é€Ÿ"è¿æ¥æ± ï¼ŒSpringBoot 2.xé»˜è®¤è¿æ¥æ± ï¼Œæ€§èƒ½æœ€å¼ºã€‚

**Mavenä¾èµ–**ï¼š
```xml
<!-- SpringBootå·²å†…ç½®ï¼Œæ— éœ€é¢å¤–å¼•å…¥ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
</dependency>
```

**application.ymlé…ç½®**ï¼š
```yaml
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      # åŸºæœ¬é…ç½®
      jdbc-url: jdbc:mysql://localhost:3306/mydb
      username: root
      password: 123456
      driver-class-name: com.mysql.cj.jdbc.Driver
      
      # è¿æ¥æ± é…ç½®
      minimum-idle: 5          # æœ€å°ç©ºé—²è¿æ¥
      maximum-pool-size: 20    # æœ€å¤§è¿æ¥æ•°
      connection-timeout: 30000 # è¿æ¥è¶…æ—¶(æ¯«ç§’)
      idle-timeout: 600000     # ç©ºé—²è¶…æ—¶(æ¯«ç§’)
      max-lifetime: 1800000    # è¿æ¥æœ€å¤§å­˜æ´»æ—¶é—´(æ¯«ç§’)
      
      # æ€§èƒ½ä¼˜åŒ–é…ç½®
      connection-test-query: SELECT 1  # è¿æ¥æµ‹è¯•è¯­å¥
      pool-name: HikariPool-1          # è¿æ¥æ± åç§°
```

**Javaé…ç½®æ–¹å¼**ï¼š
```java
@Configuration
public class HikariConfig {
    
    @Bean
    public DataSource dataSource() {
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        ds.setUsername("root");
        ds.setPassword("123456");
        ds.setMinimumIdle(5);
        ds.setMaximumPoolSize(20);
        return ds;
    }
}
```

---

## 5. âš™ï¸ è¿æ¥æ± å‚æ•°è°ƒä¼˜


### 5.1 æ ¸å¿ƒå‚æ•°è¯¦è§£


**ğŸ”¸ è¿æ¥æ•°é‡å‚æ•°**ï¼š

| å‚æ•°å | å«ä¹‰ | è®¾ç½®å»ºè®® | å½±å“ |
|-------|------|---------|------|
| `åˆå§‹è¿æ¥æ•°` | å¯åŠ¨æ—¶åˆ›å»ºçš„è¿æ¥æ•° | 5-10 | å¯åŠ¨é€Ÿåº¦vsåˆå§‹å¯ç”¨æ€§ |
| `æœ€å°ç©ºé—²è¿æ¥` | æ± ä¸­ä¿æŒçš„æœ€å°‘è¿æ¥ | 5-10 | èµ„æºå ç”¨vså“åº”é€Ÿåº¦ |
| `æœ€å¤§è¿æ¥æ•°` | æ± ä¸­æœ€å¤šè¿æ¥æ•° | æ ¹æ®å¹¶å‘è®¡ç®— | å¹¶å‘èƒ½åŠ›vsèµ„æºæ¶ˆè€— |

**ğŸ”¸ æ—¶é—´å‚æ•°**ï¼š

| å‚æ•°å | å«ä¹‰ | è®¾ç½®å»ºè®® | ä½œç”¨ |
|-------|------|---------|------|
| `è¿æ¥è¶…æ—¶` | è·å–è¿æ¥çš„ç­‰å¾…æ—¶é—´ | 30ç§’ | é˜²æ­¢æ— é™ç­‰å¾… |
| `ç©ºé—²è¶…æ—¶` | è¿æ¥ç©ºé—²å¤šä¹…è¢«å›æ”¶ | 10åˆ†é’Ÿ | é‡Šæ”¾é—²ç½®èµ„æº |
| `æœ€å¤§å­˜æ´»æ—¶é—´` | è¿æ¥æœ€é•¿ä½¿ç”¨æ—¶é—´ | 30åˆ†é’Ÿ | é˜²æ­¢è¿æ¥è€åŒ– |

### 5.2 å‚æ•°è°ƒä¼˜å®æˆ˜


**åœºæ™¯1ï¼šé«˜å¹¶å‘Webåº”ç”¨**
```yaml
# å‡è®¾ï¼š500å¹¶å‘ç”¨æˆ·ï¼Œæ¯ä¸ªè¯·æ±‚æŒç»­100ms
hikari:
  maximum-pool-size: 50        # è®¡ç®—ï¼š500 * 0.1 / 1 = 50
  minimum-idle: 10
  connection-timeout: 20000    # 20ç§’è¶…æ—¶
  idle-timeout: 300000         # 5åˆ†é’Ÿç©ºé—²å›æ”¶
```

**åœºæ™¯2ï¼šä½å¹¶å‘å†…éƒ¨ç³»ç»Ÿ**
```yaml
# å‡è®¾ï¼š50å¹¶å‘ç”¨æˆ·ï¼Œè¯·æ±‚è¾ƒæ…¢
hikari:
  maximum-pool-size: 20        # é€‚åº¦é™ä½
  minimum-idle: 5
  connection-timeout: 30000
  idle-timeout: 600000         # 10åˆ†é’Ÿç©ºé—²å›æ”¶
```

### 5.3 æœ€å¤§è¿æ¥æ•°è®¡ç®—å…¬å¼


> ğŸ’¡ **ç»éªŒå…¬å¼**ï¼šæœ€å¤§è¿æ¥æ•° = (æ ¸å¿ƒçº¿ç¨‹æ•° Ã— 2) + æœ‰æ•ˆç£ç›˜æ•°

```
å®é™…æ¡ˆä¾‹è®¡ç®—ï¼š

ç¯å¢ƒï¼š
- 4æ ¸CPU
- 2å—SSDç¡¬ç›˜
- æ•°æ®åº“åœ¨åŒä¸€å°æœºå™¨

è®¡ç®—ï¼š
æœ€å¤§è¿æ¥æ•° = (4 Ã— 2) + 2 = 10

å¦‚æœæ•°æ®åº“åœ¨ç‹¬ç«‹æœåŠ¡å™¨ï¼š
æœ€å¤§è¿æ¥æ•° = 4 Ã— 2 = 8ï¼ˆç£ç›˜æ•°ä¸è®¡å…¥ï¼‰
```

**æ›´ç²¾å‡†çš„è®¡ç®—**ï¼š
```
æœ€å¤§è¿æ¥æ•° = (TPS Ã— å¹³å‡å“åº”æ—¶é—´) / 1000

ç¤ºä¾‹ï¼š
- ç›®æ ‡TPSï¼š1000
- å¹³å‡å“åº”æ—¶é—´ï¼š50ms
è®¡ç®—ï¼š(1000 Ã— 50) / 1000 = 50ä¸ªè¿æ¥
```

### 5.4 ç›‘æ§ä¸è¯Šæ–­


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
- âœ… **æ´»è·ƒè¿æ¥æ•°** - æ­£åœ¨ä½¿ç”¨çš„è¿æ¥
- âœ… **ç©ºé—²è¿æ¥æ•°** - æ± ä¸­å¾…ç”¨çš„è¿æ¥  
- âœ… **ç­‰å¾…çº¿ç¨‹æ•°** - ç­‰å¾…è·å–è¿æ¥çš„è¯·æ±‚
- âœ… **è·å–è¿æ¥æ—¶é—´** - å¹³å‡è·å–è€—æ—¶
- âœ… **è¿æ¥ä½¿ç”¨ç‡** - æ´»è·ƒ/æœ€å¤§æ¯”ä¾‹

**æ€§èƒ½é—®é¢˜è¯Šæ–­**ï¼š
```
é—®é¢˜1ï¼šé¢‘ç¹è¶…æ—¶
åŸå› ï¼šæœ€å¤§è¿æ¥æ•°è¿‡å° æˆ– SQLæ‰§è¡Œå¤ªæ…¢
è§£å†³ï¼šå¢å¤§æœ€å¤§è¿æ¥æ•° æˆ– ä¼˜åŒ–SQL

é—®é¢˜2ï¼šè¿æ¥æ•°é£™å‡
åŸå› ï¼šè¿æ¥æ³„æ¼ï¼ˆæœªé‡Šæ”¾ï¼‰
è§£å†³ï¼šæ£€æŸ¥ä»£ç æ˜¯å¦æ­£ç¡®å…³é—­è¿æ¥

é—®é¢˜3ï¼šç©ºé—²è¿æ¥è¿‡å¤š
åŸå› ï¼šæœ€å°ç©ºé—²æ•°è®¾ç½®è¿‡å¤§
è§£å†³ï¼šé™ä½æœ€å°ç©ºé—²è¿æ¥æ•°
```

---

## 6. ğŸš€ é«˜çº§é…ç½®æ–¹æ¡ˆ


### 6.1 æ•°æ®æºç›‘æ§é…ç½®


**Druidç›‘æ§é¢æ¿é…ç½®**ï¼š
```java
@Configuration
public class DruidConfig {
    
    @Bean
    public ServletRegistrationBean<StatViewServlet> druidStatViewServlet() {
        ServletRegistrationBean<StatViewServlet> bean = 
            new ServletRegistrationBean<>(new StatViewServlet(), "/druid/*");
        
        // ç›‘æ§é¡µé¢ç™»å½•é…ç½®
        Map<String, String> params = new HashMap<>();
        params.put("loginUsername", "admin");
        params.put("loginPassword", "123456");
        params.put("resetEnable", "false");  // ç¦ç”¨é‡ç½®æŒ‰é’®
        bean.setInitParameters(params);
        
        return bean;
    }
    
    @Bean
    public FilterRegistrationBean<WebStatFilter> druidWebStatFilter() {
        FilterRegistrationBean<WebStatFilter> bean = 
            new FilterRegistrationBean<>(new WebStatFilter());
        
        // è¿‡æ»¤è§„åˆ™
        bean.addUrlPatterns("/*");
        bean.addInitParameter("exclusions", "*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*");
        
        return bean;
    }
}
```

**è®¿é—®ç›‘æ§é¢æ¿**ï¼š
```
URL: http://localhost:8080/druid/index.html
ç”¨æˆ·å: admin
å¯†ç : 123456

ç›‘æ§é¡µé¢å±•ç¤ºå†…å®¹ï¼š
â”Œâ”€ SQLæ‰§è¡Œç»Ÿè®¡ â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œæ¬¡æ•°: 1250æ¬¡     â”‚
â”‚ æœ€æ…¢SQL: 2.5ç§’      â”‚
â”‚ é”™è¯¯æ¬¡æ•°: 5æ¬¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 å¤šæ•°æ®æºé…ç½®


**åœºæ™¯è¯´æ˜**ï¼šä¸€ä¸ªåº”ç”¨è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼ˆå¦‚ï¼šä¸»åº“+ä»åº“ï¼Œæˆ–ä¸šåŠ¡åº“+æ—¥å¿—åº“ï¼‰

**é…ç½®å¤šæ•°æ®æº**ï¼š
```java
@Configuration
public class MultiDataSourceConfig {
    
    // ä¸»æ•°æ®æº
    @Bean
    @Primary
    @ConfigurationProperties("spring.datasource.master")
    public DataSource masterDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    // ä»æ•°æ®æº
    @Bean
    @ConfigurationProperties("spring.datasource.slave")
    public DataSource slaveDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    // ä¸»åº“JdbcTemplate
    @Bean
    public JdbcTemplate masterJdbcTemplate(@Qualifier("masterDataSource") DataSource ds) {
        return new JdbcTemplate(ds);
    }
    
    // ä»åº“JdbcTemplate
    @Bean
    public JdbcTemplate slaveJdbcTemplate(@Qualifier("slaveDataSource") DataSource ds) {
        return new JdbcTemplate(ds);
    }
}
```

**é…ç½®æ–‡ä»¶**ï¼š
```yaml
spring:
  datasource:
    master:
      jdbc-url: jdbc:mysql://192.168.1.100:3306/master_db
      username: root
      password: 123456
    slave:
      jdbc-url: jdbc:mysql://192.168.1.101:3306/slave_db
      username: root
      password: 123456
```

**ä½¿ç”¨å¤šæ•°æ®æº**ï¼š
```java
@Service
public class UserService {
    
    @Autowired
    @Qualifier("masterJdbcTemplate")
    private JdbcTemplate masterJdbc;
    
    @Autowired
    @Qualifier("slaveJdbcTemplate")
    private JdbcTemplate slaveJdbc;
    
    // å†™æ“ä½œç”¨ä¸»åº“
    public void save(User user) {
        masterJdbc.update("INSERT INTO user ...", ...);
    }
    
    // è¯»æ“ä½œç”¨ä»åº“
    public List<User> findAll() {
        return slaveJdbc.query("SELECT * FROM user", ...);
    }
}
```

### 6.3 è¯»å†™åˆ†ç¦»é…ç½®


**è¯»å†™åˆ†ç¦»åŸç†**ï¼š
```
å†™æ“ä½œï¼ˆINSERT/UPDATE/DELETEï¼‰
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»åº“   â”‚ â† å†™å…¥æ•°æ®
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ æ•°æ®åŒæ­¥
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»åº“   â”‚ â† è¯»å–æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†‘
è¯»æ“ä½œï¼ˆSELECTï¼‰
```

**åŠ¨æ€æ•°æ®æºå®ç°**ï¼š
```java
// 1. å®šä¹‰æ•°æ®æºç±»å‹
public enum DataSourceType {
    MASTER, SLAVE
}

// 2. æ•°æ®æºä¸Šä¸‹æ–‡ï¼ˆçº¿ç¨‹éš”ç¦»ï¼‰
public class DataSourceContextHolder {
    private static final ThreadLocal<DataSourceType> context = new ThreadLocal<>();
    
    public static void setDataSource(DataSourceType type) {
        context.set(type);
    }
    
    public static DataSourceType getDataSource() {
        return context.get();
    }
    
    public static void clear() {
        context.remove();
    }
}

// 3. åŠ¨æ€æ•°æ®æºè·¯ç”±
public class DynamicDataSource extends AbstractRoutingDataSource {
    
    @Override
    protected Object determineCurrentLookupKey() {
        return DataSourceContextHolder.getDataSource();
    }
}

// 4. AOPè‡ªåŠ¨åˆ‡æ¢æ•°æ®æº
@Aspect
@Component
public class DataSourceAspect {
    
    @Before("execution(* com.example.service.*.*(..))")
    public void before(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        
        // æ ¹æ®æ–¹æ³•ååˆ¤æ–­è¯»å†™
        if (methodName.startsWith("find") || methodName.startsWith("get")) {
            DataSourceContextHolder.setDataSource(DataSourceType.SLAVE);
        } else {
            DataSourceContextHolder.setDataSource(DataSourceType.MASTER);
        }
    }
    
    @After("execution(* com.example.service.*.*(..))")
    public void after() {
        DataSourceContextHolder.clear();
    }
}
```

**ä½¿ç”¨æ³¨è§£æ–¹å¼**ï¼š
```java
// è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataSource {
    DataSourceType value() default DataSourceType.MASTER;
}

// ä½¿ç”¨ç¤ºä¾‹
@Service
public class UserService {
    
    @DataSource(DataSourceType.MASTER)
    public void save(User user) {
        // è‡ªåŠ¨ä½¿ç”¨ä¸»åº“
    }
    
    @DataSource(DataSourceType.SLAVE)
    public List<User> findAll() {
        // è‡ªåŠ¨ä½¿ç”¨ä»åº“
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®æºæœ¬è´¨ï¼šè¿æ¥æ±  = æå‰å‡†å¤‡å¥½çš„æ•°æ®åº“è¿æ¥é›†åˆ
ğŸ”¸ DataSourceæ¥å£ï¼šJavaè§„èŒƒå®šä¹‰çš„ç»Ÿä¸€è·å–è¿æ¥æ–¹å¼
ğŸ”¸ JdbcTemplateï¼šSpringæä¾›çš„ç®€åŒ–JDBCæ“ä½œçš„å·¥å…·ç±»
ğŸ”¸ è¿æ¥æ± é€‰å‹ï¼šHikariCP(æ€§èƒ½) > Druid(ç›‘æ§) > C3P0(ç¨³å®š)
ğŸ”¸ å‚æ•°è°ƒä¼˜ï¼šæ ¹æ®å¹¶å‘é‡å’Œå“åº”æ—¶é—´åˆç†è®¾ç½®è¿æ¥æ•°
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± **
```
æ ¸å¿ƒåŸå› ï¼š
- åˆ›å»ºè¿æ¥æ…¢ï¼ˆ100-200msï¼‰
- é¢‘ç¹åˆ›å»ºæµªè´¹èµ„æº
- è¿æ¥æ•°éš¾ä»¥æ§åˆ¶

è§£å†³æ–¹æ¡ˆï¼š
- é¢„å…ˆåˆ›å»ºè¿æ¥
- é‡å¤ä½¿ç”¨è¿æ¥
- é™åˆ¶æœ€å¤§æ•°é‡
```

**ğŸ”¹ è¿æ¥æ± å‚æ•°é…ç½®åŸåˆ™**
```
æœ€å¤§è¿æ¥æ•°ï¼š
- ä¸æ˜¯è¶Šå¤§è¶Šå¥½
- å—CPUæ ¸å¿ƒæ•°é™åˆ¶
- å—æ•°æ®åº“æ‰¿è½½èƒ½åŠ›é™åˆ¶

æœ€å°ç©ºé—²è¿æ¥ï¼š
- ä¿è¯å“åº”é€Ÿåº¦
- é¿å…èµ„æºæµªè´¹
- ä¸€èˆ¬è®¾ç½®5-10ä¸ª

è¶…æ—¶æ—¶é—´ï¼š
- é˜²æ­¢æ— é™ç­‰å¾…
- åŠæ—¶é‡Šæ”¾è¿æ¥
- ä¸€èˆ¬20-30ç§’
```

**ğŸ”¹ ä¸‰å¤§è¿æ¥æ± å¯¹æ¯”**
```
HikariCP:  âš¡å¿« â­è½»é‡ âŒç›‘æ§å¼±
Druid:     ğŸ’ªåŠŸèƒ½å¼º ğŸ“Šç›‘æ§å¥½ âš–ï¸æ€§èƒ½ä¸­ç­‰  
C3P0:      ğŸ“¦ç¨³å®š â°è€ç‰Œ ğŸ“‰æ€§èƒ½ä¸€èˆ¬
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**åœºæ™¯é€‰æ‹©å»ºè®®**ï¼š

| åº”ç”¨åœºæ™¯ | æ¨èè¿æ¥æ±  | ç†ç”± |
|---------|-----------|------|
| **SpringBootæ–°é¡¹ç›®** | HikariCP | é»˜è®¤é›†æˆï¼Œæ€§èƒ½æœ€ä¼˜ |
| **éœ€è¦SQLç›‘æ§** | Druid | å†…ç½®ç›‘æ§é¢æ¿ |
| **è€é¡¹ç›®ç»´æŠ¤** | C3P0 | ä¿æŒç¨³å®šï¼Œä¸æŠ˜è…¾ |
| **å¾®æœåŠ¡æ¶æ„** | HikariCP | è½»é‡å¿«é€Ÿ |

**é…ç½®æ£€æŸ¥æ¸…å•**ï¼š
- âœ… æ•°æ®åº“é©±åŠ¨ç‰ˆæœ¬åŒ¹é…
- âœ… è¿æ¥æ± å‚æ•°åˆç†è®¾ç½®
- âœ… å¼€å¯SQLæ—¥å¿—ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- âœ… é…ç½®ç›‘æ§é¢æ¿ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´
- âœ… é…ç½®è¿æ¥æµ‹è¯•æŸ¥è¯¢

**å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š
```
é—®é¢˜ï¼šè·å–è¿æ¥è¶…æ—¶
æ£€æŸ¥ï¼š
1. æœ€å¤§è¿æ¥æ•°æ˜¯å¦è¿‡å°
2. SQLæ‰§è¡Œæ˜¯å¦è¿‡æ…¢
3. æ˜¯å¦å­˜åœ¨è¿æ¥æ³„æ¼

é—®é¢˜ï¼šè¿æ¥æ± è€—å°½
æ£€æŸ¥ï¼š
1. å¹¶å‘é‡æ˜¯å¦è¶…é¢„æœŸ
2. è¿æ¥æ˜¯å¦æ­£ç¡®é‡Šæ”¾
3. æ•°æ®åº“æ€§èƒ½æ˜¯å¦æ­£å¸¸

é—®é¢˜ï¼šå“åº”å˜æ…¢
æ£€æŸ¥ï¼š
1. æ´»è·ƒè¿æ¥æ•°æ˜¯å¦è¿‡é«˜
2. æ…¢SQLæ˜¯å¦è¿‡å¤š
3. ç½‘ç»œå»¶è¿Ÿæ˜¯å¦æ­£å¸¸
```

**æœ€ä½³å®è·µå»ºè®®**ï¼š
1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨ç®€å•é…ç½®ï¼Œå¼€å¯SQLæ—¥å¿—
2. **æµ‹è¯•ç¯å¢ƒ**ï¼šæ¨¡æ‹Ÿç”Ÿäº§å‚æ•°ï¼Œè¿›è¡Œå‹åŠ›æµ‹è¯•
3. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¼€å¯ç›‘æ§ï¼Œè®¾ç½®åˆç†å‘Šè­¦é˜ˆå€¼
4. **å®šæœŸæ£€æŸ¥**ï¼šç›‘æ§è¿æ¥æ± çŠ¶æ€ï¼ŒåŠæ—¶è°ƒæ•´å‚æ•°

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
æ•°æ®æºå¥½æ¯”æ°´é¾™å¤´ï¼Œè¿æ¥å¤ç”¨æ•ˆç‡é«˜
å‚æ•°é…ç½®è¦åˆç†ï¼Œç›‘æ§è°ƒä¼˜ä¸å¯å°‘
HikariCPæ€§èƒ½å¼ºï¼ŒDruidç›‘æ§åŠŸèƒ½å¥½
è¯»å†™åˆ†ç¦»æ¶æ„ä¼˜ï¼Œå¤šåº“é…ç½®è¦çŸ¥é“
```