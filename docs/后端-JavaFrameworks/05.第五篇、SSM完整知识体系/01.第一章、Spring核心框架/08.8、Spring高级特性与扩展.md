---
title: 8ã€Springé«˜çº§ç‰¹æ€§ä¸æ‰©å±•
---
## ğŸ“š ç›®å½•

1. [Beanå¾ªç¯ä¾èµ–é—®é¢˜ä¸è§£å†³](#1-Beanå¾ªç¯ä¾èµ–é—®é¢˜ä¸è§£å†³)
2. [FactoryBeanå·¥å‚Beanæœºåˆ¶](#2-FactoryBeanå·¥å‚Beanæœºåˆ¶)
3. [BeanPostProcessoråç½®å¤„ç†å™¨](#3-BeanPostProcessoråç½®å¤„ç†å™¨)
4. [äº‹ä»¶ç›‘å¬æœºåˆ¶](#4-äº‹ä»¶ç›‘å¬æœºåˆ¶)
5. [SpELè¡¨è¾¾å¼è¯­è¨€](#5-SpELè¡¨è¾¾å¼è¯­è¨€)
6. [Awareæ¥å£å›è°ƒæœºåˆ¶](#6-Awareæ¥å£å›è°ƒæœºåˆ¶)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ Beanå¾ªç¯ä¾èµ–é—®é¢˜ä¸è§£å†³


### 1.1 ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–


**é€šä¿—ç†è§£**ï¼šå°±åƒä¸¤ä¸ªäººäº’ç›¸ç­‰å¯¹æ–¹å…ˆå¼€å£è¯´è¯ï¼Œç»“æœè°éƒ½è¯´ä¸äº†è¯ã€‚

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
å°æ˜ç­‰å°çº¢å…ˆåšä½œä¸šï¼Œä»–æ‰åš
å°çº¢ç­‰å°æ˜å…ˆåšä½œä¸šï¼Œå¥¹æ‰åš
â†’ ç»“æœè°éƒ½åšä¸äº†ä½œä¸šï¼ˆæ­»é”ï¼‰

Springä¸­çš„æƒ…å†µï¼š
Aå¯¹è±¡éœ€è¦Bå¯¹è±¡æ‰èƒ½åˆ›å»ºå®Œæˆ
Bå¯¹è±¡éœ€è¦Aå¯¹è±¡æ‰èƒ½åˆ›å»ºå®Œæˆ  
â†’ å¦‚æœå¤„ç†ä¸å½“ï¼Œè°éƒ½åˆ›å»ºä¸äº†
```

**å¾ªç¯ä¾èµ–ç¤ºæ„å›¾**ï¼š
```
     â”Œâ”€â”€â”€â”€â”€â”
     â”‚  A  â”‚â”€â”€â”€â”€éœ€è¦â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”˜          â”‚
        â†‘             â†“
        â”‚          â”Œâ”€â”€â”€â”€â”€â”
        â””â”€â”€â”€éœ€è¦â”€â”€â”€â”‚  B  â”‚
                   â””â”€â”€â”€â”€â”€â”˜
```

### 1.2 å¾ªç¯ä¾èµ–çš„ä¸‰ç§æƒ…å†µ


| ä¾èµ–ç±»å‹ | **èƒ½å¦è§£å†³** | **åŸå› è¯´æ˜** |
|---------|------------|-------------|
| ğŸŸ¢ **å•ä¾‹Beanå±æ€§æ³¨å…¥** | `âœ… å¯ä»¥è§£å†³` | `é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶` |
| ğŸ”´ **æ„é€ å™¨æ³¨å…¥** | `âŒ æ— æ³•è§£å†³` | `åˆ›å»ºå¯¹è±¡æ—¶å°±éœ€è¦ä¾èµ–` |
| ğŸ”´ **prototypeåŸå‹Bean** | `âŒ æ— æ³•è§£å†³` | `æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡` |

**ç¤ºä¾‹è¯´æ˜**ï¼š

```java
// âœ… è¿™ç§å¯ä»¥è§£å†³ï¼ˆå±æ€§æ³¨å…¥çš„å•ä¾‹Beanï¼‰
@Service
public class OrderService {
    @Autowired
    private UserService userService;  // å±æ€§æ³¨å…¥
}

@Service  
public class UserService {
    @Autowired
    private OrderService orderService;  // å±æ€§æ³¨å…¥
}

// âŒ è¿™ç§æ— æ³•è§£å†³ï¼ˆæ„é€ å™¨æ³¨å…¥ï¼‰
@Service
public class A {
    private B b;
    public A(B b) {  // æ„é€ å™¨æ³¨å…¥
        this.b = b;
    }
}

@Service
public class B {
    private A a;
    public B(A a) {  // æ„é€ å™¨æ³¨å…¥
        this.a = a;
    }
}
```

### 1.3 ä¸‰çº§ç¼“å­˜è§£å†³æœºåˆ¶


**æ ¸å¿ƒæ€æƒ³**ï¼šå…ˆåˆ›å»ºä¸€ä¸ª"åŠæˆå“"å¯¹è±¡ï¼Œè®©åˆ«äººå¯ä»¥å…ˆç”¨ç€ï¼Œè‡ªå·±æ…¢æ…¢å®Œå–„ã€‚

> ğŸ’¡ **ä¸‰çº§ç¼“å­˜çš„æœ¬è´¨**ï¼šå°±æ˜¯Springç”¨ä¸‰ä¸ªMapæ¥å­˜æ”¾ä¸åŒçŠ¶æ€çš„Beanå¯¹è±¡

**ä¸‰çº§ç¼“å­˜è¯¦è§£**ï¼š

```
ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰ï¼š
ä½œç”¨ï¼šå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„Beanï¼ˆæˆå“ï¼‰
æ—¶æœºï¼šBeanå®Œå…¨åˆ›å»ºå¥½åæ”¾å…¥
æ¯”å–»ï¼šå·²è£…ä¿®å¥½å¯ä»¥å…¥ä½çš„æˆ¿å­

äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰ï¼š
ä½œç”¨ï¼šå­˜æ”¾æ—©æœŸçš„Beanå¼•ç”¨ï¼ˆåŠæˆå“ï¼‰
æ—¶æœºï¼šBeanå®ä¾‹åŒ–åï¼Œä½†å±æ€§è¿˜æ²¡æ³¨å…¥æ—¶
æ¯”å–»ï¼šæˆ¿å­å»ºå¥½äº†ï¼Œä½†è¿˜æ²¡è£…ä¿®

ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰ï¼š
ä½œç”¨ï¼šå­˜æ”¾Beançš„åˆ›å»ºå·¥å‚
æ—¶æœºï¼šBeanå®ä¾‹åŒ–åç«‹å³æ”¾å…¥
æ¯”å–»ï¼šå»ºæˆ¿å­çš„æ–½å·¥é˜Ÿï¼Œéšæ—¶å¯ä»¥å¼€å·¥
```

### 1.4 è§£å†³è¿‡ç¨‹è¯¦è§£


**â­ åŸºç¡€çº§åˆ« - è§£å†³æµç¨‹**

å‡è®¾åˆ›å»ºAå’ŒBä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„Beanï¼š

```
æ­¥éª¤â‘  åˆ›å»ºAå¯¹è±¡ï¼š
- å®ä¾‹åŒ–Aï¼ˆè°ƒç”¨æ„é€ æ–¹æ³•ï¼‰
- æŠŠAçš„å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜
- å¼€å§‹å¡«å……Açš„å±æ€§

æ­¥éª¤â‘¡ å‘ç°Aéœ€è¦Bï¼š
- å»å®¹å™¨ä¸­æ‰¾B
- å‘ç°Bè¿˜æ²¡åˆ›å»º
- å¼€å§‹åˆ›å»ºB

æ­¥éª¤â‘¢ åˆ›å»ºBå¯¹è±¡ï¼š
- å®ä¾‹åŒ–Bï¼ˆè°ƒç”¨æ„é€ æ–¹æ³•ï¼‰
- æŠŠBçš„å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜  
- å¼€å§‹å¡«å……Bçš„å±æ€§

æ­¥éª¤â‘£ å‘ç°Béœ€è¦Aï¼š
- å»ä¸‰çº§ç¼“å­˜æ‰¾Açš„å·¥å‚
- é€šè¿‡å·¥å‚è·å–Açš„æ—©æœŸå¼•ç”¨
- æŠŠAçš„æ—©æœŸå¼•ç”¨æ”¾å…¥äºŒçº§ç¼“å­˜
- BæˆåŠŸæ³¨å…¥Açš„å¼•ç”¨

æ­¥éª¤â‘¤ Båˆ›å»ºå®Œæˆï¼š
- Bçš„å±æ€§éƒ½æ³¨å…¥å¥½äº†
- æŠŠå®Œæ•´çš„Bæ”¾å…¥ä¸€çº§ç¼“å­˜
- è¿”å›Bç»™A

æ­¥éª¤â‘¥ Aåˆ›å»ºå®Œæˆï¼š
- AæˆåŠŸæ³¨å…¥B
- Açš„å±æ€§éƒ½æ³¨å…¥å¥½äº†
- æŠŠå®Œæ•´çš„Aæ”¾å…¥ä¸€çº§ç¼“å­˜
```

**æµç¨‹å›¾ç¤º**ï¼š
```
åˆ›å»ºA                     åˆ›å»ºB
  â”‚                         â”‚
  â”œâ”€å®ä¾‹åŒ–A                 â”œâ”€å®ä¾‹åŒ–B
  â”‚                         â”‚
  â”œâ”€Aå·¥å‚â†’ä¸‰çº§ç¼“å­˜           â”œâ”€Bå·¥å‚â†’ä¸‰çº§ç¼“å­˜
  â”‚                         â”‚
  â”œâ”€å¡«å……Aå±æ€§(éœ€è¦B)         â”œâ”€å¡«å……Bå±æ€§(éœ€è¦A)
  â”‚         â”‚               â”‚         â”‚
  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚         â”‚
  â”‚              å¼€å§‹åˆ›å»ºB   â”‚         â”‚
  â”‚                         â”‚   ä»ä¸‰çº§ç¼“å­˜è·å–A
  â”‚                         â”‚         â†“
  â”‚                         â”‚   Aæ—©æœŸå¼•ç”¨â†’äºŒçº§ç¼“å­˜
  â”‚                         â”‚         â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                         â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Båˆ›å»ºå®Œæˆ
  â”‚       è¿”å›B             â”‚
  â”‚                         â”‚
  â”œâ”€Aåˆ›å»ºå®Œæˆ               â”‚
  â”‚                         â”‚
  â””â†’ä¸€çº§ç¼“å­˜                â””â†’ä¸€çº§ç¼“å­˜
```

### 1.5 ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜


> âš ï¸ **å¸¸è§ç–‘é—®**ï¼šåªç”¨ä¸¤çº§ç¼“å­˜ä¸è¡Œå—ï¼Ÿ

**ç­”æ¡ˆ**ï¼šå¤„ç†æ™®é€šBeanå¯ä»¥ï¼Œä½†å¤„ç†AOPä»£ç†å¯¹è±¡éœ€è¦ä¸‰çº§ç¼“å­˜ã€‚

```
ä¸¤çº§ç¼“å­˜çš„é—®é¢˜ï¼š
å¦‚æœBéœ€è¦çš„æ˜¯Açš„ä»£ç†å¯¹è±¡ï¼Œä¸æ˜¯åŸå§‹Aå¯¹è±¡
ä¸¤çº§ç¼“å­˜æ— æ³•åœ¨æ­£ç¡®çš„æ—¶æœºåˆ›å»ºä»£ç†

ä¸‰çº§ç¼“å­˜çš„ä¼˜åŠ¿ï¼š
é€šè¿‡å·¥å‚æ¨¡å¼ï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶å†³å®šï¼š
- è¿”å›åŸå§‹å¯¹è±¡
- è¿˜æ˜¯è¿”å›ä»£ç†å¯¹è±¡
ä¿è¯äº†AOPç­‰åŠŸèƒ½çš„æ­£ç¡®æ€§
```

---

## 2. ğŸ­ FactoryBeanå·¥å‚Beanæœºåˆ¶


### 2.1 FactoryBeanæ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šæ™®é€šBeanåƒæ˜¯ç›´æ¥ä¹°æˆå“ï¼ŒFactoryBeanåƒæ˜¯ä¹°ä¸€ä¸ªèƒ½ç”Ÿäº§äº§å“çš„å·¥å‚ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šFactoryBeanæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Beanï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå·¥å‚ï¼Œç”¨æ¥åˆ›å»ºå…¶ä»–å¤æ‚çš„Beanå¯¹è±¡

**å¯¹æ¯”ç†è§£**ï¼š

| ç‰¹æ€§ | **æ™®é€šBean** | **FactoryBean** |
|------|------------|----------------|
| ğŸ“¦ **è¿”å›å†…å®¹** | `è¿”å›è‡ªå·±` | `è¿”å›getObject()åˆ›å»ºçš„å¯¹è±¡` |
| ğŸ¯ **ä½¿ç”¨åœºæ™¯** | `ç®€å•å¯¹è±¡` | `å¤æ‚å¯¹è±¡ã€éœ€è¦ç‰¹æ®Šåˆ›å»ºé€»è¾‘` |
| ğŸ”§ **è·å–æ–¹å¼** | `ç›´æ¥è·å–` | `é»˜è®¤è·å–äº§å“ï¼ŒåŠ &è·å–å·¥å‚` |

### 2.2 FactoryBeanæ¥å£è¯¦è§£


**æ¥å£å®šä¹‰**ï¼š
```java
public interface FactoryBean<T> {
    // â‘  è¿”å›åˆ›å»ºçš„å¯¹è±¡ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
    T getObject() throws Exception;
    
    // â‘¡ è¿”å›å¯¹è±¡çš„ç±»å‹
    Class<?> getObjectType();
    
    // â‘¢ æ˜¯å¦æ˜¯å•ä¾‹ï¼ˆé»˜è®¤trueï¼‰
    default boolean isSingleton() {
        return true;
    }
}
```

**æ–¹æ³•è¯´æ˜**ï¼š

- `getObject()`ï¼šâ­â­â­ æœ€é‡è¦ï¼Œå®šä¹‰å¦‚ä½•åˆ›å»ºç›®æ ‡å¯¹è±¡
- `getObjectType()`ï¼šå‘Šè¯‰Springåˆ›å»ºçš„æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡
- `isSingleton()`ï¼šæ˜¯å¦æ¯æ¬¡è¿”å›åŒä¸€ä¸ªå¯¹è±¡

### 2.3 å®é™…åº”ç”¨ç¤ºä¾‹


**â­â­ ä¸­çº§ç¤ºä¾‹ - åˆ›å»ºæ•°æ®åº“è¿æ¥æ± **

```java
// åˆ›å»ºæ•°æ®æºçš„å·¥å‚Bean
@Component
public class DataSourceFactoryBean implements FactoryBean<DataSource> {
    
    private String url = "jdbc:mysql://localhost:3306/test";
    private String username = "root";
    private String password = "123456";
    
    @Override
    public DataSource getObject() throws Exception {
        // å¤æ‚çš„åˆ›å»ºé€»è¾‘
        DruidDataSource dataSource = new DruidDataSource();
        dataSource.setUrl(url);
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        // å„ç§å¤æ‚é…ç½®...
        dataSource.init();
        return dataSource;
    }
    
    @Override
    public Class<?> getObjectType() {
        return DataSource.class;
    }
    
    @Override
    public boolean isSingleton() {
        return true;  // å•ä¾‹ï¼Œå…¨å±€å…±ç”¨ä¸€ä¸ªè¿æ¥æ± 
    }
}
```

**ä½¿ç”¨æ–¹å¼**ï¼š
```java
@Service
public class UserService {
    @Autowired
    private DataSource dataSource;  // æ³¨å…¥çš„æ˜¯DataSourceï¼Œä¸æ˜¯FactoryBean
    
    // å¦‚æœæƒ³è·å–FactoryBeanæœ¬èº«ï¼š
    // @Autowired
    // private FactoryBean dataSourceFactoryBean;  // æˆ–ç”¨&dataSourceFactoryBean
}
```

### 2.4 è·å–FactoryBeançš„ä¸¤ç§æ–¹å¼


```
è·å–äº§å“å¯¹è±¡ï¼ˆé»˜è®¤ï¼‰ï¼š
context.getBean("dataSourceFactoryBean")
â†’ è¿”å›DataSourceå¯¹è±¡

è·å–å·¥å‚å¯¹è±¡æœ¬èº«ï¼ˆåŠ &å‰ç¼€ï¼‰ï¼š
context.getBean("&dataSourceFactoryBean")  
â†’ è¿”å›DataSourceFactoryBeanå¯¹è±¡
```

> ğŸ’¡ **è®°å¿†æŠ€å·§**ï¼š& ç¬¦å·åƒä¸€ä¸ªå·¥å‚çš„æ ‡å¿—ï¼ŒåŠ äº†å°±æ˜¯è·å–å·¥å‚æœ¬èº«

### 2.5 åº”ç”¨åœºæ™¯


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å¯¹è±¡åˆ›å»ºé€»è¾‘å¤æ‚ï¼ˆéœ€è¦å¤šæ­¥éª¤åˆå§‹åŒ–ï¼‰
- âœ… éœ€è¦æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆMyBatisã€Dubboç­‰ï¼‰
- âœ… éœ€è¦åŠ¨æ€åˆ›å»ºä¸åŒé…ç½®çš„å¯¹è±¡
- âœ… å¯¹è±¡åˆ›å»ºéœ€è¦ä¾èµ–å¤–éƒ¨èµ„æº

**å…¸å‹åº”ç”¨**ï¼š
- ğŸ”¸ MyBatisçš„SqlSessionFactoryBean
- ğŸ”¸ æ•°æ®æºè¿æ¥æ± çš„åˆ›å»º
- ğŸ”¸ RPCæ¡†æ¶çš„ä»£ç†å¯¹è±¡åˆ›å»º
- ğŸ”¸ å¤æ‚é…ç½®å¯¹è±¡çš„æ„å»º

---

## 3. ğŸ”§ BeanPostProcessoråç½®å¤„ç†å™¨


### 3.1 ä»€ä¹ˆæ˜¯åç½®å¤„ç†å™¨


**é€šä¿—ç†è§£**ï¼šåƒæ˜¯å·¥å‚æµæ°´çº¿ä¸Šçš„è´¨æ£€å‘˜ï¼Œåœ¨Beanåˆ›å»ºè¿‡ç¨‹ä¸­å¯ä»¥"æ’ä¸€è„š"åšäº›é¢å¤–å¤„ç†ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šBeanPostProcessoræ˜¯Springæä¾›çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥åœ¨Beanåˆå§‹åŒ–å‰åè¿›è¡Œè‡ªå®šä¹‰å¤„ç†

**å¤„ç†æ—¶æœºå›¾ç¤º**ï¼š
```
Beanç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼š

å®ä¾‹åŒ–Bean
    â†“
å±æ€§èµ‹å€¼  
    â†“
ã€å‰ç½®å¤„ç†ã€‘â† BeanPostProcessor.postProcessBeforeInitialization()
    â†“
åˆå§‹åŒ–æ–¹æ³•ï¼ˆ@PostConstructã€init-methodï¼‰
    â†“
ã€åç½®å¤„ç†ã€‘â† BeanPostProcessor.postProcessAfterInitialization()
    â†“
Beanå¯ç”¨
```

### 3.2 æ¥å£å®šä¹‰è¯¦è§£


```java
public interface BeanPostProcessor {
    
    // åˆå§‹åŒ–ä¹‹å‰è°ƒç”¨
    default Object postProcessBeforeInitialization(Object bean, String beanName) {
        return bean;  // è¿”å›åŸå¯¹è±¡æˆ–åŒ…è£…åçš„å¯¹è±¡
    }
    
    // åˆå§‹åŒ–ä¹‹åè°ƒç”¨  
    default Object postProcessAfterInitialization(Object bean, String beanName) {
        return bean;  // å¯ä»¥è¿”å›ä»£ç†å¯¹è±¡
    }
}
```

**å‚æ•°è¯´æ˜**ï¼š
- `bean`ï¼šå½“å‰æ­£åœ¨åˆå§‹åŒ–çš„Beanå¯¹è±¡
- `beanName`ï¼šBeançš„åç§°
- **è¿”å›å€¼**ï¼šå¯ä»¥è¿”å›åŸå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¿”å›åŒ…è£…/ä»£ç†åçš„å¯¹è±¡

### 3.3 å®é™…åº”ç”¨ç¤ºä¾‹


**â­ åŸºç¡€ç¤ºä¾‹ - è‡ªåŠ¨èµ‹å€¼å¤„ç†å™¨**

```java
// è‡ªå®šä¹‰æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AutoFill {
    String value();
}

// è‡ªå®šä¹‰åç½®å¤„ç†å™¨
@Component
public class AutoFillBeanPostProcessor implements BeanPostProcessor {
    
    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) {
        // è·å–æ‰€æœ‰å­—æ®µ
        Field[] fields = bean.getClass().getDeclaredFields();
        
        for (Field field : fields) {
            // æ£€æŸ¥æ˜¯å¦æœ‰@AutoFillæ³¨è§£
            if (field.isAnnotationPresent(AutoFill.class)) {
                AutoFill annotation = field.getAnnotation(AutoFill.class);
                field.setAccessible(true);
                try {
                    // è‡ªåŠ¨å¡«å……å€¼
                    field.set(bean, annotation.value());
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }
        return bean;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@Component
public class User {
    @AutoFill("ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ")
    private String remark;
    
    // åˆ›å»ºUseræ—¶ï¼Œremarkä¼šè‡ªåŠ¨è¢«èµ‹å€¼
}
```

### 3.4 BeanDefinitionRegistryPostProcessor


**å®šä½**ï¼šè¿™æ˜¯BeanPostProcessorçš„"åŠ å¼ºç‰ˆ"ï¼Œå¯ä»¥åŠ¨æ€æ³¨å†ŒBeanå®šä¹‰ã€‚

> âš ï¸ **åŒºåˆ«ç†è§£**ï¼š
> - BeanPostProcessorï¼šå¤„ç†Beanå®ä¾‹
> - BeanDefinitionRegistryPostProcessorï¼šå¤„ç†Beanå®šä¹‰

**æ¥å£å®šä¹‰**ï¼š
```java
public interface BeanDefinitionRegistryPostProcessor extends BeanFactoryPostProcessor {
    
    // å¯ä»¥åŠ¨æ€æ³¨å†ŒBeanå®šä¹‰
    void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry);
}
```

**â­â­ ä¸­çº§ç¤ºä¾‹ - åŠ¨æ€æ³¨å†ŒBean**

```java
@Component
public class MyBeanDefinitionRegistryPostProcessor 
    implements BeanDefinitionRegistryPostProcessor {
    
    @Override
    public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) {
        // åŠ¨æ€åˆ›å»ºBeanå®šä¹‰
        BeanDefinition beanDefinition = BeanDefinitionBuilder
            .genericBeanDefinition(UserService.class)
            .getBeanDefinition();
        
        // æ³¨å†Œåˆ°å®¹å™¨
        registry.registerBeanDefinition("dynamicUserService", beanDefinition);
        
        System.out.println("åŠ¨æ€æ³¨å†Œäº†UserService");
    }
    
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {
        // å¯ä»¥ä¿®æ”¹å·²æ³¨å†Œçš„Beanå®šä¹‰
    }
}
```

### 3.5 æ‰§è¡Œé¡ºåº


```
Springå®¹å™¨å¯åŠ¨é¡ºåºï¼š

1. BeanDefinitionRegistryPostProcessor.postProcessBeanDefinitionRegistry()
   â†“ (æ³¨å†ŒBeanå®šä¹‰)
   
2. BeanFactoryPostProcessor.postProcessBeanFactory()
   â†“ (ä¿®æ”¹Beanå®šä¹‰)
   
3. å®ä¾‹åŒ–Bean
   â†“
   
4. BeanPostProcessor.postProcessBeforeInitialization()
   â†“ (åˆå§‹åŒ–å‰å¤„ç†)
   
5. åˆå§‹åŒ–æ–¹æ³•
   â†“
   
6. BeanPostProcessor.postProcessAfterInitialization()
   â†“ (åˆå§‹åŒ–åå¤„ç†ï¼Œå¯è¿”å›ä»£ç†)
   
7. Beanå¯ç”¨
```

### 3.6 å…¸å‹åº”ç”¨åœºæ™¯


**BeanPostProcessoråº”ç”¨**ï¼š
- âœ… AOPä»£ç†å¯¹è±¡åˆ›å»ºï¼ˆæœ€é‡è¦ï¼‰
- âœ… è‡ªåŠ¨è£…é…å¢å¼º
- âœ… å±æ€§åŠ å¯†è§£å¯†
- âœ… æ—¥å¿—ã€ç›‘æ§åŸ‹ç‚¹

**BeanDefinitionRegistryPostProcessoråº”ç”¨**ï¼š
- âœ… MyBatisçš„Mapperæ¥å£æ³¨å†Œ
- âœ… Dubboçš„æœåŠ¡æ³¨å†Œ
- âœ… åŠ¨æ€æ•°æ®æºæ³¨å†Œ
- âœ… æ¡ä»¶åŒ–Beanæ³¨å†Œ

---

## 4. ğŸ“¡ äº‹ä»¶ç›‘å¬æœºåˆ¶


### 4.1 Springäº‹ä»¶æœºåˆ¶æ¦‚è¿°


**é€šä¿—ç†è§£**ï¼šå°±åƒç”Ÿæ´»ä¸­çš„"å‘é€šçŸ¥-æ”¶é€šçŸ¥"ï¼Œä¸€ä¸ªäººå‘æ¶ˆæ¯ï¼Œå¤šä¸ªäººå¯ä»¥æ”¶åˆ°å¹¶ä½œå‡ºå“åº”ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šSpringäº‹ä»¶æœºåˆ¶åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ç°ç»„ä»¶ä¹‹é—´çš„è§£è€¦é€šä¿¡

**è§’è‰²å…³ç³»å›¾**ï¼š
```
äº‹ä»¶å‘å¸ƒè€…                äº‹ä»¶                  äº‹ä»¶ç›‘å¬è€…
(Publisher)            (Event)              (Listener)
    â”‚                     â”‚                      â”‚
    â”œâ”€â”€å‘å¸ƒäº‹ä»¶â”€â”€â†’    ApplicationEvent      â†â”€â”€ç›‘å¬â”€â”€â”¤
    â”‚                     â”‚                      â”‚
    â”‚              Springå®¹å™¨ä¼ é€’                â”‚
    â”‚                     â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ ¸å¿ƒç»„ä»¶è¯¦è§£


**â‘  ApplicationEventï¼ˆäº‹ä»¶ï¼‰**

æ‰€æœ‰äº‹ä»¶éƒ½è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼š
```java
public abstract class ApplicationEvent extends EventObject {
    private final long timestamp;  // äº‹ä»¶å‘ç”Ÿæ—¶é—´
    
    public ApplicationEvent(Object source) {
        super(source);
        this.timestamp = System.currentTimeMillis();
    }
}
```

**â‘¡ ApplicationListenerï¼ˆç›‘å¬å™¨ï¼‰**

```java
@FunctionalInterface
public interface ApplicationListener<E extends ApplicationEvent> 
    extends EventListener {
    
    void onApplicationEvent(E event);  // å¤„ç†äº‹ä»¶çš„æ–¹æ³•
}
```

**â‘¢ ApplicationEventPublisherï¼ˆäº‹ä»¶å‘å¸ƒå™¨ï¼‰**

```java
public interface ApplicationEventPublisher {
    void publishEvent(ApplicationEvent event);  // å‘å¸ƒäº‹ä»¶
}
```

### 4.3 ä½¿ç”¨æ–¹å¼å¯¹æ¯”


**æ–¹å¼ä¸€ï¼šå®ç°ApplicationListeneræ¥å£**

```java
// 1. å®šä¹‰äº‹ä»¶
public class OrderCreatedEvent extends ApplicationEvent {
    private String orderId;
    
    public OrderCreatedEvent(Object source, String orderId) {
        super(source);
        this.orderId = orderId;
    }
    
    public String getOrderId() {
        return orderId;
    }
}

// 2. å®šä¹‰ç›‘å¬å™¨
@Component
public class OrderEventListener implements ApplicationListener<OrderCreatedEvent> {
    
    @Override
    public void onApplicationEvent(OrderCreatedEvent event) {
        System.out.println("æ”¶åˆ°è®¢å•åˆ›å»ºäº‹ä»¶ï¼š" + event.getOrderId());
        // æ‰§è¡Œç›¸å…³ä¸šåŠ¡ï¼šå‘é€çŸ­ä¿¡ã€æ›´æ–°åº“å­˜ç­‰
    }
}

// 3. å‘å¸ƒäº‹ä»¶
@Service
public class OrderService {
    @Autowired
    private ApplicationEventPublisher publisher;
    
    public void createOrder(String orderId) {
        // ä¸šåŠ¡é€»è¾‘...
        
        // å‘å¸ƒäº‹ä»¶
        publisher.publishEvent(new OrderCreatedEvent(this, orderId));
    }
}
```

**æ–¹å¼äºŒï¼šä½¿ç”¨@EventListeneræ³¨è§£ï¼ˆæ¨èï¼‰**

```java
@Component
public class OrderEventHandler {
    
    // æ›´ç®€æ´ï¼Œä¸éœ€è¦å®ç°æ¥å£
    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        System.out.println("è®¢å•åˆ›å»ºï¼š" + event.getOrderId());
    }
    
    // å¯ä»¥ç›‘å¬å¤šä¸ªäº‹ä»¶
    @EventListener
    public void handleOrderPaid(OrderPaidEvent event) {
        System.out.println("è®¢å•æ”¯ä»˜ï¼š" + event.getOrderId());
    }
}
```

### 4.4 é«˜çº§ç‰¹æ€§


**â­â­ å¼‚æ­¥äº‹ä»¶å¤„ç†**

```java
@Configuration
@EnableAsync  // å¼€å¯å¼‚æ­¥æ”¯æŒ
public class AsyncConfig {
    // é…ç½®çº¿ç¨‹æ± ...
}

@Component
public class AsyncEventHandler {
    
    @EventListener
    @Async  // å¼‚æ­¥å¤„ç†äº‹ä»¶
    public void handleOrderCreated(OrderCreatedEvent event) {
        // è€—æ—¶æ“ä½œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹
        sendSMS(event.getOrderId());
    }
}
```

**â­â­ æ¡ä»¶ç›‘å¬**

```java
@Component
public class ConditionalEventHandler {
    
    // åªå¤„ç†é‡‘é¢å¤§äº1000çš„è®¢å•
    @EventListener(condition = "#event.amount > 1000")
    public void handleBigOrder(OrderCreatedEvent event) {
        System.out.println("å¤§é¢è®¢å•ï¼š" + event.getAmount());
    }
}
```

**â­â­ ç›‘å¬å™¨é¡ºåº**

```java
@Component
public class OrderedEventHandler {
    
    @EventListener
    @Order(1)  // ä¼˜å…ˆçº§é«˜ï¼Œå…ˆæ‰§è¡Œ
    public void handleFirst(OrderCreatedEvent event) {
        System.out.println("ç¬¬ä¸€ä¸ªå¤„ç†");
    }
    
    @EventListener
    @Order(2)  // ä¼˜å…ˆçº§ä½ï¼Œåæ‰§è¡Œ
    public void handleSecond(OrderCreatedEvent event) {
        System.out.println("ç¬¬äºŒä¸ªå¤„ç†");
    }
}
```

### 4.5 äº‹ä»¶ä¼ æ’­æœºåˆ¶


**åŒæ­¥ vs å¼‚æ­¥**ï¼š

| ç‰¹æ€§ | **åŒæ­¥äº‹ä»¶** | **å¼‚æ­¥äº‹ä»¶** |
|------|------------|-------------|
| ğŸ”„ **æ‰§è¡Œæ–¹å¼** | `æŒ‰é¡ºåºæ‰§è¡Œ` | `å¹¶å‘æ‰§è¡Œ` |
| â±ï¸ **æ˜¯å¦é˜»å¡** | `é˜»å¡å‘å¸ƒè€…` | `ä¸é˜»å¡å‘å¸ƒè€…` |
| ğŸ¯ **ä½¿ç”¨åœºæ™¯** | `äº‹åŠ¡å†…æ“ä½œ` | `è€—æ—¶æ“ä½œã€å‘é€é€šçŸ¥` |
| âš ï¸ **å¼‚å¸¸å¤„ç†** | `ä¼šä¸­æ–­æµç¨‹` | `ä¸å½±å“ä¸»æµç¨‹` |

### 4.6 å†…ç½®äº‹ä»¶


Springå®¹å™¨æœ¬èº«ä¹Ÿä¼šå‘å¸ƒä¸€äº›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼š

```java
@Component
public class SpringEventListener {
    
    // å®¹å™¨å¯åŠ¨å®Œæˆ
    @EventListener
    public void onApplicationStarted(ContextRefreshedEvent event) {
        System.out.println("Springå®¹å™¨å¯åŠ¨å®Œæˆ");
    }
    
    // å®¹å™¨å…³é—­
    @EventListener
    public void onApplicationClosed(ContextClosedEvent event) {
        System.out.println("Springå®¹å™¨å…³é—­");
    }
}
```

**å¸¸è§å†…ç½®äº‹ä»¶**ï¼š
- `ContextRefreshedEvent`ï¼šå®¹å™¨åˆ·æ–°å®Œæˆ
- `ContextStartedEvent`ï¼šå®¹å™¨å¯åŠ¨
- `ContextStoppedEvent`ï¼šå®¹å™¨åœæ­¢
- `ContextClosedEvent`ï¼šå®¹å™¨å…³é—­

### 4.7 å®é™…åº”ç”¨åœºæ™¯


**å…¸å‹åº”ç”¨**ï¼š
- âœ… ä¸šåŠ¡è§£è€¦ï¼šè®¢å•å®Œæˆâ†’å‘çŸ­ä¿¡ã€æ›´æ–°åº“å­˜ã€ç§¯åˆ†å¢åŠ 
- âœ… æ—¥å¿—å®¡è®¡ï¼šæ“ä½œäº‹ä»¶â†’è®°å½•æ—¥å¿—
- âœ… ç¼“å­˜æ›´æ–°ï¼šæ•°æ®å˜æ›´â†’æ›´æ–°ç¼“å­˜
- âœ… æ¶ˆæ¯é€šçŸ¥ï¼šçŠ¶æ€å˜åŒ–â†’æ¨é€é€šçŸ¥

---

## 5. ğŸ“ SpELè¡¨è¾¾å¼è¯­è¨€


### 5.1 SpELæ˜¯ä»€ä¹ˆ


**Spring Expression Language**ï¼šSpringè¡¨è¾¾å¼è¯­è¨€ï¼Œåƒæ˜¯åœ¨é…ç½®ä¸­å†™ç®€å•çš„è®¡ç®—å…¬å¼ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šSpELå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—å€¼ï¼Œæ”¯æŒè°ƒç”¨æ–¹æ³•ã€è®¿é—®å±æ€§ã€é€»è¾‘è¿ç®—ç­‰

**ä½¿ç”¨æ ¼å¼**ï¼š`#{ è¡¨è¾¾å¼ }` æˆ– `${ å±æ€§å }`

### 5.2 åŸºç¡€è¯­æ³•


**â­ åŸºç¡€ç”¨æ³•**

```java
@Component
public class SpELDemo {
    
    // å­—é¢é‡
    @Value("#{100}")
    private int number;
    
    // å­—ç¬¦ä¸²
    @Value("#{'Hello World'}")
    private String message;
    
    // å¸ƒå°”å€¼
    @Value("#{true}")
    private boolean flag;
    
    // æ•°å­¦è¿ç®—
    @Value("#{10 + 20}")
    private int sum;
    
    // å­—ç¬¦ä¸²æ‹¼æ¥
    @Value("#{'Hello' + ' ' + 'World'}")
    private String text;
}
```

### 5.3 å¸¸ç”¨åŠŸèƒ½


**â‘  è®¿é—®Beanå±æ€§**

```java
@Component("userConfig")
public class UserConfig {
    private String username = "admin";
    // getter/setter...
}

@Component
public class MyBean {
    // è®¿é—®å…¶ä»–Beançš„å±æ€§
    @Value("#{userConfig.username}")
    private String name;
}
```

**â‘¡ è°ƒç”¨æ–¹æ³•**

```java
@Component
public class SpELMethodDemo {
    
    // è°ƒç”¨é™æ€æ–¹æ³•
    @Value("#{T(java.lang.Math).random()}")
    private double randomNum;
    
    // è°ƒç”¨Beanæ–¹æ³•
    @Value("#{userConfig.getUsername()}")
    private String username;
    
    // å­—ç¬¦ä¸²æ–¹æ³•
    @Value("#{'hello'.toUpperCase()}")
    private String upper;  // HELLO
}
```

**â‘¢ è¯»å–é…ç½®æ–‡ä»¶**

```java
@Component
public class ConfigDemo {
    
    // è¯»å–application.propertiesä¸­çš„å€¼
    @Value("${server.port}")
    private int port;
    
    // SpEL + é…ç½®æ–‡ä»¶ï¼Œæä¾›é»˜è®¤å€¼
    @Value("#{${app.timeout:3000}}")
    private int timeout;
}
```

**â‘£ æ¡ä»¶åˆ¤æ–­**

```java
@Component
public class ConditionalDemo {
    
    // ä¸‰å…ƒè¿ç®—ç¬¦
    @Value("#{10 > 5 ? 'å¤§äº' : 'å°äº'}")
    private String result;
    
    // Elvisè¿ç®—ç¬¦ï¼ˆç®€åŒ–ä¸‰å…ƒï¼‰
    @Value("#{someBean.name ?: 'defaultName'}")
    private String name;
    
    // æ¡ä»¶ç»„åˆ
    @Value("#{user.age >= 18 and user.vip == true}")
    private boolean canAccess;
}
```

**â­â­ é›†åˆæ“ä½œ**

```java
@Component
public class CollectionDemo {
    
    private List<Integer> numbers = Arrays.asList(1, 2, 3, 4, 5);
    
    // è¿‡æ»¤é›†åˆ
    @Value("#{numbers.?[#this > 3]}")  
    private List<Integer> filtered;  // [4, 5]
    
    // æ˜ å°„è½¬æ¢
    @Value("#{numbers.![#this * 2]}")
    private List<Integer> doubled;  // [2, 4, 6, 8, 10]
    
    // æŸ¥æ‰¾ç¬¬ä¸€ä¸ª
    @Value("#{numbers.^[#this > 3]}")
    private Integer first;  // 4
}
```

### 5.4 åœ¨æ³¨è§£ä¸­çš„åº”ç”¨


**@Cacheableç¼“å­˜**

```java
@Service
public class UserService {
    
    // keyä½¿ç”¨SpELåŠ¨æ€ç”Ÿæˆ
    @Cacheable(value = "users", key = "#userId")
    public User getUser(Long userId) {
        return userDao.findById(userId);
    }
    
    // å¤æ‚keyç»„åˆ
    @Cacheable(key = "#user.id + '-' + #user.type")
    public User saveUser(User user) {
        return userDao.save(user);
    }
}
```

**@PreAuthorizeæƒé™æ§åˆ¶**

```java
@RestController
public class AdminController {
    
    // åªæœ‰adminè§’è‰²æ‰èƒ½è®¿é—®
    @PreAuthorize("hasRole('ADMIN')")
    @GetMapping("/admin/users")
    public List<User> getAllUsers() {
        return userService.findAll();
    }
    
    // åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
    @PreAuthorize("#userId == authentication.principal.id")
    @GetMapping("/user/{userId}")
    public User getUser(@PathVariable Long userId) {
        return userService.getUser(userId);
    }
}
```

### 5.5 è¿ç®—ç¬¦æ€»ç»“


| ç±»å‹ | **è¿ç®—ç¬¦** | **ç¤ºä¾‹** |
|------|-----------|---------|
| ğŸ”¢ **ç®—æœ¯** | `+ - * / % ^` | `#{10 + 20}` |
| ğŸ”¤ **å­—ç¬¦ä¸²** | `+` | `#{'Hello' + 'World'}` |
| âš–ï¸ **æ¯”è¾ƒ** | `< > <= >= == !=` | `#{age >= 18}` |
| ğŸ”€ **é€»è¾‘** | `and or not` | `#{age > 18 and vip}` |
| â“ **ä¸‰å…ƒ** | `? :` | `#{score > 60 ? 'åŠæ ¼' : 'ä¸åŠæ ¼'}` |
| ğŸ“‹ **é›†åˆ** | `?[ ] ![ ] ^[ ] $[ ]` | `#{list.?[#this > 5]}` |

---

## 6. ğŸ”Œ Awareæ¥å£å›è°ƒæœºåˆ¶


### 6.1 Awareæ¥å£æ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼šAwareå°±æ˜¯"æ„ŸçŸ¥ã€å¯Ÿè§‰"çš„æ„æ€ï¼Œè¿™äº›æ¥å£è®©Beanèƒ½å¤Ÿæ„ŸçŸ¥åˆ°Springå®¹å™¨çš„å­˜åœ¨ã€‚

> ğŸ’¡ **æ ¸å¿ƒæ¦‚å¿µ**ï¼šAwareæ¥å£æ˜¯Springæä¾›çš„å›è°ƒæ¥å£ï¼Œè®©Beanå¯ä»¥è·å–Springå®¹å™¨å†…éƒ¨çš„ä¸€äº›å¯¹è±¡

**ç”Ÿæ´»ç±»æ¯”**ï¼š
```
æ™®é€šå‘˜å·¥ï¼šåªçŸ¥é“åšè‡ªå·±çš„å·¥ä½œ
Awareå‘˜å·¥ï¼šä¸ä»…åšå·¥ä½œï¼Œè¿˜çŸ¥é“å…¬å¸ç»“æ„ã€è€æ¿æ˜¯è°ã€åŒäº‹æœ‰è°

æ™®é€šBeanï¼šåªç®¡è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘
Aware Beanï¼šè¿˜èƒ½çŸ¥é“å®¹å™¨ä¿¡æ¯ã€è·å–å…¶ä»–Bean
```

### 6.2 å¸¸ç”¨Awareæ¥å£


**æ ¸å¿ƒAwareæ¥å£å®¶æ—**ï¼š

```
Awareæ¥å£ä½“ç³»ï¼š
    
ApplicationContextAware â† æœ€å¸¸ç”¨
    â†“ å¯è·å–ApplicationContext

BeanNameAware
    â†“ å¯è·å–Beançš„åç§°

BeanFactoryAware  
    â†“ å¯è·å–BeanFactory

EnvironmentAware
    â†“ å¯è·å–ç¯å¢ƒå˜é‡

ResourceLoaderAware
    â†“ å¯è·å–èµ„æºåŠ è½½å™¨
```

### 6.3 ApplicationContextAwareè¯¦è§£


**ä½œç”¨**ï¼šè·å–Springå®¹å™¨ApplicationContextå¯¹è±¡ã€‚

```java
@Component
public class SpringContextHolder implements ApplicationContextAware {
    
    private static ApplicationContext applicationContext;
    
    @Override
    public void setApplicationContext(ApplicationContext context) {
        applicationContext = context;
        System.out.println("è·å–åˆ°ApplicationContextï¼š" + context);
    }
    
    // å·¥å…·æ–¹æ³•ï¼šæ ¹æ®åç§°è·å–Bean
    public static Object getBean(String beanName) {
        return applicationContext.getBean(beanName);
    }
    
    // å·¥å…·æ–¹æ³•ï¼šæ ¹æ®ç±»å‹è·å–Bean
    public static <T> T getBean(Class<T> clazz) {
        return applicationContext.getBean(clazz);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class SomeUtil {
    public void doSomething() {
        // åœ¨éSpringç®¡ç†çš„ç±»ä¸­è·å–Bean
        UserService userService = SpringContextHolder.getBean(UserService.class);
        userService.findAll();
    }
}
```

**åº”ç”¨åœºæ™¯**ï¼š
- âœ… åœ¨å·¥å…·ç±»ä¸­è·å–Spring Bean
- âœ… åŠ¨æ€è·å–Beanå¯¹è±¡
- âœ… å®ç°Springä¸Šä¸‹æ–‡çš„å…¨å±€è®¿é—®

### 6.4 BeanNameAwareè¯¦è§£


**ä½œç”¨**ï¼šè·å–å½“å‰Beanåœ¨å®¹å™¨ä¸­çš„åç§°ã€‚

```java
@Component
public class MyBean implements BeanNameAware {
    
    private String beanName;
    
    @Override
    public void setBeanName(String name) {
        this.beanName = name;
        System.out.println("æˆ‘çš„Beanåç§°æ˜¯ï¼š" + name);
    }
    
    public void printInfo() {
        System.out.println("å½“å‰Bean: " + beanName);
    }
}
```

**åº”ç”¨åœºæ™¯**ï¼š
- âœ… æ—¥å¿—è®°å½•ï¼Œæ ‡è¯†æ˜¯å“ªä¸ªBean
- âœ… ç›‘æ§ç»Ÿè®¡ï¼ŒåŒºåˆ†ä¸åŒå®ä¾‹
- âœ… è°ƒè¯•ä¿¡æ¯è¾“å‡º

### 6.5 BeanFactoryAwareè¯¦è§£


**ä½œç”¨**ï¼šè·å–BeanFactoryå¯¹è±¡ã€‚

```java
@Component
public class BeanFactoryDemo implements BeanFactoryAware {
    
    private BeanFactory beanFactory;
    
    @Override
    public void setBeanFactory(BeanFactory beanFactory) {
        this.beanFactory = beanFactory;
    }
    
    public void checkBeanExists(String beanName) {
        boolean exists = beanFactory.containsBean(beanName);
        System.out.println(beanName + " æ˜¯å¦å­˜åœ¨: " + exists);
    }
    
    public <T> T getBeanSafely(Class<T> clazz) {
        if (beanFactory.containsBean(clazz.getSimpleName())) {
            return beanFactory.getBean(clazz);
        }
        return null;
    }
}
```

**ApplicationContext vs BeanFactory**ï¼š

| ç‰¹æ€§ | **BeanFactory** | **ApplicationContext** |
|------|----------------|----------------------|
| ğŸ“¦ **åŠŸèƒ½** | `åŸºç¡€å®¹å™¨` | `æ‰©å±•å®¹å™¨(åŒ…å«BeanFactory)` |
| ğŸ¯ **ä½•æ—¶ç”¨** | `ç®€å•åœºæ™¯` | `ä¼ä¸šçº§åº”ç”¨(æ¨è)` |
| âš¡ **åŠ è½½æ—¶æœº** | `å»¶è¿ŸåŠ è½½` | `ç«‹å³åŠ è½½` |
| ğŸ”§ **é¢å¤–åŠŸèƒ½** | `æ— ` | `äº‹ä»¶å‘å¸ƒã€å›½é™…åŒ–ã€AOPç­‰` |

### 6.6 æ‰§è¡Œé¡ºåº


**Awareæ¥å£å›è°ƒé¡ºåº**ï¼š

```
Beanåˆ›å»ºæµç¨‹ä¸­çš„Awareå›è°ƒï¼š

1. BeanNameAware.setBeanName()
   â†“ æœ€å…ˆæ‰§è¡Œ
   
2. BeanClassLoaderAware.setBeanClassLoader()
   â†“
   
3. BeanFactoryAware.setBeanFactory()
   â†“
   
4. EnvironmentAware.setEnvironment()
   â†“
   
5. ResourceLoaderAware.setResourceLoader()
   â†“
   
6. ApplicationContextAware.setApplicationContext()
   â†“ æœ€åæ‰§è¡Œ
   
ç„¶åæ‰æ˜¯ï¼š
7. @PostConstruct
8. InitializingBean.afterPropertiesSet()
9. init-method
```

### 6.7 ç»¼åˆç¤ºä¾‹


```java
@Component
public class CompleteAwareDemo implements 
    BeanNameAware, 
    BeanFactoryAware,
    ApplicationContextAware {
    
    private String beanName;
    private BeanFactory beanFactory;
    private ApplicationContext applicationContext;
    
    @Override
    public void setBeanName(String name) {
        this.beanName = name;
        System.out.println("1. è®¾ç½®Beanåç§°: " + name);
    }
    
    @Override
    public void setBeanFactory(BeanFactory beanFactory) {
        this.beanFactory = beanFactory;
        System.out.println("2. è®¾ç½®BeanFactory");
    }
    
    @Override
    public void setApplicationContext(ApplicationContext context) {
        this.applicationContext = context;
        System.out.println("3. è®¾ç½®ApplicationContext");
    }
    
    @PostConstruct
    public void init() {
        System.out.println("4. @PostConstructåˆå§‹åŒ–");
        // æ­¤æ—¶ä¸‰ä¸ªå±æ€§éƒ½å·²æ³¨å…¥ï¼Œå¯ä»¥å®‰å…¨ä½¿ç”¨
        printInfo();
    }
    
    public void printInfo() {
        System.out.println("Beanåç§°: " + beanName);
        System.out.println("å®¹å™¨ä¸­Beanæ•°é‡: " + 
            applicationContext.getBeanDefinitionCount());
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¾ªç¯ä¾èµ–è§£å†³


> âœ… **è®°å¿†è¦ç‚¹**ï¼šä¸‰çº§ç¼“å­˜ = ä¸‰ä¸ªMapï¼Œåˆ†åˆ«å­˜æˆå“ã€åŠæˆå“ã€å·¥å‚

```
å…³é”®ç†è§£ï¼š
â‘  å•ä¾‹å±æ€§æ³¨å…¥å¯ä»¥è§£å†³ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰
â‘¡ æ„é€ å™¨æ³¨å…¥æ— æ³•è§£å†³ï¼ˆåˆ›å»ºæ—¶å°±éœ€è¦ä¾èµ–ï¼‰
â‘¢ prototypeä½œç”¨åŸŸæ— æ³•è§£å†³ï¼ˆæ¯æ¬¡éƒ½æ–°å»ºï¼‰

æ ¸å¿ƒæœºåˆ¶ï¼š
æå‰æš´éœ²åŠæˆå“å¯¹è±¡ â†’ æ‰“ç ´å¾ªç¯ â†’ å®Œæˆæ³¨å…¥
```

### 7.2 FactoryBeanå·¥å‚


> âœ… **è®°å¿†è¦ç‚¹**ï¼šFactoryBeanæ˜¯ç”Ÿäº§Beançš„å·¥å‚ï¼ŒgetObject()è¿”å›äº§å“

```
ä½¿ç”¨åœºæ™¯ï¼š
â‘  å¤æ‚å¯¹è±¡åˆ›å»ºï¼ˆæ•°æ®æºã€è¿æ¥æ± ï¼‰
â‘¡ ç¬¬ä¸‰æ–¹æ¡†æ¶æ•´åˆï¼ˆMyBatisã€Dubboï¼‰
â‘¢ åŠ¨æ€é…ç½®å¯¹è±¡

è·å–æ–¹å¼ï¼š
getBean("beanName") â†’ è·å–äº§å“
getBean("&beanName") â†’ è·å–å·¥å‚
```

### 7.3 åç½®å¤„ç†å™¨


> âœ… **è®°å¿†è¦ç‚¹**ï¼šåœ¨Beanåˆå§‹åŒ–å‰åæ’å…¥è‡ªå®šä¹‰é€»è¾‘

```
ä¸¤ç§å¤„ç†å™¨ï¼š
BeanPostProcessor â†’ å¤„ç†Beanå®ä¾‹
BeanDefinitionRegistryPostProcessor â†’ å¤„ç†Beanå®šä¹‰

å…¸å‹åº”ç”¨ï¼š
â‘  AOPä»£ç†åˆ›å»ºï¼ˆæœ€é‡è¦ï¼‰
â‘¡ å±æ€§åŠ å¯†è§£å¯†
â‘¢ æ—¥å¿—ç›‘æ§åŸ‹ç‚¹
â‘£ MyBatis Mapperæ³¨å†Œ
```

### 7.4 äº‹ä»¶æœºåˆ¶


> âœ… **è®°å¿†è¦ç‚¹**ï¼šè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå‘å¸ƒ-è®¢é˜…ï¼Œå®ç°è§£è€¦

```
ä¸‰å¤§ç»„ä»¶ï¼š
ApplicationEvent â†’ äº‹ä»¶
ApplicationListener â†’ ç›‘å¬å™¨  
ApplicationEventPublisher â†’ å‘å¸ƒå™¨

ä½¿ç”¨æ–¹å¼ï¼š
â‘  å®ç°æ¥å£ï¼šApplicationListener<Event>
â‘¡ æ³¨è§£æ–¹å¼ï¼š@EventListenerï¼ˆæ¨èï¼‰

é«˜çº§ç‰¹æ€§ï¼š
@Async â†’ å¼‚æ­¥å¤„ç†
@Order â†’ æ§åˆ¶é¡ºåº
condition â†’ æ¡ä»¶ç›‘å¬
```

### 7.5 SpELè¡¨è¾¾å¼


> âœ… **è®°å¿†è¦ç‚¹**ï¼š#{è¡¨è¾¾å¼} è¿è¡Œæ—¶è®¡ç®—ï¼Œ${å±æ€§å} è¯»é…ç½®

```
å¸¸ç”¨åœºæ™¯ï¼š
â‘  @Valueæ³¨å…¥å€¼
â‘¡ @CacheableåŠ¨æ€key
â‘¢ @PreAuthorizeæƒé™åˆ¤æ–­

æ ¸å¿ƒåŠŸèƒ½ï¼š
â€¢ è®¿é—®Beanå±æ€§
â€¢ è°ƒç”¨æ–¹æ³•
â€¢ é€»è¾‘è¿ç®—
â€¢ é›†åˆæ“ä½œ
```

### 7.6 Awareæ¥å£


> âœ… **è®°å¿†è¦ç‚¹**ï¼šAware = æ„ŸçŸ¥å®¹å™¨ï¼Œå›è°ƒè·å–Springå†…éƒ¨å¯¹è±¡

```
å¸¸ç”¨æ¥å£ï¼š
ApplicationContextAware â†’ è·å–å®¹å™¨ï¼ˆæœ€å¸¸ç”¨ï¼‰
BeanNameAware â†’ è·å–Beanåç§°
BeanFactoryAware â†’ è·å–BeanFactory

åº”ç”¨åœºæ™¯ï¼š
â‘  å·¥å…·ç±»è·å–Bean
â‘¡ åŠ¨æ€è·å–å®¹å™¨ä¿¡æ¯
â‘¢ å®ç°Springä¸Šä¸‹æ–‡å…¨å±€è®¿é—®
```

### 7.7 å­¦ä¹ å»ºè®®


**â­ åˆå­¦è€…é‡ç‚¹**ï¼š
1. ç†è§£å¾ªç¯ä¾èµ–çš„ä¸‰ç§æƒ…å†µ
2. æŒæ¡FactoryBeançš„åŸºæœ¬ç”¨æ³•
3. äº†è§£äº‹ä»¶æœºåˆ¶çš„@EventListeneræ³¨è§£
4. ä¼šç”¨ApplicationContextAwareè·å–å®¹å™¨

**â­â­ è¿›é˜¶é‡ç‚¹**ï¼š
1. æ·±å…¥ä¸‰çº§ç¼“å­˜è§£å†³æœºåˆ¶
2. è‡ªå®šä¹‰BeanPostProcessor
3. æŒæ¡SpELåœ¨å„ç§æ³¨è§£ä¸­çš„åº”ç”¨
4. ç†è§£Awareæ¥å£çš„æ‰§è¡Œé¡ºåº

**â­â­â­ é«˜çº§é‡ç‚¹**ï¼š
1. BeanDefinitionRegistryPostProcessoråŠ¨æ€æ³¨å†Œ
2. å¼‚æ­¥äº‹ä»¶å¤„ç†æœºåˆ¶
3. SpELé›†åˆæ“ä½œå’Œæ¡ä»¶åˆ¤æ–­
4. ç»“åˆæºç ç†è§£æ‰©å±•ç‚¹åŸç†

**å®æˆ˜å»ºè®®**ï¼š
- ğŸ”¸ å¾ªç¯ä¾èµ–ï¼šå¤šå†™å‡ ä¸ªå¾ªç¯ä¾èµ–çš„ä¾‹å­åŠ æ·±ç†è§£
- ğŸ”¸ åç½®å¤„ç†å™¨ï¼šå°è¯•è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„AOP
- ğŸ”¸ äº‹ä»¶æœºåˆ¶ï¼šåœ¨é¡¹ç›®ä¸­ç”¨äº‹ä»¶è§£è€¦ä¸šåŠ¡é€»è¾‘
- ğŸ”¸ SpELï¼šåœ¨ç¼“å­˜ã€æƒé™æ§åˆ¶ä¸­å®è·µä½¿ç”¨