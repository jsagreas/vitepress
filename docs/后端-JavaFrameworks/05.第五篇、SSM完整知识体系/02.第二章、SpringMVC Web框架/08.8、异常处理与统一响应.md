---
title: 8ã€å¼‚å¸¸å¤„ç†ä¸ç»Ÿä¸€å“åº”
---
## ğŸ“š ç›®å½•

1. [ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†](#1-ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†)
2. [å±€éƒ¨å¼‚å¸¸å¤„ç†-@ExceptionHandler](#2-å±€éƒ¨å¼‚å¸¸å¤„ç†-ExceptionHandler)
3. [å…¨å±€å¼‚å¸¸å¤„ç†-@ControllerAdvice](#3-å…¨å±€å¼‚å¸¸å¤„ç†-ControllerAdvice)
4. [RESTé£æ ¼å¼‚å¸¸å¤„ç†-@RestControllerAdvice](#4-RESTé£æ ¼å¼‚å¸¸å¤„ç†-RestControllerAdvice)
5. [å¼‚å¸¸å¤„ç†å™¨æ–¹æ³•è¯¦è§£](#5-å¼‚å¸¸å¤„ç†å™¨æ–¹æ³•è¯¦è§£)
6. [å¼‚å¸¸ç±»å‹åŒ¹é…è§„åˆ™](#6-å¼‚å¸¸ç±»å‹åŒ¹é…è§„åˆ™)
7. [ä¸šåŠ¡å¼‚å¸¸ä¸ç³»ç»Ÿå¼‚å¸¸](#7-ä¸šåŠ¡å¼‚å¸¸ä¸ç³»ç»Ÿå¼‚å¸¸)
8. [é”™è¯¯ä¿¡æ¯å°è£…ä¸å“åº”](#8-é”™è¯¯ä¿¡æ¯å°è£…ä¸å“åº”)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†


### 1.1 ç¨‹åºå‡ºé”™æ˜¯å¸¸æ€


æƒ³è±¡ä¸€ä¸‹è¿™äº›åœºæ™¯ï¼š
- ç”¨æˆ·ç™»å½•æ—¶è¾“å…¥äº†é”™è¯¯çš„å¯†ç 
- è®¿é—®äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å•†å“ID
- æ•°æ®åº“è¿æ¥çªç„¶æ–­å¼€
- ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼ä¸å¯¹

**è¿™äº›éƒ½ä¼šå¯¼è‡´ç¨‹åºæŠ›å‡ºå¼‚å¸¸ï¼** å¦‚æœä¸å¤„ç†ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ä¸€å¤§å †çœ‹ä¸æ‡‚çš„é”™è¯¯ä¿¡æ¯ï¼Œä½“éªŒæå·®ã€‚

```
æ²¡æœ‰å¼‚å¸¸å¤„ç†æ—¶ç”¨æˆ·çœ‹åˆ°çš„ï¼š
500 Internal Server Error
java.lang.NullPointerException: Cannot invoke "User.getName()"
    at com.example.UserController.getUser(UserController.java:45)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    ...ä¸€å †å †æ ˆä¿¡æ¯

æœ‰å¼‚å¸¸å¤„ç†åç”¨æˆ·çœ‹åˆ°çš„ï¼š
{
  "code": 404,
  "message": "ç”¨æˆ·ä¸å­˜åœ¨",
  "timestamp": "2025-09-23 10:30:00"
}
```

### 1.2 å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒç›®æ ‡


```
å¼‚å¸¸å¤„ç†è¦è§£å†³çš„é—®é¢˜ï¼š

ç”¨æˆ·å±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º           â”‚
â”‚ "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"           â”‚
â”‚ è€Œä¸æ˜¯ä¸€å †æŠ€æœ¯æ€§é”™è¯¯ä¿¡æ¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¼€å‘å±‚é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¼‚å¸¸             â”‚
â”‚ è®°å½•é”™è¯¯æ—¥å¿—ä¾¿äºæ’æŸ¥         â”‚
â”‚ ä»£ç æ›´æ¸…æ™°ï¼Œä¸ç”¨åˆ°å¤„try-catchâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç†å¿µ**ï¼šæŠŠå¼‚å¸¸å¤„ç†ä»ä¸šåŠ¡ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œé›†ä¸­ç®¡ç†ï¼

---

## 2. ğŸ¯ å±€éƒ¨å¼‚å¸¸å¤„ç†-@ExceptionHandler


### 2.1 ä»€ä¹ˆæ˜¯@ExceptionHandler


**é€šä¿—ç†è§£**ï¼šå°±åƒæ˜¯ç»™æŸä¸ªControlleré…ä¸€ä¸ª"æ•‘ç«é˜Ÿå‘˜"ï¼Œåªè¦è¿™ä¸ªControlleré‡Œå‡ºäº†æŒ‡å®šçš„å¼‚å¸¸ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šå‡ºæ¥å¤„ç†ã€‚

**ä¸“ä¸šå®šä¹‰**ï¼š`@ExceptionHandler` æ˜¯ä¸€ä¸ªæ–¹æ³•çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºå¤„ç†å½“å‰Controllerä¸­æŠ›å‡ºçš„ç‰¹å®šå¼‚å¸¸ã€‚

### 2.2 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹


```java
@Controller
public class UserController {
    
    // æ­£å¸¸çš„ä¸šåŠ¡æ–¹æ³•
    @GetMapping("/user/{id}")
    public String getUser(@PathVariable Long id) {
        // å‡è®¾æŸ¥è¯¢ç”¨æˆ·
        User user = userService.findById(id);
        
        if (user == null) {
            // æŠ›å‡ºå¼‚å¸¸
            throw new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨: " + id);
        }
        
        return "userDetail";
    }
    
    // å¼‚å¸¸å¤„ç†æ–¹æ³• - ä¸“é—¨å¤„ç†UserNotFoundException
    @ExceptionHandler(UserNotFoundException.class)
    public ModelAndView handleUserNotFound(UserNotFoundException ex) {
        // åˆ›å»ºé”™è¯¯é¡µé¢
        ModelAndView mav = new ModelAndView("error");
        mav.addObject("errorMsg", ex.getMessage());
        return mav;
    }
}
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š
```
ç”¨æˆ·è¯·æ±‚ /user/999
    â†“
è¿›å…¥ getUser() æ–¹æ³•
    â†“
æŸ¥è¯¢æ•°æ®åº“å‘ç°ç”¨æˆ·ä¸å­˜åœ¨
    â†“
æŠ›å‡º UserNotFoundException
    â†“
SpringMVCæ‹¦æˆªå¼‚å¸¸
    â†“
æ‰¾åˆ° @ExceptionHandler(UserNotFoundException.class)
    â†“
æ‰§è¡Œ handleUserNotFound() æ–¹æ³•
    â†“
è¿”å›å‹å¥½çš„é”™è¯¯é¡µé¢ç»™ç”¨æˆ·
```

### 2.3 å±€éƒ¨å¼‚å¸¸å¤„ç†çš„ç‰¹ç‚¹


| ç‰¹ç‚¹ | è¯´æ˜ | ç¤ºä¾‹åœºæ™¯ |
|------|------|----------|
| **ä½œç”¨èŒƒå›´** | åªå¯¹å½“å‰Controlleræœ‰æ•ˆ | UserControllerçš„å¼‚å¸¸åªåœ¨UserControllerå†…å¤„ç† |
| **çµæ´»æ€§** | å¯ä»¥é’ˆå¯¹ä¸åŒå¼‚å¸¸è¿”å›ä¸åŒç»“æœ | 404è¿”å›é”™è¯¯é¡µé¢ï¼Œ500è¿”å›JSON |
| **å±€é™æ€§** | æ¯ä¸ªControlleréƒ½è¦å†™ä¸€é | 100ä¸ªControllerè¦å†™100æ¬¡ |

**ä½¿ç”¨å»ºè®®**ï¼šé€‚åˆControllerç‰¹æœ‰çš„å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œé€šç”¨å¼‚å¸¸ç”¨å…¨å±€å¤„ç†ã€‚

---

## 3. ğŸŒ å…¨å±€å¼‚å¸¸å¤„ç†-@ControllerAdvice


### 3.1 ä»€ä¹ˆæ˜¯@ControllerAdvice


**é€šä¿—ç†è§£**ï¼šå°±åƒå…¬å¸çš„"æ€»å®¢æœéƒ¨é—¨"ï¼Œä¸ç®¡å“ªä¸ªéƒ¨é—¨ï¼ˆControllerï¼‰å‡ºäº†é—®é¢˜ï¼Œéƒ½ç”±è¿™ä¸ªéƒ¨é—¨ç»Ÿä¸€å¤„ç†ã€‚

**ä¸“ä¸šå®šä¹‰**ï¼š`@ControllerAdvice` æ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£ï¼Œç”¨äºå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œå¯ä»¥å¤„ç†æ‰€æœ‰ControlleræŠ›å‡ºçš„å¼‚å¸¸ã€‚

### 3.2 å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç¤ºä¾‹


```java
@ControllerAdvice
public class GlobalExceptionHandler {
    
    // å¤„ç†æ‰€æœ‰çš„ç©ºæŒ‡é’ˆå¼‚å¸¸
    @ExceptionHandler(NullPointerException.class)
    public ModelAndView handleNullPointer(NullPointerException ex) {
        ModelAndView mav = new ModelAndView("error/500");
        mav.addObject("errorMsg", "ç³»ç»Ÿå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸");
        return mav;
    }
    
    // å¤„ç†è‡ªå®šä¹‰çš„ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ModelAndView handleBusinessException(BusinessException ex) {
        ModelAndView mav = new ModelAndView("error/business");
        mav.addObject("errorMsg", ex.getMessage());
        return mav;
    }
    
    // å¤„ç†æ‰€æœ‰æœªçŸ¥å¼‚å¸¸ï¼ˆå…œåº•ï¼‰
    @ExceptionHandler(Exception.class)
    public ModelAndView handleException(Exception ex) {
        ModelAndView mav = new ModelAndView("error/unknown");
        mav.addObject("errorMsg", "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
        // è®°å½•æ—¥å¿—
        ex.printStackTrace();
        return mav;
    }
}
```

### 3.3 ä½œç”¨èŒƒå›´è¯´æ˜


```
å…¨å±€å¼‚å¸¸å¤„ç†å™¨çš„è¦†ç›–èŒƒå›´ï¼š

åº”ç”¨ç¨‹åº
â”œâ”€â”€ UserController  â”€â”€â”
â”œâ”€â”€ OrderController â”€â”€â”¤
â”œâ”€â”€ ProductControllerâ”€â”¤
â””â”€â”€ ...å…¶ä»–Controllerâ”€â”¤
                      â”œâ”€â”€> æ‰€æœ‰å¼‚å¸¸éƒ½è¢«
                      â”‚    @ControllerAdvice
                      â”‚    ç»Ÿä¸€æ•è·å¤„ç†
                      â””â”€â”€> GlobalExceptionHandler
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… **ä¸€æ¬¡ç¼–å†™ï¼Œå…¨å±€ç”Ÿæ•ˆ** - ä¸ç”¨åœ¨æ¯ä¸ªControlleré‡å¤ä»£ç 
- âœ… **ç»Ÿä¸€ç®¡ç†** - æ‰€æœ‰å¼‚å¸¸å¤„ç†é€»è¾‘é›†ä¸­åœ¨ä¸€èµ·
- âœ… **æ˜“äºç»´æŠ¤** - ä¿®æ”¹å¼‚å¸¸å¤„ç†åªéœ€æ”¹ä¸€ä¸ªåœ°æ–¹

---

## 4. ğŸš€ RESTé£æ ¼å¼‚å¸¸å¤„ç†-@RestControllerAdvice


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦@RestControllerAdvice


**å‰åç«¯åˆ†ç¦»é¡¹ç›®çš„å›°å¢ƒ**ï¼š
- å‰ç«¯éœ€è¦çš„æ˜¯JSONæ•°æ®ï¼Œä¸æ˜¯HTMLé¡µé¢
- `@ControllerAdvice` è¿”å›çš„æ˜¯ `ModelAndView`ï¼ˆé¡µé¢ï¼‰
- éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•ä¸ŠåŠ  `@ResponseBody` å¤ªéº»çƒ¦

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `@RestControllerAdvice`ï¼

### 4.2 @RestControllerAdvice vs @ControllerAdvice


```java
// ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªæ–¹æ³•éƒ½è¦åŠ @ResponseBody
@ControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(UserNotFoundException.class)
    @ResponseBody  // éœ€è¦æ‰‹åŠ¨æ·»åŠ 
    public Map<String, Object> handleUserNotFound(UserNotFoundException ex) {
        Map<String, Object> result = new HashMap<>();
        result.put("code", 404);
        result.put("message", ex.getMessage());
        return result;
    }
}

// ä½¿ç”¨@RestControllerAdviceï¼šè‡ªåŠ¨è¿”å›JSON
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(UserNotFoundException.class)
    // ä¸éœ€è¦@ResponseBodyï¼Œè‡ªåŠ¨è¿”å›JSON
    public Map<String, Object> handleUserNotFound(UserNotFoundException ex) {
        Map<String, Object> result = new HashMap<>();
        result.put("code", 404);
        result.put("message", ex.getMessage());
        return result;
    }
}
```

**æœ¬è´¨åŒºåˆ«**ï¼š
- `@ControllerAdvice` = `@Component` + å…¨å±€å¼‚å¸¸å¤„ç†
- `@RestControllerAdvice` = `@ControllerAdvice` + `@ResponseBody`

### 4.3 å®Œæ•´çš„RESTå¼‚å¸¸å¤„ç†ç¤ºä¾‹


```java
@RestControllerAdvice
public class RestExceptionHandler {
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResultVO handleValidException(MethodArgumentNotValidException ex) {
        String errorMsg = ex.getBindingResult()
                           .getFieldError()
                           .getDefaultMessage();
        return ResultVO.error(400, "å‚æ•°æ ¡éªŒå¤±è´¥: " + errorMsg);
    }
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ResultVO handleBusinessException(BusinessException ex) {
        return ResultVO.error(ex.getCode(), ex.getMessage());
    }
    
    // å¤„ç†ç³»ç»Ÿå¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public ResultVO handleException(Exception ex) {
        // è®°å½•æ—¥å¿—
        log.error("ç³»ç»Ÿå¼‚å¸¸", ex);
        return ResultVO.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

**è¿”å›çš„JSONæ ¼å¼**ï¼š
```json
{
  "code": 400,
  "message": "å‚æ•°æ ¡éªŒå¤±è´¥: ç”¨æˆ·åä¸èƒ½ä¸ºç©º",
  "data": null,
  "timestamp": "2025-09-23 10:30:00"
}
```

---

## 5. âš™ï¸ å¼‚å¸¸å¤„ç†å™¨æ–¹æ³•è¯¦è§£


### 5.1 å¼‚å¸¸å¤„ç†æ–¹æ³•çš„å‚æ•°


å¼‚å¸¸å¤„ç†æ–¹æ³•å¯ä»¥æ¥æ”¶å¤šç§å‚æ•°ï¼ŒSpringMVCä¼šè‡ªåŠ¨æ³¨å…¥ï¼š

```java
@ExceptionHandler(UserNotFoundException.class)
public ResultVO handleUserNotFound(
    UserNotFoundException ex,        // 1. å¼‚å¸¸å¯¹è±¡æœ¬èº«
    HttpServletRequest request,      // 2. è¯·æ±‚å¯¹è±¡
    HttpServletResponse response     // 3. å“åº”å¯¹è±¡
) {
    // è·å–è¯·æ±‚URL
    String url = request.getRequestURL().toString();
    
    // å¯ä»¥è®¾ç½®å“åº”çŠ¶æ€ç 
    response.setStatus(404);
    
    return ResultVO.error(404, "ç”¨æˆ·ä¸å­˜åœ¨: " + ex.getMessage());
}
```

**å‚æ•°è¯´æ˜**ï¼š

| å‚æ•°ç±»å‹ | ä½œç”¨ | å¸¸ç”¨åœºæ™¯ |
|---------|------|---------|
| `Exception ex` | è·å–å¼‚å¸¸å¯¹è±¡ | è·å–é”™è¯¯ä¿¡æ¯ã€é”™è¯¯ç  |
| `HttpServletRequest` | è·å–è¯·æ±‚ä¿¡æ¯ | è®°å½•è¯·æ±‚URLã€IPåœ°å€ |
| `HttpServletResponse` | è®¾ç½®å“åº”ä¿¡æ¯ | è®¾ç½®HTTPçŠ¶æ€ç  |
| `WebRequest` | è·å–è¯·æ±‚å‚æ•° | è·å–è¯·æ±‚å‚æ•°å€¼ |

### 5.2 å¼‚å¸¸å¤„ç†æ–¹æ³•çš„è¿”å›å€¼


**ä¸åŒåœºæ™¯çš„è¿”å›å€¼é€‰æ‹©**ï¼š

```java
@ControllerAdvice
public class ExceptionHandler {
    
    // 1. è¿”å›ModelAndView - ä¼ ç»ŸMVCé¡¹ç›®
    @ExceptionHandler(Exception.class)
    public ModelAndView handleError1(Exception ex) {
        ModelAndView mav = new ModelAndView("error");
        mav.addObject("errorMsg", ex.getMessage());
        return mav;
    }
    
    // 2. è¿”å›String - è§†å›¾åç§°
    @ExceptionHandler(Exception.class)
    public String handleError2(Exception ex, Model model) {
        model.addAttribute("errorMsg", ex.getMessage());
        return "error"; // è·³è½¬åˆ°error.jsp
    }
    
    // 3. è¿”å›void - æ‰‹åŠ¨å¤„ç†å“åº”
    @ExceptionHandler(Exception.class)
    public void handleError3(Exception ex, HttpServletResponse response) 
        throws IOException {
        response.setContentType("application/json;charset=UTF-8");
        response.getWriter().write("{\"error\":\"" + ex.getMessage() + "\"}");
    }
}

@RestControllerAdvice
public class RestExceptionHandler {
    
    // 4. è¿”å›å¯¹è±¡ - è‡ªåŠ¨è½¬JSONï¼ˆæ¨èï¼‰
    @ExceptionHandler(Exception.class)
    public ResultVO handleError(Exception ex) {
        return ResultVO.error(500, ex.getMessage());
    }
    
    // 5. è¿”å›ResponseEntity - å¯è‡ªå®šä¹‰HTTPçŠ¶æ€ç 
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ResultVO> handleError(Exception ex) {
        ResultVO result = ResultVO.error(500, ex.getMessage());
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                            .body(result);
    }
}
```

**é€‰æ‹©å»ºè®®**ï¼š
- ä¼ ç»Ÿé¡¹ç›® â†’ è¿”å› `ModelAndView` æˆ– `String`
- å‰åç«¯åˆ†ç¦» â†’ è¿”å›è‡ªå®šä¹‰ç»“æœå¯¹è±¡ï¼ˆå¦‚ `ResultVO`ï¼‰
- éœ€è¦ç²¾ç¡®æ§åˆ¶HTTPçŠ¶æ€ç  â†’ è¿”å› `ResponseEntity`

---

## 6. ğŸ² å¼‚å¸¸ç±»å‹åŒ¹é…è§„åˆ™


### 6.1 åŒ¹é…åŸåˆ™ï¼šå°±è¿‘ä¼˜å…ˆ


**é€šä¿—ç†è§£**ï¼šSpringMVCä¼šé€‰æ‹©"æœ€åˆé€‚"çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ï¼Œè¶Šå…·ä½“çš„å¼‚å¸¸ä¼˜å…ˆçº§è¶Šé«˜ã€‚

```java
@RestControllerAdvice
public class ExceptionMatchDemo {
    
    // 1. å¤„ç†å…·ä½“çš„å¼‚å¸¸
    @ExceptionHandler(ArithmeticException.class)
    public ResultVO handleArithmetic(ArithmeticException ex) {
        return ResultVO.error(400, "ç®—æœ¯å¼‚å¸¸: " + ex.getMessage());
    }
    
    // 2. å¤„ç†RuntimeExceptionï¼ˆArithmeticExceptionçš„çˆ¶ç±»ï¼‰
    @ExceptionHandler(RuntimeException.class)
    public ResultVO handleRuntime(RuntimeException ex) {
        return ResultVO.error(500, "è¿è¡Œæ—¶å¼‚å¸¸: " + ex.getMessage());
    }
    
    // 3. å¤„ç†æ‰€æœ‰Exceptionï¼ˆæœ€é¡¶å±‚çˆ¶ç±»ï¼‰
    @ExceptionHandler(Exception.class)
    public ResultVO handleException(Exception ex) {
        return ResultVO.error(500, "ç³»ç»Ÿå¼‚å¸¸: " + ex.getMessage());
    }
}
```

**åŒ¹é…æµç¨‹**ï¼š
```
æŠ›å‡º ArithmeticException
    â†“
1. é¦–å…ˆæŸ¥æ‰¾: @ExceptionHandler(ArithmeticException.class)
   æ‰¾åˆ°äº† âœ“ â†’ ä½¿ç”¨è¿™ä¸ªå¤„ç†å™¨
    â†“
2. å¦‚æœæ²¡æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾çˆ¶ç±»: @ExceptionHandler(RuntimeException.class)
   æ‰¾åˆ°äº† âœ“ â†’ ä½¿ç”¨è¿™ä¸ªå¤„ç†å™¨
    â†“
3. å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾æœ€é¡¶å±‚: @ExceptionHandler(Exception.class)
   æ‰¾åˆ°äº† âœ“ â†’ ä½¿ç”¨è¿™ä¸ªå¤„ç†å™¨
    â†“
4. éƒ½æ²¡æ‰¾åˆ° â†’ ä½¿ç”¨SpringMVCé»˜è®¤å¼‚å¸¸å¤„ç†
```

### 6.2 åŒæ—¶å¤„ç†å¤šä¸ªå¼‚å¸¸


```java
@RestControllerAdvice
public class MultiExceptionHandler {
    
    // ä¸€ä¸ªæ–¹æ³•å¤„ç†å¤šä¸ªå¼‚å¸¸ç±»å‹
    @ExceptionHandler({
        UserNotFoundException.class,
        OrderNotFoundException.class,
        ProductNotFoundException.class
    })
    public ResultVO handleNotFound(RuntimeException ex) {
        return ResultVO.error(404, "èµ„æºä¸å­˜åœ¨: " + ex.getMessage());
    }
}
```

**é€‚ç”¨åœºæ™¯**ï¼šå¤šä¸ªå¼‚å¸¸çš„å¤„ç†é€»è¾‘ç›¸åŒæ—¶ï¼Œå¯ä»¥åˆå¹¶å¤„ç†ã€‚

### 6.3 å±€éƒ¨vså…¨å±€çš„ä¼˜å…ˆçº§


```
ä¼˜å…ˆçº§è§„åˆ™ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. Controllerå†…çš„ @ExceptionHandler
   â†“
2. @ControllerAdvice ä¸­çš„å…·ä½“å¼‚å¸¸
   â†“
3. @ControllerAdvice ä¸­çš„çˆ¶ç±»å¼‚å¸¸
   â†“
4. SpringMVC é»˜è®¤å¼‚å¸¸å¤„ç†
```

**å®é™…æ¡ˆä¾‹**ï¼š
```java
// å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@ControllerAdvice
public class GlobalHandler {
    @ExceptionHandler(UserNotFoundException.class)
    public ResultVO globalHandle(UserNotFoundException ex) {
        return ResultVO.error(404, "å…¨å±€å¤„ç†: " + ex.getMessage());
    }
}

// UserControllerå†…çš„å±€éƒ¨å¤„ç†
@RestController
public class UserController {
    
    @ExceptionHandler(UserNotFoundException.class)
    public ResultVO localHandle(UserNotFoundException ex) {
        return ResultVO.error(404, "å±€éƒ¨å¤„ç†: " + ex.getMessage());
    }
    
    @GetMapping("/user/{id}")
    public User getUser(@PathVariable Long id) {
        throw new UserNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨");
    }
}

// ç»“æœï¼šæ‰§è¡Œå±€éƒ¨å¤„ç†å™¨ï¼Œè¿”å› "å±€éƒ¨å¤„ç†: ç”¨æˆ·ä¸å­˜åœ¨"
```

---

## 7. ğŸ’¼ ä¸šåŠ¡å¼‚å¸¸ä¸ç³»ç»Ÿå¼‚å¸¸


### 7.1 å¼‚å¸¸åˆ†ç±»çš„é‡è¦æ€§


**é€šä¿—ç†è§£**ï¼šå°±åƒåŒ»ç”Ÿçœ‹ç—…è¦åˆ†æ¸…"æ„Ÿå†’"å’Œ"è‚ºç‚"ä¸€æ ·ï¼Œç¨‹åºå¼‚å¸¸ä¹Ÿè¦åˆ†æ¸…æ¥šã€‚

```
å¼‚å¸¸åˆ†ç±»ï¼š

ä¸šåŠ¡å¼‚å¸¸ (BusinessException)
â”œâ”€â”€ ç”¨æˆ·å¯ä»¥ç†è§£çš„é”™è¯¯
â”œâ”€â”€ éœ€è¦æç¤ºç»™ç”¨æˆ·
â”œâ”€â”€ ä¾‹å¦‚ï¼šå¯†ç é”™è¯¯ã€ä½™é¢ä¸è¶³ã€å•†å“å·²ä¸‹æ¶
â””â”€â”€ ä¸éœ€è¦è®°å½•è¯¦ç»†æ—¥å¿—

ç³»ç»Ÿå¼‚å¸¸ (SystemException)
â”œâ”€â”€ ç¨‹åºå†…éƒ¨é”™è¯¯
â”œâ”€â”€ ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ç»†èŠ‚
â”œâ”€â”€ ä¾‹å¦‚ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ã€æ–‡ä»¶è¯»å–é”™è¯¯
â””â”€â”€ éœ€è¦è®°å½•è¯¦ç»†æ—¥å¿—ä¾¿äºæ’æŸ¥
```

### 7.2 è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸


```java
/**
 * ä¸šåŠ¡å¼‚å¸¸ - ç”¨æˆ·å¯ä»¥ç†è§£çš„é”™è¯¯
 */
public class BusinessException extends RuntimeException {
    
    private Integer code;  // é”™è¯¯ç 
    
    public BusinessException(String message) {
        super(message);
        this.code = 400;
    }
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }
    
    public Integer getCode() {
        return code;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class UserService {
    
    public void login(String username, String password) {
        User user = userDao.findByUsername(username);
        
        if (user == null) {
            // æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
            throw new BusinessException("ç”¨æˆ·åä¸å­˜åœ¨");
        }
        
        if (!user.getPassword().equals(password)) {
            throw new BusinessException("å¯†ç é”™è¯¯");
        }
    }
}
```

### 7.3 è‡ªå®šä¹‰ç³»ç»Ÿå¼‚å¸¸


```java
/**
 * ç³»ç»Ÿå¼‚å¸¸ - ç¨‹åºå†…éƒ¨é”™è¯¯
 */
public class SystemException extends RuntimeException {
    
    private Integer code;
    
    public SystemException(String message) {
        super(message);
        this.code = 500;
    }
    
    public SystemException(String message, Throwable cause) {
        super(message, cause);
        this.code = 500;
    }
    
    public Integer getCode() {
        return code;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
public class UserService {
    
    public User findById(Long id) {
        try {
            return userDao.findById(id);
        } catch (SQLException e) {
            // åŒ…è£…æˆç³»ç»Ÿå¼‚å¸¸
            throw new SystemException("æ•°æ®åº“æŸ¥è¯¢å¤±è´¥", e);
        }
    }
}
```

### 7.4 åˆ†ç±»å¤„ç†å¼‚å¸¸


```java
@RestControllerAdvice
public class ExceptionClassifier {
    
    private static final Logger log = LoggerFactory.getLogger(ExceptionClassifier.class);
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸ - ç›´æ¥è¿”å›ç»™ç”¨æˆ·
    @ExceptionHandler(BusinessException.class)
    public ResultVO handleBusinessException(BusinessException ex) {
        // ä¸šåŠ¡å¼‚å¸¸åªè®°å½•ç®€å•æ—¥å¿—
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", ex.getMessage());
        
        return ResultVO.error(ex.getCode(), ex.getMessage());
    }
    
    // å¤„ç†ç³»ç»Ÿå¼‚å¸¸ - è¿”å›é€šç”¨æç¤º
    @ExceptionHandler(SystemException.class)
    public ResultVO handleSystemException(SystemException ex) {
        // ç³»ç»Ÿå¼‚å¸¸è®°å½•è¯¦ç»†æ—¥å¿—
        log.error("ç³»ç»Ÿå¼‚å¸¸", ex);
        
        // ä¸æš´éœ²å…·ä½“é”™è¯¯ç»™ç”¨æˆ·
        return ResultVO.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

**æ ¸å¿ƒå·®å¼‚**ï¼š

| å¯¹æ¯”é¡¹ | ä¸šåŠ¡å¼‚å¸¸ | ç³»ç»Ÿå¼‚å¸¸ |
|--------|---------|---------|
| **äº§ç”ŸåŸå› ** | ç”¨æˆ·æ“ä½œä¸å½“ | ç¨‹åºå†…éƒ¨é”™è¯¯ |
| **æç¤ºå†…å®¹** | å…·ä½“çš„é”™è¯¯ä¿¡æ¯ | é€šç”¨çš„å‹å¥½æç¤º |
| **æ—¥å¿—è®°å½•** | ç®€å•è®°å½• | è¯¦ç»†è®°å½•å †æ ˆ |
| **æ˜¯å¦å¯é¢„æµ‹** | å¯é¢„æµ‹ | ä¸å¯é¢„æµ‹ |

---

## 8. ğŸ“¦ é”™è¯¯ä¿¡æ¯å°è£…ä¸å“åº”


### 8.1 ç»Ÿä¸€ç»“æœå°è£…


**ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€å°è£…**ï¼Ÿ
- å‰ç«¯å¤„ç†æ›´æ–¹ä¾¿ï¼šç»Ÿä¸€çš„æ•°æ®æ ¼å¼
- ä¾¿äºç»´æŠ¤ï¼šä¿®æ”¹æ ¼å¼åªéœ€æ”¹ä¸€ä¸ªåœ°æ–¹
- æ›´ä¸“ä¸šï¼šè§„èŒƒçš„APIå“åº”

```java
/**
 * ç»Ÿä¸€è¿”å›ç»“æœç±»
 */
public class ResultVO<T> {
    
    private Integer code;      // çŠ¶æ€ç 
    private String message;    // æç¤ºä¿¡æ¯
    private T data;           // ä¸šåŠ¡æ•°æ®
    private Long timestamp;   // æ—¶é—´æˆ³
    
    // æˆåŠŸå“åº”
    public static <T> ResultVO<T> success(T data) {
        ResultVO<T> result = new ResultVO<>();
        result.code = 200;
        result.message = "æ“ä½œæˆåŠŸ";
        result.data = data;
        result.timestamp = System.currentTimeMillis();
        return result;
    }
    
    // å¤±è´¥å“åº”
    public static <T> ResultVO<T> error(Integer code, String message) {
        ResultVO<T> result = new ResultVO<>();
        result.code = code;
        result.message = message;
        result.data = null;
        result.timestamp = System.currentTimeMillis();
        return result;
    }
    
    // getter/setter...
}
```

### 8.2 é”™è¯¯ç è®¾è®¡


**åˆç†çš„é”™è¯¯ç åˆ†ç±»**ï¼š

```java
/**
 * é”™è¯¯ç å¸¸é‡ç±»
 */
public class ErrorCode {
    
    // ç³»ç»Ÿçº§é”™è¯¯ (10000-19999)
    public static final int SYSTEM_ERROR = 10000;
    public static final int DATABASE_ERROR = 10001;
    public static final int NETWORK_ERROR = 10002;
    
    // ä¸šåŠ¡çº§é”™è¯¯ (20000-29999)
    public static final int USER_NOT_FOUND = 20001;
    public static final int PASSWORD_ERROR = 20002;
    public static final int INSUFFICIENT_BALANCE = 20003;
    
    // å‚æ•°æ ¡éªŒé”™è¯¯ (30000-39999)
    public static final int PARAM_INVALID = 30001;
    public static final int PARAM_MISSING = 30002;
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ResultVO handleBusinessException(BusinessException ex) {
        return ResultVO.error(ex.getCode(), ex.getMessage());
    }
}

// ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨
if (balance < price) {
    throw new BusinessException(
        ErrorCode.INSUFFICIENT_BALANCE, 
        "ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢: " + balance
    );
}
```

### 8.3 é”™è¯¯é¡µé¢é…ç½®


**ä¼ ç»ŸMVCé¡¹ç›®çš„é”™è¯¯é¡µé¢**ï¼š

```java
@ControllerAdvice
public class WebExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public ModelAndView handleBusinessException(BusinessException ex) {
        ModelAndView mav = new ModelAndView();
        
        // æ ¹æ®ä¸åŒé”™è¯¯ç è·³è½¬ä¸åŒé¡µé¢
        switch (ex.getCode()) {
            case 404:
                mav.setViewName("error/404");
                break;
            case 403:
                mav.setViewName("error/403");
                break;
            default:
                mav.setViewName("error/500");
        }
        
        mav.addObject("errorMsg", ex.getMessage());
        mav.addObject("errorCode", ex.getCode());
        
        return mav;
    }
}
```

**é”™è¯¯é¡µé¢ç›®å½•ç»“æ„**ï¼š
```
webapp/
â””â”€â”€ WEB-INF/
    â””â”€â”€ views/
        â””â”€â”€ error/
            â”œâ”€â”€ 404.jsp    (èµ„æºä¸å­˜åœ¨)
            â”œâ”€â”€ 403.jsp    (æ— æƒé™)
            â”œâ”€â”€ 500.jsp    (æœåŠ¡å™¨é”™è¯¯)
            â””â”€â”€ business.jsp (ä¸šåŠ¡é”™è¯¯)
```

### 8.4 å¼‚å¸¸æ—¥å¿—è®°å½•


**å®Œæ•´çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ**ï¼š

```java
@RestControllerAdvice
public class LoggingExceptionHandler {
    
    private static final Logger log = LoggerFactory.getLogger(LoggingExceptionHandler.class);
    
    @ExceptionHandler(Exception.class)
    public ResultVO handleException(Exception ex, HttpServletRequest request) {
        
        // æ”¶é›†é”™è¯¯ä¿¡æ¯
        String url = request.getRequestURL().toString();
        String method = request.getMethod();
        String ip = getClientIP(request);
        String params = getRequestParams(request);
        
        // è®°å½•è¯¦ç»†æ—¥å¿—
        log.error("==== å¼‚å¸¸ä¿¡æ¯ ====");
        log.error("è¯·æ±‚URL: {}", url);
        log.error("è¯·æ±‚æ–¹æ³•: {}", method);
        log.error("å®¢æˆ·ç«¯IP: {}", ip);
        log.error("è¯·æ±‚å‚æ•°: {}", params);
        log.error("å¼‚å¸¸ç±»å‹: {}", ex.getClass().getName());
        log.error("å¼‚å¸¸ä¿¡æ¯: {}", ex.getMessage());
        log.error("å¼‚å¸¸å †æ ˆ: ", ex);
        log.error("==================");
        
        return ResultVO.error(500, "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
    }
    
    // è·å–å®¢æˆ·ç«¯IP
    private String getClientIP(HttpServletRequest request) {
        String ip = request.getHeader("X-Forwarded-For");
        if (ip == null || ip.isEmpty()) {
            ip = request.getRemoteAddr();
        }
        return ip;
    }
    
    // è·å–è¯·æ±‚å‚æ•°
    private String getRequestParams(HttpServletRequest request) {
        Map<String, String[]> paramMap = request.getParameterMap();
        return paramMap.toString();
    }
}
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
2025-09-23 10:30:15 ERROR [http-nio-8080-exec-1] LoggingExceptionHandler:
==== å¼‚å¸¸ä¿¡æ¯ ====
è¯·æ±‚URL: http://localhost:8080/api/user/999
è¯·æ±‚æ–¹æ³•: GET
å®¢æˆ·ç«¯IP: 192.168.1.100
è¯·æ±‚å‚æ•°: {id=[999]}
å¼‚å¸¸ç±»å‹: com.example.exception.UserNotFoundException
å¼‚å¸¸ä¿¡æ¯: ç”¨æˆ·ä¸å­˜åœ¨: 999
å¼‚å¸¸å †æ ˆ: 
com.example.exception.UserNotFoundException: ç”¨æˆ·ä¸å­˜åœ¨: 999
    at com.example.service.UserService.findById(UserService.java:25)
    at com.example.controller.UserController.getUser(UserController.java:45)
    ...
==================
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¼‚å¸¸å¤„ç†çš„æœ¬è´¨ï¼šæŠŠé”™è¯¯å¤„ç†é€»è¾‘ä»ä¸šåŠ¡ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥
ğŸ”¸ @ExceptionHandlerï¼šå¤„ç†å•ä¸ªControllerçš„å¼‚å¸¸ï¼ˆå±€éƒ¨å¤„ç†ï¼‰
ğŸ”¸ @ControllerAdviceï¼šå¤„ç†æ‰€æœ‰Controllerçš„å¼‚å¸¸ï¼ˆå…¨å±€å¤„ç†ï¼‰
ğŸ”¸ @RestControllerAdviceï¼šä¸“ä¸ºREST APIè®¾è®¡çš„å…¨å±€å¼‚å¸¸å¤„ç†
ğŸ”¸ å¼‚å¸¸åŒ¹é…è§„åˆ™ï¼šå…·ä½“å¼‚å¸¸ä¼˜å…ˆï¼Œå±€éƒ¨ä¼˜å…ˆäºå…¨å±€
ğŸ”¸ å¼‚å¸¸åˆ†ç±»ï¼šä¸šåŠ¡å¼‚å¸¸è¦æç¤ºç”¨æˆ·ï¼Œç³»ç»Ÿå¼‚å¸¸è¦è®°å½•æ—¥å¿—
ğŸ”¸ ç»Ÿä¸€å°è£…ï¼šä½¿ç”¨ResultVOç»Ÿä¸€è¿”å›æ ¼å¼ï¼Œä¾¿äºå‰ç«¯å¤„ç†
```

### 9.2 å®é™…å¼€å‘å»ºè®®


**æ¨èçš„å¼‚å¸¸å¤„ç†æ¶æ„**ï¼š

```
å®Œæ•´çš„å¼‚å¸¸å¤„ç†ä½“ç³»ï¼š

1. è‡ªå®šä¹‰å¼‚å¸¸ç±»
   â”œâ”€â”€ BusinessException (ä¸šåŠ¡å¼‚å¸¸)
   â””â”€â”€ SystemException (ç³»ç»Ÿå¼‚å¸¸)

2. å…¨å±€å¼‚å¸¸å¤„ç†å™¨
   â”œâ”€â”€ @RestControllerAdvice (REST API)
   â””â”€â”€ @ControllerAdvice (ä¼ ç»ŸMVC)

3. ç»Ÿä¸€è¿”å›ç»“æœ
   â”œâ”€â”€ ResultVO (ç»“æœå°è£…ç±»)
   â””â”€â”€ ErrorCode (é”™è¯¯ç å¸¸é‡)

4. æ—¥å¿—è®°å½•
   â”œâ”€â”€ ä¸šåŠ¡å¼‚å¸¸ï¼šç®€å•è®°å½•
   â””â”€â”€ ç³»ç»Ÿå¼‚å¸¸ï¼šè¯¦ç»†è®°å½•
```

**æœ€ä½³å®è·µæ¸…å•**ï¼š

- âœ… **ç»Ÿä¸€å¼‚å¸¸å¤„ç†**ï¼šä½¿ç”¨ `@ControllerAdvice` æˆ– `@RestControllerAdvice`
- âœ… **è‡ªå®šä¹‰å¼‚å¸¸**ï¼šåŒºåˆ†ä¸šåŠ¡å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸
- âœ… **ç»Ÿä¸€è¿”å›æ ¼å¼**ï¼šä½¿ç”¨ `ResultVO` å°è£…å“åº”ç»“æœ
- âœ… **åˆç†çš„é”™è¯¯ç **ï¼šåˆ†ç±»æ¸…æ™°çš„é”™è¯¯ç ä½“ç³»
- âœ… **è¯¦ç»†çš„æ—¥å¿—**ï¼šè®°å½•è¶³å¤Ÿçš„é”™è¯¯ä¿¡æ¯ä¾¿äºæ’æŸ¥
- âœ… **å‹å¥½çš„æç¤º**ï¼šç»™ç”¨æˆ·çœ‹å¾—æ‡‚çš„é”™è¯¯ä¿¡æ¯
- âœ… **å®‰å…¨æ€§è€ƒè™‘**ï¼šä¸æš´éœ²æ•æ„Ÿçš„ç³»ç»Ÿä¿¡æ¯

### 9.3 å¸¸è§é—®é¢˜è§£ç­”


**Q1: @ControllerAdvice å’Œ @RestControllerAdvice è¯¥ç”¨å“ªä¸ªï¼Ÿ**
```
ä¼ ç»ŸMVCé¡¹ç›®ï¼ˆè¿”å›é¡µé¢ï¼‰      â†’ @ControllerAdvice
å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼ˆè¿”å›JSONï¼‰    â†’ @RestControllerAdvice
```

**Q2: å±€éƒ¨å¼‚å¸¸å¤„ç†å’Œå…¨å±€å¼‚å¸¸å¤„ç†èƒ½åŒæ—¶å­˜åœ¨å—ï¼Ÿ**
```
å¯ä»¥ï¼æ‰§è¡Œé¡ºåºï¼š
1. ä¼˜å…ˆæ‰§è¡Œ Controller å†…çš„ @ExceptionHandler
2. å¦‚æœæ²¡æœ‰ï¼Œå†æ‰§è¡Œ @ControllerAdvice ä¸­çš„å¤„ç†å™¨
```

**Q3: å¼‚å¸¸å¤„ç†æ–¹æ³•å¯ä»¥æœ‰å¤šä¸ªå‚æ•°å—ï¼Ÿ**
```
å¯ä»¥ï¼SpringMVC ä¼šè‡ªåŠ¨æ³¨å…¥ï¼š
- Exception å¯¹è±¡
- HttpServletRequest
- HttpServletResponse
- Model
- ç­‰ç­‰...
```

**Q4: ä¸ºä»€ä¹ˆè¦åŒºåˆ†ä¸šåŠ¡å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸ï¼Ÿ**
```
ä¸šåŠ¡å¼‚å¸¸ï¼š
- ç”¨æˆ·èƒ½ç†è§£ï¼ˆå¯†ç é”™è¯¯ï¼‰
- éœ€è¦æ˜ç¡®æç¤º
- ç®€å•è®°å½•æ—¥å¿—

ç³»ç»Ÿå¼‚å¸¸ï¼š
- ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ç»†èŠ‚
- è¿”å›å‹å¥½æç¤ºï¼ˆç³»ç»Ÿç¹å¿™ï¼‰
- è¯¦ç»†è®°å½•æ—¥å¿—ä¾¿äºæ’æŸ¥
```

**Q5: å¼‚å¸¸å¤„ç†ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ**
```
å½±å“å¾ˆå°ï¼š
- åªæœ‰å‡ºç°å¼‚å¸¸æ—¶æ‰æ‰§è¡Œ
- æ­£å¸¸è¯·æ±‚ä¸å—å½±å“
- ç›¸æ¯”ä»£ç åˆ°å¤„try-catchï¼Œé›†ä¸­å¤„ç†æ›´æ¸…æ™°é«˜æ•ˆ
```

### 9.4 å®æˆ˜æ¡ˆä¾‹


**å®Œæ•´çš„å¼‚å¸¸å¤„ç†å®æˆ˜ç¤ºä¾‹**ï¼š

```java
// 1. è‡ªå®šä¹‰å¼‚å¸¸
public class BusinessException extends RuntimeException {
    private Integer code;
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }
    
    public Integer getCode() {
        return code;
    }
}

// 2. ç»Ÿä¸€è¿”å›ç»“æœ
public class ResultVO<T> {
    private Integer code;
    private String message;
    private T data;
    private Long timestamp;
    
    public static <T> ResultVO<T> success(T data) {
        ResultVO<T> result = new ResultVO<>();
        result.code = 200;
        result.message = "æ“ä½œæˆåŠŸ";
        result.data = data;
        result.timestamp = System.currentTimeMillis();
        return result;
    }
    
    public static <T> ResultVO<T> error(Integer code, String message) {
        ResultVO<T> result = new ResultVO<>();
        result.code = code;
        result.message = message;
        result.timestamp = System.currentTimeMillis();
        return result;
    }
}

// 3. å…¨å±€å¼‚å¸¸å¤„ç†å™¨
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger log = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    // ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public ResultVO handleBusinessException(BusinessException ex) {
        log.warn("ä¸šåŠ¡å¼‚å¸¸: {}", ex.getMessage());
        return ResultVO.error(ex.getCode(), ex.getMessage());
    }
    
    // å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResultVO handleValidException(MethodArgumentNotValidException ex) {
        String errorMsg = ex.getBindingResult()
                           .getFieldError()
                           .getDefaultMessage();
        return ResultVO.error(400, "å‚æ•°æ ¡éªŒå¤±è´¥: " + errorMsg);
    }
    
    // ç³»ç»Ÿå¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public ResultVO handleException(Exception ex, HttpServletRequest request) {
        log.error("ç³»ç»Ÿå¼‚å¸¸ - URL: {}", request.getRequestURL(), ex);
        return ResultVO.error(500, "ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}

// 4. ä¸šåŠ¡ä»£ç ä½¿ç”¨
@RestController
@RequestMapping("/api/user")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @PostMapping("/login")
    public ResultVO<User> login(@RequestBody LoginDTO dto) {
        // ä¸šåŠ¡ä»£ç åªç®¡æŠ›å¼‚å¸¸ï¼Œå¼‚å¸¸å¤„ç†äº¤ç»™å…¨å±€å¤„ç†å™¨
        User user = userService.login(dto.getUsername(), dto.getPassword());
        return ResultVO.success(user);
    }
}

@Service
public class UserService {
    
    public User login(String username, String password) {
        User user = userDao.findByUsername(username);
        
        if (user == null) {
            throw new BusinessException(20001, "ç”¨æˆ·åä¸å­˜åœ¨");
        }
        
        if (!user.getPassword().equals(password)) {
            throw new BusinessException(20002, "å¯†ç é”™è¯¯");
        }
        
        return user;
    }
}
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¼‚å¸¸å¤„ç†è¦é›†ä¸­ï¼Œä¸è¦åˆ°å¤„try-catch
ControllerAdviceå…¨å±€ç®¡ï¼ŒRestControllerAdviceè¿”JSON
ä¸šåŠ¡å¼‚å¸¸è¦æç¤ºï¼Œç³»ç»Ÿå¼‚å¸¸è¯¦ç»†è®°
ç»Ÿä¸€å°è£…è¿”å›å€¼ï¼Œé”™è¯¯ç åˆ†ç±»è¦æ¸…æ™°
æ—¥å¿—è®°å½•è¦è¯¦ç»†ï¼Œæ’æŸ¥é—®é¢˜æ‰å®¹æ˜“
```