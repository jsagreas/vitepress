---
title: 9ã€SpringMVCé«˜çº§ç‰¹æ€§
---
## ğŸ“š ç›®å½•


1. [å‚æ•°è§£æå™¨ä¸è¿”å›å€¼å¤„ç†å™¨](#1-å‚æ•°è§£æå™¨ä¸è¿”å›å€¼å¤„ç†å™¨)
2. [WebMvcConfigureré…ç½®å®šåˆ¶](#2-WebMvcConfigureré…ç½®å®šåˆ¶)
3. [å†…å®¹åå•†æœºåˆ¶](#3-å†…å®¹åå•†æœºåˆ¶)
4. [æ–‡ä»¶ä¸Šä¼ å¤„ç†](#4-æ–‡ä»¶ä¸Šä¼ å¤„ç†)
5. [å¼‚æ­¥è¯·æ±‚å¤„ç†](#5-å¼‚æ­¥è¯·æ±‚å¤„ç†)
6. [å›½é™…åŒ–i18næ”¯æŒ](#6-å›½é™…åŒ–i18næ”¯æŒ)
7. [é™æ€èµ„æºç®¡ç†](#7-é™æ€èµ„æºç®¡ç†)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ å‚æ•°è§£æå™¨ä¸è¿”å›å€¼å¤„ç†å™¨



### 1.1 ä»€ä¹ˆæ˜¯å‚æ•°è§£æå™¨ï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªé¤å…æœåŠ¡å‘˜ï¼Œå®¢äººç‚¹èœæ—¶æœ‰äººè¯´"æ¥ä»½ç›–æµ‡é¥­"ï¼Œæœ‰äººè¯´"rice with topping"ï¼Œè¿˜æœ‰äººç›´æ¥æŒ‡ç€èœå•ã€‚ä½ éœ€è¦æŠŠè¿™äº›**ä¸åŒå½¢å¼çš„éœ€æ±‚**éƒ½è½¬æ¢æˆå¨æˆ¿èƒ½ç†è§£çš„**ç»Ÿä¸€è®¢å•æ ¼å¼**ã€‚

**å‚æ•°è§£æå™¨ï¼ˆHandlerMethodArgumentResolverï¼‰** å°±æ˜¯SpringMVCä¸­çš„"ç¿»è¯‘å®˜"ï¼Œå®ƒè´Ÿè´£ï¼š
- æŠŠHTTPè¯·æ±‚ä¸­çš„å„ç§æ•°æ®ï¼ˆURLå‚æ•°ã€è¯·æ±‚ä½“ã€Cookieç­‰ï¼‰
- è½¬æ¢æˆControlleræ–¹æ³•èƒ½ç›´æ¥ä½¿ç”¨çš„Javaå¯¹è±¡

```
å®¢æˆ·ç«¯è¯·æ±‚              å‚æ•°è§£æå™¨                Controlleræ–¹æ³•
?id=100        â†’    è§£æå™¨è¯†åˆ«å¹¶è½¬æ¢    â†’    getUser(Long id)
{"name":"å¼ ä¸‰"}  â†’    è§£æå™¨è¯†åˆ«å¹¶è½¬æ¢    â†’    save(User user)
Cookieå€¼        â†’    è§£æå™¨è¯†åˆ«å¹¶è½¬æ¢    â†’    check(String token)
```

### 1.2 HandlerMethodArgumentResolveræ ¸å¿ƒæ¥å£



**ğŸ”¸ ä¸¤ä¸ªå…³é”®æ–¹æ³•**ï¼š

```java
public interface HandlerMethodArgumentResolver {
    // æ–¹æ³•1ï¼šåˆ¤æ–­èƒ½ä¸èƒ½å¤„ç†è¿™ä¸ªå‚æ•°
    boolean supportsParameter(MethodParameter parameter);
    
    // æ–¹æ³•2ï¼šçœŸæ­£è§£æå‚æ•°ï¼Œè¿”å›å‚æ•°å€¼
    Object resolveArgument(MethodParameter parameter, 
                          ModelAndViewContainer mavContainer,
                          NativeWebRequest webRequest, 
                          WebDataBinderFactory binderFactory);
}
```

**ğŸ“‹ å·¥ä½œæµç¨‹**ï¼š
```
1ï¸âƒ£ SpringMVCæ”¶åˆ°è¯·æ±‚
       â†“
2ï¸âƒ£ éå†æ‰€æœ‰å‚æ•°è§£æå™¨ï¼Œè°ƒç”¨supportsParameter()
       â†“
3ï¸âƒ£ æ‰¾åˆ°æ”¯æŒçš„è§£æå™¨
       â†“
4ï¸âƒ£ è°ƒç”¨resolveArgument()è·å–å‚æ•°å€¼
       â†“
5ï¸âƒ£ æŠŠå‚æ•°ä¼ ç»™Controlleræ–¹æ³•
```

### 1.3 è‡ªå®šä¹‰å‚æ•°è§£æå™¨å®æˆ˜



**åœºæ™¯**ï¼šæˆ‘ä»¬æƒ³ä»è¯·æ±‚å¤´ä¸­è‡ªåŠ¨è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯

**æ­¥éª¤1ï¼šåˆ›å»ºè‡ªå®šä¹‰æ³¨è§£**
```java
// è¿™ä¸ªæ³¨è§£ç”¨æ¥æ ‡è®°éœ€è¦è‡ªåŠ¨æ³¨å…¥ç”¨æˆ·ä¿¡æ¯çš„å‚æ•°
@Target(ElementType.PARAMETER)
@Retention(RetentionPolicy.RUNTIME)
public @interface CurrentUser {
}
```

**æ­¥éª¤2ï¼šå®ç°å‚æ•°è§£æå™¨**
```java
public class CurrentUserArgumentResolver implements HandlerMethodArgumentResolver {
    
    // åˆ¤æ–­ï¼šåªå¤„ç†å¸¦@CurrentUseræ³¨è§£çš„Userç±»å‹å‚æ•°
    @Override
    public boolean supportsParameter(MethodParameter parameter) {
        return parameter.hasParameterAnnotation(CurrentUser.class) 
            && parameter.getParameterType().equals(User.class);
    }
    
    // è§£æï¼šä»è¯·æ±‚å¤´è·å–tokenï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    @Override
    public Object resolveArgument(MethodParameter parameter, 
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest, 
                                 WebDataBinderFactory binderFactory) {
        // ä»è¯·æ±‚å¤´è·å–token
        String token = webRequest.getHeader("Authorization");
        
        // æ ¹æ®tokenæŸ¥è¯¢ç”¨æˆ·ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
        if (token != null) {
            return userService.getUserByToken(token);
        }
        
        return null;
    }
}
```

**æ­¥éª¤3ï¼šæ³¨å†Œè§£æå™¨**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(new CurrentUserArgumentResolver());
    }
}
```

**æ­¥éª¤4ï¼šä½¿ç”¨**
```java
@RestController
public class UserController {
    
    // ç°åœ¨å¯ä»¥ç›´æ¥è·å–å½“å‰ç”¨æˆ·ï¼Œä¸ç”¨æ‰‹åŠ¨ä»tokenè§£æäº†ï¼
    @GetMapping("/profile")
    public User getProfile(@CurrentUser User user) {
        return user;  // SpringMVCè‡ªåŠ¨æ³¨å…¥å½“å‰ç”¨æˆ·
    }
}
```

âœ… **ä¼˜åŠ¿å¯¹æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼š
@GetMapping("/profile")
public User getProfile(HttpServletRequest request) {
    String token = request.getHeader("Authorization");
    User user = userService.getUserByToken(token);
    return user;
}

ä½¿ç”¨å‚æ•°è§£æå™¨åï¼š
@GetMapping("/profile")
public User getProfile(@CurrentUser User user) {
    return user;  // ç®€æ´ï¼
}
```

### 1.4 ä»€ä¹ˆæ˜¯è¿”å›å€¼å¤„ç†å™¨ï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
è¿˜æ˜¯é¤å…çš„ä¾‹å­ï¼Œå¨æˆ¿åšå¥½èœåï¼Œæœ‰çš„å®¢äººè¦æ‰“åŒ…ï¼Œæœ‰çš„è¦å ‚é£Ÿï¼Œæœ‰çš„è¦é…ç±³é¥­ã€‚**è¿”å›å€¼å¤„ç†å™¨ï¼ˆHandlerMethodReturnValueHandlerï¼‰** å°±æ˜¯æ ¹æ®å®¢äººéœ€æ±‚ï¼ŒæŠŠèœä»¥**ä¸åŒå½¢å¼**å‘ˆç°å‡ºæ¥ã€‚

åœ¨SpringMVCä¸­ï¼š
- Controllerè¿”å›String â†’ è§†å›¾åç§°
- Controllerè¿”å›å¯¹è±¡ â†’ JSONæ•°æ®
- Controllerè¿”å›ModelAndView â†’ å®Œæ•´çš„æ¨¡å‹å’Œè§†å›¾

```
Controllerè¿”å›å€¼        è¿”å›å€¼å¤„ç†å™¨           æœ€ç»ˆå“åº”
return "index"    â†’   è§†å›¾è§£æå™¨å¤„ç†    â†’   è¿”å›index.html
return user       â†’   JSONè½¬æ¢å™¨å¤„ç†   â†’   è¿”å›{"id":1,"name":"å¼ ä¸‰"}
return "redirect:/" â†’ é‡å®šå‘å¤„ç†å™¨    â†’   302é‡å®šå‘å“åº”
```

### 1.5 HandlerMethodReturnValueHandleræ ¸å¿ƒæ¥å£



```java
public interface HandlerMethodReturnValueHandler {
    // åˆ¤æ–­èƒ½ä¸èƒ½å¤„ç†è¿™ä¸ªè¿”å›å€¼ç±»å‹
    boolean supportsReturnType(MethodParameter returnType);
    
    // çœŸæ­£å¤„ç†è¿”å›å€¼
    void handleReturnValue(Object returnValue,
                          MethodParameter returnType,
                          ModelAndViewContainer mavContainer,
                          NativeWebRequest webRequest);
}
```

### 1.6 è‡ªå®šä¹‰è¿”å›å€¼å¤„ç†å™¨å®æˆ˜



**åœºæ™¯**ï¼šç»Ÿä¸€åŒ…è£…æ‰€æœ‰æ¥å£çš„è¿”å›ç»“æœ

**æ­¥éª¤1ï¼šå®šä¹‰ç»Ÿä¸€è¿”å›æ ¼å¼**
```java
@Data
public class Result<T> {
    private int code;
    private String message;
    private T data;
    
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.code = 200;
        result.message = "success";
        result.data = data;
        return result;
    }
}
```

**æ­¥éª¤2ï¼šè‡ªå®šä¹‰è¿”å›å€¼å¤„ç†å™¨**
```java
public class ResultReturnValueHandler implements HandlerMethodReturnValueHandler {
    
    // å¤„ç†æ‰€æœ‰è¿”å›å€¼ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…è¦æ›´ç²¾ç»†ï¼‰
    @Override
    public boolean supportsReturnType(MethodParameter returnType) {
        return !returnType.getParameterType().equals(Result.class);
    }
    
    @Override
    public void handleReturnValue(Object returnValue,
                                 MethodParameter returnType,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest) {
        // åŒ…è£…æˆç»Ÿä¸€æ ¼å¼
        Result<?> result = Result.success(returnValue);
        
        // è½¬ä¸ºJSONè¿”å›
        HttpServletResponse response = webRequest.getNativeResponse(HttpServletResponse.class);
        response.setContentType("application/json;charset=UTF-8");
        
        ObjectMapper mapper = new ObjectMapper();
        mapper.writeValue(response.getWriter(), result);
        
        // æ ‡è®°è¯·æ±‚å·²å¤„ç†å®Œæˆ
        mavContainer.setRequestHandled(true);
    }
}
```

**æ­¥éª¤3ï¼šä½¿ç”¨æ•ˆæœ**
```java
@RestController
public class UserController {
    
    // åªéœ€è¦è¿”å›ä¸šåŠ¡æ•°æ®
    @GetMapping("/user/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.getById(id);
    }
}

// å®é™…è¿”å›ç»™å‰ç«¯çš„JSONï¼š
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "name": "å¼ ä¸‰"
    }
}
```

---

## 2. âš™ï¸ WebMvcConfigureré…ç½®å®šåˆ¶



### 2.1 ä»€ä¹ˆæ˜¯WebMvcConfigurerï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
æƒ³è±¡ä½ ä¹°äº†ä¸€è¾†è½¦ï¼Œè½¦å‚ç»™ä½ æä¾›äº†**åŸºæœ¬é…ç½®**ï¼ˆèƒ½å¼€èƒ½è·‘ï¼‰ï¼Œä½†ä½ å¯ä»¥å»**æ”¹è£…åº—å®šåˆ¶**ï¼šæ¢è½®èƒã€åŠ éŸ³å“ã€æ”¹åº§æ¤…ã€‚

**WebMvcConfigurer** å°±æ˜¯SpringMVCçš„"æ”¹è£…åº—"ï¼Œè®©ä½ åœ¨**ä¸ç ´ååŸæœ‰åŠŸèƒ½**çš„åŸºç¡€ä¸Šï¼Œ**ä¸ªæ€§åŒ–å®šåˆ¶**MVCè¡Œä¸ºã€‚

### 2.2 WebMvcConfigureræ ¸å¿ƒæ–¹æ³•ä¸€è§ˆ



```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    // 1. æ·»åŠ æ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LoginInterceptor())
                .addPathPatterns("/**")
                .excludePathPatterns("/login", "/register");
    }
    
    // 2. é…ç½®é™æ€èµ„æºå¤„ç†
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**")
                .addResourceLocations("classpath:/static/");
    }
    
    // 3. é…ç½®è·¨åŸŸ
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("http://localhost:8080")
                .allowedMethods("GET", "POST", "PUT", "DELETE");
    }
    
    // 4. é…ç½®æ¶ˆæ¯è½¬æ¢å™¨
    @Override
    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
        converters.add(new MappingJackson2HttpMessageConverter());
    }
    
    // 5. æ·»åŠ è§†å›¾æ§åˆ¶å™¨ï¼ˆä¸ç”¨å†™Controllerçš„ç®€å•é¡µé¢è·³è½¬ï¼‰
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addViewController("/login").setViewName("login");
    }
    
    // 6. é…ç½®è·¯å¾„åŒ¹é…è§„åˆ™
    @Override
    public void configurePathMatch(PathMatchConfigurer configurer) {
        configurer.setUseTrailingSlashMatch(true);  // /userå’Œ/user/éƒ½èƒ½è®¿é—®
    }
    
    // 7. æ·»åŠ æ ¼å¼åŒ–å™¨
    @Override
    public void addFormatters(FormatterRegistry registry) {
        registry.addFormatter(new DateFormatter("yyyy-MM-dd"));
    }
}
```

### 2.3 å¸¸ç”¨é…ç½®åœºæ™¯è¯¦è§£



**åœºæ™¯1ï¼šé…ç½®ç™»å½•æ‹¦æˆªå™¨**

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Autowired
    private LoginInterceptor loginInterceptor;
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loginInterceptor)
                .addPathPatterns("/**")                    // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
                .excludePathPatterns(                      // æ’é™¤è¿™äº›è·¯å¾„
                    "/login",           // ç™»å½•æ¥å£
                    "/register",        // æ³¨å†Œæ¥å£
                    "/static/**",       // é™æ€èµ„æº
                    "/error"            // é”™è¯¯é¡µé¢
                )
                .order(1);  // æ‰§è¡Œé¡ºåºï¼ˆæ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œï¼‰
    }
}
```

**åœºæ™¯2ï¼šé…ç½®è·¨åŸŸè®¿é—®**

```java
@Override
public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/api/**")                         // å“ªäº›æ¥å£å…è®¸è·¨åŸŸ
            .allowedOriginPatterns("*")                    // å…è®¸å“ªäº›åŸŸåï¼ˆ*è¡¨ç¤ºæ‰€æœ‰ï¼‰
            .allowedMethods("GET", "POST", "PUT", "DELETE") // å…è®¸çš„HTTPæ–¹æ³•
            .allowedHeaders("*")                           // å…è®¸çš„è¯·æ±‚å¤´
            .allowCredentials(true)                        // æ˜¯å¦å…è®¸æºå¸¦Cookie
            .maxAge(3600);                                 // é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
}
```

âš ï¸ **æ³¨æ„**ï¼š`allowedOriginPatterns("*")` å’Œ `allowCredentials(true)` ä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒè¦æŒ‡å®šå…·ä½“åŸŸåï¼

**åœºæ™¯3ï¼šè‡ªå®šä¹‰JSONåºåˆ—åŒ–è§„åˆ™**

```java
@Override
public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
    // åˆ›å»ºJacksonè½¬æ¢å™¨
    MappingJackson2HttpMessageConverter converter = new MappingJackson2HttpMessageConverter();
    
    // è‡ªå®šä¹‰é…ç½®
    ObjectMapper mapper = new ObjectMapper();
    
    // æ—¥æœŸæ ¼å¼åŒ–
    mapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
    
    // nullå€¼ä¸åºåˆ—åŒ–
    mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
    
    // æœªçŸ¥å±æ€§ä¸æŠ¥é”™
    mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
    
    converter.setObjectMapper(mapper);
    converters.add(0, converter);  // æ”¾åœ¨ç¬¬ä¸€ä¸ªä½ç½®
}
```

---

## 3. ğŸ”„ å†…å®¹åå•†æœºåˆ¶



### 3.1 ä»€ä¹ˆæ˜¯å†…å®¹åå•†ï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
ä½ å»è‚¯å¾·åŸºç‚¹é¤ï¼Œè¯´"æ¥ä¸ªå¥—é¤"ï¼ŒæœåŠ¡å‘˜ä¼šé—®ï¼š"å ‚é£Ÿè¿˜æ˜¯å¤–å¸¦ï¼Ÿ" è¿™å°±æ˜¯å†…å®¹åå•†â€”â€”**åŒæ ·çš„ä¸œè¥¿ï¼Œæ ¹æ®ä½ çš„éœ€è¦ï¼Œç»™ä½ ä¸åŒçš„å‘ˆç°æ–¹å¼**ã€‚

åœ¨Webå¼€å‘ä¸­ï¼š
- åŒä¸€ä¸ªæ¥å£
- æ ¹æ®å®¢æˆ·ç«¯éœ€è¦
- è¿”å›ä¸åŒæ ¼å¼çš„æ•°æ®ï¼ˆJSONã€XMLã€HTMLç­‰ï¼‰

```
å®¢æˆ·ç«¯è¯·æ±‚              æœåŠ¡å™¨åˆ¤æ–­                è¿”å›æ ¼å¼
Accept: application/json  â†’ è¯†åˆ«éœ€è¦JSON    â†’ è¿”å› {"name":"å¼ ä¸‰"}
Accept: application/xml   â†’ è¯†åˆ«éœ€è¦XML     â†’ è¿”å› <user><name>å¼ ä¸‰</name></user>
Accept: text/html         â†’ è¯†åˆ«éœ€è¦HTML    â†’ è¿”å› <h1>å¼ ä¸‰</h1>
```

### 3.2 å†…å®¹åå•†çš„ä¸¤ç§æ–¹å¼



**æ–¹å¼1ï¼šåŸºäºè¯·æ±‚å¤´Acceptï¼ˆæ¨èï¼‰**

å®¢æˆ·ç«¯é€šè¿‡HTTPè¯·æ±‚å¤´å‘Šè¯‰æœåŠ¡å™¨æƒ³è¦ä»€ä¹ˆæ ¼å¼ï¼š

```http
GET /user/1 HTTP/1.1
Accept: application/json    â† è¿™ä¸ªå¤´å‘Šè¯‰æœåŠ¡å™¨ï¼šæˆ‘è¦JSONæ ¼å¼
```

**æ–¹å¼2ï¼šåŸºäºURLå‚æ•°**

é€šè¿‡URLå‚æ•°æŒ‡å®šæ ¼å¼ï¼š

```
/user/1?format=json    â†’ è¿”å›JSON
/user/1?format=xml     â†’ è¿”å›XML
```

### 3.3 é…ç½®å†…å®¹åå•†ç­–ç•¥



```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer
            // 1. æ˜¯å¦å¯ç”¨URLå‚æ•°æ–¹å¼
            .favorParameter(true)                    // å¼€å¯URLå‚æ•°
            .parameterName("format")                 // å‚æ•°åå«format
            
            // 2. æ˜¯å¦å¿½ç•¥Acceptè¯·æ±‚å¤´
            .ignoreAcceptHeader(false)               // ä¸å¿½ç•¥Acceptå¤´
            
            // 3. é»˜è®¤è¿”å›æ ¼å¼
            .defaultContentType(MediaType.APPLICATION_JSON)
            
            // 4. é…ç½®æ ¼å¼æ˜ å°„
            .mediaType("json", MediaType.APPLICATION_JSON)
            .mediaType("xml", MediaType.APPLICATION_XML);
    }
}
```

### 3.4 å®é™…ä½¿ç”¨ç¤ºä¾‹



**Controllerä»£ç **ï¼ˆä¸€ä»½ä»£ç ï¼Œå¤šç§æ ¼å¼ï¼‰ï¼š

```java
@RestController
public class UserController {
    
    @GetMapping("/user/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.getById(id);
    }
}
```

**å®¢æˆ·ç«¯è®¿é—®**ï¼š

```bash
# æ–¹å¼1ï¼šé€šè¿‡Acceptè¯·æ±‚å¤´

curl -H "Accept: application/json" http://localhost:8080/user/1
# è¿”å›ï¼š{"id":1,"name":"å¼ ä¸‰"}


curl -H "Accept: application/xml" http://localhost:8080/user/1
# è¿”å›ï¼š<user><id>1</id><name>å¼ ä¸‰</name></user>


# æ–¹å¼2ï¼šé€šè¿‡URLå‚æ•°

curl http://localhost:8080/user/1?format=json
# è¿”å›ï¼š{"id":1,"name":"å¼ ä¸‰"}

```

ğŸ’¡ **ä½¿ç”¨åœºæ™¯**ï¼š
- ç§»åŠ¨ç«¯è¦JSONï¼ˆè½»é‡ï¼‰
- PCç«¯å¯èƒ½è¦XMLï¼ˆæŸäº›è€ç³»ç»Ÿï¼‰
- çˆ¬è™«å¯èƒ½è¦HTML
- **åŒä¸€å¥—ä»£ç ï¼Œæ»¡è¶³ä¸åŒå®¢æˆ·ç«¯éœ€æ±‚ï¼**

---

## 4. ğŸ“ æ–‡ä»¶ä¸Šä¼ å¤„ç†



### 4.1 ä»€ä¹ˆæ˜¯MultipartResolverï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
ä½ è¦é‚®å¯„ä¸€ä¸ªåŒ…è£¹ï¼Œå¿«é€’å‘˜éœ€è¦ï¼š
1. è¯†åˆ«è¿™æ˜¯ä¸ªåŒ…è£¹ï¼ˆä¸æ˜¯æ™®é€šä¿¡ä»¶ï¼‰
2. æ‹†å¼€åŒ…è£¹çœ‹é‡Œé¢æœ‰ä»€ä¹ˆ
3. æŠŠæ¯ä¸ªç‰©å“åˆ†ç±»æ•´ç†

**MultipartResolverï¼ˆæ–‡ä»¶ä¸Šä¼ è§£æå™¨ï¼‰** å°±æ˜¯SpringMVCçš„"å¿«é€’åˆ†æ‹£å‘˜"ï¼Œè´Ÿè´£ï¼š
- è¯†åˆ«æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
- è§£æè¯·æ±‚ä¸­çš„æ–‡ä»¶æ•°æ®
- æŠŠæ–‡ä»¶è½¬æ¢æˆJavaèƒ½å¤„ç†çš„å¯¹è±¡

### 4.2 é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨



**æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¨èæ–°æ‰‹ï¼‰**

```java
@Configuration
public class FileUploadConfig {
    
    @Bean
    public MultipartResolver multipartResolver() {
        CommonsMultipartResolver resolver = new CommonsMultipartResolver();
        
        // è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼‰
        resolver.setMaxUploadSize(10 * 1024 * 1024);  // 10MB
        
        // è®¾ç½®å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å¤§å°
        resolver.setMaxUploadSizePerFile(5 * 1024 * 1024);  // 5MB
        
        // è®¾ç½®ç¼–ç æ ¼å¼
        resolver.setDefaultEncoding("UTF-8");
        
        return resolver;
    }
}
```

**æ–¹å¼2ï¼šä½¿ç”¨application.ymlé…ç½®**

```yaml
spring:
  servlet:
    multipart:
      enabled: true              # å¯ç”¨æ–‡ä»¶ä¸Šä¼ 
      max-file-size: 10MB        # å•ä¸ªæ–‡ä»¶æœ€å¤§10MB
      max-request-size: 50MB     # æ•´ä¸ªè¯·æ±‚æœ€å¤§50MB
      file-size-threshold: 1MB   # è¶…è¿‡1MBå†™å…¥ä¸´æ—¶æ–‡ä»¶
```

### 4.3 å•æ–‡ä»¶ä¸Šä¼ å®æˆ˜



**å‰ç«¯ä»£ç **ï¼š

```html
<form method="post" action="/upload" enctype="multipart/form-data">
    <input type="file" name="file" />
    <button type="submit">ä¸Šä¼ </button>
</form>
```

**åç«¯Controller**ï¼š

```java
@RestController
public class FileUploadController {
    
    @PostMapping("/upload")
    public String uploadFile(@RequestParam("file") MultipartFile file) {
        
        // 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
        if (file.isEmpty()) {
            return "æ–‡ä»¶ä¸ºç©ºï¼Œä¸Šä¼ å¤±è´¥ï¼";
        }
        
        // 2. è·å–æ–‡ä»¶ä¿¡æ¯
        String fileName = file.getOriginalFilename();  // åŸå§‹æ–‡ä»¶å
        long fileSize = file.getSize();                // æ–‡ä»¶å¤§å°
        String contentType = file.getContentType();    // æ–‡ä»¶ç±»å‹
        
        System.out.println("æ–‡ä»¶åï¼š" + fileName);
        System.out.println("å¤§å°ï¼š" + fileSize + " å­—èŠ‚");
        
        // 3. ä¿å­˜æ–‡ä»¶åˆ°æœåŠ¡å™¨
        try {
            String uploadDir = "D:/uploads/";
            File dest = new File(uploadDir + fileName);
            
            // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•
            if (!dest.getParentFile().exists()) {
                dest.getParentFile().mkdirs();
            }
            
            // ä¿å­˜æ–‡ä»¶
            file.transferTo(dest);
            
            return "ä¸Šä¼ æˆåŠŸï¼æ–‡ä»¶ä¿å­˜åœ¨ï¼š" + dest.getAbsolutePath();
            
        } catch (IOException e) {
            e.printStackTrace();
            return "ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage();
        }
    }
}
```

### 4.4 å¤šæ–‡ä»¶ä¸Šä¼ 



```java
@PostMapping("/upload/multiple")
public String uploadMultipleFiles(@RequestParam("files") MultipartFile[] files) {
    
    if (files == null || files.length == 0) {
        return "è¯·é€‰æ‹©æ–‡ä»¶ï¼";
    }
    
    StringBuilder result = new StringBuilder();
    
    // å¾ªç¯å¤„ç†æ¯ä¸ªæ–‡ä»¶
    for (MultipartFile file : files) {
        if (!file.isEmpty()) {
            String fileName = file.getOriginalFilename();
            
            try {
                File dest = new File("D:/uploads/" + fileName);
                file.transferTo(dest);
                result.append(fileName).append(" ä¸Šä¼ æˆåŠŸï¼\n");
                
            } catch (IOException e) {
                result.append(fileName).append(" ä¸Šä¼ å¤±è´¥ï¼\n");
            }
        }
    }
    
    return result.toString();
}
```

### 4.5 æ–‡ä»¶ä¸Šä¼ æœ€ä½³å®è·µ



**âœ… å®‰å…¨æ£€æŸ¥æ¸…å•**ï¼š

```java
@PostMapping("/upload/safe")
public String uploadFileSafely(@RequestParam("file") MultipartFile file) {
    
    // 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
    if (file.isEmpty()) {
        return "æ–‡ä»¶ä¸ºç©ºï¼";
    }
    
    // 2. æ£€æŸ¥æ–‡ä»¶å¤§å°
    if (file.getSize() > 10 * 1024 * 1024) {  // å¤§äº10MB
        return "æ–‡ä»¶å¤ªå¤§ï¼Œè¯·ä¸Šä¼ å°äº10MBçš„æ–‡ä»¶ï¼";
    }
    
    // 3. æ£€æŸ¥æ–‡ä»¶ç±»å‹ï¼ˆåªå…è®¸å›¾ç‰‡ï¼‰
    String contentType = file.getContentType();
    if (!contentType.startsWith("image/")) {
        return "åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼";
    }
    
    // 4. é‡å‘½åæ–‡ä»¶ï¼ˆé¿å…æ–‡ä»¶åå†²çªå’Œå®‰å…¨é—®é¢˜ï¼‰
    String originalName = file.getOriginalFilename();
    String extension = originalName.substring(originalName.lastIndexOf("."));
    String newFileName = UUID.randomUUID().toString() + extension;
    
    // 5. æŒ‰æ—¥æœŸåˆ†ç›®å½•å­˜å‚¨
    String dateDir = new SimpleDateFormat("yyyy/MM/dd").format(new Date());
    String uploadPath = "D:/uploads/" + dateDir + "/";
    
    File dest = new File(uploadPath + newFileName);
    dest.getParentFile().mkdirs();
    
    try {
        file.transferTo(dest);
        return "ä¸Šä¼ æˆåŠŸï¼æ–‡ä»¶è·¯å¾„ï¼š" + dateDir + "/" + newFileName;
    } catch (IOException e) {
        return "ä¸Šä¼ å¤±è´¥ï¼";
    }
}
```

ğŸ“‹ **æ–‡ä»¶ä¸Šä¼ æµç¨‹å›¾**ï¼š

```
å®¢æˆ·ç«¯é€‰æ‹©æ–‡ä»¶
       â†“
æµè§ˆå™¨å‘é€multipart/form-dataè¯·æ±‚
       â†“
MultipartResolverè§£æè¯·æ±‚
       â†“
è½¬æ¢ä¸ºMultipartFileå¯¹è±¡
       â†“
Controlleræ¥æ”¶æ–‡ä»¶å¯¹è±¡
       â†“
ã€å®‰å…¨æ£€æŸ¥ã€‘
â”œâ”€ æ£€æŸ¥æ–‡ä»¶å¤§å°
â”œâ”€ æ£€æŸ¥æ–‡ä»¶ç±»å‹
â””â”€ æ£€æŸ¥æ–‡ä»¶å
       â†“
ä¿å­˜åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•
       â†“
è¿”å›ä¸Šä¼ ç»“æœ
```

---

## 5. â±ï¸ å¼‚æ­¥è¯·æ±‚å¤„ç†



### 5.1 ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥è¯·æ±‚ï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
æƒ³è±¡ä½ å»é“¶è¡ŒåŠä¸šåŠ¡ï¼š

**åŒæ­¥æ–¹å¼ï¼ˆä¼ ç»Ÿï¼‰**ï¼š
```
ä½ åˆ°çª—å£ â†’ å·¥ä½œäººå‘˜å¤„ç† â†’ ä½ ä¸€ç›´ç­‰ç€ â†’ å¤„ç†å®Œæˆ â†’ ä½ ç¦»å¼€
é—®é¢˜ï¼šå·¥ä½œäººå‘˜å¿™çš„æ—¶å€™ï¼Œä½ è¦ä¸€ç›´å¹²ç­‰ç€ï¼
```

**å¼‚æ­¥æ–¹å¼**ï¼š
```
ä½ åˆ°çª—å£ â†’ é¢†å–å·ç ç‰Œ â†’ ä½ å»æ—è¾¹åç€ç©æ‰‹æœº â†’ å«å·æ—¶å†æ¥åŠç†
ä¼˜åŠ¿ï¼šä½ ä¸ç”¨å¹²ç­‰ï¼Œå¯ä»¥åšå…¶ä»–äº‹æƒ…ï¼
```

åœ¨Webåº”ç”¨ä¸­ï¼š
- **åŒæ­¥**ï¼šä¸€ä¸ªè¯·æ±‚å ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å®Œæ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚
- **å¼‚æ­¥**ï¼šè¯·æ±‚åˆ°è¾¾åï¼Œçº¿ç¨‹å¯ä»¥å»å¤„ç†å…¶ä»–è¯·æ±‚ï¼Œç­‰ç»“æœå‡†å¤‡å¥½å†è¿”å›

### 5.2 DeferredResultå¼‚æ­¥å¤„ç†



**ğŸ”¸ DeferredResultæ˜¯ä»€ä¹ˆï¼Ÿ**

å®ƒæ˜¯ä¸€ä¸ª"ç»“æœå ä½ç¬¦"ï¼Œæ„æ€æ˜¯ï¼š
- ç°åœ¨ç»“æœè¿˜æ²¡å‡†å¤‡å¥½
- ç­‰ç»“æœå‡†å¤‡å¥½äº†ï¼Œæˆ‘å†å‘Šè¯‰ä½ 
- åœ¨ç­‰å¾…æœŸé—´ï¼ŒæœåŠ¡å™¨çº¿ç¨‹å¯ä»¥å»å¹²åˆ«çš„äº‹

**ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼šè®¢å•æ”¯ä»˜**

```java
@RestController
public class PaymentController {
    
    // å­˜å‚¨å¾…å¤„ç†çš„æ”¯ä»˜ç»“æœï¼ˆå®é™…åº”è¯¥ç”¨Redisç­‰ï¼‰
    private Map<String, DeferredResult<String>> paymentResults = new ConcurrentHashMap<>();
    
    @GetMapping("/pay/{orderId}")
    public DeferredResult<String> pay(@PathVariable String orderId) {
        
        // 1. åˆ›å»ºDeferredResultï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´30ç§’
        DeferredResult<String> result = new DeferredResult<>(30000L);
        
        // 2. è®¾ç½®è¶…æ—¶å›è°ƒ
        result.onTimeout(() -> {
            result.setResult("æ”¯ä»˜è¶…æ—¶ï¼Œè¯·é‡è¯•ï¼");
        });
        
        // 3. ä¿å­˜åˆ°Mapä¸­ï¼ˆç­‰å¾…æ”¯ä»˜å›è°ƒï¼‰
        paymentResults.put(orderId, result);
        
        // 4. è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£ï¼ˆå¼‚æ­¥ï¼‰
        paymentService.requestPayment(orderId);
        
        // 5. ç«‹å³è¿”å›DeferredResultï¼ˆä¸é˜»å¡çº¿ç¨‹ï¼‰
        return result;
    }
    
    // æ”¯ä»˜å¹³å°çš„å›è°ƒæ¥å£
    @PostMapping("/pay/callback")
    public String paymentCallback(@RequestParam String orderId, 
                                  @RequestParam String status) {
        
        // 1. ä»Mapä¸­å–å‡ºå¯¹åº”çš„DeferredResult
        DeferredResult<String> result = paymentResults.get(orderId);
        
        if (result != null) {
            // 2. è®¾ç½®ç»“æœï¼ˆè¿™æ—¶æ‰çœŸæ­£è¿”å›ç»™å®¢æˆ·ç«¯ï¼‰
            if ("SUCCESS".equals(status)) {
                result.setResult("æ”¯ä»˜æˆåŠŸï¼");
            } else {
                result.setResult("æ”¯ä»˜å¤±è´¥ï¼");
            }
            
            // 3. ç§»é™¤å·²å¤„ç†çš„ç»“æœ
            paymentResults.remove(orderId);
        }
        
        return "OK";
    }
}
```

**ğŸ“Š DeferredResultå·¥ä½œæµç¨‹**ï¼š

```
å®¢æˆ·ç«¯è¯·æ±‚æ”¯ä»˜
       â†“
Controlleråˆ›å»ºDeferredResultå¹¶è¿”å›
       â†“
ã€æœåŠ¡å™¨çº¿ç¨‹é‡Šæ”¾ï¼Œå¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚ã€‘
       â†“
è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£
       â†“
ç­‰å¾…æ”¯ä»˜å¹³å°å›è°ƒ...
       â†“
æ”¯ä»˜å¹³å°å›è°ƒ
       â†“
setResult()è®¾ç½®ç»“æœ
       â†“
SpringMVCå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯
```

### 5.3 Callableå¼‚æ­¥å¤„ç†



**ğŸ”¸ Callableæ˜¯ä»€ä¹ˆï¼Ÿ**

Callableæ›´ç®€å•ï¼Œå®ƒæ˜¯ä¸€ä¸ª"å¯ä»¥è¿”å›ç»“æœçš„ä»»åŠ¡"ï¼š
- ä½ å‘Šè¯‰SpringMVCè¦æ‰§è¡Œä»€ä¹ˆä»»åŠ¡
- SpringMVCæŠŠä»»åŠ¡ä¸¢ç»™çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œ
- æ‰§è¡Œå®Œäº†è‡ªåŠ¨è¿”å›ç»“æœ

```java
@RestController
public class ReportController {
    
    @GetMapping("/report/generate")
    public Callable<String> generateReport() {
        
        return () -> {
            // è¿™æ®µä»£ç åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œ
            
            System.out.println("å¼€å§‹ç”ŸæˆæŠ¥è¡¨... çº¿ç¨‹ï¼š" + Thread.currentThread().getName());
            
            // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚æŸ¥è¯¢å¤§é‡æ•°æ®ã€ç”ŸæˆPDFï¼‰
            Thread.sleep(5000);
            
            System.out.println("æŠ¥è¡¨ç”Ÿæˆå®Œæˆï¼");
            
            return "æŠ¥è¡¨ç”ŸæˆæˆåŠŸï¼ä¸‹è½½é“¾æ¥ï¼šhttp://xxx.com/report.pdf";
        };
    }
}
```

**ğŸ“‹ Callable vs DeferredResult å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | **Callable** | **DeferredResult** |
|------|-------------|-------------------|
| **ä½¿ç”¨éš¾åº¦** | ç®€å•ï¼Œç›´æ¥return | ç¨å¤æ‚ï¼Œéœ€è¦æ‰‹åŠ¨setResult |
| **é€‚ç”¨åœºæ™¯** | æœåŠ¡å™¨å†…éƒ¨è€—æ—¶æ“ä½œ | ç­‰å¾…å¤–éƒ¨ç³»ç»Ÿå›è°ƒ |
| **çº¿ç¨‹ç®¡ç†** | SpringMVCè‡ªåŠ¨ç®¡ç† | æ‰‹åŠ¨ç®¡ç† |
| **å…¸å‹ä¾‹å­** | ç”ŸæˆæŠ¥è¡¨ã€æ•°æ®ç»Ÿè®¡ | æ”¯ä»˜å›è°ƒã€æ¶ˆæ¯æ¨é€ |

### 5.4 é…ç½®å¼‚æ­¥çº¿ç¨‹æ± 



```java
@Configuration
@EnableAsync  // å¯ç”¨å¼‚æ­¥æ”¯æŒ
public class AsyncConfig implements WebMvcConfigurer {
    
    @Override
    public void configureAsyncSupport(AsyncSupportConfigurer configurer) {
        
        // 1. é…ç½®çº¿ç¨‹æ± 
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);           // æ ¸å¿ƒçº¿ç¨‹æ•°
        executor.setMaxPoolSize(50);            // æœ€å¤§çº¿ç¨‹æ•°
        executor.setQueueCapacity(100);         // é˜Ÿåˆ—å®¹é‡
        executor.setThreadNamePrefix("async-"); // çº¿ç¨‹åå‰ç¼€
        executor.initialize();
        
        configurer.setTaskExecutor(executor);
        
        // 2. è®¾ç½®é»˜è®¤è¶…æ—¶æ—¶é—´
        configurer.setDefaultTimeout(30000);    // 30ç§’
    }
}
```

---

## 6. ğŸŒ å›½é™…åŒ–i18næ”¯æŒ



### 6.1 ä»€ä¹ˆæ˜¯å›½é™…åŒ–ï¼Ÿ



ğŸ’¡ **å¤§ç™½è¯ç†è§£**ï¼š
ä½ å¼€å‘äº†ä¸€ä¸ªç½‘ç«™ï¼Œä¸­å›½ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ä¸­æ–‡ï¼Œç¾å›½ç”¨æˆ·çœ‹åˆ°çš„æ˜¯è‹±æ–‡ï¼Œæ—¥æœ¬ç”¨æˆ·çœ‹åˆ°çš„æ˜¯æ—¥æ–‡ã€‚**åŒä¸€ä¸ªç½‘ç«™ï¼Œè‡ªåŠ¨æ˜¾ç¤ºä¸åŒè¯­è¨€**ï¼Œè¿™å°±æ˜¯å›½é™…åŒ–ï¼ˆi18nï¼‰ã€‚

> i18n = internationalizationï¼ˆå•è¯å¤ªé•¿ï¼Œä¸­é—´çœç•¥18ä¸ªå­—æ¯ï¼‰

### 6.2 å›½é™…åŒ–ä¸‰è¦ç´ 



```
1ï¸âƒ£ æ¶ˆæ¯èµ„æºæ–‡ä»¶ï¼ˆå­˜æ”¾ä¸åŒè¯­è¨€çš„æ–‡æœ¬ï¼‰
      messages_zh_CN.properties  â†’ ä¸­æ–‡
      messages_en_US.properties  â†’ è‹±æ–‡
      messages_ja_JP.properties  â†’ æ—¥æ–‡

2ï¸âƒ£ LocaleResolverï¼ˆåŒºåŸŸè§£æå™¨ï¼‰
      åˆ¤æ–­ç”¨æˆ·ä½¿ç”¨ä»€ä¹ˆè¯­è¨€

3ï¸âƒ£ MessageSourceï¼ˆæ¶ˆæ¯èµ„æºç®¡ç†å™¨ï¼‰
      æ ¹æ®è¯­è¨€è¯»å–å¯¹åº”çš„æ–‡æœ¬
```

### 6.3 é…ç½®å›½é™…åŒ–



**æ­¥éª¤1ï¼šåˆ›å»ºæ¶ˆæ¯èµ„æºæ–‡ä»¶**

åœ¨ `src/main/resources/i18n/` ç›®å½•ä¸‹åˆ›å»ºï¼š

**messages_zh_CN.propertiesï¼ˆä¸­æ–‡ï¼‰**ï¼š
```properties
welcome=æ¬¢è¿ä½¿ç”¨æœ¬ç³»ç»Ÿ
login.username=ç”¨æˆ·å
login.password=å¯†ç 
login.submit=ç™»å½•
error.username.empty=ç”¨æˆ·åä¸èƒ½ä¸ºç©º
```

**messages_en_US.propertiesï¼ˆè‹±æ–‡ï¼‰**ï¼š
```properties
welcome=Welcome to our system
login.username=Username
login.password=Password
login.submit=Login
error.username.empty=Username cannot be empty
```

**æ­¥éª¤2ï¼šé…ç½®MessageSource**

```java
@Configuration
public class I18nConfig {
    
    @Bean
    public MessageSource messageSource() {
        ResourceBundleMessageSource messageSource = new ResourceBundleMessageSource();
        
        // è®¾ç½®æ¶ˆæ¯æ–‡ä»¶åŸºç¡€åï¼ˆä¸å«è¯­è¨€åç¼€ï¼‰
        messageSource.setBasename("i18n/messages");
        
        // è®¾ç½®ç¼–ç æ ¼å¼
        messageSource.setDefaultEncoding("UTF-8");
        
        // è®¾ç½®ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œ-1è¡¨ç¤ºæ°¸ä¹…ç¼“å­˜
        messageSource.setCacheSeconds(3600);
        
        return messageSource;
    }
}
```

**æ­¥éª¤3ï¼šé…ç½®LocaleResolver**

```java
@Configuration
public class I18nConfig {
    
    // ä»è¯·æ±‚å¤´Accept-Languageè·å–è¯­è¨€
    @Bean
    public LocaleResolver localeResolver() {
        AcceptHeaderLocaleResolver resolver = new AcceptHeaderLocaleResolver();
        resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);  // é»˜è®¤ä¸­æ–‡
        return resolver;
    }
    
    // æˆ–è€…ï¼šä»Sessionä¸­è·å–è¯­è¨€
    @Bean
    public LocaleResolver sessionLocaleResolver() {
        SessionLocaleResolver resolver = new SessionLocaleResolver();
        resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
        return resolver;
    }
}
```

### 6.4 ä½¿ç”¨å›½é™…åŒ–æ¶ˆæ¯



**åœ¨Controllerä¸­ä½¿ç”¨**ï¼š

```java
@RestController
public class I18nController {
    
    @Autowired
    private MessageSource messageSource;
    
    @GetMapping("/welcome")
    public String welcome(Locale locale) {
        // localeå‚æ•°SpringMVCä¼šè‡ªåŠ¨æ³¨å…¥å½“å‰è¯·æ±‚çš„è¯­è¨€ç¯å¢ƒ
        return messageSource.getMessage("welcome", null, locale);
    }
    
    @GetMapping("/login/error")
    public String loginError(Locale locale) {
        // å¸¦å‚æ•°çš„æ¶ˆæ¯
        return messageSource.getMessage("error.username.empty", null, locale);
    }
}
```

**åœ¨æ¨¡æ¿å¼•æ“ä¸­ä½¿ç”¨ï¼ˆThymeleafï¼‰**ï¼š

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{welcome}"></title>
</head>
<body>
    <h1 th:text="#{welcome}"></h1>
    
    <form>
        <label th:text="#{login.username}"></label>
        <input type="text" name="username"/>
        
        <label th:text="#{login.password}"></label>
        <input type="password" name="password"/>
        
        <button th:text="#{login.submit}"></button>
    </form>
</body>
</html>
```

### 6.5 åˆ‡æ¢è¯­è¨€



**æ–¹å¼1ï¼šé€šè¿‡URLå‚æ•°åˆ‡æ¢**

```java
@Configuration
public class I18nConfig implements WebMvcConfigurer {
    
    @Bean
    public LocaleResolver localeResolver() {
        SessionLocaleResolver resolver = new SessionLocaleResolver();
        resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
        return resolver;
    }
    
    // æ·»åŠ è¯­è¨€åˆ‡æ¢æ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
        interceptor.setParamName("lang");  // URLå‚æ•°å
        registry.addInterceptor(interceptor);
    }
}
```

**ä½¿ç”¨**ï¼š
```
è®¿é—® http://localhost:8080/welcome?lang=en_US  â†’ æ˜¾ç¤ºè‹±æ–‡
è®¿é—® http://localhost:8080/welcome?lang=zh_CN  â†’ æ˜¾ç¤ºä¸­æ–‡
```

**æ–¹å¼2ï¼šé€šè¿‡Cookieåˆ‡æ¢**

```java
@Bean
public LocaleResolver cookieLocaleResolver() {
    CookieLocaleResolver resolver = new CookieLocaleResolver();
    resolver.setDefaultLocale(Locale.SIMPLIFIED_CHINESE);
    resolver.setCookieName("language");      // Cookieåç§°
    resolver.setCookieMaxAge(3600);          // Cookieæœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
    return resolver;
}
```

---

## 7. ğŸ“¦ é™æ€èµ„æºç®¡ç†



### 7.1 é™æ€èµ„æºç‰ˆæœ¬ç®¡ç†



ğŸ’¡ **ä¸ºä»€ä¹ˆéœ€è¦ç‰ˆæœ¬ç®¡ç†ï¼Ÿ**

åœºæ™¯ï¼šä½ ä¿®æ”¹äº†CSSæ–‡ä»¶ï¼Œä½†ç”¨æˆ·æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬ï¼Œçœ‹åˆ°çš„è¿˜æ˜¯æ—§æ ·å¼ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼šç»™é™æ€èµ„æºåŠ ç‰ˆæœ¬å·
```
æ—§çš„ï¼š<link href="/css/style.css">
æ–°çš„ï¼š<link href="/css/style-v1.2.css">  â† ç‰ˆæœ¬å˜äº†ï¼Œæµè§ˆå™¨ä¼šé‡æ–°ä¸‹è½½
```

**SpringMVCè‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†**ï¼š

```java
@Configuration
public class StaticResourceConfig implements WebMvcConfigurer {
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**")
                .addResourceLocations("classpath:/static/")
                .setCachePeriod(31536000)  // ç¼“å­˜1å¹´
                .resourceChain(true)       // å¯ç”¨èµ„æºé“¾
                .addResolver(new VersionResourceResolver()
                    .addContentVersionStrategy("/**"));  // å†…å®¹å“ˆå¸Œç‰ˆæœ¬ç­–ç•¥
    }
}
```

**æ•ˆæœ**ï¼š
```
åŸå§‹è·¯å¾„ï¼š/static/css/style.css
å®é™…ç”Ÿæˆï¼š/static/css/style-7e9c8f4d.css  â† æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆå“ˆå¸Œå€¼

æ–‡ä»¶å†…å®¹æ”¹å˜ â†’ å“ˆå¸Œå€¼æ”¹å˜ â†’ URLæ”¹å˜ â†’ æµè§ˆå™¨é‡æ–°ä¸‹è½½
```

### 7.2 WebJarsç®¡ç†å‰ç«¯åº“



ğŸ’¡ **ä»€ä¹ˆæ˜¯WebJarsï¼Ÿ**

ä¼ ç»Ÿæ–¹å¼ç®¡ç†jQueryã€Bootstrapç­‰å‰ç«¯åº“ï¼š
```
1. å»å®˜ç½‘ä¸‹è½½
2. æ”¾åˆ°staticç›®å½•
3. æ‰‹åŠ¨å¼•å…¥<script>æ ‡ç­¾
é—®é¢˜ï¼šç‰ˆæœ¬ç®¡ç†éº»çƒ¦ï¼Œå‡çº§å›°éš¾
```

**WebJarsæ–¹å¼**ï¼šæŠŠå‰ç«¯åº“æ‰“åŒ…æˆMavenä¾èµ–ï¼Œåƒç®¡ç†Javaåº“ä¸€æ ·ç®¡ç†å‰ç«¯åº“ï¼

**æ­¥éª¤1ï¼šæ·»åŠ WebJarsä¾èµ–**

```xml
<dependency>
    <groupId>org.webjars</groupId>
    <artifactId>jquery</artifactId>
    <version>3.6.0</version>
</dependency>

<dependency>
    <groupId>org.webjars</groupId>
    <artifactId>bootstrap</artifactId>
    <version>5.1.3</version>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®WebJarsæ˜ å°„**

```java
@Configuration
public class WebJarsConfig implements WebMvcConfigurer {
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // WebJarsèµ„æºæ˜ å°„
        registry.addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/")
                .setCachePeriod(31536000);
    }
}
```

**æ­¥éª¤3ï¼šåœ¨HTMLä¸­ä½¿ç”¨**

```html
<!DOCTYPE html>
<html>
<head>
    <!-- å¼•å…¥WebJarsèµ„æº -->
    <link rel="stylesheet" href="/webjars/bootstrap/5.1.3/css/bootstrap.min.css">
    <script src="/webjars/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <h1 class="text-primary">Hello WebJars!</h1>
</body>
</html>
```

**ä¼˜åŒ–ï¼šç‰ˆæœ¬å·è‡ªåŠ¨è§£æ**

æ¯æ¬¡éƒ½è¦å†™ç‰ˆæœ¬å·å¤ªéº»çƒ¦ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«ï¼š

```java
@Configuration
public class WebJarsConfig implements WebMvcConfigurer {
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/")
                .resourceChain(false)  // ç¦ç”¨ç¼“å­˜é“¾ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
                .addResolver(new WebJarsResourceResolver());  // WebJarsè§£æå™¨
    }
}
```

**ç°åœ¨å¯ä»¥çœç•¥ç‰ˆæœ¬å·**ï¼š
```html
<link rel="stylesheet" href="/webjars/bootstrap/css/bootstrap.min.css">
<script src="/webjars/jquery/jquery.min.js"></script>
```

### 7.3 é™æ€èµ„æºæœ€ä½³å®è·µ



**å®Œæ•´é…ç½®ç¤ºä¾‹**ï¼š

```java
@Configuration
public class StaticResourceConfig implements WebMvcConfigurer {
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        
        // 1. æ™®é€šé™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ç­‰ï¼‰
        registry.addResourceHandler("/static/**")
                .addResourceLocations("classpath:/static/")
                .setCachePeriod(31536000)                    // ç¼“å­˜1å¹´
                .resourceChain(true)
                .addResolver(new VersionResourceResolver()
                    .addContentVersionStrategy("/**"));      // å†…å®¹å“ˆå¸Œç‰ˆæœ¬
        
        // 2. WebJarsèµ„æº
        registry.addResourceHandler("/webjars/**")
                .addResourceLocations("classpath:/META-INF/resources/webjars/")
                .setCachePeriod(31536000)
                .resourceChain(true)
                .addResolver(new WebJarsResourceResolver());
        
        // 3. ä¸Šä¼ æ–‡ä»¶è®¿é—®ï¼ˆå¼€å‘ç¯å¢ƒç¤ºä¾‹ï¼‰
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:D:/uploads/")
                .setCachePeriod(0);                          // ä¸ç¼“å­˜
    }
}
```

**ğŸ“‚ æ¨èçš„é¡¹ç›®ç»“æ„**ï¼š

```
src/main/resources/
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ common.css
â”‚   â”‚   â””â”€â”€ style.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ common.js
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ logo.png
â”‚   â”‚   â””â”€â”€ banner.jpg
â”‚   â””â”€â”€ favicon.ico
â””â”€â”€ templates/
    â””â”€â”€ index.html
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ



```
ğŸ”¸ å‚æ•°è§£æå™¨ï¼šæŠŠHTTPè¯·æ±‚æ•°æ®è½¬æ¢æˆControlleræ–¹æ³•å‚æ•°
ğŸ”¸ è¿”å›å€¼å¤„ç†å™¨ï¼šæŠŠControllerè¿”å›å€¼è½¬æ¢æˆHTTPå“åº”
ğŸ”¸ WebMvcConfigurerï¼šSpringMVCé…ç½®å®šåˆ¶çš„æ ¸å¿ƒæ¥å£
ğŸ”¸ å†…å®¹åå•†ï¼šæ ¹æ®å®¢æˆ·ç«¯éœ€æ±‚è¿”å›ä¸åŒæ ¼å¼æ•°æ®
ğŸ”¸ æ–‡ä»¶ä¸Šä¼ ï¼šMultipartResolverè§£æä¸Šä¼ æ–‡ä»¶
ğŸ”¸ å¼‚æ­¥å¤„ç†ï¼šDeferredResultå’ŒCallableæå‡å¹¶å‘èƒ½åŠ›
ğŸ”¸ å›½é™…åŒ–ï¼šMessageSourceå®ç°å¤šè¯­è¨€æ”¯æŒ
ğŸ”¸ é™æ€èµ„æºï¼šç‰ˆæœ¬ç®¡ç†å’ŒWebJarsç»Ÿä¸€ç®¡ç†å‰ç«¯åº“
```

### 8.2 å®é™…åº”ç”¨åœºæ™¯é€ŸæŸ¥



| éœ€æ±‚åœºæ™¯ | **ä½¿ç”¨æŠ€æœ¯** | **æ ¸å¿ƒè¦ç‚¹** |
|---------|------------|------------|
| è‡ªåŠ¨æ³¨å…¥å½“å‰ç”¨æˆ· | `å‚æ•°è§£æå™¨` | å®ç°`HandlerMethodArgumentResolver` |
| ç»Ÿä¸€è¿”å›æ ¼å¼åŒ…è£… | `è¿”å›å€¼å¤„ç†å™¨` | å®ç°`HandlerMethodReturnValueHandler` |
| ç™»å½•æ‹¦æˆª | `WebMvcConfigurer` | `addInterceptors()` |
| è·¨åŸŸé…ç½® | `WebMvcConfigurer` | `addCorsMappings()` |
| JSONé…ç½®å®šåˆ¶ | `WebMvcConfigurer` | `configureMessageConverters()` |
| å¤šæ ¼å¼å“åº” | `å†…å®¹åå•†` | `configureContentNegotiation()` |
| å¤´åƒä¸Šä¼  | `æ–‡ä»¶ä¸Šä¼ ` | `MultipartFile` + å®‰å…¨æ£€æŸ¥ |
| æ”¯ä»˜å›è°ƒ | `å¼‚æ­¥å¤„ç†` | `DeferredResult` |
| æŠ¥è¡¨ç”Ÿæˆ | `å¼‚æ­¥å¤„ç†` | `Callable` |
| å¤šè¯­è¨€ç½‘ç«™ | `å›½é™…åŒ–` | `MessageSource` + `LocaleResolver` |
| å‰ç«¯åº“ç®¡ç† | `WebJars` | Mavenä¾èµ–ç®¡ç†å‰ç«¯åº“ |

### 8.3 å­¦ä¹ è·¯å¾„å»ºè®®



```
å…¥é—¨é˜¶æ®µï¼š
1ï¸âƒ£ æŒæ¡WebMvcConfigureråŸºæœ¬é…ç½®ï¼ˆæ‹¦æˆªå™¨ã€è·¨åŸŸï¼‰
2ï¸âƒ£ å­¦ä¼šæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½
3ï¸âƒ£ ç†è§£å†…å®¹åå•†æœºåˆ¶

è¿›é˜¶é˜¶æ®µï¼š
4ï¸âƒ£ è‡ªå®šä¹‰å‚æ•°è§£æå™¨å’Œè¿”å›å€¼å¤„ç†å™¨
5ï¸âƒ£ æŒæ¡å¼‚æ­¥è¯·æ±‚å¤„ç†ï¼ˆDeferredResultã€Callableï¼‰
6ï¸âƒ£ å®ç°å›½é™…åŒ–æ”¯æŒ

é«˜çº§é˜¶æ®µï¼š
7ï¸âƒ£ æ·±å…¥ç†è§£SpringMVCå¤„ç†æµç¨‹
8ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§
9ï¸âƒ£ æºç é˜…è¯»å’ŒåŸç†åˆ†æ
```

### 8.4 å¸¸è§é—®é¢˜æ’æŸ¥



**é—®é¢˜1ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥**
```
âœ… æ£€æŸ¥æ¸…å•ï¼š
- MultipartResolveræ˜¯å¦é…ç½®
- æ–‡ä»¶å¤§å°æ˜¯å¦è¶…é™
- enctypeæ˜¯å¦ä¸ºmultipart/form-data
- å‚æ•°åæ˜¯å¦åŒ¹é…ï¼ˆ@RequestParamçš„nameï¼‰
```

**é—®é¢˜2ï¼šå¼‚æ­¥è¯·æ±‚è¶…æ—¶**
```
âœ… è§£å†³æ–¹æ¡ˆï¼š
- å¢å¤§è¶…æ—¶æ—¶é—´ï¼šconfigurer.setDefaultTimeout()
- æ£€æŸ¥å¼‚æ­¥çº¿ç¨‹æ± é…ç½®
- æ·»åŠ è¶…æ—¶å›è°ƒï¼šdeferredResult.onTimeout()
```

**é—®é¢˜3ï¼šå›½é™…åŒ–ä¸ç”Ÿæ•ˆ**
```
âœ… æ£€æŸ¥æ¸…å•ï¼š
- æ¶ˆæ¯æ–‡ä»¶è·¯å¾„å’Œå‘½åæ˜¯å¦æ­£ç¡®
- LocaleResolveræ˜¯å¦é…ç½®
- MessageSourceçš„basenameæ˜¯å¦æ­£ç¡®
- æ–‡ä»¶ç¼–ç æ˜¯å¦ä¸ºUTF-8
```

**é—®é¢˜4ï¼šé™æ€èµ„æº404**
```
âœ… æ£€æŸ¥æ¸…å•ï¼š
- èµ„æºè·¯å¾„æ˜ å°„æ˜¯å¦æ­£ç¡®
- èµ„æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨
- ç¼“å­˜æ˜¯å¦å½±å“ï¼ˆæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼‰
- WebJarsç‰ˆæœ¬å·æ˜¯å¦åŒ¹é…
```

### 8.5 è®°å¿†å£è¯€



```
å‚æ•°è§£æå…¥å£å¤„ï¼Œè¿”å›ç»“æœå‡ºå£è·¯
é…ç½®å®šåˆ¶æ‰¾Configurerï¼Œå†…å®¹åå•†å¤šæ ¼å¼
æ–‡ä»¶ä¸Šä¼ è¦å®‰å…¨ï¼Œå¼‚æ­¥å¤„ç†ææ€§èƒ½
å›½é™…åŒ–å¤šè¯­è¨€ï¼Œé™æ€èµ„æºç‰ˆæœ¬ç®¡

WebMVCé«˜çº§ç‰¹æ€§å¤šï¼ŒæŒæ¡åŸç†æœ€é‡è¦
å®æˆ˜ç»ƒä¹ ä¸èƒ½å°‘ï¼Œæºç é˜…è¯»å¢ƒç•Œé«˜
```

---

# ğŸ“ å­¦ä¹ å»ºè®®



1. **åŠ¨æ‰‹å®è·µ**ï¼šæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½è¦å†™ä»£ç éªŒè¯
2. **å¾ªåºæ¸è¿›**ï¼šå…ˆæŒæ¡åŸºç¡€ï¼Œå†å­¦é«˜çº§ç‰¹æ€§
3. **ç†è§£åŸç†**ï¼šçŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒ
4. **æŸ¥é˜…æ–‡æ¡£**ï¼šé‡åˆ°é—®é¢˜å…ˆæŸ¥å®˜æ–¹æ–‡æ¡£
5. **é˜…è¯»æºç **ï¼šæœ‰èƒ½åŠ›å¯ä»¥é˜…è¯»SpringMVCæºç åŠ æ·±ç†è§£

**æ ¸å¿ƒè®°å¿†**ï¼š
- SpringMVCé«˜çº§ç‰¹æ€§æ˜¯ä¸ºäº†**è§£å†³å®é™…é—®é¢˜**
- æ¯ä¸ªç‰¹æ€§éƒ½æœ‰å…¶**é€‚ç”¨åœºæ™¯**
- ç†è§£**å·¥ä½œåŸç†**æ¯”è®°ä½APIæ›´é‡è¦
- **å®è·µæ˜¯æ£€éªŒå­¦ä¹ æˆæœçš„å”¯ä¸€æ ‡å‡†**