---
title: 8ã€é…ç½®ç®¡ç†ä¸ç¯å¢ƒéš”ç¦»
---
## ğŸ“š ç›®å½•

1. [é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [ç¯å¢ƒé…ç½®ç®¡ç†](#2-ç¯å¢ƒé…ç½®ç®¡ç†)
3. [é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–](#3-é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–)
4. [æ•æ„Ÿä¿¡æ¯åŠ å¯†](#4-æ•æ„Ÿä¿¡æ¯åŠ å¯†)
5. [é…ç½®çƒ­åŠ è½½æœºåˆ¶](#5-é…ç½®çƒ­åŠ è½½æœºåˆ¶)
6. [é…ç½®ä¸­å¿ƒé›†æˆ](#6-é…ç½®ä¸­å¿ƒé›†æˆ)
7. [ç¯å¢ƒå˜é‡æ³¨å…¥](#7-ç¯å¢ƒå˜é‡æ³¨å…¥)
8. [Profileç¯å¢ƒåˆ‡æ¢](#8-Profileç¯å¢ƒåˆ‡æ¢)
9. [é…ç½®ç‰ˆæœ¬ç®¡ç†](#9-é…ç½®ç‰ˆæœ¬ç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ é…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ç®¡ç†


**é€šä¿—ç†è§£**ï¼šé…ç½®ç®¡ç†å°±åƒç»™ä½ çš„åº”ç”¨ç¨‹åºå‡†å¤‡ä¸åŒçš„"å·¥ä½œæœ"ï¼Œåœ¨ä¸åŒåœºåˆç©¿ä¸åŒçš„è¡£æœã€‚

```
ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼š
- ä¸Šç­ â†’ ç©¿æ­£è£…ï¼ˆç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰
- è¿åŠ¨ â†’ ç©¿è¿åŠ¨æœï¼ˆå¼€å‘ç¯å¢ƒé…ç½®ï¼‰
- åœ¨å®¶ â†’ ç©¿ä¼‘é—²æœï¼ˆæµ‹è¯•ç¯å¢ƒé…ç½®ï¼‰

ç¨‹åºé…ç½®ï¼š
- æ•°æ®åº“åœ°å€ã€ç«¯å£å·ã€ç”¨æˆ·åå¯†ç 
- ç¼“å­˜é…ç½®ã€æ—¥å¿—çº§åˆ«
- ç¬¬ä¸‰æ–¹æœåŠ¡çš„APIå¯†é’¥
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **é…ç½®ï¼ˆConfigurationï¼‰**ï¼šç¨‹åºè¿è¡Œéœ€è¦çš„å„ç§å‚æ•°è®¾ç½®
- **ç¯å¢ƒï¼ˆEnvironmentï¼‰**ï¼šç¨‹åºè¿è¡Œçš„ä¸åŒåœºæ™¯ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
- **é…ç½®ç®¡ç†**ï¼šè®©ç¨‹åºåœ¨ä¸åŒç¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒé…ç½®ï¼Œä¸”èƒ½æ–¹ä¾¿åˆ‡æ¢

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç®¡ç†


**å®é™…é—®é¢˜åœºæ™¯**ï¼š

```
åœºæ™¯1ï¼šæ•°æ®åº“é…ç½®ç¡¬ç¼–ç çš„å›°å¢ƒ
âŒ é—®é¢˜ä»£ç ï¼š
String dbUrl = "jdbc:mysql://localhost:3306/mydb";  // å†™æ­»äº†ï¼
String username = "root";
String password = "123456";

é—®é¢˜æ‰€åœ¨ï¼š
1. å¼€å‘æ—¶ç”¨æœ¬åœ°æ•°æ®åº“ localhost
2. ä¸Šçº¿åè¦æ”¹æˆæœåŠ¡å™¨åœ°å€ 192.168.1.100
3. æ¯æ¬¡éƒ½è¦æ”¹ä»£ç ã€é‡æ–°ç¼–è¯‘ã€é‡æ–°æ‰“åŒ…
4. å®¹æ˜“å‡ºé”™ï¼Œå¿˜è®°æ”¹æŸä¸ªé…ç½®

âœ… é…ç½®ç®¡ç†æ–¹æ¡ˆï¼š
æŠŠé…ç½®å†™åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œä¸åŒç¯å¢ƒç”¨ä¸åŒé…ç½®æ–‡ä»¶
å¼€å‘ç¯å¢ƒï¼šapplication-dev.properties
ç”Ÿäº§ç¯å¢ƒï¼šapplication-prod.properties
```

**é…ç½®ç®¡ç†è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š

| é—®é¢˜ç±»å‹ | **ä¼ ç»Ÿåšæ³•** | **é…ç½®ç®¡ç†æ–¹æ¡ˆ** |
|---------|------------|----------------|
| ğŸ”§ **ç¯å¢ƒåˆ‡æ¢** | `æ‰‹åŠ¨æ”¹ä»£ç ï¼Œé‡æ–°ç¼–è¯‘` | `åˆ‡æ¢é…ç½®æ–‡ä»¶ï¼Œä»£ç ä¸åŠ¨` |
| ğŸ” **å¯†ç å®‰å…¨** | `æ˜æ–‡å†™åœ¨ä»£ç é‡Œ` | `åŠ å¯†å­˜å‚¨ï¼Œç¯å¢ƒå˜é‡æ³¨å…¥` |
| ğŸ”„ **é…ç½®æ›´æ–°** | `æ”¹ä»£ç é‡å¯æœåŠ¡` | `çƒ­åŠ è½½ï¼Œä¸åœæœºæ›´æ–°` |
| ğŸ“¦ **ç‰ˆæœ¬ç®¡ç†** | `é…ç½®æ•£è½å„å¤„` | `ç»Ÿä¸€ç®¡ç†ï¼Œç‰ˆæœ¬å¯è¿½æº¯` |

### 1.3 é…ç½®ç®¡ç†çš„æ ¸å¿ƒåŸåˆ™


**é»„é‡‘æ³•åˆ™**ï¼šä»£ç ä¸é…ç½®åˆ†ç¦»

```
å¥½çš„å®è·µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨ä»£ç     â”‚â—„â”€â”€è¯»å–â”€â”€â”‚  é…ç½®æ–‡ä»¶         â”‚
â”‚  (ä¸å˜)     â”‚        â”‚  (å¯å˜/å¯åˆ‡æ¢)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åŸåˆ™ï¼š
ğŸ”¸ ä»£ç åªå…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸å…³å¿ƒå…·ä½“é…ç½®
ğŸ”¸ é…ç½®æ–‡ä»¶å¯ä»¥éšç¯å¢ƒå˜åŒ–è€Œå˜åŒ–
ğŸ”¸ åŒä¸€å¥—ä»£ç ï¼Œä¸åŒé…ç½® = ä¸åŒç¯å¢ƒè¿è¡Œ
```

---

## 2. ğŸŒ ç¯å¢ƒé…ç½®ç®¡ç†


### 2.1 ä¸‰å¤§ç¯å¢ƒçš„åŒºåˆ«ä¸ä½œç”¨


**ç¯å¢ƒåˆ’åˆ†çš„é€šä¿—ç†è§£**ï¼šå°±åƒåšèœçš„ä¸‰ä¸ªé˜¶æ®µ

```
ğŸ”¸ å¼€å‘ç¯å¢ƒï¼ˆDevelopmentï¼‰- å¨æˆ¿è¯•èœé˜¶æ®µ
   ç”¨é€”ï¼šç¨‹åºå‘˜å†™ä»£ç ã€è°ƒè¯•åŠŸèƒ½çš„åœ°æ–¹
   ç‰¹ç‚¹ï¼šå¿«é€Ÿåé¦ˆã€é¢‘ç¹é‡å¯ã€è¯¦ç»†æ—¥å¿—
   
ğŸ”¸ æµ‹è¯•ç¯å¢ƒï¼ˆTest/Stagingï¼‰- è¯•åƒé˜¶æ®µ  
   ç”¨é€”ï¼šæµ‹è¯•äººå‘˜éªŒè¯åŠŸèƒ½çš„åœ°æ–¹
   ç‰¹ç‚¹ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯ã€ç¨³å®šæ€§æµ‹è¯•
   
ğŸ”¸ ç”Ÿäº§ç¯å¢ƒï¼ˆProductionï¼‰- æ­£å¼ä¸Šèœé˜¶æ®µ
   ç”¨é€”ï¼šçœŸå®ç”¨æˆ·ä½¿ç”¨çš„ç¯å¢ƒ
   ç‰¹ç‚¹ï¼šé«˜æ€§èƒ½ã€é«˜ç¨³å®šæ€§ã€å®‰å…¨æ€§æœ€é«˜
```

### 2.2 å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆapplication-dev.propertiesï¼‰


**å¼€å‘ç¯å¢ƒçš„ç‰¹ç‚¹**ï¼šæ–¹ä¾¿è°ƒè¯•ã€å¿«é€Ÿå®šä½é—®é¢˜

```properties
# å¼€å‘ç¯å¢ƒæ•°æ®åº“é…ç½®
# ğŸ“Œ ä½¿ç”¨æœ¬åœ°æ•°æ®åº“ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•
spring.datasource.url=jdbc:mysql://localhost:3306/mydb_dev?useSSL=false
spring.datasource.username=root
spring.datasource.password=123456

# ğŸ“Œ æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºDEBUGï¼Œè¾“å‡ºè¯¦ç»†ä¿¡æ¯
logging.level.root=DEBUG
logging.level.com.myapp=TRACE  # è‡ªå·±çš„åŒ…æ‰“æœ€è¯¦ç»†æ—¥å¿—

# ğŸ“Œ å¼€å¯çƒ­éƒ¨ç½²ï¼Œæ”¹ä»£ç è‡ªåŠ¨é‡å¯
spring.devtools.restart.enabled=true

# ğŸ“Œ MyBatisé…ç½®ï¼Œæ˜¾ç¤ºSQLè¯­å¥
mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
```

**é…ç½®è¯´æ˜**ï¼š

> ğŸ’¡ **ä¸ºä»€ä¹ˆå¼€å‘ç¯å¢ƒè¦æ‰“DEBUGæ—¥å¿—ï¼Ÿ**
> - å¼€å‘æ—¶éœ€è¦çœ‹åˆ°ç¨‹åºæ¯ä¸€æ­¥åœ¨åšä»€ä¹ˆ
> - å‡ºé”™äº†èƒ½å¿«é€Ÿæ‰¾åˆ°é—®é¢˜åœ¨å“ªé‡Œ
> - å°±åƒåŒ»ç”Ÿçœ‹ç—…è¦åšè¯¦ç»†æ£€æŸ¥

> ğŸ’¡ **ä¸ºä»€ä¹ˆè¦å¼€å¯çƒ­éƒ¨ç½²ï¼Ÿ**
> - æ”¹å®Œä»£ç è‡ªåŠ¨é‡å¯ï¼Œä¸ç”¨æ‰‹åŠ¨åœæ­¢å†å¯åŠ¨
> - æé«˜å¼€å‘æ•ˆç‡ï¼ŒèŠ‚çœæ—¶é—´

### 2.3 æµ‹è¯•ç¯å¢ƒé…ç½®ï¼ˆapplication-test.propertiesï¼‰


**æµ‹è¯•ç¯å¢ƒçš„ç‰¹ç‚¹**ï¼šæ¨¡æ‹ŸçœŸå®ç¯å¢ƒï¼Œä½†æ•°æ®æ˜¯æµ‹è¯•æ•°æ®

```properties
# æµ‹è¯•ç¯å¢ƒæ•°æ®åº“é…ç½®
# ğŸ“Œ ä½¿ç”¨æµ‹è¯•æœåŠ¡å™¨æ•°æ®åº“
spring.datasource.url=jdbc:mysql://test-server:3306/mydb_test
spring.datasource.username=test_user
spring.datasource.password=${DB_PASSWORD}  # å¯†ç ä»ç¯å¢ƒå˜é‡è¯»å–

# ğŸ“Œ æ—¥å¿—çº§åˆ«INFOï¼Œä¸è¦å¤ªè¯¦ç»†ï¼Œä¹Ÿä¸èƒ½æ²¡æœ‰
logging.level.root=INFO
logging.level.com.myapp=DEBUG  # ä¸šåŠ¡ä»£ç ç¨å¾®è¯¦ç»†ç‚¹

# ğŸ“Œ å…³é—­çƒ­éƒ¨ç½²ï¼Œæµ‹è¯•ç¯å¢ƒè¦ç¨³å®š
spring.devtools.restart.enabled=false

# ğŸ“Œ Redisç¼“å­˜é…ç½®ï¼ˆæµ‹è¯•ç¯å¢ƒä½¿ç”¨ï¼‰
spring.redis.host=test-redis-server
spring.redis.port=6379
```

**é…ç½®è¯´æ˜**ï¼š

> ğŸ’¡ **ä¸ºä»€ä¹ˆæµ‹è¯•ç¯å¢ƒä¸ç”¨DEBUGæ—¥å¿—ï¼Ÿ**
> - æµ‹è¯•ç¯å¢ƒè¦æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ
> - å¤ªè¯¦ç»†çš„æ—¥å¿—ä¼šå ç”¨å­˜å‚¨ç©ºé—´
> - INFOçº§åˆ«å¤Ÿç”¨ï¼Œæœ‰é—®é¢˜å†è°ƒæ•´

### 2.4 ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆapplication-prod.propertiesï¼‰


**ç”Ÿäº§ç¯å¢ƒçš„ç‰¹ç‚¹**ï¼šæ€§èƒ½æœ€ä¼˜ã€å®‰å…¨æ€§æœ€é«˜ã€ç¨³å®šæ€§æœ€å¼º

```properties
# ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“é…ç½®
# ğŸ“Œ ä½¿ç”¨ç”Ÿäº§æ•°æ®åº“é›†ç¾¤
spring.datasource.url=jdbc:mysql://prod-db-cluster:3306/mydb_prod?useSSL=true
spring.datasource.username=${DB_USERNAME}  # ä»ç¯å¢ƒå˜é‡è¯»å–
spring.datasource.password=${DB_PASSWORD}  # ä»ç¯å¢ƒå˜é‡è¯»å–

# ğŸ“Œ æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€è¦é«˜æ€§èƒ½ï¼‰
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000

# ğŸ“Œ æ—¥å¿—çº§åˆ«WARNï¼Œåªè®°å½•è­¦å‘Šå’Œé”™è¯¯
logging.level.root=WARN
logging.level.com.myapp=INFO  # ä¸šåŠ¡ä»£ç INFOçº§åˆ«

# ğŸ“Œ å®‰å…¨é…ç½®
server.ssl.enabled=true
server.ssl.key-store=classpath:keystore.p12
server.ssl.key-store-password=${SSL_PASSWORD}

# ğŸ“Œ Redisé«˜å¯ç”¨é›†ç¾¤é…ç½®
spring.redis.cluster.nodes=prod-redis1:6379,prod-redis2:6379,prod-redis3:6379
spring.redis.password=${REDIS_PASSWORD}
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®è¦ç‚¹**ï¼š

| é…ç½®é¡¹ | **å¼€å‘ç¯å¢ƒ** | **ç”Ÿäº§ç¯å¢ƒ** | **åŸå› è¯´æ˜** |
|-------|------------|------------|-------------|
| ğŸ“Š **æ—¥å¿—çº§åˆ«** | `DEBUG/TRACE` | `WARN/ERROR` | `ç”Ÿäº§ç¯å¢ƒåªè®°å½•é‡è¦ä¿¡æ¯ï¼Œé¿å…æ—¥å¿—çˆ†ç‚¸` |
| ğŸ” **å¯†ç ç®¡ç†** | `æ˜æ–‡å¯ä»¥` | `å¿…é¡»åŠ å¯†/ç¯å¢ƒå˜é‡` | `å®‰å…¨ç¬¬ä¸€ï¼Œé˜²æ­¢æ³„éœ²` |
| âš¡ **è¿æ¥æ± å¤§å°** | `å°ï¼ˆ5ä¸ªï¼‰` | `å¤§ï¼ˆ20ä¸ªï¼‰` | `ç”Ÿäº§ç¯å¢ƒå¹¶å‘é‡å¤§ï¼Œéœ€è¦æ›´å¤šè¿æ¥` |
| ğŸ”’ **SSLåŠ å¯†** | `å¯é€‰` | `å¿…é¡»å¼€å¯` | `ç”Ÿäº§æ•°æ®ä¼ è¾“å¿…é¡»åŠ å¯†` |

### 2.5 ç¯å¢ƒé…ç½®çš„ç›®å½•ç»“æ„


**æ ‡å‡†çš„é…ç½®æ–‡ä»¶ç»„ç»‡æ–¹å¼**ï¼š

```
src/main/resources/
â”œâ”€â”€ application.properties          # ä¸»é…ç½®æ–‡ä»¶ï¼ˆå…¬å…±é…ç½®ï¼‰
â”œâ”€â”€ application-dev.properties      # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ application-test.properties     # æµ‹è¯•ç¯å¢ƒé…ç½®
â”œâ”€â”€ application-prod.properties     # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ logback-spring.xml             # æ—¥å¿—é…ç½®
â””â”€â”€ mybatis/
    â””â”€â”€ mapper/                    # MyBatisæ˜ å°„æ–‡ä»¶

é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼š
1ï¸âƒ£ å…ˆåŠ è½½ application.propertiesï¼ˆå…¬å…±é…ç½®ï¼‰
2ï¸âƒ£ å†åŠ è½½ application-{profile}.propertiesï¼ˆç¯å¢ƒç‰¹å®šé…ç½®ï¼‰
3ï¸âƒ£ ç›¸åŒçš„é…ç½®ï¼Œç¯å¢ƒé…ç½®ä¼šè¦†ç›–å…¬å…±é…ç½®
```

**å…¬å…±é…ç½®ç¤ºä¾‹**ï¼ˆapplication.propertiesï¼‰ï¼š

```properties
# æ‰€æœ‰ç¯å¢ƒé€šç”¨çš„é…ç½®
spring.application.name=my-ssm-app
server.port=8080

# MyBatisé€šç”¨é…ç½®
mybatis.mapper-locations=classpath:mybatis/mapper/*.xml
mybatis.type-aliases-package=com.myapp.entity

# æŒ‡å®šæ¿€æ´»å“ªä¸ªç¯å¢ƒï¼ˆè¿™ä¸ªå¯ä»¥è¢«å¯åŠ¨å‚æ•°è¦†ç›–ï¼‰
spring.profiles.active=dev
```

---

## 3. ğŸ“¦ é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–


### 3.1 ä»€ä¹ˆæ˜¯é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–


**é€šä¿—ç†è§£**ï¼šæŠŠé…ç½®æ–‡ä»¶ä»é¡¹ç›®jaråŒ…é‡Œæ‹¿å‡ºæ¥ï¼Œæ”¾åˆ°å¤–é¢å•ç‹¬ç®¡ç†

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆé…ç½®åœ¨jaråŒ…å†…ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   myapp.jar         â”‚
â”‚  â”œâ”€â”€ classes/       â”‚
â”‚  â”‚  â”œâ”€â”€ App.class  â”‚
â”‚  â”‚  â””â”€â”€ application.â”‚  â† é…ç½®åœ¨jaråŒ…é‡Œ
â”‚  â”‚      properties  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šæ”¹é…ç½®è¦é‡æ–°æ‰“åŒ…

å¤–éƒ¨åŒ–æ–¹å¼ï¼ˆé…ç½®åœ¨jaråŒ…å¤–ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   myapp.jar         â”‚      â”‚  config/             â”‚
â”‚  â”œâ”€â”€ classes/       â”‚      â”‚  â””â”€â”€ application.    â”‚
â”‚  â”‚  â””â”€â”€ App.class  â”‚      â”‚      properties       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜åŠ¿ï¼šæ”¹é…ç½®ä¸ç”¨é‡æ–°æ‰“åŒ…ï¼Œç›´æ¥ä¿®æ”¹å¤–éƒ¨æ–‡ä»¶
```

### 3.2 ä¸ºä»€ä¹ˆè¦å¤–éƒ¨åŒ–é…ç½®


**å®é™…åº”ç”¨åœºæ™¯**ï¼š

```
åœºæ™¯ï¼šä½ çš„é¡¹ç›®å·²ç»æ‰“æˆjaråŒ…éƒ¨ç½²åˆ°æœåŠ¡å™¨äº†

æƒ…å†µ1ï¼šæ•°æ®åº“å¯†ç éœ€è¦ä¿®æ”¹
âŒ é…ç½®åœ¨jaråŒ…å†…ï¼š
   1. ä¿®æ”¹é…ç½®æ–‡ä»¶
   2. é‡æ–°æ‰“åŒ…æˆjar
   3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
   4. é‡å¯åº”ç”¨
   ï¼ˆå¤ªéº»çƒ¦ï¼Œå®¹æ˜“å‡ºé”™ï¼‰

âœ… é…ç½®å¤–éƒ¨åŒ–ï¼š
   1. ç›´æ¥ä¿®æ”¹å¤–éƒ¨é…ç½®æ–‡ä»¶
   2. é‡å¯åº”ç”¨ï¼ˆæˆ–çƒ­åŠ è½½ï¼‰
   ï¼ˆç®€å•å¿«æ·ï¼‰
```

**å¤–éƒ¨åŒ–çš„ä¼˜åŠ¿**ï¼š

ğŸ”¸ **é…ç½®çµæ´»**ï¼šä¸æ”¹ä»£ç å°±èƒ½è°ƒæ•´é…ç½®  
ğŸ”¸ **å®‰å…¨æ€§é«˜**ï¼šæ•æ„Ÿä¿¡æ¯ä¸æ‰“åŒ…è¿›jar  
ğŸ”¸ **ç¯å¢ƒé€‚é…**ï¼šåŒä¸€ä¸ªjaråŒ…ï¼Œä¸åŒé…ç½®é€‚åº”ä¸åŒç¯å¢ƒ  
ğŸ”¸ **å¿«é€Ÿè°ƒæ•´**ï¼šè¿ç»´äººå‘˜å¯ä»¥ç›´æ¥æ”¹é…ç½®ï¼Œä¸éœ€è¦å¼€å‘ä»‹å…¥

### 3.3 é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–çš„å®ç°æ–¹å¼


**æ–¹å¼ä¸€ï¼šä½¿ç”¨configç›®å½•ï¼ˆSpring Booté»˜è®¤æ”¯æŒï¼‰**

```
éƒ¨ç½²ç›®å½•ç»“æ„ï¼š
/opt/myapp/
â”œâ”€â”€ myapp.jar                    # åº”ç”¨jaråŒ…
â”œâ”€â”€ config/                      # é…ç½®ç›®å½•ï¼ˆå¤–éƒ¨ï¼‰
â”‚   â”œâ”€â”€ application.properties   # ä¼šè¦†ç›–jaråŒ…å†…çš„é…ç½®
â”‚   â””â”€â”€ application-prod.properties
â””â”€â”€ logs/                        # æ—¥å¿—ç›®å½•

å¯åŠ¨å‘½ä»¤ï¼š
java -jar myapp.jar
# Spring Bootä¼šè‡ªåŠ¨è¯»å–åŒçº§ç›®å½•ä¸‹çš„configæ–‡ä»¶å¤¹
```

**Spring Booté…ç½®æ–‡ä»¶åŠ è½½ä¼˜å…ˆçº§**ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

```
ä¼˜å…ˆçº§æ’åºï¼šæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜

1ï¸âƒ£ å‘½ä»¤è¡Œå‚æ•°
   java -jar app.jar --server.port=9090

2ï¸âƒ£ jaråŒ…å¤–çš„configç›®å½•
   ./config/application.properties

3ï¸âƒ£ jaråŒ…å¤–çš„æ ¹ç›®å½•
   ./application.properties

4ï¸âƒ£ jaråŒ…å†…çš„configç›®å½•  
   classpath:/config/application.properties

5ï¸âƒ£ jaråŒ…å†…çš„æ ¹ç›®å½•
   classpath:/application.properties

ğŸ’¡ ä¼˜å…ˆçº§é«˜çš„é…ç½®ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½çš„é…ç½®
```

**æ–¹å¼äºŒï¼šæŒ‡å®šå¤–éƒ¨é…ç½®æ–‡ä»¶è·¯å¾„**

```bash
# ä½¿ç”¨ --spring.config.location æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®
java -jar myapp.jar \
  --spring.config.location=/etc/myapp/application.properties

# ä½¿ç”¨ --spring.config.additional-location è¿½åŠ é…ç½®æ–‡ä»¶
java -jar myapp.jar \
  --spring.config.additional-location=/etc/myapp/custom.properties
```

**æ–¹å¼ä¸‰ï¼šä½¿ç”¨é…ç½®æœåŠ¡å™¨ï¼ˆé€‚åˆå¤§å‹é¡¹ç›®ï¼‰**

```
ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªæœåŠ¡å™¨éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶
æœåŠ¡å™¨1 â†’ config1.properties
æœåŠ¡å™¨2 â†’ config2.properties
æœåŠ¡å™¨3 â†’ config3.properties
ï¼ˆç®¡ç†å›°éš¾ï¼Œå®¹æ˜“ä¸ä¸€è‡´ï¼‰

é…ç½®æœåŠ¡å™¨æ–¹å¼ï¼š
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  é…ç½®æœåŠ¡å™¨      â”‚
                  â”‚  (ç»Ÿä¸€ç®¡ç†é…ç½®)  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ â†“ â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“            â†“            â†“            â†“
   æœåŠ¡å™¨1       æœåŠ¡å™¨2       æœåŠ¡å™¨3      æœåŠ¡å™¨N
   
ï¼ˆæ‰€æœ‰æœåŠ¡å™¨ä»é…ç½®æœåŠ¡å™¨è·å–é…ç½®ï¼Œç»Ÿä¸€ç®¡ç†ï¼‰
```

### 3.4 å¤–éƒ¨åŒ–é…ç½®çš„æœ€ä½³å®è·µ


**é…ç½®æ–‡ä»¶åˆ†å±‚ç®¡ç†**ï¼š

```properties
# ===== application.propertiesï¼ˆåŸºç¡€é…ç½®ï¼Œä¸å¸¸å˜ï¼‰ =====
spring.application.name=myapp
mybatis.mapper-locations=classpath:mybatis/mapper/*.xml

# ===== application-prod.propertiesï¼ˆç¯å¢ƒé…ç½®ï¼Œå¯èƒ½å˜ï¼‰ =====
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# ===== å¤–éƒ¨é…ç½®æ–‡ä»¶ /etc/myapp/custom.propertiesï¼ˆè¿ç»´é…ç½®ï¼‰ =====
# è¿ç»´äººå‘˜å¯ä»¥æ·»åŠ é¢å¤–çš„é…ç½®ï¼Œè¦†ç›–é»˜è®¤é…ç½®
server.port=8080
logging.level.root=INFO
```

**é…ç½®è¦†ç›–è§„åˆ™æ€»ç»“**ï¼š

> ğŸ“Œ **è®°å¿†å£è¯€**ï¼šå¤–éƒ¨è¦†ç›–å†…éƒ¨ï¼ŒååŠ è½½è¦†ç›–å…ˆåŠ è½½ï¼Œå‘½ä»¤è¡Œæœ€ä¼˜å…ˆ
> 
> - å¤–éƒ¨é…ç½® > å†…éƒ¨é…ç½®
> - ç¯å¢ƒé…ç½® > å…¬å…±é…ç½®  
> - å‘½ä»¤è¡Œå‚æ•° > é…ç½®æ–‡ä»¶

---

## 4. ğŸ” æ•æ„Ÿä¿¡æ¯åŠ å¯†


### 4.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿä¿¡æ¯


**æ•æ„Ÿä¿¡æ¯æ¸…å•**ï¼š

```
ğŸ”¸ æ•°æ®åº“å¯†ç ï¼šspring.datasource.password=123456
ğŸ”¸ Rediså¯†ç ï¼šspring.redis.password=myredis123  
ğŸ”¸ APIå¯†é’¥ï¼šalipay.apiKey=sk_live_xxxxxxx
ğŸ”¸ ç¬¬ä¸‰æ–¹æœåŠ¡å¯†é’¥ï¼šwechat.appSecret=abc123def456
ğŸ”¸ JWTç­¾åå¯†é’¥ï¼šjwt.secret=mySecretKey
ğŸ”¸ åŠ å¯†ç›å€¼ï¼špassword.salt=randomSalt123

é—®é¢˜ï¼šè¿™äº›ä¿¡æ¯å¦‚æœæ˜æ–‡å­˜å‚¨ï¼Œå®¹æ˜“æ³„éœ²å¯¼è‡´å®‰å…¨äº‹æ•…
```

**æ³„éœ²çš„å±å®³**ï¼š

```
åœºæ™¯ï¼šé…ç½®æ–‡ä»¶è¢«ä¸Šä¼ åˆ°GitHub
application.propertiesï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰ï¼š
spring.datasource.username=root
spring.datasource.password=Admin@123  # æ•°æ®åº“å¯†ç æ³„éœ²ï¼
alipay.apiKey=sk_live_real_key        # æ”¯ä»˜å®å¯†é’¥æ³„éœ²ï¼

åæœï¼š
âŒ é»‘å®¢å¯ä»¥ç™»å½•ä½ çš„æ•°æ®åº“
âŒ é»‘å®¢å¯ä»¥ä½¿ç”¨ä½ çš„æ”¯ä»˜å®æ¥å£ç›—åˆ·
âŒ é€ æˆç»æµæŸå¤±å’Œæ•°æ®æ³„éœ²
```

### 4.2 æ•æ„Ÿä¿¡æ¯åŠ å¯†æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨JasyptåŠ å¯†ï¼ˆJavaåŠ å¯†åº“ï¼‰**

**å·¥ä½œåŸç†**ï¼š

```
åŠ å¯†æµç¨‹ï¼š
æ˜æ–‡å¯†ç  â†’ JasyptåŠ å¯† â†’ å¯†æ–‡ â†’ å­˜å…¥é…ç½®æ–‡ä»¶

è§£å¯†æµç¨‹ï¼š
é…ç½®æ–‡ä»¶ä¸­çš„å¯†æ–‡ â†’ Jasyptè§£å¯† â†’ æ˜æ–‡å¯†ç  â†’ ç¨‹åºä½¿ç”¨

å…³é”®ï¼šéœ€è¦ä¸€ä¸ª"åŠ å¯†å¯†é’¥"æ¥åŠ å¯†å’Œè§£å¯†
```

**å®ç°æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.5</version>
</dependency>
```

**æ­¥éª¤2ï¼šç”ŸæˆåŠ å¯†å¯†æ–‡**

```java
// ä¸´æ—¶ä»£ç ï¼Œç”¨äºç”ŸæˆåŠ å¯†å¯†æ–‡
import org.jasypt.encryption.StringEncryptor;
import org.jasypt.encryption.pbe.PooledPBEStringEncryptor;
import org.jasypt.encryption.pbe.config.SimpleStringPBEConfig;

public class JasyptUtil {
    public static void main(String[] args) {
        // 1. åˆ›å»ºåŠ å¯†å™¨
        PooledPBEStringEncryptor encryptor = new PooledPBEStringEncryptor();
        SimpleStringPBEConfig config = new SimpleStringPBEConfig();
        
        // 2. è®¾ç½®åŠ å¯†å¯†é’¥ï¼ˆè¿™ä¸ªå¯†é’¥è¦ä¿å¯†ï¼ï¼‰
        config.setPassword("MyEncryptKey123");  // åŠ å¯†å¯†é’¥
        config.setAlgorithm("PBEWithMD5AndDES"); // åŠ å¯†ç®—æ³•
        encryptor.setConfig(config);
        
        // 3. åŠ å¯†æ•æ„Ÿä¿¡æ¯
        String password = "Admin@123";  // è¦åŠ å¯†çš„æ•°æ®åº“å¯†ç 
        String encrypted = encryptor.encrypt(password);
        
        System.out.println("æ˜æ–‡å¯†ç : " + password);
        System.out.println("åŠ å¯†å¯†æ–‡: " + encrypted);
        // è¾“å‡ºï¼šåŠ å¯†å¯†æ–‡: vR3jK8mN2pQ7sT1uV4wX
    }
}
```

**æ­¥éª¤3ï¼šé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å¯†æ–‡**

```properties
# application.properties

# ğŸ” ä½¿ç”¨ENC()åŒ…è£¹åŠ å¯†åçš„å¯†æ–‡
spring.datasource.username=root
spring.datasource.password=ENC(vR3jK8mN2pQ7sT1uV4wX)  # å¯†æ–‡

# é…ç½®Jasyptçš„åŠ å¯†å¯†é’¥ï¼ˆè¿™ä¸ªå¯†é’¥ä¸è¦å†™åœ¨é…ç½®æ–‡ä»¶é‡Œï¼ï¼‰
jasypt.encryptor.password=${JASYPT_PASSWORD}  # ä»ç¯å¢ƒå˜é‡è¯»å–
```

**æ­¥éª¤4ï¼šå¯åŠ¨æ—¶ä¼ å…¥åŠ å¯†å¯†é’¥**

```bash
# æ–¹å¼1ï¼šé€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥
export JASYPT_PASSWORD=MyEncryptKey123
java -jar myapp.jar

# æ–¹å¼2ï¼šé€šè¿‡å¯åŠ¨å‚æ•°ä¼ å…¥  
java -jar myapp.jar --jasypt.encryptor.password=MyEncryptKey123

# æ–¹å¼3ï¼šé€šè¿‡ç³»ç»Ÿå±æ€§ä¼ å…¥
java -Djasypt.encryptor.password=MyEncryptKey123 -jar myapp.jar
```

**Jasyptå·¥ä½œæµç¨‹å›¾è§£**ï¼š

```
å¯åŠ¨åº”ç”¨æ—¶ï¼š
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ä¼ å…¥åŠ å¯†å¯†é’¥      â”‚
                    â”‚ (ç¯å¢ƒå˜é‡/å‚æ•°)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®æ–‡ä»¶: password=ENC(vR3jK8mN2pQ7sT1uV4wX)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Jasyptè§£å¯†å™¨   â”‚
            â”‚  ç”¨å¯†é’¥è§£å¯†å¯†æ–‡  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   æ˜æ–‡: Admin@123 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ç¨‹åºæ­£å¸¸ä½¿ç”¨    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰**

```properties
# application.properties
# ä½¿ç”¨ ${} å¼•ç”¨ç¯å¢ƒå˜é‡
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
```

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®ç¯å¢ƒå˜é‡
export DB_URL=jdbc:mysql://prod-db:3306/mydb
export DB_USERNAME=prod_user
export DB_PASSWORD=SuperSecretPassword123

# å¯åŠ¨åº”ç”¨ï¼ˆä¼šè‡ªåŠ¨è¯»å–ç¯å¢ƒå˜é‡ï¼‰
java -jar myapp.jar
```

**æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆä¼ä¸šçº§ï¼‰**

```
å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆKMS - Key Management Serviceï¼‰ï¼š

å·¥ä½œæµç¨‹ï¼š
1. åº”ç”¨å¯åŠ¨æ—¶å‘KMSæœåŠ¡è¯·æ±‚å¯†é’¥
2. KMSéªŒè¯åº”ç”¨èº«ä»½åè¿”å›å¯†é’¥
3. åº”ç”¨ä½¿ç”¨å¯†é’¥è§£å¯†é…ç½®æˆ–ç›´æ¥ä½¿ç”¨

å¸¸è§æœåŠ¡ï¼š
- AWS KMSï¼ˆäºšé©¬é€Šäº‘ï¼‰
- Azure Key Vaultï¼ˆå¾®è½¯äº‘ï¼‰
- HashiCorp Vaultï¼ˆå¼€æºæ–¹æ¡ˆï¼‰
- é˜¿é‡Œäº‘KMS

ä¼˜åŠ¿ï¼š
âœ… å¯†é’¥ç»Ÿä¸€ç®¡ç†
âœ… è®¿é—®æƒé™æ§åˆ¶
âœ… å¯†é’¥è‡ªåŠ¨è½®æ¢
âœ… æ“ä½œå®¡è®¡æ—¥å¿—
```

### 4.3 æ•æ„Ÿä¿¡æ¯ä¿æŠ¤æœ€ä½³å®è·µ


**å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•**ï¼š

| é…ç½®é¡¹ | âŒ **é”™è¯¯åšæ³•** | âœ… **æ­£ç¡®åšæ³•** |
|-------|---------------|---------------|
| ğŸ“ **é…ç½®æ–‡ä»¶** | `å¯†ç æ˜æ–‡å†™åœ¨application.properties` | `ä½¿ç”¨åŠ å¯†æˆ–ç¯å¢ƒå˜é‡` |
| ğŸ”‘ **åŠ å¯†å¯†é’¥** | `jasyptå¯†é’¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ` | `é€šè¿‡ç¯å¢ƒå˜é‡æˆ–å¯åŠ¨å‚æ•°ä¼ å…¥` |
| ğŸ“ **ç‰ˆæœ¬æ§åˆ¶** | `æ•æ„Ÿé…ç½®æäº¤åˆ°Git` | `æ•æ„Ÿé…ç½®åŠ å…¥.gitignore` |
| ğŸ” **æƒé™ç®¡ç†** | `æ‰€æœ‰äººéƒ½èƒ½çœ‹é…ç½®æ–‡ä»¶` | `é™åˆ¶é…ç½®æ–‡ä»¶è®¿é—®æƒé™` |
| ğŸ”„ **å¯†é’¥è½®æ¢** | `å¯†é’¥ä»ä¸æ›´æ¢` | `å®šæœŸæ›´æ¢å¯†é’¥` |

**.gitignoreé…ç½®ç¤ºä¾‹**ï¼š

```bash
# .gitignoreæ–‡ä»¶å†…å®¹

# å¿½ç•¥æœ¬åœ°é…ç½®æ–‡ä»¶
application-local.properties
application-dev.properties

# å¿½ç•¥åŒ…å«æ•æ„Ÿä¿¡æ¯çš„é…ç½®
*-secret.properties
*.key
*.pem

# å¿½ç•¥ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local
```

**é…ç½®æ–‡ä»¶æƒé™è®¾ç½®**ï¼š

```bash
# LinuxæœåŠ¡å™¨ä¸Šï¼Œé…ç½®æ–‡ä»¶æƒé™è®¾ç½®
cd /opt/myapp/config

# åªæœ‰åº”ç”¨è¿è¡Œç”¨æˆ·å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶
chmod 600 application-prod.properties
chown appuser:appgroup application-prod.properties

# 600 æƒé™è¯´æ˜ï¼š
# 6(è¯»+å†™) 0(æ— æƒé™) 0(æ— æƒé™)
#   â†‘          â†‘         â†‘
#  æ‰€æœ‰è€…     ç»„ç”¨æˆ·    å…¶ä»–ç”¨æˆ·
```

---

## 5. ğŸ”„ é…ç½®çƒ­åŠ è½½æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯é…ç½®çƒ­åŠ è½½


**é€šä¿—ç†è§£**ï¼šç¨‹åºè¿è¡Œæ—¶ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸é‡å¯ç¨‹åºå°±èƒ½ç”Ÿæ•ˆ

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆå†·åŠ è½½ï¼‰ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. åœæ­¢åº”ç”¨
3. å¯åŠ¨åº”ç”¨
4. é…ç½®ç”Ÿæ•ˆ
ï¼ˆæœ‰åœæœºæ—¶é—´ï¼Œå½±å“ç”¨æˆ·ï¼‰

çƒ­åŠ è½½æ–¹å¼ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. è§¦å‘åˆ·æ–°ï¼ˆæˆ–è‡ªåŠ¨æ£€æµ‹ï¼‰
3. é…ç½®ç«‹å³ç”Ÿæ•ˆ
ï¼ˆæ— åœæœºæ—¶é—´ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼‰
```

**çƒ­åŠ è½½çš„åº”ç”¨åœºæ™¯**ï¼š

```
åœºæ™¯1ï¼šè°ƒæ•´æ—¥å¿—çº§åˆ«
ç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜ï¼Œéœ€è¦å¼€å¯DEBUGæ—¥å¿—å®šä½
âŒ é‡å¯åº”ç”¨ï¼šå½±å“çº¿ä¸ŠæœåŠ¡
âœ… çƒ­åŠ è½½ï¼šä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œç«‹å³ç”Ÿæ•ˆ

åœºæ™¯2ï¼šå¼€å…³åŠŸèƒ½
ä¸´æ—¶å…³é—­æŸä¸ªåŠŸèƒ½ï¼ˆå¦‚æ¨èç³»ç»Ÿï¼‰
âŒ é‡å¯åº”ç”¨ï¼šå¯èƒ½ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ•°æ®
âœ… çƒ­åŠ è½½ï¼šä¿®æ”¹å¼€å…³é…ç½®ï¼Œç«‹å³å…³é—­åŠŸèƒ½

åœºæ™¯3ï¼šè°ƒæ•´çº¿ç¨‹æ± å¤§å°
ç³»ç»Ÿè´Ÿè½½å¢åŠ ï¼Œéœ€è¦å¢å¤§çº¿ç¨‹æ± 
âŒ é‡å¯åº”ç”¨ï¼šæœåŠ¡ä¸­æ–­
âœ… çƒ­åŠ è½½ï¼šè°ƒæ•´å‚æ•°ï¼ŒåŠ¨æ€æ‰©å®¹
```

### 5.2 Spring Cloud Configçƒ­åŠ è½½å®ç°


**æ¶æ„å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           é…ç½®ä¸­å¿ƒæœåŠ¡å™¨                      â”‚
â”‚   å­˜å‚¨é…ç½®ï¼šGitä»“åº“ã€æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ é…ç½®å˜åŒ–é€šçŸ¥
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨æœåŠ¡                        â”‚
â”‚  @RefreshScopeæ ‡æ³¨çš„Beanä¼šè‡ªåŠ¨åˆ·æ–°é…ç½®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–**

```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

**æ­¥éª¤2ï¼šé…ç½®éœ€è¦çƒ­åŠ è½½çš„Bean**

```java
import org.springframework.beans.factory.annotation.Value;
import org.springframework.cloud.context.config.annotation.RefreshScope;
import org.springframework.stereotype.Component;

@Component
@RefreshScope  // ğŸ”‘ å…³é”®æ³¨è§£ï¼šæ ‡è®°è¿™ä¸ªBeanæ”¯æŒé…ç½®åˆ·æ–°
public class DynamicConfig {
    
    @Value("${feature.recommend.enabled:true}")  // æ¨èåŠŸèƒ½å¼€å…³
    private boolean recommendEnabled;
    
    @Value("${thread.pool.size:10}")  // çº¿ç¨‹æ± å¤§å°
    private int threadPoolSize;
    
    @Value("${cache.expire.seconds:3600}")  // ç¼“å­˜è¿‡æœŸæ—¶é—´
    private int cacheExpireSeconds;
    
    // getteræ–¹æ³•
    public boolean isRecommendEnabled() {
        return recommendEnabled;
    }
    
    public int getThreadPoolSize() {
        return threadPoolSize;
    }
}
```

**æ­¥éª¤3ï¼šå¼€å¯Actuatoråˆ·æ–°ç«¯ç‚¹**

```properties
# application.properties

# å¼€å¯refreshç«¯ç‚¹ï¼ˆç”¨äºæ‰‹åŠ¨è§¦å‘é…ç½®åˆ·æ–°ï¼‰
management.endpoints.web.exposure.include=refresh,health,info

# å®‰å…¨é…ç½®ï¼šé™åˆ¶åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®
management.endpoints.web.base-path=/actuator
management.endpoint.refresh.enabled=true
```

**æ­¥éª¤4ï¼šè§¦å‘é…ç½®åˆ·æ–°**

```bash
# æ–¹å¼1ï¼šæ‰‹åŠ¨è§¦å‘åˆ·æ–°ï¼ˆHTTP POSTè¯·æ±‚ï¼‰
curl -X POST http://localhost:8080/actuator/refresh

# è¿”å›ç»“æœï¼ˆæ˜¾ç¤ºå“ªäº›é…ç½®è¢«åˆ·æ–°äº†ï¼‰
[
  "feature.recommend.enabled",
  "thread.pool.size"
]

# æ–¹å¼2ï¼šé…åˆGit Webhookè‡ªåŠ¨åˆ·æ–°
# åœ¨Gitä»“åº“é…ç½®Webhookï¼Œé…ç½®å˜æ›´æ—¶è‡ªåŠ¨è°ƒç”¨/actuator/refresh
```

**åˆ·æ–°æµç¨‹å›¾è§£**ï¼š

```
é…ç½®çƒ­åŠ è½½æµç¨‹ï¼š

1. ä¿®æ”¹é…ç½®æ–‡ä»¶
   config.properties: thread.pool.size=20

2. è§¦å‘åˆ·æ–°
   POST /actuator/refresh
   
3. Springæ£€æµ‹é…ç½®å˜åŒ–
   å¯¹æ¯”æ–°æ—§é…ç½®å€¼
   
4. é”€æ¯æ—§Beanï¼Œåˆ›å»ºæ–°Bean
   @RefreshScopeçš„Beané‡æ–°åˆå§‹åŒ–
   
5. æ–°é…ç½®ç”Ÿæ•ˆ
   threadPoolSize = 20
```

### 5.3 @RefreshScopeæ³¨è§£è¯¦è§£


**å·¥ä½œåŸç†**ï¼š

```java
// @RefreshScopeçš„æœ¬è´¨ï¼šåˆ›å»ºä»£ç†Bean

æ™®é€šBeanï¼š
@Component
public class NormalConfig {
    @Value("${config.value}")
    private String value;  // ç¨‹åºå¯åŠ¨æ—¶èµ‹å€¼ï¼Œä¹‹åä¸ä¼šå˜
}

@RefreshScope Beanï¼š
@Component
@RefreshScope
public class RefreshableConfig {
    @Value("${config.value}")
    private String value;  
    // Springä¸ºè¿™ä¸ªBeanåˆ›å»ºä»£ç†
    // è°ƒç”¨refreshç«¯ç‚¹æ—¶ï¼Œä»£ç†ä¼šé‡æ–°è·å–æœ€æ–°å€¼
}
```

**ä½¿ç”¨æ³¨æ„äº‹é¡¹**ï¼š

| æ³¨æ„ç‚¹ | **è¯´æ˜** | **å¤„ç†æ–¹å¼** |
|-------|---------|-------------|
| âš ï¸ **å•ä¾‹æ¨¡å¼** | `@RefreshScopeæ˜¯å•ä¾‹ï¼Œå¤šæ¬¡æ³¨å…¥æ˜¯åŒä¸€ä¸ªå®ä¾‹` | `æ¯æ¬¡ä½¿ç”¨éƒ½è·å–æœ€æ–°å€¼` |
| âš ï¸ **æ€§èƒ½å½±å“** | `åˆ·æ–°æ—¶ä¼šé‡æ–°åˆ›å»ºBeanï¼Œæœ‰æ€§èƒ½å¼€é”€` | `ä¸è¦é¢‘ç¹åˆ·æ–°ï¼Œå»ºè®®é—´éš”>1åˆ†é’Ÿ` |
| âš ï¸ **çº¿ç¨‹å®‰å…¨** | `åˆ·æ–°è¿‡ç¨‹ä¸­å¯èƒ½æœ‰å¹¶å‘é—®é¢˜` | `ä½¿ç”¨volatileæˆ–synchronized` |
| âš ï¸ **ä¾èµ–åˆ·æ–°** | `å¦‚æœAä¾èµ–Bï¼ŒBåˆ·æ–°äº†Aä¸ä¼šè‡ªåŠ¨åˆ·æ–°` | `Aä¹Ÿè¦åŠ @RefreshScope` |

**ä¸æ”¯æŒçƒ­åŠ è½½çš„é…ç½®**ï¼š

```properties
# âŒ ä»¥ä¸‹é…ç½®ä¿®æ”¹åå¿…é¡»é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼š

# æœåŠ¡å™¨ç«¯å£ï¼ˆå·²ç»ç›‘å¬äº†ï¼Œæ— æ³•åŠ¨æ€ä¿®æ”¹ï¼‰
server.port=8080

# æ•°æ®æºé…ç½®ï¼ˆè¿æ¥æ± å·²ç»åˆå§‹åŒ–ï¼‰
spring.datasource.url=jdbc:mysql://localhost:3306/db

# MyBatis Mapperæ‰«æè·¯å¾„ï¼ˆå·²ç»æ‰«æå®Œæˆï¼‰
mybatis.mapper-locations=classpath:mapper/*.xml
```

### 5.4 è‡ªå®šä¹‰é…ç½®å˜æ›´ç›‘å¬


**å®ç°é…ç½®å˜æ›´é€šçŸ¥**ï¼š

```java
import org.springframework.cloud.context.environment.EnvironmentChangeEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;

@Component
public class ConfigChangeListener {
    
    @EventListener
    public void onConfigChange(EnvironmentChangeEvent event) {
        // è·å–å˜æ›´çš„é…ç½®é¡¹
        Set<String> keys = event.getKeys();
        
        System.out.println("é…ç½®å‘ç”Ÿå˜æ›´ï¼Œå˜æ›´é¡¹ï¼š" + keys);
        
        // æ ¹æ®å˜æ›´çš„é…ç½®åšç›¸åº”å¤„ç†
        if (keys.contains("thread.pool.size")) {
            // è°ƒæ•´çº¿ç¨‹æ± å¤§å°
            adjustThreadPool();
        }
        
        if (keys.contains("feature.recommend.enabled")) {
            // å¼€å…³æ¨èåŠŸèƒ½
            toggleRecommend();
        }
    }
    
    private void adjustThreadPool() {
        System.out.println("çº¿ç¨‹æ± é…ç½®å·²å˜æ›´ï¼Œé‡æ–°åˆå§‹åŒ–çº¿ç¨‹æ± ");
        // å…·ä½“çš„çº¿ç¨‹æ± è°ƒæ•´é€»è¾‘
    }
    
    private void toggleRecommend() {
        System.out.println("æ¨èåŠŸèƒ½å¼€å…³å·²å˜æ›´");
        // å¼€å…³åŠŸèƒ½çš„å…·ä½“é€»è¾‘
    }
}
```

---

## 6. ğŸŒ é…ç½®ä¸­å¿ƒé›†æˆ


### 6.1 ä»€ä¹ˆæ˜¯é…ç½®ä¸­å¿ƒ


**é€šä¿—ç†è§£**ï¼šé…ç½®ä¸­å¿ƒå°±åƒä¸€ä¸ª"é…ç½®ä»“åº“"ï¼Œæ‰€æœ‰åº”ç”¨çš„é…ç½®éƒ½å­˜åœ¨è¿™é‡Œï¼Œç»Ÿä¸€ç®¡ç†

```
æ²¡æœ‰é…ç½®ä¸­å¿ƒçš„å›°å¢ƒï¼š

æœåŠ¡Aé…ç½®æ–‡ä»¶ â†’ æœåŠ¡å™¨1
æœåŠ¡Bé…ç½®æ–‡ä»¶ â†’ æœåŠ¡å™¨2
æœåŠ¡Cé…ç½®æ–‡ä»¶ â†’ æœåŠ¡å™¨3
...
ï¼ˆé…ç½®åˆ†æ•£ï¼Œéš¾ä»¥ç®¡ç†ï¼‰

ä½¿ç”¨é…ç½®ä¸­å¿ƒï¼š

           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   é…ç½®ä¸­å¿ƒ        â”‚
           â”‚  (ç»Ÿä¸€å­˜å‚¨é…ç½®)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“           â†“           â†“
     æœåŠ¡A        æœåŠ¡B        æœåŠ¡C
     
ï¼ˆæ‰€æœ‰æœåŠ¡ä»é…ç½®ä¸­å¿ƒè·å–é…ç½®ï¼Œé›†ä¸­ç®¡ç†ï¼‰
```

**é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒåŠŸèƒ½**ï¼š

ğŸ”¸ **é›†ä¸­ç®¡ç†**ï¼šæ‰€æœ‰é…ç½®å­˜åœ¨ä¸€ä¸ªåœ°æ–¹  
ğŸ”¸ **ç‰ˆæœ¬ç®¡ç†**ï¼šé…ç½®å˜æ›´æœ‰å†å²è®°å½•ï¼Œå¯å›æ»š  
ğŸ”¸ **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§é…ç½®åˆ†ç¦»  
ğŸ”¸ **åŠ¨æ€åˆ·æ–°**ï¼šé…ç½®ä¿®æ”¹åå®æ—¶æ¨é€åˆ°åº”ç”¨  
ğŸ”¸ **æƒé™æ§åˆ¶**ï¼šä¸åŒè§’è‰²æœ‰ä¸åŒçš„é…ç½®æƒé™  
ğŸ”¸ **ç°åº¦å‘å¸ƒ**ï¼šæ–°é…ç½®å…ˆåœ¨éƒ¨åˆ†æœåŠ¡å™¨ç”Ÿæ•ˆ

### 6.2 ä¸»æµé…ç½®ä¸­å¿ƒå¯¹æ¯”


| é…ç½®ä¸­å¿ƒ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **å­¦ä¹ æˆæœ¬** |
|---------|---------|-------------|------------|
| ğŸ”¹ **Spring Cloud Config** | `Springå®˜æ–¹ï¼Œä¸Spring Bootæ— ç¼é›†æˆ` | `Springé¡¹ç›®ï¼Œä¸­å°è§„æ¨¡` | `ä½` |
| ğŸ”¹ **Apollo** | `æºç¨‹å¼€æºï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢å‹å¥½` | `ä¼ä¸šçº§åº”ç”¨ï¼Œå¤§è§„æ¨¡é›†ç¾¤` | `ä¸­` |
| ğŸ”¹ **Nacos** | `é˜¿é‡Œå¼€æºï¼Œé…ç½®+æ³¨å†Œä¸­å¿ƒäºŒåˆä¸€` | `å¾®æœåŠ¡æ¶æ„ï¼Œå›½å†…é¡¹ç›®` | `ä¸­` |
| ğŸ”¹ **Consul** | `HashiCorpå‡ºå“ï¼Œå¤šè¯­è¨€æ”¯æŒ` | `å¤šè¯­è¨€ç¯å¢ƒï¼Œè·¨å¹³å°` | `é«˜` |

### 6.3 Spring Cloud Configé…ç½®ä¸­å¿ƒ


**æ¶æ„è®¾è®¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Gitä»“åº“ï¼ˆé…ç½®å­˜å‚¨ï¼‰                  â”‚
â”‚  â”œâ”€â”€ application.yml                            â”‚
â”‚  â”œâ”€â”€ myapp-dev.yml                              â”‚
â”‚  â”œâ”€â”€ myapp-test.yml                             â”‚
â”‚  â””â”€â”€ myapp-prod.yml                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ æ‹‰å–é…ç½®
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Config Serverï¼ˆé…ç½®æœåŠ¡å™¨ï¼‰              â”‚
â”‚  http://config-server:8888                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ æä¾›é…ç½®
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“       â†“        â†“
       æœåŠ¡A    æœåŠ¡B    æœåŠ¡C
      (Client) (Client) (Client)
```

**å®ç°æ­¥éª¤**ï¼š

**æ­¥éª¤1ï¼šæ­å»ºConfig Serverï¼ˆé…ç½®æœåŠ¡å™¨ï¼‰**

```xml
<!-- Config Serverçš„pom.xml -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-config-server</artifactId>
</dependency>
```

```java
// Config Serverå¯åŠ¨ç±»
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.config.server.EnableConfigServer;

@SpringBootApplication
@EnableConfigServer  // å¼€å¯é…ç½®æœåŠ¡å™¨åŠŸèƒ½
public class ConfigServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(ConfigServerApplication.class, args);
    }
}
```

```properties
# Config Serverçš„application.properties
server.port=8888

# é…ç½®Gitä»“åº“åœ°å€
spring.cloud.config.server.git.uri=https://github.com/mycompany/config-repo.git
spring.cloud.config.server.git.username=your-username
spring.cloud.config.server.git.password=your-password

# é…ç½®æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆGitä»“åº“ä¸­çš„å­ç›®å½•ï¼‰
spring.cloud.config.server.git.search-paths=configs/{application}
```

**æ­¥éª¤2ï¼šåœ¨Gitä»“åº“ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶**

```
config-repo/                      # Gitä»“åº“æ ¹ç›®å½•
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ myapp/
â”‚   â”‚   â”œâ”€â”€ myapp-dev.yml        # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ myapp-test.yml       # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”‚   â””â”€â”€ myapp-prod.yml       # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ other-app/
â”‚       â””â”€â”€ other-app-prod.yml
â””â”€â”€ README.md
```

```yaml
# myapp-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/mydb
    username: prod_user
    password: ${DB_PASSWORD}  # å¯†ç ä»ç¯å¢ƒå˜é‡è¯»å–

logging:
  level:
    root: WARN
    com.myapp: INFO

feature:
  recommend:
    enabled: true
```

**æ­¥éª¤3ï¼šåº”ç”¨æ¥å…¥Config Serverï¼ˆConfig Clientï¼‰**

```xml
<!-- åº”ç”¨çš„pom.xml -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-config</artifactId>
</dependency>
```

```properties
# bootstrap.propertiesï¼ˆæ¯”application.propertieså…ˆåŠ è½½ï¼‰
# åº”ç”¨åç§°ï¼ˆå¯¹åº”Gitä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶å‰ç¼€ï¼‰
spring.application.name=myapp

# ç¯å¢ƒï¼ˆdev/test/prodï¼‰
spring.profiles.active=prod

# Config Serveråœ°å€
spring.cloud.config.uri=http://config-server:8888

# é…ç½®å¤±è´¥å¤„ç†ï¼ˆå¿«é€Ÿå¤±è´¥ï¼Œå¯åŠ¨æ—¶å°±æ£€æŸ¥é…ç½®ï¼‰
spring.cloud.config.fail-fast=true
```

**é…ç½®åŠ è½½æµç¨‹**ï¼š

```
åº”ç”¨å¯åŠ¨æµç¨‹ï¼š

1. è¯»å–bootstrap.properties
   è·å–ï¼šåº”ç”¨å(myapp)ã€ç¯å¢ƒ(prod)ã€Config Serveråœ°å€

2. å‘Config Serverè¯·æ±‚é…ç½®
   GET http://config-server:8888/myapp/prod

3. Config Serverä»Gitæ‹‰å–é…ç½®
   æ‹‰å–æ–‡ä»¶ï¼šmyapp-prod.yml

4. Config Serverè¿”å›é…ç½®ç»™åº”ç”¨
   åº”ç”¨è·å¾—å®Œæ•´é…ç½®å¹¶å¯åŠ¨
```

### 6.4 Apolloé…ç½®ä¸­å¿ƒ


**Apolloçš„ä¼˜åŠ¿**ï¼š

ğŸ”¸ **å¯è§†åŒ–ç•Œé¢**ï¼šWebç•Œé¢ç®¡ç†é…ç½®ï¼Œæ— éœ€æ“ä½œGit  
ğŸ”¸ **å®æ—¶æ¨é€**ï¼šé…ç½®ä¿®æ”¹å1ç§’å†…æ¨é€åˆ°åº”ç”¨  
ğŸ”¸ **ç°åº¦å‘å¸ƒ**ï¼šé…ç½®å˜æ›´å…ˆåœ¨éƒ¨åˆ†æœåŠ¡å™¨è¯•ç‚¹  
ğŸ”¸ **æƒé™ç®¡ç†**ï¼šç²¾ç»†çš„é…ç½®é¡¹æƒé™æ§åˆ¶  
ğŸ”¸ **é…ç½®ç»§æ‰¿**ï¼šå…¬å…±é…ç½®å¯ä»¥è¢«å¤šä¸ªåº”ç”¨ç»§æ‰¿

**Apolloæ¶æ„**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Apollo Portalï¼ˆç®¡ç†ç•Œé¢ï¼‰          â”‚
â”‚  å¼€å‘ã€æµ‹è¯•ã€è¿ç»´äººå‘˜é€šè¿‡ç•Œé¢ç®¡ç†é…ç½®          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Apollo Config Service                â”‚
â”‚  é…ç½®å­˜å‚¨ã€é…ç½®æ¨é€ã€ç°åº¦å‘å¸ƒ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ é•¿è¿æ¥æ¨é€é…ç½®
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“       â†“        â†“
       åº”ç”¨A    åº”ç”¨B    åº”ç”¨C
      (Client) (Client) (Client)
```

**Apolloé›†æˆç¤ºä¾‹**ï¼š

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.ctrip.framework.apollo</groupId>
    <artifactId>apollo-client</artifactId>
    <version>2.0.1</version>
</dependency>
```

```properties
# application.properties
# Apolloé…ç½®
app.id=myapp                        # åº”ç”¨IDï¼ˆåœ¨Apolloä¸­æ³¨å†Œï¼‰
apollo.meta=http://apollo-server:8080  # Apolloåœ°å€
apollo.bootstrap.enabled=true       # å¯åŠ¨æ—¶åŠ è½½é…ç½®
apollo.bootstrap.namespaces=application,db,redis  # è¦åŠ è½½çš„å‘½åç©ºé—´
```

```java
// ä½¿ç”¨Apolloé…ç½®
import com.ctrip.framework.apollo.Config;
import com.ctrip.framework.apollo.spring.annotation.ApolloConfig;
import com.ctrip.framework.apollo.spring.annotation.EnableApolloConfig;
import org.springframework.stereotype.Component;

@Component
@EnableApolloConfig  // å¼€å¯Apolloé…ç½®
public class ApolloConfigDemo {
    
    @ApolloConfig  // æ³¨å…¥Apolloé…ç½®å¯¹è±¡
    private Config config;
    
    public String getDatabaseUrl() {
        // ä»Apolloè¯»å–é…ç½®ï¼Œæ”¯æŒå®æ—¶æ›´æ–°
        return config.getProperty("spring.datasource.url", "defaultValue");
    }
    
    // ç›‘å¬é…ç½®å˜åŒ–
    @ApolloConfigChangeListener
    private void onChange(ConfigChangeEvent changeEvent) {
        for (String key : changeEvent.changedKeys()) {
            System.out.println("é…ç½®å˜æ›´: " + key + 
                " æ—§å€¼: " + changeEvent.getChange(key).getOldValue() +
                " æ–°å€¼: " + changeEvent.getChange(key).getNewValue());
        }
    }
}
```

### 6.5 Nacosé…ç½®ä¸­å¿ƒ


**Nacosçš„ç‰¹ç‚¹**ï¼š

ğŸ”¸ **äºŒåˆä¸€**ï¼šé…ç½®ä¸­å¿ƒ + æœåŠ¡æ³¨å†Œå‘ç°  
ğŸ”¸ **å¤šç§Ÿæˆ·**ï¼šæ”¯æŒå‘½åç©ºé—´éš”ç¦»  
ğŸ”¸ **å¤šæ ¼å¼**ï¼šæ”¯æŒpropertiesã€yamlã€jsonç­‰æ ¼å¼  
ğŸ”¸ **å›½äº§å¼€æº**ï¼šé˜¿é‡Œå·´å·´å¼€æºï¼Œä¸­æ–‡æ–‡æ¡£é½å…¨

**Nacosé›†æˆç¤ºä¾‹**ï¼š

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
    <version>2.2.9.RELEASE</version>
</dependency>
```

```properties
# bootstrap.properties
spring.application.name=myapp
spring.profiles.active=prod

# Nacosé…ç½®ä¸­å¿ƒåœ°å€
spring.cloud.nacos.config.server-addr=nacos-server:8848

# é…ç½®æ–‡ä»¶æ ¼å¼
spring.cloud.nacos.config.file-extension=yaml

# å‘½åç©ºé—´ï¼ˆç”¨äºç¯å¢ƒéš”ç¦»ï¼‰
spring.cloud.nacos.config.namespace=prod-env

# é…ç½®åˆ†ç»„
spring.cloud.nacos.config.group=DEFAULT_GROUP
```

**Nacosé…ç½®è§„åˆ™**ï¼š

```
Nacosä¸­çš„é…ç½®æ–‡ä»¶å‘½åè§„åˆ™ï¼š
${spring.application.name}-${spring.profiles.active}.${file-extension}

ç¤ºä¾‹ï¼š
åº”ç”¨å: myapp
ç¯å¢ƒ: prod  
æ ¼å¼: yaml
â†’ é…ç½®æ–‡ä»¶å: myapp-prod.yaml

åœ¨Nacosæ§åˆ¶å°åˆ›å»ºé…ç½®ï¼š
Data ID: myapp-prod.yaml
Group: DEFAULT_GROUP
é…ç½®æ ¼å¼: YAML
é…ç½®å†…å®¹: 
  spring:
    datasource:
      url: jdbc:mysql://prod-db:3306/mydb
```

---

## 7. ğŸ”Œ ç¯å¢ƒå˜é‡æ³¨å…¥


### 7.1 ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡æ³¨å…¥


**é€šä¿—ç†è§£**ï¼šç¯å¢ƒå˜é‡å°±åƒæ“ä½œç³»ç»Ÿçš„"å…¨å±€é…ç½®"ï¼Œä»»ä½•ç¨‹åºéƒ½å¯ä»¥è¯»å–

```
ç¯å¢ƒå˜é‡ vs é…ç½®æ–‡ä»¶ï¼š

é…ç½®æ–‡ä»¶ï¼š
application.properties â†’ åªæœ‰ä½ çš„ç¨‹åºèƒ½è¯»

ç¯å¢ƒå˜é‡ï¼š
export DB_PASSWORD=secret123 â†’ æ‰€æœ‰ç¨‹åºéƒ½èƒ½è¯»
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ç¯å¢ƒå˜é‡**ï¼š

```
åœºæ™¯ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²

âŒ é…ç½®æ–‡ä»¶æ–¹å¼ï¼š
   1. ä¸ºæ¯ä¸ªç¯å¢ƒæ‰“ä¸åŒçš„é•œåƒ
   2. å¼€å‘ç¯å¢ƒé•œåƒ: myapp:dev
   3. ç”Ÿäº§ç¯å¢ƒé•œåƒ: myapp:prod
   ï¼ˆé•œåƒå¤šï¼Œç®¡ç†å¤æ‚ï¼‰

âœ… ç¯å¢ƒå˜é‡æ–¹å¼ï¼š
   1. åªæ‰“ä¸€ä¸ªé•œåƒ: myapp:latest
   2. å¯åŠ¨æ—¶ä¼ å…¥ä¸åŒç¯å¢ƒå˜é‡
   docker run -e ENV=dev myapp:latest    # å¼€å‘
   docker run -e ENV=prod myapp:latest   # ç”Ÿäº§
   ï¼ˆä¸€ä¸ªé•œåƒèµ°å¤©ä¸‹ï¼‰
```

### 7.2 ç¯å¢ƒå˜é‡çš„ä½¿ç”¨æ–¹å¼


**æ–¹å¼ä¸€ï¼šSpring Bootä¸­ç›´æ¥å¼•ç”¨**

```properties
# application.properties
# ä½¿ç”¨ ${} è¯­æ³•å¼•ç”¨ç¯å¢ƒå˜é‡
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME:root}  # å¦‚æœæ²¡æœ‰åˆ™é»˜è®¤root
spring.datasource.password=${DB_PASSWORD}

# ç«¯å£å·ä¹Ÿå¯ä»¥ä»ç¯å¢ƒå˜é‡è¯»å–
server.port=${SERVER_PORT:8080}
```

**æ–¹å¼äºŒï¼šJavaä»£ç ä¸­è¯»å–**

```java
// æ–¹å¼1ï¼šä½¿ç”¨System.getenv()
String dbPassword = System.getenv("DB_PASSWORD");
System.out.println("æ•°æ®åº“å¯†ç : " + dbPassword);

// æ–¹å¼2ï¼šä½¿ç”¨@Valueæ³¨è§£
@Value("${DB_PASSWORD}")
private String dbPassword;

// æ–¹å¼3ï¼šä½¿ç”¨Environmentå¯¹è±¡
@Autowired
private Environment env;

public String getDbUrl() {
    return env.getProperty("DB_URL");
}
```

### 7.3 è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ³•


**Linux/Macç³»ç»Ÿ**ï¼š

```bash
# ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰
export DB_URL=jdbc:mysql://localhost:3306/mydb
export DB_USERNAME=root
export DB_PASSWORD=secret123

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
echo $DB_PASSWORD

# æ°¸ä¹…è®¾ç½®ï¼ˆå†™å…¥~/.bashrcæˆ–~/.bash_profileï¼‰
echo 'export DB_PASSWORD=secret123' >> ~/.bashrc
source ~/.bashrc

# å¯åŠ¨åº”ç”¨æ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡
java -jar myapp.jar
```

**Windowsç³»ç»Ÿ**ï¼š

```cmd
# ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰å‘½ä»¤çª—å£æœ‰æ•ˆï¼‰
set DB_URL=jdbc:mysql://localhost:3306/mydb
set DB_PASSWORD=secret123

# æ°¸ä¹…è®¾ç½®ï¼ˆç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰
setx DB_PASSWORD "secret123"  

# PowerShellä¸´æ—¶è®¾ç½®
$env:DB_PASSWORD="secret123"
```

**Dockerå®¹å™¨**ï¼š

```bash
# å¯åŠ¨å®¹å™¨æ—¶ä¼ å…¥ç¯å¢ƒå˜é‡
docker run -d \
  -e DB_URL=jdbc:mysql://prod-db:3306/mydb \
  -e DB_USERNAME=prod_user \
  -e DB_PASSWORD=SuperSecret123 \
  myapp:latest

# ä½¿ç”¨.envæ–‡ä»¶æ‰¹é‡è®¾ç½®
# .envæ–‡ä»¶å†…å®¹ï¼š
# DB_URL=jdbc:mysql://prod-db:3306/mydb
# DB_USERNAME=prod_user
# DB_PASSWORD=SuperSecret123

docker run -d --env-file .env myapp:latest
```

**Kubernetesï¼ˆK8sï¼‰**ï¼š

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:latest
        env:  # è®¾ç½®ç¯å¢ƒå˜é‡
        - name: DB_URL
          value: "jdbc:mysql://prod-db:3306/mydb"
        - name: DB_USERNAME
          valueFrom:
            secretKeyRef:  # ä»Secretè¯»å–æ•æ„Ÿä¿¡æ¯
              name: db-secret
              key: username
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: password
```

### 7.4 ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ


**å‘½åè§„èŒƒ**ï¼š

```bash
# âœ… æ¨èçš„å‘½åæ–¹å¼ï¼ˆå¤§å†™+ä¸‹åˆ’çº¿ï¼‰
DB_URL=jdbc:mysql://localhost:3306/mydb
DB_USERNAME=root
DB_PASSWORD=secret123
REDIS_HOST=localhost
REDIS_PORT=6379

# âŒ ä¸æ¨èçš„å‘½åæ–¹å¼
dbUrl=xxx         # å°å†™å®¹æ˜“å’Œæ™®é€šå˜é‡æ··æ·†
db-url=xxx        # ä¸­åˆ’çº¿åœ¨æŸäº›ç³»ç»Ÿä¸æ”¯æŒ
DatabaseUrl=xxx   # é©¼å³°å‘½åä¸ç¬¦åˆæƒ¯ä¾‹
```

**ç¯å¢ƒå˜é‡åˆ†å±‚ç®¡ç†**ï¼š

```
å¼€å‘ç¯å¢ƒï¼š
export ENV=dev
export DB_URL=jdbc:mysql://localhost:3306/mydb_dev
export LOG_LEVEL=DEBUG

æµ‹è¯•ç¯å¢ƒï¼š
export ENV=test  
export DB_URL=jdbc:mysql://test-server:3306/mydb_test
export LOG_LEVEL=INFO

ç”Ÿäº§ç¯å¢ƒï¼š
export ENV=prod
export DB_URL=jdbc:mysql://prod-cluster:3306/mydb_prod
export LOG_LEVEL=WARN
```

**å®‰å…¨æ³¨æ„äº‹é¡¹**ï¼š

| å®‰å…¨æªæ–½ | **è¯´æ˜** | **å®è·µæ–¹æ³•** |
|---------|---------|-------------|
| ğŸ” **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤** | `ä¸è¦åœ¨æ—¥å¿—ä¸­æ‰“å°ç¯å¢ƒå˜é‡` | `ç¦æ­¢System.out.println(env)` |
| ğŸ”’ **æƒé™æ§åˆ¶** | `é™åˆ¶è°èƒ½è®¾ç½®ç¯å¢ƒå˜é‡` | `åªæœ‰è¿ç»´äººå‘˜æœ‰æƒé™` |
| ğŸ“ **ä¸è¦ç¡¬ç¼–ç ** | `ä¸è¦åœ¨ä»£ç ä¸­è®¾ç½®ç¯å¢ƒå˜é‡` | `é€šè¿‡éƒ¨ç½²è„šæœ¬æˆ–CI/CDè®¾ç½®` |
| ğŸ”„ **å®šæœŸè½®æ¢** | `å®šæœŸæ›´æ¢æ•æ„Ÿç¯å¢ƒå˜é‡` | `æ¯3ä¸ªæœˆæ›´æ¢ä¸€æ¬¡å¯†ç ` |

---

## 8. ğŸ”€ Profileç¯å¢ƒåˆ‡æ¢


### 8.1 Spring Profileæœºåˆ¶


**Profileçš„æ ¸å¿ƒä½œç”¨**ï¼šä¸€å¥—ä»£ç ï¼Œå¤šç¯å¢ƒè¿è¡Œ

```
Profileæœºåˆ¶åŸç†ï¼š

ä»£ç å±‚é¢ï¼š
@Profile("dev")    â†’ åªåœ¨å¼€å‘ç¯å¢ƒç”Ÿæ•ˆ
@Profile("prod")   â†’ åªåœ¨ç”Ÿäº§ç¯å¢ƒç”Ÿæ•ˆ
@Profile("test")   â†’ åªåœ¨æµ‹è¯•ç¯å¢ƒç”Ÿæ•ˆ

é…ç½®å±‚é¢ï¼š
application.properties        â†’ é€šç”¨é…ç½®
application-dev.properties    â†’ å¼€å‘ç¯å¢ƒé…ç½®
application-prod.properties   â†’ ç”Ÿäº§ç¯å¢ƒé…ç½®

å¯åŠ¨æ—¶æŒ‡å®šProfileï¼š
java -jar app.jar --spring.profiles.active=prod
â†’ åŠ è½½ application.properties + application-prod.properties
```

### 8.2 Profileé…ç½®æ–‡ä»¶


**é…ç½®æ–‡ä»¶å‘½åè§„åˆ™**ï¼š

```
application-{profile}.properties

ç¤ºä¾‹ï¼š
application-dev.properties     # å¼€å‘ç¯å¢ƒ
application-test.properties    # æµ‹è¯•ç¯å¢ƒ
application-staging.properties # é¢„å‘å¸ƒç¯å¢ƒ
application-prod.properties    # ç”Ÿäº§ç¯å¢ƒ
```

**å…¬å…±é…ç½®ä¸ç¯å¢ƒé…ç½®**ï¼š

```properties
# ===== application.propertiesï¼ˆå…¬å…±é…ç½®ï¼‰ =====
# æ‰€æœ‰ç¯å¢ƒé€šç”¨çš„é…ç½®
spring.application.name=myapp
mybatis.mapper-locations=classpath:mapper/*.xml

# é»˜è®¤æ¿€æ´»çš„Profileï¼ˆå¯è¢«å¯åŠ¨å‚æ•°è¦†ç›–ï¼‰
spring.profiles.active=dev
```

```properties
# ===== application-dev.propertiesï¼ˆå¼€å‘ç¯å¢ƒï¼‰ =====
# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/mydb_dev
spring.datasource.username=root
spring.datasource.password=123456

# æ—¥å¿—é…ç½®
logging.level.root=DEBUG
logging.level.com.myapp=TRACE
```

```properties
# ===== application-prod.propertiesï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ =====
# æ•°æ®åº“é…ç½®
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# è¿æ¥æ± ä¼˜åŒ–
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10

# æ—¥å¿—é…ç½®
logging.level.root=WARN
logging.level.com.myapp=INFO

# æ€§èƒ½ä¼˜åŒ–
spring.jpa.show-sql=false
```

### 8.3 Profileåœ¨Javaä»£ç ä¸­çš„ä½¿ç”¨


**Beançº§åˆ«çš„Profile**ï¼š

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;

@Configuration
public class DataSourceConfig {
    
    // å¼€å‘ç¯å¢ƒçš„æ•°æ®æºé…ç½®
    @Bean
    @Profile("dev")  // åªåœ¨devç¯å¢ƒç”Ÿæ•ˆ
    public DataSource devDataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl("jdbc:mysql://localhost:3306/mydb_dev");
        dataSource.setUsername("root");
        dataSource.setPassword("123456");
        dataSource.setMaximumPoolSize(5);  // å¼€å‘ç¯å¢ƒè¿æ¥æ± å°ä¸€ç‚¹
        return dataSource;
    }
    
    // ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æºé…ç½®
    @Bean
    @Profile("prod")  // åªåœ¨prodç¯å¢ƒç”Ÿæ•ˆ
    public DataSource prodDataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl(System.getenv("DB_URL"));
        dataSource.setUsername(System.getenv("DB_USERNAME"));
        dataSource.setPassword(System.getenv("DB_PASSWORD"));
        dataSource.setMaximumPoolSize(50);  // ç”Ÿäº§ç¯å¢ƒè¿æ¥æ± å¤§
        return dataSource;
    }
}
```

**ç±»çº§åˆ«çš„Profile**ï¼š

```java
// å¼€å‘ç¯å¢ƒä¸“ç”¨çš„é…ç½®ç±»
@Configuration
@Profile("dev")  // æ•´ä¸ªç±»åªåœ¨devç¯å¢ƒåŠ è½½
public class DevConfig {
    
    @Bean
    public MockEmailService emailService() {
        // å¼€å‘ç¯å¢ƒä½¿ç”¨Mocké‚®ä»¶æœåŠ¡ï¼Œä¸çœŸçš„å‘é‚®ä»¶
        return new MockEmailService();
    }
    
    @Bean
    public DebugInterceptor debugInterceptor() {
        // å¼€å‘ç¯å¢ƒæ‰éœ€è¦çš„è°ƒè¯•æ‹¦æˆªå™¨
        return new DebugInterceptor();
    }
}

// ç”Ÿäº§ç¯å¢ƒä¸“ç”¨çš„é…ç½®ç±»
@Configuration
@Profile("prod")  // æ•´ä¸ªç±»åªåœ¨prodç¯å¢ƒåŠ è½½
public class ProdConfig {
    
    @Bean
    public RealEmailService emailService() {
        // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çœŸå®é‚®ä»¶æœåŠ¡
        return new RealEmailService();
    }
    
    @Bean
    public SecurityInterceptor securityInterceptor() {
        // ç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨æ‹¦æˆªå™¨
        return new SecurityInterceptor();
    }
}
```

**ç»„åˆProfile**ï¼š

```java
// æ”¯æŒå¤šä¸ªProfile
@Profile({"dev", "test"})  // devæˆ–testç¯å¢ƒéƒ½åŠ è½½
public class NonProdConfig {
    // éç”Ÿäº§ç¯å¢ƒçš„é…ç½®
}

// Profileè¡¨è¾¾å¼
@Profile("!prod")  // é™¤äº†prodç¯å¢ƒéƒ½åŠ è½½
public class DebugConfig {
    // è°ƒè¯•ç›¸å…³é…ç½®
}

@Profile("prod & cloud")  // åŒæ—¶æ»¡è¶³prodå’Œcloudæ‰åŠ è½½
public class CloudProdConfig {
    // äº‘ä¸Šç”Ÿäº§ç¯å¢ƒé…ç½®
}
```

### 8.4 Profileæ¿€æ´»æ–¹å¼


**æ–¹å¼ä¸€ï¼šé…ç½®æ–‡ä»¶æŒ‡å®š**

```properties
# application.properties
spring.profiles.active=dev  # æ¿€æ´»devç¯å¢ƒ
```

**æ–¹å¼äºŒï¼šå¯åŠ¨å‚æ•°æŒ‡å®š**

```bash
# æ–¹å¼1ï¼šä½¿ç”¨--spring.profiles.active
java -jar myapp.jar --spring.profiles.active=prod

# æ–¹å¼2ï¼šä½¿ç”¨-Dç³»ç»Ÿå±æ€§
java -Dspring.profiles.active=prod -jar myapp.jar

# æ–¹å¼3ï¼šæ¿€æ´»å¤šä¸ªProfile
java -jar myapp.jar --spring.profiles.active=prod,cloud,mysql
# åŒæ—¶æ¿€æ´»prodã€cloudã€mysqlä¸‰ä¸ªç¯å¢ƒ
```

**æ–¹å¼ä¸‰ï¼šç¯å¢ƒå˜é‡æŒ‡å®š**

```bash
# Linux/Mac
export SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar

# Windows
set SPRING_PROFILES_ACTIVE=prod
java -jar myapp.jar

# Docker
docker run -e SPRING_PROFILES_ACTIVE=prod myapp:latest
```

**æ–¹å¼å››ï¼šIDEä¸­æŒ‡å®šï¼ˆå¼€å‘é˜¶æ®µï¼‰**

```
IDEAé…ç½®ï¼š
1. Run â†’ Edit Configurations
2. æ‰¾åˆ°Spring Booté…ç½®
3. Active profiles: dev
4. è¿è¡Œåº”ç”¨

Eclipseé…ç½®ï¼š
1. Run â†’ Run Configurations
2. Spring Boot App â†’ Arguments
3. Program arguments: --spring.profiles.active=dev
```

### 8.5 Profileä¼˜å…ˆçº§ä¸è¦†ç›–è§„åˆ™


**é…ç½®åŠ è½½ä¼˜å…ˆçº§**ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼š

```
1ï¸âƒ£ å‘½ä»¤è¡Œå‚æ•°
   --spring.profiles.active=prod

2ï¸âƒ£ ç¯å¢ƒå˜é‡
   export SPRING_PROFILES_ACTIVE=prod

3ï¸âƒ£ application.propertiesä¸­çš„é…ç½®
   spring.profiles.active=dev

ä¼˜å…ˆçº§ç¤ºä¾‹ï¼š
application.propertiesè®¾ç½®ï¼šspring.profiles.active=dev
å¯åŠ¨æ—¶ä¼ å‚ï¼š--spring.profiles.active=prod
â†’ æœ€ç»ˆæ¿€æ´»ï¼šprodï¼ˆå‘½ä»¤è¡Œå‚æ•°ä¼˜å…ˆçº§é«˜ï¼‰
```

**å¤šProfileåŠ è½½é¡ºåº**ï¼š

```
æ¿€æ´»å¤šä¸ªProfileï¼š
--spring.profiles.active=base,prod,mysql

åŠ è½½é¡ºåºï¼š
1. application.propertiesï¼ˆåŸºç¡€é…ç½®ï¼‰
2. application-base.properties
3. application-prod.properties
4. application-mysql.properties

ç›¸åŒé…ç½®çš„è¦†ç›–è§„åˆ™ï¼š
ååŠ è½½çš„è¦†ç›–å…ˆåŠ è½½çš„

ç¤ºä¾‹ï¼š
application-base.properties: server.port=8080
application-prod.properties: server.port=9090
â†’ æœ€ç»ˆç«¯å£ï¼š9090ï¼ˆprodè¦†ç›–äº†baseï¼‰
```

### 8.6 Profileä½¿ç”¨åœºæ™¯ä¸æŠ€å·§


**åœºæ™¯ä¸€ï¼šæ•°æ®åº“åˆ‡æ¢**

```java
@Configuration
public class DatabaseConfig {
    
    @Bean
    @Profile("mysql")  // MySQLæ•°æ®åº“
    public DataSource mysqlDataSource() {
        // MySQLé…ç½®
    }
    
    @Bean
    @Profile("oracle")  // Oracleæ•°æ®åº“
    public DataSource oracleDataSource() {
        // Oracleé…ç½®
    }
    
    @Bean
    @Profile("h2")  // H2å†…å­˜æ•°æ®åº“ï¼ˆç”¨äºæµ‹è¯•ï¼‰
    public DataSource h2DataSource() {
        // H2é…ç½®
    }
}

å¯åŠ¨æ—¶é€‰æ‹©æ•°æ®åº“ï¼š
java -jar app.jar --spring.profiles.active=dev,mysql
```

**åœºæ™¯äºŒï¼šåŠŸèƒ½å¼€å…³**

```java
@Service
@Profile("!prod")  // éç”Ÿäº§ç¯å¢ƒæ‰å¯ç”¨
public class DebugService {
    
    public void printDebugInfo() {
        // è°ƒè¯•ä¿¡æ¯æ‰“å°
        // ç”Ÿäº§ç¯å¢ƒä¸éœ€è¦è¿™ä¸ªæœåŠ¡
    }
}

@Service
@Profile("feature-recommend")  // æ¨èåŠŸèƒ½å¼€å…³
public class RecommendService {
    // æ–°åŠŸèƒ½ï¼Œé€šè¿‡Profileæ§åˆ¶æ˜¯å¦å¯ç”¨
}

å¯ç”¨æ–°åŠŸèƒ½æµ‹è¯•ï¼š
java -jar app.jar --spring.profiles.active=prod,feature-recommend
```

**åœºæ™¯ä¸‰ï¼šäº‘å¹³å°é€‚é…**

```java
@Configuration
@Profile("aliyun")  // é˜¿é‡Œäº‘ç¯å¢ƒ
public class AliyunConfig {
    @Bean
    public OssClient ossClient() {
        // é˜¿é‡Œäº‘OSSé…ç½®
    }
}

@Configuration
@Profile("aws")  // AWSç¯å¢ƒ
public class AwsConfig {
    @Bean
    public S3Client s3Client() {
        // AWS S3é…ç½®
    }
}

éƒ¨ç½²åˆ°ä¸åŒäº‘å¹³å°ï¼š
é˜¿é‡Œäº‘ï¼š--spring.profiles.active=prod,aliyun
AWSï¼š--spring.profiles.active=prod,aws
```

---

## 9. ğŸ“ é…ç½®ç‰ˆæœ¬ç®¡ç†


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®ç‰ˆæœ¬ç®¡ç†


**é…ç½®å˜æ›´çš„é£é™©**ï¼š

```
åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®å‡ºç°é—®é¢˜

âŒ æ²¡æœ‰ç‰ˆæœ¬ç®¡ç†çš„å›°å¢ƒï¼š
1. é…ç½®è¢«æ”¹é”™äº†ï¼Œä½†ä¸çŸ¥é“æ”¹äº†ä»€ä¹ˆ
2. æƒ³å›é€€åˆ°ä¹‹å‰çš„é…ç½®ï¼Œä½†æ‰¾ä¸åˆ°å†å²ç‰ˆæœ¬
3. å¤šäººä¿®æ”¹é…ç½®ï¼Œä¸çŸ¥é“è°æ”¹çš„
4. é…ç½®å˜æ›´æ²¡æœ‰å®¡æ‰¹æµç¨‹ï¼Œéšæ„ä¿®æ”¹

âœ… æœ‰ç‰ˆæœ¬ç®¡ç†çš„ä¼˜åŠ¿ï¼š
1. æ¯æ¬¡ä¿®æ”¹éƒ½æœ‰è®°å½•ï¼Œå¯ä»¥æŸ¥çœ‹å†å²
2. å¯ä»¥å¿«é€Ÿå›é€€åˆ°ä»»æ„å†å²ç‰ˆæœ¬
3. çŸ¥é“è°åœ¨ä»€ä¹ˆæ—¶å€™æ”¹äº†ä»€ä¹ˆ
4. å˜æ›´å¯ä»¥èµ°å®¡æ‰¹æµç¨‹
```

**é…ç½®ç‰ˆæœ¬ç®¡ç†çš„æ ¸å¿ƒä»·å€¼**ï¼š

ğŸ”¸ **å˜æ›´è¿½æº¯**ï¼šè°åœ¨ä½•æ—¶æ”¹äº†ä»€ä¹ˆé…ç½®  
ğŸ”¸ **ç‰ˆæœ¬å›é€€**ï¼šå‡ºé—®é¢˜å¯ä»¥å¿«é€Ÿå›åˆ°ä¸Šä¸€ç‰ˆæœ¬  
ğŸ”¸ **å˜æ›´å®¡è®¡**ï¼šæ»¡è¶³åˆè§„è¦æ±‚ï¼Œç•™ä¸‹å®¡è®¡æ—¥å¿—  
ğŸ”¸ **ç°åº¦å‘å¸ƒ**ï¼šæ–°é…ç½®å…ˆåœ¨éƒ¨åˆ†æœåŠ¡å™¨è¯•ç‚¹  
ğŸ”¸ **ååŒç®¡ç†**ï¼šå¤šäººåä½œæ—¶é¿å…å†²çª

### 9.2 Gitç®¡ç†é…ç½®æ–‡ä»¶


**Gitä½œä¸ºé…ç½®ä»“åº“**ï¼š

```
é…ç½®ä»“åº“ç»“æ„ï¼š
config-repo/
â”œâ”€â”€ .git/                    # Gitç‰ˆæœ¬æ§åˆ¶
â”œâ”€â”€ application.properties   # å…¬å…±é…ç½®
â”œâ”€â”€ dev/                     # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ db.properties
â”‚   â””â”€â”€ redis.properties
â”œâ”€â”€ test/                    # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ db.properties
â”‚   â””â”€â”€ redis.properties
â”œâ”€â”€ prod/                    # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ db.properties
â”‚   â””â”€â”€ redis.properties
â””â”€â”€ README.md               # é…ç½®è¯´æ˜æ–‡æ¡£
```

**é…ç½®å˜æ›´æµç¨‹**ï¼š

```
Gité…ç½®ç®¡ç†æµç¨‹ï¼š

1. å¼€å‘äººå‘˜ä¿®æ”¹é…ç½®
   vim prod/db.properties
   ä¿®æ”¹ï¼šmax_connections=100 â†’ 200

2. æäº¤å˜æ›´åˆ°Git
   git add prod/db.properties
   git commit -m "ä¼˜åŒ–ï¼šå¢åŠ æ•°æ®åº“è¿æ¥æ± å¤§å°åˆ°200"
   git push origin main

3. é…ç½®ä¸­å¿ƒæ‹‰å–æœ€æ–°é…ç½®
   Config Serverè‡ªåŠ¨ä»Gitæ‹‰å–

4. åº”ç”¨åˆ·æ–°é…ç½®
   POST /actuator/refresh

5. é…ç½®ç”Ÿæ•ˆ
   æ–°çš„è¿æ¥æ± å¤§å°ç”Ÿæ•ˆ
```

**Gitç‰ˆæœ¬ç®¡ç†ä¼˜åŠ¿**ï¼š

```bash
# æŸ¥çœ‹é…ç½®å˜æ›´å†å²
git log -- prod/db.properties

# è¾“å‡ºç¤ºä¾‹ï¼š
# commit abc123 (HEAD -> main)
# Date: 2025-09-20 10:30:00
# ä¼˜åŒ–ï¼šå¢åŠ æ•°æ®åº“è¿æ¥æ± å¤§å°åˆ°200
#
# commit def456
# Date: 2025-09-15 14:20:00
# ä¿®å¤ï¼šä¿®æ­£Redisç«¯å£å·é”™è¯¯

# å¯¹æ¯”é…ç½®å·®å¼‚
git diff abc123 def456 -- prod/db.properties

# å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬
git checkout def456 -- prod/db.properties
git commit -m "å›é€€ï¼šæ¢å¤åˆ°ä¹‹å‰çš„è¿æ¥æ± é…ç½®"
```

**é…ç½®æ–‡ä»¶çš„.gitignore**ï¼š

```bash
# .gitignoreæ–‡ä»¶å†…å®¹

# ä¸è¦æŠŠæ•æ„Ÿé…ç½®æäº¤åˆ°Gitï¼
*.secret.properties
*-local.properties
.env

# æœ¬åœ°å¼€å‘é…ç½®
application-local.properties

# åŠ å¯†å¯†é’¥æ–‡ä»¶
*.key
*.pem
keystore.p12
```

### 9.3 é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹


**ä¼ä¸šçº§é…ç½®ç®¡ç†æµç¨‹**ï¼š

```
é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹ï¼š

1. æäº¤å˜æ›´ç”³è¯·
   å¼€å‘äººå‘˜ï¼šåˆ›å»ºé…ç½®å˜æ›´å•
   å†…å®¹ï¼šè¦æ”¹ä»€ä¹ˆé…ç½®ï¼Œä¸ºä»€ä¹ˆæ”¹

2. ä»£ç å®¡æŸ¥ï¼ˆCode Reviewï¼‰
   åŒäº‹å®¡æŸ¥ï¼šæ£€æŸ¥é…ç½®æ˜¯å¦åˆç†
   
3. æµ‹è¯•éªŒè¯
   åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°é…ç½®

4. å®¡æ‰¹æµç¨‹
   æŠ€æœ¯è´Ÿè´£äººå®¡æ‰¹ â†’ è¿ç»´å®¡æ‰¹ â†’ ä¸Šçº¿

5. ç”Ÿäº§å‘å¸ƒ
   å…ˆç°åº¦å‘å¸ƒï¼ˆ10%æœåŠ¡å™¨ï¼‰
   è§‚å¯Ÿæ— é—®é¢˜åå…¨é‡å‘å¸ƒ

6. è®°å½•å½’æ¡£
   å˜æ›´è®°å½•å­˜æ¡£ï¼Œä¾¿äºå®¡è®¡
```

**ä½¿ç”¨Gitåˆ†æ”¯ç®¡ç†**ï¼š

```bash
# ä¸»åˆ†æ”¯ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®
main (protected)
  â”œâ”€â”€ prod/db.properties

# åŠŸèƒ½åˆ†æ”¯ï¼šé…ç½®å˜æ›´
feature/increase-db-pool
  â”œâ”€â”€ prod/db.properties (ä¿®æ”¹å)

å·¥ä½œæµç¨‹ï¼š
1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
   git checkout -b feature/increase-db-pool

2. ä¿®æ”¹é…ç½®
   vim prod/db.properties

3. æäº¤å˜æ›´
   git commit -m "å¢åŠ è¿æ¥æ± å¤§å°"

4. åˆ›å»ºPull Request
   GitHub/GitLabä¸Šåˆ›å»ºPRï¼Œç­‰å¾…å®¡æ‰¹

5. ä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶
   git merge feature/increase-db-pool
   
6. åˆ é™¤åŠŸèƒ½åˆ†æ”¯
   git branch -d feature/increase-db-pool
```

### 9.4 é…ç½®å˜æ›´çš„ç°åº¦å‘å¸ƒ


**ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒ**ï¼š

```
ç°åº¦å‘å¸ƒï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰åŸç†ï¼š

ä¼ ç»Ÿå‘å¸ƒï¼š
æ–°é…ç½® â†’ å…¨éƒ¨æœåŠ¡å™¨ï¼ˆä¸€æ¬¡æ€§ï¼‰
é£é™©ï¼šå¦‚æœé…ç½®æœ‰é—®é¢˜ï¼Œå…¨éƒ¨æœåŠ¡å™¨æŒ‚æ‰

ç°åº¦å‘å¸ƒï¼š
æ–°é…ç½® â†’ 10%æœåŠ¡å™¨ï¼ˆè§‚å¯Ÿï¼‰
       â†’ 30%æœåŠ¡å™¨ï¼ˆç»§ç»­è§‚å¯Ÿï¼‰
       â†’ 100%æœåŠ¡å™¨ï¼ˆå…¨é‡å‘å¸ƒï¼‰
é£é™©ï¼šé—®é¢˜å½±å“èŒƒå›´å°ï¼Œå¯å¿«é€Ÿå›é€€
```

**ç°åº¦å‘å¸ƒå®ç°æ–¹æ¡ˆ**ï¼š

```
æ–¹æ¡ˆ1ï¼šä½¿ç”¨Apolloé…ç½®ä¸­å¿ƒ

æ­¥éª¤1ï¼šåˆ›å»ºç°åº¦ç‰ˆæœ¬
åœ¨Apolloç•Œé¢åˆ›å»ºæ–°é…ç½®ç‰ˆæœ¬
é…ç½®å†…å®¹ï¼šmax_connections=200

æ­¥éª¤2ï¼šé€‰æ‹©ç°åº¦æœåŠ¡å™¨
é€‰æ‹©10%çš„æœåŠ¡å™¨ï¼ˆå¦‚ï¼šserver1, server2ï¼‰

æ­¥éª¤3ï¼šå‘å¸ƒç°åº¦é…ç½®
åªæœ‰server1å’Œserver2ä½¿ç”¨æ–°é…ç½®

æ­¥éª¤4ï¼šç›‘æ§è§‚å¯Ÿ
è§‚å¯Ÿç°åº¦æœåŠ¡å™¨çš„è¿è¡Œæƒ…å†µ
- CPUã€å†…å­˜ä½¿ç”¨ç‡
- æ•°æ®åº“è¿æ¥æ•°
- é”™è¯¯æ—¥å¿—

æ­¥éª¤5ï¼šå…¨é‡å‘å¸ƒ
ç°åº¦æœåŠ¡å™¨æ­£å¸¸ â†’ å‘å¸ƒåˆ°å…¨éƒ¨æœåŠ¡å™¨
ç°åº¦æœåŠ¡å™¨å¼‚å¸¸ â†’ å›é€€é…ç½®
```

**é…ç½®ç‰ˆæœ¬æ ‡ç­¾**ï¼š

```bash
# ä½¿ç”¨Git Tagæ ‡è®°é…ç½®ç‰ˆæœ¬
git tag -a v1.0.0 -m "ç‰ˆæœ¬1.0.0ï¼šåˆå§‹é…ç½®"
git tag -a v1.1.0 -m "ç‰ˆæœ¬1.1.0ï¼šå¢åŠ è¿æ¥æ± å¤§å°"
git push origin --tags

# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬
git tag -l
# è¾“å‡ºï¼š
# v1.0.0
# v1.1.0
# v1.2.0

# å›é€€åˆ°æŒ‡å®šç‰ˆæœ¬
git checkout v1.0.0

# åŸºäºæŸä¸ªç‰ˆæœ¬åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b hotfix/v1.0.1 v1.0.0
```

### 9.5 é…ç½®å˜æ›´çš„ç›‘æ§ä¸å‘Šè­¦


**é…ç½®å˜æ›´é€šçŸ¥**ï¼š

```java
import org.springframework.cloud.context.environment.EnvironmentChangeEvent;
import org.springframework.context.event.EventListener;
import org.springframework.stereotype.Component;

@Component
public class ConfigChangeNotifier {
    
    @Autowired
    private DingTalkService dingTalkService;  // é’‰é’‰é€šçŸ¥
    
    @EventListener
    public void onConfigChange(EnvironmentChangeEvent event) {
        Set<String> changedKeys = event.getKeys();
        
        // æ„å»ºé€šçŸ¥æ¶ˆæ¯
        String message = buildNotification(changedKeys);
        
        // å‘é€é’‰é’‰é€šçŸ¥
        dingTalkService.sendMessage(message);
        
        // è®°å½•å˜æ›´æ—¥å¿—
        logConfigChange(changedKeys);
    }
    
    private String buildNotification(Set<String> keys) {
        StringBuilder sb = new StringBuilder();
        sb.append("ã€é…ç½®å˜æ›´é€šçŸ¥ã€‘\n");
        sb.append("ç¯å¢ƒï¼šç”Ÿäº§ç¯å¢ƒ\n");
        sb.append("æ—¶é—´ï¼š" + LocalDateTime.now() + "\n");
        sb.append("å˜æ›´é¡¹ï¼š\n");
        
        for (String key : keys) {
            String oldValue = getOldValue(key);
            String newValue = getNewValue(key);
            sb.append("- " + key + ": " + oldValue + " â†’ " + newValue + "\n");
        }
        
        return sb.toString();
    }
}
```

**é…ç½®å˜æ›´æ—¥å¿—**ï¼š

```
é…ç½®å˜æ›´æ—¥å¿—è¡¨è®¾è®¡ï¼š

CREATE TABLE config_change_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    config_key VARCHAR(200) NOT NULL,      -- é…ç½®é¡¹
    old_value TEXT,                        -- æ—§å€¼
    new_value TEXT,                        -- æ–°å€¼
    operator VARCHAR(50),                  -- æ“ä½œäºº
    change_time DATETIME,                  -- å˜æ›´æ—¶é—´
    environment VARCHAR(20),               -- ç¯å¢ƒ(dev/test/prod)
    change_reason VARCHAR(500),            -- å˜æ›´åŸå› 
    rollback_flag TINYINT DEFAULT 0,      -- æ˜¯å¦å·²å›é€€
    INDEX idx_key (config_key),
    INDEX idx_time (change_time)
);

æ—¥å¿—è®°å½•ç¤ºä¾‹ï¼š
| config_key              | old_value | new_value | operator | change_time         |
|------------------------|-----------|-----------|----------|---------------------|
| db.pool.max-size       | 100       | 200       | admin    | 2025-09-20 10:30:00 |
| redis.timeout          | 3000      | 5000      | admin    | 2025-09-20 11:00:00 |
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 é…ç½®ç®¡ç†æ ¸å¿ƒæ¦‚å¿µå›é¡¾


**é…ç½®ç®¡ç†çš„æœ¬è´¨**ï¼š

```
æ ¸å¿ƒæ€æƒ³ï¼šä»£ç ä¸é…ç½®åˆ†ç¦»
- ä»£ç è´Ÿè´£ï¼šä¸šåŠ¡é€»è¾‘ï¼ˆä¸å˜çš„éƒ¨åˆ†ï¼‰
- é…ç½®è´Ÿè´£ï¼šè¿è¡Œå‚æ•°ï¼ˆå¯å˜çš„éƒ¨åˆ†ï¼‰

å¥½å¤„ï¼š
âœ… ä¸€å¥—ä»£ç ï¼Œå¤šç¯å¢ƒè¿è¡Œ
âœ… é…ç½®ä¿®æ”¹ä¸éœ€è¦é‡æ–°ç¼–è¯‘
âœ… æ•æ„Ÿä¿¡æ¯ä¸æ‰“åŒ…è¿›ä»£ç 
âœ… ç¯å¢ƒåˆ‡æ¢æ–¹ä¾¿å¿«æ·
```

**ä¸‰å¤§ç¯å¢ƒçš„é…ç½®è¦ç‚¹**ï¼š

| ç¯å¢ƒ | **æ•°æ®åº“** | **æ—¥å¿—çº§åˆ«** | **è¿æ¥æ± å¤§å°** | **å®‰å…¨è¦æ±‚** |
|------|-----------|------------|--------------|-------------|
| ğŸ”§ **å¼€å‘ç¯å¢ƒ** | `æœ¬åœ°æ•°æ®åº“` | `DEBUG/TRACE` | `5-10` | `ä½` |
| ğŸ§ª **æµ‹è¯•ç¯å¢ƒ** | `æµ‹è¯•æœåŠ¡å™¨` | `INFO/DEBUG` | `10-20` | `ä¸­` |
| ğŸš€ **ç”Ÿäº§ç¯å¢ƒ** | `é›†ç¾¤/é«˜å¯ç”¨` | `WARN/ERROR` | `50-100` | `é«˜` |

### 10.2 é…ç½®ç®¡ç†æœ€ä½³å®è·µæ¸…å•


**å®‰å…¨é…ç½®æ£€æŸ¥æ¸…å•**ï¼š

```
âœ… æ•æ„Ÿä¿¡æ¯åŠ å¯†
   â–¡ æ•°æ®åº“å¯†ç ä½¿ç”¨JasyptåŠ å¯†æˆ–ç¯å¢ƒå˜é‡
   â–¡ APIå¯†é’¥ä¸å†™åœ¨é…ç½®æ–‡ä»¶é‡Œ
   â–¡ åŠ å¯†å¯†é’¥é€šè¿‡å¯åŠ¨å‚æ•°ä¼ å…¥

âœ… é…ç½®æ–‡ä»¶ç®¡ç†
   â–¡ æ•æ„Ÿé…ç½®åŠ å…¥.gitignore
   â–¡ ç”Ÿäº§é…ç½®ä¸æäº¤åˆ°ç‰ˆæœ¬åº“
   â–¡ é…ç½®æ–‡ä»¶æƒé™è®¾ç½®ä¸º600ï¼ˆåªæœ‰æ‰€æœ‰è€…å¯è¯»å†™ï¼‰

âœ… ç‰ˆæœ¬æ§åˆ¶
   â–¡ é…ç½®å˜æ›´æœ‰Gitè®°å½•
   â–¡ é‡è¦ç‰ˆæœ¬æ‰“Tagæ ‡ç­¾
   â–¡ å˜æ›´æœ‰å®¡æ‰¹æµç¨‹
```

**ç¯å¢ƒåˆ‡æ¢æ“ä½œæŒ‡å—**ï¼š

```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
java -jar myapp.jar --spring.profiles.active=dev

# æµ‹è¯•ç¯å¢ƒå¯åŠ¨
java -jar myapp.jar --spring.profiles.active=test

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
export SPRING_PROFILES_ACTIVE=prod
export DB_PASSWORD=SecretPassword123
java -jar myapp.jar

# Dockerå®¹å™¨åŒ–å¯åŠ¨
docker run -d \
  -e SPRING_PROFILES_ACTIVE=prod \
  -e DB_URL=jdbc:mysql://prod-db:3306/mydb \
  -e DB_PASSWORD=${DB_PASSWORD} \
  myapp:latest
```

### 10.3 é…ç½®ç®¡ç†æŠ€æœ¯é€‰å‹å»ºè®®


**æ ¹æ®é¡¹ç›®è§„æ¨¡é€‰æ‹©æ–¹æ¡ˆ**ï¼š

```
å°å‹é¡¹ç›®ï¼ˆ1-5ä¸ªæœåŠ¡ï¼‰ï¼š
æ–¹æ¡ˆï¼šSpring Boot Profile + é…ç½®æ–‡ä»¶
ä¼˜åŠ¿ï¼šç®€å•ã€æ˜“ç”¨ã€é›¶æˆæœ¬
å®ç°ï¼šapplication-{profile}.properties

ä¸­å‹é¡¹ç›®ï¼ˆ5-20ä¸ªæœåŠ¡ï¼‰ï¼š
æ–¹æ¡ˆï¼šSpring Cloud Config + Git
ä¼˜åŠ¿ï¼šé›†ä¸­ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ã€çƒ­åŠ è½½
å®ç°ï¼šConfig Server + Config Client

å¤§å‹é¡¹ç›®ï¼ˆ20+ä¸ªæœåŠ¡ï¼‰ï¼š
æ–¹æ¡ˆï¼šApolloæˆ–Nacosé…ç½®ä¸­å¿ƒ
ä¼˜åŠ¿ï¼šå¯è§†åŒ–ç•Œé¢ã€ç°åº¦å‘å¸ƒã€æƒé™æ§åˆ¶
å®ç°ï¼šç‹¬ç«‹çš„é…ç½®ä¸­å¿ƒæœåŠ¡

ä¼ä¸šçº§é¡¹ç›®ï¼ˆè·¨äº‘/å¤šæ•°æ®ä¸­å¿ƒï¼‰ï¼š
æ–¹æ¡ˆï¼šé…ç½®ä¸­å¿ƒ + å¯†é’¥ç®¡ç†æœåŠ¡(KMS)
ä¼˜åŠ¿ï¼šæœ€é«˜å®‰å…¨æ€§ã€å®¡è®¡åˆè§„ã€å¤šäº‘æ”¯æŒ
å®ç°ï¼šApollo + AWS KMS / HashiCorp Vault
```

### 10.4 å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ


**é—®é¢˜ä¸€ï¼šé…ç½®ä¸ç”Ÿæ•ˆ**

```
é—®é¢˜ç°è±¡ï¼š
ä¿®æ”¹äº†application-prod.propertiesï¼Œä½†é…ç½®æ²¡ç”Ÿæ•ˆ

æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥Profileæ˜¯å¦æ¿€æ´»
   âœ… ç¡®è®¤å¯åŠ¨å‚æ•°ï¼š--spring.profiles.active=prod

2. æ£€æŸ¥é…ç½®æ–‡ä»¶ä½ç½®
   âœ… Configä¼˜å…ˆçº§ï¼šjaråŒ…å¤– > jaråŒ…å†…

3. æ£€æŸ¥é…ç½®é”®åæ˜¯å¦æ­£ç¡®
   âœ… åŒºåˆ†å¤§å°å†™ï¼šserver.Port â‰  server.port

4. æ£€æŸ¥æ˜¯å¦éœ€è¦é‡å¯
   âœ… éƒ¨åˆ†é…ç½®éœ€è¦é‡å¯ï¼šserver.port, datasource.url
```

**é—®é¢˜äºŒï¼šç¯å¢ƒå˜é‡è¯»å–ä¸åˆ°**

```
é—®é¢˜ç°è±¡ï¼š
${DB_PASSWORD}è¯»å–ä¸ºç©º

è§£å†³æ–¹æ¡ˆï¼š
1. ç¡®è®¤ç¯å¢ƒå˜é‡å·²è®¾ç½®
   echo $DB_PASSWORD  # Linux/Mac
   echo %DB_PASSWORD% # Windows

2. è®¾ç½®é»˜è®¤å€¼
   spring.datasource.password=${DB_PASSWORD:defaultPassword}

3. ä½¿ç”¨@Valueæ³¨è§£æ£€æŸ¥
   @Value("${DB_PASSWORD}")
   private String password;
   // å¦‚æœè¯»ä¸åˆ°ä¼šå¯åŠ¨æŠ¥é”™ï¼Œæ–¹ä¾¿æ’æŸ¥
```

**é—®é¢˜ä¸‰ï¼šé…ç½®çƒ­åŠ è½½å¤±æ•ˆ**

```
é—®é¢˜ç°è±¡ï¼š
è°ƒç”¨/actuator/refreshåé…ç½®æ²¡æ›´æ–°

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥@RefreshScopeæ³¨è§£
   âœ… éœ€è¦åˆ·æ–°çš„Beanè¦åŠ @RefreshScope

2. æ£€æŸ¥actuatorç«¯ç‚¹æ˜¯å¦å¼€å¯
   management.endpoints.web.exposure.include=refresh

3. æ£€æŸ¥é…ç½®æ˜¯å¦çœŸçš„å˜äº†
   âœ… Config Serverè¦å…ˆæ‹‰å–æœ€æ–°é…ç½®

4. éƒ¨åˆ†é…ç½®ä¸æ”¯æŒçƒ­åŠ è½½
   âŒ server.portã€datasource.urlç­‰éœ€è¦é‡å¯
```

### 10.5 æ ¸å¿ƒè®°å¿†å£è¯€


```
ğŸ“ é…ç½®ç®¡ç†è®°å¿†å£è¯€ï¼š

ä»£ç é…ç½®è¦åˆ†ç¦»ï¼Œä¸€å¥—ä»£ç èµ°å¤©ä¸‹
å¼€å‘æµ‹è¯•å’Œç”Ÿäº§ï¼Œé…ç½®ä¸åŒéœ€éš”ç¦»

æ•æ„Ÿä¿¡æ¯è¦åŠ å¯†ï¼Œç¯å¢ƒå˜é‡æ¥æ³¨å…¥
é…ç½®æ–‡ä»¶åˆ«ä¹±ä¼ ï¼ŒGitä»“åº“è¦å¿½ç•¥

Profileæ¥åˆ‡ç¯å¢ƒï¼Œå¯åŠ¨å‚æ•°æœ€ä¼˜å…ˆ
çƒ­åŠ è½½è¦åˆ·æ–°ï¼ŒRefreshScopeåˆ«å¿˜è®°

é…ç½®ä¸­å¿ƒé›†ä¸­ç®¡ï¼Œç‰ˆæœ¬ç®¡ç†å¾ˆé‡è¦
ç°åº¦å‘å¸ƒé™é£é™©ï¼Œç›‘æ§å‘Šè­¦è¦è·Ÿä¸Š
```

**é…ç½®ç®¡ç†å·¥ä½œæµæ€»ç»“**ï¼š

```
æ—¥å¸¸å¼€å‘æµç¨‹ï¼š
1. æœ¬åœ°å¼€å‘ â†’ ä½¿ç”¨devé…ç½®
2. æäº¤ä»£ç  â†’ æ•æ„Ÿé…ç½®ä¸æäº¤
3. æµ‹è¯•éªŒè¯ â†’ ä½¿ç”¨testé…ç½®
4. ç”Ÿäº§å‘å¸ƒ â†’ ä½¿ç”¨prodé…ç½®ï¼ˆç¯å¢ƒå˜é‡ï¼‰
5. é…ç½®å˜æ›´ â†’ Gitè®°å½• + ç°åº¦å‘å¸ƒ
6. é—®é¢˜å›é€€ â†’ Gitå›é€€åˆ°ä¸Šä¸€ç‰ˆæœ¬

å…³é”®åŸåˆ™ï¼š
âœ¨ é…ç½®å¤–éƒ¨åŒ–ï¼šä¸è¦ç¡¬ç¼–ç 
âœ¨ ç¯å¢ƒéš”ç¦»ï¼šå¼€å‘æµ‹è¯•ç”Ÿäº§åˆ†ç¦»
âœ¨ å®‰å…¨ç¬¬ä¸€ï¼šæ•æ„Ÿä¿¡æ¯åŠ å¯†
âœ¨ ç‰ˆæœ¬ç®¡ç†ï¼šGitè¿½è¸ªå˜æ›´
âœ¨ ç°åº¦å‘å¸ƒï¼šé™ä½å˜æ›´é£é™©
```

---

## ğŸ“ å­¦ä¹ å»ºè®®


**å¾ªåºæ¸è¿›çš„å­¦ä¹ è·¯å¾„**ï¼š

```
ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®è·µ
âœ… æŒæ¡application-{profile}.propertiesçš„ä½¿ç”¨
âœ… ç†è§£@Profileæ³¨è§£çš„ä½œç”¨
âœ… å­¦ä¼šä½¿ç”¨ç¯å¢ƒå˜é‡

ç¬¬äºŒé˜¶æ®µï¼šè¿›é˜¶æŠ€èƒ½
âœ… é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–
âœ… Jasyptæ•æ„Ÿä¿¡æ¯åŠ å¯†
âœ… @RefreshScopeçƒ­åŠ è½½

ç¬¬ä¸‰é˜¶æ®µï¼šä¼ä¸šå®æˆ˜
âœ… Spring Cloud Configé…ç½®ä¸­å¿ƒ
âœ… Apollo/Nacosçš„ä½¿ç”¨
âœ… é…ç½®ç°åº¦å‘å¸ƒ

ç¬¬å››é˜¶æ®µï¼šæ¶æ„ä¼˜åŒ–
âœ… é…ç½®ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
âœ… å¤šç¯å¢ƒé…ç½®æ–¹æ¡ˆè®¾è®¡
âœ… é…ç½®å®‰å…¨åˆè§„å®è·µ
```

**å®æˆ˜ç»ƒä¹ å»ºè®®**ï¼š

```
ç»ƒä¹ 1ï¼šæ­å»ºå¤šç¯å¢ƒé…ç½®
1. åˆ›å»ºdevã€testã€prodä¸‰ä¸ªé…ç½®æ–‡ä»¶
2. é…ç½®ä¸åŒçš„æ•°æ®åº“è¿æ¥
3. é€šè¿‡Profileåˆ‡æ¢ç¯å¢ƒ

ç»ƒä¹ 2ï¼šå®ç°é…ç½®åŠ å¯†
1. ä½¿ç”¨JasyptåŠ å¯†æ•°æ®åº“å¯†ç 
2. é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥åŠ å¯†å¯†é’¥
3. éªŒè¯è§£å¯†åèƒ½æ­£å¸¸è¿æ¥æ•°æ®åº“

ç»ƒä¹ 3ï¼šæ­å»ºConfig Server
1. åˆ›å»ºGitä»“åº“å­˜æ”¾é…ç½®
2. æ­å»ºConfig ServeræœåŠ¡
3. åº”ç”¨æ¥å…¥Config Server
4. æµ‹è¯•é…ç½®çƒ­åŠ è½½

ç»ƒä¹ 4ï¼šé…ç½®ç°åº¦å‘å¸ƒ
1. ä½¿ç”¨Apolloé…ç½®ä¸­å¿ƒ
2. é…ç½®ç°åº¦å‘å¸ƒè§„åˆ™
3. è§‚å¯Ÿéƒ¨åˆ†æœåŠ¡å™¨é…ç½®å˜æ›´
4. ç»ƒä¹ é…ç½®å›é€€æ“ä½œ
```

---

**æ­å–œä½ å®ŒæˆSSMæ¡†æ¶é…ç½®ç®¡ç†çš„å­¦ä¹ ï¼** ğŸ‰

è®°ä½ï¼šé…ç½®ç®¡ç†ä¸ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯å·¥ç¨‹å®è·µé—®é¢˜ã€‚å¥½çš„é…ç½®ç®¡ç†èƒ½è®©é¡¹ç›®è¿ç»´æ›´è½»æ¾ï¼Œçº¿ä¸Šé—®é¢˜æ›´å®¹æ˜“æ’æŸ¥ï¼Œç³»ç»Ÿæ›´åŠ å®‰å…¨å¯é ã€‚ç»§ç»­åŠ æ²¹ï¼ğŸ’ª