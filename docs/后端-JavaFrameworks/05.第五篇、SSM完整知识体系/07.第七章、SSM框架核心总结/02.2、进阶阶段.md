---
title: 2ã€è¿›é˜¶é˜¶æ®µ
---
## ğŸ“š ç›®å½•

1. [Spring AOPåˆ‡é¢ç¼–ç¨‹](#1-Spring-AOPåˆ‡é¢ç¼–ç¨‹)
2. [Springäº‹åŠ¡ç®¡ç†](#2-Springäº‹åŠ¡ç®¡ç†)
3. [SpringMVCé«˜çº§ç‰¹æ€§](#3-SpringMVCé«˜çº§ç‰¹æ€§)
4. [MyBatisåŠ¨æ€SQLä¸ç¼“å­˜](#4-MyBatisåŠ¨æ€SQLä¸ç¼“å­˜)
5. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#5-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Spring AOPåˆ‡é¢ç¼–ç¨‹


### 1.1 ä»€ä¹ˆæ˜¯AOP - é€šä¿—ç†è§£


**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š
æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªé¤å…è€æ¿ï¼Œæ¯ä¸ªæœåŠ¡å‘˜ä¸Šèœæ—¶éƒ½éœ€è¦ï¼š
- è®°å½•ä¸Šèœæ—¶é—´ï¼ˆæ—¥å¿—ï¼‰
- æ£€æŸ¥èœå“æ¸©åº¦ï¼ˆæ£€æŸ¥ï¼‰
- ç»Ÿè®¡ä¸Šèœæ¬¡æ•°ï¼ˆç»Ÿè®¡ï¼‰

ä¼ ç»Ÿåšæ³•æ˜¯è®©æ¯ä¸ªæœåŠ¡å‘˜éƒ½è®°ä½è¿™äº›æ­¥éª¤ï¼Œä½†è¿™æ ·å¾ˆéº»çƒ¦ã€‚æ›´èªæ˜çš„åšæ³•æ˜¯ï¼š**åœ¨å¨æˆ¿å‡ºå£è£…ä¸€ä¸ªæ™ºèƒ½é—¨**ï¼Œæ‰€æœ‰èœç»è¿‡è¿™ä¸ªé—¨æ—¶è‡ªåŠ¨å®Œæˆè¿™äº›å·¥ä½œã€‚

AOPå°±æ˜¯è¿™ä¸ª"æ™ºèƒ½é—¨"çš„æ¦‚å¿µï¼

**AOPæ ¸å¿ƒæ€æƒ³**ï¼š
```
ä¼ ç»Ÿç¼–ç¨‹ï¼ˆçºµå‘ï¼‰ï¼š           AOPç¼–ç¨‹ï¼ˆæ¨ªå‘ï¼‰ï¼š
    
ä¸šåŠ¡A â†’ æ—¥å¿— â†’ å®‰å…¨          ä¸šåŠ¡A   ä¸šåŠ¡B   ä¸šåŠ¡C
ä¸šåŠ¡B â†’ æ—¥å¿— â†’ å®‰å…¨            â†“       â†“       â†“
ä¸šåŠ¡C â†’ æ—¥å¿— â†’ å®‰å…¨          ã€æ—¥å¿—åˆ‡é¢ã€‘ç»Ÿä¸€å¤„ç†
                            ã€å®‰å…¨åˆ‡é¢ã€‘ç»Ÿä¸€å¤„ç†
æ¯ä¸ªä¸šåŠ¡éƒ½å†™ä¸€é              ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„ç”Ÿæ•ˆ
```

> **AOPå®šä¹‰**ï¼šAspect Oriented Programmingï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰
> 
> ç®€å•è¯´å°±æ˜¯ï¼šæŠŠé‡å¤çš„ã€ä¸ä¸šåŠ¡æ— å…³çš„ä»£ç ï¼ˆå¦‚æ—¥å¿—ã€æƒé™æ£€æŸ¥ï¼‰æŠ½å‡ºæ¥ï¼Œç»Ÿä¸€ç®¡ç†ï¼Œéœ€è¦æ—¶è‡ªåŠ¨"æ’å…¥"åˆ°ä¸šåŠ¡ä»£ç ä¸­

### 1.2 AOPæ ¸å¿ƒæ¦‚å¿µ - è¯´äººè¯ç‰ˆ


**äº”ä¸ªæ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”**ï¼š

| æ¦‚å¿µæœ¯è¯­ | ç”Ÿæ´»ç±»æ¯” | å®é™…å«ä¹‰ | ä»£ç ä½“ç° |
|---------|---------|---------|---------|
| **åˆ‡é¢ Aspect** | æ™ºèƒ½é—¨ç³»ç»Ÿ | åŠŸèƒ½æ¨¡å—çš„é›†åˆ | ä¸€ä¸ªç±» `@Aspect` |
| **è¿æ¥ç‚¹ JoinPoint** | æ¯ä¸ªç»è¿‡çš„èœ | å¯ä»¥è¢«æ‹¦æˆªçš„ç‚¹ | æ¯ä¸ªæ–¹æ³•è°ƒç”¨ |
| **åˆ‡å…¥ç‚¹ Pointcut** | åªæ‹¦æˆªçƒ­èœ | å®é™…æ‹¦æˆªçš„è§„åˆ™ | `@Pointcut("è§„åˆ™")` |
| **é€šçŸ¥ Advice** | æ£€æŸ¥æ¸©åº¦åŠ¨ä½œ | æ‹¦æˆªååšä»€ä¹ˆ | å…·ä½“æ–¹æ³• `@Before` |
| **ç›®æ ‡å¯¹è±¡ Target** | èœå“æœ¬èº« | è¢«å¢å¼ºçš„å¯¹è±¡ | ä¸šåŠ¡ç±» |

**é€šçŸ¥ç±»å‹è¯¦è§£**ï¼š

```
æ–¹æ³•æ‰§è¡Œæ—¶é—´è½´ï¼š
    
    å¼€å§‹ â”€â”€â”€â”€â”€â”€â†’ æ‰§è¡Œæ–¹æ³• â”€â”€â”€â”€â”€â”€â†’ ç»“æŸ
     â†‘                           â†‘
  @Before                     @After
  å‰ç½®é€šçŸ¥                    åç½®é€šçŸ¥
  
     å¼€å§‹ â”€â”€â”€â”€â”€â”€â†’ æ‰§è¡Œæ–¹æ³• â”€â”¬â†’ æ­£å¸¸ç»“æŸ
                         â””â†’ å¼‚å¸¸ç»“æŸ
                         â†‘          â†‘
                  @AfterReturning  @AfterThrowing
                  è¿”å›åé€šçŸ¥        å¼‚å¸¸é€šçŸ¥
                  
     â”€â”€â”€â”€â”€â”€â”€â†’ @Around ç¯ç»•é€šçŸ¥ â†â”€â”€â”€â”€â”€â”€â”€â”€
     (å¯ä»¥æ§åˆ¶æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼Œæœ€çµæ´»)
```

### 1.3 AOPå®æˆ˜æ¡ˆä¾‹ - æ—¥å¿—è®°å½•


**åœºæ™¯**ï¼šç»™æ‰€æœ‰Serviceæ–¹æ³•è‡ªåŠ¨æ·»åŠ æ—¥å¿—

```java
// ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåˆ‡é¢ç±»
@Aspect              // æ ‡è®°è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢
@Component           // è®©Springç®¡ç†
public class LogAspect {
    
    // ç¬¬äºŒæ­¥ï¼šå®šä¹‰åˆ‡å…¥ç‚¹ï¼ˆæ‹¦æˆªå“ªäº›æ–¹æ³•ï¼‰
    @Pointcut("execution(* com.example.service.*.*(..))")
    //        â†‘           â†‘      â†‘         â†‘   â†‘  â†‘
    //       å›ºå®šå†™æ³•   è¿”å›å€¼  åŒ…å      ç±»å æ–¹æ³• å‚æ•°
    //                  *ä»£è¡¨ä»»æ„
    public void serviceLayer() {}
    
    // ç¬¬ä¸‰æ­¥ï¼šå®šä¹‰é€šçŸ¥ï¼ˆæ‹¦æˆªååšä»€ä¹ˆï¼‰
    @Before("serviceLayer()")
    public void logBefore(JoinPoint jp) {
        String method = jp.getSignature().getName();
        System.out.println("å¼€å§‹æ‰§è¡Œæ–¹æ³•ï¼š" + method);
    }
    
    @AfterReturning(value = "serviceLayer()", returning = "result")
    public void logAfter(Object result) {
        System.out.println("æ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œè¿”å›ï¼š" + result);
    }
}
```

**åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è§„åˆ™**ï¼š

```
execution(ä¿®é¥°ç¬¦? è¿”å›å€¼ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°) å¼‚å¸¸?)

å¸¸ç”¨å†™æ³•ï¼š
execution(* com.example.service.*.*(..))
          â†‘        â†‘           â†‘  â†‘  â†‘
        ä»»æ„è¿”å›  æŒ‡å®šåŒ…      ä»»æ„ç±» ä»»æ„æ–¹æ³• ä»»æ„å‚æ•°

execution(public * com..service.*.save*(..))
          â†‘      â†‘   â†‘â†‘        â†‘    â†‘
        public ä»»æ„  åŒ…å«å­åŒ…  ä»»æ„ç±» saveå¼€å¤´
        
ç¬¦å·è¯´æ˜ï¼š
*  ä»£è¡¨ä»»æ„
.. ä»£è¡¨ä»»æ„å±‚çº§/ä»»æ„å‚æ•°
```

### 1.4 ç¯ç»•é€šçŸ¥çš„å¼ºå¤§åŠŸèƒ½


**ç¯ç»•é€šçŸ¥ = æœ€çµæ´»çš„é€šçŸ¥ç±»å‹**

```java
@Around("serviceLayer()")
public Object monitor(ProceedingJoinPoint pjp) throws Throwable {
    
    // 1. æ–¹æ³•æ‰§è¡Œå‰
    long start = System.currentTimeMillis();
    String method = pjp.getSignature().getName();
    
    Object result = null;
    try {
        // 2. æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼ˆé‡è¦ï¼ï¼‰
        result = pjp.proceed();
        
        // 3. æ–¹æ³•æ‰§è¡Œåï¼ˆæˆåŠŸï¼‰
        long time = System.currentTimeMillis() - start;
        System.out.println(method + " æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶ï¼š" + time + "ms");
        
    } catch (Exception e) {
        // 4. æ–¹æ³•æ‰§è¡Œåï¼ˆå¼‚å¸¸ï¼‰
        System.out.println(method + " æ‰§è¡Œå¼‚å¸¸ï¼š" + e.getMessage());
        throw e;  // ç»§ç»­æŠ›å‡ºå¼‚å¸¸
    }
    
    return result;  // è¿”å›ç»“æœ
}
```

**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**ï¼š

| é€šçŸ¥ç±»å‹ | é€‚ç”¨åœºæ™¯ | å…¸å‹åº”ç”¨ |
|---------|---------|---------|
| `@Before` | æ‰§è¡Œå‰æ£€æŸ¥ | æƒé™éªŒè¯ã€å‚æ•°æ ¡éªŒ |
| `@After` | æ‰§è¡Œåæ¸…ç† | å…³é—­èµ„æºã€æ¸…ç†ç¼“å­˜ |
| `@AfterReturning` | æˆåŠŸåå¤„ç† | è®°å½•è¿”å›å€¼ã€ç»“æœå¤„ç† |
| `@AfterThrowing` | å¼‚å¸¸åå¤„ç† | å¼‚å¸¸æ—¥å¿—ã€é”™è¯¯é€šçŸ¥ |
| `@Around` | å®Œå…¨æ§åˆ¶ | æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡æ§åˆ¶ |

---

## 2. ğŸ’° Springäº‹åŠ¡ç®¡ç†


### 2.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡ - ç”Ÿæ´»åŒ–ç†è§£


**é“¶è¡Œè½¬è´¦çš„ä¾‹å­**ï¼š
å°æ˜ç»™å°çº¢è½¬è´¦100å…ƒï¼Œéœ€è¦ä¸¤æ­¥ï¼š
1. å°æ˜è´¦æˆ· -100å…ƒ
2. å°çº¢è´¦æˆ· +100å…ƒ

å¦‚æœç¬¬1æ­¥æˆåŠŸï¼Œç¬¬2æ­¥å¤±è´¥ï¼ˆç³»ç»Ÿå´©æºƒï¼‰ï¼Œé‚£å°æ˜çš„é’±å°±ä¸¢äº†ï¼

**äº‹åŠ¡å°±æ˜¯ä¿è¯ï¼šè¦ä¹ˆä¸¤æ­¥éƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼ˆå›æ»šï¼‰ï¼Œä¸ä¼šå‡ºç°ä¸­é—´çŠ¶æ€**

```
æ²¡æœ‰äº‹åŠ¡çš„æƒ…å†µï¼š
å°æ˜: 1000 â†’ 900 âœ“
ç³»ç»Ÿå´©æºƒï¼ğŸ’¥
å°çº¢: 500 â†’ 500 âœ—   (é’±ä¸¢äº†ï¼)

æœ‰äº‹åŠ¡çš„æƒ…å†µï¼š
å°æ˜: 1000 â†’ 900 âœ“
ç³»ç»Ÿå´©æºƒï¼ğŸ’¥
æ£€æµ‹åˆ°å¼‚å¸¸ï¼Œå›æ»šï¼
å°æ˜: 900 â†’ 1000 âœ“   (æ¢å¤äº†)
å°çº¢: 500 â†’ 500 âœ“   (æ²¡å½±å“)
```

### 2.2 äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ - ACID


**è®°å¿†å£è¯€**ï¼š`åŸå­ä¸€è‡´éš”ç¦»æŒä¹…` = ACID

| ç‰¹æ€§ | è‹±æ–‡ | é€šä¿—ç†è§£ | ç”Ÿæ´»ç±»æ¯” |
|-----|------|---------|---------|
| **åŸå­æ€§** | Atomicity | å…¨åšæˆ–å…¨ä¸åš | è½¬è´¦è¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥ï¼Œä¸èƒ½ä¸€åŠ |
| **ä¸€è‡´æ€§** | Consistency | æ•°æ®åˆæ³•æœ‰æ•ˆ | è½¬è´¦å‰åæ€»é‡‘é¢ä¸å˜ |
| **éš”ç¦»æ€§** | Isolation | äº’ä¸å½±å“ | ä½ è½¬è´¦æ—¶åˆ«äººçœ‹ä¸åˆ°ä¸­é—´çŠ¶æ€ |
| **æŒä¹…æ€§** | Durability | æ°¸ä¹…ä¿å­˜ | è½¬è´¦æˆåŠŸåæ–­ç”µä¹Ÿä¸ä¼šä¸¢å¤± |

### 2.3 Springäº‹åŠ¡ç®¡ç† - ç®€å•ä½¿ç”¨


**æ–¹å¼ä¸€ï¼šæ³¨è§£æ–¹å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰** â­â­â­

```java
@Service
public class AccountService {
    
    @Autowired
    private AccountMapper accountMapper;
    
    // åªéœ€åŠ ä¸€ä¸ªæ³¨è§£ï¼
    @Transactional
    public void transfer(String from, String to, int money) {
        // 1. æ‰£é’±
        accountMapper.decrease(from, money);
        
        // å‡å¦‚è¿™é‡Œå‡ºé”™
        int i = 1/0;  // ä¼šè‡ªåŠ¨å›æ»šï¼
        
        // 2. åŠ é’±
        accountMapper.increase(to, money);
    }
}
```

**é…ç½®æ­¥éª¤**ï¼š

```java
// 1. é…ç½®ç±»ä¸Šå¼€å¯äº‹åŠ¡
@Configuration
@EnableTransactionManagement  // å¼€å¯äº‹åŠ¡æ”¯æŒ
public class AppConfig {
    
    // 2. é…ç½®äº‹åŠ¡ç®¡ç†å™¨
    @Bean
    public DataSourceTransactionManager transactionManager(DataSource ds) {
        return new DataSourceTransactionManager(ds);
    }
}
```

### 2.4 äº‹åŠ¡å±æ€§è¯¦è§£


**ä¼ æ’­è¡Œä¸º - äº‹åŠ¡ä¹‹é—´çš„å…³ç³»**

```
åœºæ™¯ï¼šæ–¹æ³•Aè°ƒç”¨æ–¹æ³•Bï¼Œéƒ½æœ‰@Transactional

Aæ–¹æ³•ï¼ˆæœ‰äº‹åŠ¡ï¼‰
   â†“
   è°ƒç”¨
   â†“
Bæ–¹æ³•ï¼ˆæœ‰äº‹åŠ¡ï¼‰
   â†“
   æ€ä¹ˆå¤„ç†ï¼Ÿ
```

| ä¼ æ’­è¡Œä¸º | è¯´æ˜ | é€šä¿—ç†è§£ |
|---------|------|---------|
| `REQUIRED` â˜…â˜…â˜… | æœ‰å°±ç”¨ï¼Œæ²¡æœ‰å°±æ–°å»º | é»˜è®¤å€¼ï¼Œæœ€å¸¸ç”¨ |
| `REQUIRES_NEW` | æ€»æ˜¯æ–°å»ºäº‹åŠ¡ | Bå‡ºé”™ä¸å½±å“A |
| `SUPPORTS` | æœ‰å°±ç”¨ï¼Œæ²¡æœ‰å°±ä¸ç”¨ | éšå¤§æµ |
| `NESTED` | åµŒå¥—äº‹åŠ¡ | Aå›æ»šBä¹Ÿå›æ»šï¼ŒBå›æ»šAä¸å›æ»š |

**å®é™…ä½¿ç”¨**ï¼š

```java
// å¸¸è§åœºæ™¯ï¼šè®°å½•æ—¥å¿—ä¸å½±å“ä¸»ä¸šåŠ¡
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void saveLog(String content) {
    logMapper.insert(content);
    // æ—¥å¿—å¤±è´¥ä¸å½±å“ä¸»ä¸šåŠ¡
}

// ä¸»ä¸šåŠ¡æ–¹æ³•
@Transactional
public void createOrder(Order order) {
    orderMapper.insert(order);
    saveLog("åˆ›å»ºè®¢å•ï¼š" + order.getId());  // ç‹¬ç«‹äº‹åŠ¡
}
```

**éš”ç¦»çº§åˆ« - è§£å†³å¹¶å‘é—®é¢˜**

| éš”ç¦»çº§åˆ« | è„è¯» | ä¸å¯é‡å¤è¯» | å¹»è¯» | æ€§èƒ½ |
|---------|-----|-----------|------|------|
| `READ_UNCOMMITTED` | âœ— | âœ— | âœ— | æœ€é«˜ |
| `READ_COMMITTED` | âœ“ | âœ— | âœ— | è¾ƒé«˜ |
| `REPEATABLE_READ` â˜… | âœ“ | âœ“ | âœ— | è¾ƒä½ |
| `SERIALIZABLE` | âœ“ | âœ“ | âœ“ | æœ€ä½ |

```java
// MySQLé»˜è®¤ï¼šREPEATABLE_READ
@Transactional(isolation = Isolation.REPEATABLE_READ)
public void query() {
    // å¤šæ¬¡æŸ¥è¯¢ç»“æœä¸€è‡´
}
```

### 2.5 äº‹åŠ¡å¤±æ•ˆçš„å¸¸è§å‘ âš ï¸


**åœºæ™¯ä¸€ï¼šæ–¹æ³•ä¸æ˜¯public**

```java
// âœ— é”™è¯¯ï¼šäº‹åŠ¡ä¸ç”Ÿæ•ˆ
@Transactional
private void transfer() { }

// âœ“ æ­£ç¡®ï¼šå¿…é¡»æ˜¯public
@Transactional
public void transfer() { }
```

**åœºæ™¯äºŒï¼šè‡ªå·±è°ƒç”¨è‡ªå·±**

```java
@Service
public class UserService {
    
    public void method1() {
        this.method2();  // âœ— äº‹åŠ¡å¤±æ•ˆï¼
    }
    
    @Transactional
    public void method2() {
        // äº‹åŠ¡ä¸ç”Ÿæ•ˆ
    }
}
```

**è§£å†³æ–¹æ³•**ï¼š

```java
// æ–¹æ³•1ï¼šæ³¨å…¥è‡ªå·±
@Autowired
private UserService userService;

public void method1() {
    userService.method2();  // âœ“ äº‹åŠ¡ç”Ÿæ•ˆ
}

// æ–¹æ³•2ï¼šéƒ½åŠ æ³¨è§£
@Transactional
public void method1() {
    this.method2();  // âœ“ äº‹åŠ¡ç”Ÿæ•ˆ
}
```

---

## 3. ğŸš€ SpringMVCé«˜çº§ç‰¹æ€§


### 3.1 æ‹¦æˆªå™¨ - è¯·æ±‚çš„å®ˆé—¨å‘˜


**æ‹¦æˆªå™¨ vs è¿‡æ»¤å™¨ å¯¹æ¯”**ï¼š

```
è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼š              æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ï¼š
    
å®¢æˆ·ç«¯                          å®¢æˆ·ç«¯
  â†“                              â†“
ã€è¿‡æ»¤å™¨ã€‘                      DispatcherServlet
  â†“                              â†“
DispatcherServlet              ã€æ‹¦æˆªå™¨1ã€‘
  â†“                              â†“
Controller                     ã€æ‹¦æˆªå™¨2ã€‘
                                 â†“
                              Controller

ç‰¹ç‚¹å¯¹æ¯”ï¼š
è¿‡æ»¤å™¨ï¼šServletè§„èŒƒï¼Œæ‹¦æˆªæ‰€æœ‰è¯·æ±‚
æ‹¦æˆªå™¨ï¼šSpringè§„èŒƒï¼Œåªæ‹¦æˆªController
```

**æ‹¦æˆªå™¨å®ç°**ï¼š

```java
// 1. åˆ›å»ºæ‹¦æˆªå™¨
public class LoginInterceptor implements HandlerInterceptor {
    
    // æ–¹æ³•æ‰§è¡Œå‰
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) {
        // æ£€æŸ¥æ˜¯å¦ç™»å½•
        HttpSession session = request.getSession();
        if (session.getAttribute("user") != null) {
            return true;   // æ”¾è¡Œ
        }
        
        response.sendRedirect("/login");
        return false;  // æ‹¦æˆª
    }
    
    // æ–¹æ³•æ‰§è¡Œåï¼ˆè§†å›¾æ¸²æŸ“å‰ï¼‰
    @Override
    public void postHandle(HttpServletRequest request,
                          HttpServletResponse response,
                          Object handler,
                          ModelAndView mv) {
        // å¯ä»¥ä¿®æ”¹ModelAndView
        mv.addObject("serverTime", new Date());
    }
    
    // è¯·æ±‚å®Œæˆå
    @Override
    public void afterCompletion(HttpServletRequest request,
                               HttpServletResponse response,
                               Object handler,
                               Exception ex) {
        // æ¸…ç†èµ„æºã€è®°å½•æ—¥å¿—
        System.out.println("è¯·æ±‚å¤„ç†å®Œæˆ");
    }
}

// 2. æ³¨å†Œæ‹¦æˆªå™¨
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LoginInterceptor())
                .addPathPatterns("/**")          // æ‹¦æˆªæ‰€æœ‰
                .excludePathPatterns("/login",   // æ’é™¤ç™»å½•
                                    "/static/**"); // æ’é™¤é™æ€èµ„æº
    }
}
```

**æ‰§è¡Œæµç¨‹å›¾**ï¼š

```
è¯·æ±‚è¿›å…¥
   â†“
æ‹¦æˆªå™¨1.preHandle
   â†“ (trueç»§ç»­ï¼Œfalseæ‹¦æˆª)
æ‹¦æˆªå™¨2.preHandle
   â†“
Controller.method()
   â†“
æ‹¦æˆªå™¨2.postHandle
   â†“
æ‹¦æˆªå™¨1.postHandle
   â†“
æ¸²æŸ“è§†å›¾
   â†“
æ‹¦æˆªå™¨2.afterCompletion
   â†“
æ‹¦æˆªå™¨1.afterCompletion
   â†“
å“åº”è¿”å›
```

### 3.2 å¼‚å¸¸å¤„ç† - ç»Ÿä¸€é”™è¯¯ç®¡ç†


**å…¨å±€å¼‚å¸¸å¤„ç†å™¨**ï¼š

```java
@RestControllerAdvice  // å…¨å±€å¼‚å¸¸å¤„ç†
public class GlobalExceptionHandler {
    
    // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public Result handleBusiness(BusinessException e) {
        return Result.error(e.getMessage());
    }
    
    // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result handleValid(MethodArgumentNotValidException e) {
        String msg = e.getBindingResult().getFieldError().getDefaultMessage();
        return Result.error("å‚æ•°é”™è¯¯ï¼š" + msg);
    }
    
    // å¤„ç†å…¶ä»–æ‰€æœ‰å¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        e.printStackTrace();
        return Result.error("ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
    }
}
```

**å¼‚å¸¸å¤„ç†å±‚çº§**ï¼š

```
å¼‚å¸¸å‘ç”Ÿ
   â†“
1. æ–¹æ³•å†…try-catchå¤„ç†ï¼Ÿ
   â†“ å¦
2. Controllerå±‚å¤„ç†ï¼Ÿ
   â†“ å¦  
3. å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Ÿ
   â†“ å¦
4. æ¡†æ¶é»˜è®¤å¤„ç†ï¼ˆ500é”™è¯¯é¡µé¢ï¼‰
```

### 3.3 å‚æ•°æ ¡éªŒ - æ•°æ®åˆæ³•æ€§æ£€æŸ¥


**å¸¸ç”¨æ ¡éªŒæ³¨è§£**ï¼š

| æ³¨è§£ | ä½œç”¨ | ç¤ºä¾‹ |
|-----|------|-----|
| `@NotNull` | ä¸èƒ½ä¸ºnull | ä»»æ„å¯¹è±¡ |
| `@NotEmpty` | ä¸èƒ½ä¸ºç©º | å­—ç¬¦ä¸²ã€é›†åˆ |
| `@NotBlank` | ä¸èƒ½ä¸ºç©ºç™½ | å­—ç¬¦ä¸²ï¼ˆå»ç©ºæ ¼åä¸ä¸ºç©ºï¼‰|
| `@Min(value)` | æœ€å°å€¼ | å¹´é¾„ä¸å°äº18 |
| `@Max(value)` | æœ€å¤§å€¼ | å¹´é¾„ä¸è¶…è¿‡150 |
| `@Email` | é‚®ç®±æ ¼å¼ | xxx@xxx.com |
| `@Pattern(regexp)` | æ­£åˆ™åŒ¹é… | æ‰‹æœºå·æ ¼å¼ |

**å®æˆ˜ä½¿ç”¨**ï¼š

```java
// 1. å®ä½“ç±»æ·»åŠ æ ¡éªŒæ³¨è§£
public class User {
    
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Length(min = 2, max = 10, message = "ç”¨æˆ·åé•¿åº¦2-10")
    private String username;
    
    @NotNull(message = "å¹´é¾„ä¸èƒ½ä¸ºç©º")
    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18")
    @Max(value = 150, message = "å¹´é¾„ä¸èƒ½å¤§äº150")
    private Integer age;
    
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;
    
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;
}

// 2. Controlleræ¥æ”¶å‚æ•°åŠ @Validated
@PostMapping("/register")
public Result register(@Validated @RequestBody User user) {
    // å‚æ•°è‡ªåŠ¨æ ¡éªŒï¼Œä¸é€šè¿‡ä¼šæŠ›å¼‚å¸¸
    userService.save(user);
    return Result.success();
}
```

**åˆ†ç»„æ ¡éªŒ**ï¼š

```java
// å®šä¹‰æ ¡éªŒç»„
public interface AddGroup {}
public interface UpdateGroup {}

// å®ä½“ç±»æŒ‡å®šåˆ†ç»„
public class User {
    @NotNull(groups = UpdateGroup.class)  // æ›´æ–°æ—¶å¿…å¡«
    private Long id;
    
    @NotBlank(groups = {AddGroup.class, UpdateGroup.class})
    private String username;
}

// ä½¿ç”¨æ—¶æŒ‡å®šç»„
@PostMapping("/add")
public Result add(@Validated(AddGroup.class) @RequestBody User user) {
    // idå¯ä»¥ä¸ºç©º
}

@PutMapping("/update")  
public Result update(@Validated(UpdateGroup.class) @RequestBody User user) {
    // idå¿…é¡»æœ‰å€¼
}
```

---

## 4. ğŸ“Š MyBatisåŠ¨æ€SQLä¸ç¼“å­˜


### 4.1 åŠ¨æ€SQL - çµæ´»æ‹¼æ¥æŸ¥è¯¢


**ifæ ‡ç­¾ - æ¡ä»¶åˆ¤æ–­**

```xml
<!-- åœºæ™¯ï¼šæ ¹æ®æ¡ä»¶æŸ¥è¯¢ç”¨æˆ· -->
<select id="findUser" resultType="User">
    SELECT * FROM user
    WHERE 1=1
    <if test="username != null and username != ''">
        AND username LIKE CONCAT('%', #{username}, '%')
    </if>
    <if test="age != null">
        AND age = #{age}
    </if>
</select>
```

**whereæ ‡ç­¾ - æ™ºèƒ½æ·»åŠ WHERE**

```xml
<!-- è‡ªåŠ¨æ·»åŠ WHEREï¼Œè‡ªåŠ¨å»é™¤å¤šä½™çš„AND/OR -->
<select id="findUser" resultType="User">
    SELECT * FROM user
    <where>
        <if test="username != null">
            AND username = #{username}
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
    </where>
</select>

<!-- ç”Ÿæˆçš„SQLï¼š
     æœ‰æ¡ä»¶ï¼šSELECT * FROM user WHERE username = ? AND age = ?
     æ— æ¡ä»¶ï¼šSELECT * FROM user
-->
```

**foreachæ ‡ç­¾ - å¾ªç¯éå†**

```xml
<!-- åœºæ™¯ï¼šæ‰¹é‡åˆ é™¤ DELETE FROM user WHERE id IN (1,2,3) -->
<delete id="deleteBatch">
    DELETE FROM user WHERE id IN
    <foreach collection="ids" item="id" open="(" close=")" separator=",">
        #{id}
    </foreach>
</delete>

<!-- åœºæ™¯ï¼šæ‰¹é‡æ’å…¥ -->
<insert id="insertBatch">
    INSERT INTO user (username, age) VALUES
    <foreach collection="list" item="user" separator=",">
        (#{user.username}, #{user.age})
    </foreach>
</insert>
```

**choose-when-otherwise - å¤šæ¡ä»¶é€‰æ‹©**

```xml
<!-- ç±»ä¼¼Javaçš„switch-case -->
<select id="findUser" resultType="User">
    SELECT * FROM user
    <where>
        <choose>
            <when test="id != null">
                AND id = #{id}
            </when>
            <when test="username != null">
                AND username = #{username}
            </when>
            <otherwise>
                AND status = 1
            </otherwise>
        </choose>
    </where>
</select>
```

**setæ ‡ç­¾ - åŠ¨æ€æ›´æ–°**

```xml
<!-- åªæ›´æ–°æœ‰å€¼çš„å­—æ®µ -->
<update id="updateUser">
    UPDATE user
    <set>
        <if test="username != null">username = #{username},</if>
        <if test="age != null">age = #{age},</if>
        <if test="email != null">email = #{email},</if>
    </set>
    WHERE id = #{id}
</update>
```

### 4.2 MyBatisç¼“å­˜æœºåˆ¶


**ä¸¤çº§ç¼“å­˜ç»“æ„**ï¼š

```
æŸ¥è¯¢æµç¨‹ï¼š
    
1. æŸ¥è¯¢è¯·æ±‚
    â†“
2. äºŒçº§ç¼“å­˜ï¼ˆå…¨å±€ï¼‰
    â†“ æœªå‘½ä¸­
3. ä¸€çº§ç¼“å­˜ï¼ˆSqlSessionï¼‰
    â†“ æœªå‘½ä¸­
4. æŸ¥è¯¢æ•°æ®åº“
    â†“
5. å­˜å…¥ä¸€çº§ç¼“å­˜
    â†“
6. å­˜å…¥äºŒçº§ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
```

**ä¸€çº§ç¼“å­˜ï¼ˆé»˜è®¤å¼€å¯ï¼‰** â­

```java
// åŒä¸€ä¸ªSqlSessionå†…æœ‰æ•ˆ
SqlSession session = factory.openSession();

// ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥æ•°æ®åº“
User user1 = session.selectOne("findById", 1);

// ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼Œèµ°ç¼“å­˜ï¼ˆä¸æŸ¥æ•°æ®åº“ï¼‰
User user2 = session.selectOne("findById", 1);

System.out.println(user1 == user2);  // trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡

// ç¼“å­˜å¤±æ•ˆæƒ…å†µï¼š
session.update(...);    // å¢åˆ æ”¹æ“ä½œ
session.commit();       // æäº¤
session.clearCache();   // æ‰‹åŠ¨æ¸…é™¤
session.close();        // å…³é—­
```

**äºŒçº§ç¼“å­˜ï¼ˆéœ€æ‰‹åŠ¨å¼€å¯ï¼‰**

```xml
<!-- 1. å…¨å±€é…ç½®å¼€å¯ -->
<settings>
    <setting name="cacheEnabled" value="true"/>
</settings>

<!-- 2. Mapperæ–‡ä»¶ä¸­å¼€å¯ -->
<mapper namespace="com.example.UserMapper">
    <cache/>  <!-- å¼€å¯äºŒçº§ç¼“å­˜ -->
    
    <select id="findById" resultType="User" useCache="true">
        SELECT * FROM user WHERE id = #{id}
    </select>
</mapper>
```

```java
// 3. å®ä½“ç±»å®ç°Serializable
public class User implements Serializable {
    // ...
}

// è·¨SqlSessionæœ‰æ•ˆ
SqlSession session1 = factory.openSession();
User user1 = session1.selectOne("findById", 1);
session1.close();  // å…³é—­åæ•°æ®è¿›å…¥äºŒçº§ç¼“å­˜

SqlSession session2 = factory.openSession();
User user2 = session2.selectOne("findById", 1);  // èµ°äºŒçº§ç¼“å­˜
```

**ç¼“å­˜ä½¿ç”¨å»ºè®®**ï¼š

| åœºæ™¯ | ä¸€çº§ç¼“å­˜ | äºŒçº§ç¼“å­˜ |
|-----|---------|---------|
| **é€‚ç”¨** | çŸ­æš‚ä¼šè¯å†… | è·¨ä¼šè¯å…±äº«æ•°æ® |
| **ä¸é€‚ç”¨** | é•¿æ—¶é—´ä¼šè¯ | é¢‘ç¹æ›´æ–°çš„è¡¨ |
| **æ³¨æ„** | è‡ªåŠ¨å¼€å¯ | éœ€è€ƒè™‘å¹¶å‘é—®é¢˜ |

**ç¼“å­˜å¤±æ•ˆæœºåˆ¶**ï¼š

```
ä¸€çº§ç¼“å­˜å¤±æ•ˆï¼š
1. SqlSessionå…³é—­
2. æ‰§è¡Œå¢åˆ æ”¹
3. æ‰‹åŠ¨æ¸…é™¤

äºŒçº§ç¼“å­˜å¤±æ•ˆï¼š
1. æ‰§è¡Œå¢åˆ æ”¹ï¼ˆåŒnamespaceï¼‰
2. é…ç½®flushCache="true"
3. è°ƒç”¨clearCache()
```

---

## 5. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 5.1 Spring AOPæ ¸å¿ƒè¦ç‚¹


```
ğŸ¯ æ ¸å¿ƒç†è§£ï¼š
- AOP = æŠŠé‡å¤ä»£ç æŠ½å‡ºæ¥ï¼Œç»Ÿä¸€ç®¡ç†
- åˆ‡é¢ = åŠŸèƒ½æ¨¡å—ï¼ˆä¸€ä¸ªç±»ï¼‰
- åˆ‡å…¥ç‚¹ = æ‹¦æˆªè§„åˆ™ï¼ˆå“ªäº›æ–¹æ³•ï¼‰
- é€šçŸ¥ = å…·ä½“æ“ä½œï¼ˆåšä»€ä¹ˆï¼‰

â­ äº”ç§é€šçŸ¥ï¼š
@Before         â†’ æ–¹æ³•å‰æ‰§è¡Œ
@After          â†’ æ–¹æ³•åæ‰§è¡Œï¼ˆæ€»æ˜¯ï¼‰
@AfterReturning â†’ æˆåŠŸåæ‰§è¡Œ
@AfterThrowing  â†’ å¼‚å¸¸åæ‰§è¡Œ  
@Around         â†’ ç¯ç»•æ‰§è¡Œï¼ˆæœ€å¼ºï¼‰

ğŸ’¡ å…¸å‹åº”ç”¨ï¼š
æ—¥å¿—è®°å½•ã€æƒé™æ£€æŸ¥ã€æ€§èƒ½ç›‘æ§ã€äº‹åŠ¡æ§åˆ¶
```

### 5.2 Springäº‹åŠ¡æ ¸å¿ƒè¦ç‚¹


```
ğŸ¯ æ ¸å¿ƒç†è§£ï¼š
äº‹åŠ¡ = ä¿è¯æ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥

â­ ACIDç‰¹æ€§ï¼š
åŸå­æ€§ â†’ å…¨åšæˆ–å…¨ä¸åš
ä¸€è‡´æ€§ â†’ æ•°æ®åˆæ³•æœ‰æ•ˆ
éš”ç¦»æ€§ â†’ äº’ä¸å½±å“
æŒä¹…æ€§ â†’ æ°¸ä¹…ä¿å­˜

ğŸ’¡ ä½¿ç”¨è¦ç‚¹ï¼š
1. æ–¹æ³•å¿…é¡»æ˜¯public
2. é¿å…è‡ªå·±è°ƒç”¨è‡ªå·±
3. å¼‚å¸¸å¿…é¡»æŠ›å‡ºï¼ˆä¸èƒ½try-catchåƒæ‰ï¼‰
4. é»˜è®¤åªå›æ»šRuntimeException
```

### 5.3 SpringMVCé«˜çº§ç‰¹æ€§è¦ç‚¹


```
ğŸ¯ æ‹¦æˆªå™¨ï¼š
- å®ç°HandlerInterceptoræ¥å£
- preHandle â†’ æ‰§è¡Œå‰ï¼ˆè¿”å›falseæ‹¦æˆªï¼‰
- postHandle â†’ æ‰§è¡Œåï¼ˆå¯ä¿®æ”¹ModelAndViewï¼‰
- afterCompletion â†’ å®Œæˆåï¼ˆæ¸…ç†èµ„æºï¼‰

â­ å¼‚å¸¸å¤„ç†ï¼š
@RestControllerAdvice + @ExceptionHandler
ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼Œè¿”å›å‹å¥½æç¤º

ğŸ’¡ å‚æ•°æ ¡éªŒï¼š
@Validated + æ ¡éªŒæ³¨è§£ï¼ˆ@NotNullã€@Emailç­‰ï¼‰
è‡ªåŠ¨æ ¡éªŒå‚æ•°ï¼Œå‡å°‘ä»£ç é‡
```

### 5.4 MyBatisåŠ¨æ€SQLè¦ç‚¹


```
ğŸ¯ å¸¸ç”¨æ ‡ç­¾ï¼š
<if>         â†’ æ¡ä»¶åˆ¤æ–­
<where>      â†’ æ™ºèƒ½WHERE
<foreach>    â†’ å¾ªç¯éå†
<choose>     â†’ å¤šæ¡ä»¶é€‰æ‹©
<set>        â†’ åŠ¨æ€æ›´æ–°

â­ ä¸¤çº§ç¼“å­˜ï¼š
ä¸€çº§ç¼“å­˜ â†’ SqlSessionçº§åˆ«ï¼Œé»˜è®¤å¼€å¯
äºŒçº§ç¼“å­˜ â†’ Mapperçº§åˆ«ï¼Œéœ€æ‰‹åŠ¨å¼€å¯

ğŸ’¡ ä½¿ç”¨å»ºè®®ï¼š
ä¸€çº§ç¼“å­˜ï¼šé€‚åˆçŸ­æš‚ä¼šè¯
äºŒçº§ç¼“å­˜ï¼šé€‚åˆæŸ¥è¯¢å¤šã€æ›´æ–°å°‘çš„åœºæ™¯
```

### 5.5 å­¦ä¹ æ£€æŸ¥æ¸…å•


**Spring AOP**ï¼š
- [ ] ç†è§£AOPæ˜¯ä»€ä¹ˆï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜
- [ ] æŒæ¡äº”ç§é€šçŸ¥ç±»å‹çš„ä½¿ç”¨
- [ ] ä¼šå†™åˆ‡å…¥ç‚¹è¡¨è¾¾å¼
- [ ] èƒ½ç”¨@Aroundå®ç°æ€§èƒ½ç›‘æ§

**Springäº‹åŠ¡**ï¼š
- [ ] ç†è§£äº‹åŠ¡çš„ACIDç‰¹æ€§
- [ ] æŒæ¡@Transactionalçš„ä½¿ç”¨
- [ ] äº†è§£äº‹åŠ¡ä¼ æ’­è¡Œä¸º
- [ ] çŸ¥é“äº‹åŠ¡å¤±æ•ˆçš„å¸¸è§æƒ…å†µ

**SpringMVCé«˜çº§**ï¼š
- [ ] ä¼šå†™æ‹¦æˆªå™¨å®ç°æƒé™æ§åˆ¶
- [ ] ä¼šç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨
- [ ] æŒæ¡å‚æ•°æ ¡éªŒæ³¨è§£çš„ä½¿ç”¨
- [ ] ç†è§£æ‹¦æˆªå™¨æ‰§è¡Œæµç¨‹

**MyBatisåŠ¨æ€SQL**ï¼š
- [ ] æŒæ¡ifã€whereã€foreachç­‰æ ‡ç­¾
- [ ] ç†è§£ä¸€çº§ã€äºŒçº§ç¼“å­˜æœºåˆ¶
- [ ] çŸ¥é“ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µ
- [ ] ä¼šæ ¹æ®åœºæ™¯é€‰æ‹©æ˜¯å¦å¼€å¯ç¼“å­˜

---

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š

```
AOPåˆ‡é¢ç¼–ç¨‹æŠ½å…¬å…±ï¼Œäº”ç§é€šçŸ¥å„æœ‰ç”¨
äº‹åŠ¡ç®¡ç†ä¿ä¸€è‡´ï¼ŒACIDç‰¹æ€§è¦è®°æ¸…
æ‹¦æˆªå™¨æ¥æŠŠå…³å£å®ˆï¼Œå¼‚å¸¸å¤„ç†è¦ç»Ÿä¸€
åŠ¨æ€SQLå¾ˆçµæ´»ï¼Œç¼“å­˜æœºåˆ¶ææ€§èƒ½
```