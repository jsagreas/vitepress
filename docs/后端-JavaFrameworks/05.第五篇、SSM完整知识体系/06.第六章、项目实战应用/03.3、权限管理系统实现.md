---
title: 3ã€æƒé™ç®¡ç†ç³»ç»Ÿå®ç°
---
## ğŸ“š ç›®å½•

1. [æƒé™ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-æƒé™ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [RBACæƒé™æ¨¡å‹è¯¦è§£](#2-RBACæƒé™æ¨¡å‹è¯¦è§£)
3. [è§’è‰²æƒé™è®¾è®¡å®ç°](#3-è§’è‰²æƒé™è®¾è®¡å®ç°)
4. [èœå•æƒé™æ§åˆ¶](#4-èœå•æƒé™æ§åˆ¶)
5. [æŒ‰é’®æƒé™æ§åˆ¶](#5-æŒ‰é’®æƒé™æ§åˆ¶)
6. [æ•°æ®æƒé™æ§åˆ¶](#6-æ•°æ®æƒé™æ§åˆ¶)
7. [æƒé™ç¼“å­˜ç­–ç•¥](#7-æƒé™ç¼“å­˜ç­–ç•¥)
8. [æƒé™æ‹¦æˆªå™¨å®ç°](#8-æƒé™æ‹¦æˆªå™¨å®ç°)
9. [æƒé™æ³¨è§£åº”ç”¨](#9-æƒé™æ³¨è§£åº”ç”¨)
10. [åŠ¨æ€æƒé™åŠ è½½](#10-åŠ¨æ€æƒé™åŠ è½½)
11. [æƒé™å®¡è®¡æ—¥å¿—](#11-æƒé™å®¡è®¡æ—¥å¿—)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” æƒé™ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æƒé™ç®¡ç†


**é€šä¿—ç†è§£**ï¼š
å°±åƒä½ å®¶çš„é’¥åŒ™ç®¡ç†ä¸€æ ·ï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„é’¥åŒ™ï¼š
- ä½ æœ‰å…¨éƒ¨æˆ¿é—´çš„é’¥åŒ™ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- ä¿å§†åªæœ‰å®¢å…å’Œå¨æˆ¿çš„é’¥åŒ™ï¼ˆæ™®é€šå‘˜å·¥æƒé™ï¼‰
- å®¢äººåªèƒ½åœ¨å®¢å…æ´»åŠ¨ï¼ˆè®¿å®¢æƒé™ï¼‰

**ç³»ç»Ÿä¸­çš„æƒé™ç®¡ç†**ï¼š
```
æƒé™ç®¡ç† = æ§åˆ¶"è°"èƒ½å¯¹"ä»€ä¹ˆèµ„æº"è¿›è¡Œ"ä»€ä¹ˆæ“ä½œ"

ä¸‰è¦ç´ ï¼š
â€¢ ä¸»ä½“(Who)ï¼šç”¨æˆ·ã€è§’è‰²
â€¢ èµ„æº(What)ï¼šèœå•ã€æŒ‰é’®ã€æ•°æ®
â€¢ æ“ä½œ(How)ï¼šå¢åˆ æ”¹æŸ¥ã€æŸ¥çœ‹ã€ç¼–è¾‘
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦æƒé™ç®¡ç†


**å®é™…åœºæ™¯è¯´æ˜**ï¼š

ğŸ¢ **å…¬å¸ç®¡ç†ç³»ç»Ÿä¾‹å­**ï¼š
- **è€æ¿**ï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰éƒ¨é—¨çš„æ•°æ®ï¼Œå®¡æ‰¹æ‰€æœ‰è®¢å•
- **è´¢åŠ¡ä¸»ç®¡**ï¼šåªèƒ½æŸ¥çœ‹è´¢åŠ¡ç›¸å…³æ•°æ®ï¼Œå®¡æ‰¹è´¢åŠ¡å•æ®
- **æ™®é€šå‘˜å·¥**ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®ï¼Œæäº¤è‡ªå·±çš„ç”³è¯·
- **å®ä¹ ç”Ÿ**ï¼šåªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½ä¿®æ”¹ä»»ä½•æ•°æ®

**å¦‚æœæ²¡æœ‰æƒé™ç®¡ç†ä¼šæ€æ ·**ï¼Ÿ
- âŒ å®ä¹ ç”Ÿå¯èƒ½è¯¯åˆ é‡è¦æ•°æ®
- âŒ å‘˜å·¥å¯ä»¥æŸ¥çœ‹è€æ¿çš„è–ªèµ„
- âŒ å…¶ä»–éƒ¨é—¨å¯ä»¥ä¿®æ”¹è´¢åŠ¡æ•°æ®
- âŒ ç³»ç»Ÿå®‰å…¨æ— æ³•ä¿éšœ

### 1.3 æƒé™ç®¡ç†çš„æ ¸å¿ƒç›®æ ‡


| ç›®æ ‡ | è¯´æ˜ | å®é™…æ„ä¹‰ |
|------|------|----------|
| **ğŸ”’ å®‰å…¨æ€§** | ä¿æŠ¤æ•æ„Ÿæ•°æ®å’ŒåŠŸèƒ½ | é˜²æ­¢æ•°æ®æ³„éœ²å’Œè¯¯æ“ä½œ |
| **ğŸ“Š å¯æ§æ€§** | ç²¾ç¡®æ§åˆ¶è®¿é—®èŒƒå›´ | ä¸åŒè§’è‰²çœ‹åˆ°ä¸åŒå†…å®¹ |
| **ğŸ”„ çµæ´»æ€§** | æƒé™å¯åŠ¨æ€è°ƒæ•´ | èŒä½å˜åŠ¨æƒé™éšä¹‹æ”¹å˜ |
| **ğŸ“ å¯è¿½æº¯** | æ“ä½œè¡Œä¸ºå¯å®¡è®¡ | å‡ºé—®é¢˜èƒ½æ‰¾åˆ°è´£ä»»äºº |

---

## 2. ğŸ‘¥ RBACæƒé™æ¨¡å‹è¯¦è§£


### 2.1 RBACæ˜¯ä»€ä¹ˆ


**RBAC** = Role-Based Access Controlï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰

**é€šä¿—æ¯”å–»**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸ç”¨RBACï¼‰ï¼š
ç»™å¼ ä¸‰åˆ†é…ï¼šæŸ¥çœ‹è®¢å•ã€ä¿®æ”¹è®¢å•ã€åˆ é™¤è®¢å•ã€å¯¼å‡ºè®¢å•...
ç»™æå››åˆ†é…ï¼šæŸ¥çœ‹è®¢å•ã€ä¿®æ”¹è®¢å•ã€åˆ é™¤è®¢å•ã€å¯¼å‡ºè®¢å•...
ç»™ç‹äº”åˆ†é…ï¼šæŸ¥çœ‹è®¢å•ã€ä¿®æ”¹è®¢å•ã€åˆ é™¤è®¢å•ã€å¯¼å‡ºè®¢å•...
â†’ æ¯ä¸ªäººéƒ½è¦é…ç½®ä¸€éï¼Œå¤ªéº»çƒ¦ï¼

RBACæ–¹å¼ï¼š
1. åˆ›å»º"é”€å”®ç»ç†"è§’è‰²ï¼Œé…ç½®å¥½æ‰€æœ‰æƒé™
2. æŠŠå¼ ä¸‰ã€æå››ã€ç‹äº”éƒ½è®¾ä¸º"é”€å”®ç»ç†"
â†’ ä¸€æ¬¡é…ç½®ï¼Œå¤šäººä½¿ç”¨ï¼
```

### 2.2 RBACæ ¸å¿ƒæ¦‚å¿µ


**äº”ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†**ï¼š

```
ç”¨æˆ·(User)                è§’è‰²(Role)              æƒé™(Permission)
    â†“                        â†“                        â†“
å¼ ä¸‰ã€æå››              é”€å”®ç»ç†ã€è´¢åŠ¡           æŸ¥çœ‹è®¢å•ã€ä¿®æ”¹è®¢å•
    
    ç”¨æˆ· â†â†’ è§’è‰² â†â†’ æƒé™
    (å¤šå¯¹å¤š)   (å¤šå¯¹å¤š)
```

**ğŸ“– æ¦‚å¿µè¯¦è§£**ï¼š

**ç”¨æˆ·ï¼ˆUserï¼‰**ï¼š
- å«ä¹‰ï¼šç³»ç»Ÿçš„å®é™…ä½¿ç”¨è€…
- ä¾‹å­ï¼šå¼ ä¸‰ã€æå››ã€ç‹äº”
- ç‰¹ç‚¹ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²

**è§’è‰²ï¼ˆRoleï¼‰**ï¼š
- å«ä¹‰ï¼šä¸€ç»„æƒé™çš„é›†åˆ
- ä¾‹å­ï¼šé”€å”®ç»ç†ã€è´¢åŠ¡ä¸»ç®¡ã€ç³»ç»Ÿç®¡ç†å‘˜
- ç‰¹ç‚¹ï¼šä¸€ä¸ªè§’è‰²å¯ä»¥åˆ†é…ç»™å¤šä¸ªç”¨æˆ·

**æƒé™ï¼ˆPermissionï¼‰**ï¼š
- å«ä¹‰ï¼šå¯¹èµ„æºçš„æ“ä½œè®¸å¯
- ä¾‹å­ï¼šæŸ¥çœ‹è®¢å•ã€ä¿®æ”¹ç”¨æˆ·ã€åˆ é™¤å•†å“
- ç‰¹ç‚¹ï¼šä¸€ä¸ªæƒé™å¯ä»¥åˆ†é…ç»™å¤šä¸ªè§’è‰²

**èœå•ï¼ˆMenuï¼‰**ï¼š
- å«ä¹‰ï¼šç³»ç»Ÿçš„åŠŸèƒ½å…¥å£
- ä¾‹å­ï¼šè®¢å•ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€ç³»ç»Ÿè®¾ç½®
- ç‰¹ç‚¹ï¼šèœå•ä¹Ÿæ˜¯ä¸€ç§èµ„æºï¼Œéœ€è¦æƒé™æ§åˆ¶

**èµ„æºï¼ˆResourceï¼‰**ï¼š
- å«ä¹‰ï¼šéœ€è¦ä¿æŠ¤çš„å¯¹è±¡
- ä¾‹å­ï¼šæ¥å£URLã€æŒ‰é’®ã€æ•°æ®
- ç‰¹ç‚¹ï¼šæ‰€æœ‰éœ€è¦æ§åˆ¶çš„éƒ½æ˜¯èµ„æº

### 2.3 RBACå…³ç³»å›¾ç¤º


```
ç”¨æˆ·è¡¨(User)              è§’è‰²è¡¨(Role)           æƒé™è¡¨(Permission)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id: 1    â”‚            â”‚ id: 1    â”‚           â”‚ id: 1        â”‚
â”‚ name:å¼ ä¸‰ â”‚            â”‚ name:ç»ç† â”‚           â”‚ name:æŸ¥çœ‹è®¢å• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                        â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸­é—´å…³è”è¡¨                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·-è§’è‰²å…³è”        â”‚ è§’è‰²-æƒé™å…³è”                      â”‚
â”‚ user_id | role_id   â”‚ role_id | permission_id          â”‚
â”‚    1    |    1      â”‚    1    |      1                 â”‚
â”‚    1    |    2      â”‚    1    |      2                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœï¼šå¼ ä¸‰(id=1) â†’ æ‹¥æœ‰ç»ç†è§’è‰² â†’ æ‹¥æœ‰æŸ¥çœ‹è®¢å•æƒé™
```

### 2.4 æ•°æ®åº“è¡¨è®¾è®¡


**æ ¸å¿ƒè¡¨ç»“æ„**ï¼š

```sql
-- 1. ç”¨æˆ·è¡¨
CREATE TABLE sys_user (
    id BIGINT PRIMARY KEY,
    username VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
    password VARCHAR(100) NOT NULL COMMENT 'å¯†ç ',
    real_name VARCHAR(50) COMMENT 'çœŸå®å§“å',
    status INT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1å¯ç”¨ 0ç¦ç”¨'
);

-- 2. è§’è‰²è¡¨  
CREATE TABLE sys_role (
    id BIGINT PRIMARY KEY,
    role_name VARCHAR(50) NOT NULL COMMENT 'è§’è‰²åç§°',
    role_code VARCHAR(50) NOT NULL COMMENT 'è§’è‰²ç¼–ç ',
    description VARCHAR(200) COMMENT 'è§’è‰²æè¿°'
);

-- 3. æƒé™è¡¨
CREATE TABLE sys_permission (
    id BIGINT PRIMARY KEY,
    permission_name VARCHAR(100) NOT NULL COMMENT 'æƒé™åç§°',
    permission_code VARCHAR(100) NOT NULL COMMENT 'æƒé™ç¼–ç ',
    resource_type VARCHAR(20) COMMENT 'èµ„æºç±»å‹ï¼šmenu/button/api',
    url VARCHAR(200) COMMENT 'èµ„æºè·¯å¾„'
);

-- 4. ç”¨æˆ·-è§’è‰²å…³è”è¡¨
CREATE TABLE sys_user_role (
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    PRIMARY KEY (user_id, role_id)
);

-- 5. è§’è‰²-æƒé™å…³è”è¡¨
CREATE TABLE sys_role_permission (
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    PRIMARY KEY (role_id, permission_id)
);
```

**è¡¨å…³ç³»è¯´æ˜**ï¼š
- ğŸ‘¤ ç”¨æˆ·å’Œè§’è‰²ï¼š**å¤šå¯¹å¤š**å…³ç³»ï¼ˆä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²ï¼‰
- ğŸ‘” è§’è‰²å’Œæƒé™ï¼š**å¤šå¯¹å¤š**å…³ç³»ï¼ˆä¸€ä¸ªè§’è‰²å¯ä»¥æœ‰å¤šä¸ªæƒé™ï¼‰
- ğŸ”— ä¸­é—´è¡¨è´Ÿè´£ç»´æŠ¤è¿™äº›å…³ç³»

---

## 3. ğŸ­ è§’è‰²æƒé™è®¾è®¡å®ç°


### 3.1 è§’è‰²æƒé™çš„æœ¬è´¨


**æ ¸å¿ƒç†è§£**ï¼š
è§’è‰²å°±æ˜¯ä¸€ä¸ª"æƒé™åŒ…"ï¼ŒæŠŠç›¸å…³çš„æƒé™æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿æ‰¹é‡åˆ†é…ã€‚

**å®é™…ä¾‹å­**ï¼š
```
ğŸ¢ ç”µå•†ç³»ç»Ÿçš„è§’è‰²è®¾è®¡

ã€è¶…çº§ç®¡ç†å‘˜ã€‘è§’è‰²åŒ…å«ï¼š
âœ… æ‰€æœ‰èœå•è®¿é—®æƒé™
âœ… æ‰€æœ‰æ•°æ®æ“ä½œæƒé™
âœ… ç³»ç»Ÿé…ç½®æƒé™
âœ… ç”¨æˆ·ç®¡ç†æƒé™

ã€é”€å”®ç»ç†ã€‘è§’è‰²åŒ…å«ï¼š
âœ… è®¢å•ç®¡ç†èœå•
âœ… å®¢æˆ·ç®¡ç†èœå•
âœ… æŸ¥çœ‹æ‰€æœ‰è®¢å•æ•°æ®
âœ… å®¡æ‰¹è®¢å•æƒé™
âŒ æ— ç³»ç»Ÿé…ç½®æƒé™

ã€æ™®é€šé”€å”®ã€‘è§’è‰²åŒ…å«ï¼š
âœ… è®¢å•ç®¡ç†èœå•ï¼ˆéƒ¨åˆ†åŠŸèƒ½ï¼‰
âœ… æŸ¥çœ‹è‡ªå·±çš„è®¢å•
âœ… åˆ›å»ºè®¢å•æƒé™
âŒ æ— å®¡æ‰¹æƒé™
âŒ æ— åˆ é™¤æƒé™
```

### 3.2 è§’è‰²æƒé™åˆ†é…å®ç°


**Serviceå±‚å®ç°**ï¼š

```java
@Service
public class RolePermissionService {
    
    @Autowired
    private RoleMapper roleMapper;
    
    @Autowired
    private PermissionMapper permissionMapper;
    
    /**
     * ä¸ºè§’è‰²åˆ†é…æƒé™
     * @param roleId è§’è‰²ID
     * @param permissionIds æƒé™IDåˆ—è¡¨
     */
    public void assignPermissions(Long roleId, List<Long> permissionIds) {
        // 1. å…ˆåˆ é™¤è¯¥è§’è‰²åŸæœ‰çš„æ‰€æœ‰æƒé™
        roleMapper.deleteRolePermissions(roleId);
        
        // 2. æ‰¹é‡æ’å…¥æ–°çš„æƒé™å…³è”
        if (permissionIds != null && !permissionIds.isEmpty()) {
            roleMapper.batchInsertRolePermissions(roleId, permissionIds);
        }
    }
    
    /**
     * è·å–è§’è‰²æ‹¥æœ‰çš„æ‰€æœ‰æƒé™
     * @param roleId è§’è‰²ID
     * @return æƒé™åˆ—è¡¨
     */
    public List<Permission> getRolePermissions(Long roleId) {
        return permissionMapper.selectByRoleId(roleId);
    }
}
```

**Mapperå±‚å®ç°**ï¼š

```java
@Mapper
public interface RoleMapper {
    
    // åˆ é™¤è§’è‰²çš„æ‰€æœ‰æƒé™å…³è”
    void deleteRolePermissions(@Param("roleId") Long roleId);
    
    // æ‰¹é‡æ’å…¥è§’è‰²-æƒé™å…³è”
    void batchInsertRolePermissions(
        @Param("roleId") Long roleId, 
        @Param("permissionIds") List<Long> permissionIds
    );
}
```

```xml
<!-- RoleMapper.xml -->
<mapper namespace="com.example.mapper.RoleMapper">
    
    <!-- åˆ é™¤è§’è‰²æƒé™ -->
    <delete id="deleteRolePermissions">
        DELETE FROM sys_role_permission 
        WHERE role_id = #{roleId}
    </delete>
    
    <!-- æ‰¹é‡æ’å…¥æƒé™ -->
    <insert id="batchInsertRolePermissions">
        INSERT INTO sys_role_permission (role_id, permission_id)
        VALUES
        <foreach collection="permissionIds" item="permId" separator=",">
            (#{roleId}, #{permId})
        </foreach>
    </insert>
    
</mapper>
```

### 3.3 ç”¨æˆ·è§’è‰²åˆ†é…


**å®ç°é€»è¾‘**ï¼š

```java
@Service
public class UserRoleService {
    
    @Autowired
    private UserMapper userMapper;
    
    /**
     * ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
     * @param userId ç”¨æˆ·ID
     * @param roleIds è§’è‰²IDåˆ—è¡¨
     */
    public void assignRoles(Long userId, List<Long> roleIds) {
        // 1. åˆ é™¤ç”¨æˆ·åŸæœ‰è§’è‰²
        userMapper.deleteUserRoles(userId);
        
        // 2. åˆ†é…æ–°è§’è‰²
        if (roleIds != null && !roleIds.isEmpty()) {
            userMapper.batchInsertUserRoles(userId, roleIds);
        }
    }
    
    /**
     * è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
     */
    public List<Role> getUserRoles(Long userId) {
        return userMapper.selectRolesByUserId(userId);
    }
    
    /**
     * è·å–ç”¨æˆ·çš„æ‰€æœ‰æƒé™ï¼ˆé€šè¿‡è§’è‰²ï¼‰
     */
    public Set<String> getUserPermissions(Long userId) {
        // 1. è·å–ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
        List<Role> roles = getUserRoles(userId);
        
        // 2. éå†è§’è‰²ï¼Œæ”¶é›†æ‰€æœ‰æƒé™ç¼–ç 
        Set<String> permissions = new HashSet<>();
        for (Role role : roles) {
            List<Permission> rolePerms = permissionMapper.selectByRoleId(role.getId());
            for (Permission perm : rolePerms) {
                permissions.add(perm.getPermissionCode());
            }
        }
        
        return permissions;
    }
}
```

### 3.4 æƒé™æ ¡éªŒæµç¨‹


```
ç”¨æˆ·ç™»å½•
   â†“
åŠ è½½ç”¨æˆ·ä¿¡æ¯
   â†“
æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
   â†“
æŸ¥è¯¢è§’è‰²çš„æ‰€æœ‰æƒé™
   â†“
æƒé™ä¿¡æ¯å­˜å…¥Session/Redis
   â†“
ç”¨æˆ·è®¿é—®åŠŸèƒ½
   â†“
æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”æƒé™
   â†“
æœ‰æƒé™ â†’ å…è®¸è®¿é—®
æ— æƒé™ â†’ æ‹’ç»è®¿é—®ï¼ˆè¿”å›403ï¼‰
```

---

## 4. ğŸ“‹ èœå•æƒé™æ§åˆ¶


### 4.1 èœå•æƒé™çš„ä½œç”¨


**ä»€ä¹ˆæ˜¯èœå•æƒé™**ï¼Ÿ
å°±æ˜¯æ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›èœå•ï¼Œä¸èƒ½çœ‹åˆ°å“ªäº›èœå•ã€‚

**å®é™…åœºæ™¯**ï¼š
```
ã€è¶…çº§ç®¡ç†å‘˜ã€‘ç™»å½•åçœ‹åˆ°ï¼š
ğŸ“Š é¦–é¡µ
ğŸ‘¥ ç”¨æˆ·ç®¡ç†
ğŸ­ è§’è‰²ç®¡ç†
ğŸ” æƒé™ç®¡ç†
ğŸ“ è®¢å•ç®¡ç†
ğŸ’° è´¢åŠ¡ç®¡ç†
âš™ï¸ ç³»ç»Ÿè®¾ç½®

ã€æ™®é€šé”€å”®ã€‘ç™»å½•ååªçœ‹åˆ°ï¼š
ğŸ“Š é¦–é¡µ
ğŸ“ è®¢å•ç®¡ç†ï¼ˆè‡ªå·±çš„è®¢å•ï¼‰

â†’ å…¶ä»–èœå•å¯¹æ™®é€šé”€å”®"éšè—"äº†
```

### 4.2 èœå•è¡¨è®¾è®¡


```sql
CREATE TABLE sys_menu (
    id BIGINT PRIMARY KEY,
    parent_id BIGINT DEFAULT 0 COMMENT 'çˆ¶èœå•IDï¼Œ0è¡¨ç¤ºæ ¹èœå•',
    menu_name VARCHAR(50) NOT NULL COMMENT 'èœå•åç§°',
    menu_type INT NOT NULL COMMENT 'èœå•ç±»å‹ï¼š1ç›®å½• 2èœå• 3æŒ‰é’®',
    permission_code VARCHAR(100) COMMENT 'æƒé™æ ‡è¯†',
    path VARCHAR(200) COMMENT 'è·¯ç”±è·¯å¾„',
    icon VARCHAR(50) COMMENT 'èœå•å›¾æ ‡',
    sort_order INT DEFAULT 0 COMMENT 'æ’åºå·',
    visible INT DEFAULT 1 COMMENT 'æ˜¯å¦å¯è§ï¼š1æ˜¯ 0å¦'
);
```

**èœå•ç±»å‹è¯´æ˜**ï¼š
- **ç›®å½•ï¼ˆ1ï¼‰**ï¼šä¸€çº§èœå•ï¼Œå¦‚"ç³»ç»Ÿç®¡ç†"
- **èœå•ï¼ˆ2ï¼‰**ï¼šå…·ä½“åŠŸèƒ½é¡µé¢ï¼Œå¦‚"ç”¨æˆ·åˆ—è¡¨"
- **æŒ‰é’®ï¼ˆ3ï¼‰**ï¼šé¡µé¢å†…çš„æ“ä½œæŒ‰é’®ï¼Œå¦‚"æ–°å¢"ã€"åˆ é™¤"

**èœå•å±‚çº§ç¤ºä¾‹**ï¼š
```
ç³»ç»Ÿç®¡ç†ï¼ˆç›®å½•ï¼‰
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†ï¼ˆèœå•ï¼‰
â”‚   â”œâ”€â”€ æ–°å¢ç”¨æˆ·ï¼ˆæŒ‰é’®ï¼‰
â”‚   â”œâ”€â”€ ç¼–è¾‘ç”¨æˆ·ï¼ˆæŒ‰é’®ï¼‰
â”‚   â””â”€â”€ åˆ é™¤ç”¨æˆ·ï¼ˆæŒ‰é’®ï¼‰
â””â”€â”€ è§’è‰²ç®¡ç†ï¼ˆèœå•ï¼‰
    â”œâ”€â”€ æ–°å¢è§’è‰²ï¼ˆæŒ‰é’®ï¼‰
    â””â”€â”€ åˆ†é…æƒé™ï¼ˆæŒ‰é’®ï¼‰
```

### 4.3 è·å–ç”¨æˆ·èœå•æ ‘


**Serviceå®ç°**ï¼š

```java
@Service
public class MenuService {
    
    @Autowired
    private MenuMapper menuMapper;
    
    /**
     * è·å–ç”¨æˆ·çš„èœå•æ ‘
     * @param userId ç”¨æˆ·ID
     * @return èœå•æ ‘ç»“æ„
     */
    public List<MenuVO> getUserMenuTree(Long userId) {
        // 1. æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢å…¶æ‹¥æœ‰çš„æ‰€æœ‰èœå•æƒé™
        List<Menu> menus = menuMapper.selectMenusByUserId(userId);
        
        // 2. æ„å»ºæ ‘å½¢ç»“æ„
        return buildMenuTree(menus, 0L);
    }
    
    /**
     * é€’å½’æ„å»ºèœå•æ ‘
     * @param allMenus æ‰€æœ‰èœå•
     * @param parentId çˆ¶èœå•ID
     */
    private List<MenuVO> buildMenuTree(List<Menu> allMenus, Long parentId) {
        List<MenuVO> tree = new ArrayList<>();
        
        for (Menu menu : allMenus) {
            if (menu.getParentId().equals(parentId)) {
                MenuVO vo = new MenuVO();
                vo.setId(menu.getId());
                vo.setName(menu.getMenuName());
                vo.setPath(menu.getPath());
                vo.setIcon(menu.getIcon());
                
                // é€’å½’æŸ¥æ‰¾å­èœå•
                List<MenuVO> children = buildMenuTree(allMenus, menu.getId());
                vo.setChildren(children);
                
                tree.add(vo);
            }
        }
        
        // æŒ‰æ’åºå·æ’åº
        tree.sort(Comparator.comparingInt(MenuVO::getSortOrder));
        return tree;
    }
}
```

**Mapperå®ç°**ï¼š

```xml
<select id="selectMenusByUserId" resultType="Menu">
    SELECT DISTINCT m.*
    FROM sys_menu m
    LEFT JOIN sys_permission p ON m.permission_code = p.permission_code
    LEFT JOIN sys_role_permission rp ON p.id = rp.permission_id
    LEFT JOIN sys_user_role ur ON rp.role_id = ur.role_id
    WHERE ur.user_id = #{userId}
      AND m.visible = 1
      AND m.menu_type IN (1, 2)  -- åªæŸ¥è¯¢ç›®å½•å’Œèœå•ï¼Œä¸åŒ…æ‹¬æŒ‰é’®
    ORDER BY m.parent_id, m.sort_order
</select>
```

### 4.4 å‰ç«¯èœå•æ¸²æŸ“


**Controllerè¿”å›èœå•**ï¼š

```java
@RestController
@RequestMapping("/system/menu")
public class MenuController {
    
    @Autowired
    private MenuService menuService;
    
    @GetMapping("/user-menus")
    public Result getUserMenus() {
        // ä»Securityä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·ID
        Long userId = SecurityUtils.getCurrentUserId();
        
        // è·å–ç”¨æˆ·èœå•æ ‘
        List<MenuVO> menus = menuService.getUserMenuTree(userId);
        
        return Result.success(menus);
    }
}
```

**è¿”å›çš„èœå•ç»“æ„**ï¼š

```json
[
  {
    "id": 1,
    "name": "ç³»ç»Ÿç®¡ç†",
    "path": "/system",
    "icon": "setting",
    "children": [
      {
        "id": 2,
        "name": "ç”¨æˆ·ç®¡ç†",
        "path": "/system/user",
        "icon": "user"
      },
      {
        "id": 3,
        "name": "è§’è‰²ç®¡ç†",
        "path": "/system/role",
        "icon": "team"
      }
    ]
  },
  {
    "id": 4,
    "name": "è®¢å•ç®¡ç†",
    "path": "/order",
    "icon": "shopping"
  }
]
```

---

## 5. ğŸ”˜ æŒ‰é’®æƒé™æ§åˆ¶


### 5.1 æŒ‰é’®æƒé™æ˜¯ä»€ä¹ˆ


**é€šä¿—ç†è§£**ï¼š
èœå•æƒé™æ§åˆ¶ä½ èƒ½ä¸èƒ½"è¿›è¿™ä¸ªé¡µé¢"ï¼ŒæŒ‰é’®æƒé™æ§åˆ¶ä½ è¿›äº†é¡µé¢åèƒ½ä¸èƒ½"ç‚¹è¿™ä¸ªæŒ‰é’®"ã€‚

**å®é™…åœºæ™¯**ï¼š
```
ã€é”€å”®ç»ç†ã€‘è¿›å…¥"è®¢å•ç®¡ç†"é¡µé¢åï¼š
âœ… èƒ½çœ‹åˆ°"æŸ¥è¯¢"æŒ‰é’®
âœ… èƒ½çœ‹åˆ°"æ–°å¢"æŒ‰é’®
âœ… èƒ½çœ‹åˆ°"å®¡æ‰¹"æŒ‰é’®
âœ… èƒ½çœ‹åˆ°"å¯¼å‡º"æŒ‰é’®

ã€æ™®é€šé”€å”®ã€‘è¿›å…¥"è®¢å•ç®¡ç†"é¡µé¢åï¼š
âœ… èƒ½çœ‹åˆ°"æŸ¥è¯¢"æŒ‰é’®
âœ… èƒ½çœ‹åˆ°"æ–°å¢"æŒ‰é’®
âŒ çœ‹ä¸åˆ°"å®¡æ‰¹"æŒ‰é’®ï¼ˆæ²¡æœ‰è¿™ä¸ªæƒé™ï¼‰
âŒ çœ‹ä¸åˆ°"å¯¼å‡º"æŒ‰é’®ï¼ˆæ²¡æœ‰è¿™ä¸ªæƒé™ï¼‰
```

### 5.2 æŒ‰é’®æƒé™è®¾è®¡


**æŒ‰é’®æƒé™æ ‡è¯†å‘½åè§„èŒƒ**ï¼š
```
æ ¼å¼ï¼šæ¨¡å—:åŠŸèƒ½:æ“ä½œ

ç¤ºä¾‹ï¼š
system:user:add      â†’ ç”¨æˆ·ç®¡ç†-æ–°å¢
system:user:edit     â†’ ç”¨æˆ·ç®¡ç†-ç¼–è¾‘
system:user:delete   â†’ ç”¨æˆ·ç®¡ç†-åˆ é™¤
order:order:approve  â†’ è®¢å•ç®¡ç†-å®¡æ‰¹
order:order:export   â†’ è®¢å•ç®¡ç†-å¯¼å‡º
```

### 5.3 åç«¯æŒ‰é’®æƒé™æ ¡éªŒ


**æ–¹å¼ä¸€ï¼šä½¿ç”¨æ³¨è§£æ ¡éªŒ**

```java
@RestController
@RequestMapping("/system/user")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    /**
     * æ–°å¢ç”¨æˆ· - éœ€è¦ system:user:add æƒé™
     */
    @PostMapping("/add")
    @PreAuthorize("hasAuthority('system:user:add')")
    public Result addUser(@RequestBody User user) {
        userService.save(user);
        return Result.success("æ–°å¢æˆåŠŸ");
    }
    
    /**
     * åˆ é™¤ç”¨æˆ· - éœ€è¦ system:user:delete æƒé™
     */
    @DeleteMapping("/{id}")
    @PreAuthorize("hasAuthority('system:user:delete')")
    public Result deleteUser(@PathVariable Long id) {
        userService.removeById(id);
        return Result.success("åˆ é™¤æˆåŠŸ");
    }
    
    /**
     * æŸ¥è¯¢ç”¨æˆ· - éœ€è¦ system:user:view æƒé™
     */
    @GetMapping("/list")
    @PreAuthorize("hasAuthority('system:user:view')")
    public Result getUserList() {
        List<User> list = userService.list();
        return Result.success(list);
    }
}
```

**`@PreAuthorize` æ³¨è§£è¯´æ˜**ï¼š
- ä½œç”¨ï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™æ ¡éªŒ
- å‚æ•°ï¼šSpELè¡¨è¾¾å¼ï¼Œæ”¯æŒå¤šç§å†™æ³•
- æ ¡éªŒå¤±è´¥ï¼šæŠ›å‡º `AccessDeniedException` å¼‚å¸¸

**æ–¹å¼äºŒï¼šç¼–ç¨‹å¼æƒé™æ ¡éªŒ**

```java
@Service
public class OrderService {
    
    /**
     * å®¡æ‰¹è®¢å• - æ‰‹åŠ¨æ ¡éªŒæƒé™
     */
    public void approveOrder(Long orderId) {
        // è·å–å½“å‰ç”¨æˆ·æƒé™
        Set<String> permissions = SecurityUtils.getCurrentUserPermissions();
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å®¡æ‰¹æƒé™
        if (!permissions.contains("order:order:approve")) {
            throw new BusinessException("æ— å®¡æ‰¹æƒé™");
        }
        
        // æ‰§è¡Œå®¡æ‰¹é€»è¾‘
        // ...
    }
}
```

### 5.4 å‰ç«¯æŒ‰é’®æƒé™æ§åˆ¶


**è·å–ç”¨æˆ·æŒ‰é’®æƒé™**ï¼š

```java
@GetMapping("/user-permissions")
public Result getUserPermissions() {
    Long userId = SecurityUtils.getCurrentUserId();
    
    // è·å–ç”¨æˆ·çš„æ‰€æœ‰æƒé™æ ‡è¯†
    Set<String> permissions = userService.getUserPermissions(userId);
    
    return Result.success(permissions);
}
```

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "data": [
    "system:user:add",
    "system:user:edit",
    "system:user:view",
    "order:order:add",
    "order:order:view"
  ]
}
```

**å‰ç«¯ä½¿ç”¨ï¼ˆVueç¤ºä¾‹ï¼‰**ï¼š

```vue
<template>
  <div>
    <!-- æœ‰æƒé™æ‰æ˜¾ç¤ºæŒ‰é’® -->
    <el-button 
      v-if="hasPermission('system:user:add')"
      @click="handleAdd">
      æ–°å¢ç”¨æˆ·
    </el-button>
    
    <el-button 
      v-if="hasPermission('system:user:delete')"
      @click="handleDelete">
      åˆ é™¤ç”¨æˆ·
    </el-button>
  </div>
</template>

<script>
export default {
  methods: {
    // æ£€æŸ¥æƒé™
    hasPermission(permission) {
      const permissions = this.$store.state.permissions; // ä»Vuexè·å–
      return permissions.includes(permission);
    }
  }
}
</script>
```

---

## 6. ğŸ“Š æ•°æ®æƒé™æ§åˆ¶


### 6.1 æ•°æ®æƒé™çš„æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯æ•°æ®æƒé™**ï¼Ÿ
æ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›æ•°æ®ï¼Œæ¯”å¦‚ï¼š
- æ™®é€šé”€å”®åªèƒ½çœ‹è‡ªå·±çš„è®¢å•
- éƒ¨é—¨ç»ç†èƒ½çœ‹æœ¬éƒ¨é—¨æ‰€æœ‰äººçš„è®¢å•
- æ€»ç»ç†èƒ½çœ‹å…¨å…¬å¸çš„è®¢å•

**ä¸åŠŸèƒ½æƒé™çš„åŒºåˆ«**ï¼š
```
åŠŸèƒ½æƒé™ï¼šæ§åˆ¶èƒ½ä¸èƒ½è®¿é—®"è®¢å•ç®¡ç†"èœå• â†’ è¿›ä¸è¿›å¾—å»
æ•°æ®æƒé™ï¼šæ§åˆ¶èƒ½çœ‹åˆ°å“ªäº›è®¢å•æ•°æ® â†’ çœ‹å¾—åˆ°å“ªäº›
```

### 6.2 æ•°æ®æƒé™ç±»å‹


| æƒé™ç±»å‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|---------|------|----------|
| **å…¨éƒ¨æ•°æ®** | å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ® | è¶…çº§ç®¡ç†å‘˜ã€æ€»ç»ç† |
| **æœ¬éƒ¨é—¨æ•°æ®** | åªèƒ½çœ‹æœ¬éƒ¨é—¨çš„æ•°æ® | éƒ¨é—¨ç»ç† |
| **æœ¬éƒ¨é—¨åŠä¸‹çº§** | å¯ä»¥çœ‹æœ¬éƒ¨é—¨å’Œä¸‹çº§éƒ¨é—¨æ•°æ® | äº‹ä¸šéƒ¨æ€»ç›‘ |
| **ä»…æœ¬äººæ•°æ®** | åªèƒ½çœ‹è‡ªå·±åˆ›å»ºçš„æ•°æ® | æ™®é€šå‘˜å·¥ |
| **è‡ªå®šä¹‰æ•°æ®** | æŒ‡å®šå…·ä½“èƒ½çœ‹å“ªäº›éƒ¨é—¨ | ç‰¹æ®Šè§’è‰² |

### 6.3 æ•°æ®æƒé™è¡¨è®¾è®¡


```sql
-- è§’è‰²æ•°æ®æƒé™é…ç½®è¡¨
CREATE TABLE sys_role_data_scope (
    role_id BIGINT NOT NULL COMMENT 'è§’è‰²ID',
    data_scope INT NOT NULL COMMENT 'æ•°æ®èŒƒå›´ï¼š1å…¨éƒ¨ 2æœ¬éƒ¨é—¨ 3æœ¬éƒ¨é—¨åŠä¸‹çº§ 4ä»…æœ¬äºº 5è‡ªå®šä¹‰',
    dept_ids VARCHAR(500) COMMENT 'è‡ªå®šä¹‰éƒ¨é—¨IDåˆ—è¡¨ï¼Œé€—å·åˆ†éš”',
    PRIMARY KEY (role_id)
);
```

**æ•°æ®èŒƒå›´å¸¸é‡**ï¼š
```java
public class DataScopeConstants {
    public static final int ALL = 1;              // å…¨éƒ¨æ•°æ®
    public static final int DEPT = 2;             // æœ¬éƒ¨é—¨
    public static final int DEPT_AND_CHILD = 3;   // æœ¬éƒ¨é—¨åŠä¸‹çº§
    public static final int SELF = 4;             // ä»…æœ¬äºº
    public static final int CUSTOM = 5;           // è‡ªå®šä¹‰
}
```

### 6.4 æ•°æ®æƒé™å®ç°


**æ–¹å¼ä¸€ï¼šSQLæ‹¼æ¥ï¼ˆç®€å•ä½†ä¸å¤Ÿä¼˜é›…ï¼‰**

```java
@Service
public class OrderService {
    
    public List<Order> getOrderList() {
        // 1. è·å–å½“å‰ç”¨æˆ·
        User currentUser = SecurityUtils.getCurrentUser();
        
        // 2. è·å–ç”¨æˆ·çš„æ•°æ®æƒé™èŒƒå›´
        int dataScope = userService.getUserDataScope(currentUser.getId());
        
        // 3. æ ¹æ®æ•°æ®æƒé™æ„å»ºSQLæ¡ä»¶
        String sqlCondition = "";
        
        switch (dataScope) {
            case DataScopeConstants.ALL:
                // å…¨éƒ¨æ•°æ®ï¼Œä¸åŠ æ¡ä»¶
                sqlCondition = "";
                break;
                
            case DataScopeConstants.DEPT:
                // æœ¬éƒ¨é—¨æ•°æ®
                sqlCondition = " AND dept_id = " + currentUser.getDeptId();
                break;
                
            case DataScopeConstants.DEPT_AND_CHILD:
                // æœ¬éƒ¨é—¨åŠä¸‹çº§éƒ¨é—¨
                List<Long> deptIds = deptService.getChildDeptIds(currentUser.getDeptId());
                sqlCondition = " AND dept_id IN (" + String.join(",", deptIds.toString()) + ")";
                break;
                
            case DataScopeConstants.SELF:
                // ä»…æœ¬äººæ•°æ®
                sqlCondition = " AND create_by = " + currentUser.getId();
                break;
        }
        
        // 4. æ‰§è¡ŒæŸ¥è¯¢
        return orderMapper.selectList(sqlCondition);
    }
}
```

**æ–¹å¼äºŒï¼šMyBatisæ‹¦æˆªå™¨ï¼ˆæ¨èæ–¹å¼ï¼‰**

```java
@Intercepts({
    @Signature(
        type = StatementHandler.class,
        method = "prepare",
        args = {Connection.class, Integer.class}
    )
})
public class DataScopeInterceptor implements Interceptor {
    
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        StatementHandler handler = (StatementHandler) invocation.getTarget();
        BoundSql boundSql = handler.getBoundSql();
        String originalSql = boundSql.getSql();
        
        // 1. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        User currentUser = SecurityUtils.getCurrentUser();
        
        // 2. è·å–æ•°æ®æƒé™èŒƒå›´
        int dataScope = getUserDataScope(currentUser.getId());
        
        // 3. æ ¹æ®æ•°æ®æƒé™ä¿®æ”¹SQL
        String newSql = originalSql;
        
        if (dataScope == DataScopeConstants.DEPT) {
            newSql = originalSql + " AND dept_id = " + currentUser.getDeptId();
        } else if (dataScope == DataScopeConstants.SELF) {
            newSql = originalSql + " AND create_by = " + currentUser.getId();
        }
        
        // 4. æ›¿æ¢SQL
        Field field = boundSql.getClass().getDeclaredField("sql");
        field.setAccessible(true);
        field.set(boundSql, newSql);
        
        return invocation.proceed();
    }
}
```

**æ–¹å¼ä¸‰ï¼šè‡ªå®šä¹‰æ³¨è§£ï¼ˆæœ€ä¼˜é›…ï¼‰**

```java
// 1. å®šä¹‰æ•°æ®æƒé™æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataScope {
    // éƒ¨é—¨å­—æ®µå
    String deptAlias() default "dept_id";
    // ç”¨æˆ·å­—æ®µå
    String userAlias() default "create_by";
}

// 2. ä½¿ç”¨æ³¨è§£
@Mapper
public interface OrderMapper {
    
    @DataScope(deptAlias = "o.dept_id", userAlias = "o.create_by")
    List<Order> selectOrderList();
}

// 3. AOPæ‹¦æˆªå¤„ç†
@Aspect
@Component
public class DataScopeAspect {
    
    @Around("@annotation(dataScope)")
    public Object around(ProceedingJoinPoint point, DataScope dataScope) {
        // è·å–å½“å‰ç”¨æˆ·
        User user = SecurityUtils.getCurrentUser();
        
        // æ„å»ºæ•°æ®æƒé™SQLç‰‡æ®µ
        String sqlCondition = buildDataScopeSql(user, dataScope);
        
        // å°†SQLç‰‡æ®µå­˜å…¥ThreadLocal
        DataScopeContext.setSqlCondition(sqlCondition);
        
        try {
            return point.proceed();
        } finally {
            DataScopeContext.clear();
        }
    }
}
```

### 6.5 æ•°æ®æƒé™åº”ç”¨ç¤ºä¾‹


**åœºæ™¯ï¼šè®¢å•æŸ¥è¯¢**

```
å…¬å¸ç»„ç»‡æ¶æ„ï¼š
æ€»å…¬å¸
â”œâ”€â”€ åä¸œåŒº
â”‚   â”œâ”€â”€ ä¸Šæµ·åˆ†å…¬å¸
â”‚   â””â”€â”€ æ­å·åˆ†å…¬å¸
â””â”€â”€ åå—åŒº
    â”œâ”€â”€ å¹¿å·åˆ†å…¬å¸
    â””â”€â”€ æ·±åœ³åˆ†å…¬å¸

è®¢å•æ•°æ®ï¼š
è®¢å•1ï¼šåˆ›å»ºäºº=å¼ ä¸‰ï¼Œæ‰€å±éƒ¨é—¨=ä¸Šæµ·åˆ†å…¬å¸
è®¢å•2ï¼šåˆ›å»ºäºº=æå››ï¼Œæ‰€å±éƒ¨é—¨=ä¸Šæµ·åˆ†å…¬å¸
è®¢å•3ï¼šåˆ›å»ºäºº=ç‹äº”ï¼Œæ‰€å±éƒ¨é—¨=æ­å·åˆ†å…¬å¸
è®¢å•4ï¼šåˆ›å»ºäºº=èµµå…­ï¼Œæ‰€å±éƒ¨é—¨=å¹¿å·åˆ†å…¬å¸

ç”¨æˆ·æ•°æ®æƒé™ï¼š
â€¢ å¼ ä¸‰ï¼ˆæ™®é€šå‘˜å·¥ï¼‰ï¼šä»…æœ¬äººæ•°æ® â†’ åªèƒ½çœ‹åˆ°è®¢å•1
â€¢ ä¸Šæµ·ç»ç†ï¼šæœ¬éƒ¨é—¨æ•°æ® â†’ èƒ½çœ‹åˆ°è®¢å•1ã€2
â€¢ åä¸œæ€»ç›‘ï¼šæœ¬éƒ¨é—¨åŠä¸‹çº§ â†’ èƒ½çœ‹åˆ°è®¢å•1ã€2ã€3
â€¢ æ€»ç»ç†ï¼šå…¨éƒ¨æ•°æ® â†’ èƒ½çœ‹åˆ°æ‰€æœ‰è®¢å•
```

---

## 7. ğŸ’¾ æƒé™ç¼“å­˜ç­–ç•¥


### 7.1 ä¸ºä»€ä¹ˆéœ€è¦æƒé™ç¼“å­˜


**é—®é¢˜åœºæ™¯**ï¼š
```
ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½è¦ï¼š
1. æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²
2. æŸ¥è¯¢è§’è‰²çš„æƒé™
3. æ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®æƒé™

å¦‚æœæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“ï¼š
â€¢ å“åº”æ…¢ï¼ˆå¤šæ¬¡æ•°æ®åº“æŸ¥è¯¢ï¼‰
â€¢ æ€§èƒ½å·®ï¼ˆé«˜å¹¶å‘ä¸‹æ•°æ®åº“å‹åŠ›å¤§ï¼‰
â€¢ ä½“éªŒå·®ï¼ˆç”¨æˆ·ç­‰å¾…æ—¶é—´é•¿ï¼‰
```

**ä½¿ç”¨ç¼“å­˜å**ï¼š
```
é¦–æ¬¡ç™»å½•ï¼šæŸ¥æ•°æ®åº“ â†’ å­˜å…¥ç¼“å­˜
åç»­è¯·æ±‚ï¼šç›´æ¥ä»ç¼“å­˜è¯»å– â†’ é€Ÿåº¦å¿«
```

### 7.2 ç¼“å­˜æ–¹æ¡ˆé€‰æ‹©


| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **Session** | ç®€å•ã€è‡ªå¸¦ | å•æœºã€ä¸èƒ½å…±äº« | å°å‹å•ä½“åº”ç”¨ |
| **Redis** | åˆ†å¸ƒå¼ã€é«˜æ€§èƒ½ | éœ€è¦é¢å¤–éƒ¨ç½² | åˆ†å¸ƒå¼ç³»ç»Ÿ |
| **æœ¬åœ°ç¼“å­˜** | æ€§èƒ½æœ€é«˜ | æ•°æ®ä¸å…±äº« | è¯»å¤šå†™å°‘åœºæ™¯ |

### 7.3 Redisç¼“å­˜å®ç°


**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
ç”¨æˆ·æƒé™ï¼šuser:permissions:{userId}
ç”¨æˆ·è§’è‰²ï¼šuser:roles:{userId}
è§’è‰²æƒé™ï¼šrole:permissions:{roleId}
èœå•æ ‘ï¼š  menu:tree:{userId}
```

**Serviceå®ç°**ï¼š

```java
@Service
public class PermissionCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private UserService userService;
    
    private static final String USER_PERMISSIONS_KEY = "user:permissions:";
    private static final long CACHE_EXPIRE_TIME = 30; // 30åˆ†é’Ÿè¿‡æœŸ
    
    /**
     * è·å–ç”¨æˆ·æƒé™ï¼ˆä¼˜å…ˆä»ç¼“å­˜ï¼‰
     */
    public Set<String> getUserPermissions(Long userId) {
        String key = USER_PERMISSIONS_KEY + userId;
        
        // 1. å…ˆä»ç¼“å­˜è·å–
        Set<String> permissions = (Set<String>) redisTemplate.opsForValue().get(key);
        
        // 2. ç¼“å­˜æ²¡æœ‰ï¼ŒæŸ¥æ•°æ®åº“
        if (permissions == null) {
            permissions = userService.getUserPermissionsFromDB(userId);
            
            // 3. å­˜å…¥ç¼“å­˜
            redisTemplate.opsForValue().set(
                key, 
                permissions, 
                CACHE_EXPIRE_TIME, 
                TimeUnit.MINUTES
            );
        }
        
        return permissions;
    }
    
    /**
     * æ¸…é™¤ç”¨æˆ·æƒé™ç¼“å­˜ï¼ˆæƒé™å˜æ›´æ—¶è°ƒç”¨ï¼‰
     */
    public void clearUserPermissionsCache(Long userId) {
        String key = USER_PERMISSIONS_KEY + userId;
        redisTemplate.delete(key);
    }
    
    /**
     * æ¸…é™¤è§’è‰²ç›¸å…³çš„æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼ˆè§’è‰²æƒé™å˜æ›´æ—¶ï¼‰
     */
    public void clearRoleRelatedCache(Long roleId) {
        // è·å–æ‹¥æœ‰è¯¥è§’è‰²çš„æ‰€æœ‰ç”¨æˆ·
        List<Long> userIds = userService.getUserIdsByRoleId(roleId);
        
        // æ‰¹é‡åˆ é™¤ç”¨æˆ·æƒé™ç¼“å­˜
        List<String> keys = userIds.stream()
            .map(id -> USER_PERMISSIONS_KEY + id)
            .collect(Collectors.toList());
            
        redisTemplate.delete(keys);
    }
}
```

### 7.4 ç¼“å­˜æ›´æ–°ç­–ç•¥


**æ›´æ–°æ—¶æœº**ï¼š

âœ… **ä¸»åŠ¨æ¸…é™¤**ï¼ˆæ¨èï¼‰ï¼š
```java
// ä¿®æ”¹ç”¨æˆ·è§’è‰²æ—¶
public void updateUserRoles(Long userId, List<Long> roleIds) {
    // 1. æ›´æ–°æ•°æ®åº“
    userRoleMapper.updateUserRoles(userId, roleIds);
    
    // 2. æ¸…é™¤ç¼“å­˜
    permissionCacheService.clearUserPermissionsCache(userId);
}

// ä¿®æ”¹è§’è‰²æƒé™æ—¶
public void updateRolePermissions(Long roleId, List<Long> permissionIds) {
    // 1. æ›´æ–°æ•°æ®åº“
    rolePermissionMapper.updateRolePermissions(roleId, permissionIds);
    
    // 2. æ¸…é™¤è¯¥è§’è‰²ç›¸å…³çš„æ‰€æœ‰ç”¨æˆ·ç¼“å­˜
    permissionCacheService.clearRoleRelatedCache(roleId);
}
```

â° **å®šæ—¶åˆ·æ–°**ï¼š
```java
@Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹
public void refreshPermissionCache() {
    // æ¸…ç©ºæ‰€æœ‰æƒé™ç¼“å­˜
    Set<String> keys = redisTemplate.keys("user:permissions:*");
    redisTemplate.delete(keys);
}
```

---

## 8. ğŸš¦ æƒé™æ‹¦æˆªå™¨å®ç°


### 8.1 æ‹¦æˆªå™¨çš„ä½œç”¨


**æ ¸å¿ƒåŠŸèƒ½**ï¼š
åœ¨è¯·æ±‚åˆ°è¾¾Controllerä¹‹å‰ï¼Œæå‰æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æƒé™ã€‚

**æ‹¦æˆªæµç¨‹**ï¼š
```
å®¢æˆ·ç«¯è¯·æ±‚
   â†“
æ‹¦æˆªå™¨æ‹¦æˆª
   â†“
æ£€æŸ¥æ˜¯å¦ç™»å½•
   â†“
æ£€æŸ¥æ˜¯å¦æœ‰æƒé™
   â†“
æœ‰æƒé™ â†’ æ”¾è¡Œ â†’ Controller
æ— æƒé™ â†’ æ‹’ç» â†’ è¿”å›403
```

### 8.2 è‡ªå®šä¹‰æƒé™æ‹¦æˆªå™¨


```java
@Component
public class PermissionInterceptor implements HandlerInterceptor {
    
    @Autowired
    private PermissionCacheService permissionCacheService;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) throws Exception {
        
        // 1. è·å–å½“å‰è¯·æ±‚çš„URI
        String requestUri = request.getRequestURI();
        
        // 2. è·å–å½“å‰ç™»å½•ç”¨æˆ·
        User currentUser = SecurityUtils.getCurrentUser();
        if (currentUser == null) {
            response.setStatus(401);
            return false; // æœªç™»å½•ï¼Œæ‹’ç»è®¿é—®
        }
        
        // 3. è·å–ç”¨æˆ·æƒé™
        Set<String> userPermissions = permissionCacheService
            .getUserPermissions(currentUser.getId());
        
        // 4. æ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®è¯¥URIçš„æƒé™
        if (!hasPermission(requestUri, userPermissions)) {
            response.setStatus(403); // æ— æƒé™
            response.getWriter().write("æ— è®¿é—®æƒé™");
            return false;
        }
        
        return true; // æœ‰æƒé™ï¼Œæ”¾è¡Œ
    }
    
    /**
     * æ£€æŸ¥æƒé™
     */
    private boolean hasPermission(String uri, Set<String> permissions) {
        // ä»é…ç½®æˆ–æ•°æ®åº“ä¸­è·å–URIå¯¹åº”çš„æƒé™æ ‡è¯†
        String requiredPermission = getPermissionByUri(uri);
        
        if (requiredPermission == null) {
            return true; // ä¸éœ€è¦æƒé™çš„æ¥å£ï¼Œç›´æ¥æ”¾è¡Œ
        }
        
        return permissions.contains(requiredPermission);
    }
}
```

**æ³¨å†Œæ‹¦æˆªå™¨**ï¼š

```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    
    @Autowired
    private PermissionInterceptor permissionInterceptor;
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(permissionInterceptor)
            .addPathPatterns("/**")  // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
            .excludePathPatterns(    // æ’é™¤ä¸éœ€è¦æƒé™çš„è·¯å¾„
                "/login",
                "/logout",
                "/captcha",
                "/static/**"
            );
    }
}
```

### 8.3 Spring Securityé›†æˆ


**Securityé…ç½®ç±»**ï¼š

```java
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true) // å¯ç”¨æ–¹æ³•çº§æƒé™
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            // å…³é—­CSRF
            .csrf().disable()
            
            // é…ç½®æƒé™
            .authorizeRequests()
                .antMatchers("/login", "/captcha").permitAll() // å…è®¸åŒ¿åè®¿é—®
                .anyRequest().authenticated() // å…¶ä»–è¯·æ±‚éœ€è¦è®¤è¯
            
            // é…ç½®ç™»å½•
            .and()
            .formLogin()
                .loginProcessingUrl("/login")
                .successHandler(loginSuccessHandler())
                .failureHandler(loginFailureHandler())
            
            // é…ç½®ç™»å‡º
            .and()
            .logout()
                .logoutUrl("/logout")
                .logoutSuccessHandler(logoutSuccessHandler());
    }
    
    /**
     * ç™»å½•æˆåŠŸå¤„ç†
     */
    private AuthenticationSuccessHandler loginSuccessHandler() {
        return (request, response, authentication) -> {
            User user = (User) authentication.getPrincipal();
            
            // åŠ è½½ç”¨æˆ·æƒé™åˆ°ç¼“å­˜
            permissionCacheService.getUserPermissions(user.getId());
            
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write(JSON.toJSONString(
                Result.success("ç™»å½•æˆåŠŸ", user)
            ));
        };
    }
}
```

---

## 9. ğŸ“Œ æƒé™æ³¨è§£åº”ç”¨


### 9.1 å¸¸ç”¨æƒé™æ³¨è§£


**Spring Securityæä¾›çš„æ³¨è§£**ï¼š

| æ³¨è§£ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `@PreAuthorize` | æ–¹æ³•æ‰§è¡Œå‰æ£€æŸ¥ | `@PreAuthorize("hasAuthority('user:add')")` |
| `@PostAuthorize` | æ–¹æ³•æ‰§è¡Œåæ£€æŸ¥ | `@PostAuthorize("returnObject.userId == principal.id")` |
| `@Secured` | è§’è‰²æ£€æŸ¥ | `@Secured("ROLE_ADMIN")` |
| `@RolesAllowed` | JSR-250è§’è‰²æ£€æŸ¥ | `@RolesAllowed("ADMIN")` |

### 9.2 æ³¨è§£ä½¿ç”¨ç¤ºä¾‹


**å•ä¸ªæƒé™**ï¼š
```java
@PreAuthorize("hasAuthority('system:user:add')")
public Result addUser(@RequestBody User user) {
    // éœ€è¦ system:user:add æƒé™
}
```

**å¤šä¸ªæƒé™ï¼ˆæˆ–å…³ç³»ï¼‰**ï¼š
```java
@PreAuthorize("hasAnyAuthority('user:add', 'user:import')")
public Result addUser(@RequestBody User user) {
    // åªè¦æœ‰ user:add æˆ– user:import å…¶ä¸­ä¸€ä¸ªæƒé™å³å¯
}
```

**å¤šä¸ªæƒé™ï¼ˆä¸”å…³ç³»ï¼‰**ï¼š
```java
@PreAuthorize("hasAuthority('order:approve') and hasAuthority('order:view')")
public Result approveOrder(Long orderId) {
    // å¿…é¡»åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªæƒé™
}
```

**è§’è‰²æ£€æŸ¥**ï¼š
```java
@PreAuthorize("hasRole('ADMIN')")
public Result systemConfig() {
    // å¿…é¡»æ˜¯ADMINè§’è‰²
}

@PreAuthorize("hasAnyRole('ADMIN', 'MANAGER')")
public Result viewReport() {
    // ADMINæˆ–MANAGERè§’è‰²éƒ½å¯ä»¥è®¿é—®
}
```

**è‡ªå®šä¹‰æ¡ä»¶**ï¼š
```java
@PreAuthorize("@permissionService.hasPermission(#userId)")
public Result getUserInfo(Long userId) {
    // è°ƒç”¨è‡ªå®šä¹‰çš„æƒé™æ£€æŸ¥æ–¹æ³•
}
```

### 9.3 è‡ªå®šä¹‰æƒé™æ³¨è§£


**å®šä¹‰æ³¨è§£**ï¼š

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    String value(); // æƒé™æ ‡è¯†
    
    LogicalOperator logical() default LogicalOperator.AND; // é€»è¾‘å…³ç³»
    
    enum LogicalOperator {
        AND, OR
    }
}
```

**AOPæ‹¦æˆªå¤„ç†**ï¼š

```java
@Aspect
@Component
public class PermissionAspect {
    
    @Autowired
    private PermissionCacheService permissionCacheService;
    
    @Before("@annotation(requirePermission)")
    public void checkPermission(RequirePermission requirePermission) {
        // 1. è·å–å½“å‰ç”¨æˆ·
        User user = SecurityUtils.getCurrentUser();
        
        // 2. è·å–ç”¨æˆ·æƒé™
        Set<String> userPermissions = permissionCacheService
            .getUserPermissions(user.getId());
        
        // 3. æ£€æŸ¥æƒé™
        String[] requiredPermissions = requirePermission.value().split(",");
        boolean hasPermission = false;
        
        if (requirePermission.logical() == LogicalOperator.AND) {
            // ANDï¼šå¿…é¡»æ‹¥æœ‰æ‰€æœ‰æƒé™
            hasPermission = userPermissions.containsAll(
                Arrays.asList(requiredPermissions)
            );
        } else {
            // ORï¼šæ‹¥æœ‰ä»»ä¸€æƒé™å³å¯
            for (String perm : requiredPermissions) {
                if (userPermissions.contains(perm)) {
                    hasPermission = true;
                    break;
                }
            }
        }
        
        // 4. æ— æƒé™åˆ™æŠ›å‡ºå¼‚å¸¸
        if (!hasPermission) {
            throw new AccessDeniedException("æƒé™ä¸è¶³");
        }
    }
}
```

**ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£**ï¼š

```java
@RestController
public class OrderController {
    
    @RequirePermission("order:add")
    public Result addOrder() {
        // éœ€è¦order:addæƒé™
    }
    
    @RequirePermission(value = "order:approve,order:view", logical = OR)
    public Result getOrderDetail() {
        // æ‹¥æœ‰approveæˆ–viewæƒé™ä¹‹ä¸€å³å¯
    }
}
```

---

## 10. ğŸ”„ åŠ¨æ€æƒé™åŠ è½½


### 10.1 ä»€ä¹ˆæ˜¯åŠ¨æ€æƒé™


**ä¼ ç»Ÿæ–¹å¼ï¼ˆé™æ€æƒé™ï¼‰**ï¼š
```
æƒé™å†™æ­»åœ¨ä»£ç é‡Œï¼š
@PreAuthorize("hasAuthority('user:add')")

ç¼ºç‚¹ï¼š
â€¢ æƒé™æ ‡è¯†ç¡¬ç¼–ç 
â€¢ ä¿®æ”¹æƒé™éœ€è¦æ”¹ä»£ç ã€é‡æ–°éƒ¨ç½²
â€¢ ä¸å¤Ÿçµæ´»
```

**åŠ¨æ€æƒé™æ–¹å¼**ï¼š
```
æƒé™é…ç½®åœ¨æ•°æ®åº“ï¼š
â€¢ å¯é€šè¿‡ç®¡ç†ç•Œé¢ä¿®æ”¹æƒé™
â€¢ æƒé™å˜æ›´å®æ—¶ç”Ÿæ•ˆ
â€¢ æ— éœ€é‡å¯æœåŠ¡
```

### 10.2 åŠ¨æ€æƒé™è¡¨è®¾è®¡


```sql
-- èµ„æºæƒé™é…ç½®è¡¨
CREATE TABLE sys_resource_permission (
    id BIGINT PRIMARY KEY,
    resource_name VARCHAR(100) COMMENT 'èµ„æºåç§°',
    resource_type VARCHAR(20) COMMENT 'èµ„æºç±»å‹ï¼šURL/METHOD',
    resource_path VARCHAR(200) COMMENT 'èµ„æºè·¯å¾„',
    permission_code VARCHAR(100) COMMENT 'æ‰€éœ€æƒé™æ ‡è¯†',
    match_type VARCHAR(20) COMMENT 'åŒ¹é…æ–¹å¼ï¼šEXACT/PREFIX/PATTERN'
);
```

**ç¤ºä¾‹æ•°æ®**ï¼š
```sql
INSERT INTO sys_resource_permission VALUES
(1, 'ç”¨æˆ·åˆ—è¡¨', 'URL', '/system/user/list', 'system:user:view', 'EXACT'),
(2, 'æ–°å¢ç”¨æˆ·', 'URL', '/system/user/add', 'system:user:add', 'EXACT'),
(3, 'ç”¨æˆ·ç®¡ç†', 'URL', '/system/user/**', 'system:user:view', 'PATTERN');
```

### 10.3 åŠ¨æ€æƒé™åŠ è½½å®ç°


**æƒé™é…ç½®åŠ è½½Service**ï¼š

```java
@Service
public class DynamicPermissionService {
    
    @Autowired
    private ResourcePermissionMapper resourceMapper;
    
    // ç¼“å­˜èµ„æºæƒé™é…ç½®
    private Map<String, String> resourcePermissionMap = new ConcurrentHashMap<>();
    
    /**
     * å¯åŠ¨æ—¶åŠ è½½æƒé™é…ç½®
     */
    @PostConstruct
    public void loadPermissions() {
        List<ResourcePermission> resources = resourceMapper.selectAll();
        
        for (ResourcePermission resource : resources) {
            resourcePermissionMap.put(
                resource.getResourcePath(), 
                resource.getPermissionCode()
            );
        }
    }
    
    /**
     * è·å–URLå¯¹åº”çš„æƒé™æ ‡è¯†
     */
    public String getPermissionByUrl(String url) {
        // 1. ç²¾ç¡®åŒ¹é…
        if (resourcePermissionMap.containsKey(url)) {
            return resourcePermissionMap.get(url);
        }
        
        // 2. æ¨¡å¼åŒ¹é…ï¼ˆå¦‚ /user/** åŒ¹é… /user/listï¼‰
        for (Map.Entry<String, String> entry : resourcePermissionMap.entrySet()) {
            String pattern = entry.getKey();
            if (matchPattern(pattern, url)) {
                return entry.getValue();
            }
        }
        
        return null; // ä¸éœ€è¦æƒé™
    }
    
    /**
     * é‡æ–°åŠ è½½æƒé™é…ç½®ï¼ˆæƒé™å˜æ›´æ—¶è°ƒç”¨ï¼‰
     */
    public void reloadPermissions() {
        resourcePermissionMap.clear();
        loadPermissions();
    }
}
```

**æƒé™æ‹¦æˆªå™¨ä½¿ç”¨åŠ¨æ€é…ç½®**ï¼š

```java
@Component
public class DynamicPermissionInterceptor implements HandlerInterceptor {
    
    @Autowired
    private DynamicPermissionService dynamicPermissionService;
    
    @Autowired
    private PermissionCacheService permissionCacheService;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) {
        
        String url = request.getRequestURI();
        
        // 1. ä»åŠ¨æ€é…ç½®è·å–æ‰€éœ€æƒé™
        String requiredPermission = dynamicPermissionService.getPermissionByUrl(url);
        
        if (requiredPermission == null) {
            return true; // ä¸éœ€è¦æƒé™ï¼Œæ”¾è¡Œ
        }
        
        // 2. è·å–ç”¨æˆ·æƒé™
        User user = SecurityUtils.getCurrentUser();
        Set<String> userPermissions = permissionCacheService
            .getUserPermissions(user.getId());
        
        // 3. æ£€æŸ¥æƒé™
        if (!userPermissions.contains(requiredPermission)) {
            response.setStatus(403);
            return false;
        }
        
        return true;
    }
}
```

### 10.4 æƒé™é…ç½®ç®¡ç†æ¥å£


**Controllerå®ç°**ï¼š

```java
@RestController
@RequestMapping("/system/permission")
public class PermissionConfigController {
    
    @Autowired
    private DynamicPermissionService dynamicPermissionService;
    
    /**
     * æ–°å¢èµ„æºæƒé™é…ç½®
     */
    @PostMapping("/resource")
    @PreAuthorize("hasAuthority('system:permission:config')")
    public Result addResourcePermission(@RequestBody ResourcePermission resource) {
        resourceMapper.insert(resource);
        
        // é‡æ–°åŠ è½½æƒé™é…ç½®
        dynamicPermissionService.reloadPermissions();
        
        return Result.success("é…ç½®æˆåŠŸ");
    }
    
    /**
     * ä¿®æ”¹èµ„æºæƒé™é…ç½®
     */
    @PutMapping("/resource")
    @PreAuthorize("hasAuthority('system:permission:config')")
    public Result updateResourcePermission(@RequestBody ResourcePermission resource) {
        resourceMapper.updateById(resource);
        
        // é‡æ–°åŠ è½½æƒé™é…ç½®
        dynamicPermissionService.reloadPermissions();
        
        return Result.success("æ›´æ–°æˆåŠŸ");
    }
}
```

---

## 11. ğŸ“ æƒé™å®¡è®¡æ—¥å¿—


### 11.1 å®¡è®¡æ—¥å¿—çš„ä½œç”¨


**ä¸ºä»€ä¹ˆéœ€è¦å®¡è®¡æ—¥å¿—**ï¼Ÿ

âœ… **å®‰å…¨åˆè§„**ï¼šæ»¡è¶³ç­‰ä¿ã€ISO27001ç­‰å®‰å…¨æ ‡å‡†è¦æ±‚
âœ… **é—®é¢˜è¿½æº¯**ï¼šå‡ºç°é—®é¢˜æ—¶èƒ½æ‰¾åˆ°æ“ä½œè®°å½•
âœ… **è¡Œä¸ºåˆ†æ**ï¼šåˆ†æç”¨æˆ·æ“ä½œä¹ æƒ¯ï¼Œä¼˜åŒ–ç³»ç»Ÿ
âœ… **è´£ä»»è®¤å®š**ï¼šæ˜ç¡®æ“ä½œè´£ä»»äºº

**è®°å½•å†…å®¹**ï¼š
```
è°(Who)ï¼šæ“ä½œäººå‘˜
ä»€ä¹ˆæ—¶å€™(When)ï¼šæ“ä½œæ—¶é—´
åœ¨å“ªé‡Œ(Where)ï¼šIPåœ°å€ã€ä½ç½®
åšäº†ä»€ä¹ˆ(What)ï¼šæ“ä½œå†…å®¹
ç»“æœå¦‚ä½•(Result)ï¼šæˆåŠŸ/å¤±è´¥
```

### 11.2 å®¡è®¡æ—¥å¿—è¡¨è®¾è®¡


```sql
CREATE TABLE sys_audit_log (
    id BIGINT PRIMARY KEY,
    user_id BIGINT COMMENT 'æ“ä½œç”¨æˆ·ID',
    username VARCHAR(50) COMMENT 'ç”¨æˆ·å',
    operation_type VARCHAR(50) COMMENT 'æ“ä½œç±»å‹ï¼šLOGIN/LOGOUT/ADD/DELETE/UPDATE/QUERY',
    operation_module VARCHAR(100) COMMENT 'æ“ä½œæ¨¡å—',
    operation_desc VARCHAR(500) COMMENT 'æ“ä½œæè¿°',
    request_method VARCHAR(10) COMMENT 'è¯·æ±‚æ–¹æ³•ï¼šGET/POST',
    request_url VARCHAR(200) COMMENT 'è¯·æ±‚URL',
    request_params TEXT COMMENT 'è¯·æ±‚å‚æ•°',
    response_result TEXT COMMENT 'å“åº”ç»“æœ',
    ip_address VARCHAR(50) COMMENT 'IPåœ°å€',
    location VARCHAR(100) COMMENT 'æ“ä½œåœ°ç‚¹',
    browser VARCHAR(100) COMMENT 'æµè§ˆå™¨',
    os VARCHAR(100) COMMENT 'æ“ä½œç³»ç»Ÿ',
    status INT COMMENT 'çŠ¶æ€ï¼š1æˆåŠŸ 0å¤±è´¥',
    error_msg VARCHAR(500) COMMENT 'é”™è¯¯ä¿¡æ¯',
    execute_time BIGINT COMMENT 'æ‰§è¡Œæ—¶é•¿(æ¯«ç§’)',
    create_time DATETIME COMMENT 'æ“ä½œæ—¶é—´'
);
```

### 11.3 å®¡è®¡æ—¥å¿—è®°å½•å®ç°


**è‡ªå®šä¹‰å®¡è®¡æ³¨è§£**ï¼š

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AuditLog {
    String module(); // æ“ä½œæ¨¡å—
    String operation(); // æ“ä½œç±»å‹
    String description() default ""; // æ“ä½œæè¿°
}
```

**AOPåˆ‡é¢è®°å½•æ—¥å¿—**ï¼š

```java
@Aspect
@Component
public class AuditLogAspect {
    
    @Autowired
    private AuditLogService auditLogService;
    
    @Around("@annotation(auditLog)")
    public Object around(ProceedingJoinPoint point, AuditLog auditLog) throws Throwable {
        
        long startTime = System.currentTimeMillis();
        SysAuditLog log = new SysAuditLog();
        
        try {
            // 1. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
            User user = SecurityUtils.getCurrentUser();
            log.setUserId(user.getId());
            log.setUsername(user.getUsername());
            
            // 2. è·å–è¯·æ±‚ä¿¡æ¯
            HttpServletRequest request = getRequest();
            log.setRequestMethod(request.getMethod());
            log.setRequestUrl(request.getRequestURI());
            log.setIpAddress(getIpAddress(request));
            log.setBrowser(getBrowser(request));
            
            // 3. è·å–æ–¹æ³•å‚æ•°
            Object[] args = point.getArgs();
            log.setRequestParams(JSON.toJSONString(args));
            
            // 4. è®¾ç½®æ“ä½œä¿¡æ¯
            log.setOperationModule(auditLog.module());
            log.setOperationType(auditLog.operation());
            log.setOperationDesc(auditLog.description());
            
            // 5. æ‰§è¡Œæ–¹æ³•
            Object result = point.proceed();
            
            // 6. è®°å½•æˆåŠŸç»“æœ
            log.setStatus(1);
            log.setResponseResult(JSON.toJSONString(result));
            
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥ä¿¡æ¯
            log.setStatus(0);
            log.setErrorMsg(e.getMessage());
            throw e;
            
        } finally {
            // è®¡ç®—æ‰§è¡Œæ—¶é•¿
            long executeTime = System.currentTimeMillis() - startTime;
            log.setExecuteTime(executeTime);
            log.setCreateTime(new Date());
            
            // å¼‚æ­¥ä¿å­˜æ—¥å¿—
            auditLogService.saveAsync(log);
        }
    }
}
```

**ä½¿ç”¨å®¡è®¡æ³¨è§£**ï¼š

```java
@RestController
@RequestMapping("/system/user")
public class UserController {
    
    @PostMapping("/add")
    @AuditLog(module = "ç”¨æˆ·ç®¡ç†", operation = "æ–°å¢", description = "æ–°å¢ç”¨æˆ·")
    public Result addUser(@RequestBody User user) {
        userService.save(user);
        return Result.success();
    }
    
    @DeleteMapping("/{id}")
    @AuditLog(module = "ç”¨æˆ·ç®¡ç†", operation = "åˆ é™¤", description = "åˆ é™¤ç”¨æˆ·")
    public Result deleteUser(@PathVariable Long id) {
        userService.removeById(id);
        return Result.success();
    }
    
    @PostMapping("/login")
    @AuditLog(module = "ç³»ç»Ÿ", operation = "ç™»å½•", description = "ç”¨æˆ·ç™»å½•")
    public Result login(@RequestBody LoginDTO loginDTO) {
        // ç™»å½•é€»è¾‘
        return Result.success();
    }
}
```

### 11.4 å¼‚æ­¥æ—¥å¿—ä¿å­˜


**å¼‚æ­¥é…ç½®**ï¼š

```java
@Configuration
@EnableAsync
public class AsyncConfig {
    
    @Bean
    public Executor auditLogExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("audit-log-");
        executor.initialize();
        return executor;
    }
}
```

**å¼‚æ­¥Service**ï¼š

```java
@Service
public class AuditLogService {
    
    @Autowired
    private AuditLogMapper auditLogMapper;
    
    /**
     * å¼‚æ­¥ä¿å­˜å®¡è®¡æ—¥å¿—
     */
    @Async("auditLogExecutor")
    public void saveAsync(SysAuditLog log) {
        try {
            auditLogMapper.insert(log);
        } catch (Exception e) {
            // æ—¥å¿—ä¿å­˜å¤±è´¥ï¼Œè®°å½•åˆ°æ–‡ä»¶
            logger.error("å®¡è®¡æ—¥å¿—ä¿å­˜å¤±è´¥ï¼š{}", log, e);
        }
    }
}
```

### 11.5 å®¡è®¡æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æ


**æŸ¥è¯¢æ¥å£å®ç°**ï¼š

```java
@RestController
@RequestMapping("/system/audit-log")
public class AuditLogController {
    
    @Autowired
    private AuditLogService auditLogService;
    
    /**
     * åˆ†é¡µæŸ¥è¯¢å®¡è®¡æ—¥å¿—
     */
    @GetMapping("/list")
    @PreAuthorize("hasAuthority('system:audit:view')")
    public Result getAuditLogList(AuditLogQuery query) {
        Page<SysAuditLog> page = auditLogService.selectPage(query);
        return Result.success(page);
    }
    
    /**
     * å¯¼å‡ºå®¡è®¡æ—¥å¿—
     */
    @GetMapping("/export")
    @PreAuthorize("hasAuthority('system:audit:export')")
    @AuditLog(module = "å®¡è®¡æ—¥å¿—", operation = "å¯¼å‡º", description = "å¯¼å‡ºå®¡è®¡æ—¥å¿—")
    public void exportAuditLog(AuditLogQuery query, HttpServletResponse response) {
        List<SysAuditLog> logs = auditLogService.selectList(query);
        ExcelUtils.export(response, "å®¡è®¡æ—¥å¿—", logs);
    }
}
```

**æ—¥å¿—ç»Ÿè®¡åˆ†æ**ï¼š

```java
/**
 * ç»Ÿè®¡ç”¨æˆ·æ“ä½œé¢‘ç‡
 */
public Map<String, Long> statisticsUserOperation(Long userId, Date startTime, Date endTime) {
    return auditLogMapper.countByOperation(userId, startTime, endTime)
        .stream()
        .collect(Collectors.toMap(
            AuditStatistics::getOperationType,
            AuditStatistics::getCount
        ));
}

/**
 * ç»Ÿè®¡å¼‚å¸¸æ“ä½œï¼ˆå¤±è´¥çš„æ“ä½œï¼‰
 */
public List<SysAuditLog> getFailedOperations(Date startTime, Date endTime) {
    return auditLogMapper.selectFailedLogs(startTime, endTime);
}
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 æƒé™ç®¡ç†æ ¸å¿ƒæ¦‚å¿µå›é¡¾


```
ğŸ” æƒé™ç®¡ç†ä¸‰è¦ç´ 
â”œâ”€â”€ ä¸»ä½“(Who)ï¼šç”¨æˆ·ã€è§’è‰²
â”œâ”€â”€ èµ„æº(What)ï¼šèœå•ã€æŒ‰é’®ã€æ•°æ®ã€æ¥å£
â””â”€â”€ æ“ä½œ(How)ï¼šæŸ¥çœ‹ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤

ğŸ­ RBACæ¨¡å‹æ ¸å¿ƒ
â”œâ”€â”€ ç”¨æˆ·(User) â†â†’ è§’è‰²(Role) â†â†’ æƒé™(Permission)
â”œâ”€â”€ å¤šå¯¹å¤šå…³ç³»ï¼Œé€šè¿‡ä¸­é—´è¡¨å…³è”
â””â”€â”€ æƒé™æ‰“åŒ…æˆè§’è‰²ï¼Œè§’è‰²åˆ†é…ç»™ç”¨æˆ·
```

### 12.2 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†


**ğŸ”¹ æƒé™æ§åˆ¶å››ä¸ªå±‚æ¬¡**

| å±‚æ¬¡ | æ§åˆ¶å¯¹è±¡ | å®ç°æ–¹å¼ | ä½œç”¨èŒƒå›´ |
|------|---------|---------|----------|
| **èœå•æƒé™** | é¡µé¢è®¿é—® | æ•°æ®åº“+å‰ç«¯æ¸²æŸ“ | æ§åˆ¶èƒ½çœ‹åˆ°å“ªäº›èœå• |
| **æŒ‰é’®æƒé™** | åŠŸèƒ½æ“ä½œ | æ³¨è§£+å‰ç«¯v-if | æ§åˆ¶èƒ½ç‚¹å‡»å“ªäº›æŒ‰é’® |
| **æ¥å£æƒé™** | APIè°ƒç”¨ | æ‹¦æˆªå™¨+æ³¨è§£ | æ§åˆ¶èƒ½è°ƒç”¨å“ªäº›æ¥å£ |
| **æ•°æ®æƒé™** | æ•°æ®èŒƒå›´ | SQLæ‹¦æˆª+æ¡ä»¶è¿½åŠ  | æ§åˆ¶èƒ½æŸ¥çœ‹å“ªäº›æ•°æ® |

**ğŸ”¹ å…³é”®å®ç°æŠ€æœ¯**

```
âœ… æ•°æ®åº“è®¾è®¡ï¼š5å¼ æ ¸å¿ƒè¡¨æ„å»ºRBACæ¨¡å‹
âœ… æƒé™ç¼“å­˜ï¼šRedisç¼“å­˜æå‡æ€§èƒ½ï¼Œä¸»åŠ¨æ¸…é™¤ä¿è¯å®æ—¶æ€§
âœ… æƒé™æ‹¦æˆªï¼šæ‹¦æˆªå™¨/è¿‡æ»¤å™¨åœ¨è¯·æ±‚åˆ°è¾¾å‰æ ¡éªŒæƒé™
âœ… æƒé™æ³¨è§£ï¼š@PreAuthorizeç­‰æ³¨è§£å®ç°æ–¹æ³•çº§æƒé™æ§åˆ¶
âœ… åŠ¨æ€æƒé™ï¼šé…ç½®åŒ–æƒé™ï¼Œæ— éœ€é‡å¯å³å¯ç”Ÿæ•ˆ
âœ… å®¡è®¡æ—¥å¿—ï¼šAOPè®°å½•æ“ä½œæ—¥å¿—ï¼Œå®ç°å¯è¿½æº¯
```

### 12.3 å®é™…åº”ç”¨è¦ç‚¹


**ğŸ”¹ æƒé™è®¾è®¡åŸåˆ™**

```
æœ€å°æƒé™åŸåˆ™ï¼š
â€¢ ç”¨æˆ·é»˜è®¤æ— ä»»ä½•æƒé™
â€¢ æŒ‰éœ€åˆ†é…æœ€å°å¿…è¦æƒé™
â€¢ å®šæœŸå®¡æŸ¥å’Œå›æ”¶æƒé™

èŒè´£åˆ†ç¦»åŸåˆ™ï¼š
â€¢ å…³é”®æ“ä½œéœ€è¦å¤šäººé…åˆ
â€¢ é¿å…æƒé™è¿‡åº¦é›†ä¸­
â€¢ é‡è¦æ“ä½œéœ€è¦å®¡æ‰¹æµç¨‹

çµæ´»æ‰©å±•åŸåˆ™ï¼š
â€¢ æ”¯æŒåŠ¨æ€æ·»åŠ æƒé™
â€¢ æ”¯æŒä¸´æ—¶æˆæƒ
â€¢ æ”¯æŒæƒé™ç»§æ‰¿
```

**ğŸ”¹ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **æƒé™ä¸ç”Ÿæ•ˆ** | ç¼“å­˜æœªåˆ·æ–° | ä¿®æ”¹æƒé™åä¸»åŠ¨æ¸…é™¤ç¼“å­˜ |
| **æ€§èƒ½é—®é¢˜** | é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ | ä½¿ç”¨Redisç¼“å­˜æƒé™ä¿¡æ¯ |
| **æƒé™å†²çª** | å¤šä¸ªè§’è‰²æƒé™äº¤å‰ | æ˜ç¡®æƒé™ä¼˜å…ˆçº§è§„åˆ™ |
| **æ•°æ®æƒé™å¤±æ•ˆ** | SQLæ‹¼æ¥é”™è¯¯ | ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œé¿å…SQLæ³¨å…¥ |

**ğŸ”¹ å®‰å…¨æ³¨æ„äº‹é¡¹**

```
âš ï¸ å‰ç«¯æƒé™æ§åˆ¶åªæ˜¯è¾…åŠ©ï¼Œåç«¯å¿…é¡»ä¸¥æ ¼æ ¡éªŒ
âš ï¸ æ•æ„Ÿæ“ä½œå¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—
âš ï¸ æƒé™å˜æ›´è¦æœ‰å®¡æ‰¹æµç¨‹
âš ï¸ å®šæœŸæ£€æŸ¥å’Œæ¸…ç†æ— æ•ˆæƒé™
âš ï¸ è¶…çº§ç®¡ç†å‘˜æƒé™è¦ä¸¥æ ¼æ§åˆ¶
```

### 12.4 å®æˆ˜å¼€å‘æµç¨‹


**å®Œæ•´å¼€å‘æ­¥éª¤**ï¼š

```
ç¬¬ä¸€æ­¥ï¼šè®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
â”œâ”€â”€ ç”¨æˆ·è¡¨ã€è§’è‰²è¡¨ã€æƒé™è¡¨
â”œâ”€â”€ ç”¨æˆ·-è§’è‰²å…³è”è¡¨
â”œâ”€â”€ è§’è‰²-æƒé™å…³è”è¡¨
â””â”€â”€ èœå•è¡¨ã€å®¡è®¡æ—¥å¿—è¡¨

ç¬¬äºŒæ­¥ï¼šå®ç°RBACåŸºç¡€åŠŸèƒ½
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
â”œâ”€â”€ è§’è‰²ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
â”œâ”€â”€ æƒé™ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
â””â”€â”€ ç”¨æˆ·-è§’è‰²ã€è§’è‰²-æƒé™åˆ†é…

ç¬¬ä¸‰æ­¥ï¼šå®ç°æƒé™æ ¡éªŒ
â”œâ”€â”€ ç™»å½•æ—¶åŠ è½½ç”¨æˆ·æƒé™
â”œâ”€â”€ é…ç½®æƒé™æ‹¦æˆªå™¨
â”œâ”€â”€ ä½¿ç”¨æƒé™æ³¨è§£
â””â”€â”€ é›†æˆSpring Security

ç¬¬å››æ­¥ï¼šå®ç°èœå•æƒé™
â”œâ”€â”€ æ ¹æ®ç”¨æˆ·æƒé™æŸ¥è¯¢èœå•
â”œâ”€â”€ æ„å»ºèœå•æ ‘ç»“æ„
â”œâ”€â”€ å‰ç«¯æ¸²æŸ“åŠ¨æ€èœå•
â””â”€â”€ è·¯ç”±å®ˆå«æ§åˆ¶è®¿é—®

ç¬¬äº”æ­¥ï¼šå®ç°æŒ‰é’®æƒé™
â”œâ”€â”€ å®šä¹‰æŒ‰é’®æƒé™æ ‡è¯†
â”œâ”€â”€ åç«¯æ³¨è§£æ ¡éªŒ
â”œâ”€â”€ å‰ç«¯v-ifæ§åˆ¶æ˜¾ç¤º
â””â”€â”€ æƒé™æŒ‡ä»¤å°è£…

ç¬¬å…­æ­¥ï¼šå®ç°æ•°æ®æƒé™
â”œâ”€â”€ è®¾è®¡æ•°æ®æƒé™è§„åˆ™
â”œâ”€â”€ MyBatisæ‹¦æˆªå™¨å®ç°
â”œâ”€â”€ æˆ–ä½¿ç”¨AOPåˆ‡é¢
â””â”€â”€ SQLæ¡ä»¶åŠ¨æ€æ‹¼æ¥

ç¬¬ä¸ƒæ­¥ï¼šå®ç°æƒé™ç¼“å­˜
â”œâ”€â”€ é€‰æ‹©ç¼“å­˜æ–¹æ¡ˆï¼ˆRedisï¼‰
â”œâ”€â”€ è®¾è®¡ç¼“å­˜Key
â”œâ”€â”€ å®ç°ç¼“å­˜æ›´æ–°ç­–ç•¥
â””â”€â”€ ç¼“å­˜å¤±æ•ˆå¤„ç†

ç¬¬å…«æ­¥ï¼šå®ç°å®¡è®¡æ—¥å¿—
â”œâ”€â”€ å®šä¹‰å®¡è®¡æ—¥å¿—è¡¨
â”œâ”€â”€ AOPåˆ‡é¢è®°å½•æ—¥å¿—
â”œâ”€â”€ å¼‚æ­¥ä¿å­˜æ—¥å¿—
â””â”€â”€ æ—¥å¿—æŸ¥è¯¢å’Œç»Ÿè®¡

ç¬¬ä¹æ­¥ï¼šä¼˜åŒ–ä¸æµ‹è¯•
â”œâ”€â”€ æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
â”œâ”€â”€ å®‰å…¨æµ‹è¯•
â”œâ”€â”€ æƒé™å›å½’æµ‹è¯•
â””â”€â”€ å‹åŠ›æµ‹è¯•
```

### 12.5 å­¦ä¹ å»ºè®®


**ğŸ“š å¾ªåºæ¸è¿›å­¦ä¹ è·¯å¾„**

```
å…¥é—¨é˜¶æ®µï¼ˆç†è§£æ¦‚å¿µï¼‰ï¼š
1ï¸âƒ£ ç†è§£æƒé™ç®¡ç†çš„å¿…è¦æ€§
2ï¸âƒ£ æŒæ¡RBACæ¨¡å‹åŸç†
3ï¸âƒ£ ç†Ÿæ‚‰æ•°æ®åº“è¡¨è®¾è®¡

è¿›é˜¶é˜¶æ®µï¼ˆåŸºç¡€å®ç°ï¼‰ï¼š
4ï¸âƒ£ å®ç°ç”¨æˆ·è§’è‰²æƒé™ç®¡ç†
5ï¸âƒ£ å®ç°èœå•æƒé™æ§åˆ¶
6ï¸âƒ£ å®ç°æŒ‰é’®æƒé™æ§åˆ¶
7ï¸âƒ£ é›†æˆSpring Security

é«˜çº§é˜¶æ®µï¼ˆæ·±å…¥ä¼˜åŒ–ï¼‰ï¼š
8ï¸âƒ£ å®ç°æ•°æ®æƒé™æ§åˆ¶
9ï¸âƒ£ å®ç°åŠ¨æ€æƒé™åŠ è½½
ğŸ”Ÿ å®ç°æƒé™ç¼“å­˜ä¼˜åŒ–
1ï¸âƒ£1ï¸âƒ£ å®ç°å®¡è®¡æ—¥å¿—ç³»ç»Ÿ
```

**ğŸ’¡ å®è·µå»ºè®®**

```
âœ… ä»ç®€å•é¡¹ç›®å¼€å§‹ï¼Œé€æ­¥å®Œå–„æƒé™åŠŸèƒ½
âœ… å¤šå‚è€ƒå¼€æºé¡¹ç›®çš„æƒé™è®¾è®¡ï¼ˆå¦‚Ruoyiã€Jeecgï¼‰
âœ… ç†è§£ä¸šåŠ¡éœ€æ±‚ï¼Œè®¾è®¡åˆé€‚çš„æƒé™æ¨¡å‹
âœ… æ³¨é‡å®‰å…¨æ€§ï¼Œåç«¯æ ¡éªŒå¿…ä¸å¯å°‘
âœ… åšå¥½æ–‡æ¡£ï¼Œæ–¹ä¾¿å›¢é˜Ÿåä½œ
âœ… å®šæœŸä»£ç å®¡æŸ¥ï¼Œå‘ç°å®‰å…¨éšæ‚£
```

**ğŸ”— ç›¸å…³æŠ€æœ¯æ‰©å±•**

```
æ·±å…¥å­¦ä¹ æ–¹å‘ï¼š
â€¢ Spring Securityé«˜çº§ç‰¹æ€§
â€¢ OAuth2è®¤è¯æˆæƒ
â€¢ JWTæ— çŠ¶æ€è®¤è¯
â€¢ å•ç‚¹ç™»å½•(SSO)
â€¢ å¤šç§Ÿæˆ·æƒé™éš”ç¦»
â€¢ å¾®æœåŠ¡æƒé™ç»Ÿä¸€ç®¡ç†
```

---

## æ ¸å¿ƒè®°å¿†å£è¯€ âœ¨


```
æƒé™ç®¡ç†ä¸‰è¦ç´ ï¼Œä¸»ä½“èµ„æºå’Œæ“ä½œ
RBACæ¨¡å‹æ˜¯æ ¸å¿ƒï¼Œç”¨æˆ·è§’è‰²æƒé™è¿

èœå•æ§åˆ¶é¡µé¢è®¿é—®ï¼ŒæŒ‰é’®æ§åˆ¶åŠŸèƒ½æ“ä½œ
æ¥å£æ‹¦æˆªä¸¥æŠŠå…³ï¼Œæ•°æ®æƒé™ç»†ç²’åº¦

ç¼“å­˜æå‡æ€§èƒ½å¥½ï¼Œå®æ—¶æ›´æ–°åˆ«å¿˜äº†
æ³¨è§£æ‹¦æˆªåŒä¿é™©ï¼ŒåŠ¨æ€åŠ è½½æ›´çµæ´»

å®¡è®¡æ—¥å¿—è¦è®°å½•ï¼Œå®‰å…¨åˆè§„ä¸èƒ½å°‘
å‰ç«¯æ ¡éªŒæ˜¯è¾…åŠ©ï¼Œåç«¯éªŒè¯æ‰å¯é 
```

---

**æ€»ç»“**ï¼šæƒé™ç®¡ç†æ˜¯ä¼ä¸šçº§åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæ¶‰åŠå®‰å…¨ã€æ€§èƒ½ã€æ‰©å±•æ€§ç­‰å¤šä¸ªæ–¹é¢ã€‚æŒæ¡RBACæ¨¡å‹ã€ç†è§£æƒé™æ§åˆ¶çš„å¤šä¸ªå±‚æ¬¡ã€ç†Ÿç»ƒè¿ç”¨å„ç§å®ç°æŠ€æœ¯ï¼Œæ˜¯æ¯ä¸ªåç«¯å¼€å‘è€…å¿…å¤‡çš„æŠ€èƒ½ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æƒé™æ–¹æ¡ˆï¼Œæ—¢è¦ä¿è¯å®‰å…¨æ€§ï¼Œåˆè¦å…¼é¡¾ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ€§èƒ½ã€‚